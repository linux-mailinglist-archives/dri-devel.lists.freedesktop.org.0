Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 04A6E5E593
	for <lists+dri-devel@lfdr.de>; Wed,  3 Jul 2019 15:34:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C7ED96E13A;
	Wed,  3 Jul 2019 13:34:04 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5A2BD6E13A;
 Wed,  3 Jul 2019 13:34:03 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 7331728A8CE;
 Wed,  3 Jul 2019 14:34:01 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Tomeu Vizoso <tomeu@tomeuvizoso.net>, Rob Herring <robh+dt@kernel.org>
Subject: [RFC PATCH] mesa: Export BOs in RW mode
Date: Wed,  3 Jul 2019 15:33:57 +0200
Message-Id: <20190703133357.10217-1-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: mesa-dev@lists.freedesktop.org,
 Boris Brezillon <boris.brezillon@collabora.com>,
 dri-devel@lists.freedesktop.org, Steven Price <steven.price@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXhwb3J0ZWQgQk9zIG1pZ2h0IGJlIGltcG9ydGVkIGJhY2ssIHRoZW4gbW1hcCgpLWVkIHRvIGJl
IHdyaXR0ZW4KdG9vLiBNb3N0IGRyaXZlcnMgaGFuZGxlIHRoYXQgYnkgbW1hcCgpLWluZyB0aGUg
R0VNIGhhbmRsZSBhZnRlciBpdCdzCmJlZW4gaW1wb3J0ZWQsIGJ1dCwgYWNjb3JkaW5nIHRvIFsx
XSwgdGhpcyBpcyBpbGxlZ2FsLiBUaGUgcGFuZnJvc3QKZHJpdmVyIGhhcyByZWNlbnRseSBzd2l0
Y2hlZCB0byB0aGlzIGdlbmVyaWMgaGVscGVyICh3aGljaCB3YXMgcmVuYW1lZAppbnRvIGRybV9n
ZW1fbWFwX29mZnNldCgpIGluIHRoZSBtZWFudGltZSkgWzJdLCBhbmQgbW1hcCgpLWluZwpvZiBp
bXBvcnRlZCBCT3Mgbm93IGZhaWxzLgoKTm93IEknbSB3b25kZXJpbmcgaG93IHRoaXMgc2hvdWxk
IGJlIHNvbHZlZC4gSSBndWVzcyB0aGUgZmlyc3QgcXVlc3Rpb24KaXMsIGlzIG1tYXAoKS1pbmcg
b2YgaW1wb3J0ZWQgQk9zIHJlYWxseSBmb3JiaWRkZW4gZm9yIGFsbCBCT3M/IEkgZ3Vlc3MKY2Fs
bGluZyBtbWFwKCkgb24gYSBidWZmZXIgdGhhdCdzIGJlZW4gZXhwb3J0ZWQgYnkgdGhlIERSTSBk
cml2ZXIgaXRzZWxmCnRoZW4gcmUtaW1wb3J0ZWQgc2hvdWxkbid0IGh1cnQsIHNvIG1heWJlIHdl
IGNhbiBjaGVjayB0aGF0IGJlZm9yZQpmYWlsaW5nLgoKTm93LCBpZiB3ZSByZWFsbHkgd2FudCB0
byBmb3JiaWQgbW1hcCgpIG9uIGltcG9ydGVkIEJPcywgdGhhdCBtZWFucyB3ZQpuZWVkIGEgc29s
dXRpb24gdG8gbW1hcCgpIHRoZSBkbWFidWYgb2JqZWN0IGRpcmVjdGx5LCBhbmQgc29tZXRpbWVz
IHRoaXMKbWFwcGluZyB3aWxsIHJlcXVlc3QgUlcgcGVybWlzc2lvbnMuIFRoZSBwcm9ibGVtIGlz
LCBhbGwgZnVuY3Rpb24KZXhwb3J0aW5nIEJPcyBpbiBtZXNhIGFyZSBleHBvcnRpbmcgdGhlbSBp
biBSTy1tb2RlIChyZXN1bHRpbmcgRkQgaXMKT19SRUFEKSwgdGh1cyBwcmV2ZW50aW5nIG1tYXAo
KXMgaW4gUlcgbW9kZS4KClRoaXMgcGF0Y2ggbW9kaWZpZXMgYWxsCmRybVByaW1lSGFuZGxlVG9G
RCgpL2lvY3RsKERSTV9JT0NUTF9QUklNRV9IQU5ETEVfVE9fRkQpIGNhbGwgc2l0ZXMKdG8gcGFz
cyB0aGUgRFJNX1JEV1IgZmxhZyBzbyB0aGF0IHdoYXQncyBkZXNjcmliZWQgYWJvdmUgYmVjb21l
cwpwb3NzaWJsZS4KCkknbSBub3Qgc2F5aW5nIHRoaXMgaXMgd2hhdCB3ZSBzaG91bGQgZG8sIGl0
J3MgbW9yZSBhIHdheSB0byBzdGFydCB0aGUKZGlzY3Vzc2lvbi4gRmVlbCBmcmVlIHRvIHByb3Bv
c2UgYWx0ZXJuaXZlcyB0byB0aGlzIHNvbHV0aW9uLgoKWzFdaHR0cHM6Ly9naXQua2VybmVsLm9y
Zy9wdWIvc2NtL2xpbnV4L2tlcm5lbC9naXQvdG9ydmFsZHMvbGludXguZ2l0L3RyZWUvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW0uYz9oPXY1LjItcmM3I24zMTgKWzJdaHR0cHM6Ly9jZ2l0LmZyZWVk
ZXNrdG9wLm9yZy9kcm0vZHJtLW1pc2MvY29tbWl0L2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdD9p
ZD01ODNiYmY0NjEzM2M3MjZiYWUyNzdlOGY0ZTMyYmZiYTJhNTI4YzdmCgpTaWduZWQtb2ZmLWJ5
OiBCb3JpcyBCcmV6aWxsb24gPGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgpDYzogPGRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmc+CkNjOiA8bWVzYS1kZXZAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnPgpDYzogU3RldmVuIFByaWNlIDxzdGV2ZW4ucHJpY2VAYXJtLmNvbT4KQ2M6IFJv
YiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+Ci0tLQpDYy1pbmcgZHJpLWRldmVsIGlzIG5vdCBh
IG1pc3Rha2UsIEkgcmVhbGx5IHRvIGhhdmUgZmVlZGJhY2sgZnJvbSB0aGUgRFJNCm1haW50YWlu
ZXJzLCBzaW5jZSB0aGlzIHN0YXJ0ZWQgd2l0aCBhIGtlcm5lbC1zaWRlIGNoYW5nZS4KLS0tCiBz
cmMvZXRuYXZpdi9kcm0vZXRuYXZpdl9iby5jICAgICAgICAgICAgICAgICAgICAgIHwgNCArKy0t
CiBzcmMvZnJlZWRyZW5vL2RybS9mcmVlZHJlbm9fYm8uYyAgICAgICAgICAgICAgICAgIHwgNCAr
Ky0tCiBzcmMvZnJlZWRyZW5vL3Z1bGthbi90dV9kcm0uYyAgICAgICAgICAgICAgICAgICAgIHwg
MiArLQogc3JjL2dhbGxpdW0vYXV4aWxpYXJ5L3JlbmRlcm9ubHkvcmVuZGVyb25seS5jICAgICB8
IDIgKy0KIHNyYy9nYWxsaXVtL2RyaXZlcnMvaXJpcy9pcmlzX2J1Zm1nci5jICAgICAgICAgICAg
fCAyICstCiBzcmMvZ2FsbGl1bS9kcml2ZXJzL2xpbWEvbGltYV9iby5jICAgICAgICAgICAgICAg
IHwgMiArLQogc3JjL2dhbGxpdW0vZHJpdmVycy9wYW5mcm9zdC9wYW5fZHJtLmMgICAgICAgICAg
ICB8IDIgKy0KIHNyYy9nYWxsaXVtL2RyaXZlcnMvdjNkL3YzZF9idWZtZ3IuYyAgICAgICAgICAg
ICAgfCAyICstCiBzcmMvZ2FsbGl1bS9kcml2ZXJzL3ZjNC92YzRfYnVmbWdyLmMgICAgICAgICAg
ICAgIHwgMiArLQogc3JjL2dhbGxpdW0vd2luc3lzL3JhZGVvbi9kcm0vcmFkZW9uX2RybV9iby5j
ICAgICB8IDMgKystCiBzcmMvZ2FsbGl1bS93aW5zeXMvc3ZnYS9kcm0vdm13X3NjcmVlbl9kcmku
YyAgICAgIHwgNSArKystLQogc3JjL2dhbGxpdW0vd2luc3lzL3N3L2ttcy1kcmkva21zX2RyaV9z
d193aW5zeXMuYyB8IDIgKy0KIHNyYy9nYWxsaXVtL3dpbnN5cy92aXJnbC9kcm0vdmlyZ2xfZHJt
X3dpbnN5cy5jICAgfCAzICsrLQogc3JjL2ludGVsL3Z1bGthbi9hbnZfZ2VtLmMgICAgICAgICAg
ICAgICAgICAgICAgICB8IDIgKy0KIHNyYy9tZXNhL2RyaXZlcnMvZHJpL2k5NjUvYnJ3X2J1Zm1n
ci5jICAgICAgICAgICAgfCAyICstCiAxNSBmaWxlcyBjaGFuZ2VkLCAyMSBpbnNlcnRpb25zKCsp
LCAxOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9zcmMvZXRuYXZpdi9kcm0vZXRuYXZpdl9i
by5jIGIvc3JjL2V0bmF2aXYvZHJtL2V0bmF2aXZfYm8uYwppbmRleCA2ZTk1MmZhNDc4NTguLjky
NjM0MTQxYjU4MCAxMDA2NDQKLS0tIGEvc3JjL2V0bmF2aXYvZHJtL2V0bmF2aXZfYm8uYworKysg
Yi9zcmMvZXRuYXZpdi9kcm0vZXRuYXZpdl9iby5jCkBAIC0yOTQsOCArMjk0LDggQEAgaW50IGV0
bmFfYm9fZG1hYnVmKHN0cnVjdCBldG5hX2JvICpibykKIHsKIAlpbnQgcmV0LCBwcmltZV9mZDsK
IAotCXJldCA9IGRybVByaW1lSGFuZGxlVG9GRChiby0+ZGV2LT5mZCwgYm8tPmhhbmRsZSwgRFJN
X0NMT0VYRUMsCi0JCQkJJnByaW1lX2ZkKTsKKwlyZXQgPSBkcm1QcmltZUhhbmRsZVRvRkQoYm8t
PmRldi0+ZmQsIGJvLT5oYW5kbGUsCisJCQkJIERSTV9DTE9FWEVDIHwgRFJNX1JEV1IsICZwcmlt
ZV9mZCk7CiAJaWYgKHJldCkgewogCQlFUlJPUl9NU0coImZhaWxlZCB0byBnZXQgZG1hYnVmIGZk
OiAlZCIsIHJldCk7CiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9zcmMvZnJlZWRyZW5vL2Ry
bS9mcmVlZHJlbm9fYm8uYyBiL3NyYy9mcmVlZHJlbm8vZHJtL2ZyZWVkcmVub19iby5jCmluZGV4
IDc0NDkxNjBmMTM3MS4uYmExOWIwOGQ3YzU0IDEwMDY0NAotLS0gYS9zcmMvZnJlZWRyZW5vL2Ry
bS9mcmVlZHJlbm9fYm8uYworKysgYi9zcmMvZnJlZWRyZW5vL2RybS9mcmVlZHJlbm9fYm8uYwpA
QCAtMzE4LDggKzMxOCw4IEBAIGludCBmZF9ib19kbWFidWYoc3RydWN0IGZkX2JvICpibykKIHsK
IAlpbnQgcmV0LCBwcmltZV9mZDsKIAotCXJldCA9IGRybVByaW1lSGFuZGxlVG9GRChiby0+ZGV2
LT5mZCwgYm8tPmhhbmRsZSwgRFJNX0NMT0VYRUMsCi0JCQkmcHJpbWVfZmQpOworCXJldCA9IGRy
bVByaW1lSGFuZGxlVG9GRChiby0+ZGV2LT5mZCwgYm8tPmhhbmRsZSwKKwkJCQkgRFJNX0NMT0VY
RUMgfCBEUk1fUkRXUiwgJnByaW1lX2ZkKTsKIAlpZiAocmV0KSB7CiAJCUVSUk9SX01TRygiZmFp
bGVkIHRvIGdldCBkbWFidWYgZmQ6ICVkIiwgcmV0KTsKIAkJcmV0dXJuIHJldDsKZGlmZiAtLWdp
dCBhL3NyYy9mcmVlZHJlbm8vdnVsa2FuL3R1X2RybS5jIGIvc3JjL2ZyZWVkcmVuby92dWxrYW4v
dHVfZHJtLmMKaW5kZXggOWIyZTZmNzg4NzllLi42YmVmMzAxMmRkYjUgMTAwNjQ0Ci0tLSBhL3Ny
Yy9mcmVlZHJlbm8vdnVsa2FuL3R1X2RybS5jCisrKyBiL3NyYy9mcmVlZHJlbm8vdnVsa2FuL3R1
X2RybS5jCkBAIC0xNDcsNyArMTQ3LDcgQEAgdHVfZ2VtX2V4cG9ydF9kbWFidWYoY29uc3Qgc3Ry
dWN0IHR1X2RldmljZSAqZGV2LCB1aW50MzJfdCBnZW1faGFuZGxlKQogewogICAgaW50IHByaW1l
X2ZkOwogICAgaW50IHJldCA9IGRybVByaW1lSGFuZGxlVG9GRChkZXYtPnBoeXNpY2FsX2Rldmlj
ZS0+bG9jYWxfZmQsIGdlbV9oYW5kbGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IERSTV9DTE9FWEVDLCAmcHJpbWVfZmQpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBEUk1fQ0xPRVhFQyB8IERSTV9SRFdSLCAmcHJpbWVfZmQpOwogCiAgICByZXR1cm4gcmV0ID09
IDAgPyBwcmltZV9mZCA6IC0xOwogfQpkaWZmIC0tZ2l0IGEvc3JjL2dhbGxpdW0vYXV4aWxpYXJ5
L3JlbmRlcm9ubHkvcmVuZGVyb25seS5jIGIvc3JjL2dhbGxpdW0vYXV4aWxpYXJ5L3JlbmRlcm9u
bHkvcmVuZGVyb25seS5jCmluZGV4IGQ2YTM0NDAwOTM3OC4uYzFjYzMxMTE1MTA1IDEwMDY0NAot
LS0gYS9zcmMvZ2FsbGl1bS9hdXhpbGlhcnkvcmVuZGVyb25seS9yZW5kZXJvbmx5LmMKKysrIGIv
c3JjL2dhbGxpdW0vYXV4aWxpYXJ5L3JlbmRlcm9ubHkvcmVuZGVyb25seS5jCkBAIC0xMDEsNyAr
MTAxLDcgQEAgcmVuZGVyb25seV9jcmVhdGVfa21zX2R1bWJfYnVmZmVyX2Zvcl9yZXNvdXJjZShz
dHJ1Y3QgcGlwZV9yZXNvdXJjZSAqcnNjLAogICAgb3V0X2hhbmRsZS0+dHlwZSA9IFdJTlNZU19I
QU5ETEVfVFlQRV9GRDsKICAgIG91dF9oYW5kbGUtPnN0cmlkZSA9IGNyZWF0ZV9kdW1iLnBpdGNo
OwogCi0gICBlcnIgPSBkcm1QcmltZUhhbmRsZVRvRkQocm8tPmttc19mZCwgY3JlYXRlX2R1bWIu
aGFuZGxlLCBPX0NMT0VYRUMsCisgICBlcnIgPSBkcm1QcmltZUhhbmRsZVRvRkQocm8tPmttc19m
ZCwgY3JlYXRlX2R1bWIuaGFuZGxlLCBPX0NMT0VYRUMgfCBPX1JEV1IsCiAgICAgICAgICAoaW50
ICopJm91dF9oYW5kbGUtPmhhbmRsZSk7CiAgICBpZiAoZXJyIDwgMCkgewogICAgICAgZnByaW50
ZihzdGRlcnIsICJmYWlsZWQgdG8gZXhwb3J0IGR1bWIgYnVmZmVyOiAlc1xuIiwgc3RyZXJyb3Io
ZXJybm8pKTsKZGlmZiAtLWdpdCBhL3NyYy9nYWxsaXVtL2RyaXZlcnMvaXJpcy9pcmlzX2J1Zm1n
ci5jIGIvc3JjL2dhbGxpdW0vZHJpdmVycy9pcmlzL2lyaXNfYnVmbWdyLmMKaW5kZXggZDgwOTQ1
ODI0MDk4Li42OGU1ZDhhOGJiMTMgMTAwNjQ0Ci0tLSBhL3NyYy9nYWxsaXVtL2RyaXZlcnMvaXJp
cy9pcmlzX2J1Zm1nci5jCisrKyBiL3NyYy9nYWxsaXVtL2RyaXZlcnMvaXJpcy9pcmlzX2J1Zm1n
ci5jCkBAIC0xMzY5LDcgKzEzNjksNyBAQCBpcmlzX2JvX2V4cG9ydF9kbWFidWYoc3RydWN0IGly
aXNfYm8gKmJvLCBpbnQgKnByaW1lX2ZkKQogICAgaXJpc19ib19tYWtlX2V4dGVybmFsKGJvKTsK
IAogICAgaWYgKGRybVByaW1lSGFuZGxlVG9GRChidWZtZ3ItPmZkLCBiby0+Z2VtX2hhbmRsZSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgRFJNX0NMT0VYRUMsIHByaW1lX2ZkKSAhPSAwKQor
ICAgICAgICAgICAgICAgICAgICAgICAgICBEUk1fQ0xPRVhFQyB8IERSTV9SRFdSLCBwcmltZV9m
ZCkgIT0gMCkKICAgICAgIHJldHVybiAtZXJybm87CiAKICAgIGJvLT5yZXVzYWJsZSA9IGZhbHNl
OwpkaWZmIC0tZ2l0IGEvc3JjL2dhbGxpdW0vZHJpdmVycy9saW1hL2xpbWFfYm8uYyBiL3NyYy9n
YWxsaXVtL2RyaXZlcnMvbGltYS9saW1hX2JvLmMKaW5kZXggMWQ2ZGQ3MjA2MDJhLi5kZjAxMTRm
YzY3ZWQgMTAwNjQ0Ci0tLSBhL3NyYy9nYWxsaXVtL2RyaXZlcnMvbGltYS9saW1hX2JvLmMKKysr
IGIvc3JjL2dhbGxpdW0vZHJpdmVycy9saW1hL2xpbWFfYm8uYwpAQCAtMjA1LDcgKzIwNSw3IEBA
IGJvb2wgbGltYV9ib19leHBvcnQoc3RydWN0IGxpbWFfYm8gKmJvLCBzdHJ1Y3Qgd2luc3lzX2hh
bmRsZSAqaGFuZGxlKQogICAgICAgcmV0dXJuIHRydWU7CiAKICAgIGNhc2UgV0lOU1lTX0hBTkRM
RV9UWVBFX0ZEOgotICAgICAgaWYgKGRybVByaW1lSGFuZGxlVG9GRChzY3JlZW4tPmZkLCBiby0+
aGFuZGxlLCBEUk1fQ0xPRVhFQywKKyAgICAgIGlmIChkcm1QcmltZUhhbmRsZVRvRkQoc2NyZWVu
LT5mZCwgYm8tPmhhbmRsZSwgRFJNX0NMT0VYRUMgfCBEUk1fUkRXUiwKICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgKGludCopJmhhbmRsZS0+aGFuZGxlKSkKICAgICAgICAgIHJldHVybiBm
YWxzZTsKIApkaWZmIC0tZ2l0IGEvc3JjL2dhbGxpdW0vZHJpdmVycy9wYW5mcm9zdC9wYW5fZHJt
LmMgYi9zcmMvZ2FsbGl1bS9kcml2ZXJzL3BhbmZyb3N0L3Bhbl9kcm0uYwppbmRleCA4ZGU0ZjQ4
MzQzNWMuLmEwODY1NzVjNDUzYSAxMDA2NDQKLS0tIGEvc3JjL2dhbGxpdW0vZHJpdmVycy9wYW5m
cm9zdC9wYW5fZHJtLmMKKysrIGIvc3JjL2dhbGxpdW0vZHJpdmVycy9wYW5mcm9zdC9wYW5fZHJt
LmMKQEAgLTE4MSw3ICsxODEsNyBAQCBwYW5mcm9zdF9kcm1fZXhwb3J0X2JvKHN0cnVjdCBwYW5m
cm9zdF9zY3JlZW4gKnNjcmVlbiwgY29uc3Qgc3RydWN0IHBhbmZyb3N0X2JvCiB7CiAgICAgICAg
IHN0cnVjdCBkcm1fcHJpbWVfaGFuZGxlIGFyZ3MgPSB7CiAgICAgICAgICAgICAgICAgLmhhbmRs
ZSA9IGJvLT5nZW1faGFuZGxlLAotICAgICAgICAgICAgICAgIC5mbGFncyA9IERSTV9DTE9FWEVD
LAorICAgICAgICAgICAgICAgIC5mbGFncyA9IERSTV9DTE9FWEVDIHwgRFJNX1JEV1IsCiAgICAg
ICAgIH07CiAKICAgICAgICAgaW50IHJldCA9IGRybUlvY3RsKHNjcmVlbi0+ZmQsIERSTV9JT0NU
TF9QUklNRV9IQU5ETEVfVE9fRkQsICZhcmdzKTsKZGlmZiAtLWdpdCBhL3NyYy9nYWxsaXVtL2Ry
aXZlcnMvdjNkL3YzZF9idWZtZ3IuYyBiL3NyYy9nYWxsaXVtL2RyaXZlcnMvdjNkL3YzZF9idWZt
Z3IuYwppbmRleCBmMGRmMWI5ODM3MzcuLjBjNzg5OTRkODk5ZiAxMDA2NDQKLS0tIGEvc3JjL2dh
bGxpdW0vZHJpdmVycy92M2QvdjNkX2J1Zm1nci5jCisrKyBiL3NyYy9nYWxsaXVtL2RyaXZlcnMv
djNkL3YzZF9idWZtZ3IuYwpAQCAtNDI0LDcgKzQyNCw3IEBAIHYzZF9ib19nZXRfZG1hYnVmKHN0
cnVjdCB2M2RfYm8gKmJvKQogewogICAgICAgICBpbnQgZmQ7CiAgICAgICAgIGludCByZXQgPSBk
cm1QcmltZUhhbmRsZVRvRkQoYm8tPnNjcmVlbi0+ZmQsIGJvLT5oYW5kbGUsCi0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgT19DTE9FWEVDLCAmZmQpOworICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIERSTV9DTE9FWEVDIHwgRFJNX1JEV1IsICZmZCk7CiAg
ICAgICAgIGlmIChyZXQgIT0gMCkgewogICAgICAgICAgICAgICAgIGZwcmludGYoc3RkZXJyLCAi
RmFpbGVkIHRvIGV4cG9ydCBnZW0gYm8gJWQgdG8gZG1hYnVmXG4iLAogICAgICAgICAgICAgICAg
ICAgICAgICAgYm8tPmhhbmRsZSk7CmRpZmYgLS1naXQgYS9zcmMvZ2FsbGl1bS9kcml2ZXJzL3Zj
NC92YzRfYnVmbWdyLmMgYi9zcmMvZ2FsbGl1bS9kcml2ZXJzL3ZjNC92YzRfYnVmbWdyLmMKaW5k
ZXggNzE2Y2E1MGVhMDY5Li5jN2U4OWI2YTUxN2UgMTAwNjQ0Ci0tLSBhL3NyYy9nYWxsaXVtL2Ry
aXZlcnMvdmM0L3ZjNF9idWZtZ3IuYworKysgYi9zcmMvZ2FsbGl1bS9kcml2ZXJzL3ZjNC92YzRf
YnVmbWdyLmMKQEAgLTQ2Miw3ICs0NjIsNyBAQCB2YzRfYm9fZ2V0X2RtYWJ1ZihzdHJ1Y3QgdmM0
X2JvICpibykKIHsKICAgICAgICAgaW50IGZkOwogICAgICAgICBpbnQgcmV0ID0gZHJtUHJpbWVI
YW5kbGVUb0ZEKGJvLT5zY3JlZW4tPmZkLCBiby0+aGFuZGxlLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIE9fQ0xPRVhFQywgJmZkKTsKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBEUk1fQ0xPRVhFQyB8IERSTV9SRFdSLCAmZmQpOwogICAgICAgICBp
ZiAocmV0ICE9IDApIHsKICAgICAgICAgICAgICAgICBmcHJpbnRmKHN0ZGVyciwgIkZhaWxlZCB0
byBleHBvcnQgZ2VtIGJvICVkIHRvIGRtYWJ1ZlxuIiwKICAgICAgICAgICAgICAgICAgICAgICAg
IGJvLT5oYW5kbGUpOwpkaWZmIC0tZ2l0IGEvc3JjL2dhbGxpdW0vd2luc3lzL3JhZGVvbi9kcm0v
cmFkZW9uX2RybV9iby5jIGIvc3JjL2dhbGxpdW0vd2luc3lzL3JhZGVvbi9kcm0vcmFkZW9uX2Ry
bV9iby5jCmluZGV4IGQxZTJhODY4NWJhOS4uYWU3OTU4YThiODkyIDEwMDY0NAotLS0gYS9zcmMv
Z2FsbGl1bS93aW5zeXMvcmFkZW9uL2RybS9yYWRlb25fZHJtX2JvLmMKKysrIGIvc3JjL2dhbGxp
dW0vd2luc3lzL3JhZGVvbi9kcm0vcmFkZW9uX2RybV9iby5jCkBAIC0xMzIwLDcgKzEzMjAsOCBA
QCBzdGF0aWMgYm9vbCByYWRlb25fd2luc3lzX2JvX2dldF9oYW5kbGUoc3RydWN0IHBiX2J1ZmZl
ciAqYnVmZmVyLAogICAgIH0gZWxzZSBpZiAod2hhbmRsZS0+dHlwZSA9PSBXSU5TWVNfSEFORExF
X1RZUEVfS01TKSB7CiAgICAgICAgIHdoYW5kbGUtPmhhbmRsZSA9IGJvLT5oYW5kbGU7CiAgICAg
fSBlbHNlIGlmICh3aGFuZGxlLT50eXBlID09IFdJTlNZU19IQU5ETEVfVFlQRV9GRCkgewotICAg
ICAgICBpZiAoZHJtUHJpbWVIYW5kbGVUb0ZEKHdzLT5mZCwgYm8tPmhhbmRsZSwgRFJNX0NMT0VY
RUMsIChpbnQqKSZ3aGFuZGxlLT5oYW5kbGUpKQorICAgICAgICBpZiAoZHJtUHJpbWVIYW5kbGVU
b0ZEKHdzLT5mZCwgYm8tPmhhbmRsZSwgRFJNX0NMT0VYRUMgfCBEUk1fUkRXUiwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAoaW50Kikmd2hhbmRsZS0+aGFuZGxlKSkKICAgICAgICAg
ICAgIHJldHVybiBmYWxzZTsKICAgICB9CiAKZGlmZiAtLWdpdCBhL3NyYy9nYWxsaXVtL3dpbnN5
cy9zdmdhL2RybS92bXdfc2NyZWVuX2RyaS5jIGIvc3JjL2dhbGxpdW0vd2luc3lzL3N2Z2EvZHJt
L3Ztd19zY3JlZW5fZHJpLmMKaW5kZXggYTg1ZWUxOGU0NWI5Li4yNGY2ZGRhYzA4OTAgMTAwNjQ0
Ci0tLSBhL3NyYy9nYWxsaXVtL3dpbnN5cy9zdmdhL2RybS92bXdfc2NyZWVuX2RyaS5jCisrKyBi
L3NyYy9nYWxsaXVtL3dpbnN5cy9zdmdhL2RybS92bXdfc2NyZWVuX2RyaS5jCkBAIC0zNDUsOCAr
MzQ1LDkgQEAgdm13X2RybV9zdXJmYWNlX2dldF9oYW5kbGUoc3RydWN0IHN2Z2Ffd2luc3lzX3Nj
cmVlbiAqc3dzLAogICAgICAgIHdoYW5kbGUtPmhhbmRsZSA9IHZzcmYtPnNpZDsKICAgICAgICBi
cmVhazsKICAgICBjYXNlIFdJTlNZU19IQU5ETEVfVFlQRV9GRDoKLSAgICAgICByZXQgPSBkcm1Q
cmltZUhhbmRsZVRvRkQodndzLT5pb2N0bC5kcm1fZmQsIHZzcmYtPnNpZCwgRFJNX0NMT0VYRUMs
Ci0JCQkJKGludCAqKSZ3aGFuZGxlLT5oYW5kbGUpOworICAgICAgIHJldCA9IGRybVByaW1lSGFu
ZGxlVG9GRCh2d3MtPmlvY3RsLmRybV9mZCwgdnNyZi0+c2lkLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBEUk1fQ0xPRVhFQyB8IERSTV9SRFdSLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAoaW50ICopJndoYW5kbGUtPmhhbmRsZSk7CiAgICAgICAgaWYgKHJldCkg
ewogCSAgdm13X2Vycm9yKCJGYWlsZWQgdG8gZ2V0IGZpbGUgZGVzY3JpcHRvciBmcm9tIHByaW1l
LlxuIik7CiAJICByZXR1cm4gRkFMU0U7CmRpZmYgLS1naXQgYS9zcmMvZ2FsbGl1bS93aW5zeXMv
c3cva21zLWRyaS9rbXNfZHJpX3N3X3dpbnN5cy5jIGIvc3JjL2dhbGxpdW0vd2luc3lzL3N3L2tt
cy1kcmkva21zX2RyaV9zd193aW5zeXMuYwppbmRleCBkOWI0MTdkYzRkYWQuLmNlNDdlNjZhYjFl
NSAxMDA2NDQKLS0tIGEvc3JjL2dhbGxpdW0vd2luc3lzL3N3L2ttcy1kcmkva21zX2RyaV9zd193
aW5zeXMuYworKysgYi9zcmMvZ2FsbGl1bS93aW5zeXMvc3cva21zLWRyaS9rbXNfZHJpX3N3X3dp
bnN5cy5jCkBAIC00NDYsNyArNDQ2LDcgQEAga21zX3N3X2Rpc3BsYXl0YXJnZXRfZ2V0X2hhbmRs
ZShzdHJ1Y3Qgc3dfd2luc3lzICp3aW5zeXMsCiAgICAgICByZXR1cm4gVFJVRTsKICAgIGNhc2Ug
V0lOU1lTX0hBTkRMRV9UWVBFX0ZEOgogICAgICAgaWYgKCFkcm1QcmltZUhhbmRsZVRvRkQoa21z
X3N3LT5mZCwga21zX3N3X2R0LT5oYW5kbGUsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
IERSTV9DTE9FWEVDLCAoaW50Kikmd2hhbmRsZS0+aGFuZGxlKSkgeworICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBEUk1fQ0xPRVhFQyB8IERSTV9SRFdSLCAoaW50Kikmd2hhbmRsZS0+aGFu
ZGxlKSkgewogICAgICAgICAgd2hhbmRsZS0+c3RyaWRlID0gcGxhbmUtPnN0cmlkZTsKICAgICAg
ICAgIHdoYW5kbGUtPm9mZnNldCA9IHBsYW5lLT5vZmZzZXQ7CiAgICAgICAgICByZXR1cm4gVFJV
RTsKZGlmZiAtLWdpdCBhL3NyYy9nYWxsaXVtL3dpbnN5cy92aXJnbC9kcm0vdmlyZ2xfZHJtX3dp
bnN5cy5jIGIvc3JjL2dhbGxpdW0vd2luc3lzL3ZpcmdsL2RybS92aXJnbF9kcm1fd2luc3lzLmMK
aW5kZXggOWVlYzkyZjU3MzYzLi4wN2ZhYjI3MzVlMjUgMTAwNjQ0Ci0tLSBhL3NyYy9nYWxsaXVt
L3dpbnN5cy92aXJnbC9kcm0vdmlyZ2xfZHJtX3dpbnN5cy5jCisrKyBiL3NyYy9nYWxsaXVtL3dp
bnN5cy92aXJnbC9kcm0vdmlyZ2xfZHJtX3dpbnN5cy5jCkBAIC00MTgsNyArNDE4LDggQEAgc3Rh
dGljIGJvb2xlYW4gdmlyZ2xfZHJtX3dpbnN5c19yZXNvdXJjZV9nZXRfaGFuZGxlKHN0cnVjdCB2
aXJnbF93aW5zeXMgKnF3cywKICAgIH0gZWxzZSBpZiAod2hhbmRsZS0+dHlwZSA9PSBXSU5TWVNf
SEFORExFX1RZUEVfS01TKSB7CiAgICAgICB3aGFuZGxlLT5oYW5kbGUgPSByZXMtPmJvX2hhbmRs
ZTsKICAgIH0gZWxzZSBpZiAod2hhbmRsZS0+dHlwZSA9PSBXSU5TWVNfSEFORExFX1RZUEVfRkQp
IHsKLSAgICAgIGlmIChkcm1QcmltZUhhbmRsZVRvRkQocWR3cy0+ZmQsIHJlcy0+Ym9faGFuZGxl
LCBEUk1fQ0xPRVhFQywgKGludCopJndoYW5kbGUtPmhhbmRsZSkpCisgICAgICBpZiAoZHJtUHJp
bWVIYW5kbGVUb0ZEKHFkd3MtPmZkLCByZXMtPmJvX2hhbmRsZSwgRFJNX0NMT0VYRUMgfCBEUk1f
UkRXUiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGludCopJndoYW5kbGUtPmhhbmRs
ZSkpCiAgICAgICAgICAgICByZXR1cm4gRkFMU0U7CiAgICAgICBtdHhfbG9jaygmcWR3cy0+Ym9f
aGFuZGxlc19tdXRleCk7CiAgICAgICB1dGlsX2hhc2hfdGFibGVfc2V0KHFkd3MtPmJvX2hhbmRs
ZXMsICh2b2lkICopKHVpbnRwdHJfdClyZXMtPmJvX2hhbmRsZSwgcmVzKTsKZGlmZiAtLWdpdCBh
L3NyYy9pbnRlbC92dWxrYW4vYW52X2dlbS5jIGIvc3JjL2ludGVsL3Z1bGthbi9hbnZfZ2VtLmMK
aW5kZXggMWJkZjA0MGMxYTM3Li44ZjA3OTI4NjM4Y2UgMTAwNjQ0Ci0tLSBhL3NyYy9pbnRlbC92
dWxrYW4vYW52X2dlbS5jCisrKyBiL3NyYy9pbnRlbC92dWxrYW4vYW52X2dlbS5jCkBAIC0zOTks
NyArMzk5LDcgQEAgYW52X2dlbV9oYW5kbGVfdG9fZmQoc3RydWN0IGFudl9kZXZpY2UgKmRldmlj
ZSwgdWludDMyX3QgZ2VtX2hhbmRsZSkKIHsKICAgIHN0cnVjdCBkcm1fcHJpbWVfaGFuZGxlIGFy
Z3MgPSB7CiAgICAgICAuaGFuZGxlID0gZ2VtX2hhbmRsZSwKLSAgICAgIC5mbGFncyA9IERSTV9D
TE9FWEVDLAorICAgICAgLmZsYWdzID0gRFJNX0NMT0VYRUMgfCBEUk1fUkRXUiwKICAgIH07CiAK
ICAgIGludCByZXQgPSBhbnZfaW9jdGwoZGV2aWNlLT5mZCwgRFJNX0lPQ1RMX1BSSU1FX0hBTkRM
RV9UT19GRCwgJmFyZ3MpOwpkaWZmIC0tZ2l0IGEvc3JjL21lc2EvZHJpdmVycy9kcmkvaTk2NS9i
cndfYnVmbWdyLmMgYi9zcmMvbWVzYS9kcml2ZXJzL2RyaS9pOTY1L2Jyd19idWZtZ3IuYwppbmRl
eCBhN2M2ODQwNjMxNTguLmVlNjM5ZDJjZjIzYSAxMDA2NDQKLS0tIGEvc3JjL21lc2EvZHJpdmVy
cy9kcmkvaTk2NS9icndfYnVmbWdyLmMKKysrIGIvc3JjL21lc2EvZHJpdmVycy9kcmkvaTk2NS9i
cndfYnVmbWdyLmMKQEAgLTE0ODksNyArMTQ4OSw3IEBAIGJyd19ib19nZW1fZXhwb3J0X3RvX3By
aW1lKHN0cnVjdCBicndfYm8gKmJvLCBpbnQgKnByaW1lX2ZkKQogICAgYnJ3X2JvX21ha2VfZXh0
ZXJuYWwoYm8pOwogCiAgICBpZiAoZHJtUHJpbWVIYW5kbGVUb0ZEKGJ1Zm1nci0+ZmQsIGJvLT5n
ZW1faGFuZGxlLAotICAgICAgICAgICAgICAgICAgICAgICAgICBEUk1fQ0xPRVhFQywgcHJpbWVf
ZmQpICE9IDApCisgICAgICAgICAgICAgICAgICAgICAgICAgIERSTV9DTE9FWEVDIHwgRFJNX1JE
V1IsIHByaW1lX2ZkKSAhPSAwKQogICAgICAgcmV0dXJuIC1lcnJubzsKIAogICAgYm8tPnJldXNh
YmxlID0gZmFsc2U7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
