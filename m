Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0DBF334A4F
	for <lists+dri-devel@lfdr.de>; Tue,  4 Jun 2019 16:26:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B13B989147;
	Tue,  4 Jun 2019 14:26:35 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from newverein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2B3E1897E3
 for <dri-devel@lists.freedesktop.org>; Tue,  4 Jun 2019 12:23:22 +0000 (UTC)
Received: by newverein.lst.de (Postfix, from userid 2005)
 id 4E81268B05; Tue,  4 Jun 2019 14:22:56 +0200 (CEST)
From: Torsten Duwe <duwe@lst.de>
To: Maxime Ripard <maxime.ripard@bootlin.com>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Subject: [PATCH v2 3/7] drm/bridge: extract some Analogix I2C DP common code
References: <20190604122150.29D6468B05@newverein.lst.de>
Message-Id: <20190604122256.4E81268B05@newverein.lst.de>
Date: Tue,  4 Jun 2019 14:22:56 +0200 (CEST)
X-Mailman-Approved-At: Tue, 04 Jun 2019 14:26:35 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKU29tZSBjb2RlIGNhbiBiZSBz
aGFyZWQgd2l0aGluIGRpZmZlcmVudCBEUCBicmlkZ2VzIGJ5IEFuYWxvZ2l4LgpFeHRyYWN0IHRo
ZW0gdG8gYW5hbG9naXhfZHAuCgpTaWduZWQtb2ZmLWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5
QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2lseSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFp
bC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4gRHV3ZSA8ZHV3ZUBzdXNlLmRlPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvTWFrZWZpbGUgICAgICAgICAgIHwgICAyICst
CiBkcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4eHguYyB8IDE0
NiArLS0tLS0tLS0tLS0tLS0tLQogLi4uL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4
LWkyYy1kcHR4LmMgICAgfCAxNzMgKysrKysrKysrKysrKysrKysrKysrCiAuLi4vZ3B1L2RybS9i
cmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtaTJjLWRwdHguaCAgICB8ICAgMyArCiA0IGZpbGVzIGNo
YW5nZWQsIDE3OCBpbnNlcnRpb25zKCspLCAxNDYgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5j
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZSBi
L2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvTWFrZWZpbGUKaW5kZXggNmZjYmZkM2Vl
NTYwLi43NjIzYjliODAxNjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtl
ZmlsZQpAQCAtMSw0ICsxLDQgQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAt
b25seQotYW5hbG9naXhfZHAtb2JqcyA6PSBhbmFsb2dpeF9kcF9jb3JlLm8gYW5hbG9naXhfZHBf
cmVnLm8KK2FuYWxvZ2l4X2RwLW9ianMgOj0gYW5hbG9naXhfZHBfY29yZS5vIGFuYWxvZ2l4X2Rw
X3JlZy5vIGFuYWxvZ2l4LWkyYy1kcHR4Lm8KIG9iai0kKENPTkZJR19EUk1fQU5BTE9HSVhfQU5Y
NzhYWCkgKz0gYW5hbG9naXgtYW54Nzh4eC5vCiBvYmotJChDT05GSUdfRFJNX0FOQUxPR0lYX0RQ
KSArPSBhbmFsb2dpeF9kcC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2Fu
YWxvZ2l4L2FuYWxvZ2l4LWFueDc4eHguYyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9n
aXgvYW5hbG9naXgtYW54Nzh4eC5jCmluZGV4IGMwOWFhZjkzYWUxYi4uZjM2YWU1MWM2NDFkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4
eHguYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4
eHguYwpAQCAtNDUsOCArNDUsNiBAQAogI2RlZmluZSBJMkNfSURYX1JYX1AxCQk0CiAKICNkZWZp
bmUgWFRBTF9DTEsJCTI3MCAvKiAyN00gKi8KLSNkZWZpbmUgQVVYX0NIX0JVRkZFUl9TSVpFCTE2
Ci0jZGVmaW5lIEFVWF9XQUlUX1RJTUVPVVRfTVMJMTUKIAogc3RhdGljIGNvbnN0IHU4IGFueDc4
eHhfaTJjX2FkZHJlc3Nlc1tdID0gewogCVtJMkNfSURYX1RYX1AwXSA9IFRYX1AwLApAQCAtMTA5
LDE1MyArMTA3LDExIEBAIHN0YXRpYyBpbnQgYW54Nzh4eF9jbGVhcl9iaXRzKHN0cnVjdCByZWdt
YXAgKm1hcCwgdTggcmVnLCB1OCBtYXNrKQogCXJldHVybiByZWdtYXBfdXBkYXRlX2JpdHMobWFw
LCByZWcsIG1hc2ssIDApOwogfQogCi1zdGF0aWMgYm9vbCBhbng3OHh4X2F1eF9vcF9maW5pc2hl
ZChzdHJ1Y3QgYW54Nzh4eCAqYW54Nzh4eCkKLXsKLQl1bnNpZ25lZCBpbnQgdmFsdWU7Ci0JaW50
IGVycjsKLQotCWVyciA9IHJlZ21hcF9yZWFkKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwg
U1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKLQkJCSAgJnZhbHVlKTsKLQlpZiAoZXJyIDwgMCkKLQkJ
cmV0dXJuIGZhbHNlOwotCi0JcmV0dXJuICh2YWx1ZSAmIFNQX0FVWF9FTikgPT0gMDsKLX0KLQot
c3RhdGljIGludCBhbng3OHh4X2F1eF93YWl0KHN0cnVjdCBhbng3OHh4ICphbng3OHh4KQotewot
CXVuc2lnbmVkIGxvbmcgdGltZW91dDsKLQl1bnNpZ25lZCBpbnQgc3RhdHVzOwotCWludCBlcnI7
Ci0KLQl0aW1lb3V0ID0gamlmZmllcyArIG1zZWNzX3RvX2ppZmZpZXMoQVVYX1dBSVRfVElNRU9V
VF9NUykgKyAxOwotCi0Jd2hpbGUgKCFhbng3OHh4X2F1eF9vcF9maW5pc2hlZChhbng3OHh4KSkg
ewotCQlpZiAodGltZV9hZnRlcihqaWZmaWVzLCB0aW1lb3V0KSkgewotCQkJaWYgKCFhbng3OHh4
X2F1eF9vcF9maW5pc2hlZChhbng3OHh4KSkgewotCQkJCURSTV9FUlJPUigiVGltZWQgb3V0IHdh
aXRpbmcgQVVYIHRvIGZpbmlzaFxuIik7Ci0JCQkJcmV0dXJuIC1FVElNRURPVVQ7Ci0JCQl9Ci0K
LQkJCWJyZWFrOwotCQl9Ci0KLQkJdXNsZWVwX3JhbmdlKDEwMDAsIDIwMDApOwotCX0KLQotCS8q
IFJlYWQgdGhlIEFVWCBjaGFubmVsIGFjY2VzcyBzdGF0dXMgKi8KLQllcnIgPSByZWdtYXBfcmVh
ZChhbng3OHh4LT5tYXBbSTJDX0lEWF9UWF9QMF0sIFNQX0FVWF9DSF9TVEFUVVNfUkVHLAotCQkJ
ICAmc3RhdHVzKTsKLQlpZiAoZXJyIDwgMCkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZWFk
IGZyb20gQVVYIGNoYW5uZWw6ICVkXG4iLCBlcnIpOwotCQlyZXR1cm4gZXJyOwotCX0KLQotCWlm
IChzdGF0dXMgJiBTUF9BVVhfU1RBVFVTKSB7Ci0JCURSTV9FUlJPUigiRmFpbGVkIHRvIHdhaXQg
Zm9yIEFVWCBjaGFubmVsIChzdGF0dXM6ICUwMngpXG4iLAotCQkJICBzdGF0dXMpOwotCQlyZXR1
cm4gLUVUSU1FRE9VVDsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBhbng3OHh4
X2F1eF9hZGRyZXNzKHN0cnVjdCBhbng3OHh4ICphbng3OHh4LCB1bnNpZ25lZCBpbnQgYWRkcikK
LXsKLQlpbnQgZXJyOwotCi0JZXJyID0gcmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURY
X1RYX1AwXSwgU1BfQVVYX0FERFJfN18wX1JFRywKLQkJCSAgIGFkZHIgJiAweGZmKTsKLQlpZiAo
ZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JZXJyID0gcmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJ
MkNfSURYX1RYX1AwXSwgU1BfQVVYX0FERFJfMTVfOF9SRUcsCi0JCQkgICAoYWRkciAmIDB4ZmYw
MCkgPj4gOCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8qCi0JICogRFAgQVVYIENI
IEFkZHJlc3MgUmVnaXN0ZXIgIzIsIG9ubHkgdXBkYXRlIGJpdHNbMzowXQotCSAqIFs3OjRdIFJF
U0VSVkVECi0JICogWzM6MF0gQVVYX0FERFJbMTk6MTZdLCBSZWdpc3RlciBjb250cm9sIEFVWCBD
SCBhZGRyZXNzLgotCSAqLwotCWVyciA9IHJlZ21hcF91cGRhdGVfYml0cyhhbng3OHh4LT5tYXBb
STJDX0lEWF9UWF9QMF0sCi0JCQkJIFNQX0FVWF9BRERSXzE5XzE2X1JFRywKLQkJCQkgU1BfQVVY
X0FERFJfMTlfMTZfTUFTSywKLQkJCQkgKGFkZHIgJiAweGYwMDAwKSA+PiAxNik7Ci0KLQlpZiAo
ZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBzc2l6ZV90IGFu
eDc4eHhfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCiAJCQkJICAgIHN0cnVj
dCBkcm1fZHBfYXV4X21zZyAqbXNnKQogewogCXN0cnVjdCBhbng3OHh4ICphbng3OHh4ID0gY29u
dGFpbmVyX29mKGF1eCwgc3RydWN0IGFueDc4eHgsIGF1eCk7Ci0JdTggY3RybDEgPSBtc2ctPnJl
cXVlc3Q7Ci0JdTggY3RybDIgPSBTUF9BVVhfRU47Ci0JdTggKmJ1ZmZlciA9IG1zZy0+YnVmZmVy
OwotCWludCBlcnI7Ci0KLQkvKiBUaGUgRFAgQVVYIHRyYW5zbWl0IGFuZCByZWNlaXZlIGJ1ZmZl
ciBoYXMgMTYgYnl0ZXMuICovCi0JaWYgKFdBUk5fT04obXNnLT5zaXplID4gQVVYX0NIX0JVRkZF
Ul9TSVpFKSkKLQkJcmV0dXJuIC1FMkJJRzsKLQotCS8qIFplcm8tc2l6ZWQgbWVzc2FnZXMgc3Bl
Y2lmeSBhZGRyZXNzLW9ubHkgdHJhbnNhY3Rpb25zLiAqLwotCWlmIChtc2ctPnNpemUgPCAxKQot
CQljdHJsMiB8PSBTUF9BRERSX09OTFk7Ci0JZWxzZQkvKiBGb3Igbm9uLXplcm8tc2l6ZWQgc2V0
IHRoZSBsZW5ndGggZmllbGQuICovCi0JCWN0cmwxIHw9IChtc2ctPnNpemUgLSAxKSA8PCBTUF9B
VVhfTEVOR1RIX1NISUZUOwotCi0JaWYgKChtc2ctPnJlcXVlc3QgJiBEUF9BVVhfSTJDX1JFQUQp
ID09IDApIHsKLQkJLyogV2hlbiBXUklURSB8IE1PVCB3cml0ZSB2YWx1ZXMgdG8gZGF0YSBidWZm
ZXIgKi8KLQkJZXJyID0gcmVnbWFwX2J1bGtfd3JpdGUoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhf
UDBdLAotCQkJCQlTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIsCi0JCQkJCW1zZy0+c2l6ZSk7
Ci0JCWlmIChlcnIpCi0JCQlyZXR1cm4gZXJyOwotCX0KLQotCS8qIFdyaXRlIGFkZHJlc3MgYW5k
IHJlcXVlc3QgKi8KLQllcnIgPSBhbng3OHh4X2F1eF9hZGRyZXNzKGFueDc4eHgsIG1zZy0+YWRk
cmVzcyk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWVyciA9IHJlZ21hcF93cml0ZShh
bng3OHh4LT5tYXBbSTJDX0lEWF9UWF9QMF0sIFNQX0RQX0FVWF9DSF9DVFJMMV9SRUcsCi0JCQkg
ICBjdHJsMSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8qIFN0YXJ0IHRyYW5zYWN0
aW9uICovCi0JZXJyID0gcmVnbWFwX3VwZGF0ZV9iaXRzKGFueDc4eHgtPm1hcFtJMkNfSURYX1RY
X1AwXSwKLQkJCQkgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgU1BfQUREUl9PTkxZIHwKLQkJCQkg
U1BfQVVYX0VOLCBjdHJsMik7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWVyciA9IGFu
eDc4eHhfYXV4X3dhaXQoYW54Nzh4eCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCW1z
Zy0+cmVwbHkgPSBEUF9BVVhfSTJDX1JFUExZX0FDSzsKLQotCWlmICgobXNnLT5zaXplID4gMCkg
JiYgKG1zZy0+cmVxdWVzdCAmIERQX0FVWF9JMkNfUkVBRCkpIHsKLQkJLyogUmVhZCB2YWx1ZXMg
ZnJvbSBkYXRhIGJ1ZmZlciAqLwotCQllcnIgPSByZWdtYXBfYnVsa19yZWFkKGFueDc4eHgtPm1h
cFtJMkNfSURYX1RYX1AwXSwKLQkJCQkgICAgICAgU1BfRFBfQlVGX0RBVEEwX1JFRywgYnVmZmVy
LAotCQkJCSAgICAgICBtc2ctPnNpemUpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQl9
Ci0KLQllcnIgPSBhbng3OHh4X2NsZWFyX2JpdHMoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBd
LAotCQkJCSBTUF9EUF9BVVhfQ0hfQ1RSTDJfUkVHLCBTUF9BRERSX09OTFkpOwotCWlmIChlcnIp
Ci0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gbXNnLT5zaXplOworCXJldHVybiBhbnhfZHBfYXV4
X3RyYW5zZmVyKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgbXNnKTsKIH0KIAogc3RhdGlj
IGludCBhbng3OHh4X3NldF9ocGQoc3RydWN0IGFueDc4eHggKmFueDc4eHgpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMgYi9k
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKbmV3IGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5kNjAxNmY3ODlkODAKLS0tIC9kZXYv
bnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1k
cHR4LmMKQEAgLTAsMCArMSwxNzQgQEAKKy8qCisgKiBDb3B5cmlnaHQoYykgMjAxNiwgQW5hbG9n
aXggU2VtaWNvbmR1Y3Rvci4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsg
eW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQorICogaXQgdW5kZXIgdGhlIHRl
cm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2ZXJzaW9uIDIgYW5kCisgKiBv
bmx5IHZlcnNpb24gMiBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlv
bi4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBp
dCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBl
dmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVT
UyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgKiBHTlUgR2VuZXJhbCBQdWJs
aWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorICoKKyAqIEJhc2VkIG9uIGFueDc4MDggZHJp
dmVyIG9idGFpbmVkIGZyb20gY2hyb21lb3Mgd2l0aCBjb3B5cmlnaHQ6CisgKiBDb3B5cmlnaHQo
YykgMjAxMywgR29vZ2xlIEluYy4KKyAqCisgKi8KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4K
KworI2luY2x1ZGUgPGRybS9kcm0uaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RwX2hlbHBlci5oPgor
I2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKworI2luY2x1ZGUgImFuYWxvZ2l4LWkyYy1kcHR4
LmgiCisKKyNkZWZpbmUgQVVYX1dBSVRfVElNRU9VVF9NUwkxNQorI2RlZmluZSBBVVhfQ0hfQlVG
RkVSX1NJWkUJMTYKKworc3RhdGljIGludCBhbnhfaTJjX2RwX2NsZWFyX2JpdHMoc3RydWN0IHJl
Z21hcCAqbWFwLCB1OCByZWcsIHU4IG1hc2spCit7CisJcmV0dXJuIHJlZ21hcF91cGRhdGVfYml0
cyhtYXAsIHJlZywgbWFzaywgMCk7Cit9CisKK3N0YXRpYyBib29sIGFueF9kcF9hdXhfb3BfZmlu
aXNoZWQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJdW5zaWduZWQgaW50IHZhbHVlOwor
CWludCBlcnI7CisKKwllcnIgPSByZWdtYXBfcmVhZChtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NU
UkwyX1JFRywgJnZhbHVlKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0
dXJuICh2YWx1ZSAmIFNQX0FVWF9FTikgPT0gMDsKK30KKworc3RhdGljIGludCBhbnhfZHBfYXV4
X3dhaXQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJdW5zaWduZWQgbG9uZyB0aW1lb3V0
OworCXVuc2lnbmVkIGludCBzdGF0dXM7CisJaW50IGVycjsKKworCXRpbWVvdXQgPSBqaWZmaWVz
ICsgbXNlY3NfdG9famlmZmllcyhBVVhfV0FJVF9USU1FT1VUX01TKSArIDE7CisKKwl3aGlsZSAo
IWFueF9kcF9hdXhfb3BfZmluaXNoZWQobWFwX2RwdHgpKSB7CisJCWlmICh0aW1lX2FmdGVyKGpp
ZmZpZXMsIHRpbWVvdXQpKSB7CisJCQlpZiAoIWFueF9kcF9hdXhfb3BfZmluaXNoZWQobWFwX2Rw
dHgpKSB7CisJCQkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBBVVggdG8gZmluaXNoXG4i
KTsKKwkJCQlyZXR1cm4gLUVUSU1FRE9VVDsKKwkJCX0KKworCQkJYnJlYWs7CisJCX0KKworCQl1
c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisJfQorCisJLyogUmVhZCB0aGUgQVVYIGNoYW5uZWwg
YWNjZXNzIHN0YXR1cyAqLworCWVyciA9IHJlZ21hcF9yZWFkKG1hcF9kcHR4LCBTUF9BVVhfQ0hf
U1RBVFVTX1JFRywgJnN0YXR1cyk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWls
ZWQgdG8gcmVhZCBmcm9tIEFVWCBjaGFubmVsOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsK
Kwl9CisKKwlpZiAoc3RhdHVzICYgU1BfQVVYX1NUQVRVUykgeworCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byB3YWl0IGZvciBBVVggY2hhbm5lbCAoc3RhdHVzOiAlMDJ4KVxuIiwKKwkJCSAgc3RhdHVz
KTsKKwkJcmV0dXJuIC1FVElNRURPVVQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgYW54X2RwX2F1eF9hZGRyZXNzKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LCB1bnNpZ25lZCBp
bnQgYWRkcikKK3sKKwlpbnQgZXJyOworCisJZXJyID0gcmVnbWFwX3dyaXRlKG1hcF9kcHR4LCBT
UF9BVVhfQUREUl83XzBfUkVHLCBhZGRyICYgMHhmZik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVy
cjsKKworCWVyciA9IHJlZ21hcF93cml0ZShtYXBfZHB0eCwgU1BfQVVYX0FERFJfMTVfOF9SRUcs
CisJCQkgICAoYWRkciAmIDB4ZmYwMCkgPj4gOCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsK
KworCS8qCisJICogRFAgQVVYIENIIEFkZHJlc3MgUmVnaXN0ZXIgIzIsIG9ubHkgdXBkYXRlIGJp
dHNbMzowXQorCSAqIFs3OjRdIFJFU0VSVkVECisJICogWzM6MF0gQVVYX0FERFJbMTk6MTZdLCBS
ZWdpc3RlciBjb250cm9sIEFVWCBDSCBhZGRyZXNzLgorCSAqLworCWVyciA9IHJlZ21hcF91cGRh
dGVfYml0cyhtYXBfZHB0eCwgU1BfQVVYX0FERFJfMTlfMTZfUkVHLAorCQkJCSBTUF9BVVhfQURE
Ul8xOV8xNl9NQVNLLAorCQkJCSAoYWRkciAmIDB4ZjAwMDApID4+IDE2KTsKKworCWlmIChlcnIp
CisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gMDsKK30KKworc3NpemVfdCBhbnhfZHBfYXV4X3Ry
YW5zZmVyKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LAorCQkJCXN0cnVjdCBkcm1fZHBfYXV4X21z
ZyAqbXNnKQoreworCXU4IGN0cmwxID0gbXNnLT5yZXF1ZXN0OworCXU4IGN0cmwyID0gU1BfQVVY
X0VOOworCXU4ICpidWZmZXIgPSBtc2ctPmJ1ZmZlcjsKKwlpbnQgZXJyOworCisJLyogVGhlIERQ
IEFVWCB0cmFuc21pdCBhbmQgcmVjZWl2ZSBidWZmZXIgaGFzIDE2IGJ5dGVzLiAqLworCWlmIChX
QVJOX09OKG1zZy0+c2l6ZSA+IEFVWF9DSF9CVUZGRVJfU0laRSkpCisJCXJldHVybiAtRTJCSUc7
CisKKwkvKiBaZXJvLXNpemVkIG1lc3NhZ2VzIHNwZWNpZnkgYWRkcmVzcy1vbmx5IHRyYW5zYWN0
aW9ucy4gKi8KKwlpZiAobXNnLT5zaXplIDwgMSkKKwkJY3RybDIgfD0gU1BfQUREUl9PTkxZOwor
CWVsc2UJLyogRm9yIG5vbi16ZXJvLXNpemVkIHNldCB0aGUgbGVuZ3RoIGZpZWxkLiAqLworCQlj
dHJsMSB8PSAobXNnLT5zaXplIC0gMSkgPDwgU1BfQVVYX0xFTkdUSF9TSElGVDsKKworCWlmICgo
bXNnLT5yZXF1ZXN0ICYgRFBfQVVYX0kyQ19SRUFEKSA9PSAwKSB7CisJCS8qIFdoZW4gV1JJVEUg
fCBNT1Qgd3JpdGUgdmFsdWVzIHRvIGRhdGEgYnVmZmVyICovCisJCWVyciA9IHJlZ21hcF9idWxr
X3dyaXRlKG1hcF9kcHR4LAorCQkJCQlTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIsCisJCQkJ
CW1zZy0+c2l6ZSk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFdyaXRl
IGFkZHJlc3MgYW5kIHJlcXVlc3QgKi8KKwllcnIgPSBhbnhfZHBfYXV4X2FkZHJlc3MobWFwX2Rw
dHgsIG1zZy0+YWRkcmVzcyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJl
Z21hcF93cml0ZShtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwxX1JFRywgY3RybDEpOworCWlm
IChlcnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBTdGFydCB0cmFuc2FjdGlvbiAqLworCWVyciA9
IHJlZ21hcF91cGRhdGVfYml0cyhtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKKwkJ
CQkgU1BfQUREUl9PTkxZIHwgU1BfQVVYX0VOLCBjdHJsMik7CisJaWYgKGVycikKKwkJcmV0dXJu
IGVycjsKKworCWVyciA9IGFueF9kcF9hdXhfd2FpdChtYXBfZHB0eCk7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCW1zZy0+cmVwbHkgPSBEUF9BVVhfSTJDX1JFUExZX0FDSzsKKworCWlm
ICgobXNnLT5zaXplID4gMCkgJiYgKG1zZy0+cmVxdWVzdCAmIERQX0FVWF9JMkNfUkVBRCkpIHsK
KwkJLyogUmVhZCB2YWx1ZXMgZnJvbSBkYXRhIGJ1ZmZlciAqLworCQllcnIgPSByZWdtYXBfYnVs
a19yZWFkKG1hcF9kcHR4LAorCQkJCSAgICAgICBTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIs
CisJCQkJICAgICAgIG1zZy0+c2l6ZSk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0K
KworCWVyciA9IGFueF9pMmNfZHBfY2xlYXJfYml0cyhtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NU
UkwyX1JFRywKKwkJCQkgICAgU1BfQUREUl9PTkxZKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJy
OworCisJcmV0dXJuIG1zZy0+c2l6ZTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKGFueF9kcF9hdXhf
dHJhbnNmZXIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9h
bmFsb2dpeC1pMmMtZHB0eC5oIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFs
b2dpeC1pMmMtZHB0eC5oCmluZGV4IDVhNTRjNmQ4NjQyOC4uMzA0MzZjODhmMTgxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5o
CkBAIC0yNTMsNCArMjUzLDcgQEAKIC8qIERQIEFVWCBCdWZmZXIgRGF0YSBSZWdpc3RlcnMgKi8K
ICNkZWZpbmUgU1BfRFBfQlVGX0RBVEEwX1JFRwkJMHhmMAogCitzc2l6ZV90IGFueF9kcF9hdXhf
dHJhbnNmZXIoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgsCisJCQkJc3RydWN0IGRybV9kcF9hdXhf
bXNnICptc2cpOworCiAjZW5kaWYKLS0gCjIuMTYuNAoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
