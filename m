Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2A2D11F6A7
	for <lists+dri-devel@lfdr.de>; Wed, 15 May 2019 16:38:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7BC47892B4;
	Wed, 15 May 2019 14:38:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 22027892A9
 for <dri-devel@lists.freedesktop.org>; Wed, 15 May 2019 14:38:35 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id 198so290883wme.3
 for <dri-devel@lists.freedesktop.org>; Wed, 15 May 2019 07:38:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=MUxqXAjKYP9ZGOD1AaUQj59OmiYCU9V3HJ1PygZ3UrE=;
 b=IcYWhMThJXYE4eh6FgSeN0ltMH7/RtV+/IW71EtqUBQMhWMZNBexHVL8pFBzmuoFZC
 yN9UxVdSj1/KuPPs8kEnDjcpRNy2sy3QSDZbKPUYDYkvGyms84LKZoo52ZVb7XgJILtq
 To6Nkog4Ooo1b6sxAQK3xxRWR7i0qNczpQcTmDgiZfsU96fxCTnyA6j5zGJosztptotO
 GDflLM8NA2KjeDZQP/xhUdXkBhmUGMYmyu9s2QvKN25jQZSJFGeUC/crZCp2WatFMyZk
 mV4ku3hyDwnaLqyxAfi8VmLhG7un+XvAxo6pQWSdis4putmz4f6Wg6WJVD5OmfFejiY+
 GsgA==
X-Gm-Message-State: APjAAAU6EoI+nOJbvp3Yuadp+8HNLTf8pnxtOeijGxJvo87mK9urC7Vd
 BW808QgfsEcn3mp2unjE8hfFic1n
X-Google-Smtp-Source: APXvYqw3mGxPYwLeereCUdD0ZKRxiFhwLs20GQy3Mp87z3fNfRnpu7dJP0UujV365ljAT3DQIAAIag==
X-Received: by 2002:a1c:9904:: with SMTP id b4mr13470166wme.1.1557931113627;
 Wed, 15 May 2019 07:38:33 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:fd02:5db:d141:8a62])
 by smtp.gmail.com with ESMTPSA id w7sm2606895wmm.16.2019.05.15.07.38.32
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 15 May 2019 07:38:32 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: daniel@ffwll.ch,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 1/6] dma-buf: add dynamic DMA-buf handling v8
Date: Wed, 15 May 2019 16:38:26 +0200
Message-Id: <20190515143831.1639-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=MUxqXAjKYP9ZGOD1AaUQj59OmiYCU9V3HJ1PygZ3UrE=;
 b=YgWzM9ZxspFCvj7YIjK1/qnPXT1u9IttX0ZXIMxol5kR0H0iQoBOfGPJNQ14K21XGU
 oiyIg9WOHhQkp6Y8FwUaS7S9RSyQLrRAalOa+E18wxZuGh2A2kkDB0CAHV6DhEEu1ThG
 84a8MfDkoJKEr27I2iixCrMqgoOYoLUyTV/iBhfGd4brxAB1LiyusZgjKsley0R6sdBy
 KMYMM+E6RjJ1GA95epCy1/Phcrht/G3wAUnV7y74dKBvbfBir0kOliUPbMvIlaGgOoNR
 ky31mrJ5ppR7S9R1/xUq3pANnrScAqEnOaj7GheOwnMjFnSYjzmSFuyvmaeeHezrjEMf
 bTNg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gdGhlIGV4cG9ydGVyIHNpZGUgd2UgYWRkIG9wdGlvbmFsIGV4cGxpY2l0IHBpbm5pbmcgY2Fs
bGJhY2tzLiBJZiB0aG9zZQpjYWxsYmFja3MgYXJlIGltcGxlbWVudGVkIHRoZSBmcmFtZXdvcmsg
bm8gbG9uZ2VyIGNhY2hlcyBzZyB0YWJsZXMgYW5kIHRoZQptYXAvdW5tYXAgY2FsbGJhY2tzIGFy
ZSBhbHdheXMgY2FsbGVkIHdpdGggdGhlIGxvY2sgb2YgdGhlIHJlc2VydmF0aW9uIG9iamVjdApo
ZWxkLgoKT24gdGhlIGltcG9ydGVyIHNpZGUgd2UgYWRkIGFuIG9wdGlvbmFsIGludmFsaWRhdGUg
Y2FsbGJhY2suIFRoaXMgY2FsbGJhY2sgaXMKdXNlZCBieSB0aGUgZXhwb3J0ZXIgdG8gaW5mb3Jt
IHRoZSBpbXBvcnRlcnMgdGhhdCB0aGVpciBtYXBwaW5ncyBzaG91bGQgYmUKZGVzdHJveWVkIGFz
IHNvb24gYXMgcG9zc2libGUuCgpUaGlzIGFsbG93cyB0aGUgZXhwb3J0ZXIgdG8gcHJvdmlkZSB0
aGUgbWFwcGluZ3Mgd2l0aG91dCB0aGUgbmVlZCB0byBwaW4KdGhlIGJhY2tpbmcgc3RvcmUuCgp2
MjogZG9uJ3QgdHJ5IHRvIGludmFsaWRhdGUgbWFwcGluZ3Mgd2hlbiB0aGUgY2FsbGJhY2sgaXMg
TlVMTCwKICAgIGxvY2sgdGhlIHJlc2VydmF0aW9uIG9iaiB3aGlsZSB1c2luZyB0aGUgYXR0YWNo
bWVudHMsCiAgICBhZGQgaGVscGVyIHRvIHNldCB0aGUgY2FsbGJhY2sKdjM6IG1vdmUgZmxhZyBm
b3IgaW52YWxpZGF0aW9uIHN1cHBvcnQgaW50byB0aGUgRE1BLWJ1ZiwKICAgIHVzZSBuZXcgYXR0
YWNoX2luZm8gc3RydWN0dXJlIHRvIHNldCB0aGUgY2FsbGJhY2sKdjQ6IHVzZSBpbXBvcnRlcl9w
cml2IGZpZWxkIGluc3RlYWQgb2YgbWFuZ2xpbmcgZXhwb3J0ZXIgcHJpdi4KdjU6IGRyb3AgaW52
YWxpZGF0aW9uX3N1cHBvcnRlZCBmbGFnCnY2OiBzcXVhc2ggdG9nZXRoZXIgd2l0aCBwaW4vdW5w
aW4gY2hhbmdlcwp2NzogcGluL3VucGluIHRha2VzIGFuIGF0dGFjaG1lbnQgbm93CnY4OiBudWtl
IGRtYV9idWZfYXR0YWNobWVudF8obWFwfHVubWFwKV9sb2NrZWQsCiAgICBldmVyeXRoaW5nIGlz
IG5vdyBoYW5kbGVkIGJhY2t3YXJkIGNvbXBhdGlibGUKClNpZ25lZC1vZmYtYnk6IENocmlzdGlh
biBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2RtYS1idWYv
ZG1hLWJ1Zi5jIHwgMTU3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tCiBp
bmNsdWRlL2xpbnV4L2RtYS1idWYuaCAgIHwgMTA5ICsrKysrKysrKysrKysrKysrKysrKysrKy0t
CiAyIGZpbGVzIGNoYW5nZWQsIDI1MyBpbnNlcnRpb25zKCspLCAxMyBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jIGIvZHJpdmVycy9kbWEtYnVmL2Rt
YS1idWYuYwppbmRleCBhMmQzNGM2YjgwYTUuLjg1MDI2ZDllOTc4ZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9kbWEtYnVmL2RtYS1idWYuYworKysgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jCkBA
IC00MDksNiArNDA5LDkgQEAgc3RydWN0IGRtYV9idWYgKmRtYV9idWZfZXhwb3J0KGNvbnN0IHN0
cnVjdCBkbWFfYnVmX2V4cG9ydF9pbmZvICpleHBfaW5mbykKIAkJcmV0dXJuIEVSUl9QVFIoLUVJ
TlZBTCk7CiAJfQogCisJaWYgKFdBUk5fT04oZXhwX2luZm8tPm9wcy0+Y2FjaGVfc2d0X21hcHBp
bmcgJiYgZXhwX2luZm8tPm9wcy0+cGluKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisK
IAlpZiAoIXRyeV9tb2R1bGVfZ2V0KGV4cF9pbmZvLT5vd25lcikpCiAJCXJldHVybiBFUlJfUFRS
KC1FTk9FTlQpOwogCkBAIC01MzAsMTAgKzUzMywxMiBAQCB2b2lkIGRtYV9idWZfcHV0KHN0cnVj
dCBkbWFfYnVmICpkbWFidWYpCiBFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX3B1dCk7CiAKIC8q
KgotICogZG1hX2J1Zl9hdHRhY2ggLSBBZGQgdGhlIGRldmljZSB0byBkbWFfYnVmJ3MgYXR0YWNo
bWVudHMgbGlzdDsgb3B0aW9uYWxseSwKKyAqIGRtYV9idWZfZHluYW1pY19hdHRhY2ggLSBBZGQg
dGhlIGRldmljZSB0byBkbWFfYnVmJ3MgYXR0YWNobWVudHMgbGlzdDsgb3B0aW9uYWxseSwKICAq
IGNhbGxzIGF0dGFjaCgpIG9mIGRtYV9idWZfb3BzIHRvIGFsbG93IGRldmljZS1zcGVjaWZpYyBh
dHRhY2ggZnVuY3Rpb25hbGl0eQotICogQGRtYWJ1ZjoJW2luXQlidWZmZXIgdG8gYXR0YWNoIGRl
dmljZSB0by4KLSAqIEBkZXY6CVtpbl0JZGV2aWNlIHRvIGJlIGF0dGFjaGVkLgorICogQGRtYWJ1
ZjoJCVtpbl0JYnVmZmVyIHRvIGF0dGFjaCBkZXZpY2UgdG8uCisgKiBAZGV2OgkJW2luXQlkZXZp
Y2UgdG8gYmUgYXR0YWNoZWQuCisgKiBAaW1wb3J0ZXJfb3BzCVtpbl0JaW1wb3J0ZXIgb3BlcmF0
aW9ucyBmb3IgdGhlIGF0dGFjaG1lbnQKKyAqIEBpbXBvcnRlcl9wcml2CVtpbl0JaW1wb3J0ZXIg
cHJpdmF0ZSBwb2ludGVyIGZvciB0aGUgYXR0YWNobWVudAogICoKICAqIFJldHVybnMgc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCBwb2ludGVyIGZvciB0aGlzIGF0dGFjaG1lbnQuIEF0dGFjaG1l
bnRzCiAgKiBtdXN0IGJlIGNsZWFuZWQgdXAgYnkgY2FsbGluZyBkbWFfYnVmX2RldGFjaCgpLgpA
QCAtNTQ3LDggKzU1MiwxMCBAQCBFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX3B1dCk7CiAgKiBh
Y2Nlc3NpYmxlIHRvIEBkZXYsIGFuZCBjYW5ub3QgYmUgbW92ZWQgdG8gYSBtb3JlIHN1aXRhYmxl
IHBsYWNlLiBUaGlzIGlzCiAgKiBpbmRpY2F0ZWQgd2l0aCB0aGUgZXJyb3IgY29kZSAtRUJVU1ku
CiAgKi8KLXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmRtYV9idWZfYXR0YWNoKHN0cnVjdCBk
bWFfYnVmICpkbWFidWYsCi0JCQkJCSAgc3RydWN0IGRldmljZSAqZGV2KQorc3RydWN0IGRtYV9i
dWZfYXR0YWNobWVudCAqCitkbWFfYnVmX2R5bmFtaWNfYXR0YWNoKHN0cnVjdCBkbWFfYnVmICpk
bWFidWYsIHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBkbWFfYnVm
X2F0dGFjaF9vcHMgKmltcG9ydGVyX29wcywKKwkJICAgICAgIHZvaWQgKmltcG9ydGVyX3ByaXYp
CiB7CiAJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOwogCWludCByZXQ7CkBAIC01
NjIsNiArNTY5LDggQEAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqZG1hX2J1Zl9hdHRhY2go
c3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKIAogCWF0dGFjaC0+ZGV2ID0gZGV2OwogCWF0dGFjaC0+
ZG1hYnVmID0gZG1hYnVmOworCWF0dGFjaC0+aW1wb3J0ZXJfb3BzID0gaW1wb3J0ZXJfb3BzOwor
CWF0dGFjaC0+aW1wb3J0ZXJfcHJpdiA9IGltcG9ydGVyX3ByaXY7CiAKIAltdXRleF9sb2NrKCZk
bWFidWYtPmxvY2spOwogCkBAIC01NzAsMTAgKzU3OSwzMSBAQCBzdHJ1Y3QgZG1hX2J1Zl9hdHRh
Y2htZW50ICpkbWFfYnVmX2F0dGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAogCQlpZiAocmV0
KQogCQkJZ290byBlcnJfYXR0YWNoOwogCX0KKwlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhkbWFi
dWYtPnJlc3YsIE5VTEwpOwogCWxpc3RfYWRkKCZhdHRhY2gtPm5vZGUsICZkbWFidWYtPmF0dGFj
aG1lbnRzKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGRtYWJ1Zi0+cmVzdik7CiAKIAlt
dXRleF91bmxvY2soJmRtYWJ1Zi0+bG9jayk7CiAKKwkvKiBXaGVuIHRoZSBpbXBvcnRlciBpcyBk
eW5hbWljIGJ1dCB0aGUgZXhwb3J0ZXIgaXNuJ3Qgd2UgbmVlZCB0byBjYWNoZQorCSAqIHRoZSBt
YXBwaW5nIG9yIG90aGVyd2lzZSB3b3VsZCBydW4gaW50byBpc3N1ZXMgd2l0aCB0aGUgcmVzZXJ2
YXRpb24KKwkgKiBvYmplY3QgbG9jay4KKwkgKi8KKwlpZiAoZG1hX2J1Zl9hdHRhY2htZW50X2lz
X2R5bmFtaWMoYXR0YWNoKSAmJgorCSAgICAhZG1hX2J1Zl9pc19keW5hbWljKGRtYWJ1ZikpIHsK
KwkJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisKKwkJc2d0ID0gZG1hYnVmLT5vcHMtPm1hcF9kbWFf
YnVmKGF0dGFjaCwgRE1BX0JJRElSRUNUSU9OQUwpOworCQlpZiAoIXNndCkKKwkJCXNndCA9IEVS
Ul9QVFIoLUVOT01FTSk7CisJCWlmIChJU19FUlIoc2d0KSkgeworCQkJZG1hX2J1Zl9kZXRhY2go
ZG1hYnVmLCBhdHRhY2gpOworCQkJcmV0dXJuIEVSUl9DQVNUKHNndCk7CisJCX0KKwkJYXR0YWNo
LT5zZ3QgPSBzZ3Q7CisJCWF0dGFjaC0+ZGlyID0gRE1BX0JJRElSRUNUSU9OQUw7CisJfQorCiAJ
cmV0dXJuIGF0dGFjaDsKIAogZXJyX2F0dGFjaDoKQEAgLTU4MSw2ICs2MTEsMjEgQEAgc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqZG1hX2J1Zl9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1
ZiwKIAltdXRleF91bmxvY2soJmRtYWJ1Zi0+bG9jayk7CiAJcmV0dXJuIEVSUl9QVFIocmV0KTsK
IH0KK0VYUE9SVF9TWU1CT0xfR1BMKGRtYV9idWZfZHluYW1pY19hdHRhY2gpOworCisvKioKKyAq
IGRtYV9idWZfYXR0YWNoIC0gV3JhcHBlciBmb3IgZG1hX2J1Zl9keW5hbWljX2F0dGFjaAorICog
QGRtYWJ1ZjoJW2luXQlidWZmZXIgdG8gYXR0YWNoIGRldmljZSB0by4KKyAqIEBkZXY6CVtpbl0J
ZGV2aWNlIHRvIGJlIGF0dGFjaGVkLgorICoKKyAqIFdyYXBwZXIgdG8gY2FsbCBkbWFfYnVmX2R5
bmFtaWNfYXR0YWNoKCkgZm9yIGRyaXZlcnMgd2hpY2ggc3RpbGwgdXNlIGEgc3RhdGljCisgKiBt
YXBwaW5nLgorICovCitzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICpkbWFfYnVmX2F0dGFjaChz
dHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAorCQkJCQkgIHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwly
ZXR1cm4gZG1hX2J1Zl9keW5hbWljX2F0dGFjaChkbWFidWYsIGRldiwgTlVMTCwgTlVMTCk7Cit9
CiBFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX2F0dGFjaCk7CiAKIC8qKgpAQCAtNjAwLDcgKzY0
NSw5IEBAIHZvaWQgZG1hX2J1Zl9kZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQogCQlkbWFidWYtPm9wcy0+dW5tYXBfZG1hX2J1
ZihhdHRhY2gsIGF0dGFjaC0+c2d0LCBhdHRhY2gtPmRpcik7CiAKIAltdXRleF9sb2NrKCZkbWFi
dWYtPmxvY2spOworCXJlc2VydmF0aW9uX29iamVjdF9sb2NrKGRtYWJ1Zi0+cmVzdiwgTlVMTCk7
CiAJbGlzdF9kZWwoJmF0dGFjaC0+bm9kZSk7CisJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jayhk
bWFidWYtPnJlc3YpOwogCWlmIChkbWFidWYtPm9wcy0+ZGV0YWNoKQogCQlkbWFidWYtPm9wcy0+
ZGV0YWNoKGRtYWJ1ZiwgYXR0YWNoKTsKIApAQCAtNjA5LDYgKzY1Niw0NCBAQCB2b2lkIGRtYV9i
dWZfZGV0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1l
bnQgKmF0dGFjaCkKIH0KIEVYUE9SVF9TWU1CT0xfR1BMKGRtYV9idWZfZGV0YWNoKTsKIAorLyoq
CisgKiBkbWFfYnVmX3BpbiAtIExvY2sgZG93biB0aGUgRE1BLWJ1ZgorICoKKyAqIEBhdHRhY2g6
CVtpbl0JYXR0YWNobWVudCB3aGljaCBzaG91bGQgYmUgcGlubmVkCisgKgorICogUmV0dXJuczoK
KyAqIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBmYWlsdXJlLgorICovCitp
bnQgZG1hX2J1Zl9waW4oc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQoreworCXN0
cnVjdCBkbWFfYnVmICpkbWFidWYgPSBhdHRhY2gtPmRtYWJ1ZjsKKwlpbnQgcmV0ID0gMDsKKwor
CXJlc2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZChkbWFidWYtPnJlc3YpOworCisJaWYgKGRt
YWJ1Zi0+b3BzLT5waW4pCisJCXJldCA9IGRtYWJ1Zi0+b3BzLT5waW4oYXR0YWNoKTsKKworCXJl
dHVybiByZXQ7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX3Bpbik7CisKKy8qKgorICog
ZG1hX2J1Zl91bnBpbiAtIFJlbW92ZSBsb2NrIGZyb20gRE1BLWJ1ZgorICoKKyAqIEBhdHRhY2g6
CVtpbl0JYXR0YWNobWVudCB3aGljaCBzaG91bGQgYmUgdW5waW5uZWQKKyAqLwordm9pZCBkbWFf
YnVmX3VucGluKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCkKK3sKKwlzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hYnVmID0gYXR0YWNoLT5kbWFidWY7CisKKwlyZXNlcnZhdGlvbl9vYmplY3Rf
YXNzZXJ0X2hlbGQoZG1hYnVmLT5yZXN2KTsKKworCWlmIChkbWFidWYtPm9wcy0+dW5waW4pCisJ
CWRtYWJ1Zi0+b3BzLT51bnBpbihhdHRhY2gpOworfQorRVhQT1JUX1NZTUJPTF9HUEwoZG1hX2J1
Zl91bnBpbik7CisKIC8qKgogICogZG1hX2J1Zl9tYXBfYXR0YWNobWVudCAtIFJldHVybnMgdGhl
IHNjYXR0ZXJsaXN0IHRhYmxlIG9mIHRoZSBhdHRhY2htZW50OwogICogbWFwcGVkIGludG8gX2Rl
dmljZV8gYWRkcmVzcyBzcGFjZS4gSXMgYSB3cmFwcGVyIGZvciBtYXBfZG1hX2J1ZigpIG9mIHRo
ZQpAQCAtNjI4LDYgKzcxMyw3IEBAIHN0cnVjdCBzZ190YWJsZSAqZG1hX2J1Zl9tYXBfYXR0YWNo
bWVudChzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCiAJCQkJCWVudW0gZG1hX2Rh
dGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKIHsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnNnX3RhYmxlOwor
CWludCByOwogCiAJbWlnaHRfc2xlZXAoKTsKIApAQCAtNjQ2LDEwICs3MzIsMzggQEAgc3RydWN0
IHNnX3RhYmxlICpkbWFfYnVmX21hcF9hdHRhY2htZW50KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1l
bnQgKmF0dGFjaCwKIAkJcmV0dXJuIGF0dGFjaC0+c2d0OwogCX0KIAorCWlmIChkbWFfYnVmX2F0
dGFjaG1lbnRfaXNfZHluYW1pYyhhdHRhY2gpKSB7CisJCXJlc2VydmF0aW9uX29iamVjdF9hc3Nl
cnRfaGVsZChhdHRhY2gtPmRtYWJ1Zi0+cmVzdik7CisKKwkJLyoKKwkJICogTWFwcGluZyBhIERN
QS1idWYgY2FuIHRyaWdnZXIgaXRzIGludmFsaWRhdGlvbiwgcHJldmVudAorCQkgKiBzZW5kaW5n
IHRoaXMgZXZlbnQgdG8gdGhlIGNhbGxlciBieSB0ZW1wb3JhcnkgcmVtb3ZpbmcKKwkJICogdGhp
cyBhdHRhY2htZW50IGZyb20gdGhlIGxpc3QuCisJCSAqLworCQlsaXN0X2RlbCgmYXR0YWNoLT5u
b2RlKTsKKworCX0gZWxzZSBpZiAoZG1hX2J1Zl9pc19keW5hbWljKGF0dGFjaC0+ZG1hYnVmKSkg
eworCQlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhhdHRhY2gtPmRtYWJ1Zi0+cmVzdiwgTlVMTCk7
CisJCXIgPSBkbWFfYnVmX3BpbihhdHRhY2gpOworCQlpZiAocikgeworCQkJcmVzZXJ2YXRpb25f
b2JqZWN0X3VubG9jayhhdHRhY2gtPmRtYWJ1Zi0+cmVzdik7CisJCQlyZXR1cm4gRVJSX1BUUihy
KTsKKwkJfQorCX0KKwogCXNnX3RhYmxlID0gYXR0YWNoLT5kbWFidWYtPm9wcy0+bWFwX2RtYV9i
dWYoYXR0YWNoLCBkaXJlY3Rpb24pOwogCWlmICghc2dfdGFibGUpCiAJCXNnX3RhYmxlID0gRVJS
X1BUUigtRU5PTUVNKTsKIAorCWlmIChkbWFfYnVmX2F0dGFjaG1lbnRfaXNfZHluYW1pYyhhdHRh
Y2gpKSB7CisJCWxpc3RfYWRkKCZhdHRhY2gtPm5vZGUsICZhdHRhY2gtPmRtYWJ1Zi0+YXR0YWNo
bWVudHMpOworCisJfSBlbHNlIGlmIChkbWFfYnVmX2lzX2R5bmFtaWMoYXR0YWNoLT5kbWFidWYp
KSB7CisJCWlmIChJU19FUlIoc2dfdGFibGUpKQorCQkJZG1hX2J1Zl91bnBpbihhdHRhY2gpOwor
CQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsKKwl9CisK
IAlpZiAoIUlTX0VSUihzZ190YWJsZSkgJiYgYXR0YWNoLT5kbWFidWYtPm9wcy0+Y2FjaGVfc2d0
X21hcHBpbmcpIHsKIAkJYXR0YWNoLT5zZ3QgPSBzZ190YWJsZTsKIAkJYXR0YWNoLT5kaXIgPSBk
aXJlY3Rpb247CkBAIC02ODEsMTAgKzc5NSw0MSBAQCB2b2lkIGRtYV9idWZfdW5tYXBfYXR0YWNo
bWVudChzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCiAJaWYgKGF0dGFjaC0+c2d0
ID09IHNnX3RhYmxlKQogCQlyZXR1cm47CiAKKwlpZiAoZG1hX2J1Zl9hdHRhY2htZW50X2lzX2R5
bmFtaWMoYXR0YWNoKSkKKwkJcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGF0dGFjaC0+
ZG1hYnVmLT5yZXN2KTsKKwllbHNlIGlmIChkbWFfYnVmX2lzX2R5bmFtaWMoYXR0YWNoLT5kbWFi
dWYpKQorCQlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhhdHRhY2gtPmRtYWJ1Zi0+cmVzdiwgTlVM
TCk7CisKIAlhdHRhY2gtPmRtYWJ1Zi0+b3BzLT51bm1hcF9kbWFfYnVmKGF0dGFjaCwgc2dfdGFi
bGUsIGRpcmVjdGlvbik7CisKKwlpZiAoZG1hX2J1Zl9pc19keW5hbWljKGF0dGFjaC0+ZG1hYnVm
KSAmJgorCSAgICAhZG1hX2J1Zl9hdHRhY2htZW50X2lzX2R5bmFtaWMoYXR0YWNoKSkgeworCQlk
bWFfYnVmX3VucGluKGF0dGFjaCk7CisJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYXR0YWNo
LT5kbWFidWYtPnJlc3YpOworCX0KIH0KIEVYUE9SVF9TWU1CT0xfR1BMKGRtYV9idWZfdW5tYXBf
YXR0YWNobWVudCk7CiAKKy8qKgorICogZG1hX2J1Zl9pbnZhbGlkYXRlX21hcHBpbmdzIC0gaW52
YWxpZGF0ZSBhbGwgbWFwcGluZ3Mgb2YgdGhpcyBkbWFfYnVmCisgKgorICogQGRtYWJ1ZjoJW2lu
XQlidWZmZXIgd2hpY2ggbWFwcGluZ3Mgc2hvdWxkIGJlIGludmFsaWRhdGVkCisgKgorICogSW5m
b3JtcyBhbGwgYXR0YWNobWVuc3QgdGhhdCB0aGV5IG5lZWQgdG8gZGVzdHJveSBhbmQgcmVjcmVh
dGVkIGFsbCB0aGVpcgorICogbWFwcGluZ3MuCisgKi8KK3ZvaWQgZG1hX2J1Zl9pbnZhbGlkYXRl
X21hcHBpbmdzKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCit7CisJc3RydWN0IGRtYV9idWZfYXR0
YWNobWVudCAqYXR0YWNoOworCisJcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGRtYWJ1
Zi0+cmVzdik7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGF0dGFjaCwgJmRtYWJ1Zi0+YXR0YWNo
bWVudHMsIG5vZGUpCisJCWlmIChhdHRhY2gtPmltcG9ydGVyX29wcyAmJiBhdHRhY2gtPmltcG9y
dGVyX29wcy0+aW52YWxpZGF0ZSkKKwkJCWF0dGFjaC0+aW1wb3J0ZXJfb3BzLT5pbnZhbGlkYXRl
KGF0dGFjaCk7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX2ludmFsaWRhdGVfbWFwcGlu
Z3MpOworCiAvKioKICAqIERPQzogY3B1IGFjY2VzcwogICoKQEAgLTEwOTcsMTAgKzEyNDIsMTIg
QEAgc3RhdGljIGludCBkbWFfYnVmX2RlYnVnX3Nob3coc3RydWN0IHNlcV9maWxlICpzLCB2b2lk
ICp1bnVzZWQpCiAJCXNlcV9wdXRzKHMsICJcdEF0dGFjaGVkIERldmljZXM6XG4iKTsKIAkJYXR0
YWNoX2NvdW50ID0gMDsKIAorCQlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhidWZfb2JqLT5yZXN2
LCBOVUxMKTsKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeShhdHRhY2hfb2JqLCAmYnVmX29iai0+YXR0
YWNobWVudHMsIG5vZGUpIHsKIAkJCXNlcV9wcmludGYocywgIlx0JXNcbiIsIGRldl9uYW1lKGF0
dGFjaF9vYmotPmRldikpOwogCQkJYXR0YWNoX2NvdW50Kys7CiAJCX0KKwkJcmVzZXJ2YXRpb25f
b2JqZWN0X3VubG9jayhidWZfb2JqLT5yZXN2KTsKIAogCQlzZXFfcHJpbnRmKHMsICJUb3RhbCAl
ZCBkZXZpY2VzIGF0dGFjaGVkXG5cbiIsCiAJCQkJYXR0YWNoX2NvdW50KTsKZGlmZiAtLWdpdCBh
L2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5oIGIvaW5jbHVkZS9saW51eC9kbWEtYnVmLmgKaW5kZXgg
NDViOTc2N2U2N2VjLi41MzA5ZjFjZWFlZmUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvZG1h
LWJ1Zi5oCisrKyBiL2luY2x1ZGUvbGludXgvZG1hLWJ1Zi5oCkBAIC05OSwxNCArOTksNDAgQEAg
c3RydWN0IGRtYV9idWZfb3BzIHsKIAkgKi8KIAl2b2lkICgqZGV0YWNoKShzdHJ1Y3QgZG1hX2J1
ZiAqLCBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICopOwogCisJLyoqCisJICogQHBpbjoKKwkg
KgorCSAqIFRoaXMgaXMgY2FsbGVkIGJ5IGRtYV9idWZfcGluIGFuZCBsZXRzIHRoZSBleHBvcnRl
ciBrbm93IHRoYXQgdGhlCisJICogRE1BLWJ1ZiBjYW4ndCBiZSBtb3ZlZCBhbnkgbW9yZS4KKwkg
KgorCSAqIFRoaXMgaXMgY2FsbGVkIHdpdGggdGhlIGRtYWJ1Zi0+cmVzdiBvYmplY3QgbG9ja2Vk
LgorCSAqCisJICogVGhpcyBjYWxsYmFjayBpcyBvcHRpb25hbC4KKwkgKgorCSAqIFJldHVybnM6
CisJICoKKwkgKiAwIG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4K
KwkgKi8KKwlpbnQgKCpwaW4pKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKik7CisKKwkvKioK
KwkgKiBAdW5waW46CisJICoKKwkgKiBUaGlzIGlzIGNhbGxlZCBieSBkbWFfYnVmX3VucGluIGFu
ZCBsZXRzIHRoZSBleHBvcnRlciBrbm93IHRoYXQgdGhlCisJICogRE1BLWJ1ZiBjYW4gYmUgbW92
ZWQgYWdhaW4uCisJICoKKwkgKiBUaGlzIGlzIGNhbGxlZCB3aXRoIHRoZSBkbWFidWYtPnJlc3Yg
b2JqZWN0IGxvY2tlZC4KKwkgKgorCSAqIFRoaXMgY2FsbGJhY2sgaXMgb3B0aW9uYWwuCisJICov
CisJdm9pZCAoKnVucGluKShzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICopOworCiAJLyoqCiAJ
ICogQG1hcF9kbWFfYnVmOgogCSAqCiAJICogVGhpcyBpcyBjYWxsZWQgYnkgZG1hX2J1Zl9tYXBf
YXR0YWNobWVudCgpIGFuZCBpcyB1c2VkIHRvIG1hcCBhCiAJICogc2hhcmVkICZkbWFfYnVmIGlu
dG8gZGV2aWNlIGFkZHJlc3Mgc3BhY2UsIGFuZCBpdCBpcyBtYW5kYXRvcnkuIEl0Ci0JICogY2Fu
IG9ubHkgYmUgY2FsbGVkIGlmIEBhdHRhY2ggaGFzIGJlZW4gY2FsbGVkIHN1Y2Nlc3NmdWxseS4g
VGhpcwotCSAqIGVzc2VudGlhbGx5IHBpbnMgdGhlIERNQSBidWZmZXIgaW50byBwbGFjZSwgYW5k
IGl0IGNhbm5vdCBiZSBtb3ZlZAotCSAqIGFueSBtb3JlCisJICogY2FuIG9ubHkgYmUgY2FsbGVk
IGlmIEBhdHRhY2ggaGFzIGJlZW4gY2FsbGVkIHN1Y2Nlc3NmdWxseS4KIAkgKgogCSAqIFRoaXMg
Y2FsbCBtYXkgc2xlZXAsIGUuZy4gd2hlbiB0aGUgYmFja2luZyBzdG9yYWdlIGZpcnN0IG5lZWRz
IHRvIGJlCiAJICogYWxsb2NhdGVkLCBvciBtb3ZlZCB0byBhIGxvY2F0aW9uIHN1aXRhYmxlIGZv
ciBhbGwgY3VycmVudGx5IGF0dGFjaGVkCkBAIC0xMjcsNiArMTUzLDkgQEAgc3RydWN0IGRtYV9i
dWZfb3BzIHsKIAkgKiBhbnkgb3RoZXIga2luZCBvZiBzaGFyaW5nIHRoYXQgdGhlIGV4cG9ydGVy
IG1pZ2h0IHdpc2ggdG8gbWFrZQogCSAqIGF2YWlsYWJsZSB0byBidWZmZXItdXNlcnMuCiAJICoK
KwkgKiBUaGlzIGlzIGFsd2F5cyBjYWxsZWQgd2l0aCB0aGUgZG1hYnVmLT5yZXN2IG9iamVjdCBs
b2NrZWQgd2hlbgorCSAqIHRoZSBwaW4vdW5waW4gY2FsbGJhY2tzIGFyZSBpbXBsZW1lbnRlZC4K
KwkgKgogCSAqIFJldHVybnM6CiAJICoKIAkgKiBBICZzZ190YWJsZSBzY2F0dGVyIGxpc3Qgb2Yg
b3IgdGhlIGJhY2tpbmcgc3RvcmFnZSBvZiB0aGUgRE1BIGJ1ZmZlciwKQEAgLTE0NCw5ICsxNzMs
NiBAQCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgewogCSAqCiAJICogVGhpcyBpcyBjYWxsZWQgYnkgZG1h
X2J1Zl91bm1hcF9hdHRhY2htZW50KCkgYW5kIHNob3VsZCB1bm1hcCBhbmQKIAkgKiByZWxlYXNl
IHRoZSAmc2dfdGFibGUgYWxsb2NhdGVkIGluIEBtYXBfZG1hX2J1ZiwgYW5kIGl0IGlzIG1hbmRh
dG9yeS4KLQkgKiBJdCBzaG91bGQgYWxzbyB1bnBpbiB0aGUgYmFja2luZyBzdG9yYWdlIGlmIHRo
aXMgaXMgdGhlIGxhc3QgbWFwcGluZwotCSAqIG9mIHRoZSBETUEgYnVmZmVyLCBpdCB0aGUgZXhw
b3J0ZXIgc3VwcG9ydHMgYmFja2luZyBzdG9yYWdlCi0JICogbWlncmF0aW9uLgogCSAqLwogCXZv
aWQgKCp1bm1hcF9kbWFfYnVmKShzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICosCiAJCQkgICAg
ICBzdHJ1Y3Qgc2dfdGFibGUgKiwKQEAgLTMxMSw2ICszMzcsMzUgQEAgc3RydWN0IGRtYV9idWYg
ewogCX0gY2JfZXhjbCwgY2Jfc2hhcmVkOwogfTsKIAorLyoqCisgKiBzdHJ1Y3QgZG1hX2J1Zl9h
dHRhY2hfb3BzIC0gaW1wb3J0ZXIgb3BlcmF0aW9ucyBmb3IgYW4gYXR0YWNobWVudAorICogQGlu
dmFsaWRhdGU6IFtvcHRpb25hbF0gaW52YWxpZGF0ZSBhbGwgbWFwcGluZ3MgbWFkZSB1c2luZyB0
aGlzIGF0dGFjaG1lbnQuCisgKgorICogQXR0YWNobWVudCBvcGVyYXRpb25zIGltcGxlbWVudGVk
IGJ5IHRoZSBpbXBvcnRlci4KKyAqLworc3RydWN0IGRtYV9idWZfYXR0YWNoX29wcyB7CisJLyoq
CisJICogQGludmFsaWRhdGU6CisJICoKKwkgKiBJZiB0aGUgaW52YWxpZGF0ZSBjYWxsYmFjayBp
cyBwcm92aWRlZCB0aGUgZnJhbWV3b3JrIGNhbiBhdm9pZAorCSAqIHBpbm5pbmcgdGhlIGJhY2tp
bmcgc3RvcmUgd2hpbGUgbWFwcGluZ3MgZXhpc3RzLgorCSAqCisJICogVGhpcyBjYWxsYmFjayBp
cyBjYWxsZWQgd2l0aCB0aGUgbG9jayBvZiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CisJICogYXNz
b2NpYXRlZCB3aXRoIHRoZSBkbWFfYnVmIGhlbGQgYW5kIHRoZSBtYXBwaW5nIGZ1bmN0aW9uIG11
c3QgYmUKKwkgKiBjYWxsZWQgd2l0aCB0aGlzIGxvY2sgaGVsZCBhcyB3ZWxsLiBUaGlzIG1ha2Vz
IHN1cmUgdGhhdCBubyBtYXBwaW5nCisJICogaXMgY3JlYXRlZCBjb25jdXJyZW50bHkgd2l0aCBh
biBvbmdvaW5nIGludmFsaWRhdGlvbi4KKwkgKgorCSAqIEFmdGVyIHRoZSBjYWxsYmFjayBhbGwg
ZXhpc3RpbmcgbWFwcGluZ3MgYXJlIHN0aWxsIHZhbGlkIHVudGlsIGFsbAorCSAqIGZlbmNlcyBp
biB0aGUgZG1hX2J1ZnMgcmVzZXJ2YXRpb24gb2JqZWN0IGFyZSBzaWduYWxlZC4gQWZ0ZXIgZ2V0
dGluZyBhbgorCSAqIGludmFsaWRhdGlvbiBjYWxsYmFjayBhbGwgbWFwcGluZ3Mgc2hvdWxkIGJl
IGRlc3Ryb3llZCBieSB0aGUgaW1wb3J0ZXIgdXNpbmcKKwkgKiB0aGUgbm9ybWFsIGRtYV9idWZf
dW5tYXBfYXR0YWNobWVudCgpIGZ1bmN0aW9uIGFzIHNvb24gYXMgcG9zc2libGUuCisJICoKKwkg
KiBOZXcgbWFwcGluZ3MgY2FuIGJlIGNyZWF0ZWQgaW1tZWRpYXRlbHksIGJ1dCBjYW4ndCBiZSB1
c2VkIGJlZm9yZSB0aGUKKwkgKiBleGNsdXNpdmUgZmVuY2UgaW4gdGhlIGRtYV9idWZzIHJlc2Vy
dmF0aW9uIG9iamVjdCBpcyBzaWduYWxlZC4KKwkgKi8KKwl2b2lkICgqaW52YWxpZGF0ZSkoc3Ry
dWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKTsKK307CisKIC8qKgogICogc3RydWN0IGRt
YV9idWZfYXR0YWNobWVudCAtIGhvbGRzIGRldmljZS1idWZmZXIgYXR0YWNobWVudCBkYXRhCiAg
KiBAZG1hYnVmOiBidWZmZXIgZm9yIHRoaXMgYXR0YWNobWVudC4KQEAgLTMxOSw2ICszNzQsOCBA
QCBzdHJ1Y3QgZG1hX2J1ZiB7CiAgKiBAc2d0OiBjYWNoZWQgbWFwcGluZy4KICAqIEBkaXI6IGRp
cmVjdGlvbiBvZiBjYWNoZWQgbWFwcGluZy4KICAqIEBwcml2OiBleHBvcnRlciBzcGVjaWZpYyBh
dHRhY2htZW50IGRhdGEuCisgKiBAaW1wb3J0ZXJfb3BzOiBpbXBvcnRlciBvcGVyYXRpb25zIGZv
ciB0aGlzIGF0dGFjaG1lbnQuCisgKiBAaW1wb3J0ZXJfcHJpdjogaW1wb3J0ZXIgc3BlY2lmaWMg
YXR0YWNobWVudCBkYXRhLgogICoKICAqIFRoaXMgc3RydWN0dXJlIGhvbGRzIHRoZSBhdHRhY2ht
ZW50IGluZm9ybWF0aW9uIGJldHdlZW4gdGhlIGRtYV9idWYgYnVmZmVyCiAgKiBhbmQgaXRzIHVz
ZXIgZGV2aWNlKHMpLiBUaGUgbGlzdCBjb250YWlucyBvbmUgYXR0YWNobWVudCBzdHJ1Y3QgcGVy
IGRldmljZQpAQCAtMzM2LDYgKzM5Myw5IEBAIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgewog
CXN0cnVjdCBzZ190YWJsZSAqc2d0OwogCWVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcjsKIAl2
b2lkICpwcml2OworCisJY29uc3Qgc3RydWN0IGRtYV9idWZfYXR0YWNoX29wcyAqaW1wb3J0ZXJf
b3BzOworCXZvaWQgKmltcG9ydGVyX3ByaXY7CiB9OwogCiAvKioKQEAgLTM4NiwxMCArNDQ2LDQy
IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBnZXRfZG1hX2J1ZihzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
KQogCWdldF9maWxlKGRtYWJ1Zi0+ZmlsZSk7CiB9CiAKKy8qKgorICogZG1hX2J1Zl9pc19keW5h
bWljIC0gY2hlY2sgaWYgYSBETUEtYnVmIHVzZXMgZHluYW1pYyBtYXBwaW5ncy4KKyAqIEBkbWFi
dWY6IHRoZSBETUEtYnVmIHRvIGNoZWNrCisgKgorICogUmV0dXJucyB0cnVlIGlmIGEgRE1BLWJ1
ZiBleHBvcnRlciB3YW50cyB0byBjcmVhdGUgZHluYW1pYyBzZyB0YWJsZSBtYXBwaW5ncworICog
Zm9yIGVhY2ggYXR0YWNobWVudC4gRmFsc2UgaWYgb25seSBhIHNpbmdsZSBzdGF0aWMgc2cgdGFi
bGUgc2hvdWxkIGJlIHVzZWQuCisgKi8KK3N0YXRpYyBpbmxpbmUgYm9vbCBkbWFfYnVmX2lzX2R5
bmFtaWMoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sKKwlyZXR1cm4gISFkbWFidWYtPm9wcy0+
cGluOworfQorCisvKioKKyAqIGRtYV9idWZfYXR0YWNobWVudF9pc19keW5hbWljIC0gY2hlY2sg
aWYgYSBETUEtYnVmIGF0dGFjaG1lbnQgdXNlcyBkeW5hbWljCisgKiBtYXBwaW5zZworICogQGF0
dGFjaDogdGhlIERNQS1idWYgYXR0YWNobWVudCB0byBjaGVjaworICoKKyAqIFJldHVybnMgdHJ1
ZSBpZiBhIERNQS1idWYgaW1wb3J0ZXIgd2FudHMgdG8gdXNlIGR5bmFtaWMgc2cgdGFibGUgbWFw
cGluZ3MgYW5kCisgKiBjYWxscyB0aGUgbWFwL3VubWFwIGZ1bmN0aW9ucyB3aXRoIHRoZSByZXNl
cnZhdGlvbiBvYmplY3QgbG9ja2VkLgorICovCitzdGF0aWMgaW5saW5lIGJvb2wKK2RtYV9idWZf
YXR0YWNobWVudF9pc19keW5hbWljKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCkK
K3sKKwlyZXR1cm4gYXR0YWNoLT5pbXBvcnRlcl9vcHMgJiYgYXR0YWNoLT5pbXBvcnRlcl9vcHMt
PmludmFsaWRhdGU7Cit9CisKIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmRtYV9idWZfYXR0
YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCi0JCQkJCQkJc3RydWN0IGRldmljZSAqZGV2KTsK
KwkJCQkJICBzdHJ1Y3QgZGV2aWNlICpkZXYpOworc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAq
CitkbWFfYnVmX2R5bmFtaWNfYXR0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBk
ZXZpY2UgKmRldiwKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBkbWFfYnVmX2F0dGFjaF9vcHMgKmlt
cG9ydGVyX29wcywKKwkJICAgICAgIHZvaWQgKmltcG9ydGVyX3ByaXYpOwogdm9pZCBkbWFfYnVm
X2RldGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAotCQkJCXN0cnVjdCBkbWFfYnVmX2F0dGFj
aG1lbnQgKmRtYWJ1Zl9hdHRhY2gpOworCQkgICAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAq
YXR0YWNoKTsKK2ludCBkbWFfYnVmX3BpbihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRh
Y2gpOwordm9pZCBkbWFfYnVmX3VucGluKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aCk7CiAKIHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmX2V4cG9ydChjb25zdCBzdHJ1Y3QgZG1hX2J1
Zl9leHBvcnRfaW5mbyAqZXhwX2luZm8pOwogCkBAIC00MDEsNiArNDkzLDcgQEAgc3RydWN0IHNn
X3RhYmxlICpkbWFfYnVmX21hcF9hdHRhY2htZW50KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQg
KiwKIAkJCQkJZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24pOwogdm9pZCBkbWFfYnVmX3VubWFwX2F0
dGFjaG1lbnQoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqLCBzdHJ1Y3Qgc2dfdGFibGUgKiwK
IAkJCQllbnVtIGRtYV9kYXRhX2RpcmVjdGlvbik7Cit2b2lkIGRtYV9idWZfaW52YWxpZGF0ZV9t
YXBwaW5ncyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1Zik7CiBpbnQgZG1hX2J1Zl9iZWdpbl9jcHVf
YWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmLAogCQkJICAgICBlbnVtIGRtYV9kYXRhX2Rp
cmVjdGlvbiBkaXIpOwogaW50IGRtYV9idWZfZW5kX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYg
KmRtYV9idWYsCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2RyaS1kZXZlbA==
