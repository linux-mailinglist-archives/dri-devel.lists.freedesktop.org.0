Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B5636F1BF2
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 18:01:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3C2D06EDF2;
	Wed,  6 Nov 2019 17:01:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mo6-p02-ob.smtp.rzone.de (mo6-p02-ob.smtp.rzone.de
 [IPv6:2a01:238:20a:202:5302::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6B066EDF2
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 17:01:11 +0000 (UTC)
X-RZG-AUTH: ":P3gBZUipdd93FF5ZZvYFPugejmSTVR2nRPhVORvLd4SsytBXQrEOHTIXs8PvtBNfIQ=="
X-RZG-CLASS-ID: mo00
Received: from localhost.localdomain by smtp.strato.de (RZmta 44.29.0 AUTH)
 with ESMTPSA id e07688vA6H15hLx
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (curve secp521r1 with
 521 ECDH bits, eq. 15360 bits RSA))
 (Client did not present a certificate);
 Wed, 6 Nov 2019 18:01:05 +0100 (CET)
From: Stephan Gerhold <stephan@gerhold.net>
To: Linus Walleij <linus.walleij@linaro.org>
Subject: [PATCH 7/7] drm/mcde: Handle pending vblank while disabling display
Date: Wed,  6 Nov 2019 17:58:35 +0100
Message-Id: <20191106165835.2863-8-stephan@gerhold.net>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106165835.2863-1-stephan@gerhold.net>
References: <20191106165835.2863-1-stephan@gerhold.net>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 t=1573059670; 
 s=strato-dkim-0002; d=gerhold.net;
 h=References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From:
 X-RZG-CLASS-ID:X-RZG-AUTH:From:Subject:Sender;
 bh=U9jpWVAVI4H0QzeOFwQuOzYJ4uhUGMoHYCQ/+t9hVSI=;
 b=CYIHfA3xIXqHSmGiaU3h8bAfJEH4TSiHrYG6Y6B6NNMYqCOJ62GGJWFZAsUy4nbtgX
 LYOYXHAl1e6hz+gD+jRoYR1WKBt2aFvhuCKdOWyHkGsiC6hmHUjhRacauqBNspvPY+AO
 7yncWH9BATmz1ScCDm616O4UkFMFECLCgJ/Gy5WQbgDH9b8FyNBdGsG/WUPAkh4uYZ/g
 fqvDBWaoOl2/gcXzxLlFawlUZEWCvG2YdrDs52rnzS8sBfm05mGXJ0VnWRLlrnstWEmN
 GeVA49XTjx7P7HvZpWs3xrORup7MiuwCJr9lHO3gtNjg1YyIU+lPY0kUVrdQTmnvRKTe
 +4Bw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, Stephan Gerhold <stephan@gerhold.net>,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RGlzYWJsaW5nIHRoZSBkaXNwbGF5IHVzaW5nIE1DREUgY3VycmVudGx5IHJlc3VsdHMgaW4gYSB3
YXJuaW5nCnRvZ2V0aGVyIHdpdGggYSBkZWxheSBjYXVzZWQgYnkgc29tZSB0aW1lb3V0czoKCiAg
ICBtY2RlIGEwMzUwMDAwLm1jZGU6IE1DREUgZGlzcGxheSBpcyBkaXNhYmxlZAogICAgLS0tLS0t
LS0tLS0tWyBjdXQgaGVyZSBdLS0tLS0tLS0tLS0tCiAgICBXQVJOSU5HOiBDUFU6IDAgUElEOiAy
MCBhdCBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYzoyMjU4IGRybV9hdG9taWNf
aGVscGVyX2NvbW1pdF9od19kb25lKzB4ZTAvMHhlNAogICAgSGFyZHdhcmUgbmFtZTogU1QtRXJp
Y3Nzb24gVXg1eDAgcGxhdGZvcm0gKERldmljZSBUcmVlIFN1cHBvcnQpCiAgICBXb3JrcXVldWU6
IGV2ZW50cyBkcm1fbW9kZV9ybWZiX3dvcmtfZm4KICAgIFs8YzAxMGY0Njg+XSAodW53aW5kX2Jh
Y2t0cmFjZSkgZnJvbSBbPGMwMTBiNTRjPl0gKHNob3dfc3RhY2srMHgxMC8weDE0KQogICAgWzxj
MDEwYjU0Yz5dIChzaG93X3N0YWNrKSBmcm9tIFs8YzA3OWRkOTA+XSAoZHVtcF9zdGFjaysweDg0
LzB4OTgpCiAgICBbPGMwNzlkZDkwPl0gKGR1bXBfc3RhY2spIGZyb20gWzxjMDExZDFiMD5dIChf
X3dhcm4rMHhiOC8weGQ0KQogICAgWzxjMDExZDFiMD5dIChfX3dhcm4pIGZyb20gWzxjMDExZDIz
MD5dICh3YXJuX3Nsb3dwYXRoX2ZtdCsweDY0LzB4YzQpCiAgICBbPGMwMTFkMjMwPl0gKHdhcm5f
c2xvd3BhdGhfZm10KSBmcm9tIFs8YzA0MTMwNDg+XSAoZHJtX2F0b21pY19oZWxwZXJfY29tbWl0
X2h3X2RvbmUrMHhlMC8weGU0KQogICAgWzxjMDQxMzA0OD5dIChkcm1fYXRvbWljX2hlbHBlcl9j
b21taXRfaHdfZG9uZSkgZnJvbSBbPGMwNDE1OWNjPl0gKGRybV9hdG9taWNfaGVscGVyX2NvbW1p
dF90YWlsX3JwbSsweDQ0LzB4NmMpCiAgICBbPGMwNDE1OWNjPl0gKGRybV9hdG9taWNfaGVscGVy
X2NvbW1pdF90YWlsX3JwbSkgZnJvbSBbPGMwNDE1ZjVjPl0gKGNvbW1pdF90YWlsKzB4NTAvMHgx
MGMpCiAgICBbPGMwNDE1ZjVjPl0gKGNvbW1pdF90YWlsKSBmcm9tIFs8YzA0MTYwZGM+XSAoZHJt
X2F0b21pY19oZWxwZXJfY29tbWl0KzB4YmMvMHgxMjgpCiAgICBbPGMwNDE2MGRjPl0gKGRybV9h
dG9taWNfaGVscGVyX2NvbW1pdCkgZnJvbSBbPGMwNDMwNzkwPl0gKGRybV9mcmFtZWJ1ZmZlcl9y
ZW1vdmUrMHgzOTAvMHg0MjgpCiAgICBbPGMwNDMwNzkwPl0gKGRybV9mcmFtZWJ1ZmZlcl9yZW1v
dmUpIGZyb20gWzxjMDQzMDg2MD5dIChkcm1fbW9kZV9ybWZiX3dvcmtfZm4rMHgzOC8weDQ4KQog
ICAgWzxjMDQzMDg2MD5dIChkcm1fbW9kZV9ybWZiX3dvcmtfZm4pIGZyb20gWzxjMDEzNjhhOD5d
IChwcm9jZXNzX29uZV93b3JrKzB4MWYwLzB4NDNjKQogICAgWzxjMDEzNjhhOD5dIChwcm9jZXNz
X29uZV93b3JrKSBmcm9tIFs8YzAxMzZkNDg+XSAod29ya2VyX3RocmVhZCsweDI1NC8weDU1YykK
ICAgIFs8YzAxMzZkNDg+XSAod29ya2VyX3RocmVhZCkgZnJvbSBbPGMwMTNjMDE0Pl0gKGt0aHJl
YWQrMHgxMjQvMHgxNTApCiAgICBbPGMwMTNjMDE0Pl0gKGt0aHJlYWQpIGZyb20gWzxjMDEwMTBl
OD5dIChyZXRfZnJvbV9mb3JrKzB4MTQvMHgyYykKICAgIEV4Y2VwdGlvbiBzdGFjaygweGViMTRk
ZmIwIHRvIDB4ZWIxNGRmZjgpCiAgICBkZmEwOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAwMDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMAogICAgZGZjMDogMDAw
MDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAw
MDAgMDAwMDAwMDAKICAgIGRmZTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAw
IDAwMDAwMDEzIDAwMDAwMDAwCiAgICAtLS1bIGVuZCB0cmFjZSAzMTQ5MDliY2Q0YzdkNTBjIF0t
LS0KICAgIFtkcm06ZHJtX2F0b21pY19oZWxwZXJfd2FpdF9mb3JfZGVwZW5kZW5jaWVzXSAqRVJS
T1IqIFtDUlRDOjMyOmNydGMtMF0gZmxpcF9kb25lIHRpbWVkIG91dAogICAgW2RybTpkcm1fYXRv
bWljX2hlbHBlcl93YWl0X2Zvcl9kZXBlbmRlbmNpZXNdICpFUlJPUiogW0NPTk5FQ1RPUjozNDpE
U0ktMV0gZmxpcF9kb25lIHRpbWVkIG91dAogICAgW2RybTpkcm1fYXRvbWljX2hlbHBlcl93YWl0
X2Zvcl9kZXBlbmRlbmNpZXNdICpFUlJPUiogW1BMQU5FOjMxOnBsYW5lLTBdIGZsaXBfZG9uZSB0
aW1lZCBvdXQKClRoZSByZWFzb24gZm9yIHRoaXMgaXMgdGhhdCB0aGVyZSBpcyBhIHZibGFuayBl
dmVudCBwZW5kaW5nLCBidXQgd2UKbmV2ZXIgaGFuZGxlIGl0IGFmdGVyIGRpc2FibGluZyB0aGUg
dmJsYW5rIGludGVycnVwdHMuCgpDaGVjayBpZiB0aGVyZSBpcyBhbiB2YmxhbmsgZXZlbnQgcGVu
ZGluZyB3aGVuIGRpc2FibGluZyB0aGUgZGlzcGxheSwKYW5kIGNsZWFyIGl0IGJ5IHNlbmRpbmcg
YSBmYWtlIHZibGFuayBldmVudCBpbiB0aGF0IGNhc2UuCgpTaWduZWQtb2ZmLWJ5OiBTdGVwaGFu
IEdlcmhvbGQgPHN0ZXBoYW5AZ2VyaG9sZC5uZXQ+Ci0tLQogZHJpdmVycy9ncHUvZHJtL21jZGUv
bWNkZV9kaXNwbGF5LmMgfCAxMCArKysrKysrKysrCiAxIGZpbGUgY2hhbmdlZCwgMTAgaW5zZXJ0
aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZGlzcGxheS5j
IGIvZHJpdmVycy9ncHUvZHJtL21jZGUvbWNkZV9kaXNwbGF5LmMKaW5kZXggYTMzNzVhOTc0Y2Fm
Li5lNTk5MDdlNjg4NTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZGlz
cGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZGlzcGxheS5jCkBAIC05NDks
MTIgKzk0OSwyMiBAQCBzdGF0aWMgdm9pZCBtY2RlX2Rpc3BsYXlfZGlzYWJsZShzdHJ1Y3QgZHJt
X3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUpCiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gJnBp
cGUtPmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IGNydGMtPmRldjsKIAlzdHJ1Y3Qg
bWNkZSAqbWNkZSA9IGRybS0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGRybV9wZW5kaW5nX3ZibGFu
a19ldmVudCAqZXZlbnQ7CiAKIAlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMpOwogCiAJLyogRGlz
YWJsZSBGSUZPIEEgZmxvdyAqLwogCW1jZGVfZGlzYWJsZV9maWZvKG1jZGUsIE1DREVfRklGT19B
LCB0cnVlKTsKIAorCWV2ZW50ID0gY3J0Yy0+c3RhdGUtPmV2ZW50OworCWlmIChldmVudCkgewor
CQljcnRjLT5zdGF0ZS0+ZXZlbnQgPSBOVUxMOworCisJCXNwaW5fbG9ja19pcnEoJmNydGMtPmRl
di0+ZXZlbnRfbG9jayk7CisJCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2ZW50KGNydGMsIGV2ZW50
KTsKKwkJc3Bpbl91bmxvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOworCX0KKwogCWRl
dl9pbmZvKGRybS0+ZGV2LCAiTUNERSBkaXNwbGF5IGlzIGRpc2FibGVkXG4iKTsKIH0KIAotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpk
cmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
