Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7E64CC06C4
	for <lists+dri-devel@lfdr.de>; Fri, 27 Sep 2019 15:57:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 25BDB6E825;
	Fri, 27 Sep 2019 13:57:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id CC1116E845;
 Fri, 27 Sep 2019 13:57:23 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id EA65E28;
 Fri, 27 Sep 2019 06:57:22 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id C82693F534;
 Fri, 27 Sep 2019 06:57:21 -0700 (PDT)
Subject: Re: [PATCH v2 1/6] drm/gem: refine drm_gem_objects_lookup
To: Qiang Yu <yuq825@gmail.com>, dri-devel@lists.freedesktop.org
References: <20190927134616.21899-1-yuq825@gmail.com>
 <20190927134616.21899-2-yuq825@gmail.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <9a0bfc2a-4be4-3d3e-9fe3-6eecc1f8a880@arm.com>
Date: Fri, 27 Sep 2019 14:57:20 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <20190927134616.21899-2-yuq825@gmail.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, lima@lists.freedesktop.org,
 Maxime Ripard <maxime.ripard@bootlin.com>, David Airlie <airlied@linux.ie>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjcvMDkvMjAxOSAxNDo0NiwgUWlhbmcgWXUgd3JvdGU6Cj4gZHJtX2dlbV9vYmplY3RzX2xv
b2t1cCBkb2VzIG5vdCB1c2UgdXNlciBzcGFjZSBibyBoYW5kbGVzCj4gZGlyZWN0bHkgYW5kIGxl
ZnQgdGhlIHVzZXIgdG8ga2VybmVsIGNvcHkgd29yayB0byBhIG5ldwo+IGludGVyZmFjZSBkcm1f
Z2VtX29iamVjdHNfbG9va3VwX3VzZXIuCj4gCj4gVGhpcyBpcyBmb3IgZHJpdmVyIGxpa2UgbGlt
YSB3aGljaCBkb2VzIG5vdCBwYXNzIGdlbSBibwo+IGhhbmRsZXMgY29udGlub3VzbHkgaW4gYW4g
YXJyYXkgaW4gaW9jdGwgYXJndW1lbnQuCgpOaXQ6IEl0IHdvdWxkIGJlIGdvb2QgdG8gbWVudGlv
biBpbiB0aGUgY29tbWl0IG1lc3NhZ2UgdGhhdCB0aGlzIGFkZHMKZHJtX2dlbV9vYmplY3RzX2xv
b2t1cF91c2VyKCkgYXMgaXQgaGVscHMgZ3JlcHBpbmcgY29tbWl0cy4gQWxzbyBpZgp5b3UncmUg
cmV3cml0aW5nIGl0IC0gaXQgd291bGQgYmUgZ29vZCB0byBwb2ludCBvdXQgdGhhdCB5b3UgYXJl
Cl9jaGFuZ2luZ18gdGhlIGJlaHZhdmlvdXIgb2YgZHJtX2dlbV9vYmplY3RzX2xvb2twdSgpIHRv
IG5vdCB1c2UgdXNlcgpzcGFjZSBoYW5kbGVzLgoKPiAKPiB2MjoKPiAxLiBhZGQgZHJtX2dlbV9v
YmplY3RzX2xvb2t1cF91c2VyCj4gMi4gcmVtb3ZlIG5vbmUtemVybyBjaGVjayBhcyBhbGwgY2Fs
bGVyIHdpbGwgY2hlY2sgYmVmb3JlCj4gICAgY2FsbGluZyB0aGlzIGZ1bmN0aW9uCj4gCj4gQ2M6
IFJvYiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+Cj4gQ2M6IFRvbWV1IFZpem9zbyA8dG9tZXUu
dml6b3NvQGNvbGxhYm9yYS5jb20+Cj4gQ2M6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnByaWNlQGFy
bS5jb20+Cj4gQ2M6IEFseXNzYSBSb3Nlbnp3ZWlnIDxhbHlzc2Eucm9zZW56d2VpZ0Bjb2xsYWJv
cmEuY29tPgo+IFN1Z2dlc3RlZC1ieTogUm9iIEhlcnJpbmcgPHJvYmhAa2VybmVsLm9yZz4KPiBT
aWduZWQtb2ZmLWJ5OiBRaWFuZyBZdSA8eXVxODI1QGdtYWlsLmNvbT4KClJldmlld2VkLWJ5OiBT
dGV2ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgoKPiAtLS0KPiAgZHJpdmVycy9ncHUv
ZHJtL2RybV9nZW0uYyAgICAgICAgICAgICAgIHwgNTcgKysrKysrKysrKysrKysrKysrKy0tLS0t
LQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMgfCAgNiArLS0KPiAg
aW5jbHVkZS9kcm0vZHJtX2dlbS5oICAgICAgICAgICAgICAgICAgIHwgIDQgKy0KPiAgMyBmaWxl
cyBjaGFuZ2VkLCA0OSBpbnNlcnRpb25zKCspLCAxOCBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2Vt
LmMKPiBpbmRleCA2ODU0ZjU4NjdkNTEuLmE1ZTg4YzNlNmQyNSAxMDA2NDQKPiAtLS0gYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9nZW0uYwo+
IEBAIC02NzksMTEgKzY3OSwxMSBAQCBzdGF0aWMgaW50IG9iamVjdHNfbG9va3VwKHN0cnVjdCBk
cm1fZmlsZSAqZmlscCwgdTMyICpoYW5kbGUsIGludCBjb3VudCwKPiAgLyoqCj4gICAqIGRybV9n
ZW1fb2JqZWN0c19sb29rdXAgLSBsb29rIHVwIEdFTSBvYmplY3RzIGZyb20gYW4gYXJyYXkgb2Yg
aGFuZGxlcwo+ICAgKiBAZmlscDogRFJNIGZpbGUgcHJpdmF0ZSBkYXRlCj4gLSAqIEBib19oYW5k
bGVzOiB1c2VyIHBvaW50ZXIgdG8gYXJyYXkgb2YgdXNlcnNwYWNlIGhhbmRsZQo+ICsgKiBAYm9f
aGFuZGxlczogYXJyYXkgb2YgR0VNIG9iamVjdCBoYW5kbGVzCj4gICAqIEBjb3VudDogc2l6ZSBv
ZiBoYW5kbGUgYXJyYXkKPiAgICogQG9ianNfb3V0OiByZXR1cm5lZCBwb2ludGVyIHRvIGFycmF5
IG9mIGRybV9nZW1fb2JqZWN0IHBvaW50ZXJzCj4gICAqCj4gLSAqIFRha2VzIGFuIGFycmF5IG9m
IHVzZXJzcGFjZSBoYW5kbGVzIGFuZCByZXR1cm5zIGEgbmV3bHkgYWxsb2NhdGVkIGFycmF5IG9m
Cj4gKyAqIFRha2VzIGFuIGFycmF5IG9mIEdFTSBvYmplY3QgaGFuZGxlcyBhbmQgcmV0dXJucyBh
IG5ld2x5IGFsbG9jYXRlZCBhcnJheSBvZgo+ICAgKiBHRU0gb2JqZWN0cy4KPiAgICoKPiAgICog
Rm9yIGEgc2luZ2xlIGhhbmRsZSBsb29rdXAsIHVzZSBkcm1fZ2VtX29iamVjdF9sb29rdXAoKS4K
PiBAQCAtNjk1LDI2ICs2OTUsNTYgQEAgc3RhdGljIGludCBvYmplY3RzX2xvb2t1cChzdHJ1Y3Qg
ZHJtX2ZpbGUgKmZpbHAsIHUzMiAqaGFuZGxlLCBpbnQgY291bnQsCj4gICAqIGZhaWx1cmUuIDAg
aXMgcmV0dXJuZWQgb24gc3VjY2Vzcy4KPiAgICoKPiAgICovCj4gLWludCBkcm1fZ2VtX29iamVj
dHNfbG9va3VwKHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdm9pZCBfX3VzZXIgKmJvX2hhbmRsZXMs
Cj4gK2ludCBkcm1fZ2VtX29iamVjdHNfbG9va3VwKHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdTMy
ICpib19oYW5kbGVzLAo+ICAJCQkgICBpbnQgY291bnQsIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
KipvYmpzX291dCkKPiAgewo+ICAJaW50IHJldDsKPiAtCXUzMiAqaGFuZGxlczsKPiAgCXN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqKm9ianM7Cj4gIAo+IC0JaWYgKCFjb3VudCkKPiAtCQlyZXR1cm4g
MDsKPiAtCj4gIAlvYmpzID0ga3ZtYWxsb2NfYXJyYXkoY291bnQsIHNpemVvZihzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKiksCj4gIAkJCSAgICAgR0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8pOwo+ICAJ
aWYgKCFvYmpzKQo+ICAJCXJldHVybiAtRU5PTUVNOwo+ICAKPiArCXJldCA9IG9iamVjdHNfbG9v
a3VwKGZpbHAsIGJvX2hhbmRsZXMsIGNvdW50LCBvYmpzKTsKPiArCWlmIChyZXQpCj4gKwkJa3Zm
cmVlKG9ianMpOwo+ICsJZWxzZQo+ICsJCSpvYmpzX291dCA9IG9ianM7Cj4gKwo+ICsJcmV0dXJu
IHJldDsKPiArCj4gK30KPiArRVhQT1JUX1NZTUJPTChkcm1fZ2VtX29iamVjdHNfbG9va3VwKTsK
PiArCj4gKy8qKgo+ICsgKiBkcm1fZ2VtX29iamVjdHNfbG9va3VwX3VzZXIgLSBsb29rIHVwIEdF
TSBvYmplY3RzIGZyb20gYW4gYXJyYXkgb2YgaGFuZGxlcwo+ICsgKiBAZmlscDogRFJNIGZpbGUg
cHJpdmF0ZSBkYXRlCj4gKyAqIEBib19oYW5kbGVzOiB1c2VyIHBvaW50ZXIgdG8gYXJyYXkgb2Yg
dXNlcnNwYWNlIGhhbmRsZQo+ICsgKiBAY291bnQ6IHNpemUgb2YgaGFuZGxlIGFycmF5Cj4gKyAq
IEBvYmpzX291dDogcmV0dXJuZWQgcG9pbnRlciB0byBhcnJheSBvZiBkcm1fZ2VtX29iamVjdCBw
b2ludGVycwo+ICsgKgo+ICsgKiBUYWtlcyBhbiBhcnJheSBvZiB1c2Vyc3BhY2UgaGFuZGxlcyBh
bmQgcmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBhcnJheSBvZgo+ICsgKiBHRU0gb2JqZWN0cy4K
PiArICoKPiArICogRm9yIGEgc2luZ2xlIGhhbmRsZSBsb29rdXAsIHVzZSBkcm1fZ2VtX29iamVj
dF9sb29rdXAoKS4KPiArICoKPiArICogUmV0dXJuczoKPiArICoKPiArICogQG9ianMgZmlsbGVk
IGluIHdpdGggR0VNIG9iamVjdCBwb2ludGVycy4gUmV0dXJuZWQgR0VNIG9iamVjdHMgbmVlZCB0
byBiZQo+ICsgKiByZWxlYXNlZCB3aXRoIGRybV9nZW1fb2JqZWN0X3B1dCgpLiAtRU5PRU5UIGlz
IHJldHVybmVkIG9uIGEgbG9va3VwCj4gKyAqIGZhaWx1cmUuIDAgaXMgcmV0dXJuZWQgb24gc3Vj
Y2Vzcy4KPiArICoKPiArICovCj4gK2ludCBkcm1fZ2VtX29iamVjdHNfbG9va3VwX3VzZXIoc3Ry
dWN0IGRybV9maWxlICpmaWxwLCB2b2lkIF9fdXNlciAqYm9faGFuZGxlcywKPiArCQkJCWludCBj
b3VudCwgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqKm9ianNfb3V0KQo+ICt7Cj4gKwlpbnQgcmV0
Owo+ICsJdTMyICpoYW5kbGVzOwo+ICsKPiAgCWhhbmRsZXMgPSBrdm1hbGxvY19hcnJheShjb3Vu
dCwgc2l6ZW9mKHUzMiksIEdGUF9LRVJORUwpOwo+IC0JaWYgKCFoYW5kbGVzKSB7Cj4gLQkJcmV0
ID0gLUVOT01FTTsKPiAtCQlnb3RvIG91dDsKPiAtCX0KPiArCWlmICghaGFuZGxlcykKPiArCQly
ZXR1cm4gLUVOT01FTTsKPiAgCj4gIAlpZiAoY29weV9mcm9tX3VzZXIoaGFuZGxlcywgYm9faGFu
ZGxlcywgY291bnQgKiBzaXplb2YodTMyKSkpIHsKPiAgCQlyZXQgPSAtRUZBVUxUOwo+IEBAIC03
MjIsMTUgKzc1MiwxNCBAQCBpbnQgZHJtX2dlbV9vYmplY3RzX2xvb2t1cChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbHAsIHZvaWQgX191c2VyICpib19oYW5kbGVzLAo+ICAJCWdvdG8gb3V0Owo+ICAJfQo+
ICAKPiAtCXJldCA9IG9iamVjdHNfbG9va3VwKGZpbHAsIGhhbmRsZXMsIGNvdW50LCBvYmpzKTsK
PiAtCSpvYmpzX291dCA9IG9ianM7Cj4gKwlyZXQgPSBkcm1fZ2VtX29iamVjdHNfbG9va3VwKGZp
bHAsIGhhbmRsZXMsIGNvdW50LCBvYmpzX291dCk7Cj4gIAo+ICBvdXQ6Cj4gIAlrdmZyZWUoaGFu
ZGxlcyk7Cj4gIAlyZXR1cm4gcmV0Owo+ICAKPiAgfQo+IC1FWFBPUlRfU1lNQk9MKGRybV9nZW1f
b2JqZWN0c19sb29rdXApOwo+ICtFWFBPUlRfU1lNQk9MKGRybV9nZW1fb2JqZWN0c19sb29rdXBf
dXNlcik7Cj4gIAo+ICAvKioKPiAgICogZHJtX2dlbV9vYmplY3RfbG9va3VwIC0gbG9vayB1cCBh
IEdFTSBvYmplY3QgZnJvbSBpdHMgaGFuZGxlCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9kcnYuYwo+IGluZGV4IGQ3NDQ0MmQ3MTA0OC4uNDg2Y2E1MWQ1NjYyIDEwMDY0NAo+IC0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYwo+ICsrKyBiL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYwo+IEBAIC0xMzAsOSArMTMwLDkgQEAg
cGFuZnJvc3RfbG9va3VwX2JvcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICAJaWYgKCFqb2It
PmltcGxpY2l0X2ZlbmNlcykKPiAgCQlyZXR1cm4gLUVOT01FTTsKPiAgCj4gLQlyZXR1cm4gZHJt
X2dlbV9vYmplY3RzX2xvb2t1cChmaWxlX3ByaXYsCj4gLQkJCQkgICAgICAodm9pZCBfX3VzZXIg
KikodWludHB0cl90KWFyZ3MtPmJvX2hhbmRsZXMsCj4gLQkJCQkgICAgICBqb2ItPmJvX2NvdW50
LCAmam9iLT5ib3MpOwo+ICsJcmV0dXJuIGRybV9nZW1fb2JqZWN0c19sb29rdXBfdXNlcihmaWxl
X3ByaXYsCj4gKwkJCQkJICAgKHZvaWQgX191c2VyICopKHVpbnRwdHJfdClhcmdzLT5ib19oYW5k
bGVzLAo+ICsJCQkJCSAgIGpvYi0+Ym9fY291bnQsICZqb2ItPmJvcyk7Cj4gIH0KPiAgCj4gIC8q
Kgo+IGRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtLmggYi9pbmNsdWRlL2RybS9kcm1f
Z2VtLmgKPiBpbmRleCA2YWFiYTE0ZjU5NzIuLjM1NGZjOGQyNDBlNCAxMDA2NDQKPiAtLS0gYS9p
bmNsdWRlL2RybS9kcm1fZ2VtLmgKPiArKysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtLmgKPiBAQCAt
Mzg3LDggKzM4NywxMCBAQCBzdHJ1Y3QgcGFnZSAqKmRybV9nZW1fZ2V0X3BhZ2VzKHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqKTsKPiAgdm9pZCBkcm1fZ2VtX3B1dF9wYWdlcyhzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IHBhZ2UgKipwYWdlcywKPiAgCQlib29sIGRpcnR5LCBi
b29sIGFjY2Vzc2VkKTsKPiAgCj4gLWludCBkcm1fZ2VtX29iamVjdHNfbG9va3VwKHN0cnVjdCBk
cm1fZmlsZSAqZmlscCwgdm9pZCBfX3VzZXIgKmJvX2hhbmRsZXMsCj4gK2ludCBkcm1fZ2VtX29i
amVjdHNfbG9va3VwKHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdTMyICpib19oYW5kbGVzLAo+ICAJ
CQkgICBpbnQgY291bnQsIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKipvYmpzX291dCk7Cj4gK2lu
dCBkcm1fZ2VtX29iamVjdHNfbG9va3VwX3VzZXIoc3RydWN0IGRybV9maWxlICpmaWxwLCB2b2lk
IF9fdXNlciAqYm9faGFuZGxlcywKPiArCQkJCWludCBjb3VudCwgc3RydWN0IGRybV9nZW1fb2Jq
ZWN0ICoqKm9ianNfb3V0KTsKPiAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpkcm1fZ2VtX29iamVj
dF9sb29rdXAoc3RydWN0IGRybV9maWxlICpmaWxwLCB1MzIgaGFuZGxlKTsKPiAgbG9uZyBkcm1f
Z2VtX2RtYV9yZXN2X3dhaXQoc3RydWN0IGRybV9maWxlICpmaWxlcCwgdTMyIGhhbmRsZSwKPiAg
CQkJCSAgICBib29sIHdhaXRfYWxsLCB1bnNpZ25lZCBsb25nIHRpbWVvdXQpOwo+IAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
