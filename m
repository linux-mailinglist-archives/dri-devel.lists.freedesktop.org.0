Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4ACD632DDC4
	for <lists+dri-devel@lfdr.de>; Fri,  5 Mar 2021 00:20:27 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BCBB66EA87;
	Thu,  4 Mar 2021 23:20:19 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pj1-x102e.google.com (mail-pj1-x102e.google.com
 [IPv6:2607:f8b0:4864:20::102e])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 548FD6EA84
 for <dri-devel@lists.freedesktop.org>; Thu,  4 Mar 2021 23:20:18 +0000 (UTC)
Received: by mail-pj1-x102e.google.com with SMTP id fu20so378885pjb.2
 for <dri-devel@lists.freedesktop.org>; Thu, 04 Mar 2021 15:20:18 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=FiKbNF6sIsDFllVX3gZjMXu3m0TjzXNAhqpgm5/+cRY=;
 b=vMzeNpoKj+AWkNj1Sl0naujTZGOZ/Kd7M8pxVCcQ/geVFWfX9PusFkmpilFBZjEbhf
 /CmiI/RwQdWjgC1kRvbSjGQ8EdH9S6OXx8JzMfOuHnv+OJsy4nTtWLm4oViJJtwV/ykJ
 b71l7eMzLaiaFg6t5ebIYh3mgZJxZaVhGeG1tP73aW5gpCGPNuHcLWf7q/s+RvU2IQda
 uNi8HJnZ7vcyhNapadVbMcduwumQJf/OZ5Mjf4BiTU7LiNbNh+ZgyDamqaiecnvHT33y
 Ir4CH5oYx8yIDwHIWeW1gMW++1Qf3akAz+kNzQjspA5l/eK+rgMy57iFcl+0eqRRaSD4
 BxbA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=FiKbNF6sIsDFllVX3gZjMXu3m0TjzXNAhqpgm5/+cRY=;
 b=XvXDYiVNZf90EOSMHxLb1piwKTAu5dmpa6O2A3c1BBXb6GIOq2j5rzJyf28N3jr9q+
 la53iXBpoidQIhLulx7mDVZF4sy3XcuVCUy8cUgdNQBJD3maBSDvDa0IPH8qknf355kv
 ymU464kqKahfZSLKwNj/vNOdjC6rCjykWIWihwrFFeSrz5txPd+9gatdiAxWvTRQG9p7
 WbCqOOQMcWAyqpKDyUEbajjR6OkW34BulNZn8OHK7rnv83IAXiMpJnIxGQvyKuzv4hgt
 QYQ6/zdVSh9e9u5p14tnLV+4eDSj/YirZmJpEPKjuZ/AqR6FWKJyfODssjMBT1zujB6X
 mr+w==
X-Gm-Message-State: AOAM531TtEVsOiekUy8blJ2oh21JLe0eRN4jQOGqWb8vVMQ4ol9gQruD
 cGIZau5zdpF9R/T4M/owfvWo9A==
X-Google-Smtp-Source: ABdhPJzaPXe0BX4p/OHpQUy/ewFyfYq+is8O0jHSW93qyBaAZlEvtzKM4hvHDE9/7CV7ZKdlubEr/g==
X-Received: by 2002:a17:902:6b43:b029:df:fb48:aece with SMTP id
 g3-20020a1709026b43b02900dffb48aecemr5995966plt.59.1614900017933; 
 Thu, 04 Mar 2021 15:20:17 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 u66sm429290pfc.72.2021.03.04.15.20.16
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 04 Mar 2021 15:20:17 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v8 2/5] drm: ttm_pool: Rework ttm_pool to use drm_page_pool
Date: Thu,  4 Mar 2021 23:20:08 +0000
Message-Id: <20210304232011.1479036-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210304232011.1479036-1-john.stultz@linaro.org>
References: <20210304232011.1479036-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, Sandeep Patil <sspatil@google.com>,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Christian Koenig <christian.koenig@amd.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCByZXdvcmtzIHRoZSB0dG1fcG9vbCBsb2dpYyB0byB1dGlsaXplIHRoZSByZWNl
bnRseQphZGRlZCBkcm1fcGFnZV9wb29sIGNvZGUuCgpUaGlzIGFkZHMgZHJtX3BhZ2VfcG9vbCBz
dHJ1Y3R1cmVzIHRvIHRoZSB0dG1fcG9vbF90eXBlCnN0cnVjdHVyZXMsIGFuZCB0aGVuIHJlbW92
ZXMgYWxsIHRoZSB0dG1fcG9vbF90eXBlIHNocmlua2VyCmxvZ2ljIChhcyBpdHMgaGFuZGxlZCBp
biB0aGUgZHJtX3BhZ2VfcG9vbCBzaHJpbmtlcikuCgpOT1RFOiBUaGVyZSBpcyBvbmUgbWlzbWF0
Y2ggaW4gdGhlIGludGVyZmFjZXMgSSdtIG5vdCB0b3RhbGx5CmhhcHB5IHdpdGguIFRoZSB0dG1f
cG9vbCB0cmFja3MgYWxsIG9mIGl0cyBwb29sZWQgcGFnZXMgYWNyb3NzCmEgbnVtYmVyIG9mIGRp
ZmZlcmVudCBwb29scywgYW5kIHRyaWVzIHRvIGtlZXAgdGhpcyBzaXplIHVuZGVyCnRoZSBzcGVj
aWZpZWQgcGFnZV9wb29sX3NpemUgdmFsdWUuIFdpdGggdGhlIGRybV9wYWdlX3Bvb2wsCnRoZXJl
IG1heSBvdGhlciB1c2VycywgaG93ZXZlciB0aGVyZSBpcyBzdGlsbCBvbmUgZ2xvYmFsCnNocmlu
a2VyIGxpc3Qgb2YgcG9vbHMuIFNvIHdlIGNhbid0IGVhc2lseSByZWR1Y2UgdGhlIHR0bQpwb29s
IHVuZGVyIHRoZSB0dG0gc3BlY2lmaWVkIHNpemUgd2l0aG91dCBwb3RlbnRpYWxseSBkb2luZwph
IGxvdCBvZiBzaHJpbmtpbmcgdG8gb3RoZXIgbm9uLXR0bSBwb29scy4gU28gZWl0aGVyIHdlIGNh
bjoKICAxKSBUcnkgdG8gc3BsaXQgaXQgc28gZWFjaCB1c2VyIG9mIGRybV9wYWdlX3Bvb2xzIG1h
bmFnZXMgaXRzCiAgICAgb3duIHBvb2wgc2hyaW5raW5nLgogIDIpIFB1c2ggdGhlIG1heCB2YWx1
ZSBpbnRvIHRoZSBkcm1fcGFnZV9wb29sLCBhbmQgaGF2ZSBpdAogICAgIG1hbmFnZSBzaHJpbmtp
bmcgdG8gZml0IHVuZGVyIHRoYXQgZ2xvYmFsIG1heC4gVGhlbiBzaGFyZQogICAgIHRob3NlIHNp
emUvbWF4IHZhbHVlcyBvdXQgc28gdGhlIHR0bV9wb29sIGRlYnVnIG91dHB1dAogICAgIGNhbiBo
YXZlIG1vcmUgY29udGV4dC4KCkkndmUgdGFrZW4gdGhlIHNlY29uZCBwYXRoIGluIHRoaXMgcGF0
Y2ggc2V0LCBidXQgd2FudGVkIHRvIGNhbGwKaXQgb3V0IHNvIGZvbGtzIGNvdWxkIGxvb2sgY2xv
c2VseS4KClRob3VnaHRzIHdvdWxkIGJlIGdyZWF0bHkgYXBwcmVjaWF0ZWQgaGVyZSEKCkNjOiBE
YW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBDaHJpc3RpYW4gS29lbmlnIDxjaHJp
c3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5h
cm8ub3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IENocmlzIEdv
bGRzd29ydGh5IDxjZ29sZHN3b0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IExhdXJhIEFiYm90dCA8bGFi
Ym90dEBrZXJuZWwub3JnPgpDYzogQnJpYW4gU3RhcmtleSA8QnJpYW4uU3RhcmtleUBhcm0uY29t
PgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlhQGdvb2dsZS5jb20+CkNjOiBTdXJlbiBCYWdo
ZGFzYXJ5YW4gPHN1cmVuYkBnb29nbGUuY29tPgpDYzogU2FuZGVlcCBQYXRpbCA8c3NwYXRpbEBn
b29nbGUuY29tPgpDYzogRGFuaWVsIE1lbnR6IDxkYW5pZWxtZW50ekBnb29nbGUuY29tPgpDYzog
w5hyamFuIEVpZGUgPG9yamFuLmVpZGVAYXJtLmNvbT4KQ2M6IFJvYmluIE11cnBoeSA8cm9iaW4u
bXVycGh5QGFybS5jb20+CkNjOiBFemVxdWllbCBHYXJjaWEgPGV6ZXF1aWVsQGNvbGxhYm9yYS5j
b20+CkNjOiBTaW1vbiBTZXIgPGNvbnRhY3RAZW1lcnNpb24uZnI+CkNjOiBKYW1lcyBKb25lcyA8
amFqb25lc0BudmlkaWEuY29tPgpDYzogbGludXgtbWVkaWFAdmdlci5rZXJuZWwub3JnCkNjOiBk
cmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClNpZ25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6
IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0Kdjc6CiogTWFqb3IgcmVmYWN0b3JpbmcgdG8g
dXNlIGRybV9wYWdlX3Bvb2xzIGluc2lkZSB0aGUKICB0dG1fcG9vbF90eXBlIHN0cnVjdHVyZS4g
VGhpcyBhbGxvd3MgdXMgdG8gdXNlIGNvbnRhaW5lcl9vZiB0bwogIGdldCB0aGUgbmVlZGVkIGNv
bnRleHQgdG8gZnJlZSBhIHBhZ2UuIFRoaXMgYWxzbyBtZWFucyBsZXNzCiAgY29kZSBpcyBjaGFu
Z2VkIG92ZXJhbGwuCnY4OgoqIFJld29ya2VkIHRvIHVzZSB0aGUgbmV3IGNsZWFubHkgcmV3cml0
dGVuIGRybV9wYWdlX3Bvb2wgbG9naWMKLS0tCiBkcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyAgICAg
ICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jIHwgMTU2ICsrKysrKy0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9wb29sLmggICAg
IHwgICA2ICstCiAzIGZpbGVzIGNoYW5nZWQsIDMxIGluc2VydGlvbnMoKyksIDEzMiBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1
L2RybS9LY29uZmlnCmluZGV4IDdjYmNlY2I4ZjdkZi4uYTZjYmRiNjNmNmM3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZwpA
QCAtMTg0LDYgKzE4NCw3IEBAIGNvbmZpZyBEUk1fUEFHRV9QT09MCiBjb25maWcgRFJNX1RUTQog
CXRyaXN0YXRlCiAJZGVwZW5kcyBvbiBEUk0gJiYgTU1VCisJc2VsZWN0IERSTV9QQUdFX1BPT0wK
IAloZWxwCiAJICBHUFUgbWVtb3J5IG1hbmFnZW1lbnQgc3Vic3lzdGVtIGZvciBkZXZpY2VzIHdp
dGggbXVsdGlwbGUKIAkgIEdQVSBtZW1vcnkgdHlwZXMuIFdpbGwgYmUgZW5hYmxlZCBhdXRvbWF0
aWNhbGx5IGlmIGEgZGV2aWNlIGRyaXZlcgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCmluZGV4IDZlMjdj
YjFiZjQ4Yi4uZjc0ZWE4MDFkN2FiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCkBAIC0zOSw2ICsz
OSw3IEBACiAjaW5jbHVkZSA8YXNtL3NldF9tZW1vcnkuaD4KICNlbmRpZgogCisjaW5jbHVkZSA8
ZHJtL3BhZ2VfcG9vbC5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX3Bvb2wuaD4KICNpbmNsdWRl
IDxkcm0vdHRtL3R0bV9ib19kcml2ZXIuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV90dC5oPgpA
QCAtNjgsOCArNjksNiBAQCBzdGF0aWMgc3RydWN0IHR0bV9wb29sX3R5cGUgZ2xvYmFsX2RtYTMy
X3dyaXRlX2NvbWJpbmVkW01BWF9PUkRFUl07CiBzdGF0aWMgc3RydWN0IHR0bV9wb29sX3R5cGUg
Z2xvYmFsX2RtYTMyX3VuY2FjaGVkW01BWF9PUkRFUl07CiAKIHN0YXRpYyBzdHJ1Y3QgbXV0ZXgg
c2hyaW5rZXJfbG9jazsKLXN0YXRpYyBzdHJ1Y3QgbGlzdF9oZWFkIHNocmlua2VyX2xpc3Q7Ci1z
dGF0aWMgc3RydWN0IHNocmlua2VyIG1tX3Nocmlua2VyOwogCiAvKiBBbGxvY2F0ZSBwYWdlcyBv
ZiBzaXplIDEgPDwgb3JkZXIgd2l0aCB0aGUgZ2l2ZW4gZ2ZwX2ZsYWdzICovCiBzdGF0aWMgc3Ry
dWN0IHBhZ2UgKnR0bV9wb29sX2FsbG9jX3BhZ2Uoc3RydWN0IHR0bV9wb29sICpwb29sLCBnZnBf
dCBnZnBfZmxhZ3MsCkBAIC0xMjUsOCArMTI0LDkgQEAgc3RhdGljIHN0cnVjdCBwYWdlICp0dG1f
cG9vbF9hbGxvY19wYWdlKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgZ2ZwX3QgZ2ZwX2ZsYWdzLAog
fQogCiAvKiBSZXNldCB0aGUgY2FjaGluZyBhbmQgcGFnZXMgb2Ygc2l6ZSAxIDw8IG9yZGVyICov
Ci1zdGF0aWMgdm9pZCB0dG1fcG9vbF9mcmVlX3BhZ2Uoc3RydWN0IHR0bV9wb29sICpwb29sLCBl
bnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IG9yZGVyLCBz
dHJ1Y3QgcGFnZSAqcCkKK3N0YXRpYyB1bnNpZ25lZCBsb25nIHR0bV9wb29sX2ZyZWVfcGFnZShz
dHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsCisJCQkJCWVudW0gdHRtX2NhY2hpbmcgY2FjaGluZywKKwkJ
CQkJdW5zaWduZWQgaW50IG9yZGVyLCBzdHJ1Y3QgcGFnZSAqcCkKIHsKIAl1bnNpZ25lZCBsb25n
IGF0dHIgPSBETUFfQVRUUl9GT1JDRV9DT05USUdVT1VTOwogCXN0cnVjdCB0dG1fcG9vbF9kbWEg
KmRtYTsKQEAgLTE0Miw3ICsxNDIsNyBAQCBzdGF0aWMgdm9pZCB0dG1fcG9vbF9mcmVlX3BhZ2Uo
c3RydWN0IHR0bV9wb29sICpwb29sLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcsCiAKIAlpZiAo
IXBvb2wgfHwgIXBvb2wtPnVzZV9kbWFfYWxsb2MpIHsKIAkJX19mcmVlX3BhZ2VzKHAsIG9yZGVy
KTsKLQkJcmV0dXJuOworCQlyZXR1cm4gMVVMIDw8IG9yZGVyOwogCX0KIAogCWlmIChvcmRlcikK
QEAgLTE1Myw2ICsxNTMsMTYgQEAgc3RhdGljIHZvaWQgdHRtX3Bvb2xfZnJlZV9wYWdlKHN0cnVj
dCB0dG1fcG9vbCAqcG9vbCwgZW51bSB0dG1fY2FjaGluZyBjYWNoaW5nLAogCWRtYV9mcmVlX2F0
dHJzKHBvb2wtPmRldiwgKDFVTCA8PCBvcmRlcikgKiBQQUdFX1NJWkUsIHZhZGRyLCBkbWEtPmFk
ZHIsCiAJCSAgICAgICBhdHRyKTsKIAlrZnJlZShkbWEpOworCXJldHVybiAxVUwgPDwgb3JkZXI7
Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nIHR0bV9zdWJwb29sX2ZyZWVfcGFnZShzdHJ1Y3Qg
ZHJtX3BhZ2VfcG9vbCAqc3VicG9vbCwKKwkJCQkJICAgc3RydWN0IHBhZ2UgKnApCit7CisJc3Ry
dWN0IHR0bV9wb29sX3R5cGUgKnB0OworCisJcHQgPSBjb250YWluZXJfb2Yoc3VicG9vbCwgc3Ry
dWN0IHR0bV9wb29sX3R5cGUsIHN1YnBvb2wpOworCXJldHVybiB0dG1fcG9vbF9mcmVlX3BhZ2Uo
cHQtPnBvb2wsIHB0LT5jYWNoaW5nLCBwdC0+b3JkZXIsIHApOwogfQogCiAvKiBBcHBseSBhIG5l
dyBjYWNoaW5nIHRvIGFuIGFycmF5IG9mIHBhZ2VzICovCkBAIC0yMTYsNDAgKzIyNiw2IEBAIHN0
YXRpYyB2b2lkIHR0bV9wb29sX3VubWFwKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgZG1hX2FkZHJf
dCBkbWFfYWRkciwKIAkJICAgICAgIERNQV9CSURJUkVDVElPTkFMKTsKIH0KIAotLyogR2l2ZSBw
YWdlcyBpbnRvIGEgc3BlY2lmaWMgcG9vbF90eXBlICovCi1zdGF0aWMgdm9pZCB0dG1fcG9vbF90
eXBlX2dpdmUoc3RydWN0IHR0bV9wb29sX3R5cGUgKnB0LCBzdHJ1Y3QgcGFnZSAqcCkKLXsKLQl1
bnNpZ25lZCBpbnQgaSwgbnVtX3BhZ2VzID0gMSA8PCBwdC0+b3JkZXI7Ci0KLQlmb3IgKGkgPSAw
OyBpIDwgbnVtX3BhZ2VzOyArK2kpIHsKLQkJaWYgKFBhZ2VIaWdoTWVtKHApKQotCQkJY2xlYXJf
aGlnaHBhZ2UocCArIGkpOwotCQllbHNlCi0JCQljbGVhcl9wYWdlKHBhZ2VfYWRkcmVzcyhwICsg
aSkpOwotCX0KLQotCXNwaW5fbG9jaygmcHQtPmxvY2spOwotCWxpc3RfYWRkKCZwLT5scnUsICZw
dC0+cGFnZXMpOwotCXNwaW5fdW5sb2NrKCZwdC0+bG9jayk7Ci0JYXRvbWljX2xvbmdfYWRkKDEg
PDwgcHQtPm9yZGVyLCAmYWxsb2NhdGVkX3BhZ2VzKTsKLX0KLQotLyogVGFrZSBwYWdlcyBmcm9t
IGEgc3BlY2lmaWMgcG9vbF90eXBlLCByZXR1cm4gTlVMTCB3aGVuIG5vdGhpbmcgYXZhaWxhYmxl
ICovCi1zdGF0aWMgc3RydWN0IHBhZ2UgKnR0bV9wb29sX3R5cGVfdGFrZShzdHJ1Y3QgdHRtX3Bv
b2xfdHlwZSAqcHQpCi17Ci0Jc3RydWN0IHBhZ2UgKnA7Ci0KLQlzcGluX2xvY2soJnB0LT5sb2Nr
KTsKLQlwID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZwdC0+cGFnZXMsIHR5cGVvZigqcCks
IGxydSk7Ci0JaWYgKHApIHsKLQkJYXRvbWljX2xvbmdfc3ViKDEgPDwgcHQtPm9yZGVyLCAmYWxs
b2NhdGVkX3BhZ2VzKTsKLQkJbGlzdF9kZWwoJnAtPmxydSk7Ci0JfQotCXNwaW5fdW5sb2NrKCZw
dC0+bG9jayk7Ci0KLQlyZXR1cm4gcDsKLX0KLQogLyogSW5pdGlhbGl6ZSBhbmQgYWRkIGEgcG9v
bCB0eXBlIHRvIHRoZSBnbG9iYWwgc2hyaW5rZXIgbGlzdCAqLwogc3RhdGljIHZvaWQgdHRtX3Bv
b2xfdHlwZV9pbml0KHN0cnVjdCB0dG1fcG9vbF90eXBlICpwdCwgc3RydWN0IHR0bV9wb29sICpw
b29sLAogCQkJICAgICAgIGVudW0gdHRtX2NhY2hpbmcgY2FjaGluZywgdW5zaWduZWQgaW50IG9y
ZGVyKQpAQCAtMjU3LDI1ICsyMzMsMTQgQEAgc3RhdGljIHZvaWQgdHRtX3Bvb2xfdHlwZV9pbml0
KHN0cnVjdCB0dG1fcG9vbF90eXBlICpwdCwgc3RydWN0IHR0bV9wb29sICpwb29sLAogCXB0LT5w
b29sID0gcG9vbDsKIAlwdC0+Y2FjaGluZyA9IGNhY2hpbmc7CiAJcHQtPm9yZGVyID0gb3JkZXI7
Ci0Jc3Bpbl9sb2NrX2luaXQoJnB0LT5sb2NrKTsKLQlJTklUX0xJU1RfSEVBRCgmcHQtPnBhZ2Vz
KTsKIAotCW11dGV4X2xvY2soJnNocmlua2VyX2xvY2spOwotCWxpc3RfYWRkX3RhaWwoJnB0LT5z
aHJpbmtlcl9saXN0LCAmc2hyaW5rZXJfbGlzdCk7Ci0JbXV0ZXhfdW5sb2NrKCZzaHJpbmtlcl9s
b2NrKTsKKwlkcm1fcGFnZV9wb29sX2luaXQoJnB0LT5zdWJwb29sLCBvcmRlciwgdHRtX3N1YnBv
b2xfZnJlZV9wYWdlKTsKIH0KIAogLyogUmVtb3ZlIGEgcG9vbF90eXBlIGZyb20gdGhlIGdsb2Jh
bCBzaHJpbmtlciBsaXN0IGFuZCBmcmVlIGFsbCBwYWdlcyAqLwogc3RhdGljIHZvaWQgdHRtX3Bv
b2xfdHlwZV9maW5pKHN0cnVjdCB0dG1fcG9vbF90eXBlICpwdCkKIHsKLQlzdHJ1Y3QgcGFnZSAq
cCwgKnRtcDsKLQotCW11dGV4X2xvY2soJnNocmlua2VyX2xvY2spOwotCWxpc3RfZGVsKCZwdC0+
c2hyaW5rZXJfbGlzdCk7Ci0JbXV0ZXhfdW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsKLQotCWxpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZShwLCB0bXAsICZwdC0+cGFnZXMsIGxydSkKLQkJdHRtX3Bvb2xf
ZnJlZV9wYWdlKHB0LT5wb29sLCBwdC0+Y2FjaGluZywgcHQtPm9yZGVyLCBwKTsKKwlkcm1fcGFn
ZV9wb29sX2ZpbmkoJnB0LT5zdWJwb29sKTsKIH0KIAogLyogUmV0dXJuIHRoZSBwb29sX3R5cGUg
dG8gdXNlIGZvciB0aGUgZ2l2ZW4gY2FjaGluZyBhbmQgb3JkZXIgKi8KQEAgLTMwNiwzMCArMjcx
LDYgQEAgc3RhdGljIHN0cnVjdCB0dG1fcG9vbF90eXBlICp0dG1fcG9vbF9zZWxlY3RfdHlwZShz
dHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsCiAJcmV0dXJuIE5VTEw7CiB9CiAKLS8qIEZyZWUgcGFnZXMg
dXNpbmcgdGhlIGdsb2JhbCBzaHJpbmtlciBsaXN0ICovCi1zdGF0aWMgdW5zaWduZWQgaW50IHR0
bV9wb29sX3Nocmluayh2b2lkKQotewotCXN0cnVjdCB0dG1fcG9vbF90eXBlICpwdDsKLQl1bnNp
Z25lZCBpbnQgbnVtX2ZyZWVkOwotCXN0cnVjdCBwYWdlICpwOwotCi0JbXV0ZXhfbG9jaygmc2hy
aW5rZXJfbG9jayk7Ci0JcHQgPSBsaXN0X2ZpcnN0X2VudHJ5KCZzaHJpbmtlcl9saXN0LCB0eXBl
b2YoKnB0KSwgc2hyaW5rZXJfbGlzdCk7Ci0KLQlwID0gdHRtX3Bvb2xfdHlwZV90YWtlKHB0KTsK
LQlpZiAocCkgewotCQl0dG1fcG9vbF9mcmVlX3BhZ2UocHQtPnBvb2wsIHB0LT5jYWNoaW5nLCBw
dC0+b3JkZXIsIHApOwotCQludW1fZnJlZWQgPSAxIDw8IHB0LT5vcmRlcjsKLQl9IGVsc2Ugewot
CQludW1fZnJlZWQgPSAwOwotCX0KLQotCWxpc3RfbW92ZV90YWlsKCZwdC0+c2hyaW5rZXJfbGlz
dCwgJnNocmlua2VyX2xpc3QpOwotCW11dGV4X3VubG9jaygmc2hyaW5rZXJfbG9jayk7Ci0KLQly
ZXR1cm4gbnVtX2ZyZWVkOwotfQotCiAvKiBSZXR1cm4gdGhlIGFsbG9jYXRpb24gb3JkZXIgYmFz
ZWQgZm9yIGEgcGFnZSAqLwogc3RhdGljIHVuc2lnbmVkIGludCB0dG1fcG9vbF9wYWdlX29yZGVy
KHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHBhZ2UgKnApCiB7CkBAIC0zODYsNyArMzI3
LDcgQEAgaW50IHR0bV9wb29sX2FsbG9jKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHR0
bV90dCAqdHQsCiAJCXN0cnVjdCB0dG1fcG9vbF90eXBlICpwdDsKIAogCQlwdCA9IHR0bV9wb29s
X3NlbGVjdF90eXBlKHBvb2wsIHR0LT5jYWNoaW5nLCBvcmRlcik7Ci0JCXAgPSBwdCA/IHR0bV9w
b29sX3R5cGVfdGFrZShwdCkgOiBOVUxMOworCQlwID0gcHQgPyBkcm1fcGFnZV9wb29sX3JlbW92
ZSgmcHQtPnN1YnBvb2wpIDogTlVMTDsKIAkJaWYgKHApIHsKIAkJCWFwcGx5X2NhY2hpbmcgPSB0
cnVlOwogCQl9IGVsc2UgewpAQCAtNDc5LDE2ICs0MjAsMTMgQEAgdm9pZCB0dG1fcG9vbF9mcmVl
KHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHR0bV90dCAqdHQpCiAKIAkJcHQgPSB0dG1f
cG9vbF9zZWxlY3RfdHlwZShwb29sLCB0dC0+Y2FjaGluZywgb3JkZXIpOwogCQlpZiAocHQpCi0J
CQl0dG1fcG9vbF90eXBlX2dpdmUocHQsIHR0LT5wYWdlc1tpXSk7CisJCQlkcm1fcGFnZV9wb29s
X2FkZCgmcHQtPnN1YnBvb2wsIHR0LT5wYWdlc1tpXSk7CiAJCWVsc2UKIAkJCXR0bV9wb29sX2Zy
ZWVfcGFnZShwb29sLCB0dC0+Y2FjaGluZywgb3JkZXIsCiAJCQkJCSAgIHR0LT5wYWdlc1tpXSk7
CiAKIAkJaSArPSBudW1fcGFnZXM7CiAJfQotCi0Jd2hpbGUgKGF0b21pY19sb25nX3JlYWQoJmFs
bG9jYXRlZF9wYWdlcykgPiBwYWdlX3Bvb2xfc2l6ZSkKLQkJdHRtX3Bvb2xfc2hyaW5rKCk7CiB9
CiBFWFBPUlRfU1lNQk9MKHR0bV9wb29sX2ZyZWUpOwogCkBAIC01MzcsMjEgKzQ3NSw2IEBAIHZv
aWQgdHRtX3Bvb2xfZmluaShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wpCiB9CiAKICNpZmRlZiBDT05G
SUdfREVCVUdfRlMKLS8qIENvdW50IHRoZSBudW1iZXIgb2YgcGFnZXMgYXZhaWxhYmxlIGluIGEg
cG9vbF90eXBlICovCi1zdGF0aWMgdW5zaWduZWQgaW50IHR0bV9wb29sX3R5cGVfY291bnQoc3Ry
dWN0IHR0bV9wb29sX3R5cGUgKnB0KQotewotCXVuc2lnbmVkIGludCBjb3VudCA9IDA7Ci0Jc3Ry
dWN0IHBhZ2UgKnA7Ci0KLQlzcGluX2xvY2soJnB0LT5sb2NrKTsKLQkvKiBPbmx5IHVzZWQgZm9y
IGRlYnVnZnMsIHRoZSBvdmVyaGVhZCBkb2Vzbid0IG1hdHRlciAqLwotCWxpc3RfZm9yX2VhY2hf
ZW50cnkocCwgJnB0LT5wYWdlcywgbHJ1KQotCQkrK2NvdW50OwotCXNwaW5fdW5sb2NrKCZwdC0+
bG9jayk7Ci0KLQlyZXR1cm4gY291bnQ7Ci19Ci0KIC8qIER1bXAgaW5mb3JtYXRpb24gYWJvdXQg
dGhlIGRpZmZlcmVudCBwb29sIHR5cGVzICovCiBzdGF0aWMgdm9pZCB0dG1fcG9vbF9kZWJ1Z2Zz
X29yZGVycyhzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQsCiAJCQkJICAgIHN0cnVjdCBzZXFfZmls
ZSAqbSkKQEAgLTU1OSw3ICs0ODIsOCBAQCBzdGF0aWMgdm9pZCB0dG1fcG9vbF9kZWJ1Z2ZzX29y
ZGVycyhzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQsCiAJdW5zaWduZWQgaW50IGk7CiAKIAlmb3Ig
KGkgPSAwOyBpIDwgTUFYX09SREVSOyArK2kpCi0JCXNlcV9wcmludGYobSwgIiAlOHUiLCB0dG1f
cG9vbF90eXBlX2NvdW50KCZwdFtpXSkpOworCQlzZXFfcHJpbnRmKG0sICIgJThsdSIsCisJCQkg
ICBkcm1fcGFnZV9wb29sX2dldF9zaXplKCZwdFtpXS5zdWJwb29sKSk7CiAJc2VxX3B1dHMobSwg
IlxuIik7CiB9CiAKQEAgLTYwOSw3ICs1MzMsMTAgQEAgaW50IHR0bV9wb29sX2RlYnVnZnMoc3Ry
dWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJfQogCiAJc2VxX3ByaW50
ZihtLCAiXG50b3RhbFx0OiAlOGx1IG9mICU4bHVcbiIsCi0JCSAgIGF0b21pY19sb25nX3JlYWQo
JmFsbG9jYXRlZF9wYWdlcyksIHBhZ2VfcG9vbF9zaXplKTsKKwkJICAgYXRvbWljX2xvbmdfcmVh
ZCgmYWxsb2NhdGVkX3BhZ2VzKSwKKwkJICAgZHJtX3BhZ2VfcG9vbF9nZXRfbWF4KCkpOworCXNl
cV9wcmludGYobSwgIiglOGx1IGluIG5vbi10dG0gcG9vbHMpXG4iLCBkcm1fcGFnZV9wb29sX2dl
dF90b3RhbCgpIC0KKwkJCQkJYXRvbWljX2xvbmdfcmVhZCgmYWxsb2NhdGVkX3BhZ2VzKSk7CiAK
IAltdXRleF91bmxvY2soJnNocmlua2VyX2xvY2spOwogCkBAIC02MTksMjggKzU0Niw2IEBAIEVY
UE9SVF9TWU1CT0wodHRtX3Bvb2xfZGVidWdmcyk7CiAKICNlbmRpZgogCi0vKiBBcyBsb25nIGFz
IHBhZ2VzIGFyZSBhdmFpbGFibGUgbWFrZSBzdXJlIHRvIHJlbGVhc2UgYXQgbGVhc3Qgb25lICov
Ci1zdGF0aWMgdW5zaWduZWQgbG9uZyB0dG1fcG9vbF9zaHJpbmtlcl9zY2FuKHN0cnVjdCBzaHJp
bmtlciAqc2hyaW5rLAotCQkJCQkgICAgc3RydWN0IHNocmlua19jb250cm9sICpzYykKLXsKLQl1
bnNpZ25lZCBsb25nIG51bV9mcmVlZCA9IDA7Ci0KLQlkbwotCQludW1fZnJlZWQgKz0gdHRtX3Bv
b2xfc2hyaW5rKCk7Ci0Jd2hpbGUgKCFudW1fZnJlZWQgJiYgYXRvbWljX2xvbmdfcmVhZCgmYWxs
b2NhdGVkX3BhZ2VzKSk7Ci0KLQlyZXR1cm4gbnVtX2ZyZWVkOwotfQotCi0vKiBSZXR1cm4gdGhl
IG51bWJlciBvZiBwYWdlcyBhdmFpbGFibGUgb3IgU0hSSU5LX0VNUFRZIGlmIHdlIGhhdmUgbm9u
ZSAqLwotc3RhdGljIHVuc2lnbmVkIGxvbmcgdHRtX3Bvb2xfc2hyaW5rZXJfY291bnQoc3RydWN0
IHNocmlua2VyICpzaHJpbmssCi0JCQkJCSAgICAgc3RydWN0IHNocmlua19jb250cm9sICpzYykK
LXsKLQl1bnNpZ25lZCBsb25nIG51bV9wYWdlcyA9IGF0b21pY19sb25nX3JlYWQoJmFsbG9jYXRl
ZF9wYWdlcyk7Ci0KLQlyZXR1cm4gbnVtX3BhZ2VzID8gbnVtX3BhZ2VzIDogU0hSSU5LX0VNUFRZ
OwotfQotCiAvKioKICAqIHR0bV9wb29sX21ncl9pbml0IC0gSW5pdGlhbGl6ZSBnbG9iYWxzCiAg
KgpAQCAtNjU1LDggKzU2MCw5IEBAIGludCB0dG1fcG9vbF9tZ3JfaW5pdCh1bnNpZ25lZCBsb25n
IG51bV9wYWdlcykKIAlpZiAoIXBhZ2VfcG9vbF9zaXplKQogCQlwYWdlX3Bvb2xfc2l6ZSA9IG51
bV9wYWdlczsKIAorCWRybV9wYWdlX3Bvb2xfc2V0X21heChwYWdlX3Bvb2xfc2l6ZSk7CisKIAlt
dXRleF9pbml0KCZzaHJpbmtlcl9sb2NrKTsKLQlJTklUX0xJU1RfSEVBRCgmc2hyaW5rZXJfbGlz
dCk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgTUFYX09SREVSOyArK2kpIHsKIAkJdHRtX3Bvb2xfdHlw
ZV9pbml0KCZnbG9iYWxfd3JpdGVfY29tYmluZWRbaV0sIE5VTEwsCkBAIC02NjksMTAgKzU3NSw3
IEBAIGludCB0dG1fcG9vbF9tZ3JfaW5pdCh1bnNpZ25lZCBsb25nIG51bV9wYWdlcykKIAkJCQkg
ICB0dG1fdW5jYWNoZWQsIGkpOwogCX0KIAotCW1tX3Nocmlua2VyLmNvdW50X29iamVjdHMgPSB0
dG1fcG9vbF9zaHJpbmtlcl9jb3VudDsKLQltbV9zaHJpbmtlci5zY2FuX29iamVjdHMgPSB0dG1f
cG9vbF9zaHJpbmtlcl9zY2FuOwotCW1tX3Nocmlua2VyLnNlZWtzID0gMTsKLQlyZXR1cm4gcmVn
aXN0ZXJfc2hyaW5rZXIoJm1tX3Nocmlua2VyKTsKKwlyZXR1cm4gMDsKIH0KIAogLyoqCkBAIC02
OTEsNyArNTk0LDQgQEAgdm9pZCB0dG1fcG9vbF9tZ3JfZmluaSh2b2lkKQogCQl0dG1fcG9vbF90
eXBlX2ZpbmkoJmdsb2JhbF9kbWEzMl93cml0ZV9jb21iaW5lZFtpXSk7CiAJCXR0bV9wb29sX3R5
cGVfZmluaSgmZ2xvYmFsX2RtYTMyX3VuY2FjaGVkW2ldKTsKIAl9Ci0KLQl1bnJlZ2lzdGVyX3No
cmlua2VyKCZtbV9zaHJpbmtlcik7Ci0JV0FSTl9PTighbGlzdF9lbXB0eSgmc2hyaW5rZXJfbGlz
dCkpOwogfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9wb29sLmggYi9pbmNsdWRl
L2RybS90dG0vdHRtX3Bvb2wuaAppbmRleCA0MzIxNzI4YmRkMTEuLjNkOTc1ODg4Y2U0NyAxMDA2
NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9wb29sLmgKKysrIGIvaW5jbHVkZS9kcm0vdHRt
L3R0bV9wb29sLmgKQEAgLTMwLDYgKzMwLDcgQEAKICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgog
I2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fY2FjaGlu
Zy5oPgorI2luY2x1ZGUgPGRybS9wYWdlX3Bvb2wuaD4KIAogc3RydWN0IGRldmljZTsKIHN0cnVj
dCB0dG1fdHQ7CkBAIC01MSwxMCArNTIsNyBAQCBzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSB7CiAJdW5z
aWduZWQgaW50IG9yZGVyOwogCWVudW0gdHRtX2NhY2hpbmcgY2FjaGluZzsKIAotCXN0cnVjdCBs
aXN0X2hlYWQgc2hyaW5rZXJfbGlzdDsKLQotCXNwaW5sb2NrX3QgbG9jazsKLQlzdHJ1Y3QgbGlz
dF9oZWFkIHBhZ2VzOworCXN0cnVjdCBkcm1fcGFnZV9wb29sIHN1YnBvb2w7CiB9OwogCiAvKioK
LS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
Cg==
