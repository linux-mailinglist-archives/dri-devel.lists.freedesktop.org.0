Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id ADC801E620D
	for <lists+dri-devel@lfdr.de>; Thu, 28 May 2020 15:22:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A967E6E532;
	Thu, 28 May 2020 13:22:56 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 814ED6E530
 for <dri-devel@lists.freedesktop.org>; Thu, 28 May 2020 13:22:48 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 36548D6E;
 Thu, 28 May 2020 06:22:48 -0700 (PDT)
Received: from [192.168.1.84] (unknown [172.31.20.19])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id AFDF83F52E;
 Thu, 28 May 2020 06:22:46 -0700 (PDT)
Subject: Re: [PATCH 05/15] drm/panfrost: use spinlock instead of atomic
To: =?UTF-8?B?Q2zDqW1lbnQgUMOpcm9u?= <peron.clem@gmail.com>,
 Rob Herring <robh@kernel.org>, Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Viresh Kumar <vireshk@kernel.org>, Nishanth Menon <nm@ti.com>,
 Stephen Boyd <sboyd@kernel.org>, Maxime Ripard <mripard@kernel.org>,
 Chen-Yu Tsai <wens@csie.org>
References: <20200510165538.19720-1-peron.clem@gmail.com>
 <20200510165538.19720-6-peron.clem@gmail.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <20155d49-fa2b-722e-9e9e-789838c07b61@arm.com>
Date: Thu, 28 May 2020 14:22:44 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.7.0
MIME-Version: 1.0
In-Reply-To: <20200510165538.19720-6-peron.clem@gmail.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMTAvMDUvMjAyMCAxNzo1NSwgQ2zDqW1lbnQgUMOpcm9uIHdyb3RlOgo+IENvbnZlcnQgYnVz
eV9jb3VudCB0byBhIHNpbXBsZSBpbnQgcHJvdGVjdGVkIGJ5IHNwaW5sb2NrLgo+IAo+IFNpZ25l
ZC1vZmYtYnk6IENsw6ltZW50IFDDqXJvbiA8cGVyb24uY2xlbUBnbWFpbC5jb20+CgpMb29rcyBs
aWtlIGEgZmFpcmx5IG1lY2hhbmljYWwgY2xlYW51cC4KClJldmlld2VkLWJ5OiBTdGV2ZW4gUHJp
Y2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgoKPiAtLS0KPiAgIGRyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9kZXZmcmVxLmMgfCA0MyArKysrKysrKysrKysrKystLS0tLS0KPiAgIGRy
aXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmggfCAxMCArKysrLQo+ICAg
MiBmaWxlcyBjaGFuZ2VkLCA0MSBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKPiAKPiBk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmZyZXEuYyBi
L2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmMKPiBpbmRleCA5NjI1
NTAzNjMzOTEuLjc4NzUzY2ZiNTlmYiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vcGFu
ZnJvc3QvcGFuZnJvc3RfZGV2ZnJlcS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L3BhbmZyb3N0X2RldmZyZXEuYwo+IEBAIC0xMiwxNiArMTIsMTIgQEAKPiAgIAo+ICAgc3RhdGlj
IHZvaWQgcGFuZnJvc3RfZGV2ZnJlcV91cGRhdGVfdXRpbGl6YXRpb24oc3RydWN0IHBhbmZyb3N0
X2RldmZyZXEgKnBmZGV2ZnJlcSkKPiAgIHsKPiAtCWt0aW1lX3Qgbm93Owo+IC0Ja3RpbWVfdCBs
YXN0Owo+IC0KPiAtCWlmICghcGZkZXZmcmVxLT5kZXZmcmVxKQo+IC0JCXJldHVybjsKPiArCWt0
aW1lX3Qgbm93LCBsYXN0Owo+ICAgCj4gICAJbm93ID0ga3RpbWVfZ2V0KCk7Cj4gICAJbGFzdCA9
IHBmZGV2ZnJlcS0+dGltZV9sYXN0X3VwZGF0ZTsKPiAgIAo+IC0JaWYgKGF0b21pY19yZWFkKCZw
ZmRldmZyZXEtPmJ1c3lfY291bnQpID4gMCkKPiArCWlmIChwZmRldmZyZXEtPmJ1c3lfY291bnQg
PiAwKQo+ICAgCQlwZmRldmZyZXEtPmJ1c3lfdGltZSArPSBrdGltZV9zdWIobm93LCBsYXN0KTsK
PiAgIAllbHNlCj4gICAJCXBmZGV2ZnJlcS0+aWRsZV90aW1lICs9IGt0aW1lX3N1Yihub3csIGxh
c3QpOwo+IEBAIC01OSwxMCArNTUsMTQgQEAgc3RhdGljIGludCBwYW5mcm9zdF9kZXZmcmVxX2dl
dF9kZXZfc3RhdHVzKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgIHsKPiAgIAlzdHJ1Y3QgcGFuZnJv
c3RfZGV2aWNlICpwZmRldiA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwo+ICAgCXN0cnVjdCBwYW5m
cm9zdF9kZXZmcmVxICpwZmRldmZyZXEgPSAmcGZkZXYtPnBmZGV2ZnJlcTsKPiArCXVuc2lnbmVk
IGxvbmcgaXJxZmxhZ3M7Cj4gKwo+ICsJc3RhdHVzLT5jdXJyZW50X2ZyZXF1ZW5jeSA9IGNsa19n
ZXRfcmF0ZShwZmRldi0+Y2xvY2spOwo+ICsKPiArCXNwaW5fbG9ja19pcnFzYXZlKCZwZmRldmZy
ZXEtPmxvY2ssIGlycWZsYWdzKTsKPiAgIAo+ICAgCXBhbmZyb3N0X2RldmZyZXFfdXBkYXRlX3V0
aWxpemF0aW9uKHBmZGV2ZnJlcSk7Cj4gICAKPiAtCXN0YXR1cy0+Y3VycmVudF9mcmVxdWVuY3kg
PSBjbGtfZ2V0X3JhdGUocGZkZXYtPmNsb2NrKTsKPiAgIAlzdGF0dXMtPnRvdGFsX3RpbWUgPSBr
dGltZV90b19ucyhrdGltZV9hZGQocGZkZXZmcmVxLT5idXN5X3RpbWUsCj4gICAJCQkJCQkgICBw
ZmRldmZyZXEtPmlkbGVfdGltZSkpOwo+ICAgCj4gQEAgLTcwLDYgKzcwLDggQEAgc3RhdGljIGlu
dCBwYW5mcm9zdF9kZXZmcmVxX2dldF9kZXZfc3RhdHVzKHN0cnVjdCBkZXZpY2UgKmRldiwKPiAg
IAo+ICAgCXBhbmZyb3N0X2RldmZyZXFfcmVzZXQocGZkZXZmcmVxKTsKPiAgIAo+ICsJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmcGZkZXZmcmVxLT5sb2NrLCBpcnFmbGFncyk7Cj4gKwo+ICAgCWRl
dl9kYmcocGZkZXYtPmRldiwgImJ1c3kgJWx1IHRvdGFsICVsdSAlbHUgJSUgZnJlcSAlbHUgTUh6
XG4iLAo+ICAgCQlzdGF0dXMtPmJ1c3lfdGltZSwgc3RhdHVzLT50b3RhbF90aW1lLAo+ICAgCQlz
dGF0dXMtPmJ1c3lfdGltZSAvIChzdGF0dXMtPnRvdGFsX3RpbWUgLyAxMDApLAo+IEBAIC0xMDAs
NiArMTAyLDggQEAgaW50IHBhbmZyb3N0X2RldmZyZXFfaW5pdChzdHJ1Y3QgcGFuZnJvc3RfZGV2
aWNlICpwZmRldikKPiAgIAllbHNlIGlmIChyZXQpCj4gICAJCXJldHVybiByZXQ7Cj4gICAKPiAr
CXNwaW5fbG9ja19pbml0KCZwZmRldmZyZXEtPmxvY2spOwo+ICsKPiAgIAlwYW5mcm9zdF9kZXZm
cmVxX3Jlc2V0KHBmZGV2ZnJlcSk7Cj4gICAKPiAgIAljdXJfZnJlcSA9IGNsa19nZXRfcmF0ZShw
ZmRldi0+Y2xvY2spOwo+IEBAIC0xNjIsMTUgKzE2NiwzMiBAQCB2b2lkIHBhbmZyb3N0X2RldmZy
ZXFfc3VzcGVuZChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKPiAgIAo+ICAgdm9pZCBw
YW5mcm9zdF9kZXZmcmVxX3JlY29yZF9idXN5KHN0cnVjdCBwYW5mcm9zdF9kZXZmcmVxICpwZmRl
dmZyZXEpCj4gICB7Cj4gKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwo+ICsKPiArCWlmICghcGZk
ZXZmcmVxLT5kZXZmcmVxKQo+ICsJCXJldHVybjsKPiArCj4gKwlzcGluX2xvY2tfaXJxc2F2ZSgm
cGZkZXZmcmVxLT5sb2NrLCBpcnFmbGFncyk7Cj4gKwo+ICAgCXBhbmZyb3N0X2RldmZyZXFfdXBk
YXRlX3V0aWxpemF0aW9uKHBmZGV2ZnJlcSk7Cj4gLQlhdG9taWNfaW5jKCZwZmRldmZyZXEtPmJ1
c3lfY291bnQpOwo+ICsKPiArCXBmZGV2ZnJlcS0+YnVzeV9jb3VudCsrOwo+ICsKPiArCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnBmZGV2ZnJlcS0+bG9jaywgaXJxZmxhZ3MpOwo+ICAgfQo+ICAg
Cj4gICB2b2lkIHBhbmZyb3N0X2RldmZyZXFfcmVjb3JkX2lkbGUoc3RydWN0IHBhbmZyb3N0X2Rl
dmZyZXEgKnBmZGV2ZnJlcSkKPiAgIHsKPiAtCWludCBjb3VudDsKPiArCXVuc2lnbmVkIGxvbmcg
aXJxZmxhZ3M7Cj4gKwo+ICsJaWYgKCFwZmRldmZyZXEtPmRldmZyZXEpCj4gKwkJcmV0dXJuOwo+
ICsKPiArCXNwaW5fbG9ja19pcnFzYXZlKCZwZmRldmZyZXEtPmxvY2ssIGlycWZsYWdzKTsKPiAg
IAo+ICAgCXBhbmZyb3N0X2RldmZyZXFfdXBkYXRlX3V0aWxpemF0aW9uKHBmZGV2ZnJlcSk7Cj4g
LQljb3VudCA9IGF0b21pY19kZWNfaWZfcG9zaXRpdmUoJnBmZGV2ZnJlcS0+YnVzeV9jb3VudCk7
Cj4gLQlXQVJOX09OKGNvdW50IDwgMCk7Cj4gKwo+ICsJV0FSTl9PTigtLXBmZGV2ZnJlcS0+YnVz
eV9jb3VudCA8IDApOwo+ICsKPiArCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBmZGV2ZnJlcS0+
bG9jaywgaXJxZmxhZ3MpOwo+ICAgfQo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFu
ZnJvc3QvcGFuZnJvc3RfZGV2ZnJlcS5oIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZy
b3N0X2RldmZyZXEuaAo+IGluZGV4IDA2OTdmOGQ1YWEzNC4uZTY2Mjk5MDBhNjE4IDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmgKPiArKysg
Yi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2ZnJlcS5oCj4gQEAgLTQsNiAr
NCw3IEBACj4gICAjaWZuZGVmIF9fUEFORlJPU1RfREVWRlJFUV9IX18KPiAgICNkZWZpbmUgX19Q
QU5GUk9TVF9ERVZGUkVRX0hfXwo+ICAgCj4gKyNpbmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgo+
ICAgI2luY2x1ZGUgPGxpbnV4L2t0aW1lLmg+Cj4gICAKPiAgIHN0cnVjdCBkZXZmcmVxOwo+IEBA
IC0xNCwxMCArMTUsMTcgQEAgc3RydWN0IHBhbmZyb3N0X2RldmljZTsKPiAgIHN0cnVjdCBwYW5m
cm9zdF9kZXZmcmVxIHsKPiAgIAlzdHJ1Y3QgZGV2ZnJlcSAqZGV2ZnJlcTsKPiAgIAlzdHJ1Y3Qg
dGhlcm1hbF9jb29saW5nX2RldmljZSAqY29vbGluZzsKPiArCj4gICAJa3RpbWVfdCBidXN5X3Rp
bWU7Cj4gICAJa3RpbWVfdCBpZGxlX3RpbWU7Cj4gICAJa3RpbWVfdCB0aW1lX2xhc3RfdXBkYXRl
Owo+IC0JYXRvbWljX3QgYnVzeV9jb3VudDsKPiArCWludCBidXN5X2NvdW50Owo+ICsJLyoKPiAr
CSAqIFByb3RlY3QgYnVzeV90aW1lLCBpZGxlX3RpbWUsIHRpbWVfbGFzdF91cGRhdGUgYW5kIGJ1
c3lfY291bnQKPiArCSAqIGJlY2F1c2UgdGhlc2UgY2FuIGJlIHVwZGF0ZWQgY29uY3VycmVudGx5
LCBmb3IgZXhhbXBsZSBieSB0aGUgR1AKPiArCSAqIGFuZCBQUCBpbnRlcnJ1cHRzLgo+ICsJICov
Cj4gKwlzcGlubG9ja190IGxvY2s7Cj4gICB9Owo+ICAgCj4gICBpbnQgcGFuZnJvc3RfZGV2ZnJl
cV9pbml0KHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KTsKPiAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
