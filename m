Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9672986550
	for <lists+dri-devel@lfdr.de>; Thu,  8 Aug 2019 17:12:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 57ECA6E86B;
	Thu,  8 Aug 2019 15:12:09 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 411276E864
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Aug 2019 15:12:06 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 639BB28CAB0;
 Thu,  8 Aug 2019 16:12:04 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH RFC 10/19] drm/bridge: Add a drm_bridge_state object
Date: Thu,  8 Aug 2019 17:11:41 +0200
Message-Id: <20190808151150.16336-11-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190808151150.16336-1-boris.brezillon@collabora.com>
References: <20190808151150.16336-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jernej Skrabec <jernej.skrabec@siol.net>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Neil Armstrong <narmstrong@baylibre.com>, Jonas Karlman <jonas@kwiboo.se>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Thierry Reding <thierry.reding@gmail.com>, Chris Healy <Chris.Healy@zii.aero>,
 Boris Brezillon <boris.brezillon@collabora.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T25lIG9mIHRoZSBsYXN0IHJlbWFpbmluZyBvYmplY3QgdG8gbm90IGhhdmUgaXRzIGF0b21pYyBz
dGF0ZS4KClRoaXMgaXMgYmVpbmcgbW90aXZhdGVkIGJ5IG91ciBhdHRlbXB0IHRvIHN1cHBvcnQg
cnVudGltZSBidXMtZm9ybWF0Cm5lZ290aWF0aW9uIGJldHdlZW4gZWxlbWVudHMgb2YgdGhlIGJy
aWRnZSBjaGFpbi4KVGhpcyBwYXRjaCBqdXN0IHBhdmVzIHRoZSByb2FkIGZvciBzdWNoIGEgZmVh
dHVyZSBieSBhZGRpbmcgYSBuZXcKZHJtX2JyaWRnZV9zdGF0ZSBvYmplY3QgaW5oZXJpdGluZyBm
cm9tIGRybV9wcml2YXRlX29iaiBzbyB3ZSBjYW4KcmUtdXNlIHNvbWUgb2YgdGhlIHN0YXRlIGlu
aXRpYWxpemF0aW9uL3RyYWNraW5nIGxvZ2ljLgoKU2lnbmVkLW9mZi1ieTogQm9yaXMgQnJlemls
bG9uIDxib3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pYy5jICAgICAgICB8ICA0MCArKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2RybV9h
dG9taWNfaGVscGVyLmMgfCAgMTggKysrKwogZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYyAg
ICAgICAgfCAxNDEgKysrKysrKysrKysrKysrKysrKysrKysrKysrLQogaW5jbHVkZS9kcm0vZHJt
X2F0b21pYy5oICAgICAgICAgICAgfCAgIDMgKwogaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oICAg
ICAgICAgICAgfCAgOTkgKysrKysrKysrKysrKysrKysrKwogNSBmaWxlcyBjaGFuZ2VkLCAyOTYg
aW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vZHJtX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwppbmRleCA0MTkz
ODFhYmJkZDEuLmVkNmZkM2UzMWI1NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9h
dG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCkBAIC0zMCw2ICszMCw3
IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgogI2luY2x1ZGUgPGRybS9kcm1fYXRv
bWljX3VhcGkuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2JyaWRnZS5oPgogI2luY2x1ZGUgPGRybS9k
cm1fZGVidWdmcy5oPgogI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CiAjaW5jbHVkZSA8ZHJt
L2RybV9kcnYuaD4KQEAgLTEwMTAsNiArMTAxMSw0NSBAQCBzdGF0aWMgdm9pZCBkcm1fYXRvbWlj
X2Nvbm5lY3Rvcl9wcmludF9zdGF0ZShzdHJ1Y3QgZHJtX3ByaW50ZXIgKnAsCiAJCWNvbm5lY3Rv
ci0+ZnVuY3MtPmF0b21pY19wcmludF9zdGF0ZShwLCBzdGF0ZSk7CiB9CiAKKy8qKgorICogZHJt
X2F0b21pY19hZGRfZW5jb2Rlcl9icmlkZ2VzIC0gYWRkIGJyaWRnZXMgYXR0YWNoZWQgdG8gYW4g
ZW5jb2RlcgorICogQHN0YXRlOiBhdG9taWMgc3RhdGUKKyAqIEBlbmNvZGVyOiBEUk0gZW5jb2Rl
cgorICoKKyAqIFRoaXMgZnVuY3Rpb24gYWRkcyBhbGwgYnJpZGdlcyBhdHRhY2hlZCB0byBAZW5j
b2Rlci4gVGhpcyBpcyBuZWVkZWQgdG8gYWRkCisgKiBicmlkZ2Ugc3RhdGVzIHRvIEBzdGF0ZSBh
bmQgbWFrZSB0aGVtIGF2YWlsYWJsZSB3aGVuCisgKiAmYnJpZGdlX2Z1bmNzLmF0b21pY197Y2hl
Y2sscHJlX2VuYWJsZSxlbmFibGUsZGlzYWJsZV9wb3N0X2Rpc2FibGV9KCkgYXJlCisgKiBjYWxs
ZWQKKyAqCisgKiBSZXR1cm5zOgorICogMCBvbiBzdWNjZXNzIG9yIGNhbiBmYWlsIHdpdGggLUVE
RUFETEsgb3IgLUVOT01FTS4gV2hlbiB0aGUgZXJyb3IgaXMgRURFQURMSworICogdGhlbiB0aGUg
dy93IG11dGV4IGNvZGUgaGFzIGRldGVjdGVkIGEgZGVhZGxvY2sgYW5kIHRoZSBlbnRpcmUgYXRv
bWljCisgKiBzZXF1ZW5jZSBtdXN0IGJlIHJlc3RhcnRlZC4gQWxsIG90aGVyIGVycm9ycyBhcmUg
ZmF0YWwuCisgKi8KK2ludAorZHJtX2F0b21pY19hZGRfZW5jb2Rlcl9icmlkZ2VzKHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIpCit7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKmJyaWRnZV9zdGF0ZTsKKwlzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOworCisJaWYgKCFlbmNvZGVyKQorCQlyZXR1cm4gMDsKKwor
CURSTV9ERUJVR19BVE9NSUMoIkFkZGluZyBhbGwgYnJpZGdlcyBmb3IgW2VuY29kZXI6JWQ6JXNd
IHRvICVwXG4iLAorCQkJIGVuY29kZXItPmJhc2UuaWQsIGVuY29kZXItPm5hbWUsIHN0YXRlKTsK
KworCWZvciAoYnJpZGdlID0gZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdlKGVuY29k
ZXIpOyBicmlkZ2U7CisJICAgICBicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dldF9uZXh0X2Jy
aWRnZShicmlkZ2UpKSB7CisJCWJyaWRnZV9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2JyaWRnZV9z
dGF0ZShzdGF0ZSwgYnJpZGdlKTsKKwkJaWYgKElTX0VSUihicmlkZ2Vfc3RhdGUpKQorCQkJcmV0
dXJuIFBUUl9FUlIoYnJpZGdlX3N0YXRlKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KK0VYUE9SVF9T
WU1CT0woZHJtX2F0b21pY19hZGRfZW5jb2Rlcl9icmlkZ2VzKTsKKwogLyoqCiAgKiBkcm1fYXRv
bWljX2FkZF9hZmZlY3RlZF9jb25uZWN0b3JzIC0gYWRkIGNvbm5lY3RvcnMgZm9yIGNydGMKICAq
IEBzdGF0ZTogYXRvbWljIHN0YXRlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0
b21pY19oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCmluZGV4
IDBkZWI1NDA5OTU3MC4uZTc2ZWM5NjQ4YjZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pY19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxw
ZXIuYwpAQCAtNzM2LDYgKzczNiwyNCBAQCBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19tb2Rlc2V0
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQlyZXR1cm4gcmV0OwogCX0KIAorCS8qCisJICog
SXRlcmF0ZSBvdmVyIGFsbCBjb25uZWN0b3JzIGFnYWluLCBhbmQgYWRkIGFsbCBhZmZlY3RlZCBi
cmlkZ2VzIHRvCisJICogdGhlIHN0YXRlLgorCSAqLworCWZvcl9lYWNoX29sZG5ld19jb25uZWN0
b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3Rvciwgb2xkX2Nvbm5lY3Rvcl9zdGF0ZSwgbmV3X2Nv
bm5lY3Rvcl9zdGF0ZSwgaSkgeworCQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisKKwkJ
ZW5jb2RlciA9IG9sZF9jb25uZWN0b3Jfc3RhdGUtPmJlc3RfZW5jb2RlcjsKKwkJcmV0ID0gZHJt
X2F0b21pY19hZGRfZW5jb2Rlcl9icmlkZ2VzKHN0YXRlLCBlbmNvZGVyKTsKKwkJaWYgKHJldCkK
KwkJCXJldHVybiByZXQ7CisKKwkJZW5jb2RlciA9IG5ld19jb25uZWN0b3Jfc3RhdGUtPmJlc3Rf
ZW5jb2RlcjsKKwkJcmV0ID0gZHJtX2F0b21pY19hZGRfZW5jb2Rlcl9icmlkZ2VzKHN0YXRlLCBl
bmNvZGVyKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCiAJcmV0ID0gbW9kZV92
YWxpZChzdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCmlu
ZGV4IGVkMjQxMGY0OTU4MS4uMDI4MGRhNmJlMWU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vZHJtX2JyaWRnZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMKQEAgLTg5
LDYgKzg5LDM4IEBAIHZvaWQgZHJtX2JyaWRnZV9yZW1vdmUoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSkKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9yZW1vdmUpOwogCitzdGF0aWMgc3Ry
dWN0IGRybV9wcml2YXRlX3N0YXRlICoKK2RybV9icmlkZ2VfYXRvbWljX2R1cGxpY2F0ZV9wcml2
X3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogKm9iaikKK3sKKwlzdHJ1Y3QgZHJtX2JyaWRn
ZSAqYnJpZGdlID0gZHJtX3ByaXZfdG9fYnJpZGdlKG9iaik7CisJc3RydWN0IGRybV9icmlkZ2Vf
c3RhdGUgKnN0YXRlOworCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kdXBsaWNhdGVfc3Rh
dGUpCisJCXN0YXRlID0gYnJpZGdlLT5mdW5jcy0+YXRvbWljX2R1cGxpY2F0ZV9zdGF0ZShicmlk
Z2UpOworCWVsc2UKKwkJc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9kdXBsaWNhdGVfYnJpZGdl
X3N0YXRlKGJyaWRnZSk7CisKKwlyZXR1cm4gJnN0YXRlLT5iYXNlOworfQorCitzdGF0aWMgdm9p
ZAorZHJtX2JyaWRnZV9hdG9taWNfZGVzdHJveV9wcml2X3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0
ZV9vYmogKm9iaiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
ZHJtX3ByaXZhdGVfc3RhdGUgKnMpCit7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRl
ID0gZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKHMpOworCXN0cnVjdCBkcm1fYnJpZGdlICpicmlk
Z2UgPSBkcm1fcHJpdl90b19icmlkZ2Uob2JqKTsKKworCWlmIChicmlkZ2UtPmZ1bmNzLT5hdG9t
aWNfZGVzdHJveV9zdGF0ZSkKKwkJYnJpZGdlLT5mdW5jcy0+YXRvbWljX2Rlc3Ryb3lfc3RhdGUo
YnJpZGdlLCBzdGF0ZSk7CisJZWxzZQorCQlkcm1fYXRvbWljX2hlbHBlcl9kZXN0cm95X2JyaWRn
ZV9zdGF0ZShicmlkZ2UsIHN0YXRlKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcHJp
dmF0ZV9zdGF0ZV9mdW5jcyBkcm1fYnJpZGdlX3ByaXZfc3RhdGVfZnVuY3MgPSB7CisJLmF0b21p
Y19kdXBsaWNhdGVfc3RhdGUgPSBkcm1fYnJpZGdlX2F0b21pY19kdXBsaWNhdGVfcHJpdl9zdGF0
ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYnJpZGdlX2F0b21pY19kZXN0cm95X3By
aXZfc3RhdGUsCit9OworCiAvKioKICAqIGRybV9icmlkZ2VfYXR0YWNoIC0gYXR0YWNoIHRoZSBi
cmlkZ2UgdG8gYW4gZW5jb2RlcidzIGNoYWluCiAgKgpAQCAtMTE0LDYgKzE0Niw3IEBAIEVYUE9S
VF9TWU1CT0woZHJtX2JyaWRnZV9yZW1vdmUpOwogaW50IGRybV9icmlkZ2VfYXR0YWNoKHN0cnVj
dCBkcm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJICAg
ICAgc3RydWN0IGRybV9icmlkZ2UgKnByZXZpb3VzKQogeworCXN0cnVjdCBkcm1fYnJpZGdlX3N0
YXRlICpzdGF0ZTsKIAlMSVNUX0hFQUQodG1wX2xpc3QpOwogCWludCByZXQ7CiAKQEAgLTEzMiwx
OSArMTY1LDM5IEBAIGludCBkcm1fYnJpZGdlX2F0dGFjaChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIsIHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAKIAlpZiAoYnJpZGdlLT5mdW5jcy0+
YXR0YWNoKSB7CiAJCXJldCA9IGJyaWRnZS0+ZnVuY3MtPmF0dGFjaChicmlkZ2UpOwotCQlpZiAo
cmV0IDwgMCkgewotCQkJYnJpZGdlLT5kZXYgPSBOVUxMOwotCQkJYnJpZGdlLT5lbmNvZGVyID0g
TlVMTDsKLQkJCXJldHVybiByZXQ7Ci0JCX0KKwkJaWYgKHJldCA8IDApCisJCQlnb3RvIGVycl9y
ZXNldF9icmlkZ2U7CiAJfQogCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kdXBsaWNhdGVf
c3RhdGUpCisJCXN0YXRlID0gYnJpZGdlLT5mdW5jcy0+YXRvbWljX2R1cGxpY2F0ZV9zdGF0ZShi
cmlkZ2UpOworCWVsc2UKKwkJc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9kdXBsaWNhdGVfYnJp
ZGdlX3N0YXRlKGJyaWRnZSk7CisKKwlpZiAoIXN0YXRlKSB7CisJCXJldCA9IC1FTk9NRU07CisJ
CWdvdG8gZXJyX2RldGFjaF9icmlkZ2U7CisJfQorCisJZHJtX2F0b21pY19wcml2YXRlX29ial9p
bml0KGJyaWRnZS0+ZGV2LCAmYnJpZGdlLT5iYXNlLAorCQkJCSAgICAmc3RhdGUtPmJhc2UsCisJ
CQkJICAgICZkcm1fYnJpZGdlX3ByaXZfc3RhdGVfZnVuY3MpOworCiAJaWYgKHByZXZpb3VzKQog
CQlsaXN0X3NwbGljZSgmdG1wX2xpc3QsICZwcmV2aW91cy0+Y2hhaW5fbm9kZSk7CiAJZWxzZQog
CQlsaXN0X3NwbGljZSgmdG1wX2xpc3QsICZlbmNvZGVyLT5icmlkZ2VfY2hhaW4pOwogCiAJcmV0
dXJuIDA7CisKK2Vycl9kZXRhY2hfYnJpZGdlOgorCWlmIChicmlkZ2UtPmZ1bmNzLT5kZXRhY2gp
CisJCWJyaWRnZS0+ZnVuY3MtPmRldGFjaChicmlkZ2UpOworCitlcnJfcmVzZXRfYnJpZGdlOgor
CWJyaWRnZS0+ZGV2ID0gTlVMTDsKKwlicmlkZ2UtPmVuY29kZXIgPSBOVUxMOworCXJldHVybiBy
ZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9icmlkZ2VfYXR0YWNoKTsKIApAQCAtMTU2LDYgKzIw
OSw4IEBAIHZvaWQgZHJtX2JyaWRnZV9kZXRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkK
IAlpZiAoV0FSTl9PTighYnJpZGdlLT5kZXYpKQogCQlyZXR1cm47CiAKKwlkcm1fYXRvbWljX3By
aXZhdGVfb2JqX2ZpbmkoJmJyaWRnZS0+YmFzZSk7CisKIAlpZiAoYnJpZGdlLT5mdW5jcy0+ZGV0
YWNoKQogCQlicmlkZ2UtPmZ1bmNzLT5kZXRhY2goYnJpZGdlKTsKIApAQCAtNDk1LDYgKzU1MCw4
MiBAQCB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIsCiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2Vu
YWJsZSk7CiAKKy8qKgorICogZHJtX2F0b21pY19oZWxwZXJfaW5pdF9icmlkZ2Vfc3RhdGUoKSAt
IEluaXRpYWxpemVzIGEgYnJpZGdlIHN0YXRlCisgKiBAYnJpZGdlIHRoaXMgc3RhdGUgaXMgcmVm
ZXJyaW5nIHRvCisgKiBAc3RhdGU6IGJyaWRnZSBzdGF0ZSB0byBpbml0aWFsaXplCisgKgorICog
Rm9yIG5vdyBpdCdzIGp1c3QgYSBtZW1zZXQoMCkgcGx1cyBhIHN0YXRlLT5icmlkZ2UgYXNzaWdu
bWVudC4gTWlnaHQKKyAqIGJlIGV4dGVuZGVkIGluIHRoZSBmdXR1cmUuCisgKi8KK3ZvaWQgZHJt
X2F0b21pY19oZWxwZXJfaW5pdF9icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKKwkJCQkJIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSkKK3sKKwltZW1zZXQoc3Rh
dGUsIDAsIHNpemVvZigqc3RhdGUpKTsKKwlzdGF0ZS0+YnJpZGdlID0gYnJpZGdlOworfQorRVhQ
T1JUX1NZTUJPTChkcm1fYXRvbWljX2hlbHBlcl9pbml0X2JyaWRnZV9zdGF0ZSk7CisKKy8qKgor
ICogZHJtX2F0b21pY19oZWxwZXJfY29weV9icmlkZ2Vfc3RhdGUoKSAtIENvcHkgdGhlIGNvbnRl
bnQgb2YgYSBicmlkZ2Ugc3RhdGUKKyAqIEBicmlkZ2U6IGJyaWRnZSB0aGUgb2xkIGFuZCBuZXcg
c3RhdGUgYXJlIHJlZmVycmluZyB0bworICogQG9sZDogcHJldmlvdXMgYnJpZGdlIHN0YXRlIHRv
IGNvcHkgZnJvbQorICogQG5ldzogbmV3IGJyaWRnZSBzdGF0ZSB0byBjb3B5IHRvCisgKgorICog
U2hvdWxkIGJlIHVzZWQgYnkgY3VzdG9tICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19kdXBsaWNh
dGUoKSBpbXBsZW1lbnRhdGlvbgorICogdG8gY29weSB0aGUgcHJldmlvdXMgc3RhdGUgaW50byB0
aGUgbmV3IG9iamVjdC4KKyAqLwordm9pZCBkcm1fYXRvbWljX2hlbHBlcl9jb3B5X2JyaWRnZV9z
dGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkgY29uc3Qgc3RydWN0IGRybV9i
cmlkZ2Vfc3RhdGUgKm9sZCwKKwkJCQkJIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpuZXcpCit7
CisJKm5ldyA9ICpvbGQ7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2NvcHlf
YnJpZGdlX3N0YXRlKTsKKworLyoqCisgKiBkcm1fYXRvbWljX2hlbHBlcl9kdXBsaWNhdGVfYnJp
ZGdlX3N0YXRlKCkgLSBEZWZhdWx0IGR1cGxpY2F0ZSBzdGF0ZSBoZWxwZXIKKyAqIEBicmlkZ2U6
IGJyaWRnZSBjb250YWluaW5nIHRoZSBzdGF0ZSB0byBkdXBsaWNhdGUKKyAqCisgKiBEZWZhdWx0
IGltcGxlbWVudGF0aW9uIG9mICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19kdXBsaWNhdGUoKS4K
KyAqCisgKiBSRVRVUk5TOgorICogYSB2YWxpZCBzdGF0ZSBvYmplY3Qgb3IgTlVMTCBpZiB0aGUg
YWxsb2NhdGlvbiBmYWlscy4KKyAqLworc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0
b21pY19oZWxwZXJfZHVwbGljYXRlX2JyaWRnZV9zdGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJp
ZGdlKQoreworCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpvbGQgPSBOVUxMLCAqbmV3OworCisJ
bmV3ID0ga3phbGxvYyhzaXplb2YoKm5ldyksIEdGUF9LRVJORUwpOworCWlmICghbmV3KQorCQly
ZXR1cm4gTlVMTDsKKworCWlmIChicmlkZ2UtPmJhc2Uuc3RhdGUpIHsKKwkJb2xkID0gZHJtX3By
aXZfdG9fYnJpZGdlX3N0YXRlKGJyaWRnZS0+YmFzZS5zdGF0ZSk7CisJCWRybV9hdG9taWNfaGVs
cGVyX2NvcHlfYnJpZGdlX3N0YXRlKGJyaWRnZSwgb2xkLCBuZXcpOworCX0gZWxzZSB7CisJCWRy
bV9hdG9taWNfaGVscGVyX2luaXRfYnJpZGdlX3N0YXRlKGJyaWRnZSwgbmV3KTsKKwl9CisKKwly
ZXR1cm4gbmV3OworfQorRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2hlbHBlcl9kdXBsaWNhdGVf
YnJpZGdlX3N0YXRlKTsKKworLyoqCisgKiBkcm1fYXRvbWljX2hlbHBlcl9kZXN0cm95X2JyaWRn
ZV9zdGF0ZSgpIC0gRGVmYXVsdCBkZXN0cm95IHN0YXRlIGhlbHBlcgorICogQGJyaWRnZTogdGhl
IGJyaWRnZSB0aGlzIHN0YXRlIHJlZmVycyB0bworICogQHN0YXRlOiBzdGF0ZSBvYmplY3QgdG8g
ZGVzdHJveQorICoKKyAqIEp1c3QgYSBzaW1wbGUga2ZyZWUoKSBmb3Igbm93LgorICovCit2b2lk
IGRybV9hdG9taWNfaGVscGVyX2Rlc3Ryb3lfYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsCisJCQkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpCit7CisJ
a2ZyZWUoc3RhdGUpOworfQorRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2hlbHBlcl9kZXN0cm95
X2JyaWRnZV9zdGF0ZSk7CisKICNpZmRlZiBDT05GSUdfT0YKIC8qKgogICogb2ZfZHJtX2ZpbmRf
YnJpZGdlIC0gZmluZCB0aGUgYnJpZGdlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRldmljZSBub2Rl
IGluCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmggYi9pbmNsdWRlL2RybS9k
cm1fYXRvbWljLmgKaW5kZXggOTI3ZTEyMDVkN2FhLi41ZWUyNWZkNTFlODAgMTAwNjQ0Ci0tLSBh
L2luY2x1ZGUvZHJtL2RybV9hdG9taWMuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmgK
QEAgLTY2MCw2ICs2NjAsOSBAQCBfX2RybV9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUo
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAogCXJldHVybiBwbGFuZS0+c3RhdGU7CiB9
CiAKK2ludCBfX211c3RfY2hlY2sKK2RybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKTsKIGludCBfX211c3RfY2hlY2sKIGRybV9h
dG9taWNfYWRkX2FmZmVjdGVkX2Nvbm5lY3RvcnMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCQkJCSAgIHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CmRpZmYgLS1naXQgYS9pbmNsdWRl
L2RybS9kcm1fYnJpZGdlLmggYi9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKaW5kZXggZjQwMTgx
Mjc0ZWQ3Li44Y2EyNWQyNjZkMGMgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2Uu
aAorKysgYi9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKQEAgLTI1LDYgKzI1LDcgQEAKIAogI2lu
Y2x1ZGUgPGxpbnV4L2xpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9jdHlwZS5oPgorI2luY2x1ZGUg
PGRybS9kcm1fYXRvbWljLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9tb2RlX29iamVjdC5oPgogI2lu
Y2x1ZGUgPGRybS9kcm1fbW9kZXMuaD4KIApAQCAtMzIsNiArMzMsMjMgQEAgc3RydWN0IGRybV9i
cmlkZ2U7CiBzdHJ1Y3QgZHJtX2JyaWRnZV90aW1pbmdzOwogc3RydWN0IGRybV9wYW5lbDsKIAor
LyoqCisgKiBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAtIEF0b21pYyBicmlkZ2Ugc3RhdGUgb2Jq
ZWN0CisgKiBAYmFzZTogaW5oZXJpdCBmcm9tICZkcm1fcHJpdmF0ZV9zdGF0ZQorICogQGJyaWRn
ZTogdGhlIGJyaWRnZSB0aGlzIHN0YXRlIHJlZmVycyB0bworICovCitzdHJ1Y3QgZHJtX2JyaWRn
ZV9zdGF0ZSB7CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlIGJhc2U7CisKKwlzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX2JyaWRnZV9z
dGF0ZSAqCitkcm1fcHJpdl90b19icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9wcml2YXRlX3N0YXRl
ICpwcml2KQoreworCXJldHVybiBjb250YWluZXJfb2YocHJpdiwgc3RydWN0IGRybV9icmlkZ2Vf
c3RhdGUsIGJhc2UpOworfQorCiAvKioKICAqIHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIC0gZHJt
X2JyaWRnZSBjb250cm9sIGZ1bmN0aW9ucwogICovCkBAIC0zMzcsNiArMzU1LDMwIEBAIHN0cnVj
dCBkcm1fYnJpZGdlX2Z1bmNzIHsKIAkgKi8KIAl2b2lkICgqYXRvbWljX3Bvc3RfZGlzYWJsZSko
c3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgICAgc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKTsKKworCS8qKgorCSAqIEBhdG9taWNfZHVwbGljYXRlX3N0YXRlOgorCSAqCisJ
ICogRHVwbGljYXRlIHRoZSBjdXJyZW50IGJyaWRnZSBzdGF0ZSBvYmplY3QuCisJICoKKwkgKiBO
b3RlIHRoYXQgdGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHdoZW4gY3VycmVudCBicmlkZ2Ug
c3RhdGUgaXMKKwkgKiBOVUxMLiBJbiB0aGlzIGNhc2UsIGltcGxlbWVudGF0aW9ucyBzaG91bGQg
ZWl0aGVyIGltcGxlbWVudCBIVworCSAqIHJlYWRiYWNrIG9yIGluaXRpYWxpemUgdGhlIHN0YXRl
IHdpdGggc2Vuc2libGUgZGVmYXVsdCB2YWx1ZXMuCisJICoKKwkgKiBSRVRVUk5TOgorCSAqIEEg
dmFsaWQgZHJtX2JyaWRnZV9zdGF0ZSBvYmplY3Qgb3IgTlVMTCBpZiB0aGUgYWxsb2NhdGlvbiBm
YWlscy4KKwkgKi8KKwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqKCphdG9taWNfZHVwbGljYXRl
X3N0YXRlKShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKKworCS8qKgorCSAqIEBhdG9taWNf
ZHVwbGljYXRlX3N0YXRlOgorCSAqCisJICogRGVzdHJveSBhIGJyaWRnZSBzdGF0ZSBvYmplY3Qg
cHJldmlvdXNseSBhbGxvY2F0ZWQgYnkKKwkgKiAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfZHVw
bGljYXRlX3N0YXRlKCkgb3IKKwkgKiAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfZ2V0X2luaXRp
YWxfc3RhdGUoKS4KKwkgKi8KKwl2b2lkICgqYXRvbWljX2Rlc3Ryb3lfc3RhdGUpKHN0cnVjdCBk
cm1fYnJpZGdlICpicmlkZ2UsCisJCQkJICAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3Rh
dGUpOwogfTsKIAogLyoqCkBAIC0zNzksNiArNDIxLDggQEAgc3RydWN0IGRybV9icmlkZ2VfdGlt
aW5ncyB7CiAgKiBzdHJ1Y3QgZHJtX2JyaWRnZSAtIGNlbnRyYWwgRFJNIGJyaWRnZSBjb250cm9s
IHN0cnVjdHVyZQogICovCiBzdHJ1Y3QgZHJtX2JyaWRnZSB7CisJLyoqIEBiYXNlOiBpbmhlcml0
IGZyb20gJmRybV9wcml2YXRlX29iamVjdCAqLworCXN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogYmFz
ZTsKIAkvKiogQGRldjogRFJNIGRldmljZSB0aGlzIGJyaWRnZSBiZWxvbmdzIHRvICovCiAJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldjsKIAkvKiogQGVuY29kZXI6IGVuY29kZXIgdG8gd2hpY2ggdGhp
cyBicmlkZ2UgaXMgY29ubmVjdGVkICovCkBAIC00MDMsNiArNDQ3LDEyIEBAIHN0cnVjdCBkcm1f
YnJpZGdlIHsKIAl2b2lkICpkcml2ZXJfcHJpdmF0ZTsKIH07CiAKK3N0YXRpYyBpbmxpbmUgc3Ry
dWN0IGRybV9icmlkZ2UgKgorZHJtX3ByaXZfdG9fYnJpZGdlKHN0cnVjdCBkcm1fcHJpdmF0ZV9v
YmogKnByaXYpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihwcml2LCBzdHJ1Y3QgZHJtX2JyaWRn
ZSwgYmFzZSk7Cit9CisKIHZvaWQgZHJtX2JyaWRnZV9hZGQoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSk7CiB2b2lkIGRybV9icmlkZ2VfcmVtb3ZlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
Owogc3RydWN0IGRybV9icmlkZ2UgKm9mX2RybV9maW5kX2JyaWRnZShzdHJ1Y3QgZGV2aWNlX25v
ZGUgKm5wKTsKQEAgLTQzOCw2ICs0ODgsNTUgQEAgdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFp
bl9wcmVfZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKIHZvaWQgZHJtX2F0b21p
Y19icmlkZ2VfY2hhaW5fZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
ICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAordm9pZCBkcm1fYXRvbWljX2hl
bHBlcl9pbml0X2JyaWRnZV9zdGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkg
c3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRlKTsKK3ZvaWQgZHJtX2F0b21pY19oZWxwZXJf
Y29weV9icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkJIGNvbnN0
IHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpvbGQsCisJCQkJCSBzdHJ1Y3QgZHJtX2JyaWRnZV9z
dGF0ZSAqbmV3KTsKK3N0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICoKK2RybV9hdG9taWNfaGVscGVy
X2R1cGxpY2F0ZV9icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSk7Cit2b2lk
IGRybV9hdG9taWNfaGVscGVyX2Rlc3Ryb3lfYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsCisJCQkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpOworCitz
dGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICoKK2RybV9hdG9taWNfZ2V0X2Jy
aWRnZV9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkgICAgc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKm9ial9z
dGF0ZTsKKworCW9ial9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X3ByaXZhdGVfb2JqX3N0YXRlKHN0
YXRlLCAmYnJpZGdlLT5iYXNlKTsKKwlpZiAoIW9ial9zdGF0ZSkKKwkJcmV0dXJuIE5VTEw7CisK
KwlyZXR1cm4gZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKG9ial9zdGF0ZSk7Cit9CisKK3N0YXRp
YyBpbmxpbmUgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0b21pY19nZXRfb2xkX2Jy
aWRnZV9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKm9ial9zdGF0
ZTsKKworCW9ial9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9wcml2YXRlX29ial9zdGF0ZShz
dGF0ZSwgJmJyaWRnZS0+YmFzZSk7CisJaWYgKCFvYmpfc3RhdGUpCisJCXJldHVybiBOVUxMOwor
CisJcmV0dXJuIGRybV9wcml2X3RvX2JyaWRnZV9zdGF0ZShvYmpfc3RhdGUpOworfQorCitzdGF0
aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICoKK2RybV9hdG9taWNfZ2V0X25ld19i
cmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCXN0cnVjdCBk
cm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpvYmpfc3Rh
dGU7CisKKwlvYmpfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfcHJpdmF0ZV9vYmpfc3RhdGUo
c3RhdGUsICZicmlkZ2UtPmJhc2UpOworCWlmICghb2JqX3N0YXRlKQorCQlyZXR1cm4gTlVMTDsK
KworCXJldHVybiBkcm1fcHJpdl90b19icmlkZ2Vfc3RhdGUob2JqX3N0YXRlKTsKK30KKwogI2lm
ZGVmIENPTkZJR19EUk1fUEFORUxfQlJJREdFCiBzdHJ1Y3QgZHJtX2JyaWRnZSAqZHJtX3BhbmVs
X2JyaWRnZV9hZGQoc3RydWN0IGRybV9wYW5lbCAqcGFuZWwsCiAJCQkJCXUzMiBjb25uZWN0b3Jf
dHlwZSk7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
