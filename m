Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D9BF6E84F
	for <lists+dri-devel@lfdr.de>; Fri, 19 Jul 2019 17:59:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1A0B06E847;
	Fri, 19 Jul 2019 15:59:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B73216E850
 for <dri-devel@lists.freedesktop.org>; Fri, 19 Jul 2019 15:59:39 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:55144
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hoVIH-0001bQ-I0; Fri, 19 Jul 2019 17:59:37 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 06/11] drm/tinydrm: Clean up tinydrm_spi_transfer()
Date: Fri, 19 Jul 2019 17:59:11 +0200
Message-Id: <20190719155916.62465-7-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190719155916.62465-1-noralf@tronnes.org>
References: <20190719155916.62465-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=LiUNcGnYfdGCYvsCugCRkD5OcPfhdRmx08JgCl4+gmI=; 
 b=gxx/6nlOk3btmIE+LuJTtyCVqs4IaXU+UP2ru14BGTA6diBWcXafgsntViekJLwsvw5Z3bUzlEaZNQP+1UNFX+wsXWkjtXt7Ma/Fa/m4mMHUhDX2wGvfn1tzDvJGfqIzuqBB5mWfxv/fIX6ZNaGXvbKSbsl4QfJlKDDe276Vmxf3xvhPp8gG2w045GUlPc8QXwC6CTwwBUSwpKd5PO7Q6vMBcr4hN6vHGu1kGom6o0UqxRW4ceSEvsJJdKFnnygKoFzaqk4/0j5HUHhs5kOqOGZasMnp4Yuof9wnDyH8Ora6Ji3HqwSlBlcZtSZsBkcfu4F0RjaqxfFvrT80ETcUcQ==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sam@ravnborg.org, david@lechnology.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UHJlcCB3b3JrIGJlZm9yZSBtb3ZpbmcgdGhlIGZ1bmN0aW9uIHRvIG1pcGktZGJpLgoKdGlueWRy
bV9zcGlfdHJhbnNmZXIoKSB3YXMgbWFkZSB0byBzdXBwb3J0IG9uZSBjbGFzcyBvZiBkcml2ZXJz
IGluCmRyaXZlcnMvc3RhZ2luZy9mYnRmdCB0aGF0IGhhcyBub3QgYmVlbiBjb252ZXJ0ZWQgdG8g
RFJNIHlldCwgc28gc3RyaXAKYXdheSB0aGUgdW51c2VkIGZ1bmN0aW9uYWxpdHk6Ci0gU3RhcnQg
Ynl0ZSAoaGVhZGVyKSBpcyBub3QgdXNlZC4KLSBObyBkcml2ZXIgcmVsaWVzIG9uIHRoZSBhdXRv
bWF0aWMgMTYtYml0IGJ5dGUgc3dhcHBpbmcgb24gbGl0dGxlIGVuZGlhbgogIG1hY2hpbmVzIHdp
dGggU1BJIGNvbnRyb2xsZXJzIG9ubHkgc3VwcG9ydGluZyA4IGJpdHMgcGVyIHdvcmQuCgpPdGhl
ciBjaGFuZ2VzOgotIE5vIG5lZWQgdG8gaW5pdGlhbGl6ZSByZXQKLSBObyBuZWVkIGZvciB0aGUg
V0FSTiBzaW5jZSBtaXBpLWRiaSBvbmx5IHVzZXMgOCBhbmQgMTYgYnB3LgotIFVzZSBzcGlfbWVz
c2FnZV9pbml0X3dpdGhfdHJhbnNmZXJzKCkKCkNjOiBEYXZpZCBMZWNobmVyIDxkYXZpZEBsZWNo
bm9sb2d5LmNvbT4KQWNrZWQtYnk6IDogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9neS5j
b20+ClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgot
LS0KIC4uLi9ncHUvZHJtL3Rpbnlkcm0vY29yZS90aW55ZHJtLWhlbHBlcnMuYyAgICB8IDQwICsr
LS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYyAgICAg
ICAgICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vdGlueWRybS9taXBpLWRiaS5jICAgICAg
ICAgICAgfCAgNCArLQogaW5jbHVkZS9kcm0vdGlueWRybS90aW55ZHJtLWhlbHBlcnMuaCAgICAg
ICAgIHwgIDMgKy0KIDQgZmlsZXMgY2hhbmdlZCwgOSBpbnNlcnRpb25zKCspLCA0MiBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9jb3JlL3Rpbnlkcm0t
aGVscGVycy5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vY29yZS90aW55ZHJtLWhlbHBlcnMu
YwppbmRleCBhZjViZWM4ODYxZGUuLmQ5NWViNTBmYTlkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3Rpbnlkcm0vY29yZS90aW55ZHJtLWhlbHBlcnMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vdGlueWRybS9jb3JlL3Rpbnlkcm0taGVscGVycy5jCkBAIC0yNCwyMyArMjQsMTggQEAKICAq
IHRpbnlkcm1fc3BpX3RyYW5zZmVyIC0gU1BJIHRyYW5zZmVyIGhlbHBlcgogICogQHNwaTogU1BJ
IGRldmljZQogICogQHNwZWVkX2h6OiBPdmVycmlkZSBzcGVlZCAob3B0aW9uYWwpCi0gKiBAaGVh
ZGVyOiBPcHRpb25hbCBoZWFkZXIgdHJhbnNmZXIKICAqIEBicHc6IEJpdHMgcGVyIHdvcmQKICAq
IEBidWY6IEJ1ZmZlciB0byB0cmFuc2ZlcgogICogQGxlbjogQnVmZmVyIGxlbmd0aAogICoKICAq
IFRoaXMgU1BJIHRyYW5zZmVyIGhlbHBlciBicmVha3MgdXAgdGhlIHRyYW5zZmVyIG9mIEBidWYg
aW50byBjaHVua3Mgd2hpY2gKLSAqIHRoZSBTUEkgbWFzdGVyIGRyaXZlciBjYW4gaGFuZGxlLiBJ
ZiB0aGUgbWFjaGluZSBpcyBMaXR0bGUgRW5kaWFuIGFuZCB0aGUKLSAqIFNQSSBtYXN0ZXIgZHJp
dmVyIGRvZXNuJ3Qgc3VwcG9ydCAxNiBiaXRzIHBlciB3b3JkLCBpdCBzd2FwcyB0aGUgYnl0ZXMg
YW5kCi0gKiBkb2VzIGEgOC1iaXQgdHJhbnNmZXIuCi0gKiBJZiBAaGVhZGVyIGlzIHNldCwgaXQg
aXMgcHJlcGVuZGVkIHRvIGVhY2ggU1BJIG1lc3NhZ2UuCisgKiB0aGUgU1BJIGNvbnRyb2xsZXIg
ZHJpdmVyIGNhbiBoYW5kbGUuCiAgKgogICogUmV0dXJuczoKICAqIFplcm8gb24gc3VjY2Vzcywg
bmVnYXRpdmUgZXJyb3IgY29kZSBvbiBmYWlsdXJlLgogICovCiBpbnQgdGlueWRybV9zcGlfdHJh
bnNmZXIoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSwgdTMyIHNwZWVkX2h6LAotCQkJIHN0cnVjdCBz
cGlfdHJhbnNmZXIgKmhlYWRlciwgdTggYnB3LCBjb25zdCB2b2lkICpidWYsCi0JCQkgc2l6ZV90
IGxlbikKKwkJCSB1OCBicHcsIGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKIHsKIAlzaXpl
X3QgbWF4X2NodW5rID0gc3BpX21heF90cmFuc2Zlcl9zaXplKHNwaSk7CiAJc3RydWN0IHNwaV90
cmFuc2ZlciB0ciA9IHsKQEAgLTQ4LDQzICs0MywxNiBAQCBpbnQgdGlueWRybV9zcGlfdHJhbnNm
ZXIoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSwgdTMyIHNwZWVkX2h6LAogCQkuc3BlZWRfaHogPSBz
cGVlZF9oeiwKIAl9OwogCXN0cnVjdCBzcGlfbWVzc2FnZSBtOwotCXUxNiAqc3dhcF9idWYgPSBO
VUxMOwogCXNpemVfdCBjaHVuazsKLQlpbnQgcmV0ID0gMDsKKwlpbnQgcmV0OwogCi0JaWYgKFdB
Uk5fT05fT05DRShicHcgIT0gOCAmJiBicHcgIT0gMTYpKQotCQlyZXR1cm4gLUVJTlZBTDsKLQot
CWlmIChicHcgPT0gMTYgJiYgIXNwaV9pc19icHdfc3VwcG9ydGVkKHNwaSwgMTYpKSB7Ci0JCXRy
LmJpdHNfcGVyX3dvcmQgPSA4OwotCQlpZiAodGlueWRybV9tYWNoaW5lX2xpdHRsZV9lbmRpYW4o
KSkgewotCQkJc3dhcF9idWYgPSBrbWFsbG9jKG1pbihsZW4sIG1heF9jaHVuayksIEdGUF9LRVJO
RUwpOwotCQkJaWYgKCFzd2FwX2J1ZikKLQkJCQlyZXR1cm4gLUVOT01FTTsKLQkJfQotCX0KLQot
CXNwaV9tZXNzYWdlX2luaXQoJm0pOwotCWlmIChoZWFkZXIpCi0JCXNwaV9tZXNzYWdlX2FkZF90
YWlsKGhlYWRlciwgJm0pOwotCXNwaV9tZXNzYWdlX2FkZF90YWlsKCZ0ciwgJm0pOworCXNwaV9t
ZXNzYWdlX2luaXRfd2l0aF90cmFuc2ZlcnMoJm0sICZ0ciwgMSk7CiAKIAl3aGlsZSAobGVuKSB7
CiAJCWNodW5rID0gbWluKGxlbiwgbWF4X2NodW5rKTsKIAogCQl0ci50eF9idWYgPSBidWY7CiAJ
CXRyLmxlbiA9IGNodW5rOwotCi0JCWlmIChzd2FwX2J1ZikgewotCQkJY29uc3QgdTE2ICpidWYx
NiA9IGJ1ZjsKLQkJCXVuc2lnbmVkIGludCBpOwotCi0JCQlmb3IgKGkgPSAwOyBpIDwgY2h1bmsg
LyAyOyBpKyspCi0JCQkJc3dhcF9idWZbaV0gPSBzd2FiMTYoYnVmMTZbaV0pOwotCi0JCQl0ci50
eF9idWYgPSBzd2FwX2J1ZjsKLQkJfQotCiAJCWJ1ZiArPSBjaHVuazsKIAkJbGVuIC09IGNodW5r
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMgYi9kcml2
ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKaW5kZXggN2E4ZTFiNGEzN2VlLi4yMTY3N2Uz
ZWQzOGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKQEAgLTMyMyw3ICszMjMsNyBAQCBz
dGF0aWMgaW50IGlsaTkyMjVfZGJpX2NvbW1hbmQoc3RydWN0IG1pcGlfZGJpICptaXBpLCB1OCAq
Y21kLCB1OCAqcGFyLAogCiAJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKG1pcGktPmRjLCAwKTsK
IAlzcGVlZF9oeiA9IG1pcGlfZGJpX3NwaV9jbWRfbWF4X3NwZWVkKHNwaSwgMSk7Ci0JcmV0ID0g
dGlueWRybV9zcGlfdHJhbnNmZXIoc3BpLCBzcGVlZF9oeiwgTlVMTCwgOCwgY21kLCAxKTsKKwly
ZXQgPSB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVkX2h6LCA4LCBjbWQsIDEpOwogCWlm
IChyZXQgfHwgIW51bSkKIAkJcmV0dXJuIHJldDsKIApAQCAtMzMzLDcgKzMzMyw3IEBAIHN0YXRp
YyBpbnQgaWxpOTIyNV9kYmlfY29tbWFuZChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIHU4ICpjbWQs
IHU4ICpwYXIsCiAJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKG1pcGktPmRjLCAxKTsKIAlzcGVl
ZF9oeiA9IG1pcGlfZGJpX3NwaV9jbWRfbWF4X3NwZWVkKHNwaSwgbnVtKTsKIAotCXJldHVybiB0
aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVkX2h6LCBOVUxMLCBicHcsIHBhciwgbnVtKTsK
KwlyZXR1cm4gdGlueWRybV9zcGlfdHJhbnNmZXIoc3BpLCBzcGVlZF9oeiwgYnB3LCBwYXIsIG51
bSk7CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVu
Y3MgaWxpOTIyNV9waXBlX2Z1bmNzID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rp
bnlkcm0vbWlwaS1kYmkuYyBiL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL21pcGktZGJpLmMKaW5k
ZXggYWUzMWE1YzlhYTFiLi44ZmI2Y2U0Y2E2ZmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS90aW55ZHJtL21pcGktZGJpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1k
YmkuYwpAQCAtOTI2LDcgKzkyNiw3IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfdHlwZWMzX2NvbW1h
bmQoc3RydWN0IG1pcGlfZGJpICptaXBpLCB1OCAqY21kLAogCiAJZ3Bpb2Rfc2V0X3ZhbHVlX2Nh
bnNsZWVwKG1pcGktPmRjLCAwKTsKIAlzcGVlZF9oeiA9IG1pcGlfZGJpX3NwaV9jbWRfbWF4X3Nw
ZWVkKHNwaSwgMSk7Ci0JcmV0ID0gdGlueWRybV9zcGlfdHJhbnNmZXIoc3BpLCBzcGVlZF9oeiwg
TlVMTCwgOCwgY21kLCAxKTsKKwlyZXQgPSB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVk
X2h6LCA4LCBjbWQsIDEpOwogCWlmIChyZXQgfHwgIW51bSkKIAkJcmV0dXJuIHJldDsKIApAQCAt
OTM2LDcgKzkzNiw3IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfdHlwZWMzX2NvbW1hbmQoc3RydWN0
IG1pcGlfZGJpICptaXBpLCB1OCAqY21kLAogCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVlcChtaXBp
LT5kYywgMSk7CiAJc3BlZWRfaHogPSBtaXBpX2RiaV9zcGlfY21kX21heF9zcGVlZChzcGksIG51
bSk7CiAKLQlyZXR1cm4gdGlueWRybV9zcGlfdHJhbnNmZXIoc3BpLCBzcGVlZF9oeiwgTlVMTCwg
YnB3LCBwYXIsIG51bSk7CisJcmV0dXJuIHRpbnlkcm1fc3BpX3RyYW5zZmVyKHNwaSwgc3BlZWRf
aHosIGJwdywgcGFyLCBudW0pOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3Rp
bnlkcm0vdGlueWRybS1oZWxwZXJzLmggYi9pbmNsdWRlL2RybS90aW55ZHJtL3Rpbnlkcm0taGVs
cGVycy5oCmluZGV4IDEwYjM1Mzc1YTAwOS4uNzA4YzVhN2Q1MWUwIDEwMDY0NAotLS0gYS9pbmNs
dWRlL2RybS90aW55ZHJtL3Rpbnlkcm0taGVscGVycy5oCisrKyBiL2luY2x1ZGUvZHJtL3Rpbnlk
cm0vdGlueWRybS1oZWxwZXJzLmgKQEAgLTQyLDcgKzQyLDYgQEAgaW50IHRpbnlkcm1fZGlzcGxh
eV9waXBlX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwKIAkJCSAgICAgIHVuc2lnbmVkIGlu
dCByb3RhdGlvbik7CiAKIGludCB0aW55ZHJtX3NwaV90cmFuc2ZlcihzdHJ1Y3Qgc3BpX2Rldmlj
ZSAqc3BpLCB1MzIgc3BlZWRfaHosCi0JCQkgc3RydWN0IHNwaV90cmFuc2ZlciAqaGVhZGVyLCB1
OCBicHcsIGNvbnN0IHZvaWQgKmJ1ZiwKLQkJCSBzaXplX3QgbGVuKTsKKwkJCSB1OCBicHcsIGNv
bnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbik7CiAKICNlbmRpZiAvKiBfX0xJTlVYX1RJTllEUk1f
SEVMUEVSU19IICovCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
