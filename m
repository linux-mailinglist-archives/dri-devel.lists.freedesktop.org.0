Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 08CD44E786
	for <lists+dri-devel@lfdr.de>; Fri, 21 Jun 2019 13:58:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4C71F6E88B;
	Fri, 21 Jun 2019 11:58:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 65B616E882;
 Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id EF56283F3B;
 Fri, 21 Jun 2019 11:58:00 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-212.ams2.redhat.com
 [10.36.116.212])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 2CA8561101;
 Fri, 21 Jun 2019 11:58:00 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id EA55117536; Fri, 21 Jun 2019 13:57:56 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 05/18] drm/amdgpu: use embedded gem object
Date: Fri, 21 Jun 2019 13:57:42 +0200
Message-Id: <20190621115755.8481-6-kraxel@redhat.com>
In-Reply-To: <20190621115755.8481-1-kraxel@redhat.com>
References: <20190621115755.8481-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.27]); Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, ckoenig.leichtzumerken@gmail.com,
 open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Gerd Hoffmann <kraxel@redhat.com>, Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHJvcCBkcm1fZ2VtX29iamVjdCBmcm9tIGFtZGdwdV9ibywgdXNlIHRoZQp0dG1fYnVmZmVyX29i
amVjdC5iYXNlIGluc3RlYWQuCgpCdWlsZCB0ZXN0ZWQgb25seS4KClNpZ25lZC1vZmYtYnk6IEdl
cmQgSG9mZm1hbm4gPGtyYXhlbEByZWRoYXQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9nZW0uaCAgICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfb2JqZWN0LmggIHwgMSAtCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZG1hX2J1Zi5jIHwgMiArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dl
bS5jICAgICB8IDggKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9v
YmplY3QuYyAgfCA4ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dHRtLmMgICAgIHwgMiArLQogNiBmaWxlcyBjaGFuZ2VkLCAxMSBpbnNlcnRpb25zKCspLCAxMiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZ2VtLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmgKaW5kZXgg
YjhiYTZlMjdjNjFmLi4yZjE3MTUwZTI2ZTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9nZW0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZ2VtLmgKQEAgLTMxLDcgKzMxLDcgQEAKICAqLwogCiAjZGVmaW5lIEFNREdQVV9HRU1f
RE9NQUlOX01BWAkJMHgzCi0jZGVmaW5lIGdlbV90b19hbWRncHVfYm8oZ29iaikgY29udGFpbmVy
X29mKChnb2JqKSwgc3RydWN0IGFtZGdwdV9ibywgZ2VtX2Jhc2UpCisjZGVmaW5lIGdlbV90b19h
bWRncHVfYm8oZ29iaikgY29udGFpbmVyX29mKChnb2JqKSwgc3RydWN0IGFtZGdwdV9ibywgdGJv
LmJhc2UpCiAKIHZvaWQgYW1kZ3B1X2dlbV9vYmplY3RfZnJlZShzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3QgKm9iaik7CiBpbnQgYW1kZ3B1X2dlbV9vYmplY3Rfb3BlbihzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3QgKm9iaiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9v
YmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuaAppbmRl
eCBjNDMwZTgyNTkwMzguLmE4MGE5OTcyYWQxNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9vYmplY3QuaApAQCAtOTQsNyArOTQsNiBAQCBzdHJ1Y3QgYW1kZ3B1X2JvIHsK
IAkvKiBwZXIgVk0gc3RydWN0dXJlIGZvciBwYWdlIHRhYmxlcyBhbmQgd2l0aCB2aXJ0dWFsIGFk
ZHJlc3NlcyAqLwogCXN0cnVjdCBhbWRncHVfdm1fYm9fYmFzZQkqdm1fYm87CiAJLyogQ29uc3Rh
bnQgYWZ0ZXIgaW5pdGlhbGl6YXRpb24gKi8KLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QJCWdlbV9i
YXNlOwogCXN0cnVjdCBhbWRncHVfYm8JCSpwYXJlbnQ7CiAJc3RydWN0IGFtZGdwdV9ibwkJKnNo
YWRvdzsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rt
YV9idWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKaW5k
ZXggNDg5MDQxZGYxZjQ1Li5jNTY4MTliY2FkOGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2RtYV9idWYuYwpAQCAtNDA5LDcgKzQwOSw3IEBAIGFtZGdwdV9nZW1fcHJp
bWVfaW1wb3J0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCWJvLT5wcmltZV9z
aGFyZWRfY291bnQgPSAxOwogCiAJd3dfbXV0ZXhfdW5sb2NrKCZyZXN2LT5sb2NrKTsKLQlyZXR1
cm4gJmJvLT5nZW1fYmFzZTsKKwlyZXR1cm4gJmJvLT50Ym8uYmFzZTsKIAogZXJyb3I6CiAJd3df
bXV0ZXhfdW5sb2NrKCZyZXN2LT5sb2NrKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9nZW0uYwppbmRleCAzN2I1MjZjNmY0OTQuLjZkOTkxZThkZjM1NyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9nZW0uYwpAQCAtODUsNyArODUsNyBAQCBpbnQgYW1kZ3B1X2dl
bV9vYmplY3RfY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1bnNpZ25lZCBsb25n
IHNpemUsCiAJCX0KIAkJcmV0dXJuIHI7CiAJfQotCSpvYmogPSAmYm8tPmdlbV9iYXNlOworCSpv
YmogPSAmYm8tPnRiby5iYXNlOwogCiAJcmV0dXJuIDA7CiB9CkBAIC02OTAsNyArNjkwLDcgQEAg
aW50IGFtZGdwdV9nZW1fb3BfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAkJc3RydWN0IGRybV9hbWRncHVfZ2VtX2NyZWF0ZV9pbiBpbmZvOwogCQl2b2lkIF9fdXNl
ciAqb3V0ID0gdTY0X3RvX3VzZXJfcHRyKGFyZ3MtPnZhbHVlKTsKIAotCQlpbmZvLmJvX3NpemUg
PSByb2JqLT5nZW1fYmFzZS5zaXplOworCQlpbmZvLmJvX3NpemUgPSByb2JqLT50Ym8uYmFzZS5z
aXplOwogCQlpbmZvLmFsaWdubWVudCA9IHJvYmotPnRiby5tZW0ucGFnZV9hbGlnbm1lbnQgPDwg
UEFHRV9TSElGVDsKIAkJaW5mby5kb21haW5zID0gcm9iai0+cHJlZmVycmVkX2RvbWFpbnM7CiAJ
CWluZm8uZG9tYWluX2ZsYWdzID0gcm9iai0+ZmxhZ3M7CkBAIC04MjAsOCArODIwLDggQEAgc3Rh
dGljIGludCBhbWRncHVfZGVidWdmc19nZW1fYm9faW5mbyhpbnQgaWQsIHZvaWQgKnB0ciwgdm9p
ZCAqZGF0YSkKIAlpZiAocGluX2NvdW50KQogCQlzZXFfcHJpbnRmKG0sICIgcGluIGNvdW50ICVk
IiwgcGluX2NvdW50KTsKIAotCWRtYV9idWYgPSBSRUFEX09OQ0UoYm8tPmdlbV9iYXNlLmRtYV9i
dWYpOwotCWF0dGFjaG1lbnQgPSBSRUFEX09OQ0UoYm8tPmdlbV9iYXNlLmltcG9ydF9hdHRhY2gp
OworCWRtYV9idWYgPSBSRUFEX09OQ0UoYm8tPnRiby5iYXNlLmRtYV9idWYpOworCWF0dGFjaG1l
bnQgPSBSRUFEX09OQ0UoYm8tPnRiby5iYXNlLmltcG9ydF9hdHRhY2gpOwogCiAJaWYgKGF0dGFj
aG1lbnQpCiAJCXNlcV9wcmludGYobSwgIiBpbXBvcnRlZCBmcm9tICVwIiwgZG1hX2J1Zik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggMTZmOTZmMmUz
NjcxLi4wMGIyODNmOTE0YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
b2JqZWN0LmMKQEAgLTg1LDkgKzg1LDkgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X2JvX2Rlc3Ryb3ko
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICp0Ym8pCiAKIAlhbWRncHVfYm9fa3VubWFwKGJvKTsK
IAotCWlmIChiby0+Z2VtX2Jhc2UuaW1wb3J0X2F0dGFjaCkKLQkJZHJtX3ByaW1lX2dlbV9kZXN0
cm95KCZiby0+Z2VtX2Jhc2UsIGJvLT50Ym8uc2cpOwotCWRybV9nZW1fb2JqZWN0X3JlbGVhc2Uo
JmJvLT5nZW1fYmFzZSk7CisJaWYgKGJvLT50Ym8uYmFzZS5pbXBvcnRfYXR0YWNoKQorCQlkcm1f
cHJpbWVfZ2VtX2Rlc3Ryb3koJmJvLT50Ym8uYmFzZSwgYm8tPnRiby5zZyk7CisJZHJtX2dlbV9v
YmplY3RfcmVsZWFzZSgmYm8tPnRiby5iYXNlKTsKIAkvKiBpbiBjYXNlIGFtZGdwdV9kZXZpY2Vf
cmVjb3Zlcl92cmFtIGdvdCBOVUxMIG9mIGJvLT5wYXJlbnQgKi8KIAlpZiAoIWxpc3RfZW1wdHko
JmJvLT5zaGFkb3dfbGlzdCkpIHsKIAkJbXV0ZXhfbG9jaygmYWRldi0+c2hhZG93X2xpc3RfbG9j
ayk7CkBAIC00NTQsNyArNDU0LDcgQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCWJvID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFt
ZGdwdV9ibyksIEdGUF9LRVJORUwpOwogCWlmIChibyA9PSBOVUxMKQogCQlyZXR1cm4gLUVOT01F
TTsKLQlkcm1fZ2VtX3ByaXZhdGVfb2JqZWN0X2luaXQoYWRldi0+ZGRldiwgJmJvLT5nZW1fYmFz
ZSwgc2l6ZSk7CisJZHJtX2dlbV9wcml2YXRlX29iamVjdF9pbml0KGFkZXYtPmRkZXYsICZiby0+
dGJvLmJhc2UsIHNpemUpOwogCUlOSVRfTElTVF9IRUFEKCZiby0+c2hhZG93X2xpc3QpOwogCWJv
LT52bV9ibyA9IE5VTEw7CiAJYm8tPnByZWZlcnJlZF9kb21haW5zID0gYnAtPnByZWZlcnJlZF9k
b21haW4gPyBicC0+cHJlZmVycmVkX2RvbWFpbiA6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdHRtLmMKaW5kZXggZDgxYmViZjc2MzEwLi5iOGFlOWE4MzhiNmMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAgLTIyNyw3ICsyMjcsNyBAQCBzdGF0aWMg
aW50IGFtZGdwdV92ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIHN0
cnVjdCBmaWxlICpmaWxwKQogCiAJaWYgKGFtZGdwdV90dG1fdHRfZ2V0X3VzZXJtbShiby0+dHRt
KSkKIAkJcmV0dXJuIC1FUEVSTTsKLQlyZXR1cm4gZHJtX3ZtYV9ub2RlX3ZlcmlmeV9hY2Nlc3Mo
JmFiby0+Z2VtX2Jhc2Uudm1hX25vZGUsCisJcmV0dXJuIGRybV92bWFfbm9kZV92ZXJpZnlfYWNj
ZXNzKCZhYm8tPnRiby5iYXNlLnZtYV9ub2RlLAogCQkJCQkgIGZpbHAtPnByaXZhdGVfZGF0YSk7
CiB9CiAKLS0gCjIuMTguMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
