Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 255D36526B
	for <lists+dri-devel@lfdr.de>; Thu, 11 Jul 2019 09:24:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 824AA6E14A;
	Thu, 11 Jul 2019 07:24:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x849.google.com (mail-qt1-x849.google.com
 [IPv6:2607:f8b0:4864:20::849])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C57CE89C1C
 for <dri-devel@lists.freedesktop.org>; Thu, 11 Jul 2019 00:43:23 +0000 (UTC)
Received: by mail-qt1-x849.google.com with SMTP id x10so3990512qti.11
 for <dri-devel@lists.freedesktop.org>; Wed, 10 Jul 2019 17:43:23 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc:content-transfer-encoding;
 bh=v60MlM4AZO2gEMLJWxdbYZ7IvOFMVV2k6kZce0avAZg=;
 b=lIYr/npRT0RmAMZeN4zuu//AEka/8Df3HOB36xfJTbAVCyZuvSQtOPqHbkvJ+KsHZ0
 JUX7f4sqT8Tlv7xJGp0JtqESdLD9QVjkb1nL2pwxAWOVOkzOda9XZZE84KF6YHBj5anN
 DltwN7uZUtxuOuHZw/qGv4IVWWkjXRp6loVGEUJ3wOWflo1dpSbvoVG1iGYXBm1JK0vQ
 pMLdVGwMtiK+iWiznd4m6d1O0FvMddHEZPiyykmdATAW7/COxyYz4R2pL6U990cFfRAe
 bSdu2KcwOujB9H2GTuAbx5aRjkjMVNJUqPhp31Yi1UoJxYCQyfXqjiaolko309HYYjEI
 I23w==
X-Gm-Message-State: APjAAAXEnh2F2pWjmmFB98Scao9XfuKv6Qe41mQpuYqZ8tKLwnV45o5F
 YSOPek3C8n+Ok2us5ZYGY1dMjat3t1Y4
X-Google-Smtp-Source: APXvYqyj3ECmNWNd+yY6QGnbJGCP4AOFd4xcwsvBqW8x1yg0B0SOGEtK5H9TtupGgnk6bod3dOZsdzrPHOr1
X-Received: by 2002:ac8:170f:: with SMTP id w15mr731596qtj.370.1562805802833; 
 Wed, 10 Jul 2019 17:43:22 -0700 (PDT)
Date: Wed, 10 Jul 2019 17:43:12 -0700
In-Reply-To: <D42A2A322A1FCA4089E30E9A9BA36AC65D61CB76@PGSMSX111.gar.corp.intel.com>
Message-Id: <20190711004312.248160-1-furquan@google.com>
Mime-Version: 1.0
References: <D42A2A322A1FCA4089E30E9A9BA36AC65D61CB76@PGSMSX111.gar.corp.intel.com>
X-Mailer: git-send-email 2.22.0.410.gd8fdbe21b5-goog
Subject: [PATCH v2] i915: intel_dp_aux_backlight: Fix max backlight
 calculations
From: Furquan Shaikh <furquan@google.com>
To: Jani Nikula <jani.nikula@linux.intel.com>, 
 Joonas Lahtinen <joonas.lahtinen@linux.intel.com>,
 Rodrigo Vivi <rodrigo.vivi@intel.com>, 
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Lee@google.com, Shawn C <shawn.c.lee@intel.com>
X-Mailman-Approved-At: Thu, 11 Jul 2019 07:23:58 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc:content-transfer-encoding;
 bh=v60MlM4AZO2gEMLJWxdbYZ7IvOFMVV2k6kZce0avAZg=;
 b=AoxRjcBsXVBhFBLgO/gOwvbsQJocxPgFtYzg8hmM6dKLwh0cLJc24teubvNT86GApa
 C8e4+eFDVPZmhdqQQiuPFbfLQx41DqN+yESzNoG/+Fw7rtm1HyAWpBfIKguE5McS7xE/
 qHPZgiYx5SAh0yvEwC9siiq+FMTM/QePNcjaFIG2cxWdl33wCkwa0baNs/bmiWIz/i+M
 bp+Eyl3w4bvGWdOh1fXtJmkG0uTAcLsAPiDfSXDM/DpmXp4JHWqEXjFZIRW/C2PmGhc5
 D5duUDMGIEygOCHIt6jtsDZR/Sgyg+sPZNe32GZWOkag86ySsifOQZxrbX7PLJQ6PN6d
 nZBQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Furquan Shaikh <furquan@google.com>, intel-gfx@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 marcheu@chromium.org, rajatja@google.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWF4IGJhY2tsaWdodCB2YWx1ZSBmb3IgdGhlIHBhbmVsIHdhcyBiZWluZyBjYWxjdWxhdGVkIHVz
aW5nIGJ5dGUKY291bnQgaS5lLiAweGZmZmYgaWYgMiBieXRlcyBhcmUgc3VwcG9ydGVkIGZvciBi
YWNrbGlnaHQgYnJpZ2h0bmVzcwphbmQgMHhmZiBpZiAxIGJ5dGUgaXMgc3VwcG9ydGVkLiBIb3dl
dmVyLCBFRFBfUFdNR0VOX0JJVF9DT1VOVApkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2YgYWN0aXZl
IGNvbnRyb2wgYml0cyB1c2VkIGZvciB0aGUgYnJpZ2h0bmVzcwpzZXR0aW5nLiBUaHVzLCBldmVu
IGlmIHRoZSBwYW5lbCB1c2VzIDIgYnl0ZSBzZXR0aW5nLCBpdCBtaWdodCBub3QgdXNlCmFsbCB0
aGUgY29udHJvbCBiaXRzLiBUaHVzLCBtYXggYmFja2xpZ2h0IHNob3VsZCBiZSBzZXQgYmFzZWQg
b24gdGhlCnZhbHVlIG9mIEVEUF9QV01HRU5fQklUX0NPVU5UIGluc3RlYWQgb2YgYXNzdW1pbmcg
NjU1MzUgb3IgMjU1LgoKQWRkaXRpb25hbGx5LCBFRFBfUFdNR0VOX0JJVF9DT1VOVCB3YXMgYmVp
bmcgdXBkYXRlZCBiYXNlZCBvbiB0aGUgVkJUCmZyZXF1ZW5jeSB3aGljaCByZXN1bHRzIGluIGEg
ZGlmZmVyZW50IG1heCBiYWNrbGlnaHQgdmFsdWUuIFRodXMsCnNldHRpbmcgb2YgRURQX1BXTUdF
Tl9CSVRfQ09VTlQgaXMgbW92ZWQgdG8gc2V0dXAgcGhhc2UgaW5zdGVhZCBvZgplbmFibGUgc28g
dGhhdCBtYXggYmFja2xpZ2h0IGNhbiBiZSBjYWxjdWxhdGVkIGNvcnJlY3RseS4gT25seSB0aGUK
ZnJlcXVlbmN5IGRpdmlkZXIgaXMgc2V0IGR1cmluZyB0aGUgZW5hYmxlIHBoYXNlIHVzaW5nIHRo
ZSB2YWx1ZSBvZgpFRFBfUFdNR0VOX0JJVF9DT1VOVC4KClNpZ25lZC1vZmYtYnk6IEZ1cnF1YW4g
U2hhaWtoIDxmdXJxdWFuQGdvb2dsZS5jb20+ClJldmlld2VkLWJ5OiBTdMOpcGhhbmUgTWFyY2hl
c2luIDxtYXJjaGV1QGNocm9taXVtLm9yZz4KLS0tCnYyOiBJbiBjYXNlIG9mIERQQ0QgZmFpbHVy
ZSBhbmQgcG4gYmVpbmcgdW5pbml0aWFsaXplZCwgcmV0dXJuIG1heF9iYWNrbGlnaHQgYXMgMC4K
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMgfCAxMzQgKysr
KysrKysrKysrLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgOTAgaW5zZXJ0aW9ucygrKSwgNDQgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHBfYXV4
X2JhY2tsaWdodC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHBfYXV4X2JhY2tsaWdo
dC5jCmluZGV4IDM1NzEzNmYxN2Y4NS4uYjM2NzhiOGE1YjRkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jCkBAIC0xMTAsNjEgKzExMCwzNCBAQCBz
dGF0aWMgYm9vbCBpbnRlbF9kcF9hdXhfc2V0X3B3bV9mcmVxKHN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rvci0+ZW5jb2Rlci0+YmFzZSk7Ci0JaW50IGZyZXEs
IGZ4cCwgZnhwX21pbiwgZnhwX21heCwgZnhwX2FjdHVhbCwgZiA9IDE7Ci0JdTggcG4sIHBuX21p
biwgcG5fbWF4OworCWludCBmcmVxLCBmeHAsIGYsIGZ4cF9hY3R1YWwsIGZ4cF9taW4sIGZ4cF9t
YXg7CisJdTggcG47CiAKLQkvKiBGaW5kIGRlc2lyZWQgdmFsdWUgb2YgKEYgeCBQKQotCSAqIE5v
dGUgdGhhdCwgaWYgRiB4IFAgaXMgb3V0IG9mIHN1cHBvcnRlZCByYW5nZSwgdGhlIG1heGltdW0g
dmFsdWUgb3IKLQkgKiBtaW5pbXVtIHZhbHVlIHdpbGwgYXBwbGllZCBhdXRvbWF0aWNhbGx5LiBT
byBubyBuZWVkIHRvIGNoZWNrIHRoYXQuCi0JICovCiAJZnJlcSA9IGRldl9wcml2LT52YnQuYmFj
a2xpZ2h0LnB3bV9mcmVxX2h6OwotCURSTV9ERUJVR19LTVMoIlZCVCBkZWZpbmVkIGJhY2tsaWdo
dCBmcmVxdWVuY3kgJXUgSHpcbiIsIGZyZXEpOwogCWlmICghZnJlcSkgewogCQlEUk1fREVCVUdf
S01TKCJVc2UgcGFuZWwgZGVmYXVsdCBiYWNrbGlnaHQgZnJlcXVlbmN5XG4iKTsKIAkJcmV0dXJu
IGZhbHNlOwogCX0KIAotCWZ4cCA9IERJVl9ST1VORF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJ
R0hUX0ZSRVFfQkFTRV9LSFopLCBmcmVxKTsKLQotCS8qIFVzZSBoaWdoZXN0IHBvc3NpYmxlIHZh
bHVlIG9mIFBuIGZvciBtb3JlIGdyYW51bGFyaXR5IG9mIGJyaWdodG5lc3MKLQkgKiBhZGp1c3Rt
ZW50IHdoaWxlIHNhdGlmeWluZyB0aGUgY29uZGl0aW9ucyBiZWxvdy4KLQkgKiAtIFBuIGlzIGlu
IHRoZSByYW5nZSBvZiBQbl9taW4gYW5kIFBuX21heAotCSAqIC0gRiBpcyBpbiB0aGUgcmFuZ2Ug
b2YgMSBhbmQgMjU1Ci0JICogLSBGeFAgaXMgd2l0aGluIDI1JSBvZiBkZXNpcmVkIHZhbHVlLgot
CSAqICAgTm90ZTogMjUlIGlzIGFyYml0cmFyeSB2YWx1ZSBhbmQgbWF5IG5lZWQgc29tZSB0d2Vh
ay4KLQkgKi8KLQlpZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsCi0JCQkgICAg
ICAgRFBfRURQX1BXTUdFTl9CSVRfQ09VTlRfQ0FQX01JTiwgJnBuX21pbikgIT0gMSkgewotCQlE
Uk1fREVCVUdfS01TKCJGYWlsZWQgdG8gcmVhZCBwd21nZW4gYml0IGNvdW50IGNhcCBtaW5cbiIp
OworCWlmIChkcm1fZHBfZHBjZF9yZWFkYigmaW50ZWxfZHAtPmF1eCwgRFBfRURQX1BXTUdFTl9C
SVRfQ09VTlQsCisJCQkgICAgICAmcG4pIDwgMCkgeworCQlEUk1fREVCVUdfS01TKCJGYWlsZWQg
dG8gcmVhZCBhdXggcHdtZ2VuIGJpdCBjb3VudFxuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9Ci0J
aWYgKGRybV9kcF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LAotCQkJICAgICAgIERQX0VEUF9Q
V01HRU5fQklUX0NPVU5UX0NBUF9NQVgsICZwbl9tYXgpICE9IDEpIHsKLQkJRFJNX0RFQlVHX0tN
UygiRmFpbGVkIHRvIHJlYWQgcHdtZ2VuIGJpdCBjb3VudCBjYXAgbWF4XG4iKTsKLQkJcmV0dXJu
IGZhbHNlOwotCX0KLQlwbl9taW4gJj0gRFBfRURQX1BXTUdFTl9CSVRfQ09VTlRfTUFTSzsKLQlw
bl9tYXggJj0gRFBfRURQX1BXTUdFTl9CSVRfQ09VTlRfTUFTSzsKIAorCWZ4cCA9IERJVl9ST1VO
RF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJR0hUX0ZSRVFfQkFTRV9LSFopLCBmcmVxKTsKKwlm
ID0gY2xhbXAoRElWX1JPVU5EX0NMT1NFU1QoZnhwLCAxIDw8IHBuKSwgMSwgMjU1KTsKKwlmeHBf
YWN0dWFsID0gZiA8PCBwbjsKKworCS8qIEVuc3VyZSBmcmVxdWVuY3kgaXMgd2l0aGluIDI1JSBv
ZiBkZXNpcmVkIHZhbHVlICovCiAJZnhwX21pbiA9IERJVl9ST1VORF9DTE9TRVNUKGZ4cCAqIDMs
IDQpOwogCWZ4cF9tYXggPSBESVZfUk9VTkRfQ0xPU0VTVChmeHAgKiA1LCA0KTsKLQlpZiAoZnhw
X21pbiA8ICgxIDw8IHBuX21pbikgfHwgKDI1NSA8PCBwbl9tYXgpIDwgZnhwX21heCkgewotCQlE
Uk1fREVCVUdfS01TKCJWQlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5IG91dCBvZiByYW5n
ZVxuIik7Ci0JCXJldHVybiBmYWxzZTsKLQl9CiAKLQlmb3IgKHBuID0gcG5fbWF4OyBwbiA+PSBw
bl9taW47IHBuLS0pIHsKLQkJZiA9IGNsYW1wKERJVl9ST1VORF9DTE9TRVNUKGZ4cCwgMSA8PCBw
biksIDEsIDI1NSk7Ci0JCWZ4cF9hY3R1YWwgPSBmIDw8IHBuOwotCQlpZiAoZnhwX21pbiA8PSBm
eHBfYWN0dWFsICYmIGZ4cF9hY3R1YWwgPD0gZnhwX21heCkKLQkJCWJyZWFrOwotCX0KLQotCWlm
IChkcm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsCi0JCQkgICAgICAgRFBfRURQX1BX
TUdFTl9CSVRfQ09VTlQsIHBuKSA8IDApIHsKLQkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHdy
aXRlIGF1eCBwd21nZW4gYml0IGNvdW50XG4iKTsKKwlpZiAoZnhwX21pbiA+IGZ4cF9hY3R1YWwg
fHwgZnhwX2FjdHVhbCA+IGZ4cF9tYXgpIHsKKwkJRFJNX0RFQlVHX0tNUygiQWN0dWFsIGZyZXF1
ZW5jeSBvdXQgb2YgcmFuZ2VcbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQorCiAJaWYgKGRybV9k
cF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1eCwKIAkJCSAgICAgICBEUF9FRFBfQkFDS0xJR0hU
X0ZSRVFfU0VULCAodTgpIGYpIDwgMCkgewogCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3Jp
dGUgYXV4IGJhY2tsaWdodCBmcmVxXG4iKTsKQEAgLTIyNCwxNiArMTk3LDg5IEBAIHN0YXRpYyB2
b2lkIGludGVsX2RwX2F1eF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqb2xkCiAJc2V0X2F1eF9iYWNrbGlnaHRfZW5hYmxlKGVuY190b19pbnRlbF9k
cChvbGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyKSwgZmFsc2UpOwogfQogCitzdGF0aWMgdTMy
IGludGVsX2RwX2F1eF9jYWxjX21heF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVu
Y190b19pbnRlbF9kcCgmY29ubmVjdG9yLT5lbmNvZGVyLT5iYXNlKTsKKwl1MzIgbWF4X2JhY2ts
aWdodCA9IDA7CisJaW50IGZyZXEsIGZ4cCwgZnhwX21pbiwgZnhwX21heCwgZnhwX2FjdHVhbCwg
ZiA9IDE7CisJdTggcG4sIHBuX21pbiwgcG5fbWF4OworCisJaWYgKGRybV9kcF9kcGNkX3JlYWRi
KCZpbnRlbF9kcC0+YXV4LCBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVCwKKwkJCSAgICAgICZwbikg
IT0gMSkKKwkJcmV0dXJuIG1heF9iYWNrbGlnaHQ7CisKKwlwbiAmPSBEUF9FRFBfUFdNR0VOX0JJ
VF9DT1VOVF9NQVNLOworCW1heF9iYWNrbGlnaHQgPSAoMSA8PCBwbikgLSAxOworCisJLyogRmlu
ZCBkZXNpcmVkIHZhbHVlIG9mIChGIHggUCkKKwkgKiBOb3RlIHRoYXQsIGlmIEYgeCBQIGlzIG91
dCBvZiBzdXBwb3J0ZWQgcmFuZ2UsIHRoZSBtYXhpbXVtIHZhbHVlIG9yCisJICogbWluaW11bSB2
YWx1ZSB3aWxsIGFwcGxpZWQgYXV0b21hdGljYWxseS4gU28gbm8gbmVlZCB0byBjaGVjayB0aGF0
LgorCSAqLworCWZyZXEgPSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oejsKKwlE
Uk1fREVCVUdfS01TKCJWQlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5ICV1IEh6XG4iLCBm
cmVxKTsKKwlpZiAoIWZyZXEpIHsKKwkJRFJNX0RFQlVHX0tNUygiVXNlIHBhbmVsIGRlZmF1bHQg
YmFja2xpZ2h0IGZyZXF1ZW5jeVxuIik7CisJCXJldHVybiBtYXhfYmFja2xpZ2h0OworCX0KKwor
CWZ4cCA9IERJVl9ST1VORF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJR0hUX0ZSRVFfQkFTRV9L
SFopLCBmcmVxKTsKKworCS8qIFVzZSBoaWdoZXN0IHBvc3NpYmxlIHZhbHVlIG9mIFBuIGZvciBt
b3JlIGdyYW51bGFyaXR5IG9mIGJyaWdodG5lc3MKKwkgKiBhZGp1c3RtZW50IHdoaWxlIHNhdGlm
eWluZyB0aGUgY29uZGl0aW9ucyBiZWxvdy4KKwkgKiAtIFBuIGlzIGluIHRoZSByYW5nZSBvZiBQ
bl9taW4gYW5kIFBuX21heAorCSAqIC0gRiBpcyBpbiB0aGUgcmFuZ2Ugb2YgMSBhbmQgMjU1CisJ
ICogLSBGeFAgaXMgd2l0aGluIDI1JSBvZiBkZXNpcmVkIHZhbHVlLgorCSAqICAgTm90ZTogMjUl
IGlzIGFyYml0cmFyeSB2YWx1ZSBhbmQgbWF5IG5lZWQgc29tZSB0d2Vhay4KKwkgKi8KKwlpZiAo
ZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsCisJCQkgICAgICAgRFBfRURQX1BXTUdF
Tl9CSVRfQ09VTlRfQ0FQX01JTiwgJnBuX21pbikgIT0gMSkgeworCQlEUk1fREVCVUdfS01TKCJG
YWlsZWQgdG8gcmVhZCBwd21nZW4gYml0IGNvdW50IGNhcCBtaW5cbiIpOworCQlyZXR1cm4gbWF4
X2JhY2tsaWdodDsKKwl9CisJaWYgKGRybV9kcF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LAor
CQkJICAgICAgIERQX0VEUF9QV01HRU5fQklUX0NPVU5UX0NBUF9NQVgsICZwbl9tYXgpICE9IDEp
IHsKKwkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHJlYWQgcHdtZ2VuIGJpdCBjb3VudCBjYXAg
bWF4XG4iKTsKKwkJcmV0dXJuIG1heF9iYWNrbGlnaHQ7CisJfQorCXBuX21pbiAmPSBEUF9FRFBf
UFdNR0VOX0JJVF9DT1VOVF9NQVNLOworCXBuX21heCAmPSBEUF9FRFBfUFdNR0VOX0JJVF9DT1VO
VF9NQVNLOworCisJZnhwX21pbiA9IERJVl9ST1VORF9DTE9TRVNUKGZ4cCAqIDMsIDQpOworCWZ4
cF9tYXggPSBESVZfUk9VTkRfQ0xPU0VTVChmeHAgKiA1LCA0KTsKKwlpZiAoZnhwX21pbiA8ICgx
IDw8IHBuX21pbikgfHwgKDI1NSA8PCBwbl9tYXgpIDwgZnhwX21heCkgeworCQlEUk1fREVCVUdf
S01TKCJWQlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5IG91dCBvZiByYW5nZVxuIik7CisJ
CXJldHVybiBtYXhfYmFja2xpZ2h0OworCX0KKworCWZvciAocG4gPSBwbl9tYXg7IHBuID49IHBu
X21pbjsgcG4tLSkgeworCQlmID0gY2xhbXAoRElWX1JPVU5EX0NMT1NFU1QoZnhwLCAxIDw8IHBu
KSwgMSwgMjU1KTsKKwkJZnhwX2FjdHVhbCA9IGYgPDwgcG47CisJCWlmIChmeHBfbWluIDw9IGZ4
cF9hY3R1YWwgJiYgZnhwX2FjdHVhbCA8PSBmeHBfbWF4KQorCQkJYnJlYWs7CisJfQorCisJaWYg
KGRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1eCwKKwkJCSAgICAgICBEUF9FRFBfUFdN
R0VOX0JJVF9DT1VOVCwgcG4pIDwgMCkgeworCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3Jp
dGUgYXV4IHB3bWdlbiBiaXQgY291bnRcbiIpOworCQlyZXR1cm4gbWF4X2JhY2tsaWdodDsKKwl9
CisKKwltYXhfYmFja2xpZ2h0ID0gKDEgPDwgcG4pIC0gMTsKKworCXJldHVybiBtYXhfYmFja2xp
Z2h0OworfQorCiBzdGF0aWMgaW50IGludGVsX2RwX2F1eF9zZXR1cF9iYWNrbGlnaHQoc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCQllbnVtIHBpcGUgcGlwZSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZjb25uZWN0b3ItPmVu
Y29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5w
YW5lbDsKIAotCWlmIChpbnRlbF9kcC0+ZWRwX2RwY2RbMl0gJiBEUF9FRFBfQkFDS0xJR0hUX0JS
SUdIVE5FU1NfQllURV9DT1VOVCkKLQkJcGFuZWwtPmJhY2tsaWdodC5tYXggPSAweEZGRkY7Ci0J
ZWxzZQotCQlwYW5lbC0+YmFja2xpZ2h0Lm1heCA9IDB4RkY7CisJcGFuZWwtPmJhY2tsaWdodC5t
YXggPSBpbnRlbF9kcF9hdXhfY2FsY19tYXhfYmFja2xpZ2h0KGNvbm5lY3Rvcik7CisKKwlpZiAo
IXBhbmVsLT5iYWNrbGlnaHQubWF4KQorCQlyZXR1cm4gLUVOT0RFVjsKIAogCXBhbmVsLT5iYWNr
bGlnaHQubWluID0gMDsKIAlwYW5lbC0+YmFja2xpZ2h0LmxldmVsID0gaW50ZWxfZHBfYXV4X2dl
dF9iYWNrbGlnaHQoY29ubmVjdG9yKTsKLS0gCjIuMjIuMC40MTAuZ2Q4ZmRiZTIxYjUtZ29vZwoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
