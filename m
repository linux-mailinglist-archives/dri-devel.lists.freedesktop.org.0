Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B1EC5A2196
	for <lists+dri-devel@lfdr.de>; Thu, 29 Aug 2019 18:58:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F7606E142;
	Thu, 29 Aug 2019 16:58:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x543.google.com (mail-pg1-x543.google.com
 [IPv6:2607:f8b0:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C67D06E140;
 Thu, 29 Aug 2019 16:58:15 +0000 (UTC)
Received: by mail-pg1-x543.google.com with SMTP id d1so1904946pgp.4;
 Thu, 29 Aug 2019 09:58:15 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=z5aejNN4E3FY64F70srY3n8O/Ut3OzGCD0WkMFdFS6I=;
 b=iCUvv9qreS+eoYHJ0Mkf6gJ2G98dscFctSERy1t01lBWNGw3WoUt1YemSyx7bhxODa
 xTAdIQ1pd9Aqus7R+oP1wMmOQr3xdck0vZ/b0htrgS1eygqDzUhdGIwZPZFpSbdc98dg
 uoUPkZ2ww0qbk8PLT+FakWcLl1UKcEOogu/qGqwTmsNAkQnwSlOvmqs82HFqWu8sDcNs
 Seq+hTVp025lMUdU6B4VjF7vn435murMmbmrt40xhwJ7ULOyIrCJ0fuqZRVQd5a2V3+I
 s3vF1WNLSztbF/3eyp7CxQCAjaydhK7+K8wUpja0FGZyiN6bU3ZzFdBsNAVBOmA2x5C5
 JBRw==
X-Gm-Message-State: APjAAAV6E50PFul9H8VuSBG0QPEj1iMbxMP2JQ+h1hKUmvifR8VvUe0Y
 uptZGUVutYLy2+6oLZ10w+t0CN/d8qc=
X-Google-Smtp-Source: APXvYqzauw+4zVVk7qqFweOCykTcZcA/jk/ZMJD+m5r3MvOKjjoGBcmEPQREZAniKuS2eArDFPOEXQ==
X-Received: by 2002:a63:125c:: with SMTP id 28mr9193220pgs.255.1567097894959; 
 Thu, 29 Aug 2019 09:58:14 -0700 (PDT)
Received: from localhost ([100.118.89.196])
 by smtp.gmail.com with ESMTPSA id j187sm3811303pfg.178.2019.08.29.09.58.13
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 29 Aug 2019 09:58:14 -0700 (PDT)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 04/10] drm/msm: add kms->wait_flush()
Date: Thu, 29 Aug 2019 09:45:12 -0700
Message-Id: <20190829164601.11615-5-robdclark@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190829164601.11615-1-robdclark@gmail.com>
References: <20190829164601.11615-1-robdclark@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=z5aejNN4E3FY64F70srY3n8O/Ut3OzGCD0WkMFdFS6I=;
 b=aBpYN06l6/76eVPw7fSEzZciyB1u9/fZiB2W5QP2lCnBXQu7E69eWLMncU4rDGYF2L
 S1bR3fUgRrxFh3e1vh+3VIZna+6+2lkieoimv2QMQXDNUON2xrzSaQzotDdO6LBWF4ZW
 Hm+84pu9vZDfc3qWaakaQvq2/cYn5XdhKy8TUcXtgdsDgENt6/mNwzzcWyiAa92BuOQJ
 uqfSxYGvppplRaiuDtqW05qPFW5VNExZWRh948oXDPkax3e5gG0qh6d3NBc8KBrfoigt
 n4mLlU/UYtcAxWKgZfKQ2fgHlembWrQdXOFRYsu+Ah9jC31Ar362+9g6uPPaltFY40ob
 EOyA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Rob Clark <robdclark@chromium.org>, Enrico Weigelt <info@metux.net>,
 open list <linux-kernel@vger.kernel.org>, Jonathan Marek <jonathan@marek.ca>,
 David Airlie <airlied@linux.ie>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Mamta Shukla <mamtashukla555@gmail.com>,
 Georgi Djakov <georgi.djakov@linaro.org>, Bruce Wang <bzwang@chromium.org>,
 Alexios Zavras <alexios.zavras@intel.com>,
 Allison Randal <allison@lohutok.net>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <linux-arm-msm@vger.kernel.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <freedreno@lists.freedesktop.org>,
 Sean Paul <sean@poorly.run>, Thomas Gleixner <tglx@linutronix.de>,
 Sravanthi Kollukuduru <skolluku@codeaurora.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKRmlyc3Qgc3RlcCBpbiBy
ZS13b3JraW5nIHRoZSBhdG9taWMgcmVsYXRlZCBpbnRlcm5hbCBBUEkgdG8gcHJlcGFyZSBmb3IK
YXN5bmMgdXBkYXRlcyBwZW5kaW5nLi4gLT53YWl0X2ZsdXNoKCkgaXMgaW50ZW5kZWQgdG8gYmxv
Y2sgdW50aWwgdGhlcmUKaXMgbm8gaW4tcHJvZ3Jlc3MgZmx1c2guCgpBIGNydGNfbWFzayBpcyB1
c2VkLCByYXRoZXIgdGhhbiBhbiBhdG9taWMgc3RhdGUgb2JqZWN0LCBhcyB0aGlzIHdpbGwKbGF0
ZXIgYmUgdXNlZCBmb3IgYXN5bmMgZmx1c2ggYWZ0ZXIgdGhlIGF0b21pYyBzdGF0ZSBpcyBkZXN0
cm95ZWQuCgpUaGlzIHJlcGxhY2VzIC0+d2FpdF9mb3JfY3J0Y19jb21taXRfZG9uZSgpCgp2Mjog
dXBkYXRlIGZvciByZXZpZXcgY29tbWVudHMKClNpZ25lZC1vZmYtYnk6IFJvYiBDbGFyayA8cm9i
ZGNsYXJrQGNocm9taXVtLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9k
cHVfa21zLmMgIHwgMTEgKysrKysrLQogZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDQvbWRw
NF9rbXMuYyB8IDE3ICsrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA1L21k
cDVfa21zLmMgfCAxNyArKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9hdG9taWMu
YyAgICAgICAgIHwgNDIgKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
bXNtL21zbV9rbXMuaCAgICAgICAgICAgIHwgIDkgKysrLS0KIDUgZmlsZXMgY2hhbmdlZCwgNTQg
aW5zZXJ0aW9ucygrKSwgNDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2Rw
dTEvZHB1X2ttcy5jCmluZGV4IDMxNDU0Y2M1ZDhjNS4uZGY0MjFiOTg2YmMzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jCkBAIC0zODgsNiArMzg4LDE1IEBAIHN0YXRp
YyB2b2lkIGRwdV9rbXNfd2FpdF9mb3JfY29tbWl0X2RvbmUoc3RydWN0IG1zbV9rbXMgKmttcywK
IAl9CiB9CiAKK3N0YXRpYyB2b2lkIGRwdV9rbXNfd2FpdF9mbHVzaChzdHJ1Y3QgbXNtX2ttcyAq
a21zLCB1bnNpZ25lZCBjcnRjX21hc2spCit7CisJc3RydWN0IGRwdV9rbXMgKmRwdV9rbXMgPSB0
b19kcHVfa21zKGttcyk7CisJc3RydWN0IGRybV9jcnRjICpjcnRjOworCisJZm9yX2VhY2hfY3J0
Y19tYXNrKGRwdV9rbXMtPmRldiwgY3J0YywgY3J0Y19tYXNrKQorCQlkcHVfa21zX3dhaXRfZm9y
X2NvbW1pdF9kb25lKGttcywgY3J0Yyk7Cit9CisKIHN0YXRpYyBpbnQgX2RwdV9rbXNfaW5pdGlh
bGl6ZV9kc2koc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgICAgc3RydWN0IG1zbV9kcm1f
cHJpdmF0ZSAqcHJpdiwKIAkJCQkgICAgc3RydWN0IGRwdV9rbXMgKmRwdV9rbXMpCkBAIC02ODIs
OCArNjkxLDggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBtc21fa21zX2Z1bmNzIGttc19mdW5jcyA9
IHsKIAkuaXJxICAgICAgICAgICAgID0gZHB1X2lycSwKIAkucHJlcGFyZV9jb21taXQgID0gZHB1
X2ttc19wcmVwYXJlX2NvbW1pdCwKIAkuY29tbWl0ICAgICAgICAgID0gZHB1X2ttc19jb21taXQs
CisJLndhaXRfZmx1c2ggICAgICA9IGRwdV9rbXNfd2FpdF9mbHVzaCwKIAkuY29tcGxldGVfY29t
bWl0ID0gZHB1X2ttc19jb21wbGV0ZV9jb21taXQsCi0JLndhaXRfZm9yX2NydGNfY29tbWl0X2Rv
bmUgPSBkcHVfa21zX3dhaXRfZm9yX2NvbW1pdF9kb25lLAogCS5lbmFibGVfdmJsYW5rICAgPSBk
cHVfa21zX2VuYWJsZV92YmxhbmssCiAJLmRpc2FibGVfdmJsYW5rICA9IGRwdV9rbXNfZGlzYWJs
ZV92YmxhbmssCiAJLmNoZWNrX21vZGlmaWVkX2Zvcm1hdCA9IGRwdV9mb3JtYXRfY2hlY2tfbW9k
aWZpZWRfZm9ybWF0LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDQv
bWRwNF9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA0L21kcDRfa21zLmMKaW5k
ZXggN2E5YWI1NWI0NjA4Li4zMmRjYjFkNzg2MGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vZGlzcC9tZHA0L21kcDRfa21zLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNw
L21kcDQvbWRwNF9rbXMuYwpAQCAtMTA3LDYgKzEwNywxNSBAQCBzdGF0aWMgdm9pZCBtZHA0X3By
ZXBhcmVfY29tbWl0KHN0cnVjdCBtc21fa21zICprbXMsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdAogCQlkcm1fY3J0Y192YmxhbmtfZ2V0KGNydGMpOwogfQogCitzdGF0aWMgdm9pZCBtZHA0
X3dhaXRfZmx1c2goc3RydWN0IG1zbV9rbXMgKmttcywgdW5zaWduZWQgY3J0Y19tYXNrKQorewor
CXN0cnVjdCBtZHA0X2ttcyAqbWRwNF9rbXMgPSB0b19tZHA0X2ttcyh0b19tZHBfa21zKGttcykp
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKworCWZvcl9lYWNoX2NydGNfbWFzayhtZHA0X2tt
cy0+ZGV2LCBjcnRjLCBjcnRjX21hc2spCisJCW1kcDRfY3J0Y193YWl0X2Zvcl9jb21taXRfZG9u
ZShjcnRjKTsKK30KKwogc3RhdGljIHZvaWQgbWRwNF9jb21wbGV0ZV9jb21taXQoc3RydWN0IG1z
bV9rbXMgKmttcywgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBt
ZHA0X2ttcyAqbWRwNF9rbXMgPSB0b19tZHA0X2ttcyh0b19tZHBfa21zKGttcykpOwpAQCAtMTIz
LDEyICsxMzIsNiBAQCBzdGF0aWMgdm9pZCBtZHA0X2NvbXBsZXRlX2NvbW1pdChzdHJ1Y3QgbXNt
X2ttcyAqa21zLCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqcwogCW1kcDRfZGlzYWJsZShtZHA0
X2ttcyk7CiB9CiAKLXN0YXRpYyB2b2lkIG1kcDRfd2FpdF9mb3JfY3J0Y19jb21taXRfZG9uZShz
dHJ1Y3QgbXNtX2ttcyAqa21zLAotCQkJCQkJc3RydWN0IGRybV9jcnRjICpjcnRjKQotewotCW1k
cDRfY3J0Y193YWl0X2Zvcl9jb21taXRfZG9uZShjcnRjKTsKLX0KLQogc3RhdGljIGxvbmcgbWRw
NF9yb3VuZF9waXhjbGsoc3RydWN0IG1zbV9rbXMgKmttcywgdW5zaWduZWQgbG9uZyByYXRlLAog
CQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiB7CkBAIC0xNzksOCArMTgyLDggQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBtZHBfa21zX2Z1bmNzIGttc19mdW5jcyA9IHsKIAkJLmVuYWJsZV92
YmxhbmsgICA9IG1kcDRfZW5hYmxlX3ZibGFuaywKIAkJLmRpc2FibGVfdmJsYW5rICA9IG1kcDRf
ZGlzYWJsZV92YmxhbmssCiAJCS5wcmVwYXJlX2NvbW1pdCAgPSBtZHA0X3ByZXBhcmVfY29tbWl0
LAorCQkud2FpdF9mbHVzaCAgICAgID0gbWRwNF93YWl0X2ZsdXNoLAogCQkuY29tcGxldGVfY29t
bWl0ID0gbWRwNF9jb21wbGV0ZV9jb21taXQsCi0JCS53YWl0X2Zvcl9jcnRjX2NvbW1pdF9kb25l
ID0gbWRwNF93YWl0X2Zvcl9jcnRjX2NvbW1pdF9kb25lLAogCQkuZ2V0X2Zvcm1hdCAgICAgID0g
bWRwX2dldF9mb3JtYXQsCiAJCS5yb3VuZF9waXhjbGsgICAgPSBtZHA0X3JvdW5kX3BpeGNsaywK
IAkJLmRlc3Ryb3kgICAgICAgICA9IG1kcDRfZGVzdHJveSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9tc20vZGlzcC9tZHA1L21kcDVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rp
c3AvbWRwNS9tZHA1X2ttcy5jCmluZGV4IDhiZjVmMzI2NGRjOS4uNDQwZTAwMGM4YzNkIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvbWRwNS9tZHA1X2ttcy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA1L21kcDVfa21zLmMKQEAgLTE1NCw2ICsxNTQsMTUg
QEAgc3RhdGljIHZvaWQgbWRwNV9wcmVwYXJlX2NvbW1pdChzdHJ1Y3QgbXNtX2ttcyAqa21zLCBz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3QKIAkJbWRwNV9zbXBfcHJlcGFyZV9jb21taXQobWRw
NV9rbXMtPnNtcCwgJmdsb2JhbF9zdGF0ZS0+c21wKTsKIH0KIAorc3RhdGljIHZvaWQgbWRwNV93
YWl0X2ZsdXNoKHN0cnVjdCBtc21fa21zICprbXMsIHVuc2lnbmVkIGNydGNfbWFzaykKK3sKKwlz
dHJ1Y3QgbWRwNV9rbXMgKm1kcDVfa21zID0gdG9fbWRwNV9rbXModG9fbWRwX2ttcyhrbXMpKTsK
KwlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CisKKwlmb3JfZWFjaF9jcnRjX21hc2sobWRwNV9rbXMt
PmRldiwgY3J0YywgY3J0Y19tYXNrKQorCQltZHA1X2NydGNfd2FpdF9mb3JfY29tbWl0X2RvbmUo
Y3J0Yyk7Cit9CisKIHN0YXRpYyB2b2lkIG1kcDVfY29tcGxldGVfY29tbWl0KHN0cnVjdCBtc21f
a21zICprbXMsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgbWRw
NV9rbXMgKm1kcDVfa21zID0gdG9fbWRwNV9rbXModG9fbWRwX2ttcyhrbXMpKTsKQEAgLTE3MCwx
MiArMTc5LDYgQEAgc3RhdGljIHZvaWQgbWRwNV9jb21wbGV0ZV9jb21taXQoc3RydWN0IG1zbV9r
bXMgKmttcywgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnMKIAlwbV9ydW50aW1lX3B1dF9zeW5j
KGRldik7CiB9CiAKLXN0YXRpYyB2b2lkIG1kcDVfd2FpdF9mb3JfY3J0Y19jb21taXRfZG9uZShz
dHJ1Y3QgbXNtX2ttcyAqa21zLAotCQkJCQkJc3RydWN0IGRybV9jcnRjICpjcnRjKQotewotCW1k
cDVfY3J0Y193YWl0X2Zvcl9jb21taXRfZG9uZShjcnRjKTsKLX0KLQogc3RhdGljIGxvbmcgbWRw
NV9yb3VuZF9waXhjbGsoc3RydWN0IG1zbV9rbXMgKmttcywgdW5zaWduZWQgbG9uZyByYXRlLAog
CQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiB7CkBAIC0yNzIsOCArMjc1LDggQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBtZHBfa21zX2Z1bmNzIGttc19mdW5jcyA9IHsKIAkJLmVuYWJsZV92
YmxhbmsgICA9IG1kcDVfZW5hYmxlX3ZibGFuaywKIAkJLmRpc2FibGVfdmJsYW5rICA9IG1kcDVf
ZGlzYWJsZV92YmxhbmssCiAJCS5wcmVwYXJlX2NvbW1pdCAgPSBtZHA1X3ByZXBhcmVfY29tbWl0
LAorCQkud2FpdF9mbHVzaCAgICAgID0gbWRwNV93YWl0X2ZsdXNoLAogCQkuY29tcGxldGVfY29t
bWl0ID0gbWRwNV9jb21wbGV0ZV9jb21taXQsCi0JCS53YWl0X2Zvcl9jcnRjX2NvbW1pdF9kb25l
ID0gbWRwNV93YWl0X2Zvcl9jcnRjX2NvbW1pdF9kb25lLAogCQkuZ2V0X2Zvcm1hdCAgICAgID0g
bWRwX2dldF9mb3JtYXQsCiAJCS5yb3VuZF9waXhjbGsgICAgPSBtZHA1X3JvdW5kX3BpeGNsaywK
IAkJLnNldF9zcGxpdF9kaXNwbGF5ID0gbWRwNV9zZXRfc3BsaXRfZGlzcGxheSwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL21z
bS9tc21fYXRvbWljLmMKaW5kZXggZTVhYWUxNjQ1OTMzLi40Y2E0YjY1NGMyMjEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2F0b21pYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vbXNtX2F0b21pYy5jCkBAIC0xMCwyOCArMTAsNiBAQAogI2luY2x1ZGUgIm1zbV9nZW0u
aCIKICNpbmNsdWRlICJtc21fa21zLmgiCiAKLXN0YXRpYyB2b2lkIG1zbV9hdG9taWNfd2FpdF9m
b3JfY29tbWl0X2RvbmUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKm9sZF9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7Ci0Jc3RydWN0
IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKLQlzdHJ1Y3QgbXNtX2RybV9wcml2YXRl
ICpwcml2ID0gb2xkX3N0YXRlLT5kZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBtc21fa21zICpr
bXMgPSBwcml2LT5rbXM7Ci0JaW50IGk7Ci0KLQlmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0ZShv
bGRfc3RhdGUsIGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlmICghbmV3X2NydGNfc3Rh
dGUtPmFjdGl2ZSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChkcm1fY3J0Y192YmxhbmtfZ2V0KGNy
dGMpKQotCQkJY29udGludWU7Ci0KLQkJa21zLT5mdW5jcy0+d2FpdF9mb3JfY3J0Y19jb21taXRf
ZG9uZShrbXMsIGNydGMpOwotCi0JCWRybV9jcnRjX3ZibGFua19wdXQoY3J0Yyk7Ci0JfQotfQot
CiBpbnQgbXNtX2F0b21pY19wcmVwYXJlX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJ
ICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpuZXdfc3RhdGUpCiB7CkBAIC01MSwxMSArMjksMjgg
QEAgaW50IG1zbV9hdG9taWNfcHJlcGFyZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAly
ZXR1cm4gbXNtX2ZyYW1lYnVmZmVyX3ByZXBhcmUobmV3X3N0YXRlLT5mYiwga21zLT5hc3BhY2Up
OwogfQogCisvKiBHZXQgYml0bWFzayBvZiBjcnRjcyB0aGF0IHdpbGwgbmVlZCB0byBiZSBmbHVz
aGVkLiAgVGhlIGJpdG1hc2sKKyAqIGNhbiBiZSB1c2VkIHdpdGggZm9yX2VhY2hfY3J0Y19tYXNr
KCkgaXRlcmF0b3IsIHRvIGl0ZXJhdGUKKyAqIGVmZmVjdGVkIGNydGNzIHdpdGhvdXQgbmVlZGlu
ZyB0byBwcmVzZXJ2ZSB0aGUgYXRvbWljIHN0YXRlLgorICovCitzdGF0aWMgdW5zaWduZWQgZ2V0
X2NydGNfbWFzayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRy
bV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKwl1bnNp
Z25lZCBpLCBtYXNrID0gMDsKKworCWZvcl9lYWNoX25ld19jcnRjX2luX3N0YXRlKHN0YXRlLCBj
cnRjLCBjcnRjX3N0YXRlLCBpKQorCQltYXNrIHw9IGRybV9jcnRjX21hc2soY3J0Yyk7CisKKwly
ZXR1cm4gbWFzazsKK30KKwogdm9pZCBtc21fYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gc3RhdGUt
PmRldjsKIAlzdHJ1Y3QgbXNtX2RybV9wcml2YXRlICpwcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsK
IAlzdHJ1Y3QgbXNtX2ttcyAqa21zID0gcHJpdi0+a21zOworCXVuc2lnbmVkIGNydGNfbWFzayA9
IGdldF9jcnRjX21hc2soc3RhdGUpOwogCiAJa21zLT5mdW5jcy0+cHJlcGFyZV9jb21taXQoa21z
LCBzdGF0ZSk7CiAKQEAgLTcwLDggKzY1LDcgQEAgdm9pZCBtc21fYXRvbWljX2NvbW1pdF90YWls
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJa21zLT5mdW5jcy0+Y29tbWl0KGtt
cywgc3RhdGUpOwogCX0KIAotCW1zbV9hdG9taWNfd2FpdF9mb3JfY29tbWl0X2RvbmUoZGV2LCBz
dGF0ZSk7Ci0KKwlrbXMtPmZ1bmNzLT53YWl0X2ZsdXNoKGttcywgY3J0Y19tYXNrKTsKIAlrbXMt
PmZ1bmNzLT5jb21wbGV0ZV9jb21taXQoa21zLCBzdGF0ZSk7CiAKIAlkcm1fYXRvbWljX2hlbHBl
cl9jb21taXRfaHdfZG9uZShzdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNt
L21zbV9rbXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2ttcy5oCmluZGV4IGM3NTg4YTQy
NjM1ZS4uYTExMmRmYjM2MzAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9r
bXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9rbXMuaApAQCAtMzQsOSArMzQsOCBA
QCBzdHJ1Y3QgbXNtX2ttc19mdW5jcyB7CiAJdm9pZCAoKnByZXBhcmVfY29tbWl0KShzdHJ1Y3Qg
bXNtX2ttcyAqa21zLCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCXZvaWQgKCpj
b21taXQpKHN0cnVjdCBtc21fa21zICprbXMsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZSk7CiAJdm9pZCAoKmNvbXBsZXRlX2NvbW1pdCkoc3RydWN0IG1zbV9rbXMgKmttcywgc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKLQkvKiBmdW5jdGlvbnMgdG8gd2FpdCBmb3IgYXRv
bWljIGNvbW1pdCBjb21wbGV0ZWQgb24gZWFjaCBDUlRDICovCi0Jdm9pZCAoKndhaXRfZm9yX2Ny
dGNfY29tbWl0X2RvbmUpKHN0cnVjdCBtc21fa21zICprbXMsCi0JCQkJCXN0cnVjdCBkcm1fY3J0
YyAqY3J0Yyk7CisJdm9pZCAoKndhaXRfZmx1c2gpKHN0cnVjdCBtc21fa21zICprbXMsIHVuc2ln
bmVkIGNydGNfbWFzayk7CisKIAkvKiBnZXQgbXNtX2Zvcm1hdCB3LyBvcHRpb25hbCBmb3JtYXQg
bW9kaWZpZXJzIGZyb20gZHJtX21vZGVfZmJfY21kMiAqLwogCWNvbnN0IHN0cnVjdCBtc21fZm9y
bWF0ICooKmdldF9mb3JtYXQpKHN0cnVjdCBtc21fa21zICprbXMsCiAJCQkJCWNvbnN0IHVpbnQz
Ml90IGZvcm1hdCwKQEAgLTk4LDQgKzk3LDggQEAgc3RydWN0IG1zbV9tZHNzIHsKIGludCBtZHA1
X21kc3NfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKIGludCBkcHVfbWRzc19pbml0KHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogCisjZGVmaW5lIGZvcl9lYWNoX2NydGNfbWFzayhkZXYs
IGNydGMsIGNydGNfbWFzaykgXAorCWRybV9mb3JfZWFjaF9jcnRjKGNydGMsIGRldikgXAorCQlm
b3JfZWFjaF9pZiAoZHJtX2NydGNfbWFzayhjcnRjKSAmIChjcnRjX21hc2spKQorCiAjZW5kaWYg
LyogX19NU01fS01TX0hfXyAqLwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
