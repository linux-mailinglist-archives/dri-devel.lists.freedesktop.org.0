Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EBB04DBCDB
	for <lists+dri-devel@lfdr.de>; Fri, 18 Oct 2019 07:23:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2FD0E6E083;
	Fri, 18 Oct 2019 05:23:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x642.google.com (mail-pl1-x642.google.com
 [IPv6:2607:f8b0:4864:20::642])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 51F4E6E083
 for <dri-devel@lists.freedesktop.org>; Fri, 18 Oct 2019 05:23:31 +0000 (UTC)
Received: by mail-pl1-x642.google.com with SMTP id u20so2280366plq.4
 for <dri-devel@lists.freedesktop.org>; Thu, 17 Oct 2019 22:23:31 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=QK2BBdmc3Msfibz5p+KhUzUiZCgSKEd6d3yu8VLaCNQ=;
 b=qV+JiFWZ5IyzGMFGgI/4WQOsHq01ljX+VdPKGtsY/FcCpElzuQgs06GDvHqxd7tFIP
 UAwM/5xmg0W2fUMkAncJ8NOE9WANUIM1Wx5HTpriWdYOeUU/l/yKCOsLVdrpbHvl/0EC
 UiA+TKD9GcK2vm7W5SShGV+ThOMC+lTnoqg42pU3matJdOPodzsIClVRJgGT9woMTx3J
 eLoe4HPiGnvgkDK3GsJQcd/wTpIDUAXKa0KceM1sxKUd12b8cgvzSpyG9TQfRFbSzKVe
 Xi0vabhHmcgRjAG2gY5W+i7Yks511TACdizZ6rH7KtDk5q7lgmCv3rqKGvaPJiQDRd2D
 Nwfg==
X-Gm-Message-State: APjAAAX4p8zxdXWpTTO+uEThZgPwIsyzafEGTIcVXF+Qc/ia2K9qviG/
 RG8VNQpgGC/V5CmmSu4pHt7FOg==
X-Google-Smtp-Source: APXvYqz6QiNXCOd8wokWH0Uvz1d6cF4YgJf9o6ezgff+Tddum2HhLojLPxkSt0pk6bHg/yiE1Vdchw==
X-Received: by 2002:a17:902:bd06:: with SMTP id
 p6mr7366790pls.120.1571376210625; 
 Thu, 17 Oct 2019 22:23:30 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 g202sm4729336pfb.155.2019.10.17.22.23.29
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 17 Oct 2019 22:23:29 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v12 2/5] dma-buf: heaps: Add heap helpers
Date: Fri, 18 Oct 2019 05:23:20 +0000
Message-Id: <20191018052323.21659-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191018052323.21659-1-john.stultz@linaro.org>
References: <20191018052323.21659-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=QK2BBdmc3Msfibz5p+KhUzUiZCgSKEd6d3yu8VLaCNQ=;
 b=nYauYV6PD3tEncPvIEJAd0pofaQah3e24VGy7r2LOiTjy9/lMKQF8D2aAOc7zUKXgD
 ofXwVif1a5r5TeAdcjNWhcXHqfiCn9cGaspjsC6VVKeoMswNj8+KKSlQjxntsyHAPKu7
 28uHrHG2tSoObtddVuKNGVvr8YdV0QBVDXZUmtTMtCdLyUbTAcjiaXcDNEfYNnnMzvw6
 ZVGiQl5YBXObtbEel7jyVkZGr0WyGXE6oI9JiZC+r0UXVVXbCP4KD1e5tNzh8ZMoqNK8
 fpWRZM0ZMq+Ek41CsM1nlALMEhgyRK+PZiwN0lIXP4yV8FJq6w6uMP13zsSU0ytYdvDr
 IjoA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGdlbmVyaWMgaGVscGVyIGRtYWJ1ZiBvcHMgZm9yIGRtYSBoZWFwcywgc28gd2UgY2FuIHJl
ZHVjZQp0aGUgYW1vdW50IG9mIGR1cGxpY2F0aXZlIGNvZGUgZm9yIHRoZSBleHBvcnRlZCBkbWFi
dWZzLgoKVGhpcyBjb2RlIGlzIGFuIGV2b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVt
ZW50YXRpb24sIHNvCnRoYW5rcyB0byBpdHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50
ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBaYXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwg
YW5kIG90aGVycyEKCkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQg
U2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29k
ZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsgUGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNj
OiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5l
Zm9ydCA8VmluY2VudC5Eb25uZWZvcnRAYXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0
by5QYXVsQGFybS5jb20+CkNjOiBBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBDaHJp
c3RvcGggSGVsbHdpZyA8aGNoQGluZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8gRmVuZyA8ZmVuZ2NA
Z29vZ2xlLmNvbT4KQ2M6IEFsaXN0YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5AZ29vZ2xlLmNvbT4K
Q2M6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogSGlsbGYgRGFudG9u
IDxoZGFudG9uQHNpbmEuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpS
ZXZpZXdlZC1ieTogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdhaWduYXJkQGxpbmFyby5v
cmc+ClJldmlld2VkLWJ5OiBCcmlhbiBTdGFya2V5IDxicmlhbi5zdGFya2V5QGFybS5jb20+CkFj
a2VkLWJ5OiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KVGVzdGVkLWJ5OiBBeWFu
IEt1bWFyIEhhbGRlciA8YXlhbi5oYWxkZXJAYXJtLmNvbT4KU2lnbmVkLW9mZi1ieTogSm9obiBT
dHVsdHogPGpvaG4uc3R1bHR6QGxpbmFyby5vcmc+Ci0tLQp2MjoKKiBSZW1vdmVkIGNhY2hlIG1h
bmFnZW1lbnQgcGVyZm9ybWFuY2UgaGFjayB0aGF0IEkgaGFkCiAgYWNjaWRlbnRhbGx5IGZvbGRl
ZCBpbi4KKiBSZW1vdmVkIHN0YXRzIGNvZGUgdGhhdCB3YXMgaW4gaGVscGVycwoqIExvdHMgb2Yg
Y2hlY2twYXRjaCBjbGVhbnVwcwp2MzoKKiBVbmlubGluZSBJTklUX0hFQVBfSEVMUEVSX0JVRkZF
UiAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBTd2l0Y2ggdG8gV0FSTiBvbiBidWZmZXIgZGVz
dHJveSBmYWlsdXJlIChzdWdnZXN0ZWQgYnkgQnJpYW4pCiogYnVmZmVyLT5rbWFwX2NudCBkZWNy
ZW1lbnRpbmcgY2xlYW51cCAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBFeHRyYSBidWZmZXIt
PnZhZGRyIGNoZWNraW5nIGluIGRtYV9oZWFwX2RtYV9idWZfa21hcAogIChzdWdnZXN0ZWQgYnkg
QnJpYW4pCiogU3dpdGNoIHRvX2hlbHBlcl9idWZmZXIgZnJvbSBtYWNybyB0byBpbmxpbmUgZnVu
Y3Rpb24KICAoc3VnZ2VzdGVkIGJ5IEJlbmphbWluKQoqIFJlbmFtZSBrbWFwLT52bWFwIChmb2xk
ZWQgaW4gZnJvbSBBbmRyZXcpCiogVXNlIHZtYXAgZm9yIHZtYXBwaW5nIC0gbm90IGJlZ2luX2Nw
dV9hY2Nlc3MgKGZvbGRlZCBpbiBmcm9tCiAgQW5kcmV3KQoqIERyb3Aga21hcCBmb3Igbm93LCBh
cyBpdHMgb3B0aW9uYWwgKGZvbGRlZCBpbiBmcm9tIEFuZHJldykKKiBGb2xkIGRtYV9oZWFwX21h
cF91c2VyIGludG8gdGhlIHNpbmdsZSBjYWxsZXIgKGZvbGVkIGluIGZyb20KICBBbmRyZXcpCiog
Rm9sZGVkIGluIHBhdGNoIGZyb20gQW5kcmV3IHRvIHRyYWNrIHBhZ2UgbGlzdCBwZXIgaGVhcCBu
b3QKICBzZ2xpc3QsIHdoaWNoIHNpbXBsaWZpZXMgdGhlIHRyYWNraW5nIGxvZ2ljCnY0OgoqIE1v
dmVkIGRtYS1oZWFwLmggY2hhbmdlIG91dCB0byBwcmV2aW91cyBwYXRjaAp2NjoKKiBNaW5vciBj
bGVhbnVwcyBhbmQgdHlwbyBmaXhlcyBzdWdnZXN0ZWQgYnkgQnJpYW4Kdjc6CiogUmVtb3ZlZCBz
dHJheSA7CiogTWFrZSBpbml0X2hlYXBfaGVscGVyX2J1ZmZlciBsb3dlcmNhc2UsIGFzIHN1Z2dl
c3RlZCBieSBDaHJpc3RvcGgKKiBBZGQgZG1hYnVmIGV4cG9ydCBoZWxwZXIgdG8gcmVkdWNlIGJv
aWxlcnBsYXRlIGNvZGUKdjg6CiogUmVtb3ZlIHVudXNlZCBwcml2YXRlX2ZsYWdzIHZhbHVlCiog
Q29uZGVuc2UgZG1hX2hlYXBfYnVmZmVyIGFuZCBoZWFwX2hlbHBlcl9idWZmZXIgKHN1Z2dlc3Rl
ZCBieQogIENocmlzdG9waCkKKiBGaXggaW5kZW50YXRpb24gYnkgdXNpbmcgc2hvcnRlciBhcmd1
bWVudCBuYW1lcyAoc3VnZ2VzdGVkIGJ5CiAgQ2hyaXN0b3BoKQoqIEFkZCBmbHVzaF9rZXJuZWxf
dm1hcF9yYW5nZS9pbnZhbGlkYXRlX2tlcm5lbF92bWFwX3JhbmdlIGNhbGxzCiAgKHN1Z2dlc3Rl
ZCBieSBDaHJpc3RvcGgpCiogQ2hlY2twYXRjaCB3aGl0ZXNwYWNlIGZpeHVwcwp2OToKKiBNaW5v
ciBjbGVhbnVwcyBzdWdnZXN0ZWQgYnkgQnJpYW4gU3RhcmtleQp2MTA6CiogRml4IG1pc3Npbmcg
dm1hbGxvYy5oIGluY2x1c2lvbiBpbiBoZWFwIGhlbHBlcnMgKGZvdW5kIGJ5CiAga2J1aWxkIHRl
c3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+KQp2MTI6CiogQWRkIHN5bWJvbCBleHBvcnRzIGZvciBo
ZWFwcyBhcyBtb2R1bGVzCi0tLQogZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlICAgICAgICAgICAg
IHwgICAxICsKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSAgICAgICB8ICAgMiArCiBk
cml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMgfCAyNzAgKysrKysrKysrKysrKysr
KysrKysrKysrKysrCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmggfCAgNTUg
KysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDMyOCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9kbWEtYnVmL01ha2VmaWxlIGIvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCmluZGV4IGNhZWU1
ZWIzZDM1MS4uOWMxOTAwMjZiZmFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvTWFrZWZp
bGUKKysrIGIvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCkBAIC0yLDYgKzIsNyBAQAogb2JqLXkg
Oj0gZG1hLWJ1Zi5vIGRtYS1mZW5jZS5vIGRtYS1mZW5jZS1hcnJheS5vIGRtYS1mZW5jZS1jaGFp
bi5vIFwKIAkgZG1hLXJlc3YubyBzZXFuby1mZW5jZS5vCiBvYmotJChDT05GSUdfRE1BQlVGX0hF
QVBTKQkrPSBkbWEtaGVhcC5vCitvYmotJChDT05GSUdfRE1BQlVGX0hFQVBTKQkrPSBoZWFwcy8K
IG9iai0kKENPTkZJR19TWU5DX0ZJTEUpCQkrPSBzeW5jX2ZpbGUubwogb2JqLSQoQ09ORklHX1NX
X1NZTkMpCQkrPSBzd19zeW5jLm8gc3luY19kZWJ1Zy5vCiBvYmotJChDT05GSUdfVURNQUJVRikJ
CSs9IHVkbWFidWYubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxl
IGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uZGU0OTg5ODExMmRiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCkBAIC0wLDAgKzEsMiBAQAorIyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMAorb2JqLXkJCQkJCSs9IGhlYXAtaGVscGVycy5vCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMgYi9kcml2ZXJzL2RtYS1i
dWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5mYjk4MzUxMjY4OTMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2RtYS1idWYv
aGVhcHMvaGVhcC1oZWxwZXJzLmMKQEAgLTAsMCArMSwyNzAgQEAKKy8vIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wCisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8
bGludXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4
L2hpZ2htZW0uaD4KKyNpbmNsdWRlIDxsaW51eC9pZHIuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0
Lmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4L3VhY2Nlc3MuaD4K
KyNpbmNsdWRlIDxsaW51eC92bWFsbG9jLmg+CisjaW5jbHVkZSA8dWFwaS9saW51eC9kbWEtaGVh
cC5oPgorCisjaW5jbHVkZSAiaGVhcC1oZWxwZXJzLmgiCisKK3ZvaWQgaW5pdF9oZWFwX2hlbHBl
cl9idWZmZXIoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyLAorCQkJICAgICB2b2lk
ICgqZnJlZSkoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqKSkKK3sKKwlidWZmZXItPnByaXZf
dmlydCA9IE5VTEw7CisJbXV0ZXhfaW5pdCgmYnVmZmVyLT5sb2NrKTsKKwlidWZmZXItPnZtYXBf
Y250ID0gMDsKKwlidWZmZXItPnZhZGRyID0gTlVMTDsKKwlidWZmZXItPnBhZ2Vjb3VudCA9IDA7
CisJYnVmZmVyLT5wYWdlcyA9IE5VTEw7CisJSU5JVF9MSVNUX0hFQUQoJmJ1ZmZlci0+YXR0YWNo
bWVudHMpOworCWJ1ZmZlci0+ZnJlZSA9IGZyZWU7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChpbml0
X2hlYXBfaGVscGVyX2J1ZmZlcik7CisKK3N0cnVjdCBkbWFfYnVmICpoZWFwX2hlbHBlcl9leHBv
cnRfZG1hYnVmKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciwKKwkJCQkJICBpbnQg
ZmRfZmxhZ3MpCit7CisJREVGSU5FX0RNQV9CVUZfRVhQT1JUX0lORk8oZXhwX2luZm8pOworCisJ
ZXhwX2luZm8ub3BzID0gJmhlYXBfaGVscGVyX29wczsKKwlleHBfaW5mby5zaXplID0gYnVmZmVy
LT5zaXplOworCWV4cF9pbmZvLmZsYWdzID0gZmRfZmxhZ3M7CisJZXhwX2luZm8ucHJpdiA9IGJ1
ZmZlcjsKKworCXJldHVybiBkbWFfYnVmX2V4cG9ydCgmZXhwX2luZm8pOworfQorRVhQT1JUX1NZ
TUJPTF9HUEwoaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1Zik7CisKK3N0YXRpYyB2b2lkICpkbWFf
aGVhcF9tYXBfa2VybmVsKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwl2
b2lkICp2YWRkcjsKKworCXZhZGRyID0gdm1hcChidWZmZXItPnBhZ2VzLCBidWZmZXItPnBhZ2Vj
b3VudCwgVk1fTUFQLCBQQUdFX0tFUk5FTCk7CisJaWYgKCF2YWRkcikKKwkJcmV0dXJuIEVSUl9Q
VFIoLUVOT01FTSk7CisKKwlyZXR1cm4gdmFkZHI7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFw
X2J1ZmZlcl9kZXN0cm95KHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwlp
ZiAoYnVmZmVyLT52bWFwX2NudCA+IDApIHsKKwkJV0FSTigiJXM6IGJ1ZmZlciBzdGlsbCBtYXBw
ZWQgaW4gdGhlIGtlcm5lbFxuIiwgX19mdW5jX18pOworCQl2dW5tYXAoYnVmZmVyLT52YWRkcik7
CisJfQorCisJYnVmZmVyLT5mcmVlKGJ1ZmZlcik7Cit9CisKK3N0YXRpYyB2b2lkICpkbWFfaGVh
cF9idWZmZXJfdm1hcF9nZXQoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQorewor
CXZvaWQgKnZhZGRyOworCisJaWYgKGJ1ZmZlci0+dm1hcF9jbnQpIHsKKwkJYnVmZmVyLT52bWFw
X2NudCsrOworCQlyZXR1cm4gYnVmZmVyLT52YWRkcjsKKwl9CisJdmFkZHIgPSBkbWFfaGVhcF9t
YXBfa2VybmVsKGJ1ZmZlcik7CisJaWYgKElTX0VSUih2YWRkcikpCisJCXJldHVybiB2YWRkcjsK
KwlidWZmZXItPnZhZGRyID0gdmFkZHI7CisJYnVmZmVyLT52bWFwX2NudCsrOworCXJldHVybiB2
YWRkcjsKK30KKworc3RhdGljIHZvaWQgZG1hX2hlYXBfYnVmZmVyX3ZtYXBfcHV0KHN0cnVjdCBo
ZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwlpZiAoIS0tYnVmZmVyLT52bWFwX2NudCkg
eworCQl2dW5tYXAoYnVmZmVyLT52YWRkcik7CisJCWJ1ZmZlci0+dmFkZHIgPSBOVUxMOworCX0K
K30KKworc3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50IHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7
CisJc3RydWN0IHNnX3RhYmxlIHRhYmxlOworCXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKK307CisK
K3N0YXRpYyBpbnQgZG1hX2hlYXBfYXR0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkg
ICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50KQoreworCXN0cnVjdCBkbWFf
aGVhcHNfYXR0YWNobWVudCAqYTsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIg
PSBkbWFidWYtPnByaXY7CisJaW50IHJldDsKKworCWEgPSBremFsbG9jKHNpemVvZigqYSksIEdG
UF9LRVJORUwpOworCWlmICghYSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBzZ19hbGxv
Y190YWJsZV9mcm9tX3BhZ2VzKCZhLT50YWJsZSwgYnVmZmVyLT5wYWdlcywKKwkJCQkJYnVmZmVy
LT5wYWdlY291bnQsIDAsCisJCQkJCWJ1ZmZlci0+cGFnZWNvdW50IDw8IFBBR0VfU0hJRlQsCisJ
CQkJCUdGUF9LRVJORUwpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUoYSk7CisJCXJldHVybiByZXQ7
CisJfQorCisJYS0+ZGV2ID0gYXR0YWNobWVudC0+ZGV2OworCUlOSVRfTElTVF9IRUFEKCZhLT5s
aXN0KTsKKworCWF0dGFjaG1lbnQtPnByaXYgPSBhOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5s
b2NrKTsKKwlsaXN0X2FkZCgmYS0+bGlzdCwgJmJ1ZmZlci0+YXR0YWNobWVudHMpOworCW11dGV4
X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBk
bWFfaGVhcF9kZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCSAgICBzdHJ1Y3QgZG1h
X2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50KQoreworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNo
bWVudCAqYSA9IGF0dGFjaG1lbnQtPnByaXY7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwls
aXN0X2RlbCgmYS0+bGlzdCk7CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJc2df
ZnJlZV90YWJsZSgmYS0+dGFibGUpOworCWtmcmVlKGEpOworfQorCitzdGF0aWMKK3N0cnVjdCBz
Z190YWJsZSAqZG1hX2hlYXBfbWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAq
YXR0YWNobWVudCwKKwkJCQkgICAgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24p
Cit7CisJc3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsK
KwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOworCisJdGFibGUgPSAmYS0+dGFibGU7CisKKwlpZiAo
IWRtYV9tYXBfc2coYXR0YWNobWVudC0+ZGV2LCB0YWJsZS0+c2dsLCB0YWJsZS0+bmVudHMsCisJ
CQlkaXJlY3Rpb24pKQorCQl0YWJsZSA9IEVSUl9QVFIoLUVOT01FTSk7CisJcmV0dXJuIHRhYmxl
OworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF91bm1hcF9kbWFfYnVmKHN0cnVjdCBkbWFfYnVm
X2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQsCisJCQkJICAgc3RydWN0IHNnX3RhYmxlICp0YWJsZSwK
KwkJCQkgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJZG1hX3VubWFw
X3NnKGF0dGFjaG1lbnQtPmRldiwgdGFibGUtPnNnbCwgdGFibGUtPm5lbnRzLCBkaXJlY3Rpb24p
OworfQorCitzdGF0aWMgdm1fZmF1bHRfdCBkbWFfaGVhcF92bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1
bHQgKnZtZikKK3sKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOworCXN0
cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOwor
CisJdm1mLT5wYWdlID0gYnVmZmVyLT5wYWdlc1t2bWYtPnBnb2ZmXTsKKwlnZXRfcGFnZSh2bWYt
PnBhZ2UpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgdm1fb3BlcmF0
aW9uc19zdHJ1Y3QgZG1hX2hlYXBfdm1fb3BzID0geworCS5mYXVsdCA9IGRtYV9oZWFwX3ZtX2Zh
dWx0LAorfTsKKworc3RhdGljIGludCBkbWFfaGVhcF9tbWFwKHN0cnVjdCBkbWFfYnVmICpkbWFi
dWYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQoreworCXN0cnVjdCBoZWFwX2hlbHBlcl9i
dWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKworCWlmICgodm1hLT52bV9mbGFncyAmIChW
TV9TSEFSRUQgfCBWTV9NQVlTSEFSRSkpID09IDApCisJCXJldHVybiAtRUlOVkFMOworCisJdm1h
LT52bV9vcHMgPSAmZG1hX2hlYXBfdm1fb3BzOworCXZtYS0+dm1fcHJpdmF0ZV9kYXRhID0gYnVm
ZmVyOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFwX2RtYV9idWZfcmVs
ZWFzZShzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmKQoreworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZm
ZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKworCWRtYV9oZWFwX2J1ZmZlcl9kZXN0cm95KGJ1
ZmZlcik7Cit9CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBfZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNz
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkJCSAgICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rp
b24gZGlyZWN0aW9uKQoreworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IGRt
YWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgZG1hX2hlYXBzX2F0dGFjaG1lbnQgKmE7CisJaW50IHJldCA9
IDA7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOworCisJaWYgKGJ1ZmZlci0+dm1hcF9j
bnQpCisJCWludmFsaWRhdGVfa2VybmVsX3ZtYXBfcmFuZ2UoYnVmZmVyLT52YWRkciwgYnVmZmVy
LT5zaXplKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMs
IGxpc3QpIHsKKwkJZG1hX3N5bmNfc2dfZm9yX2NwdShhLT5kZXYsIGEtPnRhYmxlLnNnbCwgYS0+
dGFibGUubmVudHMsCisJCQkJICAgIGRpcmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygmYnVm
ZmVyLT5sb2NrKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBfZG1h
X2J1Zl9lbmRfY3B1X2FjY2VzcyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAorCQkJCQkgICBlbnVt
IGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1
ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVu
dCAqYTsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+bG9jayk7CisKKwlpZiAoYnVmZmVyLT52bWFw
X2NudCkKKwkJZmx1c2hfa2VybmVsX3ZtYXBfcmFuZ2UoYnVmZmVyLT52YWRkciwgYnVmZmVyLT5z
aXplKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMsIGxp
c3QpIHsKKwkJZG1hX3N5bmNfc2dfZm9yX2RldmljZShhLT5kZXYsIGEtPnRhYmxlLnNnbCwgYS0+
dGFibGUubmVudHMsCisJCQkJICAgICAgIGRpcmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygm
YnVmZmVyLT5sb2NrKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCAqZG1hX2hlYXBf
ZG1hX2J1Zl92bWFwKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCit7CisJc3RydWN0IGhlYXBfaGVs
cGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCXZvaWQgKnZhZGRyOworCisJbXV0
ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwl2YWRkciA9IGRtYV9oZWFwX2J1ZmZlcl92bWFwX2dl
dChidWZmZXIpOworCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKworCXJldHVybiB2YWRk
cjsKK30KKworc3RhdGljIHZvaWQgZG1hX2hlYXBfZG1hX2J1Zl92dW5tYXAoc3RydWN0IGRtYV9i
dWYgKmRtYWJ1Ziwgdm9pZCAqdmFkZHIpCit7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwlk
bWFfaGVhcF9idWZmZXJfdm1hcF9wdXQoYnVmZmVyKTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+
bG9jayk7Cit9CisKK2NvbnN0IHN0cnVjdCBkbWFfYnVmX29wcyBoZWFwX2hlbHBlcl9vcHMgPSB7
CisJLm1hcF9kbWFfYnVmID0gZG1hX2hlYXBfbWFwX2RtYV9idWYsCisJLnVubWFwX2RtYV9idWYg
PSBkbWFfaGVhcF91bm1hcF9kbWFfYnVmLAorCS5tbWFwID0gZG1hX2hlYXBfbW1hcCwKKwkucmVs
ZWFzZSA9IGRtYV9oZWFwX2RtYV9idWZfcmVsZWFzZSwKKwkuYXR0YWNoID0gZG1hX2hlYXBfYXR0
YWNoLAorCS5kZXRhY2ggPSBkbWFfaGVhcF9kZXRhY2gsCisJLmJlZ2luX2NwdV9hY2Nlc3MgPSBk
bWFfaGVhcF9kbWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3MsCisJLmVuZF9jcHVfYWNjZXNzID0gZG1h
X2hlYXBfZG1hX2J1Zl9lbmRfY3B1X2FjY2VzcywKKwkudm1hcCA9IGRtYV9oZWFwX2RtYV9idWZf
dm1hcCwKKwkudnVubWFwID0gZG1hX2hlYXBfZG1hX2J1Zl92dW5tYXAsCit9OwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5oIGIvZHJpdmVycy9kbWEtYnVm
L2hlYXBzL2hlYXAtaGVscGVycy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uOTExYzkzMWY3ZjA2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hl
YXBzL2hlYXAtaGVscGVycy5oCkBAIC0wLDAgKzEsNTUgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wICovCisvKgorICogRE1BQlVGIEhlYXBzIGhlbHBlciBjb2RlCisgKgor
ICogQ29weXJpZ2h0IChDKSAyMDExIEdvb2dsZSwgSW5jLgorICogQ29weXJpZ2h0IChDKSAyMDE5
IExpbmFybyBMdGQuCisgKi8KKworI2lmbmRlZiBfSEVBUF9IRUxQRVJTX0gKKyNkZWZpbmUgX0hF
QVBfSEVMUEVSU19ICisKKyNpbmNsdWRlIDxsaW51eC9kbWEtaGVhcC5oPgorI2luY2x1ZGUgPGxp
bnV4L2xpc3QuaD4KKworLyoqCisgKiBzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyIC0gaGVscGVy
IGJ1ZmZlciBtZXRhZGF0YQorICogQGhlYXA6CQliYWNrIHBvaW50ZXIgdG8gdGhlIGhlYXAgdGhl
IGJ1ZmZlciBjYW1lIGZyb20KKyAqIEBkbWFidWY6CQliYWNraW5nIGRtYS1idWYgZm9yIHRoaXMg
YnVmZmVyCisgKiBAc2l6ZToJCXNpemUgb2YgdGhlIGJ1ZmZlcgorICogQGZsYWdzOgkJYnVmZmVy
IHNwZWNpZmljIGZsYWdzCisgKiBAcHJpdl92aXJ0CQlwb2ludGVyIHRvIGhlYXAgc3BlY2lmaWMg
cHJpdmF0ZSB2YWx1ZQorICogQGxvY2sJCW11dGV4dCB0byBwcm90ZWN0IHRoZSBkYXRhIGluIHRo
aXMgc3RydWN0dXJlCisgKiBAdm1hcF9jbnQJCWNvdW50IG9mIHZtYXAgcmVmZXJlbmNlcyBvbiB0
aGUgYnVmZmVyCisgKiBAdmFkZHIJCXZtYXAnZWQgdmlydHVhbCBhZGRyZXNzCisgKiBAcGFnZWNv
dW50CQludW1iZXIgb2YgcGFnZXMgaW4gdGhlIGJ1ZmZlcgorICogQHBhZ2VzCQlsaXN0IG9mIHBh
Z2UgcG9pbnRlcnMKKyAqIEBhdHRhY2htZW50cwkJbGlzdCBvZiBkZXZpY2UgYXR0YWNobWVudHMK
KyAqCisgKiBAZnJlZQkJaGVhcCBjYWxsYmFjayB0byBmcmVlIHRoZSBidWZmZXIKKyAqLworc3Ry
dWN0IGhlYXBfaGVscGVyX2J1ZmZlciB7CisJc3RydWN0IGRtYV9oZWFwICpoZWFwOworCXN0cnVj
dCBkbWFfYnVmICpkbWFidWY7CisJc2l6ZV90IHNpemU7CisJdW5zaWduZWQgbG9uZyBmbGFnczsK
KworCXZvaWQgKnByaXZfdmlydDsKKwlzdHJ1Y3QgbXV0ZXggbG9jazsKKwlpbnQgdm1hcF9jbnQ7
CisJdm9pZCAqdmFkZHI7CisJcGdvZmZfdCBwYWdlY291bnQ7CisJc3RydWN0IHBhZ2UgKipwYWdl
czsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGF0dGFjaG1lbnRzOworCisJdm9pZCAoKmZyZWUpKHN0cnVj
dCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcik7Cit9OworCit2b2lkIGluaXRfaGVhcF9oZWxw
ZXJfYnVmZmVyKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciwKKwkJCSAgICAgdm9p
ZCAoKmZyZWUpKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKikpOworCitzdHJ1Y3QgZG1hX2J1
ZiAqaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1ZihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpi
dWZmZXIsCisJCQkJCSAgaW50IGZkX2ZsYWdzKTsKKworZXh0ZXJuIGNvbnN0IHN0cnVjdCBkbWFf
YnVmX29wcyBoZWFwX2hlbHBlcl9vcHM7CisjZW5kaWYgLyogX0hFQVBfSEVMUEVSU19IICovCi0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
