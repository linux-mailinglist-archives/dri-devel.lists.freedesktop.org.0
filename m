Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 518422B66A6
	for <lists+dri-devel@lfdr.de>; Tue, 17 Nov 2020 15:06:29 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 09F116E239;
	Tue, 17 Nov 2020 14:06:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x542.google.com (mail-ed1-x542.google.com
 [IPv6:2a00:1450:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 185B26E223
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Nov 2020 14:06:20 +0000 (UTC)
Received: by mail-ed1-x542.google.com with SMTP id l5so22530974edq.11
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Nov 2020 06:06:20 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=avInBZgEtFiXWvNq8fNTnzGXMsyzbqpBTFvNeYKGhMQ=;
 b=eRzwySHwHKvoIrNnQcWvBvRQjrjK2Xr6QEtn8EpVawSbMY0BRk8OpLIhTpNr4mmtmG
 wAjkzJ5la2P25UagOcKbvlnKY2XMIjvgR2OfLt+f6/ZcJcumFzMzKkAyJgTdCqUqdjMh
 P/x/Pi8R28uDlVNx5vZAcR0jX1q/8aibjx4IdUx1+dA/gK8qv4sXvgGBGhZ8YiyPINfS
 +mPrrlyHozQDdDFqtO+wUlbO6AWuLWZJnlPq7ux9Jw1u5KgDS/B8AEJmIunHCvDa6r93
 w627ylQBDKIII6QfwK1qJFPYcinW6MWJ5UiXW4JeUM9s1bZDwuw5IpFa4xWztAfYg6+Z
 7XyQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=avInBZgEtFiXWvNq8fNTnzGXMsyzbqpBTFvNeYKGhMQ=;
 b=d319C0WEEQkYhJAOEzatJgntOcyduyd9EAXKR++P22OAUMr3rgaZaCDdk2bg9UcJdp
 Pvrsd2EXuxkMJu0mB93FrwEVi73mdO2JqNyeSgJXA2blA0PPbWZ4YUyuiHF2qsz3Eq6T
 NOX0RewygtIkWLP3sAzxeZOrVYO6OFSbcwsnqrOMctqs7iwAMnYcJmqdinpQxWwOuhDl
 J1L+w7ZrpnmRmR6Xnr40Se2LUPJrumjE/dfCb715g4PGRveIJou3nEBK2rgwz1wdt/UB
 C3P7/x6EcgOao1dYdqBafS7c9Nl9VFCQh/0kRE/J80OSCJDBaF2znNi5w0fQshdWmwcC
 VKIQ==
X-Gm-Message-State: AOAM531WIk9Ip69LK6rGkj0oUIBy7COnPa6+hEJyELbNkDoq5ifE76ED
 fIniIZyPyvxqie9yjpeWBiw=
X-Google-Smtp-Source: ABdhPJxpOZ4ZcRF10ahexXAFACcbmgNzskBB4r5ekACqTkF6+2hAtT5Ib71qNhzvbLAr8iO+zDOikw==
X-Received: by 2002:a50:de45:: with SMTP id a5mr20485735edl.91.1605621978550; 
 Tue, 17 Nov 2020 06:06:18 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:4d18:8ca3:78f:2e63])
 by smtp.gmail.com with ESMTPSA id h23sm11998900edv.69.2020.11.17.06.06.17
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 17 Nov 2020 06:06:18 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: airlied@linux.ie, Felix.Kuehling@amd.com, daniel@ffwll.ch,
 dri-devel@lists.freedesktop.org, linux-graphics-maintainer@vmware.com,
 sroland@vmware.com
Subject: [PATCH 2/3] drm/ttm: move memory accounting into vmwgfx
Date: Tue, 17 Nov 2020 15:06:14 +0100
Message-Id: <20201117140615.255887-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20201117140615.255887-1-christian.koenig@amd.com>
References: <20201117140615.255887-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBqdXN0IGFub3RoZXIgZmVhdHVyZSB3aGljaCBpcyBvbmx5IHVzZWQgYnkgVk1XR0ZY
LCBzbyBtb3ZlCml0IGludG8gdGhlIGRyaXZlciBpbnN0ZWFkLgoKSSd2ZSB0cmllZCB0byBhZGQg
dGhlIGFjY291bnRpbmcgc3lzZnMgZmlsZSB0byB0aGUga29iamVjdCBvZiB0aGUgZHJtCm1pbm9y
LCBidXQgSSdtIG5vdCAxMDAlIHN1cmUgaWYgdGhpcyB3b3JrcyBhcyBleHBlY3RlZC4KClNpZ25l
ZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0t
CiAuLi4vZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAgfCAxNiArKyst
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jICAgIHwgIDggKy0t
CiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jICAgICAgICAgfCAgNiArLQog
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICAgICAgICAgIHwgIDcgKy0KIGRy
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmggICAgICAgICB8ICAxIC0KIGRyaXZl
cnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jICAgICAgICAgICAgICB8ICA0ICstCiBkcml2ZXJz
L2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyAgICAgICAgfCAgOCArLS0KIGRyaXZlcnMv
Z3B1L2RybS90dG0vTWFrZWZpbGUgICAgICAgICAgICAgICAgICB8ICA2ICstCiBkcml2ZXJzL2dw
dS9kcm0vdHRtL3R0bV9iby5jICAgICAgICAgICAgICAgICAgfCA2NSArKysrKysrKy0tLS0tLS0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMgICAgICAgICAgICAgfCAgMSAt
CiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMgICAgICAgICAgICAgICAgfCAxMyArLS0t
CiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2VmaWxlICAgICAgICAgICAgICAgfCAgMiArLQog
ZHJpdmVycy9ncHUvZHJtL3t0dG0gPT4gdm13Z2Z4fS90dG1fbWVtb3J5LmMgIHwgMzEgKysrLS0t
LS0tCiAuLi4vZ3B1L2RybS92bXdnZnh9L3R0bV9tZW1vcnkuaCAgICAgICAgICAgICAgfCAgNSAr
LQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmggICAgICAgICAgIHwgIDMgKy0K
IGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMgICAgICAgICAgICB8IDIyICsrKysr
LS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jICAgICAgICAgICB8ICA1ICsr
CiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMgICAgfCAyOCArKysr
KysrLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaCAgICAgICAgICAgICAgICAgIHwgMTEg
Ky0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCAgICAgICAgICAgICAgIHwgIDEg
LQogaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oICAgICAgICAgICAgICAgICAgICAgIHwgIDEgKwog
MjEgZmlsZXMgY2hhbmdlZCwgMTE4IGluc2VydGlvbnMoKyksIDEyNiBkZWxldGlvbnMoLSkKIHJl
bmFtZSBkcml2ZXJzL2dwdS9kcm0ve3R0bSA9PiB2bXdnZnh9L3R0bV9tZW1vcnkuYyAoOTQlKQog
cmVuYW1lIHtpbmNsdWRlL2RybS90dG0gPT4gZHJpdmVycy9ncHUvZHJtL3Ztd2dmeH0vdHRtX21l
bW9yeS5oICg5NyUpCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ft
ZGtmZF9ncHV2bS5jCmluZGV4IDE3NTUzODY0NzBlNi4uNGVlYzczZGEwYTdiIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCkBAIC0xMTgs
NiArMTE4LDE2IEBAIHZvaWQgYW1kZ3B1X2FtZGtmZF9ncHV2bV9pbml0X21lbV9saW1pdHModm9p
ZCkKICAqLwogI2RlZmluZSBFU1RJTUFURV9QVF9TSVpFKG1lbV9zaXplKSAoKG1lbV9zaXplKSA+
PiAxNCkKIAorc3RhdGljIHNpemVfdCBhbWRncHVfYW1ka2ZkX2FjY19zaXplKHVpbnQ2NF90IHNp
emUpCit7CisJc2l6ZSA+Pj0gUEFHRV9TSElGVDsKKwlzaXplICo9IHNpemVvZihkbWFfYWRkcl90
KSArIHNpemVvZih2b2lkICopOworCisJcmV0dXJuIF9fcm91bmR1cF9wb3dfb2ZfdHdvKHNpemVv
ZihzdHJ1Y3QgYW1kZ3B1X2JvKSkgKworCQlfX3JvdW50dXBfcG93X29mX3R3byhzaXplb2Yoc3Ry
dWN0IHR0bV90dCkpICsKKwkJUEFHRV9BTElHTihzaXplKTsKK30KKwogc3RhdGljIGludCBhbWRn
cHVfYW1ka2ZkX3Jlc2VydmVfbWVtX2xpbWl0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CQl1aW50NjRfdCBzaXplLCB1MzIgZG9tYWluLCBib29sIHNnKQogewpAQCAtMTI2LDggKzEzNiw3
IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2FtZGtmZF9yZXNlcnZlX21lbV9saW1pdChzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAlzaXplX3QgYWNjX3NpemUsIHN5c3RlbV9tZW1fbmVlZGVkLCB0
dG1fbWVtX25lZWRlZCwgdnJhbV9uZWVkZWQ7CiAJaW50IHJldCA9IDA7CiAKLQlhY2Nfc2l6ZSA9
IHR0bV9ib19kbWFfYWNjX3NpemUoJmFkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAg
c2l6ZW9mKHN0cnVjdCBhbWRncHVfYm8pKTsKKwlhY2Nfc2l6ZSA9IGFtZGdwdV9hbWRrZmRfYWNj
X3NpemUoc2l6ZSk7CiAKIAl2cmFtX25lZWRlZCA9IDA7CiAJaWYgKGRvbWFpbiA9PSBBTURHUFVf
R0VNX0RPTUFJTl9HVFQpIHsKQEAgLTE3NCw4ICsxODMsNyBAQCBzdGF0aWMgdm9pZCB1bnJlc2Vy
dmVfbWVtX2xpbWl0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogewogCXNpemVfdCBhY2Nf
c2l6ZTsKIAotCWFjY19zaXplID0gdHRtX2JvX2RtYV9hY2Nfc2l6ZSgmYWRldi0+bW1hbi5iZGV2
LCBzaXplLAotCQkJCSAgICAgICBzaXplb2Yoc3RydWN0IGFtZGdwdV9ibykpOworCWFjY19zaXpl
ID0gYW1kZ3B1X2FtZGtmZF9hY2Nfc2l6ZShzaXplKTsKIAogCXNwaW5fbG9jaygma2ZkX21lbV9s
aW1pdC5tZW1fbGltaXRfbG9jayk7CiAJaWYgKGRvbWFpbiA9PSBBTURHUFVfR0VNX0RPTUFJTl9H
VFQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmpl
Y3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwppbmRleCBj
NmM5NzIzZDNkOGEuLmI0ZWQwNjYyZWM1YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9vYmplY3QuYwpAQCAtNTIzLDcgKzUyMyw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2Jv
X2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAl9OwogCXN0cnVjdCBhbWRn
cHVfYm8gKmJvOwogCXVuc2lnbmVkIGxvbmcgcGFnZV9hbGlnbiwgc2l6ZSA9IGJwLT5zaXplOwot
CXNpemVfdCBhY2Nfc2l6ZTsKIAlpbnQgcjsKIAogCS8qIE5vdGUgdGhhdCBHRFMvR1dTL09BIGFs
bG9jYXRlcyAxIHBhZ2UgcGVyIGJ5dGUvcmVzb3VyY2UuICovCkBAIC01NDYsOSArNTQ1LDYgQEAg
c3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LAogCiAJKmJvX3B0ciA9IE5VTEw7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUo
JmFkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCBhbWRncHVf
Ym8pKTsKLQogCWJvID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFtZGdwdV9ibyksIEdGUF9LRVJO
RUwpOwogCWlmIChibyA9PSBOVUxMKQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTU3Nyw4ICs1NzMs
OCBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19jcmVhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsCiAJCWJvLT50Ym8ucHJpb3JpdHkgPSAxOwogCiAJciA9IHR0bV9ib19pbml0X3Jlc2Vy
dmVkKCZhZGV2LT5tbWFuLmJkZXYsICZiby0+dGJvLCBzaXplLCBicC0+dHlwZSwKLQkJCQkgJmJv
LT5wbGFjZW1lbnQsIHBhZ2VfYWxpZ24sICZjdHgsIGFjY19zaXplLAotCQkJCSBOVUxMLCBicC0+
cmVzdiwgJmFtZGdwdV9ib19kZXN0cm95KTsKKwkJCQkgJmJvLT5wbGFjZW1lbnQsIHBhZ2VfYWxp
Z24sICZjdHgsICBOVUxMLAorCQkJCSBicC0+cmVzdiwgJmFtZGdwdV9ib19kZXN0cm95KTsKIAlp
ZiAodW5saWtlbHkociAhPSAwKSkKIAkJcmV0dXJuIHI7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92
cmFtX2hlbHBlci5jCmluZGV4IDAyY2EyMmU5MDI5MC4uNWNmNzc5NzA0OGUxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKQEAgLTE4OSw3ICsxODksNiBAQCBzdHJ1Y3QgZHJt
X2dlbV92cmFtX29iamVjdCAqZHJtX2dlbV92cmFtX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCXN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tID0gZGV2LT52cmFtX21tOwogCXN0cnVjdCB0
dG1fYm9fZGV2aWNlICpiZGV2OwogCWludCByZXQ7Ci0Jc2l6ZV90IGFjY19zaXplOwogCiAJaWYg
KFdBUk5fT05DRSghdm1tLCAiVlJBTSBNTSBub3QgaW5pdGlhbGl6ZWQiKSkKIAkJcmV0dXJuIEVS
Ul9QVFIoLUVJTlZBTCk7CkBAIC0yMTYsNyArMjE1LDYgQEAgc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmRybV9nZW1fdnJhbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAl9CiAK
IAliZGV2ID0gJnZtbS0+YmRldjsKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUoYmRl
diwgc2l6ZSwgc2l6ZW9mKCpnYm8pKTsKIAogCWdiby0+Ym8uYmRldiA9IGJkZXY7CiAJZHJtX2dl
bV92cmFtX3BsYWNlbWVudChnYm8sIERSTV9HRU1fVlJBTV9QTF9GTEFHX1NZU1RFTSk7CkBAIC0y
MjYsOCArMjI0LDggQEAgc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9j
cmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkgKiB0byByZWxlYXNlIGdiby0+Ym8uYmFz
ZSBhbmQga2ZyZWUgZ2JvLgogCSAqLwogCXJldCA9IHR0bV9ib19pbml0KGJkZXYsICZnYm8tPmJv
LCBzaXplLCB0dG1fYm9fdHlwZV9kZXZpY2UsCi0JCQkgICZnYm8tPnBsYWNlbWVudCwgcGdfYWxp
Z24sIGZhbHNlLCBhY2Nfc2l6ZSwKLQkJCSAgTlVMTCwgTlVMTCwgdHRtX2J1ZmZlcl9vYmplY3Rf
ZGVzdHJveSk7CisJCQkgICZnYm8tPnBsYWNlbWVudCwgcGdfYWxpZ24sIGZhbHNlLCBOVUxMLCBO
VUxMLAorCQkJICB0dG1fYnVmZmVyX29iamVjdF9kZXN0cm95KTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gRVJSX1BUUihyZXQpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKaW5kZXgg
N2FhNDI4Njc4NGFlLi4zZWQ1YmFjNzA4NTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9u
b3V2ZWF1L25vdXZlYXVfYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1
X2JvLmMKQEAgLTMwMCwxOCArMzAwLDE1IEBAIG5vdXZlYXVfYm9faW5pdChzdHJ1Y3Qgbm91dmVh
dV9ibyAqbnZibywgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGRvbWFpbiwKIAkJc3RydWN0IHNn
X3RhYmxlICpzZywgc3RydWN0IGRtYV9yZXN2ICpyb2JqKQogewogCWludCB0eXBlID0gc2cgPyB0
dG1fYm9fdHlwZV9zZyA6IHR0bV9ib190eXBlX2RldmljZTsKLQlzaXplX3QgYWNjX3NpemU7CiAJ
aW50IHJldDsKIAotCWFjY19zaXplID0gdHRtX2JvX2RtYV9hY2Nfc2l6ZShudmJvLT5iby5iZGV2
LCBzaXplLCBzaXplb2YoKm52Ym8pKTsKLQogCW52Ym8tPmJvLm1lbS5udW1fcGFnZXMgPSBzaXpl
ID4+IFBBR0VfU0hJRlQ7CiAJbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIGRvbWFpbiwg
MCk7CiAJSU5JVF9MSVNUX0hFQUQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKIAogCXJldCA9IHR0
bV9ib19pbml0KG52Ym8tPmJvLmJkZXYsICZudmJvLT5ibywgc2l6ZSwgdHlwZSwKLQkJCSAgJm52
Ym8tPnBsYWNlbWVudCwgYWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsCi0JCQkgIGFjY19zaXpl
LCBzZywgcm9iaiwgbm91dmVhdV9ib19kZWxfdHRtKTsKKwkJCSAgJm52Ym8tPnBsYWNlbWVudCwg
YWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsIHNnLAorCQkJICByb2JqLCBub3V2ZWF1X2JvX2Rl
bF90dG0pOwogCWlmIChyZXQpIHsKIAkJLyogdHRtIHdpbGwgY2FsbCBub3V2ZWF1X2JvX2RlbF90
dG0gaWYgaXQgZmFpbHMuLiAqLwogCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25v
dXZlYXVfZHJ2LmgKaW5kZXggOWQwNGQxYjM2NDM0Li44ZTkwYjNlNDdiYmUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaApAQCAtNTQsNyArNTQsNiBAQAogI2luY2x1ZGUgPGRy
bS90dG0vdHRtX2JvX2FwaS5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZlci5oPgog
I2luY2x1ZGUgPGRybS90dG0vdHRtX3BsYWNlbWVudC5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRt
X21lbW9yeS5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX21vZHVsZS5oPgogCiAjaW5jbHVkZSA8
ZHJtL2RybV9hdWRpb19jb21wb25lbnQuaD4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9x
eGwvcXhsX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKaW5kZXgg
Y2VlYmM1ODgxZjY4Li43MDViNTE1MzU0OTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9x
eGwvcXhsX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jCkBA
IC0xMzgsOCArMTM4LDggQEAgaW50IHF4bF9ib19jcmVhdGUoc3RydWN0IHF4bF9kZXZpY2UgKnFk
ZXYsCiAJcXhsX3R0bV9wbGFjZW1lbnRfZnJvbV9kb21haW4oYm8sIGRvbWFpbik7CiAKIAlyID0g
dHRtX2JvX2luaXRfcmVzZXJ2ZWQoJnFkZXYtPm1tYW4uYmRldiwgJmJvLT50Ym8sIHNpemUsIHR5
cGUsCi0JCQkJICZiby0+cGxhY2VtZW50LCAwLCAmY3R4LCBzaXplLAotCQkJCSBOVUxMLCBOVUxM
LCAmcXhsX3R0bV9ib19kZXN0cm95KTsKKwkJCQkgJmJvLT5wbGFjZW1lbnQsIDAsICZjdHgsIE5V
TEwsIE5VTEwsCisJCQkJICZxeGxfdHRtX2JvX2Rlc3Ryb3kpOwogCWlmICh1bmxpa2VseShyICE9
IDApKSB7CiAJCWlmIChyICE9IC1FUkVTVEFSVFNZUykKIAkJCWRldl9lcnIocWRldi0+ZGRldi5k
ZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jCmluZGV4IGFiODFlMzVjYjA2
MC4uOTM0MTA5NjM0ZWU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVv
bl9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYwpA
QCAtMTYxLDcgKzE2MSw2IEBAIGludCByYWRlb25fYm9fY3JlYXRlKHN0cnVjdCByYWRlb25fZGV2
aWNlICpyZGV2LAogCXN0cnVjdCByYWRlb25fYm8gKmJvOwogCWVudW0gdHRtX2JvX3R5cGUgdHlw
ZTsKIAl1bnNpZ25lZCBsb25nIHBhZ2VfYWxpZ24gPSByb3VuZHVwKGJ5dGVfYWxpZ24sIFBBR0Vf
U0laRSkgPj4gUEFHRV9TSElGVDsKLQlzaXplX3QgYWNjX3NpemU7CiAJaW50IHI7CiAKIAlzaXpl
ID0gQUxJR04oc2l6ZSwgUEFHRV9TSVpFKTsKQEAgLTE3NSw5ICsxNzQsNiBAQCBpbnQgcmFkZW9u
X2JvX2NyZWF0ZShzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwKIAl9CiAJKmJvX3B0ciA9IE5V
TEw7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUoJnJkZXYtPm1tYW4uYmRldiwg
c2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCByYWRlb25fYm8pKTsKLQogCWJvID0ga3ph
bGxvYyhzaXplb2Yoc3RydWN0IHJhZGVvbl9ibyksIEdGUF9LRVJORUwpOwogCWlmIChibyA9PSBO
VUxMKQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTIzMiw4ICsyMjgsOCBAQCBpbnQgcmFkZW9uX2Jv
X2NyZWF0ZShzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwKIAkvKiBLZXJuZWwgYWxsb2NhdGlv
biBhcmUgdW5pbnRlcnJ1cHRpYmxlICovCiAJZG93bl9yZWFkKCZyZGV2LT5wbS5tY2xrX2xvY2sp
OwogCXIgPSB0dG1fYm9faW5pdCgmcmRldi0+bW1hbi5iZGV2LCAmYm8tPnRibywgc2l6ZSwgdHlw
ZSwKLQkJCSZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAha2VybmVsLCBhY2Nfc2l6ZSwKLQkJ
CXNnLCByZXN2LCAmcmFkZW9uX3R0bV9ib19kZXN0cm95KTsKKwkJCSZiby0+cGxhY2VtZW50LCBw
YWdlX2FsaWduLCAha2VybmVsLCBzZywgcmVzdiwKKwkJCSZyYWRlb25fdHRtX2JvX2Rlc3Ryb3kp
OwogCXVwX3JlYWQoJnJkZXYtPnBtLm1jbGtfbG9jayk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkp
IHsKIAkJcmV0dXJuIHI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxl
IGIvZHJpdmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZQppbmRleCBiNmY1Zjg3YjI3MGYuLjdlOGRj
ODVjYWFjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZQorKysgYi9k
cml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlCkBAIC0yLDEwICsyLDggQEAKICMKICMgTWFrZWZp
bGUgZm9yIHRoZSBkcm0gZGV2aWNlIGRyaXZlci4gIFRoaXMgZHJpdmVyIHByb3ZpZGVzIHN1cHBv
cnQgZm9yIHRoZQogCi10dG0teSA6PSB0dG1fbWVtb3J5Lm8gdHRtX3R0Lm8gdHRtX2JvLm8gXAot
CXR0bV9ib191dGlsLm8gdHRtX2JvX3ZtLm8gdHRtX21vZHVsZS5vIFwKLQl0dG1fZXhlY2J1Zl91
dGlsLm8gdHRtX3JhbmdlX21hbmFnZXIubyBcCi0JdHRtX3Jlc291cmNlLm8gdHRtX3Bvb2wubwor
dHRtLXkgOj0gdHRtX3R0Lm8gdHRtX2JvLm8gdHRtX2JvX3V0aWwubyB0dG1fYm9fdm0ubyB0dG1f
bW9kdWxlLm8gXAorCXR0bV9leGVjYnVmX3V0aWwubyB0dG1fcmFuZ2VfbWFuYWdlci5vIHR0bV9y
ZXNvdXJjZS5vIHR0bV9wb29sLm8KIHR0bS0kKENPTkZJR19BR1ApICs9IHR0bV9hZ3BfYmFja2Vu
ZC5vCiAKIG9iai0kKENPTkZJR19EUk1fVFRNKSArPSB0dG0ubwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fYm8uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKaW5k
ZXggZTZiY2JmZTUzMGVjLi5hOTU4MTM1Y2IzZmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYwpAQCAtNDgw
LDcgKzQ4MCw2IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVm
KQogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPQogCSAgICBjb250YWluZXJfb2Yoa3Jl
Ziwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0LCBrcmVmKTsKIAlzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiA9IGJvLT5iZGV2OwotCXNpemVfdCBhY2Nfc2l6ZSA9IGJvLT5hY2Nfc2l6ZTsKIAlp
bnQgcmV0OwogCiAJaWYgKCFiby0+ZGVsZXRlZCkgewpAQCAtNTQxLDcgKzU0MCw2IEBAIHN0YXRp
YyB2b2lkIHR0bV9ib19yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQogCWlmICghdHRtX2JvX3Vz
ZXNfZW1iZWRkZWRfZ2VtX29iamVjdChibykpCiAJCWRtYV9yZXN2X2ZpbmkoJmJvLT5iYXNlLl9y
ZXN2KTsKIAliby0+ZGVzdHJveShibyk7Ci0JdHRtX21lbV9nbG9iYWxfZnJlZSgmdHRtX21lbV9n
bG9iLCBhY2Nfc2l6ZSk7CiB9CiAKIHZvaWQgdHRtX2JvX3B1dChzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvKQpAQCAtMTEwNSwyNSArMTEwMywxMyBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2
ZWQoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJCQkgc3RydWN0IHR0bV9wbGFjZW1lbnQg
KnBsYWNlbWVudCwKIAkJCSB1aW50MzJfdCBwYWdlX2FsaWdubWVudCwKIAkJCSBzdHJ1Y3QgdHRt
X29wZXJhdGlvbl9jdHggKmN0eCwKLQkJCSBzaXplX3QgYWNjX3NpemUsCiAJCQkgc3RydWN0IHNn
X3RhYmxlICpzZywKIAkJCSBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCiAJCQkgdm9pZCAoKmRlc3Ry
b3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKikpCiB7Ci0Jc3RydWN0IHR0bV9tZW1fZ2xv
YmFsICptZW1fZ2xvYiA9ICZ0dG1fbWVtX2dsb2I7Ci0JaW50IHJldCA9IDA7CiAJdW5zaWduZWQg
bG9uZyBudW1fcGFnZXM7CiAJYm9vbCBsb2NrZWQ7Ci0KLQlyZXQgPSB0dG1fbWVtX2dsb2JhbF9h
bGxvYyhtZW1fZ2xvYiwgYWNjX3NpemUsIGN0eCk7Ci0JaWYgKHJldCkgewotCQlwcl9lcnIoIk91
dCBvZiBrZXJuZWwgbWVtb3J5XG4iKTsKLQkJaWYgKGRlc3Ryb3kpCi0JCQkoKmRlc3Ryb3kpKGJv
KTsKLQkJZWxzZQotCQkJa2ZyZWUoYm8pOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9CisJaW50IHJl
dCA9IDA7CiAKIAludW1fcGFnZXMgPSAoc2l6ZSArIFBBR0VfU0laRSAtIDEpID4+IFBBR0VfU0hJ
RlQ7CiAJaWYgKG51bV9wYWdlcyA9PSAwKSB7CkBAIC0xMTMyLDcgKzExMTgsNiBAQCBpbnQgdHRt
X2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJCQkoKmRlc3Ry
b3kpKGJvKTsKIAkJZWxzZQogCQkJa2ZyZWUoYm8pOwotCQl0dG1fbWVtX2dsb2JhbF9mcmVlKG1l
bV9nbG9iLCBhY2Nfc2l6ZSk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAliby0+ZGVzdHJveSA9
IGRlc3Ryb3kgPyBkZXN0cm95IDogdHRtX2JvX2RlZmF1bHRfZGVzdHJveTsKQEAgLTExNTMsNyAr
MTEzOCw2IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwKIAliby0+bWVtLmJ1cy5hZGRyID0gTlVMTDsKIAliby0+bW92aW5nID0gTlVMTDsKIAli
by0+bWVtLnBsYWNlbWVudCA9IDA7Ci0JYm8tPmFjY19zaXplID0gYWNjX3NpemU7CiAJYm8tPnBp
bl9jb3VudCA9IDA7CiAJYm8tPnNnID0gc2c7CiAJaWYgKHJlc3YpIHsKQEAgLTEyMTMsNyArMTE5
Nyw2IEBAIGludCB0dG1fYm9faW5pdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJc3Ry
dWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCwKIAkJdWludDMyX3QgcGFnZV9hbGlnbm1lbnQs
CiAJCWJvb2wgaW50ZXJydXB0aWJsZSwKLQkJc2l6ZV90IGFjY19zaXplLAogCQlzdHJ1Y3Qgc2df
dGFibGUgKnNnLAogCQlzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCiAJCXZvaWQgKCpkZXN0cm95KSAo
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopKQpAQCAtMTIyMiw4ICsxMjA1LDcgQEAgaW50IHR0
bV9ib19pbml0KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCWludCByZXQ7CiAKIAlyZXQg
PSB0dG1fYm9faW5pdF9yZXNlcnZlZChiZGV2LCBibywgc2l6ZSwgdHlwZSwgcGxhY2VtZW50LAot
CQkJCSAgIHBhZ2VfYWxpZ25tZW50LCAmY3R4LCBhY2Nfc2l6ZSwKLQkJCQkgICBzZywgcmVzdiwg
ZGVzdHJveSk7CisJCQkJICAgcGFnZV9hbGlnbm1lbnQsICZjdHgsIHNnLCByZXN2LCBkZXN0cm95
KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCkBAIC0xMjM0LDIwICsxMjE2LDYgQEAgaW50
IHR0bV9ib19pbml0KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogfQogRVhQT1JUX1NZTUJP
TCh0dG1fYm9faW5pdCk7CiAKLXNpemVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1f
Ym9fZGV2aWNlICpiZGV2LAotCQkJICAgdW5zaWduZWQgbG9uZyBib19zaXplLAotCQkJICAgdW5z
aWduZWQgc3RydWN0X3NpemUpCi17Ci0JdW5zaWduZWQgbnBhZ2VzID0gKFBBR0VfQUxJR04oYm9f
c2l6ZSkpID4+IFBBR0VfU0hJRlQ7Ci0Jc2l6ZV90IHNpemUgPSAwOwotCi0Jc2l6ZSArPSB0dG1f
cm91bmRfcG90KHN0cnVjdF9zaXplKTsKLQlzaXplICs9IHR0bV9yb3VuZF9wb3QobnBhZ2VzICog
KDIqc2l6ZW9mKHZvaWQgKikgKyBzaXplb2YoZG1hX2FkZHJfdCkpKTsKLQlzaXplICs9IHR0bV9y
b3VuZF9wb3Qoc2l6ZW9mKHN0cnVjdCB0dG1fdHQpKTsKLQlyZXR1cm4gc2l6ZTsKLX0KLUVYUE9S
VF9TWU1CT0wodHRtX2JvX2RtYV9hY2Nfc2l6ZSk7Ci0KIHN0YXRpYyB2b2lkIHR0bV9ib19nbG9i
YWxfa29ial9yZWxlYXNlKHN0cnVjdCBrb2JqZWN0ICprb2JqKQogewogCXN0cnVjdCB0dG1fYm9f
Z2xvYmFsICpnbG9iID0KQEAgLTEyNjQsOSArMTIzMiwxMCBAQCBzdGF0aWMgdm9pZCB0dG1fYm9f
Z2xvYmFsX3JlbGVhc2Uodm9pZCkKIAlpZiAoLS10dG1fYm9fZ2xvYl91c2VfY291bnQgPiAwKQog
CQlnb3RvIG91dDsKIAorCXR0bV9wb29sX21ncl9maW5pKCk7CisKIAlrb2JqZWN0X2RlbCgmZ2xv
Yi0+a29iaik7CiAJa29iamVjdF9wdXQoJmdsb2ItPmtvYmopOwotCXR0bV9tZW1fZ2xvYmFsX3Jl
bGVhc2UoJnR0bV9tZW1fZ2xvYik7CiAJbWVtc2V0KGdsb2IsIDAsIHNpemVvZigqZ2xvYikpOwog
b3V0OgogCW11dGV4X3VubG9jaygmdHRtX2dsb2JhbF9tdXRleCk7CkBAIC0xMjc1LDYgKzEyNDQs
OCBAQCBzdGF0aWMgdm9pZCB0dG1fYm9fZ2xvYmFsX3JlbGVhc2Uodm9pZCkKIHN0YXRpYyBpbnQg
dHRtX2JvX2dsb2JhbF9pbml0KHZvaWQpCiB7CiAJc3RydWN0IHR0bV9ib19nbG9iYWwgKmdsb2Ig
PSAmdHRtX2JvX2dsb2I7CisJdWludDY0X3QgbnVtX3BhZ2VzLCBudW1fZG1hMzJfcGFnZXM7CisJ
c3RydWN0IHN5c2luZm8gc2k7CiAJaW50IHJldCA9IDA7CiAJdW5zaWduZWQgaTsKIApAQCAtMTI4
Miw5ICsxMjUzLDI3IEBAIHN0YXRpYyBpbnQgdHRtX2JvX2dsb2JhbF9pbml0KHZvaWQpCiAJaWYg
KCsrdHRtX2JvX2dsb2JfdXNlX2NvdW50ID4gMSkKIAkJZ290byBvdXQ7CiAKLQlyZXQgPSB0dG1f
bWVtX2dsb2JhbF9pbml0KCZ0dG1fbWVtX2dsb2IpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0Owor
CXNpX21lbWluZm8oJnNpKTsKKworCS8qIExpbWl0IHRoZSBudW1iZXIgb2YgcGFnZXMgaW4gdGhl
IHBvb2wgdG8gYWJvdXQgNTAlIG9mIHRoZSB0b3RhbAorCSAqIHN5c3RlbSBtZW1vcnkuCisJICov
CisJbnVtX3BhZ2VzID0gKHU2NClzaS50b3RhbHJhbSAqIHNpLm1lbV91bml0OworCW51bV9wYWdl
cyA9IChudW1fcGFnZXMgKiA1MCAvIDEwMCkgPj4gUEFHRV9TSElGVDsKKworCXR0bV9wb29sX21n
cl9pbml0KG51bV9wYWdlcyk7CisKKwkvKiBXZSBnZW5lcmFsbHkgYWxsb3cgVFRNIHRvIGFsbG9j
YXRlIGEgbWF4aW11bSBvZiA1MCUgb2YKKwkgKiB0aGUgYXZhaWxhYmxlIHN5c3RlbSBtZW1vcnku
CisJICovCisJbnVtX3BhZ2VzID0gKHU2NClzaS50b3RhbHJhbSAqIHNpLm1lbV91bml0OworCW51
bV9wYWdlcyA9IChudW1fcGFnZXMgKiA1MCAvIDEwMCkgPj4gUEFHRV9TSElGVDsKKworCS8qIEJ1
dCBmb3IgRE1BMzIgd2UgbGltaXQgb3Vyc2VsZiB0byBvbmx5IHVzZSAyR2lCIG1heGltdW0uICov
CisJbnVtX2RtYTMyX3BhZ2VzID0gKHU2NCkoc2kudG90YWxyYW0gLSBzaS50b3RhbGhpZ2gpICog
c2kubWVtX3VuaXQ7CisJbnVtX2RtYTMyX3BhZ2VzID0gbWluKG51bV9kbWEzMl9wYWdlcywgMlVM
TCA8PCAzMCkgPj4gUEFHRV9TSElGVDsKKworCXR0bV90dF9tZ3JfaW5pdChudW1fcGFnZXMsIG51
bV9kbWEzMl9wYWdlcyk7CiAKIAlzcGluX2xvY2tfaW5pdCgmZ2xvYi0+bHJ1X2xvY2spOwogCWds
b2ItPmR1bW15X3JlYWRfcGFnZSA9IGFsbG9jX3BhZ2UoX19HRlBfWkVSTyB8IEdGUF9ETUEzMik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMgYi9kcml2ZXJz
L2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKaW5kZXggN2NjYjIyOTVjYWMxLi4xYjYxOTU3NzEw
MTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKQEAgLTMwOSw3ICszMDksNiBAQCBzdGF0
aWMgaW50IHR0bV9idWZmZXJfb2JqZWN0X3RyYW5zZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8sCiAKIAlrcmVmX2luaXQoJmZiby0+YmFzZS5rcmVmKTsKIAlmYm8tPmJhc2UuZGVzdHJv
eSA9ICZ0dG1fdHJhbnNmZXJlZF9kZXN0cm95OwotCWZiby0+YmFzZS5hY2Nfc2l6ZSA9IDA7CiAJ
ZmJvLT5iYXNlLnBpbl9jb3VudCA9IDE7CiAJaWYgKGJvLT50eXBlICE9IHR0bV9ib190eXBlX3Nn
KQogCQlmYm8tPmJhc2UuYmFzZS5yZXN2ID0gJmZiby0+YmFzZS5iYXNlLl9yZXN2OwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fcG9vbC5jCmluZGV4IDFiOTY3ODBiNDk4OS4uNmE0ZTA5M2U3YTIyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fcG9vbC5jCkBAIC00MDcsMTYgKzQwNywxMCBAQCBpbnQgdHRtX3Bvb2xfYWxsb2Moc3Ry
dWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3QgdHRtX3R0ICp0dCwKIAkJCWNhY2hpbmcgPSBwYWdl
cyArICgxIDw8IG9yZGVyKTsKIAkJfQogCi0JCXIgPSB0dG1fbWVtX2dsb2JhbF9hbGxvY19wYWdl
KCZ0dG1fbWVtX2dsb2IsIHAsCi0JCQkJCSAgICAgICgxIDw8IG9yZGVyKSAqIFBBR0VfU0laRSwK
LQkJCQkJICAgICAgY3R4KTsKLQkJaWYgKHIpCi0JCQlnb3RvIGVycm9yX2ZyZWVfcGFnZTsKLQog
CQlpZiAoZG1hX2FkZHIpIHsKIAkJCXIgPSB0dG1fcG9vbF9tYXAocG9vbCwgb3JkZXIsIHAsICZk
bWFfYWRkcik7CiAJCQlpZiAocikKLQkJCQlnb3RvIGVycm9yX2dsb2JhbF9mcmVlOworCQkJCWdv
dG8gZXJyb3JfZnJlZV9wYWdlOwogCQl9CiAKIAkJbnVtX3BhZ2VzIC09IDEgPDwgb3JkZXI7CkBA
IC00MzAsOSArNDI0LDYgQEAgaW50IHR0bV9wb29sX2FsbG9jKHN0cnVjdCB0dG1fcG9vbCAqcG9v
bCwgc3RydWN0IHR0bV90dCAqdHQsCiAKIAlyZXR1cm4gMDsKIAotZXJyb3JfZ2xvYmFsX2ZyZWU6
Ci0JdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2IsIHAsICgxIDw8IG9yZGVy
KSAqIFBBR0VfU0laRSk7Ci0KIGVycm9yX2ZyZWVfcGFnZToKIAl0dG1fcG9vbF9mcmVlX3BhZ2Uo
cG9vbCwgdHQtPmNhY2hpbmcsIG9yZGVyLCBwKTsKIApAQCAtNDY3LDggKzQ1OCw2IEBAIHZvaWQg
dHRtX3Bvb2xfZnJlZShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCB0dG1fdHQgKnR0KQog
CiAJCW9yZGVyID0gdHRtX3Bvb2xfcGFnZV9vcmRlcihwb29sLCBwKTsKIAkJbnVtX3BhZ2VzID0g
MVVMTCA8PCBvcmRlcjsKLQkJdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2Is
IHAsCi0JCQkJCSBudW1fcGFnZXMgKiBQQUdFX1NJWkUpOwogCQlpZiAodHQtPmRtYV9hZGRyZXNz
KQogCQkJdHRtX3Bvb2xfdW5tYXAocG9vbCwgdHQtPmRtYV9hZGRyZXNzW2ldLCBudW1fcGFnZXMp
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC9NYWtlZmlsZQppbmRleCAzMWY4NWYwOWYxZmMuLjg2YWY1ZDdiMDI0
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2VmaWxlCkBAIC05LDcgKzksNyBAQCB2bXdnZngteSA6PSB2
bXdnZnhfZXhlY2J1Zi5vIHZtd2dmeF9nbXIubyB2bXdnZnhfa21zLm8gdm13Z2Z4X2Rydi5vIFwK
IAkgICAgdm13Z2Z4X2NvdGFibGUubyB2bXdnZnhfc28ubyB2bXdnZnhfYmluZGluZy5vIHZtd2dm
eF9tc2cubyBcCiAJICAgIHZtd2dmeF9zaW1wbGVfcmVzb3VyY2UubyB2bXdnZnhfdmEubyB2bXdn
ZnhfYmxpdC5vIFwKIAkgICAgdm13Z2Z4X3ZhbGlkYXRpb24ubyB2bXdnZnhfcGFnZV9kaXJ0eS5v
IHZtd2dmeF9zdHJlYW1vdXRwdXQubyBcCi0JICAgIHR0bV9vYmplY3QubyB0dG1fbG9jay5vCisJ
ICAgIHR0bV9vYmplY3QubyB0dG1fbG9jay5vIHR0bV9tZW1vcnkubwogCiB2bXdnZngtJChDT05G
SUdfVFJBTlNQQVJFTlRfSFVHRVBBR0UpICs9IHZtd2dmeF90aHAubwogb2JqLSQoQ09ORklHX0RS
TV9WTVdHRlgpIDo9IHZtd2dmeC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9tZW1vcnkuYyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9yeS5jCnNpbWlsYXJp
dHkgaW5kZXggOTQlCnJlbmFtZSBmcm9tIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX21lbW9yeS5j
CnJlbmFtZSB0byBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnkuYwppbmRleCBjNTMx
MzYwNDg2MzAuLmZhNzUxMTBkN2ZhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fbWVtb3J5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fbWVtb3J5LmMKQEAg
LTI4LDggKzI4LDYgQEAKIAogI2RlZmluZSBwcl9mbXQoZm10KSAiW1RUTV0gIiBmbXQKIAotI2lu
Y2x1ZGUgPGRybS90dG0vdHRtX21lbW9yeS5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRtX21vZHVs
ZS5oPgogI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8bGludXgvc2NoZWQu
aD4KICNpbmNsdWRlIDxsaW51eC93YWl0Lmg+CkBAIC0zNyw4ICszNSwxMSBAQAogI2luY2x1ZGUg
PGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KICNpbmNsdWRlIDxsaW51
eC9zd2FwLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fcG9vbC5oPgotI2luY2x1ZGUgPGRybS90
dG0vdHRtX3R0Lmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fZmlsZS5oPgorCisjaW5jbHVkZSAidHRtX21lbW9yeS5oIgogCiAjZGVmaW5lIFRUTV9N
RU1PUllfQUxMT0NfUkVUUklFUyA0CiAKQEAgLTQxMyw5ICs0MTQsOCBAQCBzdGF0aWMgaW50IHR0
bV9tZW1faW5pdF9kbWEzMl96b25lKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYiwKIH0KICNl
bmRpZgogCi1pbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmds
b2IpCitpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2Is
IHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0JdWludDY0X3QgbnVtX3BhZ2VzLCBudW1fZG1h
MzJfcGFnZXM7CiAJc3RydWN0IHR0bV9tZW1fem9uZSAqem9uZTsKIAlzdHJ1Y3Qgc3lzaW5mbyBz
aTsKIAlpbnQgcmV0OwpAQCAtNDI1LDcgKzQyNSw4IEBAIGludCB0dG1fbWVtX2dsb2JhbF9pbml0
KHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYikKIAlnbG9iLT5zd2FwX3F1ZXVlID0gY3JlYXRl
X3NpbmdsZXRocmVhZF93b3JrcXVldWUoInR0bV9zd2FwIik7CiAJSU5JVF9XT1JLKCZnbG9iLT53
b3JrLCB0dG1fc2hyaW5rX3dvcmspOwogCXJldCA9IGtvYmplY3RfaW5pdF9hbmRfYWRkKAotCQkm
Z2xvYi0+a29iaiwgJnR0bV9tZW1fZ2xvYl9rb2JqX3R5cGUsIHR0bV9nZXRfa29iaigpLCAibWVt
b3J5X2FjY291bnRpbmciKTsKKwkJJmdsb2ItPmtvYmosICZ0dG1fbWVtX2dsb2Jfa29ial90eXBl
LCAmZGV2LT5wcmltYXJ5LT5rZGV2LT5rb2JqLAorCQkibWVtb3J5X2FjY291bnRpbmciKTsKIAlp
ZiAodW5saWtlbHkocmV0ICE9IDApKSB7CiAJCWtvYmplY3RfcHV0KCZnbG9iLT5rb2JqKTsKIAkJ
cmV0dXJuIHJldDsKQEAgLTQ1MywxOSArNDU0LDYgQEAgaW50IHR0bV9tZW1fZ2xvYmFsX2luaXQo
c3RydWN0IHR0bV9tZW1fZ2xvYmFsICpnbG9iKQogCQlwcl9pbmZvKCJab25lICU3czogQXZhaWxh
YmxlIGdyYXBoaWNzIG1lbW9yeTogJWxsdSBLaUJcbiIsCiAJCQl6b25lLT5uYW1lLCAodW5zaWdu
ZWQgbG9uZyBsb25nKXpvbmUtPm1heF9tZW0gPj4gMTApOwogCX0KLQl0dG1fcG9vbF9tZ3JfaW5p
dChnbG9iLT56b25lX2tlcm5lbC0+bWF4X21lbS8oMipQQUdFX1NJWkUpKTsKLQotCS8qIFdlIGdl
bmVyYWxseSBhbGxvdyBUVE0gdG8gYWxsb2NhdGUgYSBtYXhpbXVtIG9mIDUwJSBvZgotCSAqIHRo
ZSBhdmFpbGFibGUgc3lzdGVtIG1lbW9yeS4KLQkgKi8KLQludW1fcGFnZXMgPSAodTY0KXNpLnRv
dGFscmFtICogc2kubWVtX3VuaXQ7Ci0JbnVtX3BhZ2VzID0gKG51bV9wYWdlcyAqIDUwIC8gMTAw
KSA+PiBQQUdFX1NISUZUOwotCi0JLyogQnV0IGZvciBETUEzMiB3ZSBsaW1pdCBvdXJzZWxmIHRv
IG9ubHkgdXNlIDJHaUIgbWF4aW11bS4gKi8KLQludW1fZG1hMzJfcGFnZXMgPSAodTY0KShzaS50
b3RhbHJhbSAtIHNpLnRvdGFsaGlnaCkgKiBzaS5tZW1fdW5pdDsKLQludW1fZG1hMzJfcGFnZXMg
PSBtaW4obnVtX2RtYTMyX3BhZ2VzLCAyVUxMIDw8IDMwKSA+PiBQQUdFX1NISUZUOwotCi0JdHRt
X3R0X21ncl9pbml0KG51bV9wYWdlcywgbnVtX2RtYTMyX3BhZ2VzKTsKIAogCXJldHVybiAwOwog
b3V0X25vX3pvbmU6CkBAIC00NzgsOSArNDY2LDYgQEAgdm9pZCB0dG1fbWVtX2dsb2JhbF9yZWxl
YXNlKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYikKIAlzdHJ1Y3QgdHRtX21lbV96b25lICp6
b25lOwogCXVuc2lnbmVkIGludCBpOwogCi0JLyogbGV0IHRoZSBwYWdlIGFsbG9jYXRvciBmaXJz
dCBzdG9wIHRoZSBzaHJpbmsgd29yay4gKi8KLQl0dG1fcG9vbF9tZ3JfZmluaSgpOwotCiAJZmx1
c2hfd29ya3F1ZXVlKGdsb2ItPnN3YXBfcXVldWUpOwogCWRlc3Ryb3lfd29ya3F1ZXVlKGdsb2It
PnN3YXBfcXVldWUpOwogCWdsb2ItPnN3YXBfcXVldWUgPSBOVUxMOwpkaWZmIC0tZ2l0IGEvaW5j
bHVkZS9kcm0vdHRtL3R0bV9tZW1vcnkuaCBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21l
bW9yeS5oCnNpbWlsYXJpdHkgaW5kZXggOTclCnJlbmFtZSBmcm9tIGluY2x1ZGUvZHJtL3R0bS90
dG1fbWVtb3J5LmgKcmVuYW1lIHRvIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9yeS5o
CmluZGV4IGMxZjE2Nzg4MWUzMy4uODUwZWU2Yzg2N2RhIDEwMDY0NAotLS0gYS9pbmNsdWRlL2Ry
bS90dG0vdHRtX21lbW9yeS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9y
eS5oCkBAIC0zNSw3ICszNSw4IEBACiAjaW5jbHVkZSA8bGludXgvZXJybm8uaD4KICNpbmNsdWRl
IDxsaW51eC9rb2JqZWN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbW0uaD4KLSNpbmNsdWRlICJ0dG1f
Ym9fYXBpLmgiCisKKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KIAogLyoqCiAgKiBz
dHJ1Y3QgdHRtX21lbV9nbG9iYWwgLSBHbG9iYWwgbWVtb3J5IGFjY291bnRpbmcgc3RydWN0dXJl
LgpAQCAtNzksNyArODAsNyBAQCBleHRlcm4gc3RydWN0IHR0bV9tZW1fZ2xvYmFsIHsKICNlbmRp
ZgogfSB0dG1fbWVtX2dsb2I7CiAKLWludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVjdCB0dG1f
bWVtX2dsb2JhbCAqZ2xvYik7CitpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21l
bV9nbG9iYWwgKmdsb2IsIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogdm9pZCB0dG1fbWVtX2ds
b2JhbF9yZWxlYXNlKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYik7CiBpbnQgdHRtX21lbV9n
bG9iYWxfYWxsb2Moc3RydWN0IHR0bV9tZW1fZ2xvYmFsICpnbG9iLCB1aW50NjRfdCBtZW1vcnks
CiAJCQkgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0
bV9vYmplY3QuaAppbmRleCBlZGUyNmRmODdjOTMuLjQ5YjA2NGYwY2IxOSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC90dG1fb2JqZWN0LmgKQEAgLTQzLDcgKzQzLDggQEAKICNpbmNsdWRlIDxsaW51eC9y
Y3VwZGF0ZS5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9oYXNodGFiLmg+Ci0jaW5jbHVkZSA8ZHJt
L3R0bS90dG1fbWVtb3J5Lmg+CisKKyNpbmNsdWRlICJ0dG1fbWVtb3J5LmgiCiAKIC8qKgogICog
ZW51bSB0dG1fcmVmX3R5cGUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13
Z2Z4X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCmluZGV4IDI2M2Q3
NmFlNDNmMC4uNTg3OGYwZTkxOTlmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4
L3Ztd2dmeF9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKQEAg
LTUwOCwxMSArNTA4LDE2IEBAIGludCB2bXdfYm9fY3JlYXRlX2tlcm5lbChzdHJ1Y3Qgdm13X3By
aXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBsb25nIHNpemUsCiAJYWNjX3NpemUgPSB0dG1fcm91
bmRfcG90KHNpemVvZigqYm8pKTsKIAlhY2Nfc2l6ZSArPSB0dG1fcm91bmRfcG90KG5wYWdlcyAq
IHNpemVvZih2b2lkICopKTsKIAlhY2Nfc2l6ZSArPSB0dG1fcm91bmRfcG90KHNpemVvZihzdHJ1
Y3QgdHRtX3R0KSk7CisKKwlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvYygmdHRtX21lbV9nbG9i
LCBhY2Nfc2l6ZSwgJmN0eCk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCWdvdG8gZXJyb3JfZnJl
ZTsKKwogCXJldCA9IHR0bV9ib19pbml0X3Jlc2VydmVkKCZkZXZfcHJpdi0+YmRldiwgYm8sIHNp
emUsCiAJCQkJICAgdHRtX2JvX3R5cGVfZGV2aWNlLCBwbGFjZW1lbnQsIDAsCi0JCQkJICAgJmN0
eCwgYWNjX3NpemUsIE5VTEwsIE5VTEwsIE5VTEwpOworCQkJCSAgICZjdHgsIE5VTEwsIE5VTEws
IE5VTEwpOwogCWlmICh1bmxpa2VseShyZXQpKQotCQlnb3RvIGVycm9yX2ZyZWU7CisJCWdvdG8g
ZXJyb3JfYWNjb3VudDsKIAogCXR0bV9ib19waW4oYm8pOwogCXR0bV9ib191bnJlc2VydmUoYm8p
OwpAQCAtNTIwLDYgKzUyNSw5IEBAIGludCB2bXdfYm9fY3JlYXRlX2tlcm5lbChzdHJ1Y3Qgdm13
X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBsb25nIHNpemUsCiAKIAlyZXR1cm4gMDsKIAor
ZXJyb3JfYWNjb3VudDoKKwl0dG1fbWVtX2dsb2JhbF9mcmVlKCZ0dG1fbWVtX2dsb2IsIGFjY19z
aXplKTsKKwogZXJyb3JfZnJlZToKIAlrZnJlZShibyk7CiAJcmV0dXJuIHJldDsKQEAgLTU1OSwx
MSArNTY3LDE3IEBAIGludCB2bXdfYm9faW5pdChzdHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2
LAogCXZtd19iby0+YmFzZS5wcmlvcml0eSA9IDM7CiAJdm13X2JvLT5yZXNfdHJlZSA9IFJCX1JP
T1Q7CiAKKwlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvYygmdHRtX21lbV9nbG9iLCBhY2Nfc2l6
ZSwgJmN0eCk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCXJldHVybiByZXQ7CisKIAlyZXQgPSB0
dG1fYm9faW5pdF9yZXNlcnZlZChiZGV2LCAmdm13X2JvLT5iYXNlLCBzaXplLAogCQkJCSAgIHR0
bV9ib190eXBlX2RldmljZSwgcGxhY2VtZW50LAotCQkJCSAgIDAsICZjdHgsIGFjY19zaXplLCBO
VUxMLCBOVUxMLCBib19mcmVlKTsKLQlpZiAodW5saWtlbHkocmV0KSkKKwkJCQkgICAwLCAmY3R4
LCBOVUxMLCBOVUxMLCBib19mcmVlKTsKKwlpZiAodW5saWtlbHkocmV0KSkgeworCQl0dG1fbWVt
X2dsb2JhbF9mcmVlKCZ0dG1fbWVtX2dsb2IsIGFjY19zaXplKTsKIAkJcmV0dXJuIHJldDsKKwl9
CiAKIAlpZiAocGluKQogCQl0dG1fYm9fcGluKCZ2bXdfYm8tPmJhc2UpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13
Z2Z4L3Ztd2dmeF9kcnYuYwppbmRleCAyMTZkYWY5MzAyMmMuLjEzMTA4NTc4NzllNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMKQEAgLTEyNzMsNiArMTI3Myw3IEBAIHN0YXRpYyB2
b2lkIHZtd19yZW1vdmUoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKIAorCXR0bV9tZW1fZ2xvYmFsX3JlbGVh
c2UoJnR0bV9tZW1fZ2xvYik7CiAJZHJtX2Rldl91bnJlZ2lzdGVyKGRldik7CiAJdm13X2RyaXZl
cl91bmxvYWQoZGV2KTsKIAlkcm1fZGV2X3B1dChkZXYpOwpAQCAtMTUyMCw2ICsxNTIxLDEwIEBA
IHN0YXRpYyBpbnQgdm13X3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3Qg
cGNpX2RldmljZV9pZCAqZW50KQogCQlnb3RvIGVycl9wY2lfZGlzYWJsZV9kZXZpY2U7CiAJfQog
CisJcmV0ID0gdHRtX21lbV9nbG9iYWxfaW5pdCgmdHRtX21lbV9nbG9iLCBkZXYpOworCWlmIChy
ZXQpCisJCXJldHVybiByZXQ7CisKIAlkZXYtPnBkZXYgPSBwZGV2OwogCXBjaV9zZXRfZHJ2ZGF0
YShwZGV2LCBkZXYpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dm
eF90dG1fYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVy
LmMKaW5kZXggNmEwNDI2MWNlNzYwLi4xMjhlOTc3OTM5YzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMKQEAgLTU3NSwxMSArNTc1LDMxIEBAIHN0YXRpYyB2
b2lkIHZtd190dG1fZGVzdHJveShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwgc3RydWN0IHR0
bV90dCAqdHRtKQogc3RhdGljIGludCB2bXdfdHRtX3BvcHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2
aWNlICpiZGV2LAogCQkJICAgIHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9vcGVyYXRp
b25fY3R4ICpjdHgpCiB7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJldDsKKwogCS8qIFRPRE86
IG1heWJlIGNvbXBsZXRlbHkgZHJvcCB0aGlzID8gKi8KIAlpZiAodHRtX3R0X2lzX3BvcHVsYXRl
ZCh0dG0pKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiB0dG1fcG9vbF9hbGxvYygmYmRldi0+cG9v
bCwgdHRtLCBjdHgpOworCXJldCA9IHR0bV9wb29sX2FsbG9jKCZiZGV2LT5wb29sLCB0dG0sIGN0
eCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7IGkgPCB0dG0tPm51
bV9wYWdlczsgKytpKSB7CisJCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9jX3BhZ2UoJnR0bV9t
ZW1fZ2xvYiwgdHRtLT5wYWdlc1tpXSwKKwkJCQkJCVBBR0VfU0laRSwgY3R4KTsKKwkJaWYgKHJl
dCkKKwkJCWdvdG8gZXJyb3I7CisJfQorCXJldHVybiAwOworCitlcnJvcjoKKwl3aGlsZSAoaS0t
KQorCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1fZ2xvYiwgdHRtLT5wYWdlc1tp
XSwKKwkJCQkJIFBBR0VfU0laRSk7CisJdHRtX3Bvb2xfZnJlZSgmYmRldi0+cG9vbCwgdHRtKTsK
KwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCB2bXdfdHRtX3VucG9wdWxhdGUoc3RydWN0
IHR0bV9ib19kZXZpY2UgKmJkZXYsCkBAIC01ODcsNiArNjA3LDcgQEAgc3RhdGljIHZvaWQgdm13
X3R0bV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogewogCXN0cnVjdCB2
bXdfdHRtX3R0ICp2bXdfdHQgPSBjb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwK
IAkJCQkJCSBkbWFfdHRtKTsKKwl1bnNpZ25lZCBpbnQgaTsKIAogCWlmICh2bXdfdHQtPm1vYikg
ewogCQl2bXdfbW9iX2Rlc3Ryb3kodm13X3R0LT5tb2IpOwpAQCAtNTk0LDYgKzYxNSwxMSBAQCBz
dGF0aWMgdm9pZCB2bXdfdHRtX3VucG9wdWxhdGUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
CiAJfQogCiAJdm13X3R0bV91bm1hcF9kbWEodm13X3R0KTsKKworCWZvciAoaSA9IDA7IGkgPCB0
dG0tPm51bV9wYWdlczsgKytpKQorCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1f
Z2xvYiwgdHRtLT5wYWdlc1tpXSwKKwkJCQkJIFBBR0VfU0laRSk7CisKIAl0dG1fcG9vbF9mcmVl
KCZiZGV2LT5wb29sLCB0dG0pOwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRt
X2JvX2FwaS5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRleCAyNTY0ZTY2ZTY3
ZDcuLmU1MDI3ZjdjZGQ2OCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGku
aAorKysgYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCkBAIC04OCw3ICs4OCw2IEBAIHN0
cnVjdCB0dG1fdHQ7CiAgKiBAdHlwZTogVGhlIGJvIHR5cGUuCiAgKiBAZGVzdHJveTogRGVzdHJ1
Y3Rpb24gZnVuY3Rpb24uIElmIE5VTEwsIGtmcmVlIGlzIHVzZWQuCiAgKiBAbnVtX3BhZ2VzOiBB
Y3R1YWwgbnVtYmVyIG9mIHBhZ2VzLgotICogQGFjY19zaXplOiBBY2NvdW50ZWQgc2l6ZSBmb3Ig
dGhpcyBvYmplY3QuCiAgKiBAa3JlZjogUmVmZXJlbmNlIGNvdW50IG9mIHRoaXMgYnVmZmVyIG9i
amVjdC4gV2hlbiB0aGlzIHJlZmNvdW50IHJlYWNoZXMKICAqIHplcm8sIHRoZSBvYmplY3QgaXMg
ZGVzdHJveWVkIG9yIHB1dCBvbiB0aGUgZGVsYXllZCBkZWxldGUgbGlzdC4KICAqIEBtZW06IHN0
cnVjdHVyZSBkZXNjcmliaW5nIGN1cnJlbnQgcGxhY2VtZW50LgpAQCAtMTI2LDcgKzEyNSw2IEBA
IHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCB7CiAJZW51bSB0dG1fYm9fdHlwZSB0eXBlOwogCXZv
aWQgKCpkZXN0cm95KSAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopOwogCXVuc2lnbmVkIGxv
bmcgbnVtX3BhZ2VzOwotCXNpemVfdCBhY2Nfc2l6ZTsKIAogCS8qKgogCSogTWVtYmVycyBub3Qg
bmVlZGluZyBwcm90ZWN0aW9uLgpAQCAtMzU2LDEwICszNTQsNiBAQCB2b2lkIHR0bV9ib191bmxv
Y2tfZGVsYXllZF93b3JrcXVldWUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIGludCByZXNj
aGVkKTsKIGJvb2wgdHRtX2JvX2V2aWN0aW9uX3ZhbHVhYmxlKHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSk7CiAKLXNp
emVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAotCQkJ
ICAgdW5zaWduZWQgbG9uZyBib19zaXplLAotCQkJICAgdW5zaWduZWQgc3RydWN0X3NpemUpOwot
CiAvKioKICAqIHR0bV9ib19pbml0X3Jlc2VydmVkCiAgKgpAQCAtMzcwLDcgKzM2NCw2IEBAIHNp
emVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogICog
QGZsYWdzOiBJbml0aWFsIHBsYWNlbWVudCBmbGFncy4KICAqIEBwYWdlX2FsaWdubWVudDogRGF0
YSBhbGlnbm1lbnQgaW4gcGFnZXMuCiAgKiBAY3R4OiBUVE0gb3BlcmF0aW9uIGNvbnRleHQgZm9y
IG1lbW9yeSBhbGxvY2F0aW9uLgotICogQGFjY19zaXplOiBBY2NvdW50ZWQgc2l6ZSBmb3IgdGhp
cyBvYmplY3QuCiAgKiBAcmVzdjogUG9pbnRlciB0byBhIGRtYV9yZXN2LCBvciBOVUxMIHRvIGxl
dCB0dG0gYWxsb2NhdGUgb25lLgogICogQGRlc3Ryb3k6IERlc3Ryb3kgZnVuY3Rpb24uIFVzZSBO
VUxMIGZvciBrZnJlZSgpLgogICoKQEAgLTQwMiw3ICszOTUsNiBAQCBpbnQgdHRtX2JvX2luaXRf
cmVzZXJ2ZWQoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJCQkgc3RydWN0IHR0bV9wbGFj
ZW1lbnQgKnBsYWNlbWVudCwKIAkJCSB1aW50MzJfdCBwYWdlX2FsaWdubWVudCwKIAkJCSBzdHJ1
Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwKLQkJCSBzaXplX3QgYWNjX3NpemUsCiAJCQkgc3Ry
dWN0IHNnX3RhYmxlICpzZywKIAkJCSBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCiAJCQkgdm9pZCAo
KmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKikpOwpAQCAtNDIyLDcgKzQxNCw2
IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwK
ICAqIGhvbGRzIGEgcG9pbnRlciB0byBhIHBlcnNpc3RlbnQgc2htZW0gb2JqZWN0LiBUeXBpY2Fs
bHksIHRoaXMgd291bGQKICAqIHBvaW50IHRvIHRoZSBzaG1lbSBvYmplY3QgYmFja2luZyBhIEdF
TSBvYmplY3QgaWYgVFRNIGlzIHVzZWQgdG8gYmFjayBhCiAgKiBHRU0gdXNlciBpbnRlcmZhY2Uu
Ci0gKiBAYWNjX3NpemU6IEFjY291bnRlZCBzaXplIGZvciB0aGlzIG9iamVjdC4KICAqIEByZXN2
OiBQb2ludGVyIHRvIGEgZG1hX3Jlc3YsIG9yIE5VTEwgdG8gbGV0IHR0bSBhbGxvY2F0ZSBvbmUu
CiAgKiBAZGVzdHJveTogRGVzdHJveSBmdW5jdGlvbi4gVXNlIE5VTEwgZm9yIGtmcmVlKCkuCiAg
KgpAQCAtNDQ3LDcgKzQzOCw3IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChzdHJ1Y3QgdHRt
X2JvX2RldmljZSAqYmRldiwKIGludCB0dG1fYm9faW5pdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJdW5zaWduZWQgbG9uZyBzaXpl
LCBlbnVtIHR0bV9ib190eXBlIHR5cGUsCiAJCXN0cnVjdCB0dG1fcGxhY2VtZW50ICpwbGFjZW1l
bnQsCi0JCXVpbnQzMl90IHBhZ2VfYWxpZ25tZW50LCBib29sIGludGVycnVidGlibGUsIHNpemVf
dCBhY2Nfc2l6ZSwKKwkJdWludDMyX3QgcGFnZV9hbGlnbm1lbnQsIGJvb2wgaW50ZXJydWJ0aWJs
ZSwKIAkJc3RydWN0IHNnX3RhYmxlICpzZywgc3RydWN0IGRtYV9yZXN2ICpyZXN2LAogCQl2b2lk
ICgqZGVzdHJveSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSk7CiAKZGlmZiAtLWdpdCBh
L2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX2Jv
X2RyaXZlci5oCmluZGV4IGYwMmY3Y2Y5YWU5MC4uNTQ3ODhhNTE2MGEwIDEwMDY0NAotLS0gYS9p
bmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1f
Ym9fZHJpdmVyLmgKQEAgLTM4LDcgKzM4LDYgQEAKICNpbmNsdWRlIDxsaW51eC9kbWEtcmVzdi5o
PgogCiAjaW5jbHVkZSAidHRtX2JvX2FwaS5oIgotI2luY2x1ZGUgInR0bV9tZW1vcnkuaCIKICNp
bmNsdWRlICJ0dG1fbW9kdWxlLmgiCiAjaW5jbHVkZSAidHRtX3BsYWNlbWVudC5oIgogI2luY2x1
ZGUgInR0bV90dC5oIgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oIGIvaW5j
bHVkZS9kcm0vdHRtL3R0bV90dC5oCmluZGV4IDA1Y2E0M2YxMzg4NC4uNGFjYjRkNWI1ZWVmIDEw
MDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKKysrIGIvaW5jbHVkZS9kcm0vdHRt
L3R0bV90dC5oCkBAIC0zMCw2ICszMCw3IEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KICNp
bmNsdWRlIDxkcm0vdHRtL3R0bV9jYWNoaW5nLmg+CiAKK3N0cnVjdCB0dG1fYm9fZGV2aWNlOwog
c3RydWN0IHR0bV90dDsKIHN0cnVjdCB0dG1fcmVzb3VyY2U7CiBzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3Q7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbAo=
