Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9B8B0367F75
	for <lists+dri-devel@lfdr.de>; Thu, 22 Apr 2021 13:20:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2CB1389DB2;
	Thu, 22 Apr 2021 11:20:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x536.google.com (mail-ed1-x536.google.com
 [IPv6:2a00:1450:4864:20::536])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1923C89DB2;
 Thu, 22 Apr 2021 11:20:17 +0000 (UTC)
Received: by mail-ed1-x536.google.com with SMTP id j7so16091223eds.8;
 Thu, 22 Apr 2021 04:20:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=subject:to:references:from:message-id:date:user-agent:mime-version
 :in-reply-to:content-transfer-encoding:content-language;
 bh=bz7CVBGo66gRuIhMENCbnDDwMZdFX1Aj7UpilN92If4=;
 b=LplMLYdrcyKKm6QYt6sw8K4zX1IjMVSzQ+Wqq9T9GaXO9QGx0haIlCH4IUpaGecK1X
 e2uKTLfClE1zJ7bKUt38ro7s7glTXlHqKLY23OnxxYduBUlwUyupypMjjwYAScbEtoBe
 z27qNxiMIjZFja02Zfq3YG65Yw2dmjIGkqBo0khD7GTUp2vZmLKLgJEZSu/PXjb3qbRe
 r4qX3bmeVetuRYVm1LoQwVfE7VaNfHWbYVcUAMPzgCSA6alvL1t3B4rLDK/d+rPHxyX3
 JtCyJ+HY2lyncfkiqY1jwn/G4u4dmHwurCGknIawART1mQKJrJVB/L+hiWtj/ENxI9UA
 Dejw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:subject:to:references:from:message-id:date
 :user-agent:mime-version:in-reply-to:content-transfer-encoding
 :content-language;
 bh=bz7CVBGo66gRuIhMENCbnDDwMZdFX1Aj7UpilN92If4=;
 b=N0dQISmHRGV+nRX3FkXtsQqlUVRoJOOSxrKMKR/gPq8Jt/2yQPtsVeLaIZvtE2fiiN
 Mf2ujpdiA2IjTRNJZmkwZNgjnH1rkgarqrtBRV0NUOBuAr4cgAjIkqapBNgSw1Xw/ad4
 L8pghM9bzmFThP41fEP6eIrbvHlkrCWIauU0YoWZM70k31nJn8KfU35QF/cUfnIxPFq7
 vvuMLj5IZoefCVw4fQnn9DUNMl6C2TrIEOPVipbE/BGaTVJfYp/E/PCCZcTPBsg5ZVAD
 GjrZs3EnPhXgz6sKIudXi+yzl4beqB5sYa/xdXfSpHQIx2TS1neAeI354FtzZGCyzlO+
 Tl9w==
X-Gm-Message-State: AOAM530xOC2dVwcdP4WkoGv5Y2UDA6fb3otOeih5In1Pry+L8nxm1lxc
 dcmcPJEpgmJ3rGqjuifFEgXPVQ9G+Eg=
X-Google-Smtp-Source: ABdhPJwjYfG/fK1NnRYXYMW1MVRSWqwamUhe27Q7JpO5i3I+pK1LNwKe1oBixz07S2Y2KzE9HZV5gQ==
X-Received: by 2002:a05:6402:2061:: with SMTP id
 bd1mr3251914edb.50.1619090415707; 
 Thu, 22 Apr 2021 04:20:15 -0700 (PDT)
Received: from ?IPv6:2a02:908:1252:fb60:2fbd:d2a4:da7e:4526?
 ([2a02:908:1252:fb60:2fbd:d2a4:da7e:4526])
 by smtp.gmail.com with ESMTPSA id c19sm1868378edu.20.2021.04.22.04.20.14
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Thu, 22 Apr 2021 04:20:15 -0700 (PDT)
Subject: Re: [PATCH v2 10/10] drm/amdgpu: Move dmabuf attach/detach to
 backend_(un)bind
To: Felix Kuehling <Felix.Kuehling@amd.com>, amd-gfx@lists.freedesktop.org,
 dri-devel@lists.freedesktop.org
References: <20210422013058.6305-1-Felix.Kuehling@amd.com>
 <20210422013058.6305-11-Felix.Kuehling@amd.com>
From: =?UTF-8?Q?Christian_K=c3=b6nig?= <ckoenig.leichtzumerken@gmail.com>
Message-ID: <cbacb1f4-db64-be9b-ca53-5edc39a6a1e4@gmail.com>
Date: Thu, 22 Apr 2021 13:20:14 +0200
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101
 Thunderbird/78.7.1
MIME-Version: 1.0
In-Reply-To: <20210422013058.6305-11-Felix.Kuehling@amd.com>
Content-Language: en-US
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QW0gMjIuMDQuMjEgdW0gMDM6MzAgc2NocmllYiBGZWxpeCBLdWVobGluZzoKPiBUaGUgZG1hYnVm
IGF0dGFjaG1lbnQgc2hvdWxkIGJlIHVwZGF0ZWQgYnkgbW92aW5nIHRoZSBTRyBCTyB0byBET01B
SU5fQ1BVCj4gYW5kIGJhY2sgdG8gRE9NQUlOX0dUVC4gVGhpcyBkb2VzIG5vdCBuZWNlc3Nhcmls
eSBpbnZva2UgdGhlCj4gcG9wdWxhdGUvdW5wb3B1bGF0ZSBjYWxsYmFja3MuIERvIHRoaXMgaW4g
YmFja2VuZF9iaW5kL3VuYmluZCBpbnN0ZWFkLgo+Cj4gU2lnbmVkLW9mZi1ieTogRmVsaXggS3Vl
aGxpbmcgPEZlbGl4Lkt1ZWhsaW5nQGFtZC5jb20+CgpSZXZpZXdlZC1ieTogQ2hyaXN0aWFuIEvD
tm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgoKPiAtLS0KPiAgIC4uLi9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jICB8ICAzIC0tCj4gICBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgICAgICAgfCA1MSArKysrKysrKystLS0tLS0tLS0t
Cj4gICAyIGZpbGVzIGNoYW5nZWQsIDI1IGluc2VydGlvbnMoKyksIDI5IGRlbGV0aW9ucygtKQo+
Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRf
Z3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0u
Ywo+IGluZGV4IDE4YTFmOTIyMmE1OS4uNjhlNmNlOGRjZjMzIDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwo+ICsrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwo+IEBAIC01ODIsOSAr
NTgyLDYgQEAga2ZkX21lbV9kbWF1bm1hcF9kbWFidWYoc3RydWN0IGtmZF9tZW1fYXR0YWNobWVu
dCAqYXR0YWNobWVudCkKPiAgIAo+ICAgCWFtZGdwdV9ib19wbGFjZW1lbnRfZnJvbV9kb21haW4o
Ym8sIEFNREdQVV9HRU1fRE9NQUlOX0NQVSk7Cj4gICAJdHRtX2JvX3ZhbGlkYXRlKCZiby0+dGJv
LCAmYm8tPnBsYWNlbWVudCwgJmN0eCk7Cj4gLQkvKiBGSVhNRTogVGhpcyBkb2VzIG5vdCBndWFy
YW50ZWUgdGhhdCBhbWRncHVfdHRtX3R0X3VucG9wdWxhdGUgaXMKPiAtCSAqIGNhbGxlZAo+IC0J
ICovCj4gICB9Cj4gICAKPiAgIHN0YXRpYyB2b2lkCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV90dG0uYwo+IGluZGV4IDdlN2Q4MzMwZDY0Yi4uZmMyYThkNjgxZGJjIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwo+IEBAIC05MTAsNyArOTEwLDIz
IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3R0bV9iYWNrZW5kX2JpbmQoc3RydWN0IHR0bV9kZXZpY2Ug
KmJkZXYsCj4gICAJCQlEUk1fRVJST1IoImZhaWxlZCB0byBwaW4gdXNlcnB0clxuIik7Cj4gICAJ
CQlyZXR1cm4gcjsKPiAgIAkJfQo+ICsJfSBlbHNlIGlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1f
UEFHRV9GTEFHX1NHKSB7Cj4gKwkJaWYgKCF0dG0tPnNnKSB7Cj4gKwkJCXN0cnVjdCBkbWFfYnVm
X2F0dGFjaG1lbnQgKmF0dGFjaDsKPiArCQkJc3RydWN0IHNnX3RhYmxlICpzZ3Q7Cj4gKwo+ICsJ
CQlhdHRhY2ggPSBndHQtPmdvYmotPmltcG9ydF9hdHRhY2g7Cj4gKwkJCXNndCA9IGRtYV9idWZf
bWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBETUFfQklESVJFQ1RJT05BTCk7Cj4gKwkJCWlmIChJU19F
UlIoc2d0KSkKPiArCQkJCXJldHVybiBQVFJfRVJSKHNndCk7Cj4gKwo+ICsJCQl0dG0tPnNnID0g
c2d0Owo+ICsJCX0KPiArCj4gKwkJZHJtX3ByaW1lX3NnX3RvX2RtYV9hZGRyX2FycmF5KHR0bS0+
c2csIGd0dC0+dHRtLmRtYV9hZGRyZXNzLAo+ICsJCQkJCSAgICAgICB0dG0tPm51bV9wYWdlcyk7
Cj4gICAJfQo+ICsKPiAgIAlpZiAoIXR0bS0+bnVtX3BhZ2VzKSB7Cj4gICAJCVdBUk4oMSwgIm5v
dGhpbmcgdG8gYmluZCAldSBwYWdlcyBmb3IgbXJlZyAlcCBiYWNrICVwIVxuIiwKPiAgIAkJICAg
ICB0dG0tPm51bV9wYWdlcywgYm9fbWVtLCB0dG0pOwo+IEBAIC0xMDM3LDggKzEwNTMsMTUgQEAg
c3RhdGljIHZvaWQgYW1kZ3B1X3R0bV9iYWNrZW5kX3VuYmluZChzdHJ1Y3QgdHRtX2RldmljZSAq
YmRldiwKPiAgIAlpbnQgcjsKPiAgIAo+ICAgCS8qIGlmIHRoZSBwYWdlcyBoYXZlIHVzZXJwdHIg
cGlubmluZyB0aGVuIGNsZWFyIHRoYXQgZmlyc3QgKi8KPiAtCWlmIChndHQtPnVzZXJwdHIpCj4g
KwlpZiAoZ3R0LT51c2VycHRyKSB7Cj4gICAJCWFtZGdwdV90dG1fdHRfdW5waW5fdXNlcnB0cihi
ZGV2LCB0dG0pOwo+ICsJfSBlbHNlIGlmICh0dG0tPnNnICYmIGd0dC0+Z29iai0+aW1wb3J0X2F0
dGFjaCkgewo+ICsJCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKPiArCj4gKwkJ
YXR0YWNoID0gZ3R0LT5nb2JqLT5pbXBvcnRfYXR0YWNoOwo+ICsJCWRtYV9idWZfdW5tYXBfYXR0
YWNobWVudChhdHRhY2gsIHR0bS0+c2csIERNQV9CSURJUkVDVElPTkFMKTsKPiArCQl0dG0tPnNn
ID0gTlVMTDsKPiArCX0KPiAgIAo+ICAgCWlmICghZ3R0LT5ib3VuZCkKPiAgIAkJcmV0dXJuOwo+
IEBAIC0xMTI1LDIzICsxMTQ4LDggQEAgc3RhdGljIGludCBhbWRncHVfdHRtX3R0X3BvcHVsYXRl
KHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAo+ICAgCQlyZXR1cm4gMDsKPiAgIAl9Cj4gICAKPiAt
CWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKSB7Cj4gLQkJaWYgKCF0dG0t
PnNnKSB7Cj4gLQkJCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKPiAtCQkJc3Ry
dWN0IHNnX3RhYmxlICpzZ3Q7Cj4gLQo+IC0JCQlhdHRhY2ggPSBndHQtPmdvYmotPmltcG9ydF9h
dHRhY2g7Cj4gLQkJCXNndCA9IGRtYV9idWZfbWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBETUFfQklE
SVJFQ1RJT05BTCk7Cj4gLQkJCWlmIChJU19FUlIoc2d0KSkKPiAtCQkJCXJldHVybiBQVFJfRVJS
KHNndCk7Cj4gLQo+IC0JCQl0dG0tPnNnID0gc2d0Owo+IC0JCX0KPiAtCj4gLQkJZHJtX3ByaW1l
X3NnX3RvX2RtYV9hZGRyX2FycmF5KHR0bS0+c2csIGd0dC0+dHRtLmRtYV9hZGRyZXNzLAo+IC0J
CQkJCSAgICAgICB0dG0tPm51bV9wYWdlcyk7Cj4gKwlpZiAodHRtLT5wYWdlX2ZsYWdzICYgVFRN
X1BBR0VfRkxBR19TRykKPiAgIAkJcmV0dXJuIDA7Cj4gLQl9Cj4gICAKPiAgIAlyZXR1cm4gdHRt
X3Bvb2xfYWxsb2MoJmFkZXYtPm1tYW4uYmRldi5wb29sLCB0dG0sIGN0eCk7Cj4gICB9Cj4gQEAg
LTExNjUsMTUgKzExNzMsNiBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdHRtX3R0X3VucG9wdWxhdGUo
c3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCj4gICAJCXJldHVybjsKPiAgIAl9Cj4gICAKPiAtCWlm
ICh0dG0tPnNnICYmIGd0dC0+Z29iai0+aW1wb3J0X2F0dGFjaCkgewo+IC0JCXN0cnVjdCBkbWFf
YnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKPiAtCj4gLQkJYXR0YWNoID0gZ3R0LT5nb2JqLT5pbXBv
cnRfYXR0YWNoOwo+IC0JCWRtYV9idWZfdW5tYXBfYXR0YWNobWVudChhdHRhY2gsIHR0bS0+c2cs
IERNQV9CSURJUkVDVElPTkFMKTsKPiAtCQl0dG0tPnNnID0gTlVMTDsKPiAtCQlyZXR1cm47Cj4g
LQl9Cj4gLQo+ICAgCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKQo+ICAg
CQlyZXR1cm47Cj4gICAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbAo=
