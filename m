Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 32AC711461
	for <lists+dri-devel@lfdr.de>; Thu,  2 May 2019 09:43:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 241FE89294;
	Thu,  2 May 2019 07:42:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 95B5689295
 for <dri-devel@lists.freedesktop.org>; Wed,  1 May 2019 12:47:40 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: gportay) with ESMTPSA id D0591281890
Date: Wed, 1 May 2019 08:47:54 -0400
From: =?utf-8?B?R2HDq2w=?= PORTAY <gael.portay@collabora.com>
To: Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Heiko Stuebner <heiko@sntech.de>,
 Michael Turquette <mturquette@baylibre.com>,
 Stephen Boyd <sboyd@kernel.org>, MyungJoo Ham <myungjoo.ham@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Chanwoo Choi <cw00.choi@samsung.com>,
 Sandy Huang <hjc@rock-chips.com>, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel@ffwll.ch>, devicetree@vger.kernel.org,
 linux-arm-kernel@lists.infradead.org,
 linux-rockchip@lists.infradead.org, linux-kernel@vger.kernel.org,
 linux-clk@vger.kernel.org, linux-pm@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Subject: Re: [RFC 2/4] drm: rockchip: Add DDR devfreq support.
Message-ID: <20190501124754.h7kiksljhofldpz2@archlinux.localdomain>
References: <20190430180524.22710-1-gael.portay@collabora.com>
 <20190430180524.22710-3-gael.portay@collabora.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190430180524.22710-3-gael.portay@collabora.com>
User-Agent: NeoMutt/20180716
X-Mailman-Approved-At: Thu, 02 May 2019 07:42:58 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Lin Huang <hl@rock-chips.com>, Derek Basehore <dbasehore@chromium.org>,
 Douglas Anderson <dianders@chromium.org>, Matthias Kaehlcke <mka@chromium.org>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Enric Balletbo i Serra <enric.balletbo@collabora.com>, kernel@collabora.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBjb21taXQgYWRkcyB0aGUgc3VwcG9ydCBmb3IgZGV2ZnJlcSB0byBjb250cm9sIHRoZSBE
RFIgZnJlcXVlbmN5CmR5bmFtaWNhbGx5LgoKR2xpdGNoZXMgYWZmZWN0IHRoZSBkaXNwbGF5IHdo
ZW4gdGhlIERNQyBkZXZmcmVxIGRldmljZSBjaGFuZ2VzIHRoZSBERFIKZnJlcXVlbmN5IGR1cmlu
ZyB0aGUgc2Nhbm91dC4gVGhlIERSTSBkcml2ZXIgc3luY2hyb25pemVzIHRoZSByYXRlCmNoYW5n
ZSB3aXRoaW4gdGhlIFZCTEFOSy4KClRoZSBWT1AgbG9ja3MgdGhlIERNQyBkZXZmcmVxIGRldmlj
ZSB0aGF0IGNhdXNlcyBpdCB0byBub3RpZmllZCB3aGVuIGEKcmF0ZSBjaGFuZ2UgaXMgd2FudGVk
LiBUaGVuLCB0aGUgVk9QIGVuYWJsZXMgdGhlIFZCTEFOSyBpbnRlcnJ1cHQsCnJlbGVhc2VzIHRo
ZSBsb2NrIHdoZW4gdGhlIGludGVycnVwdCBhcmlzZXMgYW5kIGxvY2tzIHRoZSBkZXZmcmVxIGRl
dmljZQphZ2FpbiBhZnRlciB0aGUgdmJsYW5rIHB1bHNlIGVuZHMgdXNpbmcgYSB0aW1lci4KClRo
ZSBEUk0gZHJpdmVyIGRpc2FibGVzIHRoZSBkZXZmcmVxIGRldmljZSBpZiBtb3JlIHRoYW4gb25l
IENSVEMgYmVjb21lcwphY3RpdmUuCgpTaWduZWQtb2ZmLWJ5OiBHYcOrbCBQT1JUQVkgPGdhZWwu
cG9ydGF5QGNvbGxhYm9yYS5jb20+Ci0tLQoKQWxsLAoKSSBmb3Jnb3QgdG8gYXBwbHkgdGhlIGZp
eHVwIGNvbW1pdCAodGhhdCBmaXhlcyB0aGUgcmViYXNlIG9uIDUuMSkgd2hlbiBJCnNlbnQgdGhl
IHBhdGNoLgoKSGVyZSBpcyB3aGF0IHRoZSBjb21taXQgbG9va3MgbGlrZS4KClNvcnJ5IGZvciB0
aGUgbm9pc2UuCgpSZWdhcmRzLApHYcOrbAoKIGRyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2Nr
Y2hpcF9kcm1fZHJ2LmMgfCAgNTEgKysrKysrLQogZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3Jv
Y2tjaGlwX2RybV9kcnYuaCB8ICAgNiArCiBkcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2No
aXBfZHJtX2ZiLmMgIHwgMTQyICsrKysrKysrKysrKysrKysrKystCiBkcml2ZXJzL2dwdS9kcm0v
cm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmggIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vcm9j
a2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jIHwgIDgyICsrKysrKysrKysrCiA1IGZpbGVzIGNoYW5n
ZWQsIDI4MCBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0v
cm9ja2NoaXAvcm9ja2NoaXBfZHJtX2Rydi5jCmluZGV4IGQ3ZmExN2YxMjc2OS4uZWY4NDM1Njhh
N2Y4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2Ry
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fZHJ2LmMKQEAg
LTE5LDYgKzE5LDggQEAKICNpbmNsdWRlIDxkcm0vZHJtX2dlbV9jbWFfaGVscGVyLmg+CiAjaW5j
bHVkZSA8ZHJtL2RybV9vZi5oPgogI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+Cisj
aW5jbHVkZSA8bGludXgvZGV2ZnJlcS5oPgorI2luY2x1ZGUgPGxpbnV4L2RldmZyZXEtZXZlbnQu
aD4KICNpbmNsdWRlIDxsaW51eC9kbWEtbWFwcGluZy5oPgogI2luY2x1ZGUgPGxpbnV4L2RtYS1p
b21tdS5oPgogI2luY2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KQEAgLTc4LDYgKzgwLDQ2IEBA
IHZvaWQgcm9ja2NoaXBfZHJtX2RtYV9kZXRhY2hfZGV2aWNlKHN0cnVjdCBkcm1fZGV2aWNlICpk
cm1fZGV2LAogCWlvbW11X2RldGFjaF9kZXZpY2UoZG9tYWluLCBkZXYpOwogfQogCisjaWYgSVNf
RU5BQkxFRChDT05GSUdfQVJNX1JLMzM5OV9ETUNfREVWRlJFUSkKK3N0YXRpYyBpbnQgcm9ja2No
aXBfZHJtX2luaXRfZGV2ZnJlcShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJICAgICBzdHJ1Y3Qg
cm9ja2NoaXBfZHJtX3ByaXZhdGUgKnByaXYpCit7CisJc3RydWN0IGRldmZyZXEgKmRldmZyZXE7
CisJc3RydWN0IGRldmZyZXFfZXZlbnRfZGV2ICplZGV2OworCWludCByZXQ7CisKKwlkZXZmcmVx
ID0gZGV2ZnJlcV9nZXRfZGV2ZnJlcV9ieV9waGFuZGxlKGRldiwgMCk7CisJaWYgKElTX0VSUihk
ZXZmcmVxKSkgeworCQlyZXQgPSBQVFJfRVJSKGRldmZyZXEpOworCQlpZiAocmV0ID09IC1FTk9E
RVYpIHsKKwkJCURSTV9ERVZfSU5GTyhkZXYsICJkZXZmcmVxIG1pc3NpbmcsIHNraXBcbiIpOwor
CQkJcmV0dXJuIDA7CisJCX0KKwkJcmV0dXJuIHJldDsKKwl9CisKKwllZGV2ID0gZGV2ZnJlcV9l
dmVudF9nZXRfZWRldl9ieV9waGFuZGxlKGRldmZyZXEtPmRldi5wYXJlbnQsIDApOworCWlmIChJ
U19FUlIoZWRldikpIHsKKwkJcmV0ID0gUFRSX0VSUihlZGV2KTsKKwkJaWYgKHJldCA9PSAtRU5P
REVWKSB7CisJCQlEUk1fREVWX0lORk8oZGV2LCAiZGV2ZnJlcSBlZGV2IG1pc3NpbmcsIHNraXBc
biIpOworCQkJcmV0dXJuIDA7CisJCX0KKwkJcmV0dXJuIHJldDsKKwl9CisKKwlwcml2LT5kZXZm
cmVxID0gZGV2ZnJlcTsKKwlwcml2LT5kZXZmcmVxX2V2ZW50X2RldiA9IGVkZXY7CisJcmV0dXJu
IDA7Cit9CisjZWxzZQorc3RhdGljIGludCByb2NrY2hpcF9kcm1faW5pdF9kZXZmcmVxKHN0cnVj
dCBkZXZpY2UgKmRldiwKKwkJCQkgICAgIHN0cnVjdCByb2NrY2hpcF9kcm1fcHJpdmF0ZSAqcHJp
dikKK3sKKwlyZXR1cm4gMDsKK30KKyNlbmRpZgorCiBzdGF0aWMgaW50IHJvY2tjaGlwX2RybV9p
bml0X2lvbW11KHN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2KQogewogCXN0cnVjdCByb2NrY2hp
cF9kcm1fcHJpdmF0ZSAqcHJpdmF0ZSA9IGRybV9kZXYtPmRldl9wcml2YXRlOwpAQCAtMTM3LDEz
ICsxNzksMTkgQEAgc3RhdGljIGludCByb2NrY2hpcF9kcm1fYmluZChzdHJ1Y3QgZGV2aWNlICpk
ZXYpCiAJSU5JVF9MSVNUX0hFQUQoJnByaXZhdGUtPnBzcl9saXN0KTsKIAltdXRleF9pbml0KCZw
cml2YXRlLT5wc3JfbGlzdF9sb2NrKTsKIAorCXJldCA9IHJvY2tjaGlwX2RybV9pbml0X2RldmZy
ZXEoZGV2LCBwcml2YXRlKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9mcmVlOworCiAJcmV0ID0g
cm9ja2NoaXBfZHJtX2luaXRfaW9tbXUoZHJtX2Rldik7CiAJaWYgKHJldCkKIAkJZ290byBlcnJf
ZnJlZTsKIAogCWRybV9tb2RlX2NvbmZpZ19pbml0KGRybV9kZXYpOwogCi0Jcm9ja2NoaXBfZHJt
X21vZGVfY29uZmlnX2luaXQoZHJtX2Rldik7CisJcmV0ID0gcm9ja2NoaXBfZHJtX21vZGVfY29u
ZmlnX2luaXQoZHJtX2Rldik7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZnJlZTsKIAogCS8qIFRy
eSB0byBiaW5kIGFsbCBzdWIgZHJpdmVycy4gKi8KIAlyZXQgPSBjb21wb25lbnRfYmluZF9hbGwo
ZGV2LCBkcm1fZGV2KTsKQEAgLTIwMSw2ICsyNDksNyBAQCBzdGF0aWMgdm9pZCByb2NrY2hpcF9k
cm1fdW5iaW5kKHN0cnVjdCBkZXZpY2UgKmRldikKIAlkcm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93
bihkcm1fZGV2KTsKIAljb21wb25lbnRfdW5iaW5kX2FsbChkZXYsIGRybV9kZXYpOwogCWRybV9t
b2RlX2NvbmZpZ19jbGVhbnVwKGRybV9kZXYpOworCXJvY2tjaGlwX2RybV9tb2RlX2NvbmZpZ19m
aW5pKGRybV9kZXYpOwogCXJvY2tjaGlwX2lvbW11X2NsZWFudXAoZHJtX2Rldik7CiAKIAlkcm1f
ZGV2LT5kZXZfcHJpdmF0ZSA9IE5VTEw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcm9j
a2NoaXAvcm9ja2NoaXBfZHJtX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tj
aGlwX2RybV9kcnYuaAppbmRleCBjZTQ4NTY4ZWM4YTAuLjBhYzdlMzFiNTYwNSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9kcnYuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2Rydi5oCkBAIC0xOCw2ICsxOCw3IEBA
CiAjZGVmaW5lIF9ST0NLQ0hJUF9EUk1fRFJWX0gKIAogI2luY2x1ZGUgPGRybS9kcm1fZmJfaGVs
cGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0
b21pY19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgogCkBAIC01Nyw2ICs1OCwx
MCBAQCBzdHJ1Y3Qgcm9ja2NoaXBfZHJtX3ByaXZhdGUgewogCXN0cnVjdCBkcm1fbW0gbW07CiAJ
c3RydWN0IGxpc3RfaGVhZCBwc3JfbGlzdDsKIAlzdHJ1Y3QgbXV0ZXggcHNyX2xpc3RfbG9jazsK
KworCXN0cnVjdCBkZXZmcmVxICpkZXZmcmVxOworCXN0cnVjdCBkZXZmcmVxX2V2ZW50X2RldiAq
ZGV2ZnJlcV9ldmVudF9kZXY7CisJc3RydWN0IGRybV9wcml2YXRlX29iaiBkZHJmcmVxX2xvY2tf
bWFuYWdlcjsKIH07CiAKIGludCByb2NrY2hpcF9kcm1fZG1hX2F0dGFjaF9kZXZpY2Uoc3RydWN0
IGRybV9kZXZpY2UgKmRybV9kZXYsCkBAIC02Niw2ICs3MSw3IEBAIHZvaWQgcm9ja2NoaXBfZHJt
X2RtYV9kZXRhY2hfZGV2aWNlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2LAogaW50IHJvY2tj
aGlwX2RybV93YWl0X3ZhY3RfZW5kKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgdW5zaWduZWQgaW50
IG1zdGltZW91dCk7CiAKIGludCByb2NrY2hpcF9kcm1fZW5kcG9pbnRfaXNfc3ViZHJpdmVyKHN0
cnVjdCBkZXZpY2Vfbm9kZSAqZXApOwordWludDMyX3Qgcm9ja2NoaXBfZHJtX2dldF92Ymxhbmtf
bnMoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpOwogZXh0ZXJuIHN0cnVjdCBwbGF0Zm9y
bV9kcml2ZXIgY2RuX2RwX2RyaXZlcjsKIGV4dGVybiBzdHJ1Y3QgcGxhdGZvcm1fZHJpdmVyIGR3
X2hkbWlfcm9ja2NoaXBfcGx0Zm1fZHJpdmVyOwogZXh0ZXJuIHN0cnVjdCBwbGF0Zm9ybV9kcml2
ZXIgZHdfbWlwaV9kc2lfcm9ja2NoaXBfZHJpdmVyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlw
L3JvY2tjaGlwX2RybV9mYi5jCmluZGV4IDk3NDM4YmJiZTM4OS4uZjUwOGQ1NTU4ZTE2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jCkBAIC0xMyw2ICsxMyw3
IEBACiAgKi8KIAogI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L2Rl
dmZyZXEuaD4KICNpbmNsdWRlIDxkcm0vZHJtLmg+CiAjaW5jbHVkZSA8ZHJtL2RybVAuaD4KICNp
bmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgpAQCAtMjUsNiArMjYsNTYgQEAKICNpbmNsdWRlICJy
b2NrY2hpcF9kcm1fZ2VtLmgiCiAjaW5jbHVkZSAicm9ja2NoaXBfZHJtX3Bzci5oIgogCitzdHJ1
Y3Qgcm9ja2NoaXBfZGRyZnJlcV9sb2NrX3N0YXRlIHsKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfc3Rh
dGUgYmFzZTsKKwlpbnQgbG9ja19jb3VudGVyOworfTsKKworI2RlZmluZSB0b19kZHJmcmVxX2xv
Y2tfc3RhdGUoeCkgY29udGFpbmVyX29mKHgsIFwKKwkJCQkgICAgICAgc3RydWN0IHJvY2tjaGlw
X2RkcmZyZXFfbG9ja19zdGF0ZSwgYmFzZSkKKworc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpy
b2NrY2hpcF9hdG9taWNfZHVwbGljYXRlX2RkcmZyZXFfbG9ja19zdGF0ZSgKKwkJCQkJCSAgICBz
dHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpvYmopCit7CisJc3RydWN0IHJvY2tjaGlwX2RkcmZyZXFf
bG9ja19zdGF0ZSAqZGRyZnJlcV9sb2NrX3N0YXRlOworCisJZGRyZnJlcV9sb2NrX3N0YXRlID0g
a21lbWR1cChvYmotPnN0YXRlLCBzaXplb2YoKmRkcmZyZXFfbG9ja19zdGF0ZSksCisJCQkJICAg
ICBHRlBfS0VSTkVMKTsKKwlpZiAoIWRkcmZyZXFfbG9ja19zdGF0ZSkKKwkJcmV0dXJuIE5VTEw7
CisKKwlfX2RybV9hdG9taWNfaGVscGVyX3ByaXZhdGVfb2JqX2R1cGxpY2F0ZV9zdGF0ZShvYmos
CisJCQkJCQkgICAgICZkZHJmcmVxX2xvY2tfc3RhdGUtPmJhc2UpOworCisJcmV0dXJuICZkZHJm
cmVxX2xvY2tfc3RhdGUtPmJhc2U7Cit9CisKK3ZvaWQgcm9ja2NoaXBfYXRvbWljX2Rlc3Ryb3lf
ZGRyZnJlcV9sb2NrX3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogKm9iaiwKKwkJCQkJCXN0
cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IHJvY2tjaGlwX2RkcmZy
ZXFfbG9ja19zdGF0ZSAqZGRyZnJlcV9sb2NrX3N0YXRlID0KKwkJCQkJCSAgIHRvX2RkcmZyZXFf
bG9ja19zdGF0ZShzdGF0ZSk7CisKKwlrZnJlZShkZHJmcmVxX2xvY2tfc3RhdGUpOworfQorCitz
dHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGVfZnVuY3Mgcm9ja2NoaXBfZGRyZnJlcV9sb2NrX3N0YXRl
X2Z1bmNzID0geworCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gcm9ja2NoaXBfYXRvbWljX2R1
cGxpY2F0ZV9kZHJmcmVxX2xvY2tfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gcm9j
a2NoaXBfYXRvbWljX2Rlc3Ryb3lfZGRyZnJlcV9sb2NrX3N0YXRlLAorfTsKKworc3RhdGljIHN0
cnVjdCByb2NrY2hpcF9kZHJmcmVxX2xvY2tfc3RhdGUgKnJvY2tjaGlwX2dldF9kZHJmcmVxX2xv
Y2tfc3RhdGUoCisJCSAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsIHN0cnVjdCBk
cm1fcHJpdmF0ZV9vYmogKm9iaikKK3sKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKnByaXZf
c3RhdGU7CisKKwlwcml2X3N0YXRlID0gZHJtX2F0b21pY19nZXRfcHJpdmF0ZV9vYmpfc3RhdGUo
c3RhdGUsIG9iaik7CisJaWYgKElTX0VSUihwcml2X3N0YXRlKSkKKwkJcmV0dXJuIEVSUl9DQVNU
KHByaXZfc3RhdGUpOworCisJcmV0dXJuIHRvX2RkcmZyZXFfbG9ja19zdGF0ZShwcml2X3N0YXRl
KTsKK30KKwogc3RhdGljIGludCByb2NrY2hpcF9kcm1fZmJfZGlydHkoc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIsCiAJCQkJIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJCQkgdW5zaWduZWQg
aW50IGZsYWdzLCB1bnNpZ25lZCBpbnQgY29sb3IsCkBAIC0xMjcsMTAgKzE3OCw0NCBAQCByb2Nr
Y2hpcF91c2VyX2ZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdiwKIAlyZXR1cm4gRVJSX1BUUihyZXQpOwogfQogCit1aW50MzJfdCByb2Nr
Y2hpcF9kcm1fZ2V0X3ZibGFua19ucyhzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKK3sK
Kwl1aW50NjRfdCB2YmxhbmtfdGltZSA9IG1vZGUtPnZ0b3RhbCAtIG1vZGUtPnZkaXNwbGF5Owor
CisJdmJsYW5rX3RpbWUgKj0gKHVpbnQ2NF90KU5TRUNfUEVSX1NFQyAqIG1vZGUtPmh0b3RhbDsK
Kwlkb19kaXYodmJsYW5rX3RpbWUsIG1vZGUtPmNsb2NrICogMTAwMCk7CisKKwlyZXR1cm4gdmJs
YW5rX3RpbWU7Cit9CisKIHN0YXRpYyB2b2lkCiByb2NrY2hpcF9hdG9taWNfaGVscGVyX2NvbW1p
dF90YWlsX3JwbShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSBvbGRfc3RhdGUtPmRldjsKKwlzdHJ1Y3Qgcm9ja2NoaXBfZHJt
X3ByaXZhdGUgKnByaXYgPSBkZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3Qgcm9ja2NoaXBfZGRy
ZnJlcV9sb2NrX3N0YXRlICpkZHJmcmVxX2xvY2tfc3RhdGU7CisJc3RydWN0IGRybV9jcnRjICpj
cnRjOworCWludCBpOworCisJZm9yX2VhY2hfb2xkbmV3X2NydGNfaW5fc3RhdGUob2xkX3N0YXRl
LCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKKwkJCQkgICAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgewor
CQlpZiAob2xkX2NydGNfc3RhdGUtPmVuYWJsZSA9PSBuZXdfY3J0Y19zdGF0ZS0+ZW5hYmxlKQor
CQkJY29udGludWU7CisKKwkJZGRyZnJlcV9sb2NrX3N0YXRlID0gcm9ja2NoaXBfZ2V0X2RkcmZy
ZXFfbG9ja19zdGF0ZShvbGRfc3RhdGUsCisJCQkJCQkgICAmcHJpdi0+ZGRyZnJlcV9sb2NrX21h
bmFnZXIpOworCQlpZiAoSVNfRVJSKGRkcmZyZXFfbG9ja19zdGF0ZSkpCisJCQlicmVhazsKKwor
CQkvKiBUT0RPIFRoaXMgbG9naWMgYmFzZWQgb24gdGhlIHByZXZpb3VzIHN0YXRlIGxvb2tzIHdl
aXJkIDovICovCisJCWlmIChvbGRfY3J0Y19zdGF0ZS0+ZW5hYmxlICYmCisJCSAgICBkZHJmcmVx
X2xvY2tfc3RhdGUtPmxvY2tfY291bnRlciA9PSAyKQorCQkJZGV2ZnJlcV9yZXN1bWVfZGV2aWNl
KHByaXYtPmRldmZyZXEpOworCQllbHNlIGlmICghb2xkX2NydGNfc3RhdGUtPmVuYWJsZSAmJgor
CQkJIGRkcmZyZXFfbG9ja19zdGF0ZS0+bG9ja19jb3VudGVyID09IDEpCisJCQlkZXZmcmVxX3N1
c3BlbmRfZGV2aWNlKHByaXYtPmRldmZyZXEpOworCX0KIAogCXJvY2tjaGlwX2RybV9wc3JfaW5o
aWJpdF9nZXRfc3RhdGUob2xkX3N0YXRlKTsKIApAQCAtMTU0LDEwICsyMzksNDEgQEAgc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfaGVscGVyX2Z1bmNzIHJvY2tjaGlwX21vZGVf
Y29uZmlnX2hlbHBlcnMgPQogCS5hdG9taWNfY29tbWl0X3RhaWwgPSByb2NrY2hpcF9hdG9taWNf
aGVscGVyX2NvbW1pdF90YWlsX3JwbSwKIH07CiAKK3N0YXRpYyBpbnQgcm9ja2NoaXBfZHJtX2F0
b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkJCSAgICAgc3RydWN0IGRybV9h
dG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCByb2NrY2hpcF9kcm1fcHJpdmF0ZSAqcHJp
diA9IGRldi0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IHJvY2tjaGlwX2RkcmZyZXFfbG9ja19zdGF0
ZSAqZGRyZnJlcV9sb2NrX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZTsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CisJaW50IHJldDsKKwlpbnQgaTsKKworCXJldCA9
IGRybV9hdG9taWNfaGVscGVyX2NoZWNrKGRldiwgc3RhdGUpOworCWlmIChyZXQgPT0gMCkgewor
CQlmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkg
eworCQkJaWYgKCFjcnRjX3N0YXRlLT5hY3RpdmVfY2hhbmdlZCkKKwkJCQljb250aW51ZTsKKwor
CQkJZGRyZnJlcV9sb2NrX3N0YXRlID0gcm9ja2NoaXBfZ2V0X2RkcmZyZXFfbG9ja19zdGF0ZSgK
KwkJCQkJICAgIHN0YXRlLCAmcHJpdi0+ZGRyZnJlcV9sb2NrX21hbmFnZXIpOworCQkJaWYgKElT
X0VSUihkZHJmcmVxX2xvY2tfc3RhdGUpKQorCQkJCXJldHVybiBQVFJfRVJSKGRkcmZyZXFfbG9j
a19zdGF0ZSk7CisKKwkJCWlmIChjcnRjX3N0YXRlLT5lbmFibGUpCisJCQkJZGRyZnJlcV9sb2Nr
X3N0YXRlLT5sb2NrX2NvdW50ZXIrKzsKKwkJCWVsc2UKKwkJCQlkZHJmcmVxX2xvY2tfc3RhdGUt
PmxvY2tfY291bnRlci0tOworCQl9CisJfQorCisJcmV0dXJuIHJldDsKK30KKwogc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfZnVuY3Mgcm9ja2NoaXBfZHJtX21vZGVfY29uZmln
X2Z1bmNzID0gewogCS5mYl9jcmVhdGUgPSByb2NrY2hpcF91c2VyX2ZiX2NyZWF0ZSwKIAkub3V0
cHV0X3BvbGxfY2hhbmdlZCA9IGRybV9mYl9oZWxwZXJfb3V0cHV0X3BvbGxfY2hhbmdlZCwKLQku
YXRvbWljX2NoZWNrID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2ssCisJLmF0b21pY19jaGVjayA9
IHJvY2tjaGlwX2RybV9hdG9taWNfY2hlY2ssCiAJLmF0b21pY19jb21taXQgPSBkcm1fYXRvbWlj
X2hlbHBlcl9jb21taXQsCiB9OwogCkBAIC0xNzUsOCArMjkxLDExIEBAIHJvY2tjaGlwX2RybV9m
cmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0dXJuIGZiOwogfQog
Ci12b2lkIHJvY2tjaGlwX2RybV9tb2RlX2NvbmZpZ19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCitpbnQgcm9ja2NoaXBfZHJtX21vZGVfY29uZmlnX2luaXQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKIHsKKwlzdHJ1Y3Qgcm9ja2NoaXBfZHJtX3ByaXZhdGUgKnByaXYgPSBkZXYtPmRldl9w
cml2YXRlOworCXN0cnVjdCByb2NrY2hpcF9kZHJmcmVxX2xvY2tfc3RhdGUgKmRkcmZyZXFfbG9j
a19zdGF0ZTsKKwogCWRldi0+bW9kZV9jb25maWcubWluX3dpZHRoID0gMDsKIAlkZXYtPm1vZGVf
Y29uZmlnLm1pbl9oZWlnaHQgPSAwOwogCkBAIC0xOTAsNCArMzA5LDIzIEBAIHZvaWQgcm9ja2No
aXBfZHJtX21vZGVfY29uZmlnX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAogCWRldi0+
bW9kZV9jb25maWcuZnVuY3MgPSAmcm9ja2NoaXBfZHJtX21vZGVfY29uZmlnX2Z1bmNzOwogCWRl
di0+bW9kZV9jb25maWcuaGVscGVyX3ByaXZhdGUgPSAmcm9ja2NoaXBfbW9kZV9jb25maWdfaGVs
cGVyczsKKworCWRkcmZyZXFfbG9ja19zdGF0ZSA9IGt6YWxsb2Moc2l6ZW9mKCpkZHJmcmVxX2xv
Y2tfc3RhdGUpLAorCQkJCSAgICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZHJmcmVxX2xvY2tfc3Rh
dGUpCisJCXJldHVybiAtRU5PTUVNOworCisJZHJtX2F0b21pY19wcml2YXRlX29ial9pbml0KGRl
diwKKwkJCQkgICAgJnByaXYtPmRkcmZyZXFfbG9ja19tYW5hZ2VyLAorCQkJCSAgICAmZGRyZnJl
cV9sb2NrX3N0YXRlLT5iYXNlLAorCQkJCSAgICAmcm9ja2NoaXBfZGRyZnJlcV9sb2NrX3N0YXRl
X2Z1bmNzKTsKKworCXJldHVybiAwOworfQorCit2b2lkIHJvY2tjaGlwX2RybV9tb2RlX2NvbmZp
Z19maW5pKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCit7CisJc3RydWN0IHJvY2tjaGlwX2RybV9w
cml2YXRlICpwcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKworCWRybV9hdG9taWNfcHJpdmF0ZV9v
YmpfZmluaSgmcHJpdi0+ZGRyZnJlcV9sb2NrX21hbmFnZXIpOwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5oIGIvZHJpdmVycy9ncHUvZHJt
L3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5oCmluZGV4IGYxMjY1Y2IxYWVlOC4uYTgxZGY0ZWY4
YjM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2Zi
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5oCkBAIC0y
MSw1ICsyMSw2IEBAIHJvY2tjaGlwX2RybV9mcmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsCiAJCQkgICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiB2b2lkIHJv
Y2tjaGlwX2RybV9mcmFtZWJ1ZmZlcl9maW5pKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKTsK
IAotdm9pZCByb2NrY2hpcF9kcm1fbW9kZV9jb25maWdfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2KTsKK2ludCByb2NrY2hpcF9kcm1fbW9kZV9jb25maWdfaW5pdChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2KTsKK3ZvaWQgcm9ja2NoaXBfZHJtX21vZGVfY29uZmlnX2Zpbmkoc3RydWN0IGRybV9k
ZXZpY2UgKmRldik7CiAjZW5kaWYgLyogX1JPQ0tDSElQX0RSTV9GQl9IICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jIGIvZHJpdmVycy9n
cHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYwppbmRleCAwZDRhZGU5ZDQ3MjIuLmU3
NmE2OGFlMzk5MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlw
X2RybV92b3AuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3Zv
cC5jCkBAIC0zNiw2ICszNiw4IEBACiAjaW5jbHVkZSA8bGludXgvY29tcG9uZW50Lmg+CiAjaW5j
bHVkZSA8bGludXgvb3ZlcmZsb3cuaD4KIAorI2luY2x1ZGUgPGxpbnV4L2RldmZyZXEuaD4KKwog
I2luY2x1ZGUgPGxpbnV4L3Jlc2V0Lmg+CiAjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KIApAQCAt
MTQxLDYgKzE0MywxMiBAQCBzdHJ1Y3Qgdm9wIHsKIAogCXN0cnVjdCBjb21wbGV0aW9uIGxpbmVf
ZmxhZ19jb21wbGV0aW9uOwogCisJLyogZGV2ZnJlcSBsb2NraW5nICovCisJc3BpbmxvY2tfdCBk
ZXZmcmVxX2xvY2s7CisJYm9vbCB3YW50X3RvX2NoYW5nZV9yYXRlOworCXN0cnVjdCBkZXZmcmVx
X2Rldl91c2VybG9jayBkZXZmcmVxX3VzZXJsb2NrOworCXN0cnVjdCBocnRpbWVyIHZibGFua190
aW1lcjsKKwogCWNvbnN0IHN0cnVjdCB2b3BfZGF0YSAqZGF0YTsKIAogCXVpbnQzMl90ICpyZWdz
YmFrOwpAQCAtNjMyLDkgKzY0MCwxMiBAQCBzdGF0aWMgdm9pZCB2b3BfY3J0Y19hdG9taWNfZGlz
YWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkJICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCB2b3AgKnZvcCA9IHRvX3ZvcChjcnRjKTsKKwlzdHJ1
Y3Qgcm9ja2NoaXBfZHJtX3ByaXZhdGUgKnByaXYgPSB2b3AtPmNydGMuZGV2LT5kZXZfcHJpdmF0
ZTsKIAogCVdBUk5fT04odm9wLT5ldmVudCk7CiAKKwlkZXZmcmVxX3VubG9ja19kZXZpY2UocHJp
di0+ZGV2ZnJlcSwgJnZvcC0+ZGV2ZnJlcV91c2VybG9jaywgMCk7CisKIAltdXRleF9sb2NrKCZ2
b3AtPnZvcF9sb2NrKTsKIAlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMpOwogCkBAIC0xMDI4LDYg
KzEwMzksNyBAQCBzdGF0aWMgdm9pZCB2b3BfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywKIHsKIAlzdHJ1Y3Qgdm9wICp2b3AgPSB0b192b3AoY3J0Yyk7CiAJY29uc3Qg
c3RydWN0IHZvcF9kYXRhICp2b3BfZGF0YSA9IHZvcC0+ZGF0YTsKKwlzdHJ1Y3Qgcm9ja2NoaXBf
ZHJtX3ByaXZhdGUgKnByaXYgPSB2b3AtPmNydGMuZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3Qg
cm9ja2NoaXBfY3J0Y19zdGF0ZSAqcyA9IHRvX3JvY2tjaGlwX2NydGNfc3RhdGUoY3J0Yy0+c3Rh
dGUpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGMtPnN0
YXRlLT5hZGp1c3RlZF9tb2RlOwogCXUxNiBoc3luY19sZW4gPSBhZGp1c3RlZF9tb2RlLT5oc3lu
Y19lbmQgLSBhZGp1c3RlZF9tb2RlLT5oc3luY19zdGFydDsKQEAgLTExMjMsNiArMTEzNSwxMSBA
QCBzdGF0aWMgdm9pZCB2b3BfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0
YywKIAogCVZPUF9SRUdfU0VUKHZvcCwgY29tbW9uLCBzdGFuZGJ5LCAwKTsKIAltdXRleF91bmxv
Y2soJnZvcC0+dm9wX2xvY2spOworCisJcmV0ID0gZGV2ZnJlcV9sb2NrX2RldmljZShwcml2LT5k
ZXZmcmVxLCAmdm9wLT5kZXZmcmVxX3VzZXJsb2NrKTsKKwlpZiAocmV0KQorCQlEUk1fREVWX0VS
Uk9SKHZvcC0+ZGV2LAorCQkJICAgICAgImNhbm5vdCBsb2NrIGRldmZyZXEgLSBlcnIgJWRcbiIs
IHJldCk7CiB9CiAKIHN0YXRpYyBib29sIHZvcF9mc19pcnFfaXNfcGVuZGluZyhzdHJ1Y3Qgdm9w
ICp2b3ApCkBAIC0xMzQ5LDEwICsxMzY2LDQ0IEBAIHN0YXRpYyB2b2lkIHZvcF9oYW5kbGVfdmJs
YW5rKHN0cnVjdCB2b3AgKnZvcCkKIAkJZHJtX2ZsaXBfd29ya19jb21taXQoJnZvcC0+ZmJfdW5y
ZWZfd29yaywgc3lzdGVtX3VuYm91bmRfd3EpOwogfQogCitzdGF0aWMgZW51bSBocnRpbWVyX3Jl
c3RhcnQgdmJsYW5rX3RpbWVyX2Z1bmN0aW9uKHN0cnVjdCBocnRpbWVyICp0aW1lcikKK3sKKwlz
dHJ1Y3Qgdm9wICp2b3AgPSBjb250YWluZXJfb2YodGltZXIsIHN0cnVjdCB2b3AsIHZibGFua190
aW1lcik7CisJc3RydWN0IHJvY2tjaGlwX2RybV9wcml2YXRlICpwcml2ID0gdm9wLT5jcnRjLmRl
di0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGRldmZyZXEgKmRldmZyZXEgPSBwcml2LT5kZXZmcmVx
OworCisJZHJtX2NydGNfdmJsYW5rX3B1dCgmdm9wLT5jcnRjKTsKKworCWRldmZyZXFfbG9ja19k
ZXZpY2UoZGV2ZnJlcSwgJnZvcC0+ZGV2ZnJlcV91c2VybG9jayk7CisKKwlzcGluX2xvY2soJnZv
cC0+ZGV2ZnJlcV9sb2NrKTsKKwl2b3AtPndhbnRfdG9fY2hhbmdlX3JhdGUgPSBmYWxzZTsKKwlz
cGluX3VubG9jaygmdm9wLT5kZXZmcmVxX2xvY2spOworCisJcmV0dXJuIEhSVElNRVJfTk9SRVNU
QVJUOworfQorCitzdGF0aWMgdm9pZCB3YW50X3RvX2NoYW5nZV9yYXRlKHN0cnVjdCBkZXZmcmVx
X2Rldl91c2VybG9jayAqdXNlcmxvY2ssCisJCQkJc3RydWN0IGRldmZyZXEgKmRldmZyZXEpCit7
CisJc3RydWN0IHZvcCAqdm9wID0gY29udGFpbmVyX29mKHVzZXJsb2NrLCBzdHJ1Y3Qgdm9wLCBk
ZXZmcmVxX3VzZXJsb2NrKTsKKwlpbnQgZXJyOworCisJc3Bpbl9sb2NrKCZ2b3AtPmRldmZyZXFf
bG9jayk7CisJdm9wLT53YW50X3RvX2NoYW5nZV9yYXRlID0gdHJ1ZTsKKwlzcGluX3VubG9jaygm
dm9wLT5kZXZmcmVxX2xvY2spOworCisJZXJyID0gZHJtX2NydGNfdmJsYW5rX2dldCgmdm9wLT5j
cnRjKTsKKwlpZiAoZXJyKQorCQlEUk1fREVWX0VSUk9SKHZvcC0+ZGV2LCAiY291bGRuJ3QgZ2V0
IHZibGFuayAlZFxuIiwgZXJyKTsKK30KKwogc3RhdGljIGlycXJldHVybl90IHZvcF9pc3IoaW50
IGlycSwgdm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3Qgdm9wICp2b3AgPSBkYXRhOwogCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YyA9ICZ2b3AtPmNydGM7CisJc3RydWN0IHJvY2tjaGlwX2RybV9wcml2YXRl
ICpwcml2ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsKKwlrdGltZV90IHZibGFua190aW1lb3V0
OwogCXVpbnQzMl90IGFjdGl2ZV9pcnFzOwogCWludCByZXQgPSBJUlFfTk9ORTsKIApAQCAtMTM5
OCw2ICsxNDQ5LDE5IEBAIHN0YXRpYyBpcnFyZXR1cm5fdCB2b3BfaXNyKGludCBpcnEsIHZvaWQg
KmRhdGEpCiAJfQogCiAJaWYgKGFjdGl2ZV9pcnFzICYgRlNfSU5UUikgeworCQlzcGluX2xvY2so
JnZvcC0+ZGV2ZnJlcV9sb2NrKTsKKwkJaWYgKHZvcC0+d2FudF90b19jaGFuZ2VfcmF0ZSkgewor
CQkJdm9wLT53YW50X3RvX2NoYW5nZV9yYXRlID0gZmFsc2U7CisJCQl2YmxhbmtfdGltZW91dCA9
IGt0aW1lX2FkZF9ucyhrdGltZV9nZXQoKSwKKwkJCQkgICAgICAgcm9ja2NoaXBfZHJtX2dldF92
YmxhbmtfbnMoJmNydGMtPm1vZGUpKTsKKwkJCWhydGltZXJfc3RhcnQoJnZvcC0+dmJsYW5rX3Rp
bWVyLCB2YmxhbmtfdGltZW91dCwKKwkJCQkgICAgICBIUlRJTUVSX01PREVfQUJTKTsKKwkJCWRl
dmZyZXFfdW5sb2NrX2RldmljZShwcml2LT5kZXZmcmVxLAorCQkJCQkgICAgICAmdm9wLT5kZXZm
cmVxX3VzZXJsb2NrLAorCQkJCQkgICAgICB2YmxhbmtfdGltZW91dCk7CisJCX0KKwkJc3Bpbl91
bmxvY2soJnZvcC0+ZGV2ZnJlcV9sb2NrKTsKKwogCQlkcm1fY3J0Y19oYW5kbGVfdmJsYW5rKGNy
dGMpOwogCQl2b3BfaGFuZGxlX3ZibGFuayh2b3ApOwogCQlhY3RpdmVfaXJxcyAmPSB+RlNfSU5U
UjsKQEAgLTE3NDYsNiArMTgxMCw3IEBAIHN0YXRpYyBpbnQgdm9wX2JpbmQoc3RydWN0IGRldmlj
ZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldiA9IHRvX3BsYXRmb3JtX2RldmljZShkZXYpOwogCWNvbnN0IHN0
cnVjdCB2b3BfZGF0YSAqdm9wX2RhdGE7CisJc3RydWN0IHJvY2tjaGlwX2RybV9wcml2YXRlICpw
cml2OwogCXN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2ID0gZGF0YTsKIAlzdHJ1Y3Qgdm9wICp2
b3A7CiAJc3RydWN0IHJlc291cmNlICpyZXM7CkBAIC0xODE1LDYgKzE4ODAsMjAgQEAgc3RhdGlj
IGludCB2b3BfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2UgKm1hc3Rlciwg
dm9pZCAqZGF0YSkKIAkJfQogCX0KIAorCWhydGltZXJfaW5pdCgmdm9wLT52YmxhbmtfdGltZXIs
IENMT0NLX01PTk9UT05JQywgSFJUSU1FUl9NT0RFX0FCUyk7CisJdm9wLT52YmxhbmtfdGltZXIu
ZnVuY3Rpb24gPSB2YmxhbmtfdGltZXJfZnVuY3Rpb247CisKKwlJTklUX0xJU1RfSEVBRCgmdm9w
LT5kZXZmcmVxX3VzZXJsb2NrLm5vZGUpOworCXZvcC0+ZGV2ZnJlcV91c2VybG9jay53YW50X3Rv
X2NoYW5nZV9yYXRlID0gd2FudF90b19jaGFuZ2VfcmF0ZTsKKworCXByaXYgPSB2b3AtPmNydGMu
ZGV2LT5kZXZfcHJpdmF0ZTsKKwlyZXQgPSBkZXZmcmVxX3JlZ2lzdGVyX2Rldl91c2VyX2xvY2so
JnZvcC0+ZGV2ZnJlcV91c2VybG9jaywKKwkJCQkJICAgICBwcml2LT5kZXZmcmVxKTsKKwlpZiAo
cmV0KQorCQlEUk1fREVWX0VSUk9SKCZwZGV2LT5kZXYsCisJCQkgICAgICAiY2Fubm90IHJlZ2lz
dGVyIHRvIGRldmZyZXEgdXNlciBsb2NrIC0gZXJyICVkXG4iLAorCQkJICAgICAgcmV0KTsKKwog
CXJldHVybiAwOwogCiBlcnJfZGlzYWJsZV9wbV9ydW50aW1lOgpAQCAtMTgyNiw2ICsxOTA1LDkg
QEAgc3RhdGljIGludCB2b3BfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2Ug
Km1hc3Rlciwgdm9pZCAqZGF0YSkKIHN0YXRpYyB2b2lkIHZvcF91bmJpbmQoc3RydWN0IGRldmlj
ZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IHZv
cCAqdm9wID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJc3RydWN0IHJvY2tjaGlwX2RybV9wcml2
YXRlICpwcml2ID0gdm9wLT5jcnRjLmRldi0+ZGV2X3ByaXZhdGU7CisKKwlkZXZmcmVxX3VucmVn
aXN0ZXJfZGV2X3VzZXJfbG9jaygmdm9wLT5kZXZmcmVxX3VzZXJsb2NrLCBwcml2LT5kZXZmcmVx
KTsKIAogCWlmICh2b3AtPnJnYikKIAkJcm9ja2NoaXBfcmdiX2Zpbmkodm9wLT5yZ2IpOwotLSAK
Mi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpk
cmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
