Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A423A1629
	for <lists+dri-devel@lfdr.de>; Thu, 29 Aug 2019 12:34:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C3F186E0C0;
	Thu, 29 Aug 2019 10:33:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 068D96E09E
 for <dri-devel@lists.freedesktop.org>; Thu, 29 Aug 2019 10:33:10 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 9038DC057F2C;
 Thu, 29 Aug 2019 10:33:10 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-95.ams2.redhat.com
 [10.36.116.95])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 7FCB860610;
 Thu, 29 Aug 2019 10:33:08 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 64B5031F23; Thu, 29 Aug 2019 12:33:04 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v9 14/18] drm/virtio: switch from ttm to gem shmem helpers
Date: Thu, 29 Aug 2019 12:32:57 +0200
Message-Id: <20190829103301.3539-15-kraxel@redhat.com>
In-Reply-To: <20190829103301.3539-1-kraxel@redhat.com>
References: <20190829103301.3539-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Thu, 29 Aug 2019 10:33:10 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 gurchetansingh@chromium.org, Gerd Hoffmann <kraxel@redhat.com>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

dmlydGlvLWdwdSBiYXNpY2FsbHkgbmVlZHMgYSBzZ190YWJsZSBmb3IgdGhlIGJvLCB0byB0ZWxs
IHRoZSBob3N0IHdoZXJlCnRoZSBiYWNraW5nIHBhZ2VzIGZvciB0aGUgb2JqZWN0IGFyZS4gIFNv
IHRoZSBnZW0gc2htZW0gaGVscGVycyBhcmUgYQpwZXJmZWN0IGZpdC4gIFNvbWUgZHJtX2dlbV9v
YmplY3RfZnVuY3MgbmVlZCB0aGluIHdyYXBwZXJzIHRvIHVwZGF0ZSB0aGUKaG9zdCBzdGF0ZSwg
YnV0IG90aGVyd2lzZSB0aGUgaGVscGVycyBoYW5kbGUgZXZlcnl0aGluZyBqdXN0IGZpbmUuCgpP
bmNlIHRoZSBmZW5jaW5nIHdhcyBzb3J0ZWQgdGhlIHN3aXRjaCB3YXMgc3VycHJpc2luZ2x5IGVh
c3kgYW5kIGZvciB0aGUKbW9zdCBwYXJ0IGp1c3QgcmVtb3ZpbmcgdGhlIHR0bSBjb2RlLgoKdjQ6
IGZpeCBkcm1fZ2VtX29iamVjdF9mdW5jcyBuYW1lLgoKU2lnbmVkLW9mZi1ieTogR2VyZCBIb2Zm
bWFubiA8a3JheGVsQHJlZGhhdC5jb20+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwu
dmV0dGVyQGZmd2xsLmNoPgotLS0KIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYu
aCAgICB8ICA1MiArLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMgICAg
fCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyAgICB8ICAxNiAr
LQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMgIHwgICA1ICstCiBkcml2
ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMgICAgfCAgIDkgLQogZHJpdmVycy9ncHUv
ZHJtL3ZpcnRpby92aXJ0Z3B1X29iamVjdC5jIHwgMTQ2ICsrKystLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ByaW1lLmMgIHwgIDM0IC0tLQogZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X3R0bS5jICAgIHwgMzA1IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMgICAgIHwgIDI0ICstCiBkcml2ZXJz
L2dwdS9kcm0vdmlydGlvL0tjb25maWcgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vTWFrZWZpbGUgICAgICAgICB8ICAgMiArLQogMTEgZmlsZXMgY2hhbmdlZCwgODAg
aW5zZXJ0aW9ucygrKSwgNTM1IGRlbGV0aW9ucygtKQogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV90dG0uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9kcnYuaAppbmRleCAxMjY2YThlNjQ5NjEuLmI2N2QyM2VmMmIxMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9kcnYuaApAQCAtMzUsMTIgKzM1LDkgQEAKICNpbmNsdWRlIDxkcm0vZHJt
X2VuY29kZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgogI2luY2x1ZGUgPGRy
bS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmg+CiAjaW5j
bHVkZSA8ZHJtL2RybV9pb2N0bC5oPgogI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+
Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fYXBpLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1f
Ym9fZHJpdmVyLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fbW9kdWxlLmg+Ci0jaW5jbHVkZSA8
ZHJtL3R0bS90dG1fcGxhY2VtZW50Lmg+CiAKICNkZWZpbmUgRFJJVkVSX05BTUUgInZpcnRpb19n
cHUiCiAjZGVmaW5lIERSSVZFUl9ERVNDICJ2aXJ0aW8gR1BVIgpAQCAtNjgsMjEgKzY1LDE2IEBA
IHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9wYXJhbXMgewogfTsKIAogc3RydWN0IHZpcnRpb19n
cHVfb2JqZWN0IHsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgZ2VtX2Jhc2U7CisJc3RydWN0IGRy
bV9nZW1fc2htZW1fb2JqZWN0IGJhc2U7CiAJdWludDMyX3QgaHdfcmVzX2hhbmRsZTsKIAogCXN0
cnVjdCBzZ190YWJsZSAqcGFnZXM7CiAJdWludDMyX3QgbWFwcGVkOwotCXZvaWQgKnZtYXA7CiAJ
Ym9vbCBkdW1iOwotCXN0cnVjdCB0dG1fcGxhY2UgICAgICAgICAgICAgICAgcGxhY2VtZW50X2Nv
ZGU7Ci0Jc3RydWN0IHR0bV9wbGFjZW1lbnQJCXBsYWNlbWVudDsKLQlzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QJdGJvOwotCXN0cnVjdCB0dG1fYm9fa21hcF9vYmoJCWttYXA7CiAJYm9vbCBjcmVh
dGVkOwogfTsKICNkZWZpbmUgZ2VtX3RvX3ZpcnRpb19ncHVfb2JqKGdvYmopIFwKLQljb250YWlu
ZXJfb2YoKGdvYmopLCBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QsIGdlbV9iYXNlKQorCWNvbnRh
aW5lcl9vZigoZ29iaiksIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCwgYmFzZS5iYXNlKQogCiBz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgewogCXN0cnVjdCB3d19hY3F1aXJlX2N0eCB0
aWNrZXQ7CkBAIC0xNTMsMTAgKzE0NSw2IEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZyYW1lYnVmZmVy
IHsKICNkZWZpbmUgdG9fdmlydGlvX2dwdV9mcmFtZWJ1ZmZlcih4KSBcCiAJY29udGFpbmVyX29m
KHgsIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZyYW1lYnVmZmVyLCBiYXNlKQogCi1zdHJ1Y3QgdmlydGlv
X2dwdV9tbWFuIHsKLQlzdHJ1Y3QgdHRtX2JvX2RldmljZQkJYmRldjsKLX07Ci0KIHN0cnVjdCB2
aXJ0aW9fZ3B1X3F1ZXVlIHsKIAlzdHJ1Y3QgdmlydHF1ZXVlICp2cTsKIAlzcGlubG9ja190IHFs
b2NrOwpAQCAtMTg1LDggKzE3Myw2IEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSB7CiAKIAlz
dHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldjsKIAotCXN0cnVjdCB2aXJ0aW9fZ3B1X21tYW4gbW1h
bjsKLQogCXN0cnVjdCB2aXJ0aW9fZ3B1X291dHB1dCBvdXRwdXRzW1ZJUlRJT19HUFVfTUFYX1ND
QU5PVVRTXTsKIAl1aW50MzJfdCBudW1fc2Nhbm91dHM7CiAKQEAgLTM1OCwxMSArMzQ0LDYgQEAg
c3RydWN0IGRybV9wbGFuZSAqdmlydGlvX2dwdV9wbGFuZV9pbml0KHN0cnVjdCB2aXJ0aW9fZ3B1
X2RldmljZSAqdmdkZXYsCiAJCQkJCWVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSwKIAkJCQkJaW50
IGluZGV4KTsKIAotLyogdmlydGlvX2dwdV90dG0uYyAqLwotaW50IHZpcnRpb19ncHVfdHRtX2lu
aXQoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rldik7Ci12b2lkIHZpcnRpb19ncHVfdHRt
X2Zpbmkoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rldik7Ci1pbnQgdmlydGlvX2dwdV9t
bWFwKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSk7Ci0KIC8q
IHZpcnRpb19ncHVfZmVuY2UuYyAqLwogYm9vbCB2aXJ0aW9fZmVuY2Vfc2lnbmFsZWQoc3RydWN0
IGRtYV9mZW5jZSAqZik7CiBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqdmlydGlvX2dwdV9mZW5j
ZV9hbGxvYygKQEAgLTM3NCw1OCArMzU1LDQ3IEBAIHZvaWQgdmlydGlvX2dwdV9mZW5jZV9ldmVu
dF9wcm9jZXNzKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmRldiwKIAkJCQkgICAgdTY0IGxh
c3Rfc2VxKTsKIAogLyogdmlydGlvX2dwdV9vYmplY3QgKi8KK3N0cnVjdCBkcm1fZ2VtX29iamVj
dCAqdmlydGlvX2dwdV9jcmVhdGVfb2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJ
CQlzaXplX3Qgc2l6ZSk7CiBpbnQgdmlydGlvX2dwdV9vYmplY3RfY3JlYXRlKHN0cnVjdCB2aXJ0
aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJCQkgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9w
YXJhbXMgKnBhcmFtcywKIAkJCSAgICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICoqYm9fcHRy
LAogCQkJICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UpOwotdm9pZCB2aXJ0aW9f
Z3B1X29iamVjdF9rdW5tYXAoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibyk7Ci1pbnQgdmly
dGlvX2dwdV9vYmplY3Rfa21hcChzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvKTsKLWludCB2
aXJ0aW9fZ3B1X29iamVjdF9nZXRfc2dfdGFibGUoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICpx
ZGV2LAotCQkJCSAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pOwotdm9pZCB2aXJ0aW9f
Z3B1X29iamVjdF9mcmVlX3NnX3RhYmxlKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pOwog
CiAvKiB2aXJ0Z3B1X3ByaW1lLmMgKi8KLXN0cnVjdCBzZ190YWJsZSAqdmlydGdwdV9nZW1fcHJp
bWVfZ2V0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKIHN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqdmlydGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlKAogCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKIAlzdHJ1
Y3Qgc2dfdGFibGUgKnNndCk7Ci12b2lkICp2aXJ0Z3B1X2dlbV9wcmltZV92bWFwKHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqKTsKLXZvaWQgdmlydGdwdV9nZW1fcHJpbWVfdnVubWFwKHN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqb2JqLCB2b2lkICp2YWRkcik7Ci1pbnQgdmlydGdwdV9nZW1fcHJp
bWVfbW1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgIHN0cnVjdCB2bV9hcmVh
X3N0cnVjdCAqdm1hKTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3Qq
CiB2aXJ0aW9fZ3B1X29iamVjdF9yZWYoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibykKIHsK
LQl0dG1fYm9fZ2V0KCZiby0+dGJvKTsKKwlkcm1fZ2VtX29iamVjdF9nZXQoJmJvLT5iYXNlLmJh
c2UpOwogCXJldHVybiBibzsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIHZpcnRpb19ncHVfb2Jq
ZWN0X3VucmVmKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqKmJvKQogewotCXN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqdGJvOwotCiAJaWYgKCgqYm8pID09IE5VTEwpCiAJCXJldHVybjsKLQl0
Ym8gPSAmKCgqYm8pLT50Ym8pOwotCXR0bV9ib19wdXQodGJvKTsKKwlkcm1fZ2VtX29iamVjdF9w
dXQoJigqYm8pLT5iYXNlLmJhc2UpOwogCSpibyA9IE5VTEw7CiB9CiAKIHN0YXRpYyBpbmxpbmUg
dTY0IHZpcnRpb19ncHVfb2JqZWN0X21tYXBfb2Zmc2V0KHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVj
dCAqYm8pCiB7Ci0JcmV0dXJuIGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcigmYm8tPnRiby5iYXNl
LnZtYV9ub2RlKTsKKwlyZXR1cm4gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZiby0+YmFzZS5i
YXNlLnZtYV9ub2RlKTsKIH0KIAogc3RhdGljIGlubGluZSBpbnQgdmlydGlvX2dwdV9vYmplY3Rf
cmVzZXJ2ZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvKQogewogCWludCByOwogCi0JciA9
IGRtYV9yZXN2X2xvY2tfaW50ZXJydXB0aWJsZShiby0+Z2VtX2Jhc2UucmVzdiwgTlVMTCk7CisJ
ciA9IGRtYV9yZXN2X2xvY2tfaW50ZXJydXB0aWJsZShiby0+YmFzZS5iYXNlLnJlc3YsIE5VTEwp
OwogCWlmICh1bmxpa2VseShyICE9IDApKSB7CiAJCWlmIChyICE9IC1FSU5UUikgewogCQkJc3Ry
dWN0IHZpcnRpb19ncHVfZGV2aWNlICpxZGV2ID0KLQkJCQliby0+Z2VtX2Jhc2UuZGV2LT5kZXZf
cHJpdmF0ZTsKKwkJCQliby0+YmFzZS5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAJCQlkZXZfZXJy
KHFkZXYtPmRldiwgIiVwIHJlc2VydmUgZmFpbGVkXG4iLCBibyk7CiAJCX0KIAkJcmV0dXJuIHI7
CkBAIC00MzUsNyArNDA1LDcgQEAgc3RhdGljIGlubGluZSBpbnQgdmlydGlvX2dwdV9vYmplY3Rf
cmVzZXJ2ZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvKQogCiBzdGF0aWMgaW5saW5lIHZv
aWQgdmlydGlvX2dwdV9vYmplY3RfdW5yZXNlcnZlKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAq
Ym8pCiB7Ci0JZG1hX3Jlc3ZfdW5sb2NrKGJvLT5nZW1fYmFzZS5yZXN2KTsKKwlkbWFfcmVzdl91
bmxvY2soYm8tPmJhc2UuYmFzZS5yZXN2KTsKIH0KIAogLyogdmlyZ2wgZGVidWZzICovCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMgYi9kcml2ZXJzL2dw
dS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMKaW5kZXggM2QyNDE4MTYzNmUxLi45NzdhZWJmNTE2
YTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMKQEAgLTE4NCwxNyArMTg0LDcg
QEAgTU9EVUxFX0FVVEhPUigiRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4iKTsKIE1P
RFVMRV9BVVRIT1IoIkdlcmQgSG9mZm1hbm4gPGtyYXhlbEByZWRoYXQuY29tPiIpOwogTU9EVUxF
X0FVVEhPUigiQWxvbiBMZXZ5Iik7CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRp
b25zIHZpcnRpb19ncHVfZHJpdmVyX2ZvcHMgPSB7Ci0JLm93bmVyID0gVEhJU19NT0RVTEUsCi0J
Lm9wZW4gPSBkcm1fb3BlbiwKLQkubW1hcCA9IHZpcnRpb19ncHVfbW1hcCwKLQkucG9sbCA9IGRy
bV9wb2xsLAotCS5yZWFkID0gZHJtX3JlYWQsCi0JLnVubG9ja2VkX2lvY3RsCT0gZHJtX2lvY3Rs
LAotCS5yZWxlYXNlID0gZHJtX3JlbGVhc2UsCi0JLmNvbXBhdF9pb2N0bCA9IGRybV9jb21wYXRf
aW9jdGwsCi0JLmxsc2VlayA9IG5vb3BfbGxzZWVrLAotfTsKK0RFRklORV9EUk1fR0VNX1NITUVN
X0ZPUFModmlydGlvX2dwdV9kcml2ZXJfZm9wcyk7CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZl
ciBkcml2ZXIgPSB7CiAJLmRyaXZlcl9mZWF0dXJlcyA9IERSSVZFUl9NT0RFU0VUIHwgRFJJVkVS
X0dFTSB8IERSSVZFUl9SRU5ERVIgfCBEUklWRVJfQVRPTUlDLApAQCAtMjA5LDE1ICsxOTksOSBA
QCBzdGF0aWMgc3RydWN0IGRybV9kcml2ZXIgZHJpdmVyID0gewogI2VuZGlmCiAJLnByaW1lX2hh
bmRsZV90b19mZCA9IGRybV9nZW1fcHJpbWVfaGFuZGxlX3RvX2ZkLAogCS5wcmltZV9mZF90b19o
YW5kbGUgPSBkcm1fZ2VtX3ByaW1lX2ZkX3RvX2hhbmRsZSwKLQkuZ2VtX3ByaW1lX2dldF9zZ190
YWJsZSA9IHZpcnRncHVfZ2VtX3ByaW1lX2dldF9zZ190YWJsZSwKIAkuZ2VtX3ByaW1lX2ltcG9y
dF9zZ190YWJsZSA9IHZpcnRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSwKLQkuZ2VtX3By
aW1lX3ZtYXAgPSB2aXJ0Z3B1X2dlbV9wcmltZV92bWFwLAotCS5nZW1fcHJpbWVfdnVubWFwID0g
dmlydGdwdV9nZW1fcHJpbWVfdnVubWFwLAotCS5nZW1fcHJpbWVfbW1hcCA9IHZpcnRncHVfZ2Vt
X3ByaW1lX21tYXAsCiAKLQkuZ2VtX2ZyZWVfb2JqZWN0X3VubG9ja2VkID0gdmlydGlvX2dwdV9n
ZW1fZnJlZV9vYmplY3QsCi0JLmdlbV9vcGVuX29iamVjdCA9IHZpcnRpb19ncHVfZ2VtX29iamVj
dF9vcGVuLAotCS5nZW1fY2xvc2Vfb2JqZWN0ID0gdmlydGlvX2dwdV9nZW1fb2JqZWN0X2Nsb3Nl
LAorCS5nZW1fY3JlYXRlX29iamVjdCA9IHZpcnRpb19ncHVfY3JlYXRlX29iamVjdCwKIAkuZm9w
cyA9ICZ2aXJ0aW9fZ3B1X2RyaXZlcl9mb3BzLAogCiAJLmlvY3RscyA9IHZpcnRpb19ncHVfaW9j
dGxzLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCmluZGV4IGZkNGVlZWVkYWY3NS4u
ZmI5NTdlMzE4M2I2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
Z2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCkBAIC0yOCwx
NCArMjgsNiBAQAogCiAjaW5jbHVkZSAidmlydGdwdV9kcnYuaCIKIAotdm9pZCB2aXJ0aW9fZ3B1
X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbV9vYmopCi17Ci0Jc3Ry
dWN0IHZpcnRpb19ncHVfb2JqZWN0ICpvYmogPSBnZW1fdG9fdmlydGlvX2dwdV9vYmooZ2VtX29i
aik7Ci0KLQlpZiAob2JqKQotCQl2aXJ0aW9fZ3B1X29iamVjdF91bnJlZigmb2JqKTsKLX0KLQog
c3RydWN0IHZpcnRpb19ncHVfb2JqZWN0KgogdmlydGlvX2dwdV9hbGxvY19vYmplY3Qoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIAkJCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9wYXJhbXMgKnBh
cmFtcywKQEAgLTY2LDE2ICs1OCwxNiBAQCBpbnQgdmlydGlvX2dwdV9nZW1fY3JlYXRlKHN0cnVj
dCBkcm1fZmlsZSAqZmlsZSwKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJSKG9i
aik7CiAKLQlyZXQgPSBkcm1fZ2VtX2hhbmRsZV9jcmVhdGUoZmlsZSwgJm9iai0+Z2VtX2Jhc2Us
ICZoYW5kbGUpOworCXJldCA9IGRybV9nZW1faGFuZGxlX2NyZWF0ZShmaWxlLCAmb2JqLT5iYXNl
LmJhc2UsICZoYW5kbGUpOwogCWlmIChyZXQpIHsKLQkJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgm
b2JqLT5nZW1fYmFzZSk7CisJCWRybV9nZW1fb2JqZWN0X3JlbGVhc2UoJm9iai0+YmFzZS5iYXNl
KTsKIAkJcmV0dXJuIHJldDsKIAl9CiAKLQkqb2JqX3AgPSAmb2JqLT5nZW1fYmFzZTsKKwkqb2Jq
X3AgPSAmb2JqLT5iYXNlLmJhc2U7CiAKIAkvKiBkcm9wIHJlZmVyZW5jZSBmcm9tIGFsbG9jYXRl
IC0gaGFuZGxlIGhvbGRzIGl0IG5vdyAqLwotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgm
b2JqLT5nZW1fYmFzZSk7CisJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZvYmotPmJhc2Uu
YmFzZSk7CiAKIAkqaGFuZGxlX3AgPSBoYW5kbGU7CiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9pb2N0bC5jCmluZGV4IGUzNmFiM2Q2ZDE2Mi4uNTg4YTRiYTFlN2E0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYwpAQCAtMjksNyArMjksNiBAQAog
I2luY2x1ZGUgPGxpbnV4L3N5bmNfZmlsZS5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9maWxlLmg+
Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmg+CiAjaW5jbHVkZSA8ZHJtL3Zp
cnRncHVfZHJtLmg+CiAKICNpbmNsdWRlICJ2aXJ0Z3B1X2Rydi5oIgpAQCAtMjYxLDcgKzI2MCw3
IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV9yZXNvdXJjZV9jcmVhdGVfaW9jdGwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlkbWFfZmVuY2VfcHV0KCZmZW5jZS0+Zik7CiAJ
aWYgKElTX0VSUihxb2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIocW9iaik7Ci0Jb2JqID0gJnFvYmot
PmdlbV9iYXNlOworCW9iaiA9ICZxb2JqLT5iYXNlLmJhc2U7CiAKIAlyZXQgPSBkcm1fZ2VtX2hh
bmRsZV9jcmVhdGUoZmlsZV9wcml2LCBvYmosICZoYW5kbGUpOwogCWlmIChyZXQpIHsKQEAgLTI4
OCw3ICsyODcsNyBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfcmVzb3VyY2VfaW5mb19pb2N0bChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJcW9iaiA9IGdlbV90b192aXJ0
aW9fZ3B1X29iaihnb2JqKTsKIAotCXJpLT5zaXplID0gcW9iai0+Z2VtX2Jhc2Uuc2l6ZTsKKwly
aS0+c2l6ZSA9IHFvYmotPmJhc2UuYmFzZS5zaXplOwogCXJpLT5yZXNfaGFuZGxlID0gcW9iai0+
aHdfcmVzX2hhbmRsZTsKIAlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoZ29iaik7CiAJcmV0
dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMKaW5kZXggYzE5MDcwMmZhYjcy
Li4yMzFjNGUyN2IzYjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9rbXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMKQEAgLTE3
MywxMiArMTczLDYgQEAgaW50IHZpcnRpb19ncHVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCQlnb3RvIGVycl92YnVmczsKIAl9CiAKLQlyZXQgPSB2aXJ0aW9fZ3B1X3R0bV9pbml0KHZn
ZGV2KTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXQgdHRtICVkXG4i
LCByZXQpOwotCQlnb3RvIGVycl90dG07Ci0JfQotCiAJLyogZ2V0IGRpc3BsYXkgaW5mbyAqLwog
CXZpcnRpb19jcmVhZCh2Z2Rldi0+dmRldiwgc3RydWN0IHZpcnRpb19ncHVfY29uZmlnLAogCQkg
ICAgIG51bV9zY2Fub3V0cywgJm51bV9zY2Fub3V0cyk7CkBAIC0yMTAsOCArMjA0LDYgQEAgaW50
IHZpcnRpb19ncHVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiAwOwogCiBl
cnJfc2Nhbm91dHM6Ci0JdmlydGlvX2dwdV90dG1fZmluaSh2Z2Rldik7Ci1lcnJfdHRtOgogCXZp
cnRpb19ncHVfZnJlZV92YnVmcyh2Z2Rldik7CiBlcnJfdmJ1ZnM6CiAJdmdkZXYtPnZkZXYtPmNv
bmZpZy0+ZGVsX3Zxcyh2Z2Rldi0+dmRldik7CkBAIC0yNDIsNyArMjM0LDYgQEAgdm9pZCB2aXJ0
aW9fZ3B1X2RlaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXZnZGV2LT52ZGV2LT5jb25m
aWctPmRlbF92cXModmdkZXYtPnZkZXYpOwogCiAJdmlydGlvX2dwdV9tb2Rlc2V0X2Zpbmkodmdk
ZXYpOwotCXZpcnRpb19ncHVfdHRtX2ZpbmkodmdkZXYpOwogCXZpcnRpb19ncHVfZnJlZV92YnVm
cyh2Z2Rldik7CiAJdmlydGlvX2dwdV9jbGVhbnVwX2NhcF9jYWNoZSh2Z2Rldik7CiAJa2ZyZWUo
dmdkZXYtPmNhcHNldHMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X29iamVjdC5jCmlu
ZGV4IDZhZjI4NjJjOWE3My4uNjlhM2QzMTBmZjcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vdmlydGlvL3ZpcnRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X29iamVjdC5jCkBAIC0yNSw4ICsyNSw2IEBACiAKICNpbmNsdWRlIDxsaW51eC9tb2R1
bGVwYXJhbS5oPgogCi0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmg+Ci0KICNp
bmNsdWRlICJ2aXJ0Z3B1X2Rydi5oIgogCiBzdGF0aWMgaW50IHZpcnRpb19ncHVfdmlyZ2xyZW5k
ZXJlcl93b3JrYXJvdW5kID0gMTsKQEAgLTYzLDM5ICs2MSw0NSBAQCBzdGF0aWMgdm9pZCB2aXJ0
aW9fZ3B1X3Jlc291cmNlX2lkX3B1dChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LCB1
aW50MzJfdAogCX0KIH0KIAotc3RhdGljIHZvaWQgdmlydGlvX2dwdV90dG1fYm9fZGVzdHJveShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKnRibykKK3N0YXRpYyB2b2lkIHZpcnRpb19ncHVfZnJl
ZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0Jc3RydWN0IHZpcnRpb19n
cHVfb2JqZWN0ICpibzsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2OwotCi0JYm8g
PSBjb250YWluZXJfb2YodGJvLCBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QsIHRibyk7Ci0Jdmdk
ZXYgPSAoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICopYm8tPmdlbV9iYXNlLmRldi0+ZGV2X3By
aXZhdGU7CisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibyA9IGdlbV90b192aXJ0aW9fZ3B1
X29iaihvYmopOworCXN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPSBiby0+YmFzZS5i
YXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAKKwlpZiAoYm8tPnBhZ2VzKQorCQl2aXJ0aW9fZ3B1X29i
amVjdF9kZXRhY2godmdkZXYsIGJvKTsKIAlpZiAoYm8tPmNyZWF0ZWQpCiAJCXZpcnRpb19ncHVf
Y21kX3VucmVmX3Jlc291cmNlKHZnZGV2LCBiby0+aHdfcmVzX2hhbmRsZSk7Ci0JaWYgKGJvLT5w
YWdlcykKLQkJdmlydGlvX2dwdV9vYmplY3RfZnJlZV9zZ190YWJsZShibyk7Ci0JaWYgKGJvLT52
bWFwKQotCQl2aXJ0aW9fZ3B1X29iamVjdF9rdW5tYXAoYm8pOwotCWRybV9nZW1fb2JqZWN0X3Jl
bGVhc2UoJmJvLT5nZW1fYmFzZSk7CiAJdmlydGlvX2dwdV9yZXNvdXJjZV9pZF9wdXQodmdkZXYs
IGJvLT5od19yZXNfaGFuZGxlKTsKLQlrZnJlZShibyk7CisKKwlkcm1fZ2VtX3NobWVtX2ZyZWVf
b2JqZWN0KG9iaik7CiB9CiAKLXN0YXRpYyB2b2lkIHZpcnRpb19ncHVfaW5pdF90dG1fcGxhY2Vt
ZW50KHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqdmdibykKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZHJtX2dlbV9vYmplY3RfZnVuY3MgdmlydGlvX2dwdV9nZW1fZnVuY3MgPSB7CisJLmZyZWUgPSB2
aXJ0aW9fZ3B1X2ZyZWVfb2JqZWN0LAorCS5vcGVuID0gdmlydGlvX2dwdV9nZW1fb2JqZWN0X29w
ZW4sCisJLmNsb3NlID0gdmlydGlvX2dwdV9nZW1fb2JqZWN0X2Nsb3NlLAorCisJLnByaW50X2lu
Zm8gPSBkcm1fZ2VtX3NobWVtX3ByaW50X2luZm8sCisJLnBpbiA9IGRybV9nZW1fc2htZW1fcGlu
LAorCS51bnBpbiA9IGRybV9nZW1fc2htZW1fdW5waW4sCisJLmdldF9zZ190YWJsZSA9IGRybV9n
ZW1fc2htZW1fZ2V0X3NnX3RhYmxlLAorCS52bWFwID0gZHJtX2dlbV9zaG1lbV92bWFwLAorCS52
dW5tYXAgPSBkcm1fZ2VtX3NobWVtX3Z1bm1hcCwKKwkudm1fb3BzID0gJmRybV9nZW1fc2htZW1f
dm1fb3BzLAorfTsKKworc3RydWN0IGRybV9nZW1fb2JqZWN0ICp2aXJ0aW9fZ3B1X2NyZWF0ZV9v
YmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJCQkJCXNpemVfdCBzaXplKQogewotCXUz
MiBjID0gMTsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvOwogCi0Jdmdiby0+cGxhY2Vt
ZW50LnBsYWNlbWVudCA9ICZ2Z2JvLT5wbGFjZW1lbnRfY29kZTsKLQl2Z2JvLT5wbGFjZW1lbnQu
YnVzeV9wbGFjZW1lbnQgPSAmdmdiby0+cGxhY2VtZW50X2NvZGU7Ci0Jdmdiby0+cGxhY2VtZW50
X2NvZGUuZnBmbiA9IDA7Ci0Jdmdiby0+cGxhY2VtZW50X2NvZGUubHBmbiA9IDA7Ci0Jdmdiby0+
cGxhY2VtZW50X2NvZGUuZmxhZ3MgPQotCQlUVE1fUExfTUFTS19DQUNISU5HIHwgVFRNX1BMX0ZM
QUdfVFQgfAotCQlUVE1fUExfRkxBR19OT19FVklDVDsKLQl2Z2JvLT5wbGFjZW1lbnQubnVtX3Bs
YWNlbWVudCA9IGM7Ci0Jdmdiby0+cGxhY2VtZW50Lm51bV9idXN5X3BsYWNlbWVudCA9IGM7CisJ
Ym8gPSBremFsbG9jKHNpemVvZigqYm8pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJvKQorCQlyZXR1
cm4gTlVMTDsKIAorCWJvLT5iYXNlLmJhc2UuZnVuY3MgPSAmdmlydGlvX2dwdV9nZW1fZnVuY3M7
CisJcmV0dXJuICZiby0+YmFzZS5iYXNlOwogfQogCiBpbnQgdmlydGlvX2dwdV9vYmplY3RfY3Jl
YXRlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCkBAIC0xMDQsMjcgKzEwOCwyMiBA
QCBpbnQgdmlydGlvX2dwdV9vYmplY3RfY3JlYXRlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAq
dmdkZXYsCiAJCQkgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSkKIHsKIAlzdHJ1
Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMgPSBOVUxMOworCXN0cnVjdCBkcm1fZ2Vt
X3NobWVtX29iamVjdCAqc2htZW1fb2JqOwogCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm87
Ci0Jc2l6ZV90IGFjY19zaXplOwogCWludCByZXQ7CiAKIAkqYm9fcHRyID0gTlVMTDsKIAotCWFj
Y19zaXplID0gdHRtX2JvX2RtYV9hY2Nfc2l6ZSgmdmdkZXYtPm1tYW4uYmRldiwgcGFyYW1zLT5z
aXplLAotCQkJCSAgICAgICBzaXplb2Yoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0KSk7CisJcGFy
YW1zLT5zaXplID0gcm91bmR1cChwYXJhbXMtPnNpemUsIFBBR0VfU0laRSk7CisJc2htZW1fb2Jq
ID0gZHJtX2dlbV9zaG1lbV9jcmVhdGUodmdkZXYtPmRkZXYsIHBhcmFtcy0+c2l6ZSk7CisJaWYg
KElTX0VSUihzaG1lbV9vYmopKQorCQlyZXR1cm4gUFRSX0VSUihzaG1lbV9vYmopOworCWJvID0g
Z2VtX3RvX3ZpcnRpb19ncHVfb2JqKCZzaG1lbV9vYmotPmJhc2UpOwogCi0JYm8gPSBremFsbG9j
KHNpemVvZihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QpLCBHRlBfS0VSTkVMKTsKLQlpZiAoYm8g
PT0gTlVMTCkKLQkJcmV0dXJuIC1FTk9NRU07CiAJcmV0ID0gdmlydGlvX2dwdV9yZXNvdXJjZV9p
ZF9nZXQodmdkZXYsICZiby0+aHdfcmVzX2hhbmRsZSk7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8g
ZXJyX2ZyZWVfZ2VtOwogCi0JcGFyYW1zLT5zaXplID0gcm91bmR1cChwYXJhbXMtPnNpemUsIFBB
R0VfU0laRSk7Ci0JcmV0ID0gZHJtX2dlbV9vYmplY3RfaW5pdCh2Z2Rldi0+ZGRldiwgJmJvLT5n
ZW1fYmFzZSwgcGFyYW1zLT5zaXplKTsKLQlpZiAocmV0ICE9IDApCi0JCWdvdG8gZXJyX3B1dF9p
ZDsKLQogCWJvLT5kdW1iID0gcGFyYW1zLT5kdW1iOwogCiAJaWYgKGZlbmNlKSB7CkBAIC0xMzIs
NyArMTMxLDcgQEAgaW50IHZpcnRpb19ncHVfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAogCQlvYmpzID0gdmlydGlvX2dwdV9hcnJheV9hbGxvYygxKTsKIAkJ
aWYgKCFvYmpzKQogCQkJZ290byBlcnJfcHV0X2lkOwotCQl2aXJ0aW9fZ3B1X2FycmF5X2FkZF9v
Ymoob2JqcywgJmJvLT5nZW1fYmFzZSk7CisJCXZpcnRpb19ncHVfYXJyYXlfYWRkX29iaihvYmpz
LCAmYm8tPmJhc2UuYmFzZSk7CiAKIAkJcmV0ID0gdmlydGlvX2dwdV9hcnJheV9sb2NrX3Jlc3Yo
b2Jqcyk7CiAJCWlmIChyZXQgIT0gMCkKQEAgLTE0NywxNSArMTQ2LDExIEBAIGludCB2aXJ0aW9f
Z3B1X29iamVjdF9jcmVhdGUoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKIAkJCQkJ
ICAgICAgIG9ianMsIGZlbmNlKTsKIAl9CiAKLQl2aXJ0aW9fZ3B1X2luaXRfdHRtX3BsYWNlbWVu
dChibyk7Ci0JcmV0ID0gdHRtX2JvX2luaXQoJnZnZGV2LT5tbWFuLmJkZXYsICZiby0+dGJvLCBw
YXJhbXMtPnNpemUsCi0JCQkgIHR0bV9ib190eXBlX2RldmljZSwgJmJvLT5wbGFjZW1lbnQsIDAs
Ci0JCQkgIHRydWUsIGFjY19zaXplLCBOVUxMLAotCQkJICBiby0+Z2VtX2Jhc2UucmVzdiwKLQkJ
CSAgJnZpcnRpb19ncHVfdHRtX2JvX2Rlc3Ryb3kpOwotCS8qIHR0bV9ib19pbml0IGZhaWx1cmUg
d2lsbCBjYWxsIHRoZSBkZXN0cm95ICovCi0JaWYgKHJldCAhPSAwKQorCXJldCA9IHZpcnRpb19n
cHVfb2JqZWN0X2F0dGFjaCh2Z2RldiwgYm8sIE5VTEwpOworCWlmIChyZXQgIT0gMCkgeworCQl2
aXJ0aW9fZ3B1X2ZyZWVfb2JqZWN0KCZzaG1lbV9vYmotPmJhc2UpOwogCQlyZXR1cm4gcmV0Owor
CX0KIAogCSpib19wdHIgPSBibzsKIAlyZXR1cm4gMDsKQEAgLTE2NSw2NSArMTYwLDYgQEAgaW50
IHZpcnRpb19ncHVfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2
LAogZXJyX3B1dF9pZDoKIAl2aXJ0aW9fZ3B1X3Jlc291cmNlX2lkX3B1dCh2Z2RldiwgYm8tPmh3
X3Jlc19oYW5kbGUpOwogZXJyX2ZyZWVfZ2VtOgotCWtmcmVlKGJvKTsKKwlkcm1fZ2VtX3NobWVt
X2ZyZWVfb2JqZWN0KCZzaG1lbV9vYmotPmJhc2UpOwogCXJldHVybiByZXQ7CiB9Ci0KLXZvaWQg
dmlydGlvX2dwdV9vYmplY3Rfa3VubWFwKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pCi17
Ci0JYm8tPnZtYXAgPSBOVUxMOwotCXR0bV9ib19rdW5tYXAoJmJvLT5rbWFwKTsKLX0KLQotaW50
IHZpcnRpb19ncHVfb2JqZWN0X2ttYXAoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibykKLXsK
LQlib29sIGlzX2lvbWVtOwotCWludCByOwotCi0JV0FSTl9PTihiby0+dm1hcCk7Ci0KLQlyID0g
dHRtX2JvX2ttYXAoJmJvLT50Ym8sIDAsIGJvLT50Ym8ubnVtX3BhZ2VzLCAmYm8tPmttYXApOwot
CWlmIChyKQotCQlyZXR1cm4gcjsKLQliby0+dm1hcCA9IHR0bV9rbWFwX29ial92aXJ0dWFsKCZi
by0+a21hcCwgJmlzX2lvbWVtKTsKLQlyZXR1cm4gMDsKLX0KLQotaW50IHZpcnRpb19ncHVfb2Jq
ZWN0X2dldF9zZ190YWJsZShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnFkZXYsCi0JCQkJICAg
c3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibykKLXsKLQlpbnQgcmV0OwotCXN0cnVjdCBwYWdl
ICoqcGFnZXMgPSBiby0+dGJvLnR0bS0+cGFnZXM7Ci0JaW50IG5yX3BhZ2VzID0gYm8tPnRiby5u
dW1fcGFnZXM7Ci0Jc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsKLQkJLmludGVycnVw
dGlibGUgPSBmYWxzZSwKLQkJLm5vX3dhaXRfZ3B1ID0gZmFsc2UKLQl9OwotCi0JLyogd3RmIHN3
YXBwaW5nICovCi0JaWYgKGJvLT5wYWdlcykKLQkJcmV0dXJuIDA7Ci0KLQlpZiAoYm8tPnRiby50
dG0tPnN0YXRlID09IHR0X3VucG9wdWxhdGVkKQotCQliby0+dGJvLnR0bS0+YmRldi0+ZHJpdmVy
LT50dG1fdHRfcG9wdWxhdGUoYm8tPnRiby50dG0sICZjdHgpOwotCWJvLT5wYWdlcyA9IGttYWxs
b2Moc2l6ZW9mKHN0cnVjdCBzZ190YWJsZSksIEdGUF9LRVJORUwpOwotCWlmICghYm8tPnBhZ2Vz
KQotCQlnb3RvIG91dDsKLQotCXJldCA9IHNnX2FsbG9jX3RhYmxlX2Zyb21fcGFnZXMoYm8tPnBh
Z2VzLCBwYWdlcywgbnJfcGFnZXMsIDAsCi0JCQkJCW5yX3BhZ2VzIDw8IFBBR0VfU0hJRlQsIEdG
UF9LRVJORUwpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCXJldHVybiAwOwotb3V0OgotCWtm
cmVlKGJvLT5wYWdlcyk7Ci0JYm8tPnBhZ2VzID0gTlVMTDsKLQlyZXR1cm4gLUVOT01FTTsKLX0K
LQotdm9pZCB2aXJ0aW9fZ3B1X29iamVjdF9mcmVlX3NnX3RhYmxlKHN0cnVjdCB2aXJ0aW9fZ3B1
X29iamVjdCAqYm8pCi17Ci0Jc2dfZnJlZV90YWJsZShiby0+cGFnZXMpOwotCWtmcmVlKGJvLT5w
YWdlcyk7Ci0JYm8tPnBhZ2VzID0gTlVMTDsKLX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vdmlydGdwdV9wcmltZS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1
X3ByaW1lLmMKaW5kZXggZGM2NDJhODg0Yjg4Li4wNTBkMjRjMzlhOGYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9wcmltZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vdmlydGdwdV9wcmltZS5jCkBAIC0zMCw0MyArMzAsOSBAQAogICogZGV2aWNlIHRo
YXQgbWlnaHQgc2hhcmUgYnVmZmVycyB3aXRoIHZpcnRncHUKICAqLwogCi1zdHJ1Y3Qgc2dfdGFi
bGUgKnZpcnRncHVfZ2VtX3ByaW1lX2dldF9zZ190YWJsZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
Km9iaikKLXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3ZpcnRpb19n
cHVfb2JqKG9iaik7Ci0KLQlpZiAoIWJvLT50Ym8udHRtLT5wYWdlcyB8fCAhYm8tPnRiby50dG0t
Pm51bV9wYWdlcykKLQkJLyogc2hvdWxkIG5vdCBoYXBwZW4gKi8KLQkJcmV0dXJuIEVSUl9QVFIo
LUVJTlZBTCk7Ci0KLQlyZXR1cm4gZHJtX3ByaW1lX3BhZ2VzX3RvX3NnKGJvLT50Ym8udHRtLT5w
YWdlcywKLQkJCQkgICAgIGJvLT50Ym8udHRtLT5udW1fcGFnZXMpOwotfQotCiBzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKnZpcnRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSgKIAlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCiAJc3Ry
dWN0IHNnX3RhYmxlICp0YWJsZSkKIHsKIAlyZXR1cm4gRVJSX1BUUigtRU5PREVWKTsKIH0KLQot
dm9pZCAqdmlydGdwdV9nZW1fcHJpbWVfdm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikK
LXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3ZpcnRpb19ncHVfb2Jq
KG9iaik7Ci0JaW50IHJldDsKLQotCXJldCA9IHZpcnRpb19ncHVfb2JqZWN0X2ttYXAoYm8pOwot
CWlmIChyZXQpCi0JCXJldHVybiBOVUxMOwotCXJldHVybiBiby0+dm1hcDsKLX0KLQotdm9pZCB2
aXJ0Z3B1X2dlbV9wcmltZV92dW5tYXAoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHZvaWQg
KnZhZGRyKQotewotCXZpcnRpb19ncHVfb2JqZWN0X2t1bm1hcChnZW1fdG9fdmlydGlvX2dwdV9v
Ymoob2JqKSk7Ci19Ci0KLWludCB2aXJ0Z3B1X2dlbV9wcmltZV9tbWFwKHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqLAotCQkJICAgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCi17Ci0JcmV0
dXJuIGRybV9nZW1fcHJpbWVfbW1hcChvYmosIHZtYSk7Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3Zp
cnRncHVfdHRtLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IGY4NzkwMzY0MTg0Ny4u
MDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV90dG0uYwor
KysgL2Rldi9udWxsCkBAIC0xLDMwNSArMCwwIEBACi0vKgotICogQ29weXJpZ2h0IChDKSAyMDE1
IFJlZCBIYXQsIEluYy4KLSAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi0gKgotICogQXV0aG9yczoK
LSAqICAgIERhdmUgQWlybGllCi0gKiAgICBBbG9uIExldnkKLSAqCi0gKiBQZXJtaXNzaW9uIGlz
IGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcg
YQotICogY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24g
ZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhv
dXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdo
dHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJs
aWNlbnNlLAotICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBl
cm1pdCBwZXJzb25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8g
c28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAqIFRoZSBhYm92
ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGlu
Y2x1ZGVkIGluCi0gKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBT
b2Z0d2FyZS4KLSAqCi0gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9V
VCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgotICogSU1QTElFRCwgSU5DTFVESU5H
IEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCi0g
KiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAg
SU4gTk8gRVZFTlQgU0hBTEwKLSAqIFRIRSBDT1BZUklHSFQgSE9MREVSKFMpIE9SIEFVVEhPUihT
KSBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUgotICogT1RIRVIgTElBQklMSVRZ
LCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsCi0g
KiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJF
IE9SIFRIRSBVU0UgT1IKLSAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KLSAqLwot
Ci0jaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KLQotI2luY2x1ZGUgPGRybS9kcm0uaD4KLSNpbmNs
dWRlIDxkcm0vZHJtX2ZpbGUuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KLSNp
bmNsdWRlIDxkcm0vdHRtL3R0bV9ib19kcml2ZXIuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9t
b2R1bGUuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmg+Ci0jaW5jbHVkZSA8
ZHJtL3R0bS90dG1fcGxhY2VtZW50Lmg+Ci0jaW5jbHVkZSA8ZHJtL3ZpcnRncHVfZHJtLmg+Ci0K
LSNpbmNsdWRlICJ2aXJ0Z3B1X2Rydi5oIgotCi1zdGF0aWMgc3RydWN0Ci12aXJ0aW9fZ3B1X2Rl
dmljZSAqdmlydGlvX2dwdV9nZXRfdmdkZXYoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYpCi17
Ci0Jc3RydWN0IHZpcnRpb19ncHVfbW1hbiAqbW1hbjsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZp
Y2UgKnZnZGV2OwotCi0JbW1hbiA9IGNvbnRhaW5lcl9vZihiZGV2LCBzdHJ1Y3QgdmlydGlvX2dw
dV9tbWFuLCBiZGV2KTsKLQl2Z2RldiA9IGNvbnRhaW5lcl9vZihtbWFuLCBzdHJ1Y3QgdmlydGlv
X2dwdV9kZXZpY2UsIG1tYW4pOwotCXJldHVybiB2Z2RldjsKLX0KLQotaW50IHZpcnRpb19ncHVf
bW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCi17Ci0J
c3RydWN0IGRybV9maWxlICpmaWxlX3ByaXY7Ci0Jc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2
Z2RldjsKLQlpbnQgcjsKLQotCWZpbGVfcHJpdiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKLQl2Z2Rl
diA9IGZpbGVfcHJpdi0+bWlub3ItPmRldi0+ZGV2X3ByaXZhdGU7Ci0JaWYgKHZnZGV2ID09IE5V
TEwpIHsKLQkJRFJNX0VSUk9SKAotCQkgImZpbHAtPnByaXZhdGVfZGF0YS0+bWlub3ItPmRldi0+
ZGV2X3ByaXZhdGUgPT0gTlVMTFxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQlyID0gdHRt
X2JvX21tYXAoZmlscCwgdm1hLCAmdmdkZXYtPm1tYW4uYmRldik7Ci0KLQlyZXR1cm4gcjsKLX0K
LQotc3RhdGljIGludCB2aXJ0aW9fZ3B1X2ludmFsaWRhdGVfY2FjaGVzKHN0cnVjdCB0dG1fYm9f
ZGV2aWNlICpiZGV2LAotCQkJCQl1aW50MzJfdCBmbGFncykKLXsKLQlyZXR1cm4gMDsKLX0KLQot
c3RhdGljIGludCB0dG1fYm9fbWFuX2dldF9ub2RlKHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdl
ciAqbWFuLAotCQkJICAgICAgIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCi0JCQkgICAg
ICAgY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UsCi0JCQkgICAgICAgc3RydWN0IHR0bV9t
ZW1fcmVnICptZW0pCi17Ci0JbWVtLT5tbV9ub2RlID0gKHZvaWQgKikxOwotCXJldHVybiAwOwot
fQotCi1zdGF0aWMgdm9pZCB0dG1fYm9fbWFuX3B1dF9ub2RlKHN0cnVjdCB0dG1fbWVtX3R5cGVf
bWFuYWdlciAqbWFuLAotCQkJCXN0cnVjdCB0dG1fbWVtX3JlZyAqbWVtKQotewotCW1lbS0+bW1f
bm9kZSA9ICh2b2lkICopTlVMTDsKLX0KLQotc3RhdGljIGludCB0dG1fYm9fbWFuX2luaXQoc3Ry
dWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4sCi0JCQkgICB1bnNpZ25lZCBsb25nIHBfc2l6
ZSkKLXsKLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCB0dG1fYm9fbWFuX3Rha2Vkb3duKHN0
cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuKQotewotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgdm9pZCB0dG1fYm9fbWFuX2RlYnVnKHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFu
LAotCQkJICAgICBzdHJ1Y3QgZHJtX3ByaW50ZXIgKnByaW50ZXIpCi17Ci19Ci0KLXN0YXRpYyBj
b25zdCBzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXJfZnVuYyB2aXJ0aW9fZ3B1X2JvX21hbmFn
ZXJfZnVuYyA9IHsKLQkuaW5pdCA9IHR0bV9ib19tYW5faW5pdCwKLQkudGFrZWRvd24gPSB0dG1f
Ym9fbWFuX3Rha2Vkb3duLAotCS5nZXRfbm9kZSA9IHR0bV9ib19tYW5fZ2V0X25vZGUsCi0JLnB1
dF9ub2RlID0gdHRtX2JvX21hbl9wdXRfbm9kZSwKLQkuZGVidWcgPSB0dG1fYm9fbWFuX2RlYnVn
Ci19OwotCi1zdGF0aWMgaW50IHZpcnRpb19ncHVfaW5pdF9tZW1fdHlwZShzdHJ1Y3QgdHRtX2Jv
X2RldmljZSAqYmRldiwgdWludDMyX3QgdHlwZSwKLQkJCQkgICAgc3RydWN0IHR0bV9tZW1fdHlw
ZV9tYW5hZ2VyICptYW4pCi17Ci0Jc3dpdGNoICh0eXBlKSB7Ci0JY2FzZSBUVE1fUExfU1lTVEVN
OgotCQkvKiBTeXN0ZW0gbWVtb3J5ICovCi0JCW1hbi0+ZmxhZ3MgPSBUVE1fTUVNVFlQRV9GTEFH
X01BUFBBQkxFOwotCQltYW4tPmF2YWlsYWJsZV9jYWNoaW5nID0gVFRNX1BMX01BU0tfQ0FDSElO
RzsKLQkJbWFuLT5kZWZhdWx0X2NhY2hpbmcgPSBUVE1fUExfRkxBR19DQUNIRUQ7Ci0JCWJyZWFr
OwotCWNhc2UgVFRNX1BMX1RUOgotCQltYW4tPmZ1bmMgPSAmdmlydGlvX2dwdV9ib19tYW5hZ2Vy
X2Z1bmM7Ci0JCW1hbi0+ZmxhZ3MgPSBUVE1fTUVNVFlQRV9GTEFHX01BUFBBQkxFOwotCQltYW4t
PmF2YWlsYWJsZV9jYWNoaW5nID0gVFRNX1BMX01BU0tfQ0FDSElORzsKLQkJbWFuLT5kZWZhdWx0
X2NhY2hpbmcgPSBUVE1fUExfRkxBR19DQUNIRUQ7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCURS
TV9FUlJPUigiVW5zdXBwb3J0ZWQgbWVtb3J5IHR5cGUgJXVcbiIsICh1bnNpZ25lZCBpbnQpdHlw
ZSk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQg
dmlydGlvX2dwdV9ldmljdF9mbGFncyhzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAotCQkJ
CXN0cnVjdCB0dG1fcGxhY2VtZW50ICpwbGFjZW1lbnQpCi17Ci0Jc3RhdGljIGNvbnN0IHN0cnVj
dCB0dG1fcGxhY2UgcGxhY2VtZW50cyA9IHsKLQkJLmZwZm4gID0gMCwKLQkJLmxwZm4gID0gMCwK
LQkJLmZsYWdzID0gVFRNX1BMX01BU0tfQ0FDSElORyB8IFRUTV9QTF9GTEFHX1NZU1RFTSwKLQl9
OwotCi0JcGxhY2VtZW50LT5wbGFjZW1lbnQgPSAmcGxhY2VtZW50czsKLQlwbGFjZW1lbnQtPmJ1
c3lfcGxhY2VtZW50ID0gJnBsYWNlbWVudHM7Ci0JcGxhY2VtZW50LT5udW1fcGxhY2VtZW50ID0g
MTsKLQlwbGFjZW1lbnQtPm51bV9idXN5X3BsYWNlbWVudCA9IDE7Ci19Ci0KLXN0YXRpYyBpbnQg
dmlydGlvX2dwdV92ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCi0J
CQkJICAgIHN0cnVjdCBmaWxlICpmaWxwKQotewotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50
IHZpcnRpb19ncHVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2
LAotCQkJCQkgc3RydWN0IHR0bV9tZW1fcmVnICptZW0pCi17Ci0Jc3RydWN0IHR0bV9tZW1fdHlw
ZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW21lbS0+bWVtX3R5cGVdOwotCi0JbWVtLT5idXMu
YWRkciA9IE5VTEw7Ci0JbWVtLT5idXMub2Zmc2V0ID0gMDsKLQltZW0tPmJ1cy5zaXplID0gbWVt
LT5udW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKLQltZW0tPmJ1cy5iYXNlID0gMDsKLQltZW0tPmJ1
cy5pc19pb21lbSA9IGZhbHNlOwotCWlmICghKG1hbi0+ZmxhZ3MgJiBUVE1fTUVNVFlQRV9GTEFH
X01BUFBBQkxFKSkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0Jc3dpdGNoIChtZW0tPm1lbV90eXBlKSB7
Ci0JY2FzZSBUVE1fUExfU1lTVEVNOgotCWNhc2UgVFRNX1BMX1RUOgotCQkvKiBzeXN0ZW0gbWVt
b3J5ICovCi0JCXJldHVybiAwOwotCWRlZmF1bHQ6Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQly
ZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgdmlydGlvX2dwdV90dG1faW9fbWVtX2ZyZWUoc3Ry
dWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCi0JCQkJICAgICAgIHN0cnVjdCB0dG1fbWVtX3JlZyAq
bWVtKQotewotfQotCi0vKgotICogVFRNIGJhY2tlbmQgZnVuY3Rpb25zLgotICovCi1zdHJ1Y3Qg
dmlydGlvX2dwdV90dG1fdHQgewotCXN0cnVjdCB0dG1fZG1hX3R0CQl0dG07Ci0Jc3RydWN0IHZp
cnRpb19ncHVfb2JqZWN0ICAgICAgICAqb2JqOwotfTsKLQotc3RhdGljIGludCB2aXJ0aW9fZ3B1
X3R0bV90dF9iaW5kKHN0cnVjdCB0dG1fdHQgKnR0bSwKLQkJCQkgIHN0cnVjdCB0dG1fbWVtX3Jl
ZyAqYm9fbWVtKQotewotCXN0cnVjdCB2aXJ0aW9fZ3B1X3R0bV90dCAqZ3R0ID0KLQkJY29udGFp
bmVyX29mKHR0bSwgc3RydWN0IHZpcnRpb19ncHVfdHRtX3R0LCB0dG0udHRtKTsKLQlzdHJ1Y3Qg
dmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2ID0KLQkJdmlydGlvX2dwdV9nZXRfdmdkZXYoZ3R0LT5v
YmotPnRiby5iZGV2KTsKLQotCXZpcnRpb19ncHVfb2JqZWN0X2F0dGFjaCh2Z2RldiwgZ3R0LT5v
YmosIE5VTEwpOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHZpcnRpb19ncHVfdHRtX3R0
X3VuYmluZChzdHJ1Y3QgdHRtX3R0ICp0dG0pCi17Ci0Jc3RydWN0IHZpcnRpb19ncHVfdHRtX3R0
ICpndHQgPQotCQljb250YWluZXJfb2YodHRtLCBzdHJ1Y3QgdmlydGlvX2dwdV90dG1fdHQsIHR0
bS50dG0pOwotCXN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPQotCQl2aXJ0aW9fZ3B1
X2dldF92Z2RldihndHQtPm9iai0+dGJvLmJkZXYpOwotCi0JdmlydGlvX2dwdV9vYmplY3RfZGV0
YWNoKHZnZGV2LCBndHQtPm9iaik7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHZpcnRp
b19ncHVfdHRtX3R0X2Rlc3Ryb3koc3RydWN0IHR0bV90dCAqdHRtKQotewotCXN0cnVjdCB2aXJ0
aW9fZ3B1X3R0bV90dCAqZ3R0ID0KLQkJY29udGFpbmVyX29mKHR0bSwgc3RydWN0IHZpcnRpb19n
cHVfdHRtX3R0LCB0dG0udHRtKTsKLQotCXR0bV9kbWFfdHRfZmluaSgmZ3R0LT50dG0pOwotCWtm
cmVlKGd0dCk7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgdHRtX2JhY2tlbmRfZnVuYyB2aXJ0aW9fZ3B1
X3R0X2Z1bmMgPSB7Ci0JLmJpbmQgPSAmdmlydGlvX2dwdV90dG1fdHRfYmluZCwKLQkudW5iaW5k
ID0gJnZpcnRpb19ncHVfdHRtX3R0X3VuYmluZCwKLQkuZGVzdHJveSA9ICZ2aXJ0aW9fZ3B1X3R0
bV90dF9kZXN0cm95LAotfTsKLQotc3RhdGljIHN0cnVjdCB0dG1fdHQgKnZpcnRpb19ncHVfdHRt
X3R0X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAotCQkJCQkgICAgICAgdWlu
dDMyX3QgcGFnZV9mbGFncykKLXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2Owot
CXN0cnVjdCB2aXJ0aW9fZ3B1X3R0bV90dCAqZ3R0OwotCi0JdmdkZXYgPSB2aXJ0aW9fZ3B1X2dl
dF92Z2Rldihiby0+YmRldik7Ci0JZ3R0ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHZpcnRpb19n
cHVfdHRtX3R0KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKGd0dCA9PSBOVUxMKQotCQlyZXR1cm4gTlVM
TDsKLQlndHQtPnR0bS50dG0uZnVuYyA9ICZ2aXJ0aW9fZ3B1X3R0X2Z1bmM7Ci0JZ3R0LT5vYmog
PSBjb250YWluZXJfb2YoYm8sIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCwgdGJvKTsKLQlpZiAo
dHRtX2RtYV90dF9pbml0KCZndHQtPnR0bSwgYm8sIHBhZ2VfZmxhZ3MpKSB7Ci0JCWtmcmVlKGd0
dCk7Ci0JCXJldHVybiBOVUxMOwotCX0KLQlyZXR1cm4gJmd0dC0+dHRtLnR0bTsKLX0KLQotc3Rh
dGljIHZvaWQgdmlydGlvX2dwdV9ib19zd2FwX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmpl
Y3QgKnRibykKLXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvOwotCi0JYm8gPSBjb250
YWluZXJfb2YodGJvLCBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QsIHRibyk7Ci0KLQlpZiAoYm8t
PnBhZ2VzKQotCQl2aXJ0aW9fZ3B1X29iamVjdF9mcmVlX3NnX3RhYmxlKGJvKTsKLX0KLQotc3Rh
dGljIHN0cnVjdCB0dG1fYm9fZHJpdmVyIHZpcnRpb19ncHVfYm9fZHJpdmVyID0gewotCS50dG1f
dHRfY3JlYXRlID0gJnZpcnRpb19ncHVfdHRtX3R0X2NyZWF0ZSwKLQkuaW52YWxpZGF0ZV9jYWNo
ZXMgPSAmdmlydGlvX2dwdV9pbnZhbGlkYXRlX2NhY2hlcywKLQkuaW5pdF9tZW1fdHlwZSA9ICZ2
aXJ0aW9fZ3B1X2luaXRfbWVtX3R5cGUsCi0JLmV2aWN0aW9uX3ZhbHVhYmxlID0gdHRtX2JvX2V2
aWN0aW9uX3ZhbHVhYmxlLAotCS5ldmljdF9mbGFncyA9ICZ2aXJ0aW9fZ3B1X2V2aWN0X2ZsYWdz
LAotCS52ZXJpZnlfYWNjZXNzID0gJnZpcnRpb19ncHVfdmVyaWZ5X2FjY2VzcywKLQkuaW9fbWVt
X3Jlc2VydmUgPSAmdmlydGlvX2dwdV90dG1faW9fbWVtX3Jlc2VydmUsCi0JLmlvX21lbV9mcmVl
ID0gJnZpcnRpb19ncHVfdHRtX2lvX21lbV9mcmVlLAotCS5zd2FwX25vdGlmeSA9ICZ2aXJ0aW9f
Z3B1X2JvX3N3YXBfbm90aWZ5LAotfTsKLQotaW50IHZpcnRpb19ncHVfdHRtX2luaXQoc3RydWN0
IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldikKLXsKLQlpbnQgcjsKLQotCS8qIE5vIG90aGVycyB1
c2VyIG9mIGFkZHJlc3Mgc3BhY2Ugc28gc2V0IGl0IHRvIDAgKi8KLQlyID0gdHRtX2JvX2Rldmlj
ZV9pbml0KCZ2Z2Rldi0+bW1hbi5iZGV2LAotCQkJICAgICAgICZ2aXJ0aW9fZ3B1X2JvX2RyaXZl
ciwKLQkJCSAgICAgICB2Z2Rldi0+ZGRldi0+YW5vbl9pbm9kZS0+aV9tYXBwaW5nLAotCQkJICAg
ICAgIGZhbHNlKTsKLQlpZiAocikgewotCQlEUk1fRVJST1IoImZhaWxlZCBpbml0aWFsaXppbmcg
YnVmZmVyIG9iamVjdCBkcml2ZXIoJWQpLlxuIiwgcik7Ci0JCWdvdG8gZXJyX2Rldl9pbml0Owot
CX0KLQotCXIgPSB0dG1fYm9faW5pdF9tbSgmdmdkZXYtPm1tYW4uYmRldiwgVFRNX1BMX1RULCAw
KTsKLQlpZiAocikgewotCQlEUk1fRVJST1IoIkZhaWxlZCBpbml0aWFsaXppbmcgR1RUIGhlYXAu
XG4iKTsKLQkJZ290byBlcnJfbW1faW5pdDsKLQl9Ci0JcmV0dXJuIDA7Ci0KLWVycl9tbV9pbml0
OgotCXR0bV9ib19kZXZpY2VfcmVsZWFzZSgmdmdkZXYtPm1tYW4uYmRldik7Ci1lcnJfZGV2X2lu
aXQ6Ci0JcmV0dXJuIHI7Ci19Ci0KLXZvaWQgdmlydGlvX2dwdV90dG1fZmluaShzdHJ1Y3Qgdmly
dGlvX2dwdV9kZXZpY2UgKnZnZGV2KQotewotCXR0bV9ib19kZXZpY2VfcmVsZWFzZSgmdmdkZXYt
Pm1tYW4uYmRldik7Ci0JRFJNX0lORk8oInZpcnRpb19ncHU6IHR0bSBmaW5hbGl6ZWRcbiIpOwot
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMgYi9kcml2
ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYwppbmRleCBkMDA0MzljZTBlZjcuLmVjZjU3
ZGY5NjViMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKQEAgLTk5MywxNyArOTkz
LDIxIEBAIGludCB2aXJ0aW9fZ3B1X29iamVjdF9hdHRhY2goc3RydWN0IHZpcnRpb19ncHVfZGV2
aWNlICp2Z2RldiwKIAlib29sIHVzZV9kbWFfYXBpID0gIXZpcnRpb19oYXNfaW9tbXVfcXVpcmso
dmdkZXYtPnZkZXYpOwogCXN0cnVjdCB2aXJ0aW9fZ3B1X21lbV9lbnRyeSAqZW50czsKIAlzdHJ1
Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCWludCBzaSwgbmVudHM7CisJaW50IHNpLCBuZW50cywgcmV0
OwogCiAJaWYgKFdBUk5fT05fT05DRSghb2JqLT5jcmVhdGVkKSkKIAkJcmV0dXJuIC1FSU5WQUw7
CisJaWYgKFdBUk5fT05fT05DRShvYmotPnBhZ2VzKSkKKwkJcmV0dXJuIC1FSU5WQUw7CiAKLQlp
ZiAoIW9iai0+cGFnZXMpIHsKLQkJaW50IHJldDsKKwlyZXQgPSBkcm1fZ2VtX3NobWVtX3Bpbigm
b2JqLT5iYXNlLmJhc2UpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gLUVJTlZBTDsKIAotCQly
ZXQgPSB2aXJ0aW9fZ3B1X29iamVjdF9nZXRfc2dfdGFibGUodmdkZXYsIG9iaik7Ci0JCWlmIChy
ZXQpCi0JCQlyZXR1cm4gcmV0OworCW9iai0+cGFnZXMgPSBkcm1fZ2VtX3NobWVtX2dldF9zZ190
YWJsZSgmb2JqLT5iYXNlLmJhc2UpOworCWlmIChvYmotPnBhZ2VzID09IE5VTEwpIHsKKwkJZHJt
X2dlbV9zaG1lbV91bnBpbigmb2JqLT5iYXNlLmJhc2UpOworCQlyZXR1cm4gLUVJTlZBTDsKIAl9
CiAKIAlpZiAodXNlX2RtYV9hcGkpIHsKQEAgLTEwNDIsNiArMTA0Niw5IEBAIHZvaWQgdmlydGlv
X2dwdV9vYmplY3RfZGV0YWNoKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiB7CiAJ
Ym9vbCB1c2VfZG1hX2FwaSA9ICF2aXJ0aW9faGFzX2lvbW11X3F1aXJrKHZnZGV2LT52ZGV2KTsK
IAorCWlmIChXQVJOX09OX09OQ0UoIW9iai0+cGFnZXMpKQorCQlyZXR1cm47CisKIAlpZiAodXNl
X2RtYV9hcGkgJiYgb2JqLT5tYXBwZWQpIHsKIAkJc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKmZl
bmNlID0gdmlydGlvX2dwdV9mZW5jZV9hbGxvYyh2Z2Rldik7CiAJCS8qIGRldGFjaCBiYWNraW5n
IGFuZCB3YWl0IGZvciB0aGUgaG9zdCBwcm9jZXNzIGl0IC4uLiAqLwpAQCAtMTA1Nyw2ICsxMDY0
LDExIEBAIHZvaWQgdmlydGlvX2dwdV9vYmplY3RfZGV0YWNoKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rl
dmljZSAqdmdkZXYsCiAJfSBlbHNlIHsKIAkJdmlydGlvX2dwdV9jbWRfcmVzb3VyY2VfaW52YWxf
YmFja2luZyh2Z2Rldiwgb2JqLT5od19yZXNfaGFuZGxlLCBOVUxMKTsKIAl9CisKKwlzZ19mcmVl
X3RhYmxlKG9iai0+cGFnZXMpOworCW9iai0+cGFnZXMgPSBOVUxMOworCisJZHJtX2dlbV9zaG1l
bV91bnBpbigmb2JqLT5iYXNlLmJhc2UpOwogfQogCiB2b2lkIHZpcnRpb19ncHVfY3Vyc29yX3Bp
bmcoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vS2NvbmZpZwpp
bmRleCBiYTM2ZTkzM2JiNDkuLmVmZjMwNDcwNTJkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3ZpcnRpby9LY29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vS2NvbmZpZwpA
QCAtMyw3ICszLDcgQEAgY29uZmlnIERSTV9WSVJUSU9fR1BVCiAJdHJpc3RhdGUgIlZpcnRpbyBH
UFUgZHJpdmVyIgogCWRlcGVuZHMgb24gRFJNICYmIFZJUlRJTyAmJiBNTVUKIAlzZWxlY3QgRFJN
X0tNU19IRUxQRVIKLQlzZWxlY3QgRFJNX1RUTQorCXNlbGVjdCBEUk1fR0VNX1NITUVNX0hFTFBF
UgogCWhlbHAKIAkgICBUaGlzIGlzIHRoZSB2aXJ0dWFsIEdQVSBkcml2ZXIgZm9yIHZpcnRpby4g
IEl0IGNhbiBiZSB1c2VkIHdpdGgKIAkgICBRRU1VIGJhc2VkIFZNTXMgKGxpa2UgS1ZNIG9yIFhl
bikuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby9NYWtlZmlsZQppbmRleCA0NThlNjA2YTkzNmYuLjkyYWEyYjNkMzQ5
ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vdmlydGlvL01ha2VmaWxlCkBAIC00LDcgKzQsNyBAQAogIyBEaXJlY3QgUmVu
ZGVyaW5nIEluZnJhc3RydWN0dXJlIChEUkkpIGluIFhGcmVlODYgNC4xLjAgYW5kIGhpZ2hlci4K
IAogdmlydGlvLWdwdS15IDo9IHZpcnRncHVfZHJ2Lm8gdmlydGdwdV9rbXMubyB2aXJ0Z3B1X2dl
bS5vIFwKLQl2aXJ0Z3B1X2Rpc3BsYXkubyB2aXJ0Z3B1X3ZxLm8gdmlydGdwdV90dG0ubyBcCisJ
dmlydGdwdV9kaXNwbGF5Lm8gdmlydGdwdV92cS5vIFwKIAl2aXJ0Z3B1X2ZlbmNlLm8gdmlydGdw
dV9vYmplY3QubyB2aXJ0Z3B1X2RlYnVnZnMubyB2aXJ0Z3B1X3BsYW5lLm8gXAogCXZpcnRncHVf
aW9jdGwubyB2aXJ0Z3B1X3ByaW1lLm8gdmlydGdwdV90cmFjZV9wb2ludHMubwogCi0tIAoyLjE4
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
