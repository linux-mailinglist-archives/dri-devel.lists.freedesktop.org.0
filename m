Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 57E28148F04
	for <lists+dri-devel@lfdr.de>; Fri, 24 Jan 2020 21:02:59 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 482BE72B9F;
	Fri, 24 Jan 2020 20:02:54 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AD8CC72B9D;
 Fri, 24 Jan 2020 20:02:50 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Jan 2020 12:02:37 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,358,1574150400"; d="scan'208";a="245800394"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga002.jf.intel.com with SMTP; 24 Jan 2020 12:02:35 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 24 Jan 2020 22:02:34 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 2/8] drm/edid: Don't accept any old garbage as a display
 descriptor
Date: Fri, 24 Jan 2020 22:02:25 +0200
Message-Id: <20200124200231.10517-2-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200124200231.10517-1-ville.syrjala@linux.intel.com>
References: <20200124200231.10517-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Allen Chen <allen.chen@ite.com.tw>, intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkN1
cnJlbnRseSB3ZSBhc3N1bWUgYW55IDE4IGJ5dGUgZGVzY3JpcHRvciB0byBiZSBhIGRpc3BsYXkg
ZGVzY3JpdG9yCmlmIG9ubHkgdGhlIHRhZyBieXRlIG1hdGNoZXMgdGhlIGV4cGVjdGVkIHZhbHVl
LiBCdXQgZm9yIGRldGFpbGVkCnRpbWluZyBkZXNjcmlwdG9ycyB0aGF0IHNhbWUgYnl0ZSBpcyBq
dXN0IHRoZSBsb3dlciA4IGJpdHMgb2YKaGJsYW5rLCBhbmQgYXMgc3VjaCBjYW4gbWF0Y2ggYW55
IGRpc3BsYXkgZGVzY3JpcHRvciB0YWcuIFRvCnByb3Blcmx5IHZhbGlkYXRlIHRoYXQgdGhlIDE4
IGJ5dGUgZGVzY3JpcHRvciBpcyBpbiBmYWN0IGEKZGlzcGxheSBkZXNjcmlwdG9yIHdlIG11c3Qg
YWxzbyBleGFtaW5lIGJ5dGVzIDAtMiAoanVzdCBieXRlIDEKc2hvdWxkIGFjdHVhbGx5IHN1ZmZp
Y2UgYnV0IHRoZSBzcGVjIGRvZXMgc2F5IHRoYXQgYnl0ZXMgMCBhbmQKMiBtdXN0IGFsc28gYWx3
YXlzIGJlIHplcm8gZm9yIGRpc3BsYXkgZGVzY3JpcHRvcnMgc28gd2UgY2hlY2sKdGhvc2UgdG9v
KS4KClVubGlrZSBBbGxlbidzIG9yaWdpbmFsIHByb3Bvc2VkIHBhdGNoIHRvIGp1c3QgZml4IGlz
X3JiKCkgd2UKcm9sbCB0aGlzIG91dCBhY3Jvc3MgdGhlIGJvYXJkIHRvIGZpeCBldmVyeXRoaW5n
LgoKQ2M6IEFsbGVuIENoZW4gPGFsbGVuLmNoZW5AaXRlLmNvbS50dz4KU2lnbmVkLW9mZi1ieTog
VmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYyB8IDY1ICsrKysrKysrKysrKysrKysrKysrKysrKy0tLS0t
LS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgMjQgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9lZGlkLmMgYi9kcml2ZXJzL2dw
dS9kcm0vZHJtX2VkaWQuYwppbmRleCAxYjZlNTQ0Y2Y1YzcuLjk2YWUxZmRlNGNlMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9lZGlkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9lZGlkLmMKQEAgLTIxOTYsNiArMjE5NiwxMiBAQCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
ZHJtX21vZGVfZmluZF9kbXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIH0KIEVYUE9SVF9TWU1C
T0woZHJtX21vZGVfZmluZF9kbXQpOwogCitzdGF0aWMgYm9vbCBpc19kaXNwbGF5X2Rlc2NyaXB0
b3IoY29uc3QgdTggZFsxOF0sIHU4IHRhZykKK3sKKwlyZXR1cm4gZFswXSA9PSAweDAwICYmIGRb
MV0gPT0gMHgwMCAmJgorCQlkWzJdID09IDB4MDAgJiYgZFszXSA9PSB0YWc7Cit9CisKIHR5cGVk
ZWYgdm9pZCBkZXRhaWxlZF9jYihzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZvaWQg
KmNsb3N1cmUpOwogCiBzdGF0aWMgdm9pZApAQCAtMjI1Nyw5ICsyMjYzLDEyIEBAIHN0YXRpYyB2
b2lkCiBpc19yYihzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0LCB2b2lkICpkYXRhKQogewogCXU4
ICpyID0gKHU4ICopdDsKLQlpZiAoclszXSA9PSBFRElEX0RFVEFJTF9NT05JVE9SX1JBTkdFKQot
CQlpZiAoclsxNV0gJiAweDEwKQotCQkJKihib29sICopZGF0YSA9IHRydWU7CisKKwlpZiAoIWlz
X2Rpc3BsYXlfZGVzY3JpcHRvcihyLCBFRElEX0RFVEFJTF9NT05JVE9SX1JBTkdFKSkKKwkJcmV0
dXJuOworCisJaWYgKHJbMTVdICYgMHgxMCkKKwkJKihib29sICopZGF0YSA9IHRydWU7CiB9CiAK
IC8qIEVESUQgMS40IGRlZmluZXMgdGhpcyBleHBsaWNpdGx5LiAgRm9yIEVESUQgMS4zLCB3ZSBn
dWVzcywgYmFkbHkuICovCkBAIC0yMjc5LDcgKzIyODgsMTEgQEAgc3RhdGljIHZvaWQKIGZpbmRf
Z3RmMihzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0LCB2b2lkICpkYXRhKQogewogCXU4ICpyID0g
KHU4ICopdDsKLQlpZiAoclszXSA9PSBFRElEX0RFVEFJTF9NT05JVE9SX1JBTkdFICYmIHJbMTBd
ID09IDB4MDIpCisKKwlpZiAoIWlzX2Rpc3BsYXlfZGVzY3JpcHRvcihyLCBFRElEX0RFVEFJTF9N
T05JVE9SX1JBTkdFKSkKKwkJcmV0dXJuOworCisJaWYgKHJbMTBdID09IDB4MDIpCiAJCSoodTgg
KiopZGF0YSA9IHI7CiB9CiAKQEAgLTI4MTgsNyArMjgzMSw3IEBAIGRvX2luZmVycmVkX21vZGVz
KHN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZywgdm9pZCAqYykKIAlzdHJ1Y3QgZGV0YWls
ZWRfbm9uX3BpeGVsICpkYXRhID0gJnRpbWluZy0+ZGF0YS5vdGhlcl9kYXRhOwogCXN0cnVjdCBk
ZXRhaWxlZF9kYXRhX21vbml0b3JfcmFuZ2UgKnJhbmdlID0gJmRhdGEtPmRhdGEucmFuZ2U7CiAK
LQlpZiAoZGF0YS0+dHlwZSAhPSBFRElEX0RFVEFJTF9NT05JVE9SX1JBTkdFKQorCWlmICghaXNf
ZGlzcGxheV9kZXNjcmlwdG9yKChjb25zdCB1OCAqKXRpbWluZywgRURJRF9ERVRBSUxfTU9OSVRP
Ul9SQU5HRSkpCiAJCXJldHVybjsKIAogCWNsb3N1cmUtPm1vZGVzICs9IGRybV9kbXRfbW9kZXNf
Zm9yX3JhbmdlKGNsb3N1cmUtPmNvbm5lY3RvciwKQEAgLTI4OTcsMTAgKzI5MTAsMTEgQEAgc3Rh
dGljIHZvaWQKIGRvX2VzdGFibGlzaGVkX21vZGVzKHN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRp
bWluZywgdm9pZCAqYykKIHsKIAlzdHJ1Y3QgZGV0YWlsZWRfbW9kZV9jbG9zdXJlICpjbG9zdXJl
ID0gYzsKLQlzdHJ1Y3QgZGV0YWlsZWRfbm9uX3BpeGVsICpkYXRhID0gJnRpbWluZy0+ZGF0YS5v
dGhlcl9kYXRhOwogCi0JaWYgKGRhdGEtPnR5cGUgPT0gRURJRF9ERVRBSUxfRVNUX1RJTUlOR1Mp
Ci0JCWNsb3N1cmUtPm1vZGVzICs9IGRybV9lc3QzX21vZGVzKGNsb3N1cmUtPmNvbm5lY3Rvciwg
dGltaW5nKTsKKwlpZiAoIWlzX2Rpc3BsYXlfZGVzY3JpcHRvcigoY29uc3QgdTggKil0aW1pbmcs
IEVESURfREVUQUlMX0VTVF9USU1JTkdTKSkKKwkJcmV0dXJuOworCisJY2xvc3VyZS0+bW9kZXMg
Kz0gZHJtX2VzdDNfbW9kZXMoY2xvc3VyZS0+Y29ubmVjdG9yLCB0aW1pbmcpOwogfQogCiAvKioK
QEAgLTI5NDksMTkgKzI5NjMsMTkgQEAgZG9fc3RhbmRhcmRfbW9kZXMoc3RydWN0IGRldGFpbGVk
X3RpbWluZyAqdGltaW5nLCB2b2lkICpjKQogCXN0cnVjdCBkZXRhaWxlZF9ub25fcGl4ZWwgKmRh
dGEgPSAmdGltaW5nLT5kYXRhLm90aGVyX2RhdGE7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvciA9IGNsb3N1cmUtPmNvbm5lY3RvcjsKIAlzdHJ1Y3QgZWRpZCAqZWRpZCA9IGNsb3N1
cmUtPmVkaWQ7CisJaW50IGk7CiAKLQlpZiAoZGF0YS0+dHlwZSA9PSBFRElEX0RFVEFJTF9TVERf
TU9ERVMpIHsKLQkJaW50IGk7Ci0JCWZvciAoaSA9IDA7IGkgPCA2OyBpKyspIHsKLQkJCXN0cnVj
dCBzdGRfdGltaW5nICpzdGQ7Ci0JCQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbmV3bW9kZTsK
KwlpZiAoIWlzX2Rpc3BsYXlfZGVzY3JpcHRvcigoY29uc3QgdTggKil0aW1pbmcsIEVESURfREVU
QUlMX1NURF9NT0RFUykpCisJCXJldHVybjsKIAotCQkJc3RkID0gJmRhdGEtPmRhdGEudGltaW5n
c1tpXTsKLQkJCW5ld21vZGUgPSBkcm1fbW9kZV9zdGQoY29ubmVjdG9yLCBlZGlkLCBzdGQpOwot
CQkJaWYgKG5ld21vZGUpIHsKLQkJCQlkcm1fbW9kZV9wcm9iZWRfYWRkKGNvbm5lY3RvciwgbmV3
bW9kZSk7Ci0JCQkJY2xvc3VyZS0+bW9kZXMrKzsKLQkJCX0KKwlmb3IgKGkgPSAwOyBpIDwgNjsg
aSsrKSB7CisJCXN0cnVjdCBzdGRfdGltaW5nICpzdGQgPSAmZGF0YS0+ZGF0YS50aW1pbmdzW2ld
OworCQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbmV3bW9kZTsKKworCQluZXdtb2RlID0gZHJt
X21vZGVfc3RkKGNvbm5lY3RvciwgZWRpZCwgc3RkKTsKKwkJaWYgKG5ld21vZGUpIHsKKwkJCWRy
bV9tb2RlX3Byb2JlZF9hZGQoY29ubmVjdG9yLCBuZXdtb2RlKTsKKwkJCWNsb3N1cmUtPm1vZGVz
Kys7CiAJCX0KIAl9CiB9CkBAIC0zMDU2LDEwICszMDcwLDExIEBAIHN0YXRpYyB2b2lkCiBkb19j
dnRfbW9kZShzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZvaWQgKmMpCiB7CiAJc3Ry
dWN0IGRldGFpbGVkX21vZGVfY2xvc3VyZSAqY2xvc3VyZSA9IGM7Ci0Jc3RydWN0IGRldGFpbGVk
X25vbl9waXhlbCAqZGF0YSA9ICZ0aW1pbmctPmRhdGEub3RoZXJfZGF0YTsKIAotCWlmIChkYXRh
LT50eXBlID09IEVESURfREVUQUlMX0NWVF8zQllURSkKLQkJY2xvc3VyZS0+bW9kZXMgKz0gZHJt
X2N2dF9tb2RlcyhjbG9zdXJlLT5jb25uZWN0b3IsIHRpbWluZyk7CisJaWYgKCFpc19kaXNwbGF5
X2Rlc2NyaXB0b3IoKGNvbnN0IHU4ICopdGltaW5nLCBFRElEX0RFVEFJTF9DVlRfM0JZVEUpKQor
CQlyZXR1cm47CisKKwljbG9zdXJlLT5tb2RlcyArPSBkcm1fY3Z0X21vZGVzKGNsb3N1cmUtPmNv
bm5lY3RvciwgdGltaW5nKTsKIH0KIAogc3RhdGljIGludApAQCAtNDI4NSw4ICs0MzAwLDEwIEBA
IGRybV9wYXJzZV9oZG1pX3ZzZGJfYXVkaW8oc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rv
ciwgY29uc3QgdTggKmRiKQogc3RhdGljIHZvaWQKIG1vbml0b3JfbmFtZShzdHJ1Y3QgZGV0YWls
ZWRfdGltaW5nICp0LCB2b2lkICpkYXRhKQogewotCWlmICh0LT5kYXRhLm90aGVyX2RhdGEudHlw
ZSA9PSBFRElEX0RFVEFJTF9NT05JVE9SX05BTUUpCi0JCSoodTggKiopZGF0YSA9IHQtPmRhdGEu
b3RoZXJfZGF0YS5kYXRhLnN0ci5zdHI7CisJaWYgKCFpc19kaXNwbGF5X2Rlc2NyaXB0b3IoKGNv
bnN0IHU4ICopdCwgRURJRF9ERVRBSUxfTU9OSVRPUl9OQU1FKSkKKwkJcmV0dXJuOworCisJKih1
OCAqKilkYXRhID0gdC0+ZGF0YS5vdGhlcl9kYXRhLmRhdGEuc3RyLnN0cjsKIH0KIAogc3RhdGlj
IGludCBnZXRfbW9uaXRvcl9uYW1lKHN0cnVjdCBlZGlkICplZGlkLCBjaGFyIG5hbWVbMTNdKQot
LSAKMi4yNC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
