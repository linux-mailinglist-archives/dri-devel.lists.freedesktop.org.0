Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6ED1C87394
	for <lists+dri-devel@lfdr.de>; Fri,  9 Aug 2019 10:00:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BAFFB6ED15;
	Fri,  9 Aug 2019 08:00:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id BEC366E830
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Aug 2019 13:37:36 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 6812215A2;
 Thu,  8 Aug 2019 06:37:36 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 2B8C13F694;
 Thu,  8 Aug 2019 06:37:35 -0700 (PDT)
Subject: Re: [PATCH v3 7/8] drm/panfrost: Add support for GPU heap allocations
To: Rob Herring <robh@kernel.org>, dri-devel@lists.freedesktop.org
References: <20190802195150.23207-1-robh@kernel.org>
 <20190802195150.23207-8-robh@kernel.org>
From: Steven Price <steven.price@arm.com>
Message-ID: <a2f1f452-534c-ff46-6a21-874c992a3d91@arm.com>
Date: Thu, 8 Aug 2019 14:37:34 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190802195150.23207-8-robh@kernel.org>
Content-Language: en-GB
X-Mailman-Approved-At: Fri, 09 Aug 2019 08:00:16 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Robin Murphy <robin.murphy@arm.com>,
 David Airlie <airlied@linux.ie>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMDIvMDgvMjAxOSAyMDo1MSwgUm9iIEhlcnJpbmcgd3JvdGU6Cj4gVGhlIG1pZGdhcmQvYmlm
cm9zdCBHUFVzIG5lZWQgdG8gYWxsb2NhdGUgR1BVIGhlYXAgbWVtb3J5IHdoaWNoIGlzCj4gYWxs
b2NhdGVkIG9uIEdQVSBwYWdlIGZhdWx0cyBhbmQgbm90IHBpbm5lZCBpbiBtZW1vcnkuIFRoZSB2
ZW5kb3IgZHJpdmVyCj4gY2FsbHMgdGhpcyBmdW5jdGlvbmFsaXR5IEdST1dfT05fR1BGLgo+IAo+
IFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGF0IEJPcyBhbGxvY2F0ZWQgd2l0aCB0aGUK
PiBQQU5GUk9TVF9CT19OT0VYRUMgZmxhZyBhcmUgbmV2ZXIgbW1hcHBlZCBvciBleHBvcnRlZC4g
Qm90aCBvZiB0aG9zZSBtYXkKPiBhY3R1YWxseSB3b3JrLCBidXQgSSdtIHVuc3VyZSBpZiB0aGVy
ZSdzIHNvbWUgaW50ZXJhY3Rpb24gdGhlcmUuIEl0Cj4gd291bGQgY2F1c2UgdGhlIHdob2xlIG9i
amVjdCB0byBiZSBwaW5uZWQgaW4gbWVtb3J5IHdoaWNoIHdvdWxkIGRlZmVhdAo+IHRoZSBwb2lu
dCBvZiB0aGlzLgo+IAo+IE9uIGZhdWx0cywgd2UgbWFwIGluIDJNQiBhdCBhIHRpbWUgaW4gb3Jk
ZXIgdG8gdXRpbGl6ZSBodWdlIHBhZ2VzIChpZgo+IGVuYWJsZWQpLiBDdXJyZW50bHksIG9uY2Ug
d2UndmUgbWFwcGVkIHBhZ2VzIGluLCB0aGV5IGFyZSBvbmx5IHVubWFwcGVkCj4gaWYgdGhlIEJP
IGlzIGZyZWVkLiBPbmNlIHdlIGFkZCBzaHJpbmtlciBzdXBwb3J0LCB3ZSBjYW4gdW5tYXAgcGFn
ZXMKPiB3aXRoIHRoZSBzaHJpbmtlci4KPiAKPiBDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpv
c29AY29sbGFib3JhLmNvbT4KPiBDYzogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25A
Y29sbGFib3JhLmNvbT4KPiBDYzogUm9iaW4gTXVycGh5IDxyb2Jpbi5tdXJwaHlAYXJtLmNvbT4K
PiBDYzogU3RldmVuIFByaWNlIDxzdGV2ZW4ucHJpY2VAYXJtLmNvbT4KPiBBY2tlZC1ieTogQWx5
c3NhIFJvc2VuendlaWcgPGFseXNzYS5yb3Nlbnp3ZWlnQGNvbGxhYm9yYS5jb20+Cj4gU2lnbmVk
LW9mZi1ieTogUm9iIEhlcnJpbmcgPHJvYmhAa2VybmVsLm9yZz4KCkkgY2FuIG5vIGxvbmdlciB0
cmlnZ2VyIGEgbWVtb3J5IGxlYWsgb3IgY3Jhc2guLi4gOikKClJldmlld2VkLWJ5OiBTdGV2ZW4g
UHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgoKU3RldmUKCj4gLS0tCj4gIGRyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9UT0RPICAgICAgICAgICB8ICAgMiAtCj4gIGRyaXZlcnMvZ3B1L2RybS9w
YW5mcm9zdC9wYW5mcm9zdF9kcnYuYyB8ICAxMSArLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvcGFuZnJvc3RfZ2VtLmMgfCAgMzYgKysrKysrLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvcGFuZnJvc3RfZ2VtLmggfCAgIDggKysKPiAgZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X21tdS5jIHwgMTI5ICsrKysrKysrKysrKysrKysrKysrKystLQo+ICBpbmNsdWRlL3Vh
cGkvZHJtL3BhbmZyb3N0X2RybS5oICAgICAgICAgfCAgIDEgKwo+ICA2IGZpbGVzIGNoYW5nZWQs
IDE3MiBpbnNlcnRpb25zKCspLCAxNSBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3BhbmZyb3N0L1RPRE8gYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvVE9E
Two+IGluZGV4IGMyZTQ0YWRkMzdkOC4uNjQxMjliZjczOTMzIDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9UT0RPCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L1RPRE8KPiBAQCAtMTQsOCArMTQsNiBAQAo+ICAgIFRoZSBoYXJkIHBhcnQgaXMgaGFuZGxpbmcg
d2hlbiBtb3JlIGFkZHJlc3Mgc3BhY2VzIGFyZSBuZWVkZWQgdGhhbiB3aGF0Cj4gICAgdGhlIGgv
dyBwcm92aWRlcy4KPiAgCj4gLS0gU3VwcG9ydCBwaW5uaW5nIHBhZ2VzIG9uIGRlbWFuZCAoR1BV
IHBhZ2UgZmF1bHRzKS4KPiAtCj4gIC0gU3VwcG9ydCB1c2Vyc3BhY2UgY29udHJvbGxlZCBHUFUg
dmlydHVhbCBhZGRyZXNzZXMuIE5lZWRlZCBmb3IgVnVsa2FuLiAoVG9tZXUpCj4gIAo+ICAtIFN1
cHBvcnQgZm9yIG1hZHZpc2UgYW5kIGEgc2hyaW5rZXIuCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9wYW5mcm9zdF9kcnYuYwo+IGluZGV4IDdlYmQ4MmQ4ZDU3MC4uYTcxMjZiNWY4ZTVkIDEwMDY0
NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYwo+ICsrKyBi
L2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYwo+IEBAIC01MCw3ICs1MCwx
MiBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X2lvY3RsX2NyZWF0ZV9ibyhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAo+ICAJc3RydWN0IGRybV9wYW5mcm9zdF9jcmVhdGVfYm8gKmFy
Z3MgPSBkYXRhOwo+ICAKPiAgCWlmICghYXJncy0+c2l6ZSB8fCBhcmdzLT5wYWQgfHwKPiAtCSAg
ICAoYXJncy0+ZmxhZ3MgJiB+UEFORlJPU1RfQk9fTk9FWEVDKSkKPiArCSAgICAoYXJncy0+Zmxh
Z3MgJiB+KFBBTkZST1NUX0JPX05PRVhFQyB8IFBBTkZST1NUX0JPX0hFQVApKSkKPiArCQlyZXR1
cm4gLUVJTlZBTDsKPiArCj4gKwkvKiBIZWFwcyBzaG91bGQgbmV2ZXIgYmUgZXhlY3V0YWJsZSAq
Lwo+ICsJaWYgKChhcmdzLT5mbGFncyAmIFBBTkZST1NUX0JPX0hFQVApICYmCj4gKwkgICAgIShh
cmdzLT5mbGFncyAmIFBBTkZST1NUX0JPX05PRVhFQykpCj4gIAkJcmV0dXJuIC1FSU5WQUw7Cj4g
IAo+ICAJYm8gPSBwYW5mcm9zdF9nZW1fY3JlYXRlX3dpdGhfaGFuZGxlKGZpbGUsIGRldiwgYXJn
cy0+c2l6ZSwgYXJncy0+ZmxhZ3MsCj4gQEAgLTI2NSw2ICsyNzAsMTAgQEAgc3RhdGljIGludCBw
YW5mcm9zdF9pb2N0bF9tbWFwX2JvKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
Cj4gIAkJcmV0dXJuIC1FTk9FTlQ7Cj4gIAl9Cj4gIAo+ICsJLyogRG9uJ3QgYWxsb3cgbW1hcHBp
bmcgb2YgaGVhcCBvYmplY3RzIGFzIHBhZ2VzIGFyZSBub3QgcGlubmVkLiAqLwo+ICsJaWYgKHRv
X3BhbmZyb3N0X2JvKGdlbV9vYmopLT5pc19oZWFwKQo+ICsJCXJldHVybiAtRUlOVkFMOwo+ICsK
PiAgCXJldCA9IGRybV9nZW1fY3JlYXRlX21tYXBfb2Zmc2V0KGdlbV9vYmopOwo+ICAJaWYgKHJl
dCA9PSAwKQo+ICAJCWFyZ3MtPm9mZnNldCA9IGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcigmZ2Vt
X29iai0+dm1hX25vZGUpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3RfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMK
PiBpbmRleCA2MzczMWY2YzUyMjMuLmYzZDVmNjE3MTRhZSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0v
cGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMKPiBAQCAtMjcsMTMgKzI3LDM1IEBAIHN0YXRpYyB2b2lk
IHBhbmZyb3N0X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKPiAg
CQlkcm1fbW1fcmVtb3ZlX25vZGUoJmJvLT5ub2RlKTsKPiAgCXNwaW5fdW5sb2NrKCZwZmRldi0+
bW1fbG9jayk7Cj4gIAo+ICsJaWYgKGJvLT5zZ3RzKSB7Cj4gKwkJaW50IGk7Cj4gKwkJaW50IG5f
c2d0ID0gYm8tPmJhc2UuYmFzZS5zaXplIC8gU1pfMk07Cj4gKwo+ICsJCWZvciAoaSA9IDA7IGkg
PCBuX3NndDsgaSsrKSB7Cj4gKwkJCWlmIChiby0+c2d0c1tpXS5zZ2wpIHsKPiArCQkJCWRtYV91
bm1hcF9zZyhwZmRldi0+ZGV2LCBiby0+c2d0c1tpXS5zZ2wsCj4gKwkJCQkJICAgICBiby0+c2d0
c1tpXS5uZW50cywgRE1BX0JJRElSRUNUSU9OQUwpOwo+ICsJCQkJc2dfZnJlZV90YWJsZSgmYm8t
PnNndHNbaV0pOwo+ICsJCQl9Cj4gKwkJfQo+ICsJCWtmcmVlKGJvLT5zZ3RzKTsKPiArCX0KPiAr
Cj4gIAlkcm1fZ2VtX3NobWVtX2ZyZWVfb2JqZWN0KG9iaik7Cj4gIH0KPiAgCj4gK3N0YXRpYyBp
bnQgcGFuZnJvc3RfZ2VtX3BpbihzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKPiArewo+ICsJ
aWYgKHRvX3BhbmZyb3N0X2JvKG9iaiktPmlzX2hlYXApCj4gKwkJcmV0dXJuIC1FSU5WQUw7Cj4g
Kwo+ICsJcmV0dXJuIGRybV9nZW1fc2htZW1fcGluKG9iaik7Cj4gK30KPiArCj4gIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3RfZnVuY3MgcGFuZnJvc3RfZ2VtX2Z1bmNzID0gewo+
ICAJLmZyZWUgPSBwYW5mcm9zdF9nZW1fZnJlZV9vYmplY3QsCj4gIAkucHJpbnRfaW5mbyA9IGRy
bV9nZW1fc2htZW1fcHJpbnRfaW5mbywKPiAtCS5waW4gPSBkcm1fZ2VtX3NobWVtX3BpbiwKPiAr
CS5waW4gPSBwYW5mcm9zdF9nZW1fcGluLAo+ICAJLnVucGluID0gZHJtX2dlbV9zaG1lbV91bnBp
biwKPiAgCS5nZXRfc2dfdGFibGUgPSBkcm1fZ2VtX3NobWVtX2dldF9zZ190YWJsZSwKPiAgCS52
bWFwID0gZHJtX2dlbV9zaG1lbV92bWFwLAo+IEBAIC04Nyw3ICsxMDksMTAgQEAgc3RhdGljIGlu
dCBwYW5mcm9zdF9nZW1fbWFwKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBzdHJ1Y3Qg
cGFuZnJvc3RfZ2VtX28KPiAgCWlmIChyZXQpCj4gIAkJcmV0dXJuIHJldDsKPiAgCj4gLQlyZXR1
cm4gcGFuZnJvc3RfbW11X21hcChibyk7Cj4gKwlpZiAoIWJvLT5pc19oZWFwKQo+ICsJCXJldCA9
IHBhbmZyb3N0X21tdV9tYXAoYm8pOwo+ICsKPiArCXJldHVybiByZXQ7Cj4gIH0KPiAgCj4gIHN0
cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICoKPiBAQCAtMTAxLDcgKzEyNiwxMSBAQCBwYW5mcm9z
dF9nZW1fY3JlYXRlX3dpdGhfaGFuZGxlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAo+ICAJ
c3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0ICpzaG1lbTsKPiAgCXN0cnVjdCBwYW5mcm9zdF9n
ZW1fb2JqZWN0ICpibzsKPiAgCj4gLQlzaXplID0gcm91bmR1cChzaXplLCBQQUdFX1NJWkUpOwo+
ICsJLyogUm91bmQgdXAgaGVhcCBhbGxvY2F0aW9ucyB0byAyTUIgdG8ga2VlcCBmYXVsdCBoYW5k
bGluZyBzaW1wbGUgKi8KPiArCWlmIChmbGFncyAmIFBBTkZST1NUX0JPX0hFQVApCj4gKwkJc2l6
ZSA9IHJvdW5kdXAoc2l6ZSwgU1pfMk0pOwo+ICsJZWxzZQo+ICsJCXNpemUgPSByb3VuZHVwKHNp
emUsIFBBR0VfU0laRSk7Cj4gIAo+ICAJc2htZW0gPSBkcm1fZ2VtX3NobWVtX2NyZWF0ZV93aXRo
X2hhbmRsZShmaWxlX3ByaXYsIGRldiwgc2l6ZSwgaGFuZGxlKTsKPiAgCWlmIChJU19FUlIoc2ht
ZW0pKQo+IEBAIC0xMDksNiArMTM4LDcgQEAgcGFuZnJvc3RfZ2VtX2NyZWF0ZV93aXRoX2hhbmRs
ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwKPiAgCj4gIAlibyA9IHRvX3BhbmZyb3N0X2Jv
KCZzaG1lbS0+YmFzZSk7Cj4gIAliby0+bm9leGVjID0gISEoZmxhZ3MgJiBQQU5GUk9TVF9CT19O
T0VYRUMpOwo+ICsJYm8tPmlzX2hlYXAgPSAhIShmbGFncyAmIFBBTkZST1NUX0JPX0hFQVApOwo+
ICAKPiAgCXJldCA9IHBhbmZyb3N0X2dlbV9tYXAocGZkZXYsIGJvKTsKPiAgCWlmIChyZXQpCj4g
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaCBiL2Ry
aXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaAo+IGluZGV4IDEzMmYwMjM5OWI3
Yi4uYjYyOGM5YjY3Nzg0IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9w
YW5mcm9zdF9nZW0uaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9n
ZW0uaAo+IEBAIC05LDEwICs5LDEyIEBACj4gIAo+ICBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVj
dCB7Cj4gIAlzdHJ1Y3QgZHJtX2dlbV9zaG1lbV9vYmplY3QgYmFzZTsKPiArCXN0cnVjdCBzZ190
YWJsZSAqc2d0czsKPiAgCj4gIAlzdHJ1Y3QgZHJtX21tX25vZGUgbm9kZTsKPiAgCWJvb2wgaXNf
bWFwcGVkCQk6MTsKPiAgCWJvb2wgbm9leGVjCQk6MTsKPiArCWJvb2wgaXNfaGVhcAkJOjE7Cj4g
IH07Cj4gIAo+ICBzdGF0aWMgaW5saW5lCj4gQEAgLTIxLDYgKzIzLDEyIEBAIHN0cnVjdCAgcGFu
ZnJvc3RfZ2VtX29iamVjdCAqdG9fcGFuZnJvc3RfYm8oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpv
YmopCj4gIAlyZXR1cm4gY29udGFpbmVyX29mKHRvX2RybV9nZW1fc2htZW1fb2JqKG9iaiksIHN0
cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0LCBiYXNlKTsKPiAgfQo+ICAKPiArc3RhdGljIGlubGlu
ZQo+ICtzdHJ1Y3QgIHBhbmZyb3N0X2dlbV9vYmplY3QgKmRybV9tbV9ub2RlX3RvX3BhbmZyb3N0
X2JvKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKPiArewo+ICsJcmV0dXJuIGNvbnRhaW5lcl9v
Zihub2RlLCBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCwgbm9kZSk7Cj4gK30KPiArCj4gIHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqcGFuZnJvc3RfZ2VtX2NyZWF0ZV9vYmplY3Qoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgc2l6ZV90IHNpemUpOwo+ICAKPiAgc3RydWN0IHBhbmZyb3N0X2dlbV9v
YmplY3QgKgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rf
bW11LmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiBpbmRleCA3
ZDQ0MzI4YjI4MGYuLmFhODNiZjQ2MzYwYiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
cGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3RfbW11LmMKPiBAQCAtMiw2ICsyLDcgQEAKPiAgLyogQ29weXJpZ2h0IDIwMTkgTGlu
YXJvLCBMdGQsIFJvYiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+ICovCj4gICNpbmNsdWRlIDxs
aW51eC9iaXRmaWVsZC5oPgo+ICAjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KPiArI2luY2x1ZGUg
PGxpbnV4L2RtYS1tYXBwaW5nLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KPiAg
I2luY2x1ZGUgPGxpbnV4L2lvLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9pb3BvbGwuaD4KPiBAQCAt
OSw2ICsxMCw3IEBACj4gICNpbmNsdWRlIDxsaW51eC9pb21tdS5oPgo+ICAjaW5jbHVkZSA8bGlu
dXgvcGxhdGZvcm1fZGV2aWNlLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9wbV9ydW50aW1lLmg+Cj4g
KyNpbmNsdWRlIDxsaW51eC9zaG1lbV9mcy5oPgo+ICAjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4K
PiAgCj4gICNpbmNsdWRlICJwYW5mcm9zdF9kZXZpY2UuaCIKPiBAQCAtMjM1LDEyICsyMzcsMTIg
QEAgdm9pZCBwYW5mcm9zdF9tbXVfdW5tYXAoc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJv
KQo+ICAJCXNpemVfdCB1bm1hcHBlZF9wYWdlOwo+ICAJCXNpemVfdCBwZ3NpemUgPSBnZXRfcGdz
aXplKGlvdmEsIGxlbiAtIHVubWFwcGVkX2xlbik7Cj4gIAo+IC0JCXVubWFwcGVkX3BhZ2UgPSBv
cHMtPnVubWFwKG9wcywgaW92YSwgcGdzaXplKTsKPiAtCQlpZiAoIXVubWFwcGVkX3BhZ2UpCj4g
LQkJCWJyZWFrOwo+IC0KPiAtCQlpb3ZhICs9IHVubWFwcGVkX3BhZ2U7Cj4gLQkJdW5tYXBwZWRf
bGVuICs9IHVubWFwcGVkX3BhZ2U7Cj4gKwkJaWYgKG9wcy0+aW92YV90b19waHlzKG9wcywgaW92
YSkpIHsKPiArCQkJdW5tYXBwZWRfcGFnZSA9IG9wcy0+dW5tYXAob3BzLCBpb3ZhLCBwZ3NpemUp
Owo+ICsJCQlXQVJOX09OKHVubWFwcGVkX3BhZ2UgIT0gcGdzaXplKTsKPiArCQl9Cj4gKwkJaW92
YSArPSBwZ3NpemU7Cj4gKwkJdW5tYXBwZWRfbGVuICs9IHBnc2l6ZTsKPiAgCX0KPiAgCj4gIAlt
bXVfaHdfZG9fb3BlcmF0aW9uKHBmZGV2LCAwLCBiby0+bm9kZS5zdGFydCA8PCBQQUdFX1NISUZU
LAo+IEBAIC0yNzYsNiArMjc4LDEwNSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGlvbW11X2dhdGhl
cl9vcHMgbW11X3RsYl9vcHMgPSB7Cj4gIAkudGxiX3N5bmMJPSBtbXVfdGxiX3N5bmNfY29udGV4
dCwKPiAgfTsKPiAgCj4gK3N0YXRpYyBzdHJ1Y3QgZHJtX21tX25vZGUgKmFkZHJfdG9fZHJtX21t
X25vZGUoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4g
K3sKPiArCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZTsKPiArCXU2NCBvZmZzZXQgPSBhZGRyID4+
IFBBR0VfU0hJRlQ7Cj4gKwo+ICsJZHJtX21tX2Zvcl9lYWNoX25vZGUobm9kZSwgJnBmZGV2LT5t
bSkgewo+ICsJCWlmIChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYgb2Zmc2V0IDwgKG5vZGUtPnN0
YXJ0ICsgbm9kZS0+c2l6ZSkpCj4gKwkJCXJldHVybiBub2RlOwo+ICsJfQo+ICsJcmV0dXJuIE5V
TEw7Cj4gK30KPiArCj4gKyNkZWZpbmUgTlVNX0ZBVUxUX1BBR0VTIChTWl8yTSAvIFBBR0VfU0la
RSkKPiArCj4gK2ludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0
X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiArCWludCByZXQsIGk7Cj4g
KwlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGU7Cj4gKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVj
dCAqYm87Cj4gKwlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZzsKPiArCXBnb2ZmX3QgcGFn
ZV9vZmZzZXQ7Cj4gKwlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKPiArCXN0cnVjdCBwYWdlICoqcGFn
ZXM7Cj4gKwo+ICsJbm9kZSA9IGFkZHJfdG9fZHJtX21tX25vZGUocGZkZXYsIGFzLCBhZGRyKTsK
PiArCWlmICghbm9kZSkKPiArCQlyZXR1cm4gLUVOT0VOVDsKPiArCj4gKwlibyA9IGRybV9tbV9u
b2RlX3RvX3BhbmZyb3N0X2JvKG5vZGUpOwo+ICsJaWYgKCFiby0+aXNfaGVhcCkgewo+ICsJCWRl
dl9XQVJOKHBmZGV2LT5kZXYsICJtYXRjaGluZyBCTyBpcyBub3QgaGVhcCB0eXBlIChHUFUgVkEg
PSAlbGx4KSIsCj4gKwkJCSBub2RlLT5zdGFydCA8PCBQQUdFX1NISUZUKTsKPiArCQlyZXR1cm4g
LUVJTlZBTDsKPiArCX0KPiArCS8qIEFzc3VtZSAyTUIgYWxpZ25tZW50IGFuZCBzaXplIG11bHRp
cGxlICovCj4gKwlhZGRyICY9IH4oKHU2NClTWl8yTSAtIDEpOwo+ICsJcGFnZV9vZmZzZXQgPSBh
ZGRyID4+IFBBR0VfU0hJRlQ7Cj4gKwlwYWdlX29mZnNldCAtPSBub2RlLT5zdGFydDsKPiArCj4g
KwltdXRleF9sb2NrKCZiby0+YmFzZS5wYWdlc19sb2NrKTsKPiArCj4gKwlpZiAoIWJvLT5iYXNl
LnBhZ2VzKSB7Cj4gKwkJYm8tPnNndHMgPSBrdm1hbGxvY19hcnJheShiby0+YmFzZS5iYXNlLnNp
emUgLyBTWl8yTSwKPiArCQkJCSAgICAgc2l6ZW9mKHN0cnVjdCBzZ190YWJsZSksIEdGUF9LRVJO
RUwgfCBfX0dGUF9aRVJPKTsKPiArCQlpZiAoIWJvLT5zZ3RzKQo+ICsJCQlyZXR1cm4gLUVOT01F
TTsKPiArCj4gKwkJcGFnZXMgPSBrdm1hbGxvY19hcnJheShiby0+YmFzZS5iYXNlLnNpemUgPj4g
UEFHRV9TSElGVCwKPiArCQkJCSAgICAgICBzaXplb2Yoc3RydWN0IHBhZ2UgKiksIEdGUF9LRVJO
RUwgfCBfX0dGUF9aRVJPKTsKPiArCQlpZiAoIXBhZ2VzKSB7Cj4gKwkJCWtmcmVlKGJvLT5zZ3Rz
KTsKPiArCQkJYm8tPnNndHMgPSBOVUxMOwo+ICsJCQlyZXR1cm4gLUVOT01FTTsKPiArCQl9Cj4g
KwkJYm8tPmJhc2UucGFnZXMgPSBwYWdlczsKPiArCQliby0+YmFzZS5wYWdlc191c2VfY291bnQg
PSAxOwo+ICsJfSBlbHNlCj4gKwkJcGFnZXMgPSBiby0+YmFzZS5wYWdlczsKPiArCj4gKwltYXBw
aW5nID0gYm8tPmJhc2UuYmFzZS5maWxwLT5mX21hcHBpbmc7Cj4gKwltYXBwaW5nX3NldF91bmV2
aWN0YWJsZShtYXBwaW5nKTsKPiArCj4gKwlmb3IgKGkgPSBwYWdlX29mZnNldDsgaSA8IHBhZ2Vf
b2Zmc2V0ICsgTlVNX0ZBVUxUX1BBR0VTOyBpKyspIHsKPiArCQlwYWdlc1tpXSA9IHNobWVtX3Jl
YWRfbWFwcGluZ19wYWdlKG1hcHBpbmcsIGkpOwo+ICsJCWlmIChJU19FUlIocGFnZXNbaV0pKSB7
Cj4gKwkJCW11dGV4X3VubG9jaygmYm8tPmJhc2UucGFnZXNfbG9jayk7Cj4gKwkJCXJldCA9IFBU
Ul9FUlIocGFnZXNbaV0pOwo+ICsJCQlnb3RvIGVycl9wYWdlczsKPiArCQl9Cj4gKwl9Cj4gKwo+
ICsJbXV0ZXhfdW5sb2NrKCZiby0+YmFzZS5wYWdlc19sb2NrKTsKPiArCj4gKwlzZ3QgPSAmYm8t
PnNndHNbcGFnZV9vZmZzZXQgLyAoU1pfMk0gLyBQQUdFX1NJWkUpXTsKPiArCXJldCA9IHNnX2Fs
bG9jX3RhYmxlX2Zyb21fcGFnZXMoc2d0LCBwYWdlcyArIHBhZ2Vfb2Zmc2V0LAo+ICsJCQkJCU5V
TV9GQVVMVF9QQUdFUywgMCwgU1pfMk0sIEdGUF9LRVJORUwpOwo+ICsJaWYgKHJldCkKPiArCQln
b3RvIGVycl9wYWdlczsKPiArCj4gKwlpZiAoIWRtYV9tYXBfc2cocGZkZXYtPmRldiwgc2d0LT5z
Z2wsIHNndC0+bmVudHMsIERNQV9CSURJUkVDVElPTkFMKSkgewo+ICsJCXJldCA9IC1FSU5WQUw7
Cj4gKwkJZ290byBlcnJfbWFwOwo+ICsJfQo+ICsKPiArCW1tdV9tYXBfc2cocGZkZXYsIGFkZHIs
IElPTU1VX1dSSVRFIHwgSU9NTVVfUkVBRCB8IElPTU1VX05PRVhFQywgc2d0KTsKPiArCj4gKwli
by0+aXNfbWFwcGVkID0gdHJ1ZTsKPiArCj4gKwlkZXZfZGJnKHBmZGV2LT5kZXYsICJtYXBwZWQg
cGFnZSBmYXVsdCBAICVsbHgiLCBhZGRyKTsKPiArCj4gKwlyZXR1cm4gMDsKPiArCj4gK2Vycl9t
YXA6Cj4gKwlzZ19mcmVlX3RhYmxlKHNndCk7Cj4gK2Vycl9wYWdlczoKPiArCWRybV9nZW1fc2ht
ZW1fcHV0X3BhZ2VzKCZiby0+YmFzZSk7Cj4gKwlyZXR1cm4gcmV0Owo+ICt9Cj4gKwo+ICBzdGF0
aWMgY29uc3QgY2hhciAqYWNjZXNzX3R5cGVfbmFtZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpw
ZmRldiwKPiAgCQl1MzIgZmF1bHRfc3RhdHVzKQo+ICB7Cj4gQEAgLTMxMiw5ICs0MTMsNyBAQCBz
dGF0aWMgaXJxcmV0dXJuX3QgcGFuZnJvc3RfbW11X2lycV9oYW5kbGVyX3RocmVhZChpbnQgaXJx
LCB2b2lkICpkYXRhKQo+ICB7Cj4gIAlzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiA9IGRh
dGE7Cj4gIAl1MzIgc3RhdHVzID0gbW11X3JlYWQocGZkZXYsIE1NVV9JTlRfUkFXU1RBVCk7Cj4g
LQlpbnQgaTsKPiAtCj4gLQlkZXZfZXJyKHBmZGV2LT5kZXYsICJtbXUgaXJxIHN0YXR1cz0leFxu
Iiwgc3RhdHVzKTsKPiArCWludCBpLCByZXQ7Cj4gIAo+ICAJZm9yIChpID0gMDsgc3RhdHVzOyBp
KyspIHsKPiAgCQl1MzIgbWFzayA9IEJJVChpKSB8IEJJVChpICsgMTYpOwo+IEBAIC0zMzYsNiAr
NDM1LDE4IEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBwYW5mcm9zdF9tbXVfaXJxX2hhbmRsZXJfdGhy
ZWFkKGludCBpcnEsIHZvaWQgKmRhdGEpCj4gIAkJYWNjZXNzX3R5cGUgPSAoZmF1bHRfc3RhdHVz
ID4+IDgpICYgMHgzOwo+ICAJCXNvdXJjZV9pZCA9IChmYXVsdF9zdGF0dXMgPj4gMTYpOwo+ICAK
PiArCQkvKiBQYWdlIGZhdWx0IG9ubHkgKi8KPiArCQlpZiAoKHN0YXR1cyAmIG1hc2spID09IEJJ
VChpKSkgewo+ICsJCQlXQVJOX09OKGV4Y2VwdGlvbl90eXBlIDwgMHhDMSB8fCBleGNlcHRpb25f
dHlwZSA+IDB4QzQpOwo+ICsKPiArCQkJcmV0ID0gcGFuZnJvc3RfbW11X21hcF9mYXVsdF9hZGRy
KHBmZGV2LCBpLCBhZGRyKTsKPiArCQkJaWYgKCFyZXQpIHsKPiArCQkJCW1tdV93cml0ZShwZmRl
diwgTU1VX0lOVF9DTEVBUiwgQklUKGkpKTsKPiArCQkJCXN0YXR1cyAmPSB+bWFzazsKPiArCQkJ
CWNvbnRpbnVlOwo+ICsJCQl9Cj4gKwkJfQo+ICsKPiAgCQkvKiB0ZXJtaW5hbCBmYXVsdCwgcHJp
bnQgaW5mbyBhYm91dCB0aGUgZmF1bHQgKi8KPiAgCQlkZXZfZXJyKHBmZGV2LT5kZXYsCj4gIAkJ
CSJVbmhhbmRsZWQgUGFnZSBmYXVsdCBpbiBBUyVkIGF0IFZBIDB4JTAxNmxsWFxuIgo+IGRpZmYg
LS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oIGIvaW5jbHVkZS91YXBpL2Ry
bS9wYW5mcm9zdF9kcm0uaAo+IGluZGV4IDE3ZmI1ZDIwMGY3YS4uOTE1MGRkNzVhYWQ4IDEwMDY0
NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vcGFuZnJvc3RfZHJtLmgKPiArKysgYi9pbmNsdWRl
L3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCj4gQEAgLTgzLDYgKzgzLDcgQEAgc3RydWN0IGRybV9w
YW5mcm9zdF93YWl0X2JvIHsKPiAgfTsKPiAgCj4gICNkZWZpbmUgUEFORlJPU1RfQk9fTk9FWEVD
CTEKPiArI2RlZmluZSBQQU5GUk9TVF9CT19IRUFQCTIKPiAgCj4gIC8qKgo+ICAgKiBzdHJ1Y3Qg
ZHJtX3BhbmZyb3N0X2NyZWF0ZV9ibyAtIGlvY3RsIGFyZ3VtZW50IGZvciBjcmVhdGluZyBQYW5m
cm9zdCBCT3MuCj4gCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
