Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0FEB8845C4
	for <lists+dri-devel@lfdr.de>; Wed,  7 Aug 2019 09:27:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 819BC6E644;
	Wed,  7 Aug 2019 07:26:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0775E6E584
 for <dri-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 23:16:17 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id r6so82200091qtt.0
 for <dri-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 16:16:16 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=MRWnXiD/uGXKgJU9OoKKBGSTnw65zc5ohVNCn5Ladgo=;
 b=c95vf61HcUWmbcm97tyuPuqCYdSGGOiUFkRi8teT6chXy3at4KyxiRb8WoB3YnnpR/
 E9xF19IKVRil9qb5OFh8bQdhIG9BSKq7l8nyAB8a/zSyfX2MlazMUZG0p2QVz/3P5xbX
 /RYFiuHdve48uv6f2a1fWh1PB3TCEjTYhqWAewSIjVmp0Vg46FERvNIo2BglePb9oOnC
 nD9equr2lp7MrvAl79Lxoo/eVclRay1PCGH5yEBMDZjY1B5UUz4mQozLqKaq1H/5Aiq3
 7H3EYKQ8MVUbwgYz2h6te0lOW+hSd9KXd4P2wSZ9/yPD5+lwnqYQKRpE/VV/icubL9q9
 bBdQ==
X-Gm-Message-State: APjAAAWkPoNWI2m0Ta2g2XgaKcG1UDrgpguYT9ecUKh0h0xnUUTYbpJK
 +DXk91LYcMIwq2BL/FgxwyfzOA==
X-Google-Smtp-Source: APXvYqypQ9RNoQFEs+bodGIjrbmV6xyvFjawz3KagGpOLfACvZgt4hS7Bv0ktSusA1dSv+gHTZoAKg==
X-Received: by 2002:ac8:2d19:: with SMTP id n25mr5581133qta.180.1565133376052; 
 Tue, 06 Aug 2019 16:16:16 -0700 (PDT)
Received: from ziepe.ca
 (hlfxns017vw-156-34-55-100.dhcp-dynamic.fibreop.ns.bellaliant.net.
 [156.34.55.100])
 by smtp.gmail.com with ESMTPSA id s127sm38747936qkd.107.2019.08.06.16.16.14
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 06 Aug 2019 16:16:14 -0700 (PDT)
Received: from jgg by mlx.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1hv8gg-0006em-9U; Tue, 06 Aug 2019 20:16:14 -0300
From: Jason Gunthorpe <jgg@ziepe.ca>
To: linux-mm@kvack.org
Subject: [PATCH v3 hmm 06/11] RDMA/odp: use mmu_notifier_get/put for 'struct
 ib_ucontext_per_mm'
Date: Tue,  6 Aug 2019 20:15:43 -0300
Message-Id: <20190806231548.25242-7-jgg@ziepe.ca>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190806231548.25242-1-jgg@ziepe.ca>
References: <20190806231548.25242-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 07 Aug 2019 07:26:18 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=MRWnXiD/uGXKgJU9OoKKBGSTnw65zc5ohVNCn5Ladgo=;
 b=cVCEAFYu3kKP8uCjesyCqUuge//F+lRMQ01eE/SDhD70YhMTF3HbtusJNVW2GMywCv
 4VCvMBAkdjjh0NSJXtoxdhaVFbVOyoxt8f4T62ct8t+2BDxe3Tk7qhFhd7R/0e4cmzZP
 6hd7zbqogcJgbY2+Q2Z3U81kwQsf61kL7PT4AC+Vfe/XZxWBGhHv43c1bv/2pdCb/cTc
 Za7656UQb3s75IzTwKUXgOMle+zu6eXHiImOpSiBagC2JxdIq/RIFD1AiuIU4hzzm0y+
 Q9HWzl+WiWJKLbmyYqIM0SIGUu2JiDqjWLP1dsRgQZsYxAoH57HC4ve3ELGcAJBFLquU
 nXzA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrea Arcangeli <aarcange@redhat.com>,
 Ralph Campbell <rcampbell@nvidia.com>, Dimitri Sivanich <sivanich@sgi.com>,
 Gavin Shan <shangw@linux.vnet.ibm.com>, Andrea Righi <andrea@betterlinux.com>,
 linux-rdma@vger.kernel.org, John Hubbard <jhubbard@nvidia.com>, "Kuehling,
 Felix" <Felix.Kuehling@amd.com>, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 iommu@lists.linux-foundation.org, amd-gfx@lists.freedesktop.org,
 Jason Gunthorpe <jgg@mellanox.com>, Alex Deucher <alexander.deucher@amd.com>,
 intel-gfx@lists.freedesktop.org, Christoph Hellwig <hch@lst.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhpcyBpcyBhIHNpZ25p
ZmljYW50IHNpbXBsaWZpY2F0aW9uLCBubyBleHRyYSBsaXN0IGlzIGtlcHQgcGVyIEZELCBhbmQK
dGhlIGludGVydmFsIHRyZWUgaXMgbm93IHNoYXJlZCBiZXR3ZWVuIGFsbCB0aGUgdWNvbnRleHRz
LCByZWR1Y2luZwpvdmVyaGVhZCBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgdWNvbnRleHRzIGFjdGl2
ZS4KClNpZ25lZC1vZmYtYnk6IEphc29uIEd1bnRob3JwZSA8amdnQG1lbGxhbm94LmNvbT4KLS0t
CiBkcml2ZXJzL2luZmluaWJhbmQvY29yZS91bWVtX29kcC5jICAgIHwgMTcwICsrKysrKysrLS0t
LS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2luZmluaWJhbmQvY29yZS91dmVyYnNfY21kLmMgIHwg
ICAzIC0KIGRyaXZlcnMvaW5maW5pYmFuZC9jb3JlL3V2ZXJic19tYWluLmMgfCAgIDEgKwogZHJp
dmVycy9pbmZpbmliYW5kL2h3L21seDUvbWFpbi5jICAgICB8ICAgNSAtCiBpbmNsdWRlL3JkbWEv
aWJfdW1lbV9vZHAuaCAgICAgICAgICAgIHwgIDEwICstCiBpbmNsdWRlL3JkbWEvaWJfdmVyYnMu
aCAgICAgICAgICAgICAgIHwgICAzIC0KIDYgZmlsZXMgY2hhbmdlZCwgNTQgaW5zZXJ0aW9ucygr
KSwgMTM4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvaW5maW5pYmFuZC9jb3Jl
L3VtZW1fb2RwLmMgYi9kcml2ZXJzL2luZmluaWJhbmQvY29yZS91bWVtX29kcC5jCmluZGV4IGM2
YTk5MjM5MmVlMmI4Li5hMDJlNmUzZDdiNzJmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9pbmZpbmli
YW5kL2NvcmUvdW1lbV9vZHAuYworKysgYi9kcml2ZXJzL2luZmluaWJhbmQvY29yZS91bWVtX29k
cC5jCkBAIC04Miw3ICs4Miw3IEBAIHN0YXRpYyB2b2lkIGliX3VtZW1fbm90aWZpZXJfcmVsZWFz
ZShzdHJ1Y3QgbW11X25vdGlmaWVyICptbiwKIAlzdHJ1Y3QgcmJfbm9kZSAqbm9kZTsKIAogCWRv
d25fcmVhZCgmcGVyX21tLT51bWVtX3J3c2VtKTsKLQlpZiAoIXBlcl9tbS0+YWN0aXZlKQorCWlm
ICghcGVyX21tLT5tbi51c2VycykKIAkJZ290byBvdXQ7CiAKIAlmb3IgKG5vZGUgPSByYl9maXJz
dF9jYWNoZWQoJnBlcl9tbS0+dW1lbV90cmVlKTsgbm9kZTsKQEAgLTEzMiw3ICsxMzIsNyBAQCBz
dGF0aWMgaW50IGliX3VtZW1fbm90aWZpZXJfaW52YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3Qg
bW11X25vdGlmaWVyICptbiwKIAllbHNlIGlmICghZG93bl9yZWFkX3RyeWxvY2soJnBlcl9tbS0+
dW1lbV9yd3NlbSkpCiAJCXJldHVybiAtRUFHQUlOOwogCi0JaWYgKCFwZXJfbW0tPmFjdGl2ZSkg
eworCWlmICghcGVyX21tLT5tbi51c2VycykgewogCQl1cF9yZWFkKCZwZXJfbW0tPnVtZW1fcndz
ZW0pOwogCQkvKgogCQkgKiBBdCB0aGlzIHBvaW50IGFjdGl2ZSBpcyBwZXJtYW5lbnRseSBzZXQg
YW5kIHZpc2libGUgdG8gdGhpcwpAQCAtMTY1LDcgKzE2NSw3IEBAIHN0YXRpYyB2b2lkIGliX3Vt
ZW1fbm90aWZpZXJfaW52YWxpZGF0ZV9yYW5nZV9lbmQoc3RydWN0IG1tdV9ub3RpZmllciAqbW4s
CiAJc3RydWN0IGliX3Vjb250ZXh0X3Blcl9tbSAqcGVyX21tID0KIAkJY29udGFpbmVyX29mKG1u
LCBzdHJ1Y3QgaWJfdWNvbnRleHRfcGVyX21tLCBtbik7CiAKLQlpZiAodW5saWtlbHkoIXBlcl9t
bS0+YWN0aXZlKSkKKwlpZiAodW5saWtlbHkoIXBlcl9tbS0+bW4udXNlcnMpKQogCQlyZXR1cm47
CiAKIAlyYnRfaWJfdW1lbV9mb3JfZWFjaF9pbl9yYW5nZSgmcGVyX21tLT51bWVtX3RyZWUsIHJh
bmdlLT5zdGFydCwKQEAgLTE3NCwxMjUgKzE3NCw0NyBAQCBzdGF0aWMgdm9pZCBpYl91bWVtX25v
dGlmaWVyX2ludmFsaWRhdGVfcmFuZ2VfZW5kKHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uLAogCXVw
X3JlYWQoJnBlcl9tbS0+dW1lbV9yd3NlbSk7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgbW11
X25vdGlmaWVyX29wcyBpYl91bWVtX25vdGlmaWVycyA9IHsKLQkucmVsZWFzZSAgICAgICAgICAg
ICAgICAgICAgPSBpYl91bWVtX25vdGlmaWVyX3JlbGVhc2UsCi0JLmludmFsaWRhdGVfcmFuZ2Vf
c3RhcnQgICAgID0gaWJfdW1lbV9ub3RpZmllcl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0LAotCS5p
bnZhbGlkYXRlX3JhbmdlX2VuZCAgICAgICA9IGliX3VtZW1fbm90aWZpZXJfaW52YWxpZGF0ZV9y
YW5nZV9lbmQsCi19OwotCi1zdGF0aWMgdm9pZCByZW1vdmVfdW1lbV9mcm9tX3Blcl9tbShzdHJ1
Y3QgaWJfdW1lbV9vZHAgKnVtZW1fb2RwKQotewotCXN0cnVjdCBpYl91Y29udGV4dF9wZXJfbW0g
KnBlcl9tbSA9IHVtZW1fb2RwLT5wZXJfbW07Ci0KLQlpZiAodW1lbV9vZHAtPmlzX2ltcGxpY2l0
X29kcCkKLQkJcmV0dXJuOwotCi0JZG93bl93cml0ZSgmcGVyX21tLT51bWVtX3J3c2VtKTsKLQlp
bnRlcnZhbF90cmVlX3JlbW92ZSgmdW1lbV9vZHAtPmludGVydmFsX3RyZWUsICZwZXJfbW0tPnVt
ZW1fdHJlZSk7Ci0JY29tcGxldGVfYWxsKCZ1bWVtX29kcC0+bm90aWZpZXJfY29tcGxldGlvbik7
Ci0JdXBfd3JpdGUoJnBlcl9tbS0+dW1lbV9yd3NlbSk7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgaWJf
dWNvbnRleHRfcGVyX21tICphbGxvY19wZXJfbW0oc3RydWN0IGliX3Vjb250ZXh0ICpjdHgsCi0J
CQkJCSAgICAgICBzdHJ1Y3QgbW1fc3RydWN0ICptbSkKK3N0YXRpYyBzdHJ1Y3QgbW11X25vdGlm
aWVyICppYl91bWVtX2FsbG9jX25vdGlmaWVyKHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKQogewogCXN0
cnVjdCBpYl91Y29udGV4dF9wZXJfbW0gKnBlcl9tbTsKLQlpbnQgcmV0OwogCiAJcGVyX21tID0g
a3phbGxvYyhzaXplb2YoKnBlcl9tbSksIEdGUF9LRVJORUwpOwogCWlmICghcGVyX21tKQogCQly
ZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCXBlcl9tbS0+Y29udGV4dCA9IGN0eDsKLQlwZXJf
bW0tPm1tID0gbW07CiAJcGVyX21tLT51bWVtX3RyZWUgPSBSQl9ST09UX0NBQ0hFRDsKIAlpbml0
X3J3c2VtKCZwZXJfbW0tPnVtZW1fcndzZW0pOwotCXBlcl9tbS0+YWN0aXZlID0gdHJ1ZTsKIAor
CVdBUk5fT04obW0gIT0gY3VycmVudC0+bW0pOwogCXJjdV9yZWFkX2xvY2soKTsKIAlwZXJfbW0t
PnRnaWQgPSBnZXRfdGFza19waWQoY3VycmVudC0+Z3JvdXBfbGVhZGVyLCBQSURUWVBFX1BJRCk7
CiAJcmN1X3JlYWRfdW5sb2NrKCk7Ci0KLQlXQVJOX09OKG1tICE9IGN1cnJlbnQtPm1tKTsKLQot
CXBlcl9tbS0+bW4ub3BzID0gJmliX3VtZW1fbm90aWZpZXJzOwotCXJldCA9IG1tdV9ub3RpZmll
cl9yZWdpc3RlcigmcGVyX21tLT5tbiwgcGVyX21tLT5tbSk7Ci0JaWYgKHJldCkgewotCQlkZXZf
ZXJyKCZjdHgtPmRldmljZS0+ZGV2LAotCQkJIkZhaWxlZCB0byByZWdpc3RlciBtbXVfbm90aWZp
ZXIgJWRcbiIsIHJldCk7Ci0JCWdvdG8gb3V0X3BpZDsKLQl9Ci0KLQlsaXN0X2FkZCgmcGVyX21t
LT51Y29udGV4dF9saXN0LCAmY3R4LT5wZXJfbW1fbGlzdCk7Ci0JcmV0dXJuIHBlcl9tbTsKLQot
b3V0X3BpZDoKLQlwdXRfcGlkKHBlcl9tbS0+dGdpZCk7Ci0Ja2ZyZWUocGVyX21tKTsKLQlyZXR1
cm4gRVJSX1BUUihyZXQpOworCXJldHVybiAmcGVyX21tLT5tbjsKIH0KIAotc3RhdGljIHN0cnVj
dCBpYl91Y29udGV4dF9wZXJfbW0gKmdldF9wZXJfbW0oc3RydWN0IGliX3VtZW1fb2RwICp1bWVt
X29kcCkKK3N0YXRpYyB2b2lkIGliX3VtZW1fZnJlZV9ub3RpZmllcihzdHJ1Y3QgbW11X25vdGlm
aWVyICptbikKIHsKLQlzdHJ1Y3QgaWJfdWNvbnRleHQgKmN0eCA9IHVtZW1fb2RwLT51bWVtLmNv
bnRleHQ7Ci0Jc3RydWN0IGliX3Vjb250ZXh0X3Blcl9tbSAqcGVyX21tOwotCi0JbG9ja2RlcF9h
c3NlcnRfaGVsZCgmY3R4LT5wZXJfbW1fbGlzdF9sb2NrKTsKLQotCS8qCi0JICogR2VuZXJhbGx5
IHNwZWFraW5nIHdlIGV4cGVjdCBvbmx5IG9uZSBvciB0d28gcGVyX21tIGluIHRoaXMgbGlzdCwK
LQkgKiBzbyBubyByZWFzb24gdG8gb3B0aW1pemUgdGhpcyBzZWFyY2ggdG9kYXkuCi0JICovCi0J
bGlzdF9mb3JfZWFjaF9lbnRyeShwZXJfbW0sICZjdHgtPnBlcl9tbV9saXN0LCB1Y29udGV4dF9s
aXN0KSB7Ci0JCWlmIChwZXJfbW0tPm1tID09IHVtZW1fb2RwLT51bWVtLm93bmluZ19tbSkKLQkJ
CXJldHVybiBwZXJfbW07Ci0JfQotCi0JcmV0dXJuIGFsbG9jX3Blcl9tbShjdHgsIHVtZW1fb2Rw
LT51bWVtLm93bmluZ19tbSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGZyZWVfcGVyX21tKHN0cnVjdCBy
Y3VfaGVhZCAqcmN1KQotewotCWtmcmVlKGNvbnRhaW5lcl9vZihyY3UsIHN0cnVjdCBpYl91Y29u
dGV4dF9wZXJfbW0sIHJjdSkpOwotfQotCi1zdGF0aWMgdm9pZCBwdXRfcGVyX21tKHN0cnVjdCBp
Yl91bWVtX29kcCAqdW1lbV9vZHApCi17Ci0Jc3RydWN0IGliX3Vjb250ZXh0X3Blcl9tbSAqcGVy
X21tID0gdW1lbV9vZHAtPnBlcl9tbTsKLQlzdHJ1Y3QgaWJfdWNvbnRleHQgKmN0eCA9IHVtZW1f
b2RwLT51bWVtLmNvbnRleHQ7Ci0JYm9vbCBuZWVkX2ZyZWU7Ci0KLQltdXRleF9sb2NrKCZjdHgt
PnBlcl9tbV9saXN0X2xvY2spOwotCXVtZW1fb2RwLT5wZXJfbW0gPSBOVUxMOwotCXBlcl9tbS0+
b2RwX21yc19jb3VudC0tOwotCW5lZWRfZnJlZSA9IHBlcl9tbS0+b2RwX21yc19jb3VudCA9PSAw
OwotCWlmIChuZWVkX2ZyZWUpCi0JCWxpc3RfZGVsKCZwZXJfbW0tPnVjb250ZXh0X2xpc3QpOwot
CW11dGV4X3VubG9jaygmY3R4LT5wZXJfbW1fbGlzdF9sb2NrKTsKLQotCWlmICghbmVlZF9mcmVl
KQotCQlyZXR1cm47Ci0KLQkvKgotCSAqIE5PVEUhIG1tdV9ub3RpZmllcl91bnJlZ2lzdGVyKCkg
Y2FuIGhhcHBlbiBiZXR3ZWVuIGEgc3RhcnQvZW5kCi0JICogY2FsbGJhY2ssIHJlc3VsdGluZyBp
biBhbiBzdGFydC9lbmQsIGFuZCB0aHVzIGFuIHVuYmFsYW5jZWQKLQkgKiBsb2NrLiBUaGlzIGRv
ZXNuJ3QgcmVhbGx5IG1hdHRlciB0byB1cyBzaW5jZSB3ZSBhcmUgYWJvdXQgdG8ga2ZyZWUKLQkg
KiB0aGUgbWVtb3J5IHRoYXQgaG9sZHMgdGhlIGxvY2ssIGhvd2V2ZXIgTE9DS0RFUCBkb2Vzbid0
IGxpa2UgdGhpcy4KLQkgKi8KLQlkb3duX3dyaXRlKCZwZXJfbW0tPnVtZW1fcndzZW0pOwotCXBl
cl9tbS0+YWN0aXZlID0gZmFsc2U7Ci0JdXBfd3JpdGUoJnBlcl9tbS0+dW1lbV9yd3NlbSk7CisJ
c3RydWN0IGliX3Vjb250ZXh0X3Blcl9tbSAqcGVyX21tID0KKwkJY29udGFpbmVyX29mKG1uLCBz
dHJ1Y3QgaWJfdWNvbnRleHRfcGVyX21tLCBtbik7CiAKIAlXQVJOX09OKCFSQl9FTVBUWV9ST09U
KCZwZXJfbW0tPnVtZW1fdHJlZS5yYl9yb290KSk7Ci0JbW11X25vdGlmaWVyX3VucmVnaXN0ZXJf
bm9fcmVsZWFzZSgmcGVyX21tLT5tbiwgcGVyX21tLT5tbSk7CisKIAlwdXRfcGlkKHBlcl9tbS0+
dGdpZCk7Ci0JbW11X25vdGlmaWVyX2NhbGxfc3JjdSgmcGVyX21tLT5yY3UsIGZyZWVfcGVyX21t
KTsKKwlrZnJlZShwZXJfbW0pOwogfQogCi1zdGF0aWMgaW5saW5lIGludCBpYl9pbml0X3VtZW1f
b2RwKHN0cnVjdCBpYl91bWVtX29kcCAqdW1lbV9vZHAsCi0JCQkJICAgc3RydWN0IGliX3Vjb250
ZXh0X3Blcl9tbSAqcGVyX21tKQorc3RhdGljIGNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfb3Bz
IGliX3VtZW1fbm90aWZpZXJzID0geworCS5yZWxlYXNlICAgICAgICAgICAgICAgICAgICA9IGli
X3VtZW1fbm90aWZpZXJfcmVsZWFzZSwKKwkuaW52YWxpZGF0ZV9yYW5nZV9zdGFydCAgICAgPSBp
Yl91bWVtX25vdGlmaWVyX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQsCisJLmludmFsaWRhdGVfcmFu
Z2VfZW5kICAgICAgID0gaWJfdW1lbV9ub3RpZmllcl9pbnZhbGlkYXRlX3JhbmdlX2VuZCwKKwku
YWxsb2Nfbm90aWZpZXIJCSAgICA9IGliX3VtZW1fYWxsb2Nfbm90aWZpZXIsCisJLmZyZWVfbm90
aWZpZXIJCSAgICA9IGliX3VtZW1fZnJlZV9ub3RpZmllciwKK307CisKK3N0YXRpYyBpbmxpbmUg
aW50IGliX2luaXRfdW1lbV9vZHAoc3RydWN0IGliX3VtZW1fb2RwICp1bWVtX29kcCkKIHsKLQlz
dHJ1Y3QgaWJfdWNvbnRleHQgKmN0eCA9IHVtZW1fb2RwLT51bWVtLmNvbnRleHQ7CisJc3RydWN0
IGliX3Vjb250ZXh0X3Blcl9tbSAqcGVyX21tOworCXN0cnVjdCBtbXVfbm90aWZpZXIgKm1uOwog
CWludCByZXQ7CiAKIAlpZiAoIXVtZW1fb2RwLT5pc19pbXBsaWNpdF9vZHApIHsKQEAgLTMzOCwx
OCArMjYwLDEzIEBAIHN0YXRpYyBpbmxpbmUgaW50IGliX2luaXRfdW1lbV9vZHAoc3RydWN0IGli
X3VtZW1fb2RwICp1bWVtX29kcCwKIAkJfQogCX0KIAotCW11dGV4X2xvY2soJmN0eC0+cGVyX21t
X2xpc3RfbG9jayk7Ci0JaWYgKHBlcl9tbSkgewotCQl1bWVtX29kcC0+cGVyX21tID0gcGVyX21t
OwotCX0gZWxzZSB7Ci0JCXVtZW1fb2RwLT5wZXJfbW0gPSBnZXRfcGVyX21tKHVtZW1fb2RwKTsK
LQkJaWYgKElTX0VSUih1bWVtX29kcC0+cGVyX21tKSkgewotCQkJcmV0ID0gUFRSX0VSUih1bWVt
X29kcC0+cGVyX21tKTsKLQkJCWdvdG8gb3V0X3VubG9jazsKLQkJfQorCW1uID0gbW11X25vdGlm
aWVyX2dldCgmaWJfdW1lbV9ub3RpZmllcnMsIHVtZW1fb2RwLT51bWVtLm93bmluZ19tbSk7CisJ
aWYgKElTX0VSUihtbikpIHsKKwkJcmV0ID0gUFRSX0VSUihtbik7CisJCWdvdG8gb3V0X2RtYV9s
aXN0OwogCX0KLQlwZXJfbW0tPm9kcF9tcnNfY291bnQrKzsKLQltdXRleF91bmxvY2soJmN0eC0+
cGVyX21tX2xpc3RfbG9jayk7CisJdW1lbV9vZHAtPnBlcl9tbSA9IHBlcl9tbSA9CisJCWNvbnRh
aW5lcl9vZihtbiwgc3RydWN0IGliX3Vjb250ZXh0X3Blcl9tbSwgbW4pOwogCiAJbXV0ZXhfaW5p
dCgmdW1lbV9vZHAtPnVtZW1fbXV0ZXgpOwogCWluaXRfY29tcGxldGlvbigmdW1lbV9vZHAtPm5v
dGlmaWVyX2NvbXBsZXRpb24pOwpAQCAtMzYzLDggKzI4MCw3IEBAIHN0YXRpYyBpbmxpbmUgaW50
IGliX2luaXRfdW1lbV9vZHAoc3RydWN0IGliX3VtZW1fb2RwICp1bWVtX29kcCwKIAogCXJldHVy
biAwOwogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmY3R4LT5wZXJfbW1fbGlzdF9sb2Nr
KTsKK291dF9kbWFfbGlzdDoKIAlrdmZyZWUodW1lbV9vZHAtPmRtYV9saXN0KTsKIG91dF9wYWdl
X2xpc3Q6CiAJa3ZmcmVlKHVtZW1fb2RwLT5wYWdlX2xpc3QpOwpAQCAtNDA5LDcgKzMyNSw3IEBA
IHN0cnVjdCBpYl91bWVtX29kcCAqaWJfdW1lbV9vZHBfYWxsb2NfaW1wbGljaXQoc3RydWN0IGli
X3VkYXRhICp1ZGF0YSwKIAl1bWVtX29kcC0+aXNfaW1wbGljaXRfb2RwID0gMTsKIAl1bWVtX29k
cC0+cGFnZV9zaGlmdCA9IFBBR0VfU0hJRlQ7CiAKLQlyZXQgPSBpYl9pbml0X3VtZW1fb2RwKHVt
ZW1fb2RwLCBOVUxMKTsKKwlyZXQgPSBpYl9pbml0X3VtZW1fb2RwKHVtZW1fb2RwKTsKIAlpZiAo
cmV0KSB7CiAJCWtmcmVlKHVtZW1fb2RwKTsKIAkJcmV0dXJuIEVSUl9QVFIocmV0KTsKQEAgLTQ1
NSw3ICszNzEsNyBAQCBzdHJ1Y3QgaWJfdW1lbV9vZHAgKmliX3VtZW1fb2RwX2FsbG9jX2NoaWxk
KHN0cnVjdCBpYl91bWVtX29kcCAqcm9vdCwKIAl1bWVtLT5vd25pbmdfbW0gID0gcm9vdC0+dW1l
bS5vd25pbmdfbW07CiAJb2RwX2RhdGEtPnBhZ2Vfc2hpZnQgPSBQQUdFX1NISUZUOwogCi0JcmV0
ID0gaWJfaW5pdF91bWVtX29kcChvZHBfZGF0YSwgcm9vdC0+cGVyX21tKTsKKwlyZXQgPSBpYl9p
bml0X3VtZW1fb2RwKG9kcF9kYXRhKTsKIAlpZiAocmV0KSB7CiAJCWtmcmVlKG9kcF9kYXRhKTsK
IAkJcmV0dXJuIEVSUl9QVFIocmV0KTsKQEAgLTQ5OCwxMSArNDE0LDEzIEBAIGludCBpYl91bWVt
X29kcF9nZXQoc3RydWN0IGliX3VtZW1fb2RwICp1bWVtX29kcCwgaW50IGFjY2VzcykKIAkJdXBf
cmVhZCgmbW0tPm1tYXBfc2VtKTsKIAl9CiAKLQlyZXR1cm4gaWJfaW5pdF91bWVtX29kcCh1bWVt
X29kcCwgTlVMTCk7CisJcmV0dXJuIGliX2luaXRfdW1lbV9vZHAodW1lbV9vZHApOwogfQogCiB2
b2lkIGliX3VtZW1fb2RwX3JlbGVhc2Uoc3RydWN0IGliX3VtZW1fb2RwICp1bWVtX29kcCkKIHsK
KwlzdHJ1Y3QgaWJfdWNvbnRleHRfcGVyX21tICpwZXJfbW0gPSB1bWVtX29kcC0+cGVyX21tOwor
CiAJLyoKIAkgKiBFbnN1cmUgdGhhdCBubyBtb3JlIHBhZ2VzIGFyZSBtYXBwZWQgaW4gdGhlIHVt
ZW0uCiAJICoKQEAgLTUxMiw4ICs0MzAsMjQgQEAgdm9pZCBpYl91bWVtX29kcF9yZWxlYXNlKHN0
cnVjdCBpYl91bWVtX29kcCAqdW1lbV9vZHApCiAJaWJfdW1lbV9vZHBfdW5tYXBfZG1hX3BhZ2Vz
KHVtZW1fb2RwLCBpYl91bWVtX3N0YXJ0KHVtZW1fb2RwKSwKIAkJCQkgICAgaWJfdW1lbV9lbmQo
dW1lbV9vZHApKTsKIAotCXJlbW92ZV91bWVtX2Zyb21fcGVyX21tKHVtZW1fb2RwKTsKLQlwdXRf
cGVyX21tKHVtZW1fb2RwKTsKKwlkb3duX3dyaXRlKCZwZXJfbW0tPnVtZW1fcndzZW0pOworCWlm
ICghdW1lbV9vZHAtPmlzX2ltcGxpY2l0X29kcCkgeworCQlpbnRlcnZhbF90cmVlX3JlbW92ZSgm
dW1lbV9vZHAtPmludGVydmFsX3RyZWUsCisJCQkJICAgICAmcGVyX21tLT51bWVtX3RyZWUpOwor
CQljb21wbGV0ZV9hbGwoJnVtZW1fb2RwLT5ub3RpZmllcl9jb21wbGV0aW9uKTsKKwl9CisJLyoK
KwkgKiBOT1RFISBtbXVfbm90aWZpZXJfdW5yZWdpc3RlcigpIGNhbiBoYXBwZW4gYmV0d2VlbiBh
IHN0YXJ0L2VuZAorCSAqIGNhbGxiYWNrLCByZXN1bHRpbmcgaW4gYW4gc3RhcnQvZW5kLCBhbmQg
dGh1cyBhbiB1bmJhbGFuY2VkCisJICogbG9jay4gVGhpcyBkb2Vzbid0IHJlYWxseSBtYXR0ZXIg
dG8gdXMgc2luY2Ugd2UgYXJlIGFib3V0IHRvIGtmcmVlCisJICogdGhlIG1lbW9yeSB0aGF0IGhv
bGRzIHRoZSBsb2NrLCBob3dldmVyIExPQ0tERVAgZG9lc24ndCBsaWtlIHRoaXMuCisJICogVGh1
cyB3ZSBjYWxsIHRoZSBtbXVfbm90aWZpZXJfcHV0IHVuZGVyIHRoZSByd3NlbSBhbmQgdGVzdCB0
aGUKKwkgKiBpbnRlcm5hbCB1c2VycyBjb3VudCB0byByZWxpYWJseSBzZWUgaWYgd2UgYXJlIHBh
c3QgdGhpcyBwb2ludC4KKwkgKi8KKwltbXVfbm90aWZpZXJfcHV0KCZ1bWVtX29kcC0+cGVyX21t
LT5tbik7CisJdXBfd3JpdGUoJnBlcl9tbS0+dW1lbV9yd3NlbSk7CisKKwl1bWVtX29kcC0+cGVy
X21tID0gTlVMTDsKIAlrdmZyZWUodW1lbV9vZHAtPmRtYV9saXN0KTsKIAlrdmZyZWUodW1lbV9v
ZHAtPnBhZ2VfbGlzdCk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2luZmluaWJhbmQvY29yZS91
dmVyYnNfY21kLmMgYi9kcml2ZXJzL2luZmluaWJhbmQvY29yZS91dmVyYnNfY21kLmMKaW5kZXgg
OGY0ZmQ0ZmFjMTU5M2EuLjdjMTBkZmU0MTdhNDQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2luZmlu
aWJhbmQvY29yZS91dmVyYnNfY21kLmMKKysrIGIvZHJpdmVycy9pbmZpbmliYW5kL2NvcmUvdXZl
cmJzX2NtZC5jCkBAIC0yNTIsOSArMjUyLDYgQEAgc3RhdGljIGludCBpYl91dmVyYnNfZ2V0X2Nv
bnRleHQoc3RydWN0IHV2ZXJic19hdHRyX2J1bmRsZSAqYXR0cnMpCiAJdWNvbnRleHQtPmNsb3Np
bmcgPSBmYWxzZTsKIAl1Y29udGV4dC0+Y2xlYW51cF9yZXRyeWFibGUgPSBmYWxzZTsKIAotCW11
dGV4X2luaXQoJnVjb250ZXh0LT5wZXJfbW1fbGlzdF9sb2NrKTsKLQlJTklUX0xJU1RfSEVBRCgm
dWNvbnRleHQtPnBlcl9tbV9saXN0KTsKLQogCXJldCA9IGdldF91bnVzZWRfZmRfZmxhZ3MoT19D
TE9FWEVDKTsKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfZnJlZTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvaW5maW5pYmFuZC9jb3JlL3V2ZXJic19tYWluLmMgYi9kcml2ZXJzL2luZmluaWJhbmQv
Y29yZS91dmVyYnNfbWFpbi5jCmluZGV4IDExYzEzYzEzODFjZjVjLi5lMzY5YWMwZDZmNTE1OSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9pbmZpbmliYW5kL2NvcmUvdXZlcmJzX21haW4uYworKysgYi9k
cml2ZXJzL2luZmluaWJhbmQvY29yZS91dmVyYnNfbWFpbi5jCkBAIC0xNDg3LDYgKzE0ODcsNyBA
QCBzdGF0aWMgdm9pZCBfX2V4aXQgaWJfdXZlcmJzX2NsZWFudXAodm9pZCkKIAkJCQkgSUJfVVZF
UkJTX05VTV9GSVhFRF9NSU5PUik7CiAJdW5yZWdpc3Rlcl9jaHJkZXZfcmVnaW9uKGR5bmFtaWNf
dXZlcmJzX2RldiwKIAkJCQkgSUJfVVZFUkJTX05VTV9EWU5BTUlDX01JTk9SKTsKKwltbXVfbm90
aWZpZXJfc3luY2hyb25pemUoKTsKIH0KIAogbW9kdWxlX2luaXQoaWJfdXZlcmJzX2luaXQpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L21seDUvbWFpbi5jIGIvZHJpdmVycy9p
bmZpbmliYW5kL2h3L21seDUvbWFpbi5jCmluZGV4IGNkYjZiYmJhYTE0ZmQ4Li40NDAwZmY3NDU3
YzdjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L21seDUvbWFpbi5jCisrKyBi
L2RyaXZlcnMvaW5maW5pYmFuZC9ody9tbHg1L21haW4uYwpAQCAtMTk5NSwxMSArMTk5NSw2IEBA
IHN0YXRpYyB2b2lkIG1seDVfaWJfZGVhbGxvY191Y29udGV4dChzdHJ1Y3QgaWJfdWNvbnRleHQg
KmliY29udGV4dCkKIAlzdHJ1Y3QgbWx4NV9pYl9kZXYgKmRldiA9IHRvX21kZXYoaWJjb250ZXh0
LT5kZXZpY2UpOwogCXN0cnVjdCBtbHg1X2JmcmVnX2luZm8gKmJmcmVnaTsKIAotCS8qIEFsbCB1
bWVtJ3MgbXVzdCBiZSBkZXN0cm95ZWQgYmVmb3JlIGRlc3Ryb3lpbmcgdGhlIHVjb250ZXh0LiAq
LwotCW11dGV4X2xvY2soJmliY29udGV4dC0+cGVyX21tX2xpc3RfbG9jayk7Ci0JV0FSTl9PTigh
bGlzdF9lbXB0eSgmaWJjb250ZXh0LT5wZXJfbW1fbGlzdCkpOwotCW11dGV4X3VubG9jaygmaWJj
b250ZXh0LT5wZXJfbW1fbGlzdF9sb2NrKTsKLQogCWJmcmVnaSA9ICZjb250ZXh0LT5iZnJlZ2k7
CiAJbWx4NV9pYl9kZWFsbG9jX3RyYW5zcG9ydF9kb21haW4oZGV2LCBjb250ZXh0LT50ZG4sIGNv
bnRleHQtPmRldnhfdWlkKTsKIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9yZG1hL2liX3VtZW1fb2Rw
LmggYi9pbmNsdWRlL3JkbWEvaWJfdW1lbV9vZHAuaAppbmRleCA0NjhjOWFmYWJiYjJmZC4uNWE2
YzdjZDNmMzMzODggMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvcmRtYS9pYl91bWVtX29kcC5oCisrKyBi
L2luY2x1ZGUvcmRtYS9pYl91bWVtX29kcC5oCkBAIC0xMTYsMjAgKzExNiwxMiBAQCBzdGF0aWMg
aW5saW5lIHVuc2lnbmVkIGxvbmcgaWJfdW1lbV9lbmQoc3RydWN0IGliX3VtZW1fb2RwICp1bWVt
X29kcCkKICNpZmRlZiBDT05GSUdfSU5GSU5JQkFORF9PTl9ERU1BTkRfUEFHSU5HCiAKIHN0cnVj
dCBpYl91Y29udGV4dF9wZXJfbW0gewotCXN0cnVjdCBpYl91Y29udGV4dCAqY29udGV4dDsKLQlz
dHJ1Y3QgbW1fc3RydWN0ICptbTsKKwlzdHJ1Y3QgbW11X25vdGlmaWVyIG1uOwogCXN0cnVjdCBw
aWQgKnRnaWQ7Ci0JYm9vbCBhY3RpdmU7CiAKIAlzdHJ1Y3QgcmJfcm9vdF9jYWNoZWQgdW1lbV90
cmVlOwogCS8qIFByb3RlY3RzIHVtZW1fdHJlZSAqLwogCXN0cnVjdCByd19zZW1hcGhvcmUgdW1l
bV9yd3NlbTsKLQotCXN0cnVjdCBtbXVfbm90aWZpZXIgbW47Ci0JdW5zaWduZWQgaW50IG9kcF9t
cnNfY291bnQ7Ci0KLQlzdHJ1Y3QgbGlzdF9oZWFkIHVjb250ZXh0X2xpc3Q7Ci0Jc3RydWN0IHJj
dV9oZWFkIHJjdTsKIH07CiAKIGludCBpYl91bWVtX29kcF9nZXQoc3RydWN0IGliX3VtZW1fb2Rw
ICp1bWVtX29kcCwgaW50IGFjY2Vzcyk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL3JkbWEvaWJfdmVy
YnMuaCBiL2luY2x1ZGUvcmRtYS9pYl92ZXJicy5oCmluZGV4IDE2MTk2MTk2NjU5YTRjLi45YmQz
Y2RlN2U4ZGJlOSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9yZG1hL2liX3ZlcmJzLmgKKysrIGIvaW5j
bHVkZS9yZG1hL2liX3ZlcmJzLmgKQEAgLTE0MTcsOSArMTQxNyw2IEBAIHN0cnVjdCBpYl91Y29u
dGV4dCB7CiAKIAlib29sIGNsZWFudXBfcmV0cnlhYmxlOwogCi0Jc3RydWN0IG11dGV4IHBlcl9t
bV9saXN0X2xvY2s7Ci0Jc3RydWN0IGxpc3RfaGVhZCBwZXJfbW1fbGlzdDsKLQogCXN0cnVjdCBp
Yl9yZG1hY2dfb2JqZWN0CWNnX29iajsKIAkvKgogCSAqIEltcGxlbWVudGF0aW9uIGRldGFpbHMg
b2YgdGhlIFJETUEgY29yZSwgZG9uJ3QgdXNlIGluIGRyaXZlcnM6Ci0tIAoyLjIyLjAKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWls
aW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
