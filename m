Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5C1058199D
	for <lists+dri-devel@lfdr.de>; Mon,  5 Aug 2019 14:43:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 574F26E422;
	Mon,  5 Aug 2019 12:43:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 69D836E422;
 Mon,  5 Aug 2019 12:43:16 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id E3E2B6B;
 Mon,  5 Aug 2019 12:43:15 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-81.ams2.redhat.com
 [10.36.116.81])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 1C8B55DA8C;
 Mon,  5 Aug 2019 12:43:11 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 259A517472; Mon,  5 Aug 2019 14:43:11 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 02/18] drm/vram: use embedded gem object
Date: Mon,  5 Aug 2019 14:42:54 +0200
Message-Id: <20190805124310.3275-3-kraxel@redhat.com>
In-Reply-To: <20190805124310.3275-1-kraxel@redhat.com>
References: <20190805124310.3275-1-kraxel@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.29]); Mon, 05 Aug 2019 12:43:16 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: thomas@shipmail.org, tzimmermann@suse.de,
 Hans de Goede <hdegoede@redhat.com>, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, intel-gfx@lists.freedesktop.org,
 open list <linux-kernel@vger.kernel.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>,
 Xinwei Kong <kong.kongxinwei@hisilicon.com>, bskeggs@redhat.com,
 Chen Feng <puck.chen@hisilicon.com>, Rongrong Zou <zourongrong@gmail.com>,
 Dave Airlie <airlied@redhat.com>, Sean Paul <sean@poorly.run>,
 Gerd Hoffmann <kraxel@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHJvcCBkcm1fZ2VtX29iamVjdCBmcm9tIGRybV9nZW1fdnJhbV9vYmplY3QsIHVzZSB0aGUKdHRt
X2J1ZmZlcl9vYmplY3QuYmFzZSBpbnN0ZWFkLgoKU2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFu
biA8a3JheGVsQHJlZGhhdC5jb20+ClJldmlld2VkLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJp
c3RpYW4ua29lbmlnQGFtZC5jb20+CkFja2VkLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1l
cm1hbm5Ac3VzZS5kZT4KLS0tCiBpbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmggICAg
ICAgICAgIHwgIDMgKy0tCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tYWluLmMgICAgICAgICAg
ICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgICAgICAg
fCAxOCArKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMv
aGlibWNfdHRtLmMgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X21haW4u
YyAgICAgICB8ICAyICstCiA1IGZpbGVzIGNoYW5nZWQsIDEzIGluc2VydGlvbnMoKyksIDE0IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIu
aCBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaAppbmRleCBiNDFkOTMyZWI1M2Eu
LmFjMjE3ZDc2ODQ1NiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBl
ci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaApAQCAtMzYsNyArMzYs
NiBAQCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Q7CiAgKiB2aWRlbyBtZW1vcnkgYmVjb21lcyBzY2Fy
Y2UuCiAgKi8KIHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0IHsKLQlzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgZ2VtOwogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCBibzsKIAlzdHJ1Y3QgdHRtX2Jv
X2ttYXBfb2JqIGttYXA7CiAKQEAgLTY4LDcgKzY3LDcgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3Qg
ZHJtX2dlbV92cmFtX29iamVjdCAqZHJtX2dlbV92cmFtX29mX2JvKAogc3RhdGljIGlubGluZSBz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZHJtX2dlbV92cmFtX29mX2dlbSgKIAlzdHJ1Y3Qg
ZHJtX2dlbV9vYmplY3QgKmdlbSkKIHsKLQlyZXR1cm4gY29udGFpbmVyX29mKGdlbSwgc3RydWN0
IGRybV9nZW1fdnJhbV9vYmplY3QsIGdlbSk7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihnZW0sIHN0
cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0LCBiby5iYXNlKTsKIH0KIAogc3RydWN0IGRybV9nZW1f
dnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21haW4uYyBiL2RyaXZlcnMvZ3B1
L2RybS9hc3QvYXN0X21haW4uYwppbmRleCAwYTFiYjljMDUxOTUuLmRhYjc3YjJiYzhhYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hc3QvYXN0X21haW4uYwpAQCAtNTU0LDYgKzU1NCw2IEBAIGludCBhc3RfZ2VtX2NyZWF0
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2Nh
dGUgR0VNIG9iamVjdFxuIik7CiAJCXJldHVybiByZXQ7CiAJfQotCSpvYmogPSAmZ2JvLT5nZW07
CisJKm9iaiA9ICZnYm8tPmJvLmJhc2U7CiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9n
ZW1fdnJhbV9oZWxwZXIuYwppbmRleCBlMGZiZmI2NTcwY2YuLmZjMTM5MjBiM2NiNCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC0yNiw3ICsyNiw3IEBAIHN0YXRpYyB2
b2lkIGRybV9nZW1fdnJhbV9jbGVhbnVwKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8p
CiAJICogVFRNIGJ1ZmZlciBvYmplY3QgaW4gJ2JvJyBoYXMgYWxyZWFkeSBiZWVuIGNsZWFuZWQK
IAkgKiB1cDsgb25seSByZWxlYXNlIHRoZSBHRU0gb2JqZWN0LgogCSAqLwotCWRybV9nZW1fb2Jq
ZWN0X3JlbGVhc2UoJmdiby0+Z2VtKTsKKwlkcm1fZ2VtX29iamVjdF9yZWxlYXNlKCZnYm8tPmJv
LmJhc2UpOwogfQogCiBzdGF0aWMgdm9pZCBkcm1fZ2VtX3ZyYW1fZGVzdHJveShzdHJ1Y3QgZHJt
X2dlbV92cmFtX29iamVjdCAqZ2JvKQpAQCAtODIsMTAgKzgyLDEwIEBAIHN0YXRpYyBpbnQgZHJt
X2dlbV92cmFtX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlpbnQgcmV0OwogCXNpemVf
dCBhY2Nfc2l6ZTsKIAotCWlmICghZ2JvLT5nZW0uZnVuY3MpCi0JCWdiby0+Z2VtLmZ1bmNzID0g
JmRybV9nZW1fdnJhbV9vYmplY3RfZnVuY3M7CisJaWYgKCFnYm8tPmJvLmJhc2UuZnVuY3MpCisJ
CWdiby0+Ym8uYmFzZS5mdW5jcyA9ICZkcm1fZ2VtX3ZyYW1fb2JqZWN0X2Z1bmNzOwogCi0JcmV0
ID0gZHJtX2dlbV9vYmplY3RfaW5pdChkZXYsICZnYm8tPmdlbSwgc2l6ZSk7CisJcmV0ID0gZHJt
X2dlbV9vYmplY3RfaW5pdChkZXYsICZnYm8tPmJvLmJhc2UsIHNpemUpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKQEAgLTEwMyw3ICsxMDMsNyBAQCBzdGF0aWMgaW50IGRybV9nZW1fdnJh
bV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0dXJuIDA7CiAKIGVycl9kcm1fZ2Vt
X29iamVjdF9yZWxlYXNlOgotCWRybV9nZW1fb2JqZWN0X3JlbGVhc2UoJmdiby0+Z2VtKTsKKwlk
cm1fZ2VtX29iamVjdF9yZWxlYXNlKCZnYm8tPmJvLmJhc2UpOwogCXJldHVybiByZXQ7CiB9CiAK
QEAgLTM4MywxMSArMzgzLDExIEBAIGludCBkcm1fZ2VtX3ZyYW1fZmlsbF9jcmVhdGVfZHVtYihz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCiAJaWYgKElTX0VSUihnYm8pKQogCQlyZXR1cm4gUFRSX0VS
UihnYm8pOwogCi0JcmV0ID0gZHJtX2dlbV9oYW5kbGVfY3JlYXRlKGZpbGUsICZnYm8tPmdlbSwg
JmhhbmRsZSk7CisJcmV0ID0gZHJtX2dlbV9oYW5kbGVfY3JlYXRlKGZpbGUsICZnYm8tPmJvLmJh
c2UsICZoYW5kbGUpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX2RybV9nZW1fb2JqZWN0X3B1dF91
bmxvY2tlZDsKIAotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmZ2JvLT5nZW0pOworCWRy
bV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmZ2JvLT5iby5iYXNlKTsKIAogCWFyZ3MtPnBpdGNo
ID0gcGl0Y2g7CiAJYXJncy0+c2l6ZSA9IHNpemU7CkBAIC0zOTYsNyArMzk2LDcgQEAgaW50IGRy
bV9nZW1fdnJhbV9maWxsX2NyZWF0ZV9kdW1iKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAlyZXR1
cm4gMDsKIAogZXJyX2RybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZDoKLQlkcm1fZ2VtX29iamVj
dF9wdXRfdW5sb2NrZWQoJmdiby0+Z2VtKTsKKwlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQo
Jmdiby0+Ym8uYmFzZSk7CiAJcmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92
cmFtX2ZpbGxfY3JlYXRlX2R1bWIpOwpAQCAtNDQ2LDcgKzQ0Niw3IEBAIGludCBkcm1fZ2VtX3Zy
YW1fYm9fZHJpdmVyX3ZlcmlmeV9hY2Nlc3Moc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
IHsKIAlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvID0gZHJtX2dlbV92cmFtX29mX2Jv
KGJvKTsKIAotCXJldHVybiBkcm1fdm1hX25vZGVfdmVyaWZ5X2FjY2VzcygmZ2JvLT5nZW0udm1h
X25vZGUsCisJcmV0dXJuIGRybV92bWFfbm9kZV92ZXJpZnlfYWNjZXNzKCZnYm8tPmJvLmJhc2Uu
dm1hX25vZGUsCiAJCQkJCSAgZmlscC0+cHJpdmF0ZV9kYXRhKTsKIH0KIEVYUE9SVF9TWU1CT0wo
ZHJtX2dlbV92cmFtX2JvX2RyaXZlcl92ZXJpZnlfYWNjZXNzKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jCmluZGV4IGNmYzJmYWFiZGExNC4uOWY2ZTQ3M2U2
Mjk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMKQEAg
LTY2LDcgKzY2LDcgQEAgaW50IGhpYm1jX2dlbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdTMyIHNpemUsIGJvb2wgaXNrZXJuZWwsCiAJCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxv
Y2F0ZSBHRU0gb2JqZWN0OiAlZFxuIiwgcmV0KTsKIAkJcmV0dXJuIHJldDsKIAl9Ci0JKm9iaiA9
ICZnYm8tPmdlbTsKKwkqb2JqID0gJmdiby0+Ym8uYmFzZTsKIAlyZXR1cm4gMDsKIH0KIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X21haW4uYyBiL2RyaXZlcnMv
Z3B1L2RybS92Ym94dmlkZW8vdmJveF9tYWluLmMKaW5kZXggMTg2OTNlMmJmNzJhLi4wMmZhODI3
N2ZmMWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tYWluLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X21haW4uYwpAQCAtMjkyLDcgKzI5
Miw3IEBAIGludCB2Ym94X2dlbV9jcmVhdGUoc3RydWN0IHZib3hfcHJpdmF0ZSAqdmJveCwKIAkJ
cmV0dXJuIHJldDsKIAl9CiAKLQkqb2JqID0gJmdiby0+Z2VtOworCSpvYmogPSAmZ2JvLT5iby5i
YXNlOwogCiAJcmV0dXJuIDA7CiB9Ci0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
