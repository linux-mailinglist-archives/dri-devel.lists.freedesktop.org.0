Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 63D60107B87
	for <lists+dri-devel@lfdr.de>; Sat, 23 Nov 2019 00:38:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8BA186F577;
	Fri, 22 Nov 2019 23:38:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 358 seconds by postgrey-1.36 at gabe;
 Fri, 22 Nov 2019 23:38:06 UTC
Received: from a27-186.smtp-out.us-west-2.amazonses.com
 (a27-186.smtp-out.us-west-2.amazonses.com [54.240.27.186])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1353A6F568;
 Fri, 22 Nov 2019 23:38:06 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
 aws-us-west-2-caf-mail-1.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-1.0 required=2.0 tests=ALL_TRUSTED,SPF_NONE,
 URIBL_BLOCKED autolearn=unavailable autolearn_force=no version=3.4.0
DMARC-Filter: OpenDMARC Filter v1.3.2 smtp.codeaurora.org 36014C76F58
From: Jordan Crouse <jcrouse@codeaurora.org>
To: iommu@lists.linux-foundation.org
Subject: [PATCH v2 6/8] drm/msm: Refactor address space initialization
Date: Fri, 22 Nov 2019 23:32:07 +0000
Message-ID: <0101016e95755f3f-fe3b8fc7-7605-4446-bf46-ab070cfc474c-000000@us-west-2.amazonses.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1574465484-7115-1-git-send-email-jcrouse@codeaurora.org>
References: <1574465484-7115-1-git-send-email-jcrouse@codeaurora.org>
X-SES-Outgoing: 2019.11.22-54.240.27.186
Feedback-ID: 1.us-west-2.CZuq2qbDmUIuT3qdvXlRHZZCpfZqZ4GtG9v3VKgRyF0=:AmazonSES
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/simple; 
 s=zsmsymrwgfyinv5wlfyidntwsjeeldzt; d=codeaurora.org; t=1574465527;
 h=From:To:Cc:Subject:Date:Message-Id:In-Reply-To:References;
 bh=rfMQIX09aLVuJZpR9BABUvuBckJV7gG4dZ0bMVsQ5L4=;
 b=e6XfydXEqeWoFWn7e42s6ccLxAMJrwiqTB6i9pd9iJI/vKVjp7FFr56a4Vl7axIZ
 GoqsYpKv/c5NnfysmqEJc6gjMPTIcGQ/YV2iXdIoInSY3f4ZMGg/6q3mMfbXeIyFp85
 4Q2MbADSStGCoVunPSeFbFG+RuZGogRipQSnFlbM=
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/simple; 
 s=gdwg2y3kokkkj5a55z2ilkup5wp5hhxx; d=amazonses.com; t=1574465527;
 h=From:To:Cc:Subject:Date:Message-Id:In-Reply-To:References:Feedback-ID;
 bh=rfMQIX09aLVuJZpR9BABUvuBckJV7gG4dZ0bMVsQ5L4=;
 b=TSMZaS+Zb21ywy9pZH3eCN/gSv7aOTCgNRy/s/Rpdd190pHaEIXDXJqZuFudY8nT
 MgffLLNc+TeCuKMyw5/G9+GAwU3rwO7A3W2nNlbkhnbVrhoE3ZPTWjOAqAI55Ywn5qC
 UWFrwdfP/4Z/QXNWZy8ZXA4PcW1Cf5WwjewqtoWk=
X-Mailman-Original-Authentication-Results: aws-us-west-2-caf-mail-1.web.codeaurora.org;
 dmarc=none (p=none dis=none) header.from=codeaurora.org
X-Mailman-Original-Authentication-Results: aws-us-west-2-caf-mail-1.web.codeaurora.org;
 spf=none smtp.mailfrom=jcrouse@codeaurora.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jeffrey Hugo <jeffrey.l.hugo@gmail.com>, David Airlie <airlied@linux.ie>,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 AngeloGioacchino Del Regno <kholk11@gmail.com>,
 Sam Ravnborg <sam@ravnborg.org>, Thomas Gleixner <tglx@linutronix.de>,
 Jonathan Marek <jonathan@marek.ca>, will@kernel.org,
 Mamta Shukla <mamtashukla555@gmail.com>, Wen Yang <wen.yang99@zte.com.cn>,
 Ben Dooks <ben.dooks@codethink.co.uk>, linux-arm-kernel@lists.infradead.org,
 Brian Masney <masneyb@onstation.org>, freedreno@lists.freedesktop.org,
 linux-arm-msm@vger.kernel.org, Sharat Masetty <smasetty@codeaurora.org>,
 Bruce Wang <bzwang@chromium.org>, Alexios Zavras <alexios.zavras@intel.com>,
 Sean Paul <sean@poorly.run>, Allison Randal <allison@lohutok.net>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Douglas Anderson <dianders@chromium.org>,
 Drew Davenport <ddavenport@chromium.org>, robin.murphy@arm.com,
 Georgi Djakov <georgi.djakov@linaro.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVmYWN0b3IgaG93IGFkZHJlc3Mgc3BhY2UgaW5pdGlhbGl6YXRpb24gd29ya3MuIEluc3RlYWQg
b2YgaGF2aW5nIHRoZQphZGRyZXNzIHNwYWNlIGZ1bmN0aW9uIGNyZWF0ZSB0aGUgTU1VIG9iamVj
dCAoYW5kIHRodXMgcmVxdWlyZSBzZXBhcmF0ZSBidXQKZXF1YWwgZnVuY3Rpb25zIGZvciBncHVt
bXUgYW5kIGlvbW11KSB1c2UgYSBzaW5nbGUgZnVuY3Rpb24gYW5kIHBhc3MgdGhlCk1NVSBzdHJ1
Y3QgaW4uIE1ha2UgdGhlIGdlbmVyaWMgY29kZSBjbGVhbmVyIGJ5IHVzaW5nIHRhcmdldCBzcGVj
aWZpYwpmdW5jdGlvbnMgdG8gY3JlYXRlIHRoZSBhZGRyZXNzIHNwYWNlIHNvIGEyeHggY2FuIGRv
IGl0cyBvd24gdGhpbmcgaW4gaXRzCm93biBzcGFjZS4gIEZvciBhbGwgdGhlIG90aGVyIHRhcmdl
dHMgdXNlIGEgZ2VuZXJpYyBoZWxwZXIgdG8gaW5pdGlhbGl6ZQpJT01NVSBidXQgbGVhdmUgdGhl
IGRvb3Igb3BlbiBmb3IgbmV3ZXIgdGFyZ2V0cyB0byB1c2UgY3VzdG9taXphdGlvbgppZiB0aGV5
IG5lZWQgaXQuCgpTaWduZWQtb2ZmLWJ5OiBKb3JkYW4gQ3JvdXNlIDxqY3JvdXNlQGNvZGVhdXJv
cmEub3JnPgotLS0KCiBkcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hMnh4X2dwdS5jICAgIHwg
MTYgKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL21zbS9hZHJlbm8vYTN4eF9ncHUuYyAgICB8
ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5vL2E0eHhfZ3B1LmMgICAgfCAgMSArCiBk
cml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hNXh4X2dwdS5jICAgIHwgIDEgKwogZHJpdmVycy9n
cHUvZHJtL21zbS9hZHJlbm8vYTZ4eF9ncHUuYyAgICB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9t
c20vYWRyZW5vL2FkcmVub19ncHUuYyAgfCAyMyArKysrKysrKysrLS0tLQogZHJpdmVycy9ncHUv
ZHJtL21zbS9hZHJlbm8vYWRyZW5vX2dwdS5oICB8ICA4ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0v
bXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMgIHwgMTAgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvbWRwNC9tZHA0X2ttcy5jIHwgMTQgKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvbWRwNS9tZHA1X2NmZy5jIHwgIDQgLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3Av
bWRwNS9tZHA1X2ttcy5jIHwgMTEgKysrKystLQogZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2
LmggICAgICAgICAgICB8ICA4ICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fdm1h
LmMgICAgICAgIHwgNTIgKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9tc20vbXNtX2dwdS5jICAgICAgICAgICAgfCA0MCArKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5oICAgICAgICAgICAgfCAgNCArLS0K
IGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2lvbW11LmMgICAgICAgICAgfCAgMyArKwogMTYgZmls
ZXMgY2hhbmdlZCwgODMgaW5zZXJ0aW9ucygrKSwgMTE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5vL2EyeHhfZ3B1LmMgYi9kcml2ZXJzL2dwdS9k
cm0vbXNtL2FkcmVuby9hMnh4X2dwdS5jCmluZGV4IDFmODNiYzEuLjYwZjY0NzIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5vL2EyeHhfZ3B1LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL21zbS9hZHJlbm8vYTJ4eF9ncHUuYwpAQCAtNDAxLDYgKzQwMSwyMSBAQCBzdGF0aWMg
c3RydWN0IG1zbV9ncHVfc3RhdGUgKmEyeHhfZ3B1X3N0YXRlX2dldChzdHJ1Y3QgbXNtX2dwdSAq
Z3B1KQogCXJldHVybiBzdGF0ZTsKIH0KIAorc3RhdGljIHN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nf
c3BhY2UgKgorYTJ4eF9jcmVhdGVfYWRkcmVzc19zcGFjZShzdHJ1Y3QgbXNtX2dwdSAqZ3B1LCBz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCBtc21fbW11ICptbXUgPSBt
c21fZ3B1bW11X25ldygmcGRldi0+ZGV2LCBncHUpOworCXN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nf
c3BhY2UgKmFzcGFjZTsKKworCWFzcGFjZSA9IG1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVhdGUo
bW11LCAiZ3B1IiwgU1pfMTZNLAorCQlTWl8xNk0gKyAweGZmZiAqIFNaXzY0Syk7CisKKwlpZiAo
SVNfRVJSKGFzcGFjZSkgJiYgIUlTX0VSUihtbXUpKQorCQltbXUtPmZ1bmNzLT5kZXN0cm95KG1t
dSk7CisKKwlyZXR1cm4gYXNwYWNlOworfQorCiAvKiBSZWdpc3RlciBvZmZzZXQgZGVmaW5lcyBm
b3IgQTJYWCAtIGNvcHkgb2YgQTNYWCAqLwogc3RhdGljIGNvbnN0IHVuc2lnbmVkIGludCBhMnh4
X3JlZ2lzdGVyX29mZnNldHNbUkVHX0FEUkVOT19SRUdJU1RFUl9NQVhdID0gewogCVJFR19BRFJF
Tk9fREVGSU5FKFJFR19BRFJFTk9fQ1BfUkJfQkFTRSwgUkVHX0FYWFhfQ1BfUkJfQkFTRSksCkBA
IC00MjksNiArNDQ0LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBhZHJlbm9fZ3B1X2Z1bmNzIGZ1
bmNzID0gewogI2VuZGlmCiAJCS5ncHVfc3RhdGVfZ2V0ID0gYTJ4eF9ncHVfc3RhdGVfZ2V0LAog
CQkuZ3B1X3N0YXRlX3B1dCA9IGFkcmVub19ncHVfc3RhdGVfcHV0LAorCQkuY3JlYXRlX2FkZHJl
c3Nfc3BhY2UgPSBhMnh4X2NyZWF0ZV9hZGRyZXNzX3NwYWNlLAogCX0sCiB9OwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hM3h4X2dwdS5jIGIvZHJpdmVycy9ncHUv
ZHJtL21zbS9hZHJlbm8vYTN4eF9ncHUuYwppbmRleCA3YWQxNDkzLi40MWU1MWUwIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hM3h4X2dwdS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9tc20vYWRyZW5vL2EzeHhfZ3B1LmMKQEAgLTQ0MSw2ICs0NDEsNyBAQCBzdGF0aWMg
Y29uc3Qgc3RydWN0IGFkcmVub19ncHVfZnVuY3MgZnVuY3MgPSB7CiAjZW5kaWYKIAkJLmdwdV9z
dGF0ZV9nZXQgPSBhM3h4X2dwdV9zdGF0ZV9nZXQsCiAJCS5ncHVfc3RhdGVfcHV0ID0gYWRyZW5v
X2dwdV9zdGF0ZV9wdXQsCisJCS5jcmVhdGVfYWRkcmVzc19zcGFjZSA9IGFkcmVub19pb21tdV9j
cmVhdGVfYWRkcmVzc19zcGFjZSwKIAl9LAogfTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9hZHJlbm8vYTR4eF9ncHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5vL2E0
eHhfZ3B1LmMKaW5kZXggYjAxMzg4YS4uMzY1NTQ0MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9hZHJlbm8vYTR4eF9ncHUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVu
by9hNHh4X2dwdS5jCkBAIC01MzIsNiArNTMyLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBhZHJl
bm9fZ3B1X2Z1bmNzIGZ1bmNzID0gewogI2VuZGlmCiAJCS5ncHVfc3RhdGVfZ2V0ID0gYTR4eF9n
cHVfc3RhdGVfZ2V0LAogCQkuZ3B1X3N0YXRlX3B1dCA9IGFkcmVub19ncHVfc3RhdGVfcHV0LAor
CQkuY3JlYXRlX2FkZHJlc3Nfc3BhY2UgPSBhZHJlbm9faW9tbXVfY3JlYXRlX2FkZHJlc3Nfc3Bh
Y2UsCiAJfSwKIAkuZ2V0X3RpbWVzdGFtcCA9IGE0eHhfZ2V0X3RpbWVzdGFtcCwKIH07CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hNXh4X2dwdS5jIGIvZHJpdmVycy9n
cHUvZHJtL21zbS9hZHJlbm8vYTV4eF9ncHUuYwppbmRleCBiMDJlMjA0Li4wZjVkYjcyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hNXh4X2dwdS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9tc20vYWRyZW5vL2E1eHhfZ3B1LmMKQEAgLTE0MzIsNiArMTQzMiw3IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgYWRyZW5vX2dwdV9mdW5jcyBmdW5jcyA9IHsKIAkJLmdwdV9idXN5
ID0gYTV4eF9ncHVfYnVzeSwKIAkJLmdwdV9zdGF0ZV9nZXQgPSBhNXh4X2dwdV9zdGF0ZV9nZXQs
CiAJCS5ncHVfc3RhdGVfcHV0ID0gYTV4eF9ncHVfc3RhdGVfcHV0LAorCQkuY3JlYXRlX2FkZHJl
c3Nfc3BhY2UgPSBhZHJlbm9faW9tbXVfY3JlYXRlX2FkZHJlc3Nfc3BhY2UsCiAJfSwKIAkuZ2V0
X3RpbWVzdGFtcCA9IGE1eHhfZ2V0X3RpbWVzdGFtcCwKIH07CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vbXNtL2FkcmVuby9hNnh4X2dwdS5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9hZHJl
bm8vYTZ4eF9ncHUuYwppbmRleCBkYzhlYzJjLi41ZGMwYjJjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbXNtL2FkcmVuby9hNnh4X2dwdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20v
YWRyZW5vL2E2eHhfZ3B1LmMKQEAgLTgzMiw2ICs4MzIsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGFkcmVub19ncHVfZnVuY3MgZnVuY3MgPSB7CiAjaWYgZGVmaW5lZChDT05GSUdfRFJNX01TTV9H
UFVfU1RBVEUpCiAJCS5ncHVfc3RhdGVfZ2V0ID0gYTZ4eF9ncHVfc3RhdGVfZ2V0LAogCQkuZ3B1
X3N0YXRlX3B1dCA9IGE2eHhfZ3B1X3N0YXRlX3B1dCwKKwkJLmNyZWF0ZV9hZGRyZXNzX3NwYWNl
ID0gYWRyZW5vX2lvbW11X2NyZWF0ZV9hZGRyZXNzX3NwYWNlLAogI2VuZGlmCiAJfSwKIAkuZ2V0
X3RpbWVzdGFtcCA9IGE2eHhfZ2V0X3RpbWVzdGFtcCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tc20vYWRyZW5vL2FkcmVub19ncHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5v
L2FkcmVub19ncHUuYwppbmRleCAwNzgzZTRiLi4wOWM1Nzg5MSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9hZHJlbm8vYWRyZW5vX2dwdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9t
c20vYWRyZW5vL2FkcmVub19ncHUuYwpAQCAtMTU3LDYgKzE1NywyMyBAQCBpbnQgYWRyZW5vX3ph
cF9zaGFkZXJfbG9hZChzdHJ1Y3QgbXNtX2dwdSAqZ3B1LCB1MzIgcGFzaWQpCiAJcmV0dXJuIHph
cF9zaGFkZXJfbG9hZF9tZHQoZ3B1LCBhZHJlbm9fZ3B1LT5pbmZvLT56YXBmdywgcGFzaWQpOwog
fQogCitzdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3NwYWNlICoKK2FkcmVub19pb21tdV9jcmVhdGVf
YWRkcmVzc19zcGFjZShzdHJ1Y3QgbXNtX2dwdSAqZ3B1LAorCQlzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZGV2KQoreworCXN0cnVjdCBpb21tdV9kb21haW4gKmlvbW11ID0gaW9tbXVfZG9tYWlu
X2FsbG9jKCZwbGF0Zm9ybV9idXNfdHlwZSk7CisJc3RydWN0IG1zbV9tbXUgKm1tdSA9IG1zbV9p
b21tdV9uZXcoJnBkZXYtPmRldiwgaW9tbXUpOworCXN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nfc3Bh
Y2UgKmFzcGFjZTsKKworCWFzcGFjZSA9IG1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVhdGUobW11
LCAiZ3B1IiwgU1pfMTZNLAorCQkweGZmZmZmZmYpOworCisJaWYgKElTX0VSUihhc3BhY2UpICYm
ICFJU19FUlIobW11KSkKKwkJbW11LT5mdW5jcy0+ZGVzdHJveShtbXUpOworCisJcmV0dXJuIGFz
cGFjZTsKK30KKwogaW50IGFkcmVub19nZXRfcGFyYW0oc3RydWN0IG1zbV9ncHUgKmdwdSwgdWlu
dDMyX3QgcGFyYW0sIHVpbnQ2NF90ICp2YWx1ZSkKIHsKIAlzdHJ1Y3QgYWRyZW5vX2dwdSAqYWRy
ZW5vX2dwdSA9IHRvX2FkcmVub19ncHUoZ3B1KTsKQEAgLTk0OSwxMiArOTY2LDYgQEAgaW50IGFk
cmVub19ncHVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLCBzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZGV2LAogCiAJYWRyZW5vX2dwdV9jb25maWcuaW9uYW1lID0gImtnc2xfM2QwX3JlZ19t
ZW1vcnkiOwogCi0JYWRyZW5vX2dwdV9jb25maWcudmFfc3RhcnQgPSBTWl8xNk07Ci0JYWRyZW5v
X2dwdV9jb25maWcudmFfZW5kID0gMHhmZmZmZmZmZjsKLQkvKiBtYXhpbXVtIHJhbmdlIG9mIGEy
eHggbW11ICovCi0JaWYgKGFkcmVub19pc19hMnh4KGFkcmVub19ncHUpKQotCQlhZHJlbm9fZ3B1
X2NvbmZpZy52YV9lbmQgPSBTWl8xNk0gKyAweGZmZiAqIFNaXzY0SzsKLQogCWFkcmVub19ncHVf
Y29uZmlnLm5yX3JpbmdzID0gbnJfcmluZ3M7CiAKIAlhZHJlbm9fZ2V0X3B3cmxldmVscygmcGRl
di0+ZGV2LCBncHUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9hZHJlbm8vYWRy
ZW5vX2dwdS5oIGIvZHJpdmVycy9ncHUvZHJtL21zbS9hZHJlbm8vYWRyZW5vX2dwdS5oCmluZGV4
IGU3MWE3NTcuLjVjMWFhMTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vYWRyZW5v
L2FkcmVub19ncHUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hZHJlbm9fZ3B1
LmgKQEAgLTI2Myw2ICsyNjMsMTQgQEAgaW50IGFkcmVub19ncHVfc3RhdGVfZ2V0KHN0cnVjdCBt
c21fZ3B1ICpncHUsIHN0cnVjdCBtc21fZ3B1X3N0YXRlICpzdGF0ZSk7CiBpbnQgYWRyZW5vX2dw
dV9zdGF0ZV9wdXQoc3RydWN0IG1zbV9ncHVfc3RhdGUgKnN0YXRlKTsKIAogLyoKKyAqIENvbW1v
biBoZWxwZXIgZnVuY3Rpb24gdG8gaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBhZGRyZXNzIHNwYWNl
IGZvciBhcm0tc21tdQorICogYXR0YWNoZWQgdGFyZ2V0cworICovCitzdHJ1Y3QgbXNtX2dlbV9h
ZGRyZXNzX3NwYWNlICoKK2FkcmVub19pb21tdV9jcmVhdGVfYWRkcmVzc19zcGFjZShzdHJ1Y3Qg
bXNtX2dwdSAqZ3B1LAorCQlzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKKworLyoKICAq
IEZvciBhNXh4IGFuZCBhNnh4IHRhcmdldHMgbG9hZCB0aGUgemFwIHNoYWRlciB0aGF0IGlzIHVz
ZWQgdG8gcHVsbCB0aGUgR1BVCiAgKiBvdXQgb2Ygc2VjdXJlIG1vZGUKICAqLwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jIGIvZHJpdmVycy9ncHUv
ZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jCmluZGV4IGIwODJiMjMuLjRlNmViYmQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9rbXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMKQEAgLTcwNCwxOCArNzA0LDE4IEBA
IHN0YXRpYyBpbnQgX2RwdV9rbXNfbW11X2luaXQoc3RydWN0IGRwdV9rbXMgKmRwdV9rbXMpCiB7
CiAJc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluOwogCXN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nf
c3BhY2UgKmFzcGFjZTsKKwlzdHJ1Y3QgbXNtX21tdSAqbW11OwogCiAJZG9tYWluID0gaW9tbXVf
ZG9tYWluX2FsbG9jKCZwbGF0Zm9ybV9idXNfdHlwZSk7CiAJaWYgKCFkb21haW4pCiAJCXJldHVy
biAwOwogCi0JZG9tYWluLT5nZW9tZXRyeS5hcGVydHVyZV9zdGFydCA9IDB4MTAwMDsKLQlkb21h
aW4tPmdlb21ldHJ5LmFwZXJ0dXJlX2VuZCA9IDB4ZmZmZmZmZmY7CisJbW11ID0gbXNtX2lvbW11
X25ldyhkcHVfa21zLT5kZXYtPmRldiwgZG9tYWluKTsKKwlhc3BhY2UgPSBtc21fZ2VtX2FkZHJl
c3Nfc3BhY2VfY3JlYXRlKG1tdSwgImRwdTEiLAorCQkweDEwMDAsIDB4ZmZmZmZmZik7CiAKLQlh
c3BhY2UgPSBtc21fZ2VtX2FkZHJlc3Nfc3BhY2VfY3JlYXRlKGRwdV9rbXMtPmRldi0+ZGV2LAot
CQkJZG9tYWluLCAiZHB1MSIpOwogCWlmIChJU19FUlIoYXNwYWNlKSkgewotCQlpb21tdV9kb21h
aW5fZnJlZShkb21haW4pOworCQltbXUtPmZ1bmNzLT5kZXN0cm95KG1tdSk7CiAJCXJldHVybiBQ
VFJfRVJSKGFzcGFjZSk7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rp
c3AvbWRwNC9tZHA0X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDQvbWRwNF9r
bXMuYwppbmRleCA5ZGJhMzdjLi4wODg5NzE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
bXNtL2Rpc3AvbWRwNC9tZHA0X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9t
ZHA0L21kcDRfa21zLmMKQEAgLTUxMCw5ICs1MTAsMTUgQEAgc3RydWN0IG1zbV9rbXMgKm1kcDRf
a21zX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAltZGVsYXkoMTYpOwogCiAJaWYgKGNv
bmZpZy0+aW9tbXUpIHsKLQkJYXNwYWNlID0gbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZSgm
cGRldi0+ZGV2LAotCQkJCWNvbmZpZy0+aW9tbXUsICJtZHA0Iik7CisJCXN0cnVjdCBtc21fbW11
ICptbXUgPSBtc21faW9tbXVfbmV3KCZwZGV2LT5kZXYsCisJCQljb25maWctPmlvbW11KTsKKwor
CQlhc3BhY2UgID0gbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZShtbXUsCisJCQkibWRwNCIs
IDB4MTAwMCwgMHhmZmZmZmZmZik7CisKIAkJaWYgKElTX0VSUihhc3BhY2UpKSB7CisJCQlpZiAo
IUlTX0VSUihtbXUpKQorCQkJCW1tdS0+ZnVuY3MtPmRlc3Ryb3kobW11KTsKIAkJCXJldCA9IFBU
Ul9FUlIoYXNwYWNlKTsKIAkJCWdvdG8gZmFpbDsKIAkJfQpAQCAtNTY1LDEwICs1NzEsNiBAQCBz
dGF0aWMgc3RydWN0IG1kcDRfcGxhdGZvcm1fY29uZmlnICptZHA0X2dldF9jb25maWcoc3RydWN0
IHBsYXRmb3JtX2RldmljZSAqZGV2KQogCS8qIFRPRE86IENoaXBzIHRoYXQgYXJlbid0IGFwcTgw
NjQgaGF2ZSBhIDIwMCBNaHogbWF4X2NsayAqLwogCWNvbmZpZy5tYXhfY2xrID0gMjY2NjY3MDAw
OwogCWNvbmZpZy5pb21tdSA9IGlvbW11X2RvbWFpbl9hbGxvYygmcGxhdGZvcm1fYnVzX3R5cGUp
OwotCWlmIChjb25maWcuaW9tbXUpIHsKLQkJY29uZmlnLmlvbW11LT5nZW9tZXRyeS5hcGVydHVy
ZV9zdGFydCA9IDB4MTAwMDsKLQkJY29uZmlnLmlvbW11LT5nZW9tZXRyeS5hcGVydHVyZV9lbmQg
PSAweGZmZmZmZmZmOwotCX0KIAogCXJldHVybiAmY29uZmlnOwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9jZmcuYyBiL2RyaXZlcnMvZ3B1L2RybS9t
c20vZGlzcC9tZHA1L21kcDVfY2ZnLmMKaW5kZXggMWY0OGY2NC4uZWJkNjUxYSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9jZmcuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vbXNtL2Rpc3AvbWRwNS9tZHA1X2NmZy5jCkBAIC05NDEsMTAgKzk0MSw2IEBAIHN0
YXRpYyBzdHJ1Y3QgbWRwNV9jZmdfcGxhdGZvcm0gKm1kcDVfZ2V0X2NvbmZpZyhzdHJ1Y3QgcGxh
dGZvcm1fZGV2aWNlICpkZXYpCiAJc3RhdGljIHN0cnVjdCBtZHA1X2NmZ19wbGF0Zm9ybSBjb25m
aWcgPSB7fTsKIAogCWNvbmZpZy5pb21tdSA9IGlvbW11X2RvbWFpbl9hbGxvYygmcGxhdGZvcm1f
YnVzX3R5cGUpOwotCWlmIChjb25maWcuaW9tbXUpIHsKLQkJY29uZmlnLmlvbW11LT5nZW9tZXRy
eS5hcGVydHVyZV9zdGFydCA9IDB4MTAwMDsKLQkJY29uZmlnLmlvbW11LT5nZW9tZXRyeS5hcGVy
dHVyZV9lbmQgPSAweGZmZmZmZmZmOwotCX0KIAogCXJldHVybiAmY29uZmlnOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9rbXMuYyBiL2RyaXZlcnMv
Z3B1L2RybS9tc20vZGlzcC9tZHA1L21kcDVfa21zLmMKaW5kZXggNjUzZGFiMi4uMjBiZGZmOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9rbXMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvbWRwNS9tZHA1X2ttcy5jCkBAIC03MjQsMTMgKzcy
NCwyMCBAQCBzdHJ1Y3QgbXNtX2ttcyAqbWRwNV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2KQogCW1kZWxheSgxNik7CiAKIAlpZiAoY29uZmlnLT5wbGF0Zm9ybS5pb21tdSkgeworCQlz
dHJ1Y3QgbXNtX21tdSAqbW11OworCiAJCWlvbW11X2RldiA9ICZwZGV2LT5kZXY7CiAJCWlmICgh
aW9tbXVfZGV2LT5pb21tdV9md3NwZWMpCiAJCQlpb21tdV9kZXYgPSBpb21tdV9kZXYtPnBhcmVu
dDsKIAotCQlhc3BhY2UgPSBtc21fZ2VtX2FkZHJlc3Nfc3BhY2VfY3JlYXRlKGlvbW11X2RldiwK
LQkJCQljb25maWctPnBsYXRmb3JtLmlvbW11LCAibWRwNSIpOworCQltbXUgPSBtc21faW9tbXVf
bmV3KGlvbW11X2RldiwgY29uZmlnLT5wbGF0Zm9ybS5pb21tdSk7CisKKwkJYXNwYWNlID0gbXNt
X2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZShtbXUsICJtZHA1IiwKKwkJCTB4MTAwMCwgMHhmZmZm
ZmZmZik7CisKIAkJaWYgKElTX0VSUihhc3BhY2UpKSB7CisJCQlpZiAoIUlTX0VSUihtbXUpKQor
CQkJCW1tdS0+ZnVuY3MtPmRlc3Ryb3kobW11KTsKIAkJCXJldCA9IFBUUl9FUlIoYXNwYWNlKTsK
IAkJCWdvdG8gZmFpbDsKIAkJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
ZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9kcnYuaAppbmRleCA3MTU0N2U3Li4yMjAz
NzI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9kcnYuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vbXNtL21zbV9kcnYuaApAQCAtMjQ3LDEyICsyNDcsOCBAQCB2b2lkIG1zbV9n
ZW1fY2xvc2Vfdm1hKHN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nfc3BhY2UgKmFzcGFjZSwKIHZvaWQg
bXNtX2dlbV9hZGRyZXNzX3NwYWNlX3B1dChzdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3NwYWNlICph
c3BhY2UpOwogCiBzdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3NwYWNlICoKLW1zbV9nZW1fYWRkcmVz
c19zcGFjZV9jcmVhdGUoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgaW9tbXVfZG9tYWluICpk
b21haW4sCi0JCWNvbnN0IGNoYXIgKm5hbWUpOwotCi1zdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3Nw
YWNlICoKLW1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVhdGVfYTJ4eChzdHJ1Y3QgZGV2aWNlICpk
ZXYsIHN0cnVjdCBtc21fZ3B1ICpncHUsCi0JCWNvbnN0IGNoYXIgKm5hbWUsIHVpbnQ2NF90IHZh
X3N0YXJ0LCB1aW50NjRfdCB2YV9lbmQpOworbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZShz
dHJ1Y3QgbXNtX21tdSAqbW11LCBjb25zdCBjaGFyICpuYW1lLAorCQl1NjQgdmFfc3RhcnQsIHU2
NCB2YV9lbmQpOwogCiBpbnQgbXNtX3JlZ2lzdGVyX21tdShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCBzdHJ1Y3QgbXNtX21tdSAqbW11KTsKIHZvaWQgbXNtX3VucmVnaXN0ZXJfbW11KHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHN0cnVjdCBtc21fbW11ICptbXUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9tc21fZ2VtX3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2Vt
X3ZtYS5jCmluZGV4IDkxZDk5M2EuLjA3NWNlNTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vbXNtX2dlbV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fdm1h
LmMKQEAgLTEyNSw2MyArMTI1LDI1IEBAIGludCBtc21fZ2VtX2luaXRfdm1hKHN0cnVjdCBtc21f
Z2VtX2FkZHJlc3Nfc3BhY2UgKmFzcGFjZSwKIAlyZXR1cm4gMDsKIH0KIAotCiBzdHJ1Y3QgbXNt
X2dlbV9hZGRyZXNzX3NwYWNlICoKLW1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVhdGUoc3RydWN0
IGRldmljZSAqZGV2LCBzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sCi0JCWNvbnN0IGNoYXIg
Km5hbWUpCi17Ci0Jc3RydWN0IG1zbV9nZW1fYWRkcmVzc19zcGFjZSAqYXNwYWNlOwotCXU2NCBz
dGFydCA9IGRvbWFpbi0+Z2VvbWV0cnkuYXBlcnR1cmVfc3RhcnQ7Ci0JdTY0IHNpemUgPSBkb21h
aW4tPmdlb21ldHJ5LmFwZXJ0dXJlX2VuZCAtIHN0YXJ0OwotCi0JYXNwYWNlID0ga3phbGxvYyhz
aXplb2YoKmFzcGFjZSksIEdGUF9LRVJORUwpOwotCWlmICghYXNwYWNlKQotCQlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKLQotCXNwaW5fbG9ja19pbml0KCZhc3BhY2UtPmxvY2spOwotCWFzcGFj
ZS0+bmFtZSA9IG5hbWU7Ci0JYXNwYWNlLT5tbXUgPSBtc21faW9tbXVfbmV3KGRldiwgZG9tYWlu
KTsKLQlpZiAoSVNfRVJSKGFzcGFjZS0+bW11KSkgewotCQlpbnQgcmV0ID0gUFRSX0VSUihhc3Bh
Y2UtPm1tdSk7Ci0KLQkJa2ZyZWUoYXNwYWNlKTsKLQkJcmV0dXJuIEVSUl9QVFIocmV0KTsKLQl9
Ci0KLQkvKgotCSAqIEF0dGFjaGluZyB0aGUgSU9NTVUgZGV2aWNlIGNoYW5nZXMgdGhlIGFwZXJ0
dXJlIHZhbHVlcyBzbyB1c2UgdGhlCi0JICogY2FjaGVkIHZhbHVlcyBpbnN0ZWFkCi0JICovCi0J
ZHJtX21tX2luaXQoJmFzcGFjZS0+bW0sIHN0YXJ0ID4+IFBBR0VfU0hJRlQsIHNpemUgPj4gUEFH
RV9TSElGVCk7Ci0KLQlrcmVmX2luaXQoJmFzcGFjZS0+a3JlZik7Ci0KLQlyZXR1cm4gYXNwYWNl
OwotfQotCi1zdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3NwYWNlICoKLW1zbV9nZW1fYWRkcmVzc19z
cGFjZV9jcmVhdGVfYTJ4eChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBtc21fZ3B1ICpncHUs
Ci0JCWNvbnN0IGNoYXIgKm5hbWUsIHVpbnQ2NF90IHZhX3N0YXJ0LCB1aW50NjRfdCB2YV9lbmQp
Cittc21fZ2VtX2FkZHJlc3Nfc3BhY2VfY3JlYXRlKHN0cnVjdCBtc21fbW11ICptbXUsIGNvbnN0
IGNoYXIgKm5hbWUsCisJCXU2NCB2YV9zdGFydCwgdTY0IHZhX2VuZCkKIHsKIAlzdHJ1Y3QgbXNt
X2dlbV9hZGRyZXNzX3NwYWNlICphc3BhY2U7CiAJdTY0IHNpemUgPSB2YV9lbmQgLSB2YV9zdGFy
dDsKIAorCWlmIChJU19FUlIobW11KSkKKwkJcmV0dXJuIEVSUl9DQVNUKG1tdSk7CisKIAlhc3Bh
Y2UgPSBremFsbG9jKHNpemVvZigqYXNwYWNlKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFhc3BhY2Up
CiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJc3Bpbl9sb2NrX2luaXQoJmFzcGFjZS0+
bG9jayk7CiAJYXNwYWNlLT5uYW1lID0gbmFtZTsKLQlhc3BhY2UtPm1tdSA9IG1zbV9ncHVtbXVf
bmV3KGRldiwgZ3B1KTsKLQlpZiAoSVNfRVJSKGFzcGFjZS0+bW11KSkgewotCQlpbnQgcmV0ID0g
UFRSX0VSUihhc3BhY2UtPm1tdSk7Ci0KLQkJa2ZyZWUoYXNwYWNlKTsKLQkJcmV0dXJuIEVSUl9Q
VFIocmV0KTsKLQl9CisJYXNwYWNlLT5tbXUgPSBtbXU7CiAKLQlkcm1fbW1faW5pdCgmYXNwYWNl
LT5tbSwgKHZhX3N0YXJ0ID4+IFBBR0VfU0hJRlQpLAotCQlzaXplID4+IFBBR0VfU0hJRlQpOwor
CWRybV9tbV9pbml0KCZhc3BhY2UtPm1tLCB2YV9zdGFydCA+PiBQQUdFX1NISUZULCBzaXplID4+
IFBBR0VfU0hJRlQpOwogCiAJa3JlZl9pbml0KCZhc3BhY2UtPmtyZWYpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNt
X2dwdS5jCmluZGV4IGY3YmY4MGUuLmYxMWRmNTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vbXNtX2dwdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5jCkBAIC04
MDMsNDIgKzgwMyw2IEBAIHN0YXRpYyBpbnQgZ2V0X2Nsb2NrcyhzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZGV2LCBzdHJ1Y3QgbXNtX2dwdSAqZ3B1KQogCXJldHVybiAwOwogfQogCi1zdGF0aWMg
c3RydWN0IG1zbV9nZW1fYWRkcmVzc19zcGFjZSAqCi1tc21fZ3B1X2NyZWF0ZV9hZGRyZXNzX3Nw
YWNlKHN0cnVjdCBtc21fZ3B1ICpncHUsIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCi0J
CXVpbnQ2NF90IHZhX3N0YXJ0LCB1aW50NjRfdCB2YV9lbmQpCi17Ci0Jc3RydWN0IG1zbV9nZW1f
YWRkcmVzc19zcGFjZSAqYXNwYWNlOwotCi0JLyoKLQkgKiBTZXR1cCBJT01NVS4uIGV2ZW50dWFs
bHkgd2Ugd2lsbCAoSSB0aGluaykgZG8gdGhpcyBvbmNlIHBlciBjb250ZXh0Ci0JICogYW5kIGhh
dmUgc2VwYXJhdGUgcGFnZSB0YWJsZXMgcGVyIGNvbnRleHQuICBGb3Igbm93LCB0byBrZWVwIHRo
aW5ncwotCSAqIHNpbXBsZSBhbmQgdG8gZ2V0IHNvbWV0aGluZyB3b3JraW5nLCBqdXN0IHVzZSBh
IHNpbmdsZSBhZGRyZXNzIHNwYWNlOgotCSAqLwotCWlmICghYWRyZW5vX2lzX2EyeHgodG9fYWRy
ZW5vX2dwdShncHUpKSkgewotCQlzdHJ1Y3QgaW9tbXVfZG9tYWluICppb21tdSA9IGlvbW11X2Rv
bWFpbl9hbGxvYygmcGxhdGZvcm1fYnVzX3R5cGUpOwotCQlpZiAoIWlvbW11KQotCQkJcmV0dXJu
IE5VTEw7Ci0KLQkJaW9tbXUtPmdlb21ldHJ5LmFwZXJ0dXJlX3N0YXJ0ID0gdmFfc3RhcnQ7Ci0J
CWlvbW11LT5nZW9tZXRyeS5hcGVydHVyZV9lbmQgPSB2YV9lbmQ7Ci0KLQkJRFJNX0RFVl9JTkZP
KGdwdS0+ZGV2LT5kZXYsICIlczogdXNpbmcgSU9NTVVcbiIsIGdwdS0+bmFtZSk7Ci0KLQkJYXNw
YWNlID0gbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZSgmcGRldi0+ZGV2LCBpb21tdSwgImdw
dSIpOwotCQlpZiAoSVNfRVJSKGFzcGFjZSkpCi0JCQlpb21tdV9kb21haW5fZnJlZShpb21tdSk7
Ci0JfSBlbHNlIHsKLQkJYXNwYWNlID0gbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZV9hMnh4
KCZwZGV2LT5kZXYsIGdwdSwgImdwdSIsCi0JCQl2YV9zdGFydCwgdmFfZW5kKTsKLQl9Ci0KLQlp
ZiAoSVNfRVJSKGFzcGFjZSkpCi0JCURSTV9ERVZfRVJST1IoZ3B1LT5kZXYtPmRldiwgImZhaWxl
ZCB0byBpbml0IG1tdTogJWxkXG4iLAotCQkJUFRSX0VSUihhc3BhY2UpKTsKLQotCXJldHVybiBh
c3BhY2U7Ci19Ci0KIGludCBtc21fZ3B1X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwgc3Ry
dWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAkJc3RydWN0IG1zbV9ncHUgKmdwdSwgY29uc3Qg
c3RydWN0IG1zbV9ncHVfZnVuY3MgKmZ1bmNzLAogCQljb25zdCBjaGFyICpuYW1lLCBzdHJ1Y3Qg
bXNtX2dwdV9jb25maWcgKmNvbmZpZykKQEAgLTkxMSw4ICs4NzUsOCBAQCBpbnQgbXNtX2dwdV9p
bml0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYs
CiAKIAltc21fZGV2ZnJlcV9pbml0KGdwdSk7CiAKLQlncHUtPmFzcGFjZSA9IG1zbV9ncHVfY3Jl
YXRlX2FkZHJlc3Nfc3BhY2UoZ3B1LCBwZGV2LAotCQljb25maWctPnZhX3N0YXJ0LCBjb25maWct
PnZhX2VuZCk7CisKKwlncHUtPmFzcGFjZSA9IGdwdS0+ZnVuY3MtPmNyZWF0ZV9hZGRyZXNzX3Nw
YWNlKGdwdSwgcGRldik7CiAKIAlpZiAoZ3B1LT5hc3BhY2UgPT0gTlVMTCkKIAkJRFJNX0RFVl9J
TkZPKGRybS0+ZGV2LCAiJXM6IG5vIElPTU1VLCBmYWxsYmFjayB0byBWUkFNIGNhcnZlb3V0IVxu
IiwgbmFtZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHUuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5oCmluZGV4IGFiOGYwZjljLi40MWQ4NmMyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHUuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vbXNtL21zbV9ncHUuaApAQCAtMjEsOCArMjEsNiBAQCBzdHJ1Y3QgbXNtX2dwdV9zdGF0ZTsK
IAogc3RydWN0IG1zbV9ncHVfY29uZmlnIHsKIAljb25zdCBjaGFyICppb25hbWU7Ci0JdWludDY0
X3QgdmFfc3RhcnQ7Ci0JdWludDY0X3QgdmFfZW5kOwogCXVuc2lnbmVkIGludCBucl9yaW5nczsK
IH07CiAKQEAgLTY0LDYgKzYyLDggQEAgc3RydWN0IG1zbV9ncHVfZnVuY3MgewogCWludCAoKmdw
dV9zdGF0ZV9wdXQpKHN0cnVjdCBtc21fZ3B1X3N0YXRlICpzdGF0ZSk7CiAJdW5zaWduZWQgbG9u
ZyAoKmdwdV9nZXRfZnJlcSkoc3RydWN0IG1zbV9ncHUgKmdwdSk7CiAJdm9pZCAoKmdwdV9zZXRf
ZnJlcSkoc3RydWN0IG1zbV9ncHUgKmdwdSwgdW5zaWduZWQgbG9uZyBmcmVxKTsKKwlzdHJ1Y3Qg
bXNtX2dlbV9hZGRyZXNzX3NwYWNlICooKmNyZWF0ZV9hZGRyZXNzX3NwYWNlKQorCQkoc3RydWN0
IG1zbV9ncHUgKmdwdSwgc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CiB9OwogCiBzdHJ1
Y3QgbXNtX2dwdSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9pb21tdS5j
IGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21faW9tbXUuYwppbmRleCA1NDRjNTE5Li5lNzczZWY4
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9pb21tdS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9tc20vbXNtX2lvbW11LmMKQEAgLTcwLDYgKzcwLDkgQEAgc3RydWN0IG1zbV9t
bXUgKm1zbV9pb21tdV9uZXcoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgaW9tbXVfZG9tYWlu
ICpkb21haW4pCiAJc3RydWN0IG1zbV9pb21tdSAqaW9tbXU7CiAJaW50IHJldDsKIAorCWlmICgh
ZG9tYWluKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PREVWKTsKKwogCWlvbW11ID0ga3phbGxvYyhz
aXplb2YoKmlvbW11KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFpb21tdSkKIAkJcmV0dXJuIEVSUl9Q
VFIoLUVOT01FTSk7Ci0tIAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVs
