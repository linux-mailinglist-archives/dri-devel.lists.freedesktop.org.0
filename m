Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9786961EE3
	for <lists+dri-devel@lfdr.de>; Mon,  8 Jul 2019 14:53:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 53A3F89D4A;
	Mon,  8 Jul 2019 12:53:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF30489D46;
 Mon,  8 Jul 2019 12:53:46 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 08 Jul 2019 05:53:46 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,466,1557212400"; d="scan'208";a="176153951"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga002.jf.intel.com with SMTP; 08 Jul 2019 05:53:43 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 08 Jul 2019 15:53:43 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 06/19] drm/i915: Extract intel_modeset_calc_cdclk()
Date: Mon,  8 Jul 2019 15:53:12 +0300
Message-Id: <20190708125325.16576-7-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190708125325.16576-1-ville.syrjala@linux.intel.com>
References: <20190708125325.16576-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkV4
ZmlsdHJhdGUgdGhlIGNkY2xrIGNvZGUgZnJvbSBpbnRlbF9tb2Rlc2V0X2NoZWNrcygpIGludG8K
aW50ZWxfbW9kZXNldF9jYWxjX2NkY2xrKCkuCgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJqw6Rs
w6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYyAgIHwgMTM1ICsrKysrKysrKysrKysrKysrKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuaCAgIHwgICA2ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDExOSArLS0tLS0tLS0t
LS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDEzNSBpbnNlcnRpb25zKCspLCAxMjUgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNs
ay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jCmluZGV4IDBi
OGI4YWUzYjdmYy4uYzdjNDZiMzgyNzM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9jZGNsay5jCkBAIC0yMSw2ICsyMSw3IEBACiAgKiBERUFMSU5HUyBJTiBUSEUgU09G
VFdBUkUuCiAgKi8KIAorI2luY2x1ZGUgImludGVsX2F0b21pYy5oIgogI2luY2x1ZGUgImludGVs
X2NkY2xrLmgiCiAjaW5jbHVkZSAiaW50ZWxfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxfc2lkZWJh
bmQuaCIKQEAgLTIwODEsOSArMjA4Miw5IEBAIGJvb2wgaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNl
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmEsCiAgKiBSZXR1cm5zOgogICogVHJ1
ZSBpZiB0aGUgQ0RDTEsgc3RhdGVzIHJlcXVpcmUganVzdCBhIGNkMnggZGl2aWRlciB1cGRhdGUs
IGZhbHNlIGlmIG5vdC4KICAqLwotYm9vbCBpbnRlbF9jZGNsa19uZWVkc19jZDJ4X3VwZGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJICAgY29uc3Qgc3RydWN0IGlu
dGVsX2NkY2xrX3N0YXRlICphLAotCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0
ZSAqYikKK3N0YXRpYyBib29sIGludGVsX2NkY2xrX25lZWRzX2NkMnhfdXBkYXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2Rj
bGtfc3RhdGUgKmEsCisJCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpiKQog
ewogCS8qIE9sZGVyIGh3IGRvZXNuJ3QgaGF2ZSB0aGUgY2FwYWJpbGl0eSAqLwogCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpIDwgMTAgJiYgIUlTX0dFTjlfTFAoZGV2X3ByaXYpKQpAQCAtMjEwMiw4
ICsyMTAzLDggQEAgYm9vbCBpbnRlbF9jZGNsa19uZWVkc19jZDJ4X3VwZGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBSZXR1cm5zOgogICogVHJ1ZSBpZiB0aGUgQ0RD
TEsgc3RhdGVzIGRvbid0IG1hdGNoLCBmYWxzZSBpZiB0aGV5IGRvLgogICovCi1ib29sIGludGVs
X2NkY2xrX2NoYW5nZWQoY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLAotCQkJIGNv
bnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYikKK3N0YXRpYyBib29sIGludGVsX2NkY2xr
X2NoYW5nZWQoY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLAorCQkJCWNvbnN0IHN0
cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYikKIHsKIAlyZXR1cm4gaW50ZWxfY2RjbGtfbmVlZHNf
bW9kZXNldChhLCBiKSB8fAogCQlhLT52b2x0YWdlX2xldmVsICE9IGItPnZvbHRhZ2VfbGV2ZWw7
CkBAIC0yNTU2LDYgKzI1NTcsNjIgQEAgc3RhdGljIGludCBjbmxfbW9kZXNldF9jYWxjX2NkY2xr
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCXJldHVybiAwOwogfQogCitzdGF0
aWMgaW50IGludGVsX2xvY2tfYWxsX3BpcGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3Rh
dGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKworCS8qIEFkZCBhbGwg
cGlwZXMgdG8gdGhlIHN0YXRlICovCisJZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRy
bSwgY3J0YykgeworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKworCQlj
cnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY3J0
Yyk7CisJCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0
YXRlKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2Fs
bF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGM7CisKKwkvKgorCSAqIEFkZCBhbGwgcGlwZXMgdG8gdGhlIHN0
YXRlLCBhbmQgZm9yY2UKKwkgKiBhIG1vZGVzZXQgb24gYWxsIHRoZSBhY3RpdmUgb25lcy4KKwkg
Ki8KKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7CisJCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCQlpbnQgcmV0OworCisJCWNydGNfc3Rh
dGUgPSBpbnRlbF9hdG9taWNfZ2V0X2NydGNfc3RhdGUoJnN0YXRlLT5iYXNlLCBjcnRjKTsKKwkJ
aWYgKElTX0VSUihjcnRjX3N0YXRlKSkKKwkJCXJldHVybiBQVFJfRVJSKGNydGNfc3RhdGUpOwor
CisJCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJICAgIGRybV9hdG9taWNfY3J0
Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNlKSkKKwkJCWNvbnRpbnVlOworCisJCWNy
dGNfc3RhdGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKworCQlyZXQgPSBkcm1fYXRvbWlj
X2FkZF9hZmZlY3RlZF9jb25uZWN0b3JzKCZzdGF0ZS0+YmFzZSwKKwkJCQkJCQkgJmNydGMtPmJh
c2UpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlyZXQgPSBkcm1fYXRvbWljX2Fk
ZF9hZmZlY3RlZF9wbGFuZXMoJnN0YXRlLT5iYXNlLAorCQkJCQkJICAgICAmY3J0Yy0+YmFzZSk7
CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCisJCWNydGNfc3RhdGUtPnVwZGF0ZV9wbGFu
ZXMgfD0gY3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lczsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwog
c3RhdGljIGludCBpY2xfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoc3RhdGUtPmJhc2UuZGV2KTsKQEAgLTI1OTAsNiArMjY0Nyw3NCBAQCBzdGF0aWMgaW50IGlj
bF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
cmV0dXJuIDA7CiB9CiAKK2ludCBpbnRlbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCWVudW0gcGlwZSBwaXBlOworCWludCBy
ZXQ7CisKKwlpZiAoIWRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsaykKKwkJcmV0
dXJuIDA7CisKKwlyZXQgPSBkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsoc3Rh
dGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKgorCSAqIFdyaXRlcyB0byBkZXZf
cHJpdi0+Y2RjbGsubG9naWNhbCBtdXN0IHByb3RlY3RlZCBieQorCSAqIGhvbGRpbmcgYWxsIHRo
ZSBjcnRjIGxvY2tzLCBldmVuIGlmIHdlIGRvbid0IGVuZCB1cAorCSAqIHRvdWNoaW5nIHRoZSBo
YXJkd2FyZQorCSAqLworCWlmIChpbnRlbF9jZGNsa19jaGFuZ2VkKCZkZXZfcHJpdi0+Y2RjbGsu
bG9naWNhbCwKKwkJCQkmc3RhdGUtPmNkY2xrLmxvZ2ljYWwpKSB7CisJCXJldCA9IGludGVsX2xv
Y2tfYWxsX3BpcGVzKHN0YXRlKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0OworCX0K
KworCWlmIChpc19wb3dlcl9vZl8yKHN0YXRlLT5hY3RpdmVfY3J0Y3MpKSB7CisJCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjOworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsK
KworCQlwaXBlID0gaWxvZzIoc3RhdGUtPmFjdGl2ZV9jcnRjcyk7CisJCWNydGMgPSBpbnRlbF9n
ZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJCWNydGNfc3RhdGUgPSBpbnRlbF9h
dG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwkJaWYgKGNydGNfc3RhdGUg
JiYKKwkJICAgIGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNl
KSkKKwkJCXBpcGUgPSBJTlZBTElEX1BJUEU7CisJfSBlbHNlIHsKKwkJcGlwZSA9IElOVkFMSURf
UElQRTsKKwl9CisKKwkvKiBBbGwgcGlwZXMgbXVzdCBiZSBzd2l0Y2hlZCBvZmYgd2hpbGUgd2Ug
Y2hhbmdlIHRoZSBjZGNsay4gKi8KKwlpZiAocGlwZSAhPSBJTlZBTElEX1BJUEUgJiYKKwkgICAg
aW50ZWxfY2RjbGtfbmVlZHNfY2QyeF91cGRhdGUoZGV2X3ByaXYsCisJCQkJCSAgJmRldl9wcml2
LT5jZGNsay5hY3R1YWwsCisJCQkJCSAgJnN0YXRlLT5jZGNsay5hY3R1YWwpKSB7CisJCXJldCA9
IGludGVsX2xvY2tfYWxsX3BpcGVzKHN0YXRlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7
CisKKwkJc3RhdGUtPmNkY2xrLnBpcGUgPSBwaXBlOworCX0gZWxzZSBpZiAoaW50ZWxfY2RjbGtf
bmVlZHNfbW9kZXNldCgmZGV2X3ByaXYtPmNkY2xrLmFjdHVhbCwKKwkJCQkJICAgICAmc3RhdGUt
PmNkY2xrLmFjdHVhbCkpIHsKKwkJcmV0ID0gaW50ZWxfbW9kZXNldF9hbGxfcGlwZXMoc3RhdGUp
OworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlzdGF0ZS0+Y2RjbGsucGlwZSA9IElO
VkFMSURfUElQRTsKKwl9CisKKwlEUk1fREVCVUdfS01TKCJOZXcgY2RjbGsgY2FsY3VsYXRlZCB0
byBiZSBsb2dpY2FsICV1IGtIeiwgYWN0dWFsICV1IGtIelxuIiwKKwkJICAgICAgc3RhdGUtPmNk
Y2xrLmxvZ2ljYWwuY2RjbGssCisJCSAgICAgIHN0YXRlLT5jZGNsay5hY3R1YWwuY2RjbGspOwor
CURSTV9ERUJVR19LTVMoIk5ldyB2b2x0YWdlIGxldmVsIGNhbGN1bGF0ZWQgdG8gYmUgbG9naWNh
bCAldSwgYWN0dWFsICV1XG4iLAorCQkgICAgICBzdGF0ZS0+Y2RjbGsubG9naWNhbC52b2x0YWdl
X2xldmVsLAorCQkgICAgICBzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwpOworCisJ
cmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgaW50ZWxfY29tcHV0ZV9tYXhfZG90Y2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlpbnQgbWF4X2NkY2xrX2ZyZXEgPSBk
ZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NkY2xrLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2NkY2xrLmgKaW5kZXggNGQ2ZjdmNWY4OTMwLi5iMzk2OGZjNzZkMGMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmgKQEAgLTIyLDEzICsyMiw4IEBAIHZv
aWQgaW50ZWxfaW5pdF9jZGNsa19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpOwogdm9pZCBpbnRlbF91cGRhdGVfbWF4X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7CiB2b2lkIGludGVsX3VwZGF0ZV9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpbnRlbF91cGRhdGVfcmF3Y2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGludGVsX2NkY2xrX25lZWRzX2NkMnhfdXBkYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY2RjbGtfc3RhdGUgKmEsCi0JCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0
YXRlICpiKTsKIGJvb2wgaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldChjb25zdCBzdHJ1Y3QgaW50
ZWxfY2RjbGtfc3RhdGUgKmEsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0
YXRlICpiKTsKLWJvb2wgaW50ZWxfY2RjbGtfY2hhbmdlZChjb25zdCBzdHJ1Y3QgaW50ZWxfY2Rj
bGtfc3RhdGUgKmEsCi0JCQkgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpiKTsKIHZv
aWQgaW50ZWxfY2RjbGtfc3dhcF9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSk7CiB2b2lkCiBpbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC00Miw1ICszNyw2IEBAIGludGVsX3NldF9jZGNsa19w
b3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJ
ICBlbnVtIHBpcGUgcGlwZSk7CiB2b2lkIGludGVsX2R1bXBfY2RjbGtfc3RhdGUoY29uc3Qgc3Ry
dWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSwKIAkJCSAgICBjb25zdCBjaGFyICpj
b250ZXh0KTsKK2ludCBpbnRlbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUpOwogCiAjZW5kaWYgLyogX19JTlRFTF9DRENMS19IX18gKi8KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggMmI4YTZhODQ2
MDVjLi4zZWZlNzZjMmVjMzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC0xMzM3NCw2MSArMTMzNzQsMTIgQEAgc3RhdGljIGludCBoYXN3ZWxs
X21vZGVfc2V0X3BsYW5lc193b3JrYXJvdW5kKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGludGVsX2xvY2tfYWxsX3BpcGVzKHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7
Ci0KLQkvKiBBZGQgYWxsIHBpcGVzIHRvIHRoZSBzdGF0ZSAqLwotCWZvcl9lYWNoX2NydGMoc3Rh
dGUtPmRldiwgY3J0YykgewotCQlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0K
LQkJY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwot
CQlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKQotCQkJcmV0dXJuIFBUUl9FUlIoY3J0Y19zdGF0ZSk7
Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaW50ZWxfbW9kZXNldF9hbGxfcGlw
ZXMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQotewotCXN0cnVjdCBkcm1fY3J0YyAq
Y3J0YzsKLQotCS8qCi0JICogQWRkIGFsbCBwaXBlcyB0byB0aGUgc3RhdGUsIGFuZCBmb3JjZQot
CSAqIGEgbW9kZXNldCBvbiBhbGwgdGhlIGFjdGl2ZSBvbmVzLgotCSAqLwotCWZvcl9lYWNoX2Ny
dGMoc3RhdGUtPmRldiwgY3J0YykgewotCQlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGU7Ci0JCWludCByZXQ7Ci0KLQkJY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2NydGNfc3Rh
dGUoc3RhdGUsIGNydGMpOwotCQlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKQotCQkJcmV0dXJuIFBU
Ul9FUlIoY3J0Y19zdGF0ZSk7Ci0KLQkJaWYgKCFjcnRjX3N0YXRlLT5hY3RpdmUgfHwgbmVlZHNf
bW9kZXNldCh0b19pbnRlbF9jcnRjX3N0YXRlKGNydGNfc3RhdGUpKSkKLQkJCWNvbnRpbnVlOwot
Ci0JCWNydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRydWU7Ci0KLQkJcmV0ID0gZHJtX2F0b21p
Y19hZGRfYWZmZWN0ZWRfY29ubmVjdG9ycyhzdGF0ZSwgY3J0Yyk7Ci0JCWlmIChyZXQpCi0JCQly
ZXR1cm4gcmV0OwotCi0JCXJldCA9IGRybV9hdG9taWNfYWRkX2FmZmVjdGVkX3BsYW5lcyhzdGF0
ZSwgY3J0Yyk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCXJldHVybiAwOwot
fQotCiBzdGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKLQlp
bnQgcmV0ID0gMCwgaTsKKwlpbnQgcmV0LCBpOwogCiAJaWYgKCFjaGVja19kaWdpdGFsX3BvcnRf
Y29uZmxpY3RzKHN0YXRlKSkgewogCQlEUk1fREVCVUdfS01TKCJyZWplY3RpbmcgY29uZmxpY3Rp
bmcgZGlnaXRhbCBwb3J0IGNvbmZpZ3VyYXRpb25cbiIpOwpAQCAtMTM0NTYsNzEgKzEzNDA3LDkg
QEAgc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2NoZWNrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAkJCXN0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzIHw9IGRybV9jcnRjX21h
c2soJmNydGMtPmJhc2UpOwogCX0KIAotCS8qCi0JICogU2VlIGlmIHRoZSBjb25maWcgcmVxdWly
ZXMgYW55IGFkZGl0aW9uYWwgcHJlcGFyYXRpb24sIGUuZy4KLQkgKiB0byBhZGp1c3QgZ2xvYmFs
IHN0YXRlIHdpdGggcGlwZXMgb2ZmLiAgV2UgbmVlZCB0byBkbyB0aGlzCi0JICogaGVyZSBzbyB3
ZSBjYW4gZ2V0IHRoZSBtb2Rlc2V0X3BpcGUgdXBkYXRlZCBjb25maWcgZm9yIHRoZSBuZXcKLQkg
KiBtb2RlIHNldCBvbiB0aGlzIGNydGMuICBGb3Igb3RoZXIgY3J0Y3Mgd2UgbmVlZCB0byB1c2Ug
dGhlCi0JICogYWRqdXN0ZWRfbW9kZSBiaXRzIGluIHRoZSBjcnRjIGRpcmVjdGx5LgotCSAqLwot
CWlmIChkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGspIHsKLQkJZW51bSBwaXBl
IHBpcGU7Ci0KLQkJcmV0ID0gZGV2X3ByaXYtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrKHN0
YXRlKTsKLQkJaWYgKHJldCA8IDApCi0JCQlyZXR1cm4gcmV0OwotCi0JCS8qCi0JCSAqIFdyaXRl
cyB0byBkZXZfcHJpdi0+Y2RjbGsubG9naWNhbCBtdXN0IHByb3RlY3RlZCBieQotCQkgKiBob2xk
aW5nIGFsbCB0aGUgY3J0YyBsb2NrcywgZXZlbiBpZiB3ZSBkb24ndCBlbmQgdXAKLQkJICogdG91
Y2hpbmcgdGhlIGhhcmR3YXJlCi0JCSAqLwotCQlpZiAoaW50ZWxfY2RjbGtfY2hhbmdlZCgmZGV2
X3ByaXYtPmNkY2xrLmxvZ2ljYWwsCi0JCQkJCSZzdGF0ZS0+Y2RjbGsubG9naWNhbCkpIHsKLQkJ
CXJldCA9IGludGVsX2xvY2tfYWxsX3BpcGVzKCZzdGF0ZS0+YmFzZSk7Ci0JCQlpZiAocmV0IDwg
MCkKLQkJCQlyZXR1cm4gcmV0OwotCQl9Ci0KLQkJaWYgKGlzX3Bvd2VyX29mXzIoc3RhdGUtPmFj
dGl2ZV9jcnRjcykpIHsKLQkJCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwotCQkJc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0KLQkJCXBpcGUgPSBpbG9nMihzdGF0ZS0+YWN0
aXZlX2NydGNzKTsKLQkJCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwg
cGlwZSk7Ci0JCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShz
dGF0ZSwgY3J0Yyk7Ci0JCQlpZiAoY3J0Y19zdGF0ZSAmJiBuZWVkc19tb2Rlc2V0KGNydGNfc3Rh
dGUpKQotCQkJCXBpcGUgPSBJTlZBTElEX1BJUEU7Ci0JCX0gZWxzZSB7Ci0JCQlwaXBlID0gSU5W
QUxJRF9QSVBFOwotCQl9Ci0KLQkJLyogQWxsIHBpcGVzIG11c3QgYmUgc3dpdGNoZWQgb2ZmIHdo
aWxlIHdlIGNoYW5nZSB0aGUgY2RjbGsuICovCi0JCWlmIChwaXBlICE9IElOVkFMSURfUElQRSAm
JgotCQkgICAgaW50ZWxfY2RjbGtfbmVlZHNfY2QyeF91cGRhdGUoZGV2X3ByaXYsCi0JCQkJCQkg
ICZkZXZfcHJpdi0+Y2RjbGsuYWN0dWFsLAotCQkJCQkJICAmc3RhdGUtPmNkY2xrLmFjdHVhbCkp
IHsKLQkJCXJldCA9IGludGVsX2xvY2tfYWxsX3BpcGVzKCZzdGF0ZS0+YmFzZSk7Ci0JCQlpZiAo
cmV0IDwgMCkKLQkJCQlyZXR1cm4gcmV0OwotCi0JCQlzdGF0ZS0+Y2RjbGsucGlwZSA9IHBpcGU7
Ci0JCX0gZWxzZSBpZiAoaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldCgmZGV2X3ByaXYtPmNkY2xr
LmFjdHVhbCwKLQkJCQkJCSAgICAgJnN0YXRlLT5jZGNsay5hY3R1YWwpKSB7Ci0JCQlyZXQgPSBp
bnRlbF9tb2Rlc2V0X2FsbF9waXBlcygmc3RhdGUtPmJhc2UpOwotCQkJaWYgKHJldCA8IDApCi0J
CQkJcmV0dXJuIHJldDsKLQotCQkJc3RhdGUtPmNkY2xrLnBpcGUgPSBJTlZBTElEX1BJUEU7Ci0J
CX0KLQotCQlEUk1fREVCVUdfS01TKCJOZXcgY2RjbGsgY2FsY3VsYXRlZCB0byBiZSBsb2dpY2Fs
ICV1IGtIeiwgYWN0dWFsICV1IGtIelxuIiwKLQkJCSAgICAgIHN0YXRlLT5jZGNsay5sb2dpY2Fs
LmNkY2xrLAotCQkJICAgICAgc3RhdGUtPmNkY2xrLmFjdHVhbC5jZGNsayk7Ci0JCURSTV9ERUJV
R19LTVMoIk5ldyB2b2x0YWdlIGxldmVsIGNhbGN1bGF0ZWQgdG8gYmUgbG9naWNhbCAldSwgYWN0
dWFsICV1XG4iLAotCQkJICAgICAgc3RhdGUtPmNkY2xrLmxvZ2ljYWwudm9sdGFnZV9sZXZlbCwK
LQkJCSAgICAgIHN0YXRlLT5jZGNsay5hY3R1YWwudm9sdGFnZV9sZXZlbCk7Ci0JfQorCXJldCA9
IGludGVsX21vZGVzZXRfY2FsY19jZGNsayhzdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKIAogCWludGVsX21vZGVzZXRfY2xlYXJfcGxscyhzdGF0ZSk7CiAKLS0gCjIuMjEuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
