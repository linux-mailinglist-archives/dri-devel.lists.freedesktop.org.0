Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3D5311790B
	for <lists+dri-devel@lfdr.de>; Wed,  8 May 2019 14:06:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2A884896B5;
	Wed,  8 May 2019 12:05:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 709F889622
 for <dri-devel@lists.freedesktop.org>; Wed,  8 May 2019 12:05:54 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16489690-1500050 
 for multiple; Wed, 08 May 2019 13:05:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 2/2] dma-fence: Refactor signaling for manual invocation
Date: Wed,  8 May 2019 13:05:42 +0100
Message-Id: <20190508120542.28377-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508120542.28377-1-chris@chris-wilson.co.uk>
References: <20190508120542.28377-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TW92ZSB0aGUgZHVwbGljYXRlZCBjb2RlIHdpdGhpbiBkbWEtZmVuY2UuYyBpbnRvIHRoZSBoZWFk
ZXIgZm9yIHdpZGVyCnJldXNlLiBJbiB0aGUgcHJvY2VzcyBhcHBseSBhIHNtYWxsIG1pY3JvLW9w
dGltaXNhdGlvbiB0byBvbmx5IHBydW5lIHRoZQpmZW5jZS0+Y2JfbGlzdCBvbmNlIHJhdGhlciB0
aGFuIHVzZSBsaXN0X2RlbCBvbiBldmVyeSBlbnRyeS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTogVHZydGtvIFVyc3Vs
aW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2RtYS1idWYvTWFrZWZp
bGUgICAgICAgICAgICAgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNl
LXRyYWNlLmMgICAgICAgICAgIHwgIDI4ICsrKwogZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS5j
ICAgICAgICAgICAgICAgICB8ICAzMiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2JyZWFkY3J1bWJzLmMgfCAgMzAgLS0tCiBpbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS10eXBlcy5o
ICAgICAgICAgICAgIHwgMjQ4ICsrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvbGludXgvZG1h
LWZlbmNlLmggICAgICAgICAgICAgICAgICAgfCAyNTEgKysrLS0tLS0tLS0tLS0tLS0tLS0KIDYg
ZmlsZXMgY2hhbmdlZCwgMzIxIGluc2VydGlvbnMoKyksIDI3OCBkZWxldGlvbnMoLSkKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLXRyYWNlLmMKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBpbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS10eXBlcy5oCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlIGIvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCmluZGV4
IDFmMDA2ZTA4M2ViOS4uNTZlNTc5ODc4ZjI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYv
TWFrZWZpbGUKKysrIGIvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCkBAIC0xLDUgKzEsMTEgQEAK
LW9iai15IDo9IGRtYS1idWYubyBkbWEtZmVuY2UubyBkbWEtZmVuY2UtYXJyYXkubyBkbWEtZmVu
Y2UtY2hhaW4ubyBcCi0JIHJlc2VydmF0aW9uLm8gc2Vxbm8tZmVuY2Uubworb2JqLXkgOj0gXAor
CWRtYS1idWYubyBcCisJZG1hLWZlbmNlLm8gXAorCWRtYS1mZW5jZS1hcnJheS5vIFwKKwlkbWEt
ZmVuY2UtY2hhaW4ubyBcCisJZG1hLWZlbmNlLXRyYWNlLm8gXAorCXJlc2VydmF0aW9uLm8gXAor
CXNlcW5vLWZlbmNlLm8KIG9iai0kKENPTkZJR19TWU5DX0ZJTEUpCQkrPSBzeW5jX2ZpbGUubwog
b2JqLSQoQ09ORklHX1NXX1NZTkMpCQkrPSBzd19zeW5jLm8gc3luY19kZWJ1Zy5vCiBvYmotJChD
T05GSUdfVURNQUJVRikJCSs9IHVkbWFidWYubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVm
L2RtYS1mZW5jZS10cmFjZS5jIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS10cmFjZS5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZWI2ZjI4MmJlNGMwCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS10cmFjZS5jCkBAIC0wLDAg
KzEsMjggQEAKKy8qCisgKiBGZW5jZSBtZWNoYW5pc20gZm9yIGRtYS1idWYgYW5kIHRvIGFsbG93
IGZvciBhc3luY2hyb25vdXMgZG1hIGFjY2VzcworICoKKyAqIENvcHlyaWdodCAoQykgMjAxMiBD
YW5vbmljYWwgTHRkCisgKiBDb3B5cmlnaHQgKEMpIDIwMTIgVGV4YXMgSW5zdHJ1bWVudHMKKyAq
CisgKiBBdXRob3JzOgorICogUm9iIENsYXJrIDxyb2JkY2xhcmtAZ21haWwuY29tPgorICogTWFh
cnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGNhbm9uaWNhbC5jb20+CisgKgorICog
VGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFu
ZC9vciBtb2RpZnkgaXQKKyAqIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVi
bGljIExpY2Vuc2UgdmVyc2lvbiAyIGFzIHB1Ymxpc2hlZCBieQorICogdGhlIEZyZWUgU29mdHdh
cmUgRm91bmRhdGlvbi4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhl
IGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0IFdJVEhPVVQKKyAqIEFOWSBXQVJSQU5U
WTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mIE1FUkNIQU5UQUJJTElUWSBv
cgorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlIEdOVSBHZW5l
cmFsIFB1YmxpYyBMaWNlbnNlIGZvcgorICogbW9yZSBkZXRhaWxzLgorICovCisKKyNpbmNsdWRl
IDxsaW51eC9kbWEtZmVuY2UtdHlwZXMuaD4KKworI2RlZmluZSBDUkVBVEVfVFJBQ0VfUE9JTlRT
CisjaW5jbHVkZSA8dHJhY2UvZXZlbnRzL2RtYV9mZW5jZS5oPgorCitFWFBPUlRfVFJBQ0VQT0lO
VF9TWU1CT0woZG1hX2ZlbmNlX2VtaXQpOworRVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9m
ZW5jZV9lbmFibGVfc2lnbmFsKTsKK0VYUE9SVF9UUkFDRVBPSU5UX1NZTUJPTChkbWFfZmVuY2Vf
c2lnbmFsZWQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS5jIGIvZHJp
dmVycy9kbWEtYnVmL2RtYS1mZW5jZS5jCmluZGV4IDliZjA2MDQyNjE5YS4uODE5NmExNzlmZGMy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMKKysrIGIvZHJpdmVycy9k
bWEtYnVmL2RtYS1mZW5jZS5jCkBAIC0yNCwxMyArMjQsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2Rt
YS1mZW5jZS5oPgogI2luY2x1ZGUgPGxpbnV4L3NjaGVkL3NpZ25hbC5oPgogCi0jZGVmaW5lIENS
RUFURV9UUkFDRV9QT0lOVFMKLSNpbmNsdWRlIDx0cmFjZS9ldmVudHMvZG1hX2ZlbmNlLmg+Ci0K
LUVYUE9SVF9UUkFDRVBPSU5UX1NZTUJPTChkbWFfZmVuY2VfZW1pdCk7Ci1FWFBPUlRfVFJBQ0VQ
T0lOVF9TWU1CT0woZG1hX2ZlbmNlX2VuYWJsZV9zaWduYWwpOwotRVhQT1JUX1RSQUNFUE9JTlRf
U1lNQk9MKGRtYV9mZW5jZV9zaWduYWxlZCk7Ci0KIHN0YXRpYyBERUZJTkVfU1BJTkxPQ0soZG1h
X2ZlbmNlX3N0dWJfbG9jayk7CiBzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSBkbWFfZmVuY2Vfc3R1
YjsKIApAQCAtMTM2LDcgKzEyOSw2IEBAIEVYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX2NvbnRleHRf
YWxsb2MpOwogICovCiBpbnQgZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQoc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpCiB7Ci0Jc3RydWN0IGRtYV9mZW5jZV9jYiAqY3VyLCAqdG1wOwogCWludCByZXQg
PSAwOwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZChmZW5jZS0+bG9jayk7CkBAIC0xNDQsNyArMTM2
LDcgQEAgaW50IGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQogCWlmIChXQVJOX09OKCFmZW5jZSkpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JaWYgKHRlc3Rf
YW5kX3NldF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSkg
eworCWlmICghX19kbWFfZmVuY2Vfc2lnbmFsKGZlbmNlKSkgewogCQlyZXQgPSAtRUlOVkFMOwog
CiAJCS8qCkBAIC0xNTIsMTUgKzE0NCwxMCBAQCBpbnQgZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQo
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAJCSAqIHN0aWxsIHJ1biB0aHJvdWdoIGFsbCBjYWxs
YmFja3MKIAkJICovCiAJfSBlbHNlIHsKLQkJZmVuY2UtPnRpbWVzdGFtcCA9IGt0aW1lX2dldCgp
OwotCQlzZXRfYml0KERNQV9GRU5DRV9GTEFHX1RJTUVTVEFNUF9CSVQsICZmZW5jZS0+ZmxhZ3Mp
OwotCQl0cmFjZV9kbWFfZmVuY2Vfc2lnbmFsZWQoZmVuY2UpOworCQlfX2RtYV9mZW5jZV9zaWdu
YWxfX3RpbWVzdGFtcChmZW5jZSwga3RpbWVfZ2V0KCkpOwogCX0KIAotCWxpc3RfZm9yX2VhY2hf
ZW50cnlfc2FmZShjdXIsIHRtcCwgJmZlbmNlLT5jYl9saXN0LCBub2RlKSB7Ci0JCWxpc3RfZGVs
X2luaXQoJmN1ci0+bm9kZSk7Ci0JCWN1ci0+ZnVuYyhmZW5jZSwgY3VyKTsKLQl9CisJX19kbWFf
ZmVuY2Vfc2lnbmFsX19ub3RpZnkoZmVuY2UpOwogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lN
Qk9MKGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKTsKQEAgLTE4NSwyMSArMTcyLDE0IEBAIGludCBk
bWFfZmVuY2Vfc2lnbmFsKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQogCWlmICghZmVuY2UpCiAJ
CXJldHVybiAtRUlOVkFMOwogCi0JaWYgKHRlc3RfYW5kX3NldF9iaXQoRE1BX0ZFTkNFX0ZMQUdf
U0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSkKKwlpZiAoIV9fZG1hX2ZlbmNlX3NpZ25hbChm
ZW5jZSkpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JZmVuY2UtPnRpbWVzdGFtcCA9IGt0aW1lX2dl
dCgpOwotCXNldF9iaXQoRE1BX0ZFTkNFX0ZMQUdfVElNRVNUQU1QX0JJVCwgJmZlbmNlLT5mbGFn
cyk7Ci0JdHJhY2VfZG1hX2ZlbmNlX3NpZ25hbGVkKGZlbmNlKTsKKwlfX2RtYV9mZW5jZV9zaWdu
YWxfX3RpbWVzdGFtcChmZW5jZSwga3RpbWVfZ2V0KCkpOwogCiAJaWYgKHRlc3RfYml0KERNQV9G
RU5DRV9GTEFHX0VOQUJMRV9TSUdOQUxfQklULCAmZmVuY2UtPmZsYWdzKSkgewotCQlzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NiICpjdXIsICp0bXA7Ci0KIAkJc3Bpbl9sb2NrX2lycXNhdmUoZmVuY2UtPmxv
Y2ssIGZsYWdzKTsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2Ut
PmNiX2xpc3QsIG5vZGUpIHsKLQkJCWxpc3RfZGVsX2luaXQoJmN1ci0+bm9kZSk7Ci0JCQljdXIt
PmZ1bmMoZmVuY2UsIGN1cik7Ci0JCX0KKwkJX19kbWFfZmVuY2Vfc2lnbmFsX19ub3RpZnkoZmVu
Y2UpOwogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CiAJfQog
CXJldHVybiAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJl
YWRjcnVtYnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMK
aW5kZXggYzA5MmJkZjVmMGJmLi5kMWY4NTcyMTAwYzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYwpAQCAtMjMsNyArMjMsNiBAQAogICovCiAKICNpbmNs
dWRlIDxsaW51eC9rdGhyZWFkLmg+Ci0jaW5jbHVkZSA8dHJhY2UvZXZlbnRzL2RtYV9mZW5jZS5o
PgogI2luY2x1ZGUgPHVhcGkvbGludXgvc2NoZWQvdHlwZXMuaD4KIAogI2luY2x1ZGUgImk5MTVf
ZHJ2LmgiCkBAIC05NywzNSArOTYsNiBAQCBjaGVja19zaWduYWxfb3JkZXIoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlyZXR1cm4gdHJ1ZTsKIH0K
IAotc3RhdGljIGJvb2wKLV9fZG1hX2ZlbmNlX3NpZ25hbChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSkKLXsKLQlyZXR1cm4gIXRlc3RfYW5kX3NldF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURf
QklULCAmZmVuY2UtPmZsYWdzKTsKLX0KLQotc3RhdGljIHZvaWQKLV9fZG1hX2ZlbmNlX3NpZ25h
bF9fdGltZXN0YW1wKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBrdGltZV90IHRpbWVzdGFtcCkK
LXsKLQlmZW5jZS0+dGltZXN0YW1wID0gdGltZXN0YW1wOwotCXNldF9iaXQoRE1BX0ZFTkNFX0ZM
QUdfVElNRVNUQU1QX0JJVCwgJmZlbmNlLT5mbGFncyk7Ci0JdHJhY2VfZG1hX2ZlbmNlX3NpZ25h
bGVkKGZlbmNlKTsKLX0KLQotc3RhdGljIHZvaWQKLV9fZG1hX2ZlbmNlX3NpZ25hbF9fbm90aWZ5
KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQotewotCXN0cnVjdCBkbWFfZmVuY2VfY2IgKmN1ciwg
KnRtcDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoZmVuY2UtPmxvY2spOwotCWxvY2tkZXBfYXNz
ZXJ0X2lycXNfZGlzYWJsZWQoKTsKLQotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdXIsIHRt
cCwgJmZlbmNlLT5jYl9saXN0LCBub2RlKSB7Ci0JCUlOSVRfTElTVF9IRUFEKCZjdXItPm5vZGUp
OwotCQljdXItPmZ1bmMoZmVuY2UsIGN1cik7Ci0JfQotCUlOSVRfTElTVF9IRUFEKCZmZW5jZS0+
Y2JfbGlzdCk7Ci19Ci0KIHZvaWQgaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2JyZWFkY3J1bWJzICpi
ID0gJmVuZ2luZS0+YnJlYWRjcnVtYnM7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1m
ZW5jZS10eXBlcy5oIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UtdHlwZXMuaApuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjE4ZTc1MTFjMGVlZAotLS0gL2Rldi9udWxs
CisrKyBiL2luY2x1ZGUvbGludXgvZG1hLWZlbmNlLXR5cGVzLmgKQEAgLTAsMCArMSwyNDggQEAK
Ky8qCisgKiBGZW5jZSBtZWNoYW5pc20gZm9yIGRtYS1idWYgdG8gYWxsb3cgZm9yIGFzeW5jaHJv
bm91cyBkbWEgYWNjZXNzCisgKgorICogQ29weXJpZ2h0IChDKSAyMDEyIENhbm9uaWNhbCBMdGQK
KyAqIENvcHlyaWdodCAoQykgMjAxMiBUZXhhcyBJbnN0cnVtZW50cworICoKKyAqIEF1dGhvcnM6
CisgKiBSb2IgQ2xhcmsgPHJvYmRjbGFya0BnbWFpbC5jb20+CisgKiBNYWFydGVuIExhbmtob3Jz
dCA8bWFhcnRlbi5sYW5raG9yc3RAY2Fub25pY2FsLmNvbT4KKyAqCisgKiBUaGlzIHByb2dyYW0g
aXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeSBp
dAorICogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2
ZXJzaW9uIDIgYXMgcHVibGlzaGVkIGJ5CisgKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9u
LgorICoKKyAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0
IHdpbGwgYmUgdXNlZnVsLCBidXQgV0lUSE9VVAorICogQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2
ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yCisgKiBGSVRORVNT
IEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VIEdlbmVyYWwgUHVibGljIExp
Y2Vuc2UgZm9yCisgKiBtb3JlIGRldGFpbHMuCisgKi8KKworI2lmbmRlZiBfX0xJTlVYX0RNQV9G
RU5DRV9UWVBFU19ICisjZGVmaW5lIF9fTElOVVhfRE1BX0ZFTkNFX1RZUEVTX0gKKworI2luY2x1
ZGUgPGxpbnV4L2tyZWYuaD4KKyNpbmNsdWRlIDxsaW51eC9rdGltZS5oPgorCitzdHJ1Y3QgZG1h
X2ZlbmNlOworc3RydWN0IGRtYV9mZW5jZV9vcHM7CitzdHJ1Y3QgZG1hX2ZlbmNlX2NiOworCisv
KioKKyAqIHN0cnVjdCBkbWFfZmVuY2UgLSBzb2Z0d2FyZSBzeW5jaHJvbml6YXRpb24gcHJpbWl0
aXZlCisgKiBAcmVmY291bnQ6IHJlZmNvdW50IGZvciB0aGlzIGZlbmNlCisgKiBAb3BzOiBkbWFf
ZmVuY2Vfb3BzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGZlbmNlCisgKiBAcmN1OiB1c2VkIGZvciBy
ZWxlYXNpbmcgZmVuY2Ugd2l0aCBrZnJlZV9yY3UKKyAqIEBjYl9saXN0OiBsaXN0IG9mIGFsbCBj
YWxsYmFja3MgdG8gY2FsbAorICogQGxvY2s6IHNwaW5fbG9ja19pcnFzYXZlIHVzZWQgZm9yIGxv
Y2tpbmcKKyAqIEBjb250ZXh0OiBleGVjdXRpb24gY29udGV4dCB0aGlzIGZlbmNlIGJlbG9uZ3Mg
dG8sIHJldHVybmVkIGJ5CisgKiAgICAgICAgICAgZG1hX2ZlbmNlX2NvbnRleHRfYWxsb2MoKQor
ICogQHNlcW5vOiB0aGUgc2VxdWVuY2UgbnVtYmVyIG9mIHRoaXMgZmVuY2UgaW5zaWRlIHRoZSBl
eGVjdXRpb24gY29udGV4dCwKKyAqIGNhbiBiZSBjb21wYXJlZCB0byBkZWNpZGUgd2hpY2ggZmVu
Y2Ugd291bGQgYmUgc2lnbmFsZWQgbGF0ZXIuCisgKiBAZmxhZ3M6IEEgbWFzayBvZiBETUFfRkVO
Q0VfRkxBR18qIGRlZmluZWQgYmVsb3cKKyAqIEB0aW1lc3RhbXA6IFRpbWVzdGFtcCB3aGVuIHRo
ZSBmZW5jZSB3YXMgc2lnbmFsZWQuCisgKiBAZXJyb3I6IE9wdGlvbmFsLCBvbmx5IHZhbGlkIGlm
IDwgMCwgbXVzdCBiZSBzZXQgYmVmb3JlIGNhbGxpbmcKKyAqIGRtYV9mZW5jZV9zaWduYWwsIGlu
ZGljYXRlcyB0aGF0IHRoZSBmZW5jZSBoYXMgY29tcGxldGVkIHdpdGggYW4gZXJyb3IuCisgKgor
ICogdGhlIGZsYWdzIG1lbWJlciBtdXN0IGJlIG1hbmlwdWxhdGVkIGFuZCByZWFkIHVzaW5nIHRo
ZSBhcHByb3ByaWF0ZQorICogYXRvbWljIG9wcyAoYml0XyopLCBzbyB0YWtpbmcgdGhlIHNwaW5s
b2NrIHdpbGwgbm90IGJlIG5lZWRlZCBtb3N0CisgKiBvZiB0aGUgdGltZS4KKyAqCisgKiBETUFf
RkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQgLSBmZW5jZSBpcyBhbHJlYWR5IHNpZ25hbGVkCisgKiBE
TUFfRkVOQ0VfRkxBR19USU1FU1RBTVBfQklUIC0gdGltZXN0YW1wIHJlY29yZGVkIGZvciBmZW5j
ZSBzaWduYWxpbmcKKyAqIERNQV9GRU5DRV9GTEFHX0VOQUJMRV9TSUdOQUxfQklUIC0gZW5hYmxl
X3NpZ25hbGluZyBtaWdodCBoYXZlIGJlZW4gY2FsbGVkCisgKiBETUFfRkVOQ0VfRkxBR19VU0VS
X0JJVFMgLSBzdGFydCBvZiB0aGUgdW51c2VkIGJpdHMsIGNhbiBiZSB1c2VkIGJ5IHRoZQorICog
aW1wbGVtZW50ZXIgb2YgdGhlIGZlbmNlIGZvciBpdHMgb3duIHB1cnBvc2VzLiBDYW4gYmUgdXNl
ZCBpbiBkaWZmZXJlbnQKKyAqIHdheXMgYnkgZGlmZmVyZW50IGZlbmNlIGltcGxlbWVudGVycywg
c28gZG8gbm90IHJlbHkgb24gdGhpcy4KKyAqCisgKiBTaW5jZSBhdG9taWMgYml0b3BzIGFyZSB1
c2VkLCB0aGlzIGlzIG5vdCBndWFyYW50ZWVkIHRvIGJlIHRoZSBjYXNlLgorICogUGFydGljdWxh
cmx5LCBpZiB0aGUgYml0IHdhcyBzZXQsIGJ1dCBkbWFfZmVuY2Vfc2lnbmFsIHdhcyBjYWxsZWQg
cmlnaHQKKyAqIGJlZm9yZSB0aGlzIGJpdCB3YXMgc2V0LCBpdCB3b3VsZCBoYXZlIGJlZW4gYWJs
ZSB0byBzZXQgdGhlCisgKiBETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsIGJlZm9yZSBlbmFi
bGVfc2lnbmFsaW5nIHdhcyBjYWxsZWQuCisgKiBBZGRpbmcgYSBjaGVjayBmb3IgRE1BX0ZFTkNF
X0ZMQUdfU0lHTkFMRURfQklUIGFmdGVyIHNldHRpbmcKKyAqIERNQV9GRU5DRV9GTEFHX0VOQUJM
RV9TSUdOQUxfQklUIGNsb3NlcyB0aGlzIHJhY2UsIGFuZCBtYWtlcyBzdXJlIHRoYXQKKyAqIGFm
dGVyIGRtYV9mZW5jZV9zaWduYWwgd2FzIGNhbGxlZCwgYW55IGVuYWJsZV9zaWduYWxpbmcgY2Fs
bCB3aWxsIGhhdmUgZWl0aGVyCisgKiBiZWVuIGNvbXBsZXRlZCwgb3IgbmV2ZXIgY2FsbGVkIGF0
IGFsbC4KKyAqLworc3RydWN0IGRtYV9mZW5jZSB7CisJc3RydWN0IGtyZWYgcmVmY291bnQ7CisJ
Y29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMgKm9wczsKKwlzdHJ1Y3QgcmN1X2hlYWQgcmN1Owor
CXN0cnVjdCBsaXN0X2hlYWQgY2JfbGlzdDsKKwlzcGlubG9ja190ICpsb2NrOworCXU2NCBjb250
ZXh0OworCXU2NCBzZXFubzsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCWt0aW1lX3QgdGltZXN0
YW1wOworCWludCBlcnJvcjsKK307CisKK2VudW0gZG1hX2ZlbmNlX2ZsYWdfYml0cyB7CisJRE1B
X0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULAorCURNQV9GRU5DRV9GTEFHX1RJTUVTVEFNUF9CSVQs
CisJRE1BX0ZFTkNFX0ZMQUdfRU5BQkxFX1NJR05BTF9CSVQsCisJRE1BX0ZFTkNFX0ZMQUdfVVNF
Ul9CSVRTLCAvKiBtdXN0IGFsd2F5cyBiZSBsYXN0IG1lbWJlciAqLworfTsKKwordHlwZWRlZiB2
b2lkICgqZG1hX2ZlbmNlX2Z1bmNfdCkoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCisJCQkJIHN0
cnVjdCBkbWFfZmVuY2VfY2IgKmNiKTsKKworLyoqCisgKiBzdHJ1Y3QgZG1hX2ZlbmNlX2NiIC0g
Y2FsbGJhY2sgZm9yIGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soKQorICogQG5vZGU6IHVzZWQgYnkg
ZG1hX2ZlbmNlX2FkZF9jYWxsYmFjaygpIHRvIGFwcGVuZCB0aGlzIHN0cnVjdCB0byBmZW5jZTo6
Y2JfbGlzdAorICogQGZ1bmM6IGRtYV9mZW5jZV9mdW5jX3QgdG8gY2FsbAorICoKKyAqIFRoaXMg
c3RydWN0IHdpbGwgYmUgaW5pdGlhbGl6ZWQgYnkgZG1hX2ZlbmNlX2FkZF9jYWxsYmFjaygpLCBh
ZGRpdGlvbmFsCisgKiBkYXRhIGNhbiBiZSBwYXNzZWQgYWxvbmcgYnkgZW1iZWRkaW5nIGRtYV9m
ZW5jZV9jYiBpbiBhbm90aGVyIHN0cnVjdC4KKyAqLworc3RydWN0IGRtYV9mZW5jZV9jYiB7CisJ
c3RydWN0IGxpc3RfaGVhZCBub2RlOworCWRtYV9mZW5jZV9mdW5jX3QgZnVuYzsKK307CisKKy8q
KgorICogc3RydWN0IGRtYV9mZW5jZV9vcHMgLSBvcGVyYXRpb25zIGltcGxlbWVudGVkIGZvciBm
ZW5jZQorICoKKyAqLworc3RydWN0IGRtYV9mZW5jZV9vcHMgeworCS8qKgorCSAqIEB1c2VfNjRi
aXRfc2Vxbm86CisJICoKKwkgKiBUcnVlIGlmIHRoaXMgZG1hX2ZlbmNlIGltcGxlbWVudGF0aW9u
IHVzZXMgNjRiaXQgc2Vxbm8sIGZhbHNlCisJICogb3RoZXJ3aXNlLgorCSAqLworCWJvb2wgdXNl
XzY0Yml0X3NlcW5vOworCisJLyoqCisJICogQGdldF9kcml2ZXJfbmFtZToKKwkgKgorCSAqIFJl
dHVybnMgdGhlIGRyaXZlciBuYW1lLiBUaGlzIGlzIGEgY2FsbGJhY2sgdG8gYWxsb3cgZHJpdmVy
cyB0bworCSAqIGNvbXB1dGUgdGhlIG5hbWUgYXQgcnVudGltZSwgd2l0aG91dCBoYXZpbmcgaXQg
dG8gc3RvcmUgcGVybWFuZW50bHkKKwkgKiBmb3IgZWFjaCBmZW5jZSwgb3IgYnVpbGQgYSBjYWNo
ZSBvZiBzb21lIHNvcnQuCisJICoKKwkgKiBUaGlzIGNhbGxiYWNrIGlzIG1hbmRhdG9yeS4KKwkg
Ki8KKwljb25zdCBjaGFyICogKCpnZXRfZHJpdmVyX25hbWUpKHN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlKTsKKworCS8qKgorCSAqIEBnZXRfdGltZWxpbmVfbmFtZToKKwkgKgorCSAqIFJldHVybiB0
aGUgbmFtZSBvZiB0aGUgY29udGV4dCB0aGlzIGZlbmNlIGJlbG9uZ3MgdG8uIFRoaXMgaXMgYQor
CSAqIGNhbGxiYWNrIHRvIGFsbG93IGRyaXZlcnMgdG8gY29tcHV0ZSB0aGUgbmFtZSBhdCBydW50
aW1lLCB3aXRob3V0CisJICogaGF2aW5nIGl0IHRvIHN0b3JlIHBlcm1hbmVudGx5IGZvciBlYWNo
IGZlbmNlLCBvciBidWlsZCBhIGNhY2hlIG9mCisJICogc29tZSBzb3J0LgorCSAqCisJICogVGhp
cyBjYWxsYmFjayBpcyBtYW5kYXRvcnkuCisJICovCisJY29uc3QgY2hhciAqICgqZ2V0X3RpbWVs
aW5lX25hbWUpKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKKworCS8qKgorCSAqIEBlbmFibGVf
c2lnbmFsaW5nOgorCSAqCisJICogRW5hYmxlIHNvZnR3YXJlIHNpZ25hbGluZyBvZiBmZW5jZS4K
KwkgKgorCSAqIEZvciBmZW5jZSBpbXBsZW1lbnRhdGlvbnMgdGhhdCBoYXZlIHRoZSBjYXBhYmls
aXR5IGZvciBody0+aHcKKwkgKiBzaWduYWxpbmcsIHRoZXkgY2FuIGltcGxlbWVudCB0aGlzIG9w
IHRvIGVuYWJsZSB0aGUgbmVjZXNzYXJ5CisJICogaW50ZXJydXB0cywgb3IgaW5zZXJ0IGNvbW1h
bmRzIGludG8gY21kc3RyZWFtLCBldGMsIHRvIGF2b2lkIHRoZXNlCisJICogY29zdGx5IG9wZXJh
dGlvbnMgZm9yIHRoZSBjb21tb24gY2FzZSB3aGVyZSBvbmx5IGh3LT5odworCSAqIHN5bmNocm9u
aXphdGlvbiBpcyByZXF1aXJlZC4gIFRoaXMgaXMgY2FsbGVkIGluIHRoZSBmaXJzdAorCSAqIGRt
YV9mZW5jZV93YWl0KCkgb3IgZG1hX2ZlbmNlX2FkZF9jYWxsYmFjaygpIHBhdGggdG8gbGV0IHRo
ZSBmZW5jZQorCSAqIGltcGxlbWVudGF0aW9uIGtub3cgdGhhdCB0aGVyZSBpcyBhbm90aGVyIGRy
aXZlciB3YWl0aW5nIG9uIHRoZQorCSAqIHNpZ25hbCAoaWUuIGh3LT5zdyBjYXNlKS4KKwkgKgor
CSAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCBmcm9tIGF0b21pYyBjb250ZXh0LCBidXQg
bm90CisJICogZnJvbSBpcnEgY29udGV4dCwgc28gbm9ybWFsIHNwaW5sb2NrcyBjYW4gYmUgdXNl
ZC4KKwkgKgorCSAqIEEgcmV0dXJuIHZhbHVlIG9mIGZhbHNlIGluZGljYXRlcyB0aGUgZmVuY2Ug
YWxyZWFkeSBwYXNzZWQsCisJICogb3Igc29tZSBmYWlsdXJlIG9jY3VycmVkIHRoYXQgbWFkZSBp
dCBpbXBvc3NpYmxlIHRvIGVuYWJsZQorCSAqIHNpZ25hbGluZy4gVHJ1ZSBpbmRpY2F0ZXMgc3Vj
Y2Vzc2Z1bCBlbmFibGluZy4KKwkgKgorCSAqICZkbWFfZmVuY2UuZXJyb3IgbWF5IGJlIHNldCBp
biBlbmFibGVfc2lnbmFsaW5nLCBidXQgb25seSB3aGVuIGZhbHNlCisJICogaXMgcmV0dXJuZWQu
CisJICoKKwkgKiBTaW5jZSBtYW55IGltcGxlbWVudGF0aW9ucyBjYW4gY2FsbCBkbWFfZmVuY2Vf
c2lnbmFsKCkgZXZlbiB3aGVuIGJlZm9yZQorCSAqIEBlbmFibGVfc2lnbmFsaW5nIGhhcyBiZWVu
IGNhbGxlZCB0aGVyZSdzIGEgcmFjZSB3aW5kb3csIHdoZXJlIHRoZQorCSAqIGRtYV9mZW5jZV9z
aWduYWwoKSBtaWdodCByZXN1bHQgaW4gdGhlIGZpbmFsIGZlbmNlIHJlZmVyZW5jZSBiZWluZwor
CSAqIHJlbGVhc2VkIGFuZCBpdHMgbWVtb3J5IGZyZWVkLiBUbyBhdm9pZCB0aGlzLCBpbXBsZW1l
bnRhdGlvbnMgb2YgdGhpcworCSAqIGNhbGxiYWNrIHNob3VsZCBncmFiIHRoZWlyIG93biByZWZl
cmVuY2UgdXNpbmcgZG1hX2ZlbmNlX2dldCgpLCB0byBiZQorCSAqIHJlbGVhc2VkIHdoZW4gdGhl
IGZlbmNlIGlzIHNpZ25hbGxlZCAodGhyb3VnaCBlLmcuIHRoZSBpbnRlcnJ1cHQKKwkgKiBoYW5k
bGVyKS4KKwkgKgorCSAqIFRoaXMgY2FsbGJhY2sgaXMgb3B0aW9uYWwuIElmIHRoaXMgY2FsbGJh
Y2sgaXMgbm90IHByZXNlbnQsIHRoZW4gdGhlCisJICogZHJpdmVyIG11c3QgYWx3YXlzIGhhdmUg
c2lnbmFsaW5nIGVuYWJsZWQuCisJICovCisJYm9vbCAoKmVuYWJsZV9zaWduYWxpbmcpKHN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlKTsKKworCS8qKgorCSAqIEBzaWduYWxlZDoKKwkgKgorCSAqIFBl
ZWsgd2hldGhlciB0aGUgZmVuY2UgaXMgc2lnbmFsZWQsIGFzIGEgZmFzdHBhdGggb3B0aW1pemF0
aW9uIGZvcgorCSAqIGUuZy4gZG1hX2ZlbmNlX3dhaXQoKSBvciBkbWFfZmVuY2VfYWRkX2NhbGxi
YWNrKCkuIE5vdGUgdGhhdCB0aGlzCisJICogY2FsbGJhY2sgZG9lcyBub3QgbmVlZCB0byBtYWtl
IGFueSBndWFyYW50ZWVzIGJleW9uZCB0aGF0IGEgZmVuY2UKKwkgKiBvbmNlIGluZGljYXRlcyBh
cyBzaWduYWxsZWQgbXVzdCBhbHdheXMgcmV0dXJuIHRydWUgZnJvbSB0aGlzCisJICogY2FsbGJh
Y2suIFRoaXMgY2FsbGJhY2sgbWF5IHJldHVybiBmYWxzZSBldmVuIGlmIHRoZSBmZW5jZSBoYXMK
KwkgKiBjb21wbGV0ZWQgYWxyZWFkeSwgaW4gdGhpcyBjYXNlIGluZm9ybWF0aW9uIGhhc24ndCBw
cm9wb2dhdGVkIHRocm91ZworCSAqIHRoZSBzeXN0ZW0geWV0LiBTZWUgYWxzbyBkbWFfZmVuY2Vf
aXNfc2lnbmFsZWQoKS4KKwkgKgorCSAqIE1heSBzZXQgJmRtYV9mZW5jZS5lcnJvciBpZiByZXR1
cm5pbmcgdHJ1ZS4KKwkgKgorCSAqIFRoaXMgY2FsbGJhY2sgaXMgb3B0aW9uYWwuCisJICovCisJ
Ym9vbCAoKnNpZ25hbGVkKShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CisKKwkvKioKKwkgKiBA
d2FpdDoKKwkgKgorCSAqIEN1c3RvbSB3YWl0IGltcGxlbWVudGF0aW9uLCBkZWZhdWx0cyB0byBk
bWFfZmVuY2VfZGVmYXVsdF93YWl0KCkgaWYKKwkgKiBub3Qgc2V0LgorCSAqCisJICogVGhlIGRt
YV9mZW5jZV9kZWZhdWx0X3dhaXQgaW1wbGVtZW50YXRpb24gc2hvdWxkIHdvcmsgZm9yIGFueSBm
ZW5jZSwgYXMgbG9uZworCSAqIGFzIEBlbmFibGVfc2lnbmFsaW5nIHdvcmtzIGNvcnJlY3RseS4g
VGhpcyBob29rIGFsbG93cyBkcml2ZXJzIHRvCisJICogaGF2ZSBhbiBvcHRpbWl6ZWQgdmVyc2lv
biBmb3IgdGhlIGNhc2Ugd2hlcmUgYSBwcm9jZXNzIGNvbnRleHQgaXMKKwkgKiBhbHJlYWR5IGF2
YWlsYWJsZSwgZS5nLiBpZiBAZW5hYmxlX3NpZ25hbGluZyBmb3IgdGhlIGdlbmVyYWwgY2FzZQor
CSAqIG5lZWRzIHRvIHNldCB1cCBhIHdvcmtlciB0aHJlYWQuCisJICoKKwkgKiBNdXN0IHJldHVy
biAtRVJFU1RBUlRTWVMgaWYgdGhlIHdhaXQgaXMgaW50ciA9IHRydWUgYW5kIHRoZSB3YWl0IHdh
cworCSAqIGludGVycnVwdGVkLCBhbmQgcmVtYWluaW5nIGppZmZpZXMgaWYgZmVuY2UgaGFzIHNp
Z25hbGVkLCBvciAwIGlmIHdhaXQKKwkgKiB0aW1lZCBvdXQuIENhbiBhbHNvIHJldHVybiBvdGhl
ciBlcnJvciB2YWx1ZXMgb24gY3VzdG9tIGltcGxlbWVudGF0aW9ucywKKwkgKiB3aGljaCBzaG91
bGQgYmUgdHJlYXRlZCBhcyBpZiB0aGUgZmVuY2UgaXMgc2lnbmFsZWQuIEZvciBleGFtcGxlIGEg
aGFyZHdhcmUKKwkgKiBsb2NrdXAgY291bGQgYmUgcmVwb3J0ZWQgbGlrZSB0aGF0LgorCSAqCisJ
ICogVGhpcyBjYWxsYmFjayBpcyBvcHRpb25hbC4KKwkgKi8KKwlzaWduZWQgbG9uZyAoKndhaXQp
KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAorCQkJICAgIGJvb2wgaW50ciwgc2lnbmVkIGxvbmcg
dGltZW91dCk7CisKKwkvKioKKwkgKiBAcmVsZWFzZToKKwkgKgorCSAqIENhbGxlZCBvbiBkZXN0
cnVjdGlvbiBvZiBmZW5jZSB0byByZWxlYXNlIGFkZGl0aW9uYWwgcmVzb3VyY2VzLgorCSAqIENh
biBiZSBjYWxsZWQgZnJvbSBpcnEgY29udGV4dC4gIFRoaXMgY2FsbGJhY2sgaXMgb3B0aW9uYWwu
IElmIGl0IGlzCisJICogTlVMTCwgdGhlbiBkbWFfZmVuY2VfZnJlZSgpIGlzIGluc3RlYWQgY2Fs
bGVkIGFzIHRoZSBkZWZhdWx0CisJICogaW1wbGVtZW50YXRpb24uCisJICovCisJdm9pZCAoKnJl
bGVhc2UpKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKKworCS8qKgorCSAqIEBmZW5jZV92YWx1
ZV9zdHI6CisJICoKKwkgKiBDYWxsYmFjayB0byBmaWxsIGluIGZyZWUtZm9ybSBkZWJ1ZyBpbmZv
IHNwZWNpZmljIHRvIHRoaXMgZmVuY2UsIGxpa2UKKwkgKiB0aGUgc2VxdWVuY2UgbnVtYmVyLgor
CSAqCisJICogVGhpcyBjYWxsYmFjayBpcyBvcHRpb25hbC4KKwkgKi8KKwl2b2lkICgqZmVuY2Vf
dmFsdWVfc3RyKShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgY2hhciAqc3RyLCBpbnQgc2l6ZSk7
CisKKwkvKioKKwkgKiBAdGltZWxpbmVfdmFsdWVfc3RyOgorCSAqCisJICogRmlsbHMgaW4gdGhl
IGN1cnJlbnQgdmFsdWUgb2YgdGhlIHRpbWVsaW5lIGFzIGEgc3RyaW5nLCBsaWtlIHRoZQorCSAq
IHNlcXVlbmNlIG51bWJlci4gTm90ZSB0aGF0IHRoZSBzcGVjaWZpYyBmZW5jZSBwYXNzZWQgdG8g
dGhpcyBmdW5jdGlvbgorCSAqIHNob3VsZCBub3QgbWF0dGVyLCBkcml2ZXJzIHNob3VsZCBvbmx5
IHVzZSBpdCB0byBsb29rIHVwIHRoZQorCSAqIGNvcnJlc3BvbmRpbmcgdGltZWxpbmUgc3RydWN0
dXJlcy4KKwkgKi8KKwl2b2lkICgqdGltZWxpbmVfdmFsdWVfc3RyKShzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSwKKwkJCQkgICBjaGFyICpzdHIsIGludCBzaXplKTsKK307CisKKyNlbmRpZiAvKiBf
X0xJTlVYX0RNQV9GRU5DRV9UWVBFU19IICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2Rt
YS1mZW5jZS5oIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaAppbmRleCA5NzQ3MTdkNmFjMGMu
LjE0MmViNjdlNjk1ZiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaAorKysg
Yi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS5oCkBAIC0yMSw2ICsyMSw3IEBACiAjaWZuZGVmIF9f
TElOVVhfRE1BX0ZFTkNFX0gKICNkZWZpbmUgX19MSU5VWF9ETUFfRkVOQ0VfSAogCisjaW5jbHVk
ZSA8bGludXgvZG1hLWZlbmNlLXR5cGVzLmg+CiAjaW5jbHVkZSA8bGludXgvZXJyLmg+CiAjaW5j
bHVkZSA8bGludXgvd2FpdC5oPgogI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KQEAgLTMwLDIyNiAr
MzEsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3ByaW50ay5oPgogI2luY2x1ZGUgPGxpbnV4L3JjdXBk
YXRlLmg+CiAKLXN0cnVjdCBkbWFfZmVuY2U7Ci1zdHJ1Y3QgZG1hX2ZlbmNlX29wczsKLXN0cnVj
dCBkbWFfZmVuY2VfY2I7Ci0KLS8qKgotICogc3RydWN0IGRtYV9mZW5jZSAtIHNvZnR3YXJlIHN5
bmNocm9uaXphdGlvbiBwcmltaXRpdmUKLSAqIEByZWZjb3VudDogcmVmY291bnQgZm9yIHRoaXMg
ZmVuY2UKLSAqIEBvcHM6IGRtYV9mZW5jZV9vcHMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZmVuY2UK
LSAqIEByY3U6IHVzZWQgZm9yIHJlbGVhc2luZyBmZW5jZSB3aXRoIGtmcmVlX3JjdQotICogQGNi
X2xpc3Q6IGxpc3Qgb2YgYWxsIGNhbGxiYWNrcyB0byBjYWxsCi0gKiBAbG9jazogc3Bpbl9sb2Nr
X2lycXNhdmUgdXNlZCBmb3IgbG9ja2luZwotICogQGNvbnRleHQ6IGV4ZWN1dGlvbiBjb250ZXh0
IHRoaXMgZmVuY2UgYmVsb25ncyB0bywgcmV0dXJuZWQgYnkKLSAqICAgICAgICAgICBkbWFfZmVu
Y2VfY29udGV4dF9hbGxvYygpCi0gKiBAc2Vxbm86IHRoZSBzZXF1ZW5jZSBudW1iZXIgb2YgdGhp
cyBmZW5jZSBpbnNpZGUgdGhlIGV4ZWN1dGlvbiBjb250ZXh0LAotICogY2FuIGJlIGNvbXBhcmVk
IHRvIGRlY2lkZSB3aGljaCBmZW5jZSB3b3VsZCBiZSBzaWduYWxlZCBsYXRlci4KLSAqIEBmbGFn
czogQSBtYXNrIG9mIERNQV9GRU5DRV9GTEFHXyogZGVmaW5lZCBiZWxvdwotICogQHRpbWVzdGFt
cDogVGltZXN0YW1wIHdoZW4gdGhlIGZlbmNlIHdhcyBzaWduYWxlZC4KLSAqIEBlcnJvcjogT3B0
aW9uYWwsIG9ubHkgdmFsaWQgaWYgPCAwLCBtdXN0IGJlIHNldCBiZWZvcmUgY2FsbGluZwotICog
ZG1hX2ZlbmNlX3NpZ25hbCwgaW5kaWNhdGVzIHRoYXQgdGhlIGZlbmNlIGhhcyBjb21wbGV0ZWQg
d2l0aCBhbiBlcnJvci4KLSAqCi0gKiB0aGUgZmxhZ3MgbWVtYmVyIG11c3QgYmUgbWFuaXB1bGF0
ZWQgYW5kIHJlYWQgdXNpbmcgdGhlIGFwcHJvcHJpYXRlCi0gKiBhdG9taWMgb3BzIChiaXRfKiks
IHNvIHRha2luZyB0aGUgc3BpbmxvY2sgd2lsbCBub3QgYmUgbmVlZGVkIG1vc3QKLSAqIG9mIHRo
ZSB0aW1lLgotICoKLSAqIERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCAtIGZlbmNlIGlzIGFs
cmVhZHkgc2lnbmFsZWQKLSAqIERNQV9GRU5DRV9GTEFHX1RJTUVTVEFNUF9CSVQgLSB0aW1lc3Rh
bXAgcmVjb3JkZWQgZm9yIGZlbmNlIHNpZ25hbGluZwotICogRE1BX0ZFTkNFX0ZMQUdfRU5BQkxF
X1NJR05BTF9CSVQgLSBlbmFibGVfc2lnbmFsaW5nIG1pZ2h0IGhhdmUgYmVlbiBjYWxsZWQKLSAq
IERNQV9GRU5DRV9GTEFHX1VTRVJfQklUUyAtIHN0YXJ0IG9mIHRoZSB1bnVzZWQgYml0cywgY2Fu
IGJlIHVzZWQgYnkgdGhlCi0gKiBpbXBsZW1lbnRlciBvZiB0aGUgZmVuY2UgZm9yIGl0cyBvd24g
cHVycG9zZXMuIENhbiBiZSB1c2VkIGluIGRpZmZlcmVudAotICogd2F5cyBieSBkaWZmZXJlbnQg
ZmVuY2UgaW1wbGVtZW50ZXJzLCBzbyBkbyBub3QgcmVseSBvbiB0aGlzLgotICoKLSAqIFNpbmNl
IGF0b21pYyBiaXRvcHMgYXJlIHVzZWQsIHRoaXMgaXMgbm90IGd1YXJhbnRlZWQgdG8gYmUgdGhl
IGNhc2UuCi0gKiBQYXJ0aWN1bGFybHksIGlmIHRoZSBiaXQgd2FzIHNldCwgYnV0IGRtYV9mZW5j
ZV9zaWduYWwgd2FzIGNhbGxlZCByaWdodAotICogYmVmb3JlIHRoaXMgYml0IHdhcyBzZXQsIGl0
IHdvdWxkIGhhdmUgYmVlbiBhYmxlIHRvIHNldCB0aGUKLSAqIERNQV9GRU5DRV9GTEFHX1NJR05B
TEVEX0JJVCwgYmVmb3JlIGVuYWJsZV9zaWduYWxpbmcgd2FzIGNhbGxlZC4KLSAqIEFkZGluZyBh
IGNoZWNrIGZvciBETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQgYWZ0ZXIgc2V0dGluZwotICog
RE1BX0ZFTkNFX0ZMQUdfRU5BQkxFX1NJR05BTF9CSVQgY2xvc2VzIHRoaXMgcmFjZSwgYW5kIG1h
a2VzIHN1cmUgdGhhdAotICogYWZ0ZXIgZG1hX2ZlbmNlX3NpZ25hbCB3YXMgY2FsbGVkLCBhbnkg
ZW5hYmxlX3NpZ25hbGluZyBjYWxsIHdpbGwgaGF2ZSBlaXRoZXIKLSAqIGJlZW4gY29tcGxldGVk
LCBvciBuZXZlciBjYWxsZWQgYXQgYWxsLgotICovCi1zdHJ1Y3QgZG1hX2ZlbmNlIHsKLQlzdHJ1
Y3Qga3JlZiByZWZjb3VudDsKLQljb25zdCBzdHJ1Y3QgZG1hX2ZlbmNlX29wcyAqb3BzOwotCXN0
cnVjdCByY3VfaGVhZCByY3U7Ci0Jc3RydWN0IGxpc3RfaGVhZCBjYl9saXN0OwotCXNwaW5sb2Nr
X3QgKmxvY2s7Ci0JdTY0IGNvbnRleHQ7Ci0JdTY0IHNlcW5vOwotCXVuc2lnbmVkIGxvbmcgZmxh
Z3M7Ci0Ja3RpbWVfdCB0aW1lc3RhbXA7Ci0JaW50IGVycm9yOwotfTsKLQotZW51bSBkbWFfZmVu
Y2VfZmxhZ19iaXRzIHsKLQlETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsCi0JRE1BX0ZFTkNF
X0ZMQUdfVElNRVNUQU1QX0JJVCwKLQlETUFfRkVOQ0VfRkxBR19FTkFCTEVfU0lHTkFMX0JJVCwK
LQlETUFfRkVOQ0VfRkxBR19VU0VSX0JJVFMsIC8qIG11c3QgYWx3YXlzIGJlIGxhc3QgbWVtYmVy
ICovCi19OwotCi10eXBlZGVmIHZvaWQgKCpkbWFfZmVuY2VfZnVuY190KShzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZSwKLQkJCQkgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpOwotCi0vKioKLSAqIHN0
cnVjdCBkbWFfZmVuY2VfY2IgLSBjYWxsYmFjayBmb3IgZG1hX2ZlbmNlX2FkZF9jYWxsYmFjaygp
Ci0gKiBAbm9kZTogdXNlZCBieSBkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKCkgdG8gYXBwZW5kIHRo
aXMgc3RydWN0IHRvIGZlbmNlOjpjYl9saXN0Ci0gKiBAZnVuYzogZG1hX2ZlbmNlX2Z1bmNfdCB0
byBjYWxsCi0gKgotICogVGhpcyBzdHJ1Y3Qgd2lsbCBiZSBpbml0aWFsaXplZCBieSBkbWFfZmVu
Y2VfYWRkX2NhbGxiYWNrKCksIGFkZGl0aW9uYWwKLSAqIGRhdGEgY2FuIGJlIHBhc3NlZCBhbG9u
ZyBieSBlbWJlZGRpbmcgZG1hX2ZlbmNlX2NiIGluIGFub3RoZXIgc3RydWN0LgotICovCi1zdHJ1
Y3QgZG1hX2ZlbmNlX2NiIHsKLQlzdHJ1Y3QgbGlzdF9oZWFkIG5vZGU7Ci0JZG1hX2ZlbmNlX2Z1
bmNfdCBmdW5jOwotfTsKLQotLyoqCi0gKiBzdHJ1Y3QgZG1hX2ZlbmNlX29wcyAtIG9wZXJhdGlv
bnMgaW1wbGVtZW50ZWQgZm9yIGZlbmNlCi0gKgotICovCi1zdHJ1Y3QgZG1hX2ZlbmNlX29wcyB7
Ci0JLyoqCi0JICogQHVzZV82NGJpdF9zZXFubzoKLQkgKgotCSAqIFRydWUgaWYgdGhpcyBkbWFf
ZmVuY2UgaW1wbGVtZW50YXRpb24gdXNlcyA2NGJpdCBzZXFubywgZmFsc2UKLQkgKiBvdGhlcndp
c2UuCi0JICovCi0JYm9vbCB1c2VfNjRiaXRfc2Vxbm87Ci0KLQkvKioKLQkgKiBAZ2V0X2RyaXZl
cl9uYW1lOgotCSAqCi0JICogUmV0dXJucyB0aGUgZHJpdmVyIG5hbWUuIFRoaXMgaXMgYSBjYWxs
YmFjayB0byBhbGxvdyBkcml2ZXJzIHRvCi0JICogY29tcHV0ZSB0aGUgbmFtZSBhdCBydW50aW1l
LCB3aXRob3V0IGhhdmluZyBpdCB0byBzdG9yZSBwZXJtYW5lbnRseQotCSAqIGZvciBlYWNoIGZl
bmNlLCBvciBidWlsZCBhIGNhY2hlIG9mIHNvbWUgc29ydC4KLQkgKgotCSAqIFRoaXMgY2FsbGJh
Y2sgaXMgbWFuZGF0b3J5LgotCSAqLwotCWNvbnN0IGNoYXIgKiAoKmdldF9kcml2ZXJfbmFtZSko
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwotCi0JLyoqCi0JICogQGdldF90aW1lbGluZV9uYW1l
OgotCSAqCi0JICogUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBjb250ZXh0IHRoaXMgZmVuY2UgYmVs
b25ncyB0by4gVGhpcyBpcyBhCi0JICogY2FsbGJhY2sgdG8gYWxsb3cgZHJpdmVycyB0byBjb21w
dXRlIHRoZSBuYW1lIGF0IHJ1bnRpbWUsIHdpdGhvdXQKLQkgKiBoYXZpbmcgaXQgdG8gc3RvcmUg
cGVybWFuZW50bHkgZm9yIGVhY2ggZmVuY2UsIG9yIGJ1aWxkIGEgY2FjaGUgb2YKLQkgKiBzb21l
IHNvcnQuCi0JICoKLQkgKiBUaGlzIGNhbGxiYWNrIGlzIG1hbmRhdG9yeS4KLQkgKi8KLQljb25z
dCBjaGFyICogKCpnZXRfdGltZWxpbmVfbmFtZSkoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwot
Ci0JLyoqCi0JICogQGVuYWJsZV9zaWduYWxpbmc6Ci0JICoKLQkgKiBFbmFibGUgc29mdHdhcmUg
c2lnbmFsaW5nIG9mIGZlbmNlLgotCSAqCi0JICogRm9yIGZlbmNlIGltcGxlbWVudGF0aW9ucyB0
aGF0IGhhdmUgdGhlIGNhcGFiaWxpdHkgZm9yIGh3LT5odwotCSAqIHNpZ25hbGluZywgdGhleSBj
YW4gaW1wbGVtZW50IHRoaXMgb3AgdG8gZW5hYmxlIHRoZSBuZWNlc3NhcnkKLQkgKiBpbnRlcnJ1
cHRzLCBvciBpbnNlcnQgY29tbWFuZHMgaW50byBjbWRzdHJlYW0sIGV0YywgdG8gYXZvaWQgdGhl
c2UKLQkgKiBjb3N0bHkgb3BlcmF0aW9ucyBmb3IgdGhlIGNvbW1vbiBjYXNlIHdoZXJlIG9ubHkg
aHctPmh3Ci0JICogc3luY2hyb25pemF0aW9uIGlzIHJlcXVpcmVkLiAgVGhpcyBpcyBjYWxsZWQg
aW4gdGhlIGZpcnN0Ci0JICogZG1hX2ZlbmNlX3dhaXQoKSBvciBkbWFfZmVuY2VfYWRkX2NhbGxi
YWNrKCkgcGF0aCB0byBsZXQgdGhlIGZlbmNlCi0JICogaW1wbGVtZW50YXRpb24ga25vdyB0aGF0
IHRoZXJlIGlzIGFub3RoZXIgZHJpdmVyIHdhaXRpbmcgb24gdGhlCi0JICogc2lnbmFsIChpZS4g
aHctPnN3IGNhc2UpLgotCSAqCi0JICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIGZyb20g
YXRvbWljIGNvbnRleHQsIGJ1dCBub3QKLQkgKiBmcm9tIGlycSBjb250ZXh0LCBzbyBub3JtYWwg
c3BpbmxvY2tzIGNhbiBiZSB1c2VkLgotCSAqCi0JICogQSByZXR1cm4gdmFsdWUgb2YgZmFsc2Ug
aW5kaWNhdGVzIHRoZSBmZW5jZSBhbHJlYWR5IHBhc3NlZCwKLQkgKiBvciBzb21lIGZhaWx1cmUg
b2NjdXJyZWQgdGhhdCBtYWRlIGl0IGltcG9zc2libGUgdG8gZW5hYmxlCi0JICogc2lnbmFsaW5n
LiBUcnVlIGluZGljYXRlcyBzdWNjZXNzZnVsIGVuYWJsaW5nLgotCSAqCi0JICogJmRtYV9mZW5j
ZS5lcnJvciBtYXkgYmUgc2V0IGluIGVuYWJsZV9zaWduYWxpbmcsIGJ1dCBvbmx5IHdoZW4gZmFs
c2UKLQkgKiBpcyByZXR1cm5lZC4KLQkgKgotCSAqIFNpbmNlIG1hbnkgaW1wbGVtZW50YXRpb25z
IGNhbiBjYWxsIGRtYV9mZW5jZV9zaWduYWwoKSBldmVuIHdoZW4gYmVmb3JlCi0JICogQGVuYWJs
ZV9zaWduYWxpbmcgaGFzIGJlZW4gY2FsbGVkIHRoZXJlJ3MgYSByYWNlIHdpbmRvdywgd2hlcmUg
dGhlCi0JICogZG1hX2ZlbmNlX3NpZ25hbCgpIG1pZ2h0IHJlc3VsdCBpbiB0aGUgZmluYWwgZmVu
Y2UgcmVmZXJlbmNlIGJlaW5nCi0JICogcmVsZWFzZWQgYW5kIGl0cyBtZW1vcnkgZnJlZWQuIFRv
IGF2b2lkIHRoaXMsIGltcGxlbWVudGF0aW9ucyBvZiB0aGlzCi0JICogY2FsbGJhY2sgc2hvdWxk
IGdyYWIgdGhlaXIgb3duIHJlZmVyZW5jZSB1c2luZyBkbWFfZmVuY2VfZ2V0KCksIHRvIGJlCi0J
ICogcmVsZWFzZWQgd2hlbiB0aGUgZmVuY2UgaXMgc2lnbmFsbGVkICh0aHJvdWdoIGUuZy4gdGhl
IGludGVycnVwdAotCSAqIGhhbmRsZXIpLgotCSAqCi0JICogVGhpcyBjYWxsYmFjayBpcyBvcHRp
b25hbC4gSWYgdGhpcyBjYWxsYmFjayBpcyBub3QgcHJlc2VudCwgdGhlbiB0aGUKLQkgKiBkcml2
ZXIgbXVzdCBhbHdheXMgaGF2ZSBzaWduYWxpbmcgZW5hYmxlZC4KLQkgKi8KLQlib29sICgqZW5h
YmxlX3NpZ25hbGluZykoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwotCi0JLyoqCi0JICogQHNp
Z25hbGVkOgotCSAqCi0JICogUGVlayB3aGV0aGVyIHRoZSBmZW5jZSBpcyBzaWduYWxlZCwgYXMg
YSBmYXN0cGF0aCBvcHRpbWl6YXRpb24gZm9yCi0JICogZS5nLiBkbWFfZmVuY2Vfd2FpdCgpIG9y
IGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soKS4gTm90ZSB0aGF0IHRoaXMKLQkgKiBjYWxsYmFjayBk
b2VzIG5vdCBuZWVkIHRvIG1ha2UgYW55IGd1YXJhbnRlZXMgYmV5b25kIHRoYXQgYSBmZW5jZQot
CSAqIG9uY2UgaW5kaWNhdGVzIGFzIHNpZ25hbGxlZCBtdXN0IGFsd2F5cyByZXR1cm4gdHJ1ZSBm
cm9tIHRoaXMKLQkgKiBjYWxsYmFjay4gVGhpcyBjYWxsYmFjayBtYXkgcmV0dXJuIGZhbHNlIGV2
ZW4gaWYgdGhlIGZlbmNlIGhhcwotCSAqIGNvbXBsZXRlZCBhbHJlYWR5LCBpbiB0aGlzIGNhc2Ug
aW5mb3JtYXRpb24gaGFzbid0IHByb3BvZ2F0ZWQgdGhyb3VnCi0JICogdGhlIHN5c3RlbSB5ZXQu
IFNlZSBhbHNvIGRtYV9mZW5jZV9pc19zaWduYWxlZCgpLgotCSAqCi0JICogTWF5IHNldCAmZG1h
X2ZlbmNlLmVycm9yIGlmIHJldHVybmluZyB0cnVlLgotCSAqCi0JICogVGhpcyBjYWxsYmFjayBp
cyBvcHRpb25hbC4KLQkgKi8KLQlib29sICgqc2lnbmFsZWQpKHN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlKTsKLQotCS8qKgotCSAqIEB3YWl0OgotCSAqCi0JICogQ3VzdG9tIHdhaXQgaW1wbGVtZW50
YXRpb24sIGRlZmF1bHRzIHRvIGRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoKSBpZgotCSAqIG5vdCBz
ZXQuCi0JICoKLQkgKiBUaGUgZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdCBpbXBsZW1lbnRhdGlvbiBz
aG91bGQgd29yayBmb3IgYW55IGZlbmNlLCBhcyBsb25nCi0JICogYXMgQGVuYWJsZV9zaWduYWxp
bmcgd29ya3MgY29ycmVjdGx5LiBUaGlzIGhvb2sgYWxsb3dzIGRyaXZlcnMgdG8KLQkgKiBoYXZl
IGFuIG9wdGltaXplZCB2ZXJzaW9uIGZvciB0aGUgY2FzZSB3aGVyZSBhIHByb2Nlc3MgY29udGV4
dCBpcwotCSAqIGFscmVhZHkgYXZhaWxhYmxlLCBlLmcuIGlmIEBlbmFibGVfc2lnbmFsaW5nIGZv
ciB0aGUgZ2VuZXJhbCBjYXNlCi0JICogbmVlZHMgdG8gc2V0IHVwIGEgd29ya2VyIHRocmVhZC4K
LQkgKgotCSAqIE11c3QgcmV0dXJuIC1FUkVTVEFSVFNZUyBpZiB0aGUgd2FpdCBpcyBpbnRyID0g
dHJ1ZSBhbmQgdGhlIHdhaXQgd2FzCi0JICogaW50ZXJydXB0ZWQsIGFuZCByZW1haW5pbmcgamlm
ZmllcyBpZiBmZW5jZSBoYXMgc2lnbmFsZWQsIG9yIDAgaWYgd2FpdAotCSAqIHRpbWVkIG91dC4g
Q2FuIGFsc28gcmV0dXJuIG90aGVyIGVycm9yIHZhbHVlcyBvbiBjdXN0b20gaW1wbGVtZW50YXRp
b25zLAotCSAqIHdoaWNoIHNob3VsZCBiZSB0cmVhdGVkIGFzIGlmIHRoZSBmZW5jZSBpcyBzaWdu
YWxlZC4gRm9yIGV4YW1wbGUgYSBoYXJkd2FyZQotCSAqIGxvY2t1cCBjb3VsZCBiZSByZXBvcnRl
ZCBsaWtlIHRoYXQuCi0JICoKLQkgKiBUaGlzIGNhbGxiYWNrIGlzIG9wdGlvbmFsLgotCSAqLwot
CXNpZ25lZCBsb25nICgqd2FpdCkoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCi0JCQkgICAgYm9v
bCBpbnRyLCBzaWduZWQgbG9uZyB0aW1lb3V0KTsKLQotCS8qKgotCSAqIEByZWxlYXNlOgotCSAq
Ci0JICogQ2FsbGVkIG9uIGRlc3RydWN0aW9uIG9mIGZlbmNlIHRvIHJlbGVhc2UgYWRkaXRpb25h
bCByZXNvdXJjZXMuCi0JICogQ2FuIGJlIGNhbGxlZCBmcm9tIGlycSBjb250ZXh0LiAgVGhpcyBj
YWxsYmFjayBpcyBvcHRpb25hbC4gSWYgaXQgaXMKLQkgKiBOVUxMLCB0aGVuIGRtYV9mZW5jZV9m
cmVlKCkgaXMgaW5zdGVhZCBjYWxsZWQgYXMgdGhlIGRlZmF1bHQKLQkgKiBpbXBsZW1lbnRhdGlv
bi4KLQkgKi8KLQl2b2lkICgqcmVsZWFzZSkoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwotCi0J
LyoqCi0JICogQGZlbmNlX3ZhbHVlX3N0cjoKLQkgKgotCSAqIENhbGxiYWNrIHRvIGZpbGwgaW4g
ZnJlZS1mb3JtIGRlYnVnIGluZm8gc3BlY2lmaWMgdG8gdGhpcyBmZW5jZSwgbGlrZQotCSAqIHRo
ZSBzZXF1ZW5jZSBudW1iZXIuCi0JICoKLQkgKiBUaGlzIGNhbGxiYWNrIGlzIG9wdGlvbmFsLgot
CSAqLwotCXZvaWQgKCpmZW5jZV92YWx1ZV9zdHIpKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBj
aGFyICpzdHIsIGludCBzaXplKTsKLQotCS8qKgotCSAqIEB0aW1lbGluZV92YWx1ZV9zdHI6Ci0J
ICoKLQkgKiBGaWxscyBpbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgdGltZWxpbmUgYXMgYSBz
dHJpbmcsIGxpa2UgdGhlCi0JICogc2VxdWVuY2UgbnVtYmVyLiBOb3RlIHRoYXQgdGhlIHNwZWNp
ZmljIGZlbmNlIHBhc3NlZCB0byB0aGlzIGZ1bmN0aW9uCi0JICogc2hvdWxkIG5vdCBtYXR0ZXIs
IGRyaXZlcnMgc2hvdWxkIG9ubHkgdXNlIGl0IHRvIGxvb2sgdXAgdGhlCi0JICogY29ycmVzcG9u
ZGluZyB0aW1lbGluZSBzdHJ1Y3R1cmVzLgotCSAqLwotCXZvaWQgKCp0aW1lbGluZV92YWx1ZV9z
dHIpKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAotCQkJCSAgIGNoYXIgKnN0ciwgaW50IHNpemUp
OwotfTsKKyNpbmNsdWRlIDx0cmFjZS9ldmVudHMvZG1hX2ZlbmNlLmg+CiAKIHZvaWQgZG1hX2Zl
bmNlX2luaXQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vf
b3BzICpvcHMsCiAJCSAgICBzcGlubG9ja190ICpsb2NrLCB1NjQgY29udGV4dCwgdTY0IHNlcW5v
KTsKQEAgLTU2MSw2ICszNDMsMzUgQEAgc3RhdGljIGlubGluZSBzaWduZWQgbG9uZyBkbWFfZmVu
Y2Vfd2FpdChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgYm9vbCBpbnRyKQogc3RydWN0IGRtYV9m
ZW5jZSAqZG1hX2ZlbmNlX2dldF9zdHViKHZvaWQpOwogdTY0IGRtYV9mZW5jZV9jb250ZXh0X2Fs
bG9jKHVuc2lnbmVkIG51bSk7CiAKK3N0YXRpYyBpbmxpbmUgYm9vbAorX19kbWFfZmVuY2Vfc2ln
bmFsKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCXJldHVybiAhdGVzdF9hbmRfc2V0X2Jp
dChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQKK19fZG1hX2ZlbmNlX3NpZ25hbF9fdGltZXN0YW1wKHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlLCBrdGltZV90IHRpbWVzdGFtcCkKK3sKKwlmZW5jZS0+dGltZXN0YW1wID0g
dGltZXN0YW1wOworCXNldF9iaXQoRE1BX0ZFTkNFX0ZMQUdfVElNRVNUQU1QX0JJVCwgJmZlbmNl
LT5mbGFncyk7CisJdHJhY2VfZG1hX2ZlbmNlX3NpZ25hbGVkKGZlbmNlKTsKK30KKworc3RhdGlj
IGlubGluZSB2b2lkCitfX2RtYV9mZW5jZV9zaWduYWxfX25vdGlmeShzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSkKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjdXIsICp0bXA7CisKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKGZlbmNlLT5sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9pcnFzX2Rpc2FibGVk
KCk7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3VyLCB0bXAsICZmZW5jZS0+Y2JfbGlz
dCwgbm9kZSkgeworCQlJTklUX0xJU1RfSEVBRCgmY3VyLT5ub2RlKTsKKwkJY3VyLT5mdW5jKGZl
bmNlLCBjdXIpOworCX0KKwlJTklUX0xJU1RfSEVBRCgmZmVuY2UtPmNiX2xpc3QpOworfQorCiAj
ZGVmaW5lIERNQV9GRU5DRV9UUkFDRShmLCBmbXQsIGFyZ3MuLi4pIFwKIAlkbyB7CQkJCQkJCQlc
CiAJCXN0cnVjdCBkbWFfZmVuY2UgKl9fZmYgPSAoZik7CQkJCVwKLS0gCjIuMjAuMQoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
