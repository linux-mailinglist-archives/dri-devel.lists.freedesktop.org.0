Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 91F96910EA
	for <lists+dri-devel@lfdr.de>; Sat, 17 Aug 2019 16:48:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 159906E517;
	Sat, 17 Aug 2019 14:48:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CEA056E506;
 Sat, 17 Aug 2019 14:47:51 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18173481-1500050 
 for multiple; Sat, 17 Aug 2019 15:47:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 5/6] dma-fence: Simply wrap dma_fence_signal_locked with
 dma_fence_signal
Date: Sat, 17 Aug 2019 15:47:35 +0100
Message-Id: <20190817144736.7826-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190817144736.7826-1-chris@chris-wilson.co.uk>
References: <20190817144736.7826-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>, intel-gfx@lists.freedesktop.org,
 christian.koenig@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGRtYV9mZW5jZV9zaWduYWwoKSB0cmllcyB0byBhdm9pZCB0aGUgc3BpbmxvY2sg
YW5kIG9ubHkgdGFrZXMKaXQgaWYgYWJzb2x1dGVseSByZXF1aXJlZCB0byB3YWxrIHRoZSBjYWxs
YmFjayBsaXN0LiBIb3dldmVyLCB0byBhbGxvdwpmb3Igc29tZSB1c2VycyB0byBzdXJyZXB0aXRp
b3VzbHkgaW5zZXJ0IGxhenkgc2lnbmFsIGNhbGxiYWNrcyB0aGF0CmRvIG5vdCBkZXBlbmQgb24g
ZW5hYmxpbmcgdGhlIHNpZ25hbGluZyBtZWNoYW5pc20gYXJvdW5kIGV2ZXJ5IGZlbmNlLAp3ZSBh
bHdheXMgbmVlZCB0byBub3RpZnkgdGhlIGNhbGxiYWNrcyBvbiBzaWduYWxpbmcuIEFzIHN1Y2gs
IHdlIHdpbGwKYWx3YXlzIG5lZWQgdG8gdGFrZSB0aGUgc3BpbmxvY2sgYW5kIGRtYV9mZW5jZV9z
aWduYWwoKSBlZmZlY3RpdmVseQpiZWNvbWVzIGEgY2xvbmUgb2YgZG1hX2ZlbmNlX3NpZ25hbF9s
b2NrZWQoKS4KCnYyOiBVcGRhdGUgdGhlIHRlc3RfYW5kX3NldF9iaXQoKSBiZWZvcmUgZW50ZXJp
bmcgdGhlIHNwaW5sb2NrLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+CkNjOiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFt
ZC5jb20+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgotLS0KIGRy
aXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYyB8IDQzICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMyBpbnNlcnRpb25zKCspLCAzMCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMgYi9kcml2ZXJz
L2RtYS1idWYvZG1hLWZlbmNlLmMKaW5kZXggZmYwY2Q2ZWFlNzY2Li44OWQ5NmUzZTZkZjYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYworKysgYi9kcml2ZXJzL2RtYS1i
dWYvZG1hLWZlbmNlLmMKQEAgLTEyOSwyNSArMTI5LDE2IEBAIEVYUE9SVF9TWU1CT0woZG1hX2Zl
bmNlX2NvbnRleHRfYWxsb2MpOwogaW50IGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKHN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlKQogewogCXN0cnVjdCBkbWFfZmVuY2VfY2IgKmN1ciwgKnRtcDsKLQlp
bnQgcmV0ID0gMDsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoZmVuY2UtPmxvY2spOwogCi0JaWYg
KFdBUk5fT04oIWZlbmNlKSkKKwlpZiAodW5saWtlbHkodGVzdF9hbmRfc2V0X2JpdChETUFfRkVO
Q0VfRkxBR19TSUdOQUxFRF9CSVQsCisJCQkJICAgICAgJmZlbmNlLT5mbGFncykpKQogCQlyZXR1
cm4gLUVJTlZBTDsKIAotCWlmICh0ZXN0X2FuZF9zZXRfYml0KERNQV9GRU5DRV9GTEFHX1NJR05B
TEVEX0JJVCwgJmZlbmNlLT5mbGFncykpIHsKLQkJcmV0ID0gLUVJTlZBTDsKLQotCQkvKgotCQkg
KiB3ZSBtaWdodCBoYXZlIHJhY2VkIHdpdGggdGhlIHVubG9ja2VkIGRtYV9mZW5jZV9zaWduYWws
Ci0JCSAqIHN0aWxsIHJ1biB0aHJvdWdoIGFsbCBjYWxsYmFja3MKLQkJICovCi0JfSBlbHNlIHsK
LQkJZmVuY2UtPnRpbWVzdGFtcCA9IGt0aW1lX2dldCgpOwotCQlzZXRfYml0KERNQV9GRU5DRV9G
TEFHX1RJTUVTVEFNUF9CSVQsICZmZW5jZS0+ZmxhZ3MpOwotCQl0cmFjZV9kbWFfZmVuY2Vfc2ln
bmFsZWQoZmVuY2UpOwotCX0KKwlmZW5jZS0+dGltZXN0YW1wID0ga3RpbWVfZ2V0KCk7CisJc2V0
X2JpdChETUFfRkVOQ0VfRkxBR19USU1FU1RBTVBfQklULCAmZmVuY2UtPmZsYWdzKTsKKwl0cmFj
ZV9kbWFfZmVuY2Vfc2lnbmFsZWQoZmVuY2UpOwogCiAJaWYgKCFsaXN0X2VtcHR5KCZmZW5jZS0+
Y2JfbGlzdCkpIHsKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2Ut
PmNiX2xpc3QsIG5vZGUpIHsKQEAgLTE1Niw3ICsxNDcsOCBAQCBpbnQgZG1hX2ZlbmNlX3NpZ25h
bF9sb2NrZWQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAJCX0KIAkJSU5JVF9MSVNUX0hFQUQo
JmZlbmNlLT5jYl9saXN0KTsKIAl9Ci0JcmV0dXJuIHJldDsKKworCXJldHVybiAwOwogfQogRVhQ
T1JUX1NZTUJPTChkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZCk7CiAKQEAgLTE3NiwyOCArMTY4LDE5
IEBAIEVYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQpOwogaW50IGRtYV9mZW5j
ZV9zaWduYWwoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7CiAJdW5zaWduZWQgbG9uZyBmbGFn
czsKKwlpbnQgcmV0OwogCiAJaWYgKCFmZW5jZSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlpZiAo
dGVzdF9hbmRfc2V0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+Zmxh
Z3MpKQorCWlmICh0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+
ZmxhZ3MpKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWZlbmNlLT50aW1lc3RhbXAgPSBrdGltZV9n
ZXQoKTsKLQlzZXRfYml0KERNQV9GRU5DRV9GTEFHX1RJTUVTVEFNUF9CSVQsICZmZW5jZS0+Zmxh
Z3MpOwotCXRyYWNlX2RtYV9mZW5jZV9zaWduYWxlZChmZW5jZSk7Ci0KLQlpZiAodGVzdF9iaXQo
RE1BX0ZFTkNFX0ZMQUdfRU5BQkxFX1NJR05BTF9CSVQsICZmZW5jZS0+ZmxhZ3MpKSB7Ci0JCXN0
cnVjdCBkbWFfZmVuY2VfY2IgKmN1ciwgKnRtcDsKKwlzcGluX2xvY2tfaXJxc2F2ZShmZW5jZS0+
bG9jaywgZmxhZ3MpOworCXJldCA9IGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKGZlbmNlKTsKKwlz
cGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CiAKLQkJc3Bpbl9sb2Nr
X2lycXNhdmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KGN1ciwgdG1wLCAmZmVuY2UtPmNiX2xpc3QsIG5vZGUpIHsKLQkJCWxpc3RfZGVsX2luaXQoJmN1
ci0+bm9kZSk7Ci0JCQljdXItPmZ1bmMoZmVuY2UsIGN1cik7Ci0JCX0KLQkJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZShmZW5jZS0+bG9jaywgZmxhZ3MpOwotCX0KLQlyZXR1cm4gMDsKKwlyZXR1cm4g
cmV0OwogfQogRVhQT1JUX1NZTUJPTChkbWFfZmVuY2Vfc2lnbmFsKTsKIAotLSAKMi4yMy4wLnJj
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
