Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EF9DF10FFEE
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 15:15:53 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BAB9B6E5F9;
	Tue,  3 Dec 2019 14:15:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 72D046E5E8
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 14:15:31 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id C3DAC290682;
 Tue,  3 Dec 2019 14:15:29 +0000 (GMT)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 10/11] drm/bridge: Add an ->atomic_check() hook
Date: Tue,  3 Dec 2019 15:15:14 +0100
Message-Id: <20191203141515.3597631-11-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203141515.3597631-1-boris.brezillon@collabora.com>
References: <20191203141515.3597631-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U28gdGhhdCBicmlkZ2UgZHJpdmVycyBoYXZlIGEgd2F5IHRvIGNoZWNrL3JlamVjdCBhbiBhdG9t
aWMgb3BlcmF0aW9uLgpUaGUgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2soKSAod2hpY2gg
aXMganVzdCBhIHdyYXBwZXIgYXJvdW5kCnRoZSAtPmF0b21pY19jaGVjaygpIGhvb2spIGlzIGNh
bGxlZCBpbiBwbGFjZSBvZgpkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoKSAod2hlbiAtPmF0
b21pY19jaGVjaygpIGlzIG5vdCBpbXBsZW1lbnRlZCwKdGhlIGNvcmUgZmFsbHMgYmFjayBvbiAt
Pm1vZGVfZml4dXAoKSwgc28gdGhlIGJlaGF2aW9yIHNob3VsZCBzdGF5CnRoZSBzYW1lIGZvciBl
eGlzdGluZyBicmlkZ2UgZHJpdmVycykuCgpTaWduZWQtb2ZmLWJ5OiBCb3JpcyBCcmV6aWxsb24g
PGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgpSZXZpZXdlZC1ieTogTmVpbCBBcm1zdHJv
bmcgPG5hcm1zdHJvbmdAYmF5bGlicmUuY29tPgpSZXZpZXdlZC1ieTogTGF1cmVudCBQaW5jaGFy
dCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgotLS0KQ2hhbmdlcyBpbiB2NDoK
KiBBZGQgUi1icwoKQ2hhbmdlcyBpbiB2MzoKKiBOb25lCgpDaGFuZ2VzIGluIHYyOgoqIENsYXJp
ZnkgdGhlIGZhY3QgdGhhdCAtPmF0b21pY19jaGVjaygpIGlzIHJlcGxhY2luZyAtPm1vZGVfZml4
dXAoKQotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jIHwgMTIgKysrLS0t
CiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAgICAgICB8IDYyICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrCiBpbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggICAgICAgICAgICB8IDI5
ICsrKysrKysrKysrKystCiAzIGZpbGVzIGNoYW5nZWQsIDk2IGluc2VydGlvbnMoKyksIDcgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwppbmRleCBlMmY3ZjMzNmEy
ZDIuLmEzNThmODE2NzBlOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNf
aGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTQz
NywxMiArNDM3LDEyIEBAIG1vZGVfZml4dXAoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCQlmdW5jcyA9IGVuY29kZXItPmhlbHBlcl9wcml2YXRlOwogCiAJCWJyaWRnZSA9IGRybV9i
cmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShlbmNvZGVyKTsKLQkJcmV0ID0gZHJtX2JyaWRn
ZV9jaGFpbl9tb2RlX2ZpeHVwKGJyaWRnZSwKLQkJCQkJJm5ld19jcnRjX3N0YXRlLT5tb2RlLAot
CQkJCQkmbmV3X2NydGNfc3RhdGUtPmFkanVzdGVkX21vZGUpOwotCQlpZiAoIXJldCkgewotCQkJ
RFJNX0RFQlVHX0FUT01JQygiQnJpZGdlIGZpeHVwIGZhaWxlZFxuIik7Ci0JCQlyZXR1cm4gLUVJ
TlZBTDsKKwkJcmV0ID0gZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2soYnJpZGdlLAorCQkJ
CQkJICAgIG5ld19jcnRjX3N0YXRlLAorCQkJCQkJICAgIG5ld19jb25uX3N0YXRlKTsKKwkJaWYg
KHJldCkgeworCQkJRFJNX0RFQlVHX0FUT01JQygiQnJpZGdlIGF0b21pYyBjaGVjayBmYWlsZWRc
biIpOworCQkJcmV0dXJuIHJldDsKIAkJfQogCiAJCWlmIChmdW5jcyAmJiBmdW5jcy0+YXRvbWlj
X2NoZWNrKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jIGIvZHJp
dmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwppbmRleCAxNWIyMWZmNmYxZmUuLjU1N2MyOWNhZTUx
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2JyaWRnZS5jCkBAIC02MjQsNiArNjI0LDY4IEBAIHZvaWQgZHJtX2F0b21p
Y19icmlkZ2VfY2hhaW5fZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiB9CiBFWFBP
UlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZSk7CiAKK3N0YXRpYyBpbnQg
ZHJtX2F0b21pY19icmlkZ2VfY2hlY2soc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkg
ICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICAgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCit7CisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21p
Y19jaGVjaykgeworCQlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqYnJpZGdlX3N0YXRlOworCQlp
bnQgcmV0OworCisJCWJyaWRnZV9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X25ld19icmlkZ2Vfc3Rh
dGUoY3J0Y19zdGF0ZS0+c3RhdGUsCisJCQkJCQkJICAgICAgIGJyaWRnZSk7CisJCWlmIChXQVJO
X09OKCFicmlkZ2Vfc3RhdGUpKQorCQkJcmV0dXJuIC1FSU5WQUw7CisKKwkJcmV0ID0gYnJpZGdl
LT5mdW5jcy0+YXRvbWljX2NoZWNrKGJyaWRnZSwgYnJpZGdlX3N0YXRlLAorCQkJCQkJICBjcnRj
X3N0YXRlLCBjb25uX3N0YXRlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfSBlbHNl
IGlmIChicmlkZ2UtPmZ1bmNzLT5tb2RlX2ZpeHVwKSB7CisJCWlmICghYnJpZGdlLT5mdW5jcy0+
bW9kZV9maXh1cChicmlkZ2UsICZjcnRjX3N0YXRlLT5tb2RlLAorCQkJCQkgICAgICAgJmNydGNf
c3RhdGUtPmFkanVzdGVkX21vZGUpKQorCQkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKKy8qKgorICogZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2soKSAtIERvIGFu
IGF0b21pYyBjaGVjayBvbiB0aGUgYnJpZGdlIGNoYWluCisgKiBAYnJpZGdlOiBicmlkZ2UgY29u
dHJvbCBzdHJ1Y3R1cmUKKyAqIEBjcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQorICogQGNvbm5f
c3RhdGU6IG5ldyBjb25uZWN0b3Igc3RhdGUKKyAqCisgKiBDYWxscyAmZHJtX2JyaWRnZV9mdW5j
cy5hdG9taWNfY2hlY2soKSAoZmFsbHMgYmFjayBvbgorICogJmRybV9icmlkZ2VfZnVuY3MubW9k
ZV9maXh1cCgpKSBvcCBmb3IgYWxsIHRoZSBicmlkZ2VzIGluIHRoZSBlbmNvZGVyIGNoYWluLAor
ICogc3RhcnRpbmcgZnJvbSB0aGUgbGFzdCBicmlkZ2UgdG8gdGhlIGZpcnN0LiBUaGVzZSBhcmUg
Y2FsbGVkIGJlZm9yZSBjYWxsaW5nCisgKiAmZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzLmF0b21p
Y19jaGVjaygpCisgKgorICogUkVUVVJOUzoKKyAqIDAgb24gc3VjY2VzcywgYSBuZWdhdGl2ZSBl
cnJvciBjb2RlIG9uIGZhaWx1cmUKKyAqLworaW50IGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2No
ZWNrKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCisJCQkJICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIgPSBicmlkZ2UtPmVuY29kZXI7
CisJc3RydWN0IGRybV9icmlkZ2UgKml0ZXI7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVy
c2UoaXRlciwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwgY2hhaW5fbm9kZSkgeworCQlpbnQgcmV0
OworCisJCXJldCA9IGRybV9hdG9taWNfYnJpZGdlX2NoZWNrKGl0ZXIsIGNydGNfc3RhdGUsIGNv
bm5fc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlpZiAoaXRlciA9PSBi
cmlkZ2UpCisJCQlicmVhazsKKwl9CisKKwlyZXR1cm4gMDsKK30KK0VYUE9SVF9TWU1CT0woZHJt
X2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2spOworCiAvKioKICAqIF9fZHJtX2F0b21pY19oZWxw
ZXJfYnJpZGdlX3Jlc2V0KCkgLSBJbml0aWFsaXplIGEgYnJpZGdlIHN0YXRlIHRvIGl0cwogICoJ
CQkJCWRlZmF1bHQKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaCBiL2luY2x1
ZGUvZHJtL2RybV9icmlkZ2UuaAppbmRleCBiODBjM2NhYzMyMDMuLjgyMDZhZDkwYWQyZCAxMDA2
NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9i
cmlkZ2UuaApAQCAtMTI4LDcgKzEyOCw5IEBAIHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIHsKIAkg
KiB0aGlzIGZ1bmN0aW9uIHBhc3NlcyBhbGwgb3RoZXIgY2FsbGJhY2tzIG11c3Qgc3VjY2VlZCBm
b3IgdGhpcwogCSAqIGNvbmZpZ3VyYXRpb24uCiAJICoKLQkgKiBUaGUgQG1vZGVfZml4dXAgY2Fs
bGJhY2sgaXMgb3B0aW9uYWwuCisJICogVGhlIG1vZGVfZml4dXAgY2FsbGJhY2sgaXMgb3B0aW9u
YWwuICZkcm1fYnJpZGdlX2Z1bmNzLm1vZGVfZml4dXAoKQorCSAqIGlzIG5vdCBjYWxsZWQgd2hl
biAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfY2hlY2soKSBpcyBpbXBsZW1lbnRlZCwKKwkgKiBz
byBvbmx5IG9uZSBvZiB0aGVtIHNob3VsZCBiZSBwcm92aWRlZC4KIAkgKgogCSAqIE5PVEU6CiAJ
ICoKQEAgLTM4NSw2ICszODcsMjggQEAgc3RydWN0IGRybV9icmlkZ2VfZnVuY3MgewogCXZvaWQg
KCphdG9taWNfZGVzdHJveV9zdGF0ZSkoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkg
ICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSk7CiAKKwkvKioKKwkgKiBAYXRvbWlj
X2NoZWNrOgorCSAqCisJICogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2libGUgZm9yIGNoZWNraW5n
IGJyaWRnZSBzdGF0ZSBjb3JyZWN0bmVzcy4KKwkgKiBJdCBjYW4gYWxzbyBjaGVjayB0aGUgc3Rh
dGUgb2YgdGhlIHN1cnJvdW5kaW5nIGNvbXBvbmVudHMgaW4gY2hhaW4KKwkgKiB0byBtYWtlIHN1
cmUgdGhlIHdob2xlIHBpcGVsaW5lIGNhbiB3b3JrIHByb3Blcmx5LgorCSAqCisJICogJmRybV9i
cmlkZ2VfZnVuY3MuYXRvbWljX2NoZWNrKCkgaG9va3MgYXJlIGNhbGxlZCBpbiByZXZlcnNlCisJ
ICogb3JkZXIgKGZyb20gdGhlIGxhc3QgdG8gdGhlIGZpcnN0IGJyaWRnZSkuCisJICoKKwkgKiBU
aGlzIG1ldGhvZCBpcyBvcHRpb25hbC4gJmRybV9icmlkZ2VfZnVuY3MubW9kZV9maXh1cCgpIGlz
IG5vdAorCSAqIGNhbGxlZCB3aGVuICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19jaGVjaygpIGlz
IGltcGxlbWVudGVkLCBzbyBvbmx5CisJICogb25lIG9mIHRoZW0gc2hvdWxkIGJlIHByb3ZpZGVk
LgorCSAqCisJICogUkVUVVJOUzoKKwkgKiB6ZXJvIGlmIHRoZSBjaGVjayBwYXNzZWQsIGEgbmVn
YXRpdmUgZXJyb3IgY29kZSBvdGhlcndpc2UuCisJICovCisJaW50ICgqYXRvbWljX2NoZWNrKShz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRl
ICpicmlkZ2Vfc3RhdGUsCisJCQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAorCQkJICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKTsKKwogCS8q
KgogCSAqIEBhdG9taWNfcmVzZXQ6CiAJICoKQEAgLTU1Miw2ICs1NzYsOSBAQCB2b2lkIGRybV9i
cmlkZ2VfY2hhaW5fbW9kZV9zZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIHZvaWQgZHJt
X2JyaWRnZV9jaGFpbl9wcmVfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpOwogdm9p
ZCBkcm1fYnJpZGdlX2NoYWluX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKIAor
aW50IGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2NoZWNrKHN0cnVjdCBkcm1fYnJpZGdlICpicmlk
Z2UsCisJCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7CiB2b2lkIGRybV9hdG9taWNfYnJp
ZGdlX2NoYWluX2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgICAgIHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CiB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2No
YWluX3Bvc3RfZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAotLSAKMi4yMy4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
