Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EE19FA2188
	for <lists+dri-devel@lfdr.de>; Thu, 29 Aug 2019 18:56:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 10FA66E141;
	Thu, 29 Aug 2019 16:55:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x443.google.com (mail-pf1-x443.google.com
 [IPv6:2607:f8b0:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A21676E140;
 Thu, 29 Aug 2019 16:55:56 +0000 (UTC)
Received: by mail-pf1-x443.google.com with SMTP id 26so99719pfp.9;
 Thu, 29 Aug 2019 09:55:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=q6Cjkast+lBr9o2h0UHBUjks7fxSvQpeWE7yoX/EM5I=;
 b=fiKbnHYNEkos0gG8DGmh7D8xtue6rJLG2K+V8yzVm5njvc3ni6gqAf4hUiXc/RSs8I
 yc74ahBGAAW2B6bCRjgqMd/t9aV4cZACRUbT4o3ea++oFxXFAMgNvH4p+5abpBbEkfmt
 pyCKNvfHoaZI/pNNPHQiD6WjEs0wtrlE413jNvpFrOaG8rePVdmWBDJa/WMqZIJjcEmr
 R2QVI+g0LuyudZPQM9247Qkxc9HlzgHwoBq5ST7TyDOkhcaXjvWRsklKwBSv55FRNjRR
 v9EltbhooaTxZtVrXoWJ8QPKsbrNjOTQSaDYrp3IooBKvLH3P/xePzOAVzFHAR5n2uFN
 yI5w==
X-Gm-Message-State: APjAAAWadMyxWHKcIY0KCJ9wprIVkG2hDI+kL8ZqtjbqZZ+O7Fbb3OAK
 a0I0HAtoKrKPKg+O17vgFQEMb20N8rc=
X-Google-Smtp-Source: APXvYqwk04ddvz7woByhdXiTit+cjj7gy6bccXcDBs0+OJ7ANBNi8ZRnULxIqfykkTBNvtJU4w9kww==
X-Received: by 2002:a63:db47:: with SMTP id x7mr9201448pgi.375.1567097755313; 
 Thu, 29 Aug 2019 09:55:55 -0700 (PDT)
Received: from localhost ([100.118.89.196])
 by smtp.gmail.com with ESMTPSA id h17sm3789249pfo.24.2019.08.29.09.55.54
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 29 Aug 2019 09:55:54 -0700 (PDT)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 03/10] drm/msm/dpu: handle_frame_done() from vblank irq
Date: Thu, 29 Aug 2019 09:45:11 -0700
Message-Id: <20190829164601.11615-4-robdclark@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190829164601.11615-1-robdclark@gmail.com>
References: <20190829164601.11615-1-robdclark@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=q6Cjkast+lBr9o2h0UHBUjks7fxSvQpeWE7yoX/EM5I=;
 b=EAWk5vWbDIcCy9Dh51/RnZJvWOb6KQ9hDNfJxBsN6bxUSz5iLGuzlD3RL1RDF+DNut
 OvLxd3MEHj5sXrnJVH4n5XuIuDGaX9ckbvX45Vdr16/Ig5uz0YhPdSdvYLZU6GDdVSk+
 P65KmeDZkCfclBQ3W2Wt3Fg79M9h9/EcJSdScwWcSCBRRy0kHqGy54wei3ODpkX3j5jm
 j1LTi9J4EPt8pEVVBwQEl/kznii+oIWjFt3rziyTdyr9XS6UFrL0kx2bzIiiDw4TMI0D
 cG892Gur87uHyglF+M2SRj/ns10rPZf6dEZwHFb2P+EsuIDFg275I8Op0IoUQXYzA/X6
 AEpQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Rob Clark <robdclark@chromium.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU"
 <freedreno@lists.freedesktop.org>, David Airlie <airlied@linux.ie>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 open list <linux-kernel@vger.kernel.org>, Bruce Wang <bzwang@chromium.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <linux-arm-msm@vger.kernel.org>,
 Sean Paul <sean@poorly.run>, Thomas Gleixner <tglx@linutronix.de>,
 Sravanthi Kollukuduru <skolluku@codeaurora.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKUHJldmlvdXNseSB0aGUg
Y2FsbGJhY2sgd2FzIGNhbGxlZCBmcm9tIHdob2V2ZXIgY2FsbGVkIHdhaXRfZm9yX3ZibGFuaygp
LApidXQgdGhhdCBpc24ndCBhIGdyZWF0IHBsYW4gd2hlbiB3YWl0X2Zvcl92YmxhbmsoKSBzdG9w
cyBnZXR0aW5nIGNhbGxlZCwKYW5kIHJlc3VsdHMgaW4gZnJhbWVfZG9uZV90aW1lciBleHBpcmlu
Zy4KClNpZ25lZC1vZmYtYnk6IFJvYiBDbGFyayA8cm9iZGNsYXJrQGNocm9taXVtLm9yZz4KUmV2
aWV3ZWQtYnk6IFNlYW4gUGF1bCA8c2VhbkBwb29ybHkucnVuPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9tc20vZGlzcC9kcHUxL2RwdV9jcnRjLmMgICAgICB8ICA3ICstLS0tLQogLi4uL2RybS9tc20v
ZGlzcC9kcHUxL2RwdV9lbmNvZGVyX3BoeXNfdmlkLmMgIHwgMjUgKysrKysrLS0tLS0tLS0tLS0t
LQogMiBmaWxlcyBjaGFuZ2VkLCA5IGluc2VydGlvbnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9jcnRjLmMgYi9kcml2
ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfY3J0Yy5jCmluZGV4IGMzZjcxNTQwMTdjNC4u
ZTczNTRhZWY5ODA1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9k
cHVfY3J0Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9jcnRjLmMK
QEAgLTMxMSwxMiArMzExLDcgQEAgc3RhdGljIHZvaWQgZHB1X2NydGNfZnJhbWVfZXZlbnRfd29y
ayhzdHJ1Y3Qga3RocmVhZF93b3JrICp3b3JrKQogCQkJCXwgRFBVX0VOQ09ERVJfRlJBTUVfRVZF
TlRfUEFORUxfREVBRCkpIHsKIAogCQlpZiAoYXRvbWljX3JlYWQoJmRwdV9jcnRjLT5mcmFtZV9w
ZW5kaW5nKSA8IDEpIHsKLQkJCS8qIHRoaXMgc2hvdWxkIG5vdCBoYXBwZW4gKi8KLQkJCURSTV9F
UlJPUigiY3J0YyVkIGV2OiV1IHRzOiVsbGQgZnJhbWVfcGVuZGluZzolZFxuIiwKLQkJCQkJY3J0
Yy0+YmFzZS5pZCwKLQkJCQkJZmV2ZW50LT5ldmVudCwKLQkJCQkJa3RpbWVfdG9fbnMoZmV2ZW50
LT50cyksCi0JCQkJCWF0b21pY19yZWFkKCZkcHVfY3J0Yy0+ZnJhbWVfcGVuZGluZykpOworCQkJ
LyogaWdub3JlIHZibGFuayB3aGVuIG5vdCBwZW5kaW5nICovCiAJCX0gZWxzZSBpZiAoYXRvbWlj
X2RlY19yZXR1cm4oJmRwdV9jcnRjLT5mcmFtZV9wZW5kaW5nKSA9PSAwKSB7CiAJCQkvKiByZWxl
YXNlIGJhbmR3aWR0aCBhbmQgb3RoZXIgcmVzb3VyY2VzICovCiAJCQl0cmFjZV9kcHVfY3J0Y19m
cmFtZV9ldmVudF9kb25lKERSTUlEKGNydGMpLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXJfcGh5c192aWQuYyBiL2RyaXZlcnMvZ3B1L2RybS9t
c20vZGlzcC9kcHUxL2RwdV9lbmNvZGVyX3BoeXNfdmlkLmMKaW5kZXggN2M3M2IwOTg5NGYwLi5i
OWM4NGZiNGQ0YTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2Rw
dV9lbmNvZGVyX3BoeXNfdmlkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEv
ZHB1X2VuY29kZXJfcGh5c192aWQuYwpAQCAtMzI0LDYgKzMyNCwxMCBAQCBzdGF0aWMgdm9pZCBk
cHVfZW5jb2Rlcl9waHlzX3ZpZF92YmxhbmtfaXJxKHZvaWQgKmFyZywgaW50IGlycV9pZHgpCiAK
IAkvKiBTaWduYWwgYW55IHdhaXRpbmcgYXRvbWljIGNvbW1pdCB0aHJlYWQgKi8KIAl3YWtlX3Vw
X2FsbCgmcGh5c19lbmMtPnBlbmRpbmdfa2lja29mZl93cSk7CisKKwlwaHlzX2VuYy0+cGFyZW50
X29wcy0+aGFuZGxlX2ZyYW1lX2RvbmUocGh5c19lbmMtPnBhcmVudCwgcGh5c19lbmMsCisJCQlE
UFVfRU5DT0RFUl9GUkFNRV9FVkVOVF9ET05FKTsKKwogCURQVV9BVFJBQ0VfRU5EKCJ2Ymxhbmtf
aXJxIik7CiB9CiAKQEAgLTQ4Myw4ICs0ODcsOCBAQCBzdGF0aWMgdm9pZCBkcHVfZW5jb2Rlcl9w
aHlzX3ZpZF9nZXRfaHdfcmVzb3VyY2VzKAogCWh3X3Jlcy0+aW50ZnNbcGh5c19lbmMtPmludGZf
aWR4IC0gSU5URl8wXSA9IElOVEZfTU9ERV9WSURFTzsKIH0KIAotc3RhdGljIGludCBfZHB1X2Vu
Y29kZXJfcGh5c192aWRfd2FpdF9mb3JfdmJsYW5rKAotCQlzdHJ1Y3QgZHB1X2VuY29kZXJfcGh5
cyAqcGh5c19lbmMsIGJvb2wgbm90aWZ5KQorc3RhdGljIGludCBkcHVfZW5jb2Rlcl9waHlzX3Zp
ZF93YWl0X2Zvcl92YmxhbmsoCisJCXN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2VuYykK
IHsKIAlzdHJ1Y3QgZHB1X2VuY29kZXJfd2FpdF9pbmZvIHdhaXRfaW5mbzsKIAlpbnQgcmV0OwpA
QCAtNDk5LDEwICs1MDMsNiBAQCBzdGF0aWMgaW50IF9kcHVfZW5jb2Rlcl9waHlzX3ZpZF93YWl0
X2Zvcl92YmxhbmsoCiAJd2FpdF9pbmZvLnRpbWVvdXRfbXMgPSBLSUNLT0ZGX1RJTUVPVVRfTVM7
CiAKIAlpZiAoIWRwdV9lbmNvZGVyX3BoeXNfdmlkX2lzX21hc3RlcihwaHlzX2VuYykpIHsKLQkJ
aWYgKG5vdGlmeSAmJiBwaHlzX2VuYy0+cGFyZW50X29wcy0+aGFuZGxlX2ZyYW1lX2RvbmUpCi0J
CQlwaHlzX2VuYy0+cGFyZW50X29wcy0+aGFuZGxlX2ZyYW1lX2RvbmUoCi0JCQkJCXBoeXNfZW5j
LT5wYXJlbnQsIHBoeXNfZW5jLAotCQkJCQlEUFVfRU5DT0RFUl9GUkFNRV9FVkVOVF9ET05FKTsK
IAkJcmV0dXJuIDA7CiAJfQogCkBAIC01MTIsMjAgKzUxMiwxMSBAQCBzdGF0aWMgaW50IF9kcHVf
ZW5jb2Rlcl9waHlzX3ZpZF93YWl0X2Zvcl92YmxhbmsoCiAKIAlpZiAocmV0ID09IC1FVElNRURP
VVQpIHsKIAkJZHB1X2VuY29kZXJfaGVscGVyX3JlcG9ydF9pcnFfdGltZW91dChwaHlzX2VuYywg
SU5UUl9JRFhfVlNZTkMpOwotCX0gZWxzZSBpZiAoIXJldCAmJiBub3RpZnkgJiYgcGh5c19lbmMt
PnBhcmVudF9vcHMtPmhhbmRsZV9mcmFtZV9kb25lKQotCQlwaHlzX2VuYy0+cGFyZW50X29wcy0+
aGFuZGxlX2ZyYW1lX2RvbmUoCi0JCQkJcGh5c19lbmMtPnBhcmVudCwgcGh5c19lbmMsCi0JCQkJ
RFBVX0VOQ09ERVJfRlJBTUVfRVZFTlRfRE9ORSk7CisJfQogCiAJcmV0dXJuIHJldDsKIH0KIAot
c3RhdGljIGludCBkcHVfZW5jb2Rlcl9waHlzX3ZpZF93YWl0X2Zvcl92YmxhbmsoCi0JCXN0cnVj
dCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2VuYykKLXsKLQlyZXR1cm4gX2RwdV9lbmNvZGVyX3Bo
eXNfdmlkX3dhaXRfZm9yX3ZibGFuayhwaHlzX2VuYywgdHJ1ZSk7Ci19Ci0KIHN0YXRpYyBpbnQg
ZHB1X2VuY29kZXJfcGh5c192aWRfd2FpdF9mb3JfY29tbWl0X2RvbmUoCiAJCXN0cnVjdCBkcHVf
ZW5jb2Rlcl9waHlzICpwaHlzX2VuYykKIHsKQEAgLTYxNSw3ICs2MDYsNyBAQCBzdGF0aWMgdm9p
ZCBkcHVfZW5jb2Rlcl9waHlzX3ZpZF9kaXNhYmxlKHN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpw
aHlzX2VuYykKIAkgKiBzY2Fub3V0IGJ1ZmZlcikgZG9uJ3QgbGF0Y2ggcHJvcGVybHkuLgogCSAq
LwogCWlmIChkcHVfZW5jb2Rlcl9waHlzX3ZpZF9pc19tYXN0ZXIocGh5c19lbmMpKSB7Ci0JCXJl
dCA9IF9kcHVfZW5jb2Rlcl9waHlzX3ZpZF93YWl0X2Zvcl92YmxhbmsocGh5c19lbmMsIGZhbHNl
KTsKKwkJcmV0ID0gZHB1X2VuY29kZXJfcGh5c192aWRfd2FpdF9mb3JfdmJsYW5rKHBoeXNfZW5j
KTsKIAkJaWYgKHJldCkgewogCQkJYXRvbWljX3NldCgmcGh5c19lbmMtPnBlbmRpbmdfa2lja29m
Zl9jbnQsIDApOwogCQkJRFJNX0VSUk9SKCJ3YWl0IGRpc2FibGUgZmFpbGVkOiBpZDoldSBpbnRm
OiVkIHJldDolZFxuIiwKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
