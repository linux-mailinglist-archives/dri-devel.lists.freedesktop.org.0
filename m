Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0834DB184B
	for <lists+dri-devel@lfdr.de>; Fri, 13 Sep 2019 08:29:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CACD96E303;
	Fri, 13 Sep 2019 06:29:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fanzine.igalia.com (fanzine.igalia.com [91.117.99.155])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4EB3B6E303
 for <dri-devel@lists.freedesktop.org>; Fri, 13 Sep 2019 06:29:13 +0000 (UTC)
Received: from [192.168.12.205] (helo=zeus) by fanzine.igalia.com with esmtpsa 
 (Cipher TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256) (Exim)
 id 1i8f4x-0008IN-3a; Fri, 13 Sep 2019 08:29:11 +0200
Message-ID: <ddb5ebb30170fb2871ff52cc55128bd38b1c99e2.camel@igalia.com>
Subject: Re: [PATCH] drm/v3d: clean caches at the end of render jobs on
 request from user space
From: Iago Toral <itoral@igalia.com>
To: Eric Anholt <eric@anholt.net>, dri-devel@lists.freedesktop.org
Date: Fri, 13 Sep 2019 08:29:10 +0200
In-Reply-To: <87d0g5l94v.fsf@anholt.net>
References: <20190912083516.13797-1-itoral@igalia.com>
 <87d0g5l94v.fsf@anholt.net>
X-Mailer: Evolution 3.28.5-0ubuntu0.18.04.1 
Mime-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=igalia.com; s=20170329; 
 h=Content-Transfer-Encoding:Mime-Version:Content-Type:References:In-Reply-To:Date:To:From:Subject:Message-ID;
 bh=E34qwoBQYoZIIBQoD12gshyoBT16zP1YYvKTX6ZByjQ=; 
 b=LzRevqnebYGgyzCGncnmGH9hMjfT+JQEX1zggMRmpoZlBxKwZiNbXG5FH44skpUxCJVepHZz0nm0U9MTANE+jhuj4C4Ttg+1YOp08NzGPq8AH2Be//IsXtlto68E0xPj5ODbcdPajcgG2TMdHT00BFRabopl97rDJlyPYyAnmwehm3bv/2G+lN+iHef/znZ+kGG9IKMOciDDjJN2FqPT6DmXKdqCXTi/aGu/eFqnPQf8HhqID6472dUp/0dupMC80e3TnVRqBxSjeRdmTNBa8AfGt6KfdaXpIq94tj0qlVguirf5uY+W934ePHhGU6V+PK8ObKvCybUf3FqLqyr5Ag==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVGh1LCAyMDE5LTA5LTEyIGF0IDEwOjI1IC0wNzAwLCBFcmljIEFuaG9sdCB3cm90ZToKPiBJ
YWdvIFRvcmFsIFF1aXJvZ2EgPGl0b3JhbEBpZ2FsaWEuY29tPiB3cml0ZXM6Cj4gCj4gPiBFeHRl
bmRzIHRoZSB1c2VyIHNwYWNlIGlvY3RsIGZvciBDTCBzdWJtaXNzaW9ucyBzbyBpdCBjYW4gaW5j
bHVkZSBhCj4gPiByZXF1ZXN0Cj4gPiB0byBmbHVzaCB0aGUgY2FjaGUgb25jZSB0aGUgQ0wgZXhl
Y3V0aW9uIGhhcyBjb21wbGV0ZWQuIEZpeGVzCj4gPiBtZW1vcnkKPiA+IHdyaXRlIHZpb2xhdGlv
biBtZXNzYWdlcyByZXBvcnRlZCBieSB0aGUga2VybmVsIGluIHdvcmtsb2Fkcwo+ID4gaW52b2x2
aW5nCj4gPiBzaGFkZXIgbWVtb3J5IHdyaXRlcyAoU1NCT3MsIHNoYWRlciBpbWFnZXMsIHNjcmF0
Y2gsIGV0Yykgd2hpY2gKPiA+IHNvbWV0aW1lcwo+ID4gYWxzbyBsZWFkIHRvIEdQVSByZXNldHMg
ZHVyaW5nIFBpZ2xpdCBhbmQgQ1RTIHdvcmtsb2Fkcy4KPiAKPiBTb21lIGNvbnRleHQgZm9yIGFu
eSBvdGhlciByZXZpZXdlcnM6IFRoaXMgcGF0Y2ggaXMgdGhlIGludGVyZmFjZQo+IGNoYW5nZQo+
IG5lY2Vzc2FyeSB0byBleHBvc2UgR0xFUyAzLjEgb24gVjNELiAgSXQgdHVybnMgb3V0IHRoZSBI
VyBwYWNrZXRzIGZvcgo+IGZsdXNoaW5nIHRoZSBjYWNoZXMgd2VyZSBicm9rZW4gaW4gbXVsdGlw
bGUgd2F5cy4KPiAKPiA+IFNpZ25lZC1vZmYtYnk6IElhZ28gVG9yYWwgUXVpcm9nYSA8aXRvcmFs
QGlnYWxpYS5jb20+Cj4gPiAtLS0KPiA+ICBkcml2ZXJzL2dwdS9kcm0vdjNkL3YzZF9nZW0uYyB8
IDUxICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrCj4gPiAtLS0tLS0KPiA+ICBpbmNsdWRl
L3VhcGkvZHJtL3YzZF9kcm0uaCAgICB8ICA3ICsrLS0tCj4gPiAgMiBmaWxlcyBjaGFuZ2VkLCA0
NyBpbnNlcnRpb25zKCspLCAxMSBkZWxldGlvbnMoLSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92M2QvdjNkX2dlbS5jCj4gPiBiL2RyaXZlcnMvZ3B1L2RybS92M2QvdjNk
X2dlbS5jCj4gPiBpbmRleCA1ZDgwNTA3YjUzOWIuLjUzMGZlOWQ5ZDViZCAxMDA2NDQKPiA+IC0t
LSBhL2RyaXZlcnMvZ3B1L2RybS92M2QvdjNkX2dlbS5jCj4gPiArKysgYi9kcml2ZXJzL2dwdS9k
cm0vdjNkL3YzZF9nZW0uYwo+ID4gQEAgLTUzMCwxMyArNTMwLDE2IEBAIHYzZF9zdWJtaXRfY2xf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKPiA+IHZvaWQgKmRhdGEsCj4gPiAgCXN0cnVj
dCBkcm1fdjNkX3N1Ym1pdF9jbCAqYXJncyA9IGRhdGE7Cj4gPiAgCXN0cnVjdCB2M2RfYmluX2pv
YiAqYmluID0gTlVMTDsKPiA+ICAJc3RydWN0IHYzZF9yZW5kZXJfam9iICpyZW5kZXI7Cj4gPiAr
CXN0cnVjdCB2M2Rfam9iICpjbGVhbl9qb2IgPSBOVUxMOwo+ID4gKwlzdHJ1Y3QgdjNkX2pvYiAq
bGFzdF9qb2I7Cj4gPiAgCXN0cnVjdCB3d19hY3F1aXJlX2N0eCBhY3F1aXJlX2N0eDsKPiA+ICAJ
aW50IHJldCA9IDA7Cj4gPiAgCj4gPiAgCXRyYWNlX3YzZF9zdWJtaXRfY2xfaW9jdGwoJnYzZC0+
ZHJtLCBhcmdzLT5yY2xfc3RhcnQsIGFyZ3MtCj4gPiA+cmNsX2VuZCk7Cj4gPiAgCj4gPiAtCWlm
IChhcmdzLT5wYWQgIT0gMCkgewo+ID4gLQkJRFJNX0lORk8oInBhZCBtdXN0IGJlIHplcm86ICVk
XG4iLCBhcmdzLT5wYWQpOwo+ID4gKwlpZiAoYXJncy0+ZmxhZ3MgIT0gMCAmJgo+ID4gKwkgICAg
YXJncy0+ZmxhZ3MgIT0gRFJNX1YzRF9TVUJNSVRfQ0xfRkxVU0hfQ0FDSEVfRkxBRykgewo+ID4g
KwkJRFJNX0lORk8oImludmFsaWQgZmxhZ3M6ICVkXG4iLCBhcmdzLT5mbGFncyk7Cj4gPiAgCQly
ZXR1cm4gLUVJTlZBTDsKPiA+ICAJfQo+ID4gIAo+ID4gQEAgLTU3NSwxMiArNTc4LDI4IEBAIHYz
ZF9zdWJtaXRfY2xfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKPiA+IHZvaWQgKmRhdGEs
Cj4gPiAgCQliaW4tPnJlbmRlciA9IHJlbmRlcjsKPiA+ICAJfQo+ID4gIAo+ID4gLQlyZXQgPSB2
M2RfbG9va3VwX2JvcyhkZXYsIGZpbGVfcHJpdiwgJnJlbmRlci0+YmFzZSwKPiA+ICsJaWYgKGFy
Z3MtPmZsYWdzICYgRFJNX1YzRF9TVUJNSVRfQ0xfRkxVU0hfQ0FDSEVfRkxBRykgewo+ID4gKwkJ
Y2xlYW5fam9iID0ga2NhbGxvYygxLCBzaXplb2YoKmNsZWFuX2pvYiksIEdGUF9LRVJORUwpOwo+
ID4gKwkJaWYgKCFjbGVhbl9qb2IpIHsKPiA+ICsJCQlyZXQgPSAtRU5PTUVNOwo+ID4gKwkJCWdv
dG8gZmFpbDsKPiA+ICsJCX0KPiA+ICsKPiA+ICsJCXJldCA9IHYzZF9qb2JfaW5pdCh2M2QsIGZp
bGVfcHJpdiwgY2xlYW5fam9iLAo+ID4gdjNkX2pvYl9mcmVlLCAwKTsKPiA+ICsJCWlmIChyZXQp
Cj4gPiArCQkJZ290byBmYWlsOwo+IAo+IE9ubHkgaXNzdWUgSSBzZWU6IElmIHYzZF9qb2JfaW5p
dCgpIGZhaWxzLCB3ZSBuZWVkIHRvIG5vdAo+IHYzZF9qb2JfcHV0KCkKPiBpdC4gIEknbSBmaW5l
IHdpdGggZWl0aGVyIGtmcmVlKCkgaXQgYW5kIE5VTEwgdGhlIHB0ciBiZWZvcmUganVtcGluZwo+
IHRvCj4gZmFpbCwgb3Igb3BlbiBjb2RlIHRoZSBiaW4vcmVuZGVyIHB1dHMuCgpJdCBzZWVtcyB3
ZSBhbHNvIGNhbGwgdjNkX2pvYl9wdXQoKSBmb3IgdGhlIGJpbiBqb2Igd2hlbiB2M2Rfam9iX2lu
aXQoKQpmYWlscywgd2hpY2ggYWxzbyByZXR1cm5zIGltbWVkaWF0ZWx5IGluIHRoYXQgY2FzZSBp
bnN0ZWFkIG9mIGp1bXBpbmcKdG8gZmFpbCB0byB2M2Rfam9iX3B1dCB0aGUgcmVuZGVyIGpvYiwg
c28gSSBndWVzcyB3ZSBuZWVkIHRoZSBzYW1lCnRyZWF0bWVudCB0aGVyZS4gU2hhbGwgSSBmaXgg
dGhhdCBpbiB0aGlzIHBhdGNoIHRvbyBvciB3b3VsZCB5b3UgcmF0aGVyCnNlZSBhIGRpZmZlcmVu
dCBwYXRjaCBzZW50IHNlcGFyYXRlbHkgZm9yIHRoYXQ/Cgo+IFdpdGggdGhhdCwKPiAKPiBSZXZp
ZXdlZC1ieTogRXJpYyBBbmhvbHQgPGVyaWNAYW5ob2x0Lm5ldD4KPiAKPiA+ICsKPiA+ICsJCWxh
c3Rfam9iID0gY2xlYW5fam9iOwo+ID4gKwl9IGVsc2Ugewo+ID4gKwkJbGFzdF9qb2IgPSAmcmVu
ZGVyLT5iYXNlOwo+ID4gKwl9Cj4gPiArCj4gPiArCXJldCA9IHYzZF9sb29rdXBfYm9zKGRldiwg
ZmlsZV9wcml2LCBsYXN0X2pvYiwKPiA+ICAJCQkgICAgIGFyZ3MtPmJvX2hhbmRsZXMsIGFyZ3Mt
PmJvX2hhbmRsZV9jb3VudCk7Cj4gPiAgCWlmIChyZXQpCj4gPiAgCQlnb3RvIGZhaWw7Cj4gPiAg
Cj4gPiAtCXJldCA9IHYzZF9sb2NrX2JvX3Jlc2VydmF0aW9ucygmcmVuZGVyLT5iYXNlLCAmYWNx
dWlyZV9jdHgpOwo+ID4gKwlyZXQgPSB2M2RfbG9ja19ib19yZXNlcnZhdGlvbnMobGFzdF9qb2Is
ICZhY3F1aXJlX2N0eCk7Cj4gPiAgCWlmIChyZXQpCj4gPiAgCQlnb3RvIGZhaWw7Cj4gPiAgCj4g
PiBAQCAtNTk5LDI4ICs2MTgsNDQgQEAgdjNkX3N1Ym1pdF9jbF9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAo+ID4gdm9pZCAqZGF0YSwKPiA+ICAJcmV0ID0gdjNkX3B1c2hfam9iKHYzZF9w
cml2LCAmcmVuZGVyLT5iYXNlLCBWM0RfUkVOREVSKTsKPiA+ICAJaWYgKHJldCkKPiA+ICAJCWdv
dG8gZmFpbF91bnJlc2VydmU7Cj4gPiArCj4gPiArCWlmIChjbGVhbl9qb2IpIHsKPiA+ICsJCXN0
cnVjdCBkbWFfZmVuY2UgKnJlbmRlcl9mZW5jZSA9Cj4gPiArCQkJZG1hX2ZlbmNlX2dldChyZW5k
ZXItPmJhc2UuZG9uZV9mZW5jZSk7Cj4gPiArCQlyZXQgPSBkcm1fZ2VtX2ZlbmNlX2FycmF5X2Fk
ZCgmY2xlYW5fam9iLT5kZXBzLAo+ID4gcmVuZGVyX2ZlbmNlKTsKPiA+ICsJCWlmIChyZXQpCj4g
PiArCQkJZ290byBmYWlsX3VucmVzZXJ2ZTsKPiA+ICsJCXJldCA9IHYzZF9wdXNoX2pvYih2M2Rf
cHJpdiwgY2xlYW5fam9iLAo+ID4gVjNEX0NBQ0hFX0NMRUFOKTsKPiA+ICsJCWlmIChyZXQpCj4g
PiArCQkJZ290byBmYWlsX3VucmVzZXJ2ZTsKPiA+ICsJfQo+ID4gKwo+ID4gIAltdXRleF91bmxv
Y2soJnYzZC0+c2NoZWRfbG9jayk7Cj4gPiAgCj4gPiAgCXYzZF9hdHRhY2hfZmVuY2VzX2FuZF91
bmxvY2tfcmVzZXJ2YXRpb24oZmlsZV9wcml2LAo+ID4gLQkJCQkJCSAmcmVuZGVyLT5iYXNlLAo+
ID4gKwkJCQkJCSBsYXN0X2pvYiwKPiA+ICAJCQkJCQkgJmFjcXVpcmVfY3R4LAo+ID4gIAkJCQkJ
CSBhcmdzLT5vdXRfc3luYywKPiA+IC0JCQkJCQkgcmVuZGVyLQo+ID4gPmJhc2UuZG9uZV9mZW5j
ZSk7Cj4gPiArCQkJCQkJIGxhc3Rfam9iLT5kb25lX2ZlbmNlKTsKPiA+ICAKPiA+ICAJaWYgKGJp
bikKPiA+ICAJCXYzZF9qb2JfcHV0KCZiaW4tPmJhc2UpOwo+ID4gIAl2M2Rfam9iX3B1dCgmcmVu
ZGVyLT5iYXNlKTsKPiA+ICsJaWYgKGNsZWFuX2pvYikKPiA+ICsJCXYzZF9qb2JfcHV0KGNsZWFu
X2pvYik7Cj4gPiAgCj4gPiAgCXJldHVybiAwOwo+ID4gIAo+ID4gIGZhaWxfdW5yZXNlcnZlOgo+
ID4gIAltdXRleF91bmxvY2soJnYzZC0+c2NoZWRfbG9jayk7Cj4gPiAtCWRybV9nZW1fdW5sb2Nr
X3Jlc2VydmF0aW9ucyhyZW5kZXItPmJhc2UuYm8sCj4gPiAtCQkJCSAgICByZW5kZXItPmJhc2Uu
Ym9fY291bnQsCj4gPiAmYWNxdWlyZV9jdHgpOwo+ID4gKwlkcm1fZ2VtX3VubG9ja19yZXNlcnZh
dGlvbnMobGFzdF9qb2ItPmJvLAo+ID4gKwkJCQkgICAgbGFzdF9qb2ItPmJvX2NvdW50LCAmYWNx
dWlyZV9jdHgpOwo+ID4gIGZhaWw6Cj4gPiAgCWlmIChiaW4pCj4gPiAgCQl2M2Rfam9iX3B1dCgm
YmluLT5iYXNlKTsKPiA+ICAJdjNkX2pvYl9wdXQoJnJlbmRlci0+YmFzZSk7Cj4gPiArCWlmIChj
bGVhbl9qb2IpCj4gPiArCQl2M2Rfam9iX3B1dChjbGVhbl9qb2IpOwo+ID4gIAo+ID4gIAlyZXR1
cm4gcmV0Owo+ID4gIH0KPiA+IGRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL3YzZF9kcm0u
aAo+ID4gYi9pbmNsdWRlL3VhcGkvZHJtL3YzZF9kcm0uaAo+ID4gaW5kZXggNThmYmU0OGM5MWU5
Li41OGQyMDQwZWE0OGMgMTAwNjQ0Cj4gPiAtLS0gYS9pbmNsdWRlL3VhcGkvZHJtL3YzZF9kcm0u
aAo+ID4gKysrIGIvaW5jbHVkZS91YXBpL2RybS92M2RfZHJtLmgKPiA+IEBAIC00OCw2ICs0OCw4
IEBAIGV4dGVybiAiQyIgewo+ID4gICNkZWZpbmUgRFJNX0lPQ1RMX1YzRF9TVUJNSVRfVEZVICAg
ICAgICAgIERSTV9JT1coRFJNX0NPTU1BTkRfQkFTRQo+ID4gKyBEUk1fVjNEX1NVQk1JVF9URlUs
IHN0cnVjdCBkcm1fdjNkX3N1Ym1pdF90ZnUpCj4gPiAgI2RlZmluZSBEUk1fSU9DVExfVjNEX1NV
Qk1JVF9DU0QgICAgICAgICAgRFJNX0lPVyhEUk1fQ09NTUFORF9CQVNFCj4gPiArIERSTV9WM0Rf
U1VCTUlUX0NTRCwgc3RydWN0IGRybV92M2Rfc3VibWl0X2NzZCkKPiA+ICAKPiA+ICsjZGVmaW5l
IERSTV9WM0RfU1VCTUlUX0NMX0ZMVVNIX0NBQ0hFX0ZMQUcgICAgICAgIDB4MDEKPiA+ICsKPiA+
ICAvKioKPiA+ICAgKiBzdHJ1Y3QgZHJtX3YzZF9zdWJtaXRfY2wgLSBpb2N0bCBhcmd1bWVudCBm
b3Igc3VibWl0dGluZwo+ID4gY29tbWFuZHMgdG8gdGhlIDNECj4gPiAgICogZW5naW5lLgo+ID4g
QEAgLTYxLDcgKzYzLDcgQEAgZXh0ZXJuICJDIiB7Cj4gPiAgICogZmx1c2hlZCBieSB0aGUgdGlt
ZSB0aGUgcmVuZGVyIGRvbmUgSVJRIGhhcHBlbnMsIHdoaWNoIGlzIHRoZQo+ID4gICAqIHRyaWdn
ZXIgZm9yIG91dF9zeW5jLiAgQW55IGRpcnR5aW5nIG9mIGNhY2hlbGluZXMgYnkgdGhlIGpvYgo+
ID4gKG9ubHkKPiA+ICAgKiBwb3NzaWJsZSB1c2luZyBUTVUgd3JpdGVzKSBtdXN0IGJlIGZsdXNo
ZWQgYnkgdGhlIGNhbGxlciB1c2luZwo+ID4gdGhlCj4gPiAtICogQ0wncyBjYWNoZSBmbHVzaCBj
b21tYW5kcy4KPiA+ICsgKiBEUk1fVjNEX1NVQk1JVF9DTF9GTFVTSF9DQUNIRV9GTEFHIGZsYWcu
Cj4gPiAgICovCj4gPiAgc3RydWN0IGRybV92M2Rfc3VibWl0X2NsIHsKPiA+ICAJLyogUG9pbnRl
ciB0byB0aGUgYmlubmVyIGNvbW1hbmQgbGlzdC4KPiA+IEBAIC0xMjQsOCArMTI2LDcgQEAgc3Ry
dWN0IGRybV92M2Rfc3VibWl0X2NsIHsKPiA+ICAJLyogTnVtYmVyIG9mIEJPIGhhbmRsZXMgcGFz
c2VkIGluIChzaXplIGlzIHRoYXQgdGltZXMgNCkuICovCj4gPiAgCV9fdTMyIGJvX2hhbmRsZV9j
b3VudDsKPiA+ICAKPiA+IC0JLyogUGFkLCBtdXN0IGJlIHplcm8tZmlsbGVkLiAqLwo+ID4gLQlf
X3UzMiBwYWQ7Cj4gPiArCV9fdTMyIGZsYWdzOwo+ID4gIH07Cj4gPiAgCj4gPiAgLyoqCj4gPiAt
LSAKPiA+IDIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRl
dmVs
