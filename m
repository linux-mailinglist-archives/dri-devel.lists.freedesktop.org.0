Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A42C8178E67
	for <lists+dri-devel@lfdr.de>; Wed,  4 Mar 2020 11:29:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3F90F6EB11;
	Wed,  4 Mar 2020 10:29:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa2.bahnhof.se (ste-pvt-msa2.bahnhof.se
 [213.80.101.71])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 471116EB0B
 for <dri-devel@lists.freedesktop.org>; Wed,  4 Mar 2020 10:28:53 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTP id 7370F3FE3D;
 Wed,  4 Mar 2020 11:28:51 +0100 (CET)
Authentication-Results: ste-pvt-msa2.bahnhof.se; dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=W2fo0a5E; 
 dkim-atps=neutral
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Authentication-Results: ste-ftg-msa2.bahnhof.se (amavisd-new);
 dkim=pass (1024-bit key) header.d=shipmail.org
Received: from ste-pvt-msa2.bahnhof.se ([127.0.0.1])
 by localhost (ste-ftg-msa2.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id xE_mC59_WbOz; Wed,  4 Mar 2020 11:28:50 +0100 (CET)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTPA id 5A4603FCD5;
 Wed,  4 Mar 2020 11:28:50 +0100 (CET)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 5EEC53605FD;
 Wed,  4 Mar 2020 11:28:48 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=shipmail.org; s=mail;
 t=1583317728; bh=YWEV2L/GcJ/BB131ReqWiiuK/xyWwF22eft0YAMzYMA=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=W2fo0a5EPnmBYoU528KAmsMJbf5JwP9aQUc7vBUF2tq1NSLiL58UYXznsxYwCy6Zo
 2sPG69nObSpsZ3OmA6GmWPoAvtwnBzbaFws2FebHsTf5OreODPgYXQvQ/9oEGc9564
 8QOY/JTgTw31j4rmBFEtM4FjmXVBT8HSIGmdFd5U=
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: linux-mm@kvack.org, dri-devel@lists.freedesktop.org,
 linux-kernel@vger.kernel.org
Subject: [PATCH v6 5/9] drm/ttm, drm/vmwgfx: Support huge TTM pagefaults
Date: Wed,  4 Mar 2020 11:28:36 +0100
Message-Id: <20200304102840.2801-6-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.21.1
In-Reply-To: <20200304102840.2801-1-thomas_os@shipmail.org>
References: <20200304102840.2801-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 pv-drivers@vmware.com, Roland Scheidegger <sroland@vmware.com>,
 Dan Williams <dan.j.williams@intel.com>, Ralph Campbell <rcampbell@nvidia.com>,
 "Matthew Wilcox \(Oracle\)" <willy@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com,
 Andrew Morton <akpm@linux-foundation.org>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 "Kirill A. Shutemov" <kirill.shutemov@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKU3VwcG9ydCBo
dWdlIChQTUQtc2l6ZSBhbmQgUFVELXNpemUpIHBhZ2UtdGFibGUgZW50cmllcyBieSBwcm92aWRp
bmcgYQpodWdlX2ZhdWx0KCkgY2FsbGJhY2suCldlIHN0aWxsIHN1cHBvcnQgcHJpdmF0ZSBtYXBw
aW5ncyBhbmQgd3JpdGUtbm90aWZ5IGJ5IHNwbGl0dGluZyB0aGUgaHVnZQpwYWdlLXRhYmxlIGVu
dHJpZXMgb24gd3JpdGUtYWNjZXNzLgoKTm90ZSB0aGF0IGZvciBodWdlIHBhZ2UtZmF1bHRzIHRv
IG9jY3VyLCBlaXRoZXIgdGhlIGtlcm5lbCBuZWVkcyB0byBiZQpjb21waWxlZCB3aXRoIHRyYW5z
LWh1Z2UtcGFnZXMgYWx3YXlzIGVuYWJsZWQsIG9yIHRoZSBrZXJuZWwgbmVlZHMgdG8gYmUKY29t
cGlsZWQgd2l0aCB0cmFucy1odWdlLXBhZ2VzIGVuYWJsZWQgdXNpbmcgbWFkdmlzZSwgYW5kIHRo
ZSB1c2VyLXNwYWNlCmFwcCBuZWVkcyB0byBjYWxsIG1hZHZpc2UoKSB0byBlbmFibGUgdHJhbnMt
aHVnZSBwYWdlcyBvbiBhIHBlci1tYXBwaW5nCmJhc2lzLgoKRnVydGhlcm1vcmUgaHVnZSBwYWdl
LWZhdWx0cyB3aWxsIG5vdCBzdWNjZWVkIHVubGVzcyBidWZmZXIgb2JqZWN0cyBhbmQKdXNlci1z
cGFjZSBhZGRyZXNzZXMgYXJlIGFsaWduZWQgb24gaHVnZSBwYWdlIHNpemUgYm91bmRhcmllcy4K
CkNjOiBBbmRyZXcgTW9ydG9uIDxha3BtQGxpbnV4LWZvdW5kYXRpb24ub3JnPgpDYzogTWljaGFs
IEhvY2tvIDxtaG9ja29Ac3VzZS5jb20+CkNjOiAiTWF0dGhldyBXaWxjb3ggKE9yYWNsZSkiIDx3
aWxseUBpbmZyYWRlYWQub3JnPgpDYzogIktpcmlsbCBBLiBTaHV0ZW1vdiIgPGtpcmlsbC5zaHV0
ZW1vdkBsaW51eC5pbnRlbC5jb20+CkNjOiBSYWxwaCBDYW1wYmVsbCA8cmNhbXBiZWxsQG52aWRp
YS5jb20+CkNjOiAiSsOpcsO0bWUgR2xpc3NlIiA8amdsaXNzZUByZWRoYXQuY29tPgpDYzogIkNo
cmlzdGlhbiBLw7ZuaWciIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBEYW4gV2lsbGlh
bXMgPGRhbi5qLndpbGxpYW1zQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxz
dHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgpSZXZpZXdlZC1ieTogUm9sYW5kIFNjaGVpZGVn
Z2VyIDxzcm9sYW5kQHZtd2FyZS5jb20+ClJldmlld2VkLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxj
aHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9f
dm0uYyAgICAgICAgICAgIHwgMTYxICsrKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9ncHUv
ZHJtL3Ztd2dmeC92bXdnZnhfcGFnZV9kaXJ0eS5jIHwgICAyICstCiBpbmNsdWRlL2RybS90dG0v
dHRtX2JvX2FwaS5oICAgICAgICAgICAgICAgfCAgIDMgKy0KIDMgZmlsZXMgY2hhbmdlZCwgMTYx
IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3R0bS90dG1fYm9fdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKaW5k
ZXggMzg5MTI4YjhjNGRkLi4wYWYxNDgzNTUwNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvX3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwpA
QCAtMTU2LDYgKzE1Niw4OSBAQCB2bV9mYXVsdF90IHR0bV9ib192bV9yZXNlcnZlKHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8sCiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib192bV9yZXNlcnZl
KTsKIAorI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQorLyoqCisgKiB0dG1fYm9f
dm1faW5zZXJ0X2h1Z2UgLSBJbnNlcnQgYSBwZm4gZm9yIFBVRCBvciBQTUQgZmF1bHRzCisgKiBA
dm1mOiBGYXVsdCBkYXRhCisgKiBAYm86IFRoZSBidWZmZXIgb2JqZWN0CisgKiBAcGFnZV9vZmZz
ZXQ6IFBhZ2Ugb2Zmc2V0IGZyb20gYm8gc3RhcnQKKyAqIEBmYXVsdF9wYWdlX3NpemU6IFRoZSBz
aXplIG9mIHRoZSBmYXVsdCBpbiBwYWdlcy4KKyAqIEBwZ3Byb3Q6IFRoZSBwYWdlIHByb3RlY3Rp
b25zLgorICogRG9lcyBhZGRpdGlvbmFsIGNoZWNraW5nIHdoZXRoZXIgaXQncyBwb3NzaWJsZSB0
byBpbnNlcnQgYSBQVUQgb3IgUE1ECisgKiBwZm4gYW5kIHBlcmZvcm1zIHRoZSBpbnNlcnRpb24u
CisgKgorICogUmV0dXJuOiBWTV9GQVVMVF9OT1BBR0Ugb24gc3VjY2Vzc2Z1bCBpbnNlcnRpb24s
IFZNX0ZBVUxUX0ZBTExCQUNLIGlmCisgKiBhIGh1Z2UgZmF1bHQgd2FzIG5vdCBwb3NzaWJsZSwg
b3Igb24gaW5zZXJ0aW9uIGVycm9yLgorICovCitzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1f
aW5zZXJ0X2h1Z2Uoc3RydWN0IHZtX2ZhdWx0ICp2bWYsCisJCQkJCXN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8sCisJCQkJCXBnb2ZmX3QgcGFnZV9vZmZzZXQsCisJCQkJCXBnb2ZmX3QgZmF1
bHRfcGFnZV9zaXplLAorCQkJCQlwZ3Byb3RfdCBwZ3Byb3QpCit7CisJcGdvZmZfdCBpOworCXZt
X2ZhdWx0X3QgcmV0OworCXVuc2lnbmVkIGxvbmcgcGZuOworCXBmbl90IHBmbnQ7CisJc3RydWN0
IHR0bV90dCAqdHRtID0gYm8tPnR0bTsKKwlib29sIHdyaXRlID0gdm1mLT5mbGFncyAmIEZBVUxU
X0ZMQUdfV1JJVEU7CisKKwkvKiBGYXVsdCBzaG91bGQgbm90IGNyb3NzIGJvIGJvdW5kYXJ5LiAq
LworCXBhZ2Vfb2Zmc2V0ICY9IH4oZmF1bHRfcGFnZV9zaXplIC0gMSk7CisJaWYgKHBhZ2Vfb2Zm
c2V0ICsgZmF1bHRfcGFnZV9zaXplID4gYm8tPm51bV9wYWdlcykKKwkJZ290byBvdXRfZmFsbGJh
Y2s7CisKKwlpZiAoYm8tPm1lbS5idXMuaXNfaW9tZW0pCisJCXBmbiA9IHR0bV9ib19pb19tZW1f
cGZuKGJvLCBwYWdlX29mZnNldCk7CisJZWxzZQorCQlwZm4gPSBwYWdlX3RvX3Bmbih0dG0tPnBh
Z2VzW3BhZ2Vfb2Zmc2V0XSk7CisKKwkvKiBwZm4gbXVzdCBiZSBmYXVsdF9wYWdlX3NpemUgYWxp
Z25lZC4gKi8KKwlpZiAoKHBmbiAmIChmYXVsdF9wYWdlX3NpemUgLSAxKSkgIT0gMCkKKwkJZ290
byBvdXRfZmFsbGJhY2s7CisKKwkvKiBDaGVjayB0aGF0IG1lbW9yeSBpcyBjb250aWd1b3VzLiAq
LworCWlmICghYm8tPm1lbS5idXMuaXNfaW9tZW0pIHsKKwkJZm9yIChpID0gMTsgaSA8IGZhdWx0
X3BhZ2Vfc2l6ZTsgKytpKSB7CisJCQlpZiAocGFnZV90b19wZm4odHRtLT5wYWdlc1twYWdlX29m
ZnNldCArIGldKSAhPSBwZm4gKyBpKQorCQkJCWdvdG8gb3V0X2ZhbGxiYWNrOworCQl9CisJfSBl
bHNlIGlmIChiby0+YmRldi0+ZHJpdmVyLT5pb19tZW1fcGZuKSB7CisJCWZvciAoaSA9IDE7IGkg
PCBmYXVsdF9wYWdlX3NpemU7ICsraSkgeworCQkJaWYgKHR0bV9ib19pb19tZW1fcGZuKGJvLCBw
YWdlX29mZnNldCArIGkpICE9IHBmbiArIGkpCisJCQkJZ290byBvdXRfZmFsbGJhY2s7CisJCX0K
Kwl9CisKKwlwZm50ID0gX19wZm5fdG9fcGZuX3QocGZuLCBQRk5fREVWKTsKKwlpZiAoZmF1bHRf
cGFnZV9zaXplID09IChIUEFHRV9QTURfU0laRSA+PiBQQUdFX1NISUZUKSkKKwkJcmV0ID0gdm1m
X2luc2VydF9wZm5fcG1kX3Byb3Qodm1mLCBwZm50LCBwZ3Byb3QsIHdyaXRlKTsKKyNpZmRlZiBD
T05GSUdfSEFWRV9BUkNIX1RSQU5TUEFSRU5UX0hVR0VQQUdFX1BVRAorCWVsc2UgaWYgKGZhdWx0
X3BhZ2Vfc2l6ZSA9PSAoSFBBR0VfUFVEX1NJWkUgPj4gUEFHRV9TSElGVCkpCisJCXJldCA9IHZt
Zl9pbnNlcnRfcGZuX3B1ZF9wcm90KHZtZiwgcGZudCwgcGdwcm90LCB3cml0ZSk7CisjZW5kaWYK
KwllbHNlCisJCVdBUk5fT05fT05DRShyZXQgPSBWTV9GQVVMVF9GQUxMQkFDSyk7CisKKwlpZiAo
cmV0ICE9IFZNX0ZBVUxUX05PUEFHRSkKKwkJZ290byBvdXRfZmFsbGJhY2s7CisKKwlyZXR1cm4g
Vk1fRkFVTFRfTk9QQUdFOworb3V0X2ZhbGxiYWNrOgorCWNvdW50X3ZtX2V2ZW50KFRIUF9GQVVM
VF9GQUxMQkFDSyk7CisJcmV0dXJuIFZNX0ZBVUxUX0ZBTExCQUNLOworfQorI2Vsc2UKK3N0YXRp
YyB2bV9mYXVsdF90IHR0bV9ib192bV9pbnNlcnRfaHVnZShzdHJ1Y3Qgdm1fZmF1bHQgKnZtZiwK
KwkJCQkJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKKwkJCQkJcGdvZmZfdCBwYWdlX29m
ZnNldCwKKwkJCQkJcGdvZmZfdCBmYXVsdF9wYWdlX3NpemUsCisJCQkJCXBncHJvdF90IHBncHJv
dCkKK3sKKwlyZXR1cm4gVk1fRkFVTFRfRkFMTEJBQ0s7Cit9CisjZW5kaWYKKwogLyoqCiAgKiB0
dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQgLSBUVE0gZmF1bHQgaGVscGVyCiAgKiBAdm1mOiBUaGUg
c3RydWN0IHZtX2ZhdWx0IGdpdmVuIGFzIGFyZ3VtZW50IHRvIHRoZSBmYXVsdCBjYWxsYmFjawpA
QCAtMTYzLDYgKzI0Niw3IEBAIEVYUE9SVF9TWU1CT0wodHRtX2JvX3ZtX3Jlc2VydmUpOwogICog
QG51bV9wcmVmYXVsdDogTWF4aW11bSBudW1iZXIgb2YgcHJlZmF1bHQgcGFnZXMuIFRoZSBjYWxs
ZXIgbWF5IHdhbnQgdG8KICAqIHNwZWNpZnkgdGhpcyBiYXNlZCBvbiBtYWR2aWNlIHNldHRpbmdz
IGFuZCB0aGUgc2l6ZSBvZiB0aGUgR1BVIG9iamVjdAogICogYmFja2VkIGJ5IHRoZSBtZW1vcnku
CisgKiBAZmF1bHRfcGFnZV9zaXplOiBUaGUgc2l6ZSBvZiB0aGUgZmF1bHQgaW4gcGFnZXMuCiAg
KgogICogVGhpcyBmdW5jdGlvbiBpbnNlcnRzIG9uZSBvciBtb3JlIHBhZ2UgdGFibGUgZW50cmll
cyBwb2ludGluZyB0byB0aGUKICAqIG1lbW9yeSBiYWNraW5nIHRoZSBidWZmZXIgb2JqZWN0LCBh
bmQgdGhlbiByZXR1cm5zIGEgcmV0dXJuIGNvZGUKQEAgLTE3Niw3ICsyNjAsOCBAQCBFWFBPUlRf
U1lNQk9MKHR0bV9ib192bV9yZXNlcnZlKTsKICAqLwogdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1
bHRfcmVzZXJ2ZWQoc3RydWN0IHZtX2ZhdWx0ICp2bWYsCiAJCQkJICAgIHBncHJvdF90IHByb3Qs
Ci0JCQkJICAgIHBnb2ZmX3QgbnVtX3ByZWZhdWx0KQorCQkJCSAgICBwZ29mZl90IG51bV9wcmVm
YXVsdCwKKwkJCQkgICAgcGdvZmZfdCBmYXVsdF9wYWdlX3NpemUpCiB7CiAJc3RydWN0IHZtX2Fy
ZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
ID0gdm1hLT52bV9wcml2YXRlX2RhdGE7CkBAIC0yNjgsNiArMzUzLDEzIEBAIHZtX2ZhdWx0X3Qg
dHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHN0cnVjdCB2bV9mYXVsdCAqdm1mLAogCQlwcm90ID0g
cGdwcm90X2RlY3J5cHRlZChwcm90KTsKIAl9CiAKKwkvKiBXZSBkb24ndCBwcmVmYXVsdCBvbiBo
dWdlIGZhdWx0cy4gWWV0LiAqLworCWlmIChJU19FTkFCTEVEKENPTkZJR19UUkFOU1BBUkVOVF9I
VUdFUEFHRSkgJiYgZmF1bHRfcGFnZV9zaXplICE9IDEpIHsKKwkJcmV0ID0gdHRtX2JvX3ZtX2lu
c2VydF9odWdlKHZtZiwgYm8sIHBhZ2Vfb2Zmc2V0LAorCQkJCQkgICAgZmF1bHRfcGFnZV9zaXpl
LCBwcm90KTsKKwkJZ290byBvdXRfaW9fdW5sb2NrOworCX0KKwogCS8qCiAJICogU3BlY3VsYXRp
dmVseSBwcmVmYXVsdCBhIG51bWJlciBvZiBwYWdlcy4gT25seSBlcnJvciBvbgogCSAqIGZpcnN0
IHBhZ2UuCkBAIC0zMzQsNyArNDI2LDcgQEAgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQoc3Ry
dWN0IHZtX2ZhdWx0ICp2bWYpCiAJCXJldHVybiByZXQ7CiAKIAlwcm90ID0gdm1hLT52bV9wYWdl
X3Byb3Q7Ci0JcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwgcHJvdCwgVFRNX0JP
X1ZNX05VTV9QUkVGQVVMVCk7CisJcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwg
cHJvdCwgVFRNX0JPX1ZNX05VTV9QUkVGQVVMVCwgMSk7CiAJaWYgKHJldCA9PSBWTV9GQVVMVF9S
RVRSWSAmJiAhKHZtZi0+ZmxhZ3MgJiBGQVVMVF9GTEFHX1JFVFJZX05PV0FJVCkpCiAJCXJldHVy
biByZXQ7CiAKQEAgLTM0NCw2ICs0MzYsNjYgQEAgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQo
c3RydWN0IHZtX2ZhdWx0ICp2bWYpCiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib192bV9mYXVsdCk7
CiAKKyNpZmRlZiBDT05GSUdfVFJBTlNQQVJFTlRfSFVHRVBBR0UKKy8qKgorICogdHRtX3BncHJv
dF9pc193cnByb3RlY3RpbmcgLSBJcyBhIHBhZ2UgcHJvdGVjdGlvbiB2YWx1ZSB3cml0ZS1wcm90
ZWN0aW5nPworICogQHByb3Q6IFRoZSBwYWdlIHByb3RlY3Rpb24gdmFsdWUKKyAqCisgKiBSZXR1
cm46IHRydWUgaWYgQHByb3QgaXMgd3JpdGUtcHJvdGVjdGluZy4gZmFsc2Ugb3RoZXJ3aXNlLgor
ICovCitzdGF0aWMgYm9vbCB0dG1fcGdwcm90X2lzX3dycHJvdGVjdGluZyhwZ3Byb3RfdCBwcm90
KQoreworCS8qCisJICogVGhpcyBpcyBtZWFudCB0byBzYXkgInBncHJvdF93cnByb3RlY3QocHJv
dCkgPT0gcHJvdCIgaW4gYSBnZW5lcmljCisJICogd2F5LiBVbmZvcnR1bmF0ZWx5IHRoZXJlIGlz
IG5vIGdlbmVyaWMgcGdwcm90X3dycHJvdGVjdC4KKwkgKi8KKwlyZXR1cm4gcHRlX3ZhbChwdGVf
d3Jwcm90ZWN0KF9fcHRlKHBncHJvdF92YWwocHJvdCkpKSkgPT0KKwkJcGdwcm90X3ZhbChwcm90
KTsKK30KKworc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2h1Z2VfZmF1bHQoc3RydWN0IHZt
X2ZhdWx0ICp2bWYsCisJCQkJICAgICAgIGVudW0gcGFnZV9lbnRyeV9zaXplIHBlX3NpemUpCit7
CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKKwlwZ3Byb3RfdCBwcm90
OworCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsK
Kwl2bV9mYXVsdF90IHJldDsKKwlwZ29mZl90IGZhdWx0X3BhZ2Vfc2l6ZSA9IDA7CisJYm9vbCB3
cml0ZSA9IHZtZi0+ZmxhZ3MgJiBGQVVMVF9GTEFHX1dSSVRFOworCisJc3dpdGNoIChwZV9zaXpl
KSB7CisJY2FzZSBQRV9TSVpFX1BNRDoKKwkJZmF1bHRfcGFnZV9zaXplID0gSFBBR0VfUE1EX1NJ
WkUgPj4gUEFHRV9TSElGVDsKKwkJYnJlYWs7CisjaWZkZWYgQ09ORklHX0hBVkVfQVJDSF9UUkFO
U1BBUkVOVF9IVUdFUEFHRV9QVUQKKwljYXNlIFBFX1NJWkVfUFVEOgorCQlmYXVsdF9wYWdlX3Np
emUgPSBIUEFHRV9QVURfU0laRSA+PiBQQUdFX1NISUZUOworCQlicmVhazsKKyNlbmRpZgorCWRl
ZmF1bHQ6CisJCVdBUk5fT05fT05DRSgxKTsKKwkJcmV0dXJuIFZNX0ZBVUxUX0ZBTExCQUNLOwor
CX0KKworCS8qIEZhbGxiYWNrIG9uIHdyaXRlIGRpcnR5LXRyYWNraW5nIG9yIENPVyAqLworCWlm
ICh3cml0ZSAmJiB0dG1fcGdwcm90X2lzX3dycHJvdGVjdGluZyh2bWEtPnZtX3BhZ2VfcHJvdCkp
CisJCXJldHVybiBWTV9GQVVMVF9GQUxMQkFDSzsKKworCXJldCA9IHR0bV9ib192bV9yZXNlcnZl
KGJvLCB2bWYpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlwcm90ID0gdm1fZ2V0X3Bh
Z2VfcHJvdCh2bWEtPnZtX2ZsYWdzKTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQo
dm1mLCBwcm90LCAxLCBmYXVsdF9wYWdlX3NpemUpOworCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVU
UlkgJiYgISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQorCQlyZXR1cm4g
cmV0OworCisJZG1hX3Jlc3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOworCisJcmV0dXJuIHJldDsK
K30KKyNlbmRpZgorCiB2b2lkIHR0bV9ib192bV9vcGVuKHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
dm1hKQogewogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVf
ZGF0YTsKQEAgLTQ0NSw3ICs1OTcsMTAgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB2bV9vcGVyYXRp
b25zX3N0cnVjdCB0dG1fYm9fdm1fb3BzID0gewogCS5mYXVsdCA9IHR0bV9ib192bV9mYXVsdCwK
IAkub3BlbiA9IHR0bV9ib192bV9vcGVuLAogCS5jbG9zZSA9IHR0bV9ib192bV9jbG9zZSwKLQku
YWNjZXNzID0gdHRtX2JvX3ZtX2FjY2VzcworCS5hY2Nlc3MgPSB0dG1fYm9fdm1fYWNjZXNzLAor
I2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQorCS5odWdlX2ZhdWx0ID0gdHRtX2Jv
X3ZtX2h1Z2VfZmF1bHQsCisjZW5kaWYKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKnR0bV9ib192bV9sb29rdXAoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMKaW5kZXggZjA3YWE4NTc1ODdj
Li4xN2E1ZGNhN2I5MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4
X3BhZ2VfZGlydHkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2Rp
cnR5LmMKQEAgLTQ3Nyw3ICs0NzcsNyBAQCB2bV9mYXVsdF90IHZtd19ib192bV9mYXVsdChzdHJ1
Y3Qgdm1fZmF1bHQgKnZtZikKIAllbHNlCiAJCXByb3QgPSB2bV9nZXRfcGFnZV9wcm90KHZtYS0+
dm1fZmxhZ3MpOwogCi0JcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwgcHJvdCwg
bnVtX3ByZWZhdWx0KTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1mLCBwcm90
LCBudW1fcHJlZmF1bHQsIDEpOwogCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYt
PmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQogCQlyZXR1cm4gcmV0OwogCmRpZmYg
LS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0
bV9ib19hcGkuaAppbmRleCA2NmNhNDlkYjk2MzMuLjRmYzkwZDUzYWExNSAxMDA2NDQKLS0tIGEv
aW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAorKysgYi9pbmNsdWRlL2RybS90dG0vdHRtX2Jv
X2FwaS5oCkBAIC03MzIsNyArNzMyLDggQEAgdm1fZmF1bHRfdCB0dG1fYm9fdm1fcmVzZXJ2ZShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCiB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVs
dF9yZXNlcnZlZChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZiwKIAkJCQkgICAgcGdwcm90X3QgcHJvdCwK
LQkJCQkgICAgcGdvZmZfdCBudW1fcHJlZmF1bHQpOworCQkJCSAgICBwZ29mZl90IG51bV9wcmVm
YXVsdCwKKwkJCQkgICAgcGdvZmZfdCBmYXVsdF9wYWdlX3NpemUpOwogCiB2bV9mYXVsdF90IHR0
bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZik7CiAKLS0gCjIuMjEuMQoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
