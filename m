Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E9137ECA6D
	for <lists+dri-devel@lfdr.de>; Fri,  1 Nov 2019 22:42:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5BCD16F882;
	Fri,  1 Nov 2019 21:42:51 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x444.google.com (mail-pf1-x444.google.com
 [IPv6:2607:f8b0:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AB4086F87C
 for <dri-devel@lists.freedesktop.org>; Fri,  1 Nov 2019 21:42:47 +0000 (UTC)
Received: by mail-pf1-x444.google.com with SMTP id 21so7896710pfj.9
 for <dri-devel@lists.freedesktop.org>; Fri, 01 Nov 2019 14:42:47 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=BKopGp18VfB8thzYt3B0RriqVl7rtglmz7RmjgpOFFU=;
 b=S5ZaHrIn8Q7sDi1/L1XKEcYo2aW02pQSVSQlXyevCHQRh6ogu76FM5uLgeB1D8nCb3
 07KRrHiy69hv+TBWbnlw0xHvc65LgSXoptVbTR4wYXOag+1M6byCvLCsM66JZcgfXVOW
 1qXSLgI3Z54h20Hq0EafxHHUWkt/bdpkTIIVrKHULdGjrpspBJZMTD+eCTDX7dr2UaE5
 6PT8eTaTu14Tq/teh084UysPuoW3/uFZUyOtZV5I+kKiwNyM1r09taMoBxN35aWlLp6i
 fSt8zifM0VL2kBTQJ+Ned6IULxyWzxR4r8E5WSKqQbBg0uvrMJ+qpwZCszRr3fQvJHZb
 Ma8Q==
X-Gm-Message-State: APjAAAXGxQHpZ+S8vW3fZEa2iDGA7qZLr6KbgsTWCrBcC3ZCt2WUuTFx
 EV8N77vaq6P7/k3dARr8adF1UA==
X-Google-Smtp-Source: APXvYqzVnfDmbrk/uqmXW1DjOyXPCzoLFf/gLPS8NVxfobXsXQcOTxM2J9LazYgBPcCnG7O8yWAAuw==
X-Received: by 2002:a62:1ad6:: with SMTP id a205mr16030502pfa.64.1572644567226; 
 Fri, 01 Nov 2019 14:42:47 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 u36sm8299058pgn.29.2019.11.01.14.42.46
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 01 Nov 2019 14:42:46 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v14 5/5] kselftests: Add dma-heap test
Date: Fri,  1 Nov 2019 21:42:38 +0000
Message-Id: <20191101214238.78015-6-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191101214238.78015-1-john.stultz@linaro.org>
References: <20191101214238.78015-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=BKopGp18VfB8thzYt3B0RriqVl7rtglmz7RmjgpOFFU=;
 b=KrVy1MKKM2w+NP5NbHceS58OGoeZN6dYS27RPSclt0xd3XWuYV6w5lEthbMmYmlLlL
 x3QpmB3a6Fzmywa0O9SRlUcAUC2ZW2z8/u+/FyuHQ7ogLNi4LVKNQBhj9qh+h3kIO2bi
 2exN+l3mY+HWqQZw6AUEscSN6x1QbvUn+PtKnQgo4Lwz3VdKBkcJitQjHcaVkrfZeQZP
 LA1HyzeR3cH9mlXZS+frQI3bPYjNcMUr66tTGGK0DrkgEteUI18DNtJde/F22WN4Cest
 bZ1kKMycP1QM4w7YUojd2aqAE2ZHdmr8oH9PY7sqcfrg/HmZDo/1RSFas3Y3kGakKZK3
 CAiA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sandeep Patil <sspatil@google.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Sudipto Paul <Sudipto.Paul@arm.com>, Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIHZlcnkgdHJpdmlhbCBhbGxvY2F0aW9uIGFuZCBpbXBvcnQgdGVzdCBmb3IgZG1hLWhlYXBz
LAp1dGlsaXppbmcgdGhlIHZnZW0gZHJpdmVyIGFzIGEgdGVzdCBpbXBvcnRlci4KCkEgZ29vZCBj
aHVuayBvZiB0aGlzIGNvZGUgdGFrZW4gZnJvbToKICB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9h
bmRyb2lkL2lvbi9pb25tYXBfdGVzdC5jCiAgT3JpZ2luYWxseSBieSBMYXVyYSBBYmJvdHQgPGxh
YmJvdHRAcmVkaGF0LmNvbT4KCkNjOiBCZW5qYW1pbiBHYWlnbmFyZCA8YmVuamFtaW4uZ2FpZ25h
cmRAbGluYXJvLm9yZz4KQ2M6IFN1bWl0IFNlbXdhbCA8c3VtaXQuc2Vtd2FsQGxpbmFyby5vcmc+
CkNjOiBMaWFtIE1hcmsgPGxtYXJrQGNvZGVhdXJvcmEub3JnPgpDYzogUHJhdGlrIFBhdGVsIDxw
cmF0aWtwQGNvZGVhdXJvcmEub3JnPgpDYzogQnJpYW4gU3RhcmtleSA8QnJpYW4uU3RhcmtleUBh
cm0uY29tPgpDYzogVmluY2VudCBEb25uZWZvcnQgPFZpbmNlbnQuRG9ubmVmb3J0QGFybS5jb20+
CkNjOiBTdWRpcHRvIFBhdWwgPFN1ZGlwdG8uUGF1bEBhcm0uY29tPgpDYzogQW5kcmV3IEYuIERh
dmlzIDxhZmRAdGkuY29tPgpDYzogQ2hyaXN0b3BoIEhlbGx3aWcgPGhjaEBpbmZyYWRlYWQub3Jn
PgpDYzogQ2hlbmJvIEZlbmcgPGZlbmdjQGdvb2dsZS5jb20+CkNjOiBBbGlzdGFpciBTdHJhY2hh
biA8YXN0cmFjaGFuQGdvb2dsZS5jb20+CkNjOiBIcmlkeWEgVmFsc2FyYWp1IDxocmlkeWFAZ29v
Z2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwgPHNzcGF0aWxAZ29vZ2xlLmNvbT4KQ2M6IEhpbGxm
IERhbnRvbiA8aGRhbnRvbkBzaW5hLmNvbT4KQ2M6IERhdmUgQWlybGllIDxhaXJsaWVkQGdtYWls
LmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKUmV2aWV3ZWQtYnk6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpSZXZpZXdlZC1i
eTogQnJpYW4gU3RhcmtleSA8YnJpYW4uc3RhcmtleUBhcm0uY29tPgpBY2tlZC1ieTogTGF1cmEg
QWJib3R0IDxsYWJib3R0QHJlZGhhdC5jb20+ClRlc3RlZC1ieTogQXlhbiBLdW1hciBIYWxkZXIg
PGF5YW4uaGFsZGVyQGFybS5jb20+ClNpZ25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2huLnN0
dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogU3dpdGNoZWQgdG8gdXNlIHJld29ya2VkIGRtYS1o
ZWFwIGFwaXMKdjM6CiogQWRkIHNpbXBsZSBtbWFwCiogVXRpbGl6ZSBkbWEtYnVmIHRlc3RkZXYg
dG8gdGVzdCBpbXBvcnRpbmcKdjQ6CiogUmV3b3JrIHRvIHVzZSB2Z2VtCiogUGFzcyBpbiBmZF9m
bGFncyB0byBtYXRjaCBpbnRlcmZhY2UgY2hhbmdlcwoqIFNraXAgLiBhbmQgLi4gZGlycwp2NjoK
KiBOdW1iZXIgb2Ygc3R5bGUvY2xlYW51cHMgc3VnZ2VzdGVkIGJ5IEJyaWFuCnY3OgoqIFdoaXRl
c3BhY2UgZml4dXAgZm9yIGNoZWNrcGF0Y2gKdjg6CiogTW9yZSBjaGVja3BhdGNoIHdoaXRlc3Bh
Y2UgZml4dXBzCnY5OgoqIEJldHRlciBoYW5kbGluZyBlcnJvciByZXR1cm5zIG91dCB0byBtYWlu
LCBzdWdnZXN0ZWQKICBieSBCcmlhbiBTdGFya2V5CiogU3dpdGNoIHRvIHVzaW5nIHNucHJpbnRm
LCBzdWdnZXN0ZWQgYnkgQnJpYW4KdjE0OgoqIEZpeCBhIG1pc3NpbmcgcmV0dXJuIHZhbHVlCiog
QWRkIGNhbGxzIHRvIHRlc3QgdGhlIEdFVF9GRUFUVVJFUyBpb2N0bAoqIEJ1aWxkIGZpeCByZXBv
cnRlZCBieSBrZXJuZWwgdGVzdCByb2JvdCA8bGtwQGludGVsLmNvbT4KICBhbmQgZml4ZWQgYnkg
WGlhbyBZYW5nIDxpY2VfeWFuZ3hpYW9AMTYzLmNvbT4KKiBNaW5vciBNYWtlZmlsZSBjbGVhbnVw
cwotLS0KIHRvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2RtYWJ1Zi1oZWFwcy9NYWtlZmlsZSB8ICAg
NiArCiAuLi4vc2VsZnRlc3RzL2RtYWJ1Zi1oZWFwcy9kbWFidWYtaGVhcC5jICAgICAgfCAyNTUg
KysrKysrKysrKysrKysrKysrCiAyIGZpbGVzIGNoYW5nZWQsIDI2MSBpbnNlcnRpb25zKCspCiBj
cmVhdGUgbW9kZSAxMDA2NDQgdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvZG1hYnVmLWhlYXBzL01h
a2VmaWxlCiBjcmVhdGUgbW9kZSAxMDA2NDQgdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvZG1hYnVm
LWhlYXBzL2RtYWJ1Zi1oZWFwLmMKCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0
cy9kbWFidWYtaGVhcHMvTWFrZWZpbGUgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9kbWFidWYt
aGVhcHMvTWFrZWZpbGUKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42
MDdjMmFjZDIwODIKLS0tIC9kZXYvbnVsbAorKysgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9k
bWFidWYtaGVhcHMvTWFrZWZpbGUKQEAgLTAsMCArMSw2IEBACisjIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCitDRkxBR1MgKz0gLXN0YXRpYyAtTzMgLVdsLC1uby1hcy1uZWVkZWQg
LVdhbGwgLUkuLi8uLi8uLi8uLi91c3IvaW5jbHVkZQorCitURVNUX0dFTl9QUk9HUyA9IGRtYWJ1
Zi1oZWFwCisKK2luY2x1ZGUgLi4vbGliLm1rCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3Nl
bGZ0ZXN0cy9kbWFidWYtaGVhcHMvZG1hYnVmLWhlYXAuYyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRl
c3RzL2RtYWJ1Zi1oZWFwcy9kbWFidWYtaGVhcC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uZWM0NzkwMWVmMmUyCi0tLSAvZGV2L251bGwKKysrIGIvdG9vbHMvdGVz
dGluZy9zZWxmdGVzdHMvZG1hYnVmLWhlYXBzL2RtYWJ1Zi1oZWFwLmMKQEAgLTAsMCArMSwyNTUg
QEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisKKyNpbmNsdWRlIDxkaXJl
bnQuaD4KKyNpbmNsdWRlIDxlcnJuby5oPgorI2luY2x1ZGUgPGZjbnRsLmg+CisjaW5jbHVkZSA8
c3RkaW8uaD4KKyNpbmNsdWRlIDxzdGRsaWIuaD4KKyNpbmNsdWRlIDxzdGRpbnQuaD4KKyNpbmNs
dWRlIDxzdHJpbmcuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNsdWRlIDxzeXMvaW9jdGwu
aD4KKyNpbmNsdWRlIDxzeXMvbW1hbi5oPgorI2luY2x1ZGUgPHN5cy90eXBlcy5oPgorCisjaW5j
bHVkZSA8bGludXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGRybS9kcm0uaD4KKworI2luY2x1ZGUg
Ii4uLy4uLy4uLy4uL2luY2x1ZGUvdWFwaS9saW51eC9kbWEtaGVhcC5oIgorCisjZGVmaW5lIERF
VlBBVEggIi9kZXYvZG1hX2hlYXAiCisKK3N0YXRpYyBpbnQgY2hlY2tfdmdlbShpbnQgZmQpCit7
CisJZHJtX3ZlcnNpb25fdCB2ZXJzaW9uID0geyAwIH07CisJY2hhciBuYW1lWzVdOworCWludCBy
ZXQ7CisKKwl2ZXJzaW9uLm5hbWVfbGVuID0gNDsKKwl2ZXJzaW9uLm5hbWUgPSBuYW1lOworCisJ
cmV0ID0gaW9jdGwoZmQsIERSTV9JT0NUTF9WRVJTSU9OLCAmdmVyc2lvbik7CisJaWYgKHJldCkK
KwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gIXN0cmNtcChuYW1lLCAidmdlbSIpOworfQorCitzdGF0
aWMgaW50IG9wZW5fdmdlbSh2b2lkKQoreworCWludCBpLCBmZDsKKwljb25zdCBjaGFyICpkcm1z
dHIgPSAiL2Rldi9kcmkvY2FyZCI7CisKKwlmZCA9IC0xOworCWZvciAoaSA9IDA7IGkgPCAxNjsg
aSsrKSB7CisJCWNoYXIgbmFtZVs4MF07CisKKwkJc25wcmludGYobmFtZSwgODAsICIlcyV1Iiwg
ZHJtc3RyLCBpKTsKKworCQlmZCA9IG9wZW4obmFtZSwgT19SRFdSKTsKKwkJaWYgKGZkIDwgMCkK
KwkJCWNvbnRpbnVlOworCisJCWlmICghY2hlY2tfdmdlbShmZCkpIHsKKwkJCWNsb3NlKGZkKTsK
KwkJCWZkID0gLTE7CisJCQljb250aW51ZTsKKwkJfSBlbHNlIHsKKwkJCWJyZWFrOworCQl9CisJ
fQorCXJldHVybiBmZDsKK30KKworc3RhdGljIGludCBpbXBvcnRfdmdlbV9mZChpbnQgdmdlbV9m
ZCwgaW50IGRtYV9idWZfZmQsIHVpbnQzMl90ICpoYW5kbGUpCit7CisJc3RydWN0IGRybV9wcmlt
ZV9oYW5kbGUgaW1wb3J0X2hhbmRsZSA9IHsKKwkJLmZkID0gZG1hX2J1Zl9mZCwKKwkJLmZsYWdz
ID0gMCwKKwkJLmhhbmRsZSA9IDAsCisJIH07CisJaW50IHJldDsKKworCXJldCA9IGlvY3RsKHZn
ZW1fZmQsIERSTV9JT0NUTF9QUklNRV9GRF9UT19IQU5ETEUsICZpbXBvcnRfaGFuZGxlKTsKKwlp
ZiAocmV0ID09IDApCisJCSpoYW5kbGUgPSBpbXBvcnRfaGFuZGxlLmhhbmRsZTsKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgdm9pZCBjbG9zZV9oYW5kbGUoaW50IHZnZW1fZmQsIHVpbnQzMl90
IGhhbmRsZSkKK3sKKwlzdHJ1Y3QgZHJtX2dlbV9jbG9zZSBjbG9zZSA9IHsKKwkJLmhhbmRsZSA9
IGhhbmRsZSwKKwl9OworCisJaW9jdGwodmdlbV9mZCwgRFJNX0lPQ1RMX0dFTV9DTE9TRSwgJmNs
b3NlKTsKK30KKworc3RhdGljIGludCBkbWFidWZfaGVhcF9vcGVuKGNoYXIgKm5hbWUpCit7CisJ
aW50IHJldCwgZmQ7CisJY2hhciBidWZbMjU2XTsKKworCXJldCA9IHNucHJpbnRmKGJ1ZiwgMjU2
LCAiJXMvJXMiLCBERVZQQVRILCBuYW1lKTsKKwlpZiAocmV0IDwgMCkgeworCQlwcmludGYoInNu
cHJpbnRmIGZhaWxlZCFcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCWZkID0gb3BlbihidWYs
IE9fUkRXUik7CisJaWYgKGZkIDwgMCkKKwkJcHJpbnRmKCJvcGVuICVzIGZhaWxlZCFcbiIsIGJ1
Zik7CisJcmV0dXJuIGZkOworfQorCitzdGF0aWMgaW50IGRtYWJ1Zl9oZWFwX2dldF9mZWF0dXJl
cyhpbnQgZmQsIHVuc2lnbmVkIGxvbmcgbG9uZyAqZmVhdHVyZXMpCit7CisJc3RydWN0IGRtYV9o
ZWFwX2dldF9mZWF0dXJlc19kYXRhIGRhdGEgPSB7MH07CisJaW50IHJldDsKKworCXJldCA9IGlv
Y3RsKGZkLCBETUFfSEVBUF9JT0NfR0VUX0ZFQVRVUkVTLCAmZGF0YSk7CisJaWYgKHJldCA8IDAp
CisJCXJldHVybiByZXQ7CisKKwkqZmVhdHVyZXMgPSAoaW50KWRhdGEuZmVhdHVyZXM7CisJcmV0
dXJuIHJldDsKK30KKworc3RhdGljIGludCBkbWFidWZfaGVhcF9hbGxvYyhpbnQgZmQsIHNpemVf
dCBsZW4sIHVuc2lnbmVkIGludCBmbGFncywKKwkJCSAgICAgaW50ICpkbWFidWZfZmQpCit7CisJ
c3RydWN0IGRtYV9oZWFwX2FsbG9jYXRpb25fZGF0YSBkYXRhID0geworCQkubGVuID0gbGVuLAor
CQkuZmRfZmxhZ3MgPSBPX1JEV1IgfCBPX0NMT0VYRUMsCisJCS5oZWFwX2ZsYWdzID0gZmxhZ3Ms
CisJfTsKKwlpbnQgcmV0OworCisJaWYgKCFkbWFidWZfZmQpCisJCXJldHVybiAtRUlOVkFMOwor
CisJcmV0ID0gaW9jdGwoZmQsIERNQV9IRUFQX0lPQ19BTExPQywgJmRhdGEpOworCWlmIChyZXQg
PCAwKQorCQlyZXR1cm4gcmV0OworCSpkbWFidWZfZmQgPSAoaW50KWRhdGEuZmQ7CisJcmV0dXJu
IHJldDsKK30KKworc3RhdGljIHZvaWQgZG1hYnVmX3N5bmMoaW50IGZkLCBpbnQgc3RhcnRfc3Rv
cCkKK3sKKwlzdHJ1Y3QgZG1hX2J1Zl9zeW5jIHN5bmMgPSB7CisJCS5mbGFncyA9IHN0YXJ0X3N0
b3AgfCBETUFfQlVGX1NZTkNfUlcsCisJfTsKKwlpbnQgcmV0OworCisJcmV0ID0gaW9jdGwoZmQs
IERNQV9CVUZfSU9DVExfU1lOQywgJnN5bmMpOworCWlmIChyZXQpCisJCXByaW50Zigic3luYyBm
YWlsZWQgJWRcbiIsIGVycm5vKTsKK30KKworI2RlZmluZSBPTkVfTUVHICgxMDI0ICogMTAyNCkK
Kworc3RhdGljIGludCBkb190ZXN0KGNoYXIgKmhlYXBfbmFtZSkKK3sKKwlpbnQgaGVhcF9mZCA9
IC0xLCBkbWFidWZfZmQgPSAtMSwgaW1wb3J0ZXJfZmQgPSAtMTsKKwl1aW50MzJfdCBoYW5kbGUg
PSAwOworCXZvaWQgKnAgPSBOVUxMOworCXVuc2lnbmVkIGxvbmcgbG9uZyBmZWF0dXJlczsKKwlp
bnQgcmV0OworCisJcHJpbnRmKCJUZXN0aW5nIGhlYXA6ICVzXG4iLCBoZWFwX25hbWUpOworCisJ
aGVhcF9mZCA9IGRtYWJ1Zl9oZWFwX29wZW4oaGVhcF9uYW1lKTsKKwlpZiAoaGVhcF9mZCA8IDAp
CisJCXJldHVybiAtMTsKKworCWRtYWJ1Zl9oZWFwX2dldF9mZWF0dXJlcyhoZWFwX2ZkLCAmZmVh
dHVyZXMpOworCXByaW50ZigiSW50ZXJmYWNlIGZlYXR1cmVzOiAweCVsbHhcbiIsIGZlYXR1cmVz
KTsKKworCXByaW50ZigiQWxsb2NhdGluZyAxIE1FR1xuIik7CisJcmV0ID0gZG1hYnVmX2hlYXBf
YWxsb2MoaGVhcF9mZCwgT05FX01FRywgMCwgJmRtYWJ1Zl9mZCk7CisJaWYgKHJldCkgeworCQlw
cmludGYoIkFsbG9jYXRpb24gRmFpbGVkIVxuIik7CisJCXJldCA9IC0xOworCQlnb3RvIG91dDsK
Kwl9CisJLyogbW1hcCBhbmQgd3JpdGUgYSBzaW1wbGUgcGF0dGVybiAqLworCXAgPSBtbWFwKE5V
TEwsCisJCSBPTkVfTUVHLAorCQkgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKKwkJIE1BUF9TSEFS
RUQsCisJCSBkbWFidWZfZmQsCisJCSAwKTsKKwlpZiAocCA9PSBNQVBfRkFJTEVEKSB7CisJCXBy
aW50ZigibW1hcCgpIGZhaWxlZDogJW1cbiIpOworCQlyZXQgPSAtMTsKKwkJZ290byBvdXQ7CisJ
fQorCXByaW50ZigibW1hcCBwYXNzZWRcbiIpOworCisJZG1hYnVmX3N5bmMoZG1hYnVmX2ZkLCBE
TUFfQlVGX1NZTkNfU1RBUlQpOworCW1lbXNldChwLCAxLCBPTkVfTUVHIC8gMik7CisJbWVtc2V0
KChjaGFyICopcCArIE9ORV9NRUcgLyAyLCAwLCBPTkVfTUVHIC8gMik7CisJZG1hYnVmX3N5bmMo
ZG1hYnVmX2ZkLCBETUFfQlVGX1NZTkNfRU5EKTsKKworCWltcG9ydGVyX2ZkID0gb3Blbl92Z2Vt
KCk7CisJaWYgKGltcG9ydGVyX2ZkIDwgMCkgeworCQlyZXQgPSBpbXBvcnRlcl9mZDsKKwkJcHJp
bnRmKCJGYWlsZWQgdG8gb3BlbiB2Z2VtXG4iKTsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0g
aW1wb3J0X3ZnZW1fZmQoaW1wb3J0ZXJfZmQsIGRtYWJ1Zl9mZCwgJmhhbmRsZSk7CisJaWYgKHJl
dCA8IDApIHsKKwkJcHJpbnRmKCJGYWlsZWQgdG8gaW1wb3J0IGJ1ZmZlclxuIik7CisJCWdvdG8g
b3V0OworCX0KKwlwcmludGYoImltcG9ydCBwYXNzZWRcbiIpOworCisJZG1hYnVmX3N5bmMoZG1h
YnVmX2ZkLCBETUFfQlVGX1NZTkNfU1RBUlQpOworCW1lbXNldChwLCAweGZmLCBPTkVfTUVHKTsK
KwlkbWFidWZfc3luYyhkbWFidWZfZmQsIERNQV9CVUZfU1lOQ19FTkQpOworCXByaW50Zigic3lu
Y3MgcGFzc2VkXG4iKTsKKworCWNsb3NlX2hhbmRsZShpbXBvcnRlcl9mZCwgaGFuZGxlKTsKKwly
ZXQgPSAwOworCitvdXQ6CisJaWYgKHApCisJCW11bm1hcChwLCBPTkVfTUVHKTsKKwlpZiAoaW1w
b3J0ZXJfZmQgPj0gMCkKKwkJY2xvc2UoaW1wb3J0ZXJfZmQpOworCWlmIChkbWFidWZfZmQgPj0g
MCkKKwkJY2xvc2UoZG1hYnVmX2ZkKTsKKwlpZiAoaGVhcF9mZCA+PSAwKQorCQljbG9zZShoZWFw
X2ZkKTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBtYWluKHZvaWQpCit7CisJRElSICpkOwor
CXN0cnVjdCBkaXJlbnQgKmRpcjsKKwlpbnQgcmV0ID0gLTE7CisKKwlkID0gb3BlbmRpcihERVZQ
QVRIKTsKKwlpZiAoIWQpIHsKKwkJcHJpbnRmKCJObyAlcyBkaXJlY3Rvcnk/XG4iLCBERVZQQVRI
KTsKKwkJcmV0dXJuIC0xOworCX0KKworCXdoaWxlICgoZGlyID0gcmVhZGRpcihkKSkgIT0gTlVM
TCkgeworCQlpZiAoIXN0cm5jbXAoZGlyLT5kX25hbWUsICIuIiwgMikpCisJCQljb250aW51ZTsK
KwkJaWYgKCFzdHJuY21wKGRpci0+ZF9uYW1lLCAiLi4iLCAzKSkKKwkJCWNvbnRpbnVlOworCisJ
CXJldCA9IGRvX3Rlc3QoZGlyLT5kX25hbWUpOworCQlpZiAocmV0KQorCQkJYnJlYWs7CisJfQor
CWNsb3NlZGlyKGQpOworCisJcmV0dXJuIHJldDsKK30KLS0gCjIuMTcuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
