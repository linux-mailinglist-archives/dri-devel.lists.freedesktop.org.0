Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BB00127D275
	for <lists+dri-devel@lfdr.de>; Tue, 29 Sep 2020 17:15:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2689E6E3DA;
	Tue, 29 Sep 2020 15:14:55 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4348F6E202;
 Tue, 29 Sep 2020 15:14:46 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 73CB9B11A;
 Tue, 29 Sep 2020 15:14:44 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: maarten.lankhorst@linux.intel.com, mripard@kernel.org, airlied@linux.ie,
 daniel@ffwll.ch, sam@ravnborg.org, alexander.deucher@amd.com,
 christian.koenig@amd.com, kraxel@redhat.com, l.stach@pengutronix.de,
 linux+etnaviv@armlinux.org.uk, christian.gmeiner@gmail.com,
 inki.dae@samsung.com, jy0922.shim@samsung.com, sw0312.kim@samsung.com,
 kyungmin.park@samsung.com, kgene@kernel.org, krzk@kernel.org,
 yuq825@gmail.com, bskeggs@redhat.com, robh@kernel.org,
 tomeu.vizoso@collabora.com, steven.price@arm.com,
 alyssa.rosenzweig@collabora.com, hjc@rock-chips.com, heiko@sntech.de,
 hdegoede@redhat.com, sean@poorly.run, eric@anholt.net,
 oleksandr_andrushchenko@epam.com, ray.huang@amd.com,
 sumit.semwal@linaro.org, emil.velikov@collabora.com, luben.tuikov@amd.com,
 apaneers@amd.com, linus.walleij@linaro.org, melissa.srw@gmail.com,
 chris@chris-wilson.co.uk, miaoqinglang@huawei.com
Subject: [PATCH v3 4/7] drm/gem: Update internal GEM vmap/vunmap interfaces to
 use struct dma_buf_map
Date: Tue, 29 Sep 2020 17:14:34 +0200
Message-Id: <20200929151437.19717-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20200929151437.19717-1-tzimmermann@suse.de>
References: <20200929151437.19717-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-samsung-soc@vger.kernel.org, lima@lists.freedesktop.org,
 nouveau@lists.freedesktop.org, etnaviv@lists.freedesktop.org,
 amd-gfx@lists.freedesktop.org, virtualization@lists.linux-foundation.org,
 linaro-mm-sig@lists.linaro.org, linux-rockchip@lists.infradead.org,
 dri-devel@lists.freedesktop.org, Thomas Zimmermann <tzimmermann@suse.de>,
 xen-devel@lists.xenproject.org, spice-devel@lists.freedesktop.org,
 linux-arm-kernel@lists.infradead.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

R0VNJ3Mgdm1hcCBhbmQgdnVubWFwIGludGVyZmFjZXMgbm93IHdyYXAgbWVtb3J5IHBvaW50ZXJz
IGluIHN0cnVjdApkbWFfYnVmX21hcC4KClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5u
IDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50LmMg
ICB8IDE4ICsrKysrKysrKysrLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW0uYyAgICAg
IHwgMjggKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9p
bnRlcm5hbC5oIHwgIDUgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fcHJpbWUuYyAgICB8IDE0
ICsrKystLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDMyIGluc2VydGlvbnMoKyksIDMzIGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50LmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jCmluZGV4IDQ5NWY0N2QyM2Q4Ny4uYWMwMDgyYmVk
OTY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9kcm1fY2xpZW50LmMKQEAgLTMsNiArMyw3IEBACiAgKiBDb3B5cmlnaHQgMjAx
OCBOb3JhbGYgVHLDuG5uZXMKICAqLwogCisjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi1tYXAuaD4K
ICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5j
bHVkZSA8bGludXgvbXV0ZXguaD4KQEAgLTMwNCw3ICszMDUsOCBAQCBkcm1fY2xpZW50X2J1ZmZl
cl9jcmVhdGUoc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQsIHUzMiB3aWR0aCwgdTMyIGhl
aWdodCwgdQogICovCiB2b2lkICpkcm1fY2xpZW50X2J1ZmZlcl92bWFwKHN0cnVjdCBkcm1fY2xp
ZW50X2J1ZmZlciAqYnVmZmVyKQogewotCXZvaWQgKnZhZGRyOworCXN0cnVjdCBkbWFfYnVmX21h
cCBtYXA7CisJaW50IHJldDsKIAogCWlmIChidWZmZXItPnZhZGRyKQogCQlyZXR1cm4gYnVmZmVy
LT52YWRkcjsKQEAgLTMxNywxMyArMzE5LDEzIEBAIHZvaWQgKmRybV9jbGllbnRfYnVmZmVyX3Zt
YXAoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIpCiAJICogZmRfaW5zdGFsbCBzdGVw
IG91dCBvZiB0aGUgZHJpdmVyIGJhY2tlbmQgaG9va3MsIHRvIG1ha2UgdGhhdAogCSAqIGZpbmFs
IHN0ZXAgb3B0aW9uYWwgZm9yIGludGVybmFsIHVzZXJzLgogCSAqLwotCXZhZGRyID0gZHJtX2dl
bV92bWFwKGJ1ZmZlci0+Z2VtKTsKLQlpZiAoSVNfRVJSKHZhZGRyKSkKLQkJcmV0dXJuIHZhZGRy
OworCXJldCA9IGRybV9nZW1fdm1hcChidWZmZXItPmdlbSwgJm1hcCk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIEVSUl9QVFIocmV0KTsKIAotCWJ1ZmZlci0+dmFkZHIgPSB2YWRkcjsKKwlidWZmZXIt
PnZhZGRyID0gbWFwLnZhZGRyOwogCi0JcmV0dXJuIHZhZGRyOworCXJldHVybiBtYXAudmFkZHI7
CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9jbGllbnRfYnVmZmVyX3ZtYXApOwogCkBAIC0zMzcsNyAr
MzM5LDkgQEAgRVhQT1JUX1NZTUJPTChkcm1fY2xpZW50X2J1ZmZlcl92bWFwKTsKICAqLwogdm9p
ZCBkcm1fY2xpZW50X2J1ZmZlcl92dW5tYXAoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZm
ZXIpCiB7Ci0JZHJtX2dlbV92dW5tYXAoYnVmZmVyLT5nZW0sIGJ1ZmZlci0+dmFkZHIpOworCXN0
cnVjdCBkbWFfYnVmX21hcCBtYXAgPSBETUFfQlVGX01BUF9JTklUX1ZBRERSKGJ1ZmZlci0+dmFk
ZHIpOworCisJZHJtX2dlbV92dW5tYXAoYnVmZmVyLT5nZW0sICZtYXApOwogCWJ1ZmZlci0+dmFk
ZHIgPSBOVUxMOwogfQogRVhQT1JUX1NZTUJPTChkcm1fY2xpZW50X2J1ZmZlcl92dW5tYXApOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fZ2VtLmMKaW5kZXggMGM0YTY2ZGVhNWMyLi5mMmIyZjM3ZDQxYzQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9nZW0uYwpA
QCAtMTIwNSwzMiArMTIwNSwzMiBAQCB2b2lkIGRybV9nZW1fdW5waW4oc3RydWN0IGRybV9nZW1f
b2JqZWN0ICpvYmopCiAJCW9iai0+ZnVuY3MtPnVucGluKG9iaik7CiB9CiAKLXZvaWQgKmRybV9n
ZW1fdm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKK2ludCBkcm1fZ2VtX3ZtYXAoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQogewotCXN0
cnVjdCBkbWFfYnVmX21hcCBtYXA7CiAJaW50IHJldDsKIAotCWlmICghb2JqLT5mdW5jcy0+dm1h
cCkgewotCQlyZXR1cm4gRVJSX1BUUigtRU9QTk9UU1VQUCk7CisJaWYgKCFvYmotPmZ1bmNzLT52
bWFwKQorCQlyZXR1cm4gLUVPUE5PVFNVUFA7CiAKLQlyZXQgPSBvYmotPmZ1bmNzLT52bWFwKG9i
aiwgJm1hcCk7CisJcmV0ID0gb2JqLT5mdW5jcy0+dm1hcChvYmosIG1hcCk7CiAJaWYgKHJldCkK
LQkJcmV0dXJuIEVSUl9QVFIocmV0KTsKLQllbHNlIGlmIChkbWFfYnVmX21hcF9pc19udWxsKCZt
YXApKQotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwkJcmV0dXJuIHJldDsKKwllbHNlIGlm
IChkbWFfYnVmX21hcF9pc19udWxsKG1hcCkpCisJCXJldHVybiAtRU5PTUVNOwogCi0JcmV0dXJu
IG1hcC52YWRkcjsKKwlyZXR1cm4gMDsKIH0KIAotdm9pZCBkcm1fZ2VtX3Z1bm1hcChzdHJ1Y3Qg
ZHJtX2dlbV9vYmplY3QgKm9iaiwgdm9pZCAqdmFkZHIpCit2b2lkIGRybV9nZW1fdnVubWFwKHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgZG1hX2J1Zl9tYXAgKm1hcCkKIHsKLQlz
dHJ1Y3QgZG1hX2J1Zl9tYXAgbWFwID0gRE1BX0JVRl9NQVBfSU5JVF9WQUREUih2YWRkcik7Ci0K
LQlpZiAoIXZhZGRyKQorCWlmIChkbWFfYnVmX21hcF9pc19udWxsKG1hcCkpCiAJCXJldHVybjsK
IAogCWlmIChvYmotPmZ1bmNzLT52dW5tYXApCi0JCW9iai0+ZnVuY3MtPnZ1bm1hcChvYmosICZt
YXApOworCQlvYmotPmZ1bmNzLT52dW5tYXAob2JqLCBtYXApOworCisJLyogQWx3YXlzIHNldCB0
aGUgbWFwcGluZyB0byBOVUxMLiBDYWxsZXJzIG1heSByZWx5IG9uIHRoaXMuICovCisJZG1hX2J1
Zl9tYXBfY2xlYXIobWFwKTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2ludGVybmFsLmggYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFsLmgKaW5kZXggYjY1
ODY1YzYzMGIwLi41ODgzMmQ3NWE5YmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
aW50ZXJuYWwuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFsLmgKQEAgLTMzLDYg
KzMzLDcgQEAKIAogc3RydWN0IGRlbnRyeTsKIHN0cnVjdCBkbWFfYnVmOworc3RydWN0IGRtYV9i
dWZfbWFwOwogc3RydWN0IGRybV9jb25uZWN0b3I7CiBzdHJ1Y3QgZHJtX2NydGM7CiBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyOwpAQCAtMTg3LDggKzE4OCw4IEBAIHZvaWQgZHJtX2dlbV9wcmludF9p
bmZvKHN0cnVjdCBkcm1fcHJpbnRlciAqcCwgdW5zaWduZWQgaW50IGluZGVudCwKIAogaW50IGRy
bV9nZW1fcGluKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKIHZvaWQgZHJtX2dlbV91bnBp
bihzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7Ci12b2lkICpkcm1fZ2VtX3ZtYXAoc3RydWN0
IGRybV9nZW1fb2JqZWN0ICpvYmopOwotdm9pZCBkcm1fZ2VtX3Z1bm1hcChzdHJ1Y3QgZHJtX2dl
bV9vYmplY3QgKm9iaiwgdm9pZCAqdmFkZHIpOworaW50IGRybV9nZW1fdm1hcChzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IGRtYV9idWZfbWFwICptYXApOwordm9pZCBkcm1fZ2Vt
X3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IGRtYV9idWZfbWFwICpt
YXApOwogCiAvKiBkcm1fZGVidWdmcy5jIGRybV9kZWJ1Z2ZzX2NyYy5jICovCiAjaWYgZGVmaW5l
ZChDT05GSUdfREVCVUdfRlMpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3ByaW1l
LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3ByaW1lLmMKaW5kZXggODllMmEyNDk2NzM0Li5jYjhm
YmVlYjczMWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJpbWUuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX3ByaW1lLmMKQEAgLTY2NywyMSArNjY3LDE1IEBAIEVYUE9SVF9T
WU1CT0woZHJtX2dlbV91bm1hcF9kbWFfYnVmKTsKICAqCiAgKiBTZXRzIHVwIGEga2VybmVsIHZp
cnR1YWwgbWFwcGluZy4gVGhpcyBjYW4gYmUgdXNlZCBhcyB0aGUgJmRtYV9idWZfb3BzLnZtYXAK
ICAqIGNhbGxiYWNrLiBDYWxscyBpbnRvICZkcm1fZ2VtX29iamVjdF9mdW5jcy52bWFwIGZvciBk
ZXZpY2Ugc3BlY2lmaWMgaGFuZGxpbmcuCisgKiBUaGUga2VybmVsIHZpcnR1YWwgYWRkcmVzcyBp
cyByZXR1cm5lZCBpbiBtYXAuCiAgKgotICogUmV0dXJucyB0aGUga2VybmVsIHZpcnR1YWwgYWRk
cmVzcyBvciBOVUxMIG9uIGZhaWx1cmUuCisgKiBSZXR1cm5zIDAgb24gc3VjY2VzcyBvciBhIG5l
Z2F0aXZlIGVycm5vIGNvZGUgb3RoZXJ3aXNlLgogICovCiBpbnQgZHJtX2dlbV9kbWFidWZfdm1h
cChzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1Ziwgc3RydWN0IGRtYV9idWZfbWFwICptYXApCiB7CiAJ
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBkbWFfYnVmLT5wcml2OwotCXZvaWQgKnZhZGRy
OwogCi0JdmFkZHIgPSBkcm1fZ2VtX3ZtYXAob2JqKTsKLQlpZiAoSVNfRVJSKHZhZGRyKSkKLQkJ
cmV0dXJuIFBUUl9FUlIodmFkZHIpOwotCi0JZG1hX2J1Zl9tYXBfc2V0X3ZhZGRyKG1hcCwgdmFk
ZHIpOwotCi0JcmV0dXJuIDA7CisJcmV0dXJuIGRybV9nZW1fdm1hcChvYmosIG1hcCk7CiB9CiBF
WFBPUlRfU1lNQk9MKGRybV9nZW1fZG1hYnVmX3ZtYXApOwogCkBAIC02OTcsNyArNjkxLDcgQEAg
dm9pZCBkcm1fZ2VtX2RtYWJ1Zl92dW5tYXAoc3RydWN0IGRtYV9idWYgKmRtYV9idWYsIHN0cnVj
dCBkbWFfYnVmX21hcCAqbWFwKQogewogCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqID0gZG1h
X2J1Zi0+cHJpdjsKIAotCWRybV9nZW1fdnVubWFwKG9iaiwgbWFwLT52YWRkcik7CisJZHJtX2dl
bV92dW5tYXAob2JqLCBtYXApOwogfQogRVhQT1JUX1NZTUJPTChkcm1fZ2VtX2RtYWJ1Zl92dW5t
YXApOwogCi0tIAoyLjI4LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbAo=
