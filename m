Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EE35CA64E0
	for <lists+dri-devel@lfdr.de>; Tue,  3 Sep 2019 11:15:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 99596896F7;
	Tue,  3 Sep 2019 09:15:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lf1-x144.google.com (mail-lf1-x144.google.com
 [IPv6:2a00:1450:4864:20::144])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 62A31896F7
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Sep 2019 09:15:21 +0000 (UTC)
Received: by mail-lf1-x144.google.com with SMTP id l11so12286877lfk.6
 for <dri-devel@lists.freedesktop.org>; Tue, 03 Sep 2019 02:15:21 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=7tH0D9nnd+Hl0Tr4TMT+Gha56g1J28sGI/YzziuksxQ=;
 b=MH4V1Awo3S2zJJGoHS1kOTcV8TxkKZDl1VET8zOHODjokCm/mz3Ny+sh+ESHuCJ2eG
 Ce8V09FmEA576Ftyky24FMXFxBBTsvSdp+SVTDHHwzSHG0WyWgVs5vFL8TJUKZKcKOYV
 UgNht90KGD4x+GAxPGp2y7SbTx7vNS6y1b5k3/jD+H+G1LANRf7bPvUsqGpc9ieXyYRh
 Yj2ymd7Euem5tJ0RTwIjlTxoLjBcYUtfEeZbUySnxvS8DNoNDv5bCcbnyqTqczwqMzg5
 jE+Drn11SOEByUUl/oCM9iBvvaKF4hdpaxLeiqoULT/2LI3ZVdNSVAn78mftcqIWHMwM
 I6cQ==
X-Gm-Message-State: APjAAAW5zyh/5pU9QkQ4KlAnH5iLfS1q/Nmtxf4LJm3EuI8fItd4NLCP
 oA9CvCSIRsOzZY099drMmUNsMID3O80=
X-Google-Smtp-Source: APXvYqxf09Q2wwIgk+5B1xl1CYuJg9QDoHaKfTSPgiLreNxsXuM0fe1w6bE4DNrEeKsw08tHAVVBwQ==
X-Received: by 2002:a19:644c:: with SMTP id b12mr2813213lfj.104.1567502119106; 
 Tue, 03 Sep 2019 02:15:19 -0700 (PDT)
Received: from genomnajs.ideon.se ([85.235.10.227])
 by smtp.gmail.com with ESMTPSA id b7sm2783387ljk.80.2019.09.03.02.15.17
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 03 Sep 2019 02:15:18 -0700 (PDT)
From: Linus Walleij <linus.walleij@linaro.org>
To: dri-devel@lists.freedesktop.org,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>
Subject: [PATCH v2] drm/mcde: Some fixes to handling video mode
Date: Tue,  3 Sep 2019 11:15:12 +0200
Message-Id: <20190903091512.15780-1-linus.walleij@linaro.org>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=7tH0D9nnd+Hl0Tr4TMT+Gha56g1J28sGI/YzziuksxQ=;
 b=l7JkE62qR1PPR9V2AgJprFiXike3IM8gqJIfX+p6FrZcmCl2ln3+dCpusghe9gx4xI
 aQmLNRCoJHP6foPcXe7vKRa+UPfHdvKlfB8T79Nioxpesx24+MLTUL8N2Hd5mFaPTPAj
 XdjdAbyYPKeP/9x9U0B8RE1uzwd3KD1muhr8va6t3PNmD/ygvPcM7dNJUdVsK7fvt5H1
 Q1oz0ExGJfQT7mVup8O4totHX2++EYdcfReXZFAWR540NFiNa4s0uq6a+1mcw5kXyJDx
 sAvrzLqNq1kDZx4Y09zjM8aZAfQMqm20+uQUBUr+Cz/63Y5sAkT/jKGJ+2nR1Up/SAwL
 iamA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Stephan Gerhold <stephan@gerhold.net>, linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHZpZGVvIERTSSBtb2RlIGhhZCBub3QgcmVhbGx5IGJlZW4gdGVzdGVkLiBUaGVzZSBmaXhl
cyBtYWtlcwppdCBtb3JlIGxpa2VseSB0byB3b3JrIG9uIHJlYWwgaGFyZHdhcmU6Ci0gU2V0IHRo
ZSBIUyBjbG9jayB0byBzb21ldGhpbmcgdGhlIHZpZGVvIG1vZGUgcmVwb3J0ZWQgYnkgdGhlCiAg
cGFuZWwgY2FuIGhhbmRsZSByYXRoZXIgdGhhbiB0aGUgbWF4IEhTIHJhdGUuCi0gUHV0IHRoZSBh
Y3RpdmUgd2lkdGggKHggd2lkdGgpIGluIHRoZSByaWdodCBiaXRzIGFuZCB0aGUgVlNBCiAgKHZl
cnRpY2FsIHN5bmMgYWN0aXZlKSBpbiB0aGUgcmlnaHQgYml0cyAodGhvc2Ugd2VyZSBzd2FwcGVk
KS4KLSBDYWxjdWxhdGUgdGhlIHBhY2tldCBzaXplcyBpbiBieXRlcyBhcyBpbiB0aGUgdmVuZG9y
IGRyaXZlciwKICByYXRoZXIgdGhhbiBpbiBiaXRzLgotIEhhbmRsZSBuZWdhdGl2ZSByZXN1bHQg
aW4gZnJvbnQvYmFjay9zeW5jIHBhY2thZ2VzIGFuZCBmYWxsCiAgYmFjayB0byB6ZXJvIGxpa2Ug
aW4gdGhlIHZlbmRvciBkcml2ZXIuCgpDYzogU3RlcGhhbiBHZXJob2xkIDxzdGVwaGFuQGdlcmhv
bGQubmV0PgpGaXhlczogNWZjNTM3YmZkMDAwICgiZHJtL21jZGU6IEFkZCBuZXcgZHJpdmVyIGZv
ciBTVC1Fcmljc3NvbiBNQ0RFIikKU2lnbmVkLW9mZi1ieTogTGludXMgV2FsbGVpaiA8bGludXMu
d2FsbGVpakBsaW5hcm8ub3JnPgotLS0KQ2hhbmdlTG9nIHYxLT52MjoKLSBGaXggc29tZSBtb3Jl
IGNvbW1lbnRzIHNvIHdlIHVuZGVyc3RhbmQgd2hhdCBpcyBnb2luZyBvbi4KLSBTZXQgdXAgdGhl
IG1heGltdW0gbGluZSBsaW1pdCBzaXplIGluIHRoZSByaWdodCByZWdpc3RlcgogIGluc3RlYWQg
b2Ygc2V0dGluZyBpdCBpbiB0aGUgYnVyc3Qgc2l6ZSByZWdpc3RlciBwb3J0aW9uLgotIFNldCBz
b21lIGRlZmF1bHQgd2FrZXVwIHRpbWUgb3RoZXIgdGhhbiB6ZXJvIChzdGlsbCBuZWVkCiAgZml4
aW5nIG1vcmUpLgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZHNpLmMgfCA3NSArKysr
KysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA1MCBpbnNlcnRp
b25zKCspLCAyNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWNk
ZS9tY2RlX2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL21jZGUvbWNkZV9kc2kuYwppbmRleCBjZDI2
MWMyNjZmMzUuLjVjNjVjZDcwZmNkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21jZGUv
bWNkZV9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWNkZS9tY2RlX2RzaS5jCkBAIC0zNjUs
MTEgKzM2NSwxMiBAQCB2b2lkIG1jZGVfZHNpX3RlX3JlcXVlc3Qoc3RydWN0IG1pcGlfZHNpX2Rl
dmljZSAqbWRzaSkKIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVwX3ZpZGVvX21vZGUoc3RydWN0
IG1jZGVfZHNpICpkLAogCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpt
b2RlKQogewotCXU4IGJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zvcm1hdF90b19icHAoZC0+bWRzaS0+
Zm9ybWF0KTsKKwkvKiBjcHAsIGNoYXJhY3RlcnMgcGVyIHBpeGVsLCBudW1iZXIgb2YgYnl0ZXMg
cGVyIHBpeGVsICovCisJdTggY3BwID0gbWlwaV9kc2lfcGl4ZWxfZm9ybWF0X3RvX2JwcChkLT5t
ZHNpLT5mb3JtYXQpIC8gODsKIAl1NjQgYnBsOwotCXUzMiBoZnA7Ci0JdTMyIGhicDsKLQl1MzIg
aHNhOworCWludCBoZnA7CisJaW50IGhicDsKKwlpbnQgaHNhOwogCXUzMiBibGtsaW5lX3Bjaywg
bGluZV9kdXJhdGlvbjsKIAl1MzIgYmxrZW9sX3BjaywgYmxrZW9sX2R1cmF0aW9uOwogCXUzMiB2
YWw7CkBAIC00MDgsMTEgKzQwOSwxMSBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9zZXR1cF92aWRl
b19tb2RlKHN0cnVjdCBtY2RlX2RzaSAqZCwKIAkJcmV0dXJuOwogCX0KIAotCS8qIFRPRE86IFRW
RyBjb3VsZCBiZSBlbmFibGVkIGhlcmUgKi8KKwkvKiBUT0RPOiBUVkcgKHRlc3QgdmlkZW8gZ2Vu
ZXJhdG9yKSBjb3VsZCBiZSBlbmFibGVkIGhlcmUgKi8KIAotCS8qIFNlbmQgYmxhbmtpbmcgcGFj
a2V0ICovCisJLyogRHVyaW5nIGJsYW5raW5nOiBnbyB0byBMUCBtb2RlICovCiAJdmFsIHw9IERT
SV9WSURfTUFJTl9DVExfUkVHX0JMS0xJTkVfTU9ERV9MUF8wOwotCS8qIFNlbmQgRU9MIHBhY2tl
dCAqLworCS8qIER1cmluZyBFT0w6IGdvIHRvIExQIG1vZGUgKi8KIAl2YWwgfD0gRFNJX1ZJRF9N
QUlOX0NUTF9SRUdfQkxLRU9MX01PREVfTFBfMDsKIAkvKiBSZWNvdmVyeSBtb2RlIDEgKi8KIAl2
YWwgfD0gMSA8PCBEU0lfVklEX01BSU5fQ1RMX1JFQ09WRVJZX01PREVfU0hJRlQ7CkBAIC00MjAs
MTMgKzQyMSwxMyBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9zZXR1cF92aWRlb19tb2RlKHN0cnVj
dCBtY2RlX2RzaSAqZCwKIAl3cml0ZWwodmFsLCBkLT5yZWdzICsgRFNJX1ZJRF9NQUlOX0NUTCk7
CiAKIAkvKiBWZXJ0aWNhbCBmcmFtZSBwYXJhbWV0ZXJzIGFyZSBwcmV0dHkgc3RyYWlnaHQtZm9y
d2FyZCAqLwotCXZhbCA9IG1vZGUtPnZkaXNwbGF5IDw8IERTSV9WSURfVlNJWkVfVlNBX0xFTkdU
SF9TSElGVDsKKwl2YWwgPSBtb2RlLT52ZGlzcGxheSA8PCBEU0lfVklEX1ZTSVpFX1ZBQ1RfTEVO
R1RIX1NISUZUOwogCS8qIHZlcnRpY2FsIGZyb250IHBvcmNoICovCiAJdmFsIHw9IChtb2RlLT52
c3luY19zdGFydCAtIG1vZGUtPnZkaXNwbGF5KQogCQk8PCBEU0lfVklEX1ZTSVpFX1ZGUF9MRU5H
VEhfU0hJRlQ7CiAJLyogdmVydGljYWwgc3luYyBhY3RpdmUgKi8KIAl2YWwgfD0gKG1vZGUtPnZz
eW5jX2VuZCAtIG1vZGUtPnZzeW5jX3N0YXJ0KQotCQk8PCBEU0lfVklEX1ZTSVpFX1ZBQ1RfTEVO
R1RIX1NISUZUOworCQk8PCBEU0lfVklEX1ZTSVpFX1ZTQV9MRU5HVEhfU0hJRlQ7CiAJLyogdmVy
dGljYWwgYmFjayBwb3JjaCAqLwogCXZhbCB8PSAobW9kZS0+dnRvdGFsIC0gbW9kZS0+dnN5bmNf
ZW5kKQogCQk8PCBEU0lfVklEX1ZTSVpFX1ZCUF9MRU5HVEhfU0hJRlQ7CkBAIC00MzcsMjEgKzQz
OCwyNSBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9zZXR1cF92aWRlb19tb2RlKHN0cnVjdCBtY2Rl
X2RzaSAqZCwKIAkgKiBob3Jpem9udGFsIHJlc29sdXRpb24gaXMgZ2l2ZW4gaW4gcGl4ZWxzIGFu
ZCBtdXN0IGJlIHJlLWNhbGN1bGF0ZWQKIAkgKiBpbnRvIGJ5dGVzIHNpbmNlIHRoaXMgaXMgd2hh
dCB0aGUgaGFyZHdhcmUgZXhwZWN0cy4KIAkgKgorCSAqIGhmcCA9IGhvcml6b250YWwgZnJvbnQg
cG9yY2ggaW4gYnl0ZXMKKwkgKiBoYnAgPSBob3Jpem9udGFsIGJhY2sgcG9yY2ggaW4gYnl0ZXMK
KwkgKiBoc2EgPSBob3Jpem9udGFsIHN5bmMgYWN0aXZlIGluIGJ5dGVzCisJICoKIAkgKiA2ICsg
MiBpcyBIRlAgaGVhZGVyICsgY2hlY2tzdW0KIAkgKi8KLQloZnAgPSAobW9kZS0+aHN5bmNfc3Rh
cnQgLSBtb2RlLT5oZGlzcGxheSkgKiBicHAgLSA2IC0gMjsKKwloZnAgPSAobW9kZS0+aHN5bmNf
c3RhcnQgLSBtb2RlLT5oZGlzcGxheSkgKiBjcHAgLSA2IC0gMjsKIAlpZiAoZC0+bWRzaS0+bW9k
ZV9mbGFncyAmIE1JUElfRFNJX01PREVfVklERU9fU1lOQ19QVUxTRSkgewogCQkvKgogCQkgKiA2
IGlzIEhCUCBoZWFkZXIgKyBjaGVja3N1bQogCQkgKiA0IGlzIFJHQiBoZWFkZXIgKyBjaGVja3N1
bQogCQkgKi8KLQkJaGJwID0gKG1vZGUtPmh0b3RhbCAtIG1vZGUtPmhzeW5jX2VuZCkgKiBicHAg
LSA0IC0gNjsKKwkJaGJwID0gKG1vZGUtPmh0b3RhbCAtIG1vZGUtPmhzeW5jX2VuZCkgKiBjcHAg
LSA0IC0gNjsKIAkJLyoKIAkJICogNiBpcyBIQlAgaGVhZGVyICsgY2hlY2tzdW0KIAkJICogNCBp
cyBIU1cgcGFja2V0IGJ5dGVzCiAJCSAqIDQgaXMgUkdCIGhlYWRlciArIGNoZWNrc3VtCiAJCSAq
LwotCQloc2EgPSAobW9kZS0+aHN5bmNfZW5kIC0gbW9kZS0+aHN5bmNfc3RhcnQpICogYnBwIC0g
NCAtIDQgLSA2OworCQloc2EgPSAobW9kZS0+aHN5bmNfZW5kIC0gbW9kZS0+aHN5bmNfc3RhcnQp
ICogY3BwIC0gNCAtIDQgLSA2OwogCX0gZWxzZSB7CiAJCS8qCiAJCSAqIEhCUCBpbmNsdWRlcyBi
b3RoIGJhY2sgcG9yY2ggYW5kIHN5bmMKQEAgLTQ1OSwxMSArNDY0LDIzIEBAIHN0YXRpYyB2b2lk
IG1jZGVfZHNpX3NldHVwX3ZpZGVvX21vZGUoc3RydWN0IG1jZGVfZHNpICpkLAogCQkgKiA0IGlz
IEhTVyBwYWNrZXQgYnl0ZXMKIAkJICogNCBpcyBSR0IgaGVhZGVyICsgY2hlY2tzdW0KIAkJICov
Ci0JCWhicCA9IChtb2RlLT5odG90YWwgLSBtb2RlLT5oc3luY19zdGFydCkgKiBicHAgLSA0IC0g
NCAtIDY7Ci0JCS8qIEhTQSBpcyBub3QgY29uc2lkZXJlZCBpbiB0aGlzIG1vZGUgYW5kIHNldCB0
byAwICovCisJCWhicCA9IChtb2RlLT5odG90YWwgLSBtb2RlLT5oc3luY19zdGFydCkgKiBjcHAg
LSA0IC0gNCAtIDY7CisJCS8qIEhTQSBpcyBub3QgcHJlc2VudCBpbiB0aGlzIG1vZGUgYW5kIHNl
dCB0byAwICovCisJCWhzYSA9IDA7CisJfQorCWlmIChoZnAgPCAwKSB7CisJCWRldl9pbmZvKGQt
PmRldiwgImhmcCBuZWdhdGl2ZSwgc2V0IHRvIDBcbiIpOworCQloZnAgPSAwOworCX0KKwlpZiAo
aGJwIDwgMCkgeworCQlkZXZfaW5mbyhkLT5kZXYsICJoYnAgbmVnYXRpdmUsIHNldCB0byAwXG4i
KTsKKwkJaGJwID0gMDsKKwl9CisJaWYgKGhzYSA8IDApIHsKKwkJZGV2X2luZm8oZC0+ZGV2LCAi
aHNhIG5lZ2F0aXZlLCBzZXQgdG8gMFxuIik7CiAJCWhzYSA9IDA7CiAJfQotCWRldl9kYmcoZC0+
ZGV2LCAiaGZwOiAldSwgaGJwOiAldSwgaHNhOiAldVxuIiwKKwlkZXZfZGJnKGQtPmRldiwgImhm
cDogJXUsIGhicDogJXUsIGhzYTogJXUgYnl0ZXNcbiIsCiAJCWhmcCwgaGJwLCBoc2EpOwogCiAJ
LyogRnJhbWUgcGFyYW1ldGVyczogaG9yaXpvbnRhbCBzeW5jIGFjdGl2ZSAqLwpAQCAtNDc0LDgg
KzQ5MSw4IEBAIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVwX3ZpZGVvX21vZGUoc3RydWN0IG1j
ZGVfZHNpICpkLAogCXZhbCB8PSBoZnAgPDwgRFNJX1ZJRF9IU0laRTFfSEZQX0xFTkdUSF9TSElG
VDsKIAl3cml0ZWwodmFsLCBkLT5yZWdzICsgRFNJX1ZJRF9IU0laRTEpOwogCi0JLyogUkdCIGRh
dGEgbGVuZ3RoIChieXRlcyBvbiBvbmUgc2NhbmxpbmUpICovCi0JdmFsID0gbW9kZS0+aGRpc3Bs
YXkgKiAoYnBwIC8gOCk7CisJLyogUkdCIGRhdGEgbGVuZ3RoICh2aXNpYmxlIGJ5dGVzIG9uIG9u
ZSBzY2FubGluZSkgKi8KKwl2YWwgPSBtb2RlLT5oZGlzcGxheSAqIGNwcDsKIAl3cml0ZWwodmFs
LCBkLT5yZWdzICsgRFNJX1ZJRF9IU0laRTIpOwogCiAJLyogVE9ETzogZnVydGhlciBhZGp1c3Rt
ZW50cyBmb3IgVFZHIG1vZGUgaGVyZSAqLwpAQCAtNTA3LDM3ICs1MjQsNDMgQEAgc3RhdGljIHZv
aWQgbWNkZV9kc2lfc2V0dXBfdmlkZW9fbW9kZShzdHJ1Y3QgbWNkZV9kc2kgKmQsCiAJfQogCiAJ
bGluZV9kdXJhdGlvbiA9IChibGtsaW5lX3BjayArIDYpIC8gZC0+bWRzaS0+bGFuZXM7Ci0JZGV2
X2RiZyhkLT5kZXYsICJsaW5lIGR1cmF0aW9uICV1XG4iLCBsaW5lX2R1cmF0aW9uKTsKKwlkZXZf
ZGJnKGQtPmRldiwgImxpbmUgZHVyYXRpb24gJXUgYnl0ZXNcbiIsIGxpbmVfZHVyYXRpb24pOwog
CXZhbCA9IGxpbmVfZHVyYXRpb24gPDwgRFNJX1ZJRF9EUEhZX1RJTUVfUkVHX0xJTkVfRFVSQVRJ
T05fU0hJRlQ7CiAJLyoKIAkgKiBUaGlzIGlzIHRoZSB0aW1lIHRvIHBlcmZvcm0gTFAtPkhTIG9u
IEQtUEhZCiAJICogRklYTUU6IG5vd2hlcmUgdG8gZ2V0IHRoaXMgZnJvbTogRFQgcHJvcGVydHkg
b24gdGhlIERTST8KKwkgKiB2YWx1ZXMgbGlrZSA0OCBhbmQgNzIgc2VlbiBpbiB0aGUgdmVuZG9y
IGNvZGUuCiAJICovCi0JdmFsIHw9IDAgPDwgRFNJX1ZJRF9EUEhZX1RJTUVfUkVHX1dBS0VVUF9U
SU1FX1NISUZUOworCXZhbCB8PSA0OCA8PCBEU0lfVklEX0RQSFlfVElNRV9SRUdfV0FLRVVQX1RJ
TUVfU0hJRlQ7CiAJd3JpdGVsKHZhbCwgZC0+cmVncyArIERTSV9WSURfRFBIWV9USU1FKTsKIAog
CS8qIENhbGN1bGF0ZSBibG9jayBlbmQgb2YgbGluZSAqLwotCWJsa2VvbF9wY2sgPSBicGwgLSBt
b2RlLT5oZGlzcGxheSAqIGJwcCAtIDY7CisJYmxrZW9sX3BjayA9IGJwbCAtIG1vZGUtPmhkaXNw
bGF5ICogY3BwIC0gNjsKIAlibGtlb2xfZHVyYXRpb24gPSAoYmxrZW9sX3BjayArIDYpIC8gZC0+
bWRzaS0+bGFuZXM7Ci0JZGV2X2RiZyhkLT5kZXYsICJibGtlb2wgcGNrOiAldSwgZHVyYXRpb246
ICV1XG4iLAotCQkgYmxrZW9sX3BjaywgYmxrZW9sX2R1cmF0aW9uKTsKKwlkZXZfZGJnKGQtPmRl
diwgImJsa2VvbCBwY2s6ICV1IGJ5dGVzLCBkdXJhdGlvbjogJXUgYnl0ZXNcbiIsCisJCWJsa2Vv
bF9wY2ssIGJsa2VvbF9kdXJhdGlvbik7CiAKIAlpZiAoZC0+bWRzaS0+bW9kZV9mbGFncyAmIE1J
UElfRFNJX01PREVfVklERU9fQlVSU1QpIHsKIAkJLyogU2V0IHVwIEVPTCBjbG9jayBmb3IgYnVy
c3QgbW9kZSAqLwogCQl2YWwgPSByZWFkbChkLT5yZWdzICsgRFNJX1ZJRF9CTEtTSVpFMSk7CiAJ
CXZhbCB8PSBibGtlb2xfcGNrIDw8IERTSV9WSURfQkxLU0laRTFfQkxLRU9MX1BDS19TSElGVDsK
IAkJd3JpdGVsKHZhbCwgZC0+cmVncyArIERTSV9WSURfQkxLU0laRTEpOwotCQl3cml0ZWwoYmxr
ZW9sX3BjaywgZC0+cmVncyArIERTSV9WSURfVkNBX1NFVFRJTkcyKTsKKwkJd3JpdGVsKChibGtl
b2xfcGNrICYgRFNJX1ZJRF9WQ0FfU0VUVElORzJfRVhBQ1RfQlVSU1RfTElNSVRfTUFTSykKKwkJ
ICAgICAgIDw8IERTSV9WSURfVkNBX1NFVFRJTkcyX0VYQUNUX0JVUlNUX0xJTUlUX1NISUZULAor
CQkgICAgICAgZC0+cmVncyArIERTSV9WSURfVkNBX1NFVFRJTkcyKTsKIAogCQl3cml0ZWwoYmxr
ZW9sX2R1cmF0aW9uLCBkLT5yZWdzICsgRFNJX1ZJRF9QQ0tfVElNRSk7CisJCS8qIE1heCBidXJz
dCBsaW1pdCAqLwogCQl3cml0ZWwoYmxrZW9sX2R1cmF0aW9uIC0gNiwgZC0+cmVncyArIERTSV9W
SURfVkNBX1NFVFRJTkcxKTsKIAl9CiAKIAkvKiBNYXhpbXVtIGxpbmUgbGltaXQgKi8KIAl2YWwg
PSByZWFkbChkLT5yZWdzICsgRFNJX1ZJRF9WQ0FfU0VUVElORzIpOworCXZhbCAmPSB+RFNJX1ZJ
RF9WQ0FfU0VUVElORzJfTUFYX0xJTkVfTElNSVRfTUFTSzsKIAl2YWwgfD0gYmxrbGluZV9wY2sg
PDwKLQkJRFNJX1ZJRF9WQ0FfU0VUVElORzJfRVhBQ1RfQlVSU1RfTElNSVRfU0hJRlQ7CisJCURT
SV9WSURfVkNBX1NFVFRJTkcyX01BWF9MSU5FX0xJTUlUX1NISUZUOwogCXdyaXRlbCh2YWwsIGQt
PnJlZ3MgKyBEU0lfVklEX1ZDQV9TRVRUSU5HMik7CisJZGV2X2RiZyhkLT5kZXYsICJibGtsaW5l
IHBjazogJXUgYnl0ZXNcbiIsIGJsa2xpbmVfcGNrKTsKIAogCS8qIFB1dCBJRjEgaW50byB2aWRl
byBtb2RlICovCiAJdmFsID0gcmVhZGwoZC0+cmVncyArIERTSV9NQ1RMX01BSU5fREFUQV9DVEwp
OwpAQCAtNjk5LDcgKzcyMiw5IEBAIHN0YXRpYyB2b2lkIG1jZGVfZHNpX2JyaWRnZV9tb2RlX3Nl
dChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogCQlscF9mcmVxID0gZC0+bWRzaS0+bHBfcmF0
ZTsKIAllbHNlCiAJCWxwX2ZyZXEgPSBEU0lfREVGQVVMVF9MUF9GUkVRX0haOwotCWlmIChkLT5t
ZHNpLT5oc19yYXRlKQorCWlmIChwaXhlbF9jbG9ja19oeikKKwkJaHNfZnJlcSA9IHBpeGVsX2Ns
b2NrX2h6OworCWVsc2UgaWYgKGQtPm1kc2ktPmhzX3JhdGUpCiAJCWhzX2ZyZXEgPSBkLT5tZHNp
LT5oc19yYXRlOwogCWVsc2UKIAkJaHNfZnJlcSA9IERTSV9ERUZBVUxUX0hTX0ZSRVFfSFo7Ci0t
IAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
