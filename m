Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E99001C7287
	for <lists+dri-devel@lfdr.de>; Wed,  6 May 2020 16:14:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DD2AF6E2BE;
	Wed,  6 May 2020 14:14:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9BF6D6E2B0;
 Wed,  6 May 2020 14:14:05 +0000 (UTC)
IronPort-SDR: ffrw1c2dPrCm3cnMz6Nw1mGVeOf8wbQXhMrkzBYHAwUeTcY43uBqoSgXlIL24HzZLpmsT550dL
 1XiTe6NqP+7w==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 06 May 2020 07:14:04 -0700
IronPort-SDR: xAdly5dgi0Gfa2+LiPuna2x4xnuKIK/AvZW/18o3hzMFdWb0zRiImalHA9o7m6gxD4klBczaSI
 wJ3se3yPl7Uw==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,359,1583222400"; d="scan'208";a="260117595"
Received: from ramaling-i9x.iind.intel.com (HELO intel.com) ([10.99.66.154])
 by orsmga003.jf.intel.com with ESMTP; 06 May 2020 07:14:00 -0700
Date: Wed, 6 May 2020 19:43:54 +0530
From: Ramalingam C <ramalingam.c@intel.com>
To: Sean Paul <sean@poorly.run>
Subject: Re: [PATCH v6 04/16] drm/i915: Intercept Aksv writes in the aux hooks
Message-ID: <20200506141354.GC30925@intel.com>
References: <20200429195502.39919-1-sean@poorly.run>
 <20200429195502.39919-5-sean@poorly.run>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20200429195502.39919-5-sean@poorly.run>
User-Agent: Mutt/1.10.1 (2018-07-13)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, daniel.vetter@ffwll.ch,
 intel-gfx@lists.freedesktop.org, seanpaul@chromium.org, juston.li@intel.com,
 rodrigo.vivi@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjAyMC0wNC0yOSBhdCAxNTo1NDo1MCAtMDQwMCwgU2VhbiBQYXVsIHdyb3RlOgo+IEZyb206
IFNlYW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgo+IAo+IEluc3RlYWQgb2YgaGFuZCBy
b2xsaW5nIHRoZSB0cmFuc2ZlciBvdXJzZWx2ZXMgaW4gdGhlIGhkY3AgaG9vaywgaW5zcGVjdAo+
IGF1eCBtZXNzYWdlcyBhbmQgYWRkIHRoZSBha3N2IGZsYWcgaW4gdGhlIGF1eCB0cmFuc2ZlciBo
b29rLgo+IAo+IElJUkMsIHRoaXMgd2FzIHRoZSBvcmlnaW5hbCBpbXBsZW1lbnRhdGlvbiBhbmQg
Zm9sa3Mgd2FudGVkIHRoaXMgaGFjayB0bwo+IGJlIGlzb2xhdGVkIHRvIHRoZSBoZGNwIGNvZGUs
IHdoaWNoIG1ha2VzIHNlbnNlLgo+IAo+IEhvd2V2ZXIgaW4gdGVzdGluZyBhbiBMRyBtb25pdG9y
IG9uIG15IGRlc2ssIEkgbm90aWNlZCBpdCB3YXMgcGFzc2luZwo+IGJhY2sgYSBERUZFUiByZXBs
eS4gVGhpcyB3YXNuJ3QgaGFuZGxlZCBpbiBvdXIgaGFuZC1yb2xsZWQgY29kZSBhbmQgSERDUAo+
IGF1dGggd2FzIGZhaWxpbmcgYXMgYSByZXN1bHQuIEluc3RlYWQgb2YgY29weS9wYXN0aW5nIGFs
bCBvZiB0aGUgcmV0cnkKPiBsb2dpYyBhbmQgZGVsYXlzIGZyb20gZHJtIGRwIGhlbHBlcnMsIGxl
dCdzIGp1c3QgdXNlIHRoZSBoZWxwZXJzIGFuZCBoaWRlCj4gdGhlIGFrc3Ygc2VsZWN0IGFzIGJl
c3QgYXMgd2UgY2FuLgo+IAo+IFJldmlld2VkLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5
cmphbGFAbGludXguaW50ZWwuY29tPgo+IFJldmlld2VkLWJ5OiBSYW1hbGluZ2FtIEMgPHJhbWFs
aW5nYW0uY0BpbnRlbC5jb20+Ckp1c3QgcmVjb25maXJtaW5nIG15IFItYiBoZXJlLiBMR1RNCgpS
ZXZpZXdlZC1ieTogUmFtYWxpbmdhbSBDIDxyYW1hbGluZ2FtLmNAaW50ZWwuY29tPgo+IFNpZ25l
ZC1vZmYtYnk6IFNlYW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgo+IExpbms6IGh0dHBz
Oi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MTIwMzE3MzYzOC45
NDkxOS0zLXNlYW5AcG9vcmx5LnJ1biAjdjEKPiBMaW5rOiBodHRwczovL3BhdGNod29yay5mcmVl
ZGVza3RvcC5vcmcvcGF0Y2gvbXNnaWQvMjAxOTEyMTIxOTAyMzAuMTg4NTA1LTUtc2VhbkBwb29y
bHkucnVuICN2Mgo+IExpbms6IGh0dHBzOi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9wYXRj
aC9tc2dpZC8yMDIwMDExNzE5MzEwMy4xNTY4MjEtNS1zZWFuQHBvb3JseS5ydW4gI3YzCj4gTGlu
azogaHR0cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMjAwMjE4
MjIwMjQyLjEwNzI2NS01LXNlYW5AcG9vcmx5LnJ1biAjdjQKPiBMaW5rOiBodHRwczovL3BhdGNo
d29yay5mcmVlZGVza3RvcC5vcmcvcGF0Y2gvbXNnaWQvMjAyMDAzMDUyMDEyMzYuMTUyMzA3LTUt
c2VhbkBwb29ybHkucnVuICN2NQo+IAo+IENoYW5nZXMgaW4gdjI6Cj4gLVJlbW92ZSAnZ2VuZXJh
dGUnIGluIGludGVsX2RwX2F1eF9nZW5lcmF0ZV94ZmVyX2ZsYWdzLCBtYWtlIGFyZyBjb25zdCAo
VmlsbGUpCj4gLUJ1bmRsZSBBa3N2IGlmIHN0YXRlbWVudCB0b2dldGhlciAoVmlsbGUpCj4gLVJl
bmFtZSAndHhidWYnIHRvICdha3N2JyAoVmlsbGUpCj4gQ2hhbmdlcyBpbiB2MzoKPiAtTm9uZQo+
IENoYW5nZXMgaW4gdjQ6Cj4gLU5vbmUKPiBDaGFuZ2VzIGluIHY1Ogo+IC1Ob25lCj4gQ2hhbmdl
cyBpbiB2NjoKPiAtTm9uZQo+IC0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RwLmMgfCA2MyArKysrKysrKysrKystLS0tLS0tLS0tLS0tCj4gIDEgZmlsZSBjaGFuZ2Vk
LCAyOSBpbnNlcnRpb25zKCspLCAzNCBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jCj4gaW5kZXggNjk1MmIwMjk1MDk2Li5mMzNiM2UyNzNlMDUg
MTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCj4g
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCj4gQEAgLTE1NTAs
MTIgKzE1NTAsMjcgQEAgaW50ZWxfZHBfYXV4X2hlYWRlcih1OCB0eGJ1ZltIRUFERVJfU0laRV0s
Cj4gIAl0eGJ1ZlszXSA9IG1zZy0+c2l6ZSAtIDE7Cj4gIH0KPiAgCj4gK3N0YXRpYyB1MzIgaW50
ZWxfZHBfYXV4X3hmZXJfZmxhZ3MoY29uc3Qgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCj4g
K3sKPiArCS8qCj4gKwkgKiBJZiB3ZSdyZSB0cnlpbmcgdG8gc2VuZCB0aGUgSERDUCBBa3N2LCB3
ZSBuZWVkIHRvIHNldCBhIHRoZSBBa3N2Cj4gKwkgKiBzZWxlY3QgYml0IHRvIGluZm9ybSB0aGUg
aGFyZHdhcmUgdG8gc2VuZCB0aGUgQWtzdiBhZnRlciBvdXIgaGVhZGVyCj4gKwkgKiBzaW5jZSB3
ZSBjYW4ndCBhY2Nlc3MgdGhhdCBkYXRhIGZyb20gc29mdHdhcmUuCj4gKwkgKi8KPiArCWlmICgo
bXNnLT5yZXF1ZXN0ICYgfkRQX0FVWF9JMkNfTU9UKSA9PSBEUF9BVVhfTkFUSVZFX1dSSVRFICYm
Cj4gKwkgICAgbXNnLT5hZGRyZXNzID09IERQX0FVWF9IRENQX0FLU1YpCj4gKwkJcmV0dXJuIERQ
X0FVWF9DSF9DVExfQVVYX0FLU1ZfU0VMRUNUOwo+ICsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+
ICBzdGF0aWMgc3NpemVfdAo+ICBpbnRlbF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9h
dXggKmF1eCwgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCj4gIHsKPiAgCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAgPSBjb250YWluZXJfb2YoYXV4LCBzdHJ1Y3QgaW50ZWxfZHAsIGF1eCk7
Cj4gIAl1OCB0eGJ1ZlsyMF0sIHJ4YnVmWzIwXTsKPiAgCXNpemVfdCB0eHNpemUsIHJ4c2l6ZTsK
PiArCXUzMiBmbGFncyA9IGludGVsX2RwX2F1eF94ZmVyX2ZsYWdzKG1zZyk7Cj4gIAlpbnQgcmV0
Owo+ICAKPiAgCWludGVsX2RwX2F1eF9oZWFkZXIodHhidWYsIG1zZyk7Cj4gQEAgLTE1NzYsNyAr
MTU5MSw3IEBAIGludGVsX2RwX2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LCBz
dHJ1Y3QgZHJtX2RwX2F1eF9tc2cgKm1zZykKPiAgCQkJbWVtY3B5KHR4YnVmICsgSEVBREVSX1NJ
WkUsIG1zZy0+YnVmZmVyLCBtc2ctPnNpemUpOwo+ICAKPiAgCQlyZXQgPSBpbnRlbF9kcF9hdXhf
eGZlcihpbnRlbF9kcCwgdHhidWYsIHR4c2l6ZSwKPiAtCQkJCQlyeGJ1ZiwgcnhzaXplLCAwKTsK
PiArCQkJCQlyeGJ1ZiwgcnhzaXplLCBmbGFncyk7Cj4gIAkJaWYgKHJldCA+IDApIHsKPiAgCQkJ
bXNnLT5yZXBseSA9IHJ4YnVmWzBdID4+IDQ7Cj4gIAo+IEBAIC0xNTk5LDcgKzE2MTQsNyBAQCBp
bnRlbF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9k
cF9hdXhfbXNnICptc2cpCj4gIAkJCXJldHVybiAtRTJCSUc7Cj4gIAo+ICAJCXJldCA9IGludGVs
X2RwX2F1eF94ZmVyKGludGVsX2RwLCB0eGJ1ZiwgdHhzaXplLAo+IC0JCQkJCXJ4YnVmLCByeHNp
emUsIDApOwo+ICsJCQkJCXJ4YnVmLCByeHNpemUsIGZsYWdzKTsKPiAgCQlpZiAocmV0ID4gMCkg
ewo+ICAJCQltc2ctPnJlcGx5ID0gcnhidWZbMF0gPj4gNDsKPiAgCQkJLyoKPiBAQCAtNjU1Mywx
NyArNjU2OCw5IEBAIGludCBpbnRlbF9kcF9oZGNwX3dyaXRlX2FuX2Frc3Yoc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCj4gIAkJCQl1OCAqYW4pCj4gIHsKPiAgCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9kaWdfcG9ydC0+YmFz
ZS5iYXNlLmRldik7Cj4gLQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVs
X2RwKHRvX2ludGVsX2VuY29kZXIoJmludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UpKTsKPiAtCXN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2RwX2F1eF9tc2cgbXNnID0gewo+IC0JCS5yZXF1ZXN0ID0g
RFBfQVVYX05BVElWRV9XUklURSwKPiAtCQkuYWRkcmVzcyA9IERQX0FVWF9IRENQX0FLU1YsCj4g
LQkJLnNpemUgPSBEUk1fSERDUF9LU1ZfTEVOLAo+IC0JfTsKPiAtCXU4IHR4YnVmW0hFQURFUl9T
SVpFICsgRFJNX0hEQ1BfS1NWX0xFTl0gPSB7fSwgcnhidWZbMl0sIHJlcGx5ID0gMDsKPiArCXU4
IGFrc3ZbRFJNX0hEQ1BfS1NWX0xFTl0gPSB7fTsKPiAgCXNzaXplX3QgZHBjZF9yZXQ7Cj4gLQlp
bnQgcmV0Owo+ICAKPiAtCS8qIE91dHB1dCBBbiBmaXJzdCwgdGhhdCdzIGVhc3kgKi8KPiAgCWRw
Y2RfcmV0ID0gZHJtX2RwX2RwY2Rfd3JpdGUoJmludGVsX2RpZ19wb3J0LT5kcC5hdXgsIERQX0FV
WF9IRENQX0FOLAo+ICAJCQkJICAgICBhbiwgRFJNX0hEQ1BfQU5fTEVOKTsKPiAgCWlmIChkcGNk
X3JldCAhPSBEUk1fSERDUF9BTl9MRU4pIHsKPiBAQCAtNjU3NCwzMSArNjU4MSwxOSBAQCBpbnQg
aW50ZWxfZHBfaGRjcF93cml0ZV9hbl9ha3N2KHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmlu
dGVsX2RpZ19wb3J0LAo+ICAJfQo+ICAKPiAgCS8qCj4gLQkgKiBTaW5jZSBBa3N2IGlzIE9oLVNv
LVNlY3JldCwgd2UgY2FuJ3QgYWNjZXNzIGl0IGluIHNvZnR3YXJlLiBTbyBpbgo+IC0JICogb3Jk
ZXIgdG8gZ2V0IGl0IG9uIHRoZSB3aXJlLCB3ZSBuZWVkIHRvIGNyZWF0ZSB0aGUgQVVYIGhlYWRl
ciBhcyBpZgo+IC0JICogd2Ugd2VyZSB3cml0aW5nIHRoZSBkYXRhLCBhbmQgdGhlbiB0aWNrbGUg
dGhlIGhhcmR3YXJlIHRvIG91dHB1dCB0aGUKPiAtCSAqIGRhdGEgb25jZSB0aGUgaGVhZGVyIGlz
IHNlbnQgb3V0Lgo+ICsJICogU2luY2UgQWtzdiBpcyBPaC1Tby1TZWNyZXQsIHdlIGNhbid0IGFj
Y2VzcyBpdCBpbiBzb2Z0d2FyZS4gU28gd2UKPiArCSAqIHNlbmQgYW4gZW1wdHkgYnVmZmVyIG9m
IHRoZSBjb3JyZWN0IGxlbmd0aCB0aHJvdWdoIHRoZSBEUCBoZWxwZXJzLiBPbgo+ICsJICogdGhl
IG90aGVyIHNpZGUsIGluIHRoZSB0cmFuc2ZlciBob29rLCB3ZSdsbCBnZW5lcmF0ZSBhIGZsYWcg
YmFzZWQgb24KPiArCSAqIHRoZSBkZXN0aW5hdGlvbiBhZGRyZXNzIHdoaWNoIHdpbGwgdGlja2xl
IHRoZSBoYXJkd2FyZSB0byBvdXRwdXQgdGhlCj4gKwkgKiBBa3N2IG9uIG91ciBiZWhhbGYgYWZ0
ZXIgdGhlIGhlYWRlciBpcyBzZW50Lgo+ICAJICovCj4gLQlpbnRlbF9kcF9hdXhfaGVhZGVyKHR4
YnVmLCAmbXNnKTsKPiAtCj4gLQlyZXQgPSBpbnRlbF9kcF9hdXhfeGZlcihpbnRlbF9kcCwgdHhi
dWYsIEhFQURFUl9TSVpFICsgbXNnLnNpemUsCj4gLQkJCQlyeGJ1Ziwgc2l6ZW9mKHJ4YnVmKSwK
PiAtCQkJCURQX0FVWF9DSF9DVExfQVVYX0FLU1ZfU0VMRUNUKTsKPiAtCWlmIChyZXQgPCAwKSB7
Cj4gLQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKPiAtCQkJICAgICJXcml0ZSBBa3N2IG92ZXIg
RFAvQVVYIGZhaWxlZCAoJWQpXG4iLCByZXQpOwo+IC0JCXJldHVybiByZXQ7Cj4gLQl9IGVsc2Ug
aWYgKHJldCA9PSAwKSB7Cj4gLQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIkFrc3Ygd3JpdGUg
b3ZlciBEUC9BVVggd2FzIGVtcHR5XG4iKTsKPiAtCQlyZXR1cm4gLUVJTzsKPiAtCX0KPiAtCj4g
LQlyZXBseSA9IChyeGJ1ZlswXSA+PiA0KSAmIERQX0FVWF9OQVRJVkVfUkVQTFlfTUFTSzsKPiAt
CWlmIChyZXBseSAhPSBEUF9BVVhfTkFUSVZFX1JFUExZX0FDSykgewo+ICsJZHBjZF9yZXQgPSBk
cm1fZHBfZHBjZF93cml0ZSgmaW50ZWxfZGlnX3BvcnQtPmRwLmF1eCwgRFBfQVVYX0hEQ1BfQUtT
ViwKPiArCQkJCSAgICAgYWtzdiwgRFJNX0hEQ1BfS1NWX0xFTik7Cj4gKwlpZiAoZHBjZF9yZXQg
IT0gRFJNX0hEQ1BfS1NWX0xFTikgewo+ICAJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCj4gLQkJ
CSAgICAiQWtzdiB3cml0ZTogbm8gRFBfQVVYX05BVElWRV9SRVBMWV9BQ0sgJXhcbiIsCj4gLQkJ
CSAgICByZXBseSk7Cj4gLQkJcmV0dXJuIC1FSU87Cj4gKwkJCSAgICAiRmFpbGVkIHRvIHdyaXRl
IEFrc3Ygb3ZlciBEUC9BVVggKCV6ZClcbiIsCj4gKwkJCSAgICBkcGNkX3JldCk7Cj4gKwkJcmV0
dXJuIGRwY2RfcmV0ID49IDAgPyAtRUlPIDogZHBjZF9yZXQ7Cj4gIAl9Cj4gIAlyZXR1cm4gMDsK
PiAgfQo+IC0tIAo+IFNlYW4gUGF1bCwgU29mdHdhcmUgRW5naW5lZXIsIEdvb2dsZSAvIENocm9t
aXVtIE9TCj4gCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
