Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 77218E4C7C
	for <lists+dri-devel@lfdr.de>; Fri, 25 Oct 2019 15:42:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EDB7F6EA34;
	Fri, 25 Oct 2019 13:42:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (unknown [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 917846EA35
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Oct 2019 13:42:03 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 3DE42337;
 Fri, 25 Oct 2019 06:41:56 -0700 (PDT)
Received: from e112269-lin.cambridge.arm.com (e112269-lin.cambridge.arm.com
 [10.1.194.43])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id DB1F23F71A;
 Fri, 25 Oct 2019 06:41:54 -0700 (PDT)
From: Steven Price <steven.price@arm.com>
To: Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>,
 Rob Herring <robh@kernel.org>, Tomeu Vizoso <tomeu.vizoso@collabora.com>
Subject: [PATCH v2 2/2] drm/panfrost: Simplify devfreq utilisation tracking
Date: Fri, 25 Oct 2019 14:41:43 +0100
Message-Id: <20191025134143.14324-3-steven.price@arm.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191025134143.14324-1-steven.price@arm.com>
References: <20191025134143.14324-1-steven.price@arm.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-kernel@vger.kernel.org, Mark Brown <broonie@kernel.org>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 dri-devel@lists.freedesktop.org, Steven Price <steven.price@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiB0cmFja2luZyBwZXItc2xvdCB1dGlsaXNhdGlvbiB0cmFjayBhIHNpbmdsZSB2
YWx1ZSBmb3IgdGhlCmVudGlyZSBHUFUuIFVsdGltYXRlbHkgaXQgZG9lc24ndCBtYXR0ZXIgaWYg
dGhlIEdQVSBpcyBidXN5IHdpdGggb25seQp2ZXJ0ZXggb3IgYSBjb21iaW5hdGlvbiBvZiB2ZXJ0
ZXggYW5kIGZyYWdtZW50IHByb2Nlc3NpbmcgLSBpZiBpdCdzIGJ1c3kKdGhlbiBpdCdzIGJ1c3kg
YW5kIGRldmZyZXEgc2hvdWxkIGJlIHNjYWxpbmcgYXBwcm9wcmlhdGVseS4KClRoaXMgYWxzbyBt
YWtlcyB3YXkgZm9yIGJlaW5nIGFibGUgdG8gc3VibWl0IG11bHRpcGxlIGpvYnMgcGVyIHNsb3QK
d2hpY2ggcmVxdWlyZXMgbW9yZSB2YWx1ZXMgdGhhbiB0aGUgb3JpZ2luYWwgYm9vbGVhbiBwZXIg
c2xvdC4KClJldmlld2VkLWJ5OiBUb21ldSBWaXpvc28gPHRvbWV1LnZpem9zb0Bjb2xsYWJvcmEu
Y29tPgpSZXZpZXdlZC1ieTogQWx5c3NhIFJvc2VuendlaWcgPGFseXNzYS5yb3Nlbnp3ZWlnQGNv
bGxhYm9yYS5jb20+ClNpZ25lZC1vZmYtYnk6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnByaWNlQGFy
bS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmZyZXEuYyB8
IDY0ICsrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZy
b3N0X2RldmZyZXEuaCB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rf
ZGV2aWNlLmggIHwgMTIgKystLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pv
Yi5jICAgICB8IDE1ICsrKy0tCiA0IGZpbGVzIGNoYW5nZWQsIDM4IGluc2VydGlvbnMoKyksIDU2
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9kZXZmcmVxLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2ZnJl
cS5jCmluZGV4IDdkZWQyODJhNWNhOC4uNGM0ZThhMzBhMWFjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2ZnJlcS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmMKQEAgLTEzLDcgKzEzLDcgQEAKICNpbmNsdWRl
ICJwYW5mcm9zdF9ncHUuaCIKICNpbmNsdWRlICJwYW5mcm9zdF9yZWdzLmgiCiAKLXN0YXRpYyB2
b2lkIHBhbmZyb3N0X2RldmZyZXFfdXBkYXRlX3V0aWxpemF0aW9uKHN0cnVjdCBwYW5mcm9zdF9k
ZXZpY2UgKnBmZGV2LCBpbnQgc2xvdCk7CitzdGF0aWMgdm9pZCBwYW5mcm9zdF9kZXZmcmVxX3Vw
ZGF0ZV91dGlsaXphdGlvbihzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldik7CiAKIHN0YXRp
YyBpbnQgcGFuZnJvc3RfZGV2ZnJlcV90YXJnZXQoc3RydWN0IGRldmljZSAqZGV2LCB1bnNpZ25l
ZCBsb25nICpmcmVxLAogCQkJCSAgIHUzMiBmbGFncykKQEAgLTMyLDM3ICszMiwyMyBAQCBzdGF0
aWMgaW50IHBhbmZyb3N0X2RldmZyZXFfdGFyZ2V0KHN0cnVjdCBkZXZpY2UgKmRldiwgdW5zaWdu
ZWQgbG9uZyAqZnJlcSwKIAogc3RhdGljIHZvaWQgcGFuZnJvc3RfZGV2ZnJlcV9yZXNldChzdHJ1
Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKIHsKLQlrdGltZV90IG5vdyA9IGt0aW1lX2dldCgp
OwotCWludCBpOwotCi0JZm9yIChpID0gMDsgaSA8IE5VTV9KT0JfU0xPVFM7IGkrKykgewotCQlw
ZmRldi0+ZGV2ZnJlcS5zbG90W2ldLmJ1c3lfdGltZSA9IDA7Ci0JCXBmZGV2LT5kZXZmcmVxLnNs
b3RbaV0uaWRsZV90aW1lID0gMDsKLQkJcGZkZXYtPmRldmZyZXEuc2xvdFtpXS50aW1lX2xhc3Rf
dXBkYXRlID0gbm93OwotCX0KKwlwZmRldi0+ZGV2ZnJlcS5idXN5X3RpbWUgPSAwOworCXBmZGV2
LT5kZXZmcmVxLmlkbGVfdGltZSA9IDA7CisJcGZkZXYtPmRldmZyZXEudGltZV9sYXN0X3VwZGF0
ZSA9IGt0aW1lX2dldCgpOwogfQogCiBzdGF0aWMgaW50IHBhbmZyb3N0X2RldmZyZXFfZ2V0X2Rl
dl9zdGF0dXMoc3RydWN0IGRldmljZSAqZGV2LAogCQkJCQkgICBzdHJ1Y3QgZGV2ZnJlcV9kZXZf
c3RhdHVzICpzdGF0dXMpCiB7CiAJc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYgPSBkZXZf
Z2V0X2RydmRhdGEoZGV2KTsKLQlpbnQgaTsKIAotCWZvciAoaSA9IDA7IGkgPCBOVU1fSk9CX1NM
T1RTOyBpKyspIHsKLQkJcGFuZnJvc3RfZGV2ZnJlcV91cGRhdGVfdXRpbGl6YXRpb24ocGZkZXYs
IGkpOwotCX0KKwlwYW5mcm9zdF9kZXZmcmVxX3VwZGF0ZV91dGlsaXphdGlvbihwZmRldik7CiAK
IAlzdGF0dXMtPmN1cnJlbnRfZnJlcXVlbmN5ID0gY2xrX2dldF9yYXRlKHBmZGV2LT5jbG9jayk7
Ci0Jc3RhdHVzLT50b3RhbF90aW1lID0ga3RpbWVfdG9fbnMoa3RpbWVfYWRkKHBmZGV2LT5kZXZm
cmVxLnNsb3RbMF0uYnVzeV90aW1lLAotCQkJCQkJICAgcGZkZXYtPmRldmZyZXEuc2xvdFswXS5p
ZGxlX3RpbWUpKTsKLQotCXN0YXR1cy0+YnVzeV90aW1lID0gMDsKLQlmb3IgKGkgPSAwOyBpIDwg
TlVNX0pPQl9TTE9UUzsgaSsrKSB7Ci0JCXN0YXR1cy0+YnVzeV90aW1lICs9IGt0aW1lX3RvX25z
KHBmZGV2LT5kZXZmcmVxLnNsb3RbaV0uYnVzeV90aW1lKTsKLQl9CisJc3RhdHVzLT50b3RhbF90
aW1lID0ga3RpbWVfdG9fbnMoa3RpbWVfYWRkKHBmZGV2LT5kZXZmcmVxLmJ1c3lfdGltZSwKKwkJ
CQkJCSAgIHBmZGV2LT5kZXZmcmVxLmlkbGVfdGltZSkpOwogCi0JLyogV2UncmUgc2NoZWR1bGlu
ZyBvbmx5IHRvIG9uZSBjb3JlIGF0bSwgc28gZG9uJ3QgZGl2aWRlIGZvciBub3cgKi8KLQkvKiBz
dGF0dXMtPmJ1c3lfdGltZSAvPSBOVU1fSk9CX1NMT1RTOyAqLworCXN0YXR1cy0+YnVzeV90aW1l
ID0ga3RpbWVfdG9fbnMocGZkZXYtPmRldmZyZXEuYnVzeV90aW1lKTsKIAogCXBhbmZyb3N0X2Rl
dmZyZXFfcmVzZXQocGZkZXYpOwogCkBAIC0xMzQsMTQgKzEyMCwxMCBAQCB2b2lkIHBhbmZyb3N0
X2RldmZyZXFfZmluaShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKIAogdm9pZCBwYW5m
cm9zdF9kZXZmcmVxX3Jlc3VtZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKIHsKLQlp
bnQgaTsKLQogCWlmICghcGZkZXYtPmRldmZyZXEuZGV2ZnJlcSkKIAkJcmV0dXJuOwogCiAJcGFu
ZnJvc3RfZGV2ZnJlcV9yZXNldChwZmRldik7Ci0JZm9yIChpID0gMDsgaSA8IE5VTV9KT0JfU0xP
VFM7IGkrKykKLQkJcGZkZXYtPmRldmZyZXEuc2xvdFtpXS5idXN5ID0gZmFsc2U7CiAKIAlkZXZm
cmVxX3Jlc3VtZV9kZXZpY2UocGZkZXYtPmRldmZyZXEuZGV2ZnJlcSk7CiB9CkBAIC0xNTQsOSAr
MTM2LDggQEAgdm9pZCBwYW5mcm9zdF9kZXZmcmVxX3N1c3BlbmQoc3RydWN0IHBhbmZyb3N0X2Rl
dmljZSAqcGZkZXYpCiAJZGV2ZnJlcV9zdXNwZW5kX2RldmljZShwZmRldi0+ZGV2ZnJlcS5kZXZm
cmVxKTsKIH0KIAotc3RhdGljIHZvaWQgcGFuZnJvc3RfZGV2ZnJlcV91cGRhdGVfdXRpbGl6YXRp
b24oc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBzbG90KQorc3RhdGljIHZvaWQg
cGFuZnJvc3RfZGV2ZnJlcV91cGRhdGVfdXRpbGl6YXRpb24oc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYpCiB7Ci0Jc3RydWN0IHBhbmZyb3N0X2RldmZyZXFfc2xvdCAqZGV2ZnJlcV9zbG90
ID0gJnBmZGV2LT5kZXZmcmVxLnNsb3Rbc2xvdF07CiAJa3RpbWVfdCBub3c7CiAJa3RpbWVfdCBs
YXN0OwogCkBAIC0xNjQsMjIgKzE0NSwyNyBAQCBzdGF0aWMgdm9pZCBwYW5mcm9zdF9kZXZmcmVx
X3VwZGF0ZV91dGlsaXphdGlvbihzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaQogCQly
ZXR1cm47CiAKIAlub3cgPSBrdGltZV9nZXQoKTsKLQlsYXN0ID0gcGZkZXYtPmRldmZyZXEuc2xv
dFtzbG90XS50aW1lX2xhc3RfdXBkYXRlOworCWxhc3QgPSBwZmRldi0+ZGV2ZnJlcS50aW1lX2xh
c3RfdXBkYXRlOwogCi0JLyogSWYgd2UgbGFzdCByZWNvcmRlZCBhIHRyYW5zaXRpb24gdG8gYnVz
eSwgd2UgaGF2ZSBiZWVuIGlkbGUgc2luY2UgKi8KLQlpZiAoZGV2ZnJlcV9zbG90LT5idXN5KQot
CQlwZmRldi0+ZGV2ZnJlcS5zbG90W3Nsb3RdLmJ1c3lfdGltZSArPSBrdGltZV9zdWIobm93LCBs
YXN0KTsKKwlpZiAoYXRvbWljX3JlYWQoJnBmZGV2LT5kZXZmcmVxLmJ1c3lfY291bnQpID4gMCkK
KwkJcGZkZXYtPmRldmZyZXEuYnVzeV90aW1lICs9IGt0aW1lX3N1Yihub3csIGxhc3QpOwogCWVs
c2UKLQkJcGZkZXYtPmRldmZyZXEuc2xvdFtzbG90XS5pZGxlX3RpbWUgKz0ga3RpbWVfc3ViKG5v
dywgbGFzdCk7CisJCXBmZGV2LT5kZXZmcmVxLmlkbGVfdGltZSArPSBrdGltZV9zdWIobm93LCBs
YXN0KTsKKworCXBmZGV2LT5kZXZmcmVxLnRpbWVfbGFzdF91cGRhdGUgPSBub3c7Cit9CiAKLQlw
ZmRldi0+ZGV2ZnJlcS5zbG90W3Nsb3RdLnRpbWVfbGFzdF91cGRhdGUgPSBub3c7Cit2b2lkIHBh
bmZyb3N0X2RldmZyZXFfcmVjb3JkX2J1c3koc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYp
Cit7CisJcGFuZnJvc3RfZGV2ZnJlcV91cGRhdGVfdXRpbGl6YXRpb24ocGZkZXYpOworCWF0b21p
Y19pbmMoJnBmZGV2LT5kZXZmcmVxLmJ1c3lfY291bnQpOwogfQogCi0vKiBUaGUgam9iIHNjaGVk
dWxlciBpcyBleHBlY3RlZCB0byBjYWxsIHRoaXMgYXQgZXZlcnkgdHJhbnNpdGlvbiBidXN5IDwt
PiBpZGxlICovCi12b2lkIHBhbmZyb3N0X2RldmZyZXFfcmVjb3JkX3RyYW5zaXRpb24oc3RydWN0
IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBzbG90KQordm9pZCBwYW5mcm9zdF9kZXZmcmVx
X3JlY29yZF9pZGxlKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KQogewotCXN0cnVjdCBw
YW5mcm9zdF9kZXZmcmVxX3Nsb3QgKmRldmZyZXFfc2xvdCA9ICZwZmRldi0+ZGV2ZnJlcS5zbG90
W3Nsb3RdOworCWludCBjb3VudDsKIAotCXBhbmZyb3N0X2RldmZyZXFfdXBkYXRlX3V0aWxpemF0
aW9uKHBmZGV2LCBzbG90KTsKLQlkZXZmcmVxX3Nsb3QtPmJ1c3kgPSAhZGV2ZnJlcV9zbG90LT5i
dXN5OworCXBhbmZyb3N0X2RldmZyZXFfdXBkYXRlX3V0aWxpemF0aW9uKHBmZGV2KTsKKwljb3Vu
dCA9IGF0b21pY19kZWNfaWZfcG9zaXRpdmUoJnBmZGV2LT5kZXZmcmVxLmJ1c3lfY291bnQpOwor
CVdBUk5fT04oY291bnQgPCAwKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9kZXZmcmVxLmggYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3RfZGV2ZnJlcS5oCmluZGV4IGUzYmM2M2U4Mjg0My4uMDYxMWJlZmZjOGQwIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2ZnJlcS5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmgKQEAgLTEwLDYgKzEwLDcgQEAg
dm9pZCBwYW5mcm9zdF9kZXZmcmVxX2Zpbmkoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYp
Owogdm9pZCBwYW5mcm9zdF9kZXZmcmVxX3Jlc3VtZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpw
ZmRldik7CiB2b2lkIHBhbmZyb3N0X2RldmZyZXFfc3VzcGVuZChzdHJ1Y3QgcGFuZnJvc3RfZGV2
aWNlICpwZmRldik7CiAKLXZvaWQgcGFuZnJvc3RfZGV2ZnJlcV9yZWNvcmRfdHJhbnNpdGlvbihz
dHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaW50IHNsb3QpOwordm9pZCBwYW5mcm9zdF9k
ZXZmcmVxX3JlY29yZF9idXN5KHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KTsKK3ZvaWQg
cGFuZnJvc3RfZGV2ZnJlcV9yZWNvcmRfaWRsZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRl
dik7CiAKICNlbmRpZiAvKiBfX1BBTkZST1NUX0RFVkZSRVFfSF9fICovCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2aWNlLmggYi9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2aWNlLmgKaW5kZXggNzI2MjhmMDU1MTk3Li4wNjcxMzgx
MWI5MmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZp
Y2UuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2aWNlLmgKQEAg
LTUxLDEzICs1MSw2IEBAIHN0cnVjdCBwYW5mcm9zdF9mZWF0dXJlcyB7CiAJdW5zaWduZWQgbG9u
ZyBod19pc3N1ZXNbNjQgLyBCSVRTX1BFUl9MT05HXTsKIH07CiAKLXN0cnVjdCBwYW5mcm9zdF9k
ZXZmcmVxX3Nsb3QgewotCWt0aW1lX3QgYnVzeV90aW1lOwotCWt0aW1lX3QgaWRsZV90aW1lOwot
CWt0aW1lX3QgdGltZV9sYXN0X3VwZGF0ZTsKLQlib29sIGJ1c3k7Ci19OwotCiBzdHJ1Y3QgcGFu
ZnJvc3RfZGV2aWNlIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXY7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRkZXY7CkBAIC05Myw3ICs4NiwxMCBAQCBzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlIHsKIAlzdHJ1
Y3QgewogCQlzdHJ1Y3QgZGV2ZnJlcSAqZGV2ZnJlcTsKIAkJc3RydWN0IHRoZXJtYWxfY29vbGlu
Z19kZXZpY2UgKmNvb2xpbmc7Ci0JCXN0cnVjdCBwYW5mcm9zdF9kZXZmcmVxX3Nsb3Qgc2xvdFtO
VU1fSk9CX1NMT1RTXTsKKwkJa3RpbWVfdCBidXN5X3RpbWU7CisJCWt0aW1lX3QgaWRsZV90aW1l
OworCQlrdGltZV90IHRpbWVfbGFzdF91cGRhdGU7CisJCWF0b21pY190IGJ1c3lfY291bnQ7CiAJ
fSBkZXZmcmVxOwogfTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2pvYi5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5jCmlu
ZGV4IDMzYmYyNWJhNTA2ZS4uZDQxMWViNmM4ZWI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L3BhbmZyb3N0X2pvYi5jCkBAIC0xNTUsOCArMTU1LDcgQEAgc3RhdGljIHZvaWQgcGFuZnJvc3Rf
am9iX2h3X3N1Ym1pdChzdHJ1Y3QgcGFuZnJvc3Rfam9iICpqb2IsIGludCBqcykKIAl9CiAKIAlj
ZmcgPSBwYW5mcm9zdF9tbXVfYXNfZ2V0KHBmZGV2LCAmam9iLT5maWxlX3ByaXYtPm1tdSk7Ci0K
LQlwYW5mcm9zdF9kZXZmcmVxX3JlY29yZF90cmFuc2l0aW9uKHBmZGV2LCBqcyk7CisJcGFuZnJv
c3RfZGV2ZnJlcV9yZWNvcmRfYnVzeShwZmRldik7CiAKIAlqb2Jfd3JpdGUocGZkZXYsIEpTX0hF
QURfTkVYVF9MTyhqcyksIGpjX2hlYWQgJiAweEZGRkZGRkZGKTsKIAlqb2Jfd3JpdGUocGZkZXYs
IEpTX0hFQURfTkVYVF9ISShqcyksIGpjX2hlYWQgPj4gMzIpOwpAQCAtNDA0LDcgKzQwMyw3IEBA
IHN0YXRpYyB2b2lkIHBhbmZyb3N0X2pvYl90aW1lZG91dChzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAq
c2NoZWRfam9iKQogCX0KIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwZmRldi0+anMtPmpvYl9s
b2NrLCBmbGFncyk7CiAKLQlwYW5mcm9zdF9kZXZmcmVxX3JlY29yZF90cmFuc2l0aW9uKHBmZGV2
LCBqcyk7CisJcGFuZnJvc3RfZGV2ZnJlcV9yZWNvcmRfaWRsZShwZmRldik7CiAJcGFuZnJvc3Rf
ZGV2aWNlX3Jlc2V0KHBmZGV2KTsKIAogCWZvciAoaSA9IDA7IGkgPCBOVU1fSk9CX1NMT1RTOyBp
KyspCkBAIC00NjcsNyArNDY2LDcgQEAgc3RhdGljIGlycXJldHVybl90IHBhbmZyb3N0X2pvYl9p
cnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRhKQogCQkJCXBmZGV2LT5qb2JzW2pdID0gTlVM
TDsKIAogCQkJCXBhbmZyb3N0X21tdV9hc19wdXQocGZkZXYsICZqb2ItPmZpbGVfcHJpdi0+bW11
KTsKLQkJCQlwYW5mcm9zdF9kZXZmcmVxX3JlY29yZF90cmFuc2l0aW9uKHBmZGV2LCBqKTsKKwkJ
CQlwYW5mcm9zdF9kZXZmcmVxX3JlY29yZF9pZGxlKHBmZGV2KTsKIAogCQkJCWRtYV9mZW5jZV9z
aWduYWxfbG9ja2VkKGpvYi0+ZG9uZV9mZW5jZSk7CiAJCQkJcG1fcnVudGltZV9wdXRfYXV0b3N1
c3BlbmQocGZkZXYtPmRldik7CkBAIC01NjgsMTQgKzU2NywxNCBAQCBpbnQgcGFuZnJvc3Rfam9i
X2lzX2lkbGUoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYpCiAJc3RydWN0IHBhbmZyb3N0
X2pvYl9zbG90ICpqcyA9IHBmZGV2LT5qczsKIAlpbnQgaTsKIAorCS8qIENoZWNrIHdoZXRoZXIg
dGhlIGhhcmR3YXJlIGlzIGlkbGUgKi8KKwlpZiAoYXRvbWljX3JlYWQoJnBmZGV2LT5kZXZmcmVx
LmJ1c3lfY291bnQpKQorCQlyZXR1cm4gZmFsc2U7CisKIAlmb3IgKGkgPSAwOyBpIDwgTlVNX0pP
Ql9TTE9UUzsgaSsrKSB7CiAJCS8qIElmIHRoZXJlIGFyZSBhbnkgam9icyBpbiB0aGUgSFcgcXVl
dWUsIHdlJ3JlIG5vdCBpZGxlICovCiAJCWlmIChhdG9taWNfcmVhZCgmanMtPnF1ZXVlW2ldLnNj
aGVkLmh3X3JxX2NvdW50KSkKIAkJCXJldHVybiBmYWxzZTsKLQotCQkvKiBDaGVjayB3aGV0aGVy
IHRoZSBoYXJkd2FyZSBpcyBpZGxlICovCi0JCWlmIChwZmRldi0+ZGV2ZnJlcS5zbG90W2ldLmJ1
c3kpCi0JCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJcmV0dXJuIHRydWU7Ci0tIAoyLjIwLjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
