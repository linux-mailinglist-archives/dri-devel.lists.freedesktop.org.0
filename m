Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 05C02EEDFD
	for <lists+dri-devel@lfdr.de>; Mon,  4 Nov 2019 23:12:49 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 35D196E8A3;
	Mon,  4 Nov 2019 22:12:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7B9E56E8A1
 for <dri-devel@lists.freedesktop.org>; Mon,  4 Nov 2019 22:12:39 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: andrzej.p) with ESMTPSA id A420228BA72
From: Andrzej Pietrasiewicz <andrzej.p@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCHv2 3/4] drm/komeda: use afbc helpers
Date: Mon,  4 Nov 2019 23:12:27 +0100
Message-Id: <20191104221228.3588-4-andrzej.p@collabora.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191104221228.3588-1-andrzej.p@collabora.com>
References: <2485717.1SzL54aMiy@e123338-lin>
 <20191104221228.3588-1-andrzej.p@collabora.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ayan Halder <Ayan.Halder@arm.com>, kernel@collabora.com,
 David Airlie <airlied@linux.ie>, Liviu Dudau <liviu.dudau@arm.com>,
 linux-rockchip@lists.infradead.org, James Wang <james.qian.wang@arm.com>,
 Mihail Atanassov <mihail.atanassov@arm.com>, Sean Paul <sean@poorly.run>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUgYXJlIGFmYmMgaGVscGVycyBhdmFpbGFibGUuCgpTaWduZWQtb2ZmLWJ5OiBBbmRyemVq
IFBpZXRyYXNpZXdpY3ogPGFuZHJ6ZWoucEBjb2xsYWJvcmEuY29tPgotLS0KIC4uLi9hcm0vZGlz
cGxheS9rb21lZGEva29tZWRhX2Zvcm1hdF9jYXBzLmggICB8ICAxIC0KIC4uLi9hcm0vZGlzcGxh
eS9rb21lZGEva29tZWRhX2ZyYW1lYnVmZmVyLmMgICB8IDQ0ICsrKysrKystLS0tLS0tLS0tLS0K
IDIgZmlsZXMgY2hhbmdlZCwgMTcgaW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfZm9ybWF0
X2NhcHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21lZGEva29tZWRhX2Zvcm1h
dF9jYXBzLmgKaW5kZXggMzIyNzNjZjE4ZjdjLi42MDdlZWE4MGU2MGMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21lZGEva29tZWRhX2Zvcm1hdF9jYXBzLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfZm9ybWF0X2NhcHMu
aApAQCAtMzMsNyArMzMsNiBAQAogCiAjZGVmaW5lIEFGQkNfVEhfTEFZT1VUX0FMSUdOTUVOVAk4
CiAjZGVmaW5lIEFGQkNfSEVBREVSX1NJWkUJCTE2Ci0jZGVmaW5lIEFGQkNfU1VQRVJCTEtfQUxJ
R05NRU5UCQkxMjgKICNkZWZpbmUgQUZCQ19TVVBFUkJMS19QSVhFTFMJCTI1NgogI2RlZmluZSBB
RkJDX0JPRFlfU1RBUlRfQUxJR05NRU5UCTEwMjQKICNkZWZpbmUgQUZCQ19USF9CT0RZX1NUQVJU
X0FMSUdOTUVOVAk0MDk2CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXJtL2Rpc3BsYXkv
a29tZWRhL2tvbWVkYV9mcmFtZWJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5
L2tvbWVkYS9rb21lZGFfZnJhbWVidWZmZXIuYwppbmRleCAxYjAxYTYyNWY0MGUuLmU5Yzg3NTUx
YTViOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21l
ZGFfZnJhbWVidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYXJtL2Rpc3BsYXkva29tZWRh
L2tvbWVkYV9mcmFtZWJ1ZmZlci5jCkBAIC00LDYgKzQsNyBAQAogICogQXV0aG9yOiBKYW1lcy5R
aWFuLldhbmcgPGphbWVzLnFpYW4ud2FuZ0Bhcm0uY29tPgogICoKICAqLworI2luY2x1ZGUgPGRy
bS9kcm1fYWZiYy5oPgogI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CiAjaW5jbHVkZSA8ZHJt
L2RybV9mYl9jbWFfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KQEAgLTQzLDgg
KzQ0LDcgQEAga29tZWRhX2ZiX2FmYmNfc2l6ZV9jaGVjayhzdHJ1Y3Qga29tZWRhX2ZiICprZmIs
IHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9ICZr
ZmItPmJhc2U7CiAJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9IGZiLT5mb3Jt
YXQ7CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7Ci0JdTMyIGFsaWdubWVudF93ID0gMCwg
YWxpZ25tZW50X2ggPSAwLCBhbGlnbm1lbnRfaGVhZGVyLCBuX2Jsb2NrcywgYnBwOwotCXU2NCBt
aW5fc2l6ZTsKKwl1MzIgYWxpZ25tZW50X3cgPSAwLCBhbGlnbm1lbnRfaCA9IDAsIGFsaWdubWVu
dF9oZWFkZXIsIGJwcDsKIAogCW9iaiA9IGRybV9nZW1fb2JqZWN0X2xvb2t1cChmaWxlLCBtb2Rl
X2NtZC0+aGFuZGxlc1swXSk7CiAJaWYgKCFvYmopIHsKQEAgLTUyLDE5ICs1MiwxNSBAQCBrb21l
ZGFfZmJfYWZiY19zaXplX2NoZWNrKHN0cnVjdCBrb21lZGFfZmIgKmtmYiwgc3RydWN0IGRybV9m
aWxlICpmaWxlLAogCQlyZXR1cm4gLUVOT0VOVDsKIAl9CiAKLQlzd2l0Y2ggKGZiLT5tb2RpZmll
ciAmIEFGQkNfRk9STUFUX01PRF9CTE9DS19TSVpFX01BU0spIHsKLQljYXNlIEFGQkNfRk9STUFU
X01PRF9CTE9DS19TSVpFXzMyeDg6Ci0JCWFsaWdubWVudF93ID0gMzI7Ci0JCWFsaWdubWVudF9o
ID0gODsKLQkJYnJlYWs7Ci0JY2FzZSBBRkJDX0ZPUk1BVF9NT0RfQkxPQ0tfU0laRV8xNngxNjoK
LQkJYWxpZ25tZW50X3cgPSAxNjsKLQkJYWxpZ25tZW50X2ggPSAxNjsKLQkJYnJlYWs7Ci0JZGVm
YXVsdDoKLQkJV0FSTigxLCAiSW52YWxpZCBBRkJDX0ZPUk1BVF9NT0RfQkxPQ0tfU0laRTogJWxs
ZC5cbiIsCi0JCSAgICAgZmItPm1vZGlmaWVyICYgQUZCQ19GT1JNQVRfTU9EX0JMT0NLX1NJWkVf
TUFTSyk7Ci0JCWJyZWFrOworCWlmICghZHJtX2FmYmNfZ2V0X3N1cGVyYmxrX3doKGZiLT5tb2Rp
ZmllciwgJmFsaWdubWVudF93LCAmYWxpZ25tZW50X2gpKQorCQlyZXR1cm4gLUVJTlZBTDsKKwor
CWlmICgoYWxpZ25tZW50X3cgIT0gMTYgfHwgYWxpZ25tZW50X2ggIT0gMTYpICYmCisJICAgIChh
bGlnbm1lbnRfdyAhPSAzMiB8fCBhbGlnbm1lbnRfaCAhPSA4KSkgeworCQlEUk1fREVCVUdfS01T
KCJVbnN1cHBvcnRlZCBhZmJjIHRpbGUgdy9oIFslZC8lZF1cbiIsCisJCQkgICAgICBhbGlnbm1l
bnRfdywgYWxpZ25tZW50X2gpOworCisJCXJldHVybiAtRUlOVkFMOwogCX0KIAogCS8qIHRpbGVk
IGhlYWRlciBhZmJjICovCkBAIC04NCwyMCArODAsMTQgQEAga29tZWRhX2ZiX2FmYmNfc2l6ZV9j
aGVjayhzdHJ1Y3Qga29tZWRhX2ZiICprZmIsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJZ290
byBjaGVja19mYWlsZWQ7CiAJfQogCi0Jbl9ibG9ja3MgPSAoa2ZiLT5hbGlnbmVkX3cgKiBrZmIt
PmFsaWduZWRfaCkgLyBBRkJDX1NVUEVSQkxLX1BJWEVMUzsKLQlrZmItPm9mZnNldF9wYXlsb2Fk
ID0gQUxJR04obl9ibG9ja3MgKiBBRkJDX0hFQURFUl9TSVpFLAotCQkJCSAgICBhbGlnbm1lbnRf
aGVhZGVyKTsKLQogCWJwcCA9IGtvbWVkYV9nZXRfYWZiY19mb3JtYXRfYnBwKGluZm8sIGZiLT5t
b2RpZmllcik7Ci0Ja2ZiLT5hZmJjX3NpemUgPSBrZmItPm9mZnNldF9wYXlsb2FkICsgbl9ibG9j
a3MgKgotCQkJIEFMSUdOKGJwcCAqIEFGQkNfU1VQRVJCTEtfUElYRUxTIC8gOCwKLQkJCSAgICAg
ICBBRkJDX1NVUEVSQkxLX0FMSUdOTUVOVCk7Ci0JbWluX3NpemUgPSBrZmItPmFmYmNfc2l6ZSAr
IGZiLT5vZmZzZXRzWzBdOwotCWlmIChtaW5fc2l6ZSA+IG9iai0+c2l6ZSkgewotCQlEUk1fREVC
VUdfS01TKCJhZmJjIHNpemUgY2hlY2sgZmFpbGVkLCBvYmpfc2l6ZTogMHglenguIG1pbl9zaXpl
IDB4JWxseC5cbiIsCi0JCQkgICAgICBvYmotPnNpemUsIG1pbl9zaXplKTsKKworCWlmICghZHJt
X2FmYmNfY2hlY2tfZmJfc2l6ZShtb2RlX2NtZC0+cGl0Y2hlc1swXSwgYnBwLAorCQkJCSAgICBt
b2RlX2NtZC0+d2lkdGgsIG1vZGVfY21kLT5oZWlnaHQsCisJCQkJICAgIGFsaWdubWVudF93LCBh
bGlnbm1lbnRfaCwKKwkJCQkgICAgb2JqLT5zaXplLCBtb2RlX2NtZC0+b2Zmc2V0c1swXSwKKwkJ
CQkgICAgQUZCQ19TVVBFUkJMS19BTElHTk1FTlQpKQogCQlnb3RvIGNoZWNrX2ZhaWxlZDsKLQl9
CiAKIAlmYi0+b2JqWzBdID0gb2JqOwogCXJldHVybiAwOwotLSAKMi4xNy4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBs
aXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
