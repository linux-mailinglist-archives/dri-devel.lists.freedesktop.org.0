Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F28C8796CF
	for <lists+dri-devel@lfdr.de>; Mon, 29 Jul 2019 21:56:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ED8826E1E2;
	Mon, 29 Jul 2019 19:55:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DAC286E1D6
 for <dri-devel@lists.freedesktop.org>; Mon, 29 Jul 2019 19:55:48 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:57528
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hsBkI-0003F7-Sq; Mon, 29 Jul 2019 21:55:46 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [RFC 2/4] drm/panel/ili9341: Rebase and some more
Date: Mon, 29 Jul 2019 21:55:24 +0200
Message-Id: <20190729195526.13337-3-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190729195526.13337-1-noralf@tronnes.org>
References: <20190729195526.13337-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=Rgiy6CkOvO1Tq7ifyR6f7FdQkuWs89+QMc4LPY4uXxg=; 
 b=RJKfNbRpo0QDSS5dUTCWfQpQY4GeRoSVLQqXSsgXBysFrYJUfExXPUoNY9OnpHNR3mUMNHIKMp7kmS5Ps6unYe0ITX04tX0onJQwX16RxcrTkp6GGMZuUReLnJVYPGo9PzjHH3N90pYLZxJOdAtpZTnefJSKFGgrKZAMdyW+vRdw+F7mpbDaA0snrGzeQF0+NfwRzN4vzhVpQLKbZ9hwytlNk+YNbaQ0w1xIXBjHPHPTgKWWcPaKUwqJsBOoRpxaWzn93v/x6QrVXhQVCF1cKAjtyinFfoQCEnVP/hRG3+Tx23D/QDRFzuyFg8lkqp0wZRHhqhqUXAC4nZimsEaGng==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@ffwll.ch, josef@lusticky.cz, thierry.reding@gmail.com,
 laurent.pinchart@ideasonboard.com, sam@ravnborg.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RW1iZWQgbWlwaV9kYmkgaW4gc3RydWN0IGlsaTkzNDEuClJlYmFzZSBvbiBtb3ZlZCBtaXBpLWRi
aSwgcmVuYW1lIHZhcmlhYmxlIG5hbWUuCkFkZCBiYWNrbGlnaHRfZGV2aWNlIHRvIHBhbmVsIHN0
cnVjdC4KbWlwaV9kYmlfaHdfcmVzZXQoKSBhbHJlYWR5IGhhcyBhIE5VTEwgY2hlY2sgb24gdGhl
IHJlc2V0IGdwaW8uClByZXBhcmUgZm9yIG1vcmUgcGFuZWxzIGJ5IHJld29ya2luZyBpbGk5MzQx
X2NvbmZpZy4KClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMu
b3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1pbGl0ZWstaWxpOTM0MS5jIHwg
MTA0ICsrKysrKysrKy0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA1MiBpbnNlcnRpb25zKCsp
LCA1MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFu
ZWwtaWxpdGVrLWlsaTkzNDEuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1pbGl0ZWst
aWxpOTM0MS5jCmluZGV4IDBjNzAwYjE3MTAyNS4uYTc1NWYzZTYwMTExIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtaWxpdGVrLWlsaTkzNDEuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vcGFuZWwvcGFuZWwtaWxpdGVrLWlsaTkzNDEuYwpAQCAtMjgsNyArMjgsNyBAQAog
I2luY2x1ZGUgPGRybS9kcm1fbW9kZXMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3BhbmVsLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgotI2luY2x1ZGUgPGRybS90aW55ZHJtL21pcGktZGJp
Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9taXBpX2RiaS5oPgogCiAvKiBJTEk5MzQxIGV4dGVuZGVk
IHJlZ2lzdGVyIHNldCAoVmVuZG9yIENvbW1hbmQgU2V0KSAqLwogI2RlZmluZSBJTEk5MzQxX0lG
TU9ERSAgICAgICAgIDB4QjAgLy8gY2xvY2sgcG9sYXJpdHkKQEAgLTQyLDE3ICs0MiwxOCBAQAog
CiAvKioKICAqIHN0cnVjdCBpbGk5MzQxX2NvbmZpZyAtIHRoZSBkaXNwbGF5IHNwZWNpZmljIGNv
bmZpZ3VyYXRpb24KLSAqIEB3aWR0aF9tbTogcGh5c2ljYWwgcGFuZWwgd2lkdGggW21tXQotICog
QGhlaWdodF9tbTogcGh5c2ljYWwgcGFuZWwgaGVpZ2h0IFttbV0KKyAqIEBmdW5jczogUGFuZWwg
ZnVuY3Rpb25zCisgKiBAbW9kZTogRGlzcGxheSBtb2RlCiAgKi8KIHN0cnVjdCBpbGk5MzQxX2Nv
bmZpZyB7Ci0JdTMyIHdpZHRoX21tOwotCXUzMiBoZWlnaHRfbW07CisJY29uc3Qgc3RydWN0IGRy
bV9wYW5lbF9mdW5jcyAqZnVuY3M7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1v
ZGU7CiB9OwogCiBzdHJ1Y3QgaWxpOTM0MSB7CiAJc3RydWN0IGRybV9wYW5lbCBwYW5lbDsKLQlz
dHJ1Y3QgbWlwaV9kYmkgKm1pcGk7CisJc3RydWN0IG1pcGlfZGJpIGRiaTsKKwlzdHJ1Y3QgYmFj
a2xpZ2h0X2RldmljZSAqYmFja2xpZ2h0OwogCWNvbnN0IHN0cnVjdCBpbGk5MzQxX2NvbmZpZyAq
Y29uZjsKIH07CiAKQEAgLTYzLDQ3ICs2NCw1MCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbGk5
MzQxICpwYW5lbF90b19pbGk5MzQxKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQogCiBzdGF0aWMg
aW50IGlsaTkzNDFfZGVpbml0KHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsLCBzdHJ1Y3QgaWxpOTM0
MSAqaWxpKQogewotCW1pcGlfZGJpX2NvbW1hbmQoaWxpLT5taXBpLCBNSVBJX0RDU19TRVRfRElT
UExBWV9PRkYpOwotCW1pcGlfZGJpX2NvbW1hbmQoaWxpLT5taXBpLCBNSVBJX0RDU19FTlRFUl9T
TEVFUF9NT0RFKTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9ICZpbGktPmRiaTsKKworCW1pcGlf
ZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfRElTUExBWV9PRkYpOworCW1pcGlfZGJpX2Nv
bW1hbmQoZGJpLCBNSVBJX0RDU19FTlRFUl9TTEVFUF9NT0RFKTsKIAltc2xlZXAoNSk7CiAJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgaWxpOTM0MV9pbml0KHN0cnVjdCBkcm1fcGFuZWwgKnBh
bmVsLCBzdHJ1Y3QgaWxpOTM0MSAqaWxpKQorc3RhdGljIGludCBkdDAyNGN0ZnRfaW5pdChzdHJ1
Y3QgZHJtX3BhbmVsICpwYW5lbCwgc3RydWN0IGlsaTkzNDEgKmlsaSkKIHsKLQkvKiBIVyAvIFNX
IFJlc2V0IGRpc3BsYXkgYW5kIHdhaXQgKi8KLQlpZiAoaWxpLT5taXBpLT5yZXNldCkKLQkJbWlw
aV9kYmlfaHdfcmVzZXQoaWxpLT5taXBpKTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9ICZpbGkt
PmRiaTsKIAotCW1pcGlfZGJpX2NvbW1hbmQoaWxpLT5taXBpLCBNSVBJX0RDU19TT0ZUX1JFU0VU
KTsKKwkvKiBIVyAvIFNXIFJlc2V0IGRpc3BsYXkgYW5kIHdhaXQgKi8KKwltaXBpX2RiaV9od19y
ZXNldChkYmkpOworCisJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NPRlRfUkVTRVQp
OwogCW1zbGVlcCgxMjApOwogCiAJLyogUG9sYXJpdHkgKi8KLQltaXBpX2RiaV9jb21tYW5kKGls
aS0+bWlwaSwgSUxJOTM0MV9JRk1PREUsIDB4QzApOworCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBJ
TEk5MzQxX0lGTU9ERSwgMHhDMCk7CiAKIAkvKiBJbnRlcmZhY2UgY29udHJvbCAqLwotCW1pcGlf
ZGJpX2NvbW1hbmQoaWxpLT5taXBpLCBJTEk5MzQxX0lGQ1RMLCAweDA5LCAweDAxLCAweDI2KTsK
KwltaXBpX2RiaV9jb21tYW5kKGRiaSwgSUxJOTM0MV9JRkNUTCwgMHgwOSwgMHgwMSwgMHgyNik7
CiAKIAkvKiBQaXhlbCBmb3JtYXQgKi8KLQltaXBpX2RiaV9jb21tYW5kKGlsaS0+bWlwaSwgTUlQ
SV9EQ1NfU0VUX1BJWEVMX0ZPUk1BVCwgTUlQSV9EQ1NfUElYRUxfRk1UXzE4QklUIDw8IDQpOwor
CW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfUElYRUxfRk9STUFULCBNSVBJX0RD
U19QSVhFTF9GTVRfMThCSVQgPDwgNCk7CiAKIAkvKiBHYW1tYSAqLwotCW1pcGlfZGJpX2NvbW1h
bmQoaWxpLT5taXBpLCBNSVBJX0RDU19TRVRfR0FNTUFfQ1VSVkUsIDB4MDEpOwotCW1pcGlfZGJp
X2NvbW1hbmQoaWxpLT5taXBpLCBJTEk5MzQxX1BHQU1DVFJMLAorCW1pcGlfZGJpX2NvbW1hbmQo
ZGJpLCBNSVBJX0RDU19TRVRfR0FNTUFfQ1VSVkUsIDB4MDEpOworCW1pcGlfZGJpX2NvbW1hbmQo
ZGJpLCBJTEk5MzQxX1BHQU1DVFJMLAogCQkweDBmLCAweDMxLCAweDJiLCAweDBjLCAweDBlLCAw
eDA4LCAweDRlLCAweGYxLAogCQkweDM3LCAweDA3LCAweDEwLCAweDAzLCAweDBlLCAweDA5LCAw
eDAwKTsKLQltaXBpX2RiaV9jb21tYW5kKGlsaS0+bWlwaSwgSUxJOTM0MV9OR0FNQ1RSTCwKKwlt
aXBpX2RiaV9jb21tYW5kKGRiaSwgSUxJOTM0MV9OR0FNQ1RSTCwKIAkJMHgwMCwgMHgwZSwgMHgx
NCwgMHgwMywgMHgxMSwgMHgwNywgMHgzMSwgMHhjMSwKIAkJMHg0OCwgMHgwOCwgMHgwZiwgMHgw
YywgMHgzMSwgMHgzNiwgMHgwZik7CiAKIAkvKiBSb3RhdGlvbiAqLwotCW1pcGlfZGJpX2NvbW1h
bmQoaWxpLT5taXBpLCBNSVBJX0RDU19TRVRfQUREUkVTU19NT0RFLCBJTEk5MzQxX01BRENUTF9N
WCk7CisJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NFVF9BRERSRVNTX01PREUsIElM
STkzNDFfTUFEQ1RMX01YKTsKIAogCS8qIEV4aXQgc2xlZXAgbW9kZSAqLwotCW1pcGlfZGJpX2Nv
bW1hbmQoaWxpLT5taXBpLCBNSVBJX0RDU19FWElUX1NMRUVQX01PREUpOworCW1pcGlfZGJpX2Nv
bW1hbmQoZGJpLCBNSVBJX0RDU19FWElUX1NMRUVQX01PREUpOwogCW1zbGVlcCgxMjApOwogCi0J
bWlwaV9kYmlfY29tbWFuZChpbGktPm1pcGksIE1JUElfRENTX1NFVF9ESVNQTEFZX09OKTsKKwlt
aXBpX2RiaV9jb21tYW5kKGRiaSwgTUlQSV9EQ1NfU0VUX0RJU1BMQVlfT04pOwogCiAJcmV0dXJu
IDA7CiB9CkBAIC0xMTUsMTIgKzExOSwxMiBAQCBzdGF0aWMgaW50IGlsaTkzNDFfdW5wcmVwYXJl
KHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQogCXJldHVybiBpbGk5MzQxX2RlaW5pdChwYW5lbCwg
aWxpKTsKIH0KIAotc3RhdGljIGludCBpbGk5MzQxX3ByZXBhcmUoc3RydWN0IGRybV9wYW5lbCAq
cGFuZWwpCitzdGF0aWMgaW50IGR0MDI0Y3RmdF9wcmVwYXJlKHN0cnVjdCBkcm1fcGFuZWwgKnBh
bmVsKQogewogCXN0cnVjdCBpbGk5MzQxICppbGkgPSBwYW5lbF90b19pbGk5MzQxKHBhbmVsKTsK
IAlpbnQgcmV0OwogCi0JcmV0ID0gaWxpOTM0MV9pbml0KHBhbmVsLCBpbGkpOworCXJldCA9IGR0
MDI0Y3RmdF9pbml0KHBhbmVsLCBpbGkpOwogCWlmIChyZXQgPCAwKQogCQlpbGk5MzQxX3VucHJl
cGFyZShwYW5lbCk7CiAJcmV0dXJuIHJldDsKQEAgLTEzMCwxNCArMTM0LDE0IEBAIHN0YXRpYyBp
bnQgaWxpOTM0MV9lbmFibGUoc3RydWN0IGRybV9wYW5lbCAqcGFuZWwpCiB7CiAJc3RydWN0IGls
aTkzNDEgKmlsaSA9IHBhbmVsX3RvX2lsaTkzNDEocGFuZWwpOwogCi0JcmV0dXJuIGJhY2tsaWdo
dF9lbmFibGUoaWxpLT5taXBpLT5iYWNrbGlnaHQpOworCXJldHVybiBiYWNrbGlnaHRfZW5hYmxl
KGlsaS0+YmFja2xpZ2h0KTsKIH0KIAogc3RhdGljIGludCBpbGk5MzQxX2Rpc2FibGUoc3RydWN0
IGRybV9wYW5lbCAqcGFuZWwpCiB7CiAJc3RydWN0IGlsaTkzNDEgKmlsaSA9IHBhbmVsX3RvX2ls
aTkzNDEocGFuZWwpOwogCi0JcmV0dXJuIGJhY2tsaWdodF9kaXNhYmxlKGlsaS0+bWlwaS0+YmFj
a2xpZ2h0KTsKKwlyZXR1cm4gYmFja2xpZ2h0X2Rpc2FibGUoaWxpLT5iYWNrbGlnaHQpOwogfQog
CiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgcHJnYl8yNDB4MzIwX21vZGUg
PSB7CkBAIC0xNTQsNyArMTU4LDEwIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSBwcmdiXzI0MHgzMjBfbW9kZSA9IHsKIAkudnRvdGFsID0gMzIwICsgNCArIDIgKyAyLAog
CiAJLmZsYWdzID0gRFJNX01PREVfRkxBR19OSFNZTkMgfCBEUk1fTU9ERV9GTEFHX05WU1lOQywK
LQkudHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVSIHwgRFJNX01PREVfVFlQRV9QUkVGRVJSRUQK
KwkudHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVSIHwgRFJNX01PREVfVFlQRV9QUkVGRVJSRUQs
CisKKwkud2lkdGhfbW0gPSAzNywKKwkuaGVpZ2h0X21tID0gNDksCiB9OwogCiBzdGF0aWMgaW50
IGlsaTkzNDFfZ2V0X21vZGVzKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQpAQCAtMTYzLDcgKzE3
MCw3IEBAIHN0YXRpYyBpbnQgaWxpOTM0MV9nZXRfbW9kZXMoc3RydWN0IGRybV9wYW5lbCAqcGFu
ZWwpCiAJc3RydWN0IGlsaTkzNDEgKmlsaSA9IHBhbmVsX3RvX2lsaTkzNDEocGFuZWwpOwogCXN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlOwogCi0JbW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0
ZShwYW5lbC0+ZHJtLCAmcHJnYl8yNDB4MzIwX21vZGUpOworCW1vZGUgPSBkcm1fbW9kZV9kdXBs
aWNhdGUocGFuZWwtPmRybSwgaWxpLT5jb25mLT5tb2RlKTsKIAlpZiAoIW1vZGUpIHsKIAkJRFJN
X0RFVl9FUlJPUihwYW5lbC0+ZHJtLT5kZXYsICJiYWQgbW9kZSBvciBmYWlsZWQgdG8gYWRkIG1v
ZGVcbiIpOwogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTE3MSw5ICsxNzgsNiBAQCBzdGF0aWMgaW50
IGlsaTkzNDFfZ2V0X21vZGVzKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQogCiAJZHJtX21vZGVf
c2V0X25hbWUobW9kZSk7CiAKLQltb2RlLT53aWR0aF9tbSA9IGlsaS0+Y29uZi0+d2lkdGhfbW07
Ci0JbW9kZS0+aGVpZ2h0X21tID0gaWxpLT5jb25mLT5oZWlnaHRfbW07Ci0KIAljb25uZWN0b3It
PmRpc3BsYXlfaW5mby53aWR0aF9tbSA9IG1vZGUtPndpZHRoX21tOwogCWNvbm5lY3Rvci0+ZGlz
cGxheV9pbmZvLmhlaWdodF9tbSA9IG1vZGUtPmhlaWdodF9tbTsKIAljb25uZWN0b3ItPmRpc3Bs
YXlfaW5mby5idXNfZmxhZ3MgfD0gRFJNX0JVU19GTEFHX0RFX0hJR0ggfApAQCAtMTg0LDMxICsx
ODgsMzIgQEAgc3RhdGljIGludCBpbGk5MzQxX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX3BhbmVsICpw
YW5lbCkKIAlyZXR1cm4gMTsgLyogTnVtYmVyIG9mIG1vZGVzICovCiB9CiAKLXN0YXRpYyBjb25z
dCBzdHJ1Y3QgZHJtX3BhbmVsX2Z1bmNzIGlsaTkzNDFfZHJtX2Z1bmNzID0geworc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fcGFuZWxfZnVuY3MgZHQwMjRjdGZ0X2RybV9mdW5jcyA9IHsKIAkuZGlz
YWJsZSA9IGlsaTkzNDFfZGlzYWJsZSwKIAkudW5wcmVwYXJlID0gaWxpOTM0MV91bnByZXBhcmUs
Ci0JLnByZXBhcmUgPSBpbGk5MzQxX3ByZXBhcmUsCisJLnByZXBhcmUgPSBkdDAyNGN0ZnRfcHJl
cGFyZSwKIAkuZW5hYmxlID0gaWxpOTM0MV9lbmFibGUsCiAJLmdldF9tb2RlcyA9IGlsaTkzNDFf
Z2V0X21vZGVzLAogfTsKIAorc3RhdGljIGNvbnN0IHN0cnVjdCBpbGk5MzQxX2NvbmZpZyBkdDAy
NGN0ZnRfZGF0YSA9IHsKKwkuZnVuY3MgPSAmZHQwMjRjdGZ0X2RybV9mdW5jcywKKwkubW9kZSA9
ICZwcmdiXzI0MHgzMjBfbW9kZSwKK307CisKIHN0YXRpYyBpbnQgaWxpOTM0MV9wcm9iZShzdHJ1
Y3Qgc3BpX2RldmljZSAqc3BpKQogewogCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZzcGktPmRldjsK
IAlzdHJ1Y3QgaWxpOTM0MSAqaWxpOwotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaTsKKwlzdHJ1Y3Qg
bWlwaV9kYmkgKmRiaTsKIAlzdHJ1Y3QgZ3Bpb19kZXNjICpkY19ncGlvOwogCWludCByZXQ7CiAK
LQltaXBpID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9mKCptaXBpKSwgR0ZQX0tFUk5FTCk7Ci0J
aWYgKCFtaXBpKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCWlsaSA9IGRldm1fa3phbGxvYyhkZXYs
IHNpemVvZigqaWxpKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFpbGkpCiAJCXJldHVybiAtRU5PTUVN
OwogCi0JaWxpLT5taXBpID0gbWlwaTsKKwlkYmkgPSAmaWxpLT5kYmk7CiAKIAlzcGlfc2V0X2Ry
dmRhdGEoc3BpLCBpbGkpOwogCkBAIC0yMjIsMTYgKzIyNywxNiBAQCBzdGF0aWMgaW50IGlsaTkz
NDFfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAJfQog
Ci0JaWxpLT5taXBpLT5yZXNldCA9IGRldm1fZ3Bpb2RfZ2V0X29wdGlvbmFsKGRldiwgInJlc2V0
IiwgR1BJT0RfT1VUX0hJR0gpOwotCWlmIChJU19FUlIoaWxpLT5taXBpLT5yZXNldCkpIHsKKwlk
YmktPnJlc2V0ID0gZGV2bV9ncGlvZF9nZXRfb3B0aW9uYWwoZGV2LCAicmVzZXQiLCBHUElPRF9P
VVRfSElHSCk7CisJaWYgKElTX0VSUihkYmktPnJlc2V0KSkgewogCQlEUk1fREVWX0VSUk9SKGRl
diwgImZhaWxlZCB0byBnZXQgZ3BpbyAncmVzZXQnXG4iKTsKLQkJcmV0dXJuIFBUUl9FUlIoaWxp
LT5taXBpLT5yZXNldCk7CisJCXJldHVybiBQVFJfRVJSKGRiaS0+cmVzZXQpOwogCX0KIAotCWls
aS0+bWlwaS0+YmFja2xpZ2h0ID0gZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYpOwotCWlmIChJ
U19FUlIoaWxpLT5taXBpLT5iYWNrbGlnaHQpKSB7CisJaWxpLT5iYWNrbGlnaHQgPSBkZXZtX29m
X2ZpbmRfYmFja2xpZ2h0KGRldik7CisJaWYgKElTX0VSUihpbGktPmJhY2tsaWdodCkpIHsKIAkJ
RFJNX0RFVl9FUlJPUihkZXYsICJmYWlsZWQgdG8gZ2V0IGJhY2tsaWdodFxuIik7Ci0JCXJldHVy
biBQVFJfRVJSKGlsaS0+bWlwaS0+YmFja2xpZ2h0KTsKKwkJcmV0dXJuIFBUUl9FUlIoaWxpLT5i
YWNrbGlnaHQpOwogCX0KIAogCWRjX2dwaW8gPSBkZXZtX2dwaW9kX2dldF9vcHRpb25hbChkZXYs
ICJkYyIsIEdQSU9EX09VVF9MT1cpOwpAQCAtMjQwLDcgKzI0NSw3IEBAIHN0YXRpYyBpbnQgaWxp
OTM0MV9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCQlyZXR1cm4gUFRSX0VSUihkY19n
cGlvKTsKIAl9CiAKLQlyZXQgPSBtaXBpX2RiaV9zcGlfaW5pdChzcGksIGlsaS0+bWlwaSwgZGNf
Z3Bpbyk7CisJcmV0ID0gbWlwaV9kYmlfc3BpX2luaXQoc3BpLCBkYmksIGRjX2dwaW8pOwogCWlm
IChyZXQpIHsKIAkJRFJNX0RFVl9FUlJPUihkZXYsICJNSVBJLURCSSBTUEkgc2V0dXAgZmFpbGVk
XG4iKTsKIAkJcmV0dXJuIHJldDsKQEAgLTI0OCw3ICsyNTMsNyBAQCBzdGF0aWMgaW50IGlsaTkz
NDFfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSkKIAogCWRybV9wYW5lbF9pbml0KCZpbGkt
PnBhbmVsKTsKIAlpbGktPnBhbmVsLmRldiA9IGRldjsKLQlpbGktPnBhbmVsLmZ1bmNzID0gJmls
aTkzNDFfZHJtX2Z1bmNzOworCWlsaS0+cGFuZWwuZnVuY3MgPSBpbGktPmNvbmYtPmZ1bmNzOwog
CiAJcmV0dXJuIGRybV9wYW5lbF9hZGQoJmlsaS0+cGFuZWwpOwogfQpAQCAtMjY1LDExICsyNzAs
NiBAQCBzdGF0aWMgaW50IGlsaTkzNDFfcmVtb3ZlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWxpOTM0MV9jb25maWcgZHQwMjRj
dGZ0X2RhdGEgPSB7Ci0JLndpZHRoX21tID0gMzcsCi0JLmhlaWdodF9tbSA9IDQ5LAotfTsKLQog
c3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgaWxpOTM0MV9vZl9tYXRjaFtdID0gewog
CXsgLmNvbXBhdGlibGUgPSAiZGlzcGxheXRlY2gsZHQwMjRjdGZ0IiwgLmRhdGEgPSAmZHQwMjRj
dGZ0X2RhdGEgfSwKIAl7IC8qIHNlbnRpbmVsICovIH0KLS0gCjIuMjAuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
