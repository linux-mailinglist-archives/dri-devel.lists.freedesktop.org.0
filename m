Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6CD9749127
	for <lists+dri-devel@lfdr.de>; Mon, 17 Jun 2019 22:18:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6829F89F49;
	Mon, 17 Jun 2019 20:18:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa1.bahnhof.se (ste-pvt-msa1.bahnhof.se
 [213.80.101.70])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4AA8F89F49
 for <dri-devel@lists.freedesktop.org>; Mon, 17 Jun 2019 20:18:17 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTP id 5C4A8473F1;
 Mon, 17 Jun 2019 22:18:15 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -3.099
X-Spam-Level: 
X-Spam-Status: No, score=-3.099 tagged_above=-999 required=6.31
 tests=[ALL_TRUSTED=-1, BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 URIBL_BLOCKED=0.001] autolearn=ham autolearn_force=no
Received: from ste-pvt-msa1.bahnhof.se ([127.0.0.1])
 by localhost (ste-pvt-msa1.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 40tC5uFNlIuC; Mon, 17 Jun 2019 22:18:05 +0200 (CEST)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTPA id 8175B3F44D;
 Mon, 17 Jun 2019 22:18:05 +0200 (CEST)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 461D83619AF;
 Mon, 17 Jun 2019 22:18:05 +0200 (CEST)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?= <thomas@shipmail.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 5/9] drm/ttm: TTM fault handler helpers
Date: Mon, 17 Jun 2019 22:17:52 +0200
Message-Id: <20190617201756.12587-6-thomas@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617201756.12587-1-thomas@shipmail.org>
References: <20190617201756.12587-1-thomas@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1560802685; bh=ie7P8PRlXqjA4Uc3shR6h+sNX2ALI0R/o0+jtHbiHio=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=grwMh90OEut1ZO8z4sX/z8djL9NXIYGjYJaqK/PZBno6BlePLMfC4/8ejgZAhUMyf
 owkhqKTo/i4x+ZxpwKxWZudhKCzq0EI7tLBbdmkLq2OzU7vElJDzqaoo3Zof2h061p
 oui8cleX0SjiWxOhedHzVyZga/6865bPGXek+P4U=
X-Mailman-Original-Authentication-Results: ste-pvt-msa1.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=grwMh90O; 
 dkim-atps=neutral
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pv-drivers@vmware.com, linux-graphics-maintainer@vmware.com,
 linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKV2l0aCB0aGUg
dm13Z2Z4IGRpcnR5IHRyYWNraW5nLCB0aGUgZGVmYXVsdCBUVE0gZmF1bHQgaGFuZGxlciBpcyBu
b3QKY29tcGxldGVseSBzdWZmaWNpZW50ICh2bXdnZnggbmVlZCB0byBtb2RpZnkgdGhlIHZtYS0+
dm1fZmxhZ3MgbWVtYmVyLAphbmQgYWxzbyBuZWVkcyB0byByZXN0cmljdCB0aGUgbnVtYmVyIG9m
IHByZWZhdWx0cykuCgpXZSBhbHNvIHdhbnQgdG8gcmVwbGljYXRlIHRoZSBuZXcgdHRtX2JvX3Zt
X3Jlc2VydmUoKSBmdW5jdGlvbmFsaXR5CgpTbyBzdGFydCB0dXJuaW5nIHRoZSBUVE0gdm0gY29k
ZSBpbnRvIGhlbHBlcnM6IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZCgpCmFuZCB0dG1fYm9fdm1f
cmVzZXJ2ZSgpLCBhbmQgcHJvdmlkZSBhIGRlZmF1bHQgVFRNIGZhdWx0IGhhbmRsZXIgZm9yIG90
aGVyCmRyaXZlcnMgdG8gdXNlLgoKQ2M6ICJDaHJpc3RpYW4gS8O2bmlnIiA8Y2hyaXN0aWFuLmtv
ZW5pZ0BhbWQuY29tPgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJv
bUB2bXdhcmUuY29tPgpSZXZpZXdlZC1ieTogIkNocmlzdGlhbiBLw7ZuaWciIDxjaHJpc3RpYW4u
a29lbmlnQGFtZC5jb20+ICN2MQotLS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMg
fCAxNjMgKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KIGluY2x1ZGUvZHJtL3R0bS90
dG1fYm9fYXBpLmggICAgfCAgMTAgKysKIDIgZmlsZXMgY2hhbmdlZCwgMTExIGluc2VydGlvbnMo
KyksIDYyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRt
X2JvX3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib192bS5jCmluZGV4IDE5NmUxM2Ew
YWRhZC4uMGM0NTc2Y2JhZmNmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9i
b192bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKQEAgLTQyLDggKzQy
LDYgQEAKICNpbmNsdWRlIDxsaW51eC91YWNjZXNzLmg+CiAjaW5jbHVkZSA8bGludXgvbWVtX2Vu
Y3J5cHQuaD4KIAotI2RlZmluZSBUVE1fQk9fVk1fTlVNX1BSRUZBVUxUIDE2Ci0KIHN0YXRpYyB2
bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9pZGxlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sCiAJCQkJc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiB7CkBAIC0xMDYsMjUgKzEwNCwzMCBAQCBz
dGF0aWMgdW5zaWduZWQgbG9uZyB0dG1fYm9faW9fbWVtX3BmbihzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvLAogCQkrIHBhZ2Vfb2Zmc2V0OwogfQogCi1zdGF0aWMgdm1fZmF1bHRfdCB0dG1f
Ym9fdm1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCisvKioKKyAqIHR0bV9ib192bV9yZXNl
cnZlIC0gUmVzZXJ2ZSBhIGJ1ZmZlciBvYmplY3QgaW4gYSByZXRyeWFibGUgdm0gY2FsbGJhY2sK
KyAqIEBibzogVGhlIGJ1ZmZlciBvYmplY3QKKyAqIEB2bWY6IFRoZSBmYXVsdCBzdHJ1Y3R1cmUg
aGFuZGVkIHRvIHRoZSBjYWxsYmFjaworICoKKyAqIHZtIGNhbGxiYWNrcyBsaWtlIGZhdWx0KCkg
YW5kICpfbWt3cml0ZSgpIGFsbG93IGZvciB0aGUgbW1fc2VtIHRvIGJlIGRyb3BwZWQKKyAqIGR1
cmluZyBsb25nIHdhaXRzLCBhbmQgYWZ0ZXIgdGhlIHdhaXQgdGhlIGNhbGxiYWNrIHdpbGwgYmUg
cmVzdGFydGVkLiBUaGlzCisgKiBpcyB0byBhbGxvdyBvdGhlciB0aHJlYWRzIHVzaW5nIHRoZSBz
YW1lIHZpcnR1YWwgbWVtb3J5IHNwYWNlIGNvbmN1cnJlbnQKKyAqIGFjY2VzcyB0byBtYXAoKSwg
dW5tYXAoKSBjb21wbGV0ZWx5IHVucmVsYXRlZCBidWZmZXIgb2JqZWN0cy4gVFRNIGJ1ZmZlcgor
ICogb2JqZWN0IHJlc2VydmF0aW9ucyBzb21ldGltZXMgd2FpdCBmb3IgR1BVIGFuZCBzaG91bGQg
dGhlcmVmb3JlIGJlCisgKiBjb25zaWRlcmVkIGxvbmcgd2FpdHMuIFRoaXMgZnVuY3Rpb24gcmVz
ZXJ2ZXMgdGhlIGJ1ZmZlciBvYmplY3QgaW50ZXJydXB0aWJseQorICogdGFraW5nIHRoaXMgaW50
byBhY2NvdW50LiBTdGFydmF0aW9uIGlzIGF2b2lkZWQgYnkgdGhlIHZtIHN5c3RlbSBub3QKKyAq
IGFsbG93aW5nIHRvbyBtYW55IHJlcGVhdGVkIHJlc3RhcnRzLgorICogVGhpcyBmdW5jdGlvbiBp
cyBpbnRlbmRlZCB0byBiZSB1c2VkIGluIGN1c3RvbWl6ZWQgZmF1bHQoKSBhbmQgX21rd3JpdGUo
KQorICogaGFuZGxlcnMuCisgKgorICogUmV0dXJuOgorICogICAgMCBvbiBzdWNjZXNzIGFuZCB0
aGUgYm8gd2FzIHJlc2VydmVkLgorICogICAgVk1fRkFVTFRfUkVUUlkgaWYgYmxvY2tpbmcgd2Fp
dC4KKyAqICAgIFZNX0ZBVUxUX05PUEFHRSBpZiBibG9ja2luZyB3YWl0IGFuZCByZXRyeWluZyB3
YXMgbm90IGFsbG93ZWQuCisgKi8KK3ZtX2ZhdWx0X3QgdHRtX2JvX3ZtX3Jlc2VydmUoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibywKKwkJCSAgICAgc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiB7
Ci0Jc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKLQlzdHJ1Y3QgdHRtX2J1
ZmZlcl9vYmplY3QgKmJvID0gKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKQotCSAgICB2bWEt
PnZtX3ByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9IGJvLT5iZGV2
OwotCXVuc2lnbmVkIGxvbmcgcGFnZV9vZmZzZXQ7Ci0JdW5zaWduZWQgbG9uZyBwYWdlX2xhc3Q7
Ci0JdW5zaWduZWQgbG9uZyBwZm47Ci0Jc3RydWN0IHR0bV90dCAqdHRtID0gTlVMTDsKLQlzdHJ1
Y3QgcGFnZSAqcGFnZTsKLQlpbnQgZXJyOwotCWludCBpOwotCXZtX2ZhdWx0X3QgcmV0ID0gVk1f
RkFVTFRfTk9QQUdFOwotCXVuc2lnbmVkIGxvbmcgYWRkcmVzcyA9IHZtZi0+YWRkcmVzczsKLQlz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9Ci0JCSZiZGV2LT5tYW5bYm8tPm1lbS5t
ZW1fdHlwZV07Ci0Jc3RydWN0IHZtX2FyZWFfc3RydWN0IGN2bWE7Ci0KIAkvKgogCSAqIFdvcmsg
YXJvdW5kIGxvY2tpbmcgb3JkZXIgcmV2ZXJzYWwgaW4gZmF1bHQgLyBub3BmbgogCSAqIGJldHdl
ZW4gbW1hcF9zZW0gYW5kIGJvX3Jlc2VydmU6IFBlcmZvcm0gYSB0cnlsb2NrIG9wZXJhdGlvbgpA
QCAtMTUxLDE0ICsxNTQsNTUgQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0
cnVjdCB2bV9mYXVsdCAqdm1mKQogCQlyZXR1cm4gVk1fRkFVTFRfTk9QQUdFOwogCX0KIAorCXJl
dHVybiAwOworfQorRVhQT1JUX1NZTUJPTCh0dG1fYm9fdm1fcmVzZXJ2ZSk7CisKKy8qKgorICog
dHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkIC0gVFRNIGZhdWx0IGhlbHBlcgorICogQHZtZjogVGhl
IHN0cnVjdCB2bV9mYXVsdCBnaXZlbiBhcyBhcmd1bWVudCB0byB0aGUgZmF1bHQgY2FsbGJhY2sK
KyAqIEBwcm90OiBUaGUgcGFnZSBwcm90ZWN0aW9uIHRvIGJlIHVzZWQgZm9yIHRoaXMgbWVtb3J5
IGFyZWEuCisgKiBAbnVtX3ByZWZhdWx0OiBNYXhpbXVtIG51bWJlciBvZiBwcmVmYXVsdCBwYWdl
cy4gVGhlIGNhbGxlciBtYXkgd2FudCB0bworICogc3BlY2lmeSB0aGlzIGJhc2VkIG9uIG1hZHZp
Y2Ugc2V0dGluZ3MgYW5kIHRoZSBzaXplIG9mIHRoZSBHUFUgb2JqZWN0CisgKiBiYWNrZWQgYnkg
dGhlIG1lbW9yeS4KKyAqCisgKiBUaGlzIGZ1bmN0aW9uIGluc2VydHMgb25lIG9yIG1vcmUgcGFn
ZSB0YWJsZSBlbnRyaWVzIHBvaW50aW5nIHRvIHRoZQorICogbWVtb3J5IGJhY2tpbmcgdGhlIGJ1
ZmZlciBvYmplY3QsIGFuZCB0aGVuIHJldHVybnMgYSByZXR1cm4gY29kZQorICogaW5zdHJ1Y3Rp
bmcgdGhlIGNhbGxlciB0byByZXRyeSB0aGUgcGFnZSBhY2Nlc3MuCisgKgorICogUmV0dXJuOgor
ICogICBWTV9GQVVMVF9OT1BBR0Ugb24gc3VjY2VzcyBvciBwZW5kaW5nIHNpZ25hbAorICogICBW
TV9GQVVMVF9TSUdCVVMgb24gdW5zcGVjaWZpZWQgZXJyb3IKKyAqICAgVk1fRkFVTFRfT09NIG9u
IG91dC1vZi1tZW1vcnkKKyAqICAgVk1fRkFVTFRfUkVUUlkgaWYgcmV0cnlhYmxlIHdhaXQKKyAq
Lwordm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQoc3RydWN0IHZtX2ZhdWx0ICp2
bWYsCisJCQkJICAgIHBncHJvdF90IHByb3QsCisJCQkJICAgIHBnb2ZmX3QgbnVtX3ByZWZhdWx0
KQoreworCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hID0gdm1mLT52bWE7CisJc3RydWN0IHZt
X2FyZWFfc3RydWN0IGN2bWEgPSAqdm1hOworCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8g
PSAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopCisJICAgIHZtYS0+dm1fcHJpdmF0ZV9kYXRh
OworCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2ID0gYm8tPmJkZXY7CisJdW5zaWduZWQgbG9u
ZyBwYWdlX29mZnNldDsKKwl1bnNpZ25lZCBsb25nIHBhZ2VfbGFzdDsKKwl1bnNpZ25lZCBsb25n
IHBmbjsKKwlzdHJ1Y3QgdHRtX3R0ICp0dG0gPSBOVUxMOworCXN0cnVjdCBwYWdlICpwYWdlOwor
CWludCBlcnI7CisJcGdvZmZfdCBpOworCXZtX2ZhdWx0X3QgcmV0ID0gVk1fRkFVTFRfTk9QQUdF
OworCXVuc2lnbmVkIGxvbmcgYWRkcmVzcyA9IHZtZi0+YWRkcmVzczsKKwlzdHJ1Y3QgdHRtX21l
bV90eXBlX21hbmFnZXIgKm1hbiA9CisJCSZiZGV2LT5tYW5bYm8tPm1lbS5tZW1fdHlwZV07CisK
IAkvKgogCSAqIFJlZnVzZSB0byBmYXVsdCBpbXBvcnRlZCBwYWdlcy4gVGhpcyBzaG91bGQgYmUg
aGFuZGxlZAogCSAqIChpZiBhdCBhbGwpIGJ5IHJlZGlyZWN0aW5nIG1tYXAgdG8gdGhlIGV4cG9y
dGVyLgogCSAqLwotCWlmIChiby0+dHRtICYmIChiby0+dHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BB
R0VfRkxBR19TRykpIHsKLQkJcmV0ID0gVk1fRkFVTFRfU0lHQlVTOwotCQlnb3RvIG91dF91bmxv
Y2s7Ci0JfQorCWlmIChiby0+dHRtICYmIChiby0+dHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0Vf
RkxBR19TRykpCisJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CiAKIAlpZiAoYmRldi0+ZHJpdmVy
LT5mYXVsdF9yZXNlcnZlX25vdGlmeSkgewogCQlzdHJ1Y3QgZG1hX2ZlbmNlICptb3ZpbmcgPSBk
bWFfZmVuY2VfZ2V0KGJvLT5tb3ZpbmcpOwpAQCAtMTY5LDExICsyMTMsOSBAQCBzdGF0aWMgdm1f
ZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCQlicmVhazsK
IAkJY2FzZSAtRUJVU1k6CiAJCWNhc2UgLUVSRVNUQVJUU1lTOgotCQkJcmV0ID0gVk1fRkFVTFRf
Tk9QQUdFOwotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0dXJuIFZNX0ZBVUxUX05PUEFHRTsK
IAkJZGVmYXVsdDoKLQkJCXJldCA9IFZNX0ZBVUxUX1NJR0JVUzsKLQkJCWdvdG8gb3V0X3VubG9j
azsKKwkJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CiAJCX0KIAogCQlpZiAoYm8tPm1vdmluZyAh
PSBtb3ZpbmcpIHsKQEAgLTE4OSwyMSArMjMxLDEyIEBAIHN0YXRpYyB2bV9mYXVsdF90IHR0bV9i
b192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkgKiBtb3ZlLgogCSAqLwogCXJldCA9
IHR0bV9ib192bV9mYXVsdF9pZGxlKGJvLCB2bWYpOwotCWlmICh1bmxpa2VseShyZXQgIT0gMCkp
IHsKLQkJaWYgKHJldCA9PSBWTV9GQVVMVF9SRVRSWSAmJgotCQkgICAgISh2bWYtPmZsYWdzICYg
RkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKSB7Ci0JCQkvKiBUaGUgQk8gaGFzIGFscmVhZHkgYmVl
biB1bnJlc2VydmVkLiAqLwotCQkJcmV0dXJuIHJldDsKLQkJfQotCi0JCWdvdG8gb3V0X3VubG9j
azsKLQl9CisJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkKKwkJcmV0dXJuIHJldDsKIAogCWVyciA9
IHR0bV9tZW1faW9fbG9jayhtYW4sIHRydWUpOwotCWlmICh1bmxpa2VseShlcnIgIT0gMCkpIHsK
LQkJcmV0ID0gVk1fRkFVTFRfTk9QQUdFOwotCQlnb3RvIG91dF91bmxvY2s7Ci0JfQorCWlmICh1
bmxpa2VseShlcnIgIT0gMCkpCisJCXJldHVybiBWTV9GQVVMVF9OT1BBR0U7CiAJZXJyID0gdHRt
X21lbV9pb19yZXNlcnZlX3ZtKGJvKTsKIAlpZiAodW5saWtlbHkoZXJyICE9IDApKSB7CiAJCXJl
dCA9IFZNX0ZBVUxUX1NJR0JVUzsKQEAgLTIyMCwxOCArMjUzLDggQEAgc3RhdGljIHZtX2ZhdWx0
X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQlnb3RvIG91dF9pb191
bmxvY2s7CiAJfQogCi0JLyoKLQkgKiBNYWtlIGEgbG9jYWwgdm1hIGNvcHkgdG8gbW9kaWZ5IHRo
ZSBwYWdlX3Byb3QgbWVtYmVyCi0JICogYW5kIHZtX2ZsYWdzIGlmIG5lY2Vzc2FyeS4gVGhlIHZt
YSBwYXJhbWV0ZXIgaXMgcHJvdGVjdGVkCi0JICogYnkgbW1hcF9zZW0gaW4gd3JpdGUgbW9kZS4K
LQkgKi8KLQljdm1hID0gKnZtYTsKLQljdm1hLnZtX3BhZ2VfcHJvdCA9IHZtX2dldF9wYWdlX3By
b3QoY3ZtYS52bV9mbGFncyk7Ci0KLQlpZiAoYm8tPm1lbS5idXMuaXNfaW9tZW0pIHsKLQkJY3Zt
YS52bV9wYWdlX3Byb3QgPSB0dG1faW9fcHJvdChiby0+bWVtLnBsYWNlbWVudCwKLQkJCQkJCWN2
bWEudm1fcGFnZV9wcm90KTsKLQl9IGVsc2UgeworCWN2bWEudm1fcGFnZV9wcm90ID0gdHRtX2lv
X3Byb3QoYm8tPm1lbS5wbGFjZW1lbnQsIHByb3QpOworCWlmICghYm8tPm1lbS5idXMuaXNfaW9t
ZW0pIHsKIAkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsKIAkJCS5pbnRlcnJ1cHRp
YmxlID0gZmFsc2UsCiAJCQkubm9fd2FpdF9ncHUgPSBmYWxzZSwKQEAgLTI0MCwyNCArMjYzLDIx
IEBAIHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZt
ZikKIAkJfTsKIAogCQl0dG0gPSBiby0+dHRtOwotCQljdm1hLnZtX3BhZ2VfcHJvdCA9IHR0bV9p
b19wcm90KGJvLT5tZW0ucGxhY2VtZW50LAotCQkJCQkJY3ZtYS52bV9wYWdlX3Byb3QpOwotCi0J
CS8qIEFsbG9jYXRlIGFsbCBwYWdlIGF0IG9uY2UsIG1vc3QgY29tbW9uIHVzYWdlICovCi0JCWlm
ICh0dG1fdHRfcG9wdWxhdGUodHRtLCAmY3R4KSkgeworCQlpZiAodHRtX3R0X3BvcHVsYXRlKGJv
LT50dG0sICZjdHgpKSB7CiAJCQlyZXQgPSBWTV9GQVVMVF9PT007CiAJCQlnb3RvIG91dF9pb191
bmxvY2s7CiAJCX0KKwl9IGVsc2UgeworCQkvKiBJb21lbSBzaG91bGQgbm90IGJlIG1hcmtlZCBl
bmNyeXB0ZWQgKi8KKwkJY3ZtYS52bV9wYWdlX3Byb3QgPSBwZ3Byb3RfZGVjcnlwdGVkKGN2bWEu
dm1fcGFnZV9wcm90KTsKIAl9CiAKIAkvKgogCSAqIFNwZWN1bGF0aXZlbHkgcHJlZmF1bHQgYSBu
dW1iZXIgb2YgcGFnZXMuIE9ubHkgZXJyb3Igb24KIAkgKiBmaXJzdCBwYWdlLgogCSAqLwotCWZv
ciAoaSA9IDA7IGkgPCBUVE1fQk9fVk1fTlVNX1BSRUZBVUxUOyArK2kpIHsKKwlmb3IgKGkgPSAw
OyBpIDwgbnVtX3ByZWZhdWx0OyArK2kpIHsKIAkJaWYgKGJvLT5tZW0uYnVzLmlzX2lvbWVtKSB7
Ci0JCQkvKiBJb21lbSBzaG91bGQgbm90IGJlIG1hcmtlZCBlbmNyeXB0ZWQgKi8KLQkJCWN2bWEu
dm1fcGFnZV9wcm90ID0gcGdwcm90X2RlY3J5cHRlZChjdm1hLnZtX3BhZ2VfcHJvdCk7CiAJCQlw
Zm4gPSB0dG1fYm9faW9fbWVtX3BmbihibywgcGFnZV9vZmZzZXQpOwogCQl9IGVsc2UgewogCQkJ
cGFnZSA9IHR0bS0+cGFnZXNbcGFnZV9vZmZzZXRdOwpAQCAtMjk1LDcgKzMxNSwyNiBAQCBzdGF0
aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJcmV0
ID0gVk1fRkFVTFRfTk9QQUdFOwogb3V0X2lvX3VubG9jazoKIAl0dG1fbWVtX2lvX3VubG9jayht
YW4pOwotb3V0X3VubG9jazoKKwlyZXR1cm4gcmV0OworfQorRVhQT1JUX1NZTUJPTCh0dG1fYm9f
dm1fZmF1bHRfcmVzZXJ2ZWQpOworCitzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQo
c3RydWN0IHZtX2ZhdWx0ICp2bWYpCit7CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2
bWYtPnZtYTsKKwlwZ3Byb3RfdCBwcm90OworCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8g
PSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKKwl2bV9mYXVsdF90IHJldDsKKworCXJldCA9IHR0bV9i
b192bV9yZXNlcnZlKGJvLCB2bWYpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlwcm90
ID0gdm1fZ2V0X3BhZ2VfcHJvdCh2bWEtPnZtX2ZsYWdzKTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1
bHRfcmVzZXJ2ZWQodm1mLCBwcm90LCBUVE1fQk9fVk1fTlVNX1BSRUZBVUxUKTsKKwlpZiAocmV0
ID09IFZNX0ZBVUxUX1JFVFJZICYmICEodm1mLT5mbGFncyAmIEZBVUxUX0ZMQUdfUkVUUllfTk9X
QUlUKSkKKwkJcmV0dXJuIHJldDsKKwogCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYm8tPnJl
c3YpOwogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2Jv
X2FwaS5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRleCA0OWQ5Y2RmYzU4ZjIu
LjQzNWQwMmY3MTlhOCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAor
KysgYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCkBAIC03NjgsNCArNzY4LDE0IEBAIGlu
dCB0dG1fYm9fc3dhcG91dChzdHJ1Y3QgdHRtX2JvX2dsb2JhbCAqZ2xvYiwKIAkJCXN0cnVjdCB0
dG1fb3BlcmF0aW9uX2N0eCAqY3R4KTsKIHZvaWQgdHRtX2JvX3N3YXBvdXRfYWxsKHN0cnVjdCB0
dG1fYm9fZGV2aWNlICpiZGV2KTsKIGludCB0dG1fYm9fd2FpdF91bnJlc2VydmVkKHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8pOworCisvKiBEZWZhdWx0IG51bWJlciBvZiBwcmUtZmF1bHRl
ZCBwYWdlcyBpbiB0aGUgVFRNIGZhdWx0IGhhbmRsZXIgKi8KKyNkZWZpbmUgVFRNX0JPX1ZNX05V
TV9QUkVGQVVMVCAxNgorCit2bV9mYXVsdF90IHR0bV9ib192bV9yZXNlcnZlKHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8sCisJCQkgICAgIHN0cnVjdCB2bV9mYXVsdCAqdm1mKTsKKwordm1f
ZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQoc3RydWN0IHZtX2ZhdWx0ICp2bWYsCisJ
CQkJICAgIHBncHJvdF90IHByb3QsCisJCQkJICAgIHBnb2ZmX3QgbnVtX3ByZWZhdWx0KTsKICNl
bmRpZgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
