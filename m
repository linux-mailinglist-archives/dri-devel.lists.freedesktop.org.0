Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A5E05B4DEA
	for <lists+dri-devel@lfdr.de>; Tue, 17 Sep 2019 14:38:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A2F186EC3F;
	Tue, 17 Sep 2019 12:38:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x541.google.com (mail-ed1-x541.google.com
 [IPv6:2a00:1450:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C6CC66EC3F
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Sep 2019 12:38:21 +0000 (UTC)
Received: by mail-ed1-x541.google.com with SMTP id p2so3135358edx.11
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Sep 2019 05:38:21 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:date:from:to:cc:subject:message-id
 :mail-followup-to:references:mime-version:content-disposition
 :in-reply-to:user-agent;
 bh=fH6+7o6syLPR5DJ6dWMuF/JhEQdUQSof99mG97G17Lc=;
 b=kbKtLWUfR6nrhEK/dZhPZ2OKGrrVGg8NCiaqnuSzfEoFHVuFEkxm9j0iFbSBPJPaxz
 H8i/BJGM/Rg6oGCzE/wpfCyR+WC3Oh2dsRU0DC0VkS1Kd59Gnb4bkN0ukGCA368UpPco
 eQgDmb5KNtShDZlxampii4pa6g/IgF7ZgcNdylF1lxEozS48Q3LctFmLq4odfk3O9deW
 5W+Rg0Nq6/Yf/2wmsnuf7sMEMxJVBtC8eUzSFHU1NVfBN5AdYYRE83seLntBRGgrKM47
 wM+R3sgQEIY2TlP6nfJNRHMzbNwwVflmmyKL07/Ttrwgvc/5uu46R18BrkWWZy6kydpQ
 IwDg==
X-Gm-Message-State: APjAAAXFV5neKbZEgBfBWivNIROzlwtRNxz7UuQVG6jqmb/Xv+Qj1iwG
 31KJRHZf4nO8rF0yh0ovFaw81w==
X-Google-Smtp-Source: APXvYqwBU1dsPChIDGRc3R9W2EEapfs3WzNcvzVlPYxnGXDgQG7xfszeXgYUPZzJ79foYSp0UpwCFw==
X-Received: by 2002:a17:906:1941:: with SMTP id
 b1mr4432288eje.141.1568723900313; 
 Tue, 17 Sep 2019 05:38:20 -0700 (PDT)
Received: from phenom.ffwll.local (212-51-149-96.fiber7.init7.net.
 [212.51.149.96])
 by smtp.gmail.com with ESMTPSA id c21sm409131edy.70.2019.09.17.05.38.19
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 17 Sep 2019 05:38:19 -0700 (PDT)
Date: Tue, 17 Sep 2019 14:38:17 +0200
From: Daniel Vetter <daniel@ffwll.ch>
To: Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>
Subject: Re: [PATCH] drm/panfrost: Prevent race when handling page fault
Message-ID: <20190917123817.GO3958@phenom.ffwll.local>
Mail-Followup-To: Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Steven Price <steven.price@arm.com>, Rob Herring <robh@kernel.org>,
 Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 David Airlie <airlied@linux.ie>, dri-devel@lists.freedesktop.org,
 linux-kernel@vger.kernel.org
References: <20190905121141.42820-1-steven.price@arm.com>
 <20190913172454.GA5387@kevin>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190913172454.GA5387@kevin>
X-Operating-System: Linux phenom 5.2.0-2-amd64 
User-Agent: Mutt/1.10.1 (2018-07-13)
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=sender:date:from:to:cc:subject:message-id:mail-followup-to
 :references:mime-version:content-disposition:in-reply-to:user-agent;
 bh=fH6+7o6syLPR5DJ6dWMuF/JhEQdUQSof99mG97G17Lc=;
 b=DLXDmicD7OOygC/JbgTNNCd/yyvrqLEAeJjGJmlDK0oGZk9W/ggiZUTdchxnkcsXM8
 Vv5Z7HaPznKekmQEIk0ZszDwjFUAmdymDVf1jnqytM0+vrXcrR2kkHveOg7WrLu/UA9R
 Xj3xkM7N2F2t7yUZ1K5MhJ8JPKbpy/U1nkscY=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, David Airlie <airlied@linux.ie>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Steven Price <steven.price@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gRnJpLCBTZXAgMTMsIDIwMTkgYXQgMDE6MjQ6NTRQTSAtMDQwMCwgQWx5c3NhIFJvc2Vuendl
aWcgd3JvdGU6Cj4gSSdtIGNvbmZsaWN0ZWQgb24gdGhpcyBzZXJpZXMuCj4gCj4gT24gdGhlIG9u
ZSBoYW5kLCB1c2Vyc3BhY2Ugc2hvdWxkIG9idmlvdXNseSBub3QgYmUgYWJsZSB0byBjcmFzaCB0
aGUKPiBrZXJuZWwuIFNvIHRoZSBjcmFzaCBzaG91bGQgYmUgZml4ZWQgaW4gb25lIHdheSBvciBh
bm90aGVyLgo+IAo+IE9uIHRoZSBvdGhlciBoYW5kLCB1c2Vyc3BhY2UgcmVhbGx5IGhhcyB0byBz
dXBwbHkgYWxsIHRoZSBCT3MgaXQgdXNlcwo+IGZvciBjb3JyZWN0bmVzcy4gSSByZWFsaXplIHRo
ZSBEREsgZG9lc24ndCBkbyB0aGlzIGJ1dC4uLiBpdCBwcm9iYWJseQo+IHNob3VsZCwgdW1tLi4u
Cj4gCj4gV291bGQgaXQgYmUgcG9zc2libGUgdG8gY2hlY2sgZm9yIHRoZSBOVUxMIHBvaW50ZXIg
aW4gdGhlIGtlcm5lbCBhbmQKPiBza2lwIHByaW50aW5nIGluZm9ybWF0aW9uIHRoYXQgd291bGQg
cmVxdWlyZSBhIGRlcmVmZXJlbmNlPyAoV2l0aG91dAo+IGhhdmluZyB0byBwbGF5IGdhbWVzIHdp
dGggcmVmZXJlbmNlIGNvdW50cykuIFByZXN1bWFibHkgdGhhdCBtaWdodCBmaXgKPiBjcmFzaGVz
IGluIG90aGVyIGNvcm5lciBjYXNlcy4KClllYWggaWYgdGhpcyBpcyB0aGUgYmxvYiBkb2luZyBz
b21ldGhpbmcgZnVubnkgSSBndWVzcyB0aGUgcmlnaHQgYWN0aW9uCndvdWxkIGJlIHRvIGtpbGwg
dGhhdCBjb250ZXh0IGFuZCBiYW4gaXQgZnJvbSBkb2luZyBtb3JlIGZ1bm55IHRoaW5ncy4gU28K
bm90IGp1c3QgdHJ5aW5nIHRvIGJhaWwgb3V0IHdpdGhvdXQgY3Jhc2hpbmcuCgpQbHVzIEkgZ3Vl
c3MgdGhlIGNvbW1pdCBtZXNzYWdlIHNob3VsZCBiZSBhIGJpdCBjbGVhcmVyIGluIGV4cGxhaW5p
bmcKd2hhdCdzIGFjdHVhbGx5IGdvaW5nIG9uIGhlcmUgOi0pCi1EYW5pZWwKPiAKPiBPbiBUaHUs
IFNlcCAwNSwgMjAxOSBhdCAwMToxMTo0MVBNICswMTAwLCBTdGV2ZW4gUHJpY2Ugd3JvdGU6Cj4g
PiBXaGVuIGhhbmRsaW5nIGEgR1BVIHBhZ2UgZmF1bHQgYWRkcl90b19kcm1fbW1fbm9kZSgpIGlz
IHVzZWQgdG8KPiA+IHRyYW5zbGF0ZSB0aGUgR1BVIGFkZHJlc3MgdG8gYSBidWZmZXIgb2JqZWN0
LiBIb3dldmVyIGl0IGlzIHBvc3NpYmxlIGZvcgo+ID4gdGhlIGJ1ZmZlciBvYmplY3QgdG8gYmUg
ZnJlZWQgYWZ0ZXIgdGhlIGZ1bmN0aW9uIGhhcyByZXR1cm5lZCByZXN1bHRpbmcKPiA+IGluIGEg
dXNlLWFmdGVyLWZyZWUgb2YgdGhlIEJPLgo+ID4gCj4gPiBDaGFuZ2UgYWRkcl90b19kcm1fbW1f
bm9kZSB0byByZXR1cm4gdGhlIHBhbmZyb3N0X2dlbV9vYmplY3Qgd2l0aCBhbgo+ID4gZXh0cmEg
cmVmZXJlbmNlIG9uIGl0LCBwcmV2ZW50aW5nIHRoZSBCTyBmcm9tIGJlaW5nIGZyZWVkIHVudGls
IGFmdGVyCj4gPiB0aGUgcGFnZSBmYXVsdCBoYXMgYmVlbiBoYW5kbGVkLgo+ID4gCj4gPiBTaWdu
ZWQtb2ZmLWJ5OiBTdGV2ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgo+ID4gLS0tCj4g
PiAKPiA+IEkndmUgbWFuYWdlZCB0byB0cmlnZ2VyIHRoaXMsIGdlbmVyYXRpbmcgdGhlIGZvbGxv
d2luZyBzdGFjayB0cmFjZS4KPiA+IAo+ID4gVW5hYmxlIHRvIGhhbmRsZSBrZXJuZWwgTlVMTCBw
b2ludGVyIGRlcmVmZXJlbmNlIGF0IHZpcnR1YWwgYWRkcmVzcyAwMDAwMDA5MAo+ID4gcGdkID0g
MzNhNmExODEKPiA+IFswMDAwMDA5MF0gKnBnZD0wMDAwMDAwMAo+ID4gSW50ZXJuYWwgZXJyb3I6
IE9vcHM6IDUgWyMxXSBTTVAgQVJNCj4gPiBNb2R1bGVzIGxpbmtlZCBpbjoKPiA+IENQVTogMCBQ
SUQ6IDgxIENvbW06IGlycS82MC1tbXUgTm90IHRhaW50ZWQgNS4zLjAtcmMxKyAjNAo+ID4gSGFy
ZHdhcmUgbmFtZTogUm9ja2NoaXAgKERldmljZSBUcmVlKQo+ID4gUEMgaXMgYXQgcGFuZnJvc3Rf
bW11X21hcF9mYXVsdF9hZGRyKzB4MTQwLzB4M2EwCj4gPiBMUiBpcyBhdCBfcmF3X3NwaW5fdW5s
b2NrKzB4MjAvMHgzYwo+ID4gcGMgOiBbPGMwNTA4OTQ0Pl0gICAgbHIgOiBbPGMwN2NlZDEwPl0g
ICAgcHNyOiAyMDAzMDAxMwo+ID4gc3AgOiBlYzY0M2U4OCAgaXAgOiBlYTcwY2UyNCAgZnAgOiBl
YzVmZTg0MAo+ID4gcjEwOiAwMDAwMDAwMSAgcjkgOiAwMDAwMDAwMCAgcjggOiAwMDAxNzhjOQo+
ID4gcjcgOiAwMDAwMDAwMCAgcjYgOiAxNzhjOWYwMCAgcjUgOiBlYzVmZTk0MCAgcjQgOiBlYTcw
Y2UwOAo+ID4gcjMgOiAwMDAwMDAwMCAgcjIgOiAwMDAwMDAwMCAgcjEgOiBlYzY0MGUwMCAgcjAg
OiBlYzVmZTk0MAo+ID4gRmxhZ3M6IG56Q3YgIElSUXMgb24gIEZJUXMgb24gIE1vZGUgU1ZDXzMy
ICBJU0EgQVJNICBTZWdtZW50IG5vbmUKPiA+IENvbnRyb2w6IDEwYzUzODdkICBUYWJsZTogMjlm
ODQwNmEgIERBQzogMDAwMDAwNTEKPiA+IFByb2Nlc3MgaXJxLzYwLW1tdSAocGlkOiA4MSwgc3Rh
Y2sgbGltaXQgPSAweDRiOTA3MTA2KQo+ID4gU3RhY2s6ICgweGVjNjQzZTg4IHRvIDB4ZWM2NDQw
MDApCj4gPiAzZTgwOiAgICAgICAgICAgICAgICAgICBlYzY0MGUwMCBjMDdjZWRlMCBjMGMwYjIw
MCBlYzY0MGUwMCAwMDAwMDAwMCAwMDAwMDAwMAo+ID4gM2VhMDogMDAwMTc4YzkgMDAwMDAwMDAg
YzBjMGIyMDAgYzA3Y2VkZTAgZWVmOTEwNDAgZWM1ZmU4NDAgMDAwMDAwMDEgMDAwMDAwMDAKPiA+
IDNlYzA6IDAwMDEwMDAxIDAxMDAwM2MzIDAwMDAwMGMzIDAwMDAwMDAxIDE3OGM5ZjAwIGMwNTA4
Yzk4IGVlZjkxMDUwIDAwMDAwMDAwCj4gPiAzZWUwOiBlYzY0M2YzNCBjMDdjOTE4OCAwMDAwMDAw
MSBjMDE2Nzg1NCAwMDAwMDAwMCBlYzY0M2VmOCBjMGMwODQ0OCBjMDdjOTMzYwo+ID4gM2YwMDog
MDAwMDAwMDAgZWM2NDNmMDQgZmZmZWZmZmUgM2QxODJiMTcgZWUxOTM0NjggZWUxOTM0MDAgZWM1
ZGIzYzAgZWM1ZGIzYzAKPiA+IDNmMjA6IGMwMTgzODQwIGVjNWRiM2U0IGMwY2IyODc0IGMwMTgz
YjA4IDAwMDAwMDAxIGMwMTgzODVjIGZmZmZlMDAwIGVlMTkzNDAwCj4gPiAzZjQwOiBlYzVkYjNj
MCBjMDE4M2I4YyBjMGMwODQ0OCAwMDAwMDAwMCA2MDAwMDAxMyAwMDAwMDAwMCBjMDE4MzliOCAz
ZDE4MmIxNwo+ID4gM2Y2MDogZmZmZmUwMDAgZWM1ZDA1MDAgZWM1ZGIzODAgZWM2NDIwMDAgZWM1
ZGIzYzAgYzAxODNhNjQgMDAwMDAwMDAgZWQwMjVjZDgKPiA+IDNmODA6IGVjNWQwNTM4IGMwMTQ2
Y2ZjIGVjNjQyMDAwIGVjNWRiMzgwIGMwMTQ2YmMwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAw
Cj4gPiAzZmEwOiAwMDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMCBjMDEwMTBiNCAwMDAwMDAwMCAw
MDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMAo+ID4gM2ZjMDogMDAwMDAwMDAgMDAwMDAwMDAgMDAw
MDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKPiA+IDNm
ZTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAwMDEzIDAwMDAwMDAw
IDAwMDAwMDAwIDAwMDAwMDAwCj4gPiBbPGMwNTA4OTQ0Pl0gKHBhbmZyb3N0X21tdV9tYXBfZmF1
bHRfYWRkcikgZnJvbSBbPGMwNTA4Yzk4Pl0gKHBhbmZyb3N0X21tdV9pcnFfaGFuZGxlcl90aHJl
YWQrMHhmNC8weDI0OCkKPiA+IFs8YzA1MDhjOTg+XSAocGFuZnJvc3RfbW11X2lycV9oYW5kbGVy
X3RocmVhZCkgZnJvbSBbPGMwMTgzODVjPl0gKGlycV90aHJlYWRfZm4rMHgxYy8weDU4KQo+ID4g
WzxjMDE4Mzg1Yz5dIChpcnFfdGhyZWFkX2ZuKSBmcm9tIFs8YzAxODNiOGM+XSAoaXJxX3RocmVh
ZCsweDEyOC8weDI0MCkKPiA+IFs8YzAxODNiOGM+XSAoaXJxX3RocmVhZCkgZnJvbSBbPGMwMTQ2
Y2ZjPl0gKGt0aHJlYWQrMHgxM2MvMHgxNTQpCj4gPiBbPGMwMTQ2Y2ZjPl0gKGt0aHJlYWQpIGZy
b20gWzxjMDEwMTBiND5dIChyZXRfZnJvbV9mb3JrKzB4MTQvMHgyMCkKPiA+IEV4Y2VwdGlvbiBz
dGFjaygweGVjNjQzZmIwIHRvIDB4ZWM2NDNmZjgpCj4gPiAzZmEwOiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAwMDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMCAwMDAwMDAwMAo+
ID4gM2ZjMDogMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAw
MDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKPiA+IDNmZTA6IDAwMDAwMDAwIDAwMDAwMDAwIDAwMDAw
MDAwIDAwMDAwMDAwIDAwMDAwMDEzIDAwMDAwMDAwCj4gPiBDb2RlOiAxYWZmZmZlYyBlYWZmZmZl
OCBlNTE0MzAwNCBlNTlkMjAxNCAoZTU5MzMwOTApCj4gPiAtLS1bIGVuZCB0cmFjZSAwNGVhZGMz
MDA5YjhmNTA3IF0tLS0KPiA+IC0tLQo+ID4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9tbXUuYyB8IDM4ICsrKysrKysrKysrKysrKystLS0tLS0tLS0KPiA+ICAxIGZpbGUgY2hh
bmdlZCwgMjQgaW5zZXJ0aW9ucygrKSwgMTQgZGVsZXRpb25zKC0pCj4gPiAKPiA+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMgYi9kcml2ZXJzL2dw
dS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiA+IGluZGV4IDg0MmJkZDdjZjZiZS4uMTE1
OTI1ZTc0NjBhIDEwMDY0NAo+ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZy
b3N0X21tdS5jCj4gPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11
LmMKPiA+IEBAIC0zOTIsOSArMzkyLDExIEBAIHZvaWQgcGFuZnJvc3RfbW11X3BndGFibGVfZnJl
ZShzdHJ1Y3QgcGFuZnJvc3RfZmlsZV9wcml2ICpwcml2KQo+ID4gIAlmcmVlX2lvX3BndGFibGVf
b3BzKG1tdS0+cGd0Ymxfb3BzKTsKPiA+ICB9Cj4gPiAgCj4gPiAtc3RhdGljIHN0cnVjdCBkcm1f
bW1fbm9kZSAqYWRkcl90b19kcm1fbW1fbm9kZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRl
diwgaW50IGFzLCB1NjQgYWRkcikKPiA+ICtzdGF0aWMgc3RydWN0IHBhbmZyb3N0X2dlbV9vYmpl
Y3QgKgo+ID4gK2FkZHJfdG9fZHJtX21tX25vZGUoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZk
ZXYsIGludCBhcywgdTY0IGFkZHIpCj4gPiAgewo+ID4gLQlzdHJ1Y3QgZHJtX21tX25vZGUgKm5v
ZGUgPSBOVUxMOwo+ID4gKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8gPSBOVUxMOwo+
ID4gKwlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGU7Cj4gPiAgCXU2NCBvZmZzZXQgPSBhZGRyID4+
IFBBR0VfU0hJRlQ7Cj4gPiAgCXN0cnVjdCBwYW5mcm9zdF9tbXUgKm1tdTsKPiA+ICAKPiA+IEBA
IC00MDYsMTQgKzQwOCwxNyBAQCBzdGF0aWMgc3RydWN0IGRybV9tbV9ub2RlICphZGRyX3RvX2Ry
bV9tbV9ub2RlKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbgo+ID4gIAo+ID4gIAkJ
cHJpdiA9IGNvbnRhaW5lcl9vZihtbXUsIHN0cnVjdCBwYW5mcm9zdF9maWxlX3ByaXYsIG1tdSk7
Cj4gPiAgCQlkcm1fbW1fZm9yX2VhY2hfbm9kZShub2RlLCAmcHJpdi0+bW0pIHsKPiA+IC0JCQlp
ZiAob2Zmc2V0ID49IG5vZGUtPnN0YXJ0ICYmIG9mZnNldCA8IChub2RlLT5zdGFydCArIG5vZGUt
PnNpemUpKQo+ID4gKwkJCWlmIChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYKPiA+ICsJCQkgICAg
b2Zmc2V0IDwgKG5vZGUtPnN0YXJ0ICsgbm9kZS0+c2l6ZSkpIHsKPiA+ICsJCQkJYm8gPSBkcm1f
bW1fbm9kZV90b19wYW5mcm9zdF9ibyhub2RlKTsKPiA+ICsJCQkJZHJtX2dlbV9vYmplY3RfZ2V0
KCZiby0+YmFzZS5iYXNlKTsKPiA+ICAJCQkJZ290byBvdXQ7Cj4gPiArCQkJfQo+ID4gIAkJfQo+
ID4gIAl9Cj4gPiAtCj4gPiAgb3V0Ogo+ID4gIAlzcGluX3VubG9jaygmcGZkZXYtPmFzX2xvY2sp
Owo+ID4gLQlyZXR1cm4gbm9kZTsKPiA+ICsJcmV0dXJuIGJvOwo+ID4gIH0KPiA+ICAKPiA+ICAj
ZGVmaW5lIE5VTV9GQVVMVF9QQUdFUyAoU1pfMk0gLyBQQUdFX1NJWkUpCj4gPiBAQCAtNDIxLDI5
ICs0MjYsMjggQEAgc3RhdGljIHN0cnVjdCBkcm1fbW1fbm9kZSAqYWRkcl90b19kcm1fbW1fbm9k
ZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaW4KPiA+ICBpbnQgcGFuZnJvc3RfbW11
X21hcF9mYXVsdF9hZGRyKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbnQgYXMsIHU2
NCBhZGRyKQo+ID4gIHsKPiA+ICAJaW50IHJldCwgaTsKPiA+IC0Jc3RydWN0IGRybV9tbV9ub2Rl
ICpub2RlOwo+ID4gIAlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm87Cj4gPiAgCXN0cnVj
dCBhZGRyZXNzX3NwYWNlICptYXBwaW5nOwo+ID4gIAlwZ29mZl90IHBhZ2Vfb2Zmc2V0Owo+ID4g
IAlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKPiA+ICAJc3RydWN0IHBhZ2UgKipwYWdlczsKPiA+ICAK
PiA+IC0Jbm9kZSA9IGFkZHJfdG9fZHJtX21tX25vZGUocGZkZXYsIGFzLCBhZGRyKTsKPiA+IC0J
aWYgKCFub2RlKQo+ID4gKwlibyA9IGFkZHJfdG9fZHJtX21tX25vZGUocGZkZXYsIGFzLCBhZGRy
KTsKPiA+ICsJaWYgKCFibykKPiA+ICAJCXJldHVybiAtRU5PRU5UOwo+ID4gIAo+ID4gLQlibyA9
IGRybV9tbV9ub2RlX3RvX3BhbmZyb3N0X2JvKG5vZGUpOwo+ID4gIAlpZiAoIWJvLT5pc19oZWFw
KSB7Cj4gPiAgCQlkZXZfV0FSTihwZmRldi0+ZGV2LCAibWF0Y2hpbmcgQk8gaXMgbm90IGhlYXAg
dHlwZSAoR1BVIFZBID0gJWxseCkiLAo+ID4gLQkJCSBub2RlLT5zdGFydCA8PCBQQUdFX1NISUZU
KTsKPiA+IC0JCXJldHVybiAtRUlOVkFMOwo+ID4gKwkJCSBiby0+bm9kZS5zdGFydCA8PCBQQUdF
X1NISUZUKTsKPiA+ICsJCXJldCA9IC1FSU5WQUw7Cj4gPiArCQlnb3RvIGVycl9ibzsKPiA+ICAJ
fQo+ID4gIAlXQVJOX09OKGJvLT5tbXUtPmFzICE9IGFzKTsKPiA+ICAKPiA+ICAJLyogQXNzdW1l
IDJNQiBhbGlnbm1lbnQgYW5kIHNpemUgbXVsdGlwbGUgKi8KPiA+ICAJYWRkciAmPSB+KCh1NjQp
U1pfMk0gLSAxKTsKPiA+ICAJcGFnZV9vZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7Cj4gPiAt
CXBhZ2Vfb2Zmc2V0IC09IG5vZGUtPnN0YXJ0Owo+ID4gKwlwYWdlX29mZnNldCAtPSBiby0+bm9k
ZS5zdGFydDsKPiA+ICAKPiA+ICAJbXV0ZXhfbG9jaygmYm8tPmJhc2UucGFnZXNfbG9jayk7Cj4g
PiAgCj4gPiBAQCAtNDUyLDcgKzQ1Niw4IEBAIGludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2Fk
ZHIoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gPiAg
CQkJCSAgICAgc2l6ZW9mKHN0cnVjdCBzZ190YWJsZSksIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJP
KTsKPiA+ICAJCWlmICghYm8tPnNndHMpIHsKPiA+ICAJCQltdXRleF91bmxvY2soJmJvLT5iYXNl
LnBhZ2VzX2xvY2spOwo+ID4gLQkJCXJldHVybiAtRU5PTUVNOwo+ID4gKwkJCXJldCA9IC1FTk9N
RU07Cj4gPiArCQkJZ290byBlcnJfYm87Cj4gPiAgCQl9Cj4gPiAgCj4gPiAgCQlwYWdlcyA9IGt2
bWFsbG9jX2FycmF5KGJvLT5iYXNlLmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZULAo+ID4gQEAgLTQ2
MSw3ICs0NjYsOCBAQCBpbnQgcGFuZnJvc3RfbW11X21hcF9mYXVsdF9hZGRyKHN0cnVjdCBwYW5m
cm9zdF9kZXZpY2UgKnBmZGV2LCBpbnQgYXMsIHU2NCBhZGRyKQo+ID4gIAkJCWtmcmVlKGJvLT5z
Z3RzKTsKPiA+ICAJCQliby0+c2d0cyA9IE5VTEw7Cj4gPiAgCQkJbXV0ZXhfdW5sb2NrKCZiby0+
YmFzZS5wYWdlc19sb2NrKTsKPiA+IC0JCQlyZXR1cm4gLUVOT01FTTsKPiA+ICsJCQlyZXQgPSAt
RU5PTUVNOwo+ID4gKwkJCWdvdG8gZXJyX2JvOwo+ID4gIAkJfQo+ID4gIAkJYm8tPmJhc2UucGFn
ZXMgPSBwYWdlczsKPiA+ICAJCWJvLT5iYXNlLnBhZ2VzX3VzZV9jb3VudCA9IDE7Cj4gPiBAQCAt
NDk5LDEyICs1MDUsMTYgQEAgaW50IHBhbmZyb3N0X21tdV9tYXBfZmF1bHRfYWRkcihzdHJ1Y3Qg
cGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaW50IGFzLCB1NjQgYWRkcikKPiA+ICAKPiA+ICAJZGV2
X2RiZyhwZmRldi0+ZGV2LCAibWFwcGVkIHBhZ2UgZmF1bHQgQCBBUyVkICVsbHgiLCBhcywgYWRk
cik7Cj4gPiAgCj4gPiArCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmYm8tPmJhc2UuYmFz
ZSk7Cj4gPiArCj4gPiAgCXJldHVybiAwOwo+ID4gIAo+ID4gIGVycl9tYXA6Cj4gPiAgCXNnX2Zy
ZWVfdGFibGUoc2d0KTsKPiA+ICBlcnJfcGFnZXM6Cj4gPiAgCWRybV9nZW1fc2htZW1fcHV0X3Bh
Z2VzKCZiby0+YmFzZSk7Cj4gPiArZXJyX2JvOgo+ID4gKwlkcm1fZ2VtX29iamVjdF9wdXRfdW5s
b2NrZWQoJmJvLT5iYXNlLmJhc2UpOwo+ID4gIAlyZXR1cm4gcmV0Owo+ID4gIH0KPiA+ICAKPiA+
IC0tIAo+ID4gMi4yMC4xCj4gPiAKCgoKLS0gCkRhbmllbCBWZXR0ZXIKU29mdHdhcmUgRW5naW5l
ZXIsIEludGVsIENvcnBvcmF0aW9uCmh0dHA6Ly9ibG9nLmZmd2xsLmNoCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
