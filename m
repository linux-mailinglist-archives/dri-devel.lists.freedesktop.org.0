Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4EC36F41C0
	for <lists+dri-devel@lfdr.de>; Fri,  8 Nov 2019 09:13:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 600426F865;
	Fri,  8 Nov 2019 08:12:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relmlie5.idc.renesas.com (relmlor1.renesas.com
 [210.160.252.171])
 by gabe.freedesktop.org (Postfix) with ESMTP id 02DE96F790
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 20:11:20 +0000 (UTC)
X-IronPort-AV: E=Sophos;i="5.68,279,1569250800"; d="scan'208";a="31108934"
Received: from unknown (HELO relmlir5.idc.renesas.com) ([10.200.68.151])
 by relmlie5.idc.renesas.com with ESMTP; 08 Nov 2019 05:11:20 +0900
Received: from fabrizio-dev.ree.adwin.renesas.com (unknown [10.226.36.196])
 by relmlir5.idc.renesas.com (Postfix) with ESMTP id 567E34008C62;
 Fri,  8 Nov 2019 05:11:16 +0900 (JST)
From: Fabrizio Castro <fabrizio.castro@bp.renesas.com>
To: Neil Armstrong <narmstrong@baylibre.com>, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel@ffwll.ch>, Rob Herring <robh+dt@kernel.org>,
 Mark Rutland <mark.rutland@arm.com>, Andrzej Hajda <a.hajda@samsung.com>
Subject: [PATCH v3 2/7] drm/bridge: Repurpose lvds-encoder.c
Date: Thu,  7 Nov 2019 20:10:58 +0000
Message-Id: <1573157463-14070-3-git-send-email-fabrizio.castro@bp.renesas.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1573157463-14070-1-git-send-email-fabrizio.castro@bp.renesas.com>
References: <1573157463-14070-1-git-send-email-fabrizio.castro@bp.renesas.com>
X-Mailman-Approved-At: Fri, 08 Nov 2019 08:12:31 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Fabrizio Castro <fabrizio.castro@bp.renesas.com>,
 devicetree@vger.kernel.org, Chris Paterson <Chris.Paterson2@renesas.com>,
 Geert Uytterhoeven <geert+renesas@glider.be>,
 Kieran Bingham <kieran.bingham+renesas@ideasonboard.com>,
 Magnus Damm <magnus.damm@gmail.com>, dri-devel@lists.freedesktop.org,
 Biju Das <biju.das@bp.renesas.com>, linux-renesas-soc@vger.kernel.org,
 Simon Horman <horms@verge.net.au>, Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Peter Rosin <peda@axentia.se>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

bHZkcy1lbmNvZGVyLmMgaW1wbGVtZW50YXRpb24gaXMgYWxzbyBzdWl0YWJsZSBmb3IgTFZEUyBk
ZWNvZGVycywKbm90IGp1c3QgTFZEUyBlbmNvZGVycy4KSW5zdGVhZCBvZiBjcmVhdGluZyBhIG5l
dyBkcml2ZXIgZm9yIGFkZHJlc3Npbmcgc3VwcG9ydCBmb3IKdHJhbnNwYXJlbnQgTFZEUyBkZWNv
ZGVycywgcmVwdXJwb3NlIGx2ZHMtZW5jb2Rlci5jIGZvciB0aGUgZ3JlYXRlcgpnb29kLgoKU2ln
bmVkLW9mZi1ieTogRmFicml6aW8gQ2FzdHJvIDxmYWJyaXppby5jYXN0cm9AYnAucmVuZXNhcy5j
b20+CgotLS0KdjItPnYzOgoqIE5vIGNoYW5nZQp2MS0+djI6CiogTm8gY2hhbmdlCi0tLQogZHJp
dmVycy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9NYWtlZmlsZSAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2JyaWRn
ZS9sdmRzLWNvZGVjLmMgICB8IDEzMSArKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBkcml2
ZXJzL2dwdS9kcm0vYnJpZGdlL2x2ZHMtZW5jb2Rlci5jIHwgMTU1IC0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgMTM2IGluc2VydGlvbnMoKyksIDE2
MCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2x2ZHMtY29kZWMuYwogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9icmlkZ2Uv
bHZkcy1lbmNvZGVyLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25m
aWcgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKaW5kZXggMzQzNjI5Ny4uOWU3NWNh
NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvS2NvbmZpZworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKQEAgLTQ1LDE0ICs0NSwxNCBAQCBjb25maWcgRFJN
X0RVTUJfVkdBX0RBQwogCSAgU3VwcG9ydCBmb3Igbm9uLXByb2dyYW1tYWJsZSBSR0IgdG8gVkdB
IERBQyBicmlkZ2VzLCBzdWNoIGFzIEFESQogCSAgQURWNzEyMywgVEkgVEhTODEzNCBhbmQgVEhT
ODEzNSBvciBwYXNzaXZlIHJlc2lzdG9yIGxhZGRlciBEQUNzLgogCi1jb25maWcgRFJNX0xWRFNf
RU5DT0RFUgotCXRyaXN0YXRlICJUcmFuc3BhcmVudCBwYXJhbGxlbCB0byBMVkRTIGVuY29kZXIg
c3VwcG9ydCIKK2NvbmZpZyBEUk1fTFZEU19DT0RFQworCXRyaXN0YXRlICJUcmFuc3BhcmVudCBM
VkRTIGVuY29kZXJzIGFuZCBkZWNvZGVycyBzdXBwb3J0IgogCWRlcGVuZHMgb24gT0YKIAlzZWxl
Y3QgRFJNX0tNU19IRUxQRVIKIAlzZWxlY3QgRFJNX1BBTkVMX0JSSURHRQogCWhlbHAKLQkgIFN1
cHBvcnQgZm9yIHRyYW5zcGFyZW50IHBhcmFsbGVsIHRvIExWRFMgZW5jb2RlcnMgdGhhdCBkb24n
dCByZXF1aXJlCi0JICBhbnkgY29uZmlndXJhdGlvbi4KKwkgIFN1cHBvcnQgZm9yIHRyYW5zcGFy
ZW50IExWRFMgZW5jb2RlcnMgYW5kIExWRFMgZGVjb2RlcnMgdGhhdCBkb24ndAorCSAgcmVxdWly
ZSBhbnkgY29uZmlndXJhdGlvbi4KIAogY29uZmlnIERSTV9NRUdBQ0hJUFNfU1REUFhYWFhfR0Vf
Qjg1MFYzX0ZXCiAJdHJpc3RhdGUgIk1lZ2FDaGlwcyBzdGRwNDAyOC1nZS1iODUwdjMtZncgYW5k
IHN0ZHAyNjkwLWdlLWI4NTB2My1mdyIKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2UvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlCmluZGV4IDQ5MzRm
Y2YuLjhhOTE3OGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvTWFrZWZpbGUK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQpAQCAtMiw3ICsyLDcgQEAKIG9i
ai0kKENPTkZJR19EUk1fQU5BTE9HSVhfQU5YNzhYWCkgKz0gYW5hbG9naXgtYW54Nzh4eC5vCiBv
YmotJChDT05GSUdfRFJNX0NETlNfRFNJKSArPSBjZG5zLWRzaS5vCiBvYmotJChDT05GSUdfRFJN
X0RVTUJfVkdBX0RBQykgKz0gZHVtYi12Z2EtZGFjLm8KLW9iai0kKENPTkZJR19EUk1fTFZEU19F
TkNPREVSKSArPSBsdmRzLWVuY29kZXIubworb2JqLSQoQ09ORklHX0RSTV9MVkRTX0NPREVDKSAr
PSBsdmRzLWNvZGVjLm8KIG9iai0kKENPTkZJR19EUk1fTUVHQUNISVBTX1NURFBYWFhYX0dFX0I4
NTBWM19GVykgKz0gbWVnYWNoaXBzLXN0ZHB4eHh4LWdlLWI4NTB2My1mdy5vCiBvYmotJChDT05G
SUdfRFJNX05YUF9QVE4zNDYwKSArPSBueHAtcHRuMzQ2MC5vCiBvYmotJChDT05GSUdfRFJNX1BB
UkFERV9QUzg2MjIpICs9IHBhcmFkZS1wczg2MjIubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9sdmRzLWNvZGVjLmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2x2ZHMtY29k
ZWMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi5kNTdhOGViCi0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9sdmRzLWNvZGVjLmMKQEAgLTAsMCAr
MSwxMzEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9yLWxhdGVyCisv
KgorICogQ29weXJpZ2h0IChDKSAyMDE5IFJlbmVzYXMgRWxlY3Ryb25pY3MgQ29ycG9yYXRpb24K
KyAqIENvcHlyaWdodCAoQykgMjAxNiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNoYXJ0
QGlkZWFzb25ib2FyZC5jb20+CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2dwaW8vY29uc3VtZXIu
aD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2lu
Y2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2dyYXBoLmg+Cisj
aW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2Jy
aWRnZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGFuZWwuaD4KKworc3RydWN0IGx2ZHNfY29kZWMg
eworCXN0cnVjdCBkcm1fYnJpZGdlIGJyaWRnZTsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAqcGFuZWxf
YnJpZGdlOworCXN0cnVjdCBncGlvX2Rlc2MgKnBvd2VyZG93bl9ncGlvOworfTsKKworc3RhdGlj
IGludCBsdmRzX2NvZGVjX2F0dGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0
cnVjdCBsdmRzX2NvZGVjICpsdmRzX2NvZGVjID0gY29udGFpbmVyX29mKGJyaWRnZSwKKwkJCQkJ
CSAgICAgc3RydWN0IGx2ZHNfY29kZWMsIGJyaWRnZSk7CisKKwlyZXR1cm4gZHJtX2JyaWRnZV9h
dHRhY2goYnJpZGdlLT5lbmNvZGVyLCBsdmRzX2NvZGVjLT5wYW5lbF9icmlkZ2UsCisJCQkJIGJy
aWRnZSk7Cit9CisKK3N0YXRpYyB2b2lkIGx2ZHNfY29kZWNfZW5hYmxlKHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGx2ZHNfY29kZWMgKmx2ZHNfY29kZWMgPSBjb250YWlu
ZXJfb2YoYnJpZGdlLAorCQkJCQkJICAgICBzdHJ1Y3QgbHZkc19jb2RlYywgYnJpZGdlKTsKKwor
CWlmIChsdmRzX2NvZGVjLT5wb3dlcmRvd25fZ3BpbykKKwkJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNs
ZWVwKGx2ZHNfY29kZWMtPnBvd2VyZG93bl9ncGlvLCAwKTsKK30KKworc3RhdGljIHZvaWQgbHZk
c19jb2RlY19kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGx2
ZHNfY29kZWMgKmx2ZHNfY29kZWMgPSBjb250YWluZXJfb2YoYnJpZGdlLAorCQkJCQkJICAgICBz
dHJ1Y3QgbHZkc19jb2RlYywgYnJpZGdlKTsKKworCWlmIChsdmRzX2NvZGVjLT5wb3dlcmRvd25f
Z3BpbykKKwkJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKGx2ZHNfY29kZWMtPnBvd2VyZG93bl9n
cGlvLCAxKTsKK30KKworc3RhdGljIHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIGZ1bmNzID0gewor
CS5hdHRhY2ggPSBsdmRzX2NvZGVjX2F0dGFjaCwKKwkuZW5hYmxlID0gbHZkc19jb2RlY19lbmFi
bGUsCisJLmRpc2FibGUgPSBsdmRzX2NvZGVjX2Rpc2FibGUsCit9OworCitzdGF0aWMgaW50IGx2
ZHNfY29kZWNfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3Qg
ZGV2aWNlICpkZXYgPSAmcGRldi0+ZGV2OworCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcGFuZWxfbm9k
ZTsKKwlzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbDsKKwlzdHJ1Y3QgbHZkc19jb2RlYyAqbHZkc19j
b2RlYzsKKworCWx2ZHNfY29kZWMgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmx2ZHNfY29k
ZWMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWx2ZHNfY29kZWMpCisJCXJldHVybiAtRU5PTUVNOwor
CisJbHZkc19jb2RlYy0+cG93ZXJkb3duX2dwaW8gPSBkZXZtX2dwaW9kX2dldF9vcHRpb25hbChk
ZXYsICJwb3dlcmRvd24iLAorCQkJCQkJCSAgICAgR1BJT0RfT1VUX0hJR0gpOworCWlmIChJU19F
UlIobHZkc19jb2RlYy0+cG93ZXJkb3duX2dwaW8pKQorCQlyZXR1cm4gUFRSX0VSUihsdmRzX2Nv
ZGVjLT5wb3dlcmRvd25fZ3Bpbyk7CisKKwlwYW5lbF9ub2RlID0gb2ZfZ3JhcGhfZ2V0X3JlbW90
ZV9ub2RlKGRldi0+b2Zfbm9kZSwgMSwgMCk7CisJaWYgKCFwYW5lbF9ub2RlKSB7CisJCWRldl9k
YmcoZGV2LCAicGFuZWwgRFQgbm9kZSBub3QgZm91bmRcbiIpOworCQlyZXR1cm4gLUVOWElPOwor
CX0KKworCXBhbmVsID0gb2ZfZHJtX2ZpbmRfcGFuZWwocGFuZWxfbm9kZSk7CisJb2Zfbm9kZV9w
dXQocGFuZWxfbm9kZSk7CisJaWYgKElTX0VSUihwYW5lbCkpIHsKKwkJZGV2X2RiZyhkZXYsICJw
YW5lbCBub3QgZm91bmQsIGRlZmVycmluZyBwcm9iZVxuIik7CisJCXJldHVybiBQVFJfRVJSKHBh
bmVsKTsKKwl9CisKKwlsdmRzX2NvZGVjLT5wYW5lbF9icmlkZ2UgPSBkZXZtX2RybV9wYW5lbF9i
cmlkZ2VfYWRkKGRldiwgcGFuZWwpOworCWlmIChJU19FUlIobHZkc19jb2RlYy0+cGFuZWxfYnJp
ZGdlKSkKKwkJcmV0dXJuIFBUUl9FUlIobHZkc19jb2RlYy0+cGFuZWxfYnJpZGdlKTsKKworCS8q
IFRoZSBwYW5lbF9icmlkZ2UgYnJpZGdlIGlzIGF0dGFjaGVkIHRvIHRoZSBwYW5lbCdzIG9mX25v
ZGUsCisJICogYnV0IHdlIG5lZWQgYSBicmlkZ2UgYXR0YWNoZWQgdG8gb3VyIG9mX25vZGUgZm9y
IG91ciB1c2VyCisJICogdG8gbG9vayB1cC4KKwkgKi8KKwlsdmRzX2NvZGVjLT5icmlkZ2Uub2Zf
bm9kZSA9IGRldi0+b2Zfbm9kZTsKKwlsdmRzX2NvZGVjLT5icmlkZ2UuZnVuY3MgPSAmZnVuY3M7
CisJZHJtX2JyaWRnZV9hZGQoJmx2ZHNfY29kZWMtPmJyaWRnZSk7CisKKwlwbGF0Zm9ybV9zZXRf
ZHJ2ZGF0YShwZGV2LCBsdmRzX2NvZGVjKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IGx2ZHNfY29kZWNfcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3Ry
dWN0IGx2ZHNfY29kZWMgKmx2ZHNfY29kZWMgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsK
KworCWRybV9icmlkZ2VfcmVtb3ZlKCZsdmRzX2NvZGVjLT5icmlkZ2UpOworCisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGx2ZHNfY29kZWNfbWF0Y2hb
XSA9IHsKKwl7IC5jb21wYXRpYmxlID0gImx2ZHMtZW5jb2RlciIgIH0sCisJeyAuY29tcGF0aWJs
ZSA9ICJ0aGluZSx0aGM2M2x2ZG04M2QiIH0sCisJeyAuY29tcGF0aWJsZSA9ICJsdmRzLWRlY29k
ZXIiIH0sCisJe30sCit9OworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgbHZkc19jb2RlY19tYXRj
aCk7CisKK3N0YXRpYyBzdHJ1Y3QgcGxhdGZvcm1fZHJpdmVyIGx2ZHNfY29kZWNfZHJpdmVyID0g
eworCS5wcm9iZQk9IGx2ZHNfY29kZWNfcHJvYmUsCisJLnJlbW92ZQk9IGx2ZHNfY29kZWNfcmVt
b3ZlLAorCS5kcml2ZXIJCT0geworCQkubmFtZQkJPSAibHZkcy1jb2RlYyIsCisJCS5vZl9tYXRj
aF90YWJsZQk9IGx2ZHNfY29kZWNfbWF0Y2gsCisJfSwKK307Cittb2R1bGVfcGxhdGZvcm1fZHJp
dmVyKGx2ZHNfY29kZWNfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiTGF1cmVudCBQaW5jaGFy
dCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPiIpOworTU9EVUxFX0RFU0NSSVBU
SU9OKCJEcml2ZXIgZm9yIHRyYW5zcGFyZW50IExWRFMgZW5jb2RlcnMgYW5kIExWRFMgZGVjb2Rl
cnMiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9icmlkZ2UvbHZkcy1lbmNvZGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2x2ZHMtZW5j
b2Rlci5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBlMjEzMmE4Li4wMDAwMDAwCi0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvbHZkcy1lbmNvZGVyLmMKKysrIC9kZXYvbnVsbApA
QCAtMSwxNTUgKzAsMCBAQAotLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb3It
bGF0ZXIKLS8qCi0gKiBDb3B5cmlnaHQgKEMpIDIwMTYgTGF1cmVudCBQaW5jaGFydCA8bGF1cmVu
dC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgotICovCi0KLSNpbmNsdWRlIDxsaW51eC9ncGlv
L2NvbnN1bWVyLmg+Ci0jaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+Ci0jaW5jbHVkZSA8bGludXgv
b2YuaD4KLSNpbmNsdWRlIDxsaW51eC9vZl9ncmFwaC5oPgotI2luY2x1ZGUgPGxpbnV4L3BsYXRm
b3JtX2RldmljZS5oPgotCi0jaW5jbHVkZSA8ZHJtL2RybV9icmlkZ2UuaD4KLSNpbmNsdWRlIDxk
cm0vZHJtX3BhbmVsLmg+Ci0KLXN0cnVjdCBsdmRzX2VuY29kZXIgewotCXN0cnVjdCBkcm1fYnJp
ZGdlIGJyaWRnZTsKLQlzdHJ1Y3QgZHJtX2JyaWRnZSAqcGFuZWxfYnJpZGdlOwotCXN0cnVjdCBn
cGlvX2Rlc2MgKnBvd2VyZG93bl9ncGlvOwotfTsKLQotc3RhdGljIGludCBsdmRzX2VuY29kZXJf
YXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCi17Ci0Jc3RydWN0IGx2ZHNfZW5jb2Rl
ciAqbHZkc19lbmNvZGVyID0gY29udGFpbmVyX29mKGJyaWRnZSwKLQkJCQkJCQkgc3RydWN0IGx2
ZHNfZW5jb2RlciwKLQkJCQkJCQkgYnJpZGdlKTsKLQotCXJldHVybiBkcm1fYnJpZGdlX2F0dGFj
aChicmlkZ2UtPmVuY29kZXIsIGx2ZHNfZW5jb2Rlci0+cGFuZWxfYnJpZGdlLAotCQkJCSBicmlk
Z2UpOwotfQotCi1zdGF0aWMgdm9pZCBsdmRzX2VuY29kZXJfZW5hYmxlKHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UpCi17Ci0Jc3RydWN0IGx2ZHNfZW5jb2RlciAqbHZkc19lbmNvZGVyID0gY29u
dGFpbmVyX29mKGJyaWRnZSwKLQkJCQkJCQkgc3RydWN0IGx2ZHNfZW5jb2RlciwKLQkJCQkJCQkg
YnJpZGdlKTsKLQotCWlmIChsdmRzX2VuY29kZXItPnBvd2VyZG93bl9ncGlvKQotCQlncGlvZF9z
ZXRfdmFsdWVfY2Fuc2xlZXAobHZkc19lbmNvZGVyLT5wb3dlcmRvd25fZ3BpbywgMCk7Ci19Ci0K
LXN0YXRpYyB2b2lkIGx2ZHNfZW5jb2Rlcl9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlk
Z2UpCi17Ci0Jc3RydWN0IGx2ZHNfZW5jb2RlciAqbHZkc19lbmNvZGVyID0gY29udGFpbmVyX29m
KGJyaWRnZSwKLQkJCQkJCQkgc3RydWN0IGx2ZHNfZW5jb2RlciwKLQkJCQkJCQkgYnJpZGdlKTsK
LQotCWlmIChsdmRzX2VuY29kZXItPnBvd2VyZG93bl9ncGlvKQotCQlncGlvZF9zZXRfdmFsdWVf
Y2Fuc2xlZXAobHZkc19lbmNvZGVyLT5wb3dlcmRvd25fZ3BpbywgMSk7Ci19Ci0KLXN0YXRpYyBz
dHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyBmdW5jcyA9IHsKLQkuYXR0YWNoID0gbHZkc19lbmNvZGVy
X2F0dGFjaCwKLQkuZW5hYmxlID0gbHZkc19lbmNvZGVyX2VuYWJsZSwKLQkuZGlzYWJsZSA9IGx2
ZHNfZW5jb2Rlcl9kaXNhYmxlLAotfTsKLQotc3RhdGljIGludCBsdmRzX2VuY29kZXJfcHJvYmUo
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKLXsKLQlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAm
cGRldi0+ZGV2OwotCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcG9ydDsKLQlzdHJ1Y3QgZGV2aWNlX25v
ZGUgKmVuZHBvaW50OwotCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcGFuZWxfbm9kZTsKLQlzdHJ1Y3Qg
ZHJtX3BhbmVsICpwYW5lbDsKLQlzdHJ1Y3QgbHZkc19lbmNvZGVyICpsdmRzX2VuY29kZXI7Ci0K
LQlsdmRzX2VuY29kZXIgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKmx2ZHNfZW5jb2Rlciks
IEdGUF9LRVJORUwpOwotCWlmICghbHZkc19lbmNvZGVyKQotCQlyZXR1cm4gLUVOT01FTTsKLQot
CWx2ZHNfZW5jb2Rlci0+cG93ZXJkb3duX2dwaW8gPSBkZXZtX2dwaW9kX2dldF9vcHRpb25hbChk
ZXYsICJwb3dlcmRvd24iLAotCQkJCQkJCSAgICAgICBHUElPRF9PVVRfSElHSCk7Ci0JaWYgKElT
X0VSUihsdmRzX2VuY29kZXItPnBvd2VyZG93bl9ncGlvKSkgewotCQlpbnQgZXJyID0gUFRSX0VS
UihsdmRzX2VuY29kZXItPnBvd2VyZG93bl9ncGlvKTsKLQotCQlpZiAoZXJyICE9IC1FUFJPQkVf
REVGRVIpCi0JCQlkZXZfZXJyKGRldiwgInBvd2VyZG93biBHUElPIGZhaWx1cmU6ICVkXG4iLCBl
cnIpOwotCQlyZXR1cm4gZXJyOwotCX0KLQotCS8qIExvY2F0ZSB0aGUgcGFuZWwgRFQgbm9kZS4g
Ki8KLQlwb3J0ID0gb2ZfZ3JhcGhfZ2V0X3BvcnRfYnlfaWQoZGV2LT5vZl9ub2RlLCAxKTsKLQlp
ZiAoIXBvcnQpIHsKLQkJZGV2X2RiZyhkZXYsICJwb3J0IDEgbm90IGZvdW5kXG4iKTsKLQkJcmV0
dXJuIC1FTlhJTzsKLQl9Ci0KLQllbmRwb2ludCA9IG9mX2dldF9jaGlsZF9ieV9uYW1lKHBvcnQs
ICJlbmRwb2ludCIpOwotCW9mX25vZGVfcHV0KHBvcnQpOwotCWlmICghZW5kcG9pbnQpIHsKLQkJ
ZGV2X2RiZyhkZXYsICJubyBlbmRwb2ludCBmb3IgcG9ydCAxXG4iKTsKLQkJcmV0dXJuIC1FTlhJ
TzsKLQl9Ci0KLQlwYW5lbF9ub2RlID0gb2ZfZ3JhcGhfZ2V0X3JlbW90ZV9wb3J0X3BhcmVudChl
bmRwb2ludCk7Ci0Jb2Zfbm9kZV9wdXQoZW5kcG9pbnQpOwotCWlmICghcGFuZWxfbm9kZSkgewot
CQlkZXZfZGJnKGRldiwgIm5vIHJlbW90ZSBlbmRwb2ludCBmb3IgcG9ydCAxXG4iKTsKLQkJcmV0
dXJuIC1FTlhJTzsKLQl9Ci0KLQlwYW5lbCA9IG9mX2RybV9maW5kX3BhbmVsKHBhbmVsX25vZGUp
OwotCW9mX25vZGVfcHV0KHBhbmVsX25vZGUpOwotCWlmIChJU19FUlIocGFuZWwpKSB7Ci0JCWRl
dl9kYmcoZGV2LCAicGFuZWwgbm90IGZvdW5kLCBkZWZlcnJpbmcgcHJvYmVcbiIpOwotCQlyZXR1
cm4gUFRSX0VSUihwYW5lbCk7Ci0JfQotCi0JbHZkc19lbmNvZGVyLT5wYW5lbF9icmlkZ2UgPQot
CQlkZXZtX2RybV9wYW5lbF9icmlkZ2VfYWRkX3R5cGVkKGRldiwgcGFuZWwsCi0JCQkJCQlEUk1f
TU9ERV9DT05ORUNUT1JfTFZEUyk7Ci0JaWYgKElTX0VSUihsdmRzX2VuY29kZXItPnBhbmVsX2Jy
aWRnZSkpCi0JCXJldHVybiBQVFJfRVJSKGx2ZHNfZW5jb2Rlci0+cGFuZWxfYnJpZGdlKTsKLQot
CS8qIFRoZSBwYW5lbF9icmlkZ2UgYnJpZGdlIGlzIGF0dGFjaGVkIHRvIHRoZSBwYW5lbCdzIG9m
X25vZGUsCi0JICogYnV0IHdlIG5lZWQgYSBicmlkZ2UgYXR0YWNoZWQgdG8gb3VyIG9mX25vZGUg
Zm9yIG91ciB1c2VyCi0JICogdG8gbG9vayB1cC4KLQkgKi8KLQlsdmRzX2VuY29kZXItPmJyaWRn
ZS5vZl9ub2RlID0gZGV2LT5vZl9ub2RlOwotCWx2ZHNfZW5jb2Rlci0+YnJpZGdlLmZ1bmNzID0g
JmZ1bmNzOwotCWRybV9icmlkZ2VfYWRkKCZsdmRzX2VuY29kZXItPmJyaWRnZSk7Ci0KLQlwbGF0
Zm9ybV9zZXRfZHJ2ZGF0YShwZGV2LCBsdmRzX2VuY29kZXIpOwotCi0JcmV0dXJuIDA7Ci19Ci0K
LXN0YXRpYyBpbnQgbHZkc19lbmNvZGVyX3JlbW92ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpw
ZGV2KQotewotCXN0cnVjdCBsdmRzX2VuY29kZXIgKmx2ZHNfZW5jb2RlciA9IHBsYXRmb3JtX2dl
dF9kcnZkYXRhKHBkZXYpOwotCi0JZHJtX2JyaWRnZV9yZW1vdmUoJmx2ZHNfZW5jb2Rlci0+YnJp
ZGdlKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9p
ZCBsdmRzX2VuY29kZXJfbWF0Y2hbXSA9IHsKLQl7IC5jb21wYXRpYmxlID0gImx2ZHMtZW5jb2Rl
ciIgfSwKLQl7IC5jb21wYXRpYmxlID0gInRoaW5lLHRoYzYzbHZkbTgzZCIgfSwKLQl7fSwKLX07
Ci1NT0RVTEVfREVWSUNFX1RBQkxFKG9mLCBsdmRzX2VuY29kZXJfbWF0Y2gpOwotCi1zdGF0aWMg
c3RydWN0IHBsYXRmb3JtX2RyaXZlciBsdmRzX2VuY29kZXJfZHJpdmVyID0gewotCS5wcm9iZQk9
IGx2ZHNfZW5jb2Rlcl9wcm9iZSwKLQkucmVtb3ZlCT0gbHZkc19lbmNvZGVyX3JlbW92ZSwKLQku
ZHJpdmVyCQk9IHsKLQkJLm5hbWUJCT0gImx2ZHMtZW5jb2RlciIsCi0JCS5vZl9tYXRjaF90YWJs
ZQk9IGx2ZHNfZW5jb2Rlcl9tYXRjaCwKLQl9LAotfTsKLW1vZHVsZV9wbGF0Zm9ybV9kcml2ZXIo
bHZkc19lbmNvZGVyX2RyaXZlcik7Ci0KLU1PRFVMRV9BVVRIT1IoIkxhdXJlbnQgUGluY2hhcnQg
PGxhdXJlbnQucGluY2hhcnRAaWRlYXNvbmJvYXJkLmNvbT4iKTsKLU1PRFVMRV9ERVNDUklQVElP
TigiVHJhbnNwYXJlbnQgcGFyYWxsZWwgdG8gTFZEUyBlbmNvZGVyIik7Ci1NT0RVTEVfTElDRU5T
RSgiR1BMIik7Ci0tIAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
