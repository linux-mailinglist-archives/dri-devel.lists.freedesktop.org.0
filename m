Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1A867C90BB
	for <lists+dri-devel@lfdr.de>; Wed,  2 Oct 2019 20:23:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 299146E192;
	Wed,  2 Oct 2019 18:23:10 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x643.google.com (mail-pl1-x643.google.com
 [IPv6:2607:f8b0:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 82ACC6E192
 for <dri-devel@lists.freedesktop.org>; Wed,  2 Oct 2019 18:23:08 +0000 (UTC)
Received: by mail-pl1-x643.google.com with SMTP id s17so115667plp.6
 for <dri-devel@lists.freedesktop.org>; Wed, 02 Oct 2019 11:23:08 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=Y3au3/M3arsalRuD87xJc7wx3ixOeoJtRJbxPI7LsKM=;
 b=qNG5X7FjH01hfyl0LHGNFXp/mXXoKJSg54lGXdAQ3sgsNER8a8Y9PtP/TqK4Z3Zlx4
 8rE0RG13ZP1xzAxWP5EmwNlI01o4nyefV7Ws6fP0x3/8Mloz713SbnV4d6WsGfYNrwO9
 98SMs3r2HOaVdDBQAvFl9BvuoCkD9tbocvHpFMeINj8RaEwu3WC0P50WsZWWCyAs7wB6
 nNl+qZo1I/prlI50jUdT7UHkj/eE4VtYAgZJ1vO7ayxlfzsnKOiAuE1y2On4a78G9Ev8
 uu1YCtAA8KBAU6Bwcqr/ZcVaQXtmEb/cKfQh1h9Eggu/6FfQILfmnuD0J5w9SAHr1vPm
 J8PA==
X-Gm-Message-State: APjAAAX15clKpzIzvy0tJiWyzdqjVQZXo41Ry64E7nfWCcOHfMFySP89
 xAK5110ho0e4MtGb0LpDIr6CCQ==
X-Google-Smtp-Source: APXvYqxRIO4TFc/oRUwyhYJiZyTphFSzMvVPEFyY39AqCWyX45UdoB6LunxYCWb0DetqurqOTwlZFg==
X-Received: by 2002:a17:902:768a:: with SMTP id
 m10mr5272249pll.234.1570040587203; 
 Wed, 02 Oct 2019 11:23:07 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 q132sm171102pfq.16.2019.10.02.11.23.05
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 02 Oct 2019 11:23:06 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v9 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Wed,  2 Oct 2019 18:22:54 +0000
Message-Id: <20191002182255.21808-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191002182255.21808-1-john.stultz@linaro.org>
References: <20191002182255.21808-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=Y3au3/M3arsalRuD87xJc7wx3ixOeoJtRJbxPI7LsKM=;
 b=BvOLufviFdeIlP65HLzlQlaevk8Z1ynXm3PajSXkiB1ulLF02+Fc+gBYQ8U7N9N7d5
 Xt6NCAGhITa1myv5drGkcSip8MfiyF7AzgmiLqd6skPUZ88O6IZCrSChuDmTZ2rVK/OV
 Dn17PWKmIQnZUlODf7/Xog8ueAaaVFk49UnQKodwVUY9DNeRSFUvMKsw4+ALMs5Dbxsp
 U4Wxtoa1TqkNa405h+Nzrc/NyakSvWwX7wjIzg6zm94KoIxFPTFIr6+cJRoC5MS5VZhk
 M3hUxXJq1MV18gkAB0GY/PhrckeTz0yJLnKGkZkaFsZb7tw0MaQoxYVtaONW9IqA1ZHR
 I5BA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKQ2M6IExhdXJhIEFiYm90
dCA8bGFiYm90dEByZWRoYXQuY29tPgpDYzogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdh
aWduYXJkQGxpbmFyby5vcmc+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8u
b3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IFByYXRpayBQYXRl
bCA8cHJhdGlrcEBjb2RlYXVyb3JhLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IFZpbmNlbnQgRG9ubmVmb3J0IDxWaW5jZW50LkRvbm5lZm9ydEBhcm0u
Y29tPgpDYzogU3VkaXB0byBQYXVsIDxTdWRpcHRvLlBhdWxAYXJtLmNvbT4KQ2M6IEFuZHJldyBG
LiBEYXZpcyA8YWZkQHRpLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFk
Lm9yZz4KQ2M6IENoZW5ibyBGZW5nIDxmZW5nY0Bnb29nbGUuY29tPgpDYzogQWxpc3RhaXIgU3Ry
YWNoYW4gPGFzdHJhY2hhbkBnb29nbGUuY29tPgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlh
QGdvb2dsZS5jb20+CkNjOiBIaWxsZiBEYW50b24gPGhkYW50b25Ac2luYS5jb20+CkNjOiBkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClJldmlld2VkLWJ5OiBCZW5qYW1pbiBHYWlnbmFy
ZCA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4KQWNrZWQtYnk6IExhdXJhIEFiYm90dCA8
bGFiYm90dEByZWRoYXQuY29tPgpUZXN0ZWQtYnk6IEF5YW4gS3VtYXIgSGFsZGVyIDxheWFuLmhh
bGRlckBhcm0uY29tPgpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGlu
YXJvLm9yZz4KLS0tCnYyOgoqIFN3aXRjaCBhbGxvY2F0ZSB0byByZXR1cm4gZG1hYnVmIGZkCiog
U2ltcGxpZnkgaW5pdCBjb2RlCiogQ2hlY2twYXRjaCBmaXh1cHMKdjM6CiogU3dpdGNoIHRvIGlu
bGluZSBmdW5jdGlvbiBmb3IgdG9fY21hX2hlYXAoKQoqIE1pbm9yIGNsZWFudXBzIHN1Z2dlc3Rl
ZCBieSBCcmlhbgoqIEZvbGQgaW4gbmV3IHJlZ2lzdHJhdGlvbiBzdHlsZSBmcm9tIEFuZHJldwoq
IEZvbGRlZCBpbiBjaGFuZ2VzIGZyb20gQW5kcmV3IHRvIHVzZSBzaW1wbGlmaWVkIHBhZ2UgbGlz
dAogIGZyb20gdGhlIGhlYXAgaGVscGVycwp2NDoKKiBVc2UgdGhlIGZkX2ZsYWdzIHdoZW4gY3Jl
YXRpbmcgZG1hYnVmIGZkIChTdWdnZXN0ZWQgYnkKICBCZW5qYW1pbikKKiBVc2UgcHJlY2FsY3Vs
YXRlZCBwYWdlY291bnQgKFN1Z2dlc3RlZCBieSBBbmRyZXcpCnY2OgoqIENoYW5nZWQgdmFyaWFi
bGUgbmFtZXMgdG8gaW1wcm92ZSBjbGFyaXR5LCBhcyBzdWdnZXN0ZWQKICBieSBCcmlhbgp2NzoK
KiBVc2UgbmV3bHkgbG93ZXItY2FzZWQgaW5pdF9oZWFwX2hlbHBlcl9idWZmZXIgaGVscGVyCiog
VXNlIG5ldyBkbWFidWYgZXhwb3J0IGhlbHBlcgp2ODoKKiBNYWtlIHN0cnVjdCBkbWFfaGVhcF9v
cHMgY29uc3QgKFN1Z2dlc3RlZCBieSBDaHJpc3RvcGgpCiogQ29uZGVuc2UgZG1hX2hlYXBfYnVm
ZmVyIGFuZCBoZWFwX2hlbHBlcl9idWZmZXIgKHN1Z2dlc3RlZCBieQogIENocmlzdG9waCkKKiBD
aGVja3BhdGNoIHdoaXRlc3BhY2UgZml4dXBzCnY5OgoqIFJlbW92aW5nIG5lZWRsZXNzIGNoZWNr
IG5vdGVkIGJ5IEJyaWFuIFN0YXJrZXkKKiBSZW5hbWUgZG1hX2hlYXBfZ2V0X2RhdGEtPmRtYV9o
ZWFwX2dldF9kcnZkYXRhIHN1Z2dlc3RlZAogIGJ5IEhpbGYgRGFudG9uCiogQ2hlY2sgc2lnbmFs
cyBhZnRlciBjbGVhcmluZyBtZW1vcnkgcGFnZXMgdG8gYXZvaWQgZG9pbmcKICBuZWVkbGVzcyB3
b3JrIGlmIHRoZSB0YXNrIGlzIGtpbGxlZCBhcyBzdWdnZXN0ZWQgYnkgSGlsZgotLS0KIGRyaXZl
cnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnICAgIHwgICA4ICsrCiBkcml2ZXJzL2RtYS1idWYvaGVh
cHMvTWFrZWZpbGUgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYyB8
IDE2OSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDE3
OCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9kbWEtYnVmL2hlYXBz
L2NtYV9oZWFwLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyBi
L2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmluZGV4IDIwNTA1Mjc0NDE2OS4uYTVlZWYw
NmM0MjI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZworKysgYi9k
cml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtNCwzICs0LDExIEBAIGNvbmZpZyBETUFC
VUZfSEVBUFNfU1lTVEVNCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSB0
aGUgc3lzdGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhlYXAKIAkgIGlzIGJhY2tlZCBieSBw
YWdlcyBmcm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGluIGRvdWJ0LCBzYXkgWS4KKworY29u
ZmlnIERNQUJVRl9IRUFQU19DTUEKKwlib29sICJETUEtQlVGIENNQSBIZWFwIgorCWRlcGVuZHMg
b24gRE1BQlVGX0hFQVBTICYmIERNQV9DTUEKKwloZWxwCisJICBDaG9vc2UgdGhpcyBvcHRpb24g
dG8gZW5hYmxlIGRtYS1idWYgQ01BIGhlYXAuIFRoaXMgaGVhcCBpcyBiYWNrZWQKKwkgIGJ5IHRo
ZSBDb250aWd1b3VzIE1lbW9yeSBBbGxvY2F0b3IgKENNQSkuIElmIHlvdXIgc3lzdGVtIGhhcyB0
aGVzZQorCSAgcmVnaW9ucywgeW91IHNob3VsZCBzYXkgWSBoZXJlLgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2Vm
aWxlCmluZGV4IGQxODA4ZWNhMjU4MS4uNmU1NGNkZWMzZGEwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2RtYS1idWYvaGVhcHMvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2Vm
aWxlCkBAIC0xLDMgKzEsNCBAQAogIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAog
b2JqLXkJCQkJCSs9IGhlYXAtaGVscGVycy5vCiBvYmotJChDT05GSUdfRE1BQlVGX0hFQVBTX1NZ
U1RFTSkJKz0gc3lzdGVtX2hlYXAubworb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQU19DTUEpCQkr
PSBjbWFfaGVhcC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAu
YyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMDAwMC4uM2ZkYjAwZTkzN2M4Ci0tLSAvZGV2L251bGwKKysrIGIvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMKQEAgLTAsMCArMSwxNjkgQEAKKy8vIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogRE1BQlVGIENNQSBoZWFwIGV4cG9y
dGVyCisgKgorICogQ29weXJpZ2h0IChDKSAyMDEyLCAyMDE5IExpbmFybyBMdGQuCisgKiBBdXRo
b3I6IDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPiBmb3IgU1QtRXJpY3Nzb24uCisgKi8K
KworI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4K
KyNpbmNsdWRlIDxsaW51eC9kbWEtaGVhcC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNp
bmNsdWRlIDxsaW51eC9lcnJuby5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUg
PGxpbnV4L2NtYS5oPgorI2luY2x1ZGUgPGxpbnV4L3NjYXR0ZXJsaXN0Lmg+CisjaW5jbHVkZSA8
bGludXgvaGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L3NjaGVkL3NpZ25hbC5oPgorCisjaW5j
bHVkZSAiaGVhcC1oZWxwZXJzLmgiCisKK3N0cnVjdCBjbWFfaGVhcCB7CisJc3RydWN0IGRtYV9o
ZWFwICpoZWFwOworCXN0cnVjdCBjbWEgKmNtYTsKK307CisKK3N0YXRpYyB2b2lkIGNtYV9oZWFw
X2ZyZWUoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXN0cnVjdCBjbWFf
aGVhcCAqY21hX2hlYXAgPSBkbWFfaGVhcF9nZXRfZHJ2ZGF0YShidWZmZXItPmhlYXApOworCXVu
c2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBidWZmZXItPnBhZ2Vjb3VudDsKKwlzdHJ1Y3QgcGFnZSAq
Y21hX3BhZ2VzID0gYnVmZmVyLT5wcml2X3ZpcnQ7CisKKwkvKiBmcmVlIHBhZ2UgbGlzdCAqLwor
CWtmcmVlKGJ1ZmZlci0+cGFnZXMpOworCS8qIHJlbGVhc2UgbWVtb3J5ICovCisJY21hX3JlbGVh
c2UoY21hX2hlYXAtPmNtYSwgY21hX3BhZ2VzLCBucl9wYWdlcyk7CisJa2ZyZWUoYnVmZmVyKTsK
K30KKworLyogZG1hYnVmIGhlYXAgQ01BIG9wZXJhdGlvbnMgZnVuY3Rpb25zICovCitzdGF0aWMg
aW50IGNtYV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKKwkJCSAgICAgdW5z
aWduZWQgbG9uZyBsZW4sCisJCQkgICAgIHVuc2lnbmVkIGxvbmcgZmRfZmxhZ3MsCisJCQkgICAg
IHVuc2lnbmVkIGxvbmcgaGVhcF9mbGFncykKK3sKKwlzdHJ1Y3QgY21hX2hlYXAgKmNtYV9oZWFw
ID0gZG1hX2hlYXBfZ2V0X2RydmRhdGEoaGVhcCk7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZl
ciAqaGVscGVyX2J1ZmZlcjsKKwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzOworCXNpemVfdCBzaXpl
ID0gUEFHRV9BTElHTihsZW4pOworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBzaXplID4+IFBB
R0VfU0hJRlQ7CisJdW5zaWduZWQgbG9uZyBhbGlnbiA9IGdldF9vcmRlcihzaXplKTsKKwlzdHJ1
Y3QgZG1hX2J1ZiAqZG1hYnVmOworCWludCByZXQgPSAtRU5PTUVNOworCXBnb2ZmX3QgcGc7CisK
KwlpZiAoYWxpZ24gPiBDT05GSUdfQ01BX0FMSUdOTUVOVCkKKwkJYWxpZ24gPSBDT05GSUdfQ01B
X0FMSUdOTUVOVDsKKworCWhlbHBlcl9idWZmZXIgPSBremFsbG9jKHNpemVvZigqaGVscGVyX2J1
ZmZlciksIEdGUF9LRVJORUwpOworCWlmICghaGVscGVyX2J1ZmZlcikKKwkJcmV0dXJuIC1FTk9N
RU07CisKKwlpbml0X2hlYXBfaGVscGVyX2J1ZmZlcihoZWxwZXJfYnVmZmVyLCBjbWFfaGVhcF9m
cmVlKTsKKwloZWxwZXJfYnVmZmVyLT5mbGFncyA9IGhlYXBfZmxhZ3M7CisJaGVscGVyX2J1ZmZl
ci0+aGVhcCA9IGhlYXA7CisJaGVscGVyX2J1ZmZlci0+c2l6ZSA9IGxlbjsKKworCWNtYV9wYWdl
cyA9IGNtYV9hbGxvYyhjbWFfaGVhcC0+Y21hLCBucl9wYWdlcywgYWxpZ24sIGZhbHNlKTsKKwlp
ZiAoIWNtYV9wYWdlcykKKwkJZ290byBmcmVlX2J1ZjsKKworCWlmIChQYWdlSGlnaE1lbShjbWFf
cGFnZXMpKSB7CisJCXVuc2lnbmVkIGxvbmcgbnJfY2xlYXJfcGFnZXMgPSBucl9wYWdlczsKKwkJ
c3RydWN0IHBhZ2UgKnBhZ2UgPSBjbWFfcGFnZXM7CisKKwkJd2hpbGUgKG5yX2NsZWFyX3BhZ2Vz
ID4gMCkgeworCQkJdm9pZCAqdmFkZHIgPSBrbWFwX2F0b21pYyhwYWdlKTsKKworCQkJbWVtc2V0
KHZhZGRyLCAwLCBQQUdFX1NJWkUpOworCQkJa3VubWFwX2F0b21pYyh2YWRkcik7CisJCQkvKgor
CQkJICogQXZvaWQgd2FzdGluZyB0aW1lIHplcm9pbmcgbWVtb3J5IGlmIHRoZSBwcm9jZXNzCisJ
CQkgKiBoYXMgYmVlbiBraWxsZWQgYnkgYnkgU0lHS0lMTAorCQkJICovCisJCQlpZiAoZmF0YWxf
c2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQkJZ290byBmcmVlX2NtYTsKKworCQkJcGFnZSsr
OworCQkJbnJfY2xlYXJfcGFnZXMtLTsKKwkJfQorCX0gZWxzZSB7CisJCW1lbXNldChwYWdlX2Fk
ZHJlc3MoY21hX3BhZ2VzKSwgMCwgc2l6ZSk7CisJfQorCisJaGVscGVyX2J1ZmZlci0+cGFnZWNv
dW50ID0gbnJfcGFnZXM7CisJaGVscGVyX2J1ZmZlci0+cGFnZXMgPSBrbWFsbG9jX2FycmF5KGhl
bHBlcl9idWZmZXItPnBhZ2Vjb3VudCwKKwkJCQkJICAgICBzaXplb2YoKmhlbHBlcl9idWZmZXIt
PnBhZ2VzKSwKKwkJCQkJICAgICBHRlBfS0VSTkVMKTsKKwlpZiAoIWhlbHBlcl9idWZmZXItPnBh
Z2VzKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZnJlZV9jbWE7CisJfQorCisJZm9yIChw
ZyA9IDA7IHBnIDwgaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50OyBwZysrKQorCQloZWxwZXJfYnVm
ZmVyLT5wYWdlc1twZ10gPSAmY21hX3BhZ2VzW3BnXTsKKworCS8qIGNyZWF0ZSB0aGUgZG1hYnVm
ICovCisJZG1hYnVmID0gaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1ZihoZWxwZXJfYnVmZmVyLCBm
ZF9mbGFncyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJldCA9IFBUUl9FUlIoZG1hYnVm
KTsKKwkJZ290byBmcmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9idWZmZXItPmRtYWJ1ZiA9IGRt
YWJ1ZjsKKwloZWxwZXJfYnVmZmVyLT5wcml2X3ZpcnQgPSBjbWFfcGFnZXM7CisKKwlyZXQgPSBk
bWFfYnVmX2ZkKGRtYWJ1ZiwgZmRfZmxhZ3MpOworCWlmIChyZXQgPCAwKSB7CisJCWRtYV9idWZf
cHV0KGRtYWJ1Zik7CisJCS8qIGp1c3QgcmV0dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJlbGVhc2Ug
YW5kIHRoYXQgd2lsbCBmcmVlICovCisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIHJldDsK
KworZnJlZV9wYWdlczoKKwlrZnJlZShoZWxwZXJfYnVmZmVyLT5wYWdlcyk7CitmcmVlX2NtYToK
KwljbWFfcmVsZWFzZShjbWFfaGVhcC0+Y21hLCBjbWFfcGFnZXMsIG5yX3BhZ2VzKTsKK2ZyZWVf
YnVmOgorCWtmcmVlKGhlbHBlcl9idWZmZXIpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNtYV9oZWFwX29wcyA9IHsKKwkuYWxsb2NhdGUgPSBj
bWFfaGVhcF9hbGxvY2F0ZSwKK307CisKK3N0YXRpYyBpbnQgX19hZGRfY21hX2hlYXAoc3RydWN0
IGNtYSAqY21hLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hlYXA7CisJ
c3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCisJY21hX2hlYXAgPSBremFs
bG9jKHNpemVvZigqY21hX2hlYXApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNtYV9oZWFwKQorCQly
ZXR1cm4gLUVOT01FTTsKKwljbWFfaGVhcC0+Y21hID0gY21hOworCisJZXhwX2luZm8ubmFtZSA9
IGNtYV9nZXRfbmFtZShjbWEpOworCWV4cF9pbmZvLm9wcyA9ICZjbWFfaGVhcF9vcHM7CisJZXhw
X2luZm8ucHJpdiA9IGNtYV9oZWFwOworCisJY21hX2hlYXAtPmhlYXAgPSBkbWFfaGVhcF9hZGQo
JmV4cF9pbmZvKTsKKwlpZiAoSVNfRVJSKGNtYV9oZWFwLT5oZWFwKSkgeworCQlpbnQgcmV0ID0g
UFRSX0VSUihjbWFfaGVhcC0+aGVhcCk7CisKKwkJa2ZyZWUoY21hX2hlYXApOworCQlyZXR1cm4g
cmV0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFkZF9jbWFfaGVhcHModm9p
ZCkKK3sKKwljbWFfZm9yX2VhY2hfYXJlYShfX2FkZF9jbWFfaGVhcCwgTlVMTCk7CisJcmV0dXJu
IDA7Cit9CitkZXZpY2VfaW5pdGNhbGwoYWRkX2NtYV9oZWFwcyk7Ci0tIAoyLjE3LjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWls
aW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
