Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B0DA7FF8FB
	for <lists+dri-devel@lfdr.de>; Sun, 17 Nov 2019 12:44:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 964AD6E2AF;
	Sun, 17 Nov 2019 11:44:19 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 97EE56E1F8
 for <dri-devel@lists.freedesktop.org>; Sun, 17 Nov 2019 02:41:51 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1]) (Authenticated sender: sre)
 with ESMTPSA id 64A7E28F843
Received: by earth.universe (Postfix, from userid 1000)
 id 20AB03C0CA6; Sun, 17 Nov 2019 03:41:40 +0100 (CET)
From: Sebastian Reichel <sebastian.reichel@collabora.com>
To: Sebastian Reichel <sre@kernel.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>
Subject: [RFCv1 26/42] drm/omap: dsi: do bus locking in host driver
Date: Sun, 17 Nov 2019 03:40:12 +0100
Message-Id: <20191117024028.2233-27-sebastian.reichel@collabora.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191117024028.2233-1-sebastian.reichel@collabora.com>
References: <20191117024028.2233-1-sebastian.reichel@collabora.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 17 Nov 2019 11:44:18 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com, Tony Lindgren <tony@atomide.com>,
 "H. Nikolaus Schaller" <hns@goldelico.com>, Merlijn Wajer <merlijn@wizzup.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 dri-devel@lists.freedesktop.org, linux-omap@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBtb3ZlcyB0aGUgYnVzIGxvY2tpbmcgaW50byB0aGUgaG9zdCBkcml2ZXIgYW5kIHVuZXhw
b3J0cwp0aGUgY3VzdG9tIEFQSSBpbiBwcmVwYXJhdGlvbiBmb3IgZHJtX3BhbmVsIHN1cHBvcnQu
CgpTaWduZWQtb2ZmLWJ5OiBTZWJhc3RpYW4gUmVpY2hlbCA8c2ViYXN0aWFuLnJlaWNoZWxAY29s
bGFib3JhLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9vbWFwZHJtL2Rpc3BsYXlzL3BhbmVsLWRzaS1j
bS5jICAgfCA0NiArLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vb21hcGRybS9k
c3MvZHNpLmMgICAgICAgICAgICAgfCAzMyArKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
b21hcGRybS9kc3Mvb21hcGRzcy5oICAgICAgICAgfCAgMyAtLQogMyBmaWxlcyBjaGFuZ2VkLCAy
MyBpbnNlcnRpb25zKCspLCA1OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vb21hcGRybS9kaXNwbGF5cy9wYW5lbC1kc2ktY20uYyBiL2RyaXZlcnMvZ3B1L2RybS9v
bWFwZHJtL2Rpc3BsYXlzL3BhbmVsLWRzaS1jbS5jCmluZGV4IDc4N2Y5NTMxNjhlYy4uMzYxMDFk
OWJhODRkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kaXNwbGF5cy9wYW5l
bC1kc2ktY20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kaXNwbGF5cy9wYW5lbC1k
c2ktY20uYwpAQCAtMjk4LDcgKzI5OCw2IEBAIHN0YXRpYyBpbnQgZHNpY21fd2FrZV91cChzdHJ1
Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhKQogc3RhdGljIGludCBkc2ljbV9ibF91cGRhdGVfc3Rh
dHVzKHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IHBhbmVsX2Rydl9k
YXRhICpkZGF0YSA9IGRldl9nZXRfZHJ2ZGF0YSgmZGV2LT5kZXYpOwotCXN0cnVjdCBvbWFwX2Rz
c19kZXZpY2UgKnNyYyA9IGRkYXRhLT5zcmM7CiAJaW50IHIgPSAwOwogCWludCBsZXZlbDsKIApA
QCAtMzEzLDE1ICszMTIsMTEgQEAgc3RhdGljIGludCBkc2ljbV9ibF91cGRhdGVfc3RhdHVzKHN0
cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpkZXYpCiAJbXV0ZXhfbG9jaygmZGRhdGEtPmxvY2spOwog
CiAJaWYgKGRkYXRhLT5lbmFibGVkKSB7Ci0JCXNyYy0+b3BzLT5kc2kuYnVzX2xvY2soc3JjKTsK
LQogCQlyID0gZHNpY21fd2FrZV91cChkZGF0YSk7CiAJCWlmICghcikgewogCQkJciA9IGRzaWNt
X2Rjc193cml0ZV8xKGRkYXRhLAogCQkJCU1JUElfRENTX1NFVF9ESVNQTEFZX0JSSUdIVE5FU1Ms
IGxldmVsKTsKIAkJfQotCi0JCXNyYy0+b3BzLT5kc2kuYnVzX3VubG9jayhzcmMpOwogCX0KIAog
CW11dGV4X3VubG9jaygmZGRhdGEtPmxvY2spOwpAQCAtMzQ3LDIxICszNDIsMTYgQEAgc3RhdGlj
IHNzaXplX3QgZHNpY21fbnVtX2Vycm9yc19zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKIHsKIAlzdHJ1Y3QgcGFuZWxf
ZHJ2X2RhdGEgKmRkYXRhID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0Jc3RydWN0IG9tYXBfZHNz
X2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAl1OCBlcnJvcnMgPSAwOwogCWludCByOwogCiAJ
bXV0ZXhfbG9jaygmZGRhdGEtPmxvY2spOwogCiAJaWYgKGRkYXRhLT5lbmFibGVkKSB7Ci0JCXNy
Yy0+b3BzLT5kc2kuYnVzX2xvY2soc3JjKTsKLQogCQlyID0gZHNpY21fd2FrZV91cChkZGF0YSk7
CiAJCWlmICghcikKIAkJCXIgPSBkc2ljbV9kY3NfcmVhZF8xKGRkYXRhLCBEQ1NfUkVBRF9OVU1f
RVJST1JTLAogCQkJCQkmZXJyb3JzKTsKLQotCQlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3Jj
KTsKIAl9IGVsc2UgewogCQlyID0gLUVOT0RFVjsKIAl9CkBAIC0zNzgsMjAgKzM2OCwxNSBAQCBz
dGF0aWMgc3NpemVfdCBkc2ljbV9od19yZXZpc2lvbl9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwK
IAkJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKIHsKIAlzdHJ1Y3Qg
cGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0gZGV2X2dldF9kcnZkYXRhKGRldik7Ci0Jc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAl1OCBpZDEsIGlkMiwgaWQzOwogCWlu
dCByOwogCiAJbXV0ZXhfbG9jaygmZGRhdGEtPmxvY2spOwogCiAJaWYgKGRkYXRhLT5lbmFibGVk
KSB7Ci0JCXNyYy0+b3BzLT5kc2kuYnVzX2xvY2soc3JjKTsKLQogCQlyID0gZHNpY21fd2FrZV91
cChkZGF0YSk7CiAJCWlmICghcikKIAkJCXIgPSBkc2ljbV9nZXRfaWQoZGRhdGEsICZpZDEsICZp
ZDIsICZpZDMpOwotCi0JCXNyYy0+b3BzLT5kc2kuYnVzX3VubG9jayhzcmMpOwogCX0gZWxzZSB7
CiAJCXIgPSAtRU5PREVWOwogCX0KQEAgLTQwOSw3ICszOTQsNiBAQCBzdGF0aWMgc3NpemVfdCBk
c2ljbV9zdG9yZV91bHBzKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJY29uc3QgY2hhciAqYnVmLCBz
aXplX3QgY291bnQpCiB7CiAJc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSA9IGRldl9nZXRf
ZHJ2ZGF0YShkZXYpOwotCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKnNyYyA9IGRkYXRhLT5zcmM7
CiAJdW5zaWduZWQgbG9uZyB0OwogCWludCByOwogCkBAIC00MjAsMTQgKzQwNCwxMCBAQCBzdGF0
aWMgc3NpemVfdCBkc2ljbV9zdG9yZV91bHBzKHN0cnVjdCBkZXZpY2UgKmRldiwKIAltdXRleF9s
b2NrKCZkZGF0YS0+bG9jayk7CiAKIAlpZiAoZGRhdGEtPmVuYWJsZWQpIHsKLQkJc3JjLT5vcHMt
PmRzaS5idXNfbG9jayhzcmMpOwotCiAJCWlmICh0KQogCQkJciA9IGRzaWNtX2VudGVyX3VscHMo
ZGRhdGEpOwogCQllbHNlCiAJCQlyID0gZHNpY21fd2FrZV91cChkZGF0YSk7Ci0KLQkJc3JjLT5v
cHMtPmRzaS5idXNfdW5sb2NrKHNyYyk7CiAJfQogCiAJbXV0ZXhfdW5sb2NrKCZkZGF0YS0+bG9j
ayk7CkBAIC00NTcsNyArNDM3LDYgQEAgc3RhdGljIHNzaXplX3QgZHNpY21fc3RvcmVfdWxwc190
aW1lb3V0KHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291
bnQpCiB7CiAJc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSA9IGRldl9nZXRfZHJ2ZGF0YShk
ZXYpOwotCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKnNyYyA9IGRkYXRhLT5zcmM7CiAJdW5zaWdu
ZWQgbG9uZyB0OwogCWludCByOwogCkBAIC00NzAsOSArNDQ5LDcgQEAgc3RhdGljIHNzaXplX3Qg
ZHNpY21fc3RvcmVfdWxwc190aW1lb3V0KHN0cnVjdCBkZXZpY2UgKmRldiwKIAogCWlmIChkZGF0
YS0+ZW5hYmxlZCkgewogCQkvKiBkc2ljbV93YWtlX3VwIHdpbGwgcmVzdGFydCB0aGUgdGltZXIg
Ki8KLQkJc3JjLT5vcHMtPmRzaS5idXNfbG9jayhzcmMpOwogCQlyID0gZHNpY21fd2FrZV91cChk
ZGF0YSk7Ci0JCXNyYy0+b3BzLT5kc2kuYnVzX3VubG9jayhzcmMpOwogCX0KIAogCW11dGV4X3Vu
bG9jaygmZGRhdGEtPmxvY2spOwpAQCAtNjczLDE3ICs2NTAsMTEgQEAgc3RhdGljIHZvaWQgZHNp
Y21fZGlzY29ubmVjdChzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMsCiBzdGF0aWMgdm9pZCBk
c2ljbV9lbmFibGUoc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQogewogCXN0cnVjdCBw
YW5lbF9kcnZfZGF0YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzc2Rldik7Ci0Jc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAlpbnQgcjsKIAogCW11dGV4X2xvY2so
JmRkYXRhLT5sb2NrKTsKIAotCXNyYy0+b3BzLT5kc2kuYnVzX2xvY2soc3JjKTsKLQogCXIgPSBk
c2ljbV9wb3dlcl9vbihkZGF0YSk7Ci0KLQlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3JjKTsK
LQogCWlmIChyKQogCQlnb3RvIGVycjsKIApAQCAtNzAwLDcgKzY3MSw2IEBAIHN0YXRpYyB2b2lk
IGRzaWNtX2VuYWJsZShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYpCiBzdGF0aWMgdm9p
ZCBkc2ljbV9kaXNhYmxlKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldikKIHsKIAlzdHJ1
Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0gdG9fcGFuZWxfZGF0YShkc3NkZXYpOwotCXN0cnVj
dCBvbWFwX2Rzc19kZXZpY2UgKnNyYyA9IGRkYXRhLT5zcmM7CiAJaW50IHI7CiAKIAlkc2ljbV9i
bF9wb3dlcihkZGF0YSwgZmFsc2UpOwpAQCAtNzA5LDI0ICs2NzksMTkgQEAgc3RhdGljIHZvaWQg
ZHNpY21fZGlzYWJsZShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYpCiAKIAlkc2ljbV9j
YW5jZWxfdWxwc193b3JrKGRkYXRhKTsKIAotCXNyYy0+b3BzLT5kc2kuYnVzX2xvY2soc3JjKTsK
LQogCXIgPSBkc2ljbV93YWtlX3VwKGRkYXRhKTsKIAlpZiAoIXIpCiAJCWRzaWNtX3Bvd2VyX29m
ZihkZGF0YSk7CiAKLQlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3JjKTsKLQogCW11dGV4X3Vu
bG9jaygmZGRhdGEtPmxvY2spOwogfQogCiBzdGF0aWMgdm9pZCBkc2ljbV9mcmFtZWRvbmVfY2Io
aW50IGVyciwgdm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0g
ZGF0YTsKLQlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMgPSBkZGF0YS0+c3JjOwogCiAJZGV2
X2RiZygmZGRhdGEtPmRzaS0+ZGV2LCAiZnJhbWVkb25lLCBlcnIgJWRcbiIsIGVycik7Ci0Jc3Jj
LT5vcHMtPmRzaS5idXNfdW5sb2NrKHNyYyk7CisJbXV0ZXhfdW5sb2NrKCZkZGF0YS0+bG9jayk7
CiB9CiAKIHN0YXRpYyBpbnQgZHNpY21fdXBkYXRlKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRz
c2RldiwKQEAgLTczOSw3ICs3MDQsNiBAQCBzdGF0aWMgaW50IGRzaWNtX3VwZGF0ZShzdHJ1Y3Qg
b21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCiAJZGV2X2RiZygmZGRhdGEtPmRzaS0+ZGV2LCAidXBk
YXRlICVkLCAlZCwgJWQgeCAlZFxuIiwgeCwgeSwgdywgaCk7CiAKIAltdXRleF9sb2NrKCZkZGF0
YS0+bG9jayk7Ci0Jc3JjLT5vcHMtPmRzaS5idXNfbG9jayhzcmMpOwogCiAJciA9IGRzaWNtX3dh
a2VfdXAoZGRhdGEpOwogCWlmIChyKQpAQCAtNzYxLDExICs3MjUsOSBAQCBzdGF0aWMgaW50IGRz
aWNtX3VwZGF0ZShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCiAJaWYgKHIpCiAJCWdv
dG8gZXJyOwogCi0JLyogbm90ZTogbm8gYnVzX3VubG9jayBoZXJlLiB1bmxvY2sgaXMgc3JjIGZy
YW1lZG9uZV9jYiAqLwotCW11dGV4X3VubG9jaygmZGRhdGEtPmxvY2spOworCS8qIG5vdGU6IG5v
IHVubG9jayBoZXJlLiB1bmxvY2sgaXMgc3JjIGZyYW1lZG9uZV9jYiAqLwogCXJldHVybiAwOwog
ZXJyOgotCXNyYy0+b3BzLT5kc2kuYnVzX3VubG9jayhzcmMpOwogCW11dGV4X3VubG9jaygmZGRh
dGEtPmxvY2spOwogCXJldHVybiByOwogfQpAQCAtNzkxLDcgKzc1Myw2IEBAIHN0YXRpYyB2b2lk
IGRzaWNtX3VscHNfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IHBhbmVs
X2Rydl9kYXRhICpkZGF0YSA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgcGFuZWxfZHJ2X2Rh
dGEsCiAJCQl1bHBzX3dvcmsud29yayk7CiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2
ID0gJmRkYXRhLT5kc3NkZXY7Ci0Jc3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEt
PnNyYzsKIAogCW11dGV4X2xvY2soJmRkYXRhLT5sb2NrKTsKIApAQCAtODAwLDExICs3NjEsOCBA
QCBzdGF0aWMgdm9pZCBkc2ljbV91bHBzX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQog
CQlyZXR1cm47CiAJfQogCi0Jc3JjLT5vcHMtPmRzaS5idXNfbG9jayhzcmMpOwotCiAJZHNpY21f
ZW50ZXJfdWxwcyhkZGF0YSk7CiAKLQlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3JjKTsKIAlt
dXRleF91bmxvY2soJmRkYXRhLT5sb2NrKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL29tYXBkcm0vZHNzL2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5j
CmluZGV4IDgwNjAwMDlmYmZiOS4uODM4N2FiZWEyMWE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vb21hcGRybS9kc3MvZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNz
L2RzaS5jCkBAIC00NzksMTcgKzQ3OSwxMyBAQCBzdGF0aWMgaW5saW5lIHUzMiBkc2lfcmVhZF9y
ZWcoc3RydWN0IGRzaV9kYXRhICpkc2ksIGNvbnN0IHN0cnVjdCBkc2lfcmVnIGlkeCkKIAlyZXR1
cm4gX19yYXdfcmVhZGwoYmFzZSArIGlkeC5pZHgpOwogfQogCi1zdGF0aWMgdm9pZCBkc2lfYnVz
X2xvY2soc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQorc3RhdGljIHZvaWQgZHNpX2J1
c19sb2NrKHN0cnVjdCBkc2lfZGF0YSAqZHNpKQogewotCXN0cnVjdCBkc2lfZGF0YSAqZHNpID0g
dG9fZHNpX2RhdGEoZHNzZGV2KTsKLQogCWRvd24oJmRzaS0+YnVzX2xvY2spOwogfQogCi1zdGF0
aWMgdm9pZCBkc2lfYnVzX3VubG9jayhzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYpCitz
dGF0aWMgdm9pZCBkc2lfYnVzX3VubG9jayhzdHJ1Y3QgZHNpX2RhdGEgKmRzaSkKIHsKLQlzdHJ1
Y3QgZHNpX2RhdGEgKmRzaSA9IHRvX2RzaV9kYXRhKGRzc2Rldik7Ci0KIAl1cCgmZHNpLT5idXNf
bG9jayk7CiB9CiAKQEAgLTM4MDUsNiArMzgwMSw4IEBAIHN0YXRpYyB2b2lkIGRzaV9oYW5kbGVf
ZnJhbWVkb25lKHN0cnVjdCBkc2lfZGF0YSAqZHNpLCBpbnQgZXJyb3IpCiAJCVJFR19GTERfTU9E
KGRzaSwgRFNJX1RJTUlORzIsIDEsIDE1LCAxNSk7IC8qIExQX1JYX1RPICovCiAJfQogCisJZHNp
X2J1c191bmxvY2soZHNpKTsKKwogCWRzaS0+ZnJhbWVkb25lX2NhbGxiYWNrKGVycm9yLCBkc2kt
PmZyYW1lZG9uZV9kYXRhKTsKIAogCWlmICghZXJyb3IpCkBAIC0zODY0LDYgKzM4NjIsOCBAQCBz
dGF0aWMgaW50IGRzaV91cGRhdGUoc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LCBpbnQg
Y2hhbm5lbCwKIHsKIAlzdHJ1Y3QgZHNpX2RhdGEgKmRzaSA9IHRvX2RzaV9kYXRhKGRzc2Rldik7
CiAKKwlkc2lfYnVzX2xvY2soZHNpKTsKKwogCWRzaS0+dXBkYXRlX2NoYW5uZWwgPSBjaGFubmVs
OwogCWRzaS0+ZnJhbWVkb25lX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAJZHNpLT5mcmFtZWRvbmVf
ZGF0YSA9IGRhdGE7CkBAIC00NzIzLDEwICs0NzIzLDkgQEAgc3RhdGljIGVudW0gb21hcF9jaGFu
bmVsIGRzaV9nZXRfY2hhbm5lbChzdHJ1Y3QgZHNpX2RhdGEgKmRzaSkKIAl9CiB9CiAKLXN0YXRp
YyBzc2l6ZV90IG9tYXBfZHNpX2hvc3RfdHJhbnNmZXIoc3RydWN0IG1pcGlfZHNpX2hvc3QgKmhv
c3QsCi0JCQkJICAgICAgY29uc3Qgc3RydWN0IG1pcGlfZHNpX21zZyAqbXNnKQorc3RhdGljIHNz
aXplX3QgX29tYXBfZHNpX2hvc3RfdHJhbnNmZXIoc3RydWN0IGRzaV9kYXRhICpkc2ksCisJCQkJ
ICAgICAgIGNvbnN0IHN0cnVjdCBtaXBpX2RzaV9tc2cgKm1zZykKIHsKLQlzdHJ1Y3QgZHNpX2Rh
dGEgKmRzaSA9IGhvc3RfdG9fb21hcChob3N0KTsKIAlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpk
c3NkZXYgPSAmZHNpLT5vdXRwdXQ7CiAJaW50IHI7CiAKQEAgLTQ3NzUsNiArNDc3NCwxOSBAQCBz
dGF0aWMgc3NpemVfdCBvbWFwX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0
ICpob3N0LAogCXJldHVybiAwOwogfQogCitzdGF0aWMgc3NpemVfdCBvbWFwX2RzaV9ob3N0X3Ry
YW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAorCQkJCSAgICAgIGNvbnN0IHN0cnVj
dCBtaXBpX2RzaV9tc2cgKm1zZykKK3sKKwlzdHJ1Y3QgZHNpX2RhdGEgKmRzaSA9IGhvc3RfdG9f
b21hcChob3N0KTsKKwlpbnQgcjsKKworCWRzaV9idXNfbG9jayhkc2kpOworCXIgPSBfb21hcF9k
c2lfaG9zdF90cmFuc2Zlcihkc2ksIG1zZyk7CisJZHNpX2J1c191bmxvY2soZHNpKTsKKworCXJl
dHVybiByOworfQorCiBzdGF0aWMgaW50IGRzaV9nZXRfY2xvY2tzKHN0cnVjdCBkc2lfZGF0YSAq
ZHNpKQogewogCXN0cnVjdCBjbGsgKmNsazsKQEAgLTQ4MDgsOSArNDgyMCw2IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlX29wcyBkc2lfb3BzID0gewogCS5lbmFibGUgPSBk
c2lfZGlzcGxheV9lbmFibGUsCiAKIAkuZHNpID0gewotCQkuYnVzX2xvY2sgPSBkc2lfYnVzX2xv
Y2ssCi0JCS5idXNfdW5sb2NrID0gZHNpX2J1c191bmxvY2ssCi0KIAkJLmRpc2FibGUgPSBkc2lf
ZGlzcGxheV9kaXNhYmxlLAogCiAJCS5zZXRfY29uZmlnID0gZHNpX3NldF9jb25maWcsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21hcGRzcy5oIGIvZHJpdmVycy9n
cHUvZHJtL29tYXBkcm0vZHNzL29tYXBkc3MuaAppbmRleCBjYTUyYjA4YzU3ZGIuLjJkNmFiOTQ4
YTZkZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL29tYXBkc3MuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21hcGRzcy5oCkBAIC0yOTcsOSArMjk3
LDYgQEAgc3RydWN0IG9tYXBkc3NfZHNpX29wcyB7CiAJaW50ICgqdXBkYXRlKShzdHJ1Y3Qgb21h
cF9kc3NfZGV2aWNlICpkc3NkZXYsIGludCBjaGFubmVsLAogCQkJdm9pZCAoKmNhbGxiYWNrKShp
bnQsIHZvaWQgKiksIHZvaWQgKmRhdGEpOwogCi0Jdm9pZCAoKmJ1c19sb2NrKShzdHJ1Y3Qgb21h
cF9kc3NfZGV2aWNlICpkc3NkZXYpOwotCXZvaWQgKCpidXNfdW5sb2NrKShzdHJ1Y3Qgb21hcF9k
c3NfZGV2aWNlICpkc3NkZXYpOwotCiAJaW50ICgqZW5hYmxlX3ZpZGVvX291dHB1dCkoc3RydWN0
IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LCBpbnQgY2hhbm5lbCk7CiAJdm9pZCAoKmRpc2FibGVf
dmlkZW9fb3V0cHV0KShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCiAJCQlpbnQgY2hh
bm5lbCk7Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
