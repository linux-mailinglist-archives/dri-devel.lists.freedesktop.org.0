Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5C57418C155
	for <lists+dri-devel@lfdr.de>; Thu, 19 Mar 2020 21:25:27 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8C48F6EA80;
	Thu, 19 Mar 2020 20:25:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lj1-x242.google.com (mail-lj1-x242.google.com
 [IPv6:2a00:1450:4864:20::242])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 727136EA6C
 for <dri-devel@lists.freedesktop.org>; Thu, 19 Mar 2020 20:25:02 +0000 (UTC)
Received: by mail-lj1-x242.google.com with SMTP id y17so4006610ljk.12
 for <dri-devel@lists.freedesktop.org>; Thu, 19 Mar 2020 13:25:02 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Aa71ZoLxPRsKlYxtfqn0+ltauKST4MT7ZDPjkTacYNM=;
 b=FRHSSvfqFV3drnyPrj3MU8K92Ay20nTQ7ujjiE8qSycGIafxQpvG1w4P2Z0kzZ/M5o
 zB05fZdFvryj2JLZ4YCZIGQ7ilVwlnmCHcB0Md4e5ZJOL87Z9phF2kAzB+JPvQIj7vHZ
 F2n9Hwd+JttVjvIA3Rd19rkF8WSilLNnJp2kwxsktVOo9YvGzDdIn7xTKWSxvggqJT15
 y+WJ93CmITZIqiybtcjK3z8rXAmr4TxpgWLtft5ibTNY2AkKJjBYBLDsRzY9Qvw+lKog
 54Vkz7AE3KvWYakfLZDndYvr+yFZhC/lX+nxRGL8QZPz2jOQcxbkpx6zQgAI9sGejRgW
 wCMA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Aa71ZoLxPRsKlYxtfqn0+ltauKST4MT7ZDPjkTacYNM=;
 b=Kxn1uXGSPHdRm1SCG+BZc4lo8sdfzRXH8zcm221XgBwkwxt/mcM6G+nJNjZF3kJLj1
 YbUdDH3W/x7+DEygIssuZps2ySjqfi23TQI2aSmtIS3uhHMGe45DbcI1Dgr/yOQksRME
 4Z90btu45ceOrIAmbUBAU5A2d+1OER8kbYXFeOL35w42BzwSPK7rVoGrJM4ywaNL/Sn5
 7nWgeDCn9AhTRgJEX3rOUiLDYJZZCwt2XiKGjXseSe52fBhpZ0IN3L+fnz5gRfIwovoC
 fGn4VhvYmq+lHaxyGchCCprqRA8O+LTmj7sqRw8XngWbtYA4k/w0vixQlyLhMNTGooiI
 Wd/w==
X-Gm-Message-State: ANhLgQ3eqs6guDSo0KNvObFsXqbHdNSuvCK210S+6FSfF03TFIy6UJjU
 iRa+eIr+gQaj/qnmPPXOWSsdBtsHuqc=
X-Google-Smtp-Source: ADFU+vueA/IbOIOnzdlLXI5kBRoVGyThmL7H3NKXX9KImW4dLj3P1VZszIw3ml2KbIfgWI5Og39Iqg==
X-Received: by 2002:a2e:b0f7:: with SMTP id h23mr3147480ljl.56.1584649500443; 
 Thu, 19 Mar 2020 13:25:00 -0700 (PDT)
Received: from sroland-t5810.vmware.com (46-126-183-173.dynamic.hispeed.ch.
 [46.126.183.173])
 by smtp.gmail.com with ESMTPSA id v3sm2074372lfp.8.2020.03.19.13.24.59
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 19 Mar 2020 13:24:59 -0700 (PDT)
From: rscheidegger.oss@gmail.com
X-Google-Original-From: sroland@vmware.com
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 10/17] drm/vmwgfx: Add support for indirect and dispatch
 commands
Date: Thu, 19 Mar 2020 21:24:07 +0100
Message-Id: <20200319202414.9296-11-sroland@vmware.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200319202414.9296-1-sroland@vmware.com>
References: <20200319202414.9296-1-sroland@vmware.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-graphics-maintainer@vmware.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGVlcGFrIFJhd2F0IDxkcmF3YXQuZmxvc3NAZ21haWwuY29tPgoKVmFsaWRhdGUgaW5k
aXJlY3QgYW5kIGRpc3BhdGNoIGNvbW1hbmRzIGluIGNvbW1hbmQgYnVmZmVyLgoKU2lnbmVkLW9m
Zi1ieTogRGVlcGFrIFJhd2F0IDxkcmF3YXQuZmxvc3NAZ21haWwuY29tPgpSZXZpZXdlZC1ieTog
VGhvbWFzIEhlbGxzdHLDtm0gKFZNd2FyZSkgPHRob21hc19vc0BzaGlwbWFpbC5vcmc+ClNpZ25l
ZC1vZmYtYnk6IFJvbGFuZCBTY2hlaWRlZ2dlciAoVk13YXJlKSA8cnNjaGVpZGVnZ2VyLm9zc0Bn
bWFpbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZXhlY2J1Zi5jIHwg
NzAgKysrKysrKysrKysrKysrKysrKysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDcwIGluc2VydGlv
bnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9leGVjYnVm
LmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9leGVjYnVmLmMKaW5kZXggZWQ1NmQ5
OTE4YzZhLi5lY2FiNmNiYmM4ZDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngv
dm13Z2Z4X2V4ZWNidWYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9leGVj
YnVmLmMKQEAgLTI4MTYsNiArMjgxNiwxNiBAQCBzdGF0aWMgaW50IHZtd19jbWRfaW50cmFfc3Vy
ZmFjZV9jb3B5KHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICZjbWQtPmJvZHku
c3VyZmFjZS5zaWQsIE5VTEwpOwogfQogCitzdGF0aWMgaW50IHZtd19jbWRfc201KHN0cnVjdCB2
bXdfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCSAgICAgICBzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3
X2NvbnRleHQsCisJCSAgICAgICBTVkdBM2RDbWRIZWFkZXIgKmhlYWRlcikKK3sKKwlpZiAoIWhh
c19zbTVfY29udGV4dChkZXZfcHJpdikpCisJCXJldHVybiAtRUlOVkFMOworCisJcmV0dXJuIDA7
Cit9CisKIHN0YXRpYyBpbnQgdm13X2NtZF9zbTVfdmlld19kZWZpbmUoc3RydWN0IHZtd19wcml2
YXRlICpkZXZfcHJpdiwKIAkJCQkgICBzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3X2NvbnRleHQs
CiAJCQkJICAgU1ZHQTNkQ21kSGVhZGVyICpoZWFkZXIpCkBAIC0yOTM4LDYgKzI5NDgsNTcgQEAg
c3RhdGljIGludCB2bXdfY21kX3NldF9jc191YXYoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJp
diwKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0aWMgaW50IHZtd19jbWRfaW5kZXhlZF9pbnN0YW5j
ZWRfaW5kaXJlY3Qoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICAgICAgc3Ry
dWN0IHZtd19zd19jb250ZXh0ICpzd19jb250ZXh0LAorCQkJCQkgICAgICBTVkdBM2RDbWRIZWFk
ZXIgKmhlYWRlcikKK3sKKwlzdHJ1Y3Qgdm13X2RyYXdfaW5kZXhlZF9pbnN0YW5jZWRfaW5kaXJl
Y3RfY21kIHsKKwkJU1ZHQTNkQ21kSGVhZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21kRFhEcmF3SW5k
ZXhlZEluc3RhbmNlZEluZGlyZWN0IGJvZHk7CisJfSAqY21kID0gY29udGFpbmVyX29mKGhlYWRl
ciwgdHlwZW9mKCpjbWQpLCBoZWFkZXIpOworCisJaWYgKCFoYXNfc201X2NvbnRleHQoZGV2X3By
aXYpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiB2bXdfY21kX3Jlc19jaGVjayhkZXZf
cHJpdiwgc3dfY29udGV4dCwgdm13X3Jlc19zdXJmYWNlLAorCQkJCSBWTVdfUkVTX0RJUlRZX05P
TkUsIHVzZXJfc3VyZmFjZV9jb252ZXJ0ZXIsCisJCQkJICZjbWQtPmJvZHkuYXJnc0J1ZmZlclNp
ZCwgTlVMTCk7Cit9CisKK3N0YXRpYyBpbnQgdm13X2NtZF9pbnN0YW5jZWRfaW5kaXJlY3Qoc3Ry
dWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgICAgICBzdHJ1Y3Qgdm13X3N3X2NvbnRl
eHQgKnN3X2NvbnRleHQsCisJCQkJICAgICAgU1ZHQTNkQ21kSGVhZGVyICpoZWFkZXIpCit7CisJ
c3RydWN0IHZtd19kcmF3X2luc3RhbmNlZF9pbmRpcmVjdF9jbWQgeworCQlTVkdBM2RDbWRIZWFk
ZXIgaGVhZGVyOworCQlTVkdBM2RDbWREWERyYXdJbnN0YW5jZWRJbmRpcmVjdCBib2R5OworCX0g
KmNtZCA9IGNvbnRhaW5lcl9vZihoZWFkZXIsIHR5cGVvZigqY21kKSwgaGVhZGVyKTsKKworCWlm
ICghaGFzX3NtNV9jb250ZXh0KGRldl9wcml2KSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXR1
cm4gdm13X2NtZF9yZXNfY2hlY2soZGV2X3ByaXYsIHN3X2NvbnRleHQsIHZtd19yZXNfc3VyZmFj
ZSwKKwkJCQkgVk1XX1JFU19ESVJUWV9OT05FLCB1c2VyX3N1cmZhY2VfY29udmVydGVyLAorCQkJ
CSAmY21kLT5ib2R5LmFyZ3NCdWZmZXJTaWQsIE5VTEwpOworfQorCitzdGF0aWMgaW50IHZtd19j
bWRfZGlzcGF0Y2hfaW5kaXJlY3Qoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkg
ICAgIHN0cnVjdCB2bXdfc3dfY29udGV4dCAqc3dfY29udGV4dCwKKwkJCQkgICAgIFNWR0EzZENt
ZEhlYWRlciAqaGVhZGVyKQoreworCXN0cnVjdCB2bXdfZGlzcGF0Y2hfaW5kaXJlY3RfY21kIHsK
KwkJU1ZHQTNkQ21kSGVhZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21kRFhEaXNwYXRjaEluZGlyZWN0
IGJvZHk7CisJfSAqY21kID0gY29udGFpbmVyX29mKGhlYWRlciwgdHlwZW9mKCpjbWQpLCBoZWFk
ZXIpOworCisJaWYgKCFoYXNfc201X2NvbnRleHQoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVJTlZB
TDsKKworCXJldHVybiB2bXdfY21kX3Jlc19jaGVjayhkZXZfcHJpdiwgc3dfY29udGV4dCwgdm13
X3Jlc19zdXJmYWNlLAorCQkJCSBWTVdfUkVTX0RJUlRZX05PTkUsIHVzZXJfc3VyZmFjZV9jb252
ZXJ0ZXIsCisJCQkJICZjbWQtPmJvZHkuYXJnc0J1ZmZlclNpZCwgTlVMTCk7Cit9CisKIHN0YXRp
YyBpbnQgdm13X2NtZF9jaGVja19ub3RfM2Qoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwK
IAkJCQlzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3X2NvbnRleHQsCiAJCQkJdm9pZCAqYnVmLCB1
aW50MzJfdCAqc2l6ZSkKQEAgLTMzMDMsOCArMzM2NCwxNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IHZtd19jbWRfZW50cnkgdm13X2NtZF9lbnRyaWVzW1NWR0FfM0RfQ01EX01BWF0gPSB7CiAJCSAg
ICBmYWxzZSwgdHJ1ZSksCiAJVk1XX0NNRF9ERUYoU1ZHQV8zRF9DTURfRFhfU0VUX1VBX1ZJRVdT
LCAmdm13X2NtZF9zZXRfdWF2LCB0cnVlLCBmYWxzZSwKIAkJICAgIHRydWUpLAorCVZNV19DTURf
REVGKFNWR0FfM0RfQ01EX0RYX0RSQVdfSU5ERVhFRF9JTlNUQU5DRURfSU5ESVJFQ1QsCisJCSAg
ICAmdm13X2NtZF9pbmRleGVkX2luc3RhbmNlZF9pbmRpcmVjdCwgdHJ1ZSwgZmFsc2UsIHRydWUp
LAorCVZNV19DTURfREVGKFNWR0FfM0RfQ01EX0RYX0RSQVdfSU5TVEFOQ0VEX0lORElSRUNULAor
CQkgICAgJnZtd19jbWRfaW5zdGFuY2VkX2luZGlyZWN0LCB0cnVlLCBmYWxzZSwgdHJ1ZSksCisJ
Vk1XX0NNRF9ERUYoU1ZHQV8zRF9DTURfRFhfRElTUEFUQ0gsICZ2bXdfY21kX3NtNSwgdHJ1ZSwg
ZmFsc2UsIHRydWUpLAorCVZNV19DTURfREVGKFNWR0FfM0RfQ01EX0RYX0RJU1BBVENIX0lORElS
RUNULAorCQkgICAgJnZtd19jbWRfZGlzcGF0Y2hfaW5kaXJlY3QsIHRydWUsIGZhbHNlLCB0cnVl
KSwKIAlWTVdfQ01EX0RFRihTVkdBXzNEX0NNRF9EWF9TRVRfQ1NfVUFfVklFV1MsICZ2bXdfY21k
X3NldF9jc191YXYsIHRydWUsCiAJCSAgICBmYWxzZSwgdHJ1ZSksCisJVk1XX0NNRF9ERUYoU1ZH
QV8zRF9DTURfRFhfREVGSU5FX0RFUFRIU1RFTkNJTF9WSUVXX1YyLAorCQkgICAgJnZtd19jbWRf
c201X3ZpZXdfZGVmaW5lLCB0cnVlLCBmYWxzZSwgdHJ1ZSksCiB9OwogCiBib29sIHZtd19jbWRf
ZGVzY3JpYmUoY29uc3Qgdm9pZCAqYnVmLCB1MzIgKnNpemUsIGNoYXIgY29uc3QgKipjbWQpCi0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
