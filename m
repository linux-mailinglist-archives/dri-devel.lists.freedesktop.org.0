Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 724DCF1229
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 10:31:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5FFA86EC75;
	Wed,  6 Nov 2019 09:31:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9E6B16EC76
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 09:31:26 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 08E98B3D6;
 Wed,  6 Nov 2019 09:31:25 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch,
	christian.koenig@amd.com,
	noralf@tronnes.org
Subject: [PATCH 1/8] drm/vram-helper: Tell caller if vmap() returned I/O memory
Date: Wed,  6 Nov 2019 10:31:14 +0100
Message-Id: <20191106093121.21762-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106093121.21762-1-tzimmermann@suse.de>
References: <20191106093121.21762-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV0dXJuaW5nIGEgZmxhZyBmcm9tIGttYXAoKSB3aGV0aGVyIG1hcHBlZCBwYWdlcyByZWZlciB0
byBzeXN0ZW0gb3IKSS9PIG1lbW9yeS4gVGhpcyBwcmVwYXJlcyBmb3IgYSByZXNwZWN0aXZlIGNo
YW5nZSB0byB2bWFwKCkuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1l
cm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tb2RlLmMgICAgICAg
ICAgIHwgNiArKystLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgICAg
fCA4ICsrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2N1cnNvci5jIHwg
NCArKy0tCiBpbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmggICAgICAgIHwgMiArLQog
NCBmaWxlcyBjaGFuZ2VkLCAxMSBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
c3QvYXN0X21vZGUuYwppbmRleCBiMTNlYWEyNjE5YWIuLmJjZmFiNjQxYzNhOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
c3QvYXN0X21vZGUuYwpAQCAtMTE2NSw3ICsxMTY1LDcgQEAgc3RhdGljIGludCBhc3Rfc2hvd19j
dXJzb3Ioc3RydWN0IGRybV9jcnRjICpjcnRjLCB2b2lkICpzcmMsCiAJdTgganJlZzsKIAogCWdi
byA9IGFzdC0+Y3Vyc29yLmdib1thc3QtPmN1cnNvci5uZXh0X2luZGV4XTsKLQlkc3QgPSBkcm1f
Z2VtX3ZyYW1fdm1hcChnYm8pOworCWRzdCA9IGRybV9nZW1fdnJhbV92bWFwKGdibywgTlVMTCk7
CiAJaWYgKElTX0VSUihkc3QpKQogCQlyZXR1cm4gUFRSX0VSUihkc3QpOwogCW9mZiA9IGRybV9n
ZW1fdnJhbV9vZmZzZXQoZ2JvKTsKQEAgLTEyMzEsNyArMTIzMSw3IEBAIHN0YXRpYyBpbnQgYXN0
X2N1cnNvcl9zZXQoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQlyZXR1cm4gLUVOT0VOVDsKIAl9
CiAJZ2JvID0gZHJtX2dlbV92cmFtX29mX2dlbShvYmopOwotCXNyYyA9IGRybV9nZW1fdnJhbV92
bWFwKGdibyk7CisJc3JjID0gZHJtX2dlbV92cmFtX3ZtYXAoZ2JvLCBOVUxMKTsKIAlpZiAoSVNf
RVJSKHNyYykpIHsKIAkJcmV0ID0gUFRSX0VSUihzcmMpOwogCQlnb3RvIGVycl9kcm1fZ2VtX29i
amVjdF9wdXRfdW5sb2NrZWQ7CkBAIC0xMjY0LDcgKzEyNjQsNyBAQCBzdGF0aWMgaW50IGFzdF9j
dXJzb3JfbW92ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJdTgganJlZzsKIAogCWdibyA9IGFz
dC0+Y3Vyc29yLmdib1thc3QtPmN1cnNvci5uZXh0X2luZGV4XTsKLQlkc3QgPSBkcm1fZ2VtX3Zy
YW1fdm1hcChnYm8pOworCWRzdCA9IGRybV9nZW1fdnJhbV92bWFwKGdibywgTlVMTCk7CiAJaWYg
KElTX0VSUihkc3QpKQogCQlyZXR1cm4gUFRSX0VSUihkc3QpOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9n
ZW1fdnJhbV9oZWxwZXIuYwppbmRleCA2NjZjYjRjMjJiYjkuLjA1ZjYzZjI4ODE0ZCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC00MTEsNiArNDExLDggQEAgRVhQT1JU
X1NZTUJPTChkcm1fZ2VtX3ZyYW1fa3VubWFwKTsKICAqIGRybV9nZW1fdnJhbV92bWFwKCkgLSBQ
aW5zIGFuZCBtYXBzIGEgR0VNIFZSQU0gb2JqZWN0IGludG8ga2VybmVsIGFkZHJlc3MKICAqICAg
ICAgICAgICAgICAgICAgICAgICBzcGFjZQogICogQGdibzoJVGhlIEdFTSBWUkFNIG9iamVjdCB0
byBtYXAKKyAqIEBpc19pb21lbToJcmV0dXJucyB0cnVlIGlmIHRoZSBtYXBwZWQgbWVtb3J5IGlz
IEkvTyBtZW1vcnksIG9yIGZhbHNlCisgKiAgICAgICAgICAgICAgb3RoZXJ3aXNlOyBjYW4gYmUg
TlVMTAogICoKICAqIFRoZSB2bWFwIGZ1bmN0aW9uIHBpbnMgYSBHRU0gVlJBTSBvYmplY3QgdG8g
aXRzIGN1cnJlbnQgbG9jYXRpb24sIGVpdGhlcgogICogc3lzdGVtIG9yIHZpZGVvIG1lbW9yeSwg
YW5kIG1hcHMgaXRzIGJ1ZmZlciBpbnRvIGtlcm5lbCBhZGRyZXNzIHNwYWNlLgpAQCAtNDI1LDcg
KzQyNyw3IEBAIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92cmFtX2t1bm1hcCk7CiAgKiBUaGUgYnVm
ZmVyJ3MgdmlydHVhbCBhZGRyZXNzIG9uIHN1Y2Nlc3MsIG9yCiAgKiBhbiBFUlJfUFRSKCktZW5j
b2RlZCBlcnJvciBjb2RlIG90aGVyd2lzZS4KICAqLwotdm9pZCAqZHJtX2dlbV92cmFtX3ZtYXAo
c3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibykKK3ZvaWQgKmRybV9nZW1fdnJhbV92bWFw
KHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8sIGJvb2wgKmlzX2lvbWVtKQogewogCWlu
dCByZXQ7CiAJdm9pZCAqYmFzZTsKQEAgLTQzNyw3ICs0MzksNyBAQCB2b2lkICpkcm1fZ2VtX3Zy
YW1fdm1hcChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvKQogCXJldCA9IGRybV9nZW1f
dnJhbV9waW5fbG9ja2VkKGdibywgMCk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJfdHRtX2JvX3Vu
cmVzZXJ2ZTsKLQliYXNlID0gZHJtX2dlbV92cmFtX2ttYXBfbG9ja2VkKGdibywgdHJ1ZSwgTlVM
TCk7CisJYmFzZSA9IGRybV9nZW1fdnJhbV9rbWFwX2xvY2tlZChnYm8sIHRydWUsIGlzX2lvbWVt
KTsKIAlpZiAoSVNfRVJSKGJhc2UpKSB7CiAJCXJldCA9IFBUUl9FUlIoYmFzZSk7CiAJCWdvdG8g
ZXJyX2RybV9nZW1fdnJhbV91bnBpbl9sb2NrZWQ7CkBAIC04MjYsNyArODI4LDcgQEAgc3RhdGlj
IHZvaWQgKmRybV9nZW1fdnJhbV9vYmplY3Rfdm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdl
bSkKIAlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvID0gZHJtX2dlbV92cmFtX29mX2dl
bShnZW0pOwogCXZvaWQgKmJhc2U7CiAKLQliYXNlID0gZHJtX2dlbV92cmFtX3ZtYXAoZ2JvKTsK
KwliYXNlID0gZHJtX2dlbV92cmFtX3ZtYXAoZ2JvLCBOVUxMKTsKIAlpZiAoSVNfRVJSKGJhc2Up
KQogCQlyZXR1cm4gTlVMTDsKIAlyZXR1cm4gYmFzZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29yLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9t
Z2FnMjAwX2N1cnNvci5jCmluZGV4IDc5NzExZGJiNWIwMy4uNzY1YzU5ZTI1ZjNiIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2N1cnNvci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29yLmMKQEAgLTEzMSw3ICsxMzEsNyBAQCBz
dGF0aWMgaW50IG1nYWcyMDBfc2hvd19jdXJzb3Ioc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYsIHZv
aWQgKnNyYywKIAkJV1JFRzgoTUdBX0NVUlBPU1hILCAwKTsKIAkJcmV0dXJuIC1FTk9UU1VQUDsg
LyogRGlkbid0IGFsbG9jYXRlIHNwYWNlIGZvciBjdXJzb3JzICovCiAJfQotCWRzdCA9IGRybV9n
ZW1fdnJhbV92bWFwKGdibyk7CisJZHN0ID0gZHJtX2dlbV92cmFtX3ZtYXAoZ2JvLCBOVUxMKTsK
IAlpZiAoSVNfRVJSKGRzdCkpIHsKIAkJcmV0ID0gUFRSX0VSUihkc3QpOwogCQlkZXZfZXJyKCZk
ZXYtPnBkZXYtPmRldiwKQEAgLTI4Miw3ICsyODIsNyBAQCBpbnQgbWdhZzIwMF9jcnRjX2N1cnNv
cl9zZXQoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwK
IAlpZiAoIW9iaikKIAkJcmV0dXJuIC1FTk9FTlQ7CiAJZ2JvID0gZHJtX2dlbV92cmFtX29mX2dl
bShvYmopOwotCXNyYyA9IGRybV9nZW1fdnJhbV92bWFwKGdibyk7CisJc3JjID0gZHJtX2dlbV92
cmFtX3ZtYXAoZ2JvLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHNyYykpIHsKIAkJcmV0ID0gUFRSX0VS
UihzcmMpOwogCQlkZXZfZXJyKCZkZXYtPnBkZXYtPmRldiwKZGlmZiAtLWdpdCBhL2luY2x1ZGUv
ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaCBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxw
ZXIuaAppbmRleCBlMDQwNTQxYTEwNWYuLmVmOGY4MWFjZmY5MSAxMDA2NDQKLS0tIGEvaW5jbHVk
ZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJh
bV9oZWxwZXIuaApAQCAtMTA2LDcgKzEwNiw3IEBAIGludCBkcm1fZ2VtX3ZyYW1fdW5waW4oc3Ry
dWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibyk7CiB2b2lkICpkcm1fZ2VtX3ZyYW1fa21hcChz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvLCBib29sIG1hcCwKIAkJCWJvb2wgKmlzX2lv
bWVtKTsKIHZvaWQgZHJtX2dlbV92cmFtX2t1bm1hcChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVj
dCAqZ2JvKTsKLXZvaWQgKmRybV9nZW1fdnJhbV92bWFwKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2Jq
ZWN0ICpnYm8pOwordm9pZCAqZHJtX2dlbV92cmFtX3ZtYXAoc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmdibywgYm9vbCAqaXNfaW9tZW0pOwogdm9pZCBkcm1fZ2VtX3ZyYW1fdnVubWFwKHN0
cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8sIHZvaWQgKnZhZGRyKTsKIAogaW50IGRybV9n
ZW1fdnJhbV9maWxsX2NyZWF0ZV9kdW1iKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKLS0gCjIuMjMu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
