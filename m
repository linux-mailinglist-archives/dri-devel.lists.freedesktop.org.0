Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 916455F376
	for <lists+dri-devel@lfdr.de>; Thu,  4 Jul 2019 09:25:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B5D416E27A;
	Thu,  4 Jul 2019 07:25:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 4A0486E149;
 Wed,  3 Jul 2019 14:13:28 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id B96232B;
 Wed,  3 Jul 2019 07:13:27 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 00F853F718;
 Wed,  3 Jul 2019 07:13:26 -0700 (PDT)
Subject: Re: [RFC PATCH] mesa: Export BOs in RW mode
To: Boris Brezillon <boris.brezillon@collabora.com>,
 Rob Herring <robh+dt@kernel.org>
References: <20190703133357.10217-1-boris.brezillon@collabora.com>
 <CAL_JsqLb3qjzp8+9mj3SA=E_avsF7VnC=vji9YvePHvoiqgNgg@mail.gmail.com>
 <20190703155616.1ed02d49@collabora.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <12e0bb1f-9a71-a120-7012-397fa0a16fd9@arm.com>
Date: Wed, 3 Jul 2019 15:13:25 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190703155616.1ed02d49@collabora.com>
Content-Language: en-GB
X-Mailman-Approved-At: Thu, 04 Jul 2019 07:25:13 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: ML mesa-dev <mesa-dev@lists.freedesktop.org>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 dri-devel <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMDMvMDcvMjAxOSAxNDo1NiwgQm9yaXMgQnJlemlsbG9uIHdyb3RlOgo+IE9uIFdlZCwgMyBK
dWwgMjAxOSAwNzo0NTozMiAtMDYwMAo+IFJvYiBIZXJyaW5nIDxyb2JoK2R0QGtlcm5lbC5vcmc+
IHdyb3RlOgo+IAo+PiBPbiBXZWQsIEp1bCAzLCAyMDE5IGF0IDc6MzQgQU0gQm9yaXMgQnJlemls
bG9uCj4+IDxib3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4gd3JvdGU6Cj4+Pgo+Pj4gRXhw
b3J0ZWQgQk9zIG1pZ2h0IGJlIGltcG9ydGVkIGJhY2ssIHRoZW4gbW1hcCgpLWVkIHRvIGJlIHdy
aXR0ZW4KPj4+IHRvby4gTW9zdCBkcml2ZXJzIGhhbmRsZSB0aGF0IGJ5IG1tYXAoKS1pbmcgdGhl
IEdFTSBoYW5kbGUgYWZ0ZXIgaXQncwo+Pj4gYmVlbiBpbXBvcnRlZCwgYnV0LCBhY2NvcmRpbmcg
dG8gWzFdLCB0aGlzIGlzIGlsbGVnYWwuICAKPj4KPj4gSXQncyBub3QgaWxsZWdhbCwgYnV0IGlz
IHN1cHBvc2VkIHRvIGdvIHRocnUgdGhlIGRtYWJ1ZiBtbWFwCj4+IGZ1bmN0aW9ucy4KPiAKPiBU
aGF0J3MgYmFzaWNhbGx5IHdoYXQgSSdtIHByb3Bvc2luZyBoZXJlLCBqdXN0IGRpZG4ndCBwb3N0
IHRoZSBwYXRjaAo+IHNraXBwaW5nIHRoZSBHRVRfT0ZGU0VUIHN0ZXAgYW5kIGRvaW5nIHRoZSBt
bWFwKCkgb24gdGhlIGRtYWJ1ZiBGRAo+IGluc3RlYWQgb2YgdGhlIERSTS1ub2RlIG9uZSwgYnV0
IEkgaGF2ZSBpdCB3b3JraW5nIGZvciBwYW5mcm9zdC4KCklmIHdlIHdhbnQgdG8gd2UgY291bGQg
bWFrZSB0aGUgUGFuZnJvc3Qga2VybmVsIGRyaXZlciBpbnRlcm5hbGx5IGNhbGwKZG1hX2J1Zl9t
bWFwKCkgc28gdGhhdCBtYXBwaW5nIHVzaW5nIHRoZSBEUk0tbm9kZSAianVzdCB3b3JrcyIuIFRo
aXMgaXMKaW5kZWVkIHdoYXQgdGhlIGtiYXNlIGRyaXZlciBkb2VzLgoKPj4gSG93ZXZlciwgbm9u
ZSBvZiB0aGUgZHJpdmVyIEkndmUgbG9va2VkIGF0IChldG5hdml2LCBtc20sCj4+IHYzZCwgdmdl
bSkgZG8gdGhhdC4gSXQgcHJvYmFibHkgd29ya3MgYmVjYXVzZSBpdCdzIHRoZSBzYW1lIGRyaXZl
cgo+PiBkb2luZyB0aGUgaW1wb3J0IGFuZCBleHBvcnQgb3IgYm90aCBkcml2ZXJzIGhhdmUgZXNz
ZW50aWFsbHkgdGhlIHNhbWUKPj4gaW1wbGVtZW50YXRpb25zLgo+IAo+IFllcywgYnV0IG1heWJl
IHRoYXQncyBzb21ldGhpbmcgd2Ugc2hvdWxkIHN0YXJ0IGZpeGluZyBpZiBtbWFwKCktaW5nCj4g
dGhlIGRtYWJ1ZiBpcyB0aGUgcmVjb21tZW5kZWQgc29sdXRpb24uCgpJJ20gb3BlbiB0byBvcHRp
b25zIGhlcmUuIFVzZXIgc3BhY2UgY2FsbGluZyBtbWFwKCkgb24gdGhlIGRtYV9idWYgZmlsZQpk
ZXNjcmlwdG9yIHNob3VsZCBhbHdheXMgYmUgc2FmZSAodGhlIGV4cG9ydGVyIGNhbiBkbyB3aGF0
ZXZlciBpcwpuZWNlc3NhcnkgdG8gbWFrZSBpdCB3b3JrKS4gSWYgdGhhdCBoYXBwZW5zIHRoZW4g
dGhlIHBhdGNoZXMgSSBwb3N0ZWQKY2xvc2Ugb2ZmIHRoZSBEUk0gbm9kZSB2ZXJzaW9uIHdoaWNo
IGNvdWxkIGJlIGJyb2tlbiBpZiB0aGUgZXhwb3J0ZXIKbmVlZHMgdG8gZG8gYW55dGhpbmcgdG8g
cHJlcGFyZSB0aGUgYnVmZmVyIGZvciBDUFUgYWNjZXNzIChpLmUuIGNhY2hlCm1haW50ZW5hbmNl
KS4KCkFsdGVybmF0aXZlbHkgaWYgdXNlciBzcGFjZSB3YW50cy9uZWVkcyB0byB1c2UgdGhlIERN
QSBub2RlIHRoZW4gd2UgY2FuCnRha2UgYSBsb29rIGF0IHdoYXQgbmVlZHMgdG8gY2hhbmdlIGlu
IHRoZSBrZXJuZWwuIEZyb20gYSBxdWljayBsb29rIGF0CnRoZSBjb2RlIGl0IHNlZW1zIHdlJ2Qg
bmVlZCB0byBzcGxpdCBkcm1fZ2VtX21tYXAoKSBpbnRvIGEgaGVscGVyIHNvCnRoYXQgaXQgY2Fu
IHJldHVybiB3aGV0aGVyIHRoZSBleHBvcnRlciBpcyBoYW5kbGluZyBldmVyeXRoaW5nIG9yIGlm
IHRoZQpjYWxsZXIgbmVlZHMgdG8gZG8gc29tZSBtb3JlIHdvcmsgKGUuZy4gZHJtX2dlbV9zaG1l
bV9tbWFwKCkgbmVlZHMgdG8KYWxsb2NhdGUgYmFja2luZyBwYWdlcykuIEJ1dCBiZWNhdXNlIGRy
bV9nZW1fbW1hcCgpIGlzIHVzZWQgYXMgdGhlCmRpcmVjdCBjYWxsYmFjayBmb3Igc29tZSBkcml2
ZXJzIHdlJ2QgbmVlZCB0byBwcmVzZXJ2ZSB0aGUgaW50ZXJmYWNlLgoKVGhlIGJlbG93IChjb21w
bGV0ZWx5IHVudGVzdGVkKSBwYXRjaCBkZW1vbnN0cmF0ZXMgdGhlIGlkZWEuCgpTdGV2ZQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJt
X2dlbS5jCmluZGV4IGE4YzQ0NjhmMDNkOS4uZGY2NjFlMjRjYWRmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMKQEAg
LTExNDAsNyArMTE0MCw3IEBAIEVYUE9SVF9TWU1CT0woZHJtX2dlbV9tbWFwX29iaik7CiAgKiBJ
ZiB0aGUgY2FsbGVyIGlzIG5vdCBncmFudGVkIGFjY2VzcyB0byB0aGUgYnVmZmVyIG9iamVjdCwg
dGhlIG1tYXAKd2lsbCBmYWlsCiAgKiB3aXRoIEVBQ0NFUy4gUGxlYXNlIHNlZSB0aGUgdm1hIG1h
bmFnZXIgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgKi8KLWludCBkcm1fZ2VtX21tYXAoc3RydWN0
IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQoraW50IGRybV9nZW1fbW1h
cF9oZWxwZXIoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQog
ewogCXN0cnVjdCBkcm1fZmlsZSAqcHJpdiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKIAlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gcHJpdi0+bWlub3ItPmRldjsKQEAgLTExODksNiArMTE4OSwxMSBA
QCBpbnQgZHJtX2dlbV9tbWFwKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3QKdm1fYXJlYV9zdHJ1
Y3QgKnZtYSkKIAkJdm1hLT52bV9mbGFncyAmPSB+Vk1fTUFZV1JJVEU7CiAJfQoKKwlpZiAob2Jq
LT5pbXBvcnRfYXR0YWNoKSB7CisJCXJldCA9IGRtYV9idWZfbW1hcChvYmotPmRtYV9idWYsIHZt
YSwgMCk7CisJCXJldHVybiByZXQ/OjE7CisJfQorCiAJcmV0ID0gZHJtX2dlbV9tbWFwX29iaihv
YmosIGRybV92bWFfbm9kZV9zaXplKG5vZGUpIDw8IFBBR0VfU0hJRlQsCiAJCQkgICAgICAgdm1h
KTsKCkBAIC0xMTk2LDYgKzEyMDEsMTYgQEAgaW50IGRybV9nZW1fbW1hcChzdHJ1Y3QgZmlsZSAq
ZmlscCwgc3RydWN0CnZtX2FyZWFfc3RydWN0ICp2bWEpCgogCXJldHVybiByZXQ7CiB9CisKK2lu
dCBkcm1fZ2VtX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
dm1hKQoreworCWludCByZXQ7CisKKwlyZXQgPSBkcm1fZ2VtX21tYXBfaGVscGVyKGZpbHAsIHZt
YSk7CisJaWYgKHJldCA9PSAxKQorCQlyZXR1cm4gMDsKKwlyZXR1cm4gcmV0OworfQogRVhQT1JU
X1NZTUJPTChkcm1fZ2VtX21tYXApOwoKIHZvaWQgZHJtX2dlbV9wcmludF9pbmZvKHN0cnVjdCBk
cm1fcHJpbnRlciAqcCwgdW5zaWduZWQgaW50IGluZGVudCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5jCmIvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1f
c2htZW1faGVscGVyLmMKaW5kZXggNDcyZWE1ZDgxZjgyLi5iODVkODRlNGQ0YTggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5jCkBAIC00NjYsOCArNDY2LDEwIEBAIGludCBk
cm1fZ2VtX3NobWVtX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdAp2bV9hcmVhX3N0cnVj
dCAqdm1hKQogCXN0cnVjdCBkcm1fZ2VtX3NobWVtX29iamVjdCAqc2htZW07CiAJaW50IHJldDsK
Ci0JcmV0ID0gZHJtX2dlbV9tbWFwKGZpbHAsIHZtYSk7Ci0JaWYgKHJldCkKKwlyZXQgPSBkcm1f
Z2VtX21tYXBfaGVscGVyKGZpbHAsIHZtYSk7CisJaWYgKHJldCA9PSAxKQorCQlyZXR1cm4gMDsg
LyogRXhwb3J0ZXIgaGFuZGxlcyB0aGUgbWFwcGluZyAqLworCWVsc2UgaWYgKHJldCkKIAkJcmV0
dXJuIHJldDsKCiAJc2htZW0gPSB0b19kcm1fZ2VtX3NobWVtX29iaih2bWEtPnZtX3ByaXZhdGVf
ZGF0YSk7Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRy
aS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
