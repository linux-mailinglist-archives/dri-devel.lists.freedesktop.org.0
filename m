Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 97290B4DFA
	for <lists+dri-devel@lfdr.de>; Tue, 17 Sep 2019 14:39:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 64A8189167;
	Tue, 17 Sep 2019 12:39:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id DE5706EC41
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Sep 2019 12:39:39 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 8AD211000;
 Tue, 17 Sep 2019 05:39:39 -0700 (PDT)
Received: from [10.37.9.122] (unknown [10.37.9.122])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 281AE3F59C;
 Tue, 17 Sep 2019 05:39:37 -0700 (PDT)
Subject: Re: [PATCH] drm/panfrost: Prevent race when handling page fault
To: Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>
References: <20190905121141.42820-1-steven.price@arm.com>
 <20190913172454.GA5387@kevin>
From: Steven Price <steven.price@arm.com>
Message-ID: <15e36fa5-df70-ba46-489a-71b258776c5f@arm.com>
Date: Tue, 17 Sep 2019 13:39:35 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190913172454.GA5387@kevin>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, dri-devel@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, Tomeu Vizoso <tomeu.vizoso@collabora.com>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMTMvMDkvMjAxOSAxODoyNCwgQWx5c3NhIFJvc2VuendlaWcgd3JvdGU6Cj4gSSdtIGNvbmZs
aWN0ZWQgb24gdGhpcyBzZXJpZXMuCgpJJ20gb24gaG9saWRheSwgYnV0IHRob3VnaHQgSSBoYWQg
dG8gcmVwbHkuLi4KCj4gT24gdGhlIG9uZSBoYW5kLCB1c2Vyc3BhY2Ugc2hvdWxkIG9idmlvdXNs
eSBub3QgYmUgYWJsZSB0byBjcmFzaCB0aGUKPiBrZXJuZWwuIFNvIHRoZSBjcmFzaCBzaG91bGQg
YmUgZml4ZWQgaW4gb25lIHdheSBvciBhbm90aGVyLgo+IAo+IE9uIHRoZSBvdGhlciBoYW5kLCB1
c2Vyc3BhY2UgcmVhbGx5IGhhcyB0byBzdXBwbHkgYWxsIHRoZSBCT3MgaXQgdXNlcwo+IGZvciBj
b3JyZWN0bmVzcy4gSSByZWFsaXplIHRoZSBEREsgZG9lc24ndCBkbyB0aGlzIGJ1dC4uLiBpdCBw
cm9iYWJseQo+IHNob3VsZCwgdW1tLi4uCgpJdCB0dXJucyBvdXQgeW91IGRvbid0IG5lZWQgdGhl
IG1pc3NpbmcgQk9zIHRvIHRyaWdnZXIgdGhpcyAtIHNlZSB0aGUgCnRlc3QgY2FzZSBJIGFkZGVk
IHRvIElHVFsxXSwgcmVmZXJlbmNlZCBmcm9tIHYyIG9mIHRoaXMgcGF0Y2hbMl0uCgpbMV0gaHR0
cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoLzMzMDUxMy8KWzJdIApodHRwczov
L2xvcmUua2VybmVsLm9yZy9sa21sLzIwMTkwOTEzMTYwMzEwLjUwNDQ0LTEtc3RldmVuLnByaWNl
QGFybS5jb20vCgo+IFdvdWxkIGl0IGJlIHBvc3NpYmxlIHRvIGNoZWNrIGZvciB0aGUgTlVMTCBw
b2ludGVyIGluIHRoZSBrZXJuZWwgYW5kCj4gc2tpcCBwcmludGluZyBpbmZvcm1hdGlvbiB0aGF0
IHdvdWxkIHJlcXVpcmUgYSBkZXJlZmVyZW5jZT8gKFdpdGhvdXQKPiBoYXZpbmcgdG8gcGxheSBn
YW1lcyB3aXRoIHJlZmVyZW5jZSBjb3VudHMpLiBQcmVzdW1hYmx5IHRoYXQgbWlnaHQgZml4Cj4g
Y3Jhc2hlcyBpbiBvdGhlciBjb3JuZXIgY2FzZXMuCgpJIHRoaW5rIHdlIHNob3VsZCB0cnkgdG8g
ZG8gdGhlIHJpZ2h0IHRoaW5nIGhlcmUgYW5kIGtlZXAgdGhlIHJlZmVyZW5jZSAKY291bnRzIGNv
cnJlY3QuIFdoaWxlIGl0IG1pZ2h0IGJlIHBvc3NpYmxlIHRvIGhhbmRsZSB0aGUgTlVMTCBwb2lu
dGVyIGluIApwcmFjdGlzZSB0aGUgY29kZSBoYXMgbG9va2VkIHVwIHRoZSBCTyBhbmQgaXMgb3Bl
cmF0aW5nIG9uIGl0IC0gc28gd2UgCnNob3VsZCBlbnN1cmUgdGhhdCBpdCBjYW4ndCBkaXNhcHBl
YXIgd2hpbGUgdGhhdCBpcyBoYXBwZW5pbmcuCgpUaGlzIGlzbid0IGFib3V0IHN1cHBvcnRpbmcg
dGhlIHF1aXJrcyBvZiB0aGUgRERLIC0gYXQgdGhlIG1vbWVudCB0aGUgCkRESy1vbi1QYW5mcm9z
dCB3b3JrIEkndmUgYmVlbiBkb2luZyBpcyByZWFsbHkganVzdCBhIGhhY2sgdG8gYmUgYWJsZSB0
byAKdGVzdCB0aGUgZmVhc2liaWxpdHkgYW5kIGl0IG1heSB5ZXQgbmV2ZXIgYmUgcHVibGlzaGVk
IGV4dGVybmFsbHkuIEJ1dCAKd2hlbiBJIGNhbiB0cmlnZ2VyIGtlcm5lbCBidWdzIEkgbWlnaHQg
YXMgd2VsbCBmaXggdGhlbSEKClN0ZXZlCgo+IE9uIFRodSwgU2VwIDA1LCAyMDE5IGF0IDAxOjEx
OjQxUE0gKzAxMDAsIFN0ZXZlbiBQcmljZSB3cm90ZToKPj4gV2hlbiBoYW5kbGluZyBhIEdQVSBw
YWdlIGZhdWx0IGFkZHJfdG9fZHJtX21tX25vZGUoKSBpcyB1c2VkIHRvCj4+IHRyYW5zbGF0ZSB0
aGUgR1BVIGFkZHJlc3MgdG8gYSBidWZmZXIgb2JqZWN0LiBIb3dldmVyIGl0IGlzIHBvc3NpYmxl
IGZvcgo+PiB0aGUgYnVmZmVyIG9iamVjdCB0byBiZSBmcmVlZCBhZnRlciB0aGUgZnVuY3Rpb24g
aGFzIHJldHVybmVkIHJlc3VsdGluZwo+PiBpbiBhIHVzZS1hZnRlci1mcmVlIG9mIHRoZSBCTy4K
Pj4KPj4gQ2hhbmdlIGFkZHJfdG9fZHJtX21tX25vZGUgdG8gcmV0dXJuIHRoZSBwYW5mcm9zdF9n
ZW1fb2JqZWN0IHdpdGggYW4KPj4gZXh0cmEgcmVmZXJlbmNlIG9uIGl0LCBwcmV2ZW50aW5nIHRo
ZSBCTyBmcm9tIGJlaW5nIGZyZWVkIHVudGlsIGFmdGVyCj4+IHRoZSBwYWdlIGZhdWx0IGhhcyBi
ZWVuIGhhbmRsZWQuCj4+Cj4+IFNpZ25lZC1vZmYtYnk6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnBy
aWNlQGFybS5jb20+Cj4+IC0tLQo+Pgo+PiBJJ3ZlIG1hbmFnZWQgdG8gdHJpZ2dlciB0aGlzLCBn
ZW5lcmF0aW5nIHRoZSBmb2xsb3dpbmcgc3RhY2sgdHJhY2UuCj4+Cj4+IFVuYWJsZSB0byBoYW5k
bGUga2VybmVsIE5VTEwgcG9pbnRlciBkZXJlZmVyZW5jZSBhdCB2aXJ0dWFsIGFkZHJlc3MgMDAw
MDAwOTAKPj4gcGdkID0gMzNhNmExODEKPj4gWzAwMDAwMDkwXSAqcGdkPTAwMDAwMDAwCj4+IElu
dGVybmFsIGVycm9yOiBPb3BzOiA1IFsjMV0gU01QIEFSTQo+PiBNb2R1bGVzIGxpbmtlZCBpbjoK
Pj4gQ1BVOiAwIFBJRDogODEgQ29tbTogaXJxLzYwLW1tdSBOb3QgdGFpbnRlZCA1LjMuMC1yYzEr
ICM0Cj4+IEhhcmR3YXJlIG5hbWU6IFJvY2tjaGlwIChEZXZpY2UgVHJlZSkKPj4gUEMgaXMgYXQg
cGFuZnJvc3RfbW11X21hcF9mYXVsdF9hZGRyKzB4MTQwLzB4M2EwCj4+IExSIGlzIGF0IF9yYXdf
c3Bpbl91bmxvY2srMHgyMC8weDNjCj4+IHBjIDogWzxjMDUwODk0ND5dICAgIGxyIDogWzxjMDdj
ZWQxMD5dICAgIHBzcjogMjAwMzAwMTMKPj4gc3AgOiBlYzY0M2U4OCAgaXAgOiBlYTcwY2UyNCAg
ZnAgOiBlYzVmZTg0MAo+PiByMTA6IDAwMDAwMDAxICByOSA6IDAwMDAwMDAwICByOCA6IDAwMDE3
OGM5Cj4+IHI3IDogMDAwMDAwMDAgIHI2IDogMTc4YzlmMDAgIHI1IDogZWM1ZmU5NDAgIHI0IDog
ZWE3MGNlMDgKPj4gcjMgOiAwMDAwMDAwMCAgcjIgOiAwMDAwMDAwMCAgcjEgOiBlYzY0MGUwMCAg
cjAgOiBlYzVmZTk0MAo+PiBGbGFnczogbnpDdiAgSVJRcyBvbiAgRklRcyBvbiAgTW9kZSBTVkNf
MzIgIElTQSBBUk0gIFNlZ21lbnQgbm9uZQo+PiBDb250cm9sOiAxMGM1Mzg3ZCAgVGFibGU6IDI5
Zjg0MDZhICBEQUM6IDAwMDAwMDUxCj4+IFByb2Nlc3MgaXJxLzYwLW1tdSAocGlkOiA4MSwgc3Rh
Y2sgbGltaXQgPSAweDRiOTA3MTA2KQo+PiBTdGFjazogKDB4ZWM2NDNlODggdG8gMHhlYzY0NDAw
MCkKPj4gM2U4MDogICAgICAgICAgICAgICAgICAgZWM2NDBlMDAgYzA3Y2VkZTAgYzBjMGIyMDAg
ZWM2NDBlMDAgMDAwMDAwMDAgMDAwMDAwMDAKPj4gM2VhMDogMDAwMTc4YzkgMDAwMDAwMDAgYzBj
MGIyMDAgYzA3Y2VkZTAgZWVmOTEwNDAgZWM1ZmU4NDAgMDAwMDAwMDEgMDAwMDAwMDAKPj4gM2Vj
MDogMDAwMTAwMDEgMDEwMDAzYzMgMDAwMDAwYzMgMDAwMDAwMDEgMTc4YzlmMDAgYzA1MDhjOTgg
ZWVmOTEwNTAgMDAwMDAwMDAKPj4gM2VlMDogZWM2NDNmMzQgYzA3YzkxODggMDAwMDAwMDEgYzAx
Njc4NTQgMDAwMDAwMDAgZWM2NDNlZjggYzBjMDg0NDggYzA3YzkzM2MKPj4gM2YwMDogMDAwMDAw
MDAgZWM2NDNmMDQgZmZmZWZmZmUgM2QxODJiMTcgZWUxOTM0NjggZWUxOTM0MDAgZWM1ZGIzYzAg
ZWM1ZGIzYzAKPj4gM2YyMDogYzAxODM4NDAgZWM1ZGIzZTQgYzBjYjI4NzQgYzAxODNiMDggMDAw
MDAwMDEgYzAxODM4NWMgZmZmZmUwMDAgZWUxOTM0MDAKPj4gM2Y0MDogZWM1ZGIzYzAgYzAxODNi
OGMgYzBjMDg0NDggMDAwMDAwMDAgNjAwMDAwMTMgMDAwMDAwMDAgYzAxODM5YjggM2QxODJiMTcK
Pj4gM2Y2MDogZmZmZmUwMDAgZWM1ZDA1MDAgZWM1ZGIzODAgZWM2NDIwMDAgZWM1ZGIzYzAgYzAx
ODNhNjQgMDAwMDAwMDAgZWQwMjVjZDgKPj4gM2Y4MDogZWM1ZDA1MzggYzAxNDZjZmMgZWM2NDIw
MDAgZWM1ZGIzODAgYzAxNDZiYzAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKPj4gM2ZhMDog
MDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgYzAxMDEwYjQgMDAwMDAwMDAgMDAwMDAwMDAgMDAw
MDAwMDAgMDAwMDAwMDAKPj4gM2ZjMDogMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAw
MDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKPj4gM2ZlMDogMDAwMDAwMDAg
MDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMTMgMDAwMDAwMDAgMDAwMDAwMDAgMDAw
MDAwMDAKPj4gWzxjMDUwODk0ND5dIChwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIpIGZyb20g
WzxjMDUwOGM5OD5dIChwYW5mcm9zdF9tbXVfaXJxX2hhbmRsZXJfdGhyZWFkKzB4ZjQvMHgyNDgp
Cj4+IFs8YzA1MDhjOTg+XSAocGFuZnJvc3RfbW11X2lycV9oYW5kbGVyX3RocmVhZCkgZnJvbSBb
PGMwMTgzODVjPl0gKGlycV90aHJlYWRfZm4rMHgxYy8weDU4KQo+PiBbPGMwMTgzODVjPl0gKGly
cV90aHJlYWRfZm4pIGZyb20gWzxjMDE4M2I4Yz5dIChpcnFfdGhyZWFkKzB4MTI4LzB4MjQwKQo+
PiBbPGMwMTgzYjhjPl0gKGlycV90aHJlYWQpIGZyb20gWzxjMDE0NmNmYz5dIChrdGhyZWFkKzB4
MTNjLzB4MTU0KQo+PiBbPGMwMTQ2Y2ZjPl0gKGt0aHJlYWQpIGZyb20gWzxjMDEwMTBiND5dIChy
ZXRfZnJvbV9mb3JrKzB4MTQvMHgyMCkKPj4gRXhjZXB0aW9uIHN0YWNrKDB4ZWM2NDNmYjAgdG8g
MHhlYzY0M2ZmOCkKPj4gM2ZhMDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
MDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKPj4gM2ZjMDogMDAwMDAwMDAgMDAw
MDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAw
MDAKPj4gM2ZlMDogMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAgMDAwMDAwMTMg
MDAwMDAwMDAKPj4gQ29kZTogMWFmZmZmZWMgZWFmZmZmZTggZTUxNDMwMDQgZTU5ZDIwMTQgKGU1
OTMzMDkwKQo+PiAtLS1bIGVuZCB0cmFjZSAwNGVhZGMzMDA5YjhmNTA3IF0tLS0KPj4gLS0tCj4+
ICAgZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X21tdS5jIHwgMzggKysrKysrKysr
KysrKysrKy0tLS0tLS0tLQo+PiAgIDEgZmlsZSBjaGFuZ2VkLCAyNCBpbnNlcnRpb25zKCspLCAx
NCBkZWxldGlvbnMoLSkKPj4KPj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9wYW5mcm9zdF9tbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUu
Ywo+PiBpbmRleCA4NDJiZGQ3Y2Y2YmUuLjExNTkyNWU3NDYwYSAxMDA2NDQKPj4gLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X21tdS5jCj4+ICsrKyBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwo+PiBAQCAtMzkyLDkgKzM5MiwxMSBAQCB2b2lk
IHBhbmZyb3N0X21tdV9wZ3RhYmxlX2ZyZWUoc3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiAqcHJp
dikKPj4gICAJZnJlZV9pb19wZ3RhYmxlX29wcyhtbXUtPnBndGJsX29wcyk7Cj4+ICAgfQo+PiAg
IAo+PiAtc3RhdGljIHN0cnVjdCBkcm1fbW1fbm9kZSAqYWRkcl90b19kcm1fbW1fbm9kZShzdHJ1
Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaW50IGFzLCB1NjQgYWRkcikKPj4gK3N0YXRpYyBz
dHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqCj4+ICthZGRyX3RvX2RybV9tbV9ub2RlKHN0cnVj
dCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbnQgYXMsIHU2NCBhZGRyKQo+PiAgIHsKPj4gLQlz
dHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUgPSBOVUxMOwo+PiArCXN0cnVjdCBwYW5mcm9zdF9nZW1f
b2JqZWN0ICpibyA9IE5VTEw7Cj4+ICsJc3RydWN0IGRybV9tbV9ub2RlICpub2RlOwo+PiAgIAl1
NjQgb2Zmc2V0ID0gYWRkciA+PiBQQUdFX1NISUZUOwo+PiAgIAlzdHJ1Y3QgcGFuZnJvc3RfbW11
ICptbXU7Cj4+ICAgCj4+IEBAIC00MDYsMTQgKzQwOCwxNyBAQCBzdGF0aWMgc3RydWN0IGRybV9t
bV9ub2RlICphZGRyX3RvX2RybV9tbV9ub2RlKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2
LCBpbgo+PiAgIAo+PiAgIAkJcHJpdiA9IGNvbnRhaW5lcl9vZihtbXUsIHN0cnVjdCBwYW5mcm9z
dF9maWxlX3ByaXYsIG1tdSk7Cj4+ICAgCQlkcm1fbW1fZm9yX2VhY2hfbm9kZShub2RlLCAmcHJp
di0+bW0pIHsKPj4gLQkJCWlmIChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYgb2Zmc2V0IDwgKG5v
ZGUtPnN0YXJ0ICsgbm9kZS0+c2l6ZSkpCj4+ICsJCQlpZiAob2Zmc2V0ID49IG5vZGUtPnN0YXJ0
ICYmCj4+ICsJCQkgICAgb2Zmc2V0IDwgKG5vZGUtPnN0YXJ0ICsgbm9kZS0+c2l6ZSkpIHsKPj4g
KwkJCQlibyA9IGRybV9tbV9ub2RlX3RvX3BhbmZyb3N0X2JvKG5vZGUpOwo+PiArCQkJCWRybV9n
ZW1fb2JqZWN0X2dldCgmYm8tPmJhc2UuYmFzZSk7Cj4+ICAgCQkJCWdvdG8gb3V0Owo+PiArCQkJ
fQo+PiAgIAkJfQo+PiAgIAl9Cj4+IC0KPj4gICBvdXQ6Cj4+ICAgCXNwaW5fdW5sb2NrKCZwZmRl
di0+YXNfbG9jayk7Cj4+IC0JcmV0dXJuIG5vZGU7Cj4+ICsJcmV0dXJuIGJvOwo+PiAgIH0KPj4g
ICAKPj4gICAjZGVmaW5lIE5VTV9GQVVMVF9QQUdFUyAoU1pfMk0gLyBQQUdFX1NJWkUpCj4+IEBA
IC00MjEsMjkgKzQyNiwyOCBAQCBzdGF0aWMgc3RydWN0IGRybV9tbV9ub2RlICphZGRyX3RvX2Ry
bV9tbV9ub2RlKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbgo+PiAgIGludCBwYW5m
cm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGlu
dCBhcywgdTY0IGFkZHIpCj4+ICAgewo+PiAgIAlpbnQgcmV0LCBpOwo+PiAtCXN0cnVjdCBkcm1f
bW1fbm9kZSAqbm9kZTsKPj4gICAJc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJvOwo+PiAg
IAlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZzsKPj4gICAJcGdvZmZfdCBwYWdlX29mZnNl
dDsKPj4gICAJc3RydWN0IHNnX3RhYmxlICpzZ3Q7Cj4+ICAgCXN0cnVjdCBwYWdlICoqcGFnZXM7
Cj4+ICAgCj4+IC0Jbm9kZSA9IGFkZHJfdG9fZHJtX21tX25vZGUocGZkZXYsIGFzLCBhZGRyKTsK
Pj4gLQlpZiAoIW5vZGUpCj4+ICsJYm8gPSBhZGRyX3RvX2RybV9tbV9ub2RlKHBmZGV2LCBhcywg
YWRkcik7Cj4+ICsJaWYgKCFibykKPj4gICAJCXJldHVybiAtRU5PRU5UOwo+PiAgIAo+PiAtCWJv
ID0gZHJtX21tX25vZGVfdG9fcGFuZnJvc3RfYm8obm9kZSk7Cj4+ICAgCWlmICghYm8tPmlzX2hl
YXApIHsKPj4gICAJCWRldl9XQVJOKHBmZGV2LT5kZXYsICJtYXRjaGluZyBCTyBpcyBub3QgaGVh
cCB0eXBlIChHUFUgVkEgPSAlbGx4KSIsCj4+IC0JCQkgbm9kZS0+c3RhcnQgPDwgUEFHRV9TSElG
VCk7Cj4+IC0JCXJldHVybiAtRUlOVkFMOwo+PiArCQkJIGJvLT5ub2RlLnN0YXJ0IDw8IFBBR0Vf
U0hJRlQpOwo+PiArCQlyZXQgPSAtRUlOVkFMOwo+PiArCQlnb3RvIGVycl9ibzsKPj4gICAJfQo+
PiAgIAlXQVJOX09OKGJvLT5tbXUtPmFzICE9IGFzKTsKPj4gICAKPj4gICAJLyogQXNzdW1lIDJN
QiBhbGlnbm1lbnQgYW5kIHNpemUgbXVsdGlwbGUgKi8KPj4gICAJYWRkciAmPSB+KCh1NjQpU1pf
Mk0gLSAxKTsKPj4gICAJcGFnZV9vZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7Cj4+IC0JcGFn
ZV9vZmZzZXQgLT0gbm9kZS0+c3RhcnQ7Cj4+ICsJcGFnZV9vZmZzZXQgLT0gYm8tPm5vZGUuc3Rh
cnQ7Cj4+ICAgCj4+ICAgCW11dGV4X2xvY2soJmJvLT5iYXNlLnBhZ2VzX2xvY2spOwo+PiAgIAo+
PiBAQCAtNDUyLDcgKzQ1Niw4IEBAIGludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3Ry
dWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4+ICAgCQkJCSAg
ICAgc2l6ZW9mKHN0cnVjdCBzZ190YWJsZSksIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKPj4g
ICAJCWlmICghYm8tPnNndHMpIHsKPj4gICAJCQltdXRleF91bmxvY2soJmJvLT5iYXNlLnBhZ2Vz
X2xvY2spOwo+PiAtCQkJcmV0dXJuIC1FTk9NRU07Cj4+ICsJCQlyZXQgPSAtRU5PTUVNOwo+PiAr
CQkJZ290byBlcnJfYm87Cj4+ICAgCQl9Cj4+ICAgCj4+ICAgCQlwYWdlcyA9IGt2bWFsbG9jX2Fy
cmF5KGJvLT5iYXNlLmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZULAo+PiBAQCAtNDYxLDcgKzQ2Niw4
IEBAIGludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4+ICAgCQkJa2ZyZWUoYm8tPnNndHMpOwo+PiAg
IAkJCWJvLT5zZ3RzID0gTlVMTDsKPj4gICAJCQltdXRleF91bmxvY2soJmJvLT5iYXNlLnBhZ2Vz
X2xvY2spOwo+PiAtCQkJcmV0dXJuIC1FTk9NRU07Cj4+ICsJCQlyZXQgPSAtRU5PTUVNOwo+PiAr
CQkJZ290byBlcnJfYm87Cj4+ICAgCQl9Cj4+ICAgCQliby0+YmFzZS5wYWdlcyA9IHBhZ2VzOwo+
PiAgIAkJYm8tPmJhc2UucGFnZXNfdXNlX2NvdW50ID0gMTsKPj4gQEAgLTQ5OSwxMiArNTA1LDE2
IEBAIGludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4+ICAgCj4+ICAgCWRldl9kYmcocGZkZXYtPmRl
diwgIm1hcHBlZCBwYWdlIGZhdWx0IEAgQVMlZCAlbGx4IiwgYXMsIGFkZHIpOwo+PiAgIAo+PiAr
CWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmYm8tPmJhc2UuYmFzZSk7Cj4+ICsKPj4gICAJ
cmV0dXJuIDA7Cj4+ICAgCj4+ICAgZXJyX21hcDoKPj4gICAJc2dfZnJlZV90YWJsZShzZ3QpOwo+
PiAgIGVycl9wYWdlczoKPj4gICAJZHJtX2dlbV9zaG1lbV9wdXRfcGFnZXMoJmJvLT5iYXNlKTsK
Pj4gK2Vycl9ibzoKPj4gKwlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoJmJvLT5iYXNlLmJh
c2UpOwo+PiAgIAlyZXR1cm4gcmV0Owo+PiAgIH0KPj4gICAKPj4gLS0gCj4+IDIuMjAuMQo+Pgo+
Pgo+PiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwo+PiBk
cmktZGV2ZWwgbWFpbGluZyBsaXN0Cj4+IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
Pj4gaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWwKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
