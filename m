Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 249A255EFFF
	for <lists+dri-devel@lfdr.de>; Tue, 28 Jun 2022 22:53:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5C90510EA39;
	Tue, 28 Jun 2022 20:53:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp-out2.suse.de (smtp-out2.suse.de [195.135.220.29])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 84B84112635
 for <dri-devel@lists.freedesktop.org>; Tue, 28 Jun 2022 12:21:31 +0000 (UTC)
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by smtp-out2.suse.de (Postfix) with ESMTPS id 170B71F85D;
 Tue, 28 Jun 2022 12:21:30 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.de; s=susede2_rsa;
 t=1656418890; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=x/Iol5i5Dhdxhugvvgu4uWj4j799k/XHZnICLrfO8I8=;
 b=gcfCX08zeDHgFMJkuljFWRO/yfHQ0HBzkR8jhhR/u8k/J2ptylE9xY07H70FmE6TOk4F/g
 paJRngmwU89n3bd6maWc5Hebj7i6K5ad5/w2VGxfEOJZIbViAY2QgHInsOfvDMthPXip3O
 UwELcBAJxJTwosXeR94nqx9Wnlp8o/0=
DKIM-Signature: v=1; a=ed25519-sha256; c=relaxed/relaxed; d=suse.de;
 s=susede2_ed25519; t=1656418890;
 h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 in-reply-to:in-reply-to:references:references;
 bh=x/Iol5i5Dhdxhugvvgu4uWj4j799k/XHZnICLrfO8I8=;
 b=/LlHOI7xJXsS4cl5S/YnDPML+O+Iztp7KIov+4FyBIJS3ELgWv9Ywe32Ez65Tex1DmTzbO
 PMmjSOwXoHXBgsDA==
Received: from imap2.suse-dmz.suse.de (imap2.suse-dmz.suse.de [192.168.254.74])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature ECDSA (P-521) server-digest SHA512)
 (No client certificate requested)
 by imap2.suse-dmz.suse.de (Postfix) with ESMTPS id AAFE1139E9;
 Tue, 28 Jun 2022 12:21:29 +0000 (UTC)
Received: from dovecot-director2.suse.de ([192.168.254.65])
 by imap2.suse-dmz.suse.de with ESMTPSA id is7JKEnyumI5HQAAMHmgww
 (envelope-from <tzimmermann@suse.de>); Tue, 28 Jun 2022 12:21:29 +0000
Message-ID: <58475858-cc98-0aab-d248-f3473b179fab@suse.de>
Date: Tue, 28 Jun 2022 14:21:29 +0200
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101
 Thunderbird/91.10.0
Subject: Re: [PATCH 00/28] OpenChrome DRM for Linux 5.20
Content-Language: en-US
To: Sam Ravnborg <sam@ravnborg.org>
References: <20220624202633.3978-1-kevinbrace@gmx.com>
 <dacc0636-d307-3f2f-260d-09208a0dd9c1@suse.de>
 <Yroh0fe4Fzqgam3W@ravnborg.org>
From: Thomas Zimmermann <tzimmermann@suse.de>
In-Reply-To: <Yroh0fe4Fzqgam3W@ravnborg.org>
Content-Type: multipart/signed; micalg=pgp-sha256;
 protocol="application/pgp-signature";
 boundary="------------aEu0XABYtH0x7yx0ob3LH2XW"
X-Mailman-Approved-At: Tue, 28 Jun 2022 20:53:08 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Kevin Brace <kevinbrace@bracecomputerlab.com>,
 dri-devel@lists.freedesktop.org, Kevin Brace <kevinbrace@gmx.com>
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--------------aEu0XABYtH0x7yx0ob3LH2XW
Content-Type: multipart/mixed; boundary="------------c2TO8yS5KM3vAh7V5wKvc50C";
 protected-headers="v1"
From: Thomas Zimmermann <tzimmermann@suse.de>
To: Sam Ravnborg <sam@ravnborg.org>
Cc: Kevin Brace <kevinbrace@bracecomputerlab.com>,
 dri-devel@lists.freedesktop.org, Kevin Brace <kevinbrace@gmx.com>
Message-ID: <58475858-cc98-0aab-d248-f3473b179fab@suse.de>
Subject: Re: [PATCH 00/28] OpenChrome DRM for Linux 5.20
References: <20220624202633.3978-1-kevinbrace@gmx.com>
 <dacc0636-d307-3f2f-260d-09208a0dd9c1@suse.de>
 <Yroh0fe4Fzqgam3W@ravnborg.org>
In-Reply-To: <Yroh0fe4Fzqgam3W@ravnborg.org>

--------------c2TO8yS5KM3vAh7V5wKvc50C
Content-Type: multipart/mixed; boundary="------------dg90bebkuXNL8Vm3UILvZYRT"

--------------dg90bebkuXNL8Vm3UILvZYRT
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: base64

SGkNCg0KQW0gMjcuMDYuMjIgdW0gMjM6MzIgc2NocmllYiBTYW0gUmF2bmJvcmc6DQo+IEhp
IEtldmluL1Rob21hcywNCj4gDQo+Pg0KPj4gSSBoYWQgYSBicmllZiBsb29rIG92ZXIgdGhl
IHBhdGNoZXMuIEV2ZW4gdGhvdWdoIHRoZSBjb2RlIGxvb2tzIGZhaXJseSByb3VnaA0KPj4g
aW4gcGxhY2VzLCBJIHRoaW5rIHdlIHNob3VsZCBnZXQgdGhpcyBkcml2ZXIgbWVyZ2VkIEFT
QVAuDQo+IA0KPiBBZ3JlZWQsIHdlIGhhdmUgYSBoYWQgYSBmZXcgY2FzZXMgd2hlcmUgd2Ug
ZHJhZ2dlZCBvdXQgY29tbWl0dGluZyBtdWNoDQo+IHRvbyBsb25nIHRpbWUuDQo+IA0KPiBU
aW1pbmcgd2lzZSwgaXQgd291bGQgYmUgZ29vZCBpZiB3ZSBjYW4gYWxyZWFkeSBoaXQgZHJt
LW1pc2MtbmV4dCByaWdodA0KPiBfYWZ0ZXJfIHRoZSBwdWxsIC1zbyB3ZSBoYXZlIGEgZnVs
bCBjeWNsZSB0byBmaXggYW55dGhpbmcgYmVmb3JlIGl0IGhpdHMNCj4gbWFpbmxpbmUuDQo+
IA0KPj4gRm9yIHRoZSBvbGQgdmlhIGRyaXZlciwgSSB0aGluayB3ZSBuZWVkIGEgYmV0dGVy
IGFwcHJhY2guIElNSE8gaXQgd291bGQgYmUNCj4+IHByZWZlcmFibGUgdG8gcHV0IHRoZSBu
ZXcgZHJpdmVyIGludG8gdmlhLyBidXQga2VlcCB0aGUgb2xkIGRyaXZlciB0aGVyZSBhcw0K
Pj4gd2VsbC4gIEEgYnVpbGQgb3B0aW9uIHdvdWxkIGNvbnRyb2wgd2hpY2ggaXMgYmVpbmcg
dXNlZC4NCj4gDQo+IEkgYXNzdW1lIHRoZSB1c2VyIGJhc2UgZm9yIHZpYSBkcml2ZXJzIGFy
ZSB2ZXJ5IHNtYWxsIGFuZCB0aGV5IGhhdmUgdGhlDQo+IGZiZGV2IGRyaXZlciBhbHJlYWR5
Lg0KPiBTbyBJIHN1cHBvcnQgcmVwbGFjaW5nIHRoZSBjdXJyZW50IHZpYSBkcm0gZHJpdmVy
IGFzIEtldmluIHRyaWVzIHRvIGRvLg0KDQpJIGRvbid0IGtub3cgaWYgdGhlcmUgYXJlIHN0
aWxsIHVzZXJzIG9mIHRoZSBvbGQgdXNlcnNwYWNlLCBidXQgaWYgc28gSSANCndvdWxkIGNv
bnNpZGVyIHRoaXMgcmVtb3ZhbCBhIHJlZ3Jlc3Npb24uIEkgdGhpbmsgdGhlIG9sZCBjb2Rl
IHN1cHBvcnRzIA0KM2QgYW5kIHZpZGVvIGRlY29kaW5nLiBEZXBlbmRpbmcgb24gdGhlIGZl
YXR1cmUgc2V0LCAzZCBzdXBwb3J0IG1pZ2h0IA0Kbm90IGJlIHVzZWZ1bCBhbnkgbG9uZ2Vy
LCBidXQgdmlkZW8gZGVjb2RpbmcgcHJvYmFibHkgaXMuICAoSSBtaWdodCBiZSANCndyb25n
IGFib3V0IGFsbCB0aGlzLikgSU1ITyB3ZSBzaG91bGQgbm90IHNpbXBseSByZW1vdmUgdGhp
cyBhdCBsZWFzdCANCnVudGlsIHdlIGNhbiB2ZXJpZnkgdGhhdCBpdCdzIG5vIGxvbmdlciB1
c2VmdWwgdG8gYW55b25lLg0KDQpIb3dldmVyLCBsZWdhY3kgc3VwcG9ydCBpcyB0cml2aWFs
LiBLZXZpbiwgcGxlYXNlIHNlZSB0aGUgYXR0YWNoZWQgZmlsZXMgDQpmb3IgdHdvIGNsZWFu
dXAgcGF0Y2hlcy4gWW91J3JlIHdlbGNvbWUgdG8gYWRkIHRoZW0gdG8gdGhlIHN0YXJ0IG9m
IHlvdXIgDQpwYXRjaHNldCB0byBnZXQgdGhlIGxlZ2FjeSBjb2RlIG91dCBvZiB0aGUgd2F5
Lg0KDQpCZXN0IHJlZ2FyZHMNClRob21hcw0KDQoNCj4gDQo+IEJ1dCBhbnl3YXkgd2UgbmVl
ZCBhIHBhdGNoIHNldCB0aGF0IGFwcGxpZXMgd2l0aG91dCBleHRyYQ0KPiBkZWxldGUgZmls
ZSAvIGFkZCBmaWxlIGN5Y2xlcyBhcyB0aGUgbmV4dCBzdGVwLg0KPiANCj4gCVNhbQ0KDQot
LSANClRob21hcyBaaW1tZXJtYW5uDQpHcmFwaGljcyBEcml2ZXIgRGV2ZWxvcGVyDQpTVVNF
IFNvZnR3YXJlIFNvbHV0aW9ucyBHZXJtYW55IEdtYkgNCk1heGZlbGRzdHIuIDUsIDkwNDA5
IE7DvHJuYmVyZywgR2VybWFueQ0KKEhSQiAzNjgwOSwgQUcgTsO8cm5iZXJnKQ0KR2VzY2jD
pGZ0c2bDvGhyZXI6IEl2byBUb3Rldg0K
--------------dg90bebkuXNL8Vm3UILvZYRT
Content-Type: text/x-patch; charset=UTF-8;
 name="0001-drm-via-Move-legacy-code-into-single-file.patch"
Content-Disposition: attachment;
 filename="0001-drm-via-Move-legacy-code-into-single-file.patch"
Content-Transfer-Encoding: base64

RnJvbSA1MGEyMDQ2NTMxN2EyYjJlY2ExYTVkYmE4NTJiNzU0ZmMyNmM5NmI4IE1vbiBTZXAg
MTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5A
c3VzZS5kZT4KRGF0ZTogVHVlLCAyOCBKdW4gMjAyMiAxMjoxNTo0NyArMDIwMApTdWJqZWN0
OiBbUEFUQ0ggMS8yXSBkcm0vdmlhOiBNb3ZlIGxlZ2FjeSBjb2RlIGludG8gc2luZ2xlIGZp
bGUKClByZXBhcmUgdGhlIGRyaXZlciBmb3IgYWRkaW5nIGEgbW9kZXJuIG1vZGVzZXR0aW5n
IGRyaXZlciBieSBtb3ZpbmcKYWxsIGxlZ2FjeSBjb2RlIGludG8gYSBzaW5nbGUgc291cmNl
IGZpbGUuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5A
c3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlhL01ha2VmaWxlICAgICAgIHwgICAg
MiArLQogZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hLmMgICAgICB8ICA3NDQgLS0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kbWFibGl0LmMgIHwgIDgwNyAtLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYWJsaXQuaCAgfCAgMTQwIC0KIGRyaXZlcnMvZ3B1
L2RybS92aWEvdmlhX2Rydi5jICAgICAgfCAgMTI0IC0KIGRyaXZlcnMvZ3B1L2RybS92aWEv
dmlhX2Rydi5oICAgICAgfCAgMjI5IC0tCiBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9pcnEu
YyAgICAgIHwgIDM4OCAtLS0KIGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2xlZ2FjeS5jICAg
fCAzODM2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS92
aWEvdmlhX21hcC5jICAgICAgfCAgMTMyIC0KIGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX21t
LmMgICAgICAgfCAgMjQxIC0tCiBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV92ZXJpZmllci5j
IHwgMTExMCAtLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfdmVyaWZpZXIuaCB8
ICAgNjIgLQogZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfdmlkZW8uYyAgICB8ICAgOTQgLQog
MTMgZmlsZXMgY2hhbmdlZCwgMzgzNyBpbnNlcnRpb25zKCspLCA0MDcyIGRlbGV0aW9ucygt
KQogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYS5jCiBk
ZWxldGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5jCiBk
ZWxldGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5oCiBk
ZWxldGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZHJ2LmMKIGRlbGV0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kcnYuaAogZGVsZXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2lycS5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfbGVnYWN5LmMKIGRlbGV0ZSBtb2RlIDEw
MDY0NCBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9tYXAuYwogZGVsZXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX21tLmMKIGRlbGV0ZSBtb2RlIDEwMDY0NCBkcml2
ZXJzL2dwdS9kcm0vdmlhL3ZpYV92ZXJpZmllci5jCiBkZWxldGUgbW9kZSAxMDA2NDQgZHJp
dmVycy9ncHUvZHJtL3ZpYS92aWFfdmVyaWZpZXIuaAogZGVsZXRlIG1vZGUgMTAwNjQ0IGRy
aXZlcnMvZ3B1L2RybS92aWEvdmlhX3ZpZGVvLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdmlhL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL3ZpYS9NYWtlZmlsZQppbmRl
eCA4NGRiNGVlZTc4MjguLjk5NzYyMGFhMTRmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3ZpYS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlhL01ha2VmaWxlCkBA
IC0zLDYgKzMsNiBAQAogIyBNYWtlZmlsZSBmb3IgdGhlIGRybSBkZXZpY2UgZHJpdmVyLiAg
VGhpcyBkcml2ZXIgcHJvdmlkZXMgc3VwcG9ydCBmb3IgdGhlCiAjIERpcmVjdCBSZW5kZXJp
bmcgSW5mcmFzdHJ1Y3R1cmUgKERSSSkgaW4gWEZyZWU4NiA0LjEuMCBhbmQgaGlnaGVyLgog
Ci12aWEteSAgICA6PSB2aWFfaXJxLm8gdmlhX2Rydi5vIHZpYV9tYXAubyB2aWFfbW0ubyB2
aWFfZG1hLm8gdmlhX3ZlcmlmaWVyLm8gdmlhX3ZpZGVvLm8gdmlhX2RtYWJsaXQubwordmlh
LXkgICAgOj0gdmlhX2xlZ2FjeS5vCiAKIG9iai0kKENPTkZJR19EUk1fVklBKQkrPXZpYS5v
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kbWEuYyBiL2RyaXZlcnMv
Z3B1L2RybS92aWEvdmlhX2RtYS5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAx
NzdiMDQ5OWFiZjEuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3Zp
YV9kbWEuYworKysgL2Rldi9udWxsCkBAIC0xLDc0NCArMCwwIEBACi0vKiB2aWFfZG1hLmMg
LS0gRE1BIHN1cHBvcnQgZm9yIHRoZSBWSUEgVW5pY2hyb21lL1BybwotICoKLSAqIENvcHly
aWdodCAyMDAzIFR1bmdzdGVuIEdyYXBoaWNzLCBJbmMuLCBDZWRhciBQYXJrLCBUZXhhcy4K
LSAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi0gKgotICogQ29weXJpZ2h0IDIwMDQgRGlnZW8s
IEluYy4sIFBhbG8gQWx0bywgQ0EsIFUuUy5BLgotICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4K
LSAqCi0gKiBDb3B5cmlnaHQgMjAwNCBUaGUgVW5pY2hyb21lIHByb2plY3QuCi0gKiBBbGwg
UmlnaHRzIFJlc2VydmVkLgotICoKLSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQs
IGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9m
IHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhl
ICJTb2Z0d2FyZSIpLAotICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0
cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgotICogdGhlIHJpZ2h0cyB0
byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YiBs
aWNlbnNlLAotICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRv
IHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQg
dG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAq
IFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNl
IChpbmNsdWRpbmcgdGhlCi0gKiBuZXh0IHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQg
aW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucwotICogb2YgdGhlIFNvZnR3
YXJlLgotICoKLSAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VU
IFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCi0gKiBJTVBMSUVELCBJTkNMVURJ
TkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElU
WSwKLSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT04tSU5GUklO
R0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTAotICogVEhFIENPUFlSSUdIVCBIT0xERVJTLCBB
VVRIT1JTIEFORC9PUiBJVFMgU1VQUExJRVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLAot
ICogREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9G
IENPTlRSQUNULCBUT1JUIE9SCi0gKiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9G
IE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFCi0gKiBVU0UgT1Ig
T1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgotICoKLSAqIEF1dGhvcnM6Ci0gKiAg
ICBUdW5nc3RlbiBHcmFwaGljcywKLSAqICAgIEVyZGkgQ2hlbiwKLSAqICAgIFRob21hcyBI
ZWxsc3Ryb20uCi0gKi8KLQotI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+Ci0jaW5jbHVkZSA8
bGludXgvdWFjY2Vzcy5oPgotCi0jaW5jbHVkZSA8ZHJtL2RybS5oPgotI2luY2x1ZGUgPGRy
bS9kcm1fZGV2aWNlLmg+Ci0jaW5jbHVkZSA8ZHJtL2RybV9maWxlLmg+Ci0jaW5jbHVkZSA8
ZHJtL3ZpYV9kcm0uaD4KLQotI2luY2x1ZGUgInZpYV9kcnYuaCIKLSNpbmNsdWRlICJ2aWFf
M2RfcmVnLmgiCi0KLSNkZWZpbmUgQ01EQlVGX0FMSUdOTUVOVF9TSVpFICAgKDB4MTAwKQot
I2RlZmluZSBDTURCVUZfQUxJR05NRU5UX01BU0sgICAoMHgwZmYpCi0KLS8qIGRlZmluZXMg
Zm9yIFZJQSAzRCByZWdpc3RlcnMgKi8KLSNkZWZpbmUgVklBX1JFR19TVEFUVVMgICAgICAg
ICAgMHg0MDAKLSNkZWZpbmUgVklBX1JFR19UUkFOU0VUICAgICAgICAgMHg0M0MKLSNkZWZp
bmUgVklBX1JFR19UUkFOU1BBQ0UgICAgICAgMHg0NDAKLQotLyogVklBX1JFR19TVEFUVVMo
MHg0MDApOiBFbmdpbmUgU3RhdHVzICovCi0jZGVmaW5lIFZJQV9DTURfUkdUUl9CVVNZICAg
ICAgIDB4MDAwMDAwODAJLyogQ29tbWFuZCBSZWd1bGF0b3IgaXMgYnVzeSAqLwotI2RlZmlu
ZSBWSUFfMkRfRU5HX0JVU1kgICAgICAgICAweDAwMDAwMDAxCS8qIDJEIEVuZ2luZSBpcyBi
dXN5ICovCi0jZGVmaW5lIFZJQV8zRF9FTkdfQlVTWSAgICAgICAgIDB4MDAwMDAwMDIJLyog
M0QgRW5naW5lIGlzIGJ1c3kgKi8KLSNkZWZpbmUgVklBX1ZSX1FVRVVFX0JVU1kgICAgICAg
MHgwMDAyMDAwMAkvKiBWaXJ0dWFsIFF1ZXVlIGlzIGJ1c3kgKi8KLQotI2RlZmluZSBTZXRS
ZWcyREFHUChuUmVnLCBuRGF0YSkgewkJCQlcCi0JKigodWludDMyX3QgKikodmIpKSA9ICgo
blJlZykgPj4gMikgfCBIQUxDWU9OX0hFQURFUjE7CVwKLQkqKCh1aW50MzJfdCAqKSh2Yikg
KyAxKSA9IChuRGF0YSk7CQkJXAotCXZiID0gKCh1aW50MzJfdCAqKXZiKSArIDI7CQkJCVwK
LQlkZXZfcHJpdi0+ZG1hX2xvdyArPSA4OwkJCQkJXAotfQotCi0jZGVmaW5lIHZpYV9mbHVz
aF93cml0ZV9jb21iaW5lKCkgbWIoKQotCi0jZGVmaW5lIFZJQV9PVVRfUklOR19RVyh3MSwg
dzIpCWRvIHsJCVwKLQkqdmIrKyA9ICh3MSk7CQkJCVwKLQkqdmIrKyA9ICh3Mik7CQkJCVwK
LQlkZXZfcHJpdi0+ZG1hX2xvdyArPSA4OwkJCVwKLX0gd2hpbGUgKDApCi0KLXN0YXRpYyB2
b2lkIHZpYV9jbWRidWZfc3RhcnQoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KTsKLXN0
YXRpYyB2b2lkIHZpYV9jbWRidWZfcGF1c2UoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
KTsKLXN0YXRpYyB2b2lkIHZpYV9jbWRidWZfcmVzZXQoZHJtX3ZpYV9wcml2YXRlX3QgKmRl
dl9wcml2KTsKLXN0YXRpYyB2b2lkIHZpYV9jbWRidWZfcmV3aW5kKGRybV92aWFfcHJpdmF0
ZV90ICpkZXZfcHJpdik7Ci1zdGF0aWMgaW50IHZpYV93YWl0X2lkbGUoZHJtX3ZpYV9wcml2
YXRlX3QgKmRldl9wcml2KTsKLXN0YXRpYyB2b2lkIHZpYV9wYWRfY2FjaGUoZHJtX3ZpYV9w
cml2YXRlX3QgKmRldl9wcml2LCBpbnQgcXdvcmRzKTsKLQotLyoKLSAqIEZyZWUgc3BhY2Ug
aW4gY29tbWFuZCBidWZmZXIuCi0gKi8KLQotc3RhdGljIHVpbnQzMl90IHZpYV9jbWRidWZf
c3BhY2UoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQotewotCXVpbnQzMl90IGFncF9i
YXNlID0gZGV2X3ByaXYtPmRtYV9vZmZzZXQgKyAodWludDMyX3QpIGRldl9wcml2LT5hZ3BB
ZGRyOwotCXVpbnQzMl90IGh3X2FkZHIgPSAqKGRldl9wcml2LT5od19hZGRyX3B0cikgLSBh
Z3BfYmFzZTsKLQotCXJldHVybiAoKGh3X2FkZHIgPD0gZGV2X3ByaXYtPmRtYV9sb3cpID8K
LQkJKGRldl9wcml2LT5kbWFfaGlnaCArIGh3X2FkZHIgLSBkZXZfcHJpdi0+ZG1hX2xvdykg
OgotCQkoaHdfYWRkciAtIGRldl9wcml2LT5kbWFfbG93KSk7Ci19Ci0KLS8qCi0gKiBIb3cg
bXVjaCBkb2VzIHRoZSBjb21tYW5kIHJlZ3VsYXRvciBsYWcgYmVoaW5kPwotICovCi0KLXN0
YXRpYyB1aW50MzJfdCB2aWFfY21kYnVmX2xhZyhkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3By
aXYpCi17Ci0JdWludDMyX3QgYWdwX2Jhc2UgPSBkZXZfcHJpdi0+ZG1hX29mZnNldCArICh1
aW50MzJfdCkgZGV2X3ByaXYtPmFncEFkZHI7Ci0JdWludDMyX3QgaHdfYWRkciA9ICooZGV2
X3ByaXYtPmh3X2FkZHJfcHRyKSAtIGFncF9iYXNlOwotCi0JcmV0dXJuICgoaHdfYWRkciA8
PSBkZXZfcHJpdi0+ZG1hX2xvdykgPwotCQkoZGV2X3ByaXYtPmRtYV9sb3cgLSBod19hZGRy
KSA6Ci0JCShkZXZfcHJpdi0+ZG1hX3dyYXAgKyBkZXZfcHJpdi0+ZG1hX2xvdyAtIGh3X2Fk
ZHIpKTsKLX0KLQotLyoKLSAqIENoZWNrIHRoYXQgdGhlIGdpdmVuIHNpemUgZml0cyBpbiB0
aGUgYnVmZmVyLCBvdGhlcndpc2Ugd2FpdC4KLSAqLwotCi1zdGF0aWMgaW5saW5lIGludAot
dmlhX2NtZGJ1Zl93YWl0KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwgdW5zaWduZWQg
aW50IHNpemUpCi17Ci0JdWludDMyX3QgYWdwX2Jhc2UgPSBkZXZfcHJpdi0+ZG1hX29mZnNl
dCArICh1aW50MzJfdCkgZGV2X3ByaXYtPmFncEFkZHI7Ci0JdWludDMyX3QgY3VyX2FkZHIs
IGh3X2FkZHIsIG5leHRfYWRkcjsKLQl2b2xhdGlsZSB1aW50MzJfdCAqaHdfYWRkcl9wdHI7
Ci0JdWludDMyX3QgY291bnQ7Ci0JaHdfYWRkcl9wdHIgPSBkZXZfcHJpdi0+aHdfYWRkcl9w
dHI7Ci0JY3VyX2FkZHIgPSBkZXZfcHJpdi0+ZG1hX2xvdzsKLQluZXh0X2FkZHIgPSBjdXJf
YWRkciArIHNpemUgKyA1MTIgKiAxMDI0OwotCWNvdW50ID0gMTAwMDAwMDsKLQlkbyB7Ci0J
CWh3X2FkZHIgPSAqaHdfYWRkcl9wdHIgLSBhZ3BfYmFzZTsKLQkJaWYgKGNvdW50LS0gPT0g
MCkgewotCQkJRFJNX0VSUk9SCi0JCQkgICAgKCJ2aWFfY21kYnVmX3dhaXQgdGltZWQgb3V0
IGh3ICV4IGN1cl9hZGRyICV4IG5leHRfYWRkciAleFxuIiwKLQkJCSAgICAgaHdfYWRkciwg
Y3VyX2FkZHIsIG5leHRfYWRkcik7Ci0JCQlyZXR1cm4gLTE7Ci0JCX0KLQkJaWYgICgoY3Vy
X2FkZHIgPCBod19hZGRyKSAmJiAobmV4dF9hZGRyID49IGh3X2FkZHIpKQotCQkJbXNsZWVw
KDEpOwotCX0gd2hpbGUgKChjdXJfYWRkciA8IGh3X2FkZHIpICYmIChuZXh0X2FkZHIgPj0g
aHdfYWRkcikpOwotCXJldHVybiAwOwotfQotCi0vKgotICogQ2hlY2tzIHdoZXRoZXIgYnVm
ZmVyIGhlYWQgaGFzIHJlYWNoIHRoZSBlbmQuIFJld2luZCB0aGUgcmluZyBidWZmZXIKLSAq
IHdoZW4gbmVjZXNzYXJ5LgotICoKLSAqIFJldHVybnMgdmlydHVhbCBwb2ludGVyIHRvIHJp
bmcgYnVmZmVyLgotICovCi0KLXN0YXRpYyBpbmxpbmUgdWludDMyX3QgKnZpYV9jaGVja19k
bWEoZHJtX3ZpYV9wcml2YXRlX3QgKiBkZXZfcHJpdiwKLQkJCQkgICAgICB1bnNpZ25lZCBp
bnQgc2l6ZSkKLXsKLQlpZiAoKGRldl9wcml2LT5kbWFfbG93ICsgc2l6ZSArIDQgKiBDTURC
VUZfQUxJR05NRU5UX1NJWkUpID4KLQkgICAgZGV2X3ByaXYtPmRtYV9oaWdoKSB7Ci0JCXZp
YV9jbWRidWZfcmV3aW5kKGRldl9wcml2KTsKLQl9Ci0JaWYgKHZpYV9jbWRidWZfd2FpdChk
ZXZfcHJpdiwgc2l6ZSkgIT0gMCkKLQkJcmV0dXJuIE5VTEw7Ci0KLQlyZXR1cm4gKHVpbnQz
Ml90ICopIChkZXZfcHJpdi0+ZG1hX3B0ciArIGRldl9wcml2LT5kbWFfbG93KTsKLX0KLQot
aW50IHZpYV9kbWFfY2xlYW51cChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQotewotCWlmIChk
ZXYtPmRldl9wcml2YXRlKSB7Ci0JCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9Ci0J
CSAgICAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKLQotCQlpZiAo
ZGV2X3ByaXYtPnJpbmcudmlydHVhbF9zdGFydCkgewotCQkJdmlhX2NtZGJ1Zl9yZXNldChk
ZXZfcHJpdik7Ci0KLQkJCWRybV9sZWdhY3lfaW9yZW1hcGZyZWUoJmRldl9wcml2LT5yaW5n
Lm1hcCwgZGV2KTsKLQkJCWRldl9wcml2LT5yaW5nLnZpcnR1YWxfc3RhcnQgPSBOVUxMOwot
CQl9Ci0KLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCB2aWFfaW5pdGlhbGl6
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJICBkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYsCi0JCQkgIGRybV92aWFfZG1hX2luaXRfdCAqaW5pdCkKLXsKLQlpZiAoIWRldl9w
cml2IHx8ICFkZXZfcHJpdi0+bW1pbykgewotCQlEUk1fRVJST1IoInZpYV9kbWFfaW5pdCBj
YWxsZWQgYmVmb3JlIHZpYV9tYXBfaW5pdFxuIik7Ci0JCXJldHVybiAtRUZBVUxUOwotCX0K
LQotCWlmIChkZXZfcHJpdi0+cmluZy52aXJ0dWFsX3N0YXJ0ICE9IE5VTEwpIHsKLQkJRFJN
X0VSUk9SKCJjYWxsZWQgYWdhaW4gd2l0aG91dCBjYWxsaW5nIGNsZWFudXBcbiIpOwotCQly
ZXR1cm4gLUVGQVVMVDsKLQl9Ci0KLQlpZiAoIWRldi0+YWdwIHx8ICFkZXYtPmFncC0+YmFz
ZSkgewotCQlEUk1fRVJST1IoImNhbGxlZCB3aXRoIG5vIGFncCBtZW1vcnkgYXZhaWxhYmxl
XG4iKTsKLQkJcmV0dXJuIC1FRkFVTFQ7Ci0JfQotCi0JaWYgKGRldl9wcml2LT5jaGlwc2V0
ID09IFZJQV9EWDlfMCkgewotCQlEUk1fRVJST1IoIkFHUCBETUEgaXMgbm90IHN1cHBvcnRl
ZCBvbiB0aGlzIGNoaXBcbiIpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlkZXZfcHJp
di0+cmluZy5tYXAub2Zmc2V0ID0gZGV2LT5hZ3AtPmJhc2UgKyBpbml0LT5vZmZzZXQ7Ci0J
ZGV2X3ByaXYtPnJpbmcubWFwLnNpemUgPSBpbml0LT5zaXplOwotCWRldl9wcml2LT5yaW5n
Lm1hcC50eXBlID0gMDsKLQlkZXZfcHJpdi0+cmluZy5tYXAuZmxhZ3MgPSAwOwotCWRldl9w
cml2LT5yaW5nLm1hcC5tdHJyID0gMDsKLQotCWRybV9sZWdhY3lfaW9yZW1hcCgmZGV2X3By
aXYtPnJpbmcubWFwLCBkZXYpOwotCi0JaWYgKGRldl9wcml2LT5yaW5nLm1hcC5oYW5kbGUg
PT0gTlVMTCkgewotCQl2aWFfZG1hX2NsZWFudXAoZGV2KTsKLQkJRFJNX0VSUk9SKCJjYW4g
bm90IGlvcmVtYXAgdmlydHVhbCBhZGRyZXNzIGZvciIKLQkJCSAgIiByaW5nIGJ1ZmZlclxu
Iik7Ci0JCXJldHVybiAtRU5PTUVNOwotCX0KLQotCWRldl9wcml2LT5yaW5nLnZpcnR1YWxf
c3RhcnQgPSBkZXZfcHJpdi0+cmluZy5tYXAuaGFuZGxlOwotCi0JZGV2X3ByaXYtPmRtYV9w
dHIgPSBkZXZfcHJpdi0+cmluZy52aXJ0dWFsX3N0YXJ0OwotCWRldl9wcml2LT5kbWFfbG93
ID0gMDsKLQlkZXZfcHJpdi0+ZG1hX2hpZ2ggPSBpbml0LT5zaXplOwotCWRldl9wcml2LT5k
bWFfd3JhcCA9IGluaXQtPnNpemU7Ci0JZGV2X3ByaXYtPmRtYV9vZmZzZXQgPSBpbml0LT5v
ZmZzZXQ7Ci0JZGV2X3ByaXYtPmxhc3RfcGF1c2VfcHRyID0gTlVMTDsKLQlkZXZfcHJpdi0+
aHdfYWRkcl9wdHIgPQotCQkodm9sYXRpbGUgdWludDMyX3QgKikoKGNoYXIgKilkZXZfcHJp
di0+bW1pby0+aGFuZGxlICsKLQkJaW5pdC0+cmVnX3BhdXNlX2FkZHIpOwotCi0JdmlhX2Nt
ZGJ1Zl9zdGFydChkZXZfcHJpdik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCB2
aWFfZG1hX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCi17Ci0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9k
bWFfaW5pdF90ICppbml0ID0gZGF0YTsKLQlpbnQgcmV0Y29kZSA9IDA7Ci0KLQlzd2l0Y2gg
KGluaXQtPmZ1bmMpIHsKLQljYXNlIFZJQV9JTklUX0RNQToKLQkJaWYgKCFjYXBhYmxlKENB
UF9TWVNfQURNSU4pKQotCQkJcmV0Y29kZSA9IC1FUEVSTTsKLQkJZWxzZQotCQkJcmV0Y29k
ZSA9IHZpYV9pbml0aWFsaXplKGRldiwgZGV2X3ByaXYsIGluaXQpOwotCQlicmVhazsKLQlj
YXNlIFZJQV9DTEVBTlVQX0RNQToKLQkJaWYgKCFjYXBhYmxlKENBUF9TWVNfQURNSU4pKQot
CQkJcmV0Y29kZSA9IC1FUEVSTTsKLQkJZWxzZQotCQkJcmV0Y29kZSA9IHZpYV9kbWFfY2xl
YW51cChkZXYpOwotCQlicmVhazsKLQljYXNlIFZJQV9ETUFfSU5JVElBTElaRUQ6Ci0JCXJl
dGNvZGUgPSAoZGV2X3ByaXYtPnJpbmcudmlydHVhbF9zdGFydCAhPSBOVUxMKSA/Ci0JCQkw
IDogLUVGQVVMVDsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJcmV0Y29kZSA9IC1FSU5WQUw7
Ci0JCWJyZWFrOwotCX0KLQotCXJldHVybiByZXRjb2RlOwotfQotCi1zdGF0aWMgaW50IHZp
YV9kaXNwYXRjaF9jbWRidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgZHJtX3ZpYV9j
bWRidWZmZXJfdCAqY21kKQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdjsKLQl1
aW50MzJfdCAqdmI7Ci0JaW50IHJldDsKLQotCWRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0
ZV90ICopIGRldi0+ZGV2X3ByaXZhdGU7Ci0KLQlpZiAoZGV2X3ByaXYtPnJpbmcudmlydHVh
bF9zdGFydCA9PSBOVUxMKSB7Ci0JCURSTV9FUlJPUigiY2FsbGVkIHdpdGhvdXQgaW5pdGlh
bGl6aW5nIEFHUCByaW5nIGJ1ZmZlci5cbiIpOwotCQlyZXR1cm4gLUVGQVVMVDsKLQl9Ci0K
LQlpZiAoY21kLT5zaXplID4gVklBX1BDSV9CVUZfU0laRSkKLQkJcmV0dXJuIC1FTk9NRU07
Ci0KLQlpZiAoY29weV9mcm9tX3VzZXIoZGV2X3ByaXYtPnBjaV9idWYsIGNtZC0+YnVmLCBj
bWQtPnNpemUpKQotCQlyZXR1cm4gLUVGQVVMVDsKLQotCS8qCi0JICogUnVubmluZyB0aGlz
IGZ1bmN0aW9uIG9uIEFHUCBtZW1vcnkgaXMgZGVhZCBzbG93LiBUaGVyZWZvcmUKLQkgKiB3
ZSBydW4gaXQgb24gYSB0ZW1wb3JhcnkgY2FjaGVhYmxlIHN5c3RlbSBtZW1vcnkgYnVmZmVy
IGFuZAotCSAqIGNvcHkgaXQgdG8gQUdQIG1lbW9yeSB3aGVuIHJlYWR5LgotCSAqLwotCi0J
aWYgKChyZXQgPQotCSAgICAgdmlhX3ZlcmlmeV9jb21tYW5kX3N0cmVhbSgodWludDMyX3Qg
KikgZGV2X3ByaXYtPnBjaV9idWYsCi0JCQkJICAgICAgIGNtZC0+c2l6ZSwgZGV2LCAxKSkp
IHsKLQkJcmV0dXJuIHJldDsKLQl9Ci0KLQl2YiA9IHZpYV9jaGVja19kbWEoZGV2X3ByaXYs
IChjbWQtPnNpemUgPCAweDEwMCkgPyAweDEwMiA6IGNtZC0+c2l6ZSk7Ci0JaWYgKHZiID09
IE5VTEwpCi0JCXJldHVybiAtRUFHQUlOOwotCi0JbWVtY3B5KHZiLCBkZXZfcHJpdi0+cGNp
X2J1ZiwgY21kLT5zaXplKTsKLQotCWRldl9wcml2LT5kbWFfbG93ICs9IGNtZC0+c2l6ZTsK
LQotCS8qCi0JICogU21hbGwgc3VibWlzc2lvbnMgc29tZWhvdyBzdGFsbHMgdGhlIENQVS4g
KEFHUCBjYWNoZSBlZmZlY3RzPykKLQkgKiBwYWQgdG8gZ3JlYXRlciBzaXplLgotCSAqLwot
Ci0JaWYgKGNtZC0+c2l6ZSA8IDB4MTAwKQotCQl2aWFfcGFkX2NhY2hlKGRldl9wcml2LCAo
MHgxMDAgLSBjbWQtPnNpemUpID4+IDMpOwotCXZpYV9jbWRidWZfcGF1c2UoZGV2X3ByaXYp
OwotCi0JcmV0dXJuIDA7Ci19Ci0KLWludCB2aWFfZHJpdmVyX2RtYV9xdWllc2NlbnQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldikKLXsKLQlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYg
PSBkZXYtPmRldl9wcml2YXRlOwotCi0JaWYgKCF2aWFfd2FpdF9pZGxlKGRldl9wcml2KSkK
LQkJcmV0dXJuIC1FQlVTWTsKLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCB2aWFfZmx1
c2hfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRy
bV9maWxlICpmaWxlX3ByaXYpCi17Ci0KLQlMT0NLX1RFU1RfV0lUSF9SRVRVUk4oZGV2LCBm
aWxlX3ByaXYpOwotCi0JcmV0dXJuIHZpYV9kcml2ZXJfZG1hX3F1aWVzY2VudChkZXYpOwot
fQotCi1zdGF0aWMgaW50IHZpYV9jbWRidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCi17Ci0JZHJtX3ZpYV9j
bWRidWZmZXJfdCAqY21kYnVmID0gZGF0YTsKLQlpbnQgcmV0OwotCi0JTE9DS19URVNUX1dJ
VEhfUkVUVVJOKGRldiwgZmlsZV9wcml2KTsKLQotCURSTV9ERUJVRygiYnVmICVwIHNpemUg
JWx1XG4iLCBjbWRidWYtPmJ1ZiwgY21kYnVmLT5zaXplKTsKLQotCXJldCA9IHZpYV9kaXNw
YXRjaF9jbWRidWZmZXIoZGV2LCBjbWRidWYpOwotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRp
YyBpbnQgdmlhX2Rpc3BhdGNoX3BjaV9jbWRidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKLQkJCQkgICAgICBkcm1fdmlhX2NtZGJ1ZmZlcl90ICpjbWQpCi17Ci0JZHJtX3ZpYV9w
cml2YXRlX3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQlpbnQgcmV0OwotCi0J
aWYgKGNtZC0+c2l6ZSA+IFZJQV9QQ0lfQlVGX1NJWkUpCi0JCXJldHVybiAtRU5PTUVNOwot
CWlmIChjb3B5X2Zyb21fdXNlcihkZXZfcHJpdi0+cGNpX2J1ZiwgY21kLT5idWYsIGNtZC0+
c2l6ZSkpCi0JCXJldHVybiAtRUZBVUxUOwotCi0JaWYgKChyZXQgPQotCSAgICAgdmlhX3Zl
cmlmeV9jb21tYW5kX3N0cmVhbSgodWludDMyX3QgKikgZGV2X3ByaXYtPnBjaV9idWYsCi0J
CQkJICAgICAgIGNtZC0+c2l6ZSwgZGV2LCAwKSkpIHsKLQkJcmV0dXJuIHJldDsKLQl9Ci0K
LQlyZXQgPQotCSAgICB2aWFfcGFyc2VfY29tbWFuZF9zdHJlYW0oZGV2LCAoY29uc3QgdWlu
dDMyX3QgKilkZXZfcHJpdi0+cGNpX2J1ZiwKLQkJCQkgICAgIGNtZC0+c2l6ZSk7Ci0JcmV0
dXJuIHJldDsKLX0KLQotc3RhdGljIGludCB2aWFfcGNpX2NtZGJ1ZmZlcihzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikK
LXsKLQlkcm1fdmlhX2NtZGJ1ZmZlcl90ICpjbWRidWYgPSBkYXRhOwotCWludCByZXQ7Ci0K
LQlMT0NLX1RFU1RfV0lUSF9SRVRVUk4oZGV2LCBmaWxlX3ByaXYpOwotCi0JRFJNX0RFQlVH
KCJidWYgJXAgc2l6ZSAlbHVcbiIsIGNtZGJ1Zi0+YnVmLCBjbWRidWYtPnNpemUpOwotCi0J
cmV0ID0gdmlhX2Rpc3BhdGNoX3BjaV9jbWRidWZmZXIoZGV2LCBjbWRidWYpOwotCXJldHVy
biByZXQ7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdWludDMyX3QgKnZpYV9hbGlnbl9idWZmZXIo
ZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2LAotCQkJCQkgdWludDMyX3QgKiB2YiwgaW50
IHF3X2NvdW50KQotewotCWZvciAoOyBxd19jb3VudCA+IDA7IC0tcXdfY291bnQpCi0JCVZJ
QV9PVVRfUklOR19RVyhIQ19EVU1NWSwgSENfRFVNTVkpOwotCXJldHVybiB2YjsKLX0KLQot
LyoKLSAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IHJpbmcgYnVmZmVy
IG1hbmFnZW1lbnQgY29kZS4KLSAqCi0gKiBSZXR1cm5zIHZpcnR1YWwgcG9pbnRlciB0byBy
aW5nIGJ1ZmZlci4KLSAqLwotc3RhdGljIGlubGluZSB1aW50MzJfdCAqdmlhX2dldF9kbWEo
ZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQotewotCXJldHVybiAodWludDMyX3QgKikg
KGRldl9wcml2LT5kbWFfcHRyICsgZGV2X3ByaXYtPmRtYV9sb3cpOwotfQotCi0vKgotICog
SG9va3MgYSBzZWdtZW50IG9mIGRhdGEgaW50byB0aGUgdGFpbCBvZiB0aGUgcmluZy1idWZm
ZXIgYnkKLSAqIG1vZGlmeWluZyB0aGUgcGF1c2UgYWRkcmVzcyBzdG9yZWQgaW4gdGhlIGJ1
ZmZlciBpdHNlbGYuIElmCi0gKiB0aGUgcmVndWxhdG9yIGhhcyBhbHJlYWR5IHBhdXNlZCwg
cmVzdGFydCBpdC4KLSAqLwotc3RhdGljIGludCB2aWFfaG9va19zZWdtZW50KGRybV92aWFf
cHJpdmF0ZV90ICpkZXZfcHJpdiwKLQkJCSAgICB1aW50MzJfdCBwYXVzZV9hZGRyX2hpLCB1
aW50MzJfdCBwYXVzZV9hZGRyX2xvLAotCQkJICAgIGludCBub19wY2lfZmlyZSkKLXsKLQlp
bnQgcGF1c2VkLCBjb3VudDsKLQl2b2xhdGlsZSB1aW50MzJfdCAqcGF1c2VkX2F0ID0gZGV2
X3ByaXYtPmxhc3RfcGF1c2VfcHRyOwotCXVpbnQzMl90IHJlYWRlciwgcHRyOwotCXVpbnQz
Ml90IGRpZmY7Ci0KLQlwYXVzZWQgPSAwOwotCXZpYV9mbHVzaF93cml0ZV9jb21iaW5lKCk7
Ci0JKHZvaWQpICoodm9sYXRpbGUgdWludDMyX3QgKikodmlhX2dldF9kbWEoZGV2X3ByaXYp
IC0gMSk7Ci0KLQkqcGF1c2VkX2F0ID0gcGF1c2VfYWRkcl9sbzsKLQl2aWFfZmx1c2hfd3Jp
dGVfY29tYmluZSgpOwotCSh2b2lkKSAqcGF1c2VkX2F0OwotCi0JcmVhZGVyID0gKihkZXZf
cHJpdi0+aHdfYWRkcl9wdHIpOwotCXB0ciA9ICgodm9sYXRpbGUgY2hhciAqKXBhdXNlZF9h
dCAtIGRldl9wcml2LT5kbWFfcHRyKSArCi0JCWRldl9wcml2LT5kbWFfb2Zmc2V0ICsgKHVp
bnQzMl90KSBkZXZfcHJpdi0+YWdwQWRkciArIDQ7Ci0KLQlkZXZfcHJpdi0+bGFzdF9wYXVz
ZV9wdHIgPSB2aWFfZ2V0X2RtYShkZXZfcHJpdikgLSAxOwotCi0JLyoKLQkgKiBJZiB0aGVy
ZSBpcyBhIHBvc3NpYmlsaXR5IHRoYXQgdGhlIGNvbW1hbmQgcmVhZGVyIHdpbGwKLQkgKiBt
aXNzIHRoZSBuZXcgcGF1c2UgYWRkcmVzcyBhbmQgcGF1c2Ugb24gdGhlIG9sZCBvbmUsCi0J
ICogSW4gdGhhdCBjYXNlIHdlIG5lZWQgdG8gcHJvZ3JhbSB0aGUgbmV3IHN0YXJ0IGFkZHJl
c3MKLQkgKiB1c2luZyBQQ0kuCi0JICovCi0KLQlkaWZmID0gKHVpbnQzMl90KSAocHRyIC0g
cmVhZGVyKSAtIGRldl9wcml2LT5kbWFfZGlmZjsKLQljb3VudCA9IDEwMDAwMDAwOwotCXdo
aWxlIChkaWZmID09IDAgJiYgY291bnQtLSkgewotCQlwYXVzZWQgPSAodmlhX3JlYWQoZGV2
X3ByaXYsIDB4NDFjKSAmIDB4ODAwMDAwMDApOwotCQlpZiAocGF1c2VkKQotCQkJYnJlYWs7
Ci0JCXJlYWRlciA9ICooZGV2X3ByaXYtPmh3X2FkZHJfcHRyKTsKLQkJZGlmZiA9ICh1aW50
MzJfdCkgKHB0ciAtIHJlYWRlcikgLSBkZXZfcHJpdi0+ZG1hX2RpZmY7Ci0JfQotCi0JcGF1
c2VkID0gdmlhX3JlYWQoZGV2X3ByaXYsIDB4NDFjKSAmIDB4ODAwMDAwMDA7Ci0KLQlpZiAo
cGF1c2VkICYmICFub19wY2lfZmlyZSkgewotCQlyZWFkZXIgPSAqKGRldl9wcml2LT5od19h
ZGRyX3B0cik7Ci0JCWRpZmYgPSAodWludDMyX3QpIChwdHIgLSByZWFkZXIpIC0gZGV2X3By
aXYtPmRtYV9kaWZmOwotCQlkaWZmICY9IChkZXZfcHJpdi0+ZG1hX2hpZ2ggLSAxKTsKLQkJ
aWYgKGRpZmYgIT0gMCAmJiBkaWZmIDwgKGRldl9wcml2LT5kbWFfaGlnaCA+PiAxKSkgewot
CQkJRFJNX0VSUk9SKCJQYXVzZWQgYXQgaW5jb3JyZWN0IGFkZHJlc3MuICIKLQkJCQkgICIw
eCUwOHgsIDB4JTA4eCAweCUwOHhcbiIsCi0JCQkJICBwdHIsIHJlYWRlciwgZGV2X3ByaXYt
PmRtYV9kaWZmKTsKLQkJfSBlbHNlIGlmIChkaWZmID09IDApIHsKLQkJCS8qCi0JCQkgKiBU
aGVyZSBpcyBhIGNvbmNlcm4gdGhhdCB0aGVzZSB3cml0ZXMgbWF5IHN0YWxsIHRoZSBQQ0kg
YnVzCi0JCQkgKiBpZiB0aGUgR1BVIGlzIG5vdCBpZGxlLiBIb3dldmVyLCBpZGxpbmcgdGhl
IEdQVSBmaXJzdAotCQkJICogZG9lc24ndCBtYWtlIGEgZGlmZmVyZW5jZS4KLQkJCSAqLwot
Ci0JCQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNFVCwgKEhDX1BhcmFUeXBl
X1ByZUNSIDw8IDE2KSk7Ci0JCQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQ
QUNFLCBwYXVzZV9hZGRyX2hpKTsKLQkJCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1JFR19U
UkFOU1BBQ0UsIHBhdXNlX2FkZHJfbG8pOwotCQkJdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9S
RUdfVFJBTlNQQUNFKTsKLQkJfQotCX0KLQlyZXR1cm4gcGF1c2VkOwotfQotCi1zdGF0aWMg
aW50IHZpYV93YWl0X2lkbGUoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQotewotCWlu
dCBjb3VudCA9IDEwMDAwMDAwOwotCi0Jd2hpbGUgKCEodmlhX3JlYWQoZGV2X3ByaXYsIFZJ
QV9SRUdfU1RBVFVTKSAmIFZJQV9WUl9RVUVVRV9CVVNZKSAmJiAtLWNvdW50KQotCQk7Ci0K
LQl3aGlsZSAoY291bnQgJiYgKHZpYV9yZWFkKGRldl9wcml2LCBWSUFfUkVHX1NUQVRVUykg
JgotCQkJICAgKFZJQV9DTURfUkdUUl9CVVNZIHwgVklBXzJEX0VOR19CVVNZIHwKLQkJCSAg
ICBWSUFfM0RfRU5HX0JVU1kpKSkKLQkJLS1jb3VudDsKLQlyZXR1cm4gY291bnQ7Ci19Ci0K
LXN0YXRpYyB1aW50MzJfdCAqdmlhX2FsaWduX2NtZChkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYsIHVpbnQzMl90IGNtZF90eXBlLAotCQkJICAgICAgIHVpbnQzMl90IGFkZHIsIHVp
bnQzMl90ICpjbWRfYWRkcl9oaSwKLQkJCSAgICAgICB1aW50MzJfdCAqY21kX2FkZHJfbG8s
IGludCBza2lwX3dhaXQpCi17Ci0JdWludDMyX3QgYWdwX2Jhc2U7Ci0JdWludDMyX3QgY21k
X2FkZHIsIGFkZHJfbG8sIGFkZHJfaGk7Ci0JdWludDMyX3QgKnZiOwotCXVpbnQzMl90IHF3
X3BhZF9jb3VudDsKLQotCWlmICghc2tpcF93YWl0KQotCQl2aWFfY21kYnVmX3dhaXQoZGV2
X3ByaXYsIDIgKiBDTURCVUZfQUxJR05NRU5UX1NJWkUpOwotCi0JdmIgPSB2aWFfZ2V0X2Rt
YShkZXZfcHJpdik7Ci0JVklBX09VVF9SSU5HX1FXKEhDX0hFQURFUjIgfCAoKFZJQV9SRUdf
VFJBTlNFVCA+PiAyKSA8PCAxMikgfAotCQkJKFZJQV9SRUdfVFJBTlNQQUNFID4+IDIpLCBI
Q19QYXJhVHlwZV9QcmVDUiA8PCAxNik7Ci0JYWdwX2Jhc2UgPSBkZXZfcHJpdi0+ZG1hX29m
ZnNldCArICh1aW50MzJfdCkgZGV2X3ByaXYtPmFncEFkZHI7Ci0JcXdfcGFkX2NvdW50ID0g
KENNREJVRl9BTElHTk1FTlRfU0laRSA+PiAzKSAtCi0JICAgICgoZGV2X3ByaXYtPmRtYV9s
b3cgJiBDTURCVUZfQUxJR05NRU5UX01BU0spID4+IDMpOwotCi0JY21kX2FkZHIgPSAoYWRk
cikgPyBhZGRyIDoKLQkgICAgYWdwX2Jhc2UgKyBkZXZfcHJpdi0+ZG1hX2xvdyAtIDggKyAo
cXdfcGFkX2NvdW50IDw8IDMpOwotCWFkZHJfbG8gPSAoKEhDX1N1YkFfSEFHUEJwTCA8PCAy
NCkgfCAoY21kX3R5cGUgJiBIQ19IQUdQQnBJRF9NQVNLKSB8Ci0JCSAgIChjbWRfYWRkciAm
IEhDX0hBR1BCcExfTUFTSykpOwotCWFkZHJfaGkgPSAoKEhDX1N1YkFfSEFHUEJwSCA8PCAy
NCkgfCAoY21kX2FkZHIgPj4gMjQpKTsKLQotCXZiID0gdmlhX2FsaWduX2J1ZmZlcihkZXZf
cHJpdiwgdmIsIHF3X3BhZF9jb3VudCAtIDEpOwotCVZJQV9PVVRfUklOR19RVygqY21kX2Fk
ZHJfaGkgPSBhZGRyX2hpLCAqY21kX2FkZHJfbG8gPSBhZGRyX2xvKTsKLQlyZXR1cm4gdmI7
Ci19Ci0KLXN0YXRpYyB2b2lkIHZpYV9jbWRidWZfc3RhcnQoZHJtX3ZpYV9wcml2YXRlX3Qg
KmRldl9wcml2KQotewotCXVpbnQzMl90IHBhdXNlX2FkZHJfbG8sIHBhdXNlX2FkZHJfaGk7
Ci0JdWludDMyX3Qgc3RhcnRfYWRkciwgc3RhcnRfYWRkcl9sbzsKLQl1aW50MzJfdCBlbmRf
YWRkciwgZW5kX2FkZHJfbG87Ci0JdWludDMyX3QgY29tbWFuZDsKLQl1aW50MzJfdCBhZ3Bf
YmFzZTsKLQl1aW50MzJfdCBwdHI7Ci0JdWludDMyX3QgcmVhZGVyOwotCWludCBjb3VudDsK
LQotCWRldl9wcml2LT5kbWFfbG93ID0gMDsKLQotCWFncF9iYXNlID0gZGV2X3ByaXYtPmRt
YV9vZmZzZXQgKyAodWludDMyX3QpIGRldl9wcml2LT5hZ3BBZGRyOwotCXN0YXJ0X2FkZHIg
PSBhZ3BfYmFzZTsKLQllbmRfYWRkciA9IGFncF9iYXNlICsgZGV2X3ByaXYtPmRtYV9oaWdo
OwotCi0Jc3RhcnRfYWRkcl9sbyA9ICgoSENfU3ViQV9IQUdQQnN0TCA8PCAyNCkgfCAoc3Rh
cnRfYWRkciAmIDB4RkZGRkZGKSk7Ci0JZW5kX2FkZHJfbG8gPSAoKEhDX1N1YkFfSEFHUEJl
bmRMIDw8IDI0KSB8IChlbmRfYWRkciAmIDB4RkZGRkZGKSk7Ci0JY29tbWFuZCA9ICgoSENf
U3ViQV9IQUdQQ01OVCA8PCAyNCkgfCAoc3RhcnRfYWRkciA+PiAyNCkgfAotCQkgICAoKGVu
ZF9hZGRyICYgMHhmZjAwMDAwMCkgPj4gMTYpKTsKLQotCWRldl9wcml2LT5sYXN0X3BhdXNl
X3B0ciA9Ci0JICAgIHZpYV9hbGlnbl9jbWQoZGV2X3ByaXYsIEhDX0hBR1BCcElEX1BBVVNF
LCAwLAotCQkJICAmcGF1c2VfYWRkcl9oaSwgJnBhdXNlX2FkZHJfbG8sIDEpIC0gMTsKLQot
CXZpYV9mbHVzaF93cml0ZV9jb21iaW5lKCk7Ci0JKHZvaWQpICoodm9sYXRpbGUgdWludDMy
X3QgKilkZXZfcHJpdi0+bGFzdF9wYXVzZV9wdHI7Ci0KLQl2aWFfd3JpdGUoZGV2X3ByaXYs
IFZJQV9SRUdfVFJBTlNFVCwgKEhDX1BhcmFUeXBlX1ByZUNSIDw8IDE2KSk7Ci0JdmlhX3dy
aXRlKGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgY29tbWFuZCk7Ci0JdmlhX3dyaXRl
KGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgc3RhcnRfYWRkcl9sbyk7Ci0JdmlhX3dy
aXRlKGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgZW5kX2FkZHJfbG8pOwotCi0Jdmlh
X3dyaXRlKGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgcGF1c2VfYWRkcl9oaSk7Ci0J
dmlhX3dyaXRlKGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgcGF1c2VfYWRkcl9sbyk7
Ci0Jd21iKCk7Ci0JdmlhX3dyaXRlKGRldl9wcml2LCBWSUFfUkVHX1RSQU5TUEFDRSwgY29t
bWFuZCB8IEhDX0hBR1BDTU5UX01BU0spOwotCXZpYV9yZWFkKGRldl9wcml2LCBWSUFfUkVH
X1RSQU5TUEFDRSk7Ci0KLQlkZXZfcHJpdi0+ZG1hX2RpZmYgPSAwOwotCi0JY291bnQgPSAx
MDAwMDAwMDsKLQl3aGlsZSAoISh2aWFfcmVhZChkZXZfcHJpdiwgMHg0MWMpICYgMHg4MDAw
MDAwMCkgJiYgY291bnQtLSk7Ci0KLQlyZWFkZXIgPSAqKGRldl9wcml2LT5od19hZGRyX3B0
cik7Ci0JcHRyID0gKCh2b2xhdGlsZSBjaGFyICopZGV2X3ByaXYtPmxhc3RfcGF1c2VfcHRy
IC0gZGV2X3ByaXYtPmRtYV9wdHIpICsKLQkgICAgZGV2X3ByaXYtPmRtYV9vZmZzZXQgKyAo
dWludDMyX3QpIGRldl9wcml2LT5hZ3BBZGRyICsgNDsKLQotCS8qCi0JICogVGhpcyBpcyB0
aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHdoZXJlIHdlIHRlbGwgdGhlCi0JICogY29tbWFuZCBy
ZWFkZXIgdG8gcGF1c2UgYW5kIHdoZXJlIGl0IGFjdHVhbGx5IHBhdXNlcy4KLQkgKiBUaGlz
IGRpZmZlcnMgYmV0d2VlbiBodyBpbXBsZW1lbnRhdGlvbiBzbyB3ZSBuZWVkIHRvCi0JICog
ZGV0ZWN0IGl0LgotCSAqLwotCi0JZGV2X3ByaXYtPmRtYV9kaWZmID0gcHRyIC0gcmVhZGVy
OwotfQotCi1zdGF0aWMgdm9pZCB2aWFfcGFkX2NhY2hlKGRybV92aWFfcHJpdmF0ZV90ICpk
ZXZfcHJpdiwgaW50IHF3b3JkcykKLXsKLQl1aW50MzJfdCAqdmI7Ci0KLQl2aWFfY21kYnVm
X3dhaXQoZGV2X3ByaXYsIHF3b3JkcyArIDIpOwotCXZiID0gdmlhX2dldF9kbWEoZGV2X3By
aXYpOwotCVZJQV9PVVRfUklOR19RVyhIQ19IRUFERVIyLCBIQ19QYXJhVHlwZV9Ob3RUZXgg
PDwgMTYpOwotCXZpYV9hbGlnbl9idWZmZXIoZGV2X3ByaXYsIHZiLCBxd29yZHMpOwotfQot
Ci1zdGF0aWMgaW5saW5lIHZvaWQgdmlhX2R1bW15X2JpdGJsdChkcm1fdmlhX3ByaXZhdGVf
dCAqZGV2X3ByaXYpCi17Ci0JdWludDMyX3QgKnZiID0gdmlhX2dldF9kbWEoZGV2X3ByaXYp
OwotCVNldFJlZzJEQUdQKDB4MEMsICgwIHwgKDAgPDwgMTYpKSk7Ci0JU2V0UmVnMkRBR1Ao
MHgxMCwgMCB8ICgwIDw8IDE2KSk7Ci0JU2V0UmVnMkRBR1AoMHgwLCAweDEgfCAweDIwMDAg
fCAweEFBMDAwMDAwKTsKLX0KLQotc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9qdW1wKGRybV92
aWFfcHJpdmF0ZV90ICpkZXZfcHJpdikKLXsKLQl1aW50MzJfdCBwYXVzZV9hZGRyX2xvLCBw
YXVzZV9hZGRyX2hpOwotCXVpbnQzMl90IGp1bXBfYWRkcl9sbywganVtcF9hZGRyX2hpOwot
CXZvbGF0aWxlIHVpbnQzMl90ICpsYXN0X3BhdXNlX3B0cjsKLQl1aW50MzJfdCBkbWFfbG93
X3NhdmUxLCBkbWFfbG93X3NhdmUyOwotCi0JdmlhX2FsaWduX2NtZChkZXZfcHJpdiwgSENf
SEFHUEJwSURfSlVNUCwgMCwgJmp1bXBfYWRkcl9oaSwKLQkJICAgICAgJmp1bXBfYWRkcl9s
bywgMCk7Ci0KLQlkZXZfcHJpdi0+ZG1hX3dyYXAgPSBkZXZfcHJpdi0+ZG1hX2xvdzsKLQot
CS8qCi0JICogV3JhcCBjb21tYW5kIGJ1ZmZlciB0byB0aGUgYmVnaW5uaW5nLgotCSAqLwot
Ci0JZGV2X3ByaXYtPmRtYV9sb3cgPSAwOwotCWlmICh2aWFfY21kYnVmX3dhaXQoZGV2X3By
aXYsIENNREJVRl9BTElHTk1FTlRfU0laRSkgIT0gMCkKLQkJRFJNX0VSUk9SKCJ2aWFfY21k
YnVmX2p1bXAgZmFpbGVkXG4iKTsKLQotCXZpYV9kdW1teV9iaXRibHQoZGV2X3ByaXYpOwot
CXZpYV9kdW1teV9iaXRibHQoZGV2X3ByaXYpOwotCi0JbGFzdF9wYXVzZV9wdHIgPQotCSAg
ICB2aWFfYWxpZ25fY21kKGRldl9wcml2LCBIQ19IQUdQQnBJRF9QQVVTRSwgMCwgJnBhdXNl
X2FkZHJfaGksCi0JCQkgICZwYXVzZV9hZGRyX2xvLCAwKSAtIDE7Ci0JdmlhX2FsaWduX2Nt
ZChkZXZfcHJpdiwgSENfSEFHUEJwSURfUEFVU0UsIDAsICZwYXVzZV9hZGRyX2hpLAotCQkg
ICAgICAmcGF1c2VfYWRkcl9sbywgMCk7Ci0KLQkqbGFzdF9wYXVzZV9wdHIgPSBwYXVzZV9h
ZGRyX2xvOwotCWRtYV9sb3dfc2F2ZTEgPSBkZXZfcHJpdi0+ZG1hX2xvdzsKLQotCS8qCi0J
ICogTm93LCBzZXQgYSB0cmFwIHRoYXQgd2lsbCBwYXVzZSB0aGUgcmVndWxhdG9yIGlmIGl0
IHRyaWVzIHRvIHJlcnVuIHRoZSBvbGQKLQkgKiBjb21tYW5kIGJ1ZmZlci4gKFdoaWNoIG1h
eSBoYXBwZW4gaWYgdmlhX2hvb2tfc2VnbWVudCBkZXRlY3MgYSBjb21tYW5kIHJlZ3VsYXRv
ciBwYXVzZQotCSAqIGFuZCByZWlzc3VlcyB0aGUganVtcCBjb21tYW5kIG92ZXIgUENJLCB3
aGlsZSB0aGUgcmVndWxhdG9yIGhhcyBhbHJlYWR5IHRha2VuIHRoZSBqdW1wCi0JICogYW5k
IGFjdHVhbGx5IHBhdXNlZCBhdCB0aGUgY3VycmVudCBidWZmZXIgZW5kKS4KLQkgKiBUaGVy
ZSBhcHBlYXJzIHRvIGJlIG5vIG90aGVyIHdheSB0byBkZXRlY3QgdGhpcyBjb25kaXRpb24s
IHNpbmNlIHRoZSBod19hZGRyX3BvaW50ZXIKLQkgKiBkb2VzIG5vdCBzZWVtIHRvIGdldCB1
cGRhdGVkIGltbWVkaWF0ZWx5IHdoZW4gYSBqdW1wIG9jY3Vycy4KLQkgKi8KLQotCWxhc3Rf
cGF1c2VfcHRyID0KLQkJdmlhX2FsaWduX2NtZChkZXZfcHJpdiwgSENfSEFHUEJwSURfUEFV
U0UsIDAsICZwYXVzZV9hZGRyX2hpLAotCQkJICAgICAgJnBhdXNlX2FkZHJfbG8sIDApIC0g
MTsKLQl2aWFfYWxpZ25fY21kKGRldl9wcml2LCBIQ19IQUdQQnBJRF9QQVVTRSwgMCwgJnBh
dXNlX2FkZHJfaGksCi0JCSAgICAgICZwYXVzZV9hZGRyX2xvLCAwKTsKLQkqbGFzdF9wYXVz
ZV9wdHIgPSBwYXVzZV9hZGRyX2xvOwotCi0JZG1hX2xvd19zYXZlMiA9IGRldl9wcml2LT5k
bWFfbG93OwotCWRldl9wcml2LT5kbWFfbG93ID0gZG1hX2xvd19zYXZlMTsKLQl2aWFfaG9v
a19zZWdtZW50KGRldl9wcml2LCBqdW1wX2FkZHJfaGksIGp1bXBfYWRkcl9sbywgMCk7Ci0J
ZGV2X3ByaXYtPmRtYV9sb3cgPSBkbWFfbG93X3NhdmUyOwotCXZpYV9ob29rX3NlZ21lbnQo
ZGV2X3ByaXYsIHBhdXNlX2FkZHJfaGksIHBhdXNlX2FkZHJfbG8sIDApOwotfQotCi0KLXN0
YXRpYyB2b2lkIHZpYV9jbWRidWZfcmV3aW5kKGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJp
dikKLXsKLQl2aWFfY21kYnVmX2p1bXAoZGV2X3ByaXYpOwotfQotCi1zdGF0aWMgdm9pZCB2
aWFfY21kYnVmX2ZsdXNoKGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwgdWludDMyX3Qg
Y21kX3R5cGUpCi17Ci0JdWludDMyX3QgcGF1c2VfYWRkcl9sbywgcGF1c2VfYWRkcl9oaTsK
LQotCXZpYV9hbGlnbl9jbWQoZGV2X3ByaXYsIGNtZF90eXBlLCAwLCAmcGF1c2VfYWRkcl9o
aSwgJnBhdXNlX2FkZHJfbG8sIDApOwotCXZpYV9ob29rX3NlZ21lbnQoZGV2X3ByaXYsIHBh
dXNlX2FkZHJfaGksIHBhdXNlX2FkZHJfbG8sIDApOwotfQotCi1zdGF0aWMgdm9pZCB2aWFf
Y21kYnVmX3BhdXNlKGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdikKLXsKLQl2aWFfY21k
YnVmX2ZsdXNoKGRldl9wcml2LCBIQ19IQUdQQnBJRF9QQVVTRSk7Ci19Ci0KLXN0YXRpYyB2
b2lkIHZpYV9jbWRidWZfcmVzZXQoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQotewot
CXZpYV9jbWRidWZfZmx1c2goZGV2X3ByaXYsIEhDX0hBR1BCcElEX1NUT1ApOwotCXZpYV93
YWl0X2lkbGUoZGV2X3ByaXYpOwotfQotCi0vKgotICogVXNlciBpbnRlcmZhY2UgdG8gdGhl
IHNwYWNlIGFuZCBsYWcgZnVuY3Rpb25zLgotICovCi0KLXN0YXRpYyBpbnQgdmlhX2NtZGJ1
Zl9zaXplKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1f
ZmlsZSAqZmlsZV9wcml2KQotewotCWRybV92aWFfY21kYnVmX3NpemVfdCAqZF9zaXogPSBk
YXRhOwotCWludCByZXQgPSAwOwotCXVpbnQzMl90IHRtcF9zaXplLCBjb3VudDsKLQlkcm1f
dmlhX3ByaXZhdGVfdCAqZGV2X3ByaXY7Ci0KLQlEUk1fREVCVUcoIlxuIik7Ci0JTE9DS19U
RVNUX1dJVEhfUkVUVVJOKGRldiwgZmlsZV9wcml2KTsKLQotCWRldl9wcml2ID0gKGRybV92
aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2X3ByaXZhdGU7Ci0KLQlpZiAoZGV2X3ByaXYtPnJp
bmcudmlydHVhbF9zdGFydCA9PSBOVUxMKSB7Ci0JCURSTV9FUlJPUigiY2FsbGVkIHdpdGhv
dXQgaW5pdGlhbGl6aW5nIEFHUCByaW5nIGJ1ZmZlci5cbiIpOwotCQlyZXR1cm4gLUVGQVVM
VDsKLQl9Ci0KLQljb3VudCA9IDEwMDAwMDA7Ci0JdG1wX3NpemUgPSBkX3Npei0+c2l6ZTsK
LQlzd2l0Y2ggKGRfc2l6LT5mdW5jKSB7Ci0JY2FzZSBWSUFfQ01EQlVGX1NQQUNFOgotCQl3
aGlsZSAoKCh0bXBfc2l6ZSA9IHZpYV9jbWRidWZfc3BhY2UoZGV2X3ByaXYpKSA8IGRfc2l6
LT5zaXplKQotCQkgICAgICAgJiYgLS1jb3VudCkgewotCQkJaWYgKCFkX3Npei0+d2FpdCkK
LQkJCQlicmVhazsKLQkJfQotCQlpZiAoIWNvdW50KSB7Ci0JCQlEUk1fRVJST1IoIlZJQV9D
TURCVUZfU1BBQ0UgdGltZWQgb3V0LlxuIik7Ci0JCQlyZXQgPSAtRUFHQUlOOwotCQl9Ci0J
CWJyZWFrOwotCWNhc2UgVklBX0NNREJVRl9MQUc6Ci0JCXdoaWxlICgoKHRtcF9zaXplID0g
dmlhX2NtZGJ1Zl9sYWcoZGV2X3ByaXYpKSA+IGRfc2l6LT5zaXplKQotCQkgICAgICAgJiYg
LS1jb3VudCkgewotCQkJaWYgKCFkX3Npei0+d2FpdCkKLQkJCQlicmVhazsKLQkJfQotCQlp
ZiAoIWNvdW50KSB7Ci0JCQlEUk1fRVJST1IoIlZJQV9DTURCVUZfTEFHIHRpbWVkIG91dC5c
biIpOwotCQkJcmV0ID0gLUVBR0FJTjsKLQkJfQotCQlicmVhazsKLQlkZWZhdWx0OgotCQly
ZXQgPSAtRUZBVUxUOwotCX0KLQlkX3Npei0+c2l6ZSA9IHRtcF9zaXplOwotCi0JcmV0dXJu
IHJldDsKLX0KLQotY29uc3Qgc3RydWN0IGRybV9pb2N0bF9kZXNjIHZpYV9pb2N0bHNbXSA9
IHsKLQlEUk1fSU9DVExfREVGX0RSVihWSUFfQUxMT0NNRU0sIHZpYV9tZW1fYWxsb2MsIERS
TV9BVVRIKSwKLQlEUk1fSU9DVExfREVGX0RSVihWSUFfRlJFRU1FTSwgdmlhX21lbV9mcmVl
LCBEUk1fQVVUSCksCi0JRFJNX0lPQ1RMX0RFRl9EUlYoVklBX0FHUF9JTklULCB2aWFfYWdw
X2luaXQsIERSTV9BVVRIfERSTV9NQVNURVIpLAotCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9G
Ql9JTklULCB2aWFfZmJfaW5pdCwgRFJNX0FVVEh8RFJNX01BU1RFUiksCi0JRFJNX0lPQ1RM
X0RFRl9EUlYoVklBX01BUF9JTklULCB2aWFfbWFwX2luaXQsIERSTV9BVVRIfERSTV9NQVNU
RVIpLAotCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9ERUNfRlVURVgsIHZpYV9kZWNvZGVyX2Z1
dGV4LCBEUk1fQVVUSCksCi0JRFJNX0lPQ1RMX0RFRl9EUlYoVklBX0RNQV9JTklULCB2aWFf
ZG1hX2luaXQsIERSTV9BVVRIKSwKLQlEUk1fSU9DVExfREVGX0RSVihWSUFfQ01EQlVGRkVS
LCB2aWFfY21kYnVmZmVyLCBEUk1fQVVUSCksCi0JRFJNX0lPQ1RMX0RFRl9EUlYoVklBX0ZM
VVNILCB2aWFfZmx1c2hfaW9jdGwsIERSTV9BVVRIKSwKLQlEUk1fSU9DVExfREVGX0RSVihW
SUFfUENJQ01ELCB2aWFfcGNpX2NtZGJ1ZmZlciwgRFJNX0FVVEgpLAotCURSTV9JT0NUTF9E
RUZfRFJWKFZJQV9DTURCVUZfU0laRSwgdmlhX2NtZGJ1Zl9zaXplLCBEUk1fQVVUSCksCi0J
RFJNX0lPQ1RMX0RFRl9EUlYoVklBX1dBSVRfSVJRLCB2aWFfd2FpdF9pcnEsIERSTV9BVVRI
KSwKLQlEUk1fSU9DVExfREVGX0RSVihWSUFfRE1BX0JMSVQsIHZpYV9kbWFfYmxpdCwgRFJN
X0FVVEgpLAotCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9CTElUX1NZTkMsIHZpYV9kbWFfYmxp
dF9zeW5jLCBEUk1fQVVUSCkKLX07Ci0KLWludCB2aWFfbWF4X2lvY3RsID0gQVJSQVlfU0la
RSh2aWFfaW9jdGxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2Rt
YWJsaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYWJsaXQuYwpkZWxldGVkIGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggZTAxNmE0ZDYyMDkwLi4wMDAwMDAwMDAwMDAKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5jCisrKyAvZGV2L251bGwKQEAgLTEs
ODA3ICswLDAgQEAKLS8qIHZpYV9kbWFibGl0LmMgLS0gUENJIERNQSBCaXRCbHQgc3VwcG9y
dCBmb3IgdGhlIFZJQSBVbmljaHJvbWUvUHJvCi0gKgotICogQ29weXJpZ2h0IChDKSAyMDA1
IFRob21hcyBIZWxsc3Ryb20sIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi0gKgotICogUGVybWlz
c2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24g
b2J0YWluaW5nIGEKLSAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBk
b2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCi0gKiB0byBkZWFsIGluIHRo
ZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1p
dGF0aW9uCi0gKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVi
bGlzaCwgZGlzdHJpYnV0ZSwgc3ViIGxpY2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMg
b2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAq
IFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93
aW5nIGNvbmRpdGlvbnM6Ci0gKgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5k
IHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUKLSAqIG5leHQgcGFyYWdy
YXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBv
cnRpb25zCi0gKiBvZiB0aGUgU29mdHdhcmUuCi0gKgotICogVEhFIFNPRlRXQVJFIElTIFBS
T1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Mg
T1IKLSAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJB
TlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAotICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFS
IFBVUlBPU0UgQU5EIE5PTi1JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMCi0gKiBU
SEUgQ09QWVJJR0hUIEhPTERFUlMsIEFVVEhPUlMgQU5EL09SIElUUyBTVVBQTElFUlMgQkUg
TElBQkxFIEZPUiBBTlkgQ0xBSU0sCi0gKiBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwg
V0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IKLSAqIE9USEVSV0lT
RSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZU
V0FSRSBPUiBUSEUKLSAqIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUu
Ci0gKgotICogQXV0aG9yczoKLSAqICAgIFRob21hcyBIZWxsc3Ryb20uCi0gKiAgICBQYXJ0
aWFsbHkgYmFzZWQgb24gY29kZSBvYnRhaW5lZCBmcm9tIERpZ2VvIEluYy4KLSAqLwotCi0K
LS8qCi0gKiBVbm1hcHMgdGhlIERNQSBtYXBwaW5ncy4KLSAqIEZJWE1FOiBJcyB0aGlzIGEg
Tm9PcCBvbiB4ODY/IEFsc28KLSAqIEZJWE1FOiBXaGF0IGhhcHBlbnMgaWYgdGhpcyBvbmUg
aXMgY2FsbGVkIGFuZCBhIHBlbmRpbmcgYmxpdCBoYXMgcHJldmlvdXNseSBkb25lCi0gKiB0
aGUgc2FtZSBETUEgbWFwcGluZ3M/Ci0gKi8KLQotI2luY2x1ZGUgPGxpbnV4L3BhZ2VtYXAu
aD4KLSNpbmNsdWRlIDxsaW51eC9wY2kuaD4KLSNpbmNsdWRlIDxsaW51eC9zbGFiLmg+Ci0j
aW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgotCi0jaW5jbHVkZSA8ZHJtL2RybV9kZXZpY2Uu
aD4KLSNpbmNsdWRlIDxkcm0vdmlhX2RybS5oPgotCi0jaW5jbHVkZSAidmlhX2RtYWJsaXQu
aCIKLSNpbmNsdWRlICJ2aWFfZHJ2LmgiCi0KLSNkZWZpbmUgVklBX1BHRE4oeCkJICAgICAo
KCh1bnNpZ25lZCBsb25nKSh4KSkgJiBQQUdFX01BU0spCi0jZGVmaW5lIFZJQV9QR09GRih4
KQkgICAgKCgodW5zaWduZWQgbG9uZykoeCkpICYgflBBR0VfTUFTSykKLSNkZWZpbmUgVklB
X1BGTih4KQkgICAgICAoKHVuc2lnbmVkIGxvbmcpKHgpID4+IFBBR0VfU0hJRlQpCi0KLXR5
cGVkZWYgc3RydWN0IF9kcm1fdmlhX2Rlc2NyaXB0b3IgewotCXVpbnQzMl90IG1lbV9hZGRy
OwotCXVpbnQzMl90IGRldl9hZGRyOwotCXVpbnQzMl90IHNpemU7Ci0JdWludDMyX3QgbmV4
dDsKLX0gZHJtX3ZpYV9kZXNjcmlwdG9yX3Q7Ci0KLQotLyoKLSAqIFVubWFwIGEgRE1BIG1h
cHBpbmcuCi0gKi8KLQotCi0KLXN0YXRpYyB2b2lkCi12aWFfdW5tYXBfYmxpdF9mcm9tX2Rl
dmljZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgZHJtX3ZpYV9zZ19pbmZvX3QgKnZzZykKLXsK
LQlpbnQgbnVtX2Rlc2MgPSB2c2ctPm51bV9kZXNjOwotCXVuc2lnbmVkIGN1cl9kZXNjcmlw
dG9yX3BhZ2UgPSBudW1fZGVzYyAvIHZzZy0+ZGVzY3JpcHRvcnNfcGVyX3BhZ2U7Ci0JdW5z
aWduZWQgZGVzY3JpcHRvcl90aGlzX3BhZ2UgPSBudW1fZGVzYyAlIHZzZy0+ZGVzY3JpcHRv
cnNfcGVyX3BhZ2U7Ci0JZHJtX3ZpYV9kZXNjcmlwdG9yX3QgKmRlc2NfcHRyID0gdnNnLT5k
ZXNjX3BhZ2VzW2N1cl9kZXNjcmlwdG9yX3BhZ2VdICsKLQkJZGVzY3JpcHRvcl90aGlzX3Bh
Z2U7Ci0JZG1hX2FkZHJfdCBuZXh0ID0gdnNnLT5jaGFpbl9zdGFydDsKLQotCXdoaWxlIChu
dW1fZGVzYy0tKSB7Ci0JCWlmIChkZXNjcmlwdG9yX3RoaXNfcGFnZS0tID09IDApIHsKLQkJ
CWN1cl9kZXNjcmlwdG9yX3BhZ2UtLTsKLQkJCWRlc2NyaXB0b3JfdGhpc19wYWdlID0gdnNn
LT5kZXNjcmlwdG9yc19wZXJfcGFnZSAtIDE7Ci0JCQlkZXNjX3B0ciA9IHZzZy0+ZGVzY19w
YWdlc1tjdXJfZGVzY3JpcHRvcl9wYWdlXSArCi0JCQkJZGVzY3JpcHRvcl90aGlzX3BhZ2U7
Ci0JCX0KLQkJZG1hX3VubWFwX3NpbmdsZSgmcGRldi0+ZGV2LCBuZXh0LCBzaXplb2YoKmRl
c2NfcHRyKSwgRE1BX1RPX0RFVklDRSk7Ci0JCWRtYV91bm1hcF9wYWdlKCZwZGV2LT5kZXYs
IGRlc2NfcHRyLT5tZW1fYWRkciwgZGVzY19wdHItPnNpemUsIHZzZy0+ZGlyZWN0aW9uKTsK
LQkJbmV4dCA9IChkbWFfYWRkcl90KSBkZXNjX3B0ci0+bmV4dDsKLQkJZGVzY19wdHItLTsK
LQl9Ci19Ci0KLS8qCi0gKiBJZiBtb2RlID0gMCwgY291bnQgaG93IG1hbnkgZGVzY3JpcHRv
cnMgYXJlIG5lZWRlZC4KLSAqIElmIG1vZGUgPSAxLCBNYXAgdGhlIERNQSBwYWdlcyBmb3Ig
dGhlIGRldmljZSwgcHV0IHRvZ2V0aGVyIGFuZCBtYXAgYWxzbyB0aGUgZGVzY3JpcHRvcnMu
Ci0gKiBEZXNjcmlwdG9ycyBhcmUgcnVuIGluIHJldmVyc2Ugb3JkZXIgYnkgdGhlIGhhcmR3
YXJlIGJlY2F1c2Ugd2UgYXJlIG5vdCBhbGxvd2VkIHRvIHVwZGF0ZSB0aGUKLSAqICduZXh0
JyBmaWVsZCB3aXRob3V0IHN5bmNpbmcgY2FsbHMgd2hlbiB0aGUgZGVzY3JpcHRvciBpcyBh
bHJlYWR5IG1hcHBlZC4KLSAqLwotCi1zdGF0aWMgdm9pZAotdmlhX21hcF9ibGl0X2Zvcl9k
ZXZpY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYsCi0JCSAgIGNvbnN0IGRybV92aWFfZG1hYmxp
dF90ICp4ZmVyLAotCQkgICBkcm1fdmlhX3NnX2luZm9fdCAqdnNnLAotCQkgICBpbnQgbW9k
ZSkKLXsKLQl1bnNpZ25lZCBjdXJfZGVzY3JpcHRvcl9wYWdlID0gMDsKLQl1bnNpZ25lZCBu
dW1fZGVzY3JpcHRvcnNfdGhpc19wYWdlID0gMDsKLQl1bnNpZ25lZCBjaGFyICptZW1fYWRk
ciA9IHhmZXItPm1lbV9hZGRyOwotCXVuc2lnbmVkIGNoYXIgKmN1cl9tZW07Ci0JdW5zaWdu
ZWQgY2hhciAqZmlyc3RfYWRkciA9ICh1bnNpZ25lZCBjaGFyICopVklBX1BHRE4obWVtX2Fk
ZHIpOwotCXVpbnQzMl90IGZiX2FkZHIgPSB4ZmVyLT5mYl9hZGRyOwotCXVpbnQzMl90IGN1
cl9mYjsKLQl1bnNpZ25lZCBsb25nIGxpbmVfbGVuOwotCXVuc2lnbmVkIHJlbWFpbmluZ19s
ZW47Ci0JaW50IG51bV9kZXNjID0gMDsKLQlpbnQgY3VyX2xpbmU7Ci0JZG1hX2FkZHJfdCBu
ZXh0ID0gMCB8IFZJQV9ETUFfRFBSX0VDOwotCWRybV92aWFfZGVzY3JpcHRvcl90ICpkZXNj
X3B0ciA9IE5VTEw7Ci0KLQlpZiAobW9kZSA9PSAxKQotCQlkZXNjX3B0ciA9IHZzZy0+ZGVz
Y19wYWdlc1tjdXJfZGVzY3JpcHRvcl9wYWdlXTsKLQotCWZvciAoY3VyX2xpbmUgPSAwOyBj
dXJfbGluZSA8IHhmZXItPm51bV9saW5lczsgKytjdXJfbGluZSkgewotCi0JCWxpbmVfbGVu
ID0geGZlci0+bGluZV9sZW5ndGg7Ci0JCWN1cl9mYiA9IGZiX2FkZHI7Ci0JCWN1cl9tZW0g
PSBtZW1fYWRkcjsKLQotCQl3aGlsZSAobGluZV9sZW4gPiAwKSB7Ci0KLQkJCXJlbWFpbmlu
Z19sZW4gPSBtaW4oUEFHRV9TSVpFLVZJQV9QR09GRihjdXJfbWVtKSwgbGluZV9sZW4pOwot
CQkJbGluZV9sZW4gLT0gcmVtYWluaW5nX2xlbjsKLQotCQkJaWYgKG1vZGUgPT0gMSkgewot
CQkJCWRlc2NfcHRyLT5tZW1fYWRkciA9Ci0JCQkJCWRtYV9tYXBfcGFnZSgmcGRldi0+ZGV2
LAotCQkJCQkJICAgICB2c2ctPnBhZ2VzW1ZJQV9QRk4oY3VyX21lbSkgLQotCQkJCQkJCQlW
SUFfUEZOKGZpcnN0X2FkZHIpXSwKLQkJCQkJCSAgICAgVklBX1BHT0ZGKGN1cl9tZW0pLCBy
ZW1haW5pbmdfbGVuLAotCQkJCQkJICAgICB2c2ctPmRpcmVjdGlvbik7Ci0JCQkJZGVzY19w
dHItPmRldl9hZGRyID0gY3VyX2ZiOwotCi0JCQkJZGVzY19wdHItPnNpemUgPSByZW1haW5p
bmdfbGVuOwotCQkJCWRlc2NfcHRyLT5uZXh0ID0gKHVpbnQzMl90KSBuZXh0OwotCQkJCW5l
eHQgPSBkbWFfbWFwX3NpbmdsZSgmcGRldi0+ZGV2LCBkZXNjX3B0ciwgc2l6ZW9mKCpkZXNj
X3B0ciksCi0JCQkJCQkgICAgICBETUFfVE9fREVWSUNFKTsKLQkJCQlkZXNjX3B0cisrOwot
CQkJCWlmICgrK251bV9kZXNjcmlwdG9yc190aGlzX3BhZ2UgPj0gdnNnLT5kZXNjcmlwdG9y
c19wZXJfcGFnZSkgewotCQkJCQludW1fZGVzY3JpcHRvcnNfdGhpc19wYWdlID0gMDsKLQkJ
CQkJZGVzY19wdHIgPSB2c2ctPmRlc2NfcGFnZXNbKytjdXJfZGVzY3JpcHRvcl9wYWdlXTsK
LQkJCQl9Ci0JCQl9Ci0KLQkJCW51bV9kZXNjKys7Ci0JCQljdXJfbWVtICs9IHJlbWFpbmlu
Z19sZW47Ci0JCQljdXJfZmIgKz0gcmVtYWluaW5nX2xlbjsKLQkJfQotCi0JCW1lbV9hZGRy
ICs9IHhmZXItPm1lbV9zdHJpZGU7Ci0JCWZiX2FkZHIgKz0geGZlci0+ZmJfc3RyaWRlOwot
CX0KLQotCWlmIChtb2RlID09IDEpIHsKLQkJdnNnLT5jaGFpbl9zdGFydCA9IG5leHQ7Ci0J
CXZzZy0+c3RhdGUgPSBkcl92aWFfZGV2aWNlX21hcHBlZDsKLQl9Ci0JdnNnLT5udW1fZGVz
YyA9IG51bV9kZXNjOwotfQotCi0vKgotICogRnVuY3Rpb24gdGhhdCBmcmVlcyB1cCBhbGwg
cmVzb3VyY2VzIGZvciBhIGJsaXQuIEl0IGlzIHVzYWJsZSBldmVuIGlmIHRoZQotICogYmxp
dCBpbmZvIGhhcyBvbmx5IGJlZW4gcGFydGlhbGx5IGJ1aWx0IGFzIGxvbmcgYXMgdGhlIHN0
YXR1cyBlbnVtIGlzIGNvbnNpc3RlbnQKLSAqIHdpdGggdGhlIGFjdHVhbCBzdGF0dXMgb2Yg
dGhlIHVzZWQgcmVzb3VyY2VzLgotICovCi0KLQotc3RhdGljIHZvaWQKLXZpYV9mcmVlX3Nn
X2luZm8oc3RydWN0IHBjaV9kZXYgKnBkZXYsIGRybV92aWFfc2dfaW5mb190ICp2c2cpCi17
Ci0JaW50IGk7Ci0KLQlzd2l0Y2ggKHZzZy0+c3RhdGUpIHsKLQljYXNlIGRyX3ZpYV9kZXZp
Y2VfbWFwcGVkOgotCQl2aWFfdW5tYXBfYmxpdF9mcm9tX2RldmljZShwZGV2LCB2c2cpOwot
CQlmYWxsdGhyb3VnaDsKLQljYXNlIGRyX3ZpYV9kZXNjX3BhZ2VzX2FsbG9jOgotCQlmb3Ig
KGkgPSAwOyBpIDwgdnNnLT5udW1fZGVzY19wYWdlczsgKytpKSB7Ci0JCQlpZiAodnNnLT5k
ZXNjX3BhZ2VzW2ldICE9IE5VTEwpCi0JCQkJZnJlZV9wYWdlKCh1bnNpZ25lZCBsb25nKXZz
Zy0+ZGVzY19wYWdlc1tpXSk7Ci0JCX0KLQkJa2ZyZWUodnNnLT5kZXNjX3BhZ2VzKTsKLQkJ
ZmFsbHRocm91Z2g7Ci0JY2FzZSBkcl92aWFfcGFnZXNfbG9ja2VkOgotCQl1bnBpbl91c2Vy
X3BhZ2VzX2RpcnR5X2xvY2sodnNnLT5wYWdlcywgdnNnLT5udW1fcGFnZXMsCi0JCQkJCSAg
ICh2c2ctPmRpcmVjdGlvbiA9PSBETUFfRlJPTV9ERVZJQ0UpKTsKLQkJZmFsbHRocm91Z2g7
Ci0JY2FzZSBkcl92aWFfcGFnZXNfYWxsb2M6Ci0JCXZmcmVlKHZzZy0+cGFnZXMpOwotCQlm
YWxsdGhyb3VnaDsKLQlkZWZhdWx0OgotCQl2c2ctPnN0YXRlID0gZHJfdmlhX3NnX2luaXQ7
Ci0JfQotCXZmcmVlKHZzZy0+Ym91bmNlX2J1ZmZlcik7Ci0JdnNnLT5ib3VuY2VfYnVmZmVy
ID0gTlVMTDsKLQl2c2ctPmZyZWVfb25fc2VxdWVuY2UgPSAwOwotfQotCi0vKgotICogRmly
ZSBhIGJsaXQgZW5naW5lLgotICovCi0KLXN0YXRpYyB2b2lkCi12aWFfZmlyZV9kbWFibGl0
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGRybV92aWFfc2dfaW5mb190ICp2c2csIGludCBl
bmdpbmUpCi17Ci0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJp
dmF0ZV90ICopZGV2LT5kZXZfcHJpdmF0ZTsKLQotCXZpYV93cml0ZShkZXZfcHJpdiwgVklB
X1BDSV9ETUFfTUFSMCArIGVuZ2luZSoweDEwLCAwKTsKLQl2aWFfd3JpdGUoZGV2X3ByaXYs
IFZJQV9QQ0lfRE1BX0RBUjAgKyBlbmdpbmUqMHgxMCwgMCk7Ci0JdmlhX3dyaXRlKGRldl9w
cml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4MDQsIFZJQV9ETUFfQ1NSX0REIHwg
VklBX0RNQV9DU1JfVEQgfAotCQkgIFZJQV9ETUFfQ1NSX0RFKTsKLQl2aWFfd3JpdGUoZGV2
X3ByaXYsIFZJQV9QQ0lfRE1BX01SMCAgKyBlbmdpbmUqMHgwNCwgVklBX0RNQV9NUl9DTSB8
IFZJQV9ETUFfTVJfVERJRSk7Ci0JdmlhX3dyaXRlKGRldl9wcml2LCBWSUFfUENJX0RNQV9C
Q1IwICsgZW5naW5lKjB4MTAsIDApOwotCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1BDSV9E
TUFfRFBSMCArIGVuZ2luZSoweDEwLCB2c2ctPmNoYWluX3N0YXJ0KTsKLQl3bWIoKTsKLQl2
aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9QQ0lfRE1BX0NTUjAgKyBlbmdpbmUqMHgwNCwgVklB
X0RNQV9DU1JfREUgfCBWSUFfRE1BX0NTUl9UUyk7Ci0JdmlhX3JlYWQoZGV2X3ByaXYsIFZJ
QV9QQ0lfRE1BX0NTUjAgKyBlbmdpbmUqMHgwNCk7Ci19Ci0KLS8qCi0gKiBPYnRhaW4gYSBw
YWdlIHBvaW50ZXIgYXJyYXkgYW5kIGxvY2sgYWxsIHBhZ2VzIGludG8gc3lzdGVtIG1lbW9y
eS4gQSBzZWdtZW50YXRpb24gdmlvbGF0aW9uIHdpbGwKLSAqIG9jY3VyIGhlcmUgaWYgdGhl
IGNhbGxpbmcgdXNlciBkb2VzIG5vdCBoYXZlIGFjY2VzcyB0byB0aGUgc3VibWl0dGVkIGFk
ZHJlc3MuCi0gKi8KLQotc3RhdGljIGludAotdmlhX2xvY2tfYWxsX2RtYV9wYWdlcyhkcm1f
dmlhX3NnX2luZm9fdCAqdnNnLCAgZHJtX3ZpYV9kbWFibGl0X3QgKnhmZXIpCi17Ci0JaW50
IHJldDsKLQl1bnNpZ25lZCBsb25nIGZpcnN0X3BmbiA9IFZJQV9QRk4oeGZlci0+bWVtX2Fk
ZHIpOwotCXZzZy0+bnVtX3BhZ2VzID0gVklBX1BGTih4ZmVyLT5tZW1fYWRkciArICh4ZmVy
LT5udW1fbGluZXMgKiB4ZmVyLT5tZW1fc3RyaWRlIC0gMSkpIC0KLQkJZmlyc3RfcGZuICsg
MTsKLQotCXZzZy0+cGFnZXMgPSB2emFsbG9jKGFycmF5X3NpemUoc2l6ZW9mKHN0cnVjdCBw
YWdlICopLCB2c2ctPm51bV9wYWdlcykpOwotCWlmIChOVUxMID09IHZzZy0+cGFnZXMpCi0J
CXJldHVybiAtRU5PTUVNOwotCXJldCA9IHBpbl91c2VyX3BhZ2VzX2Zhc3QoKHVuc2lnbmVk
IGxvbmcpeGZlci0+bWVtX2FkZHIsCi0JCQl2c2ctPm51bV9wYWdlcywKLQkJCXZzZy0+ZGly
ZWN0aW9uID09IERNQV9GUk9NX0RFVklDRSA/IEZPTExfV1JJVEUgOiAwLAotCQkJdnNnLT5w
YWdlcyk7Ci0JaWYgKHJldCAhPSB2c2ctPm51bV9wYWdlcykgewotCQlpZiAocmV0IDwgMCkK
LQkJCXJldHVybiByZXQ7Ci0JCXZzZy0+c3RhdGUgPSBkcl92aWFfcGFnZXNfbG9ja2VkOwot
CQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0JdnNnLT5zdGF0ZSA9IGRyX3ZpYV9wYWdlc19sb2Nr
ZWQ7Ci0JRFJNX0RFQlVHKCJETUEgcGFnZXMgbG9ja2VkXG4iKTsKLQlyZXR1cm4gMDsKLX0K
LQotLyoKLSAqIEFsbG9jYXRlIERNQSBjYXBhYmxlIG1lbW9yeSBmb3IgdGhlIGJsaXQgZGVz
Y3JpcHRvciBjaGFpbiwgYW5kIGFuIGFycmF5IHRoYXQga2VlcHMgdHJhY2sgb2YgdGhlCi0g
KiBwYWdlcyB3ZSBhbGxvY2F0ZS4gV2UgZG9uJ3Qgd2FudCB0byB1c2Uga21hbGxvYyBmb3Ig
dGhlIGRlc2NyaXB0b3IgY2hhaW4gYmVjYXVzZSBpdCBtYXkgYmUKLSAqIHF1aXRlIGxhcmdl
IGZvciBzb21lIGJsaXRzLCBhbmQgcGFnZXMgZG9uJ3QgbmVlZCB0byBiZSBjb250aWd1b3Vz
LgotICovCi0KLXN0YXRpYyBpbnQKLXZpYV9hbGxvY19kZXNjX3BhZ2VzKGRybV92aWFfc2df
aW5mb190ICp2c2cpCi17Ci0JaW50IGk7Ci0KLQl2c2ctPmRlc2NyaXB0b3JzX3Blcl9wYWdl
ID0gUEFHRV9TSVpFIC8gc2l6ZW9mKGRybV92aWFfZGVzY3JpcHRvcl90KTsKLQl2c2ctPm51
bV9kZXNjX3BhZ2VzID0gKHZzZy0+bnVtX2Rlc2MgKyB2c2ctPmRlc2NyaXB0b3JzX3Blcl9w
YWdlIC0gMSkgLwotCQl2c2ctPmRlc2NyaXB0b3JzX3Blcl9wYWdlOwotCi0JaWYgKE5VTEwg
PT0gICh2c2ctPmRlc2NfcGFnZXMgPSBrY2FsbG9jKHZzZy0+bnVtX2Rlc2NfcGFnZXMsIHNp
emVvZih2b2lkICopLCBHRlBfS0VSTkVMKSkpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JdnNn
LT5zdGF0ZSA9IGRyX3ZpYV9kZXNjX3BhZ2VzX2FsbG9jOwotCWZvciAoaSA9IDA7IGkgPCB2
c2ctPm51bV9kZXNjX3BhZ2VzOyArK2kpIHsKLQkJaWYgKE5VTEwgPT0gKHZzZy0+ZGVzY19w
YWdlc1tpXSA9Ci0JCQkgICAgIChkcm1fdmlhX2Rlc2NyaXB0b3JfdCAqKSBfX2dldF9mcmVl
X3BhZ2UoR0ZQX0tFUk5FTCkpKQotCQkJcmV0dXJuIC1FTk9NRU07Ci0JfQotCURSTV9ERUJV
RygiQWxsb2NhdGVkICVkIHBhZ2VzIGZvciAlZCBkZXNjcmlwdG9ycy5cbiIsIHZzZy0+bnVt
X2Rlc2NfcGFnZXMsCi0JCSAgdnNnLT5udW1fZGVzYyk7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyB2b2lkCi12aWFfYWJvcnRfZG1hYmxpdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBp
bnQgZW5naW5lKQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlh
X3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGU7Ci0KLQl2aWFfd3JpdGUoZGV2X3ByaXYs
IFZJQV9QQ0lfRE1BX0NTUjAgKyBlbmdpbmUqMHgwNCwgVklBX0RNQV9DU1JfVEEpOwotfQot
Ci1zdGF0aWMgdm9pZAotdmlhX2RtYWJsaXRfZW5naW5lX29mZihzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBpbnQgZW5naW5lKQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9
IChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGU7Ci0KLQl2aWFfd3JpdGUo
ZGV2X3ByaXYsIFZJQV9QQ0lfRE1BX0NTUjAgKyBlbmdpbmUqMHgwNCwgVklBX0RNQV9DU1Jf
VEQgfCBWSUFfRE1BX0NTUl9ERCk7Ci19Ci0KLQotCi0vKgotICogVGhlIGRtYWJsaXQgcGFy
dCBvZiB0aGUgSVJRIGhhbmRsZXIuIFRyeWluZyB0byBkbyBvbmx5IHJlYXNvbmFibHkgZmFz
dCB0aGluZ3MgaGVyZS4KLSAqIFRoZSByZXN0LCBsaWtlIHVubWFwcGluZyBhbmQgZnJlZWlu
ZyBtZW1vcnkgZm9yIGRvbmUgYmxpdHMgaXMgZG9uZSBpbiBhIHNlcGFyYXRlIHdvcmtxdWV1
ZQotICogdGFzay4gQmFzaWNhbGx5IHRoZSB0YXNrIG9mIHRoZSBpbnRlcnJ1cHQgaGFuZGxl
ciBpcyB0byBzdWJtaXQgYSBuZXcgYmxpdCB0byB0aGUgZW5naW5lLCB3aGlsZQotICogdGhl
IHdvcmtxdWV1ZSB0YXNrIHRha2VzIGNhcmUgb2YgcHJvY2Vzc2luZyBhc3NvY2lhdGVkIHdp
dGggdGhlIG9sZCBibGl0LgotICovCi0KLXZvaWQKLXZpYV9kbWFibGl0X2hhbmRsZXIoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGVuZ2luZSwgaW50IGZyb21faXJxKQotewotCWRy
bV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+
ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9ibGl0cV90ICpibGl0cSA9IGRldl9wcml2LT5ibGl0
X3F1ZXVlcyArIGVuZ2luZTsKLQlpbnQgY3VyOwotCWludCBkb25lX3RyYW5zZmVyOwotCXVu
c2lnbmVkIGxvbmcgaXJxc2F2ZSA9IDA7Ci0JdWludDMyX3Qgc3RhdHVzID0gMDsKLQotCURS
TV9ERUJVRygiRE1BIGJsaXQgaGFuZGxlciBjYWxsZWQuIGVuZ2luZSA9ICVkLCBmcm9tX2ly
cSA9ICVkLCBibGl0cSA9IDB4JWx4XG4iLAotCQkgIGVuZ2luZSwgZnJvbV9pcnEsICh1bnNp
Z25lZCBsb25nKSBibGl0cSk7Ci0KLQlpZiAoZnJvbV9pcnEpCi0JCXNwaW5fbG9jaygmYmxp
dHEtPmJsaXRfbG9jayk7Ci0JZWxzZQotCQlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJs
aXRfbG9jaywgaXJxc2F2ZSk7Ci0KLQlkb25lX3RyYW5zZmVyID0gYmxpdHEtPmlzX2FjdGl2
ZSAmJgotCSAgKChzdGF0dXMgPSB2aWFfcmVhZChkZXZfcHJpdiwgVklBX1BDSV9ETUFfQ1NS
MCArIGVuZ2luZSoweDA0KSkgJiBWSUFfRE1BX0NTUl9URCk7Ci0JZG9uZV90cmFuc2ZlciA9
IGRvbmVfdHJhbnNmZXIgfHwgKGJsaXRxLT5hYm9ydGluZyAmJiAhKHN0YXR1cyAmIFZJQV9E
TUFfQ1NSX0RFKSk7Ci0KLQljdXIgPSBibGl0cS0+Y3VyOwotCWlmIChkb25lX3RyYW5zZmVy
KSB7Ci0KLQkJYmxpdHEtPmJsaXRzW2N1cl0tPmFib3J0ZWQgPSBibGl0cS0+YWJvcnRpbmc7
Ci0JCWJsaXRxLT5kb25lX2JsaXRfaGFuZGxlKys7Ci0JCXdha2VfdXAoYmxpdHEtPmJsaXRf
cXVldWUgKyBjdXIpOwotCi0JCWN1cisrOwotCQlpZiAoY3VyID49IFZJQV9OVU1fQkxJVF9T
TE9UUykKLQkJCWN1ciA9IDA7Ci0JCWJsaXRxLT5jdXIgPSBjdXI7Ci0KLQkJLyoKLQkJICog
Q2xlYXIgdHJhbnNmZXIgZG9uZSBmbGFnLgotCQkgKi8KLQotCQl2aWFfd3JpdGUoZGV2X3By
aXYsIFZJQV9QQ0lfRE1BX0NTUjAgKyBlbmdpbmUqMHgwNCwgIFZJQV9ETUFfQ1NSX1REKTsK
LQotCQlibGl0cS0+aXNfYWN0aXZlID0gMDsKLQkJYmxpdHEtPmFib3J0aW5nID0gMDsKLQkJ
c2NoZWR1bGVfd29yaygmYmxpdHEtPndxKTsKLQotCX0gZWxzZSBpZiAoYmxpdHEtPmlzX2Fj
dGl2ZSAmJiB0aW1lX2FmdGVyX2VxKGppZmZpZXMsIGJsaXRxLT5lbmQpKSB7Ci0KLQkJLyoK
LQkJICogQWJvcnQgdHJhbnNmZXIgYWZ0ZXIgb25lIHNlY29uZC4KLQkJICovCi0KLQkJdmlh
X2Fib3J0X2RtYWJsaXQoZGV2LCBlbmdpbmUpOwotCQlibGl0cS0+YWJvcnRpbmcgPSAxOwot
CQlibGl0cS0+ZW5kID0gamlmZmllcyArIEhaOwotCX0KLQotCWlmICghYmxpdHEtPmlzX2Fj
dGl2ZSkgewotCQlpZiAoYmxpdHEtPm51bV9vdXRzdGFuZGluZykgewotCQkJdmlhX2ZpcmVf
ZG1hYmxpdChkZXYsIGJsaXRxLT5ibGl0c1tjdXJdLCBlbmdpbmUpOwotCQkJYmxpdHEtPmlz
X2FjdGl2ZSA9IDE7Ci0JCQlibGl0cS0+Y3VyID0gY3VyOwotCQkJYmxpdHEtPm51bV9vdXRz
dGFuZGluZy0tOwotCQkJYmxpdHEtPmVuZCA9IGppZmZpZXMgKyBIWjsKLQkJCWlmICghdGlt
ZXJfcGVuZGluZygmYmxpdHEtPnBvbGxfdGltZXIpKQotCQkJCW1vZF90aW1lcigmYmxpdHEt
PnBvbGxfdGltZXIsIGppZmZpZXMgKyAxKTsKLQkJfSBlbHNlIHsKLQkJCWlmICh0aW1lcl9w
ZW5kaW5nKCZibGl0cS0+cG9sbF90aW1lcikpCi0JCQkJZGVsX3RpbWVyKCZibGl0cS0+cG9s
bF90aW1lcik7Ci0JCQl2aWFfZG1hYmxpdF9lbmdpbmVfb2ZmKGRldiwgZW5naW5lKTsKLQkJ
fQotCX0KLQotCWlmIChmcm9tX2lycSkKLQkJc3Bpbl91bmxvY2soJmJsaXRxLT5ibGl0X2xv
Y2spOwotCWVsc2UKLQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYmxpdHEtPmJsaXRfbG9j
aywgaXJxc2F2ZSk7Ci19Ci0KLQotCi0vKgotICogQ2hlY2sgd2hldGhlciB0aGlzIGJsaXQg
aXMgc3RpbGwgYWN0aXZlLCBwZXJmb3JtaW5nIG5lY2Vzc2FyeSBsb2NraW5nLgotICovCi0K
LXN0YXRpYyBpbnQKLXZpYV9kbWFibGl0X2FjdGl2ZShkcm1fdmlhX2JsaXRxX3QgKmJsaXRx
LCBpbnQgZW5naW5lLCB1aW50MzJfdCBoYW5kbGUsIHdhaXRfcXVldWVfaGVhZF90ICoqcXVl
dWUpCi17Ci0JdW5zaWduZWQgbG9uZyBpcnFzYXZlOwotCXVpbnQzMl90IHNsb3Q7Ci0JaW50
IGFjdGl2ZTsKLQotCXNwaW5fbG9ja19pcnFzYXZlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFz
YXZlKTsKLQotCS8qCi0JICogQWxsb3cgZm9yIGhhbmRsZSB3cmFwYXJvdW5kcy4KLQkgKi8K
LQotCWFjdGl2ZSA9ICgoYmxpdHEtPmRvbmVfYmxpdF9oYW5kbGUgLSBoYW5kbGUpID4gKDEg
PDwgMjMpKSAmJgotCQkoKGJsaXRxLT5jdXJfYmxpdF9oYW5kbGUgLSBoYW5kbGUpIDw9ICgx
IDw8IDIzKSk7Ci0KLQlpZiAocXVldWUgJiYgYWN0aXZlKSB7Ci0JCXNsb3QgPSBoYW5kbGUg
LSBibGl0cS0+ZG9uZV9ibGl0X2hhbmRsZSArIGJsaXRxLT5jdXIgLSAxOwotCQlpZiAoc2xv
dCA+PSBWSUFfTlVNX0JMSVRfU0xPVFMpCi0JCQlzbG90IC09IFZJQV9OVU1fQkxJVF9TTE9U
UzsKLQkJKnF1ZXVlID0gYmxpdHEtPmJsaXRfcXVldWUgKyBzbG90OwotCX0KLQotCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmJsaXRxLT5ibGl0X2xvY2ssIGlycXNhdmUpOwotCi0JcmV0
dXJuIGFjdGl2ZTsKLX0KLQotLyoKLSAqIFN5bmMuIFdhaXQgZm9yIGF0IGxlYXN0IHRocmVl
IHNlY29uZHMgZm9yIHRoZSBibGl0IHRvIGJlIHBlcmZvcm1lZC4KLSAqLwotCi1zdGF0aWMg
aW50Ci12aWFfZG1hYmxpdF9zeW5jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVpbnQzMl90
IGhhbmRsZSwgaW50IGVuZ2luZSkKLXsKLQotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJp
diA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9i
bGl0cV90ICpibGl0cSA9IGRldl9wcml2LT5ibGl0X3F1ZXVlcyArIGVuZ2luZTsKLQl3YWl0
X3F1ZXVlX2hlYWRfdCAqcXVldWU7Ci0JaW50IHJldCA9IDA7Ci0KLQlpZiAodmlhX2RtYWJs
aXRfYWN0aXZlKGJsaXRxLCBlbmdpbmUsIGhhbmRsZSwgJnF1ZXVlKSkgewotCQlWSUFfV0FJ
VF9PTihyZXQsICpxdWV1ZSwgMyAqIEhaLAotCQkJICAgICF2aWFfZG1hYmxpdF9hY3RpdmUo
YmxpdHEsIGVuZ2luZSwgaGFuZGxlLCBOVUxMKSk7Ci0JfQotCURSTV9ERUJVRygiRE1BIGJs
aXQgc3luYyBoYW5kbGUgMHgleCBlbmdpbmUgJWQgcmV0dXJuZWQgJWRcbiIsCi0JCSAgaGFu
ZGxlLCBlbmdpbmUsIHJldCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi0KLS8qCi0gKiBBIHRp
bWVyIHRoYXQgcmVndWxhcmx5IHBvbGxzIHRoZSBibGl0IGVuZ2luZSBpbiBjYXNlcyB3aGVy
ZSB3ZSBkb24ndCBoYXZlIGludGVycnVwdHM6Ci0gKiBhKSBCcm9rZW4gaGFyZHdhcmUgKHR5
cGljYWxseSB0aG9zZSB0aGF0IGRvbid0IGhhdmUgYW55IHZpZGVvIGNhcHR1cmUgZmFjaWxp
dHkpLgotICogYikgQmxpdCBhYm9ydC4gVGhlIGhhcmR3YXJlIGRvZXNuJ3Qgc2VuZCBhbiBp
bnRlcnJ1cHQgd2hlbiBhIGJsaXQgaXMgYWJvcnRlZC4KLSAqIFRoZSB0aW1lciBhbmQgaGFy
ZHdhcmUgSVJRJ3MgY2FuIGFuZCBkbyB3b3JrIGluIHBhcmFsbGVsLiBJZiB0aGUgaGFyZHdh
cmUgaGFzCi0gKiBpcnFzLCBpdCB3aWxsIHNob3J0ZW4gdGhlIGxhdGVuY3kgc29tZXdoYXQu
Ci0gKi8KLQotCi0KLXN0YXRpYyB2b2lkCi12aWFfZG1hYmxpdF90aW1lcihzdHJ1Y3QgdGlt
ZXJfbGlzdCAqdCkKLXsKLQlkcm1fdmlhX2JsaXRxX3QgKmJsaXRxID0gZnJvbV90aW1lcihi
bGl0cSwgdCwgcG9sbF90aW1lcik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGJsaXRx
LT5kZXY7Ci0JaW50IGVuZ2luZSA9IChpbnQpCi0JCShibGl0cSAtICgoZHJtX3ZpYV9wcml2
YXRlX3QgKilkZXYtPmRldl9wcml2YXRlKS0+YmxpdF9xdWV1ZXMpOwotCi0JRFJNX0RFQlVH
KCJQb2xsaW5nIHRpbWVyIGNhbGxlZCBmb3IgZW5naW5lICVkLCBqaWZmaWVzICVsdVxuIiwg
ZW5naW5lLAotCQkgICh1bnNpZ25lZCBsb25nKSBqaWZmaWVzKTsKLQotCXZpYV9kbWFibGl0
X2hhbmRsZXIoZGV2LCBlbmdpbmUsIDApOwotCi0JaWYgKCF0aW1lcl9wZW5kaW5nKCZibGl0
cS0+cG9sbF90aW1lcikpIHsKLQkJbW9kX3RpbWVyKCZibGl0cS0+cG9sbF90aW1lciwgamlm
ZmllcyArIDEpOwotCi0JICAgICAgIC8qCi0JCSogUmVydW4gaGFuZGxlciB0byBkZWxldGUg
dGltZXIgaWYgZW5naW5lcyBhcmUgb2ZmLCBhbmQKLQkJKiB0byBzaG9ydGVuIGFib3J0IGxh
dGVuY3kuIFRoaXMgaXMgYSBsaXR0bGUgbmFzdHkuCi0JCSovCi0KLQkgICAgICAgdmlhX2Rt
YWJsaXRfaGFuZGxlcihkZXYsIGVuZ2luZSwgMCk7Ci0KLQl9Ci19Ci0KLQotCi0KLS8qCi0g
KiBXb3JrcXVldWUgdGFzayB0aGF0IGZyZWVzIGRhdGEgYW5kIG1hcHBpbmdzIGFzc29jaWF0
ZWQgd2l0aCBhIGJsaXQuCi0gKiBBbHNvIHdha2VzIHVwIHdhaXRpbmcgcHJvY2Vzc2VzLiBF
YWNoIG9mIHRoZXNlIHRhc2tzIGhhbmRsZXMgb25lCi0gKiBibGl0IGVuZ2luZSBvbmx5IGFu
ZCBtYXkgbm90IGJlIGNhbGxlZCBvbiBlYWNoIGludGVycnVwdC4KLSAqLwotCi0KLXN0YXRp
YyB2b2lkCi12aWFfZG1hYmxpdF93b3JrcXVldWUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQotewotCWRybV92aWFfYmxpdHFfdCAqYmxpdHEgPSBjb250YWluZXJfb2Yod29yaywgZHJt
X3ZpYV9ibGl0cV90LCB3cSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGJsaXRxLT5k
ZXY7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB0b19wY2lfZGV2KGRldi0+ZGV2KTsKLQl1
bnNpZ25lZCBsb25nIGlycXNhdmU7Ci0JZHJtX3ZpYV9zZ19pbmZvX3QgKmN1cl9zZzsKLQlp
bnQgY3VyX3JlbGVhc2VkOwotCi0KLQlEUk1fREVCVUcoIldvcmtxdWV1ZSB0YXNrIGNhbGxl
ZCBmb3IgYmxpdCBlbmdpbmUgJWxkXG4iLCAodW5zaWduZWQgbG9uZykKLQkJICAoYmxpdHEg
LSAoKGRybV92aWFfcHJpdmF0ZV90ICopZGV2LT5kZXZfcHJpdmF0ZSktPmJsaXRfcXVldWVz
KSk7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2ZSk7
Ci0KLQl3aGlsZSAoYmxpdHEtPnNlcnZpY2VkICE9IGJsaXRxLT5jdXIpIHsKLQotCQljdXJf
cmVsZWFzZWQgPSBibGl0cS0+c2VydmljZWQrKzsKLQotCQlEUk1fREVCVUcoIlJlbGVhc2lu
ZyBibGl0IHNsb3QgJWRcbiIsIGN1cl9yZWxlYXNlZCk7Ci0KLQkJaWYgKGJsaXRxLT5zZXJ2
aWNlZCA+PSBWSUFfTlVNX0JMSVRfU0xPVFMpCi0JCQlibGl0cS0+c2VydmljZWQgPSAwOwot
Ci0JCWN1cl9zZyA9IGJsaXRxLT5ibGl0c1tjdXJfcmVsZWFzZWRdOwotCQlibGl0cS0+bnVt
X2ZyZWUrKzsKLQotCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2Nr
LCBpcnFzYXZlKTsKLQotCQl3YWtlX3VwKCZibGl0cS0+YnVzeV9xdWV1ZSk7Ci0KLQkJdmlh
X2ZyZWVfc2dfaW5mbyhwZGV2LCBjdXJfc2cpOwotCQlrZnJlZShjdXJfc2cpOwotCi0JCXNw
aW5fbG9ja19pcnFzYXZlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsKLQl9Ci0KLQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsKLX0K
LQotCi0vKgotICogSW5pdCBhbGwgYmxpdCBlbmdpbmVzLiBDdXJyZW50bHkgd2UgdXNlIHR3
bywgYnV0IHNvbWUgaGFyZHdhcmUgaGF2ZSA0LgotICovCi0KLQotdm9pZAotdmlhX2luaXRf
ZG1hYmxpdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQotewotCWludCBpLCBqOwotCWRybV92
aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2
X3ByaXZhdGU7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB0b19wY2lfZGV2KGRldi0+ZGV2
KTsKLQlkcm1fdmlhX2JsaXRxX3QgKmJsaXRxOwotCi0JcGNpX3NldF9tYXN0ZXIocGRldik7
Ci0KLQlmb3IgKGkgPSAwOyBpIDwgVklBX05VTV9CTElUX0VOR0lORVM7ICsraSkgewotCQli
bGl0cSA9IGRldl9wcml2LT5ibGl0X3F1ZXVlcyArIGk7Ci0JCWJsaXRxLT5kZXYgPSBkZXY7
Ci0JCWJsaXRxLT5jdXJfYmxpdF9oYW5kbGUgPSAwOwotCQlibGl0cS0+ZG9uZV9ibGl0X2hh
bmRsZSA9IDA7Ci0JCWJsaXRxLT5oZWFkID0gMDsKLQkJYmxpdHEtPmN1ciA9IDA7Ci0JCWJs
aXRxLT5zZXJ2aWNlZCA9IDA7Ci0JCWJsaXRxLT5udW1fZnJlZSA9IFZJQV9OVU1fQkxJVF9T
TE9UUyAtIDE7Ci0JCWJsaXRxLT5udW1fb3V0c3RhbmRpbmcgPSAwOwotCQlibGl0cS0+aXNf
YWN0aXZlID0gMDsKLQkJYmxpdHEtPmFib3J0aW5nID0gMDsKLQkJc3Bpbl9sb2NrX2luaXQo
JmJsaXRxLT5ibGl0X2xvY2spOwotCQlmb3IgKGogPSAwOyBqIDwgVklBX05VTV9CTElUX1NM
T1RTOyArK2opCi0JCQlpbml0X3dhaXRxdWV1ZV9oZWFkKGJsaXRxLT5ibGl0X3F1ZXVlICsg
aik7Ci0JCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmJsaXRxLT5idXN5X3F1ZXVlKTsKLQkJSU5J
VF9XT1JLKCZibGl0cS0+d3EsIHZpYV9kbWFibGl0X3dvcmtxdWV1ZSk7Ci0JCXRpbWVyX3Nl
dHVwKCZibGl0cS0+cG9sbF90aW1lciwgdmlhX2RtYWJsaXRfdGltZXIsIDApOwotCX0KLX0K
LQotLyoKLSAqIEJ1aWxkIGFsbCBpbmZvIGFuZCBkbyBhbGwgbWFwcGluZ3MgcmVxdWlyZWQg
Zm9yIGEgYmxpdC4KLSAqLwotCi0KLXN0YXRpYyBpbnQKLXZpYV9idWlsZF9zZ19pbmZvKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIGRybV92aWFfc2dfaW5mb190ICp2c2csIGRybV92aWFf
ZG1hYmxpdF90ICp4ZmVyKQotewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2Rl
dihkZXYtPmRldik7Ci0JaW50IGRyYXcgPSB4ZmVyLT50b19mYjsKLQlpbnQgcmV0ID0gMDsK
LQotCXZzZy0+ZGlyZWN0aW9uID0gKGRyYXcpID8gRE1BX1RPX0RFVklDRSA6IERNQV9GUk9N
X0RFVklDRTsKLQl2c2ctPmJvdW5jZV9idWZmZXIgPSBOVUxMOwotCi0JdnNnLT5zdGF0ZSA9
IGRyX3ZpYV9zZ19pbml0OwotCi0JaWYgKHhmZXItPm51bV9saW5lcyA8PSAwIHx8IHhmZXIt
PmxpbmVfbGVuZ3RoIDw9IDApIHsKLQkJRFJNX0VSUk9SKCJaZXJvIHNpemUgYml0Ymx0Llxu
Iik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCS8qCi0JICogQmVsb3cgY2hlY2sgaXMg
YSBkcml2ZXIgbGltaXRhdGlvbiwgbm90IGEgaGFyZHdhcmUgb25lLiBXZQotCSAqIGRvbid0
IHdhbnQgdG8gbG9jayB1bnVzZWQgcGFnZXMsIGFuZCBkb24ndCB3YW50IHRvIGluY29wb3Jh
dGUgdGhlCi0JICogZXh0cmEgbG9naWMgb2YgYXZvaWRpbmcgdGhlbS4gTWFrZSBzdXJlIHRo
ZXJlIGFyZSBuby4KLQkgKiAoTm90IGEgYmlnIGxpbWl0YXRpb24gYW55d2F5LikKLQkgKi8K
LQotCWlmICgoeGZlci0+bWVtX3N0cmlkZSAtIHhmZXItPmxpbmVfbGVuZ3RoKSA+IDIqUEFH
RV9TSVpFKSB7Ci0JCURSTV9FUlJPUigiVG9vIGxhcmdlIHN5c3RlbSBtZW1vcnkgc3RyaWRl
LiBTdHJpZGU6ICVkLCAiCi0JCQkgICJMZW5ndGg6ICVkXG4iLCB4ZmVyLT5tZW1fc3RyaWRl
LCB4ZmVyLT5saW5lX2xlbmd0aCk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWlmICgo
eGZlci0+bWVtX3N0cmlkZSA9PSB4ZmVyLT5saW5lX2xlbmd0aCkgJiYKLQkgICAoeGZlci0+
ZmJfc3RyaWRlID09IHhmZXItPmxpbmVfbGVuZ3RoKSkgewotCQl4ZmVyLT5tZW1fc3RyaWRl
ICo9IHhmZXItPm51bV9saW5lczsKLQkJeGZlci0+bGluZV9sZW5ndGggPSB4ZmVyLT5tZW1f
c3RyaWRlOwotCQl4ZmVyLT5mYl9zdHJpZGUgPSB4ZmVyLT5tZW1fc3RyaWRlOwotCQl4ZmVy
LT5udW1fbGluZXMgPSAxOwotCX0KLQotCS8qCi0JICogRG9uJ3QgbG9jayBhbiBhcmJpdHJh
cnkgbGFyZ2UgbnVtYmVyIG9mIHBhZ2VzLCBzaW5jZSB0aGF0IGNhdXNlcyBhCi0JICogRE9T
IHNlY3VyaXR5IGhvbGUuCi0JICovCi0KLQlpZiAoeGZlci0+bnVtX2xpbmVzID4gMjA0OCB8
fCAoeGZlci0+bnVtX2xpbmVzKnhmZXItPm1lbV9zdHJpZGUgPiAoMjA0OCoyMDQ4KjQpKSkg
ewotCQlEUk1fRVJST1IoIlRvbyBsYXJnZSBQQ0kgRE1BIGJpdGJsdC5cbiIpOwotCQlyZXR1
cm4gLUVJTlZBTDsKLQl9Ci0KLQkvKgotCSAqIHdlIGFsbG93IGEgbmVnYXRpdmUgZmIgc3Ry
aWRlIHRvIGFsbG93IGZsaXBwaW5nIG9mIGltYWdlcyBpbgotCSAqIHRyYW5zZmVyLgotCSAq
LwotCi0JaWYgKHhmZXItPm1lbV9zdHJpZGUgPCB4ZmVyLT5saW5lX2xlbmd0aCB8fAotCQlh
YnMoeGZlci0+ZmJfc3RyaWRlKSA8IHhmZXItPmxpbmVfbGVuZ3RoKSB7Ci0JCURSTV9FUlJP
UigiSW52YWxpZCBmcmFtZS1idWZmZXIgLyBtZW1vcnkgc3RyaWRlLlxuIik7Ci0JCXJldHVy
biAtRUlOVkFMOwotCX0KLQotCS8qCi0JICogQSBoYXJkd2FyZSBidWcgc2VlbXMgdG8gYmUg
d29ya2VkIGFyb3VuZCBpZiBzeXN0ZW0gbWVtb3J5IGFkZHJlc3NlcyBzdGFydCBvbgotCSAq
IDE2IGJ5dGUgYm91bmRhcmllcy4gVGhpcyBzZWVtcyBhIGJpdCByZXN0cmljdGl2ZSBob3dl
dmVyLiBWSUEgaXMgY29udGFjdGVkCi0JICogYWJvdXQgdGhpcy4gTWVhbndoaWxlLCBpbXBv
c2UgdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6Ci0JICovCi0KLSNpZmRlZiBWSUFfQlVH
RlJFRQotCWlmICgoKCh1bnNpZ25lZCBsb25nKXhmZXItPm1lbV9hZGRyICYgMykgIT0gKCh1
bnNpZ25lZCBsb25nKXhmZXItPmZiX2FkZHIgJiAzKSkgfHwKLQkgICAgKCh4ZmVyLT5udW1f
bGluZXMgPiAxKSAmJiAoKHhmZXItPm1lbV9zdHJpZGUgJiAzKSAhPSAoeGZlci0+ZmJfc3Ry
aWRlICYgMykpKSkgewotCQlEUk1fRVJST1IoIkludmFsaWQgRFJNIGJpdGJsdCBhbGlnbm1l
bnQuXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotI2Vsc2UKLQlpZiAoKCgodW5zaWdu
ZWQgbG9uZyl4ZmVyLT5tZW1fYWRkciAmIDE1KSB8fAotCSAgICAgICgodW5zaWduZWQgbG9u
Zyl4ZmVyLT5mYl9hZGRyICYgMykpIHx8Ci0JICAgKCh4ZmVyLT5udW1fbGluZXMgPiAxKSAm
JgotCSAgICgoeGZlci0+bWVtX3N0cmlkZSAmIDE1KSB8fCAoeGZlci0+ZmJfc3RyaWRlICYg
MykpKSkgewotCQlEUk1fRVJST1IoIkludmFsaWQgRFJNIGJpdGJsdCBhbGlnbm1lbnQuXG4i
KTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotI2VuZGlmCi0KLQlpZiAoMCAhPSAocmV0ID0g
dmlhX2xvY2tfYWxsX2RtYV9wYWdlcyh2c2csIHhmZXIpKSkgewotCQlEUk1fRVJST1IoIkNv
dWxkIG5vdCBsb2NrIERNQSBwYWdlcy5cbiIpOwotCQl2aWFfZnJlZV9zZ19pbmZvKHBkZXYs
IHZzZyk7Ci0JCXJldHVybiByZXQ7Ci0JfQotCi0JdmlhX21hcF9ibGl0X2Zvcl9kZXZpY2Uo
cGRldiwgeGZlciwgdnNnLCAwKTsKLQlpZiAoMCAhPSAocmV0ID0gdmlhX2FsbG9jX2Rlc2Nf
cGFnZXModnNnKSkpIHsKLQkJRFJNX0VSUk9SKCJDb3VsZCBub3QgYWxsb2NhdGUgRE1BIGRl
c2NyaXB0b3IgcGFnZXMuXG4iKTsKLQkJdmlhX2ZyZWVfc2dfaW5mbyhwZGV2LCB2c2cpOwot
CQlyZXR1cm4gcmV0OwotCX0KLQl2aWFfbWFwX2JsaXRfZm9yX2RldmljZShwZGV2LCB4ZmVy
LCB2c2csIDEpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLQotLyoKLSAqIFJlc2VydmUgb25lIGZy
ZWUgc2xvdCBpbiB0aGUgYmxpdCBxdWV1ZS4gV2lsbCB3YWl0IGZvciBvbmUgc2Vjb25kIGZv
ciBvbmUKLSAqIHRvIGJlY29tZSBhdmFpbGFibGUuIE90aGVyd2lzZSAtRUJVU1kgaXMgcmV0
dXJuZWQuCi0gKi8KLQotc3RhdGljIGludAotdmlhX2RtYWJsaXRfZ3JhYl9zbG90KGRybV92
aWFfYmxpdHFfdCAqYmxpdHEsIGludCBlbmdpbmUpCi17Ci0JaW50IHJldCA9IDA7Ci0JdW5z
aWduZWQgbG9uZyBpcnFzYXZlOwotCi0JRFJNX0RFQlVHKCJOdW0gZnJlZSBpcyAlZFxuIiwg
YmxpdHEtPm51bV9mcmVlKTsKLQlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9j
aywgaXJxc2F2ZSk7Ci0Jd2hpbGUgKGJsaXRxLT5udW1fZnJlZSA9PSAwKSB7Ci0JCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmJsaXRxLT5ibGl0X2xvY2ssIGlycXNhdmUpOwotCi0JCVZJ
QV9XQUlUX09OKHJldCwgYmxpdHEtPmJ1c3lfcXVldWUsIEhaLCBibGl0cS0+bnVtX2ZyZWUg
PiAwKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiAoLUVJTlRSID09IHJldCkgPyAtRUFHQUlO
IDogcmV0OwotCi0JCXNwaW5fbG9ja19pcnFzYXZlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFz
YXZlKTsKLQl9Ci0KLQlibGl0cS0+bnVtX2ZyZWUtLTsKLQlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsKLQotCXJldHVybiAwOwotfQotCi0v
KgotICogSGFuZCBiYWNrIGEgZnJlZSBzbG90IGlmIHdlIGNoYW5nZWQgb3VyIG1pbmQuCi0g
Ki8KLQotc3RhdGljIHZvaWQKLXZpYV9kbWFibGl0X3JlbGVhc2Vfc2xvdChkcm1fdmlhX2Js
aXRxX3QgKmJsaXRxKQotewotCXVuc2lnbmVkIGxvbmcgaXJxc2F2ZTsKLQotCXNwaW5fbG9j
a19pcnFzYXZlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsKLQlibGl0cS0+bnVtX2Zy
ZWUrKzsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFz
YXZlKTsKLQl3YWtlX3VwKCZibGl0cS0+YnVzeV9xdWV1ZSk7Ci19Ci0KLS8qCi0gKiBHcmFi
IGEgZnJlZSBzbG90LiBCdWlsZCBibGl0IGluZm8gYW5kIHF1ZXVlIGEgYmxpdC4KLSAqLwot
Ci0KLXN0YXRpYyBpbnQKLXZpYV9kbWFibGl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGRy
bV92aWFfZG1hYmxpdF90ICp4ZmVyKQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJp
diA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9z
Z19pbmZvX3QgKnZzZzsKLQlkcm1fdmlhX2JsaXRxX3QgKmJsaXRxOwotCWludCByZXQ7Ci0J
aW50IGVuZ2luZTsKLQl1bnNpZ25lZCBsb25nIGlycXNhdmU7Ci0KLQlpZiAoZGV2X3ByaXYg
PT0gTlVMTCkgewotCQlEUk1fRVJST1IoIkNhbGxlZCB3aXRob3V0IGluaXRpYWxpemF0aW9u
LlxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWVuZ2luZSA9ICh4ZmVyLT50b19m
YikgPyAwIDogMTsKLQlibGl0cSA9IGRldl9wcml2LT5ibGl0X3F1ZXVlcyArIGVuZ2luZTsK
LQlpZiAoMCAhPSAocmV0ID0gdmlhX2RtYWJsaXRfZ3JhYl9zbG90KGJsaXRxLCBlbmdpbmUp
KSkKLQkJcmV0dXJuIHJldDsKLQlpZiAoTlVMTCA9PSAodnNnID0ga21hbGxvYyhzaXplb2Yo
KnZzZyksIEdGUF9LRVJORUwpKSkgewotCQl2aWFfZG1hYmxpdF9yZWxlYXNlX3Nsb3QoYmxp
dHEpOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9Ci0JaWYgKDAgIT0gKHJldCA9IHZpYV9idWls
ZF9zZ19pbmZvKGRldiwgdnNnLCB4ZmVyKSkpIHsKLQkJdmlhX2RtYWJsaXRfcmVsZWFzZV9z
bG90KGJsaXRxKTsKLQkJa2ZyZWUodnNnKTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0Jc3Bpbl9s
b2NrX2lycXNhdmUoJmJsaXRxLT5ibGl0X2xvY2ssIGlycXNhdmUpOwotCi0JYmxpdHEtPmJs
aXRzW2JsaXRxLT5oZWFkKytdID0gdnNnOwotCWlmIChibGl0cS0+aGVhZCA+PSBWSUFfTlVN
X0JMSVRfU0xPVFMpCi0JCWJsaXRxLT5oZWFkID0gMDsKLQlibGl0cS0+bnVtX291dHN0YW5k
aW5nKys7Ci0JeGZlci0+c3luYy5zeW5jX2hhbmRsZSA9ICsrYmxpdHEtPmN1cl9ibGl0X2hh
bmRsZTsKLQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmJsaXRxLT5ibGl0X2xvY2ssIGly
cXNhdmUpOwotCXhmZXItPnN5bmMuZW5naW5lID0gZW5naW5lOwotCi0JdmlhX2RtYWJsaXRf
aGFuZGxlcihkZXYsIGVuZ2luZSwgMCk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotLyoKLSAqIFN5
bmMgb24gYSBwcmV2aW91c2x5IHN1Ym1pdHRlZCBibGl0LiBOb3RlIHRoYXQgdGhlIFggc2Vy
dmVyIHVzZSBzaWduYWxzIGV4dGVuc2l2ZWx5LCBhbmQKLSAqIHRoYXQgdGhlcmUgaXMgYSB2
ZXJ5IGJpZyBwcm9iYWJpbGl0eSB0aGF0IHRoaXMgSU9DVEwgd2lsbCBiZSBpbnRlcnJ1cHRl
ZCBieSBhIHNpZ25hbC4gSW4gdGhhdAotICogY2FzZSBpdCByZXR1cm5zIHdpdGggLUVBR0FJ
TiBmb3IgdGhlIHNpZ25hbCB0byBiZSBkZWxpdmVyZWQuCi0gKiBUaGUgY2FsbGVyIHNob3Vs
ZCB0aGVuIHJlaXNzdWUgdGhlIElPQ1RMLiBUaGlzIGlzIHNpbWlsYXIgdG8gd2hhdCBpcyBi
ZWluZyBkb25lIGZvciBkcm1HZXRMb2NrKCkuCi0gKi8KLQotaW50Ci12aWFfZG1hX2JsaXRf
c3luYyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdikKLXsKLQlkcm1fdmlhX2JsaXRzeW5jX3QgKnN5bmMgPSBkYXRhOwot
CWludCBlcnI7Ci0KLQlpZiAoc3luYy0+ZW5naW5lID49IFZJQV9OVU1fQkxJVF9FTkdJTkVT
KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWVyciA9IHZpYV9kbWFibGl0X3N5bmMoZGV2LCBz
eW5jLT5zeW5jX2hhbmRsZSwgc3luYy0+ZW5naW5lKTsKLQotCWlmICgtRUlOVFIgPT0gZXJy
KQotCQllcnIgPSAtRUFHQUlOOwotCi0JcmV0dXJuIGVycjsKLX0KLQotCi0vKgotICogUXVl
dWUgYSBibGl0IGFuZCBoYW5kIGJhY2sgYSBoYW5kbGUgdG8gYmUgdXNlZCBmb3Igc3luYy4g
VGhpcyBJT0NUTCBtYXkgYmUgaW50ZXJydXB0ZWQgYnkgYSBzaWduYWwKLSAqIHdoaWxlIHdh
aXRpbmcgZm9yIGEgZnJlZSBzbG90IGluIHRoZSBibGl0IHF1ZXVlLiBJbiB0aGF0IGNhc2Ug
aXQgcmV0dXJucyB3aXRoIC1FQUdBSU4gYW5kIHNob3VsZAotICogYmUgcmVpc3N1ZWQuIFNl
ZSB0aGUgYWJvdmUgSU9DVEwgY29kZS4KLSAqLwotCi1pbnQKLXZpYV9kbWFfYmxpdChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVf
cHJpdikKLXsKLQlkcm1fdmlhX2RtYWJsaXRfdCAqeGZlciA9IGRhdGE7Ci0JaW50IGVycjsK
LQotCWVyciA9IHZpYV9kbWFibGl0KGRldiwgeGZlcik7Ci0KLQlyZXR1cm4gZXJyOwotfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5oIGIvZHJpdmVy
cy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCA5YjY2MmEzMjdjZWYuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
dmlhL3ZpYV9kbWFibGl0LmgKKysrIC9kZXYvbnVsbApAQCAtMSwxNDAgKzAsMCBAQAotLyog
dmlhX2RtYWJsaXQuaCAtLSBQQ0kgRE1BIEJpdEJsdCBzdXBwb3J0IGZvciB0aGUgVklBIFVu
aWNocm9tZS9Qcm8KLSAqCi0gKiBDb3B5cmlnaHQgMjAwNSBUaG9tYXMgSGVsbHN0cm9tLgot
ICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBn
cmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICog
Y29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmls
ZXMgKHRoZSAiU29mdHdhcmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhv
dXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSBy
aWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRl
LCBzdWIgbGljZW5zZSwKLSAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUs
IGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQotICogU29mdHdhcmUgaXMgZnVy
bmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoK
LSAqCi0gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9u
IG5vdGljZSAoaW5jbHVkaW5nIHRoZQotICogbmV4dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGlu
Y2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKLSAqIG9mIHRo
ZSBTb2Z0d2FyZS4KLSAqCi0gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwg
V0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgotICogSU1QTElFRCwg
SU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFO
VEFCSUxJVFksCi0gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9O
LUlORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwKLSAqIFRIRSBDT1BZUklHSFQgSE9M
REVSUywgQVVUSE9SUyBBTkQvT1IgSVRTIFNVUFBMSUVSUyBCRSBMSUFCTEUgRk9SIEFOWSBD
TEFJTSwKLSAqIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFD
VElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUgotICogT1RIRVJXSVNFLCBBUklTSU5HIEZST00s
IE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRQotICog
VVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KLSAqCi0gKiBBdXRob3Jz
OgotICogICAgVGhvbWFzIEhlbGxzdHJvbS4KLSAqICAgIFJlZ2lzdGVyIGluZm8gZnJvbSBE
aWdlbyBJbmMuCi0gKi8KLQotI2lmbmRlZiBfVklBX0RNQUJMSVRfSAotI2RlZmluZSBfVklB
X0RNQUJMSVRfSAotCi0jaW5jbHVkZSA8bGludXgvZG1hLW1hcHBpbmcuaD4KLQotI2RlZmlu
ZSBWSUFfTlVNX0JMSVRfRU5HSU5FUyAyCi0jZGVmaW5lIFZJQV9OVU1fQkxJVF9TTE9UUyA4
Ci0KLXN0cnVjdCBfZHJtX3ZpYV9kZXNjcmlwdG9yOwotCi10eXBlZGVmIHN0cnVjdCBfZHJt
X3ZpYV9zZ19pbmZvIHsKLQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOwotCXVuc2lnbmVkIGxvbmcg
bnVtX3BhZ2VzOwotCXN0cnVjdCBfZHJtX3ZpYV9kZXNjcmlwdG9yICoqZGVzY19wYWdlczsK
LQlpbnQgbnVtX2Rlc2NfcGFnZXM7Ci0JaW50IG51bV9kZXNjOwotCWVudW0gZG1hX2RhdGFf
ZGlyZWN0aW9uIGRpcmVjdGlvbjsKLQl1bnNpZ25lZCBjaGFyICpib3VuY2VfYnVmZmVyOwot
CWRtYV9hZGRyX3QgY2hhaW5fc3RhcnQ7Ci0JdWludDMyX3QgZnJlZV9vbl9zZXF1ZW5jZTsK
LQl1bnNpZ25lZCBpbnQgZGVzY3JpcHRvcnNfcGVyX3BhZ2U7Ci0JaW50IGFib3J0ZWQ7Ci0J
ZW51bSB7Ci0JCWRyX3ZpYV9kZXZpY2VfbWFwcGVkLAotCQlkcl92aWFfZGVzY19wYWdlc19h
bGxvYywKLQkJZHJfdmlhX3BhZ2VzX2xvY2tlZCwKLQkJZHJfdmlhX3BhZ2VzX2FsbG9jLAot
CQlkcl92aWFfc2dfaW5pdAotCX0gc3RhdGU7Ci19IGRybV92aWFfc2dfaW5mb190OwotCi10
eXBlZGVmIHN0cnVjdCBfZHJtX3ZpYV9ibGl0cSB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRl
djsKLQl1aW50MzJfdCBjdXJfYmxpdF9oYW5kbGU7Ci0JdWludDMyX3QgZG9uZV9ibGl0X2hh
bmRsZTsKLQl1bnNpZ25lZCBzZXJ2aWNlZDsKLQl1bnNpZ25lZCBoZWFkOwotCXVuc2lnbmVk
IGN1cjsKLQl1bnNpZ25lZCBudW1fZnJlZTsKLQl1bnNpZ25lZCBudW1fb3V0c3RhbmRpbmc7
Ci0JdW5zaWduZWQgbG9uZyBlbmQ7Ci0JaW50IGFib3J0aW5nOwotCWludCBpc19hY3RpdmU7
Ci0JZHJtX3ZpYV9zZ19pbmZvX3QgKmJsaXRzW1ZJQV9OVU1fQkxJVF9TTE9UU107Ci0Jc3Bp
bmxvY2tfdCBibGl0X2xvY2s7Ci0Jd2FpdF9xdWV1ZV9oZWFkX3QgYmxpdF9xdWV1ZVtWSUFf
TlVNX0JMSVRfU0xPVFNdOwotCXdhaXRfcXVldWVfaGVhZF90IGJ1c3lfcXVldWU7Ci0Jc3Ry
dWN0IHdvcmtfc3RydWN0IHdxOwotCXN0cnVjdCB0aW1lcl9saXN0IHBvbGxfdGltZXI7Ci19
IGRybV92aWFfYmxpdHFfdDsKLQotCi0vKgotICogIFBDSSBETUEgUmVnaXN0ZXJzCi0gKiAg
Q2hhbm5lbHMgMiAmIDMgZG9uJ3Qgc2VlbSB0byBiZSBpbXBsZW1lbnRlZCBpbiBoYXJkd2Fy
ZS4KLSAqLwotCi0jZGVmaW5lIFZJQV9QQ0lfRE1BX01BUjAgICAgICAgICAgICAweEU0MCAg
IC8qIE1lbW9yeSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENoYW5uZWwgMCAqLwotI2RlZmluZSBW
SUFfUENJX0RNQV9EQVIwICAgICAgICAgICAgMHhFNDQgICAvKiBEZXZpY2UgQWRkcmVzcyBS
ZWdpc3RlciBvZiBDaGFubmVsIDAgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfQkNSMCAgICAg
ICAgICAgIDB4RTQ4ICAgLyogQnl0ZSBDb3VudCBSZWdpc3RlciBvZiBDaGFubmVsIDAgKi8K
LSNkZWZpbmUgVklBX1BDSV9ETUFfRFBSMCAgICAgICAgICAgIDB4RTRDICAgLyogRGVzY3Jp
cHRvciBQb2ludGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwgMCAqLwotCi0jZGVmaW5lIFZJQV9Q
Q0lfRE1BX01BUjEgICAgICAgICAgICAweEU1MCAgIC8qIE1lbW9yeSBBZGRyZXNzIFJlZ2lz
dGVyIG9mIENoYW5uZWwgMSAqLwotI2RlZmluZSBWSUFfUENJX0RNQV9EQVIxICAgICAgICAg
ICAgMHhFNTQgICAvKiBEZXZpY2UgQWRkcmVzcyBSZWdpc3RlciBvZiBDaGFubmVsIDEgKi8K
LSNkZWZpbmUgVklBX1BDSV9ETUFfQkNSMSAgICAgICAgICAgIDB4RTU4ICAgLyogQnl0ZSBD
b3VudCBSZWdpc3RlciBvZiBDaGFubmVsIDEgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfRFBS
MSAgICAgICAgICAgIDB4RTVDICAgLyogRGVzY3JpcHRvciBQb2ludGVyIFJlZ2lzdGVyIG9m
IENoYW5uZWwgMSAqLwotCi0jZGVmaW5lIFZJQV9QQ0lfRE1BX01BUjIgICAgICAgICAgICAw
eEU2MCAgIC8qIE1lbW9yeSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENoYW5uZWwgMiAqLwotI2Rl
ZmluZSBWSUFfUENJX0RNQV9EQVIyICAgICAgICAgICAgMHhFNjQgICAvKiBEZXZpY2UgQWRk
cmVzcyBSZWdpc3RlciBvZiBDaGFubmVsIDIgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfQkNS
MiAgICAgICAgICAgIDB4RTY4ICAgLyogQnl0ZSBDb3VudCBSZWdpc3RlciBvZiBDaGFubmVs
IDIgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfRFBSMiAgICAgICAgICAgIDB4RTZDICAgLyog
RGVzY3JpcHRvciBQb2ludGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwgMiAqLwotCi0jZGVmaW5l
IFZJQV9QQ0lfRE1BX01BUjMgICAgICAgICAgICAweEU3MCAgIC8qIE1lbW9yeSBBZGRyZXNz
IFJlZ2lzdGVyIG9mIENoYW5uZWwgMyAqLwotI2RlZmluZSBWSUFfUENJX0RNQV9EQVIzICAg
ICAgICAgICAgMHhFNzQgICAvKiBEZXZpY2UgQWRkcmVzcyBSZWdpc3RlciBvZiBDaGFubmVs
IDMgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfQkNSMyAgICAgICAgICAgIDB4RTc4ICAgLyog
Qnl0ZSBDb3VudCBSZWdpc3RlciBvZiBDaGFubmVsIDMgKi8KLSNkZWZpbmUgVklBX1BDSV9E
TUFfRFBSMyAgICAgICAgICAgIDB4RTdDICAgLyogRGVzY3JpcHRvciBQb2ludGVyIFJlZ2lz
dGVyIG9mIENoYW5uZWwgMyAqLwotCi0jZGVmaW5lIFZJQV9QQ0lfRE1BX01SMCAgICAgICAg
ICAgICAweEU4MCAgIC8qIE1vZGUgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAwICovCi0jZGVmaW5l
IFZJQV9QQ0lfRE1BX01SMSAgICAgICAgICAgICAweEU4NCAgIC8qIE1vZGUgUmVnaXN0ZXIg
b2YgQ2hhbm5lbCAxICovCi0jZGVmaW5lIFZJQV9QQ0lfRE1BX01SMiAgICAgICAgICAgICAw
eEU4OCAgIC8qIE1vZGUgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAyICovCi0jZGVmaW5lIFZJQV9Q
Q0lfRE1BX01SMyAgICAgICAgICAgICAweEU4QyAgIC8qIE1vZGUgUmVnaXN0ZXIgb2YgQ2hh
bm5lbCAzICovCi0KLSNkZWZpbmUgVklBX1BDSV9ETUFfQ1NSMCAgICAgICAgICAgIDB4RTkw
ICAgLyogQ29tbWFuZC9TdGF0dXMgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAwICovCi0jZGVmaW5l
IFZJQV9QQ0lfRE1BX0NTUjEgICAgICAgICAgICAweEU5NCAgIC8qIENvbW1hbmQvU3RhdHVz
IFJlZ2lzdGVyIG9mIENoYW5uZWwgMSAqLwotI2RlZmluZSBWSUFfUENJX0RNQV9DU1IyICAg
ICAgICAgICAgMHhFOTggICAvKiBDb21tYW5kL1N0YXR1cyBSZWdpc3RlciBvZiBDaGFubmVs
IDIgKi8KLSNkZWZpbmUgVklBX1BDSV9ETUFfQ1NSMyAgICAgICAgICAgIDB4RTlDICAgLyog
Q29tbWFuZC9TdGF0dXMgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAzICovCi0KLSNkZWZpbmUgVklB
X1BDSV9ETUFfUFRSICAgICAgICAgICAgIDB4RUEwICAgLyogUHJpb3JpdHkgVHlwZSBSZWdp
c3RlciAqLwotCi0vKiBEZWZpbmUgZm9yIERNQSBlbmdpbmUgKi8KLS8qIERQUiAqLwotI2Rl
ZmluZSBWSUFfRE1BX0RQUl9FQwkJKDE8PDEpCS8qIGVuZCBvZiBjaGFpbiAqLwotI2RlZmlu
ZSBWSUFfRE1BX0RQUl9ERElFCSgxPDwyKQkvKiBkZXNjcmlwdG9yIGRvbmUgaW50ZXJydXB0
IGVuYWJsZSAqLwotI2RlZmluZSBWSUFfRE1BX0RQUl9EVAkJKDE8PDMpCS8qIGRpcmVjdGlv
biBvZiB0cmFuc2ZlciAoUk8pICovCi0KLS8qIE1SICovCi0jZGVmaW5lIFZJQV9ETUFfTVJf
Q00JCSgxPDwwKQkvKiBjaGFpbmluZyBtb2RlICovCi0jZGVmaW5lIFZJQV9ETUFfTVJfVERJ
RQkJKDE8PDEpCS8qIHRyYW5zZmVyIGRvbmUgaW50ZXJydXB0IGVuYWJsZSAqLwotI2RlZmlu
ZSBWSUFfRE1BX01SX0hFTkRNQUNNRAkJKDE8PDcpIC8qID8gKi8KLQotLyogQ1NSICovCi0j
ZGVmaW5lIFZJQV9ETUFfQ1NSX0RFCQkoMTw8MCkJLyogRE1BIGVuYWJsZSAqLwotI2RlZmlu
ZSBWSUFfRE1BX0NTUl9UUwkJKDE8PDEpCS8qIHRyYW5zZmVyIHN0YXJ0ICovCi0jZGVmaW5l
IFZJQV9ETUFfQ1NSX1RBCQkoMTw8MikJLyogdHJhbnNmZXIgYWJvcnQgKi8KLSNkZWZpbmUg
VklBX0RNQV9DU1JfVEQJCSgxPDwzKQkvKiB0cmFuc2ZlciBkb25lICovCi0jZGVmaW5lIFZJ
QV9ETUFfQ1NSX0RECQkoMTw8NCkJLyogZGVzY3JpcHRvciBkb25lICovCi0jZGVmaW5lIFZJ
QV9ETUFfRFBSX0VDICAgICAgICAgICgxPDwxKSAgLyogZW5kIG9mIGNoYWluICovCi0KLQot
Ci0jZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2Rydi5jIGIv
ZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZHJ2LmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDVkYTM4MDgyODIxZi4uMDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS92aWEvdmlhX2Rydi5jCisrKyAvZGV2L251bGwKQEAgLTEsMTI0ICswLDAgQEAKLS8qCi0g
KiBDb3B5cmlnaHQgMTk5OC0yMDAzIFZJQSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIFJpZ2h0
cyBSZXNlcnZlZC4KLSAqIENvcHlyaWdodCAyMDAxLTIwMDMgUzMgR3JhcGhpY3MsIEluYy4g
QWxsIFJpZ2h0cyBSZXNlcnZlZC4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFu
dGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICogY29w
eSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMg
KHRoZSAiU29mdHdhcmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQg
cmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdo
dHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBz
dWIgbGljZW5zZSwKLSAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFu
ZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQotICogU29mdHdhcmUgaXMgZnVybmlz
aGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKLSAq
Ci0gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5v
dGljZSAoaW5jbHVkaW5nIHRoZQotICogbmV4dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1
ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKLSAqIG9mIHRoZSBT
b2Z0d2FyZS4KLSAqCi0gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lU
SE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgotICogSU1QTElFRCwgSU5D
TFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFC
SUxJVFksCi0gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OLUlO
RlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwKLSAqIFZJQSwgUzMgR1JBUEhJQ1MsIEFO
RC9PUiBJVFMgU1VQUExJRVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9S
Ci0gKiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNU
LCBUT1JUIE9SIE9USEVSV0lTRSwKLSAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENP
Tk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUgotICogREVB
TElOR1MgSU4gVEhFIFNPRlRXQVJFLgotICovCi0KLSNpbmNsdWRlIDxsaW51eC9tb2R1bGUu
aD4KLSNpbmNsdWRlIDxsaW51eC9wY2kuaD4KLQotI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+
Ci0jaW5jbHVkZSA8ZHJtL2RybV9maWxlLmg+Ci0jaW5jbHVkZSA8ZHJtL2RybV9wY2lpZHMu
aD4KLSNpbmNsdWRlIDxkcm0vdmlhX2RybS5oPgotCi0jaW5jbHVkZSAidmlhX2Rydi5oIgot
Ci0KLXN0YXRpYyBpbnQgdmlhX2RyaXZlcl9vcGVuKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgdmlhX2ZpbGVfcHJpdmF0ZSAq
ZmlsZV9wcml2OwotCi0JRFJNX0RFQlVHX0RSSVZFUigiXG4iKTsKLQlmaWxlX3ByaXYgPSBr
bWFsbG9jKHNpemVvZigqZmlsZV9wcml2KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFmaWxlX3By
aXYpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JZmlsZS0+ZHJpdmVyX3ByaXYgPSBmaWxlX3By
aXY7Ci0KLQlJTklUX0xJU1RfSEVBRCgmZmlsZV9wcml2LT5vYmpfbGlzdCk7Ci0KLQlyZXR1
cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgdmlhX2RyaXZlcl9wb3N0Y2xvc2Uoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlKQotewotCXN0cnVjdCB2aWFf
ZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKLQotCWtmcmVl
KGZpbGVfcHJpdik7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgcGNpX2RldmljZV9pZCBwY2lpZGxp
c3RbXSA9IHsKLQl2aWFkcnZfUENJX0lEUwotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBm
aWxlX29wZXJhdGlvbnMgdmlhX2RyaXZlcl9mb3BzID0gewotCS5vd25lciA9IFRISVNfTU9E
VUxFLAotCS5vcGVuID0gZHJtX29wZW4sCi0JLnJlbGVhc2UgPSBkcm1fcmVsZWFzZSwKLQku
dW5sb2NrZWRfaW9jdGwgPSBkcm1faW9jdGwsCi0JLm1tYXAgPSBkcm1fbGVnYWN5X21tYXAs
Ci0JLnBvbGwgPSBkcm1fcG9sbCwKLQkuY29tcGF0X2lvY3RsID0gZHJtX2NvbXBhdF9pb2N0
bCwKLQkubGxzZWVrID0gbm9vcF9sbHNlZWssCi19OwotCi1zdGF0aWMgc3RydWN0IGRybV9k
cml2ZXIgZHJpdmVyID0gewotCS5kcml2ZXJfZmVhdHVyZXMgPQotCSAgICBEUklWRVJfVVNF
X0FHUCB8IERSSVZFUl9IQVZFX0lSUSB8IERSSVZFUl9MRUdBQ1ksCi0JLmxvYWQgPSB2aWFf
ZHJpdmVyX2xvYWQsCi0JLnVubG9hZCA9IHZpYV9kcml2ZXJfdW5sb2FkLAotCS5vcGVuID0g
dmlhX2RyaXZlcl9vcGVuLAotCS5wcmVjbG9zZSA9IHZpYV9yZWNsYWltX2J1ZmZlcnNfbG9j
a2VkLAotCS5wb3N0Y2xvc2UgPSB2aWFfZHJpdmVyX3Bvc3RjbG9zZSwKLQkuY29udGV4dF9k
dG9yID0gdmlhX2ZpbmFsX2NvbnRleHQsCi0JLmdldF92YmxhbmtfY291bnRlciA9IHZpYV9n
ZXRfdmJsYW5rX2NvdW50ZXIsCi0JLmVuYWJsZV92YmxhbmsgPSB2aWFfZW5hYmxlX3ZibGFu
aywKLQkuZGlzYWJsZV92YmxhbmsgPSB2aWFfZGlzYWJsZV92YmxhbmssCi0JLmlycV9wcmVp
bnN0YWxsID0gdmlhX2RyaXZlcl9pcnFfcHJlaW5zdGFsbCwKLQkuaXJxX3Bvc3RpbnN0YWxs
ID0gdmlhX2RyaXZlcl9pcnFfcG9zdGluc3RhbGwsCi0JLmlycV91bmluc3RhbGwgPSB2aWFf
ZHJpdmVyX2lycV91bmluc3RhbGwsCi0JLmlycV9oYW5kbGVyID0gdmlhX2RyaXZlcl9pcnFf
aGFuZGxlciwKLQkuZG1hX3F1aWVzY2VudCA9IHZpYV9kcml2ZXJfZG1hX3F1aWVzY2VudCwK
LQkubGFzdGNsb3NlID0gdmlhX2xhc3RjbG9zZSwKLQkuaW9jdGxzID0gdmlhX2lvY3RscywK
LQkuZm9wcyA9ICZ2aWFfZHJpdmVyX2ZvcHMsCi0JLm5hbWUgPSBEUklWRVJfTkFNRSwKLQku
ZGVzYyA9IERSSVZFUl9ERVNDLAotCS5kYXRlID0gRFJJVkVSX0RBVEUsCi0JLm1ham9yID0g
RFJJVkVSX01BSk9SLAotCS5taW5vciA9IERSSVZFUl9NSU5PUiwKLQkucGF0Y2hsZXZlbCA9
IERSSVZFUl9QQVRDSExFVkVMLAotfTsKLQotc3RhdGljIHN0cnVjdCBwY2lfZHJpdmVyIHZp
YV9wY2lfZHJpdmVyID0gewotCS5uYW1lID0gRFJJVkVSX05BTUUsCi0JLmlkX3RhYmxlID0g
cGNpaWRsaXN0LAotfTsKLQotc3RhdGljIGludCBfX2luaXQgdmlhX2luaXQodm9pZCkKLXsK
LQlkcml2ZXIubnVtX2lvY3RscyA9IHZpYV9tYXhfaW9jdGw7Ci0JdmlhX2luaXRfY29tbWFu
ZF92ZXJpZmllcigpOwotCXJldHVybiBkcm1fbGVnYWN5X3BjaV9pbml0KCZkcml2ZXIsICZ2
aWFfcGNpX2RyaXZlcik7Ci19Ci0KLXN0YXRpYyB2b2lkIF9fZXhpdCB2aWFfZXhpdCh2b2lk
KQotewotCWRybV9sZWdhY3lfcGNpX2V4aXQoJmRyaXZlciwgJnZpYV9wY2lfZHJpdmVyKTsK
LX0KLQotbW9kdWxlX2luaXQodmlhX2luaXQpOwotbW9kdWxlX2V4aXQodmlhX2V4aXQpOwot
Ci1NT0RVTEVfQVVUSE9SKERSSVZFUl9BVVRIT1IpOwotTU9EVUxFX0RFU0NSSVBUSU9OKERS
SVZFUl9ERVNDKTsKLU1PRFVMRV9MSUNFTlNFKCJHUEwgYW5kIGFkZGl0aW9uYWwgcmlnaHRz
Iik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kcnYuaCBiL2RyaXZl
cnMvZ3B1L2RybS92aWEvdmlhX2Rydi5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCBkNWFkMWIwNWJmNzcuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlh
L3ZpYV9kcnYuaAorKysgL2Rldi9udWxsCkBAIC0xLDIyOSArMCwwIEBACi0vKgotICogQ29w
eXJpZ2h0IDE5OTgtMjAwMyBWSUEgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCBSaWdodHMgUmVz
ZXJ2ZWQuCi0gKiBDb3B5cmlnaHQgMjAwMS0yMDAzIFMzIEdyYXBoaWNzLCBJbmMuIEFsbCBS
aWdodHMgUmVzZXJ2ZWQuCi0gKgotICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwg
ZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKLSAqIGNvcHkgb2Yg
dGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUg
IlNvZnR3YXJlIiksCi0gKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3Ry
aWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCi0gKiB0aGUgcmlnaHRzIHRv
IHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3ViIGxp
Y2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8g
cGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0
byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICog
VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ug
KGluY2x1ZGluZyB0aGUKLSAqIG5leHQgcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBp
biBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zCi0gKiBvZiB0aGUgU29mdHdh
cmUuCi0gKgotICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQg
V0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElNUExJRUQsIElOQ0xVRElO
RyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZ
LAotICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTi1JTkZSSU5H
RU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMCi0gKiBWSUEsIFMzIEdSQVBISUNTLCBBTkQvT1Ig
SVRTIFNVUFBMSUVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUgotICog
T1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9S
VCBPUiBPVEhFUldJU0UsCi0gKiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNU
SU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKLSAqIERFQUxJTkdT
IElOIFRIRSBTT0ZUV0FSRS4KLSAqLwotI2lmbmRlZiBfVklBX0RSVl9IXwotI2RlZmluZSBf
VklBX0RSVl9IXwotCi0jaW5jbHVkZSA8bGludXgvaXJxcmV0dXJuLmg+Ci0jaW5jbHVkZSA8
bGludXgvamlmZmllcy5oPgotI2luY2x1ZGUgPGxpbnV4L3NjaGVkLmg+Ci0jaW5jbHVkZSA8
bGludXgvc2NoZWQvc2lnbmFsLmg+Ci0jaW5jbHVkZSA8bGludXgvd2FpdC5oPgotCi0jaW5j
bHVkZSA8ZHJtL2RybV9pb2N0bC5oPgotI2luY2x1ZGUgPGRybS9kcm1fbGVnYWN5Lmg+Ci0j
aW5jbHVkZSA8ZHJtL2RybV9tbS5oPgotI2luY2x1ZGUgPGRybS92aWFfZHJtLmg+Ci0KLSNk
ZWZpbmUgRFJJVkVSX0FVVEhPUgkiVmFyaW91cyIKLQotI2RlZmluZSBEUklWRVJfTkFNRQkJ
InZpYSIKLSNkZWZpbmUgRFJJVkVSX0RFU0MJCSJWSUEgVW5pY2hyb21lIC8gUHJvIgotI2Rl
ZmluZSBEUklWRVJfREFURQkJIjIwMDcwMjAyIgotCi0jZGVmaW5lIERSSVZFUl9NQUpPUgkJ
MgotI2RlZmluZSBEUklWRVJfTUlOT1IJCTExCi0jZGVmaW5lIERSSVZFUl9QQVRDSExFVkVM
CTEKLQotI2luY2x1ZGUgInZpYV92ZXJpZmllci5oIgotCi0jaW5jbHVkZSAidmlhX2RtYWJs
aXQuaCIKLQotI2RlZmluZSBWSUFfUENJX0JVRl9TSVpFIDYwMDAwCi0jZGVmaW5lIFZJQV9G
SVJFX0JVRl9TSVpFICAxMDI0Ci0jZGVmaW5lIFZJQV9OVU1fSVJRUyA0Ci0KLXR5cGVkZWYg
c3RydWN0IGRybV92aWFfcmluZ19idWZmZXIgewotCWRybV9sb2NhbF9tYXBfdCBtYXA7Ci0J
Y2hhciAqdmlydHVhbF9zdGFydDsKLX0gZHJtX3ZpYV9yaW5nX2J1ZmZlcl90OwotCi10eXBl
ZGVmIHVpbnQzMl90IG1hc2thcnJheV90WzVdOwotCi10eXBlZGVmIHN0cnVjdCBkcm1fdmlh
X2lycSB7Ci0JYXRvbWljX3QgaXJxX3JlY2VpdmVkOwotCXVpbnQzMl90IHBlbmRpbmdfbWFz
azsKLQl1aW50MzJfdCBlbmFibGVfbWFzazsKLQl3YWl0X3F1ZXVlX2hlYWRfdCBpcnFfcXVl
dWU7Ci19IGRybV92aWFfaXJxX3Q7Ci0KLXR5cGVkZWYgc3RydWN0IGRybV92aWFfcHJpdmF0
ZSB7Ci0JZHJtX3ZpYV9zYXJlYV90ICpzYXJlYV9wcml2OwotCWRybV9sb2NhbF9tYXBfdCAq
c2FyZWE7Ci0JZHJtX2xvY2FsX21hcF90ICpmYjsKLQlkcm1fbG9jYWxfbWFwX3QgKm1taW87
Ci0JdW5zaWduZWQgbG9uZyBhZ3BBZGRyOwotCXdhaXRfcXVldWVfaGVhZF90IGRlY29kZXJf
cXVldWVbVklBX05SX1hWTUNfTE9DS1NdOwotCWNoYXIgKmRtYV9wdHI7Ci0JdW5zaWduZWQg
aW50IGRtYV9sb3c7Ci0JdW5zaWduZWQgaW50IGRtYV9oaWdoOwotCXVuc2lnbmVkIGludCBk
bWFfb2Zmc2V0OwotCXVpbnQzMl90IGRtYV93cmFwOwotCXZvbGF0aWxlIHVpbnQzMl90ICps
YXN0X3BhdXNlX3B0cjsKLQl2b2xhdGlsZSB1aW50MzJfdCAqaHdfYWRkcl9wdHI7Ci0JZHJt
X3ZpYV9yaW5nX2J1ZmZlcl90IHJpbmc7Ci0Ja3RpbWVfdCBsYXN0X3ZibGFuazsKLQlpbnQg
bGFzdF92YmxhbmtfdmFsaWQ7Ci0Ja3RpbWVfdCBuc2VjX3Blcl92Ymxhbms7Ci0JYXRvbWlj
X3QgdmJsX3JlY2VpdmVkOwotCWRybV92aWFfc3RhdGVfdCBoY19zdGF0ZTsKLQljaGFyIHBj
aV9idWZbVklBX1BDSV9CVUZfU0laRV07Ci0JY29uc3QgdWludDMyX3QgKmZpcmVfb2Zmc2V0
c1tWSUFfRklSRV9CVUZfU0laRV07Ci0JdWludDMyX3QgbnVtX2ZpcmVfb2Zmc2V0czsKLQlp
bnQgY2hpcHNldDsKLQlkcm1fdmlhX2lycV90IHZpYV9pcnFzW1ZJQV9OVU1fSVJRU107Ci0J
dW5zaWduZWQgbnVtX2lycXM7Ci0JbWFza2FycmF5X3QgKmlycV9tYXNrczsKLQl1aW50MzJf
dCBpcnFfZW5hYmxlX21hc2s7Ci0JdWludDMyX3QgaXJxX3BlbmRpbmdfbWFzazsKLQlpbnQg
KmlycV9tYXA7Ci0JdW5zaWduZWQgaW50IGlkbGVfZmF1bHQ7Ci0JaW50IHZyYW1faW5pdGlh
bGl6ZWQ7Ci0Jc3RydWN0IGRybV9tbSB2cmFtX21tOwotCWludCBhZ3BfaW5pdGlhbGl6ZWQ7
Ci0Jc3RydWN0IGRybV9tbSBhZ3BfbW07Ci0JLyoqIE1hcHBpbmcgb2YgdXNlcnNwYWNlIGtl
eXMgdG8gbW0gb2JqZWN0cyAqLwotCXN0cnVjdCBpZHIgb2JqZWN0X2lkcjsKLQl1bnNpZ25l
ZCBsb25nIHZyYW1fb2Zmc2V0OwotCXVuc2lnbmVkIGxvbmcgYWdwX29mZnNldDsKLQlkcm1f
dmlhX2JsaXRxX3QgYmxpdF9xdWV1ZXNbVklBX05VTV9CTElUX0VOR0lORVNdOwotCXVpbnQz
Ml90IGRtYV9kaWZmOwotfSBkcm1fdmlhX3ByaXZhdGVfdDsKLQotc3RydWN0IHZpYV9maWxl
X3ByaXZhdGUgewotCXN0cnVjdCBsaXN0X2hlYWQgb2JqX2xpc3Q7Ci19OwotCi1lbnVtIHZp
YV9mYW1pbHkgewotICBWSUFfT1RIRVIgPSAwLCAgICAgLyogQmFzZWxpbmUgKi8KLSAgVklB
X1BST19HUk9VUF9BLCAgIC8qIEFub3RoZXIgdmlkZW8gZW5naW5lIGFuZCBETUEgY29tbWFu
ZHMgKi8KLSAgVklBX0RYOV8wICAgICAgICAgIC8qIFNhbWUgdmlkZW8gYXMgcHJvX2dyb3Vw
X2EsIGJ1dCAzRCBpcyB1bnN1cHBvcnRlZCAqLwotfTsKLQotLyogVklBIE1NSU8gcmVnaXN0
ZXIgYWNjZXNzICovCi1zdGF0aWMgaW5saW5lIHUzMiB2aWFfcmVhZChzdHJ1Y3QgZHJtX3Zp
YV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHJlZykKLXsKLQlyZXR1cm4gcmVhZGwoKHZvaWQg
X19pb21lbSAqKShkZXZfcHJpdi0+bW1pby0+aGFuZGxlICsgcmVnKSk7Ci19Ci0KLXN0YXRp
YyBpbmxpbmUgdm9pZCB2aWFfd3JpdGUoc3RydWN0IGRybV92aWFfcHJpdmF0ZSAqZGV2X3By
aXYsIHUzMiByZWcsCi0JCQkgICAgIHUzMiB2YWwpCi17Ci0Jd3JpdGVsKHZhbCwgKHZvaWQg
X19pb21lbSAqKShkZXZfcHJpdi0+bW1pby0+aGFuZGxlICsgcmVnKSk7Ci19Ci0KLXN0YXRp
YyBpbmxpbmUgdm9pZCB2aWFfd3JpdGU4KHN0cnVjdCBkcm1fdmlhX3ByaXZhdGUgKmRldl9w
cml2LCB1MzIgcmVnLAotCQkJICAgICAgdTMyIHZhbCkKLXsKLQl3cml0ZWIodmFsLCAodm9p
ZCBfX2lvbWVtICopKGRldl9wcml2LT5tbWlvLT5oYW5kbGUgKyByZWcpKTsKLX0KLQotc3Rh
dGljIGlubGluZSB2b2lkIHZpYV93cml0ZThfbWFzayhzdHJ1Y3QgZHJtX3ZpYV9wcml2YXRl
ICpkZXZfcHJpdiwKLQkJCQkgICB1MzIgcmVnLCB1MzIgbWFzaywgdTMyIHZhbCkKLXsKLQl1
MzIgdG1wOwotCi0JdG1wID0gcmVhZGIoKHZvaWQgX19pb21lbSAqKShkZXZfcHJpdi0+bW1p
by0+aGFuZGxlICsgcmVnKSk7Ci0JdG1wID0gKHRtcCAmIH5tYXNrKSB8ICh2YWwgJiBtYXNr
KTsKLQl3cml0ZWIodG1wLCAodm9pZCBfX2lvbWVtICopKGRldl9wcml2LT5tbWlvLT5oYW5k
bGUgKyByZWcpKTsKLX0KLQotLyoKLSAqIFBvbGwgaW4gYSBsb29wIHdhaXRpbmcgZm9yICdj
b250aWRpdGlvbicgdG8gYmUgdHJ1ZS4KLSAqIE5vdGU6IEEgZGlyZWN0IHJlcGxhY2VtZW50
IHdpdGggd2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlX3RpbWVvdXQoKQotICogICAgICAgd2ls
bCBub3Qgd29yayB1bmxlc3MgZHJpdmVyIGlzIHVwZGF0ZWQgdG8gZW1pdCB3YWtlX3VwKCkK
LSAqICAgICAgIGluIHJlbGV2YW50IHBsYWNlcyB0aGF0IGNhbiBpbXBhY3QgdGhlICdjb25k
aXRpb24nCi0gKgotICogUmV0dXJuczoKLSAqICAgcmV0IGtlZXBzIGN1cnJlbnQgdmFsdWUg
aWYgJ2NvbmRpdGlvbicgYmVjb21lcyB0cnVlCi0gKiAgIHJldCA9IC1CVVNZIGlmIHRpbWVv
dXQgaGFwcGVucwotICogICByZXQgPSAtRUlOVFIgaWYgYSBzaWduYWwgaW50ZXJydXB0ZWQg
dGhlIHdhaXRpbmcgcGVyaW9kCi0gKi8KLSNkZWZpbmUgVklBX1dBSVRfT04oIHJldCwgcXVl
dWUsIHRpbWVvdXQsIGNvbmRpdGlvbiApCQlcCi1kbyB7CQkJCQkJCQlcCi0JREVDTEFSRV9X
QUlUUVVFVUUoZW50cnksIGN1cnJlbnQpOwkJCVwKLQl1bnNpZ25lZCBsb25nIGVuZCA9IGpp
ZmZpZXMgKyAodGltZW91dCk7CQlcCi0JYWRkX3dhaXRfcXVldWUoJihxdWV1ZSksICZlbnRy
eSk7CQkJXAotCQkJCQkJCQlcCi0JZm9yICg7OykgewkJCQkJCVwKLQkJX19zZXRfY3VycmVu
dF9zdGF0ZShUQVNLX0lOVEVSUlVQVElCTEUpOwlcCi0JCWlmIChjb25kaXRpb24pCQkJCQlc
Ci0JCQlicmVhazsJCQkJCVwKLQkJaWYgKHRpbWVfYWZ0ZXJfZXEoamlmZmllcywgZW5kKSkg
ewkJXAotCQkJcmV0ID0gLUVCVVNZOwkJCQlcCi0JCQlicmVhazsJCQkJCVwKLQkJfQkJCQkJ
CVwKLQkJc2NoZWR1bGVfdGltZW91dCgoSFovMTAwID4gMSkgPyBIWi8xMDAgOiAxKTsJXAot
CQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpIHsJCQlcCi0JCQlyZXQgPSAtRUlOVFI7
CQkJCVwKLQkJCWJyZWFrOwkJCQkJXAotCQl9CQkJCQkJXAotCX0JCQkJCQkJXAotCV9fc2V0
X2N1cnJlbnRfc3RhdGUoVEFTS19SVU5OSU5HKTsJCQlcCi0JcmVtb3ZlX3dhaXRfcXVldWUo
JihxdWV1ZSksICZlbnRyeSk7CQkJXAotfSB3aGlsZSAoMCkKLQotZXh0ZXJuIGNvbnN0IHN0
cnVjdCBkcm1faW9jdGxfZGVzYyB2aWFfaW9jdGxzW107Ci1leHRlcm4gaW50IHZpYV9tYXhf
aW9jdGw7Ci0KLWV4dGVybiBpbnQgdmlhX2ZiX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOwotZXh0ZXJuIGlu
dCB2aWFfbWVtX2FsbG9jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0
cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKLWV4dGVybiBpbnQgdmlhX21lbV9mcmVlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmls
ZV9wcml2KTsKLWV4dGVybiBpbnQgdmlhX2FncF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKLWV4dGVybiBp
bnQgdmlhX21hcF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0
cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKLWV4dGVybiBpbnQgdmlhX2RlY29kZXJfZnV0
ZXgoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxl
ICpmaWxlX3ByaXYpOwotZXh0ZXJuIGludCB2aWFfd2FpdF9pcnEoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOwotZXh0
ZXJuIGludCB2aWFfZG1hX2JsaXRfc3luYyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lk
ICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7Ci1leHRlcm4gaW50IHZpYV9k
bWFfYmxpdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJt
X2ZpbGUgKmZpbGVfcHJpdik7Ci0KLWV4dGVybiBpbnQgdmlhX2RyaXZlcl9sb2FkKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGxvbmcgY2hpcHNldCk7Ci1leHRlcm4gdm9p
ZCB2aWFfZHJpdmVyX3VubG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKLQotZXh0ZXJu
IGludCB2aWFfaW5pdF9jb250ZXh0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGludCBjb250
ZXh0KTsKLWV4dGVybiBpbnQgdmlhX2ZpbmFsX2NvbnRleHQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgaW50IGNvbnRleHQpOwotCi1leHRlcm4gaW50IHZpYV9kb19jbGVhbnVwX21hcChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKLWV4dGVybiB1MzIgdmlhX2dldF92YmxhbmtfY291
bnRlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSk7Ci1leHRl
cm4gaW50IHZpYV9lbmFibGVfdmJsYW5rKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2ln
bmVkIGludCBwaXBlKTsKLWV4dGVybiB2b2lkIHZpYV9kaXNhYmxlX3ZibGFuayhzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSk7Ci0KLWV4dGVybiBpcnFyZXR1
cm5fdCB2aWFfZHJpdmVyX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZyk7Ci1leHRl
cm4gdm9pZCB2aWFfZHJpdmVyX2lycV9wcmVpbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpOwotZXh0ZXJuIGludCB2aWFfZHJpdmVyX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KTsKLWV4dGVybiB2b2lkIHZpYV9kcml2ZXJfaXJxX3VuaW5zdGFsbChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKLQotZXh0ZXJuIGludCB2aWFfZG1hX2NsZWFudXAo
c3RydWN0IGRybV9kZXZpY2UgKmRldik7Ci1leHRlcm4gdm9pZCB2aWFfaW5pdF9jb21tYW5k
X3ZlcmlmaWVyKHZvaWQpOwotZXh0ZXJuIGludCB2aWFfZHJpdmVyX2RtYV9xdWllc2NlbnQo
c3RydWN0IGRybV9kZXZpY2UgKmRldik7Ci1leHRlcm4gdm9pZCB2aWFfaW5pdF9mdXRleChk
cm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYpOwotZXh0ZXJuIHZvaWQgdmlhX2NsZWFudXBf
ZnV0ZXgoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KTsKLWV4dGVybiB2b2lkIHZpYV9y
ZWxlYXNlX2Z1dGV4KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwgaW50IGNvbnRleHQp
OwotCi1leHRlcm4gdm9pZCB2aWFfcmVjbGFpbV9idWZmZXJzX2xvY2tlZChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAotCQkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7
Ci1leHRlcm4gdm9pZCB2aWFfbGFzdGNsb3NlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwot
Ci1leHRlcm4gdm9pZCB2aWFfZG1hYmxpdF9oYW5kbGVyKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIGludCBlbmdpbmUsIGludCBmcm9tX2lycSk7Ci1leHRlcm4gdm9pZCB2aWFfaW5pdF9k
bWFibGl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwotCi0jZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2lycS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpYS92
aWFfaXJxLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IGZhZWFlNWQ4ODFmYi4u
MDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2lycS5jCisrKyAv
ZGV2L251bGwKQEAgLTEsMzg4ICswLDAgQEAKLS8qIHZpYV9pcnEuYwotICoKLSAqIENvcHly
aWdodCAyMDA0IEJFQU0gTHRkLgotICogQ29weXJpZ2h0IDIwMDIgVHVuZ3N0ZW4gR3JhcGhp
Y3MsIEluYy4KLSAqIENvcHlyaWdodCAyMDA1IFRob21hcyBIZWxsc3Ryb20uCi0gKiBBbGwg
UmlnaHRzIFJlc2VydmVkLgotICoKLSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQs
IGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9m
IHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhl
ICJTb2Z0d2FyZSIpLAotICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0
cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgotICogdGhlIHJpZ2h0cyB0
byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1Ymxp
Y2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8g
cGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0
byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICog
VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ug
KGluY2x1ZGluZyB0aGUgbmV4dAotICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBp
biBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQotICogU29mdHdh
cmUuCi0gKgotICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQg
V0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElNUExJRUQsIElOQ0xVRElO
RyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZ
LAotICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdF
TUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCi0gKiBCRUFNIExURCwgVFVOR1NURU4gR1JBUEhJ
Q1MgIEFORC9PUiBJVFMgU1VQUExJRVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLAotICog
REFNQUdFUyBPUgotICogT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBP
RiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsCi0gKiBBUklTSU5HIEZST00sIE9VVCBP
RiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RI
RVIKLSAqIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KLSAqCi0gKiBBdXRob3JzOgotICog
ICAgVGVycnkgQmFybmFieSA8dGVycnkxQGJlYW0ubHRkLnVrPgotICogICAgS2VpdGggV2hp
dHdlbGwgPGtlaXRoQHR1bmdzdGVuZ3JhcGhpY3MuY29tPgotICogICAgVGhvbWFzIEhlbGxz
dHJvbSA8dW5pY2hyb21lQHNoaXBtYWlsLm9yZz4KLSAqCi0gKiBUaGlzIGNvZGUgcHJvdmlk
ZXMgc3RhbmRhcmQgRFJNIGFjY2VzcyB0byB0aGUgVmlhIFVuaWNocm9tZSAvIFBybyBWZXJ0
aWNhbCBibGFuawotICogaW50ZXJydXB0LCBhcyB3ZWxsIGFzIGFuIGluZnJhc3RydWN0dXJl
IHRvIGhhbmRsZSBvdGhlciBpbnRlcnJ1cHRzIG9mIHRoZSBjaGlwLgotICogVGhlIHJlZnJl
c2ggcmF0ZSBpcyBhbHNvIGNhbGN1bGF0ZWQgZm9yIHZpZGVvIHBsYXliYWNrIHN5bmMgcHVy
cG9zZXMuCi0gKi8KLQotI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+Ci0jaW5jbHVkZSA8
ZHJtL2RybV92YmxhbmsuaD4KLSNpbmNsdWRlIDxkcm0vdmlhX2RybS5oPgotCi0jaW5jbHVk
ZSAidmlhX2Rydi5oIgotCi0jZGVmaW5lIFZJQV9SRUdfSU5URVJSVVBUICAgICAgIDB4MjAw
Ci0KLS8qIFZJQV9SRUdfSU5URVJSVVBUICovCi0jZGVmaW5lIFZJQV9JUlFfR0xPQkFMCSAg
KDEgPDwgMzEpCi0jZGVmaW5lIFZJQV9JUlFfVkJMQU5LX0VOQUJMRSAgICgxIDw8IDE5KQot
I2RlZmluZSBWSUFfSVJRX1ZCTEFOS19QRU5ESU5HICAoMSA8PCAzKQotI2RlZmluZSBWSUFf
SVJRX0hRVjBfRU5BQkxFICAgICAoMSA8PCAxMSkKLSNkZWZpbmUgVklBX0lSUV9IUVYxX0VO
QUJMRSAgICAgKDEgPDwgMjUpCi0jZGVmaW5lIFZJQV9JUlFfSFFWMF9QRU5ESU5HICAgICgx
IDw8IDkpCi0jZGVmaW5lIFZJQV9JUlFfSFFWMV9QRU5ESU5HICAgICgxIDw8IDEwKQotI2Rl
ZmluZSBWSUFfSVJRX0RNQTBfRERfRU5BQkxFICAoMSA8PCAyMCkKLSNkZWZpbmUgVklBX0lS
UV9ETUEwX1REX0VOQUJMRSAgKDEgPDwgMjEpCi0jZGVmaW5lIFZJQV9JUlFfRE1BMV9ERF9F
TkFCTEUgICgxIDw8IDIyKQotI2RlZmluZSBWSUFfSVJRX0RNQTFfVERfRU5BQkxFICAoMSA8
PCAyMykKLSNkZWZpbmUgVklBX0lSUV9ETUEwX0REX1BFTkRJTkcgKDEgPDwgNCkKLSNkZWZp
bmUgVklBX0lSUV9ETUEwX1REX1BFTkRJTkcgKDEgPDwgNSkKLSNkZWZpbmUgVklBX0lSUV9E
TUExX0REX1BFTkRJTkcgKDEgPDwgNikKLSNkZWZpbmUgVklBX0lSUV9ETUExX1REX1BFTkRJ
TkcgKDEgPDwgNykKLQotCi0vKgotICogRGV2aWNlLXNwZWNpZmljIElSUXMgZ28gaGVyZS4g
VGhpcyB0eXBlIG1pZ2h0IG5lZWQgdG8gYmUgZXh0ZW5kZWQgd2l0aAotICogdGhlIHJlZ2lz
dGVyIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSBJUlEgY29udHJvbCByZWdpc3RlcnMuCi0gKiBD
dXJyZW50bHkgd2UgYWN0aXZhdGUgdGhlIEhRViBpbnRlcnJ1cHRzIG9mICBVbmljaHJvbWUg
UHJvIGdyb3VwIEEuCi0gKi8KLQotc3RhdGljIG1hc2thcnJheV90IHZpYV9wcm9fZ3JvdXBf
YV9pcnFzW10gPSB7Ci0Je1ZJQV9JUlFfSFFWMF9FTkFCTEUsIFZJQV9JUlFfSFFWMF9QRU5E
SU5HLCAweDAwMDAwM0QwLCAweDAwMDA4MDEwLAotCSAweDAwMDAwMDAwIH0sCi0Je1ZJQV9J
UlFfSFFWMV9FTkFCTEUsIFZJQV9JUlFfSFFWMV9QRU5ESU5HLCAweDAwMDAxM0QwLCAweDAw
MDA4MDEwLAotCSAweDAwMDAwMDAwIH0sCi0Je1ZJQV9JUlFfRE1BMF9URF9FTkFCTEUsIFZJ
QV9JUlFfRE1BMF9URF9QRU5ESU5HLCBWSUFfUENJX0RNQV9DU1IwLAotCSBWSUFfRE1BX0NT
Ul9UQSB8IFZJQV9ETUFfQ1NSX1RELCAweDAwMDAwMDA4fSwKLQl7VklBX0lSUV9ETUExX1RE
X0VOQUJMRSwgVklBX0lSUV9ETUExX1REX1BFTkRJTkcsIFZJQV9QQ0lfRE1BX0NTUjEsCi0J
IFZJQV9ETUFfQ1NSX1RBIHwgVklBX0RNQV9DU1JfVEQsIDB4MDAwMDAwMDh9LAotfTsKLXN0
YXRpYyBpbnQgdmlhX251bV9wcm9fZ3JvdXBfYSA9IEFSUkFZX1NJWkUodmlhX3Byb19ncm91
cF9hX2lycXMpOwotc3RhdGljIGludCB2aWFfaXJxbWFwX3Byb19ncm91cF9hW10gPSB7MCwg
MSwgLTEsIDIsIC0xLCAzfTsKLQotc3RhdGljIG1hc2thcnJheV90IHZpYV91bmljaHJvbWVf
aXJxc1tdID0gewotCXtWSUFfSVJRX0RNQTBfVERfRU5BQkxFLCBWSUFfSVJRX0RNQTBfVERf
UEVORElORywgVklBX1BDSV9ETUFfQ1NSMCwKLQkgVklBX0RNQV9DU1JfVEEgfCBWSUFfRE1B
X0NTUl9URCwgMHgwMDAwMDAwOH0sCi0Je1ZJQV9JUlFfRE1BMV9URF9FTkFCTEUsIFZJQV9J
UlFfRE1BMV9URF9QRU5ESU5HLCBWSUFfUENJX0RNQV9DU1IxLAotCSBWSUFfRE1BX0NTUl9U
QSB8IFZJQV9ETUFfQ1NSX1RELCAweDAwMDAwMDA4fQotfTsKLXN0YXRpYyBpbnQgdmlhX251
bV91bmljaHJvbWUgPSBBUlJBWV9TSVpFKHZpYV91bmljaHJvbWVfaXJxcyk7Ci1zdGF0aWMg
aW50IHZpYV9pcnFtYXBfdW5pY2hyb21lW10gPSB7LTEsIC0xLCAtMSwgMCwgLTEsIDF9Owot
Ci0KLXUzMiB2aWFfZ2V0X3ZibGFua19jb3VudGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHVuc2lnbmVkIGludCBwaXBlKQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9
IGRldi0+ZGV2X3ByaXZhdGU7Ci0KLQlpZiAocGlwZSAhPSAwKQotCQlyZXR1cm4gMDsKLQot
CXJldHVybiBhdG9taWNfcmVhZCgmZGV2X3ByaXYtPnZibF9yZWNlaXZlZCk7Ci19Ci0KLWly
cXJldHVybl90IHZpYV9kcml2ZXJfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQot
ewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAoc3RydWN0IGRybV9kZXZpY2UgKikgYXJn
OwotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAq
KSBkZXYtPmRldl9wcml2YXRlOwotCXUzMiBzdGF0dXM7Ci0JaW50IGhhbmRsZWQgPSAwOwot
CWt0aW1lX3QgY3VyX3ZibGFuazsKLQlkcm1fdmlhX2lycV90ICpjdXJfaXJxID0gZGV2X3By
aXYtPnZpYV9pcnFzOwotCWludCBpOwotCi0Jc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYs
IFZJQV9SRUdfSU5URVJSVVBUKTsKLQlpZiAoc3RhdHVzICYgVklBX0lSUV9WQkxBTktfUEVO
RElORykgewotCQlhdG9taWNfaW5jKCZkZXZfcHJpdi0+dmJsX3JlY2VpdmVkKTsKLQkJaWYg
KCEoYXRvbWljX3JlYWQoJmRldl9wcml2LT52YmxfcmVjZWl2ZWQpICYgMHgwRikpIHsKLQkJ
CWN1cl92YmxhbmsgPSBrdGltZV9nZXQoKTsKLQkJCWlmIChkZXZfcHJpdi0+bGFzdF92Ymxh
bmtfdmFsaWQpIHsKLQkJCQlkZXZfcHJpdi0+bnNlY19wZXJfdmJsYW5rID0KLQkJCQkJa3Rp
bWVfc3ViKGN1cl92YmxhbmssCi0JCQkJCQlkZXZfcHJpdi0+bGFzdF92YmxhbmspID4+IDQ7
Ci0JCQl9Ci0JCQlkZXZfcHJpdi0+bGFzdF92YmxhbmsgPSBjdXJfdmJsYW5rOwotCQkJZGV2
X3ByaXYtPmxhc3RfdmJsYW5rX3ZhbGlkID0gMTsKLQkJfQotCQlpZiAoIShhdG9taWNfcmVh
ZCgmZGV2X3ByaXYtPnZibF9yZWNlaXZlZCkgJiAweEZGKSkgewotCQkJRFJNX0RFQlVHKCJu
c2VjIHBlciB2YmxhbmsgaXM6ICVsbHVcbiIsCi0JCQkJICBrdGltZV90b19ucyhkZXZfcHJp
di0+bnNlY19wZXJfdmJsYW5rKSk7Ci0JCX0KLQkJZHJtX2hhbmRsZV92YmxhbmsoZGV2LCAw
KTsKLQkJaGFuZGxlZCA9IDE7Ci0JfQotCi0JZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5u
dW1faXJxczsgKytpKSB7Ci0JCWlmIChzdGF0dXMgJiBjdXJfaXJxLT5wZW5kaW5nX21hc2sp
IHsKLQkJCWF0b21pY19pbmMoJmN1cl9pcnEtPmlycV9yZWNlaXZlZCk7Ci0JCQl3YWtlX3Vw
KCZjdXJfaXJxLT5pcnFfcXVldWUpOwotCQkJaGFuZGxlZCA9IDE7Ci0JCQlpZiAoZGV2X3By
aXYtPmlycV9tYXBbZHJtX3ZpYV9pcnFfZG1hMF90ZF0gPT0gaSkKLQkJCQl2aWFfZG1hYmxp
dF9oYW5kbGVyKGRldiwgMCwgMSk7Ci0JCQllbHNlIGlmIChkZXZfcHJpdi0+aXJxX21hcFtk
cm1fdmlhX2lycV9kbWExX3RkXSA9PSBpKQotCQkJCXZpYV9kbWFibGl0X2hhbmRsZXIoZGV2
LCAxLCAxKTsKLQkJfQotCQljdXJfaXJxKys7Ci0JfQotCi0JLyogQWNrbm93bGVkZ2UgaW50
ZXJydXB0cyAqLwotCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1JFR19JTlRFUlJVUFQsIHN0
YXR1cyk7Ci0KLQotCWlmIChoYW5kbGVkKQotCQlyZXR1cm4gSVJRX0hBTkRMRUQ7Ci0JZWxz
ZQotCQlyZXR1cm4gSVJRX05PTkU7Ci19Ci0KLXN0YXRpYyBfX2lubGluZV9fIHZvaWQgdmlh
ZHJ2X2Fja25vd2xlZGdlX2lycXMoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQotewot
CXUzMiBzdGF0dXM7Ci0KLQlpZiAoZGV2X3ByaXYpIHsKLQkJLyogQWNrbm93bGVkZ2UgaW50
ZXJydXB0cyAqLwotCQlzdGF0dXMgPSB2aWFfcmVhZChkZXZfcHJpdiwgVklBX1JFR19JTlRF
UlJVUFQpOwotCQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0
dXMgfAotCQkJICBkZXZfcHJpdi0+aXJxX3BlbmRpbmdfbWFzayk7Ci0JfQotfQotCi1pbnQg
dmlhX2VuYWJsZV92Ymxhbmsoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50
IHBpcGUpCi17Ci0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJp
dmF0ZTsKLQl1MzIgc3RhdHVzOwotCi0JaWYgKHBpcGUgIT0gMCkgewotCQlEUk1fRVJST1Io
IiVzOiAgYmFkIGNydGMgJXVcbiIsIF9fZnVuY19fLCBwaXBlKTsKLQkJcmV0dXJuIC1FSU5W
QUw7Ci0JfQotCi0Jc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJS
VVBUKTsKLQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMg
fCBWSUFfSVJRX1ZCTEFOS19FTkFCTEUpOwotCi0JdmlhX3dyaXRlOChkZXZfcHJpdiwgMHg4
M2Q0LCAweDExKTsKLQl2aWFfd3JpdGU4X21hc2soZGV2X3ByaXYsIDB4ODNkNSwgMHgzMCwg
MHgzMCk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotdm9pZCB2aWFfZGlzYWJsZV92Ymxhbmsoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCi17Ci0JZHJtX3ZpYV9w
cml2YXRlX3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQl1MzIgc3RhdHVzOwot
Ci0Jc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBUKTsKLQl2
aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMgJiB+VklBX0lS
UV9WQkxBTktfRU5BQkxFKTsKLQotCXZpYV93cml0ZTgoZGV2X3ByaXYsIDB4ODNkNCwgMHgx
MSk7Ci0JdmlhX3dyaXRlOF9tYXNrKGRldl9wcml2LCAweDgzZDUsIDB4MzAsIDApOwotCi0J
aWYgKHBpcGUgIT0gMCkKLQkJRFJNX0VSUk9SKCIlczogIGJhZCBjcnRjICV1XG4iLCBfX2Z1
bmNfXywgcGlwZSk7Ci19Ci0KLXN0YXRpYyBpbnQKLXZpYV9kcml2ZXJfaXJxX3dhaXQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IGlycSwgaW50IGZvcmNlX3NlcXVl
bmNlLAotCQkgICAgdW5zaWduZWQgaW50ICpzZXF1ZW5jZSkKLXsKLQlkcm1fdmlhX3ByaXZh
dGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0
ZTsKLQl1bnNpZ25lZCBpbnQgY3VyX2lycV9zZXF1ZW5jZTsKLQlkcm1fdmlhX2lycV90ICpj
dXJfaXJxOwotCWludCByZXQgPSAwOwotCW1hc2thcnJheV90ICptYXNrczsKLQlpbnQgcmVh
bF9pcnE7Ci0KLQlEUk1fREVCVUcoIlxuIik7Ci0KLQlpZiAoIWRldl9wcml2KSB7Ci0JCURS
TV9FUlJPUigiY2FsbGVkIHdpdGggbm8gaW5pdGlhbGl6YXRpb25cbiIpOwotCQlyZXR1cm4g
LUVJTlZBTDsKLQl9Ci0KLQlpZiAoaXJxID49IGRybV92aWFfaXJxX251bSkgewotCQlEUk1f
RVJST1IoIlRyeWluZyB0byB3YWl0IG9uIHVua25vd24gaXJxICVkXG4iLCBpcnEpOwotCQly
ZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlyZWFsX2lycSA9IGRldl9wcml2LT5pcnFfbWFwW2ly
cV07Ci0KLQlpZiAocmVhbF9pcnEgPCAwKSB7Ci0JCURSTV9FUlJPUigiVmlkZW8gSVJRICVk
IG5vdCBhdmFpbGFibGUgb24gdGhpcyBoYXJkd2FyZS5cbiIsCi0JCQkgIGlycSk7Ci0JCXJl
dHVybiAtRUlOVkFMOwotCX0KLQotCW1hc2tzID0gZGV2X3ByaXYtPmlycV9tYXNrczsKLQlj
dXJfaXJxID0gZGV2X3ByaXYtPnZpYV9pcnFzICsgcmVhbF9pcnE7Ci0KLQlpZiAobWFza3Nb
cmVhbF9pcnFdWzJdICYmICFmb3JjZV9zZXF1ZW5jZSkgewotCQlWSUFfV0FJVF9PTihyZXQs
IGN1cl9pcnEtPmlycV9xdWV1ZSwgMyAqIEhaLAotCQkJICAgICgodmlhX3JlYWQoZGV2X3By
aXYsIG1hc2tzW2lycV1bMl0pICYgbWFza3NbaXJxXVszXSkgPT0KLQkJCSAgICAgbWFza3Nb
aXJxXVs0XSkpOwotCQljdXJfaXJxX3NlcXVlbmNlID0gYXRvbWljX3JlYWQoJmN1cl9pcnEt
PmlycV9yZWNlaXZlZCk7Ci0JfSBlbHNlIHsKLQkJVklBX1dBSVRfT04ocmV0LCBjdXJfaXJx
LT5pcnFfcXVldWUsIDMgKiBIWiwKLQkJCSAgICAoKChjdXJfaXJxX3NlcXVlbmNlID0KLQkJ
CSAgICAgICBhdG9taWNfcmVhZCgmY3VyX2lycS0+aXJxX3JlY2VpdmVkKSkgLQotCQkJICAg
ICAgKnNlcXVlbmNlKSA8PSAoMSA8PCAyMykpKTsKLQl9Ci0JKnNlcXVlbmNlID0gY3VyX2ly
cV9zZXF1ZW5jZTsKLQlyZXR1cm4gcmV0OwotfQotCi0KLS8qCi0gKiBkcm1fZG1hLmggaG9v
a3MKLSAqLwotCi12b2lkIHZpYV9kcml2ZXJfaXJxX3ByZWluc3RhbGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldikKLXsKLQlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3Zp
YV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKLQl1MzIgc3RhdHVzOwotCWRybV92
aWFfaXJxX3QgKmN1cl9pcnE7Ci0JaW50IGk7Ci0KLQlEUk1fREVCVUcoImRldl9wcml2OiAl
cFxuIiwgZGV2X3ByaXYpOwotCWlmIChkZXZfcHJpdikgewotCQljdXJfaXJxID0gZGV2X3By
aXYtPnZpYV9pcnFzOwotCi0JCWRldl9wcml2LT5pcnFfZW5hYmxlX21hc2sgPSBWSUFfSVJR
X1ZCTEFOS19FTkFCTEU7Ci0JCWRldl9wcml2LT5pcnFfcGVuZGluZ19tYXNrID0gVklBX0lS
UV9WQkxBTktfUEVORElORzsKLQotCQlpZiAoZGV2X3ByaXYtPmNoaXBzZXQgPT0gVklBX1BS
T19HUk9VUF9BIHx8Ci0JCSAgICBkZXZfcHJpdi0+Y2hpcHNldCA9PSBWSUFfRFg5XzApIHsK
LQkJCWRldl9wcml2LT5pcnFfbWFza3MgPSB2aWFfcHJvX2dyb3VwX2FfaXJxczsKLQkJCWRl
dl9wcml2LT5udW1faXJxcyA9IHZpYV9udW1fcHJvX2dyb3VwX2E7Ci0JCQlkZXZfcHJpdi0+
aXJxX21hcCA9IHZpYV9pcnFtYXBfcHJvX2dyb3VwX2E7Ci0JCX0gZWxzZSB7Ci0JCQlkZXZf
cHJpdi0+aXJxX21hc2tzID0gdmlhX3VuaWNocm9tZV9pcnFzOwotCQkJZGV2X3ByaXYtPm51
bV9pcnFzID0gdmlhX251bV91bmljaHJvbWU7Ci0JCQlkZXZfcHJpdi0+aXJxX21hcCA9IHZp
YV9pcnFtYXBfdW5pY2hyb21lOwotCQl9Ci0KLQkJZm9yIChpID0gMDsgaSA8IGRldl9wcml2
LT5udW1faXJxczsgKytpKSB7Ci0JCQlhdG9taWNfc2V0KCZjdXJfaXJxLT5pcnFfcmVjZWl2
ZWQsIDApOwotCQkJY3VyX2lycS0+ZW5hYmxlX21hc2sgPSBkZXZfcHJpdi0+aXJxX21hc2tz
W2ldWzBdOwotCQkJY3VyX2lycS0+cGVuZGluZ19tYXNrID0gZGV2X3ByaXYtPmlycV9tYXNr
c1tpXVsxXTsKLQkJCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmN1cl9pcnEtPmlycV9xdWV1ZSk7
Ci0JCQlkZXZfcHJpdi0+aXJxX2VuYWJsZV9tYXNrIHw9IGN1cl9pcnEtPmVuYWJsZV9tYXNr
OwotCQkJZGV2X3ByaXYtPmlycV9wZW5kaW5nX21hc2sgfD0gY3VyX2lycS0+cGVuZGluZ19t
YXNrOwotCQkJY3VyX2lycSsrOwotCi0JCQlEUk1fREVCVUcoIkluaXRpYWxpemluZyBJUlEg
JWRcbiIsIGkpOwotCQl9Ci0KLQkJZGV2X3ByaXYtPmxhc3RfdmJsYW5rX3ZhbGlkID0gMDsK
LQotCQkvKiBDbGVhciBWU3luYyBpbnRlcnJ1cHQgcmVncyAqLwotCQlzdGF0dXMgPSB2aWFf
cmVhZChkZXZfcHJpdiwgVklBX1JFR19JTlRFUlJVUFQpOwotCQl2aWFfd3JpdGUoZGV2X3By
aXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMgJgotCQkJICB+KGRldl9wcml2LT5pcnFf
ZW5hYmxlX21hc2spKTsKLQotCQkvKiBDbGVhciBiaXRzIGlmIHRoZXkncmUgYWxyZWFkeSBo
aWdoICovCi0JCXZpYWRydl9hY2tub3dsZWRnZV9pcnFzKGRldl9wcml2KTsKLQl9Ci19Ci0K
LWludCB2aWFfZHJpdmVyX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVf
dCAqKSBkZXYtPmRldl9wcml2YXRlOwotCXUzMiBzdGF0dXM7Ci0KLQlEUk1fREVCVUcoImZ1
bjogJXNcbiIsIF9fZnVuY19fKTsKLQlpZiAoIWRldl9wcml2KQotCQlyZXR1cm4gLUVJTlZB
TDsKLQotCXN0YXR1cyA9IHZpYV9yZWFkKGRldl9wcml2LCBWSUFfUkVHX0lOVEVSUlVQVCk7
Ci0JdmlhX3dyaXRlKGRldl9wcml2LCBWSUFfUkVHX0lOVEVSUlVQVCwgc3RhdHVzIHwgVklB
X0lSUV9HTE9CQUwKLQkJICB8IGRldl9wcml2LT5pcnFfZW5hYmxlX21hc2spOwotCi0JLyog
U29tZSBtYWdpYywgb2ggZm9yIHNvbWUgZGF0YSBzaGVldHMgISAqLwotCXZpYV93cml0ZTgo
ZGV2X3ByaXYsIDB4ODNkNCwgMHgxMSk7Ci0JdmlhX3dyaXRlOF9tYXNrKGRldl9wcml2LCAw
eDgzZDUsIDB4MzAsIDB4MzApOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXZvaWQgdmlhX2RyaXZl
cl9pcnFfdW5pbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi17Ci0JZHJtX3ZpYV9w
cml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2X3By
aXZhdGU7Ci0JdTMyIHN0YXR1czsKLQotCURSTV9ERUJVRygiXG4iKTsKLQlpZiAoZGV2X3By
aXYpIHsKLQotCQkvKiBTb21lIG1vcmUgbWFnaWMsIG9oIGZvciBzb21lIGRhdGEgc2hlZXRz
ICEgKi8KLQotCQl2aWFfd3JpdGU4KGRldl9wcml2LCAweDgzZDQsIDB4MTEpOwotCQl2aWFf
d3JpdGU4X21hc2soZGV2X3ByaXYsIDB4ODNkNSwgMHgzMCwgMCk7Ci0KLQkJc3RhdHVzID0g
dmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBUKTsKLQkJdmlhX3dyaXRlKGRl
dl9wcml2LCBWSUFfUkVHX0lOVEVSUlVQVCwgc3RhdHVzICYKLQkJCSAgfihWSUFfSVJRX1ZC
TEFOS19FTkFCTEUgfCBkZXZfcHJpdi0+aXJxX2VuYWJsZV9tYXNrKSk7Ci0JfQotfQotCi1p
bnQgdmlhX3dhaXRfaXJxKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0
cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQotewotCWRybV92aWFfaXJxd2FpdF90ICppcnF3
YWl0ID0gZGF0YTsKLQlzdHJ1Y3QgdGltZXNwZWM2NCBub3c7Ci0JaW50IHJldCA9IDA7Ci0J
ZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRl
di0+ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9pcnFfdCAqY3VyX2lycSA9IGRldl9wcml2LT52
aWFfaXJxczsKLQlpbnQgZm9yY2Vfc2VxdWVuY2U7Ci0KLQlpZiAoaXJxd2FpdC0+cmVxdWVz
dC5pcnEgPj0gZGV2X3ByaXYtPm51bV9pcnFzKSB7Ci0JCURSTV9FUlJPUigiVHJ5aW5nIHRv
IHdhaXQgb24gdW5rbm93biBpcnEgJWRcbiIsCi0JCQkgIGlycXdhaXQtPnJlcXVlc3QuaXJx
KTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JY3VyX2lycSArPSBpcnF3YWl0LT5yZXF1
ZXN0LmlycTsKLQotCXN3aXRjaCAoaXJxd2FpdC0+cmVxdWVzdC50eXBlICYgflZJQV9JUlFf
RkxBR1NfTUFTSykgewotCWNhc2UgVklBX0lSUV9SRUxBVElWRToKLQkJaXJxd2FpdC0+cmVx
dWVzdC5zZXF1ZW5jZSArPQotCQkJYXRvbWljX3JlYWQoJmN1cl9pcnEtPmlycV9yZWNlaXZl
ZCk7Ci0JCWlycXdhaXQtPnJlcXVlc3QudHlwZSAmPSB+X0RSTV9WQkxBTktfUkVMQVRJVkU7
Ci0JCWJyZWFrOwotCWNhc2UgVklBX0lSUV9BQlNPTFVURToKLQkJYnJlYWs7Ci0JZGVmYXVs
dDoKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JaWYgKGlycXdhaXQtPnJlcXVlc3QudHlw
ZSAmIFZJQV9JUlFfU0lHTkFMKSB7Ci0JCURSTV9FUlJPUigiU2lnbmFscyBvbiBWaWEgSVJR
cyBub3QgaW1wbGVtZW50ZWQgeWV0LlxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQot
CWZvcmNlX3NlcXVlbmNlID0gKGlycXdhaXQtPnJlcXVlc3QudHlwZSAmIFZJQV9JUlFfRk9S
Q0VfU0VRVUVOQ0UpOwotCi0JcmV0ID0gdmlhX2RyaXZlcl9pcnFfd2FpdChkZXYsIGlycXdh
aXQtPnJlcXVlc3QuaXJxLCBmb3JjZV9zZXF1ZW5jZSwKLQkJCQkgICZpcnF3YWl0LT5yZXF1
ZXN0LnNlcXVlbmNlKTsKLQlrdGltZV9nZXRfdHM2NCgmbm93KTsKLQlpcnF3YWl0LT5yZXBs
eS50dmFsX3NlYyA9IG5vdy50dl9zZWM7Ci0JaXJxd2FpdC0+cmVwbHkudHZhbF91c2VjID0g
bm93LnR2X25zZWMgLyBOU0VDX1BFUl9VU0VDOwotCi0JcmV0dXJuIHJldDsKLX0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2xlZ2FjeS5jIGIvZHJpdmVycy9ncHUv
ZHJtL3ZpYS92aWFfbGVnYWN5LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5hOTAwMzAyOTQ3YWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vdmlhL3ZpYV9sZWdhY3kuYwpAQCAtMCwwICsxLDM4MzYgQEAKKy8vIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVk
LCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBv
ZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRo
ZSAiU29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVz
dHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMg
dG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWIg
bGljZW5zZSwKKyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0
byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVk
IHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisg
KiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGlj
ZSAoaW5jbHVkaW5nIHRoZQorICogbmV4dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVk
IGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKKyAqIG9mIHRoZSBTb2Z0
d2FyZS4KKyAqCisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9V
VCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwgSU5DTFVE
SU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJ
VFksCisgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OLUlORlJJ
TkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwKKyAqIFRIRSBBVVRIT1IoUyksIEFORC9PUiBU
SEUgQ09QWVJJR0hUIEhPTERFUihTKSBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdF
UyBPUgorICogT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05U
UkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsCisgKiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJ
TiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKKyAq
IERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKyAqLworCisjaW5jbHVkZSA8bGludXgvZGVs
YXkuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtbWFwcGluZy5oPgorI2luY2x1ZGUgPGxpbnV4
L2lycXJldHVybi5oPgorI2luY2x1ZGUgPGxpbnV4L2ppZmZpZXMuaD4KKyNpbmNsdWRlIDxs
aW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9wYWdlbWFwLmg+CisjaW5jbHVkZSA8
bGludXgvcGNpLmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KKyNpbmNsdWRlIDxsaW51
eC9zY2hlZC9zaWduYWwuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisjaW5jbHVkZSA8
bGludXgvdWFjY2Vzcy5oPgorI2luY2x1ZGUgPGxpbnV4L3ZtYWxsb2MuaD4KKyNpbmNsdWRl
IDxsaW51eC93YWl0Lmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Rydi5oPgorI2luY2x1ZGUgPGRy
bS9kcm1faW9jdGwuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZpbGUuaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX2xlZ2FjeS5oPgorI2luY2x1ZGUgPGRybS9kcm1fbW0uaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX3BjaWlkcy5oPgorI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CisjaW5jbHVk
ZSA8ZHJtL3ZpYV9kcm0uaD4KKworI2luY2x1ZGUgInZpYV8zZF9yZWcuaCIKKworLyoKKyAq
IExlZ2FjeSBmaWxlOiB2aWFfdmVyaWZpZXIuaAorICoKKyAqIENvcHlyaWdodCAyMDA0IFRo
ZSBVbmljaHJvbWUgUHJvamVjdC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiBBdXRo
b3I6IFRob21hcyBIZWxsc3Ryw7ZtIDIwMDQuCisgKi8KKwordHlwZWRlZiBlbnVtIHsKKwlu
b19zZXF1ZW5jZSA9IDAsCisJel9hZGRyZXNzLAorCWRlc3RfYWRkcmVzcywKKwl0ZXhfYWRk
cmVzcworfSBkcm1fdmlhX3NlcXVlbmNlX3Q7CisKK3R5cGVkZWYgc3RydWN0IHsKKwl1bnNp
Z25lZCB0ZXh0dXJlOworCXVpbnQzMl90IHpfYWRkcjsKKwl1aW50MzJfdCBkX2FkZHI7CisJ
dWludDMyX3QgdF9hZGRyWzJdWzEwXTsKKwl1aW50MzJfdCBwaXRjaFsyXVsxMF07CisJdWlu
dDMyX3QgaGVpZ2h0WzJdWzEwXTsKKwl1aW50MzJfdCB0ZXhfbGV2ZWxfbG9bMl07CisJdWlu
dDMyX3QgdGV4X2xldmVsX2hpWzJdOworCXVpbnQzMl90IHRleF9wYWxldHRlX3NpemVbMl07
CisJdWludDMyX3QgdGV4X25wb3RbMl07CisJZHJtX3ZpYV9zZXF1ZW5jZV90IHVuZmluaXNo
ZWQ7CisJaW50IGFncF90ZXh0dXJlOworCWludCBtdWx0aXRleDsKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2OworCWRybV9sb2NhbF9tYXBfdCAqbWFwX2NhY2hlOworCXVpbnQzMl90IHZl
cnRleF9jb3VudDsKKwlpbnQgYWdwOworCWNvbnN0IHVpbnQzMl90ICpidWZfc3RhcnQ7Cit9
IGRybV92aWFfc3RhdGVfdDsKKworZXh0ZXJuIGludCB2aWFfdmVyaWZ5X2NvbW1hbmRfc3Ry
ZWFtKGNvbnN0IHVpbnQzMl90ICpidWYsIHVuc2lnbmVkIGludCBzaXplLAorCQkJCSAgICAg
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGFncCk7CitleHRlcm4gaW50IHZpYV9wYXJz
ZV9jb21tYW5kX3N0cmVhbShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBjb25zdCB1aW50MzJf
dCAqYnVmLAorCQkJCSAgICB1bnNpZ25lZCBpbnQgc2l6ZSk7CisKKy8qCisgKiBMZWdhY3kg
ZmlsZTogdmlhX2RtYWJsaXQuaCAtLSBQQ0kgRE1BIEJpdEJsdCBzdXBwb3J0IGZvciB0aGUg
VklBIFVuaWNocm9tZS9Qcm8KKyAqCisgKiBDb3B5cmlnaHQgMjAwNSBUaG9tYXMgSGVsbHN0
cm9tLgorICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiBBdXRob3JzOgorICogICAg
VGhvbWFzIEhlbGxzdHJvbS4KKyAqICAgIFJlZ2lzdGVyIGluZm8gZnJvbSBEaWdlbyBJbmMu
CisgKi8KKworI2RlZmluZSBWSUFfTlVNX0JMSVRfRU5HSU5FUyAyCisjZGVmaW5lIFZJQV9O
VU1fQkxJVF9TTE9UUyA4CisKK3N0cnVjdCBfZHJtX3ZpYV9kZXNjcmlwdG9yOworCit0eXBl
ZGVmIHN0cnVjdCBfZHJtX3ZpYV9zZ19pbmZvIHsKKwlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOwor
CXVuc2lnbmVkIGxvbmcgbnVtX3BhZ2VzOworCXN0cnVjdCBfZHJtX3ZpYV9kZXNjcmlwdG9y
ICoqZGVzY19wYWdlczsKKwlpbnQgbnVtX2Rlc2NfcGFnZXM7CisJaW50IG51bV9kZXNjOwor
CWVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbjsKKwl1bnNpZ25lZCBjaGFyICpi
b3VuY2VfYnVmZmVyOworCWRtYV9hZGRyX3QgY2hhaW5fc3RhcnQ7CisJdWludDMyX3QgZnJl
ZV9vbl9zZXF1ZW5jZTsKKwl1bnNpZ25lZCBpbnQgZGVzY3JpcHRvcnNfcGVyX3BhZ2U7CisJ
aW50IGFib3J0ZWQ7CisJZW51bSB7CisJCWRyX3ZpYV9kZXZpY2VfbWFwcGVkLAorCQlkcl92
aWFfZGVzY19wYWdlc19hbGxvYywKKwkJZHJfdmlhX3BhZ2VzX2xvY2tlZCwKKwkJZHJfdmlh
X3BhZ2VzX2FsbG9jLAorCQlkcl92aWFfc2dfaW5pdAorCX0gc3RhdGU7Cit9IGRybV92aWFf
c2dfaW5mb190OworCit0eXBlZGVmIHN0cnVjdCBfZHJtX3ZpYV9ibGl0cSB7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRldjsKKwl1aW50MzJfdCBjdXJfYmxpdF9oYW5kbGU7CisJdWludDMy
X3QgZG9uZV9ibGl0X2hhbmRsZTsKKwl1bnNpZ25lZCBzZXJ2aWNlZDsKKwl1bnNpZ25lZCBo
ZWFkOworCXVuc2lnbmVkIGN1cjsKKwl1bnNpZ25lZCBudW1fZnJlZTsKKwl1bnNpZ25lZCBu
dW1fb3V0c3RhbmRpbmc7CisJdW5zaWduZWQgbG9uZyBlbmQ7CisJaW50IGFib3J0aW5nOwor
CWludCBpc19hY3RpdmU7CisJZHJtX3ZpYV9zZ19pbmZvX3QgKmJsaXRzW1ZJQV9OVU1fQkxJ
VF9TTE9UU107CisJc3BpbmxvY2tfdCBibGl0X2xvY2s7CisJd2FpdF9xdWV1ZV9oZWFkX3Qg
YmxpdF9xdWV1ZVtWSUFfTlVNX0JMSVRfU0xPVFNdOworCXdhaXRfcXVldWVfaGVhZF90IGJ1
c3lfcXVldWU7CisJc3RydWN0IHdvcmtfc3RydWN0IHdxOworCXN0cnVjdCB0aW1lcl9saXN0
IHBvbGxfdGltZXI7Cit9IGRybV92aWFfYmxpdHFfdDsKKworCisvKgorICogIFBDSSBETUEg
UmVnaXN0ZXJzCisgKiAgQ2hhbm5lbHMgMiAmIDMgZG9uJ3Qgc2VlbSB0byBiZSBpbXBsZW1l
bnRlZCBpbiBoYXJkd2FyZS4KKyAqLworCisjZGVmaW5lIFZJQV9QQ0lfRE1BX01BUjAgICAg
ICAgICAgICAweEU0MCAgIC8qIE1lbW9yeSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENoYW5uZWwg
MCAqLworI2RlZmluZSBWSUFfUENJX0RNQV9EQVIwICAgICAgICAgICAgMHhFNDQgICAvKiBE
ZXZpY2UgQWRkcmVzcyBSZWdpc3RlciBvZiBDaGFubmVsIDAgKi8KKyNkZWZpbmUgVklBX1BD
SV9ETUFfQkNSMCAgICAgICAgICAgIDB4RTQ4ICAgLyogQnl0ZSBDb3VudCBSZWdpc3RlciBv
ZiBDaGFubmVsIDAgKi8KKyNkZWZpbmUgVklBX1BDSV9ETUFfRFBSMCAgICAgICAgICAgIDB4
RTRDICAgLyogRGVzY3JpcHRvciBQb2ludGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwgMCAqLwor
CisjZGVmaW5lIFZJQV9QQ0lfRE1BX01BUjEgICAgICAgICAgICAweEU1MCAgIC8qIE1lbW9y
eSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENoYW5uZWwgMSAqLworI2RlZmluZSBWSUFfUENJX0RN
QV9EQVIxICAgICAgICAgICAgMHhFNTQgICAvKiBEZXZpY2UgQWRkcmVzcyBSZWdpc3RlciBv
ZiBDaGFubmVsIDEgKi8KKyNkZWZpbmUgVklBX1BDSV9ETUFfQkNSMSAgICAgICAgICAgIDB4
RTU4ICAgLyogQnl0ZSBDb3VudCBSZWdpc3RlciBvZiBDaGFubmVsIDEgKi8KKyNkZWZpbmUg
VklBX1BDSV9ETUFfRFBSMSAgICAgICAgICAgIDB4RTVDICAgLyogRGVzY3JpcHRvciBQb2lu
dGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwgMSAqLworCisjZGVmaW5lIFZJQV9QQ0lfRE1BX01B
UjIgICAgICAgICAgICAweEU2MCAgIC8qIE1lbW9yeSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENo
YW5uZWwgMiAqLworI2RlZmluZSBWSUFfUENJX0RNQV9EQVIyICAgICAgICAgICAgMHhFNjQg
ICAvKiBEZXZpY2UgQWRkcmVzcyBSZWdpc3RlciBvZiBDaGFubmVsIDIgKi8KKyNkZWZpbmUg
VklBX1BDSV9ETUFfQkNSMiAgICAgICAgICAgIDB4RTY4ICAgLyogQnl0ZSBDb3VudCBSZWdp
c3RlciBvZiBDaGFubmVsIDIgKi8KKyNkZWZpbmUgVklBX1BDSV9ETUFfRFBSMiAgICAgICAg
ICAgIDB4RTZDICAgLyogRGVzY3JpcHRvciBQb2ludGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwg
MiAqLworCisjZGVmaW5lIFZJQV9QQ0lfRE1BX01BUjMgICAgICAgICAgICAweEU3MCAgIC8q
IE1lbW9yeSBBZGRyZXNzIFJlZ2lzdGVyIG9mIENoYW5uZWwgMyAqLworI2RlZmluZSBWSUFf
UENJX0RNQV9EQVIzICAgICAgICAgICAgMHhFNzQgICAvKiBEZXZpY2UgQWRkcmVzcyBSZWdp
c3RlciBvZiBDaGFubmVsIDMgKi8KKyNkZWZpbmUgVklBX1BDSV9ETUFfQkNSMyAgICAgICAg
ICAgIDB4RTc4ICAgLyogQnl0ZSBDb3VudCBSZWdpc3RlciBvZiBDaGFubmVsIDMgKi8KKyNk
ZWZpbmUgVklBX1BDSV9ETUFfRFBSMyAgICAgICAgICAgIDB4RTdDICAgLyogRGVzY3JpcHRv
ciBQb2ludGVyIFJlZ2lzdGVyIG9mIENoYW5uZWwgMyAqLworCisjZGVmaW5lIFZJQV9QQ0lf
RE1BX01SMCAgICAgICAgICAgICAweEU4MCAgIC8qIE1vZGUgUmVnaXN0ZXIgb2YgQ2hhbm5l
bCAwICovCisjZGVmaW5lIFZJQV9QQ0lfRE1BX01SMSAgICAgICAgICAgICAweEU4NCAgIC8q
IE1vZGUgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAxICovCisjZGVmaW5lIFZJQV9QQ0lfRE1BX01S
MiAgICAgICAgICAgICAweEU4OCAgIC8qIE1vZGUgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAyICov
CisjZGVmaW5lIFZJQV9QQ0lfRE1BX01SMyAgICAgICAgICAgICAweEU4QyAgIC8qIE1vZGUg
UmVnaXN0ZXIgb2YgQ2hhbm5lbCAzICovCisKKyNkZWZpbmUgVklBX1BDSV9ETUFfQ1NSMCAg
ICAgICAgICAgIDB4RTkwICAgLyogQ29tbWFuZC9TdGF0dXMgUmVnaXN0ZXIgb2YgQ2hhbm5l
bCAwICovCisjZGVmaW5lIFZJQV9QQ0lfRE1BX0NTUjEgICAgICAgICAgICAweEU5NCAgIC8q
IENvbW1hbmQvU3RhdHVzIFJlZ2lzdGVyIG9mIENoYW5uZWwgMSAqLworI2RlZmluZSBWSUFf
UENJX0RNQV9DU1IyICAgICAgICAgICAgMHhFOTggICAvKiBDb21tYW5kL1N0YXR1cyBSZWdp
c3RlciBvZiBDaGFubmVsIDIgKi8KKyNkZWZpbmUgVklBX1BDSV9ETUFfQ1NSMyAgICAgICAg
ICAgIDB4RTlDICAgLyogQ29tbWFuZC9TdGF0dXMgUmVnaXN0ZXIgb2YgQ2hhbm5lbCAzICov
CisKKyNkZWZpbmUgVklBX1BDSV9ETUFfUFRSICAgICAgICAgICAgIDB4RUEwICAgLyogUHJp
b3JpdHkgVHlwZSBSZWdpc3RlciAqLworCisvKiBEZWZpbmUgZm9yIERNQSBlbmdpbmUgKi8K
Ky8qIERQUiAqLworI2RlZmluZSBWSUFfRE1BX0RQUl9FQwkJKDE8PDEpCS8qIGVuZCBvZiBj
aGFpbiAqLworI2RlZmluZSBWSUFfRE1BX0RQUl9ERElFCSgxPDwyKQkvKiBkZXNjcmlwdG9y
IGRvbmUgaW50ZXJydXB0IGVuYWJsZSAqLworI2RlZmluZSBWSUFfRE1BX0RQUl9EVAkJKDE8
PDMpCS8qIGRpcmVjdGlvbiBvZiB0cmFuc2ZlciAoUk8pICovCisKKy8qIE1SICovCisjZGVm
aW5lIFZJQV9ETUFfTVJfQ00JCSgxPDwwKQkvKiBjaGFpbmluZyBtb2RlICovCisjZGVmaW5l
IFZJQV9ETUFfTVJfVERJRQkJKDE8PDEpCS8qIHRyYW5zZmVyIGRvbmUgaW50ZXJydXB0IGVu
YWJsZSAqLworI2RlZmluZSBWSUFfRE1BX01SX0hFTkRNQUNNRAkJKDE8PDcpIC8qID8gKi8K
KworLyogQ1NSICovCisjZGVmaW5lIFZJQV9ETUFfQ1NSX0RFCQkoMTw8MCkJLyogRE1BIGVu
YWJsZSAqLworI2RlZmluZSBWSUFfRE1BX0NTUl9UUwkJKDE8PDEpCS8qIHRyYW5zZmVyIHN0
YXJ0ICovCisjZGVmaW5lIFZJQV9ETUFfQ1NSX1RBCQkoMTw8MikJLyogdHJhbnNmZXIgYWJv
cnQgKi8KKyNkZWZpbmUgVklBX0RNQV9DU1JfVEQJCSgxPDwzKQkvKiB0cmFuc2ZlciBkb25l
ICovCisjZGVmaW5lIFZJQV9ETUFfQ1NSX0RECQkoMTw8NCkJLyogZGVzY3JpcHRvciBkb25l
ICovCisjZGVmaW5lIFZJQV9ETUFfRFBSX0VDICAgICAgICAgICgxPDwxKSAgLyogZW5kIG9m
IGNoYWluICovCisKKy8qCisgKiBMZWdhY3kgZmlsZTogdmlhX2Rydi5oCisgKgorICogQ29w
eXJpZ2h0IDE5OTgtMjAwMyBWSUEgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCBSaWdodHMgUmVz
ZXJ2ZWQuCisgKiBDb3B5cmlnaHQgMjAwMS0yMDAzIFMzIEdyYXBoaWNzLCBJbmMuIEFsbCBS
aWdodHMgUmVzZXJ2ZWQuCisgKi8KKworI2RlZmluZSBEUklWRVJfQVVUSE9SCSJWYXJpb3Vz
IgorCisjZGVmaW5lIERSSVZFUl9OQU1FCQkidmlhIgorI2RlZmluZSBEUklWRVJfREVTQwkJ
IlZJQSBVbmljaHJvbWUgLyBQcm8iCisjZGVmaW5lIERSSVZFUl9EQVRFCQkiMjAwNzAyMDIi
CisKKyNkZWZpbmUgRFJJVkVSX01BSk9SCQkyCisjZGVmaW5lIERSSVZFUl9NSU5PUgkJMTEK
KyNkZWZpbmUgRFJJVkVSX1BBVENITEVWRUwJMQorCisjZGVmaW5lIFZJQV9QQ0lfQlVGX1NJ
WkUgNjAwMDAKKyNkZWZpbmUgVklBX0ZJUkVfQlVGX1NJWkUgIDEwMjQKKyNkZWZpbmUgVklB
X05VTV9JUlFTIDQKKwordHlwZWRlZiBzdHJ1Y3QgZHJtX3ZpYV9yaW5nX2J1ZmZlciB7CisJ
ZHJtX2xvY2FsX21hcF90IG1hcDsKKwljaGFyICp2aXJ0dWFsX3N0YXJ0OworfSBkcm1fdmlh
X3JpbmdfYnVmZmVyX3Q7CisKK3R5cGVkZWYgdWludDMyX3QgbWFza2FycmF5X3RbNV07CisK
K3R5cGVkZWYgc3RydWN0IGRybV92aWFfaXJxIHsKKwlhdG9taWNfdCBpcnFfcmVjZWl2ZWQ7
CisJdWludDMyX3QgcGVuZGluZ19tYXNrOworCXVpbnQzMl90IGVuYWJsZV9tYXNrOworCXdh
aXRfcXVldWVfaGVhZF90IGlycV9xdWV1ZTsKK30gZHJtX3ZpYV9pcnFfdDsKKwordHlwZWRl
ZiBzdHJ1Y3QgZHJtX3ZpYV9wcml2YXRlIHsKKwlkcm1fdmlhX3NhcmVhX3QgKnNhcmVhX3By
aXY7CisJZHJtX2xvY2FsX21hcF90ICpzYXJlYTsKKwlkcm1fbG9jYWxfbWFwX3QgKmZiOwor
CWRybV9sb2NhbF9tYXBfdCAqbW1pbzsKKwl1bnNpZ25lZCBsb25nIGFncEFkZHI7CisJd2Fp
dF9xdWV1ZV9oZWFkX3QgZGVjb2Rlcl9xdWV1ZVtWSUFfTlJfWFZNQ19MT0NLU107CisJY2hh
ciAqZG1hX3B0cjsKKwl1bnNpZ25lZCBpbnQgZG1hX2xvdzsKKwl1bnNpZ25lZCBpbnQgZG1h
X2hpZ2g7CisJdW5zaWduZWQgaW50IGRtYV9vZmZzZXQ7CisJdWludDMyX3QgZG1hX3dyYXA7
CisJdm9sYXRpbGUgdWludDMyX3QgKmxhc3RfcGF1c2VfcHRyOworCXZvbGF0aWxlIHVpbnQz
Ml90ICpod19hZGRyX3B0cjsKKwlkcm1fdmlhX3JpbmdfYnVmZmVyX3QgcmluZzsKKwlrdGlt
ZV90IGxhc3RfdmJsYW5rOworCWludCBsYXN0X3ZibGFua192YWxpZDsKKwlrdGltZV90IG5z
ZWNfcGVyX3ZibGFuazsKKwlhdG9taWNfdCB2YmxfcmVjZWl2ZWQ7CisJZHJtX3ZpYV9zdGF0
ZV90IGhjX3N0YXRlOworCWNoYXIgcGNpX2J1ZltWSUFfUENJX0JVRl9TSVpFXTsKKwljb25z
dCB1aW50MzJfdCAqZmlyZV9vZmZzZXRzW1ZJQV9GSVJFX0JVRl9TSVpFXTsKKwl1aW50MzJf
dCBudW1fZmlyZV9vZmZzZXRzOworCWludCBjaGlwc2V0OworCWRybV92aWFfaXJxX3Qgdmlh
X2lycXNbVklBX05VTV9JUlFTXTsKKwl1bnNpZ25lZCBudW1faXJxczsKKwltYXNrYXJyYXlf
dCAqaXJxX21hc2tzOworCXVpbnQzMl90IGlycV9lbmFibGVfbWFzazsKKwl1aW50MzJfdCBp
cnFfcGVuZGluZ19tYXNrOworCWludCAqaXJxX21hcDsKKwl1bnNpZ25lZCBpbnQgaWRsZV9m
YXVsdDsKKwlpbnQgdnJhbV9pbml0aWFsaXplZDsKKwlzdHJ1Y3QgZHJtX21tIHZyYW1fbW07
CisJaW50IGFncF9pbml0aWFsaXplZDsKKwlzdHJ1Y3QgZHJtX21tIGFncF9tbTsKKwkvKiog
TWFwcGluZyBvZiB1c2Vyc3BhY2Uga2V5cyB0byBtbSBvYmplY3RzICovCisJc3RydWN0IGlk
ciBvYmplY3RfaWRyOworCXVuc2lnbmVkIGxvbmcgdnJhbV9vZmZzZXQ7CisJdW5zaWduZWQg
bG9uZyBhZ3Bfb2Zmc2V0OworCWRybV92aWFfYmxpdHFfdCBibGl0X3F1ZXVlc1tWSUFfTlVN
X0JMSVRfRU5HSU5FU107CisJdWludDMyX3QgZG1hX2RpZmY7Cit9IGRybV92aWFfcHJpdmF0
ZV90OworCitzdHJ1Y3QgdmlhX2ZpbGVfcHJpdmF0ZSB7CisJc3RydWN0IGxpc3RfaGVhZCBv
YmpfbGlzdDsKK307CisKK2VudW0gdmlhX2ZhbWlseSB7CisgIFZJQV9PVEhFUiA9IDAsICAg
ICAvKiBCYXNlbGluZSAqLworICBWSUFfUFJPX0dST1VQX0EsICAgLyogQW5vdGhlciB2aWRl
byBlbmdpbmUgYW5kIERNQSBjb21tYW5kcyAqLworICBWSUFfRFg5XzAgICAgICAgICAgLyog
U2FtZSB2aWRlbyBhcyBwcm9fZ3JvdXBfYSwgYnV0IDNEIGlzIHVuc3VwcG9ydGVkICovCit9
OworCisvKiBWSUEgTU1JTyByZWdpc3RlciBhY2Nlc3MgKi8KK3N0YXRpYyBpbmxpbmUgdTMy
IHZpYV9yZWFkKHN0cnVjdCBkcm1fdmlhX3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcmVnKQor
eworCXJldHVybiByZWFkbCgodm9pZCBfX2lvbWVtICopKGRldl9wcml2LT5tbWlvLT5oYW5k
bGUgKyByZWcpKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHZpYV93cml0ZShzdHJ1Y3Qg
ZHJtX3ZpYV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHJlZywKKwkJCSAgICAgdTMyIHZhbCkK
K3sKKwl3cml0ZWwodmFsLCAodm9pZCBfX2lvbWVtICopKGRldl9wcml2LT5tbWlvLT5oYW5k
bGUgKyByZWcpKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHZpYV93cml0ZTgoc3RydWN0
IGRybV92aWFfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiByZWcsCisJCQkgICAgICB1MzIgdmFs
KQoreworCXdyaXRlYih2YWwsICh2b2lkIF9faW9tZW0gKikoZGV2X3ByaXYtPm1taW8tPmhh
bmRsZSArIHJlZykpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgdmlhX3dyaXRlOF9tYXNr
KHN0cnVjdCBkcm1fdmlhX3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSAgIHUzMiByZWcsIHUz
MiBtYXNrLCB1MzIgdmFsKQoreworCXUzMiB0bXA7CisKKwl0bXAgPSByZWFkYigodm9pZCBf
X2lvbWVtICopKGRldl9wcml2LT5tbWlvLT5oYW5kbGUgKyByZWcpKTsKKwl0bXAgPSAodG1w
ICYgfm1hc2spIHwgKHZhbCAmIG1hc2spOworCXdyaXRlYih0bXAsICh2b2lkIF9faW9tZW0g
KikoZGV2X3ByaXYtPm1taW8tPmhhbmRsZSArIHJlZykpOworfQorCisvKgorICogUG9sbCBp
biBhIGxvb3Agd2FpdGluZyBmb3IgJ2NvbnRpZGl0aW9uJyB0byBiZSB0cnVlLgorICogTm90
ZTogQSBkaXJlY3QgcmVwbGFjZW1lbnQgd2l0aCB3YWl0X2V2ZW50X2ludGVycnVwdGlibGVf
dGltZW91dCgpCisgKiAgICAgICB3aWxsIG5vdCB3b3JrIHVubGVzcyBkcml2ZXIgaXMgdXBk
YXRlZCB0byBlbWl0IHdha2VfdXAoKQorICogICAgICAgaW4gcmVsZXZhbnQgcGxhY2VzIHRo
YXQgY2FuIGltcGFjdCB0aGUgJ2NvbmRpdGlvbicKKyAqCisgKiBSZXR1cm5zOgorICogICBy
ZXQga2VlcHMgY3VycmVudCB2YWx1ZSBpZiAnY29uZGl0aW9uJyBiZWNvbWVzIHRydWUKKyAq
ICAgcmV0ID0gLUJVU1kgaWYgdGltZW91dCBoYXBwZW5zCisgKiAgIHJldCA9IC1FSU5UUiBp
ZiBhIHNpZ25hbCBpbnRlcnJ1cHRlZCB0aGUgd2FpdGluZyBwZXJpb2QKKyAqLworI2RlZmlu
ZSBWSUFfV0FJVF9PTiggcmV0LCBxdWV1ZSwgdGltZW91dCwgY29uZGl0aW9uICkJCVwKK2Rv
IHsJCQkJCQkJCVwKKwlERUNMQVJFX1dBSVRRVUVVRShlbnRyeSwgY3VycmVudCk7CQkJXAor
CXVuc2lnbmVkIGxvbmcgZW5kID0gamlmZmllcyArICh0aW1lb3V0KTsJCVwKKwlhZGRfd2Fp
dF9xdWV1ZSgmKHF1ZXVlKSwgJmVudHJ5KTsJCQlcCisJCQkJCQkJCVwKKwlmb3IgKDs7KSB7
CQkJCQkJXAorCQlfX3NldF9jdXJyZW50X3N0YXRlKFRBU0tfSU5URVJSVVBUSUJMRSk7CVwK
KwkJaWYgKGNvbmRpdGlvbikJCQkJCVwKKwkJCWJyZWFrOwkJCQkJXAorCQlpZiAodGltZV9h
ZnRlcl9lcShqaWZmaWVzLCBlbmQpKSB7CQlcCisJCQlyZXQgPSAtRUJVU1k7CQkJCVwKKwkJ
CWJyZWFrOwkJCQkJXAorCQl9CQkJCQkJXAorCQlzY2hlZHVsZV90aW1lb3V0KChIWi8xMDAg
PiAxKSA/IEhaLzEwMCA6IDEpOwlcCisJCWlmIChzaWduYWxfcGVuZGluZyhjdXJyZW50KSkg
ewkJCVwKKwkJCXJldCA9IC1FSU5UUjsJCQkJXAorCQkJYnJlYWs7CQkJCQlcCisJCX0JCQkJ
CQlcCisJfQkJCQkJCQlcCisJX19zZXRfY3VycmVudF9zdGF0ZShUQVNLX1JVTk5JTkcpOwkJ
CVwKKwlyZW1vdmVfd2FpdF9xdWV1ZSgmKHF1ZXVlKSwgJmVudHJ5KTsJCQlcCit9IHdoaWxl
ICgwKQorCitleHRlcm4gY29uc3Qgc3RydWN0IGRybV9pb2N0bF9kZXNjIHZpYV9pb2N0bHNb
XTsKK2V4dGVybiBpbnQgdmlhX21heF9pb2N0bDsKKworZXh0ZXJuIGludCB2aWFfZmJfaW5p
dChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGVfcHJpdik7CitleHRlcm4gaW50IHZpYV9tZW1fYWxsb2Moc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOworZXh0
ZXJuIGludCB2aWFfbWVtX2ZyZWUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOworZXh0ZXJuIGludCB2aWFfYWdwX2lu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxl
ICpmaWxlX3ByaXYpOworZXh0ZXJuIGludCB2aWFfbWFwX2luaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOworZXh0
ZXJuIGludCB2aWFfZGVjb2Rlcl9mdXRleChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lk
ICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7CitleHRlcm4gaW50IHZpYV93
YWl0X2lycShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJt
X2ZpbGUgKmZpbGVfcHJpdik7CitleHRlcm4gaW50IHZpYV9kbWFfYmxpdF9zeW5jKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9w
cml2KTsKK2V4dGVybiBpbnQgdmlhX2RtYV9ibGl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKKworZXh0ZXJuIGlu
dCB2aWFfZHJpdmVyX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgbG9u
ZyBjaGlwc2V0KTsKK2V4dGVybiB2b2lkIHZpYV9kcml2ZXJfdW5sb2FkKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpOworCitleHRlcm4gaW50IHZpYV9pbml0X2NvbnRleHQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgaW50IGNvbnRleHQpOworZXh0ZXJuIGludCB2aWFfZmluYWxfY29u
dGV4dChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgY29udGV4dCk7CisKK2V4dGVybiBp
bnQgdmlhX2RvX2NsZWFudXBfbWFwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOworZXh0ZXJu
IHUzMiB2aWFfZ2V0X3ZibGFua19jb3VudGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVu
c2lnbmVkIGludCBwaXBlKTsKK2V4dGVybiBpbnQgdmlhX2VuYWJsZV92Ymxhbmsoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpOworZXh0ZXJuIHZvaWQgdmlh
X2Rpc2FibGVfdmJsYW5rKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBw
aXBlKTsKKworZXh0ZXJuIGlycXJldHVybl90IHZpYV9kcml2ZXJfaXJxX2hhbmRsZXIoaW50
IGlycSwgdm9pZCAqYXJnKTsKK2V4dGVybiB2b2lkIHZpYV9kcml2ZXJfaXJxX3ByZWluc3Rh
bGwoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CitleHRlcm4gaW50IHZpYV9kcml2ZXJfaXJx
X3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOworZXh0ZXJuIHZvaWQgdmlh
X2RyaXZlcl9pcnFfdW5pbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOworCitleHRl
cm4gaW50IHZpYV9kbWFfY2xlYW51cChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKK2V4dGVy
biB2b2lkIHZpYV9pbml0X2NvbW1hbmRfdmVyaWZpZXIodm9pZCk7CitleHRlcm4gaW50IHZp
YV9kcml2ZXJfZG1hX3F1aWVzY2VudChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKK2V4dGVy
biB2b2lkIHZpYV9pbml0X2Z1dGV4KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdik7Citl
eHRlcm4gdm9pZCB2aWFfY2xlYW51cF9mdXRleChkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3By
aXYpOworZXh0ZXJuIHZvaWQgdmlhX3JlbGVhc2VfZnV0ZXgoZHJtX3ZpYV9wcml2YXRlX3Qg
KmRldl9wcml2LCBpbnQgY29udGV4dCk7CisKK2V4dGVybiB2b2lkIHZpYV9yZWNsYWltX2J1
ZmZlcnNfbG9ja2VkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJICAgICAgIHN0cnVj
dCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKK2V4dGVybiB2b2lkIHZpYV9sYXN0Y2xvc2Uoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldik7CisKK2V4dGVybiB2b2lkIHZpYV9kbWFibGl0X2hhbmRs
ZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGVuZ2luZSwgaW50IGZyb21faXJxKTsK
K2V4dGVybiB2b2lkIHZpYV9pbml0X2RtYWJsaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldik7
CisKKy8qCisgKiB2aWFfZG1hLmMgLS0gRE1BIHN1cHBvcnQgZm9yIHRoZSBWSUEgVW5pY2hy
b21lL1BybworICoKKyAqIENvcHlyaWdodCAyMDAzIFR1bmdzdGVuIEdyYXBoaWNzLCBJbmMu
LCBDZWRhciBQYXJrLCBUZXhhcy4KKyAqIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgorICog
Q29weXJpZ2h0IDIwMDQgRGlnZW8sIEluYy4sIFBhbG8gQWx0bywgQ0EsIFUuUy5BLgorICog
QWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiBDb3B5cmlnaHQgMjAwNCBUaGUgVW5pY2hy
b21lIHByb2plY3QuCisgKiBBbGwgUmlnaHRzIFJlc2VydmVkLgorICoKKyAqIEF1dGhvcnM6
CisgKiAgICBUdW5nc3RlbiBHcmFwaGljcywKKyAqICAgIEVyZGkgQ2hlbiwKKyAqICAgIFRo
b21hcyBIZWxsc3Ryb20uCisgKi8KKworI2RlZmluZSBDTURCVUZfQUxJR05NRU5UX1NJWkUg
ICAoMHgxMDApCisjZGVmaW5lIENNREJVRl9BTElHTk1FTlRfTUFTSyAgICgweDBmZikKKwor
LyogZGVmaW5lcyBmb3IgVklBIDNEIHJlZ2lzdGVycyAqLworI2RlZmluZSBWSUFfUkVHX1NU
QVRVUyAgICAgICAgICAweDQwMAorI2RlZmluZSBWSUFfUkVHX1RSQU5TRVQgICAgICAgICAw
eDQzQworI2RlZmluZSBWSUFfUkVHX1RSQU5TUEFDRSAgICAgICAweDQ0MAorCisvKiBWSUFf
UkVHX1NUQVRVUygweDQwMCk6IEVuZ2luZSBTdGF0dXMgKi8KKyNkZWZpbmUgVklBX0NNRF9S
R1RSX0JVU1kgICAgICAgMHgwMDAwMDA4MAkvKiBDb21tYW5kIFJlZ3VsYXRvciBpcyBidXN5
ICovCisjZGVmaW5lIFZJQV8yRF9FTkdfQlVTWSAgICAgICAgIDB4MDAwMDAwMDEJLyogMkQg
RW5naW5lIGlzIGJ1c3kgKi8KKyNkZWZpbmUgVklBXzNEX0VOR19CVVNZICAgICAgICAgMHgw
MDAwMDAwMgkvKiAzRCBFbmdpbmUgaXMgYnVzeSAqLworI2RlZmluZSBWSUFfVlJfUVVFVUVf
QlVTWSAgICAgICAweDAwMDIwMDAwCS8qIFZpcnR1YWwgUXVldWUgaXMgYnVzeSAqLworCisj
ZGVmaW5lIFNldFJlZzJEQUdQKG5SZWcsIG5EYXRhKSB7CQkJCVwKKwkqKCh1aW50MzJfdCAq
KSh2YikpID0gKChuUmVnKSA+PiAyKSB8IEhBTENZT05fSEVBREVSMTsJXAorCSooKHVpbnQz
Ml90ICopKHZiKSArIDEpID0gKG5EYXRhKTsJCQlcCisJdmIgPSAoKHVpbnQzMl90ICopdmIp
ICsgMjsJCQkJXAorCWRldl9wcml2LT5kbWFfbG93ICs9IDg7CQkJCQlcCit9CisKKyNkZWZp
bmUgdmlhX2ZsdXNoX3dyaXRlX2NvbWJpbmUoKSBtYigpCisKKyNkZWZpbmUgVklBX09VVF9S
SU5HX1FXKHcxLCB3MikJZG8gewkJXAorCSp2YisrID0gKHcxKTsJCQkJXAorCSp2YisrID0g
KHcyKTsJCQkJXAorCWRldl9wcml2LT5kbWFfbG93ICs9IDg7CQkJXAorfSB3aGlsZSAoMCkK
Kworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9zdGFydChkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYpOworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9wYXVzZShkcm1fdmlhX3ByaXZhdGVf
dCAqZGV2X3ByaXYpOworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9yZXNldChkcm1fdmlhX3By
aXZhdGVfdCAqZGV2X3ByaXYpOworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9yZXdpbmQoZHJt
X3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KTsKK3N0YXRpYyBpbnQgdmlhX3dhaXRfaWRsZShk
cm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYpOworc3RhdGljIHZvaWQgdmlhX3BhZF9jYWNo
ZShkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYsIGludCBxd29yZHMpOworCisvKgorICog
RnJlZSBzcGFjZSBpbiBjb21tYW5kIGJ1ZmZlci4KKyAqLworCitzdGF0aWMgdWludDMyX3Qg
dmlhX2NtZGJ1Zl9zcGFjZShkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYpCit7CisJdWlu
dDMyX3QgYWdwX2Jhc2UgPSBkZXZfcHJpdi0+ZG1hX29mZnNldCArICh1aW50MzJfdCkgZGV2
X3ByaXYtPmFncEFkZHI7CisJdWludDMyX3QgaHdfYWRkciA9ICooZGV2X3ByaXYtPmh3X2Fk
ZHJfcHRyKSAtIGFncF9iYXNlOworCisJcmV0dXJuICgoaHdfYWRkciA8PSBkZXZfcHJpdi0+
ZG1hX2xvdykgPworCQkoZGV2X3ByaXYtPmRtYV9oaWdoICsgaHdfYWRkciAtIGRldl9wcml2
LT5kbWFfbG93KSA6CisJCShod19hZGRyIC0gZGV2X3ByaXYtPmRtYV9sb3cpKTsKK30KKwor
LyoKKyAqIEhvdyBtdWNoIGRvZXMgdGhlIGNvbW1hbmQgcmVndWxhdG9yIGxhZyBiZWhpbmQ/
CisgKi8KKworc3RhdGljIHVpbnQzMl90IHZpYV9jbWRidWZfbGFnKGRybV92aWFfcHJpdmF0
ZV90ICpkZXZfcHJpdikKK3sKKwl1aW50MzJfdCBhZ3BfYmFzZSA9IGRldl9wcml2LT5kbWFf
b2Zmc2V0ICsgKHVpbnQzMl90KSBkZXZfcHJpdi0+YWdwQWRkcjsKKwl1aW50MzJfdCBod19h
ZGRyID0gKihkZXZfcHJpdi0+aHdfYWRkcl9wdHIpIC0gYWdwX2Jhc2U7CisKKwlyZXR1cm4g
KChod19hZGRyIDw9IGRldl9wcml2LT5kbWFfbG93KSA/CisJCShkZXZfcHJpdi0+ZG1hX2xv
dyAtIGh3X2FkZHIpIDoKKwkJKGRldl9wcml2LT5kbWFfd3JhcCArIGRldl9wcml2LT5kbWFf
bG93IC0gaHdfYWRkcikpOworfQorCisvKgorICogQ2hlY2sgdGhhdCB0aGUgZ2l2ZW4gc2l6
ZSBmaXRzIGluIHRoZSBidWZmZXIsIG90aGVyd2lzZSB3YWl0LgorICovCisKK3N0YXRpYyBp
bmxpbmUgaW50Cit2aWFfY21kYnVmX3dhaXQoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
LCB1bnNpZ25lZCBpbnQgc2l6ZSkKK3sKKwl1aW50MzJfdCBhZ3BfYmFzZSA9IGRldl9wcml2
LT5kbWFfb2Zmc2V0ICsgKHVpbnQzMl90KSBkZXZfcHJpdi0+YWdwQWRkcjsKKwl1aW50MzJf
dCBjdXJfYWRkciwgaHdfYWRkciwgbmV4dF9hZGRyOworCXZvbGF0aWxlIHVpbnQzMl90ICpo
d19hZGRyX3B0cjsKKwl1aW50MzJfdCBjb3VudDsKKwlod19hZGRyX3B0ciA9IGRldl9wcml2
LT5od19hZGRyX3B0cjsKKwljdXJfYWRkciA9IGRldl9wcml2LT5kbWFfbG93OworCW5leHRf
YWRkciA9IGN1cl9hZGRyICsgc2l6ZSArIDUxMiAqIDEwMjQ7CisJY291bnQgPSAxMDAwMDAw
OworCWRvIHsKKwkJaHdfYWRkciA9ICpod19hZGRyX3B0ciAtIGFncF9iYXNlOworCQlpZiAo
Y291bnQtLSA9PSAwKSB7CisJCQlEUk1fRVJST1IKKwkJCSAgICAoInZpYV9jbWRidWZfd2Fp
dCB0aW1lZCBvdXQgaHcgJXggY3VyX2FkZHIgJXggbmV4dF9hZGRyICV4XG4iLAorCQkJICAg
ICBod19hZGRyLCBjdXJfYWRkciwgbmV4dF9hZGRyKTsKKwkJCXJldHVybiAtMTsKKwkJfQor
CQlpZiAgKChjdXJfYWRkciA8IGh3X2FkZHIpICYmIChuZXh0X2FkZHIgPj0gaHdfYWRkcikp
CisJCQltc2xlZXAoMSk7CisJfSB3aGlsZSAoKGN1cl9hZGRyIDwgaHdfYWRkcikgJiYgKG5l
eHRfYWRkciA+PSBod19hZGRyKSk7CisJcmV0dXJuIDA7Cit9CisKKy8qCisgKiBDaGVja3Mg
d2hldGhlciBidWZmZXIgaGVhZCBoYXMgcmVhY2ggdGhlIGVuZC4gUmV3aW5kIHRoZSByaW5n
IGJ1ZmZlcgorICogd2hlbiBuZWNlc3NhcnkuCisgKgorICogUmV0dXJucyB2aXJ0dWFsIHBv
aW50ZXIgdG8gcmluZyBidWZmZXIuCisgKi8KKworc3RhdGljIGlubGluZSB1aW50MzJfdCAq
dmlhX2NoZWNrX2RtYShkcm1fdmlhX3ByaXZhdGVfdCAqIGRldl9wcml2LAorCQkJCSAgICAg
IHVuc2lnbmVkIGludCBzaXplKQoreworCWlmICgoZGV2X3ByaXYtPmRtYV9sb3cgKyBzaXpl
ICsgNCAqIENNREJVRl9BTElHTk1FTlRfU0laRSkgPgorCSAgICBkZXZfcHJpdi0+ZG1hX2hp
Z2gpIHsKKwkJdmlhX2NtZGJ1Zl9yZXdpbmQoZGV2X3ByaXYpOworCX0KKwlpZiAodmlhX2Nt
ZGJ1Zl93YWl0KGRldl9wcml2LCBzaXplKSAhPSAwKQorCQlyZXR1cm4gTlVMTDsKKworCXJl
dHVybiAodWludDMyX3QgKikgKGRldl9wcml2LT5kbWFfcHRyICsgZGV2X3ByaXYtPmRtYV9s
b3cpOworfQorCitpbnQgdmlhX2RtYV9jbGVhbnVwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYp
Cit7CisJaWYgKGRldi0+ZGV2X3ByaXZhdGUpIHsKKwkJZHJtX3ZpYV9wcml2YXRlX3QgKmRl
dl9wcml2ID0KKwkJICAgIChkcm1fdmlhX3ByaXZhdGVfdCAqKSBkZXYtPmRldl9wcml2YXRl
OworCisJCWlmIChkZXZfcHJpdi0+cmluZy52aXJ0dWFsX3N0YXJ0KSB7CisJCQl2aWFfY21k
YnVmX3Jlc2V0KGRldl9wcml2KTsKKworCQkJZHJtX2xlZ2FjeV9pb3JlbWFwZnJlZSgmZGV2
X3ByaXYtPnJpbmcubWFwLCBkZXYpOworCQkJZGV2X3ByaXYtPnJpbmcudmlydHVhbF9zdGFy
dCA9IE5VTEw7CisJCX0KKworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHZp
YV9pbml0aWFsaXplKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkgIGRybV92aWFfcHJp
dmF0ZV90ICpkZXZfcHJpdiwKKwkJCSAgZHJtX3ZpYV9kbWFfaW5pdF90ICppbml0KQorewor
CWlmICghZGV2X3ByaXYgfHwgIWRldl9wcml2LT5tbWlvKSB7CisJCURSTV9FUlJPUigidmlh
X2RtYV9pbml0IGNhbGxlZCBiZWZvcmUgdmlhX21hcF9pbml0XG4iKTsKKwkJcmV0dXJuIC1F
RkFVTFQ7CisJfQorCisJaWYgKGRldl9wcml2LT5yaW5nLnZpcnR1YWxfc3RhcnQgIT0gTlVM
TCkgeworCQlEUk1fRVJST1IoImNhbGxlZCBhZ2FpbiB3aXRob3V0IGNhbGxpbmcgY2xlYW51
cFxuIik7CisJCXJldHVybiAtRUZBVUxUOworCX0KKworCWlmICghZGV2LT5hZ3AgfHwgIWRl
di0+YWdwLT5iYXNlKSB7CisJCURSTV9FUlJPUigiY2FsbGVkIHdpdGggbm8gYWdwIG1lbW9y
eSBhdmFpbGFibGVcbiIpOworCQlyZXR1cm4gLUVGQVVMVDsKKwl9CisKKwlpZiAoZGV2X3By
aXYtPmNoaXBzZXQgPT0gVklBX0RYOV8wKSB7CisJCURSTV9FUlJPUigiQUdQIERNQSBpcyBu
b3Qgc3VwcG9ydGVkIG9uIHRoaXMgY2hpcFxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCWRldl9wcml2LT5yaW5nLm1hcC5vZmZzZXQgPSBkZXYtPmFncC0+YmFzZSArIGluaXQt
Pm9mZnNldDsKKwlkZXZfcHJpdi0+cmluZy5tYXAuc2l6ZSA9IGluaXQtPnNpemU7CisJZGV2
X3ByaXYtPnJpbmcubWFwLnR5cGUgPSAwOworCWRldl9wcml2LT5yaW5nLm1hcC5mbGFncyA9
IDA7CisJZGV2X3ByaXYtPnJpbmcubWFwLm10cnIgPSAwOworCisJZHJtX2xlZ2FjeV9pb3Jl
bWFwKCZkZXZfcHJpdi0+cmluZy5tYXAsIGRldik7CisKKwlpZiAoZGV2X3ByaXYtPnJpbmcu
bWFwLmhhbmRsZSA9PSBOVUxMKSB7CisJCXZpYV9kbWFfY2xlYW51cChkZXYpOworCQlEUk1f
RVJST1IoImNhbiBub3QgaW9yZW1hcCB2aXJ0dWFsIGFkZHJlc3MgZm9yIgorCQkJICAiIHJp
bmcgYnVmZmVyXG4iKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJZGV2X3ByaXYtPnJp
bmcudmlydHVhbF9zdGFydCA9IGRldl9wcml2LT5yaW5nLm1hcC5oYW5kbGU7CisKKwlkZXZf
cHJpdi0+ZG1hX3B0ciA9IGRldl9wcml2LT5yaW5nLnZpcnR1YWxfc3RhcnQ7CisJZGV2X3By
aXYtPmRtYV9sb3cgPSAwOworCWRldl9wcml2LT5kbWFfaGlnaCA9IGluaXQtPnNpemU7CisJ
ZGV2X3ByaXYtPmRtYV93cmFwID0gaW5pdC0+c2l6ZTsKKwlkZXZfcHJpdi0+ZG1hX29mZnNl
dCA9IGluaXQtPm9mZnNldDsKKwlkZXZfcHJpdi0+bGFzdF9wYXVzZV9wdHIgPSBOVUxMOwor
CWRldl9wcml2LT5od19hZGRyX3B0ciA9CisJCSh2b2xhdGlsZSB1aW50MzJfdCAqKSgoY2hh
ciAqKWRldl9wcml2LT5tbWlvLT5oYW5kbGUgKworCQlpbml0LT5yZWdfcGF1c2VfYWRkcik7
CisKKwl2aWFfY21kYnVmX3N0YXJ0KGRldl9wcml2KTsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgaW50IHZpYV9kbWFfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sKKwlkcm1fdmlhX3ByaXZhdGVf
dCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsK
Kwlkcm1fdmlhX2RtYV9pbml0X3QgKmluaXQgPSBkYXRhOworCWludCByZXRjb2RlID0gMDsK
KworCXN3aXRjaCAoaW5pdC0+ZnVuYykgeworCWNhc2UgVklBX0lOSVRfRE1BOgorCQlpZiAo
IWNhcGFibGUoQ0FQX1NZU19BRE1JTikpCisJCQlyZXRjb2RlID0gLUVQRVJNOworCQllbHNl
CisJCQlyZXRjb2RlID0gdmlhX2luaXRpYWxpemUoZGV2LCBkZXZfcHJpdiwgaW5pdCk7CisJ
CWJyZWFrOworCWNhc2UgVklBX0NMRUFOVVBfRE1BOgorCQlpZiAoIWNhcGFibGUoQ0FQX1NZ
U19BRE1JTikpCisJCQlyZXRjb2RlID0gLUVQRVJNOworCQllbHNlCisJCQlyZXRjb2RlID0g
dmlhX2RtYV9jbGVhbnVwKGRldik7CisJCWJyZWFrOworCWNhc2UgVklBX0RNQV9JTklUSUFM
SVpFRDoKKwkJcmV0Y29kZSA9IChkZXZfcHJpdi0+cmluZy52aXJ0dWFsX3N0YXJ0ICE9IE5V
TEwpID8KKwkJCTAgOiAtRUZBVUxUOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXRjb2Rl
ID0gLUVJTlZBTDsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIHJldGNvZGU7Cit9CisKK3N0
YXRpYyBpbnQgdmlhX2Rpc3BhdGNoX2NtZGJ1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCBkcm1fdmlhX2NtZGJ1ZmZlcl90ICpjbWQpCit7CisJZHJtX3ZpYV9wcml2YXRlX3QgKmRl
dl9wcml2OworCXVpbnQzMl90ICp2YjsKKwlpbnQgcmV0OworCisJZGV2X3ByaXYgPSAoZHJt
X3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKKworCWlmIChkZXZfcHJpdi0+
cmluZy52aXJ0dWFsX3N0YXJ0ID09IE5VTEwpIHsKKwkJRFJNX0VSUk9SKCJjYWxsZWQgd2l0
aG91dCBpbml0aWFsaXppbmcgQUdQIHJpbmcgYnVmZmVyLlxuIik7CisJCXJldHVybiAtRUZB
VUxUOworCX0KKworCWlmIChjbWQtPnNpemUgPiBWSUFfUENJX0JVRl9TSVpFKQorCQlyZXR1
cm4gLUVOT01FTTsKKworCWlmIChjb3B5X2Zyb21fdXNlcihkZXZfcHJpdi0+cGNpX2J1Ziwg
Y21kLT5idWYsIGNtZC0+c2l6ZSkpCisJCXJldHVybiAtRUZBVUxUOworCisJLyoKKwkgKiBS
dW5uaW5nIHRoaXMgZnVuY3Rpb24gb24gQUdQIG1lbW9yeSBpcyBkZWFkIHNsb3cuIFRoZXJl
Zm9yZQorCSAqIHdlIHJ1biBpdCBvbiBhIHRlbXBvcmFyeSBjYWNoZWFibGUgc3lzdGVtIG1l
bW9yeSBidWZmZXIgYW5kCisJICogY29weSBpdCB0byBBR1AgbWVtb3J5IHdoZW4gcmVhZHku
CisJICovCisKKwlpZiAoKHJldCA9CisJICAgICB2aWFfdmVyaWZ5X2NvbW1hbmRfc3RyZWFt
KCh1aW50MzJfdCAqKSBkZXZfcHJpdi0+cGNpX2J1ZiwKKwkJCQkgICAgICAgY21kLT5zaXpl
LCBkZXYsIDEpKSkgeworCQlyZXR1cm4gcmV0OworCX0KKworCXZiID0gdmlhX2NoZWNrX2Rt
YShkZXZfcHJpdiwgKGNtZC0+c2l6ZSA8IDB4MTAwKSA/IDB4MTAyIDogY21kLT5zaXplKTsK
KwlpZiAodmIgPT0gTlVMTCkKKwkJcmV0dXJuIC1FQUdBSU47CisKKwltZW1jcHkodmIsIGRl
dl9wcml2LT5wY2lfYnVmLCBjbWQtPnNpemUpOworCisJZGV2X3ByaXYtPmRtYV9sb3cgKz0g
Y21kLT5zaXplOworCisJLyoKKwkgKiBTbWFsbCBzdWJtaXNzaW9ucyBzb21laG93IHN0YWxs
cyB0aGUgQ1BVLiAoQUdQIGNhY2hlIGVmZmVjdHM/KQorCSAqIHBhZCB0byBncmVhdGVyIHNp
emUuCisJICovCisKKwlpZiAoY21kLT5zaXplIDwgMHgxMDApCisJCXZpYV9wYWRfY2FjaGUo
ZGV2X3ByaXYsICgweDEwMCAtIGNtZC0+c2l6ZSkgPj4gMyk7CisJdmlhX2NtZGJ1Zl9wYXVz
ZShkZXZfcHJpdik7CisKKwlyZXR1cm4gMDsKK30KKworaW50IHZpYV9kcml2ZXJfZG1hX3F1
aWVzY2VudChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCWRybV92aWFfcHJpdmF0ZV90
ICpkZXZfcHJpdiA9IGRldi0+ZGV2X3ByaXZhdGU7CisKKwlpZiAoIXZpYV93YWl0X2lkbGUo
ZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVCVVNZOworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHZpYV9mbHVzaF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sKKworCUxPQ0tfVEVTVF9XSVRIX1JF
VFVSTihkZXYsIGZpbGVfcHJpdik7CisKKwlyZXR1cm4gdmlhX2RyaXZlcl9kbWFfcXVpZXNj
ZW50KGRldik7Cit9CisKK3N0YXRpYyBpbnQgdmlhX2NtZGJ1ZmZlcihzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sK
Kwlkcm1fdmlhX2NtZGJ1ZmZlcl90ICpjbWRidWYgPSBkYXRhOworCWludCByZXQ7CisKKwlM
T0NLX1RFU1RfV0lUSF9SRVRVUk4oZGV2LCBmaWxlX3ByaXYpOworCisJRFJNX0RFQlVHKCJi
dWYgJXAgc2l6ZSAlbHVcbiIsIGNtZGJ1Zi0+YnVmLCBjbWRidWYtPnNpemUpOworCisJcmV0
ID0gdmlhX2Rpc3BhdGNoX2NtZGJ1ZmZlcihkZXYsIGNtZGJ1Zik7CisJcmV0dXJuIHJldDsK
K30KKworc3RhdGljIGludCB2aWFfZGlzcGF0Y2hfcGNpX2NtZGJ1ZmZlcihzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAorCQkJCSAgICAgIGRybV92aWFfY21kYnVmZmVyX3QgKmNtZCkKK3sK
Kwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOworCWlu
dCByZXQ7CisKKwlpZiAoY21kLT5zaXplID4gVklBX1BDSV9CVUZfU0laRSkKKwkJcmV0dXJu
IC1FTk9NRU07CisJaWYgKGNvcHlfZnJvbV91c2VyKGRldl9wcml2LT5wY2lfYnVmLCBjbWQt
PmJ1ZiwgY21kLT5zaXplKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoKHJldCA9CisJ
ICAgICB2aWFfdmVyaWZ5X2NvbW1hbmRfc3RyZWFtKCh1aW50MzJfdCAqKSBkZXZfcHJpdi0+
cGNpX2J1ZiwKKwkJCQkgICAgICAgY21kLT5zaXplLCBkZXYsIDApKSkgeworCQlyZXR1cm4g
cmV0OworCX0KKworCXJldCA9CisJICAgIHZpYV9wYXJzZV9jb21tYW5kX3N0cmVhbShkZXYs
IChjb25zdCB1aW50MzJfdCAqKWRldl9wcml2LT5wY2lfYnVmLAorCQkJCSAgICAgY21kLT5z
aXplKTsKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IHZpYV9wY2lfY21kYnVmZmVy
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAq
ZmlsZV9wcml2KQoreworCWRybV92aWFfY21kYnVmZmVyX3QgKmNtZGJ1ZiA9IGRhdGE7CisJ
aW50IHJldDsKKworCUxPQ0tfVEVTVF9XSVRIX1JFVFVSTihkZXYsIGZpbGVfcHJpdik7CisK
KwlEUk1fREVCVUcoImJ1ZiAlcCBzaXplICVsdVxuIiwgY21kYnVmLT5idWYsIGNtZGJ1Zi0+
c2l6ZSk7CisKKwlyZXQgPSB2aWFfZGlzcGF0Y2hfcGNpX2NtZGJ1ZmZlcihkZXYsIGNtZGJ1
Zik7CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGlubGluZSB1aW50MzJfdCAqdmlhX2Fs
aWduX2J1ZmZlcihkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYsCisJCQkJCSB1aW50MzJf
dCAqIHZiLCBpbnQgcXdfY291bnQpCit7CisJZm9yICg7IHF3X2NvdW50ID4gMDsgLS1xd19j
b3VudCkKKwkJVklBX09VVF9SSU5HX1FXKEhDX0RVTU1ZLCBIQ19EVU1NWSk7CisJcmV0dXJu
IHZiOworfQorCisvKgorICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIGludGVybmFsbHkgYnkg
cmluZyBidWZmZXIgbWFuYWdlbWVudCBjb2RlLgorICoKKyAqIFJldHVybnMgdmlydHVhbCBw
b2ludGVyIHRvIHJpbmcgYnVmZmVyLgorICovCitzdGF0aWMgaW5saW5lIHVpbnQzMl90ICp2
aWFfZ2V0X2RtYShkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYpCit7CisJcmV0dXJuICh1
aW50MzJfdCAqKSAoZGV2X3ByaXYtPmRtYV9wdHIgKyBkZXZfcHJpdi0+ZG1hX2xvdyk7Cit9
CisKKy8qCisgKiBIb29rcyBhIHNlZ21lbnQgb2YgZGF0YSBpbnRvIHRoZSB0YWlsIG9mIHRo
ZSByaW5nLWJ1ZmZlciBieQorICogbW9kaWZ5aW5nIHRoZSBwYXVzZSBhZGRyZXNzIHN0b3Jl
ZCBpbiB0aGUgYnVmZmVyIGl0c2VsZi4gSWYKKyAqIHRoZSByZWd1bGF0b3IgaGFzIGFscmVh
ZHkgcGF1c2VkLCByZXN0YXJ0IGl0LgorICovCitzdGF0aWMgaW50IHZpYV9ob29rX3NlZ21l
bnQoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2LAorCQkJICAgIHVpbnQzMl90IHBhdXNl
X2FkZHJfaGksIHVpbnQzMl90IHBhdXNlX2FkZHJfbG8sCisJCQkgICAgaW50IG5vX3BjaV9m
aXJlKQoreworCWludCBwYXVzZWQsIGNvdW50OworCXZvbGF0aWxlIHVpbnQzMl90ICpwYXVz
ZWRfYXQgPSBkZXZfcHJpdi0+bGFzdF9wYXVzZV9wdHI7CisJdWludDMyX3QgcmVhZGVyLCBw
dHI7CisJdWludDMyX3QgZGlmZjsKKworCXBhdXNlZCA9IDA7CisJdmlhX2ZsdXNoX3dyaXRl
X2NvbWJpbmUoKTsKKwkodm9pZCkgKih2b2xhdGlsZSB1aW50MzJfdCAqKSh2aWFfZ2V0X2Rt
YShkZXZfcHJpdikgLSAxKTsKKworCSpwYXVzZWRfYXQgPSBwYXVzZV9hZGRyX2xvOworCXZp
YV9mbHVzaF93cml0ZV9jb21iaW5lKCk7CisJKHZvaWQpICpwYXVzZWRfYXQ7CisKKwlyZWFk
ZXIgPSAqKGRldl9wcml2LT5od19hZGRyX3B0cik7CisJcHRyID0gKCh2b2xhdGlsZSBjaGFy
ICopcGF1c2VkX2F0IC0gZGV2X3ByaXYtPmRtYV9wdHIpICsKKwkJZGV2X3ByaXYtPmRtYV9v
ZmZzZXQgKyAodWludDMyX3QpIGRldl9wcml2LT5hZ3BBZGRyICsgNDsKKworCWRldl9wcml2
LT5sYXN0X3BhdXNlX3B0ciA9IHZpYV9nZXRfZG1hKGRldl9wcml2KSAtIDE7CisKKwkvKgor
CSAqIElmIHRoZXJlIGlzIGEgcG9zc2liaWxpdHkgdGhhdCB0aGUgY29tbWFuZCByZWFkZXIg
d2lsbAorCSAqIG1pc3MgdGhlIG5ldyBwYXVzZSBhZGRyZXNzIGFuZCBwYXVzZSBvbiB0aGUg
b2xkIG9uZSwKKwkgKiBJbiB0aGF0IGNhc2Ugd2UgbmVlZCB0byBwcm9ncmFtIHRoZSBuZXcg
c3RhcnQgYWRkcmVzcworCSAqIHVzaW5nIFBDSS4KKwkgKi8KKworCWRpZmYgPSAodWludDMy
X3QpIChwdHIgLSByZWFkZXIpIC0gZGV2X3ByaXYtPmRtYV9kaWZmOworCWNvdW50ID0gMTAw
MDAwMDA7CisJd2hpbGUgKGRpZmYgPT0gMCAmJiBjb3VudC0tKSB7CisJCXBhdXNlZCA9ICh2
aWFfcmVhZChkZXZfcHJpdiwgMHg0MWMpICYgMHg4MDAwMDAwMCk7CisJCWlmIChwYXVzZWQp
CisJCQlicmVhazsKKwkJcmVhZGVyID0gKihkZXZfcHJpdi0+aHdfYWRkcl9wdHIpOworCQlk
aWZmID0gKHVpbnQzMl90KSAocHRyIC0gcmVhZGVyKSAtIGRldl9wcml2LT5kbWFfZGlmZjsK
Kwl9CisKKwlwYXVzZWQgPSB2aWFfcmVhZChkZXZfcHJpdiwgMHg0MWMpICYgMHg4MDAwMDAw
MDsKKworCWlmIChwYXVzZWQgJiYgIW5vX3BjaV9maXJlKSB7CisJCXJlYWRlciA9ICooZGV2
X3ByaXYtPmh3X2FkZHJfcHRyKTsKKwkJZGlmZiA9ICh1aW50MzJfdCkgKHB0ciAtIHJlYWRl
cikgLSBkZXZfcHJpdi0+ZG1hX2RpZmY7CisJCWRpZmYgJj0gKGRldl9wcml2LT5kbWFfaGln
aCAtIDEpOworCQlpZiAoZGlmZiAhPSAwICYmIGRpZmYgPCAoZGV2X3ByaXYtPmRtYV9oaWdo
ID4+IDEpKSB7CisJCQlEUk1fRVJST1IoIlBhdXNlZCBhdCBpbmNvcnJlY3QgYWRkcmVzcy4g
IgorCQkJCSAgIjB4JTA4eCwgMHglMDh4IDB4JTA4eFxuIiwKKwkJCQkgIHB0ciwgcmVhZGVy
LCBkZXZfcHJpdi0+ZG1hX2RpZmYpOworCQl9IGVsc2UgaWYgKGRpZmYgPT0gMCkgeworCQkJ
LyoKKwkJCSAqIFRoZXJlIGlzIGEgY29uY2VybiB0aGF0IHRoZXNlIHdyaXRlcyBtYXkgc3Rh
bGwgdGhlIFBDSSBidXMKKwkJCSAqIGlmIHRoZSBHUFUgaXMgbm90IGlkbGUuIEhvd2V2ZXIs
IGlkbGluZyB0aGUgR1BVIGZpcnN0CisJCQkgKiBkb2Vzbid0IG1ha2UgYSBkaWZmZXJlbmNl
LgorCQkJICovCisKKwkJCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1JFR19UUkFOU0VULCAo
SENfUGFyYVR5cGVfUHJlQ1IgPDwgMTYpKTsKKwkJCXZpYV93cml0ZShkZXZfcHJpdiwgVklB
X1JFR19UUkFOU1BBQ0UsIHBhdXNlX2FkZHJfaGkpOworCQkJdmlhX3dyaXRlKGRldl9wcml2
LCBWSUFfUkVHX1RSQU5TUEFDRSwgcGF1c2VfYWRkcl9sbyk7CisJCQl2aWFfcmVhZChkZXZf
cHJpdiwgVklBX1JFR19UUkFOU1BBQ0UpOworCQl9CisJfQorCXJldHVybiBwYXVzZWQ7Cit9
CisKK3N0YXRpYyBpbnQgdmlhX3dhaXRfaWRsZShkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3By
aXYpCit7CisJaW50IGNvdW50ID0gMTAwMDAwMDA7CisKKwl3aGlsZSAoISh2aWFfcmVhZChk
ZXZfcHJpdiwgVklBX1JFR19TVEFUVVMpICYgVklBX1ZSX1FVRVVFX0JVU1kpICYmIC0tY291
bnQpCisJCTsKKworCXdoaWxlIChjb3VudCAmJiAodmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9S
RUdfU1RBVFVTKSAmCisJCQkgICAoVklBX0NNRF9SR1RSX0JVU1kgfCBWSUFfMkRfRU5HX0JV
U1kgfAorCQkJICAgIFZJQV8zRF9FTkdfQlVTWSkpKQorCQktLWNvdW50OworCXJldHVybiBj
b3VudDsKK30KKworc3RhdGljIHVpbnQzMl90ICp2aWFfYWxpZ25fY21kKGRybV92aWFfcHJp
dmF0ZV90ICpkZXZfcHJpdiwgdWludDMyX3QgY21kX3R5cGUsCisJCQkgICAgICAgdWludDMy
X3QgYWRkciwgdWludDMyX3QgKmNtZF9hZGRyX2hpLAorCQkJICAgICAgIHVpbnQzMl90ICpj
bWRfYWRkcl9sbywgaW50IHNraXBfd2FpdCkKK3sKKwl1aW50MzJfdCBhZ3BfYmFzZTsKKwl1
aW50MzJfdCBjbWRfYWRkciwgYWRkcl9sbywgYWRkcl9oaTsKKwl1aW50MzJfdCAqdmI7CisJ
dWludDMyX3QgcXdfcGFkX2NvdW50OworCisJaWYgKCFza2lwX3dhaXQpCisJCXZpYV9jbWRi
dWZfd2FpdChkZXZfcHJpdiwgMiAqIENNREJVRl9BTElHTk1FTlRfU0laRSk7CisKKwl2YiA9
IHZpYV9nZXRfZG1hKGRldl9wcml2KTsKKwlWSUFfT1VUX1JJTkdfUVcoSENfSEVBREVSMiB8
ICgoVklBX1JFR19UUkFOU0VUID4+IDIpIDw8IDEyKSB8CisJCQkoVklBX1JFR19UUkFOU1BB
Q0UgPj4gMiksIEhDX1BhcmFUeXBlX1ByZUNSIDw8IDE2KTsKKwlhZ3BfYmFzZSA9IGRldl9w
cml2LT5kbWFfb2Zmc2V0ICsgKHVpbnQzMl90KSBkZXZfcHJpdi0+YWdwQWRkcjsKKwlxd19w
YWRfY291bnQgPSAoQ01EQlVGX0FMSUdOTUVOVF9TSVpFID4+IDMpIC0KKwkgICAgKChkZXZf
cHJpdi0+ZG1hX2xvdyAmIENNREJVRl9BTElHTk1FTlRfTUFTSykgPj4gMyk7CisKKwljbWRf
YWRkciA9IChhZGRyKSA/IGFkZHIgOgorCSAgICBhZ3BfYmFzZSArIGRldl9wcml2LT5kbWFf
bG93IC0gOCArIChxd19wYWRfY291bnQgPDwgMyk7CisJYWRkcl9sbyA9ICgoSENfU3ViQV9I
QUdQQnBMIDw8IDI0KSB8IChjbWRfdHlwZSAmIEhDX0hBR1BCcElEX01BU0spIHwKKwkJICAg
KGNtZF9hZGRyICYgSENfSEFHUEJwTF9NQVNLKSk7CisJYWRkcl9oaSA9ICgoSENfU3ViQV9I
QUdQQnBIIDw8IDI0KSB8IChjbWRfYWRkciA+PiAyNCkpOworCisJdmIgPSB2aWFfYWxpZ25f
YnVmZmVyKGRldl9wcml2LCB2YiwgcXdfcGFkX2NvdW50IC0gMSk7CisJVklBX09VVF9SSU5H
X1FXKCpjbWRfYWRkcl9oaSA9IGFkZHJfaGksICpjbWRfYWRkcl9sbyA9IGFkZHJfbG8pOwor
CXJldHVybiB2YjsKK30KKworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9zdGFydChkcm1fdmlh
X3ByaXZhdGVfdCAqZGV2X3ByaXYpCit7CisJdWludDMyX3QgcGF1c2VfYWRkcl9sbywgcGF1
c2VfYWRkcl9oaTsKKwl1aW50MzJfdCBzdGFydF9hZGRyLCBzdGFydF9hZGRyX2xvOworCXVp
bnQzMl90IGVuZF9hZGRyLCBlbmRfYWRkcl9sbzsKKwl1aW50MzJfdCBjb21tYW5kOworCXVp
bnQzMl90IGFncF9iYXNlOworCXVpbnQzMl90IHB0cjsKKwl1aW50MzJfdCByZWFkZXI7CisJ
aW50IGNvdW50OworCisJZGV2X3ByaXYtPmRtYV9sb3cgPSAwOworCisJYWdwX2Jhc2UgPSBk
ZXZfcHJpdi0+ZG1hX29mZnNldCArICh1aW50MzJfdCkgZGV2X3ByaXYtPmFncEFkZHI7CisJ
c3RhcnRfYWRkciA9IGFncF9iYXNlOworCWVuZF9hZGRyID0gYWdwX2Jhc2UgKyBkZXZfcHJp
di0+ZG1hX2hpZ2g7CisKKwlzdGFydF9hZGRyX2xvID0gKChIQ19TdWJBX0hBR1BCc3RMIDw8
IDI0KSB8IChzdGFydF9hZGRyICYgMHhGRkZGRkYpKTsKKwllbmRfYWRkcl9sbyA9ICgoSENf
U3ViQV9IQUdQQmVuZEwgPDwgMjQpIHwgKGVuZF9hZGRyICYgMHhGRkZGRkYpKTsKKwljb21t
YW5kID0gKChIQ19TdWJBX0hBR1BDTU5UIDw8IDI0KSB8IChzdGFydF9hZGRyID4+IDI0KSB8
CisJCSAgICgoZW5kX2FkZHIgJiAweGZmMDAwMDAwKSA+PiAxNikpOworCisJZGV2X3ByaXYt
Pmxhc3RfcGF1c2VfcHRyID0KKwkgICAgdmlhX2FsaWduX2NtZChkZXZfcHJpdiwgSENfSEFH
UEJwSURfUEFVU0UsIDAsCisJCQkgICZwYXVzZV9hZGRyX2hpLCAmcGF1c2VfYWRkcl9sbywg
MSkgLSAxOworCisJdmlhX2ZsdXNoX3dyaXRlX2NvbWJpbmUoKTsKKwkodm9pZCkgKih2b2xh
dGlsZSB1aW50MzJfdCAqKWRldl9wcml2LT5sYXN0X3BhdXNlX3B0cjsKKworCXZpYV93cml0
ZShkZXZfcHJpdiwgVklBX1JFR19UUkFOU0VULCAoSENfUGFyYVR5cGVfUHJlQ1IgPDwgMTYp
KTsKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQQUNFLCBjb21tYW5kKTsK
Kwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQQUNFLCBzdGFydF9hZGRyX2xv
KTsKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQQUNFLCBlbmRfYWRkcl9s
byk7CisKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQQUNFLCBwYXVzZV9h
ZGRyX2hpKTsKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJBTlNQQUNFLCBwYXVz
ZV9hZGRyX2xvKTsKKwl3bWIoKTsKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfVFJB
TlNQQUNFLCBjb21tYW5kIHwgSENfSEFHUENNTlRfTUFTSyk7CisJdmlhX3JlYWQoZGV2X3By
aXYsIFZJQV9SRUdfVFJBTlNQQUNFKTsKKworCWRldl9wcml2LT5kbWFfZGlmZiA9IDA7CisK
Kwljb3VudCA9IDEwMDAwMDAwOworCXdoaWxlICghKHZpYV9yZWFkKGRldl9wcml2LCAweDQx
YykgJiAweDgwMDAwMDAwKSAmJiBjb3VudC0tKTsKKworCXJlYWRlciA9ICooZGV2X3ByaXYt
Pmh3X2FkZHJfcHRyKTsKKwlwdHIgPSAoKHZvbGF0aWxlIGNoYXIgKilkZXZfcHJpdi0+bGFz
dF9wYXVzZV9wdHIgLSBkZXZfcHJpdi0+ZG1hX3B0cikgKworCSAgICBkZXZfcHJpdi0+ZG1h
X29mZnNldCArICh1aW50MzJfdCkgZGV2X3ByaXYtPmFncEFkZHIgKyA0OworCisJLyoKKwkg
KiBUaGlzIGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gd2hlcmUgd2UgdGVsbCB0aGUKKwkg
KiBjb21tYW5kIHJlYWRlciB0byBwYXVzZSBhbmQgd2hlcmUgaXQgYWN0dWFsbHkgcGF1c2Vz
LgorCSAqIFRoaXMgZGlmZmVycyBiZXR3ZWVuIGh3IGltcGxlbWVudGF0aW9uIHNvIHdlIG5l
ZWQgdG8KKwkgKiBkZXRlY3QgaXQuCisJICovCisKKwlkZXZfcHJpdi0+ZG1hX2RpZmYgPSBw
dHIgLSByZWFkZXI7Cit9CisKK3N0YXRpYyB2b2lkIHZpYV9wYWRfY2FjaGUoZHJtX3ZpYV9w
cml2YXRlX3QgKmRldl9wcml2LCBpbnQgcXdvcmRzKQoreworCXVpbnQzMl90ICp2YjsKKwor
CXZpYV9jbWRidWZfd2FpdChkZXZfcHJpdiwgcXdvcmRzICsgMik7CisJdmIgPSB2aWFfZ2V0
X2RtYShkZXZfcHJpdik7CisJVklBX09VVF9SSU5HX1FXKEhDX0hFQURFUjIsIEhDX1BhcmFU
eXBlX05vdFRleCA8PCAxNik7CisJdmlhX2FsaWduX2J1ZmZlcihkZXZfcHJpdiwgdmIsIHF3
b3Jkcyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCB2aWFfZHVtbXlfYml0Ymx0KGRybV92
aWFfcHJpdmF0ZV90ICpkZXZfcHJpdikKK3sKKwl1aW50MzJfdCAqdmIgPSB2aWFfZ2V0X2Rt
YShkZXZfcHJpdik7CisJU2V0UmVnMkRBR1AoMHgwQywgKDAgfCAoMCA8PCAxNikpKTsKKwlT
ZXRSZWcyREFHUCgweDEwLCAwIHwgKDAgPDwgMTYpKTsKKwlTZXRSZWcyREFHUCgweDAsIDB4
MSB8IDB4MjAwMCB8IDB4QUEwMDAwMDApOworfQorCitzdGF0aWMgdm9pZCB2aWFfY21kYnVm
X2p1bXAoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQoreworCXVpbnQzMl90IHBhdXNl
X2FkZHJfbG8sIHBhdXNlX2FkZHJfaGk7CisJdWludDMyX3QganVtcF9hZGRyX2xvLCBqdW1w
X2FkZHJfaGk7CisJdm9sYXRpbGUgdWludDMyX3QgKmxhc3RfcGF1c2VfcHRyOworCXVpbnQz
Ml90IGRtYV9sb3dfc2F2ZTEsIGRtYV9sb3dfc2F2ZTI7CisKKwl2aWFfYWxpZ25fY21kKGRl
dl9wcml2LCBIQ19IQUdQQnBJRF9KVU1QLCAwLCAmanVtcF9hZGRyX2hpLAorCQkgICAgICAm
anVtcF9hZGRyX2xvLCAwKTsKKworCWRldl9wcml2LT5kbWFfd3JhcCA9IGRldl9wcml2LT5k
bWFfbG93OworCisJLyoKKwkgKiBXcmFwIGNvbW1hbmQgYnVmZmVyIHRvIHRoZSBiZWdpbm5p
bmcuCisJICovCisKKwlkZXZfcHJpdi0+ZG1hX2xvdyA9IDA7CisJaWYgKHZpYV9jbWRidWZf
d2FpdChkZXZfcHJpdiwgQ01EQlVGX0FMSUdOTUVOVF9TSVpFKSAhPSAwKQorCQlEUk1fRVJS
T1IoInZpYV9jbWRidWZfanVtcCBmYWlsZWRcbiIpOworCisJdmlhX2R1bW15X2JpdGJsdChk
ZXZfcHJpdik7CisJdmlhX2R1bW15X2JpdGJsdChkZXZfcHJpdik7CisKKwlsYXN0X3BhdXNl
X3B0ciA9CisJICAgIHZpYV9hbGlnbl9jbWQoZGV2X3ByaXYsIEhDX0hBR1BCcElEX1BBVVNF
LCAwLCAmcGF1c2VfYWRkcl9oaSwKKwkJCSAgJnBhdXNlX2FkZHJfbG8sIDApIC0gMTsKKwl2
aWFfYWxpZ25fY21kKGRldl9wcml2LCBIQ19IQUdQQnBJRF9QQVVTRSwgMCwgJnBhdXNlX2Fk
ZHJfaGksCisJCSAgICAgICZwYXVzZV9hZGRyX2xvLCAwKTsKKworCSpsYXN0X3BhdXNlX3B0
ciA9IHBhdXNlX2FkZHJfbG87CisJZG1hX2xvd19zYXZlMSA9IGRldl9wcml2LT5kbWFfbG93
OworCisJLyoKKwkgKiBOb3csIHNldCBhIHRyYXAgdGhhdCB3aWxsIHBhdXNlIHRoZSByZWd1
bGF0b3IgaWYgaXQgdHJpZXMgdG8gcmVydW4gdGhlIG9sZAorCSAqIGNvbW1hbmQgYnVmZmVy
LiAoV2hpY2ggbWF5IGhhcHBlbiBpZiB2aWFfaG9va19zZWdtZW50IGRldGVjcyBhIGNvbW1h
bmQgcmVndWxhdG9yIHBhdXNlCisJICogYW5kIHJlaXNzdWVzIHRoZSBqdW1wIGNvbW1hbmQg
b3ZlciBQQ0ksIHdoaWxlIHRoZSByZWd1bGF0b3IgaGFzIGFscmVhZHkgdGFrZW4gdGhlIGp1
bXAKKwkgKiBhbmQgYWN0dWFsbHkgcGF1c2VkIGF0IHRoZSBjdXJyZW50IGJ1ZmZlciBlbmQp
LgorCSAqIFRoZXJlIGFwcGVhcnMgdG8gYmUgbm8gb3RoZXIgd2F5IHRvIGRldGVjdCB0aGlz
IGNvbmRpdGlvbiwgc2luY2UgdGhlIGh3X2FkZHJfcG9pbnRlcgorCSAqIGRvZXMgbm90IHNl
ZW0gdG8gZ2V0IHVwZGF0ZWQgaW1tZWRpYXRlbHkgd2hlbiBhIGp1bXAgb2NjdXJzLgorCSAq
LworCisJbGFzdF9wYXVzZV9wdHIgPQorCQl2aWFfYWxpZ25fY21kKGRldl9wcml2LCBIQ19I
QUdQQnBJRF9QQVVTRSwgMCwgJnBhdXNlX2FkZHJfaGksCisJCQkgICAgICAmcGF1c2VfYWRk
cl9sbywgMCkgLSAxOworCXZpYV9hbGlnbl9jbWQoZGV2X3ByaXYsIEhDX0hBR1BCcElEX1BB
VVNFLCAwLCAmcGF1c2VfYWRkcl9oaSwKKwkJICAgICAgJnBhdXNlX2FkZHJfbG8sIDApOwor
CSpsYXN0X3BhdXNlX3B0ciA9IHBhdXNlX2FkZHJfbG87CisKKwlkbWFfbG93X3NhdmUyID0g
ZGV2X3ByaXYtPmRtYV9sb3c7CisJZGV2X3ByaXYtPmRtYV9sb3cgPSBkbWFfbG93X3NhdmUx
OworCXZpYV9ob29rX3NlZ21lbnQoZGV2X3ByaXYsIGp1bXBfYWRkcl9oaSwganVtcF9hZGRy
X2xvLCAwKTsKKwlkZXZfcHJpdi0+ZG1hX2xvdyA9IGRtYV9sb3dfc2F2ZTI7CisJdmlhX2hv
b2tfc2VnbWVudChkZXZfcHJpdiwgcGF1c2VfYWRkcl9oaSwgcGF1c2VfYWRkcl9sbywgMCk7
Cit9CisKKworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9yZXdpbmQoZHJtX3ZpYV9wcml2YXRl
X3QgKmRldl9wcml2KQoreworCXZpYV9jbWRidWZfanVtcChkZXZfcHJpdik7Cit9CisKK3N0
YXRpYyB2b2lkIHZpYV9jbWRidWZfZmx1c2goZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
LCB1aW50MzJfdCBjbWRfdHlwZSkKK3sKKwl1aW50MzJfdCBwYXVzZV9hZGRyX2xvLCBwYXVz
ZV9hZGRyX2hpOworCisJdmlhX2FsaWduX2NtZChkZXZfcHJpdiwgY21kX3R5cGUsIDAsICZw
YXVzZV9hZGRyX2hpLCAmcGF1c2VfYWRkcl9sbywgMCk7CisJdmlhX2hvb2tfc2VnbWVudChk
ZXZfcHJpdiwgcGF1c2VfYWRkcl9oaSwgcGF1c2VfYWRkcl9sbywgMCk7Cit9CisKK3N0YXRp
YyB2b2lkIHZpYV9jbWRidWZfcGF1c2UoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQor
eworCXZpYV9jbWRidWZfZmx1c2goZGV2X3ByaXYsIEhDX0hBR1BCcElEX1BBVVNFKTsKK30K
Kworc3RhdGljIHZvaWQgdmlhX2NtZGJ1Zl9yZXNldChkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYpCit7CisJdmlhX2NtZGJ1Zl9mbHVzaChkZXZfcHJpdiwgSENfSEFHUEJwSURfU1RP
UCk7CisJdmlhX3dhaXRfaWRsZShkZXZfcHJpdik7Cit9CisKKy8qCisgKiBVc2VyIGludGVy
ZmFjZSB0byB0aGUgc3BhY2UgYW5kIGxhZyBmdW5jdGlvbnMuCisgKi8KKworc3RhdGljIGlu
dCB2aWFfY21kYnVmX3NpemUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwg
c3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCit7CisJZHJtX3ZpYV9jbWRidWZfc2l6ZV90
ICpkX3NpeiA9IGRhdGE7CisJaW50IHJldCA9IDA7CisJdWludDMyX3QgdG1wX3NpemUsIGNv
dW50OworCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdjsKKworCURSTV9ERUJVRygiXG4i
KTsKKwlMT0NLX1RFU1RfV0lUSF9SRVRVUk4oZGV2LCBmaWxlX3ByaXYpOworCisJZGV2X3By
aXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKKworCWlmIChk
ZXZfcHJpdi0+cmluZy52aXJ0dWFsX3N0YXJ0ID09IE5VTEwpIHsKKwkJRFJNX0VSUk9SKCJj
YWxsZWQgd2l0aG91dCBpbml0aWFsaXppbmcgQUdQIHJpbmcgYnVmZmVyLlxuIik7CisJCXJl
dHVybiAtRUZBVUxUOworCX0KKworCWNvdW50ID0gMTAwMDAwMDsKKwl0bXBfc2l6ZSA9IGRf
c2l6LT5zaXplOworCXN3aXRjaCAoZF9zaXotPmZ1bmMpIHsKKwljYXNlIFZJQV9DTURCVUZf
U1BBQ0U6CisJCXdoaWxlICgoKHRtcF9zaXplID0gdmlhX2NtZGJ1Zl9zcGFjZShkZXZfcHJp
dikpIDwgZF9zaXotPnNpemUpCisJCSAgICAgICAmJiAtLWNvdW50KSB7CisJCQlpZiAoIWRf
c2l6LT53YWl0KQorCQkJCWJyZWFrOworCQl9CisJCWlmICghY291bnQpIHsKKwkJCURSTV9F
UlJPUigiVklBX0NNREJVRl9TUEFDRSB0aW1lZCBvdXQuXG4iKTsKKwkJCXJldCA9IC1FQUdB
SU47CisJCX0KKwkJYnJlYWs7CisJY2FzZSBWSUFfQ01EQlVGX0xBRzoKKwkJd2hpbGUgKCgo
dG1wX3NpemUgPSB2aWFfY21kYnVmX2xhZyhkZXZfcHJpdikpID4gZF9zaXotPnNpemUpCisJ
CSAgICAgICAmJiAtLWNvdW50KSB7CisJCQlpZiAoIWRfc2l6LT53YWl0KQorCQkJCWJyZWFr
OworCQl9CisJCWlmICghY291bnQpIHsKKwkJCURSTV9FUlJPUigiVklBX0NNREJVRl9MQUcg
dGltZWQgb3V0LlxuIik7CisJCQlyZXQgPSAtRUFHQUlOOworCQl9CisJCWJyZWFrOworCWRl
ZmF1bHQ6CisJCXJldCA9IC1FRkFVTFQ7CisJfQorCWRfc2l6LT5zaXplID0gdG1wX3NpemU7
CisKKwlyZXR1cm4gcmV0OworfQorCitjb25zdCBzdHJ1Y3QgZHJtX2lvY3RsX2Rlc2Mgdmlh
X2lvY3Rsc1tdID0geworCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9BTExPQ01FTSwgdmlhX21l
bV9hbGxvYywgRFJNX0FVVEgpLAorCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9GUkVFTUVNLCB2
aWFfbWVtX2ZyZWUsIERSTV9BVVRIKSwKKwlEUk1fSU9DVExfREVGX0RSVihWSUFfQUdQX0lO
SVQsIHZpYV9hZ3BfaW5pdCwgRFJNX0FVVEh8RFJNX01BU1RFUiksCisJRFJNX0lPQ1RMX0RF
Rl9EUlYoVklBX0ZCX0lOSVQsIHZpYV9mYl9pbml0LCBEUk1fQVVUSHxEUk1fTUFTVEVSKSwK
KwlEUk1fSU9DVExfREVGX0RSVihWSUFfTUFQX0lOSVQsIHZpYV9tYXBfaW5pdCwgRFJNX0FV
VEh8RFJNX01BU1RFUiksCisJRFJNX0lPQ1RMX0RFRl9EUlYoVklBX0RFQ19GVVRFWCwgdmlh
X2RlY29kZXJfZnV0ZXgsIERSTV9BVVRIKSwKKwlEUk1fSU9DVExfREVGX0RSVihWSUFfRE1B
X0lOSVQsIHZpYV9kbWFfaW5pdCwgRFJNX0FVVEgpLAorCURSTV9JT0NUTF9ERUZfRFJWKFZJ
QV9DTURCVUZGRVIsIHZpYV9jbWRidWZmZXIsIERSTV9BVVRIKSwKKwlEUk1fSU9DVExfREVG
X0RSVihWSUFfRkxVU0gsIHZpYV9mbHVzaF9pb2N0bCwgRFJNX0FVVEgpLAorCURSTV9JT0NU
TF9ERUZfRFJWKFZJQV9QQ0lDTUQsIHZpYV9wY2lfY21kYnVmZmVyLCBEUk1fQVVUSCksCisJ
RFJNX0lPQ1RMX0RFRl9EUlYoVklBX0NNREJVRl9TSVpFLCB2aWFfY21kYnVmX3NpemUsIERS
TV9BVVRIKSwKKwlEUk1fSU9DVExfREVGX0RSVihWSUFfV0FJVF9JUlEsIHZpYV93YWl0X2ly
cSwgRFJNX0FVVEgpLAorCURSTV9JT0NUTF9ERUZfRFJWKFZJQV9ETUFfQkxJVCwgdmlhX2Rt
YV9ibGl0LCBEUk1fQVVUSCksCisJRFJNX0lPQ1RMX0RFRl9EUlYoVklBX0JMSVRfU1lOQywg
dmlhX2RtYV9ibGl0X3N5bmMsIERSTV9BVVRIKQorfTsKKworaW50IHZpYV9tYXhfaW9jdGwg
PSBBUlJBWV9TSVpFKHZpYV9pb2N0bHMpOworCisKKy8qCisgKiB2aWFfZG1hYmxpdC5jIC0t
IFBDSSBETUEgQml0Qmx0IHN1cHBvcnQgZm9yIHRoZSBWSUEgVW5pY2hyb21lL1BybworICoK
KyAqIENvcHlyaWdodCAoQykgMjAwNSBUaG9tYXMgSGVsbHN0cm9tLCBBbGwgUmlnaHRzIFJl
c2VydmVkLgorICoKKyAqIEF1dGhvcnM6CisgKiAgICBUaG9tYXMgSGVsbHN0cm9tLgorICog
ICAgUGFydGlhbGx5IGJhc2VkIG9uIGNvZGUgb2J0YWluZWQgZnJvbSBEaWdlbyBJbmMuCisg
Ki8KKworLyoKKyAqIFVubWFwcyB0aGUgRE1BIG1hcHBpbmdzLgorICogRklYTUU6IElzIHRo
aXMgYSBOb09wIG9uIHg4Nj8gQWxzbworICogRklYTUU6IFdoYXQgaGFwcGVucyBpZiB0aGlz
IG9uZSBpcyBjYWxsZWQgYW5kIGEgcGVuZGluZyBibGl0IGhhcyBwcmV2aW91c2x5IGRvbmUK
KyAqIHRoZSBzYW1lIERNQSBtYXBwaW5ncz8KKyAqLworCisjZGVmaW5lIFZJQV9QR0ROKHgp
CSAgICAgKCgodW5zaWduZWQgbG9uZykoeCkpICYgUEFHRV9NQVNLKQorI2RlZmluZSBWSUFf
UEdPRkYoeCkJICAgICgoKHVuc2lnbmVkIGxvbmcpKHgpKSAmIH5QQUdFX01BU0spCisjZGVm
aW5lIFZJQV9QRk4oeCkJICAgICAgKCh1bnNpZ25lZCBsb25nKSh4KSA+PiBQQUdFX1NISUZU
KQorCit0eXBlZGVmIHN0cnVjdCBfZHJtX3ZpYV9kZXNjcmlwdG9yIHsKKwl1aW50MzJfdCBt
ZW1fYWRkcjsKKwl1aW50MzJfdCBkZXZfYWRkcjsKKwl1aW50MzJfdCBzaXplOworCXVpbnQz
Ml90IG5leHQ7Cit9IGRybV92aWFfZGVzY3JpcHRvcl90OworCisKKy8qCisgKiBVbm1hcCBh
IERNQSBtYXBwaW5nLgorICovCisKKworCitzdGF0aWMgdm9pZAordmlhX3VubWFwX2JsaXRf
ZnJvbV9kZXZpY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGRybV92aWFfc2dfaW5mb190ICp2
c2cpCit7CisJaW50IG51bV9kZXNjID0gdnNnLT5udW1fZGVzYzsKKwl1bnNpZ25lZCBjdXJf
ZGVzY3JpcHRvcl9wYWdlID0gbnVtX2Rlc2MgLyB2c2ctPmRlc2NyaXB0b3JzX3Blcl9wYWdl
OworCXVuc2lnbmVkIGRlc2NyaXB0b3JfdGhpc19wYWdlID0gbnVtX2Rlc2MgJSB2c2ctPmRl
c2NyaXB0b3JzX3Blcl9wYWdlOworCWRybV92aWFfZGVzY3JpcHRvcl90ICpkZXNjX3B0ciA9
IHZzZy0+ZGVzY19wYWdlc1tjdXJfZGVzY3JpcHRvcl9wYWdlXSArCisJCWRlc2NyaXB0b3Jf
dGhpc19wYWdlOworCWRtYV9hZGRyX3QgbmV4dCA9IHZzZy0+Y2hhaW5fc3RhcnQ7CisKKwl3
aGlsZSAobnVtX2Rlc2MtLSkgeworCQlpZiAoZGVzY3JpcHRvcl90aGlzX3BhZ2UtLSA9PSAw
KSB7CisJCQljdXJfZGVzY3JpcHRvcl9wYWdlLS07CisJCQlkZXNjcmlwdG9yX3RoaXNfcGFn
ZSA9IHZzZy0+ZGVzY3JpcHRvcnNfcGVyX3BhZ2UgLSAxOworCQkJZGVzY19wdHIgPSB2c2ct
PmRlc2NfcGFnZXNbY3VyX2Rlc2NyaXB0b3JfcGFnZV0gKworCQkJCWRlc2NyaXB0b3JfdGhp
c19wYWdlOworCQl9CisJCWRtYV91bm1hcF9zaW5nbGUoJnBkZXYtPmRldiwgbmV4dCwgc2l6
ZW9mKCpkZXNjX3B0ciksIERNQV9UT19ERVZJQ0UpOworCQlkbWFfdW5tYXBfcGFnZSgmcGRl
di0+ZGV2LCBkZXNjX3B0ci0+bWVtX2FkZHIsIGRlc2NfcHRyLT5zaXplLCB2c2ctPmRpcmVj
dGlvbik7CisJCW5leHQgPSAoZG1hX2FkZHJfdCkgZGVzY19wdHItPm5leHQ7CisJCWRlc2Nf
cHRyLS07CisJfQorfQorCisvKgorICogSWYgbW9kZSA9IDAsIGNvdW50IGhvdyBtYW55IGRl
c2NyaXB0b3JzIGFyZSBuZWVkZWQuCisgKiBJZiBtb2RlID0gMSwgTWFwIHRoZSBETUEgcGFn
ZXMgZm9yIHRoZSBkZXZpY2UsIHB1dCB0b2dldGhlciBhbmQgbWFwIGFsc28gdGhlIGRlc2Ny
aXB0b3JzLgorICogRGVzY3JpcHRvcnMgYXJlIHJ1biBpbiByZXZlcnNlIG9yZGVyIGJ5IHRo
ZSBoYXJkd2FyZSBiZWNhdXNlIHdlIGFyZSBub3QgYWxsb3dlZCB0byB1cGRhdGUgdGhlCisg
KiAnbmV4dCcgZmllbGQgd2l0aG91dCBzeW5jaW5nIGNhbGxzIHdoZW4gdGhlIGRlc2NyaXB0
b3IgaXMgYWxyZWFkeSBtYXBwZWQuCisgKi8KKworc3RhdGljIHZvaWQKK3ZpYV9tYXBfYmxp
dF9mb3JfZGV2aWNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LAorCQkgICBjb25zdCBkcm1fdmlh
X2RtYWJsaXRfdCAqeGZlciwKKwkJICAgZHJtX3ZpYV9zZ19pbmZvX3QgKnZzZywKKwkJICAg
aW50IG1vZGUpCit7CisJdW5zaWduZWQgY3VyX2Rlc2NyaXB0b3JfcGFnZSA9IDA7CisJdW5z
aWduZWQgbnVtX2Rlc2NyaXB0b3JzX3RoaXNfcGFnZSA9IDA7CisJdW5zaWduZWQgY2hhciAq
bWVtX2FkZHIgPSB4ZmVyLT5tZW1fYWRkcjsKKwl1bnNpZ25lZCBjaGFyICpjdXJfbWVtOwor
CXVuc2lnbmVkIGNoYXIgKmZpcnN0X2FkZHIgPSAodW5zaWduZWQgY2hhciAqKVZJQV9QR0RO
KG1lbV9hZGRyKTsKKwl1aW50MzJfdCBmYl9hZGRyID0geGZlci0+ZmJfYWRkcjsKKwl1aW50
MzJfdCBjdXJfZmI7CisJdW5zaWduZWQgbG9uZyBsaW5lX2xlbjsKKwl1bnNpZ25lZCByZW1h
aW5pbmdfbGVuOworCWludCBudW1fZGVzYyA9IDA7CisJaW50IGN1cl9saW5lOworCWRtYV9h
ZGRyX3QgbmV4dCA9IDAgfCBWSUFfRE1BX0RQUl9FQzsKKwlkcm1fdmlhX2Rlc2NyaXB0b3Jf
dCAqZGVzY19wdHIgPSBOVUxMOworCisJaWYgKG1vZGUgPT0gMSkKKwkJZGVzY19wdHIgPSB2
c2ctPmRlc2NfcGFnZXNbY3VyX2Rlc2NyaXB0b3JfcGFnZV07CisKKwlmb3IgKGN1cl9saW5l
ID0gMDsgY3VyX2xpbmUgPCB4ZmVyLT5udW1fbGluZXM7ICsrY3VyX2xpbmUpIHsKKworCQls
aW5lX2xlbiA9IHhmZXItPmxpbmVfbGVuZ3RoOworCQljdXJfZmIgPSBmYl9hZGRyOworCQlj
dXJfbWVtID0gbWVtX2FkZHI7CisKKwkJd2hpbGUgKGxpbmVfbGVuID4gMCkgeworCisJCQly
ZW1haW5pbmdfbGVuID0gbWluKFBBR0VfU0laRS1WSUFfUEdPRkYoY3VyX21lbSksIGxpbmVf
bGVuKTsKKwkJCWxpbmVfbGVuIC09IHJlbWFpbmluZ19sZW47CisKKwkJCWlmIChtb2RlID09
IDEpIHsKKwkJCQlkZXNjX3B0ci0+bWVtX2FkZHIgPQorCQkJCQlkbWFfbWFwX3BhZ2UoJnBk
ZXYtPmRldiwKKwkJCQkJCSAgICAgdnNnLT5wYWdlc1tWSUFfUEZOKGN1cl9tZW0pIC0KKwkJ
CQkJCQkJVklBX1BGTihmaXJzdF9hZGRyKV0sCisJCQkJCQkgICAgIFZJQV9QR09GRihjdXJf
bWVtKSwgcmVtYWluaW5nX2xlbiwKKwkJCQkJCSAgICAgdnNnLT5kaXJlY3Rpb24pOworCQkJ
CWRlc2NfcHRyLT5kZXZfYWRkciA9IGN1cl9mYjsKKworCQkJCWRlc2NfcHRyLT5zaXplID0g
cmVtYWluaW5nX2xlbjsKKwkJCQlkZXNjX3B0ci0+bmV4dCA9ICh1aW50MzJfdCkgbmV4dDsK
KwkJCQluZXh0ID0gZG1hX21hcF9zaW5nbGUoJnBkZXYtPmRldiwgZGVzY19wdHIsIHNpemVv
ZigqZGVzY19wdHIpLAorCQkJCQkJICAgICAgRE1BX1RPX0RFVklDRSk7CisJCQkJZGVzY19w
dHIrKzsKKwkJCQlpZiAoKytudW1fZGVzY3JpcHRvcnNfdGhpc19wYWdlID49IHZzZy0+ZGVz
Y3JpcHRvcnNfcGVyX3BhZ2UpIHsKKwkJCQkJbnVtX2Rlc2NyaXB0b3JzX3RoaXNfcGFnZSA9
IDA7CisJCQkJCWRlc2NfcHRyID0gdnNnLT5kZXNjX3BhZ2VzWysrY3VyX2Rlc2NyaXB0b3Jf
cGFnZV07CisJCQkJfQorCQkJfQorCisJCQludW1fZGVzYysrOworCQkJY3VyX21lbSArPSBy
ZW1haW5pbmdfbGVuOworCQkJY3VyX2ZiICs9IHJlbWFpbmluZ19sZW47CisJCX0KKworCQlt
ZW1fYWRkciArPSB4ZmVyLT5tZW1fc3RyaWRlOworCQlmYl9hZGRyICs9IHhmZXItPmZiX3N0
cmlkZTsKKwl9CisKKwlpZiAobW9kZSA9PSAxKSB7CisJCXZzZy0+Y2hhaW5fc3RhcnQgPSBu
ZXh0OworCQl2c2ctPnN0YXRlID0gZHJfdmlhX2RldmljZV9tYXBwZWQ7CisJfQorCXZzZy0+
bnVtX2Rlc2MgPSBudW1fZGVzYzsKK30KKworLyoKKyAqIEZ1bmN0aW9uIHRoYXQgZnJlZXMg
dXAgYWxsIHJlc291cmNlcyBmb3IgYSBibGl0LiBJdCBpcyB1c2FibGUgZXZlbiBpZiB0aGUK
KyAqIGJsaXQgaW5mbyBoYXMgb25seSBiZWVuIHBhcnRpYWxseSBidWlsdCBhcyBsb25nIGFz
IHRoZSBzdGF0dXMgZW51bSBpcyBjb25zaXN0ZW50CisgKiB3aXRoIHRoZSBhY3R1YWwgc3Rh
dHVzIG9mIHRoZSB1c2VkIHJlc291cmNlcy4KKyAqLworCisKK3N0YXRpYyB2b2lkCit2aWFf
ZnJlZV9zZ19pbmZvKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBkcm1fdmlhX3NnX2luZm9fdCAq
dnNnKQoreworCWludCBpOworCisJc3dpdGNoICh2c2ctPnN0YXRlKSB7CisJY2FzZSBkcl92
aWFfZGV2aWNlX21hcHBlZDoKKwkJdmlhX3VubWFwX2JsaXRfZnJvbV9kZXZpY2UocGRldiwg
dnNnKTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBkcl92aWFfZGVzY19wYWdlc19hbGxvYzoK
KwkJZm9yIChpID0gMDsgaSA8IHZzZy0+bnVtX2Rlc2NfcGFnZXM7ICsraSkgeworCQkJaWYg
KHZzZy0+ZGVzY19wYWdlc1tpXSAhPSBOVUxMKQorCQkJCWZyZWVfcGFnZSgodW5zaWduZWQg
bG9uZyl2c2ctPmRlc2NfcGFnZXNbaV0pOworCQl9CisJCWtmcmVlKHZzZy0+ZGVzY19wYWdl
cyk7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgZHJfdmlhX3BhZ2VzX2xvY2tlZDoKKwkJdW5w
aW5fdXNlcl9wYWdlc19kaXJ0eV9sb2NrKHZzZy0+cGFnZXMsIHZzZy0+bnVtX3BhZ2VzLAor
CQkJCQkgICAodnNnLT5kaXJlY3Rpb24gPT0gRE1BX0ZST01fREVWSUNFKSk7CisJCWZhbGx0
aHJvdWdoOworCWNhc2UgZHJfdmlhX3BhZ2VzX2FsbG9jOgorCQl2ZnJlZSh2c2ctPnBhZ2Vz
KTsKKwkJZmFsbHRocm91Z2g7CisJZGVmYXVsdDoKKwkJdnNnLT5zdGF0ZSA9IGRyX3ZpYV9z
Z19pbml0OworCX0KKwl2ZnJlZSh2c2ctPmJvdW5jZV9idWZmZXIpOworCXZzZy0+Ym91bmNl
X2J1ZmZlciA9IE5VTEw7CisJdnNnLT5mcmVlX29uX3NlcXVlbmNlID0gMDsKK30KKworLyoK
KyAqIEZpcmUgYSBibGl0IGVuZ2luZS4KKyAqLworCitzdGF0aWMgdm9pZAordmlhX2ZpcmVf
ZG1hYmxpdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBkcm1fdmlhX3NnX2luZm9fdCAqdnNn
LCBpbnQgZW5naW5lKQoreworCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1f
dmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGU7CisKKwl2aWFfd3JpdGUoZGV2X3By
aXYsIFZJQV9QQ0lfRE1BX01BUjAgKyBlbmdpbmUqMHgxMCwgMCk7CisJdmlhX3dyaXRlKGRl
dl9wcml2LCBWSUFfUENJX0RNQV9EQVIwICsgZW5naW5lKjB4MTAsIDApOworCXZpYV93cml0
ZShkZXZfcHJpdiwgVklBX1BDSV9ETUFfQ1NSMCArIGVuZ2luZSoweDA0LCBWSUFfRE1BX0NT
Ul9ERCB8IFZJQV9ETUFfQ1NSX1REIHwKKwkJICBWSUFfRE1BX0NTUl9ERSk7CisJdmlhX3dy
aXRlKGRldl9wcml2LCBWSUFfUENJX0RNQV9NUjAgICsgZW5naW5lKjB4MDQsIFZJQV9ETUFf
TVJfQ00gfCBWSUFfRE1BX01SX1RESUUpOworCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1BD
SV9ETUFfQkNSMCArIGVuZ2luZSoweDEwLCAwKTsKKwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJ
QV9QQ0lfRE1BX0RQUjAgKyBlbmdpbmUqMHgxMCwgdnNnLT5jaGFpbl9zdGFydCk7CisJd21i
KCk7CisJdmlhX3dyaXRlKGRldl9wcml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4
MDQsIFZJQV9ETUFfQ1NSX0RFIHwgVklBX0RNQV9DU1JfVFMpOworCXZpYV9yZWFkKGRldl9w
cml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4MDQpOworfQorCisvKgorICogT2J0
YWluIGEgcGFnZSBwb2ludGVyIGFycmF5IGFuZCBsb2NrIGFsbCBwYWdlcyBpbnRvIHN5c3Rl
bSBtZW1vcnkuIEEgc2VnbWVudGF0aW9uIHZpb2xhdGlvbiB3aWxsCisgKiBvY2N1ciBoZXJl
IGlmIHRoZSBjYWxsaW5nIHVzZXIgZG9lcyBub3QgaGF2ZSBhY2Nlc3MgdG8gdGhlIHN1Ym1p
dHRlZCBhZGRyZXNzLgorICovCisKK3N0YXRpYyBpbnQKK3ZpYV9sb2NrX2FsbF9kbWFfcGFn
ZXMoZHJtX3ZpYV9zZ19pbmZvX3QgKnZzZywgIGRybV92aWFfZG1hYmxpdF90ICp4ZmVyKQor
eworCWludCByZXQ7CisJdW5zaWduZWQgbG9uZyBmaXJzdF9wZm4gPSBWSUFfUEZOKHhmZXIt
Pm1lbV9hZGRyKTsKKwl2c2ctPm51bV9wYWdlcyA9IFZJQV9QRk4oeGZlci0+bWVtX2FkZHIg
KyAoeGZlci0+bnVtX2xpbmVzICogeGZlci0+bWVtX3N0cmlkZSAtIDEpKSAtCisJCWZpcnN0
X3BmbiArIDE7CisKKwl2c2ctPnBhZ2VzID0gdnphbGxvYyhhcnJheV9zaXplKHNpemVvZihz
dHJ1Y3QgcGFnZSAqKSwgdnNnLT5udW1fcGFnZXMpKTsKKwlpZiAoTlVMTCA9PSB2c2ctPnBh
Z2VzKQorCQlyZXR1cm4gLUVOT01FTTsKKwlyZXQgPSBwaW5fdXNlcl9wYWdlc19mYXN0KCh1
bnNpZ25lZCBsb25nKXhmZXItPm1lbV9hZGRyLAorCQkJdnNnLT5udW1fcGFnZXMsCisJCQl2
c2ctPmRpcmVjdGlvbiA9PSBETUFfRlJPTV9ERVZJQ0UgPyBGT0xMX1dSSVRFIDogMCwKKwkJ
CXZzZy0+cGFnZXMpOworCWlmIChyZXQgIT0gdnNnLT5udW1fcGFnZXMpIHsKKwkJaWYgKHJl
dCA8IDApCisJCQlyZXR1cm4gcmV0OworCQl2c2ctPnN0YXRlID0gZHJfdmlhX3BhZ2VzX2xv
Y2tlZDsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCXZzZy0+c3RhdGUgPSBkcl92aWFfcGFn
ZXNfbG9ja2VkOworCURSTV9ERUJVRygiRE1BIHBhZ2VzIGxvY2tlZFxuIik7CisJcmV0dXJu
IDA7Cit9CisKKy8qCisgKiBBbGxvY2F0ZSBETUEgY2FwYWJsZSBtZW1vcnkgZm9yIHRoZSBi
bGl0IGRlc2NyaXB0b3IgY2hhaW4sIGFuZCBhbiBhcnJheSB0aGF0IGtlZXBzIHRyYWNrIG9m
IHRoZQorICogcGFnZXMgd2UgYWxsb2NhdGUuIFdlIGRvbid0IHdhbnQgdG8gdXNlIGttYWxs
b2MgZm9yIHRoZSBkZXNjcmlwdG9yIGNoYWluIGJlY2F1c2UgaXQgbWF5IGJlCisgKiBxdWl0
ZSBsYXJnZSBmb3Igc29tZSBibGl0cywgYW5kIHBhZ2VzIGRvbid0IG5lZWQgdG8gYmUgY29u
dGlndW91cy4KKyAqLworCitzdGF0aWMgaW50Cit2aWFfYWxsb2NfZGVzY19wYWdlcyhkcm1f
dmlhX3NnX2luZm9fdCAqdnNnKQoreworCWludCBpOworCisJdnNnLT5kZXNjcmlwdG9yc19w
ZXJfcGFnZSA9IFBBR0VfU0laRSAvIHNpemVvZihkcm1fdmlhX2Rlc2NyaXB0b3JfdCk7CisJ
dnNnLT5udW1fZGVzY19wYWdlcyA9ICh2c2ctPm51bV9kZXNjICsgdnNnLT5kZXNjcmlwdG9y
c19wZXJfcGFnZSAtIDEpIC8KKwkJdnNnLT5kZXNjcmlwdG9yc19wZXJfcGFnZTsKKworCWlm
IChOVUxMID09ICAodnNnLT5kZXNjX3BhZ2VzID0ga2NhbGxvYyh2c2ctPm51bV9kZXNjX3Bh
Z2VzLCBzaXplb2Yodm9pZCAqKSwgR0ZQX0tFUk5FTCkpKQorCQlyZXR1cm4gLUVOT01FTTsK
KworCXZzZy0+c3RhdGUgPSBkcl92aWFfZGVzY19wYWdlc19hbGxvYzsKKwlmb3IgKGkgPSAw
OyBpIDwgdnNnLT5udW1fZGVzY19wYWdlczsgKytpKSB7CisJCWlmIChOVUxMID09ICh2c2ct
PmRlc2NfcGFnZXNbaV0gPQorCQkJICAgICAoZHJtX3ZpYV9kZXNjcmlwdG9yX3QgKikgX19n
ZXRfZnJlZV9wYWdlKEdGUF9LRVJORUwpKSkKKwkJCXJldHVybiAtRU5PTUVNOworCX0KKwlE
Uk1fREVCVUcoIkFsbG9jYXRlZCAlZCBwYWdlcyBmb3IgJWQgZGVzY3JpcHRvcnMuXG4iLCB2
c2ctPm51bV9kZXNjX3BhZ2VzLAorCQkgIHZzZy0+bnVtX2Rlc2MpOworCXJldHVybiAwOwor
fQorCitzdGF0aWMgdm9pZAordmlhX2Fib3J0X2RtYWJsaXQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgaW50IGVuZ2luZSkKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAo
ZHJtX3ZpYV9wcml2YXRlX3QgKilkZXYtPmRldl9wcml2YXRlOworCisJdmlhX3dyaXRlKGRl
dl9wcml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4MDQsIFZJQV9ETUFfQ1NSX1RB
KTsKK30KKworc3RhdGljIHZvaWQKK3ZpYV9kbWFibGl0X2VuZ2luZV9vZmYoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgaW50IGVuZ2luZSkKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKilkZXYtPmRldl9wcml2YXRlOworCisJdmlh
X3dyaXRlKGRldl9wcml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4MDQsIFZJQV9E
TUFfQ1NSX1REIHwgVklBX0RNQV9DU1JfREQpOworfQorCisKKworLyoKKyAqIFRoZSBkbWFi
bGl0IHBhcnQgb2YgdGhlIElSUSBoYW5kbGVyLiBUcnlpbmcgdG8gZG8gb25seSByZWFzb25h
Ymx5IGZhc3QgdGhpbmdzIGhlcmUuCisgKiBUaGUgcmVzdCwgbGlrZSB1bm1hcHBpbmcgYW5k
IGZyZWVpbmcgbWVtb3J5IGZvciBkb25lIGJsaXRzIGlzIGRvbmUgaW4gYSBzZXBhcmF0ZSB3
b3JrcXVldWUKKyAqIHRhc2suIEJhc2ljYWxseSB0aGUgdGFzayBvZiB0aGUgaW50ZXJydXB0
IGhhbmRsZXIgaXMgdG8gc3VibWl0IGEgbmV3IGJsaXQgdG8gdGhlIGVuZ2luZSwgd2hpbGUK
KyAqIHRoZSB3b3JrcXVldWUgdGFzayB0YWtlcyBjYXJlIG9mIHByb2Nlc3NpbmcgYXNzb2Np
YXRlZCB3aXRoIHRoZSBvbGQgYmxpdC4KKyAqLworCit2b2lkCit2aWFfZG1hYmxpdF9oYW5k
bGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGludCBlbmdpbmUsIGludCBmcm9tX2lycSkK
K3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3Qg
KilkZXYtPmRldl9wcml2YXRlOworCWRybV92aWFfYmxpdHFfdCAqYmxpdHEgPSBkZXZfcHJp
di0+YmxpdF9xdWV1ZXMgKyBlbmdpbmU7CisJaW50IGN1cjsKKwlpbnQgZG9uZV90cmFuc2Zl
cjsKKwl1bnNpZ25lZCBsb25nIGlycXNhdmUgPSAwOworCXVpbnQzMl90IHN0YXR1cyA9IDA7
CisKKwlEUk1fREVCVUcoIkRNQSBibGl0IGhhbmRsZXIgY2FsbGVkLiBlbmdpbmUgPSAlZCwg
ZnJvbV9pcnEgPSAlZCwgYmxpdHEgPSAweCVseFxuIiwKKwkJICBlbmdpbmUsIGZyb21faXJx
LCAodW5zaWduZWQgbG9uZykgYmxpdHEpOworCisJaWYgKGZyb21faXJxKQorCQlzcGluX2xv
Y2soJmJsaXRxLT5ibGl0X2xvY2spOworCWVsc2UKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmJs
aXRxLT5ibGl0X2xvY2ssIGlycXNhdmUpOworCisJZG9uZV90cmFuc2ZlciA9IGJsaXRxLT5p
c19hY3RpdmUgJiYKKwkgICgoc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9QQ0lf
RE1BX0NTUjAgKyBlbmdpbmUqMHgwNCkpICYgVklBX0RNQV9DU1JfVEQpOworCWRvbmVfdHJh
bnNmZXIgPSBkb25lX3RyYW5zZmVyIHx8IChibGl0cS0+YWJvcnRpbmcgJiYgIShzdGF0dXMg
JiBWSUFfRE1BX0NTUl9ERSkpOworCisJY3VyID0gYmxpdHEtPmN1cjsKKwlpZiAoZG9uZV90
cmFuc2ZlcikgeworCisJCWJsaXRxLT5ibGl0c1tjdXJdLT5hYm9ydGVkID0gYmxpdHEtPmFi
b3J0aW5nOworCQlibGl0cS0+ZG9uZV9ibGl0X2hhbmRsZSsrOworCQl3YWtlX3VwKGJsaXRx
LT5ibGl0X3F1ZXVlICsgY3VyKTsKKworCQljdXIrKzsKKwkJaWYgKGN1ciA+PSBWSUFfTlVN
X0JMSVRfU0xPVFMpCisJCQljdXIgPSAwOworCQlibGl0cS0+Y3VyID0gY3VyOworCisJCS8q
CisJCSAqIENsZWFyIHRyYW5zZmVyIGRvbmUgZmxhZy4KKwkJICovCisKKwkJdmlhX3dyaXRl
KGRldl9wcml2LCBWSUFfUENJX0RNQV9DU1IwICsgZW5naW5lKjB4MDQsICBWSUFfRE1BX0NT
Ul9URCk7CisKKwkJYmxpdHEtPmlzX2FjdGl2ZSA9IDA7CisJCWJsaXRxLT5hYm9ydGluZyA9
IDA7CisJCXNjaGVkdWxlX3dvcmsoJmJsaXRxLT53cSk7CisKKwl9IGVsc2UgaWYgKGJsaXRx
LT5pc19hY3RpdmUgJiYgdGltZV9hZnRlcl9lcShqaWZmaWVzLCBibGl0cS0+ZW5kKSkgewor
CisJCS8qCisJCSAqIEFib3J0IHRyYW5zZmVyIGFmdGVyIG9uZSBzZWNvbmQuCisJCSAqLwor
CisJCXZpYV9hYm9ydF9kbWFibGl0KGRldiwgZW5naW5lKTsKKwkJYmxpdHEtPmFib3J0aW5n
ID0gMTsKKwkJYmxpdHEtPmVuZCA9IGppZmZpZXMgKyBIWjsKKwl9CisKKwlpZiAoIWJsaXRx
LT5pc19hY3RpdmUpIHsKKwkJaWYgKGJsaXRxLT5udW1fb3V0c3RhbmRpbmcpIHsKKwkJCXZp
YV9maXJlX2RtYWJsaXQoZGV2LCBibGl0cS0+YmxpdHNbY3VyXSwgZW5naW5lKTsKKwkJCWJs
aXRxLT5pc19hY3RpdmUgPSAxOworCQkJYmxpdHEtPmN1ciA9IGN1cjsKKwkJCWJsaXRxLT5u
dW1fb3V0c3RhbmRpbmctLTsKKwkJCWJsaXRxLT5lbmQgPSBqaWZmaWVzICsgSFo7CisJCQlp
ZiAoIXRpbWVyX3BlbmRpbmcoJmJsaXRxLT5wb2xsX3RpbWVyKSkKKwkJCQltb2RfdGltZXIo
JmJsaXRxLT5wb2xsX3RpbWVyLCBqaWZmaWVzICsgMSk7CisJCX0gZWxzZSB7CisJCQlpZiAo
dGltZXJfcGVuZGluZygmYmxpdHEtPnBvbGxfdGltZXIpKQorCQkJCWRlbF90aW1lcigmYmxp
dHEtPnBvbGxfdGltZXIpOworCQkJdmlhX2RtYWJsaXRfZW5naW5lX29mZihkZXYsIGVuZ2lu
ZSk7CisJCX0KKwl9CisKKwlpZiAoZnJvbV9pcnEpCisJCXNwaW5fdW5sb2NrKCZibGl0cS0+
YmxpdF9sb2NrKTsKKwllbHNlCisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmJsaXRxLT5i
bGl0X2xvY2ssIGlycXNhdmUpOworfQorCisKKworLyoKKyAqIENoZWNrIHdoZXRoZXIgdGhp
cyBibGl0IGlzIHN0aWxsIGFjdGl2ZSwgcGVyZm9ybWluZyBuZWNlc3NhcnkgbG9ja2luZy4K
KyAqLworCitzdGF0aWMgaW50Cit2aWFfZG1hYmxpdF9hY3RpdmUoZHJtX3ZpYV9ibGl0cV90
ICpibGl0cSwgaW50IGVuZ2luZSwgdWludDMyX3QgaGFuZGxlLCB3YWl0X3F1ZXVlX2hlYWRf
dCAqKnF1ZXVlKQoreworCXVuc2lnbmVkIGxvbmcgaXJxc2F2ZTsKKwl1aW50MzJfdCBzbG90
OworCWludCBhY3RpdmU7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9j
aywgaXJxc2F2ZSk7CisKKwkvKgorCSAqIEFsbG93IGZvciBoYW5kbGUgd3JhcGFyb3VuZHMu
CisJICovCisKKwlhY3RpdmUgPSAoKGJsaXRxLT5kb25lX2JsaXRfaGFuZGxlIC0gaGFuZGxl
KSA+ICgxIDw8IDIzKSkgJiYKKwkJKChibGl0cS0+Y3VyX2JsaXRfaGFuZGxlIC0gaGFuZGxl
KSA8PSAoMSA8PCAyMykpOworCisJaWYgKHF1ZXVlICYmIGFjdGl2ZSkgeworCQlzbG90ID0g
aGFuZGxlIC0gYmxpdHEtPmRvbmVfYmxpdF9oYW5kbGUgKyBibGl0cS0+Y3VyIC0gMTsKKwkJ
aWYgKHNsb3QgPj0gVklBX05VTV9CTElUX1NMT1RTKQorCQkJc2xvdCAtPSBWSUFfTlVNX0JM
SVRfU0xPVFM7CisJCSpxdWV1ZSA9IGJsaXRxLT5ibGl0X3F1ZXVlICsgc2xvdDsKKwl9CisK
KwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsK
KworCXJldHVybiBhY3RpdmU7Cit9CisKKy8qCisgKiBTeW5jLiBXYWl0IGZvciBhdCBsZWFz
dCB0aHJlZSBzZWNvbmRzIGZvciB0aGUgYmxpdCB0byBiZSBwZXJmb3JtZWQuCisgKi8KKwor
c3RhdGljIGludAordmlhX2RtYWJsaXRfc3luYyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1
aW50MzJfdCBoYW5kbGUsIGludCBlbmdpbmUpCit7CisKKwlkcm1fdmlhX3ByaXZhdGVfdCAq
ZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKilkZXYtPmRldl9wcml2YXRlOworCWRy
bV92aWFfYmxpdHFfdCAqYmxpdHEgPSBkZXZfcHJpdi0+YmxpdF9xdWV1ZXMgKyBlbmdpbmU7
CisJd2FpdF9xdWV1ZV9oZWFkX3QgKnF1ZXVlOworCWludCByZXQgPSAwOworCisJaWYgKHZp
YV9kbWFibGl0X2FjdGl2ZShibGl0cSwgZW5naW5lLCBoYW5kbGUsICZxdWV1ZSkpIHsKKwkJ
VklBX1dBSVRfT04ocmV0LCAqcXVldWUsIDMgKiBIWiwKKwkJCSAgICAhdmlhX2RtYWJsaXRf
YWN0aXZlKGJsaXRxLCBlbmdpbmUsIGhhbmRsZSwgTlVMTCkpOworCX0KKwlEUk1fREVCVUco
IkRNQSBibGl0IHN5bmMgaGFuZGxlIDB4JXggZW5naW5lICVkIHJldHVybmVkICVkXG4iLAor
CQkgIGhhbmRsZSwgZW5naW5lLCByZXQpOworCisJcmV0dXJuIHJldDsKK30KKworCisvKgor
ICogQSB0aW1lciB0aGF0IHJlZ3VsYXJseSBwb2xscyB0aGUgYmxpdCBlbmdpbmUgaW4gY2Fz
ZXMgd2hlcmUgd2UgZG9uJ3QgaGF2ZSBpbnRlcnJ1cHRzOgorICogYSkgQnJva2VuIGhhcmR3
YXJlICh0eXBpY2FsbHkgdGhvc2UgdGhhdCBkb24ndCBoYXZlIGFueSB2aWRlbyBjYXB0dXJl
IGZhY2lsaXR5KS4KKyAqIGIpIEJsaXQgYWJvcnQuIFRoZSBoYXJkd2FyZSBkb2Vzbid0IHNl
bmQgYW4gaW50ZXJydXB0IHdoZW4gYSBibGl0IGlzIGFib3J0ZWQuCisgKiBUaGUgdGltZXIg
YW5kIGhhcmR3YXJlIElSUSdzIGNhbiBhbmQgZG8gd29yayBpbiBwYXJhbGxlbC4gSWYgdGhl
IGhhcmR3YXJlIGhhcworICogaXJxcywgaXQgd2lsbCBzaG9ydGVuIHRoZSBsYXRlbmN5IHNv
bWV3aGF0LgorICovCisKKworCitzdGF0aWMgdm9pZAordmlhX2RtYWJsaXRfdGltZXIoc3Ry
dWN0IHRpbWVyX2xpc3QgKnQpCit7CisJZHJtX3ZpYV9ibGl0cV90ICpibGl0cSA9IGZyb21f
dGltZXIoYmxpdHEsIHQsIHBvbGxfdGltZXIpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBibGl0cS0+ZGV2OworCWludCBlbmdpbmUgPSAoaW50KQorCQkoYmxpdHEgLSAoKGRybV92
aWFfcHJpdmF0ZV90ICopZGV2LT5kZXZfcHJpdmF0ZSktPmJsaXRfcXVldWVzKTsKKworCURS
TV9ERUJVRygiUG9sbGluZyB0aW1lciBjYWxsZWQgZm9yIGVuZ2luZSAlZCwgamlmZmllcyAl
bHVcbiIsIGVuZ2luZSwKKwkJICAodW5zaWduZWQgbG9uZykgamlmZmllcyk7CisKKwl2aWFf
ZG1hYmxpdF9oYW5kbGVyKGRldiwgZW5naW5lLCAwKTsKKworCWlmICghdGltZXJfcGVuZGlu
ZygmYmxpdHEtPnBvbGxfdGltZXIpKSB7CisJCW1vZF90aW1lcigmYmxpdHEtPnBvbGxfdGlt
ZXIsIGppZmZpZXMgKyAxKTsKKworCSAgICAgICAvKgorCQkqIFJlcnVuIGhhbmRsZXIgdG8g
ZGVsZXRlIHRpbWVyIGlmIGVuZ2luZXMgYXJlIG9mZiwgYW5kCisJCSogdG8gc2hvcnRlbiBh
Ym9ydCBsYXRlbmN5LiBUaGlzIGlzIGEgbGl0dGxlIG5hc3R5LgorCQkqLworCisJICAgICAg
IHZpYV9kbWFibGl0X2hhbmRsZXIoZGV2LCBlbmdpbmUsIDApOworCisJfQorfQorCisKKwor
CisvKgorICogV29ya3F1ZXVlIHRhc2sgdGhhdCBmcmVlcyBkYXRhIGFuZCBtYXBwaW5ncyBh
c3NvY2lhdGVkIHdpdGggYSBibGl0LgorICogQWxzbyB3YWtlcyB1cCB3YWl0aW5nIHByb2Nl
c3Nlcy4gRWFjaCBvZiB0aGVzZSB0YXNrcyBoYW5kbGVzIG9uZQorICogYmxpdCBlbmdpbmUg
b25seSBhbmQgbWF5IG5vdCBiZSBjYWxsZWQgb24gZWFjaCBpbnRlcnJ1cHQuCisgKi8KKwor
CitzdGF0aWMgdm9pZAordmlhX2RtYWJsaXRfd29ya3F1ZXVlKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKK3sKKwlkcm1fdmlhX2JsaXRxX3QgKmJsaXRxID0gY29udGFpbmVyX29mKHdv
cmssIGRybV92aWFfYmxpdHFfdCwgd3EpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBi
bGl0cS0+ZGV2OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2RldihkZXYtPmRl
dik7CisJdW5zaWduZWQgbG9uZyBpcnFzYXZlOworCWRybV92aWFfc2dfaW5mb190ICpjdXJf
c2c7CisJaW50IGN1cl9yZWxlYXNlZDsKKworCisJRFJNX0RFQlVHKCJXb3JrcXVldWUgdGFz
ayBjYWxsZWQgZm9yIGJsaXQgZW5naW5lICVsZFxuIiwgKHVuc2lnbmVkIGxvbmcpCisJCSAg
KGJsaXRxIC0gKChkcm1fdmlhX3ByaXZhdGVfdCAqKWRldi0+ZGV2X3ByaXZhdGUpLT5ibGl0
X3F1ZXVlcykpOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmJsaXRxLT5ibGl0X2xvY2ssIGly
cXNhdmUpOworCisJd2hpbGUgKGJsaXRxLT5zZXJ2aWNlZCAhPSBibGl0cS0+Y3VyKSB7CisK
KwkJY3VyX3JlbGVhc2VkID0gYmxpdHEtPnNlcnZpY2VkKys7CisKKwkJRFJNX0RFQlVHKCJS
ZWxlYXNpbmcgYmxpdCBzbG90ICVkXG4iLCBjdXJfcmVsZWFzZWQpOworCisJCWlmIChibGl0
cS0+c2VydmljZWQgPj0gVklBX05VTV9CTElUX1NMT1RTKQorCQkJYmxpdHEtPnNlcnZpY2Vk
ID0gMDsKKworCQljdXJfc2cgPSBibGl0cS0+YmxpdHNbY3VyX3JlbGVhc2VkXTsKKwkJYmxp
dHEtPm51bV9mcmVlKys7CisKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYmxpdHEtPmJs
aXRfbG9jaywgaXJxc2F2ZSk7CisKKwkJd2FrZV91cCgmYmxpdHEtPmJ1c3lfcXVldWUpOwor
CisJCXZpYV9mcmVlX3NnX2luZm8ocGRldiwgY3VyX3NnKTsKKwkJa2ZyZWUoY3VyX3NnKTsK
KworCQlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2ZSk7CisJ
fQorCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2
ZSk7Cit9CisKKworLyoKKyAqIEluaXQgYWxsIGJsaXQgZW5naW5lcy4gQ3VycmVudGx5IHdl
IHVzZSB0d28sIGJ1dCBzb21lIGhhcmR3YXJlIGhhdmUgNC4KKyAqLworCisKK3ZvaWQKK3Zp
YV9pbml0X2RtYWJsaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwlpbnQgaSwgajsK
Kwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKilk
ZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2Rldihk
ZXYtPmRldik7CisJZHJtX3ZpYV9ibGl0cV90ICpibGl0cTsKKworCXBjaV9zZXRfbWFzdGVy
KHBkZXYpOworCisJZm9yIChpID0gMDsgaSA8IFZJQV9OVU1fQkxJVF9FTkdJTkVTOyArK2kp
IHsKKwkJYmxpdHEgPSBkZXZfcHJpdi0+YmxpdF9xdWV1ZXMgKyBpOworCQlibGl0cS0+ZGV2
ID0gZGV2OworCQlibGl0cS0+Y3VyX2JsaXRfaGFuZGxlID0gMDsKKwkJYmxpdHEtPmRvbmVf
YmxpdF9oYW5kbGUgPSAwOworCQlibGl0cS0+aGVhZCA9IDA7CisJCWJsaXRxLT5jdXIgPSAw
OworCQlibGl0cS0+c2VydmljZWQgPSAwOworCQlibGl0cS0+bnVtX2ZyZWUgPSBWSUFfTlVN
X0JMSVRfU0xPVFMgLSAxOworCQlibGl0cS0+bnVtX291dHN0YW5kaW5nID0gMDsKKwkJYmxp
dHEtPmlzX2FjdGl2ZSA9IDA7CisJCWJsaXRxLT5hYm9ydGluZyA9IDA7CisJCXNwaW5fbG9j
a19pbml0KCZibGl0cS0+YmxpdF9sb2NrKTsKKwkJZm9yIChqID0gMDsgaiA8IFZJQV9OVU1f
QkxJVF9TTE9UUzsgKytqKQorCQkJaW5pdF93YWl0cXVldWVfaGVhZChibGl0cS0+YmxpdF9x
dWV1ZSArIGopOworCQlpbml0X3dhaXRxdWV1ZV9oZWFkKCZibGl0cS0+YnVzeV9xdWV1ZSk7
CisJCUlOSVRfV09SSygmYmxpdHEtPndxLCB2aWFfZG1hYmxpdF93b3JrcXVldWUpOworCQl0
aW1lcl9zZXR1cCgmYmxpdHEtPnBvbGxfdGltZXIsIHZpYV9kbWFibGl0X3RpbWVyLCAwKTsK
Kwl9Cit9CisKKy8qCisgKiBCdWlsZCBhbGwgaW5mbyBhbmQgZG8gYWxsIG1hcHBpbmdzIHJl
cXVpcmVkIGZvciBhIGJsaXQuCisgKi8KKworCitzdGF0aWMgaW50Cit2aWFfYnVpbGRfc2df
aW5mbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBkcm1fdmlhX3NnX2luZm9fdCAqdnNnLCBk
cm1fdmlhX2RtYWJsaXRfdCAqeGZlcikKK3sKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IHRv
X3BjaV9kZXYoZGV2LT5kZXYpOworCWludCBkcmF3ID0geGZlci0+dG9fZmI7CisJaW50IHJl
dCA9IDA7CisKKwl2c2ctPmRpcmVjdGlvbiA9IChkcmF3KSA/IERNQV9UT19ERVZJQ0UgOiBE
TUFfRlJPTV9ERVZJQ0U7CisJdnNnLT5ib3VuY2VfYnVmZmVyID0gTlVMTDsKKworCXZzZy0+
c3RhdGUgPSBkcl92aWFfc2dfaW5pdDsKKworCWlmICh4ZmVyLT5udW1fbGluZXMgPD0gMCB8
fCB4ZmVyLT5saW5lX2xlbmd0aCA8PSAwKSB7CisJCURSTV9FUlJPUigiWmVybyBzaXplIGJp
dGJsdC5cbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwkvKgorCSAqIEJlbG93IGNo
ZWNrIGlzIGEgZHJpdmVyIGxpbWl0YXRpb24sIG5vdCBhIGhhcmR3YXJlIG9uZS4gV2UKKwkg
KiBkb24ndCB3YW50IHRvIGxvY2sgdW51c2VkIHBhZ2VzLCBhbmQgZG9uJ3Qgd2FudCB0byBp
bmNvcG9yYXRlIHRoZQorCSAqIGV4dHJhIGxvZ2ljIG9mIGF2b2lkaW5nIHRoZW0uIE1ha2Ug
c3VyZSB0aGVyZSBhcmUgbm8uCisJICogKE5vdCBhIGJpZyBsaW1pdGF0aW9uIGFueXdheS4p
CisJICovCisKKwlpZiAoKHhmZXItPm1lbV9zdHJpZGUgLSB4ZmVyLT5saW5lX2xlbmd0aCkg
PiAyKlBBR0VfU0laRSkgeworCQlEUk1fRVJST1IoIlRvbyBsYXJnZSBzeXN0ZW0gbWVtb3J5
IHN0cmlkZS4gU3RyaWRlOiAlZCwgIgorCQkJICAiTGVuZ3RoOiAlZFxuIiwgeGZlci0+bWVt
X3N0cmlkZSwgeGZlci0+bGluZV9sZW5ndGgpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisK
KwlpZiAoKHhmZXItPm1lbV9zdHJpZGUgPT0geGZlci0+bGluZV9sZW5ndGgpICYmCisJICAg
KHhmZXItPmZiX3N0cmlkZSA9PSB4ZmVyLT5saW5lX2xlbmd0aCkpIHsKKwkJeGZlci0+bWVt
X3N0cmlkZSAqPSB4ZmVyLT5udW1fbGluZXM7CisJCXhmZXItPmxpbmVfbGVuZ3RoID0geGZl
ci0+bWVtX3N0cmlkZTsKKwkJeGZlci0+ZmJfc3RyaWRlID0geGZlci0+bWVtX3N0cmlkZTsK
KwkJeGZlci0+bnVtX2xpbmVzID0gMTsKKwl9CisKKwkvKgorCSAqIERvbid0IGxvY2sgYW4g
YXJiaXRyYXJ5IGxhcmdlIG51bWJlciBvZiBwYWdlcywgc2luY2UgdGhhdCBjYXVzZXMgYQor
CSAqIERPUyBzZWN1cml0eSBob2xlLgorCSAqLworCisJaWYgKHhmZXItPm51bV9saW5lcyA+
IDIwNDggfHwgKHhmZXItPm51bV9saW5lcyp4ZmVyLT5tZW1fc3RyaWRlID4gKDIwNDgqMjA0
OCo0KSkpIHsKKwkJRFJNX0VSUk9SKCJUb28gbGFyZ2UgUENJIERNQSBiaXRibHQuXG4iKTsK
KwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJLyoKKwkgKiB3ZSBhbGxvdyBhIG5lZ2F0aXZl
IGZiIHN0cmlkZSB0byBhbGxvdyBmbGlwcGluZyBvZiBpbWFnZXMgaW4KKwkgKiB0cmFuc2Zl
ci4KKwkgKi8KKworCWlmICh4ZmVyLT5tZW1fc3RyaWRlIDwgeGZlci0+bGluZV9sZW5ndGgg
fHwKKwkJYWJzKHhmZXItPmZiX3N0cmlkZSkgPCB4ZmVyLT5saW5lX2xlbmd0aCkgeworCQlE
Uk1fRVJST1IoIkludmFsaWQgZnJhbWUtYnVmZmVyIC8gbWVtb3J5IHN0cmlkZS5cbiIpOwor
CQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwkvKgorCSAqIEEgaGFyZHdhcmUgYnVnIHNlZW1z
IHRvIGJlIHdvcmtlZCBhcm91bmQgaWYgc3lzdGVtIG1lbW9yeSBhZGRyZXNzZXMgc3RhcnQg
b24KKwkgKiAxNiBieXRlIGJvdW5kYXJpZXMuIFRoaXMgc2VlbXMgYSBiaXQgcmVzdHJpY3Rp
dmUgaG93ZXZlci4gVklBIGlzIGNvbnRhY3RlZAorCSAqIGFib3V0IHRoaXMuIE1lYW53aGls
ZSwgaW1wb3NlIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgorCSAqLworCisjaWZkZWYg
VklBX0JVR0ZSRUUKKwlpZiAoKCgodW5zaWduZWQgbG9uZyl4ZmVyLT5tZW1fYWRkciAmIDMp
ICE9ICgodW5zaWduZWQgbG9uZyl4ZmVyLT5mYl9hZGRyICYgMykpIHx8CisJICAgICgoeGZl
ci0+bnVtX2xpbmVzID4gMSkgJiYgKCh4ZmVyLT5tZW1fc3RyaWRlICYgMykgIT0gKHhmZXIt
PmZiX3N0cmlkZSAmIDMpKSkpIHsKKwkJRFJNX0VSUk9SKCJJbnZhbGlkIERSTSBiaXRibHQg
YWxpZ25tZW50LlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKyNlbHNlCisJaWYgKCgo
KHVuc2lnbmVkIGxvbmcpeGZlci0+bWVtX2FkZHIgJiAxNSkgfHwKKwkgICAgICAoKHVuc2ln
bmVkIGxvbmcpeGZlci0+ZmJfYWRkciAmIDMpKSB8fAorCSAgICgoeGZlci0+bnVtX2xpbmVz
ID4gMSkgJiYKKwkgICAoKHhmZXItPm1lbV9zdHJpZGUgJiAxNSkgfHwgKHhmZXItPmZiX3N0
cmlkZSAmIDMpKSkpIHsKKwkJRFJNX0VSUk9SKCJJbnZhbGlkIERSTSBiaXRibHQgYWxpZ25t
ZW50LlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKyNlbmRpZgorCisJaWYgKDAgIT0g
KHJldCA9IHZpYV9sb2NrX2FsbF9kbWFfcGFnZXModnNnLCB4ZmVyKSkpIHsKKwkJRFJNX0VS
Uk9SKCJDb3VsZCBub3QgbG9jayBETUEgcGFnZXMuXG4iKTsKKwkJdmlhX2ZyZWVfc2dfaW5m
byhwZGV2LCB2c2cpOworCQlyZXR1cm4gcmV0OworCX0KKworCXZpYV9tYXBfYmxpdF9mb3Jf
ZGV2aWNlKHBkZXYsIHhmZXIsIHZzZywgMCk7CisJaWYgKDAgIT0gKHJldCA9IHZpYV9hbGxv
Y19kZXNjX3BhZ2VzKHZzZykpKSB7CisJCURSTV9FUlJPUigiQ291bGQgbm90IGFsbG9jYXRl
IERNQSBkZXNjcmlwdG9yIHBhZ2VzLlxuIik7CisJCXZpYV9mcmVlX3NnX2luZm8ocGRldiwg
dnNnKTsKKwkJcmV0dXJuIHJldDsKKwl9CisJdmlhX21hcF9ibGl0X2Zvcl9kZXZpY2UocGRl
diwgeGZlciwgdnNnLCAxKTsKKworCXJldHVybiAwOworfQorCisKKy8qCisgKiBSZXNlcnZl
IG9uZSBmcmVlIHNsb3QgaW4gdGhlIGJsaXQgcXVldWUuIFdpbGwgd2FpdCBmb3Igb25lIHNl
Y29uZCBmb3Igb25lCisgKiB0byBiZWNvbWUgYXZhaWxhYmxlLiBPdGhlcndpc2UgLUVCVVNZ
IGlzIHJldHVybmVkLgorICovCisKK3N0YXRpYyBpbnQKK3ZpYV9kbWFibGl0X2dyYWJfc2xv
dChkcm1fdmlhX2JsaXRxX3QgKmJsaXRxLCBpbnQgZW5naW5lKQoreworCWludCByZXQgPSAw
OworCXVuc2lnbmVkIGxvbmcgaXJxc2F2ZTsKKworCURSTV9ERUJVRygiTnVtIGZyZWUgaXMg
JWRcbiIsIGJsaXRxLT5udW1fZnJlZSk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmJsaXRxLT5i
bGl0X2xvY2ssIGlycXNhdmUpOworCXdoaWxlIChibGl0cS0+bnVtX2ZyZWUgPT0gMCkgewor
CQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsK
KworCQlWSUFfV0FJVF9PTihyZXQsIGJsaXRxLT5idXN5X3F1ZXVlLCBIWiwgYmxpdHEtPm51
bV9mcmVlID4gMCk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gKC1FSU5UUiA9PSByZXQpID8g
LUVBR0FJTiA6IHJldDsKKworCQlzcGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9j
aywgaXJxc2F2ZSk7CisJfQorCisJYmxpdHEtPm51bV9mcmVlLS07CisJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2ZSk7CisKKwlyZXR1cm4gMDsK
K30KKworLyoKKyAqIEhhbmQgYmFjayBhIGZyZWUgc2xvdCBpZiB3ZSBjaGFuZ2VkIG91ciBt
aW5kLgorICovCisKK3N0YXRpYyB2b2lkCit2aWFfZG1hYmxpdF9yZWxlYXNlX3Nsb3QoZHJt
X3ZpYV9ibGl0cV90ICpibGl0cSkKK3sKKwl1bnNpZ25lZCBsb25nIGlycXNhdmU7CisKKwlz
cGluX2xvY2tfaXJxc2F2ZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2ZSk7CisJYmxpdHEt
Pm51bV9mcmVlKys7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYmxpdHEtPmJsaXRfbG9j
aywgaXJxc2F2ZSk7CisJd2FrZV91cCgmYmxpdHEtPmJ1c3lfcXVldWUpOworfQorCisvKgor
ICogR3JhYiBhIGZyZWUgc2xvdC4gQnVpbGQgYmxpdCBpbmZvIGFuZCBxdWV1ZSBhIGJsaXQu
CisgKi8KKworCitzdGF0aWMgaW50Cit2aWFfZG1hYmxpdChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LCBkcm1fdmlhX2RtYWJsaXRfdCAqeGZlcikKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAq
ZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKilkZXYtPmRldl9wcml2YXRlOworCWRy
bV92aWFfc2dfaW5mb190ICp2c2c7CisJZHJtX3ZpYV9ibGl0cV90ICpibGl0cTsKKwlpbnQg
cmV0OworCWludCBlbmdpbmU7CisJdW5zaWduZWQgbG9uZyBpcnFzYXZlOworCisJaWYgKGRl
dl9wcml2ID09IE5VTEwpIHsKKwkJRFJNX0VSUk9SKCJDYWxsZWQgd2l0aG91dCBpbml0aWFs
aXphdGlvbi5cbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwllbmdpbmUgPSAoeGZl
ci0+dG9fZmIpID8gMCA6IDE7CisJYmxpdHEgPSBkZXZfcHJpdi0+YmxpdF9xdWV1ZXMgKyBl
bmdpbmU7CisJaWYgKDAgIT0gKHJldCA9IHZpYV9kbWFibGl0X2dyYWJfc2xvdChibGl0cSwg
ZW5naW5lKSkpCisJCXJldHVybiByZXQ7CisJaWYgKE5VTEwgPT0gKHZzZyA9IGttYWxsb2Mo
c2l6ZW9mKCp2c2cpLCBHRlBfS0VSTkVMKSkpIHsKKwkJdmlhX2RtYWJsaXRfcmVsZWFzZV9z
bG90KGJsaXRxKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCWlmICgwICE9IChyZXQgPSB2
aWFfYnVpbGRfc2dfaW5mbyhkZXYsIHZzZywgeGZlcikpKSB7CisJCXZpYV9kbWFibGl0X3Jl
bGVhc2Vfc2xvdChibGl0cSk7CisJCWtmcmVlKHZzZyk7CisJCXJldHVybiByZXQ7CisJfQor
CXNwaW5fbG9ja19pcnFzYXZlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFzYXZlKTsKKworCWJs
aXRxLT5ibGl0c1tibGl0cS0+aGVhZCsrXSA9IHZzZzsKKwlpZiAoYmxpdHEtPmhlYWQgPj0g
VklBX05VTV9CTElUX1NMT1RTKQorCQlibGl0cS0+aGVhZCA9IDA7CisJYmxpdHEtPm51bV9v
dXRzdGFuZGluZysrOworCXhmZXItPnN5bmMuc3luY19oYW5kbGUgPSArK2JsaXRxLT5jdXJf
YmxpdF9oYW5kbGU7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9s
b2NrLCBpcnFzYXZlKTsKKwl4ZmVyLT5zeW5jLmVuZ2luZSA9IGVuZ2luZTsKKworCXZpYV9k
bWFibGl0X2hhbmRsZXIoZGV2LCBlbmdpbmUsIDApOworCisJcmV0dXJuIDA7Cit9CisKKy8q
CisgKiBTeW5jIG9uIGEgcHJldmlvdXNseSBzdWJtaXR0ZWQgYmxpdC4gTm90ZSB0aGF0IHRo
ZSBYIHNlcnZlciB1c2Ugc2lnbmFscyBleHRlbnNpdmVseSwgYW5kCisgKiB0aGF0IHRoZXJl
IGlzIGEgdmVyeSBiaWcgcHJvYmFiaWxpdHkgdGhhdCB0aGlzIElPQ1RMIHdpbGwgYmUgaW50
ZXJydXB0ZWQgYnkgYSBzaWduYWwuIEluIHRoYXQKKyAqIGNhc2UgaXQgcmV0dXJucyB3aXRo
IC1FQUdBSU4gZm9yIHRoZSBzaWduYWwgdG8gYmUgZGVsaXZlcmVkLgorICogVGhlIGNhbGxl
ciBzaG91bGQgdGhlbiByZWlzc3VlIHRoZSBJT0NUTC4gVGhpcyBpcyBzaW1pbGFyIHRvIHdo
YXQgaXMgYmVpbmcgZG9uZSBmb3IgZHJtR2V0TG9jaygpLgorICovCisKK2ludAordmlhX2Rt
YV9ibGl0X3N5bmMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCit7CisJZHJtX3ZpYV9ibGl0c3luY190ICpzeW5jID0g
ZGF0YTsKKwlpbnQgZXJyOworCisJaWYgKHN5bmMtPmVuZ2luZSA+PSBWSUFfTlVNX0JMSVRf
RU5HSU5FUykKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwllcnIgPSB2aWFfZG1hYmxpdF9zeW5j
KGRldiwgc3luYy0+c3luY19oYW5kbGUsIHN5bmMtPmVuZ2luZSk7CisKKwlpZiAoLUVJTlRS
ID09IGVycikKKwkJZXJyID0gLUVBR0FJTjsKKworCXJldHVybiBlcnI7Cit9CisKKworLyoK
KyAqIFF1ZXVlIGEgYmxpdCBhbmQgaGFuZCBiYWNrIGEgaGFuZGxlIHRvIGJlIHVzZWQgZm9y
IHN5bmMuIFRoaXMgSU9DVEwgbWF5IGJlIGludGVycnVwdGVkIGJ5IGEgc2lnbmFsCisgKiB3
aGlsZSB3YWl0aW5nIGZvciBhIGZyZWUgc2xvdCBpbiB0aGUgYmxpdCBxdWV1ZS4gSW4gdGhh
dCBjYXNlIGl0IHJldHVybnMgd2l0aCAtRUFHQUlOIGFuZCBzaG91bGQKKyAqIGJlIHJlaXNz
dWVkLiBTZWUgdGhlIGFib3ZlIElPQ1RMIGNvZGUuCisgKi8KKworaW50Cit2aWFfZG1hX2Js
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxl
ICpmaWxlX3ByaXYpCit7CisJZHJtX3ZpYV9kbWFibGl0X3QgKnhmZXIgPSBkYXRhOworCWlu
dCBlcnI7CisKKwllcnIgPSB2aWFfZG1hYmxpdChkZXYsIHhmZXIpOworCisJcmV0dXJuIGVy
cjsKK30KKworLyoKKyAqIExlZ2FjeSBmaWxlOiB2aWFfZHJ2LmMKKyAqCisgKiBDb3B5cmln
aHQgMTk5OC0yMDAzIFZJQSBUZWNobm9sb2dpZXMsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZl
ZC4KKyAqIENvcHlyaWdodCAyMDAxLTIwMDMgUzMgR3JhcGhpY3MsIEluYy4gQWxsIFJpZ2h0
cyBSZXNlcnZlZC4KKyAqLworCitzdGF0aWMgaW50IHZpYV9kcml2ZXJfb3BlbihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJc3RydWN0IHZp
YV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdjsKKworCURSTV9ERUJVR19EUklWRVIoIlxuIik7
CisJZmlsZV9wcml2ID0ga21hbGxvYyhzaXplb2YoKmZpbGVfcHJpdiksIEdGUF9LRVJORUwp
OworCWlmICghZmlsZV9wcml2KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWZpbGUtPmRyaXZl
cl9wcml2ID0gZmlsZV9wcml2OworCisJSU5JVF9MSVNUX0hFQUQoJmZpbGVfcHJpdi0+b2Jq
X2xpc3QpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHZpYV9kcml2ZXJfcG9z
dGNsb3NlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkK
K3sKKwlzdHJ1Y3QgdmlhX2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVy
X3ByaXY7CisKKwlrZnJlZShmaWxlX3ByaXYpOworfQorCitzdGF0aWMgc3RydWN0IHBjaV9k
ZXZpY2VfaWQgcGNpaWRsaXN0W10gPSB7CisJdmlhZHJ2X1BDSV9JRFMKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHZpYV9kcml2ZXJfZm9wcyA9IHsKKwku
b3duZXIgPSBUSElTX01PRFVMRSwKKwkub3BlbiA9IGRybV9vcGVuLAorCS5yZWxlYXNlID0g
ZHJtX3JlbGVhc2UsCisJLnVubG9ja2VkX2lvY3RsID0gZHJtX2lvY3RsLAorCS5tbWFwID0g
ZHJtX2xlZ2FjeV9tbWFwLAorCS5wb2xsID0gZHJtX3BvbGwsCisJLmNvbXBhdF9pb2N0bCA9
IGRybV9jb21wYXRfaW9jdGwsCisJLmxsc2VlayA9IG5vb3BfbGxzZWVrLAorfTsKKworc3Rh
dGljIHN0cnVjdCBkcm1fZHJpdmVyIGRyaXZlciA9IHsKKwkuZHJpdmVyX2ZlYXR1cmVzID0K
KwkgICAgRFJJVkVSX1VTRV9BR1AgfCBEUklWRVJfSEFWRV9JUlEgfCBEUklWRVJfTEVHQUNZ
LAorCS5sb2FkID0gdmlhX2RyaXZlcl9sb2FkLAorCS51bmxvYWQgPSB2aWFfZHJpdmVyX3Vu
bG9hZCwKKwkub3BlbiA9IHZpYV9kcml2ZXJfb3BlbiwKKwkucHJlY2xvc2UgPSB2aWFfcmVj
bGFpbV9idWZmZXJzX2xvY2tlZCwKKwkucG9zdGNsb3NlID0gdmlhX2RyaXZlcl9wb3N0Y2xv
c2UsCisJLmNvbnRleHRfZHRvciA9IHZpYV9maW5hbF9jb250ZXh0LAorCS5nZXRfdmJsYW5r
X2NvdW50ZXIgPSB2aWFfZ2V0X3ZibGFua19jb3VudGVyLAorCS5lbmFibGVfdmJsYW5rID0g
dmlhX2VuYWJsZV92YmxhbmssCisJLmRpc2FibGVfdmJsYW5rID0gdmlhX2Rpc2FibGVfdmJs
YW5rLAorCS5pcnFfcHJlaW5zdGFsbCA9IHZpYV9kcml2ZXJfaXJxX3ByZWluc3RhbGwsCisJ
LmlycV9wb3N0aW5zdGFsbCA9IHZpYV9kcml2ZXJfaXJxX3Bvc3RpbnN0YWxsLAorCS5pcnFf
dW5pbnN0YWxsID0gdmlhX2RyaXZlcl9pcnFfdW5pbnN0YWxsLAorCS5pcnFfaGFuZGxlciA9
IHZpYV9kcml2ZXJfaXJxX2hhbmRsZXIsCisJLmRtYV9xdWllc2NlbnQgPSB2aWFfZHJpdmVy
X2RtYV9xdWllc2NlbnQsCisJLmxhc3RjbG9zZSA9IHZpYV9sYXN0Y2xvc2UsCisJLmlvY3Rs
cyA9IHZpYV9pb2N0bHMsCisJLmZvcHMgPSAmdmlhX2RyaXZlcl9mb3BzLAorCS5uYW1lID0g
RFJJVkVSX05BTUUsCisJLmRlc2MgPSBEUklWRVJfREVTQywKKwkuZGF0ZSA9IERSSVZFUl9E
QVRFLAorCS5tYWpvciA9IERSSVZFUl9NQUpPUiwKKwkubWlub3IgPSBEUklWRVJfTUlOT1Is
CisJLnBhdGNobGV2ZWwgPSBEUklWRVJfUEFUQ0hMRVZFTCwKK307CisKK3N0YXRpYyBzdHJ1
Y3QgcGNpX2RyaXZlciB2aWFfcGNpX2RyaXZlciA9IHsKKwkubmFtZSA9IERSSVZFUl9OQU1F
LAorCS5pZF90YWJsZSA9IHBjaWlkbGlzdCwKK307CisKK3N0YXRpYyBpbnQgX19pbml0IHZp
YV9pbml0KHZvaWQpCit7CisJZHJpdmVyLm51bV9pb2N0bHMgPSB2aWFfbWF4X2lvY3RsOwor
CXZpYV9pbml0X2NvbW1hbmRfdmVyaWZpZXIoKTsKKwlyZXR1cm4gZHJtX2xlZ2FjeV9wY2lf
aW5pdCgmZHJpdmVyLCAmdmlhX3BjaV9kcml2ZXIpOworfQorCitzdGF0aWMgdm9pZCBfX2V4
aXQgdmlhX2V4aXQodm9pZCkKK3sKKwlkcm1fbGVnYWN5X3BjaV9leGl0KCZkcml2ZXIsICZ2
aWFfcGNpX2RyaXZlcik7Cit9CisKK21vZHVsZV9pbml0KHZpYV9pbml0KTsKK21vZHVsZV9l
eGl0KHZpYV9leGl0KTsKKworTU9EVUxFX0FVVEhPUihEUklWRVJfQVVUSE9SKTsKK01PRFVM
RV9ERVNDUklQVElPTihEUklWRVJfREVTQyk7CitNT0RVTEVfTElDRU5TRSgiR1BMIGFuZCBh
ZGRpdGlvbmFsIHJpZ2h0cyIpOworCisvKgorICogTGVnYWN5IGZpbGU6IHZpYV9pcnEuYwor
ICoKKyAqIENvcHlyaWdodCAyMDA0IEJFQU0gTHRkLgorICogQ29weXJpZ2h0IDIwMDIgVHVu
Z3N0ZW4gR3JhcGhpY3MsIEluYy4KKyAqIENvcHlyaWdodCAyMDA1IFRob21hcyBIZWxsc3Ry
b20uCisgKiBBbGwgUmlnaHRzIFJlc2VydmVkLgorICoKKyAqIEF1dGhvcnM6CisgKiAgICBU
ZXJyeSBCYXJuYWJ5IDx0ZXJyeTFAYmVhbS5sdGQudWs+CisgKiAgICBLZWl0aCBXaGl0d2Vs
bCA8a2VpdGhAdHVuZ3N0ZW5ncmFwaGljcy5jb20+CisgKiAgICBUaG9tYXMgSGVsbHN0cm9t
IDx1bmljaHJvbWVAc2hpcG1haWwub3JnPgorICoKKyAqIFRoaXMgY29kZSBwcm92aWRlcyBz
dGFuZGFyZCBEUk0gYWNjZXNzIHRvIHRoZSBWaWEgVW5pY2hyb21lIC8gUHJvIFZlcnRpY2Fs
IGJsYW5rCisgKiBpbnRlcnJ1cHQsIGFzIHdlbGwgYXMgYW4gaW5mcmFzdHJ1Y3R1cmUgdG8g
aGFuZGxlIG90aGVyIGludGVycnVwdHMgb2YgdGhlIGNoaXAuCisgKiBUaGUgcmVmcmVzaCBy
YXRlIGlzIGFsc28gY2FsY3VsYXRlZCBmb3IgdmlkZW8gcGxheWJhY2sgc3luYyBwdXJwb3Nl
cy4KKyAqLworCisjZGVmaW5lIFZJQV9SRUdfSU5URVJSVVBUICAgICAgIDB4MjAwCisKKy8q
IFZJQV9SRUdfSU5URVJSVVBUICovCisjZGVmaW5lIFZJQV9JUlFfR0xPQkFMCSAgKDEgPDwg
MzEpCisjZGVmaW5lIFZJQV9JUlFfVkJMQU5LX0VOQUJMRSAgICgxIDw8IDE5KQorI2RlZmlu
ZSBWSUFfSVJRX1ZCTEFOS19QRU5ESU5HICAoMSA8PCAzKQorI2RlZmluZSBWSUFfSVJRX0hR
VjBfRU5BQkxFICAgICAoMSA8PCAxMSkKKyNkZWZpbmUgVklBX0lSUV9IUVYxX0VOQUJMRSAg
ICAgKDEgPDwgMjUpCisjZGVmaW5lIFZJQV9JUlFfSFFWMF9QRU5ESU5HICAgICgxIDw8IDkp
CisjZGVmaW5lIFZJQV9JUlFfSFFWMV9QRU5ESU5HICAgICgxIDw8IDEwKQorI2RlZmluZSBW
SUFfSVJRX0RNQTBfRERfRU5BQkxFICAoMSA8PCAyMCkKKyNkZWZpbmUgVklBX0lSUV9ETUEw
X1REX0VOQUJMRSAgKDEgPDwgMjEpCisjZGVmaW5lIFZJQV9JUlFfRE1BMV9ERF9FTkFCTEUg
ICgxIDw8IDIyKQorI2RlZmluZSBWSUFfSVJRX0RNQTFfVERfRU5BQkxFICAoMSA8PCAyMykK
KyNkZWZpbmUgVklBX0lSUV9ETUEwX0REX1BFTkRJTkcgKDEgPDwgNCkKKyNkZWZpbmUgVklB
X0lSUV9ETUEwX1REX1BFTkRJTkcgKDEgPDwgNSkKKyNkZWZpbmUgVklBX0lSUV9ETUExX0RE
X1BFTkRJTkcgKDEgPDwgNikKKyNkZWZpbmUgVklBX0lSUV9ETUExX1REX1BFTkRJTkcgKDEg
PDwgNykKKworCisvKgorICogRGV2aWNlLXNwZWNpZmljIElSUXMgZ28gaGVyZS4gVGhpcyB0
eXBlIG1pZ2h0IG5lZWQgdG8gYmUgZXh0ZW5kZWQgd2l0aAorICogdGhlIHJlZ2lzdGVyIGlm
IHRoZXJlIGFyZSBtdWx0aXBsZSBJUlEgY29udHJvbCByZWdpc3RlcnMuCisgKiBDdXJyZW50
bHkgd2UgYWN0aXZhdGUgdGhlIEhRViBpbnRlcnJ1cHRzIG9mICBVbmljaHJvbWUgUHJvIGdy
b3VwIEEuCisgKi8KKworc3RhdGljIG1hc2thcnJheV90IHZpYV9wcm9fZ3JvdXBfYV9pcnFz
W10gPSB7CisJe1ZJQV9JUlFfSFFWMF9FTkFCTEUsIFZJQV9JUlFfSFFWMF9QRU5ESU5HLCAw
eDAwMDAwM0QwLCAweDAwMDA4MDEwLAorCSAweDAwMDAwMDAwIH0sCisJe1ZJQV9JUlFfSFFW
MV9FTkFCTEUsIFZJQV9JUlFfSFFWMV9QRU5ESU5HLCAweDAwMDAxM0QwLCAweDAwMDA4MDEw
LAorCSAweDAwMDAwMDAwIH0sCisJe1ZJQV9JUlFfRE1BMF9URF9FTkFCTEUsIFZJQV9JUlFf
RE1BMF9URF9QRU5ESU5HLCBWSUFfUENJX0RNQV9DU1IwLAorCSBWSUFfRE1BX0NTUl9UQSB8
IFZJQV9ETUFfQ1NSX1RELCAweDAwMDAwMDA4fSwKKwl7VklBX0lSUV9ETUExX1REX0VOQUJM
RSwgVklBX0lSUV9ETUExX1REX1BFTkRJTkcsIFZJQV9QQ0lfRE1BX0NTUjEsCisJIFZJQV9E
TUFfQ1NSX1RBIHwgVklBX0RNQV9DU1JfVEQsIDB4MDAwMDAwMDh9LAorfTsKK3N0YXRpYyBp
bnQgdmlhX251bV9wcm9fZ3JvdXBfYSA9IEFSUkFZX1NJWkUodmlhX3Byb19ncm91cF9hX2ly
cXMpOworc3RhdGljIGludCB2aWFfaXJxbWFwX3Byb19ncm91cF9hW10gPSB7MCwgMSwgLTEs
IDIsIC0xLCAzfTsKKworc3RhdGljIG1hc2thcnJheV90IHZpYV91bmljaHJvbWVfaXJxc1td
ID0geworCXtWSUFfSVJRX0RNQTBfVERfRU5BQkxFLCBWSUFfSVJRX0RNQTBfVERfUEVORElO
RywgVklBX1BDSV9ETUFfQ1NSMCwKKwkgVklBX0RNQV9DU1JfVEEgfCBWSUFfRE1BX0NTUl9U
RCwgMHgwMDAwMDAwOH0sCisJe1ZJQV9JUlFfRE1BMV9URF9FTkFCTEUsIFZJQV9JUlFfRE1B
MV9URF9QRU5ESU5HLCBWSUFfUENJX0RNQV9DU1IxLAorCSBWSUFfRE1BX0NTUl9UQSB8IFZJ
QV9ETUFfQ1NSX1RELCAweDAwMDAwMDA4fQorfTsKK3N0YXRpYyBpbnQgdmlhX251bV91bmlj
aHJvbWUgPSBBUlJBWV9TSVpFKHZpYV91bmljaHJvbWVfaXJxcyk7CitzdGF0aWMgaW50IHZp
YV9pcnFtYXBfdW5pY2hyb21lW10gPSB7LTEsIC0xLCAtMSwgMCwgLTEsIDF9OworCisKK3Uz
MiB2aWFfZ2V0X3ZibGFua19jb3VudGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2ln
bmVkIGludCBwaXBlKQoreworCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IGRldi0+
ZGV2X3ByaXZhdGU7CisKKwlpZiAocGlwZSAhPSAwKQorCQlyZXR1cm4gMDsKKworCXJldHVy
biBhdG9taWNfcmVhZCgmZGV2X3ByaXYtPnZibF9yZWNlaXZlZCk7Cit9CisKK2lycXJldHVy
bl90IHZpYV9kcml2ZXJfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQoreworCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAoc3RydWN0IGRybV9kZXZpY2UgKikgYXJnOworCWRy
bV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKSBkZXYt
PmRldl9wcml2YXRlOworCXUzMiBzdGF0dXM7CisJaW50IGhhbmRsZWQgPSAwOworCWt0aW1l
X3QgY3VyX3ZibGFuazsKKwlkcm1fdmlhX2lycV90ICpjdXJfaXJxID0gZGV2X3ByaXYtPnZp
YV9pcnFzOworCWludCBpOworCisJc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9S
RUdfSU5URVJSVVBUKTsKKwlpZiAoc3RhdHVzICYgVklBX0lSUV9WQkxBTktfUEVORElORykg
eworCQlhdG9taWNfaW5jKCZkZXZfcHJpdi0+dmJsX3JlY2VpdmVkKTsKKwkJaWYgKCEoYXRv
bWljX3JlYWQoJmRldl9wcml2LT52YmxfcmVjZWl2ZWQpICYgMHgwRikpIHsKKwkJCWN1cl92
YmxhbmsgPSBrdGltZV9nZXQoKTsKKwkJCWlmIChkZXZfcHJpdi0+bGFzdF92YmxhbmtfdmFs
aWQpIHsKKwkJCQlkZXZfcHJpdi0+bnNlY19wZXJfdmJsYW5rID0KKwkJCQkJa3RpbWVfc3Vi
KGN1cl92YmxhbmssCisJCQkJCQlkZXZfcHJpdi0+bGFzdF92YmxhbmspID4+IDQ7CisJCQl9
CisJCQlkZXZfcHJpdi0+bGFzdF92YmxhbmsgPSBjdXJfdmJsYW5rOworCQkJZGV2X3ByaXYt
Pmxhc3RfdmJsYW5rX3ZhbGlkID0gMTsKKwkJfQorCQlpZiAoIShhdG9taWNfcmVhZCgmZGV2
X3ByaXYtPnZibF9yZWNlaXZlZCkgJiAweEZGKSkgeworCQkJRFJNX0RFQlVHKCJuc2VjIHBl
ciB2YmxhbmsgaXM6ICVsbHVcbiIsCisJCQkJICBrdGltZV90b19ucyhkZXZfcHJpdi0+bnNl
Y19wZXJfdmJsYW5rKSk7CisJCX0KKwkJZHJtX2hhbmRsZV92YmxhbmsoZGV2LCAwKTsKKwkJ
aGFuZGxlZCA9IDE7CisJfQorCisJZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1faXJx
czsgKytpKSB7CisJCWlmIChzdGF0dXMgJiBjdXJfaXJxLT5wZW5kaW5nX21hc2spIHsKKwkJ
CWF0b21pY19pbmMoJmN1cl9pcnEtPmlycV9yZWNlaXZlZCk7CisJCQl3YWtlX3VwKCZjdXJf
aXJxLT5pcnFfcXVldWUpOworCQkJaGFuZGxlZCA9IDE7CisJCQlpZiAoZGV2X3ByaXYtPmly
cV9tYXBbZHJtX3ZpYV9pcnFfZG1hMF90ZF0gPT0gaSkKKwkJCQl2aWFfZG1hYmxpdF9oYW5k
bGVyKGRldiwgMCwgMSk7CisJCQllbHNlIGlmIChkZXZfcHJpdi0+aXJxX21hcFtkcm1fdmlh
X2lycV9kbWExX3RkXSA9PSBpKQorCQkJCXZpYV9kbWFibGl0X2hhbmRsZXIoZGV2LCAxLCAx
KTsKKwkJfQorCQljdXJfaXJxKys7CisJfQorCisJLyogQWNrbm93bGVkZ2UgaW50ZXJydXB0
cyAqLworCXZpYV93cml0ZShkZXZfcHJpdiwgVklBX1JFR19JTlRFUlJVUFQsIHN0YXR1cyk7
CisKKworCWlmIChoYW5kbGVkKQorCQlyZXR1cm4gSVJRX0hBTkRMRUQ7CisJZWxzZQorCQly
ZXR1cm4gSVJRX05PTkU7Cit9CisKK3N0YXRpYyBfX2lubGluZV9fIHZvaWQgdmlhZHJ2X2Fj
a25vd2xlZGdlX2lycXMoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2KQoreworCXUzMiBz
dGF0dXM7CisKKwlpZiAoZGV2X3ByaXYpIHsKKwkJLyogQWNrbm93bGVkZ2UgaW50ZXJydXB0
cyAqLworCQlzdGF0dXMgPSB2aWFfcmVhZChkZXZfcHJpdiwgVklBX1JFR19JTlRFUlJVUFQp
OworCQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMgfAor
CQkJICBkZXZfcHJpdi0+aXJxX3BlbmRpbmdfbWFzayk7CisJfQorfQorCitpbnQgdmlhX2Vu
YWJsZV92Ymxhbmsoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUp
Cit7CisJZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsK
Kwl1MzIgc3RhdHVzOworCisJaWYgKHBpcGUgIT0gMCkgeworCQlEUk1fRVJST1IoIiVzOiAg
YmFkIGNydGMgJXVcbiIsIF9fZnVuY19fLCBwaXBlKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJ
fQorCisJc3RhdHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBUKTsK
Kwl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMgfCBWSUFf
SVJRX1ZCTEFOS19FTkFCTEUpOworCisJdmlhX3dyaXRlOChkZXZfcHJpdiwgMHg4M2Q0LCAw
eDExKTsKKwl2aWFfd3JpdGU4X21hc2soZGV2X3ByaXYsIDB4ODNkNSwgMHgzMCwgMHgzMCk7
CisKKwlyZXR1cm4gMDsKK30KKwordm9pZCB2aWFfZGlzYWJsZV92Ymxhbmsoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCit7CisJZHJtX3ZpYV9wcml2YXRl
X3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwl1MzIgc3RhdHVzOworCisJc3Rh
dHVzID0gdmlhX3JlYWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBUKTsKKwl2aWFfd3Jp
dGUoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBULCBzdGF0dXMgJiB+VklBX0lSUV9WQkxB
TktfRU5BQkxFKTsKKworCXZpYV93cml0ZTgoZGV2X3ByaXYsIDB4ODNkNCwgMHgxMSk7CisJ
dmlhX3dyaXRlOF9tYXNrKGRldl9wcml2LCAweDgzZDUsIDB4MzAsIDApOworCisJaWYgKHBp
cGUgIT0gMCkKKwkJRFJNX0VSUk9SKCIlczogIGJhZCBjcnRjICV1XG4iLCBfX2Z1bmNfXywg
cGlwZSk7Cit9CisKK3N0YXRpYyBpbnQKK3ZpYV9kcml2ZXJfaXJxX3dhaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IGlycSwgaW50IGZvcmNlX3NlcXVlbmNlLAor
CQkgICAgdW5zaWduZWQgaW50ICpzZXF1ZW5jZSkKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAq
ZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKKwl1
bnNpZ25lZCBpbnQgY3VyX2lycV9zZXF1ZW5jZTsKKwlkcm1fdmlhX2lycV90ICpjdXJfaXJx
OworCWludCByZXQgPSAwOworCW1hc2thcnJheV90ICptYXNrczsKKwlpbnQgcmVhbF9pcnE7
CisKKwlEUk1fREVCVUcoIlxuIik7CisKKwlpZiAoIWRldl9wcml2KSB7CisJCURSTV9FUlJP
UigiY2FsbGVkIHdpdGggbm8gaW5pdGlhbGl6YXRpb25cbiIpOworCQlyZXR1cm4gLUVJTlZB
TDsKKwl9CisKKwlpZiAoaXJxID49IGRybV92aWFfaXJxX251bSkgeworCQlEUk1fRVJST1Io
IlRyeWluZyB0byB3YWl0IG9uIHVua25vd24gaXJxICVkXG4iLCBpcnEpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisKKwlyZWFsX2lycSA9IGRldl9wcml2LT5pcnFfbWFwW2lycV07CisK
KwlpZiAocmVhbF9pcnEgPCAwKSB7CisJCURSTV9FUlJPUigiVmlkZW8gSVJRICVkIG5vdCBh
dmFpbGFibGUgb24gdGhpcyBoYXJkd2FyZS5cbiIsCisJCQkgIGlycSk7CisJCXJldHVybiAt
RUlOVkFMOworCX0KKworCW1hc2tzID0gZGV2X3ByaXYtPmlycV9tYXNrczsKKwljdXJfaXJx
ID0gZGV2X3ByaXYtPnZpYV9pcnFzICsgcmVhbF9pcnE7CisKKwlpZiAobWFza3NbcmVhbF9p
cnFdWzJdICYmICFmb3JjZV9zZXF1ZW5jZSkgeworCQlWSUFfV0FJVF9PTihyZXQsIGN1cl9p
cnEtPmlycV9xdWV1ZSwgMyAqIEhaLAorCQkJICAgICgodmlhX3JlYWQoZGV2X3ByaXYsIG1h
c2tzW2lycV1bMl0pICYgbWFza3NbaXJxXVszXSkgPT0KKwkJCSAgICAgbWFza3NbaXJxXVs0
XSkpOworCQljdXJfaXJxX3NlcXVlbmNlID0gYXRvbWljX3JlYWQoJmN1cl9pcnEtPmlycV9y
ZWNlaXZlZCk7CisJfSBlbHNlIHsKKwkJVklBX1dBSVRfT04ocmV0LCBjdXJfaXJxLT5pcnFf
cXVldWUsIDMgKiBIWiwKKwkJCSAgICAoKChjdXJfaXJxX3NlcXVlbmNlID0KKwkJCSAgICAg
ICBhdG9taWNfcmVhZCgmY3VyX2lycS0+aXJxX3JlY2VpdmVkKSkgLQorCQkJICAgICAgKnNl
cXVlbmNlKSA8PSAoMSA8PCAyMykpKTsKKwl9CisJKnNlcXVlbmNlID0gY3VyX2lycV9zZXF1
ZW5jZTsKKwlyZXR1cm4gcmV0OworfQorCisKKy8qCisgKiBkcm1fZG1hLmggaG9va3MKKyAq
LworCit2b2lkIHZpYV9kcml2ZXJfaXJxX3ByZWluc3RhbGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2
YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKKwl1MzIgc3RhdHVzOworCWRybV92aWFfaXJx
X3QgKmN1cl9pcnE7CisJaW50IGk7CisKKwlEUk1fREVCVUcoImRldl9wcml2OiAlcFxuIiwg
ZGV2X3ByaXYpOworCWlmIChkZXZfcHJpdikgeworCQljdXJfaXJxID0gZGV2X3ByaXYtPnZp
YV9pcnFzOworCisJCWRldl9wcml2LT5pcnFfZW5hYmxlX21hc2sgPSBWSUFfSVJRX1ZCTEFO
S19FTkFCTEU7CisJCWRldl9wcml2LT5pcnFfcGVuZGluZ19tYXNrID0gVklBX0lSUV9WQkxB
TktfUEVORElORzsKKworCQlpZiAoZGV2X3ByaXYtPmNoaXBzZXQgPT0gVklBX1BST19HUk9V
UF9BIHx8CisJCSAgICBkZXZfcHJpdi0+Y2hpcHNldCA9PSBWSUFfRFg5XzApIHsKKwkJCWRl
dl9wcml2LT5pcnFfbWFza3MgPSB2aWFfcHJvX2dyb3VwX2FfaXJxczsKKwkJCWRldl9wcml2
LT5udW1faXJxcyA9IHZpYV9udW1fcHJvX2dyb3VwX2E7CisJCQlkZXZfcHJpdi0+aXJxX21h
cCA9IHZpYV9pcnFtYXBfcHJvX2dyb3VwX2E7CisJCX0gZWxzZSB7CisJCQlkZXZfcHJpdi0+
aXJxX21hc2tzID0gdmlhX3VuaWNocm9tZV9pcnFzOworCQkJZGV2X3ByaXYtPm51bV9pcnFz
ID0gdmlhX251bV91bmljaHJvbWU7CisJCQlkZXZfcHJpdi0+aXJxX21hcCA9IHZpYV9pcnFt
YXBfdW5pY2hyb21lOworCQl9CisKKwkJZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1f
aXJxczsgKytpKSB7CisJCQlhdG9taWNfc2V0KCZjdXJfaXJxLT5pcnFfcmVjZWl2ZWQsIDAp
OworCQkJY3VyX2lycS0+ZW5hYmxlX21hc2sgPSBkZXZfcHJpdi0+aXJxX21hc2tzW2ldWzBd
OworCQkJY3VyX2lycS0+cGVuZGluZ19tYXNrID0gZGV2X3ByaXYtPmlycV9tYXNrc1tpXVsx
XTsKKwkJCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmN1cl9pcnEtPmlycV9xdWV1ZSk7CisJCQlk
ZXZfcHJpdi0+aXJxX2VuYWJsZV9tYXNrIHw9IGN1cl9pcnEtPmVuYWJsZV9tYXNrOworCQkJ
ZGV2X3ByaXYtPmlycV9wZW5kaW5nX21hc2sgfD0gY3VyX2lycS0+cGVuZGluZ19tYXNrOwor
CQkJY3VyX2lycSsrOworCisJCQlEUk1fREVCVUcoIkluaXRpYWxpemluZyBJUlEgJWRcbiIs
IGkpOworCQl9CisKKwkJZGV2X3ByaXYtPmxhc3RfdmJsYW5rX3ZhbGlkID0gMDsKKworCQkv
KiBDbGVhciBWU3luYyBpbnRlcnJ1cHQgcmVncyAqLworCQlzdGF0dXMgPSB2aWFfcmVhZChk
ZXZfcHJpdiwgVklBX1JFR19JTlRFUlJVUFQpOworCQl2aWFfd3JpdGUoZGV2X3ByaXYsIFZJ
QV9SRUdfSU5URVJSVVBULCBzdGF0dXMgJgorCQkJICB+KGRldl9wcml2LT5pcnFfZW5hYmxl
X21hc2spKTsKKworCQkvKiBDbGVhciBiaXRzIGlmIHRoZXkncmUgYWxyZWFkeSBoaWdoICov
CisJCXZpYWRydl9hY2tub3dsZWRnZV9pcnFzKGRldl9wcml2KTsKKwl9Cit9CisKK2ludCB2
aWFfZHJpdmVyX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQorewor
CWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKSBk
ZXYtPmRldl9wcml2YXRlOworCXUzMiBzdGF0dXM7CisKKwlEUk1fREVCVUcoImZ1bjogJXNc
biIsIF9fZnVuY19fKTsKKwlpZiAoIWRldl9wcml2KQorCQlyZXR1cm4gLUVJTlZBTDsKKwor
CXN0YXR1cyA9IHZpYV9yZWFkKGRldl9wcml2LCBWSUFfUkVHX0lOVEVSUlVQVCk7CisJdmlh
X3dyaXRlKGRldl9wcml2LCBWSUFfUkVHX0lOVEVSUlVQVCwgc3RhdHVzIHwgVklBX0lSUV9H
TE9CQUwKKwkJICB8IGRldl9wcml2LT5pcnFfZW5hYmxlX21hc2spOworCisJLyogU29tZSBt
YWdpYywgb2ggZm9yIHNvbWUgZGF0YSBzaGVldHMgISAqLworCXZpYV93cml0ZTgoZGV2X3By
aXYsIDB4ODNkNCwgMHgxMSk7CisJdmlhX3dyaXRlOF9tYXNrKGRldl9wcml2LCAweDgzZDUs
IDB4MzAsIDB4MzApOworCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgdmlhX2RyaXZlcl9pcnFf
dW5pbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCit7CisJZHJtX3ZpYV9wcml2YXRl
X3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2X3ByaXZhdGU7
CisJdTMyIHN0YXR1czsKKworCURSTV9ERUJVRygiXG4iKTsKKwlpZiAoZGV2X3ByaXYpIHsK
KworCQkvKiBTb21lIG1vcmUgbWFnaWMsIG9oIGZvciBzb21lIGRhdGEgc2hlZXRzICEgKi8K
KworCQl2aWFfd3JpdGU4KGRldl9wcml2LCAweDgzZDQsIDB4MTEpOworCQl2aWFfd3JpdGU4
X21hc2soZGV2X3ByaXYsIDB4ODNkNSwgMHgzMCwgMCk7CisKKwkJc3RhdHVzID0gdmlhX3Jl
YWQoZGV2X3ByaXYsIFZJQV9SRUdfSU5URVJSVVBUKTsKKwkJdmlhX3dyaXRlKGRldl9wcml2
LCBWSUFfUkVHX0lOVEVSUlVQVCwgc3RhdHVzICYKKwkJCSAgfihWSUFfSVJRX1ZCTEFOS19F
TkFCTEUgfCBkZXZfcHJpdi0+aXJxX2VuYWJsZV9tYXNrKSk7CisJfQorfQorCitpbnQgdmlh
X3dhaXRfaXJxKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBk
cm1fZmlsZSAqZmlsZV9wcml2KQoreworCWRybV92aWFfaXJxd2FpdF90ICppcnF3YWl0ID0g
ZGF0YTsKKwlzdHJ1Y3QgdGltZXNwZWM2NCBub3c7CisJaW50IHJldCA9IDA7CisJZHJtX3Zp
YV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2
X3ByaXZhdGU7CisJZHJtX3ZpYV9pcnFfdCAqY3VyX2lycSA9IGRldl9wcml2LT52aWFfaXJx
czsKKwlpbnQgZm9yY2Vfc2VxdWVuY2U7CisKKwlpZiAoaXJxd2FpdC0+cmVxdWVzdC5pcnEg
Pj0gZGV2X3ByaXYtPm51bV9pcnFzKSB7CisJCURSTV9FUlJPUigiVHJ5aW5nIHRvIHdhaXQg
b24gdW5rbm93biBpcnEgJWRcbiIsCisJCQkgIGlycXdhaXQtPnJlcXVlc3QuaXJxKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCisJY3VyX2lycSArPSBpcnF3YWl0LT5yZXF1ZXN0Lmly
cTsKKworCXN3aXRjaCAoaXJxd2FpdC0+cmVxdWVzdC50eXBlICYgflZJQV9JUlFfRkxBR1Nf
TUFTSykgeworCWNhc2UgVklBX0lSUV9SRUxBVElWRToKKwkJaXJxd2FpdC0+cmVxdWVzdC5z
ZXF1ZW5jZSArPQorCQkJYXRvbWljX3JlYWQoJmN1cl9pcnEtPmlycV9yZWNlaXZlZCk7CisJ
CWlycXdhaXQtPnJlcXVlc3QudHlwZSAmPSB+X0RSTV9WQkxBTktfUkVMQVRJVkU7CisJCWJy
ZWFrOworCWNhc2UgVklBX0lSUV9BQlNPTFVURToKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKGlycXdhaXQtPnJlcXVlc3QudHlwZSAmIFZJ
QV9JUlFfU0lHTkFMKSB7CisJCURSTV9FUlJPUigiU2lnbmFscyBvbiBWaWEgSVJRcyBub3Qg
aW1wbGVtZW50ZWQgeWV0LlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWZvcmNl
X3NlcXVlbmNlID0gKGlycXdhaXQtPnJlcXVlc3QudHlwZSAmIFZJQV9JUlFfRk9SQ0VfU0VR
VUVOQ0UpOworCisJcmV0ID0gdmlhX2RyaXZlcl9pcnFfd2FpdChkZXYsIGlycXdhaXQtPnJl
cXVlc3QuaXJxLCBmb3JjZV9zZXF1ZW5jZSwKKwkJCQkgICZpcnF3YWl0LT5yZXF1ZXN0LnNl
cXVlbmNlKTsKKwlrdGltZV9nZXRfdHM2NCgmbm93KTsKKwlpcnF3YWl0LT5yZXBseS50dmFs
X3NlYyA9IG5vdy50dl9zZWM7CisJaXJxd2FpdC0+cmVwbHkudHZhbF91c2VjID0gbm93LnR2
X25zZWMgLyBOU0VDX1BFUl9VU0VDOworCisJcmV0dXJuIHJldDsKK30KKworLyoKKyAqIExl
Z2FjeSBmaWxlOiB2aWFfbWFwLmMKKyAqCisgKiBDb3B5cmlnaHQgMTk5OC0yMDAzIFZJQSBU
ZWNobm9sb2dpZXMsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqIENvcHlyaWdodCAy
MDAxLTIwMDMgUzMgR3JhcGhpY3MsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqLwor
CitzdGF0aWMgaW50IHZpYV9kb19pbml0X21hcChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBk
cm1fdmlhX2luaXRfdCAqaW5pdCkKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYg
PSBkZXYtPmRldl9wcml2YXRlOworCisJRFJNX0RFQlVHKCJcbiIpOworCisJZGV2X3ByaXYt
PnNhcmVhID0gZHJtX2xlZ2FjeV9nZXRzYXJlYShkZXYpOworCWlmICghZGV2X3ByaXYtPnNh
cmVhKSB7CisJCURSTV9FUlJPUigiY291bGQgbm90IGZpbmQgc2FyZWEhXG4iKTsKKwkJZGV2
LT5kZXZfcHJpdmF0ZSA9ICh2b2lkICopZGV2X3ByaXY7CisJCXZpYV9kb19jbGVhbnVwX21h
cChkZXYpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlkZXZfcHJpdi0+ZmIgPSBkcm1f
bGVnYWN5X2ZpbmRtYXAoZGV2LCBpbml0LT5mYl9vZmZzZXQpOworCWlmICghZGV2X3ByaXYt
PmZiKSB7CisJCURSTV9FUlJPUigiY291bGQgbm90IGZpbmQgZnJhbWVidWZmZXIhXG4iKTsK
KwkJZGV2LT5kZXZfcHJpdmF0ZSA9ICh2b2lkICopZGV2X3ByaXY7CisJCXZpYV9kb19jbGVh
bnVwX21hcChkZXYpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJZGV2X3ByaXYtPm1taW8g
PSBkcm1fbGVnYWN5X2ZpbmRtYXAoZGV2LCBpbml0LT5tbWlvX29mZnNldCk7CisJaWYgKCFk
ZXZfcHJpdi0+bW1pbykgeworCQlEUk1fRVJST1IoImNvdWxkIG5vdCBmaW5kIG1taW8gcmVn
aW9uIVxuIik7CisJCWRldi0+ZGV2X3ByaXZhdGUgPSAodm9pZCAqKWRldl9wcml2OworCQl2
aWFfZG9fY2xlYW51cF9tYXAoZGV2KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJZGV2
X3ByaXYtPnNhcmVhX3ByaXYgPQorCSAgICAoZHJtX3ZpYV9zYXJlYV90ICopICgodTggKikg
ZGV2X3ByaXYtPnNhcmVhLT5oYW5kbGUgKworCQkJCSBpbml0LT5zYXJlYV9wcml2X29mZnNl
dCk7CisKKwlkZXZfcHJpdi0+YWdwQWRkciA9IGluaXQtPmFncEFkZHI7CisKKwl2aWFfaW5p
dF9mdXRleChkZXZfcHJpdik7CisKKwl2aWFfaW5pdF9kbWFibGl0KGRldik7CisKKwlkZXYt
PmRldl9wcml2YXRlID0gKHZvaWQgKilkZXZfcHJpdjsKKwlyZXR1cm4gMDsKK30KKworaW50
IHZpYV9kb19jbGVhbnVwX21hcChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCXZpYV9k
bWFfY2xlYW51cChkZXYpOworCisJcmV0dXJuIDA7Cit9CisKK2ludCB2aWFfbWFwX2luaXQo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpm
aWxlX3ByaXYpCit7CisJZHJtX3ZpYV9pbml0X3QgKmluaXQgPSBkYXRhOworCisJRFJNX0RF
QlVHKCJcbiIpOworCisJc3dpdGNoIChpbml0LT5mdW5jKSB7CisJY2FzZSBWSUFfSU5JVF9N
QVA6CisJCXJldHVybiB2aWFfZG9faW5pdF9tYXAoZGV2LCBpbml0KTsKKwljYXNlIFZJQV9D
TEVBTlVQX01BUDoKKwkJcmV0dXJuIHZpYV9kb19jbGVhbnVwX21hcChkZXYpOworCX0KKwor
CXJldHVybiAtRUlOVkFMOworfQorCitpbnQgdmlhX2RyaXZlcl9sb2FkKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHVuc2lnbmVkIGxvbmcgY2hpcHNldCkKK3sKKwlzdHJ1Y3QgcGNpX2Rl
diAqcGRldiA9IHRvX3BjaV9kZXYoZGV2LT5kZXYpOworCWRybV92aWFfcHJpdmF0ZV90ICpk
ZXZfcHJpdjsKKwlpbnQgcmV0ID0gMDsKKworCWRldl9wcml2ID0ga3phbGxvYyhzaXplb2Yo
ZHJtX3ZpYV9wcml2YXRlX3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAoZGV2X3ByaXYgPT0gTlVM
TCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpZHJfaW5pdCgmZGV2X3ByaXYtPm9iamVjdF9p
ZHIpOworCWRldi0+ZGV2X3ByaXZhdGUgPSAodm9pZCAqKWRldl9wcml2OworCisJZGV2X3By
aXYtPmNoaXBzZXQgPSBjaGlwc2V0OworCisJcGNpX3NldF9tYXN0ZXIocGRldik7CisKKwly
ZXQgPSBkcm1fdmJsYW5rX2luaXQoZGV2LCAxKTsKKwlpZiAocmV0KSB7CisJCWtmcmVlKGRl
dl9wcml2KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwordm9pZCB2
aWFfZHJpdmVyX3VubG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCWRybV92aWFf
cHJpdmF0ZV90ICpkZXZfcHJpdiA9IGRldi0+ZGV2X3ByaXZhdGU7CisKKwlpZHJfZGVzdHJv
eSgmZGV2X3ByaXYtPm9iamVjdF9pZHIpOworCisJa2ZyZWUoZGV2X3ByaXYpOworfQorCisv
KgorICogTGVnYWN5IGZpbGU6IHZpYV9tbS5jCisgKgorICogQ29weXJpZ2h0IDIwMDYgVHVu
Z3N0ZW4gR3JhcGhpY3MgSW5jLiwgQmlzbWFyY2ssIE5ELiwgVVNBLgorICogQWxsIHJpZ2h0
cyByZXNlcnZlZC4KKyAqCisgKiBBdXRob3JzOiBUaG9tYXMgSGVsbHN0csO2bSA8dGhvbWFz
LWF0LXR1bmdzdGVuZ3JhcGhpY3MtZG90LWNvbT4KKyAqLworCisjZGVmaW5lIFZJQV9NTV9B
TElHTl9TSElGVCA0CisjZGVmaW5lIFZJQV9NTV9BTElHTl9NQVNLICgoMSA8PCBWSUFfTU1f
QUxJR05fU0hJRlQpIC0gMSkKKworc3RydWN0IHZpYV9tZW1ibG9jayB7CisJc3RydWN0IGRy
bV9tbV9ub2RlIG1tX25vZGU7CisJc3RydWN0IGxpc3RfaGVhZCBvd25lcl9saXN0OworfTsK
KworaW50IHZpYV9hZ3BfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sKKwlkcm1fdmlhX2FncF90ICphZ3Ag
PSBkYXRhOworCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZh
dGVfdCAqKSBkZXYtPmRldl9wcml2YXRlOworCisJbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOworCWRybV9tbV9pbml0KCZkZXZfcHJpdi0+YWdwX21tLCAwLCBhZ3AtPnNpemUg
Pj4gVklBX01NX0FMSUdOX1NISUZUKTsKKworCWRldl9wcml2LT5hZ3BfaW5pdGlhbGl6ZWQg
PSAxOworCWRldl9wcml2LT5hZ3Bfb2Zmc2V0ID0gYWdwLT5vZmZzZXQ7CisJbXV0ZXhfdW5s
b2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisKKwlEUk1fREVCVUcoIm9mZnNldCA9ICV1LCBz
aXplID0gJXVcbiIsIGFncC0+b2Zmc2V0LCBhZ3AtPnNpemUpOworCXJldHVybiAwOworfQor
CitpbnQgdmlhX2ZiX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwg
c3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCit7CisJZHJtX3ZpYV9mYl90ICpmYiA9IGRh
dGE7CisJZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90
ICopIGRldi0+ZGV2X3ByaXZhdGU7CisKKwltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRl
eCk7CisJZHJtX21tX2luaXQoJmRldl9wcml2LT52cmFtX21tLCAwLCBmYi0+c2l6ZSA+PiBW
SUFfTU1fQUxJR05fU0hJRlQpOworCisJZGV2X3ByaXYtPnZyYW1faW5pdGlhbGl6ZWQgPSAx
OworCWRldl9wcml2LT52cmFtX29mZnNldCA9IGZiLT5vZmZzZXQ7CisKKwltdXRleF91bmxv
Y2soJmRldi0+c3RydWN0X211dGV4KTsKKwlEUk1fREVCVUcoIm9mZnNldCA9ICV1LCBzaXpl
ID0gJXVcbiIsIGZiLT5vZmZzZXQsIGZiLT5zaXplKTsKKworCXJldHVybiAwOworCit9CisK
K2ludCB2aWFfZmluYWxfY29udGV4dChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgY29u
dGV4dCkKK3sKKwlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2
YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKKworCXZpYV9yZWxlYXNlX2Z1dGV4KGRldl9w
cml2LCBjb250ZXh0KTsKKworCS8qIExpbnV4IHNwZWNpZmljIHVudGlsIGNvbnRleHQgdHJh
Y2tpbmcgY29kZSBnZXRzIHBvcnRlZCB0byBCU0QgKi8KKwkvKiBMYXN0IGNvbnRleHQsIHBl
cmZvcm0gY2xlYW51cCAqLworCWlmIChsaXN0X2lzX3Npbmd1bGFyKCZkZXYtPmN0eGxpc3Qp
KSB7CisJCURSTV9ERUJVRygiTGFzdCBDb250ZXh0XG4iKTsKKwkJZHJtX2xlZ2FjeV9pcnFf
dW5pbnN0YWxsKGRldik7CisJCXZpYV9jbGVhbnVwX2Z1dGV4KGRldl9wcml2KTsKKwkJdmlh
X2RvX2NsZWFudXBfbWFwKGRldik7CisJfQorCXJldHVybiAxOworfQorCit2b2lkIHZpYV9s
YXN0Y2xvc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwlkcm1fdmlhX3ByaXZhdGVf
dCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsK
KworCWlmICghZGV2X3ByaXYpCisJCXJldHVybjsKKworCW11dGV4X2xvY2soJmRldi0+c3Ry
dWN0X211dGV4KTsKKwlpZiAoZGV2X3ByaXYtPnZyYW1faW5pdGlhbGl6ZWQpIHsKKwkJZHJt
X21tX3Rha2Vkb3duKCZkZXZfcHJpdi0+dnJhbV9tbSk7CisJCWRldl9wcml2LT52cmFtX2lu
aXRpYWxpemVkID0gMDsKKwl9CisJaWYgKGRldl9wcml2LT5hZ3BfaW5pdGlhbGl6ZWQpIHsK
KwkJZHJtX21tX3Rha2Vkb3duKCZkZXZfcHJpdi0+YWdwX21tKTsKKwkJZGV2X3ByaXYtPmFn
cF9pbml0aWFsaXplZCA9IDA7CisJfQorCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0
ZXgpOworfQorCitpbnQgdmlhX21lbV9hbGxvYyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAorCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKK3sKKwlkcm1fdmlhX21l
bV90ICptZW0gPSBkYXRhOworCWludCByZXR2YWwgPSAwLCB1c2VyX2tleTsKKwlzdHJ1Y3Qg
dmlhX21lbWJsb2NrICppdGVtOworCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChk
cm1fdmlhX3ByaXZhdGVfdCAqKSBkZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCB2aWFfZmls
ZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKKwl1bnNpZ25lZCBs
b25nIHRtcFNpemU7CisKKwlpZiAobWVtLT50eXBlID4gVklBX01FTV9BR1ApIHsKKwkJRFJN
X0VSUk9SKCJVbmtub3duIG1lbW9yeSB0eXBlIGFsbG9jYXRpb25cbiIpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCWlmICgw
ID09ICgobWVtLT50eXBlID09IFZJQV9NRU1fVklERU8pID8gZGV2X3ByaXYtPnZyYW1faW5p
dGlhbGl6ZWQgOgorCQkgICAgICBkZXZfcHJpdi0+YWdwX2luaXRpYWxpemVkKSkgeworCQlt
dXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKwkJRFJNX0VSUk9SCisJCSAgICAo
IkF0dGVtcHQgdG8gYWxsb2NhdGUgZnJvbSB1bmluaXRpYWxpemVkIG1lbW9yeSBtYW5hZ2Vy
LlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWl0ZW0gPSBremFsbG9jKHNpemVv
ZigqaXRlbSksIEdGUF9LRVJORUwpOworCWlmICghaXRlbSkgeworCQlyZXR2YWwgPSAtRU5P
TUVNOworCQlnb3RvIGZhaWxfYWxsb2M7CisJfQorCisJdG1wU2l6ZSA9IChtZW0tPnNpemUg
KyBWSUFfTU1fQUxJR05fTUFTSykgPj4gVklBX01NX0FMSUdOX1NISUZUOworCWlmIChtZW0t
PnR5cGUgPT0gVklBX01FTV9BR1ApCisJCXJldHZhbCA9IGRybV9tbV9pbnNlcnRfbm9kZSgm
ZGV2X3ByaXYtPmFncF9tbSwKKwkJCQkJICAgICZpdGVtLT5tbV9ub2RlLAorCQkJCQkgICAg
dG1wU2l6ZSk7CisJZWxzZQorCQlyZXR2YWwgPSBkcm1fbW1faW5zZXJ0X25vZGUoJmRldl9w
cml2LT52cmFtX21tLAorCQkJCQkgICAgJml0ZW0tPm1tX25vZGUsCisJCQkJCSAgICB0bXBT
aXplKTsKKwlpZiAocmV0dmFsKQorCQlnb3RvIGZhaWxfYWxsb2M7CisKKwlyZXR2YWwgPSBp
ZHJfYWxsb2MoJmRldl9wcml2LT5vYmplY3RfaWRyLCBpdGVtLCAxLCAwLCBHRlBfS0VSTkVM
KTsKKwlpZiAocmV0dmFsIDwgMCkKKwkJZ290byBmYWlsX2lkcjsKKwl1c2VyX2tleSA9IHJl
dHZhbDsKKworCWxpc3RfYWRkKCZpdGVtLT5vd25lcl9saXN0LCAmZmlsZV9wcml2LT5vYmpf
bGlzdCk7CisJbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisKKwltZW0tPm9m
ZnNldCA9ICgobWVtLT50eXBlID09IFZJQV9NRU1fVklERU8pID8KKwkJICAgICAgZGV2X3By
aXYtPnZyYW1fb2Zmc2V0IDogZGV2X3ByaXYtPmFncF9vZmZzZXQpICsKKwkgICAgKChpdGVt
LT5tbV9ub2RlLnN0YXJ0KSA8PCBWSUFfTU1fQUxJR05fU0hJRlQpOworCW1lbS0+aW5kZXgg
PSB1c2VyX2tleTsKKworCXJldHVybiAwOworCitmYWlsX2lkcjoKKwlkcm1fbW1fcmVtb3Zl
X25vZGUoJml0ZW0tPm1tX25vZGUpOworZmFpbF9hbGxvYzoKKwlrZnJlZShpdGVtKTsKKwlt
dXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKworCW1lbS0+b2Zmc2V0ID0gMDsK
KwltZW0tPnNpemUgPSAwOworCW1lbS0+aW5kZXggPSAwOworCURSTV9ERUJVRygiVmlkZW8g
bWVtb3J5IGFsbG9jYXRpb24gZmFpbGVkXG4iKTsKKworCXJldHVybiByZXR2YWw7Cit9CisK
K2ludCB2aWFfbWVtX2ZyZWUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwg
c3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCit7CisJZHJtX3ZpYV9wcml2YXRlX3QgKmRl
dl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwlkcm1fdmlhX21lbV90ICptZW0gPSBkYXRh
OworCXN0cnVjdCB2aWFfbWVtYmxvY2sgKm9iajsKKworCW11dGV4X2xvY2soJmRldi0+c3Ry
dWN0X211dGV4KTsKKwlvYmogPSBpZHJfZmluZCgmZGV2X3ByaXYtPm9iamVjdF9pZHIsIG1l
bS0+aW5kZXgpOworCWlmIChvYmogPT0gTlVMTCkgeworCQltdXRleF91bmxvY2soJmRldi0+
c3RydWN0X211dGV4KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWRyX3JlbW92ZSgm
ZGV2X3ByaXYtPm9iamVjdF9pZHIsIG1lbS0+aW5kZXgpOworCWxpc3RfZGVsKCZvYmotPm93
bmVyX2xpc3QpOworCWRybV9tbV9yZW1vdmVfbm9kZSgmb2JqLT5tbV9ub2RlKTsKKwlrZnJl
ZShvYmopOworCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJRFJNX0RF
QlVHKCJmcmVlID0gMHglbHhcbiIsIG1lbS0+aW5kZXgpOworCisJcmV0dXJuIDA7Cit9CisK
Kwordm9pZCB2aWFfcmVjbGFpbV9idWZmZXJzX2xvY2tlZChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAorCQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKK3sKKwlzdHJ1Y3QgdmlhX2ZpbGVf
cHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CisJc3RydWN0IHZpYV9t
ZW1ibG9jayAqZW50cnksICpuZXh0OworCisJaWYgKCEoZGV2LT5tYXN0ZXIgJiYgZmlsZS0+
bWFzdGVyLT5sb2NrLmh3X2xvY2spKQorCQlyZXR1cm47CisKKwlkcm1fbGVnYWN5X2lkbGVs
b2NrX3Rha2UoJmZpbGUtPm1hc3Rlci0+bG9jayk7CisKKwltdXRleF9sb2NrKCZkZXYtPnN0
cnVjdF9tdXRleCk7CisJaWYgKGxpc3RfZW1wdHkoJmZpbGVfcHJpdi0+b2JqX2xpc3QpKSB7
CisJCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCQlkcm1fbGVnYWN5X2lk
bGVsb2NrX3JlbGVhc2UoJmZpbGUtPm1hc3Rlci0+bG9jayk7CisKKwkJcmV0dXJuOworCX0K
KworCXZpYV9kcml2ZXJfZG1hX3F1aWVzY2VudChkZXYpOworCisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGVudHJ5LCBuZXh0LCAmZmlsZV9wcml2LT5vYmpfbGlzdCwKKwkJCQkgb3du
ZXJfbGlzdCkgeworCQlsaXN0X2RlbCgmZW50cnktPm93bmVyX2xpc3QpOworCQlkcm1fbW1f
cmVtb3ZlX25vZGUoJmVudHJ5LT5tbV9ub2RlKTsKKwkJa2ZyZWUoZW50cnkpOworCX0KKwlt
dXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKworCWRybV9sZWdhY3lfaWRsZWxv
Y2tfcmVsZWFzZSgmZmlsZS0+bWFzdGVyLT5sb2NrKTsKKworCXJldHVybjsKK30KKworLyoK
KyAqIExlZ2FjeSBmaWxlOiB2aWFfdmVyaWZpZXIuYworICoKKyAqIENvcHlyaWdodCAyMDA0
IFRoZSBVbmljaHJvbWUgUHJvamVjdC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqIENvcHly
aWdodCAyMDA1IFRob21hcyBIZWxsc3Ryb20uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgor
ICogQXV0aG9yOiBUaG9tYXMgSGVsbHN0cm9tIDIwMDQsIDIwMDUuCisgKiBUaGlzIGNvZGUg
d2FzIHdyaXR0ZW4gdXNpbmcgZG9jcyBvYnRhaW5lZCB1bmRlciBOREEgZnJvbSBWSUEgSW5j
LgorICoKKyAqIERvbid0IHJ1biB0aGlzIGNvZGUgZGlyZWN0bHkgb24gYW4gQUdQIGJ1ZmZl
ci4gRHVlIHRvIGNhY2hlIHByb2JsZW1zIGl0IHdpbGwKKyAqIGJlIHZlcnkgc2xvdy4KKyAq
LworCit0eXBlZGVmIGVudW0geworCXN0YXRlX2NvbW1hbmQsCisJc3RhdGVfaGVhZGVyMiwK
KwlzdGF0ZV9oZWFkZXIxLAorCXN0YXRlX3ZoZWFkZXI1LAorCXN0YXRlX3ZoZWFkZXI2LAor
CXN0YXRlX2Vycm9yCit9IHZlcmlmaWVyX3N0YXRlX3Q7CisKK3R5cGVkZWYgZW51bSB7CisJ
bm9fY2hlY2sgPSAwLAorCWNoZWNrX2Zvcl9oZWFkZXIyLAorCWNoZWNrX2Zvcl9oZWFkZXIx
LAorCWNoZWNrX2Zvcl9oZWFkZXIyX2VyciwKKwljaGVja19mb3JfaGVhZGVyMV9lcnIsCisJ
Y2hlY2tfZm9yX2ZpcmUsCisJY2hlY2tfel9idWZmZXJfYWRkcjAsCisJY2hlY2tfel9idWZm
ZXJfYWRkcjEsCisJY2hlY2tfel9idWZmZXJfYWRkcl9tb2RlLAorCWNoZWNrX2Rlc3RpbmF0
aW9uX2FkZHIwLAorCWNoZWNrX2Rlc3RpbmF0aW9uX2FkZHIxLAorCWNoZWNrX2Rlc3RpbmF0
aW9uX2FkZHJfbW9kZSwKKwljaGVja19mb3JfZHVtbXksCisJY2hlY2tfZm9yX2RkLAorCWNo
ZWNrX3RleHR1cmVfYWRkcjAsCisJY2hlY2tfdGV4dHVyZV9hZGRyMSwKKwljaGVja190ZXh0
dXJlX2FkZHIyLAorCWNoZWNrX3RleHR1cmVfYWRkcjMsCisJY2hlY2tfdGV4dHVyZV9hZGRy
NCwKKwljaGVja190ZXh0dXJlX2FkZHI1LAorCWNoZWNrX3RleHR1cmVfYWRkcjYsCisJY2hl
Y2tfdGV4dHVyZV9hZGRyNywKKwljaGVja190ZXh0dXJlX2FkZHI4LAorCWNoZWNrX3RleHR1
cmVfYWRkcl9tb2RlLAorCWNoZWNrX2Zvcl92ZXJ0ZXhfY291bnQsCisJY2hlY2tfbnVtYmVy
X3RleHVuaXRzLAorCWZvcmJpZGRlbl9jb21tYW5kCit9IGhhemFyZF90OworCisvKgorICog
QXNzb2NpYXRlcyBlYWNoIGhhemFyZCBhYm92ZSB3aXRoIGEgcG9zc2libGUgbXVsdGktY29t
bWFuZAorICogc2VxdWVuY2UuIEZvciBleGFtcGxlIGFuIGFkZHJlc3MgdGhhdCBpcyBzcGxp
dCBvdmVyIG11bHRpcGxlCisgKiBjb21tYW5kcyBhbmQgdGhhdCBuZWVkcyB0byBiZSBjaGVj
a2VkIGF0IHRoZSBmaXJzdCBjb21tYW5kCisgKiB0aGF0IGRvZXMgbm90IGluY2x1ZGUgYW55
IHBhcnQgb2YgdGhlIGFkZHJlc3MuCisgKi8KKworc3RhdGljIGRybV92aWFfc2VxdWVuY2Vf
dCBzZXFzW10gPSB7CisJbm9fc2VxdWVuY2UsCisJbm9fc2VxdWVuY2UsCisJbm9fc2VxdWVu
Y2UsCisJbm9fc2VxdWVuY2UsCisJbm9fc2VxdWVuY2UsCisJbm9fc2VxdWVuY2UsCisJel9h
ZGRyZXNzLAorCXpfYWRkcmVzcywKKwl6X2FkZHJlc3MsCisJZGVzdF9hZGRyZXNzLAorCWRl
c3RfYWRkcmVzcywKKwlkZXN0X2FkZHJlc3MsCisJbm9fc2VxdWVuY2UsCisJbm9fc2VxdWVu
Y2UsCisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJdGV4
X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3Ms
CisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJdGV4X2FkZHJlc3MsCisJbm9fc2Vx
dWVuY2UKK307CisKK3R5cGVkZWYgc3RydWN0IHsKKwl1bnNpZ25lZCBpbnQgY29kZTsKKwlo
YXphcmRfdCBoejsKK30gaHpfaW5pdF90OworCitzdGF0aWMgaHpfaW5pdF90IGluaXRfdGFi
bGUxW10gPSB7CisJezB4ZjIsIGNoZWNrX2Zvcl9oZWFkZXIyX2Vycn0sCisJezB4ZjAsIGNo
ZWNrX2Zvcl9oZWFkZXIxX2Vycn0sCisJezB4ZWUsIGNoZWNrX2Zvcl9maXJlfSwKKwl7MHhj
YywgY2hlY2tfZm9yX2R1bW15fSwKKwl7MHhkZCwgY2hlY2tfZm9yX2RkfSwKKwl7MHgwMCwg
bm9fY2hlY2t9LAorCXsweDEwLCBjaGVja196X2J1ZmZlcl9hZGRyMH0sCisJezB4MTEsIGNo
ZWNrX3pfYnVmZmVyX2FkZHIxfSwKKwl7MHgxMiwgY2hlY2tfel9idWZmZXJfYWRkcl9tb2Rl
fSwKKwl7MHgxMywgbm9fY2hlY2t9LAorCXsweDE0LCBub19jaGVja30sCisJezB4MTUsIG5v
X2NoZWNrfSwKKwl7MHgyMywgbm9fY2hlY2t9LAorCXsweDI0LCBub19jaGVja30sCisJezB4
MzMsIG5vX2NoZWNrfSwKKwl7MHgzNCwgbm9fY2hlY2t9LAorCXsweDM1LCBub19jaGVja30s
CisJezB4MzYsIG5vX2NoZWNrfSwKKwl7MHgzNywgbm9fY2hlY2t9LAorCXsweDM4LCBub19j
aGVja30sCisJezB4MzksIG5vX2NoZWNrfSwKKwl7MHgzQSwgbm9fY2hlY2t9LAorCXsweDNC
LCBub19jaGVja30sCisJezB4M0MsIG5vX2NoZWNrfSwKKwl7MHgzRCwgbm9fY2hlY2t9LAor
CXsweDNFLCBub19jaGVja30sCisJezB4NDAsIGNoZWNrX2Rlc3RpbmF0aW9uX2FkZHIwfSwK
Kwl7MHg0MSwgY2hlY2tfZGVzdGluYXRpb25fYWRkcjF9LAorCXsweDQyLCBjaGVja19kZXN0
aW5hdGlvbl9hZGRyX21vZGV9LAorCXsweDQzLCBub19jaGVja30sCisJezB4NDQsIG5vX2No
ZWNrfSwKKwl7MHg1MCwgbm9fY2hlY2t9LAorCXsweDUxLCBub19jaGVja30sCisJezB4NTIs
IG5vX2NoZWNrfSwKKwl7MHg1Mywgbm9fY2hlY2t9LAorCXsweDU0LCBub19jaGVja30sCisJ
ezB4NTUsIG5vX2NoZWNrfSwKKwl7MHg1Niwgbm9fY2hlY2t9LAorCXsweDU3LCBub19jaGVj
a30sCisJezB4NTgsIG5vX2NoZWNrfSwKKwl7MHg3MCwgbm9fY2hlY2t9LAorCXsweDcxLCBu
b19jaGVja30sCisJezB4NzgsIG5vX2NoZWNrfSwKKwl7MHg3OSwgbm9fY2hlY2t9LAorCXsw
eDdBLCBub19jaGVja30sCisJezB4N0IsIG5vX2NoZWNrfSwKKwl7MHg3Qywgbm9fY2hlY2t9
LAorCXsweDdELCBjaGVja19mb3JfdmVydGV4X2NvdW50fQorfTsKKworc3RhdGljIGh6X2lu
aXRfdCBpbml0X3RhYmxlMltdID0geworCXsweGYyLCBjaGVja19mb3JfaGVhZGVyMl9lcnJ9
LAorCXsweGYwLCBjaGVja19mb3JfaGVhZGVyMV9lcnJ9LAorCXsweGVlLCBjaGVja19mb3Jf
ZmlyZX0sCisJezB4Y2MsIGNoZWNrX2Zvcl9kdW1teX0sCisJezB4MDAsIGNoZWNrX3RleHR1
cmVfYWRkcjB9LAorCXsweDAxLCBjaGVja190ZXh0dXJlX2FkZHIwfSwKKwl7MHgwMiwgY2hl
Y2tfdGV4dHVyZV9hZGRyMH0sCisJezB4MDMsIGNoZWNrX3RleHR1cmVfYWRkcjB9LAorCXsw
eDA0LCBjaGVja190ZXh0dXJlX2FkZHIwfSwKKwl7MHgwNSwgY2hlY2tfdGV4dHVyZV9hZGRy
MH0sCisJezB4MDYsIGNoZWNrX3RleHR1cmVfYWRkcjB9LAorCXsweDA3LCBjaGVja190ZXh0
dXJlX2FkZHIwfSwKKwl7MHgwOCwgY2hlY2tfdGV4dHVyZV9hZGRyMH0sCisJezB4MDksIGNo
ZWNrX3RleHR1cmVfYWRkcjB9LAorCXsweDIwLCBjaGVja190ZXh0dXJlX2FkZHIxfSwKKwl7
MHgyMSwgY2hlY2tfdGV4dHVyZV9hZGRyMX0sCisJezB4MjIsIGNoZWNrX3RleHR1cmVfYWRk
cjF9LAorCXsweDIzLCBjaGVja190ZXh0dXJlX2FkZHI0fSwKKwl7MHgyQiwgY2hlY2tfdGV4
dHVyZV9hZGRyM30sCisJezB4MkMsIGNoZWNrX3RleHR1cmVfYWRkcjN9LAorCXsweDJELCBj
aGVja190ZXh0dXJlX2FkZHIzfSwKKwl7MHgyRSwgY2hlY2tfdGV4dHVyZV9hZGRyM30sCisJ
ezB4MkYsIGNoZWNrX3RleHR1cmVfYWRkcjN9LAorCXsweDMwLCBjaGVja190ZXh0dXJlX2Fk
ZHIzfSwKKwl7MHgzMSwgY2hlY2tfdGV4dHVyZV9hZGRyM30sCisJezB4MzIsIGNoZWNrX3Rl
eHR1cmVfYWRkcjN9LAorCXsweDMzLCBjaGVja190ZXh0dXJlX2FkZHIzfSwKKwl7MHgzNCwg
Y2hlY2tfdGV4dHVyZV9hZGRyM30sCisJezB4NEIsIGNoZWNrX3RleHR1cmVfYWRkcjV9LAor
CXsweDRDLCBjaGVja190ZXh0dXJlX2FkZHI2fSwKKwl7MHg1MSwgY2hlY2tfdGV4dHVyZV9h
ZGRyN30sCisJezB4NTIsIGNoZWNrX3RleHR1cmVfYWRkcjh9LAorCXsweDc3LCBjaGVja190
ZXh0dXJlX2FkZHIyfSwKKwl7MHg3OCwgbm9fY2hlY2t9LAorCXsweDc5LCBub19jaGVja30s
CisJezB4N0EsIG5vX2NoZWNrfSwKKwl7MHg3QiwgY2hlY2tfdGV4dHVyZV9hZGRyX21vZGV9
LAorCXsweDdDLCBub19jaGVja30sCisJezB4N0QsIG5vX2NoZWNrfSwKKwl7MHg3RSwgbm9f
Y2hlY2t9LAorCXsweDdGLCBub19jaGVja30sCisJezB4ODAsIG5vX2NoZWNrfSwKKwl7MHg4
MSwgbm9fY2hlY2t9LAorCXsweDgyLCBub19jaGVja30sCisJezB4ODMsIG5vX2NoZWNrfSwK
Kwl7MHg4NSwgbm9fY2hlY2t9LAorCXsweDg2LCBub19jaGVja30sCisJezB4ODcsIG5vX2No
ZWNrfSwKKwl7MHg4OCwgbm9fY2hlY2t9LAorCXsweDg5LCBub19jaGVja30sCisJezB4OEEs
IG5vX2NoZWNrfSwKKwl7MHg5MCwgbm9fY2hlY2t9LAorCXsweDkxLCBub19jaGVja30sCisJ
ezB4OTIsIG5vX2NoZWNrfSwKKwl7MHg5Mywgbm9fY2hlY2t9Cit9OworCitzdGF0aWMgaHpf
aW5pdF90IGluaXRfdGFibGUzW10gPSB7CisJezB4ZjIsIGNoZWNrX2Zvcl9oZWFkZXIyX2Vy
cn0sCisJezB4ZjAsIGNoZWNrX2Zvcl9oZWFkZXIxX2Vycn0sCisJezB4Y2MsIGNoZWNrX2Zv
cl9kdW1teX0sCisJezB4MDAsIGNoZWNrX251bWJlcl90ZXh1bml0c30KK307CisKK3N0YXRp
YyBoYXphcmRfdCB0YWJsZTFbMjU2XTsKK3N0YXRpYyBoYXphcmRfdCB0YWJsZTJbMjU2XTsK
K3N0YXRpYyBoYXphcmRfdCB0YWJsZTNbMjU2XTsKKworc3RhdGljIF9faW5saW5lX18gaW50
CitlYXRfd29yZHMoY29uc3QgdWludDMyX3QgKipidWYsIGNvbnN0IHVpbnQzMl90ICpidWZf
ZW5kLCB1bnNpZ25lZCBudW1fd29yZHMpCit7CisJaWYgKChidWZfZW5kIC0gKmJ1ZikgPj0g
bnVtX3dvcmRzKSB7CisJCSpidWYgKz0gbnVtX3dvcmRzOworCQlyZXR1cm4gMDsKKwl9CisJ
RFJNX0VSUk9SKCJJbGxlZ2FsIHRlcm1pbmF0aW9uIG9mIERNQSBjb21tYW5kIGJ1ZmZlclxu
Iik7CisJcmV0dXJuIDE7Cit9CisKKy8qCisgKiBQYXJ0aWFsbHkgc3RvbGVuIGZyb20gZHJt
X21lbW9yeS5oCisgKi8KKworc3RhdGljIF9faW5saW5lX18gZHJtX2xvY2FsX21hcF90ICp2
aWFfZHJtX2xvb2t1cF9hZ3BfbWFwKGRybV92aWFfc3RhdGVfdCAqc2VxLAorCQkJCQkJICAg
IHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAorCQkJCQkJICAgIHVuc2lnbmVkIGxvbmcgc2l6ZSwK
KwkJCQkJCSAgICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCXN0cnVjdCBkcm1fbWFw
X2xpc3QgKnJfbGlzdDsKKwlkcm1fbG9jYWxfbWFwX3QgKm1hcCA9IHNlcS0+bWFwX2NhY2hl
OworCisJaWYgKG1hcCAmJiBtYXAtPm9mZnNldCA8PSBvZmZzZXQKKwkgICAgJiYgKG9mZnNl
dCArIHNpemUpIDw9IChtYXAtPm9mZnNldCArIG1hcC0+c2l6ZSkpIHsKKwkJcmV0dXJuIG1h
cDsKKwl9CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHJfbGlzdCwgJmRldi0+bWFwbGlzdCwg
aGVhZCkgeworCQltYXAgPSByX2xpc3QtPm1hcDsKKwkJaWYgKCFtYXApCisJCQljb250aW51
ZTsKKwkJaWYgKG1hcC0+b2Zmc2V0IDw9IG9mZnNldAorCQkgICAgJiYgKG9mZnNldCArIHNp
emUpIDw9IChtYXAtPm9mZnNldCArIG1hcC0+c2l6ZSkKKwkJICAgICYmICEobWFwLT5mbGFn
cyAmIF9EUk1fUkVTVFJJQ1RFRCkKKwkJICAgICYmIChtYXAtPnR5cGUgPT0gX0RSTV9BR1Ap
KSB7CisJCQlzZXEtPm1hcF9jYWNoZSA9IG1hcDsKKwkJCXJldHVybiBtYXA7CisJCX0KKwl9
CisJcmV0dXJuIE5VTEw7Cit9CisKKy8qCisgKiBSZXF1aXJlIHRoYXQgYWxsIEFHUCB0ZXh0
dXJlIGxldmVscyByZXNpZGUgaW4gdGhlIHNhbWUgQUdQIG1hcCB3aGljaCBzaG91bGQKKyAq
IGJlIG1hcHBhYmxlIGJ5IHRoZSBjbGllbnQuIFRoaXMgaXMgbm90IGEgYmlnIHJlc3RyaWN0
aW9uLgorICogRklYTUU6IFRvIGFjdHVhbGx5IGVuZm9yY2UgdGhpcyBzZWN1cml0eSBwb2xp
Y3kgc3RyaWN0bHksIGRybV9ybW1hcAorICogd291bGQgaGF2ZSB0byB3YWl0IGZvciBkbWEg
cXVpZXNjZW50IGJlZm9yZSByZW1vdmluZyBhbiBBR1AgbWFwLgorICogVGhlIHZpYV9kcm1f
bG9va3VwX2FncF9tYXAgY2FsbCBpbiByZWFsaXR5IHNlZW1zIHRvIHRha2UKKyAqIHZlcnkg
bGl0dGxlIENQVSB0aW1lLgorICovCisKK3N0YXRpYyBfX2lubGluZV9fIGludCBmaW5pc2hf
Y3VycmVudF9zZXF1ZW5jZShkcm1fdmlhX3N0YXRlX3QgKiBjdXJfc2VxKQoreworCXN3aXRj
aCAoY3VyX3NlcS0+dW5maW5pc2hlZCkgeworCWNhc2Ugel9hZGRyZXNzOgorCQlEUk1fREVC
VUcoIlogQnVmZmVyIHN0YXJ0IGFkZHJlc3MgaXMgMHgleFxuIiwgY3VyX3NlcS0+el9hZGRy
KTsKKwkJYnJlYWs7CisJY2FzZSBkZXN0X2FkZHJlc3M6CisJCURSTV9ERUJVRygiRGVzdGlu
YXRpb24gc3RhcnQgYWRkcmVzcyBpcyAweCV4XG4iLAorCQkJICBjdXJfc2VxLT5kX2FkZHIp
OworCQlicmVhazsKKwljYXNlIHRleF9hZGRyZXNzOgorCQlpZiAoY3VyX3NlcS0+YWdwX3Rl
eHR1cmUpIHsKKwkJCXVuc2lnbmVkIHN0YXJ0ID0KKwkJCSAgICBjdXJfc2VxLT50ZXhfbGV2
ZWxfbG9bY3VyX3NlcS0+dGV4dHVyZV07CisJCQl1bnNpZ25lZCBlbmQgPSBjdXJfc2VxLT50
ZXhfbGV2ZWxfaGlbY3VyX3NlcS0+dGV4dHVyZV07CisJCQl1bnNpZ25lZCBsb25nIGxvID0g
fjAsIGhpID0gMCwgdG1wOworCQkJdWludDMyX3QgKmFkZHIsICpwaXRjaCwgKmhlaWdodCwg
dGV4OworCQkJdW5zaWduZWQgaTsKKwkJCWludCBucG90OworCisJCQlpZiAoZW5kID4gOSkK
KwkJCQllbmQgPSA5OworCQkJaWYgKHN0YXJ0ID4gOSkKKwkJCQlzdGFydCA9IDk7CisKKwkJ
CWFkZHIgPQorCQkJICAgICYoY3VyX3NlcS0+dF9hZGRyW3RleCA9IGN1cl9zZXEtPnRleHR1
cmVdW3N0YXJ0XSk7CisJCQlwaXRjaCA9ICYoY3VyX3NlcS0+cGl0Y2hbdGV4XVtzdGFydF0p
OworCQkJaGVpZ2h0ID0gJihjdXJfc2VxLT5oZWlnaHRbdGV4XVtzdGFydF0pOworCQkJbnBv
dCA9IGN1cl9zZXEtPnRleF9ucG90W3RleF07CisJCQlmb3IgKGkgPSBzdGFydDsgaSA8PSBl
bmQ7ICsraSkgeworCQkJCXRtcCA9ICphZGRyKys7CisJCQkJaWYgKHRtcCA8IGxvKQorCQkJ
CQlsbyA9IHRtcDsKKwkJCQlpZiAoaSA9PSAwICYmIG5wb3QpCisJCQkJCXRtcCArPSAoKmhl
aWdodCsrICogKnBpdGNoKyspOworCQkJCWVsc2UKKwkJCQkJdG1wICs9ICgqaGVpZ2h0Kysg
PDwgKnBpdGNoKyspOworCQkJCWlmICh0bXAgPiBoaSkKKwkJCQkJaGkgPSB0bXA7CisJCQl9
CisKKwkJCWlmICghdmlhX2RybV9sb29rdXBfYWdwX21hcAorCQkJICAgIChjdXJfc2VxLCBs
bywgaGkgLSBsbywgY3VyX3NlcS0+ZGV2KSkgeworCQkJCURSTV9FUlJPUgorCQkJCSAgICAo
IkFHUCB0ZXh0dXJlIGlzIG5vdCBpbiBhbGxvd2VkIG1hcFxuIik7CisJCQkJcmV0dXJuIDI7
CisJCQl9CisJCX0KKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJYnJlYWs7CisJfQorCWN1cl9z
ZXEtPnVuZmluaXNoZWQgPSBub19zZXF1ZW5jZTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IF9faW5saW5lX18gaW50CitpbnZlc3RpZ2F0ZV9oYXphcmQodWludDMyX3QgY21kLCBoYXph
cmRfdCBoeiwgZHJtX3ZpYV9zdGF0ZV90ICpjdXJfc2VxKQoreworCXJlZ2lzdGVyIHVpbnQz
Ml90IHRtcCwgKnRtcF9hZGRyOworCisJaWYgKGN1cl9zZXEtPnVuZmluaXNoZWQgJiYgKGN1
cl9zZXEtPnVuZmluaXNoZWQgIT0gc2Vxc1toel0pKSB7CisJCWludCByZXQ7CisJCWlmICgo
cmV0ID0gZmluaXNoX2N1cnJlbnRfc2VxdWVuY2UoY3VyX3NlcSkpKQorCQkJcmV0dXJuIHJl
dDsKKwl9CisKKwlzd2l0Y2ggKGh6KSB7CisJY2FzZSBjaGVja19mb3JfaGVhZGVyMjoKKwkJ
aWYgKGNtZCA9PSBIQUxDWU9OX0hFQURFUjIpCisJCQlyZXR1cm4gMTsKKwkJcmV0dXJuIDA7
CisJY2FzZSBjaGVja19mb3JfaGVhZGVyMToKKwkJaWYgKChjbWQgJiBIQUxDWU9OX0hFQURF
UjFNQVNLKSA9PSBIQUxDWU9OX0hFQURFUjEpCisJCQlyZXR1cm4gMTsKKwkJcmV0dXJuIDA7
CisJY2FzZSBjaGVja19mb3JfaGVhZGVyMl9lcnI6CisJCWlmIChjbWQgPT0gSEFMQ1lPTl9I
RUFERVIyKQorCQkJcmV0dXJuIDE7CisJCURSTV9FUlJPUigiSWxsZWdhbCBETUEgSEFMQ1lP
Tl9IRUFERVIyIGNvbW1hbmRcbiIpOworCQlicmVhazsKKwljYXNlIGNoZWNrX2Zvcl9oZWFk
ZXIxX2VycjoKKwkJaWYgKChjbWQgJiBIQUxDWU9OX0hFQURFUjFNQVNLKSA9PSBIQUxDWU9O
X0hFQURFUjEpCisJCQlyZXR1cm4gMTsKKwkJRFJNX0VSUk9SKCJJbGxlZ2FsIERNQSBIQUxD
WU9OX0hFQURFUjEgY29tbWFuZFxuIik7CisJCWJyZWFrOworCWNhc2UgY2hlY2tfZm9yX2Zp
cmU6CisJCWlmICgoY21kICYgSEFMQ1lPTl9GSVJFTUFTSykgPT0gSEFMQ1lPTl9GSVJFQ01E
KQorCQkJcmV0dXJuIDE7CisJCURSTV9FUlJPUigiSWxsZWdhbCBETUEgSEFMQ1lPTl9GSVJF
Q01EIGNvbW1hbmRcbiIpOworCQlicmVhazsKKwljYXNlIGNoZWNrX2Zvcl9kdW1teToKKwkJ
aWYgKEhDX0RVTU1ZID09IGNtZCkKKwkJCXJldHVybiAwOworCQlEUk1fRVJST1IoIklsbGVn
YWwgRE1BIEhDX0RVTU1ZIGNvbW1hbmRcbiIpOworCQlicmVhazsKKwljYXNlIGNoZWNrX2Zv
cl9kZDoKKwkJaWYgKDB4ZGRkZGRkZGQgPT0gY21kKQorCQkJcmV0dXJuIDA7CisJCURSTV9F
UlJPUigiSWxsZWdhbCBETUEgMHhkZGRkZGRkZCBjb21tYW5kXG4iKTsKKwkJYnJlYWs7CisJ
Y2FzZSBjaGVja196X2J1ZmZlcl9hZGRyMDoKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHpf
YWRkcmVzczsKKwkJY3VyX3NlcS0+el9hZGRyID0gKGN1cl9zZXEtPnpfYWRkciAmIDB4RkYw
MDAwMDApIHwKKwkJICAgIChjbWQgJiAweDAwRkZGRkZGKTsKKwkJcmV0dXJuIDA7CisJY2Fz
ZSBjaGVja196X2J1ZmZlcl9hZGRyMToKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHpfYWRk
cmVzczsKKwkJY3VyX3NlcS0+el9hZGRyID0gKGN1cl9zZXEtPnpfYWRkciAmIDB4MDBGRkZG
RkYpIHwKKwkJICAgICgoY21kICYgMHhGRikgPDwgMjQpOworCQlyZXR1cm4gMDsKKwljYXNl
IGNoZWNrX3pfYnVmZmVyX2FkZHJfbW9kZToKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHpf
YWRkcmVzczsKKwkJaWYgKChjbWQgJiAweDAwMDBDMDAwKSA9PSAwKQorCQkJcmV0dXJuIDA7
CisJCURSTV9FUlJPUigiQXR0ZW1wdCB0byBwbGFjZSBaIGJ1ZmZlciBpbiBzeXN0ZW0gbWVt
b3J5XG4iKTsKKwkJcmV0dXJuIDI7CisJY2FzZSBjaGVja19kZXN0aW5hdGlvbl9hZGRyMDoK
KwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IGRlc3RfYWRkcmVzczsKKwkJY3VyX3NlcS0+ZF9h
ZGRyID0gKGN1cl9zZXEtPmRfYWRkciAmIDB4RkYwMDAwMDApIHwKKwkJICAgIChjbWQgJiAw
eDAwRkZGRkZGKTsKKwkJcmV0dXJuIDA7CisJY2FzZSBjaGVja19kZXN0aW5hdGlvbl9hZGRy
MToKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IGRlc3RfYWRkcmVzczsKKwkJY3VyX3NlcS0+
ZF9hZGRyID0gKGN1cl9zZXEtPmRfYWRkciAmIDB4MDBGRkZGRkYpIHwKKwkJICAgICgoY21k
ICYgMHhGRikgPDwgMjQpOworCQlyZXR1cm4gMDsKKwljYXNlIGNoZWNrX2Rlc3RpbmF0aW9u
X2FkZHJfbW9kZToKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IGRlc3RfYWRkcmVzczsKKwkJ
aWYgKChjbWQgJiAweDAwMDBDMDAwKSA9PSAwKQorCQkJcmV0dXJuIDA7CisJCURSTV9FUlJP
UgorCQkgICAgKCJBdHRlbXB0IHRvIHBsYWNlIDNEIGRyYXdpbmcgYnVmZmVyIGluIHN5c3Rl
bSBtZW1vcnlcbiIpOworCQlyZXR1cm4gMjsKKwljYXNlIGNoZWNrX3RleHR1cmVfYWRkcjA6
CisJCWN1cl9zZXEtPnVuZmluaXNoZWQgPSB0ZXhfYWRkcmVzczsKKwkJdG1wID0gKGNtZCA+
PiAyNCk7CisJCXRtcF9hZGRyID0gJmN1cl9zZXEtPnRfYWRkcltjdXJfc2VxLT50ZXh0dXJl
XVt0bXBdOworCQkqdG1wX2FkZHIgPSAoKnRtcF9hZGRyICYgMHhGRjAwMDAwMCkgfCAoY21k
ICYgMHgwMEZGRkZGRik7CisJCXJldHVybiAwOworCWNhc2UgY2hlY2tfdGV4dHVyZV9hZGRy
MToKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOworCQl0bXAgPSAoKGNt
ZCA+PiAyNCkgLSAweDIwKTsKKwkJdG1wICs9IHRtcCA8PCAxOworCQl0bXBfYWRkciA9ICZj
dXJfc2VxLT50X2FkZHJbY3VyX3NlcS0+dGV4dHVyZV1bdG1wXTsKKwkJKnRtcF9hZGRyID0g
KCp0bXBfYWRkciAmIDB4MDBGRkZGRkYpIHwgKChjbWQgJiAweEZGKSA8PCAyNCk7CisJCXRt
cF9hZGRyKys7CisJCSp0bXBfYWRkciA9ICgqdG1wX2FkZHIgJiAweDAwRkZGRkZGKSB8ICgo
Y21kICYgMHhGRjAwKSA8PCAxNik7CisJCXRtcF9hZGRyKys7CisJCSp0bXBfYWRkciA9ICgq
dG1wX2FkZHIgJiAweDAwRkZGRkZGKSB8ICgoY21kICYgMHhGRjAwMDApIDw8IDgpOworCQly
ZXR1cm4gMDsKKwljYXNlIGNoZWNrX3RleHR1cmVfYWRkcjI6CisJCWN1cl9zZXEtPnVuZmlu
aXNoZWQgPSB0ZXhfYWRkcmVzczsKKwkJY3VyX3NlcS0+dGV4X2xldmVsX2xvW3RtcCA9IGN1
cl9zZXEtPnRleHR1cmVdID0gY21kICYgMHgzRjsKKwkJY3VyX3NlcS0+dGV4X2xldmVsX2hp
W3RtcF0gPSAoY21kICYgMHhGQzApID4+IDY7CisJCXJldHVybiAwOworCWNhc2UgY2hlY2tf
dGV4dHVyZV9hZGRyMzoKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOwor
CQl0bXAgPSAoKGNtZCA+PiAyNCkgLSBIQ19TdWJBX0hUWG5MMFBpdCk7CisJCWlmICh0bXAg
PT0gMCAmJgorCQkgICAgKGNtZCAmIEhDX0hUWG5FblBpdF9NQVNLKSkgeworCQkJY3VyX3Nl
cS0+cGl0Y2hbY3VyX3NlcS0+dGV4dHVyZV1bdG1wXSA9CisJCQkJKGNtZCAmIEhDX0hUWG5M
blBpdF9NQVNLKTsKKwkJCWN1cl9zZXEtPnRleF9ucG90W2N1cl9zZXEtPnRleHR1cmVdID0g
MTsKKwkJfSBlbHNlIHsKKwkJCWN1cl9zZXEtPnBpdGNoW2N1cl9zZXEtPnRleHR1cmVdW3Rt
cF0gPQorCQkJCShjbWQgJiBIQ19IVFhuTG5QaXRFX01BU0spID4+IEhDX0hUWG5MblBpdEVf
U0hJRlQ7CisJCQljdXJfc2VxLT50ZXhfbnBvdFtjdXJfc2VxLT50ZXh0dXJlXSA9IDA7CisJ
CQlpZiAoY21kICYgMHgwMDBGRkZGRikgeworCQkJCURSTV9FUlJPUgorCQkJCQkoIlVuaW1w
bGVtZW50ZWQgdGV4dHVyZSBsZXZlbCAwIHBpdGNoIG1vZGUuXG4iKTsKKwkJCQlyZXR1cm4g
MjsKKwkJCX0KKwkJfQorCQlyZXR1cm4gMDsKKwljYXNlIGNoZWNrX3RleHR1cmVfYWRkcjQ6
CisJCWN1cl9zZXEtPnVuZmluaXNoZWQgPSB0ZXhfYWRkcmVzczsKKwkJdG1wX2FkZHIgPSAm
Y3VyX3NlcS0+dF9hZGRyW2N1cl9zZXEtPnRleHR1cmVdWzldOworCQkqdG1wX2FkZHIgPSAo
KnRtcF9hZGRyICYgMHgwMEZGRkZGRikgfCAoKGNtZCAmIDB4RkYpIDw8IDI0KTsKKwkJcmV0
dXJuIDA7CisJY2FzZSBjaGVja190ZXh0dXJlX2FkZHI1OgorCWNhc2UgY2hlY2tfdGV4dHVy
ZV9hZGRyNjoKKwkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOworCQkvKgor
CQkgKiBUZXh0dXJlIHdpZHRoLiBXZSBkb24ndCBjYXJlIHNpbmNlIHdlIGhhdmUgdGhlIHBp
dGNoLgorCQkgKi8KKwkJcmV0dXJuIDA7CisJY2FzZSBjaGVja190ZXh0dXJlX2FkZHI3Ogor
CQljdXJfc2VxLT51bmZpbmlzaGVkID0gdGV4X2FkZHJlc3M7CisJCXRtcF9hZGRyID0gJihj
dXJfc2VxLT5oZWlnaHRbY3VyX3NlcS0+dGV4dHVyZV1bMF0pOworCQl0bXBfYWRkcls1XSA9
IDEgPDwgKChjbWQgJiAweDAwRjAwMDAwKSA+PiAyMCk7CisJCXRtcF9hZGRyWzRdID0gMSA8
PCAoKGNtZCAmIDB4MDAwRjAwMDApID4+IDE2KTsKKwkJdG1wX2FkZHJbM10gPSAxIDw8ICgo
Y21kICYgMHgwMDAwRjAwMCkgPj4gMTIpOworCQl0bXBfYWRkclsyXSA9IDEgPDwgKChjbWQg
JiAweDAwMDAwRjAwKSA+PiA4KTsKKwkJdG1wX2FkZHJbMV0gPSAxIDw8ICgoY21kICYgMHgw
MDAwMDBGMCkgPj4gNCk7CisJCXRtcF9hZGRyWzBdID0gMSA8PCAoY21kICYgMHgwMDAwMDAw
Rik7CisJCXJldHVybiAwOworCWNhc2UgY2hlY2tfdGV4dHVyZV9hZGRyODoKKwkJY3VyX3Nl
cS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOworCQl0bXBfYWRkciA9ICYoY3VyX3NlcS0+
aGVpZ2h0W2N1cl9zZXEtPnRleHR1cmVdWzBdKTsKKwkJdG1wX2FkZHJbOV0gPSAxIDw8ICgo
Y21kICYgMHgwMDAwRjAwMCkgPj4gMTIpOworCQl0bXBfYWRkcls4XSA9IDEgPDwgKChjbWQg
JiAweDAwMDAwRjAwKSA+PiA4KTsKKwkJdG1wX2FkZHJbN10gPSAxIDw8ICgoY21kICYgMHgw
MDAwMDBGMCkgPj4gNCk7CisJCXRtcF9hZGRyWzZdID0gMSA8PCAoY21kICYgMHgwMDAwMDAw
Rik7CisJCXJldHVybiAwOworCWNhc2UgY2hlY2tfdGV4dHVyZV9hZGRyX21vZGU6CisJCWN1
cl9zZXEtPnVuZmluaXNoZWQgPSB0ZXhfYWRkcmVzczsKKwkJaWYgKDIgPT0gKHRtcCA9IGNt
ZCAmIDB4MDAwMDAwMDMpKSB7CisJCQlEUk1fRVJST1IKKwkJCSAgICAoIkF0dGVtcHQgdG8g
ZmV0Y2ggdGV4dHVyZSBmcm9tIHN5c3RlbSBtZW1vcnkuXG4iKTsKKwkJCXJldHVybiAyOwor
CQl9CisJCWN1cl9zZXEtPmFncF90ZXh0dXJlID0gKHRtcCA9PSAzKTsKKwkJY3VyX3NlcS0+
dGV4X3BhbGV0dGVfc2l6ZVtjdXJfc2VxLT50ZXh0dXJlXSA9CisJCSAgICAoY21kID4+IDE2
KSAmIDB4MDAwMDAwMDA3OworCQlyZXR1cm4gMDsKKwljYXNlIGNoZWNrX2Zvcl92ZXJ0ZXhf
Y291bnQ6CisJCWN1cl9zZXEtPnZlcnRleF9jb3VudCA9IGNtZCAmIDB4MDAwMEZGRkY7CisJ
CXJldHVybiAwOworCWNhc2UgY2hlY2tfbnVtYmVyX3RleHVuaXRzOgorCQljdXJfc2VxLT5t
dWx0aXRleCA9IChjbWQgPj4gMykgJiAxOworCQlyZXR1cm4gMDsKKwlkZWZhdWx0OgorCQlE
Uk1fRVJST1IoIklsbGVnYWwgRE1BIGRhdGE6IDB4JXhcbiIsIGNtZCk7CisJCXJldHVybiAy
OworCX0KKwlyZXR1cm4gMjsKK30KKworc3RhdGljIF9faW5saW5lX18gaW50Cit2aWFfY2hl
Y2tfcHJpbV9saXN0KHVpbnQzMl90IGNvbnN0ICoqYnVmZmVyLCBjb25zdCB1aW50MzJfdCAq
IGJ1Zl9lbmQsCisJCSAgICBkcm1fdmlhX3N0YXRlX3QgKmN1cl9zZXEpCit7CisJZHJtX3Zp
YV9wcml2YXRlX3QgKmRldl9wcml2ID0KKwkgICAgKGRybV92aWFfcHJpdmF0ZV90ICopIGN1
cl9zZXEtPmRldi0+ZGV2X3ByaXZhdGU7CisJdWludDMyX3QgYV9maXJlLCBiY21kLCBkd19j
b3VudDsKKwlpbnQgcmV0ID0gMDsKKwlpbnQgaGF2ZV9maXJlOworCWNvbnN0IHVpbnQzMl90
ICpidWYgPSAqYnVmZmVyOworCisJd2hpbGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsKKwkJaGF2ZV9m
aXJlID0gMDsKKwkJaWYgKChidWZfZW5kIC0gYnVmKSA8IDIpIHsKKwkJCURSTV9FUlJPUgor
CQkJICAgICgiVW5leHBlY3RlZCB0ZXJtaW5hdGlvbiBvZiBwcmltaXRpdmUgbGlzdC5cbiIp
OworCQkJcmV0ID0gMTsKKwkJCWJyZWFrOworCQl9CisJCWlmICgoKmJ1ZiAmIEhDX0FDTURf
TUFTSykgIT0gSENfQUNNRF9IQ21kQikKKwkJCWJyZWFrOworCQliY21kID0gKmJ1ZisrOwor
CQlpZiAoKCpidWYgJiBIQ19BQ01EX01BU0spICE9IEhDX0FDTURfSENtZEEpIHsKKwkJCURS
TV9FUlJPUigiRXhwZWN0ZWQgVmVydGV4IExpc3QgQSBjb21tYW5kLCBnb3QgMHgleFxuIiwK
KwkJCQkgICpidWYpOworCQkJcmV0ID0gMTsKKwkJCWJyZWFrOworCQl9CisJCWFfZmlyZSA9
CisJCSAgICAqYnVmKysgfCBIQ19IUExFTkRfTUFTSyB8IEhDX0hQTVZhbGlkTl9NQVNLIHwK
KwkJICAgIEhDX0hFM0ZpcmVfTUFTSzsKKworCQkvKgorCQkgKiBIb3cgbWFueSBkd29yZHMg
cGVyIHZlcnRleCA/CisJCSAqLworCisJCWlmIChjdXJfc2VxLT5hZ3AgJiYgKChiY21kICYg
KDB4RiA8PCAxMSkpID09IDApKSB7CisJCQlEUk1fRVJST1IoIklsbGVnYWwgQiBjb21tYW5k
IHZlcnRleCBkYXRhIGZvciBBR1AuXG4iKTsKKwkJCXJldCA9IDE7CisJCQlicmVhazsKKwkJ
fQorCisJCWR3X2NvdW50ID0gMDsKKwkJaWYgKGJjbWQgJiAoMSA8PCA3KSkKKwkJCWR3X2Nv
dW50ICs9IChjdXJfc2VxLT5tdWx0aXRleCkgPyAyIDogMTsKKwkJaWYgKGJjbWQgJiAoMSA8
PCA4KSkKKwkJCWR3X2NvdW50ICs9IChjdXJfc2VxLT5tdWx0aXRleCkgPyAyIDogMTsKKwkJ
aWYgKGJjbWQgJiAoMSA8PCA5KSkKKwkJCWR3X2NvdW50Kys7CisJCWlmIChiY21kICYgKDEg
PDwgMTApKQorCQkJZHdfY291bnQrKzsKKwkJaWYgKGJjbWQgJiAoMSA8PCAxMSkpCisJCQlk
d19jb3VudCsrOworCQlpZiAoYmNtZCAmICgxIDw8IDEyKSkKKwkJCWR3X2NvdW50Kys7CisJ
CWlmIChiY21kICYgKDEgPDwgMTMpKQorCQkJZHdfY291bnQrKzsKKwkJaWYgKGJjbWQgJiAo
MSA8PCAxNCkpCisJCQlkd19jb3VudCsrOworCisJCXdoaWxlIChidWYgPCBidWZfZW5kKSB7
CisJCQlpZiAoKmJ1ZiA9PSBhX2ZpcmUpIHsKKwkJCQlpZiAoZGV2X3ByaXYtPm51bV9maXJl
X29mZnNldHMgPj0KKwkJCQkgICAgVklBX0ZJUkVfQlVGX1NJWkUpIHsKKwkJCQkJRFJNX0VS
Uk9SKCJGaXJlIG9mZnNldCBidWZmZXIgZnVsbC5cbiIpOworCQkJCQlyZXQgPSAxOworCQkJ
CQlicmVhazsKKwkJCQl9CisJCQkJZGV2X3ByaXYtPmZpcmVfb2Zmc2V0c1tkZXZfcHJpdi0+
CisJCQkJCQkgICAgICAgbnVtX2ZpcmVfb2Zmc2V0cysrXSA9CisJCQkJICAgIGJ1ZjsKKwkJ
CQloYXZlX2ZpcmUgPSAxOworCQkJCWJ1ZisrOworCQkJCWlmIChidWYgPCBidWZfZW5kICYm
ICpidWYgPT0gYV9maXJlKQorCQkJCQlidWYrKzsKKwkJCQlicmVhazsKKwkJCX0KKwkJCWlm
ICgoKmJ1ZiA9PSBIQUxDWU9OX0hFQURFUjIpIHx8CisJCQkgICAgKCgqYnVmICYgSEFMQ1lP
Tl9GSVJFTUFTSykgPT0gSEFMQ1lPTl9GSVJFQ01EKSkgeworCQkJCURSTV9FUlJPUigiTWlz
c2luZyBWZXJ0ZXggRmlyZSBjb21tYW5kLCAiCisJCQkJCSAgIlN0cmF5IFZlcnRleCBGaXJl
IGNvbW1hbmQgIG9yIHZlcmlmaWVyICIKKwkJCQkJICAibG9zdCBzeW5jLlxuIik7CisJCQkJ
cmV0ID0gMTsKKwkJCQlicmVhazsKKwkJCX0KKwkJCWlmICgocmV0ID0gZWF0X3dvcmRzKCZi
dWYsIGJ1Zl9lbmQsIGR3X2NvdW50KSkpCisJCQkJYnJlYWs7CisJCX0KKwkJaWYgKGJ1ZiA+
PSBidWZfZW5kICYmICFoYXZlX2ZpcmUpIHsKKwkJCURSTV9FUlJPUigiTWlzc2luZyBWZXJ0
ZXggRmlyZSBjb21tYW5kIG9yIHZlcmlmaWVyICIKKwkJCQkgICJsb3N0IHN5bmMuXG4iKTsK
KwkJCXJldCA9IDE7CisJCQlicmVhazsKKwkJfQorCQlpZiAoY3VyX3NlcS0+YWdwICYmICgo
YnVmIC0gY3VyX3NlcS0+YnVmX3N0YXJ0KSAmIDB4MDEpKSB7CisJCQlEUk1fRVJST1IoIkFH
UCBQcmltaXRpdmUgbGlzdCBlbmQgbWlzYWxpZ25lZC5cbiIpOworCQkJcmV0ID0gMTsKKwkJ
CWJyZWFrOworCQl9CisJfQorCSpidWZmZXIgPSBidWY7CisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIF9faW5saW5lX18gdmVyaWZpZXJfc3RhdGVfdAordmlhX2NoZWNrX2hlYWRlcjIo
dWludDMyX3QgY29uc3QgKipidWZmZXIsIGNvbnN0IHVpbnQzMl90ICpidWZfZW5kLAorCQkg
IGRybV92aWFfc3RhdGVfdCAqaGNfc3RhdGUpCit7CisJdWludDMyX3QgY21kOworCWludCBo
el9tb2RlOworCWhhemFyZF90IGh6OworCWNvbnN0IHVpbnQzMl90ICpidWYgPSAqYnVmZmVy
OworCWNvbnN0IGhhemFyZF90ICpoel90YWJsZTsKKworCWlmICgoYnVmX2VuZCAtIGJ1Zikg
PCAyKSB7CisJCURSTV9FUlJPUgorCQkgICAgKCJJbGxlZ2FsIHRlcm1pbmF0aW9uIG9mIERN
QSBIQUxDWU9OX0hFQURFUjIgc2VxdWVuY2UuXG4iKTsKKwkJcmV0dXJuIHN0YXRlX2Vycm9y
OworCX0KKwlidWYrKzsKKwljbWQgPSAoKmJ1ZisrICYgMHhGRkZGMDAwMCkgPj4gMTY7CisK
Kwlzd2l0Y2ggKGNtZCkgeworCWNhc2UgSENfUGFyYVR5cGVfQ21kVmRhdGE6CisJCWlmICh2
aWFfY2hlY2tfcHJpbV9saXN0KCZidWYsIGJ1Zl9lbmQsIGhjX3N0YXRlKSkKKwkJCXJldHVy
biBzdGF0ZV9lcnJvcjsKKwkJKmJ1ZmZlciA9IGJ1ZjsKKwkJcmV0dXJuIHN0YXRlX2NvbW1h
bmQ7CisJY2FzZSBIQ19QYXJhVHlwZV9Ob3RUZXg6CisJCWh6X3RhYmxlID0gdGFibGUxOwor
CQlicmVhazsKKwljYXNlIEhDX1BhcmFUeXBlX1RleDoKKwkJaGNfc3RhdGUtPnRleHR1cmUg
PSAwOworCQloel90YWJsZSA9IHRhYmxlMjsKKwkJYnJlYWs7CisJY2FzZSAoSENfUGFyYVR5
cGVfVGV4IHwgKEhDX1N1YlR5cGVfVGV4MSA8PCA4KSk6CisJCWhjX3N0YXRlLT50ZXh0dXJl
ID0gMTsKKwkJaHpfdGFibGUgPSB0YWJsZTI7CisJCWJyZWFrOworCWNhc2UgKEhDX1BhcmFU
eXBlX1RleCB8IChIQ19TdWJUeXBlX1RleEdlbmVyYWwgPDwgOCkpOgorCQloel90YWJsZSA9
IHRhYmxlMzsKKwkJYnJlYWs7CisJY2FzZSBIQ19QYXJhVHlwZV9BdXRvOgorCQlpZiAoZWF0
X3dvcmRzKCZidWYsIGJ1Zl9lbmQsIDIpKQorCQkJcmV0dXJuIHN0YXRlX2Vycm9yOworCQkq
YnVmZmVyID0gYnVmOworCQlyZXR1cm4gc3RhdGVfY29tbWFuZDsKKwljYXNlIChIQ19QYXJh
VHlwZV9QYWxldHRlIHwgKEhDX1N1YlR5cGVfU3RpcHBsZSA8PCA4KSk6CisJCWlmIChlYXRf
d29yZHMoJmJ1ZiwgYnVmX2VuZCwgMzIpKQorCQkJcmV0dXJuIHN0YXRlX2Vycm9yOworCQkq
YnVmZmVyID0gYnVmOworCQlyZXR1cm4gc3RhdGVfY29tbWFuZDsKKwljYXNlIChIQ19QYXJh
VHlwZV9QYWxldHRlIHwgKEhDX1N1YlR5cGVfVGV4UGFsZXR0ZTAgPDwgOCkpOgorCWNhc2Ug
KEhDX1BhcmFUeXBlX1BhbGV0dGUgfCAoSENfU3ViVHlwZV9UZXhQYWxldHRlMSA8PCA4KSk6
CisJCURSTV9FUlJPUigiVGV4dHVyZSBwYWxldHRlcyBhcmUgcmVqZWN0ZWQgYmVjYXVzZSBv
ZiAiCisJCQkgICJsYWNrIG9mIGluZm8gaG93IHRvIGRldGVybWluZSB0aGVpciBzaXplLlxu
Iik7CisJCXJldHVybiBzdGF0ZV9lcnJvcjsKKwljYXNlIChIQ19QYXJhVHlwZV9QYWxldHRl
IHwgKEhDX1N1YlR5cGVfRm9nVGFibGUgPDwgOCkpOgorCQlEUk1fRVJST1IoIkZvZyBmYWN0
b3IgcGFsZXR0ZXMgYXJlIHJlamVjdGVkIGJlY2F1c2Ugb2YgIgorCQkJICAibGFjayBvZiBp
bmZvIGhvdyB0byBkZXRlcm1pbmUgdGhlaXIgc2l6ZS5cbiIpOworCQlyZXR1cm4gc3RhdGVf
ZXJyb3I7CisJZGVmYXVsdDoKKworCQkvKgorCQkgKiBUaGVyZSBhcmUgc29tZSB1bmltcGxl
bWVudGVkIEhDX1BhcmFUeXBlcyBoZXJlLCB0aGF0CisJCSAqIG5lZWQgdG8gYmUgaW1wbGVt
ZW50ZWQgaWYgdGhlIE1lc2EgZHJpdmVyIGlzIGV4dGVuZGVkLgorCQkgKi8KKworCQlEUk1f
RVJST1IoIkludmFsaWQgb3IgdW5pbXBsZW1lbnRlZCBIQUxDWU9OX0hFQURFUjIgIgorCQkJ
ICAiRE1BIHN1YmNvbW1hbmQ6IDB4JXguIFByZXZpb3VzIGR3b3JkOiAweCV4XG4iLAorCQkJ
ICBjbWQsICooYnVmIC0gMikpOworCQkqYnVmZmVyID0gYnVmOworCQlyZXR1cm4gc3RhdGVf
ZXJyb3I7CisJfQorCisJd2hpbGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsKKwkJY21kID0gKmJ1Zisr
OworCQlpZiAoKGh6ID0gaHpfdGFibGVbY21kID4+IDI0XSkpIHsKKwkJCWlmICgoaHpfbW9k
ZSA9IGludmVzdGlnYXRlX2hhemFyZChjbWQsIGh6LCBoY19zdGF0ZSkpKSB7CisJCQkJaWYg
KGh6X21vZGUgPT0gMSkgeworCQkJCQlidWYtLTsKKwkJCQkJYnJlYWs7CisJCQkJfQorCQkJ
CXJldHVybiBzdGF0ZV9lcnJvcjsKKwkJCX0KKwkJfSBlbHNlIGlmIChoY19zdGF0ZS0+dW5m
aW5pc2hlZCAmJgorCQkJICAgZmluaXNoX2N1cnJlbnRfc2VxdWVuY2UoaGNfc3RhdGUpKSB7
CisJCQlyZXR1cm4gc3RhdGVfZXJyb3I7CisJCX0KKwl9CisJaWYgKGhjX3N0YXRlLT51bmZp
bmlzaGVkICYmIGZpbmlzaF9jdXJyZW50X3NlcXVlbmNlKGhjX3N0YXRlKSkKKwkJcmV0dXJu
IHN0YXRlX2Vycm9yOworCSpidWZmZXIgPSBidWY7CisJcmV0dXJuIHN0YXRlX2NvbW1hbmQ7
Cit9CisKK3N0YXRpYyBfX2lubGluZV9fIHZlcmlmaWVyX3N0YXRlX3QKK3ZpYV9wYXJzZV9o
ZWFkZXIyKGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwgdWludDMyX3QgY29uc3QgKipi
dWZmZXIsCisJCSAgY29uc3QgdWludDMyX3QgKmJ1Zl9lbmQsIGludCAqZmlyZV9jb3VudCkK
K3sKKwl1aW50MzJfdCBjbWQ7CisJY29uc3QgdWludDMyX3QgKmJ1ZiA9ICpidWZmZXI7CisJ
Y29uc3QgdWludDMyX3QgKm5leHRfZmlyZTsKKwlpbnQgYnVyc3QgPSAwOworCisJbmV4dF9m
aXJlID0gZGV2X3ByaXYtPmZpcmVfb2Zmc2V0c1sqZmlyZV9jb3VudF07CisJYnVmKys7CisJ
Y21kID0gKCpidWYgJiAweEZGRkYwMDAwKSA+PiAxNjsKKwl2aWFfd3JpdGUoZGV2X3ByaXYs
IEhDX1JFR19UUkFOU19TRVQgKyBIQ19SRUdfQkFTRSwgKmJ1ZisrKTsKKwlzd2l0Y2ggKGNt
ZCkgeworCWNhc2UgSENfUGFyYVR5cGVfQ21kVmRhdGE6CisJCXdoaWxlICgoYnVmIDwgYnVm
X2VuZCkgJiYKKwkJICAgICAgICgqZmlyZV9jb3VudCA8IGRldl9wcml2LT5udW1fZmlyZV9v
ZmZzZXRzKSAmJgorCQkgICAgICAgKCpidWYgJiBIQ19BQ01EX01BU0spID09IEhDX0FDTURf
SENtZEIpIHsKKwkJCXdoaWxlIChidWYgPD0gbmV4dF9maXJlKSB7CisJCQkJdmlhX3dyaXRl
KGRldl9wcml2LCBIQ19SRUdfVFJBTlNfU1BBQ0UgKyBIQ19SRUdfQkFTRSArCisJCQkJCSAg
KGJ1cnN0ICYgNjMpLCAqYnVmKyspOworCQkJCWJ1cnN0ICs9IDQ7CisJCQl9CisJCQlpZiAo
KGJ1ZiA8IGJ1Zl9lbmQpCisJCQkgICAgJiYgKCgqYnVmICYgSEFMQ1lPTl9GSVJFTUFTSykg
PT0gSEFMQ1lPTl9GSVJFQ01EKSkKKwkJCQlidWYrKzsKKworCQkJaWYgKCsrKCpmaXJlX2Nv
dW50KSA8IGRldl9wcml2LT5udW1fZmlyZV9vZmZzZXRzKQorCQkJCW5leHRfZmlyZSA9IGRl
dl9wcml2LT5maXJlX29mZnNldHNbKmZpcmVfY291bnRdOworCQl9CisJCWJyZWFrOworCWRl
ZmF1bHQ6CisJCXdoaWxlIChidWYgPCBidWZfZW5kKSB7CisKKwkJCWlmICgqYnVmID09IEhD
X0hFQURFUjIgfHwKKwkJCSAgICAoKmJ1ZiAmIEhBTENZT05fSEVBREVSMU1BU0spID09IEhB
TENZT05fSEVBREVSMSB8fAorCQkJICAgICgqYnVmICYgVklBX1ZJREVPTUFTSykgPT0gVklB
X1ZJREVPX0hFQURFUjUgfHwKKwkJCSAgICAoKmJ1ZiAmIFZJQV9WSURFT01BU0spID09IFZJ
QV9WSURFT19IRUFERVI2KQorCQkJCWJyZWFrOworCisJCQl2aWFfd3JpdGUoZGV2X3ByaXYs
IEhDX1JFR19UUkFOU19TUEFDRSArIEhDX1JFR19CQVNFICsKKwkJCQkgIChidXJzdCAmIDYz
KSwgKmJ1ZisrKTsKKwkJCWJ1cnN0ICs9IDQ7CisJCX0KKwl9CisJKmJ1ZmZlciA9IGJ1ZjsK
KwlyZXR1cm4gc3RhdGVfY29tbWFuZDsKK30KKworc3RhdGljIF9faW5saW5lX18gaW50IHZl
cmlmeV9tbWlvX2FkZHJlc3ModWludDMyX3QgYWRkcmVzcykKK3sKKwlpZiAoKGFkZHJlc3Mg
PiAweDNGRikgJiYgKGFkZHJlc3MgPCAweEMwMCkpIHsKKwkJRFJNX0VSUk9SKCJJbnZhbGlk
IFZJREVPIERNQSBjb21tYW5kLiAiCisJCQkgICJBdHRlbXB0IHRvIGFjY2VzcyAzRC0gb3Ig
Y29tbWFuZCBidXJzdCBhcmVhLlxuIik7CisJCXJldHVybiAxOworCX0gZWxzZSBpZiAoKGFk
ZHJlc3MgPiAweENGRikgJiYgKGFkZHJlc3MgPCAweDEzMDApKSB7CisJCURSTV9FUlJPUigi
SW52YWxpZCBWSURFTyBETUEgY29tbWFuZC4gIgorCQkJICAiQXR0ZW1wdCB0byBhY2Nlc3Mg
UENJIERNQSBhcmVhLlxuIik7CisJCXJldHVybiAxOworCX0gZWxzZSBpZiAoYWRkcmVzcyA+
IDB4MTNGRikgeworCQlEUk1fRVJST1IoIkludmFsaWQgVklERU8gRE1BIGNvbW1hbmQuICIK
KwkJCSAgIkF0dGVtcHQgdG8gYWNjZXNzIFZHQSByZWdpc3RlcnMuXG4iKTsKKwkJcmV0dXJu
IDE7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgX19pbmxpbmVfXyBpbnQKK3Zlcmlm
eV92aWRlb190YWlsKHVpbnQzMl90IGNvbnN0ICoqYnVmZmVyLCBjb25zdCB1aW50MzJfdCAq
IGJ1Zl9lbmQsCisJCSAgdWludDMyX3QgZHdvcmRzKQoreworCWNvbnN0IHVpbnQzMl90ICpi
dWYgPSAqYnVmZmVyOworCisJaWYgKGJ1Zl9lbmQgLSBidWYgPCBkd29yZHMpIHsKKwkJRFJN
X0VSUk9SKCJJbGxlZ2FsIHRlcm1pbmF0aW9uIG9mIHZpZGVvIGNvbW1hbmQuXG4iKTsKKwkJ
cmV0dXJuIDE7CisJfQorCXdoaWxlIChkd29yZHMtLSkgeworCQlpZiAoKmJ1ZisrKSB7CisJ
CQlEUk1fRVJST1IoIklsbGVnYWwgdmlkZW8gY29tbWFuZCB0YWlsLlxuIik7CisJCQlyZXR1
cm4gMTsKKwkJfQorCX0KKwkqYnVmZmVyID0gYnVmOworCXJldHVybiAwOworfQorCitzdGF0
aWMgX19pbmxpbmVfXyB2ZXJpZmllcl9zdGF0ZV90Cit2aWFfY2hlY2tfaGVhZGVyMSh1aW50
MzJfdCBjb25zdCAqKmJ1ZmZlciwgY29uc3QgdWludDMyX3QgKiBidWZfZW5kKQoreworCXVp
bnQzMl90IGNtZDsKKwljb25zdCB1aW50MzJfdCAqYnVmID0gKmJ1ZmZlcjsKKwl2ZXJpZmll
cl9zdGF0ZV90IHJldCA9IHN0YXRlX2NvbW1hbmQ7CisKKwl3aGlsZSAoYnVmIDwgYnVmX2Vu
ZCkgeworCQljbWQgPSAqYnVmOworCQlpZiAoKGNtZCA+ICgoMHgzRkYgPj4gMikgfCBIQUxD
WU9OX0hFQURFUjEpKSAmJgorCQkgICAgKGNtZCA8ICgoMHhDMDAgPj4gMikgfCBIQUxDWU9O
X0hFQURFUjEpKSkgeworCQkJaWYgKChjbWQgJiBIQUxDWU9OX0hFQURFUjFNQVNLKSAhPSBI
QUxDWU9OX0hFQURFUjEpCisJCQkJYnJlYWs7CisJCQlEUk1fRVJST1IoIkludmFsaWQgSEFM
Q1lPTl9IRUFERVIxIGNvbW1hbmQuICIKKwkJCQkgICJBdHRlbXB0IHRvIGFjY2VzcyAzRC0g
b3IgY29tbWFuZCBidXJzdCBhcmVhLlxuIik7CisJCQlyZXQgPSBzdGF0ZV9lcnJvcjsKKwkJ
CWJyZWFrOworCQl9IGVsc2UgaWYgKGNtZCA+ICgoMHhDRkYgPj4gMikgfCBIQUxDWU9OX0hF
QURFUjEpKSB7CisJCQlpZiAoKGNtZCAmIEhBTENZT05fSEVBREVSMU1BU0spICE9IEhBTENZ
T05fSEVBREVSMSkKKwkJCQlicmVhazsKKwkJCURSTV9FUlJPUigiSW52YWxpZCBIQUxDWU9O
X0hFQURFUjEgY29tbWFuZC4gIgorCQkJCSAgIkF0dGVtcHQgdG8gYWNjZXNzIFZHQSByZWdp
c3RlcnMuXG4iKTsKKwkJCXJldCA9IHN0YXRlX2Vycm9yOworCQkJYnJlYWs7CisJCX0gZWxz
ZSB7CisJCQlidWYgKz0gMjsKKwkJfQorCX0KKwkqYnVmZmVyID0gYnVmOworCXJldHVybiBy
ZXQ7Cit9CisKK3N0YXRpYyBfX2lubGluZV9fIHZlcmlmaWVyX3N0YXRlX3QKK3ZpYV9wYXJz
ZV9oZWFkZXIxKGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwgdWludDMyX3QgY29uc3Qg
KipidWZmZXIsCisJCSAgY29uc3QgdWludDMyX3QgKmJ1Zl9lbmQpCit7CisJcmVnaXN0ZXIg
dWludDMyX3QgY21kOworCWNvbnN0IHVpbnQzMl90ICpidWYgPSAqYnVmZmVyOworCisJd2hp
bGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsKKwkJY21kID0gKmJ1ZjsKKwkJaWYgKChjbWQgJiBIQUxD
WU9OX0hFQURFUjFNQVNLKSAhPSBIQUxDWU9OX0hFQURFUjEpCisJCQlicmVhazsKKwkJdmlh
X3dyaXRlKGRldl9wcml2LCAoY21kICYgfkhBTENZT05fSEVBREVSMU1BU0spIDw8IDIsICor
K2J1Zik7CisJCWJ1ZisrOworCX0KKwkqYnVmZmVyID0gYnVmOworCXJldHVybiBzdGF0ZV9j
b21tYW5kOworfQorCitzdGF0aWMgX19pbmxpbmVfXyB2ZXJpZmllcl9zdGF0ZV90Cit2aWFf
Y2hlY2tfdmhlYWRlcjUodWludDMyX3QgY29uc3QgKipidWZmZXIsIGNvbnN0IHVpbnQzMl90
ICpidWZfZW5kKQoreworCXVpbnQzMl90IGRhdGE7CisJY29uc3QgdWludDMyX3QgKmJ1ZiA9
ICpidWZmZXI7CisKKwlpZiAoYnVmX2VuZCAtIGJ1ZiA8IDQpIHsKKwkJRFJNX0VSUk9SKCJJ
bGxlZ2FsIHRlcm1pbmF0aW9uIG9mIHZpZGVvIGhlYWRlcjUgY29tbWFuZFxuIik7CisJCXJl
dHVybiBzdGF0ZV9lcnJvcjsKKwl9CisKKwlkYXRhID0gKmJ1ZisrICYgflZJQV9WSURFT01B
U0s7CisJaWYgKHZlcmlmeV9tbWlvX2FkZHJlc3MoZGF0YSkpCisJCXJldHVybiBzdGF0ZV9l
cnJvcjsKKworCWRhdGEgPSAqYnVmKys7CisJaWYgKCpidWYrKyAhPSAweDAwRjUwMDAwKSB7
CisJCURSTV9FUlJPUigiSWxsZWdhbCBoZWFkZXI1IGhlYWRlciBkYXRhXG4iKTsKKwkJcmV0
dXJuIHN0YXRlX2Vycm9yOworCX0KKwlpZiAoKmJ1ZisrICE9IDB4MDAwMDAwMDApIHsKKwkJ
RFJNX0VSUk9SKCJJbGxlZ2FsIGhlYWRlcjUgaGVhZGVyIGRhdGFcbiIpOworCQlyZXR1cm4g
c3RhdGVfZXJyb3I7CisJfQorCWlmIChlYXRfd29yZHMoJmJ1ZiwgYnVmX2VuZCwgZGF0YSkp
CisJCXJldHVybiBzdGF0ZV9lcnJvcjsKKwlpZiAoKGRhdGEgJiAzKSAmJiB2ZXJpZnlfdmlk
ZW9fdGFpbCgmYnVmLCBidWZfZW5kLCA0IC0gKGRhdGEgJiAzKSkpCisJCXJldHVybiBzdGF0
ZV9lcnJvcjsKKwkqYnVmZmVyID0gYnVmOworCXJldHVybiBzdGF0ZV9jb21tYW5kOworCit9
CisKK3N0YXRpYyBfX2lubGluZV9fIHZlcmlmaWVyX3N0YXRlX3QKK3ZpYV9wYXJzZV92aGVh
ZGVyNShkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYsIHVpbnQzMl90IGNvbnN0ICoqYnVm
ZmVyLAorCQkgICBjb25zdCB1aW50MzJfdCAqYnVmX2VuZCkKK3sKKwl1aW50MzJfdCBhZGRy
LCBjb3VudCwgaTsKKwljb25zdCB1aW50MzJfdCAqYnVmID0gKmJ1ZmZlcjsKKworCWFkZHIg
PSAqYnVmKysgJiB+VklBX1ZJREVPTUFTSzsKKwlpID0gY291bnQgPSAqYnVmOworCWJ1ZiAr
PSAzOworCXdoaWxlIChpLS0pCisJCXZpYV93cml0ZShkZXZfcHJpdiwgYWRkciwgKmJ1Zisr
KTsKKwlpZiAoY291bnQgJiAzKQorCQlidWYgKz0gNCAtIChjb3VudCAmIDMpOworCSpidWZm
ZXIgPSBidWY7CisJcmV0dXJuIHN0YXRlX2NvbW1hbmQ7Cit9CisKK3N0YXRpYyBfX2lubGlu
ZV9fIHZlcmlmaWVyX3N0YXRlX3QKK3ZpYV9jaGVja192aGVhZGVyNih1aW50MzJfdCBjb25z
dCAqKmJ1ZmZlciwgY29uc3QgdWludDMyX3QgKiBidWZfZW5kKQoreworCXVpbnQzMl90IGRh
dGE7CisJY29uc3QgdWludDMyX3QgKmJ1ZiA9ICpidWZmZXI7CisJdWludDMyX3QgaTsKKwor
CWlmIChidWZfZW5kIC0gYnVmIDwgNCkgeworCQlEUk1fRVJST1IoIklsbGVnYWwgdGVybWlu
YXRpb24gb2YgdmlkZW8gaGVhZGVyNiBjb21tYW5kXG4iKTsKKwkJcmV0dXJuIHN0YXRlX2Vy
cm9yOworCX0KKwlidWYrKzsKKwlkYXRhID0gKmJ1ZisrOworCWlmICgqYnVmKysgIT0gMHgw
MEY2MDAwMCkgeworCQlEUk1fRVJST1IoIklsbGVnYWwgaGVhZGVyNiBoZWFkZXIgZGF0YVxu
Iik7CisJCXJldHVybiBzdGF0ZV9lcnJvcjsKKwl9CisJaWYgKCpidWYrKyAhPSAweDAwMDAw
MDAwKSB7CisJCURSTV9FUlJPUigiSWxsZWdhbCBoZWFkZXI2IGhlYWRlciBkYXRhXG4iKTsK
KwkJcmV0dXJuIHN0YXRlX2Vycm9yOworCX0KKwlpZiAoKGJ1Zl9lbmQgLSBidWYpIDwgKGRh
dGEgPDwgMSkpIHsKKwkJRFJNX0VSUk9SKCJJbGxlZ2FsIHRlcm1pbmF0aW9uIG9mIHZpZGVv
IGhlYWRlcjYgY29tbWFuZFxuIik7CisJCXJldHVybiBzdGF0ZV9lcnJvcjsKKwl9CisJZm9y
IChpID0gMDsgaSA8IGRhdGE7ICsraSkgeworCQlpZiAodmVyaWZ5X21taW9fYWRkcmVzcygq
YnVmKyspKQorCQkJcmV0dXJuIHN0YXRlX2Vycm9yOworCQlidWYrKzsKKwl9CisJZGF0YSA8
PD0gMTsKKwlpZiAoKGRhdGEgJiAzKSAmJiB2ZXJpZnlfdmlkZW9fdGFpbCgmYnVmLCBidWZf
ZW5kLCA0IC0gKGRhdGEgJiAzKSkpCisJCXJldHVybiBzdGF0ZV9lcnJvcjsKKwkqYnVmZmVy
ID0gYnVmOworCXJldHVybiBzdGF0ZV9jb21tYW5kOworfQorCitzdGF0aWMgX19pbmxpbmVf
XyB2ZXJpZmllcl9zdGF0ZV90Cit2aWFfcGFyc2VfdmhlYWRlcjYoZHJtX3ZpYV9wcml2YXRl
X3QgKmRldl9wcml2LCB1aW50MzJfdCBjb25zdCAqKmJ1ZmZlciwKKwkJICAgY29uc3QgdWlu
dDMyX3QgKmJ1Zl9lbmQpCit7CisKKwl1aW50MzJfdCBhZGRyLCBjb3VudCwgaTsKKwljb25z
dCB1aW50MzJfdCAqYnVmID0gKmJ1ZmZlcjsKKworCWkgPSBjb3VudCA9ICorK2J1ZjsKKwli
dWYgKz0gMzsKKwl3aGlsZSAoaS0tKSB7CisJCWFkZHIgPSAqYnVmKys7CisJCXZpYV93cml0
ZShkZXZfcHJpdiwgYWRkciwgKmJ1ZisrKTsKKwl9CisJY291bnQgPDw9IDE7CisJaWYgKGNv
dW50ICYgMykKKwkJYnVmICs9IDQgLSAoY291bnQgJiAzKTsKKwkqYnVmZmVyID0gYnVmOwor
CXJldHVybiBzdGF0ZV9jb21tYW5kOworfQorCitpbnQKK3ZpYV92ZXJpZnlfY29tbWFuZF9z
dHJlYW0oY29uc3QgdWludDMyX3QgKiBidWYsIHVuc2lnbmVkIGludCBzaXplLAorCQkJICBz
dHJ1Y3QgZHJtX2RldmljZSAqIGRldiwgaW50IGFncCkKK3sKKworCWRybV92aWFfcHJpdmF0
ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAqKSBkZXYtPmRldl9wcml2YXRl
OworCWRybV92aWFfc3RhdGVfdCAqaGNfc3RhdGUgPSAmZGV2X3ByaXYtPmhjX3N0YXRlOwor
CWRybV92aWFfc3RhdGVfdCBzYXZlZF9zdGF0ZSA9ICpoY19zdGF0ZTsKKwl1aW50MzJfdCBj
bWQ7CisJY29uc3QgdWludDMyX3QgKmJ1Zl9lbmQgPSBidWYgKyAoc2l6ZSA+PiAyKTsKKwl2
ZXJpZmllcl9zdGF0ZV90IHN0YXRlID0gc3RhdGVfY29tbWFuZDsKKwlpbnQgY21lX3ZpZGVv
OworCWludCBzdXBwb3J0ZWRfM2Q7CisKKwljbWVfdmlkZW8gPSAoZGV2X3ByaXYtPmNoaXBz
ZXQgPT0gVklBX1BST19HUk9VUF9BIHx8CisJCSAgICAgZGV2X3ByaXYtPmNoaXBzZXQgPT0g
VklBX0RYOV8wKTsKKworCXN1cHBvcnRlZF8zZCA9IGRldl9wcml2LT5jaGlwc2V0ICE9IFZJ
QV9EWDlfMDsKKworCWhjX3N0YXRlLT5kZXYgPSBkZXY7CisJaGNfc3RhdGUtPnVuZmluaXNo
ZWQgPSBub19zZXF1ZW5jZTsKKwloY19zdGF0ZS0+bWFwX2NhY2hlID0gTlVMTDsKKwloY19z
dGF0ZS0+YWdwID0gYWdwOworCWhjX3N0YXRlLT5idWZfc3RhcnQgPSBidWY7CisJZGV2X3By
aXYtPm51bV9maXJlX29mZnNldHMgPSAwOworCisJd2hpbGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsK
KworCQlzd2l0Y2ggKHN0YXRlKSB7CisJCWNhc2Ugc3RhdGVfaGVhZGVyMjoKKwkJCXN0YXRl
ID0gdmlhX2NoZWNrX2hlYWRlcjIoJmJ1ZiwgYnVmX2VuZCwgaGNfc3RhdGUpOworCQkJYnJl
YWs7CisJCWNhc2Ugc3RhdGVfaGVhZGVyMToKKwkJCXN0YXRlID0gdmlhX2NoZWNrX2hlYWRl
cjEoJmJ1ZiwgYnVmX2VuZCk7CisJCQlicmVhazsKKwkJY2FzZSBzdGF0ZV92aGVhZGVyNToK
KwkJCXN0YXRlID0gdmlhX2NoZWNrX3ZoZWFkZXI1KCZidWYsIGJ1Zl9lbmQpOworCQkJYnJl
YWs7CisJCWNhc2Ugc3RhdGVfdmhlYWRlcjY6CisJCQlzdGF0ZSA9IHZpYV9jaGVja192aGVh
ZGVyNigmYnVmLCBidWZfZW5kKTsKKwkJCWJyZWFrOworCQljYXNlIHN0YXRlX2NvbW1hbmQ6
CisJCQljbWQgPSAqYnVmOworCQkJaWYgKChjbWQgPT0gSEFMQ1lPTl9IRUFERVIyKSAmJiBz
dXBwb3J0ZWRfM2QpCisJCQkJc3RhdGUgPSBzdGF0ZV9oZWFkZXIyOworCQkJZWxzZSBpZiAo
KGNtZCAmIEhBTENZT05fSEVBREVSMU1BU0spID09IEhBTENZT05fSEVBREVSMSkKKwkJCQlz
dGF0ZSA9IHN0YXRlX2hlYWRlcjE7CisJCQllbHNlIGlmIChjbWVfdmlkZW8KKwkJCQkgJiYg
KGNtZCAmIFZJQV9WSURFT01BU0spID09IFZJQV9WSURFT19IRUFERVI1KQorCQkJCXN0YXRl
ID0gc3RhdGVfdmhlYWRlcjU7CisJCQllbHNlIGlmIChjbWVfdmlkZW8KKwkJCQkgJiYgKGNt
ZCAmIFZJQV9WSURFT01BU0spID09IFZJQV9WSURFT19IRUFERVI2KQorCQkJCXN0YXRlID0g
c3RhdGVfdmhlYWRlcjY7CisJCQllbHNlIGlmICgoY21kID09IEhBTENZT05fSEVBREVSMikg
JiYgIXN1cHBvcnRlZF8zZCkgeworCQkJCURSTV9FUlJPUigiQWNjZWxlcmF0ZWQgM0QgaXMg
bm90IHN1cHBvcnRlZCBvbiB0aGlzIGNoaXBzZXQgeWV0LlxuIik7CisJCQkJc3RhdGUgPSBz
dGF0ZV9lcnJvcjsKKwkJCX0gZWxzZSB7CisJCQkJRFJNX0VSUk9SCisJCQkJICAgICgiSW52
YWxpZCAvIFVuaW1wbGVtZW50ZWQgRE1BIEhFQURFUiBjb21tYW5kLiAweCV4XG4iLAorCQkJ
CSAgICAgY21kKTsKKwkJCQlzdGF0ZSA9IHN0YXRlX2Vycm9yOworCQkJfQorCQkJYnJlYWs7
CisJCWNhc2Ugc3RhdGVfZXJyb3I6CisJCWRlZmF1bHQ6CisJCQkqaGNfc3RhdGUgPSBzYXZl
ZF9zdGF0ZTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCWlmIChzdGF0ZSA9PSBz
dGF0ZV9lcnJvcikgeworCQkqaGNfc3RhdGUgPSBzYXZlZF9zdGF0ZTsKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCXJldHVybiAwOworfQorCitpbnQKK3ZpYV9wYXJzZV9jb21tYW5kX3N0
cmVhbShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBjb25zdCB1aW50MzJfdCAqYnVmLAorCQkJ
IHVuc2lnbmVkIGludCBzaXplKQoreworCisJZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRldi0+ZGV2X3ByaXZhdGU7CisJdWludDMyX3Qg
Y21kOworCWNvbnN0IHVpbnQzMl90ICpidWZfZW5kID0gYnVmICsgKHNpemUgPj4gMik7CisJ
dmVyaWZpZXJfc3RhdGVfdCBzdGF0ZSA9IHN0YXRlX2NvbW1hbmQ7CisJaW50IGZpcmVfY291
bnQgPSAwOworCisJd2hpbGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsKKworCQlzd2l0Y2ggKHN0YXRl
KSB7CisJCWNhc2Ugc3RhdGVfaGVhZGVyMjoKKwkJCXN0YXRlID0KKwkJCSAgICB2aWFfcGFy
c2VfaGVhZGVyMihkZXZfcHJpdiwgJmJ1ZiwgYnVmX2VuZCwKKwkJCQkJICAgICAgJmZpcmVf
Y291bnQpOworCQkJYnJlYWs7CisJCWNhc2Ugc3RhdGVfaGVhZGVyMToKKwkJCXN0YXRlID0g
dmlhX3BhcnNlX2hlYWRlcjEoZGV2X3ByaXYsICZidWYsIGJ1Zl9lbmQpOworCQkJYnJlYWs7
CisJCWNhc2Ugc3RhdGVfdmhlYWRlcjU6CisJCQlzdGF0ZSA9IHZpYV9wYXJzZV92aGVhZGVy
NShkZXZfcHJpdiwgJmJ1ZiwgYnVmX2VuZCk7CisJCQlicmVhazsKKwkJY2FzZSBzdGF0ZV92
aGVhZGVyNjoKKwkJCXN0YXRlID0gdmlhX3BhcnNlX3ZoZWFkZXI2KGRldl9wcml2LCAmYnVm
LCBidWZfZW5kKTsKKwkJCWJyZWFrOworCQljYXNlIHN0YXRlX2NvbW1hbmQ6CisJCQljbWQg
PSAqYnVmOworCQkJaWYgKGNtZCA9PSBIQUxDWU9OX0hFQURFUjIpCisJCQkJc3RhdGUgPSBz
dGF0ZV9oZWFkZXIyOworCQkJZWxzZSBpZiAoKGNtZCAmIEhBTENZT05fSEVBREVSMU1BU0sp
ID09IEhBTENZT05fSEVBREVSMSkKKwkJCQlzdGF0ZSA9IHN0YXRlX2hlYWRlcjE7CisJCQll
bHNlIGlmICgoY21kICYgVklBX1ZJREVPTUFTSykgPT0gVklBX1ZJREVPX0hFQURFUjUpCisJ
CQkJc3RhdGUgPSBzdGF0ZV92aGVhZGVyNTsKKwkJCWVsc2UgaWYgKChjbWQgJiBWSUFfVklE
RU9NQVNLKSA9PSBWSUFfVklERU9fSEVBREVSNikKKwkJCQlzdGF0ZSA9IHN0YXRlX3ZoZWFk
ZXI2OworCQkJZWxzZSB7CisJCQkJRFJNX0VSUk9SCisJCQkJICAgICgiSW52YWxpZCAvIFVu
aW1wbGVtZW50ZWQgRE1BIEhFQURFUiBjb21tYW5kLiAweCV4XG4iLAorCQkJCSAgICAgY21k
KTsKKwkJCQlzdGF0ZSA9IHN0YXRlX2Vycm9yOworCQkJfQorCQkJYnJlYWs7CisJCWNhc2Ug
c3RhdGVfZXJyb3I6CisJCWRlZmF1bHQ6CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCX0K
KwlpZiAoc3RhdGUgPT0gc3RhdGVfZXJyb3IpCisJCXJldHVybiAtRUlOVkFMOworCXJldHVy
biAwOworfQorCitzdGF0aWMgdm9pZAorc2V0dXBfaGF6YXJkX3RhYmxlKGh6X2luaXRfdCBp
bml0X3RhYmxlW10sIGhhemFyZF90IHRhYmxlW10sIGludCBzaXplKQoreworCWludCBpOwor
CisJZm9yIChpID0gMDsgaSA8IDI1NjsgKytpKQorCQl0YWJsZVtpXSA9IGZvcmJpZGRlbl9j
b21tYW5kOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7ICsraSkKKwkJdGFibGVbaW5pdF90
YWJsZVtpXS5jb2RlXSA9IGluaXRfdGFibGVbaV0uaHo7Cit9CisKK3ZvaWQgdmlhX2luaXRf
Y29tbWFuZF92ZXJpZmllcih2b2lkKQoreworCXNldHVwX2hhemFyZF90YWJsZShpbml0X3Rh
YmxlMSwgdGFibGUxLCBBUlJBWV9TSVpFKGluaXRfdGFibGUxKSk7CisJc2V0dXBfaGF6YXJk
X3RhYmxlKGluaXRfdGFibGUyLCB0YWJsZTIsIEFSUkFZX1NJWkUoaW5pdF90YWJsZTIpKTsK
KwlzZXR1cF9oYXphcmRfdGFibGUoaW5pdF90YWJsZTMsIHRhYmxlMywgQVJSQVlfU0laRShp
bml0X3RhYmxlMykpOworfQorCisvKgorICogTGVnYWN5IGZpbGU6IHZpYV92aWRlby5jCisg
KgorICogQ29weXJpZ2h0IDIwMDUgVGhvbWFzIEhlbGxzdHJvbS4gQWxsIFJpZ2h0cyBSZXNl
cnZlZC4KKyAqCisgKiBBdXRob3I6IFRob21hcyBIZWxsc3Ryb20gMjAwNS4KKyAqCisgKiBW
aWRlbyBhbmQgWHZNQyByZWxhdGVkIGZ1bmN0aW9ucy4KKyAqLworCit2b2lkIHZpYV9pbml0
X2Z1dGV4KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdikKK3sKKwl1bnNpZ25lZCBpbnQg
aTsKKworCURSTV9ERUJVRygiXG4iKTsKKworCWZvciAoaSA9IDA7IGkgPCBWSUFfTlJfWFZN
Q19MT0NLUzsgKytpKSB7CisJCWluaXRfd2FpdHF1ZXVlX2hlYWQoJihkZXZfcHJpdi0+ZGVj
b2Rlcl9xdWV1ZVtpXSkpOworCQlYVk1DTE9DS1BUUihkZXZfcHJpdi0+c2FyZWFfcHJpdiwg
aSktPmxvY2sgPSAwOworCX0KK30KKwordm9pZCB2aWFfY2xlYW51cF9mdXRleChkcm1fdmlh
X3ByaXZhdGVfdCAqZGV2X3ByaXYpCit7Cit9CisKK3ZvaWQgdmlhX3JlbGVhc2VfZnV0ZXgo
ZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2LCBpbnQgY29udGV4dCkKK3sKKwl1bnNpZ25l
ZCBpbnQgaTsKKwl2b2xhdGlsZSBpbnQgKmxvY2s7CisKKwlpZiAoIWRldl9wcml2LT5zYXJl
YV9wcml2KQorCQlyZXR1cm47CisKKwlmb3IgKGkgPSAwOyBpIDwgVklBX05SX1hWTUNfTE9D
S1M7ICsraSkgeworCQlsb2NrID0gKHZvbGF0aWxlIGludCAqKVhWTUNMT0NLUFRSKGRldl9w
cml2LT5zYXJlYV9wcml2LCBpKTsKKwkJaWYgKChfRFJNX0xPQ0tJTkdfQ09OVEVYVCgqbG9j
aykgPT0gY29udGV4dCkpIHsKKwkJCWlmIChfRFJNX0xPQ0tfSVNfSEVMRCgqbG9jaykKKwkJ
CSAgICAmJiAoKmxvY2sgJiBfRFJNX0xPQ0tfQ09OVCkpIHsKKwkJCQl3YWtlX3VwKCYoZGV2
X3ByaXYtPmRlY29kZXJfcXVldWVbaV0pKTsKKwkJCX0KKwkJCSpsb2NrID0gMDsKKwkJfQor
CX0KK30KKworaW50IHZpYV9kZWNvZGVyX2Z1dGV4KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQoreworCWRybV92aWFf
ZnV0ZXhfdCAqZnggPSBkYXRhOworCXZvbGF0aWxlIGludCAqbG9jazsKKwlkcm1fdmlhX3By
aXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJp
dmF0ZTsKKwlkcm1fdmlhX3NhcmVhX3QgKnNBUHJpdiA9IGRldl9wcml2LT5zYXJlYV9wcml2
OworCWludCByZXQgPSAwOworCisJRFJNX0RFQlVHKCJcbiIpOworCisJaWYgKGZ4LT5sb2Nr
ID49IFZJQV9OUl9YVk1DX0xPQ0tTKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWxvY2sgPSAo
dm9sYXRpbGUgaW50ICopWFZNQ0xPQ0tQVFIoc0FQcml2LCBmeC0+bG9jayk7CisKKwlzd2l0
Y2ggKGZ4LT5mdW5jKSB7CisJY2FzZSBWSUFfRlVURVhfV0FJVDoKKwkJVklBX1dBSVRfT04o
cmV0LCBkZXZfcHJpdi0+ZGVjb2Rlcl9xdWV1ZVtmeC0+bG9ja10sCisJCQkgICAgKGZ4LT5t
cyAvIDEwKSAqIChIWiAvIDEwMCksICpsb2NrICE9IGZ4LT52YWwpOworCQlyZXR1cm4gcmV0
OworCWNhc2UgVklBX0ZVVEVYX1dBS0U6CisJCXdha2VfdXAoJihkZXZfcHJpdi0+ZGVjb2Rl
cl9xdWV1ZVtmeC0+bG9ja10pKTsKKwkJcmV0dXJuIDA7CisJfQorCXJldHVybiAwOworfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfbWFwLmMgYi9kcml2ZXJzL2dw
dS9kcm0vdmlhL3ZpYV9tYXAuYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggYTlm
NmIwYzExOTY2Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFf
bWFwLmMKKysrIC9kZXYvbnVsbApAQCAtMSwxMzIgKzAsMCBAQAotLyoKLSAqIENvcHlyaWdo
dCAxOTk4LTIwMDMgVklBIFRlY2hub2xvZ2llcywgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVk
LgotICogQ29weXJpZ2h0IDIwMDEtMjAwMyBTMyBHcmFwaGljcywgSW5jLiBBbGwgUmlnaHRz
IFJlc2VydmVkLgotICoKLSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUg
b2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9mIHRoaXMg
c29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0
d2FyZSIpLAotICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlv
biwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgotICogdGhlIHJpZ2h0cyB0byB1c2Us
IGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YiBsaWNlbnNl
LAotICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1p
dCBwZXJzb25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8g
c28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAqIFRoZSBh
Ym92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNs
dWRpbmcgdGhlCi0gKiBuZXh0IHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxs
IGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucwotICogb2YgdGhlIFNvZnR3YXJlLgot
ICoKLSAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJB
TlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCi0gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVU
IE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKLSAq
IEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT04tSU5GUklOR0VNRU5U
LiBJTiBOTyBFVkVOVCBTSEFMTAotICogVklBLCBTMyBHUkFQSElDUywgQU5EL09SIElUUyBT
VVBQTElFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IKLSAqIE9USEVS
IExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Ig
T1RIRVJXSVNFLAotICogQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBX
SVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCi0gKiBERUFMSU5HUyBJTiBU
SEUgU09GVFdBUkUuCi0gKi8KLQotI2luY2x1ZGUgPGxpbnV4L3BjaS5oPgotCi0jaW5jbHVk
ZSA8ZHJtL2RybV9kZXZpY2UuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgotI2lu
Y2x1ZGUgPGRybS92aWFfZHJtLmg+Ci0KLSNpbmNsdWRlICJ2aWFfZHJ2LmgiCi0KLXN0YXRp
YyBpbnQgdmlhX2RvX2luaXRfbWFwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGRybV92aWFf
aW5pdF90ICppbml0KQotewotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IGRldi0+
ZGV2X3ByaXZhdGU7Ci0KLQlEUk1fREVCVUcoIlxuIik7Ci0KLQlkZXZfcHJpdi0+c2FyZWEg
PSBkcm1fbGVnYWN5X2dldHNhcmVhKGRldik7Ci0JaWYgKCFkZXZfcHJpdi0+c2FyZWEpIHsK
LQkJRFJNX0VSUk9SKCJjb3VsZCBub3QgZmluZCBzYXJlYSFcbiIpOwotCQlkZXYtPmRldl9w
cml2YXRlID0gKHZvaWQgKilkZXZfcHJpdjsKLQkJdmlhX2RvX2NsZWFudXBfbWFwKGRldik7
Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWRldl9wcml2LT5mYiA9IGRybV9sZWdhY3lf
ZmluZG1hcChkZXYsIGluaXQtPmZiX29mZnNldCk7Ci0JaWYgKCFkZXZfcHJpdi0+ZmIpIHsK
LQkJRFJNX0VSUk9SKCJjb3VsZCBub3QgZmluZCBmcmFtZWJ1ZmZlciFcbiIpOwotCQlkZXYt
PmRldl9wcml2YXRlID0gKHZvaWQgKilkZXZfcHJpdjsKLQkJdmlhX2RvX2NsZWFudXBfbWFw
KGRldik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQlkZXZfcHJpdi0+bW1pbyA9IGRybV9s
ZWdhY3lfZmluZG1hcChkZXYsIGluaXQtPm1taW9fb2Zmc2V0KTsKLQlpZiAoIWRldl9wcml2
LT5tbWlvKSB7Ci0JCURSTV9FUlJPUigiY291bGQgbm90IGZpbmQgbW1pbyByZWdpb24hXG4i
KTsKLQkJZGV2LT5kZXZfcHJpdmF0ZSA9ICh2b2lkICopZGV2X3ByaXY7Ci0JCXZpYV9kb19j
bGVhbnVwX21hcChkZXYpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlkZXZfcHJpdi0+
c2FyZWFfcHJpdiA9Ci0JICAgIChkcm1fdmlhX3NhcmVhX3QgKikgKCh1OCAqKSBkZXZfcHJp
di0+c2FyZWEtPmhhbmRsZSArCi0JCQkJIGluaXQtPnNhcmVhX3ByaXZfb2Zmc2V0KTsKLQot
CWRldl9wcml2LT5hZ3BBZGRyID0gaW5pdC0+YWdwQWRkcjsKLQotCXZpYV9pbml0X2Z1dGV4
KGRldl9wcml2KTsKLQotCXZpYV9pbml0X2RtYWJsaXQoZGV2KTsKLQotCWRldi0+ZGV2X3By
aXZhdGUgPSAodm9pZCAqKWRldl9wcml2OwotCXJldHVybiAwOwotfQotCi1pbnQgdmlhX2Rv
X2NsZWFudXBfbWFwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi17Ci0JdmlhX2RtYV9jbGVh
bnVwKGRldik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotaW50IHZpYV9tYXBfaW5pdChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJp
dikKLXsKLQlkcm1fdmlhX2luaXRfdCAqaW5pdCA9IGRhdGE7Ci0KLQlEUk1fREVCVUcoIlxu
Iik7Ci0KLQlzd2l0Y2ggKGluaXQtPmZ1bmMpIHsKLQljYXNlIFZJQV9JTklUX01BUDoKLQkJ
cmV0dXJuIHZpYV9kb19pbml0X21hcChkZXYsIGluaXQpOwotCWNhc2UgVklBX0NMRUFOVVBf
TUFQOgotCQlyZXR1cm4gdmlhX2RvX2NsZWFudXBfbWFwKGRldik7Ci0JfQotCi0JcmV0dXJu
IC1FSU5WQUw7Ci19Ci0KLWludCB2aWFfZHJpdmVyX2xvYWQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdW5zaWduZWQgbG9uZyBjaGlwc2V0KQotewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2
ID0gdG9fcGNpX2RldihkZXYtPmRldik7Ci0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
OwotCWludCByZXQgPSAwOwotCi0JZGV2X3ByaXYgPSBremFsbG9jKHNpemVvZihkcm1fdmlh
X3ByaXZhdGVfdCksIEdGUF9LRVJORUwpOwotCWlmIChkZXZfcHJpdiA9PSBOVUxMKQotCQly
ZXR1cm4gLUVOT01FTTsKLQotCWlkcl9pbml0KCZkZXZfcHJpdi0+b2JqZWN0X2lkcik7Ci0J
ZGV2LT5kZXZfcHJpdmF0ZSA9ICh2b2lkICopZGV2X3ByaXY7Ci0KLQlkZXZfcHJpdi0+Y2hp
cHNldCA9IGNoaXBzZXQ7Ci0KLQlwY2lfc2V0X21hc3RlcihwZGV2KTsKLQotCXJldCA9IGRy
bV92YmxhbmtfaW5pdChkZXYsIDEpOwotCWlmIChyZXQpIHsKLQkJa2ZyZWUoZGV2X3ByaXYp
OwotCQlyZXR1cm4gcmV0OwotCX0KLQotCXJldHVybiAwOwotfQotCi12b2lkIHZpYV9kcml2
ZXJfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi17Ci0JZHJtX3ZpYV9wcml2YXRl
X3QgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlkcl9kZXN0cm95KCZkZXZf
cHJpdi0+b2JqZWN0X2lkcik7Ci0KLQlrZnJlZShkZXZfcHJpdik7Ci19CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9tbS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpYS92
aWFfbW0uYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggYzlhZmExYTUxZjIzLi4w
MDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfbW0uYworKysgL2Rl
di9udWxsCkBAIC0xLDI0MSArMCwwIEBACi0vKgotICogQ29weXJpZ2h0IDIwMDYgVHVuZ3N0
ZW4gR3JhcGhpY3MgSW5jLiwgQmlzbWFyY2ssIE5ELiwgVVNBLgotICogQWxsIHJpZ2h0cyBy
ZXNlcnZlZC4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9m
IGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICogY29weSBvZiB0aGlzIHNv
ZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdh
cmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24s
IGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdodHMgdG8gdXNlLCBj
b3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWIgbGljZW5zZSwK
LSAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQg
cGVyc29ucyB0byB3aG9tIHRoZQotICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNv
LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKLSAqCi0gKiBUaGUgYWJv
dmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVk
aW5nIHRoZQotICogbmV4dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBj
b3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKLSAqIG9mIHRoZSBTb2Z0d2FyZS4KLSAq
Ci0gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5U
WSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgotICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBO
T1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCi0gKiBG
SVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OLUlORlJJTkdFTUVOVC4g
SU4gTk8gRVZFTlQgU0hBTEwKLSAqIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJT
IEFORC9PUiBUSEVJUiBTVVBQTElFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sCi0gKiBE
QU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09O
VFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLAotICogQVJJU0lORyBGUk9NLCBPVVQgT0YgT1Ig
SU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSCi0g
KiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCi0gKi8KLS8qCi0gKiBBdXRob3JzOiBUaG9t
YXMgSGVsbHN0csO2bSA8dGhvbWFzLWF0LXR1bmdzdGVuZ3JhcGhpY3MtZG90LWNvbT4KLSAq
LwotCi0jaW5jbHVkZSA8bGludXgvc2xhYi5oPgotCi0jaW5jbHVkZSA8ZHJtL2RybV9kZXZp
Y2UuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2ZpbGUuaD4KLSNpbmNsdWRlIDxkcm0vdmlhX2Ry
bS5oPgotCi0jaW5jbHVkZSAidmlhX2Rydi5oIgotCi0jZGVmaW5lIFZJQV9NTV9BTElHTl9T
SElGVCA0Ci0jZGVmaW5lIFZJQV9NTV9BTElHTl9NQVNLICgoMSA8PCBWSUFfTU1fQUxJR05f
U0hJRlQpIC0gMSkKLQotc3RydWN0IHZpYV9tZW1ibG9jayB7Ci0Jc3RydWN0IGRybV9tbV9u
b2RlIG1tX25vZGU7Ci0Jc3RydWN0IGxpc3RfaGVhZCBvd25lcl9saXN0OwotfTsKLQotaW50
IHZpYV9hZ3BfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKLXsKLQlkcm1fdmlhX2FncF90ICphZ3AgPSBkYXRh
OwotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlhX3ByaXZhdGVfdCAq
KSBkZXYtPmRldl9wcml2YXRlOwotCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgp
OwotCWRybV9tbV9pbml0KCZkZXZfcHJpdi0+YWdwX21tLCAwLCBhZ3AtPnNpemUgPj4gVklB
X01NX0FMSUdOX1NISUZUKTsKLQotCWRldl9wcml2LT5hZ3BfaW5pdGlhbGl6ZWQgPSAxOwot
CWRldl9wcml2LT5hZ3Bfb2Zmc2V0ID0gYWdwLT5vZmZzZXQ7Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7Ci0KLQlEUk1fREVCVUcoIm9mZnNldCA9ICV1LCBzaXplID0g
JXVcbiIsIGFncC0+b2Zmc2V0LCBhZ3AtPnNpemUpOwotCXJldHVybiAwOwotfQotCi1pbnQg
dmlhX2ZiX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCi17Ci0JZHJtX3ZpYV9mYl90ICpmYiA9IGRhdGE7Ci0J
ZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90ICopIGRl
di0+ZGV2X3ByaXZhdGU7Ci0KLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0J
ZHJtX21tX2luaXQoJmRldl9wcml2LT52cmFtX21tLCAwLCBmYi0+c2l6ZSA+PiBWSUFfTU1f
QUxJR05fU0hJRlQpOwotCi0JZGV2X3ByaXYtPnZyYW1faW5pdGlhbGl6ZWQgPSAxOwotCWRl
dl9wcml2LT52cmFtX29mZnNldCA9IGZiLT5vZmZzZXQ7Ci0KLQltdXRleF91bmxvY2soJmRl
di0+c3RydWN0X211dGV4KTsKLQlEUk1fREVCVUcoIm9mZnNldCA9ICV1LCBzaXplID0gJXVc
biIsIGZiLT5vZmZzZXQsIGZiLT5zaXplKTsKLQotCXJldHVybiAwOwotCi19Ci0KLWludCB2
aWFfZmluYWxfY29udGV4dChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgY29udGV4dCkK
LXsKLQlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3Qg
KikgZGV2LT5kZXZfcHJpdmF0ZTsKLQotCXZpYV9yZWxlYXNlX2Z1dGV4KGRldl9wcml2LCBj
b250ZXh0KTsKLQotCS8qIExpbnV4IHNwZWNpZmljIHVudGlsIGNvbnRleHQgdHJhY2tpbmcg
Y29kZSBnZXRzIHBvcnRlZCB0byBCU0QgKi8KLQkvKiBMYXN0IGNvbnRleHQsIHBlcmZvcm0g
Y2xlYW51cCAqLwotCWlmIChsaXN0X2lzX3Npbmd1bGFyKCZkZXYtPmN0eGxpc3QpKSB7Ci0J
CURSTV9ERUJVRygiTGFzdCBDb250ZXh0XG4iKTsKLQkJZHJtX2xlZ2FjeV9pcnFfdW5pbnN0
YWxsKGRldik7Ci0JCXZpYV9jbGVhbnVwX2Z1dGV4KGRldl9wcml2KTsKLQkJdmlhX2RvX2Ns
ZWFudXBfbWFwKGRldik7Ci0JfQotCXJldHVybiAxOwotfQotCi12b2lkIHZpYV9sYXN0Y2xv
c2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKLXsKLQlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlm
ICghZGV2X3ByaXYpCi0JCXJldHVybjsKLQotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211
dGV4KTsKLQlpZiAoZGV2X3ByaXYtPnZyYW1faW5pdGlhbGl6ZWQpIHsKLQkJZHJtX21tX3Rh
a2Vkb3duKCZkZXZfcHJpdi0+dnJhbV9tbSk7Ci0JCWRldl9wcml2LT52cmFtX2luaXRpYWxp
emVkID0gMDsKLQl9Ci0JaWYgKGRldl9wcml2LT5hZ3BfaW5pdGlhbGl6ZWQpIHsKLQkJZHJt
X21tX3Rha2Vkb3duKCZkZXZfcHJpdi0+YWdwX21tKTsKLQkJZGV2X3ByaXYtPmFncF9pbml0
aWFsaXplZCA9IDA7Ci0JfQotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwot
fQotCi1pbnQgdmlhX21lbV9hbGxvYyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAotCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlkcm1fdmlhX21lbV90ICpt
ZW0gPSBkYXRhOwotCWludCByZXR2YWwgPSAwLCB1c2VyX2tleTsKLQlzdHJ1Y3QgdmlhX21l
bWJsb2NrICppdGVtOwotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9IChkcm1fdmlh
X3ByaXZhdGVfdCAqKSBkZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCB2aWFfZmlsZV9wcml2
YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKLQl1bnNpZ25lZCBsb25nIHRt
cFNpemU7Ci0KLQlpZiAobWVtLT50eXBlID4gVklBX01FTV9BR1ApIHsKLQkJRFJNX0VSUk9S
KCJVbmtub3duIG1lbW9yeSB0eXBlIGFsbG9jYXRpb25cbiIpOwotCQlyZXR1cm4gLUVJTlZB
TDsKLQl9Ci0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmICgwID09ICgo
bWVtLT50eXBlID09IFZJQV9NRU1fVklERU8pID8gZGV2X3ByaXYtPnZyYW1faW5pdGlhbGl6
ZWQgOgotCQkgICAgICBkZXZfcHJpdi0+YWdwX2luaXRpYWxpemVkKSkgewotCQltdXRleF91
bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKLQkJRFJNX0VSUk9SCi0JCSAgICAoIkF0dGVt
cHQgdG8gYWxsb2NhdGUgZnJvbSB1bmluaXRpYWxpemVkIG1lbW9yeSBtYW5hZ2VyLlxuIik7
Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWl0ZW0gPSBremFsbG9jKHNpemVvZigqaXRl
bSksIEdGUF9LRVJORUwpOwotCWlmICghaXRlbSkgewotCQlyZXR2YWwgPSAtRU5PTUVNOwot
CQlnb3RvIGZhaWxfYWxsb2M7Ci0JfQotCi0JdG1wU2l6ZSA9IChtZW0tPnNpemUgKyBWSUFf
TU1fQUxJR05fTUFTSykgPj4gVklBX01NX0FMSUdOX1NISUZUOwotCWlmIChtZW0tPnR5cGUg
PT0gVklBX01FTV9BR1ApCi0JCXJldHZhbCA9IGRybV9tbV9pbnNlcnRfbm9kZSgmZGV2X3By
aXYtPmFncF9tbSwKLQkJCQkJICAgICZpdGVtLT5tbV9ub2RlLAotCQkJCQkgICAgdG1wU2l6
ZSk7Ci0JZWxzZQotCQlyZXR2YWwgPSBkcm1fbW1faW5zZXJ0X25vZGUoJmRldl9wcml2LT52
cmFtX21tLAotCQkJCQkgICAgJml0ZW0tPm1tX25vZGUsCi0JCQkJCSAgICB0bXBTaXplKTsK
LQlpZiAocmV0dmFsKQotCQlnb3RvIGZhaWxfYWxsb2M7Ci0KLQlyZXR2YWwgPSBpZHJfYWxs
b2MoJmRldl9wcml2LT5vYmplY3RfaWRyLCBpdGVtLCAxLCAwLCBHRlBfS0VSTkVMKTsKLQlp
ZiAocmV0dmFsIDwgMCkKLQkJZ290byBmYWlsX2lkcjsKLQl1c2VyX2tleSA9IHJldHZhbDsK
LQotCWxpc3RfYWRkKCZpdGVtLT5vd25lcl9saXN0LCAmZmlsZV9wcml2LT5vYmpfbGlzdCk7
Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0KLQltZW0tPm9mZnNldCA9
ICgobWVtLT50eXBlID09IFZJQV9NRU1fVklERU8pID8KLQkJICAgICAgZGV2X3ByaXYtPnZy
YW1fb2Zmc2V0IDogZGV2X3ByaXYtPmFncF9vZmZzZXQpICsKLQkgICAgKChpdGVtLT5tbV9u
b2RlLnN0YXJ0KSA8PCBWSUFfTU1fQUxJR05fU0hJRlQpOwotCW1lbS0+aW5kZXggPSB1c2Vy
X2tleTsKLQotCXJldHVybiAwOwotCi1mYWlsX2lkcjoKLQlkcm1fbW1fcmVtb3ZlX25vZGUo
Jml0ZW0tPm1tX25vZGUpOwotZmFpbF9hbGxvYzoKLQlrZnJlZShpdGVtKTsKLQltdXRleF91
bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKLQotCW1lbS0+b2Zmc2V0ID0gMDsKLQltZW0t
PnNpemUgPSAwOwotCW1lbS0+aW5kZXggPSAwOwotCURSTV9ERUJVRygiVmlkZW8gbWVtb3J5
IGFsbG9jYXRpb24gZmFpbGVkXG4iKTsKLQotCXJldHVybiByZXR2YWw7Ci19Ci0KLWludCB2
aWFfbWVtX2ZyZWUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCi17Ci0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQlkcm1fdmlhX21lbV90ICptZW0gPSBkYXRhOwotCXN0
cnVjdCB2aWFfbWVtYmxvY2sgKm9iajsKLQotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211
dGV4KTsKLQlvYmogPSBpZHJfZmluZCgmZGV2X3ByaXYtPm9iamVjdF9pZHIsIG1lbS0+aW5k
ZXgpOwotCWlmIChvYmogPT0gTlVMTCkgewotCQltdXRleF91bmxvY2soJmRldi0+c3RydWN0
X211dGV4KTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JaWRyX3JlbW92ZSgmZGV2X3By
aXYtPm9iamVjdF9pZHIsIG1lbS0+aW5kZXgpOwotCWxpc3RfZGVsKCZvYmotPm93bmVyX2xp
c3QpOwotCWRybV9tbV9yZW1vdmVfbm9kZSgmb2JqLT5tbV9ub2RlKTsKLQlrZnJlZShvYmop
OwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JRFJNX0RFQlVHKCJm
cmVlID0gMHglbHhcbiIsIG1lbS0+aW5kZXgpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLQotdm9p
ZCB2aWFfcmVjbGFpbV9idWZmZXJzX2xvY2tlZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAot
CQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgdmlhX2ZpbGVfcHJpdmF0
ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7Ci0Jc3RydWN0IHZpYV9tZW1ibG9j
ayAqZW50cnksICpuZXh0OwotCi0JaWYgKCEoZGV2LT5tYXN0ZXIgJiYgZmlsZS0+bWFzdGVy
LT5sb2NrLmh3X2xvY2spKQotCQlyZXR1cm47Ci0KLQlkcm1fbGVnYWN5X2lkbGVsb2NrX3Rh
a2UoJmZpbGUtPm1hc3Rlci0+bG9jayk7Ci0KLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9t
dXRleCk7Ci0JaWYgKGxpc3RfZW1wdHkoJmZpbGVfcHJpdi0+b2JqX2xpc3QpKSB7Ci0JCW11
dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCQlkcm1fbGVnYWN5X2lkbGVsb2Nr
X3JlbGVhc2UoJmZpbGUtPm1hc3Rlci0+bG9jayk7Ci0KLQkJcmV0dXJuOwotCX0KLQotCXZp
YV9kcml2ZXJfZG1hX3F1aWVzY2VudChkZXYpOwotCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKGVudHJ5LCBuZXh0LCAmZmlsZV9wcml2LT5vYmpfbGlzdCwKLQkJCQkgb3duZXJfbGlz
dCkgewotCQlsaXN0X2RlbCgmZW50cnktPm93bmVyX2xpc3QpOwotCQlkcm1fbW1fcmVtb3Zl
X25vZGUoJmVudHJ5LT5tbV9ub2RlKTsKLQkJa2ZyZWUoZW50cnkpOwotCX0KLQltdXRleF91
bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKLQotCWRybV9sZWdhY3lfaWRsZWxvY2tfcmVs
ZWFzZSgmZmlsZS0+bWFzdGVyLT5sb2NrKTsKLQotCXJldHVybjsKLX0KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX3ZlcmlmaWVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
dmlhL3ZpYV92ZXJpZmllci5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAzZDZl
M2E3MGYzMTguLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV92
ZXJpZmllci5jCisrKyAvZGV2L251bGwKQEAgLTEsMTExMCArMCwwIEBACi0vKgotICogQ29w
eXJpZ2h0IDIwMDQgVGhlIFVuaWNocm9tZSBQcm9qZWN0LiBBbGwgUmlnaHRzIFJlc2VydmVk
LgotICogQ29weXJpZ2h0IDIwMDUgVGhvbWFzIEhlbGxzdHJvbS4gQWxsIFJpZ2h0cyBSZXNl
cnZlZC4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNo
YXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICogY29weSBvZiB0aGlzIHNvZnR3
YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUi
KSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGlu
Y2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5
LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWIgbGljZW5zZSwKLSAq
IGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVy
c29ucyB0byB3aG9tIHRoZQotICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBz
dWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKLSAqCi0gKiBUaGUgYWJvdmUg
Y29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVkaW5n
IHRoZQotICogbmV4dCBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3Bp
ZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKLSAqIG9mIHRoZSBTb2Z0d2FyZS4KLSAqCi0g
KiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBP
RiBBTlkgS0lORCwgRVhQUkVTUyBPUgotICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1Qg
TElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCi0gKiBGSVRO
RVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OLUlORlJJTkdFTUVOVC4gSU4g
Tk8gRVZFTlQgU0hBTEwKLSAqIFRIRSBBVVRIT1IoUyksIEFORC9PUiBUSEUgQ09QWVJJR0hU
IEhPTERFUihTKSBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUgotICogT1RI
RVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBP
UiBPVEhFUldJU0UsCi0gKiBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9O
IFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIKLSAqIERFQUxJTkdTIElO
IFRIRSBTT0ZUV0FSRS4KLSAqCi0gKiBBdXRob3I6IFRob21hcyBIZWxsc3Ryb20gMjAwNCwg
MjAwNS4KLSAqIFRoaXMgY29kZSB3YXMgd3JpdHRlbiB1c2luZyBkb2NzIG9idGFpbmVkIHVu
ZGVyIE5EQSBmcm9tIFZJQSBJbmMuCi0gKgotICogRG9uJ3QgcnVuIHRoaXMgY29kZSBkaXJl
Y3RseSBvbiBhbiBBR1AgYnVmZmVyLiBEdWUgdG8gY2FjaGUgcHJvYmxlbXMgaXQgd2lsbAot
ICogYmUgdmVyeSBzbG93LgotICovCi0KLSNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgot
I2luY2x1ZGUgPGRybS9kcm1fbGVnYWN5Lmg+Ci0jaW5jbHVkZSA8ZHJtL3ZpYV9kcm0uaD4K
LQotI2luY2x1ZGUgInZpYV8zZF9yZWcuaCIKLSNpbmNsdWRlICJ2aWFfZHJ2LmgiCi0jaW5j
bHVkZSAidmlhX3ZlcmlmaWVyLmgiCi0KLXR5cGVkZWYgZW51bSB7Ci0Jc3RhdGVfY29tbWFu
ZCwKLQlzdGF0ZV9oZWFkZXIyLAotCXN0YXRlX2hlYWRlcjEsCi0Jc3RhdGVfdmhlYWRlcjUs
Ci0Jc3RhdGVfdmhlYWRlcjYsCi0Jc3RhdGVfZXJyb3IKLX0gdmVyaWZpZXJfc3RhdGVfdDsK
LQotdHlwZWRlZiBlbnVtIHsKLQlub19jaGVjayA9IDAsCi0JY2hlY2tfZm9yX2hlYWRlcjIs
Ci0JY2hlY2tfZm9yX2hlYWRlcjEsCi0JY2hlY2tfZm9yX2hlYWRlcjJfZXJyLAotCWNoZWNr
X2Zvcl9oZWFkZXIxX2VyciwKLQljaGVja19mb3JfZmlyZSwKLQljaGVja196X2J1ZmZlcl9h
ZGRyMCwKLQljaGVja196X2J1ZmZlcl9hZGRyMSwKLQljaGVja196X2J1ZmZlcl9hZGRyX21v
ZGUsCi0JY2hlY2tfZGVzdGluYXRpb25fYWRkcjAsCi0JY2hlY2tfZGVzdGluYXRpb25fYWRk
cjEsCi0JY2hlY2tfZGVzdGluYXRpb25fYWRkcl9tb2RlLAotCWNoZWNrX2Zvcl9kdW1teSwK
LQljaGVja19mb3JfZGQsCi0JY2hlY2tfdGV4dHVyZV9hZGRyMCwKLQljaGVja190ZXh0dXJl
X2FkZHIxLAotCWNoZWNrX3RleHR1cmVfYWRkcjIsCi0JY2hlY2tfdGV4dHVyZV9hZGRyMywK
LQljaGVja190ZXh0dXJlX2FkZHI0LAotCWNoZWNrX3RleHR1cmVfYWRkcjUsCi0JY2hlY2tf
dGV4dHVyZV9hZGRyNiwKLQljaGVja190ZXh0dXJlX2FkZHI3LAotCWNoZWNrX3RleHR1cmVf
YWRkcjgsCi0JY2hlY2tfdGV4dHVyZV9hZGRyX21vZGUsCi0JY2hlY2tfZm9yX3ZlcnRleF9j
b3VudCwKLQljaGVja19udW1iZXJfdGV4dW5pdHMsCi0JZm9yYmlkZGVuX2NvbW1hbmQKLX0g
aGF6YXJkX3Q7Ci0KLS8qCi0gKiBBc3NvY2lhdGVzIGVhY2ggaGF6YXJkIGFib3ZlIHdpdGgg
YSBwb3NzaWJsZSBtdWx0aS1jb21tYW5kCi0gKiBzZXF1ZW5jZS4gRm9yIGV4YW1wbGUgYW4g
YWRkcmVzcyB0aGF0IGlzIHNwbGl0IG92ZXIgbXVsdGlwbGUKLSAqIGNvbW1hbmRzIGFuZCB0
aGF0IG5lZWRzIHRvIGJlIGNoZWNrZWQgYXQgdGhlIGZpcnN0IGNvbW1hbmQKLSAqIHRoYXQg
ZG9lcyBub3QgaW5jbHVkZSBhbnkgcGFydCBvZiB0aGUgYWRkcmVzcy4KLSAqLwotCi1zdGF0
aWMgZHJtX3ZpYV9zZXF1ZW5jZV90IHNlcXNbXSA9IHsKLQlub19zZXF1ZW5jZSwKLQlub19z
ZXF1ZW5jZSwKLQlub19zZXF1ZW5jZSwKLQlub19zZXF1ZW5jZSwKLQlub19zZXF1ZW5jZSwK
LQlub19zZXF1ZW5jZSwKLQl6X2FkZHJlc3MsCi0Jel9hZGRyZXNzLAotCXpfYWRkcmVzcywK
LQlkZXN0X2FkZHJlc3MsCi0JZGVzdF9hZGRyZXNzLAotCWRlc3RfYWRkcmVzcywKLQlub19z
ZXF1ZW5jZSwKLQlub19zZXF1ZW5jZSwKLQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRkcmVzcywK
LQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRk
cmVzcywKLQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRkcmVzcywKLQl0ZXhfYWRkcmVzcywKLQl0
ZXhfYWRkcmVzcywKLQlub19zZXF1ZW5jZQotfTsKLQotdHlwZWRlZiBzdHJ1Y3QgewotCXVu
c2lnbmVkIGludCBjb2RlOwotCWhhemFyZF90IGh6OwotfSBoel9pbml0X3Q7Ci0KLXN0YXRp
YyBoel9pbml0X3QgaW5pdF90YWJsZTFbXSA9IHsKLQl7MHhmMiwgY2hlY2tfZm9yX2hlYWRl
cjJfZXJyfSwKLQl7MHhmMCwgY2hlY2tfZm9yX2hlYWRlcjFfZXJyfSwKLQl7MHhlZSwgY2hl
Y2tfZm9yX2ZpcmV9LAotCXsweGNjLCBjaGVja19mb3JfZHVtbXl9LAotCXsweGRkLCBjaGVj
a19mb3JfZGR9LAotCXsweDAwLCBub19jaGVja30sCi0JezB4MTAsIGNoZWNrX3pfYnVmZmVy
X2FkZHIwfSwKLQl7MHgxMSwgY2hlY2tfel9idWZmZXJfYWRkcjF9LAotCXsweDEyLCBjaGVj
a196X2J1ZmZlcl9hZGRyX21vZGV9LAotCXsweDEzLCBub19jaGVja30sCi0JezB4MTQsIG5v
X2NoZWNrfSwKLQl7MHgxNSwgbm9fY2hlY2t9LAotCXsweDIzLCBub19jaGVja30sCi0JezB4
MjQsIG5vX2NoZWNrfSwKLQl7MHgzMywgbm9fY2hlY2t9LAotCXsweDM0LCBub19jaGVja30s
Ci0JezB4MzUsIG5vX2NoZWNrfSwKLQl7MHgzNiwgbm9fY2hlY2t9LAotCXsweDM3LCBub19j
aGVja30sCi0JezB4MzgsIG5vX2NoZWNrfSwKLQl7MHgzOSwgbm9fY2hlY2t9LAotCXsweDNB
LCBub19jaGVja30sCi0JezB4M0IsIG5vX2NoZWNrfSwKLQl7MHgzQywgbm9fY2hlY2t9LAot
CXsweDNELCBub19jaGVja30sCi0JezB4M0UsIG5vX2NoZWNrfSwKLQl7MHg0MCwgY2hlY2tf
ZGVzdGluYXRpb25fYWRkcjB9LAotCXsweDQxLCBjaGVja19kZXN0aW5hdGlvbl9hZGRyMX0s
Ci0JezB4NDIsIGNoZWNrX2Rlc3RpbmF0aW9uX2FkZHJfbW9kZX0sCi0JezB4NDMsIG5vX2No
ZWNrfSwKLQl7MHg0NCwgbm9fY2hlY2t9LAotCXsweDUwLCBub19jaGVja30sCi0JezB4NTEs
IG5vX2NoZWNrfSwKLQl7MHg1Miwgbm9fY2hlY2t9LAotCXsweDUzLCBub19jaGVja30sCi0J
ezB4NTQsIG5vX2NoZWNrfSwKLQl7MHg1NSwgbm9fY2hlY2t9LAotCXsweDU2LCBub19jaGVj
a30sCi0JezB4NTcsIG5vX2NoZWNrfSwKLQl7MHg1OCwgbm9fY2hlY2t9LAotCXsweDcwLCBu
b19jaGVja30sCi0JezB4NzEsIG5vX2NoZWNrfSwKLQl7MHg3OCwgbm9fY2hlY2t9LAotCXsw
eDc5LCBub19jaGVja30sCi0JezB4N0EsIG5vX2NoZWNrfSwKLQl7MHg3Qiwgbm9fY2hlY2t9
LAotCXsweDdDLCBub19jaGVja30sCi0JezB4N0QsIGNoZWNrX2Zvcl92ZXJ0ZXhfY291bnR9
Ci19OwotCi1zdGF0aWMgaHpfaW5pdF90IGluaXRfdGFibGUyW10gPSB7Ci0JezB4ZjIsIGNo
ZWNrX2Zvcl9oZWFkZXIyX2Vycn0sCi0JezB4ZjAsIGNoZWNrX2Zvcl9oZWFkZXIxX2Vycn0s
Ci0JezB4ZWUsIGNoZWNrX2Zvcl9maXJlfSwKLQl7MHhjYywgY2hlY2tfZm9yX2R1bW15fSwK
LQl7MHgwMCwgY2hlY2tfdGV4dHVyZV9hZGRyMH0sCi0JezB4MDEsIGNoZWNrX3RleHR1cmVf
YWRkcjB9LAotCXsweDAyLCBjaGVja190ZXh0dXJlX2FkZHIwfSwKLQl7MHgwMywgY2hlY2tf
dGV4dHVyZV9hZGRyMH0sCi0JezB4MDQsIGNoZWNrX3RleHR1cmVfYWRkcjB9LAotCXsweDA1
LCBjaGVja190ZXh0dXJlX2FkZHIwfSwKLQl7MHgwNiwgY2hlY2tfdGV4dHVyZV9hZGRyMH0s
Ci0JezB4MDcsIGNoZWNrX3RleHR1cmVfYWRkcjB9LAotCXsweDA4LCBjaGVja190ZXh0dXJl
X2FkZHIwfSwKLQl7MHgwOSwgY2hlY2tfdGV4dHVyZV9hZGRyMH0sCi0JezB4MjAsIGNoZWNr
X3RleHR1cmVfYWRkcjF9LAotCXsweDIxLCBjaGVja190ZXh0dXJlX2FkZHIxfSwKLQl7MHgy
MiwgY2hlY2tfdGV4dHVyZV9hZGRyMX0sCi0JezB4MjMsIGNoZWNrX3RleHR1cmVfYWRkcjR9
LAotCXsweDJCLCBjaGVja190ZXh0dXJlX2FkZHIzfSwKLQl7MHgyQywgY2hlY2tfdGV4dHVy
ZV9hZGRyM30sCi0JezB4MkQsIGNoZWNrX3RleHR1cmVfYWRkcjN9LAotCXsweDJFLCBjaGVj
a190ZXh0dXJlX2FkZHIzfSwKLQl7MHgyRiwgY2hlY2tfdGV4dHVyZV9hZGRyM30sCi0JezB4
MzAsIGNoZWNrX3RleHR1cmVfYWRkcjN9LAotCXsweDMxLCBjaGVja190ZXh0dXJlX2FkZHIz
fSwKLQl7MHgzMiwgY2hlY2tfdGV4dHVyZV9hZGRyM30sCi0JezB4MzMsIGNoZWNrX3RleHR1
cmVfYWRkcjN9LAotCXsweDM0LCBjaGVja190ZXh0dXJlX2FkZHIzfSwKLQl7MHg0QiwgY2hl
Y2tfdGV4dHVyZV9hZGRyNX0sCi0JezB4NEMsIGNoZWNrX3RleHR1cmVfYWRkcjZ9LAotCXsw
eDUxLCBjaGVja190ZXh0dXJlX2FkZHI3fSwKLQl7MHg1MiwgY2hlY2tfdGV4dHVyZV9hZGRy
OH0sCi0JezB4NzcsIGNoZWNrX3RleHR1cmVfYWRkcjJ9LAotCXsweDc4LCBub19jaGVja30s
Ci0JezB4NzksIG5vX2NoZWNrfSwKLQl7MHg3QSwgbm9fY2hlY2t9LAotCXsweDdCLCBjaGVj
a190ZXh0dXJlX2FkZHJfbW9kZX0sCi0JezB4N0MsIG5vX2NoZWNrfSwKLQl7MHg3RCwgbm9f
Y2hlY2t9LAotCXsweDdFLCBub19jaGVja30sCi0JezB4N0YsIG5vX2NoZWNrfSwKLQl7MHg4
MCwgbm9fY2hlY2t9LAotCXsweDgxLCBub19jaGVja30sCi0JezB4ODIsIG5vX2NoZWNrfSwK
LQl7MHg4Mywgbm9fY2hlY2t9LAotCXsweDg1LCBub19jaGVja30sCi0JezB4ODYsIG5vX2No
ZWNrfSwKLQl7MHg4Nywgbm9fY2hlY2t9LAotCXsweDg4LCBub19jaGVja30sCi0JezB4ODks
IG5vX2NoZWNrfSwKLQl7MHg4QSwgbm9fY2hlY2t9LAotCXsweDkwLCBub19jaGVja30sCi0J
ezB4OTEsIG5vX2NoZWNrfSwKLQl7MHg5Miwgbm9fY2hlY2t9LAotCXsweDkzLCBub19jaGVj
a30KLX07Ci0KLXN0YXRpYyBoel9pbml0X3QgaW5pdF90YWJsZTNbXSA9IHsKLQl7MHhmMiwg
Y2hlY2tfZm9yX2hlYWRlcjJfZXJyfSwKLQl7MHhmMCwgY2hlY2tfZm9yX2hlYWRlcjFfZXJy
fSwKLQl7MHhjYywgY2hlY2tfZm9yX2R1bW15fSwKLQl7MHgwMCwgY2hlY2tfbnVtYmVyX3Rl
eHVuaXRzfQotfTsKLQotc3RhdGljIGhhemFyZF90IHRhYmxlMVsyNTZdOwotc3RhdGljIGhh
emFyZF90IHRhYmxlMlsyNTZdOwotc3RhdGljIGhhemFyZF90IHRhYmxlM1syNTZdOwotCi1z
dGF0aWMgX19pbmxpbmVfXyBpbnQKLWVhdF93b3Jkcyhjb25zdCB1aW50MzJfdCAqKmJ1Ziwg
Y29uc3QgdWludDMyX3QgKmJ1Zl9lbmQsIHVuc2lnbmVkIG51bV93b3JkcykKLXsKLQlpZiAo
KGJ1Zl9lbmQgLSAqYnVmKSA+PSBudW1fd29yZHMpIHsKLQkJKmJ1ZiArPSBudW1fd29yZHM7
Ci0JCXJldHVybiAwOwotCX0KLQlEUk1fRVJST1IoIklsbGVnYWwgdGVybWluYXRpb24gb2Yg
RE1BIGNvbW1hbmQgYnVmZmVyXG4iKTsKLQlyZXR1cm4gMTsKLX0KLQotLyoKLSAqIFBhcnRp
YWxseSBzdG9sZW4gZnJvbSBkcm1fbWVtb3J5LmgKLSAqLwotCi1zdGF0aWMgX19pbmxpbmVf
XyBkcm1fbG9jYWxfbWFwX3QgKnZpYV9kcm1fbG9va3VwX2FncF9tYXAoZHJtX3ZpYV9zdGF0
ZV90ICpzZXEsCi0JCQkJCQkgICAgdW5zaWduZWQgbG9uZyBvZmZzZXQsCi0JCQkJCQkgICAg
dW5zaWduZWQgbG9uZyBzaXplLAotCQkJCQkJICAgIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYp
Ci17Ci0Jc3RydWN0IGRybV9tYXBfbGlzdCAqcl9saXN0OwotCWRybV9sb2NhbF9tYXBfdCAq
bWFwID0gc2VxLT5tYXBfY2FjaGU7Ci0KLQlpZiAobWFwICYmIG1hcC0+b2Zmc2V0IDw9IG9m
ZnNldAotCSAgICAmJiAob2Zmc2V0ICsgc2l6ZSkgPD0gKG1hcC0+b2Zmc2V0ICsgbWFwLT5z
aXplKSkgewotCQlyZXR1cm4gbWFwOwotCX0KLQotCWxpc3RfZm9yX2VhY2hfZW50cnkocl9s
aXN0LCAmZGV2LT5tYXBsaXN0LCBoZWFkKSB7Ci0JCW1hcCA9IHJfbGlzdC0+bWFwOwotCQlp
ZiAoIW1hcCkKLQkJCWNvbnRpbnVlOwotCQlpZiAobWFwLT5vZmZzZXQgPD0gb2Zmc2V0Ci0J
CSAgICAmJiAob2Zmc2V0ICsgc2l6ZSkgPD0gKG1hcC0+b2Zmc2V0ICsgbWFwLT5zaXplKQot
CQkgICAgJiYgIShtYXAtPmZsYWdzICYgX0RSTV9SRVNUUklDVEVEKQotCQkgICAgJiYgKG1h
cC0+dHlwZSA9PSBfRFJNX0FHUCkpIHsKLQkJCXNlcS0+bWFwX2NhY2hlID0gbWFwOwotCQkJ
cmV0dXJuIG1hcDsKLQkJfQotCX0KLQlyZXR1cm4gTlVMTDsKLX0KLQotLyoKLSAqIFJlcXVp
cmUgdGhhdCBhbGwgQUdQIHRleHR1cmUgbGV2ZWxzIHJlc2lkZSBpbiB0aGUgc2FtZSBBR1Ag
bWFwIHdoaWNoIHNob3VsZAotICogYmUgbWFwcGFibGUgYnkgdGhlIGNsaWVudC4gVGhpcyBp
cyBub3QgYSBiaWcgcmVzdHJpY3Rpb24uCi0gKiBGSVhNRTogVG8gYWN0dWFsbHkgZW5mb3Jj
ZSB0aGlzIHNlY3VyaXR5IHBvbGljeSBzdHJpY3RseSwgZHJtX3JtbWFwCi0gKiB3b3VsZCBo
YXZlIHRvIHdhaXQgZm9yIGRtYSBxdWllc2NlbnQgYmVmb3JlIHJlbW92aW5nIGFuIEFHUCBt
YXAuCi0gKiBUaGUgdmlhX2RybV9sb29rdXBfYWdwX21hcCBjYWxsIGluIHJlYWxpdHkgc2Vl
bXMgdG8gdGFrZQotICogdmVyeSBsaXR0bGUgQ1BVIHRpbWUuCi0gKi8KLQotc3RhdGljIF9f
aW5saW5lX18gaW50IGZpbmlzaF9jdXJyZW50X3NlcXVlbmNlKGRybV92aWFfc3RhdGVfdCAq
IGN1cl9zZXEpCi17Ci0Jc3dpdGNoIChjdXJfc2VxLT51bmZpbmlzaGVkKSB7Ci0JY2FzZSB6
X2FkZHJlc3M6Ci0JCURSTV9ERUJVRygiWiBCdWZmZXIgc3RhcnQgYWRkcmVzcyBpcyAweCV4
XG4iLCBjdXJfc2VxLT56X2FkZHIpOwotCQlicmVhazsKLQljYXNlIGRlc3RfYWRkcmVzczoK
LQkJRFJNX0RFQlVHKCJEZXN0aW5hdGlvbiBzdGFydCBhZGRyZXNzIGlzIDB4JXhcbiIsCi0J
CQkgIGN1cl9zZXEtPmRfYWRkcik7Ci0JCWJyZWFrOwotCWNhc2UgdGV4X2FkZHJlc3M6Ci0J
CWlmIChjdXJfc2VxLT5hZ3BfdGV4dHVyZSkgewotCQkJdW5zaWduZWQgc3RhcnQgPQotCQkJ
ICAgIGN1cl9zZXEtPnRleF9sZXZlbF9sb1tjdXJfc2VxLT50ZXh0dXJlXTsKLQkJCXVuc2ln
bmVkIGVuZCA9IGN1cl9zZXEtPnRleF9sZXZlbF9oaVtjdXJfc2VxLT50ZXh0dXJlXTsKLQkJ
CXVuc2lnbmVkIGxvbmcgbG8gPSB+MCwgaGkgPSAwLCB0bXA7Ci0JCQl1aW50MzJfdCAqYWRk
ciwgKnBpdGNoLCAqaGVpZ2h0LCB0ZXg7Ci0JCQl1bnNpZ25lZCBpOwotCQkJaW50IG5wb3Q7
Ci0KLQkJCWlmIChlbmQgPiA5KQotCQkJCWVuZCA9IDk7Ci0JCQlpZiAoc3RhcnQgPiA5KQot
CQkJCXN0YXJ0ID0gOTsKLQotCQkJYWRkciA9Ci0JCQkgICAgJihjdXJfc2VxLT50X2FkZHJb
dGV4ID0gY3VyX3NlcS0+dGV4dHVyZV1bc3RhcnRdKTsKLQkJCXBpdGNoID0gJihjdXJfc2Vx
LT5waXRjaFt0ZXhdW3N0YXJ0XSk7Ci0JCQloZWlnaHQgPSAmKGN1cl9zZXEtPmhlaWdodFt0
ZXhdW3N0YXJ0XSk7Ci0JCQlucG90ID0gY3VyX3NlcS0+dGV4X25wb3RbdGV4XTsKLQkJCWZv
ciAoaSA9IHN0YXJ0OyBpIDw9IGVuZDsgKytpKSB7Ci0JCQkJdG1wID0gKmFkZHIrKzsKLQkJ
CQlpZiAodG1wIDwgbG8pCi0JCQkJCWxvID0gdG1wOwotCQkJCWlmIChpID09IDAgJiYgbnBv
dCkKLQkJCQkJdG1wICs9ICgqaGVpZ2h0KysgKiAqcGl0Y2grKyk7Ci0JCQkJZWxzZQotCQkJ
CQl0bXAgKz0gKCpoZWlnaHQrKyA8PCAqcGl0Y2grKyk7Ci0JCQkJaWYgKHRtcCA+IGhpKQot
CQkJCQloaSA9IHRtcDsKLQkJCX0KLQotCQkJaWYgKCF2aWFfZHJtX2xvb2t1cF9hZ3BfbWFw
Ci0JCQkgICAgKGN1cl9zZXEsIGxvLCBoaSAtIGxvLCBjdXJfc2VxLT5kZXYpKSB7Ci0JCQkJ
RFJNX0VSUk9SCi0JCQkJICAgICgiQUdQIHRleHR1cmUgaXMgbm90IGluIGFsbG93ZWQgbWFw
XG4iKTsKLQkJCQlyZXR1cm4gMjsKLQkJCX0KLQkJfQotCQlicmVhazsKLQlkZWZhdWx0Ogot
CQlicmVhazsKLQl9Ci0JY3VyX3NlcS0+dW5maW5pc2hlZCA9IG5vX3NlcXVlbmNlOwotCXJl
dHVybiAwOwotfQotCi1zdGF0aWMgX19pbmxpbmVfXyBpbnQKLWludmVzdGlnYXRlX2hhemFy
ZCh1aW50MzJfdCBjbWQsIGhhemFyZF90IGh6LCBkcm1fdmlhX3N0YXRlX3QgKmN1cl9zZXEp
Ci17Ci0JcmVnaXN0ZXIgdWludDMyX3QgdG1wLCAqdG1wX2FkZHI7Ci0KLQlpZiAoY3VyX3Nl
cS0+dW5maW5pc2hlZCAmJiAoY3VyX3NlcS0+dW5maW5pc2hlZCAhPSBzZXFzW2h6XSkpIHsK
LQkJaW50IHJldDsKLQkJaWYgKChyZXQgPSBmaW5pc2hfY3VycmVudF9zZXF1ZW5jZShjdXJf
c2VxKSkpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCXN3aXRjaCAoaHopIHsKLQljYXNlIGNo
ZWNrX2Zvcl9oZWFkZXIyOgotCQlpZiAoY21kID09IEhBTENZT05fSEVBREVSMikKLQkJCXJl
dHVybiAxOwotCQlyZXR1cm4gMDsKLQljYXNlIGNoZWNrX2Zvcl9oZWFkZXIxOgotCQlpZiAo
KGNtZCAmIEhBTENZT05fSEVBREVSMU1BU0spID09IEhBTENZT05fSEVBREVSMSkKLQkJCXJl
dHVybiAxOwotCQlyZXR1cm4gMDsKLQljYXNlIGNoZWNrX2Zvcl9oZWFkZXIyX2VycjoKLQkJ
aWYgKGNtZCA9PSBIQUxDWU9OX0hFQURFUjIpCi0JCQlyZXR1cm4gMTsKLQkJRFJNX0VSUk9S
KCJJbGxlZ2FsIERNQSBIQUxDWU9OX0hFQURFUjIgY29tbWFuZFxuIik7Ci0JCWJyZWFrOwot
CWNhc2UgY2hlY2tfZm9yX2hlYWRlcjFfZXJyOgotCQlpZiAoKGNtZCAmIEhBTENZT05fSEVB
REVSMU1BU0spID09IEhBTENZT05fSEVBREVSMSkKLQkJCXJldHVybiAxOwotCQlEUk1fRVJS
T1IoIklsbGVnYWwgRE1BIEhBTENZT05fSEVBREVSMSBjb21tYW5kXG4iKTsKLQkJYnJlYWs7
Ci0JY2FzZSBjaGVja19mb3JfZmlyZToKLQkJaWYgKChjbWQgJiBIQUxDWU9OX0ZJUkVNQVNL
KSA9PSBIQUxDWU9OX0ZJUkVDTUQpCi0JCQlyZXR1cm4gMTsKLQkJRFJNX0VSUk9SKCJJbGxl
Z2FsIERNQSBIQUxDWU9OX0ZJUkVDTUQgY29tbWFuZFxuIik7Ci0JCWJyZWFrOwotCWNhc2Ug
Y2hlY2tfZm9yX2R1bW15OgotCQlpZiAoSENfRFVNTVkgPT0gY21kKQotCQkJcmV0dXJuIDA7
Ci0JCURSTV9FUlJPUigiSWxsZWdhbCBETUEgSENfRFVNTVkgY29tbWFuZFxuIik7Ci0JCWJy
ZWFrOwotCWNhc2UgY2hlY2tfZm9yX2RkOgotCQlpZiAoMHhkZGRkZGRkZCA9PSBjbWQpCi0J
CQlyZXR1cm4gMDsKLQkJRFJNX0VSUk9SKCJJbGxlZ2FsIERNQSAweGRkZGRkZGRkIGNvbW1h
bmRcbiIpOwotCQlicmVhazsKLQljYXNlIGNoZWNrX3pfYnVmZmVyX2FkZHIwOgotCQljdXJf
c2VxLT51bmZpbmlzaGVkID0gel9hZGRyZXNzOwotCQljdXJfc2VxLT56X2FkZHIgPSAoY3Vy
X3NlcS0+el9hZGRyICYgMHhGRjAwMDAwMCkgfAotCQkgICAgKGNtZCAmIDB4MDBGRkZGRkYp
OwotCQlyZXR1cm4gMDsKLQljYXNlIGNoZWNrX3pfYnVmZmVyX2FkZHIxOgotCQljdXJfc2Vx
LT51bmZpbmlzaGVkID0gel9hZGRyZXNzOwotCQljdXJfc2VxLT56X2FkZHIgPSAoY3VyX3Nl
cS0+el9hZGRyICYgMHgwMEZGRkZGRikgfAotCQkgICAgKChjbWQgJiAweEZGKSA8PCAyNCk7
Ci0JCXJldHVybiAwOwotCWNhc2UgY2hlY2tfel9idWZmZXJfYWRkcl9tb2RlOgotCQljdXJf
c2VxLT51bmZpbmlzaGVkID0gel9hZGRyZXNzOwotCQlpZiAoKGNtZCAmIDB4MDAwMEMwMDAp
ID09IDApCi0JCQlyZXR1cm4gMDsKLQkJRFJNX0VSUk9SKCJBdHRlbXB0IHRvIHBsYWNlIFog
YnVmZmVyIGluIHN5c3RlbSBtZW1vcnlcbiIpOwotCQlyZXR1cm4gMjsKLQljYXNlIGNoZWNr
X2Rlc3RpbmF0aW9uX2FkZHIwOgotCQljdXJfc2VxLT51bmZpbmlzaGVkID0gZGVzdF9hZGRy
ZXNzOwotCQljdXJfc2VxLT5kX2FkZHIgPSAoY3VyX3NlcS0+ZF9hZGRyICYgMHhGRjAwMDAw
MCkgfAotCQkgICAgKGNtZCAmIDB4MDBGRkZGRkYpOwotCQlyZXR1cm4gMDsKLQljYXNlIGNo
ZWNrX2Rlc3RpbmF0aW9uX2FkZHIxOgotCQljdXJfc2VxLT51bmZpbmlzaGVkID0gZGVzdF9h
ZGRyZXNzOwotCQljdXJfc2VxLT5kX2FkZHIgPSAoY3VyX3NlcS0+ZF9hZGRyICYgMHgwMEZG
RkZGRikgfAotCQkgICAgKChjbWQgJiAweEZGKSA8PCAyNCk7Ci0JCXJldHVybiAwOwotCWNh
c2UgY2hlY2tfZGVzdGluYXRpb25fYWRkcl9tb2RlOgotCQljdXJfc2VxLT51bmZpbmlzaGVk
ID0gZGVzdF9hZGRyZXNzOwotCQlpZiAoKGNtZCAmIDB4MDAwMEMwMDApID09IDApCi0JCQly
ZXR1cm4gMDsKLQkJRFJNX0VSUk9SCi0JCSAgICAoIkF0dGVtcHQgdG8gcGxhY2UgM0QgZHJh
d2luZyBidWZmZXIgaW4gc3lzdGVtIG1lbW9yeVxuIik7Ci0JCXJldHVybiAyOwotCWNhc2Ug
Y2hlY2tfdGV4dHVyZV9hZGRyMDoKLQkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRy
ZXNzOwotCQl0bXAgPSAoY21kID4+IDI0KTsKLQkJdG1wX2FkZHIgPSAmY3VyX3NlcS0+dF9h
ZGRyW2N1cl9zZXEtPnRleHR1cmVdW3RtcF07Ci0JCSp0bXBfYWRkciA9ICgqdG1wX2FkZHIg
JiAweEZGMDAwMDAwKSB8IChjbWQgJiAweDAwRkZGRkZGKTsKLQkJcmV0dXJuIDA7Ci0JY2Fz
ZSBjaGVja190ZXh0dXJlX2FkZHIxOgotCQljdXJfc2VxLT51bmZpbmlzaGVkID0gdGV4X2Fk
ZHJlc3M7Ci0JCXRtcCA9ICgoY21kID4+IDI0KSAtIDB4MjApOwotCQl0bXAgKz0gdG1wIDw8
IDE7Ci0JCXRtcF9hZGRyID0gJmN1cl9zZXEtPnRfYWRkcltjdXJfc2VxLT50ZXh0dXJlXVt0
bXBdOwotCQkqdG1wX2FkZHIgPSAoKnRtcF9hZGRyICYgMHgwMEZGRkZGRikgfCAoKGNtZCAm
IDB4RkYpIDw8IDI0KTsKLQkJdG1wX2FkZHIrKzsKLQkJKnRtcF9hZGRyID0gKCp0bXBfYWRk
ciAmIDB4MDBGRkZGRkYpIHwgKChjbWQgJiAweEZGMDApIDw8IDE2KTsKLQkJdG1wX2FkZHIr
KzsKLQkJKnRtcF9hZGRyID0gKCp0bXBfYWRkciAmIDB4MDBGRkZGRkYpIHwgKChjbWQgJiAw
eEZGMDAwMCkgPDwgOCk7Ci0JCXJldHVybiAwOwotCWNhc2UgY2hlY2tfdGV4dHVyZV9hZGRy
MjoKLQkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOwotCQljdXJfc2VxLT50
ZXhfbGV2ZWxfbG9bdG1wID0gY3VyX3NlcS0+dGV4dHVyZV0gPSBjbWQgJiAweDNGOwotCQlj
dXJfc2VxLT50ZXhfbGV2ZWxfaGlbdG1wXSA9IChjbWQgJiAweEZDMCkgPj4gNjsKLQkJcmV0
dXJuIDA7Ci0JY2FzZSBjaGVja190ZXh0dXJlX2FkZHIzOgotCQljdXJfc2VxLT51bmZpbmlz
aGVkID0gdGV4X2FkZHJlc3M7Ci0JCXRtcCA9ICgoY21kID4+IDI0KSAtIEhDX1N1YkFfSFRY
bkwwUGl0KTsKLQkJaWYgKHRtcCA9PSAwICYmCi0JCSAgICAoY21kICYgSENfSFRYbkVuUGl0
X01BU0spKSB7Ci0JCQljdXJfc2VxLT5waXRjaFtjdXJfc2VxLT50ZXh0dXJlXVt0bXBdID0K
LQkJCQkoY21kICYgSENfSFRYbkxuUGl0X01BU0spOwotCQkJY3VyX3NlcS0+dGV4X25wb3Rb
Y3VyX3NlcS0+dGV4dHVyZV0gPSAxOwotCQl9IGVsc2UgewotCQkJY3VyX3NlcS0+cGl0Y2hb
Y3VyX3NlcS0+dGV4dHVyZV1bdG1wXSA9Ci0JCQkJKGNtZCAmIEhDX0hUWG5MblBpdEVfTUFT
SykgPj4gSENfSFRYbkxuUGl0RV9TSElGVDsKLQkJCWN1cl9zZXEtPnRleF9ucG90W2N1cl9z
ZXEtPnRleHR1cmVdID0gMDsKLQkJCWlmIChjbWQgJiAweDAwMEZGRkZGKSB7Ci0JCQkJRFJN
X0VSUk9SCi0JCQkJCSgiVW5pbXBsZW1lbnRlZCB0ZXh0dXJlIGxldmVsIDAgcGl0Y2ggbW9k
ZS5cbiIpOwotCQkJCXJldHVybiAyOwotCQkJfQotCQl9Ci0JCXJldHVybiAwOwotCWNhc2Ug
Y2hlY2tfdGV4dHVyZV9hZGRyNDoKLQkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRy
ZXNzOwotCQl0bXBfYWRkciA9ICZjdXJfc2VxLT50X2FkZHJbY3VyX3NlcS0+dGV4dHVyZV1b
OV07Ci0JCSp0bXBfYWRkciA9ICgqdG1wX2FkZHIgJiAweDAwRkZGRkZGKSB8ICgoY21kICYg
MHhGRikgPDwgMjQpOwotCQlyZXR1cm4gMDsKLQljYXNlIGNoZWNrX3RleHR1cmVfYWRkcjU6
Ci0JY2FzZSBjaGVja190ZXh0dXJlX2FkZHI2OgotCQljdXJfc2VxLT51bmZpbmlzaGVkID0g
dGV4X2FkZHJlc3M7Ci0JCS8qCi0JCSAqIFRleHR1cmUgd2lkdGguIFdlIGRvbid0IGNhcmUg
c2luY2Ugd2UgaGF2ZSB0aGUgcGl0Y2guCi0JCSAqLwotCQlyZXR1cm4gMDsKLQljYXNlIGNo
ZWNrX3RleHR1cmVfYWRkcjc6Ci0JCWN1cl9zZXEtPnVuZmluaXNoZWQgPSB0ZXhfYWRkcmVz
czsKLQkJdG1wX2FkZHIgPSAmKGN1cl9zZXEtPmhlaWdodFtjdXJfc2VxLT50ZXh0dXJlXVsw
XSk7Ci0JCXRtcF9hZGRyWzVdID0gMSA8PCAoKGNtZCAmIDB4MDBGMDAwMDApID4+IDIwKTsK
LQkJdG1wX2FkZHJbNF0gPSAxIDw8ICgoY21kICYgMHgwMDBGMDAwMCkgPj4gMTYpOwotCQl0
bXBfYWRkclszXSA9IDEgPDwgKChjbWQgJiAweDAwMDBGMDAwKSA+PiAxMik7Ci0JCXRtcF9h
ZGRyWzJdID0gMSA8PCAoKGNtZCAmIDB4MDAwMDBGMDApID4+IDgpOwotCQl0bXBfYWRkclsx
XSA9IDEgPDwgKChjbWQgJiAweDAwMDAwMEYwKSA+PiA0KTsKLQkJdG1wX2FkZHJbMF0gPSAx
IDw8IChjbWQgJiAweDAwMDAwMDBGKTsKLQkJcmV0dXJuIDA7Ci0JY2FzZSBjaGVja190ZXh0
dXJlX2FkZHI4OgotCQljdXJfc2VxLT51bmZpbmlzaGVkID0gdGV4X2FkZHJlc3M7Ci0JCXRt
cF9hZGRyID0gJihjdXJfc2VxLT5oZWlnaHRbY3VyX3NlcS0+dGV4dHVyZV1bMF0pOwotCQl0
bXBfYWRkcls5XSA9IDEgPDwgKChjbWQgJiAweDAwMDBGMDAwKSA+PiAxMik7Ci0JCXRtcF9h
ZGRyWzhdID0gMSA8PCAoKGNtZCAmIDB4MDAwMDBGMDApID4+IDgpOwotCQl0bXBfYWRkcls3
XSA9IDEgPDwgKChjbWQgJiAweDAwMDAwMEYwKSA+PiA0KTsKLQkJdG1wX2FkZHJbNl0gPSAx
IDw8IChjbWQgJiAweDAwMDAwMDBGKTsKLQkJcmV0dXJuIDA7Ci0JY2FzZSBjaGVja190ZXh0
dXJlX2FkZHJfbW9kZToKLQkJY3VyX3NlcS0+dW5maW5pc2hlZCA9IHRleF9hZGRyZXNzOwot
CQlpZiAoMiA9PSAodG1wID0gY21kICYgMHgwMDAwMDAwMykpIHsKLQkJCURSTV9FUlJPUgot
CQkJICAgICgiQXR0ZW1wdCB0byBmZXRjaCB0ZXh0dXJlIGZyb20gc3lzdGVtIG1lbW9yeS5c
biIpOwotCQkJcmV0dXJuIDI7Ci0JCX0KLQkJY3VyX3NlcS0+YWdwX3RleHR1cmUgPSAodG1w
ID09IDMpOwotCQljdXJfc2VxLT50ZXhfcGFsZXR0ZV9zaXplW2N1cl9zZXEtPnRleHR1cmVd
ID0KLQkJICAgIChjbWQgPj4gMTYpICYgMHgwMDAwMDAwMDc7Ci0JCXJldHVybiAwOwotCWNh
c2UgY2hlY2tfZm9yX3ZlcnRleF9jb3VudDoKLQkJY3VyX3NlcS0+dmVydGV4X2NvdW50ID0g
Y21kICYgMHgwMDAwRkZGRjsKLQkJcmV0dXJuIDA7Ci0JY2FzZSBjaGVja19udW1iZXJfdGV4
dW5pdHM6Ci0JCWN1cl9zZXEtPm11bHRpdGV4ID0gKGNtZCA+PiAzKSAmIDE7Ci0JCXJldHVy
biAwOwotCWRlZmF1bHQ6Ci0JCURSTV9FUlJPUigiSWxsZWdhbCBETUEgZGF0YTogMHgleFxu
IiwgY21kKTsKLQkJcmV0dXJuIDI7Ci0JfQotCXJldHVybiAyOwotfQotCi1zdGF0aWMgX19p
bmxpbmVfXyBpbnQKLXZpYV9jaGVja19wcmltX2xpc3QodWludDMyX3QgY29uc3QgKipidWZm
ZXIsIGNvbnN0IHVpbnQzMl90ICogYnVmX2VuZCwKLQkJICAgIGRybV92aWFfc3RhdGVfdCAq
Y3VyX3NlcSkKLXsKLQlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYgPQotCSAgICAoZHJt
X3ZpYV9wcml2YXRlX3QgKikgY3VyX3NlcS0+ZGV2LT5kZXZfcHJpdmF0ZTsKLQl1aW50MzJf
dCBhX2ZpcmUsIGJjbWQsIGR3X2NvdW50OwotCWludCByZXQgPSAwOwotCWludCBoYXZlX2Zp
cmU7Ci0JY29uc3QgdWludDMyX3QgKmJ1ZiA9ICpidWZmZXI7Ci0KLQl3aGlsZSAoYnVmIDwg
YnVmX2VuZCkgewotCQloYXZlX2ZpcmUgPSAwOwotCQlpZiAoKGJ1Zl9lbmQgLSBidWYpIDwg
MikgewotCQkJRFJNX0VSUk9SCi0JCQkgICAgKCJVbmV4cGVjdGVkIHRlcm1pbmF0aW9uIG9m
IHByaW1pdGl2ZSBsaXN0LlxuIik7Ci0JCQlyZXQgPSAxOwotCQkJYnJlYWs7Ci0JCX0KLQkJ
aWYgKCgqYnVmICYgSENfQUNNRF9NQVNLKSAhPSBIQ19BQ01EX0hDbWRCKQotCQkJYnJlYWs7
Ci0JCWJjbWQgPSAqYnVmKys7Ci0JCWlmICgoKmJ1ZiAmIEhDX0FDTURfTUFTSykgIT0gSENf
QUNNRF9IQ21kQSkgewotCQkJRFJNX0VSUk9SKCJFeHBlY3RlZCBWZXJ0ZXggTGlzdCBBIGNv
bW1hbmQsIGdvdCAweCV4XG4iLAotCQkJCSAgKmJ1Zik7Ci0JCQlyZXQgPSAxOwotCQkJYnJl
YWs7Ci0JCX0KLQkJYV9maXJlID0KLQkJICAgICpidWYrKyB8IEhDX0hQTEVORF9NQVNLIHwg
SENfSFBNVmFsaWROX01BU0sgfAotCQkgICAgSENfSEUzRmlyZV9NQVNLOwotCi0JCS8qCi0J
CSAqIEhvdyBtYW55IGR3b3JkcyBwZXIgdmVydGV4ID8KLQkJICovCi0KLQkJaWYgKGN1cl9z
ZXEtPmFncCAmJiAoKGJjbWQgJiAoMHhGIDw8IDExKSkgPT0gMCkpIHsKLQkJCURSTV9FUlJP
UigiSWxsZWdhbCBCIGNvbW1hbmQgdmVydGV4IGRhdGEgZm9yIEFHUC5cbiIpOwotCQkJcmV0
ID0gMTsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJZHdfY291bnQgPSAwOwotCQlpZiAoYmNtZCAm
ICgxIDw8IDcpKQotCQkJZHdfY291bnQgKz0gKGN1cl9zZXEtPm11bHRpdGV4KSA/IDIgOiAx
OwotCQlpZiAoYmNtZCAmICgxIDw8IDgpKQotCQkJZHdfY291bnQgKz0gKGN1cl9zZXEtPm11
bHRpdGV4KSA/IDIgOiAxOwotCQlpZiAoYmNtZCAmICgxIDw8IDkpKQotCQkJZHdfY291bnQr
KzsKLQkJaWYgKGJjbWQgJiAoMSA8PCAxMCkpCi0JCQlkd19jb3VudCsrOwotCQlpZiAoYmNt
ZCAmICgxIDw8IDExKSkKLQkJCWR3X2NvdW50Kys7Ci0JCWlmIChiY21kICYgKDEgPDwgMTIp
KQotCQkJZHdfY291bnQrKzsKLQkJaWYgKGJjbWQgJiAoMSA8PCAxMykpCi0JCQlkd19jb3Vu
dCsrOwotCQlpZiAoYmNtZCAmICgxIDw8IDE0KSkKLQkJCWR3X2NvdW50Kys7Ci0KLQkJd2hp
bGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsKLQkJCWlmICgqYnVmID09IGFfZmlyZSkgewotCQkJCWlm
IChkZXZfcHJpdi0+bnVtX2ZpcmVfb2Zmc2V0cyA+PQotCQkJCSAgICBWSUFfRklSRV9CVUZf
U0laRSkgewotCQkJCQlEUk1fRVJST1IoIkZpcmUgb2Zmc2V0IGJ1ZmZlciBmdWxsLlxuIik7
Ci0JCQkJCXJldCA9IDE7Ci0JCQkJCWJyZWFrOwotCQkJCX0KLQkJCQlkZXZfcHJpdi0+Zmly
ZV9vZmZzZXRzW2Rldl9wcml2LT4KLQkJCQkJCSAgICAgICBudW1fZmlyZV9vZmZzZXRzKytd
ID0KLQkJCQkgICAgYnVmOwotCQkJCWhhdmVfZmlyZSA9IDE7Ci0JCQkJYnVmKys7Ci0JCQkJ
aWYgKGJ1ZiA8IGJ1Zl9lbmQgJiYgKmJ1ZiA9PSBhX2ZpcmUpCi0JCQkJCWJ1ZisrOwotCQkJ
CWJyZWFrOwotCQkJfQotCQkJaWYgKCgqYnVmID09IEhBTENZT05fSEVBREVSMikgfHwKLQkJ
CSAgICAoKCpidWYgJiBIQUxDWU9OX0ZJUkVNQVNLKSA9PSBIQUxDWU9OX0ZJUkVDTUQpKSB7
Ci0JCQkJRFJNX0VSUk9SKCJNaXNzaW5nIFZlcnRleCBGaXJlIGNvbW1hbmQsICIKLQkJCQkJ
ICAiU3RyYXkgVmVydGV4IEZpcmUgY29tbWFuZCAgb3IgdmVyaWZpZXIgIgotCQkJCQkgICJs
b3N0IHN5bmMuXG4iKTsKLQkJCQlyZXQgPSAxOwotCQkJCWJyZWFrOwotCQkJfQotCQkJaWYg
KChyZXQgPSBlYXRfd29yZHMoJmJ1ZiwgYnVmX2VuZCwgZHdfY291bnQpKSkKLQkJCQlicmVh
azsKLQkJfQotCQlpZiAoYnVmID49IGJ1Zl9lbmQgJiYgIWhhdmVfZmlyZSkgewotCQkJRFJN
X0VSUk9SKCJNaXNzaW5nIFZlcnRleCBGaXJlIGNvbW1hbmQgb3IgdmVyaWZpZXIgIgotCQkJ
CSAgImxvc3Qgc3luYy5cbiIpOwotCQkJcmV0ID0gMTsKLQkJCWJyZWFrOwotCQl9Ci0JCWlm
IChjdXJfc2VxLT5hZ3AgJiYgKChidWYgLSBjdXJfc2VxLT5idWZfc3RhcnQpICYgMHgwMSkp
IHsKLQkJCURSTV9FUlJPUigiQUdQIFByaW1pdGl2ZSBsaXN0IGVuZCBtaXNhbGlnbmVkLlxu
Iik7Ci0JCQlyZXQgPSAxOwotCQkJYnJlYWs7Ci0JCX0KLQl9Ci0JKmJ1ZmZlciA9IGJ1ZjsK
LQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgX19pbmxpbmVfXyB2ZXJpZmllcl9zdGF0ZV90
Ci12aWFfY2hlY2tfaGVhZGVyMih1aW50MzJfdCBjb25zdCAqKmJ1ZmZlciwgY29uc3QgdWlu
dDMyX3QgKmJ1Zl9lbmQsCi0JCSAgZHJtX3ZpYV9zdGF0ZV90ICpoY19zdGF0ZSkKLXsKLQl1
aW50MzJfdCBjbWQ7Ci0JaW50IGh6X21vZGU7Ci0JaGF6YXJkX3QgaHo7Ci0JY29uc3QgdWlu
dDMyX3QgKmJ1ZiA9ICpidWZmZXI7Ci0JY29uc3QgaGF6YXJkX3QgKmh6X3RhYmxlOwotCi0J
aWYgKChidWZfZW5kIC0gYnVmKSA8IDIpIHsKLQkJRFJNX0VSUk9SCi0JCSAgICAoIklsbGVn
YWwgdGVybWluYXRpb24gb2YgRE1BIEhBTENZT05fSEVBREVSMiBzZXF1ZW5jZS5cbiIpOwot
CQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0JfQotCWJ1ZisrOwotCWNtZCA9ICgqYnVmKysgJiAw
eEZGRkYwMDAwKSA+PiAxNjsKLQotCXN3aXRjaCAoY21kKSB7Ci0JY2FzZSBIQ19QYXJhVHlw
ZV9DbWRWZGF0YToKLQkJaWYgKHZpYV9jaGVja19wcmltX2xpc3QoJmJ1ZiwgYnVmX2VuZCwg
aGNfc3RhdGUpKQotCQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCQkqYnVmZmVyID0gYnVmOwot
CQlyZXR1cm4gc3RhdGVfY29tbWFuZDsKLQljYXNlIEhDX1BhcmFUeXBlX05vdFRleDoKLQkJ
aHpfdGFibGUgPSB0YWJsZTE7Ci0JCWJyZWFrOwotCWNhc2UgSENfUGFyYVR5cGVfVGV4Ogot
CQloY19zdGF0ZS0+dGV4dHVyZSA9IDA7Ci0JCWh6X3RhYmxlID0gdGFibGUyOwotCQlicmVh
azsKLQljYXNlIChIQ19QYXJhVHlwZV9UZXggfCAoSENfU3ViVHlwZV9UZXgxIDw8IDgpKToK
LQkJaGNfc3RhdGUtPnRleHR1cmUgPSAxOwotCQloel90YWJsZSA9IHRhYmxlMjsKLQkJYnJl
YWs7Ci0JY2FzZSAoSENfUGFyYVR5cGVfVGV4IHwgKEhDX1N1YlR5cGVfVGV4R2VuZXJhbCA8
PCA4KSk6Ci0JCWh6X3RhYmxlID0gdGFibGUzOwotCQlicmVhazsKLQljYXNlIEhDX1BhcmFU
eXBlX0F1dG86Ci0JCWlmIChlYXRfd29yZHMoJmJ1ZiwgYnVmX2VuZCwgMikpCi0JCQlyZXR1
cm4gc3RhdGVfZXJyb3I7Ci0JCSpidWZmZXIgPSBidWY7Ci0JCXJldHVybiBzdGF0ZV9jb21t
YW5kOwotCWNhc2UgKEhDX1BhcmFUeXBlX1BhbGV0dGUgfCAoSENfU3ViVHlwZV9TdGlwcGxl
IDw8IDgpKToKLQkJaWYgKGVhdF93b3JkcygmYnVmLCBidWZfZW5kLCAzMikpCi0JCQlyZXR1
cm4gc3RhdGVfZXJyb3I7Ci0JCSpidWZmZXIgPSBidWY7Ci0JCXJldHVybiBzdGF0ZV9jb21t
YW5kOwotCWNhc2UgKEhDX1BhcmFUeXBlX1BhbGV0dGUgfCAoSENfU3ViVHlwZV9UZXhQYWxl
dHRlMCA8PCA4KSk6Ci0JY2FzZSAoSENfUGFyYVR5cGVfUGFsZXR0ZSB8IChIQ19TdWJUeXBl
X1RleFBhbGV0dGUxIDw8IDgpKToKLQkJRFJNX0VSUk9SKCJUZXh0dXJlIHBhbGV0dGVzIGFy
ZSByZWplY3RlZCBiZWNhdXNlIG9mICIKLQkJCSAgImxhY2sgb2YgaW5mbyBob3cgdG8gZGV0
ZXJtaW5lIHRoZWlyIHNpemUuXG4iKTsKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCWNhc2Ug
KEhDX1BhcmFUeXBlX1BhbGV0dGUgfCAoSENfU3ViVHlwZV9Gb2dUYWJsZSA8PCA4KSk6Ci0J
CURSTV9FUlJPUigiRm9nIGZhY3RvciBwYWxldHRlcyBhcmUgcmVqZWN0ZWQgYmVjYXVzZSBv
ZiAiCi0JCQkgICJsYWNrIG9mIGluZm8gaG93IHRvIGRldGVybWluZSB0aGVpciBzaXplLlxu
Iik7Ci0JCXJldHVybiBzdGF0ZV9lcnJvcjsKLQlkZWZhdWx0OgotCi0JCS8qCi0JCSAqIFRo
ZXJlIGFyZSBzb21lIHVuaW1wbGVtZW50ZWQgSENfUGFyYVR5cGVzIGhlcmUsIHRoYXQKLQkJ
ICogbmVlZCB0byBiZSBpbXBsZW1lbnRlZCBpZiB0aGUgTWVzYSBkcml2ZXIgaXMgZXh0ZW5k
ZWQuCi0JCSAqLwotCi0JCURSTV9FUlJPUigiSW52YWxpZCBvciB1bmltcGxlbWVudGVkIEhB
TENZT05fSEVBREVSMiAiCi0JCQkgICJETUEgc3ViY29tbWFuZDogMHgleC4gUHJldmlvdXMg
ZHdvcmQ6IDB4JXhcbiIsCi0JCQkgIGNtZCwgKihidWYgLSAyKSk7Ci0JCSpidWZmZXIgPSBi
dWY7Ci0JCXJldHVybiBzdGF0ZV9lcnJvcjsKLQl9Ci0KLQl3aGlsZSAoYnVmIDwgYnVmX2Vu
ZCkgewotCQljbWQgPSAqYnVmKys7Ci0JCWlmICgoaHogPSBoel90YWJsZVtjbWQgPj4gMjRd
KSkgewotCQkJaWYgKChoel9tb2RlID0gaW52ZXN0aWdhdGVfaGF6YXJkKGNtZCwgaHosIGhj
X3N0YXRlKSkpIHsKLQkJCQlpZiAoaHpfbW9kZSA9PSAxKSB7Ci0JCQkJCWJ1Zi0tOwotCQkJ
CQlicmVhazsKLQkJCQl9Ci0JCQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCQkJfQotCQl9IGVs
c2UgaWYgKGhjX3N0YXRlLT51bmZpbmlzaGVkICYmCi0JCQkgICBmaW5pc2hfY3VycmVudF9z
ZXF1ZW5jZShoY19zdGF0ZSkpIHsKLQkJCXJldHVybiBzdGF0ZV9lcnJvcjsKLQkJfQotCX0K
LQlpZiAoaGNfc3RhdGUtPnVuZmluaXNoZWQgJiYgZmluaXNoX2N1cnJlbnRfc2VxdWVuY2Uo
aGNfc3RhdGUpKQotCQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0JKmJ1ZmZlciA9IGJ1ZjsKLQly
ZXR1cm4gc3RhdGVfY29tbWFuZDsKLX0KLQotc3RhdGljIF9faW5saW5lX18gdmVyaWZpZXJf
c3RhdGVfdAotdmlhX3BhcnNlX2hlYWRlcjIoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2
LCB1aW50MzJfdCBjb25zdCAqKmJ1ZmZlciwKLQkJICBjb25zdCB1aW50MzJfdCAqYnVmX2Vu
ZCwgaW50ICpmaXJlX2NvdW50KQotewotCXVpbnQzMl90IGNtZDsKLQljb25zdCB1aW50MzJf
dCAqYnVmID0gKmJ1ZmZlcjsKLQljb25zdCB1aW50MzJfdCAqbmV4dF9maXJlOwotCWludCBi
dXJzdCA9IDA7Ci0KLQluZXh0X2ZpcmUgPSBkZXZfcHJpdi0+ZmlyZV9vZmZzZXRzWypmaXJl
X2NvdW50XTsKLQlidWYrKzsKLQljbWQgPSAoKmJ1ZiAmIDB4RkZGRjAwMDApID4+IDE2Owot
CXZpYV93cml0ZShkZXZfcHJpdiwgSENfUkVHX1RSQU5TX1NFVCArIEhDX1JFR19CQVNFLCAq
YnVmKyspOwotCXN3aXRjaCAoY21kKSB7Ci0JY2FzZSBIQ19QYXJhVHlwZV9DbWRWZGF0YToK
LQkJd2hpbGUgKChidWYgPCBidWZfZW5kKSAmJgotCQkgICAgICAgKCpmaXJlX2NvdW50IDwg
ZGV2X3ByaXYtPm51bV9maXJlX29mZnNldHMpICYmCi0JCSAgICAgICAoKmJ1ZiAmIEhDX0FD
TURfTUFTSykgPT0gSENfQUNNRF9IQ21kQikgewotCQkJd2hpbGUgKGJ1ZiA8PSBuZXh0X2Zp
cmUpIHsKLQkJCQl2aWFfd3JpdGUoZGV2X3ByaXYsIEhDX1JFR19UUkFOU19TUEFDRSArIEhD
X1JFR19CQVNFICsKLQkJCQkJICAoYnVyc3QgJiA2MyksICpidWYrKyk7Ci0JCQkJYnVyc3Qg
Kz0gNDsKLQkJCX0KLQkJCWlmICgoYnVmIDwgYnVmX2VuZCkKLQkJCSAgICAmJiAoKCpidWYg
JiBIQUxDWU9OX0ZJUkVNQVNLKSA9PSBIQUxDWU9OX0ZJUkVDTUQpKQotCQkJCWJ1ZisrOwot
Ci0JCQlpZiAoKysoKmZpcmVfY291bnQpIDwgZGV2X3ByaXYtPm51bV9maXJlX29mZnNldHMp
Ci0JCQkJbmV4dF9maXJlID0gZGV2X3ByaXYtPmZpcmVfb2Zmc2V0c1sqZmlyZV9jb3VudF07
Ci0JCX0KLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJd2hpbGUgKGJ1ZiA8IGJ1Zl9lbmQpIHsK
LQotCQkJaWYgKCpidWYgPT0gSENfSEVBREVSMiB8fAotCQkJICAgICgqYnVmICYgSEFMQ1lP
Tl9IRUFERVIxTUFTSykgPT0gSEFMQ1lPTl9IRUFERVIxIHx8Ci0JCQkgICAgKCpidWYgJiBW
SUFfVklERU9NQVNLKSA9PSBWSUFfVklERU9fSEVBREVSNSB8fAotCQkJICAgICgqYnVmICYg
VklBX1ZJREVPTUFTSykgPT0gVklBX1ZJREVPX0hFQURFUjYpCi0JCQkJYnJlYWs7Ci0KLQkJ
CXZpYV93cml0ZShkZXZfcHJpdiwgSENfUkVHX1RSQU5TX1NQQUNFICsgSENfUkVHX0JBU0Ug
KwotCQkJCSAgKGJ1cnN0ICYgNjMpLCAqYnVmKyspOwotCQkJYnVyc3QgKz0gNDsKLQkJfQot
CX0KLQkqYnVmZmVyID0gYnVmOwotCXJldHVybiBzdGF0ZV9jb21tYW5kOwotfQotCi1zdGF0
aWMgX19pbmxpbmVfXyBpbnQgdmVyaWZ5X21taW9fYWRkcmVzcyh1aW50MzJfdCBhZGRyZXNz
KQotewotCWlmICgoYWRkcmVzcyA+IDB4M0ZGKSAmJiAoYWRkcmVzcyA8IDB4QzAwKSkgewot
CQlEUk1fRVJST1IoIkludmFsaWQgVklERU8gRE1BIGNvbW1hbmQuICIKLQkJCSAgIkF0dGVt
cHQgdG8gYWNjZXNzIDNELSBvciBjb21tYW5kIGJ1cnN0IGFyZWEuXG4iKTsKLQkJcmV0dXJu
IDE7Ci0JfSBlbHNlIGlmICgoYWRkcmVzcyA+IDB4Q0ZGKSAmJiAoYWRkcmVzcyA8IDB4MTMw
MCkpIHsKLQkJRFJNX0VSUk9SKCJJbnZhbGlkIFZJREVPIERNQSBjb21tYW5kLiAiCi0JCQkg
ICJBdHRlbXB0IHRvIGFjY2VzcyBQQ0kgRE1BIGFyZWEuXG4iKTsKLQkJcmV0dXJuIDE7Ci0J
fSBlbHNlIGlmIChhZGRyZXNzID4gMHgxM0ZGKSB7Ci0JCURSTV9FUlJPUigiSW52YWxpZCBW
SURFTyBETUEgY29tbWFuZC4gIgotCQkJICAiQXR0ZW1wdCB0byBhY2Nlc3MgVkdBIHJlZ2lz
dGVycy5cbiIpOwotCQlyZXR1cm4gMTsKLQl9Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBf
X2lubGluZV9fIGludAotdmVyaWZ5X3ZpZGVvX3RhaWwodWludDMyX3QgY29uc3QgKipidWZm
ZXIsIGNvbnN0IHVpbnQzMl90ICogYnVmX2VuZCwKLQkJICB1aW50MzJfdCBkd29yZHMpCi17
Ci0JY29uc3QgdWludDMyX3QgKmJ1ZiA9ICpidWZmZXI7Ci0KLQlpZiAoYnVmX2VuZCAtIGJ1
ZiA8IGR3b3JkcykgewotCQlEUk1fRVJST1IoIklsbGVnYWwgdGVybWluYXRpb24gb2Ygdmlk
ZW8gY29tbWFuZC5cbiIpOwotCQlyZXR1cm4gMTsKLQl9Ci0Jd2hpbGUgKGR3b3Jkcy0tKSB7
Ci0JCWlmICgqYnVmKyspIHsKLQkJCURSTV9FUlJPUigiSWxsZWdhbCB2aWRlbyBjb21tYW5k
IHRhaWwuXG4iKTsKLQkJCXJldHVybiAxOwotCQl9Ci0JfQotCSpidWZmZXIgPSBidWY7Ci0J
cmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBfX2lubGluZV9fIHZlcmlmaWVyX3N0YXRlX3QKLXZp
YV9jaGVja19oZWFkZXIxKHVpbnQzMl90IGNvbnN0ICoqYnVmZmVyLCBjb25zdCB1aW50MzJf
dCAqIGJ1Zl9lbmQpCi17Ci0JdWludDMyX3QgY21kOwotCWNvbnN0IHVpbnQzMl90ICpidWYg
PSAqYnVmZmVyOwotCXZlcmlmaWVyX3N0YXRlX3QgcmV0ID0gc3RhdGVfY29tbWFuZDsKLQot
CXdoaWxlIChidWYgPCBidWZfZW5kKSB7Ci0JCWNtZCA9ICpidWY7Ci0JCWlmICgoY21kID4g
KCgweDNGRiA+PiAyKSB8IEhBTENZT05fSEVBREVSMSkpICYmCi0JCSAgICAoY21kIDwgKCgw
eEMwMCA+PiAyKSB8IEhBTENZT05fSEVBREVSMSkpKSB7Ci0JCQlpZiAoKGNtZCAmIEhBTENZ
T05fSEVBREVSMU1BU0spICE9IEhBTENZT05fSEVBREVSMSkKLQkJCQlicmVhazsKLQkJCURS
TV9FUlJPUigiSW52YWxpZCBIQUxDWU9OX0hFQURFUjEgY29tbWFuZC4gIgotCQkJCSAgIkF0
dGVtcHQgdG8gYWNjZXNzIDNELSBvciBjb21tYW5kIGJ1cnN0IGFyZWEuXG4iKTsKLQkJCXJl
dCA9IHN0YXRlX2Vycm9yOwotCQkJYnJlYWs7Ci0JCX0gZWxzZSBpZiAoY21kID4gKCgweENG
RiA+PiAyKSB8IEhBTENZT05fSEVBREVSMSkpIHsKLQkJCWlmICgoY21kICYgSEFMQ1lPTl9I
RUFERVIxTUFTSykgIT0gSEFMQ1lPTl9IRUFERVIxKQotCQkJCWJyZWFrOwotCQkJRFJNX0VS
Uk9SKCJJbnZhbGlkIEhBTENZT05fSEVBREVSMSBjb21tYW5kLiAiCi0JCQkJICAiQXR0ZW1w
dCB0byBhY2Nlc3MgVkdBIHJlZ2lzdGVycy5cbiIpOwotCQkJcmV0ID0gc3RhdGVfZXJyb3I7
Ci0JCQlicmVhazsKLQkJfSBlbHNlIHsKLQkJCWJ1ZiArPSAyOwotCQl9Ci0JfQotCSpidWZm
ZXIgPSBidWY7Ci0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIF9faW5saW5lX18gdmVyaWZp
ZXJfc3RhdGVfdAotdmlhX3BhcnNlX2hlYWRlcjEoZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9w
cml2LCB1aW50MzJfdCBjb25zdCAqKmJ1ZmZlciwKLQkJICBjb25zdCB1aW50MzJfdCAqYnVm
X2VuZCkKLXsKLQlyZWdpc3RlciB1aW50MzJfdCBjbWQ7Ci0JY29uc3QgdWludDMyX3QgKmJ1
ZiA9ICpidWZmZXI7Ci0KLQl3aGlsZSAoYnVmIDwgYnVmX2VuZCkgewotCQljbWQgPSAqYnVm
OwotCQlpZiAoKGNtZCAmIEhBTENZT05fSEVBREVSMU1BU0spICE9IEhBTENZT05fSEVBREVS
MSkKLQkJCWJyZWFrOwotCQl2aWFfd3JpdGUoZGV2X3ByaXYsIChjbWQgJiB+SEFMQ1lPTl9I
RUFERVIxTUFTSykgPDwgMiwgKisrYnVmKTsKLQkJYnVmKys7Ci0JfQotCSpidWZmZXIgPSBi
dWY7Ci0JcmV0dXJuIHN0YXRlX2NvbW1hbmQ7Ci19Ci0KLXN0YXRpYyBfX2lubGluZV9fIHZl
cmlmaWVyX3N0YXRlX3QKLXZpYV9jaGVja192aGVhZGVyNSh1aW50MzJfdCBjb25zdCAqKmJ1
ZmZlciwgY29uc3QgdWludDMyX3QgKmJ1Zl9lbmQpCi17Ci0JdWludDMyX3QgZGF0YTsKLQlj
b25zdCB1aW50MzJfdCAqYnVmID0gKmJ1ZmZlcjsKLQotCWlmIChidWZfZW5kIC0gYnVmIDwg
NCkgewotCQlEUk1fRVJST1IoIklsbGVnYWwgdGVybWluYXRpb24gb2YgdmlkZW8gaGVhZGVy
NSBjb21tYW5kXG4iKTsKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCX0KLQotCWRhdGEgPSAq
YnVmKysgJiB+VklBX1ZJREVPTUFTSzsKLQlpZiAodmVyaWZ5X21taW9fYWRkcmVzcyhkYXRh
KSkKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCi0JZGF0YSA9ICpidWYrKzsKLQlpZiAoKmJ1
ZisrICE9IDB4MDBGNTAwMDApIHsKLQkJRFJNX0VSUk9SKCJJbGxlZ2FsIGhlYWRlcjUgaGVh
ZGVyIGRhdGFcbiIpOwotCQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0JfQotCWlmICgqYnVmKysg
IT0gMHgwMDAwMDAwMCkgewotCQlEUk1fRVJST1IoIklsbGVnYWwgaGVhZGVyNSBoZWFkZXIg
ZGF0YVxuIik7Ci0JCXJldHVybiBzdGF0ZV9lcnJvcjsKLQl9Ci0JaWYgKGVhdF93b3Jkcygm
YnVmLCBidWZfZW5kLCBkYXRhKSkKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCWlmICgoZGF0
YSAmIDMpICYmIHZlcmlmeV92aWRlb190YWlsKCZidWYsIGJ1Zl9lbmQsIDQgLSAoZGF0YSAm
IDMpKSkKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCSpidWZmZXIgPSBidWY7Ci0JcmV0dXJu
IHN0YXRlX2NvbW1hbmQ7Ci0KLX0KLQotc3RhdGljIF9faW5saW5lX18gdmVyaWZpZXJfc3Rh
dGVfdAotdmlhX3BhcnNlX3ZoZWFkZXI1KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiwg
dWludDMyX3QgY29uc3QgKipidWZmZXIsCi0JCSAgIGNvbnN0IHVpbnQzMl90ICpidWZfZW5k
KQotewotCXVpbnQzMl90IGFkZHIsIGNvdW50LCBpOwotCWNvbnN0IHVpbnQzMl90ICpidWYg
PSAqYnVmZmVyOwotCi0JYWRkciA9ICpidWYrKyAmIH5WSUFfVklERU9NQVNLOwotCWkgPSBj
b3VudCA9ICpidWY7Ci0JYnVmICs9IDM7Ci0Jd2hpbGUgKGktLSkKLQkJdmlhX3dyaXRlKGRl
dl9wcml2LCBhZGRyLCAqYnVmKyspOwotCWlmIChjb3VudCAmIDMpCi0JCWJ1ZiArPSA0IC0g
KGNvdW50ICYgMyk7Ci0JKmJ1ZmZlciA9IGJ1ZjsKLQlyZXR1cm4gc3RhdGVfY29tbWFuZDsK
LX0KLQotc3RhdGljIF9faW5saW5lX18gdmVyaWZpZXJfc3RhdGVfdAotdmlhX2NoZWNrX3Zo
ZWFkZXI2KHVpbnQzMl90IGNvbnN0ICoqYnVmZmVyLCBjb25zdCB1aW50MzJfdCAqIGJ1Zl9l
bmQpCi17Ci0JdWludDMyX3QgZGF0YTsKLQljb25zdCB1aW50MzJfdCAqYnVmID0gKmJ1ZmZl
cjsKLQl1aW50MzJfdCBpOwotCi0JaWYgKGJ1Zl9lbmQgLSBidWYgPCA0KSB7Ci0JCURSTV9F
UlJPUigiSWxsZWdhbCB0ZXJtaW5hdGlvbiBvZiB2aWRlbyBoZWFkZXI2IGNvbW1hbmRcbiIp
OwotCQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0JfQotCWJ1ZisrOwotCWRhdGEgPSAqYnVmKys7
Ci0JaWYgKCpidWYrKyAhPSAweDAwRjYwMDAwKSB7Ci0JCURSTV9FUlJPUigiSWxsZWdhbCBo
ZWFkZXI2IGhlYWRlciBkYXRhXG4iKTsKLQkJcmV0dXJuIHN0YXRlX2Vycm9yOwotCX0KLQlp
ZiAoKmJ1ZisrICE9IDB4MDAwMDAwMDApIHsKLQkJRFJNX0VSUk9SKCJJbGxlZ2FsIGhlYWRl
cjYgaGVhZGVyIGRhdGFcbiIpOwotCQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0JfQotCWlmICgo
YnVmX2VuZCAtIGJ1ZikgPCAoZGF0YSA8PCAxKSkgewotCQlEUk1fRVJST1IoIklsbGVnYWwg
dGVybWluYXRpb24gb2YgdmlkZW8gaGVhZGVyNiBjb21tYW5kXG4iKTsKLQkJcmV0dXJuIHN0
YXRlX2Vycm9yOwotCX0KLQlmb3IgKGkgPSAwOyBpIDwgZGF0YTsgKytpKSB7Ci0JCWlmICh2
ZXJpZnlfbW1pb19hZGRyZXNzKCpidWYrKykpCi0JCQlyZXR1cm4gc3RhdGVfZXJyb3I7Ci0J
CWJ1ZisrOwotCX0KLQlkYXRhIDw8PSAxOwotCWlmICgoZGF0YSAmIDMpICYmIHZlcmlmeV92
aWRlb190YWlsKCZidWYsIGJ1Zl9lbmQsIDQgLSAoZGF0YSAmIDMpKSkKLQkJcmV0dXJuIHN0
YXRlX2Vycm9yOwotCSpidWZmZXIgPSBidWY7Ci0JcmV0dXJuIHN0YXRlX2NvbW1hbmQ7Ci19
Ci0KLXN0YXRpYyBfX2lubGluZV9fIHZlcmlmaWVyX3N0YXRlX3QKLXZpYV9wYXJzZV92aGVh
ZGVyNihkcm1fdmlhX3ByaXZhdGVfdCAqZGV2X3ByaXYsIHVpbnQzMl90IGNvbnN0ICoqYnVm
ZmVyLAotCQkgICBjb25zdCB1aW50MzJfdCAqYnVmX2VuZCkKLXsKLQotCXVpbnQzMl90IGFk
ZHIsIGNvdW50LCBpOwotCWNvbnN0IHVpbnQzMl90ICpidWYgPSAqYnVmZmVyOwotCi0JaSA9
IGNvdW50ID0gKisrYnVmOwotCWJ1ZiArPSAzOwotCXdoaWxlIChpLS0pIHsKLQkJYWRkciA9
ICpidWYrKzsKLQkJdmlhX3dyaXRlKGRldl9wcml2LCBhZGRyLCAqYnVmKyspOwotCX0KLQlj
b3VudCA8PD0gMTsKLQlpZiAoY291bnQgJiAzKQotCQlidWYgKz0gNCAtIChjb3VudCAmIDMp
OwotCSpidWZmZXIgPSBidWY7Ci0JcmV0dXJuIHN0YXRlX2NvbW1hbmQ7Ci19Ci0KLWludAot
dmlhX3ZlcmlmeV9jb21tYW5kX3N0cmVhbShjb25zdCB1aW50MzJfdCAqIGJ1ZiwgdW5zaWdu
ZWQgaW50IHNpemUsCi0JCQkgIHN0cnVjdCBkcm1fZGV2aWNlICogZGV2LCBpbnQgYWdwKQot
ewotCi0JZHJtX3ZpYV9wcml2YXRlX3QgKmRldl9wcml2ID0gKGRybV92aWFfcHJpdmF0ZV90
ICopIGRldi0+ZGV2X3ByaXZhdGU7Ci0JZHJtX3ZpYV9zdGF0ZV90ICpoY19zdGF0ZSA9ICZk
ZXZfcHJpdi0+aGNfc3RhdGU7Ci0JZHJtX3ZpYV9zdGF0ZV90IHNhdmVkX3N0YXRlID0gKmhj
X3N0YXRlOwotCXVpbnQzMl90IGNtZDsKLQljb25zdCB1aW50MzJfdCAqYnVmX2VuZCA9IGJ1
ZiArIChzaXplID4+IDIpOwotCXZlcmlmaWVyX3N0YXRlX3Qgc3RhdGUgPSBzdGF0ZV9jb21t
YW5kOwotCWludCBjbWVfdmlkZW87Ci0JaW50IHN1cHBvcnRlZF8zZDsKLQotCWNtZV92aWRl
byA9IChkZXZfcHJpdi0+Y2hpcHNldCA9PSBWSUFfUFJPX0dST1VQX0EgfHwKLQkJICAgICBk
ZXZfcHJpdi0+Y2hpcHNldCA9PSBWSUFfRFg5XzApOwotCi0Jc3VwcG9ydGVkXzNkID0gZGV2
X3ByaXYtPmNoaXBzZXQgIT0gVklBX0RYOV8wOwotCi0JaGNfc3RhdGUtPmRldiA9IGRldjsK
LQloY19zdGF0ZS0+dW5maW5pc2hlZCA9IG5vX3NlcXVlbmNlOwotCWhjX3N0YXRlLT5tYXBf
Y2FjaGUgPSBOVUxMOwotCWhjX3N0YXRlLT5hZ3AgPSBhZ3A7Ci0JaGNfc3RhdGUtPmJ1Zl9z
dGFydCA9IGJ1ZjsKLQlkZXZfcHJpdi0+bnVtX2ZpcmVfb2Zmc2V0cyA9IDA7Ci0KLQl3aGls
ZSAoYnVmIDwgYnVmX2VuZCkgewotCi0JCXN3aXRjaCAoc3RhdGUpIHsKLQkJY2FzZSBzdGF0
ZV9oZWFkZXIyOgotCQkJc3RhdGUgPSB2aWFfY2hlY2tfaGVhZGVyMigmYnVmLCBidWZfZW5k
LCBoY19zdGF0ZSk7Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV9oZWFkZXIxOgotCQkJc3Rh
dGUgPSB2aWFfY2hlY2tfaGVhZGVyMSgmYnVmLCBidWZfZW5kKTsKLQkJCWJyZWFrOwotCQlj
YXNlIHN0YXRlX3ZoZWFkZXI1OgotCQkJc3RhdGUgPSB2aWFfY2hlY2tfdmhlYWRlcjUoJmJ1
ZiwgYnVmX2VuZCk7Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV92aGVhZGVyNjoKLQkJCXN0
YXRlID0gdmlhX2NoZWNrX3ZoZWFkZXI2KCZidWYsIGJ1Zl9lbmQpOwotCQkJYnJlYWs7Ci0J
CWNhc2Ugc3RhdGVfY29tbWFuZDoKLQkJCWNtZCA9ICpidWY7Ci0JCQlpZiAoKGNtZCA9PSBI
QUxDWU9OX0hFQURFUjIpICYmIHN1cHBvcnRlZF8zZCkKLQkJCQlzdGF0ZSA9IHN0YXRlX2hl
YWRlcjI7Ci0JCQllbHNlIGlmICgoY21kICYgSEFMQ1lPTl9IRUFERVIxTUFTSykgPT0gSEFM
Q1lPTl9IRUFERVIxKQotCQkJCXN0YXRlID0gc3RhdGVfaGVhZGVyMTsKLQkJCWVsc2UgaWYg
KGNtZV92aWRlbwotCQkJCSAmJiAoY21kICYgVklBX1ZJREVPTUFTSykgPT0gVklBX1ZJREVP
X0hFQURFUjUpCi0JCQkJc3RhdGUgPSBzdGF0ZV92aGVhZGVyNTsKLQkJCWVsc2UgaWYgKGNt
ZV92aWRlbwotCQkJCSAmJiAoY21kICYgVklBX1ZJREVPTUFTSykgPT0gVklBX1ZJREVPX0hF
QURFUjYpCi0JCQkJc3RhdGUgPSBzdGF0ZV92aGVhZGVyNjsKLQkJCWVsc2UgaWYgKChjbWQg
PT0gSEFMQ1lPTl9IRUFERVIyKSAmJiAhc3VwcG9ydGVkXzNkKSB7Ci0JCQkJRFJNX0VSUk9S
KCJBY2NlbGVyYXRlZCAzRCBpcyBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgY2hpcHNldCB5ZXQu
XG4iKTsKLQkJCQlzdGF0ZSA9IHN0YXRlX2Vycm9yOwotCQkJfSBlbHNlIHsKLQkJCQlEUk1f
RVJST1IKLQkJCQkgICAgKCJJbnZhbGlkIC8gVW5pbXBsZW1lbnRlZCBETUEgSEVBREVSIGNv
bW1hbmQuIDB4JXhcbiIsCi0JCQkJICAgICBjbWQpOwotCQkJCXN0YXRlID0gc3RhdGVfZXJy
b3I7Ci0JCQl9Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV9lcnJvcjoKLQkJZGVmYXVsdDoK
LQkJCSpoY19zdGF0ZSA9IHNhdmVkX3N0YXRlOwotCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCX0K
LQl9Ci0JaWYgKHN0YXRlID09IHN0YXRlX2Vycm9yKSB7Ci0JCSpoY19zdGF0ZSA9IHNhdmVk
X3N0YXRlOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0JcmV0dXJuIDA7Ci19Ci0KLWludAot
dmlhX3BhcnNlX2NvbW1hbmRfc3RyZWFtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGNvbnN0
IHVpbnQzMl90ICpidWYsCi0JCQkgdW5zaWduZWQgaW50IHNpemUpCi17Ci0KLQlkcm1fdmlh
X3ByaXZhdGVfdCAqZGV2X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKikgZGV2LT5kZXZf
cHJpdmF0ZTsKLQl1aW50MzJfdCBjbWQ7Ci0JY29uc3QgdWludDMyX3QgKmJ1Zl9lbmQgPSBi
dWYgKyAoc2l6ZSA+PiAyKTsKLQl2ZXJpZmllcl9zdGF0ZV90IHN0YXRlID0gc3RhdGVfY29t
bWFuZDsKLQlpbnQgZmlyZV9jb3VudCA9IDA7Ci0KLQl3aGlsZSAoYnVmIDwgYnVmX2VuZCkg
ewotCi0JCXN3aXRjaCAoc3RhdGUpIHsKLQkJY2FzZSBzdGF0ZV9oZWFkZXIyOgotCQkJc3Rh
dGUgPQotCQkJICAgIHZpYV9wYXJzZV9oZWFkZXIyKGRldl9wcml2LCAmYnVmLCBidWZfZW5k
LAotCQkJCQkgICAgICAmZmlyZV9jb3VudCk7Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV9o
ZWFkZXIxOgotCQkJc3RhdGUgPSB2aWFfcGFyc2VfaGVhZGVyMShkZXZfcHJpdiwgJmJ1Ziwg
YnVmX2VuZCk7Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV92aGVhZGVyNToKLQkJCXN0YXRl
ID0gdmlhX3BhcnNlX3ZoZWFkZXI1KGRldl9wcml2LCAmYnVmLCBidWZfZW5kKTsKLQkJCWJy
ZWFrOwotCQljYXNlIHN0YXRlX3ZoZWFkZXI2OgotCQkJc3RhdGUgPSB2aWFfcGFyc2Vfdmhl
YWRlcjYoZGV2X3ByaXYsICZidWYsIGJ1Zl9lbmQpOwotCQkJYnJlYWs7Ci0JCWNhc2Ugc3Rh
dGVfY29tbWFuZDoKLQkJCWNtZCA9ICpidWY7Ci0JCQlpZiAoY21kID09IEhBTENZT05fSEVB
REVSMikKLQkJCQlzdGF0ZSA9IHN0YXRlX2hlYWRlcjI7Ci0JCQllbHNlIGlmICgoY21kICYg
SEFMQ1lPTl9IRUFERVIxTUFTSykgPT0gSEFMQ1lPTl9IRUFERVIxKQotCQkJCXN0YXRlID0g
c3RhdGVfaGVhZGVyMTsKLQkJCWVsc2UgaWYgKChjbWQgJiBWSUFfVklERU9NQVNLKSA9PSBW
SUFfVklERU9fSEVBREVSNSkKLQkJCQlzdGF0ZSA9IHN0YXRlX3ZoZWFkZXI1OwotCQkJZWxz
ZSBpZiAoKGNtZCAmIFZJQV9WSURFT01BU0spID09IFZJQV9WSURFT19IRUFERVI2KQotCQkJ
CXN0YXRlID0gc3RhdGVfdmhlYWRlcjY7Ci0JCQllbHNlIHsKLQkJCQlEUk1fRVJST1IKLQkJ
CQkgICAgKCJJbnZhbGlkIC8gVW5pbXBsZW1lbnRlZCBETUEgSEVBREVSIGNvbW1hbmQuIDB4
JXhcbiIsCi0JCQkJICAgICBjbWQpOwotCQkJCXN0YXRlID0gc3RhdGVfZXJyb3I7Ci0JCQl9
Ci0JCQlicmVhazsKLQkJY2FzZSBzdGF0ZV9lcnJvcjoKLQkJZGVmYXVsdDoKLQkJCXJldHVy
biAtRUlOVkFMOwotCQl9Ci0JfQotCWlmIChzdGF0ZSA9PSBzdGF0ZV9lcnJvcikKLQkJcmV0
dXJuIC1FSU5WQUw7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkCi1zZXR1cF9oYXph
cmRfdGFibGUoaHpfaW5pdF90IGluaXRfdGFibGVbXSwgaGF6YXJkX3QgdGFibGVbXSwgaW50
IHNpemUpCi17Ci0JaW50IGk7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgMjU2OyArK2kpCi0JCXRh
YmxlW2ldID0gZm9yYmlkZGVuX2NvbW1hbmQ7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgc2l6ZTsg
KytpKQotCQl0YWJsZVtpbml0X3RhYmxlW2ldLmNvZGVdID0gaW5pdF90YWJsZVtpXS5oejsK
LX0KLQotdm9pZCB2aWFfaW5pdF9jb21tYW5kX3ZlcmlmaWVyKHZvaWQpCi17Ci0Jc2V0dXBf
aGF6YXJkX3RhYmxlKGluaXRfdGFibGUxLCB0YWJsZTEsIEFSUkFZX1NJWkUoaW5pdF90YWJs
ZTEpKTsKLQlzZXR1cF9oYXphcmRfdGFibGUoaW5pdF90YWJsZTIsIHRhYmxlMiwgQVJSQVlf
U0laRShpbml0X3RhYmxlMikpOwotCXNldHVwX2hhemFyZF90YWJsZShpbml0X3RhYmxlMywg
dGFibGUzLCBBUlJBWV9TSVpFKGluaXRfdGFibGUzKSk7Ci19CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vdmlhL3ZpYV92ZXJpZmllci5oIGIvZHJpdmVycy9ncHUvZHJtL3ZpYS92
aWFfdmVyaWZpZXIuaApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMjZiNmQzNjFh
Yjk1Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfdmVyaWZp
ZXIuaAorKysgL2Rldi9udWxsCkBAIC0xLDYyICswLDAgQEAKLS8qCi0gKiBDb3B5cmlnaHQg
MjAwNCBUaGUgVW5pY2hyb21lIFByb2plY3QuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi0gKgot
ICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFu
eSBwZXJzb24gb2J0YWluaW5nIGEKLSAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNz
b2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCi0gKiB0byBk
ZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0
aG91dCBsaW1pdGF0aW9uCi0gKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBt
ZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3ViIGxpY2Vuc2UsCi0gKiBhbmQvb3Igc2Vs
bCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hv
bSB0aGUKLSAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0
aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBu
b3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUKLSAqIG5l
eHQgcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0
YW50aWFsIHBvcnRpb25zCi0gKiBvZiB0aGUgU29mdHdhcmUuCi0gKgotICogVEhFIFNPRlRX
QVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQs
IEVYUFJFU1MgT1IKLSAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8g
VEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAotICogRklUTkVTUyBGT1IgQSBQ
QVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTi1JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNI
QUxMCi0gKiBUSEUgVU5JQ0hST01FIFBST0pFQ1QsIEFORC9PUiBJVFMgU1VQUExJRVJTIEJF
IExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCi0gKiBPVEhFUiBMSUFCSUxJVFks
IFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwK
LSAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09G
VFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUgotICogREVBTElOR1MgSU4gVEhFIFNPRlRXQVJF
LgotICoKLSAqIEF1dGhvcjogVGhvbWFzIEhlbGxzdHLDtm0gMjAwNC4KLSAqLwotCi0jaWZu
ZGVmIF9WSUFfVkVSSUZJRVJfSF8KLSNkZWZpbmUgX1ZJQV9WRVJJRklFUl9IXwotCi10eXBl
ZGVmIGVudW0gewotCW5vX3NlcXVlbmNlID0gMCwKLQl6X2FkZHJlc3MsCi0JZGVzdF9hZGRy
ZXNzLAotCXRleF9hZGRyZXNzCi19IGRybV92aWFfc2VxdWVuY2VfdDsKLQotdHlwZWRlZiBz
dHJ1Y3QgewotCXVuc2lnbmVkIHRleHR1cmU7Ci0JdWludDMyX3Qgel9hZGRyOwotCXVpbnQz
Ml90IGRfYWRkcjsKLQl1aW50MzJfdCB0X2FkZHJbMl1bMTBdOwotCXVpbnQzMl90IHBpdGNo
WzJdWzEwXTsKLQl1aW50MzJfdCBoZWlnaHRbMl1bMTBdOwotCXVpbnQzMl90IHRleF9sZXZl
bF9sb1syXTsKLQl1aW50MzJfdCB0ZXhfbGV2ZWxfaGlbMl07Ci0JdWludDMyX3QgdGV4X3Bh
bGV0dGVfc2l6ZVsyXTsKLQl1aW50MzJfdCB0ZXhfbnBvdFsyXTsKLQlkcm1fdmlhX3NlcXVl
bmNlX3QgdW5maW5pc2hlZDsKLQlpbnQgYWdwX3RleHR1cmU7Ci0JaW50IG11bHRpdGV4Owot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXY7Ci0JZHJtX2xvY2FsX21hcF90ICptYXBfY2FjaGU7
Ci0JdWludDMyX3QgdmVydGV4X2NvdW50OwotCWludCBhZ3A7Ci0JY29uc3QgdWludDMyX3Qg
KmJ1Zl9zdGFydDsKLX0gZHJtX3ZpYV9zdGF0ZV90OwotCi1leHRlcm4gaW50IHZpYV92ZXJp
ZnlfY29tbWFuZF9zdHJlYW0oY29uc3QgdWludDMyX3QgKmJ1ZiwgdW5zaWduZWQgaW50IHNp
emUsCi0JCQkJICAgICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgYWdwKTsKLWV4dGVy
biBpbnQgdmlhX3BhcnNlX2NvbW1hbmRfc3RyZWFtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IGNvbnN0IHVpbnQzMl90ICpidWYsCi0JCQkJICAgIHVuc2lnbmVkIGludCBzaXplKTsKLQot
I2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV92aWRlby5jIGIv
ZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfdmlkZW8uYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggNTNiMWY1OGY5OWI0Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3ZpYS92aWFfdmlkZW8uYworKysgL2Rldi9udWxsCkBAIC0xLDk0ICswLDAgQEAKLS8q
Ci0gKiBDb3B5cmlnaHQgMjAwNSBUaG9tYXMgSGVsbHN0cm9tLiBBbGwgUmlnaHRzIFJlc2Vy
dmVkLgotICoKLSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hh
cmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9mIHRoaXMgc29mdHdh
cmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIp
LAotICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5j
bHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgotICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHks
IG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YiBsaWNlbnNlLAotICog
YW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJz
b25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1
YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAqIFRoZSBhYm92ZSBj
b3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcg
dGhlCi0gKiBuZXh0IHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGll
cyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucwotICogb2YgdGhlIFNvZnR3YXJlLgotICoKLSAq
IFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9G
IEFOWSBLSU5ELCBFWFBSRVNTIE9SCi0gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBM
SU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKLSAqIEZJVE5F
U1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT04tSU5GUklOR0VNRU5ULiBJTiBO
TyBFVkVOVCBTSEFMTAotICogVEhFIEFVVEhPUihTKSwgQU5EL09SIFRIRSBDT1BZUklHSFQg
SE9MREVSKFMpIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCi0gKiBPVEhF
UiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9S
IE9USEVSV0lTRSwKLSAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04g
V0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUgotICogREVBTElOR1MgSU4g
VEhFIFNPRlRXQVJFLgotICoKLSAqIEF1dGhvcjogVGhvbWFzIEhlbGxzdHJvbSAyMDA1Lgot
ICoKLSAqIFZpZGVvIGFuZCBYdk1DIHJlbGF0ZWQgZnVuY3Rpb25zLgotICovCi0KLSNpbmNs
dWRlIDxkcm0vZHJtX2RldmljZS5oPgotI2luY2x1ZGUgPGRybS92aWFfZHJtLmg+Ci0KLSNp
bmNsdWRlICJ2aWFfZHJ2LmgiCi0KLXZvaWQgdmlhX2luaXRfZnV0ZXgoZHJtX3ZpYV9wcml2
YXRlX3QgKmRldl9wcml2KQotewotCXVuc2lnbmVkIGludCBpOwotCi0JRFJNX0RFQlVHKCJc
biIpOwotCi0JZm9yIChpID0gMDsgaSA8IFZJQV9OUl9YVk1DX0xPQ0tTOyArK2kpIHsKLQkJ
aW5pdF93YWl0cXVldWVfaGVhZCgmKGRldl9wcml2LT5kZWNvZGVyX3F1ZXVlW2ldKSk7Ci0J
CVhWTUNMT0NLUFRSKGRldl9wcml2LT5zYXJlYV9wcml2LCBpKS0+bG9jayA9IDA7Ci0JfQot
fQotCi12b2lkIHZpYV9jbGVhbnVwX2Z1dGV4KGRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJp
dikKLXsKLX0KLQotdm9pZCB2aWFfcmVsZWFzZV9mdXRleChkcm1fdmlhX3ByaXZhdGVfdCAq
ZGV2X3ByaXYsIGludCBjb250ZXh0KQotewotCXVuc2lnbmVkIGludCBpOwotCXZvbGF0aWxl
IGludCAqbG9jazsKLQotCWlmICghZGV2X3ByaXYtPnNhcmVhX3ByaXYpCi0JCXJldHVybjsK
LQotCWZvciAoaSA9IDA7IGkgPCBWSUFfTlJfWFZNQ19MT0NLUzsgKytpKSB7Ci0JCWxvY2sg
PSAodm9sYXRpbGUgaW50ICopWFZNQ0xPQ0tQVFIoZGV2X3ByaXYtPnNhcmVhX3ByaXYsIGkp
OwotCQlpZiAoKF9EUk1fTE9DS0lOR19DT05URVhUKCpsb2NrKSA9PSBjb250ZXh0KSkgewot
CQkJaWYgKF9EUk1fTE9DS19JU19IRUxEKCpsb2NrKQotCQkJICAgICYmICgqbG9jayAmIF9E
Uk1fTE9DS19DT05UKSkgewotCQkJCXdha2VfdXAoJihkZXZfcHJpdi0+ZGVjb2Rlcl9xdWV1
ZVtpXSkpOwotCQkJfQotCQkJKmxvY2sgPSAwOwotCQl9Ci0JfQotfQotCi1pbnQgdmlhX2Rl
Y29kZXJfZnV0ZXgoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCi17Ci0JZHJtX3ZpYV9mdXRleF90ICpmeCA9IGRhdGE7
Ci0Jdm9sYXRpbGUgaW50ICpsb2NrOwotCWRybV92aWFfcHJpdmF0ZV90ICpkZXZfcHJpdiA9
IChkcm1fdmlhX3ByaXZhdGVfdCAqKSBkZXYtPmRldl9wcml2YXRlOwotCWRybV92aWFfc2Fy
ZWFfdCAqc0FQcml2ID0gZGV2X3ByaXYtPnNhcmVhX3ByaXY7Ci0JaW50IHJldCA9IDA7Ci0K
LQlEUk1fREVCVUcoIlxuIik7Ci0KLQlpZiAoZngtPmxvY2sgPj0gVklBX05SX1hWTUNfTE9D
S1MpCi0JCXJldHVybiAtRUZBVUxUOwotCi0JbG9jayA9ICh2b2xhdGlsZSBpbnQgKilYVk1D
TE9DS1BUUihzQVByaXYsIGZ4LT5sb2NrKTsKLQotCXN3aXRjaCAoZngtPmZ1bmMpIHsKLQlj
YXNlIFZJQV9GVVRFWF9XQUlUOgotCQlWSUFfV0FJVF9PTihyZXQsIGRldl9wcml2LT5kZWNv
ZGVyX3F1ZXVlW2Z4LT5sb2NrXSwKLQkJCSAgICAoZngtPm1zIC8gMTApICogKEhaIC8gMTAw
KSwgKmxvY2sgIT0gZngtPnZhbCk7Ci0JCXJldHVybiByZXQ7Ci0JY2FzZSBWSUFfRlVURVhf
V0FLRToKLQkJd2FrZV91cCgmKGRldl9wcml2LT5kZWNvZGVyX3F1ZXVlW2Z4LT5sb2NrXSkp
OwotCQlyZXR1cm4gMDsKLQl9Ci0JcmV0dXJuIDA7Ci19Ci0tIAoyLjM2LjEKCg==
--------------dg90bebkuXNL8Vm3UILvZYRT
Content-Type: text/x-patch; charset=UTF-8;
 name="0002-drm-via-Add-new-module-entry-points.patch"
Content-Disposition: attachment;
 filename="0002-drm-via-Add-new-module-entry-points.patch"
Content-Transfer-Encoding: base64

RnJvbSA0NmQ4NTEyMWMzOGFkOTA2MDM4YmY0MzAzYWU0MGEzMzFhMTZiMTFkIE1vbiBTZXAg
MTcgMDA6MDA6MDAgMjAwMQpGcm9tOiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5A
c3VzZS5kZT4KRGF0ZTogVHVlLCAyOCBKdW4gMjAyMiAxMzowMTowMyArMDIwMApTdWJqZWN0
OiBbUEFUQ0ggMi8yXSBkcm0vdmlhOiBBZGQgbmV3IG1vZHVsZSBlbnRyeSBwb2ludHMKCkFk
ZCBtb2R1bGUgbmV0cnkgcG9pbnRzIHRoYXQgYWxsb3cgZm9yIGJvdGgsIG1vZGVybiBhbmQg
bGVnYWN5LAptb2Rlc2V0dGluZy4gTWFrZSB0aGUgbGVnYWN5IHVzZXJzcGFjZSBtb2Rlc2V0
dGluZyBjb25maWd1cmFibGUKdmlhIGNvbmZpZyBhbmQgbW9kdWxlIG9wdGlvbnMuCgpTaWdu
ZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyAgICAgICAgICB8ICA5ICsrLS0tLS0KIGRyaXZl
cnMvZ3B1L2RybS92aWEvS2NvbmZpZyAgICAgIHwgMTcgKysrKysrKysrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS92aWEvTWFrZWZpbGUgICAgIHwgIDUgKystLQogZHJpdmVycy9ncHUvZHJt
L3ZpYS92aWFfZHJ2LmMgICAgfCA0MCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KwogZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZHJ2LmggICAgfCAxNiArKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9sZWdhY3kuYyB8IDM5ICsrKysrKysrKystLS0t
LS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2xlZ2FjeS5oIHwg
MjEgKysrKysrKysrKysrKysrKysKIDcgZmlsZXMgY2hhbmdlZCwgMTExIGluc2VydGlvbnMo
KyksIDM2IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS92aWEvS2NvbmZpZwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS92aWEv
dmlhX2Rydi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFf
ZHJ2LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9sZWdh
Y3kuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnIGIvZHJpdmVycy9n
cHUvZHJtL0tjb25maWcKaW5kZXggMjJlN2ZhNDhkNjkzLi44ZWE4N2QzNTU0MzQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9L
Y29uZmlnCkBAIC0zODcsNiArMzg3LDggQEAgc291cmNlICJkcml2ZXJzL2dwdS9kcm0vc29s
b21vbi9LY29uZmlnIgogCiBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS9zcHJkL0tjb25maWci
CiAKK3NvdXJjZSAiZHJpdmVycy9ncHUvZHJtL3ZpYS9LY29uZmlnIgorCiBjb25maWcgRFJN
X0hZUEVSVgogCXRyaXN0YXRlICJEUk0gU3VwcG9ydCBmb3IgSHlwZXItViBzeW50aGV0aWMg
dmlkZW8gZGV2aWNlIgogCWRlcGVuZHMgb24gRFJNICYmIFBDSSAmJiBNTVUgJiYgSFlQRVJW
CkBAIC00NjIsMTMgKzQ2NCw2IEBAIGNvbmZpZyBEUk1fU0lTCiAJICBjaGlwc2V0LiBJZiBN
IGlzIHNlbGVjdGVkIHRoZSBtb2R1bGUgd2lsbCBiZSBjYWxsZWQgc2lzLiBBR1AKIAkgIHN1
cHBvcnQgaXMgcmVxdWlyZWQgZm9yIHRoaXMgZHJpdmVyIHRvIHdvcmsuCiAKLWNvbmZpZyBE
Uk1fVklBCi0JdHJpc3RhdGUgIlZpYSB1bmljaHJvbWUgdmlkZW8gY2FyZHMiCi0JZGVwZW5k
cyBvbiBEUk0gJiYgUENJCi0JaGVscAotCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIGlmIHlvdSBo
YXZlIGEgVmlhIHVuaWNocm9tZSBvciBjb21wYXRpYmxlIHZpZGVvCi0JICBjaGlwc2V0LiBJ
ZiBNIGlzIHNlbGVjdGVkIHRoZSBtb2R1bGUgd2lsbCBiZSBjYWxsZWQgdmlhLgotCiBjb25m
aWcgRFJNX1NBVkFHRQogCXRyaXN0YXRlICJTYXZhZ2UgdmlkZW8gY2FyZHMiCiAJZGVwZW5k
cyBvbiBEUk0gJiYgUENJCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL0tjb25m
aWcgYi9kcml2ZXJzL2dwdS9kcm0vdmlhL0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi5iNGUzYzI0MDVhZTMKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vdmlhL0tjb25maWcKQEAgLTAsMCArMSwxNyBAQAorIyBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogTUlUCisKK2NvbmZpZyBEUk1fVklBCisJdHJpc3RhdGUgIlZp
YSBVbmlDaHJvbWUiCisJZGVwZW5kcyBvbiBEUk0gJiYgUENJCisJaGVscAorCSAgQ2hvb3Nl
IHRoaXMgb3B0aW9uIGlmIHlvdSBoYXZlIGEgVmlhIFVuaUNocm9tZSBvciBjb21wYXRpYmxl
IHZpZGVvCisJICBjaGlwc2V0LgorCitjb25maWcgRFJNX1ZJQV9VTVNfREVGQVVMVAorCWJv
b2wgIkVuYWJsZSB1c2Vyc3BhY2UgbW9kZXNldHRpbmcgYnkgZGVmYXVsdCAoREFOR0VST1VT
KSIKKwlkZXBlbmRzIG9uIERSTV9WSUEgJiYgRFJNX0xFR0FDWQorCWhlbHAKKwkgIFNlbGVj
dCB0aGlzIG9wdGlvbiB0byBlbmFibGUgdXNlcnNwYWNlIG1vZGVzZXR0aW5nIGJ5IGRlZmF1
bHQuCisJICBUaGlzIGZlYXR1cmUgaXMgb2Jzb2xldGUgYW5kIGRhbmdlcm91cy4KKworCSAg
U2VsZWN0IE4gdW5sZXNzIHlvdSBrbm93IHdoYXQgeW91J3JlIGRvaW5nLgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3ZpYS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS92aWEv
TWFrZWZpbGUKaW5kZXggOTk3NjIwYWExNGYyLi4wOGE3ZTkyNTQyZWYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS92aWEvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Zp
YS9NYWtlZmlsZQpAQCAtMyw2ICszLDcgQEAKICMgTWFrZWZpbGUgZm9yIHRoZSBkcm0gZGV2
aWNlIGRyaXZlci4gIFRoaXMgZHJpdmVyIHByb3ZpZGVzIHN1cHBvcnQgZm9yIHRoZQogIyBE
aXJlY3QgUmVuZGVyaW5nIEluZnJhc3RydWN0dXJlIChEUkkpIGluIFhGcmVlODYgNC4xLjAg
YW5kIGhpZ2hlci4KIAotdmlhLXkgICAgOj0gdmlhX2xlZ2FjeS5vCit2aWEteQkJCSA6PSB2
aWFfZHJ2Lm8KK3ZpYS0kKENPTkZJR19EUk1fTEVHQUNZKSArPSB2aWFfbGVnYWN5Lm8KIAot
b2JqLSQoQ09ORklHX0RSTV9WSUEpCSs9dmlhLm8KK29iai0kKENPTkZJR19EUk1fVklBKSAr
PSB2aWEubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZHJ2LmMgYi9k
cml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kcnYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLmU2YzU4NmVmOTBmNAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS92aWEvdmlhX2Rydi5jCkBAIC0wLDAgKzEsNDAgQEAKKy8vIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBNSVQKKworI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3BjaV9pZHMuaD4KKworI2luY2x1ZGUgInZpYV9kcnYuaCIKKyNpbmNs
dWRlICJ2aWFfbGVnYWN5LmgiCisKKyNpZiBkZWZpbmVkKENPTkZJR19EUk1fVklBX1VNU19E
RUZBVUxUKQorc3RhdGljIGJvb2wgZW5hYmxlX3VtcyA9IHRydWU7CisjZWxzZQorc3RhdGlj
IGJvb2wgZW5hYmxlX3VtczsKKyNlbmRpZgorTU9EVUxFX1BBUk1fREVTQyhlbmFibGVfdW1z
LCAiRW5hYmxlIHVzZXJzcGFjZSBtb2Rlc2V0dGluZyAoT0JTT0xFVEUpIik7Cittb2R1bGVf
cGFyYW0oZW5hYmxlX3VtcywgYm9vbCwgMCk7CisKK3N0YXRpYyBpbnQgX19pbml0IHZpYV9p
bml0KHZvaWQpCit7CisJaWYgKGVuYWJsZV91bXMpCisJCXJldHVybiB2aWFfbGVnYWN5X2lu
aXQoKTsKKworCXJldHVybiAtRU5PREVWOyAvKiBUT0RPOiBkcm1fcGNpX3JlZ2lzdGVyX2Ry
aXZlcigpICovCit9CisKK3N0YXRpYyB2b2lkIF9fZXhpdCB2aWFfZXhpdCh2b2lkKQorewor
CWlmIChlbmFibGVfdW1zKSB7CisJCXZpYV9sZWdhY3lfZXhpdCgpOworCQlyZXR1cm47CisJ
fQorCisJLyogVE9ETzogcGNpX3VucmVnaXN0ZXJfZHJpdmVyKCkgKi8KK30KKworbW9kdWxl
X2luaXQodmlhX2luaXQpOworbW9kdWxlX2V4aXQodmlhX2V4aXQpOworCitNT0RVTEVfQVVU
SE9SKERSSVZFUl9BVVRIT1IpOworTU9EVUxFX0RFU0NSSVBUSU9OKERSSVZFUl9ERVNDKTsK
K01PRFVMRV9MSUNFTlNFKCJHUEwgYW5kIGFkZGl0aW9uYWwgcmlnaHRzIik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92
aWEvdmlhX2Rydi5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4u
YzY5ZjhjMTg3ZWZhCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpYS92
aWFfZHJ2LmgKQEAgLTAsMCArMSwxNiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVCAqLworCisjaWZuZGVmIFZJQV9EUlZfSAorI2RlZmluZSBWSUFfRFJWX0gKKworI2Rl
ZmluZSBEUklWRVJfQVVUSE9SCQkiVmFyaW91cyIKKworI2RlZmluZSBEUklWRVJfTkFNRQkJ
InZpYSIKKyNkZWZpbmUgRFJJVkVSX0RFU0MJCSJWSUEgVW5pY2hyb21lIC8gUHJvIgorI2Rl
ZmluZSBEUklWRVJfREFURQkJIjIwMDcwMjAyIgorCisjZGVmaW5lIERSSVZFUl9NQUpPUgkJ
MgorI2RlZmluZSBEUklWRVJfTUlOT1IJCTExCisjZGVmaW5lIERSSVZFUl9QQVRDSExFVkVM
CTEKKworI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9sZWdh
Y3kuYyBiL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2xlZ2FjeS5jCmluZGV4IGE5MDAzMDI5
NDdhYS4uYmI3MjdiMjc5MmUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlhL3Zp
YV9sZWdhY3kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9sZWdhY3kuYwpAQCAt
NDYsNiArNDYsOCBAQAogI2luY2x1ZGUgPGRybS92aWFfZHJtLmg+CiAKICNpbmNsdWRlICJ2
aWFfM2RfcmVnLmgiCisjaW5jbHVkZSAidmlhX2Rydi5oIgorI2luY2x1ZGUgInZpYV9sZWdh
Y3kuaCIKIAogLyoKICAqIExlZ2FjeSBmaWxlOiB2aWFfdmVyaWZpZXIuaApAQCAtMjA5LDE2
ICsyMTEsNiBAQCB0eXBlZGVmIHN0cnVjdCBfZHJtX3ZpYV9ibGl0cSB7CiAgKiBDb3B5cmln
aHQgMjAwMS0yMDAzIFMzIEdyYXBoaWNzLCBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAg
Ki8KIAotI2RlZmluZSBEUklWRVJfQVVUSE9SCSJWYXJpb3VzIgotCi0jZGVmaW5lIERSSVZF
Ul9OQU1FCQkidmlhIgotI2RlZmluZSBEUklWRVJfREVTQwkJIlZJQSBVbmljaHJvbWUgLyBQ
cm8iCi0jZGVmaW5lIERSSVZFUl9EQVRFCQkiMjAwNzAyMDIiCi0KLSNkZWZpbmUgRFJJVkVS
X01BSk9SCQkyCi0jZGVmaW5lIERSSVZFUl9NSU5PUgkJMTEKLSNkZWZpbmUgRFJJVkVSX1BB
VENITEVWRUwJMQotCiAjZGVmaW5lIFZJQV9QQ0lfQlVGX1NJWkUgNjAwMDAKICNkZWZpbmUg
VklBX0ZJUkVfQlVGX1NJWkUgIDEwMjQKICNkZWZpbmUgVklBX05VTV9JUlFTIDQKQEAgLTE5
MjEsMTAgKzE5MTMsNiBAQCBzdGF0aWMgdm9pZCB2aWFfZHJpdmVyX3Bvc3RjbG9zZShzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJa2ZyZWUoZmls
ZV9wcml2KTsKIH0KIAotc3RhdGljIHN0cnVjdCBwY2lfZGV2aWNlX2lkIHBjaWlkbGlzdFtd
ID0gewotCXZpYWRydl9QQ0lfSURTCi19OwotCiBzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVf
b3BlcmF0aW9ucyB2aWFfZHJpdmVyX2ZvcHMgPSB7CiAJLm93bmVyID0gVEhJU19NT0RVTEUs
CiAJLm9wZW4gPSBkcm1fb3BlbiwKQEAgLTE5NjQsMzAgKzE5NTIsMjcgQEAgc3RhdGljIHN0
cnVjdCBkcm1fZHJpdmVyIGRyaXZlciA9IHsKIAkucGF0Y2hsZXZlbCA9IERSSVZFUl9QQVRD
SExFVkVMLAogfTsKIAotc3RhdGljIHN0cnVjdCBwY2lfZHJpdmVyIHZpYV9wY2lfZHJpdmVy
ID0geworc3RhdGljIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkIHZpYV9sZWdhY3lfcGNp
X2RyaXZlcl9pZF90YWJsZVtdID0geworCXZpYWRydl9QQ0lfSURTCit9OworCitzdGF0aWMg
c3RydWN0IHBjaV9kcml2ZXIgdmlhX2xlZ2FjeV9wY2lfZHJpdmVyID0gewogCS5uYW1lID0g
RFJJVkVSX05BTUUsCi0JLmlkX3RhYmxlID0gcGNpaWRsaXN0LAorCS5pZF90YWJsZSA9IHZp
YV9sZWdhY3lfcGNpX2RyaXZlcl9pZF90YWJsZSwKIH07CiAKLXN0YXRpYyBpbnQgX19pbml0
IHZpYV9pbml0KHZvaWQpCitpbnQgX19pbml0IHZpYV9sZWdhY3lfaW5pdCh2b2lkKQogewog
CWRyaXZlci5udW1faW9jdGxzID0gdmlhX21heF9pb2N0bDsKIAl2aWFfaW5pdF9jb21tYW5k
X3ZlcmlmaWVyKCk7Ci0JcmV0dXJuIGRybV9sZWdhY3lfcGNpX2luaXQoJmRyaXZlciwgJnZp
YV9wY2lfZHJpdmVyKTsKKwlyZXR1cm4gZHJtX2xlZ2FjeV9wY2lfaW5pdCgmZHJpdmVyLCAm
dmlhX2xlZ2FjeV9wY2lfZHJpdmVyKTsKIH0KIAotc3RhdGljIHZvaWQgX19leGl0IHZpYV9l
eGl0KHZvaWQpCit2b2lkIF9fZXhpdCB2aWFfbGVnYWN5X2V4aXQodm9pZCkKIHsKLQlkcm1f
bGVnYWN5X3BjaV9leGl0KCZkcml2ZXIsICZ2aWFfcGNpX2RyaXZlcik7CisJZHJtX2xlZ2Fj
eV9wY2lfZXhpdCgmZHJpdmVyLCAmdmlhX2xlZ2FjeV9wY2lfZHJpdmVyKTsKIH0KIAotbW9k
dWxlX2luaXQodmlhX2luaXQpOwotbW9kdWxlX2V4aXQodmlhX2V4aXQpOwotCi1NT0RVTEVf
QVVUSE9SKERSSVZFUl9BVVRIT1IpOwotTU9EVUxFX0RFU0NSSVBUSU9OKERSSVZFUl9ERVND
KTsKLU1PRFVMRV9MSUNFTlNFKCJHUEwgYW5kIGFkZGl0aW9uYWwgcmlnaHRzIik7Ci0KIC8q
CiAgKiBMZWdhY3kgZmlsZTogdmlhX2lycS5jCiAgKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3ZpYS92aWFfbGVnYWN5LmggYi9kcml2ZXJzL2dwdS9kcm0vdmlhL3ZpYV9sZWdh
Y3kuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjI3ZDhhNWQ3
OTdiMwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2xlZ2Fj
eS5oCkBAIC0wLDAgKzEsMjEgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQg
Ki8KKworI2lmbmRlZiBWSUFfTEVHQUNZX0gKKyNkZWZpbmUgVklBX0xFR0FDWV9ICisKKyNp
bmNsdWRlIDxsaW51eC9lcnJuby5oPgorI2luY2x1ZGUgPGxpbnV4L2luaXQuaD4KKworI2lm
IGRlZmluZWQoQ09ORklHX0RSTV9MRUdBQ1kpCitpbnQgdmlhX2xlZ2FjeV9pbml0KHZvaWQp
Owordm9pZCB2aWFfbGVnYWN5X2V4aXQodm9pZCk7CisjZWxzZQorc3RhdGljIGlubGluZSBp
bnQgX19pbml0IHZpYV9sZWdhY3lfaW5pdCh2b2lkKQoreworCXJldHVybiAtRU5PREVWOwor
fQorc3RhdGljIGlubGluZSB2b2lkIF9fZXhpdCB2aWFfbGVnYWN5X2V4aXQodm9pZCkKK3sg
fQorI2VuZGlmCisKKyNlbmRpZgotLSAKMi4zNi4xCgo=

--------------dg90bebkuXNL8Vm3UILvZYRT--

--------------c2TO8yS5KM3vAh7V5wKvc50C--

--------------aEu0XABYtH0x7yx0ob3LH2XW
Content-Type: application/pgp-signature; name="OpenPGP_signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="OpenPGP_signature"

-----BEGIN PGP SIGNATURE-----

wsF5BAABCAAjFiEExndm/fpuMUdwYFFolh/E3EQov+AFAmK68kkFAwAAAAAACgkQlh/E3EQov+Bs
aBAAvzp6Up4nR9IN+gFbFCJzOJlLaG6UQwwXXxp16rXDL5UFVSdEPLd4c5FY+oxdR6prO3GTUCDm
fy30RlDe2TvelMF3YN7KwGr5vBdErq48Cao8ASm2aKQusTkGk8SerAAaXsX+aMLHDo3Pc9odaK+N
vM9P8As2OtcukhJa9HlsEqpFqQxE6tgWFsiegscDcd8ffU664s7Fu+hxowMB4IXkGQsgdXd/9vLy
j70ZpTVbj4ZYdFA+t+zmJ8ogz/spDUUt4lNLWDjylSkPlS9LkvYNSPP9Ta25zUlJpcJ4GnlvL4Bd
w9r/mVhijIfoL2bdtpUtrLcW5xLp3vrPeXJjiUKsa2C54vRlBXTNvRfMyY06KBToqJIxiyBnxell
KD9QVu/xaJIrY+FedrFJr7UvCIAxQle4hV4z7yyaAK52AG+z8FrCtGl4Qe6TevahSoJw+enRYTjg
2l7hvkOYxflPc2ArZPq1jDmOVvQHeEPl8V6jHq+0UWUtyXPcyLS9+Xeii+jIQ/qpDRiHs4GtYjlw
5I2zZ/8ZIzczkD/kSTld6ZvaNFT3xFkmFXqHBMIX1/UsUIXqjvgpDqm81ld3/e+d33gLscViIYhG
CQG6jTZD4o7Su9g7PMgqcvNiomSTxHc5LzpucWjnGGLXI8ETPxqwrmyphkwknkjXSyfdn0Tael1n
jhU=
=9QF6
-----END PGP SIGNATURE-----

--------------aEu0XABYtH0x7yx0ob3LH2XW--
