Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AC4A0819C4
	for <lists+dri-devel@lfdr.de>; Mon,  5 Aug 2019 14:44:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 908E56E4D2;
	Mon,  5 Aug 2019 12:43:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8F8406E472;
 Mon,  5 Aug 2019 12:43:20 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id F41AA38B03;
 Mon,  5 Aug 2019 12:43:19 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-81.ams2.redhat.com
 [10.36.116.81])
 by smtp.corp.redhat.com (Postfix) with ESMTP id C8BD41000335;
 Mon,  5 Aug 2019 12:43:16 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id A8DF79D12; Mon,  5 Aug 2019 14:43:14 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 14/18] drm/amdgpu: switch driver from bo->resv to
 bo->base.resv
Date: Mon,  5 Aug 2019 14:43:06 +0200
Message-Id: <20190805124310.3275-15-kraxel@redhat.com>
In-Reply-To: <20190805124310.3275-1-kraxel@redhat.com>
References: <20190805124310.3275-1-kraxel@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.25]); Mon, 05 Aug 2019 12:43:20 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: thomas@shipmail.org, tzimmermann@suse.de, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, intel-gfx@lists.freedesktop.org,
 open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Leo Li <sunpeng.li@amd.com>, bskeggs@redhat.com,
 Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Gerd Hoffmann <kraxel@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+ClJldmlld2Vk
LWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogLi4u
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgIDggKystLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8ICA2ICsrLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMgICB8ICAyICstCiBkcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jICAgfCAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jICAgICAgIHwgIDYgKystLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jICAgICAgIHwgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCAyMiArKysrKysrLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAgICAgIHwgIDYgKystLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jICAgICAgIHwgIDQgKy0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYyAgICAgICAgfCAzMCArKysrKysr
KystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5j
ICAgfCAgMiArLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5j
IHwgIDIgKy0KIDEzIGZpbGVzIGNoYW5nZWQsIDQ2IGluc2VydGlvbnMoKyksIDQ4IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRr
ZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1
dm0uYwppbmRleCAxZDNlZTljNDJmN2UuLmZlMDYyYjc2ZWM5MSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwpAQCAtMjE4LDcgKzIxOCw3
IEBAIHZvaWQgYW1kZ3B1X2FtZGtmZF91bnJlc2VydmVfbWVtb3J5X2xpbWl0KHN0cnVjdCBhbWRn
cHVfYm8gKmJvKQogc3RhdGljIGludCBhbWRncHVfYW1ka2ZkX3JlbW92ZV9ldmljdGlvbl9mZW5j
ZShzdHJ1Y3QgYW1kZ3B1X2JvICpibywKIAkJCQkJc3RydWN0IGFtZGdwdV9hbWRrZmRfZmVuY2Ug
KmVmKQogewotCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBiby0+dGJvLnJlc3Y7
CisJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2Owog
CXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3RfbGlzdCAqb2xkLCAqbmV3OwogCXVuc2lnbmVkIGlu
dCBpLCBqLCBrOwogCkBAIC04MTIsNyArODEyLDcgQEAgc3RhdGljIGludCBwcm9jZXNzX3N5bmNf
cGRzX3Jlc3Yoc3RydWN0IGFtZGtmZF9wcm9jZXNzX2luZm8gKnByb2Nlc3NfaW5mbywKIAkJc3Ry
dWN0IGFtZGdwdV9ibyAqcGQgPSBwZWVyX3ZtLT5yb290LmJhc2UuYm87CiAKIAkJcmV0ID0gYW1k
Z3B1X3N5bmNfcmVzdihOVUxMLAotCQkJCQlzeW5jLCBwZC0+dGJvLnJlc3YsCisJCQkJCXN5bmMs
IHBkLT50Ym8uYmFzZS5yZXN2LAogCQkJCQlBTURHUFVfRkVOQ0VfT1dORVJfS0ZELCBmYWxzZSk7
CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAtODg3LDcgKzg4Nyw3IEBAIHN0YXRpYyBp
bnQgaW5pdF9rZmRfdm0oc3RydWN0IGFtZGdwdV92bSAqdm0sIHZvaWQgKipwcm9jZXNzX2luZm8s
CiAJCQkJICBBTURHUFVfRkVOQ0VfT1dORVJfS0ZELCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJZ290
byB3YWl0X3BkX2ZhaWw7Ci0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hhcmVk
KHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2LCAxKTsKKwlyZXQgPSByZXNlcnZhdGlvbl9vYmpl
Y3RfcmVzZXJ2ZV9zaGFyZWQodm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdiwgMSk7CiAJ
aWYgKHJldCkKIAkJZ290byByZXNlcnZlX3NoYXJlZF9mYWlsOwogCWFtZGdwdV9ib19mZW5jZSh2
bS0+cm9vdC5iYXNlLmJvLApAQCAtMjEzMiw3ICsyMTMyLDcgQEAgaW50IGFtZGdwdV9hbWRrZmRf
YWRkX2d3c190b19wcm9jZXNzKHZvaWQgKmluZm8sIHZvaWQgKmd3cywgc3RydWN0IGtnZF9tZW0g
KiptZW0KIAkgKiBBZGQgcHJvY2VzcyBldmljdGlvbiBmZW5jZSB0byBibyBzbyB0aGV5IGNhbgog
CSAqIGV2aWN0IGVhY2ggb3RoZXIuCiAJICovCi0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jl
c2VydmVfc2hhcmVkKGd3c19iby0+dGJvLnJlc3YsIDEpOworCXJldCA9IHJlc2VydmF0aW9uX29i
amVjdF9yZXNlcnZlX3NoYXJlZChnd3NfYm8tPnRiby5iYXNlLnJlc3YsIDEpOwogCWlmIChyZXQp
CiAJCWdvdG8gcmVzZXJ2ZV9zaGFyZWRfZmFpbDsKIAlhbWRncHVfYm9fZmVuY2UoZ3dzX2JvLCAm
cHJvY2Vzc19pbmZvLT5ldmljdGlvbl9mZW5jZS0+YmFzZSwgdHJ1ZSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9jcy5jCmluZGV4IGNjZTA1NzUxMTliMC4uZTc0OGNkMjg0NzgwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYwpAQCAtNDAyLDcgKzQwMiw3IEBA
IHN0YXRpYyBpbnQgYW1kZ3B1X2NzX2JvX3ZhbGlkYXRlKHN0cnVjdCBhbWRncHVfY3NfcGFyc2Vy
ICpwLAogCXN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCBjdHggPSB7CiAJCS5pbnRlcnJ1cHRpYmxl
ID0gdHJ1ZSwKIAkJLm5vX3dhaXRfZ3B1ID0gZmFsc2UsCi0JCS5yZXN2ID0gYm8tPnRiby5yZXN2
LAorCQkucmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2LAogCQkuZmxhZ3MgPSAwCiAJfTsKIAl1aW50
MzJfdCBkb21haW47CkBAIC03MzAsNyArNzMwLDcgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfc3lu
Y19yaW5ncyhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcCkKIAogCWxpc3RfZm9yX2VhY2hfZW50
cnkoZSwgJnAtPnZhbGlkYXRlZCwgdHYuaGVhZCkgewogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9
IHR0bV90b19hbWRncHVfYm8oZS0+dHYuYm8pOwotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0
ICpyZXN2ID0gYm8tPnRiby5yZXN2OworCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2
ID0gYm8tPnRiby5iYXNlLnJlc3Y7CiAKIAkJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwg
JnAtPmpvYi0+c3luYywgcmVzdiwgcC0+ZmlscCwKIAkJCQkgICAgIGFtZGdwdV9ib19leHBsaWNp
dF9zeW5jKGJvKSk7CkBAIC0xNzI5LDcgKzE3MjksNyBAQCBpbnQgYW1kZ3B1X2NzX2ZpbmRfbWFw
cGluZyhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcGFyc2VyLAogCSptYXAgPSBtYXBwaW5nOwog
CiAJLyogRG91YmxlIGNoZWNrIHRoYXQgdGhlIEJPIGlzIHJlc2VydmVkIGJ5IHRoaXMgQ1MgKi8K
LQlpZiAocmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tpbmdfY3R4KCgqYm8pLT50Ym8ucmVzdikgIT0g
JnBhcnNlci0+dGlja2V0KQorCWlmIChyZXNlcnZhdGlvbl9vYmplY3RfbG9ja2luZ19jdHgoKCpi
byktPnRiby5iYXNlLnJlc3YpICE9ICZwYXJzZXItPnRpY2tldCkKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKIAlpZiAoISgoKmJvKS0+ZmxhZ3MgJiBBTURHUFVfR0VNX0NSRUFURV9WUkFNX0NPTlRJR1VP
VVMpKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGlz
cGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rpc3BsYXkuYwppbmRl
eCA1MzU2NTA5NjdiMWEuLmI1ZDAyMGUxNWMzNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZGlzcGxheS5jCkBAIC0yMDQsNyArMjA0LDcgQEAgaW50IGFtZGdwdV9kaXNw
bGF5X2NydGNfcGFnZV9mbGlwX3RhcmdldChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCWdvdG8g
dW5waW47CiAJfQogCi0JciA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfZmVuY2VzX3JjdShuZXdf
YWJvLT50Ym8ucmVzdiwgJndvcmstPmV4Y2wsCisJciA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRf
ZmVuY2VzX3JjdShuZXdfYWJvLT50Ym8uYmFzZS5yZXN2LCAmd29yay0+ZXhjbCwKIAkJCQkJICAg
ICAgJndvcmstPnNoYXJlZF9jb3VudCwKIAkJCQkJICAgICAgJndvcmstPnNoYXJlZCk7CiAJaWYg
KHVubGlrZWx5KHIgIT0gMCkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kbWFfYnVmLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZG1hX2J1Zi5jCmluZGV4IGNhMzJkYjZlZjVjMC4uYjg4ZTI3ZGE3YzI4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKQEAgLTIxNiw3ICsyMTYsNyBAQCBz
dGF0aWMgaW50IGFtZGdwdV9kbWFfYnVmX21hcF9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYV9i
dWYsCiAJCSAqIGZlbmNlcyBvbiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0IGludG8gYSBzaW5nbGUg
ZXhjbHVzaXZlCiAJCSAqIGZlbmNlLgogCQkgKi8KLQkJciA9IF9fcmVzZXJ2YXRpb25fb2JqZWN0
X21ha2VfZXhjbHVzaXZlKGJvLT50Ym8ucmVzdik7CisJCXIgPSBfX3Jlc2VydmF0aW9uX29iamVj
dF9tYWtlX2V4Y2x1c2l2ZShiby0+dGJvLmJhc2UucmVzdik7CiAJCWlmIChyKQogCQkJZ290byBl
cnJvcl91bnJlc2VydmU7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5j
CmluZGV4IDlmZjA1MDFjZjFlMC4uYmZmOTE3M2ExYTk0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2dlbS5jCkBAIC0xMzQsNyArMTM0LDcgQEAgaW50IGFtZGdwdV9nZW1fb2Jq
ZWN0X29wZW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiAJCXJldHVybiAtRVBFUk07CiAK
IAlpZiAoYWJvLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRFX1ZNX0FMV0FZU19WQUxJRCAmJgot
CSAgICBhYm8tPnRiby5yZXN2ICE9IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KQorCSAgICBh
Ym8tPnRiby5iYXNlLnJlc3YgIT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikKIAkJ
cmV0dXJuIC1FUEVSTTsKIAogCXIgPSBhbWRncHVfYm9fcmVzZXJ2ZShhYm8sIGZhbHNlKTsKQEAg
LTI1Miw3ICsyNTIsNyBAQCBpbnQgYW1kZ3B1X2dlbV9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKIAotCQlyZXN2
ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3Y7CisJCXJlc3YgPSB2bS0+cm9vdC5iYXNlLmJv
LT50Ym8uYmFzZS5yZXN2OwogCX0KIAogCXIgPSBhbWRncHVfZ2VtX29iamVjdF9jcmVhdGUoYWRl
diwgc2l6ZSwgYXJncy0+aW4uYWxpZ25tZW50LApAQCAtNDMzLDcgKzQzMyw3IEBAIGludCBhbWRn
cHVfZ2VtX3dhaXRfaWRsZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQlyZXR1cm4gLUVOT0VOVDsKIAl9CiAJcm9iaiA9IGdlbV90b19hbWRncHVfYm8oZ29iaik7
Ci0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3Uocm9iai0+dGJvLnJl
c3YsIHRydWUsIHRydWUsCisJcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9y
Y3Uocm9iai0+dGJvLmJhc2UucmVzdiwgdHJ1ZSwgdHJ1ZSwKIAkJCQkJCSAgdGltZW91dCk7CiAK
IAkvKiByZXQgPT0gMCBtZWFucyBub3Qgc2lnbmFsZWQsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfa21zLmMKaW5kZXggMGNmN2U4NjA2ZmQzLi4yNTJmNzFlOTA5NTMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMKQEAgLTEwODgsNyArMTA4OCw3IEBAIHZv
aWQgYW1kZ3B1X2RyaXZlcl9wb3N0Y2xvc2Vfa21zKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
YW1kZ3B1X3ZtX2ZpbmkoYWRldiwgJmZwcml2LT52bSk7CiAKIAlpZiAocGFzaWQpCi0JCWFtZGdw
dV9wYXNpZF9mcmVlX2RlbGF5ZWQocGQtPnRiby5yZXN2LCBwYXNpZCk7CisJCWFtZGdwdV9wYXNp
ZF9mcmVlX2RlbGF5ZWQocGQtPnRiby5iYXNlLnJlc3YsIHBhc2lkKTsKIAlhbWRncHVfYm9fdW5y
ZWYoJnBkKTsKIAogCWlkcl9mb3JfZWFjaF9lbnRyeSgmZnByaXYtPmJvX2xpc3RfaGFuZGxlcywg
bGlzdCwgaGFuZGxlKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X21uLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYwppbmRleCAz
OTcxYzIwMWYzMjAuLjUwMDIyYWNjOGE4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X21uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X21uLmMKQEAgLTE3OSw3ICsxNzksNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfbW5faW52YWxp
ZGF0ZV9ub2RlKHN0cnVjdCBhbWRncHVfbW5fbm9kZSAqbm9kZSwKIAkJaWYgKCFhbWRncHVfdHRt
X3R0X2FmZmVjdF91c2VycHRyKGJvLT50Ym8udHRtLCBzdGFydCwgZW5kKSkKIAkJCWNvbnRpbnVl
OwogCi0JCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLnJl
c3YsCisJCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLmJh
c2UucmVzdiwKIAkJCXRydWUsIGZhbHNlLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlmIChy
IDw9IDApCiAJCQlEUk1fRVJST1IoIiglbGQpIGZhaWxlZCB0byB3YWl0IGZvciB1c2VyIGJvXG4i
LCByKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmpl
Y3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwppbmRleCAy
NDJkNGU4MWZjN2MuLjhhZTQ0ZDM4M2ExMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9vYmplY3QuYwpAQCAtNTA5LDggKzUwOSw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2Jv
X2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlpZiAodW5saWtlbHkociAh
PSAwKSkKIAkJcmV0dXJuIHI7CiAKLQliby0+dGJvLmJhc2UucmVzdiA9IGJvLT50Ym8ucmVzdjsK
LQogCWlmICghYW1kZ3B1X2dtY192cmFtX2Z1bGxfdmlzaWJsZSgmYWRldi0+Z21jKSAmJgogCSAg
ICBiby0+dGJvLm1lbS5tZW1fdHlwZSA9PSBUVE1fUExfVlJBTSAmJgogCSAgICBiby0+dGJvLm1l
bS5zdGFydCA8IGFkZXYtPmdtYy52aXNpYmxlX3ZyYW1fc2l6ZSA+PiBQQUdFX1NISUZUKQpAQCAt
NTIzLDcgKzUyMSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2JvX2RvX2NyZWF0ZShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwKIAkgICAgYm8tPnRiby5tZW0ucGxhY2VtZW50ICYgVFRNX1BMX0ZM
QUdfVlJBTSkgewogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlyID0gYW1kZ3B1X2Zp
bGxfYnVmZmVyKGJvLCAwLCBiby0+dGJvLnJlc3YsICZmZW5jZSk7CisJCXIgPSBhbWRncHVfZmls
bF9idWZmZXIoYm8sIDAsIGJvLT50Ym8uYmFzZS5yZXN2LCAmZmVuY2UpOwogCQlpZiAodW5saWtl
bHkocikpCiAJCQlnb3RvIGZhaWxfdW5yZXNlcnZlOwogCkBAIC01NDYsNyArNTQ0LDcgQEAgc3Rh
dGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CiBmYWlsX3VucmVzZXJ2ZToKIAlpZiAoIWJwLT5yZXN2KQotCQlyZXNlcnZhdGlvbl9vYmplY3Rf
dW5sb2NrKGJvLT50Ym8ucmVzdik7CisJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYm8tPnRi
by5iYXNlLnJlc3YpOwogCWFtZGdwdV9ib191bnJlZigmYm8pOwogCXJldHVybiByOwogfQpAQCAt
NTY3LDcgKzU2NSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2JvX2NyZWF0ZV9zaGFkb3coc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJYnAuZmxhZ3MgPSBBTURHUFVfR0VNX0NSRUFURV9DUFVf
R1RUX1VTV0MgfAogCQlBTURHUFVfR0VNX0NSRUFURV9TSEFET1c7CiAJYnAudHlwZSA9IHR0bV9i
b190eXBlX2tlcm5lbDsKLQlicC5yZXN2ID0gYm8tPnRiby5yZXN2OworCWJwLnJlc3YgPSBiby0+
dGJvLmJhc2UucmVzdjsKIAogCXIgPSBhbWRncHVfYm9fZG9fY3JlYXRlKGFkZXYsICZicCwgJmJv
LT5zaGFkb3cpOwogCWlmICghcikgewpAQCAtNjA4LDEzICs2MDYsMTMgQEAgaW50IGFtZGdwdV9i
b19jcmVhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAlpZiAoKGZsYWdzICYgQU1E
R1BVX0dFTV9DUkVBVEVfU0hBRE9XKSAmJiAhKGFkZXYtPmZsYWdzICYgQU1EX0lTX0FQVSkpIHsK
IAkJaWYgKCFicC0+cmVzdikKLQkJCVdBUk5fT04ocmVzZXJ2YXRpb25fb2JqZWN0X2xvY2soKCpi
b19wdHIpLT50Ym8ucmVzdiwKKwkJCVdBUk5fT04ocmVzZXJ2YXRpb25fb2JqZWN0X2xvY2soKCpi
b19wdHIpLT50Ym8uYmFzZS5yZXN2LAogCQkJCQkJCU5VTEwpKTsKIAogCQlyID0gYW1kZ3B1X2Jv
X2NyZWF0ZV9zaGFkb3coYWRldiwgYnAtPnNpemUsICpib19wdHIpOwogCiAJCWlmICghYnAtPnJl
c3YpCi0JCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKCgqYm9fcHRyKS0+dGJvLnJlc3YpOwor
CQkJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jaygoKmJvX3B0ciktPnRiby5iYXNlLnJlc3YpOwog
CiAJCWlmIChyKQogCQkJYW1kZ3B1X2JvX3VucmVmKGJvX3B0cik7CkBAIC03MTEsNyArNzA5LDcg
QEAgaW50IGFtZGdwdV9ib19rbWFwKHN0cnVjdCBhbWRncHVfYm8gKmJvLCB2b2lkICoqcHRyKQog
CQlyZXR1cm4gMDsKIAl9CiAKLQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9y
Y3UoYm8tPnRiby5yZXN2LCBmYWxzZSwgZmFsc2UsCisJciA9IHJlc2VydmF0aW9uX29iamVjdF93
YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8uYmFzZS5yZXN2LCBmYWxzZSwgZmFsc2UsCiAJCQkJCQlN
QVhfU0NIRURVTEVfVElNRU9VVCk7CiAJaWYgKHIgPCAwKQogCQlyZXR1cm4gcjsKQEAgLTEwODks
NyArMTA4Nyw3IEBAIGludCBhbWRncHVfYm9fc2V0X3RpbGluZ19mbGFncyhzdHJ1Y3QgYW1kZ3B1
X2JvICpibywgdTY0IHRpbGluZ19mbGFncykKICAqLwogdm9pZCBhbWRncHVfYm9fZ2V0X3RpbGlu
Z19mbGFncyhzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTY0ICp0aWxpbmdfZmxhZ3MpCiB7Ci0JcmVz
ZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGJvLT50Ym8ucmVzdik7CisJcmVzZXJ2YXRpb25f
b2JqZWN0X2Fzc2VydF9oZWxkKGJvLT50Ym8uYmFzZS5yZXN2KTsKIAogCWlmICh0aWxpbmdfZmxh
Z3MpCiAJCSp0aWxpbmdfZmxhZ3MgPSBiby0+dGlsaW5nX2ZsYWdzOwpAQCAtMTI4NSw3ICsxMjgz
LDcgQEAgaW50IGFtZGdwdV9ib19mYXVsdF9yZXNlcnZlX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QgKmJvKQogdm9pZCBhbWRncHVfYm9fZmVuY2Uoc3RydWN0IGFtZGdwdV9ibyAqYm8s
IHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogCQkgICAgIGJvb2wgc2hhcmVkKQogewotCXN0cnVj
dCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBiby0+dGJvLnJlc3Y7CisJc3RydWN0IHJlc2Vy
dmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2OwogCiAJaWYgKHNoYXJlZCkK
IAkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9zaGFyZWRfZmVuY2UocmVzdiwgZmVuY2UpOwpAQCAt
MTMxMCw3ICsxMzA4LDcgQEAgaW50IGFtZGdwdV9ib19zeW5jX3dhaXQoc3RydWN0IGFtZGdwdV9i
byAqYm8sIHZvaWQgKm93bmVyLCBib29sIGludHIpCiAJaW50IHI7CiAKIAlhbWRncHVfc3luY19j
cmVhdGUoJnN5bmMpOwotCWFtZGdwdV9zeW5jX3Jlc3YoYWRldiwgJnN5bmMsIGJvLT50Ym8ucmVz
diwgb3duZXIsIGZhbHNlKTsKKwlhbWRncHVfc3luY19yZXN2KGFkZXYsICZzeW5jLCBiby0+dGJv
LmJhc2UucmVzdiwgb3duZXIsIGZhbHNlKTsKIAlyID0gYW1kZ3B1X3N5bmNfd2FpdCgmc3luYywg
aW50cik7CiAJYW1kZ3B1X3N5bmNfZnJlZSgmc3luYyk7CiAKQEAgLTEzMzAsNyArMTMyOCw3IEBA
IGludCBhbWRncHVfYm9fc3luY193YWl0KHN0cnVjdCBhbWRncHVfYm8gKmJvLCB2b2lkICpvd25l
ciwgYm9vbCBpbnRyKQogdTY0IGFtZGdwdV9ib19ncHVfb2Zmc2V0KHN0cnVjdCBhbWRncHVfYm8g
KmJvKQogewogCVdBUk5fT05fT05DRShiby0+dGJvLm1lbS5tZW1fdHlwZSA9PSBUVE1fUExfU1lT
VEVNKTsKLQlXQVJOX09OX09OQ0UoIXJlc2VydmF0aW9uX29iamVjdF9pc19sb2NrZWQoYm8tPnRi
by5yZXN2KSAmJgorCVdBUk5fT05fT05DRSghcmVzZXJ2YXRpb25fb2JqZWN0X2lzX2xvY2tlZChi
by0+dGJvLmJhc2UucmVzdikgJiYKIAkJICAgICAhYm8tPnBpbl9jb3VudCAmJiBiby0+dGJvLnR5
cGUgIT0gdHRtX2JvX3R5cGVfa2VybmVsKTsKIAlXQVJOX09OX09OQ0UoYm8tPnRiby5tZW0uc3Rh
cnQgPT0gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUKTsKIAlXQVJOX09OX09OQ0UoYm8tPnRiby5t
ZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1ZSQU0gJiYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV90dG0uYwppbmRleCBiMzliNTAxNzU4ZGQuLmU4YTUxZThkOTRmMiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpAQCAtNDQwLDcgKzQ0MCw3IEBAIHN0YXRpYyBp
bnQgYW1kZ3B1X21vdmVfYmxpdChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCiAJciA9
IGFtZGdwdV90dG1fY29weV9tZW1fdG9fbWVtKGFkZXYsICZzcmMsICZkc3QsCiAJCQkJICAgICAg
IG5ld19tZW0tPm51bV9wYWdlcyA8PCBQQUdFX1NISUZULAotCQkJCSAgICAgICBiby0+cmVzdiwg
JmZlbmNlKTsKKwkJCQkgICAgICAgYm8tPmJhc2UucmVzdiwgJmZlbmNlKTsKIAlpZiAocikKIAkJ
Z290byBlcnJvcjsKIApAQCAtMTQ3OCwxNCArMTQ3OCwxNCBAQCBzdGF0aWMgYm9vbCBhbWRncHVf
dHRtX2JvX2V2aWN0aW9uX3ZhbHVhYmxlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJ
ICogY2xlYW5seSBoYW5kbGUgcGFnZSBmYXVsdHMuCiAJICovCiAJaWYgKGJvLT50eXBlID09IHR0
bV9ib190eXBlX2tlcm5lbCAmJgotCSAgICAhcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFs
ZWRfcmN1KGJvLT5yZXN2LCB0cnVlKSkKKwkgICAgIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3Np
Z25hbGVkX3JjdShiby0+YmFzZS5yZXN2LCB0cnVlKSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJLyog
SWYgYm8gaXMgYSBLRkQgQk8sIGNoZWNrIGlmIHRoZSBibyBiZWxvbmdzIHRvIHRoZSBjdXJyZW50
IHByb2Nlc3MuCiAJICogSWYgdHJ1ZSwgdGhlbiByZXR1cm4gZmFsc2UgYXMgYW55IEtGRCBwcm9j
ZXNzIG5lZWRzIGFsbCBpdHMgQk9zIHRvCiAJICogYmUgcmVzaWRlbnQgdG8gcnVuIHN1Y2Nlc3Nm
dWxseQogCSAqLwotCWZsaXN0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9saXN0KGJvLT5yZXN2
KTsKKwlmbGlzdCA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfbGlzdChiby0+YmFzZS5yZXN2KTsK
IAlpZiAoZmxpc3QpIHsKIAkJZm9yIChpID0gMDsgaSA8IGZsaXN0LT5zaGFyZWRfY291bnQ7ICsr
aSkgewogCQkJZiA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoZmxpc3QtPnNoYXJlZFtpXSwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYwppbmRleCA1YjJmZWEzYjRhMmMu
LmY4NTg2MDdiMTdhNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3V2ZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYwpA
QCAtMTA3Myw3ICsxMDczLDcgQEAgc3RhdGljIGludCBhbWRncHVfdXZkX3NlbmRfbXNnKHN0cnVj
dCBhbWRncHVfcmluZyAqcmluZywgc3RydWN0IGFtZGdwdV9ibyAqYm8sCiAJaWItPmxlbmd0aF9k
dyA9IDE2OwogCiAJaWYgKGRpcmVjdCkgewotCQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRf
dGltZW91dF9yY3UoYm8tPnRiby5yZXN2LAorCQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRf
dGltZW91dF9yY3UoYm8tPnRiby5iYXNlLnJlc3YsCiAJCQkJCQkJdHJ1ZSwgZmFsc2UsCiAJCQkJ
CQkJbXNlY3NfdG9famlmZmllcygxMCkpOwogCQlpZiAociA9PSAwKQpAQCAtMTA4NSw3ICsxMDg1
LDcgQEAgc3RhdGljIGludCBhbWRncHVfdXZkX3NlbmRfbXNnKHN0cnVjdCBhbWRncHVfcmluZyAq
cmluZywgc3RydWN0IGFtZGdwdV9ibyAqYm8sCiAJCWlmIChyKQogCQkJZ290byBlcnJfZnJlZTsK
IAl9IGVsc2UgewotCQlyID0gYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAmam9iLT5zeW5jLCBiby0+
dGJvLnJlc3YsCisJCXIgPSBhbWRncHVfc3luY19yZXN2KGFkZXYsICZqb2ItPnN5bmMsIGJvLT50
Ym8uYmFzZS5yZXN2LAogCQkJCSAgICAgQU1ER1BVX0ZFTkNFX09XTkVSX1VOREVGSU5FRCwgZmFs
c2UpOwogCQlpZiAocikKIAkJCWdvdG8gZXJyX2ZyZWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV92bS5jCmluZGV4IGY3MmQzNjI1ZTE2Mi4uOTVlZWYwYWMyODI5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYwpAQCAtMzAyLDcgKzMwMiw3IEBAIHN0YXRpYyB2
b2lkIGFtZGdwdV92bV9ib19iYXNlX2luaXQoc3RydWN0IGFtZGdwdV92bV9ib19iYXNlICpiYXNl
LAogCWJhc2UtPm5leHQgPSBiby0+dm1fYm87CiAJYm8tPnZtX2JvID0gYmFzZTsKIAotCWlmIChi
by0+dGJvLnJlc3YgIT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJaWYgKGJvLT50Ym8u
YmFzZS5yZXN2ICE9IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJCXJldHVybjsK
IAogCXZtLT5idWxrX21vdmVhYmxlID0gZmFsc2U7CkBAIC01ODMsNyArNTgzLDcgQEAgdm9pZCBh
bWRncHVfdm1fZGVsX2Zyb21fbHJ1X25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
KQogCWZvciAoYm9fYmFzZSA9IGFiby0+dm1fYm87IGJvX2Jhc2U7IGJvX2Jhc2UgPSBib19iYXNl
LT5uZXh0KSB7CiAJCXN0cnVjdCBhbWRncHVfdm0gKnZtID0gYm9fYmFzZS0+dm07CiAKLQkJaWYg
KGFiby0+dGJvLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJCWlmIChhYm8t
PnRiby5iYXNlLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikKIAkJCXZt
LT5idWxrX21vdmVhYmxlID0gZmFsc2U7CiAJfQogCkBAIC04MzQsNyArODM0LDcgQEAgc3RhdGlj
IHZvaWQgYW1kZ3B1X3ZtX2JvX3BhcmFtKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1
Y3QgYW1kZ3B1X3ZtICp2bSwKIAkJYnAtPmZsYWdzIHw9IEFNREdQVV9HRU1fQ1JFQVRFX1NIQURP
VzsKIAlicC0+dHlwZSA9IHR0bV9ib190eXBlX2tlcm5lbDsKIAlpZiAodm0tPnJvb3QuYmFzZS5i
bykKLQkJYnAtPnJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdjsKKwkJYnAtPnJlc3Yg
PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2OwogfQogCiAvKioKQEAgLTE3MDIsNyAr
MTcwMiw3IEBAIGludCBhbWRncHVfdm1fYm9fdXBkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAogCQkJdHRtID0gY29udGFpbmVyX29mKGJvLT50Ym8udHRtLCBzdHJ1Y3QgdHRtX2RtYV90
dCwgdHRtKTsKIAkJCXBhZ2VzX2FkZHIgPSB0dG0tPmRtYV9hZGRyZXNzOwogCQl9Ci0JCWV4Y2x1
c2l2ZSA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfZXhjbChiby0+dGJvLnJlc3YpOworCQlleGNs
dXNpdmUgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2woYm8tPnRiby5iYXNlLnJlc3YpOwog
CX0KIAogCWlmIChibykgewpAQCAtMTcxMiw3ICsxNzEyLDcgQEAgaW50IGFtZGdwdV92bV9ib191
cGRhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCWZsYWdzID0gMHgwOwogCX0KIAot
CWlmIChjbGVhciB8fCAoYm8gJiYgYm8tPnRiby5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRi
by5yZXN2KSkKKwlpZiAoY2xlYXIgfHwgKGJvICYmIGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5y
b290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpKQogCQlsYXN0X3VwZGF0ZSA9ICZ2bS0+bGFzdF91
cGRhdGU7CiAJZWxzZQogCQlsYXN0X3VwZGF0ZSA9ICZib192YS0+bGFzdF9wdF91cGRhdGU7CkBA
IC0xNzQzLDcgKzE3NDMsNyBAQCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwKIAkgKiB0aGUgZXZpY3RlZCBsaXN0IHNvIHRoYXQgaXQgZ2V0cyB2YWxp
ZGF0ZWQgYWdhaW4gb24gdGhlCiAJICogbmV4dCBjb21tYW5kIHN1Ym1pc3Npb24uCiAJICovCi0J
aWYgKGJvICYmIGJvLT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikgewor
CWlmIChibyAmJiBiby0+dGJvLmJhc2UucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFz
ZS5yZXN2KSB7CiAJCXVpbnQzMl90IG1lbV90eXBlID0gYm8tPnRiby5tZW0ubWVtX3R5cGU7CiAK
IAkJaWYgKCEoYm8tPnByZWZlcnJlZF9kb21haW5zICYgYW1kZ3B1X21lbV90eXBlX3RvX2RvbWFp
bihtZW1fdHlwZSkpKQpAQCAtMTg3OSw3ICsxODc5LDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3Zt
X2ZyZWVfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKICAqLwogc3RhdGljIHZv
aWQgYW1kZ3B1X3ZtX3BydF9maW5pKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3Qg
YW1kZ3B1X3ZtICp2bSkKIHsKLQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gdm0t
PnJvb3QuYmFzZS5iby0+dGJvLnJlc3Y7CisJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVz
diA9IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3Y7CiAJc3RydWN0IGRtYV9mZW5jZSAq
ZXhjbCwgKipzaGFyZWQ7CiAJdW5zaWduZWQgaSwgc2hhcmVkX2NvdW50OwogCWludCByOwpAQCAt
MTk5Myw3ICsxOTkzLDcgQEAgaW50IGFtZGdwdV92bV9oYW5kbGVfbW92ZWQoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJd2hpbGUgKCFsaXN0X2VtcHR5KCZ2bS0+aW52YWxpZGF0ZWQpKSB7
CiAJCWJvX3ZhID0gbGlzdF9maXJzdF9lbnRyeSgmdm0tPmludmFsaWRhdGVkLCBzdHJ1Y3QgYW1k
Z3B1X2JvX3ZhLAogCQkJCQkgYmFzZS52bV9zdGF0dXMpOwotCQlyZXN2ID0gYm9fdmEtPmJhc2Uu
Ym8tPnRiby5yZXN2OworCQlyZXN2ID0gYm9fdmEtPmJhc2UuYm8tPnRiby5iYXNlLnJlc3Y7CiAJ
CXNwaW5fdW5sb2NrKCZ2bS0+aW52YWxpZGF0ZWRfbG9jayk7CiAKIAkJLyogVHJ5IHRvIHJlc2Vy
dmUgdGhlIEJPIHRvIGF2b2lkIGNsZWFyaW5nIGl0cyBwdGVzICovCkBAIC0yMDg0LDcgKzIwODQs
NyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdm1fYm9faW5zZXJ0X21hcChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKIAlpZiAobWFwcGluZy0+ZmxhZ3MgJiBBTURHUFVfUFRFX1BSVCkKIAkJYW1k
Z3B1X3ZtX3BydF9nZXQoYWRldik7CiAKLQlpZiAoYm8gJiYgYm8tPnRiby5yZXN2ID09IHZtLT5y
b290LmJhc2UuYm8tPnRiby5yZXN2ICYmCisJaWYgKGJvICYmIGJvLT50Ym8uYmFzZS5yZXN2ID09
IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YgJiYKIAkgICAgIWJvX3ZhLT5iYXNlLm1v
dmVkKSB7CiAJCWxpc3RfbW92ZSgmYm9fdmEtPmJhc2Uudm1fc3RhdHVzLCAmdm0tPm1vdmVkKTsK
IAl9CkBAIC0yNDE2LDcgKzI0MTYsNyBAQCB2b2lkIGFtZGdwdV92bV9ib190cmFjZV9jcyhzdHJ1
Y3QgYW1kZ3B1X3ZtICp2bSwgc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQpCiAJCQlzdHJ1
Y3QgYW1kZ3B1X2JvICpibzsKIAogCQkJYm8gPSBtYXBwaW5nLT5ib192YS0+YmFzZS5ibzsKLQkJ
CWlmIChyZXNlcnZhdGlvbl9vYmplY3RfbG9ja2luZ19jdHgoYm8tPnRiby5yZXN2KSAhPQorCQkJ
aWYgKHJlc2VydmF0aW9uX29iamVjdF9sb2NraW5nX2N0eChiby0+dGJvLmJhc2UucmVzdikgIT0K
IAkJCSAgICB0aWNrZXQpCiAJCQkJY29udGludWU7CiAJCX0KQEAgLTI0NDQsNyArMjQ0NCw3IEBA
IHZvaWQgYW1kZ3B1X3ZtX2JvX3JtdihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlzdHJ1
Y3QgYW1kZ3B1X3ZtX2JvX2Jhc2UgKipiYXNlOwogCiAJaWYgKGJvKSB7Ci0JCWlmIChiby0+dGJv
LnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJCWlmIChiby0+dGJvLmJhc2Uu
cmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQkJdm0tPmJ1bGtfbW92
ZWFibGUgPSBmYWxzZTsKIAogCQlmb3IgKGJhc2UgPSAmYm9fdmEtPmJhc2UuYm8tPnZtX2JvOyAq
YmFzZTsKQEAgLTI1MDgsNyArMjUwOCw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2JvX2ludmFsaWRhdGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJZm9yIChib19iYXNlID0gYm8tPnZtX2JvOyBi
b19iYXNlOyBib19iYXNlID0gYm9fYmFzZS0+bmV4dCkgewogCQlzdHJ1Y3QgYW1kZ3B1X3ZtICp2
bSA9IGJvX2Jhc2UtPnZtOwogCi0JCWlmIChldmljdGVkICYmIGJvLT50Ym8ucmVzdiA9PSB2bS0+
cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikgeworCQlpZiAoZXZpY3RlZCAmJiBiby0+dGJvLmJhc2Uu
cmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KSB7CiAJCQlhbWRncHVfdm1f
Ym9fZXZpY3RlZChib19iYXNlKTsKIAkJCWNvbnRpbnVlOwogCQl9CkBAIC0yNTE5LDcgKzI1MTks
NyBAQCB2b2lkIGFtZGdwdV92bV9ib19pbnZhbGlkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAogCiAJCWlmIChiby0+dGJvLnR5cGUgPT0gdHRtX2JvX3R5cGVfa2VybmVsKQogCQkJYW1k
Z3B1X3ZtX2JvX3JlbG9jYXRlZChib19iYXNlKTsKLQkJZWxzZSBpZiAoYm8tPnRiby5yZXN2ID09
IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KQorCQllbHNlIGlmIChiby0+dGJvLmJhc2UucmVz
diA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQkJYW1kZ3B1X3ZtX2JvX21v
dmVkKGJvX2Jhc2UpOwogCQllbHNlCiAJCQlhbWRncHVfdm1fYm9faW52YWxpZGF0ZWQoYm9fYmFz
ZSk7CkBAIC0yNjQ5LDcgKzI2NDksNyBAQCB2b2lkIGFtZGdwdV92bV9hZGp1c3Rfc2l6ZShzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgdWludDMyX3QgbWluX3ZtX3NpemUsCiAgKi8KIGxvbmcg
YW1kZ3B1X3ZtX3dhaXRfaWRsZShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgbG9uZyB0aW1lb3V0KQog
ewotCXJldHVybiByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdSh2bS0+cm9vdC5i
YXNlLmJvLT50Ym8ucmVzdiwKKwlyZXR1cm4gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91
dF9yY3Uodm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdiwKIAkJCQkJCSAgIHRydWUsIHRy
dWUsIHRpbWVvdXQpOwogfQogCkBAIC0yNzI0LDcgKzI3MjQsNyBAQCBpbnQgYW1kZ3B1X3ZtX2lu
aXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCWlm
IChyKQogCQlnb3RvIGVycm9yX2ZyZWVfcm9vdDsKIAotCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rf
cmVzZXJ2ZV9zaGFyZWQocm9vdC0+dGJvLnJlc3YsIDEpOworCXIgPSByZXNlcnZhdGlvbl9vYmpl
Y3RfcmVzZXJ2ZV9zaGFyZWQocm9vdC0+dGJvLmJhc2UucmVzdiwgMSk7CiAJaWYgKHIpCiAJCWdv
dG8gZXJyb3JfdW5yZXNlcnZlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfdm1fc2RtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3ZtX3NkbWEuYwppbmRleCBkZGQxODFmNWVkMzcuLjYxZmM1ODRjYmIxYSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCkBAIC03Miw3ICs3Miw3IEBAIHN0
YXRpYyBpbnQgYW1kZ3B1X3ZtX3NkbWFfcHJlcGFyZShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9w
YXJhbXMgKnAsCiAJaWYgKHIpCiAJCXJldHVybiByOwogCi0JciA9IGFtZGdwdV9zeW5jX3Jlc3Yo
cC0+YWRldiwgJnAtPmpvYi0+c3luYywgcm9vdC0+dGJvLnJlc3YsCisJciA9IGFtZGdwdV9zeW5j
X3Jlc3YocC0+YWRldiwgJnAtPmpvYi0+c3luYywgcm9vdC0+dGJvLmJhc2UucmVzdiwKIAkJCSAg
ICAgb3duZXIsIGZhbHNlKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYwppbmRleCA0YTI5ZjcyMzM0
ZDAuLjM4MWE1MzQ1ZjE5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2FtZGdwdV9kbS9hbWRncHVfZG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkv
YW1kZ3B1X2RtL2FtZGdwdV9kbS5jCkBAIC01NjkzLDcgKzU2OTMsNyBAQCBzdGF0aWMgdm9pZCBh
bWRncHVfZG1fY29tbWl0X3BsYW5lcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJ
CSAqIGRlYWRsb2NrIGR1cmluZyBHUFUgcmVzZXQgd2hlbiB0aGlzIGZlbmNlIHdpbGwgbm90IHNp
Z25hbAogCQkgKiBidXQgd2UgaG9sZCByZXNlcnZhdGlvbiBsb2NrIGZvciB0aGUgQk8uCiAJCSAq
LwotCQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYWJvLT50Ym8ucmVz
diwgdHJ1ZSwKKwkJciA9IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGFiby0+
dGJvLmJhc2UucmVzdiwgdHJ1ZSwKIAkJCQkJCQlmYWxzZSwKIAkJCQkJCQltc2Vjc190b19qaWZm
aWVzKDUwMDApKTsKIAkJaWYgKHVubGlrZWx5KHIgPD0gMCkpCi0tIAoyLjE4LjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
