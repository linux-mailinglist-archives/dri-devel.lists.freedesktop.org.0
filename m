Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 437D1D30A4
	for <lists+dri-devel@lfdr.de>; Thu, 10 Oct 2019 20:45:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F1D5C6E3B2;
	Thu, 10 Oct 2019 18:45:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x544.google.com (mail-pg1-x544.google.com
 [IPv6:2607:f8b0:4864:20::544])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F2F636E3B0
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Oct 2019 18:45:08 +0000 (UTC)
Received: by mail-pg1-x544.google.com with SMTP id t3so4213440pga.8
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Oct 2019 11:45:08 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=5O6RElBb3fr3LnSHnAwNtkOXzHjo9WXKBFgDybzMyFo=;
 b=BSWVwMuajmMtI9lA6kHjO0tsDEBgGGbPJOkunH/hS2ftreg5PedJ+75la3+KvsGJWL
 bbEiWXCKXeDduK1kjRG34u/AHFvgK3GdongzHcwEktG2V4u/fQ1EeARpT4O6Ovtzuop1
 V1znALd49L+DOK4ku0VQLtp7klfZVxbyS/73/nP8CufIJ1YuKsFtP4HnuNKKWoAKsXcE
 SMQaigViFkJa76y+Bmzyv8mxtuRK4LcUwRhdDhS66cTahFFXSr5FoQzHx7ebGOBNeTmM
 ufN6NJd+m+Le85EJDQPRG3+Y9uf4a/7hm+ZgatmZoqCh9xEgsFjUbDWwedrORmsyrYTL
 Ad7Q==
X-Gm-Message-State: APjAAAV7LYXrFRrYzquih7t5y/ovs+jMJ9xGG+7li/16z9UEbiL2CeXr
 nsCPw/BDYx8H+G7aJ4mUA8K4jg==
X-Google-Smtp-Source: APXvYqxBawLAr9XsFz+BOdObOzhO+bY2d8CsC74r8IRdfoqlNZIfAoUnivUIfttFdJCgc/jcMcx4qw==
X-Received: by 2002:a65:4649:: with SMTP id k9mr12424692pgr.139.1570733108172; 
 Thu, 10 Oct 2019 11:45:08 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 w65sm7541732pfb.106.2019.10.10.11.45.06
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 10 Oct 2019 11:45:07 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v11 2/5] dma-buf: heaps: Add heap helpers
Date: Thu, 10 Oct 2019 18:44:55 +0000
Message-Id: <20191010184458.51039-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191010184458.51039-1-john.stultz@linaro.org>
References: <20191010184458.51039-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=5O6RElBb3fr3LnSHnAwNtkOXzHjo9WXKBFgDybzMyFo=;
 b=iUGhtctc9DAPIjCJcGZFhK16TLXT7KLiEEYYDn94DCTv2XDExt3xHZWRB56G46pd9z
 EZlVm3bLYJ/dMHMbJCNX+uOa9LTn+L/8DNLkYNkYUzmMTuJVMOCSrplowRPbOsZ/G9+f
 oqhh4FOBSU8mxA5AYnZaBPdWTwf6BnnvkynNZVU91jC6QArs9paoCWEyniH7bkbHzxMH
 nqLFK4Ckgj4674IUuB+QwrpvIiKviHVC0fnLntK6XXr6z51/B+02Jj92VywwPnbcmGIO
 23eY7uFFxvbUBLHzrIFzyAahAPJiB+nM+4Ywd0FE6OvH0w0T4IygIrcuY+QCqUNKZHSn
 191w==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGdlbmVyaWMgaGVscGVyIGRtYWJ1ZiBvcHMgZm9yIGRtYSBoZWFwcywgc28gd2UgY2FuIHJl
ZHVjZQp0aGUgYW1vdW50IG9mIGR1cGxpY2F0aXZlIGNvZGUgZm9yIHRoZSBleHBvcnRlZCBkbWFi
dWZzLgoKVGhpcyBjb2RlIGlzIGFuIGV2b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVt
ZW50YXRpb24sIHNvCnRoYW5rcyB0byBpdHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50
ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBaYXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwg
YW5kIG90aGVycyEKCkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQg
U2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29k
ZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsgUGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNj
OiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5l
Zm9ydCA8VmluY2VudC5Eb25uZWZvcnRAYXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0
by5QYXVsQGFybS5jb20+CkNjOiBBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBDaHJp
c3RvcGggSGVsbHdpZyA8aGNoQGluZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8gRmVuZyA8ZmVuZ2NA
Z29vZ2xlLmNvbT4KQ2M6IEFsaXN0YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5AZ29vZ2xlLmNvbT4K
Q2M6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogSGlsbGYgRGFudG9u
IDxoZGFudG9uQHNpbmEuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpS
ZXZpZXdlZC1ieTogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdhaWduYXJkQGxpbmFyby5v
cmc+ClJldmlld2VkLWJ5OiBCcmlhbiBTdGFya2V5IDxicmlhbi5zdGFya2V5QGFybS5jb20+CkFj
a2VkLWJ5OiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KVGVzdGVkLWJ5OiBBeWFu
IEt1bWFyIEhhbGRlciA8YXlhbi5oYWxkZXJAYXJtLmNvbT4KU2lnbmVkLW9mZi1ieTogSm9obiBT
dHVsdHogPGpvaG4uc3R1bHR6QGxpbmFyby5vcmc+Ci0tLQp2MjoKKiBSZW1vdmVkIGNhY2hlIG1h
bmFnZW1lbnQgcGVyZm9ybWFuY2UgaGFjayB0aGF0IEkgaGFkCiAgYWNjaWRlbnRhbGx5IGZvbGRl
ZCBpbi4KKiBSZW1vdmVkIHN0YXRzIGNvZGUgdGhhdCB3YXMgaW4gaGVscGVycwoqIExvdHMgb2Yg
Y2hlY2twYXRjaCBjbGVhbnVwcwp2MzoKKiBVbmlubGluZSBJTklUX0hFQVBfSEVMUEVSX0JVRkZF
UiAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBTd2l0Y2ggdG8gV0FSTiBvbiBidWZmZXIgZGVz
dHJveSBmYWlsdXJlIChzdWdnZXN0ZWQgYnkgQnJpYW4pCiogYnVmZmVyLT5rbWFwX2NudCBkZWNy
ZW1lbnRpbmcgY2xlYW51cCAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBFeHRyYSBidWZmZXIt
PnZhZGRyIGNoZWNraW5nIGluIGRtYV9oZWFwX2RtYV9idWZfa21hcAogIChzdWdnZXN0ZWQgYnkg
QnJpYW4pCiogU3dpdGNoIHRvX2hlbHBlcl9idWZmZXIgZnJvbSBtYWNybyB0byBpbmxpbmUgZnVu
Y3Rpb24KICAoc3VnZ2VzdGVkIGJ5IEJlbmphbWluKQoqIFJlbmFtZSBrbWFwLT52bWFwIChmb2xk
ZWQgaW4gZnJvbSBBbmRyZXcpCiogVXNlIHZtYXAgZm9yIHZtYXBwaW5nIC0gbm90IGJlZ2luX2Nw
dV9hY2Nlc3MgKGZvbGRlZCBpbiBmcm9tCiAgQW5kcmV3KQoqIERyb3Aga21hcCBmb3Igbm93LCBh
cyBpdHMgb3B0aW9uYWwgKGZvbGRlZCBpbiBmcm9tIEFuZHJldykKKiBGb2xkIGRtYV9oZWFwX21h
cF91c2VyIGludG8gdGhlIHNpbmdsZSBjYWxsZXIgKGZvbGVkIGluIGZyb20KICBBbmRyZXcpCiog
Rm9sZGVkIGluIHBhdGNoIGZyb20gQW5kcmV3IHRvIHRyYWNrIHBhZ2UgbGlzdCBwZXIgaGVhcCBu
b3QKICBzZ2xpc3QsIHdoaWNoIHNpbXBsaWZpZXMgdGhlIHRyYWNraW5nIGxvZ2ljCnY0OgoqIE1v
dmVkIGRtYS1oZWFwLmggY2hhbmdlIG91dCB0byBwcmV2aW91cyBwYXRjaAp2NjoKKiBNaW5vciBj
bGVhbnVwcyBhbmQgdHlwbyBmaXhlcyBzdWdnZXN0ZWQgYnkgQnJpYW4Kdjc6CiogUmVtb3ZlZCBz
dHJheSA7CiogTWFrZSBpbml0X2hlYXBfaGVscGVyX2J1ZmZlciBsb3dlcmNhc2UsIGFzIHN1Z2dl
c3RlZCBieSBDaHJpc3RvcGgKKiBBZGQgZG1hYnVmIGV4cG9ydCBoZWxwZXIgdG8gcmVkdWNlIGJv
aWxlcnBsYXRlIGNvZGUKdjg6CiogUmVtb3ZlIHVudXNlZCBwcml2YXRlX2ZsYWdzIHZhbHVlCiog
Q29uZGVuc2UgZG1hX2hlYXBfYnVmZmVyIGFuZCBoZWFwX2hlbHBlcl9idWZmZXIgKHN1Z2dlc3Rl
ZCBieQogIENocmlzdG9waCkKKiBGaXggaW5kZW50YXRpb24gYnkgdXNpbmcgc2hvcnRlciBhcmd1
bWVudCBuYW1lcyAoc3VnZ2VzdGVkIGJ5CiAgQ2hyaXN0b3BoKQoqIEFkZCBmbHVzaF9rZXJuZWxf
dm1hcF9yYW5nZS9pbnZhbGlkYXRlX2tlcm5lbF92bWFwX3JhbmdlIGNhbGxzCiAgKHN1Z2dlc3Rl
ZCBieSBDaHJpc3RvcGgpCiogQ2hlY2twYXRjaCB3aGl0ZXNwYWNlIGZpeHVwcwp2OToKKiBNaW5v
ciBjbGVhbnVwcyBzdWdnZXN0ZWQgYnkgQnJpYW4gU3RhcmtleQp2MTA6CiogRml4IG1pc3Npbmcg
dm1hbGxvYy5oIGluY2x1c2lvbiBpbiBoZWFwIGhlbHBlcnMgKGZvdW5kIGJ5CiAga2J1aWxkIHRl
c3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+KQotLS0KIGRyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSAg
ICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgICAgICAg
fCAgIDIgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jIHwgMjY3ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVy
cy5oIHwgIDU1ICsrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAzMjUgaW5zZXJ0aW9ucygrKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuaAoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQpp
bmRleCBjYWVlNWViM2QzNTEuLjljMTkwMDI2YmZhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEt
YnVmL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQpAQCAtMiw2ICsyLDcg
QEAKIG9iai15IDo9IGRtYS1idWYubyBkbWEtZmVuY2UubyBkbWEtZmVuY2UtYXJyYXkubyBkbWEt
ZmVuY2UtY2hhaW4ubyBcCiAJIGRtYS1yZXN2Lm8gc2Vxbm8tZmVuY2Uubwogb2JqLSQoQ09ORklH
X0RNQUJVRl9IRUFQUykJKz0gZG1hLWhlYXAubworb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQUykJ
Kz0gaGVhcHMvCiBvYmotJChDT05GSUdfU1lOQ19GSUxFKQkJKz0gc3luY19maWxlLm8KIG9iai0k
KENPTkZJR19TV19TWU5DKQkJKz0gc3dfc3luYy5vIHN5bmNfZGVidWcubwogb2JqLSQoQ09ORklH
X1VETUFCVUYpCQkrPSB1ZG1hYnVmLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFw
cy9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmRlNDk4OTgxMTJkYgotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMCwwICsxLDIgQEAKKyMgU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKK29iai15CQkJCQkrPSBoZWFwLWhlbHBlcnMu
bwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jIGIvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uZDljZDM5MzExYTY5Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCkBAIC0wLDAgKzEsMjY3IEBACisvLyBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgor
I2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNs
dWRlIDxsaW51eC9oaWdobWVtLmg+CisjaW5jbHVkZSA8bGludXgvaWRyLmg+CisjaW5jbHVkZSA8
bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRlIDxsaW51eC91
YWNjZXNzLmg+CisjaW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgorI2luY2x1ZGUgPHVhcGkvbGlu
dXgvZG1hLWhlYXAuaD4KKyNpbmNsdWRlICJoZWFwLWhlbHBlcnMuaCIKKwordm9pZCBpbml0X2hl
YXBfaGVscGVyX2J1ZmZlcihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIsCisJCQkg
ICAgIHZvaWQgKCpmcmVlKShzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICopKQoreworCWJ1ZmZl
ci0+cHJpdl92aXJ0ID0gTlVMTDsKKwltdXRleF9pbml0KCZidWZmZXItPmxvY2spOworCWJ1ZmZl
ci0+dm1hcF9jbnQgPSAwOworCWJ1ZmZlci0+dmFkZHIgPSBOVUxMOworCWJ1ZmZlci0+cGFnZWNv
dW50ID0gMDsKKwlidWZmZXItPnBhZ2VzID0gTlVMTDsKKwlJTklUX0xJU1RfSEVBRCgmYnVmZmVy
LT5hdHRhY2htZW50cyk7CisJYnVmZmVyLT5mcmVlID0gZnJlZTsKK30KKworc3RydWN0IGRtYV9i
dWYgKmhlYXBfaGVscGVyX2V4cG9ydF9kbWFidWYoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyLAorCQkJCQkgIGludCBmZF9mbGFncykKK3sKKwlERUZJTkVfRE1BX0JVRl9FWFBPUlRf
SU5GTyhleHBfaW5mbyk7CisKKwlleHBfaW5mby5vcHMgPSAmaGVhcF9oZWxwZXJfb3BzOworCWV4
cF9pbmZvLnNpemUgPSBidWZmZXItPnNpemU7CisJZXhwX2luZm8uZmxhZ3MgPSBmZF9mbGFnczsK
KwlleHBfaW5mby5wcml2ID0gYnVmZmVyOworCisJcmV0dXJuIGRtYV9idWZfZXhwb3J0KCZleHBf
aW5mbyk7Cit9CisKK3N0YXRpYyB2b2lkICpkbWFfaGVhcF9tYXBfa2VybmVsKHN0cnVjdCBoZWFw
X2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwl2b2lkICp2YWRkcjsKKworCXZhZGRyID0gdm1h
cChidWZmZXItPnBhZ2VzLCBidWZmZXItPnBhZ2Vjb3VudCwgVk1fTUFQLCBQQUdFX0tFUk5FTCk7
CisJaWYgKCF2YWRkcikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlyZXR1cm4gdmFk
ZHI7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFwX2J1ZmZlcl9kZXN0cm95KHN0cnVjdCBoZWFw
X2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwlpZiAoYnVmZmVyLT52bWFwX2NudCA+IDApIHsK
KwkJV0FSTigiJXM6IGJ1ZmZlciBzdGlsbCBtYXBwZWQgaW4gdGhlIGtlcm5lbFxuIiwgX19mdW5j
X18pOworCQl2dW5tYXAoYnVmZmVyLT52YWRkcik7CisJfQorCisJYnVmZmVyLT5mcmVlKGJ1ZmZl
cik7Cit9CisKK3N0YXRpYyB2b2lkICpkbWFfaGVhcF9idWZmZXJfdm1hcF9nZXQoc3RydWN0IGhl
YXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXZvaWQgKnZhZGRyOworCisJaWYgKGJ1ZmZl
ci0+dm1hcF9jbnQpIHsKKwkJYnVmZmVyLT52bWFwX2NudCsrOworCQlyZXR1cm4gYnVmZmVyLT52
YWRkcjsKKwl9CisJdmFkZHIgPSBkbWFfaGVhcF9tYXBfa2VybmVsKGJ1ZmZlcik7CisJaWYgKElT
X0VSUih2YWRkcikpCisJCXJldHVybiB2YWRkcjsKKwlidWZmZXItPnZhZGRyID0gdmFkZHI7CisJ
YnVmZmVyLT52bWFwX2NudCsrOworCXJldHVybiB2YWRkcjsKK30KKworc3RhdGljIHZvaWQgZG1h
X2hlYXBfYnVmZmVyX3ZtYXBfcHV0KHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikK
K3sKKwlpZiAoIS0tYnVmZmVyLT52bWFwX2NudCkgeworCQl2dW5tYXAoYnVmZmVyLT52YWRkcik7
CisJCWJ1ZmZlci0+dmFkZHIgPSBOVUxMOworCX0KK30KKworc3RydWN0IGRtYV9oZWFwc19hdHRh
Y2htZW50IHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJc3RydWN0IHNnX3RhYmxlIHRhYmxlOwor
CXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKK307CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBfYXR0YWNo
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkgICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50
ICphdHRhY2htZW50KQoreworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVudCAqYTsKKwlzdHJ1
Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJaW50IHJldDsK
KworCWEgPSBremFsbG9jKHNpemVvZigqYSksIEdGUF9LRVJORUwpOworCWlmICghYSkKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlyZXQgPSBzZ19hbGxvY190YWJsZV9mcm9tX3BhZ2VzKCZhLT50YWJs
ZSwgYnVmZmVyLT5wYWdlcywKKwkJCQkJYnVmZmVyLT5wYWdlY291bnQsIDAsCisJCQkJCWJ1ZmZl
ci0+cGFnZWNvdW50IDw8IFBBR0VfU0hJRlQsCisJCQkJCUdGUF9LRVJORUwpOworCWlmIChyZXQp
IHsKKwkJa2ZyZWUoYSk7CisJCXJldHVybiByZXQ7CisJfQorCisJYS0+ZGV2ID0gYXR0YWNobWVu
dC0+ZGV2OworCUlOSVRfTElTVF9IRUFEKCZhLT5saXN0KTsKKworCWF0dGFjaG1lbnQtPnByaXYg
PSBhOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwlsaXN0X2FkZCgmYS0+bGlzdCwg
JmJ1ZmZlci0+YXR0YWNobWVudHMpOworCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9kZXRhY2goc3RydWN0IGRtYV9i
dWYgKmRtYWJ1ZiwKKwkJCSAgICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50
KQoreworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVudCAqYSA9IGF0dGFjaG1lbnQtPnByaXY7
CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJ
bXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwlsaXN0X2RlbCgmYS0+bGlzdCk7CisJbXV0ZXhf
dW5sb2NrKCZidWZmZXItPmxvY2spOworCisJc2dfZnJlZV90YWJsZSgmYS0+dGFibGUpOworCWtm
cmVlKGEpOworfQorCitzdGF0aWMKK3N0cnVjdCBzZ190YWJsZSAqZG1hX2hlYXBfbWFwX2RtYV9i
dWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCwKKwkJCQkgICAgICBlbnVt
IGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJc3RydWN0IGRtYV9oZWFwc19hdHRh
Y2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOwor
CisJdGFibGUgPSAmYS0+dGFibGU7CisKKwlpZiAoIWRtYV9tYXBfc2coYXR0YWNobWVudC0+ZGV2
LCB0YWJsZS0+c2dsLCB0YWJsZS0+bmVudHMsCisJCQlkaXJlY3Rpb24pKQorCQl0YWJsZSA9IEVS
Ul9QVFIoLUVOT01FTSk7CisJcmV0dXJuIHRhYmxlOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVh
cF91bm1hcF9kbWFfYnVmKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQsCisJ
CQkJICAgc3RydWN0IHNnX3RhYmxlICp0YWJsZSwKKwkJCQkgICBlbnVtIGRtYV9kYXRhX2RpcmVj
dGlvbiBkaXJlY3Rpb24pCit7CisJZG1hX3VubWFwX3NnKGF0dGFjaG1lbnQtPmRldiwgdGFibGUt
PnNnbCwgdGFibGUtPm5lbnRzLCBkaXJlY3Rpb24pOworfQorCitzdGF0aWMgdm1fZmF1bHRfdCBk
bWFfaGVhcF92bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKK3sKKwlzdHJ1Y3Qgdm1fYXJl
YV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1
ZmZlciA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOworCisJdm1mLT5wYWdlID0gYnVmZmVyLT5wYWdl
c1t2bWYtPnBnb2ZmXTsKKwlnZXRfcGFnZSh2bWYtPnBhZ2UpOworCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBjb25zdCBzdHJ1Y3Qgdm1fb3BlcmF0aW9uc19zdHJ1Y3QgZG1hX2hlYXBfdm1fb3Bz
ID0geworCS5mYXVsdCA9IGRtYV9oZWFwX3ZtX2ZhdWx0LAorfTsKKworc3RhdGljIGludCBkbWFf
aGVhcF9tbWFwKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
dm1hKQoreworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJp
djsKKworCWlmICgodm1hLT52bV9mbGFncyAmIChWTV9TSEFSRUQgfCBWTV9NQVlTSEFSRSkpID09
IDApCisJCXJldHVybiAtRUlOVkFMOworCisJdm1hLT52bV9vcHMgPSAmZG1hX2hlYXBfdm1fb3Bz
OworCXZtYS0+dm1fcHJpdmF0ZV9kYXRhID0gYnVmZmVyOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyB2b2lkIGRtYV9oZWFwX2RtYV9idWZfcmVsZWFzZShzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
KQoreworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsK
KworCWRtYV9oZWFwX2J1ZmZlcl9kZXN0cm95KGJ1ZmZlcik7Cit9CisKK3N0YXRpYyBpbnQgZG1h
X2hlYXBfZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJ
CQkJCSAgICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQoreworCXN0cnVjdCBo
ZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgZG1hX2hl
YXBzX2F0dGFjaG1lbnQgKmE7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZidWZmZXIt
PmxvY2spOworCisJaWYgKGJ1ZmZlci0+dm1hcF9jbnQpCisJCWludmFsaWRhdGVfa2VybmVsX3Zt
YXBfcmFuZ2UoYnVmZmVyLT52YWRkciwgYnVmZmVyLT5zaXplKTsKKworCWxpc3RfZm9yX2VhY2hf
ZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMsIGxpc3QpIHsKKwkJZG1hX3N5bmNfc2dfZm9y
X2NwdShhLT5kZXYsIGEtPnRhYmxlLnNnbCwgYS0+dGFibGUubmVudHMsCisJCQkJICAgIGRpcmVj
dGlvbik7CisJfQorCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKworCXJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBfZG1hX2J1Zl9lbmRfY3B1X2FjY2VzcyhzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hYnVmLAorCQkJCQkgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rp
b24pCit7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2
OworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVudCAqYTsKKworCW11dGV4X2xvY2soJmJ1ZmZl
ci0+bG9jayk7CisKKwlpZiAoYnVmZmVyLT52bWFwX2NudCkKKwkJZmx1c2hfa2VybmVsX3ZtYXBf
cmFuZ2UoYnVmZmVyLT52YWRkciwgYnVmZmVyLT5zaXplKTsKKworCWxpc3RfZm9yX2VhY2hfZW50
cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMsIGxpc3QpIHsKKwkJZG1hX3N5bmNfc2dfZm9yX2Rl
dmljZShhLT5kZXYsIGEtPnRhYmxlLnNnbCwgYS0+dGFibGUubmVudHMsCisJCQkJICAgICAgIGRp
cmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgdm9pZCAqZG1hX2hlYXBfZG1hX2J1Zl92bWFwKHN0cnVjdCBkbWFfYnVm
ICpkbWFidWYpCit7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVm
LT5wcml2OworCXZvaWQgKnZhZGRyOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwl2
YWRkciA9IGRtYV9oZWFwX2J1ZmZlcl92bWFwX2dldChidWZmZXIpOworCW11dGV4X3VubG9jaygm
YnVmZmVyLT5sb2NrKTsKKworCXJldHVybiB2YWRkcjsKK30KKworc3RhdGljIHZvaWQgZG1hX2hl
YXBfZG1hX2J1Zl92dW5tYXAoc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgdm9pZCAqdmFkZHIpCit7
CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJ
bXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKwlkbWFfaGVhcF9idWZmZXJfdm1hcF9wdXQoYnVm
ZmVyKTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7Cit9CisKK2NvbnN0IHN0cnVjdCBk
bWFfYnVmX29wcyBoZWFwX2hlbHBlcl9vcHMgPSB7CisJLm1hcF9kbWFfYnVmID0gZG1hX2hlYXBf
bWFwX2RtYV9idWYsCisJLnVubWFwX2RtYV9idWYgPSBkbWFfaGVhcF91bm1hcF9kbWFfYnVmLAor
CS5tbWFwID0gZG1hX2hlYXBfbW1hcCwKKwkucmVsZWFzZSA9IGRtYV9oZWFwX2RtYV9idWZfcmVs
ZWFzZSwKKwkuYXR0YWNoID0gZG1hX2hlYXBfYXR0YWNoLAorCS5kZXRhY2ggPSBkbWFfaGVhcF9k
ZXRhY2gsCisJLmJlZ2luX2NwdV9hY2Nlc3MgPSBkbWFfaGVhcF9kbWFfYnVmX2JlZ2luX2NwdV9h
Y2Nlc3MsCisJLmVuZF9jcHVfYWNjZXNzID0gZG1hX2hlYXBfZG1hX2J1Zl9lbmRfY3B1X2FjY2Vz
cywKKwkudm1hcCA9IGRtYV9oZWFwX2RtYV9idWZfdm1hcCwKKwkudnVubWFwID0gZG1hX2hlYXBf
ZG1hX2J1Zl92dW5tYXAsCit9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hl
YXAtaGVscGVycy5oIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5oCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOTExYzkzMWY3ZjA2Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5oCkBAIC0wLDAg
KzEsNTUgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovCisvKgorICog
RE1BQlVGIEhlYXBzIGhlbHBlciBjb2RlCisgKgorICogQ29weXJpZ2h0IChDKSAyMDExIEdvb2ds
ZSwgSW5jLgorICogQ29weXJpZ2h0IChDKSAyMDE5IExpbmFybyBMdGQuCisgKi8KKworI2lmbmRl
ZiBfSEVBUF9IRUxQRVJTX0gKKyNkZWZpbmUgX0hFQVBfSEVMUEVSU19ICisKKyNpbmNsdWRlIDxs
aW51eC9kbWEtaGVhcC5oPgorI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKworLyoqCisgKiBzdHJ1
Y3QgaGVhcF9oZWxwZXJfYnVmZmVyIC0gaGVscGVyIGJ1ZmZlciBtZXRhZGF0YQorICogQGhlYXA6
CQliYWNrIHBvaW50ZXIgdG8gdGhlIGhlYXAgdGhlIGJ1ZmZlciBjYW1lIGZyb20KKyAqIEBkbWFi
dWY6CQliYWNraW5nIGRtYS1idWYgZm9yIHRoaXMgYnVmZmVyCisgKiBAc2l6ZToJCXNpemUgb2Yg
dGhlIGJ1ZmZlcgorICogQGZsYWdzOgkJYnVmZmVyIHNwZWNpZmljIGZsYWdzCisgKiBAcHJpdl92
aXJ0CQlwb2ludGVyIHRvIGhlYXAgc3BlY2lmaWMgcHJpdmF0ZSB2YWx1ZQorICogQGxvY2sJCW11
dGV4dCB0byBwcm90ZWN0IHRoZSBkYXRhIGluIHRoaXMgc3RydWN0dXJlCisgKiBAdm1hcF9jbnQJ
CWNvdW50IG9mIHZtYXAgcmVmZXJlbmNlcyBvbiB0aGUgYnVmZmVyCisgKiBAdmFkZHIJCXZtYXAn
ZWQgdmlydHVhbCBhZGRyZXNzCisgKiBAcGFnZWNvdW50CQludW1iZXIgb2YgcGFnZXMgaW4gdGhl
IGJ1ZmZlcgorICogQHBhZ2VzCQlsaXN0IG9mIHBhZ2UgcG9pbnRlcnMKKyAqIEBhdHRhY2htZW50
cwkJbGlzdCBvZiBkZXZpY2UgYXR0YWNobWVudHMKKyAqCisgKiBAZnJlZQkJaGVhcCBjYWxsYmFj
ayB0byBmcmVlIHRoZSBidWZmZXIKKyAqLworc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciB7CisJ
c3RydWN0IGRtYV9oZWFwICpoZWFwOworCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7CisJc2l6ZV90
IHNpemU7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCXZvaWQgKnByaXZfdmlydDsKKwlzdHJ1
Y3QgbXV0ZXggbG9jazsKKwlpbnQgdm1hcF9jbnQ7CisJdm9pZCAqdmFkZHI7CisJcGdvZmZfdCBw
YWdlY291bnQ7CisJc3RydWN0IHBhZ2UgKipwYWdlczsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGF0dGFj
aG1lbnRzOworCisJdm9pZCAoKmZyZWUpKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZl
cik7Cit9OworCit2b2lkIGluaXRfaGVhcF9oZWxwZXJfYnVmZmVyKHN0cnVjdCBoZWFwX2hlbHBl
cl9idWZmZXIgKmJ1ZmZlciwKKwkJCSAgICAgdm9pZCAoKmZyZWUpKHN0cnVjdCBoZWFwX2hlbHBl
cl9idWZmZXIgKikpOworCitzdHJ1Y3QgZG1hX2J1ZiAqaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1
ZihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIsCisJCQkJCSAgaW50IGZkX2ZsYWdz
KTsKKworZXh0ZXJuIGNvbnN0IHN0cnVjdCBkbWFfYnVmX29wcyBoZWFwX2hlbHBlcl9vcHM7Cisj
ZW5kaWYgLyogX0hFQVBfSEVMUEVSU19IICovCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
