Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6B89FBB034
	for <lists+dri-devel@lfdr.de>; Mon, 23 Sep 2019 11:03:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 91D4B6E264;
	Mon, 23 Sep 2019 09:03:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x44a.google.com (mail-pf1-x44a.google.com
 [IPv6:2607:f8b0:4864:20::44a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 44C0E6E264
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Sep 2019 09:03:01 +0000 (UTC)
Received: by mail-pf1-x44a.google.com with SMTP id z13so9687248pfr.15
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Sep 2019 02:03:01 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=Y0xYR4PS86ooH7AKhBWD3EqeH7toUpR236CnccW5V4s=;
 b=n1De01cuc1ys4KU4MSEMbH9h3vPfjSsPk3ju7+IaI4l/CapYbl4QYIbow0b+Tvw5+1
 eAEiTh1kpn/A3hkE4yURk7mGp5BVw98HPa6g0riStb0JS+0jQXYpybI4aqPKrxbv90Sa
 oJoc9v5vG2sVZfpz90nS7t8/1Tzeacpyilrw63z+tVOITMASfnVhJvAJf64Izlz9Y7I6
 64cLNAwh6ydw4Kzjzbc16O3ecwsHokADpBaXeC0ztc30JLZ3Ly/Trm91aR3uncooPGIn
 MZTgcf0OlUMBBPeDklt14KyEBN+59infPuMe5RhL+0yyN2JGY5+9weaIFHKTOhtVVg70
 HoMw==
X-Gm-Message-State: APjAAAWxZcLsZ+BoLiZEOXTY18+4wu9sfWl/bGd6aSYD7fF+gHpcuVTl
 Zti4BxZ8dIHDjIN8Msoq+An/gJd+PmtHUCHrQcNYiw==
X-Google-Smtp-Source: APXvYqyphZ2c5TL8furEo/u2q2XWdIdLbG7CqU4NZLnsoi0zVU8KhQyJWoT3rVfA/7AUysLERHdhO9MOGZvTMr7MiC0wWw==
X-Received: by 2002:a63:d05:: with SMTP id c5mr1960342pgl.182.1569229380324;
 Mon, 23 Sep 2019 02:03:00 -0700 (PDT)
Date: Mon, 23 Sep 2019 02:02:32 -0700
In-Reply-To: <20190923090249.127984-1-brendanhiggins@google.com>
Message-Id: <20190923090249.127984-3-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190923090249.127984-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.23.0.351.gc4317032e6-goog
Subject: [PATCH v18 02/19] kunit: test: add test resource management API
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, jpoimboe@redhat.com, 
 keescook@google.com, kieran.bingham@ideasonboard.com, mcgrof@kernel.org, 
 peterz@infradead.org, robh@kernel.org, sboyd@kernel.org, shuah@kernel.org, 
 tytso@mit.edu, yamada.masahiro@socionext.com
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=Y0xYR4PS86ooH7AKhBWD3EqeH7toUpR236CnccW5V4s=;
 b=VvwMLKE6G1zaJ04PLur9JkYbVisJuTINbc/DHhm4KYbI45SW+yaF50pq/2iQqotMXy
 pNmeX0AAslEDhYgRYm0wMcw6kCvyCltEdoeWkzTqnzKYIbzd3liBFsU6yUBavz9JRQft
 NjZJXOgEGkvYb9C+8xppW+bAJpQ+BlUYUXQ+FDBrTgjTkgG4fHjYQt7NXcIqjfy8hMIq
 I7o1UScL/H3tVWztkGl++NVI+4BR88bOn6XKk2sayFYwn+7uinjZP7aVAUYeN2kN8LpY
 qZZK+Zpvjd/zJD8SrgfOQFHyJS61LZ98NgYRC69U8qx/rfAE8et/RHvbBRAkbzc7Zxis
 TBgQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, kunit-dev@googlegroups.com,
 richard@nod.at, torvalds@linux-foundation.org, rdunlap@infradead.org,
 linux-kernel@vger.kernel.org, mpe@ellerman.id.au,
 linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIGEgY29tbW9uIEFQSSBmb3IgdGVzdCBtYW5hZ2VkIHJlc291cmNlcyBsaWtlIG1lbW9y
eSBhbmQgdGVzdApvYmplY3RzLiBBIGxvdCBvZiB0aW1lcyBhIHRlc3Qgd2lsbCB3YW50IHRvIHNl
dCB1cCBpbmZyYXN0cnVjdHVyZSB0byBiZQp1c2VkIGluIHRlc3QgY2FzZXM7IHRoaXMgY291bGQg
YmUgYW55dGhpbmcgZnJvbSBqdXN0IHdhbnRpbmcgdG8gYWxsb2NhdGUKc29tZSBtZW1vcnkgdG8g
c2V0dGluZyB1cCBhIGRyaXZlciBzdGFjazsgdGhpcyBkZWZpbmVzIGZhY2lsaXRpZXMgZm9yCmNy
ZWF0aW5nICJ0ZXN0IHJlc291cmNlcyIgd2hpY2ggYXJlIG1hbmFnZWQgYnkgdGhlIHRlc3QgaW5m
cmFzdHJ1Y3R1cmUKYW5kIGFyZSBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYXQgdGhlIGNvbmNs
dXNpb24gb2YgdGhlIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBCcmVuZGFuIEhpZ2dpbnMgPGJyZW5k
YW5oaWdnaW5zQGdvb2dsZS5jb20+ClJldmlld2VkLWJ5OiBHcmVnIEtyb2FoLUhhcnRtYW4gPGdy
ZWdraEBsaW51eGZvdW5kYXRpb24ub3JnPgpSZXZpZXdlZC1ieTogTG9nYW4gR3VudGhvcnBlIDxs
b2dhbmdAZGVsdGF0ZWUuY29tPgpSZXZpZXdlZC1ieTogU3RlcGhlbiBCb3lkIDxzYm95ZEBrZXJu
ZWwub3JnPgotLS0KIGluY2x1ZGUva3VuaXQvdGVzdC5oIHwgMTg3ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysKIGxpYi9rdW5pdC90ZXN0LmMgICAgIHwgMTYzICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgMzUw
IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2t1bml0L3Rlc3QuaCBiL2luY2x1
ZGUva3VuaXQvdGVzdC5oCmluZGV4IGUzMGQxYmYyZmI2OC4uNjc4MWM3NTZmMTFiIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2t1bml0L3Rlc3QuaAorKysgYi9pbmNsdWRlL2t1bml0L3Rlc3QuaApAQCAt
OSw4ICs5LDcyIEBACiAjaWZuZGVmIF9LVU5JVF9URVNUX0gKICNkZWZpbmUgX0tVTklUX1RFU1Rf
SAogCisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAK
K3N0cnVjdCBrdW5pdF9yZXNvdXJjZTsKKwordHlwZWRlZiBpbnQgKCprdW5pdF9yZXNvdXJjZV9p
bml0X3QpKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqLCB2b2lkICopOwordHlwZWRlZiB2b2lkICgq
a3VuaXRfcmVzb3VyY2VfZnJlZV90KShzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKik7CisKKy8qKgor
ICogc3RydWN0IGt1bml0X3Jlc291cmNlIC0gcmVwcmVzZW50cyBhICp0ZXN0IG1hbmFnZWQgcmVz
b3VyY2UqCisgKiBAYWxsb2NhdGlvbjogZm9yIHRoZSB1c2VyIHRvIHN0b3JlIGFyYml0cmFyeSBk
YXRhLgorICogQGZyZWU6IGEgdXNlciBzdXBwbGllZCBmdW5jdGlvbiB0byBmcmVlIHRoZSByZXNv
dXJjZS4gUG9wdWxhdGVkIGJ5CisgKiBrdW5pdF9hbGxvY19yZXNvdXJjZSgpLgorICoKKyAqIFJl
cHJlc2VudHMgYSAqdGVzdCBtYW5hZ2VkIHJlc291cmNlKiwgYSByZXNvdXJjZSB3aGljaCB3aWxs
IGF1dG9tYXRpY2FsbHkgYmUKKyAqIGNsZWFuZWQgdXAgYXQgdGhlIGVuZCBvZiBhIHRlc3QgY2Fz
ZS4KKyAqCisgKiBFeGFtcGxlOgorICoKKyAqIC4uIGNvZGUtYmxvY2s6OiBjCisgKgorICoJc3Ry
dWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHsKKyAqCQlzaXplX3Qgc2l6ZTsKKyAqCQlnZnBfdCBn
ZnA7CisgKgl9OworICoKKyAqCXN0YXRpYyBpbnQga3VuaXRfa21hbGxvY19pbml0KHN0cnVjdCBr
dW5pdF9yZXNvdXJjZSAqcmVzLCB2b2lkICpjb250ZXh0KQorICoJeworICoJCXN0cnVjdCBrdW5p
dF9rbWFsbG9jX3BhcmFtcyAqcGFyYW1zID0gY29udGV4dDsKKyAqCQlyZXMtPmFsbG9jYXRpb24g
PSBrbWFsbG9jKHBhcmFtcy0+c2l6ZSwgcGFyYW1zLT5nZnApOworICoKKyAqCQlpZiAoIXJlcy0+
YWxsb2NhdGlvbikKKyAqCQkJcmV0dXJuIC1FTk9NRU07CisgKgorICoJCXJldHVybiAwOworICoJ
fQorICoKKyAqCXN0YXRpYyB2b2lkIGt1bml0X2ttYWxsb2NfZnJlZShzdHJ1Y3Qga3VuaXRfcmVz
b3VyY2UgKnJlcykKKyAqCXsKKyAqCQlrZnJlZShyZXMtPmFsbG9jYXRpb24pOworICoJfQorICoK
KyAqCXZvaWQgKmt1bml0X2ttYWxsb2Moc3RydWN0IGt1bml0ICp0ZXN0LCBzaXplX3Qgc2l6ZSwg
Z2ZwX3QgZ2ZwKQorICoJeworICoJCXN0cnVjdCBrdW5pdF9rbWFsbG9jX3BhcmFtcyBwYXJhbXM7
CisgKgkJc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXM7CisgKgorICoJCXBhcmFtcy5zaXplID0g
c2l6ZTsKKyAqCQlwYXJhbXMuZ2ZwID0gZ2ZwOworICoKKyAqCQlyZXMgPSBrdW5pdF9hbGxvY19y
ZXNvdXJjZSh0ZXN0LCBrdW5pdF9rbWFsbG9jX2luaXQsCisgKgkJCWt1bml0X2ttYWxsb2NfZnJl
ZSwgJnBhcmFtcyk7CisgKgkJaWYgKHJlcykKKyAqCQkJcmV0dXJuIHJlcy0+YWxsb2NhdGlvbjsK
KyAqCisgKgkJcmV0dXJuIE5VTEw7CisgKgl9CisgKi8KK3N0cnVjdCBrdW5pdF9yZXNvdXJjZSB7
CisJdm9pZCAqYWxsb2NhdGlvbjsKKwlrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZTsKKworCS8q
IHByaXZhdGU6IGludGVybmFsIHVzZSBvbmx5LiAqLworCXN0cnVjdCBsaXN0X2hlYWQgbm9kZTsK
K307CisKIHN0cnVjdCBrdW5pdDsKIAogLyoqCkBAIC0xMTQsNiArMTc4LDEzIEBAIHN0cnVjdCBr
dW5pdCB7CiAJICogd2l0aCB0aGUgdGVzdCBjYXNlIGhhdmUgdGVybWluYXRlZC4KIAkgKi8KIAli
b29sIHN1Y2Nlc3M7IC8qIFJlYWQgb25seSBhZnRlciB0ZXN0X2Nhc2UgZmluaXNoZXMhICovCisJ
c3BpbmxvY2tfdCBsb2NrOyAvKiBHdWFyZHMgYWxsIG11dGFibGUgdGVzdCBzdGF0ZS4gKi8KKwkv
KgorCSAqIEJlY2F1c2UgcmVzb3VyY2VzIGlzIGEgbGlzdCB0aGF0IG1heSBiZSB1cGRhdGVkIG11
bHRpcGxlIHRpbWVzICh3aXRoCisJICogbmV3IHJlc291cmNlcykgZnJvbSBhbnkgdGhyZWFkIGFz
c29jaWF0ZWQgd2l0aCBhIHRlc3QgY2FzZSwgd2UgbXVzdAorCSAqIHByb3RlY3QgaXQgd2l0aCBz
b21lIHR5cGUgb2YgbG9jay4KKwkgKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIHJlc291cmNlczsgLyog
UHJvdGVjdGVkIGJ5IGxvY2suICovCiB9OwogCiB2b2lkIGt1bml0X2luaXRfdGVzdChzdHJ1Y3Qg
a3VuaXQgKnRlc3QsIGNvbnN0IGNoYXIgKm5hbWUpOwpAQCAtMTQ3LDYgKzIxOCwxMjIgQEAgaW50
IGt1bml0X3J1bl90ZXN0cyhzdHJ1Y3Qga3VuaXRfc3VpdGUgKnN1aXRlKTsKIAl9CQkJCQkJCQkg
ICAgICAgXAogCWxhdGVfaW5pdGNhbGwoa3VuaXRfc3VpdGVfaW5pdCMjc3VpdGUpCiAKKy8qCisg
KiBMaWtlIGt1bml0X2FsbG9jX3Jlc291cmNlKCkgYmVsb3csIGJ1dCByZXR1cm5zIHRoZSBzdHJ1
Y3Qga3VuaXRfcmVzb3VyY2UKKyAqIG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZSBhbGxvY2F0aW9u
LiBUaGlzIGlzIG1vc3RseSBmb3IgdGVzdGluZyBwdXJwb3Nlcy4KKyAqLworc3RydWN0IGt1bml0
X3Jlc291cmNlICprdW5pdF9hbGxvY19hbmRfZ2V0X3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVz
dCwKKwkJCQkJCSAgICBrdW5pdF9yZXNvdXJjZV9pbml0X3QgaW5pdCwKKwkJCQkJCSAgICBrdW5p
dF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJCQkJCSAgICBnZnBfdCBpbnRlcm5hbF9nZnAsCisJ
CQkJCQkgICAgdm9pZCAqY29udGV4dCk7CisKKy8qKgorICoga3VuaXRfYWxsb2NfcmVzb3VyY2Uo
KSAtIEFsbG9jYXRlcyBhICp0ZXN0IG1hbmFnZWQgcmVzb3VyY2UqLgorICogQHRlc3Q6IFRoZSB0
ZXN0IGNvbnRleHQgb2JqZWN0LgorICogQGluaXQ6IGEgdXNlciBzdXBwbGllZCBmdW5jdGlvbiB0
byBpbml0aWFsaXplIHRoZSByZXNvdXJjZS4KKyAqIEBmcmVlOiBhIHVzZXIgc3VwcGxpZWQgZnVu
Y3Rpb24gdG8gZnJlZSB0aGUgcmVzb3VyY2UuCisgKiBAaW50ZXJuYWxfZ2ZwOiBnZnAgdG8gdXNl
IGZvciBpbnRlcm5hbCBhbGxvY2F0aW9ucywgaWYgdW5zdXJlLCB1c2UgR0ZQX0tFUk5FTAorICog
QGNvbnRleHQ6IGZvciB0aGUgdXNlciB0byBwYXNzIGluIGFyYml0cmFyeSBkYXRhIHRvIHRoZSBp
bml0IGZ1bmN0aW9uLgorICoKKyAqIEFsbG9jYXRlcyBhICp0ZXN0IG1hbmFnZWQgcmVzb3VyY2Uq
LCBhIHJlc291cmNlIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBiZQorICogY2xlYW5lZCB1cCBh
dCB0aGUgZW5kIG9mIGEgdGVzdCBjYXNlLiBTZWUgJnN0cnVjdCBrdW5pdF9yZXNvdXJjZSBmb3Ig
YW4KKyAqIGV4YW1wbGUuCisgKgorICogTk9URTogS1VuaXQgbmVlZHMgdG8gYWxsb2NhdGUgbWVt
b3J5IGZvciBlYWNoIGt1bml0X3Jlc291cmNlIG9iamVjdC4gWW91IG11c3QKKyAqIHNwZWNpZnkg
YW4gQGludGVybmFsX2dmcCB0aGF0IGlzIGNvbXBhdGlibGUgd2l0aCB0aGUgdXNlIGNvbnRleHQg
b2YgeW91cgorICogcmVzb3VyY2UuCisgKi8KK3N0YXRpYyBpbmxpbmUgdm9pZCAqa3VuaXRfYWxs
b2NfcmVzb3VyY2Uoc3RydWN0IGt1bml0ICp0ZXN0LAorCQkJCQkga3VuaXRfcmVzb3VyY2VfaW5p
dF90IGluaXQsCisJCQkJCSBrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJCQkJIGdmcF90
IGludGVybmFsX2dmcCwKKwkJCQkJIHZvaWQgKmNvbnRleHQpCit7CisJc3RydWN0IGt1bml0X3Jl
c291cmNlICpyZXM7CisKKwlyZXMgPSBrdW5pdF9hbGxvY19hbmRfZ2V0X3Jlc291cmNlKHRlc3Qs
IGluaXQsIGZyZWUsIGludGVybmFsX2dmcCwKKwkJCQkJICAgY29udGV4dCk7CisKKwlpZiAocmVz
KQorCQlyZXR1cm4gcmVzLT5hbGxvY2F0aW9uOworCisJcmV0dXJuIE5VTEw7Cit9CisKK3R5cGVk
ZWYgYm9vbCAoKmt1bml0X3Jlc291cmNlX21hdGNoX3QpKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJ
CQkgICAgICAgY29uc3Qgdm9pZCAqcmVzLAorCQkJCSAgICAgICB2b2lkICptYXRjaF9kYXRhKTsK
KworLyoqCisgKiBrdW5pdF9yZXNvdXJjZV9pbnN0YW5jZV9tYXRjaCgpIC0gTWF0Y2ggYSByZXNv
dXJjZSB3aXRoIHRoZSBzYW1lIGluc3RhbmNlLgorICogQHRlc3Q6IFRlc3QgY2FzZSB0byB3aGlj
aCB0aGUgcmVzb3VyY2UgYmVsb25ncy4KKyAqIEByZXM6IFRoZSBkYXRhIHN0b3JlZCBpbiBrdW5p
dF9yZXNvdXJjZS0+YWxsb2NhdGlvbi4KKyAqIEBtYXRjaF9kYXRhOiBUaGUgcmVzb3VyY2UgcG9p
bnRlciB0byBtYXRjaCBhZ2FpbnN0LgorICoKKyAqIEFuIGluc3RhbmNlIG9mIGt1bml0X3Jlc291
cmNlX21hdGNoX3QgdGhhdCBtYXRjaGVzIGEgcmVzb3VyY2Ugd2hvc2UKKyAqIGFsbG9jYXRpb24g
bWF0Y2hlcyBAbWF0Y2hfZGF0YS4KKyAqLworc3RhdGljIGlubGluZSBib29sIGt1bml0X3Jlc291
cmNlX2luc3RhbmNlX21hdGNoKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJCQkJCSBjb25zdCB2b2lk
ICpyZXMsCisJCQkJCQkgdm9pZCAqbWF0Y2hfZGF0YSkKK3sKKwlyZXR1cm4gcmVzID09IG1hdGNo
X2RhdGE7Cit9CisKKy8qKgorICoga3VuaXRfcmVzb3VyY2VfZGVzdHJveSgpIC0gRmluZCBhIGt1
bml0X3Jlc291cmNlIGFuZCBkZXN0cm95IGl0LgorICogQHRlc3Q6IFRlc3QgY2FzZSB0byB3aGlj
aCB0aGUgcmVzb3VyY2UgYmVsb25ncy4KKyAqIEBtYXRjaDogTWF0Y2ggZnVuY3Rpb24uIFJldHVy
bnMgd2hldGhlciBhIGdpdmVuIHJlc291cmNlIG1hdGNoZXMgQG1hdGNoX2RhdGEuCisgKiBAZnJl
ZTogTXVzdCBtYXRjaCBmcmVlIG9uIHRoZSBrdW5pdF9yZXNvdXJjZSB0byBmcmVlLgorICogQG1h
dGNoX2RhdGE6IERhdGEgcGFzc2VkIGludG8gQG1hdGNoLgorICoKKyAqIEZyZWUgdGhlIGxhdGVz
dCBrdW5pdF9yZXNvdXJjZSBvZiBAdGVzdCBmb3Igd2hpY2ggQGZyZWUgbWF0Y2hlcyB0aGUKKyAq
IGt1bml0X3Jlc291cmNlX2ZyZWVfdCBhc3NvY2lhdGVkIHdpdGggdGhlIHJlc291cmNlIGFuZCBm
b3Igd2hpY2ggQG1hdGNoCisgKiByZXR1cm5zIHRydWUuCisgKgorICogUkVUVVJOUzoKKyAqIDAg
aWYga3VuaXRfcmVzb3VyY2UgaXMgZm91bmQgYW5kIGZyZWVkLCAtRU5PRU5UIGlmIG5vdCBmb3Vu
ZC4KKyAqLworaW50IGt1bml0X3Jlc291cmNlX2Rlc3Ryb3koc3RydWN0IGt1bml0ICp0ZXN0LAor
CQkJICAga3VuaXRfcmVzb3VyY2VfbWF0Y2hfdCBtYXRjaCwKKwkJCSAgIGt1bml0X3Jlc291cmNl
X2ZyZWVfdCBmcmVlLAorCQkJICAgdm9pZCAqbWF0Y2hfZGF0YSk7CisKKy8qKgorICoga3VuaXRf
a21hbGxvYygpIC0gTGlrZSBrbWFsbG9jKCkgZXhjZXB0IHRoZSBhbGxvY2F0aW9uIGlzICp0ZXN0
IG1hbmFnZWQqLgorICogQHRlc3Q6IFRoZSB0ZXN0IGNvbnRleHQgb2JqZWN0LgorICogQHNpemU6
IFRoZSBzaXplIGluIGJ5dGVzIG9mIHRoZSBkZXNpcmVkIG1lbW9yeS4KKyAqIEBnZnA6IGZsYWdz
IHBhc3NlZCB0byB1bmRlcmx5aW5nIGttYWxsb2MoKS4KKyAqCisgKiBKdXN0IGxpa2UgYGttYWxs
b2MoLi4uKWAsIGV4Y2VwdCB0aGUgYWxsb2NhdGlvbiBpcyBtYW5hZ2VkIGJ5IHRoZSB0ZXN0IGNh
c2UKKyAqIGFuZCBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYWZ0ZXIgdGhlIHRlc3QgY2Fz
ZSBjb25jbHVkZXMuIFNlZSAmc3RydWN0CisgKiBrdW5pdF9yZXNvdXJjZSBmb3IgbW9yZSBpbmZv
cm1hdGlvbi4KKyAqLwordm9pZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNp
emVfdCBzaXplLCBnZnBfdCBnZnApOworCisvKioKKyAqIGt1bml0X2tmcmVlKCkgLSBMaWtlIGtm
cmVlIGV4Y2VwdCBmb3IgYWxsb2NhdGlvbnMgbWFuYWdlZCBieSBLVW5pdC4KKyAqIEB0ZXN0OiBU
aGUgdGVzdCBjYXNlIHRvIHdoaWNoIHRoZSByZXNvdXJjZSBiZWxvbmdzLgorICogQHB0cjogVGhl
IG1lbW9yeSBhbGxvY2F0aW9uIHRvIGZyZWUuCisgKi8KK3ZvaWQga3VuaXRfa2ZyZWUoc3RydWN0
IGt1bml0ICp0ZXN0LCBjb25zdCB2b2lkICpwdHIpOworCisvKioKKyAqIGt1bml0X2t6YWxsb2Mo
KSAtIEp1c3QgbGlrZSBrdW5pdF9rbWFsbG9jKCksIGJ1dCB6ZXJvZXMgdGhlIGFsbG9jYXRpb24u
CisgKiBAdGVzdDogVGhlIHRlc3QgY29udGV4dCBvYmplY3QuCisgKiBAc2l6ZTogVGhlIHNpemUg
aW4gYnl0ZXMgb2YgdGhlIGRlc2lyZWQgbWVtb3J5LgorICogQGdmcDogZmxhZ3MgcGFzc2VkIHRv
IHVuZGVybHlpbmcga21hbGxvYygpLgorICoKKyAqIFNlZSBremFsbG9jKCkgYW5kIGt1bml0X2tt
YWxsb2MoKSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KKyAqLworc3RhdGljIGlubGluZSB2b2lkICpr
dW5pdF9remFsbG9jKHN0cnVjdCBrdW5pdCAqdGVzdCwgc2l6ZV90IHNpemUsIGdmcF90IGdmcCkK
K3sKKwlyZXR1cm4ga3VuaXRfa21hbGxvYyh0ZXN0LCBzaXplLCBnZnAgfCBfX0dGUF9aRVJPKTsK
K30KKwordm9pZCBrdW5pdF9jbGVhbnVwKHN0cnVjdCBrdW5pdCAqdGVzdCk7CisKIHZvaWQgX19w
cmludGYoMywgNCkga3VuaXRfcHJpbnRrKGNvbnN0IGNoYXIgKmxldmVsLAogCQkJCSBjb25zdCBz
dHJ1Y3Qga3VuaXQgKnRlc3QsCiAJCQkJIGNvbnN0IGNoYXIgKmZtdCwgLi4uKTsKZGlmZiAtLWdp
dCBhL2xpYi9rdW5pdC90ZXN0LmMgYi9saWIva3VuaXQvdGVzdC5jCmluZGV4IGQzZGRhMzU5Zjk5
Yi4uNjhiMTAzN2FiNzRkIDEwMDY0NAotLS0gYS9saWIva3VuaXQvdGVzdC5jCisrKyBiL2xpYi9r
dW5pdC90ZXN0LmMKQEAgLTEyMiw2ICsxMjIsOCBAQCBzdGF0aWMgdm9pZCBrdW5pdF9wcmludF90
ZXN0X2Nhc2Vfb2tfbm90X29rKHN0cnVjdCBrdW5pdF9jYXNlICp0ZXN0X2Nhc2UsCiAKIHZvaWQg
a3VuaXRfaW5pdF90ZXN0KHN0cnVjdCBrdW5pdCAqdGVzdCwgY29uc3QgY2hhciAqbmFtZSkKIHsK
KwlzcGluX2xvY2tfaW5pdCgmdGVzdC0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJnRlc3QtPnJl
c291cmNlcyk7CiAJdGVzdC0+bmFtZSA9IG5hbWU7CiAJdGVzdC0+c3VjY2VzcyA9IHRydWU7CiB9
CkBAIC0xNTMsNiArMTU1LDggQEAgc3RhdGljIHZvaWQga3VuaXRfcnVuX2Nhc2Uoc3RydWN0IGt1
bml0X3N1aXRlICpzdWl0ZSwKIAlpZiAoc3VpdGUtPmV4aXQpCiAJCXN1aXRlLT5leGl0KCZ0ZXN0
KTsKIAorCWt1bml0X2NsZWFudXAoJnRlc3QpOworCiAJdGVzdF9jYXNlLT5zdWNjZXNzID0gdGVz
dC5zdWNjZXNzOwogfQogCkBAIC0xNzMsNiArMTc3LDE2NSBAQCBpbnQga3VuaXRfcnVuX3Rlc3Rz
KHN0cnVjdCBrdW5pdF9zdWl0ZSAqc3VpdGUpCiAJcmV0dXJuIDA7CiB9CiAKK3N0cnVjdCBrdW5p
dF9yZXNvdXJjZSAqa3VuaXRfYWxsb2NfYW5kX2dldF9yZXNvdXJjZShzdHJ1Y3Qga3VuaXQgKnRl
c3QsCisJCQkJCQkgICAga3VuaXRfcmVzb3VyY2VfaW5pdF90IGluaXQsCisJCQkJCQkgICAga3Vu
aXRfcmVzb3VyY2VfZnJlZV90IGZyZWUsCisJCQkJCQkgICAgZ2ZwX3QgaW50ZXJuYWxfZ2ZwLAor
CQkJCQkJICAgIHZvaWQgKmNvbnRleHQpCit7CisJc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXM7
CisJaW50IHJldDsKKworCXJlcyA9IGt6YWxsb2Moc2l6ZW9mKCpyZXMpLCBpbnRlcm5hbF9nZnAp
OworCWlmICghcmVzKQorCQlyZXR1cm4gTlVMTDsKKworCXJldCA9IGluaXQocmVzLCBjb250ZXh0
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gTlVMTDsKKworCXJlcy0+ZnJlZSA9IGZyZWU7CisJc3Bp
bl9sb2NrKCZ0ZXN0LT5sb2NrKTsKKwlsaXN0X2FkZF90YWlsKCZyZXMtPm5vZGUsICZ0ZXN0LT5y
ZXNvdXJjZXMpOworCXNwaW5fdW5sb2NrKCZ0ZXN0LT5sb2NrKTsKKworCXJldHVybiByZXM7Cit9
CisKK3N0YXRpYyB2b2lkIGt1bml0X3Jlc291cmNlX2ZyZWUoc3RydWN0IGt1bml0ICp0ZXN0LCBz
dHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcykKK3sKKwlyZXMtPmZyZWUocmVzKTsKKwlrZnJlZShy
ZXMpOworfQorCitzdGF0aWMgc3RydWN0IGt1bml0X3Jlc291cmNlICprdW5pdF9yZXNvdXJjZV9m
aW5kKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJCQkJCSAga3VuaXRfcmVzb3VyY2VfbWF0Y2hfdCBt
YXRjaCwKKwkJCQkJCSAga3VuaXRfcmVzb3VyY2VfZnJlZV90IGZyZWUsCisJCQkJCQkgIHZvaWQg
Km1hdGNoX2RhdGEpCit7CisJc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXNvdXJjZTsKKworCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnRlc3QtPmxvY2spOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9y
ZXZlcnNlKHJlc291cmNlLCAmdGVzdC0+cmVzb3VyY2VzLCBub2RlKSB7CisJCWlmIChyZXNvdXJj
ZS0+ZnJlZSAhPSBmcmVlKQorCQkJY29udGludWU7CisJCWlmIChtYXRjaCh0ZXN0LCByZXNvdXJj
ZS0+YWxsb2NhdGlvbiwgbWF0Y2hfZGF0YSkpCisJCQlyZXR1cm4gcmVzb3VyY2U7CisJfQorCisJ
cmV0dXJuIE5VTEw7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKmt1bml0X3Jl
c291cmNlX3JlbW92ZSgKKwkJc3RydWN0IGt1bml0ICp0ZXN0LAorCQlrdW5pdF9yZXNvdXJjZV9t
YXRjaF90IG1hdGNoLAorCQlrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJdm9pZCAqbWF0
Y2hfZGF0YSkKK3sKKwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlc291cmNlOworCisJc3Bpbl9s
b2NrKCZ0ZXN0LT5sb2NrKTsKKwlyZXNvdXJjZSA9IGt1bml0X3Jlc291cmNlX2ZpbmQodGVzdCwg
bWF0Y2gsIGZyZWUsIG1hdGNoX2RhdGEpOworCWlmIChyZXNvdXJjZSkKKwkJbGlzdF9kZWwoJnJl
c291cmNlLT5ub2RlKTsKKwlzcGluX3VubG9jaygmdGVzdC0+bG9jayk7CisKKwlyZXR1cm4gcmVz
b3VyY2U7Cit9CisKK2ludCBrdW5pdF9yZXNvdXJjZV9kZXN0cm95KHN0cnVjdCBrdW5pdCAqdGVz
dCwKKwkJCSAgIGt1bml0X3Jlc291cmNlX21hdGNoX3QgbWF0Y2gsCisJCQkgICBrdW5pdF9yZXNv
dXJjZV9mcmVlX3QgZnJlZSwKKwkJCSAgIHZvaWQgKm1hdGNoX2RhdGEpCit7CisJc3RydWN0IGt1
bml0X3Jlc291cmNlICpyZXNvdXJjZTsKKworCXJlc291cmNlID0ga3VuaXRfcmVzb3VyY2VfcmVt
b3ZlKHRlc3QsIG1hdGNoLCBmcmVlLCBtYXRjaF9kYXRhKTsKKworCWlmICghcmVzb3VyY2UpCisJ
CXJldHVybiAtRU5PRU5UOworCisJa3VuaXRfcmVzb3VyY2VfZnJlZSh0ZXN0LCByZXNvdXJjZSk7
CisJcmV0dXJuIDA7Cit9CisKK3N0cnVjdCBrdW5pdF9rbWFsbG9jX3BhcmFtcyB7CisJc2l6ZV90
IHNpemU7CisJZ2ZwX3QgZ2ZwOworfTsKKworc3RhdGljIGludCBrdW5pdF9rbWFsbG9jX2luaXQo
c3RydWN0IGt1bml0X3Jlc291cmNlICpyZXMsIHZvaWQgKmNvbnRleHQpCit7CisJc3RydWN0IGt1
bml0X2ttYWxsb2NfcGFyYW1zICpwYXJhbXMgPSBjb250ZXh0OworCisJcmVzLT5hbGxvY2F0aW9u
ID0ga21hbGxvYyhwYXJhbXMtPnNpemUsIHBhcmFtcy0+Z2ZwKTsKKwlpZiAoIXJlcy0+YWxsb2Nh
dGlvbikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQg
a3VuaXRfa21hbGxvY19mcmVlKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzKQoreworCWtmcmVl
KHJlcy0+YWxsb2NhdGlvbik7Cit9CisKK3ZvaWQgKmt1bml0X2ttYWxsb2Moc3RydWN0IGt1bml0
ICp0ZXN0LCBzaXplX3Qgc2l6ZSwgZ2ZwX3QgZ2ZwKQoreworCXN0cnVjdCBrdW5pdF9rbWFsbG9j
X3BhcmFtcyBwYXJhbXMgPSB7CisJCS5zaXplID0gc2l6ZSwKKwkJLmdmcCA9IGdmcAorCX07CisK
KwlyZXR1cm4ga3VuaXRfYWxsb2NfcmVzb3VyY2UodGVzdCwKKwkJCQkgICAga3VuaXRfa21hbGxv
Y19pbml0LAorCQkJCSAgICBrdW5pdF9rbWFsbG9jX2ZyZWUsCisJCQkJICAgIGdmcCwKKwkJCQkg
ICAgJnBhcmFtcyk7Cit9CisKK3ZvaWQga3VuaXRfa2ZyZWUoc3RydWN0IGt1bml0ICp0ZXN0LCBj
b25zdCB2b2lkICpwdHIpCit7CisJaW50IHJjOworCisJcmMgPSBrdW5pdF9yZXNvdXJjZV9kZXN0
cm95KHRlc3QsCisJCQkJICAgIGt1bml0X3Jlc291cmNlX2luc3RhbmNlX21hdGNoLAorCQkJCSAg
ICBrdW5pdF9rbWFsbG9jX2ZyZWUsCisJCQkJICAgICh2b2lkICopcHRyKTsKKworCVdBUk5fT04o
cmMpOworfQorCit2b2lkIGt1bml0X2NsZWFudXAoc3RydWN0IGt1bml0ICp0ZXN0KQoreworCXN0
cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzb3VyY2U7CisKKwkvKgorCSAqIHRlc3QtPnJlc291cmNl
cyBpcyBhIHN0YWNrIC0gZWFjaCBhbGxvY2F0aW9uIG11c3QgYmUgZnJlZWQgaW4gdGhlCisJICog
cmV2ZXJzZSBvcmRlciBmcm9tIHdoaWNoIGl0IHdhcyBhZGRlZCBzaW5jZSBvbmUgcmVzb3VyY2Ug
bWF5IGRlcGVuZAorCSAqIG9uIGFub3RoZXIgZm9yIGl0cyBlbnRpcmUgbGlmZXRpbWUuCisJICog
QWxzbywgd2UgY2Fubm90IHVzZSB0aGUgbm9ybWFsIGxpc3RfZm9yX2VhY2ggY29uc3RydWN0cywg
ZXZlbiB0aGUKKwkgKiBzYWZlIG9uZXMgYmVjYXVzZSAqYXJiaXRyYXJ5KiBub2RlcyBtYXkgYmUg
ZGVsZXRlZCB3aGVuCisJICoga3VuaXRfcmVzb3VyY2VfZnJlZSBpcyBjYWxsZWQ7IHRoZSBsaXN0
X2Zvcl9lYWNoX3NhZmUgdmFyaWFudHMgb25seQorCSAqIHByb3RlY3QgYWdhaW5zdCB0aGUgY3Vy
cmVudCBub2RlIGJlaW5nIGRlbGV0ZWQsIG5vdCB0aGUgbmV4dC4KKwkgKi8KKwl3aGlsZSAodHJ1
ZSkgeworCQlzcGluX2xvY2soJnRlc3QtPmxvY2spOworCQlpZiAobGlzdF9lbXB0eSgmdGVzdC0+
cmVzb3VyY2VzKSkgeworCQkJc3Bpbl91bmxvY2soJnRlc3QtPmxvY2spOworCQkJYnJlYWs7CisJ
CX0KKwkJcmVzb3VyY2UgPSBsaXN0X2xhc3RfZW50cnkoJnRlc3QtPnJlc291cmNlcywKKwkJCQkJ
ICAgc3RydWN0IGt1bml0X3Jlc291cmNlLAorCQkJCQkgICBub2RlKTsKKwkJbGlzdF9kZWwoJnJl
c291cmNlLT5ub2RlKTsKKwkJc3Bpbl91bmxvY2soJnRlc3QtPmxvY2spOworCisJCWt1bml0X3Jl
c291cmNlX2ZyZWUodGVzdCwgcmVzb3VyY2UpOworCX0KK30KKwogdm9pZCBrdW5pdF9wcmludGso
Y29uc3QgY2hhciAqbGV2ZWwsCiAJCSAgY29uc3Qgc3RydWN0IGt1bml0ICp0ZXN0LAogCQkgIGNv
bnN0IGNoYXIgKmZtdCwgLi4uKQotLSAKMi4yMy4wLjM1MS5nYzQzMTcwMzJlNi1nb29nCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
