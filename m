Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A4BF52728FF
	for <lists+dri-devel@lfdr.de>; Mon, 21 Sep 2020 16:49:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1A3456E4C5;
	Mon, 21 Sep 2020 14:49:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x343.google.com (mail-wm1-x343.google.com
 [IPv6:2a00:1450:4864:20::343])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E55816E3CB
 for <dri-devel@lists.freedesktop.org>; Mon, 21 Sep 2020 14:49:08 +0000 (UTC)
Received: by mail-wm1-x343.google.com with SMTP id z9so13025084wmk.1
 for <dri-devel@lists.freedesktop.org>; Mon, 21 Sep 2020 07:49:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=JvbuOV9oCE2JueOBBoT6yy3Rqmsbg5RVMjzz5GA3AEM=;
 b=ONsRT3uE/WoXxsAPOv5EVEfukC3z7u2o8OmQ4BF6otXgFo5NmDncxIO/1WG7qtcaV2
 RIzPv5SjaOFKJYtnN+GcCoCPNkc2vNbNkCK8Q7Ziv92hFBZ1joObScsqxkQo8LIuul+N
 +CuiAXyAJCSZLaJWob/1x5wwQF2KJcJtpJqYtLr/nkt7eXIvJAmK9nIr5M8Q64HP0Xmm
 rC+1J5J228ew92T51Wd6ctUqNjCejfiueEFRoYbtnmGJ8IcO9C5w+/l0m4LoYlmxRU3F
 mHQnXgibmexFFc0gRQh4vT5CQiXNcUjJ+2iaIQUkNu2TpSufxpPh7puntBAxGmMWOO1n
 8nsQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=JvbuOV9oCE2JueOBBoT6yy3Rqmsbg5RVMjzz5GA3AEM=;
 b=b44AdVRyA1KV3ZocokiU29MuDCY/3m8C5Y6QammLOcUL4WuYKO7lumsXKICrNRuVS4
 Imco3TTJl8Z8MosYMeUyPncjMNgCWqOx966T2wIw44Xuh//TRISe43M38KpfNHSc/wHM
 Zv9pyNMFxhsi99MVeVffUK5ecOXAIDIT2XGNNi9a81D8Qi/1PpSQrT4vvvBH0/Rcgtpb
 C1I0afpIXt0ZagBNlK1+i+w3kAfGgh8zVXzbjcEIrSKF5BtaQNcpmhfO6Re6gSbNOiR7
 fN5McW/xQtukFvV3JPa8cb15Rn3fnn8AX8gMHINE11+V1FZvgBoiAn7w9zUI6BzgymTf
 EBDQ==
X-Gm-Message-State: AOAM531OtB39MjSygzQpWDaJlZt8HxGWKqQSciWse4S43P+rCqhZSsAx
 6bTpwRWufNkSegzBgr0Y5Gsi3RItc40=
X-Google-Smtp-Source: ABdhPJxAwyHPBxXt+4PPVm2TZHvCWiegU5OsXhpgyzsUrwoeqSqp4jUzNIsrTpEkEvOBp1hbDTG8bw==
X-Received: by 2002:a05:600c:2155:: with SMTP id
 v21mr34884wml.118.1600699747224; 
 Mon, 21 Sep 2020 07:49:07 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:3482:3104:ab8c:3ac2])
 by smtp.gmail.com with ESMTPSA id i6sm23480992wra.1.2020.09.21.07.49.06
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 21 Sep 2020 07:49:06 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, airlied@gmail.com, tzimmermann@suse.de,
 bskeggs@redhat.com, kraxel@redhat.com, airlied@redhat.com,
 sroland@vmware.com
Subject: [PATCH 09/11] drm/amdgpu: switch over to the new pin interface
Date: Mon, 21 Sep 2020 16:48:54 +0200
Message-Id: <20200921144856.2797-10-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200921144856.2797-1-christian.koenig@amd.com>
References: <20200921144856.2797-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3RvcCB1c2luZyBUVE1fUExfRkxBR19OT19FVklDVC4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlh
biBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAgfCAgNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZGlzcGxheS5jICAgfCAgOCArLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jICAgfCAgNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9nZW0uYyAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCA0MSArKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmggICAgfCAgMyArLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgICB8ICAyICstCiA5IGZpbGVzIGNoYW5n
ZWQsIDI0IGluc2VydGlvbnMoKyksIDQ2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwppbmRleCBiNmI4MjE1MDBkMzAu
LjY0ZDRiNWZmOTVkNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9ncHV2bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9hbWRrZmRfZ3B1dm0uYwpAQCAtMTQ3OSw3ICsxNDc5LDcgQEAgaW50IGFtZGdwdV9hbWRrZmRf
Z3B1dm1fbWFwX21lbW9yeV90b19ncHUoCiAJCX0KIAl9CiAKLQlpZiAoIWFtZGdwdV90dG1fdHRf
Z2V0X3VzZXJtbShiby0+dGJvLnR0bSkgJiYgIWJvLT5waW5fY291bnQpCisJaWYgKCFhbWRncHVf
dHRtX3R0X2dldF91c2VybW0oYm8tPnRiby50dG0pICYmICFiby0+dGJvLnBpbl9jb3VudCkKIAkJ
YW1kZ3B1X2JvX2ZlbmNlKGJvLAogCQkJCSZhdm0tPnByb2Nlc3NfaW5mby0+ZXZpY3Rpb25fZmVu
Y2UtPmJhc2UsCiAJCQkJdHJ1ZSk7CkBAIC0xNTU4LDcgKzE1NTgsOCBAQCBpbnQgYW1kZ3B1X2Ft
ZGtmZF9ncHV2bV91bm1hcF9tZW1vcnlfZnJvbV9ncHUoCiAJICogcmVxdWlyZWQuCiAJICovCiAJ
aWYgKG1lbS0+bWFwcGVkX3RvX2dwdV9tZW1vcnkgPT0gMCAmJgotCSAgICAhYW1kZ3B1X3R0bV90
dF9nZXRfdXNlcm1tKG1lbS0+Ym8tPnRiby50dG0pICYmICFtZW0tPmJvLT5waW5fY291bnQpCisJ
ICAgICFhbWRncHVfdHRtX3R0X2dldF91c2VybW0obWVtLT5iby0+dGJvLnR0bSkgJiYKKwkgICAg
IW1lbS0+Ym8tPnRiby5waW5fY291bnQpCiAJCWFtZGdwdV9hbWRrZmRfcmVtb3ZlX2V2aWN0aW9u
X2ZlbmNlKG1lbS0+Ym8sCiAJCQkJCQlwcm9jZXNzX2luZm8tPmV2aWN0aW9uX2ZlbmNlKTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYwppbmRleCAxMjU5OGE0YjVjNzguLmQ1
MGI2M2E5M2QzNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMKQEAgLTQx
MCw3ICs0MTAsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9jc19ib192YWxpZGF0ZShzdHJ1Y3QgYW1k
Z3B1X2NzX3BhcnNlciAqcCwKIAl1aW50MzJfdCBkb21haW47CiAJaW50IHI7CiAKLQlpZiAoYm8t
PnBpbl9jb3VudCkKKwlpZiAoYm8tPnRiby5waW5fY291bnQpCiAJCXJldHVybiAwOwogCiAJLyog
RG9uJ3QgbW92ZSB0aGlzIGJ1ZmZlciBpZiB3ZSBoYXZlIGRlcGxldGVkIG91ciBhbGxvd2FuY2UK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGlzcGxheS5jCmluZGV4IGM4MTIw
NmU2MDk2Zi4uNGNiYTA5NWI2YzQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9kaXNwbGF5LmMKQEAgLTEzMiwxMCArMTMyLDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X2Rp
c3BsYXlfdW5waW5fd29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqX193b3JrKQogCS8qIHVu
cGluIG9mIHRoZSBvbGQgYnVmZmVyICovCiAJciA9IGFtZGdwdV9ib19yZXNlcnZlKHdvcmstPm9s
ZF9hYm8sIHRydWUpOwogCWlmIChsaWtlbHkociA9PSAwKSkgewotCQlyID0gYW1kZ3B1X2JvX3Vu
cGluKHdvcmstPm9sZF9hYm8pOwotCQlpZiAodW5saWtlbHkociAhPSAwKSkgewotCQkJRFJNX0VS
Uk9SKCJmYWlsZWQgdG8gdW5waW4gYnVmZmVyIGFmdGVyIGZsaXBcbiIpOwotCQl9CisJCWFtZGdw
dV9ib191bnBpbih3b3JrLT5vbGRfYWJvKTsKIAkJYW1kZ3B1X2JvX3VucmVzZXJ2ZSh3b3JrLT5v
bGRfYWJvKTsKIAl9IGVsc2UKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gcmVzZXJ2ZSBidWZmZXIg
YWZ0ZXIgZmxpcFxuIik7CkBAIC0yNDksOCArMjQ2LDcgQEAgaW50IGFtZGdwdV9kaXNwbGF5X2Ny
dGNfcGFnZV9mbGlwX3RhcmdldChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJfQogdW5waW46CiAJ
aWYgKCFhZGV2LT5lbmFibGVfdmlydHVhbF9kaXNwbGF5KQotCQlpZiAodW5saWtlbHkoYW1kZ3B1
X2JvX3VucGluKG5ld19hYm8pICE9IDApKQotCQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gdW5waW4g
bmV3IGFibyBpbiBlcnJvciBwYXRoXG4iKTsKKwkJYW1kZ3B1X2JvX3VucGluKG5ld19hYm8pOwog
CiB1bnJlc2VydmU6CiAJYW1kZ3B1X2JvX3VucmVzZXJ2ZShuZXdfYWJvKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCmluZGV4IDk1NzkzNDkyNmIyNC4uNWI0
NjVhYjc3NGQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZG1hX2J1Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVm
LmMKQEAgLTI4MSw3ICsyODEsNyBAQCBzdGF0aWMgc3RydWN0IHNnX3RhYmxlICphbWRncHVfZG1h
X2J1Zl9tYXAoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAogCXN0cnVjdCBzZ190
YWJsZSAqc2d0OwogCWxvbmcgcjsKIAotCWlmICghYm8tPnBpbl9jb3VudCkgeworCWlmICghYm8t
PnRiby5waW5fY291bnQpIHsKIAkJLyogbW92ZSBidWZmZXIgaW50byBHVFQgb3IgVlJBTSAqLwog
CQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0geyBmYWxzZSwgZmFsc2UgfTsKIAkJdW5z
aWduZWQgZG9tYWlucyA9IEFNREdQVV9HRU1fRE9NQUlOX0dUVDsKQEAgLTM5MCw3ICszOTAsOCBA
QCBzdGF0aWMgaW50IGFtZGdwdV9kbWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9i
dWYgKmRtYV9idWYsCiAJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkKIAkJcmV0dXJuIHJldDsKIAot
CWlmICghYm8tPnBpbl9jb3VudCAmJiAoYm8tPmFsbG93ZWRfZG9tYWlucyAmIEFNREdQVV9HRU1f
RE9NQUlOX0dUVCkpIHsKKwlpZiAoIWJvLT50Ym8ucGluX2NvdW50ICYmCisJICAgIChiby0+YWxs
b3dlZF9kb21haW5zICYgQU1ER1BVX0dFTV9ET01BSU5fR1RUKSkgewogCQlhbWRncHVfYm9fcGxh
Y2VtZW50X2Zyb21fZG9tYWluKGJvLCBBTURHUFVfR0VNX0RPTUFJTl9HVFQpOwogCQlyZXQgPSB0
dG1fYm9fdmFsaWRhdGUoJmJvLT50Ym8sICZiby0+cGxhY2VtZW50LCAmY3R4KTsKIAl9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKaW5kZXggYWE3ZjIzMGM3MWJmLi41OWI1
MjgwNDYyMmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9n
ZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKQEAgLTg2
MCw3ICs4NjAsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZWJ1Z2ZzX2dlbV9ib19pbmZvKGludCBp
ZCwgdm9pZCAqcHRyLCB2b2lkICpkYXRhKQogCXNlcV9wcmludGYobSwgIlx0MHglMDh4OiAlMTJs
ZCBieXRlICVzIiwKIAkJICAgaWQsIGFtZGdwdV9ib19zaXplKGJvKSwgcGxhY2VtZW50KTsKIAot
CXBpbl9jb3VudCA9IFJFQURfT05DRShiby0+cGluX2NvdW50KTsKKwlwaW5fY291bnQgPSBSRUFE
X09OQ0UoYm8tPnRiby5waW5fY291bnQpOwogCWlmIChwaW5fY291bnQpCiAJCXNlcV9wcmludGYo
bSwgIiBwaW4gY291bnQgJWQiLCBwaW5fY291bnQpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggYWMwNDNiYWFjMDVkLi42M2U5YzU3OTNjMzAgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKQEAgLTc4LDcgKzc4
LDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X2JvX2Rlc3Ryb3koc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICp0Ym8pCiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRncHVfdHRtX2FkZXYo
dGJvLT5iZGV2KTsKIAlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IHR0bV90b19hbWRncHVfYm8odGJv
KTsKIAotCWlmIChiby0+cGluX2NvdW50ID4gMCkKKwlpZiAoYm8tPnRiby5waW5fY291bnQgPiAw
KQogCQlhbWRncHVfYm9fc3VidHJhY3RfcGluX3NpemUoYm8pOwogCiAJYW1kZ3B1X2JvX2t1bm1h
cChibyk7CkBAIC03MjEsNyArNzIxLDcgQEAgaW50IGFtZGdwdV9ib192YWxpZGF0ZShzdHJ1Y3Qg
YW1kZ3B1X2JvICpibykKIAl1aW50MzJfdCBkb21haW47CiAJaW50IHI7CiAKLQlpZiAoYm8tPnBp
bl9jb3VudCkKKwlpZiAoYm8tPnRiby5waW5fY291bnQpCiAJCXJldHVybiAwOwogCiAJZG9tYWlu
ID0gYm8tPnByZWZlcnJlZF9kb21haW5zOwpAQCAtOTE4LDEzICs5MTgsMTMgQEAgaW50IGFtZGdw
dV9ib19waW5fcmVzdHJpY3RlZChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTMyIGRvbWFpbiwKIAkg
Ki8KIAlkb21haW4gPSBhbWRncHVfYm9fZ2V0X3ByZWZlcnJlZF9waW5fZG9tYWluKGFkZXYsIGRv
bWFpbik7CiAKLQlpZiAoYm8tPnBpbl9jb3VudCkgeworCWlmIChiby0+dGJvLnBpbl9jb3VudCkg
ewogCQl1aW50MzJfdCBtZW1fdHlwZSA9IGJvLT50Ym8ubWVtLm1lbV90eXBlOwogCiAJCWlmICgh
KGRvbWFpbiAmIGFtZGdwdV9tZW1fdHlwZV90b19kb21haW4obWVtX3R5cGUpKSkKIAkJCXJldHVy
biAtRUlOVkFMOwogCi0JCWJvLT5waW5fY291bnQrKzsKKwkJdHRtX2JvX3BpbigmYm8tPnRibyk7
CiAKIAkJaWYgKG1heF9vZmZzZXQgIT0gMCkgewogCQkJdTY0IGRvbWFpbl9zdGFydCA9IGFtZGdw
dV90dG1fZG9tYWluX3N0YXJ0KGFkZXYsCkBAIC05NTUsNyArOTU1LDYgQEAgaW50IGFtZGdwdV9i
b19waW5fcmVzdHJpY3RlZChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTMyIGRvbWFpbiwKIAkJaWYg
KCFiby0+cGxhY2VtZW50c1tpXS5scGZuIHx8CiAJCSAgICAobHBmbiAmJiBscGZuIDwgYm8tPnBs
YWNlbWVudHNbaV0ubHBmbikpCiAJCQliby0+cGxhY2VtZW50c1tpXS5scGZuID0gbHBmbjsKLQkJ
Ym8tPnBsYWNlbWVudHNbaV0uZmxhZ3MgfD0gVFRNX1BMX0ZMQUdfTk9fRVZJQ1Q7CiAJfQogCiAJ
ciA9IHR0bV9ib192YWxpZGF0ZSgmYm8tPnRibywgJmJvLT5wbGFjZW1lbnQsICZjdHgpOwpAQCAt
OTY0LDcgKzk2Myw3IEBAIGludCBhbWRncHVfYm9fcGluX3Jlc3RyaWN0ZWQoc3RydWN0IGFtZGdw
dV9ibyAqYm8sIHUzMiBkb21haW4sCiAJCWdvdG8gZXJyb3I7CiAJfQogCi0JYm8tPnBpbl9jb3Vu
dCA9IDE7CisJdHRtX2JvX3BpbigmYm8tPnRibyk7CiAKIAlkb21haW4gPSBhbWRncHVfbWVtX3R5
cGVfdG9fZG9tYWluKGJvLT50Ym8ubWVtLm1lbV90eXBlKTsKIAlpZiAoZG9tYWluID09IEFNREdQ
VV9HRU1fRE9NQUlOX1ZSQU0pIHsKQEAgLTEwMDYsMzQgKzEwMDUsMTYgQEAgaW50IGFtZGdwdV9i
b19waW4oc3RydWN0IGFtZGdwdV9ibyAqYm8sIHUzMiBkb21haW4pCiAgKiBSZXR1cm5zOgogICog
MCBmb3Igc3VjY2VzcyBvciBhIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwot
aW50IGFtZGdwdV9ib191bnBpbihzdHJ1Y3QgYW1kZ3B1X2JvICpibykKK3ZvaWQgYW1kZ3B1X2Jv
X3VucGluKHN0cnVjdCBhbWRncHVfYm8gKmJvKQogewotCXN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7Ci0Jc3RydWN0IHR0bV9vcGVyYXRp
b25fY3R4IGN0eCA9IHsgZmFsc2UsIGZhbHNlIH07Ci0JaW50IHIsIGk7Ci0KLQlpZiAoV0FSTl9P
Tl9PTkNFKCFiby0+cGluX2NvdW50KSkgewotCQlkZXZfd2FybihhZGV2LT5kZXYsICIlcCB1bnBp
biBub3QgbmVjZXNzYXJ5XG4iLCBibyk7Ci0JCXJldHVybiAwOwotCX0KLQliby0+cGluX2NvdW50
LS07Ci0JaWYgKGJvLT5waW5fY291bnQpCi0JCXJldHVybiAwOworCXR0bV9ib191bnBpbigmYm8t
PnRibyk7CisJaWYgKGJvLT50Ym8ucGluX2NvdW50KQorCQlyZXR1cm47CiAKIAlhbWRncHVfYm9f
c3VidHJhY3RfcGluX3NpemUoYm8pOwogCiAJaWYgKGJvLT50Ym8uYmFzZS5pbXBvcnRfYXR0YWNo
KQogCQlkbWFfYnVmX3VucGluKGJvLT50Ym8uYmFzZS5pbXBvcnRfYXR0YWNoKTsKLQotCWZvciAo
aSA9IDA7IGkgPCBiby0+cGxhY2VtZW50Lm51bV9wbGFjZW1lbnQ7IGkrKykgewotCQliby0+cGxh
Y2VtZW50c1tpXS5scGZuID0gMDsKLQkJYm8tPnBsYWNlbWVudHNbaV0uZmxhZ3MgJj0gflRUTV9Q
TF9GTEFHX05PX0VWSUNUOwotCX0KLQlyID0gdHRtX2JvX3ZhbGlkYXRlKCZiby0+dGJvLCAmYm8t
PnBsYWNlbWVudCwgJmN0eCk7Ci0JaWYgKHVubGlrZWx5KHIpKQotCQlkZXZfZXJyKGFkZXYtPmRl
diwgIiVwIHZhbGlkYXRlIGZhaWxlZCBmb3IgdW5waW5cbiIsIGJvKTsKLQotCXJldHVybiByOwog
fQogCiAvKioKQEAgLTEzODUsNyArMTM2Niw3IEBAIGludCBhbWRncHVfYm9fZmF1bHRfcmVzZXJ2
ZV9ub3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAkJcmV0dXJuIDA7CiAKIAkv
KiBDYW4ndCBtb3ZlIGEgcGlubmVkIEJPIHRvIHZpc2libGUgVlJBTSAqLwotCWlmIChhYm8tPnBp
bl9jb3VudCA+IDApCisJaWYgKGFiby0+dGJvLnBpbl9jb3VudCA+IDApCiAJCXJldHVybiAtRUlO
VkFMOwogCiAJLyogaHVycmFoIHRoZSBtZW1vcnkgaXMgbm90IHZpc2libGUgISAqLwpAQCAtMTQ4
OSw3ICsxNDcwLDcgQEAgdTY0IGFtZGdwdV9ib19ncHVfb2Zmc2V0KHN0cnVjdCBhbWRncHVfYm8g
KmJvKQogewogCVdBUk5fT05fT05DRShiby0+dGJvLm1lbS5tZW1fdHlwZSA9PSBUVE1fUExfU1lT
VEVNKTsKIAlXQVJOX09OX09OQ0UoIWRtYV9yZXN2X2lzX2xvY2tlZChiby0+dGJvLmJhc2UucmVz
dikgJiYKLQkJICAgICAhYm8tPnBpbl9jb3VudCAmJiBiby0+dGJvLnR5cGUgIT0gdHRtX2JvX3R5
cGVfa2VybmVsKTsKKwkJICAgICAhYm8tPnRiby5waW5fY291bnQgJiYgYm8tPnRiby50eXBlICE9
IHR0bV9ib190eXBlX2tlcm5lbCk7CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVtLnN0YXJ0ID09
IEFNREdQVV9CT19JTlZBTElEX09GRlNFVCk7CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVtLm1l
bV90eXBlID09IFRUTV9QTF9WUkFNICYmCiAJCSAgICAgIShiby0+ZmxhZ3MgJiBBTURHUFVfR0VN
X0NSRUFURV9WUkFNX0NPTlRJR1VPVVMpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuaAppbmRleCA1ZGRiNmNmOTYwMzAuLmU5MTc1MGU0MzQ0OCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuaApAQCAtODksNyArODksNiBAQCBz
dHJ1Y3QgYW1kZ3B1X2JvIHsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QJdGJvOwogCXN0cnVj
dCB0dG1fYm9fa21hcF9vYmoJCWttYXA7CiAJdTY0CQkJCWZsYWdzOwotCXVuc2lnbmVkCQkJcGlu
X2NvdW50OwogCXU2NAkJCQl0aWxpbmdfZmxhZ3M7CiAJdTY0CQkJCW1ldGFkYXRhX2ZsYWdzOwog
CXZvaWQJCQkJKm1ldGFkYXRhOwpAQCAtMjY3LDcgKzI2Niw3IEBAIHZvaWQgYW1kZ3B1X2JvX3Vu
cmVmKHN0cnVjdCBhbWRncHVfYm8gKipibyk7CiBpbnQgYW1kZ3B1X2JvX3BpbihzdHJ1Y3QgYW1k
Z3B1X2JvICpibywgdTMyIGRvbWFpbik7CiBpbnQgYW1kZ3B1X2JvX3Bpbl9yZXN0cmljdGVkKHN0
cnVjdCBhbWRncHVfYm8gKmJvLCB1MzIgZG9tYWluLAogCQkJICAgICB1NjQgbWluX29mZnNldCwg
dTY0IG1heF9vZmZzZXQpOwotaW50IGFtZGdwdV9ib191bnBpbihzdHJ1Y3QgYW1kZ3B1X2JvICpi
byk7Cit2b2lkIGFtZGdwdV9ib191bnBpbihzdHJ1Y3QgYW1kZ3B1X2JvICpibyk7CiBpbnQgYW1k
Z3B1X2JvX2V2aWN0X3ZyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpOwogaW50IGFtZGdw
dV9ib19pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKIGludCBhbWRncHVfYm9fbGF0
ZV9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV90dG0uYwppbmRleCBlN2I2N2RjMzMwYTQuLmRiNWY3NjFmMzdlYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpAQCAtNjYyLDcgKzY2Miw3IEBAIHN0
YXRpYyBpbnQgYW1kZ3B1X2JvX21vdmUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywgYm9v
bCBldmljdCwKIAogCS8qIENhbid0IG1vdmUgYSBwaW5uZWQgQk8gKi8KIAlhYm8gPSB0dG1fdG9f
YW1kZ3B1X2JvKGJvKTsKLQlpZiAoV0FSTl9PTl9PTkNFKGFiby0+cGluX2NvdW50ID4gMCkpCisJ
aWYgKFdBUk5fT05fT05DRShhYm8tPnRiby5waW5fY291bnQgPiAwKSkKIAkJcmV0dXJuIC1FSU5W
QUw7CiAKIAlhZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGJvLT5iZGV2KTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3ZtLmMKaW5kZXggNDIwOTMxZDM2NzMyLi4zZTYyNDM2MjMwODIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCkBAIC02MDksNyArNjA5LDcgQEAg
dm9pZCBhbWRncHVfdm1fZGVsX2Zyb21fbHJ1X25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmpl
Y3QgKmJvKQogCWlmICghYW1kZ3B1X2JvX2lzX2FtZGdwdV9ibyhibykpCiAJCXJldHVybjsKIAot
CWlmIChiby0+bWVtLnBsYWNlbWVudCAmIFRUTV9QTF9GTEFHX05PX0VWSUNUKQorCWlmIChiby0+
cGluX2NvdW50KQogCQlyZXR1cm47CiAKIAlhYm8gPSB0dG1fdG9fYW1kZ3B1X2JvKGJvKTsKLS0g
CjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
