Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 042712DA348
	for <lists+dri-devel@lfdr.de>; Mon, 14 Dec 2020 23:21:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C32BC6E154;
	Mon, 14 Dec 2020 22:21:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM12-BN8-obe.outbound.protection.outlook.com
 (mail-bn8nam12on2084.outbound.protection.outlook.com [40.107.237.84])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 375BF89F5F;
 Mon, 14 Dec 2020 22:21:46 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=HTY9cYgR0GRXfmGQtx+6GZjAyR62C4SnKy4hpN82Ue+pBUzRRbRiDNjAN6lUv+uDJaDN7zttjuQL4PNruwtrzbglVIy0u4hWlTFURoygZuq293f5NbX35FtLECyA1oyQqBB2gzcX5dxlJh13XbJNmWxFiRk7BGVnVigCCLKecSNujJxZMpmi67NyNCaYAM/Yjtg00obZDVnjSTMGszwkZ53DeaangoDRVHkFC+a48Ij4vnaTv0WcRddMMlsu8eh1uS5JqXndS5jfh1TsOR8TGf0HWkRG5SkgAQzw+LfemDK0TzCdx/Wps46Nacs9kHs83XnCn6YFD8rJvgR7wzY1og==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=/yX3Y5pk4rRcjy2Lm4A66Y5lTJJvJ+w9+uOmYHLBbyM=;
 b=lCGJ7rmdzkDARs6OslAVTJJHO9TEV0MFMsMfEI7hAnS8mv2dUBTnQWG8yVCkKdhbmS3OxRORXUUBZvUvaWhBFmbIzfHIvFc54HRzH8CkwOZjDcMYdUnOZgf/pIdwsOUmzQ5jZuaXuZJplrHGBC9b0q82Uu9SGxhK5Oh8DAAeRjtDZIIo+gtmMdl3BEnzbrylt3hsTrvAZQPwnYZ+CAdVVB0jofhMpQn/qf96oFSCMZavUT+wOlXeHv0C6Kna/S1xAIezynv27fwaSfYXst8QaH1FrCv6RgyTtwE8LdhdwaTf8mFY7NnUH3xpNx8u2vAWQI/1ZP3hVx6wCFQNpsl3Gg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=softfail (sender ip
 is 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com; dmarc=fail (p=none sp=none pct=100) action=none
 header.from=amd.com; dkim=none (message not signed); arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=/yX3Y5pk4rRcjy2Lm4A66Y5lTJJvJ+w9+uOmYHLBbyM=;
 b=FaqQ7R7Ma0OZsPaOssCzYHpitXxEbSNogYBmeF17qNQKAQSzqPiZAhKjg+mppKF66O1fVYkAMnpqFfSFsG9pR7hcjYLVxcNSPTfvO5EUs9s0ovsKvGPilW5tkf+QOYfJLSyRfOL/MxNeqiDqLbG6IuRMq+QpDkhGDNiv9+e9Ink=
Received: from DM5PR12CA0070.namprd12.prod.outlook.com (2603:10b6:3:103::32)
 by DM6PR12MB3417.namprd12.prod.outlook.com (2603:10b6:5:118::33) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3654.12; Mon, 14 Dec
 2020 22:21:44 +0000
Received: from DM6NAM11FT028.eop-nam11.prod.protection.outlook.com
 (2603:10b6:3:103:cafe::6d) by DM5PR12CA0070.outlook.office365.com
 (2603:10b6:3:103::32) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3654.12 via Frontend
 Transport; Mon, 14 Dec 2020 22:21:44 +0000
X-MS-Exchange-Authentication-Results: spf=softfail (sender IP is
 165.204.84.17) smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none
 (message not signed) header.d=none;lists.freedesktop.org; dmarc=fail
 action=none header.from=amd.com;
Received-SPF: SoftFail (protection.outlook.com: domain of transitioning
 amd.com discourages use of 165.204.84.17 as permitted sender)
Received: from SATLEXMB01.amd.com (165.204.84.17) by
 DM6NAM11FT028.mail.protection.outlook.com (10.13.173.140) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.3654.20 via Frontend Transport; Mon, 14 Dec 2020 22:21:42 +0000
Received: from SATLEXMB04.amd.com (10.181.40.145) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Mon, 14 Dec
 2020 16:21:31 -0600
Received: from SATLEXMB01.amd.com (10.181.40.142) by SATLEXMB04.amd.com
 (10.181.40.145) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Mon, 14 Dec
 2020 16:21:31 -0600
Received: from elite-desk-aura.amd.com (10.180.168.240) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server id 15.1.1979.3 via
 Frontend Transport; Mon, 14 Dec 2020 16:21:30 -0600
From: Aurabindo Pillai <aurabindo.pillai@amd.com>
To: <amd-gfx@lists.freedesktop.org>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH v3 2/3] drm/amd/display: Add freesync video modes based on
 preferred modes
Date: Mon, 14 Dec 2020 17:20:35 -0500
Message-ID: <20201214222036.561352-3-aurabindo.pillai@amd.com>
X-Mailer: git-send-email 2.29.2
In-Reply-To: <20201214222036.561352-1-aurabindo.pillai@amd.com>
References: <20201214222036.561352-1-aurabindo.pillai@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 62de128f-9809-41e2-d3f7-08d8a07ea2a4
X-MS-TrafficTypeDiagnostic: DM6PR12MB3417:
X-Microsoft-Antispam-PRVS: <DM6PR12MB3417498ED4BBC2260DFE88868BC70@DM6PR12MB3417.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:2887;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: 7efZ1BeqRvMoRfInlkLj6QT1k6km7GtOjXRwI1piXX7unvAhqVyP4XNelNZy6UOmSBsjYkSRSC42nnx17pyFYV+Z7+fgQnIab3Me0xj50uJSyzPhPB5AVlpAXZPPFYfderti1Hz87t/qNUNRU6tPBxyfwFSKx5/Sw5Il4CiOmPfEKEYuofP78eD8pOfszPYHTbsyrnzlkr9nR6DrQXTj9bJtzw6AhExJU/4nvyRqmFv4mEPVD0m9Na2g83bViHw0X3iFkxe3WOutTtXuH0zwD2Qap3VrZ0Qp3W8o5ppGwPHu3otm3jlDujDZPYLUIy0tgsnsCp2+X2AHUyFxo6eHo3ZbDexBDWQKSBd+Hg8eqDzcc9ZhyKM9j9xIuObsd1/Agw3yCPsxslO6mq/7EYiHsw==
X-Forefront-Antispam-Report: CIP:165.204.84.17; CTRY:US; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:SATLEXMB01.amd.com; PTR:ErrorRetry; CAT:NONE;
 SFS:(4636009)(136003)(376002)(346002)(46966005)(82310400003)(8936002)(83380400001)(44832011)(356005)(2906002)(26005)(5660300002)(450100002)(81166007)(70586007)(8676002)(4326008)(7696005)(47076004)(508600001)(36756003)(110136005)(2616005)(1076003)(54906003)(186003)(426003)(70206006)(86362001)(336012);
 DIR:OUT; SFP:1101; 
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 14 Dec 2020 22:21:42.7080 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 62de128f-9809-41e2-d3f7-08d8a07ea2a4
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB01.amd.com]
X-MS-Exchange-CrossTenant-AuthSource: DM6NAM11FT028.eop-nam11.prod.protection.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Anonymous
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR12MB3417
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: alexander.deucher@amd.com, aurabindo.pillai@amd.com,
 nicholas.kazlauskas@amd.com, shashank.sharma@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

W1doeSZIb3ddCklmIGV4cGVyaW1lbnRhbCBmcmVlc3luYyB2aWRlbyBtb2RlIG1vZHVsZSBwYXJh
bWV0ZXIgaXMgZW5hYmxlZCwgYWRkCmZldyBleHRyYSBkaXNwbGF5IG1vZGVzIGludG8gdGhlIGRy
aXZlcidzIG1vZGUgbGlzdCBjb3JyZXNwb25kaW5nIHRvIGNvbW1vbgp2aWRlbyBmcmFtZSByYXRl
cy4gV2hlbiB1c2Vyc3BhY2Ugc2V0cyB0aGVzZSBtb2Rlcywgbm8gbW9kZXNldCB3aWxsIGJlCnBl
cmZvcm1lZCAoaWYgY3VycmVudCBtb2RlIHdhcyBvbmUgb2YgZnJlZXN5bmMgbW9kZXMgb3IgdGhl
IGJhc2UgZnJlZXN5bmMgbW9kZQpiYXNlZCBvZmYgd2hpY2ggdGltaW5ncyBoYXZlIGJlZW4gZ2Vu
ZXJhdGVkIGZvciB0aGUgcmVzdCBvZiB0aGUgZnJlZXN5bmMgbW9kZXMpCnNpbmNlIHRoZXNlIG1v
ZGVzIG9ubHkgZGlmZmVyIGZyb20gdGhlIGJhc2UgbW9kZSB3aXRoIGZyb250IHBvcmNoIHRpbWlu
Zy4KClNpZ25lZC1vZmYtYnk6IEF1cmFiaW5kbyBQaWxsYWkgPGF1cmFiaW5kby5waWxsYWlAYW1k
LmNvbT4KQWNrZWQtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWcgYXQgYW1k
LmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMg
fCAxNjcgKysrKysrKysrKysrKysrKysrCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVf
ZG0vYW1kZ3B1X2RtLmggfCAgIDIgKwogMiBmaWxlcyBjaGFuZ2VkLCAxNjkgaW5zZXJ0aW9ucygr
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1k
Z3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9k
bS5jCmluZGV4IGU3ZWUyNDY3ZWFkYi4uYzFmZmQzM2U5ZDgzIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMKQEAgLTUxNzQsNiArNTE3
NCw1OSBAQCBzdGF0aWMgdm9pZCBkbV9lbmFibGVfcGVyX2ZyYW1lX2NydGNfbWFzdGVyX3N5bmMo
c3RydWN0IGRjX3N0YXRlICpjb250ZXh0KQogCXNldF9tYXN0ZXJfc3RyZWFtKGNvbnRleHQtPnN0
cmVhbXMsIGNvbnRleHQtPnN0cmVhbV9jb3VudCk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqCitnZXRfaGlnaGVzdF9yZWZyZXNoX3JhdGVfbW9kZShzdHJ1Y3QgYW1kZ3B1
X2RtX2Nvbm5lY3RvciAqYWNvbm5lY3RvciwKKwkJCSAgYm9vbCB1c2VfcHJvYmVkX21vZGVzKQor
eworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptLCAqbV9wcmVmID0gTlVMTDsKKwl1MTYgY3Vy
cmVudF9yZWZyZXNoLCBoaWdoZXN0X3JlZnJlc2g7CisJc3RydWN0IGxpc3RfaGVhZCAqbGlzdF9o
ZWFkID0gdXNlX3Byb2JlZF9tb2RlcyA/CisJCQkJCQkgICAgJmFjb25uZWN0b3ItPmJhc2UucHJv
YmVkX21vZGVzIDoKKwkJCQkJCSAgICAmYWNvbm5lY3Rvci0+YmFzZS5tb2RlczsKKworCWlmIChh
Y29ubmVjdG9yLT5mcmVlc3luY192aWRfYmFzZS5jbG9jayAhPSAwKQorCQlyZXR1cm4gJmFjb25u
ZWN0b3ItPmZyZWVzeW5jX3ZpZF9iYXNlOworCisJLyogRmluZCB0aGUgcHJlZmVycmVkIG1vZGUg
Ki8KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5IChtLCBsaXN0X2hlYWQsIGhlYWQpIHsKKwkJaWYgKG0t
PnR5cGUgJiBEUk1fTU9ERV9UWVBFX1BSRUZFUlJFRCkgeworCQkJbV9wcmVmID0gbTsKKwkJCWJy
ZWFrOworCQl9CisJfQorCisJaWYgKCFtX3ByZWYpIHsKKwkJLyogUHJvYmFibHkgYW4gRURJRCB3
aXRoIG5vIHByZWZlcnJlZCBtb2RlLiBGYWxsYmFjayB0byBmaXJzdCBlbnRyeSAqLworCQltX3By
ZWYgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoCisJCQkmYWNvbm5lY3Rvci0+YmFzZS5tb2Rl
cywgc3RydWN0IGRybV9kaXNwbGF5X21vZGUsIGhlYWQpOworCQlpZiAoIW1fcHJlZikgeworCQkJ
RFJNX0RFQlVHX0RSSVZFUigiTm8gcHJlZmVycmVkIG1vZGUgZm91bmQgaW4gRURJRFxuIik7CisJ
CQlyZXR1cm4gTlVMTDsKKwkJfQorCX0KKworCWhpZ2hlc3RfcmVmcmVzaCA9IGRybV9tb2RlX3Zy
ZWZyZXNoKG1fcHJlZik7CisKKwkvKgorCSAqIEZpbmQgdGhlIG1vZGUgd2l0aCBoaWdoZXN0IHJl
ZnJlc2ggcmF0ZSB3aXRoIHNhbWUgcmVzb2x1dGlvbi4KKwkgKiBGb3Igc29tZSBtb25pdG9ycywg
cHJlZmVycmVkIG1vZGUgaXMgbm90IHRoZSBtb2RlIHdpdGggaGlnaGVzdAorCSAqIHN1cHBvcnRl
ZCByZWZyZXNoIHJhdGUuCisJICovCisJbGlzdF9mb3JfZWFjaF9lbnRyeSAobSwgbGlzdF9oZWFk
LCBoZWFkKSB7CisJCWN1cnJlbnRfcmVmcmVzaCAgPSBkcm1fbW9kZV92cmVmcmVzaChtKTsKKwor
CQlpZiAobS0+aGRpc3BsYXkgPT0gbV9wcmVmLT5oZGlzcGxheSAmJgorCQkgICAgbS0+dmRpc3Bs
YXkgPT0gbV9wcmVmLT52ZGlzcGxheSAmJgorCQkgICAgaGlnaGVzdF9yZWZyZXNoIDwgY3VycmVu
dF9yZWZyZXNoKSB7CisJCQloaWdoZXN0X3JlZnJlc2ggPSBjdXJyZW50X3JlZnJlc2g7CisJCQlt
X3ByZWYgPSBtOworCQl9CisJfQorCisJYWNvbm5lY3Rvci0+ZnJlZXN5bmNfdmlkX2Jhc2UgPSAq
bV9wcmVmOworCXJldHVybiBtX3ByZWY7Cit9CisKIHN0YXRpYyBzdHJ1Y3QgZGNfc3RyZWFtX3N0
YXRlICoKIGNyZWF0ZV9zdHJlYW1fZm9yX3Npbmsoc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3Ig
KmFjb25uZWN0b3IsCiAJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZHJt
X21vZGUsCkBAIC02OTk5LDYgKzcwNTIsMTE5IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kbV9jb25u
ZWN0b3JfZGRjX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCX0K
IH0KIAorc3RhdGljIGJvb2wgaXNfZHVwbGljYXRlX21vZGUoc3RydWN0IGFtZGdwdV9kbV9jb25u
ZWN0b3IgKmFjb25uZWN0b3IsCisJCQkgICAgICBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9k
ZSkKK3sKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbTsKKworCWxpc3RfZm9yX2VhY2hfZW50
cnkgKG0sICZhY29ubmVjdG9yLT5iYXNlLnByb2JlZF9tb2RlcywgaGVhZCkgeworCQlpZiAoZHJt
X21vZGVfZXF1YWwobSwgbW9kZSkpCisJCQlyZXR1cm4gdHJ1ZTsKKwl9CisKKwlyZXR1cm4gZmFs
c2U7Cit9CisKK3N0YXRpYyB1aW50IGFkZF9mc19tb2RlcyhzdHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5l
Y3RvciAqYWNvbm5lY3RvciwKKwkJCSBzdHJ1Y3QgZGV0YWlsZWRfZGF0YV9tb25pdG9yX3Jhbmdl
ICpyYW5nZSkKK3sKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbTsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbmV3X21vZGU7CisJdWludCBpOworCXVpbnQ2NF90IHRhcmdldF92
dG90YWwsIHRhcmdldF92dG90YWxfZGlmZjsKKwl1aW50MzJfdCBuZXdfbW9kZXNfY291bnQgPSAw
OworCXVpbnQ2NF90IG51bSwgZGVuOworCisJLyogU3RhbmRhcmQgRlBTIHZhbHVlcworCSAqCisJ
ICogMjMuOTc2IC0gVFYvTlRTQworCSAqIDI0CSAgLSBDaW5lbWEKKwkgKiAyNSAgICAgLSBUVi9Q
QUwKKwkgKiAyOS45NyAgLSBUVi9OVFNDCisJICogMzAgICAgIC0gVFYvTlRTQworCSAqIDQ4CSAg
LSBDaW5lbWEgSEZSCisJICogNTAJICAtIFRWL1BBTAorCSAqLworCWNvbnN0IHVpbnQzMl90IGNv
bW1vbl9yYXRlc1tdID0geyAyMzk3NiwgMjQwMDAsIDI1MDAwLCAyOTk3MCwgMzAwMDAsCisJCQkJ
CSA0ODAwMCwgNTAwMDAsIDYwMDAwLCA3MjAwMCwgOTYwMDAgfTsKKworCS8qCisJICogRmluZCBt
b2RlIHdpdGggaGlnaGVzdCByZWZyZXNoIHJhdGUgd2l0aCB0aGUgc2FtZSByZXNvbHV0aW9uCisJ
ICogYXMgdGhlIHByZWZlcnJlZCBtb2RlLiBTb21lIG1vbml0b3JzIHJlcG9ydCBhIHByZWZlcnJl
ZCBtb2RlCisJICogd2l0aCBsb3dlciByZXNvbHV0aW9uIHRoYW4gdGhlIGhpZ2hlc3QgcmVmcmVz
aCByYXRlIHN1cHBvcnRlZC4KKwkgKi8KKworCW0gPSBnZXRfaGlnaGVzdF9yZWZyZXNoX3JhdGVf
bW9kZShhY29ubmVjdG9yLCB0cnVlKTsKKwlpZiAoIW0pCisJCXJldHVybiAwOworCisJZm9yIChp
ID0gMDsgaSA8IEFSUkFZX1NJWkUoY29tbW9uX3JhdGVzKTsgaSsrKSB7CisJCWlmIChkcm1fbW9k
ZV92cmVmcmVzaChtKSAqIDEwMDAgPCBjb21tb25fcmF0ZXNbaV0pCisJCQljb250aW51ZTsKKwor
CQlpZiAoY29tbW9uX3JhdGVzW2ldIDwgcmFuZ2UtPm1pbl92ZnJlcSAqIDEwMDApCisJCQljb250
aW51ZTsKKworCQludW0gPSAodW5zaWduZWQgbG9uZyBsb25nKW0tPmNsb2NrICogMTAwMCAqIDEw
MDA7CisJCWRlbiA9IGNvbW1vbl9yYXRlc1tpXSAqICh1bnNpZ25lZCBsb25nIGxvbmcpbS0+aHRv
dGFsOworCQl0YXJnZXRfdnRvdGFsID0gZGl2X3U2NChudW0sIGRlbik7CisJCXRhcmdldF92dG90
YWxfZGlmZiA9IHRhcmdldF92dG90YWwgLSBtLT52dG90YWw7CisKKwkJLyogQ2hlY2sgZm9yIGls
bGVnYWwgbW9kZXMgKi8KKwkJaWYgKG0tPnZzeW5jX3N0YXJ0ICsgdGFyZ2V0X3Z0b3RhbF9kaWZm
IDwgbS0+dmRpc3BsYXkgfHwKKwkJICAgIG0tPnZzeW5jX2VuZCArIHRhcmdldF92dG90YWxfZGlm
ZiA8IG0tPnZzeW5jX3N0YXJ0IHx8CisJCSAgICBtLT52dG90YWwgKyB0YXJnZXRfdnRvdGFsX2Rp
ZmYgPCBtLT52c3luY19lbmQpCisJCQljb250aW51ZTsKKworCQluZXdfbW9kZSA9IGRybV9tb2Rl
X2R1cGxpY2F0ZShhY29ubmVjdG9yLT5iYXNlLmRldiwgbSk7CisJCWlmICghbmV3X21vZGUpCisJ
CQlnb3RvIG91dDsKKworCQluZXdfbW9kZS0+dnRvdGFsICs9ICh1MTYpdGFyZ2V0X3Z0b3RhbF9k
aWZmOworCQluZXdfbW9kZS0+dnN5bmNfc3RhcnQgKz0gKHUxNil0YXJnZXRfdnRvdGFsX2RpZmY7
CisJCW5ld19tb2RlLT52c3luY19lbmQgKz0gKHUxNil0YXJnZXRfdnRvdGFsX2RpZmY7CisJCW5l
d19tb2RlLT50eXBlICY9IH5EUk1fTU9ERV9UWVBFX1BSRUZFUlJFRDsKKwkJbmV3X21vZGUtPnR5
cGUgfD0gRFJNX01PREVfVFlQRV9EUklWRVI7CisKKwkJaWYgKCFpc19kdXBsaWNhdGVfbW9kZShh
Y29ubmVjdG9yLCBuZXdfbW9kZSkpIHsKKwkJCWRybV9tb2RlX3Byb2JlZF9hZGQoJmFjb25uZWN0
b3ItPmJhc2UsIG5ld19tb2RlKTsKKwkJCW5ld19tb2Rlc19jb3VudCArPSAxOworCQl9IGVsc2UK
KwkJCWRybV9tb2RlX2Rlc3Ryb3koYWNvbm5lY3Rvci0+YmFzZS5kZXYsIG5ld19tb2RlKTsKKwl9
Cisgb3V0OgorCXJldHVybiBuZXdfbW9kZXNfY291bnQ7Cit9CisKK3N0YXRpYyB2b2lkIGFtZGdw
dV9kbV9jb25uZWN0b3JfYWRkX2ZyZWVzeW5jX21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsCisJCQkJCQkgICBzdHJ1Y3QgZWRpZCAqZWRpZCkKK3sKKwl1aW50OF90IGk7CisJ
c3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nOworCXN0cnVjdCBkZXRhaWxlZF9ub25fcGl4
ZWwgKmRhdGE7CisJc3RydWN0IGRldGFpbGVkX2RhdGFfbW9uaXRvcl9yYW5nZSAqcmFuZ2U7CisJ
c3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFtZGdwdV9kbV9jb25uZWN0b3IgPQorCQl0b19h
bWRncHVfZG1fY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwlpZiAoIShhbWRncHVfZXhwX2ZyZWVz
eW5jX3ZpZF9tb2RlICYmIGVkaWQpKQorCQlyZXR1cm47CisKKwlpZiAoZWRpZC0+dmVyc2lvbiA9
PSAxICYmIGVkaWQtPnJldmlzaW9uID4gMSkgeworCQlmb3IgKGkgPSAwOyBpIDwgNDsgaSsrKSB7
CisJCQl0aW1pbmcgPSAmZWRpZC0+ZGV0YWlsZWRfdGltaW5nc1tpXTsKKwkJCWRhdGEgPSAmdGlt
aW5nLT5kYXRhLm90aGVyX2RhdGE7CisJCQlyYW5nZSA9ICZkYXRhLT5kYXRhLnJhbmdlOworCisJ
CQkvKiBDaGVjayBpZiBtb25pdG9yIGhhcyBjb250aW51b3VzIGZyZXF1ZW5jeSBtb2RlICovCisJ
CQlpZiAoZGF0YS0+dHlwZSA9PSBFRElEX0RFVEFJTF9NT05JVE9SX1JBTkdFICYmCisJCQkgICAg
cmFuZ2UtPm1heF92ZnJlcSAtIHJhbmdlLT5taW5fdmZyZXEgPiAxMCkgeworCQkJCWFtZGdwdV9k
bV9jb25uZWN0b3ItPm51bV9tb2RlcyArPSBhZGRfZnNfbW9kZXMoYW1kZ3B1X2RtX2Nvbm5lY3Rv
ciwgcmFuZ2UpOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJfQorfQorCiBzdGF0aWMgaW50IGFt
ZGdwdV9kbV9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IpCiB7CiAJc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFtZGdwdV9kbV9jb25uZWN0b3Ig
PQpAQCAtNzAxNCw2ICs3MTgwLDcgQEAgc3RhdGljIGludCBhbWRncHVfZG1fY29ubmVjdG9yX2dl
dF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCX0gZWxzZSB7CiAJCWFt
ZGdwdV9kbV9jb25uZWN0b3JfZGRjX2dldF9tb2Rlcyhjb25uZWN0b3IsIGVkaWQpOwogCQlhbWRn
cHVfZG1fY29ubmVjdG9yX2FkZF9jb21tb25fbW9kZXMoZW5jb2RlciwgY29ubmVjdG9yKTsKKwkJ
YW1kZ3B1X2RtX2Nvbm5lY3Rvcl9hZGRfZnJlZXN5bmNfbW9kZXMoY29ubmVjdG9yLCBlZGlkKTsK
IAl9CiAJYW1kZ3B1X2RtX2ZiY19pbml0KGNvbm5lY3Rvcik7CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmggYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5oCmluZGV4IDI1MWFmNzgzZjZi
MS4uZjVhNWYxYWQ3ZGJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkv
YW1kZ3B1X2RtL2FtZGdwdV9kbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9h
bWRncHVfZG0vYW1kZ3B1X2RtLmgKQEAgLTQxMyw2ICs0MTMsOCBAQCBzdHJ1Y3QgYW1kZ3B1X2Rt
X2Nvbm5lY3RvciB7CiAjZW5kaWYKIAlib29sIGZvcmNlX3l1djQyMF9vdXRwdXQ7CiAJc3RydWN0
IGRzY19wcmVmZXJyZWRfc2V0dGluZ3MgZHNjX3NldHRpbmdzOworCS8qIENhY2hlZCBkaXNwbGF5
IG1vZGVzICovCisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgZnJlZXN5bmNfdmlkX2Jhc2U7CiB9
OwogCiAjZGVmaW5lIHRvX2FtZGdwdV9kbV9jb25uZWN0b3IoeCkgY29udGFpbmVyX29mKHgsIHN0
cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yLCBiYXNlKQotLSAKMi4yOS4yCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
