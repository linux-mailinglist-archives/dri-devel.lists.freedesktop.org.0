Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7E6BB9400CE
	for <lists+dri-devel@lfdr.de>; Tue, 30 Jul 2024 00:03:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B6F0E10E16A;
	Mon, 29 Jul 2024 22:03:17 +0000 (UTC)
Authentication-Results: gabe.freedesktop.org;
	dkim=pass (2048-bit key; unprotected) header.d=intel.com header.i=@intel.com header.b="T1TWnwis";
	dkim-atps=neutral
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mgamail.intel.com (mgamail.intel.com [192.198.163.16])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3859910E16A;
 Mon, 29 Jul 2024 22:03:16 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=intel.com; i=@intel.com; q=dns/txt; s=Intel;
 t=1722290596; x=1753826596;
 h=date:message-id:from:to:cc:subject:in-reply-to:
 references:mime-version;
 bh=ol66Ovb6L6dfk9I2Y3CG3vRhpnAu8O94EL1p4RYaxlg=;
 b=T1TWnwisyylD7up+SiK9bAHY0snTKWsGBSVJctE5xnggYtyPKXv+8aQk
 R248f9Itv9625sOIZcBT04mRN+beTaY+PayBP7mcY/9Dkq7RkMoW7FviN
 g2upvTsCsU9T04Z1/QRIclsroaap7DhaIClEjc6upoKzLqGE9MNHGxw++
 /d5aQnFB1dGK8XeGbXLrVpettfNnAMT1/jcB6M8YiOm/NiHV6ClSA6QDM
 5eJgSB+fTQGDJJlbxHxdzHXSUiGoHvrN/aYiYCINIZ2WJMURn0K6uVKKf
 DBwOWRJvqCkjYctXs05y8KR40P4teFyNkcfAjNp426WrGst4Cr2bHkCyl Q==;
X-CSE-ConnectionGUID: GAxCzwdARG2cKEmsMV6DPg==
X-CSE-MsgGUID: NCoD9/5FRtqgf8FDZWZrpQ==
X-IronPort-AV: E=McAfee;i="6700,10204,11148"; a="12778047"
X-IronPort-AV: E=Sophos;i="6.09,247,1716274800"; d="scan'208";a="12778047"
Received: from orviesa002.jf.intel.com ([10.64.159.142])
 by fmvoesa110.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 29 Jul 2024 15:03:16 -0700
X-CSE-ConnectionGUID: gVRoIYudRPeCk+kW+aYHgw==
X-CSE-MsgGUID: shR09AXPTrSts4TbTFmU0Q==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="6.09,247,1716274800"; d="scan'208";a="84768246"
Received: from jhwillia-mobl2.amr.corp.intel.com (HELO adixit-arch.intel.com)
 ([10.125.96.188])
 by orviesa002-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 29 Jul 2024 15:03:16 -0700
Date: Mon, 29 Jul 2024 14:54:58 -0700
Message-ID: <87cymv279p.wl-ashutosh.dixit@intel.com>
From: "Dixit, Ashutosh" <ashutosh.dixit@intel.com>
To: Lucas De Marchi <lucas.demarchi@intel.com>
Cc: Umesh Nerlige Ramappa <umesh.nerlige.ramappa@intel.com>,
 =?ISO-8859-1?Q?Jos=E9?= Roberto de Souza <jose.souza@intel.com>,
 intel-xe@lists.freedesktop.org, dri-devel@lists.freedesktop.org
Subject: Re: [PATCH] drm/xe/oa/uapi: Make bit masks unsigned
In-Reply-To: <s7tjuildazggjsuza53ixn3ts7t6rw2rwy2et4neijbnkx6ve7@nb4pyxmhhquj>
References: <20240729092634.2227611-1-geert+renesas@glider.be>	<s7tjuildazggjsuza53ixn3ts7t6rw2rwy2et4neijbnkx6ve7@nb4pyxmhhquj>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?ISO-8859-4?Q?Goj=F2?=) APEL-LB/10.8 EasyPG/1.0.0
 Emacs/29.4 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

On Mon, 29 Jul 2024 06:21:20 -0700, Lucas De Marchi wrote:
>

Hi Lucas,

> Reviewed-by: Lucas De Marchi <lucas.demarchi@intel.com>
>
> That fixes the build, but question to Ashutosh: it's odd to tie the
> format to a bspec. What happens on next platform if the HW changes?
> Hopefully it doesn't change in an incompatible way, but looking at this
> code it seems we could still keep the uapi by untying the HW from the
> uapi in the documentation.

IMO, in this case, it is not possible to decouple the formats from Bspec
because that is where they are specified (in Bspec 52198/60942).

In i915 the OA formats were specified by an enum (enum drm_i915_oa_format),
but I would argue that enum is meaningful only when we refer back to Bspec.
Also the i915 enum had to constantly updated when HW added new formats.

For Xe, we changed the way the formats are specified in a way which we
believe will make the uapi more robust and uapi header update much less
frequent (hopefully we will never have to update the header and if at all
we have to, we should be able to do it in a backwards compatible way since
we have sufficient number of free bits). HW has followed this scheme for
specifying the formats for years and only recently for Xe2 has added a
couple of bits and introduced new PEC formats which I think it is not going
to change now for some time.

But as I said the formats have to refer back to Bspec since that is where
there are specified and there are too many of them. Any description or enum
is ambiguous unless it refers back to Bspec. So I don't see how not to
refer to Bspec in the documentation. If anyone has any ideas about not
referring to Bspec I am willing to consider it but I think the best way
forward is to leave the documentation as is:

	/*
	 * OA_FORMAT's are specified the same way as in PRM/Bspec 52198/60942,
	 * in terms of the following quantities: a. enum @drm_xe_oa_format_type
	 * b. Counter select c. Counter size and d. BC report. Also refer to the
	 * oa_formats array in drivers/gpu/drm/xe/xe_oa.c.
	 */
#define DRM_XE_OA_FORMAT_MASK_FMT_TYPE		(0xff << 0)
#define DRM_XE_OA_FORMAT_MASK_COUNTER_SEL	(0xff << 8)
#define DRM_XE_OA_FORMAT_MASK_COUNTER_SIZE	(0xff << 16)
#define DRM_XE_OA_FORMAT_MASK_BC_REPORT		(0xff << 24)

Thanks.
--
Ashutosh
