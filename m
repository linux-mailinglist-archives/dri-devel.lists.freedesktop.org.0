Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9AC30173AC
	for <lists+dri-devel@lfdr.de>; Wed,  8 May 2019 10:27:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 794AA897AC;
	Wed,  8 May 2019 08:26:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3E50A895C4
 for <dri-devel@lists.freedesktop.org>; Wed,  8 May 2019 08:26:46 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id ABA57AF46;
 Wed,  8 May 2019 08:26:44 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, airlied@linux.ie, kraxel@redhat.com,
 christian.koenig@amd.com, ray.huang@amd.com, hdegoede@redhat.com,
 noralf@tronnes.org, sam@ravnborg.org, z.liuxinliang@hisilicon.com,
 zourongrong@gmail.com, kong.kongxinwei@hisilicon.com,
 puck.chen@hisilicon.com
Subject: [PATCH v5 20/20] drm/hisilicon: Convert hibmc-drm driver to VRAM MM
Date: Wed,  8 May 2019 10:26:30 +0200
Message-Id: <20190508082630.15116-21-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190508082630.15116-1-tzimmermann@suse.de>
References: <20190508082630.15116-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGRhdGEgc3RydWN0dXJlIHxzdHJ1Y3QgZHJtX3ZyYW1fbW18IGFuZCBpdHMgaGVscGVycyBy
ZXBsYWNlIGhpYm1jJ3MKVFRNLWJhc2VkIG1lbW9yeSBtYW5hZ2VyLiBJdCdzIHRoZSBzYW1lIGlt
cGxlbWVudGF0aW9uOyBleGNlcHQgZm9yIHRoZQp0eXBlIG5hbWVzLgoKdjU6CgkqIHNldCAubGxz
ZWVrIHZpYSBEUk1fVlJBTV9NTV9GSUxFX09QRVJBVElPTlMKdjQ6CgkqIGRvbid0IHNlbGVjdCBE
Uk1fVFRNIG9yIERSTV9WUkFNX01NX0hFTFBFUgp2MzoKCSogdXNlIGRybV9nZW1fdnJhbV9tbV9m
dW5jcwoJKiBjb252ZXJ0IGRyaXZlciB0byBkcm1fZGV2aWNlLWJhc2VkIGluc3RhbmNlCnYyOgoJ
KiBpbXBsZW1lbnQgaGlibWNfbW1hcCgpIHdpdGggZHJtX3ZyYW1fbW1fbW1hcCgpCgpTaWduZWQt
b2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL0tjb25maWcgICAgICAgfCAgIDEgLQogLi4uL2dw
dS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuYyAgIHwgICA5ICstCiAuLi4vZ3B1
L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oICAgfCAgIDggKy0KIGRyaXZlcnMv
Z3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMgICB8IDEzOSArKy0tLS0tLS0tLS0t
LS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgMTIgaW5zZXJ0aW9ucygrKSwgMTQ1IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvS2NvbmZpZyBi
L2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvS2NvbmZpZwppbmRleCAwNGQwYmM2ODU1
NjAuLmMzNmVjMDNmM2Q5MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9o
aWJtYy9LY29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvS2NvbmZp
ZwpAQCAtMiw3ICsyLDYgQEAgY29uZmlnIERSTV9ISVNJX0hJQk1DCiAJdHJpc3RhdGUgIkRSTSBT
dXBwb3J0IGZvciBIaXNpbGljb24gSGlibWMiCiAJZGVwZW5kcyBvbiBEUk0gJiYgUENJICYmIE1N
VQogCXNlbGVjdCBEUk1fS01TX0hFTFBFUgotCXNlbGVjdCBEUk1fVFRNCiAJc2VsZWN0IERSTV9W
UkFNX0hFTFBFUgogCiAJaGVscApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNv
bi9oaWJtYy9oaWJtY19kcm1fZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1j
L2hpYm1jX2RybV9kcnYuYwppbmRleCA3MDI3YTFhMDU3NjguLjcyNWMwZjUzZWQ5MyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmMKQEAgLTI3
LDE0ICsyNyw3IEBACiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGhpYm1j
X2ZvcHMgPSB7CiAJLm93bmVyCQk9IFRISVNfTU9EVUxFLAotCS5vcGVuCQk9IGRybV9vcGVuLAot
CS5yZWxlYXNlCT0gZHJtX3JlbGVhc2UsCi0JLnVubG9ja2VkX2lvY3RsCT0gZHJtX2lvY3RsLAot
CS5jb21wYXRfaW9jdGwJPSBkcm1fY29tcGF0X2lvY3RsLAotCS5tbWFwCQk9IGhpYm1jX21tYXAs
Ci0JLnBvbGwJCT0gZHJtX3BvbGwsCi0JLnJlYWQJCT0gZHJtX3JlYWQsCi0JLmxsc2VlawkJPSBu
b19sbHNlZWssCisJRFJNX1ZSQU1fTU1fRklMRV9PUEVSQVRJT05TCiB9OwogCiBzdGF0aWMgaXJx
cmV0dXJuX3QgaGlibWNfZHJtX2ludGVycnVwdChpbnQgaXJxLCB2b2lkICphcmcpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oCmluZGV4IDZiMzQz
MGZjNTE0OC4uMzk2NzY5M2VjYmRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxp
Y29uL2hpYm1jL2hpYm1jX2RybV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29u
L2hpYm1jL2hpYm1jX2RybV9kcnYuaApAQCAtMjQsNyArMjQsNyBAQAogI2luY2x1ZGUgPGRybS9k
cm1fZmJfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2dlbV92cmFtX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZlci5o
PgorI2luY2x1ZGUgPGRybS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4KIAogc3RydWN0IGhpYm1jX2Zy
YW1lYnVmZmVyIHsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyIGZiOwpAQCAtNDksMTMgKzQ5LDgg
QEAgc3RydWN0IGhpYm1jX2RybV9wcml2YXRlIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAgKmRldjsK
IAlib29sIG1vZGVfY29uZmlnX2luaXRpYWxpemVkOwogCi0JLyogdHRtICovCi0Jc3RydWN0IHR0
bV9ib19kZXZpY2UgYmRldjsKLQlib29sIGluaXRpYWxpemVkOwotCiAJLyogZmJkZXYgKi8KIAlz
dHJ1Y3QgaGlibWNfZmJkZXYgKmZiZGV2OwotCWJvb2wgbW1faW5pdGVkOwogfTsKIAogI2RlZmlu
ZSB0b19oaWJtY19mcmFtZWJ1ZmZlcih4KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGhpYm1jX2Zy
YW1lYnVmZmVyLCBmYikKQEAgLTgxLDcgKzc2LDYgQEAgaW50IGhpYm1jX21tX2luaXQoc3RydWN0
IGhpYm1jX2RybV9wcml2YXRlICpoaWJtYyk7CiB2b2lkIGhpYm1jX21tX2Zpbmkoc3RydWN0IGhp
Ym1jX2RybV9wcml2YXRlICpoaWJtYyk7CiBpbnQgaGlibWNfZHVtYl9jcmVhdGUoc3RydWN0IGRy
bV9maWxlICpmaWxlLCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgICAgICBzdHJ1Y3QgZHJt
X21vZGVfY3JlYXRlX2R1bWIgKmFyZ3MpOwotaW50IGhpYm1jX21tYXAoc3RydWN0IGZpbGUgKmZp
bHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKTsKIAogZXh0ZXJuIGNvbnN0IHN0cnVjdCBk
cm1fbW9kZV9jb25maWdfZnVuY3MgaGlibWNfbW9kZV9mdW5jczsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMKaW5kZXggZmJmOGViMDQ4ZWJjLi41MmZiYThj
YjhkZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNf
dHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYwpA
QCAtMTcsMTU3ICsxNywzOCBAQAogICovCiAKICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxw
ZXIuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmg+CiAKICNpbmNsdWRlICJo
aWJtY19kcm1fZHJ2LmgiCiAKLXN0YXRpYyBpbmxpbmUgc3RydWN0IGhpYm1jX2RybV9wcml2YXRl
ICoKLWhpYm1jX2JkZXYoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkKQotewotCXJldHVybiBjb250
YWluZXJfb2YoYmQsIHN0cnVjdCBoaWJtY19kcm1fcHJpdmF0ZSwgYmRldik7Ci19Ci0KLXN0YXRp
YyBpbnQKLWhpYm1jX2JvX2luaXRfbWVtX3R5cGUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
IHUzMiB0eXBlLAotCQkgICAgICAgc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4pCi17
Ci0Jc3dpdGNoICh0eXBlKSB7Ci0JY2FzZSBUVE1fUExfU1lTVEVNOgotCQltYW4tPmZsYWdzID0g
VFRNX01FTVRZUEVfRkxBR19NQVBQQUJMRTsKLQkJbWFuLT5hdmFpbGFibGVfY2FjaGluZyA9IFRU
TV9QTF9NQVNLX0NBQ0hJTkc7Ci0JCW1hbi0+ZGVmYXVsdF9jYWNoaW5nID0gVFRNX1BMX0ZMQUdf
Q0FDSEVEOwotCQlicmVhazsKLQljYXNlIFRUTV9QTF9WUkFNOgotCQltYW4tPmZ1bmMgPSAmdHRt
X2JvX21hbmFnZXJfZnVuYzsKLQkJbWFuLT5mbGFncyA9IFRUTV9NRU1UWVBFX0ZMQUdfRklYRUQg
fAotCQkJVFRNX01FTVRZUEVfRkxBR19NQVBQQUJMRTsKLQkJbWFuLT5hdmFpbGFibGVfY2FjaGlu
ZyA9IFRUTV9QTF9GTEFHX1VOQ0FDSEVEIHwKLQkJCVRUTV9QTF9GTEFHX1dDOwotCQltYW4tPmRl
ZmF1bHRfY2FjaGluZyA9IFRUTV9QTF9GTEFHX1dDOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlE
Uk1fRVJST1IoInVuc3VwcG9ydGVkIG1lbW9yeSB0eXBlICV1XG4iLCB0eXBlKTsKLQkJcmV0dXJu
IC1FSU5WQUw7Ci0JfQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGhpYm1jX3R0bV9pb19t
ZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKLQkJCQkgICAgc3RydWN0IHR0
bV9tZW1fcmVnICptZW0pCi17Ci0Jc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSAm
YmRldi0+bWFuW21lbS0+bWVtX3R5cGVdOwotCXN0cnVjdCBoaWJtY19kcm1fcHJpdmF0ZSAqaGli
bWMgPSBoaWJtY19iZGV2KGJkZXYpOwotCi0JbWVtLT5idXMuYWRkciA9IE5VTEw7Ci0JbWVtLT5i
dXMub2Zmc2V0ID0gMDsKLQltZW0tPmJ1cy5zaXplID0gbWVtLT5udW1fcGFnZXMgPDwgUEFHRV9T
SElGVDsKLQltZW0tPmJ1cy5iYXNlID0gMDsKLQltZW0tPmJ1cy5pc19pb21lbSA9IGZhbHNlOwot
CWlmICghKG1hbi0+ZmxhZ3MgJiBUVE1fTUVNVFlQRV9GTEFHX01BUFBBQkxFKSkKLQkJcmV0dXJu
IC1FSU5WQUw7Ci0Jc3dpdGNoIChtZW0tPm1lbV90eXBlKSB7Ci0JY2FzZSBUVE1fUExfU1lTVEVN
OgotCQkvKiBzeXN0ZW0gbWVtb3J5ICovCi0JCXJldHVybiAwOwotCWNhc2UgVFRNX1BMX1ZSQU06
Ci0JCW1lbS0+YnVzLm9mZnNldCA9IG1lbS0+c3RhcnQgPDwgUEFHRV9TSElGVDsKLQkJbWVtLT5i
dXMuYmFzZSA9IHBjaV9yZXNvdXJjZV9zdGFydChoaWJtYy0+ZGV2LT5wZGV2LCAwKTsKLQkJbWVt
LT5idXMuaXNfaW9tZW0gPSB0cnVlOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1cm4gLUVJ
TlZBTDsKLQl9Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIGhpYm1jX3R0bV9iYWNrZW5k
X2Rlc3Ryb3koc3RydWN0IHR0bV90dCAqdHQpCi17Ci0JdHRtX3R0X2ZpbmkodHQpOwotCWtmcmVl
KHR0KTsKLX0KLQotc3RhdGljIHN0cnVjdCB0dG1fYmFja2VuZF9mdW5jIGhpYm1jX3R0X2JhY2tl
bmRfZnVuYyA9IHsKLQkuZGVzdHJveSA9ICZoaWJtY190dG1fYmFja2VuZF9kZXN0cm95LAotfTsK
LQotc3RhdGljIHN0cnVjdCB0dG1fdHQgKmhpYm1jX3R0bV90dF9jcmVhdGUoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibywKLQkJCQkJICB1MzIgcGFnZV9mbGFncykKLXsKLQlzdHJ1Y3QgdHRt
X3R0ICp0dDsKLQlpbnQgcmV0OwotCi0JdHQgPSBremFsbG9jKHNpemVvZigqdHQpLCBHRlBfS0VS
TkVMKTsKLQlpZiAoIXR0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGFsbG9jYXRlIHR0bV90
dFxuIik7Ci0JCXJldHVybiBOVUxMOwotCX0KLQl0dC0+ZnVuYyA9ICZoaWJtY190dF9iYWNrZW5k
X2Z1bmM7Ci0JcmV0ID0gdHRtX3R0X2luaXQodHQsIGJvLCBwYWdlX2ZsYWdzKTsKLQlpZiAocmV0
KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXRpYWxpemUgdHRtX3R0OiAlZFxuIiwgcmV0
KTsKLQkJa2ZyZWUodHQpOwotCQlyZXR1cm4gTlVMTDsKLQl9Ci0JcmV0dXJuIHR0OwotfQotCi1z
dHJ1Y3QgdHRtX2JvX2RyaXZlciBoaWJtY19ib19kcml2ZXIgPSB7Ci0JLnR0bV90dF9jcmVhdGUJ
CT0gaGlibWNfdHRtX3R0X2NyZWF0ZSwKLQkuaW5pdF9tZW1fdHlwZQkJPSBoaWJtY19ib19pbml0
X21lbV90eXBlLAotCS5ldmljdF9mbGFncwkJPSBkcm1fZ2VtX3ZyYW1fYm9fZHJpdmVyX2V2aWN0
X2ZsYWdzLAotCS5tb3ZlCQkJPSBOVUxMLAotCS52ZXJpZnlfYWNjZXNzCQk9IGRybV9nZW1fdnJh
bV9ib19kcml2ZXJfdmVyaWZ5X2FjY2VzcywKLQkuaW9fbWVtX3Jlc2VydmUJCT0gJmhpYm1jX3R0
bV9pb19tZW1fcmVzZXJ2ZSwKLQkuaW9fbWVtX2ZyZWUJCT0gTlVMTCwKLX07Ci0KIGludCBoaWJt
Y19tbV9pbml0KHN0cnVjdCBoaWJtY19kcm1fcHJpdmF0ZSAqaGlibWMpCiB7CisJc3RydWN0IGRy
bV92cmFtX21tICp2bW07CiAJaW50IHJldDsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaGli
bWMtPmRldjsKLQlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9ICZoaWJtYy0+YmRldjsKLQot
CXJldCA9IHR0bV9ib19kZXZpY2VfaW5pdCgmaGlibWMtPmJkZXYsCi0JCQkJICZoaWJtY19ib19k
cml2ZXIsCi0JCQkJIGRldi0+YW5vbl9pbm9kZS0+aV9tYXBwaW5nLAotCQkJCSB0cnVlKTsKLQlp
ZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZXJyb3IgaW5pdGlhbGl6aW5nIGJvIGRyaXZlcjogJWRc
biIsIHJldCk7Ci0JCXJldHVybiByZXQ7Ci0JfQogCi0JcmV0ID0gdHRtX2JvX2luaXRfbW0oYmRl
diwgVFRNX1BMX1ZSQU0sCi0JCQkgICAgIGhpYm1jLT5mYl9zaXplID4+IFBBR0VfU0hJRlQpOwot
CWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdHRtIFZSQU0gaW5pdDogJWRcbiIsIHJl
dCk7CisJdm1tID0gZHJtX3ZyYW1faGVscGVyX2FsbG9jX21tKGRldiwKKwkJCQkgICAgICAgcGNp
X3Jlc291cmNlX3N0YXJ0KGRldi0+cGRldiwgMCksCisJCQkJICAgICAgIGhpYm1jLT5mYl9zaXpl
LCAmZHJtX2dlbV92cmFtX21tX2Z1bmNzKTsKKwlpZiAoSVNfRVJSKHZtbSkpIHsKKwkJcmV0ID0g
UFRSX0VSUih2bW0pOworCQlEUk1fRVJST1IoIkVycm9yIGluaXRpYWxpemluZyBWUkFNIE1NOyAl
ZFxuIiwgcmV0KTsKIAkJcmV0dXJuIHJldDsKIAl9CiAKLQloaWJtYy0+bW1faW5pdGVkID0gdHJ1
ZTsKIAlyZXR1cm4gMDsKIH0KIAogdm9pZCBoaWJtY19tbV9maW5pKHN0cnVjdCBoaWJtY19kcm1f
cHJpdmF0ZSAqaGlibWMpCiB7Ci0JaWYgKCFoaWJtYy0+bW1faW5pdGVkKQorCWlmICghaGlibWMt
PmRldi0+dnJhbV9tbSkKIAkJcmV0dXJuOwogCi0JdHRtX2JvX2RldmljZV9yZWxlYXNlKCZoaWJt
Yy0+YmRldik7Ci0JaGlibWMtPm1tX2luaXRlZCA9IGZhbHNlOwotfQotCi1pbnQgaGlibWNfbW1h
cChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCi17Ci0Jc3Ry
dWN0IGRybV9maWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGhp
Ym1jX2RybV9wcml2YXRlICpoaWJtYyA9IGZpbGVfcHJpdi0+bWlub3ItPmRldi0+ZGV2X3ByaXZh
dGU7Ci0KLQlyZXR1cm4gdHRtX2JvX21tYXAoZmlscCwgdm1hLCAmaGlibWMtPmJkZXYpOworCWRy
bV92cmFtX2hlbHBlcl9yZWxlYXNlX21tKGhpYm1jLT5kZXYpOwogfQogCiBpbnQgaGlibWNfZ2Vt
X2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1MzIgc2l6ZSwgYm9vbCBpc2tlcm5lbCwK
IAkJICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipvYmopCiB7Ci0Jc3RydWN0IGhpYm1jX2Ry
bV9wcml2YXRlICpoaWJtYyA9IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGRybV9nZW1fdnJh
bV9vYmplY3QgKmdibzsKIAlpbnQgcmV0OwogCkBAIC0xNzcsNyArNTgsNyBAQCBpbnQgaGlibWNf
Z2VtX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1MzIgc2l6ZSwgYm9vbCBpc2tlcm5l
bCwKIAlpZiAoc2l6ZSA9PSAwKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWdibyA9IGRybV9nZW1f
dnJhbV9jcmVhdGUoZGV2LCAmaGlibWMtPmJkZXYsIHNpemUsIDAsIGZhbHNlKTsKKwlnYm8gPSBk
cm1fZ2VtX3ZyYW1fY3JlYXRlKGRldiwgJmRldi0+dnJhbV9tbS0+YmRldiwgc2l6ZSwgMCwgZmFs
c2UpOwogCWlmIChJU19FUlIoZ2JvKSkgewogCQlyZXQgPSBQVFJfRVJSKGdibyk7CiAJCWlmIChy
ZXQgIT0gLUVSRVNUQVJUU1lTKQotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
