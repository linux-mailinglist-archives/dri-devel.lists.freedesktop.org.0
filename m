Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6EDC310F9FE
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 09:38:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 736EE6E431;
	Tue,  3 Dec 2019 08:38:28 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 871556E42E
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 08:38:24 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id ECE01ACE0;
 Tue,  3 Dec 2019 08:38:22 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, maarten.lankhorst@linux.intel.com, mripard@kernel.org,
 airlied@linux.ie, z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com, sam@ravnborg.org,
 kraxel@redhat.com
Subject: [PATCH v3 2/5] drm/hisilicon/hibmc: Replace struct hibmc_framebuffer
 with generic code
Date: Tue,  3 Dec 2019 09:38:16 +0100
Message-Id: <20191203083819.6643-3-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203083819.6643-1-tzimmermann@suse.de>
References: <20191203083819.6643-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGhpYm1jIGRyaXZlcidzIHN0cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciBzdG9yZXMgYSBEUk0g
ZnJhbWVidWZmZXIKd2l0aCBhbiBhc3NvY2lhdGVkIEdFTSBvYmplY3QuIFRoaXMgZnVuY3Rpb25h
bGl0eSBpcyBhbHNvIHByb3ZpZGVkIGJ5CmdlbmVyaWMgY29kZS4gU3dpdGNoIGhpYm1jIG92ZXIu
CgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4K
UmV2aWV3ZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkFja2Vk
LWJ5OiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+Ci0tLQogLi4uL2dwdS9kcm0vaGlz
aWxpY29uL2hpYm1jL2hpYm1jX2RybV9kZS5jICAgIHwgIDQgKy0KIC4uLi9ncHUvZHJtL2hpc2ls
aWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmggICB8IDExIC0tLQogZHJpdmVycy9ncHUvZHJtL2hp
c2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYyAgIHwgNjkgKy0tLS0tLS0tLS0tLS0tLS0tLQogMyBm
aWxlcyBjaGFuZ2VkLCAzIGluc2VydGlvbnMoKyksIDgxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2RlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kZS5jCmluZGV4IDY1MjdhOTdm
NjhhMy4uN2ZhN2Q0OTMzZjYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29u
L2hpYm1jL2hpYm1jX2RybV9kZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGli
bWMvaGlibWNfZHJtX2RlLmMKQEAgLTk5LDE0ICs5OSwxMiBAQCBzdGF0aWMgdm9pZCBoaWJtY19w
bGFuZV9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCXM2NCBncHVfYWRk
ciA9IDA7CiAJdW5zaWduZWQgaW50IGxpbmVfbDsKIAlzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUg
KnByaXYgPSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKLQlzdHJ1Y3QgaGlibWNfZnJhbWVidWZm
ZXIgKmhpYm1jX2ZiOwogCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CiAKIAlpZiAo
IXN0YXRlLT5mYikKIAkJcmV0dXJuOwogCi0JaGlibWNfZmIgPSB0b19oaWJtY19mcmFtZWJ1ZmZl
cihzdGF0ZS0+ZmIpOwotCWdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oaGlibWNfZmItPm9iaik7
CisJZ2JvID0gZHJtX2dlbV92cmFtX29mX2dlbShzdGF0ZS0+ZmItPm9ialswXSk7CiAKIAlncHVf
YWRkciA9IGRybV9nZW1fdnJhbV9vZmZzZXQoZ2JvKTsKIAlpZiAoV0FSTl9PTl9PTkNFKGdwdV9h
ZGRyIDwgMCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hp
Ym1jX2RybV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJt
X2Rydi5oCmluZGV4IGIzNDQ5M2VhZDMwYi4uOGViNzI1OGIyMzZhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuaApAQCAtMjAsMTEgKzIwLDYg
QEAKIHN0cnVjdCBkcm1fZGV2aWNlOwogc3RydWN0IGRybV9nZW1fb2JqZWN0OwogCi1zdHJ1Y3Qg
aGlibWNfZnJhbWVidWZmZXIgewotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgZmI7Ci0Jc3RydWN0
IGRybV9nZW1fb2JqZWN0ICpvYmo7Ci19OwotCiBzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgewog
CS8qIGh3ICovCiAJdm9pZCBfX2lvbWVtICAgKm1taW87CkBAIC0zOCw4ICszMyw2IEBAIHN0cnVj
dCBoaWJtY19kcm1fcHJpdmF0ZSB7CiAJYm9vbCBtb2RlX2NvbmZpZ19pbml0aWFsaXplZDsKIH07
CiAKLSNkZWZpbmUgdG9faGlibWNfZnJhbWVidWZmZXIoeCkgY29udGFpbmVyX29mKHgsIHN0cnVj
dCBoaWJtY19mcmFtZWJ1ZmZlciwgZmIpCi0KIHZvaWQgaGlibWNfc2V0X3Bvd2VyX21vZGUoc3Ry
dWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2LAogCQkJICB1bnNpZ25lZCBpbnQgcG93ZXJfbW9k
ZSk7CiB2b2lkIGhpYm1jX3NldF9jdXJyZW50X2dhdGUoc3RydWN0IGhpYm1jX2RybV9wcml2YXRl
ICpwcml2LApAQCAtNTAsMTAgKzQzLDYgQEAgaW50IGhpYm1jX3ZkYWNfaW5pdChzdHJ1Y3QgaGli
bWNfZHJtX3ByaXZhdGUgKnByaXYpOwogCiBpbnQgaGlibWNfZ2VtX2NyZWF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB1MzIgc2l6ZSwgYm9vbCBpc2tlcm5lbCwKIAkJICAgICBzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKipvYmopOwotc3RydWN0IGhpYm1jX2ZyYW1lYnVmZmVyICoKLWhpYm1jX2Zy
YW1lYnVmZmVyX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgICAgIGNvbnN0IHN0
cnVjdCBkcm1fbW9kZV9mYl9jbWQyICptb2RlX2NtZCwKLQkJICAgICAgIHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqKTsKIAogaW50IGhpYm1jX21tX2luaXQoc3RydWN0IGhpYm1jX2RybV9wcml2
YXRlICpoaWJtYyk7CiB2b2lkIGhpYm1jX21tX2Zpbmkoc3RydWN0IGhpYm1jX2RybV9wcml2YXRl
ICpoaWJtYyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hp
Ym1jX3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYwpp
bmRleCAyMWI2ODRlYWI1YzkuLmY2ZDI1Yjg1YzIwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaGlz
aWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jCkBAIC0xNSw2ICsxNSw3IEBACiAKICNpbmNsdWRlIDxk
cm0vZHJtX2F0b21pY19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgorI2luY2x1
ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1f
Z2VtX3ZyYW1faGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgogCkBAIC05Nyw3
NCArOTgsOCBAQCBpbnQgaGlibWNfZHVtYl9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLCBz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBoaWJt
Y191c2VyX2ZyYW1lYnVmZmVyX2Rlc3Ryb3koc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCi17
Ci0Jc3RydWN0IGhpYm1jX2ZyYW1lYnVmZmVyICpoaWJtY19mYiA9IHRvX2hpYm1jX2ZyYW1lYnVm
ZmVyKGZiKTsKLQotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChoaWJtY19mYi0+b2JqKTsK
LQlkcm1fZnJhbWVidWZmZXJfY2xlYW51cChmYik7Ci0Ja2ZyZWUoaGlibWNfZmIpOwotfQotCi1z
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlcl9mdW5jcyBoaWJtY19mYl9mdW5jcyA9
IHsKLQkuZGVzdHJveSA9IGhpYm1jX3VzZXJfZnJhbWVidWZmZXJfZGVzdHJveSwKLX07Ci0KLXN0
cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciAqCi1oaWJtY19mcmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsCi0JCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAq
bW9kZV9jbWQsCi0JCSAgICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1
Y3QgaGlibWNfZnJhbWVidWZmZXIgKmhpYm1jX2ZiOwotCWludCByZXQ7Ci0KLQloaWJtY19mYiA9
IGt6YWxsb2Moc2l6ZW9mKCpoaWJtY19mYiksIEdGUF9LRVJORUwpOwotCWlmICghaGlibWNfZmIp
IHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2NhdGUgaGlibWNfZmJcbiIpOwotCQlyZXR1
cm4gRVJSX1BUUigtRU5PTUVNKTsKLQl9Ci0KLQlkcm1faGVscGVyX21vZGVfZmlsbF9mYl9zdHJ1
Y3QoZGV2LCAmaGlibWNfZmItPmZiLCBtb2RlX2NtZCk7Ci0JaGlibWNfZmItPm9iaiA9IG9iajsK
LQlyZXQgPSBkcm1fZnJhbWVidWZmZXJfaW5pdChkZXYsICZoaWJtY19mYi0+ZmIsICZoaWJtY19m
Yl9mdW5jcyk7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoImRybV9mcmFtZWJ1ZmZlcl9pbml0
IGZhaWxlZDogJWRcbiIsIHJldCk7Ci0JCWtmcmVlKGhpYm1jX2ZiKTsKLQkJcmV0dXJuIEVSUl9Q
VFIocmV0KTsKLQl9Ci0KLQlyZXR1cm4gaGlibWNfZmI7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICoKLWhpYm1jX3VzZXJfZnJhbWVidWZmZXJfY3JlYXRlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCi0JCQkgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbHAsCi0JCQkgICAgICBj
b25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqbW9kZV9jbWQpCi17Ci0Jc3RydWN0IGRybV9n
ZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGhpYm1jX2ZyYW1lYnVmZmVyICpoaWJtY19mYjsKLQot
CURSTV9ERUJVR19EUklWRVIoIiVkeCVkLCBmb3JtYXQgJWMlYyVjJWNcbiIsCi0JCQkgbW9kZV9j
bWQtPndpZHRoLCBtb2RlX2NtZC0+aGVpZ2h0LAotCQkJIChtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0
KSAmIDB4ZmYsCi0JCQkgKG1vZGVfY21kLT5waXhlbF9mb3JtYXQgPj4gOCkgICYgMHhmZiwKLQkJ
CSAobW9kZV9jbWQtPnBpeGVsX2Zvcm1hdCA+PiAxNikgJiAweGZmLAotCQkJIChtb2RlX2NtZC0+
cGl4ZWxfZm9ybWF0ID4+IDI0KSAmIDB4ZmYpOwotCi0Jb2JqID0gZHJtX2dlbV9vYmplY3RfbG9v
a3VwKGZpbHAsIG1vZGVfY21kLT5oYW5kbGVzWzBdKTsKLQlpZiAoIW9iaikKLQkJcmV0dXJuIEVS
Ul9QVFIoLUVOT0VOVCk7Ci0KLQloaWJtY19mYiA9IGhpYm1jX2ZyYW1lYnVmZmVyX2luaXQoZGV2
LCBtb2RlX2NtZCwgb2JqKTsKLQlpZiAoSVNfRVJSKGhpYm1jX2ZiKSkgewotCQlkcm1fZ2VtX29i
amVjdF9wdXRfdW5sb2NrZWQob2JqKTsKLQkJcmV0dXJuIEVSUl9QVFIoKGxvbmcpaGlibWNfZmIp
OwotCX0KLQlyZXR1cm4gJmhpYm1jX2ZiLT5mYjsKLX0KLQogY29uc3Qgc3RydWN0IGRybV9tb2Rl
X2NvbmZpZ19mdW5jcyBoaWJtY19tb2RlX2Z1bmNzID0gewogCS5hdG9taWNfY2hlY2sgPSBkcm1f
YXRvbWljX2hlbHBlcl9jaGVjaywKIAkuYXRvbWljX2NvbW1pdCA9IGRybV9hdG9taWNfaGVscGVy
X2NvbW1pdCwKLQkuZmJfY3JlYXRlID0gaGlibWNfdXNlcl9mcmFtZWJ1ZmZlcl9jcmVhdGUsCisJ
LmZiX2NyZWF0ZSA9IGRybV9nZW1fZmJfY3JlYXRlLAogfTsKLS0gCjIuMjMuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcg
bGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
