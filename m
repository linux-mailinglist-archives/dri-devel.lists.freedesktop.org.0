Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B0AC5AB2E7
	for <lists+dri-devel@lfdr.de>; Fri,  6 Sep 2019 09:02:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CBFAA6E15E;
	Fri,  6 Sep 2019 07:01:13 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM03-CO1-obe.outbound.protection.outlook.com
 (mail-co1nam03on072f.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:fe48::72f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 22F7C89613
 for <dri-devel@lists.freedesktop.org>; Thu,  5 Sep 2019 08:28:59 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=MA6He+G64eAtD1dga8mrd4mD5eFb+kxtWTo6DKD6tfMH77SWUe4LmIC4NiiwCURVLJREcVUbbascfDLX/CvqLS+n6YTjexV5uQqev9HBuiT1HOQZSJqE/yYH0T4tT3kK/3suEgkR9S5Phv8x39Who4SOuQC/WB0YhvQwA6XjI2VYMbLzo3xI09Ue3cWWovBTmgCRS3M1cSRa0UAYI1Ea2neepfIdd4eltuxEGCLpTSl+jNVDPHy27fWh5fa2II5HPjx5XhWu1H3e5q3Ri8X36WKK7Db4Mz2VEgsyJ12lldOuagJ1ziOLTeJf3mo2l8pWiLKkSE6JmpHAOnl6oisWFQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=haH9JepbPcQOtePCWZKT5dLcP1YOXKm4gCWKb/AkfyI=;
 b=aZ7RMClAiTRpUQWlFhZh/VLVx/vgcZJp8Q7ce7i7tvEI4Seg/7ETb3xc1mi5/ONbLMzT2m0RHFBiXG0W+4snrTgGRZ2gLB+qqd8zpodusINLXTZTQ20w/kUqvN5hXqjIwxPtUny+tUQyu9jO/11fvocYQl8grH0/07jTeH7clfyHmmemkXPaCGcxpKJ5K8lce2bPXUXEHqFQmnMt9aRIpdbG9S/HFnDd1uT7yJp/apCtyciGG7fCWlYMor1fzBPNg/6YD2CeEYCCn93jLMoXueRqm6JHveF44Af0HELY99cO1jfM+gBo9/CSqXwrr/hrFKEBAIW2gRipJ37adxnyyw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from BY5PR21MB1396.namprd21.prod.outlook.com (20.180.35.80) by
 BY5PR21MB1506.namprd21.prod.outlook.com (20.180.35.76) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2263.7; Thu, 5 Sep 2019 08:28:51 +0000
Received: from BY5PR21MB1396.namprd21.prod.outlook.com
 ([fe80::6c6e:de3d:cdbf:997f]) by BY5PR21MB1396.namprd21.prod.outlook.com
 ([fe80::6c6e:de3d:cdbf:997f%2]) with mapi id 15.20.2263.005; Thu, 5 Sep 2019
 08:28:50 +0000
From: Wei Hu <weh@microsoft.com>
To: Michael Kelley <mikelley@microsoft.com>, "rdunlap@infradead.org"
 <rdunlap@infradead.org>, "shc_work@mail.ru" <shc_work@mail.ru>,
 "gregkh@linuxfoundation.org" <gregkh@linuxfoundation.org>,
 "lee.jones@linaro.org" <lee.jones@linaro.org>,
 "alexandre.belloni@bootlin.com" <alexandre.belloni@bootlin.com>,
 "baijiaju1990@gmail.com" <baijiaju1990@gmail.com>,
 "fthain@telegraphics.com.au" <fthain@telegraphics.com.au>, "info@metux.net"
 <info@metux.net>, "linux-hyperv@vger.kernel.org"
 <linux-hyperv@vger.kernel.org>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "linux-fbdev@vger.kernel.org"
 <linux-fbdev@vger.kernel.org>, "linux-kernel@vger.kernel.org"
 <linux-kernel@vger.kernel.org>, "sashal@kernel.org" <sashal@kernel.org>,
 Stephen Hemminger <sthemmin@microsoft.com>, Haiyang Zhang
 <haiyangz@microsoft.com>, KY Srinivasan <kys@microsoft.com>, Dexuan Cui
 <decui@microsoft.com>
Subject: [PATCH v3] video: hyperv: hyperv_fb: Support deferred IO for Hyper-V
 frame buffer driver
Thread-Topic: [PATCH v3] video: hyperv: hyperv_fb: Support deferred IO for
 Hyper-V frame buffer driver
Thread-Index: AQHVY8PxCEaneStSU0CIK0oNOZcaZw==
Date: Thu, 5 Sep 2019 08:28:50 +0000
Message-ID: <20190905082816.3612-1-weh@microsoft.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: SG2PR06CA0129.apcprd06.prod.outlook.com
 (2603:1096:1:1d::31) To BY5PR21MB1396.namprd21.prod.outlook.com
 (2603:10b6:a03:23d::16)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.20.1
x-originating-ip: [167.220.255.49]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 1a64de68-bc49-45cd-6426-08d731db1439
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:BY5PR21MB1506; 
x-ms-traffictypediagnostic: BY5PR21MB1506:|BY5PR21MB1506:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <BY5PR21MB15060CFDBB12FA66EEBDD420BBBB0@BY5PR21MB1506.namprd21.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:8273;
x-forefront-prvs: 015114592F
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(4636009)(366004)(376002)(396003)(346002)(39860400002)(136003)(199004)(189003)(2201001)(478600001)(36756003)(86362001)(7416002)(30864003)(6636002)(81166006)(10290500003)(6506007)(1076003)(50226002)(386003)(81156014)(3450700001)(8676002)(52116002)(8936002)(14454004)(66066001)(43066004)(99286004)(1511001)(5660300002)(186003)(486006)(25786009)(4326008)(476003)(10090500001)(2906002)(3846002)(107886003)(2616005)(53936002)(6512007)(256004)(2501003)(14444005)(6436002)(1250700005)(26005)(66556008)(305945005)(71190400001)(71200400001)(6116002)(316002)(7736002)(102836004)(110136005)(6486002)(22452003)(66476007)(64756008)(66446008)(66946007)(921003)(1121003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:BY5PR21MB1506;
 H:BY5PR21MB1396.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: sobgKV55C5Ibe9rFSN6Hh7HYNVIqtJ5Sa1ZZfslEX7yfarKDMQDe6zPu5jB/ZC0DfXwtxhy5sjqRQFS4JRTkc169AXXJv+X9ysnPJC9J8r1oFymhB9xITMVk+BbLpaDm0xu/KBLhZXAmgcqa7NNOIJAJy2DQBQz7Q93//8bW00cNXuLgbbTdGS4DVUvZNWsGSornXYE6v8Ilv13BJJvIIYvbY/LlRb/b+0hIzClKwRCB6ylf5OAi4AvRq3bELhOoOEWeKGHe+3HGv89JyE8XTHl1rVCaZ9S5eQ/XK0i4gkRyFZ4WacyNzrHh+Z7e4VJGb0nJ/becVGYVFSF0SRUB7Bmx10usA/gsQFtbfEDYYpzul2602GVShQo/EX8RNGRPVWC+tikHk5n+xcoZpa782l6HFH3BXIeQ+E/liwqAyCo=
MIME-Version: 1.0
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 1a64de68-bc49-45cd-6426-08d731db1439
X-MS-Exchange-CrossTenant-originalarrivaltime: 05 Sep 2019 08:28:50.6571 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: l/p2zn/H6XfEIbLyqOuMn8ye65qPzOv8UOxihQEez3UxyFUrRNxpRRhJWBbOtyKMz/+6ltN/m+pl4escTI51IA==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BY5PR21MB1506
X-Mailman-Approved-At: Fri, 06 Sep 2019 07:01:00 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=haH9JepbPcQOtePCWZKT5dLcP1YOXKm4gCWKb/AkfyI=;
 b=F4qluKkx9CLjQxDvd/7QbvCBu4WwW/QwA02z8UNiUPEtn4iWJo/PVgqRJNAufUxT94LU5GQk5LE+ux5Ylp1JvKI7eAkV4znXYQnP93ey2I51TXmMQ/nAvlesW7SGpcJI1KBTb1a1APPTVNXyjQw5HD1Mmu3RbRDFJFd89wKJUCU=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: Wei Hu <weh@microsoft.com>
Cc: Wei Hu <weh@microsoft.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2l0aG91dCBkZWZlcnJlZCBJTyBzdXBwb3J0LCBoeXBlcnZfZmIgZHJpdmVyIGluZm9ybXMgdGhl
IGhvc3QgdG8gcmVmcmVzaAp0aGUgZW50aXJlIGd1ZXN0IGZyYW1lIGJ1ZmZlciBhdCBmaXhlZCBy
YXRlLCBlLmcuIGF0IDIwSHosIG5vIG1hdHRlciB0aGVyZQppcyBzY3JlZW4gdXBkYXRlIG9yIG5v
dC4gVGhpcyBwYXRjaCBzdXBwb3J0cyBkZWZlcnJlZCBJTyBmb3Igc2NyZWVucyBpbgpncmFwaGlj
cyBtb2RlIGFuZCBhbHNvIGVuYWJsZXMgdGhlIGZyYW1lIGJ1ZmZlciBvbi1kZW1hbmQgcmVmcmVz
aC4gVGhlCmhpZ2hlc3QgcmVmcmVzaCByYXRlIGlzIHN0aWxsIHNldCBhdCAyMEh6LgoKQ3VycmVu
dGx5IEh5cGVyLVYgb25seSB0YWtlcyBhIHBoeXNpY2FsIGFkZHJlc3MgZnJvbSBndWVzdCBhcyB0
aGUgc3RhcnRpbmcKYWRkcmVzcyBvZiBmcmFtZSBidWZmZXIuIFRoaXMgaW1wbGllcyB0aGUgZ3Vl
c3QgbXVzdCBhbGxvY2F0ZSBjb250aWd1b3VzCnBoeXNpY2FsIG1lbW9yeSBmb3IgZnJhbWUgYnVm
ZmVyLiBJbiBhZGRpdGlvbiwgSHlwZXItViBHZW4gMiBWTXMgb25seQphY2NlcHQgYWRkcmVzcyBm
cm9tIE1NSU8gcmVnaW9uIGFzIGZyYW1lIGJ1ZmZlciBhZGRyZXNzLiBEdWUgdG8gdGhlc2UKbGlt
aXRhdGlvbnMgb24gSHlwZXItViBob3N0LCB3ZSBrZWVwIGEgc2hhZG93IGNvcHkgb2YgZnJhbWUg
YnVmZmVyCmluIHRoZSBndWVzdC4gVGhpcyBtZWFucyBvbmUgbW9yZSBjb3B5IG9mIHRoZSBkaXJ0
eSByZWN0YW5nbGUgaW5zaWRlCmd1ZXN0IHdoZW4gZG9pbmcgdGhlIG9uLWRlbWFuZCByZWZyZXNo
LiBUaGlzIGNhbiBiZSBvcHRpbWl6ZWQgaW4gdGhlCmZ1dHVyZSB3aXRoIGhlbHAgZnJvbSBob3N0
LiBGb3Igbm93IHRoZSBob3N0IHBlcmZvcm1hbmNlIGdhaW4gZnJvbSBkZWZlcnJlZApJTyBvdXR3
ZWlnaHMgdGhlIHNoYWRvdyBjb3B5IGltcGFjdCBpbiB0aGUgZ3Vlc3QuCgpTaWduZWQtb2ZmLWJ5
OiBXZWkgSHUgPHdlaEBtaWNyb3NvZnQuY29tPgotLS0KICAgIHYyOiBJbmNvcnBvcmF0ZWQgcmV2
aWV3IGNvbW1lbnRzIGZyb20gTWljaGFlbCBLZWxsZXkKICAgIC0gSW5jcmVhc2VkIGRpcnR5IHJl
Y3RhbmdsZSBieSBvbmUgcm93IGluIGRlZmVycmVkIElPIGNhc2Ugd2hlbiBzZW5kaW5nCiAgICB0
byBIeXBlci1WLgogICAgLSBDb3JyZWN0ZWQgdGhlIGRpcnR5IHJlY3RhbmdsZSBzaXplIGluIHRo
ZSB0ZXh0IG1vZGUuCiAgICAtIEFkZGVkIG1vcmUgY29tbWVudHMuCiAgICAtIE90aGVyIG1pbm9y
IGNvZGUgY2xlYW51cHMuCgogICAgdjM6IEluY29ycG9yYXRlZCBtb3JlIHJldmlldyBjb21tZW50
cwogICAgLSBSZW1vdmVkIGEgZmV3IHVubmVjZXNzYXJ5IHZhcmlhYmxlIHRlc3RzCgogZHJpdmVy
cy92aWRlby9mYmRldi9LY29uZmlnICAgICB8ICAgMSArCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5
cGVydl9mYi5jIHwgMjE2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tCiAyIGZpbGVz
IGNoYW5nZWQsIDE5NyBpbnNlcnRpb25zKCspLCAyMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25m
aWcKaW5kZXggMWIyZjVmMzFmYjZmLi5lNzgxZjg5YTE4MjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
dmlkZW8vZmJkZXYvS2NvbmZpZworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcKQEAg
LTIyNDEsNiArMjI0MSw3IEBAIGNvbmZpZyBGQl9IWVBFUlYKIAlzZWxlY3QgRkJfQ0ZCX0ZJTExS
RUNUCiAJc2VsZWN0IEZCX0NGQl9DT1BZQVJFQQogCXNlbGVjdCBGQl9DRkJfSU1BR0VCTElUCisJ
c2VsZWN0IEZCX0RFRkVSUkVEX0lPCiAJaGVscAogCSAgVGhpcyBmcmFtZWJ1ZmZlciBkcml2ZXIg
c3VwcG9ydHMgTWljcm9zb2Z0IEh5cGVyLVYgU3ludGhldGljIFZpZGVvLgogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jIGIvZHJpdmVycy92aWRlby9mYmRldi9o
eXBlcnZfZmIuYwppbmRleCAxNDY0YzZmMTQ2ODcuLjYzYmZkMzVlMzkyYyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2
L2h5cGVydl9mYi5jCkBAIC0yMzcsNiArMjM3LDcgQEAgc3RydWN0IHN5bnRodmlkX21zZyB7CiAj
ZGVmaW5lIFJJTkdfQlVGU0laRSAoMjU2ICogMTAyNCkKICNkZWZpbmUgVlNQX1RJTUVPVVQgKDEw
ICogSFopCiAjZGVmaW5lIEhWRkJfVVBEQVRFX0RFTEFZIChIWiAvIDIwKQorI2RlZmluZSBIVkZC
X09OREVNQU5EX1RIUk9UVExFIChIWiAvIDIwKQogCiBzdHJ1Y3QgaHZmYl9wYXIgewogCXN0cnVj
dCBmYl9pbmZvICppbmZvOwpAQCAtMjU2LDYgKzI1NywxNyBAQCBzdHJ1Y3QgaHZmYl9wYXIgewog
CWJvb2wgc3luY2hyb25vdXNfZmI7CiAKIAlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgaHZmYl9wYW5p
Y19uYjsKKworCS8qIE1lbW9yeSBmb3IgZGVmZXJyZWQgSU8gYW5kIGZyYW1lIGJ1ZmZlciBpdHNl
bGYgKi8KKwl1bnNpZ25lZCBjaGFyICpkaW9fdnA7CisJdW5zaWduZWQgY2hhciAqbW1pb192cDsK
Kwl1bnNpZ25lZCBsb25nIG1taW9fcHA7CisJc3BpbmxvY2tfdCBkb2NvcHlfbG9jazsgLyogTG9j
ayB0byBwcm90ZWN0IG1lbW9yeSBjb3B5ICovCisKKwkvKiBEaXJ0eSByZWN0YW5nbGUsIHByb3Rl
Y3RlZCBieSBkZWxheWVkX3JlZnJlc2hfbG9jayAqLworCWludCB4MSwgeTEsIHgyLCB5MjsKKwli
b29sIGRlbGF5ZWRfcmVmcmVzaDsKKwlzcGlubG9ja190IGRlbGF5ZWRfcmVmcmVzaF9sb2NrOwog
fTsKIAogc3RhdGljIHVpbnQgc2NyZWVuX3dpZHRoID0gSFZGQl9XSURUSDsKQEAgLTI2NCw2ICsy
NzYsNyBAQCBzdGF0aWMgdWludCBzY3JlZW5fd2lkdGhfbWF4ID0gSFZGQl9XSURUSDsKIHN0YXRp
YyB1aW50IHNjcmVlbl9oZWlnaHRfbWF4ID0gSFZGQl9IRUlHSFQ7CiBzdGF0aWMgdWludCBzY3Jl
ZW5fZGVwdGg7CiBzdGF0aWMgdWludCBzY3JlZW5fZmJfc2l6ZTsKK3N0YXRpYyB1aW50IGRpb19m
Yl9zaXplOyAvKiBGQiBzaXplIGZvciBkZWZlcnJlZCBJTyAqLwogCiAvKiBTZW5kIG1lc3NhZ2Ug
dG8gSHlwZXItViBob3N0ICovCiBzdGF0aWMgaW5saW5lIGludCBzeW50aHZpZF9zZW5kKHN0cnVj
dCBodl9kZXZpY2UgKmhkZXYsCkBAIC0zNTAsMjggKzM2Myw5MiBAQCBzdGF0aWMgaW50IHN5bnRo
dmlkX3NlbmRfcHRyKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYpCiB9CiAKIC8qIFNlbmQgdXBkYXRl
ZCBzY3JlZW4gYXJlYSAoZGlydHkgcmVjdGFuZ2xlKSBsb2NhdGlvbiB0byBob3N0ICovCi1zdGF0
aWMgaW50IHN5bnRodmlkX3VwZGF0ZShzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKK3N0YXRpYyBpbnQK
K3N5bnRodmlkX3VwZGF0ZShzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgaW50IHgxLCBpbnQgeTEsIGlu
dCB4MiwgaW50IHkyKQogewogCXN0cnVjdCBodl9kZXZpY2UgKmhkZXYgPSBkZXZpY2VfdG9faHZf
ZGV2aWNlKGluZm8tPmRldmljZSk7CiAJc3RydWN0IHN5bnRodmlkX21zZyBtc2c7CiAKIAltZW1z
ZXQoJm1zZywgMCwgc2l6ZW9mKHN0cnVjdCBzeW50aHZpZF9tc2cpKTsKKwlpZiAoeDIgPT0gSU5U
X01BWCkKKwkJeDIgPSBpbmZvLT52YXIueHJlczsKKwlpZiAoeTIgPT0gSU5UX01BWCkKKwkJeTIg
PSBpbmZvLT52YXIueXJlczsKIAogCW1zZy52aWRfaGRyLnR5cGUgPSBTWU5USFZJRF9ESVJUOwog
CW1zZy52aWRfaGRyLnNpemUgPSBzaXplb2Yoc3RydWN0IHN5bnRodmlkX21zZ19oZHIpICsKIAkJ
c2l6ZW9mKHN0cnVjdCBzeW50aHZpZF9kaXJ0KTsKIAltc2cuZGlydC52aWRlb19vdXRwdXQgPSAw
OwogCW1zZy5kaXJ0LmRpcnRfY291bnQgPSAxOwotCW1zZy5kaXJ0LnJlY3RbMF0ueDEgPSAwOwot
CW1zZy5kaXJ0LnJlY3RbMF0ueTEgPSAwOwotCW1zZy5kaXJ0LnJlY3RbMF0ueDIgPSBpbmZvLT52
YXIueHJlczsKLQltc2cuZGlydC5yZWN0WzBdLnkyID0gaW5mby0+dmFyLnlyZXM7CisJbXNnLmRp
cnQucmVjdFswXS54MSA9ICh4MSA+IHgyKSA/IDAgOiB4MTsKKwltc2cuZGlydC5yZWN0WzBdLnkx
ID0gKHkxID4geTIpID8gMCA6IHkxOworCW1zZy5kaXJ0LnJlY3RbMF0ueDIgPQorCQkoeDIgPCB4
MSB8fCB4MiA+IGluZm8tPnZhci54cmVzKSA/IGluZm8tPnZhci54cmVzIDogeDI7CisJbXNnLmRp
cnQucmVjdFswXS55MiA9CisJCSh5MiA8IHkxIHx8IHkyID4gaW5mby0+dmFyLnlyZXMpID8gaW5m
by0+dmFyLnlyZXMgOiB5MjsKIAogCXN5bnRodmlkX3NlbmQoaGRldiwgJm1zZyk7CiAKIAlyZXR1
cm4gMDsKIH0KIAorc3RhdGljIHZvaWQgaHZmYl9kb2NvcHkoc3RydWN0IGh2ZmJfcGFyICpwYXIs
CisJCQl1bnNpZ25lZCBsb25nIG9mZnNldCwKKwkJCXVuc2lnbmVkIGxvbmcgc2l6ZSkKK3sKKwlp
ZiAoIXBhciB8fCAhcGFyLT5tbWlvX3ZwIHx8ICFwYXItPmRpb192cCB8fCAhcGFyLT5mYl9yZWFk
eSB8fAorCSAgICBzaXplID09IDAgfHwgb2Zmc2V0ID49IGRpb19mYl9zaXplKQorCQlyZXR1cm47
CisKKwlpZiAob2Zmc2V0ICsgc2l6ZSA+IGRpb19mYl9zaXplKQorCQlzaXplID0gZGlvX2ZiX3Np
emUgLSBvZmZzZXQ7CisKKwltZW1jcHkocGFyLT5tbWlvX3ZwICsgb2Zmc2V0LCBwYXItPmRpb192
cCArIG9mZnNldCwgc2l6ZSk7Cit9CisKKy8qIERlZmVycmVkIElPIGNhbGxiYWNrICovCitzdGF0
aWMgdm9pZCBzeW50aHZpZF9kZWZlcnJlZF9pbyhzdHJ1Y3QgZmJfaW5mbyAqcCwKKwkJCQkgc3Ry
dWN0IGxpc3RfaGVhZCAqcGFnZWxpc3QpCit7CisJc3RydWN0IGh2ZmJfcGFyICpwYXIgPSBwLT5w
YXI7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJdW5zaWduZWQgbG9uZyBzdGFydCwgZW5kOworCWlu
dCB5MSwgeTIsIG1pbnksIG1heHk7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCW1pbnkgPSBJ
TlRfTUFYOworCW1heHkgPSAwOworCisJLyoKKwkgKiBNZXJnZSBkaXJ0eSBwYWdlcy4gSXQgaXMg
cG9zc2libGUgdGhhdCBsYXN0IHBhZ2UgY3Jvc3MKKwkgKiBvdmVyIHRoZSBlbmQgb2YgZnJhbWUg
YnVmZmVyIHJvdyB5cmVzLiBUaGlzIGlzIHRha2VuIGNhcmUgb2YKKwkgKiBpbiBzeW50aHZpZF91
cGRhdGUgZnVuY3Rpb24gYnkgY2xhbXBpbmcgdGhlIHkyCisJICogdmFsdWUgdG8geXJlcy4KKwkg
Ki8KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBhZ2UsIHBhZ2VsaXN0LCBscnUpIHsKKwkJc3RhcnQg
PSBwYWdlLT5pbmRleCA8PCBQQUdFX1NISUZUOworCQllbmQgPSBzdGFydCArIFBBR0VfU0laRSAt
IDE7CisJCXkxID0gc3RhcnQgLyBwLT5maXgubGluZV9sZW5ndGg7CisJCXkyID0gZW5kIC8gcC0+
Zml4LmxpbmVfbGVuZ3RoOworCQltaW55ID0gbWluX3QoaW50LCBtaW55LCB5MSk7CisJCW1heHkg
PSBtYXhfdChpbnQsIG1heHksIHkyKTsKKworCQkvKiBDb3B5IGZyb20gZGlvIHNwYWNlIHRvIG1t
aW8gYWRkcmVzcyAqLworCQlpZiAocGFyLT5mYl9yZWFkeSkgeworCQkJc3Bpbl9sb2NrX2lycXNh
dmUoJnBhci0+ZG9jb3B5X2xvY2ssIGZsYWdzKTsKKwkJCWh2ZmJfZG9jb3B5KHBhciwgc3RhcnQs
IFBBR0VfU0laRSk7CisJCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwYXItPmRvY29weV9sb2Nr
LCBmbGFncyk7CisJCX0KKwl9CisKKwlpZiAocGFyLT5mYl9yZWFkeSkKKwkJc3ludGh2aWRfdXBk
YXRlKHAsIDAsIG1pbnksIHAtPnZhci54cmVzLCBtYXh5ICsgMSk7Cit9CisKK3N0YXRpYyBzdHJ1
Y3QgZmJfZGVmZXJyZWRfaW8gc3ludGh2aWRfZGVmaW8gPSB7CisJLmRlbGF5CQk9IEhaIC8gMjAs
CisJLmRlZmVycmVkX2lvCT0gc3ludGh2aWRfZGVmZXJyZWRfaW8sCit9OwogCiAvKgogICogQWN0
aW9ucyBvbiByZWNlaXZlZCBtZXNzYWdlcyBmcm9tIGhvc3Q6CkBAIC02MTgsNyArNjk1LDcgQEAg
c3RhdGljIGludCBzeW50aHZpZF9zZW5kX2NvbmZpZyhzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2KQog
CW1zZy0+dmlkX2hkci50eXBlID0gU1lOVEhWSURfVlJBTV9MT0NBVElPTjsKIAltc2ctPnZpZF9o
ZHIuc2l6ZSA9IHNpemVvZihzdHJ1Y3Qgc3ludGh2aWRfbXNnX2hkcikgKwogCQlzaXplb2Yoc3Ry
dWN0IHN5bnRodmlkX3ZyYW1fbG9jYXRpb24pOwotCW1zZy0+dnJhbS51c2VyX2N0eCA9IG1zZy0+
dnJhbS52cmFtX2dwYSA9IGluZm8tPmZpeC5zbWVtX3N0YXJ0OworCW1zZy0+dnJhbS51c2VyX2N0
eCA9IG1zZy0+dnJhbS52cmFtX2dwYSA9IHBhci0+bW1pb19wcDsKIAltc2ctPnZyYW0uaXNfdnJh
bV9ncGFfc3BlY2lmaWVkID0gMTsKIAlzeW50aHZpZF9zZW5kKGhkZXYsIG1zZyk7CiAKQEAgLTYy
OCw3ICs3MDUsNyBAQCBzdGF0aWMgaW50IHN5bnRodmlkX3NlbmRfY29uZmlnKHN0cnVjdCBodl9k
ZXZpY2UgKmhkZXYpCiAJCXJldCA9IC1FVElNRURPVVQ7CiAJCWdvdG8gb3V0OwogCX0KLQlpZiAo
bXNnLT52cmFtX2Fjay51c2VyX2N0eCAhPSBpbmZvLT5maXguc21lbV9zdGFydCkgeworCWlmICht
c2ctPnZyYW1fYWNrLnVzZXJfY3R4ICE9IHBhci0+bW1pb19wcCkgewogCQlwcl9lcnIoIlVuYWJs
ZSB0byBzZXQgVlJBTSBsb2NhdGlvblxuIik7CiAJCXJldCA9IC1FTk9ERVY7CiAJCWdvdG8gb3V0
OwpAQCAtNjQ1LDE5ICs3MjIsNzkgQEAgc3RhdGljIGludCBzeW50aHZpZF9zZW5kX2NvbmZpZyhz
dHJ1Y3QgaHZfZGV2aWNlICpoZGV2KQogCiAvKgogICogRGVsYXllZCB3b3JrIGNhbGxiYWNrOgot
ICogSXQgaXMgY2FsbGVkIGF0IEhWRkJfVVBEQVRFX0RFTEFZIG9yIGxvbmdlciB0aW1lIGludGVy
dmFsIHRvIHByb2Nlc3MKLSAqIHNjcmVlbiB1cGRhdGVzLiBJdCBpcyByZS1zY2hlZHVsZWQgaWYg
ZnVydGhlciB1cGRhdGUgaXMgbmVjZXNzYXJ5LgorICogSXQgaXMgc2NoZWR1bGVkIHRvIGNhbGwg
d2hlbmV2ZXIgdXBkYXRlIHJlcXVlc3QgaXMgcmVjZWl2ZWQgYW5kIGl0IGhhcworICogbm90IGJl
ZW4gY2FsbGVkIGluIGxhc3QgSFZGQl9PTkRFTUFORF9USFJPVFRMRSB0aW1lIGludGVydmFsLgog
ICovCiBzdGF0aWMgdm9pZCBodmZiX3VwZGF0ZV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqdykK
IHsKIAlzdHJ1Y3QgaHZmYl9wYXIgKnBhciA9IGNvbnRhaW5lcl9vZih3LCBzdHJ1Y3QgaHZmYl9w
YXIsIGR3b3JrLndvcmspOwogCXN0cnVjdCBmYl9pbmZvICppbmZvID0gcGFyLT5pbmZvOworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CisJaW50IHgxLCB4MiwgeTEsIHkyOworCWludCBqOworCisJc3Bp
bl9sb2NrX2lycXNhdmUoJnBhci0+ZGVsYXllZF9yZWZyZXNoX2xvY2ssIGZsYWdzKTsKKwkvKiBS
ZXNldCB0aGUgcmVxdWVzdCBmbGFnICovCisJcGFyLT5kZWxheWVkX3JlZnJlc2ggPSBmYWxzZTsK
KworCS8qIFN0b3JlIHRoZSBkaXJ0eSByZWN0YW5nbGUgdG8gbG9jYWwgdmFyaWFibGVzICovCisJ
eDEgPSBwYXItPngxOworCXgyID0gcGFyLT54MjsKKwl5MSA9IHBhci0+eTE7CisJeTIgPSBwYXIt
PnkyOworCisJLyogQ2xlYXIgZGlydHkgcmVjdGFuZ2xlICovCisJcGFyLT54MSA9IHBhci0+eTEg
PSBJTlRfTUFYOworCXBhci0+eDIgPSBwYXItPnkyID0gMDsKKworCXNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJnBhci0+ZGVsYXllZF9yZWZyZXNoX2xvY2ssIGZsYWdzKTsKIAorCWlmICh4MSA+IGlu
Zm8tPnZhci54cmVzIHx8IHgyID4gaW5mby0+dmFyLnhyZXMgfHwKKwkgICAgeTEgPiBpbmZvLT52
YXIueXJlcyB8fCB5MiA+IGluZm8tPnZhci55cmVzIHx8IHgyIDw9IHgxKQorCQlyZXR1cm47CisK
KwkvKiBDb3B5IHRoZSBkaXJ0eSByZWN0YW5nbGUgdG8gZnJhbWUgYnVmZmVyIG1lbW9yeSAqLwor
CXNwaW5fbG9ja19pcnFzYXZlKCZwYXItPmRvY29weV9sb2NrLCBmbGFncyk7CisJZm9yIChqID0g
eTE7IGogPCB5MjsgaisrKSB7CisJCWh2ZmJfZG9jb3B5KHBhciwKKwkJCSAgICBqICogaW5mby0+
Zml4LmxpbmVfbGVuZ3RoICsKKwkJCSAgICAoeDEgKiBzY3JlZW5fZGVwdGggLyA4KSwKKwkJCSAg
ICAoeDIgLSB4MSkgKiBzY3JlZW5fZGVwdGggLyA4KTsKKwl9CisJc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmcGFyLT5kb2NvcHlfbG9jaywgZmxhZ3MpOworCisJLyogUmVmcmVzaCAqLwogCWlmIChw
YXItPmZiX3JlYWR5KQotCQlzeW50aHZpZF91cGRhdGUoaW5mbyk7CisJCXN5bnRodmlkX3VwZGF0
ZShpbmZvLCB4MSwgeTEsIHgyLCB5Mik7Cit9CiAKLQlpZiAocGFyLT51cGRhdGUpCi0JCXNjaGVk
dWxlX2RlbGF5ZWRfd29yaygmcGFyLT5kd29yaywgSFZGQl9VUERBVEVfREVMQVkpOworLyoKKyAq
IENvbnRyb2wgdGhlIG9uLWRlbWFuZCByZWZyZXNoIGZyZXF1ZW5jeS4gSXQgc2NoZWR1bGVzIGEg
ZGVsYXllZAorICogc2NyZWVuIHVwZGF0ZSBpZiBpdCBoYXMgbm90IHlldC4KKyAqLworc3RhdGlj
IHZvaWQgaHZmYl9vbmRlbWFuZF9yZWZyZXNoX3Rocm90dGxlKHN0cnVjdCBodmZiX3BhciAqcGFy
LAorCQkJCQkgICBpbnQgeDEsIGludCB5MSwgaW50IHcsIGludCBoKQoreworCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7CisJaW50IHgyID0geDEgKyB3OworCWludCB5MiA9IHkxICsgaDsKKworCXNwaW5f
bG9ja19pcnFzYXZlKCZwYXItPmRlbGF5ZWRfcmVmcmVzaF9sb2NrLCBmbGFncyk7CisKKwkvKiBN
ZXJnZSBkaXJ0eSByZWN0YW5nbGUgKi8KKwlwYXItPngxID0gbWluX3QoaW50LCBwYXItPngxLCB4
MSk7CisJcGFyLT55MSA9IG1pbl90KGludCwgcGFyLT55MSwgeTEpOworCXBhci0+eDIgPSBtYXhf
dChpbnQsIHBhci0+eDIsIHgyKTsKKwlwYXItPnkyID0gbWF4X3QoaW50LCBwYXItPnkyLCB5Mik7
CisKKwkvKiBTY2hlZHVsZSBhIGRlbGF5ZWQgc2NyZWVuIHVwZGF0ZSBpZiBub3QgeWV0ICovCisJ
aWYgKHBhci0+ZGVsYXllZF9yZWZyZXNoID09IGZhbHNlKSB7CisJCXNjaGVkdWxlX2RlbGF5ZWRf
d29yaygmcGFyLT5kd29yaywKKwkJCQkgICAgICBIVkZCX09OREVNQU5EX1RIUk9UVExFKTsKKwkJ
cGFyLT5kZWxheWVkX3JlZnJlc2ggPSB0cnVlOworCX0KKworCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJnBhci0+ZGVsYXllZF9yZWZyZXNoX2xvY2ssIGZsYWdzKTsKIH0KIAogc3RhdGljIGludCBo
dmZiX29uX3BhbmljKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsCkBAIC02NjksNyArODA2LDgg
QEAgc3RhdGljIGludCBodmZiX29uX3BhbmljKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsCiAJ
cGFyID0gY29udGFpbmVyX29mKG5iLCBzdHJ1Y3QgaHZmYl9wYXIsIGh2ZmJfcGFuaWNfbmIpOwog
CXBhci0+c3luY2hyb25vdXNfZmIgPSB0cnVlOwogCWluZm8gPSBwYXItPmluZm87Ci0Jc3ludGh2
aWRfdXBkYXRlKGluZm8pOworCWh2ZmJfZG9jb3B5KHBhciwgMCwgZGlvX2ZiX3NpemUpOworCXN5
bnRodmlkX3VwZGF0ZShpbmZvLCAwLCAwLCBJTlRfTUFYLCBJTlRfTUFYKTsKIAogCXJldHVybiBO
T1RJRllfRE9ORTsKIH0KQEAgLTczMCw3ICs4NjgsMTAgQEAgc3RhdGljIHZvaWQgaHZmYl9jZmJf
ZmlsbHJlY3Qoc3RydWN0IGZiX2luZm8gKnAsCiAKIAljZmJfZmlsbHJlY3QocCwgcmVjdCk7CiAJ
aWYgKHBhci0+c3luY2hyb25vdXNfZmIpCi0JCXN5bnRodmlkX3VwZGF0ZShwKTsKKwkJc3ludGh2
aWRfdXBkYXRlKHAsIDAsIDAsIElOVF9NQVgsIElOVF9NQVgpOworCWVsc2UKKwkJaHZmYl9vbmRl
bWFuZF9yZWZyZXNoX3Rocm90dGxlKHBhciwgcmVjdC0+ZHgsIHJlY3QtPmR5LAorCQkJCQkgICAg
ICAgcmVjdC0+d2lkdGgsIHJlY3QtPmhlaWdodCk7CiB9CiAKIHN0YXRpYyB2b2lkIGh2ZmJfY2Zi
X2NvcHlhcmVhKHN0cnVjdCBmYl9pbmZvICpwLApAQCAtNzQwLDcgKzg4MSwxMCBAQCBzdGF0aWMg
dm9pZCBodmZiX2NmYl9jb3B5YXJlYShzdHJ1Y3QgZmJfaW5mbyAqcCwKIAogCWNmYl9jb3B5YXJl
YShwLCBhcmVhKTsKIAlpZiAocGFyLT5zeW5jaHJvbm91c19mYikKLQkJc3ludGh2aWRfdXBkYXRl
KHApOworCQlzeW50aHZpZF91cGRhdGUocCwgMCwgMCwgSU5UX01BWCwgSU5UX01BWCk7CisJZWxz
ZQorCQlodmZiX29uZGVtYW5kX3JlZnJlc2hfdGhyb3R0bGUocGFyLCBhcmVhLT5keCwgYXJlYS0+
ZHksCisJCQkJCSAgICAgICBhcmVhLT53aWR0aCwgYXJlYS0+aGVpZ2h0KTsKIH0KIAogc3RhdGlj
IHZvaWQgaHZmYl9jZmJfaW1hZ2VibGl0KHN0cnVjdCBmYl9pbmZvICpwLApAQCAtNzUwLDcgKzg5
NCwxMCBAQCBzdGF0aWMgdm9pZCBodmZiX2NmYl9pbWFnZWJsaXQoc3RydWN0IGZiX2luZm8gKnAs
CiAKIAljZmJfaW1hZ2VibGl0KHAsIGltYWdlKTsKIAlpZiAocGFyLT5zeW5jaHJvbm91c19mYikK
LQkJc3ludGh2aWRfdXBkYXRlKHApOworCQlzeW50aHZpZF91cGRhdGUocCwgMCwgMCwgSU5UX01B
WCwgSU5UX01BWCk7CisJZWxzZQorCQlodmZiX29uZGVtYW5kX3JlZnJlc2hfdGhyb3R0bGUocGFy
LCBpbWFnZS0+ZHgsIGltYWdlLT5keSwKKwkJCQkJICAgICAgIGltYWdlLT53aWR0aCwgaW1hZ2Ut
PmhlaWdodCk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZmJfb3BzIGh2ZmJfb3BzID0gewpAQCAtODA5
LDYgKzk1Niw5IEBAIHN0YXRpYyBpbnQgaHZmYl9nZXRtZW0oc3RydWN0IGh2X2RldmljZSAqaGRl
diwgc3RydWN0IGZiX2luZm8gKmluZm8pCiAJcmVzb3VyY2Vfc2l6ZV90IHBvdF9zdGFydCwgcG90
X2VuZDsKIAlpbnQgcmV0OwogCisJZGlvX2ZiX3NpemUgPQorCQlzY3JlZW5fd2lkdGggKiBzY3Jl
ZW5faGVpZ2h0ICogc2NyZWVuX2RlcHRoIC8gODsKKwogCWlmIChnZW4ydm0pIHsKIAkJcG90X3N0
YXJ0ID0gMDsKIAkJcG90X2VuZCA9IC0xOwpAQCAtODQzLDkgKzk5MywxNCBAQCBzdGF0aWMgaW50
IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBmYl9pbmZvICppbmZv
KQogCWlmICghZmJfdmlydCkKIAkJZ290byBlcnIyOwogCisJLyogQWxsb2NhdGUgbWVtb3J5IGZv
ciBkZWZlcnJlZCBJTyAqLworCXBhci0+ZGlvX3ZwID0gdnphbGxvYyhyb3VuZF91cChkaW9fZmJf
c2l6ZSwgUEFHRV9TSVpFKSk7CisJaWYgKHBhci0+ZGlvX3ZwID09IE5VTEwpCisJCWdvdG8gZXJy
MzsKKwogCWluZm8tPmFwZXJ0dXJlcyA9IGFsbG9jX2FwZXJ0dXJlcygxKTsKIAlpZiAoIWluZm8t
PmFwZXJ0dXJlcykKLQkJZ290byBlcnIzOworCQlnb3RvIGVycjQ7CiAKIAlpZiAoZ2VuMnZtKSB7
CiAJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBzY3JlZW5faW5mby5sZmJfYmFz
ZTsKQEAgLTg1NywxNiArMTAxMiwyMyBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBo
dl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBmYl9pbmZvICppbmZvKQogCQlpbmZvLT5hcGVydHVyZXMt
PnJhbmdlc1swXS5zaXplID0gcGNpX3Jlc291cmNlX2xlbihwZGV2LCAwKTsKIAl9CiAKKwkvKiBQ
aHlzaWNhbCBhZGRyZXNzIG9mIEZCIGRldmljZSAqLworCXBhci0+bW1pb19wcCA9IHBhci0+bWVt
LT5zdGFydDsKKwkvKiBWaXJ0dWFsIGFkZHJlc3Mgb2YgRkIgZGV2aWNlICovCisJcGFyLT5tbWlv
X3ZwID0gKHVuc2lnbmVkIGNoYXIgKikgZmJfdmlydDsKKwogCWluZm8tPmZpeC5zbWVtX3N0YXJ0
ID0gcGFyLT5tZW0tPnN0YXJ0OwotCWluZm8tPmZpeC5zbWVtX2xlbiA9IHNjcmVlbl9mYl9zaXpl
OwotCWluZm8tPnNjcmVlbl9iYXNlID0gZmJfdmlydDsKLQlpbmZvLT5zY3JlZW5fc2l6ZSA9IHNj
cmVlbl9mYl9zaXplOworCWluZm8tPmZpeC5zbWVtX2xlbiA9IGRpb19mYl9zaXplOworCWluZm8t
PnNjcmVlbl9iYXNlID0gcGFyLT5kaW9fdnA7CisJaW5mby0+c2NyZWVuX3NpemUgPSBkaW9fZmJf
c2l6ZTsKIAogCWlmICghZ2VuMnZtKQogCQlwY2lfZGV2X3B1dChwZGV2KTsKIAogCXJldHVybiAw
OwogCitlcnI0OgorCXZmcmVlKHBhci0+ZGlvX3ZwKTsKIGVycjM6CiAJaW91bm1hcChmYl92aXJ0
KTsKIGVycjI6CkBAIC04ODQsNiArMTA0Niw3IEBAIHN0YXRpYyB2b2lkIGh2ZmJfcHV0bWVtKHN0
cnVjdCBmYl9pbmZvICppbmZvKQogewogCXN0cnVjdCBodmZiX3BhciAqcGFyID0gaW5mby0+cGFy
OwogCisJdmZyZWUocGFyLT5kaW9fdnApOwogCWlvdW5tYXAoaW5mby0+c2NyZWVuX2Jhc2UpOwog
CXZtYnVzX2ZyZWVfbW1pbyhwYXItPm1lbS0+c3RhcnQsIHNjcmVlbl9mYl9zaXplKTsKIAlwYXIt
Pm1lbSA9IE5VTEw7CkBAIC05MDksNiArMTA3MiwxMiBAQCBzdGF0aWMgaW50IGh2ZmJfcHJvYmUo
c3RydWN0IGh2X2RldmljZSAqaGRldiwKIAlpbml0X2NvbXBsZXRpb24oJnBhci0+d2FpdCk7CiAJ
SU5JVF9ERUxBWUVEX1dPUksoJnBhci0+ZHdvcmssIGh2ZmJfdXBkYXRlX3dvcmspOwogCisJcGFy
LT5kZWxheWVkX3JlZnJlc2ggPSBmYWxzZTsKKwlzcGluX2xvY2tfaW5pdCgmcGFyLT5kZWxheWVk
X3JlZnJlc2hfbG9jayk7CisJc3Bpbl9sb2NrX2luaXQoJnBhci0+ZG9jb3B5X2xvY2spOworCXBh
ci0+eDEgPSBwYXItPnkxID0gSU5UX01BWDsKKwlwYXItPngyID0gcGFyLT55MiA9IDA7CisKIAkv
KiBDb25uZWN0IHRvIFZTUCAqLwogCWh2X3NldF9kcnZkYXRhKGhkZXYsIGluZm8pOwogCXJldCA9
IHN5bnRodmlkX2Nvbm5lY3RfdnNwKGhkZXYpOwpAQCAtOTYwLDYgKzExMjksMTAgQEAgc3RhdGlj
IGludCBodmZiX3Byb2JlKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsCiAJaW5mby0+ZmJvcHMgPSAm
aHZmYl9vcHM7CiAJaW5mby0+cHNldWRvX3BhbGV0dGUgPSBwYXItPnBzZXVkb19wYWxldHRlOwog
CisJLyogSW5pdGlhbGl6ZSBkZWZlcnJlZCBJTyAqLworCWluZm8tPmZiZGVmaW8gPSAmc3ludGh2
aWRfZGVmaW87CisJZmJfZGVmZXJyZWRfaW9faW5pdChpbmZvKTsKKwogCS8qIFNlbmQgY29uZmln
IHRvIGhvc3QgKi8KIAlyZXQgPSBzeW50aHZpZF9zZW5kX2NvbmZpZyhoZGV2KTsKIAlpZiAocmV0
KQpAQCAtOTgxLDYgKzExNTQsNyBAQCBzdGF0aWMgaW50IGh2ZmJfcHJvYmUoc3RydWN0IGh2X2Rl
dmljZSAqaGRldiwKIAlyZXR1cm4gMDsKIAogZXJyb3I6CisJZmJfZGVmZXJyZWRfaW9fY2xlYW51
cChpbmZvKTsKIAlodmZiX3B1dG1lbShpbmZvKTsKIGVycm9yMjoKIAl2bWJ1c19jbG9zZShoZGV2
LT5jaGFubmVsKTsKQEAgLTEwMDMsNiArMTE3Nyw4IEBAIHN0YXRpYyBpbnQgaHZmYl9yZW1vdmUo
c3RydWN0IGh2X2RldmljZSAqaGRldikKIAlwYXItPnVwZGF0ZSA9IGZhbHNlOwogCXBhci0+ZmJf
cmVhZHkgPSBmYWxzZTsKIAorCWZiX2RlZmVycmVkX2lvX2NsZWFudXAoaW5mbyk7CisKIAl1bnJl
Z2lzdGVyX2ZyYW1lYnVmZmVyKGluZm8pOwogCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmcGFy
LT5kd29yayk7CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVs
