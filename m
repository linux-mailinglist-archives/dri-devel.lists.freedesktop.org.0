Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C1E6D1079CE
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 22:09:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8FF5F6F586;
	Fri, 22 Nov 2019 21:09:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 959116F574;
 Fri, 22 Nov 2019 21:09:01 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Nov 2019 13:09:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,231,1571727600"; d="scan'208";a="205575853"
Received: from nvishwa1-desk.sc.intel.com ([10.3.160.185])
 by fmsmga007.fm.intel.com with ESMTP; 22 Nov 2019 13:08:59 -0800
From: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC 05/13] drm/i915/svm: Page table update support for SVM
Date: Fri, 22 Nov 2019 12:57:26 -0800
Message-Id: <20191122205734.15925-6-niranjana.vishwanathapura@intel.com>
X-Mailer: git-send-email 2.21.0.rc0.32.g243a4c7e27
In-Reply-To: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
References: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sanjay.k.kumar@intel.com, sudeep.dutt@intel.com,
 dri-devel@lists.freedesktop.org, dave.hansen@intel.com, jglisse@redhat.com,
 jon.bloomfield@intel.com, daniel.vetter@intel.com, dan.j.williams@intel.com,
 ira.weiny@intel.com, jgg@mellanox.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Rm9yIFNoYXJlZCBWaXJ0dWFsIE1lbW9yeSAoU1ZNKSBzeXN0ZW0gKFNZUykgYWxsb2NhdG9yLCB0
aGVyZSBpcyBubwpiYWNraW5nIGJ1ZmZlciBvYmplY3QgKEJPKS4gQWRkIHN1cHBvcnQgdG8gYmlu
ZCBhIFZBIHRvIFBBIG1hcHBpbmcKaW4gdGhlIGRldmljZSBwYWdlIHRhYmxlLgoKQ2M6IEpvb25h
cyBMYWh0aW5lbiA8am9vbmFzLmxhaHRpbmVuQGxpbnV4LmludGVsLmNvbT4KQ2M6IEpvbiBCbG9v
bWZpZWxkIDxqb24uYmxvb21maWVsZEBpbnRlbC5jb20+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5p
ZWwudmV0dGVyQGludGVsLmNvbT4KQ2M6IFN1ZGVlcCBEdXR0IDxzdWRlZXAuZHV0dEBpbnRlbC5j
b20+ClNpZ25lZC1vZmYtYnk6IE5pcmFuamFuYSBWaXNod2FuYXRoYXB1cmEgPG5pcmFuamFuYS52
aXNod2FuYXRoYXB1cmFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jIHwgNjAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIHwgMTAgKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNjgg
aW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IDQ0ZmY0MDc0ZGIxMi4uZDllOTUyMjliYTFkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMTgzLDYgKzE4Myw1MCBAQCBzdGF0aWMgdm9pZCBwcGd0dF91bmJp
bmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQl2bWEtPnZtLT5jbGVhcl9yYW5nZSh2bWEt
PnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CiB9CiAKK2ludCBzdm1fYmluZF9hZGRy
X3ByZXBhcmUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIHU2NCBzdGFydCwgdTY0IHNp
emUpCit7CisJcmV0dXJuIHZtLT5hbGxvY2F0ZV92YV9yYW5nZSh2bSwgc3RhcnQsIHNpemUpOwor
fQorCitpbnQgc3ZtX2JpbmRfYWRkcl9jb21taXQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0sIHU2NCBzdGFydCwgdTY0IHNpemUsCisJCQkgdTY0IGZsYWdzLCBzdHJ1Y3Qgc2dfdGFibGUg
KnN0LCB1MzIgc2dfcGFnZV9zaXplcykKK3sKKwlzdHJ1Y3QgaTkxNV92bWEgdm1hID0gezB9Owor
CXUzMiBwdGVfZmxhZ3MgPSAwOworCisJLyogdXNlIGEgdm1hIHdyYXBwZXIgKi8KKwl2bWEucGFn
ZV9zaXplcy5zZyA9IHNnX3BhZ2Vfc2l6ZXM7CisJdm1hLm5vZGUuc3RhcnQgPSBzdGFydDsKKwl2
bWEubm9kZS5zaXplID0gc2l6ZTsKKwl2bWEucGFnZXMgPSBzdDsKKwl2bWEudm0gPSB2bTsKKwor
CS8qIEFwcGxpY2FibGUgdG8gVkxWLCBhbmQgZ2VuOCsgKi8KKwlpZiAoZmxhZ3MgJiBJOTE1X0dU
VF9TVk1fUkVBRE9OTFkpCisJCXB0ZV9mbGFncyB8PSBQVEVfUkVBRF9PTkxZOworCisJdm0tPmlu
c2VydF9lbnRyaWVzKHZtLCAmdm1hLCAwLCBwdGVfZmxhZ3MpOworCXJldHVybiAwOworfQorCitp
bnQgc3ZtX2JpbmRfYWRkcihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgdTY0IHN0YXJ0
LCB1NjQgc2l6ZSwKKwkJICB1NjQgZmxhZ3MsIHN0cnVjdCBzZ190YWJsZSAqc3QsIHUzMiBzZ19w
YWdlX3NpemVzKQoreworCWludCByZXQ7CisKKwlyZXQgPSBzdm1fYmluZF9hZGRyX3ByZXBhcmUo
dm0sIHN0YXJ0LCBzaXplKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0dXJuIHN2
bV9iaW5kX2FkZHJfY29tbWl0KHZtLCBzdGFydCwgc2l6ZSwgZmxhZ3MsIHN0LCBzZ19wYWdlX3Np
emVzKTsKK30KKwordm9pZCBzdm1fdW5iaW5kX2FkZHIoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCisJCSAgICAgdTY0IHN0YXJ0LCB1NjQgc2l6ZSkKK3sKKwl2bS0+Y2xlYXJfcmFuZ2Uo
dm0sIHN0YXJ0LCBzaXplKTsKK30KKwogc3RhdGljIGludCBwcGd0dF9zZXRfcGFnZXMoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiB7CiAJR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKQEAgLTk3MywxMSAr
MTAxNywyMSBAQCBzdGF0aWMgdTY0IF9fZ2VuOF9wcGd0dF9jbGVhcihzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICogY29uc3Qgdm0sCiAJREJHKCIlcyglcCk6eyBsdmw6JWQsIHN0YXJ0OiVsbHgs
IGVuZDolbGx4LCBpZHg6JWQsIGxlbjolZCwgdXNlZDolZCB9XG4iLAogCSAgICBfX2Z1bmNfXywg
dm0sIGx2bCArIDEsIHN0YXJ0LCBlbmQsCiAJICAgIGlkeCwgbGVuLCBhdG9taWNfcmVhZChweF91
c2VkKHBkKSkpOwotCUdFTV9CVUdfT04oIWxlbiB8fCBsZW4gPj0gYXRvbWljX3JlYWQocHhfdXNl
ZChwZCkpKTsKKwkvKgorCSAqIEZJWE1FOiBJbiBTVk0gY2FzZSwgZHVyaW5nIG1tdSBpbnZhbGlk
YXRpb24sIHdlIG5lZWQgdG8gY2xlYXIgcHBndHQsCisJICogYnV0IHdlIGRvbid0IGtub3cgaWYg
dGhlIGVudHJ5IGV4aXN0IG9yIG5vdC4gU28sIHdlIGNhbid0IGFzc3VtZQorCSAqIHRoYXQgaXQg
aXMgY2FsbGVkIG9ubHkgd2hlbiB0aGUgZW50cnkgZXhpc3QuIHJldmlzaXQuCisJICogQWxzbyBu
ZWVkIHRvIGFkZCB0aGUgZWJpbGl0eSB0byBwcm9wZXJseSBoYW5kbGUgcGFydGlhbCBpbnZhbGlk
YXRpb25zCisJICogYnkgZG93bmdyYWRpbmcgdGhlIGxhcmdlIG1hcHBpbmdzLgorCSAqLworCUdF
TV9CVUdfT04oIWxlbik7CiAKIAlkbyB7CiAJCXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0ID0g
cGQtPmVudHJ5W2lkeF07CiAKKwkJaWYgKCFwdCkKKwkJCWNvbnRpbnVlOworCiAJCWlmIChhdG9t
aWNfZmV0Y2hfaW5jKCZwdC0+dXNlZCkgPj4gZ2VuOF9wZF9zaGlmdCgxKSAmJgogCQkgICAgZ2Vu
OF9wZF9jb250YWlucyhzdGFydCwgZW5kLCBsdmwpKSB7CiAJCQlEQkcoIiVzKCVwKTp7IGx2bDol
ZCwgaWR4OiVkLCBzdGFydDolbGx4LCBlbmQ6JWxseCB9IHJlbW92aW5nIHBkXG4iLApAQCAtMTAw
MCw3ICsxMDU0LDkgQEAgc3RhdGljIHU2NCBfX2dlbjhfcHBndHRfY2xlYXIoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqIGNvbnN0IHZtLAogCQkJICAgIF9fZnVuY19fLCB2bSwgbHZsLCBzdGFy
dCwgZW5kLAogCQkJICAgIGdlbjhfcGRfaW5kZXgoc3RhcnQsIDApLCBjb3VudCwKIAkJCSAgICBh
dG9taWNfcmVhZCgmcHQtPnVzZWQpKTsKLQkJCUdFTV9CVUdfT04oIWNvdW50IHx8IGNvdW50ID49
IGF0b21pY19yZWFkKCZwdC0+dXNlZCkpOworCQkJR0VNX0JVR19PTighY291bnQpOworCQkJaWYg
KGNvdW50ID4gYXRvbWljX3JlYWQoJnB0LT51c2VkKSkKKwkJCQljb3VudCA9IGF0b21pY19yZWFk
KCZwdC0+dXNlZCk7CiAKIAkJCXZhZGRyID0ga21hcF9hdG9taWNfcHgocHQpOwogCQkJbWVtc2V0
NjQodmFkZHIgKyBnZW44X3BkX2luZGV4KHN0YXJ0LCAwKSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmgKaW5kZXggZDYxOGE1Nzg3YzYxLi42YThkNTU0OTBlMzkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5oCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVkZSA8bGludXgvbW0u
aD4KICNpbmNsdWRlIDxsaW51eC9wYWdldmVjLmg+CiAjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVl
Lmg+CisjaW5jbHVkZSA8bGludXgvc2NhdHRlcmxpc3QuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1f
bW0uaD4KIApAQCAtNjc4LDQgKzY3OSwxMyBAQCBpbnQgaTkxNV9nZW1fZ3R0X2luc2VydChzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAogI2RlZmluZSBQSU5fT0ZGU0VUX01BU0sJCSgt
STkxNV9HVFRfUEFHRV9TSVpFKQogCisvKiBTVk0gQVBJICovCisjZGVmaW5lIEk5MTVfR1RUX1NW
TV9SRUFET05MWSAgQklUKDApCisKK2ludCBzdm1fYmluZF9hZGRyX3ByZXBhcmUoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sIHU2NCBzdGFydCwgdTY0IHNpemUpOworaW50IHN2bV9iaW5k
X2FkZHJfY29tbWl0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCB1NjQgc3RhcnQsIHU2
NCBzaXplLAorCQkJIHU2NCBmbGFncywgc3RydWN0IHNnX3RhYmxlICpzdCwgdTMyIHNnX3BhZ2Vf
c2l6ZXMpOworaW50IHN2bV9iaW5kX2FkZHIoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
IHU2NCBzdGFydCwgdTY0IHNpemUsCisJCSAgdTY0IGZsYWdzLCBzdHJ1Y3Qgc2dfdGFibGUgKnN0
LCB1MzIgc2dfcGFnZV9zaXplcyk7Cit2b2lkIHN2bV91bmJpbmRfYWRkcihzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwgdTY0IHN0YXJ0LCB1NjQgc2l6ZSk7CiAjZW5kaWYKLS0gCjIuMjEu
MC5yYzAuMzIuZzI0M2E0YzdlMjcKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2RyaS1kZXZlbA==
