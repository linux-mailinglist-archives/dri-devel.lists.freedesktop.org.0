Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B6F8638575
	for <lists+dri-devel@lfdr.de>; Fri,  7 Jun 2019 09:45:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6DA8889B65;
	Fri,  7 Jun 2019 07:43:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x443.google.com (mail-pf1-x443.google.com
 [IPv6:2607:f8b0:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 033F0899C7
 for <dri-devel@lists.freedesktop.org>; Fri,  7 Jun 2019 04:46:34 +0000 (UTC)
Received: by mail-pf1-x443.google.com with SMTP id i189so446169pfg.10
 for <dri-devel@lists.freedesktop.org>; Thu, 06 Jun 2019 21:46:34 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=oDsvBuIMQj7KHWjN89mW4cHRKu1BukpnFISgVSO0KEo=;
 b=fGLZ2WeKGdYXB/j8VLKznUk9CXyNz4mwmYe7b9KhPFPWdCKzWYnP3x1pAEB5jUOzEJ
 L3CShZfynSk9cInMo8TDbUc8Pu6DF6yfB5x0beK+6Dzx2iEaCdEB/R/bHWOLuo+Y9yiG
 CpjPqJ45z9uptkZhsjmapCFsF0dPB7UHgmYZWnkm1Ynb0tD5eP8p/KMJ4+n+q7KPadHC
 pR/j1Apu1m6Um1NX6DvYOxfJpoueIoCu3h1d3IxBsipl0/baxLxtI1OEdfh4wWyfBm6Q
 X2M8TWejKM9deTZGNOi5Av0cpiKvueK9BqzkbtkhMeiNRUod48MeqPpj2KFWf7cUraVA
 HfnQ==
X-Gm-Message-State: APjAAAUNjOvwP+jaPu6LecCaz57WEjIKpwxFgaCagwOWb5142ZsO4n3r
 7tZjuiYLnkvQk4mmcxTN1wAy6+bZZ5Q=
X-Google-Smtp-Source: APXvYqx2QyYl2x0bXNGjOguiSBizGxaqdgY+KR/JD3ScMz5mr+g7wzKkvR4DISCjv+O0xjmZG6g0qQ==
X-Received: by 2002:a17:90a:e397:: with SMTP id
 b23mr3403651pjz.140.1559882794027; 
 Thu, 06 Jun 2019 21:46:34 -0700 (PDT)
Received: from localhost.lan (c-24-22-235-96.hsd1.wa.comcast.net.
 [24.22.235.96])
 by smtp.gmail.com with ESMTPSA id o13sm919516pfh.23.2019.06.06.21.46.32
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 06 Jun 2019 21:46:33 -0700 (PDT)
From: Andrey Smirnov <andrew.smirnov@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 05/15] drm/bridge: tc358767: Drop custom
 tc_write()/tc_read() accessors
Date: Thu,  6 Jun 2019 21:45:40 -0700
Message-Id: <20190607044550.13361-6-andrew.smirnov@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190607044550.13361-1-andrew.smirnov@gmail.com>
References: <20190607044550.13361-1-andrew.smirnov@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Fri, 07 Jun 2019 07:43:41 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=oDsvBuIMQj7KHWjN89mW4cHRKu1BukpnFISgVSO0KEo=;
 b=nDs7+rgH65evGz17RxnCUdcTAQ0DeXorEmOxJx4ccrlOQnvk8VxsQzR7GBI5SqS9ok
 7ji1UXbm8s0WoTeCqvf4yEgzhv+sMUgW4yjzNhzvTKtRi2MF9sCrGSDn0UlCOiNjYXim
 2vgfbm0a04Ekrep1A/UdbYLUDJug+TGkOgzzerw7mDSqtNE+VNwh/bAuZzO7mWzokzS5
 YQCoHo6Q0CFrjd9NSJchvYAyeC6CD86xzsS9by9VNpo3Jja9hNpojJlGsAgaQlsXjvh5
 j+oz6nYYWoILTlzPHl1MEpjjTDKx7bczCCUBvEXOJ9DfWg+Nnn124EpxXwyyrKZxpfck
 OxUQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Cory Tusar <cory.tusar@zii.aero>, Andrey Smirnov <andrew.smirnov@gmail.com>,
 Andrey Gusakov <andrey.gusakov@cogentembedded.com>,
 linux-kernel@vger.kernel.org, Tomi Valkeinen <tomi.valkeinen@ti.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Chris Healy <cphealy@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QSB2ZXJ5IHVuZm9ydHVuYXRlIGFzcGVjdCBvZiB0Y193cml0ZSgpL3RjX3JlYWQoKSBtYWNybyBo
ZWxwZXJzIGlzCnRoYXQgdGhleSBjYXB0dXJlIHF1aXRlIGEgYml0IG9mIGNvbnRleHQgYXJvdW5k
IHRoZW0gYW5kIHRodXMgcmVxdWlyZQp0aGUgY2FsbGVyIHRvIGhhdmUgbWFnaWMgdmFyaWFibGVz
ICdyZXQnIGFuZCAndGMnIGFzIHdlbGwgYXMgbGFiZWwKJ2VycicuIFRoYXQgbWFrZXMgYSBudW1i
ZXIgb2YgY29kZSBwYXRocyByYXRoZXIgY291bnRlci1pbnR1aXRpdmUgYW5kCnNvbWV3aGF0IGNs
dW5reSwgZm9yIGV4YW1wbGUgdGNfc3RyZWFtX2Nsb2NrX2NhbGMoKSBlbmRzIHVwIGJlaW5nIGxp
a2UKdGhpczoKCglpbnQgcmV0OwoKCXRjX3dyaXRlKERQMF9WSURNTkdFTjEsIDMyNzY4KTsKCgly
ZXR1cm4gMDsKZXJyOgoJcmV0dXJuIHJldDsKCndoaWNoIGlzIHJhdGhlciBzdXJwcmlzaW5nIHdo
ZW4geW91IHJlYWQgdGhlIGNvZGUgZm9yIHRoZSBmaXJzdAp0aW1lLiBTaW5jZSB0aG9zZSBoZWxw
ZXJzIGFyZ3VhYmx5IGFyZW4ndCByZWFsbHkgc2F2aW5nIHRoYXQgbXVjaCBjb2RlCmFuZCB0aGVy
ZSdzIG5vIHdheSBvZiBmaXhpbmcgdGhlbSB3aXRob3V0IG1ha2luZyB0aGVtIHRvbyB2ZXJib3Nl
IHRvCmJlIHdvcnRoIGl0IGNoYW5nZSB0aGUgZHJpdmVyIGNvZGUgdG8gbm90IHVzZSB0aGVtIGF0
IGFsbC4KClNpZ25lZC1vZmYtYnk6IEFuZHJleSBTbWlybm92IDxhbmRyZXcuc21pcm5vdkBnbWFp
bC5jb20+ClJldmlld2VkLWJ5OiBBbmRyemVqIEhhamRhIDxhLmhhamRhQHNhbXN1bmcuY29tPgpD
YzogQW5kcnplaiBIYWpkYSA8YS5oYWpkYUBzYW1zdW5nLmNvbT4KQ2M6IExhdXJlbnQgUGluY2hh
cnQgPExhdXJlbnQucGluY2hhcnRAaWRlYXNvbmJvYXJkLmNvbT4KQ2M6IFRvbWkgVmFsa2VpbmVu
IDx0b21pLnZhbGtlaW5lbkB0aS5jb20+CkNjOiBBbmRyZXkgR3VzYWtvdiA8YW5kcmV5Lmd1c2Fr
b3ZAY29nZW50ZW1iZWRkZWQuY29tPgpDYzogUGhpbGlwcCBaYWJlbCA8cC56YWJlbEBwZW5ndXRy
b25peC5kZT4KQ2M6IENvcnkgVHVzYXIgPGNvcnkudHVzYXJAemlpLmFlcm8+CkNjOiBDaHJpcyBI
ZWFseSA8Y3BoZWFseUBnbWFpbC5jb20+CkNjOiBMdWNhcyBTdGFjaCA8bC5zdGFjaEBwZW5ndXRy
b25peC5kZT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKQ2M6IGxpbnV4LWtl
cm5lbEB2Z2VyLmtlcm5lbC5vcmcKLS0tCiBkcml2ZXJzL2dwdS9kcm0vYnJpZGdlL3RjMzU4NzY3
LmMgfCAzODIgKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
MjMwIGluc2VydGlvbnMoKyksIDE1MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYnJpZGdlL3RjMzU4NzY3LmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL3RjMzU4
NzY3LmMKaW5kZXggNWI3ODAyMWQ2YzViLi43YjE1Y2FlYzJjZTUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvdGMzNTg3NjcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L3RjMzU4NzY3LmMKQEAgLTI4MCwyMCArMjgwLDYgQEAgc3RhdGljIGlubGluZSBzdHJ1Y3QgdGNf
ZGF0YSAqY29ubmVjdG9yX3RvX3RjKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjKQogCXJldHVybiBj
b250YWluZXJfb2YoYywgc3RydWN0IHRjX2RhdGEsIGNvbm5lY3Rvcik7CiB9CiAKLS8qIFNpbXBs
ZSBtYWNyb3MgdG8gYXZvaWQgcmVwZWF0ZWQgZXJyb3IgY2hlY2tzICovCi0jZGVmaW5lIHRjX3dy
aXRlKHJlZywgdmFyKQkJCQkJXAotCWRvIHsJCQkJCQkJXAotCQlyZXQgPSByZWdtYXBfd3JpdGUo
dGMtPnJlZ21hcCwgcmVnLCB2YXIpOwlcCi0JCWlmIChyZXQpCQkJCQlcCi0JCQlnb3RvIGVycjsJ
CQkJXAotCX0gd2hpbGUgKDApCi0jZGVmaW5lIHRjX3JlYWQocmVnLCB2YXIpCQkJCQlcCi0JZG8g
ewkJCQkJCQlcCi0JCXJldCA9IHJlZ21hcF9yZWFkKHRjLT5yZWdtYXAsIHJlZywgdmFyKTsJXAot
CQlpZiAocmV0KQkJCQkJXAotCQkJZ290byBlcnI7CQkJCVwKLQl9IHdoaWxlICgwKQotCiBzdGF0
aWMgaW5saW5lIGludCB0Y19wb2xsX3RpbWVvdXQoc3RydWN0IHRjX2RhdGEgKnRjLCB1bnNpZ25l
ZCBpbnQgYWRkciwKIAkJCQkgIHVuc2lnbmVkIGludCBjb25kX21hc2ssCiAJCQkJICB1bnNpZ25l
ZCBpbnQgY29uZF92YWx1ZSwKQEAgLTM1MSw3ICszMzcsNyBAQCBzdGF0aWMgc3NpemVfdCB0Y19h
dXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwKIAogCXJldCA9IHRjX2F1eF93YWl0
X2J1c3kodGMsIDEwMCk7CiAJaWYgKHJldCkKLQkJZ290byBlcnI7CisJCXJldHVybiByZXQ7CiAK
IAlpZiAocmVxdWVzdCA9PSBEUF9BVVhfSTJDX1dSSVRFIHx8IHJlcXVlc3QgPT0gRFBfQVVYX05B
VElWRV9XUklURSkgewogCQkvKiBTdG9yZSBkYXRhICovCkBAIC0zNjIsNyArMzQ4LDExIEBAIHN0
YXRpYyBzc2l6ZV90IHRjX2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LAogCQkJ
CXRtcCA9ICh0bXAgPDwgOCkgfCBidWZbaV07CiAJCQlpKys7CiAJCQlpZiAoKChpICUgNCkgPT0g
MCkgfHwgKGkgPT0gc2l6ZSkpIHsKLQkJCQl0Y193cml0ZShEUDBfQVVYV0RBVEEoKGkgLSAxKSA+
PiAyKSwgdG1wKTsKKwkJCQlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwKKwkJCQkJCSAg
IERQMF9BVVhXREFUQSgoaSAtIDEpID4+IDIpLAorCQkJCQkJICAgdG1wKTsKKwkJCQlpZiAocmV0
KQorCQkJCQlyZXR1cm4gcmV0OwogCQkJCXRtcCA9IDA7CiAJCQl9CiAJCX0KQEAgLTM3MiwyMyAr
MzYyLDMyIEBAIHN0YXRpYyBzc2l6ZV90IHRjX2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1
eCAqYXV4LAogCX0KIAogCS8qIFN0b3JlIGFkZHJlc3MgKi8KLQl0Y193cml0ZShEUDBfQVVYQURE
UiwgbXNnLT5hZGRyZXNzKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX0FV
WEFERFIsIG1zZy0+YWRkcmVzcyk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAkvKiBTdGFy
dCB0cmFuc2ZlciAqLwotCXRjX3dyaXRlKERQMF9BVVhDRkcwLCAoKHNpemUgLSAxKSA8PCA4KSB8
IHJlcXVlc3QpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfQVVYQ0ZHMCwK
KwkJCSAgICgoc2l6ZSAtIDEpIDw8IDgpIHwgcmVxdWVzdCk7CisJaWYgKHJldCkKKwkJcmV0dXJu
IHJldDsKIAogCXJldCA9IHRjX2F1eF93YWl0X2J1c3kodGMsIDEwMCk7CiAJaWYgKHJldCkKLQkJ
Z290byBlcnI7CisJCXJldHVybiByZXQ7CiAKIAlyZXQgPSB0Y19hdXhfZ2V0X3N0YXR1cyh0Yywg
Jm1zZy0+cmVwbHkpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyOworCQlyZXR1cm4gcmV0OwogCiAJ
aWYgKHJlcXVlc3QgPT0gRFBfQVVYX0kyQ19SRUFEIHx8IHJlcXVlc3QgPT0gRFBfQVVYX05BVElW
RV9SRUFEKSB7CiAJCS8qIFJlYWQgZGF0YSAqLwogCQl3aGlsZSAoaSA8IHNpemUpIHsKLQkJCWlm
ICgoaSAlIDQpID09IDApCi0JCQkJdGNfcmVhZChEUDBfQVVYUkRBVEEoaSA+PiAyKSwgJnRtcCk7
CisJCQlpZiAoKGkgJSA0KSA9PSAwKSB7CisJCQkJcmV0ID0gcmVnbWFwX3JlYWQodGMtPnJlZ21h
cCwKKwkJCQkJCSAgRFAwX0FVWFJEQVRBKGkgPj4gMiksICZ0bXApOworCQkJCWlmIChyZXQpCisJ
CQkJCXJldHVybiByZXQ7CisJCQl9CiAJCQlidWZbaV0gPSB0bXAgJiAweGZmOwogCQkJdG1wID0g
dG1wID4+IDg7CiAJCQlpKys7CkBAIC0zOTYsOCArMzk1LDYgQEAgc3RhdGljIHNzaXplX3QgdGNf
YXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCiAJfQogCiAJcmV0dXJuIHNpemU7
Ci1lcnI6Ci0JcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGNvbnN0IGNoYXIgKiBjb25zdCB0cmFp
bmluZ19wYXR0ZXJuMV9lcnJvcnNbXSA9IHsKQEAgLTQ1NCw2ICs0NTEsNyBAQCBzdGF0aWMgaW50
IHRjX3B4bF9wbGxfZW4oc3RydWN0IHRjX2RhdGEgKnRjLCB1MzIgcmVmY2xrLCB1MzIgcGl4ZWxj
bG9jaykKIAlpbnQgZXh0X2RpdltdID0gezEsIDIsIDMsIDUsIDd9OwogCWludCBiZXN0X3BpeGVs
Y2xvY2sgPSAwOwogCWludCB2Y29faGkgPSAwOworCXUzMiBweGxfcGxscGFyYW07CiAKIAlkZXZf
ZGJnKHRjLT5kZXYsICJQTEw6IHJlcXVlc3RlZCAlZCBwaXhlbGNsb2NrLCByZWYgJWRcbiIsIHBp
eGVsY2xvY2ssCiAJCXJlZmNsayk7CkBAIC01MjMsMjQgKzUyMSwyOSBAQCBzdGF0aWMgaW50IHRj
X3B4bF9wbGxfZW4oc3RydWN0IHRjX2RhdGEgKnRjLCB1MzIgcmVmY2xrLCB1MzIgcGl4ZWxjbG9j
aykKIAkJYmVzdF9tdWwgPSAwOwogCiAJLyogUG93ZXIgdXAgUExMIGFuZCBzd2l0Y2ggdG8gYnlw
YXNzICovCi0JdGNfd3JpdGUoUFhMX1BMTENUUkwsIFBMTEJZUCB8IFBMTEVOKTsKKwlyZXQgPSBy
ZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgUFhMX1BMTENUUkwsIFBMTEJZUCB8IFBMTEVOKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcHhsX3BsbHBhcmFtICA9IHZjb19oaSA8PCAyNDsg
LyogRm9yIFBMTCBWQ08gPj0gMzAwIE1IeiA9IDEgKi8KKwlweGxfcGxscGFyYW0gfD0gZXh0X2Rp
dltiZXN0X3ByZV0gPDwgMjA7IC8qIEV4dGVybmFsIFByZS1kaXZpZGVyICovCisJcHhsX3BsbHBh
cmFtIHw9IGV4dF9kaXZbYmVzdF9wb3N0XSA8PCAxNjsgLyogRXh0ZXJuYWwgUG9zdC1kaXZpZGVy
ICovCisJcHhsX3BsbHBhcmFtIHw9IElOX1NFTF9SRUZDTEs7IC8qIFVzZSBSZWZDbGsgYXMgUExM
IGlucHV0ICovCisJcHhsX3BsbHBhcmFtIHw9IGJlc3RfZGl2IDw8IDg7IC8qIERpdmlkZXIgZm9y
IFBMTCBSZWZDbGsgKi8KKwlweGxfcGxscGFyYW0gfD0gYmVzdF9tdWw7IC8qIE11bHRpcGxpZXIg
Zm9yIFBMTCAqLwogCi0JdGNfd3JpdGUoUFhMX1BMTFBBUkFNLAotCQkgKHZjb19oaSA8PCAyNCkg
fAkJLyogRm9yIFBMTCBWQ08gPj0gMzAwIE1IeiA9IDEgKi8KLQkJIChleHRfZGl2W2Jlc3RfcHJl
XSA8PCAyMCkgfAkvKiBFeHRlcm5hbCBQcmUtZGl2aWRlciAqLwotCQkgKGV4dF9kaXZbYmVzdF9w
b3N0XSA8PCAxNikgfAkvKiBFeHRlcm5hbCBQb3N0LWRpdmlkZXIgKi8KLQkJIElOX1NFTF9SRUZD
TEsgfAkJLyogVXNlIFJlZkNsayBhcyBQTEwgaW5wdXQgKi8KLQkJIChiZXN0X2RpdiA8PCA4KSB8
CQkvKiBEaXZpZGVyIGZvciBQTEwgUmVmQ2xrICovCi0JCSAoYmVzdF9tdWwgPDwgMCkpOwkJLyog
TXVsdGlwbGllciBmb3IgUExMICovCisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIFBY
TF9QTExQQVJBTSwgcHhsX3BsbHBhcmFtKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJ
LyogRm9yY2UgUExMIHBhcmFtZXRlciB1cGRhdGUgYW5kIGRpc2FibGUgYnlwYXNzICovCi0JdGNf
d3JpdGUoUFhMX1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlyZXQgPSByZWdtYXBfd3Jp
dGUodGMtPnJlZ21hcCwgUFhMX1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OwogCiAJdGNfd2FpdF9wbGxfbG9jayh0Yyk7CiAKIAlyZXR1cm4gMDsK
LWVycjoKLQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHRjX3B4bF9wbGxfZGlzKHN0cnVj
dCB0Y19kYXRhICp0YykKQEAgLTU1MSw3ICs1NTQsNiBAQCBzdGF0aWMgaW50IHRjX3B4bF9wbGxf
ZGlzKHN0cnVjdCB0Y19kYXRhICp0YykKIAogc3RhdGljIGludCB0Y19zdHJlYW1fY2xvY2tfY2Fs
YyhzdHJ1Y3QgdGNfZGF0YSAqdGMpCiB7Ci0JaW50IHJldDsKIAkvKgogCSAqIElmIHRoZSBTdHJl
YW0gY2xvY2sgYW5kIExpbmsgU3ltYm9sIGNsb2NrIGFyZQogCSAqIGFzeW5jaHJvbm91cyB3aXRo
IGVhY2ggb3RoZXIsIHRoZSB2YWx1ZSBvZiBNIGNoYW5nZXMgb3ZlcgpAQCAtNTY3LDE2ICs1Njks
MTMgQEAgc3RhdGljIGludCB0Y19zdHJlYW1fY2xvY2tfY2FsYyhzdHJ1Y3QgdGNfZGF0YSAqdGMp
CiAJICogTS9OID0gZl9TVFJNQ0xLIC8gZl9MU0NMSwogCSAqCiAJICovCi0JdGNfd3JpdGUoRFAw
X1ZJRE1OR0VOMSwgMzI3NjgpOwotCi0JcmV0dXJuIDA7Ci1lcnI6Ci0JcmV0dXJuIHJldDsKKwly
ZXR1cm4gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9WSURNTkdFTjEsIDMyNzY4KTsKIH0K
IAogc3RhdGljIGludCB0Y19hdXhfbGlua19zZXR1cChzdHJ1Y3QgdGNfZGF0YSAqdGMpCiB7CiAJ
dW5zaWduZWQgbG9uZyByYXRlOworCXUzMiBkcDBfYXV4Y2ZnMTsKIAl1MzIgdmFsdWU7CiAJaW50
IHJldDsKIApAQCAtNjAxLDE4ICs2MDAsMjYgQEAgc3RhdGljIGludCB0Y19hdXhfbGlua19zZXR1
cChzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAKIAkvKiBTZXR1cCBEUC1QSFkgLyBQTEwgKi8KIAl2YWx1
ZSB8PSBTWVNDTEtfU0VMX0xTQ0xLIHwgTFNDTEtfRElWXzI7Ci0JdGNfd3JpdGUoU1lTX1BMTFBB
UkFNLCB2YWx1ZSk7Ci0KLQl0Y193cml0ZShEUF9QSFlfQ1RSTCwgQkdSRU4gfCBQV1JfU1dfRU4g
fCBQSFlfQTBfRU4pOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBTWVNfUExMUEFS
QU0sIHZhbHVlKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKIAorCXJldCA9IHJlZ21hcF93cml0
ZSh0Yy0+cmVnbWFwLCBEUF9QSFlfQ1RSTCwKKwkJCSAgIEJHUkVOIHwgUFdSX1NXX0VOIHwgUEhZ
X0EwX0VOKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKIAkvKgogCSAqIEluaXRpYWxseSBQTExz
IGFyZSBpbiBieXBhc3MuIEZvcmNlIFBMTCBwYXJhbWV0ZXIgdXBkYXRlLAogCSAqIGRpc2FibGUg
UExMIGJ5cGFzcywgZW5hYmxlIFBMTAogCSAqLwotCXRjX3dyaXRlKERQMF9QTExDVFJMLCBQTExV
UERBVEUgfCBQTExFTik7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9QTExD
VFJMLCBQTExVUERBVEUgfCBQTExFTik7CisJaWYgKHJldCkKKwkJZ290byBlcnI7CiAJdGNfd2Fp
dF9wbGxfbG9jayh0Yyk7CiAKLQl0Y193cml0ZShEUDFfUExMQ1RSTCwgUExMVVBEQVRFIHwgUExM
RU4pOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDFfUExMQ1RSTCwgUExMVVBE
QVRFIHwgUExMRU4pOworCWlmIChyZXQpCisJCWdvdG8gZXJyOwogCXRjX3dhaXRfcGxsX2xvY2so
dGMpOwogCiAJcmV0ID0gdGNfcG9sbF90aW1lb3V0KHRjLCBEUF9QSFlfQ1RSTCwgUEhZX1JEWSwg
UEhZX1JEWSwgMSwgMTAwMCk7CkBAIC02MjQsOSArNjMxLDEzIEBAIHN0YXRpYyBpbnQgdGNfYXV4
X2xpbmtfc2V0dXAoc3RydWN0IHRjX2RhdGEgKnRjKQogCX0KIAogCS8qIFNldHVwIEFVWCBsaW5r
ICovCi0JdGNfd3JpdGUoRFAwX0FVWENGRzEsIEFVWF9SWF9GSUxURVJfRU4gfAotCQkgKDB4MDYg
PDwgOCkgfAkvKiBBdXggQml0IFBlcmlvZCBDYWxjdWxhdG9yIFRocmVzaG9sZCAqLwotCQkgKDB4
M2YgPDwgMCkpOwkvKiBBdXggUmVzcG9uc2UgVGltZW91dCBUaW1lciAqLworCWRwMF9hdXhjZmcx
ICA9IEFVWF9SWF9GSUxURVJfRU47CisJZHAwX2F1eGNmZzEgfD0gMHgwNiA8PCA4OyAvKiBBdXgg
Qml0IFBlcmlvZCBDYWxjdWxhdG9yIFRocmVzaG9sZCAqLworCWRwMF9hdXhjZmcxIHw9IDB4M2Yg
PDwgMDsgLyogQXV4IFJlc3BvbnNlIFRpbWVvdXQgVGltZXIgKi8KKworCXJldCA9IHJlZ21hcF93
cml0ZSh0Yy0+cmVnbWFwLCBEUDBfQVVYQ0ZHMSwgZHAwX2F1eGNmZzEpOworCWlmIChyZXQpCisJ
CWdvdG8gZXJyOwogCiAJcmV0dXJuIDA7CiBlcnI6CkBAIC03MjcsNDggKzczOCw3MyBAQCBzdGF0
aWMgaW50IHRjX3NldF92aWRlb19tb2RlKHN0cnVjdCB0Y19kYXRhICp0YywKIAkgKiBhc3N1bWUg
d2UgZG8gbm90IG5lZWQgYW55IGRlbGF5IHdoZW4gRFBJIGlzIGEgc291cmNlIG9mCiAJICogc3lu
YyBzaWduYWxzCiAJICovCi0JdGNfd3JpdGUoVlBDVFJMMCwKLQkJIEZJRUxEX1BSRVAoVlNERUxB
WSwgMCkgfAotCQkgT1BYTEZNVF9SR0I4ODggfCBGUk1TWU5DX0RJU0FCTEVEIHwgTVNGX0RJU0FC
TEVEKTsKLQl0Y193cml0ZShIVElNMDEsCi0JCSBGSUVMRF9QUkVQKEhCUFIsIEFMSUdOKGxlZnRf
bWFyZ2luLCAyKSkgfAotCQkgRklFTERfUFJFUChIUFcsIEFMSUdOKGhzeW5jX2xlbiwgMikpKTsK
LQl0Y193cml0ZShIVElNMDIsCi0JCSBGSUVMRF9QUkVQKEhESVNQUiwgQUxJR04obW9kZS0+aGRp
c3BsYXksIDIpKSB8Ci0JCSBGSUVMRF9QUkVQKEhGUFIsIEFMSUdOKHJpZ2h0X21hcmdpbiwgMikp
KTsKLQl0Y193cml0ZShWVElNMDEsCi0JCSBGSUVMRF9QUkVQKFZCUFIsIHVwcGVyX21hcmdpbikg
fAotCQkgRklFTERfUFJFUChWU1BSLCB2c3luY19sZW4pKTsKLQl0Y193cml0ZShWVElNMDIsCi0J
CSBGSUVMRF9QUkVQKFZGUFIsIGxvd2VyX21hcmdpbikgfAotCQkgRklFTERfUFJFUChWRElTUFIs
IG1vZGUtPnZkaXNwbGF5KSk7Ci0JdGNfd3JpdGUoVkZVRU4wLCBWRlVFTik7CQkvKiB1cGRhdGUg
c2V0dGluZ3MgKi8KKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgVlBDVFJMMCwKKwkJ
CSAgIEZJRUxEX1BSRVAoVlNERUxBWSwgMCkgfAorCQkJICAgT1BYTEZNVF9SR0I4ODggfCBGUk1T
WU5DX0RJU0FCTEVEIHwgTVNGX0RJU0FCTEVEKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIEhUSU0wMSwKKwkJCSAgIEZJRUxEX1BS
RVAoSEJQUiwgQUxJR04obGVmdF9tYXJnaW4sIDIpKSB8CisJCQkgICBGSUVMRF9QUkVQKEhQVywg
QUxJR04oaHN5bmNfbGVuLCAyKSkpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgSFRJTTAyLAorCQkJICAgRklFTERfUFJFUChIRElT
UFIsIEFMSUdOKG1vZGUtPmhkaXNwbGF5LCAyKSkgfAorCQkJICAgRklFTERfUFJFUChIRlBSLCBB
TElHTihyaWdodF9tYXJnaW4sIDIpKSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJl
dCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBWVElNMDEsCisJCQkgICBGSUVMRF9QUkVQKFZC
UFIsIHVwcGVyX21hcmdpbikgfAorCQkJICAgRklFTERfUFJFUChWU1BSLCB2c3luY19sZW4pKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdt
YXAsIFZUSU0wMiwKKwkJCSAgIEZJRUxEX1BSRVAoVkZQUiwgbG93ZXJfbWFyZ2luKSB8CisJCQkg
ICBGSUVMRF9QUkVQKFZESVNQUiwgbW9kZS0+dmRpc3BsYXkpKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIFZGVUVOMCwgVkZVRU4p
OyAvKiB1cGRhdGUgc2V0dGluZ3MgKi8KKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJLyog
VGVzdCBwYXR0ZXJuIHNldHRpbmdzICovCi0JdGNfd3JpdGUoVFNUQ1RMLAotCQkgRklFTERfUFJF
UChDT0xPUl9SLCAxMjApIHwKLQkJIEZJRUxEX1BSRVAoQ09MT1JfRywgMjApIHwKLQkJIEZJRUxE
X1BSRVAoQ09MT1JfQiwgOTkpIHwKLQkJIEVOSTJDRklMVEVSIHwKLQkJIEZJRUxEX1BSRVAoQ09M
T1JfQkFSX01PREUsIENPTE9SX0JBUl9NT0RFX0JBUlMpKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUo
dGMtPnJlZ21hcCwgVFNUQ1RMLAorCQkJICAgRklFTERfUFJFUChDT0xPUl9SLCAxMjApIHwKKwkJ
CSAgIEZJRUxEX1BSRVAoQ09MT1JfRywgMjApIHwKKwkJCSAgIEZJRUxEX1BSRVAoQ09MT1JfQiwg
OTkpIHwKKwkJCSAgIEVOSTJDRklMVEVSIHwKKwkJCSAgIEZJRUxEX1BSRVAoQ09MT1JfQkFSX01P
REUsIENPTE9SX0JBUl9NT0RFX0JBUlMpKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJ
LyogRFAgTWFpbiBTdHJlYW0gQXR0cmlidXRlcyAqLwogCXZpZF9zeW5jX2RseSA9IGhzeW5jX2xl
biArIGxlZnRfbWFyZ2luICsgbW9kZS0+aGRpc3BsYXk7Ci0JdGNfd3JpdGUoRFAwX1ZJRFNZTkNE
RUxBWSwKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1ZJRFNZTkNERUxBWSwK
IAkJIEZJRUxEX1BSRVAoVEhSRVNIX0RMWSwgbWF4X3R1X3N5bWJvbCkgfAogCQkgRklFTERfUFJF
UChWSURfU1lOQ19ETFksIHZpZF9zeW5jX2RseSkpOwogCi0JdGNfd3JpdGUoRFAwX1RPVEFMVkFM
LAotCQkgRklFTERfUFJFUChIX1RPVEFMLCBtb2RlLT5odG90YWwpIHwKLQkJIEZJRUxEX1BSRVAo
Vl9UT1RBTCwgbW9kZS0+dnRvdGFsKSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAs
IERQMF9UT1RBTFZBTCwKKwkJCSAgIEZJRUxEX1BSRVAoSF9UT1RBTCwgbW9kZS0+aHRvdGFsKSB8
CisJCQkgICBGSUVMRF9QUkVQKFZfVE9UQUwsIG1vZGUtPnZ0b3RhbCkpOworCWlmIChyZXQpCisJ
CXJldHVybiByZXQ7CiAKLQl0Y193cml0ZShEUDBfU1RBUlRWQUwsCi0JCSBGSUVMRF9QUkVQKEhf
U1RBUlQsIGxlZnRfbWFyZ2luICsgaHN5bmNfbGVuKSB8Ci0JCSBGSUVMRF9QUkVQKFZfU1RBUlQs
IHVwcGVyX21hcmdpbiArIHZzeW5jX2xlbikpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVn
bWFwLCBEUDBfU1RBUlRWQUwsCisJCQkgICBGSUVMRF9QUkVQKEhfU1RBUlQsIGxlZnRfbWFyZ2lu
ICsgaHN5bmNfbGVuKSB8CisJCQkgICBGSUVMRF9QUkVQKFZfU1RBUlQsIHVwcGVyX21hcmdpbiAr
IHZzeW5jX2xlbikpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKLQl0Y193cml0ZShEUDBf
QUNUSVZFVkFMLAotCQkgRklFTERfUFJFUChWX0FDVCwgbW9kZS0+dmRpc3BsYXkpIHwKLQkJIEZJ
RUxEX1BSRVAoSF9BQ1QsIG1vZGUtPmhkaXNwbGF5KSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRj
LT5yZWdtYXAsIERQMF9BQ1RJVkVWQUwsCisJCQkgICBGSUVMRF9QUkVQKFZfQUNULCBtb2RlLT52
ZGlzcGxheSkgfAorCQkJICAgRklFTERfUFJFUChIX0FDVCwgbW9kZS0+aGRpc3BsYXkpKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJZHAwX3N5bmN2YWwgPSBGSUVMRF9QUkVQKFZTX1dJ
RFRILCB2c3luY19sZW4pIHwKIAkJICAgICAgRklFTERfUFJFUChIU19XSURUSCwgaHN5bmNfbGVu
KTsKQEAgLTc3OSwyMSArODE1LDI1IEBAIHN0YXRpYyBpbnQgdGNfc2V0X3ZpZGVvX21vZGUoc3Ry
dWN0IHRjX2RhdGEgKnRjLAogCWlmIChtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfTkhTWU5D
KQogCQlkcDBfc3luY3ZhbCB8PSBTWU5DVkFMX0hTX1BPTF9BQ1RJVkVfTE9XOwogCi0JdGNfd3Jp
dGUoRFAwX1NZTkNWQUwsIGRwMF9zeW5jdmFsKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJl
Z21hcCwgRFAwX1NZTkNWQUwsIGRwMF9zeW5jdmFsKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OwogCi0JdGNfd3JpdGUoRFBJUFhMRk1ULAotCQkgVlNfUE9MX0FDVElWRV9MT1cgfCBIU19QT0xf
QUNUSVZFX0xPVyB8Ci0JCSBERV9QT0xfQUNUSVZFX0hJR0ggfCBTVUJfQ0ZHX1RZUEVfQ09ORklH
MSB8Ci0JCSBEUElfQlBQX1JHQjg4OCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAs
IERQSVBYTEZNVCwKKwkJCSAgIFZTX1BPTF9BQ1RJVkVfTE9XIHwgSFNfUE9MX0FDVElWRV9MT1cg
fAorCQkJICAgREVfUE9MX0FDVElWRV9ISUdIIHwgU1VCX0NGR19UWVBFX0NPTkZJRzEgfAorCQkJ
ICAgRFBJX0JQUF9SR0I4ODgpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKLQl0Y193cml0
ZShEUDBfTUlTQywKLQkJIEZJRUxEX1BSRVAoTUFYX1RVX1NZTUJPTCwgbWF4X3R1X3N5bWJvbCkg
fAotCQkgRklFTERfUFJFUChUVV9TSVpFLCBUVV9TSVpFX1JFQ09NTUVOREVEKSB8Ci0JCSBCUENf
OCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9NSVNDLAorCQkJICAgRklF
TERfUFJFUChNQVhfVFVfU1lNQk9MLCBtYXhfdHVfc3ltYm9sKSB8CisJCQkgICBGSUVMRF9QUkVQ
KFRVX1NJWkUsIFRVX1NJWkVfUkVDT01NRU5ERUQpIHwKKwkJCSAgIEJQQ184KTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OwogCiAJcmV0dXJuIDA7Ci1lcnI6Ci0JcmV0dXJuIHJldDsKIH0KIAog
c3RhdGljIGludCB0Y193YWl0X2xpbmtfdHJhaW5pbmcoc3RydWN0IHRjX2RhdGEgKnRjKQpAQCAt
ODA4LDExICs4NDgsMTEgQEAgc3RhdGljIGludCB0Y193YWl0X2xpbmtfdHJhaW5pbmcoc3RydWN0
IHRjX2RhdGEgKnRjKQogCQlyZXR1cm4gcmV0OwogCX0KIAotCXRjX3JlYWQoRFAwX0xUU1RBVCwg
JnZhbHVlKTsKKwlyZXQgPSByZWdtYXBfcmVhZCh0Yy0+cmVnbWFwLCBEUDBfTFRTVEFULCAmdmFs
dWUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAlyZXR1cm4gKHZhbHVlID4+IDgpICYg
MHg3OwotZXJyOgotCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdGNfbWFpbl9saW5rX2Vu
YWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCkBAIC04MjcsMTUgKzg2NywyNSBAQCBzdGF0aWMgaW50
IHRjX21haW5fbGlua19lbmFibGUoc3RydWN0IHRjX2RhdGEgKnRjKQogCiAJZGV2X2RiZyh0Yy0+
ZGV2LCAibGluayBlbmFibGVcbiIpOwogCi0JdGNfcmVhZChEUDBDVEwsICZ2YWx1ZSk7Ci0JaWYg
KFdBUk5fT04odmFsdWUgJiBEUF9FTikpCi0JCXRjX3dyaXRlKERQMENUTCwgMCk7CisJcmV0ID0g
cmVnbWFwX3JlYWQodGMtPnJlZ21hcCwgRFAwQ1RMLCAmdmFsdWUpOworCWlmIChyZXQpCisJCXJl
dHVybiByZXQ7CisKKwlpZiAoV0FSTl9PTih2YWx1ZSAmIERQX0VOKSkgeworCQlyZXQgPSByZWdt
YXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwQ1RMLCAwKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiBy
ZXQ7CisJfQogCi0JdGNfd3JpdGUoRFAwX1NSQ0NUUkwsIHRjX3NyY2N0cmwodGMpKTsKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1NSQ0NUUkwsIHRjX3NyY2N0cmwodGMpKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCS8qIFNTQ0cgYW5kIEJXMjcgb24gRFAxIG11c3Qg
YmUgc2V0IHRvIHRoZSBzYW1lIGFzIG9uIERQMCAqLwotCXRjX3dyaXRlKERQMV9TUkNDVFJMLAor
CXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDFfU1JDQ1RSTCwKIAkJICh0Yy0+bGlu
ay5zcHJlYWQgPyBEUDBfU1JDQ1RSTF9TU0NHIDogMCkgfAogCQkgKCh0Yy0+bGluay5iYXNlLnJh
dGUgIT0gMTYyMDAwKSA/IERQMF9TUkNDVFJMX0JXMjcgOiAwKSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKIAogCXJhdGUgPSBjbGtfZ2V0X3JhdGUodGMtPnJlZmNsayk7CiAJc3dpdGNoIChy
YXRlKSB7CkBAIC04NTUsMjcgKzkwNSwzNiBAQCBzdGF0aWMgaW50IHRjX21haW5fbGlua19lbmFi
bGUoc3RydWN0IHRjX2RhdGEgKnRjKQogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAJdmFsdWUgfD0g
U1lTQ0xLX1NFTF9MU0NMSyB8IExTQ0xLX0RJVl8yOwotCXRjX3dyaXRlKFNZU19QTExQQVJBTSwg
dmFsdWUpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBTWVNfUExMUEFSQU0sIHZh
bHVlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJLyogU2V0dXAgTWFpbiBMaW5rICov
CiAJZHBfcGh5X2N0cmwgPSBCR1JFTiB8IFBXUl9TV19FTiB8IFBIWV9BMF9FTiB8IFBIWV9NMF9F
TjsKIAlpZiAodGMtPmxpbmsuYmFzZS5udW1fbGFuZXMgPT0gMikKIAkJZHBfcGh5X2N0cmwgfD0g
UEhZXzJMQU5FOwotCXRjX3dyaXRlKERQX1BIWV9DVFJMLCBkcF9waHlfY3RybCk7CisKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFBfUEhZX0NUUkwsIGRwX3BoeV9jdHJsKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJLyogUExMIHNldHVwICovCi0JdGNfd3JpdGUoRFAw
X1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJl
Z21hcCwgRFAwX1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OwogCXRjX3dhaXRfcGxsX2xvY2sodGMpOwogCi0JdGNfd3JpdGUoRFAxX1BMTENUUkws
IFBMTFVQREFURSB8IFBMTEVOKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAx
X1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owog
CXRjX3dhaXRfcGxsX2xvY2sodGMpOwogCiAJLyogUmVzZXQvRW5hYmxlIE1haW4gTGlua3MgKi8K
IAlkcF9waHlfY3RybCB8PSBEUF9QSFlfUlNUIHwgUEhZX00xX1JTVCB8IFBIWV9NMF9SU1Q7Ci0J
dGNfd3JpdGUoRFBfUEhZX0NUUkwsIGRwX3BoeV9jdHJsKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUo
dGMtPnJlZ21hcCwgRFBfUEhZX0NUUkwsIGRwX3BoeV9jdHJsKTsKIAl1c2xlZXBfcmFuZ2UoMTAw
LCAyMDApOwogCWRwX3BoeV9jdHJsICY9IH4oRFBfUEhZX1JTVCB8IFBIWV9NMV9SU1QgfCBQSFlf
TTBfUlNUKTsKLQl0Y193cml0ZShEUF9QSFlfQ1RSTCwgZHBfcGh5X2N0cmwpOworCXJldCA9IHJl
Z21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUF9QSFlfQ1RSTCwgZHBfcGh5X2N0cmwpOwogCiAJcmV0
ID0gdGNfcG9sbF90aW1lb3V0KHRjLCBEUF9QSFlfQ1RSTCwgUEhZX1JEWSwgUEhZX1JEWSwgMSwg
MTAwMCk7CiAJaWYgKHJldCkgewpAQCAtODg2LDcgKzk0NSw3IEBAIHN0YXRpYyBpbnQgdGNfbWFp
bl9saW5rX2VuYWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAJLyogU2V0IG1pc2M6IDggYml0cyBw
ZXIgY29sb3IgKi8KIAlyZXQgPSByZWdtYXBfdXBkYXRlX2JpdHModGMtPnJlZ21hcCwgRFAwX01J
U0MsIEJQQ184LCBCUENfOCk7CiAJaWYgKHJldCkKLQkJZ290byBlcnI7CisJCXJldHVybiByZXQ7
CiAKIAkvKgogCSAqIEFTU1IgbW9kZQpAQCAtOTM5LDUzICs5OTgsNzEgQEAgc3RhdGljIGludCB0
Y19tYWluX2xpbmtfZW5hYmxlKHN0cnVjdCB0Y19kYXRhICp0YykKIAkvKiBDbG9jay1SZWNvdmVy
eSAqLwogCiAJLyogU2V0IERQQ0QgMHgxMDIgZm9yIFRyYWluaW5nIFBhdHRlcm4gMSAqLwotCXRj
X3dyaXRlKERQMF9TTktMVENUUkwsIERQX0xJTktfU0NSQU1CTElOR19ESVNBQkxFIHwKLQkJIERQ
X1RSQUlOSU5HX1BBVFRFUk5fMSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQ
MF9TTktMVENUUkwsCisJCQkgICBEUF9MSU5LX1NDUkFNQkxJTkdfRElTQUJMRSB8CisJCQkgICBE
UF9UUkFJTklOR19QQVRURVJOXzEpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKLQl0Y193
cml0ZShEUDBfTFRMT09QQ1RSTCwKLQkJICgxNSA8PCAyOCkgfAkvKiBEZWZlciBJdGVyYXRpb24g
Q291bnQgKi8KLQkJICgxNSA8PCAyNCkgfAkvKiBMb29wIEl0ZXJhdGlvbiBDb3VudCAqLwotCQkg
KDB4ZCA8PCAwKSk7CS8qIExvb3AgVGltZXIgRGVsYXkgKi8KKwlyZXQgPSByZWdtYXBfd3JpdGUo
dGMtPnJlZ21hcCwgRFAwX0xUTE9PUENUUkwsCisJCQkgICAoMTUgPDwgMjgpIHwJLyogRGVmZXIg
SXRlcmF0aW9uIENvdW50ICovCisJCQkgICAoMTUgPDwgMjQpIHwJLyogTG9vcCBJdGVyYXRpb24g
Q291bnQgKi8KKwkJCSAgICgweGQgPDwgMCkpOwkvKiBMb29wIFRpbWVyIERlbGF5ICovCisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKIAotCXRjX3dyaXRlKERQMF9TUkNDVFJMLCB0Y19zcmNjdHJs
KHRjKSB8IERQMF9TUkNDVFJMX1NDUk1CTERJUyB8Ci0JCSBEUDBfU1JDQ1RSTF9BVVRPQ09SUkVD
VCB8IERQMF9TUkNDVFJMX1RQMSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQ
MF9TUkNDVFJMLAorCQkJICAgdGNfc3JjY3RybCh0YykgfCBEUDBfU1JDQ1RSTF9TQ1JNQkxESVMg
fAorCQkJICAgRFAwX1NSQ0NUUkxfQVVUT0NPUlJFQ1QgfAorCQkJICAgRFAwX1NSQ0NUUkxfVFAx
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJLyogRW5hYmxlIERQMCB0byBzdGFydCBM
aW5rIFRyYWluaW5nICovCi0JdGNfd3JpdGUoRFAwQ1RMLAotCQkgKCh0Yy0+bGluay5iYXNlLmNh
cGFiaWxpdGllcyAmIERQX0xJTktfQ0FQX0VOSEFOQ0VEX0ZSQU1JTkcpID8gRUZfRU4gOiAwKSB8
Ci0JCSBEUF9FTik7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMENUTCwKKwkJ
CSAgICgodGMtPmxpbmsuYmFzZS5jYXBhYmlsaXRpZXMgJgorCQkJICAgICBEUF9MSU5LX0NBUF9F
TkhBTkNFRF9GUkFNSU5HKSA/IEVGX0VOIDogMCkgfAorCQkJICAgRFBfRU4pOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CiAKIAkvKiB3YWl0ICovCisKIAlyZXQgPSB0Y193YWl0X2xpbmtfdHJh
aW5pbmcodGMpOwogCWlmIChyZXQgPCAwKQotCQlnb3RvIGVycjsKKwkJcmV0dXJuIHJldDsKIAog
CWlmIChyZXQpIHsKIAkJZGV2X2Vycih0Yy0+ZGV2LCAiTGluayB0cmFpbmluZyBwaGFzZSAxIGZh
aWxlZDogJXNcbiIsCiAJCQl0cmFpbmluZ19wYXR0ZXJuMV9lcnJvcnNbcmV0XSk7Ci0JCXJldCA9
IC1FTk9ERVY7Ci0JCWdvdG8gZXJyOworCQlyZXR1cm4gLUVOT0RFVjsKIAl9CiAKIAkvKiBDaGFu
bmVsIEVxdWFsaXphdGlvbiAqLwogCiAJLyogU2V0IERQQ0QgMHgxMDIgZm9yIFRyYWluaW5nIFBh
dHRlcm4gMiAqLwotCXRjX3dyaXRlKERQMF9TTktMVENUUkwsIERQX0xJTktfU0NSQU1CTElOR19E
SVNBQkxFIHwKLQkJIERQX1RSQUlOSU5HX1BBVFRFUk5fMik7CisJcmV0ID0gcmVnbWFwX3dyaXRl
KHRjLT5yZWdtYXAsIERQMF9TTktMVENUUkwsCisJCQkgICBEUF9MSU5LX1NDUkFNQkxJTkdfRElT
QUJMRSB8CisJCQkgICBEUF9UUkFJTklOR19QQVRURVJOXzIpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CiAKLQl0Y193cml0ZShEUDBfU1JDQ1RSTCwgdGNfc3JjY3RybCh0YykgfCBEUDBfU1JD
Q1RSTF9TQ1JNQkxESVMgfAotCQkgRFAwX1NSQ0NUUkxfQVVUT0NPUlJFQ1QgfCBEUDBfU1JDQ1RS
TF9UUDIpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfU1JDQ1RSTCwKKwkJ
CSAgIHRjX3NyY2N0cmwodGMpIHwgRFAwX1NSQ0NUUkxfU0NSTUJMRElTIHwKKwkJCSAgIERQMF9T
UkNDVFJMX0FVVE9DT1JSRUNUIHwKKwkJCSAgIERQMF9TUkNDVFJMX1RQMik7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKIAogCS8qIHdhaXQgKi8KIAlyZXQgPSB0Y193YWl0X2xpbmtfdHJhaW5p
bmcodGMpOwogCWlmIChyZXQgPCAwKQotCQlnb3RvIGVycjsKKwkJcmV0dXJuIHJldDsKIAogCWlm
IChyZXQpIHsKIAkJZGV2X2Vycih0Yy0+ZGV2LCAiTGluayB0cmFpbmluZyBwaGFzZSAyIGZhaWxl
ZDogJXNcbiIsCiAJCQl0cmFpbmluZ19wYXR0ZXJuMl9lcnJvcnNbcmV0XSk7Ci0JCXJldCA9IC1F
Tk9ERVY7Ci0JCWdvdG8gZXJyOworCQlyZXR1cm4gLUVOT0RFVjsKIAl9CiAKIAkvKgpAQCAtOTk4
LDcgKzEwNzUsMTAgQEAgc3RhdGljIGludCB0Y19tYWluX2xpbmtfZW5hYmxlKHN0cnVjdCB0Y19k
YXRhICp0YykKIAkgKi8KIAogCS8qIENsZWFyIFRyYWluaW5nIFBhdHRlcm4sIHNldCBBdXRvQ29y
cmVjdCBNb2RlID0gMSAqLwotCXRjX3dyaXRlKERQMF9TUkNDVFJMLCB0Y19zcmNjdHJsKHRjKSB8
IERQMF9TUkNDVFJMX0FVVE9DT1JSRUNUKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21h
cCwgRFAwX1NSQ0NUUkwsIHRjX3NyY2N0cmwodGMpIHwKKwkJCSAgIERQMF9TUkNDVFJMX0FVVE9D
T1JSRUNUKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJLyogQ2xlYXIgRFBDRCAweDEw
MiAqLwogCS8qIE5vdGU6IENhbiBOb3QgdXNlIERQMF9TTktMVENUUkwgKDB4MDZFNCkgc2hvcnQg
Y3V0ICovCkBAIC0xMDQyLDcgKzExMjIsNyBAQCBzdGF0aWMgaW50IHRjX21haW5fbGlua19lbmFi
bGUoc3RydWN0IHRjX2RhdGEgKnRjKQogCQlkZXZfZXJyKGRldiwgIjB4MDIwNSBTSU5LX1NUQVRV
UzogICAgICAgICAgICAgICAweCUwMnhcbiIsIHRtcFszXSk7CiAJCWRldl9lcnIoZGV2LCAiMHgw
MjA2IEFESlVTVF9SRVFVRVNUX0xBTkUwXzE6ICAgIDB4JTAyeFxuIiwgdG1wWzRdKTsKIAkJZGV2
X2VycihkZXYsICIweDAyMDcgQURKVVNUX1JFUVVFU1RfTEFORTJfMzogICAgMHglMDJ4XG4iLCB0
bXBbNV0pOwotCQlnb3RvIGVycjsKKwkJcmV0dXJuIHJldDsKIAl9CiAKIAlyZXR1cm4gMDsKQEAg
LTEwNTEsNyArMTEzMSw2IEBAIHN0YXRpYyBpbnQgdGNfbWFpbl9saW5rX2VuYWJsZShzdHJ1Y3Qg
dGNfZGF0YSAqdGMpCiAJcmV0dXJuIHJldDsKIGVycl9kcGNkX3dyaXRlOgogCWRldl9lcnIodGMt
PmRldiwgIkZhaWxlZCB0byB3cml0ZSBEUENEOiAlZFxuIiwgcmV0KTsKLWVycjoKIAlyZXR1cm4g
cmV0OwogfQogCkBAIC0xMDYxLDEyICsxMTQwLDExIEBAIHN0YXRpYyBpbnQgdGNfbWFpbl9saW5r
X2Rpc2FibGUoc3RydWN0IHRjX2RhdGEgKnRjKQogCiAJZGV2X2RiZyh0Yy0+ZGV2LCAibGluayBk
aXNhYmxlXG4iKTsKIAotCXRjX3dyaXRlKERQMF9TUkNDVFJMLCAwKTsKLQl0Y193cml0ZShEUDBD
VEwsIDApOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfU1JDQ1RSTCwgMCk7
CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAotCXJldHVybiAwOwotZXJyOgotCXJldHVybiBy
ZXQ7CisJcmV0dXJuIHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBDVEwsIDApOwogfQogCiBz
dGF0aWMgaW50IHRjX3N0cmVhbV9lbmFibGUoc3RydWN0IHRjX2RhdGEgKnRjKQpAQCAtMTA4MSw3
ICsxMTU5LDcgQEAgc3RhdGljIGludCB0Y19zdHJlYW1fZW5hYmxlKHN0cnVjdCB0Y19kYXRhICp0
YykKIAkJcmV0ID0gdGNfcHhsX3BsbF9lbih0YywgY2xrX2dldF9yYXRlKHRjLT5yZWZjbGspLAog
CQkJCSAgICAxMDAwICogdGMtPm1vZGUuY2xvY2spOwogCQlpZiAocmV0KQotCQkJZ290byBlcnI7
CisJCQlyZXR1cm4gcmV0OwogCX0KIAogCXJldCA9IHRjX3NldF92aWRlb19tb2RlKHRjLCAmdGMt
Pm1vZGUpOwpAQCAtMTA5Niw3ICsxMTc0LDkgQEAgc3RhdGljIGludCB0Y19zdHJlYW1fZW5hYmxl
KHN0cnVjdCB0Y19kYXRhICp0YykKIAl2YWx1ZSA9IFZJRF9NTl9HRU4gfCBEUF9FTjsKIAlpZiAo
dGMtPmxpbmsuYmFzZS5jYXBhYmlsaXRpZXMgJiBEUF9MSU5LX0NBUF9FTkhBTkNFRF9GUkFNSU5H
KQogCQl2YWx1ZSB8PSBFRl9FTjsKLQl0Y193cml0ZShEUDBDVEwsIHZhbHVlKTsKKwlyZXQgPSBy
ZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwQ1RMLCB2YWx1ZSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKIAkvKgogCSAqIFZJRF9FTiBhc3NlcnRpb24gc2hvdWxkIGJlIGRlbGF5ZWQgYnkg
YXQgbGVhc3QgTiAqIExTQ0xLCiAJICogY3ljbGVzIGZyb20gdGhlIHRpbWUgVklEX01OX0dFTiBp
cyBlbmFibGVkIGluIG9yZGVyIHRvCkBAIC0xMTA2LDM2ICsxMTg2LDM1IEBAIHN0YXRpYyBpbnQg
dGNfc3RyZWFtX2VuYWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAJICovCiAJdXNsZWVwX3Jhbmdl
KDUwMCwgMTAwMCk7CiAJdmFsdWUgfD0gVklEX0VOOwotCXRjX3dyaXRlKERQMENUTCwgdmFsdWUp
OworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBDVEwsIHZhbHVlKTsKKwlpZiAo
cmV0KQorCQlyZXR1cm4gcmV0OwogCS8qIFNldCBpbnB1dCBpbnRlcmZhY2UgKi8KIAl2YWx1ZSA9
IERQMF9BVURTUkNfTk9fSU5QVVQ7CiAJaWYgKHRjX3Rlc3RfcGF0dGVybikKIAkJdmFsdWUgfD0g
RFAwX1ZJRFNSQ19DT0xPUl9CQVI7CiAJZWxzZQogCQl2YWx1ZSB8PSBEUDBfVklEU1JDX0RQSV9S
WDsKLQl0Y193cml0ZShTWVNDVFJMLCB2YWx1ZSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5y
ZWdtYXAsIFNZU0NUUkwsIHZhbHVlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJcmV0
dXJuIDA7Ci1lcnI6Ci0JcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCB0Y19zdHJlYW1fZGlz
YWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiB7CiAJaW50IHJldDsKLQl1MzIgdmFsOwogCiAJZGV2
X2RiZyh0Yy0+ZGV2LCAiZGlzYWJsZSB2aWRlbyBzdHJlYW1cbiIpOwogCi0JdGNfcmVhZChEUDBD
VEwsICZ2YWwpOwotCXZhbCAmPSB+VklEX0VOOwotCXRjX3dyaXRlKERQMENUTCwgdmFsKTsKKwly
ZXQgPSByZWdtYXBfdXBkYXRlX2JpdHModGMtPnJlZ21hcCwgRFAwQ1RMLCBWSURfRU4sIDApOwor
CWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAl0Y19weGxfcGxsX2Rpcyh0Yyk7CiAKIAlyZXR1
cm4gMDsKLWVycjoKLQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCB0Y19icmlkZ2VfcHJl
X2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQpAQCAtMTMyNyw3ICsxNDA2LDkgQEAg
c3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMgdGNfY29ubmVjdG9yX2RldGVjdChzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmUKIAkJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX3Vua25v
d247CiAJfQogCi0JdGNfcmVhZChHUElPSSwgJnZhbCk7CisJcmV0ID0gcmVnbWFwX3JlYWQodGMt
PnJlZ21hcCwgR1BJT0ksICZ2YWwpOworCWlmIChyZXQpCisJCXJldHVybiBjb25uZWN0b3Jfc3Rh
dHVzX3Vua25vd247CiAKIAljb25uID0gdmFsICYgQklUKHRjLT5ocGRfcGluKTsKIApAQCAtMTMz
NSw5ICsxNDE2LDYgQEAgc3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMgdGNfY29ubmVj
dG9yX2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmUKIAkJcmV0dXJuIGNvbm5lY3Rv
cl9zdGF0dXNfY29ubmVjdGVkOwogCWVsc2UKIAkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfZGlz
Y29ubmVjdGVkOwotCi1lcnI6Ci0JcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfdW5rbm93bjsKIH0K
IAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2Z1bmNzIHRjX2Nvbm5lY3Rvcl9m
dW5jcyA9IHsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
