Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8F87832F016
	for <lists+dri-devel@lfdr.de>; Fri,  5 Mar 2021 17:31:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 304876EBA8;
	Fri,  5 Mar 2021 16:31:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav21.altibox.net (asav21.altibox.net [109.247.116.8])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 454356EBA8
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Mar 2021 16:31:19 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav21.altibox.net (Postfix) with ESMTPSA id 23437801AE;
 Fri,  5 Mar 2021 17:31:17 +0100 (CET)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 3/3] drm: Add GUD USB Display driver
Date: Fri,  5 Mar 2021 17:31:04 +0100
Message-Id: <20210305163104.30756-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20210305163104.30756-1-noralf@tronnes.org>
References: <20210305163104.30756-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=PJ4hB8iC c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=SJz97ENfAAAA:8 a=gAmX6pxEAAAA:20
 a=e5mUnYsNAAAA:8 a=20KFwNOVAAAA:8 a=XQfUo3buxsil4UYIs80A:9
 a=MtIykYbnxLeOWnGZ:21 a=G_GndQivcDoq_av6:21 a=QEXdDO2ut3YA:10
 a=vFet0B0WnEQeilDPIY6i:22 a=Vxmtnl_E_bksehYqCbjh:22
 a=BPzZvq435JnGatEyYwdK:22 a=pHzHmUro8NiASowvMSCR:22
 a=nt3jZW36AmriUCFCBwmW:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: hudson@trmm.net, markus@raatikainen.cc, sam@ravnborg.org,
 linux-usb@vger.kernel.org, th020394@gmail.com, lkundrak@v3.sk,
 pontus.fuchs@gmail.com, Daniel Vetter <daniel.vetter@ffwll.ch>, peter@stuge.se
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgVVNCIGRpc3BsYXkgZHJpdmVyIHdpdGggdGhlIGludGVudGlvbiB0aGF0IGl0
IGNhbiBiZQp1c2VkIHdpdGggZnV0dXJlIFVTQiBpbnRlcmZhY2VkIGxvdyBlbmQgZGlzcGxheXMv
YWRhcHRlcnMuIFRoZSBMaW51eApnYWRnZXQgZGV2aWNlIGRyaXZlciB3aWxsIHNlcnZlIGFzIHRo
ZSBjYW5vbmljYWwgZGV2aWNlIGltcGxlbWVudGF0aW9uLgoKVGhlIGZvbGxvd2luZyBEUk0gcHJv
cGVydGllcyBhcmUgc3VwcG9ydGVkOgotIFBsYW5lIHJvdGF0aW9uCi0gQ29ubmVjdG9yIFRWIHBy
b3BlcnRpZXMKClRoZXJlIGlzIGFsc28gc3VwcG9ydCBmb3IgYmFja2xpZ2h0IGJyaWdodG5lc3Mg
ZXhwb3NlZCBhcyBhIGJhY2tsaWdodApkZXZpY2UuCgpEaXNwbGF5IG1vZGVzIGNhbiBiZSBtYWRl
IGF2YWlsYWJsZSB0byB0aGUgaG9zdCBkcml2ZXIgZWl0aGVyIGFzIERSTQpkaXNwbGF5IG1vZGVz
IG9yIHRocm91Z2ggRURJRC4gSWYgYm90aCBhcmUgcHJlc2VudCwgRURJRCBpcyBqdXN0IHBhc3Nl
ZApvbiB0byB1c2Vyc3BhY2UuCgpQZXJmb3JtYW5jZSBpcyBwcmVmZXJyZWQgb3ZlciBjb2xvciBk
ZXB0aCwgc28gaWYgdGhlIGRldmljZSBzdXBwb3J0cwpSR0I1NjUsIERSTV9DQVBfRFVNQl9QUkVG
RVJSRURfREVQVEggd2lsbCByZXR1cm4gMTYuCgpJZiB0aGUgZGV2aWNlIHRyYW5zZmVyIGJ1ZmZl
ciBjYW4ndCBmaXQgYW4gdW5jb21wcmVzc2VkIGZyYW1lYnVmZmVyCnVwZGF0ZSwgdGhlIHVwZGF0
ZSBpcyBzcGxpdCB1cCBpbnRvIHBhcnRzIHRoYXQgZG8gZml0LgoKT3B0aW1hbCB1c2VyIGV4cGVy
aWVuY2UgaXMgYWNoaWV2ZWQgYnkgcHJvdmlkaW5nIGRhbWFnZSByZXBvcnRzIGVpdGhlciBieQpz
ZXR0aW5nIEZCX0RBTUFHRV9DTElQUyBvbiBwYWdlZmxpcHMgb3IgY2FsbGluZyBEUk1fSU9DVExf
TU9ERV9ESVJUWUZCLgoKTFo0IGNvbXByZXNzaW9uIGlzIHVzZWQgaWYgdGhlIGRldmljZSBzdXBw
b3J0cyBpdC4KClRoZSBkcml2ZXIgc3VwcG9ydHMgYSBvbmUgYml0IG1vbm9jaHJvbWUgdHJhbnNm
ZXIgZm9ybWF0OiBSMS4gVGhpcyBpcyBub3QKaW1wbGVtZW50ZWQgaW4gdGhlIGdhZGdldCBkcml2
ZXIuIEl0IGlzIGFkZGVkIGluIHByZXBhcmF0aW9uIGZvciBmdXR1cmUKbW9ub2Nocm9tZSBlLWlu
ayBkaXNwbGF5cy4KClRoZSBkcml2ZXIgaXMgTUlUIGxpY2Vuc2VkIHRvIHNtb290aCB0aGUgcGF0
aCBmb3IgYW55IEJTRCBwb3J0IG9mIHRoZQpkcml2ZXIuCgp2MjoKLSBVc2UgZGV2bV9kcm1fZGV2
X2FsbG9jKCkgYW5kIGRybW1fbW9kZV9jb25maWdfaW5pdCgpCi0gZHJtX2ZiZGV2X2dlbmVyaWNf
c2V0dXA6IFVzZSBwcmVmZXJyZWRfYnBwPTAsIDE2IHdhcyBhIGNvcHkgcGFzdGUgZXJyb3IKLSBU
aGUgZHJtX2JhY2tsaWdodF9oZWxwZXIgaXMgZHJvcHBlZCwgY29weSBpbiB0aGUgY29kZQotIFN1
cHBvcnQgcHJvdG9jb2wgdmVyc2lvbiBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgZGV2aWNl
Cgp2MzoKLSBVc2UgZG9uYXRlZCBPcGVubW9rbyBVU0IgcGlkCi0gVXNlIGRpcmVjdCBjb21wcmVz
c2lvbiBmcm9tIGZyYW1lYnVmZmVyIHdoZW4gcGl0Y2ggbWF0Y2hlcywgbm90IG9ubHkgb24KICBm
dWxsIGZyYW1lcywgc28gc3BsaXQgdXBkYXRlcyBjYW4gYmVuZWZpdAotIFVzZSBfX2xlMTYgaW4g
c3RydWN0IGd1ZF9kcm1fcmVxX2dldF9jb25uZWN0b3Jfc3RhdHVzCi0gU2V0IGVkaWQgcHJvcGVy
dHkgd2hlbiB0aGUgZGV2aWNlIG9ubHkgcHJvdmlkZXMgZWRpZAotIENsZWFyIGNvbXByZXNzaW9u
IGZpZWxkcyBpbiBzdHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X2J1ZmZlcgotIEZpeCBwcm90b2NvbCB2
ZXJzaW9uIG5lZ290aWF0aW9uCi0gUmVtb3ZlIG1vZGUtPnZyZWZyZXNoLCBpdCdzIGNhbGN1bGF0
ZWQKCnY0OgotIERyb3AgdGhlIHN0YXR1cyByZXEgcG9sbGluZyB3aGljaCB3YXMgYSB3b3JrYXJv
dW5kIGZvciBzb21ldGhpbmcgdGhhdAogIHR1cm5lZCBvdXQgdG8gYmUgYSBkd2MyIHVkYyBkcml2
ZXIgcHJvYmxlbQotIEFkZCBhIGZsYWcgZm9yIHRoZSBMaW51eCBnYWRnZXQgdG8gcmVxdWlyZSBh
IHN0YXR1cyByZXF1ZXN0IG9uCiAgU0VUIG9wZXJhdGlvbnMuIE90aGVyIGRldmljZXMgd2lsbCBv
bmx5IGdldCBzdGF0dXMgcmVxIG9uIFNUQUxMIGVycm9ycwotIFVzZSBwcm90b2NvbCBzcGVjaWZp
YyBlcnJvciBjb2RlcyAoUGV0ZXIpCi0gQWRkIGEgZmxhZyBmb3IgZGV2aWNlcyB0aGF0IHdhbnQg
dG8gcmVjZWl2ZSB0aGUgZW50aXJlIGZyYW1lYnVmZmVyIG9uCiAgZWFjaCBmbHVzaCAoTHVib21p
cikKLSBSZXRyeSBhIGZhaWxlZCBmcmFtZWJ1ZmZlciBmbHVzaAotIElmIG1vZGUgaGFzIGNoYW5n
ZWQgd2FpdCBmb3Igd29ya2VyIGFuZCBjbGVhciBwZW5kaW5nIGRhbWFnZSBiZWZvcmUKICBxdWV1
aW5nIHVwIG5ldyBkYW1hZ2UsIGZiIHdpZHRoL2hlaWdodCBtaWdodCBoYXZlIGNoYW5nZWQKLSBJ
bmNyZWFzZSBlcnJvciBjb3VudGVyIG9uIGJ1bGsgdHJhbnNmZXIgZmFpbHVyZXMKLSBVc2UgRFJN
X01PREVfQ09OTkVDVE9SX1VTQgotIEhhbmRsZSBSMSBrbWFsbG9jIGVycm9yIChQZXRlcikKLSBE
b24ndCB0cnkgYW5kIHJlcGxpY2F0ZSB0aGUgVVNCIGdldCBkZXNjcmlwdG9yIHJlcXVlc3Qgc3Rh
bmRhcmQgZm9yIHRoZQogIGRpc3BsYXkgZGVzY3JpcHRvciAoUGV0ZXIpCi0gTWFrZSBtYXhfYnVm
ZmVyX3NpemUgb3B0aW9uYWwgKFBldGVyKSwgZHJvcCB0aGUgcG93MiByZXF1aXJlbWVudCBzaW5j
ZQogIGl0J3Mgbm90IG5lY2Vzc2FyeSBhbnltb3JlLgotIERvbid0IHByZS1hbGxvYyBhIGNvbnRy
b2wgcmVxdWVzdCBidWZmZXIsIGl0IHdhcyBvbmx5IDRrCi0gTGV0IGd1ZC5oIGRlc2NyaWJlIHRo
ZSB3aG9sZSBwcm90b2NvbCBleHBsaWNpdGx5IGFuZCBkb24ndCBsZXQgRFJNCiAgbGVhayBpbnRv
IGl0IChQZXRlcikKLSBEcm9wIGRpc3BsYXkgbW9kZSAuaHNrZXcgYW5kIC52c2NhbiBmcm9tIHRo
ZSBwcm90b2NvbAotIFNob3J0ZW4gbmFtZXM6IHMvR1VEX0RSTV8vR1VEXy8gcy9ndWRfZHJtXy9n
dWRfLyAoUGV0ZXIpCi0gRml4IGd1ZF9waXBlX2NoZWNrKCkgY29ubmVjdG9yIHBpY2tpbmcgd2hl
biBzd2l0Y2hpbmcgY29ubmVjdG9yCi0gRHJvcCBndWRfZHJtX2RyaXZlcl9nZW1fY3JlYXRlX29i
amVjdCgpIGNhY2hlZCBpcyBkZWZhdWx0IG5vdwotIFJldHJpZXZlIFVTQiBkZXZpY2UgZnJvbSBz
dHJ1Y3QgZHJtX2RldmljZS5kZXYgaW5zdGVhZCBvZiBrZWVwaW5nIGEKICBwb2ludGVyCi0gSG9u
b3VyIGZiLT5vZmZzZXRzWzBdCi0gRml4IG1vZGUgZmV0Y2hpbmcgd2hlbiBjb25uZWN0b3Igc3Rh
dHVzIGlzIGZvcmNlZAotIENoZWNrIEVESUQgbGVuZ3RoIHJlcG9ydGVkIGJ5IHRoZSBkZXZpY2UK
LSBVc2UgZHJtX2RvX2dldF9lZGlkKCkgc28gdXNlcnNwYWNlIGNhbiBvdmVycnJpZGUgRURJRAot
IFNldCBlcG9jaCBjb3VudGVyIHRvIHNpZ25hbCBjb25uZWN0b3Igc3RhdHVzIGNoYW5nZQotIGd1
ZF9kcm1fZHJpdmVyIGNhbiBiZSBjb25zdCBub3cKCnY1OgotIEdVRF9EUk1fRk9STUFUX1IxOiBV
c2Ugbm9uLWh1bWFuIGFzY2lpIHZhbHVlcyAoRGFuaWVsKQotIENoYW5nZSBuYW1lIHRvOiBHVUQg
VVNCIERpc3BsYXkgKFRob21hcywgU2ltb24pCi0gQ2hhbmdlIG9uZSBfX3UzMiAtPiBfX2xlMzIg
aW4gcHJvdG9jb2wgaGVhZGVyCi0gQWx3YXlzIGxvZyBmYiBmbHVzaCBlcnJvcnMsIHVubGVzcyB0
aGUgcHJldmlvdXMgb25lIGZhaWxlZAotIFJ1biBiYWNrbGlnaHQgdXBkYXRlIGluIGEgd29ya2Vy
IHRvIGF2b2lkIHVwc2V0dGluZyBsb2NrZGVwIChEYW5pZWwpCi0gRHJvcCBiYWNrbGlnaHRfb3Bz
LmdldF9icmlnaHRuZXNzLCB0aGVyZSdzIG5vIHJlYWRiYWNrIGZyb20gdGhlIGRldmljZQogIHNv
IGl0IGRvZXNuJ3QgcmVhbGx5IGFkZCBhbnl0aGluZy4KLSBTZXQgZG1hIG1hc2ssIG5lZWRlZCBi
eSBkbWEtYnVmIGltcG9ydGVycwoKdjY6Ci0gVXNlIG9iai15IGluIE1ha2VmaWxlIChQZXRlcikK
LSBGaXggbWlzc2luZyBsZTMyX3RvX2NwdSgpIHdoZW4gdXNpbmcgR1VEX0RJU1BMQVlfTUFHSUMg
KFBldGVyKQotIFNldCBpbml0aWFsIGJyaWdodG5lc3Mgb24gYmFja2xpZ2h0IGRldmljZQoKdjc6
Ci0gTFo0X2NvbXByZXNzX2RlZmF1bHQoKSBjYW4gcmV0dXJuIHplcm8sIGNoZWNrIGZvciB0aGF0
Ci0gRml4IG1lbW9yeSBsZWFrIGluIGd1ZF9waXBlX2NoZWNrKCkgZXJyb3IgcGF0aCAoUGV0ZXIp
Ci0gSW1wcm92ZSBkZWJ1ZyBhbmQgZXJyb3IgbWVzc2FnZXMgKFBldGVyKQotIERvbid0IHBhc3Mg
bGVuZ3RoIGluIHByb3RvY29sIHN0cnVjdHMgKFBldGVyKQotIFBhc3MgVVNCIGludGVyZmFjZSB0
byBndWRfdXNiX2NvbnRyb2xfbXNnKCkgZXQgYWwuIChQZXRlcikKLSBJbXByb3ZlIGd1ZF9jb25u
ZWN0b3JfZmlsbF9wcm9wZXJ0aWVzKCkgKFBldGVyKQotIEFkZCBHVURfUElYRUxfRk9STUFUX1JH
QjExMSAoUGV0ZXIpCi0gUmVtb3ZlIEdVRF9SRVFfU0VUX1ZFUlNJT04gKFBldGVyKQotIEZpeCBE
Uk1fSU9DVExfTU9ERV9PQkpfU0VUUFJPUEVSVFkgYW5kIHRoZSByb3RhdGlvbiBwcm9wZXJ0eQot
IEZpeCBkbWEtYnVmIGltcG9ydCAoVGhvbWFzKQoKQ2M6IFBldGVyIFN0dWdlIDxwZXRlckBzdHVn
ZS5zZT4KQ2M6IEx1Ym9taXIgUmludGVsIDxsa3VuZHJha0B2My5zaz4KQWNrZWQtYnk6IERhbmll
bCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+ClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBU
csO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIE1BSU5UQUlORVJTICAgICAgICAgICAg
ICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZlcnMvZ3B1L2RybS9LY29uZmlnICAgICAgICAgICAg
IHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZSAgICAgICAgICAgIHwgICAxICsKIGRy
aXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZyAgICAgICAgIHwgIDE0ICsKIGRyaXZlcnMvZ3B1L2Ry
bS9ndWQvTWFrZWZpbGUgICAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2Nv
bm5lY3Rvci5jIHwgNzI5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1
L2RybS9ndWQvZ3VkX2Rydi5jICAgICAgIHwgNjU5ICsrKysrKysrKysrKysrKysrKysrKysrKysK
IGRyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2ludGVybmFsLmggIHwgMTU0ICsrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2d1ZC9ndWRfcGlwZS5jICAgICAgfCA1MzUgKysrKysrKysrKysrKysrKysrKysK
IGluY2x1ZGUvZHJtL2d1ZC5oICAgICAgICAgICAgICAgICAgIHwgMzMzICsrKysrKysrKysrKysK
IDEwIGZpbGVzIGNoYW5nZWQsIDI0MzkgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9ndWQvTWFrZWZpbGUKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0v
Z3VkL2d1ZF9jb25uZWN0b3IuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9n
dWQvZ3VkX2Rydi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRf
aW50ZXJuYWwuaAogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX3Bp
cGUuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvZHJtL2d1ZC5oCgpkaWZmIC0tZ2l0IGEv
TUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCAwMDExMmMwNDQ2MDguLmU3ZjcxYWM1NWYw
OCAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTU1MjUsNiAr
NTUyNSwxNCBAQCBTOglNYWludGFpbmVkCiBGOglEb2N1bWVudGF0aW9uL2RldmljZXRyZWUvYmlu
ZGluZ3MvZGlzcGxheS9wYW5lbC9mZWl5YW5nLGZ5MDcwMjRkaTI2YTMwZC55YW1sCiBGOglkcml2
ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtZmVpeWFuZy1meTA3MDI0ZGkyNmEzMGQuYwogCitEUk0g
RFJJVkVSIEZPUiBHRU5FUklDIFVTQiBESVNQTEFZCitNOglOb3JhbGYgVHLDuG5uZXMgPG5vcmFs
ZkB0cm9ubmVzLm9yZz4KK1M6CU1haW50YWluZWQKK1c6CWh0dHBzOi8vZ2l0aHViLmNvbS9ub3Ry
by9ndWQvd2lraQorVDoJZ2l0IGdpdDovL2Fub25naXQuZnJlZWRlc2t0b3Aub3JnL2RybS9kcm0t
bWlzYworRjoJZHJpdmVycy9ncHUvZHJtL2d1ZC8KK0Y6CWluY2x1ZGUvZHJtL2d1ZC5oCisKIERS
TSBEUklWRVIgRk9SIEdSQUlOIE1FRElBIEdNMTJVMzIwIFBST0pFQ1RPUlMKIE06CUhhbnMgZGUg
R29lZGUgPGhkZWdvZWRlQHJlZGhhdC5jb20+CiBTOglNYWludGFpbmVkCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCmluZGV4IDE0
N2Q2MWI5Njc0ZS4uNmQzZjQ3OTMzZTUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vS2Nv
bmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZwpAQCAtMzg4LDYgKzM4OCw4IEBAIHNv
dXJjZSAiZHJpdmVycy9ncHUvZHJtL3RpZHNzL0tjb25maWciCiAKIHNvdXJjZSAiZHJpdmVycy9n
cHUvZHJtL3hsbngvS2NvbmZpZyIKIAorc291cmNlICJkcml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25m
aWciCisKICMgS2VlcCBsZWdhY3kgZHJpdmVycyBsYXN0CiAKIG1lbnVjb25maWcgRFJNX0xFR0FD
WQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJt
L01ha2VmaWxlCmluZGV4IDgxNTY5MDA5Zjg4NC4uNzhkZDhlMTI1MjVkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlCkBA
IC0xMjQsMyArMTI0LDQgQEAgb2JqLSQoQ09ORklHX0RSTV9BU1BFRURfR0ZYKSArPSBhc3BlZWQv
CiBvYmotJChDT05GSUdfRFJNX01DREUpICs9IG1jZGUvCiBvYmotJChDT05GSUdfRFJNX1RJRFNT
KSArPSB0aWRzcy8KIG9iai15CQkJKz0geGxueC8KK29iai15CQkJKz0gZ3VkLwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29u
ZmlnCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMWM4NjAxYmY0ZDkx
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnCkBAIC0wLDAg
KzEsMTQgQEAKKyMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKworY29uZmlnIERS
TV9HVUQKKwl0cmlzdGF0ZSAiR1VEIFVTQiBEaXNwbGF5IgorCWRlcGVuZHMgb24gRFJNICYmIFVT
QgorCXNlbGVjdCBMWjRfQ09NUFJFU1MKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwlzZWxlY3Qg
RFJNX0dFTV9TSE1FTV9IRUxQRVIKKwlzZWxlY3QgQkFDS0xJR0hUX0NMQVNTX0RFVklDRQorCWhl
bHAKKwkgIFRoaXMgaXMgYSBEUk0gZGlzcGxheSBkcml2ZXIgZm9yIEdVRCBVU0IgRGlzcGxheXMg
b3IgZGlzcGxheQorCSAgYWRhcHRlcnMuCisKKwkgIElmIE0gaXMgc2VsZWN0ZWQgdGhlIG1vZHVs
ZSB3aWxsIGJlIGNhbGxlZCBndWQuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL01h
a2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjY4YTFjNjIyY2YzMwotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9ndWQvTWFrZWZpbGUKQEAgLTAsMCArMSw0IEBACisjIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBHUEwtMi4wCisKK2d1ZC15CQkJCTo9IGd1ZF9kcnYubyBndWRfcGlwZS5v
IGd1ZF9jb25uZWN0b3Iubworb2JqLSQoQ09ORklHX0RSTV9HVUQpCQkrPSBndWQubwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfY29ubmVjdG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vZ3VkL2d1ZF9jb25uZWN0b3IuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwMDAuLmVjNDk1ZGNkNjEyMgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9n
dWQvZ3VkX2Nvbm5lY3Rvci5jCkBAIC0wLDAgKzEsNzI5IEBACisvLyBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IDIwMjAgTm9yYWxmIFRyw7hubmVzCisgKi8K
KworI2luY2x1ZGUgPGxpbnV4L2JhY2tsaWdodC5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1
ZS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0
b21pY19zdGF0ZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Nvbm5lY3Rvci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9maWxlLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tb2Rlc2V0X2hlbHBlcl92
dGFibGVzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUgPGRybS9kcm1f
cHJvYmVfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9zaW1wbGVfa21zX2hlbHBlci5oPgor
I2luY2x1ZGUgPGRybS9ndWQuaD4KKworI2luY2x1ZGUgImd1ZF9pbnRlcm5hbC5oIgorCitzdHJ1
Y3QgZ3VkX2Nvbm5lY3RvciB7CisJc3RydWN0IGRybV9jb25uZWN0b3IgY29ubmVjdG9yOworCXN0
cnVjdCBkcm1fZW5jb2RlciBlbmNvZGVyOworCXN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiYWNr
bGlnaHQ7CisJc3RydWN0IHdvcmtfc3RydWN0IGJhY2tsaWdodF93b3JrOworCisJLyogU3VwcG9y
dGVkIHByb3BlcnRpZXMgKi8KKwl1MTYgKnByb3BlcnRpZXM7CisJdW5zaWduZWQgaW50IG51bV9w
cm9wZXJ0aWVzOworCisJLyogSW5pdGlhbCBnYWRnZXQgdHYgc3RhdGUgaWYgYXBwbGljYWJsZSwg
YXBwbGllZCBvbiBzdGF0ZSByZXNldCAqLworCXN0cnVjdCBkcm1fdHZfY29ubmVjdG9yX3N0YXRl
IGluaXRpYWxfdHZfc3RhdGU7CisKKwkvKgorCSAqIEluaXRpYWwgZ2FkZ2V0IGJhY2tsaWdodCBi
cmlnaHRuZXNzIGlmIGFwcGxpY2FibGUsIGFwcGxpZWQgb24gc3RhdGUgcmVzZXQuCisJICogVGhl
IHZhbHVlIC1FTk9ERVYgaXMgdXNlZCB0byBzaWduYWwgbm8gYmFja2xpZ2h0LgorCSAqLworCWlu
dCBpbml0aWFsX2JyaWdodG5lc3M7Cit9OworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBndWRfY29u
bmVjdG9yICp0b19ndWRfY29ubmVjdG9yKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Ip
Cit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihjb25uZWN0b3IsIHN0cnVjdCBndWRfY29ubmVjdG9y
LCBjb25uZWN0b3IpOworfQorCitzdGF0aWMgdm9pZCBndWRfY29ubl9lcnIoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvciwgY29uc3QgY2hhciAqbXNnLCBpbnQgcmV0KQoreworCWRldl9l
cnIoY29ubmVjdG9yLT5kZXYtPmRldiwgIiVzOiAlcyAocmV0PSVkKVxuIiwgY29ubmVjdG9yLT5u
YW1lLCBtc2csIHJldCk7Cit9CisKKy8qCisgKiBVc2UgYSB3b3JrZXIgdG8gYXZvaWQgdGFraW5n
IGttcyBsb2NrcyBpbnNpZGUgdGhlIGJhY2tsaWdodCBsb2NrLgorICogT3RoZXIgZGlzcGxheSBk
cml2ZXJzIHVzZSBiYWNrbGlnaHQgd2l0aGluIHRoZWlyIGttcyBsb2Nrcy4KKyAqIFRoaXMgYXZv
aWRzIGluY29uc2lzdGVudCBsb2NraW5nIHJ1bGVzLCB3aGljaCB3b3VsZCB1cHNldCBsb2NrZGVw
LgorICovCitzdGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX2JhY2tsaWdodF91cGRhdGVfc3RhdHVz
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9y
ICpnY29ubiA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciwgYmFja2xp
Z2h0X3dvcmspOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSAmZ2Nvbm4tPmNv
bm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwor
CXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBjb25uZWN0b3ItPmRldjsKKwlzdHJ1Y3QgZHJtX21v
ZGVzZXRfYWNxdWlyZV9jdHggY3R4OworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZTsK
KwlpbnQgaWR4LCByZXQ7CisKKwlpZiAoIWRybV9kZXZfZW50ZXIoZHJtLCAmaWR4KSkKKwkJcmV0
dXJuOworCisJc3RhdGUgPSBkcm1fYXRvbWljX3N0YXRlX2FsbG9jKGRybSk7CisJaWYgKCFzdGF0
ZSkgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGV4aXQ7CisJfQorCisJZHJtX21vZGVzZXRf
YWNxdWlyZV9pbml0KCZjdHgsIDApOworCXN0YXRlLT5hY3F1aXJlX2N0eCA9ICZjdHg7CityZXRy
eToKKwljb25uZWN0b3Jfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoc3Rh
dGUsIGNvbm5lY3Rvcik7CisJaWYgKElTX0VSUihjb25uZWN0b3Jfc3RhdGUpKSB7CisJCXJldCA9
IFBUUl9FUlIoY29ubmVjdG9yX3N0YXRlKTsKKwkJZ290byBvdXQ7CisJfQorCisJLyogUmV1c2Ug
dHYuYnJpZ2h0bmVzcyB0byBhdm9pZCBoYXZpbmcgdG8gc3ViY2xhc3MgKi8KKwljb25uZWN0b3Jf
c3RhdGUtPnR2LmJyaWdodG5lc3MgPSBnY29ubi0+YmFja2xpZ2h0LT5wcm9wcy5icmlnaHRuZXNz
OworCisJcmV0ID0gZHJtX2F0b21pY19jb21taXQoc3RhdGUpOworb3V0OgorCWlmIChyZXQgPT0g
LUVERUFETEspIHsKKwkJZHJtX2F0b21pY19zdGF0ZV9jbGVhcihzdGF0ZSk7CisJCWRybV9tb2Rl
c2V0X2JhY2tvZmYoJmN0eCk7CisJCWdvdG8gcmV0cnk7CisJfQorCisJZHJtX2F0b21pY19zdGF0
ZV9wdXQoc3RhdGUpOworCisJZHJtX21vZGVzZXRfZHJvcF9sb2NrcygmY3R4KTsKKwlkcm1fbW9k
ZXNldF9hY3F1aXJlX2ZpbmkoJmN0eCk7CitleGl0OgorCWRybV9kZXZfZXhpdChpZHgpOworCisJ
aWYgKHJldCkKKwkJZGV2X2Vycihkcm0tPmRldiwgIkZhaWxlZCB0byB1cGRhdGUgYmFja2xpZ2h0
LCBlcnI9JWRcbiIsIHJldCk7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9iYWNrbGln
aHRfdXBkYXRlX3N0YXR1cyhzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQpCit7CisJc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9IGJsX2dldF9kYXRhKGJkKTsKKwlzdHJ1Y3QgZ3Vk
X2Nvbm5lY3RvciAqZ2Nvbm4gPSB0b19ndWRfY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwkvKiBU
aGUgVVNCIHRpbWVvdXQgaXMgNSBzZWNvbmRzIHNvIHVzZSBzeXN0ZW1fbG9uZ193cSBmb3Igd29y
c3QgY2FzZSBzY2VuYXJpbyAqLworCXF1ZXVlX3dvcmsoc3lzdGVtX2xvbmdfd3EsICZnY29ubi0+
YmFja2xpZ2h0X3dvcmspOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
YmFja2xpZ2h0X29wcyBndWRfY29ubmVjdG9yX2JhY2tsaWdodF9vcHMgPSB7CisJLnVwZGF0ZV9z
dGF0dXMJPSBndWRfY29ubmVjdG9yX2JhY2tsaWdodF91cGRhdGVfc3RhdHVzLAorfTsKKworc3Rh
dGljIGludCBndWRfY29ubmVjdG9yX2JhY2tsaWdodF9yZWdpc3RlcihzdHJ1Y3QgZ3VkX2Nvbm5l
Y3RvciAqZ2Nvbm4pCit7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9ICZnY29u
bi0+Y29ubmVjdG9yOworCXN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiZDsKKwljb25zdCBjaGFy
ICpuYW1lOworCWNvbnN0IHN0cnVjdCBiYWNrbGlnaHRfcHJvcGVydGllcyBwcm9wcyA9IHsKKwkJ
LnR5cGUgPSBCQUNLTElHSFRfUkFXLAorCQkuc2NhbGUgPSBCQUNLTElHSFRfU0NBTEVfTk9OX0xJ
TkVBUiwKKwkJLm1heF9icmlnaHRuZXNzID0gMTAwLAorCQkuYnJpZ2h0bmVzcyA9IGdjb25uLT5p
bml0aWFsX2JyaWdodG5lc3MsCisJfTsKKworCW5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwg
ImNhcmQlZC0lcy1iYWNrbGlnaHQiLAorCQkJIGNvbm5lY3Rvci0+ZGV2LT5wcmltYXJ5LT5pbmRl
eCwgY29ubmVjdG9yLT5uYW1lKTsKKwlpZiAoIW5hbWUpCisJCXJldHVybiAtRU5PTUVNOworCisJ
YmQgPSBiYWNrbGlnaHRfZGV2aWNlX3JlZ2lzdGVyKG5hbWUsIGNvbm5lY3Rvci0+a2RldiwgY29u
bmVjdG9yLAorCQkJCSAgICAgICAmZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfb3BzLCAmcHJvcHMp
OworCWtmcmVlKG5hbWUpOworCWlmIChJU19FUlIoYmQpKQorCQlyZXR1cm4gUFRSX0VSUihiZCk7
CisKKwlnY29ubi0+YmFja2xpZ2h0ID0gYmQ7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCBndWRfY29ubmVjdG9yX2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAor
CQkJCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4LCBib29sIGZvcmNlKQorewor
CXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RldmljZShjb25uZWN0b3ItPmRldik7
CisJaW50IGlkeCwgcmV0OworCXU4IHN0YXR1czsKKworCWlmICghZHJtX2Rldl9lbnRlcihjb25u
ZWN0b3ItPmRldiwgJmlkeCkpCisJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3Rl
ZDsKKworCWlmIChmb3JjZSkgeworCQlyZXQgPSBndWRfdXNiX3NldChnZHJtLCBHVURfUkVRX1NF
VF9DT05ORUNUT1JfRk9SQ0VfREVURUNULAorCQkJCSAgY29ubmVjdG9yLT5pbmRleCwgTlVMTCwg
MCk7CisJCWlmIChyZXQpIHsKKwkJCXJldCA9IGNvbm5lY3Rvcl9zdGF0dXNfdW5rbm93bjsKKwkJ
CWdvdG8gZXhpdDsKKwkJfQorCX0KKworCXJldCA9IGd1ZF91c2JfZ2V0X3U4KGdkcm0sIEdVRF9S
RVFfR0VUX0NPTk5FQ1RPUl9TVEFUVVMsIGNvbm5lY3Rvci0+aW5kZXgsICZzdGF0dXMpOworCWlm
IChyZXQpIHsKKwkJcmV0ID0gY29ubmVjdG9yX3N0YXR1c191bmtub3duOworCQlnb3RvIGV4aXQ7
CisJfQorCisJc3dpdGNoIChzdGF0dXMgJiBHVURfQ09OTkVDVE9SX1NUQVRVU19DT05ORUNURURf
TUFTSykgeworCWNhc2UgR1VEX0NPTk5FQ1RPUl9TVEFUVVNfRElTQ09OTkVDVEVEOgorCQlyZXQg
PSBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKKwkJYnJlYWs7CisJY2FzZSBHVURfQ09O
TkVDVE9SX1NUQVRVU19DT05ORUNURUQ6CisJCXJldCA9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVj
dGVkOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlyZXQgPSBjb25uZWN0b3Jfc3RhdHVzX3Vua25v
d247CisJCWJyZWFrOworCX07CisKKwlpZiAoc3RhdHVzICYgR1VEX0NPTk5FQ1RPUl9TVEFUVVNf
Q0hBTkdFRCkKKwkJY29ubmVjdG9yLT5lcG9jaF9jb3VudGVyICs9IDE7CitleGl0OgorCWRybV9k
ZXZfZXhpdChpZHgpOworCisJcmV0dXJuIHJldDsKK30KKworc3RydWN0IGd1ZF9jb25uZWN0b3Jf
Z2V0X2VkaWRfY3R4IHsKKwl2b2lkICpidWY7CisJc2l6ZV90IGxlbjsKKwlib29sIGVkaWRfb3Zl
cnJpZGU7Cit9OworCitzdGF0aWMgaW50IGd1ZF9jb25uZWN0b3JfZ2V0X2VkaWRfYmxvY2sodm9p
ZCAqZGF0YSwgdTggKmJ1ZiwgdW5zaWduZWQgaW50IGJsb2NrLCBzaXplX3QgbGVuKQoreworCXN0
cnVjdCBndWRfY29ubmVjdG9yX2dldF9lZGlkX2N0eCAqY3R4ID0gZGF0YTsKKwlzaXplX3Qgc3Rh
cnQgPSBibG9jayAqIEVESURfTEVOR1RIOworCisJY3R4LT5lZGlkX292ZXJyaWRlID0gZmFsc2U7
CisKKwlpZiAoc3RhcnQgKyBsZW4gPiBjdHgtPmxlbikKKwkJcmV0dXJuIC0xOworCisJbWVtY3B5
KGJ1ZiwgY3R4LT5idWYgKyBzdGFydCwgbGVuKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGd1ZF9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGNvbm5lY3Rv
ci0+ZGV2KTsKKwlzdHJ1Y3QgZ3VkX2Rpc3BsYXlfbW9kZV9yZXEgKnJlcW1vZGVzID0gTlVMTDsK
KwlzdHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9nZXRfZWRpZF9jdHggZWRpZF9jdHg7CisJdW5zaWduZWQg
aW50IGksIG51bV9tb2RlcyA9IDA7CisJc3RydWN0IGVkaWQgKmVkaWQgPSBOVUxMOworCWludCBp
ZHgsIHJldDsKKworCWlmICghZHJtX2Rldl9lbnRlcihjb25uZWN0b3ItPmRldiwgJmlkeCkpCisJ
CXJldHVybiAwOworCisJZWRpZF9jdHguZWRpZF9vdmVycmlkZSA9IHRydWU7CisJZWRpZF9jdHgu
YnVmID0ga21hbGxvYyhHVURfQ09OTkVDVE9SX01BWF9FRElEX0xFTiwgR0ZQX0tFUk5FTCk7CisJ
aWYgKCFlZGlkX2N0eC5idWYpCisJCWdvdG8gb3V0OworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2Ry
bSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX0VESUQsIGNvbm5lY3Rvci0+aW5kZXgsCisJCQkgIGVk
aWRfY3R4LmJ1ZiwgR1VEX0NPTk5FQ1RPUl9NQVhfRURJRF9MRU4pOworCWlmIChyZXQgPiAwICYm
IHJldCAlIEVESURfTEVOR1RIKSB7CisJCWd1ZF9jb25uX2Vycihjb25uZWN0b3IsICJJbnZhbGlk
IEVESUQgc2l6ZSIsIHJldCk7CisJfSBlbHNlIGlmIChyZXQgPiAwKSB7CisJCWVkaWRfY3R4Lmxl
biA9IHJldDsKKwkJZWRpZCA9IGRybV9kb19nZXRfZWRpZChjb25uZWN0b3IsIGd1ZF9jb25uZWN0
b3JfZ2V0X2VkaWRfYmxvY2ssICZlZGlkX2N0eCk7CisJfQorCisJa2ZyZWUoZWRpZF9jdHguYnVm
KTsKKwlkcm1fY29ubmVjdG9yX3VwZGF0ZV9lZGlkX3Byb3BlcnR5KGNvbm5lY3RvciwgZWRpZCk7
CisKKwlpZiAoZWRpZCAmJiBlZGlkX2N0eC5lZGlkX292ZXJyaWRlKQorCQlnb3RvIG91dDsKKwor
CXJlcW1vZGVzID0ga21hbGxvY19hcnJheShHVURfQ09OTkVDVE9SX01BWF9OVU1fTU9ERVMsIHNp
emVvZigqcmVxbW9kZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJlcW1vZGVzKQorCQlnb3RvIG91
dDsKKworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX0NPTk5FQ1RPUl9NT0RF
UywgY29ubmVjdG9yLT5pbmRleCwKKwkJCSAgcmVxbW9kZXMsIEdVRF9DT05ORUNUT1JfTUFYX05V
TV9NT0RFUyAqIHNpemVvZigqcmVxbW9kZXMpKTsKKwlpZiAocmV0IDw9IDApCisJCWdvdG8gb3V0
OworCWlmIChyZXQgJSBzaXplb2YoKnJlcW1vZGVzKSkgeworCQlndWRfY29ubl9lcnIoY29ubmVj
dG9yLCAiSW52YWxpZCBkaXNwbGF5IG1vZGUgYXJyYXkgc2l6ZSIsIHJldCk7CisJCWdvdG8gb3V0
OworCX0KKworCW51bV9tb2RlcyA9IHJldCAvIHNpemVvZigqcmVxbW9kZXMpOworCisJZm9yIChp
ID0gMDsgaSA8IG51bV9tb2RlczsgaSsrKSB7CisJCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpt
b2RlOworCisJCW1vZGUgPSBkcm1fbW9kZV9jcmVhdGUoY29ubmVjdG9yLT5kZXYpOworCQlpZiAo
IW1vZGUpIHsKKwkJCW51bV9tb2RlcyA9IGk7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCWd1ZF90
b19kaXNwbGF5X21vZGUobW9kZSwgJnJlcW1vZGVzW2ldKTsKKwkJZHJtX21vZGVfcHJvYmVkX2Fk
ZChjb25uZWN0b3IsIG1vZGUpOworCX0KK291dDoKKwlpZiAoIW51bV9tb2RlcykKKwkJbnVtX21v
ZGVzID0gZHJtX2FkZF9lZGlkX21vZGVzKGNvbm5lY3RvciwgZWRpZCk7CisKKwlrZnJlZShyZXFt
b2Rlcyk7CisJa2ZyZWUoZWRpZCk7CisJZHJtX2Rldl9leGl0KGlkeCk7CisKKwlyZXR1cm4gbnVt
X21vZGVzOworfQorCitzdGF0aWMgaW50IGd1ZF9jb25uZWN0b3JfYXRvbWljX2NoZWNrKHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpuZXdfc3RhdGU7
CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqb2xkX3N0YXRlOworCisJbmV3X3N0YXRlID0gZHJtX2F0b21pY19nZXRf
bmV3X2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yKTsKKwlpZiAoIW5ld19zdGF0ZS0+
Y3J0YykKKwkJcmV0dXJuIDA7CisKKwlvbGRfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY29u
bmVjdG9yX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCW5ld19jcnRjX3N0YXRlID0gZHJtX2F0
b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIG5ld19zdGF0ZS0+Y3J0Yyk7CisKKwlpZiAo
b2xkX3N0YXRlLT50di5tYXJnaW5zLmxlZnQgIT0gbmV3X3N0YXRlLT50di5tYXJnaW5zLmxlZnQg
fHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLnJpZ2h0ICE9IG5ld19zdGF0ZS0+dHYubWFy
Z2lucy5yaWdodCB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMudG9wICE9IG5ld19zdGF0
ZS0+dHYubWFyZ2lucy50b3AgfHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLmJvdHRvbSAh
PSBuZXdfc3RhdGUtPnR2Lm1hcmdpbnMuYm90dG9tIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYubW9k
ZSAhPSBuZXdfc3RhdGUtPnR2Lm1vZGUgfHwKKwkgICAgb2xkX3N0YXRlLT50di5icmlnaHRuZXNz
ICE9IG5ld19zdGF0ZS0+dHYuYnJpZ2h0bmVzcyB8fAorCSAgICBvbGRfc3RhdGUtPnR2LmNvbnRy
YXN0ICE9IG5ld19zdGF0ZS0+dHYuY29udHJhc3QgfHwKKwkgICAgb2xkX3N0YXRlLT50di5mbGlj
a2VyX3JlZHVjdGlvbiAhPSBuZXdfc3RhdGUtPnR2LmZsaWNrZXJfcmVkdWN0aW9uIHx8CisJICAg
IG9sZF9zdGF0ZS0+dHYub3ZlcnNjYW4gIT0gbmV3X3N0YXRlLT50di5vdmVyc2NhbiB8fAorCSAg
ICBvbGRfc3RhdGUtPnR2LnNhdHVyYXRpb24gIT0gbmV3X3N0YXRlLT50di5zYXR1cmF0aW9uIHx8
CisJICAgIG9sZF9zdGF0ZS0+dHYuaHVlICE9IG5ld19zdGF0ZS0+dHYuaHVlKQorCQluZXdfY3J0
Y19zdGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2VkID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzIGd1ZF9jb25uZWN0
b3JfaGVscGVyX2Z1bmNzID0geworCS5kZXRlY3RfY3R4ID0gZ3VkX2Nvbm5lY3Rvcl9kZXRlY3Qs
CisJLmdldF9tb2RlcyA9IGd1ZF9jb25uZWN0b3JfZ2V0X21vZGVzLAorCS5hdG9taWNfY2hlY2sg
PSBndWRfY29ubmVjdG9yX2F0b21pY19jaGVjaywKK307CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5l
Y3Rvcl9sYXRlX3JlZ2lzdGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJ
c3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rvcihjb25uZWN0b3Ip
OworCisJaWYgKGdjb25uLT5pbml0aWFsX2JyaWdodG5lc3MgPCAwKQorCQlyZXR1cm4gMDsKKwor
CXJldHVybiBndWRfY29ubmVjdG9yX2JhY2tsaWdodF9yZWdpc3RlcihnY29ubik7Cit9CisKK3N0
YXRpYyB2b2lkIGd1ZF9jb25uZWN0b3JfZWFybHlfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubiA9IHRvX2d1
ZF9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdpc3Rlcihn
Y29ubi0+YmFja2xpZ2h0KTsKKwljYW5jZWxfd29ya19zeW5jKCZnY29ubi0+YmFja2xpZ2h0X3dv
cmspOworfQorCitzdGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX2Rlc3Ryb3koc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSB0
b19ndWRfY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwlkcm1fY29ubmVjdG9yX2NsZWFudXAoY29u
bmVjdG9yKTsKKwlrZnJlZShnY29ubi0+cHJvcGVydGllcyk7CisJa2ZyZWUoZ2Nvbm4pOworfQor
CitzdGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX3Jlc2V0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IpCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5l
Y3Rvcihjb25uZWN0b3IpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX3Jlc2V0KGNv
bm5lY3Rvcik7CisJY29ubmVjdG9yLT5zdGF0ZS0+dHYgPSBnY29ubi0+aW5pdGlhbF90dl9zdGF0
ZTsKKwkvKiBTZXQgbWFyZ2lucyBmcm9tIGNvbW1hbmQgbGluZSAqLworCWRybV9hdG9taWNfaGVs
cGVyX2Nvbm5lY3Rvcl90dl9yZXNldChjb25uZWN0b3IpOworCWlmIChnY29ubi0+aW5pdGlhbF9i
cmlnaHRuZXNzID49IDApCisJCWNvbm5lY3Rvci0+c3RhdGUtPnR2LmJyaWdodG5lc3MgPSBnY29u
bi0+aW5pdGlhbF9icmlnaHRuZXNzOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25u
ZWN0b3JfZnVuY3MgZ3VkX2Nvbm5lY3Rvcl9mdW5jcyA9IHsKKwkuZmlsbF9tb2RlcyA9IGRybV9o
ZWxwZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcywKKwkubGF0ZV9yZWdpc3RlciA9IGd1
ZF9jb25uZWN0b3JfbGF0ZV9yZWdpc3RlciwKKwkuZWFybHlfdW5yZWdpc3RlciA9IGd1ZF9jb25u
ZWN0b3JfZWFybHlfdW5yZWdpc3RlciwKKwkuZGVzdHJveSA9IGd1ZF9jb25uZWN0b3JfZGVzdHJv
eSwKKwkucmVzZXQgPSBndWRfY29ubmVjdG9yX3Jlc2V0LAorCS5hdG9taWNfZHVwbGljYXRlX3N0
YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRv
bWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZGVzdHJveV9z
dGF0ZSwKK307CisKKy8qCisgKiBUaGUgdHYubW9kZSBwcm9wZXJ0eSBpcyBzaGFyZWQgYW1vbmcg
dGhlIGNvbm5lY3RvcnMgYW5kIGl0cyBlbnVtIG5hbWVzIGFyZQorICogZHJpdmVyIHNwZWNpZmlj
LiBUaGlzIG1lYW5zIHRoYXQgaWYgbW9yZSB0aGFuIG9uZSBjb25uZWN0b3IgdXNlcyB0di5tb2Rl
LAorICogdGhlIGVudW0gbmFtZXMgaGFzIHRvIGJlIHRoZSBzYW1lLgorICovCitzdGF0aWMgaW50
IGd1ZF9jb25uZWN0b3JfYWRkX3R2X21vZGUoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc2l6ZV90IGJ1Zl9sZW4gPSBHVURfQ09O
TkVDVE9SX1RWX01PREVfTUFYX05VTSAqIEdVRF9DT05ORUNUT1JfVFZfTU9ERV9OQU1FX0xFTjsK
Kwljb25zdCBjaGFyICptb2Rlc1tHVURfQ09OTkVDVE9SX1RWX01PREVfTUFYX05VTV07CisJdW5z
aWduZWQgaW50IGksIG51bV9tb2RlczsKKwljaGFyICpidWY7CisJaW50IHJldDsKKworCWJ1ZiA9
IGttYWxsb2MoYnVmX2xlbiwgR0ZQX0tFUk5FTCk7CisJaWYgKCFidWYpCisJCXJldHVybiAtRU5P
TUVNOworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX1RW
X01PREVfVkFMVUVTLAorCQkJICBjb25uZWN0b3ItPmluZGV4LCBidWYsIGJ1Zl9sZW4pOworCWlm
IChyZXQgPCAwKQorCQlnb3RvIGZyZWU7CisJaWYgKCFyZXQgfHwgcmV0ICUgR1VEX0NPTk5FQ1RP
Ul9UVl9NT0RFX05BTUVfTEVOKSB7CisJCXJldCA9IC1FSU87CisJCWdvdG8gZnJlZTsKKwl9CisK
KwludW1fbW9kZXMgPSByZXQgLyBHVURfQ09OTkVDVE9SX1RWX01PREVfTkFNRV9MRU47CisJZm9y
IChpID0gMDsgaSA8IG51bV9tb2RlczsgaSsrKQorCQltb2Rlc1tpXSA9ICZidWZbaSAqIEdVRF9D
T05ORUNUT1JfVFZfTU9ERV9OQU1FX0xFTl07CisKKwlyZXQgPSBkcm1fbW9kZV9jcmVhdGVfdHZf
cHJvcGVydGllcyhjb25uZWN0b3ItPmRldiwgbnVtX21vZGVzLCBtb2Rlcyk7CitmcmVlOgorCWtm
cmVlKGJ1Zik7CisJaWYgKHJldCA8IDApCisJCWd1ZF9jb25uX2Vycihjb25uZWN0b3IsICJGYWls
ZWQgdG8gYWRkIFRWIG1vZGVzIiwgcmV0KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBz
dHJ1Y3QgZHJtX3Byb3BlcnR5ICoKK2d1ZF9jb25uZWN0b3JfcHJvcGVydHlfbG9va3VwKHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIHUxNiBwcm9wKQoreworCXN0cnVjdCBkcm1fbW9k
ZV9jb25maWcgKmNvbmZpZyA9ICZjb25uZWN0b3ItPmRldi0+bW9kZV9jb25maWc7CisKKwlzd2l0
Y2ggKHByb3ApIHsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTjoKKwkJcmV0dXJu
IGNvbmZpZy0+dHZfbGVmdF9tYXJnaW5fcHJvcGVydHk7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZf
UklHSFRfTUFSR0lOOgorCQlyZXR1cm4gY29uZmlnLT50dl9yaWdodF9tYXJnaW5fcHJvcGVydHk7
CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfVE9QX01BUkdJTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZf
dG9wX21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9CT1RUT01fTUFSR0lO
OgorCQlyZXR1cm4gY29uZmlnLT50dl9ib3R0b21fbWFyZ2luX3Byb3BlcnR5OworCWNhc2UgR1VE
X1BST1BFUlRZX1RWX01PREU6CisJCXJldHVybiBjb25maWctPnR2X21vZGVfcHJvcGVydHk7CisJ
Y2FzZSBHVURfUFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfYnJp
Z2h0bmVzc19wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9DT05UUkFTVDoKKwkJcmV0
dXJuIGNvbmZpZy0+dHZfY29udHJhc3RfcHJvcGVydHk7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZf
RkxJQ0tFUl9SRURVQ1RJT046CisJCXJldHVybiBjb25maWctPnR2X2ZsaWNrZXJfcmVkdWN0aW9u
X3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX09WRVJTQ0FOOgorCQlyZXR1cm4gY29u
ZmlnLT50dl9vdmVyc2Nhbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9TQVRVUkFU
SU9OOgorCQlyZXR1cm4gY29uZmlnLT50dl9zYXR1cmF0aW9uX3Byb3BlcnR5OworCWNhc2UgR1VE
X1BST1BFUlRZX1RWX0hVRToKKwkJcmV0dXJuIGNvbmZpZy0+dHZfaHVlX3Byb3BlcnR5OworCWRl
ZmF1bHQ6CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCX0KK30KKworc3RhdGljIHVuc2ln
bmVkIGludCAqZ3VkX2Nvbm5lY3Rvcl90dl9zdGF0ZV92YWwodTE2IHByb3AsIHN0cnVjdCBkcm1f
dHZfY29ubmVjdG9yX3N0YXRlICpzdGF0ZSkKK3sKKwlzd2l0Y2ggKHByb3ApIHsKKwljYXNlIEdV
RF9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFyZ2lucy5sZWZ0
OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX1JJR0hUX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+
bWFyZ2lucy5yaWdodDsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9UT1BfTUFSR0lOOgorCQlyZXR1
cm4gJnN0YXRlLT5tYXJnaW5zLnRvcDsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9CT1RUT01fTUFS
R0lOOgorCQlyZXR1cm4gJnN0YXRlLT5tYXJnaW5zLmJvdHRvbTsKKwljYXNlIEdVRF9QUk9QRVJU
WV9UVl9NT0RFOgorCQlyZXR1cm4gJnN0YXRlLT5tb2RlOworCWNhc2UgR1VEX1BST1BFUlRZX1RW
X0JSSUdIVE5FU1M6CisJCXJldHVybiAmc3RhdGUtPmJyaWdodG5lc3M7CisJY2FzZSBHVURfUFJP
UEVSVFlfVFZfQ09OVFJBU1Q6CisJCXJldHVybiAmc3RhdGUtPmNvbnRyYXN0OworCWNhc2UgR1VE
X1BST1BFUlRZX1RWX0ZMSUNLRVJfUkVEVUNUSU9OOgorCQlyZXR1cm4gJnN0YXRlLT5mbGlja2Vy
X3JlZHVjdGlvbjsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9PVkVSU0NBTjoKKwkJcmV0dXJuICZz
dGF0ZS0+b3ZlcnNjYW47CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfU0FUVVJBVElPTjoKKwkJcmV0
dXJuICZzdGF0ZS0+c2F0dXJhdGlvbjsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9IVUU6CisJCXJl
dHVybiAmc3RhdGUtPmh1ZTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsK
Kwl9Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9hZGRfcHJvcGVydGllcyhzdHJ1Y3Qg
Z3VkX2RldmljZSAqZ2RybSwgc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uKQoreworCXN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSAmZ2Nvbm4tPmNvbm5lY3RvcjsKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZHJtID0gJmdkcm0tPmRybTsKKwlzdHJ1Y3QgZ3VkX3Byb3BlcnR5X3JlcSAq
cHJvcGVydGllczsKKwl1bnNpZ25lZCBpbnQgaSwgbnVtX3Byb3BlcnRpZXM7CisJaW50IHJldDsK
KworCXByb3BlcnRpZXMgPSBrY2FsbG9jKEdVRF9DT05ORUNUT1JfUFJPUEVSVElFU19NQVhfTlVN
LCBzaXplb2YoKnByb3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXByb3BlcnRpZXMpCisJ
CXJldHVybiAtRU5PTUVNOworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRf
Q09OTkVDVE9SX1BST1BFUlRJRVMsIGNvbm5lY3Rvci0+aW5kZXgsCisJCQkgIHByb3BlcnRpZXMs
IEdVRF9DT05ORUNUT1JfUFJPUEVSVElFU19NQVhfTlVNICogc2l6ZW9mKCpwcm9wZXJ0aWVzKSk7
CisJaWYgKHJldCA8PSAwKQorCQlnb3RvIG91dDsKKwlpZiAocmV0ICUgc2l6ZW9mKCpwcm9wZXJ0
aWVzKSkgeworCQlyZXQgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9CisKKwludW1fcHJvcGVydGll
cyA9IHJldCAvIHNpemVvZigqcHJvcGVydGllcyk7CisJcmV0ID0gMDsKKworCWdjb25uLT5wcm9w
ZXJ0aWVzID0ga2NhbGxvYyhudW1fcHJvcGVydGllcywgc2l6ZW9mKCpnY29ubi0+cHJvcGVydGll
cyksIEdGUF9LRVJORUwpOworCWlmICghZ2Nvbm4tPnByb3BlcnRpZXMpIHsKKwkJcmV0ID0gLUVO
T01FTTsKKwkJZ290byBvdXQ7CisJfQorCisJZm9yIChpID0gMDsgaSA8IG51bV9wcm9wZXJ0aWVz
OyBpKyspIHsKKwkJdTE2IHByb3AgPSBsZTE2X3RvX2NwdShwcm9wZXJ0aWVzW2ldLnByb3ApOwor
CQl1NjQgdmFsID0gbGU2NF90b19jcHUocHJvcGVydGllc1tpXS52YWwpOworCQlzdHJ1Y3QgZHJt
X3Byb3BlcnR5ICpwcm9wZXJ0eTsKKwkJdW5zaWduZWQgaW50ICpzdGF0ZV92YWw7CisKKwkJZHJt
X2RiZyhkcm0sICJwcm9wZXJ0eTogJXUgPSAlbGx1KDB4JWxseClcbiIsIHByb3AsIHZhbCwgdmFs
KTsKKworCQlzd2l0Y2ggKHByb3ApIHsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfTEVGVF9NQVJH
SU46CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lO
OgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX1RPUF9NQVJHSU46CisJ
CQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfQk9UVE9NX01BUkdJTjoKKwkJ
CXJldCA9IGRybV9tb2RlX2NyZWF0ZV90dl9tYXJnaW5fcHJvcGVydGllcyhkcm0pOworCQkJaWYg
KHJldCkKKwkJCQlnb3RvIG91dDsKKwkJCWJyZWFrOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9N
T0RFOgorCQkJcmV0ID0gZ3VkX2Nvbm5lY3Rvcl9hZGRfdHZfbW9kZShnZHJtLCBjb25uZWN0b3Ip
OworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKwkJCWJyZWFrOworCQljYXNlIEdVRF9QUk9Q
RVJUWV9UVl9CUklHSFRORVNTOgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX1BST1BFUlRZ
X1RWX0NPTlRSQVNUOgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX0ZM
SUNLRVJfUkVEVUNUSU9OOgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX1BST1BFUlRZX1RW
X09WRVJTQ0FOOgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX1NBVFVS
QVRJT046CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfSFVFOgorCQkJ
LyogVGhpcyBpcyBhIG5vLW9wIGlmIGFscmVhZHkgYWRkZWQuICovCisJCQlyZXQgPSBkcm1fbW9k
ZV9jcmVhdGVfdHZfcHJvcGVydGllcyhkcm0sIDAsIE5VTEwpOworCQkJaWYgKHJldCkKKwkJCQln
b3RvIG91dDsKKwkJCWJyZWFrOworCQljYXNlIEdVRF9QUk9QRVJUWV9CQUNLTElHSFRfQlJJR0hU
TkVTUzoKKwkJCWlmICh2YWwgPiAxMDApIHsKKwkJCQlyZXQgPSAtRUlOVkFMOworCQkJCWdvdG8g
b3V0OworCQkJfQorCQkJZ2Nvbm4tPmluaXRpYWxfYnJpZ2h0bmVzcyA9IHZhbDsKKwkJCWJyZWFr
OworCQlkZWZhdWx0OgorCQkJLyogTmV3IG9uZXMgbWlnaHQgc2hvdyB1cCBpbiBmdXR1cmUgZGV2
aWNlcywgc2tpcCB0aG9zZSB3ZSBkb24ndCBrbm93LiAqLworCQkJZHJtX2RiZyhkcm0sICJJZ25v
cmluZyB1bmtub3duIHByb3BlcnR5OiAldVxuIiwgcHJvcCk7CisJCQljb250aW51ZTsKKwkJfQor
CisJCWdjb25uLT5wcm9wZXJ0aWVzW2djb25uLT5udW1fcHJvcGVydGllcysrXSA9IHByb3A7CisK
KwkJaWYgKHByb3AgPT0gR1VEX1BST1BFUlRZX0JBQ0tMSUdIVF9CUklHSFRORVNTKQorCQkJY29u
dGludWU7IC8qIG5vdCBhIERSTSBwcm9wZXJ0eSAqLworCisJCXByb3BlcnR5ID0gZ3VkX2Nvbm5l
Y3Rvcl9wcm9wZXJ0eV9sb29rdXAoY29ubmVjdG9yLCBwcm9wKTsKKwkJaWYgKFdBUk5fT04oSVNf
RVJSKHByb3BlcnR5KSkpCisJCQljb250aW51ZTsKKworCQlzdGF0ZV92YWwgPSBndWRfY29ubmVj
dG9yX3R2X3N0YXRlX3ZhbChwcm9wLCAmZ2Nvbm4tPmluaXRpYWxfdHZfc3RhdGUpOworCQlpZiAo
V0FSTl9PTihJU19FUlIoc3RhdGVfdmFsKSkpCisJCQljb250aW51ZTsKKworCQkqc3RhdGVfdmFs
ID0gdmFsOworCQlkcm1fb2JqZWN0X2F0dGFjaF9wcm9wZXJ0eSgmY29ubmVjdG9yLT5iYXNlLCBw
cm9wZXJ0eSwgMCk7CisJfQorb3V0OgorCWtmcmVlKHByb3BlcnRpZXMpOworCisJcmV0dXJuIHJl
dDsKK30KKworaW50IGd1ZF9jb25uZWN0b3JfZmlsbF9wcm9wZXJ0aWVzKHN0cnVjdCBkcm1fY29u
bmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGUsCisJCQkJICBzdHJ1Y3QgZ3VkX3Byb3BlcnR5
X3JlcSAqcHJvcGVydGllcykKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSB0b19n
dWRfY29ubmVjdG9yKGNvbm5lY3Rvcl9zdGF0ZS0+Y29ubmVjdG9yKTsKKwl1bnNpZ25lZCBpbnQg
aTsKKworCWZvciAoaSA9IDA7IGkgPCBnY29ubi0+bnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1
MTYgcHJvcCA9IGdjb25uLT5wcm9wZXJ0aWVzW2ldOworCQl1NjQgdmFsOworCisJCWlmIChwcm9w
ID09IEdVRF9QUk9QRVJUWV9CQUNLTElHSFRfQlJJR0hUTkVTUykgeworCQkJdmFsID0gY29ubmVj
dG9yX3N0YXRlLT50di5icmlnaHRuZXNzOworCQl9IGVsc2UgeworCQkJdW5zaWduZWQgaW50ICpz
dGF0ZV92YWw7CisKKwkJCXN0YXRlX3ZhbCA9IGd1ZF9jb25uZWN0b3JfdHZfc3RhdGVfdmFsKHBy
b3AsICZjb25uZWN0b3Jfc3RhdGUtPnR2KTsKKwkJCWlmIChXQVJOX09OX09OQ0UoSVNfRVJSKHN0
YXRlX3ZhbCkpKQorCQkJCXJldHVybiBQVFJfRVJSKHN0YXRlX3ZhbCk7CisKKwkJCXZhbCA9ICpz
dGF0ZV92YWw7CisJCX0KKworCQlwcm9wZXJ0aWVzW2ldLnByb3AgPSBjcHVfdG9fbGUxNihwcm9w
KTsKKwkJcHJvcGVydGllc1tpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOworCX0KKworCXJldHVy
biBnY29ubi0+bnVtX3Byb3BlcnRpZXM7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9j
cmVhdGUoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHVuc2lnbmVkIGludCBpbmRleCwKKwkJCQlz
dHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9kZXNjcmlwdG9yX3JlcSAqZGVzYykKK3sKKwlzdHJ1Y3QgZHJt
X2RldmljZSAqZHJtID0gJmdkcm0tPmRybTsKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm47
CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIg
KmVuY29kZXI7CisJaW50IHJldCwgY29ubmVjdG9yX3R5cGU7CisJdTMyIGZsYWdzOworCisJZ2Nv
bm4gPSBremFsbG9jKHNpemVvZigqZ2Nvbm4pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uKQor
CQlyZXR1cm4gLUVOT01FTTsKKworCUlOSVRfV09SSygmZ2Nvbm4tPmJhY2tsaWdodF93b3JrLCBn
dWRfY29ubmVjdG9yX2JhY2tsaWdodF91cGRhdGVfc3RhdHVzX3dvcmspOworCWdjb25uLT5pbml0
aWFsX2JyaWdodG5lc3MgPSAtRU5PREVWOworCWZsYWdzID0gbGUzMl90b19jcHUoZGVzYy0+Zmxh
Z3MpOworCWNvbm5lY3RvciA9ICZnY29ubi0+Y29ubmVjdG9yOworCisJZHJtX2RiZyhkcm0sICJD
b25uZWN0b3I6IGluZGV4PSV1IHR5cGU9JXUgZmxhZ3M9MHgleFxuIiwgaW5kZXgsIGRlc2MtPmNv
bm5lY3Rvcl90eXBlLCBmbGFncyk7CisKKwlzd2l0Y2ggKGRlc2MtPmNvbm5lY3Rvcl90eXBlKSB7
CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVfUEFORUw6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJN
X01PREVfQ09OTkVDVE9SX1VTQjsKKwkJYnJlYWs7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVf
VkdBOgorCQljb25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9WR0E7CisJCWJyZWFr
OworCWNhc2UgR1VEX0NPTk5FQ1RPUl9UWVBFX0RWSToKKwkJY29ubmVjdG9yX3R5cGUgPSBEUk1f
TU9ERV9DT05ORUNUT1JfRFZJRDsKKwkJYnJlYWs7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVf
Q09NUE9TSVRFOgorCQljb25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9Db21wb3Np
dGU7CisJCWJyZWFrOworCWNhc2UgR1VEX0NPTk5FQ1RPUl9UWVBFX1NWSURFTzoKKwkJY29ubmVj
dG9yX3R5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1JfU1ZJREVPOworCQlicmVhazsKKwljYXNlIEdV
RF9DT05ORUNUT1JfVFlQRV9DT01QT05FTlQ6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVf
Q09OTkVDVE9SX0NvbXBvbmVudDsKKwkJYnJlYWs7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVf
RElTUExBWVBPUlQ6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0Rpc3Bs
YXlQb3J0OworCQlicmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1JfVFlQRV9IRE1JOgorCQljb25u
ZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQTsKKwkJYnJlYWs7CisJZGVmYXVs
dDogLyogZnV0dXJlIHR5cGVzICovCisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVD
VE9SX1VTQjsKKwkJYnJlYWs7CisJfTsKKworCWRybV9jb25uZWN0b3JfaGVscGVyX2FkZChjb25u
ZWN0b3IsICZndWRfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyk7CisJcmV0ID0gZHJtX2Nvbm5lY3Rv
cl9pbml0KGRybSwgY29ubmVjdG9yLCAmZ3VkX2Nvbm5lY3Rvcl9mdW5jcywgY29ubmVjdG9yX3R5
cGUpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUoY29ubmVjdG9yKTsKKwkJcmV0dXJuIHJldDsKKwl9
CisKKwlpZiAoV0FSTl9PTihjb25uZWN0b3ItPmluZGV4ICE9IGluZGV4KSkKKwkJcmV0dXJuIC1F
SU5WQUw7CisKKwlpZiAoZmxhZ3MgJiBHVURfQ09OTkVDVE9SX0ZMQUdTX1BPTExfU1RBVFVTKQor
CQljb25uZWN0b3ItPnBvbGxlZCA9IChEUk1fQ09OTkVDVE9SX1BPTExfQ09OTkVDVCB8IERSTV9D
T05ORUNUT1JfUE9MTF9ESVNDT05ORUNUKTsKKwlpZiAoZmxhZ3MgJiBHVURfQ09OTkVDVE9SX0ZM
QUdTX0lOVEVSTEFDRSkKKwkJY29ubmVjdG9yLT5pbnRlcmxhY2VfYWxsb3dlZCA9IHRydWU7CisJ
aWYgKGZsYWdzICYgR1VEX0NPTk5FQ1RPUl9GTEFHU19ET1VCTEVTQ0FOKQorCQljb25uZWN0b3It
PmRvdWJsZXNjYW5fYWxsb3dlZCA9IHRydWU7CisKKwlyZXQgPSBndWRfY29ubmVjdG9yX2FkZF9w
cm9wZXJ0aWVzKGdkcm0sIGdjb25uKTsKKwlpZiAocmV0KSB7CisJCWd1ZF9jb25uX2Vycihjb25u
ZWN0b3IsICJGYWlsZWQgdG8gYWRkIHByb3BlcnRpZXMiLCByZXQpOworCQlyZXR1cm4gcmV0Owor
CX0KKworCS8qIFRoZSBmaXJzdCBjb25uZWN0b3IgaXMgYXR0YWNoZWQgdG8gdGhlIGV4aXN0aW5n
IHNpbXBsZSBwaXBlIGVuY29kZXIgKi8KKwlpZiAoIWNvbm5lY3Rvci0+aW5kZXgpIHsKKwkJZW5j
b2RlciA9ICZnZHJtLT5waXBlLmVuY29kZXI7CisJfSBlbHNlIHsKKwkJZW5jb2RlciA9ICZnY29u
bi0+ZW5jb2RlcjsKKworCQlyZXQgPSBkcm1fc2ltcGxlX2VuY29kZXJfaW5pdChkcm0sIGVuY29k
ZXIsIERSTV9NT0RFX0VOQ09ERVJfTk9ORSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0Owor
CisJCWVuY29kZXItPnBvc3NpYmxlX2NydGNzID0gMTsKKwl9CisKKwlyZXR1cm4gZHJtX2Nvbm5l
Y3Rvcl9hdHRhY2hfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIpOworfQorCitpbnQgZ3VkX2dl
dF9jb25uZWN0b3JzKHN0cnVjdCBndWRfZGV2aWNlICpnZHJtKQoreworCXN0cnVjdCBndWRfY29u
bmVjdG9yX2Rlc2NyaXB0b3JfcmVxICpkZXNjczsKKwl1bnNpZ25lZCBpbnQgaSwgbnVtX2Nvbm5l
Y3RvcnM7CisJaW50IHJldDsKKworCWRlc2NzID0ga21hbGxvY19hcnJheShHVURfQ09OTkVDVE9S
U19NQVhfTlVNLCBzaXplb2YoKmRlc2NzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZXNjcykKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2dldChnZHJtLCBHVURfUkVRX0dFVF9D
T05ORUNUT1JTLCAwLAorCQkJICBkZXNjcywgR1VEX0NPTk5FQ1RPUlNfTUFYX05VTSAqIHNpemVv
ZihkZXNjcykpOworCWlmIChyZXQgPCAwKQorCQlnb3RvIGZyZWU7CisJaWYgKCFyZXQgfHwgcmV0
ICUgc2l6ZW9mKCpkZXNjcykpIHsKKwkJcmV0ID0gLUVJTzsKKwkJZ290byBmcmVlOworCX0KKwor
CW51bV9jb25uZWN0b3JzID0gcmV0IC8gc2l6ZW9mKCpkZXNjcyk7CisKKwlmb3IgKGkgPSAwOyBp
IDwgbnVtX2Nvbm5lY3RvcnM7IGkrKykgeworCQlyZXQgPSBndWRfY29ubmVjdG9yX2NyZWF0ZShn
ZHJtLCBpLCAmZGVzY3NbaV0pOworCQlpZiAocmV0KQorCQkJZ290byBmcmVlOworCX0KK2ZyZWU6
CisJa2ZyZWUoZGVzY3MpOworCisJcmV0dXJuIHJldDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9ndWQvZ3VkX2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJ2LmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4yZTMwNTZlNGQyNzEKLS0tIC9k
ZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcnYuYwpAQCAtMCwwICsxLDY1
OSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCAy
MDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+Cisj
aW5jbHVkZSA8bGludXgvZG1hLW1hcHBpbmcuaD4KKyNpbmNsdWRlIDxsaW51eC9sejQuaD4KKyNp
bmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9zdHJpbmdfaGVscGVycy5oPgorI2luY2x1ZGUgPGxpbnV4L3Vz
Yi5oPgorI2luY2x1ZGUgPGxpbnV4L3ZtYWxsb2MuaD4KKyNpbmNsdWRlIDxsaW51eC93b3JrcXVl
dWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fZGFtYWdlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGVidWdmcy5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2F0b21pY19o
ZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9oZWxwZXIuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21h
bmFnZWQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9w
cm9iZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmg+Cisj
aW5jbHVkZSA8ZHJtL2d1ZC5oPgorCisjaW5jbHVkZSAiZ3VkX2ludGVybmFsLmgiCisKKy8qIE9u
bHkgdXNlZCBpbnRlcm5hbGx5ICovCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5m
byBndWRfZHJtX2Zvcm1hdF9yMSA9IHsKKwkuZm9ybWF0ID0gR1VEX0RSTV9GT1JNQVRfUjEsCisJ
Lm51bV9wbGFuZXMgPSAxLAorCS5jaGFyX3Blcl9ibG9jayA9IHsgMSwgMCwgMCB9LAorCS5ibG9j
a193ID0geyA4LCAwLCAwIH0sCisJLmJsb2NrX2ggPSB7IDEsIDAsIDAgfSwKKwkuaHN1YiA9IDEs
CisJLnZzdWIgPSAxLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8g
Z3VkX2RybV9mb3JtYXRfcmdiMTExID0geworCS5mb3JtYXQgPSBHVURfRFJNX0ZPUk1BVF9SR0Ix
MTEsCisJLm51bV9wbGFuZXMgPSAxLAorCS5jaGFyX3Blcl9ibG9jayA9IHsgMSwgMCwgMCB9LAor
CS5ibG9ja193ID0geyAyLCAwLCAwIH0sCisJLmJsb2NrX2ggPSB7IDEsIDAsIDAgfSwKKwkuaHN1
YiA9IDEsCisJLnZzdWIgPSAxLAorfTsKKworc3RhdGljIGludCBndWRfdXNiX2NvbnRyb2xfbXNn
KHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRmLCBib29sIGluLAorCQkJICAgICAgIHU4IHJlcXVl
c3QsIHUxNiB2YWx1ZSwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQoreworCXU4IHJlcXVlc3R0eXBl
ID0gVVNCX1RZUEVfVkVORE9SIHwgVVNCX1JFQ0lQX0lOVEVSRkFDRTsKKwl1OCBpZm51bSA9IGlu
dGYtPmN1cl9hbHRzZXR0aW5nLT5kZXNjLmJJbnRlcmZhY2VOdW1iZXI7CisJc3RydWN0IHVzYl9k
ZXZpY2UgKnVzYiA9IGludGVyZmFjZV90b191c2JkZXYoaW50Zik7CisJdW5zaWduZWQgaW50IHBp
cGU7CisKKwlpZiAobGVuICYmICFidWYpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGluKSB7
CisJCXBpcGUgPSB1c2JfcmN2Y3RybHBpcGUodXNiLCAwKTsKKwkJcmVxdWVzdHR5cGUgfD0gVVNC
X0RJUl9JTjsKKwl9IGVsc2UgeworCQlwaXBlID0gdXNiX3NuZGN0cmxwaXBlKHVzYiwgMCk7CisJ
CXJlcXVlc3R0eXBlIHw9IFVTQl9ESVJfT1VUOworCX0KKworCXJldHVybiB1c2JfY29udHJvbF9t
c2codXNiLCBwaXBlLCByZXF1ZXN0LCByZXF1ZXN0dHlwZSwgdmFsdWUsCisJCQkgICAgICAgaWZu
dW0sIGJ1ZiwgbGVuLCBVU0JfQ1RSTF9HRVRfVElNRU9VVCk7Cit9CisKK3N0YXRpYyBpbnQgZ3Vk
X2dldF9kaXNwbGF5X2Rlc2NyaXB0b3Ioc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGYsCisJCQkJ
ICAgICAgc3RydWN0IGd1ZF9kaXNwbGF5X2Rlc2NyaXB0b3JfcmVxICpkZXNjKQoreworCXZvaWQg
KmJ1ZjsKKwlpbnQgcmV0OworCisJYnVmID0ga21hbGxvYyhzaXplb2YoKmRlc2MpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIWJ1ZikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2Nv
bnRyb2xfbXNnKGludGYsIHRydWUsIEdVRF9SRVFfR0VUX0RFU0NSSVBUT1IsIDAsIGJ1Ziwgc2l6
ZW9mKCpkZXNjKSk7CisJbWVtY3B5KGRlc2MsIGJ1Ziwgc2l6ZW9mKCpkZXNjKSk7CisJa2ZyZWUo
YnVmKTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKwlpZiAocmV0ICE9IHNpemVvZigq
ZGVzYykpCisJCXJldHVybiAtRUlPOworCisJaWYgKGRlc2MtPm1hZ2ljICE9IGxlMzJfdG9fY3B1
KEdVRF9ESVNQTEFZX01BR0lDKSkKKwkJcmV0dXJuIC1FTk9EQVRBOworCisJRFJNX0RFVl9ERUJV
R19EUklWRVIoJmludGYtPmRldiwKKwkJCSAgICAgInZlcnNpb249JXUgZmxhZ3M9MHgleCBjb21w
cmVzc2lvbj0weCV4IG1heF9idWZmZXJfc2l6ZT0ldVxuIiwKKwkJCSAgICAgZGVzYy0+dmVyc2lv
biwgbGUzMl90b19jcHUoZGVzYy0+ZmxhZ3MpLCBkZXNjLT5jb21wcmVzc2lvbiwKKwkJCSAgICAg
bGUzMl90b19jcHUoZGVzYy0+bWF4X2J1ZmZlcl9zaXplKSk7CisKKwlpZiAoIWRlc2MtPnZlcnNp
b24gfHwgIWRlc2MtPm1heF93aWR0aCB8fCAhZGVzYy0+bWF4X2hlaWdodCB8fAorCSAgICBsZTMy
X3RvX2NwdShkZXNjLT5taW5fd2lkdGgpID4gbGUzMl90b19jcHUoZGVzYy0+bWF4X3dpZHRoKSB8
fAorCSAgICBsZTMyX3RvX2NwdShkZXNjLT5taW5faGVpZ2h0KSA+IGxlMzJfdG9fY3B1KGRlc2Mt
Pm1heF9oZWlnaHQpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGd1ZF9zdGF0dXNfdG9fZXJybm8odTggc3RhdHVzKQoreworCXN3aXRjaCAoc3RhdHVz
KSB7CisJY2FzZSBHVURfU1RBVFVTX09LOgorCQlyZXR1cm4gMDsKKwljYXNlIEdVRF9TVEFUVVNf
QlVTWToKKwkJcmV0dXJuIC1FQlVTWTsKKwljYXNlIEdVRF9TVEFUVVNfUkVRVUVTVF9OT1RfU1VQ
UE9SVEVEOgorCQlyZXR1cm4gLUVPUE5PVFNVUFA7CisJY2FzZSBHVURfU1RBVFVTX1BST1RPQ09M
X0VSUk9SOgorCQlyZXR1cm4gLUVQUk9UTzsKKwljYXNlIEdVRF9TVEFUVVNfSU5WQUxJRF9QQVJB
TUVURVI6CisJCXJldHVybiAtRUlOVkFMOworCWNhc2UgR1VEX1NUQVRVU19FUlJPUjoKKwkJcmV0
dXJuIC1FUkVNT1RFSU87CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FUkVNT1RFSU87CisJfQorfQor
CitzdGF0aWMgaW50IGd1ZF91c2JfZ2V0X3N0YXR1cyhzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50
ZikKK3sKKwlpbnQgcmV0LCBzdGF0dXMgPSAtRUlPOworCXU4ICpidWY7CisKKwlidWYgPSBrbWFs
bG9jKHNpemVvZigqYnVmKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFidWYpCisJCXJldHVybiAtRU5P
TUVNOworCisJcmV0ID0gZ3VkX3VzYl9jb250cm9sX21zZyhpbnRmLCB0cnVlLCBHVURfUkVRX0dF
VF9TVEFUVVMsIDAsIGJ1Ziwgc2l6ZW9mKCpidWYpKTsKKwlpZiAocmV0ID09IHNpemVvZigqYnVm
KSkKKwkJc3RhdHVzID0gZ3VkX3N0YXR1c190b19lcnJubygqYnVmKTsKKwlrZnJlZShidWYpOwor
CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlyZXR1cm4gc3RhdHVzOworfQorCitz
dGF0aWMgaW50IGd1ZF91c2JfdHJhbnNmZXIoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIGJvb2wg
aW4sIHU4IHJlcXVlc3QsIHUxNiBpbmRleCwKKwkJCSAgICB2b2lkICpidWYsIHNpemVfdCBsZW4p
Cit7CisJc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGYgPSB0b191c2JfaW50ZXJmYWNlKGdkcm0t
PmRybS5kZXYpOworCWludCBpZHgsIHJldDsKKworCWRybV9kYmcoJmdkcm0tPmRybSwgIiVzOiBy
ZXF1ZXN0PTB4JXggaW5kZXg9JXUgbGVuPSV6dVxuIiwKKwkJaW4gPyAiZ2V0IiA6ICJzZXQiLCBy
ZXF1ZXN0LCBpbmRleCwgbGVuKTsKKworCWlmICghZHJtX2Rldl9lbnRlcigmZ2RybS0+ZHJtLCAm
aWR4KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwltdXRleF9sb2NrKCZnZHJtLT5jdHJsX2xvY2sp
OworCisJcmV0ID0gZ3VkX3VzYl9jb250cm9sX21zZyhpbnRmLCBpbiwgcmVxdWVzdCwgaW5kZXgs
IGJ1ZiwgbGVuKTsKKwlpZiAocmV0ID09IC1FUElQRSB8fCAoKGdkcm0tPmZsYWdzICYgR1VEX0RJ
U1BMQVlfRkxBR19TVEFUVVNfT05fU0VUKSAmJiAhaW4gJiYgcmV0ID49IDApKSB7CisJCWludCBz
dGF0dXM7CisKKwkJc3RhdHVzID0gZ3VkX3VzYl9nZXRfc3RhdHVzKGludGYpOworCQlpZiAoc3Rh
dHVzIDwgMCkgeworCQkJcmV0ID0gc3RhdHVzOworCQl9IGVsc2UgaWYgKHJldCA8IDApIHsKKwkJ
CWRldl9lcnJfb25jZShnZHJtLT5kcm0uZGV2LAorCQkJCSAgICAgIlVuZXhwZWN0ZWQgc3RhdHVz
IE9LIGZvciBmYWlsZWQgdHJhbnNmZXJcbiIpOworCQkJcmV0ID0gLUVQSVBFOworCQl9CisJfQor
CisJaWYgKHJldCA8IDApIHsKKwkJZHJtX2RiZygmZ2RybS0+ZHJtLCAicmV0PSVkXG4iLCByZXQp
OworCQlnZHJtLT5zdGF0c19udW1fZXJyb3JzKys7CisJfQorCisJbXV0ZXhfdW5sb2NrKCZnZHJt
LT5jdHJsX2xvY2spOworCWRybV9kZXZfZXhpdChpZHgpOworCisJcmV0dXJuIHJldDsKK30KKwor
LyoKKyAqIEBidWYgY2Fubm90IGJlIGFsbG9jYXRlZCBvbiB0aGUgc3RhY2suCisgKiBSZXR1cm5z
IG51bWJlciBvZiBieXRlcyByZWNlaXZlZCBvciBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1
cmUuCisgKi8KK2ludCBndWRfdXNiX2dldChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTggcmVx
dWVzdCwgdTE2IGluZGV4LCB2b2lkICpidWYsIHNpemVfdCBtYXhfbGVuKQoreworCXJldHVybiBn
dWRfdXNiX3RyYW5zZmVyKGdkcm0sIHRydWUsIHJlcXVlc3QsIGluZGV4LCBidWYsIG1heF9sZW4p
OworfQorCisvKgorICogQGJ1ZiBjYW4gYmUgYWxsb2NhdGVkIG9uIHRoZSBzdGFjayBvciBOVUxM
LgorICogUmV0dXJucyB6ZXJvIG9uIHN1Y2Nlc3Mgb3IgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBm
YWlsdXJlLgorICovCitpbnQgZ3VkX3VzYl9zZXQoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHU4
IHJlcXVlc3QsIHUxNiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQoreworCXZvaWQgKnRy
YnVmID0gTlVMTDsKKwlpbnQgcmV0OworCisJaWYgKGJ1ZiAmJiBsZW4pIHsKKwkJdHJidWYgPSBr
bWVtZHVwKGJ1ZiwgbGVuLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCF0cmJ1ZikKKwkJCXJldHVybiAt
RU5PTUVNOworCX0KKworCXJldCA9IGd1ZF91c2JfdHJhbnNmZXIoZ2RybSwgZmFsc2UsIHJlcXVl
c3QsIGluZGV4LCB0cmJ1ZiwgbGVuKTsKKwlrZnJlZSh0cmJ1Zik7CisJaWYgKHJldCA8IDApCisJ
CXJldHVybiByZXQ7CisKKwlyZXR1cm4gcmV0ICE9IGxlbiA/IC1FSU8gOiAwOworfQorCisvKgor
ICogQHZhbCBjYW4gYmUgYWxsb2NhdGVkIG9uIHRoZSBzdGFjay4KKyAqIFJldHVybnMgemVybyBv
biBzdWNjZXNzIG9yIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KKyAqLworaW50IGd1
ZF91c2JfZ2V0X3U4KHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1MTYgaW5k
ZXgsIHU4ICp2YWwpCit7CisJdTggKmJ1ZjsKKwlpbnQgcmV0OworCisJYnVmID0ga21hbGxvYyhz
aXplb2YoKnZhbCksIEdGUF9LRVJORUwpOworCWlmICghYnVmKQorCQlyZXR1cm4gLUVOT01FTTsK
KworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIHJlcXVlc3QsIGluZGV4LCBidWYsIHNpemVvZigq
dmFsKSk7CisJKnZhbCA9ICpidWY7CisJa2ZyZWUoYnVmKTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0
dXJuIHJldDsKKworCXJldHVybiByZXQgIT0gc2l6ZW9mKCp2YWwpID8gLUVJTyA6IDA7Cit9CisK
Ky8qIFJldHVybnMgemVybyBvbiBzdWNjZXNzIG9yIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFp
bHVyZS4gKi8KK2ludCBndWRfdXNiX3NldF91OChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTgg
cmVxdWVzdCwgdTggdmFsKQoreworCXJldHVybiBndWRfdXNiX3NldChnZHJtLCByZXF1ZXN0LCAw
LCAmdmFsLCBzaXplb2YodmFsKSk7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2dldF9wcm9wZXJ0aWVz
KHN0cnVjdCBndWRfZGV2aWNlICpnZHJtKQoreworCXN0cnVjdCBndWRfcHJvcGVydHlfcmVxICpw
cm9wZXJ0aWVzOworCXVuc2lnbmVkIGludCBpLCBudW1fcHJvcGVydGllczsKKwlpbnQgcmV0Owor
CisJcHJvcGVydGllcyA9IGtjYWxsb2MoR1VEX1BST1BFUlRJRVNfTUFYX05VTSwgc2l6ZW9mKCpw
cm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9wZXJ0aWVzKQorCQlyZXR1cm4gLUVO
T01FTTsKKworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX1BST1BFUlRJRVMs
IDAsCisJCQkgIHByb3BlcnRpZXMsIEdVRF9QUk9QRVJUSUVTX01BWF9OVU0gKiBzaXplb2YoKnBy
b3BlcnRpZXMpKTsKKwlpZiAocmV0IDw9IDApCisJCWdvdG8gb3V0OworCWlmIChyZXQgJSBzaXpl
b2YoKnByb3BlcnRpZXMpKSB7CisJCXJldCA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCW51
bV9wcm9wZXJ0aWVzID0gcmV0IC8gc2l6ZW9mKCpwcm9wZXJ0aWVzKTsKKworCWdkcm0tPnByb3Bl
cnRpZXMgPSBkcm1tX2tjYWxsb2MoJmdkcm0tPmRybSwgbnVtX3Byb3BlcnRpZXMsIHNpemVvZigq
Z2RybS0+cHJvcGVydGllcyksCisJCQkJCUdGUF9LRVJORUwpOworCWlmICghZ2RybS0+cHJvcGVy
dGllcykgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIG91dDsKKwl9CisKKwlmb3IgKGkgPSAw
OyBpIDwgbnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJvcCA9IGxlMTZfdG9fY3B1KHBy
b3BlcnRpZXNbaV0ucHJvcCk7CisJCXU2NCB2YWwgPSBsZTY0X3RvX2NwdShwcm9wZXJ0aWVzW2ld
LnZhbCk7CisKKwkJc3dpdGNoIChwcm9wKSB7CisJCWNhc2UgR1VEX1BST1BFUlRZX1JPVEFUSU9O
OgorCQkJLyoKKwkJCSAqIERSTSBVQVBJIG1hdGNoZXMgdGhlIHByb3RvY29sIHNvIHVzZSB0aGUg
dmFsdWUgZGlyZWN0bHksCisJCQkgKiBidXQgbWFzayBvdXQgYW55IGFkZGl0aW9ucyBvbiBmdXR1
cmUgZGV2aWNlcy4KKwkJCSAqLworCQkJdmFsICY9IEdVRF9ST1RBVElPTl9NQVNLOworCQkJcmV0
ID0gZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgmZ2RybS0+cGlwZS5wbGFuZSwK
KwkJCQkJCQkJIERSTV9NT0RFX1JPVEFURV8wLCB2YWwpOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6
CisJCQkvKiBOZXcgb25lcyBtaWdodCBzaG93IHVwIGluIGZ1dHVyZSBkZXZpY2VzLCBza2lwIHRo
b3NlIHdlIGRvbid0IGtub3cuICovCisJCQlkcm1fZGJnKCZnZHJtLT5kcm0sICJJZ25vcmluZyB1
bmtub3duIHByb3BlcnR5OiAldVxuIiwgcHJvcCk7CisJCQljb250aW51ZTsKKwkJfQorCisJCWlm
IChyZXQpCisJCQlnb3RvIG91dDsKKworCQlnZHJtLT5wcm9wZXJ0aWVzW2dkcm0tPm51bV9wcm9w
ZXJ0aWVzKytdID0gcHJvcDsKKwl9CitvdXQ6CisJa2ZyZWUocHJvcGVydGllcyk7CisKKwlyZXR1
cm4gcmV0OworfQorCisvKgorICogRklYTUU6IERtYS1idWYgc2hhcmluZyByZXF1aXJlcyBETUEg
c3VwcG9ydCBieSB0aGUgaW1wb3J0aW5nIGRldmljZS4KKyAqICAgICAgICBUaGlzIGZ1bmN0aW9u
IGlzIGEgd29ya2Fyb3VuZCB0byBtYWtlIFVTQiBkZXZpY2VzIHdvcmsgYXMgd2VsbC4KKyAqICAg
ICAgICBTZWUgdG9kby5yc3QgZm9yIGhvdyB0byBmaXggdGhlIGlzc3VlIGluIHRoZSBkbWEtYnVm
IGZyYW1ld29yay4KKyAqLworc3RhdGljIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ3VkX2dlbV9w
cmltZV9pbXBvcnQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwgc3RydWN0IGRtYV9idWYgKmRtYV9i
dWYpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGRybSk7CisK
KwlpZiAoIWdkcm0tPmRtYWRldikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT0RFVik7CisKKwlyZXR1
cm4gZHJtX2dlbV9wcmltZV9pbXBvcnRfZGV2KGRybSwgZG1hX2J1ZiwgZ2RybS0+ZG1hZGV2KTsK
K30KKworc3RhdGljIGludCBndWRfc3RhdHNfZGVidWdmcyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKmRhdGEpCit7CisJc3RydWN0IGRybV9pbmZvX25vZGUgKm5vZGUgPSBtLT5wcml2YXRlOwor
CXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RldmljZShub2RlLT5taW5vci0+ZGV2
KTsKKwljaGFyIGJ1ZlsxMF07CisKKwlzdHJpbmdfZ2V0X3NpemUoZ2RybS0+YnVsa19sZW4sIDEs
IFNUUklOR19VTklUU18yLCBidWYsIHNpemVvZihidWYpKTsKKwlzZXFfcHJpbnRmKG0sICJNYXgg
YnVmZmVyIHNpemU6ICVzXG4iLCBidWYpOworCXNlcV9wcmludGYobSwgIk51bWJlciBvZiBlcnJv
cnM6ICAldVxuIiwgZ2RybS0+c3RhdHNfbnVtX2Vycm9ycyk7CisKKwlzZXFfcHV0cyhtLCAiQ29t
cHJlc3Npb246ICAgICAgIik7CisJaWYgKGdkcm0tPmNvbXByZXNzaW9uICYgR1VEX0NPTVBSRVNT
SU9OX0xaNCkKKwkJc2VxX3B1dHMobSwgIiBsejQiKTsKKwlpZiAoIWdkcm0tPmNvbXByZXNzaW9u
KQorCQlzZXFfcHV0cyhtLCAiIG5vbmUiKTsKKwlzZXFfcHV0cyhtLCAiXG4iKTsKKworCWlmIChn
ZHJtLT5jb21wcmVzc2lvbikgeworCQl1NjQgcmVtYWluZGVyOworCQl1NjQgcmF0aW8gPSBkaXY2
NF91NjRfcmVtKGdkcm0tPnN0YXRzX2xlbmd0aCwgZ2RybS0+c3RhdHNfYWN0dWFsX2xlbmd0aCwK
KwkJCQkJICAmcmVtYWluZGVyKTsKKwkJdTY0IHJhdGlvX2ZyYWMgPSBkaXY2NF91NjQocmVtYWlu
ZGVyICogMTAsIGdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGgpOworCisJCXNlcV9wcmludGYobSwg
IkNvbXByZXNzaW9uIHJhdGlvOiAlbGx1LiVsbHVcbiIsIHJhdGlvLCByYXRpb19mcmFjKTsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1faW5mb19saXN0IGd1
ZF9kZWJ1Z2ZzX2xpc3RbXSA9IHsKKwl7ICJzdGF0cyIsIGd1ZF9zdGF0c19kZWJ1Z2ZzLCAwLCBO
VUxMIH0sCit9OworCitzdGF0aWMgdm9pZCBndWRfZGVidWdmc19pbml0KHN0cnVjdCBkcm1fbWlu
b3IgKm1pbm9yKQoreworCWRybV9kZWJ1Z2ZzX2NyZWF0ZV9maWxlcyhndWRfZGVidWdmc19saXN0
LCBBUlJBWV9TSVpFKGd1ZF9kZWJ1Z2ZzX2xpc3QpLAorCQkJCSBtaW5vci0+ZGVidWdmc19yb290
LCBtaW5vcik7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3Bp
cGVfZnVuY3MgZ3VkX3BpcGVfZnVuY3MgPSB7CisJLmNoZWNrICAgICAgPSBndWRfcGlwZV9jaGVj
aywKKwkudXBkYXRlCSAgICA9IGd1ZF9waXBlX3VwZGF0ZSwKKwkucHJlcGFyZV9mYiA9IGRybV9n
ZW1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9wcmVwYXJlX2ZiLAorfTsKKworc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fbW9kZV9jb25maWdfZnVuY3MgZ3VkX21vZGVfY29uZmlnX2Z1bmNzID0geworCS5m
Yl9jcmVhdGUgPSBkcm1fZ2VtX2ZiX2NyZWF0ZV93aXRoX2RpcnR5LAorCS5hdG9taWNfY2hlY2sg
PSBkcm1fYXRvbWljX2hlbHBlcl9jaGVjaywKKwkuYXRvbWljX2NvbW1pdCA9IGRybV9hdG9taWNf
aGVscGVyX2NvbW1pdCwKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ3VkX3BpcGVfbW9kaWZpZXJz
W10gPSB7CisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQK
K307CisKK0RFRklORV9EUk1fR0VNX0ZPUFMoZ3VkX2ZvcHMpOworCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRybV9kcml2ZXIgZ3VkX2RybV9kcml2ZXIgPSB7CisJLmRyaXZlcl9mZWF0dXJlcwk9IERS
SVZFUl9NT0RFU0VUIHwgRFJJVkVSX0dFTSB8IERSSVZFUl9BVE9NSUMsCisJLmZvcHMJCQk9ICZn
dWRfZm9wcywKKwlEUk1fR0VNX1NITUVNX0RSSVZFUl9PUFMsCisJLmdlbV9wcmltZV9pbXBvcnQJ
PSBndWRfZ2VtX3ByaW1lX2ltcG9ydCwKKwkuZGVidWdmc19pbml0CQk9IGd1ZF9kZWJ1Z2ZzX2lu
aXQsCisKKwkubmFtZQkJCT0gImd1ZCIsCisJLmRlc2MJCQk9ICJHZW5lcmljIFVTQiBEaXNwbGF5
IiwKKwkuZGF0ZQkJCT0gIjIwMjAwNDIyIiwKKwkubWFqb3IJCQk9IDEsCisJLm1pbm9yCQkJPSAw
LAorfTsKKworc3RhdGljIHZvaWQgZ3VkX2ZyZWVfYnVmZmVyc19hbmRfbXV0ZXgoc3RydWN0IGRy
bV9kZXZpY2UgKmRybSwgdm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJt
ID0gdG9fZ3VkX2RldmljZShkcm0pOworCisJdmZyZWUoZ2RybS0+Y29tcHJlc3NfYnVmKTsKKwlr
ZnJlZShnZHJtLT5idWxrX2J1Zik7CisJbXV0ZXhfZGVzdHJveSgmZ2RybS0+Y3RybF9sb2NrKTsK
KwltdXRleF9kZXN0cm95KCZnZHJtLT5kYW1hZ2VfbG9jayk7Cit9CisKK3N0YXRpYyBpbnQgZ3Vk
X3Byb2JlKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRmLCBjb25zdCBzdHJ1Y3QgdXNiX2Rldmlj
ZV9pZCAqaWQpCit7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqeHJnYjg4ODhfZW11
bGF0aW9uX2Zvcm1hdCA9IE5VTEw7CisJYm9vbCByZ2I1NjVfc3VwcG9ydGVkID0gZmFsc2UsIHhy
Z2I4ODg4X3N1cHBvcnRlZCA9IGZhbHNlOworCXVuc2lnbmVkIGludCBudW1fZm9ybWF0c19kZXYs
IG51bV9mb3JtYXRzID0gMDsKKwlzdHJ1Y3QgdXNiX2VuZHBvaW50X2Rlc2NyaXB0b3IgKmJ1bGtf
b3V0OworCXN0cnVjdCBndWRfZGlzcGxheV9kZXNjcmlwdG9yX3JlcSBkZXNjOworCXN0cnVjdCBk
ZXZpY2UgKmRldiA9ICZpbnRmLT5kZXY7CisJc2l6ZV90IG1heF9idWZmZXJfc2l6ZSA9IDA7CisJ
c3RydWN0IGd1ZF9kZXZpY2UgKmdkcm07CisJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKKwl1OCAq
Zm9ybWF0c19kZXY7CisJdTMyICpmb3JtYXRzOworCWludCByZXQsIGk7CisKKwlyZXQgPSB1c2Jf
ZmluZF9idWxrX291dF9lbmRwb2ludChpbnRmLT5jdXJfYWx0c2V0dGluZywgJmJ1bGtfb3V0KTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gZ3VkX2dldF9kaXNwbGF5X2Rlc2Ny
aXB0b3IoaW50ZiwgJmRlc2MpOworCWlmIChyZXQpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIo
ZGV2LCAiTm90IGEgZGlzcGxheSBpbnRlcmZhY2U6IHJldD0lZFxuIiwgcmV0KTsKKwkJcmV0dXJu
IC1FTk9ERVY7CisJfQorCisJaWYgKGRlc2MudmVyc2lvbiA+IDEpIHsKKwkJZGV2X2VycihkZXYs
ICJQcm90b2NvbCB2ZXJzaW9uICV1IGlzIG5vdCBzdXBwb3J0ZWRcbiIsIGRlc2MudmVyc2lvbik7
CisJCXJldHVybiAtRU5PREVWOworCX0KKworCWdkcm0gPSBkZXZtX2RybV9kZXZfYWxsb2MoZGV2
LCAmZ3VkX2RybV9kcml2ZXIsIHN0cnVjdCBndWRfZGV2aWNlLCBkcm0pOworCWlmIChJU19FUlIo
Z2RybSkpCisJCXJldHVybiBQVFJfRVJSKGdkcm0pOworCisJZHJtID0gJmdkcm0tPmRybTsKKwlk
cm0tPm1vZGVfY29uZmlnLmZ1bmNzID0gJmd1ZF9tb2RlX2NvbmZpZ19mdW5jczsKKwlyZXQgPSBk
cm1tX21vZGVfY29uZmlnX2luaXQoZHJtKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJ
Z2RybS0+ZmxhZ3MgPSBsZTMyX3RvX2NwdShkZXNjLmZsYWdzKTsKKwlnZHJtLT5jb21wcmVzc2lv
biA9IGRlc2MuY29tcHJlc3Npb24gJiBHVURfQ09NUFJFU1NJT05fTFo0OworCisJaWYgKGdkcm0t
PmZsYWdzICYgR1VEX0RJU1BMQVlfRkxBR19GVUxMX1VQREFURSAmJiBnZHJtLT5jb21wcmVzc2lv
bikKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwltdXRleF9pbml0KCZnZHJtLT5jdHJsX2xvY2spOwor
CW11dGV4X2luaXQoJmdkcm0tPmRhbWFnZV9sb2NrKTsKKwlJTklUX1dPUksoJmdkcm0tPndvcmss
IGd1ZF9mbHVzaF93b3JrKTsKKwlndWRfY2xlYXJfZGFtYWdlKGdkcm0pOworCisJcmV0ID0gZHJt
bV9hZGRfYWN0aW9uX29yX3Jlc2V0KGRybSwgZ3VkX2ZyZWVfYnVmZmVyc19hbmRfbXV0ZXgsIE5V
TEwpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm0tPm1vZGVfY29uZmlnLm1pbl93
aWR0aCA9IGxlMzJfdG9fY3B1KGRlc2MubWluX3dpZHRoKTsKKwlkcm0tPm1vZGVfY29uZmlnLm1h
eF93aWR0aCA9IGxlMzJfdG9fY3B1KGRlc2MubWF4X3dpZHRoKTsKKwlkcm0tPm1vZGVfY29uZmln
Lm1pbl9oZWlnaHQgPSBsZTMyX3RvX2NwdShkZXNjLm1pbl9oZWlnaHQpOworCWRybS0+bW9kZV9j
b25maWcubWF4X2hlaWdodCA9IGxlMzJfdG9fY3B1KGRlc2MubWF4X2hlaWdodCk7CisKKwlmb3Jt
YXRzX2RldiA9IGRldm1fa21hbGxvYyhkZXYsIEdVRF9GT1JNQVRTX01BWF9OVU0sIEdGUF9LRVJO
RUwpOworCS8qIEFkZCByb29tIGZvciBlbXVsYXRlZCBYUkdCODg4OCAqLworCWZvcm1hdHMgPSBk
ZXZtX2ttYWxsb2NfYXJyYXkoZGV2LCBHVURfRk9STUFUU19NQVhfTlVNICsgMSwgc2l6ZW9mKCpm
b3JtYXRzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFmb3JtYXRzX2RldiB8fCAhZm9ybWF0cykKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2dldChnZHJtLCBHVURfUkVRX0dFVF9G
T1JNQVRTLCAwLCBmb3JtYXRzX2RldiwgR1VEX0ZPUk1BVFNfTUFYX05VTSk7CisJaWYgKHJldCA8
IDApCisJCXJldHVybiByZXQ7CisKKwludW1fZm9ybWF0c19kZXYgPSByZXQ7CisJZm9yIChpID0g
MDsgaSA8IG51bV9mb3JtYXRzX2RldjsgaSsrKSB7CisJCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0
X2luZm8gKmluZm87CisJCXNpemVfdCBmbXRfYnVmX3NpemU7CisJCXUzMiBmb3JtYXQ7CisKKwkJ
Zm9ybWF0ID0gZ3VkX3RvX2ZvdXJjYyhmb3JtYXRzX2RldltpXSk7CisJCWlmICghZm9ybWF0KSB7
CisJCQlkcm1fZGJnKGRybSwgIlVuc3VwcG9ydGVkIGZvcm1hdDogMHglMDJ4XG4iLCBmb3JtYXRz
X2RldltpXSk7CisJCQljb250aW51ZTsKKwkJfQorCisJCWlmIChmb3JtYXQgPT0gR1VEX0RSTV9G
T1JNQVRfUjEpCisJCQlpbmZvID0gJmd1ZF9kcm1fZm9ybWF0X3IxOworCQllbHNlIGlmIChmb3Jt
YXQgPT0gR1VEX0RSTV9GT1JNQVRfUkdCMTExKQorCQkJaW5mbyA9ICZndWRfZHJtX2Zvcm1hdF9y
Z2IxMTE7CisJCWVsc2UKKwkJCWluZm8gPSBkcm1fZm9ybWF0X2luZm8oZm9ybWF0KTsKKworCQlz
d2l0Y2ggKGZvcm1hdCkgeworCQljYXNlIEdVRF9EUk1fRk9STUFUX1IxOgorCQkJZmFsbHRocm91
Z2g7CisJCWNhc2UgR1VEX0RSTV9GT1JNQVRfUkdCMTExOgorCQkJeHJnYjg4ODhfZW11bGF0aW9u
X2Zvcm1hdCA9IGluZm87CisJCQlicmVhazsKKwkJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJ
CXJnYjU2NV9zdXBwb3J0ZWQgPSB0cnVlOworCQkJaWYgKCF4cmdiODg4OF9lbXVsYXRpb25fZm9y
bWF0KQorCQkJCXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSBpbmZvOworCQkJYnJlYWs7CisJ
CWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwkJCXhyZ2I4ODg4X3N1cHBvcnRlZCA9IHRydWU7
CisJCQlicmVhazsKKwkJfTsKKworCQlmbXRfYnVmX3NpemUgPSBkcm1fZm9ybWF0X2luZm9fbWlu
X3BpdGNoKGluZm8sIDAsIGRybS0+bW9kZV9jb25maWcubWF4X3dpZHRoKSAqCisJCQkgICAgICAg
ZHJtLT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0OworCQltYXhfYnVmZmVyX3NpemUgPSBtYXgobWF4
X2J1ZmZlcl9zaXplLCBmbXRfYnVmX3NpemUpOworCisJCWlmIChmb3JtYXQgPT0gR1VEX0RSTV9G
T1JNQVRfUjEpCisJCQljb250aW51ZTsgLyogSW50ZXJuYWwgbm90IGZvciB1c2Vyc3BhY2UgKi8K
KworCQlmb3JtYXRzW251bV9mb3JtYXRzKytdID0gZm9ybWF0OworCX0KKworCWlmICghbnVtX2Zv
cm1hdHMgJiYgIXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQpIHsKKwkJZGV2X2VycihkZXYsICJO
byBzdXBwb3J0ZWQgcGl4ZWwgZm9ybWF0cyBmb3VuZFxuIik7CisJCXJldHVybiAtRUlOVkFMOwor
CX0KKworCS8qIFByZWZlciBzcGVlZCBvdmVyIGNvbG9yIGRlcHRoICovCisJaWYgKHJnYjU2NV9z
dXBwb3J0ZWQpCisJCWRybS0+bW9kZV9jb25maWcucHJlZmVycmVkX2RlcHRoID0gMTY7CisKKwlp
ZiAoIXhyZ2I4ODg4X3N1cHBvcnRlZCAmJiB4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KSB7CisJ
CWdkcm0tPnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSB4cmdiODg4OF9lbXVsYXRpb25fZm9y
bWF0OworCQlmb3JtYXRzW251bV9mb3JtYXRzKytdID0gRFJNX0ZPUk1BVF9YUkdCODg4ODsKKwl9
CisKKwlpZiAoZGVzYy5tYXhfYnVmZmVyX3NpemUpCisJCW1heF9idWZmZXJfc2l6ZSA9IGxlMzJf
dG9fY3B1KGRlc2MubWF4X2J1ZmZlcl9zaXplKTsKK3JldHJ5OgorCS8qCisJICogVXNlIHBsYWlu
IGttYWxsb2MgaGVyZSBzaW5jZSBkZXZtX2ttYWxsb2MoKSBwbGFjZXMgc3RydWN0IGRldnJlcyBh
dCB0aGUgYmVnaW5uaW5nCisJICogb2YgdGhlIGJ1ZmZlciBpdCBhbGxvY2F0ZXMuIFRoaXMgd2Fz
dGVzIGEgbG90IG9mIG1lbW9yeSB3aGVuIGFsbG9jYXRpbmcgYmlnIGJ1ZmZlcnMuCisJICogQXNr
aW5nIGZvciAyTSB3b3VsZCBhY3R1YWxseSBhbGxvY2F0ZSA0TS4gVGhpcyB3b3VsZCBhbHNvIHBy
ZXZlbnQgZ2V0dGluZyB0aGUgYmlnZ2VzdAorCSAqIHBvc3NpYmxlIGJ1ZmZlciBwb3RlbnRpYWxs
eSBsZWFkaW5nIHRvIHNwbGl0IHRyYW5zZmVycy4KKwkgKi8KKwlnZHJtLT5idWxrX2J1ZiA9IGtt
YWxsb2MobWF4X2J1ZmZlcl9zaXplLCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKKwlpZiAo
IWdkcm0tPmJ1bGtfYnVmKSB7CisJCW1heF9idWZmZXJfc2l6ZSA9IHJvdW5kdXBfcG93X29mX3R3
byhtYXhfYnVmZmVyX3NpemUpIC8gMjsKKwkJaWYgKG1heF9idWZmZXJfc2l6ZSA8IFNaXzUxMksp
CisJCQlyZXR1cm4gLUVOT01FTTsKKwkJZ290byByZXRyeTsKKwl9CisKKwlnZHJtLT5idWxrX3Bp
cGUgPSB1c2Jfc25kYnVsa3BpcGUoaW50ZXJmYWNlX3RvX3VzYmRldihpbnRmKSwgdXNiX2VuZHBv
aW50X251bShidWxrX291dCkpOworCWdkcm0tPmJ1bGtfbGVuID0gbWF4X2J1ZmZlcl9zaXplOwor
CisJaWYgKGdkcm0tPmNvbXByZXNzaW9uICYgR1VEX0NPTVBSRVNTSU9OX0xaNCkgeworCQlnZHJt
LT5sejRfY29tcF9tZW0gPSBkZXZtX2ttYWxsb2MoZGV2LCBMWjRfTUVNX0NPTVBSRVNTLCBHRlBf
S0VSTkVMKTsKKwkJaWYgKCFnZHJtLT5sejRfY29tcF9tZW0pCisJCQlyZXR1cm4gLUVOT01FTTsK
KworCQlnZHJtLT5jb21wcmVzc19idWYgPSB2bWFsbG9jKGdkcm0tPmJ1bGtfbGVuKTsKKwkJaWYg
KCFnZHJtLT5jb21wcmVzc19idWYpCisJCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlyZXQgPSBk
cm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9pbml0KGRybSwgJmdkcm0tPnBpcGUsICZndWRfcGlwZV9m
dW5jcywKKwkJCQkJICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsCisJCQkJCSAgIGd1ZF9waXBlX21v
ZGlmaWVycywgTlVMTCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWRldm1fa2ZyZWUo
ZGV2LCBmb3JtYXRzKTsKKwlkZXZtX2tmcmVlKGRldiwgZm9ybWF0c19kZXYpOworCisJcmV0ID0g
Z3VkX2dldF9wcm9wZXJ0aWVzKGdkcm0pOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkZXYsICJG
YWlsZWQgdG8gZ2V0IHByb3BlcnRpZXMgKGVycm9yPSVkKVxuIiwgcmV0KTsKKwkJcmV0dXJuIHJl
dDsKKwl9CisKKwlkcm1fcGxhbmVfZW5hYmxlX2ZiX2RhbWFnZV9jbGlwcygmZ2RybS0+cGlwZS5w
bGFuZSk7CisKKwlyZXQgPSBndWRfZ2V0X2Nvbm5lY3RvcnMoZ2RybSk7CisJaWYgKHJldCkgewor
CQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBnZXQgY29ubmVjdG9ycyAoZXJyb3I9JWQpXG4iLCBy
ZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9tb2RlX2NvbmZpZ19yZXNldChkcm0pOwor
CisJdXNiX3NldF9pbnRmZGF0YShpbnRmLCBnZHJtKTsKKworCWdkcm0tPmRtYWRldiA9IHVzYl9p
bnRmX2dldF9kbWFfZGV2aWNlKGludGYpOworCWlmICghZ2RybS0+ZG1hZGV2KQorCQlkZXZfd2Fy
bihkZXYsICJidWZmZXIgc2hhcmluZyBub3Qgc3VwcG9ydGVkIik7CisKKwlyZXQgPSBkcm1fZGV2
X3JlZ2lzdGVyKGRybSwgMCk7CisJaWYgKHJldCkgeworCQlwdXRfZGV2aWNlKGdkcm0tPmRtYWRl
dik7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJtX2ttc19oZWxwZXJfcG9sbF9pbml0KGRybSk7
CisKKwlkcm1fZmJkZXZfZ2VuZXJpY19zZXR1cChkcm0sIDApOworCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyB2b2lkIGd1ZF9kaXNjb25uZWN0KHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZh
Y2UpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVy
ZmFjZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9ICZnZHJtLT5kcm07CisKKwlkcm1fZGJn
KGRybSwgIiVzOlxuIiwgX19mdW5jX18pOworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9maW5pKGRy
bSk7CisJZHJtX2Rldl91bnBsdWcoZHJtKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93bihk
cm0pOworCXB1dF9kZXZpY2UoZ2RybS0+ZG1hZGV2KTsKKwlnZHJtLT5kbWFkZXYgPSBOVUxMOwor
fQorCitzdGF0aWMgaW50IGd1ZF9zdXNwZW5kKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRmLCBw
bV9tZXNzYWdlX3QgbWVzc2FnZSkKK3sKKwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IHVzYl9n
ZXRfaW50ZmRhdGEoaW50Zik7CisKKwlyZXR1cm4gZHJtX21vZGVfY29uZmlnX2hlbHBlcl9zdXNw
ZW5kKCZnZHJtLT5kcm0pOworfQorCitzdGF0aWMgaW50IGd1ZF9yZXN1bWUoc3RydWN0IHVzYl9p
bnRlcmZhY2UgKmludGYpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2lu
dGZkYXRhKGludGYpOworCisJZHJtX21vZGVfY29uZmlnX2hlbHBlcl9yZXN1bWUoJmdkcm0tPmRy
bSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCB1c2JfZGV2aWNlX2lk
IGd1ZF9pZF90YWJsZVtdID0geworCXsgVVNCX0RFVklDRV9JTlRFUkZBQ0VfQ0xBU1MoMHgxZDUw
LCAweDYxNGQsIFVTQl9DTEFTU19WRU5ET1JfU1BFQykgfSwKKwl7IH0KK307CisKK01PRFVMRV9E
RVZJQ0VfVEFCTEUodXNiLCBndWRfaWRfdGFibGUpOworCitzdGF0aWMgc3RydWN0IHVzYl9kcml2
ZXIgZ3VkX3VzYl9kcml2ZXIgPSB7CisJLm5hbWUJCT0gImd1ZCIsCisJLnByb2JlCQk9IGd1ZF9w
cm9iZSwKKwkuZGlzY29ubmVjdAk9IGd1ZF9kaXNjb25uZWN0LAorCS5pZF90YWJsZQk9IGd1ZF9p
ZF90YWJsZSwKKwkuc3VzcGVuZAk9IGd1ZF9zdXNwZW5kLAorCS5yZXN1bWUJCT0gZ3VkX3Jlc3Vt
ZSwKKwkucmVzZXRfcmVzdW1lCT0gZ3VkX3Jlc3VtZSwKK307CisKK21vZHVsZV91c2JfZHJpdmVy
KGd1ZF91c2JfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiTm9yYWxmIFRyw7hubmVzIik7CitN
T0RVTEVfTElDRU5TRSgiRHVhbCBNSVQvR1BMIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vZ3VkL2d1ZF9pbnRlcm5hbC5oIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfaW50ZXJuYWwu
aApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmIzZmQyYmRkNDkwMQot
LS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2ludGVybmFsLmgKQEAg
LTAsMCArMSwxNTQgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKworI2lm
bmRlZiBfX0xJTlVYX0dVRF9JTlRFUk5BTF9ICisjZGVmaW5lIF9fTElOVVhfR1VEX0lOVEVSTkFM
X0gKKworI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKyNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgor
I2luY2x1ZGUgPGxpbnV4L3VzYi5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorI2lu
Y2x1ZGUgPHVhcGkvZHJtL2RybV9mb3VyY2MuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fbW9kZXMu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmg+CisKK3N0cnVjdCBndWRf
ZGV2aWNlIHsKKwlzdHJ1Y3QgZHJtX2RldmljZSBkcm07CisJc3RydWN0IGRybV9zaW1wbGVfZGlz
cGxheV9waXBlIHBpcGU7CisJc3RydWN0IGRldmljZSAqZG1hZGV2OworCXN0cnVjdCB3b3JrX3N0
cnVjdCB3b3JrOworCXUzMiBmbGFnczsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICp4
cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0OworCisJdTE2ICpwcm9wZXJ0aWVzOworCXVuc2lnbmVk
IGludCBudW1fcHJvcGVydGllczsKKworCXVuc2lnbmVkIGludCBidWxrX3BpcGU7CisJdm9pZCAq
YnVsa19idWY7CisJc2l6ZV90IGJ1bGtfbGVuOworCisJdTggY29tcHJlc3Npb247CisJdm9pZCAq
bHo0X2NvbXBfbWVtOworCXZvaWQgKmNvbXByZXNzX2J1ZjsKKworCXU2NCBzdGF0c19sZW5ndGg7
CisJdTY0IHN0YXRzX2FjdHVhbF9sZW5ndGg7CisJdW5zaWduZWQgaW50IHN0YXRzX251bV9lcnJv
cnM7CisKKwlzdHJ1Y3QgbXV0ZXggY3RybF9sb2NrOyAvKiBTZXJpYWxpemUgZ2V0L3NldCBhbmQg
c3RhdHVzIHRyYW5zZmVycyAqLworCisJc3RydWN0IG11dGV4IGRhbWFnZV9sb2NrOyAvKiBQcm90
ZWN0cyB0aGUgZm9sbG93aW5nIG1lbWJlcnM6ICovCisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmI7CisJc3RydWN0IGRybV9yZWN0IGRhbWFnZTsKKwlib29sIHByZXZfZmx1c2hfZmFpbGVkOwor
fTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgZ3VkX2RldmljZSAqdG9fZ3VkX2RldmljZShzdHJ1
Y3QgZHJtX2RldmljZSAqZHJtKQoreworCXJldHVybiBjb250YWluZXJfb2YoZHJtLCBzdHJ1Y3Qg
Z3VkX2RldmljZSwgZHJtKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgdXNiX2RldmljZSAq
Z3VkX3RvX3VzYl9kZXZpY2Uoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0pCit7CisJcmV0dXJuIGlu
dGVyZmFjZV90b191c2JkZXYodG9fdXNiX2ludGVyZmFjZShnZHJtLT5kcm0uZGV2KSk7Cit9CisK
K2ludCBndWRfdXNiX2dldChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTE2
IGluZGV4LCB2b2lkICpidWYsIHNpemVfdCBsZW4pOworaW50IGd1ZF91c2Jfc2V0KHN0cnVjdCBn
dWRfZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1MTYgaW5kZXgsIHZvaWQgKmJ1Ziwgc2l6ZV90
IGxlbik7CitpbnQgZ3VkX3VzYl9nZXRfdTgoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHU4IHJl
cXVlc3QsIHUxNiBpbmRleCwgdTggKnZhbCk7CitpbnQgZ3VkX3VzYl9zZXRfdTgoc3RydWN0IGd1
ZF9kZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHU4IHZhbCk7CisKK3ZvaWQgZ3VkX2NsZWFyX2Rh
bWFnZShzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSk7Cit2b2lkIGd1ZF9mbHVzaF93b3JrKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yayk7CitpbnQgZ3VkX3BpcGVfY2hlY2soc3RydWN0IGRybV9zaW1w
bGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpuZXdf
cGxhbmVfc3RhdGUsCisJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUp
Owordm9pZCBndWRfcGlwZV91cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpw
aXBlLAorCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSk7CitpbnQgZ3Vk
X2Nvbm5lY3Rvcl9maWxsX3Byb3BlcnRpZXMoc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5lY3Rvcl9zdGF0ZSwKKwkJCQkgIHN0cnVjdCBndWRfcHJvcGVydHlfcmVxICpwcm9wZXJ0aWVz
KTsKK2ludCBndWRfZ2V0X2Nvbm5lY3RvcnMoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0pOworCisv
KiBEcml2ZXIgaW50ZXJuYWwgZm91cmNjIHRyYW5zZmVyIGZvcm1hdHMgKi8KKyNkZWZpbmUgR1VE
X0RSTV9GT1JNQVRfUjEJMHgwMDAwMDEyMgorI2RlZmluZSBHVURfRFJNX0ZPUk1BVF9SR0IxMTEJ
MHgwMzEyMTcyMgorCitzdGF0aWMgaW5saW5lIHU4IGd1ZF9mcm9tX2ZvdXJjYyh1MzIgZm91cmNj
KQoreworCXN3aXRjaCAoZm91cmNjKSB7CisJY2FzZSBHVURfRFJNX0ZPUk1BVF9SMToKKwkJcmV0
dXJuIEdVRF9QSVhFTF9GT1JNQVRfUjE7CisJY2FzZSBHVURfRFJNX0ZPUk1BVF9SR0IxMTE6CisJ
CXJldHVybiBHVURfUElYRUxfRk9STUFUX1JHQjExMTsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1
OgorCQlyZXR1cm4gR1VEX1BJWEVMX0ZPUk1BVF9SR0I1NjU7CisJY2FzZSBEUk1fRk9STUFUX1hS
R0I4ODg4OgorCQlyZXR1cm4gR1VEX1BJWEVMX0ZPUk1BVF9YUkdCODg4ODsKKwljYXNlIERSTV9G
T1JNQVRfQVJHQjg4ODg6CisJCXJldHVybiBHVURfUElYRUxfRk9STUFUX0FSR0I4ODg4OworCX07
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlubGluZSB1MzIgZ3VkX3RvX2ZvdXJjYyh1OCBm
b3JtYXQpCit7CisJc3dpdGNoIChmb3JtYXQpIHsKKwljYXNlIEdVRF9QSVhFTF9GT1JNQVRfUjE6
CisJCXJldHVybiBHVURfRFJNX0ZPUk1BVF9SMTsKKwljYXNlIEdVRF9QSVhFTF9GT1JNQVRfUkdC
MTExOgorCQlyZXR1cm4gR1VEX0RSTV9GT1JNQVRfUkdCMTExOworCWNhc2UgR1VEX1BJWEVMX0ZP
Uk1BVF9SR0I1NjU6CisJCXJldHVybiBEUk1fRk9STUFUX1JHQjU2NTsKKwljYXNlIEdVRF9QSVhF
TF9GT1JNQVRfWFJHQjg4ODg6CisJCXJldHVybiBEUk1fRk9STUFUX1hSR0I4ODg4OworCWNhc2Ug
R1VEX1BJWEVMX0ZPUk1BVF9BUkdCODg4ODoKKwkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjg4ODg7
CisJfTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZ3VkX2Zyb21fZGlz
cGxheV9tb2RlKHN0cnVjdCBndWRfZGlzcGxheV9tb2RlX3JlcSAqZHN0LAorCQkJCQkgY29uc3Qg
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKnNyYykKK3sKKwl1MzIgZmxhZ3MgPSBzcmMtPmZsYWdz
ICYgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1VTRVJfTUFTSzsKKworCWlmIChzcmMtPnR5cGUgJiBE
Uk1fTU9ERV9UWVBFX1BSRUZFUlJFRCkKKwkJZmxhZ3MgfD0gR1VEX0RJU1BMQVlfTU9ERV9GTEFH
X1BSRUZFUlJFRDsKKworCWRzdC0+Y2xvY2sgPSBjcHVfdG9fbGUzMihzcmMtPmNsb2NrKTsKKwlk
c3QtPmhkaXNwbGF5ID0gY3B1X3RvX2xlMTYoc3JjLT5oZGlzcGxheSk7CisJZHN0LT5oc3luY19z
dGFydCA9IGNwdV90b19sZTE2KHNyYy0+aHN5bmNfc3RhcnQpOworCWRzdC0+aHN5bmNfZW5kID0g
Y3B1X3RvX2xlMTYoc3JjLT5oc3luY19lbmQpOworCWRzdC0+aHRvdGFsID0gY3B1X3RvX2xlMTYo
c3JjLT5odG90YWwpOworCWRzdC0+dmRpc3BsYXkgPSBjcHVfdG9fbGUxNihzcmMtPnZkaXNwbGF5
KTsKKwlkc3QtPnZzeW5jX3N0YXJ0ID0gY3B1X3RvX2xlMTYoc3JjLT52c3luY19zdGFydCk7CisJ
ZHN0LT52c3luY19lbmQgPSBjcHVfdG9fbGUxNihzcmMtPnZzeW5jX2VuZCk7CisJZHN0LT52dG90
YWwgPSBjcHVfdG9fbGUxNihzcmMtPnZ0b3RhbCk7CisJZHN0LT5mbGFncyA9IGNwdV90b19sZTMy
KGZsYWdzKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGd1ZF90b19kaXNwbGF5X21vZGUoc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmRzdCwKKwkJCQkgICAgICAgY29uc3Qgc3RydWN0IGd1ZF9k
aXNwbGF5X21vZGVfcmVxICpzcmMpCit7CisJdTMyIGZsYWdzID0gbGUzMl90b19jcHUoc3JjLT5m
bGFncyk7CisKKwltZW1zZXQoZHN0LCAwLCBzaXplb2YoKmRzdCkpOworCWRzdC0+Y2xvY2sgPSBs
ZTMyX3RvX2NwdShzcmMtPmNsb2NrKTsKKwlkc3QtPmhkaXNwbGF5ID0gbGUxNl90b19jcHUoc3Jj
LT5oZGlzcGxheSk7CisJZHN0LT5oc3luY19zdGFydCA9IGxlMTZfdG9fY3B1KHNyYy0+aHN5bmNf
c3RhcnQpOworCWRzdC0+aHN5bmNfZW5kID0gbGUxNl90b19jcHUoc3JjLT5oc3luY19lbmQpOwor
CWRzdC0+aHRvdGFsID0gbGUxNl90b19jcHUoc3JjLT5odG90YWwpOworCWRzdC0+dmRpc3BsYXkg
PSBsZTE2X3RvX2NwdShzcmMtPnZkaXNwbGF5KTsKKwlkc3QtPnZzeW5jX3N0YXJ0ID0gbGUxNl90
b19jcHUoc3JjLT52c3luY19zdGFydCk7CisJZHN0LT52c3luY19lbmQgPSBsZTE2X3RvX2NwdShz
cmMtPnZzeW5jX2VuZCk7CisJZHN0LT52dG90YWwgPSBsZTE2X3RvX2NwdShzcmMtPnZ0b3RhbCk7
CisJZHN0LT5mbGFncyA9IGZsYWdzICYgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1VTRVJfTUFTSzsK
Kwlkc3QtPnR5cGUgPSBEUk1fTU9ERV9UWVBFX0RSSVZFUjsKKwlpZiAoZmxhZ3MgJiBHVURfRElT
UExBWV9NT0RFX0ZMQUdfUFJFRkVSUkVEKQorCQlkc3QtPnR5cGUgfD0gRFJNX01PREVfVFlQRV9Q
UkVGRVJSRUQ7CisJZHJtX21vZGVfc2V0X25hbWUoZHN0KTsKK30KKworI2VuZGlmCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBlLmMgYi9kcml2ZXJzL2dwdS9kcm0vZ3Vk
L2d1ZF9waXBlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4xYjAz
NmM3ZDc4MWUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBl
LmMKQEAgLTAsMCArMSw1MzUgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8q
CisgKiBDb3B5cmlnaHQgMjAyMCBOb3JhbGYgVHLDuG5uZXMKKyAqLworCisjaW5jbHVkZSA8bGlu
dXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGxpbnV4L2x6NC5oPgorI2luY2x1ZGUgPGxpbnV4L3Vz
Yi5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9h
dG9taWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Nvbm5lY3Rvci5oPgorI2luY2x1ZGUgPGRybS9k
cm1fZGFtYWdlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9mb3JtYXRfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2ZyYW1lYnVmZmVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fc2ht
ZW1faGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUgPGRybS9k
cm1fcmVjdC5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKyNpbmNs
dWRlIDxkcm0vZ3VkLmg+CisKKyNpbmNsdWRlICJndWRfaW50ZXJuYWwuaCIKKworc3RhdGljIGJv
b2wgZ3VkX2lzX2JpZ19lbmRpYW4odm9pZCkKK3sKKyNpZiBkZWZpbmVkKF9fQklHX0VORElBTikK
KwlyZXR1cm4gdHJ1ZTsKKyNlbHNlCisJcmV0dXJuIGZhbHNlOworI2VuZGlmCit9CisKK3N0YXRp
YyBzaXplX3QgZ3VkX3hyZ2I4ODg4X3RvX3IxMjQodTggKmRzdCwgY29uc3Qgc3RydWN0IGRybV9m
b3JtYXRfaW5mbyAqZm9ybWF0LAorCQkJCSAgIHZvaWQgKnNyYywgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCisJCQkJICAgc3RydWN0IGRybV9yZWN0ICpyZWN0KQoreworCXVuc2lnbmVkIGlu
dCBibG9ja193aWR0aCA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193aWR0aChmb3JtYXQsIDApOwor
CXVuc2lnbmVkIGludCBiaXRzX3Blcl9waXhlbCA9IDggLyBibG9ja193aWR0aDsKKwl1bnNpZ25l
ZCBpbnQgeCwgeSwgd2lkdGgsIGhlaWdodDsKKwl1OCAqcCwgKmJsb2NrID0gZHN0OyAvKiBBc3Np
Z24gdG8gc2lsZW5jZSBjb21waWxlciB3YXJuaW5nICovCisJc2l6ZV90IGxlbjsKKwl2b2lkICpi
dWY7CisKKwlXQVJOX09OX09OQ0UoZm9ybWF0LT5jaGFyX3Blcl9ibG9ja1swXSAhPSAxKTsKKwor
CS8qIFN0YXJ0IG9uIGEgYnl0ZSBib3VuZGFyeSAqLworCXJlY3QtPngxID0gQUxJR05fRE9XTihy
ZWN0LT54MSwgYmxvY2tfd2lkdGgpOworCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgocmVjdCk7CisJ
aGVpZ2h0ID0gZHJtX3JlY3RfaGVpZ2h0KHJlY3QpOworCWxlbiA9IGRybV9mb3JtYXRfaW5mb19t
aW5fcGl0Y2goZm9ybWF0LCAwLCB3aWR0aCkgKiBoZWlnaHQ7CisKKwlidWYgPSBrbWFsbG9jKHdp
ZHRoICogaGVpZ2h0LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJ1ZikKKwkJcmV0dXJuIDA7CisKKwlk
cm1fZmJfeHJnYjg4ODhfdG9fZ3JheTgoYnVmLCBzcmMsIGZiLCByZWN0KTsKKworCXAgPSBidWY7
CisJZm9yICh5ID0gMDsgeSA8IGRybV9yZWN0X2hlaWdodChyZWN0KTsgeSsrKSB7CisJCWZvciAo
eCA9IDA7IHggPCBkcm1fcmVjdF93aWR0aChyZWN0KTsgeCsrKSB7CisJCQlpZiAoISh4ICUgYmxv
Y2tfd2lkdGgpKSB7CisJCQkJYmxvY2sgPSBkc3QrKzsKKwkJCQkqYmxvY2sgPSAwOworCQkJfQor
CisJCQkqYmxvY2sgPDw9IGJpdHNfcGVyX3BpeGVsOworCQkJKmJsb2NrIHw9ICgqcCsrKSA+PiAo
OCAtIGJpdHNfcGVyX3BpeGVsKTsKKwkJfQorCX0KKworCWtmcmVlKGJ1Zik7CisKKwlyZXR1cm4g
bGVuOworfQorCitzdGF0aWMgc2l6ZV90IGd1ZF94cmdiODg4OF90b19jb2xvcih1OCAqZHN0LCBj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsCisJCQkJICAgIHUzMiAqc3JjLCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgICAgc3RydWN0IGRybV9yZWN0ICpyZWN0
KQoreworCXVuc2lnbmVkIGludCBibG9ja193aWR0aCA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193
aWR0aChmb3JtYXQsIDApOworCXVuc2lnbmVkIGludCB4LCB5LCB3aWR0aCwgaGVpZ2h0OworCXU4
IHIsIGcsIGIsICpibG9jayA9IGRzdDsgLyogQXNzaWduIHRvIHNpbGVuY2UgY29tcGlsZXIgd2Fy
bmluZyAqLworCXNpemVfdCBsZW47CisKKwkvKiBTdGFydCBvbiBhIGJ5dGUgYm91bmRhcnkgKi8K
KwlyZWN0LT54MSA9IEFMSUdOX0RPV04ocmVjdC0+eDEsIGJsb2NrX3dpZHRoKTsKKwl3aWR0aCA9
IGRybV9yZWN0X3dpZHRoKHJlY3QpOworCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodChyZWN0KTsK
KwlsZW4gPSBkcm1fZm9ybWF0X2luZm9fbWluX3BpdGNoKGZvcm1hdCwgMCwgd2lkdGgpICogaGVp
Z2h0OworCisJZm9yICh5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CisJCWZvciAoeCA9IDA7IHgg
PCB3aWR0aDsgeCsrKSB7CisJCQlpZiAoISh4ICUgYmxvY2tfd2lkdGgpKSB7CisJCQkJYmxvY2sg
PSBkc3QrKzsKKwkJCQkqYmxvY2sgPSAwOworCQkJfQorCisJCQlyID0gKnNyYyA+PiAxNjsKKwkJ
CWcgPSAqc3JjID4+IDg7CisJCQliID0gKnNyYysrOworCisJCQlzd2l0Y2ggKGZvcm1hdC0+Zm9y
bWF0KSB7CisJCQljYXNlIEdVRF9EUk1fRk9STUFUX1JHQjExMToKKwkJCQkqYmxvY2sgPDw9IDQ7
CisJCQkJKmJsb2NrIHw9ICgociA+PiA3KSA8PCAyKSB8ICgoZyA+PiA3KSA8PCAxKSB8IChiID4+
IDcpOworCQkJCWJyZWFrOworCQkJZGVmYXVsdDoKKwkJCQlXQVJOX09OX09OQ0UoMSk7CisJCQkJ
cmV0dXJuIGxlbjsKKwkJCX07CisJCX0KKwl9CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMg
aW50IGd1ZF9wcmVwX2ZsdXNoKHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCSAgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0
LCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QsCisJCQkgIHN0cnVjdCBndWRfc2V0X2J1ZmZlcl9yZXEg
KnJlcSkKK3sKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICppbXBvcnRfYXR0YWNoID0gZmIt
Pm9ialswXS0+aW1wb3J0X2F0dGFjaDsKKwl1OCBjb21wcmVzc2lvbiA9IGdkcm0tPmNvbXByZXNz
aW9uOworCXN0cnVjdCBkbWFfYnVmX21hcCBtYXA7CisJdm9pZCAqdmFkZHIsICpidWY7CisJc2l6
ZV90IHBpdGNoLCBsZW47CisJaW50IHJldCA9IDA7CisKKwlwaXRjaCA9IGRybV9mb3JtYXRfaW5m
b19taW5fcGl0Y2goZm9ybWF0LCAwLCBkcm1fcmVjdF93aWR0aChyZWN0KSk7CisJbGVuID0gcGl0
Y2ggKiBkcm1fcmVjdF9oZWlnaHQocmVjdCk7CisJaWYgKGxlbiA+IGdkcm0tPmJ1bGtfbGVuKQor
CQlyZXR1cm4gLUUyQklHOworCisJcmV0ID0gZHJtX2dlbV9zaG1lbV92bWFwKGZiLT5vYmpbMF0s
ICZtYXApOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwl2YWRkciA9IG1hcC52YWRkciAr
IGZiLT5vZmZzZXRzWzBdOworCisJaWYgKGltcG9ydF9hdHRhY2gpIHsKKwkJcmV0ID0gZG1hX2J1
Zl9iZWdpbl9jcHVfYWNjZXNzKGltcG9ydF9hdHRhY2gtPmRtYWJ1ZiwgRE1BX0ZST01fREVWSUNF
KTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gdnVubWFwOworCX0KK3JldHJ5OgorCWlmIChjb21wcmVz
c2lvbikKKwkJYnVmID0gZ2RybS0+Y29tcHJlc3NfYnVmOworCWVsc2UKKwkJYnVmID0gZ2RybS0+
YnVsa19idWY7CisKKwkvKgorCSAqIEltcG9ydGVkIGJ1ZmZlcnMgYXJlIGFzc3VtZWQgdG8gYmUg
d3JpdGUtY29tYmluZWQgYW5kIHRodXMgdW5jYWNoZWQKKwkgKiB3aXRoIHNsb3cgcmVhZHMgKGF0
IGxlYXN0IG9uIEFSTSkuCisJICovCisJaWYgKGZvcm1hdCAhPSBmYi0+Zm9ybWF0KSB7CisJCWlm
IChmb3JtYXQtPmZvcm1hdCA9PSBHVURfRFJNX0ZPUk1BVF9SMSkgeworCQkJbGVuID0gZ3VkX3hy
Z2I4ODg4X3RvX3IxMjQoYnVmLCBmb3JtYXQsIHZhZGRyLCBmYiwgcmVjdCk7CisJCQlpZiAoIWxl
bikgeworCQkJCXJldCA9IC1FTk9NRU07CisJCQkJZ290byBlbmRfY3B1X2FjY2VzczsKKwkJCX0K
KwkJfSBlbHNlIGlmIChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1JHQjU2NSkgeworCQkJ
ZHJtX2ZiX3hyZ2I4ODg4X3RvX3JnYjU2NShidWYsIHZhZGRyLCBmYiwgcmVjdCwgZ3VkX2lzX2Jp
Z19lbmRpYW4oKSk7CisJCX0gZWxzZSB7CisJCQlsZW4gPSBndWRfeHJnYjg4ODhfdG9fY29sb3Io
YnVmLCBmb3JtYXQsIHZhZGRyLCBmYiwgcmVjdCk7CisJCX0KKwl9IGVsc2UgaWYgKGd1ZF9pc19i
aWdfZW5kaWFuKCkgJiYgZm9ybWF0LT5jcHBbMF0gPiAxKSB7CisJCWRybV9mYl9zd2FiKGJ1Ziwg
dmFkZHIsIGZiLCByZWN0LCAhaW1wb3J0X2F0dGFjaCk7CisJfSBlbHNlIGlmIChjb21wcmVzc2lv
biAmJiAhaW1wb3J0X2F0dGFjaCAmJiBwaXRjaCA9PSBmYi0+cGl0Y2hlc1swXSkgeworCQkvKiBj
YW4gY29tcHJlc3MgZGlyZWN0bHkgZnJvbSB0aGUgZnJhbWVidWZmZXIgKi8KKwkJYnVmID0gdmFk
ZHIgKyByZWN0LT55MSAqIHBpdGNoOworCX0gZWxzZSB7CisJCWRybV9mYl9tZW1jcHkoYnVmLCB2
YWRkciwgZmIsIHJlY3QpOworCX0KKworCW1lbXNldChyZXEsIDAsIHNpemVvZigqcmVxKSk7CisJ
cmVxLT54ID0gY3B1X3RvX2xlMzIocmVjdC0+eDEpOworCXJlcS0+eSA9IGNwdV90b19sZTMyKHJl
Y3QtPnkxKTsKKwlyZXEtPndpZHRoID0gY3B1X3RvX2xlMzIoZHJtX3JlY3Rfd2lkdGgocmVjdCkp
OworCXJlcS0+aGVpZ2h0ID0gY3B1X3RvX2xlMzIoZHJtX3JlY3RfaGVpZ2h0KHJlY3QpKTsKKwly
ZXEtPmxlbmd0aCA9IGNwdV90b19sZTMyKGxlbik7CisKKwlpZiAoY29tcHJlc3Npb24gJiBHVURf
Q09NUFJFU1NJT05fTFo0KSB7CisJCWludCBjb21wbGVuOworCisJCWNvbXBsZW4gPSBMWjRfY29t
cHJlc3NfZGVmYXVsdChidWYsIGdkcm0tPmJ1bGtfYnVmLCBsZW4sIGxlbiwgZ2RybS0+bHo0X2Nv
bXBfbWVtKTsKKwkJaWYgKGNvbXBsZW4gPD0gMCkgeworCQkJY29tcHJlc3Npb24gPSAwOworCQkJ
Z290byByZXRyeTsKKwkJfQorCisJCXJlcS0+Y29tcHJlc3Npb24gPSBHVURfQ09NUFJFU1NJT05f
TFo0OworCQlyZXEtPmNvbXByZXNzZWRfbGVuZ3RoID0gY3B1X3RvX2xlMzIoY29tcGxlbik7CisJ
fQorCitlbmRfY3B1X2FjY2VzczoKKwlpZiAoaW1wb3J0X2F0dGFjaCkKKwkJZG1hX2J1Zl9lbmRf
Y3B1X2FjY2VzcyhpbXBvcnRfYXR0YWNoLT5kbWFidWYsIERNQV9GUk9NX0RFVklDRSk7Cit2dW5t
YXA6CisJZHJtX2dlbV9zaG1lbV92dW5tYXAoZmItPm9ialswXSwgJm1hcCk7CisKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgaW50IGd1ZF9mbHVzaF9yZWN0KHN0cnVjdCBndWRfZGV2aWNlICpn
ZHJtLCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgY29uc3Qgc3RydWN0IGRybV9m
b3JtYXRfaW5mbyAqZm9ybWF0LCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCit7CisJc3RydWN0IHVz
Yl9kZXZpY2UgKnVzYiA9IGd1ZF90b191c2JfZGV2aWNlKGdkcm0pOworCXN0cnVjdCBndWRfc2V0
X2J1ZmZlcl9yZXEgcmVxOworCWludCByZXQsIGFjdHVhbF9sZW5ndGg7CisJc2l6ZV90IGxlbiwg
dHJsZW47CisKKwlkcm1fZGJnKCZnZHJtLT5kcm0sICJGbHVzaGluZyBbRkI6JWRdICIgRFJNX1JF
Q1RfRk1UICJcbiIsIGZiLT5iYXNlLmlkLCBEUk1fUkVDVF9BUkcocmVjdCkpOworCisJcmV0ID0g
Z3VkX3ByZXBfZmx1c2goZ2RybSwgZmIsIGZvcm1hdCwgcmVjdCwgJnJlcSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCWxlbiA9IGxlMzJfdG9fY3B1KHJlcS5sZW5ndGgpOworCisJaWYg
KHJlcS5jb21wcmVzc2lvbikKKwkJdHJsZW4gPSBsZTMyX3RvX2NwdShyZXEuY29tcHJlc3NlZF9s
ZW5ndGgpOworCWVsc2UKKwkJdHJsZW4gPSBsZW47CisKKwlnZHJtLT5zdGF0c19sZW5ndGggKz0g
bGVuOworCS8qIERpZCBpdCB3cmFwIGFyb3VuZD8gKi8KKwlpZiAoZ2RybS0+c3RhdHNfbGVuZ3Ro
IDw9IGxlbiAmJiBnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoKSB7CisJCWdkcm0tPnN0YXRzX2xl
bmd0aCA9IGxlbjsKKwkJZ2RybS0+c3RhdHNfYWN0dWFsX2xlbmd0aCA9IDA7CisJfQorCWdkcm0t
PnN0YXRzX2FjdHVhbF9sZW5ndGggKz0gdHJsZW47CisKKwlpZiAoIShnZHJtLT5mbGFncyAmIEdV
RF9ESVNQTEFZX0ZMQUdfRlVMTF9VUERBVEUpIHx8IGdkcm0tPnByZXZfZmx1c2hfZmFpbGVkKSB7
CisJCXJldCA9IGd1ZF91c2Jfc2V0KGdkcm0sIEdVRF9SRVFfU0VUX0JVRkZFUiwgMCwgJnJlcSwg
c2l6ZW9mKHJlcSkpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSB1
c2JfYnVsa19tc2codXNiLCBnZHJtLT5idWxrX3BpcGUsIGdkcm0tPmJ1bGtfYnVmLCB0cmxlbiwK
KwkJCSAgICZhY3R1YWxfbGVuZ3RoLCBtc2Vjc190b19qaWZmaWVzKDMwMDApKTsKKwlpZiAoIXJl
dCAmJiB0cmxlbiAhPSBhY3R1YWxfbGVuZ3RoKQorCQlyZXQgPSAtRUlPOworCWlmIChyZXQpCisJ
CWdkcm0tPnN0YXRzX251bV9lcnJvcnMrKzsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZ3Vk
X2NsZWFyX2RhbWFnZShzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSkKK3sKKwlnZHJtLT5kYW1hZ2Uu
eDEgPSBJTlRfTUFYOworCWdkcm0tPmRhbWFnZS55MSA9IElOVF9NQVg7CisJZ2RybS0+ZGFtYWdl
LngyID0gMDsKKwlnZHJtLT5kYW1hZ2UueTIgPSAwOworfQorCitzdGF0aWMgdm9pZCBndWRfYWRk
X2RhbWFnZShzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgc3RydWN0IGRybV9yZWN0ICpkYW1hZ2Up
Cit7CisJZ2RybS0+ZGFtYWdlLngxID0gbWluKGdkcm0tPmRhbWFnZS54MSwgZGFtYWdlLT54MSk7
CisJZ2RybS0+ZGFtYWdlLnkxID0gbWluKGdkcm0tPmRhbWFnZS55MSwgZGFtYWdlLT55MSk7CisJ
Z2RybS0+ZGFtYWdlLngyID0gbWF4KGdkcm0tPmRhbWFnZS54MiwgZGFtYWdlLT54Mik7CisJZ2Ry
bS0+ZGFtYWdlLnkyID0gbWF4KGdkcm0tPmRhbWFnZS55MiwgZGFtYWdlLT55Mik7Cit9CisKK3N0
YXRpYyB2b2lkIGd1ZF9yZXRyeV9mYWlsZWRfZmx1c2goc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0s
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSAgIHN0cnVjdCBkcm1fcmVjdCAqZGFt
YWdlKQoreworCS8qCisJICogcGlwZV91cGRhdGUgd2FpdHMgZm9yIHRoZSB3b3JrZXIgd2hlbiB0
aGUgZGlzcGxheSBtb2RlIGlzIGdvaW5nIHRvIGNoYW5nZS4KKwkgKiBUaGlzIGVuc3VyZXMgdGhh
dCB0aGUgd2lkdGggYW5kIGhlaWdodCBpcyBzdGlsbCB0aGUgc2FtZSBtYWtpbmcgaXQgc2FmZSB0
bworCSAqIGFkZCBiYWNrIHRoZSBkYW1hZ2UuCisJICovCisKKwltdXRleF9sb2NrKCZnZHJtLT5k
YW1hZ2VfbG9jayk7CisJaWYgKCFnZHJtLT5mYikgeworCQlkcm1fZnJhbWVidWZmZXJfZ2V0KGZi
KTsKKwkJZ2RybS0+ZmIgPSBmYjsKKwl9CisJZ3VkX2FkZF9kYW1hZ2UoZ2RybSwgZGFtYWdlKTsK
KwltdXRleF91bmxvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCS8qIFJldHJ5IG9ubHkgb25j
ZSB0byBhdm9pZCBhIHBvc3NpYmxlIHN0b3JtIGluIGNhc2Ugb2YgY29udGludWVzIGVycm9ycy4g
Ki8KKwlpZiAoIWdkcm0tPnByZXZfZmx1c2hfZmFpbGVkKQorCQlxdWV1ZV93b3JrKHN5c3RlbV9s
b25nX3dxLCAmZ2RybS0+d29yayk7CisJZ2RybS0+cHJldl9mbHVzaF9mYWlsZWQgPSB0cnVlOwor
fQorCit2b2lkIGd1ZF9mbHVzaF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlz
dHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZ3VkX2Rl
dmljZSwgd29yayk7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0OworCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiOworCXN0cnVjdCBkcm1fcmVjdCBkYW1hZ2U7CisJdW5z
aWduZWQgaW50IGksIGxpbmVzOworCWludCBpZHgsIHJldCA9IDA7CisJc2l6ZV90IHBpdGNoOwor
CisJaWYgKCFkcm1fZGV2X2VudGVyKCZnZHJtLT5kcm0sICZpZHgpKQorCQlyZXR1cm47CisKKwlt
dXRleF9sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisJZmIgPSBnZHJtLT5mYjsKKwlnZHJtLT5m
YiA9IE5VTEw7CisJZGFtYWdlID0gZ2RybS0+ZGFtYWdlOworCWd1ZF9jbGVhcl9kYW1hZ2UoZ2Ry
bSk7CisJbXV0ZXhfdW5sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwlpZiAoIWZiKQorCQln
b3RvIG91dDsKKworCWZvcm1hdCA9IGZiLT5mb3JtYXQ7CisJaWYgKGZvcm1hdC0+Zm9ybWF0ID09
IERSTV9GT1JNQVRfWFJHQjg4ODggJiYgZ2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkK
KwkJZm9ybWF0ID0gZ2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdDsKKworCS8qIFNwbGl0
IHVwZGF0ZSBpZiBpdCdzIHRvbyBiaWcgKi8KKwlwaXRjaCA9IGRybV9mb3JtYXRfaW5mb19taW5f
cGl0Y2goZm9ybWF0LCAwLCBkcm1fcmVjdF93aWR0aCgmZGFtYWdlKSk7CisJbGluZXMgPSBkcm1f
cmVjdF9oZWlnaHQoJmRhbWFnZSk7CisKKwlpZiAoZ2RybS0+YnVsa19sZW4gPCBsaW5lcyAqIHBp
dGNoKQorCQlsaW5lcyA9IGdkcm0tPmJ1bGtfbGVuIC8gcGl0Y2g7CisKKwlmb3IgKGkgPSAwOyBp
IDwgRElWX1JPVU5EX1VQKGRybV9yZWN0X2hlaWdodCgmZGFtYWdlKSwgbGluZXMpOyBpKyspIHsK
KwkJc3RydWN0IGRybV9yZWN0IHJlY3QgPSBkYW1hZ2U7CisKKwkJcmVjdC55MSArPSBpICogbGlu
ZXM7CisJCXJlY3QueTIgPSBtaW5fdCh1MzIsIHJlY3QueTEgKyBsaW5lcywgZGFtYWdlLnkyKTsK
KworCQlyZXQgPSBndWRfZmx1c2hfcmVjdChnZHJtLCBmYiwgZm9ybWF0LCAmcmVjdCk7CisJCWlm
IChyZXQpIHsKKwkJCWlmIChyZXQgIT0gLUVOT0RFViAmJiByZXQgIT0gLUVDT05OUkVTRVQgJiYK
KwkJCSAgICByZXQgIT0gLUVTSFVURE9XTiAmJiByZXQgIT0gLUVQUk9UTykgeworCQkJCWJvb2wg
cHJldl9mbHVzaF9mYWlsZWQgPSBnZHJtLT5wcmV2X2ZsdXNoX2ZhaWxlZDsKKworCQkJCWd1ZF9y
ZXRyeV9mYWlsZWRfZmx1c2goZ2RybSwgZmIsICZkYW1hZ2UpOworCQkJCWlmICghcHJldl9mbHVz
aF9mYWlsZWQpCisJCQkJCWRldl9lcnJfcmF0ZWxpbWl0ZWQoZmItPmRldi0+ZGV2LAorCQkJCQkJ
CSAgICAiRmFpbGVkIHRvIGZsdXNoIGZyYW1lYnVmZmVyOiBlcnJvcj0lZFxuIiwgcmV0KTsKKwkJ
CX0KKwkJCWJyZWFrOworCQl9CisKKwkJZ2RybS0+cHJldl9mbHVzaF9mYWlsZWQgPSBmYWxzZTsK
Kwl9CisKKwlkcm1fZnJhbWVidWZmZXJfcHV0KGZiKTsKK291dDoKKwlkcm1fZGV2X2V4aXQoaWR4
KTsKK30KKworc3RhdGljIHZvaWQgZ3VkX2ZiX3F1ZXVlX2RhbWFnZShzdHJ1Y3QgZ3VkX2Rldmlj
ZSAqZ2RybSwgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJc3RydWN0IGRybV9yZWN0
ICpkYW1hZ2UpCit7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqb2xkX2ZiID0gTlVMTDsKKwor
CW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCWlmIChmYiAhPSBnZHJtLT5mYikg
eworCQlvbGRfZmIgPSBnZHJtLT5mYjsKKwkJZHJtX2ZyYW1lYnVmZmVyX2dldChmYik7CisJCWdk
cm0tPmZiID0gZmI7CisJfQorCisJZ3VkX2FkZF9kYW1hZ2UoZ2RybSwgZGFtYWdlKTsKKworCW11
dGV4X3VubG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCisJcXVldWVfd29yayhzeXN0ZW1fbG9u
Z193cSwgJmdkcm0tPndvcmspOworCisJaWYgKG9sZF9mYikKKwkJZHJtX2ZyYW1lYnVmZmVyX3B1
dChvbGRfZmIpOworfQorCitpbnQgZ3VkX3BpcGVfY2hlY2soc3RydWN0IGRybV9zaW1wbGVfZGlz
cGxheV9waXBlICpwaXBlLAorCQkgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpuZXdfcGxhbmVf
c3RhdGUsCisJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCit7CisJ
c3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKHBpcGUtPmNydGMuZGV2KTsK
KwlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUgPSBwaXBlLT5wbGFuZS5z
dGF0ZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZuZXdfY3J0Y19z
dGF0ZS0+bW9kZTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBuZXdfcGxhbmVf
c3RhdGUtPnN0YXRlOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKm9sZF9mYiA9IG9sZF9wbGFu
ZV9zdGF0ZS0+ZmI7CisJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0
ZSA9IE5VTEw7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVfc3RhdGUt
PmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCA9IGZiLT5mb3JtYXQ7
CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwl1bnNpZ25lZCBpbnQgaSwgbnVt
X3Byb3BlcnRpZXM7CisJc3RydWN0IGd1ZF9zdGF0ZV9yZXEgKnJlcTsKKwlpbnQgaWR4LCByZXQ7
CisJc2l6ZV90IGxlbjsKKworCWlmIChXQVJOX09OX09OQ0UoIWZiKSkKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwlpZiAob2xkX3BsYW5lX3N0YXRlLT5yb3RhdGlvbiAhPSBuZXdfcGxhbmVfc3RhdGUt
PnJvdGF0aW9uKQorCQluZXdfY3J0Y19zdGF0ZS0+bW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKworCWlm
IChvbGRfZmIgJiYgb2xkX2ZiLT5mb3JtYXQgIT0gZm9ybWF0KQorCQluZXdfY3J0Y19zdGF0ZS0+
bW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKworCWlmICghbmV3X2NydGNfc3RhdGUtPm1vZGVfY2hhbmdl
ZCAmJiAhbmV3X2NydGNfc3RhdGUtPmNvbm5lY3RvcnNfY2hhbmdlZCkKKwkJcmV0dXJuIDA7CisK
KwkvKiBPbmx5IG9uZSBjb25uZWN0b3IgaXMgc3VwcG9ydGVkICovCisJaWYgKGh3ZWlnaHQzMihu
ZXdfY3J0Y19zdGF0ZS0+Y29ubmVjdG9yX21hc2spICE9IDEpCisJCXJldHVybiAtRUlOVkFMOwor
CisJaWYgKGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfWFJHQjg4ODggJiYgZ2RybS0+eHJn
Yjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkKKwkJZm9ybWF0ID0gZ2RybS0+eHJnYjg4ODhfZW11bGF0
aW9uX2Zvcm1hdDsKKworCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNv
bm5lY3RvciwgY29ubmVjdG9yX3N0YXRlLCBpKSB7CisJCWlmIChjb25uZWN0b3Jfc3RhdGUtPmNy
dGMpCisJCQlicmVhazsKKwl9CisKKwkvKgorCSAqIERSTV9JT0NUTF9NT0RFX09CSl9TRVRQUk9Q
RVJUWSBvbiB0aGUgcm90YXRpb24gcHJvcGVydHkgd2lsbCBub3QgaGF2ZQorCSAqIHRoZSBjb25u
ZWN0b3IgaW5jbHVkZWQgaW4gdGhlIHN0YXRlLgorCSAqLworCWlmICghY29ubmVjdG9yX3N0YXRl
KSB7CisJCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7CisKKwkJZHJt
X2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4ocGlwZS0+Y3J0Yy5kZXYsICZjb25uX2l0ZXIpOwor
CQlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7CisJ
CQlpZiAoY29ubmVjdG9yLT5zdGF0ZS0+Y3J0YykgeworCQkJCWNvbm5lY3Rvcl9zdGF0ZSA9IGNv
bm5lY3Rvci0+c3RhdGU7CisJCQkJYnJlYWs7CisJCQl9CisJCX0KKwkJZHJtX2Nvbm5lY3Rvcl9s
aXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIpOworCX0KKworCWlmIChXQVJOX09OX09OQ0UoIWNvbm5l
Y3Rvcl9zdGF0ZSkpCisJCXJldHVybiAtRU5PRU5UOworCisJbGVuID0gc3RydWN0X3NpemUocmVx
LCBwcm9wZXJ0aWVzLAorCQkJICBHVURfUFJPUEVSVElFU19NQVhfTlVNICsgR1VEX0NPTk5FQ1RP
Ul9QUk9QRVJUSUVTX01BWF9OVU0pOworCXJlcSA9IGt6YWxsb2MobGVuLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIXJlcSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlndWRfZnJvbV9kaXNwbGF5X21vZGUo
JnJlcS0+bW9kZSwgbW9kZSk7CisKKwlyZXEtPmZvcm1hdCA9IGd1ZF9mcm9tX2ZvdXJjYyhmb3Jt
YXQtPmZvcm1hdCk7CisJaWYgKFdBUk5fT05fT05DRSghcmVxLT5mb3JtYXQpKSB7CisJCXJldCA9
IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworCXJlcS0+Y29ubmVjdG9yID0gZHJtX2Nvbm5l
Y3Rvcl9pbmRleChjb25uZWN0b3Jfc3RhdGUtPmNvbm5lY3Rvcik7CisKKwlyZXQgPSBndWRfY29u
bmVjdG9yX2ZpbGxfcHJvcGVydGllcyhjb25uZWN0b3Jfc3RhdGUsIHJlcS0+cHJvcGVydGllcyk7
CisJaWYgKHJldCA8IDApCisJCWdvdG8gb3V0OworCisJbnVtX3Byb3BlcnRpZXMgPSByZXQ7CisJ
Zm9yIChpID0gMDsgaSA8IGdkcm0tPm51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHByb3Ag
PSBnZHJtLT5wcm9wZXJ0aWVzW2ldOworCQl1NjQgdmFsOworCisJCXN3aXRjaCAocHJvcCkgewor
CQljYXNlIEdVRF9QUk9QRVJUWV9ST1RBVElPTjoKKwkJCS8qIERSTSBVQVBJIG1hdGNoZXMgdGhl
IHByb3RvY29sIHNvIHVzZSB2YWx1ZSBkaXJlY3RseSAqLworCQkJdmFsID0gbmV3X3BsYW5lX3N0
YXRlLT5yb3RhdGlvbjsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJV0FSTl9PTl9PTkNFKDEp
OworCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJcmVxLT5wcm9wZXJ0
aWVzW251bV9wcm9wZXJ0aWVzICsgaV0ucHJvcCA9IGNwdV90b19sZTE2KHByb3ApOworCQlyZXEt
PnByb3BlcnRpZXNbbnVtX3Byb3BlcnRpZXMgKyBpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOwor
CQludW1fcHJvcGVydGllcysrOworCX0KKworCWlmIChkcm1fZGV2X2VudGVyKGZiLT5kZXYsICZp
ZHgpKSB7CisJCWxlbiA9IHN0cnVjdF9zaXplKHJlcSwgcHJvcGVydGllcywgbnVtX3Byb3BlcnRp
ZXMpOworCQlyZXQgPSBndWRfdXNiX3NldChnZHJtLCBHVURfUkVRX1NFVF9TVEFURV9DSEVDSywg
MCwgcmVxLCBsZW4pOworCQlkcm1fZGV2X2V4aXQoaWR4KTsKKwl9ICBlbHNlIHsKKwkJcmV0ID0g
LUVOT0RFVjsKKwl9CitvdXQ6CisJa2ZyZWUocmVxKTsKKworCXJldHVybiByZXQ7Cit9CisKK3Zv
aWQgZ3VkX3BpcGVfdXBkYXRlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwK
KwkJICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3RydWN0IGRy
bV9kZXZpY2UgKmRybSA9IHBpcGUtPmNydGMuZGV2OworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJt
ID0gdG9fZ3VkX2RldmljZShkcm0pOworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlID0g
cGlwZS0+cGxhbmUuc3RhdGU7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+
ZmI7CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gJnBpcGUtPmNydGM7CisJc3RydWN0IGRybV9y
ZWN0IGRhbWFnZTsKKwlpbnQgaWR4OworCisJaWYgKGNydGMtPnN0YXRlLT5tb2RlX2NoYW5nZWQg
fHwgIWNydGMtPnN0YXRlLT5lbmFibGUpIHsKKwkJY2FuY2VsX3dvcmtfc3luYygmZ2RybS0+d29y
ayk7CisJCW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKwkJaWYgKGdkcm0tPmZiKSB7
CisJCQlkcm1fZnJhbWVidWZmZXJfcHV0KGdkcm0tPmZiKTsKKwkJCWdkcm0tPmZiID0gTlVMTDsK
KwkJfQorCQlndWRfY2xlYXJfZGFtYWdlKGdkcm0pOworCQltdXRleF91bmxvY2soJmdkcm0tPmRh
bWFnZV9sb2NrKTsKKwl9CisKKwlpZiAoIWRybV9kZXZfZW50ZXIoZHJtLCAmaWR4KSkKKwkJcmV0
dXJuOworCisJaWYgKCFvbGRfc3RhdGUtPmZiKQorCQlndWRfdXNiX3NldF91OChnZHJtLCBHVURf
UkVRX1NFVF9DT05UUk9MTEVSX0VOQUJMRSwgMSk7CisKKwlpZiAoZmIgJiYgKGNydGMtPnN0YXRl
LT5tb2RlX2NoYW5nZWQgfHwgY3J0Yy0+c3RhdGUtPmNvbm5lY3RvcnNfY2hhbmdlZCkpCisJCWd1
ZF91c2Jfc2V0KGdkcm0sIEdVRF9SRVFfU0VUX1NUQVRFX0NPTU1JVCwgMCwgTlVMTCwgMCk7CisK
KwlpZiAoY3J0Yy0+c3RhdGUtPmFjdGl2ZV9jaGFuZ2VkKQorCQlndWRfdXNiX3NldF91OChnZHJt
LCBHVURfUkVRX1NFVF9ESVNQTEFZX0VOQUJMRSwgY3J0Yy0+c3RhdGUtPmFjdGl2ZSk7CisKKwlp
ZiAoZHJtX2F0b21pY19oZWxwZXJfZGFtYWdlX21lcmdlZChvbGRfc3RhdGUsIHN0YXRlLCAmZGFt
YWdlKSkgeworCQlpZiAoZ2RybS0+ZmxhZ3MgJiBHVURfRElTUExBWV9GTEFHX0ZVTExfVVBEQVRF
KQorCQkJZHJtX3JlY3RfaW5pdCgmZGFtYWdlLCAwLCAwLCBmYi0+d2lkdGgsIGZiLT5oZWlnaHQp
OworCQlndWRfZmJfcXVldWVfZGFtYWdlKGdkcm0sIGZiLCAmZGFtYWdlKTsKKwl9CisKKwlpZiAo
IWNydGMtPnN0YXRlLT5lbmFibGUpCisJCWd1ZF91c2Jfc2V0X3U4KGdkcm0sIEdVRF9SRVFfU0VU
X0NPTlRST0xMRVJfRU5BQkxFLCAwKTsKKworCWRybV9kZXZfZXhpdChpZHgpOworfQpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9kcm0vZ3VkLmggYi9pbmNsdWRlL2RybS9ndWQuaApuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmEwNzhhYWQ2M2EzMQotLS0gL2Rldi9udWxsCisr
KyBiL2luY2x1ZGUvZHJtL2d1ZC5oCkBAIC0wLDAgKzEsMzMzIEBACisvKiBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IDIwMjAgTm9yYWxmIFRyw7hubmVz
CisgKi8KKworI2lmbmRlZiBfX0xJTlVYX0dVRF9ICisjZGVmaW5lIF9fTElOVVhfR1VEX0gKKwor
I2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKKy8qCisgKiBzdHJ1Y3QgZ3VkX2Rpc3BsYXlfZGVz
Y3JpcHRvcl9yZXEgLSBEaXNwbGF5IGRlc2NyaXB0b3IKKyAqIEBtYWdpYzogTWFnaWMgdmFsdWUg
R1VEX0RJU1BMQVlfTUFHSUMKKyAqIEB2ZXJzaW9uOiBQcm90b2NvbCB2ZXJzaW9uCisgKiBAZmxh
Z3M6IEZsYWdzCisgKiAgICAgICAgIC0gU1RBVFVTX09OX1NFVDogQWx3YXlzIGRvIGEgc3RhdHVz
IHJlcXVlc3QgYWZ0ZXIgYSBTRVQgcmVxdWVzdC4KKyAqICAgICAgICAgICAgICAgICAgICAgICAg
ICBUaGlzIGlzIHVzZWQgYnkgdGhlIExpbnV4IGdhZGdldCBkcml2ZXIgc2luY2UgaXQgaGFzCisg
KiAgICAgICAgICAgICAgICAgICAgICAgICAgbm8gd2F5IHRvIGNvbnRyb2wgdGhlIHN0YXR1cyBz
dGFnZSBvZiBhIGNvbnRyb2wgT1VUCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVz
dCB0aGF0IGhhcyBhIHBheWxvYWQuCisgKiAgICAgICAgIC0gRlVMTF9VUERBVEU6ICAgQWx3YXlz
IHNlbmQgdGhlIGVudGlyZSBmcmFtZWJ1ZmZlciB3aGVuIGZsdXNoaW5nIGNoYW5nZXMuCisgKiAg
ICAgICAgICAgICAgICAgICAgICAgICAgVGhlIEdVRF9SRVFfU0VUX0JVRkZFUiByZXF1ZXN0IHdp
bGwgbm90IGJlIHNlbnQKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmUgZWFjaCBi
dWxrIHRyYW5zZmVyLCBpdCB3aWxsIG9ubHkgYmUgc2VudCBpZiB0aGUKKyAqICAgICAgICAgICAg
ICAgICAgICAgICAgICBwcmV2aW91cyBidWxrIHRyYW5zZmVyIGhhZCBmYWlsZWQuIFRoaXMgZ2l2
ZXMgdGhlIGRldmljZQorICogICAgICAgICAgICAgICAgICAgICAgICAgIGEgY2hhbmNlIHRvIHJl
c2V0IGl0cyBzdGF0ZSBtYWNoaW5lIGlmIG5lZWRlZC4KKyAqICAgICAgICAgICAgICAgICAgICAg
ICAgICBUaGlzIGZsYWcgY2FuIG5vdCBiZSB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggY29tcHJl
c3Npb24uCisgKiBAY29tcHJlc3Npb246IFN1cHBvcnRlZCBjb21wcmVzc2lvbiB0eXBlcworICog
ICAgICAgICAgICAgICAtIEdVRF9DT01QUkVTU0lPTl9MWjQ6IExaNCBsb3NzbGVzcyBjb21wcmVz
c2lvbi4KKyAqIEBtYXhfYnVmZmVyX3NpemU6IE1heGltdW0gYnVmZmVyIHNpemUgdGhlIGRldmlj
ZSBjYW4gaGFuZGxlIChvcHRpb25hbCkuCisgKiAgICAgICAgICAgICAgICAgICBUaGlzIGlzIHVz
ZWZ1bCBmb3IgZGV2aWNlcyB0aGF0IGRvbid0IGhhdmUgYSBiaWcgZW5vdWdoCisgKiAgICAgICAg
ICAgICAgICAgICBidWZmZXIgdG8gZGVjb21wcmVzcyB0aGUgZW50aXJlIGZyYW1lYnVmZmVyIGlu
IG9uZSBnby4KKyAqIEBtaW5fd2lkdGg6IE1pbmltdW0gcGl4ZWwgd2lkdGggdGhlIGNvbnRyb2xs
ZXIgY2FuIGhhbmRsZQorICogQG1heF93aWR0aDogTWF4aW11bSB3aWR0aAorICogQG1pbl9oZWln
aHQ6IE1pbmltdW0gaGVpZ2h0CisgKiBAbWF4X2hlaWdodDogTWF4aW11bSBoZWlnaHQKKyAqCisg
KiBEZXZpY2VzIHRoYXQgaGF2ZSBvbmx5IG9uZSBkaXNwbGF5IG1vZGUgd2lsbCBoYXZlIG1pbl93
aWR0aCA9PSBtYXhfd2lkdGgKKyAqIGFuZCBtaW5faGVpZ2h0ID09IG1heF9oZWlnaHQuCisgKi8K
K3N0cnVjdCBndWRfZGlzcGxheV9kZXNjcmlwdG9yX3JlcSB7CisJX19sZTMyIG1hZ2ljOworI2Rl
ZmluZSBHVURfRElTUExBWV9NQUdJQwkJCTB4MWQ1MDYxNGQKKwlfX3U4IHZlcnNpb247CisJX19s
ZTMyIGZsYWdzOworI2RlZmluZSBHVURfRElTUExBWV9GTEFHX1NUQVRVU19PTl9TRVQJCUJJVCgw
KQorI2RlZmluZSBHVURfRElTUExBWV9GTEFHX0ZVTExfVVBEQVRFCQlCSVQoMSkKKwlfX3U4IGNv
bXByZXNzaW9uOworI2RlZmluZSBHVURfQ09NUFJFU1NJT05fTFo0CQkJQklUKDApCisJX19sZTMy
IG1heF9idWZmZXJfc2l6ZTsKKwlfX2xlMzIgbWluX3dpZHRoOworCV9fbGUzMiBtYXhfd2lkdGg7
CisJX19sZTMyIG1pbl9oZWlnaHQ7CisJX19sZTMyIG1heF9oZWlnaHQ7Cit9IF9fcGFja2VkOwor
CisvKgorICogc3RydWN0IGd1ZF9wcm9wZXJ0eV9yZXEgLSBQcm9wZXJ0eQorICogQHByb3A6IFBy
b3BlcnR5CisgKiBAdmFsOiBWYWx1ZQorICovCitzdHJ1Y3QgZ3VkX3Byb3BlcnR5X3JlcSB7CisJ
X19sZTE2IHByb3A7CisJX19sZTY0IHZhbDsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBzdHJ1Y3Qg
Z3VkX2Rpc3BsYXlfbW9kZV9yZXEgLSBEaXNwbGF5IG1vZGUKKyAqIEBjbG9jazogUGl4ZWwgY2xv
Y2sgaW4ga0h6CisgKiBAaGRpc3BsYXk6IEhvcml6b250YWwgZGlzcGxheSBzaXplCisgKiBAaHN5
bmNfc3RhcnQ6IEhvcml6b250YWwgc3luYyBzdGFydAorICogQGhzeW5jX2VuZDogSG9yaXpvbnRh
bCBzeW5jIGVuZAorICogQGh0b3RhbDogSG9yaXpvbnRhbCB0b3RhbCBzaXplCisgKiBAdmRpc3Bs
YXk6IFZlcnRpY2FsIGRpc3BsYXkgc2l6ZQorICogQHZzeW5jX3N0YXJ0OiBWZXJ0aWNhbCBzeW5j
IHN0YXJ0CisgKiBAdnN5bmNfZW5kOiBWZXJ0aWNhbCBzeW5jIGVuZAorICogQHZ0b3RhbDogVmVy
dGljYWwgdG90YWwgc2l6ZQorICogQGZsYWdzOiBCaXRzIDAtMTMgYXJlIHRoZSBzYW1lIGFzIGlu
IHRoZSBSYW5kUiBwcm90b2NvbCBhbmQgYWxzbyB3aGF0IERSTSB1c2VzLgorICogICAgICAgICBU
aGUgZGVwcmVjYXRlZCBiaXRzIGFyZSByZXVzZWQgZm9yIGludGVybmFsIHByb3RvY29sIGZsYWdz
IGxlYXZpbmcgdXMKKyAqICAgICAgICAgZnJlZSB0byBmb2xsb3cgRFJNIGZvciB0aGUgb3RoZXIg
Yml0cyBpbiB0aGUgZnV0dXJlLgorICogICAgICAgICAtIEZMQUdfUFJFRkVSUkVEOiBTZXQgb24g
dGhlIHByZWZlcnJlZCBkaXNwbGF5IG1vZGUuCisgKi8KK3N0cnVjdCBndWRfZGlzcGxheV9tb2Rl
X3JlcSB7CisJX19sZTMyIGNsb2NrOworCV9fbGUxNiBoZGlzcGxheTsKKwlfX2xlMTYgaHN5bmNf
c3RhcnQ7CisJX19sZTE2IGhzeW5jX2VuZDsKKwlfX2xlMTYgaHRvdGFsOworCV9fbGUxNiB2ZGlz
cGxheTsKKwlfX2xlMTYgdnN5bmNfc3RhcnQ7CisJX19sZTE2IHZzeW5jX2VuZDsKKwlfX2xlMTYg
dnRvdGFsOworCV9fbGUzMiBmbGFnczsKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BI
U1lOQwkJQklUKDApCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19OSFNZTkMJCUJJVCgx
KQorI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfUFZTWU5DCQlCSVQoMikKKyNkZWZpbmUg
R1VEX0RJU1BMQVlfTU9ERV9GTEFHX05WU1lOQwkJQklUKDMpCisjZGVmaW5lIEdVRF9ESVNQTEFZ
X01PREVfRkxBR19JTlRFUkxBQ0UJCUJJVCg0KQorI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZM
QUdfREJMU0NBTgkJQklUKDUpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19DU1lOQwkJ
QklUKDYpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19QQ1NZTkMJCUJJVCg3KQorI2Rl
ZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfTkNTWU5DCQlCSVQoOCkKKyNkZWZpbmUgR1VEX0RJ
U1BMQVlfTU9ERV9GTEFHX0hTS0VXCQlCSVQoOSkKKy8qIEJDYXN0IGFuZCBQaXhlbE11bHRpcGxl
eCBhcmUgZGVwcmVjYXRlZCAqLworI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfREJMQ0xL
CQlCSVQoMTIpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19DTEtESVYyCQlCSVQoMTMp
CisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19VU0VSX01BU0sJCVwKKwkJKEdVRF9ESVNQ
TEFZX01PREVfRkxBR19QSFNZTkMgfCBHVURfRElTUExBWV9NT0RFX0ZMQUdfTkhTWU5DIHwgXAor
CQlHVURfRElTUExBWV9NT0RFX0ZMQUdfUFZTWU5DIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX05W
U1lOQyB8IFwKKwkJR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0lOVEVSTEFDRSB8IEdVRF9ESVNQTEFZ
X01PREVfRkxBR19EQkxTQ0FOIHwgXAorCQlHVURfRElTUExBWV9NT0RFX0ZMQUdfQ1NZTkMgfCBH
VURfRElTUExBWV9NT0RFX0ZMQUdfUENTWU5DIHwgXAorCQlHVURfRElTUExBWV9NT0RFX0ZMQUdf
TkNTWU5DIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0hTS0VXIHwgXAorCQlHVURfRElTUExBWV9N
T0RFX0ZMQUdfREJMQ0xLIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0NMS0RJVjIpCisvKiBJbnRl
cm5hbCBwcm90b2NvbCBmbGFncyAqLworI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfUFJF
RkVSUkVECQlCSVQoMTApCit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9jb25uZWN0
b3JfZGVzY3JpcHRvcl9yZXEgLSBDb25uZWN0b3IgZGVzY3JpcHRvcgorICogQGNvbm5lY3Rvcl90
eXBlOiBDb25uZWN0b3IgdHlwZSAoR1VEX0NPTk5FQ1RPUl9UWVBFXyopLgorICogICAgICAgICAg
ICAgICAgICBJZiB0aGUgaG9zdCBkb2Vzbid0IHN1cHBvcnQgdGhlIHR5cGUgaXQgc2hvdWxkIGZh
bGwgYmFjayB0byBQQU5FTC4KKyAqIEBmbGFnczogRmxhZ3MKKyAqICAgICAgICAgLSBQT0xMX1NU
QVRVUzogQ29ubmVjdG9yIHN0YXR1cyBjYW4gY2hhbmdlIChwb2xsZWQgZXZlcnkgMTAgc2Vjb25k
cykKKyAqICAgICAgICAgLSBJTlRFUkxBQ0U6IEludGVybGFjZWQgbW9kZXMgYXJlIHN1cHBvcnRl
ZAorICogICAgICAgICAtIERPVUJMRVNDQU46IERvdWJsZXNjYW4gbW9kZXMgYXJlIHN1cHBvcnRl
ZAorICovCitzdHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9kZXNjcmlwdG9yX3JlcSB7CisJX191OCBjb25u
ZWN0b3JfdHlwZTsKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9UWVBFX1BBTkVMCQkwCisjZGVmaW5l
IEdVRF9DT05ORUNUT1JfVFlQRV9WR0EJCQkxCisjZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9D
T01QT1NJVEUJCTIKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9UWVBFX1NWSURFTwkJMworI2RlZmlu
ZSBHVURfQ09OTkVDVE9SX1RZUEVfQ09NUE9ORU5UCQk0CisjZGVmaW5lIEdVRF9DT05ORUNUT1Jf
VFlQRV9EVkkJCQk1CisjZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9ESVNQTEFZUE9SVAkJNgor
I2RlZmluZSBHVURfQ09OTkVDVE9SX1RZUEVfSERNSQkJCTcKKwlfX2xlMzIgZmxhZ3M7CisjZGVm
aW5lIEdVRF9DT05ORUNUT1JfRkxBR1NfUE9MTF9TVEFUVVMJCUJJVCgwKQorI2RlZmluZSBHVURf
Q09OTkVDVE9SX0ZMQUdTX0lOVEVSTEFDRQkJQklUKDEpCisjZGVmaW5lIEdVRF9DT05ORUNUT1Jf
RkxBR1NfRE9VQkxFU0NBTgkJQklUKDIpCit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1
ZF9zZXRfYnVmZmVyX3JlcSAtIFNldCBidWZmZXIgdHJhbnNmZXIgaW5mbworICogQHg6IFggcG9z
aXRpb24gb2YgcmVjdGFuZ2xlCisgKiBAeTogWSBwb3NpdGlvbgorICogQHdpZHRoOiBQaXhlbCB3
aWR0aCBvZiByZWN0YW5nbGUKKyAqIEBoZWlnaHQ6IFBpeGVsIGhlaWdodAorICogQGxlbmd0aDog
QnVmZmVyIGxlbmd0aCBpbiBieXRlcworICogQGNvbXByZXNzaW9uOiBUcmFuc2ZlciBjb21wcmVz
c2lvbgorICogQGNvbXByZXNzZWRfbGVuZ3RoOiBDb21wcmVzc2VkIGJ1ZmZlciBsZW5ndGgKKyAq
CisgKiBUaGlzIHJlcXVlc3QgaXMgaXNzdWVkIHJpZ2h0IGJlZm9yZSB0aGUgYnVsayB0cmFuc2Zl
ci4KKyAqIEB4LCBAeSwgQHdpZHRoIGFuZCBAaGVpZ2h0IHNwZWNpZmllcyB0aGUgcmVjdGFuZ2xl
IHdoZXJlIHRoZSBidWZmZXIgc2hvdWxkIGJlCisgKiBwbGFjZWQgaW5zaWRlIHRoZSBmcmFtZWJ1
ZmZlci4KKyAqLworc3RydWN0IGd1ZF9zZXRfYnVmZmVyX3JlcSB7CisJX19sZTMyIHg7CisJX19s
ZTMyIHk7CisJX19sZTMyIHdpZHRoOworCV9fbGUzMiBoZWlnaHQ7CisJX19sZTMyIGxlbmd0aDsK
KwlfX3U4IGNvbXByZXNzaW9uOworCV9fbGUzMiBjb21wcmVzc2VkX2xlbmd0aDsKK30gX19wYWNr
ZWQ7CisKKy8qCisgKiBzdHJ1Y3QgZ3VkX3N0YXRlX3JlcSAtIERpc3BsYXkgc3RhdGUKKyAqIEBt
b2RlOiBEaXNwbGF5IG1vZGUKKyAqIEBmb3JtYXQ6IFBpeGVsIGZvcm1hdCBHVURfUElYRUxfRk9S
TUFUXyoKKyAqIEBjb25uZWN0b3I6IENvbm5lY3RvciBpbmRleAorICogQHByb3BlcnRpZXM6IEFy
cmF5IG9mIHByb3BlcnRpZXMKKyAqCisgKiBUaGUgZW50aXJlIHN0YXRlIGlzIHRyYW5zZmVycmVk
IGVhY2ggdGltZSB0aGVyZSdzIGEgY2hhbmdlLgorICovCitzdHJ1Y3QgZ3VkX3N0YXRlX3JlcSB7
CisJc3RydWN0IGd1ZF9kaXNwbGF5X21vZGVfcmVxIG1vZGU7CisJX191OCBmb3JtYXQ7CisJX191
OCBjb25uZWN0b3I7CisJc3RydWN0IGd1ZF9wcm9wZXJ0eV9yZXEgcHJvcGVydGllc1tdOworfSBf
X3BhY2tlZDsKKworLyogTGlzdCBvZiBzdXBwb3J0ZWQgY29ubmVjdG9yIHByb3BlcnRpZXM6ICov
CisKKy8qIE1hcmdpbnMgaW4gcGl4ZWxzIHRvIGRlYWwgd2l0aCBvdmVyc2NhbiwgcmFuZ2UgMC0x
MDAgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0xFRlRfTUFSR0lOCQkJMQorI2RlZmluZSBH
VURfUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOCQkJMgorI2RlZmluZSBHVURfUFJPUEVSVFlfVFZf
VE9QX01BUkdJTgkJCTMKKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0JPVFRPTV9NQVJHSU4JCQk0
CisjZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9NT0RFCQkJCTUKKy8qIEJyaWdodG5lc3MgaW4gcGVy
Y2VudCwgcmFuZ2UgMC0xMDAgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0JSSUdIVE5FU1MJ
CQk2CisvKiBDb250cmFzdCBpbiBwZXJjZW50LCByYW5nZSAwLTEwMCAqLworI2RlZmluZSBHVURf
UFJPUEVSVFlfVFZfQ09OVFJBU1QJCQk3CisvKiBGbGlja2VyIHJlZHVjdGlvbiBpbiBwZXJjZW50
LCByYW5nZSAwLTEwMCAqLworI2RlZmluZSBHVURfUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJ
T04JCTgKKy8qIE92ZXJzY2FuIGluIHBlcmNlbnQsIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdV
RF9QUk9QRVJUWV9UVl9PVkVSU0NBTgkJCTkKKy8qIFNhdHVyYXRpb24gaW4gcGVyY2VudCwgcmFu
Z2UgMC0xMDAgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX1NBVFVSQVRJT04JCQkxMAorLyog
SHVlIGluIHBlcmNlbnQsIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9I
VUUJCQkJMTEKKworLyoKKyAqIEJhY2tsaWdodCBicmlnaHRuZXNzIGlzIGluIHRoZSByYW5nZSAw
LTEwMCBpbmNsdXNpdmUuIFRoZSB2YWx1ZSByZXByZXNlbnRzIHRoZSBodW1hbiBwZXJjZXB0dWFs
CisgKiBicmlnaHRuZXNzIGFuZCBub3QgYSBsaW5lYXIgUFdNIHZhbHVlLiAwIGlzIG1pbmltdW0g
YnJpZ2h0bmVzcyB3aGljaCBzaG91bGQgbm90IHR1cm4gdGhlCisgKiBiYWNrbGlnaHQgY29tcGxl
dGVseSBvZmYuIFRoZSBEUE1TIGNvbm5lY3RvciBwcm9wZXJ0eSBzaG91bGQgYmUgdXNlZCB0byBj
b250cm9sIHBvd2VyIHdoaWNoIHdpbGwKKyAqIHRyaWdnZXIgYSBHVURfUkVRX1NFVF9ESVNQTEFZ
X0VOQUJMRSByZXF1ZXN0LgorICoKKyAqIFRoaXMgZG9lcyBub3QgbWFwIHRvIGEgRFJNIHByb3Bl
cnR5LCBpdCBpcyB1c2VkIHdpdGggdGhlIGJhY2tsaWdodCBkZXZpY2UuCisgKi8KKyNkZWZpbmUg
R1VEX1BST1BFUlRZX0JBQ0tMSUdIVF9CUklHSFRORVNTCQkxMgorCisvKiBMaXN0IG9mIHN1cHBv
cnRlZCBwcm9wZXJ0aWVzIHRoYXQgYXJlIG5vdCBjb25uZWN0b3IgcHJvcGV0aWVzOiAqLworCisv
KgorICogUGxhbmUgcm90YXRpb24uIFNob3VsZCByZXR1cm4gdGhlIHN1cHBvcnRlZCBiaXRtYXNr
IG9uCisgKiBHVURfUkVRX0dFVF9QUk9QRVJUSUVTLiBHVURfUk9UQVRJT05fMCBpcyBtYW5kYXRv
cnkuCisgKgorICogTm90ZTogVGhpcyBpcyBub3QgZGlzcGxheSByb3RhdGlvbiBzbyA5MC8yNzAg
d2lsbCBuZWVkIHNjYWxpbmcgdG8gbWFrZSBpdCBmaXQgKHVubGVzcyBzcXVhcmVkKS4KKyAqLwor
I2RlZmluZSBHVURfUFJPUEVSVFlfUk9UQVRJT04JCQkJNTAKKyAgI2RlZmluZSBHVURfUk9UQVRJ
T05fMAkJCUJJVCgwKQorICAjZGVmaW5lIEdVRF9ST1RBVElPTl85MAkJCUJJVCgxKQorICAjZGVm
aW5lIEdVRF9ST1RBVElPTl8xODAJCQlCSVQoMikKKyAgI2RlZmluZSBHVURfUk9UQVRJT05fMjcw
CQkJQklUKDMpCisgICNkZWZpbmUgR1VEX1JPVEFUSU9OX1JFRkxFQ1RfWAkJQklUKDQpCisgICNk
ZWZpbmUgR1VEX1JPVEFUSU9OX1JFRkxFQ1RfWQkJQklUKDUpCisgICNkZWZpbmUgR1VEX1JPVEFU
SU9OX01BU0sJCQkoR1VEX1JPVEFUSU9OXzAgfCBHVURfUk9UQVRJT05fOTAgfCBcCisJCQkJCQlH
VURfUk9UQVRJT05fMTgwIHwgR1VEX1JPVEFUSU9OXzI3MCB8IFwKKwkJCQkJCUdVRF9ST1RBVElP
Tl9SRUZMRUNUX1ggfCBHVURfUk9UQVRJT05fUkVGTEVDVF9ZKQorCisvKiBVU0IgQ29udHJvbCBy
ZXF1ZXN0czogKi8KKworLyogR2V0IHN0YXR1cyBmcm9tIHRoZSBsYXN0IEdFVC9TRVQgY29udHJv
bCByZXF1ZXN0LiBWYWx1ZSBpcyB1OC4gKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfU1RBVFVTCQkJ
CTB4MDAKKyAgLyogU3RhdHVzIHZhbHVlczogKi8KKyAgI2RlZmluZSBHVURfU1RBVFVTX09LCQkJ
CTB4MDAKKyAgI2RlZmluZSBHVURfU1RBVFVTX0JVU1kJCQkweDAxCisgICNkZWZpbmUgR1VEX1NU
QVRVU19SRVFVRVNUX05PVF9TVVBQT1JURUQJMHgwMgorICAjZGVmaW5lIEdVRF9TVEFUVVNfUFJP
VE9DT0xfRVJST1IJCTB4MDMKKyAgI2RlZmluZSBHVURfU1RBVFVTX0lOVkFMSURfUEFSQU1FVEVS
CQkweDA0CisgICNkZWZpbmUgR1VEX1NUQVRVU19FUlJPUgkJCTB4MDUKKworLyogR2V0IGRpc3Bs
YXkgZGVzY3JpcHRvciBhcyBhICZndWRfZGlzcGxheV9kZXNjcmlwdG9yX3JlcSAqLworI2RlZmlu
ZSBHVURfUkVRX0dFVF9ERVNDUklQVE9SCQkJCTB4MDEKKworLyogR2V0IHN1cHBvcnRlZCBwaXhl
bCBmb3JtYXRzIGFzIGEgYnl0ZSBhcnJheSBvZiBHVURfUElYRUxfRk9STUFUXyogKi8KKyNkZWZp
bmUgR1VEX1JFUV9HRVRfRk9STUFUUwkJCQkweDQwCisgICNkZWZpbmUgR1VEX0ZPUk1BVFNfTUFY
X05VTQkJCTMyCisgIC8qIFIxIGlzIGEgMS1iaXQgbW9ub2Nocm9tZSB0cmFuc2ZlciBmb3JtYXQg
cHJlc2VudGVkIHRvIHVzZXJzcGFjZSBhcyBYUkdCODg4OCAqLworICAjZGVmaW5lIEdVRF9QSVhF
TF9GT1JNQVRfUjEJCQkweDAxCisgICNkZWZpbmUgR1VEX1BJWEVMX0ZPUk1BVF9SR0IxMTEJCTB4
MjAKKyAgI2RlZmluZSBHVURfUElYRUxfRk9STUFUX1JHQjU2NQkJMHg0MAorICAjZGVmaW5lIEdV
RF9QSVhFTF9GT1JNQVRfWFJHQjg4ODgJCTB4ODAKKyAgI2RlZmluZSBHVURfUElYRUxfRk9STUFU
X0FSR0I4ODg4CQkweDgxCisKKy8qCisgKiBHZXQgc3VwcG9ydGVkIHByb3BlcnRpZXMgdGhhdCBh
cmUgbm90IGNvbm5lY3RvciBwcm9wZXRpZXMgYXMgYSAmZ3VkX3Byb3BlcnR5X3JlcSBhcnJheS4K
KyAqIGd1ZF9wcm9wZXJ0eV9yZXEudmFsIG9mdGVuIGNvbnRhaW5zIHRoZSBpbml0aWFsIHZhbHVl
IGZvciB0aGUgcHJvcGVydHkuCisgKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfUFJPUEVSVElFUwkJ
CQkweDQxCisgICNkZWZpbmUgR1VEX1BST1BFUlRJRVNfTUFYX05VTQkJMzIKKworLyogQ29ubmVj
dG9yIHJlcXVlc3RzIGhhdmUgdGhlIGNvbm5lY3RvciBpbmRleCBwYXNzZWQgaW4gdGhlIHdWYWx1
ZSBmaWVsZCAqLworCisvKiBHZXQgY29ubmVjdG9yIGRlc2NyaXB0b3JzIGFzIGFuIGFycmF5IG9m
ICZndWRfY29ubmVjdG9yX2Rlc2NyaXB0b3JfcmVxICovCisjZGVmaW5lIEdVRF9SRVFfR0VUX0NP
Tk5FQ1RPUlMJCQkJMHg1MAorICAjZGVmaW5lIEdVRF9DT05ORUNUT1JTX01BWF9OVU0JCTMyCisK
Ky8qCisgKiBHZXQgcHJvcGVydGllcyBzdXBwb3J0ZWQgYnkgdGhlIGNvbm5lY3RvciBhcyBhICZn
dWRfcHJvcGVydHlfcmVxIGFycmF5LgorICogZ3VkX3Byb3BlcnR5X3JlcS52YWwgb2Z0ZW4gY29u
dGFpbnMgdGhlIGluaXRpYWwgdmFsdWUgZm9yIHRoZSBwcm9wZXJ0eS4KKyAqLworI2RlZmluZSBH
VURfUkVRX0dFVF9DT05ORUNUT1JfUFJPUEVSVElFUwkJMHg1MQorICAjZGVmaW5lIEdVRF9DT05O
RUNUT1JfUFJPUEVSVElFU19NQVhfTlVNCTMyCisKKy8qCisgKiBJc3N1ZWQgd2hlbiB0aGVyZSdz
IGEgVFZfTU9ERSBwcm9wZXJ0eSBwcmVzZW50LgorICogR2V0cyBhbiBhcnJheSBvZiB0aGUgc3Vw
cG9ydGVkIFRWX01PREUgbmFtZXMgZWFjaCBlbnRyeSBvZiBsZW5ndGgKKyAqIEdVRF9DT05ORUNU
T1JfVFZfTU9ERV9OQU1FX0xFTi4gTmFtZXMgbXVzdCBiZSBOVUwtdGVybWluYXRlZC4KKyAqLwor
I2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNUT1JfVFZfTU9ERV9WQUxVRVMJCTB4NTIKKyAgI2Rl
ZmluZSBHVURfQ09OTkVDVE9SX1RWX01PREVfTkFNRV9MRU4JMTYKKyAgI2RlZmluZSBHVURfQ09O
TkVDVE9SX1RWX01PREVfTUFYX05VTQkJMTYKKworLyogV2hlbiB1c2Vyc3BhY2UgY2hlY2tzIGNv
bm5lY3RvciBzdGF0dXMsIHRoaXMgaXMgaXNzdWVkIGZpcnN0LCBub3QgdXNlZCBmb3IgcG9sbCBy
ZXF1ZXN0cy4gKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfQ09OTkVDVE9SX0ZPUkNFX0RFVEVDVAkJ
MHg1MworCisvKgorICogR2V0IGNvbm5lY3RvciBzdGF0dXMuIFZhbHVlIGlzIHU4LgorICoKKyAq
IFVzZXJzcGFjZSB3aWxsIGdldCBhIEhPVFBMVUcgdWV2ZW50IGlmIG9uZSBvZiB0aGUgZm9sbG93
aW5nIGlzIHRydWU6CisgKiAtIENvbm5lY3Rpb24gc3RhdHVzIGhhcyBjaGFuZ2VkIHNpbmNlIGxh
c3QKKyAqIC0gQ0hBTkdFRCBpcyBzZXQKKyAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNU
T1JfU1RBVFVTCQkJMHg1NAorICAjZGVmaW5lIEdVRF9DT05ORUNUT1JfU1RBVFVTX0RJU0NPTk5F
Q1RFRAkweDAwCisgICNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9TVEFUVVNfQ09OTkVDVEVECTB4MDEK
KyAgI2RlZmluZSBHVURfQ09OTkVDVE9SX1NUQVRVU19VTktOT1dOCQkweDAyCisgICNkZWZpbmUg
R1VEX0NPTk5FQ1RPUl9TVEFUVVNfQ09OTkVDVEVEX01BU0sJMHgwMworICAjZGVmaW5lIEdVRF9D
T05ORUNUT1JfU1RBVFVTX0NIQU5HRUQJCUJJVCg3KQorCisvKgorICogRGlzcGxheSBtb2RlcyBj
YW4gYmUgZmV0Y2hlZCBhcyBlaXRoZXIgRURJRCBkYXRhIG9yIGFuIGFycmF5IG9mICZndWRfZGlz
cGxheV9tb2RlX3JlcS4KKyAqCisgKiBJZiBHVURfUkVRX0dFVF9DT05ORUNUT1JfTU9ERVMgcmV0
dXJucyB6ZXJvLCBFRElEIGlzIHVzZWQgdG8gY3JlYXRlIGRpc3BsYXkgbW9kZXMuCisgKiBJZiBi
b3RoIGRpc3BsYXkgbW9kZXMgYW5kIEVESUQgYXJlIHJldHVybmVkLCBFRElEIGlzIGp1c3QgcGFz
c2VkIG9uIHRvIHVzZXJzcGFjZQorICogaW4gdGhlIEVESUQgY29ubmVjdG9yIHByb3BlcnR5Lgor
ICovCisKKy8qIEdldCAmZ3VkX2Rpc3BsYXlfbW9kZV9yZXEgYXJyYXkgb2Ygc3VwcG9ydGVkIGRp
c3BsYXkgbW9kZXMgKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX01PREVTCQkJMHg1
NQorICAjZGVmaW5lIEdVRF9DT05ORUNUT1JfTUFYX05VTV9NT0RFUwkJMTI4CisKKy8qIEdldCBF
eHRlbmRlZCBEaXNwbGF5IElkZW50aWZpY2F0aW9uIERhdGEgKi8KKyNkZWZpbmUgR1VEX1JFUV9H
RVRfQ09OTkVDVE9SX0VESUQJCQkweDU2CisgICNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9NQVhfRURJ
RF9MRU4JCTIwNDgKKworLyogU2V0IGJ1ZmZlciBwcm9wZXJ0aWVzIGJlZm9yZSBidWxrIHRyYW5z
ZmVyIGFzICZndWRfc2V0X2J1ZmZlcl9yZXEgKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfQlVGRkVS
CQkJCTB4NjAKKworLyogQ2hlY2sgZGlzcGxheSBjb25maWd1cmF0aW9uIGFzICZndWRfc3RhdGVf
cmVxICovCisjZGVmaW5lIEdVRF9SRVFfU0VUX1NUQVRFX0NIRUNLCQkJCTB4NjEKKworLyogQXBw
bHkgdGhlIHByZXZpb3VzIFNUQVRFX0NIRUNLIGNvbmZpZ3VyYXRpb24gKi8KKyNkZWZpbmUgR1VE
X1JFUV9TRVRfU1RBVEVfQ09NTUlUCQkJMHg2MgorCisvKiBFbmFibGUvZGlzYWJsZSB0aGUgZGlz
cGxheSBjb250cm9sbGVyLCB2YWx1ZSBpcyB1ODogMC8xICovCisjZGVmaW5lIEdVRF9SRVFfU0VU
X0NPTlRST0xMRVJfRU5BQkxFCQkJMHg2MworCisvKiBFbmFibGUvZGlzYWJsZSBkaXNwbGF5L291
dHB1dCAoRFBNUyksIHZhbHVlIGlzIHU4OiAwLzEgKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfRElT
UExBWV9FTkFCTEUJCQkweDY0CisKKyNlbmRpZgotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
