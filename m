Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9505397976
	for <lists+dri-devel@lfdr.de>; Wed, 21 Aug 2019 14:32:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C55966E320;
	Wed, 21 Aug 2019 12:32:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 66BAE6E316
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Aug 2019 12:32:02 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id q12so1837101wrj.12
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Aug 2019 05:32:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=UxUGbbxrsVyQ07eBAkefUI1EVjRjDsWAVX0KbzpOWig=;
 b=c+kghYL7bx2NJFMzg4k48y/tE4A6u9RuRvZbAlj+ImPcmKA9MW7LfKmZfJayDL8rYT
 kdgozKddRRHBWiCcKKlhoSYXvCQmAVIcVa5gLL7J0fkCCe7ilHXnNSKRiLA6jIbnGpeA
 tb7nG42UNYCT0XXxb/e7aJsaaIqisM0b8MAeGfZGmlisEyWNjO/ENhgexN8TXK5Sjq1L
 sWxJvZb9q25uvHc8tEbajsbkaBhyMvlX7XKrmx7rshIzGBKrli+eNkLKFtroImPUwgHz
 7VuEarcKgml/xyfDotPk2nb/qxyYjDKkIuS2yQVENv+60VwYHItcMsS4RePzwiFHr92o
 /yjA==
X-Gm-Message-State: APjAAAWlayqTNc8OBHeRCnvTuq/yKRQVFzxFRZ6Bpe+RGszoe2XoquRw
 jtOFmuiGx4QpCTyQd0a5IkGB2krA
X-Google-Smtp-Source: APXvYqyOGKA32P9a2FCSHJ/cdyfspfJ22W6OZiPp1a8+BxtgjK4MwvVnqjKR2WMVyXcq9bcPEqgiuA==
X-Received: by 2002:a5d:4cc5:: with SMTP id c5mr12795364wrt.278.1566390720116; 
 Wed, 21 Aug 2019 05:32:00 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:8189:dd33:a934:c4fa])
 by smtp.gmail.com with ESMTPSA id v3sm23084571wrq.34.2019.08.21.05.31.57
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 21 Aug 2019 05:31:58 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, chris@chris-wilson.co.uk,
 daniel.vetter@ffwll.ch, sumit.semwal@linaro.org,
 linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org
Subject: [PATCH 09/10] dma-buf/resv: replace exclusive fence with new fences
 container
Date: Wed, 21 Aug 2019 14:31:46 +0200
Message-Id: <20190821123147.110736-10-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190821123147.110736-1-christian.koenig@amd.com>
References: <20190821123147.110736-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=UxUGbbxrsVyQ07eBAkefUI1EVjRjDsWAVX0KbzpOWig=;
 b=af08BLwO83E7JdmOEyxg5WFmlICXN3aYGrFqtUOXsTWqohYCI6/pNYice5RZygmDCw
 GDQvdBb9ooPrb4Bw3v4pWlvA23AsrxmXy2cfnS9MIAuSysNJZPxyEXZd5MLISsjmAWbr
 wOb41Lszrau6xTi9oKcSj3KmYy+SrhC7w36GMH/rw/JqQn6KkGWP+XTOIy0/k/47z5RA
 VqITALB13qeus0JfaMS+KCn6QzoHC6fMGbT2ogLnRchcFwVzGNB8W2YLTBmcKuxDnso6
 A5oJ4nTxlNkRwpS9+G06D1C5s7jZ5NiL13m0xtTttNpm+qqLPcMfT6E3bxcUyDyREPWo
 VwkA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgZXhjbHVzaXZlIGZlbmNlIGltcGxlbWVudGF0aW9uIHdpdGggdGhlIG5ldyB3
cml0ZXJzIGNvbnRhaW5lcgphbmQgY2hhbmdlIGFsbCB1c2VycyBhY2NvcmRpbmdseS4KClNpZ25l
ZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0t
CiBkcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jICAgICAgICAgICAgICAgICAgICB8ICAyMCArKy0t
CiBkcml2ZXJzL2RtYS1idWYvZG1hLXJlc3YuYyAgICAgICAgICAgICAgICAgICB8IDEwNiArKysr
KysrLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1
Zi5jICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYyAg
ICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMgICAgICAgICAgICAgICAgICAg
IHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9oZWxwZXIuYyB8
ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYyAgICAgICAgfCAg
IDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5LmMgICAgIHwgIDE2
ICsrLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICAgICAgICAgfCAgIDMg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYyAgICAgIHwgICAyICst
CiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9kaXNwbGF5LmMgICAgICB8ICAgNCArLQog
ZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fc3luYy5jICAgICAgICAgfCAgIDIgKy0KIGRy
aXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3V2ZC5jICAgICAgICAgIHwgICAzICstCiBkcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jICAgICAgICAgICAgICAgICB8ICAgMiArLQogaW5jbHVk
ZS9saW51eC9kbWEtcmVzdi5oICAgICAgICAgICAgICAgICAgICAgfCAgMzMgKy0tLS0tCiAxNSBm
aWxlcyBjaGFuZ2VkLCA3OCBpbnNlcnRpb25zKCspLCAxMzIgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVm
LmMKaW5kZXggMjIwY2ZhOWNhODJiLi4zM2ZiMzYwOGU4YmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
ZG1hLWJ1Zi9kbWEtYnVmLmMKKysrIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYwpAQCAtMTk1
LDcgKzE5NSw3IEBAIHN0YXRpYyB2b2lkIGRtYV9idWZfcG9sbF9jYihzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiAKIHN0YXRpYyBfX3BvbGxfdCBkbWFf
YnVmX3BvbGwoc3RydWN0IGZpbGUgKmZpbGUsIHBvbGxfdGFibGUgKnBvbGwpCiB7Ci0Jc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2VfZXhjbCwgKnJlYWRlcnM7CisJc3RydWN0IGRtYV9mZW5jZSAqd3Jp
dGVycywgKnJlYWRlcnM7CiAJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKIAlzdHJ1Y3QgZG1hX3Jl
c3YgKnJlc3Y7CiAJX19wb2xsX3QgZXZlbnRzOwpAQCAtMjEzLDEwICsyMTMsMTAgQEAgc3RhdGlj
IF9fcG9sbF90IGRtYV9idWZfcG9sbChzdHJ1Y3QgZmlsZSAqZmlsZSwgcG9sbF90YWJsZSAqcG9s
bCkKIAkJcmV0dXJuIDA7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0JZmVuY2VfZXhjbCA9IGRtYV9m
ZW5jZV9nZXRfcmN1X3NhZmUoJnJlc3YtPmZlbmNlX2V4Y2wpOworCXdyaXRlcnMgPSBkbWFfcmVz
dl9mZW5jZXNfZ2V0X3JjdSgmcmVzdi0+d3JpdGVycyk7CiAJcmVhZGVycyA9IGRtYV9yZXN2X2Zl
bmNlc19nZXRfcmN1KCZyZXN2LT5yZWFkZXJzKTsKIAotCWlmIChmZW5jZV9leGNsICYmICghKGV2
ZW50cyAmIEVQT0xMT1VUKSB8fCAhcmVhZGVycykpIHsKKwlpZiAod3JpdGVycyAmJiAoIShldmVu
dHMgJiBFUE9MTE9VVCkgfHwgIXJlYWRlcnMpKSB7CiAJCXN0cnVjdCBkbWFfYnVmX3BvbGxfY2Jf
dCAqZGNiID0gJmRtYWJ1Zi0+Y2JfZXhjbDsKIAkJX19wb2xsX3QgcGV2ZW50cyA9IEVQT0xMSU47
CiAKQEAgLTIzMiwxNiArMjMyLDE2IEBAIHN0YXRpYyBfX3BvbGxfdCBkbWFfYnVmX3BvbGwoc3Ry
dWN0IGZpbGUgKmZpbGUsIHBvbGxfdGFibGUgKnBvbGwpCiAJCXNwaW5fdW5sb2NrX2lycSgmZG1h
YnVmLT5wb2xsLmxvY2spOwogCiAJCWlmIChldmVudHMgJiBwZXZlbnRzKSB7Ci0JCQlpZiAoIWRt
YV9mZW5jZV9hZGRfY2FsbGJhY2soZmVuY2VfZXhjbCwgJmRjYi0+Y2IsCisJCQlpZiAoIWRtYV9m
ZW5jZV9hZGRfY2FsbGJhY2sod3JpdGVycywgJmRjYi0+Y2IsCiAJCQkJCQkgICAgZG1hX2J1Zl9w
b2xsX2NiKSkgewogCQkJCWV2ZW50cyAmPSB+cGV2ZW50czsKLQkJCQlkbWFfZmVuY2VfcHV0KGZl
bmNlX2V4Y2wpOworCQkJCWRtYV9mZW5jZV9wdXQod3JpdGVycyk7CiAJCQl9IGVsc2UgewogCQkJ
CS8qCiAJCQkJICogTm8gY2FsbGJhY2sgcXVldWVkLCB3YWtlIHVwIGFueSBhZGRpdGlvbmFsCiAJ
CQkJICogd2FpdGVycy4KIAkJCQkgKi8KLQkJCQlkbWFfZmVuY2VfcHV0KGZlbmNlX2V4Y2wpOwor
CQkJCWRtYV9mZW5jZV9wdXQod3JpdGVycyk7CiAJCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZk
Y2ItPmNiKTsKIAkJCX0KIAkJfQpAQCAtMTEyMiw3ICsxMTIyLDcgQEAgc3RhdGljIGludCBkbWFf
YnVmX2RlYnVnX3Nob3coc3RydWN0IHNlcV9maWxlICpzLCB2b2lkICp1bnVzZWQpCiAJc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoX29iajsKIAlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5
X2N1cnNvciBjdXJzb3I7CiAJc3RydWN0IGRtYV9yZXN2ICpyb2JqOwotCXN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlLCAqcmVhZGVyczsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgKndyaXRlcnMs
ICpyZWFkZXJzOwogCWludCBjb3VudCA9IDAsIGF0dGFjaF9jb3VudDsKIAlzaXplX3Qgc2l6ZSA9
IDA7CiAKQEAgLTExNTQsMTAgKzExNTQsMTAgQEAgc3RhdGljIGludCBkbWFfYnVmX2RlYnVnX3No
b3coc3RydWN0IHNlcV9maWxlICpzLCB2b2lkICp1bnVzZWQpCiAKIAkJcm9iaiA9IGJ1Zl9vYmot
PnJlc3Y7CiAJCXJjdV9yZWFkX2xvY2soKTsKLQkJZmVuY2UgPSBkbWFfcmVzdl9nZXRfZXhjbChy
b2JqKTsKKwkJd3JpdGVycyA9IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZyb2JqLT53cml0ZXJz
KTsKIAkJcmVhZGVycyA9IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZyb2JqLT5yZWFkZXJzKTsK
LQkJaWYgKGZlbmNlKQotCQkJc2VxX3ByaW50ZihzLCAiXHRFeGNsdXNpdmUgZmVuY2U6ICVzICVz
ICVzc2lnbmFsbGVkXG4iLAorCQlkbWFfZmVuY2VfYXJyYXlfZm9yX2VhY2goZmVuY2UsIGN1cnNv
ciwgd3JpdGVycykKKwkJCXNlcV9wcmludGYocywgIlx0V3JpdGVycyBmZW5jZTogJXMgJXMgJXNz
aWduYWxsZWRcbiIsCiAJCQkJICAgZmVuY2UtPm9wcy0+Z2V0X2RyaXZlcl9uYW1lKGZlbmNlKSwK
IAkJCQkgICBmZW5jZS0+b3BzLT5nZXRfdGltZWxpbmVfbmFtZShmZW5jZSksCiAJCQkJICAgZG1h
X2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSA/ICIiIDogInVuIik7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2RtYS1idWYvZG1hLXJlc3YuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jCmluZGV4
IDg3MjNhZjBhN2E0ZC4uOGVmN2RiYzdmZDhlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYv
ZG1hLXJlc3YuYworKysgYi9kcml2ZXJzL2RtYS1idWYvZG1hLXJlc3YuYwpAQCAtMzksMjIgKzM5
LDE2IEBACiAvKioKICAqIERPQzogUmVzZXJ2YXRpb24gT2JqZWN0IE92ZXJ2aWV3CiAgKgotICog
VGhlIHJlc2VydmF0aW9uIG9iamVjdCBwcm92aWRlcyBhIG1lY2hhbmlzbSB0byBtYW5hZ2UgcmVh
ZGVycyBhbmQKLSAqIGV4Y2x1c2l2ZSBmZW5jZXMgYXNzb2NpYXRlZCB3aXRoIGEgYnVmZmVyLiAg
QSByZXNlcnZhdGlvbiBvYmplY3QKLSAqIGNhbiBoYXZlIGF0dGFjaGVkIG9uZSBleGNsdXNpdmUg
ZmVuY2UgKG5vcm1hbGx5IGFzc29jaWF0ZWQgd2l0aAotICogd3JpdGUgb3BlcmF0aW9ucykgb3Ig
TiByZWFkIGZlbmNlcy4gIFRoZSBSQ1UgbWVjaGFuaXNtIGlzIHVzZWQgdG8KLSAqIHByb3RlY3Qg
cmVhZCBhY2Nlc3MgdG8gZmVuY2VzIGZyb20gbG9ja2VkIHdyaXRlLXNpZGUgdXBkYXRlcy4KKyAq
IFRoZSByZXNlcnZhdGlvbiBvYmplY3QgcHJvdmlkZXMgYSBtZWNoYW5pc20gdG8gbWFuYWdlIHJl
YWRlcnMgYW5kIHdyaXRlcnMKKyAqIGFzc29jaWF0ZWQgd2l0aCBhIGJ1ZmZlci4gQSByZXNlcnZh
dGlvbiBvYmplY3QgY2FuIGhhdmUgYXR0YWNoZWQgYW55IG51bWJlcgorICogb2YgcmVhZCBhbmQg
d3JpdGVyIG9wZXJhdGlvbiBpbiB0aGUgZm9ybSBvZiBkbWFfZmVuY2Ugb2JqZWN0cy4gVGhlIFJD
VQorICogbWVjaGFuaXNtIGlzIHVzZWQgdG8gcHJvdGVjdCByZWFkIGFjY2VzcyB0byBmZW5jZXMg
ZnJvbSBsb2NrZWQgd3JpdGUtc2lkZQorICogdXBkYXRlcy4KICAqLwogCiBERUZJTkVfV0RfQ0xB
U1MocmVzZXJ2YXRpb25fd3dfY2xhc3MpOwogRVhQT1JUX1NZTUJPTChyZXNlcnZhdGlvbl93d19j
bGFzcyk7CiAKLXN0cnVjdCBsb2NrX2NsYXNzX2tleSByZXNlcnZhdGlvbl9zZXFjb3VudF9jbGFz
czsKLUVYUE9SVF9TWU1CT0wocmVzZXJ2YXRpb25fc2VxY291bnRfY2xhc3MpOwotCi1jb25zdCBj
aGFyIHJlc2VydmF0aW9uX3NlcWNvdW50X3N0cmluZ1tdID0gInJlc2VydmF0aW9uX3NlcWNvdW50
IjsKLUVYUE9SVF9TWU1CT0wocmVzZXJ2YXRpb25fc2VxY291bnRfc3RyaW5nKTsKLQogc3RhdGlj
IHZvaWQgZG1hX3Jlc3ZfZmVuY2VzX2luaXQoc3RydWN0IGRtYV9yZXN2X2ZlbmNlcyAqZmVuY2Vz
KQogewogCVJDVV9JTklUX1BPSU5URVIoZmVuY2VzLT5mZW5jZSwgTlVMTCk7CkBAIC0yODQsOSAr
Mjc4LDcgQEAgdm9pZCBkbWFfcmVzdl9pbml0KHN0cnVjdCBkbWFfcmVzdiAqb2JqKQogewogCXd3
X211dGV4X2luaXQoJm9iai0+bG9jaywgJnJlc2VydmF0aW9uX3d3X2NsYXNzKTsKIAotCV9fc2Vx
Y291bnRfaW5pdCgmb2JqLT5zZXEsIHJlc2VydmF0aW9uX3NlcWNvdW50X3N0cmluZywKLQkJCSZy
ZXNlcnZhdGlvbl9zZXFjb3VudF9jbGFzcyk7Ci0JUkNVX0lOSVRfUE9JTlRFUihvYmotPmZlbmNl
X2V4Y2wsIE5VTEwpOworCWRtYV9yZXN2X2ZlbmNlc19pbml0KCZvYmotPndyaXRlcnMpOwogCWRt
YV9yZXN2X2ZlbmNlc19pbml0KCZvYmotPnJlYWRlcnMpOwogfQogRVhQT1JUX1NZTUJPTChkbWFf
cmVzdl9pbml0KTsKQEAgLTMwMSw3ICsyOTMsNyBAQCB2b2lkIGRtYV9yZXN2X2Zpbmkoc3RydWN0
IGRtYV9yZXN2ICpvYmopCiAJICogVGhpcyBvYmplY3Qgc2hvdWxkIGJlIGRlYWQgYW5kIGFsbCBy
ZWZlcmVuY2VzIG11c3QgaGF2ZQogCSAqIGJlZW4gcmVsZWFzZWQgdG8gaXQsIHNvIG5vIG5lZWQg
dG8gYmUgcHJvdGVjdGVkIHdpdGggcmN1LgogCSAqLwotCWRtYV9mZW5jZV9wdXQocmN1X2RlcmVm
ZXJlbmNlX3Byb3RlY3RlZChvYmotPmZlbmNlX2V4Y2wsIHRydWUpKTsKKwlkbWFfcmVzdl9mZW5j
ZXNfZmluaSgmb2JqLT53cml0ZXJzKTsKIAlkbWFfcmVzdl9mZW5jZXNfZmluaSgmb2JqLT5yZWFk
ZXJzKTsKIAl3d19tdXRleF9kZXN0cm95KCZvYmotPmxvY2spOwogfQpAQCAtMzEyLDI1ICszMDQs
MTQgQEAgRVhQT1JUX1NZTUJPTChkbWFfcmVzdl9maW5pKTsKICAqIEBvYmo6IHRoZSByZXNlcnZh
dGlvbiBvYmplY3QKICAqIEBmZW5jZTogdGhlIHNoYXJlZCBmZW5jZSB0byBhZGQKICAqCi0gKiBB
ZGQgYSBmZW5jZSB0byB0aGUgZXhjbHVzaXZlIHNsb3QuICBUaGUgb2JqLT5sb2NrIG11c3QgYmUg
aGVsZC4KKyAqIEFkZCBhIGZlbmNlIHRvIHRoZSBleGNsdXNpdmUgc2xvdHMuICBUaGUgb2JqLT5s
b2NrIG11c3QgYmUgaGVsZC4KICAqLwogdm9pZCBkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZShzdHJ1
Y3QgZG1hX3Jlc3YgKm9iaiwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7Ci0Jc3RydWN0IGRt
YV9mZW5jZSAqb2xkX2ZlbmNlID0gZG1hX3Jlc3ZfZ2V0X2V4Y2wob2JqKTsKLQogCWRtYV9yZXN2
X2Fzc2VydF9oZWxkKG9iaik7CiAKLQlkbWFfZmVuY2VfZ2V0KGZlbmNlKTsKLQotCXByZWVtcHRf
ZGlzYWJsZSgpOwotCXdyaXRlX3NlcWNvdW50X2JlZ2luKCZvYmotPnNlcSk7Ci0JLyogd3JpdGVf
c2VxY291bnRfYmVnaW4gcHJvdmlkZXMgdGhlIG5lY2Vzc2FyeSBtZW1vcnkgYmFycmllciAqLwot
CVJDVV9JTklUX1BPSU5URVIob2JqLT5mZW5jZV9leGNsLCBmZW5jZSk7CisJZG1hX3Jlc3ZfZmVu
Y2VzX3NldChvYmosICZvYmotPndyaXRlcnMsIGZlbmNlKTsKIAlkbWFfcmVzdl9mZW5jZXNfc2V0
KG9iaiwgJm9iai0+cmVhZGVycywgZmVuY2UpOwotCXdyaXRlX3NlcWNvdW50X2VuZCgmb2JqLT5z
ZXEpOwotCXByZWVtcHRfZW5hYmxlKCk7Ci0KLQlkbWFfZmVuY2VfcHV0KG9sZF9mZW5jZSk7CiB9
CiBFWFBPUlRfU1lNQk9MKGRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKTsKIApAQCAtMzQ2LDExICsz
MjcsOSBAQCB2b2lkIGRtYV9yZXN2X3BydW5lX2ZlbmNlcyhzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikK
IAogCWRtYV9yZXN2X2Fzc2VydF9oZWxkKG9iaik7CiAKLQlmZW5jZSA9IGRtYV9yZXN2X2dldF9l
eGNsKG9iaik7Ci0JaWYgKGRtYV9mZW5jZV9pc19zaWduYWxlZChmZW5jZSkpIHsKLQkJUkNVX0lO
SVRfUE9JTlRFUihvYmotPmZlbmNlX2V4Y2wsIE5VTEwpOwotCQlkbWFfZmVuY2VfcHV0KGZlbmNl
KTsKLQl9CisJZmVuY2UgPSBkbWFfcmVzdl9mZW5jZXNfZGVyZWYob2JqLCAmb2JqLT53cml0ZXJz
KTsKKwlpZiAoZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkKKwkJZG1hX3Jlc3ZfZmVuY2Vz
X3NldChvYmosICZvYmotPndyaXRlcnMsIE5VTEwpOwogCiAJZmVuY2UgPSBkbWFfcmVzdl9mZW5j
ZXNfZGVyZWYob2JqLCAmb2JqLT5yZWFkZXJzKTsKIAlpZiAoZG1hX2ZlbmNlX2lzX3NpZ25hbGVk
KGZlbmNlKSkKQEAgLTM2NywzNiArMzQ2LDI3IEBAIEVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfcHJ1
bmVfZmVuY2VzKTsKICovCiBpbnQgZG1hX3Jlc3ZfY29weV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2
ICpkc3QsIHN0cnVjdCBkbWFfcmVzdiAqc3JjKQogewotCXN0cnVjdCBkbWFfZmVuY2UgKm9sZCwg
KmV4Y2wsICpyZWFkZXJzOworCXN0cnVjdCBkbWFfZmVuY2UgKndyaXRlcnMsICpyZWFkZXJzOwog
CiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQoZHN0KTsKIAogCXJjdV9yZWFkX2xvY2soKTsKLQlleGNs
ID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmc3JjLT5mZW5jZV9leGNsKTsKKwl3cml0ZXJzID0g
ZG1hX3Jlc3ZfZmVuY2VzX2dldF9yY3UoJnNyYy0+d3JpdGVycyk7CiAJcmVhZGVycyA9IGRtYV9y
ZXN2X2ZlbmNlc19nZXRfcmN1KCZzcmMtPnJlYWRlcnMpOwogCXJjdV9yZWFkX3VubG9jaygpOwog
Ci0Jb2xkID0gZG1hX3Jlc3ZfZ2V0X2V4Y2woZHN0KTsKLQotCXByZWVtcHRfZGlzYWJsZSgpOwot
CXdyaXRlX3NlcWNvdW50X2JlZ2luKCZkc3QtPnNlcSk7Ci0JLyogd3JpdGVfc2VxY291bnRfYmVn
aW4gcHJvdmlkZXMgdGhlIG5lY2Vzc2FyeSBtZW1vcnkgYmFycmllciAqLwotCVJDVV9JTklUX1BP
SU5URVIoZHN0LT5mZW5jZV9leGNsLCBleGNsKTsKKwlkbWFfcmVzdl9mZW5jZXNfc2V0KGRzdCwg
JmRzdC0+d3JpdGVycywgd3JpdGVycyk7CiAJZG1hX3Jlc3ZfZmVuY2VzX3NldChkc3QsICZkc3Qt
PnJlYWRlcnMsIHJlYWRlcnMpOwotCXdyaXRlX3NlcWNvdW50X2VuZCgmZHN0LT5zZXEpOwotCXBy
ZWVtcHRfZW5hYmxlKCk7Ci0KLQlkbWFfZmVuY2VfcHV0KG9sZCk7CiAKIAlyZXR1cm4gMDsKIH0K
IEVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfY29weV9mZW5jZXMpOwogCiAvKioKLSAqIGRtYV9yZXN2
X2dldF9mZW5jZXNfcmN1IC0gR2V0IGFuIG9iamVjdCdzIHJlYWRlcnMgYW5kIGV4Y2x1c2l2ZQor
ICogZG1hX3Jlc3ZfZ2V0X2ZlbmNlc19yY3UgLSBHZXQgYW4gb2JqZWN0J3MgcmVhZGVycyBhbmQg
d3JpdGVycwogICogZmVuY2VzIHdpdGhvdXQgdXBkYXRlIHNpZGUgbG9jayBoZWxkCiAgKiBAb2Jq
OiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0Ci0gKiBAcGZlbmNlX2V4Y2w6IHRoZSByZXR1cm5lZCBl
eGNsdXNpdmUgZmVuY2UgKG9yIE5VTEwpCisgKiBAcGZlbmNlX2V4Y2w6IHRoZSByZXR1cm5lZCB3
cml0ZXJzIChvciBOVUxMKQogICogQHBzaGFyZWRfY291bnQ6IHRoZSBudW1iZXIgb2Ygc2hhcmVk
IGZlbmNlcyByZXR1cm5lZAogICogQHBzaGFyZWQ6IHRoZSBhcnJheSBvZiBzaGFyZWQgZmVuY2Ug
cHRycyByZXR1cm5lZCAoYXJyYXkgaXMga3JlYWxsb2MnZCB0bwogICogdGhlIHJlcXVpcmVkIHNp
emUsIGFuZCBtdXN0IGJlIGZyZWVkIGJ5IGNhbGxlcikKQEAgLTQwNCwzMCArMzc0LDMyIEBAIEVY
UE9SVF9TWU1CT0woZG1hX3Jlc3ZfY29weV9mZW5jZXMpOwogICogUmV0cmlldmUgYWxsIGZlbmNl
cyBmcm9tIHRoZSByZXNlcnZhdGlvbiBvYmplY3QuIElmIHRoZSBwb2ludGVyIGZvciB0aGUKICAq
IGV4Y2x1c2l2ZSBmZW5jZSBpcyBub3Qgc3BlY2lmaWVkIHRoZSBmZW5jZSBpcyBwdXQgaW50byB0
aGUgYXJyYXkgb2YgdGhlCiAgKiBzaGFyZWQgZmVuY2VzIGFzIHdlbGwuIFJldHVybnMgZWl0aGVy
IHplcm8gb3IgLUVOT01FTS4KKyAqCisgKiBUT0RPOiBEZXByZWNhdGVkIGFuZCBzaG91bGRuJ3Qg
YmUgdXNlZCBhbnkgbW9yZS4KICAqLwogaW50IGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1KHN0cnVj
dCBkbWFfcmVzdiAqb2JqLAogCQkJICAgIHN0cnVjdCBkbWFfZmVuY2UgKipwZmVuY2VfZXhjbCwK
IAkJCSAgICB1bnNpZ25lZCAqcHNoYXJlZF9jb3VudCwKIAkJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNl
ICoqKnBzaGFyZWQpCiB7Ci0Jc3RydWN0IGRtYV9mZW5jZSAqZXhjbCwgKnJlYWRlcnM7CisJc3Ry
dWN0IGRtYV9mZW5jZSAqd3JpdGVycywgKnJlYWRlcnM7CiAJc3RydWN0IGRtYV9mZW5jZSAqKnNo
YXJlZDsKIAl1bnNpZ25lZCBpbnQgc2hhcmVkX2NvdW50OwogCiAJcmN1X3JlYWRfbG9jaygpOwot
CWV4Y2wgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZvYmotPmZlbmNlX2V4Y2wpOworCXdyaXRl
cnMgPSBkbWFfcmVzdl9mZW5jZXNfZ2V0X3JjdSgmb2JqLT53cml0ZXJzKTsKIAlyZWFkZXJzID0g
ZG1hX3Jlc3ZfZmVuY2VzX2dldF9yY3UoJm9iai0+cmVhZGVycyk7CiAJcmN1X3JlYWRfdW5sb2Nr
KCk7CiAKIAlzaGFyZWRfY291bnQgPSByZWFkZXJzID8gMSA6IDA7Ci0JaWYgKGV4Y2wgJiYgIXBm
ZW5jZV9leGNsKQorCWlmICh3cml0ZXJzICYmICFwZmVuY2VfZXhjbCkKIAkJKytzaGFyZWRfY291
bnQ7CiAKIAlpZiAoc2hhcmVkX2NvdW50KSB7CiAJCXNoYXJlZCA9IGttYWxsb2NfYXJyYXkoc2hh
cmVkX2NvdW50LCBzaXplb2YoKnNoYXJlZCksCiAJCQkJICAgICAgIEdGUF9LRVJORUwpOwogCQlp
ZiAoIXNoYXJlZCkgewotCQkJZG1hX2ZlbmNlX3B1dChleGNsKTsKKwkJCWRtYV9mZW5jZV9wdXQo
d3JpdGVycyk7CiAJCQlkbWFfZmVuY2VfcHV0KHJlYWRlcnMpOwogCQkJcmV0dXJuIC1FTk9NRU07
CiAJCX0KQEAgLTQzNSw4ICs0MDcsOCBAQCBpbnQgZG1hX3Jlc3ZfZ2V0X2ZlbmNlc19yY3Uoc3Ry
dWN0IGRtYV9yZXN2ICpvYmosCiAJCXNoYXJlZF9jb3VudCA9IDA7CiAJCWlmIChyZWFkZXJzKQog
CQkJc2hhcmVkW3NoYXJlZF9jb3VudCsrXSA9IHJlYWRlcnM7Ci0JCWlmIChleGNsICYmICFwZmVu
Y2VfZXhjbCkKLQkJCXNoYXJlZFtzaGFyZWRfY291bnQrK10gPSBleGNsOworCQlpZiAod3JpdGVy
cyAmJiAhcGZlbmNlX2V4Y2wpCisJCQlzaGFyZWRbc2hhcmVkX2NvdW50KytdID0gd3JpdGVyczsK
IAogCQkqcHNoYXJlZCA9IHNoYXJlZDsKIAkJKnBzaGFyZWRfY291bnQgPSBzaGFyZWRfY291bnQ7
CkBAIC00NDYsNyArNDE4LDcgQEAgaW50IGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1KHN0cnVjdCBk
bWFfcmVzdiAqb2JqLAogCX0KIAogCWlmIChwZmVuY2VfZXhjbCkKLQkJKnBmZW5jZV9leGNsID0g
ZXhjbDsKKwkJKnBmZW5jZV9leGNsID0gd3JpdGVyczsKIAogCXJldHVybiAwOwogfQpAQCAtNDU0
LDkgKzQyNiw5IEBAIEVYUE9SVF9TWU1CT0xfR1BMKGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1KTsK
IAogLyoqCiAgKiBkbWFfcmVzdl93YWl0X3RpbWVvdXRfcmN1IC0gV2FpdCBvbiByZXNlcnZhdGlv
bidzIG9iamVjdHMKLSAqIHJlYWRlcnMgYW5kL29yIGV4Y2x1c2l2ZSBmZW5jZXMuCisgKiByZWFk
ZXJzIGFuZC9vciB3cml0ZXJzLgogICogQG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdAotICog
QHdhaXRfYWxsOiBpZiB0cnVlLCB3YWl0IG9uIGFsbCBmZW5jZXMsIGVsc2Ugd2FpdCBvbiBqdXN0
IGV4Y2x1c2l2ZSBmZW5jZQorICogQHdhaXRfYWxsOiBpZiB0cnVlLCB3YWl0IG9uIGFsbCBmZW5j
ZXMsIGVsc2Ugd2FpdCBvbiBqdXN0IHdyaXRlcnMKICAqIEBpbnRyOiBpZiB0cnVlLCBkbyBpbnRl
cnJ1cHRpYmxlIHdhaXQKICAqIEB0aW1lb3V0OiB0aW1lb3V0IHZhbHVlIGluIGppZmZpZXMgb3Ig
emVybyB0byByZXR1cm4gaW1tZWRpYXRlbHkKICAqCkBAIC00NjgsMTEgKzQ0MCwxMSBAQCBsb25n
IGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosCiAJCQkgICAg
ICAgYm9vbCB3YWl0X2FsbCwgYm9vbCBpbnRyLAogCQkJICAgICAgIHVuc2lnbmVkIGxvbmcgdGlt
ZW91dCkKIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpleGNsLCAqcmVhZGVyczsKKwlzdHJ1Y3QgZG1h
X2ZlbmNlICp3cml0ZXJzLCAqcmVhZGVyczsKIAlsb25nIHJldCA9IHRpbWVvdXQgPyB0aW1lb3V0
IDogMTsKIAogCXJjdV9yZWFkX2xvY2soKTsKLQlleGNsID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2Fm
ZSgmb2JqLT5mZW5jZV9leGNsKTsKKwl3cml0ZXJzID0gZG1hX3Jlc3ZfZmVuY2VzX2dldF9yY3Uo
Jm9iai0+d3JpdGVycyk7CiAJcmVhZGVycyA9IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmot
PnJlYWRlcnMpOwogCXJjdV9yZWFkX3VubG9jaygpOwogCkBAIC00ODIsMTEgKzQ1NCwxMSBAQCBs
b25nIGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosCiAJCQln
b3RvIG91dDsKIAl9CiAKLQlpZiAoZXhjbCkKLQkJcmV0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91
dChleGNsLCBpbnRyLCByZXQpOworCWlmICh3cml0ZXJzKQorCQlyZXQgPSBkbWFfZmVuY2Vfd2Fp
dF90aW1lb3V0KHdyaXRlcnMsIGludHIsIHJldCk7CiAKIG91dDoKLQlkbWFfZmVuY2VfcHV0KGV4
Y2wpOworCWRtYV9mZW5jZV9wdXQod3JpdGVycyk7CiAJZG1hX2ZlbmNlX3B1dChyZWFkZXJzKTsK
IAlyZXR1cm4gcmV0OwogfQpAQCAtNDk2LDcgKzQ2OCw3IEBAIEVYUE9SVF9TWU1CT0xfR1BMKGRt
YV9yZXN2X3dhaXRfdGltZW91dF9yY3UpOwogICogZG1hX3Jlc3ZfdGVzdF9zaWduYWxlZF9yY3Ug
LSBUZXN0IGlmIGEgcmVzZXJ2YXRpb24gb2JqZWN0J3MKICAqIGZlbmNlcyBoYXZlIGJlZW4gc2ln
bmFsZWQuCiAgKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0Ci0gKiBAdGVzdF9hbGw6IGlm
IHRydWUsIHRlc3QgYWxsIGZlbmNlcywgb3RoZXJ3aXNlIG9ubHkgdGVzdCB0aGUgZXhjbHVzaXZl
CisgKiBAdGVzdF9hbGw6IGlmIHRydWUsIHRlc3QgYWxsIGZlbmNlcywgb3RoZXJ3aXNlIG9ubHkg
dGVzdCB0aGUgd3JpdGVycwogICogZmVuY2UKICAqCiAgKiBSRVRVUk5TCkBAIC01MDQsMjEgKzQ3
NiwyMSBAQCBFWFBPUlRfU1lNQk9MX0dQTChkbWFfcmVzdl93YWl0X3RpbWVvdXRfcmN1KTsKICAq
LwogYm9vbCBkbWFfcmVzdl90ZXN0X3NpZ25hbGVkX3JjdShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwg
Ym9vbCB0ZXN0X2FsbCkKIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpleGNsLCAqcmVhZGVyczsKKwlz
dHJ1Y3QgZG1hX2ZlbmNlICp3cml0ZXJzLCAqcmVhZGVyczsKIAlib29sIHJldCA9IHRydWU7CiAK
IAlyY3VfcmVhZF9sb2NrKCk7Ci0JZXhjbCA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+
ZmVuY2VfZXhjbCk7CisJd3JpdGVycyA9IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmotPndy
aXRlcnMpOwogCXJlYWRlcnMgPSBkbWFfcmVzdl9mZW5jZXNfZ2V0X3JjdSgmb2JqLT5yZWFkZXJz
KTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCWlmIChleGNsKQotCQlyZXQgPSBkbWFfZmVuY2Vf
aXNfc2lnbmFsZWQoZXhjbCk7CisJaWYgKHdyaXRlcnMpCisJCXJldCA9IGRtYV9mZW5jZV9pc19z
aWduYWxlZCh3cml0ZXJzKTsKIAogCWlmICh0ZXN0X2FsbCAmJiByZWFkZXJzKQogCQlyZXQgJj0g
ZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKHJlYWRlcnMpOwogCi0JZG1hX2ZlbmNlX3B1dChleGNsKTsK
KwlkbWFfZmVuY2VfcHV0KHdyaXRlcnMpOwogCWRtYV9mZW5jZV9wdXQocmVhZGVycyk7CiAKIAly
ZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2RtYV9idWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMK
aW5kZXggM2U0Njg1NTY1ZjgyLi5mZGUzYWExYWQ3NmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwpAQCAtMTQxLDcgKzE0MSw3IEBAIF9fZG1hX3Jlc3Zf
bWFrZV9leGNsdXNpdmUoc3RydWN0IGRtYV9yZXN2ICpvYmopCiB7CiAJc3RydWN0IGRtYV9mZW5j
ZSAqcmVhZGVycyA9IGRtYV9mZW5jZV9nZXRfcmN1KG9iai0+cmVhZGVycy5mZW5jZSk7CiAKLQlk
bWFfcmVzdl9hZGRfZXhjbF9mZW5jZShvYmosIHJlYWRlcnMpOworCWRtYV9yZXN2X2ZlbmNlc19z
ZXQob2JqLCAmb2JqLT53cml0ZXJzLCByZWFkZXJzKTsKIAlkbWFfZmVuY2VfcHV0KHJlYWRlcnMp
OwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfc3luYy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYwpp
bmRleCBmOGJjNWJhZjBhNDQuLjdiYTg0ODk3ZDUyZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3N5bmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfc3luYy5jCkBAIC0yMDQsNyArMjA0LDcgQEAgaW50IGFtZGdwdV9zeW5jX3Jl
c3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJCXJldHVybiAtRUlOVkFMOwogCiAJLyog
YWx3YXlzIHN5bmMgdG8gdGhlIGV4Y2x1c2l2ZSBmZW5jZSAqLwotCWYgPSBkbWFfcmVzdl9nZXRf
ZXhjbChyZXN2KTsKKwlmID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKHJlc3YsICZyZXN2LT53cml0
ZXJzKTsKIAlyID0gYW1kZ3B1X3N5bmNfZmVuY2UoYWRldiwgc3luYywgZiwgZmFsc2UpOwogCWlm
IChyKQogCQlyZXR1cm4gcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCmluZGV4IDY4NTRmNTg2N2Q1MS4uMjEzNDEwZjhh
ZjZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtLmMKQEAgLTE0MTIsMTQgKzE0MTIsMTMgQEAgaW50IGRybV9nZW1fZmVu
Y2VfYXJyYXlfYWRkX2ltcGxpY2l0KHN0cnVjdCB4YXJyYXkgKmZlbmNlX2FycmF5LAogCXVuc2ln
bmVkIGludCBpLCBmZW5jZV9jb3VudDsKIAogCWlmICghd3JpdGUpIHsKLQkJc3RydWN0IGRtYV9m
ZW5jZSAqZmVuY2UgPQotCQkJZG1hX3Jlc3ZfZ2V0X2V4Y2xfcmN1KG9iai0+cmVzdik7CisJCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCisJCWZlbmNlID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVm
KG9iai0+cmVzdiwgJm9iai0+cmVzdi0+d3JpdGVycyk7CiAJCXJldHVybiBkcm1fZ2VtX2ZlbmNl
X2FycmF5X2FkZChmZW5jZV9hcnJheSwgZmVuY2UpOwogCX0KIAotCXJldCA9IGRtYV9yZXN2X2dl
dF9mZW5jZXNfcmN1KG9iai0+cmVzdiwgTlVMTCwKLQkJCQkJCSZmZW5jZV9jb3VudCwgJmZlbmNl
cyk7CisJcmV0ID0gZG1hX3Jlc3ZfZ2V0X2ZlbmNlc19yY3Uob2JqLT5yZXN2LCBOVUxMLCAmZmVu
Y2VfY291bnQsICZmZW5jZXMpOwogCWlmIChyZXQgfHwgIWZlbmNlX2NvdW50KQogCQlyZXR1cm4g
cmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9o
ZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5jCmlu
ZGV4IGI5YmNkMzEwY2EyZC4uNzJhZjM1NDdkMmUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJt
X2dlbV9mcmFtZWJ1ZmZlcl9oZWxwZXIuYwpAQCAtMjk0LDcgKzI5NCw3IEBAIGludCBkcm1fZ2Vt
X2ZiX3ByZXBhcmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCXJldHVybiAwOwogCiAJ
b2JqID0gZHJtX2dlbV9mYl9nZXRfb2JqKHN0YXRlLT5mYiwgMCk7Ci0JZmVuY2UgPSBkbWFfcmVz
dl9nZXRfZXhjbF9yY3Uob2JqLT5yZXN2KTsKKwlmZW5jZSA9IGRtYV9yZXN2X2ZlbmNlc19nZXRf
cmN1KCZvYmotPnJlc3YtPndyaXRlcnMpOwogCWRybV9hdG9taWNfc2V0X2ZlbmNlX2Zvcl9wbGFu
ZShzdGF0ZSwgZmVuY2UpOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vZXRuYXZpdi9ldG5hdml2X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZp
dl9nZW0uYwppbmRleCAxNWYzNmNjZDZlNTMuLmRmNjQ1MmY5MDU3NiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X2dlbS5jCkBAIC00NjAsOSArNDYwLDkgQEAgc3RhdGljIHZvaWQgZXRu
YXZpdl9nZW1fZGVzY3JpYmVfZmVuY2Uoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCiBzdGF0aWMg
dm9pZCBldG5hdml2X2dlbV9kZXNjcmliZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3Ry
dWN0IHNlcV9maWxlICptKQogewogCXN0cnVjdCBldG5hdml2X2dlbV9vYmplY3QgKmV0bmF2aXZf
b2JqID0gdG9fZXRuYXZpdl9ibyhvYmopOworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqd3Jp
dGVycywgKnJlYWRlcnM7CiAJc3RydWN0IGRtYV9mZW5jZV9hcnJheV9jdXJzb3IgY3Vyc29yOwog
CXN0cnVjdCBkbWFfcmVzdiAqcm9iaiA9IG9iai0+cmVzdjsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZSwgKnJlYWRlcnM7CiAJdW5zaWduZWQgbG9uZyBvZmYgPSBkcm1fdm1hX25vZGVfc3RhcnQo
Jm9iai0+dm1hX25vZGUpOwogCiAJc2VxX3ByaW50ZihtLCAiJTA4eDogJWMgJTJkICglMmQpICUw
OGx4ICVwICV6ZFxuIiwKQEAgLTQ3NCw4ICs0NzQsOCBAQCBzdGF0aWMgdm9pZCBldG5hdml2X2dl
bV9kZXNjcmliZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IHNlcV9maWxlICpt
KQogCXJlYWRlcnMgPSBkbWFfcmVzdl9mZW5jZXNfZGVyZWYocm9iaiwgJnJvYmotPnJlYWRlcnMp
OwogCWRtYV9mZW5jZV9hcnJheV9mb3JfZWFjaChmZW5jZSwgY3Vyc29yLCByZWFkZXJzKQogCQll
dG5hdml2X2dlbV9kZXNjcmliZV9mZW5jZShmZW5jZSwgIlNoYXJlZCIsIG0pOwotCWZlbmNlID0g
cmN1X2RlcmVmZXJlbmNlKHJvYmotPmZlbmNlX2V4Y2wpOwotCWlmIChmZW5jZSkKKwl3cml0ZXJz
ID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKHJvYmosICZyb2JqLT53cml0ZXJzKTsKKwlkbWFfZmVu
Y2VfYXJyYXlfZm9yX2VhY2goZmVuY2UsIGN1cnNvciwgcmVhZGVycykKIAkJZXRuYXZpdl9nZW1f
ZGVzY3JpYmVfZmVuY2UoZmVuY2UsICJFeGNsdXNpdmUiLCBtKTsKIAlyY3VfcmVhZF91bmxvY2so
KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVzeS5jCmluZGV4IDBmMThi
YTk3YjIyOC4uMzZmZTU4ODE2NjdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fYnVzeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9idXN5LmMKQEAgLTg0LDkgKzg0LDggQEAgaTkxNV9nZW1fYnVzeV9pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fYnVzeSAq
YXJncyA9IGRhdGE7CiAJc3RydWN0IGRtYV9mZW5jZV9hcnJheV9jdXJzb3IgY3Vyc29yOwotCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqcmVhZGVyczsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSwgKndyaXRlcnMsICpyZWFkZXJzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7
Ci0JdW5zaWduZWQgaW50IHNlcTsKIAlpbnQgZXJyOwogCiAJZXJyID0gLUVOT0VOVDsKQEAgLTEx
MiwyMSArMTExLDE4IEBAIGk5MTVfZ2VtX2J1c3lfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAkgKiB0byByZXBvcnQgdGhlIG92ZXJhbGwgYnVzeW5lc3MuIFRoaXMg
aXMgd2hhdCB0aGUgd2FpdC1pb2N0bCBkb2VzLgogCSAqCiAJICovCi1yZXRyeToKLQlzZXEgPSBy
YXdfcmVhZF9zZXFjb3VudCgmb2JqLT5iYXNlLnJlc3YtPnNlcSk7CisJd3JpdGVycyA9IGRtYV9y
ZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmotPmJhc2UucmVzdi0+d3JpdGVycyk7CisJcmVhZGVycyA9
IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmotPmJhc2UucmVzdi0+cmVhZGVycyk7CiAKIAkv
KiBUcmFuc2xhdGUgdGhlIGV4Y2x1c2l2ZSBmZW5jZSB0byB0aGUgUkVBRCAqYW5kKiBXUklURSBl
bmdpbmUgKi8KLQlhcmdzLT5idXN5ID0KLQkJYnVzeV9jaGVja193cml0ZXIocmN1X2RlcmVmZXJl
bmNlKG9iai0+YmFzZS5yZXN2LT5mZW5jZV9leGNsKSk7CisJYXJncy0+YnVzeSA9IGJ1c3lfY2hl
Y2tfd3JpdGVyKHdyaXRlcnMpOwogCiAJLyogVHJhbnNsYXRlIHNoYXJlZCBmZW5jZXMgdG8gUkVB
RCBzZXQgb2YgZW5naW5lcyAqLwotCXJlYWRlcnMgPSBkbWFfcmVzdl9mZW5jZXNfZ2V0X3JjdSgm
b2JqLT5iYXNlLnJlc3YtPnJlYWRlcnMpOwogCWRtYV9mZW5jZV9hcnJheV9mb3JfZWFjaChmZW5j
ZSwgY3Vyc29yLCByZWFkZXJzKQogCQlhcmdzLT5idXN5IHw9IGJ1c3lfY2hlY2tfcmVhZGVyKGZl
bmNlKTsKLQlkbWFfZmVuY2VfcHV0KHJlYWRlcnMpOwogCi0JaWYgKGFyZ3MtPmJ1c3kgJiYgcmVh
ZF9zZXFjb3VudF9yZXRyeSgmb2JqLT5iYXNlLnJlc3YtPnNlcSwgc2VxKSkKLQkJZ290byByZXRy
eTsKKwlkbWFfZmVuY2VfcHV0KHdyaXRlcnMpOworCWRtYV9mZW5jZV9wdXQocmVhZGVycyk7CiAK
IAllcnIgPSAwOwogb3V0OgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91
dmVhdV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IDZi
M2ZhZDAzYjM0Mi4uZjg2NWVhZGFlOTY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9i
by5jCkBAIC0xMzI0LDggKzEzMjQsOSBAQCBub3V2ZWF1X2JvX3ZtX2NsZWFudXAoc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0ICpibywKIHsKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IG5vdXZl
YXVfYmRldihiby0+YmRldik7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGRybS0+ZGV2Owot
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gZG1hX3Jlc3ZfZ2V0X2V4Y2woYm8tPmJhc2UucmVz
dik7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKKwlmZW5jZSA9IGRtYV9yZXN2X2ZlbmNl
c19kZXJlZihiby0+YmFzZS5yZXN2LCAmYm8tPmJhc2UucmVzdi0+d3JpdGVycyk7CiAJbnYxMF9i
b19wdXRfdGlsZV9yZWdpb24oZGV2LCAqb2xkX3RpbGUsIGZlbmNlKTsKIAkqb2xkX3RpbGUgPSBu
ZXdfdGlsZTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
ZmVuY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYwppbmRleCAz
NTBjZDJhOWVhNTEuLmE5Nzg3OGZiYmM5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV9mZW5jZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfZmVuY2UuYwpAQCAtMzQ4LDcgKzM0OCw3IEBAIG5vdXZlYXVfZmVuY2Vfc3luYyhzdHJ1Y3Qg
bm91dmVhdV9ibyAqbnZibywgc3RydWN0IG5vdXZlYXVfY2hhbm5lbCAqY2hhbiwgYm9vbCBlCiAJ
CQlyZXR1cm4gcmV0OwogCX0KIAotCWZlbmNlID0gZG1hX3Jlc3ZfZ2V0X2V4Y2wocmVzdik7CisJ
ZmVuY2UgPSBkbWFfcmVzdl9mZW5jZXNfZGVyZWYocmVzdiwgJnJlc3YtPndyaXRlcnMpOwogCWlm
IChmZW5jZSkgewogCQlzdHJ1Y3Qgbm91dmVhdV9jaGFubmVsICpwcmV2ID0gTlVMTDsKIAkJYm9v
bCBtdXN0X3dhaXQgPSB0cnVlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9y
YWRlb25fZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fZGlzcGxheS5j
CmluZGV4IGU4MWIwMWY4ZGI5MC4uNmVmNTg5MDgxYzZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vcmFkZW9uL3JhZGVvbl9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVv
bi9yYWRlb25fZGlzcGxheS5jCkBAIC01MzMsNyArNTMzLDkgQEAgc3RhdGljIGludCByYWRlb25f
Y3J0Y19wYWdlX2ZsaXBfdGFyZ2V0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJRFJNX0VSUk9S
KCJmYWlsZWQgdG8gcGluIG5ldyByYm8gYnVmZmVyIGJlZm9yZSBmbGlwXG4iKTsKIAkJZ290byBj
bGVhbnVwOwogCX0KLQl3b3JrLT5mZW5jZSA9IGRtYV9mZW5jZV9nZXQoZG1hX3Jlc3ZfZ2V0X2V4
Y2wobmV3X3Jiby0+dGJvLmJhc2UucmVzdikpOworCXdvcmstPmZlbmNlID0gZG1hX3Jlc3ZfZmVu
Y2VzX2RlcmVmKG5ld19yYm8tPnRiby5iYXNlLnJlc3YsCisJCQkJCSAgICAmbmV3X3Jiby0+dGJv
LmJhc2UucmVzdi0+d3JpdGVycyk7CisJZG1hX2ZlbmNlX2dldCh3b3JrLT5mZW5jZSk7CiAJcmFk
ZW9uX2JvX2dldF90aWxpbmdfZmxhZ3MobmV3X3JibywgJnRpbGluZ19mbGFncywgTlVMTCk7CiAJ
cmFkZW9uX2JvX3VucmVzZXJ2ZShuZXdfcmJvKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3JhZGVvbi9yYWRlb25fc3luYy5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25f
c3luYy5jCmluZGV4IDk3MWRkNmMwMWU2MC4uYmY1OTU0MjhkYWJmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9zeW5jLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Jh
ZGVvbi9yYWRlb25fc3luYy5jCkBAIC05Nyw3ICs5Nyw3IEBAIGludCByYWRlb25fc3luY19yZXN2
KHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2LAogCWludCByID0gMDsKIAogCS8qIGFsd2F5cyBz
eW5jIHRvIHRoZSBleGNsdXNpdmUgZmVuY2UgKi8KLQlmID0gZG1hX3Jlc3ZfZ2V0X2V4Y2wocmVz
dik7CisJZiA9IGRtYV9yZXN2X2ZlbmNlc19kZXJlZihyZXN2LCAmcmVzdi0+d3JpdGVycyk7CiAJ
ZmVuY2UgPSBmID8gdG9fcmFkZW9uX2ZlbmNlKGYpIDogTlVMTDsKIAlpZiAoZmVuY2UgJiYgZmVu
Y2UtPnJkZXYgPT0gcmRldikKIAkJcmFkZW9uX3N5bmNfZmVuY2Uoc3luYywgZmVuY2UpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdXZkLmMgYi9kcml2ZXJzL2dw
dS9kcm0vcmFkZW9uL3JhZGVvbl91dmQuYwppbmRleCAxYWQ1YzNiODZiNjQuLjcyYmZjZGRiY2Uy
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdXZkLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdXZkLmMKQEAgLTQ2NSw2ICs0NjUsNyBAQCBz
dGF0aWMgaW50IHJhZGVvbl91dmRfdmFsaWRhdGVfY29kZWMoc3RydWN0IHJhZGVvbl9jc19wYXJz
ZXIgKnAsCiBzdGF0aWMgaW50IHJhZGVvbl91dmRfY3NfbXNnKHN0cnVjdCByYWRlb25fY3NfcGFy
c2VyICpwLCBzdHJ1Y3QgcmFkZW9uX2JvICpibywKIAkJCSAgICAgdW5zaWduZWQgb2Zmc2V0LCB1
bnNpZ25lZCBidWZfc2l6ZXNbXSkKIHsKKwlzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YgPSBiby0+dGJv
LmJhc2UucmVzdjsKIAlpbnQzMl90ICptc2csIG1zZ190eXBlLCBoYW5kbGU7CiAJdW5zaWduZWQg
aW1nX3NpemUgPSAwOwogCXN0cnVjdCBkbWFfZmVuY2UgKmY7CkBAIC00NzcsNyArNDc4LDcgQEAg
c3RhdGljIGludCByYWRlb25fdXZkX2NzX21zZyhzdHJ1Y3QgcmFkZW9uX2NzX3BhcnNlciAqcCwg
c3RydWN0IHJhZGVvbl9ibyAqYm8sCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCWYgPSBkbWFf
cmVzdl9nZXRfZXhjbChiby0+dGJvLmJhc2UucmVzdik7CisJZiA9IGRtYV9yZXN2X2ZlbmNlc19k
ZXJlZihyZXN2LCAmcmVzdi0+d3JpdGVycyk7CiAJaWYgKGYpIHsKIAkJciA9IHJhZGVvbl9mZW5j
ZV93YWl0KChzdHJ1Y3QgcmFkZW9uX2ZlbmNlICopZiwgZmFsc2UpOwogCQlpZiAocikgewpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyBiL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2JvLmMKaW5kZXggMTllZWVmYmJiNjVhLi41M2Q0MDM1Nzc4ZDAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fYm8uYwpAQCAtNDU1LDcgKzQ1NSw3IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19mbHVzaF9hbGxf
ZmVuY2VzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCiB7CiAJc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2U7CiAKLQlmZW5jZSA9IGRtYV9yZXN2X2dldF9leGNsKCZiby0+YmFzZS5fcmVzdik7
CisJZmVuY2UgPSBkbWFfcmVzdl9mZW5jZXNfZGVyZWYoJmJvLT5iYXNlLl9yZXN2LCAmYm8tPmJh
c2UuX3Jlc3Yud3JpdGVycyk7CiAJaWYgKGZlbmNlICYmICFmZW5jZS0+b3BzLT5zaWduYWxlZCkK
IAkJZG1hX2ZlbmNlX2VuYWJsZV9zd19zaWduYWxpbmcoZmVuY2UpOwogCmRpZmYgLS1naXQgYS9p
bmNsdWRlL2xpbnV4L2RtYS1yZXN2LmggYi9pbmNsdWRlL2xpbnV4L2RtYS1yZXN2LmgKaW5kZXgg
YjIzZTE2OTc1ZjM5Li43MmMzYzRmOTk3MTEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvZG1h
LXJlc3YuaAorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1yZXN2LmgKQEAgLTQ4LDggKzQ4LDYgQEAK
IHN0cnVjdCBkbWFfcmVzdjsKIAogZXh0ZXJuIHN0cnVjdCB3d19jbGFzcyByZXNlcnZhdGlvbl93
d19jbGFzczsKLWV4dGVybiBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgcmVzZXJ2YXRpb25fc2VxY291
bnRfY2xhc3M7Ci1leHRlcm4gY29uc3QgY2hhciByZXNlcnZhdGlvbl9zZXFjb3VudF9zdHJpbmdb
XTsKIAogLyoqCiAgKiBzdHJ1Y3QgZG1hX3Jlc3ZfZmVuY2VzIC0gZmVuY2VzIGluc2lkZSBhIHJl
c2VydmF0aW9uIG9iamVjdApAQCAtNzYsMTUgKzc0LDE0IEBAIHZvaWQgZG1hX3Jlc3ZfZmVuY2Vz
X2NvbW1pdChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwKICAqIHN0cnVjdCBkbWFfcmVzdiAtIGEgcmVz
ZXJ2YXRpb24gb2JqZWN0IG1hbmFnZXMgZmVuY2VzIGZvciBhIGJ1ZmZlcgogICogQGxvY2s6IHVw
ZGF0ZSBzaWRlIGxvY2sKICAqIEBzZXE6IHNlcXVlbmNlIGNvdW50IGZvciBtYW5hZ2luZyBSQ1Ug
cmVhZC1zaWRlIHN5bmNocm9uaXphdGlvbgotICogQGZlbmNlX2V4Y2w6IHRoZSBleGNsdXNpdmUg
ZmVuY2UsIGlmIHRoZXJlIGlzIG9uZSBjdXJyZW50bHkKKyAqIEB3cml0ZXJzOiBhcnJheSBvZiB3
cml0ZSBvcGVyYXRpb25zIGZvciBpbXBsaWNpdCBzeW5jCiAgKiBAcmVhZGVyczogYXJyYXkgb2Yg
cmVhZCBvcGVyYXRpb25zIGZvciBpbXBsaWNpdCBzeW5jCiAgKi8KIHN0cnVjdCBkbWFfcmVzdiB7
CiAJc3RydWN0IHd3X211dGV4IGxvY2s7Ci0Jc2VxY291bnRfdCBzZXE7CiAKLQlzdHJ1Y3QgZG1h
X2ZlbmNlIF9fcmN1ICpmZW5jZV9leGNsOwotCXN0cnVjdCBkbWFfcmVzdl9mZW5jZXMJcmVhZGVy
czsKKwlzdHJ1Y3QgZG1hX3Jlc3ZfZmVuY2VzIHdyaXRlcnM7CisJc3RydWN0IGRtYV9yZXN2X2Zl
bmNlcyByZWFkZXJzOwogfTsKIAogI2RlZmluZSBkbWFfcmVzdl9oZWxkKG9iaikgbG9ja2RlcF9p
c19oZWxkKCYob2JqKS0+bG9jay5iYXNlKQpAQCAtMjQzLDI1ICsyNDAsNiBAQCBzdGF0aWMgaW5s
aW5lIHZvaWQgZG1hX3Jlc3ZfdW5sb2NrKHN0cnVjdCBkbWFfcmVzdiAqb2JqKQogCXd3X211dGV4
X3VubG9jaygmb2JqLT5sb2NrKTsKIH0KIAotLyoqCi0gKiBkbWFfcmVzdl9nZXRfZXhjbCAtIGdl
dCB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0J3MKLSAqIGV4Y2x1c2l2ZSBmZW5jZSwgd2l0aCB1cGRh
dGUtc2lkZSBsb2NrIGhlbGQKLSAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBvYmplY3QKLSAqCi0g
KiBSZXR1cm5zIHRoZSBleGNsdXNpdmUgZmVuY2UgKGlmIGFueSkuICBEb2VzIE5PVCB0YWtlIGEK
LSAqIHJlZmVyZW5jZS4gV3JpdGVycyBtdXN0IGhvbGQgb2JqLT5sb2NrLCByZWFkZXJzIG1heSBv
bmx5Ci0gKiBob2xkIGEgUkNVIHJlYWQgc2lkZSBsb2NrLgotICoKLSAqIFJFVFVSTlMKLSAqIFRo
ZSBleGNsdXNpdmUgZmVuY2Ugb3IgTlVMTAotICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBkbWFf
ZmVuY2UgKgotZG1hX3Jlc3ZfZ2V0X2V4Y2woc3RydWN0IGRtYV9yZXN2ICpvYmopCi17Ci0JcmV0
dXJuIHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQob2JqLT5mZW5jZV9leGNsLAotCQkJCQkgZG1h
X3Jlc3ZfaGVsZChvYmopKTsKLX0KLQogLyoqCiAgKiBkbWFfcmVzdl9nZXRfZXhjbF9yY3UgLSBn
ZXQgdGhlIHJlc2VydmF0aW9uIG9iamVjdCdzCiAgKiBleGNsdXNpdmUgZmVuY2UsIHdpdGhvdXQg
bG9jayBoZWxkLgpAQCAtMjc4LDExICsyNTYsOCBAQCBkbWFfcmVzdl9nZXRfZXhjbF9yY3Uoc3Ry
dWN0IGRtYV9yZXN2ICpvYmopCiB7CiAJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQlpZiAo
IXJjdV9hY2Nlc3NfcG9pbnRlcihvYmotPmZlbmNlX2V4Y2wpKQotCQlyZXR1cm4gTlVMTDsKLQog
CXJjdV9yZWFkX2xvY2soKTsKLQlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+
ZmVuY2VfZXhjbCk7CisJZmVuY2UgPSBkbWFfcmVzdl9mZW5jZXNfZ2V0X3JjdSgmb2JqLT53cml0
ZXJzKTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAogCXJldHVybiBmZW5jZTsKLS0gCjIuMTcuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
