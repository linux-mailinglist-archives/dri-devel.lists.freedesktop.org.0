Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5C13FF07D0
	for <lists+dri-devel@lfdr.de>; Tue,  5 Nov 2019 22:10:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DADC36E9D8;
	Tue,  5 Nov 2019 21:10:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yb1-xb41.google.com (mail-yb1-xb41.google.com
 [IPv6:2607:f8b0:4864:20::b41])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AE18E6E9D8
 for <dri-devel@lists.freedesktop.org>; Tue,  5 Nov 2019 21:10:51 +0000 (UTC)
Received: by mail-yb1-xb41.google.com with SMTP id g17so567984ybd.13
 for <dri-devel@lists.freedesktop.org>; Tue, 05 Nov 2019 13:10:51 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=wV4eozP5loNQwYGwTBZjo7fjHegUFd2KeaLBGEk3hXA=;
 b=HR2wpKl1/phnNjkw5DhC/wvmCCUOZ5XzoGk8/ZNQ5PPRBLm0QrQSZ71eOhWbwWweCI
 It9KYB1tWlZyyEpxFVhzjNAv2dLAt4Y6ZvhZIJaVhxn4Y/OTkvxHNa7xs9o/gVAz3t3y
 JTUPRKStobRHXYi9OCQEHiSvrnvASzb6LcEL+rgZy6Pd7Rxr9M4NqAlqxS6sBdmCNieP
 iuetUrYJIYhuMWKneLroFBB/jwR+vlJVUgkiel/8vDYr4ldahk/wqJozyv0qvxDLlT2X
 o85FJelD3UO1ViuJiGxPmyEsvnJJ3V1MQ2W6goqZb5M6lB7czf7bGVTTFbaAsk+iVj/R
 Ou4w==
X-Gm-Message-State: APjAAAVYwXZ8GPL+bS2AG6MmZf1K8sH/8ETKlluRA8LDiOfNBTwKQjKN
 7RmEpIueJU43cMkJ4ya3qDq2oiTvDlc=
X-Google-Smtp-Source: APXvYqzU0qqs+85NekuoYN3av0T/6sjs3A+/t1dcUDPS/GuqvBVMdxP+0PxcpfW0TVgNQIEIHKU3cw==
X-Received: by 2002:a25:c281:: with SMTP id s123mr29226020ybf.92.1572988250491; 
 Tue, 05 Nov 2019 13:10:50 -0800 (PST)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id j66sm1815216ywb.101.2019.11.05.13.10.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 05 Nov 2019 13:10:50 -0800 (PST)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org,
	linux-mediatek@lists.infradead.org
Subject: [PATCH v2 1/7] drm/mediatek: Refactor plane init
Date: Tue,  5 Nov 2019 16:10:18 -0500
Message-Id: <20191105211034.123937-2-sean@poorly.run>
X-Mailer: git-send-email 2.24.0.rc1.363.gb1bccd3e3d-goog
In-Reply-To: <20191105211034.123937-1-sean@poorly.run>
References: <20191105211034.123937-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=wV4eozP5loNQwYGwTBZjo7fjHegUFd2KeaLBGEk3hXA=;
 b=G7Z/3RjJH8MhJ9aRUpU58OK1kicWtOfm3WtQLcKX1elIQ+JQ/825WwFnfTx4QpN0R5
 /qz307oDAZfzYxFCewWZ6HZAx5GKfnNPQPZJw852kLB84ojf24fkweH7Mql1ilO/efva
 16no+9TaJtrLwAejmjAg168sSggFqN5IP5HAJLd1LDvbs7ICGLkHKbAEbx9Q+m/Hjbge
 wgDh+5WQN2fFFuG9iTJfXU2Oe8fE9gFFXyr7zSyuv8loygbB+7NHsZL1cKNzuKhhDaSE
 Yyj2G5EB6Ivy6uimax0FkY71FYWlYKILN1Mia76WZgswL4pnibiWzvwRC9K/gJRbn9kN
 zqVg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dcastagna@chromium.org, matthias.bgg@gmail.com, mcasas@chromium.org,
 Sean Paul <seanpaul@chromium.org>, frkoenig@chromium.org,
 linux-arm-kernel@lists.infradead.org, markyacoub@google.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpBZGQgYSBjb3VwbGUgb2Yg
ZnVuY3Rpb25zIHdoaWNoIGVudW1lcmF0ZSB0aGUgbnVtYmVyIG9mIHBsYW5lcyBmb3IgYQpjb21w
b25lbnQgYW5kIGluaXRpYWxpemUgdGhlIHBsYW5lcyBmb3IgYSBjb21wb25lbnQuCgpObyBmdW5j
dGlvbmFsIGNoYW5nZXMgaW4gdGhpcyBwYXRjaCwgYnV0IGl0IHdpbGwgYWxsb3cgdXMgdG8gc2Vs
ZWN0aXZlbHkKc3VwcG9ydCByb3RhdGlvbiBpZiB0aGUgY29tcG9uZW50IHN1cHBvcnRzIGl0LgoK
U2lnbmVkLW9mZi1ieTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5jIHwgNzcgKysrKysrKysrKysrKysr
KysrKy0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDU5IGluc2VydGlvbnMoKyksIDE4IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuYwppbmRleCBiODQxZDM3
MDZkOGIuLjdkMGY1MGRhOGU0MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVr
L210a19kcm1fY3J0Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Ny
dGMuYwpAQCAtNTQzLDE0ICs1NDMsNjMgQEAgdm9pZCBtdGtfY3J0Y19kZHBfaXJxKHN0cnVjdCBk
cm1fY3J0YyAqY3J0Yywgc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIAltdGtfZHJtX2Zpbmlz
aF9wYWdlX2ZsaXAobXRrX2NydGMpOwogfQogCitzdGF0aWMgaW50IG10a19kcm1fY3J0Y19udW1f
Y29tcF9wbGFuZXMoc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGMsCisJCQkJCWludCBjb21w
X2lkeCkKK3sKKwlzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wOworCisJaWYgKGNvbXBfaWR4ID4g
MSkKKwkJcmV0dXJuIDA7CisKKwljb21wID0gbXRrX2NydGMtPmRkcF9jb21wW2NvbXBfaWR4XTsK
KwlpZiAoIWNvbXAtPmZ1bmNzKQorCQlyZXR1cm4gMDsKKworCWlmIChjb21wX2lkeCA9PSAxICYm
ICFjb21wLT5mdW5jcy0+YmdjbHJfaW5fb24pCisJCXJldHVybiAwOworCisJcmV0dXJuIG10a19k
ZHBfY29tcF9sYXllcl9ucihjb21wKTsKK30KKworc3RhdGljIGlubGluZQorZW51bSBkcm1fcGxh
bmVfdHlwZSBtdGtfZHJtX2NydGNfcGxhbmVfdHlwZSh1bnNpZ25lZCBpbnQgcGxhbmVfaWR4KQor
eworCWlmIChwbGFuZV9pZHggPT0gMCkKKwkJcmV0dXJuIERSTV9QTEFORV9UWVBFX1BSSU1BUlk7
CisJZWxzZSBpZiAocGxhbmVfaWR4ID09IDEpCisJCXJldHVybiBEUk1fUExBTkVfVFlQRV9DVVJT
T1I7CisJZWxzZQorCQlyZXR1cm4gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKKworfQorCitzdGF0
aWMgaW50IG10a19kcm1fY3J0Y19pbml0X2NvbXBfcGxhbmVzKHN0cnVjdCBkcm1fZGV2aWNlICpk
cm1fZGV2LAorCQkJCQkgc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGMsCisJCQkJCSBpbnQg
Y29tcF9pZHgsIGludCBwaXBlKQoreworCWludCBudW1fcGxhbmVzID0gbXRrX2RybV9jcnRjX251
bV9jb21wX3BsYW5lcyhtdGtfY3J0YywgY29tcF9pZHgpOworCWludCBpLCByZXQ7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgbnVtX3BsYW5lczsgaSsrKSB7CisJCXJldCA9IG10a19wbGFuZV9pbml0KGRy
bV9kZXYsCisJCQkJJm10a19jcnRjLT5wbGFuZXNbbXRrX2NydGMtPmxheWVyX25yXSwKKwkJCQlC
SVQocGlwZSksCisJCQkJbXRrX2RybV9jcnRjX3BsYW5lX3R5cGUobXRrX2NydGMtPmxheWVyX25y
KSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCisJCW10a19jcnRjLT5sYXllcl9ucisr
OworCX0KKwlyZXR1cm4gMDsKK30KKwogaW50IG10a19kcm1fY3J0Y19jcmVhdGUoc3RydWN0IGRy
bV9kZXZpY2UgKmRybV9kZXYsCiAJCQljb25zdCBlbnVtIG10a19kZHBfY29tcF9pZCAqcGF0aCwg
dW5zaWduZWQgaW50IHBhdGhfbGVuKQogewogCXN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgKnByaXYg
PSBkcm1fZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSBkcm1fZGV2LT5k
ZXY7CiAJc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGM7Ci0JZW51bSBkcm1fcGxhbmVfdHlw
ZSB0eXBlOwotCXVuc2lnbmVkIGludCB6cG9zOworCXVuc2lnbmVkIGludCBudW1fY29tcF9wbGFu
ZXMgPSAwOwogCWludCBwaXBlID0gcHJpdi0+bnVtX3BpcGVzOwogCWludCByZXQ7CiAJaW50IGk7
CkBAIC02MDYsMjMgKzY1NSwxNSBAQCBpbnQgbXRrX2RybV9jcnRjX2NyZWF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZHJtX2RldiwKIAkJbXRrX2NydGMtPmRkcF9jb21wW2ldID0gY29tcDsKIAl9CiAK
LQltdGtfY3J0Yy0+bGF5ZXJfbnIgPSBtdGtfZGRwX2NvbXBfbGF5ZXJfbnIobXRrX2NydGMtPmRk
cF9jb21wWzBdKTsKLQlpZiAobXRrX2NydGMtPmRkcF9jb21wX25yID4gMSkgewotCQlzdHJ1Y3Qg
bXRrX2RkcF9jb21wICpjb21wID0gbXRrX2NydGMtPmRkcF9jb21wWzFdOworCWZvciAoaSA9IDA7
IGkgPCBtdGtfY3J0Yy0+ZGRwX2NvbXBfbnI7IGkrKykKKwkJbnVtX2NvbXBfcGxhbmVzICs9IG10
a19kcm1fY3J0Y19udW1fY29tcF9wbGFuZXMobXRrX2NydGMsIGkpOworCisJbXRrX2NydGMtPnBs
YW5lcyA9IGRldm1fa2NhbGxvYyhkZXYsIG51bV9jb21wX3BsYW5lcywKKwkJCQkJc2l6ZW9mKHN0
cnVjdCBkcm1fcGxhbmUpLCBHRlBfS0VSTkVMKTsKIAotCQlpZiAoY29tcC0+ZnVuY3MtPmJnY2xy
X2luX29uKQotCQkJbXRrX2NydGMtPmxheWVyX25yICs9IG10a19kZHBfY29tcF9sYXllcl9ucihj
b21wKTsKLQl9Ci0JbXRrX2NydGMtPnBsYW5lcyA9IGRldm1fa2NhbGxvYyhkZXYsIG10a19jcnRj
LT5sYXllcl9uciwKLQkJCQkJc2l6ZW9mKHN0cnVjdCBkcm1fcGxhbmUpLAotCQkJCQlHRlBfS0VS
TkVMKTsKLQotCWZvciAoenBvcyA9IDA7IHpwb3MgPCBtdGtfY3J0Yy0+bGF5ZXJfbnI7IHpwb3Mr
KykgewotCQl0eXBlID0gKHpwb3MgPT0gMCkgPyBEUk1fUExBTkVfVFlQRV9QUklNQVJZIDoKLQkJ
CQkoenBvcyA9PSAxKSA/IERSTV9QTEFORV9UWVBFX0NVUlNPUiA6Ci0JCQkJCQlEUk1fUExBTkVf
VFlQRV9PVkVSTEFZOwotCQlyZXQgPSBtdGtfcGxhbmVfaW5pdChkcm1fZGV2LCAmbXRrX2NydGMt
PnBsYW5lc1t6cG9zXSwKLQkJCQkgICAgIEJJVChwaXBlKSwgdHlwZSk7CisJZm9yIChpID0gMDsg
aSA8IG10a19jcnRjLT5kZHBfY29tcF9ucjsgaSsrKSB7CisJCXJldCA9IG10a19kcm1fY3J0Y19p
bml0X2NvbXBfcGxhbmVzKGRybV9kZXYsIG10a19jcnRjLCBpLAorCQkJCQkJICAgIHBpcGUpOwog
CQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9Ci0tIApTZWFuIFBhdWwsIFNvZnR3YXJlIEVu
Z2luZWVyLCBHb29nbGUgLyBDaHJvbWl1bSBPUwoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
