Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 79C7D86D17
	for <lists+dri-devel@lfdr.de>; Fri,  9 Aug 2019 00:22:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CD96E6ECD4;
	Thu,  8 Aug 2019 22:22:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ot1-f66.google.com (mail-ot1-f66.google.com
 [209.85.210.66])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E08846ECCF
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Aug 2019 22:22:10 +0000 (UTC)
Received: by mail-ot1-f66.google.com with SMTP id z17so6636475otk.13
 for <dri-devel@lists.freedesktop.org>; Thu, 08 Aug 2019 15:22:10 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=tIGYBEAKqVgwzDzza0w3ws8fmDy9FL3lVKuHvGDNjY4=;
 b=aPls8pdm5Rcod130fBCgHfe8NUVd0Ub10XGtARVOk4CoESIroAHZUfEsbn8W9tPhC1
 nCzKykhNaNMSRjRVPcerCK/dYbAMTtcgcAhla0WhXRcdpy34H3Xpo9Ph4Qngx+sUSlNs
 u/IuwaVV5C3Zoa/aOAGSl5ujaaSJiEloqws+UwUdpE52n/SVJ+sWmwbaMzf0URemy6oL
 Y8yyoEAdSi1+3RsWidDjPhDwE15mZWIpiMWj6PC9I2q43GHeYskr/wH+6Rv1SCGCmx7e
 t5u6gZC3jl7eCra+kiJpBVpnGZliQG+CnDbhFom16V3fZtr+HFjUlsDUQztorgiffVwZ
 HmBw==
X-Gm-Message-State: APjAAAV36qgGdJ38YghPLh3Y/0AjBGffu9RdFQ1cWI0WxkcDtqp3K25K
 Ss5z1F5U4y5vXBh5uIsqcBW4kvw=
X-Google-Smtp-Source: APXvYqwujyRUFPwFloNgagcKinJj6fq9k/gTEBOIsPTUbFizoVrSc9C24S3nYORq66jZOcZcXw4uqA==
X-Received: by 2002:a6b:7619:: with SMTP id g25mr1752619iom.92.1565302929753; 
 Thu, 08 Aug 2019 15:22:09 -0700 (PDT)
Received: from xps15.herring.priv ([64.188.179.254])
 by smtp.googlemail.com with ESMTPSA id i4sm118528553iog.31.2019.08.08.15.22.08
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 08 Aug 2019 15:22:09 -0700 (PDT)
From: Rob Herring <robh@kernel.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 6/9] drm/panfrost: Consolidate reset handling
Date: Thu,  8 Aug 2019 16:21:57 -0600
Message-Id: <20190808222200.13176-7-robh@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190808222200.13176-1-robh@kernel.org>
References: <20190808222200.13176-1-robh@kernel.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Robin Murphy <robin.murphy@arm.com>,
 Steven Price <steven.price@arm.com>, David Airlie <airlied@linux.ie>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UnVudGltZSBQTSByZXN1bWUgYW5kIGpvYiB0aW1lb3V0cyBib3RoIGNhbGwgdGhlIHNhbWUgc2Vx
dWVuY2Ugb2YKZnVuY3Rpb25zLCBzbyBjb25zb2xpZGF0ZSB0aGVtIHRvIGEgY29tbW9uIGZ1bmN0
aW9uLiBUaGlzIHdpbGwgbWFrZQpjaGFuZ2luZyB0aGUgcmVzZXQgcmVsYXRlZCBjb2RlIGVhc2ll
ci4gVGhlIE1NVSBhbHNvIG5lZWRzIHNvbWUKcmUtaW5pdGlhbGl6YXRpb24gb24gcmVzZXQsIHNv
IHJld29yayBpdHMgY2FsbC4gSW4gdGhlIHByb2Nlc3MsIHdlCmhpZGUgdGhlIGFkZHJlc3Mgc3Bh
Y2UgZGV0YWlscyB3aXRoaW4gdGhlIE1NVSBjb2RlIGluIHByZXBhcmF0aW9uIHRvCnN1cHBvcnQg
bXVsdGlwbGUgYWRkcmVzcyBzcGFjZXMuCgpDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpvc29A
Y29sbGFib3JhLmNvbT4KQ2M6IERhdmlkIEFpcmxpZSA8YWlybGllZEBsaW51eC5pZT4KQ2M6IERh
bmllbCBWZXR0ZXIgPGRhbmllbEBmZndsbC5jaD4KQ2M6IFJvYmluIE11cnBoeSA8cm9iaW4ubXVy
cGh5QGFybS5jb20+CkNjOiBTdGV2ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgpDYzog
QWx5c3NhIFJvc2VuendlaWcgPGFseXNzYS5yb3Nlbnp3ZWlnQGNvbGxhYm9yYS5jb20+ClNpZ25l
ZC1vZmYtYnk6IFJvYiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+Ci0tLQpOZXcgcGF0Y2ggaW4g
dGhpcyB2ZXJzaW9uLgoKIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZpY2Uu
YyB8IDE2ICsrKysrKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9z
dF9kZXZpY2UuaCB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2Iu
YyAgICB8ICA3ICstLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUu
YyAgICB8IDE2ICsrKysrKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9tbXUuaCAgICB8ICAzICstLQogNSBmaWxlcyBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCsp
LCAyMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3RfZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2
aWNlLmMKaW5kZXggOGExMTFkN2MwMjAwLi45ODE0ZjRjY2JkMjYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2aWNlLmMKQEAgLTI1NCwxOCArMjU0LDIyIEBAIGNvbnN0
IGNoYXIgKnBhbmZyb3N0X2V4Y2VwdGlvbl9uYW1lKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBm
ZGV2LCB1MzIgZXhjZXB0aW9uCiAJcmV0dXJuICJVTktOT1dOIjsKIH0KCit2b2lkIHBhbmZyb3N0
X2RldmljZV9yZXNldChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKK3sKKwlwYW5mcm9z
dF9ncHVfc29mdF9yZXNldChwZmRldik7CisKKwlwYW5mcm9zdF9ncHVfcG93ZXJfb24ocGZkZXYp
OworCXBhbmZyb3N0X21tdV9yZXNldChwZmRldik7CisJcGFuZnJvc3Rfam9iX2VuYWJsZV9pbnRl
cnJ1cHRzKHBmZGV2KTsKK30KKwogI2lmZGVmIENPTkZJR19QTQogaW50IHBhbmZyb3N0X2Rldmlj
ZV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQogewogCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2Ug
KnBkZXYgPSB0b19wbGF0Zm9ybV9kZXZpY2UoZGV2KTsKIAlzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNl
ICpwZmRldiA9IHBsYXRmb3JtX2dldF9kcnZkYXRhKHBkZXYpOwoKLQlwYW5mcm9zdF9ncHVfc29m
dF9yZXNldChwZmRldik7Ci0KLQkvKiBUT0RPOiBSZS1lbmFibGUgYWxsIG90aGVyIGFkZHJlc3Mg
c3BhY2VzICovCi0JcGFuZnJvc3RfZ3B1X3Bvd2VyX29uKHBmZGV2KTsKLQlwYW5mcm9zdF9tbXVf
ZW5hYmxlKHBmZGV2LCAwKTsKLQlwYW5mcm9zdF9qb2JfZW5hYmxlX2ludGVycnVwdHMocGZkZXYp
OworCXBhbmZyb3N0X2RldmljZV9yZXNldChwZmRldik7CiAJcGFuZnJvc3RfZGV2ZnJlcV9yZXN1
bWUocGZkZXYpOwoKIAlyZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9kZXZpY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9z
dF9kZXZpY2UuaAppbmRleCAwMzhiMzJjNjI0ODQuLjRlNTY0MWRiOWM3ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmljZS5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZpY2UuaApAQCAtMTMyLDYgKzEzMiw3IEBAIGlu
dCBwYW5mcm9zdF91bnN0YWJsZV9pb2N0bF9jaGVjayh2b2lkKTsKCiBpbnQgcGFuZnJvc3RfZGV2
aWNlX2luaXQoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYpOwogdm9pZCBwYW5mcm9zdF9k
ZXZpY2VfZmluaShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldik7Cit2b2lkIHBhbmZyb3N0
X2RldmljZV9yZXNldChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldik7CgogaW50IHBhbmZy
b3N0X2RldmljZV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KTsKIGludCBwYW5mcm9zdF9kZXZp
Y2Vfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2pvYi5jCmluZGV4IDliYjkyNjBkOTE4MS4uZDU2N2NlOTg0OTRjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5jCkBAIC0zOTUsMTIgKzM5NSw3IEBAIHN0YXRp
YyB2b2lkIHBhbmZyb3N0X2pvYl90aW1lZG91dChzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAqc2NoZWRf
am9iKQogCS8qIHBhbmZyb3N0X2NvcmVfZHVtcChwZmRldik7ICovCgogCXBhbmZyb3N0X2RldmZy
ZXFfcmVjb3JkX3RyYW5zaXRpb24ocGZkZXYsIGpzKTsKLQlwYW5mcm9zdF9ncHVfc29mdF9yZXNl
dChwZmRldik7Ci0KLQkvKiBUT0RPOiBSZS1lbmFibGUgYWxsIG90aGVyIGFkZHJlc3Mgc3BhY2Vz
ICovCi0JcGFuZnJvc3RfbW11X2VuYWJsZShwZmRldiwgMCk7Ci0JcGFuZnJvc3RfZ3B1X3Bvd2Vy
X29uKHBmZGV2KTsKLQlwYW5mcm9zdF9qb2JfZW5hYmxlX2ludGVycnVwdHMocGZkZXYpOworCXBh
bmZyb3N0X2RldmljZV9yZXNldChwZmRldik7CgogCWZvciAoaSA9IDA7IGkgPCBOVU1fSk9CX1NM
T1RTOyBpKyspCiAJCWRybV9zY2hlZF9yZXN1Ym1pdF9qb2JzKCZwZmRldi0+anMtPnF1ZXVlW2ld
LnNjaGVkKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9t
bXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwppbmRleCBlYmE2
Y2U3ODVlZjAuLjEzNzU3NDI3Yjg4NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZy
b3N0L3BhbmZyb3N0X21tdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9z
dF9tbXUuYwpAQCAtMTA1LDE1ICsxMDUsMTIgQEAgc3RhdGljIGludCBtbXVfaHdfZG9fb3BlcmF0
aW9uKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCB1MzIgYXNfbnIsCiAJcmV0dXJuIHJl
dDsKIH0KCi12b2lkIHBhbmZyb3N0X21tdV9lbmFibGUoc3RydWN0IHBhbmZyb3N0X2RldmljZSAq
cGZkZXYsIHUzMiBhc19ucikKK3N0YXRpYyB2b2lkIHBhbmZyb3N0X21tdV9lbmFibGUoc3RydWN0
IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIHUzMiBhc19ucikKIHsKIAlzdHJ1Y3QgaW9fcGd0YWJs
ZV9jZmcgKmNmZyA9ICZwZmRldi0+bW11LT5wZ3RibF9jZmc7CiAJdTY0IHRyYW5zdGFiID0gY2Zn
LT5hcm1fbWFsaV9scGFlX2NmZy50cmFuc3RhYjsKIAl1NjQgbWVtYXR0ciA9IGNmZy0+YXJtX21h
bGlfbHBhZV9jZmcubWVtYXR0cjsKCi0JbW11X3dyaXRlKHBmZGV2LCBNTVVfSU5UX0NMRUFSLCB+
MCk7Ci0JbW11X3dyaXRlKHBmZGV2LCBNTVVfSU5UX01BU0ssIH4wKTsKLQogCW1tdV93cml0ZShw
ZmRldiwgQVNfVFJBTlNUQUJfTE8oYXNfbnIpLCB0cmFuc3RhYiAmIDB4ZmZmZmZmZmZVTCk7CiAJ
bW11X3dyaXRlKHBmZGV2LCBBU19UUkFOU1RBQl9ISShhc19uciksIHRyYW5zdGFiID4+IDMyKTsK
CkBAIC0xMzcsNiArMTM0LDE0IEBAIHN0YXRpYyB2b2lkIG1tdV9kaXNhYmxlKHN0cnVjdCBwYW5m
cm9zdF9kZXZpY2UgKnBmZGV2LCB1MzIgYXNfbnIpCiAJd3JpdGVfY21kKHBmZGV2LCBhc19uciwg
QVNfQ09NTUFORF9VUERBVEUpOwogfQoKK3ZvaWQgcGFuZnJvc3RfbW11X3Jlc2V0KHN0cnVjdCBw
YW5mcm9zdF9kZXZpY2UgKnBmZGV2KQoreworCXBhbmZyb3N0X21tdV9lbmFibGUocGZkZXYsIDAp
OworCisJbW11X3dyaXRlKHBmZGV2LCBNTVVfSU5UX0NMRUFSLCB+MCk7CisJbW11X3dyaXRlKHBm
ZGV2LCBNTVVfSU5UX01BU0ssIH4wKTsKK30KKwogc3RhdGljIHNpemVfdCBnZXRfcGdzaXplKHU2
NCBhZGRyLCBzaXplX3Qgc2l6ZSkKIHsKIAlpZiAoYWRkciAmIChTWl8yTSAtIDEpIHx8IHNpemUg
PCBTWl8yTSkKQEAgLTM3NSw5ICszODAsNiBAQCBpbnQgcGFuZnJvc3RfbW11X2luaXQoc3RydWN0
IHBhbmZyb3N0X2RldmljZSAqcGZkZXYpCiAJCWRldl9lcnIocGZkZXYtPmRldiwgImZhaWxlZCB0
byByZXF1ZXN0IG1tdSBpcnEiKTsKIAkJcmV0dXJuIGVycjsKIAl9Ci0JbW11X3dyaXRlKHBmZGV2
LCBNTVVfSU5UX0NMRUFSLCB+MCk7Ci0JbW11X3dyaXRlKHBmZGV2LCBNTVVfSU5UX01BU0ssIH4w
KTsKLQogCXBmZGV2LT5tbXUtPnBndGJsX2NmZyA9IChzdHJ1Y3QgaW9fcGd0YWJsZV9jZmcpIHsK
IAkJLnBnc2l6ZV9iaXRtYXAJPSBTWl80SyB8IFNaXzJNLAogCQkuaWFzCQk9IEZJRUxEX0dFVCgw
eGZmLCBwZmRldi0+ZmVhdHVyZXMubW11X2ZlYXR1cmVzKSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuaCBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9wYW5mcm9zdF9tbXUuaAppbmRleCBmNTg3OGQ4NmE1Y2UuLmQ1ZjliMjQ1MzdkYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X21tdS5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuaApAQCAtMTEsNyArMTEsNiBAQCB2b2lk
IHBhbmZyb3N0X21tdV91bm1hcChzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8pOwoKIGlu
dCBwYW5mcm9zdF9tbXVfaW5pdChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldik7CiB2b2lk
IHBhbmZyb3N0X21tdV9maW5pKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KTsKLQotdm9p
ZCBwYW5mcm9zdF9tbXVfZW5hYmxlKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCB1MzIg
YXNfbnIpOwordm9pZCBwYW5mcm9zdF9tbXVfcmVzZXQoc3RydWN0IHBhbmZyb3N0X2RldmljZSAq
cGZkZXYpOwoKICNlbmRpZgotLQoyLjIwLjEKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
