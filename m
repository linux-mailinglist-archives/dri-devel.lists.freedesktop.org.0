Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 518A11147A8
	for <lists+dri-devel@lfdr.de>; Thu,  5 Dec 2019 20:32:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E115A6E176;
	Thu,  5 Dec 2019 19:32:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E1AC56E176;
 Thu,  5 Dec 2019 19:32:28 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Dec 2019 11:32:28 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,282,1571727600"; d="scan'208";a="294632335"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga001.jf.intel.com with SMTP; 05 Dec 2019 11:32:25 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 05 Dec 2019 21:32:24 +0200
Date: Thu, 5 Dec 2019 21:32:24 +0200
From: Ville =?iso-8859-1?Q?Syrj=E4l=E4?= <ville.syrjala@linux.intel.com>
To: Sean Paul <sean@poorly.run>
Subject: Re: [Intel-gfx] [PATCH 02/11] drm/i915: Intercept Aksv writes in the
 aux hooks
Message-ID: <20191205193224.GJ1208@intel.com>
References: <20191203173638.94919-1-sean@poorly.run>
 <20191203173638.94919-3-sean@poorly.run>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20191203173638.94919-3-sean@poorly.run>
User-Agent: Mutt/1.10.1 (2018-07-13)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, intel-gfx@lists.freedesktop.org,
 Sean Paul <seanpaul@chromium.org>, dri-devel@lists.freedesktop.org,
 ramalingm.c@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVHVlLCBEZWMgMDMsIDIwMTkgYXQgMTI6MzY6MjVQTSAtMDUwMCwgU2VhbiBQYXVsIHdyb3Rl
Ogo+IEZyb206IFNlYW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgo+IAo+IEluc3RlYWQg
b2YgaGFuZCByb2xsaW5nIHRoZSB0cmFuc2ZlciBvdXJzZWx2ZXMgaW4gdGhlIGhkY3AgaG9vaywg
aW5zcGVjdAo+IGF1eCBtZXNzYWdlcyBhbmQgYWRkIHRoZSBha3N2IGZsYWcgaW4gdGhlIGF1eCB0
cmFuc2ZlciBob29rLgo+IAo+IElJUkMsIHRoaXMgd2FzIHRoZSBvcmlnaW5hbCBpbXBsZW1lbnRh
dGlvbiBhbmQgZm9sa3Mgd2FudGVkIHRoaXMgaGFjayB0bwo+IGJlIGlzb2xhdGVkIHRvIHRoZSBo
ZGNwIGNvZGUsIHdoaWNoIG1ha2VzIHNlbnNlLgo+IAo+IEhvd2V2ZXIgaW4gdGVzdGluZyBhbiBM
RyBtb25pdG9yIG9uIG15IGRlc2ssIEkgbm90aWNlZCBpdCB3YXMgcGFzc2luZwo+IGJhY2sgYSBE
RUZFUiByZXBseS4gVGhpcyB3YXNuJ3QgaGFuZGxlZCBpbiBvdXIgaGFuZC1yb2xsZWQgY29kZSBh
bmQgSERDUAo+IGF1dGggd2FzIGZhaWxpbmcgYXMgYSByZXN1bHQuIEluc3RlYWQgb2YgY29weS9w
YXN0aW5nIGFsbCBvZiB0aGUgcmV0cnkKPiBsb2dpYyBhbmQgZGVsYXlzIGZyb20gZHJtIGRwIGhl
bHBlcnMsIGxldCdzIGp1c3QgdXNlIHRoZSBoZWxwZXJzIGFuZCBoaWRlCj4gdGhlIGFrc3Ygc2Vs
ZWN0IGFzIGJlc3QgYXMgd2UgY2FuLgo+IAo+IFNpZ25lZC1vZmYtYnk6IFNlYW4gUGF1bCA8c2Vh
bnBhdWxAY2hyb21pdW0ub3JnPgo+IC0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RwLmMgfCA2NCArKysrKysrKysrKystLS0tLS0tLS0tLS0tCj4gIDEgZmlsZSBjaGFu
Z2VkLCAzMSBpbnNlcnRpb25zKCspLCAzMyBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCj4gaW5kZXggZDk1OGU3ODlhYjk2Li43YTQwN2M2NTFm
YjIgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5j
Cj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCj4gQEAgLTE1
MTUsMTIgKzE1MTUsMjkgQEAgaW50ZWxfZHBfYXV4X2hlYWRlcih1OCB0eGJ1ZltIRUFERVJfU0la
RV0sCj4gIAl0eGJ1ZlszXSA9IG1zZy0+c2l6ZSAtIDE7Cj4gIH0KPiAgCj4gK3N0YXRpYyB1MzIg
aW50ZWxfZHBfYXV4X2dlbmVyYXRlX3hmZXJfZmxhZ3Moc3RydWN0IGRybV9kcF9hdXhfbXNnICpt
c2cpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXgoJCQkJ
CSAgICAgICBjb25zdAoKIl9nZW5lcmF0ZV8iIHNlZW1zIGEgYml0IHJlZHVuZGFudC4KCj4gK3sK
PiArCWlmICgobXNnLT5yZXF1ZXN0ICYgfkRQX0FVWF9JMkNfTU9UKSAhPSBEUF9BVVhfTkFUSVZF
X1dSSVRFKQo+ICsJCXJldHVybiAwOwo+ICsKPiArCS8qCj4gKwkgKiBJZiB3ZSdyZSB0cnlpbmcg
dG8gc2VuZCB0aGUgSERDUCBBa3N2LCB3ZSBuZWVkIHRvIHNldCBhIHRoZSBBa3N2Cj4gKwkgKiBz
ZWxlY3QgYml0IHRvIGluZm9ybSB0aGUgaGFyZHdhcmUgdG8gc2VuZCB0aGUgQWtzdiBhZnRlciBv
dXIgaGVhZGVyCj4gKwkgKiBzaW5jZSB3ZSBjYW4ndCBhY2Nlc3MgdGhhdCBkYXRhIGZyb20gc29m
dHdhcmUuCj4gKwkgKi8KPiArCWlmIChtc2ctPmFkZHJlc3MgPT0gRFBfQVVYX0hEQ1BfQUtTVikK
PiArCQlyZXR1cm4gRFBfQVVYX0NIX0NUTF9BVVhfQUtTVl9TRUxFQ1Q7CgppZiAoRFBfQVVYX05B
VElWRV9XUklURSAmJgogICAgRFBfQVVYX0hEQ1BfQUtTVikKICAgIHJldHVybiAuLi47Cgp3b3Vs
ZCBiZSBhIGxpdHRsZSBtb3JlIGNsZWFyIHRvIG1lIHNpbmNlIHRoZSB0d28gdGhpbmdzIGFyZSBy
ZWxhdGVkIGhlcmUuCgo+ICsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICBzdGF0aWMgc3NpemVf
dAo+ICBpbnRlbF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0
IGRybV9kcF9hdXhfbXNnICptc2cpCj4gIHsKPiAgCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSBjb250YWluZXJfb2YoYXV4LCBzdHJ1Y3QgaW50ZWxfZHAsIGF1eCk7Cj4gIAl1OCB0eGJ1Zlsy
MF0sIHJ4YnVmWzIwXTsKPiAgCXNpemVfdCB0eHNpemUsIHJ4c2l6ZTsKPiArCXUzMiBmbGFncyA9
IGludGVsX2RwX2F1eF9nZW5lcmF0ZV94ZmVyX2ZsYWdzKG1zZyk7Cj4gIAlpbnQgcmV0Owo+ICAK
PiAgCWludGVsX2RwX2F1eF9oZWFkZXIodHhidWYsIG1zZyk7Cj4gQEAgLTE1NDEsNyArMTU1OCw3
IEBAIGludGVsX2RwX2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LCBzdHJ1Y3Qg
ZHJtX2RwX2F1eF9tc2cgKm1zZykKPiAgCQkJbWVtY3B5KHR4YnVmICsgSEVBREVSX1NJWkUsIG1z
Zy0+YnVmZmVyLCBtc2ctPnNpemUpOwo+ICAKPiAgCQlyZXQgPSBpbnRlbF9kcF9hdXhfeGZlcihp
bnRlbF9kcCwgdHhidWYsIHR4c2l6ZSwKPiAtCQkJCQlyeGJ1ZiwgcnhzaXplLCAwKTsKPiArCQkJ
CQlyeGJ1ZiwgcnhzaXplLCBmbGFncyk7Cj4gIAkJaWYgKHJldCA+IDApIHsKPiAgCQkJbXNnLT5y
ZXBseSA9IHJ4YnVmWzBdID4+IDQ7Cj4gIAo+IEBAIC0xNTY0LDcgKzE1ODEsNyBAQCBpbnRlbF9k
cF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9kcF9hdXhf
bXNnICptc2cpCj4gIAkJCXJldHVybiAtRTJCSUc7Cj4gIAo+ICAJCXJldCA9IGludGVsX2RwX2F1
eF94ZmVyKGludGVsX2RwLCB0eGJ1ZiwgdHhzaXplLAo+IC0JCQkJCXJ4YnVmLCByeHNpemUsIDAp
Owo+ICsJCQkJCXJ4YnVmLCByeHNpemUsIGZsYWdzKTsKPiAgCQlpZiAocmV0ID4gMCkgewo+ICAJ
CQltc2ctPnJlcGx5ID0gcnhidWZbMF0gPj4gNDsKPiAgCQkJLyoKPiBAQCAtNTg1OCwxNyArNTg3
NSw5IEBAIHN0YXRpYwo+ICBpbnQgaW50ZWxfZHBfaGRjcF93cml0ZV9hbl9ha3N2KHN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAo+ICAJCQkJdTggKmFuKQo+ICB7Cj4g
LQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZpbnRlbF9kaWdf
cG9ydC0+YmFzZS5iYXNlKTsKPiAtCXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2RwX2F1eF9tc2cg
bXNnID0gewo+IC0JCS5yZXF1ZXN0ID0gRFBfQVVYX05BVElWRV9XUklURSwKPiAtCQkuYWRkcmVz
cyA9IERQX0FVWF9IRENQX0FLU1YsCj4gLQkJLnNpemUgPSBEUk1fSERDUF9LU1ZfTEVOLAo+IC0J
fTsKPiAtCXU4IHR4YnVmW0hFQURFUl9TSVpFICsgRFJNX0hEQ1BfS1NWX0xFTl0gPSB7fSwgcnhi
dWZbMl0sIHJlcGx5ID0gMDsKPiArCXU4IHR4YnVmW0RSTV9IRENQX0tTVl9MRU5dID0ge307Cgpz
L3R4YnVmL2tzdi8gb3Igc29tZXRoaW5nIG1heWJlPwoKTG9va3MgcmVhc29uYWJsZSB0byBtZQpS
ZXZpZXdlZC1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNv
bT4KCj4gIAlzc2l6ZV90IGRwY2RfcmV0Owo+IC0JaW50IHJldDsKPiAgCj4gLQkvKiBPdXRwdXQg
QW4gZmlyc3QsIHRoYXQncyBlYXN5ICovCj4gIAlkcGNkX3JldCA9IGRybV9kcF9kcGNkX3dyaXRl
KCZpbnRlbF9kaWdfcG9ydC0+ZHAuYXV4LCBEUF9BVVhfSERDUF9BTiwKPiAgCQkJCSAgICAgYW4s
IERSTV9IRENQX0FOX0xFTik7Cj4gIAlpZiAoZHBjZF9yZXQgIT0gRFJNX0hEQ1BfQU5fTEVOKSB7
Cj4gQEAgLTU4NzgsMjkgKzU4ODcsMTggQEAgaW50IGludGVsX2RwX2hkY3Bfd3JpdGVfYW5fYWtz
dihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKPiAgCX0KPiAgCj4g
IAkvKgo+IC0JICogU2luY2UgQWtzdiBpcyBPaC1Tby1TZWNyZXQsIHdlIGNhbid0IGFjY2VzcyBp
dCBpbiBzb2Z0d2FyZS4gU28gaW4KPiAtCSAqIG9yZGVyIHRvIGdldCBpdCBvbiB0aGUgd2lyZSwg
d2UgbmVlZCB0byBjcmVhdGUgdGhlIEFVWCBoZWFkZXIgYXMgaWYKPiAtCSAqIHdlIHdlcmUgd3Jp
dGluZyB0aGUgZGF0YSwgYW5kIHRoZW4gdGlja2xlIHRoZSBoYXJkd2FyZSB0byBvdXRwdXQgdGhl
Cj4gLQkgKiBkYXRhIG9uY2UgdGhlIGhlYWRlciBpcyBzZW50IG91dC4KPiArCSAqIFNpbmNlIEFr
c3YgaXMgT2gtU28tU2VjcmV0LCB3ZSBjYW4ndCBhY2Nlc3MgaXQgaW4gc29mdHdhcmUuIFNvIHdl
Cj4gKwkgKiBzZW5kIGFuIGVtcHR5IGJ1ZmZlciBvZiB0aGUgY29ycmVjdCBsZW5ndGggdGhyb3Vn
aCB0aGUgRFAgaGVscGVycy4gT24KPiArCSAqIHRoZSBvdGhlciBzaWRlLCBpbiB0aGUgdHJhbnNm
ZXIgaG9vaywgd2UnbGwgZ2VuZXJhdGUgYSBmbGFnIGJhc2VkIG9uCj4gKwkgKiB0aGUgZGVzdGlu
YXRpb24gYWRkcmVzcyB3aGljaCB3aWxsIHRpY2tsZSB0aGUgaGFyZHdhcmUgdG8gb3V0cHV0IHRo
ZQo+ICsJICogQWtzdiBvbiBvdXIgYmVoYWxmIGFmdGVyIHRoZSBoZWFkZXIgaXMgc2VudC4KPiAg
CSAqLwo+IC0JaW50ZWxfZHBfYXV4X2hlYWRlcih0eGJ1ZiwgJm1zZyk7Cj4gLQo+IC0JcmV0ID0g
aW50ZWxfZHBfYXV4X3hmZXIoaW50ZWxfZHAsIHR4YnVmLCBIRUFERVJfU0laRSArIG1zZy5zaXpl
LAo+IC0JCQkJcnhidWYsIHNpemVvZihyeGJ1ZiksCj4gLQkJCQlEUF9BVVhfQ0hfQ1RMX0FVWF9B
S1NWX1NFTEVDVCk7Cj4gLQlpZiAocmV0IDwgMCkgewo+IC0JCURSTV9ERUJVR19LTVMoIldyaXRl
IEFrc3Ygb3ZlciBEUC9BVVggZmFpbGVkICglZClcbiIsIHJldCk7Cj4gLQkJcmV0dXJuIHJldDsK
PiAtCX0gZWxzZSBpZiAocmV0ID09IDApIHsKPiAtCQlEUk1fREVCVUdfS01TKCJBa3N2IHdyaXRl
IG92ZXIgRFAvQVVYIHdhcyBlbXB0eVxuIik7Cj4gLQkJcmV0dXJuIC1FSU87Cj4gLQl9Cj4gLQo+
IC0JcmVwbHkgPSAocnhidWZbMF0gPj4gNCkgJiBEUF9BVVhfTkFUSVZFX1JFUExZX01BU0s7Cj4g
LQlpZiAocmVwbHkgIT0gRFBfQVVYX05BVElWRV9SRVBMWV9BQ0spIHsKPiAtCQlEUk1fREVCVUdf
S01TKCJBa3N2IHdyaXRlOiBubyBEUF9BVVhfTkFUSVZFX1JFUExZX0FDSyAleFxuIiwKPiAtCQkJ
ICAgICAgcmVwbHkpOwo+IC0JCXJldHVybiAtRUlPOwo+ICsJZHBjZF9yZXQgPSBkcm1fZHBfZHBj
ZF93cml0ZSgmaW50ZWxfZGlnX3BvcnQtPmRwLmF1eCwgRFBfQVVYX0hEQ1BfQUtTViwKPiArCQkJ
CSAgICAgdHhidWYsIERSTV9IRENQX0tTVl9MRU4pOwo+ICsJaWYgKGRwY2RfcmV0ICE9IERSTV9I
RENQX0tTVl9MRU4pIHsKPiArCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3JpdGUgQWtzdiBv
dmVyIERQL0FVWCAoJXpkKVxuIiwKPiArCQkJICAgICAgZHBjZF9yZXQpOwo+ICsJCXJldHVybiBk
cGNkX3JldCA+PSAwID8gLUVJTyA6IGRwY2RfcmV0Owo+ICAJfQo+ICAJcmV0dXJuIDA7Cj4gIH0K
PiAtLSAKPiBTZWFuIFBhdWwsIFNvZnR3YXJlIEVuZ2luZWVyLCBHb29nbGUgLyBDaHJvbWl1bSBP
Uwo+IAo+IF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCj4g
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdAo+IEludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
PiBodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eAoKLS0gClZpbGxlIFN5cmrDpGzDpApJbnRlbApfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWw=
