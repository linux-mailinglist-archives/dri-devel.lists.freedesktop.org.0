Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 75F83FF5F8
	for <lists+dri-devel@lfdr.de>; Sat, 16 Nov 2019 23:02:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E0C4F6E23D;
	Sat, 16 Nov 2019 22:01:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM01-BN3-obe.outbound.protection.outlook.com
 (mail-eopbgr740082.outbound.protection.outlook.com [40.107.74.82])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 691596E200;
 Sat, 16 Nov 2019 22:01:45 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=giZxNQbQdW64OXZBdHpDUjeTcjoS0wI8dlzh7BxZ1URz0r3jI6vuOupkkhEBNjYyfGyYFmZVdrz/5kXhWv+6zLR1SztM0gLcV+jOKrjNVczdkIciHIv/T+OwdGsW3AuYErzRPCnu4mZLtjz4rQwCOsOCp28Do3/V7kT/0RbkFsIQIUBrPtiOE3yrYsVSSr+pU18AeUVg1ItGJwDWSehHV3CBvc17fCyXocyJnZ6nBSVYGxXeETVWDHC8Ii27+gyFJ8kQ7XTM+slkAPC06F5VE5InAhJlfRnqhpdELqHRSuMx5g58cZGg4h3yPEOki9nlDP9o6WNAm8yD/6iIAYmDRw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=rUuaApgRolw794c/sGDLtgj4vjNBqE+1oYNOTQAL+vY=;
 b=MKnQwHXiPiheg2AXq56fFOsdXoA/K4WQ2PHEmb9wMdfCkC4E5jcDvHWXjN1zLhwOJve5q3iUbTQ9hmZnKK4mtpekDcs4yeW1bneB1O1iUXcULIu2lo4zkm2UKsC+rSkRjnldiypQw3V9Gfd8iLBvtXDd+qe50yrDHRdX4MhsTMrYbLpPD8wBPDN3kDtKqeqeTAZRlsTy2+xm1NLgCMxRVuPj569eHJn3Gb7DlAqv7w98YODabrdAOhCTumzhpAa9PxjaefViAEFPp7M/p8M8fSCnO1/5Qf2m0pJpBh7qj2B23AwqpL/uMym2zrqxDl0rmsKsxDBMbVdzsX2ghU+4gg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from CY4PR1201CA0017.namprd12.prod.outlook.com
 (2603:10b6:910:16::27) by DM5PR1201MB2504.namprd12.prod.outlook.com
 (2603:10b6:3:e3::22) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2451.27; Sat, 16 Nov
 2019 22:01:43 +0000
Received: from CO1NAM11FT025.eop-nam11.prod.protection.outlook.com
 (2a01:111:f400:7eab::200) by CY4PR1201CA0017.outlook.office365.com
 (2603:10b6:910:16::27) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2451.23 via Frontend
 Transport; Sat, 16 Nov 2019 22:01:43 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXMB02.amd.com (165.204.84.17) by
 CO1NAM11FT025.mail.protection.outlook.com (10.13.175.232) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.2451.23 via Frontend Transport; Sat, 16 Nov 2019 22:01:42 +0000
Received: from SATLEXMB01.amd.com (10.181.40.142) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1713.5; Sat, 16 Nov
 2019 16:01:39 -0600
Received: from mlipski-pc.amd.com (10.180.168.240) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server id 15.1.1713.5 via Frontend
 Transport; Sat, 16 Nov 2019 16:01:39 -0600
From: <mikita.lipski@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v7 15/17] drm/amd/display: MST DSC compute fair share
Date: Sat, 16 Nov 2019 17:01:26 -0500
Message-ID: <20191116220128.16598-16-mikita.lipski@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191116220128.16598-1-mikita.lipski@amd.com>
References: <20191116220128.16598-1-mikita.lipski@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(396003)(376002)(39860400002)(136003)(346002)(428003)(199004)(189003)(50226002)(8936002)(6916009)(336012)(305945005)(8676002)(11346002)(316002)(446003)(16586007)(81156014)(81166006)(476003)(486006)(126002)(2616005)(4326008)(426003)(36756003)(2906002)(2876002)(48376002)(478600001)(2351001)(50466002)(53416004)(47776003)(26005)(54906003)(5660300002)(186003)(70586007)(1076003)(30864003)(70206006)(51416003)(7696005)(76176011)(86362001)(14444005)(6666004)(356004)(16060500001);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM5PR1201MB2504; H:SATLEXMB02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 7439feac-23a8-4d2e-2fb6-08d76ae090c6
X-MS-TrafficTypeDiagnostic: DM5PR1201MB2504:
X-Microsoft-Antispam-PRVS: <DM5PR1201MB2504A651BD862B0FFFDE2532E4730@DM5PR1201MB2504.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:1265;
X-Forefront-PRVS: 02234DBFF6
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: eDR48zxa/UZCZYnqxIRScqKJK1FEixByrWfZuy7I+uFcbcScammoawJTUCssyQeVfKAtEBtEKtXXAjPwKd0qM+kALZnrTk6Jlj3Kq5fzmwGiZrdZOuJSGR3uM1HE314RkAatTowihRDvYGxGN6h8VXdoYDhre7L+f958hRaH8Gzu4UIgE/8BW6dii5t2azXIiw0F5cDu7S9IhK+HfYaPwSaGVhqE8U02yvoFVd7+l0d66GdAAz5xZJVY7oYHTLz3YcpHgTwsHp/gWHyF+VqtJouZndTHFaAJubIyRHgqgLx5Fj6G2yjuZJ2nITVw7SUfsvT8i4p9VGezBqFOFPQkRGheEauPsIkIfbSG9wdgTjn/kgjYo01BvPa7lZc6B13QbP+tLxANJIF/6loUTqPJmoQXDM7Gx7CEhoC5WKJeUgroZhr4XKa6Im6x+j/auuZ/
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 16 Nov 2019 22:01:42.8739 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 7439feac-23a8-4d2e-2fb6-08d76ae090c6
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM5PR1201MB2504
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=rUuaApgRolw794c/sGDLtgj4vjNBqE+1oYNOTQAL+vY=;
 b=C11X8LZc3XzKi2r6xclnuJWDHpuEwg15CrpH9i6ErMNsDe7k767NPHqLcWv8YVFRyn7A4H3+oxhuWL6I7Q9Ll6qhUZBktcJ8B19M4OZXsiG6XFlPPosxHrMJgSO8D8C7q9JswAJeekfsMLXGYtMqKnr3BFB6mwwi20ADxiRFrTg=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Francis <David.Francis@amd.com>, Mikita
 Lipski <mikita.lipski@amd.com>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGF2aWQgRnJhbmNpcyA8RGF2aWQuRnJhbmNpc0BhbWQuY29tPgoKSWYgdGhlcmUgaXMg
bGltaXRlZCBsaW5rIGJhbmR3aWR0aCBvbiBhIE1TVCBuZXR3b3JrLAppdCBtdXN0IGJlIGRpdmlk
ZWQgZmFpcmx5IGJldHdlZW4gdGhlIHN0cmVhbXMgb24gdGhhdCBuZXR3b3JrCgpJbXBsZW1lbnQg
YW4gYWxnb3JpdGhtIHRvIGRldGVybWluZSB0aGUgY29ycmVjdCBEU0MgY29uZmlnCmZvciBlYWNo
IHN0cmVhbQoKVGhlIGFsZ29yaXRobToKVGhpcwogICAgIFsgICAgICAgICAgICAgICAgICAgXSAg
ICAgICAgICAoICkKcmVwcmVzZW50cyB0aGUgcmFuZ2Ugb2YgYmFuZHdpZHRocyBwb3NzaWJsZSBm
b3IgYSBnaXZlbiBzdHJlYW0uClRoZSBbXSBhcmVhIHJlcHJlc2VudHMgdGhlIHJhbmdlIG9mIERT
QyBjb25maWdzLCBhbmQgdGhlICgpCnJlcHJlc2VudHMgbm8gRFNDLiBUaGUgYmFuZHdpZHRoIHVz
ZWQgaW5jcmVhc2VzIGZyb20gbGVmdCB0byByaWdodC4KCkZpcnN0LCB0cnkgZGlzYWJsaW5nIERT
QyBvbiBhbGwgc3RyZWFtcwogICAgIFsgICAgICAgICAgICAgICAgICBdICAgICAgICAgICh8KQog
ICAgIFsgICAgICAgICAgICAgICAgICAgICBdICAgICAgICAgICAgKHwpCkNoZWNrIHRoaXMgYWdh
aW5zdCB0aGUgYmFuZHdpZHRoIGxpbWl0cyBvZiB0aGUgbGluayBhbmQgZWFjaCBicmFuY2gKKGlu
Y2x1ZGluZyBlYWNoIGVuZHBvaW50KS4gSWYgaXQgcGFzc2VzLCB0aGUgam9iIGlzIGRvbmUKClNl
Y29uZCwgdHJ5IG1heGltdW0gRFNDIGNvbXByZXNzaW9uIG9uIGFsbCBzdHJlYW1zCnRoYXQgc3Vw
cG9ydCBEU0MKICAgICBbfCAgICAgICAgIF0gICAgICAgICggKQogICAgIFt8ICAgICAgICAgICAg
ICAgIF0gICAgICAgICAoICkKSWYgdGhpcyBkb2VzIG5vdCBwYXNzLCB0aGVuIGVuYWJsaW5nIHRo
aXMgY29tYmluYXRpb24gb2Ygc3RyZWFtcwppcyBpbXBvc3NpYmxlCgpPdGhlcndpc2UsIGRpdmlk
ZSB0aGUgcmVtYWluaW5nIGJhbmR3aWR0aCBldmVubHkgYW1vbmdzdCB0aGUgc3RyZWFtcwogICAg
IFsgICAgICAgIHwgIF0gICAgICAgICAoICkKICAgICBbICAgICAgICB8ICAgICAgXSAgICAgICAg
KCApCgpJZiBvbmUgb3IgbW9yZSBvZiB0aGUgc3RyZWFtcyByZWFjaCBtaW5pbXVtIGNvbXByZXNz
aW9uLCBldmVubHkKZGl2aWRlIHRoZSByZWFtaW5pbmcgYmFuZHdpZHRoIGFtb25nc3QgdGhlIHJl
bWFpbmluZyBzdHJlYW1zCiAgICAgWyAgICB8XSAoICkKICAgICBbICAgICAgIHxdICAgKCApCiAg
ICAgWyAgICAgICAgICAgICAgICAgfCAgIF0gICAgICAgICAgICAgICAoICkKICAgICBbICAgICAg
ICAgICAgICAgICB8ICAgICAgXSAgICAgICAgICAgICAgICAgICggKQoKSWYgYWxsIHN0cmVhbXMg
Y2FuIHJlYWNoIG1pbmltdW0gY29tcHJlc3Npb24sIGRpc2FibGUgY29tcHJlc3Npb24KZ3JlZWRp
bHkKICAgICBbICAgICAgfF0gICggKQogICAgIFsgICAgICAgIHxdICAgICggKQogICAgIFsgICAg
ICAgICAgICAgICAgIF0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh8KQoKUGVyZm9y
bSB0aGlzIGFsZ29yaXRobSBvbiBlYWNoIGZ1bGwgdXBkYXRlLCBvbiBlYWNoIE1TVCBsaW5rCndp
dGggYXQgbGVhc3Qgb25lIERTQyBzdHJlYW0gb24gaXQKCkFmdGVyIHRoZSBjb25maWdzIGFyZSBj
b21wdXRlZCwgY2FsbApkY24yMF9hZGRfZHNjX3RvX3N0cmVhbV9yZXNvdXJjZSBvbiBlYWNoIHN0
cmVhbSB3aXRoIERTQyBlbmFibGVkLgpJdCBpcyBvbmx5IGFmdGVyIGFsbCBzdHJlYW1zIGFyZSBj
cmVhdGVkIHRoYXQgd2UgY2FuIGtub3cgd2hpY2gKb2YgdGhlbSB3aWxsIG5lZWQgRFNDLgoKRG8g
YWxsIG9mIHRoaXMgYXQgdGhlIGVuZCBvZiBhbWRncHUgYXRvbWljIGNoZWNrLiAgSWYgaXQgZmFp
bHMsCmZhaWwgY2hlY2s7IFRoaXMgY29tYmluYXRpb24gb2YgdGltaW5ncyBjYW5ub3QgYmUgc3Vw
cG9ydGVkLgoKdjI6IFVzZSBkcm1fZHBfbXN0X2F0b21pY19jaGVjayB0byB2YWxpZGF0ZSBidyBm
b3IgY2VydGFpbiBkc2MKY29uZmlndXJhdGlvbnMKClJldmlld2VkLWJ5OiBXZW5qaW5nIExpdSA8
V2VuamluZy5MaXVAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogRGF2aWQgRnJhbmNpcyA8RGF2aWQu
RnJhbmNpc0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBNaWtpdGEgTGlwc2tpIDxtaWtpdGEubGlw
c2tpQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdw
dV9kbS5jIHwgICAzICsKIC4uLi9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG1fbXN0X3R5cGVz
LmMgICB8IDM2MiArKysrKysrKysrKysrKysrKy0KIC4uLi9kaXNwbGF5L2FtZGdwdV9kbS9hbWRn
cHVfZG1fbXN0X3R5cGVzLmggICB8ICAgMyArCiAuLi4vZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIw
L2RjbjIwX3Jlc291cmNlLmMgfCAgIDcgKy0KIC4uLi9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAv
ZGNuMjBfcmVzb3VyY2UuaCB8ICAgMSArCiA1IGZpbGVzIGNoYW5nZWQsIDM3MiBpbnNlcnRpb25z
KCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlz
cGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkv
YW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4IDM2NTdhMjZjZTFkMS4uN2Q4ZTI0NGU1MjEwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9k
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2Rt
LmMKQEAgLTgwOTAsNiArODA5MCw5IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RtX2F0b21pY19jaGVj
ayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlpZiAocmV0KQogCQkJZ290byBmYWlsOwogCisJ
CWlmICghY29tcHV0ZV9tc3RfZHNjX2NvbmZpZ3NfZm9yX3N0YXRlKHN0YXRlLCBkbV9zdGF0ZS0+
Y29udGV4dCkpCisJCQlnb3RvIGZhaWw7CisKIAkJaWYgKGRjX3ZhbGlkYXRlX2dsb2JhbF9zdGF0
ZShkYywgZG1fc3RhdGUtPmNvbnRleHQsIGZhbHNlKSAhPSBEQ19PSykgewogCQkJcmV0ID0gLUVJ
TlZBTDsKIAkJCWdvdG8gZmFpbDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlz
cGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG1fbXN0X3R5cGVzLmMKaW5kZXggZThhMGVmODgz
NDM0Li43MGVkN2YzZDk4MTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxh
eS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5jCkBAIC00MCw2ICs0MCwx
MCBAQAogI2lmIGRlZmluZWQoQ09ORklHX0RFQlVHX0ZTKQogI2luY2x1ZGUgImFtZGdwdV9kbV9k
ZWJ1Z2ZzLmgiCiAjZW5kaWYKKworCisjaW5jbHVkZSAiZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2Uu
aCIKKwogLyogI2RlZmluZSBUUkFDRV9EUENEICovCiAKICNpZmRlZiBUUkFDRV9EUENECkBAIC0y
NjMsMTEgKzI2Nyw5IEBAIHN0YXRpYyBpbnQgZG1fZHBfbXN0X2dldF9tb2RlcyhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCQkJYW1kZ3B1X2RtX3VwZGF0ZV9mcmVlc3luY19jYXBz
KAogCQkJCQljb25uZWN0b3IsIGFjb25uZWN0b3ItPmVkaWQpOwogCi0jaWZkZWYgQ09ORklHX0RS
TV9BTURfRENfRFNDX1NVUFBPUlQKIAkJCWlmICghdmFsaWRhdGVfZHNjX2NhcHNfb25fY29ubmVj
dG9yKGFjb25uZWN0b3IpKQogCQkJCW1lbXNldCgmYWNvbm5lY3Rvci0+ZGNfc2luay0+c2lua19k
c2NfY2FwcywKIAkJCQkgICAgICAgMCwgc2l6ZW9mKGFjb25uZWN0b3ItPmRjX3NpbmstPnNpbmtf
ZHNjX2NhcHMpKTsKLSNlbmRpZgogCQl9CiAJfQogCkBAIC01MDUsMyArNTA3LDM1OSBAQCBpbnQg
ZG1fbXN0X2dldF9wYm5fZGl2aWRlcihzdHJ1Y3QgZGNfbGluayAqbGluaykKIAlyZXR1cm4gZGNf
bGlua19iYW5kd2lkdGhfa2JwcyhsaW5rLAogCQkJZGNfbGlua19nZXRfbGlua19jYXAobGluaykp
IC8gKDggKiAxMDAwICogNTQpOwogfQorCitzdHJ1Y3QgZHNjX21zdF9mYWlybmVzc19wYXJhbXMg
eworCXN0cnVjdCBkY19jcnRjX3RpbWluZyAqdGltaW5nOworCXN0cnVjdCBkY19zaW5rICpzaW5r
OworCXN0cnVjdCBkY19kc2NfYndfcmFuZ2UgYndfcmFuZ2U7CisJYm9vbCBjb21wcmVzc2lvbl9w
b3NzaWJsZTsKKwlzdHJ1Y3QgZHJtX2RwX21zdF9wb3J0ICpwb3J0OworfTsKKworc3RydWN0IGRz
Y19tc3RfZmFpcm5lc3NfdmFycyB7CisJaW50IHBibjsKKwlib29sIGRzY19lbmFibGVkOworCWlu
dCBicHBfeDE2OworfTsKKworc3RhdGljIGludCBrYnBzX3RvX3BlYWtfcGJuKGludCBrYnBzKQor
eworCXU2NCBwZWFrX2ticHMgPSBrYnBzOworCisJcGVha19rYnBzICo9IDEwMDY7CisJcGVha19r
YnBzIC89IDEwMDA7CisJcmV0dXJuIChpbnQpIERJVl9ST1VORF9VUChwZWFrX2ticHMgKiA2NCwg
KDU0ICogOCAqIDEwMDApKTsKK30KKworc3RhdGljIHZvaWQgc2V0X2RzY19jb25maWdzX2Zyb21f
ZmFpcm5lc3NfdmFycyhzdHJ1Y3QgZHNjX21zdF9mYWlybmVzc19wYXJhbXMgKnBhcmFtcywKKwkJ
c3RydWN0IGRzY19tc3RfZmFpcm5lc3NfdmFycyAqdmFycywKKwkJaW50IGNvdW50KQoreworCWlu
dCBpOworCisJZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJbWVtc2V0KCZwYXJhbXNb
aV0udGltaW5nLT5kc2NfY2ZnLCAwLCBzaXplb2YocGFyYW1zW2ldLnRpbWluZy0+ZHNjX2NmZykp
OworCQlpZiAodmFyc1tpXS5kc2NfZW5hYmxlZCAmJiBkY19kc2NfY29tcHV0ZV9jb25maWcoCisJ
CQkJCXBhcmFtc1tpXS5zaW5rLT5jdHgtPmRjLT5yZXNfcG9vbC0+ZHNjc1swXSwKKwkJCQkJJnBh
cmFtc1tpXS5zaW5rLT5zaW5rX2RzY19jYXBzLmRzY19kZWNfY2FwcywKKwkJCQkJcGFyYW1zW2ld
LnNpbmstPmN0eC0+ZGMtPmRlYnVnLmRzY19taW5fc2xpY2VfaGVpZ2h0X292ZXJyaWRlLAorCQkJ
CQkwLAorCQkJCQlwYXJhbXNbaV0udGltaW5nLAorCQkJCQkmcGFyYW1zW2ldLnRpbWluZy0+ZHNj
X2NmZykpIHsKKwkJCXBhcmFtc1tpXS50aW1pbmctPmZsYWdzLkRTQyA9IDE7CisJCQlwYXJhbXNb
aV0udGltaW5nLT5kc2NfY2ZnLmJpdHNfcGVyX3BpeGVsID0gdmFyc1tpXS5icHBfeDE2OworCQl9
IGVsc2UgeworCQkJcGFyYW1zW2ldLnRpbWluZy0+ZmxhZ3MuRFNDID0gMDsKKwkJfQorCX0KK30K
Kworc3RhdGljIGludCBicHBfeDE2X2Zyb21fcGJuKHN0cnVjdCBkc2NfbXN0X2ZhaXJuZXNzX3Bh
cmFtcyBwYXJhbSwgaW50IHBibikKK3sKKwlzdHJ1Y3QgZGNfZHNjX2NvbmZpZyBkc2NfY29uZmln
OworCXU2NCBrYnBzOworCisJa2JwcyA9ICh1NjQpcGJuICogOTk0ICogOCAqIDU0IC8gNjQ7CisJ
ZGNfZHNjX2NvbXB1dGVfY29uZmlnKAorCQkJcGFyYW0uc2luay0+Y3R4LT5kYy0+cmVzX3Bvb2wt
PmRzY3NbMF0sCisJCQkmcGFyYW0uc2luay0+c2lua19kc2NfY2Fwcy5kc2NfZGVjX2NhcHMsCisJ
CQlwYXJhbS5zaW5rLT5jdHgtPmRjLT5kZWJ1Zy5kc2NfbWluX3NsaWNlX2hlaWdodF9vdmVycmlk
ZSwKKwkJCShpbnQpIGticHMsIHBhcmFtLnRpbWluZywgJmRzY19jb25maWcpOworCisJcmV0dXJu
IGRzY19jb25maWcuYml0c19wZXJfcGl4ZWw7Cit9CisKK3N0YXRpYyB2b2lkIGluY3JlYXNlX2Rz
Y19icHAoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICAgICBzdHJ1Y3QgZGNf
bGluayAqZGNfbGluaywKKwkJCSAgICAgc3RydWN0IGRzY19tc3RfZmFpcm5lc3NfcGFyYW1zICpw
YXJhbXMsCisJCQkgICAgIHN0cnVjdCBkc2NfbXN0X2ZhaXJuZXNzX3ZhcnMgKnZhcnMsCisJCQkg
ICAgIGludCBjb3VudCkKK3sKKwlpbnQgaTsKKwlib29sIGJwcF9pbmNyZWFzZWRbTUFYX1BJUEVT
XTsKKwlpbnQgaW5pdGlhbF9zbGFja1tNQVhfUElQRVNdOworCWludCBtaW5faW5pdGlhbF9zbGFj
azsKKwlpbnQgbmV4dF9pbmRleDsKKwlpbnQgcmVtYWluaW5nX3RvX2luY3JlYXNlID0gMDsKKwlp
bnQgcGJuX3Blcl90aW1lc2xvdDsKKwlpbnQgbGlua190aW1lc2xvdHNfdXNlZDsKKwlpbnQgZmFp
cl9wYm5fYWxsb2M7CisKKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgeworCQlpZiAodmFy
c1tpXS5kc2NfZW5hYmxlZCkgeworCQkJaW5pdGlhbF9zbGFja1tpXSA9IGticHNfdG9fcGVha19w
Ym4ocGFyYW1zW2ldLmJ3X3JhbmdlLm1heF9rYnBzKSAtIHZhcnNbaV0ucGJuOworCQkJYnBwX2lu
Y3JlYXNlZFtpXSA9IGZhbHNlOworCQkJcmVtYWluaW5nX3RvX2luY3JlYXNlICs9IDE7CisJCX0g
ZWxzZSB7CisJCQlpbml0aWFsX3NsYWNrW2ldID0gMDsKKwkJCWJwcF9pbmNyZWFzZWRbaV0gPSB0
cnVlOworCQl9CisJfQorCisJcGJuX3Blcl90aW1lc2xvdCA9IGRjX2xpbmtfYmFuZHdpZHRoX2ti
cHMoZGNfbGluaywKKwkJCWRjX2xpbmtfZ2V0X2xpbmtfY2FwKGRjX2xpbmspKSAvICg4ICogMTAw
MCAqIDU0KTsKKworCXdoaWxlIChyZW1haW5pbmdfdG9faW5jcmVhc2UpIHsKKwkJbmV4dF9pbmRl
eCA9IC0xOworCQltaW5faW5pdGlhbF9zbGFjayA9IC0xOworCQlmb3IgKGkgPSAwOyBpIDwgY291
bnQ7IGkrKykgeworCQkJaWYgKCFicHBfaW5jcmVhc2VkW2ldKSB7CisJCQkJaWYgKG1pbl9pbml0
aWFsX3NsYWNrID09IC0xIHx8IG1pbl9pbml0aWFsX3NsYWNrID4gaW5pdGlhbF9zbGFja1tpXSkg
eworCQkJCQltaW5faW5pdGlhbF9zbGFjayA9IGluaXRpYWxfc2xhY2tbaV07CisJCQkJCW5leHRf
aW5kZXggPSBpOworCQkJCX0KKwkJCX0KKwkJfQorCisJCWlmIChuZXh0X2luZGV4ID09IC0xKQor
CQkJYnJlYWs7CisKKwkJbGlua190aW1lc2xvdHNfdXNlZCA9IDA7CisKKwkJZm9yIChpID0gMDsg
aSA8IGNvdW50OyBpKyspCisJCQlsaW5rX3RpbWVzbG90c191c2VkICs9IERJVl9ST1VORF9VUCh2
YXJzW2ldLnBibiwgcGJuX3Blcl90aW1lc2xvdCk7CisKKwkJZmFpcl9wYm5fYWxsb2MgPSAoNjMg
LSBsaW5rX3RpbWVzbG90c191c2VkKSAvIHJlbWFpbmluZ190b19pbmNyZWFzZSAqIHBibl9wZXJf
dGltZXNsb3Q7CisKKwkJaWYgKGluaXRpYWxfc2xhY2tbbmV4dF9pbmRleF0gPiBmYWlyX3Bibl9h
bGxvYykgeworCQkJdmFyc1tuZXh0X2luZGV4XS5wYm4gKz0gZmFpcl9wYm5fYWxsb2M7CisJCQlk
cm1fZHBfYXRvbWljX2ZpbmRfdmNwaV9zbG90cyhzdGF0ZSwKKwkJCQkJCSAgICAgIHBhcmFtc1tu
ZXh0X2luZGV4XS5wb3J0LT5tZ3IsCisJCQkJCQkgICAgICBwYXJhbXNbbmV4dF9pbmRleF0ucG9y
dCwKKwkJCQkJCSAgICAgIHZhcnNbbmV4dF9pbmRleF0ucGJuLAorCQkJCQkJICAgICAgZG1fbXN0
X2dldF9wYm5fZGl2aWRlcihkY19saW5rKSk7CisJCQlpZiAoIWRybV9kcF9tc3RfYXRvbWljX2No
ZWNrKHN0YXRlKSkgeworCQkJCXZhcnNbbmV4dF9pbmRleF0uYnBwX3gxNiA9IGJwcF94MTZfZnJv
bV9wYm4ocGFyYW1zW25leHRfaW5kZXhdLCB2YXJzW25leHRfaW5kZXhdLnBibik7CisJCQl9IGVs
c2UgeworCQkJCXZhcnNbbmV4dF9pbmRleF0ucGJuIC09IGZhaXJfcGJuX2FsbG9jOworCQkJCWRy
bV9kcF9hdG9taWNfZmluZF92Y3BpX3Nsb3RzKHN0YXRlLAorCQkJCQkJICAgICAgcGFyYW1zW25l
eHRfaW5kZXhdLnBvcnQtPm1nciwKKwkJCQkJCSAgICAgIHBhcmFtc1tuZXh0X2luZGV4XS5wb3J0
LAorCQkJCQkJICAgICAgdmFyc1tuZXh0X2luZGV4XS5wYm4sCisJCQkJCQkgICAgICBkbV9tc3Rf
Z2V0X3Bibl9kaXZpZGVyKGRjX2xpbmspKTsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCXZhcnNbbmV4
dF9pbmRleF0ucGJuICs9IGluaXRpYWxfc2xhY2tbbmV4dF9pbmRleF07CisJCQlkcm1fZHBfYXRv
bWljX2ZpbmRfdmNwaV9zbG90cyhzdGF0ZSwKKwkJCQkJCSAgICAgIHBhcmFtc1tuZXh0X2luZGV4
XS5wb3J0LT5tZ3IsCisJCQkJCQkgICAgICBwYXJhbXNbbmV4dF9pbmRleF0ucG9ydCwKKwkJCQkJ
CSAgICAgIHZhcnNbbmV4dF9pbmRleF0ucGJuLAorCQkJCQkJICAgICAgZG1fbXN0X2dldF9wYm5f
ZGl2aWRlcihkY19saW5rKSk7CisJCQlpZiAoIWRybV9kcF9tc3RfYXRvbWljX2NoZWNrKHN0YXRl
KSkgeworCQkJCXZhcnNbbmV4dF9pbmRleF0uYnBwX3gxNiA9IHBhcmFtc1tuZXh0X2luZGV4XS5i
d19yYW5nZS5tYXhfdGFyZ2V0X2JwcF94MTY7CisJCQl9IGVsc2UgeworCQkJCXZhcnNbbmV4dF9p
bmRleF0ucGJuIC09IGluaXRpYWxfc2xhY2tbbmV4dF9pbmRleF07CisJCQkJZHJtX2RwX2F0b21p
Y19maW5kX3ZjcGlfc2xvdHMoc3RhdGUsCisJCQkJCQkgICAgICBwYXJhbXNbbmV4dF9pbmRleF0u
cG9ydC0+bWdyLAorCQkJCQkJICAgICAgcGFyYW1zW25leHRfaW5kZXhdLnBvcnQsCisJCQkJCQkg
ICAgICB2YXJzW25leHRfaW5kZXhdLnBibiwKKwkJCQkJCSAgICAgIGRtX21zdF9nZXRfcGJuX2Rp
dmlkZXIoZGNfbGluaykpOworCQkJfQorCQl9CisKKwkJYnBwX2luY3JlYXNlZFtuZXh0X2luZGV4
XSA9IHRydWU7CisJCXJlbWFpbmluZ190b19pbmNyZWFzZS0tOworCX0KK30KKworc3RhdGljIHZv
aWQgdHJ5X2Rpc2FibGVfZHNjKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAg
ICBzdHJ1Y3QgZGNfbGluayAqZGNfbGluaywKKwkJCSAgICBzdHJ1Y3QgZHNjX21zdF9mYWlybmVz
c19wYXJhbXMgKnBhcmFtcywKKwkJCSAgICBzdHJ1Y3QgZHNjX21zdF9mYWlybmVzc192YXJzICp2
YXJzLAorCQkJICAgIGludCBjb3VudCkKK3sKKwlpbnQgaTsKKwlib29sIHRyaWVkW01BWF9QSVBF
U107CisJaW50IGticHNfaW5jcmVhc2VbTUFYX1BJUEVTXTsKKwlpbnQgbWF4X2ticHNfaW5jcmVh
c2U7CisJaW50IG5leHRfaW5kZXg7CisJaW50IHJlbWFpbmluZ190b190cnkgPSAwOworCisJZm9y
IChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJaWYgKHZhcnNbaV0uZHNjX2VuYWJsZWQgJiYg
dmFyc1tpXS5icHBfeDE2ID09IHBhcmFtc1tpXS5id19yYW5nZS5tYXhfdGFyZ2V0X2JwcF94MTYp
IHsKKwkJCWticHNfaW5jcmVhc2VbaV0gPSBwYXJhbXNbaV0uYndfcmFuZ2Uuc3RyZWFtX2ticHMg
LSBwYXJhbXNbaV0uYndfcmFuZ2UubWF4X2ticHM7CisJCQl0cmllZFtpXSA9IGZhbHNlOworCQkJ
cmVtYWluaW5nX3RvX3RyeSArPSAxOworCQl9IGVsc2UgeworCQkJa2Jwc19pbmNyZWFzZVtpXSA9
IDA7CisJCQl0cmllZFtpXSA9IHRydWU7CisJCX0KKwl9CisKKwl3aGlsZSAocmVtYWluaW5nX3Rv
X3RyeSkgeworCQluZXh0X2luZGV4ID0gLTE7CisJCW1heF9rYnBzX2luY3JlYXNlID0gLTE7CisJ
CWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCQlpZiAoIXRyaWVkW2ldKSB7CisJCQkJ
aWYgKG1heF9rYnBzX2luY3JlYXNlID09IC0xIHx8IG1heF9rYnBzX2luY3JlYXNlIDwga2Jwc19p
bmNyZWFzZVtpXSkgeworCQkJCQltYXhfa2Jwc19pbmNyZWFzZSA9IGticHNfaW5jcmVhc2VbaV07
CisJCQkJCW5leHRfaW5kZXggPSBpOworCQkJCX0KKwkJCX0KKwkJfQorCisJCWlmIChuZXh0X2lu
ZGV4ID09IC0xKQorCQkJYnJlYWs7CisKKwkJdmFyc1tuZXh0X2luZGV4XS5wYm4gPSBrYnBzX3Rv
X3BlYWtfcGJuKHBhcmFtc1tuZXh0X2luZGV4XS5id19yYW5nZS5zdHJlYW1fa2Jwcyk7CisJCWRy
bV9kcF9hdG9taWNfZmluZF92Y3BpX3Nsb3RzKHN0YXRlLAorCQkJCQkgICAgICBwYXJhbXNbbmV4
dF9pbmRleF0ucG9ydC0+bWdyLAorCQkJCQkgICAgICBwYXJhbXNbbmV4dF9pbmRleF0ucG9ydCwK
KwkJCQkJICAgICAgdmFyc1tuZXh0X2luZGV4XS5wYm4sCisJCQkJCSAgICAgIDApOworCisJCWlm
ICghZHJtX2RwX21zdF9hdG9taWNfY2hlY2soc3RhdGUpKSB7CisJCQl2YXJzW25leHRfaW5kZXhd
LmRzY19lbmFibGVkID0gZmFsc2U7CisJCQl2YXJzW25leHRfaW5kZXhdLmJwcF94MTYgPSAwOwor
CQl9IGVsc2UgeworCQkJdmFyc1tuZXh0X2luZGV4XS5wYm4gPSBrYnBzX3RvX3BlYWtfcGJuKHBh
cmFtc1tuZXh0X2luZGV4XS5id19yYW5nZS5tYXhfa2Jwcyk7CisJCQlkcm1fZHBfYXRvbWljX2Zp
bmRfdmNwaV9zbG90cyhzdGF0ZSwKKwkJCQkJICAgICAgcGFyYW1zW25leHRfaW5kZXhdLnBvcnQt
Pm1nciwKKwkJCQkJICAgICAgcGFyYW1zW25leHRfaW5kZXhdLnBvcnQsCisJCQkJCSAgICAgIHZh
cnNbbmV4dF9pbmRleF0ucGJuLAorCQkJCQkgICAgICBkbV9tc3RfZ2V0X3Bibl9kaXZpZGVyKGRj
X2xpbmspKTsKKwkJfQorCisJCXRyaWVkW25leHRfaW5kZXhdID0gdHJ1ZTsKKwkJcmVtYWluaW5n
X3RvX3RyeS0tOworCX0KK30KKworc3RhdGljIGJvb2wgY29tcHV0ZV9tc3RfZHNjX2NvbmZpZ3Nf
Zm9yX2xpbmsoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCQkgICAgIHN0cnVj
dCBkY19zdGF0ZSAqZGNfc3RhdGUsCisJCQkJCSAgICAgc3RydWN0IGRjX2xpbmsgKmRjX2xpbmsp
Cit7CisJaW50IGk7CisJc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqc3RyZWFtOworCXN0cnVjdCBk
c2NfbXN0X2ZhaXJuZXNzX3BhcmFtcyBwYXJhbXNbTUFYX1BJUEVTXTsKKwlzdHJ1Y3QgZHNjX21z
dF9mYWlybmVzc192YXJzIHZhcnNbTUFYX1BJUEVTXTsKKwlzdHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5l
Y3RvciAqYWNvbm5lY3RvcjsKKwlpbnQgY291bnQgPSAwOworCisJbWVtc2V0KHBhcmFtcywgMCwg
c2l6ZW9mKHBhcmFtcykpOworCisJLyogU2V0IHVwIHBhcmFtcyAqLworCWZvciAoaSA9IDA7IGkg
PCBkY19zdGF0ZS0+c3RyZWFtX2NvdW50OyBpKyspIHsKKwkJc3RyZWFtID0gZGNfc3RhdGUtPnN0
cmVhbXNbaV07CisKKwkJaWYgKHN0cmVhbS0+bGluayAhPSBkY19saW5rKQorCQkJY29udGludWU7
CisKKwkJc3RyZWFtLT50aW1pbmcuZmxhZ3MuRFNDID0gMDsKKworCQlwYXJhbXNbY291bnRdLnRp
bWluZyA9ICZzdHJlYW0tPnRpbWluZzsKKwkJcGFyYW1zW2NvdW50XS5zaW5rID0gc3RyZWFtLT5z
aW5rOworCQlhY29ubmVjdG9yID0gKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICopc3RyZWFt
LT5kbV9zdHJlYW1fY29udGV4dDsKKwkJcGFyYW1zW2NvdW50XS5wb3J0ID0gYWNvbm5lY3Rvci0+
cG9ydDsKKwkJcGFyYW1zW2NvdW50XS5jb21wcmVzc2lvbl9wb3NzaWJsZSA9IHN0cmVhbS0+c2lu
ay0+c2lua19kc2NfY2Fwcy5kc2NfZGVjX2NhcHMuaXNfZHNjX3N1cHBvcnRlZDsKKwkJaWYgKCFk
Y19kc2NfY29tcHV0ZV9iYW5kd2lkdGhfcmFuZ2UoCisJCQkJc3RyZWFtLT5zaW5rLT5jdHgtPmRj
LT5yZXNfcG9vbC0+ZHNjc1swXSwKKwkJCQlzdHJlYW0tPnNpbmstPmN0eC0+ZGMtPmRlYnVnLmRz
Y19taW5fc2xpY2VfaGVpZ2h0X292ZXJyaWRlLAorCQkJCTgsIDE2LAorCQkJCSZzdHJlYW0tPnNp
bmstPnNpbmtfZHNjX2NhcHMuZHNjX2RlY19jYXBzLAorCQkJCSZzdHJlYW0tPnRpbWluZywgJnBh
cmFtc1tjb3VudF0uYndfcmFuZ2UpKQorCQkJcGFyYW1zW2NvdW50XS5id19yYW5nZS5zdHJlYW1f
a2JwcyA9IGRjX2JhbmR3aWR0aF9pbl9rYnBzX2Zyb21fdGltaW5nKCZzdHJlYW0tPnRpbWluZyk7
CisKKwkJY291bnQrKzsKKwl9CisJLyogVHJ5IG5vIGNvbXByZXNzaW9uICovCisJZm9yIChpID0g
MDsgaSA8IGNvdW50OyBpKyspIHsKKwkJdmFyc1tpXS5wYm4gPSBrYnBzX3RvX3BlYWtfcGJuKHBh
cmFtc1tpXS5id19yYW5nZS5zdHJlYW1fa2Jwcyk7CisJCXZhcnNbaV0uZHNjX2VuYWJsZWQgPSBm
YWxzZTsKKwkJdmFyc1tpXS5icHBfeDE2ID0gMDsKKwkJZHJtX2RwX2F0b21pY19maW5kX3ZjcGlf
c2xvdHMoc3RhdGUsCisJCQkJCSAgICAgIHBhcmFtc1tpXS5wb3J0LT5tZ3IsCisJCQkJCSAgICAg
IHBhcmFtc1tpXS5wb3J0LAorCQkJCQkgICAgICB2YXJzW2ldLnBibiwKKwkJCQkJICAgICAgMCk7
CisJfQorCWlmICghZHJtX2RwX21zdF9hdG9taWNfY2hlY2soc3RhdGUpKSB7CisJCXNldF9kc2Nf
Y29uZmlnc19mcm9tX2ZhaXJuZXNzX3ZhcnMocGFyYW1zLCB2YXJzLCBjb3VudCk7CisJCXJldHVy
biB0cnVlOworCX0KKworCS8qIFRyeSBtYXggY29tcHJlc3Npb24gKi8KKwlmb3IgKGkgPSAwOyBp
IDwgY291bnQ7IGkrKykgeworCQlpZiAocGFyYW1zW2ldLmNvbXByZXNzaW9uX3Bvc3NpYmxlKSB7
CisJCQl2YXJzW2ldLnBibiA9IGticHNfdG9fcGVha19wYm4ocGFyYW1zW2ldLmJ3X3JhbmdlLm1p
bl9rYnBzKTsKKwkJCXZhcnNbaV0uZHNjX2VuYWJsZWQgPSB0cnVlOworCQkJdmFyc1tpXS5icHBf
eDE2ID0gcGFyYW1zW2ldLmJ3X3JhbmdlLm1pbl90YXJnZXRfYnBwX3gxNjsKKwkJCWRybV9kcF9h
dG9taWNfZmluZF92Y3BpX3Nsb3RzKHN0YXRlLAorCQkJCQkgICAgICBwYXJhbXNbaV0ucG9ydC0+
bWdyLAorCQkJCQkgICAgICBwYXJhbXNbaV0ucG9ydCwKKwkJCQkJICAgICAgdmFyc1tpXS5wYm4s
CisJCQkJCSAgICAgIGRtX21zdF9nZXRfcGJuX2RpdmlkZXIoZGNfbGluaykpOworCQl9IGVsc2Ug
eworCQkJdmFyc1tpXS5wYm4gPSBrYnBzX3RvX3BlYWtfcGJuKHBhcmFtc1tpXS5id19yYW5nZS5z
dHJlYW1fa2Jwcyk7CisJCQl2YXJzW2ldLmRzY19lbmFibGVkID0gZmFsc2U7CisJCQl2YXJzW2ld
LmJwcF94MTYgPSAwOworCQkJZHJtX2RwX2F0b21pY19maW5kX3ZjcGlfc2xvdHMoc3RhdGUsCisJ
CQkJCSAgICAgIHBhcmFtc1tpXS5wb3J0LT5tZ3IsCisJCQkJCSAgICAgIHBhcmFtc1tpXS5wb3J0
LAorCQkJCQkgICAgICB2YXJzW2ldLnBibiwKKwkJCQkJICAgICAgMCk7CisJCX0KKwl9CisJaWYg
KGRybV9kcF9tc3RfYXRvbWljX2NoZWNrKHN0YXRlKSkKKwkJcmV0dXJuIGZhbHNlOworCisJLyog
T3B0aW1pemUgZGVncmVlIG9mIGNvbXByZXNzaW9uICovCisJaW5jcmVhc2VfZHNjX2JwcChzdGF0
ZSwgZGNfbGluaywgcGFyYW1zLCB2YXJzLCBjb3VudCk7CisKKwl0cnlfZGlzYWJsZV9kc2Moc3Rh
dGUsIGRjX2xpbmssIHBhcmFtcywgdmFycywgY291bnQpOworCisJc2V0X2RzY19jb25maWdzX2Zy
b21fZmFpcm5lc3NfdmFycyhwYXJhbXMsIHZhcnMsIGNvdW50KTsKKworCXJldHVybiB0cnVlOwor
fQorCitib29sIGNvbXB1dGVfbXN0X2RzY19jb25maWdzX2Zvcl9zdGF0ZShzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgIHN0cnVjdCBkY19zdGF0ZSAqZGNfc3RhdGUp
Cit7CisJaW50IGksIGo7CisJc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqc3RyZWFtOworCWJvb2wg
Y29tcHV0ZWRfc3RyZWFtc1tNQVhfUElQRVNdOworCXN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9y
ICphY29ubmVjdG9yOworCisJZm9yIChpID0gMDsgaSA8IGRjX3N0YXRlLT5zdHJlYW1fY291bnQ7
IGkrKykKKwkJY29tcHV0ZWRfc3RyZWFtc1tpXSA9IGZhbHNlOworCisJZm9yIChpID0gMDsgaSA8
IGRjX3N0YXRlLT5zdHJlYW1fY291bnQ7IGkrKykgeworCQlzdHJlYW0gPSBkY19zdGF0ZS0+c3Ry
ZWFtc1tpXTsKKworCQlpZiAoc3RyZWFtLT5zaWduYWwgIT0gU0lHTkFMX1RZUEVfRElTUExBWV9Q
T1JUX01TVCkKKwkJCWNvbnRpbnVlOworCisJCWFjb25uZWN0b3IgPSAoc3RydWN0IGFtZGdwdV9k
bV9jb25uZWN0b3IgKilzdHJlYW0tPmRtX3N0cmVhbV9jb250ZXh0OworCisJCWlmICghYWNvbm5l
Y3RvciB8fCAhYWNvbm5lY3Rvci0+ZGNfc2luaykKKwkJCWNvbnRpbnVlOworCisJCWlmICghYWNv
bm5lY3Rvci0+ZGNfc2luay0+c2lua19kc2NfY2Fwcy5kc2NfZGVjX2NhcHMuaXNfZHNjX3N1cHBv
cnRlZCkKKwkJCWNvbnRpbnVlOworCisJCWlmIChjb21wdXRlZF9zdHJlYW1zW2ldKQorCQkJY29u
dGludWU7CisKKwkJbXV0ZXhfbG9jaygmYWNvbm5lY3Rvci0+bXN0X21nci5sb2NrKTsKKwkJaWYg
KCFjb21wdXRlX21zdF9kc2NfY29uZmlnc19mb3JfbGluayhzdGF0ZSwgZGNfc3RhdGUsIHN0cmVh
bS0+bGluaykpIHsKKwkJCW11dGV4X3VubG9jaygmYWNvbm5lY3Rvci0+bXN0X21nci5sb2NrKTsK
KwkJCXJldHVybiBmYWxzZTsKKwkJfQorCQltdXRleF91bmxvY2soJmFjb25uZWN0b3ItPm1zdF9t
Z3IubG9jayk7CisKKwkJZm9yIChqID0gMDsgaiA8IGRjX3N0YXRlLT5zdHJlYW1fY291bnQ7IGor
KykgeworCQkJaWYgKGRjX3N0YXRlLT5zdHJlYW1zW2pdLT5saW5rID09IHN0cmVhbS0+bGluaykK
KwkJCQljb21wdXRlZF9zdHJlYW1zW2pdID0gdHJ1ZTsKKwkJfQorCX0KKworCWZvciAoaSA9IDA7
IGkgPCBkY19zdGF0ZS0+c3RyZWFtX2NvdW50OyBpKyspIHsKKwkJc3RyZWFtID0gZGNfc3RhdGUt
PnN0cmVhbXNbaV07CisKKwkJaWYgKHN0cmVhbS0+dGltaW5nLmZsYWdzLkRTQyA9PSAxKQorCQkJ
ZGNuMjBfYWRkX2RzY190b19zdHJlYW1fcmVzb3VyY2Uoc3RyZWFtLT5jdHgtPmRjLCBkY19zdGF0
ZSwgc3RyZWFtKTsKKwl9CisKKwlyZXR1cm4gdHJ1ZTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5oIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG1fbXN0X3R5cGVzLmgK
aW5kZXggYTU1M2VhMDQ2MTg1Li5kNDUxY2U5Y2VjYzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90eXBlcy5o
CkBAIC0zNCw0ICszNCw3IEBAIGludCBkbV9tc3RfZ2V0X3Bibl9kaXZpZGVyKHN0cnVjdCBkY19s
aW5rICpsaW5rKTsKIHZvaWQgYW1kZ3B1X2RtX2luaXRpYWxpemVfZHBfY29ubmVjdG9yKHN0cnVj
dCBhbWRncHVfZGlzcGxheV9tYW5hZ2VyICpkbSwKIAkJCQkgICAgICAgc3RydWN0IGFtZGdwdV9k
bV9jb25uZWN0b3IgKmFjb25uZWN0b3IpOwogCisKK2Jvb2wgY29tcHV0ZV9tc3RfZHNjX2NvbmZp
Z3NfZm9yX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkgICAgICAg
c3RydWN0IGRjX3N0YXRlICpkY19zdGF0ZSk7CiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX3Jlc291cmNlLmMKaW5kZXggMzI4ZDEw
ZjZmYmZlLi42M2M1ZmRhNmRjZTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlz
cGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
ZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5jCkBAIC0xNDg4LDcgKzE0ODgsNyBAQCBz
dGF0aWMgdm9pZCByZWxlYXNlX2RzYyhzdHJ1Y3QgcmVzb3VyY2VfY29udGV4dCAqcmVzX2N0eCwK
IAogCiAKLXN0YXRpYyBlbnVtIGRjX3N0YXR1cyBhZGRfZHNjX3RvX3N0cmVhbV9yZXNvdXJjZShz
dHJ1Y3QgZGMgKmRjLAorZW51bSBkY19zdGF0dXMgZGNuMjBfYWRkX2RzY190b19zdHJlYW1fcmVz
b3VyY2Uoc3RydWN0IGRjICpkYywKIAkJc3RydWN0IGRjX3N0YXRlICpkY19jdHgsCiAJCXN0cnVj
dCBkY19zdHJlYW1fc3RhdGUgKmRjX3N0cmVhbSkKIHsKQEAgLTE1MDMsNiArMTUwMyw5IEBAIHN0
YXRpYyBlbnVtIGRjX3N0YXR1cyBhZGRfZHNjX3RvX3N0cmVhbV9yZXNvdXJjZShzdHJ1Y3QgZGMg
KmRjLAogCQlpZiAocGlwZV9jdHgtPnN0cmVhbSAhPSBkY19zdHJlYW0pCiAJCQljb250aW51ZTsK
IAorCQlpZiAocGlwZV9jdHgtPnN0cmVhbV9yZXMuZHNjKQorCQkJY29udGludWU7CisKIAkJYWNx
dWlyZV9kc2MoJmRjX2N0eC0+cmVzX2N0eCwgcG9vbCwgJnBpcGVfY3R4LT5zdHJlYW1fcmVzLmRz
Yyk7CiAKIAkJLyogVGhlIG51bWJlciBvZiBEU0NzIGNhbiBiZSBsZXNzIHRoYW4gdGhlIG51bWJl
ciBvZiBwaXBlcyAqLwpAQCAtMTU1Miw3ICsxNTU1LDcgQEAgZW51bSBkY19zdGF0dXMgZGNuMjBf
YWRkX3N0cmVhbV90b19jdHgoc3RydWN0IGRjICpkYywgc3RydWN0IGRjX3N0YXRlICpuZXdfY3R4
LAogCiAJLyogR2V0IGEgRFNDIGlmIHJlcXVpcmVkIGFuZCBhdmFpbGFibGUgKi8KIAlpZiAocmVz
dWx0ID09IERDX09LICYmIGRjX3N0cmVhbS0+dGltaW5nLmZsYWdzLkRTQykKLQkJcmVzdWx0ID0g
YWRkX2RzY190b19zdHJlYW1fcmVzb3VyY2UoZGMsIG5ld19jdHgsIGRjX3N0cmVhbSk7CisJCXJl
c3VsdCA9IGRjbjIwX2FkZF9kc2NfdG9fc3RyZWFtX3Jlc291cmNlKGRjLCBuZXdfY3R4LCBkY19z
dHJlYW0pOwogCiAJaWYgKHJlc3VsdCA9PSBEQ19PSykKIAkJcmVzdWx0ID0gZGNuMjBfYnVpbGRf
bWFwcGVkX3Jlc291cmNlKGRjLCBuZXdfY3R4LCBkY19zdHJlYW0pOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX3Jlc291cmNlLmggYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuaAppbmRleCA4
NDBjYTY2YzM0ZTEuLmY1ODkzODQwYjc5YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX3Jlc291cmNlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX3Jlc291cmNlLmgKQEAgLTE1Nyw2ICsxNTcsNyBA
QCB2b2lkIGRjbjIwX2NhbGN1bGF0ZV9kbGdfcGFyYW1zKAogCiBlbnVtIGRjX3N0YXR1cyBkY24y
MF9idWlsZF9tYXBwZWRfcmVzb3VyY2UoY29uc3Qgc3RydWN0IGRjICpkYywgc3RydWN0IGRjX3N0
YXRlICpjb250ZXh0LCBzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpzdHJlYW0pOwogZW51bSBkY19z
dGF0dXMgZGNuMjBfYWRkX3N0cmVhbV90b19jdHgoc3RydWN0IGRjICpkYywgc3RydWN0IGRjX3N0
YXRlICpuZXdfY3R4LCBzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpkY19zdHJlYW0pOworZW51bSBk
Y19zdGF0dXMgZGNuMjBfYWRkX2RzY190b19zdHJlYW1fcmVzb3VyY2Uoc3RydWN0IGRjICpkYywg
c3RydWN0IGRjX3N0YXRlICpkY19jdHgsIHN0cnVjdCBkY19zdHJlYW1fc3RhdGUgKmRjX3N0cmVh
bSk7CiBlbnVtIGRjX3N0YXR1cyBkY24yMF9yZW1vdmVfc3RyZWFtX2Zyb21fY3R4KHN0cnVjdCBk
YyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqbmV3X2N0eCwgc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAq
ZGNfc3RyZWFtKTsKIGVudW0gZGNfc3RhdHVzIGRjbjIwX2dldF9kZWZhdWx0X3N3aXp6bGVfbW9k
ZShzdHJ1Y3QgZGNfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIAotLSAKMi4xNy4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
