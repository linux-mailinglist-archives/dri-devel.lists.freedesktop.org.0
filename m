Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 152FE15EED
	for <lists+dri-devel@lfdr.de>; Tue,  7 May 2019 10:13:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6836D89F2D;
	Tue,  7 May 2019 08:13:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 38A0389EB7
 for <dri-devel@lists.freedesktop.org>; Tue,  7 May 2019 08:13:46 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id y197so18623076wmd.0
 for <dri-devel@lists.freedesktop.org>; Tue, 07 May 2019 01:13:46 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=B9Z/dgk4xZOYFIm94TQguLSDYocwEE/GmHVK6e46Nx4=;
 b=fdJA+TN4H0b+5gOVuwJYzTPfA6aCaiooSMmiFIH4S2LTQXh85EfkU8b1HOXyTe25eC
 ltPIzklQJM7QiltkLwsmEIETAPh2OOCARiBkG7rIon1EQbwKtLqINu1Ay9t5sl2lQAqy
 9oQzuQKUIqtUziJyo8zNkz69U8o15J48RIj25bY5mBW9fn/JG+eEw6Jdrft3ezxSo+G7
 bf6CQ5ChcjXwlEEdTcAbZnx41ldfrhdKXnTi1nPFpmyknFXhCjUQNGhdbQI7ABusj3I/
 zhPpnzl3CjjOE0RkkPyyCohlr3HYDLOoU7qc1zkFgbbjXxHbwD41RdI0zEu3LD9eCxVV
 ZJkA==
X-Gm-Message-State: APjAAAX7JgzcOOjXXUeIxfi/zelO/U7eSLm/diUv3J5Eo/EhmevoR7lY
 /YAiVfE9CCzZXq6KaA/BWmNUCLrK
X-Google-Smtp-Source: APXvYqzptZ0qsXZLdiE4j+C9IKMT21ixYvoLMUPP88RnTEqYXARgb7wbH/OYxawvcdVZWK3EJkld/A==
X-Received: by 2002:a1c:2d0e:: with SMTP id t14mr19853665wmt.33.1557216824528; 
 Tue, 07 May 2019 01:13:44 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c572:e952:8ef0:ace])
 by smtp.gmail.com with ESMTPSA id 67sm13588683wmz.41.2019.05.07.01.13.43
 for <dri-devel@lists.freedesktop.org>
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Tue, 07 May 2019 01:13:43 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 7/9] drm/amdgpu: add independent DMA-buf export v3
Date: Tue,  7 May 2019 10:13:36 +0200
Message-Id: <20190507081338.2571-7-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190507081338.2571-1-christian.koenig@amd.com>
References: <20190507081338.2571-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=B9Z/dgk4xZOYFIm94TQguLSDYocwEE/GmHVK6e46Nx4=;
 b=nqwqxOZxrGbLXdK34su8XcYGd/PyU+ybXQcRo17+FgjTWbGQwEXjqEb3pCO0EF1hAe
 SnSM0NxDVVD3HTqpUmal89l/S/X9VRzSou0pYupK80/6IrNyJCVS1+m1mgZMdG0+Rqdp
 08gTCSa5FnXf2RCZLo5dw/jEF7IyQMENBTsXmfPkAsqs7B2e13VoJ3dk+msd6VBqZ9HR
 blbXInY3O+rksXBohKkrX/f6phxJzcnaHBGyHAYN5ZjqDTGJmQzgckic8rTihG5B8N85
 acdP59jlsiK7zSnJZZp6LblJp2g6kLtqAyICQKaZAvYeoGGVcy6TrhGIE3DFKt+D1LxQ
 Vq0A==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGNhY2hpbmcgb2YgU0dUJ3MgaXMgYWN0dWFsbHkgcXVpdGUgaGFybWZ1bCBhbmQgc2hvdWxk
IHByb2JhYmx5IHJlbW92ZWQKYWx0b2dldGhlciB3aGVuIGFsbCBkcml2ZXJzIGFyZSBhdWRpdGVk
LgoKU3RhcnQgYnkgcHJvdmlkaW5nIGEgc2VwYXJhdGUgRE1BLWJ1ZiBleHBvcnQgaW1wbGVtZW50
YXRpb24gaW4gYW1kZ3B1LiBUaGlzIGlzCmFsc28gYSBwcmVyZXF1aXNpdGUgb2YgdW5waW5uZWQg
RE1BLWJ1ZiBoYW5kbGluZy4KCnYyOiBmaXggdW5pbnRlbmRlZCByZWN1cnNpb24sIHJlbW92ZSBk
ZWJ1Z2dpbmcgbGVmdG92ZXJzCnYzOiBzcGxpdCBvdXQgZnJvbSB1bnBpbm5lZCBETUEtYnVmIHdv
cmsKdjQ6IHJlYmFzZSBvbiB0b3Agb2YgbmV3IG5vX3NndF9jYWNoZSBmbGFnCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyB8IDIwNCArKysrKysrKysr
KystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuaCB8
ICAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgICAgIHwgICAx
IC0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyAgfCAgIDUgKwog
NCBmaWxlcyBjaGFuZ2VkLCAxMzMgaW5zZXJ0aW9ucygrKSwgNzggZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKaW5kZXggNDcxMWNmMWI1
YmQyLi42OGEwNzEwNjA3OTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9kbWFfYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2RtYV9idWYuYwpAQCAtNDAsMjIgKzQwLDYgQEAKICNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+
CiAjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLWFycmF5Lmg+CiAKLS8qKgotICogYW1kZ3B1X2dl
bV9wcmltZV9nZXRfc2dfdGFibGUgLSAmZHJtX2RyaXZlci5nZW1fcHJpbWVfZ2V0X3NnX3RhYmxl
Ci0gKiBpbXBsZW1lbnRhdGlvbgotICogQG9iajogR0VNIGJ1ZmZlciBvYmplY3QgKEJPKQotICoK
LSAqIFJldHVybnM6Ci0gKiBBIHNjYXR0ZXIvZ2F0aGVyIHRhYmxlIGZvciB0aGUgcGlubmVkIHBh
Z2VzIG9mIHRoZSBCTydzIG1lbW9yeS4KLSAqLwotc3RydWN0IHNnX3RhYmxlICphbWRncHVfZ2Vt
X3ByaW1lX2dldF9zZ190YWJsZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1
Y3QgYW1kZ3B1X2JvICpibyA9IGdlbV90b19hbWRncHVfYm8ob2JqKTsKLQlpbnQgbnBhZ2VzID0g
Ym8tPnRiby5udW1fcGFnZXM7Ci0KLQlyZXR1cm4gZHJtX3ByaW1lX3BhZ2VzX3RvX3NnKGJvLT50
Ym8udHRtLT5wYWdlcywgbnBhZ2VzKTsKLX0KLQogLyoqCiAgKiBhbWRncHVfZ2VtX3ByaW1lX3Zt
YXAgLSAmZG1hX2J1Zl9vcHMudm1hcCBpbXBsZW1lbnRhdGlvbgogICogQG9iajogR0VNIEJPCkBA
IC0xODEsOTIgKzE2NSwxNTggQEAgX19yZXNlcnZhdGlvbl9vYmplY3RfbWFrZV9leGNsdXNpdmUo
c3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqb2JqKQogfQogCiAvKioKLSAqIGFtZGdwdV9kbWFf
YnVmX21hcF9hdHRhY2ggLSAmZG1hX2J1Zl9vcHMuYXR0YWNoIGltcGxlbWVudGF0aW9uCi0gKiBA
ZG1hX2J1ZjogU2hhcmVkIERNQSBidWZmZXIKKyAqIGFtZGdwdV9kbWFfYnVmX2F0dGFjaCAtICZk
bWFfYnVmX29wcy5hdHRhY2ggaW1wbGVtZW50YXRpb24KKyAqCisgKiBAZG1hYnVmOiBETUEtYnVm
IHdoZXJlIHdlIGF0dGFjaCB0bworICogQGF0dGFjaDogYXR0YWNobWVudCB0byBhZGQKKyAqCisg
KiBBZGQgdGhlIGF0dGFjaG1lbnQgYXMgdXNlciB0byB0aGUgZXhwb3J0ZWQgRE1BLWJ1Zi4KKyAq
Lworc3RhdGljIGludCBhbWRncHVfZG1hX2J1Zl9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1
ZiwKKwkJCQkgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQoreworCXN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBhbWRncHVfYm8gKmJv
ID0gZ2VtX3RvX2FtZGdwdV9ibyhvYmopOworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0g
YW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7CisJaW50IHI7CisKKwlpZiAoYXR0YWNoLT5k
ZXYtPmRyaXZlciA9PSBhZGV2LT5kZXYtPmRyaXZlcikKKwkJcmV0dXJuIDA7CisKKwkvKgorCSAq
IFdlIG9ubHkgY3JlYXRlIHNoYXJlZCBmZW5jZXMgZm9yIGludGVybmFsIHVzZSwgYnV0IGltcG9y
dGVycworCSAqIG9mIHRoZSBkbWFidWYgcmVseSBvbiBleGNsdXNpdmUgZmVuY2VzIGZvciBpbXBs
aWNpdGx5CisJICogdHJhY2tpbmcgd3JpdGUgaGF6YXJkcy4gQXMgYW55IG9mIHRoZSBjdXJyZW50
IGZlbmNlcyBtYXkKKwkgKiBjb3JyZXNwb25kIHRvIGEgd3JpdGUsIHdlIG5lZWQgdG8gY29udmVy
dCBhbGwgZXhpc3RpbmcKKwkgKiBmZW5jZXMgb24gdGhlIHJlc2VydmF0aW9uIG9iamVjdCBpbnRv
IGEgc2luZ2xlIGV4Y2x1c2l2ZQorCSAqIGZlbmNlLgorCSAqLworCXIgPSBfX3Jlc2VydmF0aW9u
X29iamVjdF9tYWtlX2V4Y2x1c2l2ZShiby0+dGJvLnJlc3YpOworCWlmIChyKQorCQlyZXR1cm4g
cjsKKworCWJvLT5wcmltZV9zaGFyZWRfY291bnQrKzsKKwlyZXR1cm4gMDsKK30KKworLyoqCisg
KiBhbWRncHVfZG1hX2J1Zl9kZXRhY2ggLSAmZG1hX2J1Zl9vcHMuZGV0YWNoIGltcGxlbWVudGF0
aW9uCisgKgorICogQGRtYWJ1ZjogRE1BLWJ1ZiB3aGVyZSB3ZSByZW1vdmUgdGhlIGF0dGFjaG1l
bnQgZnJvbQorICogQGF0dGFjaDogdGhlIGF0dGFjaG1lbnQgdG8gcmVtb3ZlCisgKgorICogQ2Fs
bGVkIHdoZW4gYW4gYXR0YWNobWVudCBpcyByZW1vdmVkIGZyb20gdGhlIERNQS1idWYuCisgKi8K
K3N0YXRpYyB2b2lkIGFtZGdwdV9kbWFfYnVmX2RldGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
LAorCQkJCSAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQoreworCXN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBhbWRncHVfYm8gKmJv
ID0gZ2VtX3RvX2FtZGdwdV9ibyhvYmopOworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0g
YW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7CisKKwlpZiAoYXR0YWNoLT5kZXYtPmRyaXZl
ciAhPSBhZGV2LT5kZXYtPmRyaXZlciAmJiBiby0+cHJpbWVfc2hhcmVkX2NvdW50KQorCQliby0+
cHJpbWVfc2hhcmVkX2NvdW50LS07Cit9CisKKy8qKgorICogYW1kZ3B1X2RtYV9idWZfcGluIC0g
JmRtYV9idWZfb3BzLnBpbiBpbXBsZW1lbnRhdGlvbgorICoKKyAqIEBhdHRhY2g6IGF0dGFjaG1l
bnQgdG8gcGluIGRvd24KKyAqCisgKiBQaW4gdGhlIEJPIHdoaWNoIGlzIGJhY2tpbmcgdGhlIERN
QS1idWYgc28gdGhhdCBpdCBjYW4ndCBtb3ZlIGFueSBtb3JlLgorICovCitzdGF0aWMgaW50IGFt
ZGdwdV9kbWFfYnVmX3BpbihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gpCit7CisJ
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBhdHRhY2gtPmRtYWJ1Zi0+cHJpdjsKKwlzdHJ1
Y3QgYW1kZ3B1X2JvICpibyA9IGdlbV90b19hbWRncHVfYm8ob2JqKTsKKworCS8qIHBpbiBidWZm
ZXIgaW50byBHVFQgKi8KKwlyZXR1cm4gYW1kZ3B1X2JvX3BpbihibywgQU1ER1BVX0dFTV9ET01B
SU5fR1RUKTsKK30KKworLyoqCisgKiBhbWRncHVfZG1hX2J1Zl91bnBpbiAtICZkbWFfYnVmX29w
cy51bnBpbiBpbXBsZW1lbnRhdGlvbgorICoKKyAqIEBhdHRhY2g6IGF0dGFjaG1lbnQgdG8gdW5w
aW4KKyAqCisgKiBVbnBpbiBhIHByZXZpb3VzbHkgcGlubmVkIEJPIHRvIG1ha2UgaXQgbW92YWJs
ZSBhZ2Fpbi4KKyAqLworc3RhdGljIHZvaWQgYW1kZ3B1X2RtYV9idWZfdW5waW4oc3RydWN0IGRt
YV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
ID0gYXR0YWNoLT5kbWFidWYtPnByaXY7CisJc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBnZW1fdG9f
YW1kZ3B1X2JvKG9iaik7CisKKwlhbWRncHVfYm9fdW5waW4oYm8pOworfQorCisvKioKKyAqIGFt
ZGdwdV9kbWFfYnVmX21hcF9kbWFfYnVmIC0gJmRtYV9idWZfb3BzLm1hcF9kbWFfYnVmIGltcGxl
bWVudGF0aW9uCiAgKiBAYXR0YWNoOiBETUEtYnVmIGF0dGFjaG1lbnQKKyAqIEBkaXI6IERNQSBk
aXJlY3Rpb24KICAqCiAgKiBNYWtlcyBzdXJlIHRoYXQgdGhlIHNoYXJlZCBETUEgYnVmZmVyIGNh
biBiZSBhY2Nlc3NlZCBieSB0aGUgdGFyZ2V0IGRldmljZS4KICAqIEZvciBub3csIHNpbXBseSBw
aW5zIGl0IHRvIHRoZSBHVFQgZG9tYWluLCB3aGVyZSBpdCBzaG91bGQgYmUgYWNjZXNzaWJsZSBi
eQogICogYWxsIERNQSBkZXZpY2VzLgogICoKICAqIFJldHVybnM6Ci0gKiAwIG9uIHN1Y2Nlc3Mg
b3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisgKiBzZ190YWJsZSBmaWxsZWQg
d2l0aCB0aGUgRE1BIGFkZHJlc3NlcyB0byB1c2Ugb3IgRVJSX1BSVCB3aXRoIG5lZ2F0aXZlIGVy
cm9yCisgKiBjb2RlLgogICovCi1zdGF0aWMgaW50IGFtZGdwdV9kbWFfYnVmX21hcF9hdHRhY2go
c3RydWN0IGRtYV9idWYgKmRtYV9idWYsCi0JCQkJICAgICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2ht
ZW50ICphdHRhY2gpCitzdGF0aWMgc3RydWN0IHNnX3RhYmxlICoKK2FtZGdwdV9kbWFfYnVmX21h
cF9kbWFfYnVmKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKKwkJCSAgIGVudW0g
ZG1hX2RhdGFfZGlyZWN0aW9uIGRpcikKIHsKKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiA9IGF0
dGFjaC0+ZG1hYnVmOwogCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqID0gZG1hX2J1Zi0+cHJp
djsKIAlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IGdlbV90b19hbWRncHVfYm8ob2JqKTsKLQlzdHJ1
Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGFtZGdwdV90dG1fYWRldihiby0+dGJvLmJkZXYpOwor
CXN0cnVjdCBzZ190YWJsZSAqc2d0OwogCWxvbmcgcjsKIAotCXIgPSBkcm1fZ2VtX21hcF9hdHRh
Y2goZG1hX2J1ZiwgYXR0YWNoKTsKLQlpZiAocikKLQkJcmV0dXJuIHI7CisJaWYgKCFiby0+cGlu
X2NvdW50KSB7CisJCS8qIG1vdmUgYnVmZmVyIGludG8gR1RUICovCisJCXN0cnVjdCB0dG1fb3Bl
cmF0aW9uX2N0eCBjdHggPSB7IGZhbHNlLCBmYWxzZSB9OwogCi0JciA9IGFtZGdwdV9ib19yZXNl
cnZlKGJvLCBmYWxzZSk7Ci0JaWYgKHVubGlrZWx5KHIgIT0gMCkpCi0JCWdvdG8gZXJyb3JfZGV0
YWNoOwotCi0KLQlpZiAoYXR0YWNoLT5kZXYtPmRyaXZlciAhPSBhZGV2LT5kZXYtPmRyaXZlcikg
ewotCQkvKgotCQkgKiBXZSBvbmx5IGNyZWF0ZSBzaGFyZWQgZmVuY2VzIGZvciBpbnRlcm5hbCB1
c2UsIGJ1dCBpbXBvcnRlcnMKLQkJICogb2YgdGhlIGRtYWJ1ZiByZWx5IG9uIGV4Y2x1c2l2ZSBm
ZW5jZXMgZm9yIGltcGxpY2l0bHkKLQkJICogdHJhY2tpbmcgd3JpdGUgaGF6YXJkcy4gQXMgYW55
IG9mIHRoZSBjdXJyZW50IGZlbmNlcyBtYXkKLQkJICogY29ycmVzcG9uZCB0byBhIHdyaXRlLCB3
ZSBuZWVkIHRvIGNvbnZlcnQgYWxsIGV4aXN0aW5nCi0JCSAqIGZlbmNlcyBvbiB0aGUgcmVzZXJ2
YXRpb24gb2JqZWN0IGludG8gYSBzaW5nbGUgZXhjbHVzaXZlCi0JCSAqIGZlbmNlLgotCQkgKi8K
LQkJciA9IF9fcmVzZXJ2YXRpb25fb2JqZWN0X21ha2VfZXhjbHVzaXZlKGJvLT50Ym8ucmVzdik7
CisJCWFtZGdwdV9ib19wbGFjZW1lbnRfZnJvbV9kb21haW4oYm8sIEFNREdQVV9HRU1fRE9NQUlO
X0dUVCk7CisJCXIgPSB0dG1fYm9fdmFsaWRhdGUoJmJvLT50Ym8sICZiby0+cGxhY2VtZW50LCAm
Y3R4KTsKIAkJaWYgKHIpCi0JCQlnb3RvIGVycm9yX3VucmVzZXJ2ZTsKKwkJCXJldHVybiBFUlJf
UFRSKHIpOwogCX0KIAotCS8qIHBpbiBidWZmZXIgaW50byBHVFQgKi8KLQlyID0gYW1kZ3B1X2Jv
X3BpbihibywgQU1ER1BVX0dFTV9ET01BSU5fR1RUKTsKLQlpZiAocikKLQkJZ290byBlcnJvcl91
bnJlc2VydmU7CisJc2d0ID0gZHJtX3ByaW1lX3BhZ2VzX3RvX3NnKGJvLT50Ym8udHRtLT5wYWdl
cywgYm8tPnRiby5udW1fcGFnZXMpOworCWlmIChJU19FUlIoc2d0KSkKKwkJcmV0dXJuIHNndDsK
IAotCWlmIChhdHRhY2gtPmRldi0+ZHJpdmVyICE9IGFkZXYtPmRldi0+ZHJpdmVyKQotCQliby0+
cHJpbWVfc2hhcmVkX2NvdW50Kys7CisJaWYgKCFkbWFfbWFwX3NnX2F0dHJzKGF0dGFjaC0+ZGV2
LCBzZ3QtPnNnbCwgc2d0LT5uZW50cywgZGlyLAorCQkJICAgICAgRE1BX0FUVFJfU0tJUF9DUFVf
U1lOQykpCisJCWdvdG8gZXJyb3JfZnJlZTsKIAotZXJyb3JfdW5yZXNlcnZlOgotCWFtZGdwdV9i
b191bnJlc2VydmUoYm8pOworCXJldHVybiBzZ3Q7CiAKLWVycm9yX2RldGFjaDoKLQlpZiAocikK
LQkJZHJtX2dlbV9tYXBfZGV0YWNoKGRtYV9idWYsIGF0dGFjaCk7Ci0JcmV0dXJuIHI7CitlcnJv
cl9mcmVlOgorCXNnX2ZyZWVfdGFibGUoc2d0KTsKKwlrZnJlZShzZ3QpOworCXJldHVybiBFUlJf
UFRSKC1FTk9NRU0pOwogfQogCiAvKioKLSAqIGFtZGdwdV9kbWFfYnVmX21hcF9kZXRhY2ggLSAm
ZG1hX2J1Zl9vcHMuZGV0YWNoIGltcGxlbWVudGF0aW9uCi0gKiBAZG1hX2J1ZjogU2hhcmVkIERN
QSBidWZmZXIKKyAqIGFtZGdwdV9nZW1fdW5tYXBfZG1hX2J1ZiAtICZkbWFfYnVmX29wcy51bm1h
cF9kbWFfYnVmIGltcGxlbWVudGF0aW9uCiAgKiBAYXR0YWNoOiBETUEtYnVmIGF0dGFjaG1lbnQK
KyAqIEBzZ3Q6IHNnX3RhYmxlIHRvIHVubWFwCisgKiBAZGlyOiBETUEgZGlyZWN0aW9uCiAgKgog
ICogVGhpcyBpcyBjYWxsZWQgd2hlbiBhIHNoYXJlZCBETUEgYnVmZmVyIG5vIGxvbmdlciBuZWVk
cyB0byBiZSBhY2Nlc3NpYmxlIGJ5CiAgKiBhbm90aGVyIGRldmljZS4gRm9yIG5vdywgc2ltcGx5
IHVucGlucyB0aGUgYnVmZmVyIGZyb20gR1RULgogICovCi1zdGF0aWMgdm9pZCBhbWRncHVfZG1h
X2J1Zl9tYXBfZGV0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmLAotCQkJCSAgICAgIHN0cnVj
dCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCkKK3N0YXRpYyB2b2lkIGFtZGdwdV9kbWFfYnVm
X3VubWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAorCQkJCQkg
c3RydWN0IHNnX3RhYmxlICpzZ3QsCisJCQkJCSBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIp
CiB7Ci0Jc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBkbWFfYnVmLT5wcml2OwotCXN0cnVj
dCBhbWRncHVfYm8gKmJvID0gZ2VtX3RvX2FtZGdwdV9ibyhvYmopOwotCXN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7Ci0JaW50IHJldCA9
IDA7Ci0KLQlyZXQgPSBhbWRncHVfYm9fcmVzZXJ2ZShibywgdHJ1ZSk7Ci0JaWYgKHVubGlrZWx5
KHJldCAhPSAwKSkKLQkJZ290byBlcnJvcjsKLQotCWFtZGdwdV9ib191bnBpbihibyk7Ci0JaWYg
KGF0dGFjaC0+ZGV2LT5kcml2ZXIgIT0gYWRldi0+ZGV2LT5kcml2ZXIgJiYgYm8tPnByaW1lX3No
YXJlZF9jb3VudCkKLQkJYm8tPnByaW1lX3NoYXJlZF9jb3VudC0tOwotCWFtZGdwdV9ib191bnJl
c2VydmUoYm8pOworCWlmICghc2d0KQorCQlyZXR1cm47CiAKLWVycm9yOgotCWRybV9nZW1fbWFw
X2RldGFjaChkbWFfYnVmLCBhdHRhY2gpOworCWRtYV91bm1hcF9zZyhhdHRhY2gtPmRldiwgc2d0
LT5zZ2wsIHNndC0+bmVudHMsIGRpcik7CisJc2dfZnJlZV90YWJsZShzZ3QpOworCWtmcmVlKHNn
dCk7CiB9CiAKIC8qKgpAQCAtMzI0LDEwICszNzQsMTIgQEAgc3RhdGljIGludCBhbWRncHVfZG1h
X2J1Zl9iZWdpbl9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmLAogfQogCiBjb25z
dCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgYW1kZ3B1X2RtYWJ1Zl9vcHMgPSB7Ci0JLmF0dGFjaCA9IGFt
ZGdwdV9kbWFfYnVmX21hcF9hdHRhY2gsCi0JLmRldGFjaCA9IGFtZGdwdV9kbWFfYnVmX21hcF9k
ZXRhY2gsCi0JLm1hcF9kbWFfYnVmID0gZHJtX2dlbV9tYXBfZG1hX2J1ZiwKLQkudW5tYXBfZG1h
X2J1ZiA9IGRybV9nZW1fdW5tYXBfZG1hX2J1ZiwKKwkuYXR0YWNoID0gYW1kZ3B1X2RtYV9idWZf
YXR0YWNoLAorCS5kZXRhY2ggPSBhbWRncHVfZG1hX2J1Zl9kZXRhY2gsCisJLnBpbiA9IGFtZGdw
dV9kbWFfYnVmX3BpbiwKKwkudW5waW4gPSBhbWRncHVfZG1hX2J1Zl91bnBpbiwKKwkubWFwX2Rt
YV9idWYgPSBhbWRncHVfZG1hX2J1Zl9tYXBfZG1hX2J1ZiwKKwkudW5tYXBfZG1hX2J1ZiA9IGFt
ZGdwdV9kbWFfYnVmX3VubWFwX2RtYV9idWYsCiAJLnJlbGVhc2UgPSBkcm1fZ2VtX2RtYWJ1Zl9y
ZWxlYXNlLAogCS5iZWdpbl9jcHVfYWNjZXNzID0gYW1kZ3B1X2RtYV9idWZfYmVnaW5fY3B1X2Fj
Y2VzcywKIAkubW1hcCA9IGRybV9nZW1fZG1hYnVmX21tYXAsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuaAppbmRleCBjNzA1NmNiZTg2ODUuLmYxNTIyMjkyODE0
YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oCkBAIC0y
NSw3ICsyNSw2IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgogCi1zdHJ1Y3Qgc2dfdGFi
bGUgKmFtZGdwdV9nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
b2JqKTsKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqCiBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9z
Z190YWJsZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCSBzdHJ1Y3QgZG1hX2J1Zl9hdHRh
Y2htZW50ICphdHRhY2gsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKaW5k
ZXggYTMzNGQzYjQ5NDRlLi43MGM1Y2QyZDVmYjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfZHJ2LmMKQEAgLTEzMjEsNyArMTMyMSw2IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2Ry
aXZlciBrbXNfZHJpdmVyID0gewogCS5nZW1fcHJpbWVfZXhwb3J0ID0gYW1kZ3B1X2dlbV9wcmlt
ZV9leHBvcnQsCiAJLmdlbV9wcmltZV9pbXBvcnQgPSBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydCwK
IAkuZ2VtX3ByaW1lX3Jlc19vYmogPSBhbWRncHVfZ2VtX3ByaW1lX3Jlc19vYmosCi0JLmdlbV9w
cmltZV9nZXRfc2dfdGFibGUgPSBhbWRncHVfZ2VtX3ByaW1lX2dldF9zZ190YWJsZSwKIAkuZ2Vt
X3ByaW1lX2ltcG9ydF9zZ190YWJsZSA9IGFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxl
LAogCS5nZW1fcHJpbWVfdm1hcCA9IGFtZGdwdV9nZW1fcHJpbWVfdm1hcCwKIAkuZ2VtX3ByaW1l
X3Z1bm1hcCA9IGFtZGdwdV9nZW1fcHJpbWVfdnVubWFwLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X29iamVjdC5jCmluZGV4IDkzYjJjNWE0OGE3MS4uZDI2ZTJmMGI4OGQyIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCkBAIC0zMSw2ICsz
MSw3IEBACiAgKi8KICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvc2xh
Yi5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KICNpbmNsdWRlIDxkcm0vZHJtUC5oPgog
I2luY2x1ZGUgPGRybS9hbWRncHVfZHJtLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jYWNoZS5oPgpA
QCAtMTE5NCw2ICsxMTk1LDEwIEBAIHZvaWQgYW1kZ3B1X2JvX21vdmVfbm90aWZ5KHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8sCiAKIAlhbWRncHVfYm9fa3VubWFwKGFibyk7CiAKKwlpZiAo
YWJvLT5nZW1fYmFzZS5kbWFfYnVmICYmICFhYm8tPmdlbV9iYXNlLmltcG9ydF9hdHRhY2ggJiYK
KwkgICAgYm8tPm1lbS5tZW1fdHlwZSAhPSBUVE1fUExfU1lTVEVNKQorCQlkbWFfYnVmX2ludmFs
aWRhdGVfbWFwcGluZ3MoYWJvLT5nZW1fYmFzZS5kbWFfYnVmKTsKKwogCS8qIHJlbWVtYmVyIHRo
ZSBldmljdGlvbiAqLwogCWlmIChldmljdCkKIAkJYXRvbWljNjRfaW5jKCZhZGV2LT5udW1fZXZp
Y3Rpb25zKTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
