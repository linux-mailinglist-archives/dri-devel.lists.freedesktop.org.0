Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 48A207E51E
	for <lists+dri-devel@lfdr.de>; Fri,  2 Aug 2019 00:02:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EA8666E827;
	Thu,  1 Aug 2019 22:02:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C084B6E825;
 Thu,  1 Aug 2019 22:02:34 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id C25D730EA981;
 Thu,  1 Aug 2019 22:02:30 +0000 (UTC)
Received: from malachite.bss.redhat.com (dhcp-10-20-1-11.bss.redhat.com
 [10.20.1.11])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 15EB61001281;
 Thu,  1 Aug 2019 22:02:25 +0000 (UTC)
From: Lyude Paul <lyude@redhat.com>
To: nouveau@lists.freedesktop.org
Subject: [PATCH] drm/nouveau: Only release VCPI slots on mode changes
Date: Thu,  1 Aug 2019 18:02:15 -0400
Message-Id: <20190801220216.15323-1-lyude@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Thu, 01 Aug 2019 22:02:34 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 dri-devel@lists.freedesktop.org, Karol Herbst <karolherbst@gmail.com>,
 stable@vger.kernel.org, linux-kernel@vger.kernel.org,
 Jerry Zuo <Jerry.Zuo@amd.com>, Ben Skeggs <bskeggs@redhat.com>,
 David Airlie <airlied@redhat.com>, Juston Li <juston.li@intel.com>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TG9va3MgbGlrZSBhIHJlZ3Jlc3Npb24gZ290IGludHJvZHVjZWQgaW50byBudjUwX21zdGNfYXRv
bWljX2NoZWNrKCkKdGhhdCBzb21laG93IGRpZG4ndCBnZXQgZm91bmQgdW50aWwgbm93LiBJZiB1
c2Vyc3BhY2UgY2hhbmdlcwpjcnRjX3N0YXRlLT5hY3RpdmUgdG8gZmFsc2UgYnV0IGxlYXZlcyB0
aGUgQ1JUQyBlbmFibGVkLCB3ZSBlbmQgdXAKY2FsbGluZyBkcm1fZHBfYXRvbWljX2ZpbmRfdmNw
aV9zbG90cygpIHVzaW5nIHRoZSBQQk4gY2FsY3VsYXRlZCBpbgphc3loLT5kcC5wYm4uIEhvd2V2
ZXIsIGlmIHRoZSBkaXNwbGF5IGlzIGluYWN0aXZlIHdlIGVuZCB1cCBjYWxjdWxhdGluZwphIFBC
TiBvZiAwLCB3aGljaCBpbmFkdmVydGVudGx5IGNhdXNlcyB1cyB0byBoYXZlIGFuIGFsbG9jYXRp
b24gb2YgMC4KRnJvbSB0aGVyZSwgaWYgdXNlcnNwYWNlIHRoZW4gZGlzYWJsZXMgdGhlIENSVEMg
YWZ0ZXJ3YXJkcyB3ZSBlbmQgdXAKYWNjaWRlbnRhbGx5IGF0dGVtcHRpbmcgdG8gZnJlZSB0aGUg
VkNQSSB0d2ljZToKCldBUk5JTkc6IENQVTogMCBQSUQ6IDE0ODQgYXQgZHJpdmVycy9ncHUvZHJt
L2RybV9kcF9tc3RfdG9wb2xvZ3kuYzozMzM2CmRybV9kcF9hdG9taWNfcmVsZWFzZV92Y3BpX3Ns
b3RzKzB4ODcvMHhiMCBbZHJtX2ttc19oZWxwZXJdClJJUDogMDAxMDpkcm1fZHBfYXRvbWljX3Jl
bGVhc2VfdmNwaV9zbG90cysweDg3LzB4YjAgW2RybV9rbXNfaGVscGVyXQpDYWxsIFRyYWNlOgog
ZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfbW9kZXNldCsweDNmMy8weGE2MCBbZHJtX2ttc19oZWxw
ZXJdCiA/IGRybV9hdG9taWNfY2hlY2tfb25seSsweDQzLzB4NzgwIFtkcm1dCiBkcm1fYXRvbWlj
X2hlbHBlcl9jaGVjaysweDE1LzB4OTAgW2RybV9rbXNfaGVscGVyXQogbnY1MF9kaXNwX2F0b21p
Y19jaGVjaysweDgzLzB4MWQwIFtub3V2ZWF1XQogZHJtX2F0b21pY19jaGVja19vbmx5KzB4NTRk
LzB4NzgwIFtkcm1dCiA/IGRybV9hdG9taWNfc2V0X2NydGNfZm9yX2Nvbm5lY3RvcisweGVjLzB4
MTAwIFtkcm1dCiBkcm1fYXRvbWljX2NvbW1pdCsweDEzLzB4NTAgW2RybV0KIGRybV9hdG9taWNf
aGVscGVyX3NldF9jb25maWcrMHg4MS8weDkwIFtkcm1fa21zX2hlbHBlcl0KIGRybV9tb2RlX3Nl
dGNydGMrMHgxOTQvMHg2YTAgW2RybV0KID8gdnByaW50a19lbWl0KzB4MTZhLzB4MjMwCiA/IGRy
bV9pb2N0bCsweDE2My8weDM5MCBbZHJtXQogPyBkcm1fbW9kZV9nZXRjcnRjKzB4MTgwLzB4MTgw
IFtkcm1dCiBkcm1faW9jdGxfa2VybmVsKzB4YWEvMHhmMCBbZHJtXQogZHJtX2lvY3RsKzB4MjA4
LzB4MzkwIFtkcm1dCiA/IGRybV9tb2RlX2dldGNydGMrMHgxODAvMHgxODAgW2RybV0KIG5vdXZl
YXVfZHJtX2lvY3RsKzB4NjMvMHhiMCBbbm91dmVhdV0KIGRvX3Zmc19pb2N0bCsweDQwNS8weDY2
MAogPyByZWNhbGNfc2lncGVuZGluZysweDE3LzB4NTAKID8gX2NvcHlfZnJvbV91c2VyKzB4Mzcv
MHg2MAoga3N5c19pb2N0bCsweDVlLzB4OTAKID8gZXhpdF90b191c2VybW9kZV9sb29wKzB4OTIv
MHhlMAogX194NjRfc3lzX2lvY3RsKzB4MTYvMHgyMAogZG9fc3lzY2FsbF82NCsweDU5LzB4MTkw
CiBlbnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJhbWUrMHg0NC8weGE5CldBUk5JTkc6IENQVTog
MCBQSUQ6IDE0ODQgYXQgZHJpdmVycy9ncHUvZHJtL2RybV9kcF9tc3RfdG9wb2xvZ3kuYzozMzM2
CmRybV9kcF9hdG9taWNfcmVsZWFzZV92Y3BpX3Nsb3RzKzB4ODcvMHhiMCBbZHJtX2ttc19oZWxw
ZXJdCi0tLVsgZW5kIHRyYWNlIDRjMzk1YzBjNTFiMWY4OGQgXS0tLQpbZHJtOmRybV9kcF9hdG9t
aWNfcmVsZWFzZV92Y3BpX3Nsb3RzIFtkcm1fa21zX2hlbHBlcl1dICpFUlJPUiogbm8gVkNQSSBm
b3IKW01TVCBQT1JUOjAwMDAwMDAwZTI4OGViN2RdIGZvdW5kIGluIG1zdCBzdGF0ZSAwMDAwMDAw
MDhlNjQyMDcwCgpTbywgZml4IHRoaXMgYnkgZG9pbmcgd2hhdCB3ZSBwcm9iYWJseSBzaG91bGQg
aGF2ZSBkb25lIGZyb20gdGhlIHN0YXJ0OiBvbmx5CmNhbGwgZHJtX2RwX2F0b21pY19maW5kX3Zj
cGlfc2xvdHMoKSB3aGVuIGNydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCBpcyBzZXQsIHNvCnRoYXQg
VkNQSSBhbGxvY2F0aW9ucyByZW1haW4gZm9yIGFzIGxvbmcgYXMgdGhlIENSVEMgaXMgZW5hYmxl
ZC4KClNpZ25lZC1vZmYtYnk6IEx5dWRlIFBhdWwgPGx5dWRlQHJlZGhhdC5jb20+CkZpeGVzOiAy
MzJjOWVlYzQxN2EgKCJkcm0vbm91dmVhdTogVXNlIGF0b21pYyBWQ1BJIGhlbHBlcnMgZm9yIE1T
VCIpCkNjOiBMeXVkZSBQYXVsIDxseXVkZUByZWRoYXQuY29tPgpDYzogQmVuIFNrZWdncyA8YnNr
ZWdnc0ByZWRoYXQuY29tPgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5j
aD4KQ2M6IERhdmlkIEFpcmxpZSA8YWlybGllZEByZWRoYXQuY29tPgpDYzogSmVycnkgWnVvIDxK
ZXJyeS5adW9AYW1kLmNvbT4KQ2M6IEhhcnJ5IFdlbnRsYW5kIDxoYXJyeS53ZW50bGFuZEBhbWQu
Y29tPgpDYzogSnVzdG9uIExpIDxqdXN0b24ubGlAaW50ZWwuY29tPgpDYzogS2Fyb2wgSGVyYnN0
IDxrYXJvbGhlcmJzdEBnbWFpbC5jb20+CkNjOiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBp
bmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+CkNjOiBJbGlhIE1pcmtpbiA8aW1pcmtpbkBhbHVtLm1p
dC5lZHU+CkNjOiA8c3RhYmxlQHZnZXIua2VybmVsLm9yZz4gIyB2NS4xKwotLS0KIGRyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L2Rpc3BudjUwL2Rpc3AuYyB8IDIgKy0KIDEgZmlsZSBjaGFuZ2VkLCAx
IGluc2VydGlvbigrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L2Rpc3BudjUwL2Rpc3AuYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3Bu
djUwL2Rpc3AuYwppbmRleCA4NDk3NzY4ZjFiNDEuLjEyNjcwMzgxNjc5NCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52NTAvZGlzcC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9ub3V2ZWF1L2Rpc3BudjUwL2Rpc3AuYwpAQCAtNzgwLDcgKzc4MCw3IEBAIG52NTBfbXN0
b19hdG9taWNfY2hlY2soc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyLAogCQkJZHJtX2RwX2Nh
bGNfcGJuX21vZGUoY3J0Y19zdGF0ZS0+YWRqdXN0ZWRfbW9kZS5jbG9jaywKIAkJCQkJICAgICBj
b25uZWN0b3ItPmRpc3BsYXlfaW5mby5icGMgKiAzKTsKIAotCWlmIChkcm1fYXRvbWljX2NydGNf
bmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSkgeworCWlmIChjcnRjX3N0YXRlLT5tb2RlX2NoYW5n
ZWQpIHsKIAkJc2xvdHMgPSBkcm1fZHBfYXRvbWljX2ZpbmRfdmNwaV9zbG90cyhzdGF0ZSwgJm1z
dG0tPm1nciwKIAkJCQkJCSAgICAgIG1zdGMtPnBvcnQsCiAJCQkJCQkgICAgICBhc3loLT5kcC5w
Ym4pOwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
