Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3B5E9F3336
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 16:32:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B99E16F711;
	Thu,  7 Nov 2019 15:32:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM04-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr700056.outbound.protection.outlook.com [40.107.70.56])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2AFE46F709;
 Thu,  7 Nov 2019 15:32:32 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=CncZeKk8jCJrV/lc9iaj5h5kQInH8cWTzNBjWv1nI428jk7ELRRiz6JoZ239jsVK7jaSeLVanAGRvVmlb1KgkC+Ghxp8afhCVd9UeQ96fm3u+74UnEoSvtq501+FvIdOI8cz15p6tEt4Vs1nChq4pBcSfwTAy3VU6l3LlNk2CMKKdCvLsb2XJ7wLF2TirWIXdMxTVwcDv/LwU7nK5I7We/QO6lZKbQBdgqCX5vfatT+QCiOz2PaA5zt/VQJWVocJ65cNwpnKJ1xiNqZNpslji5942ADFJ/sKUpKkDsCcCX4PBpo45Qq6jUlQ0M7qmDjeaET2CB83e9bI+hHHEel9Jg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=tTBIyR3HOvIzIJ8AkTeEJXHSWsKag+du9dnyLyuhRvM=;
 b=lGhdoQlHbyx931E9m0uCg1AnOsDzfc1gh0+pYdX7+PNx1TjBg1ZYpPbPJavFHw8Lor/JbSO2CIDoLK6nwQu23e/iCz3F+HX14W6txUyHpolj2eAwT4s35jzUEGESGofvw4rtI/VihaAY1+HczdcigEUP4Bt+S3LS9Snj3Rk/ylftMJOwUQJD3BuoVD0Lro2k8mwQVg41bMqQHhlK38V+KS6nGxvN1tjfT8VbpZgCqm6K5bG4BKpIUdkMDJpArhAIBUaAOY9vPX2EWkOd1bPwB9d9QNMdFPgi5dp/kENG0DVNU/rhVdFdDjNpfYBXTHQwoOdk8PR6FSbxWDU65O5GKw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org smtp.mailfrom=amd.com; 
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from DM5PR12CA0013.namprd12.prod.outlook.com (2603:10b6:4:1::23) by
 MN2PR12MB3679.namprd12.prod.outlook.com (2603:10b6:208:159::31) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2430.24; Thu, 7 Nov
 2019 15:32:30 +0000
Received: from DM3NAM03FT049.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::207) by DM5PR12CA0013.outlook.office365.com
 (2603:10b6:4:1::23) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2430.22 via Frontend
 Transport; Thu, 7 Nov 2019 15:32:30 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXMB02.amd.com (165.204.84.17) by
 DM3NAM03FT049.mail.protection.outlook.com (10.152.83.125) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.2430.20 via Frontend Transport; Thu, 7 Nov 2019 15:32:30 +0000
Received: from SATLEXMB01.amd.com (10.181.40.142) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1713.5; Thu, 7 Nov 2019
 09:32:28 -0600
Received: from mlipski-pc.amd.com (10.180.168.240) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server id 15.1.1713.5 via Frontend
 Transport; Thu, 7 Nov 2019 09:32:28 -0600
From: <mikita.lipski@amd.com>
To: <amd-gfx@lists.freedesktop.org>
Subject: [PATCH v6 12/13] drm/amd/display: MST DSC compute fair share
Date: Thu, 7 Nov 2019 10:32:11 -0500
Message-ID: <20191107153212.1145-13-mikita.lipski@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191107153212.1145-1-mikita.lipski@amd.com>
References: <20191107153212.1145-1-mikita.lipski@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(346002)(136003)(396003)(39860400002)(376002)(428003)(199004)(189003)(30864003)(70206006)(70586007)(1076003)(186003)(5660300002)(53416004)(4326008)(450100002)(478600001)(126002)(486006)(6666004)(356004)(426003)(14444005)(336012)(476003)(2616005)(11346002)(36756003)(305945005)(446003)(50466002)(48376002)(316002)(8676002)(76176011)(51416003)(6916009)(7696005)(2351001)(16586007)(86362001)(47776003)(54906003)(26005)(50226002)(2876002)(8936002)(81156014)(81166006)(2906002)(16060500001);
 DIR:OUT; SFP:1101; SCL:1; SRVR:MN2PR12MB3679; H:SATLEXMB02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: bf56504b-49fb-42c1-aadb-08d76397b3a1
X-MS-TrafficTypeDiagnostic: MN2PR12MB3679:
X-Microsoft-Antispam-PRVS: <MN2PR12MB367953E2A70CCC2750949DBEE4780@MN2PR12MB3679.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:5236;
X-Forefront-PRVS: 0214EB3F68
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: QSTrJGdkC2pL53cOcPBlaUVLUfZUxit9PpgpK1GDKfxv0lyvBBtGx5iyC9YpPue6dteZA4zwhpQI/Le/AKQJXqtoQstreVHH7p1DsqJz+AbePGgLVu7ZZYCMbzZjs8t+wxLuSVxWMPuPbrKfCfbwUNiR1SvzMugGzKDnD8Je8+l3Wv8XrX73uPr/kU+e6WTjlx/g3nXnM2gCpmsGzxyk8IEGNdo2UcadWrMs3h+692eheDc2H8wqeJ4m9MqPyQBZa3bCajB377SWUkn24Ko+7oWQ+UVxIb4RPJet/Xu7klfh/flvInW+Hxww5h/X235yqZCaQnHpEP8I+ZdnaxF4OPKTTpnFCxeyxJtTxxmQLtfQaXhW+yxRDBzBazaijm3p4A05Wz/zu/DGq8wiCKoI7Fglj1bdytpwGlnPQg3Xup3Cp2TZPhwdxZz8i4dydXdG
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 07 Nov 2019 15:32:30.0212 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: bf56504b-49fb-42c1-aadb-08d76397b3a1
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MN2PR12MB3679
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=tTBIyR3HOvIzIJ8AkTeEJXHSWsKag+du9dnyLyuhRvM=;
 b=B20ZokC3sYQWOXusiLxOJVLiyRXrLBdPOgL3sOmcHmKEFheAjGfHRY2G52i11/vewhGFxI2tV47oS4Z8/7PFTa/hiLBC6526+Or+qjP9KA19dhy8JM4AKisbPgNxLslYCAXhIY+g8FT7qVJUJW7WMY6KOgy3c3qTVye6Bd32fmc=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none (message not signed)
 header.d=none;lists.freedesktop.org; dmarc=permerror action=none
 header.from=amd.com;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Francis <David.Francis@amd.com>,
 Mikita Lipski <mikita.lipski@amd.com>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGF2aWQgRnJhbmNpcyA8RGF2aWQuRnJhbmNpc0BhbWQuY29tPgoKSWYgdGhlcmUgaXMg
bGltaXRlZCBsaW5rIGJhbmR3aWR0aCBvbiBhIE1TVCBuZXR3b3JrLAppdCBtdXN0IGJlIGRpdmlk
ZWQgZmFpcmx5IGJldHdlZW4gdGhlIHN0cmVhbXMgb24gdGhhdCBuZXR3b3JrCgpJbXBsZW1lbnQg
YW4gYWxnb3JpdGhtIHRvIGRldGVybWluZSB0aGUgY29ycmVjdCBEU0MgY29uZmlnCmZvciBlYWNo
IHN0cmVhbQoKVGhlIGFsZ29yaXRobToKVGhpcwogICAgIFsgICAgICAgICAgICAgICAgICAgXSAg
ICAgICAgICAoICkKcmVwcmVzZW50cyB0aGUgcmFuZ2Ugb2YgYmFuZHdpZHRocyBwb3NzaWJsZSBm
b3IgYSBnaXZlbiBzdHJlYW0uClRoZSBbXSBhcmVhIHJlcHJlc2VudHMgdGhlIHJhbmdlIG9mIERT
QyBjb25maWdzLCBhbmQgdGhlICgpCnJlcHJlc2VudHMgbm8gRFNDLiBUaGUgYmFuZHdpZHRoIHVz
ZWQgaW5jcmVhc2VzIGZyb20gbGVmdCB0byByaWdodC4KCkZpcnN0LCB0cnkgZGlzYWJsaW5nIERT
QyBvbiBhbGwgc3RyZWFtcwogICAgIFsgICAgICAgICAgICAgICAgICBdICAgICAgICAgICh8KQog
ICAgIFsgICAgICAgICAgICAgICAgICAgICBdICAgICAgICAgICAgKHwpCkNoZWNrIHRoaXMgYWdh
aW5zdCB0aGUgYmFuZHdpZHRoIGxpbWl0cyBvZiB0aGUgbGluayBhbmQgZWFjaCBicmFuY2gKKGlu
Y2x1ZGluZyBlYWNoIGVuZHBvaW50KS4gSWYgaXQgcGFzc2VzLCB0aGUgam9iIGlzIGRvbmUKClNl
Y29uZCwgdHJ5IG1heGltdW0gRFNDIGNvbXByZXNzaW9uIG9uIGFsbCBzdHJlYW1zCnRoYXQgc3Vw
cG9ydCBEU0MKICAgICBbfCAgICAgICAgIF0gICAgICAgICggKQogICAgIFt8ICAgICAgICAgICAg
ICAgIF0gICAgICAgICAoICkKSWYgdGhpcyBkb2VzIG5vdCBwYXNzLCB0aGVuIGVuYWJsaW5nIHRo
aXMgY29tYmluYXRpb24gb2Ygc3RyZWFtcwppcyBpbXBvc3NpYmxlCgpPdGhlcndpc2UsIGRpdmlk
ZSB0aGUgcmVtYWluaW5nIGJhbmR3aWR0aCBldmVubHkgYW1vbmdzdCB0aGUgc3RyZWFtcwogICAg
IFsgICAgICAgIHwgIF0gICAgICAgICAoICkKICAgICBbICAgICAgICB8ICAgICAgXSAgICAgICAg
KCApCgpJZiBvbmUgb3IgbW9yZSBvZiB0aGUgc3RyZWFtcyByZWFjaCBtaW5pbXVtIGNvbXByZXNz
aW9uLCBldmVubHkKZGl2aWRlIHRoZSByZWFtaW5pbmcgYmFuZHdpZHRoIGFtb25nc3QgdGhlIHJl
bWFpbmluZyBzdHJlYW1zCiAgICAgWyAgICB8XSAoICkKICAgICBbICAgICAgIHxdICAgKCApCiAg
ICAgWyAgICAgICAgICAgICAgICAgfCAgIF0gICAgICAgICAgICAgICAoICkKICAgICBbICAgICAg
ICAgICAgICAgICB8ICAgICAgXSAgICAgICAgICAgICAgICAgICggKQoKSWYgYWxsIHN0cmVhbXMg
Y2FuIHJlYWNoIG1pbmltdW0gY29tcHJlc3Npb24sIGRpc2FibGUgY29tcHJlc3Npb24KZ3JlZWRp
bHkKICAgICBbICAgICAgfF0gICggKQogICAgIFsgICAgICAgIHxdICAgICggKQogICAgIFsgICAg
ICAgICAgICAgICAgIF0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh8KQoKUGVyZm9y
bSB0aGlzIGFsZ29yaXRobSBvbiBlYWNoIGZ1bGwgdXBkYXRlLCBvbiBlYWNoIE1TVCBsaW5rCndp
dGggYXQgbGVhc3Qgb25lIERTQyBzdHJlYW0gb24gaXQKCkFmdGVyIHRoZSBjb25maWdzIGFyZSBj
b21wdXRlZCwgY2FsbApkY24yMF9hZGRfZHNjX3RvX3N0cmVhbV9yZXNvdXJjZSBvbiBlYWNoIHN0
cmVhbSB3aXRoIERTQyBlbmFibGVkLgpJdCBpcyBvbmx5IGFmdGVyIGFsbCBzdHJlYW1zIGFyZSBj
cmVhdGVkIHRoYXQgd2UgY2FuIGtub3cgd2hpY2gKb2YgdGhlbSB3aWxsIG5lZWQgRFNDLgoKRG8g
YWxsIG9mIHRoaXMgYXQgdGhlIGVuZCBvZiBhbWRncHUgYXRvbWljIGNoZWNrLiAgSWYgaXQgZmFp
bHMsCmZhaWwgY2hlY2s7IFRoaXMgY29tYmluYXRpb24gb2YgdGltaW5ncyBjYW5ub3QgYmUgc3Vw
cG9ydGVkLgoKdjI6IFVzZSBkcm1fZHBfbXN0X2F0b21pY19jaGVjayB0byB2YWxpZGF0ZSBidyBm
b3IgY2VydGFpbiBkc2MKY29uZmlndXJhdGlvbnMKClJldmlld2VkLWJ5OiBXZW5qaW5nIExpdSA8
V2VuamluZy5MaXVAYW1kLmNvbT4KU2lnbmVkLW9mZi1ieTogRGF2aWQgRnJhbmNpcyA8RGF2aWQu
RnJhbmNpc0BhbWQuY29tPgpTaWduZWQtb2ZmLWJ5OiBNaWtpdGEgTGlwc2tpIDxtaWtpdGEubGlw
c2tpQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdw
dV9kbS5jIHwgICA0ICsKIC4uLi9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG1fbXN0X3R5cGVz
LmMgICB8IDM5NyArKysrKysrKysrKysrKysrKysKIC4uLi9kaXNwbGF5L2FtZGdwdV9kbS9hbWRn
cHVfZG1fbXN0X3R5cGVzLmggICB8ICAgNSArCiAuLi4vZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIw
L2RjbjIwX3Jlc291cmNlLmMgfCAgIDMgKwogLi4uL2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9k
Y24yMF9yZXNvdXJjZS5oIHwgICAxICsKIDUgZmlsZXMgY2hhbmdlZCwgNDEwIGluc2VydGlvbnMo
KykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2Ft
ZGdwdV9kbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVf
ZG0uYwppbmRleCAxMDVhYjU3NTE1ZmUuLjYwOTAyMGEwNTQ5ZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCkBAIC04MDY0LDYgKzgw
NjQsMTAgQEAgc3RhdGljIGludCBhbWRncHVfZG1fYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsCiAJCWlmIChyZXQpCiAJCQlnb3RvIGZhaWw7CiAKKyNpZmRlZiBDT05GSUdfRFJN
X0FNRF9EQ19EU0NfU1VQUE9SVAorCQlpZiAoIWNvbXB1dGVfbXN0X2RzY19jb25maWdzX2Zvcl9z
dGF0ZShzdGF0ZSwgZG1fc3RhdGUtPmNvbnRleHQpKQorCQkJZ290byBmYWlsOworI2VuZGlmCiAJ
CWlmIChkY192YWxpZGF0ZV9nbG9iYWxfc3RhdGUoZGMsIGRtX3N0YXRlLT5jb250ZXh0LCBmYWxz
ZSkgIT0gRENfT0spIHsKIAkJCXJldCA9IC1FSU5WQUw7CiAJCQlnb3RvIGZhaWw7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbV9tc3Rf
dHlwZXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2Rt
X21zdF90eXBlcy5jCmluZGV4IDgwNGEwMDA4MmJlZS4uNjA2NWYxZDhlODNlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbV9tc3RfdHlw
ZXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9k
bV9tc3RfdHlwZXMuYwpAQCAtMzgsNiArMzgsOCBAQAogCiAjaW5jbHVkZSAiaTJjYXV4X2ludGVy
ZmFjZS5oIgogCisjaW5jbHVkZSAiZGMvZGNuMjAvZGNuMjBfcmVzb3VyY2UuaCIKKwogLyogI2Rl
ZmluZSBUUkFDRV9EUENEICovCiAKICNpZmRlZiBUUkFDRV9EUENECkBAIC00OTEsMyArNDkzLDM5
OCBAQCB2b2lkIGFtZGdwdV9kbV9pbml0aWFsaXplX2RwX2Nvbm5lY3RvcihzdHJ1Y3QgYW1kZ3B1
X2Rpc3BsYXlfbWFuYWdlciAqZG0sCiAJCWFjb25uZWN0b3ItPmNvbm5lY3Rvcl9pZCk7CiB9CiAK
KyNpZmRlZiBDT05GSUdfRFJNX0FNRF9EQ19EU0NfU1VQUE9SVAorc3RydWN0IGRzY19tc3RfZmFp
cm5lc3NfcGFyYW1zIHsKKwlzdHJ1Y3QgZGNfY3J0Y190aW1pbmcgKnRpbWluZzsKKwlzdHJ1Y3Qg
ZGNfc2luayAqc2luazsKKwlzdHJ1Y3QgZGNfZHNjX2J3X3JhbmdlIGJ3X3JhbmdlOworCWJvb2wg
Y29tcHJlc3Npb25fcG9zc2libGU7CisJc3RydWN0IGRybV9kcF9tc3RfcG9ydCAqcG9ydDsKK307
CisKK3N0cnVjdCBkc2NfbXN0X2ZhaXJuZXNzX3ZhcnMgeworCWludCBwYm47CisJYm9vbCBkc2Nf
ZW5hYmxlZDsKKwlpbnQgYnBwX3gxNjsKK307CisKK3N0YXRpYyBib29sIHBvcnRfZG93bnN0cmVh
bV9vZl9icmFuY2goc3RydWN0IGRybV9kcF9tc3RfcG9ydCAqcG9ydCwKKwkJCQkgICAgICBzdHJ1
Y3QgZHJtX2RwX21zdF9icmFuY2ggKmJyYW5jaCkKK3sKKwl3aGlsZSAocG9ydC0+cGFyZW50KSB7
CisJCWlmIChwb3J0LT5wYXJlbnQgPT0gYnJhbmNoKQorCQkJcmV0dXJuIHRydWU7CisKKwkJaWYg
KHBvcnQtPnBhcmVudC0+cG9ydF9wYXJlbnQpCisJCQlwb3J0ID0gcG9ydC0+cGFyZW50LT5wb3J0
X3BhcmVudDsKKwkJZWxzZQorCQkJYnJlYWs7CisJfQorCXJldHVybiBmYWxzZTsKK30KKworc3Rh
dGljIGJvb2wgY2hlY2tfcGJuX2xpbWl0X29uX2JyYW5jaChzdHJ1Y3QgZHJtX2RwX21zdF9icmFu
Y2ggKmJyYW5jaCwKKwkJc3RydWN0IGRzY19tc3RfZmFpcm5lc3NfcGFyYW1zICpwYXJhbXMsCisJ
CXN0cnVjdCBkc2NfbXN0X2ZhaXJuZXNzX3ZhcnMgKnZhcnMsIGludCBjb3VudCkKK3sKKwlzdHJ1
Y3QgZHJtX2RwX21zdF9wb3J0ICpwb3J0OworCWludCBpOworCWludCBwYm5fbGltaXQgPSAwOwor
CWludCBwYm5fdXNlZCA9IDA7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBvcnQsICZicmFuY2gt
PnBvcnRzLCBuZXh0KSB7CisJCWlmIChwb3J0LT5tc3RiKQorCQkJaWYgKCFjaGVja19wYm5fbGlt
aXRfb25fYnJhbmNoKHBvcnQtPm1zdGIsIHBhcmFtcywgdmFycywgY291bnQpKQorCQkJCXJldHVy
biBmYWxzZTsKKworCQlpZiAocG9ydC0+YXZhaWxhYmxlX3BibiA+IDApCisJCQlwYm5fbGltaXQg
PSBwb3J0LT5hdmFpbGFibGVfcGJuOworCX0KKworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsr
KSB7CisJCWlmIChwb3J0X2Rvd25zdHJlYW1fb2ZfYnJhbmNoKHBhcmFtc1tpXS5wb3J0LCBicmFu
Y2gpKQorCQkJcGJuX3VzZWQgKz0gdmFyc1tpXS5wYm47CisJfQorCisJaWYgKHBibl91c2VkID4g
cGJuX2xpbWl0KQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGlj
IGJvb2wgY2hlY2tfYmFuZHdpZHRoX2xpbWl0cyhzdHJ1Y3QgZGNfbGluayAqZGNfbGluaywKKwkJ
CQkgICBzdHJ1Y3QgZHNjX21zdF9mYWlybmVzc19wYXJhbXMgKnBhcmFtcywKKwkJCQkgICBzdHJ1
Y3QgZHNjX21zdF9mYWlybmVzc192YXJzICp2YXJzLAorCQkJCSAgIGludCBjb3VudCkKK3sKKwlp
bnQgbGlua190aW1lc2xvdF9saW1pdCA9IDYzOworCWludCBsaW5rX3RpbWVzbG90c191c2VkID0g
MDsKKwlpbnQgcGJuX3Blcl90aW1lc2xvdDsKKwlpbnQgaTsKKwlzdHJ1Y3QgZHJtX2RwX21zdF90
b3BvbG9neV9tZ3IgKm1zdF9tZ3I7CisKKwkvKiBrYml0cyB0byBwYm4sIGRpdmlkaW5nIGJ5IDY0
ICovCisKKwlwYm5fcGVyX3RpbWVzbG90ID0gZGNfbGlua19iYW5kd2lkdGhfa2JwcyhkY19saW5r
LAorCQkJZGNfbGlua19nZXRfbGlua19jYXAoZGNfbGluaykpIC8gKDggKiAxMDAwICogNTQpOwor
CisJLyogQ2hlY2sgbGluayBiYW5kd2lkdGggbGltaXQgKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291
bnQ7IGkrKykKKwkJbGlua190aW1lc2xvdHNfdXNlZCArPSBESVZfUk9VTkRfVVAodmFyc1tpXS5w
Ym4sIHBibl9wZXJfdGltZXNsb3QpOworCisJaWYgKGxpbmtfdGltZXNsb3RzX3VzZWQgPiBsaW5r
X3RpbWVzbG90X2xpbWl0KQorCQlyZXR1cm4gZmFsc2U7CisKKwkvKiBDaGVjayBicmFuY2ggYmFu
ZHdpZHRoIGxpbWl0IGZvciBlYWNoIHBvcnQgb24gZWFjaCBicmFuY2ggKi8KKwltc3RfbWdyID0g
cGFyYW1zWzBdLnBvcnQtPm1ncjsKKworCWlmICghY2hlY2tfcGJuX2xpbWl0X29uX2JyYW5jaCht
c3RfbWdyLT5tc3RfcHJpbWFyeSwgcGFyYW1zLCB2YXJzLCBjb3VudCkpCisJCXJldHVybiBmYWxz
ZTsKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGludCBrYnBzX3RvX3BlYWtfcGJuKGludCBr
YnBzKQoreworCXU2NCBwZWFrX2ticHMgPSBrYnBzOworCisJcGVha19rYnBzICo9IDEwMDY7CisJ
cGVha19rYnBzIC89IDEwMDA7CisJcmV0dXJuIChpbnQpIERJVl9ST1VORF9VUChwZWFrX2ticHMg
KiA2NCwgKDU0ICogOCAqIDEwMDApKTsKK30KKworc3RhdGljIHZvaWQgc2V0X2RzY19jb25maWdz
X2Zyb21fZmFpcm5lc3NfdmFycyhzdHJ1Y3QgZHNjX21zdF9mYWlybmVzc19wYXJhbXMgKnBhcmFt
cywKKwkJc3RydWN0IGRzY19tc3RfZmFpcm5lc3NfdmFycyAqdmFycywKKwkJaW50IGNvdW50KQor
eworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJbWVtc2V0KCZw
YXJhbXNbaV0udGltaW5nLT5kc2NfY2ZnLCAwLCBzaXplb2YocGFyYW1zW2ldLnRpbWluZy0+ZHNj
X2NmZykpOworCQlpZiAodmFyc1tpXS5kc2NfZW5hYmxlZCAmJiBkY19kc2NfY29tcHV0ZV9jb25m
aWcoCisJCQkJCXBhcmFtc1tpXS5zaW5rLT5jdHgtPmRjLT5yZXNfcG9vbC0+ZHNjc1swXSwKKwkJ
CQkJJnBhcmFtc1tpXS5zaW5rLT5zaW5rX2RzY19jYXBzLmRzY19kZWNfY2FwcywKKwkJCQkJcGFy
YW1zW2ldLnNpbmstPmN0eC0+ZGMtPmRlYnVnLmRzY19taW5fc2xpY2VfaGVpZ2h0X292ZXJyaWRl
LAorCQkJCQkwLAorCQkJCQlwYXJhbXNbaV0udGltaW5nLAorCQkJCQkmcGFyYW1zW2ldLnRpbWlu
Zy0+ZHNjX2NmZykpIHsKKwkJCXBhcmFtc1tpXS50aW1pbmctPmZsYWdzLkRTQyA9IDE7CisJCQlw
YXJhbXNbaV0udGltaW5nLT5kc2NfY2ZnLmJpdHNfcGVyX3BpeGVsID0gdmFyc1tpXS5icHBfeDE2
OworCQl9IGVsc2UgeworCQkJcGFyYW1zW2ldLnRpbWluZy0+ZmxhZ3MuRFNDID0gMDsKKwkJfQor
CisJfQorCit9CisKK3N0YXRpYyBpbnQgYnBwX3gxNl9mcm9tX3BibihzdHJ1Y3QgZHNjX21zdF9m
YWlybmVzc19wYXJhbXMgcGFyYW0sIGludCBwYm4pCit7CisJc3RydWN0IGRjX2RzY19jb25maWcg
ZHNjX2NvbmZpZzsKKwl1NjQga2JwczsKKworCWticHMgPSAodTY0KXBibiAqIDk5NCAqIDggKiA1
NCAvIDY0OworCWRjX2RzY19jb21wdXRlX2NvbmZpZygKKwkJCXBhcmFtLnNpbmstPmN0eC0+ZGMt
PnJlc19wb29sLT5kc2NzWzBdLAorCQkJJnBhcmFtLnNpbmstPnNpbmtfZHNjX2NhcHMuZHNjX2Rl
Y19jYXBzLAorCQkJcGFyYW0uc2luay0+Y3R4LT5kYy0+ZGVidWcuZHNjX21pbl9zbGljZV9oZWln
aHRfb3ZlcnJpZGUsCisJCQkoaW50KSBrYnBzLCBwYXJhbS50aW1pbmcsICZkc2NfY29uZmlnKTsK
KworCXJldHVybiBkc2NfY29uZmlnLmJpdHNfcGVyX3BpeGVsOworfQorCitzdGF0aWMgdm9pZCBp
bmNyZWFzZV9kc2NfYnBwKHN0cnVjdCBkY19saW5rICpkY19saW5rLAorCQlzdHJ1Y3QgZHNjX21z
dF9mYWlybmVzc19wYXJhbXMgKnBhcmFtcywKKwkJc3RydWN0IGRzY19tc3RfZmFpcm5lc3NfdmFy
cyAqdmFycywKKwkJaW50IGNvdW50KQoreworCWludCBpOworCWJvb2wgYnBwX2luY3JlYXNlZFtN
QVhfUElQRVNdOworCWludCBpbml0aWFsX3NsYWNrW01BWF9QSVBFU107CisJaW50IG1pbl9pbml0
aWFsX3NsYWNrOworCWludCBuZXh0X2luZGV4OworCWludCByZW1haW5pbmdfdG9faW5jcmVhc2Ug
PSAwOworCWludCBwYm5fcGVyX3RpbWVzbG90OworCWludCBsaW5rX3RpbWVzbG90c191c2VkOwor
CWludCBmYWlyX3Bibl9hbGxvYzsKKworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJ
CWlmICh2YXJzW2ldLmRzY19lbmFibGVkKSB7CisJCQlpbml0aWFsX3NsYWNrW2ldID0ga2Jwc190
b19wZWFrX3BibihwYXJhbXNbaV0uYndfcmFuZ2UubWF4X2ticHMpIC0gdmFyc1tpXS5wYm47CisJ
CQlicHBfaW5jcmVhc2VkW2ldID0gZmFsc2U7CisJCQlyZW1haW5pbmdfdG9faW5jcmVhc2UgKz0g
MTsKKwkJfSBlbHNlIHsKKwkJCWluaXRpYWxfc2xhY2tbaV0gPSAwOworCQkJYnBwX2luY3JlYXNl
ZFtpXSA9IHRydWU7CisJCX0KKwl9CisKKwlwYm5fcGVyX3RpbWVzbG90ID0gZGNfbGlua19iYW5k
d2lkdGhfa2JwcyhkY19saW5rLAorCQkJZGNfbGlua19nZXRfbGlua19jYXAoZGNfbGluaykpIC8g
KDggKiAxMDAwICogNTQpOworCisJd2hpbGUgKHJlbWFpbmluZ190b19pbmNyZWFzZSkgeworCQlu
ZXh0X2luZGV4ID0gLTE7CisJCW1pbl9pbml0aWFsX3NsYWNrID0gLTE7CisJCWZvciAoaSA9IDA7
IGkgPCBjb3VudDsgaSsrKSB7CisJCQlpZiAoIWJwcF9pbmNyZWFzZWRbaV0pIHsKKwkJCQlpZiAo
bWluX2luaXRpYWxfc2xhY2sgPT0gLTEgfHwgbWluX2luaXRpYWxfc2xhY2sgPiBpbml0aWFsX3Ns
YWNrW2ldKSB7CisJCQkJCW1pbl9pbml0aWFsX3NsYWNrID0gaW5pdGlhbF9zbGFja1tpXTsKKwkJ
CQkJbmV4dF9pbmRleCA9IGk7CisJCQkJfQorCQkJfQorCQl9CisKKwkJaWYgKG5leHRfaW5kZXgg
PT0gLTEpCisJCQlicmVhazsKKworCQlsaW5rX3RpbWVzbG90c191c2VkID0gMDsKKworCQlmb3Ig
KGkgPSAwOyBpIDwgY291bnQ7IGkrKykKKwkJCWxpbmtfdGltZXNsb3RzX3VzZWQgKz0gRElWX1JP
VU5EX1VQKHZhcnNbaV0ucGJuLCBwYm5fcGVyX3RpbWVzbG90KTsKKworCQlmYWlyX3Bibl9hbGxv
YyA9ICg2MyAtIGxpbmtfdGltZXNsb3RzX3VzZWQpIC8gcmVtYWluaW5nX3RvX2luY3JlYXNlICog
cGJuX3Blcl90aW1lc2xvdDsKKworCQlpZiAoaW5pdGlhbF9zbGFja1tuZXh0X2luZGV4XSA+IGZh
aXJfcGJuX2FsbG9jKSB7CisJCQl2YXJzW25leHRfaW5kZXhdLnBibiArPSBmYWlyX3Bibl9hbGxv
YzsKKwkJCWlmIChjaGVja19iYW5kd2lkdGhfbGltaXRzKGRjX2xpbmssIHBhcmFtcywgdmFycywg
Y291bnQpKQorCQkJCXZhcnNbbmV4dF9pbmRleF0uYnBwX3gxNiA9IGJwcF94MTZfZnJvbV9wYm4o
cGFyYW1zW25leHRfaW5kZXhdLCB2YXJzW25leHRfaW5kZXhdLnBibik7CisJCQllbHNlCisJCQkJ
dmFyc1tuZXh0X2luZGV4XS5wYm4gLT0gZmFpcl9wYm5fYWxsb2M7CisJCX0gZWxzZSB7CisJCQl2
YXJzW25leHRfaW5kZXhdLnBibiArPSBpbml0aWFsX3NsYWNrW25leHRfaW5kZXhdOworCQkJaWYg
KGNoZWNrX2JhbmR3aWR0aF9saW1pdHMoZGNfbGluaywgcGFyYW1zLCB2YXJzLCBjb3VudCkpCisJ
CQkJdmFyc1tuZXh0X2luZGV4XS5icHBfeDE2ID0gcGFyYW1zW25leHRfaW5kZXhdLmJ3X3Jhbmdl
Lm1heF90YXJnZXRfYnBwX3gxNjsKKwkJCWVsc2UKKwkJCQl2YXJzW25leHRfaW5kZXhdLnBibiAt
PSBpbml0aWFsX3NsYWNrW25leHRfaW5kZXhdOworCQl9CisKKwkJYnBwX2luY3JlYXNlZFtuZXh0
X2luZGV4XSA9IHRydWU7CisJCXJlbWFpbmluZ190b19pbmNyZWFzZS0tOworCX0KK30KKworc3Rh
dGljIHZvaWQgdHJ5X2Rpc2FibGVfZHNjKHN0cnVjdCBkY19saW5rICpkY19saW5rLAorCQlzdHJ1
Y3QgZHNjX21zdF9mYWlybmVzc19wYXJhbXMgKnBhcmFtcywKKwkJc3RydWN0IGRzY19tc3RfZmFp
cm5lc3NfdmFycyAqdmFycywKKwkJaW50IGNvdW50KQoreworCWludCBpOworCWJvb2wgdHJpZWRb
TUFYX1BJUEVTXTsKKwlpbnQga2Jwc19pbmNyZWFzZVtNQVhfUElQRVNdOworCWludCBtYXhfa2Jw
c19pbmNyZWFzZTsKKwlpbnQgbmV4dF9pbmRleDsKKwlpbnQgcmVtYWluaW5nX3RvX3RyeSA9IDA7
CisKKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgeworCQlpZiAodmFyc1tpXS5kc2NfZW5h
YmxlZCAmJiB2YXJzW2ldLmJwcF94MTYgPT0gcGFyYW1zW2ldLmJ3X3JhbmdlLm1heF90YXJnZXRf
YnBwX3gxNikgeworCQkJa2Jwc19pbmNyZWFzZVtpXSA9IHBhcmFtc1tpXS5id19yYW5nZS5zdHJl
YW1fa2JwcyAtIHBhcmFtc1tpXS5id19yYW5nZS5tYXhfa2JwczsKKwkJCXRyaWVkW2ldID0gZmFs
c2U7CisJCQlyZW1haW5pbmdfdG9fdHJ5ICs9IDE7CisJCX0gZWxzZSB7CisJCQlrYnBzX2luY3Jl
YXNlW2ldID0gMDsKKwkJCXRyaWVkW2ldID0gdHJ1ZTsKKwkJfQorCX0KKworCXdoaWxlIChyZW1h
aW5pbmdfdG9fdHJ5KSB7CisJCW5leHRfaW5kZXggPSAtMTsKKwkJbWF4X2ticHNfaW5jcmVhc2Ug
PSAtMTsKKwkJZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJCWlmICghdHJpZWRbaV0p
IHsKKwkJCQlpZiAobWF4X2ticHNfaW5jcmVhc2UgPT0gLTEgfHwgbWF4X2ticHNfaW5jcmVhc2Ug
PCBrYnBzX2luY3JlYXNlW2ldKSB7CisJCQkJCW1heF9rYnBzX2luY3JlYXNlID0ga2Jwc19pbmNy
ZWFzZVtpXTsKKwkJCQkJbmV4dF9pbmRleCA9IGk7CisJCQkJfQorCQkJfQorCQl9CisKKwkJaWYg
KG5leHRfaW5kZXggPT0gLTEpCisJCQlicmVhazsKKworCQl2YXJzW25leHRfaW5kZXhdLnBibiA9
IGticHNfdG9fcGVha19wYm4ocGFyYW1zW25leHRfaW5kZXhdLmJ3X3JhbmdlLnN0cmVhbV9rYnBz
KTsKKworCQlpZiAoY2hlY2tfYmFuZHdpZHRoX2xpbWl0cyhkY19saW5rLCBwYXJhbXMsIHZhcnMs
IGNvdW50KSkgeworCQkJdmFyc1tuZXh0X2luZGV4XS5kc2NfZW5hYmxlZCA9IGZhbHNlOworCQkJ
dmFyc1tuZXh0X2luZGV4XS5icHBfeDE2ID0gMDsKKwkJfSBlbHNlIHsKKwkJCXZhcnNbbmV4dF9p
bmRleF0ucGJuID0ga2Jwc190b19wZWFrX3BibihwYXJhbXNbbmV4dF9pbmRleF0uYndfcmFuZ2Uu
bWF4X2ticHMpOworCQl9CisKKwkJdHJpZWRbbmV4dF9pbmRleF0gPSB0cnVlOworCQlyZW1haW5p
bmdfdG9fdHJ5LS07CisJfQorfQorCitzdGF0aWMgYm9vbCBjb21wdXRlX21zdF9kc2NfY29uZmln
c19mb3JfbGluayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJCSAgICAgc3Ry
dWN0IGRjX3N0YXRlICpkY19zdGF0ZSwKKwkJCQkJICAgICBzdHJ1Y3QgZGNfbGluayAqZGNfbGlu
aykKK3sKKwlpbnQgaTsKKwlzdHJ1Y3QgZGNfc3RyZWFtX3N0YXRlICpzdHJlYW07CisJc3RydWN0
IGRzY19tc3RfZmFpcm5lc3NfcGFyYW1zIHBhcmFtc1tNQVhfUElQRVNdOworCXN0cnVjdCBkc2Nf
bXN0X2ZhaXJuZXNzX3ZhcnMgdmFyc1tNQVhfUElQRVNdOworCXN0cnVjdCBhbWRncHVfZG1fY29u
bmVjdG9yICphY29ubmVjdG9yOworCWludCBjb3VudCA9IDA7CisKKwltZW1zZXQocGFyYW1zLCAw
LCBzaXplb2YocGFyYW1zKSk7CisKKwkvKiBTZXQgdXAgcGFyYW1zICovCisJZm9yIChpID0gMDsg
aSA8IGRjX3N0YXRlLT5zdHJlYW1fY291bnQ7IGkrKykgeworCQlzdHJlYW0gPSBkY19zdGF0ZS0+
c3RyZWFtc1tpXTsKKworCQlpZiAoc3RyZWFtLT5saW5rICE9IGRjX2xpbmspCisJCQljb250aW51
ZTsKKworCQlzdHJlYW0tPnRpbWluZy5mbGFncy5EU0MgPSAwOworCisJCXBhcmFtc1tjb3VudF0u
dGltaW5nID0gJnN0cmVhbS0+dGltaW5nOworCQlwYXJhbXNbY291bnRdLnNpbmsgPSBzdHJlYW0t
PnNpbms7CisJCWFjb25uZWN0b3IgPSAoc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKilzdHJl
YW0tPmRtX3N0cmVhbV9jb250ZXh0OworCQlwYXJhbXNbY291bnRdLnBvcnQgPSBhY29ubmVjdG9y
LT5wb3J0OworCQlwYXJhbXNbY291bnRdLmNvbXByZXNzaW9uX3Bvc3NpYmxlID0gc3RyZWFtLT5z
aW5rLT5zaW5rX2RzY19jYXBzLmRzY19kZWNfY2Fwcy5pc19kc2Nfc3VwcG9ydGVkOworCQlpZiAo
IWRjX2RzY19jb21wdXRlX2JhbmR3aWR0aF9yYW5nZSgKKwkJCQlzdHJlYW0tPnNpbmstPmN0eC0+
ZGMtPnJlc19wb29sLT5kc2NzWzBdLAorCQkJCXN0cmVhbS0+c2luay0+Y3R4LT5kYy0+ZGVidWcu
ZHNjX21pbl9zbGljZV9oZWlnaHRfb3ZlcnJpZGUsCisJCQkJOCwgMTYsCisJCQkJJnN0cmVhbS0+
c2luay0+c2lua19kc2NfY2Fwcy5kc2NfZGVjX2NhcHMsCisJCQkJJnN0cmVhbS0+dGltaW5nLCAm
cGFyYW1zW2NvdW50XS5id19yYW5nZSkpCisJCQlwYXJhbXNbY291bnRdLmJ3X3JhbmdlLnN0cmVh
bV9rYnBzID0gZGNfYmFuZHdpZHRoX2luX2ticHNfZnJvbV90aW1pbmcoJnN0cmVhbS0+dGltaW5n
KTsKKworCQljb3VudCsrOworCX0KKworCS8qIFRyeSBubyBjb21wcmVzc2lvbiAqLworCWZvciAo
aSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCXZhcnNbaV0ucGJuID0ga2Jwc190b19wZWFrX3Bi
bihwYXJhbXNbaV0uYndfcmFuZ2Uuc3RyZWFtX2ticHMpOworCQl2YXJzW2ldLmRzY19lbmFibGVk
ID0gZmFsc2U7CisJCXZhcnNbaV0uYnBwX3gxNiA9IDA7CisJCWRybV9kcF9hdG9taWNfZmluZF92
Y3BpX3Nsb3RzKHN0YXRlLAorCQkJCQkgICAgICBwYXJhbXNbaV0ucG9ydC0+bWdyLAorCQkJCQkg
ICAgICBwYXJhbXNbaV0ucG9ydCwKKwkJCQkJICAgICAgdmFyc1tpXS5wYm4pOworCX0KKworCWlm
ICghZHJtX2RwX21zdF9hdG9taWNfY2hlY2soc3RhdGUpKSB7CisJCXNldF9kc2NfY29uZmlnc19m
cm9tX2ZhaXJuZXNzX3ZhcnMocGFyYW1zLCB2YXJzLCBjb3VudCk7CisJCXJldHVybiB0cnVlOwor
CX0KKworCS8qIFRyeSBtYXggY29tcHJlc3Npb24gKi8KKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7
IGkrKykgeworCQlpZiAocGFyYW1zW2ldLmNvbXByZXNzaW9uX3Bvc3NpYmxlKSB7CisJCQl2YXJz
W2ldLnBibiA9IGticHNfdG9fcGVha19wYm4ocGFyYW1zW2ldLmJ3X3JhbmdlLm1pbl9rYnBzKTsK
KwkJCXZhcnNbaV0uZHNjX2VuYWJsZWQgPSB0cnVlOworCQkJdmFyc1tpXS5icHBfeDE2ID0gcGFy
YW1zW2ldLmJ3X3JhbmdlLm1pbl90YXJnZXRfYnBwX3gxNjsKKwkJfSBlbHNlIHsKKwkJCXZhcnNb
aV0ucGJuID0ga2Jwc190b19wZWFrX3BibihwYXJhbXNbaV0uYndfcmFuZ2Uuc3RyZWFtX2ticHMp
OworCQkJdmFyc1tpXS5kc2NfZW5hYmxlZCA9IGZhbHNlOworCQkJdmFyc1tpXS5icHBfeDE2ID0g
MDsKKwkJfQorCQlkcm1fZHBfYXRvbWljX2ZpbmRfdmNwaV9zbG90cyhzdGF0ZSwKKwkJCQkJICAg
ICAgcGFyYW1zW2ldLnBvcnQtPm1nciwKKwkJCQkJICAgICAgcGFyYW1zW2ldLnBvcnQsCisJCQkJ
CSAgICAgIHZhcnNbaV0ucGJuKTsKKwl9CisJaWYgKGRybV9kcF9tc3RfYXRvbWljX2NoZWNrKHN0
YXRlKSkKKwkJcmV0dXJuIGZhbHNlOworCisJLyogT3B0aW1pemUgZGVncmVlIG9mIGNvbXByZXNz
aW9uICovCisJaW5jcmVhc2VfZHNjX2JwcChkY19saW5rLCBwYXJhbXMsIHZhcnMsIGNvdW50KTsK
KworCXRyeV9kaXNhYmxlX2RzYyhkY19saW5rLCBwYXJhbXMsIHZhcnMsIGNvdW50KTsKKworCXNl
dF9kc2NfY29uZmlnc19mcm9tX2ZhaXJuZXNzX3ZhcnMocGFyYW1zLCB2YXJzLCBjb3VudCk7CisK
KwlyZXR1cm4gdHJ1ZTsKK30KKworYm9vbCBjb21wdXRlX21zdF9kc2NfY29uZmlnc19mb3Jfc3Rh
dGUoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSAgICAgICBzdHJ1Y3QgZGNf
c3RhdGUgKmRjX3N0YXRlKQoreworCWludCBpLCBqOworCXN0cnVjdCBkY19zdHJlYW1fc3RhdGUg
KnN0cmVhbTsKKwlib29sIGNvbXB1dGVkX3N0cmVhbXNbTUFYX1BJUEVTXTsKKwlzdHJ1Y3QgYW1k
Z3B1X2RtX2Nvbm5lY3RvciAqYWNvbm5lY3RvcjsKKworCWZvciAoaSA9IDA7IGkgPCBkY19zdGF0
ZS0+c3RyZWFtX2NvdW50OyBpKyspCisJCWNvbXB1dGVkX3N0cmVhbXNbaV0gPSBmYWxzZTsKKwor
CWZvciAoaSA9IDA7IGkgPCBkY19zdGF0ZS0+c3RyZWFtX2NvdW50OyBpKyspIHsKKwkJc3RyZWFt
ID0gZGNfc3RhdGUtPnN0cmVhbXNbaV07CisKKwkJaWYgKHN0cmVhbS0+c2lnbmFsICE9IFNJR05B
TF9UWVBFX0RJU1BMQVlfUE9SVF9NU1QpCisJCQljb250aW51ZTsKKworCQlhY29ubmVjdG9yID0g
KHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICopc3RyZWFtLT5kbV9zdHJlYW1fY29udGV4dDsK
KworCQlpZiAoIWFjb25uZWN0b3IgfHwgIWFjb25uZWN0b3ItPmRjX3NpbmspCisJCQljb250aW51
ZTsKKworCQlpZiAoIWFjb25uZWN0b3ItPmRjX3NpbmstPnNpbmtfZHNjX2NhcHMuZHNjX2RlY19j
YXBzLmlzX2RzY19zdXBwb3J0ZWQpCisJCQljb250aW51ZTsKKworCQlpZiAoY29tcHV0ZWRfc3Ry
ZWFtc1tpXSkKKwkJCWNvbnRpbnVlOworCisJCW11dGV4X2xvY2soJmFjb25uZWN0b3ItPm1zdF9t
Z3IubG9jayk7CisJCWlmICghY29tcHV0ZV9tc3RfZHNjX2NvbmZpZ3NfZm9yX2xpbmsoc3RhdGUs
IGRjX3N0YXRlLCBzdHJlYW0tPmxpbmspKSB7CisJCQltdXRleF91bmxvY2soJmFjb25uZWN0b3It
Pm1zdF9tZ3IubG9jayk7CisJCQlyZXR1cm4gZmFsc2U7CisJCX0KKwkJbXV0ZXhfdW5sb2NrKCZh
Y29ubmVjdG9yLT5tc3RfbWdyLmxvY2spOworCisJCWZvciAoaiA9IDA7IGogPCBkY19zdGF0ZS0+
c3RyZWFtX2NvdW50OyBqKyspIHsKKwkJCWlmIChkY19zdGF0ZS0+c3RyZWFtc1tqXS0+bGluayA9
PSBzdHJlYW0tPmxpbmspCisJCQkJY29tcHV0ZWRfc3RyZWFtc1tqXSA9IHRydWU7CisJCX0KKwl9
CisKKwlmb3IgKGkgPSAwOyBpIDwgZGNfc3RhdGUtPnN0cmVhbV9jb3VudDsgaSsrKSB7CisJCXN0
cmVhbSA9IGRjX3N0YXRlLT5zdHJlYW1zW2ldOworCisJCWlmIChzdHJlYW0tPnRpbWluZy5mbGFn
cy5EU0MgPT0gMSkKKwkJCWRjbjIwX2FkZF9zdHJlYW1fdG9fY3R4KHN0cmVhbS0+Y3R4LT5kYywg
ZGNfc3RhdGUsIHN0cmVhbSk7CisJfQorCisJcmV0dXJuIHRydWU7Cit9CisjZW5kaWYKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21z
dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVf
ZG1fbXN0X3R5cGVzLmgKaW5kZXggMmRhODUxYjQwMDQyLi4zYjhiYjRlYTUxYzcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtX21zdF90
eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1
X2RtX21zdF90eXBlcy5oCkBAIC0zMiw0ICszMiw5IEBAIHN0cnVjdCBhbWRncHVfZG1fY29ubmVj
dG9yOwogdm9pZCBhbWRncHVfZG1faW5pdGlhbGl6ZV9kcF9jb25uZWN0b3Ioc3RydWN0IGFtZGdw
dV9kaXNwbGF5X21hbmFnZXIgKmRtLAogCQkJCSAgICAgICBzdHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5l
Y3RvciAqYWNvbm5lY3Rvcik7CiAKKworI2lmZGVmIENPTkZJR19EUk1fQU1EX0RDX0RTQ19TVVBQ
T1JUCitib29sIGNvbXB1dGVfbXN0X2RzY19jb25maWdzX2Zvcl9zdGF0ZShzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgIHN0cnVjdCBkY19zdGF0ZSAqZGNfc3RhdGUp
OworI2VuZGlmCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxh
eS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5
L2RjL2RjbjIwL2RjbjIwX3Jlc291cmNlLmMKaW5kZXggM2Q1YTc5ZmYxMTUxLi40NjhkYjZiZTVi
ODMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24y
MF9yZXNvdXJjZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9k
Y24yMF9yZXNvdXJjZS5jCkBAIC0xNTAxLDYgKzE1MDEsOSBAQCBzdGF0aWMgZW51bSBkY19zdGF0
dXMgYWRkX2RzY190b19zdHJlYW1fcmVzb3VyY2Uoc3RydWN0IGRjICpkYywKIAkJaWYgKHBpcGVf
Y3R4LT5zdHJlYW0gIT0gZGNfc3RyZWFtKQogCQkJY29udGludWU7CiAKKwkJaWYgKHBpcGVfY3R4
LT5zdHJlYW1fcmVzLmRzYykKKwkJCWNvbnRpbnVlOworCiAJCWFjcXVpcmVfZHNjKCZkY19jdHgt
PnJlc19jdHgsIHBvb2wsICZwaXBlX2N0eC0+c3RyZWFtX3Jlcy5kc2MpOwogCiAJCS8qIFRoZSBu
dW1iZXIgb2YgRFNDcyBjYW4gYmUgbGVzcyB0aGFuIHRoZSBudW1iZXIgb2YgcGlwZXMgKi8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNv
dXJjZS5oIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2RjL2RjbjIwL2RjbjIwX3Jlc291
cmNlLmgKaW5kZXggZmEwMDk4OTU4NGRjLi5mMWNmOGE2MzRjOWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9kYy9kY24yMC9kY24yMF9yZXNvdXJjZS5oCkBAIC0x
NTcsNiArMTU3LDcgQEAgdm9pZCBkY24yMF9jYWxjdWxhdGVfZGxnX3BhcmFtcygKIAogZW51bSBk
Y19zdGF0dXMgZGNuMjBfYnVpbGRfbWFwcGVkX3Jlc291cmNlKGNvbnN0IHN0cnVjdCBkYyAqZGMs
IHN0cnVjdCBkY19zdGF0ZSAqY29udGV4dCwgc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqc3RyZWFt
KTsKIGVudW0gZGNfc3RhdHVzIGRjbjIwX2FkZF9zdHJlYW1fdG9fY3R4KHN0cnVjdCBkYyAqZGMs
IHN0cnVjdCBkY19zdGF0ZSAqbmV3X2N0eCwgc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqZGNfc3Ry
ZWFtKTsKK2VudW0gZGNfc3RhdHVzIGRjbjIwX2FkZF9kc2NfdG9fc3RyZWFtX3Jlc291cmNlKHN0
cnVjdCBkYyAqZGMsIHN0cnVjdCBkY19zdGF0ZSAqZGNfY3R4LCBzdHJ1Y3QgZGNfc3RyZWFtX3N0
YXRlICpkY19zdHJlYW0pOwogZW51bSBkY19zdGF0dXMgZGNuMjBfcmVtb3ZlX3N0cmVhbV9mcm9t
X2N0eChzdHJ1Y3QgZGMgKmRjLCBzdHJ1Y3QgZGNfc3RhdGUgKm5ld19jdHgsIHN0cnVjdCBkY19z
dHJlYW1fc3RhdGUgKmRjX3N0cmVhbSk7CiBlbnVtIGRjX3N0YXR1cyBkY24yMF9nZXRfZGVmYXVs
dF9zd2l6emxlX21vZGUoc3RydWN0IGRjX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiAKLS0g
CjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
