Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3329D310639
	for <lists+dri-devel@lfdr.de>; Fri,  5 Feb 2021 09:06:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C5F356F407;
	Fri,  5 Feb 2021 08:06:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x62f.google.com (mail-pl1-x62f.google.com
 [IPv6:2607:f8b0:4864:20::62f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EC5196F407
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Feb 2021 08:06:37 +0000 (UTC)
Received: by mail-pl1-x62f.google.com with SMTP id 8so3146910plc.10
 for <dri-devel@lists.freedesktop.org>; Fri, 05 Feb 2021 00:06:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=0h7G7Mj4IDj8rnVWNvWrWgFawKxEQo6DQAh97xBXxA8=;
 b=P4T3dsp/zg51lMl4zVUf/FfHVV74HZD0vbohhptRcrdr0GN+iZ8l7eE+Lh0lnG36oT
 +ff+ITPYx4UU/QAaW/aRUrQgtrd/SUj3jzRJRe+66kwapWq268jPw/MJ5Wivjs5d4WP+
 64CdRi6IhGvJrhthmEfquhDnx/BK83ex+AKJq2529nm44TPxgZpzVArlsZh8Cvj9FxyW
 v/ha42GRHLrv1AOqdfnf872X+O/4k8oQ56mDhZvKsLMVUovAwYIHnFozqYRqrSA3R1Q/
 c19J3l2jnK7WsyUKR26mT71wU+FLRMTRkYPcgS8Or2OPtfLmbimHg7ESI1H160PH00jX
 8jsw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=0h7G7Mj4IDj8rnVWNvWrWgFawKxEQo6DQAh97xBXxA8=;
 b=fOll5VbybxFZvYIc2Zdts3fSQCgGhSy1hdi4DUGwOcNnLyTyYHA6TLa0S+p7g5BWip
 ryPOQnsFhCyvLyZkV/tii0QtdT9Y1j1YAnXpuprNUVNZ3ODei4yijBQwci64eO7Om4LU
 n/Zn0yQNlnsEwULn4B9N9rTX57VYPkYm4vAVOl+HnC6bsWFBHCoI6pS+xKMo4Qpy5sWp
 xWANc9UCb/u7gAFqp/ZOX2DQykfn6RJdt79ICJorjZXHieVYPhuiBqVWaVTAuzZrrVth
 piC+HcOJjbJQT4+LnBKDdWzmHtrMAheNSyclpH1nCMMbkJpVwM/EY19Tniy/sYozGIa7
 BdOw==
X-Gm-Message-State: AOAM533Gtpgz+g8hTiAbyruX8RL5LHhVdpiA/0VA8pqEWJ40cHwShYRQ
 DE6QpT/gGM4QhAQ4S3RNmXIX6w==
X-Google-Smtp-Source: ABdhPJwmeSiEy8q5ju3zjwrXliGZIHlzYK+gBb189/+0rR+aqgg3u0rJgcGBcFQZL55Ljr3xsdHWqg==
X-Received: by 2002:a17:902:e844:b029:de:5abb:7df1 with SMTP id
 t4-20020a170902e844b02900de5abb7df1mr3247903plg.55.1612512397486; 
 Fri, 05 Feb 2021 00:06:37 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 32sm9520070pgq.80.2021.02.05.00.06.35
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 05 Feb 2021 00:06:36 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH v6 6/7] dma-buf: system_heap: Add drm pagepool support to
 system heap
Date: Fri,  5 Feb 2021 08:06:20 +0000
Message-Id: <20210205080621.3102035-7-john.stultz@linaro.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210205080621.3102035-1-john.stultz@linaro.org>
References: <20210205080621.3102035-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, Sandeep Patil <sspatil@google.com>,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Christian Koenig <christian.koenig@amd.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXRpbGl6ZSB0aGUgZHJtIHBhZ2Vwb29sIGNvZGUgdG8gc3BlZWQgdXAgYWxsb2NhdGlvbgpwZXJm
b3JtYW5jZS4KClRoaXMgaXMgc2ltaWxhciB0byB0aGUgSU9OIHBhZ2Vwb29sIHVzYWdlLCBidXQg
dHJpZXMgdG8KdXRpbGl6ZSBnZW5lcmljIGNvZGUgaW5zdGVhZCBvZiBhIGN1c3RvbSBpbXBsZW1l
bnRhdGlvbi4KCkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBDaHJpc3Rp
YW4gS29lbmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBTdW1pdCBTZW13YWwgPHN1
bWl0LnNlbXdhbEBsaW5hcm8ub3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9y
Zz4KQ2M6IENocmlzIEdvbGRzd29ydGh5IDxjZ29sZHN3b0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IExh
dXJhIEFiYm90dCA8bGFiYm90dEBrZXJuZWwub3JnPgpDYzogQnJpYW4gU3RhcmtleSA8QnJpYW4u
U3RhcmtleUBhcm0uY29tPgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlhQGdvb2dsZS5jb20+
CkNjOiBTdXJlbiBCYWdoZGFzYXJ5YW4gPHN1cmVuYkBnb29nbGUuY29tPgpDYzogU2FuZGVlcCBQ
YXRpbCA8c3NwYXRpbEBnb29nbGUuY29tPgpDYzogRGFuaWVsIE1lbnR6IDxkYW5pZWxtZW50ekBn
b29nbGUuY29tPgpDYzogw5hyamFuIEVpZGUgPG9yamFuLmVpZGVAYXJtLmNvbT4KQ2M6IFJvYmlu
IE11cnBoeSA8cm9iaW4ubXVycGh5QGFybS5jb20+CkNjOiBFemVxdWllbCBHYXJjaWEgPGV6ZXF1
aWVsQGNvbGxhYm9yYS5jb20+CkNjOiBTaW1vbiBTZXIgPGNvbnRhY3RAZW1lcnNpb24uZnI+CkNj
OiBKYW1lcyBKb25lcyA8amFqb25lc0BudmlkaWEuY29tPgpDYzogbGludXgtbWVkaWFAdmdlci5r
ZXJuZWwub3JnCkNjOiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClNpZ25lZC1vZmYt
Ynk6IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogRml4IGJ1
aWxkIGlzc3VlIGNhdXNlZCBieSBzZWxlY3RpbmcgUEFHRV9QT09MIHcvbyBORVQKICBhcyBSZXBv
cnRlZC1ieToga2VybmVsIHRlc3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+CnYzOgoqIFNpbXBsaWZ5
IHRoZSBwYWdlIHplcm9pbmcgbG9naWMgYSBiaXQgYnkgdXNpbmcga21hcF9hdG9taWMKICBpbnN0
ZWFkIG9mIHZtYXAgYXMgc3VnZ2VzdGVkIGJ5IERhbmllbCBNZW50egp2NToKKiBTaGlmdCBhd2F5
IGZyb20gbmV0d29ya2luZyBwYWdlIHBvb2wgY29tcGxldGVseSB0bwogIGRtYWJ1ZiBwYWdlIHBv
b2wgaW1wbGVtZW50YXRpb24KdjY6CiogU3dpdGNoIGFnYWluIHRvIHVzaW5nIHRoZSBkcm1fcGFn
ZV9wb29sIGNvZGUgc2hhcmVkIHcvCiAgdHRtX3Bvb2wKLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVh
cHMvS2NvbmZpZyAgICAgICB8ICAxICsKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVh
cC5jIHwgNTYgKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0KIDIgZmlsZXMgY2hhbmdlZCwg
NTQgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Rt
YS1idWYvaGVhcHMvS2NvbmZpZyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmluZGV4
IGY3YWVmOGJjNzExOS4uN2UyODkzNGUwZGVmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYv
aGVhcHMvS2NvbmZpZworKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtNCw2
ICs0LDcgQEAgY29uZmlnIERNQUJVRl9IRUFQU19ERUZFUlJFRF9GUkVFCiBjb25maWcgRE1BQlVG
X0hFQVBTX1NZU1RFTQogCWJvb2wgIkRNQS1CVUYgU3lzdGVtIEhlYXAiCiAJZGVwZW5kcyBvbiBE
TUFCVUZfSEVBUFMKKwlzZWxlY3QgRFJNX1BBR0VfUE9PTAogCWhlbHAKIAkgIENob29zZSB0aGlz
IG9wdGlvbiB0byBlbmFibGUgdGhlIHN5c3RlbSBkbWFidWYgaGVhcC4gVGhlIHN5c3RlbSBoZWFw
CiAJICBpcyBiYWNrZWQgYnkgcGFnZXMgZnJvbSB0aGUgYnVkZHkgYWxsb2NhdG9yLiBJZiBpbiBk
b3VidCwgc2F5IFkuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hl
YXAuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCmluZGV4IDE3ZTBlOWE2
OGJhZi4uNmQzOWU5ZjMyZTM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lz
dGVtX2hlYXAuYworKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hlYXAuYwpAQCAt
MjEsNiArMjEsOCBAQAogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KICNpbmNsdWRlIDxsaW51eC92
bWFsbG9jLmg+CiAKKyNpbmNsdWRlIDxkcm0vcGFnZV9wb29sLmg+CisKIHN0YXRpYyBzdHJ1Y3Qg
ZG1hX2hlYXAgKnN5c19oZWFwOwogCiBzdHJ1Y3Qgc3lzdGVtX2hlYXBfYnVmZmVyIHsKQEAgLTUz
LDYgKzU1LDcgQEAgc3RhdGljIGdmcF90IG9yZGVyX2ZsYWdzW10gPSB7SElHSF9PUkRFUl9HRlAs
IExPV19PUkRFUl9HRlAsIExPV19PUkRFUl9HRlB9OwogICovCiBzdGF0aWMgY29uc3QgdW5zaWdu
ZWQgaW50IG9yZGVyc1tdID0gezgsIDQsIDB9OwogI2RlZmluZSBOVU1fT1JERVJTIEFSUkFZX1NJ
WkUob3JkZXJzKQorc3RydWN0IGRybV9wYWdlX3Bvb2wgKnBvb2xzW05VTV9PUkRFUlNdOwogCiBz
dGF0aWMgc3RydWN0IHNnX3RhYmxlICpkdXBfc2dfdGFibGUoc3RydWN0IHNnX3RhYmxlICp0YWJs
ZSkKIHsKQEAgLTI4MSwxOCArMjg0LDQ5IEBAIHN0YXRpYyB2b2lkIHN5c3RlbV9oZWFwX3Z1bm1h
cChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3QgZG1hX2J1Zl9tYXAgKm1hcCkKIAlkbWFf
YnVmX21hcF9jbGVhcihtYXApOwogfQogCitzdGF0aWMgaW50IHN5c3RlbV9oZWFwX2ZyZWVfcGFn
ZXMoc3RydWN0IHBhZ2UgKnAsIHVuc2lnbmVkIGludCBvcmRlcikKK3sKKwlfX2ZyZWVfcGFnZXMo
cCwgb3JkZXIpOworCXJldHVybiAxIDw8IG9yZGVyOworfQorCitzdGF0aWMgaW50IHN5c3RlbV9o
ZWFwX3plcm9fYnVmZmVyKHN0cnVjdCBzeXN0ZW1faGVhcF9idWZmZXIgKmJ1ZmZlcikKK3sKKwlz
dHJ1Y3Qgc2dfdGFibGUgKnNndCA9ICZidWZmZXItPnNnX3RhYmxlOworCXN0cnVjdCBzZ19wYWdl
X2l0ZXIgcGl0ZXI7CisJc3RydWN0IHBhZ2UgKnA7CisJdm9pZCAqdmFkZHI7CisJaW50IHJldCA9
IDA7CisKKwlmb3JfZWFjaF9zZ3RhYmxlX3BhZ2Uoc2d0LCAmcGl0ZXIsIDApIHsKKwkJcCA9IHNn
X3BhZ2VfaXRlcl9wYWdlKCZwaXRlcik7CisJCXZhZGRyID0ga21hcF9hdG9taWMocCk7CisJCW1l
bXNldCh2YWRkciwgMCwgUEFHRV9TSVpFKTsKKwkJa3VubWFwX2F0b21pYyh2YWRkcik7CisJfQor
CisJcmV0dXJuIHJldDsKK30KKwogc3RhdGljIHZvaWQgc3lzdGVtX2hlYXBfZG1hX2J1Zl9yZWxl
YXNlKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCiB7CiAJc3RydWN0IHN5c3RlbV9oZWFwX2J1ZmZl
ciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OwogCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7CiAJc3Ry
dWN0IHNjYXR0ZXJsaXN0ICpzZzsKLQlpbnQgaTsKKwlpbnQgaSwgajsKKworCS8qIFplcm8gdGhl
IGJ1ZmZlciBwYWdlcyBiZWZvcmUgYWRkaW5nIGJhY2sgdG8gdGhlIHBvb2wgKi8KKwlzeXN0ZW1f
aGVhcF96ZXJvX2J1ZmZlcihidWZmZXIpOwogCiAJdGFibGUgPSAmYnVmZmVyLT5zZ190YWJsZTsK
IAlmb3JfZWFjaF9zZyh0YWJsZS0+c2dsLCBzZywgdGFibGUtPm5lbnRzLCBpKSB7CiAJCXN0cnVj
dCBwYWdlICpwYWdlID0gc2dfcGFnZShzZyk7CiAKLQkJX19mcmVlX3BhZ2VzKHBhZ2UsIGNvbXBv
dW5kX29yZGVyKHBhZ2UpKTsKKwkJZm9yIChqID0gMDsgaiA8IE5VTV9PUkRFUlM7IGorKykgewor
CQkJaWYgKGNvbXBvdW5kX29yZGVyKHBhZ2UpID09IG9yZGVyc1tqXSkKKwkJCQlicmVhazsKKwkJ
fQorCQlkcm1fcGFnZV9wb29sX2FkZChwb29sc1tqXSwgcGFnZSk7CiAJfQogCXNnX2ZyZWVfdGFi
bGUodGFibGUpOwogCWtmcmVlKGJ1ZmZlcik7CkBAIC0zMjMsNyArMzU3LDkgQEAgc3RhdGljIHN0
cnVjdCBwYWdlICphbGxvY19sYXJnZXN0X2F2YWlsYWJsZSh1bnNpZ25lZCBsb25nIHNpemUsCiAJ
CWlmIChtYXhfb3JkZXIgPCBvcmRlcnNbaV0pCiAJCQljb250aW51ZTsKIAotCQlwYWdlID0gYWxs
b2NfcGFnZXMob3JkZXJfZmxhZ3NbaV0sIG9yZGVyc1tpXSk7CisJCXBhZ2UgPSBkcm1fcGFnZV9w
b29sX2ZldGNoKHBvb2xzW2ldKTsKKwkJaWYgKCFwYWdlKQorCQkJcGFnZSA9IGFsbG9jX3BhZ2Vz
KG9yZGVyX2ZsYWdzW2ldLCBvcmRlcnNbaV0pOwogCQlpZiAoIXBhZ2UpCiAJCQljb250aW51ZTsK
IAkJcmV0dXJuIHBhZ2U7CkBAIC00MjgsNiArNDY0LDIwIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZG1hX2hlYXBfb3BzIHN5c3RlbV9oZWFwX29wcyA9IHsKIHN0YXRpYyBpbnQgc3lzdGVtX2hlYXBf
Y3JlYXRlKHZvaWQpCiB7CiAJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOwor
CWludCBpOworCisJZm9yIChpID0gMDsgaSA8IE5VTV9PUkRFUlM7IGkrKykgeworCQlwb29sc1tp
XSA9IGRybV9wYWdlX3Bvb2xfY3JlYXRlKG9yZGVyc1tpXSwKKwkJCQkJCXN5c3RlbV9oZWFwX2Zy
ZWVfcGFnZXMpOworCQlpZiAoSVNfRVJSKHBvb2xzW2ldKSkgeworCQkJaW50IGo7CisKKwkJCXBy
X2VycigiJXM6IHBhZ2UgcG9vbCBjcmVhdGlvbiBmYWlsZWQhXG4iLCBfX2Z1bmNfXyk7CisJCQlm
b3IgKGogPSAwOyBqIDwgaTsgaisrKQorCQkJCWRybV9wYWdlX3Bvb2xfZGVzdHJveShwb29sc1tq
XSk7CisJCQlyZXR1cm4gUFRSX0VSUihwb29sc1tpXSk7CisJCX0KKwl9CiAKIAlleHBfaW5mby5u
YW1lID0gInN5c3RlbSI7CiAJZXhwX2luZm8ub3BzID0gJnN5c3RlbV9oZWFwX29wczsKLS0gCjIu
MjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
