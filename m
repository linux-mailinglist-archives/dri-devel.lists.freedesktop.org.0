Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 204A3293AD
	for <lists+dri-devel@lfdr.de>; Fri, 24 May 2019 10:55:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43C7A6E0D3;
	Fri, 24 May 2019 08:54:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x541.google.com (mail-ed1-x541.google.com
 [IPv6:2a00:1450:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5120D6E0C0
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 08:54:28 +0000 (UTC)
Received: by mail-ed1-x541.google.com with SMTP id m4so13313143edd.8
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 01:54:28 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=NyywHSxKSH9rbkQEVW1bm0OZNGSWaexy3bIHHkDY0kE=;
 b=FCRXHfQyQztPsNJm1BGOOptCFO+uKqVv9XEylYUQ1os0pH2AKWVvzO8ItPMAWyUa9V
 cSTBFmh/aEQmgC2NhuqoeJp3h61SFTdTeQInxEzOWKwYPZJmJ4rNKGZljE1JD7vv7AlI
 yCTawezG5EmGhcLQMJYG/bTPpj6ltXIGMHYA/i/lt5E5qPZpXTdbUEXXN0dIYpUn/Dhm
 K+wsok0rwBS831WoN5jbmvXzkosnnolXW1bd1q4HM1AvdDduliIY4WDaJ8dP8y40nhA3
 Syl3ipXPLfVj8U7C3/U9MloYItsl5CbBSzk8uGpi5gx0u7lxi9BBuVwrzBW4dgxb8/qe
 NQsg==
X-Gm-Message-State: APjAAAWkH2DSQKNawMWo+eHOb4Sj8u1ahnCZdPyiADNnb2l/YLiYspQE
 k0MwSLBeNlsm6JdQUVKwoj8mKw==
X-Google-Smtp-Source: APXvYqy8nQ6bPqZUOgLBxI8b048mVlS0CkyrXVYKquODpFSZ2z52RRZ6sBweNIA0DpeVh2fM84FcFg==
X-Received: by 2002:a50:86c9:: with SMTP id 9mr101372796edu.216.1558688065530; 
 Fri, 24 May 2019 01:54:25 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id 96sm567082edq.68.2019.05.24.01.54.24
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Fri, 24 May 2019 01:54:24 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH 18/33] fbdev: make unregister/unlink functions not fail
Date: Fri, 24 May 2019 10:53:39 +0200
Message-Id: <20190524085354.27411-19-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190524085354.27411-1-daniel.vetter@ffwll.ch>
References: <20190524085354.27411-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=NyywHSxKSH9rbkQEVW1bm0OZNGSWaexy3bIHHkDY0kE=;
 b=Wz3jED3s1edTRWNDeaM5Rm4rK/0qjkWQb4ojq16+nzFJvA1l63U1vMUWvqjuSh+U61
 18s3GxLSXxQBDnPLr5aroa7HYa6jO09GWpQWB4pgsh7QNL7rK41P4MBi8vOSFgL5bKIY
 mun19+DRBDj7FQcSQIJYIYEzA75m3wzcq/6jk=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-fbdev@vger.kernel.org,
 Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 DRI Development <dri-devel@lists.freedesktop.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Hans de Goede <hdegoede@redhat.com>, Mikulas Patocka <mpatocka@redhat.com>,
 Daniel Vetter <daniel.vetter@intel.com>, Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXhjZXB0IGZvciBkcml2ZXIgYnVncyAod2hpY2ggd2UnbGwgY2F0Y2ggd2l0aCBhIFdBUk5fT04p
IHRoaXMgaXMgb25seQp0byByZXBvcnQgZmFpbHVyZXMgb2YgdGhlIG5ldyBkcml2ZXIgdGFraW5n
IG92ZXIgdGhlIGNvbnNvbGUuIFRoZXJlJ3MKbm90aGluZyB0aGUgb3V0Z29pbmcgZHJpdmVyIGNh
biBkbyBhYm91dCB0aGF0LCBhbmQgbm8gb25lIGV2ZXIKYm90aGVyZWQgdG8gYWN0dWFsbHkgbG9v
ayBhdCB0aGVzZSByZXR1cm4gdmFsdWVzLiBTbyByZW1vdmUgdGhlbSBhbGwuCgp2MjogZml4dXAg
dW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlciBpbiBzYXZhZ2VmYiwgZmJ0ZnQsIGl2dHZmYiwgYW5kIG5l
b2ZiCmRyaXZlcnMsIHJlcG9ydGVkIGJ5IGtidWlsZC4KClNpZ25lZC1vZmYtYnk6IERhbmllbCBW
ZXR0ZXIgPGRhbmllbC52ZXR0ZXJAaW50ZWwuY29tPgpDYzogQmFydGxvbWllaiBab2xuaWVya2ll
d2ljeiA8Yi56b2xuaWVya2llQHNhbXN1bmcuY29tPgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVs
LnZldHRlckBmZndsbC5jaD4KQ2M6ICJNaWNoYcWCIE1pcm9zxYJhdyIgPG1pcnEtbGludXhAcmVy
ZS5xbXFtLnBsPgpDYzogUGV0ZXIgUm9zaW4gPHBlZGFAYXhlbnRpYS5zZT4KQ2M6IEhhbnMgZGUg
R29lZGUgPGhkZWdvZWRlQHJlZGhhdC5jb20+CkNjOiBNaWt1bGFzIFBhdG9ja2EgPG1wYXRvY2th
QHJlZGhhdC5jb20+CkNjOiBsaW51eC1mYmRldkB2Z2VyLmtlcm5lbC5vcmcKLS0tCiBkcml2ZXJz
L21lZGlhL3BjaS9pdnR2L2l2dHZmYi5jICAgICAgICAgICAgICB8ICA2ICstCiBkcml2ZXJzL3N0
YWdpbmcvZmJ0ZnQvZmJ0ZnQtY29yZS5jICAgICAgICAgICB8ICA0ICstCiBkcml2ZXJzL3ZpZGVv
L2ZiZGV2L2NvcmUvZmJtZW0uYyAgICAgICAgICAgICB8IDczICsrKysrKy0tLS0tLS0tLS0tLS0t
CiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L25lb2ZiLmMgICAgICAgICAgICAgICAgICB8ICA5ICstLQog
ZHJpdmVycy92aWRlby9mYmRldi9zYXZhZ2Uvc2F2YWdlZmJfZHJpdmVyLmMgfCAgOSArLS0KIGlu
Y2x1ZGUvbGludXgvZmIuaCAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDQgKy0KIDYgZmls
ZXMgY2hhbmdlZCwgMzEgaW5zZXJ0aW9ucygrKSwgNzQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9tZWRpYS9wY2kvaXZ0di9pdnR2ZmIuYyBiL2RyaXZlcnMvbWVkaWEvcGNpL2l2
dHYvaXZ0dmZiLmMKaW5kZXggY2ZkMjEwNDBkMGUzLi42NDM1YzcyZmY1OGUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvbWVkaWEvcGNpL2l2dHYvaXZ0dmZiLmMKKysrIGIvZHJpdmVycy9tZWRpYS9wY2kv
aXZ0di9pdnR2ZmIuYwpAQCAtMTI1OCwxMSArMTI1OCw3IEBAIHN0YXRpYyBpbnQgaXZ0dmZiX2Nh
bGxiYWNrX2NsZWFudXAoc3RydWN0IGRldmljZSAqZGV2LCB2b2lkICpwKQogCXN0cnVjdCBvc2Rf
aW5mbyAqb2kgPSBpdHYtPm9zZF9pbmZvOwogCiAJaWYgKGl0di0+djRsMl9jYXAgJiBWNEwyX0NB
UF9WSURFT19PVVRQVVQpIHsKLQkJaWYgKHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoJml0di0+b3Nk
X2luZm8tPml2dHZmYl9pbmZvKSkgewotCQkJSVZUVkZCX1dBUk4oIkZyYW1lYnVmZmVyICVkIGlz
IGluIHVzZSwgY2Fubm90IHVubG9hZFxuIiwKLQkJCQkgICAgICAgaXR2LT5pbnN0YW5jZSk7Ci0J
CQlyZXR1cm4gMDsKLQkJfQorCQl1bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKCZpdHYtPm9zZF9pbmZv
LT5pdnR2ZmJfaW5mbyk7CiAJCUlWVFZGQl9JTkZPKCJVbnJlZ2lzdGVyIGZyYW1lYnVmZmVyICVk
XG4iLCBpdHYtPmluc3RhbmNlKTsKIAkJaXR2LT5pdnR2ZmJfcmVzdG9yZSA9IE5VTEw7CiAJCWl2
dHZmYl9ibGFuayhGQl9CTEFOS19WU1lOQ19TVVNQRU5ELCAmb2ktPml2dHZmYl9pbmZvKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy9mYnRmdC9mYnRmdC1jb3JlLmMgYi9kcml2ZXJzL3N0
YWdpbmcvZmJ0ZnQvZmJ0ZnQtY29yZS5jCmluZGV4IDliMDdiYWRmNGM2Yy4uN2NiYzFiZGQyZDhh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcvZmJ0ZnQvZmJ0ZnQtY29yZS5jCisrKyBiL2Ry
aXZlcnMvc3RhZ2luZy9mYnRmdC9mYnRmdC1jb3JlLmMKQEAgLTg5MSw3ICs4OTEsOSBAQCBpbnQg
ZmJ0ZnRfdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIAlp
ZiAocGFyLT5mYnRmdG9wcy51bnJlZ2lzdGVyX2JhY2tsaWdodCkKIAkJcGFyLT5mYnRmdG9wcy51
bnJlZ2lzdGVyX2JhY2tsaWdodChwYXIpOwogCWZidGZ0X3N5c2ZzX2V4aXQocGFyKTsKLQlyZXR1
cm4gdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihmYl9pbmZvKTsKKwl1bnJlZ2lzdGVyX2ZyYW1lYnVm
ZmVyKGZiX2luZm8pOworCisJcmV0dXJuIDA7CiB9CiBFWFBPUlRfU1lNQk9MKGZidGZ0X3VucmVn
aXN0ZXJfZnJhbWVidWZmZXIpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2Nv
cmUvZmJtZW0uYyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jCmluZGV4IGYzZmMy
ZTViMTkzYy4uZjNiY2FkMzBkM2JhIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2Nv
cmUvZmJtZW0uYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJtZW0uYwpAQCAtMTU5
MCwxMyArMTU5MCwxMyBAQCBzdGF0aWMgYm9vbCBmYl9kb19hcGVydHVyZXNfb3ZlcmxhcChzdHJ1
Y3QgYXBlcnR1cmVzX3N0cnVjdCAqZ2VuYSwKIAlyZXR1cm4gZmFsc2U7CiB9CiAKLXN0YXRpYyBp
bnQgZG9fdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbyk7Citz
dGF0aWMgdm9pZCBkb191bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9p
bmZvKTsKIAogI2RlZmluZSBWR0FfRkJfUEhZUyAweEEwMDAwCi1zdGF0aWMgaW50IGRvX3JlbW92
ZV9jb25mbGljdGluZ19mcmFtZWJ1ZmZlcnMoc3RydWN0IGFwZXJ0dXJlc19zdHJ1Y3QgKmEsCi0J
CQkJCSAgICAgIGNvbnN0IGNoYXIgKm5hbWUsIGJvb2wgcHJpbWFyeSkKK3N0YXRpYyB2b2lkIGRv
X3JlbW92ZV9jb25mbGljdGluZ19mcmFtZWJ1ZmZlcnMoc3RydWN0IGFwZXJ0dXJlc19zdHJ1Y3Qg
KmEsCisJCQkJCSAgICAgICBjb25zdCBjaGFyICpuYW1lLCBib29sIHByaW1hcnkpCiB7Ci0JaW50
IGksIHJldDsKKwlpbnQgaTsKIAogCS8qIGNoZWNrIGFsbCBmaXJtd2FyZSBmYnMgYW5kIGtpY2sg
b2ZmIGlmIHRoZSBiYXNlIGFkZHIgb3ZlcmxhcHMgKi8KIAlmb3JfZWFjaF9yZWdpc3RlcmVkX2Zi
KGkpIHsKQEAgLTE2MTIsMTMgKzE2MTIsOSBAQCBzdGF0aWMgaW50IGRvX3JlbW92ZV9jb25mbGlj
dGluZ19mcmFtZWJ1ZmZlcnMoc3RydWN0IGFwZXJ0dXJlc19zdHJ1Y3QgKmEsCiAKIAkJCXByaW50
ayhLRVJOX0lORk8gImZiJWQ6IHN3aXRjaGluZyB0byAlcyBmcm9tICVzXG4iLAogCQkJICAgICAg
IGksIG5hbWUsIHJlZ2lzdGVyZWRfZmJbaV0tPmZpeC5pZCk7Ci0JCQlyZXQgPSBkb191bnJlZ2lz
dGVyX2ZyYW1lYnVmZmVyKHJlZ2lzdGVyZWRfZmJbaV0pOwotCQkJaWYgKHJldCkKLQkJCQlyZXR1
cm4gcmV0OworCQkJZG9fdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihyZWdpc3RlcmVkX2ZiW2ldKTsK
IAkJfQogCX0KLQotCXJldHVybiAwOwogfQogCiBzdGF0aWMgYm9vbCBsb2NrbGVzc19yZWdpc3Rl
cl9mYjsKQEAgLTE2MzQsMTEgKzE2MzAsOSBAQCBzdGF0aWMgaW50IGRvX3JlZ2lzdGVyX2ZyYW1l
YnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogCWlmIChmYl9jaGVja19mb3JlaWdubmVz
cyhmYl9pbmZvKSkKIAkJcmV0dXJuIC1FTk9TWVM7CiAKLQlyZXQgPSBkb19yZW1vdmVfY29uZmxp
Y3RpbmdfZnJhbWVidWZmZXJzKGZiX2luZm8tPmFwZXJ0dXJlcywKLQkJCQkJCSBmYl9pbmZvLT5m
aXguaWQsCi0JCQkJCQkgZmJfaXNfcHJpbWFyeV9kZXZpY2UoZmJfaW5mbykpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7CisJZG9fcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1lYnVmZmVycyhmYl9p
bmZvLT5hcGVydHVyZXMsCisJCQkJCSAgIGZiX2luZm8tPmZpeC5pZCwKKwkJCQkJICAgZmJfaXNf
cHJpbWFyeV9kZXZpY2UoZmJfaW5mbykpOwogCiAJaWYgKG51bV9yZWdpc3RlcmVkX2ZiID09IEZC
X01BWCkKIAkJcmV0dXJuIC1FTlhJTzsKQEAgLTE3MTQsMzIgKzE3MDgsMjUgQEAgc3RhdGljIGlu
dCBkb19yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIAlyZXR1
cm4gcmV0OwogfQogCi1zdGF0aWMgaW50IHVuYmluZF9jb25zb2xlKHN0cnVjdCBmYl9pbmZvICpm
Yl9pbmZvKQorc3RhdGljIHZvaWQgdW5iaW5kX2NvbnNvbGUoc3RydWN0IGZiX2luZm8gKmZiX2lu
Zm8pCiB7CiAJaW50IGkgPSBmYl9pbmZvLT5ub2RlOwogCi0JaWYgKGkgPCAwIHx8IGkgPj0gRkJf
TUFYIHx8IHJlZ2lzdGVyZWRfZmJbaV0gIT0gZmJfaW5mbykKLQkJcmV0dXJuIC1FSU5WQUw7CisJ
aWYgKFdBUk5fT04oaSA8IDAgfHwgaSA+PSBGQl9NQVggfHwgcmVnaXN0ZXJlZF9mYltpXSAhPSBm
Yl9pbmZvKSkKKwkJcmV0dXJuOwogCiAJY29uc29sZV9sb2NrKCk7CiAJbG9ja19mYl9pbmZvKGZi
X2luZm8pOwogCWZiY29uX2ZiX3VuYmluZChmYl9pbmZvKTsKIAl1bmxvY2tfZmJfaW5mbyhmYl9p
bmZvKTsKIAljb25zb2xlX3VubG9jaygpOwotCi0JcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQg
X191bmxpbmtfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pOworc3RhdGljIHZv
aWQgX191bmxpbmtfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pOwogCi1zdGF0
aWMgaW50IGRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8p
CitzdGF0aWMgdm9pZCBkb191bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpm
Yl9pbmZvKQogewotCWludCByZXQ7Ci0KLQlyZXQgPSB1bmJpbmRfY29uc29sZShmYl9pbmZvKTsK
LQotCWlmIChyZXQpCi0JCXJldHVybiAtRUlOVkFMOworCXVuYmluZF9jb25zb2xlKGZiX2luZm8p
OwogCiAJcG1fdnRfc3dpdGNoX3VucmVnaXN0ZXIoZmJfaW5mby0+ZGV2KTsKIApAQCAtMTc2NCwz
NiArMTc1MSwyNyBAQCBzdGF0aWMgaW50IGRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0
IGZiX2luZm8gKmZiX2luZm8pCiAKIAkvKiB0aGlzIG1heSBmcmVlIGZiIGluZm8gKi8KIAlwdXRf
ZmJfaW5mbyhmYl9pbmZvKTsKLQlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBfX3VubGlua19m
cmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKK3N0YXRpYyB2b2lkIF9fdW5saW5r
X2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogewogCWludCBpOwogCiAJaSA9
IGZiX2luZm8tPm5vZGU7Ci0JaWYgKGkgPCAwIHx8IGkgPj0gRkJfTUFYIHx8IHJlZ2lzdGVyZWRf
ZmJbaV0gIT0gZmJfaW5mbykKLQkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKFdBUk5fT04oaSA8IDAg
fHwgaSA+PSBGQl9NQVggfHwgcmVnaXN0ZXJlZF9mYltpXSAhPSBmYl9pbmZvKSkKKwkJcmV0dXJu
OwogCiAJaWYgKGZiX2luZm8tPmRldikgewogCQlkZXZpY2VfZGVzdHJveShmYl9jbGFzcywgTUtE
RVYoRkJfTUFKT1IsIGkpKTsKIAkJZmJfaW5mby0+ZGV2ID0gTlVMTDsKIAl9Ci0KLQlyZXR1cm4g
MDsKIH0KIAotaW50IHVubGlua19mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykK
K3ZvaWQgdW5saW5rX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogewotCWlu
dCByZXQ7Ci0KLQlyZXQgPSBfX3VubGlua19mcmFtZWJ1ZmZlcihmYl9pbmZvKTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OworCV9fdW5saW5rX2ZyYW1lYnVmZmVyKGZiX2luZm8pOwogCiAJdW5i
aW5kX2NvbnNvbGUoZmJfaW5mbyk7Ci0KLQlyZXR1cm4gMDsKIH0KIEVYUE9SVF9TWU1CT0wodW5s
aW5rX2ZyYW1lYnVmZmVyKTsKIApAQCAtMTgxMCw3ICsxNzg4LDYgQEAgRVhQT1JUX1NZTUJPTCh1
bmxpbmtfZnJhbWVidWZmZXIpOwogaW50IHJlbW92ZV9jb25mbGljdGluZ19mcmFtZWJ1ZmZlcnMo
c3RydWN0IGFwZXJ0dXJlc19zdHJ1Y3QgKmEsCiAJCQkJICAgIGNvbnN0IGNoYXIgKm5hbWUsIGJv
b2wgcHJpbWFyeSkKIHsKLQlpbnQgcmV0OwogCWJvb2wgZG9fZnJlZSA9IGZhbHNlOwogCiAJaWYg
KCFhKSB7CkBAIC0xODI0LDEzICsxODAxLDEzIEBAIGludCByZW1vdmVfY29uZmxpY3RpbmdfZnJh
bWVidWZmZXJzKHN0cnVjdCBhcGVydHVyZXNfc3RydWN0ICphLAogCX0KIAogCW11dGV4X2xvY2so
JnJlZ2lzdHJhdGlvbl9sb2NrKTsKLQlyZXQgPSBkb19yZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVi
dWZmZXJzKGEsIG5hbWUsIHByaW1hcnkpOworCWRvX3JlbW92ZV9jb25mbGljdGluZ19mcmFtZWJ1
ZmZlcnMoYSwgbmFtZSwgcHJpbWFyeSk7CiAJbXV0ZXhfdW5sb2NrKCZyZWdpc3RyYXRpb25fbG9j
ayk7CiAKIAlpZiAoZG9fZnJlZSkKIAkJa2ZyZWUoYSk7CiAKLQlyZXR1cm4gcmV0OworCXJldHVy
biAwOwogfQogRVhQT1JUX1NZTUJPTChyZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKTsK
IApAQCAtMTkyNywxNiArMTkwNCwxMiBAQCBFWFBPUlRfU1lNQk9MKHJlZ2lzdGVyX2ZyYW1lYnVm
ZmVyKTsKICAqICAgICAgdGhhdCB0aGUgZHJpdmVyIGltcGxlbWVudHMgZmJfb3BlbigpIGFuZCBm
Yl9yZWxlYXNlKCkgdG8KICAqICAgICAgY2hlY2sgdGhhdCBubyBwcm9jZXNzZXMgYXJlIHVzaW5n
IHRoZSBkZXZpY2UuCiAgKi8KLWludAordm9pZAogdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1
Y3QgZmJfaW5mbyAqZmJfaW5mbykKIHsKLQlpbnQgcmV0OwotCiAJbXV0ZXhfbG9jaygmcmVnaXN0
cmF0aW9uX2xvY2spOwotCXJldCA9IGRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoZmJfaW5mbyk7
CisJZG9fdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihmYl9pbmZvKTsKIAltdXRleF91bmxvY2soJnJl
Z2lzdHJhdGlvbl9sb2NrKTsKLQotCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKHVucmVn
aXN0ZXJfZnJhbWVidWZmZXIpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L25l
b2ZiLmMgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L25lb2ZiLmMKaW5kZXggNWQzYTQ0NDA4M2Y3Li5i
NzcwOTQ2YTA5MjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvbmVvZmIuYworKysg
Yi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L25lb2ZiLmMKQEAgLTIxMjIsMTQgKzIxMjIsNyBAQCBzdGF0
aWMgdm9pZCBuZW9mYl9yZW1vdmUoc3RydWN0IHBjaV9kZXYgKmRldikKIAlEQkcoIm5lb2ZiX3Jl
bW92ZSIpOwogCiAJaWYgKGluZm8pIHsKLQkJLyoKLQkJICogSWYgdW5yZWdpc3Rlcl9mcmFtZWJ1
ZmZlciBmYWlscywgdGhlbgotCQkgKiB3ZSB3aWxsIGJlIGxlYXZpbmcgaG9va3MgdGhhdCBjb3Vs
ZCBjYXVzZQotCQkgKiBvb3BzZW4gbGF5aW5nIGFyb3VuZC4KLQkJICovCi0JCWlmICh1bnJlZ2lz
dGVyX2ZyYW1lYnVmZmVyKGluZm8pKQotCQkJcHJpbnRrKEtFUk5fV0FSTklORwotCQkJICAgICAg
ICJuZW9mYjogZGFuZ2VyIGRhbmdlciEgIE9vcHNlbiBpbW1pbmVudCFcbiIpOworCQl1bnJlZ2lz
dGVyX2ZyYW1lYnVmZmVyKGluZm8pOwogCiAJCW5lb191bm1hcF92aWRlbyhpbmZvKTsKIAkJZmJf
ZGVzdHJveV9tb2RlZGIoaW5mby0+bW9uc3BlY3MubW9kZWRiKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvdmlkZW8vZmJkZXYvc2F2YWdlL3NhdmFnZWZiX2RyaXZlci5jIGIvZHJpdmVycy92aWRlby9m
YmRldi9zYXZhZ2Uvc2F2YWdlZmJfZHJpdmVyLmMKaW5kZXggNDdiNzhmMDEzOGMzLi41MTI3ODlm
NWY4ODQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvc2F2YWdlL3NhdmFnZWZiX2Ry
aXZlci5jCisrKyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvc2F2YWdlL3NhdmFnZWZiX2RyaXZlci5j
CkBAIC0yMzMzLDE0ICsyMzMzLDcgQEAgc3RhdGljIHZvaWQgc2F2YWdlZmJfcmVtb3ZlKHN0cnVj
dCBwY2lfZGV2ICpkZXYpCiAJREJHKCJzYXZhZ2VmYl9yZW1vdmUiKTsKIAogCWlmIChpbmZvKSB7
Ci0JCS8qCi0JCSAqIElmIHVucmVnaXN0ZXJfZnJhbWVidWZmZXIgZmFpbHMsIHRoZW4KLQkJICog
d2Ugd2lsbCBiZSBsZWF2aW5nIGhvb2tzIHRoYXQgY291bGQgY2F1c2UKLQkJICogb29wc2VuIGxh
eWluZyBhcm91bmQuCi0JCSAqLwotCQlpZiAodW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihpbmZvKSkK
LQkJCXByaW50ayhLRVJOX1dBUk5JTkcgInNhdmFnZWZiOiBkYW5nZXIgZGFuZ2VyISAiCi0JCQkg
ICAgICAgIk9vcHNlbiBpbW1pbmVudCFcbiIpOworCQl1bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKGlu
Zm8pOwogCiAjaWZkZWYgQ09ORklHX0ZCX1NBVkFHRV9JMkMKIAkJc2F2YWdlZmJfZGVsZXRlX2ky
Y19idXNzZXMoaW5mbyk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2ZiLmggYi9pbmNsdWRl
L2xpbnV4L2ZiLmgKaW5kZXggYjZjZTA0MWQ5ZTEzLi5iOTBjZjdkNTZiZDggMTAwNjQ0Ci0tLSBh
L2luY2x1ZGUvbGludXgvZmIuaAorKysgYi9pbmNsdWRlL2xpbnV4L2ZiLmgKQEAgLTYzNCw4ICs2
MzQsOCBAQCBleHRlcm4gc3NpemVfdCBmYl9zeXNfd3JpdGUoc3RydWN0IGZiX2luZm8gKmluZm8s
IGNvbnN0IGNoYXIgX191c2VyICpidWYsCiAKIC8qIGRyaXZlcnMvdmlkZW8vZmJtZW0uYyAqLwog
ZXh0ZXJuIGludCByZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbyk7
Ci1leHRlcm4gaW50IHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2lu
Zm8pOwotZXh0ZXJuIGludCB1bmxpbmtfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2lu
Zm8pOworZXh0ZXJuIHZvaWQgdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAq
ZmJfaW5mbyk7CitleHRlcm4gdm9pZCB1bmxpbmtfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8g
KmZiX2luZm8pOwogZXh0ZXJuIGludCByZW1vdmVfY29uZmxpY3RpbmdfcGNpX2ZyYW1lYnVmZmVy
cyhzdHJ1Y3QgcGNpX2RldiAqcGRldiwgaW50IHJlc19pZCwKIAkJCQkJICAgICAgIGNvbnN0IGNo
YXIgKm5hbWUpOwogZXh0ZXJuIGludCByZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKHN0
cnVjdCBhcGVydHVyZXNfc3RydWN0ICphLAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
