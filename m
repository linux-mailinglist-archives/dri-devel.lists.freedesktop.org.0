Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 17B97B7399
	for <lists+dri-devel@lfdr.de>; Thu, 19 Sep 2019 08:58:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A87E6F753;
	Thu, 19 Sep 2019 06:58:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [1.203.163.81])
 by gabe.freedesktop.org (Postfix) with ESMTP id AB4B86F76E
 for <dri-devel@lists.freedesktop.org>; Thu, 19 Sep 2019 06:58:25 +0000 (UTC)
X-UUID: cfb2b83457cd41f887400a2fb2492ae9-20190919
X-UUID: cfb2b83457cd41f887400a2fb2492ae9-20190919
Received: from mtkcas32.mediatek.inc [(172.27.4.253)] by mailgw02.mediatek.com
 (envelope-from <jitao.shi@mediatek.com>)
 (mailgw01.mediatek.com ESMTP with TLS)
 with ESMTP id 561124728; Thu, 19 Sep 2019 14:58:18 +0800
Received: from MTKCAS32.mediatek.inc (172.27.4.184) by MTKMBS33N1.mediatek.inc
 (172.27.4.75) with Microsoft SMTP Server (TLS) id 15.0.1395.4;
 Thu, 19 Sep 2019 14:58:16 +0800
Received: from mszsdclx1018.gcn.mediatek.inc (172.27.4.253) by
 MTKCAS32.mediatek.inc (172.27.4.170) with Microsoft SMTP Server id
 15.0.1395.4 via Frontend Transport; Thu, 19 Sep 2019 14:58:15 +0800
From: Jitao Shi <jitao.shi@mediatek.com>
To: CK Hu <ck.hu@mediatek.com>, David Airlie <airlied@linux.ie>, Daniel Vetter
 <daniel@ffwll.ch>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH v7 1/9] drm/mediatek: move mipi_dsi_host_register to probe
Date: Thu, 19 Sep 2019 14:57:58 +0800
Message-ID: <20190919065806.111016-2-jitao.shi@mediatek.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190919065806.111016-1-jitao.shi@mediatek.com>
References: <20190919065806.111016-1-jitao.shi@mediatek.com>
MIME-Version: 1.0
X-TM-SNTS-SMTP: 11CBF1AD6AEA3BD5A5B1CE9AE19B1560183FD007F06DD973C80F76FA195BA7BC2000:8
X-MTK: N
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jitao Shi <jitao.shi@mediatek.com>, srv_heupstream@mediatek.com,
 stonea168@163.com, cawa.cheng@mediatek.com, sj.huang@mediatek.com,
 linux-mediatek@lists.infradead.org, Matthias Brugger <matthias.bgg@gmail.com>,
 yingjoe.chen@mediatek.com, eddie.huang@mediatek.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFNJIHBhbmVsIGRyaXZlciBuZWVkIGF0dGFjaCBmdW5jdGlvbiB3aGljaCBpcyBpbmN1bGRlIGlu
Cm1pcGlfZHNpX2hvc3Rfb3BzLgoKSWYgbWlwaV9kc2lfaG9zdF9yZWdpc3RlciBpcyBub3QgaW4g
cHJvYmUsIGRzaSBwYW5lbCB3aWxsCnByb2JlIG1vcmUgZGVsYXkuCgpTbyBtb3ZlIHRoZSBtaXBp
X2RzaV9ob3N0X3JlZ2lzdGVyIHRvIHByb2JlIGZyb20gYmluZC4KClNpZ25lZC1vZmYtYnk6IEpp
dGFvIFNoaSA8aml0YW8uc2hpQG1lZGlhdGVrLmNvbT4KUmV2aWV3ZWQtYnk6IENLIEh1IDxjay5o
dUBtZWRpYXRlay5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kc2kuYyB8
IDUzICsrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDMxIGlu
c2VydGlvbnMoKyksIDIyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9tZWRpYXRlay9tdGtfZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RzaS5j
CmluZGV4IGI5MWM0NjE2NjQ0YS4uNTJiNDlkYWVlZDlmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2RzaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9t
dGtfZHNpLmMKQEAgLTUyMCw3ICs1MjAsNyBAQCBzdGF0aWMgczMyIG10a19kc2lfc3dpdGNoX3Rv
X2NtZF9tb2RlKHN0cnVjdCBtdGtfZHNpICpkc2ksIHU4IGlycV9mbGFnLCB1MzIgdCkKIAogc3Rh
dGljIGludCBtdGtfZHNpX3Bvd2Vyb24oc3RydWN0IG10a19kc2kgKmRzaSkKIHsKLQlzdHJ1Y3Qg
ZGV2aWNlICpkZXYgPSBkc2ktPmRldjsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSBkc2ktPmhvc3Qu
ZGV2OwogCWludCByZXQ7CiAJdTY0IHBpeGVsX2Nsb2NrLCB0b3RhbF9iaXRzOwogCXUzMiBodG90
YWwsIGh0b3RhbF9iaXRzLCBiaXRfcGVyX3BpeGVsLCBvdmVyaGVhZF9jeWNsZXMsIG92ZXJoZWFk
X2JpdHM7CkBAIC0xMDQ3LDEyICsxMDQ3LDYgQEAgc3RhdGljIGludCBtdGtfZHNpX2JpbmQoc3Ry
dWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiAJCXJl
dHVybiByZXQ7CiAJfQogCi0JcmV0ID0gbWlwaV9kc2lfaG9zdF9yZWdpc3RlcigmZHNpLT5ob3N0
KTsKLQlpZiAocmV0IDwgMCkgewotCQlkZXZfZXJyKGRldiwgImZhaWxlZCB0byByZWdpc3RlciBE
U0kgaG9zdDogJWRcbiIsIHJldCk7Ci0JCWdvdG8gZXJyX2RkcF9jb21wX3VucmVnaXN0ZXI7Ci0J
fQotCiAJcmV0ID0gbXRrX2RzaV9jcmVhdGVfY29ubl9lbmMoZHJtLCBkc2kpOwogCWlmIChyZXQp
IHsKIAkJRFJNX0VSUk9SKCJFbmNvZGVyIGNyZWF0ZSBmYWlsZWQgd2l0aCAlZFxuIiwgcmV0KTsK
QEAgLTEwNjIsOCArMTA1Niw2IEBAIHN0YXRpYyBpbnQgbXRrX2RzaV9iaW5kKHN0cnVjdCBkZXZp
Y2UgKmRldiwgc3RydWN0IGRldmljZSAqbWFzdGVyLCB2b2lkICpkYXRhKQogCXJldHVybiAwOwog
CiBlcnJfdW5yZWdpc3RlcjoKLQltaXBpX2RzaV9ob3N0X3VucmVnaXN0ZXIoJmRzaS0+aG9zdCk7
Ci1lcnJfZGRwX2NvbXBfdW5yZWdpc3RlcjoKIAltdGtfZGRwX2NvbXBfdW5yZWdpc3Rlcihkcm0s
ICZkc2ktPmRkcF9jb21wKTsKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTA3NSw3ICsxMDY3LDYgQEAg
c3RhdGljIHZvaWQgbXRrX2RzaV91bmJpbmQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2
aWNlICptYXN0ZXIsCiAJc3RydWN0IG10a19kc2kgKmRzaSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYp
OwogCiAJbXRrX2RzaV9kZXN0cm95X2Nvbm5fZW5jKGRzaSk7Ci0JbWlwaV9kc2lfaG9zdF91bnJl
Z2lzdGVyKCZkc2ktPmhvc3QpOwogCW10a19kZHBfY29tcF91bnJlZ2lzdGVyKGRybSwgJmRzaS0+
ZGRwX2NvbXApOwogfQogCkBAIC0xMDk5LDMxICsxMDkwLDM2IEBAIHN0YXRpYyBpbnQgbXRrX2Rz
aV9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCiAJZHNpLT5ob3N0Lm9wcyA9
ICZtdGtfZHNpX29wczsKIAlkc2ktPmhvc3QuZGV2ID0gZGV2OworCXJldCA9IG1pcGlfZHNpX2hv
c3RfcmVnaXN0ZXIoJmRzaS0+aG9zdCk7CisJaWYgKHJldCA8IDApIHsKKwkJZGV2X2VycihkZXYs
ICJmYWlsZWQgdG8gcmVnaXN0ZXIgRFNJIGhvc3Q6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0
OworCX0KIAogCXJldCA9IGRybV9vZl9maW5kX3BhbmVsX29yX2JyaWRnZShkZXYtPm9mX25vZGUs
IDAsIDAsCiAJCQkJCSAgJmRzaS0+cGFuZWwsICZkc2ktPmJyaWRnZSk7CiAJaWYgKHJldCkKLQkJ
cmV0dXJuIHJldDsKKwkJZ290byBlcnJfdW5yZWdpc3Rlcl9ob3N0OwogCiAJZHNpLT5lbmdpbmVf
Y2xrID0gZGV2bV9jbGtfZ2V0KGRldiwgImVuZ2luZSIpOwogCWlmIChJU19FUlIoZHNpLT5lbmdp
bmVfY2xrKSkgewogCQlyZXQgPSBQVFJfRVJSKGRzaS0+ZW5naW5lX2Nsayk7CiAJCWRldl9lcnIo
ZGV2LCAiRmFpbGVkIHRvIGdldCBlbmdpbmUgY2xvY2s6ICVkXG4iLCByZXQpOwotCQlyZXR1cm4g
cmV0OworCQlnb3RvIGVycl91bnJlZ2lzdGVyX2hvc3Q7CiAJfQogCiAJZHNpLT5kaWdpdGFsX2Ns
ayA9IGRldm1fY2xrX2dldChkZXYsICJkaWdpdGFsIik7CiAJaWYgKElTX0VSUihkc2ktPmRpZ2l0
YWxfY2xrKSkgewogCQlyZXQgPSBQVFJfRVJSKGRzaS0+ZGlnaXRhbF9jbGspOwogCQlkZXZfZXJy
KGRldiwgIkZhaWxlZCB0byBnZXQgZGlnaXRhbCBjbG9jazogJWRcbiIsIHJldCk7Ci0JCXJldHVy
biByZXQ7CisJCWdvdG8gZXJyX3VucmVnaXN0ZXJfaG9zdDsKIAl9CiAKIAlkc2ktPmhzX2NsayA9
IGRldm1fY2xrX2dldChkZXYsICJocyIpOwogCWlmIChJU19FUlIoZHNpLT5oc19jbGspKSB7CiAJ
CXJldCA9IFBUUl9FUlIoZHNpLT5oc19jbGspOwogCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBn
ZXQgaHMgY2xvY2s6ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OworCQlnb3RvIGVycl91bnJl
Z2lzdGVyX2hvc3Q7CiAJfQogCiAJcmVncyA9IHBsYXRmb3JtX2dldF9yZXNvdXJjZShwZGV2LCBJ
T1JFU09VUkNFX01FTSwgMCk7CkBAIC0xMTMxLDMzICsxMTI3LDM1IEBAIHN0YXRpYyBpbnQgbXRr
X2RzaV9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCWlmIChJU19FUlIoZHNp
LT5yZWdzKSkgewogCQlyZXQgPSBQVFJfRVJSKGRzaS0+cmVncyk7CiAJCWRldl9lcnIoZGV2LCAi
RmFpbGVkIHRvIGlvcmVtYXAgbWVtb3J5OiAlZFxuIiwgcmV0KTsKLQkJcmV0dXJuIHJldDsKKwkJ
Z290byBlcnJfdW5yZWdpc3Rlcl9ob3N0OwogCX0KIAogCWRzaS0+cGh5ID0gZGV2bV9waHlfZ2V0
KGRldiwgImRwaHkiKTsKIAlpZiAoSVNfRVJSKGRzaS0+cGh5KSkgewogCQlyZXQgPSBQVFJfRVJS
KGRzaS0+cGh5KTsKIAkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gZ2V0IE1JUEktRFBIWTogJWRc
biIsIHJldCk7Ci0JCXJldHVybiByZXQ7CisJCWdvdG8gZXJyX3VucmVnaXN0ZXJfaG9zdDsKIAl9
CiAKIAljb21wX2lkID0gbXRrX2RkcF9jb21wX2dldF9pZChkZXYtPm9mX25vZGUsIE1US19EU0kp
OwogCWlmIChjb21wX2lkIDwgMCkgewogCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBpZGVudGlm
eSBieSBhbGlhczogJWRcbiIsIGNvbXBfaWQpOwotCQlyZXR1cm4gY29tcF9pZDsKKwkJcmV0ID0g
Y29tcF9pZDsKKwkJZ290byBlcnJfdW5yZWdpc3Rlcl9ob3N0OwogCX0KIAogCXJldCA9IG10a19k
ZHBfY29tcF9pbml0KGRldiwgZGV2LT5vZl9ub2RlLCAmZHNpLT5kZHBfY29tcCwgY29tcF9pZCwK
IAkJCQkmbXRrX2RzaV9mdW5jcyk7CiAJaWYgKHJldCkgewogCQlkZXZfZXJyKGRldiwgIkZhaWxl
ZCB0byBpbml0aWFsaXplIGNvbXBvbmVudDogJWRcbiIsIHJldCk7Ci0JCXJldHVybiByZXQ7CisJ
CWdvdG8gZXJyX3VucmVnaXN0ZXJfaG9zdDsKIAl9CiAKIAlpcnFfbnVtID0gcGxhdGZvcm1fZ2V0
X2lycShwZGV2LCAwKTsKIAlpZiAoaXJxX251bSA8IDApIHsKLQkJZGV2X2VycigmcGRldi0+ZGV2
LCAiZmFpbGVkIHRvIHJlcXVlc3QgZHNpIGlycSByZXNvdXJjZVxuIik7Ci0JCXJldHVybiAtRVBS
T0JFX0RFRkVSOworCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJmYWlsZWQgdG8gZ2V0IGRzaSBpcnFf
bnVtOiAlZFxuIiwgaXJxX251bSk7CisJCXJldCA9IGlycV9udW07CisJCWdvdG8gZXJyX3VucmVn
aXN0ZXJfaG9zdDsKIAl9CiAKIAlpcnFfc2V0X3N0YXR1c19mbGFncyhpcnFfbnVtLCBJUlFfVFlQ
RV9MRVZFTF9MT1cpOwpAQCAtMTE2NSwxNCArMTE2MywyNCBAQCBzdGF0aWMgaW50IG10a19kc2lf
cHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAkJCSAgICAgICBJUlFGX1RSSUdH
RVJfTE9XLCBkZXZfbmFtZSgmcGRldi0+ZGV2KSwgZHNpKTsKIAlpZiAocmV0KSB7CiAJCWRldl9l
cnIoJnBkZXYtPmRldiwgImZhaWxlZCB0byByZXF1ZXN0IG1lZGlhdGVrIGRzaSBpcnFcbiIpOwot
CQlyZXR1cm4gLUVQUk9CRV9ERUZFUjsKKwkJZ290byBlcnJfdW5yZWdpc3Rlcl9ob3N0OwogCX0K
IAogCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmRzaS0+aXJxX3dhaXRfcXVldWUpOwogCiAJcGxhdGZv
cm1fc2V0X2RydmRhdGEocGRldiwgZHNpKTsKIAotCXJldHVybiBjb21wb25lbnRfYWRkKCZwZGV2
LT5kZXYsICZtdGtfZHNpX2NvbXBvbmVudF9vcHMpOworCXJldCA9IGNvbXBvbmVudF9hZGQoJnBk
ZXYtPmRldiwgJm10a19kc2lfY29tcG9uZW50X29wcyk7CisJaWYgKHJldCkgeworCQlkZXZfZXJy
KCZwZGV2LT5kZXYsICJmYWlsZWQgdG8gYWRkIGNvbXBvbmVudDogJWRcbiIsIHJldCk7CisJCWdv
dG8gZXJyX3VucmVnaXN0ZXJfaG9zdDsKKwl9CisKKwlyZXR1cm4gMDsKKworZXJyX3VucmVnaXN0
ZXJfaG9zdDoKKwltaXBpX2RzaV9ob3N0X3VucmVnaXN0ZXIoJmRzaS0+aG9zdCk7CisJcmV0dXJu
IHJldDsKIH0KIAogc3RhdGljIGludCBtdGtfZHNpX3JlbW92ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZGV2KQpAQCAtMTE4MSw2ICsxMTg5LDcgQEAgc3RhdGljIGludCBtdGtfZHNpX3JlbW92
ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCiAJbXRrX291dHB1dF9kc2lfZGlzYWJs
ZShkc2kpOwogCWNvbXBvbmVudF9kZWwoJnBkZXYtPmRldiwgJm10a19kc2lfY29tcG9uZW50X29w
cyk7CisJbWlwaV9kc2lfaG9zdF91bnJlZ2lzdGVyKCZkc2ktPmhvc3QpOwogCiAJcmV0dXJuIDA7
CiB9Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbA==
