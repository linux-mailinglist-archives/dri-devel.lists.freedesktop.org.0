Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B299E845B3
	for <lists+dri-devel@lfdr.de>; Wed,  7 Aug 2019 09:26:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 95B936E61D;
	Wed,  7 Aug 2019 07:26:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DA4346E57A
 for <dri-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 23:16:17 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id w17so5816771qto.10
 for <dri-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 16:16:17 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=dzzOeMTojFZzc4SDmpKjinKIrvNC9sVRWsnQeUnBSlc=;
 b=C5+RfHoLINhWUZvtcFvH7X5aygclIG6hRX+qb+X+5+Tmh9A236MlUe63U0qfcCcg4N
 XmdDjyEg23H22ist7StrFi6oQSikoNxVpfH3H8O5/a4iDd/z6E/dAXljocxIs9flVr6K
 InPErGPWd6vvZe/zXdHq4OyOylI4JsUXvS2gt6+DIRU/0WfwZdU7QGR3Vn//AGuuicxw
 UJfH6YRh7yeyA5Pq4dnrGwL69ya+HVO1NBau1SFdiWrUO03lTRui6rDR+jM4TfCRQc/1
 2WrRwSXb3YHJ6YJ9rpVb8tdqVIIeNZ9Zrc3hVQAZkMTjMm5RuBMaoZdQvV0Bu0igJEFB
 TGBw==
X-Gm-Message-State: APjAAAWcrzerJQCJVkzSlE+yBXpls677nkARe8f9ck5qNFeftkYaTQXG
 54UA5ghEzT9zFzu+kNaYqtf/Eg==
X-Google-Smtp-Source: APXvYqzZwoBudgHBaayJbkJ+GNCYTi4q4UlbCBCz8/DGe/Mgsz0vD7Z3MTdLgeaTsGPYtDKzYwIczQ==
X-Received: by 2002:a0c:9932:: with SMTP id h47mr5359549qvd.147.1565133376933; 
 Tue, 06 Aug 2019 16:16:16 -0700 (PDT)
Received: from ziepe.ca
 (hlfxns017vw-156-34-55-100.dhcp-dynamic.fibreop.ns.bellaliant.net.
 [156.34.55.100])
 by smtp.gmail.com with ESMTPSA id p23sm39124569qke.44.2019.08.06.16.16.14
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 06 Aug 2019 16:16:14 -0700 (PDT)
Received: from jgg by mlx.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1hv8gg-0006eg-7x; Tue, 06 Aug 2019 20:16:14 -0300
From: Jason Gunthorpe <jgg@ziepe.ca>
To: linux-mm@kvack.org
Subject: [PATCH v3 hmm 05/11] hmm: use mmu_notifier_get/put for 'struct hmm'
Date: Tue,  6 Aug 2019 20:15:42 -0300
Message-Id: <20190806231548.25242-6-jgg@ziepe.ca>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190806231548.25242-1-jgg@ziepe.ca>
References: <20190806231548.25242-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 07 Aug 2019 07:26:18 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=dzzOeMTojFZzc4SDmpKjinKIrvNC9sVRWsnQeUnBSlc=;
 b=iT2jZ5QEHCnRmwj3Fy7Flix3yuM6JMZfZlMd66YumfXZFQGPbYnOuPrN2Nfkw15MlA
 AIO8aK6lBmEInROdH9Of3/332lc2HB5S42qr/W/2UIUKnnEndBMdeXDMUMGuGmW1p/5X
 2V9fSmgrxz5r4ozB8rfrhYVEEKHdIhsoNUQQsTCfq9bfSXzc1vCmzCjIC9mqI2MdlycL
 losCEg5d1lwwYehJqUjfY/pnKpJgJIYYu7a4Y2tCpde7gotzr2SCMXURkOCZhZ1LHzu9
 LGt3R9vq4t3nIrE8fpnUEuW7OeTfeGz53wQSaHM3MZcXljasEHmfZblbVGzG8efyMB8t
 WlBg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrea Arcangeli <aarcange@redhat.com>,
 Ralph Campbell <rcampbell@nvidia.com>, Dimitri Sivanich <sivanich@sgi.com>,
 Gavin Shan <shangw@linux.vnet.ibm.com>, Andrea Righi <andrea@betterlinux.com>,
 linux-rdma@vger.kernel.org, John Hubbard <jhubbard@nvidia.com>, "Kuehling,
 Felix" <Felix.Kuehling@amd.com>, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 iommu@lists.linux-foundation.org, amd-gfx@lists.freedesktop.org,
 Jason Gunthorpe <jgg@mellanox.com>, Alex Deucher <alexander.deucher@amd.com>,
 intel-gfx@lists.freedesktop.org, Christoph Hellwig <hch@lst.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhpcyBpcyBhIHNpZ25p
ZmljYW50IHNpbXBsaWZpY2F0aW9uLCBpdCBlbGltaW5hdGVzIGFsbCB0aGUgcmVtYWluaW5nCido
bW0nIHN0dWZmIGluIG1tX3N0cnVjdCwgZWxpbWluYXRlcyBrcmVmaW5nIGFsb25nIHRoZSBjcml0
aWNhbCBub3RpZmllcgpwYXRocywgYW5kIHRha2VzIGF3YXkgYWxsIHRoZSB1Z2x5IGxvY2tpbmcg
YW5kIGFidXNlIG9mIHBhZ2VfdGFibGVfbG9jay4KCm1tdV9ub3RpZmllcl9nZXQoKSBwcm92aWRl
cyB0aGUgc2luZ2xlIHN0cnVjdCBobW0gcGVyIHN0cnVjdCBtbSB3aGljaAplbGltaW5hdGVzIG1t
LT5obW0uCgpJdCBhbHNvIGRpcmVjdGx5IGd1YXJhbnRlZXMgdGhhdCBubyBtbXVfbm90aWZpZXIg
b3AgY2FsbGJhY2sgaXMgY2FsbGFibGUKd2hpbGUgY29uY3VycmVudCBmcmVlIGlzIHBvc3NpYmxl
LCB0aGlzIGVsaW1pbmF0ZXMgYWxsIHRoZSBrcmVmcyBpbnNpZGUKdGhlIG1tdV9ub3RpZmllciBj
YWxsYmFja3MuCgpUaGUgcmVtYWluaW5nIGtyZWZzIGluIHRoZSByYW5nZSBjb2RlIHdlcmUgb3Zl
cmx5IGNhdXRpb3VzLCBkcml2ZXJzIGFyZQphbHJlYWR5IG5vdCBwZXJtaXR0ZWQgdG8gZnJlZSB0
aGUgbWlycm9yIHdoaWxlIGEgcmFuZ2UgZXhpc3RzLgoKU2lnbmVkLW9mZi1ieTogSmFzb24gR3Vu
dGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9kcnYuYyB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Ry
bS5jICAgfCAgIDMgKwogaW5jbHVkZS9saW51eC9obW0uaCAgICAgICAgICAgICAgICAgICAgIHwg
IDEyICstLQogaW5jbHVkZS9saW51eC9tbV90eXBlcy5oICAgICAgICAgICAgICAgIHwgICA2IC0t
CiBrZXJuZWwvZm9yay5jICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDEgLQogbW0vaG1t
LmMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgMTIxICsrKysrKy0tLS0tLS0tLS0t
LS0tLS0tLQogNiBmaWxlcyBjaGFuZ2VkLCAzMyBpbnNlcnRpb25zKCspLCAxMTEgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCmluZGV4IGYyZThiNDIz
OGVmZDQ5Li5kNTA3NzRhNWY5OGVmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9kcnYuYwpAQCAtMTQ2NCw2ICsxNDY0LDcgQEAgc3RhdGljIHZvaWQgX19leGl0IGFtZGdwdV9l
eGl0KHZvaWQpCiAJYW1kZ3B1X3VucmVnaXN0ZXJfYXRweF9oYW5kbGVyKCk7CiAJYW1kZ3B1X3N5
bmNfZmluaSgpOwogCWFtZGdwdV9mZW5jZV9zbGFiX2ZpbmkoKTsKKwltbXVfbm90aWZpZXJfc3lu
Y2hyb25pemUoKTsKIH0KIAogbW9kdWxlX2luaXQoYW1kZ3B1X2luaXQpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9u
b3V2ZWF1L25vdXZlYXVfZHJtLmMKaW5kZXggN2MyZmNhYmE0MmQ2YzMuLmEwZTQ4YTQ4MjQ1MmQ3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2RybS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJtLmMKQEAgLTI4LDYgKzI4LDcgQEAK
ICNpbmNsdWRlIDxsaW51eC9wY2kuaD4KICNpbmNsdWRlIDxsaW51eC9wbV9ydW50aW1lLmg+CiAj
aW5jbHVkZSA8bGludXgvdmdhX3N3aXRjaGVyb28uaD4KKyNpbmNsdWRlIDxsaW51eC9tbXVfbm90
aWZpZXIuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1QLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRj
X2hlbHBlci5oPgpAQCAtMTI5Miw2ICsxMjkzLDggQEAgbm91dmVhdV9kcm1fZXhpdCh2b2lkKQog
I2lmZGVmIENPTkZJR19OT1VWRUFVX1BMQVRGT1JNX0RSSVZFUgogCXBsYXRmb3JtX2RyaXZlcl91
bnJlZ2lzdGVyKCZub3V2ZWF1X3BsYXRmb3JtX2RyaXZlcik7CiAjZW5kaWYKKwlpZiAoSVNfRU5B
QkxFRChDT05GSUdfRFJNX05PVVZFQVVfU1ZNKSkKKwkJbW11X25vdGlmaWVyX3N5bmNocm9uaXpl
KCk7CiB9CiAKIG1vZHVsZV9pbml0KG5vdXZlYXVfZHJtX2luaXQpOwpkaWZmIC0tZ2l0IGEvaW5j
bHVkZS9saW51eC9obW0uaCBiL2luY2x1ZGUvbGludXgvaG1tLmgKaW5kZXggODIyNjUxMThkOTRh
YmQuLmMzOTAyNDQ5ZGI2NDEyIDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2htbS5oCisrKyBi
L2luY2x1ZGUvbGludXgvaG1tLmgKQEAgLTg0LDE1ICs4NCwxMiBAQAogICogQG5vdGlmaWVyczog
Y291bnQgb2YgYWN0aXZlIG1tdSBub3RpZmllcnMKICAqLwogc3RydWN0IGhtbSB7Ci0Jc3RydWN0
IG1tX3N0cnVjdAkqbW07Ci0Jc3RydWN0IGtyZWYJCWtyZWY7CisJc3RydWN0IG1tdV9ub3RpZmll
cgltbXVfbm90aWZpZXI7CiAJc3BpbmxvY2tfdAkJcmFuZ2VzX2xvY2s7CiAJc3RydWN0IGxpc3Rf
aGVhZAlyYW5nZXM7CiAJc3RydWN0IGxpc3RfaGVhZAltaXJyb3JzOwotCXN0cnVjdCBtbXVfbm90
aWZpZXIJbW11X25vdGlmaWVyOwogCXN0cnVjdCByd19zZW1hcGhvcmUJbWlycm9yc19zZW07CiAJ
d2FpdF9xdWV1ZV9oZWFkX3QJd3E7Ci0Jc3RydWN0IHJjdV9oZWFkCQlyY3U7CiAJbG9uZwkJCW5v
dGlmaWVyczsKIH07CiAKQEAgLTQzNiwxMyArNDMzLDYgQEAgbG9uZyBobW1fcmFuZ2VfZG1hX3Vu
bWFwKHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLAogICovCiAjZGVmaW5lIEhNTV9SQU5HRV9ERUZB
VUxUX1RJTUVPVVQgMTAwMAogCi0vKiBCZWxvdyBhcmUgZm9yIEhNTSBpbnRlcm5hbCB1c2Ugb25s
eSEgTm90IHRvIGJlIHVzZWQgYnkgZGV2aWNlIGRyaXZlciEgKi8KLXN0YXRpYyBpbmxpbmUgdm9p
ZCBobW1fbW1faW5pdChzdHJ1Y3QgbW1fc3RydWN0ICptbSkKLXsKLQltbS0+aG1tID0gTlVMTDsK
LX0KLSNlbHNlIC8qIElTX0VOQUJMRUQoQ09ORklHX0hNTV9NSVJST1IpICovCi1zdGF0aWMgaW5s
aW5lIHZvaWQgaG1tX21tX2luaXQoc3RydWN0IG1tX3N0cnVjdCAqbW0pIHt9CiAjZW5kaWYgLyog
SVNfRU5BQkxFRChDT05GSUdfSE1NX01JUlJPUikgKi8KIAogI2VuZGlmIC8qIExJTlVYX0hNTV9I
ICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21tX3R5cGVzLmggYi9pbmNsdWRlL2xpbnV4
L21tX3R5cGVzLmgKaW5kZXggM2EzN2E4OWViN2E3YzMuLjUyNWQyNWQ5MzMzMGYyIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2xpbnV4L21tX3R5cGVzLmgKKysrIGIvaW5jbHVkZS9saW51eC9tbV90eXBl
cy5oCkBAIC0yNSw3ICsyNSw2IEBACiAKIHN0cnVjdCBhZGRyZXNzX3NwYWNlOwogc3RydWN0IG1l
bV9jZ3JvdXA7Ci1zdHJ1Y3QgaG1tOwogCiAvKgogICogRWFjaCBwaHlzaWNhbCBwYWdlIGluIHRo
ZSBzeXN0ZW0gaGFzIGEgc3RydWN0IHBhZ2UgYXNzb2NpYXRlZCB3aXRoCkBAIC01MDIsMTEgKzUw
MSw2IEBAIHN0cnVjdCBtbV9zdHJ1Y3QgewogCQlhdG9taWNfbG9uZ190IGh1Z2V0bGJfdXNhZ2U7
CiAjZW5kaWYKIAkJc3RydWN0IHdvcmtfc3RydWN0IGFzeW5jX3B1dF93b3JrOwotCi0jaWZkZWYg
Q09ORklHX0hNTV9NSVJST1IKLQkJLyogSE1NIG5lZWRzIHRvIHRyYWNrIGEgZmV3IHRoaW5ncyBw
ZXIgbW0gKi8KLQkJc3RydWN0IGhtbSAqaG1tOwotI2VuZGlmCiAJfSBfX3JhbmRvbWl6ZV9sYXlv
dXQ7CiAKIAkvKgpkaWZmIC0tZ2l0IGEva2VybmVsL2ZvcmsuYyBiL2tlcm5lbC9mb3JrLmMKaW5k
ZXggZDhhZTBmMWI0MTQ4MDIuLmJkNGEwNzYyZjEyZjNlIDEwMDY0NAotLS0gYS9rZXJuZWwvZm9y
ay5jCisrKyBiL2tlcm5lbC9mb3JrLmMKQEAgLTEwMDcsNyArMTAwNyw2IEBAIHN0YXRpYyBzdHJ1
Y3QgbW1fc3RydWN0ICptbV9pbml0KHN0cnVjdCBtbV9zdHJ1Y3QgKm1tLCBzdHJ1Y3QgdGFza19z
dHJ1Y3QgKnAsCiAJbW1faW5pdF9vd25lcihtbSwgcCk7CiAJUkNVX0lOSVRfUE9JTlRFUihtbS0+
ZXhlX2ZpbGUsIE5VTEwpOwogCW1tdV9ub3RpZmllcl9tbV9pbml0KG1tKTsKLQlobW1fbW1faW5p
dChtbSk7CiAJaW5pdF90bGJfZmx1c2hfcGVuZGluZyhtbSk7CiAjaWYgZGVmaW5lZChDT05GSUdf
VFJBTlNQQVJFTlRfSFVHRVBBR0UpICYmICFVU0VfU1BMSVRfUE1EX1BUTE9DS1MKIAltbS0+cG1k
X2h1Z2VfcHRlID0gTlVMTDsKZGlmZiAtLWdpdCBhL21tL2htbS5jIGIvbW0vaG1tLmMKaW5kZXgg
OWE5MDg5MDJlNGNjMzguLjAwZjk0Zjk0OTA2YWZjIDEwMDY0NAotLS0gYS9tbS9obW0uYworKysg
Yi9tbS9obW0uYwpAQCAtMjYsMTAxICsyNiwzNyBAQAogI2luY2x1ZGUgPGxpbnV4L21tdV9ub3Rp
Zmllci5oPgogI2luY2x1ZGUgPGxpbnV4L21lbW9yeV9ob3RwbHVnLmg+CiAKLXN0YXRpYyBjb25z
dCBzdHJ1Y3QgbW11X25vdGlmaWVyX29wcyBobW1fbW11X25vdGlmaWVyX29wczsKLQotLyoqCi0g
KiBobW1fZ2V0X29yX2NyZWF0ZSAtIHJlZ2lzdGVyIEhNTSBhZ2FpbnN0IGFuIG1tIChITU0gaW50
ZXJuYWwpCi0gKgotICogQG1tOiBtbSBzdHJ1Y3QgdG8gYXR0YWNoIHRvCi0gKiBSZXR1cm46IGFu
IEhNTSBvYmplY3QsIGVpdGhlciBieSByZWZlcmVuY2luZyB0aGUgZXhpc3RpbmcKLSAqICAgICAg
ICAgIChwZXItcHJvY2Vzcykgb2JqZWN0LCBvciBieSBjcmVhdGluZyBhIG5ldyBvbmUuCi0gKgot
ICogVGhpcyBpcyBub3QgaW50ZW5kZWQgdG8gYmUgdXNlZCBkaXJlY3RseSBieSBkZXZpY2UgZHJp
dmVycy4gSWYgbW0gYWxyZWFkeQotICogaGFzIGFuIEhNTSBzdHJ1Y3QgdGhlbiBpdCBnZXQgYSBy
ZWZlcmVuY2Ugb24gaXQgYW5kIHJldHVybnMgaXQuIE90aGVyd2lzZQotICogaXQgYWxsb2NhdGVz
IGFuIEhNTSBzdHJ1Y3QsIGluaXRpYWxpemVzIGl0LCBhc3NvY2lhdGUgaXQgd2l0aCB0aGUgbW0g
YW5kCi0gKiByZXR1cm5zIGl0LgotICovCi1zdGF0aWMgc3RydWN0IGhtbSAqaG1tX2dldF9vcl9j
cmVhdGUoc3RydWN0IG1tX3N0cnVjdCAqbW0pCitzdGF0aWMgc3RydWN0IG1tdV9ub3RpZmllciAq
aG1tX2FsbG9jX25vdGlmaWVyKHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKQogewogCXN0cnVjdCBobW0g
KmhtbTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGRfd3JpdGUoJm1tLT5tbWFwX3NlbSk7Ci0KLQkv
KiBBYnVzZSB0aGUgcGFnZV90YWJsZV9sb2NrIHRvIGFsc28gcHJvdGVjdCBtbS0+aG1tLiAqLwot
CXNwaW5fbG9jaygmbW0tPnBhZ2VfdGFibGVfbG9jayk7Ci0JaG1tID0gbW0tPmhtbTsKLQlpZiAo
bW0tPmhtbSAmJiBrcmVmX2dldF91bmxlc3NfemVybygmbW0tPmhtbS0+a3JlZikpCi0JCWdvdG8g
b3V0X3VubG9jazsKLQlzcGluX3VubG9jaygmbW0tPnBhZ2VfdGFibGVfbG9jayk7Ci0KLQlobW0g
PSBrbWFsbG9jKHNpemVvZigqaG1tKSwgR0ZQX0tFUk5FTCk7CisJaG1tID0ga3phbGxvYyhzaXpl
b2YoKmhtbSksIEdGUF9LRVJORUwpOwogCWlmICghaG1tKQotCQlyZXR1cm4gTlVMTDsKKwkJcmV0
dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKIAlpbml0X3dhaXRxdWV1ZV9oZWFkKCZobW0tPndxKTsK
IAlJTklUX0xJU1RfSEVBRCgmaG1tLT5taXJyb3JzKTsKIAlpbml0X3J3c2VtKCZobW0tPm1pcnJv
cnNfc2VtKTsKLQlobW0tPm1tdV9ub3RpZmllci5vcHMgPSBOVUxMOwogCUlOSVRfTElTVF9IRUFE
KCZobW0tPnJhbmdlcyk7CiAJc3Bpbl9sb2NrX2luaXQoJmhtbS0+cmFuZ2VzX2xvY2spOwotCWty
ZWZfaW5pdCgmaG1tLT5rcmVmKTsKIAlobW0tPm5vdGlmaWVycyA9IDA7Ci0JaG1tLT5tbSA9IG1t
OwotCi0JaG1tLT5tbXVfbm90aWZpZXIub3BzID0gJmhtbV9tbXVfbm90aWZpZXJfb3BzOwotCWlm
IChfX21tdV9ub3RpZmllcl9yZWdpc3RlcigmaG1tLT5tbXVfbm90aWZpZXIsIG1tKSkgewotCQlr
ZnJlZShobW0pOwotCQlyZXR1cm4gTlVMTDsKLQl9Ci0KLQltbWdyYWIoaG1tLT5tbSk7Ci0KLQkv
KgotCSAqIFdlIGhvbGQgdGhlIGV4Y2x1c2l2ZSBtbWFwX3NlbSBoZXJlIHNvIHdlIGtub3cgdGhh
dCBtbS0+aG1tIGlzCi0JICogc3RpbGwgTlVMTCBvciAwIGtyZWYsIGFuZCBpcyBzYWZlIHRvIHVw
ZGF0ZS4KLQkgKi8KLQlzcGluX2xvY2soJm1tLT5wYWdlX3RhYmxlX2xvY2spOwotCW1tLT5obW0g
PSBobW07Ci0KLW91dF91bmxvY2s6Ci0Jc3Bpbl91bmxvY2soJm1tLT5wYWdlX3RhYmxlX2xvY2sp
OwotCXJldHVybiBobW07CisJcmV0dXJuICZobW0tPm1tdV9ub3RpZmllcjsKIH0KIAotc3RhdGlj
IHZvaWQgaG1tX2ZyZWVfcmN1KHN0cnVjdCByY3VfaGVhZCAqcmN1KQorc3RhdGljIHZvaWQgaG1t
X2ZyZWVfbm90aWZpZXIoc3RydWN0IG1tdV9ub3RpZmllciAqbW4pCiB7Ci0Jc3RydWN0IGhtbSAq
aG1tID0gY29udGFpbmVyX29mKHJjdSwgc3RydWN0IGhtbSwgcmN1KTsKKwlzdHJ1Y3QgaG1tICpo
bW0gPSBjb250YWluZXJfb2YobW4sIHN0cnVjdCBobW0sIG1tdV9ub3RpZmllcik7CiAKLQltbWRy
b3AoaG1tLT5tbSk7CisJV0FSTl9PTighbGlzdF9lbXB0eSgmaG1tLT5yYW5nZXMpKTsKKwlXQVJO
X09OKCFsaXN0X2VtcHR5KCZobW0tPm1pcnJvcnMpKTsKIAlrZnJlZShobW0pOwogfQogCi1zdGF0
aWMgdm9pZCBobW1fZnJlZShzdHJ1Y3Qga3JlZiAqa3JlZikKLXsKLQlzdHJ1Y3QgaG1tICpobW0g
PSBjb250YWluZXJfb2Yoa3JlZiwgc3RydWN0IGhtbSwga3JlZik7Ci0KLQlzcGluX2xvY2soJmht
bS0+bW0tPnBhZ2VfdGFibGVfbG9jayk7Ci0JaWYgKGhtbS0+bW0tPmhtbSA9PSBobW0pCi0JCWht
bS0+bW0tPmhtbSA9IE5VTEw7Ci0Jc3Bpbl91bmxvY2soJmhtbS0+bW0tPnBhZ2VfdGFibGVfbG9j
ayk7Ci0KLQltbXVfbm90aWZpZXJfdW5yZWdpc3Rlcl9ub19yZWxlYXNlKCZobW0tPm1tdV9ub3Rp
ZmllciwgaG1tLT5tbSk7Ci0JbW11X25vdGlmaWVyX2NhbGxfc3JjdSgmaG1tLT5yY3UsIGhtbV9m
cmVlX3JjdSk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdm9pZCBobW1fcHV0KHN0cnVjdCBobW0gKmht
bSkKLXsKLQlrcmVmX3B1dCgmaG1tLT5rcmVmLCBobW1fZnJlZSk7Ci19Ci0KIHN0YXRpYyB2b2lk
IGhtbV9yZWxlYXNlKHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uLCBzdHJ1Y3QgbW1fc3RydWN0ICpt
bSkKIHsKIAlzdHJ1Y3QgaG1tICpobW0gPSBjb250YWluZXJfb2YobW4sIHN0cnVjdCBobW0sIG1t
dV9ub3RpZmllcik7CiAJc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvcjsKIAotCS8qIEJhaWwgb3V0
IGlmIGhtbSBpcyBpbiB0aGUgcHJvY2VzcyBvZiBiZWluZyBmcmVlZCAqLwotCWlmICgha3JlZl9n
ZXRfdW5sZXNzX3plcm8oJmhtbS0+a3JlZikpCi0JCXJldHVybjsKLQogCS8qCiAJICogU2luY2Ug
aG1tX3JhbmdlX3JlZ2lzdGVyKCkgaG9sZHMgdGhlIG1tZ2V0KCkgbG9jayBobW1fcmVsZWFzZSgp
IGlzCiAJICogcHJldmVudGVkIGFzIGxvbmcgYXMgYSByYW5nZSBleGlzdHMuCkBAIC0xMzcsOCAr
NzMsNiBAQCBzdGF0aWMgdm9pZCBobW1fcmVsZWFzZShzdHJ1Y3QgbW11X25vdGlmaWVyICptbiwg
c3RydWN0IG1tX3N0cnVjdCAqbW0pCiAJCQltaXJyb3ItPm9wcy0+cmVsZWFzZShtaXJyb3IpOwog
CX0KIAl1cF9yZWFkKCZobW0tPm1pcnJvcnNfc2VtKTsKLQotCWhtbV9wdXQoaG1tKTsKIH0KIAog
c3RhdGljIHZvaWQgbm90aWZpZXJzX2RlY3JlbWVudChzdHJ1Y3QgaG1tICpobW0pCkBAIC0xNjks
OSArMTAzLDYgQEAgc3RhdGljIGludCBobW1faW52YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3Qg
bW11X25vdGlmaWVyICptbiwKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCWludCByZXQgPSAwOwog
Ci0JaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmaG1tLT5rcmVmKSkKLQkJcmV0dXJuIDA7Ci0K
IAlzcGluX2xvY2tfaXJxc2F2ZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwogCWhtbS0+bm90
aWZpZXJzKys7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeShyYW5nZSwgJmhtbS0+cmFuZ2VzLCBsaXN0
KSB7CkBAIC0yMDYsNyArMTM3LDYgQEAgc3RhdGljIGludCBobW1faW52YWxpZGF0ZV9yYW5nZV9z
dGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICptbiwKIG91dDoKIAlpZiAocmV0KQogCQlub3RpZmll
cnNfZGVjcmVtZW50KGhtbSk7Ci0JaG1tX3B1dChobW0pOwogCXJldHVybiByZXQ7CiB9CiAKQEAg
LTIxNSwxNyArMTQ1LDE1IEBAIHN0YXRpYyB2b2lkIGhtbV9pbnZhbGlkYXRlX3JhbmdlX2VuZChz
dHJ1Y3QgbW11X25vdGlmaWVyICptbiwKIHsKIAlzdHJ1Y3QgaG1tICpobW0gPSBjb250YWluZXJf
b2YobW4sIHN0cnVjdCBobW0sIG1tdV9ub3RpZmllcik7CiAKLQlpZiAoIWtyZWZfZ2V0X3VubGVz
c196ZXJvKCZobW0tPmtyZWYpKQotCQlyZXR1cm47Ci0KIAlub3RpZmllcnNfZGVjcmVtZW50KGht
bSk7Ci0JaG1tX3B1dChobW0pOwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IG1tdV9ub3RpZmll
cl9vcHMgaG1tX21tdV9ub3RpZmllcl9vcHMgPSB7CiAJLnJlbGVhc2UJCT0gaG1tX3JlbGVhc2Us
CiAJLmludmFsaWRhdGVfcmFuZ2Vfc3RhcnQJPSBobW1faW52YWxpZGF0ZV9yYW5nZV9zdGFydCwK
IAkuaW52YWxpZGF0ZV9yYW5nZV9lbmQJPSBobW1faW52YWxpZGF0ZV9yYW5nZV9lbmQsCisJLmFs
bG9jX25vdGlmaWVyCQk9IGhtbV9hbGxvY19ub3RpZmllciwKKwkuZnJlZV9ub3RpZmllcgkJPSBo
bW1fZnJlZV9ub3RpZmllciwKIH07CiAKIC8qCkBAIC0yMzcsMTggKzE2NSwyNyBAQCBzdGF0aWMg
Y29uc3Qgc3RydWN0IG1tdV9ub3RpZmllcl9vcHMgaG1tX21tdV9ub3RpZmllcl9vcHMgPSB7CiAg
KgogICogVG8gc3RhcnQgbWlycm9yaW5nIGEgcHJvY2VzcyBhZGRyZXNzIHNwYWNlLCB0aGUgZGV2
aWNlIGRyaXZlciBtdXN0IHJlZ2lzdGVyCiAgKiBhbiBITU0gbWlycm9yIHN0cnVjdC4KKyAqCisg
KiBUaGUgY2FsbGVyIGNhbm5vdCB1bnJlZ2lzdGVyIHRoZSBobW1fbWlycm9yIHdoaWxlIGFueSBy
YW5nZXMgYXJlCisgKiByZWdpc3RlcmVkLgorICoKKyAqIENhbGxlcnMgdXNpbmcgdGhpcyBmdW5j
dGlvbiBtdXN0IHB1dCBhIGNhbGwgdG8gbW11X25vdGlmaWVyX3N5bmNocm9uaXplKCkKKyAqIGlu
IHRoZWlyIG1vZHVsZSBleGl0IGZ1bmN0aW9ucy4KICAqLwogaW50IGhtbV9taXJyb3JfcmVnaXN0
ZXIoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwgc3RydWN0IG1tX3N0cnVjdCAqbW0pCiB7CisJ
c3RydWN0IG1tdV9ub3RpZmllciAqbW47CisKIAlsb2NrZGVwX2Fzc2VydF9oZWxkX3dyaXRlKCZt
bS0+bW1hcF9zZW0pOwogCiAJLyogU2FuaXR5IGNoZWNrICovCiAJaWYgKCFtbSB8fCAhbWlycm9y
IHx8ICFtaXJyb3ItPm9wcykKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQltaXJyb3ItPmhtbSA9IGht
bV9nZXRfb3JfY3JlYXRlKG1tKTsKLQlpZiAoIW1pcnJvci0+aG1tKQotCQlyZXR1cm4gLUVOT01F
TTsKKwltbiA9IG1tdV9ub3RpZmllcl9nZXRfbG9ja2VkKCZobW1fbW11X25vdGlmaWVyX29wcywg
bW0pOworCWlmIChJU19FUlIobW4pKQorCQlyZXR1cm4gUFRSX0VSUihtbik7CisJbWlycm9yLT5o
bW0gPSBjb250YWluZXJfb2YobW4sIHN0cnVjdCBobW0sIG1tdV9ub3RpZmllcik7CiAKIAlkb3du
X3dyaXRlKCZtaXJyb3ItPmhtbS0+bWlycm9yc19zZW0pOwogCWxpc3RfYWRkKCZtaXJyb3ItPmxp
c3QsICZtaXJyb3ItPmhtbS0+bWlycm9ycyk7CkBAIC0yNzIsNyArMjA5LDcgQEAgdm9pZCBobW1f
bWlycm9yX3VucmVnaXN0ZXIoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvcikKIAlkb3duX3dyaXRl
KCZobW0tPm1pcnJvcnNfc2VtKTsKIAlsaXN0X2RlbCgmbWlycm9yLT5saXN0KTsKIAl1cF93cml0
ZSgmaG1tLT5taXJyb3JzX3NlbSk7Ci0JaG1tX3B1dChobW0pOworCW1tdV9ub3RpZmllcl9wdXQo
JmhtbS0+bW11X25vdGlmaWVyKTsKIH0KIEVYUE9SVF9TWU1CT0woaG1tX21pcnJvcl91bnJlZ2lz
dGVyKTsKIApAQCAtODgwLDE0ICs4MTcsMTMgQEAgaW50IGhtbV9yYW5nZV9yZWdpc3RlcihzdHJ1
Y3QgaG1tX3JhbmdlICpyYW5nZSwKIAlyYW5nZS0+ZW5kID0gZW5kOwogCiAJLyogUHJldmVudCBo
bW1fcmVsZWFzZSgpIGZyb20gcnVubmluZyB3aGlsZSB0aGUgcmFuZ2UgaXMgdmFsaWQgKi8KLQlp
ZiAoIW1tZ2V0X25vdF96ZXJvKGhtbS0+bW0pKQorCWlmICghbW1nZXRfbm90X3plcm8oaG1tLT5t
bXVfbm90aWZpZXIubW0pKQogCQlyZXR1cm4gLUVGQVVMVDsKIAogCS8qIEluaXRpYWxpemUgcmFu
Z2UgdG8gdHJhY2sgQ1BVIHBhZ2UgdGFibGUgdXBkYXRlcy4gKi8KIAlzcGluX2xvY2tfaXJxc2F2
ZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwogCiAJcmFuZ2UtPmhtbSA9IGhtbTsKLQlrcmVm
X2dldCgmaG1tLT5rcmVmKTsKIAlsaXN0X2FkZCgmcmFuZ2UtPmxpc3QsICZobW0tPnJhbmdlcyk7
CiAKIAkvKgpAQCAtOTE5LDggKzg1NSw3IEBAIHZvaWQgaG1tX3JhbmdlX3VucmVnaXN0ZXIoc3Ry
dWN0IGhtbV9yYW5nZSAqcmFuZ2UpCiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaG1tLT5yYW5n
ZXNfbG9jaywgZmxhZ3MpOwogCiAJLyogRHJvcCByZWZlcmVuY2UgdGFrZW4gYnkgaG1tX3Jhbmdl
X3JlZ2lzdGVyKCkgKi8KLQltbXB1dChobW0tPm1tKTsKLQlobW1fcHV0KGhtbSk7CisJbW1wdXQo
aG1tLT5tbXVfbm90aWZpZXIubW0pOwogCiAJLyoKIAkgKiBUaGUgcmFuZ2UgaXMgbm93IGludmFs
aWQgYW5kIHRoZSByZWYgb24gdGhlIGhtbSBpcyBkcm9wcGVkLCBzbwpAQCAtOTcwLDE0ICs5MDUs
MTQgQEAgbG9uZyBobW1fcmFuZ2VfZmF1bHQoc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2UsIHVuc2ln
bmVkIGludCBmbGFncykKIAlzdHJ1Y3QgbW1fd2FsayBtbV93YWxrOwogCWludCByZXQ7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZobW0tPm1tLT5tbWFwX3NlbSk7CisJbG9ja2RlcF9hc3NlcnRf
aGVsZCgmaG1tLT5tbXVfbm90aWZpZXIubW0tPm1tYXBfc2VtKTsKIAogCWRvIHsKIAkJLyogSWYg
cmFuZ2UgaXMgbm8gbG9uZ2VyIHZhbGlkIGZvcmNlIHJldHJ5LiAqLwogCQlpZiAoIXJhbmdlLT52
YWxpZCkKIAkJCXJldHVybiAtRUJVU1k7CiAKLQkJdm1hID0gZmluZF92bWEoaG1tLT5tbSwgc3Rh
cnQpOworCQl2bWEgPSBmaW5kX3ZtYShobW0tPm1tdV9ub3RpZmllci5tbSwgc3RhcnQpOwogCQlp
ZiAodm1hID09IE5VTEwgfHwgKHZtYS0+dm1fZmxhZ3MgJiBkZXZpY2Vfdm1hKSkKIAkJCXJldHVy
biAtRUZBVUxUOwogCi0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
