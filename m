Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7EFD5AE6CC
	for <lists+dri-devel@lfdr.de>; Tue, 10 Sep 2019 11:24:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 780AE6E87B;
	Tue, 10 Sep 2019 09:24:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5E06D6E874;
 Tue, 10 Sep 2019 09:24:35 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id k6so6492032wrn.11;
 Tue, 10 Sep 2019 02:24:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=A0+nCTV72wNl46l7WxfZ3oJgQOJctcTq/28MN5JY3GQ=;
 b=tDbifmzx+SXeETKoON96Q3gM8Q20I496qxlENpgUD8l18vNv1p2wrWADgI7zM4xtJB
 rSvfF3JTvevdLPNHsBJlwdysGbF82y6ZoFc630gxAlsEsoKPM/f+g9i3pmGusdEty5aM
 /jKh7TVceg1tYcaFTM6/Mtu2zapmlE3YzUlXd08ZU8zGkRhoSTjM+sfPNHJQCB89WSQH
 l6br1Y2Gu6w7+kN4gSb/WqwJ84m3SCSw7avTLOaFCbsEBXd5C+PkF/zNAtEaWdk5yUU7
 /+h4O03jIwnGyrUNdXiuyAgeQR4udQ8tmJqlvyy5M1Do0TpHM8+tpYamflHC6DNCtj+l
 QSFQ==
X-Gm-Message-State: APjAAAVU4vJNgtlItYpfYV9KUyjZaravp7Xv1aYYLZhZ7KanlytTzihu
 jG3rigbOZyb74hMV9rdBLAmjPSM3
X-Google-Smtp-Source: APXvYqxuKlpuVnq1bTFeR2TxklBTZO7aA9C2EY/hbXtZMttnBzLT9bWqMu9qwyW0bAoixlqnncw2DQ==
X-Received: by 2002:adf:ffc6:: with SMTP id x6mr26394782wrs.346.1568107473578; 
 Tue, 10 Sep 2019 02:24:33 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:1cd:7d57:6942:ab1b])
 by smtp.gmail.com with ESMTPSA id e12sm6107036wrw.37.2019.09.10.02.24.32
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 10 Sep 2019 02:24:33 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH 2/9] drm/amdgpu: split the VM entity into direct and delayed
Date: Tue, 10 Sep 2019 11:24:24 +0200
Message-Id: <20190910092431.37471-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190910092431.37471-1-christian.koenig@amd.com>
References: <20190910092431.37471-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=A0+nCTV72wNl46l7WxfZ3oJgQOJctcTq/28MN5JY3GQ=;
 b=CcW2MJ2DdkOSwMHT7wjtcTo6HOLhiiWWJ1SNUAhYC8kMJIqB56BlRzTTbhTysyymNl
 vfMoCQR8WvVEfwwKQFpFkba2uaqX2HdoN+VSXxqxhFK5ae528Qn2B7Vpj6aOLCvw4PPu
 ZgA2evREKEbTkxXVCeF9Z7hXnWKD3RsQA61wJzfta+i8l/7/S8xYM98l0dJqC1C3oUMq
 r+WQqziP++8aFQkqE28/9pibRX+871L14YtSDxcmDE17oy/zSQvzEAmZtyg0Ltcwtrjs
 ZdiThuJFW8CNVSzsceTUoijn6E4OokXKRm4vuUl8n7F3LlOZ1l/w+Tn5+KJwK8mzCM/W
 2Vjw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Rm9yIHBhZ2UgZmF1bHQgaGFuZGxpbmcgd2UgbmVlZCB0byB1c2UgYSBkaXJlY3QgdXBkYXRlIHdo
aWNoIGNhbid0IGJlCmJsb2NrZWQgYnkgb25nb2luZyB1c2VyIENTLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgpSZXZpZXdlZC1ieTog
RmVsaXggS3VlaGxpbmcgPEZlbGl4Lkt1ZWhsaW5nQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2lkcy5jICAgICB8ICA2ICsrKy0tLQogZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgICAgICB8IDIxICsrKysrKysrKysrKysrKy0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmggICAgICB8ICA1ICsrKy0t
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jIHwgIDUgKysrLS0K
IDQgZmlsZXMgY2hhbmdlZCwgMjQgaW5zZXJ0aW9ucygrKSwgMTMgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2lkcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2lkcy5jCmluZGV4IGNkMTU1NDBjNTYyMi4uZGZl
MTU1NTY2NTcxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
aWRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2lkcy5jCkBAIC0y
ODIsNyArMjgyLDcgQEAgc3RhdGljIGludCBhbWRncHVfdm1pZF9ncmFiX3Jlc2VydmVkKHN0cnVj
dCBhbWRncHVfdm0gKnZtLAogCSAgICAhZG1hX2ZlbmNlX2lzX2xhdGVyKHVwZGF0ZXMsICgqaWQp
LT5mbHVzaGVkX3VwZGF0ZXMpKQogCSAgICB1cGRhdGVzID0gTlVMTDsKIAotCWlmICgoKmlkKS0+
b3duZXIgIT0gdm0tPmVudGl0eS5mZW5jZV9jb250ZXh0IHx8CisJaWYgKCgqaWQpLT5vd25lciAh
PSB2bS0+ZGlyZWN0LmZlbmNlX2NvbnRleHQgfHwKIAkgICAgam9iLT52bV9wZF9hZGRyICE9ICgq
aWQpLT5wZF9ncHVfYWRkciB8fAogCSAgICB1cGRhdGVzIHx8ICEoKmlkKS0+bGFzdF9mbHVzaCB8
fAogCSAgICAoKCppZCktPmxhc3RfZmx1c2gtPmNvbnRleHQgIT0gZmVuY2VfY29udGV4dCAmJgpA
QCAtMzQ5LDcgKzM0OSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtaWRfZ3JhYl91c2VkKHN0cnVj
dCBhbWRncHVfdm0gKnZtLAogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmbHVzaGVkOwogCiAJCS8qIENo
ZWNrIGFsbCB0aGUgcHJlcmVxdWlzaXRlcyB0byB1c2luZyB0aGlzIFZNSUQgKi8KLQkJaWYgKCgq
aWQpLT5vd25lciAhPSB2bS0+ZW50aXR5LmZlbmNlX2NvbnRleHQpCisJCWlmICgoKmlkKS0+b3du
ZXIgIT0gdm0tPmRpcmVjdC5mZW5jZV9jb250ZXh0KQogCQkJY29udGludWU7CiAKIAkJaWYgKCgq
aWQpLT5wZF9ncHVfYWRkciAhPSBqb2ItPnZtX3BkX2FkZHIpCkBAIC00NDksNyArNDQ5LDcgQEAg
aW50IGFtZGdwdV92bWlkX2dyYWIoc3RydWN0IGFtZGdwdV92bSAqdm0sIHN0cnVjdCBhbWRncHVf
cmluZyAqcmluZywKIAl9CiAKIAlpZC0+cGRfZ3B1X2FkZHIgPSBqb2ItPnZtX3BkX2FkZHI7Ci0J
aWQtPm93bmVyID0gdm0tPmVudGl0eS5mZW5jZV9jb250ZXh0OworCWlkLT5vd25lciA9IHZtLT5k
aXJlY3QuZmVuY2VfY29udGV4dDsKIAogCWlmIChqb2ItPnZtX25lZWRzX2ZsdXNoKSB7CiAJCWRt
YV9mZW5jZV9wdXQoaWQtPmxhc3RfZmx1c2gpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdm0uYwppbmRleCBlMTE3NjQxNjRjYmYuLjhhOWJhNjZjODM4MyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKQEAgLTI2NzAsMTIgKzI2NzAsMTcgQEAgaW50IGFtZGdw
dV92bV9pbml0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCBzdHJ1Y3QgYW1kZ3B1X3ZtICp2
bSwKIAlzcGluX2xvY2tfaW5pdCgmdm0tPmludmFsaWRhdGVkX2xvY2spOwogCUlOSVRfTElTVF9I
RUFEKCZ2bS0+ZnJlZWQpOwogCi0JLyogY3JlYXRlIHNjaGVkdWxlciBlbnRpdHkgZm9yIHBhZ2Ug
dGFibGUgdXBkYXRlcyAqLwotCXIgPSBkcm1fc2NoZWRfZW50aXR5X2luaXQoJnZtLT5lbnRpdHks
IGFkZXYtPnZtX21hbmFnZXIudm1fcHRlX3JxcywKKwkvKiBjcmVhdGUgc2NoZWR1bGVyIGVudGl0
aWVzIGZvciBwYWdlIHRhYmxlIHVwZGF0ZXMgKi8KKwlyID0gZHJtX3NjaGVkX2VudGl0eV9pbml0
KCZ2bS0+ZGlyZWN0LCBhZGV2LT52bV9tYW5hZ2VyLnZtX3B0ZV9ycXMsCiAJCQkJICBhZGV2LT52
bV9tYW5hZ2VyLnZtX3B0ZV9udW1fcnFzLCBOVUxMKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAK
KwlyID0gZHJtX3NjaGVkX2VudGl0eV9pbml0KCZ2bS0+ZGVsYXllZCwgYWRldi0+dm1fbWFuYWdl
ci52bV9wdGVfcnFzLAorCQkJCSAgYWRldi0+dm1fbWFuYWdlci52bV9wdGVfbnVtX3JxcywgTlVM
TCk7CisJaWYgKHIpCisJCWdvdG8gZXJyb3JfZnJlZV9kaXJlY3Q7CisKIAl2bS0+cHRlX3N1cHBv
cnRfYXRzID0gZmFsc2U7CiAKIAlpZiAodm1fY29udGV4dCA9PSBBTURHUFVfVk1fQ09OVEVYVF9D
T01QVVRFKSB7CkBAIC0yNzA0LDcgKzI3MDksNyBAQCBpbnQgYW1kZ3B1X3ZtX2luaXQoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCQlicC5mbGFncyAm
PSB+QU1ER1BVX0dFTV9DUkVBVEVfU0hBRE9XOwogCXIgPSBhbWRncHVfYm9fY3JlYXRlKGFkZXYs
ICZicCwgJnJvb3QpOwogCWlmIChyKQotCQlnb3RvIGVycm9yX2ZyZWVfc2NoZWRfZW50aXR5Owor
CQlnb3RvIGVycm9yX2ZyZWVfZGVsYXllZDsKIAogCXIgPSBhbWRncHVfYm9fcmVzZXJ2ZShyb290
LCB0cnVlKTsKIAlpZiAocikKQEAgLTI3NDcsOCArMjc1MiwxMSBAQCBpbnQgYW1kZ3B1X3ZtX2lu
aXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCWFt
ZGdwdV9ib191bnJlZigmdm0tPnJvb3QuYmFzZS5ibyk7CiAJdm0tPnJvb3QuYmFzZS5ibyA9IE5V
TEw7CiAKLWVycm9yX2ZyZWVfc2NoZWRfZW50aXR5OgotCWRybV9zY2hlZF9lbnRpdHlfZGVzdHJv
eSgmdm0tPmVudGl0eSk7CitlcnJvcl9mcmVlX2RlbGF5ZWQ6CisJZHJtX3NjaGVkX2VudGl0eV9k
ZXN0cm95KCZ2bS0+ZGVsYXllZCk7CisKK2Vycm9yX2ZyZWVfZGlyZWN0OgorCWRybV9zY2hlZF9l
bnRpdHlfZGVzdHJveSgmdm0tPmRpcmVjdCk7CiAKIAlyZXR1cm4gcjsKIH0KQEAgLTI5MzcsNyAr
Mjk0NSw4IEBAIHZvaWQgYW1kZ3B1X3ZtX2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYs
IHN0cnVjdCBhbWRncHVfdm0gKnZtKQogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZhZGV2LT52
bV9tYW5hZ2VyLnBhc2lkX2xvY2ssIGZsYWdzKTsKIAl9CiAKLQlkcm1fc2NoZWRfZW50aXR5X2Rl
c3Ryb3koJnZtLT5lbnRpdHkpOworCWRybV9zY2hlZF9lbnRpdHlfZGVzdHJveSgmdm0tPmRpcmVj
dCk7CisJZHJtX3NjaGVkX2VudGl0eV9kZXN0cm95KCZ2bS0+ZGVsYXllZCk7CiAKIAlpZiAoIVJC
X0VNUFRZX1JPT1QoJnZtLT52YS5yYl9yb290KSkgewogCQlkZXZfZXJyKGFkZXYtPmRldiwgInN0
aWxsIGFjdGl2ZSBibyBpbnNpZGUgdm1cbiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdm0uaAppbmRleCAzMzUyYTg3YjgyMmUuLjcxMzg3MjJlZTU1ZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmgKQEAgLTI1Nyw4ICsyNTcsOSBAQCBzdHJ1Y3QgYW1kZ3B1
X3ZtIHsKIAlzdHJ1Y3QgYW1kZ3B1X3ZtX3B0ICAgICByb290OwogCXN0cnVjdCBkbWFfZmVuY2UJ
Kmxhc3RfdXBkYXRlOwogCi0JLyogU2NoZWR1bGVyIGVudGl0eSBmb3IgcGFnZSB0YWJsZSB1cGRh
dGVzICovCi0Jc3RydWN0IGRybV9zY2hlZF9lbnRpdHkJZW50aXR5OworCS8qIFNjaGVkdWxlciBl
bnRpdGllcyBmb3IgcGFnZSB0YWJsZSB1cGRhdGVzICovCisJc3RydWN0IGRybV9zY2hlZF9lbnRp
dHkJZGlyZWN0OworCXN0cnVjdCBkcm1fc2NoZWRfZW50aXR5CWRlbGF5ZWQ7CiAKIAl1bnNpZ25l
ZCBpbnQJCXBhc2lkOwogCS8qIGRlZGljYXRlZCB0byB2bSAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMKaW5kZXggZGRkMTgxZjVlZDM3Li5kMDg3ZDY2NTBk
NzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1h
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYwpAQCAt
OTksMTIgKzk5LDEzIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZtX3NkbWFfY29tbWl0KHN0cnVjdCBh
bWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcCwKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpmOwogCWludCBy
OwogCi0JcmluZyA9IGNvbnRhaW5lcl9vZihwLT52bS0+ZW50aXR5LnJxLT5zY2hlZCwgc3RydWN0
IGFtZGdwdV9yaW5nLCBzY2hlZCk7CisJcmluZyA9IGNvbnRhaW5lcl9vZihwLT52bS0+ZGVsYXll
ZC5ycS0+c2NoZWQsIHN0cnVjdCBhbWRncHVfcmluZywKKwkJCSAgICBzY2hlZCk7CiAKIAlXQVJO
X09OKGliLT5sZW5ndGhfZHcgPT0gMCk7CiAJYW1kZ3B1X3JpbmdfcGFkX2liKHJpbmcsIGliKTsK
IAlXQVJOX09OKGliLT5sZW5ndGhfZHcgPiBwLT5udW1fZHdfbGVmdCk7Ci0JciA9IGFtZGdwdV9q
b2Jfc3VibWl0KHAtPmpvYiwgJnAtPnZtLT5lbnRpdHksCisJciA9IGFtZGdwdV9qb2Jfc3VibWl0
KHAtPmpvYiwgJnAtPnZtLT5kZWxheWVkLAogCQkJICAgICAgQU1ER1BVX0ZFTkNFX09XTkVSX1ZN
LCAmZik7CiAJaWYgKHIpCiAJCWdvdG8gZXJyb3I7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
