Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 63CDE2A74D2
	for <lists+dri-devel@lfdr.de>; Thu,  5 Nov 2020 02:16:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1F7476E976;
	Thu,  5 Nov 2020 01:16:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D636A6E976
 for <dri-devel@lists.freedesktop.org>; Thu,  5 Nov 2020 01:16:12 +0000 (UTC)
IronPort-SDR: lVWJy1NJmuAYMR8UXj58CaXi8txbg/4Uf8IfOoHldV36QwXMnuLIcLNu/uf9Iz7YqO9f3P5H00
 yHEub/FzYD/Q==
X-IronPort-AV: E=McAfee;i="6000,8403,9795"; a="187180170"
X-IronPort-AV: E=Sophos;i="5.77,451,1596524400"; d="scan'208";a="187180170"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Nov 2020 17:16:00 -0800
IronPort-SDR: kr9wRUlRJsDPkAP8Bk7YLV6RQo3967ekRfZJSbJQ7LxpC8v0y89VCYxz2mQBunZfItXyItD6Ur
 zoj6tKf3OsEw==
X-IronPort-AV: E=Sophos;i="5.77,451,1596524400"; d="scan'208";a="471445677"
Received: from pschung-mobl.amr.corp.intel.com (HELO
 achrisan-DESK2.amr.corp.intel.com) ([10.255.72.205])
 by orsmga004-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-SHA;
 04 Nov 2020 17:16:00 -0800
From: Anitha Chrisanthus <anitha.chrisanthus@intel.com>
To: dri-devel@lists.freedesktop.org,
	anitha.chrisanthus@intel.com
Subject: [PATCH v13 5/7] drm/kmb: Add support for KeemBay Display
Date: Wed,  4 Nov 2020 17:15:29 -0800
Message-Id: <1604538931-26726-6-git-send-email-anitha.chrisanthus@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1604538931-26726-1-git-send-email-anitha.chrisanthus@intel.com>
References: <1604538931-26726-1-git-send-email-anitha.chrisanthus@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: edmund.j.dea@intel.com, sam@ravnborg.org, narmstrong@baylibre.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBhIGJhc2ljIEtNUyBhdG9taWMgbW9kZXNldHRpbmcgZGlzcGxheSBkcml2ZXIgZm9y
IEtlZW1CYXkgZmFtaWx5IG9mClNPQ3MuIERyaXZlciBoYXMgbm8gMkQgb3IgM0QgZ3JhcGhpY3Mu
IEl0IGNhbGxzIGludG8gdGhlIEFEViBicmlkZ2UKZHJpdmVyIGF0IHRoZSBjb25uZWN0b3IgbGV2
ZWwuCgpTaW5nbGUgQ1JUQyB3aXRoIExDRCBjb250cm9sbGVyLT5taXBpIERTSS0+QURWIGJyaWRn
ZQoKT25seSAxMDgwcCByZXNvbHV0aW9uIGFuZCBzaW5nbGUgcGxhbmUgaXMgc3VwcG9ydGVkIGF0
IHRoaXMgdGltZS4KCnYyOiBtb3ZlZCBleHRlcm4gdG8gLmgsIHJlbW92ZWQgbGljZW5zZSB0ZXh0
CiAgICB1c2UgZHJtX2Rldl9pbml0LCB1cGNsYXNzZWQgZGV2X3ByaXZhdGUsIHJlbW92ZWQgSEFW
RV9JUlEuKFNhbSkKCnYzOiBTcXVhc2hlZCBhbGwgNTkgY29tbWl0cyB0byBvbmUKCnY0OiByZXZp
ZXcgY2hhbmdlcyBmcm9tIFNhbSBSYXZuYm9yZwoJcmVuYW1lZCBkZXZfcCB0byBrbWIKCW1vdmVk
IGNsb2NrcyB1bmRlciBrbWJfY2xvY2ssIGNvbnNvbGlkYXRlZCBjbGsgaW5pdGlhbGl6YXRpb25z
Cgl1c2UgZHJtbSBmdW5jdGlvbnMKCXVzZSBEUk1fR0VNX0NNQV9EUklWRVJfT1BTX1ZNQVAKCnY1
OiBjb3JyZWN0ZWQgc3BlbGxpbmdzCnY2OiBjb3JyZWN0ZWQgY2hlY2twYXRjaCB3YXJuaW5ncwp2
NzogcmV2aWV3IGNoYW5nZXMgU2FtIFJhdm5ib3JnIGFuZCBUaG9tYXMgWmltbWVybWFuCglyZW1v
dmVkIGttYl9jcnRjLmgga21iX2NydGNfY2xlYW51cCAoVGhvbWFzKQoJcmVuYW1lZCBtb2RlX3Nl
dCwga21iX2xvYWQsIGlubGluZWQgdW5sb2FkIChUaG9tYXMpCgltb3ZlZCByZW1haW5pbmcgbG9n
Z2luZyB0byBkcm1fKihUaG9tYXMpCglyZS1vcmdlZCBkcml2ZXIgaW5pdGlhbGl6YXRpb24gKFRo
b21hcykKCW1vdmVkIHBsYW5lX3N0YXR1cyB0byBkcm1fcHJpdmF0ZSAoU2FtKQoJcmVtb3ZlZCB1
bm5lY2Vzc2FyeSBsb2dzIGFuZCBkZWZpbmVzIGFuZCBpZmRlZiBjb2RlcyAoU2FtKQoJY2FsbCBo
ZWxwZXJfY2hlY2sgaW4gcGxhbmVfYXRvbWljX2NoZWNrIChTYW0pCglyZW5hbWVkIHNldCB0byBn
ZXQgZm9yIGJwcCBhbmQgZm9ybWF0IGZ1bmN0aW9ucyhTYW0pCgl1c2UgZHJtIGhlbHBlciBmdW5j
dGlvbnMgZm9yIHJlc2V0LCBkdXBsaWNhdGUvZGVzdHJveSBzdGF0ZSBpbnN0ZWFkCglvZiBrbWIg
ZnVuY3Rpb25zIChTYW0pCglyZW1vdmVkIGttYl9wcml2IGZyb20ga21iX3BsYW5lIGFuZCByZW1v
dmVkIGttYl9wbGFuZV9zdGF0ZSAoU2FtKQp2ODogZ2V0IGNsa19wbGwwIGZyb20gZGlzcGxheSBu
b2RlIGluIGR0CnY5OiBtb3ZlZCBjc2NfY29lZl9sY2QgdG8gcGxhbmUuYyAoRGFuaWVsIFZldHRl
cikKICAgIGNhbGwgZHJtX2F0b21pY19oZWxwZXJfc2h1dGRvd24gaW4gcmVtb3ZlIChEYW5pZWwg
VikKICAgIHVzZSBkcm1fY3J0Y19oYW5kbGVfdmJsYW5rIChEYW5pZWwgVikKICAgIHJlbmFtZWQg
a21iX2RzaV9od19pbml0IHRvIGttYl9kc2lfbW9kZV9zZXQgKERhbmllbCBWKQogICAgY29tcGxp
bWVudGFyeSBjaGFuZ2VzIHRvIGRldmljZSB0cmVlIGNoYW5nZXMgKFJvYikKdjEwOiBjYWxsIGRy
bV9jcnRjX2FybV92YmxhbmtfZXZlbnQgaW4gYXRvbWljX2ZsdXNoIChEYW5pZWwgVikKICAgICBt
b3ZlZCBnbG9iYWwgdmFycyB0byBrbWJfcHJpdmF0ZSBhbmQgYWRkZWQgbG9ja3MgKERhbmllbCBW
KQogICAgIGNoYW5nZXMgaW4gZHJpdmVyIHRvIGFjY29tbW9kYXRlIGNoYW5nZXMgaW4gRFQgdG8g
c2VwYXJhdGUgRFNJCiAgICAgZW50cmllcyAoU2FtIFIpCiAgICAgcmV2aWV3IGNoYW5nZXMgdG8g
c2VwYXJhdGUgbWlwaSBEU0kgKFNhbSBSKQp2MTE6IHJldmlldyBjaGFuZ2VzIHRvIHNlcGFyYXRl
IG1zc2NhbSAoTmVpbCBBLFNhbSBSKQp2MTI6IGZpeGVkIHdhcm5pbmdzIFJlcG9ydGVkLWJ5OiBr
ZXJuZWwgdGVzdCByb2JvdCA8bGtwQGludGVsLmNvbT4KClNpZ25lZC1vZmYtYnk6IEFuaXRoYSBD
aHJpc2FudGh1cyA8YW5pdGhhLmNocmlzYW50aHVzQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFNh
bSBSYXZuYm9yZyA8c2FtQHJhdm5ib3JnLm9yZz4KQ2M6IFNhbSBSYXZuYm9yZyA8c2FtQHJhdm5i
b3JnLm9yZz4KQ2M6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgpDYzog
RGFuaWVsIFZldHRlciA8ZGFuaWVsQGZmd2xsLmNoPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9rbWIv
a21iX2NydGMuYyAgfCAyMTQgKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9rbWIva21i
X2Rydi5jICAgfCA2MDIgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwog
ZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfZHJ2LmggICB8ICA4OCArKysrKysKIGRyaXZlcnMvZ3B1
L2RybS9rbWIva21iX3BsYW5lLmMgfCA0OTAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysKIGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmggfCAgOTkgKysrKysrKwogNSBmaWxl
cyBjaGFuZ2VkLCAxNDkzIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0va21iL2ttYl9jcnRjLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0va21iL2ttYl9kcnYuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9rbWIv
a21iX2Rydi5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfcGxh
bmUuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmgK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9jcnRjLmMgYi9kcml2ZXJzL2dw
dS9kcm0va21iL2ttYl9jcnRjLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4u
ZGQ1NGIwMwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2NydGMu
YwpAQCAtMCwwICsxLDIxNCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAt
b25seQorLyoKKyAqIENvcHlyaWdodCDCqSAyMDE4LTIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAq
LworCisjaW5jbHVkZSA8bGludXgvY2xrLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5o
PgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1f
Y3J0Yy5oPgorI2luY2x1ZGUgPGRybS9kcm1fY3J0Y19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX21vZGVzZXRfaGVscGVyX3Z0YWJsZXMuaD4KKworI2luY2x1ZGUgImttYl9kcnYuaCIKKyNp
bmNsdWRlICJrbWJfZHNpLmgiCisjaW5jbHVkZSAia21iX3BsYW5lLmgiCisjaW5jbHVkZSAia21i
X3JlZ3MuaCIKKworc3RydWN0IGttYl9jcnRjX3RpbWluZyB7CisJdTMyIHZmcm9udF9wb3JjaDsK
Kwl1MzIgdmJhY2tfcG9yY2g7CisJdTMyIHZzeW5jX2xlbjsKKwl1MzIgaGZyb250X3BvcmNoOwor
CXUzMiBoYmFja19wb3JjaDsKKwl1MzIgaHN5bmNfbGVuOworfTsKKworc3RhdGljIGludCBrbWJf
Y3J0Y19lbmFibGVfdmJsYW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2OworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9
IHRvX2ttYihkZXYpOworCisJLyogQ2xlYXIgaW50ZXJydXB0ICovCisJa21iX3dyaXRlX2xjZChr
bWIsIExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfVkVSVF9DT01QKTsKKwkvKiBTZXQgd2hpY2ggaW50
ZXJ2YWwgdG8gZ2VuZXJhdGUgdmVydGljYWwgaW50ZXJydXB0ICovCisJa21iX3dyaXRlX2xjZChr
bWIsIExDRF9WU1RBVFVTX0NPTVBBUkUsCisJCSAgICAgIExDRF9WU1RBVFVTX0NPTVBBUkVfVlNZ
TkMpOworCS8qIEVuYWJsZSB2ZXJ0aWNhbCBpbnRlcnJ1cHQgKi8KKwlrbWJfc2V0X2JpdG1hc2tf
bGNkKGttYiwgTENEX0lOVF9FTkFCTEUsCisJCQkgICAgTENEX0lOVF9WRVJUX0NPTVApOworCXJl
dHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrbWJfY3J0Y19kaXNhYmxlX3ZibGFuayhzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsK
KwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCS8qIENsZWFy
IGludGVycnVwdCAqLworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5U
X1ZFUlRfQ09NUCk7CisJLyogRGlzYWJsZSB2ZXJ0aWNhbCBpbnRlcnJ1cHQgKi8KKwlrbWJfY2xy
X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9FTkFCTEUsCisJCQkgICAgTENEX0lOVF9WRVJUX0NP
TVApOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGttYl9jcnRjX2Z1
bmNzID0geworCS5kZXN0cm95ID0gZHJtX2NydGNfY2xlYW51cCwKKwkuc2V0X2NvbmZpZyA9IGRy
bV9hdG9taWNfaGVscGVyX3NldF9jb25maWcsCisJLnBhZ2VfZmxpcCA9IGRybV9hdG9taWNfaGVs
cGVyX3BhZ2VfZmxpcCwKKwkucmVzZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0LAor
CS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kdXBsaWNh
dGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0
Y19kZXN0cm95X3N0YXRlLAorCS5lbmFibGVfdmJsYW5rID0ga21iX2NydGNfZW5hYmxlX3ZibGFu
aywKKwkuZGlzYWJsZV92YmxhbmsgPSBrbWJfY3J0Y19kaXNhYmxlX3ZibGFuaywKK307CisKK3N0
YXRpYyB2b2lkIGttYl9jcnRjX3NldF9tb2RlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2OworCXN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICptID0gJmNydGMtPnN0YXRlLT5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBrbWJfY3J0Y190
aW1pbmcgdm07CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRldik7CisJ
dW5zaWduZWQgaW50IHZhbCA9IDA7CisKKwkvKiBJbml0aWFsaXplIG1pcGkgKi8KKwlrbWJfZHNp
X21vZGVfc2V0KGttYi0+a21iX2RzaSwgbSwga21iLT5zeXNfY2xrX21oeik7CisJZHJtX2luZm8o
ZGV2LAorCQkgInZmcD0gJWQgdmJwPSAlZCB2c3ljX2xlbj0lZCBoZnA9JWQgaGJwPSVkIGhzeW5j
X2xlbj0lZFxuIiwKKwkJIG0tPmNydGNfdnN5bmNfc3RhcnQgLSBtLT5jcnRjX3ZkaXNwbGF5LAor
CQkgbS0+Y3J0Y192dG90YWwgLSBtLT5jcnRjX3ZzeW5jX2VuZCwKKwkJIG0tPmNydGNfdnN5bmNf
ZW5kIC0gbS0+Y3J0Y192c3luY19zdGFydCwKKwkJIG0tPmNydGNfaHN5bmNfc3RhcnQgLSBtLT5j
cnRjX2hkaXNwbGF5LAorCQkgbS0+Y3J0Y19odG90YWwgLSBtLT5jcnRjX2hzeW5jX2VuZCwKKwkJ
IG0tPmNydGNfaHN5bmNfZW5kIC0gbS0+Y3J0Y19oc3luY19zdGFydCk7CisJdmFsID0ga21iX3Jl
YWRfbGNkKGttYiwgTENEX0lOVF9FTkFCTEUpOworCWttYl9jbHJfYml0bWFza19sY2Qoa21iLCBM
Q0RfSU5UX0VOQUJMRSwgdmFsKTsKKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9D
TEVBUiwgfjB4MCk7CisJdm0udmZyb250X3BvcmNoID0gMjsKKwl2bS52YmFja19wb3JjaCA9IDI7
CisJdm0udnN5bmNfbGVuID0gODsKKwl2bS5oZnJvbnRfcG9yY2ggPSAwOworCXZtLmhiYWNrX3Bv
cmNoID0gMDsKKwl2bS5oc3luY19sZW4gPSAyODsKKworCWRybV9kYmcoZGV2LCAiJXMgOiAlZGFj
dGl2ZSBoZWlnaHQ9ICVkIHZicD0lZCB2ZnA9JWQgdnN5bmMtdz0lZCBoLWFjdGl2ZT0lZCBoLWJw
PSVkIGgtZnA9JWQgaHlzbmMtbD0lZCIsCisJCV9fZnVuY19fLCBfX0xJTkVfXywKKwkJCW0tPmNy
dGNfdmRpc3BsYXksIHZtLnZiYWNrX3BvcmNoLCB2bS52ZnJvbnRfcG9yY2gsCisJCQl2bS52c3lu
Y19sZW4sIG0tPmNydGNfaGRpc3BsYXksIHZtLmhiYWNrX3BvcmNoLAorCQkJdm0uaGZyb250X3Bv
cmNoLCB2bS5oc3luY19sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVl9BQ1RJVkVIRUlH
SFQsCisJCSAgICAgIG0tPmNydGNfdmRpc3BsYXkgLSAxKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwg
TENEX1ZfQkFDS1BPUkNILCB2bS52YmFja19wb3JjaCk7CisJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9WX0ZST05UUE9SQ0gsIHZtLnZmcm9udF9wb3JjaCk7CisJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9WU1lOQ19XSURUSCwgdm0udnN5bmNfbGVuIC0gMSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9IX0FDVElWRVdJRFRILAorCQkgICAgICBtLT5jcnRjX2hkaXNwbGF5IC0gMSk7CisJa21iX3dy
aXRlX2xjZChrbWIsIExDRF9IX0JBQ0tQT1JDSCwgdm0uaGJhY2tfcG9yY2gpOworCWttYl93cml0
ZV9sY2Qoa21iLCBMQ0RfSF9GUk9OVFBPUkNILCB2bS5oZnJvbnRfcG9yY2gpOworCWttYl93cml0
ZV9sY2Qoa21iLCBMQ0RfSFNZTkNfV0lEVEgsIHZtLmhzeW5jX2xlbiAtIDEpOworCS8qIFRoaXMg
aXMgaGFyZGNvZGVkIGFzIDAgaW4gdGhlIE15cmlhZHggY29kZSAqLworCWttYl93cml0ZV9sY2Qo
a21iLCBMQ0RfVlNZTkNfU1RBUlQsIDApOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVlNZTkNf
RU5ELCAwKTsKKwkvKiBCYWNrIGdyb3VuZCBjb2xvciAqLworCWttYl93cml0ZV9sY2Qoa21iLCBM
Q0RfQkdfQ09MT1VSX0xTLCAweDQpOworCWlmIChtLT5mbGFncyA9PSBEUk1fTU9ERV9GTEFHX0lO
VEVSTEFDRSkgeworCQlrbWJfd3JpdGVfbGNkKGttYiwKKwkJCSAgICAgIExDRF9WU1lOQ19XSURU
SF9FVkVOLCB2bS52c3luY19sZW4gLSAxKTsKKwkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkgICAg
ICBMQ0RfVl9CQUNLUE9SQ0hfRVZFTiwgdm0udmJhY2tfcG9yY2gpOworCQlrbWJfd3JpdGVfbGNk
KGttYiwKKwkJCSAgICAgIExDRF9WX0ZST05UUE9SQ0hfRVZFTiwgdm0udmZyb250X3BvcmNoKTsK
KwkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9WX0FDVElWRUhFSUdIVF9FVkVOLAorCQkJICAgICAg
bS0+Y3J0Y192ZGlzcGxheSAtIDEpOworCQkvKiBUaGlzIGlzIGhhcmRjb2RlZCBhcyAxMCBpbiB0
aGUgTXlyaWFkeCBjb2RlICovCisJCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVlNZTkNfU1RBUlRf
RVZFTiwgMTApOworCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX1ZTWU5DX0VORF9FVkVOLCAxMCk7
CisJfQorCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVElNSU5HX0dFTl9UUklHLCAxKTsKKwlrbWJf
c2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0NPTlRST0wsIExDRF9DVFJMX0VOQUJMRSk7CisJa21i
X3NldF9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLCB2YWwpOworfQorCitzdGF0aWMg
dm9pZCBrbWJfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkg
ICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGttYl9kcm1fcHJp
dmF0ZSAqa21iID0gY3J0Y190b19rbWJfcHJpdihjcnRjKTsKKworCWNsa19wcmVwYXJlX2VuYWJs
ZShrbWItPmttYl9jbGsuY2xrX2xjZCk7CisJa21iX2NydGNfc2V0X21vZGUoY3J0Yyk7CisJZHJt
X2NydGNfdmJsYW5rX29uKGNydGMpOworfQorCitzdGF0aWMgdm9pZCBrbWJfY3J0Y19hdG9taWNf
ZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJICAgIHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSBjcnRjX3Rv
X2ttYl9wcml2KGNydGMpOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlID0gZHJt
X2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOworCisJLyogZHVlIHRvIGh3
IGxpbWl0YXRpb25zLCBwbGFuZXMgbmVlZCB0byBiZSBvZmYgd2hlbiBjcnRjIGlzIG9mZiAqLwor
CWRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmVzX29uX2NydGMob2xkX3N0YXRlLCBmYWxz
ZSk7CisKKwlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMpOworCWNsa19kaXNhYmxlX3VucHJlcGFy
ZShrbWItPmttYl9jbGsuY2xrX2xjZCk7Cit9CisKK3N0YXRpYyB2b2lkIGttYl9jcnRjX2F0b21p
Y19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlz
dHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCWttYl9jbHJfYml0
bWFza19sY2Qoa21iLCBMQ0RfSU5UX0VOQUJMRSwKKwkJCSAgICBMQ0RfSU5UX1ZFUlRfQ09NUCk7
Cit9CisKK3N0YXRpYyB2b2lkIGttYl9jcnRjX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCisJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpr
bWIgPSB0b19rbWIoZGV2KTsKKworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0VO
QUJMRSwKKwkJCSAgICBMQ0RfSU5UX1ZFUlRfQ09NUCk7CisKKwlzcGluX2xvY2tfaXJxKCZjcnRj
LT5kZXYtPmV2ZW50X2xvY2spOworCWlmIChjcnRjLT5zdGF0ZS0+ZXZlbnQpIHsKKwkJaWYgKGRy
bV9jcnRjX3ZibGFua19nZXQoY3J0YykgPT0gMCkKKwkJCWRybV9jcnRjX2FybV92YmxhbmtfZXZl
bnQoY3J0YywgY3J0Yy0+c3RhdGUtPmV2ZW50KTsKKwkJZWxzZQorCQkJZHJtX2NydGNfc2VuZF92
YmxhbmtfZXZlbnQoY3J0YywgY3J0Yy0+c3RhdGUtPmV2ZW50KTsKKwl9CisJY3J0Yy0+c3RhdGUt
PmV2ZW50ID0gTlVMTDsKKwlzcGluX3VubG9ja19pcnEoJmNydGMtPmRldi0+ZXZlbnRfbG9jayk7
Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfaGVscGVyX2Z1bmNzIGttYl9jcnRj
X2hlbHBlcl9mdW5jcyA9IHsKKwkuYXRvbWljX2JlZ2luID0ga21iX2NydGNfYXRvbWljX2JlZ2lu
LAorCS5hdG9taWNfZW5hYmxlID0ga21iX2NydGNfYXRvbWljX2VuYWJsZSwKKwkuYXRvbWljX2Rp
c2FibGUgPSBrbWJfY3J0Y19hdG9taWNfZGlzYWJsZSwKKwkuYXRvbWljX2ZsdXNoID0ga21iX2Ny
dGNfYXRvbWljX2ZsdXNoLAorfTsKKworaW50IGttYl9zZXR1cF9jcnRjKHN0cnVjdCBkcm1fZGV2
aWNlICpkcm0pCit7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7
CisJc3RydWN0IGttYl9wbGFuZSAqcHJpbWFyeTsKKwlpbnQgcmV0OworCisJcHJpbWFyeSA9IGtt
Yl9wbGFuZV9pbml0KGRybSk7CisJaWYgKElTX0VSUihwcmltYXJ5KSkKKwkJcmV0dXJuIFBUUl9F
UlIocHJpbWFyeSk7CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhfcGxhbmVzKGRybSwgJmtt
Yi0+Y3J0YywgJnByaW1hcnktPmJhc2VfcGxhbmUsCisJCQkJCU5VTEwsICZrbWJfY3J0Y19mdW5j
cywgTlVMTCk7CisJaWYgKHJldCkgeworCQlrbWJfcGxhbmVfZGVzdHJveSgmcHJpbWFyeS0+YmFz
ZV9wbGFuZSk7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJtX2NydGNfaGVscGVyX2FkZCgma21i
LT5jcnRjLCAma21iX2NydGNfaGVscGVyX2Z1bmNzKTsKKwlyZXR1cm4gMDsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2ttYi9r
bWJfZHJ2LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uYTMxYTg0MAotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5jCkBAIC0wLDAgKzEs
NjAyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CisvKgorICog
Q29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRl
IDxsaW51eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51
eC9vZl9ncmFwaC5oPgorI2luY2x1ZGUgPGxpbnV4L29mX3BsYXRmb3JtLmg+CisjaW5jbHVkZSA8
bGludXgvb2ZfcmVzZXJ2ZWRfbWVtLmg+CisjaW5jbHVkZSA8bGludXgvbWZkL3N5c2Nvbi5oPgor
I2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3BtX3J1
bnRpbWUuaD4KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKworI2luY2x1ZGUgPGRybS9kcm1f
YXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9nZW1fY21hX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVmZmVy
X2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1faXJxLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9w
cm9iZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgorCisjaW5jbHVkZSAi
a21iX2Rydi5oIgorI2luY2x1ZGUgImttYl9kc2kuaCIKKyNpbmNsdWRlICJrbWJfcmVncy5oIgor
CitzdGF0aWMgaW50IGttYl9kaXNwbGF5X2Nsa19lbmFibGUoc3RydWN0IGttYl9kcm1fcHJpdmF0
ZSAqa21iKQoreworCWludCByZXQgPSAwOworCisJcmV0ID0gY2xrX3ByZXBhcmVfZW5hYmxlKGtt
Yi0+a21iX2Nsay5jbGtfbGNkKTsKKwlpZiAocmV0KSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAi
RmFpbGVkIHRvIGVuYWJsZSBMQ0QgY2xvY2s6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0Owor
CX0KKwlEUk1fSU5GTygiU1VDQ0VTUyA6IGVuYWJsZWQgTENEIGNsb2Nrc1xuIik7CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQga21iX2luaXRpYWxpemVfY2xvY2tzKHN0cnVjdCBrbWJfZHJt
X3ByaXZhdGUgKmttYiwgc3RydWN0IGRldmljZSAqZGV2KQoreworCWludCByZXQgPSAwOworCXN0
cnVjdCByZWdtYXAgKm1zc2NhbTsKKworCWttYi0+a21iX2Nsay5jbGtfbGNkID0gZGV2bV9jbGtf
Z2V0KGRldiwgImNsa19sY2QiKTsKKwlpZiAoSVNfRVJSKGttYi0+a21iX2Nsay5jbGtfbGNkKSkg
eworCQlkcm1fZXJyKCZrbWItPmRybSwgImNsa19nZXQoKSBmYWlsZWQgY2xrX2xjZFxuIik7CisJ
CXJldHVybiBQVFJfRVJSKGttYi0+a21iX2Nsay5jbGtfbGNkKTsKKwl9CisKKwlrbWItPmttYl9j
bGsuY2xrX3BsbDAgPSBkZXZtX2Nsa19nZXQoZGV2LCAiY2xrX3BsbDAiKTsKKwlpZiAoSVNfRVJS
KGttYi0+a21iX2Nsay5jbGtfcGxsMCkpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJjbGtfZ2V0
KCkgZmFpbGVkIGNsa19wbGwwICIpOworCQlyZXR1cm4gUFRSX0VSUihrbWItPmttYl9jbGsuY2xr
X3BsbDApOworCX0KKwlrbWItPnN5c19jbGtfbWh6ID0gY2xrX2dldF9yYXRlKGttYi0+a21iX2Ns
ay5jbGtfcGxsMCkgLyAxMDAwMDAwOworCWRybV9pbmZvKCZrbWItPmRybSwgInN5c3RlbSBjbGsg
PSAlZCBNaHoiLCBrbWItPnN5c19jbGtfbWh6KTsKKworCXJldCA9ICBrbWJfZHNpX2Nsa19pbml0
KGttYi0+a21iX2RzaSk7CisKKwkvKiBTZXQgTENEIGNsb2NrIHRvIDIwMCBNaHogKi8KKwljbGtf
c2V0X3JhdGUoa21iLT5rbWJfY2xrLmNsa19sY2QsIEtNQl9MQ0RfREVGQVVMVF9DTEspOworCWlm
IChjbGtfZ2V0X3JhdGUoa21iLT5rbWJfY2xrLmNsa19sY2QpICE9IEtNQl9MQ0RfREVGQVVMVF9D
TEspIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJmYWlsZWQgdG8gc2V0IHRvIGNsa19sY2QgdG8g
JWRcbiIsCisJCQlLTUJfTENEX0RFRkFVTFRfQ0xLKTsKKwkJcmV0dXJuIC0xOworCX0KKwlkcm1f
ZGJnKCZrbWItPmRybSwgImNsa19sY2QgPSAlbGRcbiIsIGNsa19nZXRfcmF0ZShrbWItPmttYl9j
bGsuY2xrX2xjZCkpOworCisJcmV0ID0ga21iX2Rpc3BsYXlfY2xrX2VuYWJsZShrbWIpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKKwltc3NjYW0gPSBzeXNjb25fcmVnbWFwX2xvb2t1cF9i
eV9jb21wYXRpYmxlKCJpbnRlbCxrZWVtYmF5LW1zc2NhbSIpOworCWlmIChJU19FUlIobXNzY2Ft
KSkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0byBnZXQgbXNzY2FtIHN5c2NvbiIp
OworCQlyZXR1cm4gLTE7CisJfQorCisJLyogRW5hYmxlIE1TU19DQU1fQ0xLX0NUUkwgZm9yIE1J
UEkgVFggYW5kIExDRCAqLworCXJlZ21hcF91cGRhdGVfYml0cyhtc3NjYW0sIE1TU19DQU1fQ0xL
X0NUUkwsIDB4MWZmZiwgMHgxZmZmKTsKKwlyZWdtYXBfdXBkYXRlX2JpdHMobXNzY2FtLCBNU1Nf
Q0FNX1JTVE5fQ1RSTCwgMHhmZmZmZmZmZiwgMHhmZmZmZmZmZik7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyB2b2lkIGttYl9kaXNwbGF5X2Nsa19kaXNhYmxlKHN0cnVjdCBrbWJfZHJtX3ByaXZh
dGUgKmttYikKK3sKKwljbGtfZGlzYWJsZV91bnByZXBhcmUoa21iLT5rbWJfY2xrLmNsa19sY2Qp
OworfQorCitzdGF0aWMgdm9pZCBfX2lvbWVtICprbWJfbWFwX21taW8oc3RydWN0IGRybV9kZXZp
Y2UgKmRybSwKKwkJCQkgIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCisJCQkJICBjaGFy
ICpuYW1lKQoreworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCXZvaWQgX19pb21lbSAqbWVtOwor
CisJcmVzID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlX2J5bmFtZShwZGV2LCBJT1JFU09VUkNFX01F
TSwgbmFtZSk7CisJaWYgKCFyZXMpIHsKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gZ2V0IHJl
c291cmNlIGZvciAlcyIsIG5hbWUpOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwl9CisJ
bWVtID0gZGV2bV9pb3JlbWFwX3Jlc291cmNlKGRybS0+ZGV2LCByZXMpOworCWlmIChJU19FUlIo
bWVtKSkKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gaW9yZW1hcCAlcyByZWdpc3RlcnMiLCBu
YW1lKTsKKwlyZXR1cm4gbWVtOworfQorCitzdGF0aWMgaW50IGttYl9od19pbml0KHN0cnVjdCBk
cm1fZGV2aWNlICpkcm0sIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCit7CisJc3RydWN0IGttYl9kcm1f
cHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7CisJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRl
diA9IHRvX3BsYXRmb3JtX2RldmljZShkcm0tPmRldik7CisJaW50IGlycV9sY2Q7CisJaW50IHJl
dCA9IDA7CisKKwkvKiBNYXAgTENEIE1NSU8gcmVnaXN0ZXJzICovCisJa21iLT5sY2RfbW1pbyA9
IGttYl9tYXBfbW1pbyhkcm0sIHBkZXYsICJsY2QiKTsKKwlpZiAoSVNfRVJSKGttYi0+bGNkX21t
aW8pKSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVkIHRvIG1hcCBMQ0QgcmVnaXN0ZXJz
XG4iKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJLyogTWFwIE1JUEkgTU1JTyByZWdpc3Rl
cnMgKi8KKwlyZXQgPSBrbWJfZHNpX21hcF9tbWlvKGttYi0+a21iX2RzaSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCS8qIEVuYWJsZSBkaXNwbGF5IGNsb2NrcyAqLworCWttYl9pbml0
aWFsaXplX2Nsb2NrcyhrbWIsICZwZGV2LT5kZXYpOworCisJLyogUmVnaXN0ZXIgaXJxcyBoZXJl
IC0gc2VjdGlvbiAxNy4zIGluIGRhdGFib29rCisJICogbGlzdHMgTENEIGF0IDc5IGFuZCA4MiBm
b3IgTUlQSSB1bmRlciBNU1MgQ1BVIC0KKwkgKiBmaXJtd2FyZSBoYXMgcmVkaXJlY3RlZCA3OSB0
byBBNTMgSVJRIDMzCisJICovCisKKwkvKiBBbGxvY2F0ZSBMQ0QgaW50ZXJydXB0IHJlc291cmNl
cyAqLworCWlycV9sY2QgPSBwbGF0Zm9ybV9nZXRfaXJxKHBkZXYsIDApOworCWlmIChpcnFfbGNk
IDwgMCkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImlycV9sY2Qgbm90IGZvdW5kIik7CisJCWdv
dG8gc2V0dXBfZmFpbDsKKwl9CisKKwkvKiBHZXQgdGhlIG9wdGlvbmFsIGZyYW1lYnVmZmVyIG1l
bW9yeSByZXNvdXJjZSAqLworCXJldCA9IG9mX3Jlc2VydmVkX21lbV9kZXZpY2VfaW5pdChkcm0t
PmRldik7CisJaWYgKHJldCAmJiByZXQgIT0gLUVOT0RFVikKKwkJcmV0dXJuIHJldDsKKworCXNw
aW5fbG9ja19pbml0KCZrbWItPmlycV9sb2NrKTsKKworCWttYi0+aXJxX2xjZCA9IGlycV9sY2Q7
CisKKwlyZXR1cm4gMDsKKworIHNldHVwX2ZhaWw6CisJb2ZfcmVzZXJ2ZWRfbWVtX2RldmljZV9y
ZWxlYXNlKGRybS0+ZGV2KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGttYl9tb2RlX2NvbmZpZ19mdW5jcyA9IHsKKwkuZmJf
Y3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGUsCisJLmF0b21pY19jaGVjayA9IGRybV9hdG9taWNf
aGVscGVyX2NoZWNrLAorCS5hdG9taWNfY29tbWl0ID0gZHJtX2F0b21pY19oZWxwZXJfY29tbWl0
LAorfTsKKworc3RhdGljIGludCBrbWJfc2V0dXBfbW9kZV9jb25maWcoc3RydWN0IGRybV9kZXZp
Y2UgKmRybSkKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9IHRv
X2ttYihkcm0pOworCisJcmV0ID0gZHJtbV9tb2RlX2NvbmZpZ19pbml0KGRybSk7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKwlkcm0tPm1vZGVfY29uZmlnLm1pbl93aWR0aCA9IEtNQl9NSU5f
V0lEVEg7CisJZHJtLT5tb2RlX2NvbmZpZy5taW5faGVpZ2h0ID0gS01CX01JTl9IRUlHSFQ7CisJ
ZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGggPSBLTUJfTUFYX1dJRFRIOworCWRybS0+bW9kZV9j
b25maWcubWF4X2hlaWdodCA9IEtNQl9NQVhfSEVJR0hUOworCWRybS0+bW9kZV9jb25maWcuZnVu
Y3MgPSAma21iX21vZGVfY29uZmlnX2Z1bmNzOworCisJcmV0ID0ga21iX3NldHVwX2NydGMoZHJt
KTsKKwlpZiAocmV0IDwgMCkgeworCQlkcm1fZXJyKGRybSwgImZhaWxlZCB0byBjcmVhdGUgY3J0
Y1xuIik7CisJCXJldHVybiByZXQ7CisJfQorCXJldCA9IGttYl9kc2lfZW5jb2Rlcl9pbml0KGRy
bSwga21iLT5rbWJfZHNpKTsKKwkvKiBTZXQgdGhlIENSVEMncyBwb3J0IHNvIHRoYXQgdGhlIGVu
Y29kZXIgY29tcG9uZW50IGNhbiBmaW5kIGl0ICovCisJa21iLT5jcnRjLnBvcnQgPSBvZl9ncmFw
aF9nZXRfcG9ydF9ieV9pZChkcm0tPmRldi0+b2Zfbm9kZSwgMCk7CisJcmV0ID0gZHJtX3ZibGFu
a19pbml0KGRybSwgZHJtLT5tb2RlX2NvbmZpZy5udW1fY3J0Yyk7CisJaWYgKHJldCA8IDApIHsK
KwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gaW5pdGlhbGl6ZSB2YmxhbmtcbiIpOworCQlwbV9y
dW50aW1lX2Rpc2FibGUoZHJtLT5kZXYpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9tb2Rl
X2NvbmZpZ19yZXNldChkcm0pOworCXJldHVybiAwOworfQorCitzdGF0aWMgaXJxcmV0dXJuX3Qg
aGFuZGxlX2xjZF9pcnEoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwl1bnNpZ25lZCBsb25n
IHN0YXR1cywgdmFsLCB2YWwxOworCWludCBwbGFuZV9pZCwgZG1hMF9zdGF0ZSwgZG1hMV9zdGF0
ZTsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCXN0YXR1
cyA9IGttYl9yZWFkX2xjZChrbWIsIExDRF9JTlRfU1RBVFVTKTsKKworCXNwaW5fbG9jaygma21i
LT5pcnFfbG9jayk7CisJaWYgKHN0YXR1cyAmIExDRF9JTlRfRU9GKSB7CisJCWttYl93cml0ZV9s
Y2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5UX0VPRik7CisKKwkJLyogV2hlbiBkaXNhYmxp
bmcvZW5hYmxpbmcgTENEIGxheWVycywgdGhlIGNoYW5nZSB0YWtlcyBlZmZlY3QKKwkJICogaW1t
ZWRpYXRlbHkgYW5kIGRvZXMgbm90IHdhaXQgZm9yIEVPRiAoZW5kIG9mIGZyYW1lKS4KKwkJICog
V2hlbiBrbWJfcGxhbmVfYXRvbWljX2Rpc2FibGUgaXMgY2FsbGVkLCBtYXJrIHRoZSBwbGFuZSBh
cworCQkgKiBkaXNhYmxlZCBidXQgYWN0dWFsbHkgZGlzYWJsZSB0aGUgcGxhbmUgd2hlbiBFT0Yg
aXJxIGlzCisJCSAqIGJlaW5nIGhhbmRsZWQuCisJCSAqLworCQlmb3IgKHBsYW5lX2lkID0gTEFZ
RVJfMDsKKwkJCQlwbGFuZV9pZCA8IEtNQl9NQVhfUExBTkVTOyBwbGFuZV9pZCsrKSB7CisJCQlp
ZiAoa21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRdLmRpc2FibGUpIHsKKwkJCQlrbWJfY2xyX2Jp
dG1hc2tfbGNkKGttYiwKKwkJCQkJCSAgICBMQ0RfTEFZRVJuX0RNQV9DRkcKKwkJCQkJCSAgICAo
cGxhbmVfaWQpLAorCQkJCQkJICAgIExDRF9ETUFfTEFZRVJfRU5BQkxFKTsKKworCQkJCWttYl9j
bHJfYml0bWFza19sY2Qoa21iLCBMQ0RfQ09OVFJPTCwKKwkJCQkJCSAgICBrbWItPnBsYW5lX3N0
YXR1c1twbGFuZV9pZF0uY3RybCk7CisKKwkJCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0u
ZGlzYWJsZSA9IGZhbHNlOworCQkJfQorCQl9CisJCWlmIChrbWItPmttYl91bmRlcl9mbG93KSB7
CisJCQkvKiBETUEgUmVjb3ZlcnkgYWZ0ZXIgdW5kZXJmbG93ICovCisJCQlkbWEwX3N0YXRlID0g
KGttYi0+bGF5ZXJfbm8gPT0gMCkgPworCQkJICAgIExDRF9WSURFTzBfRE1BMF9TVEFURSA6IExD
RF9WSURFTzFfRE1BMF9TVEFURTsKKwkJCWRtYTFfc3RhdGUgPSAoa21iLT5sYXllcl9ubyA9PSAw
KSA/CisJCQkgICAgTENEX1ZJREVPMF9ETUExX1NUQVRFIDogTENEX1ZJREVPMV9ETUExX1NUQVRF
OworCisJCQlkbyB7CisJCQkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9GSUZPX0ZMVVNILCAxKTsK
KwkJCQl2YWwgPSBrbWJfcmVhZF9sY2Qoa21iLCBkbWEwX3N0YXRlKQorCQkJCSAgICAmIExDRF9E
TUFfU1RBVEVfQUNUSVZFOworCQkJCXZhbDEgPSBrbWJfcmVhZF9sY2Qoa21iLCBkbWExX3N0YXRl
KQorCQkJCSAgICAmIExDRF9ETUFfU1RBVEVfQUNUSVZFOworCQkJfSB3aGlsZSAoKHZhbCB8fCB2
YWwxKSk7CisJCQkvKiBkaXNhYmxlIGRtYSAqLworCQkJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIs
CisJCQkJCSAgICBMQ0RfTEFZRVJuX0RNQV9DRkcoa21iLT5sYXllcl9ubyksCisJCQkJCSAgICBM
Q0RfRE1BX0xBWUVSX0VOQUJMRSk7CisJCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0ZJRk9fRkxV
U0gsIDEpOworCQkJa21iLT5rbWJfZmx1c2hfZG9uZSA9IDE7CisJCQlrbWItPmttYl91bmRlcl9m
bG93ID0gMDsKKwkJfQorCX0KKworCWlmIChzdGF0dXMgJiBMQ0RfSU5UX0xJTkVfQ01QKSB7CisJ
CS8qIGNsZWFyIGxpbmUgY29tcGFyZSBpbnRlcnJ1cHQgKi8KKwkJa21iX3dyaXRlX2xjZChrbWIs
IExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfTElORV9DTVApOworCX0KKworCWlmIChzdGF0dXMgJiBM
Q0RfSU5UX1ZFUlRfQ09NUCkgeworCQkvKiBSZWFkIFZTVEFUVVMgKi8KKwkJdmFsID0ga21iX3Jl
YWRfbGNkKGttYiwgTENEX1ZTVEFUVVMpOworCQl2YWwgPSAodmFsICYgTENEX1ZTVEFUVVNfVkVS
VElDQUxfU1RBVFVTX01BU0spOworCQlzd2l0Y2ggKHZhbCkgeworCQljYXNlIExDRF9WU1RBVFVT
X0NPTVBBUkVfVlNZTkM6CisJCQkvKiBDbGVhciB2ZXJ0aWNhbCBjb21wYXJlIGludGVycnVwdCAq
LworCQkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfVkVSVF9DT01Q
KTsKKwkJCWlmIChrbWItPmttYl9mbHVzaF9kb25lKSB7CisJCQkJa21iX3NldF9iaXRtYXNrX2xj
ZChrbWIsCisJCQkJCQkgICAgTENEX0xBWUVSbl9ETUFfQ0ZHCisJCQkJCQkgICAgKGttYi0+bGF5
ZXJfbm8pLAorCQkJCQkJICAgIExDRF9ETUFfTEFZRVJfRU5BQkxFKTsKKwkJCQlrbWItPmttYl9m
bHVzaF9kb25lID0gMDsKKwkJCX0KKwkJCWRybV9jcnRjX2hhbmRsZV92YmxhbmsoJmttYi0+Y3J0
Yyk7CisJCQlicmVhazsKKwkJY2FzZSBMQ0RfVlNUQVRVU19DT01QQVJFX0JBQ0tQT1JDSDoKKwkJ
Y2FzZSBMQ0RfVlNUQVRVU19DT01QQVJFX0FDVElWRToKKwkJY2FzZSBMQ0RfVlNUQVRVU19DT01Q
QVJFX0ZST05UX1BPUkNIOgorCQkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9JTlRfQ0xFQVIsIExD
RF9JTlRfVkVSVF9DT01QKTsKKwkJCWJyZWFrOworCQl9CisJfQorCWlmIChzdGF0dXMgJiBMQ0Rf
SU5UX0RNQV9FUlIpIHsKKwkJdmFsID0KKwkJICAgIChzdGF0dXMgJiBMQ0RfSU5UX0RNQV9FUlIg
JgorCQkgICAgIGttYl9yZWFkX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFKSk7CisJCS8qIExBWUVS
MCAtIFZMMCAqLworCQlpZiAodmFsICYgKExBWUVSMF9ETUFfRklGT19VTkRFUkZMT1cgfAorCQkJ
ICAgTEFZRVIwX0RNQV9DQl9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjBfRE1BX0NSX0ZJ
Rk9fVU5ERVJGTE9XKSkgeworCQkJa21iLT5rbWJfdW5kZXJfZmxvdysrOworCQkJZHJtX2luZm8o
JmttYi0+ZHJtLAorCQkJCSAiIUxBWUVSMDpWTDAgRE1BIFVOREVSRkxPVyB2YWwgPSAweCVseCx1
bmRlcl9mbG93PSVkIiwKKwkJCSAgICAgdmFsLCBrbWItPmttYl91bmRlcl9mbG93KTsKKwkJCS8q
IGRpc2FibGUgdW5kZXJmbG93IGludGVycnVwdCAqLworCQkJa21iX2Nscl9iaXRtYXNrX2xjZChr
bWIsIExDRF9JTlRfRU5BQkxFLAorCQkJCQkgICAgTEFZRVIwX0RNQV9GSUZPX1VOREVSRkxPVyB8
CisJCQkJCSAgICBMQVlFUjBfRE1BX0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVS
MF9ETUFfQ1JfRklGT19VTkRFUkZMT1cpOworCQkJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsIExD
RF9JTlRfQ0xFQVIsCisJCQkJCSAgICBMQVlFUjBfRE1BX0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJ
CQkJICAgIExBWUVSMF9ETUFfRklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIwX0RNQV9D
Ul9GSUZPX1VOREVSRkxPVyk7CisJCQkvKiBkaXNhYmxlIGF1dG8gcmVzdGFydCBtb2RlICovCisJ
CQlrbWJfY2xyX2JpdG1hc2tfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfQ0ZHKDApLAorCQkJCQkg
ICAgTENEX0RNQV9MQVlFUl9DT05UX1BJTkdfUE9OR19VUERBVEUpOworCisJCQlrbWItPmxheWVy
X25vID0gMDsKKwkJfQorCisJCWlmICh2YWwgJiBMQVlFUjBfRE1BX0ZJRk9fT1ZFUkZMT1cpCisJ
CQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIwOlZMMCBETUEgT1ZFUkZMT1cgdmFsID0g
MHglbHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIwX0RNQV9DQl9GSUZPX09WRVJGTE9XKQor
CQkJZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMDpWTDAgRE1BIENCIE9WRVJGTE9XIHZh
bCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAmIExBWUVSMF9ETUFfQ1JfRklGT19PVkVSRkxP
VykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjA6VkwwIERNQSBDUiBPVkVSRkxP
VyB2YWwgPSAweCVseCIsIHZhbCk7CisKKwkJLyogTEFZRVIxIC0gVkwxICovCisJCWlmICh2YWwg
JiAoTEFZRVIxX0RNQV9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjFfRE1BX0NCX0ZJRk9f
VU5ERVJGTE9XIHwKKwkJCSAgIExBWUVSMV9ETUFfQ1JfRklGT19VTkRFUkZMT1cpKSB7CisJCQlr
bWItPmttYl91bmRlcl9mbG93Kys7CisJCQlkcm1faW5mbygma21iLT5kcm0sCisJCQkJICIhTEFZ
RVIxOlZMMSBETUEgVU5ERVJGTE9XIHZhbCA9IDB4JWx4LCB1bmRlcl9mbG93PSVkIiwKKwkJCSAg
ICAgdmFsLCBrbWItPmttYl91bmRlcl9mbG93KTsKKwkJCS8qIGRpc2FibGUgdW5kZXJmbG93IGlu
dGVycnVwdCAqLworCQkJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLAor
CQkJCQkgICAgTEFZRVIxX0RNQV9GSUZPX1VOREVSRkxPVyB8CisJCQkJCSAgICBMQVlFUjFfRE1B
X0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVSMV9ETUFfQ1JfRklGT19VTkRFUkZM
T1cpOworCQkJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfQ0xFQVIsCisJCQkJCSAg
ICBMQVlFUjFfRE1BX0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVSMV9ETUFfRklG
T19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIxX0RNQV9DUl9GSUZPX1VOREVSRkxPVyk7CisJ
CQkvKiBkaXNhYmxlIGF1dG8gcmVzdGFydCBtb2RlICovCisJCQlrbWJfY2xyX2JpdG1hc2tfbGNk
KGttYiwgTENEX0xBWUVSbl9ETUFfQ0ZHKDEpLAorCQkJCQkgICAgTENEX0RNQV9MQVlFUl9DT05U
X1BJTkdfUE9OR19VUERBVEUpOworCQkJa21iLT5sYXllcl9ubyA9IDE7CisJCX0KKworCQkvKiBM
QVlFUjEgLSBWTDEgKi8KKwkJaWYgKHZhbCAmIExBWUVSMV9ETUFfRklGT19PVkVSRkxPVykKKwkJ
CWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjE6VkwxIERNQSBPVkVSRkxPVyB2YWwgPSAw
eCVseCIsIHZhbCk7CisJCWlmICh2YWwgJiBMQVlFUjFfRE1BX0NCX0ZJRk9fT1ZFUkZMT1cpCisJ
CQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIxOlZMMSBETUEgQ0IgT1ZFUkZMT1cgdmFs
ID0gMHglbHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIxX0RNQV9DUl9GSUZPX09WRVJGTE9X
KQorCQkJZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMTpWTDEgRE1BIENSIE9WRVJGTE9X
IHZhbCA9IDB4JWx4IiwgdmFsKTsKKworCQkvKiBMQVlFUjIgLSBHTDAgKi8KKwkJaWYgKHZhbCAm
IExBWUVSMl9ETUFfRklGT19VTkRFUkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQki
TEFZRVIyOkdMMCBETUEgVU5ERVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAm
IExBWUVSMl9ETUFfRklGT19PVkVSRkxPVykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJM
QVlFUjI6R0wwIERNQSBPVkVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisKKwkJLyogTEFZRVIz
IC0gR0wxICovCisJCWlmICh2YWwgJiBMQVlFUjNfRE1BX0ZJRk9fVU5ERVJGTE9XKQorCQkJZHJt
X2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMzpHTDEgRE1BIFVOREVSRkxPVyB2YWwgPSAweCVs
eCIsIHZhbCk7CisJCWlmICh2YWwgJiBMQVlFUjNfRE1BX0ZJRk9fVU5ERVJGTE9XKQorCQkJZHJt
X2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMzpHTDEgRE1BIE9WRVJGTE9XIHZhbCA9IDB4JWx4
IiwgdmFsKTsKKwl9CisKKwlzcGluX3VubG9jaygma21iLT5pcnFfbG9jayk7CisKKwlpZiAoc3Rh
dHVzICYgTENEX0lOVF9MQVlFUikgeworCQkvKiBDbGVhciBsYXllciBpbnRlcnJ1cHRzICovCisJ
CWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5UX0xBWUVSKTsKKwl9CisK
KwkvKiBDbGVhciBhbGwgaW50ZXJydXB0cyAqLworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBM
Q0RfSU5UX0NMRUFSLCAxKTsKKwlyZXR1cm4gSVJRX0hBTkRMRUQ7Cit9CisKKy8qIElSUSBoYW5k
bGVyICovCitzdGF0aWMgaXJxcmV0dXJuX3Qga21iX2lzcihpbnQgaXJxLCB2b2lkICphcmcpCit7
CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IChzdHJ1Y3QgZHJtX2RldmljZSAqKWFyZzsKKwor
CWhhbmRsZV9sY2RfaXJxKGRldik7CisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCitzdGF0aWMg
dm9pZCBrbWJfaXJxX3Jlc2V0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7CisJa21iX3dyaXRl
X2xjZCh0b19rbWIoZHJtKSwgTENEX0lOVF9DTEVBUiwgMHhGRkZGKTsKKwlrbWJfd3JpdGVfbGNk
KHRvX2ttYihkcm0pLCBMQ0RfSU5UX0VOQUJMRSwgMCk7Cit9CisKK0RFRklORV9EUk1fR0VNX0NN
QV9GT1BTKGZvcHMpOworCitzdGF0aWMgc3RydWN0IGRybV9kcml2ZXIga21iX2RyaXZlciA9IHsK
KwkuZHJpdmVyX2ZlYXR1cmVzID0gRFJJVkVSX0dFTSB8CisJICAgIERSSVZFUl9NT0RFU0VUIHwg
RFJJVkVSX0FUT01JQywKKwkuaXJxX2hhbmRsZXIgPSBrbWJfaXNyLAorCS5pcnFfcHJlaW5zdGFs
bCA9IGttYl9pcnFfcmVzZXQsCisJLmlycV91bmluc3RhbGwgPSBrbWJfaXJxX3Jlc2V0LAorCS8q
IEdFTSBPcGVyYXRpb25zICovCisJLmZvcHMgPSAmZm9wcywKKwlEUk1fR0VNX0NNQV9EUklWRVJf
T1BTX1ZNQVAsCisJLm5hbWUgPSAia21iLWRybSIsCisJLmRlc2MgPSAiS0VFTUJBWSBESVNQTEFZ
IERSSVZFUiAiLAorCS5kYXRlID0gIjIwMjAxMDA4IiwKKwkubWFqb3IgPSAxLAorCS5taW5vciA9
IDAsCit9OworCitzdGF0aWMgaW50IGttYl9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmcGRldi0+ZGV2OworCXN0cnVjdCBkcm1f
ZGV2aWNlICpkcm0gPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzdHJ1Y3Qga21iX2RybV9wcml2
YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKworCWRybV9kZXZfdW5yZWdpc3Rlcihkcm0pOworCWRy
bV9rbXNfaGVscGVyX3BvbGxfZmluaShkcm0pOworCW9mX25vZGVfcHV0KGttYi0+Y3J0Yy5wb3J0
KTsKKwlrbWItPmNydGMucG9ydCA9IE5VTEw7CisJcG1fcnVudGltZV9nZXRfc3luYyhkcm0tPmRl
dik7CisJZHJtX2lycV91bmluc3RhbGwoZHJtKTsKKwlwbV9ydW50aW1lX3B1dF9zeW5jKGRybS0+
ZGV2KTsKKwlwbV9ydW50aW1lX2Rpc2FibGUoZHJtLT5kZXYpOworCisJb2ZfcmVzZXJ2ZWRfbWVt
X2RldmljZV9yZWxlYXNlKGRybS0+ZGV2KTsKKworCS8qIFJlbGVhc2UgY2xrcyAqLworCWttYl9k
aXNwbGF5X2Nsa19kaXNhYmxlKGttYik7CisKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBOVUxMKTsK
KworCS8qIFVucmVnaXN0ZXIgRFNJIGhvc3QgKi8KKwlrbWJfZHNpX2hvc3RfdW5yZWdpc3Rlcihr
bWItPmttYl9kc2kpOworCWRybV9hdG9taWNfaGVscGVyX3NodXRkb3duKGRybSk7CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQga21iX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBk
ZXYpCit7CisJc3RydWN0IGRldmljZSAqZGV2ID0gZ2V0X2RldmljZSgmcGRldi0+ZGV2KTsKKwlz
dHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWI7CisJaW50IHJldCA9IDA7CisJc3RydWN0IGRldmlj
ZV9ub2RlICpkc2lfaW47CisJc3RydWN0IGRldmljZV9ub2RlICpkc2lfbm9kZTsKKwlzdHJ1Y3Qg
cGxhdGZvcm1fZGV2aWNlICpkc2lfcGRldjsKKworCS8qIFRoZSBicmlkZ2UgKEFEViA3NTM1KSB3
aWxsIHJldHVybiAtRVBST0JFX0RFRkVSIHVudGlsIGl0CisJICogaGFzIGEgbWlwaV9kc2lfaG9z
dCB0byByZWdpc3RlciBpdHMgZGV2aWNlIHRvLiBTbywgd2UKKwkgKiBmaXJzdCByZWdpc3RlciB0
aGUgRFNJIGhvc3QgZHVyaW5nIHByb2JlIHRpbWUsIGFuZCB0aGVuIHJldHVybgorCSAqIC1FUFJP
QkVfREVGRVIgdW50aWwgdGhlIGJyaWRnZSBpcyBsb2FkZWQuIFByb2JlIHdpbGwgYmUgY2FsbGVk
IGFnYWluCisJICogIGFuZCB0aGVuIHRoZSByZXN0IG9mIHRoZSBkcml2ZXIgaW5pdGlhbGl6YXRp
b24gY2FuIHByb2NlZWQKKwkgKiAgYWZ0ZXJ3YXJkcyBhbmQgdGhlIGJyaWRnZSBjYW4gYmUgc3Vj
Y2Vzc2Z1bGx5IGF0dGFjaGVkLgorCSAqLworCWRzaV9pbiA9IG9mX2dyYXBoX2dldF9lbmRwb2lu
dF9ieV9yZWdzKGRldi0+b2Zfbm9kZSwgMCwgMCk7CisJaWYgKCFkc2lfaW4pIHsKKwkJRFJNX0VS
Uk9SKCJGYWlsZWQgdG8gZ2V0IGRzaV9pbiBub2RlIGluZm8gZnJvbSBEVCIpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisJZHNpX25vZGUgPSBvZl9ncmFwaF9nZXRfcmVtb3RlX3BvcnRfcGFyZW50
KGRzaV9pbik7CisJaWYgKCFkc2lfbm9kZSkgeworCQlvZl9ub2RlX3B1dChkc2lfaW4pOworCQlE
Uk1fRVJST1IoIkZhaWxlZCB0byBnZXQgZHNpIG5vZGUgZnJvbSBEVFxuIik7CisJCXJldHVybiAt
RUlOVkFMOworCX0KKworCWRzaV9wZGV2ID0gb2ZfZmluZF9kZXZpY2VfYnlfbm9kZShkc2lfbm9k
ZSk7CisJaWYgKCFkc2lfcGRldikgeworCQlvZl9ub2RlX3B1dChkc2lfaW4pOworCQlvZl9ub2Rl
X3B1dChkc2lfbm9kZSk7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGdldCBkc2kgcGxhdGZvcm0g
ZGV2aWNlXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJb2Zfbm9kZV9wdXQoZHNpX2lu
KTsKKwlvZl9ub2RlX3B1dChkc2lfbm9kZSk7CisJcmV0ID0ga21iX2RzaV9ob3N0X2JyaWRnZV9p
bml0KGdldF9kZXZpY2UoJmRzaV9wZGV2LT5kZXYpKTsKKworCWlmIChyZXQgPT0gLUVQUk9CRV9E
RUZFUikgeworCQlyZXR1cm4gLUVQUk9CRV9ERUZFUjsKKwl9IGVsc2UgaWYgKHJldCkgeworCQlE
Uk1fRVJST1IoInByb2JlIGZhaWxlZCB0byBpbml0aWFsaXplIERTSSBob3N0IGJyaWRnZVxuIik7
CisJCXJldHVybiByZXQ7CisJfQorCisJLyogQ3JlYXRlIERSTSBkZXZpY2UgKi8KKwlrbWIgPSBk
ZXZtX2RybV9kZXZfYWxsb2MoZGV2LCAma21iX2RyaXZlciwKKwkJCQkgc3RydWN0IGttYl9kcm1f
cHJpdmF0ZSwgZHJtKTsKKwlpZiAoSVNfRVJSKGttYikpCisJCXJldHVybiBQVFJfRVJSKGttYik7
CisKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCAma21iLT5kcm0pOworCisJLyogSW5pdGlhbGl6ZSBN
SVBJIERTSSAqLworCWttYi0+a21iX2RzaSA9IGttYl9kc2lfaW5pdChkc2lfcGRldik7CisJaWYg
KElTX0VSUihrbWItPmttYl9kc2kpKSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVkIHRv
IGluaXRpYWxpemUgRFNJXG4iKTsKKwkJcmV0ID0gUFRSX0VSUihrbWItPmttYl9kc2kpOworCQln
b3RvIGVycl9mcmVlMTsKKwl9CisKKwlrbWItPmttYl9kc2ktPmRldiA9ICZkc2lfcGRldi0+ZGV2
OworCWttYi0+a21iX2RzaS0+cGRldiA9IGRzaV9wZGV2OworCXJldCA9IGttYl9od19pbml0KCZr
bWItPmRybSwgMCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZnJlZTE7CisKKwlyZXQgPSBrbWJf
c2V0dXBfbW9kZV9jb25maWcoJmttYi0+ZHJtKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9mcmVl
OworCisJcmV0ID0gZHJtX2lycV9pbnN0YWxsKCZrbWItPmRybSwga21iLT5pcnFfbGNkKTsKKwlp
ZiAocmV0IDwgMCkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0byBpbnN0YWxsIElS
USBoYW5kbGVyXG4iKTsKKwkJZ290byBlcnJfaXJxOworCX0KKworCWRybV9rbXNfaGVscGVyX3Bv
bGxfaW5pdCgma21iLT5kcm0pOworCisJLyogUmVnaXN0ZXIgZ3JhcGhpY3MgZGV2aWNlIHdpdGgg
dGhlIGtlcm5lbCAqLworCXJldCA9IGRybV9kZXZfcmVnaXN0ZXIoJmttYi0+ZHJtLCAwKTsKKwlp
ZiAocmV0KQorCQlnb3RvIGVycl9yZWdpc3RlcjsKKworCXJldHVybiAwOworCisgZXJyX3JlZ2lz
dGVyOgorCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaSgma21iLT5kcm0pOworIGVycl9pcnE6CisJ
cG1fcnVudGltZV9kaXNhYmxlKGttYi0+ZHJtLmRldik7CisgZXJyX2ZyZWU6CisJZHJtX2NydGNf
Y2xlYW51cCgma21iLT5jcnRjKTsKKwlkcm1fbW9kZV9jb25maWdfY2xlYW51cCgma21iLT5kcm0p
OworIGVycl9mcmVlMToKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBOVUxMKTsKKwlrbWJfZHNpX2hv
c3RfdW5yZWdpc3RlcihrbWItPmttYl9kc2kpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQga21iX29mX21hdGNoW10gPSB7CisJey5jb21wYXRp
YmxlID0gImludGVsLGtlZW1iYXktZGlzcGxheSJ9LAorCXt9LAorfTsKKworTU9EVUxFX0RFVklD
RV9UQUJMRShvZiwga21iX29mX21hdGNoKTsKKworc3RhdGljIGludCBfX21heWJlX3VudXNlZCBr
bWJfcG1fc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRybSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmtt
YiA9IGRybSA/IHRvX2ttYihkcm0pIDogTlVMTDsKKworCWRybV9rbXNfaGVscGVyX3BvbGxfZGlz
YWJsZShkcm0pOworCisJa21iLT5zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX3N1c3BlbmQoZHJt
KTsKKwlpZiAoSVNfRVJSKGttYi0+c3RhdGUpKSB7CisJCWRybV9rbXNfaGVscGVyX3BvbGxfZW5h
YmxlKGRybSk7CisJCXJldHVybiBQVFJfRVJSKGttYi0+c3RhdGUpOworCX0KKworCXJldHVybiAw
OworfQorCitzdGF0aWMgaW50IF9fbWF5YmVfdW51c2VkIGttYl9wbV9yZXN1bWUoc3RydWN0IGRl
dmljZSAqZGV2KQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBkZXZfZ2V0X2RydmRhdGEo
ZGV2KTsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSBkcm0gPyB0b19rbWIoZHJtKSA6
IE5VTEw7CisKKwlpZiAoIWttYikKKwkJcmV0dXJuIDA7CisKKwlkcm1fYXRvbWljX2hlbHBlcl9y
ZXN1bWUoZHJtLCBrbWItPnN0YXRlKTsKKwlkcm1fa21zX2hlbHBlcl9wb2xsX2VuYWJsZShkcm0p
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBTSU1QTEVfREVWX1BNX09QUyhrbWJfcG1fb3Bz
LCBrbWJfcG1fc3VzcGVuZCwga21iX3BtX3Jlc3VtZSk7CisKK3N0YXRpYyBzdHJ1Y3QgcGxhdGZv
cm1fZHJpdmVyIGttYl9wbGF0Zm9ybV9kcml2ZXIgPSB7CisJLnByb2JlID0ga21iX3Byb2JlLAor
CS5yZW1vdmUgPSBrbWJfcmVtb3ZlLAorCS5kcml2ZXIgPSB7CisJCS5uYW1lID0gImttYi1kcm0i
LAorCQkucG0gPSAma21iX3BtX29wcywKKwkJLm9mX21hdGNoX3RhYmxlID0ga21iX29mX21hdGNo
LAorCX0sCit9OworCittb2R1bGVfcGxhdGZvcm1fZHJpdmVyKGttYl9wbGF0Zm9ybV9kcml2ZXIp
OworCitNT0RVTEVfQVVUSE9SKCJJbnRlbCBDb3Jwb3JhdGlvbiIpOworTU9EVUxFX0RFU0NSSVBU
SU9OKCJLZWVtYmF5IERpc3BsYXkgZHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuaCBiL2RyaXZlcnMvZ3B1
L2RybS9rbWIva21iX2Rydi5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjAy
ZTgwNjcKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuaApA
QCAtMCwwICsxLDg4IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5
CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisK
KyNpZm5kZWYgX19LTUJfRFJWX0hfXworI2RlZmluZSBfX0tNQl9EUlZfSF9fCisKKyNpbmNsdWRl
IDxkcm0vZHJtX2RldmljZS5oPgorCisjaW5jbHVkZSAia21iX3BsYW5lLmgiCisjaW5jbHVkZSAi
a21iX3JlZ3MuaCIKKworI2RlZmluZSBLTUJfTUFYX1dJRFRICQkJMTkyMCAvKk1heCB3aWR0aCBp
biBwaXhlbHMgKi8KKyNkZWZpbmUgS01CX01BWF9IRUlHSFQJCQkxMDgwIC8qTWF4IGhlaWdodCBp
biBwaXhlbHMgKi8KKyNkZWZpbmUgS01CX01JTl9XSURUSCAgICAgICAgICAgICAgICAgICAxOTIw
IC8qTWF4IHdpZHRoIGluIHBpeGVscyAqLworI2RlZmluZSBLTUJfTUlOX0hFSUdIVCAgICAgICAg
ICAgICAgICAgIDEwODAgLypNYXggaGVpZ2h0IGluIHBpeGVscyAqLworI2RlZmluZSBLTUJfTENE
X0RFRkFVTFRfQ0xLCQkyMDAwMDAwMDAKKyNkZWZpbmUgS01CX1NZU19DTEtfTUhaCQkJNTAwCisK
KyNkZWZpbmUgSUNBTV9NTUlPCQkweDNiMTAwMDAwCisjZGVmaW5lIElDQU1fTENEX09GRlNFVAkJ
MHgxMDgwCisjZGVmaW5lIElDQU1fTU1JT19TSVpFCQkweDIwMDAKKworc3RydWN0IGttYl9kc2k7
CisKK3N0cnVjdCBrbWJfY2xvY2sgeworCXN0cnVjdCBjbGsgKmNsa19sY2Q7CisJc3RydWN0IGNs
ayAqY2xrX3BsbDA7Cit9OworCitzdHJ1Y3Qga21iX2RybV9wcml2YXRlIHsKKwlzdHJ1Y3QgZHJt
X2RldmljZQkJZHJtOworCXN0cnVjdCBrbWJfZHNpCQkJKmttYl9kc2k7CisJdm9pZCBfX2lvbWVt
CQkJKmxjZF9tbWlvOworCXN0cnVjdCBrbWJfY2xvY2sJCWttYl9jbGs7CisJc3RydWN0IGRybV9j
cnRjCQkJY3J0YzsKKwlzdHJ1Y3Qga21iX3BsYW5lCQkqcGxhbmU7CisJc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUJCSpzdGF0ZTsKKwlzcGlubG9ja190CQkJaXJxX2xvY2s7CisJaW50CQkJCWlycV9s
Y2Q7CisJaW50CQkJCXN5c19jbGtfbWh6OworCXN0cnVjdCBsYXllcl9zdGF0dXMJCXBsYW5lX3N0
YXR1c1tLTUJfTUFYX1BMQU5FU107CisJaW50CQkJCWttYl91bmRlcl9mbG93OworCWludAkJCQlr
bWJfZmx1c2hfZG9uZTsKKwlpbnQJCQkJbGF5ZXJfbm87Cit9OworCitzdGF0aWMgaW5saW5lIHN0
cnVjdCBrbWJfZHJtX3ByaXZhdGUgKnRvX2ttYihjb25zdCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQoreworCXJldHVybiBjb250YWluZXJfb2YoZGV2LCBzdHJ1Y3Qga21iX2RybV9wcml2YXRlLCBk
cm0pOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmNydGNfdG9f
a21iX3ByaXYoY29uc3Qgc3RydWN0IGRybV9jcnRjICp4KQoreworCXJldHVybiBjb250YWluZXJf
b2YoeCwgc3RydWN0IGttYl9kcm1fcHJpdmF0ZSwgY3J0Yyk7Cit9CisKK3N0YXRpYyBpbmxpbmUg
dm9pZCBrbWJfd3JpdGVfbGNkKHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmRldl9wLAorCQkJCSB1
bnNpZ25lZCBpbnQgcmVnLCB1MzIgdmFsdWUpCit7CisJd3JpdGVsKHZhbHVlLCAoZGV2X3AtPmxj
ZF9tbWlvICsgcmVnKSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdTMyIGttYl9yZWFkX2xjZChzdHJ1
Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwgdW5zaWduZWQgaW50IHJlZykKK3sKKwlyZXR1cm4g
cmVhZGwoZGV2X3AtPmxjZF9tbWlvICsgcmVnKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGtt
Yl9zZXRfYml0bWFza19sY2Qoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAg
ICAgIHVuc2lnbmVkIGludCByZWcsIHUzMiBtYXNrKQoreworCXUzMiByZWdfdmFsID0ga21iX3Jl
YWRfbGNkKGRldl9wLCByZWcpOworCisJa21iX3dyaXRlX2xjZChkZXZfcCwgcmVnLCAocmVnX3Zh
bCB8IG1hc2spKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl9jbHJfYml0bWFza19sY2Qo
c3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgICAgIHVuc2lnbmVkIGludCBy
ZWcsIHUzMiBtYXNrKQoreworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbGNkKGRldl9wLCByZWcp
OworCisJa21iX3dyaXRlX2xjZChkZXZfcCwgcmVnLCAocmVnX3ZhbCAmICh+bWFzaykpKTsKK30K
KworaW50IGttYl9zZXR1cF9jcnRjKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwordm9pZCBrbWJf
c2V0X3NjYW5vdXQoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqbGNkKTsKKyNlbmRpZiAvKiBfX0tN
Ql9EUlZfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5j
IGIvZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwLi43NzAzMDhiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2ttYi9rbWJfcGxhbmUuYwpAQCAtMCwwICsxLDQ5MCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAtb25seQorLyoKKyAqIENvcHlyaWdodCDCqSAyMDE4LTIwMjAgSW50ZWwg
Q29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2NydGNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9jbWFf
aGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2NtYV9oZWxwZXIuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX21hbmFnZWQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3BsYW5lX2hlbHBlci5o
PgorCisjaW5jbHVkZSAia21iX2Rydi5oIgorI2luY2x1ZGUgImttYl9wbGFuZS5oIgorI2luY2x1
ZGUgImttYl9yZWdzLmgiCisKK2NvbnN0IHUzMiBsYXllcl9pcnFzW10gPSB7CisJTENEX0lOVF9W
TDAsCisJTENEX0lOVF9WTDEsCisJTENEX0lOVF9HTDAsCisJTENEX0lOVF9HTDEKK307CisKKy8q
IENvbnZlcnNpb24gKHl1di0+cmdiKSBtYXRyaXggZnJvbSBteXJpYWR4ICovCitzdGF0aWMgY29u
c3QgdTMyIGNzY19jb2VmX2xjZFtdID0geworCTEwMjQsIDAsIDE0MzYsCisJMTAyNCwgLTM1Miwg
LTczMSwKKwkxMDI0LCAxODE0LCAwLAorCS0xNzksIDEyNSwgLTIyNgorfTsKKworc3RhdGljIHVu
c2lnbmVkIGludCBjaGVja19waXhlbF9mb3JtYXQoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsIHUz
MiBmb3JtYXQpCit7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgcGxhbmUtPmZvcm1hdF9j
b3VudDsgaSsrKSB7CisJCWlmIChwbGFuZS0+Zm9ybWF0X3R5cGVzW2ldID09IGZvcm1hdCkKKwkJ
CXJldHVybiAwOworCX0KKwlyZXR1cm4gLUVJTlZBTDsKK30KKworc3RhdGljIGludCBrbWJfcGxh
bmVfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgc3RydWN0IGRy
bV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJ
aW50IHJldDsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJYm9vbCBjYW5f
cG9zaXRpb247CisKKwlmYiA9IHN0YXRlLT5mYjsKKwlpZiAoIWZiIHx8ICFzdGF0ZS0+Y3J0YykK
KwkJcmV0dXJuIDA7CisKKwlyZXQgPSBjaGVja19waXhlbF9mb3JtYXQocGxhbmUsIGZiLT5mb3Jt
YXQtPmZvcm1hdCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmIChzdGF0ZS0+Y3J0
Y193ID4gS01CX01BWF9XSURUSCB8fCBzdGF0ZS0+Y3J0Y19oID4gS01CX01BWF9IRUlHSFQpCisJ
CXJldHVybiAtRUlOVkFMOworCWlmIChzdGF0ZS0+Y3J0Y193IDwgS01CX01JTl9XSURUSCB8fCBz
dGF0ZS0+Y3J0Y19oIDwgS01CX01JTl9IRUlHSFQpCisJCXJldHVybiAtRUlOVkFMOworCWNhbl9w
b3NpdGlvbiA9IChwbGFuZS0+dHlwZSA9PSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZKTsKKwljcnRj
X3N0YXRlID0KKwkJZHJtX2F0b21pY19nZXRfZXhpc3RpbmdfY3J0Y19zdGF0ZShzdGF0ZS0+c3Rh
dGUsIHN0YXRlLT5jcnRjKTsKKwlyZXR1cm4gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVf
c3RhdGUoc3RhdGUsIGNydGNfc3RhdGUsCisJCQkJCQkgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FM
SU5HLAorCQkJCQkJIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKKwkJCQkJCSBjYW5fcG9z
aXRpb24sIHRydWUpOworfQorCitzdGF0aWMgdm9pZCBrbWJfcGxhbmVfYXRvbWljX2Rpc2FibGUo
c3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJCQkJICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRl
ICpzdGF0ZSkKK3sKKwlzdHJ1Y3Qga21iX3BsYW5lICprbWJfcGxhbmUgPSB0b19rbWJfcGxhbmUo
cGxhbmUpOworCWludCBwbGFuZV9pZCA9IGttYl9wbGFuZS0+aWQ7CisJc3RydWN0IGttYl9kcm1f
cHJpdmF0ZSAqa21iOworCisJa21iID0gdG9fa21iKHBsYW5lLT5kZXYpOworCisJc3dpdGNoIChw
bGFuZV9pZCkgeworCWNhc2UgTEFZRVJfMDoKKwkJa21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRd
LmN0cmwgPSBMQ0RfQ1RSTF9WTDFfRU5BQkxFOworCQlicmVhazsKKwljYXNlIExBWUVSXzE6CisJ
CWttYi0+cGxhbmVfc3RhdHVzW3BsYW5lX2lkXS5jdHJsID0gTENEX0NUUkxfVkwyX0VOQUJMRTsK
KwkJYnJlYWs7CisJY2FzZSBMQVlFUl8yOgorCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0u
Y3RybCA9IExDRF9DVFJMX0dMMV9FTkFCTEU7CisJCWJyZWFrOworCWNhc2UgTEFZRVJfMzoKKwkJ
a21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRdLmN0cmwgPSBMQ0RfQ1RSTF9HTDJfRU5BQkxFOwor
CQlicmVhazsKKwl9CisKKwlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uZGlzYWJsZSA9IHRy
dWU7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X3BpeGVsX2Zvcm1hdCh1MzIgZm9ybWF0
KQoreworCXVuc2lnbmVkIGludCB2YWwgPSAwOworCisJc3dpdGNoIChmb3JtYXQpIHsKKwkJLyog
cGxhbmFyIGZvcm1hdHMgKi8KKwljYXNlIERSTV9GT1JNQVRfWVVWNDQ0OgorCQl2YWwgPSBMQ0Rf
TEFZRVJfRk9STUFUX1lDQkNSNDQ0UExBTiB8IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRTsKKwkJ
YnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1lWVTQ0NDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1B
VF9ZQ0JDUjQ0NFBMQU4gfCBMQ0RfTEFZRVJfUExBTkFSX1NUT1JBR0UKKwkJICAgIHwgTENEX0xB
WUVSX0NSQ0JfT1JERVI7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9ZVVY0MjI6CisJCXZh
bCA9IExDRF9MQVlFUl9GT1JNQVRfWUNCQ1I0MjJQTEFOIHwgTENEX0xBWUVSX1BMQU5BUl9TVE9S
QUdFOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWVZVNDIyOgorCQl2YWwgPSBMQ0RfTEFZ
RVJfRk9STUFUX1lDQkNSNDIyUExBTiB8IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRQorCQkgICAg
fCBMQ0RfTEFZRVJfQ1JDQl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1lVVjQy
MDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9ZQ0JDUjQyMFBMQU4gfCBMQ0RfTEFZRVJfUExB
TkFSX1NUT1JBR0U7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9ZVlU0MjA6CisJCXZhbCA9
IExDRF9MQVlFUl9GT1JNQVRfWUNCQ1I0MjBQTEFOIHwgTENEX0xBWUVSX1BMQU5BUl9TVE9SQUdF
CisJCSAgICB8IExDRF9MQVlFUl9DUkNCX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JN
QVRfTlYxMjoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9OVjEyIHwgTENEX0xBWUVSX1BMQU5B
Ul9TVE9SQUdFOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfTlYyMToKKwkJdmFsID0gTENE
X0xBWUVSX0ZPUk1BVF9OVjEyIHwgTENEX0xBWUVSX1BMQU5BUl9TVE9SQUdFCisJCSAgICB8IExD
RF9MQVlFUl9DUkNCX09SREVSOworCQlicmVhazsKKwkJLyogcGFja2VkIGZvcm1hdHMgKi8KKwkJ
LyogbG9va3MgaHcgcmVxdWlyZXMgQiAmIEcgdG8gYmUgc3dhcHBlZCB3aGVuIFJHQiAqLworCWNh
c2UgRFJNX0ZPUk1BVF9SR0IzMzI6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCMzMyIHwg
TENEX0xBWUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hCR1I0NDQ0
OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQlg0NDQ0OworCQlicmVhazsKKwljYXNlIERS
TV9GT1JNQVRfQVJHQjQ0NDQ6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTQ0NDQgfCBM
Q0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfQUJHUjQ0NDQ6
CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTQ0NDQ7CisJCWJyZWFrOworCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCMTU1NToKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9YUkdCMTU1NSB8IExD
RF9MQVlFUl9CR1JfT1JERVI7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTU1NToK
KwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9YUkdCMTU1NTsKKwkJYnJlYWs7CisJY2FzZSBEUk1f
Rk9STUFUX0FSR0IxNTU1OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQkExNTU1IHwgTENE
X0xBWUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNTU1Ogor
CQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQkExNTU1OworCQlicmVhazsKKwljYXNlIERSTV9G
T1JNQVRfUkdCNTY1OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjU2NSB8IExDRF9MQVlF
Ul9CR1JfT1JERVI7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9CR1I1NjU6CisJCXZhbCA9
IExDRF9MQVlFUl9GT1JNQVRfUkdCNTY1OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfUkdC
ODg4OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjg4OCB8IExDRF9MQVlFUl9CR1JfT1JE
RVI7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9CR1I4ODg6CisJCXZhbCA9IExDRF9MQVlF
Ul9GT1JNQVRfUkdCODg4OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJ
CXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCWDg4ODggfCBMQ0RfTEFZRVJfQkdSX09SREVSOwor
CQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJCXZhbCA9IExDRF9MQVlFUl9G
T1JNQVRfUkdCWDg4ODg7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKKwkJ
dmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0JBODg4OCB8IExDRF9MQVlFUl9CR1JfT1JERVI7CisJ
CWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJdmFsID0gTENEX0xBWUVSX0ZP
Uk1BVF9SR0JBODg4ODsKKwkJYnJlYWs7CisJfQorCURSTV9JTkZPX09OQ0UoIiVzIDogJWQgZm9y
bWF0PTB4JXggdmFsPTB4JXhcbiIsCisJCSAgICAgIF9fZnVuY19fLCBfX0xJTkVfXywgZm9ybWF0
LCB2YWwpOworCXJldHVybiB2YWw7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X2JpdHNf
cGVyX3BpeGVsKGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCkKK3sKKwl1MzIg
YnBwID0gMDsKKwl1bnNpZ25lZCBpbnQgdmFsID0gMDsKKworCWlmIChmb3JtYXQtPm51bV9wbGFu
ZXMgPiAxKSB7CisJCXZhbCA9IExDRF9MQVlFUl84QlBQOworCQlyZXR1cm4gdmFsOworCX0KKwor
CWJwcCArPSA4ICogZm9ybWF0LT5jcHBbMF07CisKKwlzd2l0Y2ggKGJwcCkgeworCWNhc2UgODoK
KwkJdmFsID0gTENEX0xBWUVSXzhCUFA7CisJCWJyZWFrOworCWNhc2UgMTY6CisJCXZhbCA9IExD
RF9MQVlFUl8xNkJQUDsKKwkJYnJlYWs7CisJY2FzZSAyNDoKKwkJdmFsID0gTENEX0xBWUVSXzI0
QlBQOworCQlicmVhazsKKwljYXNlIDMyOgorCQl2YWwgPSBMQ0RfTEFZRVJfMzJCUFA7CisJCWJy
ZWFrOworCX0KKworCURSTV9ERUJVRygiYnBwPSVkIHZhbD0weCV4XG4iLCBicHAsIHZhbCk7CisJ
cmV0dXJuIHZhbDsKK30KKworc3RhdGljIHZvaWQgY29uZmlnX2NzYyhzdHJ1Y3Qga21iX2RybV9w
cml2YXRlICprbWIsIGludCBwbGFuZV9pZCkKK3sKKwkvKiBZVVYgdG8gUkdCIGNvbnZlcnNpb24g
dXNpbmcgdGhlIGZpeGVkIG1hdHJpeCBjc2NfY29lZl9sY2QgKi8KKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0xBWUVSbl9DU0NfQ09FRkYxMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFswXSk7CisJ
a21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMTIocGxhbmVfaWQpLCBjc2Nf
Y29lZl9sY2RbMV0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjEz
KHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzJdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xB
WUVSbl9DU0NfQ09FRkYyMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFszXSk7CisJa21iX3dyaXRl
X2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMjIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2Rb
NF0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjIzKHBsYW5lX2lk
KSwgY3NjX2NvZWZfbGNkWzVdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0Nf
Q09FRkYzMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFs2XSk7CisJa21iX3dyaXRlX2xjZChrbWIs
IExDRF9MQVlFUm5fQ1NDX0NPRUZGMzIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2RbN10pOworCWtt
Yl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjMzKHBsYW5lX2lkKSwgY3NjX2Nv
ZWZfbGNkWzhdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfT0ZGMShwbGFu
ZV9pZCksIGNzY19jb2VmX2xjZFs5XSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5f
Q1NDX09GRjIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2RbMTBdKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0xBWUVSbl9DU0NfT0ZGMyhwbGFuZV9pZCksIGNzY19jb2VmX2xjZFsxMV0pOworfQor
CitzdGF0aWMgdm9pZCBrbWJfcGxhbmVfYXRvbWljX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZSwKKwkJCQkgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iOworCXVu
c2lnbmVkIGludCB3aWR0aDsKKwl1bnNpZ25lZCBpbnQgaGVpZ2h0OworCXVuc2lnbmVkIGludCBk
bWFfbGVuOworCXN0cnVjdCBrbWJfcGxhbmUgKmttYl9wbGFuZTsKKwl1bnNpZ25lZCBpbnQgZG1h
X2NmZzsKKwl1bnNpZ25lZCBpbnQgY3RybCA9IDAsIHZhbCA9IDAsIG91dF9mb3JtYXQgPSAwOwor
CXVuc2lnbmVkIGludCBzcmNfdywgc3JjX2gsIGNydGNfeCwgY3J0Y195OworCXVuc2lnbmVkIGNo
YXIgcGxhbmVfaWQ7CisJaW50IG51bV9wbGFuZXM7CisJc3RhdGljIGRtYV9hZGRyX3QgYWRkcltN
QVhfU1VCX1BMQU5FU107CisKKwlpZiAoIXBsYW5lIHx8ICFwbGFuZS0+c3RhdGUgfHwgIXN0YXRl
KQorCQlyZXR1cm47CisKKwlmYiA9IHBsYW5lLT5zdGF0ZS0+ZmI7CisJaWYgKCFmYikKKwkJcmV0
dXJuOworCW51bV9wbGFuZXMgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOworCWttYl9wbGFuZSA9
IHRvX2ttYl9wbGFuZShwbGFuZSk7CisJcGxhbmVfaWQgPSBrbWJfcGxhbmUtPmlkOworCisJa21i
ID0gdG9fa21iKHBsYW5lLT5kZXYpOworCisJc3Bpbl9sb2NrX2lycSgma21iLT5pcnFfbG9jayk7
CisJaWYgKGttYi0+a21iX3VuZGVyX2Zsb3cgfHwga21iLT5rbWJfZmx1c2hfZG9uZSkgeworCQlz
cGluX3VubG9ja19pcnEoJmttYi0+aXJxX2xvY2spOworCQlkcm1fZGJnKCZrbWItPmRybSwgInBs
YW5lX3VwZGF0ZTp1bmRlcmZsb3chISEhIHJldHVybmluZyIpOworCQlyZXR1cm47CisJfQorCXNw
aW5fdW5sb2NrX2lycSgma21iLT5pcnFfbG9jayk7CisKKwlzcmNfdyA9IChwbGFuZS0+c3RhdGUt
PnNyY193ID4+IDE2KTsKKwlzcmNfaCA9IHBsYW5lLT5zdGF0ZS0+c3JjX2ggPj4gMTY7CisJY3J0
Y194ID0gcGxhbmUtPnN0YXRlLT5jcnRjX3g7CisJY3J0Y195ID0gcGxhbmUtPnN0YXRlLT5jcnRj
X3k7CisKKwlkcm1fZGJnKCZrbWItPmRybSwKKwkJInNyY193PSVkIHNyY19oPSVkLCBmYi0+Zm9y
bWF0LT5mb3JtYXQ9MHgleCBmYi0+ZmxhZ3M9MHgleFxuIiwKKwkJICBzcmNfdywgc3JjX2gsIGZi
LT5mb3JtYXQtPmZvcm1hdCwgZmItPmZsYWdzKTsKKworCXdpZHRoID0gZmItPndpZHRoOworCWhl
aWdodCA9IGZiLT5oZWlnaHQ7CisJZG1hX2xlbiA9ICh3aWR0aCAqIGhlaWdodCAqIGZiLT5mb3Jt
YXQtPmNwcFswXSk7CisJZHJtX2RiZygma21iLT5kcm0sICJkbWFfbGVuPSVkICIsIGRtYV9sZW4p
OworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9MRU4ocGxhbmVfaWQpLCBkbWFf
bGVuKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfTEVOX1NIQURPVyhwbGFu
ZV9pZCksIGRtYV9sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9MSU5F
X1ZTVFJJREUocGxhbmVfaWQpLAorCQkgICAgICBmYi0+cGl0Y2hlc1swXSk7CisJa21iX3dyaXRl
X2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0xJTkVfV0lEVEgocGxhbmVfaWQpLAorCQkgICAgICAo
d2lkdGggKiBmYi0+Zm9ybWF0LT5jcHBbMF0pKTsKKworCWFkZHJbWV9QTEFORV0gPSBkcm1fZmJf
Y21hX2dldF9nZW1fYWRkcihmYiwgcGxhbmUtPnN0YXRlLCAwKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0xBWUVSbl9ETUFfU1RBUlRfQUREUihwbGFuZV9pZCksCisJCSAgICAgIGFkZHJbWV9Q
TEFORV0gKyBmYi0+b2Zmc2V0c1swXSk7CisJdmFsID0gZ2V0X3BpeGVsX2Zvcm1hdChmYi0+Zm9y
bWF0LT5mb3JtYXQpOworCXZhbCB8PSBnZXRfYml0c19wZXJfcGl4ZWwoZmItPmZvcm1hdCk7CisJ
LyogUHJvZ3JhbSBDYi9DciBmb3IgcGxhbmFyIGZvcm1hdHMgKi8KKwlpZiAobnVtX3BsYW5lcyA+
IDEpIHsKKwkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NCX0xJTkVfVlNUUklE
RShwbGFuZV9pZCksCisJCQkgICAgICB3aWR0aCAqIGZiLT5mb3JtYXQtPmNwcFswXSk7CisJCWtt
Yl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9DQl9MSU5FX1dJRFRIKHBsYW5lX2lkKSwK
KwkJCSAgICAgICh3aWR0aCAqIGZiLT5mb3JtYXQtPmNwcFswXSkpOworCisJCWFkZHJbVV9QTEFO
RV0gPSBkcm1fZmJfY21hX2dldF9nZW1fYWRkcihmYiwgcGxhbmUtPnN0YXRlLAorCQkJCQkJCVVf
UExBTkUpOworCQkvKiBjaGVjayBpZiBDYi9DciBpcyBzd2FwcGVkKi8KKwkJaWYgKG51bV9wbGFu
ZXMgPT0gMyAmJiAodmFsICYgTENEX0xBWUVSX0NSQ0JfT1JERVIpKQorCQkJa21iX3dyaXRlX2xj
ZChrbWIsCisJCQkJICAgICAgTENEX0xBWUVSbl9ETUFfU1RBUlRfQ1JfQURSKHBsYW5lX2lkKSwK
KwkJCQkJYWRkcltVX1BMQU5FXSk7CisJCWVsc2UKKwkJCWttYl93cml0ZV9sY2Qoa21iLAorCQkJ
CSAgICAgIExDRF9MQVlFUm5fRE1BX1NUQVJUX0NCX0FEUihwbGFuZV9pZCksCisJCQkJCWFkZHJb
VV9QTEFORV0pOworCisJCWlmIChudW1fcGxhbmVzID09IDMpIHsKKwkJCWttYl93cml0ZV9sY2Qo
a21iLAorCQkJCSAgICAgIExDRF9MQVlFUm5fRE1BX0NSX0xJTkVfVlNUUklERShwbGFuZV9pZCks
CisJCQkJICAgICAgKCh3aWR0aCkgKiBmYi0+Zm9ybWF0LT5jcHBbMF0pKTsKKworCQkJa21iX3dy
aXRlX2xjZChrbWIsCisJCQkJICAgICAgTENEX0xBWUVSbl9ETUFfQ1JfTElORV9XSURUSChwbGFu
ZV9pZCksCisJCQkJICAgICAgKCh3aWR0aCkgKiBmYi0+Zm9ybWF0LT5jcHBbMF0pKTsKKworCQkJ
YWRkcltWX1BMQU5FXSA9IGRybV9mYl9jbWFfZ2V0X2dlbV9hZGRyKGZiLAorCQkJCQkJCQlwbGFu
ZS0+c3RhdGUsCisJCQkJCQkJCVZfUExBTkUpOworCisJCQkvKiBjaGVjayBpZiBDYi9DciBpcyBz
d2FwcGVkKi8KKwkJCWlmICh2YWwgJiBMQ0RfTEFZRVJfQ1JDQl9PUkRFUikKKwkJCQlrbWJfd3Jp
dGVfbGNkKGttYiwKKwkJCQkJICAgICAgTENEX0xBWUVSbl9ETUFfU1RBUlRfQ0JfQURSKHBsYW5l
X2lkKSwKKwkJCQkJICAgICAgYWRkcltWX1BMQU5FXSk7CisJCQllbHNlCisJCQkJa21iX3dyaXRl
X2xjZChrbWIsCisJCQkJCSAgICAgIExDRF9MQVlFUm5fRE1BX1NUQVJUX0NSX0FEUihwbGFuZV9p
ZCksCisJCQkJCSAgICAgIGFkZHJbVl9QTEFORV0pOworCQl9CisJfQorCisJa21iX3dyaXRlX2xj
ZChrbWIsIExDRF9MQVlFUm5fV0lEVEgocGxhbmVfaWQpLCBzcmNfdyAtIDEpOworCWttYl93cml0
ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0hFSUdIVChwbGFuZV9pZCksIHNyY19oIC0gMSk7CisJa21i
X3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ09MX1NUQVJUKHBsYW5lX2lkKSwgY3J0Y194KTsK
KwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9ST1dfU1RBUlQocGxhbmVfaWQpLCBjcnRj
X3kpOworCisJdmFsIHw9IExDRF9MQVlFUl9GSUZPXzEwMDsKKworCWlmICh2YWwgJiBMQ0RfTEFZ
RVJfUExBTkFSX1NUT1JBR0UpIHsKKwkJdmFsIHw9IExDRF9MQVlFUl9DU0NfRU47CisKKwkJLyog
RW5hYmxlIENTQyBpZiBpbnB1dCBpcyBwbGFuYXIgYW5kIG91dHB1dCBpcyBSR0IgKi8KKwkJY29u
ZmlnX2NzYyhrbWIsIHBsYW5lX2lkKTsKKwl9CisKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xB
WUVSbl9DRkcocGxhbmVfaWQpLCB2YWwpOworCisJc3dpdGNoIChwbGFuZV9pZCkgeworCWNhc2Ug
TEFZRVJfMDoKKwkJY3RybCA9IExDRF9DVFJMX1ZMMV9FTkFCTEU7CisJCWJyZWFrOworCWNhc2Ug
TEFZRVJfMToKKwkJY3RybCA9IExDRF9DVFJMX1ZMMl9FTkFCTEU7CisJCWJyZWFrOworCWNhc2Ug
TEFZRVJfMjoKKwkJY3RybCA9IExDRF9DVFJMX0dMMV9FTkFCTEU7CisJCWJyZWFrOworCWNhc2Ug
TEFZRVJfMzoKKwkJY3RybCA9IExDRF9DVFJMX0dMMl9FTkFCTEU7CisJCWJyZWFrOworCX0KKwor
CWN0cmwgfD0gTENEX0NUUkxfUFJPR1JFU1NJVkUgfCBMQ0RfQ1RSTF9USU1fR0VOX0VOQUJMRQor
CSAgICB8IExDRF9DVFJMX0NPTlRJTlVPVVMgfCBMQ0RfQ1RSTF9PVVRQVVRfRU5BQkxFRDsKKwor
CS8qIExDRCBpcyBjb25uZWN0ZWQgdG8gTUlQSSBvbiBrbWIKKwkgKiBUaGVyZWZvcmUgdGhpcyBi
aXQgaXMgcmVxdWlyZWQgZm9yIERTSSBUeAorCSAqLworCWN0cmwgfD0gTENEX0NUUkxfVkhTWU5D
X0lETEVfTFZMOworCisJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsIExDRF9DT05UUk9MLCBjdHJs
KTsKKworCS8qIEZJWE1FIG5vIGRvYyBvbiBob3cgdG8gc2V0IG91dHB1dCBmb3JtYXQsdGhlc2Ug
dmFsdWVzIGFyZQorCSAqIHRha2VuIGZyb20gdGhlIE15cmlhZHggdGVzdHMKKwkgKi8KKwlvdXRf
Zm9ybWF0IHw9IExDRF9PVVRGX0ZPUk1BVF9SR0I4ODg7CisKKwkvKiBMZWF2ZSBSR0Igb3JkZXIs
Y29udmVyc2lvbiBtb2RlIGFuZCBjbGlwIG1vZGUgdG8gZGVmYXVsdCAqLworCS8qIGRvIG5vdCBp
bnRlcmxlYXZlIFJHQiBjaGFubmVscyBmb3IgbWlwaSBUeCBjb21wYXRpYmlsaXR5ICovCisJb3V0
X2Zvcm1hdCB8PSBMQ0RfT1VURl9NSVBJX1JHQl9NT0RFOworCWttYl93cml0ZV9sY2Qoa21iLCBM
Q0RfT1VUX0ZPUk1BVF9DRkcsIG91dF9mb3JtYXQpOworCisJZG1hX2NmZyA9IExDRF9ETUFfTEFZ
RVJfRU5BQkxFIHwgTENEX0RNQV9MQVlFUl9WU1RSSURFX0VOIHwKKwkgICAgTENEX0RNQV9MQVlF
Ul9DT05UX1VQREFURSB8IExDRF9ETUFfTEFZRVJfQVhJX0JVUlNUXzE2OworCisJLyogRW5hYmxl
IERNQSAqLworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9DRkcocGxhbmVfaWQp
LCBkbWFfY2ZnKTsKKwlkcm1fZGJnKCZrbWItPmRybSwgImRtYV9jZmc9MHgleCBMQ0RfRE1BX0NG
Rz0weCV4XG4iLCBkbWFfY2ZnLAorCQlrbWJfcmVhZF9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9D
RkcocGxhbmVfaWQpKSk7CisKKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9DTEVB
UiwgTENEX0lOVF9FT0YgfAorCQkJTENEX0lOVF9ETUFfRVJSKTsKKwlrbWJfc2V0X2JpdG1hc2tf
bGNkKGttYiwgTENEX0lOVF9FTkFCTEUsIExDRF9JTlRfRU9GIHwKKwkJCUxDRF9JTlRfRE1BX0VS
Uik7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2hlbHBlcl9mdW5jcyBrbWJf
cGxhbmVfaGVscGVyX2Z1bmNzID0geworCS5hdG9taWNfY2hlY2sgPSBrbWJfcGxhbmVfYXRvbWlj
X2NoZWNrLAorCS5hdG9taWNfdXBkYXRlID0ga21iX3BsYW5lX2F0b21pY191cGRhdGUsCisJLmF0
b21pY19kaXNhYmxlID0ga21iX3BsYW5lX2F0b21pY19kaXNhYmxlCit9OworCit2b2lkIGttYl9w
bGFuZV9kZXN0cm95KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKQoreworCXN0cnVjdCBrbWJfcGxh
bmUgKmttYl9wbGFuZSA9IHRvX2ttYl9wbGFuZShwbGFuZSk7CisKKwlkcm1fcGxhbmVfY2xlYW51
cChwbGFuZSk7CisJa2ZyZWUoa21iX3BsYW5lKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fcGxhbmVfZnVuY3Mga21iX3BsYW5lX2Z1bmNzID0geworCS51cGRhdGVfcGxhbmUgPSBkcm1f
YXRvbWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCisJLmRpc2FibGVfcGxhbmUgPSBkcm1fYXRvbWlj
X2hlbHBlcl9kaXNhYmxlX3BsYW5lLAorCS5kZXN0cm95ID0ga21iX3BsYW5lX2Rlc3Ryb3ksCisJ
LnJlc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfcmVzZXQsCisJLmF0b21pY19kdXBsaWNh
dGVfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0
b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVzdHJveV9zdGF0
ZSwKK307CisKK3N0cnVjdCBrbWJfcGxhbmUgKmttYl9wbGFuZV9pbml0KHN0cnVjdCBkcm1fZGV2
aWNlICpkcm0pCit7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7
CisJc3RydWN0IGttYl9wbGFuZSAqcGxhbmUgPSBOVUxMOworCXN0cnVjdCBrbWJfcGxhbmUgKnBy
aW1hcnkgPSBOVUxMOworCWludCBpID0gMDsKKwlpbnQgcmV0ID0gMDsKKwllbnVtIGRybV9wbGFu
ZV90eXBlIHBsYW5lX3R5cGU7CisJY29uc3QgdTMyICpwbGFuZV9mb3JtYXRzOworCWludCBudW1f
cGxhbmVfZm9ybWF0czsKKworCWZvciAoaSA9IDA7IGkgPCBLTUJfTUFYX1BMQU5FUzsgaSsrKSB7
CisJCXBsYW5lID0gZHJtbV9remFsbG9jKGRybSwgc2l6ZW9mKCpwbGFuZSksIEdGUF9LRVJORUwp
OworCisJCWlmICghcGxhbmUpIHsKKwkJCWRybV9lcnIoZHJtLCAiRmFpbGVkIHRvIGFsbG9jYXRl
IHBsYW5lXG4iKTsKKwkJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCQl9CisKKwkJcGxhbmVf
dHlwZSA9IChpID09IDApID8gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWSA6CisJCSAgICBEUk1fUExB
TkVfVFlQRV9PVkVSTEFZOworCQlpZiAoaSA8IDIpIHsKKwkJCXBsYW5lX2Zvcm1hdHMgPSBrbWJf
Zm9ybWF0c192OworCQkJbnVtX3BsYW5lX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGttYl9mb3JtYXRz
X3YpOworCQl9IGVsc2UgeworCQkJcGxhbmVfZm9ybWF0cyA9IGttYl9mb3JtYXRzX2c7CisJCQlu
dW1fcGxhbmVfZm9ybWF0cyA9IEFSUkFZX1NJWkUoa21iX2Zvcm1hdHNfZyk7CisJCX0KKworCQly
ZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoZHJtLCAmcGxhbmUtPmJhc2VfcGxhbmUsCisJ
CQkJCSAgICAgICBQT1NTSUJMRV9DUlRDUywgJmttYl9wbGFuZV9mdW5jcywKKwkJCQkJICAgICAg
IHBsYW5lX2Zvcm1hdHMsIG51bV9wbGFuZV9mb3JtYXRzLAorCQkJCQkgICAgICAgTlVMTCwgcGxh
bmVfdHlwZSwgInBsYW5lICVkIiwgaSk7CisJCWlmIChyZXQgPCAwKSB7CisJCQlkcm1fZXJyKGRy
bSwgImRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCBmYWlsZWQgKHJldD0lZCkiLAorCQkJCXJldCk7
CisJCQlnb3RvIGNsZWFudXA7CisJCX0KKwkJZHJtX2RiZyhkcm0sICIlcyA6ICVkIGk9JWQgdHlw
ZT0lZCIsCisJCQlfX2Z1bmNfXywgX19MSU5FX18sCisJCQkgIGksIHBsYW5lX3R5cGUpOworCQlk
cm1fcGxhbmVfaGVscGVyX2FkZCgmcGxhbmUtPmJhc2VfcGxhbmUsCisJCQkJICAgICAma21iX3Bs
YW5lX2hlbHBlcl9mdW5jcyk7CisJCWlmIChwbGFuZV90eXBlID09IERSTV9QTEFORV9UWVBFX1BS
SU1BUlkpIHsKKwkJCXByaW1hcnkgPSBwbGFuZTsKKwkJCWttYi0+cGxhbmUgPSBwbGFuZTsKKwkJ
fQorCQlkcm1fZGJnKGRybSwgIiVzIDogJWQgcHJpbWFyeT0lcFxuIiwgX19mdW5jX18sIF9fTElO
RV9fLAorCQkJJnByaW1hcnktPmJhc2VfcGxhbmUpOworCQlwbGFuZS0+aWQgPSBpOworCX0KKwor
CXJldHVybiBwcmltYXJ5OworY2xlYW51cDoKKwlkcm1tX2tmcmVlKGRybSwgcGxhbmUpOworCXJl
dHVybiBFUlJfUFRSKHJldCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0va21iL2tt
Yl9wbGFuZS5oIGIvZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuaApuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwLi4xNzUwMTEzCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuaApAQCAtMCwwICsxLDk5IEBACisvKiBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAy
MCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgX19LTUJfUExBTkVfSF9fCisjZGVm
aW5lIF9fS01CX1BMQU5FX0hfXworCisjaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX3BsYW5lLmg+CisKKyNkZWZpbmUgTENEX0lOVF9WTDBfRVJSICgoTEFZRVIw
X0RNQV9GSUZPX1VOREVSRkxPVykgfCBcCisJCQkoTEFZRVIwX0RNQV9GSUZPX09WRVJGTE9XKSB8
IFwKKwkJCShMQVlFUjBfRE1BX0NCX0ZJRk9fT1ZFUkZMT1cpIHwgXAorCQkJKExBWUVSMF9ETUFf
Q0JfRklGT19VTkRFUkZMT1cpIHwgXAorCQkJKExBWUVSMF9ETUFfQ1JfRklGT19PVkVSRkxPVykg
fCBcCisJCQkoTEFZRVIwX0RNQV9DUl9GSUZPX1VOREVSRkxPVykpCisKKyNkZWZpbmUgTENEX0lO
VF9WTDFfRVJSICgoTEFZRVIxX0RNQV9GSUZPX1VOREVSRkxPVykgfCBcCisJCQkoTEFZRVIxX0RN
QV9GSUZPX09WRVJGTE9XKSB8IFwKKwkJCShMQVlFUjFfRE1BX0NCX0ZJRk9fT1ZFUkZMT1cpIHwg
XAorCQkJKExBWUVSMV9ETUFfQ0JfRklGT19VTkRFUkZMT1cpIHwgXAorCQkJKExBWUVSMV9ETUFf
Q1JfRklGT19PVkVSRkxPVykgfCBcCisJCQkoTEFZRVIxX0RNQV9DUl9GSUZPX1VOREVSRkxPVykp
CisKKyNkZWZpbmUgTENEX0lOVF9HTDBfRVJSIChMQVlFUjJfRE1BX0ZJRk9fT1ZFUkZMT1cgfCBM
QVlFUjJfRE1BX0ZJRk9fVU5ERVJGTE9XKQorI2RlZmluZSBMQ0RfSU5UX0dMMV9FUlIgKExBWUVS
M19ETUFfRklGT19PVkVSRkxPVyB8IExBWUVSM19ETUFfRklGT19VTkRFUkZMT1cpCisjZGVmaW5l
IExDRF9JTlRfVkwwIChMQVlFUjBfRE1BX0RPTkUgfCBMQVlFUjBfRE1BX0lETEUgfCBMQ0RfSU5U
X1ZMMF9FUlIpCisjZGVmaW5lIExDRF9JTlRfVkwxIChMQVlFUjFfRE1BX0RPTkUgfCBMQVlFUjFf
RE1BX0lETEUgfCBMQ0RfSU5UX1ZMMV9FUlIpCisjZGVmaW5lIExDRF9JTlRfR0wwIChMQVlFUjJf
RE1BX0RPTkUgfCBMQVlFUjJfRE1BX0lETEUgfCBMQ0RfSU5UX0dMMF9FUlIpCisjZGVmaW5lIExD
RF9JTlRfR0wxIChMQVlFUjNfRE1BX0RPTkUgfCBMQVlFUjNfRE1BX0lETEUgfCBMQ0RfSU5UX0dM
MV9FUlIpCisjZGVmaW5lIExDRF9JTlRfRE1BX0VSUiAoTENEX0lOVF9WTDBfRVJSIHwgTENEX0lO
VF9WTDFfRVJSIFwKKwkJfCBMQ0RfSU5UX0dMMF9FUlIgfCBMQ0RfSU5UX0dMMV9FUlIpCisKKyNk
ZWZpbmUgUE9TU0lCTEVfQ1JUQ1MgMQorI2RlZmluZSB0b19rbWJfcGxhbmUoeCkgY29udGFpbmVy
X29mKHgsIHN0cnVjdCBrbWJfcGxhbmUsIGJhc2VfcGxhbmUpCisKK2VudW0gbGF5ZXJfaWQgewor
CUxBWUVSXzAsCisJTEFZRVJfMSwKKwlMQVlFUl8yLAorCUxBWUVSXzMsCisJLyogS01CX01BWF9Q
TEFORVMgKi8KK307CisKKyNkZWZpbmUgS01CX01BWF9QTEFORVMgMQorCitlbnVtIHN1Yl9wbGFu
ZV9pZCB7CisJWV9QTEFORSwKKwlVX1BMQU5FLAorCVZfUExBTkUsCisJTUFYX1NVQl9QTEFORVMs
Cit9OworCitzdHJ1Y3Qga21iX3BsYW5lIHsKKwlzdHJ1Y3QgZHJtX3BsYW5lIGJhc2VfcGxhbmU7
CisJdW5zaWduZWQgY2hhciBpZDsKK307CisKKy8qIEdyYXBoaWNzIGxheWVyIChsYXllcnMgMiAm
IDMpIGZvcm1hdHMsIG9ubHkgcGFja2VkIGZvcm1hdHMgIGFyZSBzdXBwb3J0ZWQgKi8KK3N0YXRp
YyBjb25zdCB1MzIga21iX2Zvcm1hdHNfZ1tdID0geworCURSTV9GT1JNQVRfUkdCMzMyLAorCURS
TV9GT1JNQVRfWFJHQjQ0NDQsIERSTV9GT1JNQVRfWEJHUjQ0NDQsCisJRFJNX0ZPUk1BVF9BUkdC
NDQ0NCwgRFJNX0ZPUk1BVF9BQkdSNDQ0NCwKKwlEUk1fRk9STUFUX1hSR0IxNTU1LCBEUk1fRk9S
TUFUX1hCR1IxNTU1LAorCURSTV9GT1JNQVRfQVJHQjE1NTUsIERSTV9GT1JNQVRfQUJHUjE1NTUs
CisJRFJNX0ZPUk1BVF9SR0I1NjUsIERSTV9GT1JNQVRfQkdSNTY1LAorCURSTV9GT1JNQVRfUkdC
ODg4LCBEUk1fRk9STUFUX0JHUjg4OCwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LCBEUk1fRk9STUFU
X1hCR1I4ODg4LAorCURSTV9GT1JNQVRfQVJHQjg4ODgsIERSTV9GT1JNQVRfQUJHUjg4ODgsCit9
OworCisvKiBWaWRlbyBsYXllciAoIDAgJiAxKSBmb3JtYXRzLCBwYWNrZWQgYW5kIHBsYW5hciBm
b3JtYXRzIGFyZSBzdXBwb3J0ZWQgKi8KK3N0YXRpYyBjb25zdCB1MzIga21iX2Zvcm1hdHNfdltd
ID0geworCS8qIHBhY2tlZCBmb3JtYXRzICovCisJRFJNX0ZPUk1BVF9SR0IzMzIsCisJRFJNX0ZP
Uk1BVF9YUkdCNDQ0NCwgRFJNX0ZPUk1BVF9YQkdSNDQ0NCwKKwlEUk1fRk9STUFUX0FSR0I0NDQ0
LCBEUk1fRk9STUFUX0FCR1I0NDQ0LAorCURSTV9GT1JNQVRfWFJHQjE1NTUsIERSTV9GT1JNQVRf
WEJHUjE1NTUsCisJRFJNX0ZPUk1BVF9BUkdCMTU1NSwgRFJNX0ZPUk1BVF9BQkdSMTU1NSwKKwlE
Uk1fRk9STUFUX1JHQjU2NSwgRFJNX0ZPUk1BVF9CR1I1NjUsCisJRFJNX0ZPUk1BVF9SR0I4ODgs
IERSTV9GT1JNQVRfQkdSODg4LAorCURSTV9GT1JNQVRfWFJHQjg4ODgsIERSTV9GT1JNQVRfWEJH
Ujg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwgRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwkvKnBs
YW5hciBmb3JtYXRzICovCisJRFJNX0ZPUk1BVF9ZVVY0MjAsIERSTV9GT1JNQVRfWVZVNDIwLAor
CURSTV9GT1JNQVRfWVVWNDIyLCBEUk1fRk9STUFUX1lWVTQyMiwKKwlEUk1fRk9STUFUX1lVVjQ0
NCwgRFJNX0ZPUk1BVF9ZVlU0NDQsCisJRFJNX0ZPUk1BVF9OVjEyLCBEUk1fRk9STUFUX05WMjEs
Cit9OworCitzdHJ1Y3QgbGF5ZXJfc3RhdHVzIHsKKwlib29sIGRpc2FibGU7CisJdTMyIGN0cmw7
Cit9OworCitzdHJ1Y3Qga21iX3BsYW5lICprbWJfcGxhbmVfaW5pdChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZHJtKTsKK3ZvaWQga21iX3BsYW5lX2Rlc3Ryb3koc3RydWN0IGRybV9wbGFuZSAqcGxhbmUp
OworI2VuZGlmIC8qIF9fS01CX1BMQU5FX0hfXyAqLwotLSAKMi43LjQKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
