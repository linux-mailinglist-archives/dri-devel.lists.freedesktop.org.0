Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4E0E5284B3
	for <lists+dri-devel@lfdr.de>; Thu, 23 May 2019 19:17:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B33096E055;
	Thu, 23 May 2019 17:17:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x842.google.com (mail-qt1-x842.google.com
 [IPv6:2607:f8b0:4864:20::842])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A65AB6E053
 for <dri-devel@lists.freedesktop.org>; Thu, 23 May 2019 17:17:08 +0000 (UTC)
Received: by mail-qt1-x842.google.com with SMTP id f24so7611187qtk.11
 for <dri-devel@lists.freedesktop.org>; Thu, 23 May 2019 10:17:08 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=YOoI+kFEFfz9LrL8Adfvk8PSVi8fDSRQM6ZIbKpC71Q=;
 b=OLz0j9lqIpugumxjMkEjk4xemoeeSIondeDwQkG2KvwSHOQzM/YuOXeh1zNzn0uyjm
 4HbhInUBSV2uD4ek9gFbYhRrpy3cA0ERJuKqUfa6P7IHVsC/ty25bRmEN6IosqiibjG9
 6s6gQeIUUaFQuZxoRYddfaTVveArffRCEUzHgZyUz56iFG19cq0vT29H6kbHh2zylnBc
 SqX3Jale0EqsvTeRMIwgBvmIid5SQMMGxgkFFQ6GFoQWHjFiMsP3gZ1Q6obIScEDlsDv
 swz+DcYJiFb4w9dxTDCG1npJUvnRG3logUC+wbzKgww+uO4B4kEiSj61MNBxmmNLQDbI
 c3XA==
X-Gm-Message-State: APjAAAVX/1tacdgSI1MaPzqdHeAw2sb5PjOUN8Xxbaq2X4ZC+Ie59hGV
 fWI2n0tsB69oLMyQFo4eXXEeMYx55kk=
X-Google-Smtp-Source: APXvYqxQoLBWcUdmZJt5A7maTk+7saVt300tFlzQsl2BLsrTVmobiF3JlblgyopmJed3KTL4ljJVfw==
X-Received: by 2002:ac8:2809:: with SMTP id 9mr66230566qtq.4.1558631827700;
 Thu, 23 May 2019 10:17:07 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id v25sm662660qtv.2.2019.05.23.10.17.06
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Thu, 23 May 2019 10:17:07 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org,
	freedreno@lists.freedesktop.org
Subject: [PATCH v2 4/6] drm/msm/a6xx: Remove devm calls from gmu driver
Date: Thu, 23 May 2019 13:16:43 -0400
Message-Id: <20190523171653.138678-4-sean@poorly.run>
X-Mailer: git-send-email 2.22.0.rc1.257.g3120a18244-goog
In-Reply-To: <20190523171653.138678-1-sean@poorly.run>
References: <20190523171653.138678-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=YOoI+kFEFfz9LrL8Adfvk8PSVi8fDSRQM6ZIbKpC71Q=;
 b=WOyQTxGFjpgVbzMyOh6x8CBVZIC4EmjNx9VoiKWwVDRBwjidnFD+Arrimko93Sgb+j
 ULIKYLV3wI5JNHuDQ42Gf0DBiDwP+1JgdiCjYOCAJ1lvB1FxkYdUuZsO+sEH7cyI8nLj
 VnlYsxy7mtFNq7iZIjbajz4ZuFkBggxiIgvG4wAXb2SCPA5anCyU7KQ68Vv75Ox4dT2E
 u7kaM1IqRO5Phdy+Rm1TtBkY3DEjq5j+LsuA++pxJ5WrsvKcxQlORRqmQsuPUIVd5nFG
 LDtCcZ/GgkV582VHLoKcO8MwFeapNl4ClAPjhJiF/EEYWIIJse7Iv6pyfwzwE7B+/v7y
 2Z3g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sean Paul <sean@poorly.run>, Sean Paul <seanpaul@chromium.org>,
 linux-arm-msm@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGUgZ211IGRyaXZlciBp
cyBpbml0aWFsaXplZCBhbmQgY2xlYW5lZCB1cCB3aXRoIGNhbGxzIGZyb20gdGhlIGdwdSBkcml2
ZXIuIEFzCnN1Y2gsIHRoZSBwbGF0Zm9ybSBkZXZpY2Ugc3RheXMgdmFsaWQgYWZ0ZXIgYTZ4eF9n
bXVfcmVtb3ZlIGlzIGNhbGxlZCBhbmQgdGhlCmRldmljZSBtYW5hZ2VkIHJlc291cmNlcyBhcmUg
bm90IGZyZWVkLiBJbiB0aGUgY2FzZSBvZiBncHUgcHJvYmUgZmFpbHVyZXMgb3IKdW5iaW5kLCB0
aGVzZSByZXNvdXJjZXMgd2lsbCByZW1haW4gbWFuYWdlZC4KCklmIHRoZSBncHUgYmluZCBpcyBy
dW4gYWdhaW4gKGVnOiBpZiB0aGVyZSdzIGEgcHJvYmUgZGVmZXIgc29tZXdoZXJlIGluIG1zbSks
CnRoZXNlIHJlc291cmNlcyB3aWxsIGJlIGluaXRpYWxpemVkIGFnYWluIGZvciB0aGUgc2FtZSBk
ZXZpY2UsIGNyZWF0aW5nIG11bHRpcGxlCnJlZmVyZW5jZXMuIEluIHRoZSBjYXNlIG9mIGlycXMs
IHRoaXMgY2F1c2VzIGZhaWx1cmVzIHNpbmNlIHRoZSBpcnFzIGFyZQpub3Qgc2hhcmVkIChub3Ig
c2hvdWxkIHRoZXkgYmUpLgoKVGhpcyBwYXRjaCByZW1vdmVzIGFsbCBkZXZtXyogY2FsbHMgYW5k
IG1hbnVhbGx5IGNsZWFucyB0aGluZ3MgdXAgaW4KZ211X3JlbW92ZS4KCkNoYW5nZXMgaW4gdjI6
Ci0gQWRkIGlvdW5tYXAgYW5kIGZyZWVfaXJxIHRvIGdtdV9wcm9iZSBlcnJvciBwYXRocwoKQ2M6
IEpvcmRhbiBDcm91c2UgPGpjcm91c2VAY29kZWF1cm9yYS5vcmc+ClNpZ25lZC1vZmYtYnk6IFNl
YW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tc20v
YWRyZW5vL2E2eHhfZ211LmMgfCAzMyArKysrKysrKysrKysrKysrKystLS0tLS0tLS0KIDEgZmls
ZSBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCspLCAxMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hNnh4X2dtdS5jIGIvZHJpdmVycy9ncHUvZHJt
L21zbS9hZHJlbm8vYTZ4eF9nbXUuYwppbmRleCA3NDY1NDIzZTliNzEuLmY3MjQwYzllMTFmYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9hZHJlbm8vYTZ4eF9nbXUuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vbXNtL2FkcmVuby9hNnh4X2dtdS5jCkBAIC01MDUsOSArNTA1LDkgQEAg
c3RhdGljIHZvaWQgYTZ4eF9nbXVfcnBtaF9pbml0KHN0cnVjdCBhNnh4X2dtdSAqZ211KQogCiBl
cnI6CiAJaWYgKCFJU19FUlJfT1JfTlVMTChwZGNwdHIpKQotCQlkZXZtX2lvdW5tYXAoZ211LT5k
ZXYsIHBkY3B0cik7CisJCWlvdW5tYXAocGRjcHRyKTsKIAlpZiAoIUlTX0VSUl9PUl9OVUxMKHNl
cXB0cikpCi0JCWRldm1faW91bm1hcChnbXUtPmRldiwgc2VxcHRyKTsKKwkJaW91bm1hcChzZXFw
dHIpOwogfQogCiAvKgpAQCAtMTE5Nyw3ICsxMTk3LDcgQEAgc3RhdGljIHZvaWQgX19pb21lbSAq
YTZ4eF9nbXVfZ2V0X21taW8oc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAkJcmV0dXJu
IEVSUl9QVFIoLUVJTlZBTCk7CiAJfQogCi0JcmV0ID0gZGV2bV9pb3JlbWFwKCZwZGV2LT5kZXYs
IHJlcy0+c3RhcnQsIHJlc291cmNlX3NpemUocmVzKSk7CisJcmV0ID0gaW9yZW1hcChyZXMtPnN0
YXJ0LCByZXNvdXJjZV9zaXplKHJlcykpOwogCWlmICghcmV0KSB7CiAJCURSTV9ERVZfRVJST1Io
JnBkZXYtPmRldiwgIlVuYWJsZSB0byBtYXAgdGhlICVzIHJlZ2lzdGVyc1xuIiwgbmFtZSk7CiAJ
CXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwpAQCAtMTIxMywxMCArMTIxMywxMCBAQCBzdGF0aWMg
aW50IGE2eHhfZ211X2dldF9pcnEoc3RydWN0IGE2eHhfZ211ICpnbXUsIHN0cnVjdCBwbGF0Zm9y
bV9kZXZpY2UgKnBkZXYsCiAKIAlpcnEgPSBwbGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2LCBu
YW1lKTsKIAotCXJldCA9IGRldm1fcmVxdWVzdF9pcnEoJnBkZXYtPmRldiwgaXJxLCBoYW5kbGVy
LCBJUlFGX1RSSUdHRVJfSElHSCwKLQkJbmFtZSwgZ211KTsKKwlyZXQgPSByZXF1ZXN0X2lycShp
cnEsIGhhbmRsZXIsIElSUUZfVFJJR0dFUl9ISUdILCBuYW1lLCBnbXUpOwogCWlmIChyZXQpIHsK
LQkJRFJNX0RFVl9FUlJPUigmcGRldi0+ZGV2LCAiVW5hYmxlIHRvIGdldCBpbnRlcnJ1cHQgJXNc
biIsIG5hbWUpOworCQlEUk1fREVWX0VSUk9SKCZwZGV2LT5kZXYsICJVbmFibGUgdG8gZ2V0IGlu
dGVycnVwdCAlcyAlZFxuIiwKKwkJCSAgICAgIG5hbWUsIHJldCk7CiAJCXJldHVybiByZXQ7CiAJ
fQogCkBAIC0xMjQxLDEyICsxMjQxLDE4IEBAIHZvaWQgYTZ4eF9nbXVfcmVtb3ZlKHN0cnVjdCBh
Nnh4X2dwdSAqYTZ4eF9ncHUpCiAJCWRldl9wbV9kb21haW5fZGV0YWNoKGdtdS0+Z3hwZCwgZmFs
c2UpOwogCX0KIAorCWlvdW5tYXAoZ211LT5tbWlvKTsKKwlnbXUtPm1taW8gPSBOVUxMOworCiAJ
YTZ4eF9nbXVfbWVtb3J5X2ZyZWUoZ211LCBnbXUtPmhmaSk7CiAKIAlpb21tdV9kZXRhY2hfZGV2
aWNlKGdtdS0+ZG9tYWluLCBnbXUtPmRldik7CiAKIAlpb21tdV9kb21haW5fZnJlZShnbXUtPmRv
bWFpbik7CiAKKwlmcmVlX2lycShnbXUtPmdtdV9pcnEsIGdtdSk7CisJZnJlZV9pcnEoZ211LT5o
ZmlfaXJxLCBnbXUpOworCiAJZ211LT5pbml0aWFsaXplZCA9IGZhbHNlOwogfQogCkBAIC0xMjgx
LDI0ICsxMjg3LDI0IEBAIGludCBhNnh4X2dtdV9wcm9iZShzdHJ1Y3QgYTZ4eF9ncHUgKmE2eHhf
Z3B1LCBzdHJ1Y3QgZGV2aWNlX25vZGUgKm5vZGUpCiAJLyogQWxsb2NhdGUgbWVtb3J5IGZvciBm
b3IgdGhlIEhGSSBxdWV1ZXMgKi8KIAlnbXUtPmhmaSA9IGE2eHhfZ211X21lbW9yeV9hbGxvYyhn
bXUsIFNaXzE2Syk7CiAJaWYgKElTX0VSUihnbXUtPmhmaSkpCi0JCWdvdG8gZXJyOworCQlnb3Rv
IGVycl9tZW1vcnk7CiAKIAkvKiBBbGxvY2F0ZSBtZW1vcnkgZm9yIHRoZSBHTVUgZGVidWcgcmVn
aW9uICovCiAJZ211LT5kZWJ1ZyA9IGE2eHhfZ211X21lbW9yeV9hbGxvYyhnbXUsIFNaXzE2Syk7
CiAJaWYgKElTX0VSUihnbXUtPmRlYnVnKSkKLQkJZ290byBlcnI7CisJCWdvdG8gZXJyX21lbW9y
eTsKIAogCS8qIE1hcCB0aGUgR01VIHJlZ2lzdGVycyAqLwogCWdtdS0+bW1pbyA9IGE2eHhfZ211
X2dldF9tbWlvKHBkZXYsICJnbXUiKTsKIAlpZiAoSVNfRVJSKGdtdS0+bW1pbykpCi0JCWdvdG8g
ZXJyOworCQlnb3RvIGVycl9tZW1vcnk7CiAKIAkvKiBHZXQgdGhlIEhGSSBhbmQgR01VIGludGVy
cnVwdHMgKi8KIAlnbXUtPmhmaV9pcnEgPSBhNnh4X2dtdV9nZXRfaXJxKGdtdSwgcGRldiwgImhm
aSIsIGE2eHhfaGZpX2lycSk7CiAJZ211LT5nbXVfaXJxID0gYTZ4eF9nbXVfZ2V0X2lycShnbXUs
IHBkZXYsICJnbXUiLCBhNnh4X2dtdV9pcnEpOwogCiAJaWYgKGdtdS0+aGZpX2lycSA8IDAgfHwg
Z211LT5nbXVfaXJxIDwgMCkKLQkJZ290byBlcnI7CisJCWdvdG8gZXJyX21taW87CiAKIAkvKgog
CSAqIEdldCBhIGxpbmsgdG8gdGhlIEdYIHBvd2VyIGRvbWFpbiB0byByZXNldCB0aGUgR1BVIGlu
IGNhc2Ugb2YgR01VCkBAIC0xMzE1LDcgKzEzMjEsMTIgQEAgaW50IGE2eHhfZ211X3Byb2JlKHN0
cnVjdCBhNnh4X2dwdSAqYTZ4eF9ncHUsIHN0cnVjdCBkZXZpY2Vfbm9kZSAqbm9kZSkKIAlnbXUt
PmluaXRpYWxpemVkID0gdHJ1ZTsKIAogCXJldHVybiAwOwotZXJyOgorCitlcnJfbW1pbzoKKwlp
b3VubWFwKGdtdS0+bW1pbyk7CisJZnJlZV9pcnEoZ211LT5nbXVfaXJxLCBnbXUpOworCWZyZWVf
aXJxKGdtdS0+aGZpX2lycSwgZ211KTsKK2Vycl9tZW1vcnk6CiAJYTZ4eF9nbXVfbWVtb3J5X2Zy
ZWUoZ211LCBnbXUtPmhmaSk7CiAKIAlpZiAoZ211LT5kb21haW4pIHsKLS0gClNlYW4gUGF1bCwg
U29mdHdhcmUgRW5naW5lZXIsIEdvb2dsZSAvIENocm9taXVtIE9TCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
