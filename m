Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 845535D170
	for <lists+dri-devel@lfdr.de>; Tue,  2 Jul 2019 16:19:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BB2F889F6F;
	Tue,  2 Jul 2019 14:19:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D5A3889F9F
 for <dri-devel@lists.freedesktop.org>; Tue,  2 Jul 2019 14:19:15 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx04.intmail.prod.int.phx2.redhat.com
 [10.5.11.14])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id DA3587FDCA;
 Tue,  2 Jul 2019 14:19:12 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-96.ams2.redhat.com
 [10.36.116.96])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 2D4665D9C6;
 Tue,  2 Jul 2019 14:19:12 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 3E7D49D7D; Tue,  2 Jul 2019 16:19:06 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6 16/18] drm/virtio: rework virtio_gpu_cmd_context_{attach,
 detach}_resource
Date: Tue,  2 Jul 2019 16:19:01 +0200
Message-Id: <20190702141903.1131-17-kraxel@redhat.com>
In-Reply-To: <20190702141903.1131-1-kraxel@redhat.com>
References: <20190702141903.1131-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.14
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.27]); Tue, 02 Jul 2019 14:19:15 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Gerd Hoffmann <kraxel@redhat.com>, gurchetansingh@chromium.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3dpdGNoIHRvIHRoZSB2aXJ0aW9fZ3B1X2FycmF5XyogaGVscGVyIHdvcmtmbG93LgoKU2lnbmVk
LW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL3Zp
cnRpby92aXJ0Z3B1X2dlbS5jIHwgMjQgKysrKysrKysrKystLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYyAgfCAxMCArKysrKystLS0tCiAzIGZpbGVzIGNo
YW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0
aW8vdmlydGdwdV9kcnYuaAppbmRleCBiMWY2M2EyMWFiYjYuLmQ5OWM1NGFiZDA5MCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaApAQCAtMjkyLDEwICsyOTIsMTAgQEAgdm9pZCB2
aXJ0aW9fZ3B1X2NtZF9jb250ZXh0X2Rlc3Ryb3koc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2
Z2RldiwKIAkJCQkgICAgdWludDMyX3QgaWQpOwogdm9pZCB2aXJ0aW9fZ3B1X2NtZF9jb250ZXh0
X2F0dGFjaF9yZXNvdXJjZShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJCQkg
ICAgdWludDMyX3QgY3R4X2lkLAotCQkJCQkgICAgdWludDMyX3QgcmVzb3VyY2VfaWQpOworCQkJ
CQkgICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzKTsKIHZvaWQgdmlydGlv
X2dwdV9jbWRfY29udGV4dF9kZXRhY2hfcmVzb3VyY2Uoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNl
ICp2Z2RldiwKIAkJCQkJICAgIHVpbnQzMl90IGN0eF9pZCwKLQkJCQkJICAgIHVpbnQzMl90IHJl
c291cmNlX2lkKTsKKwkJCQkJICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2Jq
cyk7CiB2b2lkIHZpcnRpb19ncHVfY21kX3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2Ug
KnZnZGV2LAogCQkJICAgdm9pZCAqZGF0YSwgdWludDMyX3QgZGF0YV9zaXplLAogCQkJICAgdWlu
dDMyX3QgY3R4X2lkLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1
X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCmluZGV4IDZiYWY2
NDE0MTY0NS4uZTc1ODE5ZGJiYTgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlv
L3ZpcnRncHVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5j
CkBAIC0xMTEsMTkgKzExMSwxOCBAQCBpbnQgdmlydGlvX2dwdV9nZW1fb2JqZWN0X29wZW4oc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiB7CiAJc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2
Z2RldiA9IG9iai0+ZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3QgdmlydGlvX2dwdV9mcHJpdiAq
dmZwcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7Ci0Jc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpx
b2JqID0gZ2VtX3RvX3ZpcnRpb19ncHVfb2JqKG9iaik7Ci0JaW50IHI7CisJc3RydWN0IHZpcnRp
b19ncHVfb2JqZWN0X2FycmF5ICpvYmpzOwogCiAJaWYgKCF2Z2Rldi0+aGFzX3ZpcmdsXzNkKQog
CQlyZXR1cm4gMDsKIAotCXIgPSB2aXJ0aW9fZ3B1X29iamVjdF9yZXNlcnZlKHFvYmopOwotCWlm
IChyKQotCQlyZXR1cm4gcjsKKwlvYmpzID0gdmlydGlvX2dwdV9hcnJheV9hbGxvYygxKTsKKwlp
ZiAoIW9ianMpCisJCXJldHVybiAtRU5PTUVNOworCXZpcnRpb19ncHVfYXJyYXlfYWRkX29iaihv
YmpzLCBvYmopOwogCiAJdmlydGlvX2dwdV9jbWRfY29udGV4dF9hdHRhY2hfcmVzb3VyY2Uodmdk
ZXYsIHZmcHJpdi0+Y3R4X2lkLAotCQkJCQkgICAgICAgcW9iai0+aHdfcmVzX2hhbmRsZSk7Ci0J
dmlydGlvX2dwdV9vYmplY3RfdW5yZXNlcnZlKHFvYmopOworCQkJCQkgICAgICAgb2Jqcyk7CiAJ
cmV0dXJuIDA7CiB9CiAKQEAgLTEzMiwxOSArMTMxLDE4IEBAIHZvaWQgdmlydGlvX2dwdV9nZW1f
b2JqZWN0X2Nsb3NlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLAogewogCXN0cnVjdCB2aXJ0
aW9fZ3B1X2RldmljZSAqdmdkZXYgPSBvYmotPmRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IHZp
cnRpb19ncHVfZnByaXYgKnZmcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OwotCXN0cnVjdCB2aXJ0
aW9fZ3B1X29iamVjdCAqcW9iaiA9IGdlbV90b192aXJ0aW9fZ3B1X29iaihvYmopOwotCWludCBy
OworCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqczsKIAogCWlmICghdmdkZXYt
Pmhhc192aXJnbF8zZCkKIAkJcmV0dXJuOwogCi0JciA9IHZpcnRpb19ncHVfb2JqZWN0X3Jlc2Vy
dmUocW9iaik7Ci0JaWYgKHIpCisJb2JqcyA9IHZpcnRpb19ncHVfYXJyYXlfYWxsb2MoMSk7CisJ
aWYgKCFvYmpzKQogCQlyZXR1cm47CisJdmlydGlvX2dwdV9hcnJheV9hZGRfb2JqKG9ianMsIG9i
aik7CiAKIAl2aXJ0aW9fZ3B1X2NtZF9jb250ZXh0X2RldGFjaF9yZXNvdXJjZSh2Z2RldiwgdmZw
cml2LT5jdHhfaWQsCi0JCQkJCQlxb2JqLT5od19yZXNfaGFuZGxlKTsKLQl2aXJ0aW9fZ3B1X29i
amVjdF91bnJlc2VydmUocW9iaik7CisJCQkJCSAgICAgICBvYmpzKTsKIH0KIAogc3RydWN0IHZp
cnRpb19ncHVfb2JqZWN0X2FycmF5ICp2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKHUzMiBuZW50cykK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jIGIvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKaW5kZXggMWMwMDk3ZGU0MTlhLi43OTlkMTMz
OWVlMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCkBAIC04MzUsOCArODM1LDkg
QEAgdm9pZCB2aXJ0aW9fZ3B1X2NtZF9jb250ZXh0X2Rlc3Ryb3koc3RydWN0IHZpcnRpb19ncHVf
ZGV2aWNlICp2Z2RldiwKIAogdm9pZCB2aXJ0aW9fZ3B1X2NtZF9jb250ZXh0X2F0dGFjaF9yZXNv
dXJjZShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJCQkgICAgdWludDMyX3Qg
Y3R4X2lkLAotCQkJCQkgICAgdWludDMyX3QgcmVzb3VyY2VfaWQpCisJCQkJCSAgICBzdHJ1Y3Qg
dmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMpCiB7CisJc3RydWN0IHZpcnRpb19ncHVfb2Jq
ZWN0ICpibyA9IGdlbV90b192aXJ0aW9fZ3B1X29iaihvYmpzLT5vYmpzWzBdKTsKIAlzdHJ1Y3Qg
dmlydGlvX2dwdV9jdHhfcmVzb3VyY2UgKmNtZF9wOwogCXN0cnVjdCB2aXJ0aW9fZ3B1X3ZidWZm
ZXIgKnZidWY7CiAKQEAgLTg0NSwxNSArODQ2LDE2IEBAIHZvaWQgdmlydGlvX2dwdV9jbWRfY29u
dGV4dF9hdHRhY2hfcmVzb3VyY2Uoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKIAog
CWNtZF9wLT5oZHIudHlwZSA9IGNwdV90b19sZTMyKFZJUlRJT19HUFVfQ01EX0NUWF9BVFRBQ0hf
UkVTT1VSQ0UpOwogCWNtZF9wLT5oZHIuY3R4X2lkID0gY3B1X3RvX2xlMzIoY3R4X2lkKTsKLQlj
bWRfcC0+cmVzb3VyY2VfaWQgPSBjcHVfdG9fbGUzMihyZXNvdXJjZV9pZCk7CisJY21kX3AtPnJl
c291cmNlX2lkID0gY3B1X3RvX2xlMzIoYm8tPmh3X3Jlc19oYW5kbGUpOwogCXZpcnRpb19ncHVf
cXVldWVfY3RybF9idWZmZXIodmdkZXYsIHZidWYpOwogCiB9CiAKIHZvaWQgdmlydGlvX2dwdV9j
bWRfY29udGV4dF9kZXRhY2hfcmVzb3VyY2Uoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rl
diwKIAkJCQkJICAgIHVpbnQzMl90IGN0eF9pZCwKLQkJCQkJICAgIHVpbnQzMl90IHJlc291cmNl
X2lkKQorCQkJCQkgICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzKQogewor
CXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoob2Jq
cy0+b2Jqc1swXSk7CiAJc3RydWN0IHZpcnRpb19ncHVfY3R4X3Jlc291cmNlICpjbWRfcDsKIAlz
dHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVyICp2YnVmOwogCkBAIC04NjIsNyArODY0LDcgQEAgdm9p
ZCB2aXJ0aW9fZ3B1X2NtZF9jb250ZXh0X2RldGFjaF9yZXNvdXJjZShzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAogCiAJY21kX3AtPmhkci50eXBlID0gY3B1X3RvX2xlMzIoVklSVElP
X0dQVV9DTURfQ1RYX0RFVEFDSF9SRVNPVVJDRSk7CiAJY21kX3AtPmhkci5jdHhfaWQgPSBjcHVf
dG9fbGUzMihjdHhfaWQpOwotCWNtZF9wLT5yZXNvdXJjZV9pZCA9IGNwdV90b19sZTMyKHJlc291
cmNlX2lkKTsKKwljbWRfcC0+cmVzb3VyY2VfaWQgPSBjcHVfdG9fbGUzMihiby0+aHdfcmVzX2hh
bmRsZSk7CiAJdmlydGlvX2dwdV9xdWV1ZV9jdHJsX2J1ZmZlcih2Z2RldiwgdmJ1Zik7CiB9CiAK
LS0gCjIuMTguMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
