Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 902FF33FA0
	for <lists+dri-devel@lfdr.de>; Tue,  4 Jun 2019 09:14:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EEDD1895F5;
	Tue,  4 Jun 2019 07:14:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from crapouillou.net (outils.crapouillou.net [89.234.176.41])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A390689291
 for <dri-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 15:23:54 +0000 (UTC)
From: Paul Cercueil <paul@crapouillou.net>
To: David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Sam Ravnborg <sam@ravnborg.org>, Rob Herring <robh+dt@kernel.org>,
 Mark Rutland <mark.rutland@arm.com>,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>
Subject: [PATCH v5 2/2] DRM: Add KMS driver for the Ingenic JZ47xx SoCs
Date: Mon,  3 Jun 2019 17:23:31 +0200
Message-Id: <20190603152331.23160-2-paul@crapouillou.net>
In-Reply-To: <20190603152331.23160-1-paul@crapouillou.net>
References: <20190603152331.23160-1-paul@crapouillou.net>
MIME-Version: 1.0
X-Mailman-Approved-At: Tue, 04 Jun 2019 07:14:23 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=crapouillou.net; 
 s=mail; t=1559575432; h=from:from:sender:reply-to:subject:subject:date:date:
 message-id:message-id:to:to:cc:cc:mime-version:mime-version:
 content-type:content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=LUufLZURUGbS0hb3wXpeo1rp+sY2bisBQCAGnZE4nl8=;
 b=wbedh3wwNk6lmiVONWf77tmdFmcNYiry3XSkkxBjMjTC0ibRejuS3zH8jQGf+jlHyKzQ4y
 Wzy4SYnAYG8cjIe00NxmLT9Fct8wphaC8ngYxsgLDSNNL0ARSTaZzzcTztFWB4SvvBEsBd
 BbZR+wRBDaAD32wSQm8dLgODKbll92Q=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, Artur Rojek <contact@artur-rojek.eu>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Paul Cercueil <paul@crapouillou.net>, od@zcrc.me
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGEgS01TIGRyaXZlciBmb3IgdGhlIEluZ2VuaWMgSlo0N3h4IGZhbWlseSBvZiBTb0NzLgpU
aGlzIGRyaXZlciBpcyBtZWFudCB0byByZXBsYWNlIHRoZSBhZ2luZyBqejQ3NDAtZmIgZHJpdmVy
LgoKVGhpcyBkcml2ZXIgZG9lcyBub3QgbWFrZSB1c2Ugb2YgdGhlIHNpbXBsZSBwaXBlIGhlbHBl
ciwgZm9yIHRoZSByZWFzb24KdGhhdCBpdCB3aWxsIHNvb24gYmUgdXBkYXRlZCB0byBzdXBwb3J0
IG1vcmUgYWR2YW5jZWQgZmVhdHVyZXMgbGlrZQptdWx0aXBsZSBwbGFuZXMsIElQVSBpbnRlZ3Jh
dGlvbiBmb3IgY29sb3JzcGFjZSBjb252ZXJzaW9uIGFuZCB1cC9kb3duCnNjYWxpbmcsIHN1cHBv
cnQgZm9yIERTSSBkaXNwbGF5cywgYW5kIFRWLW91dCBhbmQgSERNSSBvdXRwdXRzLgoKU2lnbmVk
LW9mZi1ieTogUGF1bCBDZXJjdWVpbCA8cGF1bEBjcmFwb3VpbGxvdS5uZXQ+ClRlc3RlZC1ieTog
QXJ0dXIgUm9qZWsgPGNvbnRhY3RAYXJ0dXItcm9qZWsuZXU+Ci0tLQoKTm90ZXM6CiAgICB2Mjog
LSBSZW1vdmUgY3VzdG9tIGhhbmRsaW5nIG9mIHBhbmVsLiBUaGUgcGFuZWwgaXMgbm93IGRpc2Nv
dmVyZWQgdXNpbmcKICAgIAkgIHRoZSBzdGFuZGFyZCBBUEkuCiAgICAJLSBMb3RzIG9mIHNtYWxs
IHR3ZWFrcyBzdWdnZXN0ZWQgYnkgdXBzdHJlYW0KICAgIAogICAgdjM6IC0gVXNlIGRldm1fZHJt
X2Rldl9pbml0KCkKICAgIAktIFVwZGF0ZSBjb21wYXRpYmxlIHN0cmluZ3MgdG8gLWxjZCBpbnN0
ZWFkIG9mIC1kcm0KICAgIAktIEFkZCBkZXN0cm95KCkgY2FsbGJhY2tzIHRvIHBsYW5lIGFuZCBj
cnRjCiAgICAJLSBUaGUgaW5nZW5pYyxsY2QtbW9kZSBpcyBub3cgcmVhZCBmcm9tIHRoZSBicmlk
Z2UncyBEVCBub2RlCiAgICAKICAgIHY0OiBSZW1vdmUgaW5nZW5pYyxsY2QtbW9kZSBwcm9wZXJ0
eSBjb21wbGV0ZWx5LiBUaGUgdmFyaW91cyBtb2RlcyBhcmUgbm93CiAgICAJZGVkdWNlZCBmcm9t
IHRoZSBjb25uZWN0b3IgdHlwZSwgdGhlIHBpeGVsIGZvcm1hdCBvciB0aGUgYnVzIGZsYWdzLgog
ICAgCiAgICB2NTogLSBGaXggZnJhbWVidWZmZXIgc2l6ZSBpbmNvcnJlY3RseSBjYWxjdWxhdGVk
IGZvciAyNGJwcCBmcmFtZWJ1ZmZlcnMKICAgIAktIFVzZSAzMmJwcCBmcmFtZWJ1ZmZlciBpbnN0
ZWFkIG9mIDE2YnBwLCBhcyBpdCdsbCB3b3JrIHdpdGggYm90aAogICAgCSAgMTYtYml0IGFuZCAy
NC1iaXQgcGFuZWwKICAgIAktIEdldCByaWQgb2YgZHJtX2Zvcm1hdF9wbGFuZV9jcHAoKSB3aGlj
aCBoYXMgYmVlbiBkcm9wcGVkIHVwc3RyZWFtCiAgICAJLSBBdm9pZCB1c2luZyBkcm1fZm9ybWF0
X2luZm8tPmRlcHRoLCB3aGljaCBpcyBkZXByZWNhdGVkLgoKIGRyaXZlcnMvZ3B1L2RybS9LY29u
ZmlnICAgICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlICAgICAg
ICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaW5nZW5pYy9LY29uZmlnICAgICAgIHwg
IDE2ICsKIGRyaXZlcnMvZ3B1L2RybS9pbmdlbmljL01ha2VmaWxlICAgICAgfCAgIDEgKwogZHJp
dmVycy9ncHUvZHJtL2luZ2VuaWMvaW5nZW5pYy1kcm0uYyB8IDgxOCArKysrKysrKysrKysrKysr
KysrKysrKysrKwogNSBmaWxlcyBjaGFuZ2VkLCA4MzggaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbmdlbmljL0tjb25maWcKIGNyZWF0ZSBtb2RlIDEw
MDY0NCBkcml2ZXJzL2dwdS9kcm0vaW5nZW5pYy9NYWtlZmlsZQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9pbmdlbmljL2luZ2VuaWMtZHJtLmMKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCmluZGV4IDZiMzQ5
NDk0MTZiMS4uYjkzNjJiNGY2MzUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZp
ZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZwpAQCAtMzE2LDYgKzMxNiw4IEBAIHNvdXJj
ZSAiZHJpdmVycy9ncHUvZHJtL3N0aS9LY29uZmlnIgogCiBzb3VyY2UgImRyaXZlcnMvZ3B1L2Ry
bS9pbXgvS2NvbmZpZyIKIAorc291cmNlICJkcml2ZXJzL2dwdS9kcm0vaW5nZW5pYy9LY29uZmln
IgorCiBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS92M2QvS2NvbmZpZyIKIAogc291cmNlICJkcml2
ZXJzL2dwdS9kcm0vdmM0L0tjb25maWciCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vTWFr
ZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUKaW5kZXggNGE2M2MxZmNmMzg5Li43MzUz
OGRkZTQ3ZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vTWFrZWZpbGUKQEAgLTk5LDYgKzk5LDcgQEAgb2JqLSQoQ09ORklHX0RSTV9U
RUdSQSkgKz0gdGVncmEvCiBvYmotJChDT05GSUdfRFJNX1NUTSkgKz0gc3RtLwogb2JqLSQoQ09O
RklHX0RSTV9TVEkpICs9IHN0aS8KIG9iai0kKENPTkZJR19EUk1fSU1YKSArPSBpbXgvCitvYmot
JChDT05GSUdfRFJNX0lOR0VOSUMpICs9IGluZ2VuaWMvCiBvYmotJChDT05GSUdfRFJNX01FRElB
VEVLKSArPSBtZWRpYXRlay8KIG9iai0kKENPTkZJR19EUk1fTUVTT04pCSs9IG1lc29uLwogb2Jq
LXkJCQkrPSBpMmMvCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW5nZW5pYy9LY29uZmln
IGIvZHJpdmVycy9ncHUvZHJtL2luZ2VuaWMvS2NvbmZpZwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmQ4MmMzZDM3ZWM5YwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pbmdlbmljL0tjb25maWcKQEAgLTAsMCArMSwxNiBAQAorY29uZmlnIERSTV9J
TkdFTklDCisJdHJpc3RhdGUgIkRSTSBTdXBwb3J0IGZvciBJbmdlbmljIFNvQ3MiCisJZGVwZW5k
cyBvbiBNSVBTIHx8IENPTVBJTEVfVEVTVAorCWRlcGVuZHMgb24gRFJNCisJZGVwZW5kcyBvbiBD
TUEKKwlkZXBlbmRzIG9uIE9GCisJc2VsZWN0IERSTV9CUklER0UKKwlzZWxlY3QgRFJNX1BBTkVM
X0JSSURHRQorCXNlbGVjdCBEUk1fS01TX0hFTFBFUgorCXNlbGVjdCBEUk1fS01TX0NNQV9IRUxQ
RVIKKwlzZWxlY3QgRFJNX0dFTV9DTUFfSEVMUEVSCisJc2VsZWN0IFZUX0hXX0NPTlNPTEVfQklO
RElORyBpZiBGUkFNRUJVRkZFUl9DT05TT0xFCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgb3B0aW9u
IGZvciBEUk0gc3VwcG9ydCBmb3IgdGhlIEluZ2VuaWMgU29Dcy4KKworCSAgSWYgTSBpcyBzZWxl
Y3RlZCB0aGUgbW9kdWxlIHdpbGwgYmUgY2FsbGVkIGluZ2VuaWMtZHJtLgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2luZ2VuaWMvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaW5nZW5p
Yy9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjExY2Fj
NDJjZTBiYgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbmdlbmljL01ha2Vm
aWxlCkBAIC0wLDAgKzEgQEAKK29iai0kKENPTkZJR19EUk1fSU5HRU5JQykgKz0gaW5nZW5pYy1k
cm0ubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2luZ2VuaWMvaW5nZW5pYy1kcm0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pbmdlbmljL2luZ2VuaWMtZHJtLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4wMDZjZTZiMDEyZjUKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaW5nZW5pYy9pbmdlbmljLWRybS5jCkBAIC0wLDAgKzEsODE4IEBACisv
LyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLy8KKy8vIEluZ2VuaWMgSlo0N3h4
IEtNUyBkcml2ZXIKKy8vCisvLyBDb3B5cmlnaHQgKEMpIDIwMTksIFBhdWwgQ2VyY3VlaWwgPHBh
dWxAY3JhcG91aWxsb3UubmV0PgorCisjaW5jbHVkZSA8bGludXgvY2xrLmg+CisjaW5jbHVkZSA8
bGludXgvZG1hLW1hcHBpbmcuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRl
IDxsaW51eC9vZl9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4K
KyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9j
cnRjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jcnRjX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9k
cm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fY21hX2hlbHBlci5oPgorI2luY2x1ZGUg
PGRybS9kcm1fZmJfY21hX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmJfaGVscGVyLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFt
ZWJ1ZmZlcl9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2lycS5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fb2YuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3BhbmVsLmg+CisjaW5jbHVkZSA8ZHJtL2Ry
bV9wbGFuZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgorCisj
ZGVmaW5lIEpaX1JFR19MQ0RfQ0ZHCQkJCTB4MDAKKyNkZWZpbmUgSlpfUkVHX0xDRF9WU1lOQwkJ
CTB4MDQKKyNkZWZpbmUgSlpfUkVHX0xDRF9IU1lOQwkJCTB4MDgKKyNkZWZpbmUgSlpfUkVHX0xD
RF9WQVQJCQkJMHgwQworI2RlZmluZSBKWl9SRUdfTENEX0RBSAkJCQkweDEwCisjZGVmaW5lIEpa
X1JFR19MQ0RfREFWCQkJCTB4MTQKKyNkZWZpbmUgSlpfUkVHX0xDRF9QUwkJCQkweDE4CisjZGVm
aW5lIEpaX1JFR19MQ0RfQ0xTCQkJCTB4MUMKKyNkZWZpbmUgSlpfUkVHX0xDRF9TUEwJCQkJMHgy
MAorI2RlZmluZSBKWl9SRUdfTENEX1JFVgkJCQkweDI0CisjZGVmaW5lIEpaX1JFR19MQ0RfQ1RS
TAkJCQkweDMwCisjZGVmaW5lIEpaX1JFR19MQ0RfU1RBVEUJCQkweDM0CisjZGVmaW5lIEpaX1JF
R19MQ0RfSUlECQkJCTB4MzgKKyNkZWZpbmUgSlpfUkVHX0xDRF9EQTAJCQkJMHg0MAorI2RlZmlu
ZSBKWl9SRUdfTENEX1NBMAkJCQkweDQ0CisjZGVmaW5lIEpaX1JFR19MQ0RfRklEMAkJCQkweDQ4
CisjZGVmaW5lIEpaX1JFR19MQ0RfQ01EMAkJCQkweDRDCisjZGVmaW5lIEpaX1JFR19MQ0RfREEx
CQkJCTB4NTAKKyNkZWZpbmUgSlpfUkVHX0xDRF9TQTEJCQkJMHg1NAorI2RlZmluZSBKWl9SRUdf
TENEX0ZJRDEJCQkJMHg1OAorI2RlZmluZSBKWl9SRUdfTENEX0NNRDEJCQkJMHg1QworCisjZGVm
aW5lIEpaX0xDRF9DRkdfU0xDRAkJCQlCSVQoMzEpCisjZGVmaW5lIEpaX0xDRF9DRkdfUFNfRElT
QUJMRQkJCUJJVCgyMykKKyNkZWZpbmUgSlpfTENEX0NGR19DTFNfRElTQUJMRQkJCUJJVCgyMikK
KyNkZWZpbmUgSlpfTENEX0NGR19TUExfRElTQUJMRQkJCUJJVCgyMSkKKyNkZWZpbmUgSlpfTENE
X0NGR19SRVZfRElTQUJMRQkJCUJJVCgyMCkKKyNkZWZpbmUgSlpfTENEX0NGR19IU1lOQ00JCQlC
SVQoMTkpCisjZGVmaW5lIEpaX0xDRF9DRkdfUENMS00JCQlCSVQoMTgpCisjZGVmaW5lIEpaX0xD
RF9DRkdfSU5WCQkJCUJJVCgxNykKKyNkZWZpbmUgSlpfTENEX0NGR19TWU5DX0RJUgkJCUJJVCgx
NikKKyNkZWZpbmUgSlpfTENEX0NGR19QU19QT0xBUklUWQkJCUJJVCgxNSkKKyNkZWZpbmUgSlpf
TENEX0NGR19DTFNfUE9MQVJJVFkJCQlCSVQoMTQpCisjZGVmaW5lIEpaX0xDRF9DRkdfU1BMX1BP
TEFSSVRZCQkJQklUKDEzKQorI2RlZmluZSBKWl9MQ0RfQ0ZHX1JFVl9QT0xBUklUWQkJCUJJVCgx
MikKKyNkZWZpbmUgSlpfTENEX0NGR19IU1lOQ19BQ1RJVkVfTE9XCQlCSVQoMTEpCisjZGVmaW5l
IEpaX0xDRF9DRkdfUENMS19GQUxMSU5HX0VER0UJCUJJVCgxMCkKKyNkZWZpbmUgSlpfTENEX0NG
R19ERV9BQ1RJVkVfTE9XCQlCSVQoOSkKKyNkZWZpbmUgSlpfTENEX0NGR19WU1lOQ19BQ1RJVkVf
TE9XCQlCSVQoOCkKKyNkZWZpbmUgSlpfTENEX0NGR18xOF9CSVQJCQlCSVQoNykKKyNkZWZpbmUg
SlpfTENEX0NGR19QRFcJCQkJKEJJVCg1KSB8IEJJVCg0KSkKKworI2RlZmluZSBKWl9MQ0RfQ0ZH
X01PREVfR0VORVJJQ18xNkJJVAkJMAorI2RlZmluZSBKWl9MQ0RfQ0ZHX01PREVfR0VORVJJQ18x
OEJJVAkJQklUKDcpCisjZGVmaW5lIEpaX0xDRF9DRkdfTU9ERV9HRU5FUklDXzI0QklUCQlCSVQo
NikKKworI2RlZmluZSBKWl9MQ0RfQ0ZHX01PREVfU1BFQ0lBTF9URlRfMQkJMQorI2RlZmluZSBK
Wl9MQ0RfQ0ZHX01PREVfU1BFQ0lBTF9URlRfMgkJMgorI2RlZmluZSBKWl9MQ0RfQ0ZHX01PREVf
U1BFQ0lBTF9URlRfMwkJMworCisjZGVmaW5lIEpaX0xDRF9DRkdfTU9ERV9UVl9PVVRfUAkJNAor
I2RlZmluZSBKWl9MQ0RfQ0ZHX01PREVfVFZfT1VUX0kJCTYKKworI2RlZmluZSBKWl9MQ0RfQ0ZH
X01PREVfU0lOR0xFX0NPTE9SX1NUTgk4CisjZGVmaW5lIEpaX0xDRF9DRkdfTU9ERV9TSU5HTEVf
TU9OT0NIUk9NRV9TVE4JOQorI2RlZmluZSBKWl9MQ0RfQ0ZHX01PREVfRFVBTF9DT0xPUl9TVE4J
CTEwCisjZGVmaW5lIEpaX0xDRF9DRkdfTU9ERV9EVUFMX01PTk9DSFJPTUVfU1ROCTExCisKKyNk
ZWZpbmUgSlpfTENEX0NGR19NT0RFXzhCSVRfU0VSSUFMCQkxMgorI2RlZmluZSBKWl9MQ0RfQ0ZH
X01PREVfTENNCQkJMTMKKworI2RlZmluZSBKWl9MQ0RfVlNZTkNfVlBTX09GRlNFVAkJCTE2Cisj
ZGVmaW5lIEpaX0xDRF9WU1lOQ19WUEVfT0ZGU0VUCQkJMAorCisjZGVmaW5lIEpaX0xDRF9IU1lO
Q19IUFNfT0ZGU0VUCQkJMTYKKyNkZWZpbmUgSlpfTENEX0hTWU5DX0hQRV9PRkZTRVQJCQkwCisK
KyNkZWZpbmUgSlpfTENEX1ZBVF9IVF9PRkZTRVQJCQkxNgorI2RlZmluZSBKWl9MQ0RfVkFUX1ZU
X09GRlNFVAkJCTAKKworI2RlZmluZSBKWl9MQ0RfREFIX0hEU19PRkZTRVQJCQkxNgorI2RlZmlu
ZSBKWl9MQ0RfREFIX0hERV9PRkZTRVQJCQkwCisKKyNkZWZpbmUgSlpfTENEX0RBVl9WRFNfT0ZG
U0VUCQkJMTYKKyNkZWZpbmUgSlpfTENEX0RBVl9WREVfT0ZGU0VUCQkJMAorCisjZGVmaW5lIEpa
X0xDRF9DVFJMX0JVUlNUXzQJCQkoMHgwIDw8IDI4KQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9CVVJT
VF84CQkJKDB4MSA8PCAyOCkKKyNkZWZpbmUgSlpfTENEX0NUUkxfQlVSU1RfMTYJCQkoMHgyIDw8
IDI4KQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9SR0I1NTUJCQlCSVQoMjcpCisjZGVmaW5lIEpaX0xD
RF9DVFJMX09GVVAJCQlCSVQoMjYpCisjZGVmaW5lIEpaX0xDRF9DVFJMX0ZSQ19HUkFZU0NBTEVf
MTYJCSgweDAgPDwgMjQpCisjZGVmaW5lIEpaX0xDRF9DVFJMX0ZSQ19HUkFZU0NBTEVfNAkJKDB4
MSA8PCAyNCkKKyNkZWZpbmUgSlpfTENEX0NUUkxfRlJDX0dSQVlTQ0FMRV8yCQkoMHgyIDw8IDI0
KQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9QRERfTUFTSwkJCSgweGZmIDw8IDE2KQorI2RlZmluZSBK
Wl9MQ0RfQ1RSTF9FT0ZfSVJRCQkJQklUKDEzKQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9TT0ZfSVJR
CQkJQklUKDEyKQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9PRlVfSVJRCQkJQklUKDExKQorI2RlZmlu
ZSBKWl9MQ0RfQ1RSTF9JRlUwX0lSUQkJCUJJVCgxMCkKKyNkZWZpbmUgSlpfTENEX0NUUkxfSUZV
MV9JUlEJCQlCSVQoOSkKKyNkZWZpbmUgSlpfTENEX0NUUkxfRERfSVJRCQkJQklUKDgpCisjZGVm
aW5lIEpaX0xDRF9DVFJMX1FERF9JUlEJCQlCSVQoNykKKyNkZWZpbmUgSlpfTENEX0NUUkxfUkVW
RVJTRV9FTkRJQU4JCUJJVCg2KQorI2RlZmluZSBKWl9MQ0RfQ1RSTF9MU0JfRklTUlQJCQlCSVQo
NSkKKyNkZWZpbmUgSlpfTENEX0NUUkxfRElTQUJMRQkJCUJJVCg0KQorI2RlZmluZSBKWl9MQ0Rf
Q1RSTF9FTkFCTEUJCQlCSVQoMykKKyNkZWZpbmUgSlpfTENEX0NUUkxfQlBQXzEJCQkweDAKKyNk
ZWZpbmUgSlpfTENEX0NUUkxfQlBQXzIJCQkweDEKKyNkZWZpbmUgSlpfTENEX0NUUkxfQlBQXzQJ
CQkweDIKKyNkZWZpbmUgSlpfTENEX0NUUkxfQlBQXzgJCQkweDMKKyNkZWZpbmUgSlpfTENEX0NU
UkxfQlBQXzE1XzE2CQkJMHg0CisjZGVmaW5lIEpaX0xDRF9DVFJMX0JQUF8xOF8yNAkJCTB4NQor
I2RlZmluZSBKWl9MQ0RfQ1RSTF9CUFBfTUFTSwkJCShKWl9MQ0RfQ1RSTF9SR0I1NTUgfCAoMHg3
IDw8IDApKQorCisjZGVmaW5lIEpaX0xDRF9DTURfU09GX0lSUQkJCUJJVCgzMSkKKyNkZWZpbmUg
SlpfTENEX0NNRF9FT0ZfSVJRCQkJQklUKDMwKQorI2RlZmluZSBKWl9MQ0RfQ01EX0VOQUJMRV9Q
QUwJCQlCSVQoMjgpCisKKyNkZWZpbmUgSlpfTENEX1NZTkNfTUFTSwkJCTB4M2ZmCisKKyNkZWZp
bmUgSlpfTENEX1NUQVRFX0VPRl9JUlEJCQlCSVQoNSkKKyNkZWZpbmUgSlpfTENEX1NUQVRFX1NP
Rl9JUlEJCQlCSVQoNCkKKyNkZWZpbmUgSlpfTENEX1NUQVRFX0RJU0FCTEVECQkJQklUKDApCisK
K3N0cnVjdCBpbmdlbmljX2RtYV9od2Rlc2MgeworCXUzMiBuZXh0OworCXUzMiBhZGRyOworCXUz
MiBpZDsKKwl1MzIgY21kOworfSBfX3BhY2tlZDsKKworc3RydWN0IGp6X3NvY19pbmZvIHsKKwli
b29sIG5lZWRzX2Rldl9jbGs7Cit9OworCitzdHJ1Y3QgaW5nZW5pY19kcm0geworCXN0cnVjdCBk
cm1fZGV2aWNlIGRybTsKKwlzdHJ1Y3QgZHJtX3BsYW5lIHByaW1hcnk7CisJc3RydWN0IGRybV9j
cnRjIGNydGM7CisJc3RydWN0IGRybV9lbmNvZGVyIGVuY29kZXI7CisKKwlzdHJ1Y3QgZGV2aWNl
ICpkZXY7CisJc3RydWN0IHJlZ21hcCAqbWFwOworCXN0cnVjdCBjbGsgKmxjZF9jbGssICpwaXhf
Y2xrOworCisJc3RydWN0IGluZ2VuaWNfZG1hX2h3ZGVzYyAqZG1hX2h3ZGVzYzsKKwlkbWFfYWRk
cl90IGRtYV9od2Rlc2NfcGh5czsKK307CisKK3N0YXRpYyBjb25zdCB1MzIgaW5nZW5pY19kcm1f
cHJpbWFyeV9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9YUkdCMTU1NSwKKwlEUk1fRk9STUFU
X1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorfTsKKworc3RhdGljIGJvb2wgaW5nZW5p
Y19kcm1fd3JpdGVhYmxlX3JlZyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCByZWcp
Cit7CisJc3dpdGNoIChyZWcpIHsKKwljYXNlIEpaX1JFR19MQ0RfSUlEOgorCWNhc2UgSlpfUkVH
X0xDRF9TQTA6CisJY2FzZSBKWl9SRUdfTENEX0ZJRDA6CisJY2FzZSBKWl9SRUdfTENEX0NNRDA6
CisJY2FzZSBKWl9SRUdfTENEX1NBMToKKwljYXNlIEpaX1JFR19MQ0RfRklEMToKKwljYXNlIEpa
X1JFR19MQ0RfQ01EMToKKwkJcmV0dXJuIGZhbHNlOworCWRlZmF1bHQ6CisJCXJldHVybiB0cnVl
OworCX0KK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCByZWdtYXBfY29uZmlnIGluZ2VuaWNfZHJt
X3JlZ21hcF9jb25maWcgPSB7CisJLnJlZ19iaXRzID0gMzIsCisJLnZhbF9iaXRzID0gMzIsCisJ
LnJlZ19zdHJpZGUgPSA0LAorCisJLm1heF9yZWdpc3RlciA9IEpaX1JFR19MQ0RfQ01EMSwKKwku
d3JpdGVhYmxlX3JlZyA9IGluZ2VuaWNfZHJtX3dyaXRlYWJsZV9yZWcsCit9OworCitzdGF0aWMg
aW5saW5lIHN0cnVjdCBpbmdlbmljX2RybSAqZHJtX2RldmljZV9nZXRfcHJpdihzdHJ1Y3QgZHJt
X2RldmljZSAqZHJtKQoreworCXJldHVybiBjb250YWluZXJfb2YoZHJtLCBzdHJ1Y3QgaW5nZW5p
Y19kcm0sIGRybSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGluZ2VuaWNfZHJtICpkcm1f
Y3J0Y19nZXRfcHJpdihzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCit7CisJcmV0dXJuIGNvbnRhaW5l
cl9vZihjcnRjLCBzdHJ1Y3QgaW5nZW5pY19kcm0sIGNydGMpOworfQorCitzdGF0aWMgaW5saW5l
IHN0cnVjdCBpbmdlbmljX2RybSAqCitkcm1fZW5jb2Rlcl9nZXRfcHJpdihzdHJ1Y3QgZHJtX2Vu
Y29kZXIgKmVuY29kZXIpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihlbmNvZGVyLCBzdHJ1Y3Qg
aW5nZW5pY19kcm0sIGVuY29kZXIpOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpbmdlbmlj
X2RybSAqZHJtX3BsYW5lX2dldF9wcml2KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKQoreworCXJl
dHVybiBjb250YWluZXJfb2YocGxhbmUsIHN0cnVjdCBpbmdlbmljX2RybSwgcHJpbWFyeSk7Cit9
CisKK3N0YXRpYyB2b2lkIGluZ2VuaWNfZHJtX2NydGNfYXRvbWljX2VuYWJsZShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCisJCQkJCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKK3sKKwlz
dHJ1Y3QgaW5nZW5pY19kcm0gKnByaXYgPSBkcm1fY3J0Y19nZXRfcHJpdihjcnRjKTsKKworCXJl
Z21hcF93cml0ZShwcml2LT5tYXAsIEpaX1JFR19MQ0RfU1RBVEUsIDApOworCisJcmVnbWFwX3Vw
ZGF0ZV9iaXRzKHByaXYtPm1hcCwgSlpfUkVHX0xDRF9DVFJMLAorCQkJICAgSlpfTENEX0NUUkxf
RU5BQkxFIHwgSlpfTENEX0NUUkxfRElTQUJMRSwKKwkJCSAgIEpaX0xDRF9DVFJMX0VOQUJMRSk7
CisKKwlkcm1fY3J0Y192Ymxhbmtfb24oY3J0Yyk7Cit9CisKK3N0YXRpYyB2b2lkIGluZ2VuaWNf
ZHJtX2NydGNfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCQkgICBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbmdlbmljX2RybSAqcHJp
diA9IGRybV9jcnRjX2dldF9wcml2KGNydGMpOworCXVuc2lnbmVkIGludCB2YXI7CisKKwlkcm1f
Y3J0Y192Ymxhbmtfb2ZmKGNydGMpOworCisJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPm1hcCwg
SlpfUkVHX0xDRF9DVFJMLAorCQkJICAgSlpfTENEX0NUUkxfRElTQUJMRSwgSlpfTENEX0NUUkxf
RElTQUJMRSk7CisKKwlyZWdtYXBfcmVhZF9wb2xsX3RpbWVvdXQocHJpdi0+bWFwLCBKWl9SRUdf
TENEX1NUQVRFLCB2YXIsCisJCQkJIHZhciAmIEpaX0xDRF9TVEFURV9ESVNBQkxFRCwKKwkJCQkg
MTAwMCwgMCk7Cit9CisKK3N0YXRpYyB2b2lkIGluZ2VuaWNfZHJtX2NydGNfdXBkYXRlX3RpbWlu
Z3Moc3RydWN0IGluZ2VuaWNfZHJtICpwcml2LAorCQkJCQkgICAgc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKm1vZGUpCit7CisJdW5zaWduZWQgaW50IHZwZSwgdmRzLCB2ZGUsIHZ0LCBocGUsIGhk
cywgaGRlLCBodDsKKworCXZwZSA9IG1vZGUtPnZzeW5jX2VuZCAtIG1vZGUtPnZzeW5jX3N0YXJ0
OworCXZkcyA9IG1vZGUtPnZ0b3RhbCAtIG1vZGUtPnZzeW5jX3N0YXJ0OworCXZkZSA9IHZkcyAr
IG1vZGUtPnZkaXNwbGF5OworCXZ0ID0gdmRlICsgbW9kZS0+dnN5bmNfc3RhcnQgLSBtb2RlLT52
ZGlzcGxheTsKKworCWhwZSA9IG1vZGUtPmhzeW5jX2VuZCAtIG1vZGUtPmhzeW5jX3N0YXJ0Owor
CWhkcyA9IG1vZGUtPmh0b3RhbCAtIG1vZGUtPmhzeW5jX3N0YXJ0OworCWhkZSA9IGhkcyArIG1v
ZGUtPmhkaXNwbGF5OworCWh0ID0gaGRlICsgbW9kZS0+aHN5bmNfc3RhcnQgLSBtb2RlLT5oZGlz
cGxheTsKKworCXJlZ21hcF93cml0ZShwcml2LT5tYXAsIEpaX1JFR19MQ0RfVlNZTkMsCisJCSAg
ICAgMCA8PCBKWl9MQ0RfVlNZTkNfVlBTX09GRlNFVCB8CisJCSAgICAgdnBlIDw8IEpaX0xDRF9W
U1lOQ19WUEVfT0ZGU0VUKTsKKworCXJlZ21hcF93cml0ZShwcml2LT5tYXAsIEpaX1JFR19MQ0Rf
SFNZTkMsCisJCSAgICAgMCA8PCBKWl9MQ0RfSFNZTkNfSFBTX09GRlNFVCB8CisJCSAgICAgaHBl
IDw8IEpaX0xDRF9IU1lOQ19IUEVfT0ZGU0VUKTsKKworCXJlZ21hcF93cml0ZShwcml2LT5tYXAs
IEpaX1JFR19MQ0RfVkFULAorCQkgICAgIGh0IDw8IEpaX0xDRF9WQVRfSFRfT0ZGU0VUIHwKKwkJ
ICAgICB2dCA8PCBKWl9MQ0RfVkFUX1ZUX09GRlNFVCk7CisKKwlyZWdtYXBfd3JpdGUocHJpdi0+
bWFwLCBKWl9SRUdfTENEX0RBSCwKKwkJICAgICBoZHMgPDwgSlpfTENEX0RBSF9IRFNfT0ZGU0VU
IHwKKwkJICAgICBoZGUgPDwgSlpfTENEX0RBSF9IREVfT0ZGU0VUKTsKKwlyZWdtYXBfd3JpdGUo
cHJpdi0+bWFwLCBKWl9SRUdfTENEX0RBViwKKwkJICAgICB2ZHMgPDwgSlpfTENEX0RBVl9WRFNf
T0ZGU0VUIHwKKwkJICAgICB2ZGUgPDwgSlpfTENEX0RBVl9WREVfT0ZGU0VUKTsKK30KKworc3Rh
dGljIHZvaWQgaW5nZW5pY19kcm1fY3J0Y191cGRhdGVfY3RybChzdHJ1Y3QgaW5nZW5pY19kcm0g
KnByaXYsCisJCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmaW5mbykKK3sKKwl1
bnNpZ25lZCBpbnQgY3RybCA9IEpaX0xDRF9DVFJMX09GVVAgfCBKWl9MQ0RfQ1RSTF9CVVJTVF8x
NjsKKworCXN3aXRjaCAoZmluZm8tPmZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTU1
NToKKwkJY3RybCB8PSBKWl9MQ0RfQ1RSTF9SR0I1NTU7CisJCS8qIGZhbGwtdGhyb3VnaCAqLwor
CWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CisJCWN0cmwgfD0gSlpfTENEX0NUUkxfQlBQXzE1XzE2
OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJCWN0cmwgfD0gSlpfTENE
X0NUUkxfQlBQXzE4XzI0OworCQlicmVhazsKKwl9CisKKwlyZWdtYXBfdXBkYXRlX2JpdHMocHJp
di0+bWFwLCBKWl9SRUdfTENEX0NUUkwsCisJCQkgICBKWl9MQ0RfQ1RSTF9PRlVQIHwgSlpfTENE
X0NUUkxfQlVSU1RfMTYgfAorCQkJICAgSlpfTENEX0NUUkxfQlBQX01BU0ssIGN0cmwpOworfQor
CitzdGF0aWMgaW50IGluZ2VuaWNfZHJtX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKKwkJCQkJIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGluZ2VuaWNfZHJtICpwcml2ID0gZHJtX2NydGNfZ2V0X3ByaXYoY3J0Yyk7CisJbG9uZyByYXRl
OworCisJaWYgKCFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChzdGF0ZSkpCisJCXJldHVy
biAwOworCisJcmF0ZSA9IGNsa19yb3VuZF9yYXRlKHByaXYtPnBpeF9jbGssCisJCQkgICAgICBz
dGF0ZS0+YWRqdXN0ZWRfbW9kZS5jbG9jayAqIDEwMDApOworCWlmIChyYXRlIDwgMCkKKwkJcmV0
dXJuIHJhdGU7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaW5nZW5pY19kcm1fY3J0
Y19hdG9taWNfZmx1c2goc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCQkgIHN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqb2xkc3RhdGUpCit7CisJc3RydWN0IGluZ2VuaWNfZHJtICpwcml2ID0gZHJt
X2NydGNfZ2V0X3ByaXYoY3J0Yyk7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSA9IGNy
dGMtPnN0YXRlOworCXN0cnVjdCBkcm1fcGVuZGluZ192YmxhbmtfZXZlbnQgKmV2ZW50ID0gc3Rh
dGUtPmV2ZW50OworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmRybV9mYiA9IGNydGMtPnByaW1h
cnktPnN0YXRlLT5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmaW5mbzsKKwor
CWlmIChkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChzdGF0ZSkpIHsKKwkJZmluZm8gPSBk
cm1fZm9ybWF0X2luZm8oZHJtX2ZiLT5mb3JtYXQtPmZvcm1hdCk7CisKKwkJaW5nZW5pY19kcm1f
Y3J0Y191cGRhdGVfdGltaW5ncyhwcml2LCAmc3RhdGUtPm1vZGUpOworCQlpbmdlbmljX2RybV9j
cnRjX3VwZGF0ZV9jdHJsKHByaXYsIGZpbmZvKTsKKworCQljbGtfc2V0X3JhdGUocHJpdi0+cGl4
X2Nsaywgc3RhdGUtPmFkanVzdGVkX21vZGUuY2xvY2sgKiAxMDAwKTsKKworCQlyZWdtYXBfd3Jp
dGUocHJpdi0+bWFwLCBKWl9SRUdfTENEX0RBMCwgcHJpdi0+ZG1hX2h3ZGVzYy0+bmV4dCk7CisJ
fQorCisJaWYgKGV2ZW50KSB7CisJCXN0YXRlLT5ldmVudCA9IE5VTEw7CisKKwkJc3Bpbl9sb2Nr
X2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKKwkJaWYgKGRybV9jcnRjX3ZibGFua19nZXQo
Y3J0YykgPT0gMCkKKwkJCWRybV9jcnRjX2FybV92YmxhbmtfZXZlbnQoY3J0YywgZXZlbnQpOwor
CQllbHNlCisJCQlkcm1fY3J0Y19zZW5kX3ZibGFua19ldmVudChjcnRjLCBldmVudCk7CisJCXNw
aW5fdW5sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKKwl9Cit9CisKK3N0YXRpYyB2
b2lkIGluZ2VuaWNfZHJtX3BsYW5lX2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxh
bmUsCisJCQkJCSAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRzdGF0ZSkKK3sKKwlzdHJ1
Y3QgaW5nZW5pY19kcm0gKnByaXYgPSBkcm1fcGxhbmVfZ2V0X3ByaXYocGxhbmUpOworCXN0cnVj
dCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlID0gcGxhbmUtPnN0YXRlOworCXVuc2lnbmVkIGludCB3
aWR0aCwgaGVpZ2h0LCBjcHA7CisKKwl3aWR0aCA9IHN0YXRlLT5jcnRjLT5zdGF0ZS0+YWRqdXN0
ZWRfbW9kZS5oZGlzcGxheTsKKwloZWlnaHQgPSBzdGF0ZS0+Y3J0Yy0+c3RhdGUtPmFkanVzdGVk
X21vZGUudmRpc3BsYXk7CisJY3BwID0gc3RhdGUtPmZiLT5mb3JtYXQtPmNwcFtwbGFuZS0+aW5k
ZXhdOworCisJcHJpdi0+ZG1hX2h3ZGVzYy0+YWRkciA9IGRybV9mYl9jbWFfZ2V0X2dlbV9hZGRy
KHN0YXRlLT5mYiwgc3RhdGUsIDApOworCXByaXYtPmRtYV9od2Rlc2MtPmNtZCA9IHdpZHRoICog
aGVpZ2h0ICogY3BwIC8gNDsKKwlwcml2LT5kbWFfaHdkZXNjLT5jbWQgfD0gSlpfTENEX0NNRF9F
T0ZfSVJROworfQorCitzdGF0aWMgdm9pZCBpbmdlbmljX2RybV9lbmNvZGVyX2F0b21pY19tb2Rl
X3NldChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCisJCQkJCQlzdHJ1Y3QgZHJtX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29u
bl9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW5nZW5pY19kcm0gKnByaXYgPSBkcm1fZW5jb2Rlcl9nZXRf
cHJpdihlbmNvZGVyKTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZjcnRjX3N0
YXRlLT5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0gJmNv
bm5fc3RhdGUtPmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvOworCXVuc2lnbmVkIGludCBjZmcgPSBK
Wl9MQ0RfQ0ZHX1BTX0RJU0FCTEUKKwkJCSB8IEpaX0xDRF9DRkdfQ0xTX0RJU0FCTEUKKwkJCSB8
IEpaX0xDRF9DRkdfU1BMX0RJU0FCTEUKKwkJCSB8IEpaX0xDRF9DRkdfUkVWX0RJU0FCTEU7CisK
KwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX05IU1lOQykKKwkJY2ZnIHw9IEpaX0xD
RF9DRkdfSFNZTkNfQUNUSVZFX0xPVzsKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFH
X05WU1lOQykKKwkJY2ZnIHw9IEpaX0xDRF9DRkdfVlNZTkNfQUNUSVZFX0xPVzsKKwlpZiAoaW5m
by0+YnVzX2ZsYWdzICYgRFJNX0JVU19GTEFHX0RFX0xPVykKKwkJY2ZnIHw9IEpaX0xDRF9DRkdf
REVfQUNUSVZFX0xPVzsKKwlpZiAoaW5mby0+YnVzX2ZsYWdzICYgRFJNX0JVU19GTEFHX1BJWERB
VEFfTkVHRURHRSkKKwkJY2ZnIHw9IEpaX0xDRF9DRkdfUENMS19GQUxMSU5HX0VER0U7CisKKwlp
ZiAoY29ubl9zdGF0ZS0+Y29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05O
RUNUT1JfVFYpIHsKKwkJaWYgKG1vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0Up
CisJCQljZmcgfD0gSlpfTENEX0NGR19NT0RFX1RWX09VVF9JOworCQllbHNlCisJCQljZmcgfD0g
SlpfTENEX0NGR19NT0RFX1RWX09VVF9QOworCX0gZWxzZSB7CisJCXN3aXRjaCAoKmluZm8tPmJ1
c19mb3JtYXRzKSB7CisJCWNhc2UgTUVESUFfQlVTX0ZNVF9SR0I1NjVfMVgxNjoKKwkJCWNmZyB8
PSBKWl9MQ0RfQ0ZHX01PREVfR0VORVJJQ18xNkJJVDsKKwkJCWJyZWFrOworCQljYXNlIE1FRElB
X0JVU19GTVRfUkdCNjY2XzFYMTg6CisJCQljZmcgfD0gSlpfTENEX0NGR19NT0RFX0dFTkVSSUNf
MThCSVQ7CisJCQlicmVhazsKKwkJY2FzZSBNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDI0OgorCQkJ
Y2ZnIHw9IEpaX0xDRF9DRkdfTU9ERV9HRU5FUklDXzI0QklUOworCQkJYnJlYWs7CisJCWRlZmF1
bHQ6CisJCQlicmVhazsKKwkJfQorCX0KKworCXJlZ21hcF93cml0ZShwcml2LT5tYXAsIEpaX1JF
R19MQ0RfQ0ZHLCBjZmcpOworfQorCitzdGF0aWMgaW50IGluZ2VuaWNfZHJtX2VuY29kZXJfYXRv
bWljX2NoZWNrKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKKwkJCQkJICAgIHN0cnVjdCBk
cm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICAgIHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uX3N0YXRlKQoreworCXN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0g
JmNvbm5fc3RhdGUtPmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvOworCisJaWYgKGluZm8tPm51bV9i
dXNfZm9ybWF0cyAhPSAxKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChjb25uX3N0YXRlLT5j
b25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9UVikKKwkJcmV0
dXJuIDA7CisKKwlzd2l0Y2ggKCppbmZvLT5idXNfZm9ybWF0cykgeworCWNhc2UgTUVESUFfQlVT
X0ZNVF9SR0I1NjVfMVgxNjoKKwljYXNlIE1FRElBX0JVU19GTVRfUkdCNjY2XzFYMTg6CisJY2Fz
ZSBNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDI0OgorCQlyZXR1cm4gMDsKKwlkZWZhdWx0OgorCQly
ZXR1cm4gLUVJTlZBTDsKKwl9Cit9CisKK3N0YXRpYyBpcnFyZXR1cm5fdCBpbmdlbmljX2RybV9p
cnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCit7CisJc3RydWN0IGluZ2VuaWNfZHJtICpw
cml2ID0gYXJnOworCXVuc2lnbmVkIGludCBzdGF0ZTsKKworCXJlZ21hcF9yZWFkKHByaXYtPm1h
cCwgSlpfUkVHX0xDRF9TVEFURSwgJnN0YXRlKTsKKworCXJlZ21hcF91cGRhdGVfYml0cyhwcml2
LT5tYXAsIEpaX1JFR19MQ0RfU1RBVEUsCisJCQkgICBKWl9MQ0RfU1RBVEVfRU9GX0lSUSwgMCk7
CisKKwlpZiAoc3RhdGUgJiBKWl9MQ0RfU1RBVEVfRU9GX0lSUSkKKwkJZHJtX2NydGNfaGFuZGxl
X3ZibGFuaygmcHJpdi0+Y3J0Yyk7CisKKwlyZXR1cm4gSVJRX0hBTkRMRUQ7Cit9CisKK3N0YXRp
YyB2b2lkIGluZ2VuaWNfZHJtX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRybSkKK3sKKwlz
dHJ1Y3QgaW5nZW5pY19kcm0gKnByaXYgPSBkcm1fZGV2aWNlX2dldF9wcml2KGRybSk7CisKKwlk
cm1fbW9kZV9jb25maWdfY2xlYW51cChkcm0pOworCWRybV9kZXZfZmluaShkcm0pOworCWtmcmVl
KHByaXYpOworfQorCitzdGF0aWMgaW50IGluZ2VuaWNfZHJtX2VuYWJsZV92Ymxhbmsoc3RydWN0
IGRybV9jcnRjICpjcnRjKQoreworCXN0cnVjdCBpbmdlbmljX2RybSAqcHJpdiA9IGRybV9jcnRj
X2dldF9wcml2KGNydGMpOworCisJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYtPm1hcCwgSlpfUkVH
X0xDRF9DVFJMLAorCQkJICAgSlpfTENEX0NUUkxfRU9GX0lSUSwgSlpfTENEX0NUUkxfRU9GX0lS
USk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaW5nZW5pY19kcm1fZGlzYWJsZV92
Ymxhbmsoc3RydWN0IGRybV9jcnRjICpjcnRjKQoreworCXN0cnVjdCBpbmdlbmljX2RybSAqcHJp
diA9IGRybV9jcnRjX2dldF9wcml2KGNydGMpOworCisJcmVnbWFwX3VwZGF0ZV9iaXRzKHByaXYt
Pm1hcCwgSlpfUkVHX0xDRF9DVFJMLCBKWl9MQ0RfQ1RSTF9FT0ZfSVJRLCAwKTsKK30KKworREVG
SU5FX0RSTV9HRU1fQ01BX0ZPUFMoaW5nZW5pY19kcm1fZm9wcyk7CisKK3N0YXRpYyBzdHJ1Y3Qg
ZHJtX2RyaXZlciBpbmdlbmljX2RybV9kcml2ZXJfZGF0YSA9IHsKKwkuZHJpdmVyX2ZlYXR1cmVz
CT0gRFJJVkVSX01PREVTRVQgfCBEUklWRVJfR0VNIHwgRFJJVkVSX1BSSU1FCisJCQkJfCBEUklW
RVJfQVRPTUlDLAorCS5uYW1lCQkJPSAiaW5nZW5pYy1kcm0iLAorCS5kZXNjCQkJPSAiRFJNIG1v
ZHVsZSBmb3IgSW5nZW5pYyBTb0NzIiwKKwkuZGF0ZQkJCT0gIjIwMTkwNDIyIiwKKwkubWFqb3IJ
CQk9IDEsCisJLm1pbm9yCQkJPSAwLAorCS5wYXRjaGxldmVsCQk9IDAsCisKKwkuZm9wcwkJCT0g
JmluZ2VuaWNfZHJtX2ZvcHMsCisKKwkuZHVtYl9jcmVhdGUJCT0gZHJtX2dlbV9jbWFfZHVtYl9j
cmVhdGUsCisJLmdlbV9mcmVlX29iamVjdF91bmxvY2tlZCA9IGRybV9nZW1fY21hX2ZyZWVfb2Jq
ZWN0LAorCS5nZW1fdm1fb3BzCQk9ICZkcm1fZ2VtX2NtYV92bV9vcHMsCisKKwkucHJpbWVfaGFu
ZGxlX3RvX2ZkCT0gZHJtX2dlbV9wcmltZV9oYW5kbGVfdG9fZmQsCisJLnByaW1lX2ZkX3RvX2hh
bmRsZQk9IGRybV9nZW1fcHJpbWVfZmRfdG9faGFuZGxlLAorCS5nZW1fcHJpbWVfZ2V0X3NnX3Rh
YmxlCT0gZHJtX2dlbV9jbWFfcHJpbWVfZ2V0X3NnX3RhYmxlLAorCS5nZW1fcHJpbWVfaW1wb3J0
X3NnX3RhYmxlID0gZHJtX2dlbV9jbWFfcHJpbWVfaW1wb3J0X3NnX3RhYmxlLAorCS5nZW1fcHJp
bWVfdm1hcAkJPSBkcm1fZ2VtX2NtYV9wcmltZV92bWFwLAorCS5nZW1fcHJpbWVfdnVubWFwCT0g
ZHJtX2dlbV9jbWFfcHJpbWVfdnVubWFwLAorCS5nZW1fcHJpbWVfbW1hcAkJPSBkcm1fZ2VtX2Nt
YV9wcmltZV9tbWFwLAorCisJLmlycV9oYW5kbGVyCQk9IGluZ2VuaWNfZHJtX2lycV9oYW5kbGVy
LAorCS5yZWxlYXNlCQk9IGluZ2VuaWNfZHJtX3JlbGVhc2UsCit9OworCitzdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9wbGFuZV9mdW5jcyBpbmdlbmljX2RybV9wcmltYXJ5X3BsYW5lX2Z1bmNzID0g
eworCS51cGRhdGVfcGxhbmUJCT0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAorCS5k
aXNhYmxlX3BsYW5lCQk9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCisJLnJlc2V0
CQkJPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9yZXNldCwKKwkuZGVzdHJveQkJPSBkcm1fcGxh
bmVfY2xlYW51cCwKKworCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlCT0gZHJtX2F0b21pY19oZWxw
ZXJfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZQk9IGRybV9h
dG9taWNfaGVscGVyX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCit9OworCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRybV9jcnRjX2Z1bmNzIGluZ2VuaWNfZHJtX2NydGNfZnVuY3MgPSB7CisJLnNldF9jb25m
aWcJCT0gZHJtX2F0b21pY19oZWxwZXJfc2V0X2NvbmZpZywKKwkucGFnZV9mbGlwCQk9IGRybV9h
dG9taWNfaGVscGVyX3BhZ2VfZmxpcCwKKwkucmVzZXQJCQk9IGRybV9hdG9taWNfaGVscGVyX2Ny
dGNfcmVzZXQsCisJLmRlc3Ryb3kJCT0gZHJtX2NydGNfY2xlYW51cCwKKworCS5hdG9taWNfZHVw
bGljYXRlX3N0YXRlCT0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kdXBsaWNhdGVfc3RhdGUsCisJ
LmF0b21pY19kZXN0cm95X3N0YXRlCT0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0
YXRlLAorCisJLmVuYWJsZV92YmxhbmsJCT0gaW5nZW5pY19kcm1fZW5hYmxlX3ZibGFuaywKKwku
ZGlzYWJsZV92YmxhbmsJCT0gaW5nZW5pY19kcm1fZGlzYWJsZV92YmxhbmssCisKKwkuZ2FtbWFf
c2V0CQk9IGRybV9hdG9taWNfaGVscGVyX2xlZ2FjeV9nYW1tYV9zZXQsCit9OworCitzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MgaW5nZW5pY19kcm1fcGxhbmVfaGVs
cGVyX2Z1bmNzID0geworCS5hdG9taWNfdXBkYXRlCQk9IGluZ2VuaWNfZHJtX3BsYW5lX2F0b21p
Y191cGRhdGUsCisJLnByZXBhcmVfZmIJCT0gZHJtX2dlbV9mYl9wcmVwYXJlX2ZiLAorfTsKKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19oZWxwZXJfZnVuY3MgaW5nZW5pY19kcm1fY3J0
Y19oZWxwZXJfZnVuY3MgPSB7CisJLmF0b21pY19lbmFibGUJCT0gaW5nZW5pY19kcm1fY3J0Y19h
dG9taWNfZW5hYmxlLAorCS5hdG9taWNfZGlzYWJsZQkJPSBpbmdlbmljX2RybV9jcnRjX2F0b21p
Y19kaXNhYmxlLAorCS5hdG9taWNfZmx1c2gJCT0gaW5nZW5pY19kcm1fY3J0Y19hdG9taWNfZmx1
c2gsCisJLmF0b21pY19jaGVjawkJPSBpbmdlbmljX2RybV9jcnRjX2F0b21pY19jaGVjaywKK307
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzIGluZ2VuaWNf
ZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzID0geworCS5hdG9taWNfbW9kZV9zZXQJPSBpbmdlbmlj
X2RybV9lbmNvZGVyX2F0b21pY19tb2RlX3NldCwKKwkuYXRvbWljX2NoZWNrCQk9IGluZ2VuaWNf
ZHJtX2VuY29kZXJfYXRvbWljX2NoZWNrLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1f
bW9kZV9jb25maWdfZnVuY3MgaW5nZW5pY19kcm1fbW9kZV9jb25maWdfZnVuY3MgPSB7CisJLmZi
X2NyZWF0ZQkJPSBkcm1fZ2VtX2ZiX2NyZWF0ZSwKKwkub3V0cHV0X3BvbGxfY2hhbmdlZAk9IGRy
bV9mYl9oZWxwZXJfb3V0cHV0X3BvbGxfY2hhbmdlZCwKKwkuYXRvbWljX2NoZWNrCQk9IGRybV9h
dG9taWNfaGVscGVyX2NoZWNrLAorCS5hdG9taWNfY29tbWl0CQk9IGRybV9hdG9taWNfaGVscGVy
X2NvbW1pdCwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfZnVuY3MgaW5n
ZW5pY19kcm1fZW5jb2Rlcl9mdW5jcyA9IHsKKwkuZGVzdHJveQkJPSBkcm1fZW5jb2Rlcl9jbGVh
bnVwLAorfTsKKworc3RhdGljIHZvaWQgaW5nZW5pY19kcm1fZnJlZV9kbWFfaHdkZXNjKHZvaWQg
KmQpCit7CisJc3RydWN0IGluZ2VuaWNfZHJtICpwcml2ID0gZDsKKworCWRtYV9mcmVlX2NvaGVy
ZW50KHByaXYtPmRldiwgc2l6ZW9mKCpwcml2LT5kbWFfaHdkZXNjKSwKKwkJCSAgcHJpdi0+ZG1h
X2h3ZGVzYywgcHJpdi0+ZG1hX2h3ZGVzY19waHlzKTsKK30KKworc3RhdGljIGludCBpbmdlbmlj
X2RybV9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCWNvbnN0IHN0cnVj
dCBqel9zb2NfaW5mbyAqc29jX2luZm87CisJc3RydWN0IGRldmljZSAqZGV2ID0gJnBkZXYtPmRl
djsKKwlzdHJ1Y3QgaW5nZW5pY19kcm0gKnByaXY7CisJc3RydWN0IGNsayAqcGFyZW50X2NsazsK
KwlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOworCXN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsOwor
CXN0cnVjdCBkcm1fZGV2aWNlICpkcm07CisJc3RydWN0IHJlc291cmNlICptZW07CisJdm9pZCBf
X2lvbWVtICpiYXNlOworCWxvbmcgcGFyZW50X3JhdGU7CisJaW50IHJldCwgaXJxOworCisJc29j
X2luZm8gPSBvZl9kZXZpY2VfZ2V0X21hdGNoX2RhdGEoZGV2KTsKKwlpZiAoIXNvY19pbmZvKSB7
CisJCWRldl9lcnIoZGV2LCAiTWlzc2luZyBwbGF0Zm9ybSBkYXRhXG4iKTsKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCisJcHJpdiA9IGt6YWxsb2Moc2l6ZW9mKCpwcml2KSwgR0ZQX0tFUk5FTCk7
CisJaWYgKCFwcml2KQorCQlyZXR1cm4gLUVOT01FTTsKKworCXByaXYtPmRldiA9IGRldjsKKwlk
cm0gPSAmcHJpdi0+ZHJtOworCWRybS0+ZGV2X3ByaXZhdGUgPSBwcml2OworCisJcGxhdGZvcm1f
c2V0X2RydmRhdGEocGRldiwgcHJpdik7CisKKwlyZXQgPSBkZXZtX2RybV9kZXZfaW5pdChkZXYs
IGRybSwgJmluZ2VuaWNfZHJtX2RyaXZlcl9kYXRhKTsKKwlpZiAocmV0KSB7CisJCWtmcmVlKHBy
aXYpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9tb2RlX2NvbmZpZ19pbml0KGRybSk7CisJ
ZHJtLT5tb2RlX2NvbmZpZy5taW5fd2lkdGggPSAwOworCWRybS0+bW9kZV9jb25maWcubWluX2hl
aWdodCA9IDA7CisJZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGggPSA4MDA7CisJZHJtLT5tb2Rl
X2NvbmZpZy5tYXhfaGVpZ2h0ID0gNjAwOworCWRybS0+bW9kZV9jb25maWcuZnVuY3MgPSAmaW5n
ZW5pY19kcm1fbW9kZV9jb25maWdfZnVuY3M7CisKKwltZW0gPSBwbGF0Zm9ybV9nZXRfcmVzb3Vy
Y2UocGRldiwgSU9SRVNPVVJDRV9NRU0sIDApOworCWJhc2UgPSBkZXZtX2lvcmVtYXBfcmVzb3Vy
Y2UoZGV2LCBtZW0pOworCWlmIChJU19FUlIoYmFzZSkpIHsKKwkJZGV2X2VycihkZXYsICJGYWls
ZWQgdG8gZ2V0IG1lbW9yeSByZXNvdXJjZSIpOworCQlyZXR1cm4gUFRSX0VSUihiYXNlKTsKKwl9
CisKKwlwcml2LT5tYXAgPSBkZXZtX3JlZ21hcF9pbml0X21taW8oZGV2LCBiYXNlLAorCQkJCQkg
ICZpbmdlbmljX2RybV9yZWdtYXBfY29uZmlnKTsKKwlpZiAoSVNfRVJSKHByaXYtPm1hcCkpIHsK
KwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gY3JlYXRlIHJlZ21hcCIpOworCQlyZXR1cm4gUFRS
X0VSUihwcml2LT5tYXApOworCX0KKworCWlycSA9IHBsYXRmb3JtX2dldF9pcnEocGRldiwgMCk7
CisJaWYgKGlycSA8IDApIHsKKwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gZ2V0IHBsYXRmb3Jt
IGlycSIpOworCQlyZXR1cm4gaXJxOworCX0KKworCWlmIChzb2NfaW5mby0+bmVlZHNfZGV2X2Ns
aykgeworCQlwcml2LT5sY2RfY2xrID0gZGV2bV9jbGtfZ2V0KGRldiwgImxjZCIpOworCQlpZiAo
SVNfRVJSKHByaXYtPmxjZF9jbGspKSB7CisJCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBnZXQg
bGNkIGNsb2NrIik7CisJCQlyZXR1cm4gUFRSX0VSUihwcml2LT5sY2RfY2xrKTsKKwkJfQorCX0K
KworCXByaXYtPnBpeF9jbGsgPSBkZXZtX2Nsa19nZXQoZGV2LCAibGNkX3BjbGsiKTsKKwlpZiAo
SVNfRVJSKHByaXYtPnBpeF9jbGspKSB7CisJCWRldl9lcnIoZGV2LCAiRmFpbGVkIHRvIGdldCBw
aXhlbCBjbG9jayIpOworCQlyZXR1cm4gUFRSX0VSUihwcml2LT5waXhfY2xrKTsKKwl9CisKKwly
ZXQgPSBkcm1fb2ZfZmluZF9wYW5lbF9vcl9icmlkZ2UoZGV2LT5vZl9ub2RlLCAwLCAwLCAmcGFu
ZWwsICZicmlkZ2UpOworCWlmIChyZXQpIHsKKwkJaWYgKHJldCAhPSAtRVBST0JFX0RFRkVSKQor
CQkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gZ2V0IHBhbmVsIGhhbmRsZSIpOworCQlyZXR1cm4g
cmV0OworCX0KKworCWlmIChwYW5lbCkgeworCQlicmlkZ2UgPSBkZXZtX2RybV9wYW5lbF9icmlk
Z2VfYWRkKGRldiwgcGFuZWwsCisJCQkJCQkgICBEUk1fTU9ERV9DT05ORUNUT1JfVW5rbm93bik7
CisJfQorCisJcHJpdi0+ZG1hX2h3ZGVzYyA9IGRtYV9hbGxvY19jb2hlcmVudChkZXYsIHNpemVv
ZigqcHJpdi0+ZG1hX2h3ZGVzYyksCisJCQkJCSAgICAgICZwcml2LT5kbWFfaHdkZXNjX3BoeXMs
CisJCQkJCSAgICAgIEdGUF9LRVJORUwpOworCWlmICghcHJpdi0+ZG1hX2h3ZGVzYykKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlyZXQgPSBkZXZtX2FkZF9hY3Rpb25fb3JfcmVzZXQoZGV2LCBpbmdl
bmljX2RybV9mcmVlX2RtYV9od2Rlc2MsIHByaXYpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CisKKwlwcml2LT5kbWFfaHdkZXNjLT5uZXh0ID0gcHJpdi0+ZG1hX2h3ZGVzY19waHlzOworCXBy
aXYtPmRtYV9od2Rlc2MtPmlkID0gMHhkZWFmYmVhZDsKKworCWRybV9wbGFuZV9oZWxwZXJfYWRk
KCZwcml2LT5wcmltYXJ5LCAmaW5nZW5pY19kcm1fcGxhbmVfaGVscGVyX2Z1bmNzKTsKKworCXJl
dCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdChkcm0sICZwcml2LT5wcmltYXJ5LAorCQkJCSAg
ICAgICAwLCAmaW5nZW5pY19kcm1fcHJpbWFyeV9wbGFuZV9mdW5jcywKKwkJCQkgICAgICAgaW5n
ZW5pY19kcm1fcHJpbWFyeV9mb3JtYXRzLAorCQkJCSAgICAgICBBUlJBWV9TSVpFKGluZ2VuaWNf
ZHJtX3ByaW1hcnlfZm9ybWF0cyksCisJCQkJICAgICAgIE5VTEwsIERSTV9QTEFORV9UWVBFX1BS
SU1BUlksIE5VTEwpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gcmVn
aXN0ZXIgcHJpbWFyeSBwbGFuZTogJWkiLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRy
bV9jcnRjX2hlbHBlcl9hZGQoJnByaXYtPmNydGMsICZpbmdlbmljX2RybV9jcnRjX2hlbHBlcl9m
dW5jcyk7CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhfcGxhbmVzKGRybSwgJnByaXYtPmNy
dGMsICZwcml2LT5wcmltYXJ5LAorCQkJCQlOVUxMLCAmaW5nZW5pY19kcm1fY3J0Y19mdW5jcywg
TlVMTCk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBpbml0IENSVEM6
ICVpIiwgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlwcml2LT5lbmNvZGVyLnBvc3NpYmxl
X2NydGNzID0gMTsKKworCWRybV9lbmNvZGVyX2hlbHBlcl9hZGQoJnByaXYtPmVuY29kZXIsCisJ
CQkgICAgICAgJmluZ2VuaWNfZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzKTsKKworCXJldCA9IGRy
bV9lbmNvZGVyX2luaXQoZHJtLCAmcHJpdi0+ZW5jb2RlciwgJmluZ2VuaWNfZHJtX2VuY29kZXJf
ZnVuY3MsCisJCQkgICAgICAgRFJNX01PREVfRU5DT0RFUl9EUEksIE5VTEwpOworCWlmIChyZXQp
IHsKKwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gaW5pdCBlbmNvZGVyOiAlaSIsIHJldCk7CisJ
CXJldHVybiByZXQ7CisJfQorCisJcmV0ID0gZHJtX2JyaWRnZV9hdHRhY2goJnByaXYtPmVuY29k
ZXIsIGJyaWRnZSwgTlVMTCk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRldiwgIlVuYWJsZSB0
byBhdHRhY2ggYnJpZGdlIik7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0ID0gZHJtX2lycV9p
bnN0YWxsKGRybSwgaXJxKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAiVW5hYmxlIHRv
IGluc3RhbGwgSVJRIGhhbmRsZXIiKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSBkcm1f
dmJsYW5rX2luaXQoZHJtLCAxKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAiRmFpbGVk
IGNhbGxpbmcgZHJtX3ZibGFua19pbml0KCkiKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlkcm1f
bW9kZV9jb25maWdfcmVzZXQoZHJtKTsKKworCXJldCA9IGNsa19wcmVwYXJlX2VuYWJsZShwcml2
LT5waXhfY2xrKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAiVW5hYmxlIHRvIHN0YXJ0
IHBpeGVsIGNsb2NrIik7CisJCXJldHVybiByZXQ7CisJfQorCisJaWYgKHByaXYtPmxjZF9jbGsp
IHsKKwkJcGFyZW50X2NsayA9IGNsa19nZXRfcGFyZW50KHByaXYtPmxjZF9jbGspOworCQlwYXJl
bnRfcmF0ZSA9IGNsa19nZXRfcmF0ZShwYXJlbnRfY2xrKTsKKworCQkvKiBMQ0QgRGV2aWNlIGNs
b2NrIG11c3QgYmUgM3ggdGhlIHBpeGVsIGNsb2NrIGZvciBTVE4gcGFuZWxzLAorCQkgKiBvciAx
LjV4IHRoZSBwaXhlbCBjbG9jayBmb3IgVEZUIHBhbmVscy4gVG8gYXZvaWQgaGF2aW5nIHRvCisJ
CSAqIGNoZWNrIGZvciB0aGUgTENEIGRldmljZSBjbG9jayBldmVyeXRpbWUgd2UgZG8gYSBtb2Rl
IGNoYW5nZSwKKwkJICogd2Ugc2V0IHRoZSBMQ0QgZGV2aWNlIGNsb2NrIHRvIHRoZSBoaWdoZXN0
IHJhdGUgcG9zc2libGUuCisJCSAqLworCQlyZXQgPSBjbGtfc2V0X3JhdGUocHJpdi0+bGNkX2Ns
aywgcGFyZW50X3JhdGUpOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKGRldiwgIlVuYWJsZSB0
byBzZXQgTENEIGNsb2NrIHJhdGUiKTsKKwkJCWdvdG8gZXJyX3BpeGNsa19kaXNhYmxlOworCQl9
CisKKwkJcmV0ID0gY2xrX3ByZXBhcmVfZW5hYmxlKHByaXYtPmxjZF9jbGspOworCQlpZiAocmV0
KSB7CisJCQlkZXZfZXJyKGRldiwgIlVuYWJsZSB0byBzdGFydCBsY2QgY2xvY2siKTsKKwkJCWdv
dG8gZXJyX3BpeGNsa19kaXNhYmxlOworCQl9CisJfQorCisJcmV0ID0gZHJtX2Rldl9yZWdpc3Rl
cihkcm0sIDApOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gcmVnaXN0
ZXIgRFJNIGRyaXZlciIpOworCQlnb3RvIGVycl9kZXZjbGtfZGlzYWJsZTsKKwl9CisKKwlyZXQg
PSBkcm1fZmJkZXZfZ2VuZXJpY19zZXR1cChkcm0sIDMyKTsKKwlpZiAocmV0KQorCQlkZXZfd2Fy
bihkZXYsICJVbmFibGUgdG8gc3RhcnQgZmJkZXYgZW11bGF0aW9uOiAlaSIsIHJldCk7CisKKwly
ZXR1cm4gMDsKKworZXJyX2RldmNsa19kaXNhYmxlOgorCWlmIChwcml2LT5sY2RfY2xrKQorCQlj
bGtfZGlzYWJsZV91bnByZXBhcmUocHJpdi0+bGNkX2Nsayk7CitlcnJfcGl4Y2xrX2Rpc2FibGU6
CisJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKHByaXYtPnBpeF9jbGspOworCXJldHVybiByZXQ7Cit9
CisKK3N0YXRpYyBpbnQgaW5nZW5pY19kcm1fcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2Ug
KnBkZXYpCit7CisJc3RydWN0IGluZ2VuaWNfZHJtICpwcml2ID0gcGxhdGZvcm1fZ2V0X2RydmRh
dGEocGRldik7CisKKwlpZiAocHJpdi0+bGNkX2NsaykKKwkJY2xrX2Rpc2FibGVfdW5wcmVwYXJl
KHByaXYtPmxjZF9jbGspOworCWNsa19kaXNhYmxlX3VucHJlcGFyZShwcml2LT5waXhfY2xrKTsK
KworCWRybV9kZXZfdW5yZWdpc3RlcigmcHJpdi0+ZHJtKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9z
aHV0ZG93bigmcHJpdi0+ZHJtKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGp6X3NvY19pbmZvIGp6NDc0MF9zb2NfaW5mbyA9IHsKKwkubmVlZHNfZGV2X2NsayA9IHRy
dWUsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGp6X3NvY19pbmZvIGp6NDcyNWJfc29jX2lu
Zm8gPSB7CisJLm5lZWRzX2Rldl9jbGsgPSBmYWxzZSwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1
Y3Qgb2ZfZGV2aWNlX2lkIGluZ2VuaWNfZHJtX29mX21hdGNoW10gPSB7CisJeyAuY29tcGF0aWJs
ZSA9ICJpbmdlbmljLGp6NDc0MC1sY2QiLCAuZGF0YSA9ICZqejQ3NDBfc29jX2luZm8gfSwKKwl7
IC5jb21wYXRpYmxlID0gImluZ2VuaWMsano0NzI1Yi1sY2QiLCAuZGF0YSA9ICZqejQ3MjViX3Nv
Y19pbmZvIH0sCisJeyAvKiBzZW50aW5lbCAqLyB9LAorfTsKKworc3RhdGljIHN0cnVjdCBwbGF0
Zm9ybV9kcml2ZXIgaW5nZW5pY19kcm1fZHJpdmVyID0geworCS5kcml2ZXIgPSB7CisJCS5uYW1l
ID0gImluZ2VuaWMtZHJtIiwKKwkJLm9mX21hdGNoX3RhYmxlID0gb2ZfbWF0Y2hfcHRyKGluZ2Vu
aWNfZHJtX29mX21hdGNoKSwKKwl9LAorCS5wcm9iZSA9IGluZ2VuaWNfZHJtX3Byb2JlLAorCS5y
ZW1vdmUgPSBpbmdlbmljX2RybV9yZW1vdmUsCit9OworbW9kdWxlX3BsYXRmb3JtX2RyaXZlcihp
bmdlbmljX2RybV9kcml2ZXIpOworCitNT0RVTEVfQVVUSE9SKCJQYXVsIENlcmN1ZWlsIDxwYXVs
QGNyYXBvdWlsbG91Lm5ldD4iKTsKK01PRFVMRV9ERVNDUklQVElPTigiRFJNIGRyaXZlciBmb3Ig
dGhlIEluZ2VuaWMgU29Dc1xuIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7Ci0tIAoyLjIx
LjAuNTkzLmc1MTFlYzM0NWUxOAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
