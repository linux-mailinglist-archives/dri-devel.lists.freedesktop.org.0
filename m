Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 72350F07D3
	for <lists+dri-devel@lfdr.de>; Tue,  5 Nov 2019 22:11:00 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CF9DE6E9F7;
	Tue,  5 Nov 2019 21:10:56 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yw1-xc41.google.com (mail-yw1-xc41.google.com
 [IPv6:2607:f8b0:4864:20::c41])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 26BD76E9D9
 for <dri-devel@lists.freedesktop.org>; Tue,  5 Nov 2019 21:10:55 +0000 (UTC)
Received: by mail-yw1-xc41.google.com with SMTP id i2so8820842ywg.13
 for <dri-devel@lists.freedesktop.org>; Tue, 05 Nov 2019 13:10:55 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=47K5oOg7WLw5/3p9dwg+0DGsBD3xNcb5zwIbofYoaPA=;
 b=kNhFeXWtkrWpF3XPQU7U/xp2A9mq9OBuvRQj+U3RAUh7F65YTGC56/P3kaq87dvj2X
 Ft5XXU+TjuEJMqo3QC5S7m7eXzNtzRALGqi+Xh5QS4y/4G14Lf8GmeSN/vSGenBaIdtm
 9zcm10i8jhGkzhUOjckJYbbL6WUUpwwktDEpJQd2fp0KNphgkm/t+lquAnS7HrDGFZMf
 KERoZOqSO4FgupOPQCnRPmbjWbZdX1b5C4bXYdZq/6Dc1vom1B5b++KQ+3BF6Vg0D7Dy
 83AUZQq6sPlNsyrTklchD3PtKCAypOOalYvXjJbGg+ckmpQSMDsZ7wy0lM3PaUwJbpxG
 VKfQ==
X-Gm-Message-State: APjAAAVpR5FMBcbtGXKp4KTX6mTmA9Oo84Ay+5YxBXb2ONsjfc0F363u
 tRj9VbO1GHt7YLpYB/KshCOtkSKKZJQ=
X-Google-Smtp-Source: APXvYqwa5e6g0vw3L3tFhW0BtB4ETIxgip1pNsXJmRwcKlnn/4sNZ5kkBKbaTE9F2U4hGDttwHOBxg==
X-Received: by 2002:a81:db07:: with SMTP id u7mr4709820ywm.126.1572988253967; 
 Tue, 05 Nov 2019 13:10:53 -0800 (PST)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id j66sm1815216ywb.101.2019.11.05.13.10.53
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 05 Nov 2019 13:10:53 -0800 (PST)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org,
	linux-mediatek@lists.infradead.org
Subject: [PATCH v2 3/7] drm/mediatek: Add plumbing for layer_check hook
Date: Tue,  5 Nov 2019 16:10:20 -0500
Message-Id: <20191105211034.123937-4-sean@poorly.run>
X-Mailer: git-send-email 2.24.0.rc1.363.gb1bccd3e3d-goog
In-Reply-To: <20191105211034.123937-1-sean@poorly.run>
References: <20191105211034.123937-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=47K5oOg7WLw5/3p9dwg+0DGsBD3xNcb5zwIbofYoaPA=;
 b=CWNIiMSHLVnAufWZgrmvlq1asdA7IwpWS/kZgw6NLjJTJTgeYxEfGOldA6SUYIn36/
 /XlzTYjXGfnqwPIlshx5rIUyuA210kV1lo+8QucYHMdWnRSGIXYOvA0Knm0op+7zFD1s
 nb/3HMlqMnYKEn8KKAcVudt1XHSAyRl2fbpsIehgiznPgxQfgf8grLlQipXhSnACYR87
 QmM1jNs5KHPflI2HM+s/W2tNhTjf0g2GltXN0UlTxDc9yyUYsgia56eXCwNEiTchzaA9
 q8Ozr+sw2Ric7EQ3d/lulCZyQz8W/oWYyrtDtc8cgQhyIXSA5fmHYQjgalMlgZ5cPgIe
 qTFQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dcastagna@chromium.org, matthias.bgg@gmail.com, mcasas@chromium.org,
 Sean Paul <seanpaul@chromium.org>, frkoenig@chromium.org,
 linux-arm-kernel@lists.infradead.org, markyacoub@google.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGlzIGFsbG93cyBjb21w
b25lbnRzIHRvIGltcGxlbWVudCBhIC5sYXllcl9jaGVjayBjYWxsYmFjayBmb3IgdGhlaXIKbGF5
ZXJzIHdoaWNoIGlzIGNhbGxlZCBkdXJpbmcgYXRvbWljX2NoZWNrLgoKU2lnbmVkLW9mZi1ieTog
U2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+Ci0tLQogZHJpdmVycy9ncHUvZHJtL21l
ZGlhdGVrL210a19kcm1fY3J0Yy5jICAgICB8IDEwICsrKysrKysrKysKIGRyaXZlcnMvZ3B1L2Ry
bS9tZWRpYXRlay9tdGtfZHJtX2NydGMuaCAgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL21l
ZGlhdGVrL210a19kcm1fZGRwX2NvbXAuaCB8IDEyICsrKysrKysrKysrKwogZHJpdmVycy9ncHUv
ZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYyAgICB8ICA2ICsrKysrKwogNCBmaWxlcyBjaGFu
Z2VkLCAzMCBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21lZGlh
dGVrL210a19kcm1fY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0
Yy5jCmluZGV4IGNjZjM5NWYxN2E5OS4uMDRlN2U0YmRiZGI1IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21l
ZGlhdGVrL210a19kcm1fY3J0Yy5jCkBAIC0zOTQsNiArMzk0LDE2IEBAIHN0YXRpYyB2b2lkIG10
a19jcnRjX2RkcF9jb25maWcoc3RydWN0IGRybV9jcnRjICpjcnRjKQogCX0KIH0KIAoraW50IG10
a19kcm1fY3J0Y19wbGFuZV9jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1f
cGxhbmUgKnBsYW5lLAorCQkJICAgICBzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sK
Kwl1bnNpZ25lZCBpbnQgbG9jYWxfbGF5ZXI7CisJc3RydWN0IG10a19kZHBfY29tcCAqY29tcDsK
KworCWNvbXAgPSBtdGtfZHJtX2RkcF9jb21wX2Zvcl9wbGFuZShjcnRjLCBwbGFuZSwgJmxvY2Fs
X2xheWVyKTsKKwlyZXR1cm4gbXRrX2RkcF9jb21wX2xheWVyX2NoZWNrKGNvbXAsIGxvY2FsX2xh
eWVyLCBzdGF0ZSk7Cit9CisKIHN0YXRpYyB2b2lkIG10a19kcm1fY3J0Y19hdG9taWNfZW5hYmxl
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkgICAgICAgc3RydWN0IGRybV9jcnRjX3N0YXRl
ICpvbGRfc3RhdGUpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRr
X2RybV9jcnRjLmggYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgKaW5k
ZXggZmNjMTM0ZWIwMGM5Li42YWZlMWMxOTU1N2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9tZWRpYXRlay9tdGtfZHJtX2NydGMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsv
bXRrX2RybV9jcnRjLmgKQEAgLTE5LDUgKzE5LDcgQEAgdm9pZCBtdGtfY3J0Y19kZHBfaXJxKHN0
cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IG10a19kZHBfY29tcCAqY29tcCk7CiBpbnQgbXRr
X2RybV9jcnRjX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiwKIAkJCWNvbnN0IGVu
dW0gbXRrX2RkcF9jb21wX2lkICpwYXRoLAogCQkJdW5zaWduZWQgaW50IHBhdGhfbGVuKTsKK2lu
dCBtdGtfZHJtX2NydGNfcGxhbmVfY2hlY2soc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3Qg
ZHJtX3BsYW5lICpwbGFuZSwKKwkJCSAgICAgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUp
OwogCiAjZW5kaWYgLyogTVRLX0RSTV9DUlRDX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmggYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0
ZWsvbXRrX2RybV9kZHBfY29tcC5oCmluZGV4IDI2NDQxZjRkMWFkMy4uM2RlMzcxZTI4YmRmIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmgKQEAgLTgwLDYg
KzgwLDkgQEAgc3RydWN0IG10a19kZHBfY29tcF9mdW5jcyB7CiAJdW5zaWduZWQgaW50ICgqbGF5
ZXJfbnIpKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApOwogCXZvaWQgKCpsYXllcl9vbikoc3Ry
dWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCk7CiAJdm9pZCAoKmxheWVy
X29mZikoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCk7CisJaW50
ICgqbGF5ZXJfY2hlY2spKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsCisJCQkgICB1bnNpZ25l
ZCBpbnQgaWR4LAorCQkJICAgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUpOwogCXZvaWQg
KCpsYXllcl9jb25maWcpKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBp
ZHgsCiAJCQkgICAgIHN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRlKTsKIAl2b2lkICgqZ2Ft
bWFfc2V0KShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLApAQCAtMTUyLDYgKzE1NSwxNSBAQCBz
dGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9jb21wX2xheWVyX29mZihzdHJ1Y3QgbXRrX2RkcF9j
b21wICpjb21wLAogCQljb21wLT5mdW5jcy0+bGF5ZXJfb2ZmKGNvbXAsIGlkeCk7CiB9CiAKK3N0
YXRpYyBpbmxpbmUgaW50IG10a19kZHBfY29tcF9sYXllcl9jaGVjayhzdHJ1Y3QgbXRrX2RkcF9j
b21wICpjb21wLAorCQkJCQkgICB1bnNpZ25lZCBpbnQgaWR4LAorCQkJCQkgICBzdHJ1Y3QgbXRr
X3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sKKwlpZiAoY29tcC0+ZnVuY3MgJiYgY29tcC0+ZnVuY3Mt
PmxheWVyX2NoZWNrKQorCQlyZXR1cm4gY29tcC0+ZnVuY3MtPmxheWVyX2NoZWNrKGNvbXAsIGlk
eCwgc3RhdGUpOworCXJldHVybiAwOworfQorCiBzdGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9j
b21wX2xheWVyX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAogCQkJCQkgICAgIHVu
c2lnbmVkIGludCBpZHgsCiAJCQkJCSAgICAgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYwppbmRleCA1ODRhOWVjYWRj
ZTYuLjU4YjAyZmZmZTMyMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kcm1fcGxhbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFu
ZS5jCkBAIC04NCw2ICs4NCw3IEBAIHN0YXRpYyBpbnQgbXRrX3BsYW5lX2F0b21pY19jaGVjayhz
dHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIHsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHN0YXRlLT5mYjsKIAlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJaW50IHJl
dDsKIAogCWlmICghZmIpCiAJCXJldHVybiAwOwpAQCAtOTEsNiArOTIsMTEgQEAgc3RhdGljIGlu
dCBtdGtfcGxhbmVfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmICgh
c3RhdGUtPmNydGMpCiAJCXJldHVybiAwOwogCisJcmV0ID0gbXRrX2RybV9jcnRjX3BsYW5lX2No
ZWNrKHN0YXRlLT5jcnRjLCBwbGFuZSwKKwkJCQkgICAgICAgdG9fbXRrX3BsYW5lX3N0YXRlKHN0
YXRlKSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWNydGNfc3RhdGUgPSBkcm1fYXRv
bWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwgc3RhdGUtPmNydGMpOwogCWlmIChJU19F
UlIoY3J0Y19zdGF0ZSkpCiAJCXJldHVybiBQVFJfRVJSKGNydGNfc3RhdGUpOwotLSAKU2VhbiBQ
YXVsLCBTb2Z0d2FyZSBFbmdpbmVlciwgR29vZ2xlIC8gQ2hyb21pdW0gT1MKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
