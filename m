Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7AB6A107B85
	for <lists+dri-devel@lfdr.de>; Sat, 23 Nov 2019 00:38:06 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C971D6F567;
	Fri, 22 Nov 2019 23:38:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 361 seconds by postgrey-1.36 at gabe;
 Fri, 22 Nov 2019 23:38:01 UTC
Received: from a27-21.smtp-out.us-west-2.amazonses.com
 (a27-21.smtp-out.us-west-2.amazonses.com [54.240.27.21])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D27866F565;
 Fri, 22 Nov 2019 23:38:01 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
 aws-us-west-2-caf-mail-1.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-1.0 required=2.0 tests=ALL_TRUSTED,SPF_NONE,
 URIBL_BLOCKED autolearn=unavailable autolearn_force=no version=3.4.0
DMARC-Filter: OpenDMARC Filter v1.3.2 smtp.codeaurora.org A2E06C76F4D
From: Jordan Crouse <jcrouse@codeaurora.org>
To: iommu@lists.linux-foundation.org
Subject: [PATCH v2 5/8] drm/msm: Attach the IOMMU device during initialization
Date: Fri, 22 Nov 2019 23:31:59 +0000
Message-ID: <0101016e95753ec8-bb0cc1c7-db50-47ca-a947-12f98877fde9-000000@us-west-2.amazonses.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1574465484-7115-1-git-send-email-jcrouse@codeaurora.org>
References: <1574465484-7115-1-git-send-email-jcrouse@codeaurora.org>
X-SES-Outgoing: 2019.11.22-54.240.27.21
Feedback-ID: 1.us-west-2.CZuq2qbDmUIuT3qdvXlRHZZCpfZqZ4GtG9v3VKgRyF0=:AmazonSES
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/simple; 
 s=zsmsymrwgfyinv5wlfyidntwsjeeldzt; d=codeaurora.org; t=1574465519;
 h=From:To:Cc:Subject:Date:Message-Id:In-Reply-To:References;
 bh=ujD+t6S3GdDVcNP4xWAN1Vtk6wbhhHyNGHYlJn0JQRA=;
 b=DBFNbDpt6wKVwKLH3qNdkyprUBp0akGtajAU1rUbMctVMexReP1JTb5rcKjSLbUp
 EB3D5dGMy2gWzcgGustLIoalCbfH9INWtuDbhG3Grk5pg7DVQStPOOzsv7KcZyOXj/r
 exQ7D4kLN4qIqELjmv7zmeYkeoAwxSOpCzeQV+X0=
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/simple; 
 s=gdwg2y3kokkkj5a55z2ilkup5wp5hhxx; d=amazonses.com; t=1574465519;
 h=From:To:Cc:Subject:Date:Message-Id:In-Reply-To:References:Feedback-ID;
 bh=ujD+t6S3GdDVcNP4xWAN1Vtk6wbhhHyNGHYlJn0JQRA=;
 b=TqTbWabycHinW6Gn4JvhZN/fYASs+cNTli3rMnWQvtDY8eFbu4pg5uHN8pmcE5qi
 pHT8of34F6BVaRgn9u03uzJjS9TT7zmNqulNfmy7e1fNbeu7a3YzMACfniW7bzr6SaE
 usSCKiFXGRyAaicTFlJTQ3R7laB+5t/Zw/n+/wyg=
X-Mailman-Original-Authentication-Results: aws-us-west-2-caf-mail-1.web.codeaurora.org;
 dmarc=none (p=none dis=none) header.from=codeaurora.org
X-Mailman-Original-Authentication-Results: aws-us-west-2-caf-mail-1.web.codeaurora.org;
 spf=none smtp.mailfrom=jcrouse@codeaurora.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: freedreno@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 Jonathan Marek <jonathan@marek.ca>, Sam Ravnborg <sam@ravnborg.org>,
 Jeffrey Hugo <jeffrey.l.hugo@gmail.com>, David Airlie <airlied@linux.ie>,
 Sean Paul <sean@poorly.run>, robin.murphy@arm.com,
 dri-devel@lists.freedesktop.org, Georgi Djakov <georgi.djakov@linaro.org>,
 Bruce Wang <bzwang@chromium.org>, Mamta Shukla <mamtashukla555@gmail.com>,
 linux-arm-msm@vger.kernel.org, Drew Davenport <ddavenport@chromium.org>,
 AngeloGioacchino Del Regno <kholk11@gmail.com>, will@kernel.org,
 Thomas Gleixner <tglx@linutronix.de>, linux-arm-kernel@lists.infradead.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXZlcnl3aGVyZSBhbiBJT01NVSBvYmplY3QgaXMgY3JlYXRlZCBieSBtc21fZ3B1X2NyZWF0ZV9h
ZGRyZXNzX3NwYWNlCnRoZSBJT01NVSBkZXZpY2UgaXMgYXR0YWNoZWQgaW1tZWRpYXRlbHkgYWZ0
ZXIuIEluc3RlYWQgb2YgY2FycnlpbmcgYXJvdW5kCnRoZSBpbmZyYXN0cnVjdHVyZSB0byBkbyB0
aGUgYXR0YWNoIGZyb20gdGhlIGRldmljZSBzcGVjaWZpYyBjb2RlIGRvIGl0CmRpcmVjdGx5IGlu
IHRoZSBtc21faW9tbXVfaW5pdCgpIGZ1bmN0aW9uLiBUaGlzIGdldHMgaXQgb3V0IG9mIHRoZSB3
YXkgZm9yCm1vcmUgYWdncmVzc2l2ZSBjbGVhbnVwcyB0aGF0IGZvbGxvdy4KClNpZ25lZC1vZmYt
Ynk6IEpvcmRhbiBDcm91c2UgPGpjcm91c2VAY29kZWF1cm9yYS5vcmc+Ci0tLQoKIGRyaXZlcnMv
Z3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9rbXMuYyAgfCAgOCAtLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL21zbS9kaXNwL21kcDQvbWRwNF9rbXMuYyB8ICA0IC0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9tc20vZGlzcC9tZHA1L21kcDVfa21zLmMgfCAgNyAtLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
bXNtL21zbV9nZW1fdm1hLmMgICAgICAgIHwgMjMgKysrKysrKysrKysrKysrKysrKy0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5jICAgICAgICAgICAgfCAxMSArLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ3B1bW11LmMgICAgICAgICB8ICA2IC0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL21zbS9tc21faW9tbXUuYyAgICAgICAgICB8IDE1ICsrKysrKystLS0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL21zbS9tc21fbW11LmggICAgICAgICAgICB8ICAxIC0KIDggZmls
ZXMgY2hhbmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgNDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jIGIvZHJpdmVycy9ncHUv
ZHJtL21zbS9kaXNwL2RwdTEvZHB1X2ttcy5jCmluZGV4IDZjOTJmMGYuLmIwODJiMjMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9rbXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMKQEAgLTcwNCw3ICs3MDQsNiBAQCBz
dGF0aWMgaW50IF9kcHVfa21zX21tdV9pbml0KHN0cnVjdCBkcHVfa21zICpkcHVfa21zKQogewog
CXN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbjsKIAlzdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3Nw
YWNlICphc3BhY2U7Ci0JaW50IHJldDsKIAogCWRvbWFpbiA9IGlvbW11X2RvbWFpbl9hbGxvYygm
cGxhdGZvcm1fYnVzX3R5cGUpOwogCWlmICghZG9tYWluKQpAQCAtNzIwLDEzICs3MTksNiBAQCBz
dGF0aWMgaW50IF9kcHVfa21zX21tdV9pbml0KHN0cnVjdCBkcHVfa21zICpkcHVfa21zKQogCQly
ZXR1cm4gUFRSX0VSUihhc3BhY2UpOwogCX0KIAotCXJldCA9IGFzcGFjZS0+bW11LT5mdW5jcy0+
YXR0YWNoKGFzcGFjZS0+bW11KTsKLQlpZiAocmV0KSB7Ci0JCURQVV9FUlJPUigiZmFpbGVkIHRv
IGF0dGFjaCBpb21tdSAlZFxuIiwgcmV0KTsKLQkJbXNtX2dlbV9hZGRyZXNzX3NwYWNlX3B1dChh
c3BhY2UpOwotCQlyZXR1cm4gcmV0OwotCX0KLQogCWRwdV9rbXMtPmJhc2UuYXNwYWNlID0gYXNw
YWNlOwogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNw
L21kcDQvbWRwNF9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA0L21kcDRfa21z
LmMKaW5kZXggZGRhMDU0My4uOWRiYTM3YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21z
bS9kaXNwL21kcDQvbWRwNF9rbXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvbWRw
NC9tZHA0X2ttcy5jCkBAIC01MTgsMTAgKzUxOCw2IEBAIHN0cnVjdCBtc21fa21zICptZHA0X2tt
c19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCX0KIAogCQlrbXMtPmFzcGFjZSA9IGFz
cGFjZTsKLQotCQlyZXQgPSBhc3BhY2UtPm1tdS0+ZnVuY3MtPmF0dGFjaChhc3BhY2UtPm1tdSk7
Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGZhaWw7CiAJfSBlbHNlIHsKIAkJRFJNX0RFVl9JTkZPKGRl
di0+ZGV2LCAibm8gaW9tbXUsIGZhbGxiYWNrIHRvIHBoeXMgIgogCQkJCSJjb250aWcgYnVmZmVy
cyBmb3Igc2Nhbm91dFxuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3Av
bWRwNS9tZHA1X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9rbXMu
YwppbmRleCBlNDNlY2Q0Li42NTNkYWIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvbWRwNS9tZHA1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA1
L21kcDVfa21zLmMKQEAgLTczNiwxMyArNzM2LDYgQEAgc3RydWN0IG1zbV9rbXMgKm1kcDVfa21z
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJfQogCiAJCWttcy0+YXNwYWNlID0gYXNw
YWNlOwotCi0JCXJldCA9IGFzcGFjZS0+bW11LT5mdW5jcy0+YXR0YWNoKGFzcGFjZS0+bW11KTsK
LQkJaWYgKHJldCkgewotCQkJRFJNX0RFVl9FUlJPUigmcGRldi0+ZGV2LCAiZmFpbGVkIHRvIGF0
dGFjaCBpb21tdTogJWRcbiIsCi0JCQkJcmV0KTsKLQkJCWdvdG8gZmFpbDsKLQkJfQogCX0gZWxz
ZSB7CiAJCURSTV9ERVZfSU5GTygmcGRldi0+ZGV2LAogCQkJICJubyBpb21tdSwgZmFsbGJhY2sg
dG8gcGh5cyBjb250aWcgYnVmZmVycyBmb3Igc2Nhbm91dFxuIik7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9n
ZW1fdm1hLmMKaW5kZXggMWFmNTM1NC4uOTFkOTkzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9tc21fZ2VtX3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbV92
bWEuYwpAQCAtMTMxLDggKzEzMSw4IEBAIG1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVhdGUoc3Ry
dWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sCiAJCWNvbnN0IGNo
YXIgKm5hbWUpCiB7CiAJc3RydWN0IG1zbV9nZW1fYWRkcmVzc19zcGFjZSAqYXNwYWNlOwotCXU2
NCBzaXplID0gZG9tYWluLT5nZW9tZXRyeS5hcGVydHVyZV9lbmQgLQotCQlkb21haW4tPmdlb21l
dHJ5LmFwZXJ0dXJlX3N0YXJ0OworCXU2NCBzdGFydCA9IGRvbWFpbi0+Z2VvbWV0cnkuYXBlcnR1
cmVfc3RhcnQ7CisJdTY0IHNpemUgPSBkb21haW4tPmdlb21ldHJ5LmFwZXJ0dXJlX2VuZCAtIHN0
YXJ0OwogCiAJYXNwYWNlID0ga3phbGxvYyhzaXplb2YoKmFzcGFjZSksIEdGUF9LRVJORUwpOwog
CWlmICghYXNwYWNlKQpAQCAtMTQxLDkgKzE0MSwxOCBAQCBtc21fZ2VtX2FkZHJlc3Nfc3BhY2Vf
Y3JlYXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLAog
CXNwaW5fbG9ja19pbml0KCZhc3BhY2UtPmxvY2spOwogCWFzcGFjZS0+bmFtZSA9IG5hbWU7CiAJ
YXNwYWNlLT5tbXUgPSBtc21faW9tbXVfbmV3KGRldiwgZG9tYWluKTsKKwlpZiAoSVNfRVJSKGFz
cGFjZS0+bW11KSkgeworCQlpbnQgcmV0ID0gUFRSX0VSUihhc3BhY2UtPm1tdSk7CiAKLQlkcm1f
bW1faW5pdCgmYXNwYWNlLT5tbSwgKGRvbWFpbi0+Z2VvbWV0cnkuYXBlcnR1cmVfc3RhcnQgPj4g
UEFHRV9TSElGVCksCi0JCXNpemUgPj4gUEFHRV9TSElGVCk7CisJCWtmcmVlKGFzcGFjZSk7CisJ
CXJldHVybiBFUlJfUFRSKHJldCk7CisJfQorCisJLyoKKwkgKiBBdHRhY2hpbmcgdGhlIElPTU1V
IGRldmljZSBjaGFuZ2VzIHRoZSBhcGVydHVyZSB2YWx1ZXMgc28gdXNlIHRoZQorCSAqIGNhY2hl
ZCB2YWx1ZXMgaW5zdGVhZAorCSAqLworCWRybV9tbV9pbml0KCZhc3BhY2UtPm1tLCBzdGFydCA+
PiBQQUdFX1NISUZULCBzaXplID4+IFBBR0VfU0hJRlQpOwogCiAJa3JlZl9pbml0KCZhc3BhY2Ut
PmtyZWYpOwogCkBAIC0xNjQsNiArMTczLDEyIEBAIG1zbV9nZW1fYWRkcmVzc19zcGFjZV9jcmVh
dGVfYTJ4eChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBtc21fZ3B1ICpncHUsCiAJc3Bpbl9s
b2NrX2luaXQoJmFzcGFjZS0+bG9jayk7CiAJYXNwYWNlLT5uYW1lID0gbmFtZTsKIAlhc3BhY2Ut
Pm1tdSA9IG1zbV9ncHVtbXVfbmV3KGRldiwgZ3B1KTsKKwlpZiAoSVNfRVJSKGFzcGFjZS0+bW11
KSkgeworCQlpbnQgcmV0ID0gUFRSX0VSUihhc3BhY2UtPm1tdSk7CisKKwkJa2ZyZWUoYXNwYWNl
KTsKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwl9CiAKIAlkcm1fbW1faW5pdCgmYXNwYWNlLT5t
bSwgKHZhX3N0YXJ0ID4+IFBBR0VfU0hJRlQpLAogCQlzaXplID4+IFBBR0VfU0hJRlQpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ3B1LmMgYi9kcml2ZXJzL2dwdS9kcm0v
bXNtL21zbV9ncHUuYwppbmRleCAxOGYzYTVjLi5mN2JmODBlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbXNtL21zbV9ncHUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHUu
YwpAQCAtODA4LDcgKzgwOCw2IEBAIG1zbV9ncHVfY3JlYXRlX2FkZHJlc3Nfc3BhY2Uoc3RydWN0
IG1zbV9ncHUgKmdwdSwgc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAkJdWludDY0X3Qg
dmFfc3RhcnQsIHVpbnQ2NF90IHZhX2VuZCkKIHsKIAlzdHJ1Y3QgbXNtX2dlbV9hZGRyZXNzX3Nw
YWNlICphc3BhY2U7Ci0JaW50IHJldDsKIAogCS8qCiAJICogU2V0dXAgSU9NTVUuLiBldmVudHVh
bGx5IHdlIHdpbGwgKEkgdGhpbmspIGRvIHRoaXMgb25jZSBwZXIgY29udGV4dApAQCAtODMzLDE3
ICs4MzIsOSBAQCBtc21fZ3B1X2NyZWF0ZV9hZGRyZXNzX3NwYWNlKHN0cnVjdCBtc21fZ3B1ICpn
cHUsIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCiAJCQl2YV9zdGFydCwgdmFfZW5kKTsK
IAl9CiAKLQlpZiAoSVNfRVJSKGFzcGFjZSkpIHsKKwlpZiAoSVNfRVJSKGFzcGFjZSkpCiAJCURS
TV9ERVZfRVJST1IoZ3B1LT5kZXYtPmRldiwgImZhaWxlZCB0byBpbml0IG1tdTogJWxkXG4iLAog
CQkJUFRSX0VSUihhc3BhY2UpKTsKLQkJcmV0dXJuIEVSUl9DQVNUKGFzcGFjZSk7Ci0JfQotCi0J
cmV0ID0gYXNwYWNlLT5tbXUtPmZ1bmNzLT5hdHRhY2goYXNwYWNlLT5tbXUpOwotCWlmIChyZXQp
IHsKLQkJbXNtX2dlbV9hZGRyZXNzX3NwYWNlX3B1dChhc3BhY2UpOwotCQlyZXR1cm4gRVJSX1BU
UihyZXQpOwotCX0KIAogCXJldHVybiBhc3BhY2U7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbXNtL21zbV9ncHVtbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdW1tdS5j
CmluZGV4IDM0OTgwZDguLjBhZDBmODQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20v
bXNtX2dwdW1tdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdW1tdS5jCkBAIC0y
MSwxMSArMjEsNiBAQCBzdHJ1Y3QgbXNtX2dwdW1tdSB7CiAjZGVmaW5lIEdQVU1NVV9QQUdFX1NJ
WkUgU1pfNEsKICNkZWZpbmUgVEFCTEVfU0laRSAoc2l6ZW9mKHVpbnQzMl90KSAqIEdQVU1NVV9W
QV9SQU5HRSAvIEdQVU1NVV9QQUdFX1NJWkUpCiAKLXN0YXRpYyBpbnQgbXNtX2dwdW1tdV9hdHRh
Y2goc3RydWN0IG1zbV9tbXUgKm1tdSkKLXsKLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIHZvaWQg
bXNtX2dwdW1tdV9kZXRhY2goc3RydWN0IG1zbV9tbXUgKm1tdSkKIHsKIH0KQEAgLTg1LDcgKzgw
LDYgQEAgc3RhdGljIHZvaWQgbXNtX2dwdW1tdV9kZXN0cm95KHN0cnVjdCBtc21fbW11ICptbXUp
CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbXNtX21tdV9mdW5jcyBmdW5jcyA9IHsKLQkJLmF0
dGFjaCA9IG1zbV9ncHVtbXVfYXR0YWNoLAogCQkuZGV0YWNoID0gbXNtX2dwdW1tdV9kZXRhY2gs
CiAJCS5tYXAgPSBtc21fZ3B1bW11X21hcCwKIAkJLnVubWFwID0gbXNtX2dwdW1tdV91bm1hcCwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2lvbW11LmMgYi9kcml2ZXJzL2dw
dS9kcm0vbXNtL21zbV9pb21tdS5jCmluZGV4IGFkNThjZmUuLjU0NGM1MTkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2lvbW11LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21z
bS9tc21faW9tbXUuYwpAQCAtMjMsMTMgKzIzLDYgQEAgc3RhdGljIGludCBtc21fZmF1bHRfaGFu
ZGxlcihzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sIHN0cnVjdCBkZXZpY2UgKmRldiwKIAly
ZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBtc21faW9tbXVfYXR0YWNoKHN0cnVjdCBtc21fbW11
ICptbXUpCi17Ci0Jc3RydWN0IG1zbV9pb21tdSAqaW9tbXUgPSB0b19tc21faW9tbXUobW11KTsK
LQotCXJldHVybiBpb21tdV9hdHRhY2hfZGV2aWNlKGlvbW11LT5kb21haW4sIG1tdS0+ZGV2KTsK
LX0KLQogc3RhdGljIHZvaWQgbXNtX2lvbW11X2RldGFjaChzdHJ1Y3QgbXNtX21tdSAqbW11KQog
ewogCXN0cnVjdCBtc21faW9tbXUgKmlvbW11ID0gdG9fbXNtX2lvbW11KG1tdSk7CkBAIC02Niw3
ICs1OSw2IEBAIHN0YXRpYyB2b2lkIG1zbV9pb21tdV9kZXN0cm95KHN0cnVjdCBtc21fbW11ICpt
bXUpCiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbXNtX21tdV9mdW5jcyBmdW5jcyA9IHsKLQkJ
LmF0dGFjaCA9IG1zbV9pb21tdV9hdHRhY2gsCiAJCS5kZXRhY2ggPSBtc21faW9tbXVfZGV0YWNo
LAogCQkubWFwID0gbXNtX2lvbW11X21hcCwKIAkJLnVubWFwID0gbXNtX2lvbW11X3VubWFwLApA
QCAtNzYsNiArNjgsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IG1zbV9tbXVfZnVuY3MgZnVuY3Mg
PSB7CiBzdHJ1Y3QgbXNtX21tdSAqbXNtX2lvbW11X25ldyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0
cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbikKIHsKIAlzdHJ1Y3QgbXNtX2lvbW11ICppb21tdTsK
KwlpbnQgcmV0OwogCiAJaW9tbXUgPSBremFsbG9jKHNpemVvZigqaW9tbXUpLCBHRlBfS0VSTkVM
KTsKIAlpZiAoIWlvbW11KQpAQCAtODUsNSArNzgsMTEgQEAgc3RydWN0IG1zbV9tbXUgKm1zbV9p
b21tdV9uZXcoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4p
CiAJbXNtX21tdV9pbml0KCZpb21tdS0+YmFzZSwgZGV2LCAmZnVuY3MpOwogCWlvbW11X3NldF9m
YXVsdF9oYW5kbGVyKGRvbWFpbiwgbXNtX2ZhdWx0X2hhbmRsZXIsIGlvbW11KTsKIAorCXJldCA9
IGlvbW11X2F0dGFjaF9kZXZpY2UoaW9tbXUtPmRvbWFpbiwgZGV2KTsKKwlpZiAocmV0KSB7CisJ
CWtmcmVlKGlvbW11KTsKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwl9CisKIAlyZXR1cm4gJmlv
bW11LT5iYXNlOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fbW11Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9tbXUuaAppbmRleCA2N2E2MjNmLi5iYWU5ZThlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9tbXUuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vbXNtL21zbV9tbXUuaApAQCAtMTAsNyArMTAsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2lv
bW11Lmg+CiAKIHN0cnVjdCBtc21fbW11X2Z1bmNzIHsKLQlpbnQgKCphdHRhY2gpKHN0cnVjdCBt
c21fbW11ICptbXUpOwogCXZvaWQgKCpkZXRhY2gpKHN0cnVjdCBtc21fbW11ICptbXUpOwogCWlu
dCAoKm1hcCkoc3RydWN0IG1zbV9tbXUgKm1tdSwgdWludDY0X3QgaW92YSwgc3RydWN0IHNnX3Rh
YmxlICpzZ3QsCiAJCQl1bnNpZ25lZCBsZW4sIGludCBwcm90KTsKLS0gCjIuNy40CgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
