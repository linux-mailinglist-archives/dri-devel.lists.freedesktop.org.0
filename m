Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BC10CC2981
	for <lists+dri-devel@lfdr.de>; Tue,  1 Oct 2019 00:28:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3F4BE6E417;
	Mon, 30 Sep 2019 22:28:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 806186E417
 for <dri-devel@lists.freedesktop.org>; Mon, 30 Sep 2019 22:28:29 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: ezequiel) with ESMTPSA id 15B6728A800
From: Ezequiel Garcia <ezequiel@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 3/5] drm/rockchip: Add optional support for CRTC gamma LUT
Date: Mon, 30 Sep 2019 19:28:00 -0300
Message-Id: <20190930222802.32088-4-ezequiel@collabora.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190930222802.32088-1-ezequiel@collabora.com>
References: <20190930222802.32088-1-ezequiel@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, devicetree@vger.kernel.org,
 Jacopo Mondi <jacopo@jmondi.org>, linux-kernel@vger.kernel.org,
 Rob Herring <robh+dt@kernel.org>, Douglas Anderson <dianders@chromium.org>,
 linux-rockchip@lists.infradead.org,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Sean Paul <seanpaul@chromium.org>, Jacopo Mondi <jacopo+renesas@jmondi.org>,
 kernel@collabora.com, Ezequiel Garcia <ezequiel@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGFuIG9wdGlvbmFsIENSVEMgZ2FtbWEgTFVUIHN1cHBvcnQsIGFuZCBlbmFibGUgaXQgb24g
UkszMjg4LgpUaGlzIGlzIGN1cnJlbnRseSBlbmFibGVkIHZpYSBhIHNlcGFyYXRlIGFkZHJlc3Mg
cmVzb3VyY2UsCndoaWNoIG5lZWRzIHRvIGJlIHNwZWNpZmllZCBpbiB0aGUgZGV2aWNldHJlZS4K
ClRoZSBhZGRyZXNzIHJlc291cmNlIGlzIHJlcXVpcmVkIGJlY2F1c2Ugb24gc29tZSBTb0NzLCBz
dWNoIGFzClJLMzI4OCwgdGhlIExVVCBhZGRyZXNzIGlzIGFmdGVyIHRoZSBNTVUgYWRkcmVzcywg
YW5kIHRoZSBsYXR0ZXIKaXMgc3VwcG9ydGVkIGJ5IGEgZGlmZmVyZW50IGRyaXZlci4gVGhpcyBw
cmV2ZW50cyB0aGUgRFJNIGRyaXZlcgpmcm9tIHJlcXVlc3RpbmcgYW4gZW50aXJlIHJlZ2lzdGVy
IHNwYWNlLgoKVGhlIGN1cnJlbnQgaW1wbGVtZW50YXRpb24gd29ya3MgZm9yIFJHQiAxMC1iaXQg
dGFibGVzLCBhcyB0aGF0CmlzIHdoYXQgc2VlbXMgdG8gd29yayBvbiBSSzMyODguCgpTaWduZWQt
b2ZmLWJ5OiBFemVxdWllbCBHYXJjaWEgPGV6ZXF1aWVsQGNvbGxhYm9yYS5jb20+ClJldmlld2Vk
LWJ5OiBEb3VnbGFzIEFuZGVyc29uIDxkaWFuZGVyc0BjaHJvbWl1bS5vcmc+ClJldmlld2VkLWJ5
OiBKYWNvcG8gTW9uZGkgPGphY29wbytyZW5lc2FzQGptb25kaS5vcmc+Ci0tLQpDaGFuZ2VzIGZy
b20gdjI6CiogTm9uZS4KCkNoYW5nZXMgZnJvbSB2MToKKiBkcm9wIGV4cGxpY2l0IGxpbmVhciBM
VVQgYWZ0ZXIgZmluZGluZyBhIHByb3BlcgogIHdheSB0byBkaXNhYmxlIGdhbW1hIGNvcnJlY3Rp
b24uCiogYXZvaWQgc2V0dGluZyBnYW1tYSBpcyB0aGUgQ1JUQyBpcyBub3QgYWN0aXZlLgoqIHMv
aW50L3Vuc2lnbmVkIGludCBhcyBzdWdnZXN0ZWQgYnkgSmFjb3BvLgoqIG9ubHkgZW5hYmxlIGNv
bG9yIG1hbmFnZW1lbnQgYW5kIHNldCBnYW1tYSBzaXplCiAgaWYgZ2FtbWEgTFVUIGlzIHN1cHBv
cnRlZCwgc3VnZ2VzdGVkIGJ5IERvdWcuCiogZHJvcCB0aGUgcmVnLW5hbWVzIHVzYWdlLCBhbmQg
aW5zdGVhZCBqdXN0IHVzZSBpbmRleGVkIHJlZwogIHNwZWNpZmllcnMsIHN1Z2dlc3RlZCBieSBE
b3VnLgoKQ2hhbmdlcyBmcm9tIFJGQzoKKiBSZXF1ZXN0IChhbiBvcHRpb25hbCkgYWRkcmVzcyBy
ZXNvdXJjZSBmb3IgdGhlIExVVC4KKiBEcm9wIHN1cHBvcnQgZm9yIFJLMzM5OSwgd2hpY2ggZG9l
c24ndCBzZWVtIHRvIHdvcmsKICBvdXQgb2YgdGhlIGJveCBhbmQgbmVlZHMgbW9yZSByZXNlYXJj
aC4KKiBTdXBwb3J0IHBhc3MtdGhydSBzZXR0aW5nIHdoZW4gR0FNTUFfTFVUIGlzIE5VTEwuCiog
QWRkIGEgY2hlY2sgZm9yIHRoZSBnYW1tYSBzaXplLCBhcyBzdWdnZXN0ZWQgYnkgSWxpYS4KKiBN
b3ZlIGdhbW1hIHNldHRpbmcgdG8gYXRvbWljX2NvbW1pdF90YWlsLCBhcyBwb2ludGVkCiAgb3V0
IGJ5IEphY29wby9MYXVyZW50LCBpcyB0aGUgY29ycmVjdCB3YXkuCi0tLQogZHJpdmVycy9ncHUv
ZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0v
cm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jIHwgMTE0ICsrKysrKysrKysrKysrKysrKysrCiBk
cml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5oIHwgICA3ICsrCiBkcml2
ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfdm9wX3JlZy5jIHwgICAyICsKIDQgZmlsZXMg
Y2hhbmdlZCwgMTI2IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
cm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmMgYi9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9j
a2NoaXBfZHJtX2ZiLmMKaW5kZXggZGJhMzUyZWMwZWUzLi5mZDFkOTg3Njk4YWIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fZmIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmMKQEAgLTE3LDYgKzE3LDcgQEAK
ICNpbmNsdWRlICJyb2NrY2hpcF9kcm1fZHJ2LmgiCiAjaW5jbHVkZSAicm9ja2NoaXBfZHJtX2Zi
LmgiCiAjaW5jbHVkZSAicm9ja2NoaXBfZHJtX2dlbS5oIgorI2luY2x1ZGUgInJvY2tjaGlwX2Ry
bV92b3AuaCIKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXJfZnVuY3Mgcm9j
a2NoaXBfZHJtX2ZiX2Z1bmNzID0gewogCS5kZXN0cm95ICAgICAgID0gZHJtX2dlbV9mYl9kZXN0
cm95LApAQCAtMTEyLDYgKzExMyw4IEBAIHJvY2tjaGlwX2F0b21pY19oZWxwZXJfY29tbWl0X3Rh
aWxfcnBtKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiAKIAlkcm1fYXRvbWlj
X2hlbHBlcl9jb21taXRfbW9kZXNldF9kaXNhYmxlcyhkZXYsIG9sZF9zdGF0ZSk7CiAKKwlyb2Nr
Y2hpcF9kcm1fdm9wX2dhbW1hX3NldChvbGRfc3RhdGUpOworCiAJZHJtX2F0b21pY19oZWxwZXJf
Y29tbWl0X21vZGVzZXRfZW5hYmxlcyhkZXYsIG9sZF9zdGF0ZSk7CiAKIAlkcm1fYXRvbWljX2hl
bHBlcl9jb21taXRfcGxhbmVzKGRldiwgb2xkX3N0YXRlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYyBiL2RyaXZlcnMvZ3B1L2RybS9yb2Nr
Y2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMKaW5kZXggMmY4MjFjNTgwMDdjLi4zYTQ5Nzk0YzZhNDMg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYwpAQCAtMTQx
LDYgKzE0MSw3IEBAIHN0cnVjdCB2b3AgewogCiAJdWludDMyX3QgKnJlZ3NiYWs7CiAJdm9pZCBf
X2lvbWVtICpyZWdzOworCXZvaWQgX19pb21lbSAqbHV0X3JlZ3M7CiAKIAkvKiBwaHlzaWNhbCBt
YXAgbGVuZ3RoIG9mIHZvcCByZWdpc3RlciAqLwogCXVpbnQzMl90IGxlbjsKQEAgLTExOTMsNiAr
MTE5NCwxMDIgQEAgc3RhdGljIHZvaWQgdm9wX3dhaXRfZm9yX2lycV9oYW5kbGVyKHN0cnVjdCB2
b3AgKnZvcCkKIAlzeW5jaHJvbml6ZV9pcnEodm9wLT5pcnEpOwogfQogCitzdGF0aWMgYm9vbCB2
b3BfZHNwX2x1dF9pc19lbmFibGUoc3RydWN0IHZvcCAqdm9wKQoreworCXJldHVybiB2b3BfcmVh
ZF9yZWcodm9wLCAwLCAmdm9wLT5kYXRhLT5jb21tb24tPmRzcF9sdXRfZW4pOworfQorCitzdGF0
aWMgdm9pZCB2b3BfY3J0Y193cml0ZV9nYW1tYV9sdXQoc3RydWN0IHZvcCAqdm9wLCBzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMpCit7CisJc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGNydGMtPnN0
YXRlLT5nYW1tYV9sdXQtPmRhdGE7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBp
IDwgY3J0Yy0+Z2FtbWFfc2l6ZTsgaSsrKSB7CisJCXUzMiB3b3JkOworCisJCXdvcmQgPSAoZHJt
X2NvbG9yX2x1dF9leHRyYWN0KGx1dFtpXS5yZWQsIDEwKSA8PCAyMCkgfAorCQkgICAgICAgKGRy
bV9jb2xvcl9sdXRfZXh0cmFjdChsdXRbaV0uZ3JlZW4sIDEwKSA8PCAxMCkgfAorCQkJZHJtX2Nv
bG9yX2x1dF9leHRyYWN0KGx1dFtpXS5ibHVlLCAxMCk7CisJCXdyaXRlbCh3b3JkLCB2b3AtPmx1
dF9yZWdzICsgaSAqIDQpOworCX0KK30KKworc3RhdGljIHZvaWQgdm9wX2NydGNfZ2FtbWFfc2V0
KHN0cnVjdCB2b3AgKnZvcCwgc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJICAgICAgIHN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlKQoreworCXVuc2lnbmVkIGludCBpZGxlOworCWlu
dCByZXQ7CisKKwkvKgorCSAqIEluIG9yZGVyIHRvIHdyaXRlIHRoZSBMVVQgdG8gdGhlIGludGVy
bmFsIFJBTSBtZW1vcnksCisJICogd2UgbmVlZCB0byBmaXJzdCBtYWtlIHN1cmUgdGhlIGRzcF9s
dXRfZW4gYml0IGlzIGNsZWFyZWQuCisJICovCisJc3Bpbl9sb2NrKCZ2b3AtPnJlZ19sb2NrKTsK
KwlWT1BfUkVHX1NFVCh2b3AsIGNvbW1vbiwgZHNwX2x1dF9lbiwgMCk7CisJdm9wX2NmZ19kb25l
KHZvcCk7CisJc3Bpbl91bmxvY2soJnZvcC0+cmVnX2xvY2spOworCisJLyoKKwkgKiBJZiB0aGUg
Q1JUQyBpcyBub3QgYWN0aXZlLCBkc3BfbHV0X2VuIHdpbGwgbm90IGdldCBjbGVhcmVkLgorCSAq
IEFwcGFyZW50bHkgd2Ugc3RpbGwgbmVlZCB0byBkbyB0aGUgYWJvdmUgc3RlcCB0byBmb3IKKwkg
KiBnYW1tYSBjb3JyZWN0aW9uIHRvIGJlIGRpc2FibGVkLgorCSAqLworCWlmICghY3J0Yy0+c3Rh
dGUtPmFjdGl2ZSkKKwkJcmV0dXJuOworCisJcmV0ID0gcmVhZHhfcG9sbF90aW1lb3V0KHZvcF9k
c3BfbHV0X2lzX2VuYWJsZSwgdm9wLAorCQkJCSBpZGxlLCAhaWRsZSwgNSwgMzAgKiAxMDAwKTsK
KwlpZiAocmV0KSB7CisJCURSTV9ERVZfRVJST1Iodm9wLT5kZXYsICJkaXNwbGF5IExVVCBSQU0g
ZW5hYmxlIHRpbWVvdXQhXG4iKTsKKwkJcmV0dXJuOworCX0KKworCXNwaW5fbG9jaygmdm9wLT5y
ZWdfbG9jayk7CisKKwlpZiAoY3J0Yy0+c3RhdGUtPmdhbW1hX2x1dCAmJgorCSAgICghb2xkX3N0
YXRlLT5nYW1tYV9sdXQgfHwgKGNydGMtPnN0YXRlLT5nYW1tYV9sdXQtPmJhc2UuaWQgIT0KKwkJ
CQkgICAgICBvbGRfc3RhdGUtPmdhbW1hX2x1dC0+YmFzZS5pZCkpKQorCQl2b3BfY3J0Y193cml0
ZV9nYW1tYV9sdXQodm9wLCBjcnRjKTsKKworCVZPUF9SRUdfU0VUKHZvcCwgY29tbW9uLCBkc3Bf
bHV0X2VuLCAxKTsKKwl2b3BfY2ZnX2RvbmUodm9wKTsKKwlzcGluX3VubG9jaygmdm9wLT5yZWdf
bG9jayk7Cit9CisKK3N0YXRpYyBpbnQgdm9wX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywKKwkJCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQorewor
CXN0cnVjdCB2b3AgKnZvcCA9IHRvX3ZvcChjcnRjKTsKKworCWlmICh2b3AtPmx1dF9yZWdzICYm
IGNydGNfc3RhdGUtPmNvbG9yX21nbXRfY2hhbmdlZCAmJgorCSAgICBjcnRjX3N0YXRlLT5nYW1t
YV9sdXQpIHsKKwkJdW5zaWduZWQgaW50IGxlbjsKKworCQlsZW4gPSBkcm1fY29sb3JfbHV0X3Np
emUoY3J0Y19zdGF0ZS0+Z2FtbWFfbHV0KTsKKwkJaWYgKGxlbiAhPSBjcnRjLT5nYW1tYV9zaXpl
KSB7CisJCQlEUk1fREVCVUdfS01TKCJJbnZhbGlkIExVVCBzaXplOyBnb3QgJWQsIGV4cGVjdGVk
ICVkXG4iLAorCQkJCSAgICAgIGxlbiwgY3J0Yy0+Z2FtbWFfc2l6ZSk7CisJCQlyZXR1cm4gLUVJ
TlZBTDsKKwkJfQorCX0KKworCXJldHVybiAwOworfQorCit2b2lkIHJvY2tjaGlwX2RybV92b3Bf
Z2FtbWFfc2V0KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJt
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKwl1
bnNpZ25lZCBpbnQgaTsKKworCWZvcl9lYWNoX29sZF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRj
LCBvbGRfY3J0Y19zdGF0ZSwgaSkgeworCQlzdHJ1Y3Qgdm9wICp2b3AgPSB0b192b3AoY3J0Yyk7
CisKKwkJaWYgKHZvcC0+bHV0X3JlZ3MgJiYgY3J0Yy0+c3RhdGUtPmNvbG9yX21nbXRfY2hhbmdl
ZCkKKwkJCXZvcF9jcnRjX2dhbW1hX3NldCh2b3AsIGNydGMsIG9sZF9jcnRjX3N0YXRlKTsKKwl9
Cit9CisKIHN0YXRpYyB2b2lkIHZvcF9jcnRjX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCiAJCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewpA
QCAtMTI0NSw2ICsxMzQyLDcgQEAgc3RhdGljIHZvaWQgdm9wX2NydGNfYXRvbWljX2ZsdXNoKHN0
cnVjdCBkcm1fY3J0YyAqY3J0YywKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19oZWxw
ZXJfZnVuY3Mgdm9wX2NydGNfaGVscGVyX2Z1bmNzID0gewogCS5tb2RlX2ZpeHVwID0gdm9wX2Ny
dGNfbW9kZV9maXh1cCwKKwkuYXRvbWljX2NoZWNrID0gdm9wX2NydGNfYXRvbWljX2NoZWNrLAog
CS5hdG9taWNfZmx1c2ggPSB2b3BfY3J0Y19hdG9taWNfZmx1c2gsCiAJLmF0b21pY19lbmFibGUg
PSB2b3BfY3J0Y19hdG9taWNfZW5hYmxlLAogCS5hdG9taWNfZGlzYWJsZSA9IHZvcF9jcnRjX2F0
b21pY19kaXNhYmxlLApAQCAtMTM2Myw2ICsxNDYxLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fY3J0Y19mdW5jcyB2b3BfY3J0Y19mdW5jcyA9IHsKIAkuZGlzYWJsZV92YmxhbmsgPSB2b3Bf
Y3J0Y19kaXNhYmxlX3ZibGFuaywKIAkuc2V0X2NyY19zb3VyY2UgPSB2b3BfY3J0Y19zZXRfY3Jj
X3NvdXJjZSwKIAkudmVyaWZ5X2NyY19zb3VyY2UgPSB2b3BfY3J0Y192ZXJpZnlfY3JjX3NvdXJj
ZSwKKwkuZ2FtbWFfc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfbGVnYWN5X2dhbW1hX3NldCwKIH07
CiAKIHN0YXRpYyB2b2lkIHZvcF9mYl91bnJlZl93b3JrZXIoc3RydWN0IGRybV9mbGlwX3dvcmsg
KndvcmssIHZvaWQgKnZhbCkKQEAgLTE1MjAsNiArMTYxOSwxMCBAQCBzdGF0aWMgaW50IHZvcF9j
cmVhdGVfY3J0YyhzdHJ1Y3Qgdm9wICp2b3ApCiAJCWdvdG8gZXJyX2NsZWFudXBfcGxhbmVzOwog
CiAJZHJtX2NydGNfaGVscGVyX2FkZChjcnRjLCAmdm9wX2NydGNfaGVscGVyX2Z1bmNzKTsKKwlp
ZiAodm9wLT5sdXRfcmVncykgeworCQlkcm1fbW9kZV9jcnRjX3NldF9nYW1tYV9zaXplKGNydGMs
IHZvcF9kYXRhLT5sdXRfc2l6ZSk7CisJCWRybV9jcnRjX2VuYWJsZV9jb2xvcl9tZ210KGNydGMs
IDAsIGZhbHNlLCB2b3BfZGF0YS0+bHV0X3NpemUpOworCX0KIAogCS8qCiAJICogQ3JlYXRlIGRy
bV9wbGFuZXMgZm9yIG92ZXJsYXkgd2luZG93cyB3aXRoIHBvc3NpYmxlX2NydGNzIHJlc3RyaWN0
ZWQKQEAgLTE4MjUsNiArMTkyOCwxNyBAQCBzdGF0aWMgaW50IHZvcF9iaW5kKHN0cnVjdCBkZXZp
Y2UgKmRldiwgc3RydWN0IGRldmljZSAqbWFzdGVyLCB2b2lkICpkYXRhKQogCWlmIChJU19FUlIo
dm9wLT5yZWdzKSkKIAkJcmV0dXJuIFBUUl9FUlIodm9wLT5yZWdzKTsKIAorCXJlcyA9IHBsYXRm
b3JtX2dldF9yZXNvdXJjZShwZGV2LCBJT1JFU09VUkNFX01FTSwgMSk7CisJaWYgKHJlcykgewor
CQlpZiAoIXZvcF9kYXRhLT5sdXRfc2l6ZSkgeworCQkJRFJNX0RFVl9FUlJPUihkZXYsICJubyBn
YW1tYSBMVVQgc2l6ZSBkZWZpbmVkXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCXZv
cC0+bHV0X3JlZ3MgPSBkZXZtX2lvcmVtYXBfcmVzb3VyY2UoZGV2LCByZXMpOworCQlpZiAoSVNf
RVJSKHZvcC0+bHV0X3JlZ3MpKQorCQkJcmV0dXJuIFBUUl9FUlIodm9wLT5sdXRfcmVncyk7CisJ
fQorCiAJdm9wLT5yZWdzYmFrID0gZGV2bV9remFsbG9jKGRldiwgdm9wLT5sZW4sIEdGUF9LRVJO
RUwpOwogCWlmICghdm9wLT5yZWdzYmFrKQogCQlyZXR1cm4gLUVOT01FTTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmggYi9kcml2ZXJzL2dw
dS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5oCmluZGV4IDIxNDlhODg5YzI5ZC4uYmQx
YmNkNWExNGU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBf
ZHJtX3ZvcC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9w
LmgKQEAgLTcsNiArNyw4IEBACiAjaWZuZGVmIF9ST0NLQ0hJUF9EUk1fVk9QX0gKICNkZWZpbmUg
X1JPQ0tDSElQX0RSTV9WT1BfSAogCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKwogLyoK
ICAqIG1ham9yOiBJUCBtYWpvciB2ZXJzaW9uLCB1c2VkIGZvciBJUCBzdHJ1Y3R1cmUKICAqIG1p
bm9yOiBiaWcgZmVhdHVyZSBjaGFuZ2UgdW5kZXIgc2FtZSBzdHJ1Y3R1cmUKQEAgLTY3LDYgKzY5
LDcgQEAgc3RydWN0IHZvcF9jb21tb24gewogCXN0cnVjdCB2b3BfcmVnIGRpdGhlcl9kb3duX21v
ZGU7CiAJc3RydWN0IHZvcF9yZWcgZGl0aGVyX2Rvd25fZW47CiAJc3RydWN0IHZvcF9yZWcgZGl0
aGVyX3VwOworCXN0cnVjdCB2b3BfcmVnIGRzcF9sdXRfZW47CiAJc3RydWN0IHZvcF9yZWcgZ2F0
ZV9lbjsKIAlzdHJ1Y3Qgdm9wX3JlZyBtbXVfZW47CiAJc3RydWN0IHZvcF9yZWcgb3V0X21vZGU7
CkBAIC0xNzAsNiArMTczLDcgQEAgc3RydWN0IHZvcF9kYXRhIHsKIAljb25zdCBzdHJ1Y3Qgdm9w
X3dpbl95dXYyeXV2X2RhdGEgKndpbl95dXYyeXV2OwogCWNvbnN0IHN0cnVjdCB2b3Bfd2luX2Rh
dGEgKndpbjsKIAl1bnNpZ25lZCBpbnQgd2luX3NpemU7CisJdW5zaWduZWQgaW50IGx1dF9zaXpl
OwogCiAjZGVmaW5lIFZPUF9GRUFUVVJFX09VVFBVVF9SR0IxMAlCSVQoMCkKICNkZWZpbmUgVk9Q
X0ZFQVRVUkVfSU5URVJOQUxfUkdCCUJJVCgxKQpAQCAtMzczLDQgKzM3Nyw3IEBAIHN0YXRpYyBp
bmxpbmUgaW50IHNjbF92b3BfY2FsX2xiX21vZGUoaW50IHdpZHRoLCBib29sIGlzX3l1dikKIH0K
IAogZXh0ZXJuIGNvbnN0IHN0cnVjdCBjb21wb25lbnRfb3BzIHZvcF9jb21wb25lbnRfb3BzOwor
Cit2b2lkIHJvY2tjaGlwX2RybV92b3BfZ2FtbWFfc2V0KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSk7CisKICNlbmRpZiAvKiBfUk9DS0NISVBfRFJNX1ZPUF9IICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfdm9wX3JlZy5jIGIvZHJpdmVycy9n
cHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX3ZvcF9yZWcuYwppbmRleCBkMTQ5NGJlMTQ0NzEuLjQy
ZGRjYjY5OGM4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlw
X3ZvcF9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfdm9wX3Jl
Zy5jCkBAIC01OTgsNiArNTk4LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB2b3BfY29tbW9uIHJr
MzI4OF9jb21tb24gPSB7CiAJLmRpdGhlcl9kb3duX2VuID0gVk9QX1JFRyhSSzMyODhfRFNQX0NU
UkwxLCAweDEsIDIpLAogCS5wcmVfZGl0aGVyX2Rvd24gPSBWT1BfUkVHKFJLMzI4OF9EU1BfQ1RS
TDEsIDB4MSwgMSksCiAJLmRpdGhlcl91cCA9IFZPUF9SRUcoUkszMjg4X0RTUF9DVFJMMSwgMHgx
LCA2KSwKKwkuZHNwX2x1dF9lbiA9IFZPUF9SRUcoUkszMjg4X0RTUF9DVFJMMSwgMHgxLCAwKSwK
IAkuZGF0YV9ibGFuayA9IFZPUF9SRUcoUkszMjg4X0RTUF9DVFJMMCwgMHgxLCAxOSksCiAJLmRz
cF9ibGFuayA9IFZPUF9SRUcoUkszMjg4X0RTUF9DVFJMMCwgMHgzLCAxOCksCiAJLm91dF9tb2Rl
ID0gVk9QX1JFRyhSSzMyODhfRFNQX0NUUkwwLCAweGYsIDApLApAQCAtNjQ2LDYgKzY0Nyw3IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3Qgdm9wX2RhdGEgcmszMjg4X3ZvcCA9IHsKIAkub3V0cHV0ID0g
JnJrMzI4OF9vdXRwdXQsCiAJLndpbiA9IHJrMzI4OF92b3Bfd2luX2RhdGEsCiAJLndpbl9zaXpl
ID0gQVJSQVlfU0laRShyazMyODhfdm9wX3dpbl9kYXRhKSwKKwkubHV0X3NpemUgPSAxMDI0LAog
fTsKIAogc3RhdGljIGNvbnN0IGludCByazMzNjhfdm9wX2ludHJzW10gPSB7Ci0tIAoyLjIyLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZl
bCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
