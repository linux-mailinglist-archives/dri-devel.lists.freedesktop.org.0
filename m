Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DEF02106888
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 10:01:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43C5A6F4F7;
	Fri, 22 Nov 2019 09:01:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM05-CO1-obe.outbound.protection.outlook.com
 (mail-eopbgr720115.outbound.protection.outlook.com [40.107.72.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 429406E2B2
 for <dri-devel@lists.freedesktop.org>; Fri, 22 Nov 2019 08:24:52 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=BwXrUIYaoSpOVKUKkPMe4MUJLJxxMuG8jvWAT9fFoeL17SmLsoesmxR7PAKD5Qb7xflJ3BCkSuD8VMtV09eR1G+qOVnOC8cOHjwqywL+kSD6ZygkCs8bE1nSxd844d91q3riAwljkIjj3GR65yM81IyATr3b9p7AGHHCYdTKin4dJwDr62FEcX34Y/VoWGLWooB5+fh79BfqNnkYfmUvG1ZnXtI9r+uh0CAuS9UY/aqQE0euW+5VPiyr6gHCRRD8Nvg9hDg8Bnwt1v5zSWod3WyQQJHe4NBaoOayHUJypb1Uvt1wj9eGAc9RX/faxZPyO54IZo/H7PT3cM6kbvaX8w==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=/XkyxbUNFMVr8OLWw+QBvJe5T0Xpw1K97dNA+kLAmHs=;
 b=kDmUl3hAK1iKX7bvNIxaF250LW/rQBOpK+DWAd6qmX9833oDRlQnlZCytt9tdnyntfKdIQ/3Lz66oTM4A0yB4e/VV0+qv0vUzsj0yQKCZF7e82zTRTBPYJ5zcxXediTtJ/HJ9YJDTZua6gk4bQMl7wLIxbwxCvlkpgKZ1NLVr8SqZ44hYppv7Sqm985FB2TNA4QjYjcYGM0wryuXSQ5c7D4PabHNtwYT3/vl/Etmw50tGlm5Ah9cL5hsYCokieiWqkn7AWS0ZSFt8XAbuo4DIU23MDh9EfuBX4RyeBo4jBAzVwcFh4lbt46d6KQmoaB5qh83PUQ7xkHQ2HWkviXuwQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from CH2PR21MB1447.namprd21.prod.outlook.com (20.180.11.151) by
 CH2PR21MB1461.namprd21.prod.outlook.com (20.180.9.71) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2495.3; Fri, 22 Nov 2019 08:24:50 +0000
Received: from CH2PR21MB1447.namprd21.prod.outlook.com
 ([fe80::6c54:3203:ae0c:6f4]) by CH2PR21MB1447.namprd21.prod.outlook.com
 ([fe80::6c54:3203:ae0c:6f4%5]) with mapi id 15.20.2495.010; Fri, 22 Nov 2019
 08:24:49 +0000
From: Wei Hu <weh@microsoft.com>
To: b.zolnierkie@samsung.com, kys@microsoft.com, haiyangz@microsoft.com,
 sthemmin@microsoft.com, sashal@kernel.org, hch@lst.de,
 m.szyprowski@samsung.com, mchehab+samsung@kernel.org, sam@ravnborg.org,
 gregkh@linuxfoundation.org, alexandre.belloni@bootlin.com, info@metux.net,
 arnd@arndb.de, dri-devel@lists.freedesktop.org,
 linux-fbdev@vger.kernel.org, linux-kernel@vger.kernel.org,
 linux-hyperv@vger.kernel.org, decui@microsoft.com, mikelley@microsoft.com
Subject: [PATCH v2] video: hyperv: hyperv_fb: Use physical memory for fb on
 HyperV Gen 1 VMs.
Date: Fri, 22 Nov 2019 16:24:08 +0800
Message-Id: <20191122082408.3210-1-weh@microsoft.com>
X-Mailer: git-send-email 2.20.1
X-ClientProxiedBy: SG2PR02CA0002.apcprd02.prod.outlook.com
 (2603:1096:3:17::14) To CH2PR21MB1447.namprd21.prod.outlook.com
 (2603:10b6:610:8c::23)
MIME-Version: 1.0
Received: from weh-g1-u1904d-testwin10.corp.microsoft.com (167.220.255.113) by
 SG2PR02CA0002.apcprd02.prod.outlook.com (2603:1096:3:17::14) with Microsoft
 SMTP Server (version=TLS1_2, cipher=) via Frontend Transport;
 Fri, 22 Nov 2019 08:24:43 +0000
X-Mailer: git-send-email 2.20.1
X-Originating-IP: [167.220.255.113]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: 497ac35a-c01e-416e-c8a2-08d76f2570e8
X-MS-TrafficTypeDiagnostic: CH2PR21MB1461:|CH2PR21MB1461:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <CH2PR21MB14613DCE140FCCDE213E2712BB490@CH2PR21MB1461.namprd21.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:2150;
X-Forefront-PRVS: 02296943FF
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10019020)(39860400002)(396003)(366004)(136003)(346002)(376002)(199004)(189003)(14444005)(6636002)(2906002)(2870700001)(305945005)(7736002)(6116002)(6666004)(3450700001)(7416002)(22452003)(316002)(1511001)(43066004)(386003)(3846002)(51416003)(7696005)(52116002)(30864003)(48376002)(47776003)(1076003)(6486002)(5660300002)(66066001)(81166006)(50466002)(36756003)(6436002)(25786009)(478600001)(10290500003)(66946007)(8676002)(8936002)(2616005)(50226002)(186003)(86362001)(956004)(81156014)(26005)(66476007)(16526019)(107886003)(4326008)(1250700005)(10090500001)(66556008)(921003)(1121003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:CH2PR21MB1461;
 H:CH2PR21MB1447.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
Received-SPF: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: T5rzk2ChX9QKkvup8ntMttAAoEVJtRH25cC0wfdO0aNhQsZlPiA7iX+ImOJa1W/IHSSwi8SYmwly4+M9LCGPsQbBPOt/vEHJYgBbm8fjA/8s8J44Wmn7n6njOiXkrmtEUxZGJDr5H8P4brtljNTcXXuTSlmEziecLQobJ9D/0QKDigHFHildRmwFh+AVvlRhiNNTXxy+ocDkiYPE+40jimpLX5+4qkL0tbBxruF7RN1jKdrWaAQgimdhVn5kW+r/jJGV/sVJzlG/3yN04SLKKa9O0YW2lBqVsXm641n/XpCbOIYEtcfdMZm+ZnDAIRZHWKWo2WaIZI2RJ5VCvnJGzcx0mxZW0XyydqsRQwVrKt1aSTG1OnrnPceu+6gz6pZZ/WYMYOjSXza94rjkBSzIpXp3dUUr6wj28idimB+wtJ9yWZ7NnpImOX8GXbzpBwF4
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 497ac35a-c01e-416e-c8a2-08d76f2570e8
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 22 Nov 2019 08:24:49.8804 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: 98CgGTW24u4eEuFrmF5mrnyetsc9+whRDYTl2zRA04/Fg36v3LvRP7g6sGRFCuY/TznKVeVOqs8F0jalsVaWHg==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: CH2PR21MB1461
X-Mailman-Approved-At: Fri, 22 Nov 2019 09:00:44 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=/XkyxbUNFMVr8OLWw+QBvJe5T0Xpw1K97dNA+kLAmHs=;
 b=HY/tE+XhbCawWgh6ZsrYF/AicfNAHzdELR+PFRAFUwCOwhYND+IbLAWGj7SDIHAR98jIqGL7SyhX7LXWcYCtjUjUhA4LUyyvOeWCfeGfe0z+W433qmHc3aVNaAusCymGDJshbUnTBRejVDuADxwWAURpcuP/c5MvrcHsgGwHKAw=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: weh@microsoft.com
Cc: Wei Hu <weh@microsoft.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gSHlwZXItViwgR2VuZXJhdGlvbiAxIFZNcyBjYW4gZGlyZWN0bHkgdXNlIFZNJ3MgcGh5c2lj
YWwgbWVtb3J5IGZvcgp0aGVpciBmcmFtZWJ1ZmZlcnMuIFRoaXMgY2FuIGltcHJvdmUgdGhlIGVm
ZmljaWVuY3kgb2YgZnJhbWVidWZmZXIgYW5kCm92ZXJhbGwgcGVyZm9ybWVuY2UgZm9yIFZNLiBU
aGUgcGh5c2ljYWwgbWVtb3J5IGFzc2lnbmVkIHRvIGZyYW1lYnVmZmVyCm11c3QgYmUgY29udGln
dW91cy4gV2UgdXNlIENNQSBhbGxvY2F0b3IgdG8gZ2V0IGNvbnRpZ3VvdXNlIHBoeXNpY2lhbApt
ZW1vcnkgd2hlbiB0aGUgZnJhbWVidWZmZXIgc2l6ZSBpcyBncmVhdGVyIHRoYW4gNE1CLiBGb3Ig
c2l6ZSB1bmRlcgo0TUIsIHdlIHVzZSBhbGxvY19wYWdlcyB0byBhY2hpZXZlIHRoaXMuCgpUbyBl
bmFibGUgZnJhbWVidWZmZXIgbWVtb3J5IGFsbG9jYXRpb24gZnJvbSBDTUEsIHN1cHBseSBhIGtl
cm5lbApwYXJhbWV0ZXIgdG8gZ2l2ZSBlbm91Z2ggc3BhY2UgdG8gQ01BIGFsbG9jYXRvciBhdCBi
b290IHRpbWUuIEZvcgpleGFtcGxlOgogICAgY21hPTEzMG0KVGhpcyBnaXZlcyAxMzBNQiBtZW1v
cnkgdG8gQ0FNIGFsbG9jYXRvciB0aGF0IGNhbiBiZSBhbGxvY2F0ZWQgdG8KZnJhbWVidWZmZXIu
IElmIHRoaXMgZmFpbHMsIHdlIGZhbGwgYmFjayB0byB0aGUgb2xkIHdheSBvZiB1c2luZwptbWlv
IGZvciBmcmFtZWJ1ZmZlci4KClNpZ25lZC1vZmYtYnk6IFdlaSBIdSA8d2VoQG1pY3Jvc29mdC5j
b20+Ci0tLQogICAgdjI6IEluY29ycG9yYXRlZCByZXZpZXcgY29tbWVudHMgZm9ybSBoY2hAbHN0
LmRlLCBNaWNoYWVsIEtlbGxleSBhbmQKICAgIERleHVhbiBDdWkKICAgIC0gVXNlIGRtYV9hbGxv
Y19jb2hlcmVudCB0byBhbGxvY2F0ZSBsYXJnZSBjb250aWd1b3VzIG1lbW9yeQogICAgLSBVc2Ug
cGh5c19hZGRyX3QgZm9yIHBoeXNpY2FsIGFkZHJlc3NlcwogICAgLSBDb3JyZWN0ZWQgYSBmZXcg
c3BlbGxpbmcgZXJyb3JzIGFuZCBtaW5vciBjbGVhbnVwcwogICAgLSBBbHNvIHRlc3RlZCBvbiAz
MiBiaXQgVWJ1bnR1IGd1ZXN0IAoKIGRyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZpZyAgICAgfCAg
IDEgKwogZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYyB8IDE5NiArKysrKysrKysrKysr
KysrKysrKysrKysrLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxNTggaW5zZXJ0aW9ucygrKSwg
MzkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9LY29uZmln
IGIvZHJpdmVycy92aWRlby9mYmRldi9LY29uZmlnCmluZGV4IGFhOTU0MWJmOTY0Yi4uODdiODJk
ZTQ1OThkIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcKKysrIGIvZHJp
dmVycy92aWRlby9mYmRldi9LY29uZmlnCkBAIC0yMjE1LDYgKzIyMTUsNyBAQCBjb25maWcgRkJf
SFlQRVJWCiAJc2VsZWN0IEZCX0NGQl9DT1BZQVJFQQogCXNlbGVjdCBGQl9DRkJfSU1BR0VCTElU
CiAJc2VsZWN0IEZCX0RFRkVSUkVEX0lPCisJc2VsZWN0IERNQV9DTUEgaWYgSEFWRV9ETUFfQ09O
VElHVU9VUwogCWhlbHAKIAkgIFRoaXMgZnJhbWVidWZmZXIgZHJpdmVyIHN1cHBvcnRzIE1pY3Jv
c29mdCBIeXBlci1WIFN5bnRoZXRpYyBWaWRlby4KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRl
by9mYmRldi9oeXBlcnZfZmIuYyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvaHlwZXJ2X2ZiLmMKaW5k
ZXggM2Y2MGI3YmM4NTg5Li44YmE5Njc2NGM3NDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8v
ZmJkZXYvaHlwZXJ2X2ZiLmMKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYwpA
QCAtMzEsNiArMzEsMTYgQEAKICAqICJzZXQtdm12aWRlbyIgY29tbWFuZC4gRm9yIGV4YW1wbGUK
ICAqICAgICBzZXQtdm12aWRlbyAtdm1uYW1lIG5hbWUgLWhvcml6b250YWxyZXNvbHV0aW9uOjE5
MjAgXAogICogLXZlcnRpY2FscmVzb2x1dGlvbjoxMjAwIC1yZXNvbHV0aW9udHlwZSBzaW5nbGUK
KyAqCisgKiBHZW4gMSBWTXMgYWxzbyBzdXBwb3J0IGRpcmVjdCB1c2luZyBWTSdzIHBoeXNpY2Fs
IG1lbW9yeSBmb3IgZnJhbWVidWZmZXIuCisgKiBJdCBjb3VsZCBpbXByb3ZlIHRoZSBlZmZpY2ll
bmN5IGFuZCBwZXJmb3JtYW5jZSBmb3IgZnJhbWVidWZmZXIgYW5kIFZNLgorICogVGhpcyByZXF1
aXJlcyB0byBhbGxvY2F0ZSBjb250aWd1b3VzIHBoeXNpY2FsIG1lbW9yeSBmcm9tIExpbnV4IGtl
cm5lbCdzCisgKiBDTUEgbWVtb3J5IGFsbG9jYXRvci4gVG8gZW5hYmxlIHRoaXMsIHN1cHBseSBh
IGtlcm5lbCBwYXJhbWV0ZXIgdG8gZ2l2ZQorICogZW5vdWdoIG1lbW9yeSBzcGFjZSB0byBDTUEg
YWxsb2NhdG9yIGZvciBmcmFtZWJ1ZmZlci4gRm9yIGV4YW1wbGU6CisgKiAgICBjbWE9MTMwbQor
ICogVGhpcyBnaXZlcyAxMzBNQiBtZW1vcnkgdG8gQ01BIGFsbG9jYXRvciB0aGF0IGNhbiBiZSBh
bGxvY2F0ZWQgdG8KKyAqIGZyYW1lYnVmZmVyLiBGb3IgcmVmZXJlbmNlLCA4SyByZXNvbHV0aW9u
ICg3NjgweDQzMjApIHRha2VzIGFib3V0CisgKiAxMjdNQiBtZW1vcnkuCiAgKi8KIAogI2RlZmlu
ZSBwcl9mbXQoZm10KSBLQlVJTERfTU9ETkFNRSAiOiAiIGZtdApAQCAtMjI3LDcgKzIzNyw2IEBA
IHN0cnVjdCBzeW50aHZpZF9tc2cgewogfSBfX3BhY2tlZDsKIAogCi0KIC8qIEZCIGRyaXZlciBk
ZWZpbml0aW9ucyBhbmQgc3RydWN0dXJlcyAqLwogI2RlZmluZSBIVkZCX1dJRFRIIDExNTIgLyog
ZGVmYXVsdCBzY3JlZW4gd2lkdGggKi8KICNkZWZpbmUgSFZGQl9IRUlHSFQgODY0IC8qIGRlZmF1
bHQgc2NyZWVuIGhlaWdodCAqLwpAQCAtMjU2LDEyICsyNjUsMTUgQEAgc3RydWN0IGh2ZmJfcGFy
IHsKIAkvKiBJZiB0cnVlLCB0aGUgVlNDIG5vdGlmaWVzIHRoZSBWU1Agb24gZXZlcnkgZnJhbWVi
dWZmZXIgY2hhbmdlICovCiAJYm9vbCBzeW5jaHJvbm91c19mYjsKIAorCS8qIElmIHRydWUsIG5l
ZWQgdG8gY29weSBmcm9tIGRlZmVycmVkIElPIG1lbSB0byBmcmFtZWJ1ZmZlciBtZW0gKi8KKwli
b29sIG5lZWRfZG9jb3B5OworCiAJc3RydWN0IG5vdGlmaWVyX2Jsb2NrIGh2ZmJfcGFuaWNfbmI7
CiAKIAkvKiBNZW1vcnkgZm9yIGRlZmVycmVkIElPIGFuZCBmcmFtZSBidWZmZXIgaXRzZWxmICov
CiAJdW5zaWduZWQgY2hhciAqZGlvX3ZwOwogCXVuc2lnbmVkIGNoYXIgKm1taW9fdnA7Ci0JdW5z
aWduZWQgbG9uZyBtbWlvX3BwOworCXBoeXNfYWRkcl90IG1taW9fcHA7CiAKIAkvKiBEaXJ0eSBy
ZWN0YW5nbGUsIHByb3RlY3RlZCBieSBkZWxheWVkX3JlZnJlc2hfbG9jayAqLwogCWludCB4MSwg
eTEsIHgyLCB5MjsKQEAgLTQzMiw3ICs0NDQsNyBAQCBzdGF0aWMgdm9pZCBzeW50aHZpZF9kZWZl
cnJlZF9pbyhzdHJ1Y3QgZmJfaW5mbyAqcCwKIAkJbWF4eSA9IG1heF90KGludCwgbWF4eSwgeTIp
OwogCiAJCS8qIENvcHkgZnJvbSBkaW8gc3BhY2UgdG8gbW1pbyBhZGRyZXNzICovCi0JCWlmIChw
YXItPmZiX3JlYWR5KQorCQlpZiAocGFyLT5mYl9yZWFkeSAmJiBwYXItPm5lZWRfZG9jb3B5KQog
CQkJaHZmYl9kb2NvcHkocGFyLCBzdGFydCwgUEFHRV9TSVpFKTsKIAl9CiAKQEAgLTc0OSwxMiAr
NzYxLDEyIEBAIHN0YXRpYyB2b2lkIGh2ZmJfdXBkYXRlX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0
ICp3KQogCQlyZXR1cm47CiAKIAkvKiBDb3B5IHRoZSBkaXJ0eSByZWN0YW5nbGUgdG8gZnJhbWUg
YnVmZmVyIG1lbW9yeSAqLwotCWZvciAoaiA9IHkxOyBqIDwgeTI7IGorKykgewotCQlodmZiX2Rv
Y29weShwYXIsCi0JCQkgICAgaiAqIGluZm8tPmZpeC5saW5lX2xlbmd0aCArCi0JCQkgICAgKHgx
ICogc2NyZWVuX2RlcHRoIC8gOCksCi0JCQkgICAgKHgyIC0geDEpICogc2NyZWVuX2RlcHRoIC8g
OCk7Ci0JfQorCWlmIChwYXItPm5lZWRfZG9jb3B5KQorCQlmb3IgKGogPSB5MTsgaiA8IHkyOyBq
KyspCisJCQlodmZiX2RvY29weShwYXIsCisJCQkJICAgIGogKiBpbmZvLT5maXgubGluZV9sZW5n
dGggKworCQkJCSAgICAoeDEgKiBzY3JlZW5fZGVwdGggLyA4KSwKKwkJCQkgICAgKHgyIC0geDEp
ICogc2NyZWVuX2RlcHRoIC8gOCk7CiAKIAkvKiBSZWZyZXNoICovCiAJaWYgKHBhci0+ZmJfcmVh
ZHkgJiYgcGFyLT51cGRhdGUpCkBAIC03OTksNyArODExLDggQEAgc3RhdGljIGludCBodmZiX29u
X3BhbmljKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsCiAJcGFyID0gY29udGFpbmVyX29mKG5i
LCBzdHJ1Y3QgaHZmYl9wYXIsIGh2ZmJfcGFuaWNfbmIpOwogCXBhci0+c3luY2hyb25vdXNfZmIg
PSB0cnVlOwogCWluZm8gPSBwYXItPmluZm87Ci0JaHZmYl9kb2NvcHkocGFyLCAwLCBkaW9fZmJf
c2l6ZSk7CisJaWYgKHBhci0+bmVlZF9kb2NvcHkpCisJCWh2ZmJfZG9jb3B5KHBhciwgMCwgZGlv
X2ZiX3NpemUpOwogCXN5bnRodmlkX3VwZGF0ZShpbmZvLCAwLCAwLCBJTlRfTUFYLCBJTlRfTUFY
KTsKIAogCXJldHVybiBOT1RJRllfRE9ORTsKQEAgLTkzOCw2ICs5NTEsNzQgQEAgc3RhdGljIHZv
aWQgaHZmYl9nZXRfb3B0aW9uKHN0cnVjdCBmYl9pbmZvICppbmZvKQogCXJldHVybjsKIH0KIAor
LyoKKyAqIEFsbG9jYXRlIGVub3VnaCBjb250aWd1b3VzIHBoeXNpY2FsIG1lbW9yeS4KKyAqIFJl
dHVybiBwaHlzaWNhbCBhZGRyZXNzIGlmIHN1Y2NlZWRlZCBvciAtMSBpZiBmYWlsZWQuCisgKi8K
K3N0YXRpYyBwaHlzX2FkZHJfdCBodmZiX2dldF9waHltZW0oc3RydWN0IGh2X2RldmljZSAqaGRl
diwKKwkJCQkgICB1bnNpZ25lZCBpbnQgcmVxdWVzdF9zaXplKQoreworCXN0cnVjdCBwYWdlICpw
YWdlID0gTlVMTDsKKwlkbWFfYWRkcl90IGRtYV9oYW5kbGU7CisJdm9pZCAqdm1lbTsKKwl1bnNp
Z25lZCBpbnQgcmVxdWVzdF9wYWdlczsKKwlwaHlzX2FkZHJfdCBwYWRkciA9IDA7CisJdW5zaWdu
ZWQgaW50IG9yZGVyID0gZ2V0X29yZGVyKHJlcXVlc3Rfc2l6ZSk7CisKKwlpZiAocmVxdWVzdF9z
aXplID09IDApCisJCXJldHVybiAtMTsKKworCS8qIFRyeSB0byBjYWxsIGFsbG9jX3BhZ2VzIGlm
IHRoZSBzaXplIGlzIGxlc3MgdGhhbiAyXk1BWF9PUkRFUiAqLworCWlmIChvcmRlciA8IE1BWF9P
UkRFUikgeworCQlwYWdlID0gYWxsb2NfcGFnZXMoR0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8sIG9y
ZGVyKTsKKwkJaWYgKCFwYWdlKQorCQkJcmV0dXJuIC0xOworCisJCXBhZGRyID0gKHBhZ2VfdG9f
cGZuKHBhZ2UpIDw8IFBBR0VfU0hJRlQpOworCQlyZXF1ZXN0X3BhZ2VzID0gKDEgPDwgb3JkZXIp
OworCQlnb3RvIGdldF9waHltZW0xOworCX0KKworCS8qIEFsbG9jYXRlIGZyb20gQ01BICovCisJ
aWYgKGhkZXYgPT0gTlVMTCkKKwkJcmV0dXJuIC0xOworCisJaGRldi0+ZGV2aWNlLmNvaGVyZW50
X2RtYV9tYXNrID0gRE1BX0JJVF9NQVNLKDY0KTsKKworCXJlcXVlc3RfcGFnZXMgPSAocm91bmRf
dXAocmVxdWVzdF9zaXplLCBQQUdFX1NJWkUpID4+IFBBR0VfU0hJRlQpOworCisJdm1lbSA9IGRt
YV9hbGxvY19jb2hlcmVudCgmaGRldi0+ZGV2aWNlLAorCQkJCSByZXF1ZXN0X3BhZ2VzICogUEFH
RV9TSVpFLAorCQkJCSAmZG1hX2hhbmRsZSwKKwkJCQkgR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FS
Tik7CisKKwlpZiAoIXZtZW0pCisJCXJldHVybiAtMTsKKworCXBhZGRyID0gdmlydF90b19waHlz
KHZtZW0pOworCitnZXRfcGh5bWVtMToKKwlwcl9pbmZvKCJBbGxvY2F0ZWQgJWQgcGFnZXMgc3Rh
cnRzIGF0IHBoeXNpY2FsIGFkZHIgMHglbGx4XG4iLAorCQlyZXF1ZXN0X3BhZ2VzLCBwYWRkcik7
CisKKwlyZXR1cm4gcGFkZHI7Cit9CisKKy8qIFJlbGVhc2UgY29udGlndW91cyBwaHlzaWNhbCBt
ZW1vcnkgKi8KK3N0YXRpYyB2b2lkIGh2ZmJfcmVsZWFzZV9waHltZW0oc3RydWN0IGh2X2Rldmlj
ZSAqaGRldiwKKwkJCQlwaHlzX2FkZHJfdCBwYWRkciwgdW5zaWduZWQgaW50IHNpemUpCit7CisJ
dW5zaWduZWQgaW50IG9yZGVyID0gZ2V0X29yZGVyKHNpemUpOworCisJaWYgKG9yZGVyIDwgTUFY
X09SREVSKQorCQlfX2ZyZWVfcGFnZXMocGZuX3RvX3BhZ2UocGFkZHIgPj4gUEFHRV9TSElGVCks
IG9yZGVyKTsKKwllbHNlCisJCWRtYV9mcmVlX2NvaGVyZW50KCZoZGV2LT5kZXZpY2UsCisJCQkJ
ICByb3VuZF91cChzaXplLCBQQUdFX1NJWkUpLAorCQkJCSAgcGh5c190b192aXJ0KHBhZGRyKSwK
KwkJCQkgIHBhZGRyKTsKK30KKwogCiAvKiBHZXQgZnJhbWVidWZmZXIgbWVtb3J5IGZyb20gSHlw
ZXItViB2aWRlbyBwY2kgc3BhY2UgKi8KIHN0YXRpYyBpbnQgaHZmYl9nZXRtZW0oc3RydWN0IGh2
X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8pCkBAIC05NDcsOCArMTAyOCw1NyBA
QCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBm
Yl9pbmZvICppbmZvKQogCXZvaWQgX19pb21lbSAqZmJfdmlydDsKIAlpbnQgZ2VuMnZtID0gZWZp
X2VuYWJsZWQoRUZJX0JPT1QpOwogCXJlc291cmNlX3NpemVfdCBwb3Rfc3RhcnQsIHBvdF9lbmQ7
CisJcGh5c19hZGRyX3QgcGFkZHI7CiAJaW50IHJldDsKIAorCWlmICghZ2VuMnZtKSB7CisJCXBk
ZXYgPSBwY2lfZ2V0X2RldmljZShQQ0lfVkVORE9SX0lEX01JQ1JPU09GVCwKKwkJCVBDSV9ERVZJ
Q0VfSURfSFlQRVJWX1ZJREVPLCBOVUxMKTsKKwkJaWYgKCFwZGV2KSB7CisJCQlwcl9lcnIoIlVu
YWJsZSB0byBmaW5kIFBDSSBIeXBlci1WIHZpZGVvXG4iKTsKKwkJCXJldHVybiAtRU5PREVWOwor
CQl9CisJfQorCisJaW5mby0+YXBlcnR1cmVzID0gYWxsb2NfYXBlcnR1cmVzKDEpOworCWlmICgh
aW5mby0+YXBlcnR1cmVzKQorCQlnb3RvIGVycjE7CisKKwlpZiAoZ2VuMnZtKSB7CisJCWluZm8t
PmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBzY3JlZW5faW5mby5sZmJfYmFzZTsKKwkJaW5m
by0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHNjcmVlbl9pbmZvLmxmYl9zaXplOworCX0g
ZWxzZSB7CisJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBwY2lfcmVzb3VyY2Vf
c3RhcnQocGRldiwgMCk7CisJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLnNpemUgPSBwY2lf
cmVzb3VyY2VfbGVuKHBkZXYsIDApOworCX0KKworCS8qCisJICogRm9yIEdlbiAxIFZNLCB3ZSBj
YW4gZGlyZWN0bHkgdXNlIHRoZSBjb250aWd1b3VzIG1lbW9yeQorCSAqIGZyb20gVk0uIElmIHdl
IHN1Y2NlZWQsIGRlZmVycmVkIElPIGhhcHBlbnMgZGlyZWN0bHkKKwkgKiBvbiB0aGlzIGFsbG9j
YXRlZCBmcmFtZWJ1ZmZlciBtZW1vcnksIGF2b2lkaW5nIGV4dHJhCisJICogbWVtb3J5IGNvcHku
CisJICovCisJaWYgKCFnZW4ydm0pIHsKKwkJcGFkZHIgPSBodmZiX2dldF9waHltZW0oaGRldiwg
c2NyZWVuX2ZiX3NpemUpOworCQlpZiAocGFkZHIgIT0gKHBoeXNfYWRkcl90KSAtMSkgeworCQkJ
cGFyLT5tbWlvX3BwID0gcGFkZHI7CisJCQlwYXItPm1taW9fdnAgPSBwYXItPmRpb192cCA9IF9f
dmEocGFkZHIpOworCisJCQlpbmZvLT5maXguc21lbV9zdGFydCA9IHBhZGRyOworCQkJaW5mby0+
Zml4LnNtZW1fbGVuID0gc2NyZWVuX2ZiX3NpemU7CisJCQlpbmZvLT5zY3JlZW5fYmFzZSA9IHBh
ci0+bW1pb192cDsKKwkJCWluZm8tPnNjcmVlbl9zaXplID0gc2NyZWVuX2ZiX3NpemU7CisKKwkJ
CXBhci0+bmVlZF9kb2NvcHkgPSBmYWxzZTsKKwkJCWdvdG8gZ2V0bWVtMTsKKwkJfQorCQlwcl9p
bmZvKCJVbmFibGUgdG8gYWxsb2NhdGUgZW5vdWdoIGNvbnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5
IG9uIEdlbiAxIFZNLiBVc2UgTU1JTyBpbnN0ZWFkLlxuIik7CisJfQorCisJLyoKKwkgKiBDYW5u
b3QgdXNlIHRoZSBjb250aWd1b3VzIHBoeXNpY2FsIG1lbW9yeS4KKwkgKiBBbGxvY2F0ZSBtbWlv
IHNwYWNlIGZvciBmcmFtZWJ1ZmZlci4KKwkgKi8KIAlkaW9fZmJfc2l6ZSA9CiAJCXNjcmVlbl93
aWR0aCAqIHNjcmVlbl9oZWlnaHQgKiBzY3JlZW5fZGVwdGggLyA4OwogCkBAIC05NTYsMTMgKzEw
ODYsNiBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0
cnVjdCBmYl9pbmZvICppbmZvKQogCQlwb3Rfc3RhcnQgPSAwOwogCQlwb3RfZW5kID0gLTE7CiAJ
fSBlbHNlIHsKLQkJcGRldiA9IHBjaV9nZXRfZGV2aWNlKFBDSV9WRU5ET1JfSURfTUlDUk9TT0ZU
LAotCQkJICAgICAgUENJX0RFVklDRV9JRF9IWVBFUlZfVklERU8sIE5VTEwpOwotCQlpZiAoIXBk
ZXYpIHsKLQkJCXByX2VycigiVW5hYmxlIHRvIGZpbmQgUENJIEh5cGVyLVYgdmlkZW9cbiIpOwot
CQkJcmV0dXJuIC1FTk9ERVY7Ci0JCX0KLQogCQlpZiAoIShwY2lfcmVzb3VyY2VfZmxhZ3MocGRl
diwgMCkgJiBJT1JFU09VUkNFX01FTSkgfHwKIAkJICAgIHBjaV9yZXNvdXJjZV9sZW4ocGRldiwg
MCkgPCBzY3JlZW5fZmJfc2l6ZSkgewogCQkJcHJfZXJyKCJSZXNvdXJjZSBub3QgYXZhaWxhYmxl
IG9yICgweCVseCA8IDB4JWx4KVxuIiwKQEAgLTk5MSwyMCArMTExNCw2IEBAIHN0YXRpYyBpbnQg
aHZmYl9nZXRtZW0oc3RydWN0IGh2X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8p
CiAJaWYgKHBhci0+ZGlvX3ZwID09IE5VTEwpCiAJCWdvdG8gZXJyMzsKIAotCWluZm8tPmFwZXJ0
dXJlcyA9IGFsbG9jX2FwZXJ0dXJlcygxKTsKLQlpZiAoIWluZm8tPmFwZXJ0dXJlcykKLQkJZ290
byBlcnI0OwotCi0JaWYgKGdlbjJ2bSkgewotCQlpbmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5i
YXNlID0gc2NyZWVuX2luZm8ubGZiX2Jhc2U7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBd
LnNpemUgPSBzY3JlZW5faW5mby5sZmJfc2l6ZTsKLQkJcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1l
YnVmZmVycyhpbmZvLT5hcGVydHVyZXMsCi0JCQkJCQlLQlVJTERfTU9ETkFNRSwgZmFsc2UpOwot
CX0gZWxzZSB7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBwY2lfcmVzb3Vy
Y2Vfc3RhcnQocGRldiwgMCk7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLnNpemUgPSBw
Y2lfcmVzb3VyY2VfbGVuKHBkZXYsIDApOwotCX0KLQogCS8qIFBoeXNpY2FsIGFkZHJlc3Mgb2Yg
RkIgZGV2aWNlICovCiAJcGFyLT5tbWlvX3BwID0gcGFyLT5tZW0tPnN0YXJ0OwogCS8qIFZpcnR1
YWwgYWRkcmVzcyBvZiBGQiBkZXZpY2UgKi8KQEAgLTEwMTUsMTMgKzExMjQsMTUgQEAgc3RhdGlj
IGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3QgZmJfaW5mbyAq
aW5mbykKIAlpbmZvLT5zY3JlZW5fYmFzZSA9IHBhci0+ZGlvX3ZwOwogCWluZm8tPnNjcmVlbl9z
aXplID0gZGlvX2ZiX3NpemU7CiAKK2dldG1lbTE6CisJcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1l
YnVmZmVycyhpbmZvLT5hcGVydHVyZXMsCisJCQkJCUtCVUlMRF9NT0ROQU1FLCBmYWxzZSk7CisK
IAlpZiAoIWdlbjJ2bSkKIAkJcGNpX2Rldl9wdXQocGRldik7CiAKIAlyZXR1cm4gMDsKIAotZXJy
NDoKLQl2ZnJlZShwYXItPmRpb192cCk7CiBlcnIzOgogCWlvdW5tYXAoZmJfdmlydCk7CiBlcnIy
OgpAQCAtMTAzNSwxMyArMTE0NiwxOSBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBo
dl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBmYl9pbmZvICppbmZvKQogfQogCiAvKiBSZWxlYXNlIHRo
ZSBmcmFtZWJ1ZmZlciAqLwotc3RhdGljIHZvaWQgaHZmYl9wdXRtZW0oc3RydWN0IGZiX2luZm8g
KmluZm8pCitzdGF0aWMgdm9pZCBodmZiX3B1dG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBz
dHJ1Y3QgZmJfaW5mbyAqaW5mbykKIHsKIAlzdHJ1Y3QgaHZmYl9wYXIgKnBhciA9IGluZm8tPnBh
cjsKIAotCXZmcmVlKHBhci0+ZGlvX3ZwKTsKLQlpb3VubWFwKGluZm8tPnNjcmVlbl9iYXNlKTsK
LQl2bWJ1c19mcmVlX21taW8ocGFyLT5tZW0tPnN0YXJ0LCBzY3JlZW5fZmJfc2l6ZSk7CisJaWYg
KHBhci0+bmVlZF9kb2NvcHkpIHsKKwkJdmZyZWUocGFyLT5kaW9fdnApOworCQlpb3VubWFwKGlu
Zm8tPnNjcmVlbl9iYXNlKTsKKwkJdm1idXNfZnJlZV9tbWlvKHBhci0+bWVtLT5zdGFydCwgc2Ny
ZWVuX2ZiX3NpemUpOworCX0gZWxzZSB7CisJCWh2ZmJfcmVsZWFzZV9waHltZW0oaGRldiwgaW5m
by0+Zml4LnNtZW1fc3RhcnQsCisJCQkJICAgIHNjcmVlbl9mYl9zaXplKTsKKwl9CisKIAlwYXIt
Pm1lbSA9IE5VTEw7CiB9CiAKQEAgLTEwNjAsNiArMTE3Nyw3IEBAIHN0YXRpYyBpbnQgaHZmYl9w
cm9iZShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LAogCXBhciA9IGluZm8tPnBhcjsKIAlwYXItPmlu
Zm8gPSBpbmZvOwogCXBhci0+ZmJfcmVhZHkgPSBmYWxzZTsKKwlwYXItPm5lZWRfZG9jb3B5ID0g
dHJ1ZTsKIAlpbml0X2NvbXBsZXRpb24oJnBhci0+d2FpdCk7CiAJSU5JVF9ERUxBWUVEX1dPUkso
JnBhci0+ZHdvcmssIGh2ZmJfdXBkYXRlX3dvcmspOwogCkBAIC0xMTQ1LDcgKzEyNjMsNyBAQCBz
dGF0aWMgaW50IGh2ZmJfcHJvYmUoc3RydWN0IGh2X2RldmljZSAqaGRldiwKIAogZXJyb3I6CiAJ
ZmJfZGVmZXJyZWRfaW9fY2xlYW51cChpbmZvKTsKLQlodmZiX3B1dG1lbShpbmZvKTsKKwlodmZi
X3B1dG1lbShoZGV2LCBpbmZvKTsKIGVycm9yMjoKIAl2bWJ1c19jbG9zZShoZGV2LT5jaGFubmVs
KTsKIGVycm9yMToKQEAgLTExNzUsNyArMTI5Myw3IEBAIHN0YXRpYyBpbnQgaHZmYl9yZW1vdmUo
c3RydWN0IGh2X2RldmljZSAqaGRldikKIAl2bWJ1c19jbG9zZShoZGV2LT5jaGFubmVsKTsKIAlo
dl9zZXRfZHJ2ZGF0YShoZGV2LCBOVUxMKTsKIAotCWh2ZmJfcHV0bWVtKGluZm8pOworCWh2ZmJf
cHV0bWVtKGhkZXYsIGluZm8pOwogCWZyYW1lYnVmZmVyX3JlbGVhc2UoaW5mbyk7CiAKIAlyZXR1
cm4gMDsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
