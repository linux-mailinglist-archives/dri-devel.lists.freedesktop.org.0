Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DE88122E96
	for <lists+dri-devel@lfdr.de>; Mon, 20 May 2019 10:24:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 359A8892EA;
	Mon, 20 May 2019 08:23:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 10005892CA
 for <dri-devel@lists.freedesktop.org>; Mon, 20 May 2019 08:22:57 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id l25so22499851eda.9
 for <dri-devel@lists.freedesktop.org>; Mon, 20 May 2019 01:22:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Z0bTEF5xAXjjtD3WRRyxu8w7iJRGktyXqotRP83G5Cc=;
 b=lzl+OElsHAehVmW7/TMjFTdYkGvGcIuN1QMJYwSJJJ+OZrRfjlJs5uNuPgkhif/gw1
 mpgyFoZYuouQkVxCNxboiI0wBLb7ZXZnIKvkhyG14NvvzgyuNVATsSNrXk7WxitwnTqp
 5fvKSMvzCxv7xxeiXBHMi70Qq/tf7RJYRzfLbBv258puHYnCkYwxew7w9iBCsTrzhom4
 v0FjRkmfEx2leBZuCxqZ1jXgXxC2sa94oX9JAGc5UgedYa1jRKYdNiRyBDbCf8nNUmm6
 B4ONaQTNBpAV1EY1zxax7rs6COaJ3UYaNlMrOznHfD+tWV++H4UYUVSdEXH6rPVMveRb
 JBxQ==
X-Gm-Message-State: APjAAAWyDg6tCEKTJrLOM5o5LxY8WkotohpYgDzyTq+zVCYiC34o3TYw
 KKEvC+09khZjQDzQ0FPXEDwbu+HAIZ8=
X-Google-Smtp-Source: APXvYqwEhuODT9HvDQ/LcQ4deagLmc07/7ACbdQuA0BgS1q7uFDeseO/NLUr+JD2J1kIL7LXR+cxxQ==
X-Received: by 2002:a50:9968:: with SMTP id l37mr73321916edb.143.1558340574981; 
 Mon, 20 May 2019 01:22:54 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id t25sm3021263ejx.8.2019.05.20.01.22.54
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 20 May 2019 01:22:54 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 28/33] fb: Flatten control flow in fb_set_var
Date: Mon, 20 May 2019 10:22:11 +0200
Message-Id: <20190520082216.26273-29-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190520082216.26273-1-daniel.vetter@ffwll.ch>
References: <20190520082216.26273-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Z0bTEF5xAXjjtD3WRRyxu8w7iJRGktyXqotRP83G5Cc=;
 b=Gk4MRvpMNEfVB2X+OOebAKyfX0in1mHPZ9BrDj1zyh/mFdNb3mH1zO+hzmyNRueWJc
 zOKL/wYTkD0sOt0RrnOsIjSqOko9qdc2CHrUAdkQDff6InAn7T6/6J+QU3xxnBe08sBi
 /qwOOjF1PAXAgBps2YI8r1Vp0kMRKg/17qap0=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Hans de Goede <hdegoede@redhat.com>, Mikulas Patocka <mpatocka@redhat.com>,
 Daniel Vetter <daniel.vetter@intel.com>, Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiB3aXJpbmcgYWxtb3N0IGV2ZXJ5dGhpbmcgZG93biB0byB0aGUgdmVyeSBsYXN0
IGxpbmUgdXNpbmcKZ290byBzb3VwIChidXQgbm90IGNvbnNpc3RlbnRseSwgd2hlcmUgd291bGQg
dGhlIGZ1biBiZSBvdGhlcndpc2UpCmRyb3Agb3V0IGVhcmx5IHdoZW4gY2hlY2tzIGZhaWwuIFRo
aXMgYWxsb3dzIHVzIHRvIGZsYXR0ZW4gdGhlIGh1Z2UKaW5kZW50IGxldmVscyB0byBqdXN0IDEu
CgpBc2lkZTogSWYgYSBkcml2ZXIgZG9lc24ndCBzZXQgLT5mYl9jaGVja192YXIsIHRoZW4gRkJf
QUNUSVZBVEVfTk9XCmRvZXMgbm90aGluZy4gVGhpcyBidWcgZXhpc3RzIGV2ZXIgc2luY2UgdGhp
cyBjb2RlIHdhcyBleHRyYWN0ZWQgYXMgYQpjb21tb24gaGVscGVyIGluIDIwMDIsIGhlbmNlIEkg
ZGVjaWRlZCBhZ2FpbnN0IGZpeGluZyBpdC4gRXZlcnlvbmUKanVzdCBiZXR0ZXIgaGF2ZSBhIGZi
X2NoZWNrX3ZhciB0byBtYWtlIHN1cmUgdGhpbmdzIHdvcmsgY29ycmVjdGx5LgoKU2lnbmVkLW9m
Zi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBEYW5pZWwg
VmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgpDYzogQmFydGxvbWllaiBab2xuaWVya2ll
d2ljeiA8Yi56b2xuaWVya2llQHNhbXN1bmcuY29tPgpDYzogIk1pY2hhxYIgTWlyb3PFgmF3IiA8
bWlycS1saW51eEByZXJlLnFtcW0ucGw+CkNjOiBQZXRlciBSb3NpbiA8cGVkYUBheGVudGlhLnNl
PgpDYzogSGFucyBkZSBHb2VkZSA8aGRlZ29lZGVAcmVkaGF0LmNvbT4KQ2M6IE1pa3VsYXMgUGF0
b2NrYSA8bXBhdG9ja2FAcmVkaGF0LmNvbT4KLS0tCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUv
ZmJtZW0uYyB8IDEyNiArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hh
bmdlZCwgNjMgaW5zZXJ0aW9ucygrKSwgNjMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUv
ZmJtZW0uYwppbmRleCA2NWEwNzVjY2FjNGEuLmNiZDU4YmE4YTU5ZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9j
b3JlL2ZibWVtLmMKQEAgLTk1NCw2ICs5NTQsOSBAQCBmYl9zZXRfdmFyKHN0cnVjdCBmYl9pbmZv
ICppbmZvLCBzdHJ1Y3QgZmJfdmFyX3NjcmVlbmluZm8gKnZhcikKIHsKIAlpbnQgZmxhZ3MgPSBp
bmZvLT5mbGFnczsKIAlpbnQgcmV0ID0gMDsKKwl1MzIgYWN0aXZhdGU7CisJc3RydWN0IGZiX3Zh
cl9zY3JlZW5pbmZvIG9sZF92YXI7CisJc3RydWN0IGZiX3ZpZGVvbW9kZSBtb2RlOwogCiAJaWYg
KHZhci0+YWN0aXZhdGUgJiBGQl9BQ1RJVkFURV9JTlZfTU9ERSkgewogCQlzdHJ1Y3QgZmJfdmlk
ZW9tb2RlIG1vZGUxLCBtb2RlMjsKQEAgLTk3MCw4NyArOTczLDg0IEBAIGZiX3NldF92YXIoc3Ry
dWN0IGZiX2luZm8gKmluZm8sIHN0cnVjdCBmYl92YXJfc2NyZWVuaW5mbyAqdmFyKQogCQkJZmJf
ZGVsZXRlX3ZpZGVvbW9kZSgmbW9kZTEsICZpbmZvLT5tb2RlbGlzdCk7CiAKIAotCQlyZXQgPSAo
cmV0KSA/IC1FSU5WQUwgOiAwOwotCQlnb3RvIGRvbmU7CisJCXJldHVybiByZXQgPyAtRUlOVkFM
IDogMDsKIAl9CiAKLQlpZiAoKHZhci0+YWN0aXZhdGUgJiBGQl9BQ1RJVkFURV9GT1JDRSkgfHwK
LQkgICAgbWVtY21wKCZpbmZvLT52YXIsIHZhciwgc2l6ZW9mKHN0cnVjdCBmYl92YXJfc2NyZWVu
aW5mbykpKSB7Ci0JCXUzMiBhY3RpdmF0ZSA9IHZhci0+YWN0aXZhdGU7CisJaWYgKCEodmFyLT5h
Y3RpdmF0ZSAmIEZCX0FDVElWQVRFX0ZPUkNFKSAmJgorCSAgICAhbWVtY21wKCZpbmZvLT52YXIs
IHZhciwgc2l6ZW9mKHN0cnVjdCBmYl92YXJfc2NyZWVuaW5mbykpKQorCQlyZXR1cm4gMDsKIAot
CQkvKiBXaGVuIHVzaW5nIEZPVVJDQyBtb2RlLCBtYWtlIHN1cmUgdGhlIHJlZCwgZ3JlZW4sIGJs
dWUgYW5kCi0JCSAqIHRyYW5zcCBmaWVsZHMgYXJlIHNldCB0byAwLgotCQkgKi8KLQkJaWYgKChp
bmZvLT5maXguY2FwYWJpbGl0aWVzICYgRkJfQ0FQX0ZPVVJDQykgJiYKLQkJICAgIHZhci0+Z3Jh
eXNjYWxlID4gMSkgewotCQkJaWYgKHZhci0+cmVkLm9mZnNldCAgICAgfHwgdmFyLT5ncmVlbi5v
ZmZzZXQgICAgfHwKLQkJCSAgICB2YXItPmJsdWUub2Zmc2V0ICAgIHx8IHZhci0+dHJhbnNwLm9m
ZnNldCAgIHx8Ci0JCQkgICAgdmFyLT5yZWQubGVuZ3RoICAgICB8fCB2YXItPmdyZWVuLmxlbmd0
aCAgICB8fAotCQkJICAgIHZhci0+Ymx1ZS5sZW5ndGggICAgfHwgdmFyLT50cmFuc3AubGVuZ3Ro
ICAgfHwKLQkJCSAgICB2YXItPnJlZC5tc2JfcmlnaHQgIHx8IHZhci0+Z3JlZW4ubXNiX3JpZ2h0
IHx8Ci0JCQkgICAgdmFyLT5ibHVlLm1zYl9yaWdodCB8fCB2YXItPnRyYW5zcC5tc2JfcmlnaHQp
Ci0JCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCX0KKwlhY3RpdmF0ZSA9IHZhci0+YWN0aXZhdGU7CiAK
LQkJaWYgKCFpbmZvLT5mYm9wcy0+ZmJfY2hlY2tfdmFyKSB7Ci0JCQkqdmFyID0gaW5mby0+dmFy
OwotCQkJZ290byBkb25lOwotCQl9CisJLyogV2hlbiB1c2luZyBGT1VSQ0MgbW9kZSwgbWFrZSBz
dXJlIHRoZSByZWQsIGdyZWVuLCBibHVlIGFuZAorCSAqIHRyYW5zcCBmaWVsZHMgYXJlIHNldCB0
byAwLgorCSAqLworCWlmICgoaW5mby0+Zml4LmNhcGFiaWxpdGllcyAmIEZCX0NBUF9GT1VSQ0Mp
ICYmCisJICAgIHZhci0+Z3JheXNjYWxlID4gMSkgeworCQlpZiAodmFyLT5yZWQub2Zmc2V0ICAg
ICB8fCB2YXItPmdyZWVuLm9mZnNldCAgICB8fAorCQkgICAgdmFyLT5ibHVlLm9mZnNldCAgICB8
fCB2YXItPnRyYW5zcC5vZmZzZXQgICB8fAorCQkgICAgdmFyLT5yZWQubGVuZ3RoICAgICB8fCB2
YXItPmdyZWVuLmxlbmd0aCAgICB8fAorCQkgICAgdmFyLT5ibHVlLmxlbmd0aCAgICB8fCB2YXIt
PnRyYW5zcC5sZW5ndGggICB8fAorCQkgICAgdmFyLT5yZWQubXNiX3JpZ2h0ICB8fCB2YXItPmdy
ZWVuLm1zYl9yaWdodCB8fAorCQkgICAgdmFyLT5ibHVlLm1zYl9yaWdodCB8fCB2YXItPnRyYW5z
cC5tc2JfcmlnaHQpCisJCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoIWluZm8tPmZib3Bz
LT5mYl9jaGVja192YXIpIHsKKwkJKnZhciA9IGluZm8tPnZhcjsKKwkJcmV0dXJuIDA7CisJfQog
Ci0JCXJldCA9IGluZm8tPmZib3BzLT5mYl9jaGVja192YXIodmFyLCBpbmZvKTsKKwlyZXQgPSBp
bmZvLT5mYm9wcy0+ZmJfY2hlY2tfdmFyKHZhciwgaW5mbyk7CiAKLQkJaWYgKHJldCkKLQkJCWdv
dG8gZG9uZTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0JCWlmICgodmFyLT5hY3RpdmF0
ZSAmIEZCX0FDVElWQVRFX01BU0spID09IEZCX0FDVElWQVRFX05PVykgewotCQkJc3RydWN0IGZi
X3Zhcl9zY3JlZW5pbmZvIG9sZF92YXI7Ci0JCQlzdHJ1Y3QgZmJfdmlkZW9tb2RlIG1vZGU7CisJ
aWYgKCh2YXItPmFjdGl2YXRlICYgRkJfQUNUSVZBVEVfTUFTSykgIT0gRkJfQUNUSVZBVEVfTk9X
KQorCQlyZXR1cm4gMDsKIAotCQkJaWYgKGluZm8tPmZib3BzLT5mYl9nZXRfY2FwcykgewotCQkJ
CXJldCA9IGZiX2NoZWNrX2NhcHMoaW5mbywgdmFyLCBhY3RpdmF0ZSk7CisJaWYgKGluZm8tPmZi
b3BzLT5mYl9nZXRfY2FwcykgeworCQlyZXQgPSBmYl9jaGVja19jYXBzKGluZm8sIHZhciwgYWN0
aXZhdGUpOwogCi0JCQkJaWYgKHJldCkKLQkJCQkJZ290byBkb25lOwotCQkJfQorCQlpZiAocmV0
KQorCQkJcmV0dXJuIHJldDsKKwl9CiAKLQkJCW9sZF92YXIgPSBpbmZvLT52YXI7Ci0JCQlpbmZv
LT52YXIgPSAqdmFyOworCW9sZF92YXIgPSBpbmZvLT52YXI7CisJaW5mby0+dmFyID0gKnZhcjsK
IAotCQkJaWYgKGluZm8tPmZib3BzLT5mYl9zZXRfcGFyKSB7Ci0JCQkJcmV0ID0gaW5mby0+ZmJv
cHMtPmZiX3NldF9wYXIoaW5mbyk7CisJaWYgKGluZm8tPmZib3BzLT5mYl9zZXRfcGFyKSB7CisJ
CXJldCA9IGluZm8tPmZib3BzLT5mYl9zZXRfcGFyKGluZm8pOwogCi0JCQkJaWYgKHJldCkgewot
CQkJCQlpbmZvLT52YXIgPSBvbGRfdmFyOwotCQkJCQlwcmludGsoS0VSTl9XQVJOSU5HICJkZXRl
Y3RlZCAiCi0JCQkJCQkiZmJfc2V0X3BhciBlcnJvciwgIgotCQkJCQkJImVycm9yIGNvZGU6ICVk
XG4iLCByZXQpOwotCQkJCQlnb3RvIGRvbmU7Ci0JCQkJfQotCQkJfQorCQlpZiAocmV0KSB7CisJ
CQlpbmZvLT52YXIgPSBvbGRfdmFyOworCQkJcHJpbnRrKEtFUk5fV0FSTklORyAiZGV0ZWN0ZWQg
IgorCQkJCSJmYl9zZXRfcGFyIGVycm9yLCAiCisJCQkJImVycm9yIGNvZGU6ICVkXG4iLCByZXQp
OworCQkJcmV0dXJuIHJldDsKKwkJfQorCX0KIAotCQkJZmJfcGFuX2Rpc3BsYXkoaW5mbywgJmlu
Zm8tPnZhcik7Ci0JCQlmYl9zZXRfY21hcCgmaW5mby0+Y21hcCwgaW5mbyk7Ci0JCQlmYl92YXJf
dG9fdmlkZW9tb2RlKCZtb2RlLCAmaW5mby0+dmFyKTsKKwlmYl9wYW5fZGlzcGxheShpbmZvLCAm
aW5mby0+dmFyKTsKKwlmYl9zZXRfY21hcCgmaW5mby0+Y21hcCwgaW5mbyk7CisJZmJfdmFyX3Rv
X3ZpZGVvbW9kZSgmbW9kZSwgJmluZm8tPnZhcik7CiAKLQkJCWlmIChpbmZvLT5tb2RlbGlzdC5w
cmV2ICYmIGluZm8tPm1vZGVsaXN0Lm5leHQgJiYKLQkJCSAgICAhbGlzdF9lbXB0eSgmaW5mby0+
bW9kZWxpc3QpKQotCQkJCXJldCA9IGZiX2FkZF92aWRlb21vZGUoJm1vZGUsICZpbmZvLT5tb2Rl
bGlzdCk7CisJaWYgKGluZm8tPm1vZGVsaXN0LnByZXYgJiYgaW5mby0+bW9kZWxpc3QubmV4dCAm
JgorCSAgICAhbGlzdF9lbXB0eSgmaW5mby0+bW9kZWxpc3QpKQorCQlyZXQgPSBmYl9hZGRfdmlk
ZW9tb2RlKCZtb2RlLCAmaW5mby0+bW9kZWxpc3QpOwogCi0JCQlpZiAoIXJldCAmJiAoZmxhZ3Mg
JiBGQklORk9fTUlTQ19VU0VSRVZFTlQpKSB7Ci0JCQkJc3RydWN0IGZiX2V2ZW50IGV2ZW50Owot
CQkJCWludCBldm50ID0gKGFjdGl2YXRlICYgRkJfQUNUSVZBVEVfQUxMKSA/Ci0JCQkJCUZCX0VW
RU5UX01PREVfQ0hBTkdFX0FMTCA6Ci0JCQkJCUZCX0VWRU5UX01PREVfQ0hBTkdFOworCWlmICgh
cmV0ICYmIChmbGFncyAmIEZCSU5GT19NSVNDX1VTRVJFVkVOVCkpIHsKKwkJc3RydWN0IGZiX2V2
ZW50IGV2ZW50OworCQlpbnQgZXZudCA9IChhY3RpdmF0ZSAmIEZCX0FDVElWQVRFX0FMTCkgPwor
CQkJRkJfRVZFTlRfTU9ERV9DSEFOR0VfQUxMIDoKKwkJCUZCX0VWRU5UX01PREVfQ0hBTkdFOwog
Ci0JCQkJaW5mby0+ZmxhZ3MgJj0gfkZCSU5GT19NSVNDX1VTRVJFVkVOVDsKLQkJCQlldmVudC5p
bmZvID0gaW5mbzsKLQkJCQlldmVudC5kYXRhID0gJm1vZGU7Ci0JCQkJZmJfbm90aWZpZXJfY2Fs
bF9jaGFpbihldm50LCAmZXZlbnQpOwotCQkJfQotCQl9CisJCWluZm8tPmZsYWdzICY9IH5GQklO
Rk9fTUlTQ19VU0VSRVZFTlQ7CisJCWV2ZW50LmluZm8gPSBpbmZvOworCQlldmVudC5kYXRhID0g
Jm1vZGU7CisJCWZiX25vdGlmaWVyX2NhbGxfY2hhaW4oZXZudCwgJmV2ZW50KTsKIAl9CiAKLSBk
b25lOgogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKGZiX3NldF92YXIpOwotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
