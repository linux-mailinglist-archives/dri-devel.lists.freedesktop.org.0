Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 13294EEDFB
	for <lists+dri-devel@lfdr.de>; Mon,  4 Nov 2019 23:12:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 973C36E8A2;
	Mon,  4 Nov 2019 22:12:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 92DA76E89A
 for <dri-devel@lists.freedesktop.org>; Mon,  4 Nov 2019 22:12:38 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: andrzej.p) with ESMTPSA id D30DB28BA68
From: Andrzej Pietrasiewicz <andrzej.p@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCHv2 2/4] drm/malidp: use afbc helpers
Date: Mon,  4 Nov 2019 23:12:26 +0100
Message-Id: <20191104221228.3588-3-andrzej.p@collabora.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191104221228.3588-1-andrzej.p@collabora.com>
References: <2485717.1SzL54aMiy@e123338-lin>
 <20191104221228.3588-1-andrzej.p@collabora.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ayan Halder <Ayan.Halder@arm.com>, kernel@collabora.com,
 David Airlie <airlied@linux.ie>, Liviu Dudau <liviu.dudau@arm.com>,
 linux-rockchip@lists.infradead.org, James Wang <james.qian.wang@arm.com>,
 Mihail Atanassov <mihail.atanassov@arm.com>, Sean Paul <sean@poorly.run>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUgYXJlIGFmYmMgaGVscGVycyBhdmFpbGFibGUuCgpTaWduZWQtb2ZmLWJ5OiBBbmRyemVq
IFBpZXRyYXNpZXdpY3ogPGFuZHJ6ZWoucEBjb2xsYWJvcmEuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9hcm0vbWFsaWRwX2Rydi5jIHwgNjYgKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0KIDEgZmlsZSBjaGFuZ2VkLCAxMiBpbnNlcnRpb25zKCspLCA1NCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXJtL21hbGlkcF9kcnYuYyBiL2RyaXZlcnMvZ3B1
L2RybS9hcm0vbWFsaWRwX2Rydi5jCmluZGV4IDM3ZDkyYTA2MzE4ZS4uYWI5MzU4OGNjOGViIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXJtL21hbGlkcF9kcnYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYXJtL21hbGlkcF9kcnYuYwpAQCAtMTUsNiArMTUsNyBAQAogI2luY2x1ZGUgPGxp
bnV4L3BtX3J1bnRpbWUuaD4KICNpbmNsdWRlIDxsaW51eC9kZWJ1Z2ZzLmg+CiAKKyNpbmNsdWRl
IDxkcm0vZHJtX2FmYmMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgogI2luY2x1ZGUg
PGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgpAQCAt
MzUsOCArMzYsNiBAQAogI2luY2x1ZGUgIm1hbGlkcF9ody5oIgogCiAjZGVmaW5lIE1BTElEUF9D
T05GX1ZBTElEX1RJTUVPVVQJMjUwCi0jZGVmaW5lIEFGQkNfSEVBREVSX1NJWkUJCTE2Ci0jZGVm
aW5lIEFGQkNfU1VQRVJCTEtfQUxJR05NRU5UCQkxMjgKIAogc3RhdGljIHZvaWQgbWFsaWRwX3dy
aXRlX2dhbW1hX3RhYmxlKHN0cnVjdCBtYWxpZHBfaHdfZGV2aWNlICpod2RldiwKIAkJCQkgICAg
IHUzMiBkYXRhW01BTElEUF9DT0VGRlRBQl9OVU1fQ09FRkZTXSkKQEAgLTI3NywyNCArMjc2LDgg
QEAgbWFsaWRwX3ZlcmlmeV9hZmJjX2ZyYW1lYnVmZmVyX2NhcHMoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAkJCQkJbW9kZV9jbWQtPm1vZGlmaWVyWzBdKSA9PSBmYWxzZSkKIAkJcmV0dXJuIGZh
bHNlOwogCi0JaWYgKG1vZGVfY21kLT5vZmZzZXRzWzBdICE9IDApIHsKLQkJRFJNX0RFQlVHX0tN
UygiQUZCQyBidWZmZXJzJyBwbGFuZSBvZmZzZXQgc2hvdWxkIGJlIDBcbiIpOwotCQlyZXR1cm4g
ZmFsc2U7Ci0JfQotCi0Jc3dpdGNoIChtb2RlX2NtZC0+bW9kaWZpZXJbMF0gJiBBRkJDX1NJWkVf
TUFTSykgewotCWNhc2UgQUZCQ19TSVpFXzE2WDE2OgotCQlpZiAoKG1vZGVfY21kLT53aWR0aCAl
IDE2KSB8fCAobW9kZV9jbWQtPmhlaWdodCAlIDE2KSkgewotCQkJRFJNX0RFQlVHX0tNUygiQUZC
QyBidWZmZXJzIG11c3QgYmUgYWxpZ25lZCB0byAxNiBwaXhlbHNcbiIpOwotCQkJcmV0dXJuIGZh
bHNlOwotCQl9Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCURSTV9ERUJVR19LTVMoIlVuc3VwcG9y
dGVkIEFGQkMgYmxvY2sgc2l6ZVxuIik7Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlyZXR1cm4g
dHJ1ZTsKKwlyZXR1cm4gZHJtX2FmYmNfY2hlY2tfb2Zmc2V0KGRldiwgbW9kZV9jbWQpICYmCisJ
ICAgICAgIGRybV9hZmJjX2NoZWNrX3NpemVfYWxpZ24oZGV2LCBtb2RlX2NtZCk7CiB9CiAKIHN0
YXRpYyBib29sCkBAIC0zMDIsNTQgKzI4NSwyOSBAQCBtYWxpZHBfdmVyaWZ5X2FmYmNfZnJhbWVi
dWZmZXJfc2l6ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCSAgICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICptb2RlX2Nt
ZCkKIHsKLQlpbnQgbl9zdXBlcmJsb2NrcyA9IDA7CiAJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqaW5mbzsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9ianMgPSBOVUxMOwotCXUzMiBh
ZmJjX3N1cGVyYmxvY2tfc2l6ZSA9IDAsIGFmYmNfc3VwZXJibG9ja19oZWlnaHQgPSAwOwotCXUz
MiBhZmJjX3N1cGVyYmxvY2tfd2lkdGggPSAwLCBhZmJjX3NpemUgPSAwOwogCWludCBicHAgPSAw
OwotCi0Jc3dpdGNoIChtb2RlX2NtZC0+bW9kaWZpZXJbMF0gJiBBRkJDX1NJWkVfTUFTSykgewot
CWNhc2UgQUZCQ19TSVpFXzE2WDE2OgotCQlhZmJjX3N1cGVyYmxvY2tfaGVpZ2h0ID0gMTY7Ci0J
CWFmYmNfc3VwZXJibG9ja193aWR0aCA9IDE2OwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlEUk1f
REVCVUdfS01TKCJBRkJDIHN1cGVyYmxvY2sgc2l6ZSBpcyBub3Qgc3VwcG9ydGVkXG4iKTsKLQkJ
cmV0dXJuIGZhbHNlOwotCX0KKwl1MzIgdywgaDsKIAogCWluZm8gPSBkcm1fZ2V0X2Zvcm1hdF9p
bmZvKGRldiwgbW9kZV9jbWQpOwotCi0Jbl9zdXBlcmJsb2NrcyA9IChtb2RlX2NtZC0+d2lkdGgg
LyBhZmJjX3N1cGVyYmxvY2tfd2lkdGgpICoKLQkJKG1vZGVfY21kLT5oZWlnaHQgLyBhZmJjX3N1
cGVyYmxvY2tfaGVpZ2h0KTsKLQogCWJwcCA9IG1hbGlkcF9mb3JtYXRfZ2V0X2JwcChpbmZvLT5m
b3JtYXQpOwogCi0JYWZiY19zdXBlcmJsb2NrX3NpemUgPSAoYnBwICogYWZiY19zdXBlcmJsb2Nr
X3dpZHRoICogYWZiY19zdXBlcmJsb2NrX2hlaWdodCkKLQkJCQkvIEJJVFNfUEVSX0JZVEU7Ci0K
LQlhZmJjX3NpemUgPSBBTElHTihuX3N1cGVyYmxvY2tzICogQUZCQ19IRUFERVJfU0laRSwgQUZC
Q19TVVBFUkJMS19BTElHTk1FTlQpOwotCWFmYmNfc2l6ZSArPSBuX3N1cGVyYmxvY2tzICogQUxJ
R04oYWZiY19zdXBlcmJsb2NrX3NpemUsIEFGQkNfU1VQRVJCTEtfQUxJR05NRU5UKTsKLQotCWlm
ICgobW9kZV9jbWQtPndpZHRoICogYnBwKSAhPSAobW9kZV9jbWQtPnBpdGNoZXNbMF0gKiBCSVRT
X1BFUl9CWVRFKSkgewotCQlEUk1fREVCVUdfS01TKCJJbnZhbGlkIHZhbHVlIG9mIChwaXRjaCAq
IEJJVFNfUEVSX0JZVEUpICg9JXUpICIKLQkJCSAgICAgICJzaG91bGQgYmUgc2FtZSBhcyB3aWR0
aCAoPSV1KSAqIGJwcCAoPSV1KVxuIiwKLQkJCSAgICAgIChtb2RlX2NtZC0+cGl0Y2hlc1swXSAq
IEJJVFNfUEVSX0JZVEUpLAotCQkJICAgICAgbW9kZV9jbWQtPndpZHRoLCBicHApOwotCQlyZXR1
cm4gZmFsc2U7Ci0JfQotCiAJb2JqcyA9IGRybV9nZW1fb2JqZWN0X2xvb2t1cChmaWxlLCBtb2Rl
X2NtZC0+aGFuZGxlc1swXSk7CiAJaWYgKCFvYmpzKSB7CiAJCURSTV9ERUJVR19LTVMoIkZhaWxl
ZCB0byBsb29rdXAgR0VNIG9iamVjdFxuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAo
b2Jqcy0+c2l6ZSA8IGFmYmNfc2l6ZSkgewotCQlEUk1fREVCVUdfS01TKCJidWZmZXIgc2l6ZSAo
JXp1KSB0b28gc21hbGwgZm9yIEFGQkMgYnVmZmVyIHNpemUgPSAldVxuIiwKLQkJCSAgICAgIG9i
anMtPnNpemUsIGFmYmNfc2l6ZSk7CisJaWYgKCFkcm1fYWZiY19nZXRfc3VwZXJibGtfd2gobW9k
ZV9jbWQtPm1vZGlmaWVyWzBdLCAmdywgJmgpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAoIWRy
bV9hZmJjX2NoZWNrX2ZiX3NpemUobW9kZV9jbWQtPnBpdGNoZXNbMF0sIGJwcCwKKwkJCQkgICAg
bW9kZV9jbWQtPndpZHRoLCBtb2RlX2NtZC0+aGVpZ2h0LCB3LCBoLAorCQkJCSAgICBvYmpzLT5z
aXplLCBtb2RlX2NtZC0+b2Zmc2V0c1swXSwKKwkJCQkgICAgQUZCQ19TVVBFUkJMS19BTElHTk1F
TlQpKSB7CiAJCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChvYmpzKTsKKwogCQlyZXR1cm4g
ZmFsc2U7CiAJfQogCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
