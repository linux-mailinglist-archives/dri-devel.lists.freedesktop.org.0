Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BAE031CC21D
	for <lists+dri-devel@lfdr.de>; Sat,  9 May 2020 16:17:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A89A86E359;
	Sat,  9 May 2020 14:16:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav22.altibox.net (asav22.altibox.net [109.247.116.9])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 79A3D6E35F
 for <dri-devel@lists.freedesktop.org>; Sat,  9 May 2020 14:16:46 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav22.altibox.net (Postfix) with ESMTPSA id 3D86320193;
 Sat,  9 May 2020 16:16:44 +0200 (CEST)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org, linux-usb@vger.kernel.org,
 lee.jones@linaro.org
Subject: [PATCH v2 08/10] drm: Add Generic USB Display driver
Date: Sat,  9 May 2020 16:16:17 +0200
Message-Id: <20200509141619.32970-9-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20200509141619.32970-1-noralf@tronnes.org>
References: <20200509141619.32970-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=R7It5+ZX c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=SJz97ENfAAAA:8 a=gAmX6pxEAAAA:20
 a=e5mUnYsNAAAA:8 a=20KFwNOVAAAA:8 a=CUepv2jGAAAA:20
 a=JeAX4I3GZd6e_pumDaIA:9 a=hETYwc0dWSdbTXp8:21 a=guAMszC-7INa9xsq:21
 a=QEXdDO2ut3YA:10 a=vFet0B0WnEQeilDPIY6i:22 a=Vxmtnl_E_bksehYqCbjh:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: jingoohan1@gmail.com, daniel.thompson@linaro.org, sam@ravnborg.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgZ2VuZXJpYyBVU0IgZGlzcGxheSBkcml2ZXIgd2l0aCB0aGUgaW50ZW50aW9u
IHRoYXQgaXQgY2FuIGJlCnVzZWQgd2l0aCBmdXR1cmUgVVNCIGludGVyZmFjZWQgbG93IGVuZCBk
aXNwbGF5cy9hZGFwdGVycy4gVGhlIExpbnV4CmdhZGdldCBkZXZpY2UgZHJpdmVyIHdpbGwgc2Vy
dmUgYXMgdGhlIGNhbm9uaWNhbCBkZXZpY2UgaW1wbGVtZW50YXRpb24uCgpUaGUgZm9sbG93aW5n
IERSTSBwcm9wZXJ0aWVzIGFyZSBzdXBwb3J0ZWQ6Ci0gUGxhbmUgcm90YXRpb24KLSBDb25uZWN0
b3IgVFYgcHJvcGVydGllcwoKVGhlcmUgaXMgYWxzbyBzdXBwb3J0IGZvciBiYWNrbGlnaHQgYnJp
Z2h0bmVzcyBleHBvc2VkIGFzIGEgYmFja2xpZ2h0CmRldmljZS4KCkRpc3BsYXkgbW9kZXMgY2Fu
IGJlIG1hZGUgYXZhaWxhYmxlIHRvIHRoZSBob3N0IGRyaXZlciBlaXRoZXIgYXMgRFJNCmRpc3Bs
YXkgbW9kZXMgb3IgdGhyb3VnaCBFRElELiBJZiBib3RoIGFyZSBwcmVzZW50LCBFRElEIGlzIGp1
c3QgcGFzc2VkCm9uIHRvIHVzZXJzcGFjZS4KClBlcmZvcm1hbmNlIGlzIHByZWZlcnJlZCBvdmVy
IGNvbG9yIGRlcHRoLCBzbyBpZiB0aGUgZGV2aWNlIHN1cHBvcnRzClJHQjU2NSwgRFJNX0NBUF9E
VU1CX1BSRUZFUlJFRF9ERVBUSCB3aWxsIHJldHVybiAxNi4KCklmIHRoZSBkZXZpY2UgdHJhbnNm
ZXIgYnVmZmVyIGNhbid0IGZpdCBhbiB1bmNvbXByZXNzZWQgZnJhbWVidWZmZXIKdXBkYXRlLCB0
aGUgdXBkYXRlIGlzIHNwbGl0IHVwIGludG8gcGFydHMgdGhhdCBkbyBmaXQuCgpPcHRpbWFsIHVz
ZXIgZXhwZXJpZW5jZSBpcyBhY2hpZXZlZCBieSBwcm92aWRpbmcgZGFtYWdlIHJlcG9ydHMgZWl0
aGVyIGJ5CnNldHRpbmcgRkJfREFNQUdFX0NMSVBTIG9uIHBhZ2VmbGlwcyBvciBjYWxsaW5nIERS
TV9JT0NUTF9NT0RFX0RJUlRZRkIuCgpMWjQgY29tcHJlc3Npb24gaXMgdXNlZCBpZiB0aGUgZGV2
aWNlIHN1cHBvcnRzIGl0LgoKVGhlIGRyaXZlciBzdXBwb3J0cyBhIG9uZSBiaXQgbW9ub2Nocm9t
ZSB0cmFuc2ZlciBmb3JtYXQ6IFIxLiBUaGlzIGlzIG5vdAppbXBsZW1lbnRlZCBpbiB0aGUgZ2Fk
Z2V0IGRyaXZlci4gSXQgaXMgYWRkZWQgaW4gcHJlcGFyYXRpb24gZm9yIGZ1dHVyZQptb25vY2hy
b21lIGUtaW5rIGRpc3BsYXlzLgoKVGhlIGRyaXZlciBpcyBNSVQgbGljZW5zZWQgdG8gc21vb3Ro
IHRoZSBwYXRoIGZvciBhbnkgQlNEIHBvcnQgb2YgdGhlCmRyaXZlci4KCnYyOgotIFVzZSBkZXZt
X2RybV9kZXZfYWxsb2MoKSBhbmQgZHJtbV9tb2RlX2NvbmZpZ19pbml0KCkKLSBkcm1fZmJkZXZf
Z2VuZXJpY19zZXR1cDogVXNlIHByZWZlcnJlZF9icHA9MCwgMTYgd2FzIGEgY29weSBwYXN0ZSBl
cnJvcgotIFRoZSBkcm1fYmFja2xpZ2h0X2hlbHBlciBpcyBkcm9wcGVkLCBjb3B5IGluIHRoZSBj
b2RlCi0gU3VwcG9ydCBwcm90b2NvbCB2ZXJzaW9uIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZv
ciBkZXZpY2UKClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMu
b3JnPgotLS0KIE1BSU5UQUlORVJTICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgOCAr
CiBkcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyAgICAgICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVy
cy9ncHUvZHJtL01ha2VmaWxlICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2Ry
bS9ndWQvS2NvbmZpZyAgICAgICAgICAgICB8ICAxNCArCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL01h
a2VmaWxlICAgICAgICAgICAgfCAgIDQgKwogZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Nv
bm5lY3Rvci5jIHwgNzI0ICsrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJt
L2d1ZC9ndWRfZHJtX2Rydi5jICAgICAgIHwgNjQxICsrKysrKysrKysrKysrKysrKysrKwogZHJp
dmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2ludGVybmFsLmggIHwgIDY2ICsrKwogZHJpdmVycy9n
cHUvZHJtL2d1ZC9ndWRfZHJtX3BpcGUuYyAgICAgIHwgNDIzICsrKysrKysrKysrKysrCiBpbmNs
dWRlL2RybS9ndWRfZHJtLmggICAgICAgICAgICAgICAgICAgfCAzNjQgKysrKysrKysrKysrCiAx
MCBmaWxlcyBjaGFuZ2VkLCAyMjQ3IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25maWcKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dw
dS9kcm0vZ3VkL01ha2VmaWxlCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1
ZC9ndWRfZHJtX2Nvbm5lY3Rvci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJt
L2d1ZC9ndWRfZHJtX2Rydi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1
ZC9ndWRfZHJtX2ludGVybmFsLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0v
Z3VkL2d1ZF9kcm1fcGlwZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9kcm0vZ3VkX2Ry
bS5oCgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCA1ZmE5YmVh
Y2VlODYuLjc0OTRhMjFlYTQxZSAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRB
SU5FUlMKQEAgLTUyOTEsNiArNTI5MSwxNCBAQCBTOglNYWludGFpbmVkCiBGOglkcml2ZXJzL2dw
dS9kcm0vcGFuZWwvcGFuZWwtZmVpeWFuZy1meTA3MDI0ZGkyNmEzMGQuYwogRjoJRG9jdW1lbnRh
dGlvbi9kZXZpY2V0cmVlL2JpbmRpbmdzL2Rpc3BsYXkvcGFuZWwvZmVpeWFuZyxmeTA3MDI0ZGky
NmEzMGQueWFtbAogCitEUk0gRFJJVkVSIEZPUiBHRU5FUklDIFVTQiBESVNQTEFZCitNOglOb3Jh
bGYgVHLDuG5uZXMgPG5vcmFsZkB0cm9ubmVzLm9yZz4KK1M6CU1haW50YWluZWQKK1c6CWh0dHBz
Oi8vZ2l0aHViLmNvbS9ub3Ryby9ndWQvd2lraQorVDoJZ2l0IGdpdDovL2Fub25naXQuZnJlZWRl
c2t0b3Aub3JnL2RybS9kcm0tbWlzYworRjoJZHJpdmVycy9ncHUvZHJtL2d1ZC8KK0Y6CWluY2x1
ZGUvZHJtL2d1ZF9kcm0uaAorCiBEUk0gRFJJVkVSIEZPUiBHUkFJTiBNRURJQSBHTTEyVTMyMCBQ
Uk9KRUNUT1JTCiBNOglIYW5zIGRlIEdvZWRlIDxoZGVnb2VkZUByZWRoYXQuY29tPgogUzoJTWFp
bnRhaW5lZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL0tjb25maWcgYi9kcml2ZXJzL2dw
dS9kcm0vS2NvbmZpZwppbmRleCA0YmZmYTA4ZjYxMGEuLjMzZTYzYjY4YTgyZCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL0tjb25maWcK
QEAgLTM5MSw2ICszOTEsOCBAQCBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS9tY2RlL0tjb25maWci
CiAKIHNvdXJjZSAiZHJpdmVycy9ncHUvZHJtL3RpZHNzL0tjb25maWciCiAKK3NvdXJjZSAiZHJp
dmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnIgorCiAjIEtlZXAgbGVnYWN5IGRyaXZlcnMgbGFzdAog
CiBtZW51Y29uZmlnIERSTV9MRUdBQ1kKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9NYWtl
ZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQppbmRleCA1M2Q4ZmExNzAxNDMuLjQxYTg3
NzYzZjBlNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtMTI0LDMgKzEyNCw0IEBAIG9iai0kKENPTkZJR19EUk1f
UEFORlJPU1QpICs9IHBhbmZyb3N0Lwogb2JqLSQoQ09ORklHX0RSTV9BU1BFRURfR0ZYKSArPSBh
c3BlZWQvCiBvYmotJChDT05GSUdfRFJNX01DREUpICs9IG1jZGUvCiBvYmotJChDT05GSUdfRFJN
X1RJRFNTKSArPSB0aWRzcy8KK29iai15CQkJKz0gZ3VkLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2d1ZC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNzY3ZjFjMDY3ZWQ5Ci0tLSAvZGV2L251
bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnCkBAIC0wLDAgKzEsMTQgQEAKKyMg
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKworY29uZmlnIERSTV9HVUQKKwl0cmlz
dGF0ZSAiR2VuZXJpYyBVU0IgRGlzcGxheSIKKwlkZXBlbmRzIG9uIERSTSAmJiBVU0IKKwlzZWxl
Y3QgTFo0X0NPTVBSRVNTCisJc2VsZWN0IERSTV9LTVNfSEVMUEVSCisJc2VsZWN0IERSTV9HRU1f
U0hNRU1fSEVMUEVSCisJc2VsZWN0IEJBQ0tMSUdIVF9DTEFTU19ERVZJQ0UKKwloZWxwCisJICBU
aGlzIGlzIGEgRFJNIGRpc3BsYXkgZHJpdmVyIGZvciBHZW5lcmljIFVTQiBEaXNwbGF5cyBvciBk
aXNwbGF5CisJICBhZGFwdGVycy4KKworCSAgSWYgTSBpcyBzZWxlY3RlZCB0aGUgbW9kdWxlIHdp
bGwgYmUgY2FsbGVkIGd1ZF9kcm0uCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL01h
a2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjczZWQ3ZWYzZGE5NAotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9ndWQvTWFrZWZpbGUKQEAgLTAsMCArMSw0IEBACisjIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBHUEwtMi4wCisKK2d1ZF9kcm0tb2JqcwkJCTo9IGd1ZF9kcm1fZHJ2Lm8g
Z3VkX2RybV9waXBlLm8gZ3VkX2RybV9jb25uZWN0b3Iubworb2JqLSQoQ09ORklHX0RSTV9HVUQp
CQkrPSBndWRfZHJtLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9j
b25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9jb25uZWN0b3IuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmViYTE2NjU1ODJmNAotLS0gL2Rl
di9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9jb25uZWN0b3IuYwpAQCAt
MCwwICsxLDcyNCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENv
cHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNsdWRlIDxsaW51eC9iYWNr
bGlnaHQuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CisjaW5jbHVkZSA8ZHJtL2Ry
bV9hdG9taWNfc3RhdGVfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jb25uZWN0b3IuaD4K
KyNpbmNsdWRlIDxkcm0vZHJtX2Rydi5oPgorI2luY2x1ZGUgPGRybS9kcm1fZW5jb2Rlci5oPgor
I2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fbW9kZXNldF9oZWxw
ZXJfdnRhYmxlcy5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX3Byb2JlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIu
aD4KKyNpbmNsdWRlIDxkcm0vZ3VkX2RybS5oPgorCisjaW5jbHVkZSAiZ3VkX2RybV9pbnRlcm5h
bC5oIgorCitzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgeworCXN0cnVjdCBkcm1fY29ubmVjdG9y
IGNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgZW5jb2RlcjsKKwlzdHJ1Y3QgYmFja2xp
Z2h0X2RldmljZSAqYmFja2xpZ2h0OworCisJdTMyIGZsYWdzOworCisJLyogU3VwcG9ydGVkIHBy
b3BlcnRpZXMgKi8KKwl1MTYgKnByb3BlcnRpZXM7CisJdW5zaWduZWQgaW50IG51bV9wcm9wZXJ0
aWVzOworCisJLyogSW5pdGlhbCBnYWRnZXQgdHYgc3RhdGUgaWYgYXBwbGljYWJsZSwgYXBwbGll
ZCBvbiBzdGF0ZSByZXNldCAqLworCXN0cnVjdCBkcm1fdHZfY29ubmVjdG9yX3N0YXRlIGluaXRp
YWxfdHZfc3RhdGU7CisKKwkvKgorCSAqIEluaXRpYWwgZ2FkZ2V0IGJhY2tsaWdodCBicmlnaHRu
ZXNzIGlmIGFwcGxpY2FibGUsIGFwcGxpZWQgb24gc3RhdGUgcmVzZXQuCisJICogVGhlIHZhbHVl
IC1FTk9ERVYgaXMgdXNlZCBpbnRlcm5hbGx5IHRvIHNpZ25hbCBubyBiYWNrbGlnaHQuCisJICov
CisJaW50IGluaXRpYWxfYnJpZ2h0bmVzczsKKworCS8qIFN1cHBvcnRlZCBkaXNwbGF5IG1vZGVz
IGluIHRyYW5zZmVyIGZvcm1hdCAqLworCXN0cnVjdCBndWRfZHJtX2Rpc3BsYXlfbW9kZSAqbW9k
ZXM7CisJdW5zaWduZWQgaW50IG51bV9tb2RlczsKKworCS8qIEVESUQgKi8KKwl2b2lkICplZGlk
OworCXNpemVfdCBlZGlkX2xlbjsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGd1ZF9kcm1f
Y29ubmVjdG9yICp0b19ndWRfZHJtX2Nvbm5lY3RvcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29u
bmVjdG9yKQoreworCXJldHVybiBjb250YWluZXJfb2YoY29ubmVjdG9yLCBzdHJ1Y3QgZ3VkX2Ry
bV9jb25uZWN0b3IsIGNvbm5lY3Rvcik7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0
b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkKQor
eworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBibF9nZXRfZGF0YShiZCk7CisJ
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZTsKKwlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5kZXY7CisJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVp
cmVfY3R4IGN0eDsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGU7CisJaW50IHJldDsK
KworCXN0YXRlID0gZHJtX2F0b21pY19zdGF0ZV9hbGxvYyhkZXYpOworCWlmICghc3RhdGUpCisJ
CXJldHVybiAtRU5PTUVNOworCisJZHJtX21vZGVzZXRfYWNxdWlyZV9pbml0KCZjdHgsIDApOwor
CXN0YXRlLT5hY3F1aXJlX2N0eCA9ICZjdHg7CityZXRyeToKKwljb25uZWN0b3Jfc3RhdGUgPSBk
cm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rvcik7CisJaWYgKElT
X0VSUihjb25uZWN0b3Jfc3RhdGUpKSB7CisJCXJldCA9IFBUUl9FUlIoY29ubmVjdG9yX3N0YXRl
KTsKKwkJZ290byBvdXQ7CisJfQorCisJLyogUmV1c2UgdHYuYnJpZ2h0bmVzcyB0byBhdm9pZCBo
YXZpbmcgdG8gc3ViY2xhc3MgKi8KKwljb25uZWN0b3Jfc3RhdGUtPnR2LmJyaWdodG5lc3MgPSBi
ZC0+cHJvcHMuYnJpZ2h0bmVzczsKKworCXJldCA9IGRybV9hdG9taWNfY29tbWl0KHN0YXRlKTsK
K291dDoKKwlpZiAocmV0ID09IC1FREVBRExLKSB7CisJCWRybV9hdG9taWNfc3RhdGVfY2xlYXIo
c3RhdGUpOworCQlkcm1fbW9kZXNldF9iYWNrb2ZmKCZjdHgpOworCQlnb3RvIHJldHJ5OworCX0K
KworCWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsKKworCWRybV9tb2Rlc2V0X2Ryb3BfbG9j
a3MoJmN0eCk7CisJZHJtX21vZGVzZXRfYWNxdWlyZV9maW5pKCZjdHgpOworCisJcmV0dXJuIHJl
dDsKK30KKworc3RhdGljIGludCBndWRfZHJtX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfZ2V0X2JyaWdo
dG5lc3Moc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkKQoreworCXN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IgPSBibF9nZXRfZGF0YShiZCk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNvbm5lY3Rvci0+ZGV2OworCWludCBicmlnaHRuZXNzOworCisJZHJtX21vZGVzZXRfbG9j
aygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LCBOVUxMKTsKKwlicmlnaHRuZXNz
ID0gY29ubmVjdG9yLT5zdGF0ZS0+dHYuYnJpZ2h0bmVzczsKKwlkcm1fbW9kZXNldF91bmxvY2so
JmRldi0+bW9kZV9jb25maWcuY29ubmVjdGlvbl9tdXRleCk7CisKKwlyZXR1cm4gYnJpZ2h0bmVz
czsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBiYWNrbGlnaHRfb3BzIGd1ZF9kcm1fY29ubmVj
dG9yX2JhY2tsaWdodF9vcHMgPSB7CisJLmdldF9icmlnaHRuZXNzID0gZ3VkX2RybV9jb25uZWN0
b3JfYmFja2xpZ2h0X2dldF9icmlnaHRuZXNzLAorCS51cGRhdGVfc3RhdHVzCT0gZ3VkX2RybV9j
b25uZWN0b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMsCit9OworCitzdGF0aWMgaW50IGd1ZF9k
cm1fY29ubmVjdG9yX2JhY2tsaWdodF9yZWdpc3RlcihzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3Ig
Kmdjb25uKQoreworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSAmZ2Nvbm4tPmNv
bm5lY3RvcjsKKwlzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQ7CisJY29uc3QgY2hhciAqbmFt
ZTsKKwljb25zdCBzdHJ1Y3QgYmFja2xpZ2h0X3Byb3BlcnRpZXMgcHJvcHMgPSB7CisJCS50eXBl
ID0gQkFDS0xJR0hUX1JBVywKKwkJLnNjYWxlID0gQkFDS0xJR0hUX1NDQUxFX05PTl9MSU5FQVIs
CisJCS5tYXhfYnJpZ2h0bmVzcyA9IDEwMCwKKwl9OworCisJbmFtZSA9IGthc3ByaW50ZihHRlBf
S0VSTkVMLCAiY2FyZCVkLSVzLWJhY2tsaWdodCIsCisJCQkgY29ubmVjdG9yLT5kZXYtPnByaW1h
cnktPmluZGV4LCBjb25uZWN0b3ItPm5hbWUpOworCWlmICghbmFtZSkKKwkJcmV0dXJuIC1FTk9N
RU07CisKKwliZCA9IGJhY2tsaWdodF9kZXZpY2VfcmVnaXN0ZXIobmFtZSwgY29ubmVjdG9yLT5r
ZGV2LCBjb25uZWN0b3IsCisJCQkJICAgICAgICZndWRfZHJtX2Nvbm5lY3Rvcl9iYWNrbGlnaHRf
b3BzLCAmcHJvcHMpOworCWtmcmVlKG5hbWUpOworCWlmIChJU19FUlIoYmQpKQorCQlyZXR1cm4g
UFRSX0VSUihiZCk7CisKKwlnY29ubi0+YmFja2xpZ2h0ID0gYmQ7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQgZ3VkX2RybV9jb25uZWN0b3JfbW9kZXNfY2xlYXIoc3RydWN0IGd1ZF9k
cm1fY29ubmVjdG9yICpnY29ubikKK3sKKwlrZnJlZShnY29ubi0+bW9kZXMpOworCWdjb25uLT5t
b2RlcyA9IE5VTEw7CisJZ2Nvbm4tPm51bV9tb2RlcyA9IDA7Cit9CisKK3N0YXRpYyBpbnQgZ3Vk
X2RybV9jb25uZWN0b3JfbW9kZXNfZ2V0KHN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciAqZ2Nvbm4s
IHVuc2lnbmVkIGludCBudW1fbW9kZXMpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJt
ID0gdG9fZ3VkX2RybV9kZXZpY2UoZ2Nvbm4tPmNvbm5lY3Rvci5kZXYpOworCXVuc2lnbmVkIGlu
dCBpbmRleCA9IGdjb25uLT5jb25uZWN0b3IuaW5kZXg7CisJaW50IHJldCA9IDA7CisKKwlpZiAo
IW51bV9tb2RlcykKKwkJZ290byBjbGVhcjsKKworCWd1ZF9kcm1fY29ubmVjdG9yX21vZGVzX2Ns
ZWFyKGdjb25uKTsKKworCWdjb25uLT5tb2RlcyA9IGttYWxsb2NfYXJyYXkobnVtX21vZGVzLCBz
aXplb2YoKmdjb25uLT5tb2RlcyksIEdGUF9LRVJORUwpOworCWlmICghZ2Nvbm4tPm1vZGVzKQor
CQlyZXR1cm4gLUVOT01FTTsKKworCWdjb25uLT5udW1fbW9kZXMgPSBudW1fbW9kZXM7CisKKwly
ZXQgPSBndWRfZHJtX3VzYl9nZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1Jf
TU9ERVMsIGluZGV4LAorCQkJICAgICAgZ2Nvbm4tPm1vZGVzLCBudW1fbW9kZXMgKiBzaXplb2Yo
Kmdjb25uLT5tb2RlcykpOworCWlmIChyZXQpCisJCWdvdG8gY2xlYXI7CisKKwlyZXR1cm4gMDsK
K2NsZWFyOgorCWd1ZF9kcm1fY29ubmVjdG9yX21vZGVzX2NsZWFyKGdjb25uKTsKKworCXJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGd1ZF9kcm1fY29ubmVjdG9yX2VkaWRfY2xlYXIoc3Ry
dWN0IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubikKK3sKKwlrZnJlZShnY29ubi0+ZWRpZCk7CisJ
Z2Nvbm4tPmVkaWQgPSBOVUxMOworCWdjb25uLT5lZGlkX2xlbiA9IDA7Cit9CisKK3N0YXRpYyBp
bnQgZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9nZXQoc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpn
Y29ubiwgc2l6ZV90IGxlbikKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB0b19n
dWRfZHJtX2RldmljZShnY29ubi0+Y29ubmVjdG9yLmRldik7CisJdW5zaWduZWQgaW50IGluZGV4
ID0gZ2Nvbm4tPmNvbm5lY3Rvci5pbmRleDsKKwlpbnQgcmV0ID0gMDsKKworCWlmICghbGVuKQor
CQlnb3RvIGNsZWFyOworCisJZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9jbGVhcihnY29ubik7CisK
KwlnY29ubi0+ZWRpZCA9IGttYWxsb2MobGVuLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uLT5l
ZGlkKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWdjb25uLT5lZGlkX2xlbiA9IGxlbjsKKworCXJl
dCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUl9F
RElELCBpbmRleCwgZ2Nvbm4tPmVkaWQsIGxlbik7CisJaWYgKHJldCkKKwkJZ290byBjbGVhcjsK
KworCXJldHVybiAwOworY2xlYXI6CisJZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9jbGVhcihnY29u
bik7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fY29ubmVjdG9yX2Rl
dGVjdF9zYWZlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCit7
CisJc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29ubmVjdG9y
KGNvbm5lY3Rvcik7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RybV9k
ZXZpY2UoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBndWRfZHJtX3JlcV9nZXRfY29ubmVjdG9y
X3N0YXR1cyByZXE7CisJdTE2IG51bV9tb2RlcywgZWRpZF9sZW47CisJaW50IHN0YXR1cywgcmV0
OworCWJvb2wgY2hhbmdlZDsKKworCWlmIChmb3JjZSkgeworCQlyZXQgPSBndWRfZHJtX3VzYl9z
ZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9DT05ORUNUT1JfRk9SQ0VfREVURUNULAorCQkJ
CSAgICAgIGNvbm5lY3Rvci0+aW5kZXgsIE5VTEwsIDApOworCQlpZiAocmV0KQorCQkJZ290byBm
cmVlOworCX0KKworCXJldCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFf
R0VUX0NPTk5FQ1RPUl9TVEFUVVMsCisJCQkgICAgICBjb25uZWN0b3ItPmluZGV4LCAmcmVxLCBz
aXplb2YocmVxKSk7CisJaWYgKHJldCkKKwkJZ290byBmcmVlOworCisJY2hhbmdlZCA9IHJlcS5z
dGF0dXMgJiBHVURfRFJNX0NPTk5FQ1RPUl9TVEFUVVNfQ0hBTkdFRDsKKwlzdGF0dXMgPSByZXEu
c3RhdHVzICYgR1VEX0RSTV9DT05ORUNUT1JfU1RBVFVTX01BU0s7CisJaWYgKHN0YXR1cyA+IGNv
bm5lY3Rvcl9zdGF0dXNfdW5rbm93bikKKwkJc3RhdHVzID0gY29ubmVjdG9yX3N0YXR1c191bmtu
b3duOworCW51bV9tb2RlcyA9IGxlMTZfdG9fY3B1KHJlcS5udW1fbW9kZXMpOworCWVkaWRfbGVu
ID0gbGUxNl90b19jcHUocmVxLmVkaWRfbGVuKTsKKworCWlmICghbnVtX21vZGVzICYmICFlZGlk
X2xlbikgeworCQlyZXQgPSBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKKwkJZ290byBm
cmVlOworCX0KKworCWlmICghY2hhbmdlZCAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBzdGF0dXMg
JiYKKwkgICAgZ2Nvbm4tPm51bV9tb2RlcyA9PSBudW1fbW9kZXMgJiYgZ2Nvbm4tPmVkaWRfbGVu
ID09IGVkaWRfbGVuKQorCQlyZXR1cm4gc3RhdHVzOworCisJcmV0ID0gZ3VkX2RybV9jb25uZWN0
b3JfbW9kZXNfZ2V0KGdjb25uLCBudW1fbW9kZXMpOworCWlmIChyZXQpCisJCWdvdG8gZnJlZTsK
KworCXJldCA9IGd1ZF9kcm1fY29ubmVjdG9yX2VkaWRfZ2V0KGdjb25uLCBlZGlkX2xlbik7CisJ
aWYgKHJldCkKKwkJZ290byBmcmVlOworCisJcmV0dXJuIHN0YXR1czsKK2ZyZWU6CisJZ3VkX2Ry
bV9jb25uZWN0b3JfbW9kZXNfY2xlYXIoZ2Nvbm4pOworCWd1ZF9kcm1fY29ubmVjdG9yX2VkaWRf
Y2xlYXIoZ2Nvbm4pOworCisJcmV0dXJuIHJldCA8IDAgPyBjb25uZWN0b3Jfc3RhdHVzX3Vua25v
d24gOiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0b3JfZGV0ZWN0KHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgIHN0cnVjdCBkcm1fbW9kZXNldF9h
Y3F1aXJlX2N0eCAqY3R4LCBib29sIGZvcmNlKQoreworCWludCBpZHgsIHJldDsKKworCWlmICgh
ZHJtX2Rldl9lbnRlcihjb25uZWN0b3ItPmRldiwgJmlkeCkpCisJCXJldHVybiAtRU5PREVWOwor
CisJcmV0ID0gZ3VkX2RybV9jb25uZWN0b3JfZGV0ZWN0X3NhZmUoY29ubmVjdG9yLCBmb3JjZSk7
CisKKwlkcm1fZGV2X2V4aXQoaWR4KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQg
Z3VkX2RybV9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IpCit7CisJc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29u
bmVjdG9yKGNvbm5lY3Rvcik7CisJdW5zaWduZWQgaW50IGksIG51bV9tb2RlcyA9IDA7CisKKwlp
ZiAoIWdjb25uLT5udW1fbW9kZXMpCisJCXJldHVybiBkcm1fYWRkX2VkaWRfbW9kZXMoY29ubmVj
dG9yLCBnY29ubi0+ZWRpZCk7CisKKwlmb3IgKGkgPSAwOyBpIDwgZ2Nvbm4tPm51bV9tb2Rlczsg
aSsrKSB7CisJCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlOworCisJCW1vZGUgPSBkcm1f
bW9kZV9jcmVhdGUoY29ubmVjdG9yLT5kZXYpOworCQlpZiAoIW1vZGUpCisJCQlnb3RvIG91dDsK
KworCQlndWRfZHJtX3RvX2Rpc3BsYXlfbW9kZShtb2RlLCAmZ2Nvbm4tPm1vZGVzW2ldKTsKKwor
CQlkcm1fbW9kZV9wcm9iZWRfYWRkKGNvbm5lY3RvciwgbW9kZSk7CisJCW51bV9tb2RlcysrOwor
CX0KK291dDoKKwlpZiAoZ2Nvbm4tPmVkaWRfbGVuKQorCQlkcm1fY29ubmVjdG9yX3VwZGF0ZV9l
ZGlkX3Byb3BlcnR5KGNvbm5lY3RvciwgZ2Nvbm4tPmVkaWQpOworCisJcmV0dXJuIG51bV9tb2Rl
czsKK30KKworc3RhdGljIGludCBndWRfZHJtX2Nvbm5lY3Rvcl9hdG9taWNfY2hlY2soc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm5ld19zdGF0ZTsKKwlz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY29ubmVj
dG9yX3N0YXRlICpvbGRfc3RhdGU7CisKKwluZXdfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdf
Y29ubmVjdG9yX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCWlmICghbmV3X3N0YXRlLT5jcnRj
KQorCQlyZXR1cm4gMDsKKworCW9sZF9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jb25uZWN0
b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rvcik7CisJbmV3X2NydGNfc3RhdGUgPSBkcm1fYXRvbWlj
X2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgbmV3X3N0YXRlLT5jcnRjKTsKKworCWlmIChvbGRf
c3RhdGUtPnR2LnN1YmNvbm5lY3RvciAhPSBuZXdfc3RhdGUtPnR2LnN1YmNvbm5lY3RvciB8fAor
CSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMubGVmdCAhPSBuZXdfc3RhdGUtPnR2Lm1hcmdpbnMu
bGVmdCB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMucmlnaHQgIT0gbmV3X3N0YXRlLT50
di5tYXJnaW5zLnJpZ2h0IHx8CisJICAgIG9sZF9zdGF0ZS0+dHYubWFyZ2lucy50b3AgIT0gbmV3
X3N0YXRlLT50di5tYXJnaW5zLnRvcCB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMuYm90
dG9tICE9IG5ld19zdGF0ZS0+dHYubWFyZ2lucy5ib3R0b20gfHwKKwkgICAgb2xkX3N0YXRlLT50
di5tb2RlICE9IG5ld19zdGF0ZS0+dHYubW9kZSB8fAorCSAgICBvbGRfc3RhdGUtPnR2LmJyaWdo
dG5lc3MgIT0gbmV3X3N0YXRlLT50di5icmlnaHRuZXNzIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYu
Y29udHJhc3QgIT0gbmV3X3N0YXRlLT50di5jb250cmFzdCB8fAorCSAgICBvbGRfc3RhdGUtPnR2
LmZsaWNrZXJfcmVkdWN0aW9uICE9IG5ld19zdGF0ZS0+dHYuZmxpY2tlcl9yZWR1Y3Rpb24gfHwK
KwkgICAgb2xkX3N0YXRlLT50di5vdmVyc2NhbiAhPSBuZXdfc3RhdGUtPnR2Lm92ZXJzY2FuIHx8
CisJICAgIG9sZF9zdGF0ZS0+dHYuc2F0dXJhdGlvbiAhPSBuZXdfc3RhdGUtPnR2LnNhdHVyYXRp
b24gfHwKKwkgICAgb2xkX3N0YXRlLT50di5odWUgIT0gbmV3X3N0YXRlLT50di5odWUpCisJCW5l
d19jcnRjX3N0YXRlLT5jb25uZWN0b3JzX2NoYW5nZWQgPSB0cnVlOworCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MgZ3VkX2Ry
bV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzID0geworCS5kZXRlY3RfY3R4ID0gZ3VkX2RybV9jb25u
ZWN0b3JfZGV0ZWN0LAorCS5nZXRfbW9kZXMgPSBndWRfZHJtX2Nvbm5lY3Rvcl9nZXRfbW9kZXMs
CisJLmF0b21pY19jaGVjayA9IGd1ZF9kcm1fY29ubmVjdG9yX2F0b21pY19jaGVjaywKK307CisK
K3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0b3JfbGF0ZV9yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciAqZ2Nvbm4g
PSB0b19ndWRfZHJtX2Nvbm5lY3Rvcihjb25uZWN0b3IpOworCisJaWYgKGdjb25uLT5pbml0aWFs
X2JyaWdodG5lc3MgPCAwKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBndWRfZHJtX2Nvbm5lY3Rv
cl9iYWNrbGlnaHRfcmVnaXN0ZXIoZ2Nvbm4pOworfQorCitzdGF0aWMgdm9pZCBndWRfZHJtX2Nv
bm5lY3Rvcl9lYXJseV91bnJlZ2lzdGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Ip
Cit7CisJc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29ubmVj
dG9yKGNvbm5lY3Rvcik7CisKKwliYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIoZ2Nvbm4tPmJh
Y2tsaWdodCk7Cit9CisKK3N0YXRpYyB2b2lkIGd1ZF9kcm1fY29ubmVjdG9yX2Rlc3Ryb3koc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0
b3IgKmdjb25uID0gdG9fZ3VkX2RybV9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCWRybV9jb25u
ZWN0b3JfY2xlYW51cChjb25uZWN0b3IpOworCWd1ZF9kcm1fY29ubmVjdG9yX21vZGVzX2NsZWFy
KGdjb25uKTsKKwlndWRfZHJtX2Nvbm5lY3Rvcl9lZGlkX2NsZWFyKGdjb25uKTsKKwlrZnJlZShn
Y29ubi0+cHJvcGVydGllcyk7CisJa2ZyZWUoZ2Nvbm4pOworfQorCitzdGF0aWMgdm9pZCBndWRf
ZHJtX2Nvbm5lY3Rvcl9yZXNldChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQorewor
CXN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciAqZ2Nvbm4gPSB0b19ndWRfZHJtX2Nvbm5lY3Rvcihj
b25uZWN0b3IpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX3Jlc2V0KGNvbm5lY3Rv
cik7CisJY29ubmVjdG9yLT5zdGF0ZS0+dHYgPSBnY29ubi0+aW5pdGlhbF90dl9zdGF0ZTsKKwkv
KiBTZXQgbWFyZ2lucyBmcm9tIGNvbW1hbmQgbGluZSAqLworCWRybV9hdG9taWNfaGVscGVyX2Nv
bm5lY3Rvcl90dl9yZXNldChjb25uZWN0b3IpOworCWlmIChnY29ubi0+aW5pdGlhbF9icmlnaHRu
ZXNzID49IDApCisJCWNvbm5lY3Rvci0+c3RhdGUtPnR2LmJyaWdodG5lc3MgPSBnY29ubi0+aW5p
dGlhbF9icmlnaHRuZXNzOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
ZnVuY3MgZ3VkX2RybV9jb25uZWN0b3JfZnVuY3MgPSB7CisJLmZpbGxfbW9kZXMgPSBkcm1faGVs
cGVyX3Byb2JlX3NpbmdsZV9jb25uZWN0b3JfbW9kZXMsCisJLmxhdGVfcmVnaXN0ZXIgPSBndWRf
ZHJtX2Nvbm5lY3Rvcl9sYXRlX3JlZ2lzdGVyLAorCS5lYXJseV91bnJlZ2lzdGVyID0gZ3VkX2Ry
bV9jb25uZWN0b3JfZWFybHlfdW5yZWdpc3RlciwKKwkuZGVzdHJveSA9IGd1ZF9kcm1fY29ubmVj
dG9yX2Rlc3Ryb3ksCisJLnJlc2V0ID0gZ3VkX2RybV9jb25uZWN0b3JfcmVzZXQsCisJLmF0b21p
Y19kdXBsaWNhdGVfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZHVwbGljYXRl
X3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2Nvbm5l
Y3Rvcl9kZXN0cm95X3N0YXRlLAorfTsKKworLyoKKyAqIFRoZSB0di5tb2RlIHByb3BlcnR5IGlz
IHNoYXJlZCBhbW9uZyB0aGUgY29ubmVjdG9ycyBhbmQgaXRzIGVudW0gbmFtZXMgYXJlCisgKiBk
cml2ZXIgc3BlY2lmaWMuIFRoaXMgbWVhbnMgdGhhdCBpZiBtb3JlIHRoYW4gb25lIGNvbm5lY3Rv
ciB1c2VzIHR2Lm1vZGUsCisgKiB0aGUgZW51bSBuYW1lcyBoYXMgdG8gYmUgdGhlIHNhbWUuCisg
Ki8KK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0b3JfYWRkX3R2X21vZGUoc3RydWN0IGd1ZF9k
cm1fZGV2aWNlICpnZHJtLAorCQkJCQkgc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvciwg
dTY0IHZhbCkKK3sKKwl1bnNpZ25lZCBpbnQgaSwgbnVtX21vZGVzOworCWNvbnN0IGNoYXIgKipt
b2RlczsKKwlzaXplX3QgYnVmX2xlbjsKKwljaGFyICpidWY7CisJaW50IHJldDsKKworCW51bV9t
b2RlcyA9IHZhbCA+PiBHVURfRFJNX1VTQl9DT05ORUNUT1JfVFZfTU9ERV9OVU1fU0hJRlQ7CisK
KwlpZiAoIW51bV9tb2RlcykKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlidWZfbGVuID0gbnVtX21v
ZGVzICogRFJNX1BST1BfTkFNRV9MRU47CisJbW9kZXMgPSBrbWFsbG9jX2FycmF5KG51bV9tb2Rl
cywgc2l6ZW9mKCptb2RlcyksIEdGUF9LRVJORUwpOworCWJ1ZiA9IGttYWxsb2MoYnVmX2xlbiwg
R0ZQX0tFUk5FTCk7CisJaWYgKCFtb2RlcyB8fCAhYnVmKSB7CisJCXJldCA9IC1FTk9NRU07CisJ
CWdvdG8gZnJlZTsKKwl9CisKKwlyZXQgPSBndWRfZHJtX3VzYl9nZXQoZ2RybSwgR1VEX0RSTV9V
U0JfUkVRX0dFVF9DT05ORUNUT1JfVFZfTU9ERV9WQUxVRVMsCisJCQkgICAgICBjb25uZWN0b3It
PmluZGV4LCBidWYsIGJ1Zl9sZW4pOworCWlmIChyZXQpCisJCWdvdG8gZnJlZTsKKworCWZvciAo
aSA9IDA7IGkgPCBudW1fbW9kZXM7IGkrKykKKwkJbW9kZXNbaV0gPSAmYnVmW2kgKiBEUk1fUFJP
UF9OQU1FX0xFTl07CisKKwlyZXQgPSBkcm1fbW9kZV9jcmVhdGVfdHZfcHJvcGVydGllcyhjb25u
ZWN0b3ItPmRldiwgbnVtX21vZGVzLCBtb2Rlcyk7CitmcmVlOgorCWtmcmVlKG1vZGVzKTsKKwlr
ZnJlZShidWYpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHN0cnVjdCBkcm1fcHJvcGVy
dHkgKgorZ3VkX2RybV9jb25uZWN0b3JfcHJvcGVydHlfbG9va3VwKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IsIHUxNiBwcm9wKQoreworCXN0cnVjdCBkcm1fbW9kZV9jb25maWcgKmNv
bmZpZyA9ICZjb25uZWN0b3ItPmRldi0+bW9kZV9jb25maWc7CisKKwlzd2l0Y2ggKHByb3ApIHsK
KwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfU0VMRUNUX1NVQkNPTk5FQ1RPUjoKKwkJcmV0dXJu
IGNvbmZpZy0+dHZfc2VsZWN0X3N1YmNvbm5lY3Rvcl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1f
UFJPUEVSVFlfVFZfTEVGVF9NQVJHSU46CisJCXJldHVybiBjb25maWctPnR2X2xlZnRfbWFyZ2lu
X3Byb3BlcnR5OworCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9SSUdIVF9NQVJHSU46CisJCXJl
dHVybiBjb25maWctPnR2X3JpZ2h0X21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJP
UEVSVFlfVFZfVE9QX01BUkdJTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfdG9wX21hcmdpbl9wcm9w
ZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQk9UVE9NX01BUkdJTjoKKwkJcmV0dXJu
IGNvbmZpZy0+dHZfYm90dG9tX21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVS
VFlfVFZfTU9ERToKKwkJcmV0dXJuIGNvbmZpZy0+dHZfbW9kZV9wcm9wZXJ0eTsKKwljYXNlIEdV
RF9EUk1fUFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfYnJpZ2h0
bmVzc19wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQ09OVFJBU1Q6CisJCXJl
dHVybiBjb25maWctPnR2X2NvbnRyYXN0X3Byb3BlcnR5OworCWNhc2UgR1VEX0RSTV9QUk9QRVJU
WV9UVl9GTElDS0VSX1JFRFVDVElPTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfZmxpY2tlcl9yZWR1
Y3Rpb25fcHJvcGVydHk7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX09WRVJTQ0FOOgorCQly
ZXR1cm4gY29uZmlnLT50dl9vdmVyc2Nhbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVS
VFlfVFZfU0FUVVJBVElPTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfc2F0dXJhdGlvbl9wcm9wZXJ0
eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfSFVFOgorCQlyZXR1cm4gY29uZmlnLT50dl9o
dWVfcHJvcGVydHk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisJfQor
fQorCitzdGF0aWMgdW5zaWduZWQgaW50ICpndWRfZHJtX2Nvbm5lY3Rvcl90dl9zdGF0ZV92YWwo
dTE2IHByb3AsIHN0cnVjdCBkcm1fdHZfY29ubmVjdG9yX3N0YXRlICpzdGF0ZSkKK3sKKwlzd2l0
Y2ggKHByb3ApIHsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfU0VMRUNUX1NVQkNPTk5FQ1RP
UjoKKwkJcmV0dXJuICZzdGF0ZS0+c3ViY29ubmVjdG9yOworCWNhc2UgR1VEX0RSTV9QUk9QRVJU
WV9UVl9MRUZUX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFyZ2lucy5sZWZ0OworCWNhc2Ug
R1VEX0RSTV9QUk9QRVJUWV9UVl9SSUdIVF9NQVJHSU46CisJCXJldHVybiAmc3RhdGUtPm1hcmdp
bnMucmlnaHQ7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1RPUF9NQVJHSU46CisJCXJldHVy
biAmc3RhdGUtPm1hcmdpbnMudG9wOworCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9CT1RUT01f
TUFSR0lOOgorCQlyZXR1cm4gJnN0YXRlLT5tYXJnaW5zLmJvdHRvbTsKKwljYXNlIEdVRF9EUk1f
UFJPUEVSVFlfVFZfTU9ERToKKwkJcmV0dXJuICZzdGF0ZS0+bW9kZTsKKwljYXNlIEdVRF9EUk1f
UFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJcmV0dXJuICZzdGF0ZS0+YnJpZ2h0bmVzczsKKwlj
YXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQ09OVFJBU1Q6CisJCXJldHVybiAmc3RhdGUtPmNvbnRy
YXN0OworCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9GTElDS0VSX1JFRFVDVElPTjoKKwkJcmV0
dXJuICZzdGF0ZS0+ZmxpY2tlcl9yZWR1Y3Rpb247CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RW
X09WRVJTQ0FOOgorCQlyZXR1cm4gJnN0YXRlLT5vdmVyc2NhbjsKKwljYXNlIEdVRF9EUk1fUFJP
UEVSVFlfVFZfU0FUVVJBVElPTjoKKwkJcmV0dXJuICZzdGF0ZS0+c2F0dXJhdGlvbjsKKwljYXNl
IEdVRF9EUk1fUFJPUEVSVFlfVFZfSFVFOgorCQlyZXR1cm4gJnN0YXRlLT5odWU7CisJZGVmYXVs
dDoKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisJfQorfQorCitzdGF0aWMgaW50IGd1ZF9k
cm1fY29ubmVjdG9yX2FkZF9wcm9wZXJ0aWVzKHN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwK
KwkJCQkJICAgIHN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciAqZ2Nvbm4sCisJCQkJCSAgICB1bnNp
Z25lZCBpbnQgbnVtX3Byb3BlcnRpZXMpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9ICZn
ZHJtLT5kcm07CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9ICZnY29ubi0+Y29u
bmVjdG9yOworCXN0cnVjdCBndWRfZHJtX3Byb3BlcnR5ICpwcm9wZXJ0aWVzOworCWJvb2wgbmVl
ZF90dl9wcm9wcyA9IGZhbHNlOworCXVuc2lnbmVkIGludCBpOworCWludCByZXQ7CisKKwlnY29u
bi0+cHJvcGVydGllcyA9IGtjYWxsb2MobnVtX3Byb3BlcnRpZXMsIHNpemVvZigqZ2Nvbm4tPnBy
b3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uLT5wcm9wZXJ0aWVzKQorCQlyZXR1
cm4gLUVOT01FTTsKKworCXByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9wZXJ0aWVzLCBzaXpl
b2YoKnByb3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXByb3BlcnRpZXMpCisJCXJldHVy
biAtRU5PTUVNOworCisJcmV0ID0gZ3VkX2RybV91c2JfZ2V0KGdkcm0sIEdVRF9EUk1fVVNCX1JF
UV9HRVRfQ09OTkVDVE9SX1BST1BFUlRJRVMsIGNvbm5lY3Rvci0+aW5kZXgsCisJCQkgICAgICBw
cm9wZXJ0aWVzLCBudW1fcHJvcGVydGllcyAqIHNpemVvZigqcHJvcGVydGllcykpOworCWlmIChy
ZXQpCisJCWdvdG8gb3V0OworCisJZm9yIChpID0gMDsgaSA8IG51bV9wcm9wZXJ0aWVzOyBpKysp
IHsKKwkJdTE2IHByb3AgPSBsZTE2X3RvX2NwdShwcm9wZXJ0aWVzW2ldLnByb3ApOworCQl1NjQg
dmFsID0gbGU2NF90b19jcHUocHJvcGVydGllc1tpXS52YWwpOworCisJCWRybV9kYmcoZHJtLCAi
cHJvcGVydHk6ICV1ID0gJWxsdSgweCVsbHgpXG4iLCBwcm9wLCB2YWwsIHZhbCk7CisKKwkJc3dp
dGNoIChwcm9wKSB7CisJCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTjoKKwkJ
CWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOOgor
CQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9UT1BfTUFSR0lOOgor
CQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9CT1RUT01fTUFSR0lO
OgorCQkJcmV0ID0gZHJtX21vZGVfY3JlYXRlX3R2X21hcmdpbl9wcm9wZXJ0aWVzKGRybSk7CisJ
CQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCQkJYnJlYWs7CisJCWNhc2UgR1VEX0RSTV9QUk9Q
RVJUWV9UVl9NT0RFOgorCQkJcmV0ID0gZ3VkX2RybV9jb25uZWN0b3JfYWRkX3R2X21vZGUoZ2Ry
bSwgY29ubmVjdG9yLCB2YWwpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKwkJCWJyZWFr
OworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfU0VMRUNUX1NVQkNPTk5FQ1RPUjoKKwkJCWZh
bGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJCWZh
bGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQ09OVFJBU1Q6CisJCQlmYWxs
dGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0ZMSUNLRVJfUkVEVUNUSU9OOgor
CQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9PVkVSU0NBTjoKKwkJ
CWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfU0FUVVJBVElPTjoKKwkJ
CWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfSFVFOgorCQkJbmVlZF90
dl9wcm9wcyA9IHRydWU7CisJCQlicmVhazsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX0JBQ0tM
SUdIVF9CUklHSFRORVNTOgorCQkJaWYgKHZhbCA+IDEwMCkgeworCQkJCXJldCA9IC1FSU5WQUw7
CisJCQkJZ290byBvdXQ7CisJCQl9CisJCQlnY29ubi0+aW5pdGlhbF9icmlnaHRuZXNzID0gdmFs
OworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQkvKiBOZXcgb25lcyBtaWdodCBzaG93IHVwIGlu
IGZ1dHVyZSBkZXZpY2VzLCBza2lwIHRob3NlIHdlIGRvbid0IGtub3cuICovCisJCQlkcm1fZGJn
KGRybSwgIlVua25vd24gcHJvcGVydHk6ICV1XG4iLCBwcm9wKTsKKwkJCWNvbnRpbnVlOworCQl9
CisKKwkJZ2Nvbm4tPnByb3BlcnRpZXNbZ2Nvbm4tPm51bV9wcm9wZXJ0aWVzKytdID0gcHJvcDsK
Kwl9CisKKwlpZiAoIWdjb25uLT5udW1fcHJvcGVydGllcykKKwkJZ290byBvdXQ7CisKKwlpZiAo
bmVlZF90dl9wcm9wcykgeworCQkvKiBUaGlzIGlzIGEgbm8tb3AgaWYgYWxyZWFkeSBhZGRlZC4g
Ki8KKwkJcmV0ID0gZHJtX21vZGVfY3JlYXRlX3R2X3Byb3BlcnRpZXMoZHJtLCAwLCBOVUxMKTsK
KwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCX0KKworCWZvciAoaSA9IDA7IGkgPCBudW1fcHJv
cGVydGllczsgaSsrKSB7CisJCXUxNiBwcm9wID0gbGUxNl90b19jcHUocHJvcGVydGllc1tpXS5w
cm9wKTsKKwkJdTY0IHZhbCA9IGxlNjRfdG9fY3B1KHByb3BlcnRpZXNbaV0udmFsKTsKKwkJc3Ry
dWN0IGRybV9wcm9wZXJ0eSAqcHJvcGVydHk7CisJCXVuc2lnbmVkIGludCAqc3RhdGVfdmFsOwor
CisJCXN3aXRjaCAocHJvcCkgeworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfQkFDS0xJR0hUX0JS
SUdIVE5FU1M6CisJCQkvKiBub3QgYSBEUk0gcHJvcGVydHkgKi8KKwkJCWNvbnRpbnVlOworCQlj
YXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfTU9ERToKKwkJCXZhbCA9IHZhbCAmIChCSVQoR1VEX0RS
TV9VU0JfQ09OTkVDVE9SX1RWX01PREVfTlVNX1NISUZUKSAtIDEpOworCQkJYnJlYWs7CisJCX0K
KworCQlwcm9wZXJ0eSA9IGd1ZF9kcm1fY29ubmVjdG9yX3Byb3BlcnR5X2xvb2t1cChjb25uZWN0
b3IsIHByb3ApOworCQlpZiAoSVNfRVJSKHByb3BlcnR5KSkKKwkJCWNvbnRpbnVlOworCisJCXN0
YXRlX3ZhbCA9IGd1ZF9kcm1fY29ubmVjdG9yX3R2X3N0YXRlX3ZhbChwcm9wLCAmZ2Nvbm4tPmlu
aXRpYWxfdHZfc3RhdGUpOworCQlpZiAoSVNfRVJSKHN0YXRlX3ZhbCkpCisJCQljb250aW51ZTsK
KworCQkqc3RhdGVfdmFsID0gdmFsOworCQlkcm1fb2JqZWN0X2F0dGFjaF9wcm9wZXJ0eSgmY29u
bmVjdG9yLT5iYXNlLCBwcm9wZXJ0eSwgMCk7CisJfQorb3V0OgorCWtmcmVlKHByb3BlcnRpZXMp
OworCisJcmV0dXJuIHJldDsKK30KKworaW50IGd1ZF9kcm1fY29ubmVjdG9yX2ZpbGxfcHJvcGVy
dGllcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCSAgICAgIHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGUsCisJCQkJICAgICAgc3RydWN0IGd1
ZF9kcm1fcHJvcGVydHkgKnByb3BlcnRpZXMpCit7CisJc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9y
ICpnY29ubjsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWdjb25uID0gdG9fZ3VkX2RybV9jb25uZWN0
b3IoY29ubmVjdG9yKTsKKworCS8qIE9ubHkgaW50ZXJlc3RlZCBpbiB0aGUgY291bnQ/ICovCisJ
aWYgKCFjb25uZWN0b3Jfc3RhdGUpCisJCXJldHVybiBnY29ubi0+bnVtX3Byb3BlcnRpZXM7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgZ2Nvbm4tPm51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHBy
b3AgPSBnY29ubi0+cHJvcGVydGllc1tpXTsKKwkJdTY0IHZhbDsKKworCQlpZiAocHJvcCA9PSBH
VURfRFJNX1BST1BFUlRZX0JBQ0tMSUdIVF9CUklHSFRORVNTKSB7CisJCQl2YWwgPSBjb25uZWN0
b3Jfc3RhdGUtPnR2LmJyaWdodG5lc3M7CisJCX0gZWxzZSB7CisJCQl1bnNpZ25lZCBpbnQgKnN0
YXRlX3ZhbDsKKworCQkJc3RhdGVfdmFsID0gZ3VkX2RybV9jb25uZWN0b3JfdHZfc3RhdGVfdmFs
KHByb3AsICZjb25uZWN0b3Jfc3RhdGUtPnR2KTsKKwkJCWlmIChXQVJOX09OX09OQ0UoSVNfRVJS
KHN0YXRlX3ZhbCkpKQorCQkJCXJldHVybiBQVFJfRVJSKHN0YXRlX3ZhbCk7CisKKwkJCXZhbCA9
ICpzdGF0ZV92YWw7CisJCX0KKworCQlwcm9wZXJ0aWVzW2ldLnByb3AgPSBjcHVfdG9fbGUxNihw
cm9wKTsKKwkJcHJvcGVydGllc1tpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOworCX0KKworCXJl
dHVybiBnY29ubi0+bnVtX3Byb3BlcnRpZXM7Cit9CisKK2ludCBndWRfZHJtX2Nvbm5lY3Rvcl9j
cmVhdGUoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgaW5kZXgpCit7
CisJc3RydWN0IGd1ZF9kcm1fcmVxX2dldF9jb25uZWN0b3IgZGVzYzsKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZHJtID0gJmdkcm0tPmRybTsKKwlzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgKmdjb25u
OworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJc3RydWN0IGRybV9lbmNvZGVy
ICplbmNvZGVyOworCWludCByZXQ7CisKKwlyZXQgPSBndWRfZHJtX3VzYl9nZXQoZ2RybSwgR1VE
X0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1IsIGluZGV4LCAmZGVzYywgc2l6ZW9mKGRlc2MpKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZHJtX2RiZyhkcm0sICJpbmRleD0ldSB0eXBl
PSV1IGZsYWdzPTB4JXggbnVtX3Byb3BlcnRpZXM9JXVcbiIsIGluZGV4LAorCQlkZXNjLmNvbm5l
Y3Rvcl90eXBlLCBsZTMyX3RvX2NwdShkZXNjLmZsYWdzKSwgZGVzYy5udW1fcHJvcGVydGllcyk7
CisKKwkvKiBSRVZJU0lUOiBUaGlzIG5lZWRzIHRvIGJlIHVwZGF0ZWQgYXMgbmV3IHR5cGVzIGFy
ZSBhZGRlZCAqLworCWlmIChkZXNjLmNvbm5lY3Rvcl90eXBlID4gRFJNX01PREVfQ09OTkVDVE9S
X1NQSSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlnY29ubiA9IGt6YWxsb2Moc2l6ZW9mKCpnY29u
biksIEdGUF9LRVJORUwpOworCWlmICghZ2Nvbm4pCisJCXJldHVybiAtRU5PTUVNOworCisJZ2Nv
bm4tPmluaXRpYWxfYnJpZ2h0bmVzcyA9IC1FTk9ERVY7CisJZ2Nvbm4tPmZsYWdzID0gbGUzMl90
b19jcHUoZGVzYy5mbGFncyk7CisJY29ubmVjdG9yID0gJmdjb25uLT5jb25uZWN0b3I7CisKKwlk
cm1fY29ubmVjdG9yX2hlbHBlcl9hZGQoY29ubmVjdG9yLCAmZ3VkX2RybV9jb25uZWN0b3JfaGVs
cGVyX2Z1bmNzKTsKKwlyZXQgPSBkcm1fY29ubmVjdG9yX2luaXQoZHJtLCBjb25uZWN0b3IsICZn
dWRfZHJtX2Nvbm5lY3Rvcl9mdW5jcywgZGVzYy5jb25uZWN0b3JfdHlwZSk7CisJaWYgKHJldCkg
eworCQlrZnJlZShjb25uZWN0b3IpOworCQlyZXR1cm4gcmV0OworCX0KKworCWlmIChXQVJOX09O
KGNvbm5lY3Rvci0+aW5kZXggIT0gaW5kZXgpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChn
Y29ubi0+ZmxhZ3MgJiBHVURfRFJNX0NPTk5FQ1RPUl9GTEFHU19QT0xMKQorCQljb25uZWN0b3It
PnBvbGxlZCA9IChEUk1fQ09OTkVDVE9SX1BPTExfQ09OTkVDVCB8IERSTV9DT05ORUNUT1JfUE9M
TF9ESVNDT05ORUNUKTsKKworCWlmIChkZXNjLm51bV9wcm9wZXJ0aWVzKSB7CisJCXJldCA9IGd1
ZF9kcm1fY29ubmVjdG9yX2FkZF9wcm9wZXJ0aWVzKGdkcm0sIGdjb25uLCBkZXNjLm51bV9wcm9w
ZXJ0aWVzKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2Vycihkcm0tPmRldiwgIkZhaWxlZCB0byBh
ZGQgY29ubmVjdG9yLyV1IHByb3BlcnRpZXNcbiIsIGluZGV4KTsKKwkJCXJldHVybiByZXQ7CisJ
CX0KKwl9CisKKwkvKiBUaGUgZmlyc3QgY29ubmVjdG9yIGlzIGF0dGFjaGVkIHRvIHRoZSBleGlz
dGluZyBzaW1wbGUgcGlwZSBlbmNvZGVyICovCisJaWYgKCFjb25uZWN0b3ItPmluZGV4KSB7CisJ
CWVuY29kZXIgPSAmZ2RybS0+cGlwZS5lbmNvZGVyOworCX0gZWxzZSB7CisJCWVuY29kZXIgPSAm
Z2Nvbm4tPmVuY29kZXI7CisKKwkJcmV0ID0gZHJtX3NpbXBsZV9lbmNvZGVyX2luaXQoZHJtLCBl
bmNvZGVyLCBEUk1fTU9ERV9FTkNPREVSX05PTkUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJl
dDsKKworCQllbmNvZGVyLT5wb3NzaWJsZV9jcnRjcyA9IDE7CisJfQorCisJcmV0dXJuIGRybV9j
b25uZWN0b3JfYXR0YWNoX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKTsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9n
dWQvZ3VkX2RybV9kcnYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
LjNmMmU4YzFkOWEzOAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3Vk
X2RybV9kcnYuYwpAQCAtMCwwICsxLDY0MSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNs
dWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvbHo0Lmg+CisjaW5jbHVkZSA8
bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5j
bHVkZSA8bGludXgvc3RyaW5nX2hlbHBlcnMuaD4KKyNpbmNsdWRlIDxsaW51eC91c2IuaD4KKyNp
bmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGFtYWdlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fZGVidWdmcy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9mYl9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUg
PGRybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1l
YnVmZmVyX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fbWFuYWdlZC5oPgorI2luY2x1ZGUg
PGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZ3VkX2Ry
bS5oPgorCisjaW5jbHVkZSAiZ3VkX2RybV9pbnRlcm5hbC5oIgorCisvKiBPbmx5IHVzZWQgaW50
ZXJuYWxseSAqLworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gZ3VkX2RybV9m
b3JtYXRfcjEgPSB7CisJLmZvcm1hdCA9IEdVRF9EUk1fRk9STUFUX1IxLAorCS5udW1fcGxhbmVz
ID0gMSwKKwkuY2hhcl9wZXJfYmxvY2sgPSB7IDEsIDAsIDAgfSwKKwkuYmxvY2tfdyA9IHsgOCwg
MCwgMCB9LAorCS5ibG9ja19oID0geyAxLCAwLCAwIH0sCisJLmhzdWIgPSAxLAorCS52c3ViID0g
MSwKK307CisKK3N0YXRpYyBpbnQgZ3VkX2RybV91c2JfY29udHJvbF9tc2coc3RydWN0IHVzYl9k
ZXZpY2UgKnVzYiwgdTggaWZudW0sIGJvb2wgaW4sCisJCQkJICAgdTggcmVxdWVzdCwgdTE2IHZh
bHVlLCB2b2lkICpidWYsIHNpemVfdCBsZW4sCisJCQkJICAgYm9vbCBjaGVja19sZW4pCit7CisJ
dTggcmVxdWVzdHR5cGUgPSBVU0JfVFlQRV9WRU5ET1IgfCBVU0JfUkVDSVBfSU5URVJGQUNFOwor
CXVuc2lnbmVkIGludCBwaXBlOworCWludCByZXQ7CisKKwlpZiAoaW4pIHsKKwkJcGlwZSA9IHVz
Yl9yY3ZjdHJscGlwZSh1c2IsIDApOworCQlyZXF1ZXN0dHlwZSB8PSBVU0JfRElSX0lOOworCX0g
ZWxzZSB7CisJCXBpcGUgPSB1c2Jfc25kY3RybHBpcGUodXNiLCAwKTsKKwkJcmVxdWVzdHR5cGUg
fD0gVVNCX0RJUl9PVVQ7CisJfQorCisJcmV0ID0gdXNiX2NvbnRyb2xfbXNnKHVzYiwgcGlwZSwg
cmVxdWVzdCwgcmVxdWVzdHR5cGUsIHZhbHVlLAorCQkJICAgICAgaWZudW0sIGJ1ZiwgbGVuLCBV
U0JfQ1RSTF9HRVRfVElNRU9VVCk7CisKKwlpZiAoY2hlY2tfbGVuICYmIHJldCA+PSAwKSB7CisJ
CWlmIChyZXQgIT0gbGVuKQorCQkJcmV0ID0gLUVJTzsKKwkJZWxzZQorCQkJcmV0ID0gMDsKKwl9
CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGd1ZF9nZXRfdmVuZG9yX2Rlc2NyaXB0
b3Ioc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSwKKwkJCQkgICAgIHN0cnVjdCBndWRf
ZHJtX2Rpc3BsYXlfZGVzY3JpcHRvciAqZGVzYykKK3sKKwl1OCBpZm51bSA9IGludGVyZmFjZS0+
Y3VyX2FsdHNldHRpbmctPmRlc2MuYkludGVyZmFjZU51bWJlcjsKKwlzdHJ1Y3QgdXNiX2Rldmlj
ZSAqdXNiID0gaW50ZXJmYWNlX3RvX3VzYmRldihpbnRlcmZhY2UpOworCXZvaWQgKmJ1ZjsKKwlp
bnQgcmV0OworCisJYnVmID0ga21hbGxvYyhzaXplb2YoKmRlc2MpLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWJ1ZikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfZHJtX3VzYl9jb250cm9s
X21zZyh1c2IsIGlmbnVtLCB0cnVlLCBVU0JfUkVRX0dFVF9ERVNDUklQVE9SLAorCQkJCSAgICAg
IEdVRF9EUk1fVVNCX0RUX0RJU1BMQVkgPDwgOCwgYnVmLCBzaXplb2YoKmRlc2MpLCBmYWxzZSk7
CisKKwltZW1jcHkoZGVzYywgYnVmLCBzaXplb2YoKmRlc2MpKTsKKwlrZnJlZShidWYpOworCisJ
aWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlpZiAocmV0ICE9IHNpemVvZigqZGVzYykg
fHwgZGVzYy0+Ykxlbmd0aCAhPSBzaXplb2YoKmRlc2MpIHx8CisJICAgIGRlc2MtPmJEZXNjcmlw
dG9yVHlwZSAhPSBHVURfRFJNX1VTQl9EVF9ESVNQTEFZKQorCQlyZXR1cm4gLUVOT0RBVEE7CisK
KwlEUk1fREVWX0RFQlVHX0RSSVZFUigmaW50ZXJmYWNlLT5kZXYsCisJCQkgICAgICJWZXJzaW9u
PSV1IENvbXByZXNzaW9uPTB4JXggTnVtRm9ybWF0cz0ldSBOdW1Db25uZWN0b3JzPSV1IE1heEJ1
ZmZlclNpemVPcmRlcj0ldVxuIiwKKwkJCSAgICAgZGVzYy0+YlZlcnNpb24sIGRlc2MtPmJDb21w
cmVzc2lvbiwgZGVzYy0+Yk51bUZvcm1hdHMsCisJCQkgICAgIGRlc2MtPmJOdW1Db25uZWN0b3Jz
LCBkZXNjLT5iTWF4QnVmZmVyU2l6ZU9yZGVyKTsKKworCWlmICghZGVzYy0+YlZlcnNpb24gfHwg
IWRlc2MtPmJOdW1Gb3JtYXRzIHx8ICFkZXNjLT5iTnVtQ29ubmVjdG9ycyB8fAorCSAgICAhZGVz
Yy0+Yk1heEJ1ZmZlclNpemVPcmRlciB8fCAhZGVzYy0+ZHdNYXhXaWR0aCB8fCAhZGVzYy0+ZHdN
YXhIZWlnaHQgfHwKKwkgICAgbGUzMl90b19jcHUoZGVzYy0+ZHdNaW5XaWR0aCkgPiBsZTMyX3Rv
X2NwdShkZXNjLT5kd01heFdpZHRoKSB8fAorCSAgICBsZTMyX3RvX2NwdShkZXNjLT5kd01pbkhl
aWdodCkgPiBsZTMyX3RvX2NwdShkZXNjLT5kd01heEhlaWdodCkpCisJCXJldHVybiAtRUlOVkFM
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3VzYl9nZXRfc3RhdHVzKHN0cnVj
dCBndWRfZHJtX2RldmljZSAqZ2RybSkKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X3N0YXR1
cyAqc3RhdHVzID0gZ2RybS0+c3RhdHVzX2J1ZjsKKwlpbnQgcmV0LCBzdGF0dXNfcmV0cmllcyA9
IDIwMDAgLyA1OyAvKiBtYXhpbXVtIHdhaXQgfjIgc2Vjb25kcyAqLworCXVuc2lnbmVkIGxvbmcg
ZGVsYXkgPSA1MDA7CisKKwkvKgorCSAqIFBvbGwgZHVlIHRvIGxhY2sgb2YgZGF0YS9zdGF0dXMg
c3RhZ2UgY29udHJvbCBvbiB0aGUgZ2FkZ2V0IHNpZGUuCisJICoKKwkgKiBJZiB3ZSBkaWQgbm90
IHVzZSBwb2xsaW5nIGFuZCBnYXZlIHVwIGhlcmUgYWZ0ZXIgd2FpdGluZyAyIHNlY29uZHMsCisJ
ICogdGhlIHdvcmtlciBpbiB0aGUgZ2FkZ2V0IHdvdWxkIGZpbmFsbHkgZ2V0IHRvIHF1ZXVpbmcg
dXAgdGhlIHN0YXR1cworCSAqIHJlc3BvbnMsIGJ1dCBieSB0aGF0IHRpbWUgdGhlIGhvc3QgaGFz
IG1vdmVkIG9uLiBUaGUgZ2FkZ2V0IHNpZGUKKwkgKiAoYXQgbGVhc3QgZHdjMikgd291bGQgbm93
IGJlIGxlZnQgaW4gYSBub24tcmVjb3ZlcmFibGUgc3RhdGUuCisJICoKKwkgKiBXb3JzdCBjYXNl
IGNvbW1pdCB0aW1lb3V0IGluIERSTSBjYW4gYmUgdGVucyBvZiBzZWNvbmRzICh3YWl0IGZvcgor
CSAqIHZhcmlvdXMgX2RvbmUgY29tcGxldGlvbnMpLgorCSAqLworCXdoaWxlIChzdGF0dXNfcmV0
cmllcy0tKSB7CisJCXJldCA9IGd1ZF9kcm1fdXNiX2NvbnRyb2xfbXNnKGdkcm0tPnVzYiwgZ2Ry
bS0+aWZudW0sIHRydWUsIFVTQl9SRVFfR0VUX1NUQVRVUywKKwkJCQkJICAgICAgMCwgc3RhdHVz
LCBzaXplb2YoKnN0YXR1cyksIHRydWUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwor
CQlpZiAoIShzdGF0dXMtPmZsYWdzICYgR1VEX0RSTV9TVEFUVVNfUEVORElORykpCisJCQlyZXR1
cm4gLXN0YXR1cy0+ZXJybm87CisKKwkJdXNsZWVwX3JhbmdlKGRlbGF5LCBkZWxheSArIDEwMDAp
OworCisJCWlmIChkZWxheSA8IDQ1MDApCisJCQlkZWxheSArPSAxMDAwOworCX0KKworCXJldHVy
biAtRVRJTUVET1VUOworfQorCitzdGF0aWMgaW50IGd1ZF91c2JfdHJhbnNmZXIoc3RydWN0IGd1
ZF9kcm1fZGV2aWNlICpnZHJtLCBib29sIGluLCB1OCByZXF1ZXN0LAorCQkJICAgIHUxNiBpbmRl
eCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQoreworCWludCBpZHgsIHJldDsKKworCWRybV9kYmco
Jmdkcm0tPmRybSwgIiVzOiByZXF1ZXN0PTB4JXggaW5kZXg9JXUgbGVuPSV6dVxuIiwKKwkJaW4g
PyAiZ2V0IiA6ICJzZXQiLCByZXF1ZXN0LCBpbmRleCwgbGVuKTsKKworCWlmIChsZW4gPiBHVURf
RFJNX01BWF9UUkFOU0ZFUl9TSVpFKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWlmICghZHJtX2Rl
dl9lbnRlcigmZ2RybS0+ZHJtLCAmaWR4KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwltdXRleF9s
b2NrKCZnZHJtLT5jdHJsX2xvY2spOworCisJaWYgKCFpbiAmJiBidWYpCisJCW1lbWNweShnZHJt
LT5jdHJsX21zZ19idWYsIGJ1ZiwgbGVuKTsKKworCXJldCA9IGd1ZF9kcm1fdXNiX2NvbnRyb2xf
bXNnKGdkcm0tPnVzYiwgZ2RybS0+aWZudW0sIGluLCByZXF1ZXN0LCBpbmRleCwKKwkJCQkgICAg
ICBnZHJtLT5jdHJsX21zZ19idWYsIGxlbiwgdHJ1ZSk7CisKKwkvKgorCSAqIE9VVCB0cmFuc2Zl
cnMgYXJlIHByb2Nlc3NlZCBpbiBhIHdvcmtlciBvbiB0aGUgZ2FkZ2V0IHNpZGUgYWZ0ZXIKKwkg
KiByZWNlcHRpb24gc28gd2UgYWx3YXlzIG5lZWQgdG8gY2hlY2sgc3RhdHVzLiBJTiB0cmFuc2Zl
cnMgYXJlCisJICogcHJvY2Vzc2VkIGluIHRoZSBpbnRlcnJ1cHQgaGFuZGxlciBhbmQgd2lsbCBo
YWx0IG9uIGVycm9yIGxldHRpbmcgdXMKKwkgKiBrbm93IHNvbWV0aGluZyB3ZW50IHdyb25nLgor
CSAqLworCWlmIChyZXQgfHwgIWluKSB7CisJCXJldCA9IGd1ZF91c2JfZ2V0X3N0YXR1cyhnZHJt
KTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gZXJyb3I7CisJfQorCisJaWYgKGluICYmIGJ1ZikKKwkJ
bWVtY3B5KGJ1ZiwgZ2RybS0+Y3RybF9tc2dfYnVmLCBsZW4pOworZXJyb3I6CisJaWYgKHJldCkg
eworCQlkcm1fZGJnKCZnZHJtLT5kcm0sICJyZXQ9JWRcbiIsIHJldCk7CisJCWdkcm0tPnN0YXRz
X251bV9lcnJvcnMrKzsKKwl9CisKKwltdXRleF91bmxvY2soJmdkcm0tPmN0cmxfbG9jayk7CisJ
ZHJtX2Rldl9leGl0KGlkeCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgZ3VkX2RybV91c2Jf
Z2V0KHN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTE2IGluZGV4LCB2
b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJcmV0dXJuIGd1ZF91c2JfdHJhbnNmZXIoZ2RybSwg
dHJ1ZSwgcmVxdWVzdCwgaW5kZXgsIGJ1ZiwgbGVuKTsKK30KKworaW50IGd1ZF9kcm1fdXNiX3Nl
dChzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHUxNiBpbmRleCwgdm9p
ZCAqYnVmLCBzaXplX3QgbGVuKQoreworCXJldHVybiBndWRfdXNiX3RyYW5zZmVyKGdkcm0sIGZh
bHNlLCByZXF1ZXN0LCBpbmRleCwgYnVmLCBsZW4pOworfQorCitpbnQgZ3VkX2RybV91c2Jfd3Jp
dGU4KHN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTggdmFsKQorewor
CXJldHVybiBndWRfZHJtX3VzYl9zZXQoZ2RybSwgcmVxdWVzdCwgMCwgJnZhbCwgc2l6ZW9mKHZh
bCkpOworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fdXNiX3JlYWQzMihzdHJ1Y3QgZ3VkX2RybV9k
ZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsCisJCQkgICAgICB1MzIgKnZhbHMsIHVuc2lnbmVkIGlu
dCBudW1fdmFscykKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQgcmV0OworCisJcmV0ID0gZ3Vk
X2RybV91c2JfZ2V0KGdkcm0sIHJlcXVlc3QsIDAsIHZhbHMsIG51bV92YWxzICogc2l6ZW9mKCp2
YWxzKSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7IGkgPCBudW1f
dmFsczsgaSsrKQorCQl2YWxzW2ldID0gbGUzMl90b19jcHUoKF9fbGUzMil2YWxzW2ldKTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fZ2V0X3Byb3BlcnRpZXMoc3RydWN0
IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgbnVtX3Byb3BlcnRpZXMpCit7CisJ
c3RydWN0IGd1ZF9kcm1fcHJvcGVydHkgKnByb3BlcnRpZXM7CisJdW5zaWduZWQgaW50IGk7CisJ
aW50IHJldDsKKworCWlmICghbnVtX3Byb3BlcnRpZXMpCisJCXJldHVybiAwOworCisJZ2RybS0+
cHJvcGVydGllcyA9IGtjYWxsb2MobnVtX3Byb3BlcnRpZXMsIHNpemVvZigqZ2RybS0+cHJvcGVy
dGllcyksIEdGUF9LRVJORUwpOworCWlmICghZ2RybS0+cHJvcGVydGllcykKKwkJcmV0dXJuIC1F
Tk9NRU07CisKKwlwcm9wZXJ0aWVzID0ga2NhbGxvYyhudW1fcHJvcGVydGllcywgc2l6ZW9mKCpw
cm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9wZXJ0aWVzKQorCQlyZXR1cm4gLUVO
T01FTTsKKworCXJldCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFfR0VU
X1BST1BFUlRJRVMsIDAsCisJCQkgICAgICBwcm9wZXJ0aWVzLCBudW1fcHJvcGVydGllcyAqIHNp
emVvZigqcHJvcGVydGllcykpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJZm9yIChpID0g
MDsgaSA8IG51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHByb3AgPSBsZTE2X3RvX2NwdShw
cm9wZXJ0aWVzW2ldLnByb3ApOworCQl1NjQgdmFsID0gbGU2NF90b19jcHUocHJvcGVydGllc1tp
XS52YWwpOworCisJCXN3aXRjaCAocHJvcCkgeworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfUk9U
QVRJT046CisJCQlyZXQgPSBkcm1fcGxhbmVfY3JlYXRlX3JvdGF0aW9uX3Byb3BlcnR5KCZnZHJt
LT5waXBlLnBsYW5lLAorCQkJCQkJCQkgRFJNX01PREVfUk9UQVRFXzAsIHZhbCk7CisJCQlicmVh
azsKKwkJZGVmYXVsdDoKKwkJCS8qIE5ldyBvbmVzIG1pZ2h0IHNob3cgdXAgaW4gZnV0dXJlIGRl
dmljZXMsIHNraXAgdGhvc2Ugd2UgZG9uJ3Qga25vdy4gKi8KKwkJCWRybV9kYmcoJmdkcm0tPmRy
bSwgIlVua25vd24gcHJvcGVydHk6ICV1XG4iLCBwcm9wKTsKKwkJCWNvbnRpbnVlOworCQl9CisK
KwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0OworCisJCWdkcm0tPnByb3BlcnRpZXNbZ2RybS0+bnVt
X3Byb3BlcnRpZXMrK10gPSBwcm9wOworCX0KK291dDoKKwlrZnJlZShwcm9wZXJ0aWVzKTsKKwor
CXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgorZ3VkX2Ry
bV9kcml2ZXJfZ2VtX2NyZWF0ZV9vYmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc2l6ZV90
IHNpemUpCit7CisJc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0ICpzaG1lbTsKKworCXNobWVt
ID0ga3phbGxvYyhzaXplb2YoKnNobWVtKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzaG1lbSkKKwkJ
cmV0dXJuIE5VTEw7CisKKwkvKgorCSAqIFRoaXMgZG9lc24ndCBtYWtlIGEgZGlmZmVyZW5jZSBv
biB4ODYsIGJ1dCBvbiBBUk0gKHBpNCkgaXQgd2FzCisJICogbmVjZXNzYXJ5IHRvIGF2b2lkIGJs
YWNrIGxpbmVzIGFsbCBvdmVyIGFuZCBpdCBtYWRlIGl0IHBvc3NpYmxlIHRvCisJICogY29tcHJl
c3MgZGlyZWN0bHkgZnJvbSB0aGUgZnJhbWVidWZmZXIgd2l0aG91dCBwZXJmb3JtYW5jZSBkcm9w
LgorCSAqLworCXNobWVtLT5tYXBfY2FjaGVkID0gdHJ1ZTsKKworCXJldHVybiAmc2htZW0tPmJh
c2U7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9zdGF0c19kZWJ1Z2ZzKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJtX2luZm9fbm9kZSAqbm9kZSA9IG0tPnBy
aXZhdGU7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RybV9kZXZpY2Uo
bm9kZS0+bWlub3ItPmRldik7CisJY2hhciBidWZbMTBdOworCisJc3RyaW5nX2dldF9zaXplKGdk
cm0tPmJ1bGtfbGVuLCAxLCBTVFJJTkdfVU5JVFNfMiwgYnVmLCBzaXplb2YoYnVmKSk7CisJc2Vx
X3ByaW50ZihtLCAiTWF4IGJ1ZmZlciBzaXplOiAlc1xuIiwgYnVmKTsKKwlzZXFfcHJpbnRmKG0s
ICJOdW1iZXIgb2YgZXJyb3JzOiAgJXVcbiIsIGdkcm0tPnN0YXRzX251bV9lcnJvcnMpOworCisJ
c2VxX3B1dHMobSwgIkNvbXByZXNzaW9uOiAgICAgICIpOworCWlmIChnZHJtLT5jb21wcmVzc2lv
biAmIEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0KQorCQlzZXFfcHV0cyhtLCAiIGx6NCIpOworCXNl
cV9wdXRzKG0sICJcbiIpOworCisJaWYgKGdkcm0tPmNvbXByZXNzaW9uKSB7CisJCXU2NCByZW1h
aW5kZXI7CisJCXU2NCByYXRpbyA9IGRpdjY0X3U2NF9yZW0oZ2RybS0+c3RhdHNfbGVuZ3RoLCBn
ZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoLAorCQkJCQkgICZyZW1haW5kZXIpOworCQl1NjQgcmF0
aW9fZnJhYyA9IGRpdjY0X3U2NChyZW1haW5kZXIgKiAxMCwgZ2RybS0+c3RhdHNfYWN0dWFsX2xl
bmd0aCk7CisKKwkJc2VxX3ByaW50ZihtLCAiQ29tcHJlc3Npb24gcmF0aW86ICVsbHUuJWxsdVxu
IiwgcmF0aW8sIHJhdGlvX2ZyYWMpOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9pbmZvX2xpc3QgZ3VkX2RybV9kZWJ1Z2ZzX2xpc3RbXSA9IHsKKwl7ICJz
dGF0cyIsIGd1ZF9kcm1fc3RhdHNfZGVidWdmcywgMCwgTlVMTCB9LAorfTsKKworc3RhdGljIHZv
aWQgZ3VkX2RybV9kcml2ZXJfZGVidWdmc19pbml0KHN0cnVjdCBkcm1fbWlub3IgKm1pbm9yKQor
eworCWRybV9kZWJ1Z2ZzX2NyZWF0ZV9maWxlcyhndWRfZHJtX2RlYnVnZnNfbGlzdCwgQVJSQVlf
U0laRShndWRfZHJtX2RlYnVnZnNfbGlzdCksCisJCQkJIG1pbm9yLT5kZWJ1Z2ZzX3Jvb3QsIG1p
bm9yKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9m
dW5jcyBndWRfZHJtX3BpcGVfZnVuY3MgPSB7CisJLmNoZWNrICAgICAgPSBndWRfZHJtX3BpcGVf
Y2hlY2ssCisJLnVwZGF0ZQkgICAgPSBndWRfZHJtX3BpcGVfdXBkYXRlLAorCS5wcmVwYXJlX2Zi
ID0gZHJtX2dlbV9mYl9zaW1wbGVfZGlzcGxheV9waXBlX3ByZXBhcmVfZmIsCit9OworCitzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBndWRfZHJtX21vZGVfY29uZmln
X2Z1bmNzID0geworCS5mYl9jcmVhdGUgPSBkcm1fZ2VtX2ZiX2NyZWF0ZV93aXRoX2RpcnR5LAor
CS5hdG9taWNfY2hlY2sgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVjaywKKwkuYXRvbWljX2NvbW1p
dCA9IGRybV9hdG9taWNfaGVscGVyX2NvbW1pdCwKK307CisKK3N0YXRpYyBjb25zdCB1aW50NjRf
dCBndWRfZHJtX3BpcGVfbW9kaWZpZXJzW10gPSB7CisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAor
CURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307CisKK0RFRklORV9EUk1fR0VNX0ZPUFMoZ3VkX2Ry
bV9mb3BzKTsKKworc3RhdGljIHN0cnVjdCBkcm1fZHJpdmVyIGd1ZF9kcm1fZHJpdmVyID0gewor
CS5kcml2ZXJfZmVhdHVyZXMJPSBEUklWRVJfTU9ERVNFVCB8IERSSVZFUl9HRU0gfCBEUklWRVJf
QVRPTUlDLAorCS5mb3BzCQkJPSAmZ3VkX2RybV9mb3BzLAorCS5nZW1fY3JlYXRlX29iamVjdAk9
IGd1ZF9kcm1fZHJpdmVyX2dlbV9jcmVhdGVfb2JqZWN0LAorCURSTV9HRU1fU0hNRU1fRFJJVkVS
X09QUywKKwkuZGVidWdmc19pbml0CQk9IGd1ZF9kcm1fZHJpdmVyX2RlYnVnZnNfaW5pdCwKKwor
CS5uYW1lCQkJPSAiZ3VkX2RybSIsCisJLmRlc2MJCQk9ICJHZW5lcmljIFVTQiBEaXNwbGF5IiwK
KwkuZGF0ZQkJCT0gIjIwMjAwNDIyIiwKKwkubWFqb3IJCQk9IDEsCisJLm1pbm9yCQkJPSAwLAor
fTsKKworc3RhdGljIHZvaWQgZ3VkX2RybV9mcmVlX2J1ZmZlcnNfYW5kX211dGV4KHZvaWQgKmRh
dGEpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gZGF0YTsKKworCS8qIEFjY2Vz
cyB0byB0aGVzZSBhcmUgcHJvdGVjdGVkIGJ5IGRybV9kZXZfZW50ZXIvZXhpdCAqLworCisJa2Zy
ZWUoZ2RybS0+cHJvcGVydGllcyk7CisJdmZyZWUoZ2RybS0+Y29tcHJlc3NfYnVmKTsKKwlrZnJl
ZShnZHJtLT5idWxrX2J1Zik7CisJa2ZyZWUoZ2RybS0+Y3RybF9tc2dfYnVmKTsKKwlnZHJtLT5w
cm9wZXJ0aWVzID0gTlVMTDsKKwlnZHJtLT5jb21wcmVzc19idWYgPSBOVUxMOworCWdkcm0tPmJ1
bGtfYnVmID0gTlVMTDsKKwlnZHJtLT5jdHJsX21zZ19idWYgPSBOVUxMOworCisJbXV0ZXhfZGVz
dHJveSgmZ2RybS0+Y3RybF9sb2NrKTsKKwltdXRleF9kZXN0cm95KCZnZHJtLT5kYW1hZ2VfbG9j
ayk7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9wcm9iZShzdHJ1Y3QgdXNiX2ludGVyZmFjZSAq
aW50ZXJmYWNlLAorCQkJIGNvbnN0IHN0cnVjdCB1c2JfZGV2aWNlX2lkICppZCkKK3sKKwl1OCBp
Zm51bSA9IGludGVyZmFjZS0+Y3VyX2FsdHNldHRpbmctPmRlc2MuYkludGVyZmFjZU51bWJlcjsK
KwlzdHJ1Y3QgdXNiX2RldmljZSAqdXNiID0gaW50ZXJmYWNlX3RvX3VzYmRldihpbnRlcmZhY2Up
OworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3Jt
YXQgPSBOVUxMOworCXUzMiAqZm9ybWF0cywgKmZvcm1hdHNfZGV2LCBudW1fY29ubmVjdG9ycywg
bnVtX2Zvcm1hdHMgPSAwOworCWJvb2wgcmdiNTY1X3N1cHBvcnRlZCA9IGZhbHNlLCByZ2I4ODg4
X3N1cHBvcnRlZCA9IGZhbHNlOworCXN0cnVjdCB1c2JfZW5kcG9pbnRfZGVzY3JpcHRvciAqYnVs
a19vdXQ7CisJc3RydWN0IGd1ZF9kcm1fZGlzcGxheV9kZXNjcmlwdG9yIGRlc2M7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJmludGVyZmFjZS0+ZGV2OworCXN0cnVjdCBndWRfZHJtX2RldmljZSAq
Z2RybTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtOworCXNpemVfdCBtYXhfYnVmZmVyX3NpemU7
CisJaW50IHJldCwgaTsKKworCXJldCA9IHVzYl9maW5kX2J1bGtfb3V0X2VuZHBvaW50KGludGVy
ZmFjZS0+Y3VyX2FsdHNldHRpbmcsICZidWxrX291dCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCXJldCA9IGd1ZF9nZXRfdmVuZG9yX2Rlc2NyaXB0b3IoaW50ZXJmYWNlLCAmZGVzYyk7
CisJaWYgKHJldCkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJOb3QgYSBkaXNwbGF5
IGludGVyZmFjZTogcmV0PSVkXG4iLCByZXQpOworCQlyZXR1cm4gLUVOT0RFVjsKKwl9CisKKwlp
ZiAoZGVzYy5iVmVyc2lvbiA+IDEpIHsKKwkJdTggKnZlcnNpb24gPSBrbWFsbG9jKHNpemVvZigq
dmVyc2lvbiksIEdGUF9LRVJORUwpOworCisJCWlmICghdmVyc2lvbikKKwkJCXJldHVybiAtRU5P
TUVNOworCisJCS8qIENoZWNrIGlmIHRoZSBkZXZpY2UgY2FuIHN1cHBvcnQgdXMgKi8KKwkJKnZl
cnNpb24gPSAxOworCQlyZXQgPSBndWRfZHJtX3VzYl9jb250cm9sX21zZyh1c2IsIGlmbnVtLCBm
YWxzZSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9WRVJTSU9OLAorCQkJCQkgICAgICAwLCB2ZXJzaW9u
LCBzaXplb2YoKnZlcnNpb24pLCB0cnVlKTsKKwkJa2ZyZWUodmVyc2lvbik7CisJCWlmIChyZXQp
IHsKKwkJCWRldl9lcnIoZGV2LCAiUHJvdG9jb2wgdmVyc2lvbiAldSBpcyBub3Qgc3VwcG9ydGVk
XG4iLCBkZXNjLmJWZXJzaW9uKTsKKwkJCXJldHVybiAtRVBST1RPTk9TVVBQT1JUOworCQl9CisK
KwkJZGVzYy5iVmVyc2lvbiA9IDE7CisJfQorCisJbnVtX2Nvbm5lY3RvcnMgPSBkZXNjLmJOdW1D
b25uZWN0b3JzOworCW1heF9idWZmZXJfc2l6ZSA9IDEgPDwgZGVzYy5iTWF4QnVmZmVyU2l6ZU9y
ZGVyOworCisJZ2RybSA9IGRldm1fZHJtX2Rldl9hbGxvYyhkZXYsICZndWRfZHJtX2RyaXZlciwg
c3RydWN0IGd1ZF9kcm1fZGV2aWNlLCBkcm0pOworCWlmIChJU19FUlIoZ2RybSkpCisJCXJldHVy
biBQVFJfRVJSKGdkcm0pOworCisJZHJtID0gJmdkcm0tPmRybTsKKwlkcm0tPm1vZGVfY29uZmln
LmZ1bmNzID0gJmd1ZF9kcm1fbW9kZV9jb25maWdfZnVuY3M7CisJcmV0ID0gZHJtbV9tb2RlX2Nv
bmZpZ19pbml0KGRybSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWdkcm0tPnVzYiA9
IHVzYjsKKwlnZHJtLT5pZm51bSA9IGlmbnVtOworCWdkcm0tPmNvbXByZXNzaW9uID0gZGVzYy5i
Q29tcHJlc3Npb24gJiBHVURfRFJNX0NPTVBSRVNTSU9OX0xaNDsKKworCW11dGV4X2luaXQoJmdk
cm0tPmN0cmxfbG9jayk7CisJbXV0ZXhfaW5pdCgmZ2RybS0+ZGFtYWdlX2xvY2spOworCUlOSVRf
V09SSygmZ2RybS0+d29yaywgZ3VkX2RybV93b3JrKTsKKwlndWRfZHJtX2NsZWFyX2RhbWFnZShn
ZHJtKTsKKworCS8qCisJICogZGV2bV9rbWFsbG9jKCkgcGxhY2VzIHN0cnVjdCBkZXZyZXMgYXQg
dGhlIGJlZ2lubmluZyBvZiB0aGUgYnVmZmVyIGl0CisJICogYWxsb2NhdGVzLiBUaGlzIGNhbiB3
YXN0ZSBhIGxvdCBvZiBtZW1vcnkgd2hlbiBhbGxvY2F0aW5nCisJICogcG93ZXItb2YtdHdvIHNp
emVkIGJ1ZmZlcnMuIEFza2luZyBmb3IgNGsgd291bGQgYWN0dWFsbHkgYWxsb2NhdGUgOGsuCisJ
ICovCisKKwlyZXQgPSBkZXZtX2FkZF9hY3Rpb25fb3JfcmVzZXQoZGV2LCBndWRfZHJtX2ZyZWVf
YnVmZmVyc19hbmRfbXV0ZXgsIGdkcm0pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwln
ZHJtLT5jdHJsX21zZ19idWYgPSBrbWFsbG9jKEdVRF9EUk1fTUFYX1RSQU5TRkVSX1NJWkUsIEdG
UF9LRVJORUwpOworCWdkcm0tPnN0YXR1c19idWYgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2Yo
c3RydWN0IGd1ZF9kcm1fcmVxX2dldF9zdGF0dXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdkcm0t
PmN0cmxfbXNnX2J1ZiB8fCAhZ2RybS0+c3RhdHVzX2J1ZikKKwkJcmV0dXJuIC1FTk9NRU07City
ZXRyeToKKwlnZHJtLT5idWxrX2J1ZiA9IGttYWxsb2MobWF4X2J1ZmZlcl9zaXplLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIWdkcm0tPmJ1bGtfYnVmKSB7CisJCW1heF9idWZmZXJfc2l6ZSAvPSAyOwor
CQlpZiAobWF4X2J1ZmZlcl9zaXplIDwgU1pfMk0pIHsgLyogR2l2ZSB1cCBpZiB3ZSBjYW4ndCBk
byAxMDI0eDc2OCBSR0I1NjUgKi8KKwkJCXJldHVybiAtRU5PTUVNOworCQl9CisJCWdvdG8gcmV0
cnk7CisJfQorCisJZ2RybS0+YnVsa19waXBlID0gdXNiX3NuZGJ1bGtwaXBlKGdkcm0tPnVzYiwg
dXNiX2VuZHBvaW50X251bShidWxrX291dCkpOworCWdkcm0tPmJ1bGtfbGVuID0gbWF4X2J1ZmZl
cl9zaXplOworCisJaWYgKGdkcm0tPmNvbXByZXNzaW9uICYgR1VEX0RSTV9DT01QUkVTU0lPTl9M
WjQpIHsKKwkJZ2RybS0+bHo0X2NvbXBfbWVtID0gZGV2bV9rbWFsbG9jKGRldiwgTFo0X01FTV9D
T01QUkVTUywgR0ZQX0tFUk5FTCk7CisJCWlmICghZ2RybS0+bHo0X2NvbXBfbWVtKQorCQkJcmV0
dXJuIC1FTk9NRU07CisKKwkJZ2RybS0+Y29tcHJlc3NfYnVmID0gdm1hbGxvYyhnZHJtLT5idWxr
X2xlbik7CisJCWlmICghZ2RybS0+Y29tcHJlc3NfYnVmKQorCQkJcmV0dXJuIC1FTk9NRU07CisJ
fQorCisJZHJtLT5tb2RlX2NvbmZpZy5taW5fd2lkdGggPSBsZTMyX3RvX2NwdShkZXNjLmR3TWlu
V2lkdGgpOworCWRybS0+bW9kZV9jb25maWcubWF4X3dpZHRoID0gbGUzMl90b19jcHUoZGVzYy5k
d01heFdpZHRoKTsKKwlkcm0tPm1vZGVfY29uZmlnLm1pbl9oZWlnaHQgPSBsZTMyX3RvX2NwdShk
ZXNjLmR3TWluSGVpZ2h0KTsKKwlkcm0tPm1vZGVfY29uZmlnLm1heF9oZWlnaHQgPSBsZTMyX3Rv
X2NwdShkZXNjLmR3TWF4SGVpZ2h0KTsKKworCWZvcm1hdHNfZGV2ID0gZGV2bV9rbWFsbG9jX2Fy
cmF5KGRldiwgZGVzYy5iTnVtRm9ybWF0cywgc2l6ZW9mKHUzMiksIEdGUF9LRVJORUwpOworCS8q
IEFkZCByb29tIGZvciBlbXVsYXRlZCBYUkdCODg4OCAqLworCWZvcm1hdHMgPSBkZXZtX2ttYWxs
b2NfYXJyYXkoZGV2LCBkZXNjLmJOdW1Gb3JtYXRzICsgMSwgc2l6ZW9mKHUzMiksIEdGUF9LRVJO
RUwpOworCWlmICghZm9ybWF0c19kZXYgfHwgIWZvcm1hdHMpCisJCXJldHVybiAtRU5PTUVNOwor
CisJcmV0ID0gZ3VkX2RybV91c2JfcmVhZDMyKGdkcm0sIEdVRF9EUk1fVVNCX1JFUV9HRVRfRk9S
TUFUUywgZm9ybWF0c19kZXYsIGRlc2MuYk51bUZvcm1hdHMpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CisKKwlmb3IgKGkgPSAwOyBpIDwgZGVzYy5iTnVtRm9ybWF0czsgaSsrKSB7CisJCWNv
bnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZtdF9pbmZvOworCQl1MzIgZm9ybWF0ID0gZm9y
bWF0c19kZXZbaV07CisKKwkJaWYgKGZvcm1hdCA9PSBHVURfRFJNX0ZPUk1BVF9SMSkgeworCQkJ
Zm10X2luZm8gPSAmZ3VkX2RybV9mb3JtYXRfcjE7CisJCX0gZWxzZSB7CisJCQkvKiBUaGlzIHdp
bGwgdHJpZ2dlciBhIFdBUk4gZm9yIHVua25vd24gZm9ybWF0cy4uLiAqLworCQkJZm10X2luZm8g
PSBkcm1fZm9ybWF0X2luZm8oZm9ybWF0KTsKKwkJCWlmICghZm10X2luZm8pIHsKKwkJCQlkcm1f
ZGJnKGRybSwgIlVua25vd24gZm9ybWF0OiAweCV4XG4iLCBmb3JtYXQpOworCQkJCWNvbnRpbnVl
OworCQkJfQorCQl9CisKKwkJc3dpdGNoIChmb3JtYXQpIHsKKwkJY2FzZSBEUk1fRk9STUFUX1hS
R0I4ODg4OgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKKwkJ
CXJnYjg4ODhfc3VwcG9ydGVkID0gdHJ1ZTsKKwkJCWJyZWFrOworCQljYXNlIERSTV9GT1JNQVRf
UkdCODg4OgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgRFJNX0ZPUk1BVF9CR1I4ODg6CisJCQlk
cm1fZGJnKGRybSwgIjI0LWJpdCBmb3JtYXRzIGFyZSBub3Qgc3VwcG9ydGVkLlxuIik7CisJCQlj
b250aW51ZTsKKwkJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJCXJnYjU2NV9zdXBwb3J0ZWQg
PSB0cnVlOworCQkJaWYgKCF4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KQorCQkJCXhyZ2I4ODg4
X2VtdWxhdGlvbl9mb3JtYXQgPSBmbXRfaW5mbzsKKwkJCWJyZWFrOworCQljYXNlIEdVRF9EUk1f
Rk9STUFUX1IxOgorCQkJaWYgKCF4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KQorCQkJCXhyZ2I4
ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSBmbXRfaW5mbzsKKwkJCS8qIEludGVybmFsLCBub3QgZm9y
IHVzZXJzcGFjZSAqLworCQkJY29udGludWU7CisJCX0KKworCQlmb3JtYXRzW251bV9mb3JtYXRz
KytdID0gZm9ybWF0OworCX0KKworCWlmICghbnVtX2Zvcm1hdHMgJiYgIXhyZ2I4ODg4X2VtdWxh
dGlvbl9mb3JtYXQpIHsKKwkJZGV2X2VycihkZXYsICJObyBzdXBwb3J0ZWQgZm9ybWF0cyBmb3Vu
ZFxuIik7CisJCXJldHVybiAtRU5PRU5UOworCX0KKworCS8qIFByZWZlciBzcGVlZCBvdmVyIGNv
bG9yIGRlcHRoICovCisJaWYgKHJnYjU2NV9zdXBwb3J0ZWQpCisJCWRybS0+bW9kZV9jb25maWcu
cHJlZmVycmVkX2RlcHRoID0gMTY7CisKKwlpZiAoIXJnYjg4ODhfc3VwcG9ydGVkICYmIHhyZ2I4
ODg4X2VtdWxhdGlvbl9mb3JtYXQpIHsKKwkJZ2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1h
dCA9IHhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQ7CisJCWZvcm1hdHNbbnVtX2Zvcm1hdHMrK10g
PSBEUk1fRk9STUFUX1hSR0I4ODg4OworCX0KKworCXJldCA9IGRybV9zaW1wbGVfZGlzcGxheV9w
aXBlX2luaXQoZHJtLCAmZ2RybS0+cGlwZSwgJmd1ZF9kcm1fcGlwZV9mdW5jcywKKwkJCQkJICAg
Zm9ybWF0cywgbnVtX2Zvcm1hdHMsCisJCQkJCSAgIGd1ZF9kcm1fcGlwZV9tb2RpZmllcnMsIE5V
TEwpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkZXZtX2tmcmVlKGRldiwgZm9ybWF0
cyk7CisJZGV2bV9rZnJlZShkZXYsIGZvcm1hdHNfZGV2KTsKKworCXJldCA9IGd1ZF9kcm1fZ2V0
X3Byb3BlcnRpZXMoZ2RybSwgZGVzYy5iTnVtUHJvcGVydGllcyk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKworCWRybV9wbGFuZV9lbmFibGVfZmJfZGFtYWdlX2NsaXBzKCZnZHJtLT5waXBl
LnBsYW5lKTsKKworCWZvciAoaSA9IDA7IGkgPCBudW1fY29ubmVjdG9yczsgaSsrKSB7CisJCXJl
dCA9IGd1ZF9kcm1fY29ubmVjdG9yX2NyZWF0ZShnZHJtLCBpKTsKKwkJaWYgKHJldCkKKwkJCXJl
dHVybiByZXQ7CisJfQorCisJZHJtX21vZGVfY29uZmlnX3Jlc2V0KGRybSk7CisKKwl1c2Jfc2V0
X2ludGZkYXRhKGludGVyZmFjZSwgZ2RybSk7CisKKwlyZXQgPSBkcm1fZGV2X3JlZ2lzdGVyKGRy
bSwgMCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWRybV9rbXNfaGVscGVyX3BvbGxf
aW5pdChkcm0pOworCisJZHJtX2ZiZGV2X2dlbmVyaWNfc2V0dXAoZHJtLCAwKTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgdm9pZCBndWRfZHJtX2Rpc2Nvbm5lY3Qoc3RydWN0IHVzYl9pbnRl
cmZhY2UgKmludGVyZmFjZSkKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB1c2Jf
Z2V0X2ludGZkYXRhKGludGVyZmFjZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9ICZnZHJt
LT5kcm07CisKKwlkcm1fZGJnKGRybSwgIiVzOlxuIiwgX19mdW5jX18pOworCisJZHJtX2ttc19o
ZWxwZXJfcG9sbF9maW5pKGRybSk7CisJZHJtX2Rldl91bnBsdWcoZHJtKTsKKwlkcm1fYXRvbWlj
X2hlbHBlcl9zaHV0ZG93bihkcm0pOworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fc3VzcGVuZChz
dHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJmYWNlLCBwbV9tZXNzYWdlX3QgbWVzc2FnZSkKK3sK
KwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVyZmFj
ZSk7CisKKwlyZXR1cm4gZHJtX21vZGVfY29uZmlnX2hlbHBlcl9zdXNwZW5kKCZnZHJtLT5kcm0p
OworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fcmVzdW1lKHN0cnVjdCB1c2JfaW50ZXJmYWNlICpp
bnRlcmZhY2UpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdXNiX2dldF9pbnRm
ZGF0YShpbnRlcmZhY2UpOworCisJZHJtX21vZGVfY29uZmlnX2hlbHBlcl9yZXN1bWUoJmdkcm0t
PmRybSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCB1c2JfZGV2aWNl
X2lkIGd1ZF9kcm1fdGFibGVbXSA9IHsKKwkvKgorCSAqIEZJWE1FOgorCSAqIEFwcGx5IGZvciBh
IHByb3BlciBwaWQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVubW9rby9vcGVubW9rby11c2Itb3Vp
CisJICovCisJeyBVU0JfREVWSUNFX0lOVEVSRkFDRV9DTEFTUygweDFkNTAsIDB4NjE1MCwgVVNC
X0NMQVNTX1ZFTkRPUl9TUEVDKSB9LAorCXsgfQorfTsKKworTU9EVUxFX0RFVklDRV9UQUJMRSh1
c2IsIGd1ZF9kcm1fdGFibGUpOworCitzdGF0aWMgc3RydWN0IHVzYl9kcml2ZXIgZ3VkX2RybV91
c2JfZHJpdmVyID0geworCS5uYW1lCQk9ICJndWRfZHJtIiwKKwkucHJvYmUJCT0gZ3VkX2RybV9w
cm9iZSwKKwkuZGlzY29ubmVjdAk9IGd1ZF9kcm1fZGlzY29ubmVjdCwKKwkuaWRfdGFibGUJPSBn
dWRfZHJtX3RhYmxlLAorCS5zdXNwZW5kCT0gZ3VkX2RybV9zdXNwZW5kLAorCS5yZXN1bWUJCT0g
Z3VkX2RybV9yZXN1bWUsCisJLnJlc2V0X3Jlc3VtZQk9IGd1ZF9kcm1fcmVzdW1lLAorfTsKKwor
bW9kdWxlX3VzYl9kcml2ZXIoZ3VkX2RybV91c2JfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigi
Tm9yYWxmIFRyw7hubmVzIik7CitNT0RVTEVfTElDRU5TRSgiRHVhbCBNSVQvR1BMIik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1faW50ZXJuYWwuaCBiL2RyaXZlcnMv
Z3B1L2RybS9ndWQvZ3VkX2RybV9pbnRlcm5hbC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uMzBkODZiYjAzODlkCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2d1ZC9ndWRfZHJtX2ludGVybmFsLmgKQEAgLTAsMCArMSw2NiBAQAorLyogU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworCisjaWZuZGVmIF9fTElOVVhfR1VEX0RSTV9JTlRF
Uk5BTF9ICisjZGVmaW5lIF9fTElOVVhfR1VEX0RSTV9JTlRFUk5BTF9ICisKKyNpbmNsdWRlIDxs
aW51eC93b3JrcXVldWUuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGlu
dXgvbXV0ZXguaD4KKworI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKwor
c3RydWN0IGd1ZF9kcm1fZGV2aWNlIHsKKwlzdHJ1Y3QgZHJtX2RldmljZSBkcm07CisJc3RydWN0
IGRybV9zaW1wbGVfZGlzcGxheV9waXBlIHBpcGU7CisJc3RydWN0IHdvcmtfc3RydWN0IHdvcms7
CisJc3RydWN0IHVzYl9kZXZpY2UgKnVzYjsKKwl1OCBpZm51bTsKKwljb25zdCBzdHJ1Y3QgZHJt
X2Zvcm1hdF9pbmZvICp4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0OworCisJdTE2ICpwcm9wZXJ0
aWVzOworCXVuc2lnbmVkIGludCBudW1fcHJvcGVydGllczsKKworCXVuc2lnbmVkIGludCBidWxr
X3BpcGU7CisJdm9pZCAqYnVsa19idWY7CisJc2l6ZV90IGJ1bGtfbGVuOworCisJdTggY29tcHJl
c3Npb247CisJdm9pZCAqbHo0X2NvbXBfbWVtOworCXZvaWQgKmNvbXByZXNzX2J1ZjsKKworCXU2
NCBzdGF0c19sZW5ndGg7CisJdTY0IHN0YXRzX2FjdHVhbF9sZW5ndGg7CisJdW5zaWduZWQgaW50
IHN0YXRzX251bV9lcnJvcnM7CisKKwlzdHJ1Y3QgbXV0ZXggY3RybF9sb2NrOyAvKiBTZXJpYWxp
emUgcmVxIGFuZCBzdGF0dXMgdHJhbnNmZXJzICovCisJdm9pZCAqY3RybF9tc2dfYnVmOworCXZv
aWQgKnN0YXR1c19idWY7CisKKwlzdHJ1Y3QgbXV0ZXggZGFtYWdlX2xvY2s7IC8qIFByb3RlY3Rz
IHRoZSBmb2xsb3dpbmcgbWVtYmVyczogKi8KKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsK
KwlzdHJ1Y3QgZHJtX3JlY3QgZGFtYWdlOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgZ3Vk
X2RybV9kZXZpY2UgKnRvX2d1ZF9kcm1fZGV2aWNlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7
CisJcmV0dXJuIGNvbnRhaW5lcl9vZihkcm0sIHN0cnVjdCBndWRfZHJtX2RldmljZSwgZHJtKTsK
K30KKworaW50IGd1ZF9kcm1fdXNiX2dldChzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIHU4
IHJlcXVlc3QsIHUxNiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKTsKK2ludCBndWRfZHJt
X3VzYl9zZXQoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1MTYgaW5k
ZXgsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbik7CitpbnQgZ3VkX2RybV91c2Jfd3JpdGU4KHN0cnVj
dCBndWRfZHJtX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTggdmFsKTsKKwordm9pZCBndWRf
ZHJtX2NsZWFyX2RhbWFnZShzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0pOwordm9pZCBndWRf
ZHJtX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKTsKK2ludCBndWRfZHJtX3BpcGVfY2hl
Y2soc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkgICAgICAgc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlLAorCQkgICAgICAgc3RydWN0IGRybV9j
cnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7Cit2b2lkIGd1ZF9kcm1fcGlwZV91cGRhdGUoc3Ry
dWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkJIHN0cnVjdCBkcm1fcGxhbmVf
c3RhdGUgKm9sZF9zdGF0ZSk7CisKK2ludCBndWRfZHJtX2Nvbm5lY3Rvcl9maWxsX3Byb3BlcnRp
ZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkgICAgICBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlLAorCQkJCSAgICAgIHN0cnVjdCBndWRf
ZHJtX3Byb3BlcnR5ICpwcm9wZXJ0aWVzKTsKK2ludCBndWRfZHJtX2Nvbm5lY3Rvcl9jcmVhdGUo
c3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgaW5kZXgpOworCisjZW5k
aWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9waXBlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1fcGlwZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uOTUwMjNmNDY1ZGNiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2d1ZC9ndWRfZHJtX3BpcGUuYwpAQCAtMCwwICsxLDQyMyBAQAorLy8gU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5l
cworICovCisKKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvbHo0
Lmg+CisjaW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+
CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fY29ubmVj
dG9yLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9kcnYuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Zvcm1hdF9oZWxwZXIuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZnJhbWVidWZmZXIuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3By
aW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9yZWN0Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9zaW1w
bGVfa21zX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9ndWRfZHJtLmg+CisKKyNpbmNsdWRlICJn
dWRfZHJtX2ludGVybmFsLmgiCisKK3N0YXRpYyBib29sIGd1ZF9kcm1faXNfYmlnX2VuZGlhbih2
b2lkKQoreworI2lmIGRlZmluZWQoX19CSUdfRU5ESUFOKQorCXJldHVybiB0cnVlOworI2Vsc2UK
KwlyZXR1cm4gZmFsc2U7CisjZW5kaWYKK30KKworc3RhdGljIHNpemVfdCBndWRfZHJtX3hyZ2I4
ODg4X3RvX3IxMjQodTggKmRzdCwgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0
LAorCQkJCSAgICAgICB2b2lkICpzcmMsIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJ
CSAgICAgICBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCit7CisJdW5zaWduZWQgaW50IGJsb2NrX3dp
ZHRoID0gZHJtX2Zvcm1hdF9pbmZvX2Jsb2NrX3dpZHRoKGZvcm1hdCwgMCk7CisJdW5zaWduZWQg
aW50IGJpdHNfcGVyX3BpeGVsID0gOCAvIGJsb2NrX3dpZHRoOworCXVuc2lnbmVkIGludCB4LCB5
LCB3aWR0aCwgaGVpZ2h0OworCXU4ICpwLCAqYmxvY2sgPSBkc3Q7IC8qIEFzc2lnbiB0byBzaWxl
bmNlIGNvbXBpbGVyIHdhcm5pbmcgKi8KKwlzaXplX3QgbGVuOworCXZvaWQgKmJ1ZjsKKworCVdB
Uk5fT05fT05DRShmb3JtYXQtPmNoYXJfcGVyX2Jsb2NrWzBdICE9IDEpOworCisJLyogU3RhcnQg
b24gYSBieXRlIGJvdW5kYXJ5ICovCisJcmVjdC0+eDEgPSBBTElHTl9ET1dOKHJlY3QtPngxLCBi
bG9ja193aWR0aCk7CisJd2lkdGggPSBkcm1fcmVjdF93aWR0aChyZWN0KTsKKwloZWlnaHQgPSBk
cm1fcmVjdF9oZWlnaHQocmVjdCk7CisJbGVuID0gZHJtX2Zvcm1hdF9pbmZvX21pbl9waXRjaChm
b3JtYXQsIDAsIHdpZHRoKSAqIGhlaWdodDsKKworCWJ1ZiA9IGttYWxsb2Mod2lkdGggKiBoZWln
aHQsIEdGUF9LRVJORUwpOworCWlmICghYnVmKQorCQlyZXR1cm4gbGVuOyAvKiBUbyBrZWVwIGxv
Z2ljIHNpbXBsZSwganVzdCB0cmFuc21pdCBnYXJiYWdlICovCisKKwlkcm1fZmJfeHJnYjg4ODhf
dG9fZ3JheTgoYnVmLCBzcmMsIGZiLCByZWN0KTsKKworCXAgPSBidWY7CisJZm9yICh5ID0gMDsg
eSA8IGRybV9yZWN0X2hlaWdodChyZWN0KTsgeSsrKSB7CisJCWZvciAoeCA9IDA7IHggPCBkcm1f
cmVjdF93aWR0aChyZWN0KTsgeCsrKSB7CisJCQlpZiAoISh4ICUgYmxvY2tfd2lkdGgpKSB7CisJ
CQkJYmxvY2sgPSBkc3QrKzsKKwkJCQkqYmxvY2sgPSAwOworCQkJfQorCisJCQkqYmxvY2sgPDw9
IGJpdHNfcGVyX3BpeGVsOworCQkJKmJsb2NrIHw9ICgqcCsrKSA+PiAoOCAtIGJpdHNfcGVyX3Bp
eGVsKTsKKwkJfQorCX0KKworCWtmcmVlKGJ1Zik7CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0
aWMgaW50IGd1ZF9kcm1fZmJfZmx1c2goc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICpmb3JtYXQsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKK3sKKwlzdHJ1Y3QgZG1hX2J1Zl9h
dHRhY2htZW50ICppbXBvcnRfYXR0YWNoID0gZmItPm9ialswXS0+aW1wb3J0X2F0dGFjaDsKKwlz
dHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X2J1ZmZlciByZXE7CisJc2l6ZV90IHRybGVuLCBsZW47CisJ
aW50IGFjdHVhbF9sZW5ndGg7CisJdm9pZCAqdmFkZHIsICpidWY7CisJaW50IHJldCA9IDA7CisK
Kwlkcm1fZGJnKCZnZHJtLT5kcm0sICJGbHVzaGluZyBbRkI6JWRdICIgRFJNX1JFQ1RfRk1UICIg
aW1wb3J0ZWQ9JXNcbiIsCisJCWZiLT5iYXNlLmlkLCBEUk1fUkVDVF9BUkcocmVjdCksIGltcG9y
dF9hdHRhY2ggPyAieWVzIiA6ICJubyIpOworCisJbGVuID0gZHJtX2Zvcm1hdF9pbmZvX21pbl9w
aXRjaChmb3JtYXQsIDAsIGRybV9yZWN0X3dpZHRoKHJlY3QpKSAqIGRybV9yZWN0X2hlaWdodChy
ZWN0KTsKKwlpZiAobGVuID4gZ2RybS0+YnVsa19sZW4pCisJCXJldHVybiAtRTJCSUc7CisKKwl2
YWRkciA9IGRybV9nZW1fc2htZW1fdm1hcChmYi0+b2JqWzBdKTsKKwlpZiAoIXZhZGRyKQorCQly
ZXR1cm4gLUVOT01FTTsKKworCWlmIChpbXBvcnRfYXR0YWNoKSB7CisJCXJldCA9IGRtYV9idWZf
YmVnaW5fY3B1X2FjY2VzcyhpbXBvcnRfYXR0YWNoLT5kbWFidWYsIERNQV9GUk9NX0RFVklDRSk7
CisJCWlmIChyZXQpCisJCQlnb3RvIHZ1bm1hcDsKKwl9CisKKwlpZiAoZ2RybS0+Y29tcHJlc3Np
b24gJiBHVURfRFJNX0NPTVBSRVNTSU9OX0xaNCkKKwkJYnVmID0gZ2RybS0+Y29tcHJlc3NfYnVm
OworCWVsc2UKKwkJYnVmID0gZ2RybS0+YnVsa19idWY7CisKKwkvKgorCSAqIEltcG9ydGVkIGJ1
ZmZlcnMgYXJlIGFzc3VtZWQgdG8gYmUgd3JpdGUtY29tYmluZWQgYW5kIHRodXMgdW5jYWNoZWQK
KwkgKiB3aXRoIHNsb3cgcmVhZHMgKGF0IGxlYXN0IG9uIEFSTSkuCisJICovCisJaWYgKGZvcm1h
dCAhPSBmYi0+Zm9ybWF0KSB7CisJCWlmIChmb3JtYXQtPmZvcm1hdCA9PSBHVURfRFJNX0ZPUk1B
VF9SMSkKKwkJCWxlbiA9IGd1ZF9kcm1feHJnYjg4ODhfdG9fcjEyNChidWYsIGZvcm1hdCwgdmFk
ZHIsIGZiLCByZWN0KTsKKwkJZWxzZSBpZiAoZm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9S
R0I1NjUpCisJCQlkcm1fZmJfeHJnYjg4ODhfdG9fcmdiNTY1KGJ1ZiwgdmFkZHIsIGZiLCByZWN0
LCBndWRfZHJtX2lzX2JpZ19lbmRpYW4oKSk7CisJfSBlbHNlIGlmIChndWRfZHJtX2lzX2JpZ19l
bmRpYW4oKSAmJiBmb3JtYXQtPmNwcFswXSA+IDEpIHsKKwkJZHJtX2ZiX3N3YWIoYnVmLCB2YWRk
ciwgZmIsIHJlY3QsICFpbXBvcnRfYXR0YWNoKTsKKwl9IGVsc2UgaWYgKCFpbXBvcnRfYXR0YWNo
ICYmIGdkcm0tPmNvbXByZXNzaW9uICYmIGxlbiA9PSBmYi0+aGVpZ2h0ICogZmItPnBpdGNoZXNb
MF0pIHsKKwkJLyogY2FuIGNvbXByZXNzIGRpcmVjdGx5IGZyb20gdGhlIGZyYW1lYnVmZmVyICov
CisJCWJ1ZiA9IHZhZGRyOworCX0gZWxzZSB7CisJCWRybV9mYl9tZW1jcHkoYnVmLCB2YWRkciwg
ZmIsIHJlY3QpOworCX0KKworCXJlcS54ID0gY3B1X3RvX2xlMzIocmVjdC0+eDEpOworCXJlcS55
ID0gY3B1X3RvX2xlMzIocmVjdC0+eTEpOworCXJlcS53aWR0aCA9IGNwdV90b19sZTMyKGRybV9y
ZWN0X3dpZHRoKHJlY3QpKTsKKwlyZXEuaGVpZ2h0ID0gY3B1X3RvX2xlMzIoZHJtX3JlY3RfaGVp
Z2h0KHJlY3QpKTsKKwlyZXEubGVuZ3RoID0gY3B1X3RvX2xlMzIobGVuKTsKKworCWlmIChnZHJt
LT5jb21wcmVzc2lvbiAmIEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0KSB7CisJCXJldCA9IExaNF9j
b21wcmVzc19kZWZhdWx0KGJ1ZiwgZ2RybS0+YnVsa19idWYsIGxlbiwgbGVuLCBnZHJtLT5sejRf
Y29tcF9tZW0pOworCQlpZiAocmV0ID4gMCkKKwkJCXJlcS5jb21wcmVzc2lvbiA9IEdVRF9EUk1f
Q09NUFJFU1NJT05fTFo0OworCX0KKworCXRybGVuID0gbGVuOworCisJaWYgKHJldCA+IDApIHsK
KwkJcmVxLmNvbXByZXNzZWRfbGVuZ3RoID0gY3B1X3RvX2xlMzIocmV0KTsKKwkJdHJsZW4gPSBy
ZXQ7CisJfSBlbHNlIGlmIChidWYgPT0gZ2RybS0+Y29tcHJlc3NfYnVmKSB7CisJCS8qCisJCSAq
IENvbXByZXNzaW9uIGZhaWxlZCAoYnVmZmVyIGRpZG4ndCBjb21wcmVzcyB3ZWxsKS4KKwkJICog
Y29tcHJlc3NfYnVmIGlzIHZtYWxsb2MnZWQgc28gd2UgbmVlZCB0byBjb3B5LgorCQkgKi8KKwkJ
bWVtY3B5KGdkcm0tPmJ1bGtfYnVmLCBnZHJtLT5jb21wcmVzc19idWYsIGxlbik7CisJfQorCisJ
aWYgKGltcG9ydF9hdHRhY2gpCisJCWRtYV9idWZfZW5kX2NwdV9hY2Nlc3MoaW1wb3J0X2F0dGFj
aC0+ZG1hYnVmLCBETUFfRlJPTV9ERVZJQ0UpOworCisJZ2RybS0+c3RhdHNfbGVuZ3RoICs9IGxl
bjsKKwkvKiBEaWQgaXQgd3JhcCBhcm91bmQ/ICovCisJaWYgKGdkcm0tPnN0YXRzX2xlbmd0aCA8
PSBsZW4gJiYgZ2RybS0+c3RhdHNfYWN0dWFsX2xlbmd0aCkgeworCQlnZHJtLT5zdGF0c19sZW5n
dGggPSBsZW47CisJCWdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGggPSAwOworCX0KKwlnZHJtLT5z
dGF0c19hY3R1YWxfbGVuZ3RoICs9IHRybGVuOworCisJLyoKKwkgKiBUaGlzIHdpbGwgd2FpdCBp
ZiBkZWNvbXByZXNzL2NvcHkgZnJvbSB0aGUgcHJldmlvdXMgZmx1c2ggaXMgc3RpbGwgaW4KKwkg
KiBwcm9jZXNzIG9uIHRoZSBnYWRnZXQgc2lkZS4KKwkgKi8KKwlyZXQgPSBndWRfZHJtX3VzYl9z
ZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9CVUZGRVIsIDAsICZyZXEsIHNpemVvZihyZXEp
KTsKKwlpZiAocmV0KQorCQlnb3RvIHZ1bm1hcDsKKworCXJldCA9IHVzYl9idWxrX21zZyhnZHJt
LT51c2IsIGdkcm0tPmJ1bGtfcGlwZSwgZ2RybS0+YnVsa19idWYsIHRybGVuLAorCQkJICAgJmFj
dHVhbF9sZW5ndGgsIG1zZWNzX3RvX2ppZmZpZXMoMzAwMCkpOworCWlmICghcmV0ICYmIHRybGVu
ICE9IGFjdHVhbF9sZW5ndGgpCisJCXJldCA9IC1FSU87CisJaWYgKHJldCkKKwkJZ2RybS0+c3Rh
dHNfbnVtX2Vycm9ycysrOwordnVubWFwOgorCWRybV9nZW1fc2htZW1fdnVubWFwKGZiLT5vYmpb
MF0sIHZhZGRyKTsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZ3VkX2RybV9jbGVhcl9kYW1h
Z2Uoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtKQoreworCWdkcm0tPmRhbWFnZS54MSA9IElO
VF9NQVg7CisJZ2RybS0+ZGFtYWdlLnkxID0gSU5UX01BWDsKKwlnZHJtLT5kYW1hZ2UueDIgPSAw
OworCWdkcm0tPmRhbWFnZS55MiA9IDA7Cit9CisKK3ZvaWQgZ3VkX2RybV93b3JrKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSBjb250
YWluZXJfb2Yod29yaywgc3RydWN0IGd1ZF9kcm1fZGV2aWNlLCB3b3JrKTsKKwljb25zdCBzdHJ1
Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQ7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7
CisJc3RydWN0IGRybV9yZWN0IGRhbWFnZTsKKwl1bnNpZ25lZCBpbnQgaSwgbGluZXM7CisJaW50
IGlkeCwgcmV0ID0gMDsKKwlzaXplX3QgcGl0Y2g7CisKKwlpZiAoIWRybV9kZXZfZW50ZXIoJmdk
cm0tPmRybSwgJmlkeCkpCisJCXJldHVybjsKKworCW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9s
b2NrKTsKKwlmYiA9IGdkcm0tPmZiOworCWdkcm0tPmZiID0gTlVMTDsKKwlkYW1hZ2UgPSBnZHJt
LT5kYW1hZ2U7CisJZ3VkX2RybV9jbGVhcl9kYW1hZ2UoZ2RybSk7CisJbXV0ZXhfdW5sb2NrKCZn
ZHJtLT5kYW1hZ2VfbG9jayk7CisKKwlpZiAoIWZiKQorCQlnb3RvIG91dDsKKworCWZvcm1hdCA9
IGZiLT5mb3JtYXQ7CisJaWYgKGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfWFJHQjg4ODgg
JiYgZ2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkKKwkJZm9ybWF0ID0gZ2RybS0+eHJn
Yjg4ODhfZW11bGF0aW9uX2Zvcm1hdDsKKworCS8qIFNwbGl0IHVwZGF0ZSBpZiBpdCdzIHRvbyBi
aWcgKi8KKwlwaXRjaCA9IGRybV9mb3JtYXRfaW5mb19taW5fcGl0Y2goZm9ybWF0LCAwLCBkcm1f
cmVjdF93aWR0aCgmZGFtYWdlKSk7CisJbGluZXMgPSBkcm1fcmVjdF9oZWlnaHQoJmRhbWFnZSk7
CisKKwlpZiAoZ2RybS0+YnVsa19sZW4gPCBsaW5lcyAqIHBpdGNoKQorCQlsaW5lcyA9IGdkcm0t
PmJ1bGtfbGVuIC8gcGl0Y2g7CisKKwlmb3IgKGkgPSAwOyBpIDwgRElWX1JPVU5EX1VQKGRybV9y
ZWN0X2hlaWdodCgmZGFtYWdlKSwgbGluZXMpOyBpKyspIHsKKwkJc3RydWN0IGRybV9yZWN0IHJl
Y3QgPSBkYW1hZ2U7CisKKwkJcmVjdC55MSArPSBpICogbGluZXM7CisJCXJlY3QueTIgPSBtaW5f
dCh1MzIsIHJlY3QueTEgKyBsaW5lcywgZGFtYWdlLnkyKTsKKworCQlyZXQgPSBndWRfZHJtX2Zi
X2ZsdXNoKGdkcm0sIGZiLCBmb3JtYXQsICZyZWN0KTsKKwkJaWYgKHJldCAmJgorCQkgICAgKHJl
dCAhPSAtRU5PREVWICYmIHJldCAhPSAtRUNPTk5SRVNFVCAmJiByZXQgIT0gLUVTSFVURE9XTiAm
JiByZXQgIT0gLUVQUk9UTykpCisJCQlkZXZfZXJyX29uY2UoZmItPmRldi0+ZGV2LCAiRmFpbGVk
IHRvIGZsdXNoIGZyYW1lYnVmZmVyOiBlcnJvcj0lZFxuIiwgcmV0KTsKKwl9CisKKwlkcm1fZnJh
bWVidWZmZXJfcHV0KGZiKTsKK291dDoKKwlkcm1fZGV2X2V4aXQoaWR4KTsKK30KKworc3RhdGlj
IHZvaWQgZ3VkX2RybV9mYl9xdWV1ZV9kYW1hZ2Uoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJt
LAorCQkJCSAgICBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgICAgc3RydWN0IGRy
bV9yZWN0ICpkYW1hZ2UpCit7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqb2xkX2ZiID0gTlVM
TDsKKworCW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCWlmIChmYiAhPSBnZHJt
LT5mYikgeworCQlvbGRfZmIgPSBnZHJtLT5mYjsKKwkJZHJtX2ZyYW1lYnVmZmVyX2dldChmYik7
CisJCWdkcm0tPmZiID0gZmI7CisJfQorCisJZ2RybS0+ZGFtYWdlLngxID0gbWluKGdkcm0tPmRh
bWFnZS54MSwgZGFtYWdlLT54MSk7CisJZ2RybS0+ZGFtYWdlLnkxID0gbWluKGdkcm0tPmRhbWFn
ZS55MSwgZGFtYWdlLT55MSk7CisJZ2RybS0+ZGFtYWdlLngyID0gbWF4KGdkcm0tPmRhbWFnZS54
MiwgZGFtYWdlLT54Mik7CisJZ2RybS0+ZGFtYWdlLnkyID0gbWF4KGdkcm0tPmRhbWFnZS55Miwg
ZGFtYWdlLT55Mik7CisKKwltdXRleF91bmxvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCXF1
ZXVlX3dvcmsoc3lzdGVtX2xvbmdfd3EsICZnZHJtLT53b3JrKTsKKworCWlmIChvbGRfZmIpCisJ
CWRybV9mcmFtZWJ1ZmZlcl9wdXQob2xkX2ZiKTsKK30KKworaW50IGd1ZF9kcm1fcGlwZV9jaGVj
ayhzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCisJCSAgICAgICBzdHJ1Y3Qg
ZHJtX3BsYW5lX3N0YXRlICpuZXdfcGxhbmVfc3RhdGUsCisJCSAgICAgICBzdHJ1Y3QgZHJtX2Ny
dGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2Ry
bSA9IHRvX2d1ZF9kcm1fZGV2aWNlKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgZHJtX3BsYW5l
X3N0YXRlICpvbGRfcGxhbmVfc3RhdGUgPSBwaXBlLT5wbGFuZS5zdGF0ZTsKKwljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZuZXdfY3J0Y19zdGF0ZS0+bW9kZTsKKwlzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBuZXdfcGxhbmVfc3RhdGUtPnN0YXRlOworCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKm9sZF9mYiA9IG9sZF9wbGFuZV9zdGF0ZS0+ZmI7CisJc3Ry
dWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZSA9IE5VTEw7CisJc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVfc3RhdGUtPmZiOworCWNvbnN0IHN0cnVj
dCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCA9IGZiLT5mb3JtYXQ7CisJc3RydWN0IGd1ZF9kcm1f
cmVxX3NldF9zdGF0ZSAqcmVxOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJ
aW50IGlkeCwgcmV0LCBudW1fcHJvcGVydGllczsKKwl1bnNpZ25lZCBpbnQgaTsKKwlzaXplX3Qg
bGVuOworCisJaWYgKFdBUk5fT05fT05DRSghZmIpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlm
IChvbGRfcGxhbmVfc3RhdGUtPnJvdGF0aW9uICE9IG5ld19wbGFuZV9zdGF0ZS0+cm90YXRpb24p
CisJCW5ld19jcnRjX3N0YXRlLT5tb2RlX2NoYW5nZWQgPSB0cnVlOworCisJaWYgKG9sZF9mYiAm
JiBvbGRfZmItPmZvcm1hdCAhPSBmb3JtYXQpCisJCW5ld19jcnRjX3N0YXRlLT5tb2RlX2NoYW5n
ZWQgPSB0cnVlOworCisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+bW9kZV9jaGFuZ2VkICYmICFuZXdf
Y3J0Y19zdGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2VkKQorCQlyZXR1cm4gMDsKKworCS8qIE9ubHkg
b25lIGNvbm5lY3RvciBpcyBzdXBwb3J0ZWQgKi8KKwlpZiAoaHdlaWdodDMyKG5ld19jcnRjX3N0
YXRlLT5jb25uZWN0b3JfbWFzaykgIT0gMSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZm9y
bWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9YUkdCODg4OCAmJiBnZHJtLT54cmdiODg4OF9lbXVs
YXRpb25fZm9ybWF0KQorCQlmb3JtYXQgPSBnZHJtLT54cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0
OworCisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBj
b25uZWN0b3Jfc3RhdGUsIGkpCisJCWJyZWFrOworCisJaWYgKCFjb25uZWN0b3Jfc3RhdGUpIHsK
KwkJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKKworCQkvKiBXZSBh
bHdheXMgc2VuZCB0aGUgZnVsbCBzdGF0ZSB0byB0aGUgZGV2aWNlLCBzbyBnZXQgdGhlIGNvbm5l
Y3RvciBzdGF0ZSAqLworCisJCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKHBpcGUtPmNy
dGMuZGV2LCAmY29ubl9pdGVyKTsKKwkJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5l
Y3RvciwgJmNvbm5faXRlcikgeworCQkJaWYgKG5ld19jcnRjX3N0YXRlLT5jb25uZWN0b3JfbWFz
ayAmIGRybV9jb25uZWN0b3JfbWFzayhjb25uZWN0b3IpKQorCQkJCWJyZWFrOworCQl9CisJCWRy
bV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKworCQlpZiAoV0FSTl9PTl9P
TkNFKCFjb25uZWN0b3IpKQorCQkJcmV0dXJuIC1FTk9FTlQ7CisKKwkJY29ubmVjdG9yX3N0YXRl
ID0gZHJtX2F0b21pY19nZXRfY29ubmVjdG9yX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCQlp
ZiAoSVNfRVJSKGNvbm5lY3Rvcl9zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihjb25uZWN0b3Jf
c3RhdGUpOworCX0KKworCW51bV9wcm9wZXJ0aWVzID0gZ3VkX2RybV9jb25uZWN0b3JfZmlsbF9w
cm9wZXJ0aWVzKGNvbm5lY3RvciwgTlVMTCwgTlVMTCk7CisJaWYgKG51bV9wcm9wZXJ0aWVzIDwg
MCkKKwkJcmV0dXJuIG51bV9wcm9wZXJ0aWVzOworCisJbnVtX3Byb3BlcnRpZXMgKz0gZ2RybS0+
bnVtX3Byb3BlcnRpZXM7CisKKwlsZW4gPSBzdHJ1Y3Rfc2l6ZShyZXEsIHByb3BlcnRpZXMsIG51
bV9wcm9wZXJ0aWVzKTsKKwlyZXEgPSBremFsbG9jKGxlbiwgR0ZQX0tFUk5FTCk7CisJaWYgKCFy
ZXEpCisJCXJldHVybiAtRU5PTUVNOworCisJZ3VkX2RybV9mcm9tX2Rpc3BsYXlfbW9kZSgmcmVx
LT5tb2RlLCBtb2RlKTsKKworCXJlcS0+Zm9ybWF0ID0gY3B1X3RvX2xlMzIoZm9ybWF0LT5mb3Jt
YXQpOworCXJlcS0+Y29ubmVjdG9yID0gZHJtX2Nvbm5lY3Rvcl9pbmRleChjb25uZWN0b3IpOwor
CXJlcS0+bnVtX3Byb3BlcnRpZXMgPSBudW1fcHJvcGVydGllczsKKworCW51bV9wcm9wZXJ0aWVz
ID0gZ3VkX2RybV9jb25uZWN0b3JfZmlsbF9wcm9wZXJ0aWVzKGNvbm5lY3RvciwgY29ubmVjdG9y
X3N0YXRlLAorCQkJCQkJCSAgIHJlcS0+cHJvcGVydGllcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwg
Z2RybS0+bnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJvcCA9IGdkcm0tPnByb3BlcnRp
ZXNbaV07CisJCXU2NCB2YWw7CisKKwkJc3dpdGNoIChwcm9wKSB7CisJCWNhc2UgR1VEX0RSTV9Q
Uk9QRVJUWV9ST1RBVElPTjoKKwkJCXZhbCA9IG5ld19wbGFuZV9zdGF0ZS0+cm90YXRpb247CisJ
CQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCVdBUk5fT05fT05DRSgxKTsKKwkJCXJldCA9IC1FSU5W
QUw7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCXJlcS0+cHJvcGVydGllc1tudW1fcHJvcGVydGll
cyArIGldLnByb3AgPSBjcHVfdG9fbGUxNihwcm9wKTsKKwkJcmVxLT5wcm9wZXJ0aWVzW251bV9w
cm9wZXJ0aWVzICsgaV0udmFsID0gY3B1X3RvX2xlNjQodmFsKTsKKwl9CisKKwlpZiAoIWRybV9k
ZXZfZW50ZXIoZmItPmRldiwgJmlkeCkpIHsKKwkJcmV0ID0gLUVOT0RFVjsKKwkJZ290byBvdXQ7
CisJfQorCisJcmV0ID0gZ3VkX2RybV91c2Jfc2V0KGdkcm0sIEdVRF9EUk1fVVNCX1JFUV9TRVRf
U1RBVEVfQ0hFQ0ssIDAsIHJlcSwgbGVuKTsKKworCWRybV9kZXZfZXhpdChpZHgpOworb3V0Ogor
CWtmcmVlKHJlcSk7CisKKwlyZXR1cm4gcmV0OworfQorCit2b2lkIGd1ZF9kcm1fcGlwZV91cGRh
dGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkJIHN0cnVjdCBkcm1f
cGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gcGlw
ZS0+Y3J0Yy5kZXY7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RybV9k
ZXZpY2UoZHJtKTsKKwlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSA9IHBpcGUtPnBsYW5l
LnN0YXRlOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmZiOworCXN0cnVj
dCBkcm1fY3J0YyAqY3J0YyA9ICZwaXBlLT5jcnRjOworCXN0cnVjdCBkcm1fcmVjdCBkYW1hZ2U7
CisJaW50IGlkeDsKKworCWlmICghZHJtX2Rldl9lbnRlcihkcm0sICZpZHgpKQorCQlyZXR1cm47
CisKKwlpZiAoIW9sZF9zdGF0ZS0+ZmIpCisJCWd1ZF9kcm1fdXNiX3dyaXRlOChnZHJtLCBHVURf
RFJNX1VTQl9SRVFfU0VUX0NPTlRST0xMRVJfRU5BQkxFLCAxKTsKKworCWlmIChmYiAmJiAoY3J0
Yy0+c3RhdGUtPm1vZGVfY2hhbmdlZCB8fCBjcnRjLT5zdGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2Vk
KSkKKwkJZ3VkX2RybV91c2Jfc2V0KGdkcm0sIEdVRF9EUk1fVVNCX1JFUV9TRVRfU1RBVEVfQ09N
TUlULCAwLCBOVUxMLCAwKTsKKworCWlmIChjcnRjLT5zdGF0ZS0+YWN0aXZlX2NoYW5nZWQpCisJ
CWd1ZF9kcm1fdXNiX3dyaXRlOChnZHJtLCBHVURfRFJNX1VTQl9SRVFfU0VUX0RJU1BMQVlfRU5B
QkxFLCBjcnRjLT5zdGF0ZS0+YWN0aXZlKTsKKworCWlmIChkcm1fYXRvbWljX2hlbHBlcl9kYW1h
Z2VfbWVyZ2VkKG9sZF9zdGF0ZSwgc3RhdGUsICZkYW1hZ2UpKQorCQlndWRfZHJtX2ZiX3F1ZXVl
X2RhbWFnZShnZHJtLCBmYiwgJmRhbWFnZSk7CisKKwlpZiAoIWZiKSB7CisJCWNhbmNlbF93b3Jr
X3N5bmMoJmdkcm0tPndvcmspOworCisJCW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsK
KwkJaWYgKGdkcm0tPmZiKSB7CisJCQlkcm1fZnJhbWVidWZmZXJfcHV0KGdkcm0tPmZiKTsKKwkJ
CWdkcm0tPmZiID0gTlVMTDsKKwkJfQorCQlndWRfZHJtX2NsZWFyX2RhbWFnZShnZHJtKTsKKwkJ
bXV0ZXhfdW5sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwkJZ3VkX2RybV91c2Jfd3JpdGU4
KGdkcm0sIEdVRF9EUk1fVVNCX1JFUV9TRVRfQ09OVFJPTExFUl9FTkFCTEUsIDApOworCX0KKwor
CWRybV9kZXZfZXhpdChpZHgpOworfQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZ3VkX2RybS5o
IGIvaW5jbHVkZS9kcm0vZ3VkX2RybS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uMzZkMzViYzdjZmYyCi0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9kcm0vZ3Vk
X2RybS5oCkBAIC0wLDAgKzEsMzY0IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlU
ICovCisvKgorICogQ29weXJpZ2h0IDIwMjAgTm9yYWxmIFRyw7hubmVzCisgKi8KKworI2lmbmRl
ZiBfX0xJTlVYX0dVRF9EUk1fSAorI2RlZmluZSBfX0xJTlVYX0dVRF9EUk1fSAorCisjaW5jbHVk
ZSA8ZHJtL2RybV9tb2Rlcy5oPgorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisjaW5jbHVkZSA8
dWFwaS9kcm0vZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPHVhcGkvbGludXgvdXNiL2NoOS5oPgor
CisvKgorICogTWF4aW11bSBzaXplIG9mIGEgY29udHJvbCBtZXNzYWdlLCBmaXRzIDEyMCBkaXNw
bGF5IG1vZGVzLgorICogSWYgdGhpcyBuZWVkcyB0byBpbmNyZWFzZSwgdGhlIElOIHNpZGUgaW4g
Zl9ndWRfZHJtX3NldHVwKCkKKyAqIG5lZWRzIGZpeGluZy4KKyAqLworI2RlZmluZSBHVURfRFJN
X01BWF9UUkFOU0ZFUl9TSVpFCVNaXzRLCisKKyNkZWZpbmUgR1VEX0RSTV9VU0JfRFRfRElTUExB
WQkJKFVTQl9UWVBFX1ZFTkRPUiB8IDB4NCkKKworLyoKKyAqIHN0cnVjdCBndWRfZHJtX2Rpc3Bs
YXlfZGVzY3JpcHRvciAtIERpc3BsYXkgZGVzY3JpcHRvcgorICogQGJMZW5ndGg6IFNpemUgb2Yg
ZGVzY3JpcHRvciBpbiBieXRlcworICogQGJEZXNjcmlwdG9yVHlwZTogRGVzY3JpcHRvclR5cGUg
KEdVRF9EUk1fVVNCX0RUX0RJU1BMQVkpCisgKiBAYlZlcnNpb246IFByb3RvY29sIHZlcnNpb24K
KyAqIEBiTWF4QnVmZmVyU2l6ZU9yZGVyOiBNYXhpbXVtIGJ1ZmZlciBzaXplIHRoZSBkZXZpY2Ug
Y2FuIGhhbmRsZSBhcyBsb2cyCisgKiBAYm1GbGFnczogQ3VycmVudGx5IHVudXNlZCwgc2hvdWxk
IGJlIHNldCB0byB6ZXJvCisgKiBAYkNvbXByZXNzaW9uOiBTdXBwb3J0ZWQgY29tcHJlc3Npb24g
dHlwZXMKKyAqIEBkd01pbldpZHRoOiBNaW5pbXVtIHBpeGVsIHdpZHRoIHRoZSBjb250cm9sbGVy
IGNhbiBoYW5kbGUKKyAqIEBkd01heFdpZHRoOiBNYXhpbXVtIHdpZHRoCisgKiBAZHdNaW5IZWln
aHQ6IE1pbmltdW0gaGVpZ2h0CisgKiBAZHdNYXhIZWlnaHQ6IE1heGltdW0gaGVpZ2h0CisgKiBA
Yk51bUZvcm1hdHM6IE51bWJlciBvZiBzdXBwb3J0ZWQgcGl4ZWwgZm9ybWF0cworICogQGJOdW1Q
cm9wZXJ0aWVzOiBOdW1iZXIgb2YgcHJvcGVydGllcyB0aGF0IGFyZSBub3QgY29ubmVjdG9yIHBv
cnBlcnRpZXMKKyAqIEBiTnVtQ29ubmVjdG9yczogTnVtYmVyIG9mIGNvbm5lY3RvcnMKKyAqCisg
KiBEZXZpY2VzIHRoYXQgaGF2ZSBvbmx5IG9uZSBkaXNwbGF5IG1vZGUgd2lsbCBoYXZlIGR3TWlu
V2lkdGggPT0gZHdNYXhXaWR0aAorICogYW5kIGR3TWluSGVpZ2h0ID09IGR3TWF4SGVpZ2h0Lgor
ICoKKyAqLworc3RydWN0IGd1ZF9kcm1fZGlzcGxheV9kZXNjcmlwdG9yIHsKKwlfX3U4IGJMZW5n
dGg7CisJX191OCBiRGVzY3JpcHRvclR5cGU7CisKKwlfX3U4IGJWZXJzaW9uOworCV9fdTggYk1h
eEJ1ZmZlclNpemVPcmRlcjsKKwlfX2xlMzIgYm1GbGFnczsKKworCV9fdTggYkNvbXByZXNzaW9u
OworI2RlZmluZSBHVURfRFJNX0NPTVBSRVNTSU9OX0xaNAkJQklUKDApCisKKwlfX2xlMzIgZHdN
aW5XaWR0aDsKKwlfX2xlMzIgZHdNYXhXaWR0aDsKKwlfX2xlMzIgZHdNaW5IZWlnaHQ7CisJX19s
ZTMyIGR3TWF4SGVpZ2h0OworCisJX191OCBiTnVtRm9ybWF0czsKKwlfX3U4IGJOdW1Qcm9wZXJ0
aWVzOworCV9fdTggYk51bUNvbm5lY3RvcnM7Cit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0
IGd1ZF9kcm1fcmVxX2dldF9zdGF0dXMgLSBTdGF0dXMgcmVxdWVzdAorICogQGZsYWdzOiBGbGFn
cworICogQGVycm5vOiBMaW51eCBlcnJubyB2YWx1ZQorICoKKyAqIFRoZSBob3N0IGtlZXBzIHBv
bGxpbmcgZm9yIHN0YXR1cyBhcyBsb25nIGFzIHRoZSBHVURfRFJNX1NUQVRVU19QRU5ESU5HIGZs
YWcKKyAqIGlzIHNldCAob3IgdW50aWwgdGltZW91dCkuIFJlcXVlc3RlZCB1c2luZzogVVNCX1JF
UV9HRVRfU1RBVFVTLgorICovCitzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X3N0YXR1cyB7CisJX191
OCBmbGFnczsKKyNkZWZpbmUgR1VEX0RSTV9TVEFUVVNfUEVORElORwlCSVQoMCkKKwlfX3U4IGVy
cm5vOworfSBfX3BhY2tlZDsKKworLyoKKyAqIHN0cnVjdCBndWRfZHJtX3Byb3BlcnR5IC0gUHJv
cGVydHkKKyAqIEBwcm9wOiBQcm9wZXJ0eQorICogQHZhbDogVmFsdWUKKyAqLworc3RydWN0IGd1
ZF9kcm1fcHJvcGVydHkgeworCV9fbGUxNiBwcm9wOworCV9fbGU2NCB2YWw7Cit9IF9fcGFja2Vk
OworCisvKiBTZWUgJmRybV9kaXNwbGF5X21vZGUgZm9yIHRoZSBtZWFuaW5nIG9mIHRoZXNlIGZp
ZWxkcyAqLworc3RydWN0IGd1ZF9kcm1fZGlzcGxheV9tb2RlIHsKKwlfX2xlMzIgY2xvY2s7CisJ
X19sZTE2IGhkaXNwbGF5OworCV9fbGUxNiBoc3luY19zdGFydDsKKwlfX2xlMTYgaHN5bmNfZW5k
OworCV9fbGUxNiBodG90YWw7CisJX19sZTE2IGhza2V3OworCV9fbGUxNiB2ZGlzcGxheTsKKwlf
X2xlMTYgdnN5bmNfc3RhcnQ7CisJX19sZTE2IHZzeW5jX2VuZDsKKwlfX2xlMTYgdnRvdGFsOwor
CV9fbGUxNiB2c2NhbjsKKwlfX2xlMzIgdnJlZnJlc2g7CisJX19sZTMyIGZsYWdzOworCV9fdTgg
dHlwZTsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X2Nvbm5l
Y3RvciAtIENvbm5lY3RvciBkZXNjcmlwdG9yCisgKiBAY29ubmVjdG9yX3R5cGU6IENvbm5lY3Rv
ciB0eXBlIChEUk1fTU9ERV9DT05ORUNUT1JfKikKKyAqIEBmbGFnczogRmxhZ3MKKyAqIEBudW1f
cHJvcGVydGllczogTnVtYmVyIG9mIHN1cHBvcnRlZCBwcm9wZXJ0aWVzCisgKi8KK3N0cnVjdCBn
dWRfZHJtX3JlcV9nZXRfY29ubmVjdG9yIHsKKwlfX3U4IGNvbm5lY3Rvcl90eXBlOworCisJX19s
ZTMyIGZsYWdzOworI2RlZmluZSBHVURfRFJNX0NPTk5FQ1RPUl9GTEFHU19QT0xMCUJJVCgwKQor
CisJX191OCBudW1fcHJvcGVydGllczsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBzdHJ1Y3QgZ3Vk
X2RybV9yZXFfZ2V0X2Nvbm5lY3Rvcl9zdGF0dXMgLSBDb25uZWN0b3Igc3RhdHVzCisgKiBAc3Rh
dHVzOiBTdGF0dXMsIHNlZSAmZHJtX2Nvbm5lY3Rvcl9zdGF0dXMKKyAqIEBudW1fbW9kZXM6IE51
bWJlciBvZiBhdmFpbGFibGUgZGlzcGxheSBtb2RlcworICogQG1vZGVzX2FycmF5X2NoZWNrc3Vt
OiBDUkMtQ0NJVFQgY2hlY2tzdW0gb2YgdGhlIGRpc3BsYXkgbW9kZSBhcnJheSBpbiBsaXR0bGUg
ZW5kaWFuIGZvcm1hdAorICogQGVkaWRfbGVuOiBMZW5ndGggb2YgRURJRCBkYXRhCisgKiBAZWRp
ZF9jaGVja3N1bTogQ1JDLUNDSVRUIGNoZWNrc3VtIG9mIEVESUQgZGF0YQorICoKKyAqIElmIGJv
dGggQG51bV9tb2RlcyBhbmQgQGVkaWRfbGVuIGFyZSB6ZXJvLCBjb25uZWN0b3Igc3RhdHVzIGlz
IHNldCB0bworICogZGlzY29ubmVjdGVkLiBJZiBAbnVtX21vZGVzIGlzIHplcm8sIGVkaWQgaXMg
dXNlZCB0byBjcmVhdGUgZGlzcGxheSBtb2Rlcy4KKyAqIElmIGJvdGggYXJlIHNldCwgZWRpZCBp
cyBqdXN0IHBhc3NlZCBvbiB0byB1c2Vyc3BhY2UgaW4gdGhlIEVESUQgY29ubmVjdG9yCisgKiBw
cm9wZXJ0eS4KKyAqCisgKiBEaXNwbGF5IG1vZGVzIGFuZCBFRElEIGFyZSBvbmx5IHJlcXVlc3Rl
ZCBpZiBudW1iZXIvbGVuZ3RoIG9yIGNyYyBkaWZmZXJzLgorICovCitzdHJ1Y3QgZ3VkX2RybV9y
ZXFfZ2V0X2Nvbm5lY3Rvcl9zdGF0dXMgeworCV9fdTggc3RhdHVzOworI2RlZmluZSBHVURfRFJN
X0NPTk5FQ1RPUl9TVEFUVVNfTUFTSwkJMHhmIC8qIE9ubHkgMiBiaXRzIGFyZSBjdXJyZW50bHkg
dXNlZCBmb3Igc3RhdHVzICovCisjZGVmaW5lIEdVRF9EUk1fQ09OTkVDVE9SX1NUQVRVU19DSEFO
R0VECUJJVCg3KQorCV9fdTE2IG51bV9tb2RlczsKKwlfX3UxNiBlZGlkX2xlbjsKK30gX19wYWNr
ZWQ7CisKKy8qCisgKiBzdHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X2J1ZmZlciAtIFNldCBidWZmZXIg
dHJhbnNmZXIgaW5mbworICogQHg6IFggcG9zaXRpb24gb2YgcmVjdGFuZ2xlCisgKiBAeTogWSBw
b3NpdGlvbgorICogQHdpZHRoOiBQaXhlbCB3aWR0aCBvZiByZWN0YW5nbGUKKyAqIEBoZWlnaHQ6
IFBpeGVsIGhlaWdodAorICogQGxlbmd0aDogQnVmZmVyIGxlbmd0aCBpbiBieXRlcworICogQGNv
bXByZXNzaW9uOiBUcmFuc2ZlciBjb21wcmVzc2lvbgorICogQGNvbXByZXNzZWRfbGVuZ3RoOiBD
b21wcmVzc2VkIGJ1ZmZlciBsZW5ndGgKKyAqCisgKiBAeCwgQHksIEB3aWR0aCBhbmQgQGhlaWdo
dCBzcGVjaWZpZXMgdGhlIHJlY3RhbmdsZSB3aGVyZSB0aGUgYnVmZmVyIHNob3VsZCBiZQorICog
cGxhY2VkIGluc2lkZSB0aGUgZnJhbWVidWZmZXIuCisgKi8KK3N0cnVjdCBndWRfZHJtX3JlcV9z
ZXRfYnVmZmVyIHsKKwlfX2xlMzIgeDsKKwlfX2xlMzIgeTsKKwlfX2xlMzIgd2lkdGg7CisJX19s
ZTMyIGhlaWdodDsKKworCV9fbGUzMiBsZW5ndGg7CisJX191OCBjb21wcmVzc2lvbjsKKwlfX2xl
MzIgY29tcHJlc3NlZF9sZW5ndGg7Cit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9k
cm1fcmVxX3NldF9zdGF0ZSAtIFNldCBkaXNwbGF5IHN0YXRlCisgKiBAbW9kZTogRGlzcGxheSBt
b2RlCisgKiBAZm9ybWF0OiBQaXhlbCBmb3JtYXQKKyAqIEBjb25uZWN0b3I6IENvbm5lY3RvciBp
bmRleAorICogQG51bV9wcm9wZXJ0aWVzOiBOdW1iZXIgb2YgcHJvcGVydGllcyBpbiB0aGUgc3Rh
dGUKKyAqIEBwcm9wZXJ0aWVzOiBBcnJheSBvZiBwcm9wZXJ0aWVzCisgKgorICogVGhlIGVudGly
ZSBzdGF0ZSBpcyB0cmFuc2ZlcnJlZCBlYWNoIHRpbWUgdGhlcmUncyBhIGNoYW5nZS4KKyAqLwor
c3RydWN0IGd1ZF9kcm1fcmVxX3NldF9zdGF0ZSB7CisJc3RydWN0IGd1ZF9kcm1fZGlzcGxheV9t
b2RlIG1vZGU7CisJX19sZTMyIGZvcm1hdDsKKwlfX3U4IGNvbm5lY3RvcjsKKwlfX3U4IG51bV9w
cm9wZXJ0aWVzOworCXN0cnVjdCBndWRfZHJtX3Byb3BlcnR5IHByb3BlcnRpZXNbXTsKK30gX19w
YWNrZWQ7CisKKy8qCisgKiBJbnRlcm5hbCBtb25vY2hyb21lIHRyYW5zZmVyIGZvcm1hdCBwcmVz
ZW50ZWQgdG8gdXNlcnNwYWNlIGFzIFhSR0I4ODg4LgorICogUGl4ZWwgbGluZXMgYXJlIGJ5dGUg
YWxpZ25lZC4KKyAqLworI2RlZmluZSBHVURfRFJNX0ZPUk1BVF9SMQlmb3VyY2NfY29kZSgnUics
ICcxJywgJyAnLCAnICcpCisKKy8qIExpc3Qgb2Ygc3VwcG9ydGVkIGNvbm5lY3RvciBwcm9wZXJ0
aWVzOiAqLworCisvKiBUViByZWxhdGVkIHByb3BlcnRpZXMsIHNlZSAmZHJtX2Nvbm5lY3RvciBh
bmQgJmRybV90dl9jb25uZWN0b3Jfc3RhdGUgKi8KKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJUWV9U
Vl9TRUxFQ1RfU1VCQ09OTkVDVE9SCQkxCisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfTEVG
VF9NQVJHSU4JCQkyCisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOCQkz
CisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfVE9QX01BUkdJTgkJCTQKKyNkZWZpbmUgR1VE
X0RSTV9QUk9QRVJUWV9UVl9CT1RUT01fTUFSR0lOCQk1CisvKiBOdW1iZXIgb2YgbW9kZXMgYXJl
IHBsYWNlZCBhdCBfU0hJRlQgaW4gdmFsIG9uIHJldHJpZXZhbCAqLworI2RlZmluZSBHVURfRFJN
X1BST1BFUlRZX1RWX01PREUJCQk2CisgICNkZWZpbmUgR1VEX0RSTV9VU0JfQ09OTkVDVE9SX1RW
X01PREVfTlVNX1NISUZUICAgMTYKKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJUWV9UVl9CUklHSFRO
RVNTCQkJNworI2RlZmluZSBHVURfRFJNX1BST1BFUlRZX1RWX0NPTlRSQVNUCQkJOAorI2RlZmlu
ZSBHVURfRFJNX1BST1BFUlRZX1RWX0ZMSUNLRVJfUkVEVUNUSU9OCQk5CisjZGVmaW5lIEdVRF9E
Uk1fUFJPUEVSVFlfVFZfT1ZFUlNDQU4JCQkxMAorI2RlZmluZSBHVURfRFJNX1BST1BFUlRZX1RW
X1NBVFVSQVRJT04JCQkxMQorI2RlZmluZSBHVURfRFJNX1BST1BFUlRZX1RWX0hVRQkJCQkxMgor
CisvKgorICogQmFja2xpZ2h0IGJyaWdodG5lc3MgaXMgaW4gdGhlIHJhbmdlIDAtMTAwIGluY2x1
c2l2ZS4gVGhlIHZhbHVlIHJlcHJlc2VudHMKKyAqIHRoZSBodW1hbiBwZXJjZXB0dWFsIGJyaWdo
dG5lc3MgYW5kIG5vdCBhIGxpbmVhciBQV00gdmFsdWUuIDAgaXMgbWluaW11bQorICogYnJpZ2h0
bmVzcyB3aGljaCBzaG91bGQgbm90IHR1cm4gdGhlIGJhY2tsaWdodCBjb21wbGV0ZWx5IG9mZi4g
VGhlIERQTVMKKyAqIGNvbm5lY3RvciBwcm9wZXJ0eSBzaG91bGQgYmUgdXNlZCB0byBjb250cm9s
IHBvd2VyIHdoaWNoIHdpbGwgdHJpZ2dlciBhCisgKiBHVURfRFJNX1VTQl9SRVFfU0VUX0RJU1BM
QVlfRU5BQkxFIHJlcXVlc3QuCisgKgorICogVGhpcyBpcyBub3QgYSByZWFsIERSTSBwcm9wZXJ0
eSwgYnV0IHJhdGhlciBhIGZha2Ugb25lIHVzZWQgZm9yIHRoZSBiYWNrbGlnaHQKKyAqIGRldmlj
ZS4gU2VlIGRybV9iYWNrbGlnaHRfcmVnaXN0ZXIoKSBmb3IgbW9yZSBkZXRhaWxzLgorICovCisj
ZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfQkFDS0xJR0hUX0JSSUdIVE5FU1MJCTEzCisKKy8qIExp
c3Qgb2Ygc3VwcG9ydGVkIHByb3BlcnRpZXMgdGhhdCBhcmUgbm90IGNvbm5lY3RvciBwcm9wZXRp
ZXM6ICovCisKKy8qCisgKiBQbGFuZSByb3RhdGlvbi4gU2hvdWxkIHJldHVybiB0aGUgc3VwcG9y
dGVkIGJpdG1hc2sgb24KKyAqIEdVRF9EUk1fVVNCX1JFUV9HRVRfUFJPUEVSVElFUywgc2VlIGRy
bV9wbGFuZV9jcmVhdGVfcm90YXRpb25fcHJvcGVydHkoKS4KKyAqLworI2RlZmluZSBHVURfRFJN
X1BST1BFUlRZX1JPVEFUSU9OCQkJNTAKKworLyogVVNCIENvbnRyb2wgcmVxdWVzdHM6ICovCisK
Ky8qCisgKiBJZiB0aGUgaG9zdCBkcml2ZXIgZG9lc24ndCBzdXBwb3J0IHRoZSBkZXZpY2UgcHJv
dG9jb2wgdmVyc2lvbiBpdCB3aWxsIHNlbmQKKyAqIGl0cyB2ZXJzaW9uICh1OCkuIElmIHRoZSBk
ZXZpY2UgaXNuJ3QgYmFja3dhcmRzIGNvbXBhdGlibGUgb3IgZG9lc24ndCBzdXBwb3J0CisgKiB0
aGUgaG9zdCB2ZXJzaW9uIGl0IHNoYWxsIGhhbHQgdGhlIHRyYW5zZmVyLiBUaGVyZSBpcyBubyBz
dGF0dXMgcmVxdWVzdAorICogaXNzdWVkIGlmIHRoaXMgcmVxdWVzdCBmYWlscy9oYWx0cy4KKyAq
LworI2RlZmluZSBHVURfRFJNX1VTQl9SRVFfU0VUX1ZFUlNJT04JCQkweDMwCisKKy8qIEdldCBz
dXBwb3J0ZWQgcGl4ZWwgZm9ybWF0cyBhcyBhbiBhcnJheSBvZiBmb3VyY2MgY29kZXMuIFNlZSBp
bmNsdWRlL3VhcGkvZHJtL2RybV9mb3VyY2MuaCAqLworI2RlZmluZSBHVURfRFJNX1VTQl9SRVFf
R0VUX0ZPUk1BVFMJCQkweDQwCisKKy8qIEdldCBzdXBwb3J0ZWQgcHJvcGVydGllcyB0aGF0IGFy
ZSBub3QgY29ubmVjdG9yIHByb3BldGllcyBhcyBhICZndWRfZHJtX3Byb3BlcnR5IGFycmF5ICov
CisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9HRVRfUFJPUEVSVElFUwkJCTB4NDEKKworLyogR2V0
IGNvbm5lY3RvciBkZXNjcmlwdG9yICovCisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9HRVRfQ09O
TkVDVE9SCQkJMHg1MAorCisvKiBHZXQgcHJvcGVydGllcyBzdXBwb3J0ZWQgYnkgdGhlIGNvbm5l
Y3RvciBhcyBhICZndWRfZHJtX3Byb3BlcnR5IGFycmF5ICovCisjZGVmaW5lIEdVRF9EUk1fVVNC
X1JFUV9HRVRfQ09OTkVDVE9SX1BST1BFUlRJRVMJMHg1MQorCisvKgorICogSXNzdWVkIHdoZW4g
dGhlcmUncyBhIHR2Lm1vZGUgcHJvcGVydHkgcHJlc2VudC4KKyAqIEdldHMgYW4gYXJyYXkgb2Yg
dHYubW9kZSBlbnVtIG5hbWVzIGVhY2ggZW50cnkgb2YgbGVuZ3RoIERSTV9QUk9QX05BTUVfTEVO
LgorICovCisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9HRVRfQ09OTkVDVE9SX1RWX01PREVfVkFM
VUVTCTB4NTIKKworLyogV2hlbiB1c2Vyc3BhY2UgY2hlY2tzIHN0YXR1cywgdGhpcyBpcyBpc3N1
ZWQgZmlyc3QsIG5vdCB1c2VkIGZvciBwb2xsIHJlcXVlc3RzLiAqLworI2RlZmluZSBHVURfRFJN
X1VTQl9SRVFfU0VUX0NPTk5FQ1RPUl9GT1JDRV9ERVRFQ1QJMHg1MworCisvKiBHZXQgY29ubmVj
dG9yIHN0YXR1cyBhcyAmZ3VkX2RybV9yZXFfZ2V0X2Nvbm5lY3Rvcl9zdGF0dXMuICovCisjZGVm
aW5lIEdVRF9EUk1fVVNCX1JFUV9HRVRfQ09OTkVDVE9SX1NUQVRVUwkJMHg1NAorCisvKiBHZXQg
Jmd1ZF9kcm1fZGlzcGxheV9tb2RlIGFycmF5IG9mIHN1cHBvcnRlZCBkaXNwbGF5IG1vZGVzICov
CisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9HRVRfQ09OTkVDVE9SX01PREVTCQkweDU1CisKKyNk
ZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1JfRURJRAkJMHg1NgorCisvKiBTZXQg
YnVmZmVyIHByb3BlcnRpZXMgYmVmb3JlIGJ1bGsgdHJhbnNmZXIgYXMgJmd1ZF9kcm1fcmVxX3Nl
dF9idWZmZXIgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX1NFVF9CVUZGRVIJCQkweDYwCisK
Ky8qIENoZWNrIGRpc3BsYXkgY29uZmlndXJhdGlvbiBhcyAmZ3VkX2RybV9yZXFfc2V0X3N0YXRl
ICovCisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9TRVRfU1RBVEVfQ0hFQ0sJCQkweDYxCisKKy8q
IEFwcGx5IHRoZSBwcmV2b2l1cyBfU1RBVEVfQ0hFQ0sgY29uZmlndXJhdGlvbiAqLworI2RlZmlu
ZSBHVURfRFJNX1VTQl9SRVFfU0VUX1NUQVRFX0NPTU1JVAkJMHg2MgorCisgLyogRW5hYmxlL2Rp
c2FibGUgdGhlIGRpc3BsYXkgY29udHJvbGxlciwgdmFsdWUgaXMgdTggMC8xICovCisjZGVmaW5l
IEdVRF9EUk1fVVNCX1JFUV9TRVRfQ09OVFJPTExFUl9FTkFCTEUJCTB4NjMKKworLyogRW5hYmxl
L2Rpc2FibGUgZGlzcGxheS9vdXRwdXQgKERQTVMpLCB2YWx1ZSBpcyB1OCAwLzEgKi8KKyNkZWZp
bmUgR1VEX0RSTV9VU0JfUkVRX1NFVF9ESVNQTEFZX0VOQUJMRQkJMHg2NAorCitzdGF0aWMgaW5s
aW5lIHZvaWQgZ3VkX2RybV9mcm9tX2Rpc3BsYXlfbW9kZShzdHJ1Y3QgZ3VkX2RybV9kaXNwbGF5
X21vZGUgKmRzdCwKKwkJCQkJICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqc3Jj
KQoreworCXUzMiBmbGFncyA9IHNyYy0+ZmxhZ3M7CisKKwlzd2l0Y2ggKHNyYy0+cGljdHVyZV9h
c3BlY3RfcmF0aW8pIHsKKwljYXNlIEhETUlfUElDVFVSRV9BU1BFQ1RfNF8zOgorCQlmbGFncyB8
PSBEUk1fTU9ERV9GTEFHX1BJQ19BUl80XzM7CisJCWJyZWFrOworCWNhc2UgSERNSV9QSUNUVVJF
X0FTUEVDVF8xNl85OgorCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX1BJQ19BUl8xNl85OworCQli
cmVhazsKKwljYXNlIEhETUlfUElDVFVSRV9BU1BFQ1RfNjRfMjc6CisJCWZsYWdzIHw9IERSTV9N
T0RFX0ZMQUdfUElDX0FSXzY0XzI3OworCQlicmVhazsKKwljYXNlIEhETUlfUElDVFVSRV9BU1BF
Q1RfMjU2XzEzNToKKwkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19QSUNfQVJfMjU2XzEzNTsKKwkJ
YnJlYWs7CisJZGVmYXVsdDoKKwkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19QSUNfQVJfTk9ORTsK
KwkJYnJlYWs7CisJfQorCisJZHN0LT5jbG9jayA9IGNwdV90b19sZTMyKHNyYy0+Y2xvY2spOwor
CWRzdC0+aGRpc3BsYXkgPSBjcHVfdG9fbGUxNihzcmMtPmhkaXNwbGF5KTsKKwlkc3QtPmhzeW5j
X3N0YXJ0ID0gY3B1X3RvX2xlMTYoc3JjLT5oc3luY19zdGFydCk7CisJZHN0LT5oc3luY19lbmQg
PSBjcHVfdG9fbGUxNihzcmMtPmhzeW5jX2VuZCk7CisJZHN0LT5odG90YWwgPSBjcHVfdG9fbGUx
NihzcmMtPmh0b3RhbCk7CisJZHN0LT5oc2tldyA9IGNwdV90b19sZTE2KHNyYy0+aHNrZXcpOwor
CWRzdC0+dmRpc3BsYXkgPSBjcHVfdG9fbGUxNihzcmMtPnZkaXNwbGF5KTsKKwlkc3QtPnZzeW5j
X3N0YXJ0ID0gY3B1X3RvX2xlMTYoc3JjLT52c3luY19zdGFydCk7CisJZHN0LT52c3luY19lbmQg
PSBjcHVfdG9fbGUxNihzcmMtPnZzeW5jX2VuZCk7CisJZHN0LT52dG90YWwgPSBjcHVfdG9fbGUx
NihzcmMtPnZ0b3RhbCk7CisJZHN0LT52c2NhbiA9IGNwdV90b19sZTE2KHNyYy0+dnNjYW4pOwor
CWRzdC0+dnJlZnJlc2ggPSBjcHVfdG9fbGUzMihzcmMtPnZyZWZyZXNoKTsKKwlkc3QtPmZsYWdz
ID0gY3B1X3RvX2xlMzIoZmxhZ3MpOworCWRzdC0+dHlwZSA9IHNyYy0+dHlwZTsKK30KKworc3Rh
dGljIGlubGluZSB2b2lkIGd1ZF9kcm1fdG9fZGlzcGxheV9tb2RlKHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICpkc3QsCisJCQkJCSAgIGNvbnN0IHN0cnVjdCBndWRfZHJtX2Rpc3BsYXlfbW9kZSAq
c3JjKQoreworCXUzMiBmbGFncyA9IGxlMzJfdG9fY3B1KHNyYy0+ZmxhZ3MpOworCisJZHN0LT5j
bG9jayA9IGxlMzJfdG9fY3B1KHNyYy0+Y2xvY2spOworCWRzdC0+aGRpc3BsYXkgPSBsZTE2X3Rv
X2NwdShzcmMtPmhkaXNwbGF5KTsKKwlkc3QtPmhzeW5jX3N0YXJ0ID0gbGUxNl90b19jcHUoc3Jj
LT5oc3luY19zdGFydCk7CisJZHN0LT5oc3luY19lbmQgPSBsZTE2X3RvX2NwdShzcmMtPmhzeW5j
X2VuZCk7CisJZHN0LT5odG90YWwgPSBsZTE2X3RvX2NwdShzcmMtPmh0b3RhbCk7CisJZHN0LT5o
c2tldyA9IGxlMTZfdG9fY3B1KHNyYy0+aHNrZXcpOworCWRzdC0+dmRpc3BsYXkgPSBsZTE2X3Rv
X2NwdShzcmMtPnZkaXNwbGF5KTsKKwlkc3QtPnZzeW5jX3N0YXJ0ID0gbGUxNl90b19jcHUoc3Jj
LT52c3luY19zdGFydCk7CisJZHN0LT52c3luY19lbmQgPSBsZTE2X3RvX2NwdShzcmMtPnZzeW5j
X2VuZCk7CisJZHN0LT52dG90YWwgPSBsZTE2X3RvX2NwdShzcmMtPnZ0b3RhbCk7CisJZHN0LT52
c2NhbiA9IGxlMTZfdG9fY3B1KHNyYy0+dnNjYW4pOworCWRzdC0+dnJlZnJlc2ggPSBsZTMyX3Rv
X2NwdShzcmMtPnZyZWZyZXNoKTsKKwlkc3QtPmZsYWdzID0gZmxhZ3MgJiB+RFJNX01PREVfRkxB
R19QSUNfQVJfTUFTSzsKKwlkc3QtPnR5cGUgPSBzcmMtPnR5cGU7CisKKwlzd2l0Y2ggKGZsYWdz
ICYgRFJNX01PREVfRkxBR19QSUNfQVJfTUFTSykgeworCWNhc2UgRFJNX01PREVfRkxBR19QSUNf
QVJfNF8zOgorCQlkc3QtPnBpY3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNUVVJFX0FTUEVD
VF80XzM7CisJCWJyZWFrOworCWNhc2UgRFJNX01PREVfRkxBR19QSUNfQVJfMTZfOToKKwkJZHN0
LT5waWN0dXJlX2FzcGVjdF9yYXRpbyA9IEhETUlfUElDVFVSRV9BU1BFQ1RfMTZfOTsKKwkJYnJl
YWs7CisJY2FzZSBEUk1fTU9ERV9GTEFHX1BJQ19BUl82NF8yNzoKKwkJZHN0LT5waWN0dXJlX2Fz
cGVjdF9yYXRpbyA9IEhETUlfUElDVFVSRV9BU1BFQ1RfNjRfMjc7CisJCWJyZWFrOworCWNhc2Ug
RFJNX01PREVfRkxBR19QSUNfQVJfMjU2XzEzNToKKwkJZHN0LT5waWN0dXJlX2FzcGVjdF9yYXRp
byA9IEhETUlfUElDVFVSRV9BU1BFQ1RfMjU2XzEzNTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJ
ZHN0LT5waWN0dXJlX2FzcGVjdF9yYXRpbyA9IEhETUlfUElDVFVSRV9BU1BFQ1RfTk9ORTsKKwkJ
YnJlYWs7CisJfQorCisJZHJtX21vZGVfc2V0X25hbWUoZHN0KTsKK30KKworI2VuZGlmCi0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRy
aS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
