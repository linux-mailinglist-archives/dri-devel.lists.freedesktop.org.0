Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D5CDFC218C
	for <lists+dri-devel@lfdr.de>; Mon, 30 Sep 2019 15:13:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 875326E422;
	Mon, 30 Sep 2019 13:12:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 04FD26E41F;
 Mon, 30 Sep 2019 13:12:58 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id l3so11265365wru.7;
 Mon, 30 Sep 2019 06:12:57 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=u9Cal8t+nqIyNkGYrW25SDzUh2Fp985JnWaBHbXu7t4=;
 b=CEPhnQFXgPAVrKIGe4XxGLtBt9gtaXrtKDzR6mJd9BlN+Vclruwr5hSpv6cmTVIyVc
 YLirMTDZc6Wm9oqTdAVYJpSJnvjiaDQt5djY+HNtKmfwbc8xM+htCgIwEpwOqwmg9/7+
 VdIwRmk/wzXPy5VlO80zEJSiNSLF+L3hnBkt5reFaoQ3FHpuoEiUsh8DE3AneLmrSwKj
 pGwOZ0XjB8EG54RYUamjjnXPz+Ruxc9qmVoaAKibeVowWbzAd1P8D34TtCYaSQUGP8R0
 fgvMJlZf1oGtjUf2PEsf3nquopUoalOUptFW3f291zaE76Q3DtoKntyxNkW5StulggBa
 sGQA==
X-Gm-Message-State: APjAAAU9ud4xeOlHxQ5t+9Rfn0DY/REOMn31gq0yiWQNyjPe5SNx4d5x
 2sw3cpD17WbGDAjd0ShxzzM=
X-Google-Smtp-Source: APXvYqz7qGG2jSH+XQ9KQJONd4tpgV2y5NwqTnWRkMZbiL46Och4y8XQUrjFQc+qXwITDdO7GBLb1A==
X-Received: by 2002:adf:e410:: with SMTP id g16mr12373337wrm.297.1569849176462; 
 Mon, 30 Sep 2019 06:12:56 -0700 (PDT)
Received: from baker.fritz.box ([2a02:908:1252:fb60:501d:fc67:a879:e5a1])
 by smtp.gmail.com with ESMTPSA id n7sm11982707wrt.59.2019.09.30.06.12.55
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 30 Sep 2019 06:12:55 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: bskeggs@redhat.com, airlied@linux.ie, daniel@ffwll.ch,
 imirkin@alum.mit.edu, dri-devel@lists.freedesktop.org,
 nouveau@lists.freedesktop.org
Subject: [PATCH 1/2] drm/nouveau: move io_reserve_lru handling into the driver
Date: Mon, 30 Sep 2019 15:12:53 +0200
Message-Id: <20190930131254.31071-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.14.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=u9Cal8t+nqIyNkGYrW25SDzUh2Fp985JnWaBHbXu7t4=;
 b=XX/OxjhvD2mRKWe9wx+8Wvzd7sY1j+EDYVfAA3a1y3Ps9E8qd5RBHi1JJoglhDxYUy
 RFccKlSR5hbGPFQWUgxKki6ZI2rhln5R9vQ4RJmj+r95r9y/0VaJgfaFXFP7SA/aHIGh
 rPEYzM3sD/Sr0Wb1tr/asO/vcdI9mOmWFBAjSz+jbSRFfqn823hmRYWrmbCW4sCUExoy
 WBxqXG6TkYfO2FzKvJXxnk4NmQ/+iW++3CEfo3yyW9Bn857vZZuvOcw8MO+h2niIHJGb
 OSfL67NvVhsYfouP9Oc4MmqWgTfk8j9KvcLoOJtx0Sa6nITqjE4DGWKTqxe8TfDHinKt
 caSQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2hpbGUgd29ya2luZyBvbiBUVE0gY2xlYW51cHMgSSd2ZSBmb3VuZCB0aGF0IHRoZSBpb19yZXNl
cnZlX2xydSB1c2VkIGJ5Ck5vdXZlYXUgaXMgYWN0dWFsbHkgbm90IHdvcmtpbmcgYXQgYWxsLgoK
SW4gZ2VuZXJhbCB3ZSBzaG91bGQgcmVtb3ZlIGRyaXZlciBzcGVjaWZpYyBoYW5kbGluZyBmcm9t
IHRoZSBtZW1vcnkKbWFuYWdlbWVudCwgc28gdGhpcyBwYXRjaCBtb3ZlcyB0aGUgaW9fcmVzZXJ2
ZV9scnUgaGFuZGxpbmcgaW50byBOb3V2ZWF1Cmluc3RlYWQuCgpUaGUgcGF0Y2ggc2hvdWxkIGJl
IGZ1bmN0aW9uYWwgY29ycmVjdCwgYnV0IGlzIG9ubHkgY29tcGlsZSB0ZXN0ZWQhCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICB8IDEwNiArKysrKysrKysrKysr
KysrKysrKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Jv
LmggIHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmggfCAgIDIg
KwogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV90dG0uYyB8ICA0MyArKysrKysrKysr
KysrLQogNCBmaWxlcyBjaGFuZ2VkLCAxMzAgaW5zZXJ0aW9ucygrKSwgMjQgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jIGIvZHJp
dmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IGU5MThiNDM3YWYxNy4uOTUz
MmFkMWJkNDc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Jv
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCkBAIC0xMzksNiAr
MTM5LDcgQEAgbm91dmVhdV9ib19kZWxfdHRtKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8p
CiAJaWYgKHVubGlrZWx5KG52Ym8tPmJvLmJhc2UuZmlscCkpCiAJCURSTV9FUlJPUigiYm8gJXAg
c3RpbGwgYXR0YWNoZWQgdG8gR0VNIG9iamVjdFxuIiwgYm8pOwogCVdBUk5fT04obnZiby0+cGlu
X3JlZmNudCA+IDApOworCW5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KGJvKTsKIAludjEw
X2JvX3B1dF90aWxlX3JlZ2lvbihkZXYsIG52Ym8tPnRpbGUsIE5VTEwpOwogCWtmcmVlKG52Ym8p
OwogfQpAQCAtMjk3LDYgKzI5OCw3IEBAIG5vdXZlYXVfYm9faW5pdChzdHJ1Y3Qgbm91dmVhdV9i
byAqbnZibywgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGZsYWdzLAogCW5vdXZlYXVfYm9fZml4
dXBfYWxpZ24obnZibywgZmxhZ3MsICZhbGlnbiwgJnNpemUpOwogCW52Ym8tPmJvLm1lbS5udW1f
cGFnZXMgPSBzaXplID4+IFBBR0VfU0hJRlQ7CiAJbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52
Ym8sIGZsYWdzLCAwKTsKKwlJTklUX0xJU1RfSEVBRCgmbnZiby0+aW9fcmVzZXJ2ZV9scnUpOwog
CiAJcmV0ID0gdHRtX2JvX2luaXQobnZiby0+Ym8uYmRldiwgJm52Ym8tPmJvLCBzaXplLCB0eXBl
LAogCQkJICAmbnZiby0+cGxhY2VtZW50LCBhbGlnbiA+PiBQQUdFX1NISUZULCBmYWxzZSwKQEAg
LTU2Niw2ICs1NjgsMjYgQEAgbm91dmVhdV9ib19zeW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVf
Ym8gKm52Ym8pCiAJCQkJCVBBR0VfU0laRSwgRE1BX0ZST01fREVWSUNFKTsKIH0KIAordm9pZCBu
b3V2ZWF1X2JvX2FkZF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
KQoreworCXN0cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2KGJvLT5iZGV2KTsK
KwlzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibyA9IG5vdXZlYXVfYm8oYm8pOworCisJbXV0ZXhfbG9j
aygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7CisJbGlzdF9tb3ZlX3RhaWwoJm52Ym8tPmlv
X3Jlc2VydmVfbHJ1LCAmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUpOworCW11dGV4X3VubG9jaygm
ZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cit9CisKK3ZvaWQgbm91dmVhdV9ib19kZWxfaW9f
cmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKK3sKKwlzdHJ1Y3Qgbm91
dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfYmRldihiby0+YmRldik7CisJc3RydWN0IG5vdXZlYXVf
Ym8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKKworCW11dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jl
c2VydmVfbXV0ZXgpOworCWxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKKwlt
dXRleF91bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworfQorCiBpbnQKIG5vdXZl
YXVfYm9fdmFsaWRhdGUoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8sIGJvb2wgaW50ZXJydXB0aWJs
ZSwKIAkJICAgIGJvb2wgbm9fd2FpdF9ncHUpCkBAIC02NzQsOCArNjk2LDYgQEAgbm91dmVhdV9i
b19pbml0X21lbV90eXBlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCB1aW50MzJfdCB0eXBl
LAogCQkJfQogCiAJCQltYW4tPmZ1bmMgPSAmbm91dmVhdV92cmFtX21hbmFnZXI7Ci0JCQltYW4t
PmlvX3Jlc2VydmVfZmFzdHBhdGggPSBmYWxzZTsKLQkJCW1hbi0+dXNlX2lvX3Jlc2VydmVfbHJ1
ID0gdHJ1ZTsKIAkJfSBlbHNlIHsKIAkJCW1hbi0+ZnVuYyA9ICZ0dG1fYm9fbWFuYWdlcl9mdW5j
OwogCQl9CkBAIC0xMzA0LDYgKzEzMjQsOCBAQCBub3V2ZWF1X2JvX21vdmVfbnRmeShzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBib29sIGV2aWN0LAogCWlmIChiby0+ZGVzdHJveSAhPSBu
b3V2ZWF1X2JvX2RlbF90dG0pCiAJCXJldHVybjsKIAorCW5vdXZlYXVfYm9fZGVsX2lvX3Jlc2Vy
dmVfbHJ1KGJvKTsKKwogCWlmIChtZW0gJiYgbmV3X3JlZy0+bWVtX3R5cGUgIT0gVFRNX1BMX1NZ
U1RFTSAmJgogCSAgICBtZW0tPm1lbS5wYWdlID09IG52Ym8tPnBhZ2UpIHsKIAkJbGlzdF9mb3Jf
ZWFjaF9lbnRyeSh2bWEsICZudmJvLT52bWFfbGlzdCwgaGVhZCkgewpAQCAtMTQyNiw2ICsxNDQ4
LDMwIEBAIG5vdXZlYXVfYm9fdmVyaWZ5X2FjY2VzcyhzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvLCBzdHJ1Y3QgZmlsZSAqZmlscCkKIAkJCQkJICBmaWxwLT5wcml2YXRlX2RhdGEpOwogfQog
CitzdGF0aWMgdm9pZAorbm91dmVhdV90dG1faW9fbWVtX2ZyZWVfbG9ja2VkKHN0cnVjdCBub3V2
ZWF1X2RybSAqZHJtLCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKK3sKKwlzdHJ1Y3Qgbm91dmVh
dV9tZW0gKm1lbSA9IG5vdXZlYXVfbWVtKHJlZyk7CisKKwlpZiAoIXJlZy0+YnVzLmJhc2UpCisJ
CXJldHVybjsgLyogYWxyZWFkeSBmcmVlZCAqLworCisJaWYgKGRybS0+Y2xpZW50Lm1lbS0+b2Ns
YXNzID49IE5WSUZfQ0xBU1NfTUVNX05WNTApIHsKKwkJc3dpdGNoIChyZWctPm1lbV90eXBlKSB7
CisJCWNhc2UgVFRNX1BMX1RUOgorCQkJaWYgKG1lbS0+a2luZCkKKwkJCQludmlmX29iamVjdF91
bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7CisJCQlicmVhazsKKwkJY2FzZSBUVE1fUExf
VlJBTToKKwkJCW52aWZfb2JqZWN0X3VubWFwX2hhbmRsZSgmbWVtLT5tZW0ub2JqZWN0KTsKKwkJ
CWJyZWFrOworCQlkZWZhdWx0OgorCQkJYnJlYWs7CisJCX0KKwl9CisJcmVnLT5idXMuYmFzZSA9
IDA7Cit9CisKIHN0YXRpYyBpbnQKIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0
dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKIHsKQEAgLTE0MzMs
MTggKzE0NzksMjYgQEAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9ib19k
ZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQogCXN0cnVjdCBub3V2ZWF1X2Ry
bSAqZHJtID0gbm91dmVhdV9iZGV2KGJkZXYpOwogCXN0cnVjdCBudmttX2RldmljZSAqZGV2aWNl
ID0gbnZ4eF9kZXZpY2UoJmRybS0+Y2xpZW50LmRldmljZSk7CiAJc3RydWN0IG5vdXZlYXVfbWVt
ICptZW0gPSBub3V2ZWF1X21lbShyZWcpOworCXN0cnVjdCBub3V2ZWF1X2JvICpudmJvOworCWlu
dCByZXQ7CisKKwlpZiAocmVnLT5idXMuYmFzZSkKKwkJcmV0dXJuIDA7IC8qIGFscmVhZHkgbWFw
cGVkICovCiAKIAlyZWctPmJ1cy5hZGRyID0gTlVMTDsKIAlyZWctPmJ1cy5vZmZzZXQgPSAwOwog
CXJlZy0+YnVzLnNpemUgPSByZWctPm51bV9wYWdlcyA8PCBQQUdFX1NISUZUOwotCXJlZy0+YnVz
LmJhc2UgPSAwOwogCXJlZy0+YnVzLmlzX2lvbWVtID0gZmFsc2U7CiAJaWYgKCEobWFuLT5mbGFn
cyAmIFRUTV9NRU1UWVBFX0ZMQUdfTUFQUEFCTEUpKQogCQlyZXR1cm4gLUVJTlZBTDsKKworCW11
dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworcmV0cnk6CiAJc3dpdGNoIChy
ZWctPm1lbV90eXBlKSB7CiAJY2FzZSBUVE1fUExfU1lTVEVNOgogCQkvKiBTeXN0ZW0gbWVtb3J5
ICovCi0JCXJldHVybiAwOworCQlyZXQgPSAwOworCQlnb3RvIG91dDsKIAljYXNlIFRUTV9QTF9U
VDoKICNpZiBJU19FTkFCTEVEKENPTkZJR19BR1ApCiAJCWlmIChkcm0tPmFncC5icmlkZ2UpIHsK
QEAgLTE0NjgsNyArMTUyMiw2IEBAIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0
dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKIAkJCX0gYXJnczsK
IAkJCXU2NCBoYW5kbGUsIGxlbmd0aDsKIAkJCXUzMiBhcmdjID0gMDsKLQkJCWludCByZXQ7CiAK
IAkJCXN3aXRjaCAobWVtLT5tZW0ub2JqZWN0Lm9jbGFzcykgewogCQkJY2FzZSBOVklGX0NMQVNT
X01FTV9OVjUwOgpAQCAtMTQ5MiwzOCArMTU0NSw0NSBAQCBub3V2ZWF1X3R0bV9pb19tZW1fcmVz
ZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcp
CiAJCQlyZXQgPSBudmlmX29iamVjdF9tYXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QsCiAJCQkJ
CQkgICAgICZhcmdzLCBhcmdjLAogCQkJCQkJICAgICAmaGFuZGxlLCAmbGVuZ3RoKTsKLQkJCWlm
IChyZXQgIT0gMSkKLQkJCQlyZXR1cm4gcmV0ID8gcmV0IDogLUVJTlZBTDsKKwkJCWlmIChyZXQg
IT0gMSkgeworCQkJCXJldCA9IHJldCA/IHJldCA6IC1FSU5WQUw7CisJCQkJZ290byBvdXQ7CisJ
CQl9CisJCQlyZXQgPSAwOwogCiAJCQlyZWctPmJ1cy5iYXNlID0gMDsKIAkJCXJlZy0+YnVzLm9m
ZnNldCA9IGhhbmRsZTsKIAkJfQogCQlicmVhazsKIAlkZWZhdWx0OgotCQlyZXR1cm4gLUVJTlZB
TDsKKwkJcmV0ID0gLUVJTlZBTDsKIAl9Ci0JcmV0dXJuIDA7CisKK291dDoKKwlpZiAocmV0ID09
IC1FQUdBSU4pIHsKKwkJbnZibyA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmZHJtLT50dG0u
aW9fcmVzZXJ2ZV9scnUsCisJCQkJCQl0eXBlb2YoKm52Ym8pLAorCQkJCQkJaW9fcmVzZXJ2ZV9s
cnUpOworCQlpZiAobnZibykgeworCQkJbGlzdF9kZWxfaW5pdCgmbnZiby0+aW9fcmVzZXJ2ZV9s
cnUpOworCQkJdHRtX2JvX3VubWFwX3ZpcnR1YWwoJm52Ym8tPmJvKTsKKwkJCW5vdXZlYXVfdHRt
X2lvX21lbV9mcmVlX2xvY2tlZChkcm0sICZudmJvLT5iby5tZW0pOworCQkJZ290byByZXRyeTsK
KwkJfQorCisJfQorCW11dGV4X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7CisJ
cmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHZvaWQKIG5vdXZlYXVfdHRtX2lvX21lbV9mcmVlKHN0
cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKIHsKIAlz
dHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfYmRldihiZGV2KTsKLQlzdHJ1Y3Qgbm91
dmVhdV9tZW0gKm1lbSA9IG5vdXZlYXVfbWVtKHJlZyk7CiAKLQlpZiAoZHJtLT5jbGllbnQubWVt
LT5vY2xhc3MgPj0gTlZJRl9DTEFTU19NRU1fTlY1MCkgewotCQlzd2l0Y2ggKHJlZy0+bWVtX3R5
cGUpIHsKLQkJY2FzZSBUVE1fUExfVFQ6Ci0JCQlpZiAobWVtLT5raW5kKQotCQkJCW52aWZfb2Jq
ZWN0X3VubWFwX2hhbmRsZSgmbWVtLT5tZW0ub2JqZWN0KTsKLQkJCWJyZWFrOwotCQljYXNlIFRU
TV9QTF9WUkFNOgotCQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3Qp
OwotCQkJYnJlYWs7Ci0JCWRlZmF1bHQ6Ci0JCQlicmVhazsKLQkJfQotCX0KKwltdXRleF9sb2Nr
KCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKKwlub3V2ZWF1X3R0bV9pb19tZW1fZnJlZV9s
b2NrZWQoZHJtLCByZWcpOworCW11dGV4X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRl
eCk7CiB9CiAKIHN0YXRpYyBpbnQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfYm8uaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uaAppbmRl
eCA2MjkzMGQ4MzRmYmEuLmI4YTE3YmMxOWQ3YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvbm91dmVhdV9iby5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfYm8uaApAQCAtMTcsNiArMTcsNyBAQCBzdHJ1Y3Qgbm91dmVhdV9ibyB7CiAJYm9vbCBmb3Jj
ZV9jb2hlcmVudDsKIAlzdHJ1Y3QgdHRtX2JvX2ttYXBfb2JqIGttYXA7CiAJc3RydWN0IGxpc3Rf
aGVhZCBoZWFkOworCXN0cnVjdCBsaXN0X2hlYWQgaW9fcmVzZXJ2ZV9scnU7CiAKIAkvKiBwcm90
ZWN0ZWQgYnkgdHRtX2JvX3Jlc2VydmUoKSAqLwogCXN0cnVjdCBkcm1fZmlsZSAqcmVzZXJ2ZWRf
Ynk7CkBAIC05Miw2ICs5Myw4IEBAIGludCAgbm91dmVhdV9ib192YWxpZGF0ZShzdHJ1Y3Qgbm91
dmVhdV9ibyAqLCBib29sIGludGVycnVwdGlibGUsCiAJCQkgYm9vbCBub193YWl0X2dwdSk7CiB2
b2lkIG5vdXZlYXVfYm9fc3luY19mb3JfZGV2aWNlKHN0cnVjdCBub3V2ZWF1X2JvICpudmJvKTsK
IHZvaWQgbm91dmVhdV9ib19zeW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8pOwor
dm9pZCBub3V2ZWF1X2JvX2FkZF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmpl
Y3QgKmJvKTsKK3ZvaWQgbm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibyk7CiAKIC8qIFRPRE86IHN1Ym1pdCBlcXVpdmFsZW50IHRvIFRUTSBn
ZW5lcmljIEFQSSB1cHN0cmVhbT8gKi8KIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2lvbWVtICoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmggYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oCmluZGV4IDcwZjM0Y2FjYzU1Mi4uMDYwZTJh
YjFmZDk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKQEAgLTE1OCw2ICsx
NTgsOCBAQCBzdHJ1Y3Qgbm91dmVhdV9kcm0gewogCQlpbnQgdHlwZV92cmFtOwogCQlpbnQgdHlw
ZV9ob3N0WzJdOwogCQlpbnQgdHlwZV9uY29oWzJdOworCQlzdHJ1Y3QgbXV0ZXggaW9fcmVzZXJ2
ZV9tdXRleDsKKwkJc3RydWN0IGxpc3RfaGVhZCBpb19yZXNlcnZlX2xydTsKIAl9IHR0bTsKIAog
CS8qIEdFTSBpbnRlcmZhY2Ugc3VwcG9ydCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvbm91dmVhdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
dHRtLmMKaW5kZXggZjBkYWY5NThlMDNhLi43Zjg0OTUwNjZlOGIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV90dG0uYwpAQCAtMTYyLDEzICsxNjIsNTEgQEAgY29uc3Qgc3RydWN0IHR0
bV9tZW1fdHlwZV9tYW5hZ2VyX2Z1bmMgbnYwNF9nYXJ0X21hbmFnZXIgPSB7CiAJLmRlYnVnID0g
bm91dmVhdV9tYW5hZ2VyX2RlYnVnCiB9OwogCitzdGF0aWMgdm1fZmF1bHRfdCBub3V2ZWF1X3R0
bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKK3sKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Qg
KnZtYSA9IHZtZi0+dm1hOworCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZt
X3ByaXZhdGVfZGF0YTsKKwlwZ3Byb3RfdCBwcm90OworCXZtX2ZhdWx0X3QgcmV0OworCisJcmV0
ID0gdHRtX2JvX3ZtX3Jlc2VydmUoYm8sIHZtZik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsK
KworCW5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KGJvKTsKKworCXByb3QgPSB2bV9nZXRf
cGFnZV9wcm90KHZtYS0+dm1fZmxhZ3MpOworCXJldCA9IHR0bV9ib192bV9mYXVsdF9yZXNlcnZl
ZCh2bWYsIHByb3QsIFRUTV9CT19WTV9OVU1fUFJFRkFVTFQpOworCWlmIChyZXQgPT0gVk1fRkFV
TFRfUkVUUlkgJiYgISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQorCQly
ZXR1cm4gcmV0OworCisJbm91dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUoYm8pOworCisJZG1h
X3Jlc3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGlj
IHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBub3V2ZWF1X3R0bV92bV9vcHMgPSB7CisJLmZh
dWx0ID0gbm91dmVhdV90dG1fZmF1bHQsCisJLm9wZW4gPSB0dG1fYm9fdm1fb3BlbiwKKwkuY2xv
c2UgPSB0dG1fYm9fdm1fY2xvc2UsCisJLmFjY2VzcyA9IHR0bV9ib192bV9hY2Nlc3MKK307CisK
IGludAogbm91dmVhdV90dG1fbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFf
c3RydWN0ICp2bWEpCiB7CiAJc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2
YXRlX2RhdGE7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2RybShmaWxlX3By
aXYtPm1pbm9yLT5kZXYpOworCWludCByZXQ7CiAKLQlyZXR1cm4gdHRtX2JvX21tYXAoZmlscCwg
dm1hLCAmZHJtLT50dG0uYmRldik7CisJcmV0ID0gdHRtX2JvX21tYXAoZmlscCwgdm1hLCAmZHJt
LT50dG0uYmRldik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXZtYS0+dm1fb3BzID0g
Jm5vdXZlYXVfdHRtX3ZtX29wczsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludApAQCAtMjcy
LDYgKzMxMCw5IEBAIG5vdXZlYXVfdHRtX2luaXQoc3RydWN0IG5vdXZlYXVfZHJtICpkcm0pCiAJ
CXJldHVybiByZXQ7CiAJfQogCisJbXV0ZXhfaW5pdCgmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRl
eCk7CisJSU5JVF9MSVNUX0hFQUQoJmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1KTsKKwogCU5WX0lO
Rk8oZHJtLCAiVlJBTTogJWQgTWlCXG4iLCAodTMyKShkcm0tPmdlbS52cmFtX2F2YWlsYWJsZSA+
PiAyMCkpOwogCU5WX0lORk8oZHJtLCAiR0FSVDogJWQgTWlCXG4iLCAodTMyKShkcm0tPmdlbS5n
YXJ0X2F2YWlsYWJsZSA+PiAyMCkpOwogCXJldHVybiAwOwotLSAKMi4xNC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBs
aXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
