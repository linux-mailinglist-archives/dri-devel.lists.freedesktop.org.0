Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C9D4E36F7DF
	for <lists+dri-devel@lfdr.de>; Fri, 30 Apr 2021 11:25:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C7A486F517;
	Fri, 30 Apr 2021 09:25:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x633.google.com (mail-ej1-x633.google.com
 [IPv6:2a00:1450:4864:20::633])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1AF496F50C
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 09:25:17 +0000 (UTC)
Received: by mail-ej1-x633.google.com with SMTP id r9so104225096ejj.3
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 02:25:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=09FzZUp/FDpa+6m0of7/xNo4usnS7yLTYPpVTfDsqOI=;
 b=gJJMhpEyjzRUplgHrMN6TRPqhFKkPW37uEfkqPHyathzKdQg2gg1hS062EzjiUNmFv
 iHDcCQaUEyjyp7Mw364FCI9/VRiAMoeDBuvB8RHvMTjRb4AdaSpnACooX/Ro2MYoQPax
 xzX7NVuXFngkNP6vThnvgg5aY5oEaWA74+DKj4AOhLLpkBL9yRPHBgK9qPzIHmO6/gNq
 eJX1bo/UdNjjYfwOSWw8s5ALC/Wa9p/VCgvzR8+ZRQUaKGmMMiVbsfGmZje2G7Aku7Zc
 HkT7UPFs2OAU9MxCY+drxi6vyG/JgLf537+muo6UX5j/DHxFX6qGEbKCV9SgEIsCCaly
 3Tyg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=09FzZUp/FDpa+6m0of7/xNo4usnS7yLTYPpVTfDsqOI=;
 b=jo5G1NU6egPPREvXG6lV7UUt0NkWetRlQKNJwrcOWl7t4QiTYIDAEvnPGR8YtEbv+4
 wjyynE6GA5djT4V0OLyDrRyEPCdwmRQzT1WWjDRqlMCVqw3SS7h4kt7yHIsgxhCuppCT
 uqeQkzn8l4C+T3jWs3JKzSeqwzy2lXin+qL8rDR7WfMo1XoXJZtpkv9LGRKJkb7PcK4G
 0DuuyGRioQ16kUp+L5aKvls9iOz4NWCRUTAmw19ZsPeXCetZw3HfjLPqEZLxPdKOtebs
 5rz4XyNNrTKgSjS98oQX53nSQv8q0YOC/yOgyLlbUpGebml0QT7zvAkb+pSIRz/5AVsD
 8kwA==
X-Gm-Message-State: AOAM531ubPl5GYRAX+9fZaBHPRIliMXeEd+MWtV4wAAind5P9klxyOKt
 M/ASmEpggXPQgfmVYICRzHionNW6ieY=
X-Google-Smtp-Source: ABdhPJyXpqej8xCzZsVSeJw8aQwxDcZsNPAHFF1okBPljJfXLsSEguHIKIO34AK1SX9IlUJ7WNNnRQ==
X-Received: by 2002:a17:906:3458:: with SMTP id
 d24mr3393331ejb.54.1619774715754; 
 Fri, 30 Apr 2021 02:25:15 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:d08c:9633:b7a2:37e2])
 by smtp.gmail.com with ESMTPSA id h23sm1550959ejx.90.2021.04.30.02.25.15
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 30 Apr 2021 02:25:15 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 09/13] drm/amdgpu: switch the GTT backend to self alloc
Date: Fri, 30 Apr 2021 11:25:04 +0200
Message-Id: <20210430092508.60710-9-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210430092508.60710-1-christian.koenig@amd.com>
References: <20210430092508.60710-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@ffwll.ch, matthew.william.auld@gmail.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2ltaWxhciB0byB0aGUgVFRNIHJhbmdlIG1hbmFnZXIuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3Rp
YW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2d0dF9tZ3IuYyB8IDM2ICsrKysrKysrKysrKystLS0tLS0tLQog
MSBmaWxlIGNoYW5nZWQsIDIyIGluc2VydGlvbnMoKyksIDE0IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9ndHRfbWdyLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ3R0X21nci5jCmluZGV4IDU1Y2E4MDEzMzQx
MS4uMmU3ZGZmZDM2MTRkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZ3R0X21nci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9n
dHRfbWdyLmMKQEAgLTIyLDExICsyMiwxMyBAQAogICogQXV0aG9yczogQ2hyaXN0aWFuIEvDtm5p
ZwogICovCiAKKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9yYW5nZV9tYW5hZ2VyLmg+CisKICNpbmNs
dWRlICJhbWRncHUuaCIKIAogc3RydWN0IGFtZGdwdV9ndHRfbm9kZSB7Ci0Jc3RydWN0IGRybV9t
bV9ub2RlIG5vZGU7CiAJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICp0Ym87CisJc3RydWN0IHR0
bV9yYW5nZV9tZ3Jfbm9kZSBiYXNlOwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgYW1kZ3B1
X2d0dF9tZ3IgKgpAQCAtMzgsNyArNDAsOCBAQCB0b19ndHRfbWdyKHN0cnVjdCB0dG1fcmVzb3Vy
Y2VfbWFuYWdlciAqbWFuKQogc3RhdGljIGlubGluZSBzdHJ1Y3QgYW1kZ3B1X2d0dF9ub2RlICoK
IHRvX2FtZGdwdV9ndHRfbm9kZShzdHJ1Y3QgdHRtX3Jlc291cmNlICpyZXMpCiB7Ci0JcmV0dXJu
IGNvbnRhaW5lcl9vZihyZXMtPm1tX25vZGUsIHN0cnVjdCBhbWRncHVfZ3R0X25vZGUsIG5vZGUp
OworCXJldHVybiBjb250YWluZXJfb2YocmVzLT5tbV9ub2RlLCBzdHJ1Y3QgYW1kZ3B1X2d0dF9u
b2RlLAorCQkJICAgIGJhc2UubW1fbm9kZXNbMF0pOwogfQogCiAvKioKQEAgLTk3LDcgKzEwMCw3
IEBAIGJvb2wgYW1kZ3B1X2d0dF9tZ3JfaGFzX2dhcnRfYWRkcihzdHJ1Y3QgdHRtX3Jlc291cmNl
ICptZW0pCiB7CiAJc3RydWN0IGFtZGdwdV9ndHRfbm9kZSAqbm9kZSA9IHRvX2FtZGdwdV9ndHRf
bm9kZShtZW0pOwogCi0JcmV0dXJuIGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbm9kZS0+bm9kZSk7
CisJcmV0dXJuIGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbm9kZS0+YmFzZS5tbV9ub2Rlc1swXSk7
CiB9CiAKIC8qKgpAQCAtMTI4LDE2ICsxMzEsMTkgQEAgc3RhdGljIGludCBhbWRncHVfZ3R0X21n
cl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCiAJYXRvbWljNjRfc3ViKG1l
bS0+bnVtX3BhZ2VzLCAmbWdyLT5hdmFpbGFibGUpOwogCXNwaW5fdW5sb2NrKCZtZ3ItPmxvY2sp
OwogCi0Jbm9kZSA9IGt6YWxsb2Moc2l6ZW9mKCpub2RlKSwgR0ZQX0tFUk5FTCk7CisJbm9kZSA9
IGt6YWxsb2Moc3RydWN0X3NpemUobm9kZSwgYmFzZS5tbV9ub2RlcywgMSksIEdGUF9LRVJORUwp
OwogCWlmICghbm9kZSkgewogCQlyID0gLUVOT01FTTsKIAkJZ290byBlcnJfb3V0OwogCX0KIAog
CW5vZGUtPnRibyA9IHRibzsKKwl0dG1fcmVzb3VyY2VfaW5pdCh0Ym8sIHBsYWNlLCAmbm9kZS0+
YmFzZS5iYXNlKTsKKwogCWlmIChwbGFjZS0+bHBmbikgewogCQlzcGluX2xvY2soJm1nci0+bG9j
ayk7Ci0JCXIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJm1nci0+bW0sICZub2RlLT5u
b2RlLAorCQlyID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZtZ3ItPm1tLAorCQkJCQkJ
Jm5vZGUtPmJhc2UubW1fbm9kZXNbMF0sCiAJCQkJCQltZW0tPm51bV9wYWdlcywKIAkJCQkJCXRi
by0+cGFnZV9hbGlnbm1lbnQsIDAsCiAJCQkJCQlwbGFjZS0+ZnBmbiwgcGxhY2UtPmxwZm4sCkBA
IC0xNDYsMTQgKzE1MiwxNCBAQCBzdGF0aWMgaW50IGFtZGdwdV9ndHRfbWdyX25ldyhzdHJ1Y3Qg
dHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbiwKIAkJaWYgKHVubGlrZWx5KHIpKQogCQkJZ290byBl
cnJfZnJlZTsKIAotCQltZW0tPnN0YXJ0ID0gbm9kZS0+bm9kZS5zdGFydDsKKwkJbWVtLT5zdGFy
dCA9IG5vZGUtPmJhc2UubW1fbm9kZXNbMF0uc3RhcnQ7CiAJfSBlbHNlIHsKLQkJbm9kZS0+bm9k
ZS5zdGFydCA9IDA7Ci0JCW5vZGUtPm5vZGUuc2l6ZSA9IG1lbS0+bnVtX3BhZ2VzOworCQlub2Rl
LT5iYXNlLm1tX25vZGVzWzBdLnN0YXJ0ID0gMDsKKwkJbm9kZS0+YmFzZS5tbV9ub2Rlc1swXS5z
aXplID0gbWVtLT5udW1fcGFnZXM7CiAJCW1lbS0+c3RhcnQgPSBBTURHUFVfQk9fSU5WQUxJRF9P
RkZTRVQ7CiAJfQogCi0JbWVtLT5tbV9ub2RlID0gJm5vZGUtPm5vZGU7CisJbWVtLT5tbV9ub2Rl
ID0gJm5vZGUtPmJhc2UubW1fbm9kZXNbMF07CiAJcmV0dXJuIDA7CiAKIGVycl9mcmVlOgpAQCAt
MTc2LDE1ICsxODIsMTcgQEAgc3RhdGljIGludCBhbWRncHVfZ3R0X21ncl9uZXcoc3RydWN0IHR0
bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCiBzdGF0aWMgdm9pZCBhbWRncHVfZ3R0X21ncl9kZWwo
c3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCiAJCQkgICAgICAgc3RydWN0IHR0bV9y
ZXNvdXJjZSAqbWVtKQogewotCXN0cnVjdCBhbWRncHVfZ3R0X25vZGUgKm5vZGUgPSB0b19hbWRn
cHVfZ3R0X25vZGUobWVtKTsKIAlzdHJ1Y3QgYW1kZ3B1X2d0dF9tZ3IgKm1nciA9IHRvX2d0dF9t
Z3IobWFuKTsKKwlzdHJ1Y3QgYW1kZ3B1X2d0dF9ub2RlICpub2RlOwogCi0JaWYgKCFub2RlKQor
CWlmICghbWVtLT5tbV9ub2RlKQogCQlyZXR1cm47CiAKKwlub2RlID0gdG9fYW1kZ3B1X2d0dF9u
b2RlKG1lbSk7CisKIAlzcGluX2xvY2soJm1nci0+bG9jayk7Ci0JaWYgKGRybV9tbV9ub2RlX2Fs
bG9jYXRlZCgmbm9kZS0+bm9kZSkpCi0JCWRybV9tbV9yZW1vdmVfbm9kZSgmbm9kZS0+bm9kZSk7
CisJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbm9kZS0+YmFzZS5tbV9ub2Rlc1swXSkpCisJ
CWRybV9tbV9yZW1vdmVfbm9kZSgmbm9kZS0+YmFzZS5tbV9ub2Rlc1swXSk7CiAJc3Bpbl91bmxv
Y2soJm1nci0+bG9jayk7CiAJYXRvbWljNjRfYWRkKG1lbS0+bnVtX3BhZ2VzLCAmbWdyLT5hdmFp
bGFibGUpOwogCkBAIC0yMjIsNyArMjMwLDcgQEAgaW50IGFtZGdwdV9ndHRfbWdyX3JlY292ZXIo
c3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4pCiAKIAlzcGluX2xvY2soJm1nci0+bG9j
ayk7CiAJZHJtX21tX2Zvcl9lYWNoX25vZGUobW1fbm9kZSwgJm1nci0+bW0pIHsKLQkJbm9kZSA9
IGNvbnRhaW5lcl9vZihtbV9ub2RlLCBzdHJ1Y3QgYW1kZ3B1X2d0dF9ub2RlLCBub2RlKTsKKwkJ
bm9kZSA9IGNvbnRhaW5lcl9vZihtbV9ub2RlLCB0eXBlb2YoKm5vZGUpLCBiYXNlLm1tX25vZGVz
WzBdKTsKIAkJciA9IGFtZGdwdV90dG1fcmVjb3Zlcl9nYXJ0KG5vZGUtPnRibyk7CiAJCWlmIChy
KQogCQkJYnJlYWs7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbAo=
