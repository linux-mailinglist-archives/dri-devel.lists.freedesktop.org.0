Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CB283BBA86
	for <lists+dri-devel@lfdr.de>; Mon, 23 Sep 2019 19:28:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2F00A6E985;
	Mon, 23 Sep 2019 17:28:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 12E196E985
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Sep 2019 17:28:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 2D916B655;
 Mon, 23 Sep 2019 17:28:01 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@linux.ie, daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org,
 yc_chen@aspeedtech.com, corbet@lwn.net
Subject: [PATCH v2 12/12] drm/mgag200: Allocate cursor BOs at high end of
 video memory
Date: Mon, 23 Sep 2019 19:27:53 +0200
Message-Id: <20190923172753.26593-13-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190923172753.26593-1-tzimmermann@suse.de>
References: <20190923172753.26593-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 linux-doc@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QnkgcHV0dGluZyBjdXJzb3IgQk9zIGF0IHRoZSBoaWdoIGVuZCBvZiB0aGUgdmlkZW8gbWVtb3J5
LCB3ZSBjYW4gYXZvaWQKbWVtb3J5IGZyYWdtZW50YXRpb24uIFN0YXJ0aW5nIGF0IHRoZSBsb3cg
ZW5kLCBjb250aWd1b3VzIHZpZGVvIG1lbW9yeSBpcwphdmFpbGFibGUgZm9yIGZyYW1lYnVmZmVy
cy4KClRoZSBwYXRjaCBhbHNvIHNpbXBsaWZpZXMgdGhlIGJ1ZmZlciBzd2FwcGluZyBhbmQgYWxp
Z25zIGl0IHdpdGggdGhlCmFzdCBkcml2ZXIuIElmIHRoZXJlIGFyZSBtb3JlIGRyaXZlcnMgd2l0
aCBzaW1pbGFyIHJlcXVpcmVtZW50cywgdGhlCmNvZGUgY291bGQgYmUgbW92ZWQgaW50byBhIHNo
YXJlZCBwbGFjZS4KClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFu
bkBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29yLmMg
fCA5NCArKysrKysrKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21n
YWcyMDBfZHJ2LmggICAgfCAxMiArLS0KIDIgZmlsZXMgY2hhbmdlZCwgNTIgaW5zZXJ0aW9ucygr
KSwgNTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAv
bWdhZzIwMF9jdXJzb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29y
LmMKaW5kZXggN2Y0OGFiZjgwYTZhLi5kNjVlZTk0ZDU0MGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21n
YWcyMDAvbWdhZzIwMF9jdXJzb3IuYwpAQCAtMTIxLDM5ICsxMjEsMjUgQEAgc3RhdGljIGludCBt
Z2FnMjAwX3Nob3dfY3Vyc29yKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2LCB2b2lkICpzcmMsCiAJ
CQkgICAgICAgdW5zaWduZWQgaW50IHdpZHRoLCB1bnNpZ25lZCBpbnQgaGVpZ2h0KQogewogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBtZGV2LT5kZXY7Ci0Jc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKnBpeGVsc18xID0gbWRldi0+Y3Vyc29yLnBpeGVsc18xOwotCXN0cnVjdCBkcm1fZ2Vt
X3ZyYW1fb2JqZWN0ICpwaXhlbHNfMiA9IG1kZXYtPmN1cnNvci5waXhlbHNfMjsKLQlzdHJ1Y3Qg
ZHJtX2dlbV92cmFtX29iamVjdCAqcGl4ZWxzX2N1cnJlbnQgPSBtZGV2LT5jdXJzb3IucGl4ZWxz
X2N1cnJlbnQ7Ci0Jc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKnBpeGVsc19uZXh0OworCXN0
cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CiAJdm9pZCAqZHN0OwogCXM2NCBvZmY7CiAJ
aW50IHJldDsKIAotCWlmICghcGl4ZWxzXzEgfHwgIXBpeGVsc18yKSB7CisJZ2JvID0gbWRldi0+
Y3Vyc29yLmdib1ttZGV2LT5jdXJzb3IubmV4dF9pbmRleF07CisJaWYgKCFnYm8pIHsKIAkJV1JF
RzgoTUdBX0NVUlBPU1hMLCAwKTsKIAkJV1JFRzgoTUdBX0NVUlBPU1hILCAwKTsKIAkJcmV0dXJu
IC1FTk9UU1VQUDsgLyogRGlkbid0IGFsbG9jYXRlIHNwYWNlIGZvciBjdXJzb3JzICovCiAJfQot
Ci0JaWYgKFdBUk5fT04ocGl4ZWxzX2N1cnJlbnQgJiYKLQkJICAgIHBpeGVsc18xICE9IHBpeGVs
c19jdXJyZW50ICYmCi0JCSAgICBwaXhlbHNfMiAhPSBwaXhlbHNfY3VycmVudCkpIHsKLQkJcmV0
dXJuIC1FTk9UU1VQUDsgLyogaW5jb25zaXN0ZW50IHN0YXRlICovCi0JfQotCi0JaWYgKHBpeGVs
c19jdXJyZW50ID09IHBpeGVsc18xKQotCQlwaXhlbHNfbmV4dCA9IHBpeGVsc18yOwotCWVsc2UK
LQkJcGl4ZWxzX25leHQgPSBwaXhlbHNfMTsKLQotCWRzdCA9IGRybV9nZW1fdnJhbV92bWFwKHBp
eGVsc19uZXh0KTsKKwlkc3QgPSBkcm1fZ2VtX3ZyYW1fdm1hcChnYm8pOwogCWlmIChJU19FUlIo
ZHN0KSkgewogCQlyZXQgPSBQVFJfRVJSKGRzdCk7CiAJCWRldl9lcnIoJmRldi0+cGRldi0+ZGV2
LAogCQkJImZhaWxlZCB0byBtYXAgY3Vyc29yIHVwZGF0ZXM6ICVkXG4iLCByZXQpOwogCQlyZXR1
cm4gcmV0OwogCX0KLQlvZmYgPSBkcm1fZ2VtX3ZyYW1fb2Zmc2V0KHBpeGVsc19uZXh0KTsKKwlv
ZmYgPSBkcm1fZ2VtX3ZyYW1fb2Zmc2V0KGdibyk7CiAJaWYgKG9mZiA8IDApIHsKIAkJcmV0ID0g
KGludClvZmY7CiAJCWRldl9lcnIoJmRldi0+cGRldi0+ZGV2LApAQCAtMTY5LDE2ICsxNTUsMTUg
QEAgc3RhdGljIGludCBtZ2FnMjAwX3Nob3dfY3Vyc29yKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2
LCB2b2lkICpzcmMsCiAJLyogQWRqdXN0IGN1cnNvciBjb250cm9sIHJlZ2lzdGVyIHRvIHR1cm4g
b24gdGhlIGN1cnNvciAqLwogCVdSRUdfREFDKE1HQTEwNjRfQ1VSU09SX0NUTCwgNCk7IC8qIDE2
LWNvbG91ciBwYWxsZXRpemVkIGN1cnNvciBtb2RlICovCiAKLQlpZiAocGl4ZWxzX2N1cnJlbnQp
Ci0JCWRybV9nZW1fdnJhbV91bnBpbihwaXhlbHNfY3VycmVudCk7Ci0JbWRldi0+Y3Vyc29yLnBp
eGVsc19jdXJyZW50ID0gcGl4ZWxzX25leHQ7CisJZHJtX2dlbV92cmFtX3Z1bm1hcChnYm8sIGRz
dCk7CiAKLQlkcm1fZ2VtX3ZyYW1fdnVubWFwKHBpeGVsc19uZXh0LCBkc3QpOworCSsrbWRldi0+
Y3Vyc29yLm5leHRfaW5kZXg7CisJbWRldi0+Y3Vyc29yLm5leHRfaW5kZXggJT0gQVJSQVlfU0la
RShtZGV2LT5jdXJzb3IuZ2JvKTsKIAogCXJldHVybiAwOwogCiBlcnJfZHJtX2dlbV92cmFtX3Z1
bm1hcDoKLQlkcm1fZ2VtX3ZyYW1fdnVubWFwKHBpeGVsc19uZXh0LCBkc3QpOworCWRybV9nZW1f
dnJhbV92dW5tYXAoZ2JvLCBkc3QpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE5MCw5ICsxNzUs
NiBAQCBzdGF0aWMgdm9pZCBtZ2FnMjAwX2hpZGVfY3Vyc29yKHN0cnVjdCBtZ2FfZGV2aWNlICpt
ZGV2KQogewogCVdSRUc4KE1HQV9DVVJQT1NYTCwgMCk7CiAJV1JFRzgoTUdBX0NVUlBPU1hILCAw
KTsKLQlpZiAobWRldi0+Y3Vyc29yLnBpeGVsc19jdXJyZW50KQotCQlkcm1fZ2VtX3ZyYW1fdW5w
aW4obWRldi0+Y3Vyc29yLnBpeGVsc19jdXJyZW50KTsKLQltZGV2LT5jdXJzb3IucGl4ZWxzX2N1
cnJlbnQgPSBOVUxMOwogfQogCiBzdGF0aWMgdm9pZCBtZ2FnMjAwX21vdmVfY3Vyc29yKHN0cnVj
dCBtZ2FfZGV2aWNlICptZGV2LCBpbnQgeCwgaW50IHkpCkBAIC0yMTYsMjcgKzE5OCwzMiBAQCBz
dGF0aWMgdm9pZCBtZ2FnMjAwX21vdmVfY3Vyc29yKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2LCBp
bnQgeCwgaW50IHkpCiBpbnQgbWdhZzIwMF9jdXJzb3JfaW5pdChzdHJ1Y3QgbWdhX2RldmljZSAq
bWRldikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gbWRldi0+ZGV2OworCXNpemVfdCBu
Y3Vyc29ycyA9IEFSUkFZX1NJWkUobWRldi0+Y3Vyc29yLmdibyk7CiAJc2l6ZV90IHNpemU7CisJ
aW50IHJldDsKKwlzaXplX3QgaTsKKwlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvOwog
CiAJc2l6ZSA9IHJvdW5kdXAoNjQgKiA0OCwgUEFHRV9TSVpFKTsKLQlpZiAoc2l6ZSAqIDIgPiBt
ZGV2LT52cmFtX2ZiX2F2YWlsYWJsZSkKKwlpZiAoc2l6ZSAqIG5jdXJzb3JzID4gbWRldi0+dnJh
bV9mYl9hdmFpbGFibGUpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JLyoKLQkgKiBNYWtlIHNtYWxs
IGJ1ZmZlcnMgdG8gc3RvcmUgYSBoYXJkd2FyZSBjdXJzb3IgKGRvdWJsZQotCSAqIGJ1ZmZlcmVk
IGljb24gdXBkYXRlcykKLQkgKi8KLQltZGV2LT5jdXJzb3IucGl4ZWxzXzEgPSBkcm1fZ2VtX3Zy
YW1fY3JlYXRlKGRldiwgJmRldi0+dnJhbV9tbS0+YmRldiwKLQkJCQkJCSAgICBzaXplLCAwLCAw
KTsKLQltZGV2LT5jdXJzb3IucGl4ZWxzXzIgPSBkcm1fZ2VtX3ZyYW1fY3JlYXRlKGRldiwgJmRl
di0+dnJhbV9tbS0+YmRldiwKLQkJCQkJCSAgICBzaXplLCAwLCAwKTsKLQlpZiAoSVNfRVJSKG1k
ZXYtPmN1cnNvci5waXhlbHNfMikgfHwgSVNfRVJSKG1kZXYtPmN1cnNvci5waXhlbHNfMSkpIHsK
LQkJbWRldi0+Y3Vyc29yLnBpeGVsc18xID0gTlVMTDsKLQkJbWRldi0+Y3Vyc29yLnBpeGVsc18y
ID0gTlVMTDsKLQkJZGV2X3dhcm4oJmRldi0+cGRldi0+ZGV2LAotCQkJIkNvdWxkIG5vdCBhbGxv
Y2F0ZSBzcGFjZSBmb3IgY3Vyc29ycy4gTm90IGRvaW5nIGhhcmR3YXJlIGN1cnNvcnMuXG4iKTsK
Kwlmb3IgKGkgPSAwOyBpIDwgbmN1cnNvcnM7ICsraSkgeworCQlnYm8gPSBkcm1fZ2VtX3ZyYW1f
Y3JlYXRlKGRldiwgJmRldi0+dnJhbV9tbS0+YmRldiwKKwkJCQkJICBzaXplLCAwLCBmYWxzZSk7
CisJCWlmIChJU19FUlIoZ2JvKSkgeworCQkJcmV0ID0gUFRSX0VSUihnYm8pOworCQkJZ290byBl
cnJfZHJtX2dlbV92cmFtX3B1dDsKKwkJfQorCQlyZXQgPSBkcm1fZ2VtX3ZyYW1fcGluKGdibywg
RFJNX0dFTV9WUkFNX1BMX0ZMQUdfVlJBTSB8CisJCQkJCSAgICBEUk1fR0VNX1ZSQU1fUExfRkxB
R19UT1BET1dOKTsKKwkJaWYgKHJldCkgeworCQkJZHJtX2dlbV92cmFtX3B1dChnYm8pOworCQkJ
Z290byBlcnJfZHJtX2dlbV92cmFtX3B1dDsKKwkJfQorCisJCW1kZXYtPmN1cnNvci5nYm9baV0g
PSBnYm87CiAJfQotCW1kZXYtPmN1cnNvci5waXhlbHNfY3VycmVudCA9IE5VTEw7CiAKIAkvKgog
CSAqIEF0IHRoZSBoaWdoIGVuZCBvZiB2aWRlbyBtZW1vcnksIHdlIHJlc2VydmUgc3BhY2UgZm9y
CkBAIC0yNDQsMTMgKzIzMSwzMiBAQCBpbnQgbWdhZzIwMF9jdXJzb3JfaW5pdChzdHJ1Y3QgbWdh
X2RldmljZSAqbWRldikKIAkgKiBhIGRvdWJsZS1idWZmZXJlZCBpbWFnZSBvZiB0aGUgY3VycmVu
dCBjdXJzb3IuIEhlbmNlLCBpdCdzCiAJICogbm90IGF2YWlsYWJsZSBmb3IgZnJhbWVidWZmZXJz
LgogCSAqLwotCW1kZXYtPnZyYW1fZmJfYXZhaWxhYmxlIC09IDIgKiBzaXplOworCW1kZXYtPnZy
YW1fZmJfYXZhaWxhYmxlIC09IG5jdXJzb3JzICogc2l6ZTsKIAogCXJldHVybiAwOworCitlcnJf
ZHJtX2dlbV92cmFtX3B1dDoKKwl3aGlsZSAoaSkgeworCQktLWk7CisJCWdibyA9IG1kZXYtPmN1
cnNvci5nYm9baV07CisJCWRybV9nZW1fdnJhbV91bnBpbihnYm8pOworCQlkcm1fZ2VtX3ZyYW1f
cHV0KGdibyk7CisJCW1kZXYtPmN1cnNvci5nYm9baV0gPSBOVUxMOworCX0KKwlyZXR1cm4gcmV0
OwogfQogCiB2b2lkIG1nYWcyMDBfY3Vyc29yX2Zpbmkoc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYp
Ci17IH0KK3sKKwlzaXplX3QgaTsKKwlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvOwor
CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUobWRldi0+Y3Vyc29yLmdibyk7ICsraSkgewor
CQlnYm8gPSBtZGV2LT5jdXJzb3IuZ2JvW2ldOworCQlkcm1fZ2VtX3ZyYW1fdW5waW4oZ2JvKTsK
KwkJZHJtX2dlbV92cmFtX3B1dChnYm8pOworCX0KK30KIAogaW50IG1nYWcyMDBfY3J0Y19jdXJz
b3Jfc2V0KHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYs
CiAJCQkgICAgdWludDMyX3QgaGFuZGxlLCB1aW50MzJfdCB3aWR0aCwgdWludDMyX3QgaGVpZ2h0
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfZHJ2LmgKaW5kZXggNWQ2Y2ZjODg2OTdhLi4w
ZWE5YTUyNWU1N2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBf
ZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9kcnYuaApAQCAtMTI5
LDE2ICsxMjksOCBAQCBzdHJ1Y3QgbWdhX2Nvbm5lY3RvciB7CiB9OwogCiBzdHJ1Y3QgbWdhX2N1
cnNvciB7Ci0JLyoKLQkgICBXZSBoYXZlIHRvIGhhdmUgMiBidWZmZXJzIGZvciB0aGUgY3Vyc29y
IHRvIGF2b2lkIG9jY2FzaW9uYWwKLQkgICBjb3JydXB0aW9uIHdoaWxlIHN3aXRjaGluZyBjdXJz
b3IgaWNvbnMuCi0JICAgSWYgZWl0aGVyIG9mIHRoZXNlIGlzIE5VTEwsIHRoZW4gZG9uJ3QgZG8g
aGFyZHdhcmUgY3Vyc29ycywgYW5kCi0JICAgZmFsbCBiYWNrIHRvIHNvZnR3YXJlLgotCSovCi0J
c3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKnBpeGVsc18xOwotCXN0cnVjdCBkcm1fZ2VtX3Zy
YW1fb2JqZWN0ICpwaXhlbHNfMjsKLQkvKiBUaGUgY3VycmVudGx5IGRpc3BsYXllZCBpY29uLCB0
aGlzIHBvaW50cyB0byBvbmUgb2YgcGl4ZWxzXzEsIG9yIHBpeGVsc18yICovCi0Jc3RydWN0IGRy
bV9nZW1fdnJhbV9vYmplY3QgKnBpeGVsc19jdXJyZW50OworCXN0cnVjdCBkcm1fZ2VtX3ZyYW1f
b2JqZWN0ICpnYm9bMl07CisJdW5zaWduZWQgaW50IG5leHRfaW5kZXg7CiB9OwogCiBzdHJ1Y3Qg
bWdhX21jIHsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
