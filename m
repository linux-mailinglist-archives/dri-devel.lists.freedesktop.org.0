Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 81D8BFC118
	for <lists+dri-devel@lfdr.de>; Thu, 14 Nov 2019 09:08:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 76E8D6E21D;
	Thu, 14 Nov 2019 08:07:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay6-d.mail.gandi.net (relay6-d.mail.gandi.net
 [217.70.183.198])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 24C706ECC2
 for <dri-devel@lists.freedesktop.org>; Wed, 13 Nov 2019 10:04:25 +0000 (UTC)
X-Originating-IP: 93.34.114.233
Received: from uno.lan (93-34-114-233.ip49.fastwebnet.it [93.34.114.233])
 (Authenticated sender: jacopo@jmondi.org)
 by relay6-d.mail.gandi.net (Postfix) with ESMTPSA id 689C3C0010;
 Wed, 13 Nov 2019 10:04:22 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli+renesas@fpond.eu
Subject: [PATCH v7 5/7] drm: rcar-du: crtc: Control CMM operations
Date: Wed, 13 Nov 2019 11:05:54 +0100
Message-Id: <20191113100556.15616-6-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191113100556.15616-1-jacopo+renesas@jmondi.org>
References: <20191113100556.15616-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Thu, 14 Nov 2019 08:07:51 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: airlied@linux.ie, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, linux-renesas-soc@vger.kernel.org,
 Jacopo Mondi <jacopo+renesas@jmondi.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW1wbGVtZW50IENNTSBoYW5kbGluZyBpbiB0aGUgY3J0YyBiZWdpbiBhbmQgZW5hYmxlIGF0b21p
YyBjYWxsYmFja3MsCmFuZCBlbmFibGUgQ01NIHVuaXQgdGhyb3VnaCB0aGUgRGlzcGxheSBFeHRl
bnNpb25hbCBGdW5jdGlvbnMKcmVnaXN0ZXIgYXQgZ3JvdXAgc2V0dXAgdGltZS4KClJldmlld2Vk
LWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+
ClJldmlld2VkLWJ5OiBLaWVyYW4gQmluZ2hhbSA8a2llcmFuLmJpbmdoYW0rcmVuZXNhc0BpZGVh
c29uYm9hcmQuY29tPgpTaWduZWQtb2ZmLWJ5OiBKYWNvcG8gTW9uZGkgPGphY29wbytyZW5lc2Fz
QGptb25kaS5vcmc+CgotLS0KdjYgLT4gdjcKLSBEcm9wIGNoZWNrIGZvciBDTU0gaW4gcmNhcl9k
dV9jbW1fY2hlY2sgYXMgaWYgdGhlIGdhbW1hX3RhYmxlIHByb3BlcnR5IGlzCiAgYXZhaWxhYmxl
LCBhIENNTSB1bml0IGZvciB0aGlzIENSVEMgd2FzIHJlZ2lzdGVyZWQKLSBBZGQgVE9ETyBub3Rl
IHRvIGludmVzdGlnYXRlIGhvdyB0aGUgYWN0aXZhdGlvbiBvcmRlciBvZiBDTU0gYW5kIENSVEMK
ICBpbXBhY3Qgb24gdGhlIGZpcnN0IGRpc3BsYXllZCBmcmFtCi0tLQotLS0KIGRyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5jICB8IDYxICsrKysrKysrKysrKysrKysrKysrKysr
KysKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfZ3JvdXAuYyB8IDEwICsrKysKIGRy
aXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfcmVncy5oICB8ICA1ICsrCiAzIGZpbGVzIGNo
YW5nZWQsIDc2IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2R1X2NydGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0
Yy5jCmluZGV4IDIzZjFkNmNjMTcxOS4uM2YwZjE2OTQ2ZjQyIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2R1X2NydGMuYwpAQCAtMjEsNiArMjEsNyBAQAogI2luY2x1ZGUgPGRybS9kcm1f
cGxhbmVfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KIAorI2luY2x1ZGUg
InJjYXJfY21tLmgiCiAjaW5jbHVkZSAicmNhcl9kdV9jcnRjLmgiCiAjaW5jbHVkZSAicmNhcl9k
dV9kcnYuaCIKICNpbmNsdWRlICJyY2FyX2R1X2VuY29kZXIuaCIKQEAgLTQ3NCw2ICs0NzUsNDUg
QEAgc3RhdGljIHZvaWQgcmNhcl9kdV9jcnRjX3dhaXRfcGFnZV9mbGlwKHN0cnVjdCByY2FyX2R1
X2NydGMgKnJjcnRjKQogCXJjYXJfZHVfY3J0Y19maW5pc2hfcGFnZV9mbGlwKHJjcnRjKTsKIH0K
IAorLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIENvbG9yIE1hbmFnZW1lbnQgTW9kdWxlIChD
TU0pCisgKi8KKworc3RhdGljIGludCByY2FyX2R1X2NtbV9jaGVjayhzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCisJCQkgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpkcm1fbHV0ID0gc3RhdGUtPmdhbW1hX2x1dDsKKwlzdHJ1Y3Qg
cmNhcl9kdV9jcnRjICpyY3J0YyA9IHRvX3JjYXJfY3J0YyhjcnRjKTsKKwlzdHJ1Y3QgZGV2aWNl
ICpkZXYgPSByY3J0Yy0+ZGV2LT5kZXY7CisKKwlpZiAoIWRybV9sdXQpCisJCXJldHVybiAwOwor
CisJLyogV2Ugb25seSBhY2NlcHQgZnVsbHkgcG9wdWxhdGVkIExVVCB0YWJsZXMuICovCisJaWYg
KGRybV9jb2xvcl9sdXRfc2l6ZShkcm1fbHV0KSAhPSBDTTJfTFVUX1NJWkUpIHsKKwkJZGV2X2Vy
cihkZXYsICJpbnZhbGlkIGdhbW1hIGx1dCBzaXplOiAlbHUgYnl0ZXNcbiIsCisJCQlkcm1fbHV0
LT5sZW5ndGgpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIHZvaWQgcmNhcl9kdV9jbW1fc2V0dXAoc3RydWN0IGRybV9jcnRjICpjcnRjKQoreworCXN0
cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZHJtX2x1dCA9IGNydGMtPnN0YXRlLT5nYW1tYV9sdXQ7
CisJc3RydWN0IHJjYXJfZHVfY3J0YyAqcmNydGMgPSB0b19yY2FyX2NydGMoY3J0Yyk7CisJc3Ry
dWN0IHJjYXJfY21tX2NvbmZpZyBjbW1fY29uZmlnID0ge307CisKKwlpZiAoIXJjcnRjLT5jbW0p
CisJCXJldHVybjsKKworCWlmIChkcm1fbHV0KQorCQljbW1fY29uZmlnLmx1dC50YWJsZSA9IChz
dHJ1Y3QgZHJtX2NvbG9yX2x1dCAqKWRybV9sdXQtPmRhdGE7CisKKwlyY2FyX2NtbV9zZXR1cChy
Y3J0Yy0+Y21tLCAmY21tX2NvbmZpZyk7Cit9CisKIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAg
KiBTdGFydC9TdG9wIGFuZCBTdXNwZW5kL1Jlc3VtZQogICovCkBAIC02MTksNiArNjU5LDkgQEAg
c3RhdGljIHZvaWQgcmNhcl9kdV9jcnRjX3N0b3Aoc3RydWN0IHJjYXJfZHVfY3J0YyAqcmNydGMp
CiAJaWYgKHJjYXJfZHVfaGFzKHJjcnRjLT5kZXYsIFJDQVJfRFVfRkVBVFVSRV9WU1AxX1NPVVJD
RSkpCiAJCXJjYXJfZHVfdnNwX2Rpc2FibGUocmNydGMpOwogCisJaWYgKHJjcnRjLT5jbW0pCisJ
CXJjYXJfY21tX2Rpc2FibGUocmNydGMtPmNtbSk7CisKIAkvKgogCSAqIFNlbGVjdCBzd2l0Y2gg
c3luYyBtb2RlLiBUaGlzIHN0b3BzIGRpc3BsYXkgb3BlcmF0aW9uIGFuZCBjb25maWd1cmVzCiAJ
ICogdGhlIEhTWU5DIGFuZCBWU1lOQyBzaWduYWxzIGFzIGlucHV0cy4KQEAgLTY0Miw2ICs2ODUs
MTEgQEAgc3RhdGljIGludCByY2FyX2R1X2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIHsKIAlzdHJ1Y3QgcmNhcl9kdV9jcnRjX3N0YXRlICpyc3RhdGUgPSB0b19yY2Fy
X2NydGNfc3RhdGUoc3RhdGUpOwogCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwlpbnQg
cmV0OworCisJcmV0ID0gcmNhcl9kdV9jbW1fY2hlY2soY3J0Yywgc3RhdGUpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CiAKIAkvKiBTdG9yZSB0aGUgcm91dGVzIGZyb20gdGhlIENSVEMgb3V0
cHV0IHRvIHRoZSBEVSBvdXRwdXRzLiAqLwogCXJzdGF0ZS0+b3V0cHV0cyA9IDA7CkBAIC02Njcs
NiArNzE1LDggQEAgc3RhdGljIHZvaWQgcmNhcl9kdV9jcnRjX2F0b21pY19lbmFibGUoc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCXN0cnVjdCByY2FyX2R1X2NydGNfc3RhdGUgKnJzdGF0ZSA9IHRv
X3JjYXJfY3J0Y19zdGF0ZShjcnRjLT5zdGF0ZSk7CiAJc3RydWN0IHJjYXJfZHVfZGV2aWNlICpy
Y2R1ID0gcmNydGMtPmRldjsKIAorCWlmIChyY3J0Yy0+Y21tKQorCQlyY2FyX2NtbV9lbmFibGUo
cmNydGMtPmNtbSk7CiAJcmNhcl9kdV9jcnRjX2dldChyY3J0Yyk7CiAKIAkvKgpAQCAtNjg2LDYg
KzczNiwxMyBAQCBzdGF0aWMgdm9pZCByY2FyX2R1X2NydGNfYXRvbWljX2VuYWJsZShzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMsCiAJfQogCiAJcmNhcl9kdV9jcnRjX3N0YXJ0KHJjcnRjKTsKKworCS8q
CisJICogVE9ETzogVGhlIGNoaXAgbWFudWFsIGluZGljYXRlcyB0aGF0IENNTSB0YWJsZXMgc2hv
dWxkIGJlIHdyaXR0ZW4KKwkgKiBhZnRlciB0aGUgRFUgY2hhbm5lbCBoYXMgYmVlbiBhY3RpdmF0
ZWQuIEludmVzdGlnYXRlIHRoZSBpbXBhY3QKKwkgKiBvZiB0aGlzIHJlc3RyaWN0aW9uIG9uIHRo
ZSBmaXJzdCBkaXNwbGF5ZWQgZnJhbWUuCisJICovCisJcmNhcl9kdV9jbW1fc2V0dXAoY3J0Yyk7
CiB9CiAKIHN0YXRpYyB2b2lkIHJjYXJfZHVfY3J0Y19hdG9taWNfZGlzYWJsZShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCkBAIC03MzksNiArNzk2LDEwIEBAIHN0YXRpYyB2b2lkIHJjYXJfZHVfY3J0
Y19hdG9taWNfYmVnaW4oc3RydWN0IGRybV9jcnRjICpjcnRjLAogCSAqLwogCXJjYXJfZHVfY3J0
Y19nZXQocmNydGMpOwogCisJLyogSWYgdGhlIGFjdGl2ZSBzdGF0ZSBjaGFuZ2VkLCB3ZSBsZXQg
LmF0b21pY19lbmFibGUgaGFuZGxlIENNTS4gKi8KKwlpZiAoY3J0Yy0+c3RhdGUtPmNvbG9yX21n
bXRfY2hhbmdlZCAmJiAhY3J0Yy0+c3RhdGUtPmFjdGl2ZV9jaGFuZ2VkKQorCQlyY2FyX2R1X2Nt
bV9zZXR1cChjcnRjKTsKKwogCWlmIChyY2FyX2R1X2hhcyhyY3J0Yy0+ZGV2LCBSQ0FSX0RVX0ZF
QVRVUkVfVlNQMV9TT1VSQ0UpKQogCQlyY2FyX2R1X3ZzcF9hdG9taWNfYmVnaW4ocmNydGMpOwog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9ncm91cC5jIGIv
ZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9ncm91cC5jCmluZGV4IDllZWU0Nzk2OWU3
Ny4uODhhNzgzY2ViM2U5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2Fy
X2R1X2dyb3VwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9ncm91cC5j
CkBAIC0xMzUsNiArMTM1LDcgQEAgc3RhdGljIHZvaWQgcmNhcl9kdV9ncm91cF9zZXR1cF9kaWRz
cihzdHJ1Y3QgcmNhcl9kdV9ncm91cCAqcmdycCkKIHN0YXRpYyB2b2lkIHJjYXJfZHVfZ3JvdXBf
c2V0dXAoc3RydWN0IHJjYXJfZHVfZ3JvdXAgKnJncnApCiB7CiAJc3RydWN0IHJjYXJfZHVfZGV2
aWNlICpyY2R1ID0gcmdycC0+ZGV2OworCXUzMiBkZWZyNyA9IERFRlI3X0NPREU7CiAKIAkvKiBF
bmFibGUgZXh0ZW5kZWQgZmVhdHVyZXMgKi8KIAlyY2FyX2R1X2dyb3VwX3dyaXRlKHJncnAsIERF
RlIsIERFRlJfQ09ERSB8IERFRlJfREVGRSk7CkBAIC0xNDcsNiArMTQ4LDE1IEBAIHN0YXRpYyB2
b2lkIHJjYXJfZHVfZ3JvdXBfc2V0dXAoc3RydWN0IHJjYXJfZHVfZ3JvdXAgKnJncnApCiAKIAly
Y2FyX2R1X2dyb3VwX3NldHVwX3BpbnMocmdycCk7CiAKKwkvKgorCSAqIFRPRE86IEhhbmRsZSBy
b3V0aW5nIG9mIHRoZSBEVSBvdXRwdXQgdG8gQ01NIGR5bmFtaWNhbGx5LCBhcyB3ZQorCSAqIHNo
b3VsZCBieXBhc3MgQ01NIGNvbXBsZXRlbHkgd2hlbiBubyBjb2xvciBtYW5hZ2VtZW50IGZlYXR1
cmUgaXMKKwkgKiB1c2VkLgorCSAqLworCWRlZnI3IHw9IChyZ3JwLT5jbW1zX21hc2sgJiBCSVQo
MSkgPyBERUZSN19DTU1FMSA6IDApIHwKKwkJIChyZ3JwLT5jbW1zX21hc2sgJiBCSVQoMCkgPyBE
RUZSN19DTU1FMCA6IDApOworCXJjYXJfZHVfZ3JvdXBfd3JpdGUocmdycCwgREVGUjcsIGRlZnI3
KTsKKwogCWlmIChyY2R1LT5pbmZvLT5nZW4gPj0gMikgewogCQlyY2FyX2R1X2dyb3VwX3NldHVw
X2RlZnI4KHJncnApOwogCQlyY2FyX2R1X2dyb3VwX3NldHVwX2RpZHNyKHJncnApOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9yZWdzLmggYi9kcml2ZXJzL2dw
dS9kcm0vcmNhci1kdS9yY2FyX2R1X3JlZ3MuaAppbmRleCBiYzg3ZjA4MGIxNzAuLmZiOTk2NDk0
OTM2OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9yZWdzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9yZWdzLmgKQEAgLTE5Nyw2ICsx
OTcsMTEgQEAKICNkZWZpbmUgREVGUjZfTUxPUzEJCSgxIDw8IDIpCiAjZGVmaW5lIERFRlI2X0RF
RkFVTFQJCShERUZSNl9DT0RFIHwgREVGUjZfVENORTEpCiAKKyNkZWZpbmUgREVGUjcJCQkweDAw
MGVjCisjZGVmaW5lIERFRlI3X0NPREUJCSgweDc3NzkgPDwgMTYpCisjZGVmaW5lIERFRlI3X0NN
TUUxCQlCSVQoNikKKyNkZWZpbmUgREVGUjdfQ01NRTAJCUJJVCg0KQorCiAvKiAtLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQogICogUjhBNzc5MC1vbmx5IENvbnRyb2wgUmVnaXN0ZXJzCiAgKi8KLS0gCjIu
MjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
