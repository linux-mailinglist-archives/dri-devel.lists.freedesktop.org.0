Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3FD889BA2E
	for <lists+dri-devel@lfdr.de>; Sat, 24 Aug 2019 03:34:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E664D6ED83;
	Sat, 24 Aug 2019 01:34:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-vk1-xa4a.google.com (mail-vk1-xa4a.google.com
 [IPv6:2607:f8b0:4864:20::a4a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F23F6ED7D
 for <dri-devel@lists.freedesktop.org>; Sat, 24 Aug 2019 01:34:42 +0000 (UTC)
Received: by mail-vk1-xa4a.google.com with SMTP id y187so4537513vkf.2
 for <dri-devel@lists.freedesktop.org>; Fri, 23 Aug 2019 18:34:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=RifjM7AFe+KSz2XcO4TD4pb0cSS8vin5KNixVI+2wx8=;
 b=d33aR6xoX2LoFZnzhsH1QT9MjBxGevdcf4ndx3TLH42zZwrJKdwuFKETmrlKQifTkF
 fljHFN9YA+DPxE8430L/FgrvzkqeE2CL4jVr3/eHKriJziUq/mFip3QB62GWgPYwBLQS
 n1syg7KHDKHk3egnB4D3DFTLUeSiRAGvtRkWlsCXOnCeJrTHj9cdGMroj2Yi1rOo7o2F
 9Ifsv+6k0Y5OvrPW9qCULFZo5DMM+RvA2pnUOTDeooIn5a7coeRr05WV2DX2nMhROq3X
 jnnBNpUgkiwywk/hOV9yVy1Z3P5auqQ2CwXiTeV2Jhc7+BzLAI/UtwjBRn6zqeRenXVl
 w3tQ==
X-Gm-Message-State: APjAAAUAkUYlj7m9NYB54xmR0z8TxmriUZpikP54Vb3ZO9VwjMH2fTzi
 Z6rHX94tXTIcZbyJugJ8sAz3vDdQGE2tjOav1I5Feg==
X-Google-Smtp-Source: APXvYqz41otA8JfMnFvwBJPY4x+fYFIyLonozQH5BjiONg6wKXaXp0qNGw1y926RjxcdpRkl18cx4CvxxlRZEazNaWp3yA==
X-Received: by 2002:a67:dd91:: with SMTP id i17mr4328349vsk.21.1566610481026; 
 Fri, 23 Aug 2019 18:34:41 -0700 (PDT)
Date: Fri, 23 Aug 2019 18:34:09 -0700
In-Reply-To: <20190824013425.175645-1-brendanhiggins@google.com>
Message-Id: <20190824013425.175645-3-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190824013425.175645-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.23.0.187.g17f5b7556c-goog
Subject: [PATCH v15 02/18] kunit: test: add test resource management API
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, jpoimboe@redhat.com, 
 keescook@google.com, kieran.bingham@ideasonboard.com, mcgrof@kernel.org, 
 peterz@infradead.org, robh@kernel.org, sboyd@kernel.org, shuah@kernel.org, 
 tytso@mit.edu, yamada.masahiro@socionext.com
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=RifjM7AFe+KSz2XcO4TD4pb0cSS8vin5KNixVI+2wx8=;
 b=jNvy/iphIgWz860NlUg4BCIE/zbVgdkhiejvhqfURS2zXfCCl4zU4NeMl4+/CNz4cx
 hQxSObm+0O2XRIl6r2M2cflv5VJEFa+lCZw+joSDPaclYQUP07IkEEtI0hOm7QCd2YAr
 pnakHUG/XMGsf4ponB5hXHDJjVxrpDHbVLB71KPtrikOWsIiVbL9igEVxXdjDY6KQYOw
 5452WZp3ZjlnrmtXvQsuZTsbVu8cqnIHh93E7WTpwCCKnO9nXQncfuulhX9qHEkEjZh6
 TCJu6avdxlICcVKlE8iVGOubIISqF7ssxdQ0rYZf6js5AB1DUlp6EUrPtPWap4NkSLMw
 kBoA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, kunit-dev@googlegroups.com,
 richard@nod.at, rdunlap@infradead.org, linux-kernel@vger.kernel.org,
 mpe@ellerman.id.au, linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIGEgY29tbW9uIEFQSSBmb3IgdGVzdCBtYW5hZ2VkIHJlc291cmNlcyBsaWtlIG1lbW9y
eSBhbmQgdGVzdApvYmplY3RzLiBBIGxvdCBvZiB0aW1lcyBhIHRlc3Qgd2lsbCB3YW50IHRvIHNl
dCB1cCBpbmZyYXN0cnVjdHVyZSB0byBiZQp1c2VkIGluIHRlc3QgY2FzZXM7IHRoaXMgY291bGQg
YmUgYW55dGhpbmcgZnJvbSBqdXN0IHdhbnRpbmcgdG8gYWxsb2NhdGUKc29tZSBtZW1vcnkgdG8g
c2V0dGluZyB1cCBhIGRyaXZlciBzdGFjazsgdGhpcyBkZWZpbmVzIGZhY2lsaXRpZXMgZm9yCmNy
ZWF0aW5nICJ0ZXN0IHJlc291cmNlcyIgd2hpY2ggYXJlIG1hbmFnZWQgYnkgdGhlIHRlc3QgaW5m
cmFzdHJ1Y3R1cmUKYW5kIGFyZSBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYXQgdGhlIGNvbmNs
dXNpb24gb2YgdGhlIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBCcmVuZGFuIEhpZ2dpbnMgPGJyZW5k
YW5oaWdnaW5zQGdvb2dsZS5jb20+ClJldmlld2VkLWJ5OiBHcmVnIEtyb2FoLUhhcnRtYW4gPGdy
ZWdraEBsaW51eGZvdW5kYXRpb24ub3JnPgpSZXZpZXdlZC1ieTogTG9nYW4gR3VudGhvcnBlIDxs
b2dhbmdAZGVsdGF0ZWUuY29tPgpSZXZpZXdlZC1ieTogU3RlcGhlbiBCb3lkIDxzYm95ZEBrZXJu
ZWwub3JnPgotLS0KIGluY2x1ZGUva3VuaXQvdGVzdC5oIHwgMTg3ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysKIGt1bml0L3Rlc3QuYyAgICAgICAgIHwgMTYzICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgMzUw
IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2t1bml0L3Rlc3QuaCBiL2luY2x1
ZGUva3VuaXQvdGVzdC5oCmluZGV4IGUzMGQxYmYyZmI2OC4uNjc4MWM3NTZmMTFiIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2t1bml0L3Rlc3QuaAorKysgYi9pbmNsdWRlL2t1bml0L3Rlc3QuaApAQCAt
OSw4ICs5LDcyIEBACiAjaWZuZGVmIF9LVU5JVF9URVNUX0gKICNkZWZpbmUgX0tVTklUX1RFU1Rf
SAogCisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAK
K3N0cnVjdCBrdW5pdF9yZXNvdXJjZTsKKwordHlwZWRlZiBpbnQgKCprdW5pdF9yZXNvdXJjZV9p
bml0X3QpKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqLCB2b2lkICopOwordHlwZWRlZiB2b2lkICgq
a3VuaXRfcmVzb3VyY2VfZnJlZV90KShzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKik7CisKKy8qKgor
ICogc3RydWN0IGt1bml0X3Jlc291cmNlIC0gcmVwcmVzZW50cyBhICp0ZXN0IG1hbmFnZWQgcmVz
b3VyY2UqCisgKiBAYWxsb2NhdGlvbjogZm9yIHRoZSB1c2VyIHRvIHN0b3JlIGFyYml0cmFyeSBk
YXRhLgorICogQGZyZWU6IGEgdXNlciBzdXBwbGllZCBmdW5jdGlvbiB0byBmcmVlIHRoZSByZXNv
dXJjZS4gUG9wdWxhdGVkIGJ5CisgKiBrdW5pdF9hbGxvY19yZXNvdXJjZSgpLgorICoKKyAqIFJl
cHJlc2VudHMgYSAqdGVzdCBtYW5hZ2VkIHJlc291cmNlKiwgYSByZXNvdXJjZSB3aGljaCB3aWxs
IGF1dG9tYXRpY2FsbHkgYmUKKyAqIGNsZWFuZWQgdXAgYXQgdGhlIGVuZCBvZiBhIHRlc3QgY2Fz
ZS4KKyAqCisgKiBFeGFtcGxlOgorICoKKyAqIC4uIGNvZGUtYmxvY2s6OiBjCisgKgorICoJc3Ry
dWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHsKKyAqCQlzaXplX3Qgc2l6ZTsKKyAqCQlnZnBfdCBn
ZnA7CisgKgl9OworICoKKyAqCXN0YXRpYyBpbnQga3VuaXRfa21hbGxvY19pbml0KHN0cnVjdCBr
dW5pdF9yZXNvdXJjZSAqcmVzLCB2b2lkICpjb250ZXh0KQorICoJeworICoJCXN0cnVjdCBrdW5p
dF9rbWFsbG9jX3BhcmFtcyAqcGFyYW1zID0gY29udGV4dDsKKyAqCQlyZXMtPmFsbG9jYXRpb24g
PSBrbWFsbG9jKHBhcmFtcy0+c2l6ZSwgcGFyYW1zLT5nZnApOworICoKKyAqCQlpZiAoIXJlcy0+
YWxsb2NhdGlvbikKKyAqCQkJcmV0dXJuIC1FTk9NRU07CisgKgorICoJCXJldHVybiAwOworICoJ
fQorICoKKyAqCXN0YXRpYyB2b2lkIGt1bml0X2ttYWxsb2NfZnJlZShzdHJ1Y3Qga3VuaXRfcmVz
b3VyY2UgKnJlcykKKyAqCXsKKyAqCQlrZnJlZShyZXMtPmFsbG9jYXRpb24pOworICoJfQorICoK
KyAqCXZvaWQgKmt1bml0X2ttYWxsb2Moc3RydWN0IGt1bml0ICp0ZXN0LCBzaXplX3Qgc2l6ZSwg
Z2ZwX3QgZ2ZwKQorICoJeworICoJCXN0cnVjdCBrdW5pdF9rbWFsbG9jX3BhcmFtcyBwYXJhbXM7
CisgKgkJc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXM7CisgKgorICoJCXBhcmFtcy5zaXplID0g
c2l6ZTsKKyAqCQlwYXJhbXMuZ2ZwID0gZ2ZwOworICoKKyAqCQlyZXMgPSBrdW5pdF9hbGxvY19y
ZXNvdXJjZSh0ZXN0LCBrdW5pdF9rbWFsbG9jX2luaXQsCisgKgkJCWt1bml0X2ttYWxsb2NfZnJl
ZSwgJnBhcmFtcyk7CisgKgkJaWYgKHJlcykKKyAqCQkJcmV0dXJuIHJlcy0+YWxsb2NhdGlvbjsK
KyAqCisgKgkJcmV0dXJuIE5VTEw7CisgKgl9CisgKi8KK3N0cnVjdCBrdW5pdF9yZXNvdXJjZSB7
CisJdm9pZCAqYWxsb2NhdGlvbjsKKwlrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZTsKKworCS8q
IHByaXZhdGU6IGludGVybmFsIHVzZSBvbmx5LiAqLworCXN0cnVjdCBsaXN0X2hlYWQgbm9kZTsK
K307CisKIHN0cnVjdCBrdW5pdDsKIAogLyoqCkBAIC0xMTQsNiArMTc4LDEzIEBAIHN0cnVjdCBr
dW5pdCB7CiAJICogd2l0aCB0aGUgdGVzdCBjYXNlIGhhdmUgdGVybWluYXRlZC4KIAkgKi8KIAli
b29sIHN1Y2Nlc3M7IC8qIFJlYWQgb25seSBhZnRlciB0ZXN0X2Nhc2UgZmluaXNoZXMhICovCisJ
c3BpbmxvY2tfdCBsb2NrOyAvKiBHdWFyZHMgYWxsIG11dGFibGUgdGVzdCBzdGF0ZS4gKi8KKwkv
KgorCSAqIEJlY2F1c2UgcmVzb3VyY2VzIGlzIGEgbGlzdCB0aGF0IG1heSBiZSB1cGRhdGVkIG11
bHRpcGxlIHRpbWVzICh3aXRoCisJICogbmV3IHJlc291cmNlcykgZnJvbSBhbnkgdGhyZWFkIGFz
c29jaWF0ZWQgd2l0aCBhIHRlc3QgY2FzZSwgd2UgbXVzdAorCSAqIHByb3RlY3QgaXQgd2l0aCBz
b21lIHR5cGUgb2YgbG9jay4KKwkgKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIHJlc291cmNlczsgLyog
UHJvdGVjdGVkIGJ5IGxvY2suICovCiB9OwogCiB2b2lkIGt1bml0X2luaXRfdGVzdChzdHJ1Y3Qg
a3VuaXQgKnRlc3QsIGNvbnN0IGNoYXIgKm5hbWUpOwpAQCAtMTQ3LDYgKzIxOCwxMjIgQEAgaW50
IGt1bml0X3J1bl90ZXN0cyhzdHJ1Y3Qga3VuaXRfc3VpdGUgKnN1aXRlKTsKIAl9CQkJCQkJCQkg
ICAgICAgXAogCWxhdGVfaW5pdGNhbGwoa3VuaXRfc3VpdGVfaW5pdCMjc3VpdGUpCiAKKy8qCisg
KiBMaWtlIGt1bml0X2FsbG9jX3Jlc291cmNlKCkgYmVsb3csIGJ1dCByZXR1cm5zIHRoZSBzdHJ1
Y3Qga3VuaXRfcmVzb3VyY2UKKyAqIG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZSBhbGxvY2F0aW9u
LiBUaGlzIGlzIG1vc3RseSBmb3IgdGVzdGluZyBwdXJwb3Nlcy4KKyAqLworc3RydWN0IGt1bml0
X3Jlc291cmNlICprdW5pdF9hbGxvY19hbmRfZ2V0X3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVz
dCwKKwkJCQkJCSAgICBrdW5pdF9yZXNvdXJjZV9pbml0X3QgaW5pdCwKKwkJCQkJCSAgICBrdW5p
dF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJCQkJCSAgICBnZnBfdCBpbnRlcm5hbF9nZnAsCisJ
CQkJCQkgICAgdm9pZCAqY29udGV4dCk7CisKKy8qKgorICoga3VuaXRfYWxsb2NfcmVzb3VyY2Uo
KSAtIEFsbG9jYXRlcyBhICp0ZXN0IG1hbmFnZWQgcmVzb3VyY2UqLgorICogQHRlc3Q6IFRoZSB0
ZXN0IGNvbnRleHQgb2JqZWN0LgorICogQGluaXQ6IGEgdXNlciBzdXBwbGllZCBmdW5jdGlvbiB0
byBpbml0aWFsaXplIHRoZSByZXNvdXJjZS4KKyAqIEBmcmVlOiBhIHVzZXIgc3VwcGxpZWQgZnVu
Y3Rpb24gdG8gZnJlZSB0aGUgcmVzb3VyY2UuCisgKiBAaW50ZXJuYWxfZ2ZwOiBnZnAgdG8gdXNl
IGZvciBpbnRlcm5hbCBhbGxvY2F0aW9ucywgaWYgdW5zdXJlLCB1c2UgR0ZQX0tFUk5FTAorICog
QGNvbnRleHQ6IGZvciB0aGUgdXNlciB0byBwYXNzIGluIGFyYml0cmFyeSBkYXRhIHRvIHRoZSBp
bml0IGZ1bmN0aW9uLgorICoKKyAqIEFsbG9jYXRlcyBhICp0ZXN0IG1hbmFnZWQgcmVzb3VyY2Uq
LCBhIHJlc291cmNlIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBiZQorICogY2xlYW5lZCB1cCBh
dCB0aGUgZW5kIG9mIGEgdGVzdCBjYXNlLiBTZWUgJnN0cnVjdCBrdW5pdF9yZXNvdXJjZSBmb3Ig
YW4KKyAqIGV4YW1wbGUuCisgKgorICogTk9URTogS1VuaXQgbmVlZHMgdG8gYWxsb2NhdGUgbWVt
b3J5IGZvciBlYWNoIGt1bml0X3Jlc291cmNlIG9iamVjdC4gWW91IG11c3QKKyAqIHNwZWNpZnkg
YW4gQGludGVybmFsX2dmcCB0aGF0IGlzIGNvbXBhdGlibGUgd2l0aCB0aGUgdXNlIGNvbnRleHQg
b2YgeW91cgorICogcmVzb3VyY2UuCisgKi8KK3N0YXRpYyBpbmxpbmUgdm9pZCAqa3VuaXRfYWxs
b2NfcmVzb3VyY2Uoc3RydWN0IGt1bml0ICp0ZXN0LAorCQkJCQkga3VuaXRfcmVzb3VyY2VfaW5p
dF90IGluaXQsCisJCQkJCSBrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJCQkJIGdmcF90
IGludGVybmFsX2dmcCwKKwkJCQkJIHZvaWQgKmNvbnRleHQpCit7CisJc3RydWN0IGt1bml0X3Jl
c291cmNlICpyZXM7CisKKwlyZXMgPSBrdW5pdF9hbGxvY19hbmRfZ2V0X3Jlc291cmNlKHRlc3Qs
IGluaXQsIGZyZWUsIGludGVybmFsX2dmcCwKKwkJCQkJICAgY29udGV4dCk7CisKKwlpZiAocmVz
KQorCQlyZXR1cm4gcmVzLT5hbGxvY2F0aW9uOworCisJcmV0dXJuIE5VTEw7Cit9CisKK3R5cGVk
ZWYgYm9vbCAoKmt1bml0X3Jlc291cmNlX21hdGNoX3QpKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJ
CQkgICAgICAgY29uc3Qgdm9pZCAqcmVzLAorCQkJCSAgICAgICB2b2lkICptYXRjaF9kYXRhKTsK
KworLyoqCisgKiBrdW5pdF9yZXNvdXJjZV9pbnN0YW5jZV9tYXRjaCgpIC0gTWF0Y2ggYSByZXNv
dXJjZSB3aXRoIHRoZSBzYW1lIGluc3RhbmNlLgorICogQHRlc3Q6IFRlc3QgY2FzZSB0byB3aGlj
aCB0aGUgcmVzb3VyY2UgYmVsb25ncy4KKyAqIEByZXM6IFRoZSBkYXRhIHN0b3JlZCBpbiBrdW5p
dF9yZXNvdXJjZS0+YWxsb2NhdGlvbi4KKyAqIEBtYXRjaF9kYXRhOiBUaGUgcmVzb3VyY2UgcG9p
bnRlciB0byBtYXRjaCBhZ2FpbnN0LgorICoKKyAqIEFuIGluc3RhbmNlIG9mIGt1bml0X3Jlc291
cmNlX21hdGNoX3QgdGhhdCBtYXRjaGVzIGEgcmVzb3VyY2Ugd2hvc2UKKyAqIGFsbG9jYXRpb24g
bWF0Y2hlcyBAbWF0Y2hfZGF0YS4KKyAqLworc3RhdGljIGlubGluZSBib29sIGt1bml0X3Jlc291
cmNlX2luc3RhbmNlX21hdGNoKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJCQkJCSBjb25zdCB2b2lk
ICpyZXMsCisJCQkJCQkgdm9pZCAqbWF0Y2hfZGF0YSkKK3sKKwlyZXR1cm4gcmVzID09IG1hdGNo
X2RhdGE7Cit9CisKKy8qKgorICoga3VuaXRfcmVzb3VyY2VfZGVzdHJveSgpIC0gRmluZCBhIGt1
bml0X3Jlc291cmNlIGFuZCBkZXN0cm95IGl0LgorICogQHRlc3Q6IFRlc3QgY2FzZSB0byB3aGlj
aCB0aGUgcmVzb3VyY2UgYmVsb25ncy4KKyAqIEBtYXRjaDogTWF0Y2ggZnVuY3Rpb24uIFJldHVy
bnMgd2hldGhlciBhIGdpdmVuIHJlc291cmNlIG1hdGNoZXMgQG1hdGNoX2RhdGEuCisgKiBAZnJl
ZTogTXVzdCBtYXRjaCBmcmVlIG9uIHRoZSBrdW5pdF9yZXNvdXJjZSB0byBmcmVlLgorICogQG1h
dGNoX2RhdGE6IERhdGEgcGFzc2VkIGludG8gQG1hdGNoLgorICoKKyAqIEZyZWUgdGhlIGxhdGVz
dCBrdW5pdF9yZXNvdXJjZSBvZiBAdGVzdCBmb3Igd2hpY2ggQGZyZWUgbWF0Y2hlcyB0aGUKKyAq
IGt1bml0X3Jlc291cmNlX2ZyZWVfdCBhc3NvY2lhdGVkIHdpdGggdGhlIHJlc291cmNlIGFuZCBm
b3Igd2hpY2ggQG1hdGNoCisgKiByZXR1cm5zIHRydWUuCisgKgorICogUkVUVVJOUzoKKyAqIDAg
aWYga3VuaXRfcmVzb3VyY2UgaXMgZm91bmQgYW5kIGZyZWVkLCAtRU5PRU5UIGlmIG5vdCBmb3Vu
ZC4KKyAqLworaW50IGt1bml0X3Jlc291cmNlX2Rlc3Ryb3koc3RydWN0IGt1bml0ICp0ZXN0LAor
CQkJICAga3VuaXRfcmVzb3VyY2VfbWF0Y2hfdCBtYXRjaCwKKwkJCSAgIGt1bml0X3Jlc291cmNl
X2ZyZWVfdCBmcmVlLAorCQkJICAgdm9pZCAqbWF0Y2hfZGF0YSk7CisKKy8qKgorICoga3VuaXRf
a21hbGxvYygpIC0gTGlrZSBrbWFsbG9jKCkgZXhjZXB0IHRoZSBhbGxvY2F0aW9uIGlzICp0ZXN0
IG1hbmFnZWQqLgorICogQHRlc3Q6IFRoZSB0ZXN0IGNvbnRleHQgb2JqZWN0LgorICogQHNpemU6
IFRoZSBzaXplIGluIGJ5dGVzIG9mIHRoZSBkZXNpcmVkIG1lbW9yeS4KKyAqIEBnZnA6IGZsYWdz
IHBhc3NlZCB0byB1bmRlcmx5aW5nIGttYWxsb2MoKS4KKyAqCisgKiBKdXN0IGxpa2UgYGttYWxs
b2MoLi4uKWAsIGV4Y2VwdCB0aGUgYWxsb2NhdGlvbiBpcyBtYW5hZ2VkIGJ5IHRoZSB0ZXN0IGNh
c2UKKyAqIGFuZCBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYWZ0ZXIgdGhlIHRlc3QgY2Fz
ZSBjb25jbHVkZXMuIFNlZSAmc3RydWN0CisgKiBrdW5pdF9yZXNvdXJjZSBmb3IgbW9yZSBpbmZv
cm1hdGlvbi4KKyAqLwordm9pZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNp
emVfdCBzaXplLCBnZnBfdCBnZnApOworCisvKioKKyAqIGt1bml0X2tmcmVlKCkgLSBMaWtlIGtm
cmVlIGV4Y2VwdCBmb3IgYWxsb2NhdGlvbnMgbWFuYWdlZCBieSBLVW5pdC4KKyAqIEB0ZXN0OiBU
aGUgdGVzdCBjYXNlIHRvIHdoaWNoIHRoZSByZXNvdXJjZSBiZWxvbmdzLgorICogQHB0cjogVGhl
IG1lbW9yeSBhbGxvY2F0aW9uIHRvIGZyZWUuCisgKi8KK3ZvaWQga3VuaXRfa2ZyZWUoc3RydWN0
IGt1bml0ICp0ZXN0LCBjb25zdCB2b2lkICpwdHIpOworCisvKioKKyAqIGt1bml0X2t6YWxsb2Mo
KSAtIEp1c3QgbGlrZSBrdW5pdF9rbWFsbG9jKCksIGJ1dCB6ZXJvZXMgdGhlIGFsbG9jYXRpb24u
CisgKiBAdGVzdDogVGhlIHRlc3QgY29udGV4dCBvYmplY3QuCisgKiBAc2l6ZTogVGhlIHNpemUg
aW4gYnl0ZXMgb2YgdGhlIGRlc2lyZWQgbWVtb3J5LgorICogQGdmcDogZmxhZ3MgcGFzc2VkIHRv
IHVuZGVybHlpbmcga21hbGxvYygpLgorICoKKyAqIFNlZSBremFsbG9jKCkgYW5kIGt1bml0X2tt
YWxsb2MoKSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KKyAqLworc3RhdGljIGlubGluZSB2b2lkICpr
dW5pdF9remFsbG9jKHN0cnVjdCBrdW5pdCAqdGVzdCwgc2l6ZV90IHNpemUsIGdmcF90IGdmcCkK
K3sKKwlyZXR1cm4ga3VuaXRfa21hbGxvYyh0ZXN0LCBzaXplLCBnZnAgfCBfX0dGUF9aRVJPKTsK
K30KKwordm9pZCBrdW5pdF9jbGVhbnVwKHN0cnVjdCBrdW5pdCAqdGVzdCk7CisKIHZvaWQgX19w
cmludGYoMywgNCkga3VuaXRfcHJpbnRrKGNvbnN0IGNoYXIgKmxldmVsLAogCQkJCSBjb25zdCBz
dHJ1Y3Qga3VuaXQgKnRlc3QsCiAJCQkJIGNvbnN0IGNoYXIgKmZtdCwgLi4uKTsKZGlmZiAtLWdp
dCBhL2t1bml0L3Rlc3QuYyBiL2t1bml0L3Rlc3QuYwppbmRleCBkM2RkYTM1OWY5OWIuLjY4YjEw
MzdhYjc0ZCAxMDA2NDQKLS0tIGEva3VuaXQvdGVzdC5jCisrKyBiL2t1bml0L3Rlc3QuYwpAQCAt
MTIyLDYgKzEyMiw4IEBAIHN0YXRpYyB2b2lkIGt1bml0X3ByaW50X3Rlc3RfY2FzZV9va19ub3Rf
b2soc3RydWN0IGt1bml0X2Nhc2UgKnRlc3RfY2FzZSwKIAogdm9pZCBrdW5pdF9pbml0X3Rlc3Qo
c3RydWN0IGt1bml0ICp0ZXN0LCBjb25zdCBjaGFyICpuYW1lKQogeworCXNwaW5fbG9ja19pbml0
KCZ0ZXN0LT5sb2NrKTsKKwlJTklUX0xJU1RfSEVBRCgmdGVzdC0+cmVzb3VyY2VzKTsKIAl0ZXN0
LT5uYW1lID0gbmFtZTsKIAl0ZXN0LT5zdWNjZXNzID0gdHJ1ZTsKIH0KQEAgLTE1Myw2ICsxNTUs
OCBAQCBzdGF0aWMgdm9pZCBrdW5pdF9ydW5fY2FzZShzdHJ1Y3Qga3VuaXRfc3VpdGUgKnN1aXRl
LAogCWlmIChzdWl0ZS0+ZXhpdCkKIAkJc3VpdGUtPmV4aXQoJnRlc3QpOwogCisJa3VuaXRfY2xl
YW51cCgmdGVzdCk7CisKIAl0ZXN0X2Nhc2UtPnN1Y2Nlc3MgPSB0ZXN0LnN1Y2Nlc3M7CiB9CiAK
QEAgLTE3Myw2ICsxNzcsMTY1IEBAIGludCBrdW5pdF9ydW5fdGVzdHMoc3RydWN0IGt1bml0X3N1
aXRlICpzdWl0ZSkKIAlyZXR1cm4gMDsKIH0KIAorc3RydWN0IGt1bml0X3Jlc291cmNlICprdW5p
dF9hbGxvY19hbmRfZ2V0X3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJCQkJCSAgICBr
dW5pdF9yZXNvdXJjZV9pbml0X3QgaW5pdCwKKwkJCQkJCSAgICBrdW5pdF9yZXNvdXJjZV9mcmVl
X3QgZnJlZSwKKwkJCQkJCSAgICBnZnBfdCBpbnRlcm5hbF9nZnAsCisJCQkJCQkgICAgdm9pZCAq
Y29udGV4dCkKK3sKKwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlczsKKwlpbnQgcmV0OworCisJ
cmVzID0ga3phbGxvYyhzaXplb2YoKnJlcyksIGludGVybmFsX2dmcCk7CisJaWYgKCFyZXMpCisJ
CXJldHVybiBOVUxMOworCisJcmV0ID0gaW5pdChyZXMsIGNvbnRleHQpOworCWlmIChyZXQpCisJ
CXJldHVybiBOVUxMOworCisJcmVzLT5mcmVlID0gZnJlZTsKKwlzcGluX2xvY2soJnRlc3QtPmxv
Y2spOworCWxpc3RfYWRkX3RhaWwoJnJlcy0+bm9kZSwgJnRlc3QtPnJlc291cmNlcyk7CisJc3Bp
bl91bmxvY2soJnRlc3QtPmxvY2spOworCisJcmV0dXJuIHJlczsKK30KKworc3RhdGljIHZvaWQg
a3VuaXRfcmVzb3VyY2VfZnJlZShzdHJ1Y3Qga3VuaXQgKnRlc3QsIHN0cnVjdCBrdW5pdF9yZXNv
dXJjZSAqcmVzKQoreworCXJlcy0+ZnJlZShyZXMpOworCWtmcmVlKHJlcyk7Cit9CisKK3N0YXRp
YyBzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKmt1bml0X3Jlc291cmNlX2ZpbmQoc3RydWN0IGt1bml0
ICp0ZXN0LAorCQkJCQkJICBrdW5pdF9yZXNvdXJjZV9tYXRjaF90IG1hdGNoLAorCQkJCQkJICBr
dW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZSwKKwkJCQkJCSAgdm9pZCAqbWF0Y2hfZGF0YSkKK3sK
KwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlc291cmNlOworCisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmdGVzdC0+bG9jayk7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVyc2UocmVzb3VyY2Us
ICZ0ZXN0LT5yZXNvdXJjZXMsIG5vZGUpIHsKKwkJaWYgKHJlc291cmNlLT5mcmVlICE9IGZyZWUp
CisJCQljb250aW51ZTsKKwkJaWYgKG1hdGNoKHRlc3QsIHJlc291cmNlLT5hbGxvY2F0aW9uLCBt
YXRjaF9kYXRhKSkKKwkJCXJldHVybiByZXNvdXJjZTsKKwl9CisKKwlyZXR1cm4gTlVMTDsKK30K
Kworc3RhdGljIHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqa3VuaXRfcmVzb3VyY2VfcmVtb3ZlKAor
CQlzdHJ1Y3Qga3VuaXQgKnRlc3QsCisJCWt1bml0X3Jlc291cmNlX21hdGNoX3QgbWF0Y2gsCisJ
CWt1bml0X3Jlc291cmNlX2ZyZWVfdCBmcmVlLAorCQl2b2lkICptYXRjaF9kYXRhKQoreworCXN0
cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzb3VyY2U7CisKKwlzcGluX2xvY2soJnRlc3QtPmxvY2sp
OworCXJlc291cmNlID0ga3VuaXRfcmVzb3VyY2VfZmluZCh0ZXN0LCBtYXRjaCwgZnJlZSwgbWF0
Y2hfZGF0YSk7CisJaWYgKHJlc291cmNlKQorCQlsaXN0X2RlbCgmcmVzb3VyY2UtPm5vZGUpOwor
CXNwaW5fdW5sb2NrKCZ0ZXN0LT5sb2NrKTsKKworCXJldHVybiByZXNvdXJjZTsKK30KKworaW50
IGt1bml0X3Jlc291cmNlX2Rlc3Ryb3koc3RydWN0IGt1bml0ICp0ZXN0LAorCQkJICAga3VuaXRf
cmVzb3VyY2VfbWF0Y2hfdCBtYXRjaCwKKwkJCSAgIGt1bml0X3Jlc291cmNlX2ZyZWVfdCBmcmVl
LAorCQkJICAgdm9pZCAqbWF0Y2hfZGF0YSkKK3sKKwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJl
c291cmNlOworCisJcmVzb3VyY2UgPSBrdW5pdF9yZXNvdXJjZV9yZW1vdmUodGVzdCwgbWF0Y2gs
IGZyZWUsIG1hdGNoX2RhdGEpOworCisJaWYgKCFyZXNvdXJjZSkKKwkJcmV0dXJuIC1FTk9FTlQ7
CisKKwlrdW5pdF9yZXNvdXJjZV9mcmVlKHRlc3QsIHJlc291cmNlKTsKKwlyZXR1cm4gMDsKK30K
Kworc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHsKKwlzaXplX3Qgc2l6ZTsKKwlnZnBfdCBn
ZnA7Cit9OworCitzdGF0aWMgaW50IGt1bml0X2ttYWxsb2NfaW5pdChzdHJ1Y3Qga3VuaXRfcmVz
b3VyY2UgKnJlcywgdm9pZCAqY29udGV4dCkKK3sKKwlzdHJ1Y3Qga3VuaXRfa21hbGxvY19wYXJh
bXMgKnBhcmFtcyA9IGNvbnRleHQ7CisKKwlyZXMtPmFsbG9jYXRpb24gPSBrbWFsbG9jKHBhcmFt
cy0+c2l6ZSwgcGFyYW1zLT5nZnApOworCWlmICghcmVzLT5hbGxvY2F0aW9uKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrdW5pdF9rbWFsbG9jX2Zy
ZWUoc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXMpCit7CisJa2ZyZWUocmVzLT5hbGxvY2F0aW9u
KTsKK30KKwordm9pZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNpemVfdCBz
aXplLCBnZnBfdCBnZnApCit7CisJc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHBhcmFtcyA9
IHsKKwkJLnNpemUgPSBzaXplLAorCQkuZ2ZwID0gZ2ZwCisJfTsKKworCXJldHVybiBrdW5pdF9h
bGxvY19yZXNvdXJjZSh0ZXN0LAorCQkJCSAgICBrdW5pdF9rbWFsbG9jX2luaXQsCisJCQkJICAg
IGt1bml0X2ttYWxsb2NfZnJlZSwKKwkJCQkgICAgZ2ZwLAorCQkJCSAgICAmcGFyYW1zKTsKK30K
Kwordm9pZCBrdW5pdF9rZnJlZShzdHJ1Y3Qga3VuaXQgKnRlc3QsIGNvbnN0IHZvaWQgKnB0cikK
K3sKKwlpbnQgcmM7CisKKwlyYyA9IGt1bml0X3Jlc291cmNlX2Rlc3Ryb3kodGVzdCwKKwkJCQkg
ICAga3VuaXRfcmVzb3VyY2VfaW5zdGFuY2VfbWF0Y2gsCisJCQkJICAgIGt1bml0X2ttYWxsb2Nf
ZnJlZSwKKwkJCQkgICAgKHZvaWQgKilwdHIpOworCisJV0FSTl9PTihyYyk7Cit9CisKK3ZvaWQg
a3VuaXRfY2xlYW51cChzdHJ1Y3Qga3VuaXQgKnRlc3QpCit7CisJc3RydWN0IGt1bml0X3Jlc291
cmNlICpyZXNvdXJjZTsKKworCS8qCisJICogdGVzdC0+cmVzb3VyY2VzIGlzIGEgc3RhY2sgLSBl
YWNoIGFsbG9jYXRpb24gbXVzdCBiZSBmcmVlZCBpbiB0aGUKKwkgKiByZXZlcnNlIG9yZGVyIGZy
b20gd2hpY2ggaXQgd2FzIGFkZGVkIHNpbmNlIG9uZSByZXNvdXJjZSBtYXkgZGVwZW5kCisJICog
b24gYW5vdGhlciBmb3IgaXRzIGVudGlyZSBsaWZldGltZS4KKwkgKiBBbHNvLCB3ZSBjYW5ub3Qg
dXNlIHRoZSBub3JtYWwgbGlzdF9mb3JfZWFjaCBjb25zdHJ1Y3RzLCBldmVuIHRoZQorCSAqIHNh
ZmUgb25lcyBiZWNhdXNlICphcmJpdHJhcnkqIG5vZGVzIG1heSBiZSBkZWxldGVkIHdoZW4KKwkg
KiBrdW5pdF9yZXNvdXJjZV9mcmVlIGlzIGNhbGxlZDsgdGhlIGxpc3RfZm9yX2VhY2hfc2FmZSB2
YXJpYW50cyBvbmx5CisJICogcHJvdGVjdCBhZ2FpbnN0IHRoZSBjdXJyZW50IG5vZGUgYmVpbmcg
ZGVsZXRlZCwgbm90IHRoZSBuZXh0LgorCSAqLworCXdoaWxlICh0cnVlKSB7CisJCXNwaW5fbG9j
aygmdGVzdC0+bG9jayk7CisJCWlmIChsaXN0X2VtcHR5KCZ0ZXN0LT5yZXNvdXJjZXMpKSB7CisJ
CQlzcGluX3VubG9jaygmdGVzdC0+bG9jayk7CisJCQlicmVhazsKKwkJfQorCQlyZXNvdXJjZSA9
IGxpc3RfbGFzdF9lbnRyeSgmdGVzdC0+cmVzb3VyY2VzLAorCQkJCQkgICBzdHJ1Y3Qga3VuaXRf
cmVzb3VyY2UsCisJCQkJCSAgIG5vZGUpOworCQlsaXN0X2RlbCgmcmVzb3VyY2UtPm5vZGUpOwor
CQlzcGluX3VubG9jaygmdGVzdC0+bG9jayk7CisKKwkJa3VuaXRfcmVzb3VyY2VfZnJlZSh0ZXN0
LCByZXNvdXJjZSk7CisJfQorfQorCiB2b2lkIGt1bml0X3ByaW50ayhjb25zdCBjaGFyICpsZXZl
bCwKIAkJICBjb25zdCBzdHJ1Y3Qga3VuaXQgKnRlc3QsCiAJCSAgY29uc3QgY2hhciAqZm10LCAu
Li4pCi0tIAoyLjIzLjAuMTg3LmcxN2Y1Yjc1NTZjLWdvb2cKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
