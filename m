Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D8BB23076DD
	for <lists+dri-devel@lfdr.de>; Thu, 28 Jan 2021 14:16:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1248F6E93E;
	Thu, 28 Jan 2021 13:16:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x631.google.com (mail-ej1-x631.google.com
 [IPv6:2a00:1450:4864:20::631])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A996B6E195
 for <dri-devel@lists.freedesktop.org>; Thu, 28 Jan 2021 13:16:08 +0000 (UTC)
Received: by mail-ej1-x631.google.com with SMTP id r12so7670784ejb.9
 for <dri-devel@lists.freedesktop.org>; Thu, 28 Jan 2021 05:16:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=gKSumBjTrRz8F7wzWa9DlfyTRiQtiPQThzb8xjkwsm8=;
 b=c+AeoNbUrz0vN/WIInmKAMjjKCQFGtTyyuW4hM4+NZQgvqKfKan+lkipSwvbFDGguQ
 9bvaYXaJL5S+Pf1ZD7VEZcRxWB3gMItcLRZKJVGmkKC98wdXpzvOdt6BxkXILSwH6Vei
 T7zhWVh2Tg1uRFCyFTZEcwJDg0ofN/esLC68IqFRdpjEwXDqHCIMMd16bF21rPCHXqGx
 gpNQIzZqQu9hoozpHzwB03v+O3qHJIdJAdiP5DSNbx/FUofbafUVTy+cf2vyW6ayV676
 7m8Pa0Ay2/YNIU4jyju+mAmpFXvgh3j8ENPJnT9RGH84gt2tIDnbxC998WwnivTR5/pe
 xsxQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=gKSumBjTrRz8F7wzWa9DlfyTRiQtiPQThzb8xjkwsm8=;
 b=EAEaFLrLH1DvNA5Z46KjUzNzmP7A556t7/w6EjzS1bu0FTzhIsNhJImbuNMhkD7Rl5
 D63ENfh2FuFSLZrKQFDw4al8oPoy+SWsvpBTrt9A0FoHViPr1Men+4N0FbC5Cmp1glyg
 4O4gjZ6scosYjNRP/m9UI6LrJY4h49cm3A/epqd7VHclNtz3YaSx2qElIesK0VSFYfZv
 Qr2E8KLu9YYktN/hI8un7iyBxSqEcyV9fCPjYrcIz2Z1iVh6FoAYd8ZaYRJTfnY9nEsd
 TI09xjex7aSfCIAY6n3tEf7cHICikIvuVwvjPY9W4HtY+ormoYOjWH4xLdUHIbrDXkoN
 i21A==
X-Gm-Message-State: AOAM5314xo/L+bi7e4QdAO0zQoAH4Sw8m3K9lG9OYijKxFkY812w0cOj
 9Wa8KDGMKOaj0JbjYR2ILO4taAnCViM=
X-Google-Smtp-Source: ABdhPJzEX2L2PC1fQXYBbIPMVVWI+9Ofo2tT8Zd1RvGTop/pMVUp0KwEZWXFD5Lu+SnZ4pp4h0deJw==
X-Received: by 2002:a17:906:86d7:: with SMTP id
 j23mr3035584ejy.5.1611839767181; 
 Thu, 28 Jan 2021 05:16:07 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:4cad:1c2d:4a6c:1a92])
 by smtp.gmail.com with ESMTPSA id q4sm2302059ejx.8.2021.01.28.05.16.06
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 28 Jan 2021 05:16:06 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: sroland@vmware.com, zackr@vmware.com, daniel@ffwll.ch,
 linux-graphics-maintainer@vmware.com, dri-devel@lists.freedesktop.org
Subject: [PATCH 2/3] drm/ttm: move memory accounting into vmwgfx v3
Date: Thu, 28 Jan 2021 14:16:03 +0100
Message-Id: <20210128131604.149660-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210128131604.149660-1-christian.koenig@amd.com>
References: <20210128131604.149660-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBqdXN0IGFub3RoZXIgZmVhdHVyZSB3aGljaCBpcyBvbmx5IHVzZWQgYnkgVk1XR0ZY
LCBzbyBtb3ZlCml0IGludG8gdGhlIGRyaXZlciBpbnN0ZWFkLgoKSSd2ZSB0cmllZCB0byBhZGQg
dGhlIGFjY291bnRpbmcgc3lzZnMgZmlsZSB0byB0aGUga29iamVjdCBvZiB0aGUgZHJtCm1pbm9y
LCBidXQgSSdtIG5vdCAxMDAlIHN1cmUgaWYgdGhpcyB3b3JrcyBhcyBleHBlY3RlZC4KCnYyOiBm
aXggdHlwbyBpbiBLRkQgYW5kIGF2b2lkIDY0Yml0IGRpdmlkZQp2MzogZml4IGluaXQgb3JkZXIg
aW4gVk1XR0ZYCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29l
bmlnQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dw
dXZtLmMgIHwgMTYgKysrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
b2JqZWN0LmMgICAgfCAgOCArKy0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxw
ZXIuYyAgICAgICAgIHwgIDYgKystLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9i
by5jICAgICAgICAgIHwgIDcgKystLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9k
cnYuaCAgICAgICAgIHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMgICAg
ICAgICAgICAgIHwgIDQgKy0tCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3Qu
YyAgICAgICAgfCAgOCArKy0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZSAgICAgICAg
ICAgICAgICAgIHwgIDcgKystLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyAgICAgICAg
ICAgICAgICAgIHwgMzMgKy0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fYm9fdXRpbC5jICAgICAgICAgICAgIHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1f
ZGV2aWNlLmMgICAgICAgICAgICAgIHwgMjIgKysrKysrKysrKy0tLQogZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fcG9vbC5jICAgICAgICAgICAgICAgIHwgMTMgKy0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS92bXdnZngvTWFrZWZpbGUgICAgICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9k
cm0ve3R0bSA9PiB2bXdnZnh9L3R0bV9tZW1vcnkuYyAgfCAxOSArKysrLS0tLS0tLQogLi4uL2dw
dS9kcm0vdm13Z2Z4fS90dG1fbWVtb3J5LmggICAgICAgICAgICAgIHwgIDUgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3R0bV9vYmplY3QuaCAgICAgICAgICAgfCAgMyArLQogZHJpdmVycy9n
cHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYyAgICAgICAgICAgIHwgMjIgKysrKysrKysrKy0tLQog
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMgICAgICAgICAgIHwgIDUgKysrCiBk
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMgICAgfCAyOCArKysrKysr
KysrKysrKystCiBpbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oICAgICAgICAgICAgICAgICAg
fCAxMyArKy0tLS0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCAgICAgICAgICAg
ICAgIHwgIDEgLQogaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oICAgICAgICAgICAgICAgICAgICAg
IHwgIDEgKwogMjIgZmlsZXMgY2hhbmdlZCwgMTEwIGluc2VydGlvbnMoKyksIDExNSBkZWxldGlv
bnMoLSkKIHJlbmFtZSBkcml2ZXJzL2dwdS9kcm0ve3R0bSA9PiB2bXdnZnh9L3R0bV9tZW1vcnku
YyAoOTclKQogcmVuYW1lIHtpbmNsdWRlL2RybS90dG0gPT4gZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eH0vdHRtX21lbW9yeS5oICg5NyUpCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2FtZGtmZF9ncHV2bS5jCmluZGV4IDA4NDliNjhlNzg0Zi4uZTQ0MGFmMzdkZGU4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5j
CkBAIC0xMTgsNiArMTE4LDE2IEBAIHZvaWQgYW1kZ3B1X2FtZGtmZF9ncHV2bV9pbml0X21lbV9s
aW1pdHModm9pZCkKICAqLwogI2RlZmluZSBFU1RJTUFURV9QVF9TSVpFKG1lbV9zaXplKSAoKG1l
bV9zaXplKSA+PiAxNCkKIAorc3RhdGljIHNpemVfdCBhbWRncHVfYW1ka2ZkX2FjY19zaXplKHVp
bnQ2NF90IHNpemUpCit7CisJc2l6ZSA+Pj0gUEFHRV9TSElGVDsKKwlzaXplICo9IHNpemVvZihk
bWFfYWRkcl90KSArIHNpemVvZih2b2lkICopOworCisJcmV0dXJuIF9fcm91bmR1cF9wb3dfb2Zf
dHdvKHNpemVvZihzdHJ1Y3QgYW1kZ3B1X2JvKSkgKworCQlfX3JvdW5kdXBfcG93X29mX3R3byhz
aXplb2Yoc3RydWN0IHR0bV90dCkpICsKKwkJUEFHRV9BTElHTihzaXplKTsKK30KKwogc3RhdGlj
IGludCBhbWRncHVfYW1ka2ZkX3Jlc2VydmVfbWVtX2xpbWl0KHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LAogCQl1aW50NjRfdCBzaXplLCB1MzIgZG9tYWluLCBib29sIHNnKQogewpAQCAtMTI2
LDggKzEzNiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2FtZGtmZF9yZXNlcnZlX21lbV9saW1pdChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlzaXplX3QgYWNjX3NpemUsIHN5c3RlbV9tZW1f
bmVlZGVkLCB0dG1fbWVtX25lZWRlZCwgdnJhbV9uZWVkZWQ7CiAJaW50IHJldCA9IDA7CiAKLQlh
Y2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUoJmFkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJ
CQkgICAgICAgc2l6ZW9mKHN0cnVjdCBhbWRncHVfYm8pKTsKKwlhY2Nfc2l6ZSA9IGFtZGdwdV9h
bWRrZmRfYWNjX3NpemUoc2l6ZSk7CiAKIAl2cmFtX25lZWRlZCA9IDA7CiAJaWYgKGRvbWFpbiA9
PSBBTURHUFVfR0VNX0RPTUFJTl9HVFQpIHsKQEAgLTE3NCw4ICsxODMsNyBAQCBzdGF0aWMgdm9p
ZCB1bnJlc2VydmVfbWVtX2xpbWl0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogewogCXNp
emVfdCBhY2Nfc2l6ZTsKIAotCWFjY19zaXplID0gdHRtX2JvX2RtYV9hY2Nfc2l6ZSgmYWRldi0+
bW1hbi5iZGV2LCBzaXplLAotCQkJCSAgICAgICBzaXplb2Yoc3RydWN0IGFtZGdwdV9ibykpOwor
CWFjY19zaXplID0gYW1kZ3B1X2FtZGtmZF9hY2Nfc2l6ZShzaXplKTsKIAogCXNwaW5fbG9jaygm
a2ZkX21lbV9saW1pdC5tZW1fbGltaXRfbG9jayk7CiAJaWYgKGRvbWFpbiA9PSBBTURHUFVfR0VN
X0RPTUFJTl9HVFQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3Qu
YwppbmRleCA2Y2M5OTE5YjEyY2MuLjU5OWM5YTEzMmViNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtNTIzLDcgKzUyMyw2IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2JvX2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAl9OwogCXN0
cnVjdCBhbWRncHVfYm8gKmJvOwogCXVuc2lnbmVkIGxvbmcgcGFnZV9hbGlnbiwgc2l6ZSA9IGJw
LT5zaXplOwotCXNpemVfdCBhY2Nfc2l6ZTsKIAlpbnQgcjsKIAogCS8qIE5vdGUgdGhhdCBHRFMv
R1dTL09BIGFsbG9jYXRlcyAxIHBhZ2UgcGVyIGJ5dGUvcmVzb3VyY2UuICovCkBAIC01NDYsOSAr
NTQ1LDYgQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2
aWNlICphZGV2LAogCiAJKmJvX3B0ciA9IE5VTEw7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFf
YWNjX3NpemUoJmFkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9mKHN0cnVj
dCBhbWRncHVfYm8pKTsKLQogCWJvID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IGFtZGdwdV9ibyks
IEdGUF9LRVJORUwpOwogCWlmIChibyA9PSBOVUxMKQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTU3
Nyw4ICs1NzMsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19jcmVhdGUoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJCWJvLT50Ym8ucHJpb3JpdHkgPSAxOwogCiAJciA9IHR0bV9ib19p
bml0X3Jlc2VydmVkKCZhZGV2LT5tbWFuLmJkZXYsICZiby0+dGJvLCBzaXplLCBicC0+dHlwZSwK
LQkJCQkgJmJvLT5wbGFjZW1lbnQsIHBhZ2VfYWxpZ24sICZjdHgsIGFjY19zaXplLAotCQkJCSBO
VUxMLCBicC0+cmVzdiwgJmFtZGdwdV9ib19kZXN0cm95KTsKKwkJCQkgJmJvLT5wbGFjZW1lbnQs
IHBhZ2VfYWxpZ24sICZjdHgsICBOVUxMLAorCQkJCSBicC0+cmVzdiwgJmFtZGdwdV9ib19kZXN0
cm95KTsKIAlpZiAodW5saWtlbHkociAhPSAwKSkKIAkJcmV0dXJuIHI7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2dlbV92cmFtX2hlbHBlci5jCmluZGV4IDBiMTNjODUwNzY4OC4uYTA5OTJmMGI4YWZkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKQEAgLTE4OSw3ICsxODksNiBAQCBz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZHJtX2dlbV92cmFtX2NyZWF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAogCXN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tID0gZGV2LT52cmFtX21tOwog
CXN0cnVjdCB0dG1fZGV2aWNlICpiZGV2OwogCWludCByZXQ7Ci0Jc2l6ZV90IGFjY19zaXplOwog
CiAJaWYgKFdBUk5fT05DRSghdm1tLCAiVlJBTSBNTSBub3QgaW5pdGlhbGl6ZWQiKSkKIAkJcmV0
dXJuIEVSUl9QVFIoLUVJTlZBTCk7CkBAIC0yMTYsNyArMjE1LDYgQEAgc3RydWN0IGRybV9nZW1f
dnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
IAl9CiAKIAliZGV2ID0gJnZtbS0+YmRldjsKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3Np
emUoYmRldiwgc2l6ZSwgc2l6ZW9mKCpnYm8pKTsKIAogCWdiby0+Ym8uYmRldiA9IGJkZXY7CiAJ
ZHJtX2dlbV92cmFtX3BsYWNlbWVudChnYm8sIERSTV9HRU1fVlJBTV9QTF9GTEFHX1NZU1RFTSk7
CkBAIC0yMjYsOCArMjI0LDggQEAgc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1f
dnJhbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkgKiB0byByZWxlYXNlIGdiby0+
Ym8uYmFzZSBhbmQga2ZyZWUgZ2JvLgogCSAqLwogCXJldCA9IHR0bV9ib19pbml0KGJkZXYsICZn
Ym8tPmJvLCBzaXplLCB0dG1fYm9fdHlwZV9kZXZpY2UsCi0JCQkgICZnYm8tPnBsYWNlbWVudCwg
cGdfYWxpZ24sIGZhbHNlLCBhY2Nfc2l6ZSwKLQkJCSAgTlVMTCwgTlVMTCwgdHRtX2J1ZmZlcl9v
YmplY3RfZGVzdHJveSk7CisJCQkgICZnYm8tPnBsYWNlbWVudCwgcGdfYWxpZ24sIGZhbHNlLCBO
VUxMLCBOVUxMLAorCQkJICB0dG1fYnVmZmVyX29iamVjdF9kZXN0cm95KTsKIAlpZiAocmV0KQog
CQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMK
aW5kZXggYzE3Nzk0MGQ2ZTJjLi5jYTJhOGFlMTkzOGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2JvLmMKQEAgLTMwMCwxOCArMzAwLDE1IEBAIG5vdXZlYXVfYm9faW5pdChzdHJ1Y3Qg
bm91dmVhdV9ibyAqbnZibywgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGRvbWFpbiwKIAkJc3Ry
dWN0IHNnX3RhYmxlICpzZywgc3RydWN0IGRtYV9yZXN2ICpyb2JqKQogewogCWludCB0eXBlID0g
c2cgPyB0dG1fYm9fdHlwZV9zZyA6IHR0bV9ib190eXBlX2RldmljZTsKLQlzaXplX3QgYWNjX3Np
emU7CiAJaW50IHJldDsKIAotCWFjY19zaXplID0gdHRtX2JvX2RtYV9hY2Nfc2l6ZShudmJvLT5i
by5iZGV2LCBzaXplLCBzaXplb2YoKm52Ym8pKTsKLQogCW52Ym8tPmJvLm1lbS5udW1fcGFnZXMg
PSBzaXplID4+IFBBR0VfU0hJRlQ7CiAJbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIGRv
bWFpbiwgMCk7CiAJSU5JVF9MSVNUX0hFQUQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKIAogCXJl
dCA9IHR0bV9ib19pbml0KG52Ym8tPmJvLmJkZXYsICZudmJvLT5ibywgc2l6ZSwgdHlwZSwKLQkJ
CSAgJm52Ym8tPnBsYWNlbWVudCwgYWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsCi0JCQkgIGFj
Y19zaXplLCBzZywgcm9iaiwgbm91dmVhdV9ib19kZWxfdHRtKTsKKwkJCSAgJm52Ym8tPnBsYWNl
bWVudCwgYWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsIHNnLAorCQkJICByb2JqLCBub3V2ZWF1
X2JvX2RlbF90dG0pOwogCWlmIChyZXQpIHsKIAkJLyogdHRtIHdpbGwgY2FsbCBub3V2ZWF1X2Jv
X2RlbF90dG0gaWYgaXQgZmFpbHMuLiAqLwogCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfZHJ2LmgKaW5kZXggZWRmOWQxZWU5ZDU4Li5hNDkxYzJjMWM1NmUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaApAQCAtNTQsNyArNTQsNiBAQAogI2luY2x1
ZGUgPGRybS90dG0vdHRtX2JvX2FwaS5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZl
ci5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX3BsYWNlbWVudC5oPgotI2luY2x1ZGUgPGRybS90
dG0vdHRtX21lbW9yeS5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9hdWRpb19jb21wb25lbnQuaD4K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vcXhsL3F4bF9vYmplY3QuYwppbmRleCBjZWViYzU4ODFmNjguLjcwNWI1MTUzNTQ5
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKQEAgLTEzOCw4ICsxMzgsOCBAQCBpbnQgcXhs
X2JvX2NyZWF0ZShzdHJ1Y3QgcXhsX2RldmljZSAqcWRldiwKIAlxeGxfdHRtX3BsYWNlbWVudF9m
cm9tX2RvbWFpbihibywgZG9tYWluKTsKIAogCXIgPSB0dG1fYm9faW5pdF9yZXNlcnZlZCgmcWRl
di0+bW1hbi5iZGV2LCAmYm8tPnRibywgc2l6ZSwgdHlwZSwKLQkJCQkgJmJvLT5wbGFjZW1lbnQs
IDAsICZjdHgsIHNpemUsCi0JCQkJIE5VTEwsIE5VTEwsICZxeGxfdHRtX2JvX2Rlc3Ryb3kpOwor
CQkJCSAmYm8tPnBsYWNlbWVudCwgMCwgJmN0eCwgTlVMTCwgTlVMTCwKKwkJCQkgJnF4bF90dG1f
Ym9fZGVzdHJveSk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkpIHsKIAkJaWYgKHIgIT0gLUVSRVNU
QVJUU1lTKQogCQkJZGV2X2VycihxZGV2LT5kZGV2LmRldiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9y
YWRlb25fb2JqZWN0LmMKaW5kZXggNmEzMzYyODQ0NjZmLi44MDRmN2E0MjdiZTcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jCkBAIC0xNTksNyArMTU5LDYgQEAgaW50IHJh
ZGVvbl9ib19jcmVhdGUoc3RydWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYsCiAJc3RydWN0IHJhZGVv
bl9ibyAqYm87CiAJZW51bSB0dG1fYm9fdHlwZSB0eXBlOwogCXVuc2lnbmVkIGxvbmcgcGFnZV9h
bGlnbiA9IHJvdW5kdXAoYnl0ZV9hbGlnbiwgUEFHRV9TSVpFKSA+PiBQQUdFX1NISUZUOwotCXNp
emVfdCBhY2Nfc2l6ZTsKIAlpbnQgcjsKIAogCXNpemUgPSBBTElHTihzaXplLCBQQUdFX1NJWkUp
OwpAQCAtMTczLDkgKzE3Miw2IEBAIGludCByYWRlb25fYm9fY3JlYXRlKHN0cnVjdCByYWRlb25f
ZGV2aWNlICpyZGV2LAogCX0KIAkqYm9fcHRyID0gTlVMTDsKIAotCWFjY19zaXplID0gdHRtX2Jv
X2RtYV9hY2Nfc2l6ZSgmcmRldi0+bW1hbi5iZGV2LCBzaXplLAotCQkJCSAgICAgICBzaXplb2Yo
c3RydWN0IHJhZGVvbl9ibykpOwotCiAJYm8gPSBremFsbG9jKHNpemVvZihzdHJ1Y3QgcmFkZW9u
X2JvKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKGJvID09IE5VTEwpCiAJCXJldHVybiAtRU5PTUVNOwpA
QCAtMjMwLDggKzIyNiw4IEBAIGludCByYWRlb25fYm9fY3JlYXRlKHN0cnVjdCByYWRlb25fZGV2
aWNlICpyZGV2LAogCS8qIEtlcm5lbCBhbGxvY2F0aW9uIGFyZSB1bmludGVycnVwdGlibGUgKi8K
IAlkb3duX3JlYWQoJnJkZXYtPnBtLm1jbGtfbG9jayk7CiAJciA9IHR0bV9ib19pbml0KCZyZGV2
LT5tbWFuLmJkZXYsICZiby0+dGJvLCBzaXplLCB0eXBlLAotCQkJJmJvLT5wbGFjZW1lbnQsIHBh
Z2VfYWxpZ24sICFrZXJuZWwsIGFjY19zaXplLAotCQkJc2csIHJlc3YsICZyYWRlb25fdHRtX2Jv
X2Rlc3Ryb3kpOworCQkJJmJvLT5wbGFjZW1lbnQsIHBhZ2VfYWxpZ24sICFrZXJuZWwsIHNnLCBy
ZXN2LAorCQkJJnJhZGVvbl90dG1fYm9fZGVzdHJveSk7CiAJdXBfcmVhZCgmcmRldi0+cG0ubWNs
a19sb2NrKTsKIAlpZiAodW5saWtlbHkociAhPSAwKSkgewogCQlyZXR1cm4gcjsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL01h
a2VmaWxlCmluZGV4IDhlNjQzN2VhZGFiZS4uNDBlNWU5ZGE3OTUzIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vTWFrZWZp
bGUKQEAgLTIsMTAgKzIsOSBAQAogIwogIyBNYWtlZmlsZSBmb3IgdGhlIGRybSBkZXZpY2UgZHJp
dmVyLiAgVGhpcyBkcml2ZXIgcHJvdmlkZXMgc3VwcG9ydCBmb3IgdGhlCiAKLXR0bS15IDo9IHR0
bV9tZW1vcnkubyB0dG1fdHQubyB0dG1fYm8ubyBcCi0JdHRtX2JvX3V0aWwubyB0dG1fYm9fdm0u
byB0dG1fbW9kdWxlLm8gXAotCXR0bV9leGVjYnVmX3V0aWwubyB0dG1fcmFuZ2VfbWFuYWdlci5v
IFwKLQl0dG1fcmVzb3VyY2UubyB0dG1fcG9vbC5vIHR0bV9kZXZpY2UubwordHRtLXkgOj0gdHRt
X3R0Lm8gdHRtX2JvLm8gdHRtX2JvX3V0aWwubyB0dG1fYm9fdm0ubyB0dG1fbW9kdWxlLm8gXAor
CXR0bV9leGVjYnVmX3V0aWwubyB0dG1fcmFuZ2VfbWFuYWdlci5vIHR0bV9yZXNvdXJjZS5vIHR0
bV9wb29sLm8gXAorCXR0bV9kZXZpY2UubwogdHRtLSQoQ09ORklHX0FHUCkgKz0gdHRtX2FncF9i
YWNrZW5kLm8KIAogb2JqLSQoQ09ORklHX0RSTV9UVE0pICs9IHR0bS5vCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8u
YwppbmRleCA2NDNiZWZjMWE2ZjIuLmUzODEwMjI4MmZkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3R0bS90dG1fYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCkBA
IC00MjUsNyArNDI1LDYgQEAgc3RhdGljIHZvaWQgdHRtX2JvX3JlbGVhc2Uoc3RydWN0IGtyZWYg
KmtyZWYpCiAJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyA9CiAJICAgIGNvbnRhaW5lcl9v
ZihrcmVmLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QsIGtyZWYpOwogCXN0cnVjdCB0dG1fZGV2
aWNlICpiZGV2ID0gYm8tPmJkZXY7Ci0Jc2l6ZV90IGFjY19zaXplID0gYm8tPmFjY19zaXplOwog
CWludCByZXQ7CiAKIAlpZiAoIWJvLT5kZWxldGVkKSB7CkBAIC00ODUsNyArNDg0LDYgQEAgc3Rh
dGljIHZvaWQgdHRtX2JvX3JlbGVhc2Uoc3RydWN0IGtyZWYgKmtyZWYpCiAJaWYgKCF0dG1fYm9f
dXNlc19lbWJlZGRlZF9nZW1fb2JqZWN0KGJvKSkKIAkJZG1hX3Jlc3ZfZmluaSgmYm8tPmJhc2Uu
X3Jlc3YpOwogCWJvLT5kZXN0cm95KGJvKTsKLQl0dG1fbWVtX2dsb2JhbF9mcmVlKCZ0dG1fbWVt
X2dsb2IsIGFjY19zaXplKTsKIH0KIAogdm9pZCB0dG1fYm9fcHV0KHN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8pCkBAIC0xMDQ2LDI1ICsxMDQ0LDEzIEBAIGludCB0dG1fYm9faW5pdF9yZXNl
cnZlZChzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKIAkJCSBzdHJ1Y3QgdHRtX3BsYWNlbWVudCAq
cGxhY2VtZW50LAogCQkJIHVpbnQzMl90IHBhZ2VfYWxpZ25tZW50LAogCQkJIHN0cnVjdCB0dG1f
b3BlcmF0aW9uX2N0eCAqY3R4LAotCQkJIHNpemVfdCBhY2Nfc2l6ZSwKIAkJCSBzdHJ1Y3Qgc2df
dGFibGUgKnNnLAogCQkJIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKIAkJCSB2b2lkICgqZGVzdHJv
eSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSkKIHsKLQlzdHJ1Y3QgdHRtX21lbV9nbG9i
YWwgKm1lbV9nbG9iID0gJnR0bV9tZW1fZ2xvYjsKIAlib29sIGxvY2tlZDsKIAlpbnQgcmV0ID0g
MDsKIAotCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9jKG1lbV9nbG9iLCBhY2Nfc2l6ZSwgY3R4
KTsKLQlpZiAocmV0KSB7Ci0JCXByX2VycigiT3V0IG9mIGtlcm5lbCBtZW1vcnlcbiIpOwotCQlp
ZiAoZGVzdHJveSkKLQkJCSgqZGVzdHJveSkoYm8pOwotCQllbHNlCi0JCQlrZnJlZShibyk7Ci0J
CXJldHVybiAtRU5PTUVNOwotCX0KLQogCWJvLT5kZXN0cm95ID0gZGVzdHJveSA/IGRlc3Ryb3kg
OiB0dG1fYm9fZGVmYXVsdF9kZXN0cm95OwogCiAJa3JlZl9pbml0KCZiby0+a3JlZik7CkBAIC0x
MDgxLDcgKzEwNjcsNiBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9kZXZp
Y2UgKmJkZXYsCiAJYm8tPm1lbS5idXMuYWRkciA9IE5VTEw7CiAJYm8tPm1vdmluZyA9IE5VTEw7
CiAJYm8tPm1lbS5wbGFjZW1lbnQgPSAwOwotCWJvLT5hY2Nfc2l6ZSA9IGFjY19zaXplOwogCWJv
LT5waW5fY291bnQgPSAwOwogCWJvLT5zZyA9IHNnOwogCWlmIChyZXN2KSB7CkBAIC0xMTQyLDcg
KzExMjcsNiBAQCBpbnQgdHRtX2JvX2luaXQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCiAJCXN0
cnVjdCB0dG1fcGxhY2VtZW50ICpwbGFjZW1lbnQsCiAJCXVpbnQzMl90IHBhZ2VfYWxpZ25tZW50
LAogCQlib29sIGludGVycnVwdGlibGUsCi0JCXNpemVfdCBhY2Nfc2l6ZSwKIAkJc3RydWN0IHNn
X3RhYmxlICpzZywKIAkJc3RydWN0IGRtYV9yZXN2ICpyZXN2LAogCQl2b2lkICgqZGVzdHJveSkg
KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSkKQEAgLTExNTEsOCArMTEzNSw3IEBAIGludCB0
dG1fYm9faW5pdChzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKIAlpbnQgcmV0OwogCiAJcmV0ID0g
dHRtX2JvX2luaXRfcmVzZXJ2ZWQoYmRldiwgYm8sIHNpemUsIHR5cGUsIHBsYWNlbWVudCwKLQkJ
CQkgICBwYWdlX2FsaWdubWVudCwgJmN0eCwgYWNjX3NpemUsCi0JCQkJICAgc2csIHJlc3YsIGRl
c3Ryb3kpOworCQkJCSAgIHBhZ2VfYWxpZ25tZW50LCAmY3R4LCBzZywgcmVzdiwgZGVzdHJveSk7
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMTE2MywyMCArMTE0Niw2IEBAIGludCB0
dG1fYm9faW5pdChzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKIH0KIEVYUE9SVF9TWU1CT0wodHRt
X2JvX2luaXQpOwogCi1zaXplX3QgdHRtX2JvX2RtYV9hY2Nfc2l6ZShzdHJ1Y3QgdHRtX2Rldmlj
ZSAqYmRldiwKLQkJCSAgIHVuc2lnbmVkIGxvbmcgYm9fc2l6ZSwKLQkJCSAgIHVuc2lnbmVkIHN0
cnVjdF9zaXplKQotewotCXVuc2lnbmVkIG5wYWdlcyA9IChQQUdFX0FMSUdOKGJvX3NpemUpKSA+
PiBQQUdFX1NISUZUOwotCXNpemVfdCBzaXplID0gMDsKLQotCXNpemUgKz0gdHRtX3JvdW5kX3Bv
dChzdHJ1Y3Rfc2l6ZSk7Ci0Jc2l6ZSArPSB0dG1fcm91bmRfcG90KG5wYWdlcyAqICgyKnNpemVv
Zih2b2lkICopICsgc2l6ZW9mKGRtYV9hZGRyX3QpKSk7Ci0Jc2l6ZSArPSB0dG1fcm91bmRfcG90
KHNpemVvZihzdHJ1Y3QgdHRtX3R0KSk7Ci0JcmV0dXJuIHNpemU7Ci19Ci1FWFBPUlRfU1lNQk9M
KHR0bV9ib19kbWFfYWNjX3NpemUpOwotCiAvKgogICogYnVmZmVyIG9iamVjdCB2bSBmdW5jdGlv
bnMuCiAgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYyBi
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYwppbmRleCBkYjBmMjY2MWQ1MDQuLjAz
MWU1ODE5ZmVjNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYwpAQCAtMzA5LDcgKzMwOSw2
IEBAIHN0YXRpYyBpbnQgdHRtX2J1ZmZlcl9vYmplY3RfdHJhbnNmZXIoc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibywKIAogCWtyZWZfaW5pdCgmZmJvLT5iYXNlLmtyZWYpOwogCWZiby0+YmFz
ZS5kZXN0cm95ID0gJnR0bV90cmFuc2ZlcmVkX2Rlc3Ryb3k7Ci0JZmJvLT5iYXNlLmFjY19zaXpl
ID0gMDsKIAlmYm8tPmJhc2UucGluX2NvdW50ID0gMDsKIAlpZiAoYm8tPnR5cGUgIT0gdHRtX2Jv
X3R5cGVfc2cpCiAJCWZiby0+YmFzZS5iYXNlLnJlc3YgPSAmZmJvLT5iYXNlLmJhc2UuX3Jlc3Y7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9kZXZpY2UuYyBiL2RyaXZlcnMv
Z3B1L2RybS90dG0vdHRtX2RldmljZS5jCmluZGV4IGFjMDkwM2M5ZTYwYS4uNmJkZTM0NGU1ZGE3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9kZXZpY2UuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9kZXZpY2UuYwpAQCAtMjcsOSArMjcsMTIgQEAKIAogI2RlZmlu
ZSBwcl9mbXQoZm10KSAiW1RUTSBERVZJQ0VdICIgZm10CiAKKyNpbmNsdWRlIDxsaW51eC9tbS5o
PgorCiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fZGV2aWNlLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90
dG1fbWVtb3J5Lmg+CisjaW5jbHVkZSA8ZHJtL3R0bS90dG1fdHQuaD4KICNpbmNsdWRlIDxkcm0v
dHRtL3R0bV9wbGFjZW1lbnQuaD4KKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KIAog
I2luY2x1ZGUgInR0bV9tb2R1bGUuaCIKIApAQCAtNDksOSArNTIsMTEgQEAgc3RhdGljIHZvaWQg
dHRtX2dsb2JhbF9yZWxlYXNlKHZvaWQpCiAJaWYgKC0tdHRtX2dsb2JfdXNlX2NvdW50ID4gMCkK
IAkJZ290byBvdXQ7CiAKKwl0dG1fcG9vbF9tZ3JfZmluaSgpOworCXR0bV90dF9tZ3JfZmluaSgp
OworCiAJa29iamVjdF9kZWwoJmdsb2ItPmtvYmopOwogCWtvYmplY3RfcHV0KCZnbG9iLT5rb2Jq
KTsKLQl0dG1fbWVtX2dsb2JhbF9yZWxlYXNlKCZ0dG1fbWVtX2dsb2IpOwogCV9fZnJlZV9wYWdl
KGdsb2ItPmR1bW15X3JlYWRfcGFnZSk7CiAJbWVtc2V0KGdsb2IsIDAsIHNpemVvZigqZ2xvYikp
Owogb3V0OgpAQCAtNjEsNiArNjYsOCBAQCBzdGF0aWMgdm9pZCB0dG1fZ2xvYmFsX3JlbGVhc2Uo
dm9pZCkKIHN0YXRpYyBpbnQgdHRtX2dsb2JhbF9pbml0KHZvaWQpCiB7CiAJc3RydWN0IHR0bV9n
bG9iYWwgKmdsb2IgPSAmdHRtX2dsb2I7CisJdW5zaWduZWQgbG9uZyBudW1fcGFnZXM7CisJc3Ry
dWN0IHN5c2luZm8gc2k7CiAJaW50IHJldCA9IDA7CiAJdW5zaWduZWQgaTsKIApAQCAtNjgsOSAr
NzUsMTQgQEAgc3RhdGljIGludCB0dG1fZ2xvYmFsX2luaXQodm9pZCkKIAlpZiAoKyt0dG1fZ2xv
Yl91c2VfY291bnQgPiAxKQogCQlnb3RvIG91dDsKIAotCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2lu
aXQoJnR0bV9tZW1fZ2xvYik7Ci0JaWYgKHJldCkKLQkJZ290byBvdXQ7CisJc2lfbWVtaW5mbygm
c2kpOworCisJLyogTGltaXQgdGhlIG51bWJlciBvZiBwYWdlcyBpbiB0aGUgcG9vbCB0byBhYm91
dCA1MCUgb2YgdGhlIHRvdGFsCisJICogc3lzdGVtIG1lbW9yeS4KKwkgKi8KKwludW1fcGFnZXMg
PSAoKHU2NClzaS50b3RhbHJhbSAqIHNpLm1lbV91bml0KSA+PiBQQUdFX1NISUZUOworCXR0bV9w
b29sX21ncl9pbml0KG51bV9wYWdlcyAqIDUwIC8gMTAwKTsKKwl0dG1fdHRfbWdyX2luaXQoKTsK
IAogCXNwaW5fbG9ja19pbml0KCZnbG9iLT5scnVfbG9jayk7CiAJZ2xvYi0+ZHVtbXlfcmVhZF9w
YWdlID0gYWxsb2NfcGFnZShfX0dGUF9aRVJPIHwgR0ZQX0RNQTMyKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bvb2wuYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bv
b2wuYwppbmRleCBlMDYxNzcxNzExM2YuLjZiMGY5NTdkNjNkNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bv
b2wuYwpAQCAtNDA0LDE2ICs0MDQsMTAgQEAgaW50IHR0bV9wb29sX2FsbG9jKHN0cnVjdCB0dG1f
cG9vbCAqcG9vbCwgc3RydWN0IHR0bV90dCAqdHQsCiAJCQljYWNoaW5nID0gcGFnZXMgKyAoMSA8
PCBvcmRlcik7CiAJCX0KIAotCQlyID0gdHRtX21lbV9nbG9iYWxfYWxsb2NfcGFnZSgmdHRtX21l
bV9nbG9iLCBwLAotCQkJCQkgICAgICAoMSA8PCBvcmRlcikgKiBQQUdFX1NJWkUsCi0JCQkJCSAg
ICAgIGN0eCk7Ci0JCWlmIChyKQotCQkJZ290byBlcnJvcl9mcmVlX3BhZ2U7Ci0KIAkJaWYgKGRt
YV9hZGRyKSB7CiAJCQlyID0gdHRtX3Bvb2xfbWFwKHBvb2wsIG9yZGVyLCBwLCAmZG1hX2FkZHIp
OwogCQkJaWYgKHIpCi0JCQkJZ290byBlcnJvcl9nbG9iYWxfZnJlZTsKKwkJCQlnb3RvIGVycm9y
X2ZyZWVfcGFnZTsKIAkJfQogCiAJCW51bV9wYWdlcyAtPSAxIDw8IG9yZGVyOwpAQCAtNDI3LDkg
KzQyMSw2IEBAIGludCB0dG1fcG9vbF9hbGxvYyhzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsIHN0cnVj
dCB0dG1fdHQgKnR0LAogCiAJcmV0dXJuIDA7CiAKLWVycm9yX2dsb2JhbF9mcmVlOgotCXR0bV9t
ZW1fZ2xvYmFsX2ZyZWVfcGFnZSgmdHRtX21lbV9nbG9iLCBwLCAoMSA8PCBvcmRlcikgKiBQQUdF
X1NJWkUpOwotCiBlcnJvcl9mcmVlX3BhZ2U6CiAJdHRtX3Bvb2xfZnJlZV9wYWdlKHBvb2wsIHR0
LT5jYWNoaW5nLCBvcmRlciwgcCk7CiAKQEAgLTQ2NCw4ICs0NTUsNiBAQCB2b2lkIHR0bV9wb29s
X2ZyZWUoc3RydWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3QgdHRtX3R0ICp0dCkKIAogCQlvcmRl
ciA9IHR0bV9wb29sX3BhZ2Vfb3JkZXIocG9vbCwgcCk7CiAJCW51bV9wYWdlcyA9IDFVTEwgPDwg
b3JkZXI7Ci0JCXR0bV9tZW1fZ2xvYmFsX2ZyZWVfcGFnZSgmdHRtX21lbV9nbG9iLCBwLAotCQkJ
CQkgbnVtX3BhZ2VzICogUEFHRV9TSVpFKTsKIAkJaWYgKHR0LT5kbWFfYWRkcmVzcykKIAkJCXR0
bV9wb29sX3VubWFwKHBvb2wsIHR0LT5kbWFfYWRkcmVzc1tpXSwgbnVtX3BhZ2VzKTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2Ry
bS92bXdnZngvTWFrZWZpbGUKaW5kZXggY2M0Y2RjYTcxNzZlLi44YzAyZmE1ODUyZTcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL3Ztd2dmeC9NYWtlZmlsZQpAQCAtOSw3ICs5LDcgQEAgdm13Z2Z4LXkgOj0gdm13Z2Z4X2V4
ZWNidWYubyB2bXdnZnhfZ21yLm8gdm13Z2Z4X2ttcy5vIHZtd2dmeF9kcnYubyBcCiAJICAgIHZt
d2dmeF9jb3RhYmxlLm8gdm13Z2Z4X3NvLm8gdm13Z2Z4X2JpbmRpbmcubyB2bXdnZnhfbXNnLm8g
XAogCSAgICB2bXdnZnhfc2ltcGxlX3Jlc291cmNlLm8gdm13Z2Z4X3ZhLm8gdm13Z2Z4X2JsaXQu
byBcCiAJICAgIHZtd2dmeF92YWxpZGF0aW9uLm8gdm13Z2Z4X3BhZ2VfZGlydHkubyB2bXdnZnhf
c3RyZWFtb3V0cHV0Lm8gXAotCSAgICB0dG1fb2JqZWN0Lm8gdHRtX2xvY2subworCSAgICB0dG1f
b2JqZWN0Lm8gdHRtX2xvY2subyB0dG1fbWVtb3J5Lm8KIAogdm13Z2Z4LSQoQ09ORklHX1RSQU5T
UEFSRU5UX0hVR0VQQUdFKSArPSB2bXdnZnhfdGhwLm8KIG9iai0kKENPTkZJR19EUk1fVk1XR0ZY
KSA6PSB2bXdnZngubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fbWVtb3J5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnkuYwpzaW1pbGFyaXR5IGluZGV4
IDk3JQpyZW5hbWUgZnJvbSBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9tZW1vcnkuYwpyZW5hbWUg
dG8gZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fbWVtb3J5LmMKaW5kZXggNjM0YTg1YzJkYzRj
Li4xMzA2ZDllMGYwOTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX21lbW9y
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9yeS5jCkBAIC0yOCw3ICsy
OCw2IEBACiAKICNkZWZpbmUgcHJfZm10KGZtdCkgIltUVE1dICIgZm10CiAKLSNpbmNsdWRlIDxk
cm0vdHRtL3R0bV9tZW1vcnkuaD4KICNpbmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgogI2luY2x1
ZGUgPGxpbnV4L3NjaGVkLmg+CiAjaW5jbHVkZSA8bGludXgvd2FpdC5oPgpAQCAtMzYsMTAgKzM1
LDExIEBACiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGludXgvc2xhYi5o
PgogI2luY2x1ZGUgPGxpbnV4L3N3YXAuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wb29sLmg+
Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fdHQuaD4KIAotI2luY2x1ZGUgInR0bV9tb2R1bGUuaCIK
KyNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgor
CisjaW5jbHVkZSAidHRtX21lbW9yeS5oIgogCiAjZGVmaW5lIFRUTV9NRU1PUllfQUxMT0NfUkVU
UklFUyA0CiAKQEAgLTQxNCw3ICs0MTQsNyBAQCBzdGF0aWMgaW50IHR0bV9tZW1faW5pdF9kbWEz
Ml96b25lKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYiwKIH0KICNlbmRpZgogCi1pbnQgdHRt
X21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IpCitpbnQgdHRtX21l
bV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IsIHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCiB7CiAJc3RydWN0IHN5c2luZm8gc2k7CiAJaW50IHJldDsKQEAgLTQyNSw3ICs0
MjUsOCBAQCBpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmds
b2IpCiAJZ2xvYi0+c3dhcF9xdWV1ZSA9IGNyZWF0ZV9zaW5nbGV0aHJlYWRfd29ya3F1ZXVlKCJ0
dG1fc3dhcCIpOwogCUlOSVRfV09SSygmZ2xvYi0+d29yaywgdHRtX3Nocmlua193b3JrKTsKIAly
ZXQgPSBrb2JqZWN0X2luaXRfYW5kX2FkZCgKLQkJJmdsb2ItPmtvYmosICZ0dG1fbWVtX2dsb2Jf
a29ial90eXBlLCB0dG1fZ2V0X2tvYmooKSwgIm1lbW9yeV9hY2NvdW50aW5nIik7CisJCSZnbG9i
LT5rb2JqLCAmdHRtX21lbV9nbG9iX2tvYmpfdHlwZSwgJmRldi0+cHJpbWFyeS0+a2Rldi0+a29i
aiwKKwkJIm1lbW9yeV9hY2NvdW50aW5nIik7CiAJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkgewog
CQlrb2JqZWN0X3B1dCgmZ2xvYi0+a29iaik7CiAJCXJldHVybiByZXQ7CkBAIC00NTMsOCArNDU0
LDYgQEAgaW50IHR0bV9tZW1fZ2xvYmFsX2luaXQoc3RydWN0IHR0bV9tZW1fZ2xvYmFsICpnbG9i
KQogCQlwcl9pbmZvKCJab25lICU3czogQXZhaWxhYmxlIGdyYXBoaWNzIG1lbW9yeTogJWxsdSBL
aUJcbiIsCiAJCQl6b25lLT5uYW1lLCAodW5zaWduZWQgbG9uZyBsb25nKXpvbmUtPm1heF9tZW0g
Pj4gMTApOwogCX0KLQl0dG1fcG9vbF9tZ3JfaW5pdChnbG9iLT56b25lX2tlcm5lbC0+bWF4X21l
bS8oMipQQUdFX1NJWkUpKTsKLQl0dG1fdHRfbWdyX2luaXQoKTsKIAlyZXR1cm4gMDsKIG91dF9u
b196b25lOgogCXR0bV9tZW1fZ2xvYmFsX3JlbGVhc2UoZ2xvYik7CkBAIC00NjYsMTAgKzQ2NSw2
IEBAIHZvaWQgdHRtX21lbV9nbG9iYWxfcmVsZWFzZShzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmds
b2IpCiAJc3RydWN0IHR0bV9tZW1fem9uZSAqem9uZTsKIAl1bnNpZ25lZCBpbnQgaTsKIAotCS8q
IGxldCB0aGUgcGFnZSBhbGxvY2F0b3IgZmlyc3Qgc3RvcCB0aGUgc2hyaW5rIHdvcmsuICovCi0J
dHRtX3Bvb2xfbWdyX2ZpbmkoKTsKLQl0dG1fdHRfbWdyX2ZpbmkoKTsKLQogCWZsdXNoX3dvcmtx
dWV1ZShnbG9iLT5zd2FwX3F1ZXVlKTsKIAlkZXN0cm95X3dvcmtxdWV1ZShnbG9iLT5zd2FwX3F1
ZXVlKTsKIAlnbG9iLT5zd2FwX3F1ZXVlID0gTlVMTDsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJt
L3R0bS90dG1fbWVtb3J5LmggYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnkuaApz
aW1pbGFyaXR5IGluZGV4IDk3JQpyZW5hbWUgZnJvbSBpbmNsdWRlL2RybS90dG0vdHRtX21lbW9y
eS5oCnJlbmFtZSB0byBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnkuaAppbmRleCBj
MWYxNjc4ODFlMzMuLjg1MGVlNmM4NjdkYSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0
bV9tZW1vcnkuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnkuaApAQCAt
MzUsNyArMzUsOCBAQAogI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CiAjaW5jbHVkZSA8bGludXgv
a29iamVjdC5oPgogI2luY2x1ZGUgPGxpbnV4L21tLmg+Ci0jaW5jbHVkZSAidHRtX2JvX2FwaS5o
IgorCisjaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fYXBpLmg+CiAKIC8qKgogICogc3RydWN0IHR0
bV9tZW1fZ2xvYmFsIC0gR2xvYmFsIG1lbW9yeSBhY2NvdW50aW5nIHN0cnVjdHVyZS4KQEAgLTc5
LDcgKzgwLDcgQEAgZXh0ZXJuIHN0cnVjdCB0dG1fbWVtX2dsb2JhbCB7CiAjZW5kaWYKIH0gdHRt
X21lbV9nbG9iOwogCi1pbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3QgdHRtX21lbV9nbG9i
YWwgKmdsb2IpOworaW50IHR0bV9tZW1fZ2xvYmFsX2luaXQoc3RydWN0IHR0bV9tZW1fZ2xvYmFs
ICpnbG9iLCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKIHZvaWQgdHRtX21lbV9nbG9iYWxfcmVs
ZWFzZShzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IpOwogaW50IHR0bV9tZW1fZ2xvYmFsX2Fs
bG9jKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYiwgdWludDY0X3QgbWVtb3J5LAogCQkJIHN0
cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCAqY3R4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS92bXdnZngvdHRtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0
LmgKaW5kZXggZWRlMjZkZjg3YzkzLi40OWIwNjRmMGNiMTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdHRtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngv
dHRtX29iamVjdC5oCkBAIC00Myw3ICs0Myw4IEBACiAjaW5jbHVkZSA8bGludXgvcmN1cGRhdGUu
aD4KIAogI2luY2x1ZGUgPGRybS9kcm1faGFzaHRhYi5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRt
X21lbW9yeS5oPgorCisjaW5jbHVkZSAidHRtX21lbW9yeS5oIgogCiAvKioKICAqIGVudW0gdHRt
X3JlZl90eXBlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5j
IGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYwppbmRleCA2YjNiZmQ4YzY3OGEu
LjUwZTUyOWEwMTY3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
Ym8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCkBAIC01MDcsMTEg
KzUwNywxNiBAQCBpbnQgdm13X2JvX2NyZWF0ZV9rZXJuZWwoc3RydWN0IHZtd19wcml2YXRlICpk
ZXZfcHJpdiwgdW5zaWduZWQgbG9uZyBzaXplLAogCWFjY19zaXplID0gdHRtX3JvdW5kX3BvdChz
aXplb2YoKmJvKSk7CiAJYWNjX3NpemUgKz0gdHRtX3JvdW5kX3BvdChucGFnZXMgKiBzaXplb2Yo
dm9pZCAqKSk7CiAJYWNjX3NpemUgKz0gdHRtX3JvdW5kX3BvdChzaXplb2Yoc3RydWN0IHR0bV90
dCkpOworCisJcmV0ID0gdHRtX21lbV9nbG9iYWxfYWxsb2MoJnR0bV9tZW1fZ2xvYiwgYWNjX3Np
emUsICZjdHgpOworCWlmICh1bmxpa2VseShyZXQpKQorCQlnb3RvIGVycm9yX2ZyZWU7CisKIAly
ZXQgPSB0dG1fYm9faW5pdF9yZXNlcnZlZCgmZGV2X3ByaXYtPmJkZXYsIGJvLCBzaXplLAogCQkJ
CSAgIHR0bV9ib190eXBlX2RldmljZSwgcGxhY2VtZW50LCAwLAotCQkJCSAgICZjdHgsIGFjY19z
aXplLCBOVUxMLCBOVUxMLCBOVUxMKTsKKwkJCQkgICAmY3R4LCBOVUxMLCBOVUxMLCBOVUxMKTsK
IAlpZiAodW5saWtlbHkocmV0KSkKLQkJZ290byBlcnJvcl9mcmVlOworCQlnb3RvIGVycm9yX2Fj
Y291bnQ7CiAKIAl0dG1fYm9fcGluKGJvKTsKIAl0dG1fYm9fdW5yZXNlcnZlKGJvKTsKQEAgLTUx
OSw2ICs1MjQsOSBAQCBpbnQgdm13X2JvX2NyZWF0ZV9rZXJuZWwoc3RydWN0IHZtd19wcml2YXRl
ICpkZXZfcHJpdiwgdW5zaWduZWQgbG9uZyBzaXplLAogCiAJcmV0dXJuIDA7CiAKK2Vycm9yX2Fj
Y291bnQ6CisJdHRtX21lbV9nbG9iYWxfZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSk7CisK
IGVycm9yX2ZyZWU6CiAJa2ZyZWUoYm8pOwogCXJldHVybiByZXQ7CkBAIC01NTgsMTEgKzU2Niwx
NyBAQCBpbnQgdm13X2JvX2luaXQoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKIAl2bXdf
Ym8tPmJhc2UucHJpb3JpdHkgPSAzOwogCXZtd19iby0+cmVzX3RyZWUgPSBSQl9ST09UOwogCisJ
cmV0ID0gdHRtX21lbV9nbG9iYWxfYWxsb2MoJnR0bV9tZW1fZ2xvYiwgYWNjX3NpemUsICZjdHgp
OworCWlmICh1bmxpa2VseShyZXQpKQorCQlyZXR1cm4gcmV0OworCiAJcmV0ID0gdHRtX2JvX2lu
aXRfcmVzZXJ2ZWQoYmRldiwgJnZtd19iby0+YmFzZSwgc2l6ZSwKIAkJCQkgICB0dG1fYm9fdHlw
ZV9kZXZpY2UsIHBsYWNlbWVudCwKLQkJCQkgICAwLCAmY3R4LCBhY2Nfc2l6ZSwgTlVMTCwgTlVM
TCwgYm9fZnJlZSk7Ci0JaWYgKHVubGlrZWx5KHJldCkpCisJCQkJICAgMCwgJmN0eCwgTlVMTCwg
TlVMTCwgYm9fZnJlZSk7CisJaWYgKHVubGlrZWx5KHJldCkpIHsKKwkJdHRtX21lbV9nbG9iYWxf
ZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSk7CiAJCXJldHVybiByZXQ7CisJfQogCiAJaWYg
KHBpbikKIAkJdHRtX2JvX3Bpbigmdm13X2JvLT5iYXNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdn
ZnhfZHJ2LmMKaW5kZXggNzEwYmE1MTY5YTc0Li42YzBjYTEwMTE2MjkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdm13Z2Z4X2Rydi5jCkBAIC0xMjY4LDYgKzEyNjgsNyBAQCBzdGF0aWMgdm9pZCB2bXdf
cmVtb3ZlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBwY2lfZ2V0X2RydmRhdGEocGRldik7CiAKKwl0dG1fbWVtX2dsb2JhbF9yZWxlYXNlKCZ0dG1f
bWVtX2dsb2IpOwogCWRybV9kZXZfdW5yZWdpc3RlcihkZXYpOwogCXZtd19kcml2ZXJfdW5sb2Fk
KGRldik7CiB9CkBAIC0xNTE4LDYgKzE1MTksMTAgQEAgc3RhdGljIGludCB2bXdfcHJvYmUoc3Ry
dWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICplbnQpCiAKIAlw
Y2lfc2V0X2RydmRhdGEocGRldiwgJnZtdy0+ZHJtKTsKIAorCXJldCA9IHR0bV9tZW1fZ2xvYmFs
X2luaXQoJnR0bV9tZW1fZ2xvYiwgJnZtdy0+ZHJtKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCiAJcmV0ID0gdm13X2RyaXZlcl9sb2FkKHZtdywgZW50LT5kZXZpY2UpOwogCWlmIChyZXQp
CiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dm
eF90dG1fYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVy
LmMKaW5kZXggZDFiZmE1OTU3OWYxLi42M2YxMGM4NjUwNjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMKQEAgLTU3NiwxMSArNTc2LDMxIEBAIHN0YXRpYyB2
b2lkIHZtd190dG1fZGVzdHJveShzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV90
dCAqdHRtKQogc3RhdGljIGludCB2bXdfdHRtX3BvcHVsYXRlKHN0cnVjdCB0dG1fZGV2aWNlICpi
ZGV2LAogCQkJICAgIHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
ICpjdHgpCiB7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJldDsKKwogCS8qIFRPRE86IG1heWJl
IGNvbXBsZXRlbHkgZHJvcCB0aGlzID8gKi8KIAlpZiAodHRtX3R0X2lzX3BvcHVsYXRlZCh0dG0p
KQogCQlyZXR1cm4gMDsKIAotCXJldHVybiB0dG1fcG9vbF9hbGxvYygmYmRldi0+cG9vbCwgdHRt
LCBjdHgpOworCXJldCA9IHR0bV9wb29sX2FsbG9jKCZiZGV2LT5wb29sLCB0dG0sIGN0eCk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7IGkgPCB0dG0tPm51bV9wYWdl
czsgKytpKSB7CisJCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9jX3BhZ2UoJnR0bV9tZW1fZ2xv
YiwgdHRtLT5wYWdlc1tpXSwKKwkJCQkJCVBBR0VfU0laRSwgY3R4KTsKKwkJaWYgKHJldCkKKwkJ
CWdvdG8gZXJyb3I7CisJfQorCXJldHVybiAwOworCitlcnJvcjoKKwl3aGlsZSAoaS0tKQorCQl0
dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1fZ2xvYiwgdHRtLT5wYWdlc1tpXSwKKwkJ
CQkJIFBBR0VfU0laRSk7CisJdHRtX3Bvb2xfZnJlZSgmYmRldi0+cG9vbCwgdHRtKTsKKwlyZXR1
cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCB2bXdfdHRtX3VucG9wdWxhdGUoc3RydWN0IHR0bV9k
ZXZpY2UgKmJkZXYsCkBAIC01ODgsNiArNjA4LDcgQEAgc3RhdGljIHZvaWQgdm13X3R0bV91bnBv
cHVsYXRlKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAogewogCXN0cnVjdCB2bXdfdHRtX3R0ICp2
bXdfdHQgPSBjb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwKIAkJCQkJCSBkbWFf
dHRtKTsKKwl1bnNpZ25lZCBpbnQgaTsKIAogCWlmICh2bXdfdHQtPm1vYikgewogCQl2bXdfbW9i
X2Rlc3Ryb3kodm13X3R0LT5tb2IpOwpAQCAtNTk1LDYgKzYxNiwxMSBAQCBzdGF0aWMgdm9pZCB2
bXdfdHRtX3VucG9wdWxhdGUoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCiAJfQogCiAJdm13X3R0
bV91bm1hcF9kbWEodm13X3R0KTsKKworCWZvciAoaSA9IDA7IGkgPCB0dG0tPm51bV9wYWdlczsg
KytpKQorCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1fZ2xvYiwgdHRtLT5wYWdl
c1tpXSwKKwkJCQkJIFBBR0VfU0laRSk7CisKIAl0dG1fcG9vbF9mcmVlKCZiZGV2LT5wb29sLCB0
dG0pOwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oIGIvaW5j
bHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRleCAxMjk3YThmYjdjY2IuLjRmYjUyM2RmYWIz
MiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAorKysgYi9pbmNsdWRl
L2RybS90dG0vdHRtX2JvX2FwaS5oCkBAIC04OCw3ICs4OCw2IEBAIHN0cnVjdCB0dG1fdHQ7CiAg
KiBAdHlwZTogVGhlIGJvIHR5cGUuCiAgKiBAZGVzdHJveTogRGVzdHJ1Y3Rpb24gZnVuY3Rpb24u
IElmIE5VTEwsIGtmcmVlIGlzIHVzZWQuCiAgKiBAbnVtX3BhZ2VzOiBBY3R1YWwgbnVtYmVyIG9m
IHBhZ2VzLgotICogQGFjY19zaXplOiBBY2NvdW50ZWQgc2l6ZSBmb3IgdGhpcyBvYmplY3QuCiAg
KiBAa3JlZjogUmVmZXJlbmNlIGNvdW50IG9mIHRoaXMgYnVmZmVyIG9iamVjdC4gV2hlbiB0aGlz
IHJlZmNvdW50IHJlYWNoZXMKICAqIHplcm8sIHRoZSBvYmplY3QgaXMgZGVzdHJveWVkIG9yIHB1
dCBvbiB0aGUgZGVsYXllZCBkZWxldGUgbGlzdC4KICAqIEBtZW06IHN0cnVjdHVyZSBkZXNjcmli
aW5nIGN1cnJlbnQgcGxhY2VtZW50LgpAQCAtMTI1LDcgKzEyNCw2IEBAIHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCB7CiAJc3RydWN0IHR0bV9kZXZpY2UgKmJkZXY7CiAJZW51bSB0dG1fYm9fdHlw
ZSB0eXBlOwogCXZvaWQgKCpkZXN0cm95KSAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopOwot
CXNpemVfdCBhY2Nfc2l6ZTsKIAogCS8qKgogCSogTWVtYmVycyBub3QgbmVlZGluZyBwcm90ZWN0
aW9uLgpAQCAtMzU3LDEwICszNTUsNiBAQCB2b2lkIHR0bV9ib191bmxvY2tfZGVsYXllZF93b3Jr
cXVldWUoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsIGludCByZXNjaGVkKTsKIGJvb2wgdHRtX2Jv
X2V2aWN0aW9uX3ZhbHVhYmxlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQkgICAg
ICBjb25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSk7CiAKLXNpemVfdCB0dG1fYm9fZG1hX2Fj
Y19zaXplKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAotCQkJICAgdW5zaWduZWQgbG9uZyBib19z
aXplLAotCQkJICAgdW5zaWduZWQgc3RydWN0X3NpemUpOwotCiAvKioKICAqIHR0bV9ib19pbml0
X3Jlc2VydmVkCiAgKgpAQCAtMzcxLDcgKzM2NSw2IEBAIHNpemVfdCB0dG1fYm9fZG1hX2FjY19z
aXplKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAogICogQGZsYWdzOiBJbml0aWFsIHBsYWNlbWVu
dCBmbGFncy4KICAqIEBwYWdlX2FsaWdubWVudDogRGF0YSBhbGlnbm1lbnQgaW4gcGFnZXMuCiAg
KiBAY3R4OiBUVE0gb3BlcmF0aW9uIGNvbnRleHQgZm9yIG1lbW9yeSBhbGxvY2F0aW9uLgotICog
QGFjY19zaXplOiBBY2NvdW50ZWQgc2l6ZSBmb3IgdGhpcyBvYmplY3QuCiAgKiBAcmVzdjogUG9p
bnRlciB0byBhIGRtYV9yZXN2LCBvciBOVUxMIHRvIGxldCB0dG0gYWxsb2NhdGUgb25lLgogICog
QGRlc3Ryb3k6IERlc3Ryb3kgZnVuY3Rpb24uIFVzZSBOVUxMIGZvciBrZnJlZSgpLgogICoKQEAg
LTQwMiw4ICszOTUsNyBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9kZXZp
Y2UgKmJkZXYsCiAJCQkgc3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCwKIAkJCSB1aW50
MzJfdCBwYWdlX2FsaWdubWVudCwKIAkJCSBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwK
LQkJCSBzaXplX3QgYWNjX3NpemUsIHN0cnVjdCBzZ190YWJsZSAqc2csCi0JCQkgc3RydWN0IGRt
YV9yZXN2ICpyZXN2LAorCQkJIHN0cnVjdCBzZ190YWJsZSAqc2csIHN0cnVjdCBkbWFfcmVzdiAq
cmVzdiwKIAkJCSB2b2lkICgqZGVzdHJveSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSk7
CiAKIC8qKgpAQCAtNDIxLDcgKzQxMyw2IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChzdHJ1
Y3QgdHRtX2RldmljZSAqYmRldiwKICAqIGhvbGRzIGEgcG9pbnRlciB0byBhIHBlcnNpc3RlbnQg
c2htZW0gb2JqZWN0LiBUeXBpY2FsbHksIHRoaXMgd291bGQKICAqIHBvaW50IHRvIHRoZSBzaG1l
bSBvYmplY3QgYmFja2luZyBhIEdFTSBvYmplY3QgaWYgVFRNIGlzIHVzZWQgdG8gYmFjayBhCiAg
KiBHRU0gdXNlciBpbnRlcmZhY2UuCi0gKiBAYWNjX3NpemU6IEFjY291bnRlZCBzaXplIGZvciB0
aGlzIG9iamVjdC4KICAqIEByZXN2OiBQb2ludGVyIHRvIGEgZG1hX3Jlc3YsIG9yIE5VTEwgdG8g
bGV0IHR0bSBhbGxvY2F0ZSBvbmUuCiAgKiBAZGVzdHJveTogRGVzdHJveSBmdW5jdGlvbi4gVXNl
IE5VTEwgZm9yIGtmcmVlKCkuCiAgKgpAQCAtNDQ2LDcgKzQzNyw3IEBAIGludCB0dG1fYm9faW5p
dF9yZXNlcnZlZChzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKIGludCB0dG1fYm9faW5pdChzdHJ1
Y3QgdHRtX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJc2l6
ZV90IHNpemUsIGVudW0gdHRtX2JvX3R5cGUgdHlwZSwKIAkJc3RydWN0IHR0bV9wbGFjZW1lbnQg
KnBsYWNlbWVudCwKLQkJdWludDMyX3QgcGFnZV9hbGlnbm1lbnQsIGJvb2wgaW50ZXJydWJ0aWJs
ZSwgc2l6ZV90IGFjY19zaXplLAorCQl1aW50MzJfdCBwYWdlX2FsaWdubWVudCwgYm9vbCBpbnRl
cnJ1YnRpYmxlLAogCQlzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3Ys
CiAJCXZvaWQgKCpkZXN0cm95KSAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopKTsKIApkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCBiL2luY2x1ZGUvZHJtL3R0
bS90dG1fYm9fZHJpdmVyLmgKaW5kZXggMWM5YmY5OTNlMjUyLi44OTU5YzAwNzVjZmQgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKKysrIGIvaW5jbHVkZS9kcm0v
dHRtL3R0bV9ib19kcml2ZXIuaApAQCAtNDAsNyArNDAsNiBAQAogI2luY2x1ZGUgPGRybS90dG0v
dHRtX2RldmljZS5oPgogCiAjaW5jbHVkZSAidHRtX2JvX2FwaS5oIgotI2luY2x1ZGUgInR0bV9t
ZW1vcnkuaCIKICNpbmNsdWRlICJ0dG1fcGxhY2VtZW50LmgiCiAjaW5jbHVkZSAidHRtX3R0Lmgi
CiAjaW5jbHVkZSAidHRtX3Bvb2wuaCIKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1f
dHQuaCBiL2luY2x1ZGUvZHJtL3R0bS90dG1fdHQuaAppbmRleCBjY2U1N2ZiNDllMmMuLjA2OWY4
MTMwMjQxYSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oCisrKyBiL2luY2x1
ZGUvZHJtL3R0bS90dG1fdHQuaApAQCAtMzAsNiArMzAsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3R5
cGVzLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fY2FjaGluZy5oPgogCitzdHJ1Y3QgdHRtX2Jv
X2RldmljZTsKIHN0cnVjdCB0dG1fdHQ7CiBzdHJ1Y3QgdHRtX3Jlc291cmNlOwogc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0OwotLSAKMi4yNS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWwK
