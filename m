Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4F8B79D2B6
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 17:27:48 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 962CD6E247;
	Mon, 26 Aug 2019 15:27:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 57BF26E231
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 15:27:04 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id A372528BF76;
 Mon, 26 Aug 2019 16:27:02 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 13/21] drm/bridge: Patch atomic hooks to take a
 drm_bridge_state
Date: Mon, 26 Aug 2019 17:26:41 +0200
Message-Id: <20190826152649.13820-14-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190826152649.13820-1-boris.brezillon@collabora.com>
References: <20190826152649.13820-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Jernej Skrabec <jernej.skrabec@siol.net>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>, Jonas Karlman <jonas@kwiboo.se>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Thierry Reding <thierry.reding@gmail.com>, Chris Healy <Chris.Healy@zii.aero>,
 Boris Brezillon <boris.brezillon@collabora.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBhIGRybV9hdG9taWNfc3RhdGUuIFRoZSBvbmx5IGRyaXZlciBpbXBsZW1lbnRp
bmcgdGhvc2UgaG9va3MKaXMgcGF0Y2hlZCB0b28uCgpXaGlsZSBhdCBpdCwgYWRqdXN0IHRoZSBk
b2N1bWVudGF0aW9uIGFuZCBhcmd1bWVudCBuYW1lcyB0byBjbGFyaWZ5IHRoZQpmYWN0IHRoYXQg
dGhlIHN0YXRlIGJlaW5nIHBhc3NlZCB0byB0aG9zZSBmdW5jdGlvbnMvaG9va3MgaXMgdGhlIG9s
ZApzdGF0ZS4KClNpZ25lZC1vZmYtYnk6IEJvcmlzIEJyZXppbGxvbiA8Ym9yaXMuYnJlemlsbG9u
QGNvbGxhYm9yYS5jb20+Ci0tLQpDaGFuZ2VzIGluIHYyOgoqIFBhc3MgdGhlIG9sZCBicmlkZ2Ug
c3RhdGUKLS0tCiAuLi4vZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeF9kcF9jb3JlLmMgICAg
fCAxMiArKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMgICAgICAgICAgICAgICAgICB8
IDczICsrKysrKysrKysrKysrLS0tLS0KIGluY2x1ZGUvZHJtL2RybV9icmlkZ2UuaCAgICAgICAg
ICAgICAgICAgICAgICB8IDIzICsrKystLQogMyBmaWxlcyBjaGFuZ2VkLCA3NiBpbnNlcnRpb25z
KCspLCAzMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2FuYWxvZ2l4L2FuYWxvZ2l4X2RwX2NvcmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvYW5hbG9naXhfZHBfY29yZS5jCmluZGV4IGJiNDExZmU1MmFlOC4uZTQzOGU3NTdmMmNl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4X2Rw
X2NvcmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4X2Rw
X2NvcmUuYwpAQCAtMTI5MCw4ICsxMjkwLDkgQEAgc3RydWN0IGRybV9jcnRjICphbmFsb2dpeF9k
cF9nZXRfbmV3X2NydGMoc3RydWN0IGFuYWxvZ2l4X2RwX2RldmljZSAqZHAsCiB9CiAKIHN0YXRp
YyB2b2lkIGFuYWxvZ2l4X2RwX2JyaWRnZV9hdG9taWNfcHJlX2VuYWJsZShzdHJ1Y3QgZHJtX2Jy
aWRnZSAqYnJpZGdlLAotCQkJCQkJIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKKwkJ
CQkJCSBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqYnN0YXRlKQogeworCXN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpzdGF0ZSA9IGJzdGF0ZS0+YmFzZS5zdGF0ZTsKIAlzdHJ1Y3QgYW5hbG9naXhf
ZHBfZGV2aWNlICpkcCA9IGJyaWRnZS0+ZHJpdmVyX3ByaXZhdGU7CiAJc3RydWN0IGRybV9jcnRj
ICpjcnRjOwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7CkBAIC0xMzY3
LDggKzEzNjgsOSBAQCBzdGF0aWMgaW50IGFuYWxvZ2l4X2RwX3NldF9icmlkZ2Uoc3RydWN0IGFu
YWxvZ2l4X2RwX2RldmljZSAqZHApCiB9CiAKIHN0YXRpYyB2b2lkIGFuYWxvZ2l4X2RwX2JyaWRn
ZV9hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCi0JCQkJCSAgICAgc3Ry
dWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQorCQkJCQkgICAgIHN0cnVjdCBkcm1fYnJpZGdl
X3N0YXRlICpic3RhdGUpCiB7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gYnN0
YXRlLT5iYXNlLnN0YXRlOwogCXN0cnVjdCBhbmFsb2dpeF9kcF9kZXZpY2UgKmRwID0gYnJpZGdl
LT5kcml2ZXJfcHJpdmF0ZTsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CiAJc3RydWN0IGRybV9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZTsKQEAgLTE0NDEsOCArMTQ0Myw5IEBAIHN0YXRpYyB2
b2lkIGFuYWxvZ2l4X2RwX2JyaWRnZV9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
CiB9CiAKIHN0YXRpYyB2b2lkIGFuYWxvZ2l4X2RwX2JyaWRnZV9hdG9taWNfZGlzYWJsZShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAotCQkJCQkgICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUpCisJCQkJCSAgICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpic3RhdGUpCiB7
CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gYnN0YXRlLT5iYXNlLnN0YXRlOwog
CXN0cnVjdCBhbmFsb2dpeF9kcF9kZXZpY2UgKmRwID0gYnJpZGdlLT5kcml2ZXJfcHJpdmF0ZTsK
IAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CiAJc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSA9IE5VTEw7CkBAIC0xNDY1LDggKzE0NjgsOSBAQCBzdGF0aWMgdm9pZCBhbmFsb2dp
eF9kcF9icmlkZ2VfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAog
c3RhdGljCiB2b2lkIGFuYWxvZ2l4X2RwX2JyaWRnZV9hdG9taWNfcG9zdF9kaXNhYmxlKHN0cnVj
dCBkcm1fYnJpZGdlICpicmlkZ2UsCi0JCQkJCSAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUpCisJCQkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqYnN0YXRlKQogeworCXN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGJzdGF0ZS0+YmFzZS5zdGF0ZTsKIAlzdHJ1
Y3QgYW5hbG9naXhfZHBfZGV2aWNlICpkcCA9IGJyaWRnZS0+ZHJpdmVyX3ByaXZhdGU7CiAJc3Ry
dWN0IGRybV9jcnRjICpjcnRjOwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3Rh
dGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2RybV9icmlkZ2UuYwppbmRleCA2YzJkNzY5MTQ1NWIuLjVjODNjYWM3OTc1ZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2JyaWRnZS5jCkBAIC00MzcsNyArNDM3LDcgQEAgRVhQT1JUX1NZTUJPTChkcm1fYnJp
ZGdlX2NoYWluX2VuYWJsZSk7CiAvKioKICAqIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2Rpc2Fi
bGUgLSBkaXNhYmxlcyBhbGwgYnJpZGdlcyBpbiB0aGUgZW5jb2RlciBjaGFpbgogICogQGJyaWRn
ZTogYnJpZGdlIGNvbnRyb2wgc3RydWN0dXJlCi0gKiBAc3RhdGU6IGF0b21pYyBzdGF0ZSBiZWlu
ZyBjb21taXR0ZWQKKyAqIEBvbGRfc3RhdGU6IG9sZCBhdG9taWMgc3RhdGUKICAqCiAgKiBDYWxs
cyAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfZGlzYWJsZSAoZmFsbHMgYmFjayBvbgogICogJmRy
bV9icmlkZ2VfZnVuY3MuZGlzYWJsZSkgb3AgZm9yIGFsbCB0aGUgYnJpZGdlcyBpbiB0aGUgZW5j
b2RlciBjaGFpbiwKQEAgLTQ0NywxNiArNDQ3LDI0IEBAIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRn
ZV9jaGFpbl9lbmFibGUpOwogICogTm90ZTogdGhlIGJyaWRnZSBwYXNzZWQgc2hvdWxkIGJlIHRo
ZSBvbmUgY2xvc2VzdCB0byB0aGUgZW5jb2RlcgogICovCiB2b2lkIGRybV9hdG9taWNfYnJpZGdl
X2NoYWluX2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKLQkJCQkgICAgIHN0cnVj
dCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKKwkJCQkgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyID0gYnJpZGdl
LT5lbmNvZGVyOwogCXN0cnVjdCBkcm1fYnJpZGdlICppdGVyOwogCiAJbGlzdF9mb3JfZWFjaF9l
bnRyeV9yZXZlcnNlKGl0ZXIsICZlbmNvZGVyLT5icmlkZ2VfY2hhaW4sIGNoYWluX25vZGUpIHsK
LQkJaWYgKGl0ZXItPmZ1bmNzLT5hdG9taWNfZGlzYWJsZSkKLQkJCWl0ZXItPmZ1bmNzLT5hdG9t
aWNfZGlzYWJsZShpdGVyLCBzdGF0ZSk7Ci0JCWVsc2UgaWYgKGl0ZXItPmZ1bmNzLT5kaXNhYmxl
KQorCQlpZiAoaXRlci0+ZnVuY3MtPmF0b21pY19kaXNhYmxlKSB7CisJCQlzdHJ1Y3QgZHJtX2Jy
aWRnZV9zdGF0ZSAqYnJpZGdlX3N0YXRlOworCisJCQlicmlkZ2Vfc3RhdGUgPSBkcm1fYXRvbWlj
X2dldF9vbGRfYnJpZGdlX3N0YXRlKG9sZF9zdGF0ZSwKKwkJCQkJCQkJICAgICAgIGl0ZXIpOwor
CQkJaWYgKFdBUk5fT04oIWJyaWRnZV9zdGF0ZSkpCisJCQkJcmV0dXJuOworCisJCQlpdGVyLT5m
dW5jcy0+YXRvbWljX2Rpc2FibGUoaXRlciwgYnJpZGdlX3N0YXRlKTsKKwkJfSBlbHNlIGlmIChp
dGVyLT5mdW5jcy0+ZGlzYWJsZSkgewogCQkJaXRlci0+ZnVuY3MtPmRpc2FibGUoaXRlcik7CisJ
CX0KIAogCQlpZiAoaXRlciA9PSBicmlkZ2UpCiAJCQlicmVhazsKQEAgLTQ2OCw3ICs0NzYsNyBA
QCBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2Rpc2FibGUpOwogICogZHJt
X2F0b21pY19icmlkZ2VfY2hhaW5fcG9zdF9kaXNhYmxlIC0gY2xlYW5zIHVwIGFmdGVyIGRpc2Fi
bGluZyBhbGwgYnJpZGdlcwogICoJCQkJCSAgaW4gdGhlIGVuY29kZXIgY2hhaW4KICAqIEBicmlk
Z2U6IGJyaWRnZSBjb250cm9sIHN0cnVjdHVyZQotICogQHN0YXRlOiBhdG9taWMgc3RhdGUgYmVp
bmcgY29tbWl0dGVkCisgKiBAb2xkX3N0YXRlOiBvbGQgYXRvbWljIHN0YXRlCiAgKgogICogQ2Fs
bHMgJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX3Bvc3RfZGlzYWJsZSAoZmFsbHMgYmFjayBvbgog
ICogJmRybV9icmlkZ2VfZnVuY3MucG9zdF9kaXNhYmxlKSBvcCBmb3IgYWxsIHRoZSBicmlkZ2Vz
IGluIHRoZSBlbmNvZGVyIGNoYWluLApAQCAtNDc4LDE1ICs0ODYsMjQgQEAgRVhQT1JUX1NZTUJP
TChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9kaXNhYmxlKTsKICAqIE5vdGU6IHRoZSBicmlkZ2Ug
cGFzc2VkIHNob3VsZCBiZSB0aGUgb25lIGNsb3Nlc3QgdG8gdGhlIGVuY29kZXIKICAqLwogdm9p
ZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2Ug
KmJyaWRnZSwKLQkJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCisJCQkJCSAg
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIgPSBicmlkZ2UtPmVuY29kZXI7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zy
b20oYnJpZGdlLCAmZW5jb2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7Ci0JCWlmIChi
cmlkZ2UtPmZ1bmNzLT5hdG9taWNfcG9zdF9kaXNhYmxlKQotCQkJYnJpZGdlLT5mdW5jcy0+YXRv
bWljX3Bvc3RfZGlzYWJsZShicmlkZ2UsIHN0YXRlKTsKLQkJZWxzZSBpZiAoYnJpZGdlLT5mdW5j
cy0+cG9zdF9kaXNhYmxlKQorCQlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX3Bvc3RfZGlzYWJs
ZSkgeworCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKmJyaWRnZV9zdGF0ZTsKKworCQkJYnJp
ZGdlX3N0YXRlID0gZHJtX2F0b21pY19nZXRfb2xkX2JyaWRnZV9zdGF0ZShvbGRfc3RhdGUsCisJ
CQkJCQkJCSAgICAgICBicmlkZ2UpOworCQkJaWYgKFdBUk5fT04oIWJyaWRnZV9zdGF0ZSkpCisJ
CQkJcmV0dXJuOworCisJCQlicmlkZ2UtPmZ1bmNzLT5hdG9taWNfcG9zdF9kaXNhYmxlKGJyaWRn
ZSwKKwkJCQkJCQkgICBicmlkZ2Vfc3RhdGUpOworCQl9IGVsc2UgaWYgKGJyaWRnZS0+ZnVuY3Mt
PnBvc3RfZGlzYWJsZSkgewogCQkJYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7
CisJCX0KIAl9CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX3Bvc3Rf
ZGlzYWJsZSk7CkBAIC00OTUsNyArNTEyLDcgQEAgRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2Jy
aWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUpOwogICogZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fcHJl
X2VuYWJsZSAtIHByZXBhcmVzIGZvciBlbmFibGluZyBhbGwgYnJpZGdlcyBpbgogICoJCQkJCXRo
ZSBlbmNvZGVyIGNoYWluCiAgKiBAYnJpZGdlOiBicmlkZ2UgY29udHJvbCBzdHJ1Y3R1cmUKLSAq
IEBzdGF0ZTogYXRvbWljIHN0YXRlIGJlaW5nIGNvbW1pdHRlZAorICogQG9sZF9zdGF0ZTogb2xk
IGF0b21pYyBzdGF0ZQogICoKICAqIENhbGxzICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19wcmVf
ZW5hYmxlIChmYWxscyBiYWNrIG9uCiAgKiAmZHJtX2JyaWRnZV9mdW5jcy5wcmVfZW5hYmxlKSBv
cCBmb3IgYWxsIHRoZSBicmlkZ2VzIGluIHRoZSBlbmNvZGVyIGNoYWluLApAQCAtNTA1LDE2ICs1
MjIsMjQgQEAgRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2Fi
bGUpOwogICogTm90ZTogdGhlIGJyaWRnZSBwYXNzZWQgc2hvdWxkIGJlIHRoZSBvbmUgY2xvc2Vz
dCB0byB0aGUgZW5jb2RlcgogICovCiB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX3ByZV9l
bmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKLQkJCQkJc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQorCQkJCQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQog
ewogCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciA9IGJyaWRnZS0+ZW5jb2RlcjsKIAlzdHJ1
Y3QgZHJtX2JyaWRnZSAqaXRlcjsKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfcmV2ZXJzZShpdGVy
LCAmZW5jb2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7Ci0JCWlmIChpdGVyLT5mdW5j
cy0+YXRvbWljX3ByZV9lbmFibGUpCi0JCQlpdGVyLT5mdW5jcy0+YXRvbWljX3ByZV9lbmFibGUo
aXRlciwgc3RhdGUpOwotCQllbHNlIGlmIChpdGVyLT5mdW5jcy0+cHJlX2VuYWJsZSkKKwkJaWYg
KGl0ZXItPmZ1bmNzLT5hdG9taWNfcHJlX2VuYWJsZSkgeworCQkJc3RydWN0IGRybV9icmlkZ2Vf
c3RhdGUgKmJyaWRnZV9zdGF0ZTsKKworCQkJYnJpZGdlX3N0YXRlID0gZHJtX2F0b21pY19nZXRf
b2xkX2JyaWRnZV9zdGF0ZShvbGRfc3RhdGUsCisJCQkJCQkJCSAgICAgICBpdGVyKTsKKwkJCWlm
IChXQVJOX09OKCFicmlkZ2Vfc3RhdGUpKQorCQkJCXJldHVybjsKKworCQkJaXRlci0+ZnVuY3Mt
PmF0b21pY19wcmVfZW5hYmxlKGl0ZXIsIGJyaWRnZV9zdGF0ZSk7CisJCX0gZWxzZSBpZiAoaXRl
ci0+ZnVuY3MtPnByZV9lbmFibGUpIHsKIAkJCWl0ZXItPmZ1bmNzLT5wcmVfZW5hYmxlKGl0ZXIp
OworCQl9CiAKIAkJaWYgKGl0ZXIgPT0gYnJpZGdlKQogCQkJYnJlYWs7CkBAIC01MjUsNyArNTUw
LDcgQEAgRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wcmVfZW5hYmxlKTsK
IC8qKgogICogZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlIC0gZW5hYmxlcyBhbGwgYnJp
ZGdlcyBpbiB0aGUgZW5jb2RlciBjaGFpbgogICogQGJyaWRnZTogYnJpZGdlIGNvbnRyb2wgc3Ry
dWN0dXJlCi0gKiBAc3RhdGU6IGF0b21pYyBzdGF0ZSBiZWluZyBjb21taXR0ZWQKKyAqIEBvbGRf
c3RhdGU6IG9sZCBhdG9taWMgc3RhdGUKICAqCiAgKiBDYWxscyAmZHJtX2JyaWRnZV9mdW5jcy5h
dG9taWNfZW5hYmxlIChmYWxscyBiYWNrIG9uCiAgKiAmZHJtX2JyaWRnZV9mdW5jcy5lbmFibGUp
IG9wIGZvciBhbGwgdGhlIGJyaWRnZXMgaW4gdGhlIGVuY29kZXIgY2hhaW4sCkBAIC01MzUsMTUg
KzU2MCwyMyBAQCBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX3ByZV9lbmFi
bGUpOwogICogTm90ZTogdGhlIGJyaWRnZSBwYXNzZWQgc2hvdWxkIGJlIHRoZSBvbmUgY2xvc2Vz
dCB0byB0aGUgZW5jb2RlcgogICovCiB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJs
ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAotCQkJCSAgICBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUpCisJCQkJICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyID0gYnJpZGdlLT5lbmNvZGVyOwogCiAJ
bGlzdF9mb3JfZWFjaF9lbnRyeV9mcm9tKGJyaWRnZSwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwg
Y2hhaW5fbm9kZSkgewotCQlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX2VuYWJsZSkKLQkJCWJy
aWRnZS0+ZnVuY3MtPmF0b21pY19lbmFibGUoYnJpZGdlLCBzdGF0ZSk7Ci0JCWVsc2UgaWYgKGJy
aWRnZS0+ZnVuY3MtPmVuYWJsZSkKKwkJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19lbmFibGUp
IHsKKwkJCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGU7CisKKwkJCWJyaWRn
ZV9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9icmlkZ2Vfc3RhdGUob2xkX3N0YXRlLAorCQkJ
CQkJCQkgICAgICAgYnJpZGdlKTsKKwkJCWlmIChXQVJOX09OKCFicmlkZ2Vfc3RhdGUpKQorCQkJ
CXJldHVybjsKKworCQkJYnJpZGdlLT5mdW5jcy0+YXRvbWljX2VuYWJsZShicmlkZ2UsIGJyaWRn
ZV9zdGF0ZSk7CisJCX0gZWxzZSBpZiAoYnJpZGdlLT5mdW5jcy0+ZW5hYmxlKSB7CiAJCQlicmlk
Z2UtPmZ1bmNzLT5lbmFibGUoYnJpZGdlKTsKKwkJfQogCX0KIH0KIEVYUE9SVF9TWU1CT0woZHJt
X2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2Ry
bV9icmlkZ2UuaCBiL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAppbmRleCAxMWIyMGUyYTlmYzYu
LjIzMWY2MmNkNjgxZCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCisrKyBi
L2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaApAQCAtMjY0LDcgKzI2NCw4IEBAIHN0cnVjdCBkcm1f
YnJpZGdlX2Z1bmNzIHsKIAkgKiBwcmVjZWRpbmcgZWxlbWVudCBpcyBhIGJyaWRnZSB0aGlzIG1l
YW5zIGl0J3MgY2FsbGVkIGJlZm9yZSB0aGF0CiAJICogYnJpZGdlJ3MgQGF0b21pY19wcmVfZW5h
YmxlIG9yIEBwcmVfZW5hYmxlIGZ1bmN0aW9uLiBJZiB0aGUgcHJlY2VkaW5nCiAJICogZWxlbWVu
dCBpcyBhICZkcm1fZW5jb2RlciBpdCdzIGNhbGxlZCByaWdodCBiZWZvcmUgdGhlIGVuY29kZXIn
cwotCSAqICZkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MuYXRvbWljX2VuYWJsZSBob29rLgorCSAq
ICZkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MuYXRvbWljX2VuYWJsZSBob29rLiBUaGlzIGhvb2sg
aXMgcGFzc2VkIHRoZQorCSAqIG9sZCBicmlkZ2Ugc3RhdGUgKHRoZSBuZXcgb25lIGNhbiBiZSBy
ZXRyaWV2ZWQgZnJvbSBicmlkZ2UtPnN0YXRlKS4KIAkgKgogCSAqIFRoZSBkaXNwbGF5IHBpcGUg
KGkuZS4gY2xvY2tzIGFuZCB0aW1pbmcgc2lnbmFscykgZmVlZGluZyB0aGlzIGJyaWRnZQogCSAq
IHdpbGwgbm90IHlldCBiZSBydW5uaW5nIHdoZW4gdGhpcyBjYWxsYmFjayBpcyBjYWxsZWQuIFRo
ZSBicmlkZ2UgbXVzdApAQCAtMjgwLDcgKzI4MSw3IEBAIHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNz
IHsKIAkgKiBUaGUgQGF0b21pY19wcmVfZW5hYmxlIGNhbGxiYWNrIGlzIG9wdGlvbmFsLgogCSAq
LwogCXZvaWQgKCphdG9taWNfcHJlX2VuYWJsZSkoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwK
LQkJCQkgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisJCQkJICBzdHJ1Y3QgZHJt
X2JyaWRnZV9zdGF0ZSAqb2xkX2JyaWRnZV9zdGF0ZSk7CiAKIAkvKioKIAkgKiBAYXRvbWljX2Vu
YWJsZToKQEAgLTI5MCw3ICsyOTEsOSBAQCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7CiAJICog
cHJlY2VkaW5nIGVsZW1lbnQgaXMgYSBicmlkZ2UgdGhpcyBtZWFucyBpdCdzIGNhbGxlZCBhZnRl
ciB0aGF0CiAJICogYnJpZGdlJ3MgQGF0b21pY19lbmFibGUgb3IgQGVuYWJsZSBmdW5jdGlvbi4g
SWYgdGhlIHByZWNlZGluZyBlbGVtZW50CiAJICogaXMgYSAmZHJtX2VuY29kZXIgaXQncyBjYWxs
ZWQgcmlnaHQgYWZ0ZXIgdGhlIGVuY29kZXIncwotCSAqICZkcm1fZW5jb2Rlcl9oZWxwZXJfZnVu
Y3MuYXRvbWljX2VuYWJsZSBob29rLgorCSAqICZkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MuYXRv
bWljX2VuYWJsZSBob29rLiBUaGlzIGhvb2sgaXMgcGFzc2VkCisJICogdGhlIG9sZCBicmlkZ2Ug
c3RhdGUgKHRoZSBuZXcgb25lIGNhbiBiZSByZXRyaWV2ZWQgZnJvbQorCSAqIGJyaWRnZS0+c3Rh
dGUpLgogCSAqCiAJICogVGhlIGJyaWRnZSBjYW4gYXNzdW1lIHRoYXQgdGhlIGRpc3BsYXkgcGlw
ZSAoaS5lLiBjbG9ja3MgYW5kIHRpbWluZwogCSAqIHNpZ25hbHMpIGZlZWRpbmcgaXQgaXMgcnVu
bmluZyB3aGVuIHRoaXMgY2FsbGJhY2sgaXMgY2FsbGVkLiBUaGlzCkBAIC0zMDUsNyArMzA4LDcg
QEAgc3RydWN0IGRybV9icmlkZ2VfZnVuY3MgewogCSAqIFRoZSBlbmFibGUgY2FsbGJhY2sgaXMg
b3B0aW9uYWwuCiAJICovCiAJdm9pZCAoKmF0b21pY19lbmFibGUpKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsCi0JCQkgICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOworCQkJ
ICAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm9sZF9icmlkZ2Vfc3RhdGUpOwogCS8qKgog
CSAqIEBhdG9taWNfZGlzYWJsZToKIAkgKgpAQCAtMzE0LDcgKzMxNyw5IEBAIHN0cnVjdCBkcm1f
YnJpZGdlX2Z1bmNzIHsKIAkgKiBwcmVjZWRpbmcgZWxlbWVudCBpcyBhIGJyaWRnZSB0aGlzIG1l
YW5zIGl0J3MgY2FsbGVkIGJlZm9yZSB0aGF0CiAJICogYnJpZGdlJ3MgQGF0b21pY19kaXNhYmxl
IG9yIEBkaXNhYmxlIHZmdW5jLiBJZiB0aGUgcHJlY2VkaW5nIGVsZW1lbnQKIAkgKiBpcyBhICZk
cm1fZW5jb2RlciBpdCdzIGNhbGxlZCByaWdodCBiZWZvcmUgdGhlCi0JICogJmRybV9lbmNvZGVy
X2hlbHBlcl9mdW5jcy5hdG9taWNfZGlzYWJsZSBob29rLgorCSAqICZkcm1fZW5jb2Rlcl9oZWxw
ZXJfZnVuY3MuYXRvbWljX2Rpc2FibGUgaG9vay4gVGhpcyBob29rIGlzIHBhc3NlZAorCSAqIHRo
ZSBvbGQgYnJpZGdlIHN0YXRlICh0aGUgbmV3IG9uZSBjYW4gYmUgcmV0cmlldmVkIGZyb20KKwkg
KiBicmlkZ2UtPnN0YXRlKS4KIAkgKgogCSAqIFRoZSBicmlkZ2UgY2FuIGFzc3VtZSB0aGF0IHRo
ZSBkaXNwbGF5IHBpcGUgKGkuZS4gY2xvY2tzIGFuZCB0aW1pbmcKIAkgKiBzaWduYWxzKSBmZWVk
aW5nIGl0IGlzIHN0aWxsIHJ1bm5pbmcgd2hlbiB0aGlzIGNhbGxiYWNrIGlzIGNhbGxlZC4KQEAg
LTMyOCw3ICszMzMsNyBAQCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7CiAJICogVGhlIGRpc2Fi
bGUgY2FsbGJhY2sgaXMgb3B0aW9uYWwuCiAJICovCiAJdm9pZCAoKmF0b21pY19kaXNhYmxlKShz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAotCQkJICAgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSk7CisJCQkgICAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm9sZF9icmlk
Z2Vfc3RhdGUpOwogCiAJLyoqCiAJICogQGF0b21pY19wb3N0X2Rpc2FibGU6CkBAIC0zMzgsNyAr
MzQzLDkgQEAgc3RydWN0IGRybV9icmlkZ2VfZnVuY3MgewogCSAqIGVsZW1lbnQgaXMgYSBicmlk
Z2UgdGhpcyBtZWFucyBpdCdzIGNhbGxlZCBhZnRlciB0aGF0IGJyaWRnZSdzCiAJICogQGF0b21p
Y19wb3N0X2Rpc2FibGUgb3IgQHBvc3RfZGlzYWJsZSBmdW5jdGlvbi4gSWYgdGhlIHByZWNlZGlu
ZwogCSAqIGVsZW1lbnQgaXMgYSAmZHJtX2VuY29kZXIgaXQncyBjYWxsZWQgcmlnaHQgYWZ0ZXIg
dGhlIGVuY29kZXIncwotCSAqICZkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MuYXRvbWljX2Rpc2Fi
bGUgaG9vay4KKwkgKiAmZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzLmF0b21pY19kaXNhYmxlIGhv
b2suIFRoaXMgaG9vayBpcyBwYXNzZWQKKwkgKiB0aGUgb2xkIGJyaWRnZSBzdGF0ZSAodGhlIG5l
dyBvbmUgY2FuIGJlIHJldHJpZXZlZCBmcm9tCisJICogYnJpZGdlLT5zdGF0ZSkuCiAJICoKIAkg
KiBUaGUgYnJpZGdlIG11c3QgYXNzdW1lIHRoYXQgdGhlIGRpc3BsYXkgcGlwZSAoaS5lLiBjbG9j
a3MgYW5kIHRpbWluZwogCSAqIHNpZ25hbHMpIGZlZWRpbmcgaXQgaXMgbm8gbG9uZ2VyIHJ1bm5p
bmcgd2hlbiB0aGlzIGNhbGxiYWNrIGlzCkBAIC0zNTQsNyArMzYxLDcgQEAgc3RydWN0IGRybV9i
cmlkZ2VfZnVuY3MgewogCSAqIFRoZSBwb3N0X2Rpc2FibGUgY2FsbGJhY2sgaXMgb3B0aW9uYWwu
CiAJICovCiAJdm9pZCAoKmF0b21pY19wb3N0X2Rpc2FibGUpKHN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2UsCi0JCQkJICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisJCQkJICAg
IHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpvbGRfYnJpZGdlX3N0YXRlKTsKIAogCS8qKgogCSAq
IEBhdG9taWNfZHVwbGljYXRlX3N0YXRlOgotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
