Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F4072160505
	for <lists+dri-devel@lfdr.de>; Sun, 16 Feb 2020 18:27:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C019B6E45E;
	Sun, 16 Feb 2020 17:27:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav22.altibox.net (asav22.altibox.net [109.247.116.9])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 02D8A6E456
 for <dri-devel@lists.freedesktop.org>; Sun, 16 Feb 2020 17:27:03 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav22.altibox.net (Postfix) with ESMTPSA id 5ED46200E9;
 Sun, 16 Feb 2020 18:21:39 +0100 (CET)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: broonie@kernel.org,
	balbi@kernel.org,
	lee.jones@linaro.org
Subject: [RFC 2/9] mfd: Add driver for Multifunction USB Device
Date: Sun, 16 Feb 2020 18:21:10 +0100
Message-Id: <20200216172117.49832-3-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20200216172117.49832-1-noralf@tronnes.org>
References: <20200216172117.49832-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=ZvHD1ezG c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=jpOVt7BSZ2e4Z31A5e1TngXxSK0=:19 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10
 a=SJz97ENfAAAA:8 a=CUepv2jGAAAA:20 a=eErRC1Xa2moXgSPB7X0A:9
 a=ivkM6FztAEMVDUfN:21 a=V-uIEZzIEEd-kku2:21 a=QEXdDO2ut3YA:10
 a=vFet0B0WnEQeilDPIY6i:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-usb@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QSBNdWx0aWZ1bmN0aW9uIFVTQiBEZXZpY2UgaXMgYSBkZXZpY2UgdGhhdCBzdXBwb3J0cyBmdW5j
dGlvbnMgbGlrZSBncGlvCmFuZCBkaXNwbGF5IG9yIGFueSBvdGhlciBmdW5jdGlvbiB0aGF0IGNh
biBiZSByZXByZXNlbnRlZCBhcyBhIFVTQiByZWdtYXAuCkludGVycnVwdHMgb3ZlciBVU0IgaXMg
YWxzbyBzdXBwb3J0ZWQgaWYgc3VjaCBhbiBlbmRwb2ludCBpcyBwcmVzZW50LgoKU2lnbmVkLW9m
Zi1ieTogTm9yYWxmIFRyw7hubmVzIDxub3JhbGZAdHJvbm5lcy5vcmc+Ci0tLQogZHJpdmVycy9t
ZmQvS2NvbmZpZyAgICAgfCAgIDggKwogZHJpdmVycy9tZmQvTWFrZWZpbGUgICAgfCAgIDEgKwog
ZHJpdmVycy9tZmQvbXVkLmMgICAgICAgfCA1ODAgKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKwogaW5jbHVkZS9saW51eC9tZmQvbXVkLmggfCAgMTYgKysKIDQgZmlsZXMg
Y2hhbmdlZCwgNjA1IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL21m
ZC9tdWQuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvbGludXgvbWZkL211ZC5oCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9tZmQvS2NvbmZpZyBiL2RyaXZlcnMvbWZkL0tjb25maWcKaW5kZXgg
NTI4MThkYmNmZTFmLi45OTUwNzk0ZDkwN2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbWZkL0tjb25m
aWcKKysrIGIvZHJpdmVycy9tZmQvS2NvbmZpZwpAQCAtMTk2OCw2ICsxOTY4LDE0IEBAIGNvbmZp
ZyBNRkRfU1RNRlgKIAkgIGFkZGl0aW9uYWwgZHJpdmVycyBtdXN0IGJlIGVuYWJsZWQgaW4gb3Jk
ZXIgdG8gdXNlIHRoZSBmdW5jdGlvbmFsaXR5CiAJICBvZiB0aGUgZGV2aWNlLgogCitjb25maWcg
TUZEX01VRAorCXRyaXN0YXRlICJNdWx0aWZ1bmN0aW9uIFVTQiBEZXZpY2UgY29yZSBkcml2ZXIi
CisJZGVwZW5kcyBvbiBVU0IKKwlzZWxlY3QgTUZEX0NPUkUKKwlzZWxlY3QgUkVHTUFQX1VTQgor
CWhlbHAKKwkgIFNlbGVjdCB0aGlzIHRvIGdldCBzdXBwb3J0IGZvciB0aGUgTXVsdGlmdW5jdGlv
biBVU0IgRGV2aWNlLgorCiBtZW51ICJNdWx0aW1lZGlhIENhcGFiaWxpdGllcyBQb3J0IGRyaXZl
cnMiCiAJZGVwZW5kcyBvbiBBUkNIX1NBMTEwMAogCmRpZmYgLS1naXQgYS9kcml2ZXJzL21mZC9N
YWtlZmlsZSBiL2RyaXZlcnMvbWZkL01ha2VmaWxlCmluZGV4IDI5ZTY3NjdkZDYwYy4uMGFkZmFi
OWFmYWVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL21mZC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL21m
ZC9NYWtlZmlsZQpAQCAtMjU1LDQgKzI1NSw1IEBAIG9iai0kKENPTkZJR19NRkRfUk9ITV9CRDcw
NTI4KQkrPSByb2htLWJkNzA1Mjgubwogb2JqLSQoQ09ORklHX01GRF9ST0hNX0JENzE4WFgpCSs9
IHJvaG0tYmQ3MTh4Ny5vCiBvYmotJChDT05GSUdfTUZEX1NUTUZYKSAJKz0gc3RtZngubwogb2Jq
LSQoQ09ORklHX01GRF9SUElTRU5TRV9DT1JFKQkrPSBycGlzZW5zZS1jb3JlLm8KK29iai0kKENP
TkZJR19NRkRfTVVEKQkJKz0gbXVkLm8KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9tZmQvbXVkLmMg
Yi9kcml2ZXJzL21mZC9tdWQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLmY1ZjMxNDc4NjU2ZAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvbWZkL211ZC5jCkBA
IC0wLDAgKzEsNTgwIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vci1s
YXRlcgorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNs
dWRlIDxsaW51eC9iaXRtYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KKyNpbmNs
dWRlIDxsaW51eC9pcnEuaD4KKyNpbmNsdWRlIDxsaW51eC9pcnFkb21haW4uaD4KKyNpbmNsdWRl
IDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvbWZkL2NvcmUuaD4KKyNpbmNsdWRlIDxs
aW51eC9tZmQvbXVkLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGlu
dXgvcmVnbWFwLmg+CisjaW5jbHVkZSA8bGludXgvcmVnbWFwX3VzYi5oPgorI2luY2x1ZGUgPGxp
bnV4L3NlcV9maWxlLmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4
L3NwaW5sb2NrLmg+CisjaW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGludXgvd29y
a3F1ZXVlLmg+CisKKy8qIFRlbXBvcmFyeSBkZWJ1Z2dpbmcgYWlkICovCisjdW5kZWYgZGV2X2Ri
ZworI2RlZmluZSBkZXZfZGJnIGRldl9pbmZvCisKKyNkZWZpbmUgbWRlYnVnKGZtdCwgLi4uKQkJ
CVwKK2RvIHsJCQkJCQlcCisJaWYgKDEpCQkJCQlcCisJCXByX2RlYnVnKGZtdCwgIyNfX1ZBX0FS
R1NfXyk7CVwKK30gd2hpbGUgKDApCisKK3N0cnVjdCBtdWRfaXJxX2V2ZW50IHsKKwlzdHJ1Y3Qg
bGlzdF9oZWFkIG5vZGU7CisJREVDTEFSRV9CSVRNQVAoc3RhdHVzLCBSRUdNQVBfVVNCX01BWF9N
QVBTKTsKK307CisKK3N0cnVjdCBtdWRfaXJxIHsKKwlzdHJ1Y3QgaXJxX2RvbWFpbiAqZG9tYWlu
OworCXVuc2lnbmVkIGludCBudW1faXJxczsKKworCXN0cnVjdCB3b3JrcXVldWVfc3RydWN0CSp3
b3JrcTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29yazsKKwlzdHJ1Y3QgdXJiICp1cmI7CisKKwlz
cGlubG9ja190IGxvY2s7IC8qIFByb3RlY3QgdGhlIHZhbHVlcyBiZWxvdyAqLworCXVuc2lnbmVk
IGxvbmcgKm1hc2s7CisJdTE2IHRhZzsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGV2ZW50bGlzdDsKKwor
CXVuc2lnbmVkIGludCBzdGF0c19pbGxlZ2FsOworCXVuc2lnbmVkIGludCBzdGF0c19hbHJlYWR5
X3NlZW47CisJdW5zaWduZWQgaW50IHN0YXRzX2xvc3Q7Cit9OworCitzdHJ1Y3QgbXVkX2Rldmlj
ZSB7CisJc3RydWN0IHVzYl9kZXZpY2UgKnVzYjsKKwlzdHJ1Y3QgbXVkX2lycSAqbWlycTsKKwlz
dHJ1Y3QgbWZkX2NlbGwgKmNlbGxzOworCXVuc2lnbmVkIGludCBudW1fY2VsbHM7Cit9OworCitz
dGF0aWMgdm9pZCBtdWRfaXJxX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0
cnVjdCBtdWRfaXJxICptaXJxID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBtdWRfaXJxLCB3
b3JrKTsKKwlzdHJ1Y3QgbXVkX2lycV9ldmVudCAqZXZlbnQ7CisJdW5zaWduZWQgbG9uZyBuLCBm
bGFnczsKKwl1bnNpZ25lZCBpbnQgaXJxOworCisJbWRlYnVnKCIlczogSU5cbiIsIF9fZnVuY19f
KTsKKworCXdoaWxlICh0cnVlKSB7CisJCXNwaW5fbG9ja19pcnFzYXZlKCZtaXJxLT5sb2NrLCBm
bGFncyk7CisJCWV2ZW50ID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZtaXJxLT5ldmVudGxp
c3QsIHN0cnVjdCBtdWRfaXJxX2V2ZW50LCBub2RlKTsKKwkJaWYgKGV2ZW50KSB7CisJCQlsaXN0
X2RlbCgmZXZlbnQtPm5vZGUpOworCQkJbWRlYnVnKCIgICAgc3RhdHVzOiAlKnBiXG4iLCBtaXJx
LT5udW1faXJxcywgZXZlbnQtPnN0YXR1cyk7CisJCQliaXRtYXBfYW5kKGV2ZW50LT5zdGF0dXMs
IGV2ZW50LT5zdGF0dXMsIG1pcnEtPm1hc2ssIG1pcnEtPm51bV9pcnFzKTsKKwkJfQorCQlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZtaXJxLT5sb2NrLCBmbGFncyk7CisJCWlmICghZXZlbnQpCisJ
CQlicmVhazsKKworCQlmb3JfZWFjaF9zZXRfYml0KG4sIGV2ZW50LT5zdGF0dXMsIG1pcnEtPm51
bV9pcnFzKSB7CisJCQlpcnEgPSBpcnFfZmluZF9tYXBwaW5nKG1pcnEtPmRvbWFpbiwgbik7CisJ
CQltZGVidWcoIiAgICAgICAgbj0lbHUgaXJxPSV1XG4iLCBuLCBpcnEpOworCQkJaWYgKGlycSkK
KwkJCQloYW5kbGVfbmVzdGVkX2lycShpcnEpOworCQl9CisKKwkJa2ZyZWUoZXZlbnQpOworCX0K
KworCW1kZWJ1ZygiJXM6IE9VVFxuIiwgX19mdW5jX18pOworfQorCisjZGVmaW5lIEJZVEVTX1BF
Ul9MT05HCShCSVRTX1BFUl9MT05HIC8gQklUU19QRVJfQllURSkKKworc3RhdGljIHZvaWQgbXVk
X2lycV9xdWV1ZShzdHJ1Y3QgdXJiICp1cmIpCit7CisJdTggKmJ1ZiA9IHVyYi0+dHJhbnNmZXJf
YnVmZmVyICsgc2l6ZW9mKHUxNik7CisJc3RydWN0IG11ZF9pcnEgKm1pcnEgPSB1cmItPmNvbnRl
eHQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJnVyYi0+ZGV2LT5kZXY7CisJc3RydWN0IG11ZF9p
cnFfZXZlbnQgKmV2ZW50ID0gTlVMTDsKKwl1bnNpZ25lZCBpbnQgaSwgdGFnLCBkaWZmOworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlpZiAodXJiLT5hY3R1YWxfbGVuZ3RoICE9IHVyYi0+dHJh
bnNmZXJfYnVmZmVyX2xlbmd0aCkgeworCQlkZXZfZXJyX29uY2UoZGV2LCAiSW50ZXJydXB0IHBh
Y2tldCB3cm9uZyBsZW5ndGg6ICV1XG4iLAorCQkJICAgICB1cmItPmFjdHVhbF9sZW5ndGgpOwor
CQltaXJxLT5zdGF0c19pbGxlZ2FsKys7CisJCXJldHVybjsKKwl9CisKKwlzcGluX2xvY2tfaXJx
c2F2ZSgmbWlycS0+bG9jaywgZmxhZ3MpOworCisJdGFnID0gbGUxNl90b19jcHVwKHVyYi0+dHJh
bnNmZXJfYnVmZmVyKTsKKwlpZiAodGFnID09IG1pcnEtPnRhZykgeworCQlkZXZfZGJnKGRldiwg
IkludGVycnVwdCB0YWc9JXUgYWxyZWFkeSBzZWVuLCBpZ25vcmluZ1xuIiwgdGFnKTsKKwkJbWly
cS0+c3RhdHNfYWxyZWFkeV9zZWVuKys7CisJCWdvdG8gdW5sb2NrOworCX0KKworCWlmICh0YWcg
PiBtaXJxLT50YWcpCisJCWRpZmYgPSB0YWcgLSBtaXJxLT50YWc7CisJZWxzZQorCQlkaWZmID0g
VTE2X01BWCAtIG1pcnEtPnRhZyArIHRhZyArIDE7CisKKwlpZiAoZGlmZiA+IDEpIHsKKwkJZGV2
X2Vycl9vbmNlKGRldiwgIkludGVycnVwdHMgbG9zdDogJXVcbiIsIGRpZmYgLSAxKTsKKwkJbWly
cS0+c3RhdHNfbG9zdCArPSBkaWZmIC0gMTsKKwl9CisKKwlldmVudCA9IGt6YWxsb2Moc2l6ZW9m
KCpldmVudCksIEdGUF9BVE9NSUMpOworCWlmICghZXZlbnQpIHsKKwkJbWlycS0+c3RhdHNfbG9z
dCArPSAxOworCQlnb3RvIHVubG9jazsKKwl9CisKKwlsaXN0X2FkZF90YWlsKCZldmVudC0+bm9k
ZSwgJm1pcnEtPmV2ZW50bGlzdCk7CisKKwlmb3IgKGkgPSAwOyBpIDwgKHVyYi0+dHJhbnNmZXJf
YnVmZmVyX2xlbmd0aCAtIHNpemVvZih1MTYpKTsgaSsrKSB7CisJCXVuc2lnbmVkIGxvbmcgKnZh
bCA9ICZldmVudC0+c3RhdHVzW2kgLyBCWVRFU19QRVJfTE9OR107CisJCXVuc2lnbmVkIGludCBt
b2QgPSBpICUgQllURVNfUEVSX0xPTkc7CisKKwkJaWYgKCFtb2QpCisJCQkqdmFsID0gYnVmW2ld
OworCQllbHNlCisJCQkqdmFsIHw9ICgodW5zaWduZWQgbG9uZylidWZbaV0pIDw8IChtb2QgKiBC
SVRTX1BFUl9CWVRFKTsKKwl9CisKKwltZGVidWcoIiVzOiB0YWc9JXVcbiIsIF9fZnVuY19fLCB0
YWcpOworCisJbWlycS0+dGFnID0gdGFnOwordW5sb2NrOgorCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJm1pcnEtPmxvY2ssIGZsYWdzKTsKKworCWlmIChldmVudCkKKwkJcXVldWVfd29yayhtaXJx
LT53b3JrcSwgJm1pcnEtPndvcmspOworfQorCitzdGF0aWMgdm9pZCBtdWRfaXJxX3VyYl9jb21w
bGV0aW9uKHN0cnVjdCB1cmIgKnVyYikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmdXJiLT5k
ZXYtPmRldjsKKwlpbnQgcmV0OworCisJbWRlYnVnKCIlczogYWN0dWFsX2xlbmd0aD0ldVxuIiwg
X19mdW5jX18sIHVyYi0+YWN0dWFsX2xlbmd0aCk7CisKKwlzd2l0Y2ggKHVyYi0+c3RhdHVzKSB7
CisJY2FzZSAwOgorCQltdWRfaXJxX3F1ZXVlKHVyYik7CisJCWJyZWFrOworCWNhc2UgLUVQUk9U
TzoJLyogRklYTUU6IHZlcmlmeTogZHdjMiByZXBvcnRzIHRoaXMgb24gZGlzY29ubmVjdCAqLwor
CWNhc2UgLUVDT05OUkVTRVQ6CisJY2FzZSAtRU5PRU5UOgorCWNhc2UgLUVTSFVURE9XTjoKKwkJ
ZGV2X2RiZyhkZXYsICJpcnEgdXJiIHNodXR0aW5nIGRvd24gd2l0aCBzdGF0dXM6ICVkXG4iLCB1
cmItPnN0YXR1cyk7CisJCXJldHVybjsKKwlkZWZhdWx0OgorCQlkZXZfZGJnKGRldiwgImlycSB1
cmIgZmFpbHVyZSB3aXRoIHN0YXR1czogJWRcbiIsIHVyYi0+c3RhdHVzKTsKKwkJYnJlYWs7CisJ
fQorCisJcmV0ID0gdXNiX3N1Ym1pdF91cmIodXJiLCBHRlBfQVRPTUlDKTsKKwlpZiAocmV0ICYm
IHJldCAhPSAtRU5PREVWKQorCQlkZXZfZXJyKGRldiwgImlycSB1c2Jfc3VibWl0X3VyYiBmYWls
ZWQgd2l0aCByZXN1bHQgJWRcbiIsIHJldCk7Cit9CisKK3N0YXRpYyB2b2lkIG11ZF9pcnFfbWFz
ayhzdHJ1Y3QgaXJxX2RhdGEgKmRhdGEpCit7CisJc3RydWN0IG11ZF9pcnEgKm1pcnEgPSBpcnFf
ZGF0YV9nZXRfaXJxX2NoaXBfZGF0YShkYXRhKTsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJ
bWRlYnVnKCIlczogaHdpcnE9JWx1XG4iLCBfX2Z1bmNfXywgZGF0YS0+aHdpcnEpOworCisJc3Bp
bl9sb2NrX2lycXNhdmUoJm1pcnEtPmxvY2ssIGZsYWdzKTsKKwljbGVhcl9iaXQoZGF0YS0+aHdp
cnEsIG1pcnEtPm1hc2spOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJm1pcnEtPmxvY2ssIGZs
YWdzKTsKK30KKworc3RhdGljIHZvaWQgbXVkX2lycV91bm1hc2soc3RydWN0IGlycV9kYXRhICpk
YXRhKQoreworCXN0cnVjdCBtdWRfaXJxICptaXJxID0gaXJxX2RhdGFfZ2V0X2lycV9jaGlwX2Rh
dGEoZGF0YSk7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCW1kZWJ1ZygiJXM6IGh3aXJxPSVs
dVxuIiwgX19mdW5jX18sIGRhdGEtPmh3aXJxKTsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZtaXJx
LT5sb2NrLCBmbGFncyk7CisJc2V0X2JpdChkYXRhLT5od2lycSwgbWlycS0+bWFzayk7CisJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmbWlycS0+bG9jaywgZmxhZ3MpOworfQorCitzdGF0aWMgc3Ry
dWN0IGlycV9jaGlwIG11ZF9pcnFfY2hpcCA9IHsKKwkubmFtZQkJCT0gIm11ZC1pcnEiLAorCS5p
cnFfbWFzawkJPSBtdWRfaXJxX21hc2ssCisJLmlycV91bm1hc2sJCT0gbXVkX2lycV91bm1hc2ss
Cit9OworCitzdGF0aWMgdm9pZCBfX21heWJlX3VudXNlZAorbXVkX2lycV9kb21haW5fZGVidWdf
c2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpcnFfZG9tYWluICpkLAorCQkJICBzdHJ1
Y3QgaXJxX2RhdGEgKmRhdGEsIGludCBpbmQpCit7CisJc3RydWN0IG11ZF9pcnEgKm1pcnEgPSBk
ID8gZC0+aG9zdF9kYXRhIDogaXJxX2RhdGFfZ2V0X2lycV9jaGlwX2RhdGEoZGF0YSk7CisJdW5z
aWduZWQgbG9uZyBmbGFnczsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZtaXJxLT5sb2NrLCBmbGFn
cyk7CisKKwlzZXFfcHJpbnRmKG0sICIlKnNUYWc6ICAgICAgICAgICV1XG4iLCBpbmQsICIiLCBt
aXJxLT50YWcpOworCXNlcV9wcmludGYobSwgIiUqc0lsbGVnYWw6ICAgICAgJXVcbiIsIGluZCwg
IiIsIG1pcnEtPnN0YXRzX2lsbGVnYWwpOworCXNlcV9wcmludGYobSwgIiUqc0FscmVhZHkgc2Vl
bjogJXVcbiIsIGluZCwgIiIsIG1pcnEtPnN0YXRzX2FscmVhZHlfc2Vlbik7CisJc2VxX3ByaW50
ZihtLCAiJSpzTG9zdDogICAgICAgICAldVxuIiwgaW5kLCAiIiwgbWlycS0+c3RhdHNfbG9zdCk7
CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZtaXJxLT5sb2NrLCBmbGFncyk7Cit9CisKK3N0
YXRpYyBpbnQgbXVkX2lycV9kb21haW5fbWFwKHN0cnVjdCBpcnFfZG9tYWluICpkLCB1bnNpZ25l
ZCBpbnQgdmlycSwKKwkJCSAgICAgIGlycV9od19udW1iZXJfdCBod2lycSkKK3sKKwlpcnFfc2V0
X2NoaXBfZGF0YSh2aXJxLCBkLT5ob3N0X2RhdGEpOworCWlycV9zZXRfY2hpcF9hbmRfaGFuZGxl
cih2aXJxLCAmbXVkX2lycV9jaGlwLCBoYW5kbGVfc2ltcGxlX2lycSk7CisJaXJxX3NldF9uZXN0
ZWRfdGhyZWFkKHZpcnEsIHRydWUpOworCWlycV9zZXRfbm9wcm9iZSh2aXJxKTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgdm9pZCBtdWRfaXJxX2RvbWFpbl91bm1hcChzdHJ1Y3QgaXJxX2Rv
bWFpbiAqZCwgdW5zaWduZWQgaW50IHZpcnEpCit7CisJaXJxX3NldF9jaGlwX2FuZF9oYW5kbGVy
KHZpcnEsIE5VTEwsIE5VTEwpOworCWlycV9zZXRfY2hpcF9kYXRhKHZpcnEsIE5VTEwpOworfQor
CitzdGF0aWMgY29uc3Qgc3RydWN0IGlycV9kb21haW5fb3BzIG11ZF9pcnFfb3BzID0geworCS5t
YXAJCT0gbXVkX2lycV9kb21haW5fbWFwLAorCS51bm1hcAkJPSBtdWRfaXJxX2RvbWFpbl91bm1h
cCwKKyNpZmRlZiBDT05GSUdfR0VORVJJQ19JUlFfREVCVUdGUworCS5kZWJ1Z19zaG93CT0gbXVk
X2lycV9kb21haW5fZGVidWdfc2hvdywKKyNlbmRpZgorfTsKKworc3RhdGljIGludCBtdWRfaXJx
X3N0YXJ0KHN0cnVjdCBtdWRfaXJxICptaXJxKQoreworCWlmICghbWlycSkKKwkJcmV0dXJuIDA7
CisKKwlyZXR1cm4gdXNiX3N1Ym1pdF91cmIobWlycS0+dXJiLCBHRlBfS0VSTkVMKTsKK30KKwor
c3RhdGljIHZvaWQgbXVkX2lycV9zdG9wKHN0cnVjdCBtdWRfaXJxICptaXJxKQoreworCWlmICgh
bWlycSkKKwkJcmV0dXJuOworCisJdXNiX2tpbGxfdXJiKG1pcnEtPnVyYik7CisJZmx1c2hfd29y
aygmbWlycS0+d29yayk7Cit9CisKK3N0YXRpYyB2b2lkIG11ZF9pcnFfcmVsZWFzZShzdHJ1Y3Qg
bXVkX2lycSAqbWlycSkKK3sKKwlpZiAoIW1pcnEpCisJCXJldHVybjsKKworCWlmIChtaXJxLT53
b3JrcSkKKwkJZGVzdHJveV93b3JrcXVldWUobWlycS0+d29ya3EpOworCisJaWYgKG1pcnEtPmRv
bWFpbikgeworCQlpcnFfaHdfbnVtYmVyX3QgaHdpcnE7CisKKwkJZm9yIChod2lycSA9IDA7IGh3
aXJxIDwgbWlycS0+bnVtX2lycXM7IGh3aXJxKyspCisJCQlpcnFfZGlzcG9zZV9tYXBwaW5nKGly
cV9maW5kX21hcHBpbmcobWlycS0+ZG9tYWluLCBod2lycSkpOworCisJCWlycV9kb21haW5fcmVt
b3ZlKG1pcnEtPmRvbWFpbik7CisJfQorCisJdXNiX2ZyZWVfY29oZXJlbnQobWlycS0+dXJiLT5k
ZXYsIG1pcnEtPnVyYi0+dHJhbnNmZXJfYnVmZmVyX2xlbmd0aCwKKwkJCSAgbWlycS0+dXJiLT50
cmFuc2Zlcl9idWZmZXIsIG1pcnEtPnVyYi0+dHJhbnNmZXJfZG1hKTsKKwl1c2JfZnJlZV91cmIo
bWlycS0+dXJiKTsKKwliaXRtYXBfZnJlZShtaXJxLT5tYXNrKTsKKwlrZnJlZShtaXJxKTsKK30K
Kworc3RhdGljIHN0cnVjdCBtdWRfaXJxICptdWRfaXJxX2NyZWF0ZShzdHJ1Y3QgdXNiX2ludGVy
ZmFjZSAqaW50ZXJmYWNlLAorCQkJCSAgICAgIHVuc2lnbmVkIGludCBudW1faXJxcykKK3sKKwlz
dHJ1Y3QgdXNiX2RldmljZSAqdXNiID0gaW50ZXJmYWNlX3RvX3VzYmRldihpbnRlcmZhY2UpOwor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpbnRlcmZhY2UtPmRldjsKKwlzdHJ1Y3QgdXNiX2VuZHBv
aW50X2Rlc2NyaXB0b3IgKmVwOworCXN0cnVjdCBmd25vZGVfaGFuZGxlICpmbjsKKwlzdHJ1Y3Qg
dXJiICp1cmIgPSBOVUxMOworCXN0cnVjdCBtdWRfaXJxICptaXJxOworCXZvaWQgKmJ1ZiA9IE5V
TEw7CisJc2l6ZV90IGJ1Zl9zaXplOworCWludCByZXQ7CisKKwltZGVidWcoIiVzOiBkZXYtPmlk
PSVkXG4iLCBfX2Z1bmNfXywgZGV2LT5pZCk7CisKKwlyZXQgPSB1c2JfZmluZF9pbnRfaW5fZW5k
cG9pbnQoaW50ZXJmYWNlLT5jdXJfYWx0c2V0dGluZywgJmVwKTsKKwlpZiAocmV0ID09IC1FTlhJ
TykKKwkJcmV0dXJuIE5VTEw7CisJaWYgKHJldCkKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwor
CW1pcnEgPSBremFsbG9jKHNpemVvZigqbWlycSksIEdGUF9LRVJORUwpOworCWlmICghbWlycSkK
KwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwltaXJxLT5tYXNrID0gYml0bWFwX3phbGxv
YyhudW1faXJxcywgR0ZQX0tFUk5FTCk7CisJaWYgKCFtaXJxLT5tYXNrKSB7CisJCXJldCA9IC1F
Tk9NRU07CisJCWdvdG8gcmVsZWFzZTsKKwl9CisKKwlzcGluX2xvY2tfaW5pdCgmbWlycS0+bG9j
ayk7CisJbWlycS0+bnVtX2lycXMgPSBudW1faXJxczsKKworCXVyYiA9IHVzYl9hbGxvY191cmIo
MCwgR0ZQX0tFUk5FTCk7CisJaWYgKCF1cmIpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBy
ZWxlYXNlOworCX0KKworCWJ1Zl9zaXplID0gdXNiX2VuZHBvaW50X21heHAoZXApOworCWlmIChi
dWZfc2l6ZSAhPSAoc2l6ZW9mKHUxNikgKyBESVZfUk9VTkRfVVAobnVtX2lycXMsIEJJVFNfUEVS
X0JZVEUpKSkgeworCQlkZXZfZXJyKGRldiwgIkludGVycnVwdCBlbmRwb2ludCB3TWF4UGFja2V0
U2l6ZSB0b28gc21hbGw6ICV6dVxuIiwgYnVmX3NpemUpOworCQlyZXQgPSAtRUlOVkFMOworCQln
b3RvIHJlbGVhc2U7CisJfQorCisJYnVmID0gdXNiX2FsbG9jX2NvaGVyZW50KHVzYiwgYnVmX3Np
emUsIEdGUF9LRVJORUwsICZ1cmItPnRyYW5zZmVyX2RtYSk7CisJaWYgKCFidWYpIHsKKwkJdXNi
X2ZyZWVfdXJiKHVyYik7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gcmVsZWFzZTsKKwl9CisK
Kwl1c2JfZmlsbF9pbnRfdXJiKHVyYiwgdXNiLAorCQkJIHVzYl9yY3ZpbnRwaXBlKHVzYiwgdXNi
X2VuZHBvaW50X251bShlcCkpLAorCQkJIGJ1ZiwgYnVmX3NpemUsIG11ZF9pcnFfdXJiX2NvbXBs
ZXRpb24sCisJCQkgbWlycSwgZXAtPmJJbnRlcnZhbCk7CisJdXJiLT50cmFuc2Zlcl9mbGFncyB8
PSBVUkJfTk9fVFJBTlNGRVJfRE1BX01BUDsKKworCW1pcnEtPnVyYiA9IHVyYjsKKworCWlmIChk
ZXYtPm9mX25vZGUpIHsKKwkJZm4gPSBvZl9ub2RlX3RvX2Z3bm9kZShkZXYtPm9mX25vZGUpOwor
CX0gZWxzZSB7CisJCWZuID0gaXJxX2RvbWFpbl9hbGxvY19uYW1lZF9md25vZGUoIm11ZC1pcnEi
KTsKKwkJaWYgKCFmbikgeworCQkJcmV0ID0gLUVOT01FTTsKKwkJCWdvdG8gcmVsZWFzZTsKKwkJ
fQorCX0KKworCW1pcnEtPmRvbWFpbiA9IGlycV9kb21haW5fY3JlYXRlX2xpbmVhcihmbiwgbnVt
X2lycXMsICZtdWRfaXJxX29wcywgbWlycSk7CisJaWYgKCFkZXYtPm9mX25vZGUpCisJCWlycV9k
b21haW5fZnJlZV9md25vZGUoZm4pOworCWlmICghbWlycS0+ZG9tYWluKSB7CisJCXJldCA9IC1F
Tk9NRU07CisJCWdvdG8gcmVsZWFzZTsKKwl9CisKKwlJTklUX0xJU1RfSEVBRCgmbWlycS0+ZXZl
bnRsaXN0KTsKKwlJTklUX1dPUksoJm1pcnEtPndvcmssIG11ZF9pcnFfd29yayk7CisKKwltaXJx
LT53b3JrcSA9IGFsbG9jX3dvcmtxdWV1ZSgibXVkLWlycS8lcyIsIFdRX0hJR0hQUkksIDAsIGRl
dl9uYW1lKGRldikpOworCWlmICghbWlycS0+d29ya3EpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJ
Z290byByZWxlYXNlOworCX0KKworCXJldHVybiBtaXJxOworCityZWxlYXNlOgorCW11ZF9pcnFf
cmVsZWFzZShtaXJxKTsKKworCXJldHVybiBFUlJfUFRSKHJldCk7Cit9CisKK3N0YXRpYyBpbnQg
bXVkX3Byb2JlX3JlZ21hcChzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJmYWNlLCBzdHJ1Y3Qg
bWZkX2NlbGwgKmNlbGwsCisJCQkgICAgdW5zaWduZWQgaW50IGluZGV4LCBzdHJ1Y3QgbXVkX2ly
cSAqbWlycSkKK3sKKwlzdHJ1Y3QgbXVkX2NlbGxfcGRhdGEgKnBkYXRhOworCXN0cnVjdCByZXNv
dXJjZSAqcmVzID0gTlVMTDsKKwlpbnQgcmV0OworCisJcGRhdGEgPSBremFsbG9jKHNpemVvZigq
cGRhdGEpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXBkYXRhKQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CXJldCA9IHJlZ21hcF91c2JfZ2V0X21hcF9kZXNjcmlwdG9yKGludGVyZmFjZSwgaW5kZXgsICZw
ZGF0YS0+ZGVzYyk7CisJaWYgKHJldCkKKwkJZ290byBlcnJvcjsKKworCW1kZWJ1ZygiJXM6IG5h
bWU9JyVzJyBpbmRleD0ldVxuIiwgX19mdW5jX18sIHBkYXRhLT5kZXNjLm5hbWUsIGluZGV4KTsK
KwltZGVidWcoIiAgICBiUmVnaXN0ZXJWYWx1ZUJpdHM9JXVcbiIsIHBkYXRhLT5kZXNjLmJSZWdp
c3RlclZhbHVlQml0cyk7CisJbWRlYnVnKCIgICAgYkNvbXByZXNzaW9uPTB4JTAyeFxuIiwgcGRh
dGEtPmRlc2MuYkNvbXByZXNzaW9uKTsKKwltZGVidWcoIiAgICBiTWF4VHJhbnNmZXJTaXplT3Jk
ZXI9JXUgKCV1a0IpXG4iLAorCSAgICAgICBwZGF0YS0+ZGVzYy5iTWF4VHJhbnNmZXJTaXplT3Jk
ZXIsCisJICAgICAgICgxIDw8IHBkYXRhLT5kZXNjLmJNYXhUcmFuc2ZlclNpemVPcmRlcikgLyAx
MDI0KTsKKworCWlmIChtaXJxKSB7CisJCXJlcyA9IGt6YWxsb2Moc2l6ZW9mKCpyZXMpLCBHRlBf
S0VSTkVMKTsKKwkJaWYgKCFyZXMpIHsKKwkJCXJldCA9IC1FTk9NRU07CisJCQlnb3RvIGVycm9y
OworCQl9CisKKwkJcmVzLT5mbGFncyA9IElPUkVTT1VSQ0VfSVJROworCQlyZXMtPnN0YXJ0ID0g
aXJxX2NyZWF0ZV9tYXBwaW5nKG1pcnEtPmRvbWFpbiwgaW5kZXgpOworCQltZGVidWcoIiAgICBy
ZXMtPnN0YXJ0PSV1XG4iLCAodW5zaWduZWQgaW50KXJlcy0+c3RhcnQpOworCQlyZXMtPmVuZCA9
IHJlcy0+c3RhcnQ7CisKKwkJY2VsbC0+cmVzb3VyY2VzID0gcmVzOworCQljZWxsLT5udW1fcmVz
b3VyY2VzID0gMTsKKwl9CisKKwlwZGF0YS0+aW50ZXJmYWNlID0gaW50ZXJmYWNlOworCXBkYXRh
LT5pbmRleCA9IGluZGV4OworCWNlbGwtPm5hbWUgPSBwZGF0YS0+ZGVzYy5uYW1lOworCWNlbGwt
PnBsYXRmb3JtX2RhdGEgPSBwZGF0YTsKKwljZWxsLT5wZGF0YV9zaXplID0gc2l6ZW9mKCpwZGF0
YSk7CisJLyoKKwkgKiBBIE11bHRpZnVuY3Rpb24gVVNCIERldmljZSBjYW4gaGF2ZSBtdWx0aXBs
ZSBmdW5jdGlvbnMgb2YgdGhlIHNhbWUKKwkgKiB0eXBlLiBtZmRfYWRkX2RldmljZSgpIGluIGl0
cyBjdXJyZW50IGZvcm0gd2lsbCBvbmx5IG1hdGNoIG9uIHRoZQorCSAqIGZpcnN0IG5vZGUgaW4g
dGhlIERldmljZSBUcmVlLgorCSAqLworCWNlbGwtPm9mX2NvbXBhdGlibGUgPSBjZWxsLT5uYW1l
OworCisJcmV0dXJuIDA7CisKK2Vycm9yOgorCWtmcmVlKHJlcyk7CisJa2ZyZWUocGRhdGEpOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgbXVkX2ZyZWUoc3RydWN0IG11ZF9kZXZp
Y2UgKm11ZCkKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKworCW11ZF9pcnFfcmVsZWFzZShtdWQtPm1p
cnEpOworCisJZm9yIChpID0gMDsgaSA8IG11ZC0+bnVtX2NlbGxzOyBpKyspIHsKKwkJa2ZyZWUo
bXVkLT5jZWxsc1tpXS5wbGF0Zm9ybV9kYXRhKTsKKwkJa2ZyZWUobXVkLT5jZWxsc1tpXS5yZXNv
dXJjZXMpOworCX0KKworCWtmcmVlKG11ZC0+Y2VsbHMpOworCWtmcmVlKG11ZCk7Cit9CisKK3N0
YXRpYyBpbnQgbXVkX3Byb2JlKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsCisJCSAg
ICAgY29uc3Qgc3RydWN0IHVzYl9kZXZpY2VfaWQgKmlkKQoreworCXN0cnVjdCBkZXZpY2UgKmRl
diA9ICZpbnRlcmZhY2UtPmRldjsKKwl1bnNpZ25lZCBpbnQgaSwgbnVtX3JlZ21hcHM7CisJc3Ry
dWN0IG11ZF9kZXZpY2UgKm11ZDsKKwlpbnQgcmV0OworCisJbWRlYnVnKCIlczogaW50ZXJmYWNl
LT5kZXYub2Zfbm9kZT0lcHggdXNiLT5kZXYub2Zfbm9kZT0lcHgiLAorCSAgICAgICBfX2Z1bmNf
XywgaW50ZXJmYWNlLT5kZXYub2Zfbm9kZSwKKwkgICAgICAgdXNiX2dldF9kZXYoaW50ZXJmYWNl
X3RvX3VzYmRldihpbnRlcmZhY2UpKS0+ZGV2Lm9mX25vZGUpOworCisJcmV0ID0gcmVnbWFwX3Vz
Yl9nZXRfaW50ZXJmYWNlX2Rlc2NyaXB0b3IoaW50ZXJmYWNlLCAmbnVtX3JlZ21hcHMpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisJaWYgKCFudW1fcmVnbWFwcykKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwltZGVidWcoIiVzOiBudW1fcmVnbWFwcz0ldVxuIiwgX19mdW5jX18sIG51bV9yZWdt
YXBzKTsKKworCW11ZCA9IGt6YWxsb2Moc2l6ZW9mKCptdWQpLCBHRlBfS0VSTkVMKTsKKwlpZiAo
IW11ZCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwltdWQtPm1pcnEgPSBtdWRfaXJxX2NyZWF0ZShp
bnRlcmZhY2UsIG51bV9yZWdtYXBzKTsKKwlpZiAoSVNfRVJSKG11ZC0+bWlycSkpIHsKKwkJcmV0
ID0gUFRSX0VSUihtdWQtPm1pcnEpOworCQlnb3RvIGVycl9mcmVlOworCX0KKworCW11ZC0+bnVt
X2NlbGxzID0gbnVtX3JlZ21hcHM7CisJbXVkLT5jZWxscyA9IGtjYWxsb2MobnVtX3JlZ21hcHMs
IHNpemVvZigqbXVkLT5jZWxscyksIEdGUF9LRVJORUwpOworCWlmICghbXVkLT5jZWxscykKKwkJ
Z290byBlcnJfZnJlZTsKKworCWZvciAoaSA9IDA7IGkgPCBudW1fcmVnbWFwczsgaSsrKSB7CisJ
CXJldCA9IG11ZF9wcm9iZV9yZWdtYXAoaW50ZXJmYWNlLCAmbXVkLT5jZWxsc1tpXSwgaSwgbXVk
LT5taXJxKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gcHJvYmUg
cmVnbWFwIGluZGV4ICVpIChlcnJvciAlZClcbiIsIGksIHJldCk7CisJCQlnb3RvIGVycl9mcmVl
OworCQl9CisJfQorCisJcmV0ID0gbXVkX2lycV9zdGFydChtdWQtPm1pcnEpOworCWlmIChyZXQp
IHsKKwkJZGV2X2VycihkZXYsICJGYWlsZWQgdG8gc3RhcnQgaXJxIChlcnJvciAlZClcbiIsIHJl
dCk7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJcmV0ID0gbWZkX2FkZF9ob3RwbHVnX2Rldmlj
ZXMoZGV2LCBtdWQtPmNlbGxzLCBtdWQtPm51bV9jZWxscyk7CisJaWYgKHJldCkgeworCQlkZXZf
ZXJyKGRldiwgIkZhaWxlZCB0byBhZGQgbWZkIGRldmljZXMgdG8gY29yZS4iKTsKKwkJZ290byBl
cnJfc3RvcDsKKwl9CisKKwltdWQtPnVzYiA9IHVzYl9nZXRfZGV2KGludGVyZmFjZV90b191c2Jk
ZXYoaW50ZXJmYWNlKSk7CisKKwl1c2Jfc2V0X2ludGZkYXRhKGludGVyZmFjZSwgbXVkKTsKKwor
CWlmIChtdWQtPnVzYi0+cHJvZHVjdCkKKwkJZGV2X2luZm8oZGV2LCAiJXNcbiIsIG11ZC0+dXNi
LT5wcm9kdWN0KTsKKworCXJldHVybiAwOworCitlcnJfc3RvcDoKKwltdWRfaXJxX3N0b3AobXVk
LT5taXJxKTsKK2Vycl9mcmVlOgorCW11ZF9mcmVlKG11ZCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitzdGF0aWMgdm9pZCBtdWRfZGlzY29ubmVjdChzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJm
YWNlKQoreworCXN0cnVjdCBtdWRfZGV2aWNlICptdWQgPSB1c2JfZ2V0X2ludGZkYXRhKGludGVy
ZmFjZSk7CisKKwltZmRfcmVtb3ZlX2RldmljZXMoJmludGVyZmFjZS0+ZGV2KTsKKwltdWRfaXJx
X3N0b3AobXVkLT5taXJxKTsKKwl1c2JfcHV0X2RldihtdWQtPnVzYik7CisJbXVkX2ZyZWUobXVk
KTsKKworCWRldl9kYmcoJmludGVyZmFjZS0+ZGV2LCAiZGlzY29ubmVjdGVkXG4iKTsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCB1c2JfZGV2aWNlX2lkIG11ZF90YWJsZVtdID0geworCS8qCisJ
ICogRklYTUU6CisJICogQXBwbHkgZm9yIGEgcHJvcGVyIHBpZDogaHR0cHM6Ly9naXRodWIuY29t
L29wZW5tb2tvL29wZW5tb2tvLXVzYi1vdWkKKwkgKgorCSAqIE9yIG1heWJlIHRoZSBMaW51eCBG
b3VuZGF0aW9uIHdpbGwgcHJvdmlkZSBvbmUgZnJvbSB0aGVpciB2ZW5kb3IgaWQuCisJICovCisJ
eyBVU0JfREVWSUNFX0lOVEVSRkFDRV9DTEFTUygweDFkNTAsIDB4NjE1MCwgVVNCX0NMQVNTX1ZF
TkRPUl9TUEVDKSB9LAorCXsgfQorfTsKKworTU9EVUxFX0RFVklDRV9UQUJMRSh1c2IsIG11ZF90
YWJsZSk7CisKK3N0YXRpYyBzdHJ1Y3QgdXNiX2RyaXZlciBtdWRfZHJpdmVyID0geworCS5uYW1l
CQk9ICJtdWQiLAorCS5wcm9iZQkJPSBtdWRfcHJvYmUsCisJLmRpc2Nvbm5lY3QJPSBtdWRfZGlz
Y29ubmVjdCwKKwkuaWRfdGFibGUJPSBtdWRfdGFibGUsCit9OworCittb2R1bGVfdXNiX2RyaXZl
cihtdWRfZHJpdmVyKTsKKworTU9EVUxFX0RFU0NSSVBUSU9OKCJHZW5lcmljIFVTQiBEZXZpY2Ug
bWZkIGNvcmUgZHJpdmVyIik7CitNT0RVTEVfQVVUSE9SKCJOb3JhbGYgVHLDuG5uZXMgPG5vcmFs
ZkB0cm9ubmVzLm9yZz4iKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsKZGlmZiAtLWdpdCBhL2lu
Y2x1ZGUvbGludXgvbWZkL211ZC5oIGIvaW5jbHVkZS9saW51eC9tZmQvbXVkLmgKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iMjA1OWZhNTc0MjkKLS0tIC9kZXYvbnVs
bAorKysgYi9pbmNsdWRlL2xpbnV4L21mZC9tdWQuaApAQCAtMCwwICsxLDE2IEBACisvKiBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vci1sYXRlciAqLworCisjaWZuZGVmIF9fTElO
VVhfTVVEX0gKKyNkZWZpbmUgX19MSU5VWF9NVURfSAorCisjaW5jbHVkZSA8bGludXgvcmVnbWFw
X3VzYi5oPgorCitzdHJ1Y3QgdXNiX2ludGVyZmFjZTsKKworc3RydWN0IG11ZF9jZWxsX3BkYXRh
IHsKKwlzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJmYWNlOworCXVuc2lnbmVkIGludCBpbmRl
eDsKKwlzdHJ1Y3QgcmVnbWFwX3VzYl9tYXBfZGVzY3JpcHRvciBkZXNjOworfTsKKworI2VuZGlm
Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bAo=
