Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 87522615EB
	for <lists+dri-devel@lfdr.de>; Sun,  7 Jul 2019 20:28:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 51ADC89B3C;
	Sun,  7 Jul 2019 18:28:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CF69489B3C
 for <dri-devel@lists.freedesktop.org>; Sun,  7 Jul 2019 18:28:12 +0000 (UTC)
Received: from pendragon.nordic-sky.finnair.com (unknown [38.98.37.142])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id BD2C7B93;
 Sun,  7 Jul 2019 20:27:44 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 22/60] drm/panel: Add driver for the Sony ACX565AKM panel
Date: Sun,  7 Jul 2019 21:18:59 +0300
Message-Id: <20190707181937.6250-19-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
References: <20190707180852.5512-1-laurent.pinchart@ideasonboard.com>
 <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1562524091;
 bh=2dsqDkmIJsdte43yeDipNNOUIhEx2ygEXL/DZ8n6J+w=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=ouJeThp6+uR7OKO1r9+d8snvpE08GZI6hJBazFQOMxvPSyzMDM6rM2nfuB6hr073Q
 EJ3DTaEBoqrqUA0ZMQ3qaYA8kNDPf+MwGSVgLXkAQGuQlYXkWPOT+SStch1QYRWGqJ
 qgAisetH1oh2NCv9E0JyvDcFFaX0oGwfYa6NjUAA=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>, Sam Ravnborg <sam@ravnborg.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>,
 Thierry Reding <thierry.reding@gmail.com>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYW5lbCBpcyB1c2VkIG9uIHRoZSBOb2tpYSBOOTAwLgoKU2lnbmVkLW9mZi1ieTogTGF1
cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnICAgICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZl
cnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZSAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMv
Z3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFjeDU2NWFrbS5jIHwgNjkxICsrKysrKysrKysrKysr
KysrKysKIDMgZmlsZXMgY2hhbmdlZCwgNzAwIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEw
MDY0NCBkcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtc29ueS1hY3g1NjVha20uYwoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3Bh
bmVsL0tjb25maWcKaW5kZXggMDRmZDE1MmVmZTRjLi5kYzEwZjcyNzY4OWEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5l
bC9LY29uZmlnCkBAIC0yOTYsNiArMjk2LDE0IEBAIGNvbmZpZyBEUk1fUEFORUxfU0lUUk9OSVhf
U1Q3Nzg5VgogCSAgU2F5IFkgaGVyZSBpZiB5b3Ugd2FudCB0byBlbmFibGUgc3VwcG9ydCBmb3Ig
dGhlIFNpdHJvbml4CiAJICBTVDc3ODlWIGNvbnRyb2xsZXIgZm9yIDI0MHgzMjAgTENEIHBhbmVs
cwogCitjb25maWcgRFJNX1BBTkVMX1NPTllfQUNYNTY1QUtNCisJdHJpc3RhdGUgIlNvbnkgQUNY
NTY1QUtNIHBhbmVsIgorCWRlcGVuZHMgb24gR1BJT0xJQiAmJiBPRiAmJiBTUEkKKwlkZXBlbmRz
IG9uIEJBQ0tMSUdIVF9DTEFTU19ERVZJQ0UKKwloZWxwCisJICBTYXkgWSBoZXJlIGlmIHlvdSB3
YW50IHRvIGVuYWJsZSBzdXBwb3J0IGZvciB0aGUgU29ueSBBQ1g1NjVBS00KKwkgIDgwMHg2MDAg
My41IiBwYW5lbC4KKwogY29uZmlnIERSTV9QQU5FTF9UUE9fVFBHMTEwCiAJdHJpc3RhdGUgIlRQ
TyBUUEcgODAweDQwMCBwYW5lbCIKIAlkZXBlbmRzIG9uIE9GICYmIFNQSSAmJiBHUElPTElCCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9k
cm0vcGFuZWwvTWFrZWZpbGUKaW5kZXggMTJkY2Q3NmViODdjLi44NGNiYzA2OWY2Y2QgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9k
cm0vcGFuZWwvTWFrZWZpbGUKQEAgLTMxLDUgKzMxLDYgQEAgb2JqLSQoQ09ORklHX0RSTV9QQU5F
TF9TSEFSUF9MUzAzN1Y3RFcwMSkgKz0gcGFuZWwtc2hhcnAtbHMwMzd2N2R3MDEubwogb2JqLSQo
Q09ORklHX0RSTV9QQU5FTF9TSEFSUF9MUzA0M1QxTEUwMSkgKz0gcGFuZWwtc2hhcnAtbHMwNDN0
MWxlMDEubwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9TSVRST05JWF9TVDc3MDEpICs9IHBhbmVs
LXNpdHJvbml4LXN0NzcwMS5vCiBvYmotJChDT05GSUdfRFJNX1BBTkVMX1NJVFJPTklYX1NUNzc4
OVYpICs9IHBhbmVsLXNpdHJvbml4LXN0Nzc4OXYubworb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9T
T05ZX0FDWDU2NUFLTSkgKz0gcGFuZWwtc29ueS1hY3g1NjVha20ubwogb2JqLSQoQ09ORklHX0RS
TV9QQU5FTF9UUE9fVFBHMTEwKSArPSBwYW5lbC10cG8tdHBnMTEwLm8KIG9iai0kKENPTkZJR19E
Uk1fUEFORUxfVFJVTFlfTlQzNTU5N19XUVhHQSkgKz0gcGFuZWwtdHJ1bHktbnQzNTU5Ny5vCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtc29ueS1hY3g1NjVha20uYyBi
L2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFjeDU2NWFrbS5jCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZTcyOTI2NDhhYzA2Ci0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL3BhbmVsLXNvbnktYWN4NTY1YWttLmMKQEAgLTAs
MCArMSw2OTEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICog
U29ueSBBQ1g1NjVBS00gTENEIFBhbmVsIGRyaXZlcgorICoKKyAqIENvcHlyaWdodCAoQykgMjAx
OSBUZXhhcyBJbnN0cnVtZW50cyBJbmNvcnBvcmF0ZWQKKyAqCisgKiBCYXNlZCBvbiB0aGUgb21h
cGRybS1zcGVjaWZpYyBwYW5lbC1zb255LWFjeDU2NWFrbSBkcml2ZXIKKyAqCisgKiBDb3B5cmln
aHQgKEMpIDIwMTAgTm9raWEgQ29ycG9yYXRpb24KKyAqIEF1dGhvcjogSW1yZSBEZWFrIDxpbXJl
LmRlYWtAbm9raWEuY29tPgorICovCisKKyNpbmNsdWRlIDxsaW51eC9iYWNrbGlnaHQuaD4KKyNp
bmNsdWRlIDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxpbnV4L2dwaW8vY29uc3VtZXIuaD4K
KyNpbmNsdWRlIDxsaW51eC9qaWZmaWVzLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+Cisj
aW5jbHVkZSA8bGludXgvbXV0ZXguaD4KKyNpbmNsdWRlIDxsaW51eC9zY2hlZC5oPgorI2luY2x1
ZGUgPGxpbnV4L3NwaS9zcGkuaD4KKyNpbmNsdWRlIDx2aWRlby9taXBpX2Rpc3BsYXkuaD4KKwor
I2luY2x1ZGUgPGRybS9kcm1fY29ubmVjdG9yLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tb2Rlcy5o
PgorI2luY2x1ZGUgPGRybS9kcm1fcGFuZWwuaD4KKworI2RlZmluZSBDVFJMX0RJU1BfQlJJR0hU
TkVTU19DVFJMX09OCQkoMSA8PCA1KQorI2RlZmluZSBDVFJMX0RJU1BfQU1CSUVOVF9MSUdIVF9D
VFJMX09OCQkoMSA8PCA0KQorI2RlZmluZSBDVFJMX0RJU1BfQkFDS0xJR0hUX09OCQkJKDEgPDwg
MikKKyNkZWZpbmUgQ1RSTF9ESVNQX0FVVE9fQlJJR0hUTkVTU19PTgkJKDEgPDwgMSkKKworI2Rl
ZmluZSBNSVBJRF9DTURfV1JJVEVfQ0FCQwkJMHg1NQorI2RlZmluZSBNSVBJRF9DTURfUkVBRF9D
QUJDCQkweDU2CisKKyNkZWZpbmUgTUlQSURfVkVSX0xQSDg5MjMJCTMKKyNkZWZpbmUgTUlQSURf
VkVSX0xTMDQxWTMJCTQKKyNkZWZpbmUgTUlQSURfVkVSX0w0RjAwMzExCQk4CisjZGVmaW5lIE1J
UElEX1ZFUl9BQ1g1NjVBS00JCTkKKworc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgeworCXN0cnVj
dCBkcm1fcGFuZWwgcGFuZWw7CisKKwlzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpOworCXN0cnVjdCBn
cGlvX2Rlc2MgKnJlc2V0X2dwaW87CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJhY2tsaWdo
dDsKKworCXN0cnVjdCBtdXRleCBtdXRleDsKKworCWNvbnN0IGNoYXIgKm5hbWU7CisJdTggZGlz
cGxheV9pZFszXTsKKwlpbnQgbW9kZWw7CisJaW50IHJldmlzaW9uOworCWJvb2wgaGFzX2JjOwor
CWJvb2wgaGFzX2NhYmM7CisKKwlib29sIGVuYWJsZWQ7CisJdW5zaWduZWQgaW50IGNhYmNfbW9k
ZTsKKwkvKgorCSAqIE5leHQgdmFsdWUgb2YgamlmZmllcyB3aGVuIHdlIGNhbiBpc3N1ZSB0aGUg
bmV4dCBzbGVlcCBpbi9vdXQKKwkgKiBjb21tYW5kLgorCSAqLworCXVuc2lnbmVkIGxvbmcgaHdf
Z3VhcmRfZW5kOworCXVuc2lnbmVkIGxvbmcgaHdfZ3VhcmRfd2FpdDsJCS8qIG1heCBndWFyZCB0
aW1lIGluIGppZmZpZXMgKi8KK307CisKKyNkZWZpbmUgdG9fYWN4NTY1YWttX2RldmljZShwKSBj
b250YWluZXJfb2YocCwgc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UsIHBhbmVsKQorCitzdGF0aWMg
dm9pZCBhY3g1NjVha21fdHJhbnNmZXIoc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCwgaW50
IGNtZCwKKwkJCSAgICAgIGNvbnN0IHU4ICp3YnVmLCBpbnQgd2xlbiwgdTggKnJidWYsIGludCBy
bGVuKQoreworCXN0cnVjdCBzcGlfbWVzc2FnZQltOworCXN0cnVjdCBzcGlfdHJhbnNmZXIJKngs
IHhmZXJbNV07CisJaW50CQkJcmV0OworCisJc3BpX21lc3NhZ2VfaW5pdCgmbSk7CisKKwltZW1z
ZXQoeGZlciwgMCwgc2l6ZW9mKHhmZXIpKTsKKwl4ID0gJnhmZXJbMF07CisKKwljbWQgJj0gIDB4
ZmY7CisJeC0+dHhfYnVmID0gJmNtZDsKKwl4LT5iaXRzX3Blcl93b3JkID0gOTsKKwl4LT5sZW4g
PSAyOworCisJaWYgKHJsZW4gPiAxICYmIHdsZW4gPT0gMCkgeworCQkvKgorCQkgKiBCZXR3ZWVu
IHRoZSBjb21tYW5kIGFuZCB0aGUgcmVzcG9uc2UgZGF0YSB0aGVyZSBpcyBhCisJCSAqIGR1bW15
IGNsb2NrIGN5Y2xlLiBBZGQgYW4gZXh0cmEgYml0IGFmdGVyIHRoZSBjb21tYW5kCisJCSAqIHdv
cmQgdG8gYWNjb3VudCBmb3IgdGhpcy4KKwkJICovCisJCXgtPmJpdHNfcGVyX3dvcmQgPSAxMDsK
KwkJY21kIDw8PSAxOworCX0KKwlzcGlfbWVzc2FnZV9hZGRfdGFpbCh4LCAmbSk7CisKKwlpZiAo
d2xlbikgeworCQl4Kys7CisJCXgtPnR4X2J1ZiA9IHdidWY7CisJCXgtPmxlbiA9IHdsZW47CisJ
CXgtPmJpdHNfcGVyX3dvcmQgPSA5OworCQlzcGlfbWVzc2FnZV9hZGRfdGFpbCh4LCAmbSk7CisJ
fQorCisJaWYgKHJsZW4pIHsKKwkJeCsrOworCQl4LT5yeF9idWYJPSByYnVmOworCQl4LT5sZW4J
CT0gcmxlbjsKKwkJc3BpX21lc3NhZ2VfYWRkX3RhaWwoeCwgJm0pOworCX0KKworCXJldCA9IHNw
aV9zeW5jKGxjZC0+c3BpLCAmbSk7CisJaWYgKHJldCA8IDApCisJCWRldl9kYmcoJmxjZC0+c3Bp
LT5kZXYsICJzcGlfc3luYyAlZFxuIiwgcmV0KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGFj
eDU2NWFrbV9jbWQoc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCwgaW50IGNtZCkKK3sKKwlh
Y3g1NjVha21fdHJhbnNmZXIobGNkLCBjbWQsIE5VTEwsIDAsIE5VTEwsIDApOworfQorCitzdGF0
aWMgaW5saW5lIHZvaWQgYWN4NTY1YWttX3dyaXRlKHN0cnVjdCBhY3g1NjVha21fZGV2aWNlICps
Y2QsCisJCQkgICAgICAgaW50IHJlZywgY29uc3QgdTggKmJ1ZiwgaW50IGxlbikKK3sKKwlhY3g1
NjVha21fdHJhbnNmZXIobGNkLCByZWcsIGJ1ZiwgbGVuLCBOVUxMLCAwKTsKK30KKworc3RhdGlj
IGlubGluZSB2b2lkIGFjeDU2NWFrbV9yZWFkKHN0cnVjdCBhY3g1NjVha21fZGV2aWNlICpsY2Qs
CisJCQkgICAgICBpbnQgcmVnLCB1OCAqYnVmLCBpbnQgbGVuKQoreworCWFjeDU2NWFrbV90cmFu
c2ZlcihsY2QsIHJlZywgTlVMTCwgMCwgYnVmLCBsZW4pOworfQorCisvKiAtLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQorICogQXV0byBCcmlnaHRuZXNzIENvbnRyb2wgVmlhIHN5c2ZzCisgKi8KKworc3Rh
dGljIHVuc2lnbmVkIGludCBhY3g1NjVha21fZ2V0X2NhYmNfbW9kZShzdHJ1Y3QgYWN4NTY1YWtt
X2RldmljZSAqbGNkKQoreworCXJldHVybiBsY2QtPmNhYmNfbW9kZTsKK30KKworc3RhdGljIHZv
aWQgYWN4NTY1YWttX3NldF9jYWJjX21vZGUoc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCwK
KwkJCQkgICAgdW5zaWduZWQgaW50IG1vZGUpCit7CisJdTE2IGNhYmNfY3RybDsKKworCWxjZC0+
Y2FiY19tb2RlID0gbW9kZTsKKwlpZiAoIWxjZC0+ZW5hYmxlZCkKKwkJcmV0dXJuOworCWNhYmNf
Y3RybCA9IDA7CisJYWN4NTY1YWttX3JlYWQobGNkLCBNSVBJRF9DTURfUkVBRF9DQUJDLCAodTgg
KikmY2FiY19jdHJsLCAxKTsKKwljYWJjX2N0cmwgJj0gfjM7CisJY2FiY19jdHJsIHw9ICgxIDw8
IDgpIHwgKG1vZGUgJiAzKTsKKwlhY3g1NjVha21fd3JpdGUobGNkLCBNSVBJRF9DTURfV1JJVEVf
Q0FCQywgKHU4ICopJmNhYmNfY3RybCwgMik7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgYWN4
NTY1YWttX2dldF9od19jYWJjX21vZGUoc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCkKK3sK
Kwl1OCBjYWJjX2N0cmw7CisKKwlhY3g1NjVha21fcmVhZChsY2QsIE1JUElEX0NNRF9SRUFEX0NB
QkMsICZjYWJjX2N0cmwsIDEpOworCXJldHVybiBjYWJjX2N0cmwgJiAzOworfQorCitzdGF0aWMg
Y29uc3QgY2hhciAqIGNvbnN0IGFjeDU2NWFrbV9jYWJjX21vZGVzW10gPSB7CisJIm9mZiIsCQkv
KiBhbHdheXMgdXNlZCB3aGVuIENBQkMgaXMgbm90IHN1cHBvcnRlZCAqLworCSJ1aSIsCisJInN0
aWxsLWltYWdlIiwKKwkibW92aW5nLWltYWdlIiwKK307CisKK3N0YXRpYyBzc2l6ZV90IGNhYmNf
bW9kZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCSAgICAgIHN0cnVjdCBkZXZpY2VfYXR0
cmlidXRlICphdHRyLAorCQkJICAgICAgY2hhciAqYnVmKQoreworCXN0cnVjdCBhY3g1NjVha21f
ZGV2aWNlICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwljb25zdCBjaGFyICptb2RlX3N0
cjsKKwlpbnQgbW9kZTsKKworCWlmICghbGNkLT5oYXNfY2FiYykKKwkJbW9kZSA9IDA7CisJZWxz
ZQorCQltb2RlID0gYWN4NTY1YWttX2dldF9jYWJjX21vZGUobGNkKTsKKworCW1vZGVfc3RyID0g
InVua25vd24iOworCWlmIChtb2RlID49IDAgJiYgbW9kZSA8IEFSUkFZX1NJWkUoYWN4NTY1YWtt
X2NhYmNfbW9kZXMpKQorCQltb2RlX3N0ciA9IGFjeDU2NWFrbV9jYWJjX21vZGVzW21vZGVdOwor
CisJcmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIG1vZGVfc3RyKTsKK30KKworc3RhdGljIHNz
aXplX3QgY2FiY19tb2RlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCSAgICAgICBzdHJ1
Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCSAgICAgICBjb25zdCBjaGFyICpidWYsIHNp
emVfdCBjb3VudCkKK3sKKwlzdHJ1Y3QgYWN4NTY1YWttX2RldmljZSAqbGNkID0gZGV2X2dldF9k
cnZkYXRhKGRldik7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShhY3g1NjVha21fY2FiY19tb2Rlcyk7IGkrKykgeworCQljb25zdCBjaGFyICptb2RlX3N0
ciA9IGFjeDU2NWFrbV9jYWJjX21vZGVzW2ldOworCQlpbnQgY21wX2xlbiA9IHN0cmxlbihtb2Rl
X3N0cik7CisKKwkJaWYgKGNvdW50ID4gMCAmJiBidWZbY291bnQgLSAxXSA9PSAnXG4nKQorCQkJ
Y291bnQtLTsKKwkJaWYgKGNvdW50ICE9IGNtcF9sZW4pCisJCQljb250aW51ZTsKKworCQlpZiAo
c3RybmNtcChidWYsIG1vZGVfc3RyLCBjbXBfbGVuKSA9PSAwKQorCQkJYnJlYWs7CisJfQorCisJ
aWYgKGkgPT0gQVJSQVlfU0laRShhY3g1NjVha21fY2FiY19tb2RlcykpCisJCXJldHVybiAtRUlO
VkFMOworCisJaWYgKCFsY2QtPmhhc19jYWJjICYmIGkgIT0gMCkKKwkJcmV0dXJuIC1FSU5WQUw7
CisKKwltdXRleF9sb2NrKCZsY2QtPm11dGV4KTsKKwlhY3g1NjVha21fc2V0X2NhYmNfbW9kZShs
Y2QsIGkpOworCW11dGV4X3VubG9jaygmbGNkLT5tdXRleCk7CisKKwlyZXR1cm4gY291bnQ7Cit9
CisKK3N0YXRpYyBzc2l6ZV90IGNhYmNfYXZhaWxhYmxlX21vZGVzX3Nob3coc3RydWN0IGRldmlj
ZSAqZGV2LAorCQkJCQkgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJCSBjaGFy
ICpidWYpCit7CisJc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCA9IGRldl9nZXRfZHJ2ZGF0
YShkZXYpOworCXVuc2lnbmVkIGludCBpOworCXNpemVfdCBsZW4gPSAwOworCisJaWYgKCFsY2Qt
Pmhhc19jYWJjKQorCQlyZXR1cm4gc3ByaW50ZihidWYsICIlc1xuIiwgYWN4NTY1YWttX2NhYmNf
bW9kZXNbMF0pOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoYWN4NTY1YWttX2NhYmNf
bW9kZXMpOyBpKyspCisJCWxlbiArPSBzcHJpbnRmKCZidWZbbGVuXSwgIiVzJXMiLCBpID8gIiAi
IDogIiIsCisJCQkgICAgICAgYWN4NTY1YWttX2NhYmNfbW9kZXNbaV0pOworCisJYnVmW2xlbisr
XSA9ICdcbic7CisKKwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgREVWSUNFX0FUVFJfUlcoY2Fi
Y19tb2RlKTsKK3N0YXRpYyBERVZJQ0VfQVRUUl9STyhjYWJjX2F2YWlsYWJsZV9tb2Rlcyk7CisK
K3N0YXRpYyBzdHJ1Y3QgYXR0cmlidXRlICphY3g1NjVha21fY2FiY19hdHRyc1tdID0geworCSZk
ZXZfYXR0cl9jYWJjX21vZGUuYXR0ciwKKwkmZGV2X2F0dHJfY2FiY19hdmFpbGFibGVfbW9kZXMu
YXR0ciwKKwlOVUxMLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBhdHRyaWJ1dGVfZ3JvdXAg
YWN4NTY1YWttX2NhYmNfYXR0cl9ncm91cCA9IHsKKwkuYXR0cnMgPSBhY3g1NjVha21fY2FiY19h
dHRycywKK307CisKKy8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBCYWNrbGlnaHQgRGV2aWNl
CisgKi8KKworc3RhdGljIGludCBhY3g1NjVha21fZ2V0X2FjdHVhbF9icmlnaHRuZXNzKHN0cnVj
dCBhY3g1NjVha21fZGV2aWNlICpsY2QpCit7CisJdTggYnY7CisKKwlhY3g1NjVha21fcmVhZChs
Y2QsIE1JUElfRENTX0dFVF9ESVNQTEFZX0JSSUdIVE5FU1MsICZidiwgMSk7CisKKwlyZXR1cm4g
YnY7Cit9CisKK3N0YXRpYyB2b2lkIGFjeDU2NWFrbV9zZXRfYnJpZ2h0bmVzcyhzdHJ1Y3QgYWN4
NTY1YWttX2RldmljZSAqbGNkLCBpbnQgbGV2ZWwpCit7CisJdTE2IGN0cmw7CisJaW50IGJ2Owor
CisJYnYgPSBsZXZlbCB8ICgxIDw8IDgpOworCWFjeDU2NWFrbV93cml0ZShsY2QsIE1JUElfRENT
X1NFVF9ESVNQTEFZX0JSSUdIVE5FU1MsICh1OCAqKSZidiwgMik7CisKKwlhY3g1NjVha21fcmVh
ZChsY2QsIE1JUElfRENTX0dFVF9DT05UUk9MX0RJU1BMQVksICh1OCAqKSZjdHJsLCAxKTsKKwlp
ZiAobGV2ZWwpCisJCWN0cmwgfD0gQ1RSTF9ESVNQX0JSSUdIVE5FU1NfQ1RSTF9PTiB8CisJCQlD
VFJMX0RJU1BfQkFDS0xJR0hUX09OOworCWVsc2UKKwkJY3RybCAmPSB+KENUUkxfRElTUF9CUklH
SFRORVNTX0NUUkxfT04gfAorCQkJICBDVFJMX0RJU1BfQkFDS0xJR0hUX09OKTsKKworCWN0cmwg
fD0gMSA8PCA4OworCWFjeDU2NWFrbV93cml0ZShsY2QsIE1JUElfRENTX1dSSVRFX0NPTlRST0xf
RElTUExBWSwgKHU4ICopJmN0cmwsIDIpOworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9ibF91
cGRhdGVfc3RhdHVzX2xvY2tlZChzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqZGV2KQoreworCXN0
cnVjdCBhY3g1NjVha21fZGV2aWNlICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoJmRldi0+ZGV2KTsK
KwlpbnQgbGV2ZWw7CisKKwlpZiAoZGV2LT5wcm9wcy5mYl9ibGFuayA9PSBGQl9CTEFOS19VTkJM
QU5LICYmCisJICAgIGRldi0+cHJvcHMucG93ZXIgPT0gRkJfQkxBTktfVU5CTEFOSykKKwkJbGV2
ZWwgPSBkZXYtPnByb3BzLmJyaWdodG5lc3M7CisJZWxzZQorCQlsZXZlbCA9IDA7CisKKwlhY3g1
NjVha21fc2V0X2JyaWdodG5lc3MobGNkLCBsZXZlbCk7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBhY3g1NjVha21fYmxfdXBkYXRlX3N0YXR1cyhzdHJ1Y3QgYmFja2xpZ2h0X2Rldmlj
ZSAqZGV2KQoreworCXN0cnVjdCBhY3g1NjVha21fZGV2aWNlICpsY2QgPSBkZXZfZ2V0X2RydmRh
dGEoJmRldi0+ZGV2KTsKKwlpbnQgcmV0OworCisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisJ
cmV0ID0gYWN4NTY1YWttX2JsX3VwZGF0ZV9zdGF0dXNfbG9ja2VkKGRldik7CisJbXV0ZXhfdW5s
b2NrKCZsY2QtPm11dGV4KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1
YWttX2JsX2dldF9pbnRlbnNpdHkoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmRldikKK3sKKwlz
dHJ1Y3QgYWN4NTY1YWttX2RldmljZSAqbGNkID0gZGV2X2dldF9kcnZkYXRhKCZkZXYtPmRldik7
CisJdW5zaWduZWQgaW50IGludGVuc2l0eTsKKworCW11dGV4X2xvY2soJmxjZC0+bXV0ZXgpOwor
CisJaWYgKGRldi0+cHJvcHMuZmJfYmxhbmsgPT0gRkJfQkxBTktfVU5CTEFOSyAmJgorCSAgICBk
ZXYtPnByb3BzLnBvd2VyID09IEZCX0JMQU5LX1VOQkxBTkspCisJCWludGVuc2l0eSA9IGFjeDU2
NWFrbV9nZXRfYWN0dWFsX2JyaWdodG5lc3MobGNkKTsKKwllbHNlCisJCWludGVuc2l0eSA9IDA7
CisKKwltdXRleF91bmxvY2soJmxjZC0+bXV0ZXgpOworCisJcmV0dXJuIGludGVuc2l0eTsKK30K
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBiYWNrbGlnaHRfb3BzIGFjeDU2NWFrbV9ibF9vcHMgPSB7
CisJLmdldF9icmlnaHRuZXNzID0gYWN4NTY1YWttX2JsX2dldF9pbnRlbnNpdHksCisJLnVwZGF0
ZV9zdGF0dXMgID0gYWN4NTY1YWttX2JsX3VwZGF0ZV9zdGF0dXMsCit9OworCitzdGF0aWMgaW50
IGFjeDU2NWFrbV9iYWNrbGlnaHRfaW5pdChzdHJ1Y3QgYWN4NTY1YWttX2RldmljZSAqbGNkKQor
eworCXN0cnVjdCBiYWNrbGlnaHRfcHJvcGVydGllcyBwcm9wcyA9IHsKKwkJLmZiX2JsYW5rID0g
RkJfQkxBTktfVU5CTEFOSywKKwkJLnBvd2VyID0gRkJfQkxBTktfVU5CTEFOSywKKwkJLnR5cGUg
PSBCQUNLTElHSFRfUkFXLAorCX07CisJaW50IHJldDsKKworCWxjZC0+YmFja2xpZ2h0ID0gYmFj
a2xpZ2h0X2RldmljZV9yZWdpc3RlcihsY2QtPm5hbWUsICZsY2QtPnNwaS0+ZGV2LAorCQkJCQkJ
ICAgbGNkLCAmYWN4NTY1YWttX2JsX29wcywKKwkJCQkJCSAgICZwcm9wcyk7CisJaWYgKElTX0VS
UihsY2QtPmJhY2tsaWdodCkpIHsKKwkJcmV0ID0gUFRSX0VSUihsY2QtPmJhY2tsaWdodCk7CisJ
CWxjZC0+YmFja2xpZ2h0ID0gTlVMTDsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlpZiAobGNkLT5o
YXNfY2FiYykgeworCQlyZXQgPSBzeXNmc19jcmVhdGVfZ3JvdXAoJmxjZC0+YmFja2xpZ2h0LT5k
ZXYua29iaiwKKwkJCQkJICZhY3g1NjVha21fY2FiY19hdHRyX2dyb3VwKTsKKwkJaWYgKHJldCA8
IDApIHsKKwkJCWRldl9lcnIoJmxjZC0+c3BpLT5kZXYsCisJCQkJIiVzIGZhaWxlZCB0byBjcmVh
dGUgc3lzZnMgZmlsZXNcbiIsIF9fZnVuY19fKTsKKwkJCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdp
c3RlcihsY2QtPmJhY2tsaWdodCk7CisJCQlyZXR1cm4gcmV0OworCQl9CisKKwkJbGNkLT5jYWJj
X21vZGUgPSBhY3g1NjVha21fZ2V0X2h3X2NhYmNfbW9kZShsY2QpOworCX0KKworCWxjZC0+YmFj
a2xpZ2h0LT5wcm9wcy5tYXhfYnJpZ2h0bmVzcyA9IDI1NTsKKwlsY2QtPmJhY2tsaWdodC0+cHJv
cHMuYnJpZ2h0bmVzcyA9IGFjeDU2NWFrbV9nZXRfYWN0dWFsX2JyaWdodG5lc3MobGNkKTsKKwor
CWFjeDU2NWFrbV9ibF91cGRhdGVfc3RhdHVzX2xvY2tlZChsY2QtPmJhY2tsaWdodCk7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgYWN4NTY1YWttX2JhY2tsaWdodF9jbGVhbnVwKHN0
cnVjdCBhY3g1NjVha21fZGV2aWNlICpsY2QpCit7CisJaWYgKGxjZC0+aGFzX2NhYmMpCisJCXN5
c2ZzX3JlbW92ZV9ncm91cCgmbGNkLT5iYWNrbGlnaHQtPmRldi5rb2JqLAorCQkJCSAgICZhY3g1
NjVha21fY2FiY19hdHRyX2dyb3VwKTsKKworCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdpc3Rlcihs
Y2QtPmJhY2tsaWdodCk7Cit9CisKKy8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBEUk0gQnJp
ZGdlIE9wZXJhdGlvbnMKKyAqLworCitzdGF0aWMgdm9pZCBhY3g1NjVha21fc2V0X3NsZWVwX21v
ZGUoc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCwgaW50IG9uKQoreworCWludCBjbWQgPSBv
biA/IE1JUElfRENTX0VOVEVSX1NMRUVQX01PREUgOiBNSVBJX0RDU19FWElUX1NMRUVQX01PREU7
CisJdW5zaWduZWQgbG9uZyB3YWl0OworCisJLyoKKwkgKiBXZSBoYXZlIHRvIGtlZXAgMTIwbXNl
YyBiZXR3ZWVuIHNsZWVwIGluL291dCBjb21tYW5kcy4KKwkgKiAoOC4yLjE1LCA4LjIuMTYpLgor
CSAqLworCXdhaXQgPSBsY2QtPmh3X2d1YXJkX2VuZCAtIGppZmZpZXM7CisJaWYgKChsb25nKXdh
aXQgPiAwICYmIHdhaXQgPD0gbGNkLT5od19ndWFyZF93YWl0KSB7CisJCXNldF9jdXJyZW50X3N0
YXRlKFRBU0tfVU5JTlRFUlJVUFRJQkxFKTsKKwkJc2NoZWR1bGVfdGltZW91dCh3YWl0KTsKKwl9
CisKKwlhY3g1NjVha21fY21kKGxjZCwgY21kKTsKKworCWxjZC0+aHdfZ3VhcmRfd2FpdCA9IG1z
ZWNzX3RvX2ppZmZpZXMoMTIwKTsKKwlsY2QtPmh3X2d1YXJkX2VuZCA9IGppZmZpZXMgKyBsY2Qt
Pmh3X2d1YXJkX3dhaXQ7Cit9CisKK3N0YXRpYyB2b2lkIGFjeDU2NWFrbV9zZXRfZGlzcGxheV9z
dGF0ZShzdHJ1Y3QgYWN4NTY1YWttX2RldmljZSAqbGNkLAorCQkJCQlpbnQgZW5hYmxlZCkKK3sK
KwlpbnQgY21kID0gZW5hYmxlZCA/IE1JUElfRENTX1NFVF9ESVNQTEFZX09OIDogTUlQSV9EQ1Nf
U0VUX0RJU1BMQVlfT0ZGOworCisJYWN4NTY1YWttX2NtZChsY2QsIGNtZCk7Cit9CisKK3N0YXRp
YyBpbnQgYWN4NTY1YWttX3Bvd2VyX29uKHN0cnVjdCBhY3g1NjVha21fZGV2aWNlICpsY2QpCit7
CisJLypGSVhNRSB0d2VhayBtZSAqLworCW1zbGVlcCg1MCk7CisKKwlncGlvZF9zZXRfdmFsdWUo
bGNkLT5yZXNldF9ncGlvLCAxKTsKKworCWlmIChsY2QtPmVuYWJsZWQpIHsKKwkJZGV2X2RiZygm
bGNkLT5zcGktPmRldiwgInBhbmVsIGFscmVhZHkgZW5hYmxlZFxuIik7CisJCXJldHVybiAwOwor
CX0KKworCS8qCisJICogV2UgaGF2ZSB0byBtZWV0IGFsbCB0aGUgZm9sbG93aW5nIGRlbGF5IHJl
cXVpcmVtZW50czoKKwkgKiAxLiB0Ulc6IHJlc2V0IHB1bHNlIHdpZHRoIDEwdXNlYyAoNy4xMi4x
KQorCSAqIDIuIHRSVDogcmVzZXQgY2FuY2VsIHRpbWUgNW1zZWMgKDcuMTIuMSkKKwkgKiAzLiBQ
cm92aWRpbmcgUENMSyxIUyxWUyBzaWduYWxzIGZvciAyIGZyYW1lcyA9IH41MG1zZWMgd29yc3QK
KwkgKiAgICBjYXNlICg3LjYuMikKKwkgKiA0LiAxMjBtc2VjIGJlZm9yZSB0aGUgc2xlZXAgb3V0
IGNvbW1hbmQgKDcuMTIuMSkKKwkgKi8KKwltc2xlZXAoMTIwKTsKKworCWFjeDU2NWFrbV9zZXRf
c2xlZXBfbW9kZShsY2QsIDApOworCWxjZC0+ZW5hYmxlZCA9IHRydWU7CisKKwkvKiA1bXNlYyBi
ZXR3ZWVuIHNsZWVwIG91dCBhbmQgdGhlIG5leHQgY29tbWFuZC4gKDguMi4xNikgKi8KKwl1c2xl
ZXBfcmFuZ2UoNTAwMCwgMTAwMDApOworCWFjeDU2NWFrbV9zZXRfZGlzcGxheV9zdGF0ZShsY2Qs
IDEpOworCWFjeDU2NWFrbV9zZXRfY2FiY19tb2RlKGxjZCwgbGNkLT5jYWJjX21vZGUpOworCisJ
cmV0dXJuIGFjeDU2NWFrbV9ibF91cGRhdGVfc3RhdHVzX2xvY2tlZChsY2QtPmJhY2tsaWdodCk7
Cit9CisKK3N0YXRpYyB2b2lkIGFjeDU2NWFrbV9wb3dlcl9vZmYoc3RydWN0IGFjeDU2NWFrbV9k
ZXZpY2UgKmxjZCkKK3sKKwlpZiAoIWxjZC0+ZW5hYmxlZCkKKwkJcmV0dXJuOworCisJYWN4NTY1
YWttX3NldF9kaXNwbGF5X3N0YXRlKGxjZCwgMCk7CisJYWN4NTY1YWttX3NldF9zbGVlcF9tb2Rl
KGxjZCwgMSk7CisJbGNkLT5lbmFibGVkID0gZmFsc2U7CisJLyoKKwkgKiBXZSBoYXZlIHRvIHBy
b3ZpZGUgUENMSyxIUyxWUyBzaWduYWxzIGZvciAyIGZyYW1lcyAod29yc3QgY2FzZQorCSAqIH41
MG1zZWMpIGFmdGVyIHNlbmRpbmcgdGhlIHNsZWVwIGluIGNvbW1hbmQgYW5kIGFzc2VydGluZyB0
aGUKKwkgKiByZXNldCBzaWduYWwuIFdlIHByb2JhYmx5IGNvdWxkIGFzc2VydCB0aGUgcmVzZXQg
dy9vIHRoZSBkZWxheQorCSAqIGJ1dCB3ZSBzdGlsbCBkZWxheSB0byBhdm9pZCBwb3NzaWJsZSBh
cnRpZmFjdHMuICg3LjYuMSkKKwkgKi8KKwltc2xlZXAoNTApOworCisJZ3Bpb2Rfc2V0X3ZhbHVl
KGxjZC0+cmVzZXRfZ3BpbywgMCk7CisKKwkvKiBGSVhNRSBuZWVkIHRvIHR3ZWFrIHRoaXMgZGVs
YXkgKi8KKwltc2xlZXAoMTAwKTsKK30KKworc3RhdGljIGludCBhY3g1NjVha21fZGlzYWJsZShz
dHJ1Y3QgZHJtX3BhbmVsICpwYW5lbCkKK3sKKwlzdHJ1Y3QgYWN4NTY1YWttX2RldmljZSAqbGNk
ID0gdG9fYWN4NTY1YWttX2RldmljZShwYW5lbCk7CisKKwltdXRleF9sb2NrKCZsY2QtPm11dGV4
KTsKKwlhY3g1NjVha21fcG93ZXJfb2ZmKGxjZCk7CisJbXV0ZXhfdW5sb2NrKCZsY2QtPm11dGV4
KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9lbmFibGUoc3RydWN0
IGRybV9wYW5lbCAqcGFuZWwpCit7CisJc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxjZCA9IHRv
X2FjeDU2NWFrbV9kZXZpY2UocGFuZWwpOworCisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisJ
YWN4NTY1YWttX3Bvd2VyX29uKGxjZCk7CisJbXV0ZXhfdW5sb2NrKCZsY2QtPm11dGV4KTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgYWN4
NTY1YWttX21vZGUgPSB7CisJLmNsb2NrID0gMjQwMDAsCisJLmhkaXNwbGF5ID0gODAwLAorCS5o
c3luY19zdGFydCA9IDgwMCArIDI4LAorCS5oc3luY19lbmQgPSA4MDAgKyAyOCArIDQsCisJLmh0
b3RhbCA9IDgwMCArIDI4ICsgNCArIDI0LAorCS52ZGlzcGxheSA9IDQ4MCwKKwkudnN5bmNfc3Rh
cnQgPSA0ODAgKyAzLAorCS52c3luY19lbmQgPSA0ODAgKyAzICsgMywKKwkudnRvdGFsID0gNDgw
ICsgMyArIDMgKyA0LAorCS52cmVmcmVzaCA9IDU3LAorCS50eXBlID0gRFJNX01PREVfVFlQRV9E
UklWRVIgfCBEUk1fTU9ERV9UWVBFX1BSRUZFUlJFRCwKKwkuZmxhZ3MgPSBEUk1fTU9ERV9GTEFH
X05IU1lOQyB8IERSTV9NT0RFX0ZMQUdfTlZTWU5DLAorfTsKKworc3RhdGljIGludCBhY3g1NjVh
a21fZ2V0X21vZGVzKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IgPSBwYW5lbC0+Y29ubmVjdG9yOworCXN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICptb2RlOworCisJbW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0ZShwYW5lbC0+ZHJtLCAm
YWN4NTY1YWttX21vZGUpOworCWlmICghbW9kZSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlkcm1f
bW9kZV9zZXRfbmFtZShtb2RlKTsKKwlkcm1fbW9kZV9wcm9iZWRfYWRkKGNvbm5lY3RvciwgbW9k
ZSk7CisKKwljb25uZWN0b3ItPmRpc3BsYXlfaW5mby53aWR0aF9tbSA9IDc3OworCWNvbm5lY3Rv
ci0+ZGlzcGxheV9pbmZvLmhlaWdodF9tbSA9IDQ2OworCWNvbm5lY3Rvci0+ZGlzcGxheV9pbmZv
LmJ1c19mbGFncyA9IERSTV9CVVNfRkxBR19ERV9ISUdICisJCQkJCSAgfCBEUk1fQlVTX0ZMQUdf
U1lOQ19TQU1QTEVfUE9TRURHRQorCQkJCQkgIHwgRFJNX0JVU19GTEFHX1BJWERBVEFfU0FNUExF
X05FR0VER0U7CisKKwlyZXR1cm4gMTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGFu
ZWxfZnVuY3MgYWN4NTY1YWttX2Z1bmNzID0geworCS5kaXNhYmxlID0gYWN4NTY1YWttX2Rpc2Fi
bGUsCisJLmVuYWJsZSA9IGFjeDU2NWFrbV9lbmFibGUsCisJLmdldF9tb2RlcyA9IGFjeDU2NWFr
bV9nZXRfbW9kZXMsCit9OworCisvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogUHJvYmUsIERl
dGVjdCBhbmQgUmVtb3ZlCisgKi8KKworc3RhdGljIGludCBhY3g1NjVha21fZGV0ZWN0KHN0cnVj
dCBhY3g1NjVha21fZGV2aWNlICpsY2QpCit7CisJX19iZTMyIHZhbHVlOworCXUzMiBzdGF0dXM7
CisJaW50IHJldCA9IDA7CisKKwkvKgorCSAqIEFmdGVyIGJlaW5nIHRha2VuIG91dCBvZiByZXNl
dCB0aGUgcGFuZWwgbmVlZHMgNW1zIGJlZm9yZSB0aGUgZmlyc3QKKwkgKiBjb21tYW5kIGNhbiBi
ZSBzZW50LgorCSAqLworCWdwaW9kX3NldF92YWx1ZShsY2QtPnJlc2V0X2dwaW8sIDEpOworCXVz
bGVlcF9yYW5nZSg1MDAwLCAxMDAwMCk7CisKKwlhY3g1NjVha21fcmVhZChsY2QsIE1JUElfRENT
X0dFVF9ESVNQTEFZX1NUQVRVUywgKHU4ICopJnZhbHVlLCA0KTsKKwlzdGF0dXMgPSBfX2JlMzJf
dG9fY3B1KHZhbHVlKTsKKwlsY2QtPmVuYWJsZWQgPSAoc3RhdHVzICYgKDEgPDwgMTcpKSAmJiAo
c3RhdHVzICYgKDEgPDwgMTApKTsKKworCWRldl9kYmcoJmxjZC0+c3BpLT5kZXYsCisJCSJMQ0Qg
cGFuZWwgJXMgYnkgYm9vdGxvYWRlciAoc3RhdHVzIDB4JTA0eClcbiIsCisJCWxjZC0+ZW5hYmxl
ZCA/ICJlbmFibGVkIiA6ICJkaXNhYmxlZCAiLCBzdGF0dXMpOworCisJYWN4NTY1YWttX3JlYWQo
bGNkLCBNSVBJX0RDU19HRVRfRElTUExBWV9JRCwgbGNkLT5kaXNwbGF5X2lkLCAzKTsKKwlkZXZf
ZGJnKCZsY2QtPnNwaS0+ZGV2LCAiTUlQSSBkaXNwbGF5IElEOiAlMDJ4JTAyeCUwMnhcbiIsCisJ
CWxjZC0+ZGlzcGxheV9pZFswXSwgbGNkLT5kaXNwbGF5X2lkWzFdLCBsY2QtPmRpc3BsYXlfaWRb
Ml0pOworCisJc3dpdGNoIChsY2QtPmRpc3BsYXlfaWRbMF0pIHsKKwljYXNlIDB4MTA6CisJCWxj
ZC0+bW9kZWwgPSBNSVBJRF9WRVJfQUNYNTY1QUtNOworCQlsY2QtPm5hbWUgPSAiYWN4NTY1YWtt
IjsKKwkJbGNkLT5oYXNfYmMgPSAxOworCQlsY2QtPmhhc19jYWJjID0gMTsKKwkJYnJlYWs7CisJ
Y2FzZSAweDI5OgorCQlsY2QtPm1vZGVsID0gTUlQSURfVkVSX0w0RjAwMzExOworCQlsY2QtPm5h
bWUgPSAibDRmMDAzMTEiOworCQlicmVhazsKKwljYXNlIDB4NDU6CisJCWxjZC0+bW9kZWwgPSBN
SVBJRF9WRVJfTFBIODkyMzsKKwkJbGNkLT5uYW1lID0gImxwaDg5MjMiOworCQlicmVhazsKKwlj
YXNlIDB4ODM6CisJCWxjZC0+bW9kZWwgPSBNSVBJRF9WRVJfTFMwNDFZMzsKKwkJbGNkLT5uYW1l
ID0gImxzMDQxeTMiOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlsY2QtPm5hbWUgPSAidW5rbm93
biI7CisJCWRldl9lcnIoJmxjZC0+c3BpLT5kZXYsICJ1bmtub3duIGRpc3BsYXkgSURcbiIpOwor
CQlyZXQgPSAtRU5PREVWOworCQlnb3RvIGRvbmU7CisJfQorCisJbGNkLT5yZXZpc2lvbiA9IGxj
ZC0+ZGlzcGxheV9pZFsxXTsKKworCWRldl9pbmZvKCZsY2QtPnNwaS0+ZGV2LCAiJXMgcmV2ICUw
MnggcGFuZWwgZGV0ZWN0ZWRcbiIsCisJCSBsY2QtPm5hbWUsIGxjZC0+cmV2aXNpb24pOworCitk
b25lOgorCWlmICghbGNkLT5lbmFibGVkKQorCQlncGlvZF9zZXRfdmFsdWUobGNkLT5yZXNldF9n
cGlvLCAwKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1YWttX3Byb2Jl
KHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCit7CisJc3RydWN0IGFjeDU2NWFrbV9kZXZpY2UgKmxj
ZDsKKwlpbnQgcmV0OworCisJbGNkID0gZGV2bV9remFsbG9jKCZzcGktPmRldiwgc2l6ZW9mKCps
Y2QpLCBHRlBfS0VSTkVMKTsKKwlpZiAobGNkID09IE5VTEwpCisJCXJldHVybiAtRU5PTUVNOwor
CisJc3BpX3NldF9kcnZkYXRhKHNwaSwgbGNkKTsKKwlzcGktPm1vZGUgPSBTUElfTU9ERV8zOwor
CisJbGNkLT5zcGkgPSBzcGk7CisJbXV0ZXhfaW5pdCgmbGNkLT5tdXRleCk7CisKKwlsY2QtPnJl
c2V0X2dwaW8gPSBkZXZtX2dwaW9kX2dldCgmc3BpLT5kZXYsICJyZXNldCIsIEdQSU9EX09VVF9M
T1cpOworCWlmIChJU19FUlIobGNkLT5yZXNldF9ncGlvKSkgeworCQlkZXZfZXJyKCZzcGktPmRl
diwgImZhaWxlZCB0byBnZXQgcmVzZXQgR1BJT1xuIik7CisJCXJldHVybiBQVFJfRVJSKGxjZC0+
cmVzZXRfZ3Bpbyk7CisJfQorCisJcmV0ID0gYWN4NTY1YWttX2RldGVjdChsY2QpOworCWlmIChy
ZXQgPCAwKSB7CisJCWRldl9lcnIoJnNwaS0+ZGV2LCAicGFuZWwgZGV0ZWN0aW9uIGZhaWxlZFxu
Iik7CisJCXJldHVybiByZXQ7CisJfQorCisJaWYgKGxjZC0+aGFzX2JjKSB7CisJCXJldCA9IGFj
eDU2NWFrbV9iYWNrbGlnaHRfaW5pdChsY2QpOworCQlpZiAocmV0IDwgMCkKKwkJCXJldHVybiBy
ZXQ7CisJfQorCisJZHJtX3BhbmVsX2luaXQoJmxjZC0+cGFuZWwpOworCWxjZC0+cGFuZWwuZGV2
ID0gJmxjZC0+c3BpLT5kZXY7CisJbGNkLT5wYW5lbC5mdW5jcyA9ICZhY3g1NjVha21fZnVuY3M7
CisKKwlyZXQgPSBkcm1fcGFuZWxfYWRkKCZsY2QtPnBhbmVsKTsKKwlpZiAocmV0IDwgMCkgewor
CQlpZiAobGNkLT5oYXNfYmMpCisJCQlhY3g1NjVha21fYmFja2xpZ2h0X2NsZWFudXAobGNkKTsK
KwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBhY3g1NjVh
a21fcmVtb3ZlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCit7CisJc3RydWN0IGFjeDU2NWFrbV9k
ZXZpY2UgKmxjZCA9IHNwaV9nZXRfZHJ2ZGF0YShzcGkpOworCisJZHJtX3BhbmVsX3JlbW92ZSgm
bGNkLT5wYW5lbCk7CisKKwlpZiAobGNkLT5oYXNfYmMpCisJCWFjeDU2NWFrbV9iYWNrbGlnaHRf
Y2xlYW51cChsY2QpOworCisJYWN4NTY1YWttX2Rpc2FibGUoJmxjZC0+cGFuZWwpOworCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGFjeDU2NWFrbV9v
Zl9tYXRjaFtdID0geworCXsgLmNvbXBhdGlibGUgPSAic29ueSxhY3g1NjVha20iLCB9LAorCXt9
LAorfTsKKworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgYWN4NTY1YWttX29mX21hdGNoKTsKKwor
c3RhdGljIHN0cnVjdCBzcGlfZHJpdmVyIGFjeDU2NWFrbV9kcml2ZXIgPSB7CisJLnByb2JlCQk9
IGFjeDU2NWFrbV9wcm9iZSwKKwkucmVtb3ZlCQk9IGFjeDU2NWFrbV9yZW1vdmUsCisJLmRyaXZl
cgkJPSB7CisJCS5uYW1lCT0gInBhbmVsLXNvbnktYWN4NTY1YWttIiwKKwkJLm9mX21hdGNoX3Rh
YmxlID0gYWN4NTY1YWttX29mX21hdGNoLAorCX0sCit9OworCittb2R1bGVfc3BpX2RyaXZlcihh
Y3g1NjVha21fZHJpdmVyKTsKKworTU9EVUxFX0FMSUFTKCJzcGk6c29ueSxhY3g1NjVha20iKTsK
K01PRFVMRV9BVVRIT1IoIk5va2lhIENvcnBvcmF0aW9uIik7CitNT0RVTEVfREVTQ1JJUFRJT04o
IlNvbnkgQUNYNTY1QUtNIExDRCBQYW5lbCBEcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwi
KTsKLS0gClJlZ2FyZHMsCgpMYXVyZW50IFBpbmNoYXJ0CgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZl
bEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
