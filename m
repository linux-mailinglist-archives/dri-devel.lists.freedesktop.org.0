Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3771B49A0F
	for <lists+dri-devel@lfdr.de>; Tue, 18 Jun 2019 09:12:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 75D886E0E4;
	Tue, 18 Jun 2019 07:12:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x54a.google.com (mail-pg1-x54a.google.com
 [IPv6:2607:f8b0:4864:20::54a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4A80C6E0DD
 for <dri-devel@lists.freedesktop.org>; Tue, 18 Jun 2019 06:26:33 +0000 (UTC)
Received: by mail-pg1-x54a.google.com with SMTP id s195so9276879pgs.13
 for <dri-devel@lists.freedesktop.org>; Mon, 17 Jun 2019 23:26:33 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:message-id:mime-version:subject:from:to:cc
 :content-transfer-encoding;
 bh=vA+kgCBJcMIEMYkHeCd3wqGKPPi8vvElInzRHbJTvB8=;
 b=Zsj2naEYHETxeXdwfHvMQpv9LYD50FyYGFKWoK2w2k2kdFvDoRk7AshxTh4dpF9Ar5
 wltGJ8sJDblnbd4uS+PlFjIOsfzL4TJflyOhenIu9RdqBbtC4lo7GKbF8v3VS1xj823K
 I1PUbOIRsIuLdkNYULt7S8tQi8iiavzsy2FOU9OCynpmvy2Yrclv0HpP0aYmhSoKox52
 oq0PtIPihEz5810d4ANy+jmEI3MZpTk3qH1pGxwB3ByBj8iNmhRvLB/VIelrAYt91jrO
 8hDp7HqsOxD6usx7+hvdoJO8mo0eyBZBqDiulSTnwDkV3ANWDKHXOegDt78nUqxKy6Sf
 5NZA==
X-Gm-Message-State: APjAAAWkDPoVMuK0NCeDr2+brar48YZPYkUwZLSfT2liBNTOJ5ZFztPo
 UwYcPqfhGR1Z+V6WAn9hvLtrmvEk+CFP
X-Google-Smtp-Source: APXvYqztqsR7/hW+HB8I3Jt9HcdxWJb0qnTU6I7OKnX1Lx6wf5OkmafqQcJvDEyb/dWNc+rvsxnTIag5+CGR
X-Received: by 2002:a63:f00a:: with SMTP id k10mr1116669pgh.193.1560839192358; 
 Mon, 17 Jun 2019 23:26:32 -0700 (PDT)
Date: Mon, 17 Jun 2019 23:26:28 -0700
Message-Id: <20190618062628.133783-1-furquan@google.com>
Mime-Version: 1.0
X-Mailer: git-send-email 2.22.0.410.gd8fdbe21b5-goog
Subject: [PATCH] i915: intel_dp_aux_backlight: Fix max backlight calculations
From: Furquan Shaikh <furquan@google.com>
To: Jani Nikula <jani.nikula@linux.intel.com>, 
 Joonas Lahtinen <joonas.lahtinen@linux.intel.com>,
 Rodrigo Vivi <rodrigo.vivi@intel.com>, 
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>
X-Mailman-Approved-At: Tue, 18 Jun 2019 07:12:01 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:message-id:mime-version:subject:from:to:cc
 :content-transfer-encoding;
 bh=vA+kgCBJcMIEMYkHeCd3wqGKPPi8vvElInzRHbJTvB8=;
 b=KKbpnEI4yIX74RaM9/bLJx/4xoN0lCr2LwXQdZSyNKKoxZwHE9094lHB1FJuZ0sB88
 rfVznJ3DZfGHrFixDzS3bns4EvPzlA55o0O/HHO+iSApv36ZRuzNVoeOb/CKzLSTL4oq
 L/E36UYXuG/XnBuJqDPBFAWfjIs9iOXsK4tCb/dTwcO50aHYja/3U2V82oil/qy0IIbZ
 ctRkBK7qkI208VxZZ4PDuel+qhQ6B92PqmPAllouqyvEVxssCXOFnzLUnbpOMBcCEs4C
 gz2/Rkk2S4VN1Ak3HlvFCw3tdPhL6q+GpXPdmyIa9WWsh2Hev6KUFIpqp+byhJY6mrfh
 mVrA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Furquan Shaikh <furquan@google.com>, intel-gfx@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 marcheu@chromium.org, rajatja@google.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWF4IGJhY2tsaWdodCB2YWx1ZSBmb3IgdGhlIHBhbmVsIHdhcyBiZWluZyBjYWxjdWxhdGVkIHVz
aW5nIGJ5dGUKY291bnQgaS5lLiAweGZmZmYgaWYgMiBieXRlcyBhcmUgc3VwcG9ydGVkIGZvciBi
YWNrbGlnaHQgYnJpZ2h0bmVzcwphbmQgMHhmZiBpZiAxIGJ5dGUgaXMgc3VwcG9ydGVkLiBIb3dl
dmVyLCBFRFBfUFdNR0VOX0JJVF9DT1VOVApkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2YgYWN0aXZl
IGNvbnRyb2wgYml0cyB1c2VkIGZvciB0aGUgYnJpZ2h0bmVzcwpzZXR0aW5nLiBUaHVzLCBldmVu
IGlmIHRoZSBwYW5lbCB1c2VzIDIgYnl0ZSBzZXR0aW5nLCBpdCBtaWdodCBub3QgdXNlCmFsbCB0
aGUgY29udHJvbCBiaXRzLiBUaHVzLCBtYXggYmFja2xpZ2h0IHNob3VsZCBiZSBzZXQgYmFzZWQg
b24gdGhlCnZhbHVlIG9mIEVEUF9QV01HRU5fQklUX0NPVU5UIGluc3RlYWQgb2YgYXNzdW1pbmcg
NjU1MzUgb3IgMjU1LgoKQWRkaXRpb25hbGx5LCBFRFBfUFdNR0VOX0JJVF9DT1VOVCB3YXMgYmVp
bmcgdXBkYXRlZCBiYXNlZCBvbiB0aGUgVkJUCmZyZXF1ZW5jeSB3aGljaCByZXN1bHRzIGluIGEg
ZGlmZmVyZW50IG1heCBiYWNrbGlnaHQgdmFsdWUuIFRodXMsCnNldHRpbmcgb2YgRURQX1BXTUdF
Tl9CSVRfQ09VTlQgaXMgbW92ZWQgdG8gc2V0dXAgcGhhc2UgaW5zdGVhZCBvZgplbmFibGUgc28g
dGhhdCBtYXggYmFja2xpZ2h0IGNhbiBiZSBjYWxjdWxhdGVkIGNvcnJlY3RseS4gT25seSB0aGUK
ZnJlcXVlbmN5IGRpdmlkZXIgaXMgc2V0IGR1cmluZyB0aGUgZW5hYmxlIHBoYXNlIHVzaW5nIHRo
ZSB2YWx1ZSBvZgpFRFBfUFdNR0VOX0JJVF9DT1VOVC4KClNpZ25lZC1vZmYtYnk6IEZ1cnF1YW4g
U2hhaWtoIDxmdXJxdWFuQGdvb2dsZS5jb20+ClJldmlld2VkLWJ5OiBTdMOpcGhhbmUgTWFyY2hl
c2luIDxtYXJjaGV1QGNocm9taXVtLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9kcF9hdXhfYmFja2xpZ2h0LmMgfCAxMzIgKysrKysrKysrKysrLS0tLS0tCiAxIGZpbGUgY2hh
bmdlZCwgODggaW5zZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jCmluZGV4IDM1NzEzNmYxN2Y4NS4uNDYz
NmM4ZThhZThhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9hdXhf
YmFja2xpZ2h0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHBfYXV4X2JhY2ts
aWdodC5jCkBAIC0xMTAsNjEgKzExMCwzNCBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kcF9hdXhfc2V0
X3B3bV9mcmVxKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rv
ci0+ZW5jb2Rlci0+YmFzZSk7Ci0JaW50IGZyZXEsIGZ4cCwgZnhwX21pbiwgZnhwX21heCwgZnhw
X2FjdHVhbCwgZiA9IDE7Ci0JdTggcG4sIHBuX21pbiwgcG5fbWF4OworCWludCBmcmVxLCBmeHAs
IGYsIGZ4cF9hY3R1YWwsIGZ4cF9taW4sIGZ4cF9tYXg7CisJdTggcG47CiAKLQkvKiBGaW5kIGRl
c2lyZWQgdmFsdWUgb2YgKEYgeCBQKQotCSAqIE5vdGUgdGhhdCwgaWYgRiB4IFAgaXMgb3V0IG9m
IHN1cHBvcnRlZCByYW5nZSwgdGhlIG1heGltdW0gdmFsdWUgb3IKLQkgKiBtaW5pbXVtIHZhbHVl
IHdpbGwgYXBwbGllZCBhdXRvbWF0aWNhbGx5LiBTbyBubyBuZWVkIHRvIGNoZWNrIHRoYXQuCi0J
ICovCiAJZnJlcSA9IGRldl9wcml2LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6OwotCURSTV9E
RUJVR19LTVMoIlZCVCBkZWZpbmVkIGJhY2tsaWdodCBmcmVxdWVuY3kgJXUgSHpcbiIsIGZyZXEp
OwogCWlmICghZnJlcSkgewogCQlEUk1fREVCVUdfS01TKCJVc2UgcGFuZWwgZGVmYXVsdCBiYWNr
bGlnaHQgZnJlcXVlbmN5XG4iKTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWZ4cCA9IERJVl9S
T1VORF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJR0hUX0ZSRVFfQkFTRV9LSFopLCBmcmVxKTsK
LQotCS8qIFVzZSBoaWdoZXN0IHBvc3NpYmxlIHZhbHVlIG9mIFBuIGZvciBtb3JlIGdyYW51bGFy
aXR5IG9mIGJyaWdodG5lc3MKLQkgKiBhZGp1c3RtZW50IHdoaWxlIHNhdGlmeWluZyB0aGUgY29u
ZGl0aW9ucyBiZWxvdy4KLQkgKiAtIFBuIGlzIGluIHRoZSByYW5nZSBvZiBQbl9taW4gYW5kIFBu
X21heAotCSAqIC0gRiBpcyBpbiB0aGUgcmFuZ2Ugb2YgMSBhbmQgMjU1Ci0JICogLSBGeFAgaXMg
d2l0aGluIDI1JSBvZiBkZXNpcmVkIHZhbHVlLgotCSAqICAgTm90ZTogMjUlIGlzIGFyYml0cmFy
eSB2YWx1ZSBhbmQgbWF5IG5lZWQgc29tZSB0d2Vhay4KLQkgKi8KLQlpZiAoZHJtX2RwX2RwY2Rf
cmVhZGIoJmludGVsX2RwLT5hdXgsCi0JCQkgICAgICAgRFBfRURQX1BXTUdFTl9CSVRfQ09VTlRf
Q0FQX01JTiwgJnBuX21pbikgIT0gMSkgewotCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gcmVh
ZCBwd21nZW4gYml0IGNvdW50IGNhcCBtaW5cbiIpOworCWlmIChkcm1fZHBfZHBjZF9yZWFkYigm
aW50ZWxfZHAtPmF1eCwgRFBfRURQX1BXTUdFTl9CSVRfQ09VTlQsCisJCQkgICAgICAmcG4pIDwg
MCkgeworCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gcmVhZCBhdXggcHdtZ2VuIGJpdCBjb3Vu
dFxuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9Ci0JaWYgKGRybV9kcF9kcGNkX3JlYWRiKCZpbnRl
bF9kcC0+YXV4LAotCQkJICAgICAgIERQX0VEUF9QV01HRU5fQklUX0NPVU5UX0NBUF9NQVgsICZw
bl9tYXgpICE9IDEpIHsKLQkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHJlYWQgcHdtZ2VuIGJp
dCBjb3VudCBjYXAgbWF4XG4iKTsKLQkJcmV0dXJuIGZhbHNlOwotCX0KLQlwbl9taW4gJj0gRFBf
RURQX1BXTUdFTl9CSVRfQ09VTlRfTUFTSzsKLQlwbl9tYXggJj0gRFBfRURQX1BXTUdFTl9CSVRf
Q09VTlRfTUFTSzsKIAorCWZ4cCA9IERJVl9ST1VORF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJ
R0hUX0ZSRVFfQkFTRV9LSFopLCBmcmVxKTsKKwlmID0gY2xhbXAoRElWX1JPVU5EX0NMT1NFU1Qo
ZnhwLCAxIDw8IHBuKSwgMSwgMjU1KTsKKwlmeHBfYWN0dWFsID0gZiA8PCBwbjsKKworCS8qIEVu
c3VyZSBmcmVxdWVuY3kgaXMgd2l0aGluIDI1JSBvZiBkZXNpcmVkIHZhbHVlICovCiAJZnhwX21p
biA9IERJVl9ST1VORF9DTE9TRVNUKGZ4cCAqIDMsIDQpOwogCWZ4cF9tYXggPSBESVZfUk9VTkRf
Q0xPU0VTVChmeHAgKiA1LCA0KTsKLQlpZiAoZnhwX21pbiA8ICgxIDw8IHBuX21pbikgfHwgKDI1
NSA8PCBwbl9tYXgpIDwgZnhwX21heCkgewotCQlEUk1fREVCVUdfS01TKCJWQlQgZGVmaW5lZCBi
YWNrbGlnaHQgZnJlcXVlbmN5IG91dCBvZiByYW5nZVxuIik7Ci0JCXJldHVybiBmYWxzZTsKLQl9
CiAKLQlmb3IgKHBuID0gcG5fbWF4OyBwbiA+PSBwbl9taW47IHBuLS0pIHsKLQkJZiA9IGNsYW1w
KERJVl9ST1VORF9DTE9TRVNUKGZ4cCwgMSA8PCBwbiksIDEsIDI1NSk7Ci0JCWZ4cF9hY3R1YWwg
PSBmIDw8IHBuOwotCQlpZiAoZnhwX21pbiA8PSBmeHBfYWN0dWFsICYmIGZ4cF9hY3R1YWwgPD0g
ZnhwX21heCkKLQkJCWJyZWFrOwotCX0KLQotCWlmIChkcm1fZHBfZHBjZF93cml0ZWIoJmludGVs
X2RwLT5hdXgsCi0JCQkgICAgICAgRFBfRURQX1BXTUdFTl9CSVRfQ09VTlQsIHBuKSA8IDApIHsK
LQkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHdyaXRlIGF1eCBwd21nZW4gYml0IGNvdW50XG4i
KTsKKwlpZiAoZnhwX21pbiA+IGZ4cF9hY3R1YWwgfHwgZnhwX2FjdHVhbCA+IGZ4cF9tYXgpIHsK
KwkJRFJNX0RFQlVHX0tNUygiQWN0dWFsIGZyZXF1ZW5jeSBvdXQgb2YgcmFuZ2VcbiIpOwogCQly
ZXR1cm4gZmFsc2U7CiAJfQorCiAJaWYgKGRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1
eCwKIAkJCSAgICAgICBEUF9FRFBfQkFDS0xJR0hUX0ZSRVFfU0VULCAodTgpIGYpIDwgMCkgewog
CQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3JpdGUgYXV4IGJhY2tsaWdodCBmcmVxXG4iKTsK
QEAgLTIyNCwxNiArMTk3LDg3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2F1eF9kaXNhYmxlX2Jh
Y2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkCiAJc2V0X2F1eF9i
YWNrbGlnaHRfZW5hYmxlKGVuY190b19pbnRlbF9kcChvbGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNv
ZGVyKSwgZmFsc2UpOwogfQogCitzdGF0aWMgdTMyIGludGVsX2RwX2F1eF9jYWxjX21heF9iYWNr
bGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJ
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmY29ubmVjdG9yLT5l
bmNvZGVyLT5iYXNlKTsKKwl1MzIgbWF4X2JhY2tsaWdodCA9IDA7CisJaW50IGZyZXEsIGZ4cCwg
ZnhwX21pbiwgZnhwX21heCwgZnhwX2FjdHVhbCwgZiA9IDE7CisJdTggcG4sIHBuX21pbiwgcG5f
bWF4OworCisJaWYgKGRybV9kcF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LCBEUF9FRFBfUFdN
R0VOX0JJVF9DT1VOVCwgJnBuKSkgeworCQlwbiAmPSBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVF9N
QVNLOworCQltYXhfYmFja2xpZ2h0ID0gKDEgPDwgcG4pIC0gMTsKKwl9CisKKwkvKiBGaW5kIGRl
c2lyZWQgdmFsdWUgb2YgKEYgeCBQKQorCSAqIE5vdGUgdGhhdCwgaWYgRiB4IFAgaXMgb3V0IG9m
IHN1cHBvcnRlZCByYW5nZSwgdGhlIG1heGltdW0gdmFsdWUgb3IKKwkgKiBtaW5pbXVtIHZhbHVl
IHdpbGwgYXBwbGllZCBhdXRvbWF0aWNhbGx5LiBTbyBubyBuZWVkIHRvIGNoZWNrIHRoYXQuCisJ
ICovCisJZnJlcSA9IGRldl9wcml2LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6OworCURSTV9E
RUJVR19LTVMoIlZCVCBkZWZpbmVkIGJhY2tsaWdodCBmcmVxdWVuY3kgJXUgSHpcbiIsIGZyZXEp
OworCWlmICghZnJlcSkgeworCQlEUk1fREVCVUdfS01TKCJVc2UgcGFuZWwgZGVmYXVsdCBiYWNr
bGlnaHQgZnJlcXVlbmN5XG4iKTsKKwkJcmV0dXJuIG1heF9iYWNrbGlnaHQ7CisJfQorCisJZnhw
ID0gRElWX1JPVU5EX0NMT1NFU1QoS0h6KERQX0VEUF9CQUNLTElHSFRfRlJFUV9CQVNFX0tIWiks
IGZyZXEpOworCisJLyogVXNlIGhpZ2hlc3QgcG9zc2libGUgdmFsdWUgb2YgUG4gZm9yIG1vcmUg
Z3JhbnVsYXJpdHkgb2YgYnJpZ2h0bmVzcworCSAqIGFkanVzdG1lbnQgd2hpbGUgc2F0aWZ5aW5n
IHRoZSBjb25kaXRpb25zIGJlbG93LgorCSAqIC0gUG4gaXMgaW4gdGhlIHJhbmdlIG9mIFBuX21p
biBhbmQgUG5fbWF4CisJICogLSBGIGlzIGluIHRoZSByYW5nZSBvZiAxIGFuZCAyNTUKKwkgKiAt
IEZ4UCBpcyB3aXRoaW4gMjUlIG9mIGRlc2lyZWQgdmFsdWUuCisJICogICBOb3RlOiAyNSUgaXMg
YXJiaXRyYXJ5IHZhbHVlIGFuZCBtYXkgbmVlZCBzb21lIHR3ZWFrLgorCSAqLworCWlmIChkcm1f
ZHBfZHBjZF9yZWFkYigmaW50ZWxfZHAtPmF1eCwKKwkJCSAgICAgICBEUF9FRFBfUFdNR0VOX0JJ
VF9DT1VOVF9DQVBfTUlOLCAmcG5fbWluKSAhPSAxKSB7CisJCURSTV9ERUJVR19LTVMoIkZhaWxl
ZCB0byByZWFkIHB3bWdlbiBiaXQgY291bnQgY2FwIG1pblxuIik7CisJCXJldHVybiBtYXhfYmFj
a2xpZ2h0OworCX0KKwlpZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsCisJCQkg
ICAgICAgRFBfRURQX1BXTUdFTl9CSVRfQ09VTlRfQ0FQX01BWCwgJnBuX21heCkgIT0gMSkgewor
CQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gcmVhZCBwd21nZW4gYml0IGNvdW50IGNhcCBtYXhc
biIpOworCQlyZXR1cm4gbWF4X2JhY2tsaWdodDsKKwl9CisJcG5fbWluICY9IERQX0VEUF9QV01H
RU5fQklUX0NPVU5UX01BU0s7CisJcG5fbWF4ICY9IERQX0VEUF9QV01HRU5fQklUX0NPVU5UX01B
U0s7CisKKwlmeHBfbWluID0gRElWX1JPVU5EX0NMT1NFU1QoZnhwICogMywgNCk7CisJZnhwX21h
eCA9IERJVl9ST1VORF9DTE9TRVNUKGZ4cCAqIDUsIDQpOworCWlmIChmeHBfbWluIDwgKDEgPDwg
cG5fbWluKSB8fCAoMjU1IDw8IHBuX21heCkgPCBmeHBfbWF4KSB7CisJCURSTV9ERUJVR19LTVMo
IlZCVCBkZWZpbmVkIGJhY2tsaWdodCBmcmVxdWVuY3kgb3V0IG9mIHJhbmdlXG4iKTsKKwkJcmV0
dXJuIG1heF9iYWNrbGlnaHQ7CisJfQorCisJZm9yIChwbiA9IHBuX21heDsgcG4gPj0gcG5fbWlu
OyBwbi0tKSB7CisJCWYgPSBjbGFtcChESVZfUk9VTkRfQ0xPU0VTVChmeHAsIDEgPDwgcG4pLCAx
LCAyNTUpOworCQlmeHBfYWN0dWFsID0gZiA8PCBwbjsKKwkJaWYgKGZ4cF9taW4gPD0gZnhwX2Fj
dHVhbCAmJiBmeHBfYWN0dWFsIDw9IGZ4cF9tYXgpCisJCQlicmVhazsKKwl9CisKKwlpZiAoZHJt
X2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LAorCQkJICAgICAgIERQX0VEUF9QV01HRU5f
QklUX0NPVU5ULCBwbikgPCAwKSB7CisJCURSTV9ERUJVR19LTVMoIkZhaWxlZCB0byB3cml0ZSBh
dXggcHdtZ2VuIGJpdCBjb3VudFxuIik7CisJCXJldHVybiBtYXhfYmFja2xpZ2h0OworCX0KKwor
CW1heF9iYWNrbGlnaHQgPSAoMSA8PCBwbikgLSAxOworCisJcmV0dXJuIG1heF9iYWNrbGlnaHQ7
Cit9CisKIHN0YXRpYyBpbnQgaW50ZWxfZHBfYXV4X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkJCWVudW0gcGlwZSBwaXBlKQogewogCXN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rvci0+ZW5jb2Rl
ci0+YmFzZSk7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVs
OwogCi0JaWYgKGludGVsX2RwLT5lZHBfZHBjZFsyXSAmIERQX0VEUF9CQUNLTElHSFRfQlJJR0hU
TkVTU19CWVRFX0NPVU5UKQotCQlwYW5lbC0+YmFja2xpZ2h0Lm1heCA9IDB4RkZGRjsKLQllbHNl
Ci0JCXBhbmVsLT5iYWNrbGlnaHQubWF4ID0gMHhGRjsKKwlwYW5lbC0+YmFja2xpZ2h0Lm1heCA9
IGludGVsX2RwX2F1eF9jYWxjX21heF9iYWNrbGlnaHQoY29ubmVjdG9yKTsKKworCWlmICghcGFu
ZWwtPmJhY2tsaWdodC5tYXgpCisJCXJldHVybiAtRU5PREVWOwogCiAJcGFuZWwtPmJhY2tsaWdo
dC5taW4gPSAwOwogCXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBpbnRlbF9kcF9hdXhfZ2V0X2Jh
Y2tsaWdodChjb25uZWN0b3IpOwotLSAKMi4yMi4wLjQxMC5nZDhmZGJlMjFiNS1nb29nCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
