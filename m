Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 30843B63E4
	for <lists+dri-devel@lfdr.de>; Wed, 18 Sep 2019 14:59:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 569D86EF33;
	Wed, 18 Sep 2019 12:59:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa1.bahnhof.se (ste-pvt-msa1.bahnhof.se
 [213.80.101.70])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABB1A6EF31
 for <dri-devel@lists.freedesktop.org>; Wed, 18 Sep 2019 12:59:31 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTP id 30CD23F6DC;
 Wed, 18 Sep 2019 14:59:30 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Received: from ste-pvt-msa1.bahnhof.se ([127.0.0.1])
 by localhost (ste-pvt-msa1.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id xiRUd--qyrav; Wed, 18 Sep 2019 14:59:28 +0200 (CEST)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTPA id 4F6C33F247;
 Wed, 18 Sep 2019 14:59:24 +0200 (CEST)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 6407E360326;
 Wed, 18 Sep 2019 14:59:24 +0200 (CEST)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org
Subject: [PATCH 3/7] drm/ttm: Convert vm callbacks to helpers
Date: Wed, 18 Sep 2019 14:59:10 +0200
Message-Id: <20190918125914.38497-4-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190918125914.38497-1-thomas_os@shipmail.org>
References: <20190918125914.38497-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1568811564; bh=uMSGH2llUf0g/5IIoIoj2eeW+M0du8bxg9TfkDKQh5Q=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Aru0W2Ygo/WXRRZlOXyYkAMlfPAOVVMc5lsIlkOv3UNx/D+Dek3O8RNELJxDKOa7q
 Ox4U2io+QoTysr3p3CYhqcsHuXCJK55HFiA7wCySzYpLvxFwUMGnayrPwYv+whlR4y
 +QDD3Cx+btbMqTy5FIa7yooKowVp9D9+rbshP3Z8=
X-Mailman-Original-Authentication-Results: ste-pvt-msa1.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=Aru0W2Yg; 
 dkim-atps=neutral
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 Rik van Riel <riel@surriel.com>, pv-drivers@vmware.com,
 Minchan Kim <minchan@kernel.org>, Will Deacon <will.deacon@arm.com>,
 Matthew Wilcox <willy@infradead.org>, Christoph Hellwig <hch@infradead.org>,
 Peter Zijlstra <peterz@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com, Souptick Joarder <jrdr.linux@gmail.com>,
 Huang Ying <ying.huang@intel.com>, Andrew Morton <akpm@linux-foundation.org>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKV2l0aCB0aGUg
dm13Z2Z4IGRpcnR5IHRyYWNraW5nLCB0aGUgZGVmYXVsdCBUVE0gZmF1bHQgaGFuZGxlciBpcyBu
b3QKY29tcGxldGVseSBzdWZmaWNpZW50ICh2bXdnZnggbmVlZCB0byBtb2RpZnkgdGhlIHZtYS0+
dm1fZmxhZ3MgbWVtYmVyLAphbmQgYWxzbyBuZWVkcyB0byByZXN0cmljdCB0aGUgbnVtYmVyIG9m
IHByZWZhdWx0cykuCgpXZSBhbHNvIHdhbnQgdG8gcmVwbGljYXRlIHRoZSBuZXcgdHRtX2JvX3Zt
X3Jlc2VydmUoKSBmdW5jdGlvbmFsaXR5CgpTbyBzdGFydCB0dXJuaW5nIHRoZSBUVE0gdm0gY29k
ZSBpbnRvIGhlbHBlcnM6IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZCgpCmFuZCB0dG1fYm9fdm1f
cmVzZXJ2ZSgpLCBhbmQgcHJvdmlkZSBhIGRlZmF1bHQgVFRNIGZhdWx0IGhhbmRsZXIgZm9yIG90
aGVyCmRyaXZlcnMgdG8gdXNlLgoKQ2M6IEFuZHJldyBNb3J0b24gPGFrcG1AbGludXgtZm91bmRh
dGlvbi5vcmc+CkNjOiBNYXR0aGV3IFdpbGNveCA8d2lsbHlAaW5mcmFkZWFkLm9yZz4KQ2M6IFdp
bGwgRGVhY29uIDx3aWxsLmRlYWNvbkBhcm0uY29tPgpDYzogUGV0ZXIgWmlqbHN0cmEgPHBldGVy
ekBpbmZyYWRlYWQub3JnPgpDYzogUmlrIHZhbiBSaWVsIDxyaWVsQHN1cnJpZWwuY29tPgpDYzog
TWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9yZz4KQ2M6IE1pY2hhbCBIb2NrbyA8bWhvY2tv
QHN1c2UuY29tPgpDYzogSHVhbmcgWWluZyA8eWluZy5odWFuZ0BpbnRlbC5jb20+CkNjOiBTb3Vw
dGljayBKb2FyZGVyIDxqcmRyLmxpbnV4QGdtYWlsLmNvbT4KQ2M6ICJKw6lyw7RtZSBHbGlzc2Ui
IDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiAiQ2hyaXN0aWFuIEvDtm5pZyIgPGNocmlzdGlhbi5r
b2VuaWdAYW1kLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFkLm9yZz4K
U2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMgfCAxNjggKysrKysrKysrKysrKysr
KysrKystLS0tLS0tLS0tLS0KIGluY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmggICAgfCAgMTQg
KysrCiAyIGZpbGVzIGNoYW5nZWQsIDExOSBpbnNlcnRpb25zKCspLCA2MyBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib192bS5jIGIvZHJpdmVycy9n
cHUvZHJtL3R0bS90dG1fYm9fdm0uYwppbmRleCA4OTYzNTQ2YmYyNDUuLjBhYzExODM3NTMzZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vdHRtL3R0bV9ib192bS5jCkBAIC00Miw4ICs0Miw2IEBACiAjaW5jbHVkZSA8bGlu
dXgvdWFjY2Vzcy5oPgogI2luY2x1ZGUgPGxpbnV4L21lbV9lbmNyeXB0Lmg+CiAKLSNkZWZpbmUg
VFRNX0JPX1ZNX05VTV9QUkVGQVVMVCAxNgotCiBzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1f
ZmF1bHRfaWRsZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQkJCXN0cnVjdCB2bV9m
YXVsdCAqdm1mKQogewpAQCAtMTA2LDI0ICsxMDQsMzAgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcg
dHRtX2JvX2lvX21lbV9wZm4oc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJKyBwYWdl
X29mZnNldDsKIH0KIAotc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2
bV9mYXVsdCAqdm1mKQorLyoqCisgKiB0dG1fYm9fdm1fcmVzZXJ2ZSAtIFJlc2VydmUgYSBidWZm
ZXIgb2JqZWN0IGluIGEgcmV0cnlhYmxlIHZtIGNhbGxiYWNrCisgKiBAYm86IFRoZSBidWZmZXIg
b2JqZWN0CisgKiBAdm1mOiBUaGUgZmF1bHQgc3RydWN0dXJlIGhhbmRlZCB0byB0aGUgY2FsbGJh
Y2sKKyAqCisgKiB2bSBjYWxsYmFja3MgbGlrZSBmYXVsdCgpIGFuZCAqX21rd3JpdGUoKSBhbGxv
dyBmb3IgdGhlIG1tX3NlbSB0byBiZSBkcm9wcGVkCisgKiBkdXJpbmcgbG9uZyB3YWl0cywgYW5k
IGFmdGVyIHRoZSB3YWl0IHRoZSBjYWxsYmFjayB3aWxsIGJlIHJlc3RhcnRlZC4gVGhpcworICog
aXMgdG8gYWxsb3cgb3RoZXIgdGhyZWFkcyB1c2luZyB0aGUgc2FtZSB2aXJ0dWFsIG1lbW9yeSBz
cGFjZSBjb25jdXJyZW50CisgKiBhY2Nlc3MgdG8gbWFwKCksIHVubWFwKCkgY29tcGxldGVseSB1
bnJlbGF0ZWQgYnVmZmVyIG9iamVjdHMuIFRUTSBidWZmZXIKKyAqIG9iamVjdCByZXNlcnZhdGlv
bnMgc29tZXRpbWVzIHdhaXQgZm9yIEdQVSBhbmQgc2hvdWxkIHRoZXJlZm9yZSBiZQorICogY29u
c2lkZXJlZCBsb25nIHdhaXRzLiBUaGlzIGZ1bmN0aW9uIHJlc2VydmVzIHRoZSBidWZmZXIgb2Jq
ZWN0IGludGVycnVwdGlibHkKKyAqIHRha2luZyB0aGlzIGludG8gYWNjb3VudC4gU3RhcnZhdGlv
biBpcyBhdm9pZGVkIGJ5IHRoZSB2bSBzeXN0ZW0gbm90CisgKiBhbGxvd2luZyB0b28gbWFueSBy
ZXBlYXRlZCByZXN0YXJ0cy4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgaW50ZW5kZWQgdG8gYmUgdXNl
ZCBpbiBjdXN0b21pemVkIGZhdWx0KCkgYW5kIF9ta3dyaXRlKCkKKyAqIGhhbmRsZXJzLgorICoK
KyAqIFJldHVybjoKKyAqICAgIDAgb24gc3VjY2VzcyBhbmQgdGhlIGJvIHdhcyByZXNlcnZlZC4K
KyAqICAgIFZNX0ZBVUxUX1JFVFJZIGlmIGJsb2NraW5nIHdhaXQuCisgKiAgICBWTV9GQVVMVF9O
T1BBR0UgaWYgYmxvY2tpbmcgd2FpdCBhbmQgcmV0cnlpbmcgd2FzIG5vdCBhbGxvd2VkLgorICov
Cit2bV9mYXVsdF90IHR0bV9ib192bV9yZXNlcnZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sCisJCQkgICAgIHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogewotCXN0cnVjdCB2bV9hcmVhX3N0
cnVjdCAqdm1hID0gdm1mLT52bWE7Ci0Jc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyA9IHZt
YS0+dm1fcHJpdmF0ZV9kYXRhOwotCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2ID0gYm8tPmJk
ZXY7Ci0JdW5zaWduZWQgbG9uZyBwYWdlX29mZnNldDsKLQl1bnNpZ25lZCBsb25nIHBhZ2VfbGFz
dDsKLQl1bnNpZ25lZCBsb25nIHBmbjsKLQlzdHJ1Y3QgdHRtX3R0ICp0dG0gPSBOVUxMOwotCXN0
cnVjdCBwYWdlICpwYWdlOwotCWludCBlcnI7Ci0JaW50IGk7Ci0Jdm1fZmF1bHRfdCByZXQgPSBW
TV9GQVVMVF9OT1BBR0U7Ci0JdW5zaWduZWQgbG9uZyBhZGRyZXNzID0gdm1mLT5hZGRyZXNzOwot
CXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuID0KLQkJJmJkZXYtPm1hbltiby0+bWVt
Lm1lbV90eXBlXTsKLQlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgY3ZtYTsKLQogCS8qCiAJICogV29y
ayBhcm91bmQgbG9ja2luZyBvcmRlciByZXZlcnNhbCBpbiBmYXVsdCAvIG5vcGZuCiAJICogYmV0
d2VlbiBtbWFwX3NlbSBhbmQgYm9fcmVzZXJ2ZTogUGVyZm9ybSBhIHRyeWxvY2sgb3BlcmF0aW9u
CkBAIC0xNTAsMTQgKzE1NCw1NCBAQCBzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQo
c3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCXJldHVybiBWTV9GQVVMVF9OT1BBR0U7CiAJfQogCisJ
cmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MKHR0bV9ib192bV9yZXNlcnZlKTsKKworLyoqCisg
KiB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQgLSBUVE0gZmF1bHQgaGVscGVyCisgKiBAdm1mOiBU
aGUgc3RydWN0IHZtX2ZhdWx0IGdpdmVuIGFzIGFyZ3VtZW50IHRvIHRoZSBmYXVsdCBjYWxsYmFj
aworICogQHByb3Q6IFRoZSBwYWdlIHByb3RlY3Rpb24gdG8gYmUgdXNlZCBmb3IgdGhpcyBtZW1v
cnkgYXJlYS4KKyAqIEBudW1fcHJlZmF1bHQ6IE1heGltdW0gbnVtYmVyIG9mIHByZWZhdWx0IHBh
Z2VzLiBUaGUgY2FsbGVyIG1heSB3YW50IHRvCisgKiBzcGVjaWZ5IHRoaXMgYmFzZWQgb24gbWFk
dmljZSBzZXR0aW5ncyBhbmQgdGhlIHNpemUgb2YgdGhlIEdQVSBvYmplY3QKKyAqIGJhY2tlZCBi
eSB0aGUgbWVtb3J5LgorICoKKyAqIFRoaXMgZnVuY3Rpb24gaW5zZXJ0cyBvbmUgb3IgbW9yZSBw
YWdlIHRhYmxlIGVudHJpZXMgcG9pbnRpbmcgdG8gdGhlCisgKiBtZW1vcnkgYmFja2luZyB0aGUg
YnVmZmVyIG9iamVjdCwgYW5kIHRoZW4gcmV0dXJucyBhIHJldHVybiBjb2RlCisgKiBpbnN0cnVj
dGluZyB0aGUgY2FsbGVyIHRvIHJldHJ5IHRoZSBwYWdlIGFjY2Vzcy4KKyAqCisgKiBSZXR1cm46
CisgKiAgIFZNX0ZBVUxUX05PUEFHRSBvbiBzdWNjZXNzIG9yIHBlbmRpbmcgc2lnbmFsCisgKiAg
IFZNX0ZBVUxUX1NJR0JVUyBvbiB1bnNwZWNpZmllZCBlcnJvcgorICogICBWTV9GQVVMVF9PT00g
b24gb3V0LW9mLW1lbW9yeQorICogICBWTV9GQVVMVF9SRVRSWSBpZiByZXRyeWFibGUgd2FpdAor
ICovCit2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZChzdHJ1Y3Qgdm1fZmF1bHQg
KnZtZiwKKwkJCQkgICAgcGdwcm90X3QgcHJvdCwKKwkJCQkgICAgcGdvZmZfdCBudW1fcHJlZmF1
bHQpCit7CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKKwlzdHJ1Y3Qg
dm1fYXJlYV9zdHJ1Y3QgY3ZtYSA9ICp2bWE7CisJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpi
byA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOworCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2ID0g
Ym8tPmJkZXY7CisJdW5zaWduZWQgbG9uZyBwYWdlX29mZnNldDsKKwl1bnNpZ25lZCBsb25nIHBh
Z2VfbGFzdDsKKwl1bnNpZ25lZCBsb25nIHBmbjsKKwlzdHJ1Y3QgdHRtX3R0ICp0dG0gPSBOVUxM
OworCXN0cnVjdCBwYWdlICpwYWdlOworCWludCBlcnI7CisJcGdvZmZfdCBpOworCXZtX2ZhdWx0
X3QgcmV0ID0gVk1fRkFVTFRfTk9QQUdFOworCXVuc2lnbmVkIGxvbmcgYWRkcmVzcyA9IHZtZi0+
YWRkcmVzczsKKwlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9CisJCSZiZGV2LT5t
YW5bYm8tPm1lbS5tZW1fdHlwZV07CisKIAkvKgogCSAqIFJlZnVzZSB0byBmYXVsdCBpbXBvcnRl
ZCBwYWdlcy4gVGhpcyBzaG91bGQgYmUgaGFuZGxlZAogCSAqIChpZiBhdCBhbGwpIGJ5IHJlZGly
ZWN0aW5nIG1tYXAgdG8gdGhlIGV4cG9ydGVyLgogCSAqLwotCWlmIChiby0+dHRtICYmIChiby0+
dHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRykpIHsKLQkJcmV0ID0gVk1fRkFVTFRf
U0lHQlVTOwotCQlnb3RvIG91dF91bmxvY2s7Ci0JfQorCWlmIChiby0+dHRtICYmIChiby0+dHRt
LT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRykpCisJCXJldHVybiBWTV9GQVVMVF9TSUdC
VVM7CiAKIAlpZiAoYmRldi0+ZHJpdmVyLT5mYXVsdF9yZXNlcnZlX25vdGlmeSkgewogCQlzdHJ1
Y3QgZG1hX2ZlbmNlICptb3ZpbmcgPSBkbWFfZmVuY2VfZ2V0KGJvLT5tb3ZpbmcpOwpAQCAtMTY4
LDExICsyMTIsOSBAQCBzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQoc3RydWN0IHZt
X2ZhdWx0ICp2bWYpCiAJCQlicmVhazsKIAkJY2FzZSAtRUJVU1k6CiAJCWNhc2UgLUVSRVNUQVJU
U1lTOgotCQkJcmV0ID0gVk1fRkFVTFRfTk9QQUdFOwotCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
cmV0dXJuIFZNX0ZBVUxUX05PUEFHRTsKIAkJZGVmYXVsdDoKLQkJCXJldCA9IFZNX0ZBVUxUX1NJ
R0JVUzsKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CiAJ
CX0KIAogCQlpZiAoYm8tPm1vdmluZyAhPSBtb3ZpbmcpIHsKQEAgLTE4OCwyMSArMjMwLDEyIEBA
IHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikK
IAkgKiBtb3ZlLgogCSAqLwogCXJldCA9IHR0bV9ib192bV9mYXVsdF9pZGxlKGJvLCB2bWYpOwot
CWlmICh1bmxpa2VseShyZXQgIT0gMCkpIHsKLQkJaWYgKHJldCA9PSBWTV9GQVVMVF9SRVRSWSAm
JgotCQkgICAgISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKSB7Ci0JCQkv
KiBUaGUgQk8gaGFzIGFscmVhZHkgYmVlbiB1bnJlc2VydmVkLiAqLwotCQkJcmV0dXJuIHJldDsK
LQkJfQotCi0JCWdvdG8gb3V0X3VubG9jazsKLQl9CisJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkK
KwkJcmV0dXJuIHJldDsKIAogCWVyciA9IHR0bV9tZW1faW9fbG9jayhtYW4sIHRydWUpOwotCWlm
ICh1bmxpa2VseShlcnIgIT0gMCkpIHsKLQkJcmV0ID0gVk1fRkFVTFRfTk9QQUdFOwotCQlnb3Rv
IG91dF91bmxvY2s7Ci0JfQorCWlmICh1bmxpa2VseShlcnIgIT0gMCkpCisJCXJldHVybiBWTV9G
QVVMVF9OT1BBR0U7CiAJZXJyID0gdHRtX21lbV9pb19yZXNlcnZlX3ZtKGJvKTsKIAlpZiAodW5s
aWtlbHkoZXJyICE9IDApKSB7CiAJCXJldCA9IFZNX0ZBVUxUX1NJR0JVUzsKQEAgLTIxOSwxOCAr
MjUyLDggQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2bV9mYXVs
dCAqdm1mKQogCQlnb3RvIG91dF9pb191bmxvY2s7CiAJfQogCi0JLyoKLQkgKiBNYWtlIGEgbG9j
YWwgdm1hIGNvcHkgdG8gbW9kaWZ5IHRoZSBwYWdlX3Byb3QgbWVtYmVyCi0JICogYW5kIHZtX2Zs
YWdzIGlmIG5lY2Vzc2FyeS4gVGhlIHZtYSBwYXJhbWV0ZXIgaXMgcHJvdGVjdGVkCi0JICogYnkg
bW1hcF9zZW0gaW4gd3JpdGUgbW9kZS4KLQkgKi8KLQljdm1hID0gKnZtYTsKLQljdm1hLnZtX3Bh
Z2VfcHJvdCA9IHZtX2dldF9wYWdlX3Byb3QoY3ZtYS52bV9mbGFncyk7Ci0KLQlpZiAoYm8tPm1l
bS5idXMuaXNfaW9tZW0pIHsKLQkJY3ZtYS52bV9wYWdlX3Byb3QgPSB0dG1faW9fcHJvdChiby0+
bWVtLnBsYWNlbWVudCwKLQkJCQkJCWN2bWEudm1fcGFnZV9wcm90KTsKLQl9IGVsc2UgeworCWN2
bWEudm1fcGFnZV9wcm90ID0gdHRtX2lvX3Byb3QoYm8tPm1lbS5wbGFjZW1lbnQsIHByb3QpOwor
CWlmICghYm8tPm1lbS5idXMuaXNfaW9tZW0pIHsKIAkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
IGN0eCA9IHsKIAkJCS5pbnRlcnJ1cHRpYmxlID0gZmFsc2UsCiAJCQkubm9fd2FpdF9ncHUgPSBm
YWxzZSwKQEAgLTIzOSwyNCArMjYyLDIxIEBAIHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9m
YXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkJfTsKIAogCQl0dG0gPSBiby0+dHRtOwotCQlj
dm1hLnZtX3BhZ2VfcHJvdCA9IHR0bV9pb19wcm90KGJvLT5tZW0ucGxhY2VtZW50LAotCQkJCQkJ
Y3ZtYS52bV9wYWdlX3Byb3QpOwotCi0JCS8qIEFsbG9jYXRlIGFsbCBwYWdlIGF0IG9uY2UsIG1v
c3QgY29tbW9uIHVzYWdlICovCi0JCWlmICh0dG1fdHRfcG9wdWxhdGUodHRtLCAmY3R4KSkgewor
CQlpZiAodHRtX3R0X3BvcHVsYXRlKGJvLT50dG0sICZjdHgpKSB7CiAJCQlyZXQgPSBWTV9GQVVM
VF9PT007CiAJCQlnb3RvIG91dF9pb191bmxvY2s7CiAJCX0KKwl9IGVsc2UgeworCQkvKiBJb21l
bSBzaG91bGQgbm90IGJlIG1hcmtlZCBlbmNyeXB0ZWQgKi8KKwkJY3ZtYS52bV9wYWdlX3Byb3Qg
PSBwZ3Byb3RfZGVjcnlwdGVkKGN2bWEudm1fcGFnZV9wcm90KTsKIAl9CiAKIAkvKgogCSAqIFNw
ZWN1bGF0aXZlbHkgcHJlZmF1bHQgYSBudW1iZXIgb2YgcGFnZXMuIE9ubHkgZXJyb3Igb24KIAkg
KiBmaXJzdCBwYWdlLgogCSAqLwotCWZvciAoaSA9IDA7IGkgPCBUVE1fQk9fVk1fTlVNX1BSRUZB
VUxUOyArK2kpIHsKKwlmb3IgKGkgPSAwOyBpIDwgbnVtX3ByZWZhdWx0OyArK2kpIHsKIAkJaWYg
KGJvLT5tZW0uYnVzLmlzX2lvbWVtKSB7Ci0JCQkvKiBJb21lbSBzaG91bGQgbm90IGJlIG1hcmtl
ZCBlbmNyeXB0ZWQgKi8KLQkJCWN2bWEudm1fcGFnZV9wcm90ID0gcGdwcm90X2RlY3J5cHRlZChj
dm1hLnZtX3BhZ2VfcHJvdCk7CiAJCQlwZm4gPSB0dG1fYm9faW9fbWVtX3BmbihibywgcGFnZV9v
ZmZzZXQpOwogCQl9IGVsc2UgewogCQkJcGFnZSA9IHR0bS0+cGFnZXNbcGFnZV9vZmZzZXRdOwpA
QCAtMjk0LDEyICszMTQsMzIgQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0
cnVjdCB2bV9mYXVsdCAqdm1mKQogCXJldCA9IFZNX0ZBVUxUX05PUEFHRTsKIG91dF9pb191bmxv
Y2s6CiAJdHRtX21lbV9pb191bmxvY2sobWFuKTsKLW91dF91bmxvY2s6CisJcmV0dXJuIHJldDsK
K30KK0VYUE9SVF9TWU1CT0wodHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKTsKKworc3RhdGljIHZt
X2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQoreworCXN0cnVj
dCB2bV9hcmVhX3N0cnVjdCAqdm1hID0gdm1mLT52bWE7CisJcGdwcm90X3QgcHJvdDsKKwlzdHJ1
Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gdm1hLT52bV9wcml2YXRlX2RhdGE7CisJdm1fZmF1
bHRfdCByZXQ7CisKKwlyZXQgPSB0dG1fYm9fdm1fcmVzZXJ2ZShibywgdm1mKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OworCisJcHJvdCA9IHZtX2dldF9wYWdlX3Byb3Qodm1hLT52bV9mbGFn
cyk7CisJcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwgcHJvdCwgVFRNX0JPX1ZN
X05VTV9QUkVGQVVMVCk7CisJaWYgKHJldCA9PSBWTV9GQVVMVF9SRVRSWSAmJiAhKHZtZi0+Zmxh
Z3MgJiBGQVVMVF9GTEFHX1JFVFJZX05PV0FJVCkpCisJCXJldHVybiByZXQ7CisKIAlkbWFfcmVz
dl91bmxvY2soYm8tPmJhc2UucmVzdik7CisKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9p
ZCB0dG1fYm9fdm1fb3BlbihzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKK3ZvaWQgdHRtX2Jv
X3ZtX29wZW4oc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCiB7CiAJc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibyA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOwogCkBAIC0zMDcsMTQgKzM0Nywx
NiBAQCBzdGF0aWMgdm9pZCB0dG1fYm9fdm1fb3BlbihzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZt
YSkKIAogCXR0bV9ib19nZXQoYm8pOwogfQorRVhQT1JUX1NZTUJPTCh0dG1fYm9fdm1fb3Blbik7
CiAKLXN0YXRpYyB2b2lkIHR0bV9ib192bV9jbG9zZShzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZt
YSkKK3ZvaWQgdHRtX2JvX3ZtX2Nsb3NlKHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogewog
CXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKIAog
CXR0bV9ib19wdXQoYm8pOwogCXZtYS0+dm1fcHJpdmF0ZV9kYXRhID0gTlVMTDsKIH0KK0VYUE9S
VF9TWU1CT0wodHRtX2JvX3ZtX2Nsb3NlKTsKIAogc3RhdGljIGludCB0dG1fYm9fdm1fYWNjZXNz
X2ttYXAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJCQkgdW5zaWduZWQgbG9uZyBv
ZmZzZXQsCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oIGIvaW5jbHVk
ZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRleCA0M2M0OTI5YTIxNzEuLjg1MTI2MGNiYmIyZiAx
MDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAorKysgYi9pbmNsdWRlL2Ry
bS90dG0vdHRtX2JvX2FwaS5oCkBAIC03ODUsNCArNzg1LDE4IEBAIHN0YXRpYyBpbmxpbmUgYm9v
bCB0dG1fYm9fdXNlc19lbWJlZGRlZF9nZW1fb2JqZWN0KHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8pCiB7CiAJcmV0dXJuIGJvLT5iYXNlLmRldiAhPSBOVUxMOwogfQorCisvKiBEZWZhdWx0
IG51bWJlciBvZiBwcmUtZmF1bHRlZCBwYWdlcyBpbiB0aGUgVFRNIGZhdWx0IGhhbmRsZXIgKi8K
KyNkZWZpbmUgVFRNX0JPX1ZNX05VTV9QUkVGQVVMVCAxNgorCit2bV9mYXVsdF90IHR0bV9ib192
bV9yZXNlcnZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCisJCQkgICAgIHN0cnVjdCB2
bV9mYXVsdCAqdm1mKTsKKwordm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQoc3Ry
dWN0IHZtX2ZhdWx0ICp2bWYsCisJCQkJICAgIHBncHJvdF90IHByb3QsCisJCQkJICAgIHBnb2Zm
X3QgbnVtX3ByZWZhdWx0KTsKKwordm9pZCB0dG1fYm9fdm1fb3BlbihzdHJ1Y3Qgdm1fYXJlYV9z
dHJ1Y3QgKnZtYSk7CisKK3ZvaWQgdHRtX2JvX3ZtX2Nsb3NlKHN0cnVjdCB2bV9hcmVhX3N0cnVj
dCAqdm1hKTsKICNlbmRpZgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWw=
