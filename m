Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BAFFAE1FDE
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:46:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7BBBB6EB32;
	Wed, 23 Oct 2019 15:46:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6788C6EB1A
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:19 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 5E54B28F905;
 Wed, 23 Oct 2019 16:45:17 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 01/21] drm/vc4: Declare the DSI encoder as a bridge element
Date: Wed, 23 Oct 2019 17:44:52 +0200
Message-Id: <20191023154512.9762-2-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RW5jb2RlciBkcml2ZXJzIHdpbGwgcHJvZ3Jlc3NpdmVseSB0cmFuc2l0aW9uIHRvIHRoZSBkcm1f
YnJpZGdlCmludGVyZmFjZSBpbiBwbGFjZSBvZiB0aGUgZHJtX2VuY29kZXIgb25lLgoKTGV0J3Mg
c3RhcnQgd2l0aCB0aGUgVkM0IGRyaXZlciwgYW5kIHVzZSB0aGUgLT5wcmVfe2VuYWJsZSxkaXNh
YmxlfSgpCmhvb2tzIHRvIGdldCByaWQgb2YgdGhlIGhhY2sgcmVzZXR0aW5nIGVuY29kZXItPmJy
aWRnZS5uZXh0ICh3aGljaCB3YXMKbmVlZGVkIHRvIGNvbnRyb2wgdGhlIGVuY29kZXIvYnJpZGdl
IGVuYWJsZS9kaXNhYmxlIHNlcXVlbmNlKS4KClNpZ25lZC1vZmYtYnk6IEJvcmlzIEJyZXppbGxv
biA8Ym9yaXMuYnJlemlsbG9uQGNvbGxhYm9yYS5jb20+Ci0tLQpDaGFuZ2VzIGluIHYzOgoqIEVt
YmVkIGEgZHJtX2JyaWRnZSBvYmplY3QgaW4gdmM0X2RzaSBzaW5jZSBkcm1fZW5jb2RlciBubyBs
b25nZXIgaGFzCiAgYSBkdW1teSBicmlkZ2UKCkNoYW5nZXMgaW4gdjI6CiogTmV3IHBhdGNoIChy
ZXBsYWNlcyAiZHJtL3ZjNDogR2V0IHJpZCBvZiB0aGUgZHNpLT5icmlkZ2UgZmllbGQiKQotLS0K
IGRyaXZlcnMvZ3B1L2RybS92YzQvdmM0X2RzaS5jIHwgODggKysrKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA1MiBpbnNlcnRpb25zKCspLCAzNiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYyBiL2Ry
aXZlcnMvZ3B1L2RybS92YzQvdmM0X2RzaS5jCmluZGV4IGM5YmE4M2VkNDliOS4uNDlmOGEzMTNl
NzU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYwpAQCAtNDk4LDcgKzQ5OCwxMSBAQCBzdHJ1Y3QgdmM0
X2RzaSB7CiAKIAlzdHJ1Y3QgbWlwaV9kc2lfaG9zdCBkc2lfaG9zdDsKIAlzdHJ1Y3QgZHJtX2Vu
Y29kZXIgKmVuY29kZXI7Ci0Jc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKKworCS8qIEVtYmVk
IGEgYnJpZGdlIG9iamVjdCBzbyB3ZSBjYW4gaW1wbGVtZW50IGJyaWRnZSBmdW5jcyBpbnN0ZWFk
IG9mCisJICogZW5jb2RlciBvbmVzLgorCSAqLworCXN0cnVjdCBkcm1fYnJpZGdlIGJyaWRnZTsK
IAogCXZvaWQgX19pb21lbSAqcmVnczsKIApAQCAtNTQzLDYgKzU0NywxMSBAQCBzdHJ1Y3QgdmM0
X2RzaSB7CiAJc3RydWN0IGRlYnVnZnNfcmVnc2V0MzIgcmVnc2V0OwogfTsKIAorc3RhdGljIGlu
bGluZSBzdHJ1Y3QgdmM0X2RzaSAqYnJpZGdlX3RvX3ZjNF9kc2koc3RydWN0IGRybV9icmlkZ2Ug
KmJyaWRnZSkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGJyaWRnZSwgc3RydWN0IHZjNF9kc2ks
IGJyaWRnZSk7Cit9CisKICNkZWZpbmUgaG9zdF90b19kc2koaG9zdCkgY29udGFpbmVyX29mKGhv
c3QsIHN0cnVjdCB2YzRfZHNpLCBkc2lfaG9zdCkKIAogc3RhdGljIGlubGluZSB2b2lkCkBAIC03
NDcsMTYgKzc1NiwxMSBAQCBkc2lfZXNjX3RpbWluZyh1MzIgbnMpCiAJcmV0dXJuIERJVl9ST1VO
RF9VUChucywgRVNDX1RJTUVfTlMpOwogfQogCi1zdGF0aWMgdm9pZCB2YzRfZHNpX2VuY29kZXJf
ZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCitzdGF0aWMgdm9pZCB2YzRfZHNp
X2JyaWRnZV9wb3N0X2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKIHsKLQlzdHJ1
Y3QgdmM0X2RzaV9lbmNvZGVyICp2YzRfZW5jb2RlciA9IHRvX3ZjNF9kc2lfZW5jb2RlcihlbmNv
ZGVyKTsKLQlzdHJ1Y3QgdmM0X2RzaSAqZHNpID0gdmM0X2VuY29kZXItPmRzaTsKKwlzdHJ1Y3Qg
dmM0X2RzaSAqZHNpID0gYnJpZGdlX3RvX3ZjNF9kc2koYnJpZGdlKTsKIAlzdHJ1Y3QgZGV2aWNl
ICpkZXYgPSAmZHNpLT5wZGV2LT5kZXY7CiAKLQlkcm1fYnJpZGdlX2Rpc2FibGUoZHNpLT5icmlk
Z2UpOwotCXZjNF9kc2lfdWxwcyhkc2ksIHRydWUpOwotCWRybV9icmlkZ2VfcG9zdF9kaXNhYmxl
KGRzaS0+YnJpZGdlKTsKLQogCWNsa19kaXNhYmxlX3VucHJlcGFyZShkc2ktPnBsbF9waHlfY2xv
Y2spOwogCWNsa19kaXNhYmxlX3VucHJlcGFyZShkc2ktPmVzY2FwZV9jbG9jayk7CiAJY2xrX2Rp
c2FibGVfdW5wcmVwYXJlKGRzaS0+cGl4ZWxfY2xvY2spOwpAQCAtNzY0LDYgKzc2OCwxMyBAQCBz
dGF0aWMgdm9pZCB2YzRfZHNpX2VuY29kZXJfZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIpCiAJcG1fcnVudGltZV9wdXQoZGV2KTsKIH0KIAorc3RhdGljIHZvaWQgdmM0X2RzaV9i
cmlkZ2VfZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCB2YzRf
ZHNpICpkc2kgPSBicmlkZ2VfdG9fdmM0X2RzaShicmlkZ2UpOworCisJdmM0X2RzaV91bHBzKGRz
aSwgdHJ1ZSk7Cit9CisKIC8qIEV4dGVuZHMgdGhlIG1vZGUncyBibGFuayBpbnRlcnZhbHMgdG8g
aGFuZGxlIEJDTTI4MzUncyBpbnRlZ2VyLW9ubHkKICAqIERTSSBQTEwgZGl2aWRlci4KICAqCkBA
IC03NzcsMTIgKzc4OCwxMSBAQCBzdGF0aWMgdm9pZCB2YzRfZHNpX2VuY29kZXJfZGlzYWJsZShz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAgKiBoaWdoZXItdGhhbi1leHBlY3RlZCBjbG9j
ayByYXRlIHRvIHRoZSBwYW5lbCwgYnV0IHRoYXQncyB3aGF0IHRoZQogICogZmlybXdhcmUgZG9l
cyB0b28uCiAgKi8KLXN0YXRpYyBib29sIHZjNF9kc2lfZW5jb2Rlcl9tb2RlX2ZpeHVwKHN0cnVj
dCBkcm1fZW5jb2RlciAqZW5jb2RlciwKLQkJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKm1vZGUsCi0JCQkJICAgICAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlKQorc3RhdGljIGJvb2wgdmM0X2RzaV9icmlkZ2VfbW9kZV9maXh1cChzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICptb2RlLAorCQkJCSAgICAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlKQogewotCXN0cnVjdCB2YzRfZHNpX2VuY29kZXIgKnZjNF9lbmNvZGVyID0gdG9fdmM0X2Rz
aV9lbmNvZGVyKGVuY29kZXIpOwotCXN0cnVjdCB2YzRfZHNpICpkc2kgPSB2YzRfZW5jb2Rlci0+
ZHNpOworCXN0cnVjdCB2YzRfZHNpICpkc2kgPSBicmlkZ2VfdG9fdmM0X2RzaShicmlkZ2UpOwog
CXN0cnVjdCBjbGsgKnBoeV9wYXJlbnQgPSBjbGtfZ2V0X3BhcmVudChkc2ktPnBsbF9waHlfY2xv
Y2spOwogCXVuc2lnbmVkIGxvbmcgcGFyZW50X3JhdGUgPSBjbGtfZ2V0X3JhdGUocGh5X3BhcmVu
dCk7CiAJdW5zaWduZWQgbG9uZyBwaXhlbF9jbG9ja19oeiA9IG1vZGUtPmNsb2NrICogMTAwMDsK
QEAgLTgxNiwxMSArODI2LDExIEBAIHN0YXRpYyBib29sIHZjNF9kc2lfZW5jb2Rlcl9tb2RlX2Zp
eHVwKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3Rh
dGljIHZvaWQgdmM0X2RzaV9lbmNvZGVyX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29k
ZXIpCitzdGF0aWMgdm9pZCB2YzRfZHNpX2JyaWRnZV9wcmVfZW5hYmxlKHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UpCiB7CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyID0gYnJpZGdlLT5l
bmNvZGVyOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJmVuY29kZXItPmNydGMt
PnN0YXRlLT5hZGp1c3RlZF9tb2RlOwotCXN0cnVjdCB2YzRfZHNpX2VuY29kZXIgKnZjNF9lbmNv
ZGVyID0gdG9fdmM0X2RzaV9lbmNvZGVyKGVuY29kZXIpOwotCXN0cnVjdCB2YzRfZHNpICpkc2kg
PSB2YzRfZW5jb2Rlci0+ZHNpOworCXN0cnVjdCB2YzRfZHNpICpkc2kgPSBicmlkZ2VfdG9fdmM0
X2RzaShicmlkZ2UpOwogCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZkc2ktPnBkZXYtPmRldjsKIAli
b29sIGRlYnVnX2R1bXBfcmVncyA9IGZhbHNlOwogCXVuc2lnbmVkIGxvbmcgaHNfY2xvY2s7CkBA
IC0xMDU0LDggKzEwNjQsMTIgQEAgc3RhdGljIHZvaWQgdmM0X2RzaV9lbmNvZGVyX2VuYWJsZShz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJfQogCiAJdmM0X2RzaV91bHBzKGRzaSwgZmFs
c2UpOworfQogCi0JZHJtX2JyaWRnZV9wcmVfZW5hYmxlKGRzaS0+YnJpZGdlKTsKK3N0YXRpYyB2
b2lkIHZjNF9kc2lfYnJpZGdlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQorewor
CXN0cnVjdCB2YzRfZHNpICpkc2kgPSBicmlkZ2VfdG9fdmM0X2RzaShicmlkZ2UpOworCWJvb2wg
ZGVidWdfZHVtcF9yZWdzID0gZmFsc2U7CiAKIAlpZiAoZHNpLT5tb2RlX2ZsYWdzICYgTUlQSV9E
U0lfTU9ERV9WSURFTykgewogCQlEU0lfUE9SVF9XUklURShESVNQMF9DVFJMLApAQCAtMTA3Miw4
ICsxMDg2LDYgQEAgc3RhdGljIHZvaWQgdmM0X2RzaV9lbmNvZGVyX2VuYWJsZShzdHJ1Y3QgZHJt
X2VuY29kZXIgKmVuY29kZXIpCiAJCQkgICAgICAgRFNJX0RJU1AwX0VOQUJMRSk7CiAJfQogCi0J
ZHJtX2JyaWRnZV9lbmFibGUoZHNpLT5icmlkZ2UpOwotCiAJaWYgKGRlYnVnX2R1bXBfcmVncykg
ewogCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoJmRzaS0+cGRldi0+
ZGV2KTsKIAkJZGV2X2luZm8oJmRzaS0+cGRldi0+ZGV2LCAiRFNJIHJlZ3MgYWZ0ZXI6XG4iKTsK
QEAgLTEyOTAsMTAgKzEzMDIsMTIgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBtaXBpX2RzaV9ob3N0
X29wcyB2YzRfZHNpX2hvc3Rfb3BzID0gewogCS50cmFuc2ZlciA9IHZjNF9kc2lfaG9zdF90cmFu
c2ZlciwKIH07CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNz
IHZjNF9kc2lfZW5jb2Rlcl9oZWxwZXJfZnVuY3MgPSB7Ci0JLmRpc2FibGUgPSB2YzRfZHNpX2Vu
Y29kZXJfZGlzYWJsZSwKLQkuZW5hYmxlID0gdmM0X2RzaV9lbmNvZGVyX2VuYWJsZSwKLQkubW9k
ZV9maXh1cCA9IHZjNF9kc2lfZW5jb2Rlcl9tb2RlX2ZpeHVwLAorc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fYnJpZGdlX2Z1bmNzIHZjNF9kc2lfYnJpZGdlX2Z1bmNzID0geworCS5wcmVfZW5hYmxl
ID0gdmM0X2RzaV9icmlkZ2VfcHJlX2VuYWJsZSwKKwkuZW5hYmxlID0gdmM0X2RzaV9icmlkZ2Vf
ZW5hYmxlLAorCS5kaXNhYmxlID0gdmM0X2RzaV9icmlkZ2VfZGlzYWJsZSwKKwkucG9zdF9kaXNh
YmxlID0gdmM0X2RzaV9icmlkZ2VfcG9zdF9kaXNhYmxlLAorCS5tb2RlX2ZpeHVwID0gdmM0X2Rz
aV9icmlkZ2VfbW9kZV9maXh1cCwKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNl
X2lkIHZjNF9kc2lfZHRfbWF0Y2hbXSA9IHsKQEAgLTE0NDUsNiArMTQ1OSw3IEBAIHN0YXRpYyBp
bnQgdmM0X2RzaV9iaW5kKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZSAqbWFzdGVy
LCB2b2lkICpkYXRhKQogCXN0cnVjdCB2YzRfZGV2ICp2YzQgPSB0b192YzRfZGV2KGRybSk7CiAJ
c3RydWN0IHZjNF9kc2kgKmRzaSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwogCXN0cnVjdCB2YzRf
ZHNpX2VuY29kZXIgKnZjNF9kc2lfZW5jb2RlcjsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAqbmV4dF9i
cmlkZ2U7CiAJc3RydWN0IGRybV9wYW5lbCAqcGFuZWw7CiAJY29uc3Qgc3RydWN0IG9mX2Rldmlj
ZV9pZCAqbWF0Y2g7CiAJZG1hX2NhcF9tYXNrX3QgZG1hX21hc2s7CkBAIC0xNTYxLDcgKzE1NzYs
NyBAQCBzdGF0aWMgaW50IHZjNF9kc2lfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBk
ZXZpY2UgKm1hc3Rlciwgdm9pZCAqZGF0YSkKIAl9CiAKIAlyZXQgPSBkcm1fb2ZfZmluZF9wYW5l
bF9vcl9icmlkZ2UoZGV2LT5vZl9ub2RlLCAwLCAwLAotCQkJCQkgICZwYW5lbCwgJmRzaS0+YnJp
ZGdlKTsKKwkJCQkJICAmcGFuZWwsICZuZXh0X2JyaWRnZSk7CiAJaWYgKHJldCkgewogCQkvKiBJ
ZiB0aGUgYnJpZGdlIG9yIHBhbmVsIHBvaW50ZWQgYnkgZGV2LT5vZl9ub2RlIGlzIG5vdAogCQkg
KiBlbmFibGVkLCBqdXN0IHJldHVybiAwIGhlcmUgc28gdGhhdCB3ZSBkb24ndCBwcmV2ZW50IHRo
ZSBEUk0KQEAgLTE1NzYsMTAgKzE1OTEsMTAgQEAgc3RhdGljIGludCB2YzRfZHNpX2JpbmQoc3Ry
dWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiAJfQog
CiAJaWYgKHBhbmVsKSB7Ci0JCWRzaS0+YnJpZGdlID0gZGV2bV9kcm1fcGFuZWxfYnJpZGdlX2Fk
ZF90eXBlZChkZXYsIHBhbmVsLAorCQluZXh0X2JyaWRnZSA9IGRldm1fZHJtX3BhbmVsX2JyaWRn
ZV9hZGRfdHlwZWQoZGV2LCBwYW5lbCwKIAkJCQkJCQkgICAgICBEUk1fTU9ERV9DT05ORUNUT1Jf
RFNJKTsKLQkJaWYgKElTX0VSUihkc2ktPmJyaWRnZSkpCi0JCQlyZXR1cm4gUFRSX0VSUihkc2kt
PmJyaWRnZSk7CisJCWlmIChJU19FUlIobmV4dF9icmlkZ2UpKQorCQkJcmV0dXJuIFBUUl9FUlIo
bmV4dF9icmlkZ2UpOwogCX0KIAogCS8qIFRoZSBlc2MgY2xvY2sgcmF0ZSBpcyBzdXBwb3NlZCB0
byBhbHdheXMgYmUgMTAwTWh6LiAqLwpAQCAtMTU5OCwxOSArMTYxMywyMCBAQCBzdGF0aWMgaW50
IHZjNF9kc2lfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2UgKm1hc3Rlciwg
dm9pZCAqZGF0YSkKIAogCWRybV9lbmNvZGVyX2luaXQoZHJtLCBkc2ktPmVuY29kZXIsICZ2YzRf
ZHNpX2VuY29kZXJfZnVuY3MsCiAJCQkgRFJNX01PREVfRU5DT0RFUl9EU0ksIE5VTEwpOwotCWRy
bV9lbmNvZGVyX2hlbHBlcl9hZGQoZHNpLT5lbmNvZGVyLCAmdmM0X2RzaV9lbmNvZGVyX2hlbHBl
cl9mdW5jcyk7CiAKLQlyZXQgPSBkcm1fYnJpZGdlX2F0dGFjaChkc2ktPmVuY29kZXIsIGRzaS0+
YnJpZGdlLCBOVUxMKTsKKwkvKiBEZWNsYXJlIG91cnNlbGYgYXMgdGhlIGZpcnN0IGJyaWRnZSBl
bGVtZW50LiAqLworCWRzaS0+YnJpZGdlLmZ1bmNzID0gJnZjNF9kc2lfYnJpZGdlX2Z1bmNzOwor
CXJldCA9IGRybV9icmlkZ2VfYXR0YWNoKGRzaS0+ZW5jb2RlciwgJmRzaS0+YnJpZGdlLCBOVUxM
KTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAiYnJpZGdlIGF0dGFjaCBmYWlsZWQ6ICVk
XG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldCA9IGRybV9icmlkZ2VfYXR0YWNo
KGRzaS0+ZW5jb2RlciwgbmV4dF9icmlkZ2UsICZkc2ktPmJyaWRnZSk7CiAJaWYgKHJldCkgewog
CQlkZXZfZXJyKGRldiwgImJyaWRnZSBhdHRhY2ggZmFpbGVkOiAlZFxuIiwgcmV0KTsKIAkJcmV0
dXJuIHJldDsKIAl9Ci0JLyogRGlzYWJsZSB0aGUgYXRvbWljIGhlbHBlciBjYWxscyBpbnRvIHRo
ZSBicmlkZ2UuICBXZQotCSAqIG1hbnVhbGx5IGNhbGwgdGhlIGJyaWRnZSBwcmVfZW5hYmxlIC8g
ZW5hYmxlIC8gZXRjLiBjYWxscwotCSAqIGZyb20gb3VyIGRyaXZlciwgc2luY2Ugd2UgbmVlZCB0
byBzZXF1ZW5jZSB0aGVtIHdpdGhpbiB0aGUKLQkgKiBlbmNvZGVyJ3MgZW5hYmxlL2Rpc2FibGUg
cGF0aHMuCi0JICovCi0JZHNpLT5lbmNvZGVyLT5icmlkZ2UgPSBOVUxMOwogCiAJaWYgKGRzaS0+
cG9ydCA9PSAwKQogCQl2YzRfZGVidWdmc19hZGRfcmVnc2V0MzIoZHJtLCAiZHNpMF9yZWdzIiwg
JmRzaS0+cmVnc2V0KTsKQEAgLTE2MjksNyArMTY0NSw3IEBAIHN0YXRpYyB2b2lkIHZjNF9kc2lf
dW5iaW5kKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZSAqbWFzdGVyLAogCXN0cnVj
dCB2YzRfZGV2ICp2YzQgPSB0b192YzRfZGV2KGRybSk7CiAJc3RydWN0IHZjNF9kc2kgKmRzaSA9
IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwogCi0JaWYgKGRzaS0+YnJpZGdlKQorCWlmIChkc2ktPmJy
aWRnZS5uZXh0KQogCQlwbV9ydW50aW1lX2Rpc2FibGUoZGV2KTsKIAogCXZjNF9kc2lfZW5jb2Rl
cl9kZXN0cm95KGRzaS0+ZW5jb2Rlcik7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
