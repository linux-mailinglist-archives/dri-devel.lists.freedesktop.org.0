Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 309DF10F9F6
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 09:38:29 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D013F6E42C;
	Tue,  3 Dec 2019 08:38:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8515F6E42D
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 08:38:24 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 98A9FAC48;
 Tue,  3 Dec 2019 08:38:22 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, maarten.lankhorst@linux.intel.com, mripard@kernel.org,
 airlied@linux.ie, z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com, sam@ravnborg.org,
 kraxel@redhat.com
Subject: [PATCH v3 1/5] drm/hisilicon/hibmc: Switch to generic fbdev emulation
Date: Tue,  3 Dec 2019 09:38:15 +0100
Message-Id: <20191203083819.6643-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203083819.6643-1-tzimmermann@suse.de>
References: <20191203083819.6643-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUncyBub3RoaW5nIHNwZWNpYWwgYWJvdXQgaGlibWMncyBmYmRldiBlbXVsYXRpb24gdGhh
dCBpcyBub3QKcHJvdmlkZWQgYnkgdGhlIGdlbmVyaWMgaW1wbGVtZW50YXRpb24uIFN3aXRjaCBv
dmVyIGFuZCByZW1vdmUgdGhlCmRyaXZlcidzIGNvZGUuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMg
WmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KUmV2aWV3ZWQtYnk6IERhbmllbCBWZXR0
ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkFja2VkLWJ5OiBTYW0gUmF2bmJvcmcgPHNhbUBy
YXZuYm9yZy5vcmc+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9NYWtlZmls
ZSAgICAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Ry
di5jICAgfCAgIDUgKy0KIC4uLi9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2
LmggICB8ICAxMSAtCiAuLi4vZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2ZiZGV2
LmMgfCAyNDAgLS0tLS0tLS0tLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDMgaW5zZXJ0aW9u
cygrKSwgMjU1IGRlbGV0aW9ucygtKQogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2ZiZGV2LmMKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2hpc2ls
aWNvbi9oaWJtYy9NYWtlZmlsZQppbmRleCAwYzJkNDI5NmJjY2QuLmY5OTEzMjcxNTU5NyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9NYWtlZmlsZQorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL01ha2VmaWxlCkBAIC0xLDQgKzEsNCBAQAog
IyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5Ci1oaWJtYy1kcm0teSA6PSBo
aWJtY19kcm1fZHJ2Lm8gaGlibWNfZHJtX2RlLm8gaGlibWNfZHJtX3ZkYWMubyBoaWJtY19kcm1f
ZmJkZXYubyBoaWJtY190dG0ubworaGlibWMtZHJtLXkgOj0gaGlibWNfZHJtX2Rydi5vIGhpYm1j
X2RybV9kZS5vIGhpYm1jX2RybV92ZGFjLm8gaGlibWNfdHRtLm8KIAogb2JqLSQoQ09ORklHX0RS
TV9ISVNJX0hJQk1DKSArPSBoaWJtYy1kcm0ubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxp
Y29uL2hpYm1jL2hpYm1jX2RybV9kcnYuYwppbmRleCAyZmQ0Y2E5MWE2MmQuLjExM2QyN2I4YThm
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1f
ZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2
LmMKQEAgLTE3LDYgKzE3LDcgQEAKIAogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5o
PgogI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIu
aD4KICNpbmNsdWRlIDxkcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9k
cm1faXJxLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgpAQCAtMjQ3LDggKzI0OCw2IEBA
IHN0YXRpYyBpbnQgaGlibWNfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7CiAJc3Ry
dWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKIAotCWhpYm1j
X2ZiZGV2X2ZpbmkocHJpdik7Ci0KIAlkcm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93bihkZXYpOwog
CiAJaWYgKGRldi0+aXJxX2VuYWJsZWQpCkBAIC0zMDcsNyArMzA2LDcgQEAgc3RhdGljIGludCBo
aWJtY19sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJLyogcmVzZXQgYWxsIHRoZSBzdGF0
ZXMgb2YgY3J0Yy9wbGFuZS9lbmNvZGVyL2Nvbm5lY3RvciAqLwogCWRybV9tb2RlX2NvbmZpZ19y
ZXNldChkZXYpOwogCi0JcmV0ID0gaGlibWNfZmJkZXZfaW5pdChwcml2KTsKKwlyZXQgPSBkcm1f
ZmJkZXZfZ2VuZXJpY19zZXR1cChkZXYsIDE2KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigi
ZmFpbGVkIHRvIGluaXRpYWxpemUgZmJkZXY6ICVkXG4iLCByZXQpOwogCQlnb3RvIGVycjsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmgKaW5kZXgg
ZTU4ZWNkN2VkY2Y4Li5iMzQ0OTNlYWQzMGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9o
aXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oCkBAIC0yNSwxMiArMjUsNiBAQCBzdHJ1Y3QgaGli
bWNfZnJhbWVidWZmZXIgewogCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqOwogfTsKIAotc3Ry
dWN0IGhpYm1jX2ZiZGV2IHsKLQlzdHJ1Y3QgZHJtX2ZiX2hlbHBlciBoZWxwZXI7IC8qIG11c3Qg
YmUgZmlyc3QgKi8KLQlzdHJ1Y3QgaGlibWNfZnJhbWVidWZmZXIgKmZiOwotCWludCBzaXplOwot
fTsKLQogc3RydWN0IGhpYm1jX2RybV9wcml2YXRlIHsKIAkvKiBodyAqLwogCXZvaWQgX19pb21l
bSAgICptbWlvOwpAQCAtNDIsOSArMzYsNiBAQCBzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgewog
CS8qIGRybSAqLwogCXN0cnVjdCBkcm1fZGV2aWNlICAqZGV2OwogCWJvb2wgbW9kZV9jb25maWdf
aW5pdGlhbGl6ZWQ7Ci0KLQkvKiBmYmRldiAqLwotCXN0cnVjdCBoaWJtY19mYmRldiAqZmJkZXY7
CiB9OwogCiAjZGVmaW5lIHRvX2hpYm1jX2ZyYW1lYnVmZmVyKHgpIGNvbnRhaW5lcl9vZih4LCBz
dHJ1Y3QgaGlibWNfZnJhbWVidWZmZXIsIGZiKQpAQCAtNTYsOCArNDcsNiBAQCB2b2lkIGhpYm1j
X3NldF9jdXJyZW50X2dhdGUoc3RydWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2LAogCiBpbnQg
aGlibWNfZGVfaW5pdChzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnByaXYpOwogaW50IGhpYm1j
X3ZkYWNfaW5pdChzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnByaXYpOwotaW50IGhpYm1jX2Zi
ZGV2X2luaXQoc3RydWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2KTsKLXZvaWQgaGlibWNfZmJk
ZXZfZmluaShzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnByaXYpOwogCiBpbnQgaGlibWNfZ2Vt
X2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1MzIgc2l6ZSwgYm9vbCBpc2tlcm5lbCwK
IAkJICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZmJkZXYuYyBiL2RyaXZlcnMvZ3B1
L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2ZiZGV2LmMKZGVsZXRlZCBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IGI0YzFjZWEwNTFlOC4uMDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2ZiZGV2LmMKKysrIC9kZXYvbnVsbApAQCAt
MSwyNDAgKzAsMCBAQAotLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb3ItbGF0
ZXIKLS8qIEhpc2lsaWNvbiBIaWJtYyBTb0MgZHJtIGRyaXZlcgotICoKLSAqIEJhc2VkIG9uIHRo
ZSBib2NocyBkcm0gZHJpdmVyLgotICoKLSAqIENvcHlyaWdodCAoYykgMjAxNiBIdWF3ZWkgTGlt
aXRlZC4KLSAqCi0gKiBBdXRob3I6Ci0gKglSb25ncm9uZyBab3UgPHpvdXJvbmdyb25nQGh1YXdl
aS5jb20+Ci0gKglSb25ncm9uZyBab3UgPHpvdXJvbmdyb25nQGdtYWlsLmNvbT4KLSAqCUppYW5o
dWEgTGkgPGxpamlhbmh1YUBodWF3ZWkuY29tPgotICovCi0KLSNpbmNsdWRlIDxkcm0vZHJtX2Ny
dGMuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1f
Zm91cmNjLmg+Ci0jaW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaD4KLSNpbmNsdWRl
IDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgotCi0jaW5jbHVkZSAiaGlibWNfZHJtX2Rydi5oIgot
Ci1zdGF0aWMgaW50IGhpYm1jZmJfY3JlYXRlX29iamVjdCgKLQkJCQlzdHJ1Y3QgaGlibWNfZHJt
X3ByaXZhdGUgKnByaXYsCi0JCQkJY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVf
Y21kLAotCQkJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmdvYmpfcCkKLXsKLQlzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKmdvYmo7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHByaXYtPmRldjsK
LQl1MzIgc2l6ZTsKLQlpbnQgcmV0ID0gMDsKLQotCXNpemUgPSBtb2RlX2NtZC0+cGl0Y2hlc1sw
XSAqIG1vZGVfY21kLT5oZWlnaHQ7Ci0JcmV0ID0gaGlibWNfZ2VtX2NyZWF0ZShkZXYsIHNpemUs
IHRydWUsICZnb2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JKmdvYmpfcCA9IGdv
Ymo7Ci0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIHN0cnVjdCBmYl9vcHMgaGlibWNfZHJtX2Zi
X29wcyA9IHsKLQkub3duZXIgPSBUSElTX01PRFVMRSwKLQkuZmJfY2hlY2tfdmFyID0gZHJtX2Zi
X2hlbHBlcl9jaGVja192YXIsCi0JLmZiX3NldF9wYXIgPSBkcm1fZmJfaGVscGVyX3NldF9wYXIs
Ci0JLmZiX2ZpbGxyZWN0ID0gZHJtX2ZiX2hlbHBlcl9zeXNfZmlsbHJlY3QsCi0JLmZiX2NvcHlh
cmVhID0gZHJtX2ZiX2hlbHBlcl9zeXNfY29weWFyZWEsCi0JLmZiX2ltYWdlYmxpdCA9IGRybV9m
Yl9oZWxwZXJfc3lzX2ltYWdlYmxpdCwKLQkuZmJfcGFuX2Rpc3BsYXkgPSBkcm1fZmJfaGVscGVy
X3Bhbl9kaXNwbGF5LAotCS5mYl9ibGFuayA9IGRybV9mYl9oZWxwZXJfYmxhbmssCi0JLmZiX3Nl
dGNtYXAgPSBkcm1fZmJfaGVscGVyX3NldGNtYXAsCi19OwotCi1zdGF0aWMgaW50IGhpYm1jX2Ry
bV9mYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKLQkJCSAgICAgICBzdHJ1
Y3QgZHJtX2ZiX2hlbHBlcl9zdXJmYWNlX3NpemUgKnNpemVzKQotewotCXN0cnVjdCBoaWJtY19m
YmRldiAqaGlfZmJkZXYgPQotCQljb250YWluZXJfb2YoaGVscGVyLCBzdHJ1Y3QgaGlibWNfZmJk
ZXYsIGhlbHBlcik7Ci0Jc3RydWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2ID0gaGVscGVyLT5k
ZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBmYl9pbmZvICppbmZvOwotCXN0cnVjdCBkcm1fbW9k
ZV9mYl9jbWQyIG1vZGVfY21kOwotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ29iaiA9IE5VTEw7
Ci0JaW50IHJldCA9IDA7Ci0Jc2l6ZV90IHNpemU7Ci0JdW5zaWduZWQgaW50IGJ5dGVzX3Blcl9w
aXhlbDsKLQlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvID0gTlVMTDsKLQl2b2lkICpi
YXNlOwotCi0JRFJNX0RFQlVHX0RSSVZFUigic3VyZmFjZSB3aWR0aCglZCksIGhlaWdodCglZCkg
YW5kIGJwcCglZClcbiIsCi0JCQkgc2l6ZXMtPnN1cmZhY2Vfd2lkdGgsIHNpemVzLT5zdXJmYWNl
X2hlaWdodCwKLQkJCSBzaXplcy0+c3VyZmFjZV9icHApOwotCi0JYnl0ZXNfcGVyX3BpeGVsID0g
RElWX1JPVU5EX1VQKHNpemVzLT5zdXJmYWNlX2JwcCwgOCk7Ci0KLQltb2RlX2NtZC53aWR0aCA9
IHNpemVzLT5zdXJmYWNlX3dpZHRoOwotCW1vZGVfY21kLmhlaWdodCA9IHNpemVzLT5zdXJmYWNl
X2hlaWdodDsKLQltb2RlX2NtZC5waXRjaGVzWzBdID0gbW9kZV9jbWQud2lkdGggKiBieXRlc19w
ZXJfcGl4ZWw7Ci0JbW9kZV9jbWQucGl4ZWxfZm9ybWF0ID0gZHJtX21vZGVfbGVnYWN5X2ZiX2Zv
cm1hdChzaXplcy0+c3VyZmFjZV9icHAsCi0JCQkJCQkJICBzaXplcy0+c3VyZmFjZV9kZXB0aCk7
Ci0KLQlzaXplID0gUEFHRV9BTElHTihtb2RlX2NtZC5waXRjaGVzWzBdICogbW9kZV9jbWQuaGVp
Z2h0KTsKLQotCXJldCA9IGhpYm1jZmJfY3JlYXRlX29iamVjdChwcml2LCAmbW9kZV9jbWQsICZn
b2JqKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGNyZWF0ZSBmYmNvbiBi
YWNraW5nIG9iamVjdDogJWRcbiIsIHJldCk7Ci0JCXJldHVybiAtRU5PTUVNOwotCX0KLQotCWdi
byA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZ29iaik7Ci0KLQlyZXQgPSBkcm1fZ2VtX3ZyYW1fcGlu
KGdibywgRFJNX0dFTV9WUkFNX1BMX0ZMQUdfVlJBTSk7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJS
T1IoImZhaWxlZCB0byBwaW4gZmJjb246ICVkXG4iLCByZXQpOwotCQlnb3RvIG91dF91bnJlZl9n
ZW07Ci0JfQotCi0JYmFzZSA9IGRybV9nZW1fdnJhbV9rbWFwKGdibywgdHJ1ZSwgTlVMTCk7Ci0J
aWYgKElTX0VSUihiYXNlKSkgewotCQlyZXQgPSBQVFJfRVJSKGJhc2UpOwotCQlEUk1fRVJST1Io
ImZhaWxlZCB0byBrbWFwIGZiY29uOiAlZFxuIiwgcmV0KTsKLQkJZ290byBvdXRfdW5waW5fYm87
Ci0JfQotCi0JaW5mbyA9IGRybV9mYl9oZWxwZXJfYWxsb2NfZmJpKGhlbHBlcik7Ci0JaWYgKElT
X0VSUihpbmZvKSkgewotCQlyZXQgPSBQVFJfRVJSKGluZm8pOwotCQlEUk1fRVJST1IoImZhaWxl
ZCB0byBhbGxvY2F0ZSBmYmk6ICVkXG4iLCByZXQpOwotCQlnb3RvIG91dF9yZWxlYXNlX2ZiaTsK
LQl9Ci0KLQloaV9mYmRldi0+ZmIgPSBoaWJtY19mcmFtZWJ1ZmZlcl9pbml0KHByaXYtPmRldiwg
Jm1vZGVfY21kLCBnb2JqKTsKLQlpZiAoSVNfRVJSKGhpX2ZiZGV2LT5mYikpIHsKLQkJcmV0ID0g
UFRSX0VSUihoaV9mYmRldi0+ZmIpOwotCQloaV9mYmRldi0+ZmIgPSBOVUxMOwotCQlEUk1fRVJS
T1IoImZhaWxlZCB0byBpbml0aWFsaXplIGZyYW1lYnVmZmVyOiAlZFxuIiwgcmV0KTsKLQkJZ290
byBvdXRfcmVsZWFzZV9mYmk7Ci0JfQotCi0JcHJpdi0+ZmJkZXYtPnNpemUgPSBzaXplOwotCWhp
X2ZiZGV2LT5oZWxwZXIuZmIgPSAmaGlfZmJkZXYtPmZiLT5mYjsKLQotCWluZm8tPmZib3BzID0g
JmhpYm1jX2RybV9mYl9vcHM7Ci0KLQlkcm1fZmJfaGVscGVyX2ZpbGxfaW5mbyhpbmZvLCAmcHJp
di0+ZmJkZXYtPmhlbHBlciwgc2l6ZXMpOwotCi0JaW5mby0+c2NyZWVuX2Jhc2UgPSBiYXNlOwot
CWluZm8tPnNjcmVlbl9zaXplID0gc2l6ZTsKLQotCWluZm8tPmZpeC5zbWVtX3N0YXJ0ID0gZ2Jv
LT5iby5tZW0uYnVzLm9mZnNldCArIGdiby0+Ym8ubWVtLmJ1cy5iYXNlOwotCWluZm8tPmZpeC5z
bWVtX2xlbiA9IHNpemU7Ci0JcmV0dXJuIDA7Ci0KLW91dF9yZWxlYXNlX2ZiaToKLQlkcm1fZ2Vt
X3ZyYW1fa3VubWFwKGdibyk7Ci1vdXRfdW5waW5fYm86Ci0JZHJtX2dlbV92cmFtX3VucGluKGdi
byk7Ci1vdXRfdW5yZWZfZ2VtOgotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChnb2JqKTsK
LQotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyB2b2lkIGhpYm1jX2ZiZGV2X2Rlc3Ryb3koc3Ry
dWN0IGhpYm1jX2ZiZGV2ICpmYmRldikKLXsKLQlzdHJ1Y3QgaGlibWNfZnJhbWVidWZmZXIgKmdm
YiA9IGZiZGV2LT5mYjsKLQlzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJoID0gJmZiZGV2LT5oZWxw
ZXI7Ci0KLQlkcm1fZmJfaGVscGVyX3VucmVnaXN0ZXJfZmJpKGZiaCk7Ci0KLQlkcm1fZmJfaGVs
cGVyX2ZpbmkoZmJoKTsKLQotCWlmIChnZmIpCi0JCWRybV9mcmFtZWJ1ZmZlcl9wdXQoJmdmYi0+
ZmIpOwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mYl9oZWxwZXJfZnVuY3MgaGlibWNf
ZmJkZXZfaGVscGVyX2Z1bmNzID0gewotCS5mYl9wcm9iZSA9IGhpYm1jX2RybV9mYl9jcmVhdGUs
Ci19OwotCi1pbnQgaGlibWNfZmJkZXZfaW5pdChzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnBy
aXYpCi17Ci0JaW50IHJldDsKLQlzdHJ1Y3QgZmJfdmFyX3NjcmVlbmluZm8gKnZhcjsKLQlzdHJ1
Y3QgZmJfZml4X3NjcmVlbmluZm8gKmZpeDsKLQlzdHJ1Y3QgaGlibWNfZmJkZXYgKmhpZmJkZXY7
Ci0KLQloaWZiZGV2ID0gZGV2bV9remFsbG9jKHByaXYtPmRldi0+ZGV2LCBzaXplb2YoKmhpZmJk
ZXYpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWhpZmJkZXYpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQg
dG8gYWxsb2NhdGUgaGlibWNfZmJkZXZcbiIpOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9Ci0KLQlw
cml2LT5mYmRldiA9IGhpZmJkZXY7Ci0JZHJtX2ZiX2hlbHBlcl9wcmVwYXJlKHByaXYtPmRldiwg
JmhpZmJkZXYtPmhlbHBlciwKLQkJCSAgICAgICZoaWJtY19mYmRldl9oZWxwZXJfZnVuY3MpOwot
Ci0JLyogTm93IGp1c3Qgb25lIGNydGMgYW5kIG9uZSBjaGFubmVsICovCi0JcmV0ID0gZHJtX2Zi
X2hlbHBlcl9pbml0KHByaXYtPmRldiwgJmhpZmJkZXYtPmhlbHBlciwgMSk7Ci0JaWYgKHJldCkg
ewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIGZiIGhlbHBlcjogJWRcbiIsIHJl
dCk7Ci0JCXJldHVybiByZXQ7Ci0JfQotCi0JcmV0ID0gZHJtX2ZiX2hlbHBlcl9zaW5nbGVfYWRk
X2FsbF9jb25uZWN0b3JzKCZoaWZiZGV2LT5oZWxwZXIpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VS
Uk9SKCJmYWlsZWQgdG8gYWRkIGFsbCBjb25uZWN0b3JzOiAlZFxuIiwgcmV0KTsKLQkJZ290byBm
aW5pOwotCX0KLQotCXJldCA9IGRybV9mYl9oZWxwZXJfaW5pdGlhbF9jb25maWcoJmhpZmJkZXYt
PmhlbHBlciwgMTYpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gc2V0dXAg
aW5pdGlhbCBjb25uIGNvbmZpZzogJWRcbiIsIHJldCk7Ci0JCWdvdG8gZmluaTsKLQl9Ci0KLQl2
YXIgPSAmaGlmYmRldi0+aGVscGVyLmZiZGV2LT52YXI7Ci0JZml4ID0gJmhpZmJkZXYtPmhlbHBl
ci5mYmRldi0+Zml4OwotCi0JRFJNX0RFQlVHX0RSSVZFUigiTWVtYmVyIG9mIGluZm8tPnZhciBp
cyA6XG4iCi0JCQkgInhyZXM9JWRcbiIKLQkJCSAieXJlcz0lZFxuIgotCQkJICJ4cmVzX3ZpcnR1
YWw9JWRcbiIKLQkJCSAieXJlc192aXJ0dWFsPSVkXG4iCi0JCQkgInhvZmZzZXQ9JWRcbiIKLQkJ
CSAieW9mZnNldD0lZFxuIgotCQkJICJiaXRzX3Blcl9waXhlbD0lZFxuIgotCQkJICIuLi5cbiIs
IHZhci0+eHJlcywgdmFyLT55cmVzLCB2YXItPnhyZXNfdmlydHVhbCwKLQkJCSB2YXItPnlyZXNf
dmlydHVhbCwgdmFyLT54b2Zmc2V0LCB2YXItPnlvZmZzZXQsCi0JCQkgdmFyLT5iaXRzX3Blcl9w
aXhlbCk7Ci0JRFJNX0RFQlVHX0RSSVZFUigiTWVtYmVyIG9mIGluZm8tPmZpeCBpcyA6XG4iCi0J
CQkgInNtZW1fc3RhcnQ9JWx4XG4iCi0JCQkgInNtZW1fbGVuPSVkXG4iCi0JCQkgInR5cGU9JWRc
biIKLQkJCSAidHlwZV9hdXg9JWRcbiIKLQkJCSAidmlzdWFsPSVkXG4iCi0JCQkgInhwYW5zdGVw
PSVkXG4iCi0JCQkgInlwYW5zdGVwPSVkXG4iCi0JCQkgInl3cmFwc3RlcD0lZFxuIgotCQkJICJs
aW5lX2xlbmd0aD0lZFxuIgotCQkJICJhY2NlbD0lZFxuIgotCQkJICJjYXBhYmlsaXRpZXM9JWRc
biIKLQkJCSAiLi4uXG4iLCBmaXgtPnNtZW1fc3RhcnQsIGZpeC0+c21lbV9sZW4sIGZpeC0+dHlw
ZSwKLQkJCSBmaXgtPnR5cGVfYXV4LCBmaXgtPnZpc3VhbCwgZml4LT54cGFuc3RlcCwKLQkJCSBm
aXgtPnlwYW5zdGVwLCBmaXgtPnl3cmFwc3RlcCwgZml4LT5saW5lX2xlbmd0aCwKLQkJCSBmaXgt
PmFjY2VsLCBmaXgtPmNhcGFiaWxpdGllcyk7Ci0KLQlyZXR1cm4gMDsKLQotZmluaToKLQlkcm1f
ZmJfaGVscGVyX2ZpbmkoJmhpZmJkZXYtPmhlbHBlcik7Ci0JcmV0dXJuIHJldDsKLX0KLQotdm9p
ZCBoaWJtY19mYmRldl9maW5pKHN0cnVjdCBoaWJtY19kcm1fcHJpdmF0ZSAqcHJpdikKLXsKLQlp
ZiAoIXByaXYtPmZiZGV2KQotCQlyZXR1cm47Ci0KLQloaWJtY19mYmRldl9kZXN0cm95KHByaXYt
PmZiZGV2KTsKLQlwcml2LT5mYmRldiA9IE5VTEw7Ci19Ci0tIAoyLjIzLjAKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
