Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 563A81BD48
	for <lists+dri-devel@lfdr.de>; Mon, 13 May 2019 20:37:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5429A89202;
	Mon, 13 May 2019 18:37:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x541.google.com (mail-pg1-x541.google.com
 [IPv6:2607:f8b0:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B6336891D5
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 18:37:37 +0000 (UTC)
Received: by mail-pg1-x541.google.com with SMTP id w22so7201314pgi.6
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 11:37:37 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=pksOvnyHpZN4MdrMWr5EO61V7mUvaoL7ZYP9ufezzeQ=;
 b=CGizLcO0viNwcM+wX474GzR8kDaG1fGBxaxtj3joF1Gt14nV6XUYkOACHeS9BNXXGS
 7rPukCF9VbXKzk/gY0jQShgiugC/LSHg275wJAIcqVGDcPwyl51IMQJKk0h/ygKSk4n1
 kZtq8UZQIrUbpqA62YIpWVW/qHo6jxBBc0nkFayqsLzjradactwzG0Fudi0w9o/nGARu
 t+0mpIND598/5K8AmCrLaQlzcn9Dh80gMyXlVjXeyze77AkkbrVRn1s/zCSGJKS4vSWD
 Fht1Jif3grJr0pOTlRzD9z87ygenR3vPS2YSaVe72oTlRuD3odaNVc1hbn4g/fXDgknk
 LUtQ==
X-Gm-Message-State: APjAAAXA0TvArdUNBTc0wXoWvYvMFU1sB+ad5mqRhSKFihsAyo95TQHB
 PoKa4PeGTCZlYP7tFxznRy5k0w==
X-Google-Smtp-Source: APXvYqxO+PQl4VMbDmDSLqWr2bN+xGoO+r1774xAKAHLpGcL+wPoVuj0udn5c8luvn3KwMtNtDMjkA==
X-Received: by 2002:a63:1650:: with SMTP id 16mr33397157pgw.164.1557772657122; 
 Mon, 13 May 2019 11:37:37 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:4e72:b9ff:fe99:466a])
 by smtp.gmail.com with ESMTPSA id
 u11sm17334881pfh.130.2019.05.13.11.37.35
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 13 May 2019 11:37:36 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH 3/5 v4] dma-buf: heaps: Add system heap to dmabuf heaps
Date: Mon, 13 May 2019 11:37:25 -0700
Message-Id: <20190513183727.15755-4-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190513183727.15755-1-john.stultz@linaro.org>
References: <20190513183727.15755-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=pksOvnyHpZN4MdrMWr5EO61V7mUvaoL7ZYP9ufezzeQ=;
 b=CMVPwHtJ6snzx4UzujJmTFtWfRTVyZtIFTIpOCAQkdON+8elJ6pq5QtNNZkqUpgrce
 daZsvXrkwTo/wkKpFngOEUs0EI+RA1rFNV6RpmA77m0VrfabRxEv+hhRhGMrIIwWffb1
 k/usWGAzeJap3XwUL83aWRvhnOJcCpMCl7TDFH1FAnokwx0msaB5TmECI+hw1kTYTwcg
 sEq7Yap1XSYRLf+DVo2ODXCtovP1m34e5xRk26glMXKhLofw9kv2i0iFqooZelfbdv8d
 rVZaCiZvpYjMSPWuaEipIq1FTyp8VwxmooKE4KyM42i5qkxBQlGrvXLhqp5/q+UYfggI
 AKPw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Yudongbin <yudongbin@hisilicon.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Xu YiPing <xuyiping@hisilicon.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>,
 "Chenfeng \(puck\)" <puck.chen@hisilicon.com>, dri-devel@lists.freedesktop.org,
 Chenbo Feng <fengc@google.com>, Alistair Strachan <astrachan@google.com>,
 Liam Mark <lmark@codeaurora.org>, Christoph Hellwig <hch@infradead.org>,
 "Xiaqing \(A\)" <saberlily.xia@hisilicon.com>, "Andrew F . Davis" <afd@ti.com>,
 Pratik Patel <pratikp@codeaurora.org>, butao <butao@hisilicon.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBhZGRzIHN5c3RlbSBoZWFwIHRvIHRoZSBkbWEtYnVmIGhlYXBzIGZyYW1ld29y
ay4KClRoaXMgYWxsb3dzIGFwcGxpY2F0aW9ucyB0byBnZXQgYSBwYWdlLWFsbG9jYXRvciBiYWNr
ZWQgZG1hLWJ1Zgpmb3Igbm9uLWNvbnRpZ3VvdXMgbWVtb3J5LgoKVGhpcyBjb2RlIGlzIGFuIGV2
b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVtZW50YXRpb24sIHNvCnRoYW5rcyB0byBp
dHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBa
YXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwgYW5kIG90aGVycyEKCkNjOiBMYXVyYSBB
YmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJlbmphbWluIEdhaWduYXJkIDxiZW5qYW1p
bi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQgU2Vtd2FsIDxzdW1pdC5zZW13YWxAbGlu
YXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29kZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsg
UGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNjOiBCcmlhbiBTdGFya2V5IDxCcmlhbi5T
dGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5lZm9ydCA8VmluY2VudC5Eb25uZWZvcnRA
YXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0by5QYXVsQGFybS5jb20+CkNjOiBBbmRy
ZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBYdSBZaVBpbmcgPHh1eWlwaW5nQGhpc2lsaWNv
bi5jb20+CkNjOiAiQ2hlbmZlbmcgKHB1Y2spIiA8cHVjay5jaGVuQGhpc2lsaWNvbi5jb20+CkNj
OiBidXRhbyA8YnV0YW9AaGlzaWxpY29uLmNvbT4KQ2M6ICJYaWFxaW5nIChBKSIgPHNhYmVybGls
eS54aWFAaGlzaWxpY29uLmNvbT4KQ2M6IFl1ZG9uZ2JpbiA8eXVkb25nYmluQGhpc2lsaWNvbi5j
b20+CkNjOiBDaHJpc3RvcGggSGVsbHdpZyA8aGNoQGluZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8g
RmVuZyA8ZmVuZ2NAZ29vZ2xlLmNvbT4KQ2M6IEFsaXN0YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5A
Z29vZ2xlLmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKUmV2aWV3ZWQt
Ynk6IEJlbmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpTaWdu
ZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9yZz4KLS0tCnYyOgoq
IFN3aXRjaCBhbGxvY2F0ZSB0byByZXR1cm4gZG1hYnVmIGZkCiogU2ltcGxpZnkgaW5pdCBjb2Rl
CiogQ2hlY2twYXRjaCBmaXh1cHMKKiBEcm9wZWQgZGVhZCBzeXN0ZW0tY29udGlnIGNvZGUKdjM6
CiogV2hpdGVzcGFjZSBmaXh1cHMgZnJvbSBCZW5qYW1pbgoqIE1ha2Ugc3VyZSB3ZSdyZSB6ZXJv
aW5nIHRoZSBhbGxvY2F0ZWQgcGFnZXMgKGZyb20gTGlhbSkKKiBVc2UgUEFHRV9BTElHTigpIGNv
bnNpc3RlbnRseSAoc3VnZ2VzdGVkIGJ5IEJyaWFuKQoqIEZvbGQgaW4gbmV3IHJlZ2lzdHJhdGlv
biBzdHlsZSBmcm9tIEFuZHJldwoqIEF2b2lkIG5lZWRsZXNzIGR5bmFtaWMgYWxsb2NhdGlvbiBv
ZiBzeXNfaGVhcCAoc3VnZ2VzdGVkIGJ5CiAgQ2hyaXN0b3BoKQoqIE1pbm9yIGNsZWFudXBzCiog
Rm9sZGVkIGluIGNoYW5nZXMgZnJvbSBBbmRyZXcgdG8gdXNlIHNpbXBsaWZpZWQgcGFnZSBsaXN0
CiAgZnJvbSB0aGUgaGVhcCBoZWxwZXJzCnY0OgoqIE9wdGltaXphdGlvbiB0byBhbGxvY2F0ZSBw
YWdlcyBpbiBjaHVua3MsIHNpbWlsYXIgdG8gb2xkCiAgcGFnZXBvb2wgY29kZQoqIFVzZSBmZF9m
bGFncyB3aGVuIGNyZWF0aW5nIGRtYWJ1ZiBmZCAoU3VnZ2VzdGVkIGJ5IEJlbmphbWluKQotLS0K
IGRyaXZlcnMvZG1hLWJ1Zi9LY29uZmlnICAgICAgICAgICAgIHwgICAyICsKIGRyaXZlcnMvZG1h
LWJ1Zi9oZWFwcy9LY29uZmlnICAgICAgIHwgICA2ICsrCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMv
TWFrZWZpbGUgICAgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hlYXAu
YyB8IDE2MiArKysrKysrKysrKysrKysrKysrKysrKysrKysrCiA0IGZpbGVzIGNoYW5nZWQsIDE3
MSBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9kbWEtYnVmL2hlYXBz
L0tjb25maWcKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVt
X2hlYXAuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9LY29uZmlnIGIvZHJpdmVycy9k
bWEtYnVmL0tjb25maWcKaW5kZXggODM0NGNkYWFhMzI4Li5lMzRiNmU2MWI3MDIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZG1hLWJ1Zi9LY29uZmlnCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9LY29uZmln
CkBAIC00Niw0ICs0Niw2IEBAIG1lbnVjb25maWcgRE1BQlVGX0hFQVBTCiAJICB0aGlzIGFsbG93
cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUgZG1hLWJ1ZnMgdGhhdCBjYW4gYmUgc2hhcmVkIGJldHdl
ZW4KIAkgIGRyaXZlcnMuCiAKK3NvdXJjZSAiZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWci
CisKIGVuZG1lbnUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnIGIv
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi4yMDUwNTI3NDQxNjkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2Rt
YS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtMCwwICsxLDYgQEAKK2NvbmZpZyBETUFCVUZfSEVBUFNf
U1lTVEVNCisJYm9vbCAiRE1BLUJVRiBTeXN0ZW0gSGVhcCIKKwlkZXBlbmRzIG9uIERNQUJVRl9I
RUFQUworCWhlbHAKKwkgIENob29zZSB0aGlzIG9wdGlvbiB0byBlbmFibGUgdGhlIHN5c3RlbSBk
bWFidWYgaGVhcC4gVGhlIHN5c3RlbSBoZWFwCisJICBpcyBiYWNrZWQgYnkgcGFnZXMgZnJvbSB0
aGUgYnVkZHkgYWxsb2NhdG9yLiBJZiBpbiBkb3VidCwgc2F5IFkuCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZp
bGUKaW5kZXggZGU0OTg5ODExMmRiLi5kMTgwOGVjYTI1ODEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
ZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZp
bGUKQEAgLTEsMiArMSwzIEBACiAjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCiBv
YmoteQkJCQkJKz0gaGVhcC1oZWxwZXJzLm8KK29iai0kKENPTkZJR19ETUFCVUZfSEVBUFNfU1lT
VEVNKQkrPSBzeXN0ZW1faGVhcC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMv
c3lzdGVtX2hlYXAuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNjBlZTUzMWUxYTI0Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKQEAgLTAsMCAr
MSwxNjIgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogRE1B
QlVGIFN5c3RlbSBoZWFwIGV4cG9ydGVyCisgKgorICogQ29weXJpZ2h0IChDKSAyMDExIEdvb2ds
ZSwgSW5jLgorICogQ29weXJpZ2h0IChDKSAyMDE5IExpbmFybyBMdGQuCisgKi8KKworI2luY2x1
ZGUgPGFzbS9wYWdlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGxp
bnV4L2RtYS1tYXBwaW5nLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWhlYXAuaD4KKyNpbmNsdWRl
IDxsaW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9oaWdobWVtLmg+CisjaW5jbHVkZSA8bGlu
dXgvbW0uaD4KKyNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4
L3NsYWIuaD4KKworI2luY2x1ZGUgImhlYXAtaGVscGVycy5oIgorCitzdHJ1Y3Qgc3lzdGVtX2hl
YXAgeworCXN0cnVjdCBkbWFfaGVhcCAqaGVhcDsKK30gc3lzX2hlYXA7CisKKworI2RlZmluZSBO
VU1fT1JERVJTIEFSUkFZX1NJWkUob3JkZXJzKQorI2RlZmluZSBISUdIX09SREVSX0dGUCAgKCgo
R0ZQX0hJR0hVU0VSIHwgX19HRlBfWkVSTyB8IF9fR0ZQX05PV0FSTiBcCisJCQkJfCBfX0dGUF9O
T1JFVFJZKSAmIH5fX0dGUF9SRUNMQUlNKSBcCisJCQkJfCBfX0dGUF9DT01QKQorI2RlZmluZSBM
T1dfT1JERVJfR0ZQIChHRlBfSElHSFVTRVIgfCBfX0dGUF9aRVJPIHwgX19HRlBfQ09NUCkKK3N0
YXRpYyBnZnBfdCBvcmRlcl9mbGFnc1tdID0ge0hJR0hfT1JERVJfR0ZQLCBMT1dfT1JERVJfR0ZQ
LCBMT1dfT1JERVJfR0ZQfTsKK3N0YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQgb3JkZXJzW10gPSB7
OCwgNCwgMH07CisKKworc3RhdGljIHZvaWQgc3lzdGVtX2hlYXBfZnJlZShzdHJ1Y3QgaGVhcF9o
ZWxwZXJfYnVmZmVyICpidWZmZXIpCit7CisJcGdvZmZfdCBwZzsKKworCWZvciAocGcgPSAwOyBw
ZyA8IGJ1ZmZlci0+cGFnZWNvdW50OyBwZysrKQorCQlfX2ZyZWVfcGFnZShidWZmZXItPnBhZ2Vz
W3BnXSk7CisJa2ZyZWUoYnVmZmVyLT5wYWdlcyk7CisJa2ZyZWUoYnVmZmVyKTsKK30KKworc3Rh
dGljIHN0cnVjdCBwYWdlICphbGxvY19sYXJnZXN0X2F2YWlsYWJsZSh1bnNpZ25lZCBsb25nIHNp
emUsCisJCQkJCSAgICB1bnNpZ25lZCBpbnQgbWF4X29yZGVyKQoreworCXN0cnVjdCBwYWdlICpw
YWdlOworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IE5VTV9PUkRFUlM7IGkrKykgeworCQlp
ZiAoc2l6ZSA8ICAoUEFHRV9TSVpFIDw8IG9yZGVyc1tpXSkpCisJCQljb250aW51ZTsKKwkJaWYg
KG1heF9vcmRlciA8IG9yZGVyc1tpXSkKKwkJCWNvbnRpbnVlOworCisJCXBhZ2UgPSBhbGxvY19w
YWdlcyhvcmRlcl9mbGFnc1tpXSwgb3JkZXJzW2ldKTsKKwkJaWYgKCFwYWdlKQorCQkJY29udGlu
dWU7CisJCXJldHVybiBwYWdlOworCX0KKwlyZXR1cm4gTlVMTDsKK30KKworCitzdGF0aWMgaW50
IHN5c3RlbV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKKwkJCQl1bnNpZ25l
ZCBsb25nIGxlbiwKKwkJCQl1bnNpZ25lZCBsb25nIGZkX2ZsYWdzLAorCQkJCXVuc2lnbmVkIGxv
bmcgaGVhcF9mbGFncykKK3sKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpoZWxwZXJfYnVm
ZmVyOworCURFRklORV9ETUFfQlVGX0VYUE9SVF9JTkZPKGV4cF9pbmZvKTsKKwl1bnNpZ25lZCBs
b25nIHNpemVfcmVtYWluaW5nID0gbGVuOworCXVuc2lnbmVkIGludCBtYXhfb3JkZXIgPSBvcmRl
cnNbMF07CisJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKKwlpbnQgcmV0ID0gLUVOT01FTTsKKwlw
Z29mZl90IHBnOworCisJaGVscGVyX2J1ZmZlciA9IGt6YWxsb2Moc2l6ZW9mKCpoZWxwZXJfYnVm
ZmVyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFoZWxwZXJfYnVmZmVyKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCUlOSVRfSEVBUF9IRUxQRVJfQlVGRkVSKGhlbHBlcl9idWZmZXIsIHN5c3RlbV9oZWFw
X2ZyZWUpOworCWhlbHBlcl9idWZmZXItPmhlYXBfYnVmZmVyLmZsYWdzID0gaGVhcF9mbGFnczsK
KwloZWxwZXJfYnVmZmVyLT5oZWFwX2J1ZmZlci5oZWFwID0gaGVhcDsKKwloZWxwZXJfYnVmZmVy
LT5oZWFwX2J1ZmZlci5zaXplID0gbGVuOworCisJaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50ID0g
bGVuIC8gUEFHRV9TSVpFOworCWhlbHBlcl9idWZmZXItPnBhZ2VzID0ga21hbGxvY19hcnJheSho
ZWxwZXJfYnVmZmVyLT5wYWdlY291bnQsCisJCQkJCSAgICAgc2l6ZW9mKCpoZWxwZXJfYnVmZmVy
LT5wYWdlcyksCisJCQkJCSAgICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFoZWxwZXJfYnVmZmVyLT5w
YWdlcykgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGVycjA7CisJfQorCisJcGcgPSAwOwor
CXdoaWxlIChzaXplX3JlbWFpbmluZyA+IDApIHsKKwkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBhbGxv
Y19sYXJnZXN0X2F2YWlsYWJsZShzaXplX3JlbWFpbmluZywKKwkJCQkJCQkgICAgbWF4X29yZGVy
KTsKKwkJaW50IGk7CisKKwkJaWYgKCFwYWdlKQorCQkJZ290byBlcnIxOworCQlzaXplX3JlbWFp
bmluZyAtPSBQQUdFX1NJWkUgPDwgY29tcG91bmRfb3JkZXIocGFnZSk7CisJCW1heF9vcmRlciA9
IGNvbXBvdW5kX29yZGVyKHBhZ2UpOworCQlmb3IgKGkgPSAwOyBpIDwgMSA8PCBtYXhfb3JkZXI7
IGkrKykKKwkJCWhlbHBlcl9idWZmZXItPnBhZ2VzW3BnKytdID0gcGFnZSsrOworCX0KKworCS8q
IGNyZWF0ZSB0aGUgZG1hYnVmICovCisJZXhwX2luZm8ub3BzID0gJmhlYXBfaGVscGVyX29wczsK
KwlleHBfaW5mby5zaXplID0gbGVuOworCWV4cF9pbmZvLmZsYWdzID0gZmRfZmxhZ3M7CisJZXhw
X2luZm8ucHJpdiA9ICZoZWxwZXJfYnVmZmVyLT5oZWFwX2J1ZmZlcjsKKwlkbWFidWYgPSBkbWFf
YnVmX2V4cG9ydCgmZXhwX2luZm8pOworCWlmIChJU19FUlIoZG1hYnVmKSkgeworCQlyZXQgPSBQ
VFJfRVJSKGRtYWJ1Zik7CisJCWdvdG8gZXJyMTsKKwl9CisKKwloZWxwZXJfYnVmZmVyLT5oZWFw
X2J1ZmZlci5kbWFidWYgPSBkbWFidWY7CisKKwlyZXQgPSBkbWFfYnVmX2ZkKGRtYWJ1ZiwgZmRf
ZmxhZ3MpOworCWlmIChyZXQgPCAwKSB7CisJCWRtYV9idWZfcHV0KGRtYWJ1Zik7CisJCS8qIGp1
c3QgcmV0dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJlbGVhc2UgYW5kIHRoYXQgd2lsbCBmcmVlICov
CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIHJldDsKKworZXJyMToKKwl3aGlsZSAocGcg
PiAwKQorCQlfX2ZyZWVfcGFnZShoZWxwZXJfYnVmZmVyLT5wYWdlc1stLXBnXSk7CisJa2ZyZWUo
aGVscGVyX2J1ZmZlci0+cGFnZXMpOworZXJyMDoKKwlrZnJlZShoZWxwZXJfYnVmZmVyKTsKKwor
CXJldHVybiAtRU5PTUVNOworfQorCitzdGF0aWMgc3RydWN0IGRtYV9oZWFwX29wcyBzeXN0ZW1f
aGVhcF9vcHMgPSB7CisJLmFsbG9jYXRlID0gc3lzdGVtX2hlYXBfYWxsb2NhdGUsCit9OworCitz
dGF0aWMgaW50IHN5c3RlbV9oZWFwX2NyZWF0ZSh2b2lkKQoreworCXN0cnVjdCBkbWFfaGVhcF9l
eHBvcnRfaW5mbyBleHBfaW5mbzsKKwlpbnQgcmV0ID0gMDsKKworCWV4cF9pbmZvLm5hbWUgPSAi
c3lzdGVtX2hlYXAiOworCWV4cF9pbmZvLm9wcyA9ICZzeXN0ZW1faGVhcF9vcHM7CisJZXhwX2lu
Zm8ucHJpdiA9ICZzeXNfaGVhcDsKKworCXN5c19oZWFwLmhlYXAgPSBkbWFfaGVhcF9hZGQoJmV4
cF9pbmZvKTsKKwlpZiAoSVNfRVJSKHN5c19oZWFwLmhlYXApKQorCQlyZXQgPSBQVFJfRVJSKHN5
c19oZWFwLmhlYXApOworCisJcmV0dXJuIHJldDsKK30KK2RldmljZV9pbml0Y2FsbChzeXN0ZW1f
aGVhcF9jcmVhdGUpOwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
