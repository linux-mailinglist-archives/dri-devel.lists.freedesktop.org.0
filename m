Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A84EA10D3FD
	for <lists+dri-devel@lfdr.de>; Fri, 29 Nov 2019 11:30:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 709A36E8AC;
	Fri, 29 Nov 2019 10:30:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 664C06E8AC;
 Fri, 29 Nov 2019 10:30:05 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Nov 2019 02:30:04 -0800
X-IronPort-AV: E=Sophos;i="5.69,257,1571727600"; d="scan'208";a="199773608"
Received: from jnikula-mobl3.fi.intel.com (HELO localhost) ([10.237.66.161])
 by orsmga007-auth.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Nov 2019 02:30:01 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: dri-devel@lists.freedesktop.org,
	linux-fbdev@vger.kernel.org
Subject: [PATCH v2 01/14] video: fb_defio: preserve user fb_ops
Date: Fri, 29 Nov 2019 12:29:31 +0200
Message-Id: <022c82429da15d6450ff9ac1a897322ec3124db4.1575022735.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1575022735.git.jani.nikula@intel.com>
References: <cover.1575022735.git.jani.nikula@intel.com>
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, intel-gfx@lists.freedesktop.org,
 Jaya Kumar <jayalk@intworks.biz>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TW9kaWZ5aW5nIGZiX29wcyBkaXJlY3RseSB0byBvdmVycmlkZSBmYl9tbWFwIHdpdGggZmJfZGVm
ZXJyZWRfaW9fbW1hcAphbmQgdGhlbiByZXNldHRpbmcgaXQgdG8gTlVMTCBhZnRlcndhcmRzIGNh
dXNlcyBwcm9ibGVtcyBhbGwgb3ZlciB0aGUKcGxhY2UuIEZpcnN0LCBpdCBwcmV2ZW50cyBtYWtp
bmcgdGhlIGZib3BzIG1lbWJlciBvZiBzdHJ1Y3QgZmJfaW5mbyBhCmNvbnN0IHBvaW50ZXIsIHdo
aWNoIG1lYW5zIHdlIGNhbid0IG1ha2Ugc3RydWN0IGZiX29wcyBjb25zdAphbnl3aGVyZS4gU2Vj
b25kLCBhIGZldyBwbGFjZXMgaGF2ZSB0byBnbyBvdXQgb2YgdGhlaXIgd2F5IHRvIHJlc3RvcmUK
dGhlIG9yaWdpbmFsIGZiX21tYXAgcG9pbnRlciB0aGF0IGdldHMgcmVzZXQgdG8gTlVMTC4KClNp
bmNlIHRoZSBvbmx5IHVzZXIgb2YgdGhlIGZib3BzLT5mYl9tbWFwIGhvb2sgaXMgZmJfbW1hcCgp
IGluIGZibWVtLmMsCmNhbGwgZmJfZGVmZXJyZWRfaW9fbW1hcCgpIGRpcmVjdGx5IHdoZW4gZGVm
ZXJyZWQgSU8gaXMgZW5hYmxlZCwgYW5kCmF2b2lkIG1vZGlmeWluZyBmYl9vcHMgYWx0b2dldGhl
ci4KClNpbXBseSB1c2UgaW5mby0+ZmJkZWZpbyB0byBkZXRlcm1pbmUgd2hldGhlciBkZWZlcnJl
ZCBJTyBzaG91bGQgYmUgdXNlZApvciBub3QuIFRoaXMgc2hvdWxkIGJlIGFjY3VyYXRlIGVub3Vn
aCBmb3IgYWxsIHVzZSBjYXNlcywgYWx0aG91Z2gKcGVyaGFwcyBub3QgcGVkYW50aWNhbGx5IGNv
cnJlY3QuCgp2MjogU2ltcGxpZnkgY29uc2lkZXJhYmx5IGJ5IGNhbGxpbmcgZmJfZGVmZXJyZWRf
aW9fbW1hcCgpIGRpcmVjdGx5CiAgICAoRGFuaWVsLCBWaWxsZSkKCkNjOiBKYXlhIEt1bWFyIDxq
YXlhbGtAaW50d29ya3MuYml6PgpDYzogbGludXgtZmJkZXZAdmdlci5rZXJuZWwub3JnCkNjOiBE
YW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxl
LnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBKYW5pIE5pa3VsYSA8amFu
aS5uaWt1bGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYl9kZWZp
by5jIHwgIDMgLS0tCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJtZW0uYyAgICB8IDE1ICsr
KysrKysrKysrLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxMSBpbnNlcnRpb25zKCspLCA3IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYl9kZWZpby5j
IGIvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZiX2RlZmlvLmMKaW5kZXggODJjMjBjNjA0N2Iw
Li5hNTkxZDI5MWIyMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYl9k
ZWZpby5jCisrKyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYl9kZWZpby5jCkBAIC0xNzEs
NyArMTcxLDYgQEAgaW50IGZiX2RlZmVycmVkX2lvX21tYXAoc3RydWN0IGZiX2luZm8gKmluZm8s
IHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogCXZtYS0+dm1fcHJpdmF0ZV9kYXRhID0gaW5m
bzsKIAlyZXR1cm4gMDsKIH0KLUVYUE9SVF9TWU1CT0woZmJfZGVmZXJyZWRfaW9fbW1hcCk7CiAK
IC8qIHdvcmtxdWV1ZSBjYWxsYmFjayAqLwogc3RhdGljIHZvaWQgZmJfZGVmZXJyZWRfaW9fd29y
ayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCkBAIC0yMDYsNyArMjA1LDYgQEAgdm9pZCBmYl9k
ZWZlcnJlZF9pb19pbml0KHN0cnVjdCBmYl9pbmZvICppbmZvKQogCiAJQlVHX09OKCFmYmRlZmlv
KTsKIAltdXRleF9pbml0KCZmYmRlZmlvLT5sb2NrKTsKLQlpbmZvLT5mYm9wcy0+ZmJfbW1hcCA9
IGZiX2RlZmVycmVkX2lvX21tYXA7CiAJSU5JVF9ERUxBWUVEX1dPUksoJmluZm8tPmRlZmVycmVk
X3dvcmssIGZiX2RlZmVycmVkX2lvX3dvcmspOwogCUlOSVRfTElTVF9IRUFEKCZmYmRlZmlvLT5w
YWdlbGlzdCk7CiAJaWYgKGZiZGVmaW8tPmRlbGF5ID09IDApIC8qIHNldCBhIGRlZmF1bHQgb2Yg
MSBzICovCkBAIC0yMzcsNyArMjM1LDYgQEAgdm9pZCBmYl9kZWZlcnJlZF9pb19jbGVhbnVwKHN0
cnVjdCBmYl9pbmZvICppbmZvKQogCQlwYWdlLT5tYXBwaW5nID0gTlVMTDsKIAl9CiAKLQlpbmZv
LT5mYm9wcy0+ZmJfbW1hcCA9IE5VTEw7CiAJbXV0ZXhfZGVzdHJveSgmZmJkZWZpby0+bG9jayk7
CiB9CiBFWFBPUlRfU1lNQk9MX0dQTChmYl9kZWZlcnJlZF9pb19jbGVhbnVwKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jIGIvZHJpdmVycy92aWRlby9mYmRl
di9jb3JlL2ZibWVtLmMKaW5kZXggODZiMDZhNTk5Zjk2Li45OTA1NTA5MzBhOGUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jCisrKyBiL2RyaXZlcnMvdmlkZW8v
ZmJkZXYvY29yZS9mYm1lbS5jCkBAIC0xMzMyLDE2ICsxMzMyLDIzIEBAIHN0YXRpYyBpbnQKIGZi
X21tYXAoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqIHZtYSkKIHsK
IAlzdHJ1Y3QgZmJfaW5mbyAqaW5mbyA9IGZpbGVfZmJfaW5mbyhmaWxlKTsKLQlzdHJ1Y3QgZmJf
b3BzICpmYjsKKwlpbnQgKCpmYl9tbWFwX2ZuKShzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgc3RydWN0
IHZtX2FyZWFfc3RydWN0ICp2bWEpOwogCXVuc2lnbmVkIGxvbmcgbW1pb19wZ29mZjsKIAl1bnNp
Z25lZCBsb25nIHN0YXJ0OwogCXUzMiBsZW47CiAKIAlpZiAoIWluZm8pCiAJCXJldHVybiAtRU5P
REVWOwotCWZiID0gaW5mby0+ZmJvcHM7CiAJbXV0ZXhfbG9jaygmaW5mby0+bW1fbG9jayk7Ci0J
aWYgKGZiLT5mYl9tbWFwKSB7CisKKwlmYl9tbWFwX2ZuID0gaW5mby0+ZmJvcHMtPmZiX21tYXA7
CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19GQl9ERUZFUlJFRF9JTykKKwlpZiAoaW5mby0+ZmJk
ZWZpbykKKwkJZmJfbW1hcF9mbiA9IGZiX2RlZmVycmVkX2lvX21tYXA7CisjZW5kaWYKKworCWlm
IChmYl9tbWFwX2ZuKSB7CiAJCWludCByZXM7CiAKIAkJLyoKQEAgLTEzNDksNyArMTM1Niw3IEBA
IGZiX21tYXAoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqIHZtYSkK
IAkJICogU01FIHByb3RlY3Rpb24gaXMgcmVtb3ZlZCBhaGVhZCBvZiB0aGUgY2FsbAogCQkgKi8K
IAkJdm1hLT52bV9wYWdlX3Byb3QgPSBwZ3Byb3RfZGVjcnlwdGVkKHZtYS0+dm1fcGFnZV9wcm90
KTsKLQkJcmVzID0gZmItPmZiX21tYXAoaW5mbywgdm1hKTsKKwkJcmVzID0gZmJfbW1hcF9mbihp
bmZvLCB2bWEpOwogCQltdXRleF91bmxvY2soJmluZm8tPm1tX2xvY2spOwogCQlyZXR1cm4gcmVz
OwogCX0KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
