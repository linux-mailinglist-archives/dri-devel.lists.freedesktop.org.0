Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D0B20E1FCE
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:45:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 98D786EB21;
	Wed, 23 Oct 2019 15:45:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 97DD88959D
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:27 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 2F96528F905;
 Wed, 23 Oct 2019 16:45:25 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 09/21] drm/bridge: Add a drm_bridge_state object
Date: Wed, 23 Oct 2019 17:45:00 +0200
Message-Id: <20191023154512.9762-10-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T25lIG9mIHRoZSBsYXN0IHJlbWFpbmluZyBvYmplY3RzIHRvIG5vdCBoYXZlIGl0cyBhdG9taWMg
c3RhdGUuCgpUaGlzIGlzIGJlaW5nIG1vdGl2YXRlZCBieSBvdXIgYXR0ZW1wdCB0byBzdXBwb3J0
IHJ1bnRpbWUgYnVzLWZvcm1hdApuZWdvdGlhdGlvbiBiZXR3ZWVuIGVsZW1lbnRzIG9mIHRoZSBi
cmlkZ2UgY2hhaW4uClRoaXMgcGF0Y2gganVzdCBwYXZlcyB0aGUgcm9hZCBmb3Igc3VjaCBhIGZl
YXR1cmUgYnkgYWRkaW5nIGEgbmV3CmRybV9icmlkZ2Vfc3RhdGUgb2JqZWN0IGluaGVyaXRpbmcg
ZnJvbSBkcm1fcHJpdmF0ZV9vYmogc28gd2UgY2FuCnJlLXVzZSBzb21lIG9mIHRoZSBleGlzdGlu
ZyBzdGF0ZSBpbml0aWFsaXphdGlvbi90cmFja2luZyBsb2dpYy4KClNpZ25lZC1vZmYtYnk6IEJv
cmlzIEJyZXppbGxvbiA8Ym9yaXMuYnJlemlsbG9uQGNvbGxhYm9yYS5jb20+Ci0tLQpDaGFuZ2Vz
IGluIHYzOgoqIE5vbmUKCkNoYW5nZXMgaW4gdjI6CiogVXNlIGRybV9mb3JfZWFjaF9icmlkZ2Vf
aW5fY2hhaW4oKQoqIFJlbmFtZSBoZWxwZXJzIHRvIGJlIG1vcmUgY29uc2lzdGVudCB3aXRoIHRo
ZSByZXN0IG9mIHRoZSBEUk0gQVBJCiogSW1wcm92ZS9maXggdGhlIGRvYwotLS0KIGRyaXZlcnMv
Z3B1L2RybS9kcm1fYXRvbWljLmMgICAgICAgIHwgIDM5ICsrKysrKysKIGRyaXZlcnMvZ3B1L2Ry
bS9kcm1fYXRvbWljX2hlbHBlci5jIHwgIDIwICsrKysKIGRyaXZlcnMvZ3B1L2RybS9kcm1fYnJp
ZGdlLmMgICAgICAgIHwgMTY4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIGluY2x1ZGUv
ZHJtL2RybV9hdG9taWMuaCAgICAgICAgICAgIHwgICAzICsKIGluY2x1ZGUvZHJtL2RybV9icmlk
Z2UuaCAgICAgICAgICAgIHwgMTE4ICsrKysrKysrKysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdl
ZCwgMzQzIGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2RybV9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKaW5k
ZXggNDE5MzgxYWJiZGQxLi42YzI0OWNlMzkzODAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fYXRvbWljLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwpAQCAtMzAs
NiArMzAsNyBAQAogCiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2F0b21pY191YXBpLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9icmlkZ2UuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX2RlYnVnZnMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgogI2luY2x1
ZGUgPGRybS9kcm1fZHJ2Lmg+CkBAIC0xMDEwLDYgKzEwMTEsNDQgQEAgc3RhdGljIHZvaWQgZHJt
X2F0b21pY19jb25uZWN0b3JfcHJpbnRfc3RhdGUoc3RydWN0IGRybV9wcmludGVyICpwLAogCQlj
b25uZWN0b3ItPmZ1bmNzLT5hdG9taWNfcHJpbnRfc3RhdGUocCwgc3RhdGUpOwogfQogCisvKioK
KyAqIGRybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyAtIGFkZCBicmlkZ2VzIGF0dGFjaGVk
IHRvIGFuIGVuY29kZXIKKyAqIEBzdGF0ZTogYXRvbWljIHN0YXRlCisgKiBAZW5jb2RlcjogRFJN
IGVuY29kZXIKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIGFkZHMgYWxsIGJyaWRnZXMgYXR0YWNoZWQg
dG8gQGVuY29kZXIuIFRoaXMgaXMgbmVlZGVkIHRvIGFkZAorICogYnJpZGdlIHN0YXRlcyB0byBA
c3RhdGUgYW5kIG1ha2UgdGhlbSBhdmFpbGFibGUgd2hlbgorICogJmJyaWRnZV9mdW5jcy5hdG9t
aWNfe2NoZWNrLHByZV9lbmFibGUsZW5hYmxlLGRpc2FibGVfcG9zdF9kaXNhYmxlfSgpIGFyZQor
ICogY2FsbGVkCisgKgorICogUmV0dXJuczoKKyAqIDAgb24gc3VjY2VzcyBvciBjYW4gZmFpbCB3
aXRoIC1FREVBRExLIG9yIC1FTk9NRU0uIFdoZW4gdGhlIGVycm9yIGlzIEVERUFETEsKKyAqIHRo
ZW4gdGhlIHcvdyBtdXRleCBjb2RlIGhhcyBkZXRlY3RlZCBhIGRlYWRsb2NrIGFuZCB0aGUgZW50
aXJlIGF0b21pYworICogc2VxdWVuY2UgbXVzdCBiZSByZXN0YXJ0ZWQuIEFsbCBvdGhlciBlcnJv
cnMgYXJlIGZhdGFsLgorICovCitpbnQKK2RybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkgICAgICAgc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyKQoreworCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGU7
CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKKworCWlmICghZW5jb2RlcikKKwkJcmV0dXJu
IDA7CisKKwlEUk1fREVCVUdfQVRPTUlDKCJBZGRpbmcgYWxsIGJyaWRnZXMgZm9yIFtlbmNvZGVy
OiVkOiVzXSB0byAlcFxuIiwKKwkJCSBlbmNvZGVyLT5iYXNlLmlkLCBlbmNvZGVyLT5uYW1lLCBz
dGF0ZSk7CisKKwlkcm1fZm9yX2VhY2hfYnJpZGdlX2luX2NoYWluKGVuY29kZXIsIGJyaWRnZSkg
eworCQlicmlkZ2Vfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9icmlkZ2Vfc3RhdGUoc3RhdGUsIGJy
aWRnZSk7CisJCWlmIChJU19FUlIoYnJpZGdlX3N0YXRlKSkKKwkJCXJldHVybiBQVFJfRVJSKGJy
aWRnZV9zdGF0ZSk7CisJfQorCisJcmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hdG9t
aWNfYWRkX2VuY29kZXJfYnJpZGdlcyk7CisKIC8qKgogICogZHJtX2F0b21pY19hZGRfYWZmZWN0
ZWRfY29ubmVjdG9ycyAtIGFkZCBjb25uZWN0b3JzIGZvciBjcnRjCiAgKiBAc3RhdGU6IGF0b21p
YyBzdGF0ZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwppbmRleCBmMDJkZGZmZDQ5NjAu
LmRlOTg1YmE3Y2UyZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVs
cGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTczMCw2
ICs3MzAsMjYgQEAgZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfbW9kZXNldChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCQkJcmV0dXJuIHJldDsKIAl9CiAKKwkvKgorCSAqIEl0ZXJhdGUgb3ZlciBh
bGwgY29ubmVjdG9ycyBhZ2FpbiwgYW5kIGFkZCBhbGwgYWZmZWN0ZWQgYnJpZGdlcyB0bworCSAq
IHRoZSBzdGF0ZS4KKwkgKi8KKwlmb3JfZWFjaF9vbGRuZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0
YXRlLCBjb25uZWN0b3IsCisJCQkJCSAgIG9sZF9jb25uZWN0b3Jfc3RhdGUsCisJCQkJCSAgIG5l
d19jb25uZWN0b3Jfc3RhdGUsIGkpIHsKKwkJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwor
CisJCWVuY29kZXIgPSBvbGRfY29ubmVjdG9yX3N0YXRlLT5iZXN0X2VuY29kZXI7CisJCXJldCA9
IGRybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdGF0ZSwgZW5jb2Rlcik7CisJCWlmIChy
ZXQpCisJCQlyZXR1cm4gcmV0OworCisJCWVuY29kZXIgPSBuZXdfY29ubmVjdG9yX3N0YXRlLT5i
ZXN0X2VuY29kZXI7CisJCXJldCA9IGRybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdGF0
ZSwgZW5jb2Rlcik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKwogCXJldCA9IG1v
ZGVfdmFsaWQoc3RhdGUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2Uu
YwppbmRleCBjNWNmOGE5YzQyMzcuLmM1Mzk2Njc2Nzc4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2RybV9icmlkZ2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCkBA
IC0yNSw2ICsyNSw3IEBACiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGlu
dXgvbXV0ZXguaD4KIAorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5oPgog
I2luY2x1ZGUgPGRybS9kcm1fYnJpZGdlLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+
CiAKQEAgLTg5LDYgKzkwLDM4IEBAIHZvaWQgZHJtX2JyaWRnZV9yZW1vdmUoc3RydWN0IGRybV9i
cmlkZ2UgKmJyaWRnZSkKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9yZW1vdmUpOwogCitz
dGF0aWMgc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICoKK2RybV9icmlkZ2VfYXRvbWljX2R1cGxp
Y2F0ZV9wcml2X3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogKm9iaikKK3sKKwlzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlID0gZHJtX3ByaXZfdG9fYnJpZGdlKG9iaik7CisJc3RydWN0IGRy
bV9icmlkZ2Vfc3RhdGUgKnN0YXRlOworCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kdXBs
aWNhdGVfc3RhdGUpCisJCXN0YXRlID0gYnJpZGdlLT5mdW5jcy0+YXRvbWljX2R1cGxpY2F0ZV9z
dGF0ZShicmlkZ2UpOworCWVsc2UKKwkJc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9icmlkZ2Vf
ZHVwbGljYXRlX3N0YXRlKGJyaWRnZSk7CisKKwlyZXR1cm4gJnN0YXRlLT5iYXNlOworfQorCitz
dGF0aWMgdm9pZAorZHJtX2JyaWRnZV9hdG9taWNfZGVzdHJveV9wcml2X3N0YXRlKHN0cnVjdCBk
cm1fcHJpdmF0ZV9vYmogKm9iaiwKKwkJCQkgICAgIHN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAq
cykKK3sKKwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUgPSBkcm1fcHJpdl90b19icmlk
Z2Vfc3RhdGUocyk7CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9IGRybV9wcml2X3RvX2Jy
aWRnZShvYmopOworCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kZXN0cm95X3N0YXRlKQor
CQlicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZGVzdHJveV9zdGF0ZShicmlkZ2UsIHN0YXRlKTsKKwll
bHNlCisJCWRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0cm95X3N0YXRlKGJyaWRnZSwgc3Rh
dGUpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wcml2YXRlX3N0YXRlX2Z1bmNzIGRy
bV9icmlkZ2VfcHJpdl9zdGF0ZV9mdW5jcyA9IHsKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9
IGRybV9icmlkZ2VfYXRvbWljX2R1cGxpY2F0ZV9wcml2X3N0YXRlLAorCS5hdG9taWNfZGVzdHJv
eV9zdGF0ZSA9IGRybV9icmlkZ2VfYXRvbWljX2Rlc3Ryb3lfcHJpdl9zdGF0ZSwKK307CisKIC8q
KgogICogZHJtX2JyaWRnZV9hdHRhY2ggLSBhdHRhY2ggdGhlIGJyaWRnZSB0byBhbiBlbmNvZGVy
J3MgY2hhaW4KICAqCkBAIC0xMTQsNiArMTQ3LDcgQEAgRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdl
X3JlbW92ZSk7CiBpbnQgZHJtX2JyaWRnZV9hdHRhY2goc3RydWN0IGRybV9lbmNvZGVyICplbmNv
ZGVyLCBzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogCQkgICAgICBzdHJ1Y3QgZHJtX2JyaWRn
ZSAqcHJldmlvdXMpCiB7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRlOwogCUxJU1Rf
SEVBRCh0bXBfbGlzdCk7CiAJaW50IHJldDsKIApAQCAtMTMyLDE5ICsxNjYsMzkgQEAgaW50IGRy
bV9icmlkZ2VfYXR0YWNoKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRybV9i
cmlkZ2UgKmJyaWRnZSwKIAogCWlmIChicmlkZ2UtPmZ1bmNzLT5hdHRhY2gpIHsKIAkJcmV0ID0g
YnJpZGdlLT5mdW5jcy0+YXR0YWNoKGJyaWRnZSk7Ci0JCWlmIChyZXQgPCAwKSB7Ci0JCQlicmlk
Z2UtPmRldiA9IE5VTEw7Ci0JCQlicmlkZ2UtPmVuY29kZXIgPSBOVUxMOwotCQkJcmV0dXJuIHJl
dDsKLQkJfQorCQlpZiAocmV0IDwgMCkKKwkJCWdvdG8gZXJyX3Jlc2V0X2JyaWRnZTsKIAl9CiAK
KwlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX3Jlc2V0KQorCQlzdGF0ZSA9IGJyaWRnZS0+ZnVu
Y3MtPmF0b21pY19yZXNldChicmlkZ2UpOworCWVsc2UKKwkJc3RhdGUgPSBkcm1fYXRvbWljX2hl
bHBlcl9icmlkZ2VfcmVzZXQoYnJpZGdlKTsKKworCWlmIChJU19FUlIoc3RhdGUpKSB7CisJCXJl
dCA9IFBUUl9FUlIoc3RhdGUpOworCQlnb3RvIGVycl9kZXRhY2hfYnJpZGdlOworCX0KKworCWRy
bV9hdG9taWNfcHJpdmF0ZV9vYmpfaW5pdChicmlkZ2UtPmRldiwgJmJyaWRnZS0+YmFzZSwKKwkJ
CQkgICAgJnN0YXRlLT5iYXNlLAorCQkJCSAgICAmZHJtX2JyaWRnZV9wcml2X3N0YXRlX2Z1bmNz
KTsKKwogCWlmIChwcmV2aW91cykKIAkJbGlzdF9zcGxpY2UoJnRtcF9saXN0LCAmcHJldmlvdXMt
PmNoYWluX25vZGUpOwogCWVsc2UKIAkJbGlzdF9zcGxpY2UoJnRtcF9saXN0LCAmZW5jb2Rlci0+
YnJpZGdlX2NoYWluKTsKIAogCXJldHVybiAwOworCitlcnJfZGV0YWNoX2JyaWRnZToKKwlpZiAo
YnJpZGdlLT5mdW5jcy0+ZGV0YWNoKQorCQlicmlkZ2UtPmZ1bmNzLT5kZXRhY2goYnJpZGdlKTsK
KworZXJyX3Jlc2V0X2JyaWRnZToKKwlicmlkZ2UtPmRldiA9IE5VTEw7CisJYnJpZGdlLT5lbmNv
ZGVyID0gTlVMTDsKKwlyZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2F0
dGFjaCk7CiAKQEAgLTE1Niw2ICsyMTAsOCBAQCB2b2lkIGRybV9icmlkZ2VfZGV0YWNoKHN0cnVj
dCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJaWYgKFdBUk5fT04oIWJyaWRnZS0+ZGV2KSkKIAkJcmV0
dXJuOwogCisJZHJtX2F0b21pY19wcml2YXRlX29ial9maW5pKCZicmlkZ2UtPmJhc2UpOworCiAJ
aWYgKGJyaWRnZS0+ZnVuY3MtPmRldGFjaCkKIAkJYnJpZGdlLT5mdW5jcy0+ZGV0YWNoKGJyaWRn
ZSk7CiAKQEAgLTUyMiw2ICs1NzgsMTA4IEBAIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5f
ZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiB9CiBFWFBPUlRfU1lNQk9MKGRybV9h
dG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZSk7CiAKKy8qKgorICogZHJtX2F0b21pY19oZWxwZXJf
YnJpZGdlX2Rlc3Ryb3lfc3RhdGUoKSAtIERlZmF1bHQgZGVzdHJveSBzdGF0ZSBoZWxwZXIKKyAq
IEBicmlkZ2U6IHRoZSBicmlkZ2UgdGhpcyBzdGF0ZSByZWZlcnMgdG8KKyAqIEBzdGF0ZTogc3Rh
dGUgb2JqZWN0IHRvIGRlc3Ryb3kKKyAqCisgKiBKdXN0IGEgc2ltcGxlIGtmcmVlKCkgZm9yIG5v
dy4KKyAqLwordm9pZCBkcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfZGVzdHJveV9zdGF0ZShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUg
KnN0YXRlKQoreworCWtmcmVlKHN0YXRlKTsKK30KK0VYUE9SVF9TWU1CT0woZHJtX2F0b21pY19o
ZWxwZXJfYnJpZGdlX2Rlc3Ryb3lfc3RhdGUpOworCisvKioKKyAqIF9fZHJtX2F0b21pY19oZWxw
ZXJfYnJpZGdlX3Jlc2V0KCkgLSBJbml0aWFsaXplIGEgYnJpZGdlIHN0YXRlIHRvIGl0cworICoJ
CQkJCWRlZmF1bHQKKyAqIEBicmlkZ2U6IHRoZSBicmlkZ2UgdGhpcyBzdGF0ZSBpcyByZWZlcnMg
dG8KKyAqIEBzdGF0ZTogYnJpZGdlIHN0YXRlIHRvIGluaXRpYWxpemUKKyAqCisgKiBGb3Igbm93
IGl0J3MganVzdCBhIG1lbXNldCgwKSBwbHVzIGEgc3RhdGUtPmJyaWRnZSBhc3NpZ25tZW50LiBN
aWdodAorICogYmUgZXh0ZW5kZWQgaW4gdGhlIGZ1dHVyZS4KKyAqLwordm9pZCBfX2RybV9hdG9t
aWNfaGVscGVyX2JyaWRnZV9yZXNldChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAg
ICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSkKK3sKKwltZW1zZXQoc3RhdGUsIDAs
IHNpemVvZigqc3RhdGUpKTsKKwlzdGF0ZS0+YnJpZGdlID0gYnJpZGdlOworfQorRVhQT1JUX1NZ
TUJPTChfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9yZXNldCk7CisKKy8qKgorICogZHJtX2F0
b21pY19oZWxwZXJfYnJpZGdlX3Jlc2V0KCkgLSBkZWZhdWx0ICZkcm1fcGxhbmVfZnVuY3MucmVz
ZXQgaG9vayBmb3IKKyAqCQkJCSAgICAgIGJyaWRnZXMKKyAqIEBicmlkZ2U6IHRoZSBicmlkZ2Ug
dG8gcmVzZXQgc3RhdGUgb24KKyAqCisgKiBSZXNldHMgdGhlIGF0b21pYyBzdGF0ZSBmb3IgQGJy
aWRnZSBieSBmcmVlaW5nIHRoZSBzdGF0ZSBwb2ludGVyICh3aGljaAorICogbWlnaHQgYmUgTlVM
TCwgZS5nLiBhdCBkcml2ZXIgbG9hZCB0aW1lKSBhbmQgYWxsb2NhdGluZyBhIG5ldyBlbXB0eSBz
dGF0ZQorICogb2JqZWN0LgorICoKKyAqIFJFVFVSTlM6CisgKiBBIHZhbGlkIGRybV9icmlkZ2Vf
c3RhdGUgb2JqZWN0IGluIGNhc2Ugb2Ygc3VjY2VzcywgYW4gRVJSX1BUUigpCisgKiBnaXZpbmcg
dGhlIHJlYW9uIG9mIHRoZSBmYWlsdXJlIG90aGVyd2lzZS4KKyAqLworc3RydWN0IGRybV9icmlk
Z2Vfc3RhdGUgKgorZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX3Jlc2V0KHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKmJyaWRnZV9zdGF0ZTsK
KworCWJyaWRnZV9zdGF0ZSA9IGt6YWxsb2Moc2l6ZW9mKCpicmlkZ2Vfc3RhdGUpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIWJyaWRnZV9zdGF0ZSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisK
KwlfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9yZXNldChicmlkZ2UsIGJyaWRnZV9zdGF0ZSk7
CisJcmV0dXJuIGJyaWRnZV9zdGF0ZTsKK30KK0VYUE9SVF9TWU1CT0woZHJtX2F0b21pY19oZWxw
ZXJfYnJpZGdlX3Jlc2V0KTsKKworLyoqCisgKiBfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9k
dXBsaWNhdGVfc3RhdGUoKSAtIENvcHkgdGhlIGNvbnRlbnQgb2YgdGhlCisgKgkJCQkJCSAgY3Vy
cmVudCBicmlkZ2Ugc3RhdGUgaW50byBhCisgKgkJCQkJCSAgbmV3IG9uZQorICogQGJyaWRnZTog
YnJpZGdlIGVsZW1lbnQgdGhlIG9sZCBhbmQgbmV3IHN0YXRlcyBhcmUgcmVmZXJyaW5nIHRvCisg
KiBAbmV3OiBuZXcgYnJpZGdlIHN0YXRlIHRvIGNvcHkgdG8KKyAqCisgKiBTaG91bGQgYmUgdXNl
ZCBieSBjdXN0b20gJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2R1cGxpY2F0ZSgpIGltcGxlbWVu
dGF0aW9uCisgKiB0byBjb3B5IHRoZSBwcmV2aW91cyBzdGF0ZSBpbnRvIHRoZSBuZXcgb2JqZWN0
LgorICovCit2b2lkIF9fZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUg
Km5ldykKK3sKKwlfX2RybV9hdG9taWNfaGVscGVyX3ByaXZhdGVfb2JqX2R1cGxpY2F0ZV9zdGF0
ZSgmYnJpZGdlLT5iYXNlLAorCQkJCQkJCSZuZXctPmJhc2UpOworCW5ldy0+YnJpZGdlID0gYnJp
ZGdlOworfQorRVhQT1JUX1NZTUJPTChfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBsaWNh
dGVfc3RhdGUpOworCisvKioKKyAqIGRybV9hdG9taWNfaGVscGVyX2R1cGxpY2F0ZV9icmlkZ2Vf
c3RhdGUoKSAtIERlZmF1bHQgZHVwbGljYXRlIHN0YXRlIGhlbHBlcgorICogQGJyaWRnZTogYnJp
ZGdlIGNvbnRhaW5pbmcgdGhlIHN0YXRlIHRvIGR1cGxpY2F0ZQorICoKKyAqIERlZmF1bHQgaW1w
bGVtZW50YXRpb24gb2YgJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2R1cGxpY2F0ZSgpLgorICoK
KyAqIFJFVFVSTlM6CisgKiBhIHZhbGlkIHN0YXRlIG9iamVjdCBvciBOVUxMIGlmIHRoZSBhbGxv
Y2F0aW9uIGZhaWxzLgorICovCitzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWlj
X2hlbHBlcl9icmlkZ2VfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
Cit7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm5ldzsKKworCWlmIChXQVJOX09OKCFicmlk
Z2UtPmJhc2Uuc3RhdGUpKQorCQlyZXR1cm4gTlVMTDsKKworCW5ldyA9IGt6YWxsb2Moc2l6ZW9m
KCpuZXcpLCBHRlBfS0VSTkVMKTsKKwlpZiAobmV3KQorCQlfX2RybV9hdG9taWNfaGVscGVyX2Jy
aWRnZV9kdXBsaWNhdGVfc3RhdGUoYnJpZGdlLCBuZXcpOworCisJcmV0dXJuIG5ldzsKK30KK0VY
UE9SVF9TWU1CT0woZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZSk7CisK
ICNpZmRlZiBDT05GSUdfT0YKIC8qKgogICogb2ZfZHJtX2ZpbmRfYnJpZGdlIC0gZmluZCB0aGUg
YnJpZGdlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRldmljZSBub2RlIGluCmRpZmYgLS1naXQgYS9p
bmNsdWRlL2RybS9kcm1fYXRvbWljLmggYi9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmgKaW5kZXgg
OTI3ZTEyMDVkN2FhLi4xYzBhMDgyMTc3MTIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9h
dG9taWMuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmgKQEAgLTY2MCw2ICs2NjAsOSBA
QCBfX2RybV9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUoc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlLAogCXJldHVybiBwbGFuZS0+c3RhdGU7CiB9CiAKK2ludCBfX211c3RfY2hl
Y2sKK2RybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUsCisJCQkgICAgICAgc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKTsKIGludCBf
X211c3RfY2hlY2sKIGRybV9hdG9taWNfYWRkX2FmZmVjdGVkX2Nvbm5lY3RvcnMoc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgIHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CmRp
ZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggYi9pbmNsdWRlL2RybS9kcm1fYnJp
ZGdlLmgKaW5kZXggMjM4ZTg0YWI2M2EzLi5hNjA4YzQ3ZDFkZTUgMTAwNjQ0Ci0tLSBhL2luY2x1
ZGUvZHJtL2RybV9icmlkZ2UuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKQEAgLTI1
LDYgKzI1LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9j
dHlwZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9l
bmNvZGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9tb2RlX29iamVjdC5oPgogI2luY2x1ZGUgPGRy
bS9kcm1fbW9kZXMuaD4KQEAgLTMzLDYgKzM0LDIzIEBAIHN0cnVjdCBkcm1fYnJpZGdlOwogc3Ry
dWN0IGRybV9icmlkZ2VfdGltaW5nczsKIHN0cnVjdCBkcm1fcGFuZWw7CiAKKy8qKgorICogc3Ry
dWN0IGRybV9icmlkZ2Vfc3RhdGUgLSBBdG9taWMgYnJpZGdlIHN0YXRlIG9iamVjdAorICogQGJh
c2U6IGluaGVyaXQgZnJvbSAmZHJtX3ByaXZhdGVfc3RhdGUKKyAqIEBicmlkZ2U6IHRoZSBicmlk
Z2UgdGhpcyBzdGF0ZSByZWZlcnMgdG8KKyAqLworc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgewor
CXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSBiYXNlOworCisJc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZTsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJt
X3ByaXZfdG9fYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAqcHJpdikKK3sK
KwlyZXR1cm4gY29udGFpbmVyX29mKHByaXYsIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlLCBiYXNl
KTsKK30KKwogLyoqCiAgKiBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyAtIGRybV9icmlkZ2UgY29u
dHJvbCBmdW5jdGlvbnMKICAqLwpAQCAtMzM4LDYgKzM1Niw0OCBAQCBzdHJ1Y3QgZHJtX2JyaWRn
ZV9mdW5jcyB7CiAJICovCiAJdm9pZCAoKmF0b21pY19wb3N0X2Rpc2FibGUpKHN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2UsCiAJCQkJICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7
CisKKwkvKioKKwkgKiBAYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZToKKwkgKgorCSAqIER1cGxpY2F0
ZSB0aGUgY3VycmVudCBicmlkZ2Ugc3RhdGUgb2JqZWN0ICh3aGljaCBpcyBndWFyYW50ZWVkIHRv
IGJlCisJICogbm9uLU5VTEwpLgorCSAqCisJICogVGhlIGF0b21pY19kdXBsaWNhdGVfc3RhdGUo
KSBpcyBvcHRpb25hbCwgdGhlIGNvcmUgZmFsbHMgYmFjayBvbgorCSAqICZkcm1fYXRvbWljX2hl
bHBlcl9icmlkZ2VfZHVwbGljYXRlX3N0YXRlKCkgd2hlbiBub3QgaW1wbGVtZW50ZWQuCisJICoK
KwkgKiBSRVRVUk5TOgorCSAqIEEgdmFsaWQgZHJtX2JyaWRnZV9zdGF0ZSBvYmplY3Qgb3IgTlVM
TCBpZiB0aGUgYWxsb2NhdGlvbiBmYWlscy4KKwkgKi8KKwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0
ZSAqKCphdG9taWNfZHVwbGljYXRlX3N0YXRlKShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsK
KworCS8qKgorCSAqIEBhdG9taWNfZGVzdHJveV9zdGF0ZToKKwkgKgorCSAqIERlc3Ryb3kgYSBi
cmlkZ2Ugc3RhdGUgb2JqZWN0IHByZXZpb3VzbHkgYWxsb2NhdGVkIGJ5CisJICogJmRybV9icmlk
Z2VfZnVuY3MuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSgpLgorCSAqCisJICogVGhlIGF0b21pY19k
ZXN0cm95X3N0YXRlIGhvb2sgaXMgb3B0aW9uYWwsIHRoZSBjb3JlZiBmYWxscyBiYWNrIG9uCisJ
ICogJmRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0cm95X3N0YXRlKCkgd2hlbiBub3QgaW1w
bGVtZW50ZWQuCisJICovCisJdm9pZCAoKmF0b21pY19kZXN0cm95X3N0YXRlKShzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRl
KTsKKworCS8qKgorCSAqIEBhdG9taWNfcmVzZXQ6CisJICoKKwkgKiBSZXNldCB0aGUgYnJpZGdl
IHRvIGEgcHJlZGVmaW5lZCBzdGF0ZSAob3IgcmV0cmlldmUgaXRzIGN1cnJlbnQKKwkgKiBzdGF0
ZSkgYW5kIHJldHVybiBhICZkcm1fYnJpZGdlX3N0YXRlIG9iamVjdCBtYXRjaGluZyB0aGlzIHN0
YXRlLgorCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IGF0dGFjaCB0aW1lLgorCSAqCisJ
ICogVGhlIGF0b21pY19yZXNldCBob29rIGlzIG9wdGlvbmFsLCB0aGUgY29yZSBmYWxscyBiYWNr
IG9uCisJICogJmRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9yZXNldCgpIHdoZW4gbm90IGltcGxl
bWVudGVkLgorCSAqCisJICogUkVUVVJOUzoKKwkgKiBBIHZhbGlkIGRybV9icmlkZ2Vfc3RhdGUg
b2JqZWN0IGluIGNhc2Ugb2Ygc3VjY2VzcywgYW4gRVJSX1BUUigpCisJICogZ2l2aW5nIHRoZSBy
ZWFvbiBvZiB0aGUgZmFpbHVyZSBvdGhlcndpc2UuCisJICovCisJc3RydWN0IGRybV9icmlkZ2Vf
c3RhdGUgKigqYXRvbWljX3Jlc2V0KShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKIH07CiAK
IC8qKgpAQCAtMzgwLDYgKzQ0MCw4IEBAIHN0cnVjdCBkcm1fYnJpZGdlX3RpbWluZ3MgewogICog
c3RydWN0IGRybV9icmlkZ2UgLSBjZW50cmFsIERSTSBicmlkZ2UgY29udHJvbCBzdHJ1Y3R1cmUK
ICAqLwogc3RydWN0IGRybV9icmlkZ2UgeworCS8qKiBAYmFzZTogaW5oZXJpdCBmcm9tICZkcm1f
cHJpdmF0ZV9vYmplY3QgKi8KKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqIGJhc2U7CiAJLyoqIEBk
ZXY6IERSTSBkZXZpY2UgdGhpcyBicmlkZ2UgYmVsb25ncyB0byAqLwogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXY7CiAJLyoqIEBlbmNvZGVyOiBlbmNvZGVyIHRvIHdoaWNoIHRoaXMgYnJpZGdlIGlz
IGNvbm5lY3RlZCAqLwpAQCAtNDA0LDYgKzQ2NiwxMiBAQCBzdHJ1Y3QgZHJtX2JyaWRnZSB7CiAJ
dm9pZCAqZHJpdmVyX3ByaXZhdGU7CiB9OwogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJp
ZGdlICoKK2RybV9wcml2X3RvX2JyaWRnZShzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpwcml2KQor
eworCXJldHVybiBjb250YWluZXJfb2YocHJpdiwgc3RydWN0IGRybV9icmlkZ2UsIGJhc2UpOwor
fQorCiB2b2lkIGRybV9icmlkZ2VfYWRkKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpOwogdm9p
ZCBkcm1fYnJpZGdlX3JlbW92ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKIHN0cnVjdCBk
cm1fYnJpZGdlICpvZl9kcm1fZmluZF9icmlkZ2Uoc3RydWN0IGRldmljZV9ub2RlICpucCk7CkBA
IC00NzUsNiArNTQzLDU2IEBAIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fcHJlX2VuYWJs
ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFp
bl9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgICAgc3RydWN0IGRybV9h
dG9taWNfc3RhdGUgKnN0YXRlKTsKIAordm9pZCBfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9y
ZXNldChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgICAgIHN0cnVjdCBkcm1fYnJp
ZGdlX3N0YXRlICpzdGF0ZSk7CitzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWlj
X2hlbHBlcl9icmlkZ2VfcmVzZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSk7Cit2b2lkIGRy
bV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2UsCisJCQkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpOwordm9pZCBf
X2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSwKKwkJCQkJCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpuZXcpOworc3RydWN0
IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9z
dGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3Qg
ZHJtX2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWljX2dldF9icmlkZ2Vfc3RhdGUoc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICAgIHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
Cit7CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpvYmpfc3RhdGU7CisKKwlvYmpfc3RhdGUg
PSBkcm1fYXRvbWljX2dldF9wcml2YXRlX29ial9zdGF0ZShzdGF0ZSwgJmJyaWRnZS0+YmFzZSk7
CisJaWYgKCFvYmpfc3RhdGUpCisJCXJldHVybiBOVUxMOworCisJcmV0dXJuIGRybV9wcml2X3Rv
X2JyaWRnZV9zdGF0ZShvYmpfc3RhdGUpOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBkcm1f
YnJpZGdlX3N0YXRlICoKK2RybV9hdG9taWNfZ2V0X29sZF9icmlkZ2Vfc3RhdGUoc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCXN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7
CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpvYmpfc3RhdGU7CisKKwlvYmpfc3RhdGUgPSBk
cm1fYXRvbWljX2dldF9vbGRfcHJpdmF0ZV9vYmpfc3RhdGUoc3RhdGUsICZicmlkZ2UtPmJhc2Up
OworCWlmICghb2JqX3N0YXRlKQorCQlyZXR1cm4gTlVMTDsKKworCXJldHVybiBkcm1fcHJpdl90
b19icmlkZ2Vfc3RhdGUob2JqX3N0YXRlKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgZHJt
X2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWljX2dldF9uZXdfYnJpZGdlX3N0YXRlKHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQor
eworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAqb2JqX3N0YXRlOworCisJb2JqX3N0YXRlID0g
ZHJtX2F0b21pY19nZXRfbmV3X3ByaXZhdGVfb2JqX3N0YXRlKHN0YXRlLCAmYnJpZGdlLT5iYXNl
KTsKKwlpZiAoIW9ial9zdGF0ZSkKKwkJcmV0dXJuIE5VTEw7CisKKwlyZXR1cm4gZHJtX3ByaXZf
dG9fYnJpZGdlX3N0YXRlKG9ial9zdGF0ZSk7Cit9CisKICNpZmRlZiBDT05GSUdfRFJNX1BBTkVM
X0JSSURHRQogc3RydWN0IGRybV9icmlkZ2UgKmRybV9wYW5lbF9icmlkZ2VfYWRkKHN0cnVjdCBk
cm1fcGFuZWwgKnBhbmVsKTsKIHN0cnVjdCBkcm1fYnJpZGdlICpkcm1fcGFuZWxfYnJpZGdlX2Fk
ZF90eXBlZChzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbCwKLS0gCjIuMjEuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
