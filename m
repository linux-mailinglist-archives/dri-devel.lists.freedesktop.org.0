Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D92C380A5
	for <lists+dri-devel@lfdr.de>; Fri,  7 Jun 2019 00:28:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E190389A44;
	Thu,  6 Jun 2019 22:28:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 888C589A34
 for <dri-devel@lists.freedesktop.org>; Thu,  6 Jun 2019 22:28:13 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id k8so3461037edr.11
 for <dri-devel@lists.freedesktop.org>; Thu, 06 Jun 2019 15:28:13 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=SAiiI6VzkaAeDYl1tw4fgVAOH4SmvYxgGwYm8RdcpiY=;
 b=cCgM+WyVZgU0vGLXY2CwfiSGwVt3jocf0A3VhyX6kyfUtbn6gQvlZj7uf8c8+WYOQd
 evI7EyWjHZv0A4xbb484M0ppNNB2KNJZcyqL5ErEyoKHvZ6B+jLRXNRUbUNrLtGfIEIr
 rKTJ5wrt0LWyy3rZXepsq0kCBRngi5NaHW3ZvY1pirKZI2iIQ3rWBulKu95uZdmiFPkY
 c47mmpZkkN5kWZt02Xfn86+tATw0YwbUSv+W77YI4zoT7BpNDt9E5Cybg/5ueVKvUyD5
 +dAWK32m8cTGqV2XkrroglXz9+9HdQcYEieNZ4rCN/PDk0KQqpKcBXvfkcm2vktzGYs3
 4Dqw==
X-Gm-Message-State: APjAAAV8pubeoSuql8tpz0dHLBjEpQ68aRGuoT2ADHwTA1vgddZ+QY/4
 QlWVx8kJhkAeKPt+avz3t1H8ZulmZIE=
X-Google-Smtp-Source: APXvYqxHNk2JTdfioKKSUuyPiNtWE/jv43ZBBcB3JNfIREvMhKkso8QEPbTm3pOv/fso8Qx5yb0pTg==
X-Received: by 2002:a17:906:1f55:: with SMTP id
 d21mr42757738ejk.87.1559860091740; 
 Thu, 06 Jun 2019 15:28:11 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id z10sm54228edl.35.2019.06.06.15.28.10
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 06 Jun 2019 15:28:10 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 09/10] drm/vkms: totally reworked crc data tracking
Date: Fri,  7 Jun 2019 00:27:50 +0200
Message-Id: <20190606222751.32567-10-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190606222751.32567-1-daniel.vetter@ffwll.ch>
References: <20190606222751.32567-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=SAiiI6VzkaAeDYl1tw4fgVAOH4SmvYxgGwYm8RdcpiY=;
 b=NngFIKOe+Kxi3Xi4NvzfKDuu36KAUR132mgkidS/r2/VFZND4ilEaTcoCF0ddpB4yD
 wnfIw6qyF13p3d0gJcDzUkLsLruhUobwhrOlntd3Q4vG8s0HBJtAV+rDehh+NTn9v7D3
 mf1B1h27VTRq5myU+5k1ldCyVeyC8oaHuTZhk=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 Haneen Mohammed <hamohammed.sa@gmail.com>,
 Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGNyYyBjb21wdXRhdGlvbiB3b3JrZXIgbmVlZHMgdG8gYmUgYWJsZSB0byBnZXQgYXQgc29t
ZSBkYXRhCnN0cnVjdHVyZXMgYW5kIGZyYW1lYnVmZmVyIG1hcHBpbmdzLCB3aGlsZSBwb3RlbnRp
YWxseSBtb3JlIGF0b21pYwp1cGRhdGVzIGFyZSBnb2luZyBvbi4gVGhlIHNvbHV0aW9uIHRodXMg
ZmFyIGlzIHRvIGNvcHkgcmVsZXZhbnQgYml0cwphcm91bmQsIGJ1dCB0aGF0J3MgdmVyeSB0ZWRp
b3VzLgoKSGVyZSdzIGEgbmV3IGFwcHJvYWNoLCB3aGljaCB0cmllcyB0byBiZSBtb3JlIGNsZXZl
ciwgYnV0IHJlbGllcyBvbiBhCmZldyBub3Qtc28tb2J2aW91cyB0aGluZ3M6Ci0gY3J0Y19zdGF0
ZSBpcyBhbHdheXMgdXBkYXRlZCB3aGVuIGEgcGxhbmVfc3RhdGUgY2hhbmdlcy4gVGhlcmVmb3Jl
CiAgd2UgY2FuIGp1c3Qgc3R1ZmYgcGxhbmVfc3RhdGUgcG9pbnRlcnMgaW50byBhIGNydGNfc3Rh
dGUuIFRoYXQKICBzb2x2ZXMgdGhlIHByb2JsZW0gb2YgZWFzaWx5IGdldHRpbmcgYXQgdGhlIG5l
ZWRlZCBwbGFuZV9zdGF0ZXMuCi0gd2l0aCB0aGUgZmx1c2hpbmcgY2hhbmdlcyBmcm9tIHByZXZp
b3VzIHBhdGNoZXMgdGhlIGFib3ZlIGFsc28gaG9sZHMKICB3aXRob3V0IHJhY2VzIGR1ZSB0byB0
aGUgbmV4dCBhdG9taWMgdXBkYXRlIGJlaW5nIGEgYml0IGVhZ2VyIHdpdGgKICBjbGVhbmluZyB1
cCBwZW5kaW5nIHdvcmsgLSB3ZSBhbHdheXMgd2FpdCBmb3IgYWxsIGNyYyB3b3JrIGl0ZW1zIHRv
CiAgY29tcGxldGUgYmVmb3JlIHVubWFwcGluZyBmcmFtZWJ1ZmZlcnMuCi0gd2UgYWxzbyBuZWVk
IHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBocnRpbWVyIGZpcmVzIG9mZiB0aGUgcmlnaHQKICB3b3Jr
ZXIuIEtlZXAgYSBuZXcgZGlzdGluY3QgY3JjX3N0YXRlIHBvaW50ZXIsIHVuZGVyIHRoZQogIHZr
bXNfb3V0cHV0LT5sb2NrIHByb3RlY3Rpb24gZm9yIHRoaXMuIE5vdGUgdGhhdCBjcnRjLT5zdGF0
ZSBpcwogIHVwZGF0ZWQgdmVyeSBlYXJseSBpbiB0aGUgYXRvbWljIGNvbW1pdCwgd2F5IGJlZm9y
ZSB3ZSBhcm0gdGhlCiAgdmJsYW5rIGV2ZW50IC0gdGhlIHZibGFuayBldmVudCBzaG91bGQgYWx3
YXlzIG1hdGNoIHRoZSBidWZmZXJzIHdlCiAgdXNlIHRvIGNvbXB1dGUgdGhlIGNyYy4gVGhpcyBh
bHNvIHNvbHZlcyBhbiBpc3N1ZSBpbiB0aGUgaHJ0aW1lciwKICB3aGVyZSB3ZSd2ZSBhY2Nlc3Nl
ZCBkcm1fY3J0Yy0+c3RhdGUgd2l0aG91dCBob2xkaW5nIHRoZSByaWdodCBsb2NrcwogICh3ZSBo
ZWxkIG5vbmUgLSBvb3BzKS4KLSBpbiB0aGUgd29ya2VyIGl0c2VsZiB3ZSBjYW4gdGhlbiBqdXN0
IGFjY2VzcyB0aGUgcGxhbmUgc3RhdGVzIHdlCiAgbmVlZCwgYWdhaW4gc29sdmluZyBhIGJ1bmNo
IG9mIG9yZGVyaW5nIGFuZCBsb2NraW5nIGlzc3Vlcy4KICBBY2Nlc3NpbmcgcGxhbmUtPnN0YXRl
IHJlcXVpcmVzIGxvY2tzLCBhY2Nlc3NpbmcgdGhlIHByaXZhdGUKICB2a21zX2NydGNfc3RhdGUt
PmFjdGl2ZV9wbGFuZXMgcG9pbnRlciBvbmx5IHJlcXVpcmVzIHRoYXQgdGhlIG1lbW9yeQogIGRv
ZXNuJ3QgZ2V0IGZyZWVkIHRvbyBlYXJseS4KClRoZSBpZGVhIGJlaGluZCB2a21zX2NydGNfc3Rh
dGUtPmFjdGl2ZV9wbGFuZXMgaXMgdGhhdCB0aGlzIHdvdWxkCmNvbnRhaW4gYWxsIHZpc2libGUg
cGxhbmVzLCBpbiB6LW9yZGVyLCBhcyBhIGZpcnN0IHN0ZXAgdG93YXJkcyBhIG1vcmUKZ2VuZXJp
YyBibGVuZGluZyBpbXBsZW1lbnRhdGlvbi4KCk5vdGUgdGhhdCB0aGlzIHBhdGNoIGFsc28gZml4
ZXMgcmFjZXMgYmV0d2VlbiBwcmVwYXJlX2ZiL2NsZWFudXBfZmIKYW5kIHRoZSBjcmMgd29ya2Vy
IGFjY2Vzc2luZyAtPnZhZGRyLgoKU2lnbmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVs
LnZldHRlckBpbnRlbC5jb20+CkNjOiBSb2RyaWdvIFNpcXVlaXJhIDxyb2RyaWdvc2lxdWVpcmFt
ZWxvQGdtYWlsLmNvbT4KQ2M6IEhhbmVlbiBNb2hhbW1lZCA8aGFtb2hhbW1lZC5zYUBnbWFpbC5j
b20+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL3ZrbXMvdmttc19jcmMuYyAgfCAyMSArKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3Zr
bXMvdmttc19jcnRjLmMgfCA2MCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQogZHJp
dmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaCAgfCAgOSArKysrLQogMyBmaWxlcyBjaGFuZ2Vk
LCA2NyBpbnNlcnRpb25zKCspLCAyMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vdmttcy92a21zX2NyYy5jIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcmMu
YwppbmRleCA5ZDE1ZTVlODU4MzAuLjBkMzFjZmMzMjA0MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3ZrbXMvdmttc19jcmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Ny
Yy5jCkBAIC0xNTksMTEgKzE1OSw4IEBAIHZvaWQgdmttc19jcmNfd29ya19oYW5kbGUoc3RydWN0
IHdvcmtfc3RydWN0ICp3b3JrKQogCQkJCQkJY3JjX3dvcmspOwogCXN0cnVjdCBkcm1fY3J0YyAq
Y3J0YyA9IGNydGNfc3RhdGUtPmJhc2UuY3J0YzsKIAlzdHJ1Y3Qgdmttc19vdXRwdXQgKm91dCA9
IGRybV9jcnRjX3RvX3ZrbXNfb3V0cHV0KGNydGMpOwotCXN0cnVjdCB2a21zX2RldmljZSAqdmRl
diA9IGNvbnRhaW5lcl9vZihvdXQsIHN0cnVjdCB2a21zX2RldmljZSwKLQkJCQkJCW91dHB1dCk7
CiAJc3RydWN0IHZrbXNfY3JjX2RhdGEgKnByaW1hcnlfY3JjID0gTlVMTDsKIAlzdHJ1Y3Qgdmtt
c19jcmNfZGF0YSAqY3Vyc29yX2NyYyA9IE5VTEw7Ci0Jc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7
CiAJdTMyIGNyYzMyID0gMDsKIAl1NjQgZnJhbWVfc3RhcnQsIGZyYW1lX2VuZDsKIAlib29sIGNy
Y19wZW5kaW5nOwpAQCAtMTg0LDIxICsxODEsMTEgQEAgdm9pZCB2a21zX2NyY193b3JrX2hhbmRs
ZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJaWYgKCFjcmNfcGVuZGluZykKIAkJcmV0dXJu
OwogCi0JZHJtX2Zvcl9lYWNoX3BsYW5lKHBsYW5lLCAmdmRldi0+ZHJtKSB7Ci0JCXN0cnVjdCB2
a21zX3BsYW5lX3N0YXRlICp2cGxhbmVfc3RhdGU7Ci0JCXN0cnVjdCB2a21zX2NyY19kYXRhICpj
cmNfZGF0YTsKKwlpZiAoY3J0Y19zdGF0ZS0+bnVtX2FjdGl2ZV9wbGFuZXMgPj0gMSkKKwkJcHJp
bWFyeV9jcmMgPSBjcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzWzBdLT5jcmNfZGF0YTsKIAotCQl2
cGxhbmVfc3RhdGUgPSB0b192a21zX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0ZSk7Ci0JCWNyY19k
YXRhID0gdnBsYW5lX3N0YXRlLT5jcmNfZGF0YTsKLQotCQlpZiAoZHJtX2ZyYW1lYnVmZmVyX3Jl
YWRfcmVmY291bnQoJmNyY19kYXRhLT5mYikgPT0gMCkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChw
bGFuZS0+dHlwZSA9PSBEUk1fUExBTkVfVFlQRV9QUklNQVJZKQotCQkJcHJpbWFyeV9jcmMgPSBj
cmNfZGF0YTsKLQkJZWxzZQotCQkJY3Vyc29yX2NyYyA9IGNyY19kYXRhOwotCX0KKwlpZiAoY3J0
Y19zdGF0ZS0+bnVtX2FjdGl2ZV9wbGFuZXMgPT0gMikKKwkJY3Vyc29yX2NyYyA9IGNydGNfc3Rh
dGUtPmFjdGl2ZV9wbGFuZXNbMV0tPmNyY19kYXRhOwogCiAJaWYgKHByaW1hcnlfY3JjKQogCQlj
cmMzMiA9IF92a21zX2dldF9jcmMocHJpbWFyeV9jcmMsIGN1cnNvcl9jcmMpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmtt
cy92a21zX2NydGMuYwppbmRleCA0OGE3OTNiYTQwMzAuLjE0MTU2ZWQ3MDQxNSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcnRjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3ZrbXMvdmttc19jcnRjLmMKQEAgLTEsNiArMSw3IEBACiAvLyBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMCsKIAogI2luY2x1ZGUgInZrbXNfZHJ2LmgiCisjaW5jbHVkZSA8ZHJtL2Ry
bV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgogCkBAIC05LDcgKzEwLDcgQEAgc3RhdGljIGVudW0g
aHJ0aW1lcl9yZXN0YXJ0IHZrbXNfdmJsYW5rX3NpbXVsYXRlKHN0cnVjdCBocnRpbWVyICp0aW1l
cikKIAlzdHJ1Y3Qgdmttc19vdXRwdXQgKm91dHB1dCA9IGNvbnRhaW5lcl9vZih0aW1lciwgc3Ry
dWN0IHZrbXNfb3V0cHV0LAogCQkJCQkJICB2YmxhbmtfaHJ0aW1lcik7CiAJc3RydWN0IGRybV9j
cnRjICpjcnRjID0gJm91dHB1dC0+Y3J0YzsKLQlzdHJ1Y3Qgdmttc19jcnRjX3N0YXRlICpzdGF0
ZSA9IHRvX3ZrbXNfY3J0Y19zdGF0ZShjcnRjLT5zdGF0ZSk7CisJc3RydWN0IHZrbXNfY3J0Y19z
dGF0ZSAqc3RhdGU7CiAJdTY0IHJldF9vdmVycnVuOwogCWJvb2wgcmV0OwogCkBAIC0yMyw2ICsy
NCw3IEBAIHN0YXRpYyBlbnVtIGhydGltZXJfcmVzdGFydCB2a21zX3ZibGFua19zaW11bGF0ZShz
dHJ1Y3QgaHJ0aW1lciAqdGltZXIpCiAJaWYgKCFyZXQpCiAJCURSTV9FUlJPUigidmttcyBmYWls
dXJlIG9uIGhhbmRsaW5nIHZibGFuayIpOwogCisJc3RhdGUgPSBvdXRwdXQtPmNyY19zdGF0ZTsK
IAlpZiAoc3RhdGUgJiYgb3V0cHV0LT5jcmNfZW5hYmxlZCkgewogCQl1NjQgZnJhbWUgPSBkcm1f
Y3J0Y19hY2N1cmF0ZV92YmxhbmtfY291bnQoY3J0Yyk7CiAKQEAgLTEyNCwxMCArMTI2LDkgQEAg
c3RhdGljIHZvaWQgdmttc19hdG9taWNfY3J0Y19kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIAogCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRlKHN0YXRl
KTsKIAotCWlmICh2a21zX3N0YXRlKSB7Ci0JCVdBUk5fT04od29ya19wZW5kaW5nKCZ2a21zX3N0
YXRlLT5jcmNfd29yaykpOwotCQlrZnJlZSh2a21zX3N0YXRlKTsKLQl9CisJV0FSTl9PTih3b3Jr
X3BlbmRpbmcoJnZrbXNfc3RhdGUtPmNyY193b3JrKSk7CisJa2ZyZWUodmttc19zdGF0ZS0+YWN0
aXZlX3BsYW5lcyk7CisJa2ZyZWUodmttc19zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIHZrbXNf
YXRvbWljX2NydGNfcmVzZXQoc3RydWN0IGRybV9jcnRjICpjcnRjKQpAQCAtMTU2LDYgKzE1Nyw1
MiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIHZrbXNfY3J0Y19mdW5jcyA9
IHsKIAkudmVyaWZ5X2NyY19zb3VyY2UJPSB2a21zX3ZlcmlmeV9jcmNfc291cmNlLAogfTsKIAor
c3RhdGljIGludCB2a21zX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
KwkJCQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCB2a21zX2Ny
dGNfc3RhdGUgKnZrbXNfc3RhdGUgPSB0b192a21zX2NydGNfc3RhdGUoc3RhdGUpOworCXN0cnVj
dCBkcm1fcGxhbmUgKnBsYW5lOworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
OworCWludCBpID0gMCwgcmV0OworCisJaWYgKHZrbXNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMpCisJ
CXJldHVybiAwOworCisJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0YXRl
LT5zdGF0ZSwgY3J0Yyk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlkcm1fZm9y
X2VhY2hfcGxhbmVfbWFzayhwbGFuZSwgY3J0Yy0+ZGV2LCBzdGF0ZS0+cGxhbmVfbWFzaykgewor
CQlwbGFuZV9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2V4aXN0aW5nX3BsYW5lX3N0YXRlKHN0YXRl
LT5zdGF0ZSwKKwkJCQkJCQkJICBwbGFuZSk7CisJCVdBUk5fT04oIXBsYW5lX3N0YXRlKTsKKwor
CQlpZiAoIXBsYW5lX3N0YXRlLT52aXNpYmxlKQorCQkJY29udGludWU7CisKKwkJaSsrOworCX0K
KworCXZrbXNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgPSBrY2FsbG9jKGksIHNpemVvZihwbGFuZSks
IEdGUF9LRVJORUwpOworCWlmICghdmttc19zdGF0ZS0+YWN0aXZlX3BsYW5lcykKKwkJcmV0dXJu
IC1FTk9NRU07CisJdmttc19zdGF0ZS0+bnVtX2FjdGl2ZV9wbGFuZXMgPSBpOworCisJaSA9IDA7
CisJZHJtX2Zvcl9lYWNoX3BsYW5lX21hc2socGxhbmUsIGNydGMtPmRldiwgc3RhdGUtPnBsYW5l
X21hc2spIHsKKwkJcGxhbmVfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9leGlzdGluZ19wbGFuZV9z
dGF0ZShzdGF0ZS0+c3RhdGUsCisJCQkJCQkJCSAgcGxhbmUpOworCisJCWlmICghcGxhbmVfc3Rh
dGUtPnZpc2libGUpCisJCQljb250aW51ZTsKKworCQl2a21zX3N0YXRlLT5hY3RpdmVfcGxhbmVz
W2krK10gPQorCQkJdG9fdmttc19wbGFuZV9zdGF0ZShwbGFuZV9zdGF0ZSk7CisJfQorCisJcmV0
dXJuIDA7Cit9CisKIHN0YXRpYyB2b2lkIHZrbXNfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBk
cm1fY3J0YyAqY3J0YywKIAkJCQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3RhdGUp
CiB7CkBAIC0xOTcsMTAgKzI0NCwxMyBAQCBzdGF0aWMgdm9pZCB2a21zX2NydGNfYXRvbWljX2Zs
dXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsK
IAl9CiAKKwl2a21zX291dHB1dC0+Y3JjX3N0YXRlID0gdG9fdmttc19jcnRjX3N0YXRlKGNydGMt
PnN0YXRlKTsKKwogCXNwaW5fdW5sb2NrX2lycSgmdmttc19vdXRwdXQtPmxvY2spOwogfQogCiBz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2hlbHBlcl9mdW5jcyB2a21zX2NydGNfaGVscGVy
X2Z1bmNzID0geworCS5hdG9taWNfY2hlY2sJPSB2a21zX2NydGNfYXRvbWljX2NoZWNrLAogCS5h
dG9taWNfYmVnaW4JPSB2a21zX2NydGNfYXRvbWljX2JlZ2luLAogCS5hdG9taWNfZmx1c2gJPSB2
a21zX2NydGNfYXRvbWljX2ZsdXNoLAogCS5hdG9taWNfZW5hYmxlCT0gdmttc19jcnRjX2F0b21p
Y19lbmFibGUsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Rydi5oIGIv
ZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaAppbmRleCAyYTM1Mjk5YmZiODkuLjRlNzQ1
MDExMWQ0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Rydi5oCkBAIC00OSw2ICs0OSwxMCBAQCBzdHJ1
Y3Qgdmttc19jcnRjX3N0YXRlIHsKIAlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgYmFzZTsKIAlzdHJ1
Y3Qgd29ya19zdHJ1Y3QgY3JjX3dvcms7CiAKKwlpbnQgbnVtX2FjdGl2ZV9wbGFuZXM7CisJLyog
c3RhY2sgb2YgYWN0aXZlIHBsYW5lcyBmb3IgY3JjIGNvbXB1dGF0aW9uLCBzaG91bGQgYmUgaW4g
eiBvcmRlciAqLworCXN0cnVjdCB2a21zX3BsYW5lX3N0YXRlICoqYWN0aXZlX3BsYW5lczsKKwog
CS8qIGJlbG93IHRocmVlIGFyZSBwcm90ZWN0ZWQgYnkgdmttc19vdXRwdXQuY3JjX2xvY2sgKi8K
IAlib29sIGNyY19wZW5kaW5nOwogCXU2NCBmcmFtZV9zdGFydDsKQEAgLTYyLDEyICs2NiwxNSBA
QCBzdHJ1Y3Qgdmttc19vdXRwdXQgewogCXN0cnVjdCBocnRpbWVyIHZibGFua19ocnRpbWVyOwog
CWt0aW1lX3QgcGVyaW9kX25zOwogCXN0cnVjdCBkcm1fcGVuZGluZ192YmxhbmtfZXZlbnQgKmV2
ZW50OwotCWJvb2wgY3JjX2VuYWJsZWQ7CiAJLyogb3JkZXJlZCB3cSBmb3IgY3JjX3dvcmsgKi8K
IAlzdHJ1Y3Qgd29ya3F1ZXVlX3N0cnVjdCAqY3JjX3dvcmtxOwogCS8qIHByb3RlY3RzIGNvbmN1
cnJlbnQgYWNjZXNzIHRvIGNyY19kYXRhICovCiAJc3BpbmxvY2tfdCBsb2NrOwogCisJLyogcHJv
dGVjdGVkIGJ5IEBsb2NrICovCisJYm9vbCBjcmNfZW5hYmxlZDsKKwlzdHJ1Y3Qgdmttc19jcnRj
X3N0YXRlICpjcmNfc3RhdGU7CisKIAlzcGlubG9ja190IGNyY19sb2NrOwogfTsKIAotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
