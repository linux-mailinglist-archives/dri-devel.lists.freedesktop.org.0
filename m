Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8777795324
	for <lists+dri-devel@lfdr.de>; Tue, 20 Aug 2019 03:18:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 35EE26E57E;
	Tue, 20 Aug 2019 01:18:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [IPv6:2001:4b98:dc2:55:216:3eff:fef7:d647])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F31BB6E520
 for <dri-devel@lists.freedesktop.org>; Tue, 20 Aug 2019 01:18:01 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id EF77C11BF;
 Tue, 20 Aug 2019 03:17:54 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 33/50] drm/omap: venc: Register a drm_bridge
Date: Tue, 20 Aug 2019 04:17:04 +0300
Message-Id: <20190820011721.30136-34-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
References: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1566263875;
 bh=M/G8F8BCLE4/28rJ49tSowZJbgtl1d7Fz1xyV5s+haI=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=DeKNqjEx4fbB3MnKCmQlmSKxmAvMrRyxeh858XpW/txKROzXxQwCngDen1KsZhcD6
 cJ0PH7ZPHb2b+lkt9dN96n2wWxGjqniB0pfCdeYlnaj7bB5sQmYIrUVi7DRbeEqakm
 Zw0YbR4TTyG1cLlG3WCiy/5SKHr6kSPm+bzQnxGc=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>,
 Sebastian Reichel <sebastian.reichel@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW4gb3JkZXIgdG8gaW50ZWdyYXRlIHdpdGggYSBjaGFpbiBvZiBkcm1fYnJpZGdlLCB0aGUgaW50
ZXJuYWwgVkVOQwplbmNvZGVyIGhhcyB0byBleHBvc2UgdGhlIG1vZGUgdmFsaWQsIGZpeHVwIGFu
ZCBzZXQsIHRoZSBlbmFibGUgYW5kCmRpc2FibGUgYW5kIHRoZSBnZXQgbW9kZXMgb3BlcmF0aW9u
cyB0aHJvdWdoIHRoZSBkcm1fYnJpZGdlIEFQSS4KUmVnaXN0ZXIgYSBicmlkZ2UgYXQgaW5pdGlh
bGlzYXRpb24gdGltZSB0byBkbyBzby4KCk1vc3Qgb2YgdGhvc2Ugb3BlcmF0aW9ucyBhcmUgcmVt
b3ZlZCBmcm9tIHRoZSBvbWFwX2Rzc19kZXZpY2UgYXMgdGhleQphcmUgbm93IGNhbGxlZCB0aHJv
dWdoIHRoZSBkcm1fYnJpZGdlIEFQSSBieSB0aGUgRFJNIGF0b21pYyBoZWxwZXJzLiBUaGUKb25s
eSBleGNlcHRpb24gaXMgdGhlIC5nZXRfbW9kZXMoKSBvcGVyYXRpb24gdGhhdCBpcyBzdGlsbCBp
bnZva2VkCnRocm91Z2ggdGhlIG9tYXBfZHNzX2RldmljZS1iYXNlZCBwaXBlbGluZS4KCkZvciB0
aGUgdGltZSBiZWluZyBtYWtlIHRoZSBuZXh0IGJyaWRnZSBpbiB0aGUgY2hhaW4gb3B0aW9uYWwg
YXMgdGhlClZFTkMgb3V0cHV0IGlzIHN0aWxsIGJhc2VkIG9uIG9tYXBfZHNzX2RldmljZS4gVGhl
IGNyZWF0ZV9jb25uZWN0b3IKYXJndW1lbnQgdG8gdGhlIGJyaWRnZSBhdHRhY2ggZnVuY3Rpb24g
aXMgYWxzbyBpZ25vcmVkIGZvciB0aGUgc2FtZQpyZWFzb24uIFRoaXMgd2lsbCBiZSBjaGFuZ2Vk
IGxhdGVyIHdoZW4gcmVtb3ZpbmcgdGhlIHJlbGF0ZWQKb21hcGRybS1zcGVjaWZpYyBkaXNwbGF5
IGRyaXZlcnMuCgpTaWduZWQtb2ZmLWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNo
YXJ0QGlkZWFzb25ib2FyZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL3Zl
bmMuYyB8IDI0NSArKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQs
IDE2MSBpbnNlcnRpb25zKCspLCA4NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vb21hcGRybS9kc3MvdmVuYy5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNz
L3ZlbmMuYwppbmRleCA5NzdkOGQ1MjViNDMuLjQ2ZTMzMzQ0MmQ1YSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL3ZlbmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vb21h
cGRybS9kc3MvdmVuYy5jCkBAIC0yNiw2ICsyNiw4IEBACiAjaW5jbHVkZSA8bGludXgvY29tcG9u
ZW50Lmg+CiAjaW5jbHVkZSA8bGludXgvc3lzX3NvYy5oPgogCisjaW5jbHVkZSA8ZHJtL2RybV9i
cmlkZ2UuaD4KKwogI2luY2x1ZGUgIm9tYXBkc3MuaCIKICNpbmNsdWRlICJkc3MuaCIKIApAQCAt
MzAzLDkgKzMwNSwxMSBAQCBzdHJ1Y3QgdmVuY19kZXZpY2UgewogCWJvb2wgcmVxdWlyZXNfdHZf
ZGFjX2NsazsKIAogCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2Ugb3V0cHV0OworCXN0cnVjdCBkcm1f
YnJpZGdlIGJyaWRnZTsKIH07CiAKICNkZWZpbmUgZHNzZGV2X3RvX3ZlbmMoZHNzZGV2KSBjb250
YWluZXJfb2YoZHNzZGV2LCBzdHJ1Y3QgdmVuY19kZXZpY2UsIG91dHB1dCkKKyNkZWZpbmUgZHJt
X2JyaWRnZV90b192ZW5jKGIpIGNvbnRhaW5lcl9vZihiLCBzdHJ1Y3QgdmVuY19kZXZpY2UsIGJy
aWRnZSkKIAogc3RhdGljIGlubGluZSB2b2lkIHZlbmNfd3JpdGVfcmVnKHN0cnVjdCB2ZW5jX2Rl
dmljZSAqdmVuYywgaW50IGlkeCwgdTMyIHZhbCkKIHsKQEAgLTQ3NywzMiArNDgxLDYgQEAgc3Rh
dGljIHZvaWQgdmVuY19wb3dlcl9vZmYoc3RydWN0IHZlbmNfZGV2aWNlICp2ZW5jKQogCXZlbmNf
cnVudGltZV9wdXQodmVuYyk7CiB9CiAKLXN0YXRpYyB2b2lkIHZlbmNfZGlzcGxheV9lbmFibGUo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQotewotCXN0cnVjdCB2ZW5jX2RldmljZSAq
dmVuYyA9IGRzc2Rldl90b192ZW5jKGRzc2Rldik7Ci0KLQlEU1NEQkcoInZlbmNfZGlzcGxheV9l
bmFibGVcbiIpOwotCi0JbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2NrKTsKLQotCXZlbmNfcG93
ZXJfb24odmVuYyk7Ci0KLQltdXRleF91bmxvY2soJnZlbmMtPnZlbmNfbG9jayk7Ci19Ci0KLXN0
YXRpYyB2b2lkIHZlbmNfZGlzcGxheV9kaXNhYmxlKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRz
c2RldikKLXsKLQlzdHJ1Y3QgdmVuY19kZXZpY2UgKnZlbmMgPSBkc3NkZXZfdG9fdmVuYyhkc3Nk
ZXYpOwotCi0JRFNTREJHKCJ2ZW5jX2Rpc3BsYXlfZGlzYWJsZVxuIik7Ci0KLQltdXRleF9sb2Nr
KCZ2ZW5jLT52ZW5jX2xvY2spOwotCi0JdmVuY19wb3dlcl9vZmYodmVuYyk7Ci0KLQltdXRleF91
bmxvY2soJnZlbmMtPnZlbmNfbG9jayk7Ci19Ci0KIHN0YXRpYyBpbnQgdmVuY19nZXRfbW9kZXMo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LAogCQkJICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQogewpAQCAtNTQ1LDU3ICs1MjMsNiBAQCBzdGF0aWMgZW51bSB2ZW5jX3Zp
ZGVvbW9kZSB2ZW5jX2dldF92aWRlb21vZGUoY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZAogCXJldHVybiBWRU5DX01PREVfVU5LTk9XTjsKIH0KIAotc3RhdGljIHZvaWQgdmVuY19z
ZXRfdGltaW5ncyhzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCi0JCQkgICAgIGNvbnN0
IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlKQotewotCXN0cnVjdCB2ZW5jX2RldmljZSAq
dmVuYyA9IGRzc2Rldl90b192ZW5jKGRzc2Rldik7Ci0JZW51bSB2ZW5jX3ZpZGVvbW9kZSB2ZW5j
X21vZGUgPSB2ZW5jX2dldF92aWRlb21vZGUobW9kZSk7Ci0KLQlEU1NEQkcoInZlbmNfc2V0X3Rp
bWluZ3NcbiIpOwotCi0JbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2NrKTsKLQotCXN3aXRjaCAo
dmVuY19tb2RlKSB7Ci0JZGVmYXVsdDoKLQkJV0FSTl9PTl9PTkNFKDEpOwotCQkvKiBGYWxsLXRo
cm91Z2ggKi8KLQljYXNlIFZFTkNfTU9ERV9QQUw6Ci0JCXZlbmMtPmNvbmZpZyA9ICZ2ZW5jX2Nv
bmZpZ19wYWxfdHJtOwotCQlicmVhazsKLQotCWNhc2UgVkVOQ19NT0RFX05UU0M6Ci0JCXZlbmMt
PmNvbmZpZyA9ICZ2ZW5jX2NvbmZpZ19udHNjX3RybTsKLQkJYnJlYWs7Ci0JfQotCi0JZGlzcGNf
c2V0X3R2X3BjbGsodmVuYy0+ZHNzLT5kaXNwYywgMTM1MDAwMDApOwotCi0JbXV0ZXhfdW5sb2Nr
KCZ2ZW5jLT52ZW5jX2xvY2spOwotfQotCi1zdGF0aWMgaW50IHZlbmNfY2hlY2tfdGltaW5ncyhz
dHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCi0JCQkgICAgICBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZSkKLXsKLQlEU1NEQkcoInZlbmNfY2hlY2tfdGltaW5nc1xuIik7Ci0KLQlz
d2l0Y2ggKHZlbmNfZ2V0X3ZpZGVvbW9kZShtb2RlKSkgewotCWNhc2UgVkVOQ19NT0RFX1BBTDoK
LQkJZHJtX21vZGVfY29weShtb2RlLCAmb21hcF9kc3NfcGFsX21vZGUpOwotCQlicmVhazsKLQot
CWNhc2UgVkVOQ19NT0RFX05UU0M6Ci0JCWRybV9tb2RlX2NvcHkobW9kZSwgJm9tYXBfZHNzX250
c2NfbW9kZSk7Ci0JCWJyZWFrOwotCi0JZGVmYXVsdDoKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQot
Ci0JZHJtX21vZGVfc2V0X2NydGNpbmZvKG1vZGUsIENSVENfSU5URVJMQUNFX0hBTFZFX1YpOwot
CWRybV9tb2RlX3NldF9uYW1lKG1vZGUpOwotCXJldHVybiAwOwotfQotCiBzdGF0aWMgaW50IHZl
bmNfZHVtcF9yZWdzKHN0cnVjdCBzZXFfZmlsZSAqcywgdm9pZCAqcCkKIHsKIAlzdHJ1Y3QgdmVu
Y19kZXZpY2UgKnZlbmMgPSBzLT5wcml2YXRlOwpAQCAtNjg5LDE1ICs2MTYsMTYxIEBAIHN0YXRp
YyBjb25zdCBzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlX29wcyB2ZW5jX29wcyA9IHsKIAkuY29ubmVj
dCA9IHZlbmNfY29ubmVjdCwKIAkuZGlzY29ubmVjdCA9IHZlbmNfZGlzY29ubmVjdCwKIAotCS5l
bmFibGUgPSB2ZW5jX2Rpc3BsYXlfZW5hYmxlLAotCS5kaXNhYmxlID0gdmVuY19kaXNwbGF5X2Rp
c2FibGUsCi0KLQkuY2hlY2tfdGltaW5ncyA9IHZlbmNfY2hlY2tfdGltaW5ncywKLQkuc2V0X3Rp
bWluZ3MgPSB2ZW5jX3NldF90aW1pbmdzLAotCiAJLmdldF9tb2RlcyA9IHZlbmNfZ2V0X21vZGVz
LAogfTsKIAorLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIERSTSBCcmlkZ2UgT3BlcmF0aW9u
cworICovCisKK3N0YXRpYyBpbnQgdmVuY19icmlkZ2VfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsCisJCQkgICAgICBlbnVtIGRybV9icmlkZ2VfYXR0YWNoX2ZsYWdzIGZsYWdzKQor
eworCXN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYyA9IGRybV9icmlkZ2VfdG9fdmVuYyhicmlkZ2Up
OworCisJaWYgKHZlbmMtPm91dHB1dC5uZXh0X2JyaWRnZSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1
cm4gZHJtX2JyaWRnZV9hdHRhY2goYnJpZGdlLT5lbmNvZGVyLCB2ZW5jLT5vdXRwdXQubmV4dF9i
cmlkZ2UsCisJCQkJIGJyaWRnZSwgZmxhZ3MpOworfQorCitzdGF0aWMgZW51bSBkcm1fbW9kZV9z
dGF0dXMKK3ZlbmNfYnJpZGdlX21vZGVfdmFsaWQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwK
KwkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlKQoreworCXN3aXRj
aCAodmVuY19nZXRfdmlkZW9tb2RlKG1vZGUpKSB7CisJY2FzZSBWRU5DX01PREVfUEFMOgorCWNh
c2UgVkVOQ19NT0RFX05UU0M6CisJCXJldHVybiBNT0RFX09LOworCisJZGVmYXVsdDoKKwkJcmV0
dXJuIE1PREVfQkFEOworCX0KK30KKworc3RhdGljIGJvb2wgdmVuY19icmlkZ2VfbW9kZV9maXh1
cChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgIGNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICptb2RlLAorCQkJCSAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlKQoreworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICp2ZW5jX21vZGU7CisK
Kwlzd2l0Y2ggKHZlbmNfZ2V0X3ZpZGVvbW9kZShhZGp1c3RlZF9tb2RlKSkgeworCWNhc2UgVkVO
Q19NT0RFX1BBTDoKKwkJdmVuY19tb2RlID0gJm9tYXBfZHNzX3BhbF9tb2RlOworCQlicmVhazsK
KworCWNhc2UgVkVOQ19NT0RFX05UU0M6CisJCXZlbmNfbW9kZSA9ICZvbWFwX2Rzc19udHNjX21v
ZGU7CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCWRybV9t
b2RlX2NvcHkoYWRqdXN0ZWRfbW9kZSwgdmVuY19tb2RlKTsKKwlkcm1fbW9kZV9zZXRfY3J0Y2lu
Zm8oYWRqdXN0ZWRfbW9kZSwgQ1JUQ19JTlRFUkxBQ0VfSEFMVkVfVik7CisJZHJtX21vZGVfc2V0
X25hbWUoYWRqdXN0ZWRfbW9kZSk7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIHZvaWQg
dmVuY19icmlkZ2VfbW9kZV9zZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkgY29u
c3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKQoreworCXN0cnVjdCB2ZW5jX2RldmljZSAqdmVu
YyA9IGRybV9icmlkZ2VfdG9fdmVuYyhicmlkZ2UpOworCWVudW0gdmVuY192aWRlb21vZGUgdmVu
Y19tb2RlID0gdmVuY19nZXRfdmlkZW9tb2RlKGFkanVzdGVkX21vZGUpOworCisJbXV0ZXhfbG9j
aygmdmVuYy0+dmVuY19sb2NrKTsKKworCXN3aXRjaCAodmVuY19tb2RlKSB7CisJZGVmYXVsdDoK
KwkJV0FSTl9PTl9PTkNFKDEpOworCQkvKiBGYWxsLXRocm91Z2ggKi8KKwljYXNlIFZFTkNfTU9E
RV9QQUw6CisJCXZlbmMtPmNvbmZpZyA9ICZ2ZW5jX2NvbmZpZ19wYWxfdHJtOworCQlicmVhazsK
KworCWNhc2UgVkVOQ19NT0RFX05UU0M6CisJCXZlbmMtPmNvbmZpZyA9ICZ2ZW5jX2NvbmZpZ19u
dHNjX3RybTsKKwkJYnJlYWs7CisJfQorCisJZGlzcGNfc2V0X3R2X3BjbGsodmVuYy0+ZHNzLT5k
aXNwYywgMTM1MDAwMDApOworCisJbXV0ZXhfdW5sb2NrKCZ2ZW5jLT52ZW5jX2xvY2spOworfQor
CitzdGF0aWMgdm9pZCB2ZW5jX2JyaWRnZV9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IHZlbmNfZGV2aWNlICp2ZW5jID0gZHJtX2JyaWRnZV90b192ZW5jKGJyaWRnZSk7CisKKwltdXRl
eF9sb2NrKCZ2ZW5jLT52ZW5jX2xvY2spOworCXZlbmNfcG93ZXJfb24odmVuYyk7CisJbXV0ZXhf
dW5sb2NrKCZ2ZW5jLT52ZW5jX2xvY2spOworfQorCitzdGF0aWMgdm9pZCB2ZW5jX2JyaWRnZV9k
aXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYyA9IGRybV9icmlkZ2Vf
dG9fdmVuYyhicmlkZ2UpOworCisJbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2NrKTsKKwl2ZW5j
X3Bvd2VyX29mZih2ZW5jKTsKKwltdXRleF91bmxvY2soJnZlbmMtPnZlbmNfbG9jayk7Cit9CisK
K3N0YXRpYyBpbnQgdmVuY19icmlkZ2VfZ2V0X21vZGVzKHN0cnVjdCBkcm1fYnJpZGdlICpicmlk
Z2UsCisJCQkJIHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2Rlc1tdID0geworCQkmb21hcF9kc3NfcGFs
X21vZGUsCisJCSZvbWFwX2Rzc19udHNjX21vZGUsCisJfTsKKwl1bnNpZ25lZCBpbnQgaTsKKwor
CWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKG1vZGVzKTsgKytpKSB7CisJCXN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICptb2RlOworCisJCW1vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUoY29ubmVj
dG9yLT5kZXYsIG1vZGVzW2ldKTsKKwkJaWYgKCFtb2RlKQorCQkJcmV0dXJuIGk7CisKKwkJbW9k
ZS0+dHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVSIHwgRFJNX01PREVfVFlQRV9QUkVGRVJSRUQ7
CisJCWRybV9tb2RlX3NldF9uYW1lKG1vZGUpOworCQlkcm1fbW9kZV9wcm9iZWRfYWRkKGNvbm5l
Y3RvciwgbW9kZSk7CisJfQorCisJcmV0dXJuIEFSUkFZX1NJWkUobW9kZXMpOworfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9icmlkZ2VfZnVuY3MgdmVuY19icmlkZ2VfZnVuY3MgPSB7CisJ
LmF0dGFjaCA9IHZlbmNfYnJpZGdlX2F0dGFjaCwKKwkubW9kZV92YWxpZCA9IHZlbmNfYnJpZGdl
X21vZGVfdmFsaWQsCisJLm1vZGVfZml4dXAgPSB2ZW5jX2JyaWRnZV9tb2RlX2ZpeHVwLAorCS5t
b2RlX3NldCA9IHZlbmNfYnJpZGdlX21vZGVfc2V0LAorCS5hdG9taWNfZW5hYmxlID0gdmVuY19i
cmlkZ2VfZW5hYmxlLAorCS5hdG9taWNfZGlzYWJsZSA9IHZlbmNfYnJpZGdlX2Rpc2FibGUsCisJ
LmdldF9tb2RlcyA9IHZlbmNfYnJpZGdlX2dldF9tb2RlcywKK307CisKK3N0YXRpYyB2b2lkIHZl
bmNfYnJpZGdlX2luaXQoc3RydWN0IHZlbmNfZGV2aWNlICp2ZW5jKQoreworCXZlbmMtPmJyaWRn
ZS5mdW5jcyA9ICZ2ZW5jX2JyaWRnZV9mdW5jczsKKwl2ZW5jLT5icmlkZ2Uub2Zfbm9kZSA9IHZl
bmMtPnBkZXYtPmRldi5vZl9ub2RlOworCXZlbmMtPmJyaWRnZS5vcHMgPSBEUk1fQlJJREdFX09Q
X01PREVTOworCXZlbmMtPmJyaWRnZS50eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX1NWSURFTzsK
KworCWRybV9icmlkZ2VfYWRkKCZ2ZW5jLT5icmlkZ2UpOworfQorCitzdGF0aWMgdm9pZCB2ZW5j
X2JyaWRnZV9jbGVhbnVwKHN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYykKK3sKKwlkcm1fYnJpZGdl
X3JlbW92ZSgmdmVuYy0+YnJpZGdlKTsKK30KKwogLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAq
IENvbXBvbmVudCBCaW5kICYgVW5iaW5kCiAgKi8KQEAgLTc0Nyw2ICs4MjAsOCBAQCBzdGF0aWMg
aW50IHZlbmNfaW5pdF9vdXRwdXQoc3RydWN0IHZlbmNfZGV2aWNlICp2ZW5jKQogCXN0cnVjdCBv
bWFwX2Rzc19kZXZpY2UgKm91dCA9ICZ2ZW5jLT5vdXRwdXQ7CiAJaW50IHI7CiAKKwl2ZW5jX2Jy
aWRnZV9pbml0KHZlbmMpOworCiAJb3V0LT5kZXYgPSAmdmVuYy0+cGRldi0+ZGV2OwogCW91dC0+
aWQgPSBPTUFQX0RTU19PVVRQVVRfVkVOQzsKIAlvdXQtPnR5cGUgPSBPTUFQX0RJU1BMQVlfVFlQ
RV9WRU5DOwpAQCAtNzU3LDcgKzgzMiw3IEBAIHN0YXRpYyBpbnQgdmVuY19pbml0X291dHB1dChz
dHJ1Y3QgdmVuY19kZXZpY2UgKnZlbmMpCiAJb3V0LT5vZl9wb3J0ID0gMDsKIAlvdXQtPm9wc19m
bGFncyA9IE9NQVBfRFNTX0RFVklDRV9PUF9NT0RFUzsKIAotCXIgPSBvbWFwZHNzX2RldmljZV9p
bml0X291dHB1dChvdXQsIE5VTEwpOworCXIgPSBvbWFwZHNzX2RldmljZV9pbml0X291dHB1dChv
dXQsICZ2ZW5jLT5icmlkZ2UpOwogCWlmIChyIDwgMCkKIAkJcmV0dXJuIHI7CiAKQEAgLTc3MCw2
ICs4NDUsOCBAQCBzdGF0aWMgdm9pZCB2ZW5jX3VuaW5pdF9vdXRwdXQoc3RydWN0IHZlbmNfZGV2
aWNlICp2ZW5jKQogewogCW9tYXBkc3NfZGV2aWNlX3VucmVnaXN0ZXIoJnZlbmMtPm91dHB1dCk7
CiAJb21hcGRzc19kZXZpY2VfY2xlYW51cF9vdXRwdXQoJnZlbmMtPm91dHB1dCk7CisKKwl2ZW5j
X2JyaWRnZV9jbGVhbnVwKHZlbmMpOwogfQogCiBzdGF0aWMgaW50IHZlbmNfcHJvYmVfb2Yoc3Ry
dWN0IHZlbmNfZGV2aWNlICp2ZW5jKQotLSAKUmVnYXJkcywKCkxhdXJlbnQgUGluY2hhcnQKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
