Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7343130F87
	for <lists+dri-devel@lfdr.de>; Fri, 31 May 2019 16:02:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C0D7D894E7;
	Fri, 31 May 2019 14:02:01 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 92077894D7;
 Fri, 31 May 2019 14:01:59 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:52318
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hWi6X-0002XY-N0; Fri, 31 May 2019 16:01:57 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 3/8] drm/fb-helper: Prepare to move out commit code
Date: Fri, 31 May 2019 16:01:12 +0200
Message-Id: <20190531140117.37751-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190531140117.37751-1-noralf@tronnes.org>
References: <20190531140117.37751-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=WXh8QvurDtCZm2+ItAjsHiXImVeIqjyUkzJhSsiRyk0=; 
 b=arU4cbgQnSohdG0yK+b3aJsG0pG6A7Pu7Cib40ClHe/3IIz1T7oDA5bI2ttoYUb78fGfPMD9AuPPvexXAVYbKjWqJybw6pBrBxPF/gLel8csTX78+duvzQvI7Hj6GG7Xo6/XJnbQbDiVZ4w85ZN2sweYvYnpEa65sBSo+7FvS1705RKfdF7lhlu7mr0irNdSi6vi8V+NbNOVrkhHHAUwHaEcvYn0U5kW++PtJ+ue9gYAHKFdx34g0Ek9AYkSOOnOJub74kiBf0usqj7tHlygLySXbDMnzHW3l3H6vhCdbjovC4JvHxlqthbin9AniRU3vKhpipF9HbvyQao4sDP1iA==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org, Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBtYWtlcyB0aGUgbmVjZXNzYXJ5IGNoYW5nZXMgc28gdGhlIGNvbW1pdCBjb2RlIGNhbiBi
ZSBtb3ZlZCBvdXQgdG8KZHJtX2NsaWVudCBhcy1pcyBpbiB0aGUgbmV4dCBwYXRjaC4gSXQncyBz
cGxpdCB1cCB0byBlYXNlIHJldmlldy4KClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8
bm9yYWxmQHRyb25uZXMub3JnPgpSZXZpZXdlZC1ieTogU2FtIFJhdm5ib3JnIDxzYW1AcmF2bmJv
cmcub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZmJfaGVscGVyLmMgfCAxMjIgKysrKysr
KysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA4MSBpbnNlcnRpb25z
KCspLCA0MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Zi
X2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9mYl9oZWxwZXIuYwppbmRleCBiOWI3YzA2
Y2JjNGYuLjY0ODAwZDQzODM3ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9mYl9o
ZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ZiX2hlbHBlci5jCkBAIC0zOTMsOSAr
MzkzLDIwIEBAIGludCBkcm1fZmJfaGVscGVyX2RlYnVnX2xlYXZlKHN0cnVjdCBmYl9pbmZvICpp
bmZvKQogfQogRVhQT1JUX1NZTUJPTChkcm1fZmJfaGVscGVyX2RlYnVnX2xlYXZlKTsKIAotLyog
Q2hlY2sgaWYgdGhlIHBsYW5lIGNhbiBodyByb3RhdGUgdG8gbWF0Y2ggcGFuZWwgb3JpZW50YXRp
b24gKi8KLXN0YXRpYyBib29sIGRybV9mYl9oZWxwZXJfcGFuZWxfcm90YXRpb24oc3RydWN0IGRy
bV9tb2RlX3NldCAqbW9kZXNldCwKLQkJCQkJIHVuc2lnbmVkIGludCAqcm90YXRpb24pCisvKioK
KyAqIGRybV9jbGllbnRfcGFuZWxfcm90YXRpb24oKSAtIENoZWNrIHBhbmVsIG9yaWVudGF0aW9u
CisgKiBAbW9kZXNldDogRFJNIG1vZGVzZXQKKyAqIEByb3RhdGlvbjogUmV0dXJuZWQgcm90YXRp
b24gdmFsdWUKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIGNoZWNrcyBpZiB0aGUgcHJpbWFyeSBwbGFu
ZSBpbiBAbW9kZXNldCBjYW4gaHcgcm90YXRlIHRvIG1hdGNoCisgKiB0aGUgcGFuZWwgb3JpZW50
YXRpb24gb24gaXRzIGNvbm5lY3Rvci4KKyAqCisgKiBOb3RlOiBDdXJyZW50bHkgb25seSAwIGFu
ZCAxODAgZGVncmVlcyBhcmUgc3VwcG9ydGVkLgorICoKKyAqIFJldHVybjoKKyAqIFRydWUgaWYg
dGhlIHBsYW5lIGNhbiBkbyB0aGUgcm90YXRpb24sIGZhbHNlIG90aGVyd2lzZS4KKyAqLworYm9v
bCBkcm1fY2xpZW50X3BhbmVsX3JvdGF0aW9uKHN0cnVjdCBkcm1fbW9kZV9zZXQgKm1vZGVzZXQs
IHVuc2lnbmVkIGludCAqcm90YXRpb24pCiB7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5l
Y3RvciA9IG1vZGVzZXQtPmNvbm5lY3RvcnNbMF07CiAJc3RydWN0IGRybV9wbGFuZSAqcGxhbmUg
PSBtb2Rlc2V0LT5jcnRjLT5wcmltYXJ5OwpAQCAtNDM2LDEwICs0NDcsOSBAQCBzdGF0aWMgYm9v
bCBkcm1fZmJfaGVscGVyX3BhbmVsX3JvdGF0aW9uKHN0cnVjdCBkcm1fbW9kZV9zZXQgKm1vZGVz
ZXQsCiAJcmV0dXJuIHRydWU7CiB9CiAKLXN0YXRpYyBpbnQgcmVzdG9yZV9mYmRldl9tb2RlX2F0
b21pYyhzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVscGVyLCBib29sIGFjdGl2ZSkKK3N0YXRp
YyBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9hdG9taWMoc3RydWN0IGRybV9jbGllbnRf
ZGV2ICpjbGllbnQsIGJvb2wgYWN0aXZlKQogewotCXN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xp
ZW50ID0gJmZiX2hlbHBlci0+Y2xpZW50OwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBmYl9o
ZWxwZXItPmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY2xpZW50LT5kZXY7CiAJc3Ry
dWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJc3RydWN0IGRybV9wbGFuZSAqcGxh
bmU7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOwpAQCAtNDc5LDcgKzQ4OSw3IEBA
IHN0YXRpYyBpbnQgcmVzdG9yZV9mYmRldl9tb2RlX2F0b21pYyhzdHJ1Y3QgZHJtX2ZiX2hlbHBl
ciAqZmJfaGVscGVyLCBib29sIGFjdGl2CiAJCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1hcnkgPSBt
b2RlX3NldC0+Y3J0Yy0+cHJpbWFyeTsKIAkJdW5zaWduZWQgaW50IHJvdGF0aW9uOwogCi0JCWlm
IChkcm1fZmJfaGVscGVyX3BhbmVsX3JvdGF0aW9uKG1vZGVfc2V0LCAmcm90YXRpb24pKSB7CisJ
CWlmIChkcm1fY2xpZW50X3BhbmVsX3JvdGF0aW9uKG1vZGVfc2V0LCAmcm90YXRpb24pKSB7CiAJ
CQkvKiBDYW5ub3QgZmFpbCBhcyB3ZSd2ZSBhbHJlYWR5IGdvdHRlbiB0aGUgcGxhbmUgc3RhdGUg
YWJvdmUgKi8KIAkJCXBsYW5lX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRl
KHN0YXRlLCBwcmltYXJ5KTsKIAkJCXBsYW5lX3N0YXRlLT5yb3RhdGlvbiA9IHJvdGF0aW9uOwpA
QCAtNTIxLDE1ICs1MzEsMTQgQEAgc3RhdGljIGludCByZXN0b3JlX2ZiZGV2X21vZGVfYXRvbWlj
KHN0cnVjdCBkcm1fZmJfaGVscGVyICpmYl9oZWxwZXIsIGJvb2wgYWN0aXYKIAlnb3RvIHJldHJ5
OwogfQogCi1zdGF0aWMgaW50IHJlc3RvcmVfZmJkZXZfbW9kZV9sZWdhY3koc3RydWN0IGRybV9m
Yl9oZWxwZXIgKmZiX2hlbHBlcikKK3N0YXRpYyBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1p
dF9sZWdhY3koc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQpCiB7Ci0Jc3RydWN0IGRybV9j
bGllbnRfZGV2ICpjbGllbnQgPSAmZmJfaGVscGVyLT5jbGllbnQ7Ci0Jc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IGZiX2hlbHBlci0+ZGV2OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjbGll
bnQtPmRldjsKIAlzdHJ1Y3QgZHJtX21vZGVfc2V0ICptb2RlX3NldDsKIAlzdHJ1Y3QgZHJtX3Bs
YW5lICpwbGFuZTsKIAlpbnQgcmV0ID0gMDsKIAotCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGZiX2hl
bHBlci0+ZGV2KTsKKwlkcm1fbW9kZXNldF9sb2NrX2FsbChkZXYpOwogCWRybV9mb3JfZWFjaF9w
bGFuZShwbGFuZSwgZGV2KSB7CiAJCWlmIChwbGFuZS0+dHlwZSAhPSBEUk1fUExBTkVfVFlQRV9Q
UklNQVJZKQogCQkJZHJtX3BsYW5lX2ZvcmNlX2Rpc2FibGUocGxhbmUpOwpAQCAtNTU4LDM1ICs1
NjcsNTMgQEAgc3RhdGljIGludCByZXN0b3JlX2ZiZGV2X21vZGVfbGVnYWN5KHN0cnVjdCBkcm1f
ZmJfaGVscGVyICpmYl9oZWxwZXIpCiAJCQlnb3RvIG91dDsKIAl9CiBvdXQ6Ci0JZHJtX21vZGVz
ZXRfdW5sb2NrX2FsbChmYl9oZWxwZXItPmRldik7CisJZHJtX21vZGVzZXRfdW5sb2NrX2FsbChk
ZXYpOwogCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludCByZXN0b3JlX2ZiZGV2X21vZGVf
Zm9yY2Uoc3RydWN0IGRybV9mYl9oZWxwZXIgKmZiX2hlbHBlcikKKy8qKgorICogZHJtX2NsaWVu
dF9tb2Rlc2V0X2NvbW1pdF9mb3JjZSgpIC0gRm9yY2UgY29tbWl0IENSVEMgY29uZmlndXJhdGlv
bgorICogQGNsaWVudDogRFJNIGNsaWVudAorICoKKyAqIENvbW1pdCBtb2Rlc2V0IGNvbmZpZ3Vy
YXRpb24gdG8gY3J0Y3Mgd2l0aG91dCBjaGVja2luZyBpZiB0aGVyZSBpcyBhIERSTSBtYXN0ZXIu
CisgKgorICogUmV0dXJuczoKKyAqIFplcm8gb24gc3VjY2VzcyBvciBuZWdhdGl2ZSBlcnJvciBj
b2RlIG9uIGZhaWx1cmUuCisgKi8KK2ludCBkcm1fY2xpZW50X21vZGVzZXRfY29tbWl0X2ZvcmNl
KHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBmYl9oZWxwZXItPmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY2xpZW50LT5k
ZXY7CiAJaW50IHJldDsKIAotCW11dGV4X2xvY2soJmZiX2hlbHBlci0+Y2xpZW50Lm1vZGVzZXRf
bXV0ZXgpOworCW11dGV4X2xvY2soJmNsaWVudC0+bW9kZXNldF9tdXRleCk7CiAJaWYgKGRybV9k
cnZfdXNlc19hdG9taWNfbW9kZXNldChkZXYpKQotCQlyZXQgPSByZXN0b3JlX2ZiZGV2X21vZGVf
YXRvbWljKGZiX2hlbHBlciwgdHJ1ZSk7CisJCXJldCA9IGRybV9jbGllbnRfbW9kZXNldF9jb21t
aXRfYXRvbWljKGNsaWVudCwgdHJ1ZSk7CiAJZWxzZQotCQlyZXQgPSByZXN0b3JlX2ZiZGV2X21v
ZGVfbGVnYWN5KGZiX2hlbHBlcik7Ci0JbXV0ZXhfdW5sb2NrKCZmYl9oZWxwZXItPmNsaWVudC5t
b2Rlc2V0X211dGV4KTsKKwkJcmV0ID0gZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9sZWdhY3ko
Y2xpZW50KTsKKwltdXRleF91bmxvY2soJmNsaWVudC0+bW9kZXNldF9tdXRleCk7CiAKIAlyZXR1
cm4gcmV0OwogfQogCi1zdGF0aWMgaW50IHJlc3RvcmVfZmJkZXZfbW9kZShzdHJ1Y3QgZHJtX2Zi
X2hlbHBlciAqZmJfaGVscGVyKQorLyoqCisgKiBkcm1fY2xpZW50X21vZGVzZXRfY29tbWl0KCkg
LSBDb21taXQgQ1JUQyBjb25maWd1cmF0aW9uCisgKiBAY2xpZW50OiBEUk0gY2xpZW50CisgKgor
ICogQ29tbWl0IG1vZGVzZXQgY29uZmlndXJhdGlvbiB0byBjcnRjcy4KKyAqCisgKiBSZXR1cm5z
OgorICogWmVybyBvbiBzdWNjZXNzIG9yIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4K
KyAqLworaW50IGRybV9jbGllbnRfbW9kZXNldF9jb21taXQoc3RydWN0IGRybV9jbGllbnRfZGV2
ICpjbGllbnQpCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGZiX2hlbHBlci0+ZGV2Owor
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjbGllbnQtPmRldjsKIAlpbnQgcmV0OwogCiAJaWYg
KCFkcm1fbWFzdGVyX2ludGVybmFsX2FjcXVpcmUoZGV2KSkKIAkJcmV0dXJuIC1FQlVTWTsKIAot
CXJldCA9IHJlc3RvcmVfZmJkZXZfbW9kZV9mb3JjZShmYl9oZWxwZXIpOworCXJldCA9IGRybV9j
bGllbnRfbW9kZXNldF9jb21taXRfZm9yY2UoY2xpZW50KTsKIAogCWRybV9tYXN0ZXJfaW50ZXJu
YWxfcmVsZWFzZShkZXYpOwogCkBAIC02MjYsNyArNjUzLDcgQEAgaW50IGRybV9mYl9oZWxwZXJf
cmVzdG9yZV9mYmRldl9tb2RlX3VubG9ja2VkKHN0cnVjdCBkcm1fZmJfaGVscGVyICpmYl9oZWxw
ZXIpCiAJICogU28gZmlyc3QgdGhlc2UgdGVzdHMgbmVlZCB0byBiZSBmaXhlZCBzbyB0aGV5IGRy
b3AgbWFzdGVyIG9yIGRvbid0CiAJICogaGF2ZSBhbiBmZCBvcGVuLgogCSAqLwotCXJldCA9IHJl
c3RvcmVfZmJkZXZfbW9kZV9mb3JjZShmYl9oZWxwZXIpOworCXJldCA9IGRybV9jbGllbnRfbW9k
ZXNldF9jb21taXRfZm9yY2UoJmZiX2hlbHBlci0+Y2xpZW50KTsKIAogCWRvX2RlbGF5ZWQgPSBm
Yl9oZWxwZXItPmRlbGF5ZWRfaG90cGx1ZzsKIAlpZiAoZG9fZGVsYXllZCkKQEAgLTY2MCw3ICs2
ODcsNyBAQCBzdGF0aWMgYm9vbCBkcm1fZmJfaGVscGVyX2ZvcmNlX2tlcm5lbF9tb2RlKHZvaWQp
CiAJCQljb250aW51ZTsKIAogCQltdXRleF9sb2NrKCZoZWxwZXItPmxvY2spOwotCQlyZXQgPSBy
ZXN0b3JlX2ZiZGV2X21vZGVfZm9yY2UoaGVscGVyKTsKKwkJcmV0ID0gZHJtX2NsaWVudF9tb2Rl
c2V0X2NvbW1pdF9mb3JjZSgmaGVscGVyLT5jbGllbnQpOwogCQlpZiAocmV0KQogCQkJZXJyb3Ig
PSB0cnVlOwogCQltdXRleF91bmxvY2soJmhlbHBlci0+bG9jayk7CkBAIC02OTIsMTAgKzcxOSw5
IEBAIHN0YXRpYyBzdHJ1Y3Qgc3lzcnFfa2V5X29wIHN5c3JxX2RybV9mYl9oZWxwZXJfcmVzdG9y
ZV9vcCA9IHsKIHN0YXRpYyBzdHJ1Y3Qgc3lzcnFfa2V5X29wIHN5c3JxX2RybV9mYl9oZWxwZXJf
cmVzdG9yZV9vcCA9IHsgfTsKICNlbmRpZgogCi1zdGF0aWMgdm9pZCBkcG1zX2xlZ2FjeShzdHJ1
Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVscGVyLCBpbnQgZHBtc19tb2RlKQorc3RhdGljIHZvaWQg
ZHJtX2NsaWVudF9tb2Rlc2V0X2RwbXNfbGVnYWN5KHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xp
ZW50LCBpbnQgZHBtc19tb2RlKQogewotCXN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50ID0g
JmZiX2hlbHBlci0+Y2xpZW50OwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBmYl9oZWxwZXIt
PmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY2xpZW50LT5kZXY7CiAJc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX21vZGVfc2V0ICptb2Rlc2V0Owog
CWludCBqOwpAQCAtNzE1LDI4ICs3NDEsNDIgQEAgc3RhdGljIHZvaWQgZHBtc19sZWdhY3koc3Ry
dWN0IGRybV9mYl9oZWxwZXIgKmZiX2hlbHBlciwgaW50IGRwbXNfbW9kZSkKIAlkcm1fbW9kZXNl
dF91bmxvY2tfYWxsKGRldik7CiB9CiAKLXN0YXRpYyB2b2lkIGRybV9mYl9oZWxwZXJfZHBtcyhz
dHJ1Y3QgZmJfaW5mbyAqaW5mbywgaW50IGRwbXNfbW9kZSkKKy8qKgorICogZHJtX2NsaWVudF9t
b2Rlc2V0X2RwbXMoKSAtIFNldCBEUE1TIG1vZGUKKyAqIEBjbGllbnQ6IERSTSBjbGllbnQKKyAq
IEBtb2RlOiBEUE1TIG1vZGUKKyAqCisgKiBOb3RlOiBGb3IgYXRvbWljIGRyaXZlcnMgQG1vZGUg
aXMgcmVkdWNlZCB0byBvbi9vZmYuCisgKgorICogUmV0dXJuczoKKyAqIFplcm8gb24gc3VjY2Vz
cyBvciBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisgKi8KK2ludCBkcm1fY2xpZW50
X21vZGVzZXRfZHBtcyhzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCwgaW50IG1vZGUpCiB7
Ci0Jc3RydWN0IGRybV9mYl9oZWxwZXIgKmZiX2hlbHBlciA9IGluZm8tPnBhcjsKLQlzdHJ1Y3Qg
ZHJtX2NsaWVudF9kZXYgKmNsaWVudCA9ICZmYl9oZWxwZXItPmNsaWVudDsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZmJfaGVscGVyLT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IGNsaWVudC0+ZGV2OworCWludCByZXQgPSAwOwogCi0JLyoKLQkgKiBGb3IgZWFjaCBDUlRDIGlu
IHRoaXMgZmIsIHR1cm4gdGhlIGNvbm5lY3RvcnMgb24vb2ZmLgotCSAqLwotCW11dGV4X2xvY2so
JmZiX2hlbHBlci0+bG9jayk7CiAJaWYgKCFkcm1fbWFzdGVyX2ludGVybmFsX2FjcXVpcmUoZGV2
KSkKLQkJZ290byB1bmxvY2s7CisJCXJldHVybiAtRUJVU1k7CiAKIAltdXRleF9sb2NrKCZjbGll
bnQtPm1vZGVzZXRfbXV0ZXgpOwogCWlmIChkcm1fZHJ2X3VzZXNfYXRvbWljX21vZGVzZXQoZGV2
KSkKLQkJcmVzdG9yZV9mYmRldl9tb2RlX2F0b21pYyhmYl9oZWxwZXIsIGRwbXNfbW9kZSA9PSBE
Uk1fTU9ERV9EUE1TX09OKTsKKwkJcmV0ID0gZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9hdG9t
aWMoY2xpZW50LCBtb2RlID09IERSTV9NT0RFX0RQTVNfT04pOwogCWVsc2UKLQkJZHBtc19sZWdh
Y3koZmJfaGVscGVyLCBkcG1zX21vZGUpOworCQlkcm1fY2xpZW50X21vZGVzZXRfZHBtc19sZWdh
Y3koY2xpZW50LCBtb2RlKTsKIAltdXRleF91bmxvY2soJmNsaWVudC0+bW9kZXNldF9tdXRleCk7
CiAKIAlkcm1fbWFzdGVyX2ludGVybmFsX3JlbGVhc2UoZGV2KTsKLXVubG9jazoKKworCXJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGRybV9mYl9oZWxwZXJfZHBtcyhzdHJ1Y3QgZmJfaW5m
byAqaW5mbywgaW50IGRwbXNfbW9kZSkKK3sKKwlzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVs
cGVyID0gaW5mby0+cGFyOworCisJbXV0ZXhfbG9jaygmZmJfaGVscGVyLT5sb2NrKTsKKwlkcm1f
Y2xpZW50X21vZGVzZXRfZHBtcygmZmJfaGVscGVyLT5jbGllbnQsIGRwbXNfbW9kZSk7CiAJbXV0
ZXhfdW5sb2NrKCZmYl9oZWxwZXItPmxvY2spOwogfQogCkBAIC0xODEwLDcgKzE4NTAsNyBAQCBz
dGF0aWMgaW50IHBhbl9kaXNwbGF5X2F0b21pYyhzdHJ1Y3QgZmJfdmFyX3NjcmVlbmluZm8gKnZh
ciwKIAogCXBhbl9zZXQoZmJfaGVscGVyLCB2YXItPnhvZmZzZXQsIHZhci0+eW9mZnNldCk7CiAK
LQlyZXQgPSByZXN0b3JlX2ZiZGV2X21vZGVfZm9yY2UoZmJfaGVscGVyKTsKKwlyZXQgPSBkcm1f
Y2xpZW50X21vZGVzZXRfY29tbWl0X2ZvcmNlKCZmYl9oZWxwZXItPmNsaWVudCk7CiAJaWYgKCFy
ZXQpIHsKIAkJaW5mby0+dmFyLnhvZmZzZXQgPSB2YXItPnhvZmZzZXQ7CiAJCWluZm8tPnZhci55
b2Zmc2V0ID0gdmFyLT55b2Zmc2V0OwpAQCAtMjAzNiw3ICsyMDc2LDcgQEAgc3RhdGljIGludCBk
cm1fZmJfaGVscGVyX3NpbmdsZV9mYl9wcm9iZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVs
cGVyLAogCiAJCS8qIEZpcnN0IHRpbWU6IGRpc2FibGUgYWxsIGNydGMncy4uICovCiAJCWlmICgh
ZmJfaGVscGVyLT5kZWZlcnJlZF9zZXR1cCkKLQkJCXJlc3RvcmVfZmJkZXZfbW9kZShmYl9oZWxw
ZXIpOworCQkJZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdChjbGllbnQpOwogCQlyZXR1cm4gLUVB
R0FJTjsKIAl9CiAKQEAgLTI4MTAsNyArMjg1MCw3IEBAIHN0YXRpYyB2b2lkIGRybV9zZXR1cF9j
cnRjc19mYihzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVscGVyKQogCiAJCW1vZGVzZXQtPmZi
ID0gZmJfaGVscGVyLT5mYjsKIAotCQlpZiAoZHJtX2ZiX2hlbHBlcl9wYW5lbF9yb3RhdGlvbiht
b2Rlc2V0LCAmcm90YXRpb24pKQorCQlpZiAoZHJtX2NsaWVudF9wYW5lbF9yb3RhdGlvbihtb2Rl
c2V0LCAmcm90YXRpb24pKQogCQkJLyogUm90YXRpbmcgaW4gaGFyZHdhcmUsIGZiY29uIHNob3Vs
ZCBub3Qgcm90YXRlICovCiAJCQlzd19yb3RhdGlvbnMgfD0gRFJNX01PREVfUk9UQVRFXzA7CiAJ
CWVsc2UKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
