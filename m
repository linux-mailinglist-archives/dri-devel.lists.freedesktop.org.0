Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 94D39F2937
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 09:34:29 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F3BB46EEFA;
	Thu,  7 Nov 2019 08:34:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 932536EEF5
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 08:34:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 3BEDAB20A;
 Thu,  7 Nov 2019 08:34:08 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v2 7/9] drm/ast: Add CRTC helpers for atomic modesetting
Date: Thu,  7 Nov 2019 09:34:02 +0100
Message-Id: <20191107083404.6852-8-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191107083404.6852-1-tzimmermann@suse.de>
References: <20191107083404.6852-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QXMgdGhlIENSVEMgY29kZSBoYXMgYWxyZWFkeSBiZWVuIHByZXBhcmVkIGZvciBhIHNwbGl0IGJl
dHdlZW4gbW9kZQpzZXR0aW5nIGFuZCBwbGFuZSBoYW5kbGluZywgbW9zdCBvZiB0aGUgQ1JUQydz
IGF0b21pYyBtb2Rlc2V0dGluZyBpcwpidWlsZCB1cG9uIHByaW1pdGl2ZXMgb2YgdGhlIG5vbi1h
dG9taWMgaW1wbGVtZW50YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8
dHppbW1lcm1hbm5Ac3VzZS5kZT4KQWNrZWQtYnk6IEdlcmQgSG9mZm1hbm4gPGtyYXhlbEByZWRo
YXQuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyB8IDEwNSArKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKy0KIDEgZmlsZSBjaGFuZ2VkLCAxMDQgaW5zZXJ0aW9u
cygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0
X21vZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwppbmRleCBkY2Q2MzUxMTUy
OTcuLjY1ZWU4MjE1ZjczMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9k
ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwpAQCAtNzI3LDYgKzcyNywx
MDMgQEAgc3RhdGljIHZvaWQgYXN0X2NydGNfY29tbWl0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YykK
IAlhc3RfY3J0Y19sb2FkX2x1dChjcnRjKTsKIH0KIAorc3RhdGljIGludCBhc3RfY3J0Y19oZWxw
ZXJfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkJc3RydWN0IGRybV9j
cnRjX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCA9IGNydGMtPmRl
di0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CisJ
Ym9vbCBzdWNjOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIGFkanVzdGVkX21vZGU7CisJc3Ry
dWN0IGFzdF92Ymlvc19tb2RlX2luZm8gdmJpb3NfbW9kZTsKKworCWlmIChhc3QtPmNoaXAgPT0g
QVNUMTE4MCkgeworCQlEUk1fRVJST1IoIkFTVCAxMTgwIG1vZGVzZXR0aW5nIG5vdCBzdXBwb3J0
ZWRcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlwbGFuZV9zdGF0ZSA9IGNydGMtPnBy
aW1hcnktPnN0YXRlOworCisJaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5mYikgewor
CQlzdWNjID0gYXN0X2dldF92Ymlvc19tb2RlX2luZm8ocGxhbmVfc3RhdGUtPmZiLCAmc3RhdGUt
Pm1vZGUsCisJCQkJCSAgICAgICAmYWRqdXN0ZWRfbW9kZSwgJnZiaW9zX21vZGUpOworCQlpZiAo
IXN1Y2MpCisJCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IHZvaWQgYXN0X2NydGNfaGVscGVyX2F0b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMs
CisJCQkJCSBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQoreworCXN0cnVj
dCBhc3RfcHJpdmF0ZSAqYXN0ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsKKworCWFzdF9vcGVu
X2tleShhc3QpOworfQorCitzdGF0aWMgdm9pZCBhc3RfY3J0Y19oZWxwZXJfYXRvbWljX2ZsdXNo
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkJIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBjcnRj
LT5wcmltYXJ5LT5zdGF0ZS0+ZmI7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgYWRqdXN0ZWRf
bW9kZTsKKwlzdHJ1Y3QgYXN0X3ZiaW9zX21vZGVfaW5mbyB2Ymlvc19tb2RlOworCWJvb2wgc3Vj
YzsKKworCWNydGMtPnN0YXRlLT5ub192YmxhbmsgPSB0cnVlOworCisJaWYgKCFmYikKKwkJcmV0
dXJuOworCisJYXN0X3NldF9jb2xvcl9yZWcoY3J0YywgZmIpOworCisJbWVtc2V0KCZhZGp1c3Rl
ZF9tb2RlLCAwLCBzaXplb2YoYWRqdXN0ZWRfbW9kZSkpOworCWRybV9tb2RlX2NvcHkoJmFkanVz
dGVkX21vZGUsICZjcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZSk7CisKKwlzdWNjID0gYXN0X2dl
dF92Ymlvc19tb2RlX2luZm8oZmIsICZjcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZSwKKwkJCQkg
ICAgICAgJmFkanVzdGVkX21vZGUsICZ2Ymlvc19tb2RlKTsKKwlpZiAoV0FSTl9PTl9PTkNFKCFz
dWNjKSkKKwkJcmV0dXJuOworCisJYXN0X3NldF92Ymlvc19jb2xvcl9yZWcoY3J0YywgZmIsICZ2
Ymlvc19tb2RlKTsKK30KKworc3RhdGljIHZvaWQKK2FzdF9jcnRjX2hlbHBlcl9hdG9taWNfZW5h
YmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCSAgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRl
djsKKwlzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7CisJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBjcnRjLT5wcmltYXJ5LT5zdGF0ZS0+
ZmI7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgYXN0
X3ZiaW9zX21vZGVfaW5mbyB2Ymlvc19tb2RlOworCWJvb2wgc3VjYzsKKworCW1lbXNldCgmYWRq
dXN0ZWRfbW9kZSwgMCwgc2l6ZW9mKGFkanVzdGVkX21vZGUpKTsKKwlkcm1fbW9kZV9jb3B5KCZh
ZGp1c3RlZF9tb2RlLCAmY3J0Yy0+c3RhdGUtPmFkanVzdGVkX21vZGUpOworCisJc3VjYyA9IGFz
dF9nZXRfdmJpb3NfbW9kZV9pbmZvKGZiLCAmY3J0Yy0+c3RhdGUtPmFkanVzdGVkX21vZGUsCisJ
CQkJICAgICAgICZhZGp1c3RlZF9tb2RlLCAmdmJpb3NfbW9kZSk7CisJaWYgKFdBUk5fT05fT05D
RSghc3VjYykpCisJCXJldHVybjsKKworCWFzdF9zZXRfdmJpb3NfbW9kZV9yZWcoY3J0YywgJmFk
anVzdGVkX21vZGUsICZ2Ymlvc19tb2RlKTsKKwlhc3Rfc2V0X2luZGV4X3JlZyhhc3QsIEFTVF9J
T19DUlRDX1BPUlQsIDB4YTEsIDB4MDYpOworCWFzdF9zZXRfc3RkX3JlZyhjcnRjLCAmYWRqdXN0
ZWRfbW9kZSwgJnZiaW9zX21vZGUpOworCWFzdF9zZXRfY3J0Y19yZWcoY3J0YywgJmFkanVzdGVk
X21vZGUsICZ2Ymlvc19tb2RlKTsKKwlhc3Rfc2V0X2RjbGtfcmVnKGRldiwgJmFkanVzdGVkX21v
ZGUsICZ2Ymlvc19tb2RlKTsKKwlhc3Rfc2V0X2NydHRoZF9yZWcoY3J0Yyk7CisJYXN0X3NldF9z
eW5jX3JlZyhkZXYsICZhZGp1c3RlZF9tb2RlLCAmdmJpb3NfbW9kZSk7CisJYXN0X3NldF9kYWNf
cmVnKGNydGMsICZhZGp1c3RlZF9tb2RlLCAmdmJpb3NfbW9kZSk7CisKKwlhc3RfY3J0Y19kcG1z
KGNydGMsIERSTV9NT0RFX0RQTVNfT04pOworfQorCitzdGF0aWMgdm9pZAorYXN0X2NydGNfaGVs
cGVyX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCSAgICAgICBzdHJ1
Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQoreworCWFzdF9jcnRjX2RwbXMoY3J0
YywgRFJNX01PREVfRFBNU19PRkYpOworfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRj
X2hlbHBlcl9mdW5jcyBhc3RfY3J0Y19oZWxwZXJfZnVuY3MgPSB7CiAJLmRwbXMgPSBhc3RfY3J0
Y19kcG1zLApAQCAtNzM1LDcgKzgzMiwxMSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRj
X2hlbHBlcl9mdW5jcyBhc3RfY3J0Y19oZWxwZXJfZnVuY3MgPSB7CiAJLmRpc2FibGUgPSBhc3Rf
Y3J0Y19kaXNhYmxlLAogCS5wcmVwYXJlID0gYXN0X2NydGNfcHJlcGFyZSwKIAkuY29tbWl0ID0g
YXN0X2NydGNfY29tbWl0LAotCisJLmF0b21pY19jaGVjayA9IGFzdF9jcnRjX2hlbHBlcl9hdG9t
aWNfY2hlY2ssCisJLmF0b21pY19iZWdpbiA9IGFzdF9jcnRjX2hlbHBlcl9hdG9taWNfYmVnaW4s
CisJLmF0b21pY19mbHVzaCA9IGFzdF9jcnRjX2hlbHBlcl9hdG9taWNfZmx1c2gsCisJLmF0b21p
Y19lbmFibGUgPSBhc3RfY3J0Y19oZWxwZXJfYXRvbWljX2VuYWJsZSwKKwkuYXRvbWljX2Rpc2Fi
bGUgPSBhc3RfY3J0Y19oZWxwZXJfYXRvbWljX2Rpc2FibGUsCiB9OwogCiBzdGF0aWMgdm9pZCBh
c3RfY3J0Y19yZXNldChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCkBAIC03NjYsNiArODY3LDggQEAg
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBhc3RfY3J0Y19mdW5jcyA9IHsKIAku
c2V0X2NvbmZpZyA9IGRybV9jcnRjX2hlbHBlcl9zZXRfY29uZmlnLAogCS5nYW1tYV9zZXQgPSBh
c3RfY3J0Y19nYW1tYV9zZXQsCiAJLmRlc3Ryb3kgPSBhc3RfY3J0Y19kZXN0cm95LAorCS5hdG9t
aWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kdXBsaWNhdGVfc3Rh
dGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0
cm95X3N0YXRlLAogfTsKIAogc3RhdGljIGludCBhc3RfY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2RyaS1kZXZlbA==
