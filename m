Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 281A4F1444
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 11:47:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2AAAF6ECC5;
	Wed,  6 Nov 2019 10:47:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 03F4C6ECC3
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 10:47:27 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 77798B152;
 Wed,  6 Nov 2019 10:47:25 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, sean@poorly.run, daniel@ffwll.ch, noralf@tronnes.org,
 sam@ravnborg.org, emil.velikov@collabora.com, kraxel@redhat.com
Subject: [PATCH v2 4/4] drm/udl: Remove struct udl_gem_object and functions
Date: Wed,  6 Nov 2019 11:47:22 +0100
Message-Id: <20191106104722.19700-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106104722.19700-1-tzimmermann@suse.de>
References: <20191106104722.19700-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2ltcGx5IHJlbW92ZXMgYWxsIHRoZSBvYnNvbGV0ZSBHRU0gY29kZSBmcm9tIHVkbC4gTm8gZnVu
Y3Rpb25hbApjaGFuZ2VzLgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1t
ZXJtYW5uQHN1c2UuZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3VkbC9NYWtlZmlsZSAgICAgfCAg
IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2RtYWJ1Zi5jIHwgMjU0IC0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2Rydi5oICAgIHwg
IDI5IC0tLS0KIGRyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2dlbS5jICAgIHwgMjA2IC0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgMSBpbnNlcnRpb24oKyksIDQ5MCBk
ZWxldGlvbnMoLSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9k
bWFidWYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS91ZGwvTWFrZWZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vdWRsL01ha2VmaWxlCmluZGV4IGU1YmI2Zjc1N2UxMS4uOWM0MjgyMGFlMzNk
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL01ha2VmaWxlCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS91ZGwvTWFrZWZpbGUKQEAgLTEsNCArMSw0IEBACiAjIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wLW9ubHkKLXVkbC15IDo9IHVkbF9kcnYubyB1ZGxfbW9kZXNldC5vIHVk
bF9jb25uZWN0b3IubyB1ZGxfZW5jb2Rlci5vIHVkbF9tYWluLm8gdWRsX2ZiLm8gdWRsX3RyYW5z
ZmVyLm8gdWRsX2dlbS5vIHVkbF9kbWFidWYubwordWRsLXkgOj0gdWRsX2Rydi5vIHVkbF9tb2Rl
c2V0Lm8gdWRsX2Nvbm5lY3Rvci5vIHVkbF9lbmNvZGVyLm8gdWRsX21haW4ubyB1ZGxfZmIubyB1
ZGxfdHJhbnNmZXIubyB1ZGxfZ2VtLm8KIAogb2JqLSQoQ09ORklHX0RSTV9VREwpIDo9IHVkbC5v
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9kbWFidWYuYyBiL2RyaXZlcnMv
Z3B1L2RybS91ZGwvdWRsX2RtYWJ1Zi5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBi
MWMxZWU2NGRlNTkuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9k
bWFidWYuYworKysgL2Rldi9udWxsCkBAIC0xLDI1NCArMCwwIEBACi0vLyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMC1vci1sYXRlcgotLyoKLSAqIHVkbF9kbWFidWYuYwotICoKLSAq
IENvcHlyaWdodCAoYykgMjAxNCBUaGUgQ2hyb21pdW0gT1MgQXV0aG9ycwotICovCi0KLSNpbmNs
dWRlIDxsaW51eC9zaG1lbV9mcy5oPgotI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KLQotI2lu
Y2x1ZGUgPGRybS9kcm1fcHJpbWUuaD4KLQotI2luY2x1ZGUgInVkbF9kcnYuaCIKLQotc3RydWN0
IHVkbF9kcm1fZG1hYnVmX2F0dGFjaG1lbnQgewotCXN0cnVjdCBzZ190YWJsZSBzZ3Q7Ci0JZW51
bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyOwotCWJvb2wgaXNfbWFwcGVkOwotfTsKLQotc3RhdGlj
IGludCB1ZGxfYXR0YWNoX2RtYV9idWYoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKLQkJCSAgICAg
IHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCkKLXsKLQlzdHJ1Y3QgdWRsX2RybV9k
bWFidWZfYXR0YWNobWVudCAqdWRsX2F0dGFjaDsKLQotCURSTV9ERUJVR19QUklNRSgiW0RFVjol
c10gc2l6ZTolemRcbiIsIGRldl9uYW1lKGF0dGFjaC0+ZGV2KSwKLQkJCWF0dGFjaC0+ZG1hYnVm
LT5zaXplKTsKLQotCXVkbF9hdHRhY2ggPSBremFsbG9jKHNpemVvZigqdWRsX2F0dGFjaCksIEdG
UF9LRVJORUwpOwotCWlmICghdWRsX2F0dGFjaCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQl1ZGxf
YXR0YWNoLT5kaXIgPSBETUFfTk9ORTsKLQlhdHRhY2gtPnByaXYgPSB1ZGxfYXR0YWNoOwotCi0J
cmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHVkbF9kZXRhY2hfZG1hX2J1ZihzdHJ1Y3QgZG1h
X2J1ZiAqZG1hYnVmLAotCQkJICAgICAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aCkKLXsKLQlzdHJ1Y3QgdWRsX2RybV9kbWFidWZfYXR0YWNobWVudCAqdWRsX2F0dGFjaCA9IGF0
dGFjaC0+cHJpdjsKLQlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKLQotCWlmICghdWRsX2F0dGFjaCkK
LQkJcmV0dXJuOwotCi0JRFJNX0RFQlVHX1BSSU1FKCJbREVWOiVzXSBzaXplOiV6ZFxuIiwgZGV2
X25hbWUoYXR0YWNoLT5kZXYpLAotCQkJYXR0YWNoLT5kbWFidWYtPnNpemUpOwotCi0Jc2d0ID0g
JnVkbF9hdHRhY2gtPnNndDsKLQotCWlmICh1ZGxfYXR0YWNoLT5kaXIgIT0gRE1BX05PTkUpCi0J
CWRtYV91bm1hcF9zZyhhdHRhY2gtPmRldiwgc2d0LT5zZ2wsIHNndC0+bmVudHMsCi0JCQkJdWRs
X2F0dGFjaC0+ZGlyKTsKLQotCXNnX2ZyZWVfdGFibGUoc2d0KTsKLQlrZnJlZSh1ZGxfYXR0YWNo
KTsKLQlhdHRhY2gtPnByaXYgPSBOVUxMOwotfQotCi1zdGF0aWMgc3RydWN0IHNnX3RhYmxlICp1
ZGxfbWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAotCQkJCQll
bnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCi17Ci0Jc3RydWN0IHVkbF9kcm1fZG1hYnVmX2F0
dGFjaG1lbnQgKnVkbF9hdHRhY2ggPSBhdHRhY2gtPnByaXY7Ci0Jc3RydWN0IHVkbF9nZW1fb2Jq
ZWN0ICpvYmogPSB0b191ZGxfYm8oYXR0YWNoLT5kbWFidWYtPnByaXYpOwotCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBvYmotPmJhc2UuZGV2OwotCXN0cnVjdCB1ZGxfZGV2aWNlICp1ZGwgPSBk
ZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBzY2F0dGVybGlzdCAqcmQsICp3cjsKLQlzdHJ1Y3Qg
c2dfdGFibGUgKnNndCA9IE5VTEw7Ci0JdW5zaWduZWQgaW50IGk7Ci0JaW50IHBhZ2VfY291bnQ7
Ci0JaW50IG5lbnRzLCByZXQ7Ci0KLQlEUk1fREVCVUdfUFJJTUUoIltERVY6JXNdIHNpemU6JXpk
IGRpcj0lZFxuIiwgZGV2X25hbWUoYXR0YWNoLT5kZXYpLAotCQkJYXR0YWNoLT5kbWFidWYtPnNp
emUsIGRpcik7Ci0KLQkvKiBqdXN0IHJldHVybiBjdXJyZW50IHNndCBpZiBhbHJlYWR5IHJlcXVl
c3RlZC4gKi8KLQlpZiAodWRsX2F0dGFjaC0+ZGlyID09IGRpciAmJiB1ZGxfYXR0YWNoLT5pc19t
YXBwZWQpCi0JCXJldHVybiAmdWRsX2F0dGFjaC0+c2d0OwotCi0JaWYgKCFvYmotPnBhZ2VzKSB7
Ci0JCXJldCA9IHVkbF9nZW1fZ2V0X3BhZ2VzKG9iaik7Ci0JCWlmIChyZXQpIHsKLQkJCURSTV9F
UlJPUigiZmFpbGVkIHRvIG1hcCBwYWdlcy5cbiIpOwotCQkJcmV0dXJuIEVSUl9QVFIocmV0KTsK
LQkJfQotCX0KLQotCXBhZ2VfY291bnQgPSBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsKLQlv
YmotPnNnID0gZHJtX3ByaW1lX3BhZ2VzX3RvX3NnKG9iai0+cGFnZXMsIHBhZ2VfY291bnQpOwot
CWlmIChJU19FUlIob2JqLT5zZykpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2NhdGUg
c2d0LlxuIik7Ci0JCXJldHVybiBFUlJfQ0FTVChvYmotPnNnKTsKLQl9Ci0KLQlzZ3QgPSAmdWRs
X2F0dGFjaC0+c2d0OwotCi0JcmV0ID0gc2dfYWxsb2NfdGFibGUoc2d0LCBvYmotPnNnLT5vcmln
X25lbnRzLCBHRlBfS0VSTkVMKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRv
IGFsbG9jIHNndC5cbiIpOwotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKLQl9Ci0KLQltdXRl
eF9sb2NrKCZ1ZGwtPmdlbV9sb2NrKTsKLQotCXJkID0gb2JqLT5zZy0+c2dsOwotCXdyID0gc2d0
LT5zZ2w7Ci0JZm9yIChpID0gMDsgaSA8IHNndC0+b3JpZ19uZW50czsgKytpKSB7Ci0JCXNnX3Nl
dF9wYWdlKHdyLCBzZ19wYWdlKHJkKSwgcmQtPmxlbmd0aCwgcmQtPm9mZnNldCk7Ci0JCXJkID0g
c2dfbmV4dChyZCk7Ci0JCXdyID0gc2dfbmV4dCh3cik7Ci0JfQotCi0JaWYgKGRpciAhPSBETUFf
Tk9ORSkgewotCQluZW50cyA9IGRtYV9tYXBfc2coYXR0YWNoLT5kZXYsIHNndC0+c2dsLCBzZ3Qt
Pm9yaWdfbmVudHMsIGRpcik7Ci0JCWlmICghbmVudHMpIHsKLQkJCURSTV9FUlJPUigiZmFpbGVk
IHRvIG1hcCBzZ2wgd2l0aCBpb21tdS5cbiIpOwotCQkJc2dfZnJlZV90YWJsZShzZ3QpOwotCQkJ
c2d0ID0gRVJSX1BUUigtRUlPKTsKLQkJCWdvdG8gZXJyX3VubG9jazsKLQkJfQotCX0KLQotCXVk
bF9hdHRhY2gtPmlzX21hcHBlZCA9IHRydWU7Ci0JdWRsX2F0dGFjaC0+ZGlyID0gZGlyOwotCWF0
dGFjaC0+cHJpdiA9IHVkbF9hdHRhY2g7Ci0KLWVycl91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZ1
ZGwtPmdlbV9sb2NrKTsKLQlyZXR1cm4gc2d0OwotfQotCi1zdGF0aWMgdm9pZCB1ZGxfdW5tYXBf
ZG1hX2J1ZihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCi0JCQkgICAgICBzdHJ1
Y3Qgc2dfdGFibGUgKnNndCwKLQkJCSAgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcikK
LXsKLQkvKiBOb3RoaW5nIHRvIGRvLiAqLwotCURSTV9ERUJVR19QUklNRSgiW0RFVjolc10gc2l6
ZTolemQgZGlyOiVkXG4iLCBkZXZfbmFtZShhdHRhY2gtPmRldiksCi0JCQlhdHRhY2gtPmRtYWJ1
Zi0+c2l6ZSwgZGlyKTsKLX0KLQotc3RhdGljIHZvaWQgKnVkbF9kbWFidWZfa21hcChzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hX2J1ZiwgdW5zaWduZWQgbG9uZyBwYWdlX251bSkKLXsKLQkvKiBUT0RPICov
Ci0KLQlyZXR1cm4gTlVMTDsKLX0KLQotc3RhdGljIHZvaWQgdWRsX2RtYWJ1Zl9rdW5tYXAoc3Ry
dWN0IGRtYV9idWYgKmRtYV9idWYsCi0JCQkgICAgICB1bnNpZ25lZCBsb25nIHBhZ2VfbnVtLCB2
b2lkICphZGRyKQotewotCS8qIFRPRE8gKi8KLX0KLQotc3RhdGljIGludCB1ZGxfZG1hYnVmX21t
YXAoc3RydWN0IGRtYV9idWYgKmRtYV9idWYsCi0JCQkgICBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Qg
KnZtYSkKLXsKLQkvKiBUT0RPICovCi0KLQlyZXR1cm4gLUVJTlZBTDsKLX0KLQotc3RhdGljIGNv
bnN0IHN0cnVjdCBkbWFfYnVmX29wcyB1ZGxfZG1hYnVmX29wcyA9IHsKLQkuYXR0YWNoCQkJPSB1
ZGxfYXR0YWNoX2RtYV9idWYsCi0JLmRldGFjaAkJCT0gdWRsX2RldGFjaF9kbWFfYnVmLAotCS5t
YXBfZG1hX2J1ZgkJPSB1ZGxfbWFwX2RtYV9idWYsCi0JLnVubWFwX2RtYV9idWYJCT0gdWRsX3Vu
bWFwX2RtYV9idWYsCi0JLm1hcAkJCT0gdWRsX2RtYWJ1Zl9rbWFwLAotCS51bm1hcAkJCT0gdWRs
X2RtYWJ1Zl9rdW5tYXAsCi0JLm1tYXAJCQk9IHVkbF9kbWFidWZfbW1hcCwKLQkucmVsZWFzZQkJ
PSBkcm1fZ2VtX2RtYWJ1Zl9yZWxlYXNlLAotfTsKLQotc3RydWN0IGRtYV9idWYgKnVkbF9nZW1f
cHJpbWVfZXhwb3J0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBpbnQgZmxhZ3MpCi17Ci0J
REVGSU5FX0RNQV9CVUZfRVhQT1JUX0lORk8oZXhwX2luZm8pOwotCi0JZXhwX2luZm8ub3BzID0g
JnVkbF9kbWFidWZfb3BzOwotCWV4cF9pbmZvLnNpemUgPSBvYmotPnNpemU7Ci0JZXhwX2luZm8u
ZmxhZ3MgPSBmbGFnczsKLQlleHBfaW5mby5wcml2ID0gb2JqOwotCi0JcmV0dXJuIGRybV9nZW1f
ZG1hYnVmX2V4cG9ydChvYmotPmRldiwgJmV4cF9pbmZvKTsKLX0KLQotc3RhdGljIGludCB1ZGxf
cHJpbWVfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkgICAgc2l6ZV90IHNpemUs
Ci0JCQkgICAgc3RydWN0IHNnX3RhYmxlICpzZywKLQkJCSAgICBzdHJ1Y3QgdWRsX2dlbV9vYmpl
Y3QgKipvYmpfcCkKLXsKLQlzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iajsKLQlpbnQgbnBhZ2Vz
OwotCi0JbnBhZ2VzID0gc2l6ZSAvIFBBR0VfU0laRTsKLQotCSpvYmpfcCA9IE5VTEw7Ci0Jb2Jq
ID0gdWRsX2dlbV9hbGxvY19vYmplY3QoZGV2LCBucGFnZXMgKiBQQUdFX1NJWkUpOwotCWlmICgh
b2JqKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCW9iai0+c2cgPSBzZzsKLQlvYmotPnBhZ2VzID0g
a3ZtYWxsb2NfYXJyYXkobnBhZ2VzLCBzaXplb2Yoc3RydWN0IHBhZ2UgKiksIEdGUF9LRVJORUwp
OwotCWlmIChvYmotPnBhZ2VzID09IE5VTEwpIHsKLQkJRFJNX0VSUk9SKCJvYmogcGFnZXMgaXMg
TlVMTCAlZFxuIiwgbnBhZ2VzKTsKLQkJcmV0dXJuIC1FTk9NRU07Ci0JfQotCi0JZHJtX3ByaW1l
X3NnX3RvX3BhZ2VfYWRkcl9hcnJheXMoc2csIG9iai0+cGFnZXMsIE5VTEwsIG5wYWdlcyk7Ci0K
LQkqb2JqX3AgPSBvYmo7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
dWRsX2dlbV9wcmltZV9pbXBvcnQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQlzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hX2J1ZikKLXsKLQlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7
Ci0Jc3RydWN0IHNnX3RhYmxlICpzZzsKLQlzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKnVvYmo7Ci0J
aW50IHJldDsKLQotCS8qIG5lZWQgdG8gYXR0YWNoICovCi0JZ2V0X2RldmljZShkZXYtPmRldik7
Ci0JYXR0YWNoID0gZG1hX2J1Zl9hdHRhY2goZG1hX2J1ZiwgZGV2LT5kZXYpOwotCWlmIChJU19F
UlIoYXR0YWNoKSkgewotCQlwdXRfZGV2aWNlKGRldi0+ZGV2KTsKLQkJcmV0dXJuIEVSUl9DQVNU
KGF0dGFjaCk7Ci0JfQotCi0JZ2V0X2RtYV9idWYoZG1hX2J1Zik7Ci0KLQlzZyA9IGRtYV9idWZf
bWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBETUFfQklESVJFQ1RJT05BTCk7Ci0JaWYgKElTX0VSUihz
ZykpIHsKLQkJcmV0ID0gUFRSX0VSUihzZyk7Ci0JCWdvdG8gZmFpbF9kZXRhY2g7Ci0JfQotCi0J
cmV0ID0gdWRsX3ByaW1lX2NyZWF0ZShkZXYsIGRtYV9idWYtPnNpemUsIHNnLCAmdW9iaik7Ci0J
aWYgKHJldCkKLQkJZ290byBmYWlsX3VubWFwOwotCi0JdW9iai0+YmFzZS5pbXBvcnRfYXR0YWNo
ID0gYXR0YWNoOwotCi0JcmV0dXJuICZ1b2JqLT5iYXNlOwotCi1mYWlsX3VubWFwOgotCWRtYV9i
dWZfdW5tYXBfYXR0YWNobWVudChhdHRhY2gsIHNnLCBETUFfQklESVJFQ1RJT05BTCk7Ci1mYWls
X2RldGFjaDoKLQlkbWFfYnVmX2RldGFjaChkbWFfYnVmLCBhdHRhY2gpOwotCWRtYV9idWZfcHV0
KGRtYV9idWYpOwotCXB1dF9kZXZpY2UoZGV2LT5kZXYpOwotCXJldHVybiBFUlJfUFRSKHJldCk7
Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9kcnYuaCBiL2RyaXZlcnMv
Z3B1L2RybS91ZGwvdWRsX2Rydi5oCmluZGV4IDYzMGU2NGFiYzk4Ni4uOTg3ZDk5YWUyZGZhIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9kcnYuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vdWRsL3VkbF9kcnYuaApAQCAtNzMsMTggKzczLDggQEAgc3RydWN0IHVkbF9kZXZpY2Ug
ewogCiAjZGVmaW5lIHRvX3VkbCh4KSBjb250YWluZXJfb2YoeCwgc3RydWN0IHVkbF9kZXZpY2Us
IGRybSkKIAotc3RydWN0IHVkbF9nZW1fb2JqZWN0IHsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
YmFzZTsKLQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOwotCXZvaWQgKnZtYXBwaW5nOwotCXN0cnVjdCBz
Z190YWJsZSAqc2c7Ci19OwotCi0jZGVmaW5lIHRvX3VkbF9ibyh4KSBjb250YWluZXJfb2YoeCwg
c3RydWN0IHVkbF9nZW1fb2JqZWN0LCBiYXNlKQotCiBzdHJ1Y3QgdWRsX2ZyYW1lYnVmZmVyIHsK
IAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyIGJhc2U7Ci0Jc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpv
Ymo7CiAJc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0ICpzaG1lbTsKIAlib29sIGFjdGl2ZV8x
NjsgLyogYWN0aXZlIG9uIHRoZSAxNi1iaXQgY2hhbm5lbCAqLwogfTsKQEAgLTEyMCwyNyArMTEw
LDggQEAgaW50IHVkbF9yZW5kZXJfaGxpbmUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGxv
Z19icHAsIHN0cnVjdCB1cmIgKip1cmJfcHRyLAogCQkgICAgIHUzMiBieXRlX29mZnNldCwgdTMy
IGRldmljZV9ieXRlX29mZnNldCwgdTMyIGJ5dGVfd2lkdGgsCiAJCSAgICAgaW50ICppZGVudF9w
dHIsIGludCAqc2VudF9wdHIpOwogCi1pbnQgdWRsX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmls
ZSAqZmlsZV9wcml2LAotCQkgICAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgIHN0cnVj
dCBkcm1fbW9kZV9jcmVhdGVfZHVtYiAqYXJncyk7Ci1pbnQgdWRsX2dlbV9tbWFwKHN0cnVjdCBk
cm1fZmlsZSAqZmlsZV9wcml2LCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkgdWludDMyX3Qg
aGFuZGxlLCB1aW50NjRfdCAqb2Zmc2V0KTsKLQogc3RydWN0IGRybV9nZW1fb2JqZWN0ICp1ZGxf
ZHJpdmVyX2dlbV9jcmVhdGVfb2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCQkg
ICAgc2l6ZV90IHNpemUpOwotdm9pZCB1ZGxfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqZ2VtX29iaik7Ci1zdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKnVkbF9nZW1fYWxsb2Nf
b2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJCSAgICBzaXplX3Qgc2l6ZSk7Ci1z
dHJ1Y3QgZG1hX2J1ZiAqdWRsX2dlbV9wcmltZV9leHBvcnQoc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmosIGludCBmbGFncyk7Ci1zdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnVkbF9nZW1fcHJpbWVf
aW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJc3RydWN0IGRtYV9idWYgKmRtYV9i
dWYpOwotCi1pbnQgdWRsX2dlbV9nZXRfcGFnZXMoc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpvYmop
Owotdm9pZCB1ZGxfZ2VtX3B1dF9wYWdlcyhzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaik7Ci1p
bnQgdWRsX2dlbV92bWFwKHN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqb2JqKTsKLXZvaWQgdWRsX2dl
bV92dW5tYXAoc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpvYmopOwotaW50IHVkbF9kcm1fZ2VtX21t
YXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKTsKLXZtX2Zh
dWx0X3QgdWRsX2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZik7CiAKIGludCB1ZGxfaGFu
ZGxlX2RhbWFnZShzdHJ1Y3QgdWRsX2ZyYW1lYnVmZmVyICpmYiwgaW50IHgsIGludCB5LAogCQkg
ICAgICBpbnQgd2lkdGgsIGludCBoZWlnaHQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3VkbC91ZGxfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9nZW0uYwppbmRleCAzNTU0
ZmZmYmYxZGIuLmFjODJlMDY0NjNiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3VkbC91
ZGxfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfZ2VtLmMKQEAgLTgwLDIwOSAr
ODAsMyBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnVkbF9kcml2ZXJfZ2VtX2NyZWF0ZV9vYmpl
Y3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCXJldHVybiBvYmo7CiB9Ci0KLXN0cnVjdCB1
ZGxfZ2VtX29iamVjdCAqdWRsX2dlbV9hbGxvY19vYmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKLQkJCQkJICAgIHNpemVfdCBzaXplKQotewotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
OwotCi0Jb2JqID0gZGV2LT5kcml2ZXItPmdlbV9jcmVhdGVfb2JqZWN0KGRldiwgc2l6ZSk7Ci0J
aWYgKG9iaiA9PSBOVUxMKQotCQlyZXR1cm4gTlVMTDsKLQotCWlmIChkcm1fZ2VtX29iamVjdF9p
bml0KGRldiwgb2JqLCBzaXplKSAhPSAwKSB7Ci0JCWtmcmVlKG9iaik7Ci0JCXJldHVybiBOVUxM
OwotCX0KLQotCXJldHVybiB0b191ZGxfYm8ob2JqKTsKLX0KLQotc3RhdGljIGludAotdWRsX2dl
bV9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAotCSAgICAgICBzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LAotCSAgICAgICB1aW50NjRfdCBzaXplLAotCSAgICAgICB1aW50MzJfdCAqaGFuZGxl
X3ApCi17Ci0Jc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpvYmo7Ci0JaW50IHJldDsKLQl1MzIgaGFu
ZGxlOwotCi0Jc2l6ZSA9IHJvdW5kdXAoc2l6ZSwgUEFHRV9TSVpFKTsKLQotCW9iaiA9IHVkbF9n
ZW1fYWxsb2Nfb2JqZWN0KGRldiwgc2l6ZSk7Ci0JaWYgKG9iaiA9PSBOVUxMKQotCQlyZXR1cm4g
LUVOT01FTTsKLQotCXJldCA9IGRybV9nZW1faGFuZGxlX2NyZWF0ZShmaWxlLCAmb2JqLT5iYXNl
LCAmaGFuZGxlKTsKLQlpZiAocmV0KSB7Ci0JCWRybV9nZW1fb2JqZWN0X3JlbGVhc2UoJm9iai0+
YmFzZSk7Ci0JCWtmcmVlKG9iaik7Ci0JCXJldHVybiByZXQ7Ci0JfQotCi0JZHJtX2dlbV9vYmpl
Y3RfcHV0X3VubG9ja2VkKCZvYmotPmJhc2UpOwotCSpoYW5kbGVfcCA9IGhhbmRsZTsKLQlyZXR1
cm4gMDsKLX0KLQotaW50IHVkbF9kdW1iX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCi0J
CSAgICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkgICAgc3RydWN0IGRybV9tb2RlX2NyZWF0
ZV9kdW1iICphcmdzKQotewotCWFyZ3MtPnBpdGNoID0gYXJncy0+d2lkdGggKiBESVZfUk9VTkRf
VVAoYXJncy0+YnBwLCA4KTsKLQlhcmdzLT5zaXplID0gYXJncy0+cGl0Y2ggKiBhcmdzLT5oZWln
aHQ7Ci0JcmV0dXJuIHVkbF9nZW1fY3JlYXRlKGZpbGUsIGRldiwKLQkJCSAgICAgIGFyZ3MtPnNp
emUsICZhcmdzLT5oYW5kbGUpOwotfQotCi1pbnQgdWRsX2RybV9nZW1fbW1hcChzdHJ1Y3QgZmls
ZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCi17Ci0Jc3RydWN0IGRybV9nZW1f
b2JqZWN0ICpvYmo7Ci0JaW50IHJldDsKLQotCXJldCA9IGRybV9nZW1fbW1hcChmaWxwLCB2bWEp
OwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlvYmogPSB2bWEtPnZtX3ByaXZhdGVfZGF0
YTsKLQotCXZtYS0+dm1fZmxhZ3MgJj0gflZNX1BGTk1BUDsKLQl2bWEtPnZtX2ZsYWdzIHw9IFZN
X01JWEVETUFQOwotCi0Jdm1hLT52bV9wYWdlX3Byb3QgPSB2bV9nZXRfcGFnZV9wcm90KHZtYS0+
dm1fZmxhZ3MpOwotCWlmIChvYmotPmltcG9ydF9hdHRhY2gpCi0JCXZtYS0+dm1fcGFnZV9wcm90
ID0gcGdwcm90X3dyaXRlY29tYmluZSh2bWEtPnZtX3BhZ2VfcHJvdCk7Ci0KLQlyZXR1cm4gcmV0
OwotfQotCi12bV9mYXVsdF90IHVkbF9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCi17
Ci0Jc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKLQlzdHJ1Y3QgdWRsX2dl
bV9vYmplY3QgKm9iaiA9IHRvX3VkbF9ibyh2bWEtPnZtX3ByaXZhdGVfZGF0YSk7Ci0Jc3RydWN0
IHBhZ2UgKnBhZ2U7Ci0JdW5zaWduZWQgaW50IHBhZ2Vfb2Zmc2V0OwotCi0JcGFnZV9vZmZzZXQg
PSAodm1mLT5hZGRyZXNzIC0gdm1hLT52bV9zdGFydCkgPj4gUEFHRV9TSElGVDsKLQotCWlmICgh
b2JqLT5wYWdlcykKLQkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKLQotCXBhZ2UgPSBvYmotPnBh
Z2VzW3BhZ2Vfb2Zmc2V0XTsKLQlyZXR1cm4gdm1mX2luc2VydF9wYWdlKHZtYSwgdm1mLT5hZGRy
ZXNzLCBwYWdlKTsKLX0KLQotaW50IHVkbF9nZW1fZ2V0X3BhZ2VzKHN0cnVjdCB1ZGxfZ2VtX29i
amVjdCAqb2JqKQotewotCXN0cnVjdCBwYWdlICoqcGFnZXM7Ci0KLQlpZiAob2JqLT5wYWdlcykK
LQkJcmV0dXJuIDA7Ci0KLQlwYWdlcyA9IGRybV9nZW1fZ2V0X3BhZ2VzKCZvYmotPmJhc2UpOwot
CWlmIChJU19FUlIocGFnZXMpKQotCQlyZXR1cm4gUFRSX0VSUihwYWdlcyk7Ci0KLQlvYmotPnBh
Z2VzID0gcGFnZXM7Ci0KLQlyZXR1cm4gMDsKLX0KLQotdm9pZCB1ZGxfZ2VtX3B1dF9wYWdlcyhz
dHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaikKLXsKLQlpZiAob2JqLT5iYXNlLmltcG9ydF9hdHRh
Y2gpIHsKLQkJa3ZmcmVlKG9iai0+cGFnZXMpOwotCQlvYmotPnBhZ2VzID0gTlVMTDsKLQkJcmV0
dXJuOwotCX0KLQotCWRybV9nZW1fcHV0X3BhZ2VzKCZvYmotPmJhc2UsIG9iai0+cGFnZXMsIGZh
bHNlLCBmYWxzZSk7Ci0Jb2JqLT5wYWdlcyA9IE5VTEw7Ci19Ci0KLWludCB1ZGxfZ2VtX3ZtYXAo
c3RydWN0IHVkbF9nZW1fb2JqZWN0ICpvYmopCi17Ci0JaW50IHBhZ2VfY291bnQgPSBvYmotPmJh
c2Uuc2l6ZSAvIFBBR0VfU0laRTsKLQlpbnQgcmV0OwotCi0JaWYgKG9iai0+YmFzZS5pbXBvcnRf
YXR0YWNoKSB7Ci0JCW9iai0+dm1hcHBpbmcgPSBkbWFfYnVmX3ZtYXAob2JqLT5iYXNlLmltcG9y
dF9hdHRhY2gtPmRtYWJ1Zik7Ci0JCWlmICghb2JqLT52bWFwcGluZykKLQkJCXJldHVybiAtRU5P
TUVNOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQlyZXQgPSB1ZGxfZ2VtX2dldF9wYWdlcyhvYmopOwot
CWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlvYmotPnZtYXBwaW5nID0gdm1hcChvYmotPnBh
Z2VzLCBwYWdlX2NvdW50LCAwLCBQQUdFX0tFUk5FTCk7Ci0JaWYgKCFvYmotPnZtYXBwaW5nKQot
CQlyZXR1cm4gLUVOT01FTTsKLQlyZXR1cm4gMDsKLX0KLQotdm9pZCB1ZGxfZ2VtX3Z1bm1hcChz
dHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaikKLXsKLQlpZiAob2JqLT5iYXNlLmltcG9ydF9hdHRh
Y2gpIHsKLQkJZG1hX2J1Zl92dW5tYXAob2JqLT5iYXNlLmltcG9ydF9hdHRhY2gtPmRtYWJ1Ziwg
b2JqLT52bWFwcGluZyk7Ci0JCXJldHVybjsKLQl9Ci0KLQl2dW5tYXAob2JqLT52bWFwcGluZyk7
Ci0KLQl1ZGxfZ2VtX3B1dF9wYWdlcyhvYmopOwotfQotCi12b2lkIHVkbF9nZW1fZnJlZV9vYmpl
Y3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW1fb2JqKQotewotCXN0cnVjdCB1ZGxfZ2VtX29i
amVjdCAqb2JqID0gdG9fdWRsX2JvKGdlbV9vYmopOwotCi0JaWYgKG9iai0+dm1hcHBpbmcpCi0J
CXVkbF9nZW1fdnVubWFwKG9iaik7Ci0KLQlpZiAoZ2VtX29iai0+aW1wb3J0X2F0dGFjaCkgewot
CQlkcm1fcHJpbWVfZ2VtX2Rlc3Ryb3koZ2VtX29iaiwgb2JqLT5zZyk7Ci0JCXB1dF9kZXZpY2Uo
Z2VtX29iai0+ZGV2LT5kZXYpOwotCX0KLQotCWlmIChvYmotPnBhZ2VzKQotCQl1ZGxfZ2VtX3B1
dF9wYWdlcyhvYmopOwotCi0JZHJtX2dlbV9mcmVlX21tYXBfb2Zmc2V0KGdlbV9vYmopOwotfQot
Ci0vKiB0aGUgZHVtYiBpbnRlcmZhY2UgZG9lc24ndCB3b3JrIHdpdGggdGhlIEdFTSBzdHJhaWdo
dCBNTUFQCi0gICBpbnRlcmZhY2UsIGl0IGV4cGVjdHMgdG8gZG8gTU1BUCBvbiB0aGUgZHJtIGZk
LCBsaWtlIG5vcm1hbCAqLwotaW50IHVkbF9nZW1fbW1hcChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUs
IHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCSB1aW50MzJfdCBoYW5kbGUsIHVpbnQ2NF90ICpv
ZmZzZXQpCi17Ci0Jc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpnb2JqOwotCXN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqOwotCXN0cnVjdCB1ZGxfZGV2aWNlICp1ZGwgPSB0b191ZGwoZGV2KTsKLQlp
bnQgcmV0ID0gMDsKLQotCW11dGV4X2xvY2soJnVkbC0+Z2VtX2xvY2spOwotCW9iaiA9IGRybV9n
ZW1fb2JqZWN0X2xvb2t1cChmaWxlLCBoYW5kbGUpOwotCWlmIChvYmogPT0gTlVMTCkgewotCQly
ZXQgPSAtRU5PRU5UOwotCQlnb3RvIHVubG9jazsKLQl9Ci0JZ29iaiA9IHRvX3VkbF9ibyhvYmop
OwotCi0JcmV0ID0gdWRsX2dlbV9nZXRfcGFnZXMoZ29iaik7Ci0JaWYgKHJldCkKLQkJZ290byBv
dXQ7Ci0JcmV0ID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQob2JqKTsKLQlpZiAocmV0KQot
CQlnb3RvIG91dDsKLQotCSpvZmZzZXQgPSBkcm1fdm1hX25vZGVfb2Zmc2V0X2FkZHIoJmdvYmot
PmJhc2Uudm1hX25vZGUpOwotCi1vdXQ6Ci0JZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZn
b2JqLT5iYXNlKTsKLXVubG9jazoKLQltdXRleF91bmxvY2soJnVkbC0+Z2VtX2xvY2spOwotCXJl
dHVybiByZXQ7Ci19Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
