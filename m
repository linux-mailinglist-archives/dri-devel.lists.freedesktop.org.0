Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0763C1A32E3
	for <lists+dri-devel@lfdr.de>; Thu,  9 Apr 2020 13:01:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2A5F289FF9;
	Thu,  9 Apr 2020 11:01:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DBBCF6E0FF;
 Thu,  9 Apr 2020 11:01:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 20849844-1500050 
 for multiple; Thu, 09 Apr 2020 12:01:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 3/3] dma-buf: Exercise dma-fence-chain under selftests
Date: Thu,  9 Apr 2020 12:01:01 +0100
Message-Id: <20200409110101.18400-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200409110101.18400-1-chris@chris-wilson.co.uk>
References: <20200409110101.18400-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org,
 Venkata Sandeep Dhanalakota <venkata.s.dhanalakota@intel.com>,
 Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QSBmZXcgdmVyeSBzaW1wbGUgdGVzdGNhc2VzIHRvIGV4ZXJjaXNlIHRoZSBkbWEtZmVuY2UtY2hh
aW4gQVBJLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24u
Y28udWs+ClJldmlld2VkLWJ5OiBWZW5rYXRhIFNhbmRlZXAgRGhhbmFsYWtvdGEgPHZlbmthdGEu
cy5kaGFuYWxha290YUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlICAg
ICAgICAgICAgIHwgICAzICstCiBkcml2ZXJzL2RtYS1idWYvc2VsZnRlc3RzLmggICAgICAgICAg
fCAgIDEgKwogZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS1jaGFpbi5jIHwgNzEzICsrKysr
KysrKysrKysrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFuZ2VkLCA3MTYgaW5zZXJ0aW9ucygr
KSwgMSBkZWxldGlvbigtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9zdC1k
bWEtZmVuY2UtY2hhaW4uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSBi
L2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQppbmRleCA5YzE5MDAyNmJmYWIuLjk5NWUwNWY2MDlm
ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1h
LWJ1Zi9NYWtlZmlsZQpAQCAtOSw2ICs5LDcgQEAgb2JqLSQoQ09ORklHX1VETUFCVUYpCQkrPSB1
ZG1hYnVmLm8KIAogZG1hYnVmX3NlbGZ0ZXN0cy15IDo9IFwKIAlzZWxmdGVzdC5vIFwKLQlzdC1k
bWEtZmVuY2UubworCXN0LWRtYS1mZW5jZS5vIFwKKwlzdC1kbWEtZmVuY2UtY2hhaW4ubwogCiBv
YmotJChDT05GSUdfRE1BQlVGX1NFTEZURVNUUykJKz0gZG1hYnVmX3NlbGZ0ZXN0cy5vCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc2VsZnRlc3RzLmggYi9kcml2ZXJzL2RtYS1idWYvc2Vs
ZnRlc3RzLmgKaW5kZXggNTMyMDM4NmYwMmU1Li41NTkxOGVmOWFkYWIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZG1hLWJ1Zi9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2RtYS1idWYvc2VsZnRlc3Rz
LmgKQEAgLTExLDMgKzExLDQgQEAKICAqLwogc2VsZnRlc3Qoc2FuaXR5Y2hlY2ssIF9fc2FuaXR5
Y2hlY2tfXykgLyoga2VlcCBmaXJzdCAoaWd0IHNlbGZjaGVjaykgKi8KIHNlbGZ0ZXN0KGRtYV9m
ZW5jZSwgZG1hX2ZlbmNlKQorc2VsZnRlc3QoZG1hX2ZlbmNlX2NoYWluLCBkbWFfZmVuY2VfY2hh
aW4pCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLWNoYWluLmMgYi9k
cml2ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLWNoYWluLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi5iZDA4YmE2N2IwM2IKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2
ZXJzL2RtYS1idWYvc3QtZG1hLWZlbmNlLWNoYWluLmMKQEAgLTAsMCArMSw3MTMgQEAKKy8vIFNQ
RFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKworLyoKKyAqIENvcHlyaWdodCDCqSAyMDE5IElu
dGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVk
ZSA8bGludXgvZG1hLWZlbmNlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLWNoYWluLmg+
CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+CisjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgor
I2luY2x1ZGUgPGxpbnV4L21tLmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQvc2lnbmFsLmg+Cisj
aW5jbHVkZSA8bGludXgvc2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CisjaW5j
bHVkZSA8bGludXgvcmFuZG9tLmg+CisKKyNpbmNsdWRlICJzZWxmdGVzdC5oIgorCitzdGF0aWMg
c3RydWN0IGttZW1fY2FjaGUgKnNsYWJfZmVuY2VzOworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBt
b2NrX2ZlbmNlIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlIGJhc2U7CisJc3BpbmxvY2tfdCBsb2NrOwor
fSAqdG9fbW9ja19mZW5jZShzdHJ1Y3QgZG1hX2ZlbmNlICpmKSB7CisJcmV0dXJuIGNvbnRhaW5l
cl9vZihmLCBzdHJ1Y3QgbW9ja19mZW5jZSwgYmFzZSk7Cit9CisKK3N0YXRpYyBjb25zdCBjaGFy
ICptb2NrX25hbWUoc3RydWN0IGRtYV9mZW5jZSAqZikKK3sKKwlyZXR1cm4gIm1vY2siOworfQor
CitzdGF0aWMgdm9pZCBtb2NrX2ZlbmNlX3JlbGVhc2Uoc3RydWN0IGRtYV9mZW5jZSAqZikKK3sK
KwlrbWVtX2NhY2hlX2ZyZWUoc2xhYl9mZW5jZXMsIHRvX21vY2tfZmVuY2UoZikpOworfQorCitz
dGF0aWMgY29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMgbW9ja19vcHMgPSB7CisJLmdldF9kcml2
ZXJfbmFtZSA9IG1vY2tfbmFtZSwKKwkuZ2V0X3RpbWVsaW5lX25hbWUgPSBtb2NrX25hbWUsCisJ
LnJlbGVhc2UgPSBtb2NrX2ZlbmNlX3JlbGVhc2UsCit9OworCitzdGF0aWMgc3RydWN0IGRtYV9m
ZW5jZSAqbW9ja19mZW5jZSh2b2lkKQoreworCXN0cnVjdCBtb2NrX2ZlbmNlICpmOworCisJZiA9
IGttZW1fY2FjaGVfYWxsb2Moc2xhYl9mZW5jZXMsIEdGUF9LRVJORUwpOworCWlmICghZikKKwkJ
cmV0dXJuIE5VTEw7CisKKwlzcGluX2xvY2tfaW5pdCgmZi0+bG9jayk7CisJZG1hX2ZlbmNlX2lu
aXQoJmYtPmJhc2UsICZtb2NrX29wcywgJmYtPmxvY2ssIDAsIDApOworCisJcmV0dXJuICZmLT5i
YXNlOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBtb2NrX2NoYWluIHsKKwlzdHJ1Y3QgZG1h
X2ZlbmNlX2NoYWluIGJhc2U7Cit9ICp0b19tb2NrX2NoYWluKHN0cnVjdCBkbWFfZmVuY2UgKmYp
IHsKKwlyZXR1cm4gY29udGFpbmVyX29mKGYsIHN0cnVjdCBtb2NrX2NoYWluLCBiYXNlLmJhc2Up
OworfQorCitzdGF0aWMgc3RydWN0IGRtYV9mZW5jZSAqbW9ja19jaGFpbihzdHJ1Y3QgZG1hX2Zl
bmNlICpwcmV2LAorCQkJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwKKwkJCQkgICAgdTY0
IHNlcW5vKQoreworCXN0cnVjdCBtb2NrX2NoYWluICpmOworCisJZiA9IGttYWxsb2Moc2l6ZW9m
KCpmKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFmKQorCQlyZXR1cm4gTlVMTDsKKworCWRtYV9mZW5j
ZV9jaGFpbl9pbml0KCZmLT5iYXNlLAorCQkJICAgICBkbWFfZmVuY2VfZ2V0KHByZXYpLAorCQkJ
ICAgICBkbWFfZmVuY2VfZ2V0KGZlbmNlKSwKKwkJCSAgICAgc2Vxbm8pOworCisJcmV0dXJuICZm
LT5iYXNlLmJhc2U7Cit9CisKK3N0YXRpYyBpbnQgc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQorewor
CXN0cnVjdCBkbWFfZmVuY2UgKmYsICpjaGFpbjsKKwlpbnQgZXJyID0gMDsKKworCWYgPSBtb2Nr
X2ZlbmNlKCk7CisJaWYgKCFmKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWNoYWluID0gbW9ja19j
aGFpbihOVUxMLCBmLCAxKTsKKwlpZiAoIWNoYWluKQorCQllcnIgPSAtRU5PTUVNOworCisJZG1h
X2ZlbmNlX3NpZ25hbChmKTsKKwlkbWFfZmVuY2VfcHV0KGYpOworCisJZG1hX2ZlbmNlX3B1dChj
aGFpbik7CisKKwlyZXR1cm4gZXJyOworfQorCitzdHJ1Y3QgZmVuY2VfY2hhaW5zIHsKKwl1bnNp
Z25lZCBpbnQgY2hhaW5fbGVuZ3RoOworCXN0cnVjdCBkbWFfZmVuY2UgKipmZW5jZXM7CisJc3Ry
dWN0IGRtYV9mZW5jZSAqKmNoYWluczsKKworCXN0cnVjdCBkbWFfZmVuY2UgKnRhaWw7Cit9Owor
CitzdGF0aWMgdWludDY0X3Qgc2Vxbm9faW5jKHVuc2lnbmVkIGludCBpKQoreworCXJldHVybiBp
ICsgMTsKK30KKworc3RhdGljIGludCBmZW5jZV9jaGFpbnNfaW5pdChzdHJ1Y3QgZmVuY2VfY2hh
aW5zICpmYywgdW5zaWduZWQgaW50IGNvdW50LAorCQkJICAgICB1aW50NjRfdCAoKnNlcW5vX2Zu
KSh1bnNpZ25lZCBpbnQpKQoreworCXVuc2lnbmVkIGludCBpOworCWludCBlcnIgPSAwOworCisJ
ZmMtPmNoYWlucyA9IGt2bWFsbG9jX2FycmF5KGNvdW50LCBzaXplb2YoKmZjLT5jaGFpbnMpLAor
CQkJCSAgICBHRlBfS0VSTkVMIHwgX19HRlBfWkVSTyk7CisJaWYgKCFmYy0+Y2hhaW5zKQorCQly
ZXR1cm4gLUVOT01FTTsKKworCWZjLT5mZW5jZXMgPSBrdm1hbGxvY19hcnJheShjb3VudCwgc2l6
ZW9mKCpmYy0+ZmVuY2VzKSwKKwkJCQkgICAgR0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8pOworCWlm
ICghZmMtPmZlbmNlcykgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9jaGFpbnM7CisJ
fQorCisJZmMtPnRhaWwgPSBOVUxMOworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJ
CWZjLT5mZW5jZXNbaV0gPSBtb2NrX2ZlbmNlKCk7CisJCWlmICghZmMtPmZlbmNlc1tpXSkgewor
CQkJZXJyID0gLUVOT01FTTsKKwkJCWdvdG8gdW53aW5kOworCQl9CisKKwkJZmMtPmNoYWluc1tp
XSA9IG1vY2tfY2hhaW4oZmMtPnRhaWwsCisJCQkJCSAgIGZjLT5mZW5jZXNbaV0sCisJCQkJCSAg
IHNlcW5vX2ZuKGkpKTsKKwkJaWYgKCFmYy0+Y2hhaW5zW2ldKSB7CisJCQllcnIgPSAtRU5PTUVN
OworCQkJZ290byB1bndpbmQ7CisJCX0KKworCQlmYy0+dGFpbCA9IGZjLT5jaGFpbnNbaV07CisJ
fQorCisJZmMtPmNoYWluX2xlbmd0aCA9IGk7CisJcmV0dXJuIDA7CisKK3Vud2luZDoKKwlmb3Ig
KGkgPSAwOyBpIDwgY291bnQ7IGkrKykgeworCQlkbWFfZmVuY2VfcHV0KGZjLT5mZW5jZXNbaV0p
OworCQlkbWFfZmVuY2VfcHV0KGZjLT5jaGFpbnNbaV0pOworCX0KKwlrdmZyZWUoZmMtPmZlbmNl
cyk7CitlcnJfY2hhaW5zOgorCWt2ZnJlZShmYy0+Y2hhaW5zKTsKKwlyZXR1cm4gZXJyOworfQor
CitzdGF0aWMgdm9pZCBmZW5jZV9jaGFpbnNfZmluaShzdHJ1Y3QgZmVuY2VfY2hhaW5zICpmYykK
K3sKKwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBmYy0+Y2hhaW5fbGVuZ3Ro
OyBpKyspIHsKKwkJZG1hX2ZlbmNlX3NpZ25hbChmYy0+ZmVuY2VzW2ldKTsKKwkJZG1hX2ZlbmNl
X3B1dChmYy0+ZmVuY2VzW2ldKTsKKwl9CisJa3ZmcmVlKGZjLT5mZW5jZXMpOworCisJZm9yIChp
ID0gMDsgaSA8IGZjLT5jaGFpbl9sZW5ndGg7IGkrKykKKwkJZG1hX2ZlbmNlX3B1dChmYy0+Y2hh
aW5zW2ldKTsKKwlrdmZyZWUoZmMtPmNoYWlucyk7Cit9CisKK3N0YXRpYyBpbnQgZmluZF9zZXFu
byh2b2lkICphcmcpCit7CisJc3RydWN0IGZlbmNlX2NoYWlucyBmYzsKKwlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKKwlpbnQgZXJyOworCWludCBpOworCisJZXJyID0gZmVuY2VfY2hhaW5zX2lu
aXQoJmZjLCA2NCwgc2Vxbm9faW5jKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZmVu
Y2UgPSBkbWFfZmVuY2VfZ2V0KGZjLnRhaWwpOworCWVyciA9IGRtYV9mZW5jZV9jaGFpbl9maW5k
X3NlcW5vKCZmZW5jZSwgMCk7CisJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJaWYgKGVycikgewor
CQlwcl9lcnIoIlJlcG9ydGVkICVkIGZvciBmaW5kX3NlcW5vKDApIVxuIiwgZXJyKTsKKwkJZ290
byBlcnI7CisJfQorCisJZm9yIChpID0gMDsgaSA8IGZjLmNoYWluX2xlbmd0aDsgaSsrKSB7CisJ
CWZlbmNlID0gZG1hX2ZlbmNlX2dldChmYy50YWlsKTsKKwkJZXJyID0gZG1hX2ZlbmNlX2NoYWlu
X2ZpbmRfc2Vxbm8oJmZlbmNlLCBpICsgMSk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQlp
ZiAoZXJyKSB7CisJCQlwcl9lcnIoIlJlcG9ydGVkICVkIGZvciBmaW5kX3NlcW5vKCVkOiVkKSFc
biIsCisJCQkgICAgICAgZXJyLCBmYy5jaGFpbl9sZW5ndGggKyAxLCBpICsgMSk7CisJCQlnb3Rv
IGVycjsKKwkJfQorCQlpZiAoZmVuY2UgIT0gZmMuY2hhaW5zW2ldKSB7CisJCQlwcl9lcnIoIklu
Y29ycmVjdCBmZW5jZSByZXBvcnRlZCBieSBmaW5kX3NlcW5vKCVkOiVkKVxuIiwKKwkJCSAgICAg
ICBmYy5jaGFpbl9sZW5ndGggKyAxLCBpICsgMSk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290
byBlcnI7CisJCX0KKworCQlkbWFfZmVuY2VfZ2V0KGZlbmNlKTsKKwkJZXJyID0gZG1hX2ZlbmNl
X2NoYWluX2ZpbmRfc2Vxbm8oJmZlbmNlLCBpICsgMSk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2Up
OworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIkVycm9yIHJlcG9ydGVkIGZvciBmaW5kaW5nIHNl
bGZcbiIpOworCQkJZ290byBlcnI7CisJCX0KKwkJaWYgKGZlbmNlICE9IGZjLmNoYWluc1tpXSkg
eworCQkJcHJfZXJyKCJJbmNvcnJlY3QgZmVuY2UgcmVwb3J0ZWQgYnkgZmluZCBzZWxmXG4iKTsK
KwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWRtYV9mZW5jZV9nZXQo
ZmVuY2UpOworCQllcnIgPSBkbWFfZmVuY2VfY2hhaW5fZmluZF9zZXFubygmZmVuY2UsIGkgKyAy
KTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCWlmICghZXJyKSB7CisJCQlwcl9lcnIoIkVy
cm9yIG5vdCByZXBvcnRlZCBmb3IgZnV0dXJlIGZlbmNlOiBmaW5kX3NlcW5vKCVkOiVkKSFcbiIs
CisJCQkgICAgICAgaSArIDEsIGkgKyAyKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVy
cjsKKwkJfQorCisJCWRtYV9mZW5jZV9nZXQoZmVuY2UpOworCQllcnIgPSBkbWFfZmVuY2VfY2hh
aW5fZmluZF9zZXFubygmZmVuY2UsIGkpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJaWYg
KGVycikgeworCQkJcHJfZXJyKCJFcnJvciByZXBvcnRlZCBmb3IgcHJldmlvdXMgZmVuY2UhXG4i
KTsKKwkJCWdvdG8gZXJyOworCQl9CisJCWlmIChpID4gMCAmJiBmZW5jZSAhPSBmYy5jaGFpbnNb
aSAtIDFdKSB7CisJCQlwcl9lcnIoIkluY29ycmVjdCBmZW5jZSByZXBvcnRlZCBieSBmaW5kX3Nl
cW5vKCVkOiVkKVxuIiwKKwkJCSAgICAgICBpICsgMSwgaSk7CisJCQllcnIgPSAtRUlOVkFMOwor
CQkJZ290byBlcnI7CisJCX0KKwl9CisKK2VycjoKKwlmZW5jZV9jaGFpbnNfZmluaSgmZmMpOwor
CXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgZmluZF9zaWduYWxlZCh2b2lkICphcmcpCit7
CisJc3RydWN0IGZlbmNlX2NoYWlucyBmYzsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKwlp
bnQgZXJyOworCisJZXJyID0gZmVuY2VfY2hhaW5zX2luaXQoJmZjLCAyLCBzZXFub19pbmMpOwor
CWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlkbWFfZmVuY2Vfc2lnbmFsKGZjLmZlbmNlc1sw
XSk7CisKKwlmZW5jZSA9IGRtYV9mZW5jZV9nZXQoZmMudGFpbCk7CisJZXJyID0gZG1hX2ZlbmNl
X2NoYWluX2ZpbmRfc2Vxbm8oJmZlbmNlLCAxKTsKKwlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwlp
ZiAoZXJyKSB7CisJCXByX2VycigiUmVwb3J0ZWQgJWQgZm9yIGZpbmRfc2Vxbm8oKSFcbiIsIGVy
cik7CisJCWdvdG8gZXJyOworCX0KKworCWlmIChmZW5jZSAmJiBmZW5jZSAhPSBmYy5jaGFpbnNb
MF0pIHsKKwkJcHJfZXJyKCJJbmNvcnJlY3QgY2hhaW4tZmVuY2Uuc2Vxbm86JWxsZCByZXBvcnRl
ZCBmb3IgY29tcGxldGVkIHNlcW5vOjFcbiIsCisJCSAgICAgICBmZW5jZS0+c2Vxbm8pOworCisJ
CWRtYV9mZW5jZV9nZXQoZmVuY2UpOworCQllcnIgPSBkbWFfZmVuY2VfY2hhaW5fZmluZF9zZXFu
bygmZmVuY2UsIDEpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJaWYgKGVycikKKwkJCXBy
X2VycigiUmVwb3J0ZWQgJWQgZm9yIGZpbmRpbmcgc2VsZiFcbiIsIGVycik7CisKKwkJZXJyID0g
LUVJTlZBTDsKKwl9CisKK2VycjoKKwlmZW5jZV9jaGFpbnNfZmluaSgmZmMpOworCXJldHVybiBl
cnI7Cit9CisKK3N0YXRpYyBpbnQgZmluZF9vdXRfb2Zfb3JkZXIodm9pZCAqYXJnKQoreworCXN0
cnVjdCBmZW5jZV9jaGFpbnMgZmM7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CisJaW50IGVy
cjsKKworCWVyciA9IGZlbmNlX2NoYWluc19pbml0KCZmYywgMywgc2Vxbm9faW5jKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJZG1hX2ZlbmNlX3NpZ25hbChmYy5mZW5jZXNbMV0pOwor
CisJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0KGZjLnRhaWwpOworCWVyciA9IGRtYV9mZW5jZV9jaGFp
bl9maW5kX3NlcW5vKCZmZW5jZSwgMik7CisJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJaWYgKGVy
cikgeworCQlwcl9lcnIoIlJlcG9ydGVkICVkIGZvciBmaW5kX3NlcW5vKCkhXG4iLCBlcnIpOwor
CQlnb3RvIGVycjsKKwl9CisKKwlpZiAoZmVuY2UgJiYgZmVuY2UgIT0gZmMuY2hhaW5zWzFdKSB7
CisJCXByX2VycigiSW5jb3JyZWN0IGNoYWluLWZlbmNlLnNlcW5vOiVsbGQgcmVwb3J0ZWQgZm9y
IGNvbXBsZXRlZCBzZXFubzoyXG4iLAorCQkgICAgICAgZmVuY2UtPnNlcW5vKTsKKworCQlkbWFf
ZmVuY2VfZ2V0KGZlbmNlKTsKKwkJZXJyID0gZG1hX2ZlbmNlX2NoYWluX2ZpbmRfc2Vxbm8oJmZl
bmNlLCAyKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCWlmIChlcnIpCisJCQlwcl9lcnIo
IlJlcG9ydGVkICVkIGZvciBmaW5kaW5nIHNlbGYhXG4iLCBlcnIpOworCisJCWVyciA9IC1FSU5W
QUw7CisJfQorCitlcnI6CisJZmVuY2VfY2hhaW5zX2ZpbmkoJmZjKTsKKwlyZXR1cm4gZXJyOwor
fQorCitzdGF0aWMgdWludDY0X3Qgc2Vxbm9faW5jMih1bnNpZ25lZCBpbnQgaSkKK3sKKwlyZXR1
cm4gMiAqIGkgKyAyOworfQorCitzdGF0aWMgaW50IGZpbmRfZ2FwKHZvaWQgKmFyZykKK3sKKwlz
dHJ1Y3QgZmVuY2VfY2hhaW5zIGZjOworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOworCWludCBl
cnI7CisJaW50IGk7CisKKwllcnIgPSBmZW5jZV9jaGFpbnNfaW5pdCgmZmMsIDY0LCBzZXFub19p
bmMyKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9yIChpID0gMDsgaSA8IGZjLmNo
YWluX2xlbmd0aDsgaSsrKSB7CisJCWZlbmNlID0gZG1hX2ZlbmNlX2dldChmYy50YWlsKTsKKwkJ
ZXJyID0gZG1hX2ZlbmNlX2NoYWluX2ZpbmRfc2Vxbm8oJmZlbmNlLCAyICogaSArIDEpOworCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJaWYgKGVycikgeworCQkJcHJfZXJyKCJSZXBvcnRlZCAl
ZCBmb3IgZmluZF9zZXFubyglZDolZCkhXG4iLAorCQkJICAgICAgIGVyciwgZmMuY2hhaW5fbGVu
Z3RoICsgMSwgMiAqIGkgKyAxKTsKKwkJCWdvdG8gZXJyOworCQl9CisJCWlmIChmZW5jZSAhPSBm
Yy5jaGFpbnNbaV0pIHsKKwkJCXByX2VycigiSW5jb3JyZWN0IGZlbmNlLnNlcW5vOiVsbGQgcmVw
b3J0ZWQgYnkgZmluZF9zZXFubyglZDolZClcbiIsCisJCQkgICAgICAgZmVuY2UtPnNlcW5vLAor
CQkJICAgICAgIGZjLmNoYWluX2xlbmd0aCArIDEsCisJCQkgICAgICAgMiAqIGkgKyAxKTsKKwkJ
CWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWRtYV9mZW5jZV9nZXQoZmVu
Y2UpOworCQllcnIgPSBkbWFfZmVuY2VfY2hhaW5fZmluZF9zZXFubygmZmVuY2UsIDIgKiBpICsg
Mik7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIkVy
cm9yIHJlcG9ydGVkIGZvciBmaW5kaW5nIHNlbGZcbiIpOworCQkJZ290byBlcnI7CisJCX0KKwkJ
aWYgKGZlbmNlICE9IGZjLmNoYWluc1tpXSkgeworCQkJcHJfZXJyKCJJbmNvcnJlY3QgZmVuY2Ug
cmVwb3J0ZWQgYnkgZmluZCBzZWxmXG4iKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVy
cjsKKwkJfQorCX0KKworZXJyOgorCWZlbmNlX2NoYWluc19maW5pKCZmYyk7CisJcmV0dXJuIGVy
cjsKK30KKworc3RydWN0IGZpbmRfcmFjZSB7CisJc3RydWN0IGZlbmNlX2NoYWlucyBmYzsKKwlh
dG9taWNfdCBjaGlsZHJlbjsKK307CisKK3N0YXRpYyBpbnQgX19maW5kX3JhY2Uodm9pZCAqYXJn
KQoreworCXN0cnVjdCBmaW5kX3JhY2UgKmRhdGEgPSBhcmc7CisJaW50IGVyciA9IDA7CisKKwl3
aGlsZSAoIWt0aHJlYWRfc2hvdWxkX3N0b3AoKSkgeworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSA9IGRtYV9mZW5jZV9nZXQoZGF0YS0+ZmMudGFpbCk7CisJCWludCBzZXFubzsKKworCQlzZXFu
byA9IHByYW5kb21fdTMyX21heChkYXRhLT5mYy5jaGFpbl9sZW5ndGgpICsgMTsKKworCQllcnIg
PSBkbWFfZmVuY2VfY2hhaW5fZmluZF9zZXFubygmZmVuY2UsIHNlcW5vKTsKKwkJaWYgKGVycikg
eworCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmluZCBmZW5jZSBzZXFubzolZFxuIiwKKwkJCSAgICAg
ICBzZXFubyk7CisJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJCWJyZWFrOworCQl9CisJCWlm
ICghZmVuY2UpCisJCQlnb3RvIHNpZ25hbDsKKworCQllcnIgPSBkbWFfZmVuY2VfY2hhaW5fZmlu
ZF9zZXFubygmZmVuY2UsIHNlcW5vKTsKKwkJaWYgKGVycikgeworCQkJcHJfZXJyKCJSZXBvcnRl
ZCBhbiBpbnZhbGlkIGZlbmNlIGZvciBmaW5kLXNlbGY6JWRcbiIsCisJCQkgICAgICAgc2Vxbm8p
OworCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCQlicmVhazsKKwkJfQorCisJCWlmIChmZW5j
ZS0+c2Vxbm8gPCBzZXFubykgeworCQkJcHJfZXJyKCJSZXBvcnRlZCBhbiBlYXJsaWVyIGZlbmNl
LnNlcW5vOiVsbGQgZm9yIHNlcW5vOiVkXG4iLAorCQkJICAgICAgIGZlbmNlLT5zZXFubywgc2Vx
bm8pOworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQkJYnJl
YWs7CisJCX0KKworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKworc2lnbmFsOgorCQlzZXFubyA9
IHByYW5kb21fdTMyX21heChkYXRhLT5mYy5jaGFpbl9sZW5ndGggLSAxKTsKKwkJZG1hX2ZlbmNl
X3NpZ25hbChkYXRhLT5mYy5mZW5jZXNbc2Vxbm9dKTsKKwkJY29uZF9yZXNjaGVkKCk7CisJfQor
CisJaWYgKGF0b21pY19kZWNfYW5kX3Rlc3QoJmRhdGEtPmNoaWxkcmVuKSkKKwkJd2FrZV91cF92
YXIoJmRhdGEtPmNoaWxkcmVuKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGZpbmRf
cmFjZSh2b2lkICphcmcpCit7CisJc3RydWN0IGZpbmRfcmFjZSBkYXRhOworCWludCBuY3B1cyA9
IG51bV9vbmxpbmVfY3B1cygpOworCXN0cnVjdCB0YXNrX3N0cnVjdCAqKnRocmVhZHM7CisJdW5z
aWduZWQgbG9uZyBjb3VudDsKKwlpbnQgZXJyOworCWludCBpOworCisJZXJyID0gZmVuY2VfY2hh
aW5zX2luaXQoJmRhdGEuZmMsIDY0IDw8IDEwLCBzZXFub19pbmMpOworCWlmIChlcnIpCisJCXJl
dHVybiBlcnI7CisKKwl0aHJlYWRzID0ga21hbGxvY19hcnJheShuY3B1cywgc2l6ZW9mKCp0aHJl
YWRzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF0aHJlYWRzKSB7CisJCWVyciA9IC1FTk9NRU07CisJ
CWdvdG8gZXJyOworCX0KKworCWF0b21pY19zZXQoJmRhdGEuY2hpbGRyZW4sIDApOworCWZvciAo
aSA9IDA7IGkgPCBuY3B1czsgaSsrKSB7CisJCXRocmVhZHNbaV0gPSBrdGhyZWFkX3J1bihfX2Zp
bmRfcmFjZSwgJmRhdGEsICJkbWFidWYvJWQiLCBpKTsKKwkJaWYgKElTX0VSUih0aHJlYWRzW2ld
KSkgeworCQkJbmNwdXMgPSBpOworCQkJYnJlYWs7CisJCX0KKwkJYXRvbWljX2luYygmZGF0YS5j
aGlsZHJlbik7CisJCWdldF90YXNrX3N0cnVjdCh0aHJlYWRzW2ldKTsKKwl9CisKKwl3YWl0X3Zh
cl9ldmVudF90aW1lb3V0KCZkYXRhLmNoaWxkcmVuLAorCQkJICAgICAgICFhdG9taWNfcmVhZCgm
ZGF0YS5jaGlsZHJlbiksCisJCQkgICAgICAgNSAqIEhaKTsKKworCWZvciAoaSA9IDA7IGkgPCBu
Y3B1czsgaSsrKSB7CisJCWludCByZXQ7CisKKwkJcmV0ID0ga3RocmVhZF9zdG9wKHRocmVhZHNb
aV0pOworCQlpZiAocmV0ICYmICFlcnIpCisJCQllcnIgPSByZXQ7CisJCXB1dF90YXNrX3N0cnVj
dCh0aHJlYWRzW2ldKTsKKwl9CisJa2ZyZWUodGhyZWFkcyk7CisKKwljb3VudCA9IDA7CisJZm9y
IChpID0gMDsgaSA8IGRhdGEuZmMuY2hhaW5fbGVuZ3RoOyBpKyspCisJCWlmIChkbWFfZmVuY2Vf
aXNfc2lnbmFsZWQoZGF0YS5mYy5mZW5jZXNbaV0pKQorCQkJY291bnQrKzsKKwlwcl9pbmZvKCJD
b21wbGV0ZWQgJWx1IGN5Y2xlc1xuIiwgY291bnQpOworCitlcnI6CisJZmVuY2VfY2hhaW5zX2Zp
bmkoJmRhdGEuZmMpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgc2lnbmFsX2Zvcndh
cmQodm9pZCAqYXJnKQoreworCXN0cnVjdCBmZW5jZV9jaGFpbnMgZmM7CisJaW50IGVycjsKKwlp
bnQgaTsKKworCWVyciA9IGZlbmNlX2NoYWluc19pbml0KCZmYywgNjQsIHNlcW5vX2luYyk7CisJ
aWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWZvciAoaSA9IDA7IGkgPCBmYy5jaGFpbl9sZW5n
dGg7IGkrKykgeworCQlkbWFfZmVuY2Vfc2lnbmFsKGZjLmZlbmNlc1tpXSk7CisKKwkJaWYgKCFk
bWFfZmVuY2VfaXNfc2lnbmFsZWQoZmMuY2hhaW5zW2ldKSkgeworCQkJcHJfZXJyKCJjaGFpblsl
ZF0gbm90IHNpZ25hbGVkIVxuIiwgaSk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7
CisJCX0KKworCQlpZiAoaSArIDEgPCBmYy5jaGFpbl9sZW5ndGggJiYKKwkJICAgIGRtYV9mZW5j
ZV9pc19zaWduYWxlZChmYy5jaGFpbnNbaSArIDFdKSkgeworCQkJcHJfZXJyKCJjaGFpblslZF0g
aXMgc2lnbmFsZWQhXG4iLCBpKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJ
fQorCX0KKworZXJyOgorCWZlbmNlX2NoYWluc19maW5pKCZmYyk7CisJcmV0dXJuIGVycjsKK30K
Kworc3RhdGljIGludCBzaWduYWxfYmFja3dhcmQodm9pZCAqYXJnKQoreworCXN0cnVjdCBmZW5j
ZV9jaGFpbnMgZmM7CisJaW50IGVycjsKKwlpbnQgaTsKKworCWVyciA9IGZlbmNlX2NoYWluc19p
bml0KCZmYywgNjQsIHNlcW5vX2luYyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWZv
ciAoaSA9IGZjLmNoYWluX2xlbmd0aDsgaS0tOyApIHsKKwkJZG1hX2ZlbmNlX3NpZ25hbChmYy5m
ZW5jZXNbaV0pOworCisJCWlmIChpID4gMCAmJiBkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZmMuY2hh
aW5zW2ldKSkgeworCQkJcHJfZXJyKCJjaGFpblslZF0gaXMgc2lnbmFsZWQhXG4iLCBpKTsKKwkJ
CWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCX0KKworCWZvciAoaSA9IDA7IGkg
PCBmYy5jaGFpbl9sZW5ndGg7IGkrKykgeworCQlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZChm
Yy5jaGFpbnNbaV0pKSB7CisJCQlwcl9lcnIoImNoYWluWyVkXSB3YXMgbm90IHNpZ25hbGVkIVxu
IiwgaSk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJCX0KKwl9CisKK2VycjoK
KwlmZW5jZV9jaGFpbnNfZmluaSgmZmMpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQg
X193YWl0X2ZlbmNlX2NoYWlucyh2b2lkICphcmcpCit7CisJc3RydWN0IGZlbmNlX2NoYWlucyAq
ZmMgPSBhcmc7CisKKwlpZiAoZG1hX2ZlbmNlX3dhaXQoZmMtPnRhaWwsIGZhbHNlKSkKKwkJcmV0
dXJuIC1FSU87CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCB3YWl0X2ZvcndhcmQodm9p
ZCAqYXJnKQoreworCXN0cnVjdCBmZW5jZV9jaGFpbnMgZmM7CisJc3RydWN0IHRhc2tfc3RydWN0
ICp0c2s7CisJaW50IGVycjsKKwlpbnQgaTsKKworCWVyciA9IGZlbmNlX2NoYWluc19pbml0KCZm
YywgNjQgPDwgMTAsIHNlcW5vX2luYyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXRz
ayA9IGt0aHJlYWRfcnVuKF9fd2FpdF9mZW5jZV9jaGFpbnMsICZmYywgImRtYWJ1Zi93YWl0Iik7
CisJaWYgKElTX0VSUih0c2spKSB7CisJCWVyciA9IFBUUl9FUlIodHNrKTsKKwkJZ290byBlcnI7
CisJfQorCWdldF90YXNrX3N0cnVjdCh0c2spOworCXlpZWxkX3RvKHRzaywgdHJ1ZSk7CisKKwlm
b3IgKGkgPSAwOyBpIDwgZmMuY2hhaW5fbGVuZ3RoOyBpKyspCisJCWRtYV9mZW5jZV9zaWduYWwo
ZmMuZmVuY2VzW2ldKTsKKworCWVyciA9IGt0aHJlYWRfc3RvcCh0c2spOworCXB1dF90YXNrX3N0
cnVjdCh0c2spOworCitlcnI6CisJZmVuY2VfY2hhaW5zX2ZpbmkoJmZjKTsKKwlyZXR1cm4gZXJy
OworfQorCitzdGF0aWMgaW50IHdhaXRfYmFja3dhcmQodm9pZCAqYXJnKQoreworCXN0cnVjdCBm
ZW5jZV9jaGFpbnMgZmM7CisJc3RydWN0IHRhc2tfc3RydWN0ICp0c2s7CisJaW50IGVycjsKKwlp
bnQgaTsKKworCWVyciA9IGZlbmNlX2NoYWluc19pbml0KCZmYywgNjQgPDwgMTAsIHNlcW5vX2lu
Yyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXRzayA9IGt0aHJlYWRfcnVuKF9fd2Fp
dF9mZW5jZV9jaGFpbnMsICZmYywgImRtYWJ1Zi93YWl0Iik7CisJaWYgKElTX0VSUih0c2spKSB7
CisJCWVyciA9IFBUUl9FUlIodHNrKTsKKwkJZ290byBlcnI7CisJfQorCWdldF90YXNrX3N0cnVj
dCh0c2spOworCXlpZWxkX3RvKHRzaywgdHJ1ZSk7CisKKwlmb3IgKGkgPSBmYy5jaGFpbl9sZW5n
dGg7IGktLTsgKQorCQlkbWFfZmVuY2Vfc2lnbmFsKGZjLmZlbmNlc1tpXSk7CisKKwllcnIgPSBr
dGhyZWFkX3N0b3AodHNrKTsKKwlwdXRfdGFza19zdHJ1Y3QodHNrKTsKKworZXJyOgorCWZlbmNl
X2NoYWluc19maW5pKCZmYyk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHZvaWQgcmFuZG9t
aXNlX2ZlbmNlcyhzdHJ1Y3QgZmVuY2VfY2hhaW5zICpmYykKK3sKKwl1bnNpZ25lZCBpbnQgY291
bnQgPSBmYy0+Y2hhaW5fbGVuZ3RoOworCisJLyogRmlzaGVyLVlhdGVzIHNodWZmbGUgY291cnRl
c3kgb2YgS251dGggKi8KKwl3aGlsZSAoLS1jb3VudCkgeworCQl1bnNpZ25lZCBpbnQgc3dwOwor
CisJCXN3cCA9IHByYW5kb21fdTMyX21heChjb3VudCArIDEpOworCQlpZiAoc3dwID09IGNvdW50
KQorCQkJY29udGludWU7CisKKwkJc3dhcChmYy0+ZmVuY2VzW2NvdW50XSwgZmMtPmZlbmNlc1tz
d3BdKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgd2FpdF9yYW5kb20odm9pZCAqYXJnKQoreworCXN0
cnVjdCBmZW5jZV9jaGFpbnMgZmM7CisJc3RydWN0IHRhc2tfc3RydWN0ICp0c2s7CisJaW50IGVy
cjsKKwlpbnQgaTsKKworCWVyciA9IGZlbmNlX2NoYWluc19pbml0KCZmYywgNjQgPDwgMTAsIHNl
cW5vX2luYyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJhbmRvbWlzZV9mZW5jZXMo
JmZjKTsKKworCXRzayA9IGt0aHJlYWRfcnVuKF9fd2FpdF9mZW5jZV9jaGFpbnMsICZmYywgImRt
YWJ1Zi93YWl0Iik7CisJaWYgKElTX0VSUih0c2spKSB7CisJCWVyciA9IFBUUl9FUlIodHNrKTsK
KwkJZ290byBlcnI7CisJfQorCWdldF90YXNrX3N0cnVjdCh0c2spOworCXlpZWxkX3RvKHRzaywg
dHJ1ZSk7CisKKwlmb3IgKGkgPSAwOyBpIDwgZmMuY2hhaW5fbGVuZ3RoOyBpKyspCisJCWRtYV9m
ZW5jZV9zaWduYWwoZmMuZmVuY2VzW2ldKTsKKworCWVyciA9IGt0aHJlYWRfc3RvcCh0c2spOwor
CXB1dF90YXNrX3N0cnVjdCh0c2spOworCitlcnI6CisJZmVuY2VfY2hhaW5zX2ZpbmkoJmZjKTsK
KwlyZXR1cm4gZXJyOworfQorCitpbnQgZG1hX2ZlbmNlX2NoYWluKHZvaWQpCit7CisJc3RhdGlj
IGNvbnN0IHN0cnVjdCBzdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1Qoc2FuaXR5Y2hlY2sp
LAorCQlTVUJURVNUKGZpbmRfc2Vxbm8pLAorCQlTVUJURVNUKGZpbmRfc2lnbmFsZWQpLAorCQlT
VUJURVNUKGZpbmRfb3V0X29mX29yZGVyKSwKKwkJU1VCVEVTVChmaW5kX2dhcCksCisJCVNVQlRF
U1QoZmluZF9yYWNlKSwKKwkJU1VCVEVTVChzaWduYWxfZm9yd2FyZCksCisJCVNVQlRFU1Qoc2ln
bmFsX2JhY2t3YXJkKSwKKwkJU1VCVEVTVCh3YWl0X2ZvcndhcmQpLAorCQlTVUJURVNUKHdhaXRf
YmFja3dhcmQpLAorCQlTVUJURVNUKHdhaXRfcmFuZG9tKSwKKwl9OworCWludCByZXQ7CisKKwlw
cl9pbmZvKCJzaXplb2YoZG1hX2ZlbmNlX2NoYWluKT0lenVcbiIsCisJCXNpemVvZihzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NoYWluKSk7CisKKwlzbGFiX2ZlbmNlcyA9IEtNRU1fQ0FDSEUobW9ja19mZW5j
ZSwKKwkJCQkgU0xBQl9UWVBFU0FGRV9CWV9SQ1UgfAorCQkJCSBTTEFCX0hXQ0FDSEVfQUxJR04p
OworCWlmICghc2xhYl9mZW5jZXMpCisJCXJldHVybiAtRU5PTUVNOworCisJcmV0ID0gc3VidGVz
dHModGVzdHMsIE5VTEwpOworCisJa21lbV9jYWNoZV9kZXN0cm95KHNsYWJfZmVuY2VzKTsKKwly
ZXR1cm4gcmV0OworfQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWwK
