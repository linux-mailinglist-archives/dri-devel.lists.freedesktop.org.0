Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5432361EED
	for <lists+dri-devel@lfdr.de>; Mon,  8 Jul 2019 14:54:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3CF8189D73;
	Mon,  8 Jul 2019 12:54:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E082289D73;
 Mon,  8 Jul 2019 12:54:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 08 Jul 2019 05:54:02 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,466,1557212400"; d="scan'208";a="159117029"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga008.jf.intel.com with SMTP; 08 Jul 2019 05:53:59 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 08 Jul 2019 15:53:59 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 11/19] drm/i915: Rework global state locking
Date: Mon,  8 Jul 2019 15:53:17 +0300
Message-Id: <20190708125325.16576-12-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190708125325.16576-1-ville.syrjala@linux.intel.com>
References: <20190708125325.16576-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClNv
IGZhciB3ZSd2ZSBzb3J0IG9mIHByb3RlY3RlZCB0aGUgZ2xvYmFsIHN0YXRlIHVuZGVyIGRldl9w
cml2IHdpdGgKdGhlIGNvbm5lY3Rpb25fbXV0ZXguIEkgd2FuIHRvIGNoYW5nZSB0aGF0IHNvIHRo
YXQgd2UgY2FuIGNoYW5nZSB0aGUKY2RjbGsgZXZlbiBmb3IgcHVyZSBwbGFuZSB1cGRhdGVzLiBU
byB0aGF0IGVuZCBsZXQncyBmb3JtYWxpemUgdGhlCnByb3RlY3Rpb24gb2YgdGhlIGdsb2JhbCBz
dGF0ZSB0byBmb2xsb3cgd2hhdCBJIHN0YXJ0ZWQgd2l0aCB0aGUgY2RjbGsKY29kZSBhbHJlYWR5
ICh0aG91Z2ggbm90IGVudGlyZWx5IHByb3Blcmx5KSBzdWNoIHRoYXQgYW55IGNydGMgbXV0ZXgK
d2lsbCBzdWZmaWNlIGFzIGEgcmVhZCBsb2NrLCBhbmQgYWxsIGNydGNzIG11dGV4ZXMgYWN0IGFz
IHRoZSB3cml0ZQpsb2NrLgoKV2UnbGwgYWxzbyBwaW1wIGludGVsX2F0b21pY19zdGF0ZV9jbGVh
cigpIHRvIGNsZWFyIHRoZSBlbnRpcmUgZ2xvYmFsCnN0YXRlLCBzbyB0aGF0IHdlIGRvbid0IGFj
Y2lkZW50YWxseSBsZWFrIHN0YWxlIGluZm9ybWF0aW9uIGJldHdlZW4KdGhlIGxvY2tpbmcgcmV0
cmllcy4KClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9t
aWMuYyAgfCAgMjcgKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljLmggIHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8u
YyAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMg
ICB8IDExNiArKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyB8ICAyOSArKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaCAgICAgICAgICAgICAgfCAgMTEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Ry
di5oICAgICAgICAgICAgIHwgICA4ICsrCiA3IGZpbGVzIGNoYW5nZWQsIDEzOSBpbnNlcnRpb25z
KCspLCA2NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWMuYwppbmRleCA5NTRkNGE5MzA4NjQuLmRlNGNkNDgyZGJlNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC00MTgsNiArNDE4LDEzIEBA
IHZvaWQgaW50ZWxfYXRvbWljX3N0YXRlX2NsZWFyKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
KQogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0
YXRlKHMpOwogCWRybV9hdG9taWNfc3RhdGVfZGVmYXVsdF9jbGVhcigmc3RhdGUtPmJhc2UpOwog
CXN0YXRlLT5kcGxsX3NldCA9IHN0YXRlLT5tb2Rlc2V0ID0gZmFsc2U7CisJc3RhdGUtPmdsb2Jh
bF9zdGF0ZV9jaGFuZ2VkID0gZmFsc2U7CisJc3RhdGUtPmFjdGl2ZV9jcnRjcyA9IDA7CisJbWVt
c2V0KCZzdGF0ZS0+bWluX2NkY2xrLCAwLCBzaXplb2Yoc3RhdGUtPm1pbl9jZGNsaykpOworCW1l
bXNldCgmc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsLCAwLCBzaXplb2Yoc3RhdGUtPm1pbl92b2x0
YWdlX2xldmVsKSk7CisJbWVtc2V0KCZzdGF0ZS0+Y2RjbGsubG9naWNhbCwgMCwgc2l6ZW9mKHN0
YXRlLT5jZGNsay5sb2dpY2FsKSk7CisJbWVtc2V0KCZzdGF0ZS0+Y2RjbGsuYWN0dWFsLCAwLCBz
aXplb2Yoc3RhdGUtPmNkY2xrLmFjdHVhbCkpOworCXN0YXRlLT5jZGNsay5waXBlID0gSU5WQUxJ
RF9QSVBFOwogfQogCiBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqCkBAIC00MzEsMyArNDM4LDIz
IEBAIGludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUsCiAKIAlyZXR1cm4gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjX3N0YXRlKTsKIH0KKwor
aW50IGludGVsX2F0b21pY19sb2NrX2dsb2JhbF9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisKKwlzdGF0
ZS0+Z2xvYmFsX3N0YXRlX2NoYW5nZWQgPSB0cnVlOworCisJLyogTG9jayBhbGwgY3J0YyBtdXRl
eGVzICovCisJZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YykgeworCQlp
bnQgcmV0OworCisJCXJldCA9IGRybV9tb2Rlc2V0X2xvY2soJmNydGMtPmJhc2UubXV0ZXgsCisJ
CQkJICAgICAgIHN0YXRlLT5iYXNlLmFjcXVpcmVfY3R4KTsKKwkJaWYgKHJldCkKKwkJCXJldHVy
biByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9hdG9taWMuaAppbmRleCA1ODA2NWQzMTYxYTMuLjBkNmNkMjJiN2U1ZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5oCkBAIC0xNiw2ICsxNiw3
IEBAIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZTsKIHN0cnVjdCBkcm1fZGV2aWNlOwogc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGU7CiBzdHJ1Y3QgZHJtX3Byb3BlcnR5Oworc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9jcnRjOwogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiAK
QEAgLTQ2LDQgKzQ3LDYgQEAgaW50IGludGVsX2F0b21pY19zZXR1cF9zY2FsZXJzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YywKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSk7CiAKK2ludCBpbnRlbF9hdG9taWNfbG9ja19nbG9iYWxfc3RhdGUoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUpOworCiAjZW5kaWYgLyogX19JTlRFTF9BVE9NSUNfSF9fICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F1ZGlvLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F1ZGlvLmMKaW5kZXggYzhmZDM1YTdj
YTQyLi4yMmNjYjgyNGM3MTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfYXVkaW8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2F1ZGlvLmMKQEAgLTI4LDYgKzI4LDcgQEAKICNpbmNsdWRlIDxkcm0vaTkxNV9jb21wb25lbnQu
aD4KIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaW50ZWxfYXRvbWljLmgiCiAj
aW5jbHVkZSAiaW50ZWxfYXVkaW8uaCIKICNpbmNsdWRlICJpbnRlbF9kcnYuaCIKICNpbmNsdWRl
ICJpbnRlbF9scGVfYXVkaW8uaCIKQEAgLTgxNiwxMyArODE3LDggQEAgc3RhdGljIHZvaWQgZ2xr
X2ZvcmNlX2F1ZGlvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl0
b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpLT5jZGNsay5mb3JjZV9taW5fY2RjbGsgPQogCQll
bmFibGUgPyAyICogOTYwMDAgOiAwOwogCi0JLyoKLQkgKiBQcm90ZWN0cyBkZXZfcHJpdi0+Y2Rj
bGsuZm9yY2VfbWluX2NkY2xrCi0JICogTmVlZCB0byBsb2NrIHRoaXMgaGVyZSBpbiBjYXNlIHdl
IGhhdmUgbm8gYWN0aXZlIHBpcGVzCi0JICogYW5kIHRodXMgd291bGRuJ3QgbG9jayBpdCBkdXJp
bmcgdGhlIGNvbW1pdCBvdGhlcndpc2UuCi0JICovCi0JcmV0ID0gZHJtX21vZGVzZXRfbG9jaygm
ZGV2X3ByaXYtPmRybS5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LAotCQkJICAgICAgICZj
dHgpOworCS8qIFByb3RlY3RzIGRldl9wcml2LT5jZGNsay5mb3JjZV9taW5fY2RjbGsgKi8KKwly
ZXQgPSBpbnRlbF9hdG9taWNfbG9ja19nbG9iYWxfc3RhdGUodG9faW50ZWxfYXRvbWljX3N0YXRl
KHN0YXRlKSk7CiAJaWYgKCFyZXQpCiAJCXJldCA9IGRybV9hdG9taWNfY29tbWl0KHN0YXRlKTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jCmluZGV4IDQ2NDk0
ODVmZWUzMy4uNDA1ODNkOGQyNTliIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2NkY2xrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9jZGNsay5jCkBAIC00NDIsNyArNDQyLDcgQEAgc3RhdGljIGludCB2bHZfY2FsY19jZGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBtaW5fY2RjbGspCiAJCXJl
dHVybiAyMDAwMDA7CiB9CiAKLXN0YXRpYyB1OCB2bHZfY2FsY192b2x0YWdlX2xldmVsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IGNkY2xrKQorc3RhdGljIGludCB2bHZf
Y2FsY192b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50
IGNkY2xrKQogewogCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkgewogCQlpZiAoY2RjbGsg
Pj0gMzIwMDAwKSAvKiBqdW1wIHRvIGhpZ2hlc3Qgdm9sdGFnZSBmb3IgNDAwTUh6IHRvbyAqLwpA
QCAtNjY5LDcgKzY2OSw3IEBAIHN0YXRpYyBpbnQgYmR3X2NhbGNfY2RjbGsoaW50IG1pbl9jZGNs
aykKIAkJcmV0dXJuIDMzNzUwMDsKIH0KIAotc3RhdGljIHU4IGJkd19jYWxjX3ZvbHRhZ2VfbGV2
ZWwoaW50IGNkY2xrKQorc3RhdGljIGludCBiZHdfY2FsY192b2x0YWdlX2xldmVsKGludCBjZGNs
aykKIHsKIAlzd2l0Y2ggKGNkY2xrKSB7CiAJZGVmYXVsdDoKQEAgLTgwOCw3ICs4MDgsNyBAQCBz
dGF0aWMgaW50IHNrbF9jYWxjX2NkY2xrKGludCBtaW5fY2RjbGssIGludCB2Y28pCiAJfQogfQog
Ci1zdGF0aWMgdTggc2tsX2NhbGNfdm9sdGFnZV9sZXZlbChpbnQgY2RjbGspCitzdGF0aWMgaW50
IHNrbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQogewogCWlmIChjZGNsayA+IDU0MDAw
MCkKIAkJcmV0dXJuIDM7CkBAIC0xMTkwLDcgKzExOTAsNyBAQCBzdGF0aWMgaW50IGdsa19jYWxj
X2NkY2xrKGludCBtaW5fY2RjbGspCiAJCXJldHVybiA3OTIwMDsKIH0KIAotc3RhdGljIHU4IGJ4
dF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQorc3RhdGljIGludCBieHRfY2FsY192b2x0
YWdlX2xldmVsKGludCBjZGNsaykKIHsKIAlyZXR1cm4gRElWX1JPVU5EX1VQKGNkY2xrLCAyNTAw
MCk7CiB9CkBAIC0xNTI0LDcgKzE1MjQsNyBAQCBzdGF0aWMgaW50IGNubF9jYWxjX2NkY2xrKGlu
dCBtaW5fY2RjbGspCiAJCXJldHVybiAxNjgwMDA7CiB9CiAKLXN0YXRpYyB1OCBjbmxfY2FsY192
b2x0YWdlX2xldmVsKGludCBjZGNsaykKK3N0YXRpYyBpbnQgY25sX2NhbGNfdm9sdGFnZV9sZXZl
bChpbnQgY2RjbGspCiB7CiAJaWYgKGNkY2xrID4gMzM2MDAwKQogCQlyZXR1cm4gMjsKQEAgLTE4
NjcsNyArMTg2Nyw3IEBAIHN0YXRpYyB2b2lkIGljbF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCWRldl9wcml2LT5jZGNsay5ody52b2x0YWdlX2xldmVsID0g
Y2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWw7CiB9CiAKLXN0YXRpYyB1OCBpY2xfY2FsY192b2x0
YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IGNkY2xrKQor
c3RhdGljIGludCBpY2xfY2FsY192b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgaW50IGNkY2xrKQogewogCWlmIChJU19FTEtIQVJUTEFLRShkZXZfcHJpdikp
IHsKIAkJaWYgKGNkY2xrID4gMzEyMDAwKQpAQCAtMjMwNSwxMSArMjMwNSwyMCBAQCBzdGF0aWMg
aW50IGludGVsX2NvbXB1dGVfbWluX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCSAgICAgICBzaXplb2Yoc3RhdGUtPm1pbl9jZGNsaykpOwogCiAJZm9yX2VhY2hfbmV3
X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKKwkJaW50
IHJldDsKKwogCQltaW5fY2RjbGsgPSBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2NkY2xrKGNydGNf
c3RhdGUpOwogCQlpZiAobWluX2NkY2xrIDwgMCkKIAkJCXJldHVybiBtaW5fY2RjbGs7CiAKKwkJ
aWYgKHN0YXRlLT5taW5fY2RjbGtbaV0gPT0gbWluX2NkY2xrKQorCQkJY29udGludWU7CisKIAkJ
c3RhdGUtPm1pbl9jZGNsa1tpXSA9IG1pbl9jZGNsazsKKworCQlyZXQgPSBpbnRlbF9hdG9taWNf
bG9ja19nbG9iYWxfc3RhdGUoc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKIAl9
CiAKIAltaW5fY2RjbGsgPSBzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrOwpAQCAtMjMyOCw3
ICsyMzM3LDcgQEAgc3RhdGljIGludCBpbnRlbF9jb21wdXRlX21pbl9jZGNsayhzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKICAqIGZ1dHVyZSBwbGF0Zm9ybXMgdGhpcyBjb2RlIHdp
bGwgbmVlZCB0byBiZQogICogYWRqdXN0ZWQuCiAgKi8KLXN0YXRpYyB1OCBjbmxfY29tcHV0ZV9t
aW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3N0YXRp
YyBpbnQgY25sX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwpAQCAtMjM0
MSwxMSArMjM1MCwyMSBAQCBzdGF0aWMgdTggY25sX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJICAgICAgIHNpemVvZihzdGF0ZS0+
bWluX3ZvbHRhZ2VfbGV2ZWwpKTsKIAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRl
KHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CisJCWludCByZXQ7CisKIAkJaWYgKGNydGNf
c3RhdGUtPmJhc2UuZW5hYmxlKQotCQkJc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsW2ldID0KLQkJ
CQljcnRjX3N0YXRlLT5taW5fdm9sdGFnZV9sZXZlbDsKKwkJCW1pbl92b2x0YWdlX2xldmVsID0g
Y3J0Y19zdGF0ZS0+bWluX3ZvbHRhZ2VfbGV2ZWw7CiAJCWVsc2UKLQkJCXN0YXRlLT5taW5fdm9s
dGFnZV9sZXZlbFtpXSA9IDA7CisJCQltaW5fdm9sdGFnZV9sZXZlbCA9IDA7CisKKwkJaWYgKHN0
YXRlLT5taW5fdm9sdGFnZV9sZXZlbFtpXSA9PSBtaW5fdm9sdGFnZV9sZXZlbCkKKwkJCWNvbnRp
bnVlOworCisJCXN0YXRlLT5taW5fdm9sdGFnZV9sZXZlbFtpXSA9IG1pbl92b2x0YWdlX2xldmVs
OworCisJCXJldCA9IGludGVsX2F0b21pY19sb2NrX2dsb2JhbF9zdGF0ZShzdGF0ZSk7CisJCWlm
IChyZXQpCisJCQlyZXR1cm4gcmV0OwogCX0KIAogCW1pbl92b2x0YWdlX2xldmVsID0gMDsKQEAg
LTI1MzEsMTIgKzI1NTAsMTYgQEAgc3RhdGljIGludCBieHRfbW9kZXNldF9jYWxjX2NkY2xrKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogc3RhdGljIGludCBjbmxfbW9kZXNldF9j
YWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKLQlp
bnQgbWluX2NkY2xrLCBjZGNsaywgdmNvOworCWludCBtaW5fY2RjbGssIG1pbl92b2x0YWdlX2xl
dmVsLCBjZGNsaywgdmNvOwogCiAJbWluX2NkY2xrID0gaW50ZWxfY29tcHV0ZV9taW5fY2RjbGso
c3RhdGUpOwogCWlmIChtaW5fY2RjbGsgPCAwKQogCQlyZXR1cm4gbWluX2NkY2xrOwogCisJbWlu
X3ZvbHRhZ2VfbGV2ZWwgPSBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdGF0ZSk7CisJ
aWYgKG1pbl92b2x0YWdlX2xldmVsIDwgMCkKKwkJcmV0dXJuIG1pbl92b2x0YWdlX2xldmVsOwor
CiAJY2RjbGsgPSBjbmxfY2FsY19jZGNsayhtaW5fY2RjbGspOwogCXZjbyA9IGNubF9jZGNsa19w
bGxfdmNvKGRldl9wcml2LCBjZGNsayk7CiAKQEAgLTI1NDQsNyArMjU2Nyw3IEBAIHN0YXRpYyBp
bnQgY25sX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKIAlzdGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNsayA9IGNkY2xrOwogCXN0YXRlLT5jZGNsay5s
b2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQogCQltYXgoY25sX2NhbGNfdm9sdGFnZV9sZXZlbChjZGNs
ayksCi0JCSAgICBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdGF0ZSkpOworCQkgICAg
bWluX3ZvbHRhZ2VfbGV2ZWwpOwogCiAJaWYgKCFzdGF0ZS0+YWN0aXZlX2NydGNzKSB7CiAJCWNk
Y2xrID0gY25sX2NhbGNfY2RjbGsoc3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsayk7CkBAIC0y
NTYxLDIzICsyNTg0LDYgQEAgc3RhdGljIGludCBjbmxfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50
IGludGVsX2xvY2tfYWxsX3BpcGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJh
c2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKLQotCS8qIEFkZCBhbGwgcGlwZXMg
dG8gdGhlIHN0YXRlICovCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0
YykgewotCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQotCQljcnRjX3N0
YXRlID0gaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY3J0Yyk7Ci0J
CWlmIChJU19FUlIoY3J0Y19zdGF0ZSkpCi0JCQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsK
LQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2FsbF9waXBl
cyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CkBAIC0yNjIxLDEy
ICsyNjI3LDE2IEBAIHN0YXRpYyBpbnQgaWNsX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CiAJdW5zaWduZWQgaW50IHJlZiA9IHN0
YXRlLT5jZGNsay5sb2dpY2FsLnJlZjsKLQlpbnQgbWluX2NkY2xrLCBjZGNsaywgdmNvOworCWlu
dCBtaW5fY2RjbGssIG1pbl92b2x0YWdlX2xldmVsLCBjZGNsaywgdmNvOwogCiAJbWluX2NkY2xr
ID0gaW50ZWxfY29tcHV0ZV9taW5fY2RjbGsoc3RhdGUpOwogCWlmIChtaW5fY2RjbGsgPCAwKQog
CQlyZXR1cm4gbWluX2NkY2xrOwogCisJbWluX3ZvbHRhZ2VfbGV2ZWwgPSBjbmxfY29tcHV0ZV9t
aW5fdm9sdGFnZV9sZXZlbChzdGF0ZSk7CisJaWYgKG1pbl92b2x0YWdlX2xldmVsIDwgMCkKKwkJ
cmV0dXJuIG1pbl92b2x0YWdlX2xldmVsOworCiAJY2RjbGsgPSBpY2xfY2FsY19jZGNsayhtaW5f
Y2RjbGssIHJlZik7CiAJdmNvID0gaWNsX2NhbGNfY2RjbGtfcGxsX3ZjbyhkZXZfcHJpdiwgY2Rj
bGspOwogCkBAIC0yNjM0LDcgKzI2NDQsNyBAQCBzdGF0aWMgaW50IGljbF9tb2Rlc2V0X2NhbGNf
Y2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJc3RhdGUtPmNkY2xrLmxv
Z2ljYWwuY2RjbGsgPSBjZGNsazsKIAlzdGF0ZS0+Y2RjbGsubG9naWNhbC52b2x0YWdlX2xldmVs
ID0KIAkJbWF4KGljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoZGV2X3ByaXYsIGNkY2xrKSwKLQkJICAg
IGNubF9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0YXRlKSk7CisJCSAgICBtaW5fdm9sdGFn
ZV9sZXZlbCk7CiAKIAlpZiAoIXN0YXRlLT5hY3RpdmVfY3J0Y3MpIHsKIAkJY2RjbGsgPSBpY2xf
Y2FsY19jZGNsayhzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrLCByZWYpOwpAQCAtMjY3Nyw0
NyArMjY4Nyw0OSBAQCBpbnQgaW50ZWxfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwlpZiAoIWlu
dGVsX2NkY2xrX2NoYW5nZWQoJmRldl9wcml2LT5jZGNsay5sb2dpY2FsLAorCQkJCSAmc3RhdGUt
PmNkY2xrLmxvZ2ljYWwpICYmCisJICAgICFpbnRlbF9jZGNsa19jaGFuZ2VkKCZkZXZfcHJpdi0+
Y2RjbGsuYWN0dWFsLAorCQkJCSAmc3RhdGUtPmNkY2xrLmFjdHVhbCkpCisJCXJldHVybiAwOwor
CiAJLyoKLQkgKiBXcml0ZXMgdG8gZGV2X3ByaXYtPmNkY2xrLmxvZ2ljYWwgbXVzdCBwcm90ZWN0
ZWQgYnkKLQkgKiBob2xkaW5nIGFsbCB0aGUgY3J0YyBsb2NrcywgZXZlbiBpZiB3ZSBkb24ndCBl
bmQgdXAKKwkgKiBXcml0ZXMgdG8gZGV2X3ByaXYtPmNkY2xrLnthY3R1YWwsbG9naWNhbH0gbXVz
dCBwcm90ZWN0ZWQKKwkgKiBieSBob2xkaW5nIGFsbCB0aGUgY3J0YyBtdXRleGVzIGV2ZW4gaWYg
d2UgZG9uJ3QgZW5kIHVwCiAJICogdG91Y2hpbmcgdGhlIGhhcmR3YXJlCiAJICovCi0JaWYgKGlu
dGVsX2NkY2xrX2NoYW5nZWQoJmRldl9wcml2LT5jZGNsay5sb2dpY2FsLAotCQkJCSZzdGF0ZS0+
Y2RjbGsubG9naWNhbCkpIHsKLQkJcmV0ID0gaW50ZWxfbG9ja19hbGxfcGlwZXMoc3RhdGUpOwot
CQlpZiAocmV0IDwgMCkKLQkJCXJldHVybiByZXQ7Ci0JfQorCXJldCA9IGludGVsX2F0b21pY19s
b2NrX2dsb2JhbF9zdGF0ZShzdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAotCWlm
IChpc19wb3dlcl9vZl8yKHN0YXRlLT5hY3RpdmVfY3J0Y3MpKSB7CisJaWYgKGlzX3Bvd2VyX29m
XzIoc3RhdGUtPmFjdGl2ZV9jcnRjcykgJiYKKwkgICAgaW50ZWxfY2RjbGtfbmVlZHNfY2QyeF91
cGRhdGUoZGV2X3ByaXYsCisJCQkJCSAgJmRldl9wcml2LT5jZGNsay5hY3R1YWwsCisJCQkJCSAg
JnN0YXRlLT5jZGNsay5hY3R1YWwpKSB7CiAJCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCQlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAogCQlwaXBlID0gaWxvZzIoc3Rh
dGUtPmFjdGl2ZV9jcnRjcyk7CiAJCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZf
cHJpdiwgcGlwZSk7Ci0JCWNydGNfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0
YXRlKHN0YXRlLCBjcnRjKTsKLQkJaWYgKGNydGNfc3RhdGUgJiYKLQkJICAgIGRybV9hdG9taWNf
Y3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNlKSkKKworCQljcnRjX3N0YXRlID0g
aW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY3J0Yyk7CisJCWlmIChJ
U19FUlIoY3J0Y19zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsKKworCQlp
ZiAoZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJmNydGNfc3RhdGUtPmJhc2UpKQogCQkJ
cGlwZSA9IElOVkFMSURfUElQRTsKIAl9IGVsc2UgewogCQlwaXBlID0gSU5WQUxJRF9QSVBFOwog
CX0KIAotCS8qIEFsbCBwaXBlcyBtdXN0IGJlIHN3aXRjaGVkIG9mZiB3aGlsZSB3ZSBjaGFuZ2Ug
dGhlIGNkY2xrLiAqLwotCWlmIChwaXBlICE9IElOVkFMSURfUElQRSAmJgotCSAgICBpbnRlbF9j
ZGNsa19uZWVkc19jZDJ4X3VwZGF0ZShkZXZfcHJpdiwKLQkJCQkJICAmZGV2X3ByaXYtPmNkY2xr
LmFjdHVhbCwKLQkJCQkJICAmc3RhdGUtPmNkY2xrLmFjdHVhbCkpIHsKLQkJcmV0ID0gaW50ZWxf
bG9ja19hbGxfcGlwZXMoc3RhdGUpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQorCWlm
IChwaXBlICE9IElOVkFMSURfUElQRSkgewogCQlzdGF0ZS0+Y2RjbGsucGlwZSA9IHBpcGU7CiAK
IAkJRFJNX0RFQlVHX0tNUygiQ2FuIGNoYW5nZSBjZGNsayB3aXRoIHBpcGUgJWMgYWN0aXZlXG4i
LAogCQkJICAgICAgcGlwZV9uYW1lKHBpcGUpKTsKIAl9IGVsc2UgaWYgKGludGVsX2NkY2xrX25l
ZWRzX21vZGVzZXQoJmRldl9wcml2LT5jZGNsay5hY3R1YWwsCiAJCQkJCSAgICAgJnN0YXRlLT5j
ZGNsay5hY3R1YWwpKSB7CisJCS8qIEFsbCBwaXBlcyBtdXN0IGJlIHN3aXRjaGVkIG9mZiB3aGls
ZSB3ZSBjaGFuZ2UgdGhlIGNkY2xrLiAqLwogCQlyZXQgPSBpbnRlbF9tb2Rlc2V0X2FsbF9waXBl
cyhzdGF0ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCAyZDNjZmRjODBmZDMuLjViNjMwMGI4
MmM1MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
QEAgLTEyMTQwLDYgKzEyMTQwLDEyIEBAIHN0YXRpYyBib29sIGNoZWNrX2RpZ2l0YWxfcG9ydF9j
b25mbGljdHMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJdW5zaWduZWQgaW50
IHVzZWRfbXN0X3BvcnRzID0gMDsKIAlib29sIHJldCA9IHRydWU7CiAKKwkvKgorCSAqIFdlJ3Jl
IGdvaW5nIHRvIHBlZWsgaW50byBjb25uZWN0b3ItPnN0YXRlLAorCSAqIGhlbmNlIGNvbm5lY3Rp
b25fbXV0ZXggbXVzdCBiZSBoZWxkLgorCSAqLworCWRybV9tb2Rlc2V0X2xvY2tfYXNzZXJ0X2hl
bGQoJmRldi0+bW9kZV9jb25maWcuY29ubmVjdGlvbl9tdXRleCk7CisKIAkvKgogCSAqIFdhbGsg
dGhlIGNvbm5lY3RvciBsaXN0IGluc3RlYWQgb2YgdGhlIGVuY29kZXIKIAkgKiBsaXN0IHRvIGRl
dGVjdCB0aGUgcHJvYmxlbSBvbiBkZGkgcGxhdGZvcm1zCkBAIC0xMzM4Nyw3ICsxMzM5Myw2IEBA
IHN0YXRpYyBpbnQgaW50ZWxfbW9kZXNldF9jaGVja3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJc3RhdGUtPmFjdGl2ZV9jcnRjcyA9IGRldl9wcml2LT5hY3RpdmVfY3J0Y3M7
CiAJc3RhdGUtPmNkY2xrLmxvZ2ljYWwgPSBkZXZfcHJpdi0+Y2RjbGsubG9naWNhbDsKIAlzdGF0
ZS0+Y2RjbGsuYWN0dWFsID0gZGV2X3ByaXYtPmNkY2xrLmFjdHVhbDsKLQlzdGF0ZS0+Y2RjbGsu
cGlwZSA9IElOVkFMSURfUElQRTsKIAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0
YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRl
LCBpKSB7CkBAIC0xMzQwMCw2ICsxMzQwNSwxMiBAQCBzdGF0aWMgaW50IGludGVsX21vZGVzZXRf
Y2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJc3RhdGUtPmFjdGl2
ZV9waXBlX2NoYW5nZXMgfD0gZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAJfQogCisJaWYg
KHN0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzKSB7CisJCXJldCA9IGludGVsX2F0b21pY19sb2Nr
X2dsb2JhbF9zdGF0ZShzdGF0ZSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKwog
CXJldCA9IGludGVsX21vZGVzZXRfY2FsY19jZGNsayhzdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0
dXJuIHJldDsKQEAgLTEzNTAxLDcgKzEzNTEyLDcgQEAgc3RhdGljIGludCBpbnRlbF9hdG9taWNf
Y2hlY2soc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YzsKIAlpbnQgcmV0LCBpOwotCWJvb2wgYW55X21zID0gc3RhdGUtPmNkY2xrLmZvcmNlX21pbl9j
ZGNsa19jaGFuZ2VkOworCWJvb2wgYW55X21zID0gZmFsc2U7CiAKIAkvKiBDYXRjaCBJOTE1X01P
REVfRkxBR19JTkhFUklURUQgKi8KIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0
ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCkBAIC0xMzUzOSw2ICsxMzU1MCw4IEBAIHN0
YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYg
KHJldCkKIAkJZ290byBmYWlsOwogCisJYW55X21zIHw9IHN0YXRlLT5jZGNsay5mb3JjZV9taW5f
Y2RjbGtfY2hhbmdlZDsKKwogCWlmIChhbnlfbXMpIHsKIAkJcmV0ID0gaW50ZWxfbW9kZXNldF9j
aGVja3Moc3RhdGUpOwogCQlpZiAocmV0KQpAQCAtMTQwMjgsNiArMTQwNDEsMTQgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfYXRvbWljX3RyYWNrX2ZicyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3Rh
dGUpCiAJCQkJICB0b19pbnRlbF9wbGFuZShwbGFuZSktPmZyb250YnVmZmVyX2JpdCk7CiB9CiAK
K3N0YXRpYyB2b2lkIGFzc2VydF9nbG9iYWxfc3RhdGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKworCWZvcl9l
YWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpCisJCWRybV9tb2Rlc2V0X2xvY2tf
YXNzZXJ0X2hlbGQoJmNydGMtPmJhc2UubXV0ZXgpOworfQorCiAvKioKICAqIGludGVsX2F0b21p
Y19jb21taXQgLSBjb21taXQgdmFsaWRhdGVkIHN0YXRlIG9iamVjdAogICogQGRldjogRFJNIGRl
dmljZQpAQCAtMTQxMDUsNyArMTQxMjYsOSBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlpbnRlbF9zaGFyZWRfZHBsbF9zd2FwX3N0YXRl
KHN0YXRlKTsKIAlpbnRlbF9hdG9taWNfdHJhY2tfZmJzKHN0YXRlKTsKIAotCWlmIChpbnRlbF9z
dGF0ZS0+bW9kZXNldCkgeworCWlmIChpbnRlbF9zdGF0ZS0+Z2xvYmFsX3N0YXRlX2NoYW5nZWQp
IHsKKwkJYXNzZXJ0X2dsb2JhbF9zdGF0ZV9sb2NrZWQoZGV2X3ByaXYpOworCiAJCW1lbWNweShk
ZXZfcHJpdi0+bWluX2NkY2xrLCBpbnRlbF9zdGF0ZS0+bWluX2NkY2xrLAogCQkgICAgICAgc2l6
ZW9mKGludGVsX3N0YXRlLT5taW5fY2RjbGspKTsKIAkJbWVtY3B5KGRldl9wcml2LT5taW5fdm9s
dGFnZV9sZXZlbCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGUwNWJjM2UxMDE0ZC4uZDgx
MmFjNmQ4NmExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE0MzcsMTMgKzE0MzcsMTQg
QEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCXVuc2lnbmVkIGludCBmZGlfcGxsX2ZyZXE7
CiAJdW5zaWduZWQgaW50IGN6Y2xrX2ZyZXE7CiAKKwkvKgorCSAqIEZvciByZWFkaW5nIGhvbGRp
bmcgYW55IGNydGMgbG9jayBpcyBzdWZmaWNpZW50LAorCSAqIGZvciB3cml0aW5nIG11c3QgaG9s
ZCBhbGwgb2YgdGhlbS4KKwkgKi8KIAlzdHJ1Y3QgewogCQkvKgogCQkgKiBUaGUgY3VycmVudCBs
b2dpY2FsIGNkY2xrIHN0YXRlLgogCQkgKiBTZWUgaW50ZWxfYXRvbWljX3N0YXRlLmNkY2xrLmxv
Z2ljYWwKLQkJICoKLQkJICogRm9yIHJlYWRpbmcgaG9sZGluZyBhbnkgY3J0YyBsb2NrIGlzIHN1
ZmZpY2llbnQsCi0JCSAqIGZvciB3cml0aW5nIG11c3QgaG9sZCBhbGwgb2YgdGhlbS4KIAkJICov
CiAJCXN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSBsb2dpY2FsOwogCQkvKgpAQCAtMTUwOCw2ICsx
NTA5LDEwIEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAkgKi8KIAlzdHJ1Y3QgbXV0ZXgg
ZHBsbF9sb2NrOwogCisJLyoKKwkgKiBGb3IgcmVhZGluZyBhY3RpdmVfY3J0Y3MsbWluX2NkY2xr
LG1pbl92b2x0YWdlX2xldmVsIGhvbGRpbmcKKwkgKiBhbnkgY3J0YyBsb2NrIGlzIHN1ZmZpY2ll
bnQsIGZvciB3cml0aW5nIG11c3QgaG9sZCBhbGwgb2YgdGhlbS4KKwkgKi8KIAl1bnNpZ25lZCBp
bnQgYWN0aXZlX2NydGNzOwogCS8qIG1pbmltdW0gYWNjZXB0YWJsZSBjZGNsayBmb3IgZWFjaCBw
aXBlICovCiAJaW50IG1pbl9jZGNsa1tJOTE1X01BWF9QSVBFU107CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2Rydi5oCmluZGV4IDA0ZWVlNWQ4ODBmNS4uYzBiYmY3YTYwOTQ0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kcnYuaApAQCAtNDc2LDYgKzQ3NiwxNCBAQCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
IHsKIAogCWJvb2wgcnBzX2ludGVyYWN0aXZlOwogCisJLyoKKwkgKiBhY3RpdmVfY3J0Y3MKKwkg
KiBtaW5fY2RjbGtbXQorCSAqIG1pbl92b2x0YWdlX2xldmVsW10KKwkgKiBjZGNsay4qCisJICov
CisJYm9vbCBnbG9iYWxfc3RhdGVfY2hhbmdlZDsKKwogCS8qIEdlbjkrIG9ubHkgKi8KIAlzdHJ1
Y3Qgc2tsX2RkYl92YWx1ZXMgd21fcmVzdWx0czsKIAotLSAKMi4yMS4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
