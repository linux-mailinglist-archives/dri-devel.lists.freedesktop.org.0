Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D3CF22796D7
	for <lists+dri-devel@lfdr.de>; Sat, 26 Sep 2020 06:25:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9412B6ED91;
	Sat, 26 Sep 2020 04:25:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x544.google.com (mail-pg1-x544.google.com
 [IPv6:2607:f8b0:4864:20::544])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EA06E6ED8E
 for <dri-devel@lists.freedesktop.org>; Sat, 26 Sep 2020 04:25:03 +0000 (UTC)
Received: by mail-pg1-x544.google.com with SMTP id 197so4138779pge.8
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Sep 2020 21:25:03 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=2H1Yr1ZzRbTr0UE566f697qNBNIq6GZE63QK31mOArc=;
 b=QR3D70X+iURkNzPXl26udZXdU8x9honZnaMWw4JV2DKKAIvIFtkWhDmU8HykuxoRUj
 kQOi8jHCzczouvlfYRVDinDjm85nLQlg31by6GieWnYcJNKmVdwEjC7pR1DQH3aw0W6f
 r0QLTxE4f+JBnu+5C2o5u7ggaWg0rg3bF64Zc79ECONonPRowJwtIm96g3MFqkLw0SpX
 iG1F+HCHirx0wUURVjmDyERxSdZkEp9LjMNm8XM/f2fylGuUAUxdI/nnySnxYcwg4P/V
 eysFTGffdcMyz8llW4fqtlxdEldrvDb17KOJ37R3KCOs1Vz3NyLCW4T0XWt1rJKKtsuC
 kYxA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=2H1Yr1ZzRbTr0UE566f697qNBNIq6GZE63QK31mOArc=;
 b=MwtdTwlqs98qIHUB3vsXkxjX/vxXUKstSC7V19MB3wDHMZIJslN6JBB5EIz9ZXd5Aj
 dXhZjKC+6+iJroTZGMEzoXmHoCvC7iay4mgR21XOywoG9JvP9ZKHL3Aw2PrVTVuMnyM6
 50bAC1uhKfKGWdJnEHcj5H4FQcxLGuCbLOCiCaC0EAAz2tgiyFn07Ei+fZohKfz3hSK0
 mcjaWzlWkjzABqlrsAGuUcJ8Fb7TLvlh0mIEAS7ck8DAlm9zq63LApR9z6OElS7ULRUO
 9tESNWgLwc/BtY62vvHoXnQdA9U7g1ttiXqKL1cKO+qADDQPsDJJXcLsYrINQilk13IA
 e4zg==
X-Gm-Message-State: AOAM530XphiV2hc5BEHFb4LEALif58u6HiaigCLAuuIzMdE/2vU3IThF
 53ys/WeGb3Qreaa5epgd1BbhPQ==
X-Google-Smtp-Source: ABdhPJxVSgNpa8Val9ZcacJd85QmQO2OmijAvP06AHqBP8I1x0fgkNGF6yDx7vorPACjyRFjjzINHA==
X-Received: by 2002:a62:fb1a:0:b029:142:2501:39f9 with SMTP id
 x26-20020a62fb1a0000b0290142250139f9mr1542805pfm.72.1601094303392; 
 Fri, 25 Sep 2020 21:25:03 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 a5sm3585886pgk.13.2020.09.25.21.25.02
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 25 Sep 2020 21:25:02 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH 4/6] dma-buf: system_heap: Allocate higher order pages if
 available
Date: Sat, 26 Sep 2020 04:24:51 +0000
Message-Id: <20200926042453.67517-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200926042453.67517-1-john.stultz@linaro.org>
References: <20200926042453.67517-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sandeep Patil <sspatil@google.com>, dri-devel@lists.freedesktop.org,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 Suren Baghdasaryan <surenb@google.com>, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2hpbGUgdGhlIHN5c3RlbSBoZWFwIGNhbiByZXR1cm4gbm9uLWNvbnRpZ3VvdXMgcGFnZXMsCnRy
eSB0byBhbGxvY2F0ZSBsYXJnZXIgb3JkZXIgcGFnZXMgaWYgcG9zc2libGUuCgpUaGlzIHdpbGwg
YWxsb3cgc2xpZ2h0IHBlcmZvcm1hbmNlIGdhaW5zIGFuZCBtYWtlIGltcGxlbWVudGluZwpwYWdl
IHBvb2xpbmcgZWFzaWVyLgoKQ2M6IFN1bWl0IFNlbXdhbCA8c3VtaXQuc2Vtd2FsQGxpbmFyby5v
cmc+CkNjOiBMaWFtIE1hcmsgPGxtYXJrQGNvZGVhdXJvcmEub3JnPgpDYzogTGF1cmEgQWJib3R0
IDxsYWJib3R0QGtlcm5lbC5vcmc+CkNjOiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFy
bS5jb20+CkNjOiBIcmlkeWEgVmFsc2FyYWp1IDxocmlkeWFAZ29vZ2xlLmNvbT4KQ2M6IFN1cmVu
IEJhZ2hkYXNhcnlhbiA8c3VyZW5iQGdvb2dsZS5jb20+CkNjOiBTYW5kZWVwIFBhdGlsIDxzc3Bh
dGlsQGdvb2dsZS5jb20+CkNjOiDDmHJqYW4gRWlkZSA8b3JqYW4uZWlkZUBhcm0uY29tPgpDYzog
Um9iaW4gTXVycGh5IDxyb2Jpbi5tdXJwaHlAYXJtLmNvbT4KQ2M6IEV6ZXF1aWVsIEdhcmNpYSA8
ZXplcXVpZWxAY29sbGFib3JhLmNvbT4KQ2M6IFNpbW9uIFNlciA8Y29udGFjdEBlbWVyc2lvbi5m
cj4KQ2M6IEphbWVzIEpvbmVzIDxqYWpvbmVzQG52aWRpYS5jb20+CkNjOiBsaW51eC1tZWRpYUB2
Z2VyLmtlcm5lbC5vcmcKQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKU2lnbmVk
LW9mZi1ieTogSm9obiBTdHVsdHogPGpvaG4uc3R1bHR6QGxpbmFyby5vcmc+Ci0tLQogZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMgfCA4NSArKysrKysrKysrKysrKysrKysrKysr
LS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDY2IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jIGIvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKaW5kZXggZGRmYTE3ZGM0OGE4Li44ODJh
NjMyZTliYjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5j
CisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCkBAIC0zOSw2ICszOSwx
NCBAQCBzdHJ1Y3QgZG1hX2hlYXBfYXR0YWNobWVudCB7CiAJc3RydWN0IGxpc3RfaGVhZCBsaXN0
OwogfTsKIAorI2RlZmluZSBISUdIX09SREVSX0dGUCAgKCgoR0ZQX0hJR0hVU0VSIHwgX19HRlBf
WkVSTyB8IF9fR0ZQX05PV0FSTiBcCisJCQkJfCBfX0dGUF9OT1JFVFJZKSAmIH5fX0dGUF9SRUNM
QUlNKSBcCisJCQkJfCBfX0dGUF9DT01QKQorI2RlZmluZSBMT1dfT1JERVJfR0ZQIChHRlBfSElH
SFVTRVIgfCBfX0dGUF9aRVJPIHwgX19HRlBfQ09NUCkKK3N0YXRpYyBnZnBfdCBvcmRlcl9mbGFn
c1tdID0ge0hJR0hfT1JERVJfR0ZQLCBMT1dfT1JERVJfR0ZQLCBMT1dfT1JERVJfR0ZQfTsKK3N0
YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQgb3JkZXJzW10gPSB7OCwgNCwgMH07CisjZGVmaW5lIE5V
TV9PUkRFUlMgQVJSQVlfU0laRShvcmRlcnMpCisKIHN0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKmR1
cF9zZ190YWJsZShzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlKQogewogCXN0cnVjdCBzZ190YWJsZSAq
bmV3X3RhYmxlOwpAQCAtMjU5LDggKzI2NywxMSBAQCBzdGF0aWMgdm9pZCBzeXN0ZW1faGVhcF9k
bWFfYnVmX3JlbGVhc2Uoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKIAlpbnQgaTsKIAogCXRhYmxl
ID0gJmJ1ZmZlci0+c2dfdGFibGU7Ci0JZm9yX2VhY2hfc2d0YWJsZV9zZyh0YWJsZSwgc2csIGkp
Ci0JCV9fZnJlZV9wYWdlKHNnX3BhZ2Uoc2cpKTsKKwlmb3JfZWFjaF9zZyh0YWJsZS0+c2dsLCBz
ZywgdGFibGUtPm5lbnRzLCBpKSB7CisJCXN0cnVjdCBwYWdlICpwYWdlID0gc2dfcGFnZShzZyk7
CisKKwkJX19mcmVlX3BhZ2VzKHBhZ2UsIGNvbXBvdW5kX29yZGVyKHBhZ2UpKTsKKwl9CiAJc2df
ZnJlZV90YWJsZSh0YWJsZSk7CiAJa2ZyZWUoYnVmZmVyKTsKIH0KQEAgLTI3OCw2ICsyODksMjYg
QEAgY29uc3Qgc3RydWN0IGRtYV9idWZfb3BzIHN5c3RlbV9oZWFwX2J1Zl9vcHMgPSB7CiAJLnJl
bGVhc2UgPSBzeXN0ZW1faGVhcF9kbWFfYnVmX3JlbGVhc2UsCiB9OwogCitzdGF0aWMgc3RydWN0
IHBhZ2UgKmFsbG9jX2xhcmdlc3RfYXZhaWxhYmxlKHVuc2lnbmVkIGxvbmcgc2l6ZSwKKwkJCQkJ
ICAgIHVuc2lnbmVkIGludCBtYXhfb3JkZXIpCit7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJaW50
IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgTlVNX09SREVSUzsgaSsrKSB7CisJCWlmIChzaXplIDwg
IChQQUdFX1NJWkUgPDwgb3JkZXJzW2ldKSkKKwkJCWNvbnRpbnVlOworCQlpZiAobWF4X29yZGVy
IDwgb3JkZXJzW2ldKQorCQkJY29udGludWU7CisKKwkJcGFnZSA9IGFsbG9jX3BhZ2VzKG9yZGVy
X2ZsYWdzW2ldLCBvcmRlcnNbaV0pOworCQlpZiAoIXBhZ2UpCisJCQljb250aW51ZTsKKwkJcmV0
dXJuIHBhZ2U7CisJfQorCXJldHVybiBOVUxMOworfQorCiBzdGF0aWMgaW50IHN5c3RlbV9oZWFw
X2FsbG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKIAkJCQl1bnNpZ25lZCBsb25nIGxlbiwK
IAkJCQl1bnNpZ25lZCBsb25nIGZkX2ZsYWdzLApAQCAtMjg1LDExICszMTYsMTMgQEAgc3RhdGlj
IGludCBzeXN0ZW1faGVhcF9hbGxvY2F0ZShzdHJ1Y3QgZG1hX2hlYXAgKmhlYXAsCiB7CiAJc3Ry
dWN0IHN5c3RlbV9oZWFwX2J1ZmZlciAqYnVmZmVyOwogCURFRklORV9ETUFfQlVGX0VYUE9SVF9J
TkZPKGV4cF9pbmZvKTsKKwl1bnNpZ25lZCBsb25nIHNpemVfcmVtYWluaW5nID0gbGVuOworCXVu
c2lnbmVkIGludCBtYXhfb3JkZXIgPSBvcmRlcnNbMF07CiAJc3RydWN0IGRtYV9idWYgKmRtYWJ1
ZjsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOwogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Ci0J
cGdvZmZfdCBwYWdlY291bnQ7Ci0JcGdvZmZfdCBwZzsKKwlzdHJ1Y3QgbGlzdF9oZWFkIHBhZ2Vz
OworCXN0cnVjdCBwYWdlICpwYWdlLCAqdG1wX3BhZ2U7CiAJaW50IGksIHJldCA9IC1FTk9NRU07
CiAKIAlidWZmZXIgPSBremFsbG9jKHNpemVvZigqYnVmZmVyKSwgR0ZQX0tFUk5FTCk7CkBAIC0z
MDEsMjUgKzMzNCwzNSBAQCBzdGF0aWMgaW50IHN5c3RlbV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBk
bWFfaGVhcCAqaGVhcCwKIAlidWZmZXItPmhlYXAgPSBoZWFwOwogCWJ1ZmZlci0+bGVuID0gbGVu
OwogCi0JdGFibGUgPSAmYnVmZmVyLT5zZ190YWJsZTsKLQlwYWdlY291bnQgPSBsZW4gLyBQQUdF
X1NJWkU7Ci0JaWYgKHNnX2FsbG9jX3RhYmxlKHRhYmxlLCBwYWdlY291bnQsIEdGUF9LRVJORUwp
KQotCQlnb3RvIGZyZWVfYnVmZmVyOwotCi0Jc2cgPSB0YWJsZS0+c2dsOwotCWZvciAocGcgPSAw
OyBwZyA8IHBhZ2Vjb3VudDsgcGcrKykgewotCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKwlJTklUX0xJ
U1RfSEVBRCgmcGFnZXMpOworCWkgPSAwOworCXdoaWxlIChzaXplX3JlbWFpbmluZyA+IDApIHsK
IAkJLyoKIAkJICogQXZvaWQgdHJ5aW5nIHRvIGFsbG9jYXRlIG1lbW9yeSBpZiB0aGUgcHJvY2Vz
cwogCQkgKiBoYXMgYmVlbiBraWxsZWQgYnkgU0lHS0lMTAogCQkgKi8KIAkJaWYgKGZhdGFsX3Np
Z25hbF9wZW5kaW5nKGN1cnJlbnQpKQotCQkJZ290byBmcmVlX3BhZ2VzOwotCQlwYWdlID0gYWxs
b2NfcGFnZShHRlBfS0VSTkVMIHwgX19HRlBfWkVSTyk7CisJCQlnb3RvIGZyZWVfYnVmZmVyOwor
CisJCXBhZ2UgPSBhbGxvY19sYXJnZXN0X2F2YWlsYWJsZShzaXplX3JlbWFpbmluZywgbWF4X29y
ZGVyKTsKIAkJaWYgKCFwYWdlKQotCQkJZ290byBmcmVlX3BhZ2VzOwotCQlzZ19zZXRfcGFnZShz
ZywgcGFnZSwgcGFnZV9zaXplKHBhZ2UpLCAwKTsKKwkJCWdvdG8gZnJlZV9idWZmZXI7CisKKwkJ
bGlzdF9hZGRfdGFpbCgmcGFnZS0+bHJ1LCAmcGFnZXMpOworCQlzaXplX3JlbWFpbmluZyAtPSBQ
QUdFX1NJWkUgPDwgY29tcG91bmRfb3JkZXIocGFnZSk7CisJCW1heF9vcmRlciA9IGNvbXBvdW5k
X29yZGVyKHBhZ2UpOworCQlpKys7CisJfQorCisJdGFibGUgPSAmYnVmZmVyLT5zZ190YWJsZTsK
KwlpZiAoc2dfYWxsb2NfdGFibGUodGFibGUsIGksIEdGUF9LRVJORUwpKQorCQlnb3RvIGZyZWVf
YnVmZmVyOworCisJc2cgPSB0YWJsZS0+c2dsOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShw
YWdlLCB0bXBfcGFnZSwgJnBhZ2VzLCBscnUpIHsKKwkJc2dfc2V0X3BhZ2Uoc2csIHBhZ2UsIFBB
R0VfU0laRSA8PCBjb21wb3VuZF9vcmRlcihwYWdlKSwgMCk7CiAJCXNnID0gc2dfbmV4dChzZyk7
CisJCWxpc3RfZGVsKCZwYWdlLT5scnUpOwogCX0KIAogCS8qIGNyZWF0ZSB0aGUgZG1hYnVmICov
CkBAIC0zMzksMTQgKzM4MiwxOCBAQCBzdGF0aWMgaW50IHN5c3RlbV9oZWFwX2FsbG9jYXRlKHN0
cnVjdCBkbWFfaGVhcCAqaGVhcCwKIAkJLyoganVzdCByZXR1cm4sIGFzIHB1dCB3aWxsIGNhbGwg
cmVsZWFzZSBhbmQgdGhhdCB3aWxsIGZyZWUgKi8KIAkJcmV0dXJuIHJldDsKIAl9Ci0KIAlyZXR1
cm4gcmV0OwogCiBmcmVlX3BhZ2VzOgotCWZvcl9lYWNoX3NndGFibGVfc2codGFibGUsIHNnLCBp
KQotCQlfX2ZyZWVfcGFnZShzZ19wYWdlKHNnKSk7CisJZm9yX2VhY2hfc2d0YWJsZV9zZyh0YWJs
ZSwgc2csIGkpIHsKKwkJc3RydWN0IHBhZ2UgKnAgPSBzZ19wYWdlKHNnKTsKKworCQlfX2ZyZWVf
cGFnZXMocCwgY29tcG91bmRfb3JkZXIocCkpOworCX0KIAlzZ19mcmVlX3RhYmxlKHRhYmxlKTsK
IGZyZWVfYnVmZmVyOgorCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShwYWdlLCB0bXBfcGFnZSwg
JnBhZ2VzLCBscnUpCisJCV9fZnJlZV9wYWdlcyhwYWdlLCBjb21wb3VuZF9vcmRlcihwYWdlKSk7
CiAJa2ZyZWUoYnVmZmVyKTsKIAogCXJldHVybiByZXQ7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
