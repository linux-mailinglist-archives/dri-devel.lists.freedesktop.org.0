Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BDE358FB3
	for <lists+dri-devel@lfdr.de>; Fri, 28 Jun 2019 03:26:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E3F46E875;
	Fri, 28 Jun 2019 01:26:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ale.deltatee.com (ale.deltatee.com [207.54.116.67])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8F7D06E428;
 Thu, 27 Jun 2019 18:49:56 +0000 (UTC)
Received: from s01061831bf6ec98c.cg.shawcable.net ([68.147.80.180]
 helo=[192.168.6.132])
 by ale.deltatee.com with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <logang@deltatee.com>)
 id 1hgZSz-0004rJ-D3; Thu, 27 Jun 2019 12:49:54 -0600
To: Christoph Hellwig <hch@lst.de>, Dan Williams <dan.j.williams@intel.com>,
 =?UTF-8?B?SsOpcsO0bWUgR2xpc3Nl?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>
References: <20190626122724.13313-1-hch@lst.de>
 <20190626122724.13313-18-hch@lst.de>
From: Logan Gunthorpe <logang@deltatee.com>
Message-ID: <580609fd-5ef2-bae4-e8f8-adc1eb0314a1@deltatee.com>
Date: Thu, 27 Jun 2019 12:49:47 -0600
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190626122724.13313-18-hch@lst.de>
Content-Language: en-US
X-SA-Exim-Connect-IP: 68.147.80.180
X-SA-Exim-Rcpt-To: nouveau@lists.freedesktop.org, linux-mm@kvack.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-pci@vger.kernel.org, linux-nvdimm@lists.01.org, bskeggs@redhat.com,
 jgg@mellanox.com, jglisse@redhat.com, dan.j.williams@intel.com, hch@lst.de
X-SA-Exim-Mail-From: logang@deltatee.com
X-Spam-Checker-Version: SpamAssassin 3.4.2 (2018-09-13) on ale.deltatee.com
X-Spam-Level: 
X-Spam-Status: No, score=-8.7 required=5.0 tests=ALL_TRUSTED,BAYES_00,
 GREYLIST_ISWHITE,MYRULES_FREE autolearn=ham autolearn_force=no
 version=3.4.2
Subject: Re: [PATCH 17/25] PCI/P2PDMA: use the dev_pagemap internal refcount
X-SA-Exim-Version: 4.2.1 (built Tue, 02 Aug 2016 21:08:31 +0000)
X-SA-Exim-Scanned: Yes (on ale.deltatee.com)
X-Mailman-Approved-At: Fri, 28 Jun 2019 01:25:51 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-nvdimm@lists.01.org, linux-pci@vger.kernel.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org, nouveau@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

CgpPbiAyMDE5LTA2LTI2IDY6MjcgYS5tLiwgQ2hyaXN0b3BoIEhlbGx3aWcgd3JvdGU6Cj4gVGhl
IGZ1bmN0aW9uYWxpdHkgaXMgaWRlbnRpY2FsIHRvIHRoZSBvbmUgY3VycmVudGx5IG9wZW4gY29k
ZWQgaW4KPiBwMnBkbWEuYy4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBDaHJpc3RvcGggSGVsbHdpZyA8
aGNoQGxzdC5kZT4KClJldmlld2VkLWJ5OiBMb2dhbiBHdW50aG9ycGUgPGxvZ2FuZ0BkZWx0YXRl
ZS5jb20+CgpBbHNvLCBmb3IgdGhlIFAyUERNQSBjaGFuZ2VzIGluIHRoaXMgc2VyaWVzOgoKVGVz
dGVkLWJ5OiBMb2dhbiBHdW50aG9ycGUgPGxvZ2FuZ0BkZWx0YXRlZS5jb20+CgpJJ3ZlIHJhbiB0
aGlzIHNlcmllcyB0aHJvdWdoIG15IHNpbXBsZSBQMlBETUEgdGVzdHMuCgpMb2dhbgoKPiAtLS0K
PiAgZHJpdmVycy9wY2kvcDJwZG1hLmMgfCA1NyArKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLQo+ICAxIGZpbGUgY2hhbmdlZCwgNCBpbnNlcnRpb25zKCspLCA1MyBk
ZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9wY2kvcDJwZG1hLmMgYi9kcml2
ZXJzL3BjaS9wMnBkbWEuYwo+IGluZGV4IGViZDhjZTNiYmEyZS4uNjA4Zjg0ZGY2MDRhIDEwMDY0
NAo+IC0tLSBhL2RyaXZlcnMvcGNpL3AycGRtYS5jCj4gKysrIGIvZHJpdmVycy9wY2kvcDJwZG1h
LmMKPiBAQCAtMjQsMTIgKzI0LDYgQEAgc3RydWN0IHBjaV9wMnBkbWEgewo+ICAJYm9vbCBwMnBt
ZW1fcHVibGlzaGVkOwo+ICB9Owo+ICAKPiAtc3RydWN0IHAycGRtYV9wYWdlbWFwIHsKPiAtCXN0
cnVjdCBkZXZfcGFnZW1hcCBwZ21hcDsKPiAtCXN0cnVjdCBwZXJjcHVfcmVmIHJlZjsKPiAtCXN0
cnVjdCBjb21wbGV0aW9uIHJlZl9kb25lOwo+IC19Owo+IC0KPiAgc3RhdGljIHNzaXplX3Qgc2l6
ZV9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
Cj4gIAkJCSBjaGFyICpidWYpCj4gIHsKPiBAQCAtNzgsMzIgKzcyLDYgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBhdHRyaWJ1dGVfZ3JvdXAgcDJwbWVtX2dyb3VwID0gewo+ICAJLm5hbWUgPSAicDJw
bWVtIiwKPiAgfTsKPiAgCj4gLXN0YXRpYyBzdHJ1Y3QgcDJwZG1hX3BhZ2VtYXAgKnRvX3AycF9w
Z21hcChzdHJ1Y3QgcGVyY3B1X3JlZiAqcmVmKQo+IC17Cj4gLQlyZXR1cm4gY29udGFpbmVyX29m
KHJlZiwgc3RydWN0IHAycGRtYV9wYWdlbWFwLCByZWYpOwo+IC19Cj4gLQo+IC1zdGF0aWMgdm9p
ZCBwY2lfcDJwZG1hX3BlcmNwdV9yZWxlYXNlKHN0cnVjdCBwZXJjcHVfcmVmICpyZWYpCj4gLXsK
PiAtCXN0cnVjdCBwMnBkbWFfcGFnZW1hcCAqcDJwX3BnbWFwID0gdG9fcDJwX3BnbWFwKHJlZik7
Cj4gLQo+IC0JY29tcGxldGUoJnAycF9wZ21hcC0+cmVmX2RvbmUpOwo+IC19Cj4gLQo+IC1zdGF0
aWMgdm9pZCBwY2lfcDJwZG1hX3BlcmNwdV9raWxsKHN0cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXAp
Cj4gLXsKPiAtCXBlcmNwdV9yZWZfa2lsbChwZ21hcC0+cmVmKTsKPiAtfQo+IC0KPiAtc3RhdGlj
IHZvaWQgcGNpX3AycGRtYV9wZXJjcHVfY2xlYW51cChzdHJ1Y3QgZGV2X3BhZ2VtYXAgKnBnbWFw
KQo+IC17Cj4gLQlzdHJ1Y3QgcDJwZG1hX3BhZ2VtYXAgKnAycF9wZ21hcCA9Cj4gLQkJY29udGFp
bmVyX29mKHBnbWFwLCBzdHJ1Y3QgcDJwZG1hX3BhZ2VtYXAsIHBnbWFwKTsKPiAtCj4gLQl3YWl0
X2Zvcl9jb21wbGV0aW9uKCZwMnBfcGdtYXAtPnJlZl9kb25lKTsKPiAtCXBlcmNwdV9yZWZfZXhp
dCgmcDJwX3BnbWFwLT5yZWYpOwo+IC19Cj4gLQo+ICBzdGF0aWMgdm9pZCBwY2lfcDJwZG1hX3Jl
bGVhc2Uodm9pZCAqZGF0YSkKPiAgewo+ICAJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkYXRhOwo+
IEBAIC0xNTMsMTEgKzEyMSw2IEBAIHN0YXRpYyBpbnQgcGNpX3AycGRtYV9zZXR1cChzdHJ1Y3Qg
cGNpX2RldiAqcGRldikKPiAgCXJldHVybiBlcnJvcjsKPiAgfQo+ICAKPiAtc3RhdGljIGNvbnN0
IHN0cnVjdCBkZXZfcGFnZW1hcF9vcHMgcGNpX3AycGRtYV9wYWdlbWFwX29wcyA9IHsKPiAtCS5r
aWxsCQk9IHBjaV9wMnBkbWFfcGVyY3B1X2tpbGwsCj4gLQkuY2xlYW51cAk9IHBjaV9wMnBkbWFf
cGVyY3B1X2NsZWFudXAsCj4gLX07Cj4gLQo+ICAvKioKPiAgICogcGNpX3AycGRtYV9hZGRfcmVz
b3VyY2UgLSBhZGQgbWVtb3J5IGZvciB1c2UgYXMgcDJwIG1lbW9yeQo+ICAgKiBAcGRldjogdGhl
IGRldmljZSB0byBhZGQgdGhlIG1lbW9yeSB0bwo+IEBAIC0xNzEsNyArMTM0LDYgQEAgc3RhdGlj
IGNvbnN0IHN0cnVjdCBkZXZfcGFnZW1hcF9vcHMgcGNpX3AycGRtYV9wYWdlbWFwX29wcyA9IHsK
PiAgaW50IHBjaV9wMnBkbWFfYWRkX3Jlc291cmNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBpbnQg
YmFyLCBzaXplX3Qgc2l6ZSwKPiAgCQkJICAgIHU2NCBvZmZzZXQpCj4gIHsKPiAtCXN0cnVjdCBw
MnBkbWFfcGFnZW1hcCAqcDJwX3BnbWFwOwo+ICAJc3RydWN0IGRldl9wYWdlbWFwICpwZ21hcDsK
PiAgCXZvaWQgKmFkZHI7Cj4gIAlpbnQgZXJyb3I7Cj4gQEAgLTE5NCwyNiArMTU2LDE1IEBAIGlu
dCBwY2lfcDJwZG1hX2FkZF9yZXNvdXJjZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgaW50IGJhciwg
c2l6ZV90IHNpemUsCj4gIAkJCXJldHVybiBlcnJvcjsKPiAgCX0KPiAgCj4gLQlwMnBfcGdtYXAg
PSBkZXZtX2t6YWxsb2MoJnBkZXYtPmRldiwgc2l6ZW9mKCpwMnBfcGdtYXApLCBHRlBfS0VSTkVM
KTsKPiAtCWlmICghcDJwX3BnbWFwKQo+ICsJcGdtYXAgPSBkZXZtX2t6YWxsb2MoJnBkZXYtPmRl
diwgc2l6ZW9mKCpwZ21hcCksIEdGUF9LRVJORUwpOwo+ICsJaWYgKCFwZ21hcCkKPiAgCQlyZXR1
cm4gLUVOT01FTTsKPiAtCj4gLQlpbml0X2NvbXBsZXRpb24oJnAycF9wZ21hcC0+cmVmX2RvbmUp
Owo+IC0JZXJyb3IgPSBwZXJjcHVfcmVmX2luaXQoJnAycF9wZ21hcC0+cmVmLAo+IC0JCQlwY2lf
cDJwZG1hX3BlcmNwdV9yZWxlYXNlLCAwLCBHRlBfS0VSTkVMKTsKPiAtCWlmIChlcnJvcikKPiAt
CQlnb3RvIHBnbWFwX2ZyZWU7Cj4gLQo+IC0JcGdtYXAgPSAmcDJwX3BnbWFwLT5wZ21hcDsKPiAt
Cj4gIAlwZ21hcC0+cmVzLnN0YXJ0ID0gcGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYsIGJhcikgKyBv
ZmZzZXQ7Cj4gIAlwZ21hcC0+cmVzLmVuZCA9IHBnbWFwLT5yZXMuc3RhcnQgKyBzaXplIC0gMTsK
PiAgCXBnbWFwLT5yZXMuZmxhZ3MgPSBwY2lfcmVzb3VyY2VfZmxhZ3MocGRldiwgYmFyKTsKPiAt
CXBnbWFwLT5yZWYgPSAmcDJwX3BnbWFwLT5yZWY7Cj4gIAlwZ21hcC0+dHlwZSA9IE1FTU9SWV9E
RVZJQ0VfUENJX1AyUERNQTsKPiAgCXBnbWFwLT5wY2lfcDJwZG1hX2J1c19vZmZzZXQgPSBwY2lf
YnVzX2FkZHJlc3MocGRldiwgYmFyKSAtCj4gIAkJcGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYsIGJh
cik7Cj4gLQlwZ21hcC0+b3BzID0gJnBjaV9wMnBkbWFfcGFnZW1hcF9vcHM7Cj4gIAo+ICAJYWRk
ciA9IGRldm1fbWVtcmVtYXBfcGFnZXMoJnBkZXYtPmRldiwgcGdtYXApOwo+ICAJaWYgKElTX0VS
UihhZGRyKSkgewo+IEBAIC0yMjQsNyArMTc1LDcgQEAgaW50IHBjaV9wMnBkbWFfYWRkX3Jlc291
cmNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBpbnQgYmFyLCBzaXplX3Qgc2l6ZSwKPiAgCWVycm9y
ID0gZ2VuX3Bvb2xfYWRkX293bmVyKHBkZXYtPnAycGRtYS0+cG9vbCwgKHVuc2lnbmVkIGxvbmcp
YWRkciwKPiAgCQkJcGNpX2J1c19hZGRyZXNzKHBkZXYsIGJhcikgKyBvZmZzZXQsCj4gIAkJCXJl
c291cmNlX3NpemUoJnBnbWFwLT5yZXMpLCBkZXZfdG9fbm9kZSgmcGRldi0+ZGV2KSwKPiAtCQkJ
JnAycF9wZ21hcC0+cmVmKTsKPiArCQkJcGdtYXAtPnJlZik7Cj4gIAlpZiAoZXJyb3IpCj4gIAkJ
Z290byBwYWdlc19mcmVlOwo+ICAKPiBAQCAtMjM2LDcgKzE4Nyw3IEBAIGludCBwY2lfcDJwZG1h
X2FkZF9yZXNvdXJjZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgaW50IGJhciwgc2l6ZV90IHNpemUs
Cj4gIHBhZ2VzX2ZyZWU6Cj4gIAlkZXZtX21lbXVubWFwX3BhZ2VzKCZwZGV2LT5kZXYsIHBnbWFw
KTsKPiAgcGdtYXBfZnJlZToKPiAtCWRldm1fa2ZyZWUoJnBkZXYtPmRldiwgcDJwX3BnbWFwKTsK
PiArCWRldm1fa2ZyZWUoJnBkZXYtPmRldiwgcGdtYXApOwo+ICAJcmV0dXJuIGVycm9yOwo+ICB9
Cj4gIEVYUE9SVF9TWU1CT0xfR1BMKHBjaV9wMnBkbWFfYWRkX3Jlc291cmNlKTsKPiAKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
