Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 26AF441C6C
	for <lists+dri-devel@lfdr.de>; Wed, 12 Jun 2019 08:43:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 67A6889260;
	Wed, 12 Jun 2019 06:43:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from pio-pvt-msa3.bahnhof.se (pio-pvt-msa3.bahnhof.se [79.136.2.42])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D70E48925D
 for <dri-devel@lists.freedesktop.org>; Wed, 12 Jun 2019 06:43:22 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by pio-pvt-msa3.bahnhof.se (Postfix) with ESMTP id 3950B3F885;
 Wed, 12 Jun 2019 08:43:11 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -3.1
X-Spam-Level: 
X-Spam-Status: No, score=-3.1 tagged_above=-999 required=6.31
 tests=[ALL_TRUSTED=-1, BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1]
 autolearn=ham autolearn_force=no
Received: from pio-pvt-msa3.bahnhof.se ([127.0.0.1])
 by localhost (pio-pvt-msa3.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id tFDl-1s-1ixU; Wed, 12 Jun 2019 08:42:56 +0200 (CEST)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by pio-pvt-msa3.bahnhof.se (Postfix) with ESMTPA id 79E453F6E1;
 Wed, 12 Jun 2019 08:42:55 +0200 (CEST)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 139DB361C0E;
 Wed, 12 Jun 2019 08:42:55 +0200 (CEST)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thellstrom@vmwopensource.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 2/9] mm: Add an apply_to_pfn_range interface
Date: Wed, 12 Jun 2019 08:42:36 +0200
Message-Id: <20190612064243.55340-3-thellstrom@vmwopensource.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190612064243.55340-1-thellstrom@vmwopensource.org>
References: <20190612064243.55340-1-thellstrom@vmwopensource.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=vmwopensource.org; s=mail; t=1560321775;
 bh=MG0HfLcgqDRwxcPIDolCLkQDrfh6DF2qVfbCiXX/p4A=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=xW5/H8GCfVeh6cQAEEKnLJFmOV0O0Slb48mjCJa2lxw3Iu2m4KMvS3rtq8csRyscV
 55f/lFIA3PEHvLk7d6Jrj5sCcyrIYdUYKFPSJ984jBrHfoKecQO8V5AeDaG8M0Gik4
 5I9de2G+27EiihhanIg/8YAWRMJHefWimrSHPJVM=
X-Mailman-Original-Authentication-Results: pio-pvt-msa3.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=vmwopensource.org header.i=@vmwopensource.org
 header.b=xW5/H8GC; 
 dkim-atps=neutral
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ralph Campbell <rcampbell@nvidia.com>,
 Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 Rik van Riel <riel@surriel.com>, pv-drivers@vmware.com,
 Minchan Kim <minchan@kernel.org>, Will Deacon <will.deacon@arm.com>,
 linux-kernel@vger.kernel.org, Matthew Wilcox <willy@infradead.org>,
 linux-mm@kvack.org, Peter Zijlstra <peterz@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com, Souptick Joarder <jrdr.linux@gmail.com>,
 Huang Ying <ying.huang@intel.com>, Andrew Morton <akpm@linux-foundation.org>,
 nadav.amit@gmail.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKVGhpcyBpcyBi
YXNpY2FsbHkgYXBwbHlfdG9fcGFnZV9yYW5nZSB3aXRoIGFkZGVkIGZ1bmN0aW9uYWxpdHk6CkFs
bG9jYXRpbmcgbWlzc2luZyBwYXJ0cyBvZiB0aGUgcGFnZSB0YWJsZSBiZWNvbWVzIG9wdGlvbmFs
LCB3aGljaAptZWFucyB0aGF0IHRoZSBmdW5jdGlvbiBjYW4gYmUgZ3VhcmFudGVlZCBub3QgdG8g
ZXJyb3IgaWYgYWxsb2NhdGlvbgppcyBkaXNhYmxlZC4gQWxzbyBwYXNzaW5nIG9mIHRoZSBjbG9z
dXJlIHN0cnVjdCBhbmQgY2FsbGJhY2sgZnVuY3Rpb24KYmVjb21lcyBkaWZmZXJlbnQgYW5kIG1v
cmUgaW4gbGluZSB3aXRoIGhvdyB0aGluZ3MgYXJlIGRvbmUgZWxzZXdoZXJlLgoKRmluYWxseSB3
ZSBrZWVwIGFwcGx5X3RvX3BhZ2VfcmFuZ2UgYXMgYSB3cmFwcGVyIGFyb3VuZCBhcHBseV90b19w
Zm5fcmFuZ2UKClRoZSByZWFzb24gZm9yIG5vdCB1c2luZyB0aGUgcGFnZS13YWxrIGNvZGUgaXMg
dGhhdCB3ZSB3YW50IHRvIHBlcmZvcm0KdGhlIHBhZ2Utd2FsayBvbiB2bWFzIHBvaW50aW5nIHRv
IGFuIGFkZHJlc3Mgc3BhY2Ugd2l0aG91dCByZXF1aXJpbmcgdGhlCm1tYXBfc2VtIHRvIGJlIGhl
bGQgcmF0aGVyIHRoYW4gb24gdm1hcyBiZWxvbmdpbmcgdG8gYSBwcm9jZXNzIHdpdGggdGhlCm1t
YXBfc2VtIGhlbGQuCgpOb3RhYmxlIGNoYW5nZXMgc2luY2UgUkZDOgpEb24ndCBleHBvcnQgYXBw
bHlfdG9fcGZuIHJhbmdlLgoKQ2M6IEFuZHJldyBNb3J0b24gPGFrcG1AbGludXgtZm91bmRhdGlv
bi5vcmc+CkNjOiBNYXR0aGV3IFdpbGNveCA8d2lsbHlAaW5mcmFkZWFkLm9yZz4KQ2M6IFdpbGwg
RGVhY29uIDx3aWxsLmRlYWNvbkBhcm0uY29tPgpDYzogUGV0ZXIgWmlqbHN0cmEgPHBldGVyekBp
bmZyYWRlYWQub3JnPgpDYzogUmlrIHZhbiBSaWVsIDxyaWVsQHN1cnJpZWwuY29tPgpDYzogTWlu
Y2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9yZz4KQ2M6IE1pY2hhbCBIb2NrbyA8bWhvY2tvQHN1
c2UuY29tPgpDYzogSHVhbmcgWWluZyA8eWluZy5odWFuZ0BpbnRlbC5jb20+CkNjOiBTb3VwdGlj
ayBKb2FyZGVyIDxqcmRyLmxpbnV4QGdtYWlsLmNvbT4KQ2M6ICJKw6lyw7RtZSBHbGlzc2UiIDxq
Z2xpc3NlQHJlZGhhdC5jb20+CkNjOiBsaW51eC1tbUBrdmFjay5vcmcKQ2M6IGxpbnV4LWtlcm5l
bEB2Z2VyLmtlcm5lbC5vcmcKClNpZ25lZC1vZmYtYnk6IFRob21hcyBIZWxsc3Ryb20gPHRoZWxs
c3Ryb21Adm13YXJlLmNvbT4KUmV2aWV3ZWQtYnk6IFJhbHBoIENhbXBiZWxsIDxyY2FtcGJlbGxA
bnZpZGlhLmNvbT4gI3YxCi0tLQogaW5jbHVkZS9saW51eC9tbS5oIHwgIDEwICsrKysKIG1tL21l
bW9yeS5jICAgICAgICB8IDEzNSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0t
LS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTEzIGluc2VydGlvbnMoKyksIDMyIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvbW0uaCBiL2luY2x1ZGUvbGludXgvbW0u
aAppbmRleCAwZTg4MzRhYzMyYjcuLjNkMDZjZTJhNjRhZiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9s
aW51eC9tbS5oCisrKyBiL2luY2x1ZGUvbGludXgvbW0uaApAQCAtMjY3NSw2ICsyNjc1LDE2IEBA
IHR5cGVkZWYgaW50ICgqcHRlX2ZuX3QpKHB0ZV90ICpwdGUsIHBndGFibGVfdCB0b2tlbiwgdW5z
aWduZWQgbG9uZyBhZGRyLAogZXh0ZXJuIGludCBhcHBseV90b19wYWdlX3JhbmdlKHN0cnVjdCBt
bV9zdHJ1Y3QgKm1tLCB1bnNpZ25lZCBsb25nIGFkZHJlc3MsCiAJCQkgICAgICAgdW5zaWduZWQg
bG9uZyBzaXplLCBwdGVfZm5fdCBmbiwgdm9pZCAqZGF0YSk7CiAKK3N0cnVjdCBwZm5fcmFuZ2Vf
YXBwbHk7Cit0eXBlZGVmIGludCAoKnB0ZXJfZm5fdCkocHRlX3QgKnB0ZSwgcGd0YWJsZV90IHRv
a2VuLCB1bnNpZ25lZCBsb25nIGFkZHIsCisJCQkgc3RydWN0IHBmbl9yYW5nZV9hcHBseSAqY2xv
c3VyZSk7CitzdHJ1Y3QgcGZuX3JhbmdlX2FwcGx5IHsKKwlzdHJ1Y3QgbW1fc3RydWN0ICptbTsK
KwlwdGVyX2ZuX3QgcHRlZm47CisJdW5zaWduZWQgaW50IGFsbG9jOworfTsKK2V4dGVybiBpbnQg
YXBwbHlfdG9fcGZuX3JhbmdlKHN0cnVjdCBwZm5fcmFuZ2VfYXBwbHkgKmNsb3N1cmUsCisJCQkg
ICAgICB1bnNpZ25lZCBsb25nIGFkZHJlc3MsIHVuc2lnbmVkIGxvbmcgc2l6ZSk7CiAKICNpZmRl
ZiBDT05GSUdfUEFHRV9QT0lTT05JTkcKIGV4dGVybiBib29sIHBhZ2VfcG9pc29uaW5nX2VuYWJs
ZWQodm9pZCk7CmRpZmYgLS1naXQgYS9tbS9tZW1vcnkuYyBiL21tL21lbW9yeS5jCmluZGV4IDE2
OGY1NDZhZjFhZC4uNDYyYWE0N2Y4ODc4IDEwMDY0NAotLS0gYS9tbS9tZW1vcnkuYworKysgYi9t
bS9tZW1vcnkuYwpAQCAtMjAzMiwxOCArMjAzMiwxNyBAQCBpbnQgdm1faW9tYXBfbWVtb3J5KHN0
cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLCBwaHlzX2FkZHJfdCBzdGFydCwgdW5zaWduZWQgbG9u
ZwogfQogRVhQT1JUX1NZTUJPTCh2bV9pb21hcF9tZW1vcnkpOwogCi1zdGF0aWMgaW50IGFwcGx5
X3RvX3B0ZV9yYW5nZShzdHJ1Y3QgbW1fc3RydWN0ICptbSwgcG1kX3QgKnBtZCwKLQkJCQkgICAg
IHVuc2lnbmVkIGxvbmcgYWRkciwgdW5zaWduZWQgbG9uZyBlbmQsCi0JCQkJICAgICBwdGVfZm5f
dCBmbiwgdm9pZCAqZGF0YSkKK3N0YXRpYyBpbnQgYXBwbHlfdG9fcHRlX3JhbmdlKHN0cnVjdCBw
Zm5fcmFuZ2VfYXBwbHkgKmNsb3N1cmUsIHBtZF90ICpwbWQsCisJCQkgICAgICB1bnNpZ25lZCBs
b25nIGFkZHIsIHVuc2lnbmVkIGxvbmcgZW5kKQogewogCXB0ZV90ICpwdGU7CiAJaW50IGVycjsK
IAlwZ3RhYmxlX3QgdG9rZW47CiAJc3BpbmxvY2tfdCAqdW5pbml0aWFsaXplZF92YXIocHRsKTsK
IAotCXB0ZSA9IChtbSA9PSAmaW5pdF9tbSkgPworCXB0ZSA9IChjbG9zdXJlLT5tbSA9PSAmaW5p
dF9tbSkgPwogCQlwdGVfYWxsb2Nfa2VybmVsKHBtZCwgYWRkcikgOgotCQlwdGVfYWxsb2NfbWFw
X2xvY2sobW0sIHBtZCwgYWRkciwgJnB0bCk7CisJCXB0ZV9hbGxvY19tYXBfbG9jayhjbG9zdXJl
LT5tbSwgcG1kLCBhZGRyLCAmcHRsKTsKIAlpZiAoIXB0ZSkKIAkJcmV0dXJuIC1FTk9NRU07CiAK
QEAgLTIwNTQsODYgKzIwNTMsMTA5IEBAIHN0YXRpYyBpbnQgYXBwbHlfdG9fcHRlX3JhbmdlKHN0
cnVjdCBtbV9zdHJ1Y3QgKm1tLCBwbWRfdCAqcG1kLAogCXRva2VuID0gcG1kX3BndGFibGUoKnBt
ZCk7CiAKIAlkbyB7Ci0JCWVyciA9IGZuKHB0ZSsrLCB0b2tlbiwgYWRkciwgZGF0YSk7CisJCWVy
ciA9IGNsb3N1cmUtPnB0ZWZuKHB0ZSsrLCB0b2tlbiwgYWRkciwgY2xvc3VyZSk7CiAJCWlmIChl
cnIpCiAJCQlicmVhazsKIAl9IHdoaWxlIChhZGRyICs9IFBBR0VfU0laRSwgYWRkciAhPSBlbmQp
OwogCiAJYXJjaF9sZWF2ZV9sYXp5X21tdV9tb2RlKCk7CiAKLQlpZiAobW0gIT0gJmluaXRfbW0p
CisJaWYgKGNsb3N1cmUtPm1tICE9ICZpbml0X21tKQogCQlwdGVfdW5tYXBfdW5sb2NrKHB0ZS0x
LCBwdGwpOwogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgYXBwbHlfdG9fcG1kX3Jhbmdl
KHN0cnVjdCBtbV9zdHJ1Y3QgKm1tLCBwdWRfdCAqcHVkLAotCQkJCSAgICAgdW5zaWduZWQgbG9u
ZyBhZGRyLCB1bnNpZ25lZCBsb25nIGVuZCwKLQkJCQkgICAgIHB0ZV9mbl90IGZuLCB2b2lkICpk
YXRhKQorc3RhdGljIGludCBhcHBseV90b19wbWRfcmFuZ2Uoc3RydWN0IHBmbl9yYW5nZV9hcHBs
eSAqY2xvc3VyZSwgcHVkX3QgKnB1ZCwKKwkJCSAgICAgIHVuc2lnbmVkIGxvbmcgYWRkciwgdW5z
aWduZWQgbG9uZyBlbmQpCiB7CiAJcG1kX3QgKnBtZDsKIAl1bnNpZ25lZCBsb25nIG5leHQ7Ci0J
aW50IGVycjsKKwlpbnQgZXJyID0gMDsKIAogCUJVR19PTihwdWRfaHVnZSgqcHVkKSk7CiAKLQlw
bWQgPSBwbWRfYWxsb2MobW0sIHB1ZCwgYWRkcik7CisJcG1kID0gcG1kX2FsbG9jKGNsb3N1cmUt
Pm1tLCBwdWQsIGFkZHIpOwogCWlmICghcG1kKQogCQlyZXR1cm4gLUVOT01FTTsKKwogCWRvIHsK
IAkJbmV4dCA9IHBtZF9hZGRyX2VuZChhZGRyLCBlbmQpOwotCQllcnIgPSBhcHBseV90b19wdGVf
cmFuZ2UobW0sIHBtZCwgYWRkciwgbmV4dCwgZm4sIGRhdGEpOworCQlpZiAoIWNsb3N1cmUtPmFs
bG9jICYmIHBtZF9ub25lX29yX2NsZWFyX2JhZChwbWQpKQorCQkJY29udGludWU7CisJCWVyciA9
IGFwcGx5X3RvX3B0ZV9yYW5nZShjbG9zdXJlLCBwbWQsIGFkZHIsIG5leHQpOwogCQlpZiAoZXJy
KQogCQkJYnJlYWs7CiAJfSB3aGlsZSAocG1kKyssIGFkZHIgPSBuZXh0LCBhZGRyICE9IGVuZCk7
CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBhcHBseV90b19wdWRfcmFuZ2Uoc3RydWN0
IG1tX3N0cnVjdCAqbW0sIHA0ZF90ICpwNGQsCi0JCQkJICAgICB1bnNpZ25lZCBsb25nIGFkZHIs
IHVuc2lnbmVkIGxvbmcgZW5kLAotCQkJCSAgICAgcHRlX2ZuX3QgZm4sIHZvaWQgKmRhdGEpCitz
dGF0aWMgaW50IGFwcGx5X3RvX3B1ZF9yYW5nZShzdHJ1Y3QgcGZuX3JhbmdlX2FwcGx5ICpjbG9z
dXJlLCBwNGRfdCAqcDRkLAorCQkJICAgICAgdW5zaWduZWQgbG9uZyBhZGRyLCB1bnNpZ25lZCBs
b25nIGVuZCkKIHsKIAlwdWRfdCAqcHVkOwogCXVuc2lnbmVkIGxvbmcgbmV4dDsKLQlpbnQgZXJy
OworCWludCBlcnIgPSAwOwogCi0JcHVkID0gcHVkX2FsbG9jKG1tLCBwNGQsIGFkZHIpOworCXB1
ZCA9IHB1ZF9hbGxvYyhjbG9zdXJlLT5tbSwgcDRkLCBhZGRyKTsKIAlpZiAoIXB1ZCkKIAkJcmV0
dXJuIC1FTk9NRU07CisKIAlkbyB7CiAJCW5leHQgPSBwdWRfYWRkcl9lbmQoYWRkciwgZW5kKTsK
LQkJZXJyID0gYXBwbHlfdG9fcG1kX3JhbmdlKG1tLCBwdWQsIGFkZHIsIG5leHQsIGZuLCBkYXRh
KTsKKwkJaWYgKCFjbG9zdXJlLT5hbGxvYyAmJiBwdWRfbm9uZV9vcl9jbGVhcl9iYWQocHVkKSkK
KwkJCWNvbnRpbnVlOworCQllcnIgPSBhcHBseV90b19wbWRfcmFuZ2UoY2xvc3VyZSwgcHVkLCBh
ZGRyLCBuZXh0KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0gd2hpbGUgKHB1ZCsrLCBhZGRy
ID0gbmV4dCwgYWRkciAhPSBlbmQpOwogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgYXBw
bHlfdG9fcDRkX3JhbmdlKHN0cnVjdCBtbV9zdHJ1Y3QgKm1tLCBwZ2RfdCAqcGdkLAotCQkJCSAg
ICAgdW5zaWduZWQgbG9uZyBhZGRyLCB1bnNpZ25lZCBsb25nIGVuZCwKLQkJCQkgICAgIHB0ZV9m
bl90IGZuLCB2b2lkICpkYXRhKQorc3RhdGljIGludCBhcHBseV90b19wNGRfcmFuZ2Uoc3RydWN0
IHBmbl9yYW5nZV9hcHBseSAqY2xvc3VyZSwgcGdkX3QgKnBnZCwKKwkJCSAgICAgIHVuc2lnbmVk
IGxvbmcgYWRkciwgdW5zaWduZWQgbG9uZyBlbmQpCiB7CiAJcDRkX3QgKnA0ZDsKIAl1bnNpZ25l
ZCBsb25nIG5leHQ7Ci0JaW50IGVycjsKKwlpbnQgZXJyID0gMDsKIAotCXA0ZCA9IHA0ZF9hbGxv
YyhtbSwgcGdkLCBhZGRyKTsKKwlwNGQgPSBwNGRfYWxsb2MoY2xvc3VyZS0+bW0sIHBnZCwgYWRk
cik7CiAJaWYgKCFwNGQpCiAJCXJldHVybiAtRU5PTUVNOworCiAJZG8gewogCQluZXh0ID0gcDRk
X2FkZHJfZW5kKGFkZHIsIGVuZCk7Ci0JCWVyciA9IGFwcGx5X3RvX3B1ZF9yYW5nZShtbSwgcDRk
LCBhZGRyLCBuZXh0LCBmbiwgZGF0YSk7CisJCWlmICghY2xvc3VyZS0+YWxsb2MgJiYgcDRkX25v
bmVfb3JfY2xlYXJfYmFkKHA0ZCkpCisJCQljb250aW51ZTsKKwkJZXJyID0gYXBwbHlfdG9fcHVk
X3JhbmdlKGNsb3N1cmUsIHA0ZCwgYWRkciwgbmV4dCk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsK
IAl9IHdoaWxlIChwNGQrKywgYWRkciA9IG5leHQsIGFkZHIgIT0gZW5kKTsKIAlyZXR1cm4gZXJy
OwogfQogCi0vKgotICogU2NhbiBhIHJlZ2lvbiBvZiB2aXJ0dWFsIG1lbW9yeSwgZmlsbGluZyBp
biBwYWdlIHRhYmxlcyBhcyBuZWNlc3NhcnkKLSAqIGFuZCBjYWxsaW5nIGEgcHJvdmlkZWQgZnVu
Y3Rpb24gb24gZWFjaCBsZWFmIHBhZ2UgdGFibGUuCisvKioKKyAqIGFwcGx5X3RvX3Bmbl9yYW5n
ZSAtIFNjYW4gYSByZWdpb24gb2YgdmlydHVhbCBtZW1vcnksIGNhbGxpbmcgYSBwcm92aWRlZAor
ICogZnVuY3Rpb24gb24gZWFjaCBsZWFmIHBhZ2UgdGFibGUgZW50cnkKKyAqIEBjbG9zdXJlOiBE
ZXRhaWxzIGFib3V0IGhvdyB0byBzY2FuIGFuZCB3aGF0IGZ1bmN0aW9uIHRvIGFwcGx5CisgKiBA
YWRkcjogU3RhcnQgdmlydHVhbCBhZGRyZXNzCisgKiBAc2l6ZTogU2l6ZSBvZiB0aGUgcmVnaW9u
CisgKgorICogSWYgQGNsb3N1cmUtPmFsbG9jIGlzIHNldCB0byAxLCB0aGUgZnVuY3Rpb24gd2ls
bCBmaWxsIGluIHRoZSBwYWdlIHRhYmxlCisgKiBhcyBuZWNlc3NhcnkuIE90aGVyd2lzZSBpdCB3
aWxsIHNraXAgbm9uLXByZXNlbnQgcGFydHMuCisgKiBOb3RlOiBUaGUgY2FsbGVyIG11c3QgZW5z
dXJlIHRoYXQgdGhlIHJhbmdlIGRvZXMgbm90IGNvbnRhaW4gaHVnZSBwYWdlcy4KKyAqIFRoZSBj
YWxsZXIgbXVzdCBhbHNvIGFzc3VyZSB0aGF0IHRoZSBwcm9wZXIgbW11X25vdGlmaWVyIGZ1bmN0
aW9ucyBhcmUKKyAqIGNhbGxlZCBiZWZvcmUgYW5kIGFmdGVyIHRoZSBjYWxsIHRvIGFwcGx5X3Rv
X3Bmbl9yYW5nZS4KKyAqCisgKiBXQVJOSU5HOiBEbyBub3QgdXNlIHRoaXMgZnVuY3Rpb24gdW5s
ZXNzIHlvdSBrbm93IGV4YWN0bHkgd2hhdCB5b3UgYXJlCisgKiBkb2luZy4gSXQgaXMgbGFja2lu
ZyBzdXBwb3J0IGZvciBodWdlIHBhZ2VzIGFuZCB0cmFuc3BhcmVudCBodWdlIHBhZ2VzLgorICoK
KyAqIFJldHVybjogWmVybyBvbiBzdWNjZXNzLiBJZiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gcmV0
dXJucyBhIG5vbi16ZXJvIHN0YXR1cywKKyAqIHRoZSBwYWdlIHRhYmxlIHdhbGsgd2lsbCB0ZXJt
aW5hdGUgYW5kIHRoYXQgc3RhdHVzIHdpbGwgYmUgcmV0dXJuZWQuCisgKiBJZiBAY2xvc3VyZS0+
YWxsb2MgaXMgc2V0IHRvIDEsIHRoZW4gdGhpcyBmdW5jdGlvbiBtYXkgYWxzbyByZXR1cm4gbWVt
b3J5CisgKiBhbGxvY2F0aW9uIGVycm9ycyBhcmlzaW5nIGZyb20gYWxsb2NhdGluZyBwYWdlIHRh
YmxlIG1lbW9yeS4KICAqLwotaW50IGFwcGx5X3RvX3BhZ2VfcmFuZ2Uoc3RydWN0IG1tX3N0cnVj
dCAqbW0sIHVuc2lnbmVkIGxvbmcgYWRkciwKLQkJCXVuc2lnbmVkIGxvbmcgc2l6ZSwgcHRlX2Zu
X3QgZm4sIHZvaWQgKmRhdGEpCitpbnQgYXBwbHlfdG9fcGZuX3JhbmdlKHN0cnVjdCBwZm5fcmFu
Z2VfYXBwbHkgKmNsb3N1cmUsCisJCSAgICAgICB1bnNpZ25lZCBsb25nIGFkZHIsIHVuc2lnbmVk
IGxvbmcgc2l6ZSkKIHsKIAlwZ2RfdCAqcGdkOwogCXVuc2lnbmVkIGxvbmcgbmV4dDsKQEAgLTIx
NDMsMTYgKzIxNjUsNjUgQEAgaW50IGFwcGx5X3RvX3BhZ2VfcmFuZ2Uoc3RydWN0IG1tX3N0cnVj
dCAqbW0sIHVuc2lnbmVkIGxvbmcgYWRkciwKIAlpZiAoV0FSTl9PTihhZGRyID49IGVuZCkpCiAJ
CXJldHVybiAtRUlOVkFMOwogCi0JcGdkID0gcGdkX29mZnNldChtbSwgYWRkcik7CisJcGdkID0g
cGdkX29mZnNldChjbG9zdXJlLT5tbSwgYWRkcik7CiAJZG8gewogCQluZXh0ID0gcGdkX2FkZHJf
ZW5kKGFkZHIsIGVuZCk7Ci0JCWVyciA9IGFwcGx5X3RvX3A0ZF9yYW5nZShtbSwgcGdkLCBhZGRy
LCBuZXh0LCBmbiwgZGF0YSk7CisJCWlmICghY2xvc3VyZS0+YWxsb2MgJiYgcGdkX25vbmVfb3Jf
Y2xlYXJfYmFkKHBnZCkpCisJCQljb250aW51ZTsKKwkJZXJyID0gYXBwbHlfdG9fcDRkX3Jhbmdl
KGNsb3N1cmUsIHBnZCwgYWRkciwgbmV4dCk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9IHdo
aWxlIChwZ2QrKywgYWRkciA9IG5leHQsIGFkZHIgIT0gZW5kKTsKIAogCXJldHVybiBlcnI7CiB9
CisKKy8qKgorICogc3RydWN0IHBhZ2VfcmFuZ2VfYXBwbHkgLSBDbG9zdXJlIHN0cnVjdHVyZSBm
b3IgYXBwbHlfdG9fcGFnZV9yYW5nZSgpCisgKiBAcHRlcjogVGhlIGJhc2UgY2xvc3VyZSBzdHJ1
Y3R1cmUgd2UgZGVyaXZlIGZyb20KKyAqIEBmbjogVGhlIGxlYWYgcHRlIGZ1bmN0aW9uIHRvIGNh
bGwKKyAqIEBkYXRhOiBUaGUgbGVhZiBwdGUgZnVuY3Rpb24gY2xvc3VyZQorICovCitzdHJ1Y3Qg
cGFnZV9yYW5nZV9hcHBseSB7CisJc3RydWN0IHBmbl9yYW5nZV9hcHBseSBwdGVyOworCXB0ZV9m
bl90IGZuOworCXZvaWQgKmRhdGE7Cit9OworCisvKgorICogQ2FsbGJhY2sgd3JhcHBlciB0byBl
bmFibGUgdXNlIG9mIGFwcGx5X3RvX3Bmbl9yYW5nZSBmb3IKKyAqIHRoZSBhcHBseV90b19wYWdl
X3JhbmdlIGludGVyZmFjZQorICovCitzdGF0aWMgaW50IGFwcGx5X3RvX3BhZ2VfcmFuZ2Vfd3Jh
cHBlcihwdGVfdCAqcHRlLCBwZ3RhYmxlX3QgdG9rZW4sCisJCQkJICAgICAgIHVuc2lnbmVkIGxv
bmcgYWRkciwKKwkJCQkgICAgICAgc3RydWN0IHBmbl9yYW5nZV9hcHBseSAqcHRlcikKK3sKKwlz
dHJ1Y3QgcGFnZV9yYW5nZV9hcHBseSAqcHJhID0KKwkJY29udGFpbmVyX29mKHB0ZXIsIHR5cGVv
ZigqcHJhKSwgcHRlcik7CisKKwlyZXR1cm4gcHJhLT5mbihwdGUsIHRva2VuLCBhZGRyLCBwcmEt
PmRhdGEpOworfQorCisvKgorICogU2NhbiBhIHJlZ2lvbiBvZiB2aXJ0dWFsIG1lbW9yeSwgZmls
bGluZyBpbiBwYWdlIHRhYmxlcyBhcyBuZWNlc3NhcnkKKyAqIGFuZCBjYWxsaW5nIGEgcHJvdmlk
ZWQgZnVuY3Rpb24gb24gZWFjaCBsZWFmIHBhZ2UgdGFibGUuCisgKgorICogV0FSTklORzogRG8g
bm90IHVzZSB0aGlzIGZ1bmN0aW9uIHVubGVzcyB5b3Uga25vdyBleGFjdGx5IHdoYXQgeW91IGFy
ZQorICogZG9pbmcuIEl0IGlzIGxhY2tpbmcgc3VwcG9ydCBmb3IgaHVnZSBwYWdlcyBhbmQgdHJh
bnNwYXJlbnQgaHVnZSBwYWdlcy4KKyAqLworaW50IGFwcGx5X3RvX3BhZ2VfcmFuZ2Uoc3RydWN0
IG1tX3N0cnVjdCAqbW0sIHVuc2lnbmVkIGxvbmcgYWRkciwKKwkJCXVuc2lnbmVkIGxvbmcgc2l6
ZSwgcHRlX2ZuX3QgZm4sIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IHBhZ2VfcmFuZ2VfYXBwbHkg
cHJhID0geworCQkucHRlciA9IHsubW0gPSBtbSwKKwkJCSAuYWxsb2MgPSAxLAorCQkJIC5wdGVm
biA9IGFwcGx5X3RvX3BhZ2VfcmFuZ2Vfd3JhcHBlciB9LAorCQkuZm4gPSBmbiwKKwkJLmRhdGEg
PSBkYXRhCisJfTsKKworCXJldHVybiBhcHBseV90b19wZm5fcmFuZ2UoJnByYS5wdGVyLCBhZGRy
LCBzaXplKTsKK30KIEVYUE9SVF9TWU1CT0xfR1BMKGFwcGx5X3RvX3BhZ2VfcmFuZ2UpOwogCiAv
KgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
