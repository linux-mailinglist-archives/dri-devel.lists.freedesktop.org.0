Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3390B4E789
	for <lists+dri-devel@lfdr.de>; Fri, 21 Jun 2019 13:58:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 553446E897;
	Fri, 21 Jun 2019 11:58:10 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4C2A76E889;
 Fri, 21 Jun 2019 11:58:02 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 9E54D8535D;
 Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-212.ams2.redhat.com
 [10.36.116.212])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 77D065C221;
 Fri, 21 Jun 2019 11:58:00 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 078C8A1E0; Fri, 21 Jun 2019 13:57:58 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 08/18] drm/ttm: use gem vma_node
Date: Fri, 21 Jun 2019 13:57:45 +0200
Message-Id: <20190621115755.8481-9-kraxel@redhat.com>
In-Reply-To: <20190621115755.8481-1-kraxel@redhat.com>
References: <20190621115755.8481-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.25]); Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 "open list:DRM DRIVER FOR QXL VIRTUAL GPU"
 <virtualization@lists.linux-foundation.org>,
 Maxime Ripard <maxime.ripard@bootlin.com>,
 "open list:DRM DRIVER FOR QXL VIRTUAL GPU" <spice-devel@lists.freedesktop.org>,
 Huang Rui <ray.huang@amd.com>,
 VMware Graphics <linux-graphics-maintainer@vmware.com>,
 Gerd Hoffmann <kraxel@redhat.com>,
 "open list:DRM DRIVER FOR NVIDIA GEFORCE/QUADRO GPUS"
 <nouveau@lists.freedesktop.org>, Alex Deucher <alexander.deucher@amd.com>,
 Dave Airlie <airlied@redhat.com>, Sean Paul <sean@poorly.run>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Ben Skeggs <bskeggs@redhat.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHJvcCB2bWFfbm9kZSBmcm9tIHR0bV9idWZmZXJfb2JqZWN0LCB1c2UgdGhlIGdlbSBzdHJ1Y3QK
KGJhc2Uudm1hX25vZGUpIGluc3RlYWQuCgpTaWduZWQtb2ZmLWJ5OiBHZXJkIEhvZmZtYW5uIDxr
cmF4ZWxAcmVkaGF0LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
b2JqZWN0LmggfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9vYmplY3QuaCAgICAgICAg
ICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuaCAgICAgfCAy
ICstCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmggICAgICAgfCAyICstCiBp
bmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oICAgICAgICAgICAgICAgfCA1ICstLS0tCiBkcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jICAgICAgfCA1ICstLS0tCiBkcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rpc3BsYXkuYyAgfCAyICstCiBkcml2ZXJzL2dwdS9k
cm0vbm91dmVhdS9ub3V2ZWF1X2dlbS5jICAgICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9iby5jICAgICAgICAgICAgICAgfCA4ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9ib191dGlsLmMgICAgICAgICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9i
b192bS5jICAgICAgICAgICAgfCA5ICsrKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X3ByaW1lLmMgICAgIHwgMyAtLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4
X2JvLmMgICAgICAgICB8IDQgKystLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfc3Vy
ZmFjZS5jICAgIHwgNCArKy0tCiAxNCBmaWxlcyBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCspLCAz
MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0
LmgKaW5kZXggYTgwYTk5NzJhZDE2Li5hNjhkODViZDhmYWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmgKQEAgLTE5MSw3ICsxOTEsNyBAQCBzdGF0aWMgaW5s
aW5lIHVuc2lnbmVkIGFtZGdwdV9ib19ncHVfcGFnZV9hbGlnbm1lbnQoc3RydWN0IGFtZGdwdV9i
byAqYm8pCiAgKi8KIHN0YXRpYyBpbmxpbmUgdTY0IGFtZGdwdV9ib19tbWFwX29mZnNldChzdHJ1
Y3QgYW1kZ3B1X2JvICpibykKIHsKLQlyZXR1cm4gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZi
by0+dGJvLnZtYV9ub2RlKTsKKwlyZXR1cm4gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZiby0+
dGJvLmJhc2Uudm1hX25vZGUpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9xeGwvcXhsX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmgKaW5k
ZXggYjgxMmQ0YWU5ZDBkLi44YWU1NGJhNzg1N2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9xeGwvcXhsX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5o
CkBAIC02MCw3ICs2MCw3IEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgbG9uZyBxeGxfYm9fc2l6
ZShzdHJ1Y3QgcXhsX2JvICpibykKIAogc3RhdGljIGlubGluZSB1NjQgcXhsX2JvX21tYXBfb2Zm
c2V0KHN0cnVjdCBxeGxfYm8gKmJvKQogewotCXJldHVybiBkcm1fdm1hX25vZGVfb2Zmc2V0X2Fk
ZHIoJmJvLT50Ym8udm1hX25vZGUpOworCXJldHVybiBkcm1fdm1hX25vZGVfb2Zmc2V0X2FkZHIo
JmJvLT50Ym8uYmFzZS52bWFfbm9kZSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgaW50IHF4bF9ib193
YWl0KHN0cnVjdCBxeGxfYm8gKmJvLCB1MzIgKm1lbV90eXBlLApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9u
L3JhZGVvbl9vYmplY3QuaAppbmRleCA5ZmZkODIxNWQzOGEuLmU1NTU0YmY5MTQwZSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmgKQEAgLTExNiw3ICsxMTYsNyBAQCBzdGF0
aWMgaW5saW5lIHVuc2lnbmVkIHJhZGVvbl9ib19ncHVfcGFnZV9hbGlnbm1lbnQoc3RydWN0IHJh
ZGVvbl9ibyAqYm8pCiAgKi8KIHN0YXRpYyBpbmxpbmUgdTY0IHJhZGVvbl9ib19tbWFwX29mZnNl
dChzdHJ1Y3QgcmFkZW9uX2JvICpibykKIHsKLQlyZXR1cm4gZHJtX3ZtYV9ub2RlX29mZnNldF9h
ZGRyKCZiby0+dGJvLnZtYV9ub2RlKTsKKwlyZXR1cm4gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRy
KCZiby0+dGJvLmJhc2Uudm1hX25vZGUpOwogfQogCiBleHRlcm4gaW50IHJhZGVvbl9ib193YWl0
KHN0cnVjdCByYWRlb25fYm8gKmJvLCB1MzIgKm1lbV90eXBlLApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X2Rydi5oCmluZGV4IDllMmQzMDYyYjAxZC4uNzE0NmJhMDBmZDViIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCkBAIC0zOTYsNyArMzk2LDcgQEAgc3RhdGljIGlubGlu
ZSB2b2lkIHZpcnRpb19ncHVfb2JqZWN0X3VucmVmKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAq
KmJvKQogCiBzdGF0aWMgaW5saW5lIHU2NCB2aXJ0aW9fZ3B1X29iamVjdF9tbWFwX29mZnNldChz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvKQogewotCXJldHVybiBkcm1fdm1hX25vZGVfb2Zm
c2V0X2FkZHIoJmJvLT50Ym8udm1hX25vZGUpOworCXJldHVybiBkcm1fdm1hX25vZGVfb2Zmc2V0
X2FkZHIoJmJvLT50Ym8uYmFzZS52bWFfbm9kZSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgaW50IHZp
cnRpb19ncHVfb2JqZWN0X3Jlc2VydmUoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibywKZGlm
ZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmggYi9pbmNsdWRlL2RybS90dG0v
dHRtX2JvX2FwaS5oCmluZGV4IDg4YWE3YmYxYjE4YS4uNzdiZDQyMGExNDdhIDEwMDY0NAotLS0g
YS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1f
Ym9fYXBpLmgKQEAgLTE1Miw3ICsxNTIsNiBAQCBzdHJ1Y3QgdHRtX3R0OwogICogQGRkZXN0cm95
OiBMaXN0IGhlYWQgZm9yIHRoZSBkZWxheWVkIGRlc3Ryb3kgbGlzdC4KICAqIEBzd2FwOiBMaXN0
IGhlYWQgZm9yIHN3YXAgTFJVIGxpc3QuCiAgKiBAbW92aW5nOiBGZW5jZSBzZXQgd2hlbiBCTyBp
cyBtb3ZpbmcKLSAqIEB2bWFfbm9kZTogQWRkcmVzcyBzcGFjZSBtYW5hZ2VyIG5vZGUuCiAgKiBA
b2Zmc2V0OiBUaGUgY3VycmVudCBHUFUgb2Zmc2V0LCB3aGljaCBjYW4gaGF2ZSBkaWZmZXJlbnQg
bWVhbmluZ3MKICAqIGRlcGVuZGluZyBvbiB0aGUgbWVtb3J5IHR5cGUuIEZvciBTWVNURU0gdHlw
ZSBtZW1vcnksIGl0IHNob3VsZCBiZSAwLgogICogQGN1cl9wbGFjZW1lbnQ6IEhpbnQgb2YgY3Vy
cmVudCBwbGFjZW1lbnQuCkBAIC0yMTksOSArMjE4LDcgQEAgc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0IHsKIAkgKi8KIAogCXN0cnVjdCBkbWFfZmVuY2UgKm1vdmluZzsKLQotCXN0cnVjdCBkcm1f
dm1hX29mZnNldF9ub2RlIHZtYV9ub2RlOwotCisJLyogYmFzZS52bWFfbm9kZSAqLwogCXVuc2ln
bmVkIHByaW9yaXR5OwogCiAJLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dl
bV92cmFtX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwpp
bmRleCA2MWQ5NTIwY2MxNWYuLjJlNDc0ZGVlMzBkZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92
cmFtX2hlbHBlci5jCkBAIC0xNjMsNyArMTYzLDcgQEAgRVhQT1JUX1NZTUJPTChkcm1fZ2VtX3Zy
YW1fcHV0KTsKICAqLwogdTY0IGRybV9nZW1fdnJhbV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2dl
bV92cmFtX29iamVjdCAqZ2JvKQogewotCXJldHVybiBkcm1fdm1hX25vZGVfb2Zmc2V0X2FkZHIo
Jmdiby0+Ym8udm1hX25vZGUpOworCXJldHVybiBkcm1fdm1hX25vZGVfb2Zmc2V0X2FkZHIoJmdi
by0+Ym8uYmFzZS52bWFfbm9kZSk7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV9tbWFw
X29mZnNldCk7CiAKQEAgLTYzMyw5ICs2MzMsNiBAQCBFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJh
bV9kcml2ZXJfZ2VtX3ByaW1lX3Z1bm1hcCk7CiBpbnQgZHJtX2dlbV92cmFtX2RyaXZlcl9nZW1f
cHJpbWVfbW1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSwKIAkJCQkgICAgICAgc3RydWN0
IHZtX2FyZWFfc3RydWN0ICp2bWEpCiB7Ci0Jc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdi
byA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZ2VtKTsKLQotCWdiby0+Ym8uYmFzZS52bWFfbm9kZS52
bV9ub2RlLnN0YXJ0ID0gZ2JvLT5iby52bWFfbm9kZS52bV9ub2RlLnN0YXJ0OwogCXJldHVybiBk
cm1fZ2VtX3ByaW1lX21tYXAoZ2VtLCB2bWEpOwogfQogRVhQT1JUX1NZTUJPTChkcm1fZ2VtX3Zy
YW1fZHJpdmVyX2dlbV9wcmltZV9tbWFwKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9u
b3V2ZWF1L25vdXZlYXVfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVh
dV9kaXNwbGF5LmMKaW5kZXggZmM4ZjViYjczY2E4Li45OGFmYzUwMTYyZTkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZGlzcGxheS5jCkBAIC02NzUsNyArNjc1LDcgQEAgbm91
dmVhdV9kaXNwbGF5X2R1bWJfbWFwX29mZnNldChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwK
IAlnZW0gPSBkcm1fZ2VtX29iamVjdF9sb29rdXAoZmlsZV9wcml2LCBoYW5kbGUpOwogCWlmIChn
ZW0pIHsKIAkJc3RydWN0IG5vdXZlYXVfYm8gKmJvID0gbm91dmVhdV9nZW1fb2JqZWN0KGdlbSk7
Ci0JCSpwb2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZiby0+Ym8udm1hX25vZGUp
OworCQkqcG9mZnNldCA9IGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcigmYm8tPmJvLmJhc2Uudm1h
X25vZGUpOwogCQlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoZ2VtKTsKIAkJcmV0dXJuIDA7
CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9nZW0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZ2VtLmMKaW5kZXggMmY0ODRhYjdkYmNh
Li5iMWU0ODUyODEwZWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9nZW0uYwpAQCAt
MjQwLDcgKzI0MCw3IEBAIG5vdXZlYXVfZ2VtX2luZm8oc3RydWN0IGRybV9maWxlICpmaWxlX3By
aXYsIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtLAogCX0KIAogCXJlcC0+c2l6ZSA9IG52Ym8t
PmJvLm1lbS5udW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKLQlyZXAtPm1hcF9oYW5kbGUgPSBkcm1f
dm1hX25vZGVfb2Zmc2V0X2FkZHIoJm52Ym8tPmJvLnZtYV9ub2RlKTsKKwlyZXAtPm1hcF9oYW5k
bGUgPSBkcm1fdm1hX25vZGVfb2Zmc2V0X2FkZHIoJm52Ym8tPmJvLmJhc2Uudm1hX25vZGUpOwog
CXJlcC0+dGlsZV9tb2RlID0gbnZiby0+bW9kZTsKIAlyZXAtPnRpbGVfZmxhZ3MgPSBudmJvLT5j
b250aWcgPyAwIDogTk9VVkVBVV9HRU1fVElMRV9OT05DT05USUc7CiAJaWYgKGNsaS0+ZGV2aWNl
LmluZm8uZmFtaWx5ID49IE5WX0RFVklDRV9JTkZPX1YwX0ZFUk1JKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMK
aW5kZXggNTE2ZWVmM2I3NmQ1Li4xZDkxZGE4NWYzOTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS90dG0vdHRtX2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYwpAQCAt
NjcyLDcgKzY3Miw3IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19yZWxlYXNlKHN0cnVjdCBrcmVmICpr
cmVmKQogCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2ID0gYm8tPmJkZXY7CiAJc3RydWN0IHR0
bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW2JvLT5tZW0ubWVtX3R5cGVdOwog
Ci0JZHJtX3ZtYV9vZmZzZXRfcmVtb3ZlKCZiZGV2LT52bWFfbWFuYWdlciwgJmJvLT52bWFfbm9k
ZSk7CisJZHJtX3ZtYV9vZmZzZXRfcmVtb3ZlKCZiZGV2LT52bWFfbWFuYWdlciwgJmJvLT5iYXNl
LnZtYV9ub2RlKTsKIAl0dG1fbWVtX2lvX2xvY2sobWFuLCBmYWxzZSk7CiAJdHRtX21lbV9pb19m
cmVlX3ZtKGJvKTsKIAl0dG1fbWVtX2lvX3VubG9jayhtYW4pOwpAQCAtMTM0Miw5ICsxMzQyLDkg
QEAgaW50IHR0bV9ib19pbml0X3Jlc2VydmVkKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAog
CQkgKiBhd2F5IG9uY2UgYWxsIHVzZXJzIGFyZSBzd2l0Y2hlZCBvdmVyLgogCQkgKi8KIAkJcmVz
ZXJ2YXRpb25fb2JqZWN0X2luaXQoJmJvLT5iYXNlLl9yZXN2KTsKKwkJZHJtX3ZtYV9ub2RlX3Jl
c2V0KCZiby0+YmFzZS52bWFfbm9kZSk7CiAJfQogCWF0b21pY19pbmMoJmJvLT5iZGV2LT5nbG9i
LT5ib19jb3VudCk7Ci0JZHJtX3ZtYV9ub2RlX3Jlc2V0KCZiby0+dm1hX25vZGUpOwogCiAJLyoK
IAkgKiBGb3IgdHRtX2JvX3R5cGVfZGV2aWNlIGJ1ZmZlcnMsIGFsbG9jYXRlCkBAIC0xMzUyLDcg
KzEzNTIsNyBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9ib19kZXZpY2Ug
KmJkZXYsCiAJICovCiAJaWYgKGJvLT50eXBlID09IHR0bV9ib190eXBlX2RldmljZSB8fAogCSAg
ICBiby0+dHlwZSA9PSB0dG1fYm9fdHlwZV9zZykKLQkJcmV0ID0gZHJtX3ZtYV9vZmZzZXRfYWRk
KCZiZGV2LT52bWFfbWFuYWdlciwgJmJvLT52bWFfbm9kZSwKKwkJcmV0ID0gZHJtX3ZtYV9vZmZz
ZXRfYWRkKCZiZGV2LT52bWFfbWFuYWdlciwgJmJvLT5iYXNlLnZtYV9ub2RlLAogCQkJCQkgYm8t
Pm1lbS5udW1fcGFnZXMpOwogCiAJLyogcGFzc2VkIHJlc2VydmF0aW9uIG9iamVjdHMgc2hvdWxk
IGFscmVhZHkgYmUgbG9ja2VkLApAQCAtMTc4MCw3ICsxNzgwLDcgQEAgdm9pZCB0dG1fYm9fdW5t
YXBfdmlydHVhbF9sb2NrZWQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIHsKIAlzdHJ1
Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9IGJvLT5iZGV2OwogCi0JZHJtX3ZtYV9ub2RlX3VubWFw
KCZiby0+dm1hX25vZGUsIGJkZXYtPmRldl9tYXBwaW5nKTsKKwlkcm1fdm1hX25vZGVfdW5tYXAo
JmJvLT5iYXNlLnZtYV9ub2RlLCBiZGV2LT5kZXZfbWFwcGluZyk7CiAJdHRtX21lbV9pb19mcmVl
X3ZtKGJvKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRp
bC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jCmluZGV4IDNkMjYxN2RkNjNl
My4uNTlmMWI5NzliMGRhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191
dGlsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jCkBAIC01MTAsNyAr
NTEwLDcgQEAgc3RhdGljIGludCB0dG1fYnVmZmVyX29iamVjdF90cmFuc2ZlcihzdHJ1Y3QgdHRt
X2J1ZmZlcl9vYmplY3QgKmJvLAogCUlOSVRfTElTVF9IRUFEKCZmYm8tPmJhc2UuaW9fcmVzZXJ2
ZV9scnUpOwogCW11dGV4X2luaXQoJmZiby0+YmFzZS53dV9tdXRleCk7CiAJZmJvLT5iYXNlLm1v
dmluZyA9IE5VTEw7Ci0JZHJtX3ZtYV9ub2RlX3Jlc2V0KCZmYm8tPmJhc2Uudm1hX25vZGUpOwor
CWRybV92bWFfbm9kZV9yZXNldCgmZmJvLT5iYXNlLmJhc2Uudm1hX25vZGUpOwogCWF0b21pY19z
ZXQoJmZiby0+YmFzZS5jcHVfd3JpdGVycywgMCk7CiAKIAlrcmVmX2luaXQoJmZiby0+YmFzZS5s
aXN0X2tyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYyBi
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKaW5kZXggNmRhY2ZmNDljMWNjLi5mYjY4
NzVhNzg5YjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwpAQCAtMjExLDkgKzIxMSw5IEBAIHN0
YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAl9
CiAKIAlwYWdlX29mZnNldCA9ICgoYWRkcmVzcyAtIHZtYS0+dm1fc3RhcnQpID4+IFBBR0VfU0hJ
RlQpICsKLQkJdm1hLT52bV9wZ29mZiAtIGRybV92bWFfbm9kZV9zdGFydCgmYm8tPnZtYV9ub2Rl
KTsKKwkJdm1hLT52bV9wZ29mZiAtIGRybV92bWFfbm9kZV9zdGFydCgmYm8tPmJhc2Uudm1hX25v
ZGUpOwogCXBhZ2VfbGFzdCA9IHZtYV9wYWdlcyh2bWEpICsgdm1hLT52bV9wZ29mZiAtCi0JCWRy
bV92bWFfbm9kZV9zdGFydCgmYm8tPnZtYV9ub2RlKTsKKwkJZHJtX3ZtYV9ub2RlX3N0YXJ0KCZi
by0+YmFzZS52bWFfbm9kZSk7CiAKIAlpZiAodW5saWtlbHkocGFnZV9vZmZzZXQgPj0gYm8tPm51
bV9wYWdlcykpIHsKIAkJcmV0ID0gVk1fRkFVTFRfU0lHQlVTOwpAQCAtMjY3LDcgKzI2Nyw3IEBA
IHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikK
IAkJCX0gZWxzZSBpZiAodW5saWtlbHkoIXBhZ2UpKSB7CiAJCQkJYnJlYWs7CiAJCQl9Ci0JCQlw
YWdlLT5pbmRleCA9IGRybV92bWFfbm9kZV9zdGFydCgmYm8tPnZtYV9ub2RlKSArCisJCQlwYWdl
LT5pbmRleCA9IGRybV92bWFfbm9kZV9zdGFydCgmYm8tPmJhc2Uudm1hX25vZGUpICsKIAkJCQlw
YWdlX29mZnNldDsKIAkJCXBmbiA9IHBhZ2VfdG9fcGZuKHBhZ2UpOwogCQl9CkBAIC00MTMsNyAr
NDEzLDggQEAgc3RhdGljIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqdHRtX2JvX3ZtX2xvb2t1
cChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAogCW5vZGUgPSBkcm1fdm1hX29mZnNldF9s
b29rdXBfbG9ja2VkKCZiZGV2LT52bWFfbWFuYWdlciwgb2Zmc2V0LCBwYWdlcyk7CiAJaWYgKGxp
a2VseShub2RlKSkgewotCQlibyA9IGNvbnRhaW5lcl9vZihub2RlLCBzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QsIHZtYV9ub2RlKTsKKwkJYm8gPSBjb250YWluZXJfb2Yobm9kZSwgc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0LAorCQkJCSAgYmFzZS52bWFfbm9kZSk7CiAJCWJvID0gdHRtX2JvX2dl
dF91bmxlc3NfemVybyhibyk7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmly
dGlvL3ZpcnRncHVfcHJpbWUuYyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9wcmlt
ZS5jCmluZGV4IDhmYmY3MWJkMGM1ZS4uZmVkODZmM2IwOTllIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfcHJpbWUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmly
dGlvL3ZpcnRncHVfcHJpbWUuYwpAQCAtNjYsOCArNjYsNSBAQCB2b2lkIHZpcnRncHVfZ2VtX3By
aW1lX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgdm9pZCAqdmFkZHIpCiBpbnQg
dmlydGdwdV9nZW1fcHJpbWVfbW1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKIAkJCSAg
IHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogewotCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVj
dCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoob2JqKTsKLQotCWJvLT5nZW1fYmFzZS52bWFf
bm9kZS52bV9ub2RlLnN0YXJ0ID0gYm8tPnRiby52bWFfbm9kZS52bV9ub2RlLnN0YXJ0OwogCXJl
dHVybiBkcm1fZ2VtX3ByaW1lX21tYXAob2JqLCB2bWEpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13
Z2Z4X2JvLmMKaW5kZXggNWQ1YzJiY2UwMWYzLi4wZDk0NzhkMmU3MDAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Zt
d2dmeC92bXdnZnhfYm8uYwpAQCAtODM1LDcgKzgzNSw3IEBAIGludCB2bXdfYm9fYWxsb2NfaW9j
dGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJZ290byBvdXRfbm9fYm87
CiAKIAlyZXAtPmhhbmRsZSA9IGhhbmRsZTsKLQlyZXAtPm1hcF9oYW5kbGUgPSBkcm1fdm1hX25v
ZGVfb2Zmc2V0X2FkZHIoJnZiby0+YmFzZS52bWFfbm9kZSk7CisJcmVwLT5tYXBfaGFuZGxlID0g
ZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZ2Ym8tPmJhc2UuYmFzZS52bWFfbm9kZSk7CiAJcmVw
LT5jdXJfZ21yX2lkID0gaGFuZGxlOwogCXJlcC0+Y3VyX2dtcl9vZmZzZXQgPSAwOwogCkBAIC0x
MDc3LDcgKzEwNzcsNyBAQCBpbnQgdm13X2R1bWJfbWFwX29mZnNldChzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGVfcHJpdiwKIAlpZiAocmV0ICE9IDApCiAJCXJldHVybiAtRUlOVkFMOwogCi0JKm9mZnNl
dCA9IGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcigmb3V0X2J1Zi0+YmFzZS52bWFfbm9kZSk7CisJ
Km9mZnNldCA9IGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcigmb3V0X2J1Zi0+YmFzZS5iYXNlLnZt
YV9ub2RlKTsKIAl2bXdfYm9fdW5yZWZlcmVuY2UoJm91dF9idWYpOwogCXJldHVybiAwOwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfc3VyZmFjZS5jIGIvZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfc3VyZmFjZS5jCmluZGV4IDIxOTQ3MTkwM2JjMS4u
M2E2ZGEzYjY2NDg0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9z
dXJmYWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfc3VyZmFjZS5jCkBA
IC0xNjY5LDcgKzE2NjksNyBAQCB2bXdfZ2Jfc3VyZmFjZV9kZWZpbmVfaW50ZXJuYWwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIAlyZXAtPmJhY2t1cF9zaXplID0gcmVzLT5iYWNrdXBfc2l6ZTsK
IAlpZiAocmVzLT5iYWNrdXApIHsKIAkJcmVwLT5idWZmZXJfbWFwX2hhbmRsZSA9Ci0JCQlkcm1f
dm1hX25vZGVfb2Zmc2V0X2FkZHIoJnJlcy0+YmFja3VwLT5iYXNlLnZtYV9ub2RlKTsKKwkJCWRy
bV92bWFfbm9kZV9vZmZzZXRfYWRkcigmcmVzLT5iYWNrdXAtPmJhc2UuYmFzZS52bWFfbm9kZSk7
CiAJCXJlcC0+YnVmZmVyX3NpemUgPSByZXMtPmJhY2t1cC0+YmFzZS5udW1fcGFnZXMgKiBQQUdF
X1NJWkU7CiAJCXJlcC0+YnVmZmVyX2hhbmRsZSA9IGJhY2t1cF9oYW5kbGU7CiAJfSBlbHNlIHsK
QEAgLTE3NDUsNyArMTc0NSw3IEBAIHZtd19nYl9zdXJmYWNlX3JlZmVyZW5jZV9pbnRlcm5hbChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXJlcC0+Y3JlcC5iYWNrdXBfc2l6ZSA9IHNyZi0+cmVz
LmJhY2t1cF9zaXplOwogCXJlcC0+Y3JlcC5idWZmZXJfaGFuZGxlID0gYmFja3VwX2hhbmRsZTsK
IAlyZXAtPmNyZXAuYnVmZmVyX21hcF9oYW5kbGUgPQotCQlkcm1fdm1hX25vZGVfb2Zmc2V0X2Fk
ZHIoJnNyZi0+cmVzLmJhY2t1cC0+YmFzZS52bWFfbm9kZSk7CisJCWRybV92bWFfbm9kZV9vZmZz
ZXRfYWRkcigmc3JmLT5yZXMuYmFja3VwLT5iYXNlLmJhc2Uudm1hX25vZGUpOwogCXJlcC0+Y3Jl
cC5idWZmZXJfc2l6ZSA9IHNyZi0+cmVzLmJhY2t1cC0+YmFzZS5udW1fcGFnZXMgKiBQQUdFX1NJ
WkU7CiAKIAlyZXAtPmNyZXEudmVyc2lvbiA9IGRybV92bXdfZ2Jfc3VyZmFjZV92MTsKLS0gCjIu
MTguMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
