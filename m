Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9EBFA9D2A6
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 17:27:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F133A6E22F;
	Mon, 26 Aug 2019 15:27:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 472446E21D
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 15:26:56 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 7206428BCB2;
 Mon, 26 Aug 2019 16:26:54 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 02/21] drm: Add a dummy bridge object to drm_encoder
Date: Mon, 26 Aug 2019 17:26:30 +0200
Message-Id: <20190826152649.13820-3-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190826152649.13820-1-boris.brezillon@collabora.com>
References: <20190826152649.13820-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Jernej Skrabec <jernej.skrabec@siol.net>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>, Jonas Karlman <jonas@kwiboo.se>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Thierry Reding <thierry.reding@gmail.com>, Chris Healy <Chris.Healy@zii.aero>,
 Boris Brezillon <boris.brezillon@collabora.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpbiBvbmUgc3RlcCBpbiB0aGUgcmlnaHQgZGlyZWN0aW9uIHRvd2FyZHMgZHJtX2VuY29k
ZXIvZHJtX2JyaWRnZQp1bmlmaWNhdGlvbi4gQnkgZG9pbmcgdGhhdCB3ZSBhbHNvIGFsbG93IGVu
Y29kZXIgZHJpdmVycyB0byBpbXBsZW1lbnQKdGhlIC0+cHJlX2VuYWJsZSgpIGFuZCAtPnBvc3Rf
ZGlzYWJsZSgpIGhvb2tzIHdpdGhvdXQgYWRkaW5nIG5ldwptZXRob2RzIHRvIGRybV9lbmNvZGVy
X2hlbHBlcl9mdW5jcy4KClNpZ25lZC1vZmYtYnk6IEJvcmlzIEJyZXppbGxvbiA8Ym9yaXMuYnJl
emlsbG9uQGNvbGxhYm9yYS5jb20+Ci0tLQpDaGFuZ2VzIGluIHYyOgoqIE5ldyBwYXRjaAotLS0K
IGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jICAgICB8IDE3ICsrKysrKysrKy0t
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAgICAgICAgICAgfCAgNCArKy0t
CiBkcml2ZXJzL2dwdS9kcm0vZHJtX2NydGNfaGVscGVyLmMgICAgICAgfCAyMCArKysrKysrKysr
LS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMgICAgICAgICAgIHwgMjMg
KysrKysrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVy
LmMgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vZXh5bm9zL2V4eW5vc19kcm1fZHNpLmMg
fCAgMiArLQogZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRwLmMgICAgICAgICAgIHwgIDIgKy0K
IGRyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYyAgICB8ICAyICstCiBkcml2ZXJz
L2dwdS9kcm0vbXNtL2hkbWkvaGRtaS5jICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJt
L3JjYXItZHUvcmNhcl9kdV9jcnRjLmMgIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL3ZjNC92
YzRfZHNpLmMgICAgICAgICAgIHwgIDIgKy0KIGluY2x1ZGUvZHJtL2RybV9lbmNvZGVyLmggICAg
ICAgICAgICAgICB8IDE2ICsrKysrKysrKysrKysrLS0KIDEyIGZpbGVzIGNoYW5nZWQsIDU3IGlu
c2VydGlvbnMoKyksIDM5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fYXRvbWljX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVy
LmMKaW5kZXggNDcwNjQzOWZiNDkwLi4zZmU2MDA3NmRhMDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRv
bWljX2hlbHBlci5jCkBAIC00NDUsOCArNDQ1LDkgQEAgbW9kZV9maXh1cChzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUpCiAJCWVuY29kZXIgPSBuZXdfY29ubl9zdGF0ZS0+YmVzdF9lbmNv
ZGVyOwogCQlmdW5jcyA9IGVuY29kZXItPmhlbHBlcl9wcml2YXRlOwogCi0JCXJldCA9IGRybV9i
cmlkZ2VfbW9kZV9maXh1cChlbmNvZGVyLT5icmlkZ2UsICZuZXdfY3J0Y19zdGF0ZS0+bW9kZSwK
LQkJCQkmbmV3X2NydGNfc3RhdGUtPmFkanVzdGVkX21vZGUpOworCQlyZXQgPSBkcm1fYnJpZGdl
X21vZGVfZml4dXAoJmVuY29kZXItPmJyaWRnZSwKKwkJCQkJICAgICZuZXdfY3J0Y19zdGF0ZS0+
bW9kZSwKKwkJCQkJICAgICZuZXdfY3J0Y19zdGF0ZS0+YWRqdXN0ZWRfbW9kZSk7CiAJCWlmICgh
cmV0KSB7CiAJCQlEUk1fREVCVUdfQVRPTUlDKCJCcmlkZ2UgZml4dXAgZmFpbGVkXG4iKTsKIAkJ
CXJldHVybiAtRUlOVkFMOwpAQCAtNTExLDcgKzUxMiw3IEBAIHN0YXRpYyBlbnVtIGRybV9tb2Rl
X3N0YXR1cyBtb2RlX3ZhbGlkX3BhdGgoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwK
IAkJcmV0dXJuIHJldDsKIAl9CiAKLQlyZXQgPSBkcm1fYnJpZGdlX21vZGVfdmFsaWQoZW5jb2Rl
ci0+YnJpZGdlLCBtb2RlKTsKKwlyZXQgPSBkcm1fYnJpZGdlX21vZGVfdmFsaWQoJmVuY29kZXIt
PmJyaWRnZSwgbW9kZSk7CiAJaWYgKHJldCAhPSBNT0RFX09LKSB7CiAJCURSTV9ERUJVR19BVE9N
SUMoIltCUklER0VdIG1vZGVfdmFsaWQoKSBmYWlsZWRcbiIpOwogCQlyZXR1cm4gcmV0OwpAQCAt
MTAzMCw3ICsxMDMxLDcgQEAgZGlzYWJsZV9vdXRwdXRzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiAJCSAqIEVhY2ggZW5jb2RlciBo
YXMgYXQgbW9zdCBvbmUgY29ubmVjdG9yIChzaW5jZSB3ZSBhbHdheXMgc3RlYWwKIAkJICogaXQg
YXdheSksIHNvIHdlIHdvbid0IGNhbGwgZGlzYWJsZSBob29rcyB0d2ljZS4KIAkJICovCi0JCWRy
bV9hdG9taWNfYnJpZGdlX2Rpc2FibGUoZW5jb2Rlci0+YnJpZGdlLCBvbGRfc3RhdGUpOworCQlk
cm1fYXRvbWljX2JyaWRnZV9kaXNhYmxlKCZlbmNvZGVyLT5icmlkZ2UsIG9sZF9zdGF0ZSk7CiAK
IAkJLyogUmlnaHQgZnVuY3Rpb24gZGVwZW5kcyB1cG9uIHRhcmdldCBzdGF0ZS4gKi8KIAkJaWYg
KGZ1bmNzKSB7CkBAIC0xMDQ0LDcgKzEwNDUsNyBAQCBkaXNhYmxlX291dHB1dHMoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIAkJCQlm
dW5jcy0+ZHBtcyhlbmNvZGVyLCBEUk1fTU9ERV9EUE1TX09GRik7CiAJCX0KIAotCQlkcm1fYXRv
bWljX2JyaWRnZV9wb3N0X2Rpc2FibGUoZW5jb2Rlci0+YnJpZGdlLCBvbGRfc3RhdGUpOworCQlk
cm1fYXRvbWljX2JyaWRnZV9wb3N0X2Rpc2FibGUoJmVuY29kZXItPmJyaWRnZSwgb2xkX3N0YXRl
KTsKIAl9CiAKIAlmb3JfZWFjaF9vbGRuZXdfY3J0Y19pbl9zdGF0ZShvbGRfc3RhdGUsIGNydGMs
IG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkgewpAQCAtMTIyNSw3ICsxMjI2LDcg
QEAgY3J0Y19zZXRfbW9kZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqb2xkX3N0YXRlKQogCQkJZnVuY3MtPm1vZGVfc2V0KGVuY29kZXIsIG1vZGUsIGFk
anVzdGVkX21vZGUpOwogCQl9CiAKLQkJZHJtX2JyaWRnZV9tb2RlX3NldChlbmNvZGVyLT5icmlk
Z2UsIG1vZGUsIGFkanVzdGVkX21vZGUpOworCQlkcm1fYnJpZGdlX21vZGVfc2V0KCZlbmNvZGVy
LT5icmlkZ2UsIG1vZGUsIGFkanVzdGVkX21vZGUpOwogCX0KIH0KIApAQCAtMTM0Miw3ICsxMzQz
LDcgQEAgdm9pZCBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsCiAJCSAqIEVhY2ggZW5jb2RlciBoYXMgYXQgbW9zdCBvbmUgY29u
bmVjdG9yIChzaW5jZSB3ZSBhbHdheXMgc3RlYWwKIAkJICogaXQgYXdheSksIHNvIHdlIHdvbid0
IGNhbGwgZW5hYmxlIGhvb2tzIHR3aWNlLgogCQkgKi8KLQkJZHJtX2F0b21pY19icmlkZ2VfcHJl
X2VuYWJsZShlbmNvZGVyLT5icmlkZ2UsIG9sZF9zdGF0ZSk7CisJCWRybV9hdG9taWNfYnJpZGdl
X3ByZV9lbmFibGUoJmVuY29kZXItPmJyaWRnZSwgb2xkX3N0YXRlKTsKIAogCQlpZiAoZnVuY3Mp
IHsKIAkJCWlmIChmdW5jcy0+YXRvbWljX2VuYWJsZSkKQEAgLTEzNTMsNyArMTM1NCw3IEBAIHZv
aWQgZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCQkJCWZ1bmNzLT5jb21taXQoZW5jb2Rlcik7CiAJCX0KIAotCQlkcm1fYXRv
bWljX2JyaWRnZV9lbmFibGUoZW5jb2Rlci0+YnJpZGdlLCBvbGRfc3RhdGUpOworCQlkcm1fYXRv
bWljX2JyaWRnZV9lbmFibGUoJmVuY29kZXItPmJyaWRnZSwgb2xkX3N0YXRlKTsKIAl9CiAKIAlk
cm1fYXRvbWljX2hlbHBlcl9jb21taXRfd3JpdGViYWNrcyhkZXYsIG9sZF9zdGF0ZSk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9icmlkZ2UuYwppbmRleCBjYmE1MzdjOTllNDMuLmM1ZDZiMTdmNjc5MCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2Jy
aWRnZS5jCkBAIC0xMzksOCArMTM5LDggQEAgaW50IGRybV9icmlkZ2VfYXR0YWNoKHN0cnVjdCBk
cm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAogCWlmIChw
cmV2aW91cykKIAkJcHJldmlvdXMtPm5leHQgPSBicmlkZ2U7Ci0JZWxzZQotCQllbmNvZGVyLT5i
cmlkZ2UgPSBicmlkZ2U7CisJZWxzZSBpZiAoYnJpZGdlICE9ICZlbmNvZGVyLT5icmlkZ2UpCisJ
CWVuY29kZXItPmJyaWRnZS5uZXh0ID0gYnJpZGdlOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2NydGNfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2NydGNfaGVscGVyLmMKaW5kZXggZmEzNjk0ODM2YzIyLi5jODBlMzNhODQ2MDUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fY3J0Y19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vZHJtX2NydGNfaGVscGVyLmMKQEAgLTE2MCwxNCArMTYwLDE0IEBAIGRybV9lbmNvZGVy
X2Rpc2FibGUoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQogCWlmICghZW5jb2Rlcl9mdW5j
cykKIAkJcmV0dXJuOwogCi0JZHJtX2JyaWRnZV9kaXNhYmxlKGVuY29kZXItPmJyaWRnZSk7CisJ
ZHJtX2JyaWRnZV9kaXNhYmxlKCZlbmNvZGVyLT5icmlkZ2UpOwogCiAJaWYgKGVuY29kZXJfZnVu
Y3MtPmRpc2FibGUpCiAJCSgqZW5jb2Rlcl9mdW5jcy0+ZGlzYWJsZSkoZW5jb2Rlcik7CiAJZWxz
ZSBpZiAoZW5jb2Rlcl9mdW5jcy0+ZHBtcykKIAkJKCplbmNvZGVyX2Z1bmNzLT5kcG1zKShlbmNv
ZGVyLCBEUk1fTU9ERV9EUE1TX09GRik7CiAKLQlkcm1fYnJpZGdlX3Bvc3RfZGlzYWJsZShlbmNv
ZGVyLT5icmlkZ2UpOworCWRybV9icmlkZ2VfcG9zdF9kaXNhYmxlKCZlbmNvZGVyLT5icmlkZ2Up
OwogfQogCiBzdGF0aWMgdm9pZCBfX2RybV9oZWxwZXJfZGlzYWJsZV91bnVzZWRfZnVuY3Rpb25z
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCkBAIC0zMjcsOCArMzI3LDggQEAgYm9vbCBkcm1fY3J0
Y19oZWxwZXJfc2V0X21vZGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQlpZiAoIWVuY29kZXJf
ZnVuY3MpCiAJCQljb250aW51ZTsKIAotCQlyZXQgPSBkcm1fYnJpZGdlX21vZGVfZml4dXAoZW5j
b2Rlci0+YnJpZGdlLAotCQkJbW9kZSwgYWRqdXN0ZWRfbW9kZSk7CisJCXJldCA9IGRybV9icmlk
Z2VfbW9kZV9maXh1cCgmZW5jb2Rlci0+YnJpZGdlLCBtb2RlLAorCQkJCQkgICAgYWRqdXN0ZWRf
bW9kZSk7CiAJCWlmICghcmV0KSB7CiAJCQlEUk1fREVCVUdfS01TKCJCcmlkZ2UgZml4dXAgZmFp
bGVkXG4iKTsKIAkJCWdvdG8gZG9uZTsKQEAgLTM2NSwxMyArMzY1LDEzIEBAIGJvb2wgZHJtX2Ny
dGNfaGVscGVyX3NldF9tb2RlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJaWYgKCFlbmNvZGVy
X2Z1bmNzKQogCQkJY29udGludWU7CiAKLQkJZHJtX2JyaWRnZV9kaXNhYmxlKGVuY29kZXItPmJy
aWRnZSk7CisJCWRybV9icmlkZ2VfZGlzYWJsZSgmZW5jb2Rlci0+YnJpZGdlKTsKIAogCQkvKiBE
aXNhYmxlIHRoZSBlbmNvZGVycyBhcyB0aGUgZmlyc3QgdGhpbmcgd2UgZG8uICovCiAJCWlmIChl
bmNvZGVyX2Z1bmNzLT5wcmVwYXJlKQogCQkJZW5jb2Rlcl9mdW5jcy0+cHJlcGFyZShlbmNvZGVy
KTsKIAotCQlkcm1fYnJpZGdlX3Bvc3RfZGlzYWJsZShlbmNvZGVyLT5icmlkZ2UpOworCQlkcm1f
YnJpZGdlX3Bvc3RfZGlzYWJsZSgmZW5jb2Rlci0+YnJpZGdlKTsKIAl9CiAKIAlkcm1fY3J0Y19w
cmVwYXJlX2VuY29kZXJzKGRldik7CkBAIC0zOTksNyArMzk5LDcgQEAgYm9vbCBkcm1fY3J0Y19o
ZWxwZXJfc2V0X21vZGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQlpZiAoZW5jb2Rlcl9mdW5j
cy0+bW9kZV9zZXQpCiAJCQllbmNvZGVyX2Z1bmNzLT5tb2RlX3NldChlbmNvZGVyLCBtb2RlLCBh
ZGp1c3RlZF9tb2RlKTsKIAotCQlkcm1fYnJpZGdlX21vZGVfc2V0KGVuY29kZXItPmJyaWRnZSwg
bW9kZSwgYWRqdXN0ZWRfbW9kZSk7CisJCWRybV9icmlkZ2VfbW9kZV9zZXQoJmVuY29kZXItPmJy
aWRnZSwgbW9kZSwgYWRqdXN0ZWRfbW9kZSk7CiAJfQogCiAJLyogTm93IGVuYWJsZSB0aGUgY2xv
Y2tzLCBwbGFuZSwgcGlwZSwgYW5kIGNvbm5lY3RvcnMgdGhhdCB3ZSBzZXQgdXAuICovCkBAIC00
MTQsMTIgKzQxNCwxMiBAQCBib29sIGRybV9jcnRjX2hlbHBlcl9zZXRfbW9kZShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCiAJCWlmICghZW5jb2Rlcl9mdW5jcykKIAkJCWNvbnRpbnVlOwogCi0JCWRy
bV9icmlkZ2VfcHJlX2VuYWJsZShlbmNvZGVyLT5icmlkZ2UpOworCQlkcm1fYnJpZGdlX3ByZV9l
bmFibGUoJmVuY29kZXItPmJyaWRnZSk7CiAKIAkJaWYgKGVuY29kZXJfZnVuY3MtPmNvbW1pdCkK
IAkJCWVuY29kZXJfZnVuY3MtPmNvbW1pdChlbmNvZGVyKTsKIAotCQlkcm1fYnJpZGdlX2VuYWJs
ZShlbmNvZGVyLT5icmlkZ2UpOworCQlkcm1fYnJpZGdlX2VuYWJsZSgmZW5jb2Rlci0+YnJpZGdl
KTsKIAl9CiAKIAkvKiBDYWxjdWxhdGUgYW5kIHN0b3JlIHZhcmlvdXMgY29uc3RhbnRzIHdoaWNo
CkBAIC04MTgsNyArODE4LDcgQEAgc3RhdGljIGludCBkcm1faGVscGVyX2Nob29zZV9lbmNvZGVy
X2RwbXMoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQogLyogSGVscGVyIHdoaWNoIGhhbmRs
ZXMgYnJpZGdlIG9yZGVyaW5nIGFyb3VuZCBlbmNvZGVyIGRwbXMgKi8KIHN0YXRpYyB2b2lkIGRy
bV9oZWxwZXJfZW5jb2Rlcl9kcG1zKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwgaW50IG1v
ZGUpCiB7Ci0Jc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9IGVuY29kZXItPmJyaWRnZTsKKwlz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlID0gJmVuY29kZXItPmJyaWRnZTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzICplbmNvZGVyX2Z1bmNzOwogCiAJZW5jb2Rlcl9m
dW5jcyA9IGVuY29kZXItPmhlbHBlcl9wcml2YXRlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9lbmNvZGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2VuY29kZXIuYwppbmRleCA4
MGQ4OGE1NTMwMmUuLjY4NjA1M2JmNDFiOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9lbmNvZGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMKQEAgLTkxLDYg
KzkxLDkgQEAgdm9pZCBkcm1fZW5jb2Rlcl91bnJlZ2lzdGVyX2FsbChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2KQogCX0KIH0KIAorc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIGR1
bW15X2JyaWRnZV9mdW5jcyA9IHsKK307CisKIC8qKgogICogZHJtX2VuY29kZXJfaW5pdCAtIElu
aXQgYSBwcmVhbGxvY2F0ZWQgZW5jb2RlcgogICogQGRldjogZHJtIGRldmljZQpAQCAtMTQwLDYg
KzE0MywxMyBAQCBpbnQgZHJtX2VuY29kZXJfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CQlnb3RvIG91dF9wdXQ7CiAJfQogCisJaWYgKCFlbmNvZGVyLT5icmlkZ2UuZnVuY3MpCisJCWVu
Y29kZXItPmJyaWRnZS5mdW5jcyA9ICZkdW1teV9icmlkZ2VfZnVuY3M7CisKKwlyZXQgPSBkcm1f
YnJpZGdlX2F0dGFjaChlbmNvZGVyLCAmZW5jb2Rlci0+YnJpZGdlLCBOVUxMKTsKKwlpZiAocmV0
KQorCQlnb3RvIG91dF9wdXQ7CisKIAlsaXN0X2FkZF90YWlsKCZlbmNvZGVyLT5oZWFkLCAmZGV2
LT5tb2RlX2NvbmZpZy5lbmNvZGVyX2xpc3QpOwogCWVuY29kZXItPmluZGV4ID0gZGV2LT5tb2Rl
X2NvbmZpZy5udW1fZW5jb2RlcisrOwogCkBAIC0xNjAsMjEgKzE3MCwxNiBAQCBFWFBPUlRfU1lN
Qk9MKGRybV9lbmNvZGVyX2luaXQpOwogdm9pZCBkcm1fZW5jb2Rlcl9jbGVhbnVwKHN0cnVjdCBk
cm1fZW5jb2RlciAqZW5jb2RlcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rl
ci0+ZGV2OworCXN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsICpuZXh0OwogCiAJLyogTm90ZSB0
aGF0IHRoZSBlbmNvZGVyX2xpc3QgaXMgY29uc2lkZXJlZCB0byBiZSBzdGF0aWM7IHNob3VsZCB3
ZQogCSAqIHJlbW92ZSB0aGUgZHJtX2VuY29kZXIgYXQgcnVudGltZSB3ZSB3b3VsZCBoYXZlIHRv
IGRlY3JlbWVudCBhbGwKIAkgKiB0aGUgaW5kaWNlcyBvbiB0aGUgZHJtX2VuY29kZXIgYWZ0ZXIg
dXMgaW4gdGhlIGVuY29kZXJfbGlzdC4KIAkgKi8KIAotCWlmIChlbmNvZGVyLT5icmlkZ2UpIHsK
LQkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9IGVuY29kZXItPmJyaWRnZTsKLQkJc3RydWN0
IGRybV9icmlkZ2UgKm5leHQ7Ci0KLQkJd2hpbGUgKGJyaWRnZSkgewotCQkJbmV4dCA9IGJyaWRn
ZS0+bmV4dDsKLQkJCWRybV9icmlkZ2VfZGV0YWNoKGJyaWRnZSk7Ci0JCQlicmlkZ2UgPSBuZXh0
OwotCQl9CisJZm9yIChicmlkZ2UgPSAmZW5jb2Rlci0+YnJpZGdlOyBicmlkZ2U7IGJyaWRnZSA9
IG5leHQpIHsKKwkJbmV4dCA9IGJyaWRnZS0+bmV4dDsKKwkJZHJtX2JyaWRnZV9kZXRhY2goYnJp
ZGdlKTsKIAl9CiAKIAlkcm1fbW9kZV9vYmplY3RfdW5yZWdpc3RlcihkZXYsICZlbmNvZGVyLT5i
YXNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVyLmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5jCmluZGV4IDM1MWNiYzQwZjBmOC4uZTRh
ZjJmOWZhMzcyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVyLmMKQEAgLTExMyw3ICsxMTMs
NyBAQCBkcm1fbW9kZV92YWxpZGF0ZV9waXBlbGluZShzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
bW9kZSwKIAkJCWNvbnRpbnVlOwogCQl9CiAKLQkJcmV0ID0gZHJtX2JyaWRnZV9tb2RlX3ZhbGlk
KGVuY29kZXItPmJyaWRnZSwgbW9kZSk7CisJCXJldCA9IGRybV9icmlkZ2VfbW9kZV92YWxpZCgm
ZW5jb2Rlci0+YnJpZGdlLCBtb2RlKTsKIAkJaWYgKHJldCAhPSBNT0RFX09LKSB7CiAJCQkvKiBU
aGVyZSBpcyBhbHNvIG5vIHBvaW50IGluIGNvbnRpbnVpbmcgZm9yIGNydGMgY2hlY2sKIAkJCSAq
IGhlcmUuICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXh5bm9zL2V4eW5vc19kcm1f
ZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vZXh5bm9zL2V4eW5vc19kcm1fZHNpLmMKaW5kZXggNzI3
MjZmMmM3YTlmLi44ZTY1NWFlMWZiMGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9leHlu
b3MvZXh5bm9zX2RybV9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZXh5bm9zL2V4eW5vc19k
cm1fZHNpLmMKQEAgLTE1MjIsNyArMTUyMiw3IEBAIHN0YXRpYyBpbnQgZXh5bm9zX2RzaV9ob3N0
X2F0dGFjaChzdHJ1Y3QgbWlwaV9kc2lfaG9zdCAqaG9zdCwKIAlpZiAob3V0X2JyaWRnZSkgewog
CQlkcm1fYnJpZGdlX2F0dGFjaChlbmNvZGVyLCBvdXRfYnJpZGdlLCBOVUxMKTsKIAkJZHNpLT5v
dXRfYnJpZGdlID0gb3V0X2JyaWRnZTsKLQkJZW5jb2Rlci0+YnJpZGdlID0gTlVMTDsKKwkJZW5j
b2Rlci0+YnJpZGdlLm5leHQgPSBOVUxMOwogCX0gZWxzZSB7CiAJCWludCByZXQgPSBleHlub3Nf
ZHNpX2NyZWF0ZV9jb25uZWN0b3IoZW5jb2Rlcik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tc20vZWRwL2VkcC5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRwLmMKaW5kZXgg
MGYzMTJhYzViNjI0Li5iNTQ1NTlhNzlkMzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9t
c20vZWRwL2VkcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcC5jCkBAIC0xNzgs
NyArMTc4LDcgQEAgaW50IG1zbV9lZHBfbW9kZXNldF9pbml0KHN0cnVjdCBtc21fZWRwICplZHAs
IHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQllbmNvZGVyLT5i
cmlkZ2UgPSBlZHAtPmJyaWRnZTsKKwllbmNvZGVyLT5icmlkZ2UubmV4dCA9IGVkcC0+YnJpZGdl
OwogCiAJcHJpdi0+YnJpZGdlc1twcml2LT5udW1fYnJpZGdlcysrXSAgICAgICA9IGVkcC0+YnJp
ZGdlOwogCXByaXYtPmNvbm5lY3RvcnNbcHJpdi0+bnVtX2Nvbm5lY3RvcnMrK10gPSBlZHAtPmNv
bm5lY3RvcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2Uu
YyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYwppbmRleCAyOTUwYmJhNGFj
YTkuLjQ0NmFjY2ExMTBlOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRw
X2JyaWRnZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYwpAQCAt
NTYsNyArNTYsNyBAQCBzdGF0aWMgdm9pZCBlZHBfYnJpZGdlX21vZGVfc2V0KHN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2UsCiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KGNvbm5lY3RvciwgJmRldi0+
bW9kZV9jb25maWcuY29ubmVjdG9yX2xpc3QsIGhlYWQpIHsKIAkJaWYgKChjb25uZWN0b3ItPmVu
Y29kZXIgIT0gTlVMTCkgJiYKLQkJCShjb25uZWN0b3ItPmVuY29kZXItPmJyaWRnZSA9PSBicmlk
Z2UpKSB7CisJCQkoY29ubmVjdG9yLT5lbmNvZGVyLT5icmlkZ2UubmV4dCA9PSBicmlkZ2UpKSB7
CiAJCQltc21fZWRwX2N0cmxfdGltaW5nX2NmZyhlZHAtPmN0cmwsCiAJCQkJYWRqdXN0ZWRfbW9k
ZSwgJmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvKTsKIAkJCWJyZWFrOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL21zbS9oZG1pL2hkbWkuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vaGRtaS9o
ZG1pLmMKaW5kZXggMGU0MjE3YmUzZjAwLi45ZDk0YTg4ZGQ4ZDYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9tc20vaGRtaS9oZG1pLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9oZG1p
L2hkbWkuYwpAQCAtMzI3LDcgKzMyNyw3IEBAIGludCBtc21faGRtaV9tb2Rlc2V0X2luaXQoc3Ry
dWN0IGhkbWkgKmhkbWksCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQllbmNvZGVyLT5icmlkZ2UgPSBo
ZG1pLT5icmlkZ2U7CisJZW5jb2Rlci0+YnJpZGdlLm5leHQgPSBoZG1pLT5icmlkZ2U7CiAKIAlw
cml2LT5icmlkZ2VzW3ByaXYtPm51bV9icmlkZ2VzKytdICAgICAgID0gaGRtaS0+YnJpZGdlOwog
CXByaXYtPmNvbm5lY3RvcnNbcHJpdi0+bnVtX2Nvbm5lY3RvcnMrK10gPSBoZG1pLT5jb25uZWN0
b3I7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5jCmluZGV4IDJkYTQ2ZTNkYzRh
ZS4uMWJkNzQ4MjAyOTQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2Fy
X2R1X2NydGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYwpA
QCAtNjgxLDcgKzY4MSw3IEBAIHN0YXRpYyB2b2lkIHJjYXJfZHVfY3J0Y19hdG9taWNfZW5hYmxl
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUgPQogCQkJJmNydGMtPnN0YXRlLT5hZGp1c3RlZF9tb2RlOwogCi0JCXJjYXJfbHZkc19j
bGtfZW5hYmxlKGVuY29kZXItPmJhc2UuYnJpZGdlLAorCQlyY2FyX2x2ZHNfY2xrX2VuYWJsZShl
bmNvZGVyLT5iYXNlLmJyaWRnZS5uZXh0LAogCQkJCSAgICAgbW9kZS0+Y2xvY2sgKiAxMDAwKTsK
IAl9CiAKQEAgLTcwNyw3ICs3MDcsNyBAQCBzdGF0aWMgdm9pZCByY2FyX2R1X2NydGNfYXRvbWlj
X2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkgKiBEaXNhYmxlIHRoZSBMVkRTIGNs
b2NrIG91dHB1dCwgc2VlCiAJCSAqIHJjYXJfZHVfY3J0Y19hdG9taWNfZW5hYmxlKCkuCiAJCSAq
LwotCQlyY2FyX2x2ZHNfY2xrX2Rpc2FibGUoZW5jb2Rlci0+YmFzZS5icmlkZ2UpOworCQlyY2Fy
X2x2ZHNfY2xrX2Rpc2FibGUoZW5jb2Rlci0+YmFzZS5icmlkZ2UubmV4dCk7CiAJfQogCiAJc3Bp
bl9sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92YzQvdmM0X2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZjNC92YzRfZHNpLmMKaW5k
ZXggM2Y2Mzk0M2U1NDcyLi5lNjRiNjZiMWVmY2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS92YzQvdmM0X2RzaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92YzQvdmM0X2RzaS5jCkBAIC0x
NjEwLDcgKzE2MTAsNyBAQCBzdGF0aWMgaW50IHZjNF9kc2lfYmluZChzdHJ1Y3QgZGV2aWNlICpk
ZXYsIHN0cnVjdCBkZXZpY2UgKm1hc3Rlciwgdm9pZCAqZGF0YSkKIAkgKiBmcm9tIG91ciBkcml2
ZXIsIHNpbmNlIHdlIG5lZWQgdG8gc2VxdWVuY2UgdGhlbSB3aXRoaW4gdGhlCiAJICogZW5jb2Rl
cidzIGVuYWJsZS9kaXNhYmxlIHBhdGhzLgogCSAqLwotCWRzaS0+ZW5jb2Rlci0+YnJpZGdlID0g
TlVMTDsKKwlkc2ktPmVuY29kZXItPmJyaWRnZS5uZXh0ID0gTlVMTDsKIAogCWlmIChkc2ktPnBv
cnQgPT0gMCkKIAkJdmM0X2RlYnVnZnNfYWRkX3JlZ3NldDMyKGRybSwgImRzaTBfcmVncyIsICZk
c2ktPnJlZ3NldCk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZW5jb2Rlci5oIGIvaW5j
bHVkZS9kcm0vZHJtX2VuY29kZXIuaAppbmRleCA3MGNmY2EwM2Q4MTIuLjMwZDM0N2MzNzQwMiAx
MDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2VuY29kZXIuaAorKysgYi9pbmNsdWRlL2RybS9k
cm1fZW5jb2Rlci5oCkBAIC0yNSw2ICsyNSw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+
CiAjaW5jbHVkZSA8bGludXgvY3R5cGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2JyaWRnZS5oPgog
I2luY2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgogI2luY2x1ZGUgPGRybS9kcm1fbW9kZS5oPgogI2lu
Y2x1ZGUgPGRybS9kcm1fbW9kZV9vYmplY3QuaD4KQEAgLTg5LDcgKzkwLDYgQEAgc3RydWN0IGRy
bV9lbmNvZGVyX2Z1bmNzIHsKICAqIEBoZWFkOiBsaXN0IG1hbmFnZW1lbnQKICAqIEBiYXNlOiBi
YXNlIEtNUyBvYmplY3QKICAqIEBuYW1lOiBodW1hbiByZWFkYWJsZSBuYW1lLCBjYW4gYmUgb3Zl
cndyaXR0ZW4gYnkgdGhlIGRyaXZlcgotICogQGJyaWRnZTogYnJpZGdlIGFzc29jaWF0ZWQgdG8g
dGhlIGVuY29kZXIKICAqIEBmdW5jczogY29udHJvbCBmdW5jdGlvbnMKICAqIEBoZWxwZXJfcHJp
dmF0ZTogbWlkLWxheWVyIHByaXZhdGUgZGF0YQogICoKQEAgLTE3MiwxMyArMTcyLDI1IEBAIHN0
cnVjdCBkcm1fZW5jb2RlciB7CiAJICogJmRybV9jb25uZWN0b3Jfc3RhdGUuY3J0Yy4KIAkgKi8K
IAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7Ci0Jc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKKwor
CS8qKgorCSAqIEBicmlkZ2U6IEJyaWRnZSByZXByZXNlbnRpbmcgb3VyIGVuY29kZXIuIE90aGVy
IGJyaWRnZXMgbWlnaHQgYmUKKwkgKiBsaW5rZWQgdG8gdGhpcyBkdW1teSBicmlkZ2UgZWxlbWVu
dCB0byBmb3JtIGFuIGVuY29kZXIgY2hhaW4uCisJICovCisJc3RydWN0IGRybV9icmlkZ2UgYnJp
ZGdlOworCiAJY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2Z1bmNzICpmdW5jczsKIAljb25zdCBz
dHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzICpoZWxwZXJfcHJpdmF0ZTsKIH07CiAKICNk
ZWZpbmUgb2JqX3RvX2VuY29kZXIoeCkgY29udGFpbmVyX29mKHgsIHN0cnVjdCBkcm1fZW5jb2Rl
ciwgYmFzZSkKIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX2VuY29kZXIgKgorYnJpZGdlX3Rv
X2VuY29kZXIoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlyZXR1cm4gY29udGFpbmVy
X29mKGJyaWRnZSwgc3RydWN0IGRybV9lbmNvZGVyLCBicmlkZ2UpOworfQorCiBfX3ByaW50Zig1
LCA2KQogaW50IGRybV9lbmNvZGVyX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJICAg
ICBzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCi0tIAoyLjIxLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
