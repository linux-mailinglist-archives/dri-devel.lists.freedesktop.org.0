Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0380BA6399
	for <lists+dri-devel@lfdr.de>; Tue,  3 Sep 2019 10:11:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CD10E8979F;
	Tue,  3 Sep 2019 08:11:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lj1-x241.google.com (mail-lj1-x241.google.com
 [IPv6:2a00:1450:4864:20::241])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D90E8979F
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Sep 2019 08:11:35 +0000 (UTC)
Received: by mail-lj1-x241.google.com with SMTP id d5so4097888lja.10
 for <dri-devel@lists.freedesktop.org>; Tue, 03 Sep 2019 01:11:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=Tyymm91MS3uOn9HpSwdxIsV+GT0nl2VitRUl2IB6nOw=;
 b=RVYIiV0kvFQVop7BI7x2m9aqnV3THjVc2V6HNAgRPvJfFb4BiUo7AdSpLL8imJYXK9
 vHZDMp/zD/ZBMbi6tXO2bOI0RBfmqOJfPVi+o9+q3dvbWuSQhCFwWslvWggQ3cGg1qP5
 YTc0JUmf14cXfvExMF46WPomfVYluYkn/vceqki02o+8FesLzWAWu4TSMzwpSMnBOvxO
 VaZK3JsnDaxqaOAdltzwQQNhro/SCxGdmv6/z0aBgVYhVe8uzbThJDRUuEOBFdnsGNxQ
 8uYumSCUw8ce5eabqQ2AfaNj5zGEi+T1rwP53k5rp8eAvIXlo4DXNGrB2qYYS+Rqdb+k
 DoTA==
X-Gm-Message-State: APjAAAX3+YA6VOfcY9Wo9ZWGHroHccJevEHw1e4dmIDdeMPPeFQAexBB
 ea3S+B4y9KUFdxh19e5YSzL1IWQhiwo=
X-Google-Smtp-Source: APXvYqwUnFbDtTzGCCSNCsub1i+N+3wqejdFFKlBlrvWWcq8hqyo9DwV6xiAQeT2hUZ+xLemBdlzFg==
X-Received: by 2002:a2e:874a:: with SMTP id q10mr1611312ljj.187.1567498293371; 
 Tue, 03 Sep 2019 01:11:33 -0700 (PDT)
Received: from genomnajs.ideon.se ([85.235.10.227])
 by smtp.gmail.com with ESMTPSA id e21sm2811980lfj.10.2019.09.03.01.11.31
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 03 Sep 2019 01:11:31 -0700 (PDT)
From: Linus Walleij <linus.walleij@linaro.org>
To: dri-devel@lists.freedesktop.org,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>
Subject: [PATCH v3] drm/mcde: Fix DSI transfers
Date: Tue,  3 Sep 2019 10:11:29 +0200
Message-Id: <20190903081129.19617-1-linus.walleij@linaro.org>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=Tyymm91MS3uOn9HpSwdxIsV+GT0nl2VitRUl2IB6nOw=;
 b=N5Cb1pysICGuR4xGN0r/C4C9NhXdoMUlkOAomeQyAbbYuBc9My7GQq1DsilPoyBed9
 M6n9QwjHaAj+Pl8m9lfve6EF05f4mUpQj/BKtV84kIMeiUvCwY6Cg1V+2Cz7Tyu4TNdU
 Vax6Uxgi1Q/AYbpWOqzvI7eW2jrkKILoK6FjFxvnEIZa2205QzKm7IWRvxBLQXZo4Mdy
 mH58L3SteOZsDAcUDBxNrgmPnmTJaAeG6glYyugsCcdNpEWZXRJG8/XJBV/k+Wk75HVS
 5h+BHdvWqLmpjJ8PmWft297g7IgsHJjiLGPlm10LsgQ8PrnDyy7h/37WOjujzzes2D8g
 +caA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Stephan Gerhold <stephan@gerhold.net>, kbuild test robot <lkp@intel.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUgd2VyZSBidWdzIGluIHRoZSBEU0kgdHJhbnNmZXIgKHJlYWQgYW5kIHdyaXRlKSBmdW5j
dGlvbgphcyBpdCB3YXMgb25seSB0ZXN0ZWQgd2l0aCBkaXNwbGF5cyBldmVyIG5lZWRpbmcgYSBz
aW5nbGUgYnl0ZQp0byBiZSB3cml0dGVuLiBGaXhlZCBpdCB1cCBhbmQgdGVzdGVkIHNvIHdlIGNh
biBub3cgd3JpdGUKbWVzc2FnZXMgb2YgdXAgdG8gMTYgYnl0ZXMgYW5kIHJlYWQgdXAgdG8gNCBi
eXRlcyBmcm9tIHRoZQpkaXNwbGF5LgoKVGVzdGVkIHdpdGggYSBTb255IEFDWDQyNEFLUCBkaXNw
bGF5OiB0aGlzIGRpc3BsYXkgbm93IHNlbGYtCmlkZW50aWZpZXMgYW5kIGNhbiBjb250cm9sIGJh
Y2tsaWdodCBpbiBjb21tYW5kIG1vZGUuCgpSZXBvcnRlZC1ieToga2J1aWxkIHRlc3Qgcm9ib3Qg
PGxrcEBpbnRlbC5jb20+CkZpeGVzOiA1ZmM1MzdiZmQwMDAgKCJkcm0vbWNkZTogQWRkIG5ldyBk
cml2ZXIgZm9yIFNULUVyaWNzc29uIE1DREUiKQpSZXZpZXdlZC1ieTogU3RlcGhhbiBHZXJob2xk
IDxzdGVwaGFuQGdlcmhvbGQubmV0PgpTaWduZWQtb2ZmLWJ5OiBMaW51cyBXYWxsZWlqIDxsaW51
cy53YWxsZWlqQGxpbmFyby5vcmc+Ci0tLQpDaGFuZ2VMb2cgdjItPnYzOgotIEZpeCBhbiBlcnJv
ciBtZXNzYWdlIHRvIGluZGljYXRlIHJlYWRpbmcgZXJyb3IgcmF0aGVyIHRoYW4KICB3cml0aW5n
IGVycm9yLgotIFVzZSB0aGUgbG9jYWwgdmFyaWFibGUgZm9yIHVuZGVyZmxvdyBwcmludC4KLSBD
b2xsZWN0ZWQgU3RlcGhhbidzIHJldmlld2VkLWJ5LgpDaGFuZ2VMb2cgdjEtPnYyOgotIEZpeCBh
IHByaW50IG1vZGlmaWVyIGZvciBkZXZfZXJyKCkgZm91bmQgYnkgdGhlIGJ1aWxkIHJvYm90Lgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZHNpLmMgfCA3MCArKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA0NyBpbnNlcnRpb25zKCspLCAyMyBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWNkZS9tY2RlX2RzaS5j
IGIvZHJpdmVycy9ncHUvZHJtL21jZGUvbWNkZV9kc2kuYwppbmRleCAwN2Y3MDkwZDA4YjMuLmNk
MjYxYzI2NmYzNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21jZGUvbWNkZV9kc2kuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vbWNkZS9tY2RlX2RzaS5jCkBAIC0xNzgsMjIgKzE3OCwyNiBA
QCBzdGF0aWMgc3NpemVfdCBtY2RlX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9o
b3N0ICpob3N0LAogCWNvbnN0IHUzMiBsb29wX2RlbGF5X3VzID0gMTA7IC8qIHVzICovCiAJY29u
c3QgdTggKnR4ID0gbXNnLT50eF9idWY7CiAJdTMyIGxvb3BfY291bnRlcjsKLQlzaXplX3QgdHhs
ZW47CisJc2l6ZV90IHR4bGVuID0gbXNnLT50eF9sZW47CisJc2l6ZV90IHJ4bGVuID0gbXNnLT5y
eF9sZW47CiAJdTMyIHZhbDsKIAlpbnQgcmV0OwogCWludCBpOwogCi0JdHhsZW4gPSBtc2ctPnR4
X2xlbjsKLQlpZiAodHhsZW4gPiAxMikgeworCWlmICh0eGxlbiA+IDE2KSB7CiAJCWRldl9lcnIo
ZC0+ZGV2LAotCQkJImR1bm5vIGhvdyB0byB3cml0ZSBtb3JlIHRoYW4gMTIgYnl0ZXMgeWV0XG4i
KTsKKwkJCSJkdW5ubyBob3cgdG8gd3JpdGUgbW9yZSB0aGFuIDE2IGJ5dGVzIHlldFxuIik7CisJ
CXJldHVybiAtRUlPOworCX0KKwlpZiAocnhsZW4gPiA0KSB7CisJCWRldl9lcnIoZC0+ZGV2LAor
CQkJImR1bm5vIGhvdyB0byByZWFkIG1vcmUgdGhhbiA0IGJ5dGVzIHlldFxuIik7CiAJCXJldHVy
biAtRUlPOwogCX0KIAogCWRldl9kYmcoZC0+ZGV2LAotCQkibWVzc2FnZSB0byBjaGFubmVsICVk
LCAlemQgYnl0ZXMiLAotCQltc2ctPmNoYW5uZWwsCi0JCXR4bGVuKTsKKwkJIm1lc3NhZ2UgdG8g
Y2hhbm5lbCAlZCwgd3JpdGUgJXpkIGJ5dGVzIHJlYWQgJXpkIGJ5dGVzXG4iLAorCQltc2ctPmNo
YW5uZWwsIHR4bGVuLCByeGxlbik7CiAKIAkvKiBDb21tYW5kICJuYXR1cmUiICovCiAJaWYgKE1D
REVfRFNJX0hPU1RfSVNfUkVBRChtc2ctPnR5cGUpKQpAQCAtMjEwLDkgKzIxNCw3IEBAIHN0YXRp
YyBzc2l6ZV90IG1jZGVfZHNpX2hvc3RfdHJhbnNmZXIoc3RydWN0IG1pcGlfZHNpX2hvc3QgKmhv
c3QsCiAJaWYgKG1pcGlfZHNpX3BhY2tldF9mb3JtYXRfaXNfbG9uZyhtc2ctPnR5cGUpKQogCQl2
YWwgfD0gRFNJX0RJUkVDVF9DTURfTUFJTl9TRVRUSU5HU19DTURfTE9OR05PVFNIT1JUOwogCXZh
bCB8PSAwIDw8IERTSV9ESVJFQ1RfQ01EX01BSU5fU0VUVElOR1NfQ01EX0lEX1NISUZUOwotCS8q
IEFkZCBvbmUgdG8gdGhlIGxlbmd0aCBmb3IgdGhlIE1JUEkgRENTIGNvbW1hbmQgKi8KLQl2YWwg
fD0gdHhsZW4KLQkJPDwgRFNJX0RJUkVDVF9DTURfTUFJTl9TRVRUSU5HU19DTURfU0laRV9TSElG
VDsKKwl2YWwgfD0gdHhsZW4gPDwgRFNJX0RJUkVDVF9DTURfTUFJTl9TRVRUSU5HU19DTURfU0la
RV9TSElGVDsKIAl2YWwgfD0gRFNJX0RJUkVDVF9DTURfTUFJTl9TRVRUSU5HU19DTURfTFBfRU47
CiAJdmFsIHw9IG1zZy0+dHlwZSA8PCBEU0lfRElSRUNUX0NNRF9NQUlOX1NFVFRJTkdTX0NNRF9I
RUFEX1NISUZUOwogCXdyaXRlbCh2YWwsIGQtPnJlZ3MgKyBEU0lfRElSRUNUX0NNRF9NQUlOX1NF
VFRJTkdTKTsKQEAgLTI0OSwxNyArMjUxLDM2IEBAIHN0YXRpYyBzc2l6ZV90IG1jZGVfZHNpX2hv
c3RfdHJhbnNmZXIoc3RydWN0IG1pcGlfZHNpX2hvc3QgKmhvc3QsCiAJd3JpdGVsKDEsIGQtPnJl
Z3MgKyBEU0lfRElSRUNUX0NNRF9TRU5EKTsKIAogCWxvb3BfY291bnRlciA9IDEwMDAgKiAxMDAw
IC8gbG9vcF9kZWxheV91czsKLQl3aGlsZSAoIShyZWFkbChkLT5yZWdzICsgRFNJX0RJUkVDVF9D
TURfU1RTKSAmCi0JCSBEU0lfRElSRUNUX0NNRF9TVFNfV1JJVEVfQ09NUExFVEVEKQotCSAgICAg
ICAmJiAtLWxvb3BfY291bnRlcikKLQkJdXNsZWVwX3JhbmdlKGxvb3BfZGVsYXlfdXMsIChsb29w
X2RlbGF5X3VzICogMykgLyAyKTsKLQotCWlmICghbG9vcF9jb3VudGVyKSB7Ci0JCWRldl9lcnIo
ZC0+ZGV2LCAiRFNJIHdyaXRlIHRpbWVvdXQhXG4iKTsKLQkJcmV0dXJuIC1FVElNRTsKKwlpZiAo
TUNERV9EU0lfSE9TVF9JU19SRUFEKG1zZy0+dHlwZSkpIHsKKwkJLyogUmVhZCBjb21tYW5kICov
CisJCXdoaWxlICghKHJlYWRsKGQtPnJlZ3MgKyBEU0lfRElSRUNUX0NNRF9TVFMpICYKKwkJCSAo
RFNJX0RJUkVDVF9DTURfU1RTX1JFQURfQ09NUExFVEVEIHwKKwkJCSAgRFNJX0RJUkVDVF9DTURf
U1RTX1JFQURfQ09NUExFVEVEX1dJVEhfRVJSKSkKKwkJICAgICAgICYmIC0tbG9vcF9jb3VudGVy
KQorCQkJdXNsZWVwX3JhbmdlKGxvb3BfZGVsYXlfdXMsIChsb29wX2RlbGF5X3VzICogMykgLyAy
KTsKKwkJaWYgKCFsb29wX2NvdW50ZXIpIHsKKwkJCWRldl9lcnIoZC0+ZGV2LCAiRFNJIHdyaXRl
IHRpbWVvdXQhXG4iKTsKKwkJCXJldHVybiAtRVRJTUU7CisJCX0KKwl9IGVsc2UgeworCQkvKiBX
cml0aW5nIG9ubHkgKi8KKwkJd2hpbGUgKCEocmVhZGwoZC0+cmVncyArIERTSV9ESVJFQ1RfQ01E
X1NUUykgJgorCQkJIERTSV9ESVJFQ1RfQ01EX1NUU19XUklURV9DT01QTEVURUQpCisJCSAgICAg
ICAmJiAtLWxvb3BfY291bnRlcikKKwkJCXVzbGVlcF9yYW5nZShsb29wX2RlbGF5X3VzLCAobG9v
cF9kZWxheV91cyAqIDMpIC8gMik7CisKKwkJaWYgKCFsb29wX2NvdW50ZXIpIHsKKwkJCWRldl9l
cnIoZC0+ZGV2LCAiRFNJIHJlYWQgdGltZW91dCFcbiIpOworCQkJcmV0dXJuIC1FVElNRTsKKwkJ
fQogCX0KIAogCXZhbCA9IHJlYWRsKGQtPnJlZ3MgKyBEU0lfRElSRUNUX0NNRF9TVFMpOworCWlm
ICh2YWwgJiBEU0lfRElSRUNUX0NNRF9TVFNfUkVBRF9DT01QTEVURURfV0lUSF9FUlIpIHsKKwkJ
ZGV2X2VycihkLT5kZXYsICJyZWFkIGNvbXBsZXRlZCB3aXRoIGVycm9yXG4iKTsKKwkJd3JpdGVs
KDEsIGQtPnJlZ3MgKyBEU0lfRElSRUNUX0NNRF9SRF9JTklUKTsKKwkJcmV0dXJuIC1FSU87CisJ
fQogCWlmICh2YWwgJiBEU0lfRElSRUNUX0NNRF9TVFNfQUNLTk9XTEVER0VfV0lUSF9FUlJfUkVD
RUlWRUQpIHsKIAkJdmFsID4+PSBEU0lfRElSRUNUX0NNRF9TVFNfQUNLX1ZBTF9TSElGVDsKIAkJ
ZGV2X2VycihkLT5kZXYsICJlcnJvciBkdXJpbmcgdHJhbnNtaXNzaW9uOiAlMDR4XG4iLApAQCAt
MjY5LDEwICsyOTAsNyBAQCBzdGF0aWMgc3NpemVfdCBtY2RlX2RzaV9ob3N0X3RyYW5zZmVyKHN0
cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCiAJaWYgKCFNQ0RFX0RTSV9IT1NUX0lTX1JFQUQo
bXNnLT50eXBlKSkgewogCQkvKiBSZXR1cm4gbnVtYmVyIG9mIGJ5dGVzIHdyaXR0ZW4gKi8KLQkJ
aWYgKG1pcGlfZHNpX3BhY2tldF9mb3JtYXRfaXNfbG9uZyhtc2ctPnR5cGUpKQotCQkJcmV0ID0g
NCArIHR4bGVuOwotCQllbHNlCi0JCQlyZXQgPSA0OworCQlyZXQgPSB0eGxlbjsKIAl9IGVsc2Ug
ewogCQkvKiBPSyB0aGlzIGlzIGEgcmVhZCBjb21tYW5kLCBnZXQgdGhlIHJlc3BvbnNlICovCiAJ
CXUzMiByZHN6OwpAQCAtMjgyLDcgKzMwMCwxMyBAQCBzdGF0aWMgc3NpemVfdCBtY2RlX2RzaV9o
b3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCQlyZHN6ID0gcmVhZGwo
ZC0+cmVncyArIERTSV9ESVJFQ1RfQ01EX1JEX1BST1BFUlRZKTsKIAkJcmRzeiAmPSBEU0lfRElS
RUNUX0NNRF9SRF9QUk9QRVJUWV9SRF9TSVpFX01BU0s7CiAJCXJkZGF0ID0gcmVhZGwoZC0+cmVn
cyArIERTSV9ESVJFQ1RfQ01EX1JEREFUKTsKLQkJZm9yIChpID0gMDsgaSA8IDQgJiYgaSA8IHJk
c3o7IGkrKykKKwkJaWYgKHJkc3ogPCByeGxlbikgeworCQkJZGV2X2VycihkLT5kZXYsICJyZWFk
IGVycm9yLCByZXF1ZXN0ZWQgJXpkIGdvdCAlemRcbiIsCisJCQkJbXNnLT5yeF9sZW4sIHJ4bGVu
KTsKKwkJCXJldHVybiAtRUlPOworCQl9CisJCS8qIEZJWE1FOiByZWFkIG1vcmUgdGhhbiA0IGJ5
dGVzICovCisJCWZvciAoaSA9IDA7IGkgPCA0ICYmIGkgPCByeGxlbjsgaSsrKQogCQkJcnhbaV0g
PSAocmRkYXQgPj4gKGkgKiA4KSkgJiAweGZmOwogCQlyZXQgPSByZHN6OwogCX0KLS0gCjIuMjEu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
