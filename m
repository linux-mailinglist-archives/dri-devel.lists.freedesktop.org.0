Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 59319D30A8
	for <lists+dri-devel@lfdr.de>; Thu, 10 Oct 2019 20:45:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E30EC6E3B7;
	Thu, 10 Oct 2019 18:45:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x541.google.com (mail-pg1-x541.google.com
 [IPv6:2607:f8b0:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 839A96E3B5
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Oct 2019 18:45:12 +0000 (UTC)
Received: by mail-pg1-x541.google.com with SMTP id 23so4232892pgk.3
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Oct 2019 11:45:12 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=84rQRvz4YQaobYEvo+nadGSaj2h3o4GlGdAWJKmwwCk=;
 b=QVRyHDlwyZRF85AYU6A1Dlmus0GcqANUHT15gzoIH1FPElnMzRulDevBZuWLqbjf6a
 Pvv/VOsVROk1gMSdrzf1tOI/K7H4T6XSR3DQrEftWHdXVyPyvAJuMWdE/qZT5UfYh6KM
 4YdHGVndUYo+kCdQbE61yelwqDv+LOj2nlP/sNg/chy9aJA6arFVWJIRUpr19U8uZKrh
 eoRMZHkuLu/Ji7crvL75O0jxYAAyfFrIuKXFadJNVk707jlN5AXCRbo6a+zY0KDvEYNN
 a8+c5A0xxRxvWKEp5MDYIWid7pok67Q4/s/Kz4+trzsbQIXX833beEBHGiSJh/GiB7Ia
 Y77Q==
X-Gm-Message-State: APjAAAXjHLicxgpdmJuu8uoKFCK18vcc5FHP9imZnWy1iwXA/9mjdbOV
 TEDmxmxcnsy4FD8T+IQkIAHQSg==
X-Google-Smtp-Source: APXvYqyi3okimGiVgEhtd+hTQADNPf+F64QTC8REZT+KczbP9z5rwdZdUqoRm/opAMqXgAJUS6hB1g==
X-Received: by 2002:a65:644c:: with SMTP id s12mr12574118pgv.319.1570733111776; 
 Thu, 10 Oct 2019 11:45:11 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 w65sm7541732pfb.106.2019.10.10.11.45.10
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 10 Oct 2019 11:45:10 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v11 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Thu, 10 Oct 2019 18:44:57 +0000
Message-Id: <20191010184458.51039-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191010184458.51039-1-john.stultz@linaro.org>
References: <20191010184458.51039-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=84rQRvz4YQaobYEvo+nadGSaj2h3o4GlGdAWJKmwwCk=;
 b=TKgZhNHxQfMmzrBNE2q5m5xJMvXBKx/gCb0lulxHtq+q5bl8gB8A5hR2B81/TD1/zs
 GNae2FhvTpym90JViRQY52Lh0b/+pKO5F1NrNgz70OQl0HFKuDyvgWdqPgKolFGG2PbC
 a+rztl/TgphYuCsYKwWMjp/ZV8S7KSbiMxQ5YrvqnB75ksna8RPdMthaER4fDG5O9X1z
 Nx/SZHxwKNOOweRe1ecm2Ps+JcKmlfXKtMIQq5ITKqbN4llhA8KRFm85LRkIhoPRFASf
 RcfkgsJkhOuvm6rDB5miryH1nT0I65/jp1w/xRjLOJ7QPRvHKp9xg3RdQAYnrLCE0E0D
 /BbQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKQ2M6IExhdXJhIEFiYm90
dCA8bGFiYm90dEByZWRoYXQuY29tPgpDYzogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdh
aWduYXJkQGxpbmFyby5vcmc+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8u
b3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IFByYXRpayBQYXRl
bCA8cHJhdGlrcEBjb2RlYXVyb3JhLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IFZpbmNlbnQgRG9ubmVmb3J0IDxWaW5jZW50LkRvbm5lZm9ydEBhcm0u
Y29tPgpDYzogU3VkaXB0byBQYXVsIDxTdWRpcHRvLlBhdWxAYXJtLmNvbT4KQ2M6IEFuZHJldyBG
LiBEYXZpcyA8YWZkQHRpLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFk
Lm9yZz4KQ2M6IENoZW5ibyBGZW5nIDxmZW5nY0Bnb29nbGUuY29tPgpDYzogQWxpc3RhaXIgU3Ry
YWNoYW4gPGFzdHJhY2hhbkBnb29nbGUuY29tPgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlh
QGdvb2dsZS5jb20+CkNjOiBIaWxsZiBEYW50b24gPGhkYW50b25Ac2luYS5jb20+CkNjOiBkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClJldmlld2VkLWJ5OiBCZW5qYW1pbiBHYWlnbmFy
ZCA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4KUmV2aWV3ZWQtYnk6IEJyaWFuIFN0YXJr
ZXkgPGJyaWFuLnN0YXJrZXlAYXJtLmNvbT4KQWNrZWQtYnk6IExhdXJhIEFiYm90dCA8bGFiYm90
dEByZWRoYXQuY29tPgpUZXN0ZWQtYnk6IEF5YW4gS3VtYXIgSGFsZGVyIDxheWFuLmhhbGRlckBh
cm0uY29tPgpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9y
Zz4KLS0tCnYyOgoqIFN3aXRjaCBhbGxvY2F0ZSB0byByZXR1cm4gZG1hYnVmIGZkCiogU2ltcGxp
ZnkgaW5pdCBjb2RlCiogQ2hlY2twYXRjaCBmaXh1cHMKdjM6CiogU3dpdGNoIHRvIGlubGluZSBm
dW5jdGlvbiBmb3IgdG9fY21hX2hlYXAoKQoqIE1pbm9yIGNsZWFudXBzIHN1Z2dlc3RlZCBieSBC
cmlhbgoqIEZvbGQgaW4gbmV3IHJlZ2lzdHJhdGlvbiBzdHlsZSBmcm9tIEFuZHJldwoqIEZvbGRl
ZCBpbiBjaGFuZ2VzIGZyb20gQW5kcmV3IHRvIHVzZSBzaW1wbGlmaWVkIHBhZ2UgbGlzdAogIGZy
b20gdGhlIGhlYXAgaGVscGVycwp2NDoKKiBVc2UgdGhlIGZkX2ZsYWdzIHdoZW4gY3JlYXRpbmcg
ZG1hYnVmIGZkIChTdWdnZXN0ZWQgYnkKICBCZW5qYW1pbikKKiBVc2UgcHJlY2FsY3VsYXRlZCBw
YWdlY291bnQgKFN1Z2dlc3RlZCBieSBBbmRyZXcpCnY2OgoqIENoYW5nZWQgdmFyaWFibGUgbmFt
ZXMgdG8gaW1wcm92ZSBjbGFyaXR5LCBhcyBzdWdnZXN0ZWQKICBieSBCcmlhbgp2NzoKKiBVc2Ug
bmV3bHkgbG93ZXItY2FzZWQgaW5pdF9oZWFwX2hlbHBlcl9idWZmZXIgaGVscGVyCiogVXNlIG5l
dyBkbWFidWYgZXhwb3J0IGhlbHBlcgp2ODoKKiBNYWtlIHN0cnVjdCBkbWFfaGVhcF9vcHMgY29u
c3QgKFN1Z2dlc3RlZCBieSBDaHJpc3RvcGgpCiogQ29uZGVuc2UgZG1hX2hlYXBfYnVmZmVyIGFu
ZCBoZWFwX2hlbHBlcl9idWZmZXIgKHN1Z2dlc3RlZCBieQogIENocmlzdG9waCkKKiBDaGVja3Bh
dGNoIHdoaXRlc3BhY2UgZml4dXBzCnY5OgoqIFJlbW92aW5nIG5lZWRsZXNzIGNoZWNrIG5vdGVk
IGJ5IEJyaWFuIFN0YXJrZXkKKiBSZW5hbWUgZG1hX2hlYXBfZ2V0X2RhdGEtPmRtYV9oZWFwX2dl
dF9kcnZkYXRhIHN1Z2dlc3RlZAogIGJ5IEhpbGYgRGFudG9uCiogQ2hlY2sgc2lnbmFscyBhZnRl
ciBjbGVhcmluZyBtZW1vcnkgcGFnZXMgdG8gYXZvaWQgZG9pbmcKICBuZWVkbGVzcyB3b3JrIGlm
IHRoZSB0YXNrIGlzIGtpbGxlZCBhcyBzdWdnZXN0ZWQgYnkgSGlsZgotLS0KIGRyaXZlcnMvZG1h
LWJ1Zi9oZWFwcy9LY29uZmlnICAgIHwgICA4ICsrCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFr
ZWZpbGUgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYyB8IDE2OSAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDE3OCBpbnNl
cnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9o
ZWFwLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyBiL2RyaXZl
cnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmluZGV4IDIwNTA1Mjc0NDE2OS4uYTVlZWYwNmM0MjI2
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZworKysgYi9kcml2ZXJz
L2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtNCwzICs0LDExIEBAIGNvbmZpZyBETUFCVUZfSEVB
UFNfU1lTVEVNCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSB0aGUgc3lz
dGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhlYXAKIAkgIGlzIGJhY2tlZCBieSBwYWdlcyBm
cm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGluIGRvdWJ0LCBzYXkgWS4KKworY29uZmlnIERN
QUJVRl9IRUFQU19DTUEKKwlib29sICJETUEtQlVGIENNQSBIZWFwIgorCWRlcGVuZHMgb24gRE1B
QlVGX0hFQVBTICYmIERNQV9DTUEKKwloZWxwCisJICBDaG9vc2UgdGhpcyBvcHRpb24gdG8gZW5h
YmxlIGRtYS1idWYgQ01BIGhlYXAuIFRoaXMgaGVhcCBpcyBiYWNrZWQKKwkgIGJ5IHRoZSBDb250
aWd1b3VzIE1lbW9yeSBBbGxvY2F0b3IgKENNQSkuIElmIHlvdXIgc3lzdGVtIGhhcyB0aGVzZQor
CSAgcmVnaW9ucywgeW91IHNob3VsZCBzYXkgWSBoZXJlLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9k
bWEtYnVmL2hlYXBzL01ha2VmaWxlIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCmlu
ZGV4IGQxODA4ZWNhMjU4MS4uNmU1NGNkZWMzZGEwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1i
dWYvaGVhcHMvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCkBA
IC0xLDMgKzEsNCBAQAogIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAogb2JqLXkJ
CQkJCSs9IGhlYXAtaGVscGVycy5vCiBvYmotJChDT05GSUdfRE1BQlVGX0hFQVBTX1NZU1RFTSkJ
Kz0gc3lzdGVtX2hlYXAubworb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQU19DTUEpCQkrPSBjbWFf
aGVhcC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYyBiL2Ry
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uM2ZkYjAwZTkzN2M4Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9k
bWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMKQEAgLTAsMCArMSwxNjkgQEAKKy8vIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogRE1BQlVGIENNQSBoZWFwIGV4cG9ydGVyCisg
KgorICogQ29weXJpZ2h0IChDKSAyMDEyLCAyMDE5IExpbmFybyBMdGQuCisgKiBBdXRob3I6IDxi
ZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPiBmb3IgU1QtRXJpY3Nzb24uCisgKi8KKworI2lu
Y2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNs
dWRlIDxsaW51eC9kbWEtaGVhcC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRl
IDxsaW51eC9lcnJuby5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4
L2NtYS5oPgorI2luY2x1ZGUgPGxpbnV4L3NjYXR0ZXJsaXN0Lmg+CisjaW5jbHVkZSA8bGludXgv
aGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L3NjaGVkL3NpZ25hbC5oPgorCisjaW5jbHVkZSAi
aGVhcC1oZWxwZXJzLmgiCisKK3N0cnVjdCBjbWFfaGVhcCB7CisJc3RydWN0IGRtYV9oZWFwICpo
ZWFwOworCXN0cnVjdCBjbWEgKmNtYTsKK307CisKK3N0YXRpYyB2b2lkIGNtYV9oZWFwX2ZyZWUo
c3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXN0cnVjdCBjbWFfaGVhcCAq
Y21hX2hlYXAgPSBkbWFfaGVhcF9nZXRfZHJ2ZGF0YShidWZmZXItPmhlYXApOworCXVuc2lnbmVk
IGxvbmcgbnJfcGFnZXMgPSBidWZmZXItPnBhZ2Vjb3VudDsKKwlzdHJ1Y3QgcGFnZSAqY21hX3Bh
Z2VzID0gYnVmZmVyLT5wcml2X3ZpcnQ7CisKKwkvKiBmcmVlIHBhZ2UgbGlzdCAqLworCWtmcmVl
KGJ1ZmZlci0+cGFnZXMpOworCS8qIHJlbGVhc2UgbWVtb3J5ICovCisJY21hX3JlbGVhc2UoY21h
X2hlYXAtPmNtYSwgY21hX3BhZ2VzLCBucl9wYWdlcyk7CisJa2ZyZWUoYnVmZmVyKTsKK30KKwor
LyogZG1hYnVmIGhlYXAgQ01BIG9wZXJhdGlvbnMgZnVuY3Rpb25zICovCitzdGF0aWMgaW50IGNt
YV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKKwkJCSAgICAgdW5zaWduZWQg
bG9uZyBsZW4sCisJCQkgICAgIHVuc2lnbmVkIGxvbmcgZmRfZmxhZ3MsCisJCQkgICAgIHVuc2ln
bmVkIGxvbmcgaGVhcF9mbGFncykKK3sKKwlzdHJ1Y3QgY21hX2hlYXAgKmNtYV9oZWFwID0gZG1h
X2hlYXBfZ2V0X2RydmRhdGEoaGVhcCk7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqaGVs
cGVyX2J1ZmZlcjsKKwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzOworCXNpemVfdCBzaXplID0gUEFH
RV9BTElHTihsZW4pOworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBzaXplID4+IFBBR0VfU0hJ
RlQ7CisJdW5zaWduZWQgbG9uZyBhbGlnbiA9IGdldF9vcmRlcihzaXplKTsKKwlzdHJ1Y3QgZG1h
X2J1ZiAqZG1hYnVmOworCWludCByZXQgPSAtRU5PTUVNOworCXBnb2ZmX3QgcGc7CisKKwlpZiAo
YWxpZ24gPiBDT05GSUdfQ01BX0FMSUdOTUVOVCkKKwkJYWxpZ24gPSBDT05GSUdfQ01BX0FMSUdO
TUVOVDsKKworCWhlbHBlcl9idWZmZXIgPSBremFsbG9jKHNpemVvZigqaGVscGVyX2J1ZmZlciks
IEdGUF9LRVJORUwpOworCWlmICghaGVscGVyX2J1ZmZlcikKKwkJcmV0dXJuIC1FTk9NRU07CisK
Kwlpbml0X2hlYXBfaGVscGVyX2J1ZmZlcihoZWxwZXJfYnVmZmVyLCBjbWFfaGVhcF9mcmVlKTsK
KwloZWxwZXJfYnVmZmVyLT5mbGFncyA9IGhlYXBfZmxhZ3M7CisJaGVscGVyX2J1ZmZlci0+aGVh
cCA9IGhlYXA7CisJaGVscGVyX2J1ZmZlci0+c2l6ZSA9IGxlbjsKKworCWNtYV9wYWdlcyA9IGNt
YV9hbGxvYyhjbWFfaGVhcC0+Y21hLCBucl9wYWdlcywgYWxpZ24sIGZhbHNlKTsKKwlpZiAoIWNt
YV9wYWdlcykKKwkJZ290byBmcmVlX2J1ZjsKKworCWlmIChQYWdlSGlnaE1lbShjbWFfcGFnZXMp
KSB7CisJCXVuc2lnbmVkIGxvbmcgbnJfY2xlYXJfcGFnZXMgPSBucl9wYWdlczsKKwkJc3RydWN0
IHBhZ2UgKnBhZ2UgPSBjbWFfcGFnZXM7CisKKwkJd2hpbGUgKG5yX2NsZWFyX3BhZ2VzID4gMCkg
eworCQkJdm9pZCAqdmFkZHIgPSBrbWFwX2F0b21pYyhwYWdlKTsKKworCQkJbWVtc2V0KHZhZGRy
LCAwLCBQQUdFX1NJWkUpOworCQkJa3VubWFwX2F0b21pYyh2YWRkcik7CisJCQkvKgorCQkJICog
QXZvaWQgd2FzdGluZyB0aW1lIHplcm9pbmcgbWVtb3J5IGlmIHRoZSBwcm9jZXNzCisJCQkgKiBo
YXMgYmVlbiBraWxsZWQgYnkgYnkgU0lHS0lMTAorCQkJICovCisJCQlpZiAoZmF0YWxfc2lnbmFs
X3BlbmRpbmcoY3VycmVudCkpCisJCQkJZ290byBmcmVlX2NtYTsKKworCQkJcGFnZSsrOworCQkJ
bnJfY2xlYXJfcGFnZXMtLTsKKwkJfQorCX0gZWxzZSB7CisJCW1lbXNldChwYWdlX2FkZHJlc3Mo
Y21hX3BhZ2VzKSwgMCwgc2l6ZSk7CisJfQorCisJaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50ID0g
bnJfcGFnZXM7CisJaGVscGVyX2J1ZmZlci0+cGFnZXMgPSBrbWFsbG9jX2FycmF5KGhlbHBlcl9i
dWZmZXItPnBhZ2Vjb3VudCwKKwkJCQkJICAgICBzaXplb2YoKmhlbHBlcl9idWZmZXItPnBhZ2Vz
KSwKKwkJCQkJICAgICBHRlBfS0VSTkVMKTsKKwlpZiAoIWhlbHBlcl9idWZmZXItPnBhZ2VzKSB7
CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZnJlZV9jbWE7CisJfQorCisJZm9yIChwZyA9IDA7
IHBnIDwgaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50OyBwZysrKQorCQloZWxwZXJfYnVmZmVyLT5w
YWdlc1twZ10gPSAmY21hX3BhZ2VzW3BnXTsKKworCS8qIGNyZWF0ZSB0aGUgZG1hYnVmICovCisJ
ZG1hYnVmID0gaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1ZihoZWxwZXJfYnVmZmVyLCBmZF9mbGFn
cyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJldCA9IFBUUl9FUlIoZG1hYnVmKTsKKwkJ
Z290byBmcmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9idWZmZXItPmRtYWJ1ZiA9IGRtYWJ1ZjsK
KwloZWxwZXJfYnVmZmVyLT5wcml2X3ZpcnQgPSBjbWFfcGFnZXM7CisKKwlyZXQgPSBkbWFfYnVm
X2ZkKGRtYWJ1ZiwgZmRfZmxhZ3MpOworCWlmIChyZXQgPCAwKSB7CisJCWRtYV9idWZfcHV0KGRt
YWJ1Zik7CisJCS8qIGp1c3QgcmV0dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJlbGVhc2UgYW5kIHRo
YXQgd2lsbCBmcmVlICovCisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIHJldDsKKworZnJl
ZV9wYWdlczoKKwlrZnJlZShoZWxwZXJfYnVmZmVyLT5wYWdlcyk7CitmcmVlX2NtYToKKwljbWFf
cmVsZWFzZShjbWFfaGVhcC0+Y21hLCBjbWFfcGFnZXMsIG5yX3BhZ2VzKTsKK2ZyZWVfYnVmOgor
CWtmcmVlKGhlbHBlcl9idWZmZXIpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgZG1hX2hlYXBfb3BzIGNtYV9oZWFwX29wcyA9IHsKKwkuYWxsb2NhdGUgPSBjbWFfaGVh
cF9hbGxvY2F0ZSwKK307CisKK3N0YXRpYyBpbnQgX19hZGRfY21hX2hlYXAoc3RydWN0IGNtYSAq
Y21hLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hlYXA7CisJc3RydWN0
IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCisJY21hX2hlYXAgPSBremFsbG9jKHNp
emVvZigqY21hX2hlYXApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNtYV9oZWFwKQorCQlyZXR1cm4g
LUVOT01FTTsKKwljbWFfaGVhcC0+Y21hID0gY21hOworCisJZXhwX2luZm8ubmFtZSA9IGNtYV9n
ZXRfbmFtZShjbWEpOworCWV4cF9pbmZvLm9wcyA9ICZjbWFfaGVhcF9vcHM7CisJZXhwX2luZm8u
cHJpdiA9IGNtYV9oZWFwOworCisJY21hX2hlYXAtPmhlYXAgPSBkbWFfaGVhcF9hZGQoJmV4cF9p
bmZvKTsKKwlpZiAoSVNfRVJSKGNtYV9oZWFwLT5oZWFwKSkgeworCQlpbnQgcmV0ID0gUFRSX0VS
UihjbWFfaGVhcC0+aGVhcCk7CisKKwkJa2ZyZWUoY21hX2hlYXApOworCQlyZXR1cm4gcmV0Owor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFkZF9jbWFfaGVhcHModm9pZCkKK3sK
KwljbWFfZm9yX2VhY2hfYXJlYShfX2FkZF9jbWFfaGVhcCwgTlVMTCk7CisJcmV0dXJuIDA7Cit9
CitkZXZpY2VfaW5pdGNhbGwoYWRkX2NtYV9oZWFwcyk7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
