Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 118C2FF917
	for <lists+dri-devel@lfdr.de>; Sun, 17 Nov 2019 12:45:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7778C6E338;
	Sun, 17 Nov 2019 11:44:42 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A3E2E6E1F2
 for <dri-devel@lists.freedesktop.org>; Sun, 17 Nov 2019 02:41:50 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1]) (Authenticated sender: sre)
 with ESMTPSA id 06C7E28F76B
Received: by earth.universe (Postfix, from userid 1000)
 id CF23E3C0C86; Sun, 17 Nov 2019 03:41:39 +0100 (CET)
From: Sebastian Reichel <sebastian.reichel@collabora.com>
To: Sebastian Reichel <sre@kernel.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>
Subject: [RFCv1 14/42] drm/omap: dsi: request VC via mipi_dsi_attach
Date: Sun, 17 Nov 2019 03:40:00 +0100
Message-Id: <20191117024028.2233-15-sebastian.reichel@collabora.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191117024028.2233-1-sebastian.reichel@collabora.com>
References: <20191117024028.2233-1-sebastian.reichel@collabora.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 17 Nov 2019 11:44:18 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com, Tony Lindgren <tony@atomide.com>,
 "H. Nikolaus Schaller" <hns@goldelico.com>, Merlijn Wajer <merlijn@wizzup.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 dri-devel@lists.freedesktop.org, linux-omap@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHJvcCBjdXN0b20gcmVxdWVzdF92Yy9yZWxlYXNlX3ZjIGNhbGxiYWNrcyBieSB1c2luZyB0aGUK
Z2VuZXJpYyBtaXBpX2RzaV9hdHRhY2gvbWlwaV9kc2lfZGV0YWNoIGZ1bmN0aW9ucy4KClNpZ25l
ZC1vZmYtYnk6IFNlYmFzdGlhbiBSZWljaGVsIDxzZWJhc3RpYW4ucmVpY2hlbEBjb2xsYWJvcmEu
Y29tPgotLS0KIC4uLi9ncHUvZHJtL29tYXBkcm0vZGlzcGxheXMvcGFuZWwtZHNpLWNtLmMgICB8
IDI0ICsrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3MvZHNpLmMgICAgICAgICAg
ICAgfCA2MSArKysrKysrKy0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mv
b21hcGRzcy5oICAgICAgICAgfCAgMyAtCiAzIGZpbGVzIGNoYW5nZWQsIDQxIGluc2VydGlvbnMo
KyksIDQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJt
L2Rpc3BsYXlzL3BhbmVsLWRzaS1jbS5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZGlzcGxh
eXMvcGFuZWwtZHNpLWNtLmMKaW5kZXggZTZjMGE2ZTVhYTFkLi5kZGM2ZGQ2NzFjZDAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rpc3BsYXlzL3BhbmVsLWRzaS1jbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rpc3BsYXlzL3BhbmVsLWRzaS1jbS5jCkBAIC02
OTMsMTQgKzY5Myw2IEBAIHN0YXRpYyBpbnQgZHNpY21fY29ubmVjdChzdHJ1Y3Qgb21hcF9kc3Nf
ZGV2aWNlICpzcmMsCiAJCQkgc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHN0KQogewogCXN0cnVj
dCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzdCk7Ci0Jc3RydWN0IGRl
dmljZSAqZGV2ID0gJmRkYXRhLT5kc2ktPmRldjsKLQlpbnQgcjsKLQotCXIgPSBzcmMtPm9wcy0+
ZHNpLnJlcXVlc3RfdmMoc3JjLCBkZGF0YS0+Y2hhbm5lbCk7Ci0JaWYgKHIpIHsKLQkJZGV2X2Vy
cihkZXYsICJmYWlsZWQgdG8gZ2V0IHZpcnR1YWwgY2hhbm5lbFxuIik7Ci0JCXJldHVybiByOwot
CX0KIAogCWRkYXRhLT5zcmMgPSBzcmM7CiAJcmV0dXJuIDA7CkBAIC03MTEsNyArNzAzLDYgQEAg
c3RhdGljIHZvaWQgZHNpY21fZGlzY29ubmVjdChzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMs
CiB7CiAJc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSA9IHRvX3BhbmVsX2RhdGEoZHN0KTsK
IAotCXNyYy0+b3BzLT5kc2kucmVsZWFzZV92YyhzcmMsIGRkYXRhLT5jaGFubmVsKTsKIAlkZGF0
YS0+c3JjID0gTlVMTDsKIH0KIApAQCAtMTI3OCw4ICsxMjY5LDIxIEBAIHN0YXRpYyBpbnQgZHNp
Y21fcHJvYmUoc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNpKQogCQlnb3RvIGVycl9ibDsKIAl9
CiAKKwlkc2ktPmxhbmVzID0gMzsKKwlkc2ktPmZvcm1hdCA9IE1JUElfRFNJX0ZNVF9SR0I4ODg7
CisJZHNpLT5tb2RlX2ZsYWdzID0gTUlQSV9EU0lfQ0xPQ0tfTk9OX0NPTlRJTlVPVVMgfAorCQkJ
ICBNSVBJX0RTSV9NT0RFX0VPVF9QQUNLRVQ7CisJZHNpLT5oc19yYXRlID0gMzAwMDAwMDAwOwor
CWRzaS0+bHBfcmF0ZSA9IDEwMDAwMDAwOworCisJciA9IG1pcGlfZHNpX2F0dGFjaChkc2kpOwor
CWlmIChyIDwgMCkKKwkJZ290byBlcnJfZHNpX2F0dGFjaDsKKwogCXJldHVybiAwOwogCitlcnJf
ZHNpX2F0dGFjaDoKKwlzeXNmc19yZW1vdmVfZ3JvdXAoJmRzaS0+ZGV2LmtvYmosICZkc2ljbV9h
dHRyX2dyb3VwKTsKIGVycl9ibDoKIAlkZXN0cm95X3dvcmtxdWV1ZShkZGF0YS0+d29ya3F1ZXVl
KTsKIGVycl9yZWc6CkBAIC0xMjk2LDYgKzEzMDAsOCBAQCBzdGF0aWMgaW50IF9fZXhpdCBkc2lj
bV9yZW1vdmUoc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNpKQogCiAJZGV2X2RiZygmZHNpLT5k
ZXYsICJyZW1vdmVcbiIpOwogCisJbWlwaV9kc2lfZGV0YWNoKGRzaSk7CisKIAlvbWFwZHNzX2Rl
dmljZV91bnJlZ2lzdGVyKGRzc2Rldik7CiAKIAlpZiAob21hcGRzc19kZXZpY2VfaXNfZW5hYmxl
ZChkc3NkZXYpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5j
IGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5jCmluZGV4IGM0MTA3ZmU1YTUzZC4u
M2NkNzQ5Y2FlMTVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3MvZHNp
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5jCkBAIC0zNDksNyArMzQ5
LDcgQEAgc3RydWN0IGRzaV9kYXRhIHsKIAogCXN0cnVjdCB7CiAJCWVudW0gZHNpX3ZjX3NvdXJj
ZSBzb3VyY2U7Ci0JCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldjsKKwkJc3RydWN0IG1p
cGlfZHNpX2RldmljZSAqZGVzdDsKIAkJZW51bSBmaWZvX3NpemUgdHhfZmlmb19zaXplOwogCQll
bnVtIGZpZm9fc2l6ZSByeF9maWZvX3NpemU7CiAJfSB2Y1s0XTsKQEAgLTQ2OTAsMzIgKzQ2OTAs
NiBAQCBzdGF0aWMgZW51bSBvbWFwX2NoYW5uZWwgZHNpX2dldF9jaGFubmVsKHN0cnVjdCBkc2lf
ZGF0YSAqZHNpKQogCX0KIH0KIAotc3RhdGljIGludCBkc2lfcmVxdWVzdF92YyhzdHJ1Y3Qgb21h
cF9kc3NfZGV2aWNlICpkc3NkZXYsIGludCBjaGFubmVsKQotewotCXN0cnVjdCBkc2lfZGF0YSAq
ZHNpID0gdG9fZHNpX2RhdGEoZHNzZGV2KTsKLQotCWlmIChjaGFubmVsIDwgMCB8fCBjaGFubmVs
ID4gMykKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlpZiAoZHNpLT52Y1tjaGFubmVsXS5kc3NkZXYp
IHsKLQkJRFNTRVJSKCJjYW5ub3QgZ2V0IFZDIGZvciBkaXNwbGF5ICVzIiwgZHNzZGV2LT5uYW1l
KTsKLQkJcmV0dXJuIC1FQlVTWTsKLQl9Ci0KLQlkc2ktPnZjW2NoYW5uZWxdLmRzc2RldiA9IGRz
c2RldjsKLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgZHNpX3JlbGVhc2VfdmMoc3RydWN0
IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LCBpbnQgY2hhbm5lbCkKLXsKLQlzdHJ1Y3QgZHNpX2Rh
dGEgKmRzaSA9IHRvX2RzaV9kYXRhKGRzc2Rldik7Ci0KLQlpZiAoKGNoYW5uZWwgPj0gMCAmJiBj
aGFubmVsIDw9IDMpICYmCi0JCWRzaS0+dmNbY2hhbm5lbF0uZHNzZGV2ID09IGRzc2Rldikgewot
CQlkc2ktPnZjW2NoYW5uZWxdLmRzc2RldiA9IE5VTEw7Ci0JfQotfQotCiBzdGF0aWMgc3NpemVf
dCBvbWFwX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCQkJ
CSAgICAgIGNvbnN0IHN0cnVjdCBtaXBpX2RzaV9tc2cgKm1zZykKIHsKQEAgLTQ3OTIsMjMgKzQ3
NjYsNDAgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBvbWFwX2Rzc19kZXZpY2Vfb3BzIGRzaV9vcHMg
PSB7CiAJCS51cGRhdGUgPSBkc2lfdXBkYXRlLAogCiAJCS5lbmFibGVfdGUgPSBkc2lfZW5hYmxl
X3RlLAotCi0JCS5yZXF1ZXN0X3ZjID0gZHNpX3JlcXVlc3RfdmMsCi0JCS5yZWxlYXNlX3ZjID0g
ZHNpX3JlbGVhc2VfdmMsCiAJfSwKIH07CiAKIGludCBvbWFwX2RzaV9ob3N0X2F0dGFjaChzdHJ1
Y3QgbWlwaV9kc2lfaG9zdCAqaG9zdCwKLQkJCSBzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2kp
CisJCQkgc3RydWN0IG1pcGlfZHNpX2RldmljZSAqY2xpZW50KQogewotCS8qIFRPRE86IGNvbnZl
cnQgZHJpdmVyIGZyb20gY3VzdG9tIGJpbmRpbmcgbWV0aG9kIHRvIHRoaXMgb25lICovCisJc3Ry
dWN0IGRzaV9kYXRhICpkc2kgPSBob3N0X3RvX29tYXAoaG9zdCk7CisJdW5zaWduZWQgaW50IGNo
YW5uZWwgPSBjbGllbnQtPmNoYW5uZWw7CisKKwlpZiAoY2hhbm5lbCA+IDMpCisJCXJldHVybiAt
RUlOVkFMOworCisJaWYgKGRzaS0+dmNbY2hhbm5lbF0uZGVzdCkgeworCQlEU1NFUlIoImNhbm5v
dCBnZXQgVkMgZm9yIGRpc3BsYXkgJXMiLCBkZXZfbmFtZSgmY2xpZW50LT5kZXYpKTsKKwkJcmV0
dXJuIC1FQlVTWTsKKwl9CisKKwlkc2ktPnZjW2NoYW5uZWxdLmRlc3QgPSBjbGllbnQ7CiAJcmV0
dXJuIDA7CiB9CiAKIGludCBvbWFwX2RzaV9ob3N0X2RldGFjaChzdHJ1Y3QgbWlwaV9kc2lfaG9z
dCAqaG9zdCwKLQkJCSBzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2kpCisJCQkgc3RydWN0IG1p
cGlfZHNpX2RldmljZSAqY2xpZW50KQogewotCS8qIFRPRE86IGNvbnZlcnQgZHJpdmVyIGZyb20g
Y3VzdG9tIGJpbmRpbmcgbWV0aG9kIHRvIHRoaXMgb25lICovCisJc3RydWN0IGRzaV9kYXRhICpk
c2kgPSBob3N0X3RvX29tYXAoaG9zdCk7CisJdW5zaWduZWQgaW50IGNoYW5uZWwgPSBjbGllbnQt
PmNoYW5uZWw7CisKKwlpZiAoY2hhbm5lbCA+IDMpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYg
KGRzaS0+dmNbY2hhbm5lbF0uZGVzdCAhPSBjbGllbnQpCisJCXJldHVybiAtRUlOVkFMOworCisJ
ZHNpLT52Y1tjaGFubmVsXS5kZXN0ID0gTlVMTDsKIAlyZXR1cm4gMDsKIH0KIApAQCAtNTI2Nyw3
ICs1MjU4LDcgQEAgc3RhdGljIGludCBkc2lfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKIAkvKiBEU0kgVkNzIGluaXRpYWxpemF0aW9uICovCiAJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoZHNpLT52Yyk7IGkrKykgewogCQlkc2ktPnZjW2ldLnNvdXJjZSA9IERTSV9WQ19T
T1VSQ0VfTDQ7Ci0JCWRzaS0+dmNbaV0uZHNzZGV2ID0gTlVMTDsKKwkJZHNpLT52Y1tpXS5kZXN0
ID0gTlVMTDsKIAl9CiAKIAlyID0gZHNpX2dldF9jbG9ja3MoZHNpKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rzcy9vbWFwZHNzLmggYi9kcml2ZXJzL2dwdS9kcm0vb21h
cGRybS9kc3Mvb21hcGRzcy5oCmluZGV4IGJlMzdjOWViMjEyYy4uMjhmYWFjYjk2MzZiIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21hcGRzcy5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9vbWFwZHJtL2Rzcy9vbWFwZHNzLmgKQEAgLTMwNyw5ICszMDcsNiBAQCBzdHJ1
Y3Qgb21hcGRzc19kc2lfb3BzIHsKIAlpbnQgKCplbmFibGVfdmlkZW9fb3V0cHV0KShzdHJ1Y3Qg
b21hcF9kc3NfZGV2aWNlICpkc3NkZXYsIGludCBjaGFubmVsKTsKIAl2b2lkICgqZGlzYWJsZV92
aWRlb19vdXRwdXQpKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwKIAkJCWludCBjaGFu
bmVsKTsKLQotCWludCAoKnJlcXVlc3RfdmMpKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2Rl
diwgaW50IGNoYW5uZWwpOwotCXZvaWQgKCpyZWxlYXNlX3ZjKShzdHJ1Y3Qgb21hcF9kc3NfZGV2
aWNlICpkc3NkZXYsIGludCBjaGFubmVsKTsKIH07CiAKIHN0cnVjdCBvbWFwX2Rzc19kZXZpY2Vf
b3BzIHsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
