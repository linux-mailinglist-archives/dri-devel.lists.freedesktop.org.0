Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B102D215D72
	for <lists+dri-devel@lfdr.de>; Mon,  6 Jul 2020 19:48:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7E78989E35;
	Mon,  6 Jul 2020 17:48:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B09A689E2B;
 Mon,  6 Jul 2020 17:48:15 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id 17so42961721wmo.1;
 Mon, 06 Jul 2020 10:48:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=PjS/5UQddfW80cW4QXtUq6fmJtQuV/Y2zF5dRQZJVl4=;
 b=I3WVZn739HtRJZ9Odw/maQYEh0xiEAACWI0TsP9q75nSvWaHdTTKUvhtBAYA7ZXHwh
 /g6xQf+Pa29w4cXSfZPZJ7aYvvRA5C16o8PDktG4FYve0vTmlGo9sDp3ZxFK8FcCs1nJ
 BUmTFmaGwKuiXX30dOLokxVDC+kL78xi/KrMbf5TvNS/KiJu4oT1FB77bTkQccdrwd9m
 faPi5BFOTAuyKdyfWRriKsu9zCpSNjPrkUBXf+I+dwHjY4N3dcQ2S4mCuRpLiPhJ76JH
 l9mttpxq8KtwCbBkfW1bdh9JZc8CCxeF4aM+AAmgmoz8A2a6bNlfb1guAs1TYHXU4AHy
 iEpA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=PjS/5UQddfW80cW4QXtUq6fmJtQuV/Y2zF5dRQZJVl4=;
 b=OTo3QplIYrpaCEnaQIoZMAHvrxKF6/u37VSutiQaPmqLbEbldQXh2mhCV/66pVzVA/
 TGbtxIcN8/xahw19T/d4aqnGT+zu7+sSItVQLrcFOcMYT0qP0oS287N2S96j1o7whujl
 0VpgkenL8X1AJ7UnRgTo3lh6mB0KklFNxfZInqcqKbmXfyTMJ/kW5mrDItVAugYA8I8a
 9Q312KkcSJA/JF5DkVpq8Y2zOLReRhgHl+xteDovcXNjwd9aLCvgR2dqD/whm0e1JElw
 ozkRKYQZyAJxLpfa7zCOakK+FFwUjbprN9/wCXlxfQ68U77WxfyoURGw4lxYQn5CcDKc
 u88A==
X-Gm-Message-State: AOAM5326qcaSTzYex1c228qGMNdp21fuHoGqU85u6i82lt1P6xNjyijL
 DJVk/DdYZMreofw9yoasTydDdsZB
X-Google-Smtp-Source: ABdhPJzPcKBr3BPeQo4Nis8pz8RXM9oL0Mz/d4y+o4WO8uotRbt8Ddimis0mlMl/nN4HDgT7NgD1bw==
X-Received: by 2002:a1c:4143:: with SMTP id o64mr324349wma.11.1594057694087;
 Mon, 06 Jul 2020 10:48:14 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:dcf9:55b2:63a1:3c55])
 by smtp.gmail.com with ESMTPSA id 92sm26937858wrr.96.2020.07.06.10.48.13
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 06 Jul 2020 10:48:13 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 2/2] drm/amdgpu: stop allocating dummy GTT nodes
Date: Mon,  6 Jul 2020 19:48:11 +0200
Message-Id: <20200706174811.14755-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200706174811.14755-1-christian.koenig@amd.com>
References: <20200706174811.14755-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Tm93IHRoYXQgVFRNIGlzIGZpeGVkIHVwIHdlIGNhbiBmaW5hbGx5IHN0b3AgdGhhdCBub25zZW5z
ZS4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1k
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ3R0X21nci5jIHwg
MTA0ICsrKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdHRtLmMgICAgIHwgIDE4ICsrKy0KIDIgZmlsZXMgY2hhbmdlZCwgNDIgaW5zZXJ0aW9ucygr
KSwgODAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2d0dF9tZ3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9n
dHRfbWdyLmMKaW5kZXggMmMyMGQyM2Q2MmQxLi42MmNmNGZiZDgwM2EgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9ndHRfbWdyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2d0dF9tZ3IuYwpAQCAtMTUwLDYwICsxNTAsNyBAQCBz
dGF0aWMgaW50IGFtZGdwdV9ndHRfbWdyX2Zpbmkoc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2Vy
ICptYW4pCiAgKi8KIGJvb2wgYW1kZ3B1X2d0dF9tZ3JfaGFzX2dhcnRfYWRkcihzdHJ1Y3QgdHRt
X21lbV9yZWcgKm1lbSkKIHsKLQlzdHJ1Y3QgYW1kZ3B1X2d0dF9ub2RlICpub2RlID0gbWVtLT5t
bV9ub2RlOwotCi0JcmV0dXJuIChub2RlLT5ub2RlLnN0YXJ0ICE9IEFNREdQVV9CT19JTlZBTElE
X09GRlNFVCk7Ci19Ci0KLS8qKgotICogYW1kZ3B1X2d0dF9tZ3JfYWxsb2MgLSBhbGxvY2F0ZSBu
ZXcgcmFuZ2VzCi0gKgotICogQG1hbjogVFRNIG1lbW9yeSB0eXBlIG1hbmFnZXIKLSAqIEB0Ym86
IFRUTSBCTyB3ZSBuZWVkIHRoaXMgcmFuZ2UgZm9yCi0gKiBAcGxhY2U6IHBsYWNlbWVudCBmbGFn
cyBhbmQgcmVzdHJpY3Rpb25zCi0gKiBAbWVtOiB0aGUgcmVzdWx0aW5nIG1lbSBvYmplY3QKLSAq
Ci0gKiBBbGxvY2F0ZSB0aGUgYWRkcmVzcyBzcGFjZSBmb3IgYSBub2RlLgotICovCi1zdGF0aWMg
aW50IGFtZGdwdV9ndHRfbWdyX2FsbG9jKHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFu
LAotCQkJCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqdGJvLAotCQkJCWNvbnN0IHN0cnVjdCB0
dG1fcGxhY2UgKnBsYWNlLAotCQkJCXN0cnVjdCB0dG1fbWVtX3JlZyAqbWVtKQotewotCXN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KG1hbi0+YmRldik7Ci0Jc3Ry
dWN0IGFtZGdwdV9ndHRfbWdyICptZ3IgPSBtYW4tPnByaXY7Ci0Jc3RydWN0IGFtZGdwdV9ndHRf
bm9kZSAqbm9kZSA9IG1lbS0+bW1fbm9kZTsKLQllbnVtIGRybV9tbV9pbnNlcnRfbW9kZSBtb2Rl
OwotCXVuc2lnbmVkIGxvbmcgZnBmbiwgbHBmbjsKLQlpbnQgcjsKLQotCWlmIChhbWRncHVfZ3R0
X21ncl9oYXNfZ2FydF9hZGRyKG1lbSkpCi0JCXJldHVybiAwOwotCi0JaWYgKHBsYWNlKQotCQlm
cGZuID0gcGxhY2UtPmZwZm47Ci0JZWxzZQotCQlmcGZuID0gMDsKLQotCWlmIChwbGFjZSAmJiBw
bGFjZS0+bHBmbikKLQkJbHBmbiA9IHBsYWNlLT5scGZuOwotCWVsc2UKLQkJbHBmbiA9IGFkZXYt
PmdhcnQubnVtX2NwdV9wYWdlczsKLQotCW1vZGUgPSBEUk1fTU1fSU5TRVJUX0JFU1Q7Ci0JaWYg
KHBsYWNlICYmIHBsYWNlLT5mbGFncyAmIFRUTV9QTF9GTEFHX1RPUERPV04pCi0JCW1vZGUgPSBE
Uk1fTU1fSU5TRVJUX0hJR0g7Ci0KLQlzcGluX2xvY2soJm1nci0+bG9jayk7Ci0JciA9IGRybV9t
bV9pbnNlcnRfbm9kZV9pbl9yYW5nZSgmbWdyLT5tbSwgJm5vZGUtPm5vZGUsIG1lbS0+bnVtX3Bh
Z2VzLAotCQkJCQltZW0tPnBhZ2VfYWxpZ25tZW50LCAwLCBmcGZuLCBscGZuLAotCQkJCQltb2Rl
KTsKLQlzcGluX3VubG9jaygmbWdyLT5sb2NrKTsKLQotCWlmICghcikKLQkJbWVtLT5zdGFydCA9
IG5vZGUtPm5vZGUuc3RhcnQ7Ci0KLQlyZXR1cm4gcjsKKwlyZXR1cm4gbWVtLT5tbV9ub2RlICE9
IE5VTEw7CiB9CiAKIC8qKgpAQCAtMjM0LDI5ICsxODEsMzcgQEAgc3RhdGljIGludCBhbWRncHVf
Z3R0X21ncl9uZXcoc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4sCiAJYXRvbWljNjRf
c3ViKG1lbS0+bnVtX3BhZ2VzLCAmbWdyLT5hdmFpbGFibGUpOwogCXNwaW5fdW5sb2NrKCZtZ3It
PmxvY2spOwogCisJaWYgKCFwbGFjZS0+bHBmbikgeworCQltZW0tPm1tX25vZGUgPSBOVUxMOwor
CQltZW0tPnN0YXJ0ID0gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUOworCQlyZXR1cm4gMDsKKwl9
CisKIAlub2RlID0ga3phbGxvYyhzaXplb2YoKm5vZGUpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIW5v
ZGUpIHsKIAkJciA9IC1FTk9NRU07CiAJCWdvdG8gZXJyX291dDsKIAl9CiAKLQlub2RlLT5ub2Rl
LnN0YXJ0ID0gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUOwotCW5vZGUtPm5vZGUuc2l6ZSA9IG1l
bS0+bnVtX3BhZ2VzOwogCW5vZGUtPnRibyA9IHRibzsKLQltZW0tPm1tX25vZGUgPSBub2RlOwog
Ci0JaWYgKHBsYWNlLT5mcGZuIHx8IHBsYWNlLT5scGZuIHx8IHBsYWNlLT5mbGFncyAmIFRUTV9Q
TF9GTEFHX1RPUERPV04pIHsKLQkJciA9IGFtZGdwdV9ndHRfbWdyX2FsbG9jKG1hbiwgdGJvLCBw
bGFjZSwgbWVtKTsKLQkJaWYgKHVubGlrZWx5KHIpKSB7Ci0JCQlrZnJlZShub2RlKTsKLQkJCW1l
bS0+bW1fbm9kZSA9IE5VTEw7Ci0JCQlnb3RvIGVycl9vdXQ7Ci0JCX0KLQl9IGVsc2UgewotCQlt
ZW0tPnN0YXJ0ID0gbm9kZS0+bm9kZS5zdGFydDsKLQl9CisJc3Bpbl9sb2NrKCZtZ3ItPmxvY2sp
OworCXIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJm1nci0+bW0sICZub2RlLT5ub2Rl
LCBtZW0tPm51bV9wYWdlcywKKwkJCQkJbWVtLT5wYWdlX2FsaWdubWVudCwgMCwgcGxhY2UtPmZw
Zm4sCisJCQkJCXBsYWNlLT5scGZuLCBEUk1fTU1fSU5TRVJUX0JFU1QpOworCXNwaW5fdW5sb2Nr
KCZtZ3ItPmxvY2spOworCisJaWYgKHVubGlrZWx5KHIpKQorCQlnb3RvIGVycl9mcmVlOworCisJ
bWVtLT5tbV9ub2RlID0gbm9kZTsKKwltZW0tPnN0YXJ0ID0gbm9kZS0+bm9kZS5zdGFydDsKIAog
CXJldHVybiAwOworCitlcnJfZnJlZToKKwlrZnJlZShub2RlKTsKKwogZXJyX291dDoKIAlhdG9t
aWM2NF9hZGQobWVtLT5udW1fcGFnZXMsICZtZ3ItPmF2YWlsYWJsZSk7CiAKQEAgLTI3OSwxNyAr
MjM0LDE0IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9ndHRfbWdyX2RlbChzdHJ1Y3QgdHRtX21lbV90
eXBlX21hbmFnZXIgKm1hbiwKIAlzdHJ1Y3QgYW1kZ3B1X2d0dF9tZ3IgKm1nciA9IG1hbi0+cHJp
djsKIAlzdHJ1Y3QgYW1kZ3B1X2d0dF9ub2RlICpub2RlID0gbWVtLT5tbV9ub2RlOwogCi0JaWYg
KCFub2RlKQotCQlyZXR1cm47Ci0KLQlzcGluX2xvY2soJm1nci0+bG9jayk7Ci0JaWYgKG5vZGUt
Pm5vZGUuc3RhcnQgIT0gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUKQorCWlmIChub2RlKSB7CisJ
CXNwaW5fbG9jaygmbWdyLT5sb2NrKTsKIAkJZHJtX21tX3JlbW92ZV9ub2RlKCZub2RlLT5ub2Rl
KTsKLQlzcGluX3VubG9jaygmbWdyLT5sb2NrKTsKLQlhdG9taWM2NF9hZGQobWVtLT5udW1fcGFn
ZXMsICZtZ3ItPmF2YWlsYWJsZSk7CisJCXNwaW5fdW5sb2NrKCZtZ3ItPmxvY2spOworCQlrZnJl
ZShub2RlKTsKKwl9CiAKLQlrZnJlZShub2RlKTsKLQltZW0tPm1tX25vZGUgPSBOVUxMOworCWF0
b21pYzY0X2FkZChtZW0tPm51bV9wYWdlcywgJm1nci0+YXZhaWxhYmxlKTsKIH0KIAogLyoqCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggMzhkMmE3ZmI1Njk4Li41
MDUwM2Y4NjBmY2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAg
LTQyOSwxMiArNDI5LDIyIEBAIGludCBhbWRncHVfdHRtX2NvcHlfbWVtX3RvX21lbShzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwKIAl9CiAKIAlzcmNfb2Zmc2V0ID0gc3JjLT5vZmZzZXQ7Ci0J
c3JjX21tID0gYW1kZ3B1X2ZpbmRfbW1fbm9kZShzcmMtPm1lbSwgJnNyY19vZmZzZXQpOwotCXNy
Y19ub2RlX3NpemUgPSAoc3JjX21tLT5zaXplIDw8IFBBR0VfU0hJRlQpIC0gc3JjX29mZnNldDsK
KwlpZiAoc3JjLT5tZW0tPm1tX25vZGUpIHsKKwkJc3JjX21tID0gYW1kZ3B1X2ZpbmRfbW1fbm9k
ZShzcmMtPm1lbSwgJnNyY19vZmZzZXQpOworCQlzcmNfbm9kZV9zaXplID0gKHNyY19tbS0+c2l6
ZSA8PCBQQUdFX1NISUZUKSAtIHNyY19vZmZzZXQ7CisJfSBlbHNlIHsKKwkJc3JjX21tID0gTlVM
TDsKKwkJc3JjX25vZGVfc2l6ZSA9IFVMTE9OR19NQVg7CisJfQogCiAJZHN0X29mZnNldCA9IGRz
dC0+b2Zmc2V0OwotCWRzdF9tbSA9IGFtZGdwdV9maW5kX21tX25vZGUoZHN0LT5tZW0sICZkc3Rf
b2Zmc2V0KTsKLQlkc3Rfbm9kZV9zaXplID0gKGRzdF9tbS0+c2l6ZSA8PCBQQUdFX1NISUZUKSAt
IGRzdF9vZmZzZXQ7CisJaWYgKGRzdC0+bWVtLT5tbV9ub2RlKSB7CisJCWRzdF9tbSA9IGFtZGdw
dV9maW5kX21tX25vZGUoZHN0LT5tZW0sICZkc3Rfb2Zmc2V0KTsKKwkJZHN0X25vZGVfc2l6ZSA9
IChkc3RfbW0tPnNpemUgPDwgUEFHRV9TSElGVCkgLSBkc3Rfb2Zmc2V0OworCX0gZWxzZSB7CisJ
CWRzdF9tbSA9IE5VTEw7CisJCWRzdF9ub2RlX3NpemUgPSBVTExPTkdfTUFYOworCX0KIAogCW11
dGV4X2xvY2soJmFkZXYtPm1tYW4uZ3R0X3dpbmRvd19sb2NrKTsKIAotLSAKMi4xNy4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
