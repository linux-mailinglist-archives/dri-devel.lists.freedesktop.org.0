Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7976FBE068
	for <lists+dri-devel@lfdr.de>; Wed, 25 Sep 2019 16:40:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 46ADF6EBDB;
	Wed, 25 Sep 2019 14:40:40 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 351F46EBDB
 for <dri-devel@lists.freedesktop.org>; Wed, 25 Sep 2019 14:40:39 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id D66781000;
 Wed, 25 Sep 2019 07:40:38 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 811503F59C;
 Wed, 25 Sep 2019 07:40:38 -0700 (PDT)
Subject: Re: blocking ops in drm_sched_cleanup_jobs()
To: "Koenig, Christian" <Christian.Koenig@amd.com>,
 dri-devel <dri-devel@lists.freedesktop.org>
References: <6ed945cb-619a-b26d-21b0-9bdaeaa69582@arm.com>
 <6ad57904-d145-1771-84a1-926d6e95bade@amd.com>
 <1c56e435-f05b-e40b-372e-5b6af2f25291@arm.com>
 <1a7dfdda-03d9-b13a-d45b-e6501bf6975d@amd.com>
 <35f11ace-942e-c29f-87f3-3063f7b05b4b@arm.com>
 <91bd39c9-4566-1e56-00e6-8852e577f881@amd.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <04e55845-ce3d-baf4-59ef-5e9102cd4d9e@arm.com>
Date: Wed, 25 Sep 2019 15:40:37 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <91bd39c9-4566-1e56-00e6-8852e577f881@amd.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjUvMDkvMjAxOSAxNToxMiwgS29lbmlnLCBDaHJpc3RpYW4gd3JvdGU6Cj4gQW0gMjUuMDku
MTkgdW0gMTY6MDYgc2NocmllYiBTdGV2ZW4gUHJpY2U6Cj4+IE9uIDI0LzA5LzIwMTkgMTA6NTUs
IEtvZW5pZywgQ2hyaXN0aWFuIHdyb3RlOgo+Pj4gU29ycnkgZm9yIHRoZSBkZWxheWVkIHJlc3Bv
bnNlLCBoYXZlIGJlZW4gYnVzeSBvbiBvdGhlciBzdHVmZiBsYXN0IHdlZWsuCj4+Pgo+Pj4gQW0g
MTcuMDkuMTkgdW0gMTQ6NDYgc2NocmllYiBTdGV2ZW4gUHJpY2U6Cj4+Pj4gT24gMTcvMDkvMjAx
OSAwOTo0MiwgS29lbmlnLCBDaHJpc3RpYW4gd3JvdGU6Cj4+Pj4+IEhpIFN0ZXZlbiwKPj4+Pj4K
Pj4+Pj4gdGhvdWdodCBhYm91dCB0aGF0IGlzc3VlIGEgYml0IG1vcmUgYW5kIEkgdGhpbmsgSSBj
YW1lIHVwIHdpdGggYQo+Pj4+PiBzb2x1dGlvbi4KPj4+Pj4KPj4+Pj4gV2hhdCB5b3UgY291bGQg
ZG8gaXMgdG8gc3BsaXQgdXAgZHJtX3NjaGVkX2NsZWFudXBfam9icygpIGludG8gdHdvCj4+Pj4+
IGZ1bmN0aW9ucy4KPj4+Pj4KPj4+Pj4gT25lIHRoYXQgY2hlY2tzIGlmIGpvYnMgdG8gYmUgY2xl
YW5lZCB1cCBhcmUgcHJlc2VudCBhbmQgb25lIHdoaWNoIGRvZXMKPj4+Pj4gdGhlIGFjdHVhbCBj
bGVhbnVwLgo+Pj4+Pgo+Pj4+PiBUaGlzIHdheSB3ZSBjb3VsZCBjYWxsIGRybV9zY2hlZF9jbGVh
bnVwX2pvYnMoKSBvdXRzaWRlIG9mIHRoZQo+Pj4+PiB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUo
KS4KPj4+PiBZZXMgdGhhdCBzZWVtcyBsaWtlIGEgZ29vZCBzb2x1dGlvbiAtIHRoZXJlIGRvZXNu
J3Qgc2VlbSB0byBiZSBhIGdvb2QKPj4+PiByZWFzb24gd2h5IHRoZSBhY3R1YWwgam9iIGNsZWFu
dXAgbmVlZHMgdG8gYmUgZG9uZSB3aXRoaW4gdGhlCj4+Pj4gd2FpdF9ldmVudF9pbnRlcnJ1cHRp
YmxlKCkgY29uZGl0aW9uLiBJIGRpZCBicmllZmx5IGF0dGVtcHQgdGhhdAo+Pj4+IGJlZm9yZSwg
YnV0IEkgY291bGRuJ3Qgd29yayBvdXQgZXhhY3RseSB3aGF0IHRoZSBjb25kaXRpb24gaXMgd2hp
Y2gKPj4+PiBzaG91bGQgY2F1c2UgdGhlIHdha2UgKG15IGluaXRpYWwgYXR0ZW1wdCBjYXVzZWQg
Y29udGludW91cyB3YWtlLXVwcykuCj4+PiBCYXNpY2FsbHkgeW91IG5lZWQgc29tZXRoaW5nIGxp
a2UgdGhlIGZvbGxvd2luZzoKPj4+Cj4+PiAxLiBUZXN0IGlzIHRpbWVvdXQgd29ya2VyIGlzIHJ1
bm5pbmc6Cj4+Pgo+Pj4gaWYgKHNjaGVkLT50aW1lb3V0ICE9IE1BWF9TQ0hFRFVMRV9USU1FT1VU
ICYmCj4+PiAgIMKgwqDCoCAhY2FuY2VsX2RlbGF5ZWRfd29yaygmc2NoZWQtPndvcmtfdGRyKSkK
Pj4+ICAgwqDCoMKgIMKgwqDCoCByZXR1cm4gZmFsc2U7Cj4+Pgo+Pj4gMi4gVGVzdCBpZiB0aGVy
ZSBpcyBhbnkgam9iIHJlYWR5IHRvIGJlIGNsZWFuZWQgdXAuCj4+Pgo+Pj4gam9iID0gbGlzdF9m
aXJzdF9lbnRyeV9vcl9udWxsKCZzY2hlZC0+cmluZ19taXJyb3JfbGlzdCwgc3RydWN0Cj4+PiBk
cm1fc2NoZWRfam9iLCBub2RlKTsKPj4+IGlmICgham9iIHx8ICFkbWFfZmVuY2VfaXNfc2lnbmFs
ZWQoJmpvYi0+c19mZW5jZS0+ZmluaXNoZWQpKQo+Pj4gICDCoMKgwqAgcmV0dXJuIGZhbHNlOwo+
Pj4KPj4+IFRoYXQgc2hvdWxkIGJhc2ljYWxseSBkbyBpdC4KPj4gVGhhbmtzIGZvciB0aGUgcG9p
bnRlcnMuIEkgd2Fzbid0IHN1cmUgaWYgdGhlICJxdWV1ZSB0aW1lb3V0IGZvciBuZXh0Cj4+IGpv
YiIgcGFydCB3YXMgbmVjZXNzYXJ5IG9yIG5vdCBpZiBzdGVwIDIgYWJvdmUgcmV0dXJucyBmYWxz
ZS4KPj4KPj4gSSd2ZSBiZWVuIHRlc3RpbmcgdGhlIGZvbGxvd2luZyBwYXRjaCB3aGljaCBzaW1w
bHkgcHVsbHMgdGhlCj4+IHNjaGVkLT5vcHMtPmZyZWVfam9iKCkgb3V0IG9mIHRoZSB3YWl0X2V2
ZW50X2ludGVycnVwdGlibGUoKS4KPj4KPj4gSSdsbCB0cnkgd2l0aCBqdXN0IHRoZSB0ZXN0cyB5
b3UndmUgZGVzY3JpYmVkLgoKSXQgbG9va3MgbGlrZSBpdCBpcyBuZWNlc3NhcnkgdG8gcXVldWUg
dGhlIHRpbWVvdXQgZm9yIHRoZSBuZXh0IGpvYiBldmVuCmlmIHRoZXJlIGlzbid0IGEgam9iIHRv
IGJlIGNsZWFuZWQgdXAgKGkuZS4gZXZlbiBpZiB3ZSB3b3VsZG4ndCBleGl0CmZyb20gd2FpdF9l
dmVudF9pbnRlcnJ1cHRpYmxlKCkuIFNvIEknbGwgZ28gd2l0aCBhIHBhdGNoIGxpa2UgYmVsb3cu
Cgo+PiAtLS0tODwtLS0tLQo+PiAgRnJvbSA4NzNjMTgxNjM5NGJlZWU3MjkwNGU2NGFhMmVlMGYx
NjllNzY4ZDc2IE1vbiBTZXAgMTcgMDA6MDA6MDAgMjAwMQo+PiBGcm9tOiBTdGV2ZW4gUHJpY2Ug
PHN0ZXZlbi5wcmljZUBhcm0uY29tPgo+PiBEYXRlOiBNb24sIDIzIFNlcCAyMDE5IDExOjA4OjUw
ICswMTAwCj4+IFN1YmplY3Q6IFtQQVRDSF0gZHJtOiBEb24ndCBmcmVlIGpvYnMgaW4gd2FpdF9l
dmVudF9pbnRlcnJ1cHRpYmxlKCkKPj4KPj4gZHJtX3NjaGVkX2NsZWFudXBfam9icygpIGF0dGVt
cHRzIHRvIGZyZWUgZmluaXNoZWQgam9icywgaG93ZXZlciBiZWNhdXNlCj4+IGl0IGlzIGNhbGxl
ZCBhcyB0aGUgY29uZGl0aW9uIG9mIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZSgpIGl0IG11c3Qg
bm90Cj4+IHNsZWVwLiBVbmZvcnR1YW50bHkgc29tZSBmcmVlIGNhbGxiYWNrcyAobm90aWJseSBm
b3IgUGFuZnJvc3QpIGRvIHNsZWVwLgo+Pgo+PiBJbnN0ZWFkIGxldCdzIHJlbmFtZSBkcm1fc2No
ZWRfY2xlYW51cF9qb2JzKCkgdG8KPj4gZHJtX3NjaGVkX2dldF9jbGVhbnVwX2pvYigpIGFuZCBz
aW1wbHkgcmV0dXJuIGEgam9iIGZvciBwcm9jZXNzaW5nIGlmCj4+IHRoZXJlIGlzIG9uZS4gVGhl
IGNhbGxlciBjYW4gdGhlbiBjYWxsIHRoZSBmcmVlX2pvYigpIGNhbGxiYWNrIG91dHNpZGUKPj4g
dGhlIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZSgpIHdoZXJlIHNsZWVwaW5nIGlzIHBvc3NpYmxl
IGJlZm9yZQo+PiByZS1jaGVja2luZyBhbmQgcmV0dXJuaW5nIHRvIHNsZWVwIGlmIG5lY2Vzc2Fy
eS4KPj4KPj4gU2lnbmVkLW9mZi1ieTogU3RldmVuIFByaWNlIDxzdGV2ZW4ucHJpY2VAYXJtLmNv
bT4KPj4gLS0tCj4+ICAgZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9tYWluLmMgfCAy
MiArKysrKysrKysrKysrKystLS0tLS0tCj4+ICAgMSBmaWxlIGNoYW5nZWQsIDE1IGluc2VydGlv
bnMoKyksIDcgZGVsZXRpb25zKC0pCj4+Cj4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
c2NoZWR1bGVyL3NjaGVkX21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2NoZWRf
bWFpbi5jCj4+IGluZGV4IDlhMGVlNzRkODJkYy4uYmY5YjQ5MzFkZGZkIDEwMDY0NAo+PiAtLS0g
YS9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiArKysgYi9kcml2ZXJz
L2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiBAQCAtNjIyLDIwICs2MjIsMjEgQEAg
c3RhdGljIHZvaWQgZHJtX3NjaGVkX3Byb2Nlc3Nfam9iKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0
cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQo+PiAgIH0KPj4gICAKPj4gICAvKioKPj4gLSAqIGRybV9z
Y2hlZF9jbGVhbnVwX2pvYnMgLSBkZXN0cm95IGZpbmlzaGVkIGpvYnMKPj4gKyAqIGRybV9zY2hl
ZF9nZXRfY2xlYW51cF9qb2IgLSBmZXRjaCB0aGUgbmV4dCBmaW5pc2hlZCBqb2IgdG8gYmUgZGVz
dHJveWVkCj4+ICAgICoKPj4gICAgKiBAc2NoZWQ6IHNjaGVkdWxlciBpbnN0YW5jZQo+PiAgICAq
Cj4+IC0gKiBSZW1vdmUgYWxsIGZpbmlzaGVkIGpvYnMgZnJvbSB0aGUgbWlycm9yIGxpc3QgYW5k
IGRlc3Ryb3kgdGhlbS4KPj4gKyAqIFJldHVybnMgdGhlIG5leHQgZmluaXNoZWQgam9iIGZyb20g
dGhlIG1pcnJvciBsaXN0IChpZiB0aGVyZSBpcyBvbmUpCj4+ICsgKiByZWFkeSBmb3IgaXQgdG8g
YmUgZGVzdHJveWVkLgo+PiAgICAqLwo+PiAtc3RhdGljIHZvaWQgZHJtX3NjaGVkX2NsZWFudXBf
am9icyhzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+PiArc3RhdGljIHN0cnVjdCBk
cm1fc2NoZWRfam9iICpkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iKHN0cnVjdCBkcm1fZ3B1X3Nj
aGVkdWxlciAqc2NoZWQpCj4+ICAgewo+PiAgIAl1bnNpZ25lZCBsb25nIGZsYWdzOwo+PiAgIAo+
PiAgIAkvKiBEb24ndCBkZXN0cm95IGpvYnMgd2hpbGUgdGhlIHRpbWVvdXQgd29ya2VyIGlzIHJ1
bm5pbmcgKi8KPj4gICAJaWYgKHNjaGVkLT50aW1lb3V0ICE9IE1BWF9TQ0hFRFVMRV9USU1FT1VU
ICYmCj4+ICAgCSAgICAhY2FuY2VsX2RlbGF5ZWRfd29yaygmc2NoZWQtPndvcmtfdGRyKSkKPj4g
LQkJcmV0dXJuOwo+PiArCQlyZXR1cm4gTlVMTDsKPj4gICAKPj4gICAKPj4gICAJd2hpbGUgKCFs
aXN0X2VtcHR5KCZzY2hlZC0+cmluZ19taXJyb3JfbGlzdCkpIHsKPiAKPiBZZWFoLCB5b3Ugc2hv
dWxkIHByb2JhYmx5IGNsZWFuIHRoYXQgdXAgYSBiaXQgaGVyZSwgYnV0IGFwYXJ0IGZyb20gdGhh
dCAKPiB0aGlzIHNob3VsZCB3b3JrIGFzIHdlbGwuCgpHb29kIHBvaW50IC0gdGhpcyBmdW5jdGlv
biBjYW4gYmUgdGlkaWVkIHVwIHF1aXRlIGEgYml0LCBJJ2xsIHBvc3QgYSBuZXcKcGF0Y2ggc2hv
cnRseS4KClRoYW5rcywKClN0ZXZlCgo+IFJlZ2FyZHMsCj4gQ2hyaXN0aWFuLgo+IAo+PiBAQCAt
NjUxLDcgKzY1Miw3IEBAIHN0YXRpYyB2b2lkIGRybV9zY2hlZF9jbGVhbnVwX2pvYnMoc3RydWN0
IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCkKPj4gICAJCWxpc3RfZGVsX2luaXQoJmpvYi0+bm9k
ZSk7Cj4+ICAgCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+am9iX2xpc3RfbG9jaywg
ZmxhZ3MpOwo+PiAgIAo+PiAtCQlzY2hlZC0+b3BzLT5mcmVlX2pvYihqb2IpOwo+PiArCQlyZXR1
cm4gam9iOwo+PiAgIAl9Cj4+ICAgCj4+ICAgCS8qIHF1ZXVlIHRpbWVvdXQgZm9yIG5leHQgam9i
ICovCj4+IEBAIC02NTksNiArNjYwLDcgQEAgc3RhdGljIHZvaWQgZHJtX3NjaGVkX2NsZWFudXBf
am9icyhzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+PiAgIAlkcm1fc2NoZWRfc3Rh
cnRfdGltZW91dChzY2hlZCk7Cj4+ICAgCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNjaGVkLT5q
b2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+ICAgCj4+ICsJcmV0dXJuIE5VTEw7Cj4+ICAgfQo+PiAg
IAo+PiAgIC8qKgo+PiBAQCAtNjk4LDEyICs3MDAsMTggQEAgc3RhdGljIGludCBkcm1fc2NoZWRf
bWFpbih2b2lkICpwYXJhbSkKPj4gICAJCXN0cnVjdCBkcm1fc2NoZWRfZmVuY2UgKnNfZmVuY2U7
Cj4+ICAgCQlzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAqc2NoZWRfam9iOwo+PiAgIAkJc3RydWN0IGRt
YV9mZW5jZSAqZmVuY2U7Cj4+ICsJCXN0cnVjdCBkcm1fc2NoZWRfam9iICpjbGVhbnVwX2pvYiA9
IE5VTEw7Cj4+ICAgCj4+ICAgCQl3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoc2NoZWQtPndha2Vf
dXBfd29ya2VyLAo+PiAtCQkJCQkgKGRybV9zY2hlZF9jbGVhbnVwX2pvYnMoc2NoZWQpLAo+PiAr
CQkJCQkgKGNsZWFudXBfam9iID0gZHJtX3NjaGVkX2dldF9jbGVhbnVwX2pvYihzY2hlZCkpIHx8
Cj4+ICAgCQkJCQkgKCFkcm1fc2NoZWRfYmxvY2tlZChzY2hlZCkgJiYKPj4gICAJCQkJCSAgKGVu
dGl0eSA9IGRybV9zY2hlZF9zZWxlY3RfZW50aXR5KHNjaGVkKSkpIHx8Cj4+IC0JCQkJCSBrdGhy
ZWFkX3Nob3VsZF9zdG9wKCkpKTsKPj4gKwkJCQkJIGt0aHJlYWRfc2hvdWxkX3N0b3AoKSk7Cj4+
ICsKPj4gKwkJd2hpbGUgKGNsZWFudXBfam9iKSB7Cj4+ICsJCQlzY2hlZC0+b3BzLT5mcmVlX2pv
YihjbGVhbnVwX2pvYik7Cj4+ICsJCQljbGVhbnVwX2pvYiA9IGRybV9zY2hlZF9nZXRfY2xlYW51
cF9qb2Ioc2NoZWQpOwo+PiArCQl9Cj4+ICAgCj4+ICAgCQlpZiAoIWVudGl0eSkKPj4gICAJCQlj
b250aW51ZTsKPiAKPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwo+IGRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKPiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCj4gaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWwKPiAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
