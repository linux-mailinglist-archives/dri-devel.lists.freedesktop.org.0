Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6EC6A10E96C
	for <lists+dri-devel@lfdr.de>; Mon,  2 Dec 2019 12:16:15 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3207E6E184;
	Mon,  2 Dec 2019 11:16:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 839E06E180
 for <dri-devel@lists.freedesktop.org>; Mon,  2 Dec 2019 11:16:04 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 99DECB2C6;
 Mon,  2 Dec 2019 11:16:01 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: kraxel@redhat.com, airlied@redhat.com, daniel.vetter@ffwll.ch,
 yc_chen@aspeedtech.com, sam@ravnborg.org
Subject: [PATCH v3 6/7] drm/ast: Store VBIOS mode info in struct ast_crtc_state
Date: Mon,  2 Dec 2019 12:15:56 +0100
Message-Id: <20191202111557.15176-7-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191202111557.15176-1-tzimmermann@suse.de>
References: <20191202111557.15176-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWZ0ZXIgbG9va2luZyB1cCBWQklPUyBtb2RlIGluZm9ybWF0aW9uIGluIENSVEMncyBhdG9taWNf
Y2hlY2soKSwgd2UKY2FuIHJldXNlIGl0IGluIGF0b21pY19mbHVzaCgpLiBObyBuZWVkIGZvciBh
IHNlY29uZCBsb29rLXVwLgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1t
ZXJtYW5uQHN1c2UuZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2LmggIHwgIDIg
KysKIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyB8IDU4ICsrKysrKysrKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMzIgaW5zZXJ0aW9ucygrKSwgMjgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaAppbmRleCBlMTNhZmI4YTcwNmYuLjcyODgz
YjVhZWZhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2LmgKQEAgLTI4Myw2ICsyODMsOCBAQCBzdHJ1Y3Qg
YXN0X3ZiaW9zX21vZGVfaW5mbyB7CiAKIHN0cnVjdCBhc3RfY3J0Y19zdGF0ZSB7CiAJc3RydWN0
IGRybV9jcnRjX3N0YXRlIGJhc2U7CisKKwlzdHJ1Y3QgYXN0X3ZiaW9zX21vZGVfaW5mbyB2Ymlv
c19tb2RlX2luZm87CiB9OwogCiAjZGVmaW5lIHRvX2FzdF9jcnRjX3N0YXRlKHN0YXRlKSBjb250
YWluZXJfb2Yoc3RhdGUsIHN0cnVjdCBhc3RfY3J0Y19zdGF0ZSwgYmFzZSkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0
X21vZGUuYwppbmRleCA1YzIyNjE0MmQ0OTMuLmU5ODU5ZTlkOGY0OSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0
X21vZGUuYwpAQCAtNzg0LDI0ICs3ODQsMjUgQEAgc3RhdGljIGludCBhc3RfY3J0Y19oZWxwZXJf
YXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIHsKIAlzdHJ1Y3QgYXN0X3ByaXZh
dGUgKmFzdCA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGU7CisJc3RydWN0IGFzdF9jcnRjX3N0YXRlICphc3Rfc3RhdGU7CiAJYm9v
bCBzdWNjOwotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIGFkanVzdGVkX21vZGU7Ci0Jc3RydWN0
IGFzdF92Ymlvc19tb2RlX2luZm8gdmJpb3NfbW9kZTsKIAogCWlmIChhc3QtPmNoaXAgPT0gQVNU
MTE4MCkgewogCQlEUk1fRVJST1IoIkFTVCAxMTgwIG1vZGVzZXR0aW5nIG5vdCBzdXBwb3J0ZWRc
biIpOwogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKKwlhc3Rfc3RhdGUgPSB0b19hc3RfY3J0Y19z
dGF0ZShzdGF0ZSk7CiAJcGxhbmVfc3RhdGUgPSBjcnRjLT5wcmltYXJ5LT5zdGF0ZTsKIAotCWlm
IChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+ZmIpIHsKLQkJc3VjYyA9IGFzdF9nZXRfdmJp
b3NfbW9kZV9pbmZvKHBsYW5lX3N0YXRlLT5mYi0+Zm9ybWF0LAotCQkJCQkgICAgICAgJnN0YXRl
LT5tb2RlLCAmYWRqdXN0ZWRfbW9kZSwKLQkJCQkJICAgICAgICZ2Ymlvc19tb2RlKTsKLQkJaWYg
KCFzdWNjKQotCQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQorCWlmICghcGxhbmVfc3RhdGUgfHwgIXBs
YW5lX3N0YXRlLT5mYikKKwkJcmV0dXJuIDA7CisKKwlzdWNjID0gYXN0X2dldF92Ymlvc19tb2Rl
X2luZm8ocGxhbmVfc3RhdGUtPmZiLT5mb3JtYXQsICZzdGF0ZS0+bW9kZSwKKwkJCQkgICAgICAg
JnN0YXRlLT5hZGp1c3RlZF9tb2RlLAorCQkJCSAgICAgICAmYXN0X3N0YXRlLT52Ymlvc19tb2Rl
X2luZm8pOworCWlmICghc3VjYykKKwkJcmV0dXJuIC1FSU5WQUw7CiAKIAlyZXR1cm4gMDsKIH0K
QEAgLTgyMCw0MCArODIxLDM2IEBAIHN0YXRpYyB2b2lkIGFzdF9jcnRjX2hlbHBlcl9hdG9taWNf
Zmx1c2goc3RydWN0IGRybV9jcnRjICpjcnRjLAogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjLT5kZXY7CiAJc3RydWN0IGFzdF9wcml2YXRlICphc3QgPSBkZXYtPmRldl9wcml2YXRlOwog
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gY3J0Yy0+cHJpbWFyeS0+c3RhdGUt
PmZiOworCXN0cnVjdCBhc3RfY3J0Y19zdGF0ZSAqYXN0X3N0YXRlOwogCWNvbnN0IHN0cnVjdCBk
cm1fZm9ybWF0X2luZm8gKmZvcm1hdDsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSBhZGp1c3Rl
ZF9tb2RlOwotCXN0cnVjdCBhc3RfdmJpb3NfbW9kZV9pbmZvIHZiaW9zX21vZGU7Ci0JYm9vbCBz
dWNjOworCXN0cnVjdCBhc3RfdmJpb3NfbW9kZV9pbmZvICp2Ymlvc19tb2RlX2luZm87CisJc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGU7CiAKIAljcnRjLT5zdGF0ZS0+bm9f
dmJsYW5rID0gdHJ1ZTsKIAogCWlmICghZmIpCiAJCXJldHVybjsKIAotCWZvcm1hdCA9IGZiLT5m
b3JtYXQ7CisJYXN0X3N0YXRlID0gdG9fYXN0X2NydGNfc3RhdGUoY3J0Yy0+c3RhdGUpOwogCi0J
bWVtc2V0KCZhZGp1c3RlZF9tb2RlLCAwLCBzaXplb2YoYWRqdXN0ZWRfbW9kZSkpOwotCWRybV9t
b2RlX2NvcHkoJmFkanVzdGVkX21vZGUsICZjcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZSk7Ci0K
LQlzdWNjID0gYXN0X2dldF92Ymlvc19tb2RlX2luZm8oZm9ybWF0LAotCQkJCSAgICAgICAmY3J0
Yy0+c3RhdGUtPmFkanVzdGVkX21vZGUsCi0JCQkJICAgICAgICZhZGp1c3RlZF9tb2RlLCAmdmJp
b3NfbW9kZSk7Ci0JaWYgKFdBUk5fT05fT05DRSghc3VjYykpCi0JCXJldHVybjsgLyogQlVHOiBk
aWRuJ3QgdmFsaWRhdGUgdGhpcyBpbiBhdG9taWNfY2hlY2soKSAqLworCWZvcm1hdCA9IGZiLT5m
b3JtYXQ7CisJdmJpb3NfbW9kZV9pbmZvID0gJmFzdF9zdGF0ZS0+dmJpb3NfbW9kZV9pbmZvOwog
CiAJYXN0X3NldF9jb2xvcl9yZWcoYXN0LCBmb3JtYXQpOwotCWFzdF9zZXRfdmJpb3NfY29sb3Jf
cmVnKGFzdCwgZm9ybWF0LCAmdmJpb3NfbW9kZSk7CisJYXN0X3NldF92Ymlvc19jb2xvcl9yZWco
YXN0LCBmb3JtYXQsIHZiaW9zX21vZGVfaW5mbyk7CiAKIAlpZiAoIWNydGMtPnN0YXRlLT5tb2Rl
X2NoYW5nZWQpCiAJCXJldHVybjsKIAotCWFzdF9zZXRfdmJpb3NfbW9kZV9yZWcoYXN0LCAmYWRq
dXN0ZWRfbW9kZSwgJnZiaW9zX21vZGUpOworCWFkanVzdGVkX21vZGUgPSAmY3J0Yy0+c3RhdGUt
PmFkanVzdGVkX21vZGU7CisKKwlhc3Rfc2V0X3ZiaW9zX21vZGVfcmVnKGFzdCwgYWRqdXN0ZWRf
bW9kZSwgdmJpb3NfbW9kZV9pbmZvKTsKIAlhc3Rfc2V0X2luZGV4X3JlZyhhc3QsIEFTVF9JT19D
UlRDX1BPUlQsIDB4YTEsIDB4MDYpOwotCWFzdF9zZXRfc3RkX3JlZyhhc3QsICZhZGp1c3RlZF9t
b2RlLCAmdmJpb3NfbW9kZSk7Ci0JYXN0X3NldF9jcnRjX3JlZyhhc3QsICZhZGp1c3RlZF9tb2Rl
LCAmdmJpb3NfbW9kZSk7Ci0JYXN0X3NldF9kY2xrX3JlZyhhc3QsICZhZGp1c3RlZF9tb2RlLCAm
dmJpb3NfbW9kZSk7CisJYXN0X3NldF9zdGRfcmVnKGFzdCwgYWRqdXN0ZWRfbW9kZSwgdmJpb3Nf
bW9kZV9pbmZvKTsKKwlhc3Rfc2V0X2NydGNfcmVnKGFzdCwgYWRqdXN0ZWRfbW9kZSwgdmJpb3Nf
bW9kZV9pbmZvKTsKKwlhc3Rfc2V0X2RjbGtfcmVnKGFzdCwgYWRqdXN0ZWRfbW9kZSwgdmJpb3Nf
bW9kZV9pbmZvKTsKIAlhc3Rfc2V0X2NydHRoZF9yZWcoYXN0KTsKLQlhc3Rfc2V0X3N5bmNfcmVn
KGFzdCwgJmFkanVzdGVkX21vZGUsICZ2Ymlvc19tb2RlKTsKKwlhc3Rfc2V0X3N5bmNfcmVnKGFz
dCwgYWRqdXN0ZWRfbW9kZSwgdmJpb3NfbW9kZV9pbmZvKTsKIH0KIAogc3RhdGljIHZvaWQKQEAg
LTg4Nyw3ICs4ODQsNyBAQCBzdGF0aWMgdm9pZCBhc3RfY3J0Y19kZXN0cm95KHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YykKIHN0YXRpYyBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKgogYXN0X2NydGNfYXRv
bWljX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiB7Ci0gICAgICAgIHN0
cnVjdCBhc3RfY3J0Y19zdGF0ZSAqbmV3X2FzdF9zdGF0ZTsKKyAgICAgICAgc3RydWN0IGFzdF9j
cnRjX3N0YXRlICpuZXdfYXN0X3N0YXRlLCAqYXN0X3N0YXRlOwogCiAgICAgICAgIGlmIChXQVJO
X09OKCFjcnRjLT5zdGF0ZSkpCiAgICAgICAgICAgICAgICAgcmV0dXJuIE5VTEw7CkBAIC04OTcs
NiArODk0LDExIEBAIGFzdF9jcnRjX2F0b21pY19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9j
cnRjICpjcnRjKQogICAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgICBfX2RybV9h
dG9taWNfaGVscGVyX2NydGNfZHVwbGljYXRlX3N0YXRlKGNydGMsICZuZXdfYXN0X3N0YXRlLT5i
YXNlKTsKIAorCWFzdF9zdGF0ZSA9IHRvX2FzdF9jcnRjX3N0YXRlKGNydGMtPnN0YXRlKTsKKwor
CW1lbWNweSgmbmV3X2FzdF9zdGF0ZS0+dmJpb3NfbW9kZV9pbmZvLCAmYXN0X3N0YXRlLT52Ymlv
c19tb2RlX2luZm8sCisJICAgICAgIHNpemVvZihuZXdfYXN0X3N0YXRlLT52Ymlvc19tb2RlX2lu
Zm8pKTsKKwogICAgICAgICByZXR1cm4gJm5ld19hc3Rfc3RhdGUtPmJhc2U7CiB9CiAKLS0gCjIu
MjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
