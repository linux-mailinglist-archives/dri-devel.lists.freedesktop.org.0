Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D63BD31F949
	for <lists+dri-devel@lfdr.de>; Fri, 19 Feb 2021 13:17:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 09AB96EB27;
	Fri, 19 Feb 2021 12:17:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav21.altibox.net (asav21.altibox.net [109.247.116.8])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 92D6E6E8C9
 for <dri-devel@lists.freedesktop.org>; Fri, 19 Feb 2021 12:17:13 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav21.altibox.net (Postfix) with ESMTPSA id 744178014F;
 Fri, 19 Feb 2021 13:17:11 +0100 (CET)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6 3/3] drm: Add GUD USB Display driver
Date: Fri, 19 Feb 2021 13:17:02 +0100
Message-Id: <20210219121702.50964-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20210219121702.50964-1-noralf@tronnes.org>
References: <20210219121702.50964-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=Kb38TzQD c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=SJz97ENfAAAA:8 a=gAmX6pxEAAAA:20
 a=e5mUnYsNAAAA:8 a=20KFwNOVAAAA:8 a=bzGWvSuyYtvK48yO3TwA:9
 a=Xn_Mj0gGRcTDdqFp:21 a=hwm5uFJBT5nKMNdA:21 a=QEXdDO2ut3YA:10
 a=vFet0B0WnEQeilDPIY6i:22 a=Vxmtnl_E_bksehYqCbjh:22
 a=pHzHmUro8NiASowvMSCR:22 a=nt3jZW36AmriUCFCBwmW:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: hudson@trmm.net, markus@raatikainen.cc, sam@ravnborg.org,
 linux-usb@vger.kernel.org, th020394@gmail.com, lkundrak@v3.sk,
 pontus.fuchs@gmail.com, Daniel Vetter <daniel.vetter@ffwll.ch>, peter@stuge.se
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgVVNCIGRpc3BsYXkgZHJpdmVyIHdpdGggdGhlIGludGVudGlvbiB0aGF0IGl0
IGNhbiBiZQp1c2VkIHdpdGggZnV0dXJlIFVTQiBpbnRlcmZhY2VkIGxvdyBlbmQgZGlzcGxheXMv
YWRhcHRlcnMuIFRoZSBMaW51eApnYWRnZXQgZGV2aWNlIGRyaXZlciB3aWxsIHNlcnZlIGFzIHRo
ZSBjYW5vbmljYWwgZGV2aWNlIGltcGxlbWVudGF0aW9uLgoKVGhlIGZvbGxvd2luZyBEUk0gcHJv
cGVydGllcyBhcmUgc3VwcG9ydGVkOgotIFBsYW5lIHJvdGF0aW9uCi0gQ29ubmVjdG9yIFRWIHBy
b3BlcnRpZXMKClRoZXJlIGlzIGFsc28gc3VwcG9ydCBmb3IgYmFja2xpZ2h0IGJyaWdodG5lc3Mg
ZXhwb3NlZCBhcyBhIGJhY2tsaWdodApkZXZpY2UuCgpEaXNwbGF5IG1vZGVzIGNhbiBiZSBtYWRl
IGF2YWlsYWJsZSB0byB0aGUgaG9zdCBkcml2ZXIgZWl0aGVyIGFzIERSTQpkaXNwbGF5IG1vZGVz
IG9yIHRocm91Z2ggRURJRC4gSWYgYm90aCBhcmUgcHJlc2VudCwgRURJRCBpcyBqdXN0IHBhc3Nl
ZApvbiB0byB1c2Vyc3BhY2UuCgpQZXJmb3JtYW5jZSBpcyBwcmVmZXJyZWQgb3ZlciBjb2xvciBk
ZXB0aCwgc28gaWYgdGhlIGRldmljZSBzdXBwb3J0cwpSR0I1NjUsIERSTV9DQVBfRFVNQl9QUkVG
RVJSRURfREVQVEggd2lsbCByZXR1cm4gMTYuCgpJZiB0aGUgZGV2aWNlIHRyYW5zZmVyIGJ1ZmZl
ciBjYW4ndCBmaXQgYW4gdW5jb21wcmVzc2VkIGZyYW1lYnVmZmVyCnVwZGF0ZSwgdGhlIHVwZGF0
ZSBpcyBzcGxpdCB1cCBpbnRvIHBhcnRzIHRoYXQgZG8gZml0LgoKT3B0aW1hbCB1c2VyIGV4cGVy
aWVuY2UgaXMgYWNoaWV2ZWQgYnkgcHJvdmlkaW5nIGRhbWFnZSByZXBvcnRzIGVpdGhlciBieQpz
ZXR0aW5nIEZCX0RBTUFHRV9DTElQUyBvbiBwYWdlZmxpcHMgb3IgY2FsbGluZyBEUk1fSU9DVExf
TU9ERV9ESVJUWUZCLgoKTFo0IGNvbXByZXNzaW9uIGlzIHVzZWQgaWYgdGhlIGRldmljZSBzdXBw
b3J0cyBpdC4KClRoZSBkcml2ZXIgc3VwcG9ydHMgYSBvbmUgYml0IG1vbm9jaHJvbWUgdHJhbnNm
ZXIgZm9ybWF0OiBSMS4gVGhpcyBpcyBub3QKaW1wbGVtZW50ZWQgaW4gdGhlIGdhZGdldCBkcml2
ZXIuIEl0IGlzIGFkZGVkIGluIHByZXBhcmF0aW9uIGZvciBmdXR1cmUKbW9ub2Nocm9tZSBlLWlu
ayBkaXNwbGF5cy4KClRoZSBkcml2ZXIgaXMgTUlUIGxpY2Vuc2VkIHRvIHNtb290aCB0aGUgcGF0
aCBmb3IgYW55IEJTRCBwb3J0IG9mIHRoZQpkcml2ZXIuCgp2MjoKLSBVc2UgZGV2bV9kcm1fZGV2
X2FsbG9jKCkgYW5kIGRybW1fbW9kZV9jb25maWdfaW5pdCgpCi0gZHJtX2ZiZGV2X2dlbmVyaWNf
c2V0dXA6IFVzZSBwcmVmZXJyZWRfYnBwPTAsIDE2IHdhcyBhIGNvcHkgcGFzdGUgZXJyb3IKLSBU
aGUgZHJtX2JhY2tsaWdodF9oZWxwZXIgaXMgZHJvcHBlZCwgY29weSBpbiB0aGUgY29kZQotIFN1
cHBvcnQgcHJvdG9jb2wgdmVyc2lvbiBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgZGV2aWNl
Cgp2MzoKLSBVc2UgZG9uYXRlZCBPcGVubW9rbyBVU0IgcGlkCi0gVXNlIGRpcmVjdCBjb21wcmVz
c2lvbiBmcm9tIGZyYW1lYnVmZmVyIHdoZW4gcGl0Y2ggbWF0Y2hlcywgbm90IG9ubHkgb24KICBm
dWxsIGZyYW1lcywgc28gc3BsaXQgdXBkYXRlcyBjYW4gYmVuZWZpdAotIFVzZSBfX2xlMTYgaW4g
c3RydWN0IGd1ZF9kcm1fcmVxX2dldF9jb25uZWN0b3Jfc3RhdHVzCi0gU2V0IGVkaWQgcHJvcGVy
dHkgd2hlbiB0aGUgZGV2aWNlIG9ubHkgcHJvdmlkZXMgZWRpZAotIENsZWFyIGNvbXByZXNzaW9u
IGZpZWxkcyBpbiBzdHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X2J1ZmZlcgotIEZpeCBwcm90b2NvbCB2
ZXJzaW9uIG5lZ290aWF0aW9uCi0gUmVtb3ZlIG1vZGUtPnZyZWZyZXNoLCBpdCdzIGNhbGN1bGF0
ZWQKCnY0OgotIERyb3AgdGhlIHN0YXR1cyByZXEgcG9sbGluZyB3aGljaCB3YXMgYSB3b3JrYXJv
dW5kIGZvciBzb21ldGhpbmcgdGhhdAogIHR1cm5lZCBvdXQgdG8gYmUgYSBkd2MyIHVkYyBkcml2
ZXIgcHJvYmxlbQotIEFkZCBhIGZsYWcgZm9yIHRoZSBMaW51eCBnYWRnZXQgdG8gcmVxdWlyZSBh
IHN0YXR1cyByZXF1ZXN0IG9uCiAgU0VUIG9wZXJhdGlvbnMuIE90aGVyIGRldmljZXMgd2lsbCBv
bmx5IGdldCBzdGF0dXMgcmVxIG9uIFNUQUxMIGVycm9ycwotIFVzZSBwcm90b2NvbCBzcGVjaWZp
YyBlcnJvciBjb2RlcyAoUGV0ZXIpCi0gQWRkIGEgZmxhZyBmb3IgZGV2aWNlcyB0aGF0IHdhbnQg
dG8gcmVjZWl2ZSB0aGUgZW50aXJlIGZyYW1lYnVmZmVyIG9uCiAgZWFjaCBmbHVzaCAoTHVib21p
cikKLSBSZXRyeSBhIGZhaWxlZCBmcmFtZWJ1ZmZlciBmbHVzaAotIElmIG1vZGUgaGFzIGNoYW5n
ZWQgd2FpdCBmb3Igd29ya2VyIGFuZCBjbGVhciBwZW5kaW5nIGRhbWFnZSBiZWZvcmUKICBxdWV1
aW5nIHVwIG5ldyBkYW1hZ2UsIGZiIHdpZHRoL2hlaWdodCBtaWdodCBoYXZlIGNoYW5nZWQKLSBJ
bmNyZWFzZSBlcnJvciBjb3VudGVyIG9uIGJ1bGsgdHJhbnNmZXIgZmFpbHVyZXMKLSBVc2UgRFJN
X01PREVfQ09OTkVDVE9SX1VTQgotIEhhbmRsZSBSMSBrbWFsbG9jIGVycm9yIChQZXRlcikKLSBE
b24ndCB0cnkgYW5kIHJlcGxpY2F0ZSB0aGUgVVNCIGdldCBkZXNjcmlwdG9yIHJlcXVlc3Qgc3Rh
bmRhcmQgZm9yIHRoZQogIGRpc3BsYXkgZGVzY3JpcHRvciAoUGV0ZXIpCi0gTWFrZSBtYXhfYnVm
ZmVyX3NpemUgb3B0aW9uYWwgKFBldGVyKSwgZHJvcCB0aGUgcG93MiByZXF1aXJlbWVudCBzaW5j
ZQogIGl0J3Mgbm90IG5lY2Vzc2FyeSBhbnltb3JlLgotIERvbid0IHByZS1hbGxvYyBhIGNvbnRy
b2wgcmVxdWVzdCBidWZmZXIsIGl0IHdhcyBvbmx5IDRrCi0gTGV0IGd1ZC5oIGRlc2NyaWJlIHRo
ZSB3aG9sZSBwcm90b2NvbCBleHBsaWNpdGx5IGFuZCBkb24ndCBsZXQgRFJNCiAgbGVhayBpbnRv
IGl0IChQZXRlcikKLSBEcm9wIGRpc3BsYXkgbW9kZSAuaHNrZXcgYW5kIC52c2NhbiBmcm9tIHRo
ZSBwcm90b2NvbAotIFNob3J0ZW4gbmFtZXM6IHMvR1VEX0RSTV8vR1VEXy8gcy9ndWRfZHJtXy9n
dWRfLyAoUGV0ZXIpCi0gRml4IGd1ZF9waXBlX2NoZWNrKCkgY29ubmVjdG9yIHBpY2tpbmcgd2hl
biBzd2l0Y2hpbmcgY29ubmVjdG9yCi0gRHJvcCBndWRfZHJtX2RyaXZlcl9nZW1fY3JlYXRlX29i
amVjdCgpIGNhY2hlZCBpcyBkZWZhdWx0IG5vdwotIFJldHJpZXZlIFVTQiBkZXZpY2UgZnJvbSBz
dHJ1Y3QgZHJtX2RldmljZS5kZXYgaW5zdGVhZCBvZiBrZWVwaW5nIGEKICBwb2ludGVyCi0gSG9u
b3VyIGZiLT5vZmZzZXRzWzBdCi0gRml4IG1vZGUgZmV0Y2hpbmcgd2hlbiBjb25uZWN0b3Igc3Rh
dHVzIGlzIGZvcmNlZAotIENoZWNrIEVESUQgbGVuZ3RoIHJlcG9ydGVkIGJ5IHRoZSBkZXZpY2UK
LSBVc2UgZHJtX2RvX2dldF9lZGlkKCkgc28gdXNlcnNwYWNlIGNhbiBvdmVycnJpZGUgRURJRAot
IFNldCBlcG9jaCBjb3VudGVyIHRvIHNpZ25hbCBjb25uZWN0b3Igc3RhdHVzIGNoYW5nZQotIGd1
ZF9kcm1fZHJpdmVyIGNhbiBiZSBjb25zdCBub3cKCnY1OgotIEdVRF9EUk1fRk9STUFUX1IxOiBV
c2Ugbm9uLWh1bWFuIGFzY2lpIHZhbHVlcyAoRGFuaWVsKQotIENoYW5nZSBuYW1lIHRvOiBHVUQg
VVNCIERpc3BsYXkgKFRob21hcywgU2ltb24pCi0gQ2hhbmdlIG9uZSBfX3UzMiAtPiBfX2xlMzIg
aW4gcHJvdG9jb2wgaGVhZGVyCi0gQWx3YXlzIGxvZyBmYiBmbHVzaCBlcnJvcnMsIHVubGVzcyB0
aGUgcHJldmlvdXMgb25lIGZhaWxlZAotIFJ1biBiYWNrbGlnaHQgdXBkYXRlIGluIGEgd29ya2Vy
IHRvIGF2b2lkIHVwc2V0dGluZyBsb2NrZGVwIChEYW5pZWwpCi0gRHJvcCBiYWNrbGlnaHRfb3Bz
LmdldF9icmlnaHRuZXNzLCB0aGVyZSdzIG5vIHJlYWRiYWNrIGZyb20gdGhlIGRldmljZQogIHNv
IGl0IGRvZXNuJ3QgcmVhbGx5IGFkZCBhbnl0aGluZy4KLSBTZXQgZG1hIG1hc2ssIG5lZWRlZCBi
eSBkbWEtYnVmIGltcG9ydGVycwoKdjY6Ci0gVXNlIG9iai15IGluIE1ha2VmaWxlIChQZXRlcikK
LSBGaXggbWlzc2luZyBsZTMyX3RvX2NwdSgpIHdoZW4gdXNpbmcgR1VEX0RJU1BMQVlfTUFHSUMg
KFBldGVyKQotIFNldCBpbml0aWFsIGJyaWdodG5lc3Mgb24gYmFja2xpZ2h0IGRldmljZQoKQ2M6
IFBldGVyIFN0dWdlIDxwZXRlckBzdHVnZS5zZT4KVGVzdGVkLWJ5OiBMdWJvbWlyIFJpbnRlbCA8
bGt1bmRyYWtAdjMuc2s+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZm
d2xsLmNoPgpTaWduZWQtb2ZmLWJ5OiBOb3JhbGYgVHLDuG5uZXMgPG5vcmFsZkB0cm9ubmVzLm9y
Zz4KLS0tCiBNQUlOVEFJTkVSUyAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgOCArCiBkcml2
ZXJzL2dwdS9kcm0vS2NvbmZpZyAgICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0v
TWFrZWZpbGUgICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25maWcg
ICAgICAgICB8ICAxNCArCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL01ha2VmaWxlICAgICAgICB8ICAg
NCArCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9jb25uZWN0b3IuYyB8IDczOCArKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcnYuYyAgICAgICB8
IDYyNSArKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfaW50
ZXJuYWwuaCAgfCAxNDkgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBlLmMgICAg
ICB8IDQ3NSArKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvZHJtL2d1ZC5oICAgICAgICAgICAg
ICAgICAgIHwgMzU2ICsrKysrKysrKysrKysrCiAxMCBmaWxlcyBjaGFuZ2VkLCAyMzcyIGluc2Vy
dGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25maWcK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL01ha2VmaWxlCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfY29ubmVjdG9yLmMKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcnYuYwogY3JlYXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2ludGVybmFsLmgKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBlLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNs
dWRlL2RybS9ndWQuaAoKZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIvTUFJTlRBSU5FUlMKaW5k
ZXggMDAxMTJjMDQ0NjA4Li5lN2Y3MWFjNTVmMDggMTAwNjQ0Ci0tLSBhL01BSU5UQUlORVJTCisr
KyBiL01BSU5UQUlORVJTCkBAIC01NTI1LDYgKzU1MjUsMTQgQEAgUzoJTWFpbnRhaW5lZAogRjoJ
RG9jdW1lbnRhdGlvbi9kZXZpY2V0cmVlL2JpbmRpbmdzL2Rpc3BsYXkvcGFuZWwvZmVpeWFuZyxm
eTA3MDI0ZGkyNmEzMGQueWFtbAogRjoJZHJpdmVycy9ncHUvZHJtL3BhbmVsL3BhbmVsLWZlaXlh
bmctZnkwNzAyNGRpMjZhMzBkLmMKIAorRFJNIERSSVZFUiBGT1IgR0VORVJJQyBVU0IgRElTUExB
WQorTToJTm9yYWxmIFRyw7hubmVzIDxub3JhbGZAdHJvbm5lcy5vcmc+CitTOglNYWludGFpbmVk
CitXOglodHRwczovL2dpdGh1Yi5jb20vbm90cm8vZ3VkL3dpa2kKK1Q6CWdpdCBnaXQ6Ly9hbm9u
Z2l0LmZyZWVkZXNrdG9wLm9yZy9kcm0vZHJtLW1pc2MKK0Y6CWRyaXZlcnMvZ3B1L2RybS9ndWQv
CitGOglpbmNsdWRlL2RybS9ndWQuaAorCiBEUk0gRFJJVkVSIEZPUiBHUkFJTiBNRURJQSBHTTEy
VTMyMCBQUk9KRUNUT1JTCiBNOglIYW5zIGRlIEdvZWRlIDxoZGVnb2VkZUByZWRoYXQuY29tPgog
UzoJTWFpbnRhaW5lZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL0tjb25maWcgYi9kcml2
ZXJzL2dwdS9kcm0vS2NvbmZpZwppbmRleCAxNDdkNjFiOTY3NGUuLjZkM2Y0NzkzM2U1MSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL0tj
b25maWcKQEAgLTM4OCw2ICszODgsOCBAQCBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS90aWRzcy9L
Y29uZmlnIgogCiBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS94bG54L0tjb25maWciCiAKK3NvdXJj
ZSAiZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnIgorCiAjIEtlZXAgbGVnYWN5IGRyaXZlcnMg
bGFzdAogCiBtZW51Y29uZmlnIERSTV9MRUdBQ1kKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQppbmRleCA4MTU2OTAwOWY4ODQu
Ljc4ZGQ4ZTEyNTI1ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtMTI0LDMgKzEyNCw0IEBAIG9iai0kKENPTkZJ
R19EUk1fQVNQRUVEX0dGWCkgKz0gYXNwZWVkLwogb2JqLSQoQ09ORklHX0RSTV9NQ0RFKSArPSBt
Y2RlLwogb2JqLSQoQ09ORklHX0RSTV9USURTUykgKz0gdGlkc3MvCiBvYmoteQkJCSs9IHhsbngv
CitvYmoteQkJCSs9IGd1ZC8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZp
ZyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLjFjODYwMWJmNGQ5MQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9ndWQvS2NvbmZpZwpAQCAtMCwwICsxLDE0IEBACisjIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCisKK2NvbmZpZyBEUk1fR1VECisJdHJpc3RhdGUgIkdVRCBVU0IgRGlz
cGxheSIKKwlkZXBlbmRzIG9uIERSTSAmJiBVU0IKKwlzZWxlY3QgTFo0X0NPTVBSRVNTCisJc2Vs
ZWN0IERSTV9LTVNfSEVMUEVSCisJc2VsZWN0IERSTV9HRU1fU0hNRU1fSEVMUEVSCisJc2VsZWN0
IEJBQ0tMSUdIVF9DTEFTU19ERVZJQ0UKKwloZWxwCisJICBUaGlzIGlzIGEgRFJNIGRpc3BsYXkg
ZHJpdmVyIGZvciBHVUQgVVNCIERpc3BsYXlzIG9yIGRpc3BsYXkKKwkgIGFkYXB0ZXJzLgorCisJ
ICBJZiBNIGlzIHNlbGVjdGVkIHRoZSBtb2R1bGUgd2lsbCBiZSBjYWxsZWQgZ3VkLgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9ndWQv
TWFrZWZpbGUKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42OGExYzYy
MmNmMzMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL01ha2VmaWxlCkBA
IC0wLDAgKzEsNCBAQAorIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorCitndWQt
eQkJCQk6PSBndWRfZHJ2Lm8gZ3VkX3BpcGUubyBndWRfY29ubmVjdG9yLm8KK29iai0kKENPTkZJ
R19EUk1fR1VEKQkJKz0gZ3VkLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3Vk
X2Nvbm5lY3Rvci5jIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfY29ubmVjdG9yLmMKbmV3IGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42NGYzMjMxNTI5NzYKLS0tIC9kZXYv
bnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9jb25uZWN0b3IuYwpAQCAtMCwwICsx
LDczOCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdo
dCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNsdWRlIDxsaW51eC9iYWNrbGlnaHQu
aD4KKyNpbmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRv
bWljLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfc3RhdGVfaGVscGVyLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Rydi5oPgorI2luY2x1
ZGUgPGRybS9kcm1fZW5jb2Rlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgorI2luY2x1
ZGUgPGRybS9kcm1fbW9kZXNldF9oZWxwZXJfdnRhYmxlcy5oPgorI2luY2x1ZGUgPGRybS9kcm1f
cHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZ3VkLmg+CisKKyNpbmNs
dWRlICJndWRfaW50ZXJuYWwuaCIKKworc3RydWN0IGd1ZF9jb25uZWN0b3IgeworCXN0cnVjdCBk
cm1fY29ubmVjdG9yIGNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgZW5jb2RlcjsKKwlz
dHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmFja2xpZ2h0OworCXN0cnVjdCB3b3JrX3N0cnVjdCBi
YWNrbGlnaHRfd29yazsKKworCS8qIFN1cHBvcnRlZCBwcm9wZXJ0aWVzICovCisJdTE2ICpwcm9w
ZXJ0aWVzOworCXVuc2lnbmVkIGludCBudW1fcHJvcGVydGllczsKKworCS8qIEluaXRpYWwgZ2Fk
Z2V0IHR2IHN0YXRlIGlmIGFwcGxpY2FibGUsIGFwcGxpZWQgb24gc3RhdGUgcmVzZXQgKi8KKwlz
dHJ1Y3QgZHJtX3R2X2Nvbm5lY3Rvcl9zdGF0ZSBpbml0aWFsX3R2X3N0YXRlOworCisJLyoKKwkg
KiBJbml0aWFsIGdhZGdldCBiYWNrbGlnaHQgYnJpZ2h0bmVzcyBpZiBhcHBsaWNhYmxlLCBhcHBs
aWVkIG9uIHN0YXRlIHJlc2V0LgorCSAqIFRoZSB2YWx1ZSAtRU5PREVWIGlzIHVzZWQgdG8gc2ln
bmFsIG5vIGJhY2tsaWdodC4KKwkgKi8KKwlpbnQgaW5pdGlhbF9icmlnaHRuZXNzOworCisJdW5z
aWduZWQgaW50IG51bV9tb2RlczsKKwlzaXplX3QgZWRpZF9sZW47Cit9OworCitzdGF0aWMgaW5s
aW5lIHN0cnVjdCBndWRfY29ubmVjdG9yICp0b19ndWRfY29ubmVjdG9yKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihjb25uZWN0b3IsIHN0
cnVjdCBndWRfY29ubmVjdG9yLCBjb25uZWN0b3IpOworfQorCisvKgorICogVXNlIGEgd29ya2Vy
IHRvIGF2b2lkIHRha2luZyBrbXMgbG9ja3MgaW5zaWRlIHRoZSBiYWNrbGlnaHQgbG9jay4KKyAq
IE90aGVyIGRpc3BsYXkgZHJpdmVycyB1c2UgYmFja2xpZ2h0IHdpdGhpbiB0aGVpciBrbXMgbG9j
a3MuCisgKiBUaGlzIGF2b2lkcyBpbmNvbnNpc3RlbnQgbG9ja2luZyBydWxlcywgd2hpY2ggd291
bGQgdXBzZXQgbG9ja2RlcC4KKyAqLworc3RhdGljIHZvaWQgZ3VkX2Nvbm5lY3Rvcl9iYWNrbGln
aHRfdXBkYXRlX3N0YXR1c193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1
Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IGd1ZF9j
b25uZWN0b3IsIGJhY2tsaWdodF93b3JrKTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yID0gJmdjb25uLT5jb25uZWN0b3I7CisJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5lY3Rvcl9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gY29ubmVjdG9yLT5kZXY7
CisJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4IGN0eDsKKwlzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGU7CisJaW50IGlkeCwgcmV0OworCisJaWYgKCFkcm1fZGV2X2VudGVyKGRy
bSwgJmlkeCkpCisJCXJldHVybjsKKworCXN0YXRlID0gZHJtX2F0b21pY19zdGF0ZV9hbGxvYyhk
cm0pOworCWlmICghc3RhdGUpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBleGl0OworCX0K
KworCWRybV9tb2Rlc2V0X2FjcXVpcmVfaW5pdCgmY3R4LCAwKTsKKwlzdGF0ZS0+YWNxdWlyZV9j
dHggPSAmY3R4OworcmV0cnk6CisJY29ubmVjdG9yX3N0YXRlID0gZHJtX2F0b21pY19nZXRfY29u
bmVjdG9yX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCWlmIChJU19FUlIoY29ubmVjdG9yX3N0
YXRlKSkgeworCQlyZXQgPSBQVFJfRVJSKGNvbm5lY3Rvcl9zdGF0ZSk7CisJCWdvdG8gb3V0Owor
CX0KKworCS8qIFJldXNlIHR2LmJyaWdodG5lc3MgdG8gYXZvaWQgaGF2aW5nIHRvIHN1YmNsYXNz
ICovCisJY29ubmVjdG9yX3N0YXRlLT50di5icmlnaHRuZXNzID0gZ2Nvbm4tPmJhY2tsaWdodC0+
cHJvcHMuYnJpZ2h0bmVzczsKKworCXJldCA9IGRybV9hdG9taWNfY29tbWl0KHN0YXRlKTsKK291
dDoKKwlpZiAocmV0ID09IC1FREVBRExLKSB7CisJCWRybV9hdG9taWNfc3RhdGVfY2xlYXIoc3Rh
dGUpOworCQlkcm1fbW9kZXNldF9iYWNrb2ZmKCZjdHgpOworCQlnb3RvIHJldHJ5OworCX0KKwor
CWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsKKworCWRybV9tb2Rlc2V0X2Ryb3BfbG9ja3Mo
JmN0eCk7CisJZHJtX21vZGVzZXRfYWNxdWlyZV9maW5pKCZjdHgpOworZXhpdDoKKwlkcm1fZGV2
X2V4aXQoaWR4KTsKKworCWlmIChyZXQpCisJCWRldl9lcnIoZHJtLT5kZXYsICJGYWlsZWQgdG8g
dXBkYXRlIGJhY2tsaWdodCwgZXJyPSVkXG4iLCByZXQpOworfQorCitzdGF0aWMgaW50IGd1ZF9j
b25uZWN0b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMoc3RydWN0IGJhY2tsaWdodF9kZXZpY2Ug
KmJkKQoreworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBibF9nZXRfZGF0YShi
ZCk7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rvcihjb25u
ZWN0b3IpOworCisJLyogVGhlIFVTQiB0aW1lb3V0IGlzIDUgc2Vjb25kcyBzbyB1c2Ugc3lzdGVt
X2xvbmdfd3EgZm9yIHdvcnN0IGNhc2Ugc2NlbmFyaW8gKi8KKwlxdWV1ZV93b3JrKHN5c3RlbV9s
b25nX3dxLCAmZ2Nvbm4tPmJhY2tsaWdodF93b3JrKTsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IGJhY2tsaWdodF9vcHMgZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfb3Bz
ID0geworCS51cGRhdGVfc3RhdHVzCT0gZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfdXBkYXRlX3N0
YXR1cywKK307CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfcmVnaXN0ZXIo
c3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uKQoreworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IgPSAmZ2Nvbm4tPmNvbm5lY3RvcjsKKwlzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAq
YmQ7CisJY29uc3QgY2hhciAqbmFtZTsKKwljb25zdCBzdHJ1Y3QgYmFja2xpZ2h0X3Byb3BlcnRp
ZXMgcHJvcHMgPSB7CisJCS50eXBlID0gQkFDS0xJR0hUX1JBVywKKwkJLnNjYWxlID0gQkFDS0xJ
R0hUX1NDQUxFX05PTl9MSU5FQVIsCisJCS5tYXhfYnJpZ2h0bmVzcyA9IDEwMCwKKwkJLmJyaWdo
dG5lc3MgPSBnY29ubi0+aW5pdGlhbF9icmlnaHRuZXNzLAorCX07CisKKwluYW1lID0ga2FzcHJp
bnRmKEdGUF9LRVJORUwsICJjYXJkJWQtJXMtYmFja2xpZ2h0IiwKKwkJCSBjb25uZWN0b3ItPmRl
di0+cHJpbWFyeS0+aW5kZXgsIGNvbm5lY3Rvci0+bmFtZSk7CisJaWYgKCFuYW1lKQorCQlyZXR1
cm4gLUVOT01FTTsKKworCWJkID0gYmFja2xpZ2h0X2RldmljZV9yZWdpc3RlcihuYW1lLCBjb25u
ZWN0b3ItPmtkZXYsIGNvbm5lY3RvciwKKwkJCQkgICAgICAgJmd1ZF9jb25uZWN0b3JfYmFja2xp
Z2h0X29wcywgJnByb3BzKTsKKwlrZnJlZShuYW1lKTsKKwlpZiAoSVNfRVJSKGJkKSkKKwkJcmV0
dXJuIFBUUl9FUlIoYmQpOworCisJZ2Nvbm4tPmJhY2tsaWdodCA9IGJkOworCisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9zdGF0dXNfcmVxdWVzdChzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubiA9
IHRvX2d1ZF9jb25uZWN0b3IoY29ubmVjdG9yKTsKKwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9
IHRvX2d1ZF9kZXZpY2UoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBndWRfY29ubmVjdG9yX3N0
YXR1c19yZXEgcmVxOworCXUxNiBudW1fbW9kZXMsIGVkaWRfbGVuOworCWludCByZXQ7CisKKwly
ZXQgPSBndWRfdXNiX2dldChnZHJtLCBHVURfUkVRX0dFVF9DT05ORUNUT1JfU1RBVFVTLAorCQkJ
ICBjb25uZWN0b3ItPmluZGV4LCAmcmVxLCBzaXplb2YocmVxKSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKworCXN3aXRjaCAocmVxLnN0YXR1cyAmIEdVRF9DT05ORUNUT1JfU1RBVFVTX0NP
Tk5FQ1RFRF9NQVNLKSB7CisJY2FzZSBHVURfQ09OTkVDVE9SX1NUQVRVU19ESVNDT05ORUNURUQ6
CisJCXJldCA9IGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVjdGVkOworCQlicmVhazsKKwljYXNl
IEdVRF9DT05ORUNUT1JfU1RBVFVTX0NPTk5FQ1RFRDoKKwkJcmV0ID0gY29ubmVjdG9yX3N0YXR1
c19jb25uZWN0ZWQ7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldCA9IGNvbm5lY3Rvcl9zdGF0
dXNfdW5rbm93bjsKKwkJYnJlYWs7CisJfTsKKworCW51bV9tb2RlcyA9IGxlMTZfdG9fY3B1KHJl
cS5udW1fbW9kZXMpOworCWVkaWRfbGVuID0gbGUxNl90b19jcHUocmVxLmVkaWRfbGVuKTsKKwor
CWlmIChlZGlkX2xlbiAlIEVESURfTEVOR1RIKSB7CisJCWRybV9lcnIoY29ubmVjdG9yLT5kZXYs
ICIlczogSW52YWxpZCBFRElEIHNpemU6ICV1XG4iLCBjb25uZWN0b3ItPm5hbWUsIGVkaWRfbGVu
KTsKKwkJZWRpZF9sZW4gPSAwOworCX0KKworCWlmIChyZXEuc3RhdHVzICYgR1VEX0NPTk5FQ1RP
Ul9TVEFUVVNfQ0hBTkdFRCB8fAorCSAgICBnY29ubi0+bnVtX21vZGVzICE9IG51bV9tb2RlcyB8
fCBnY29ubi0+ZWRpZF9sZW4gIT0gZWRpZF9sZW4pCisJCWNvbm5lY3Rvci0+ZXBvY2hfY291bnRl
ciArPSAxOworCisJZ2Nvbm4tPm51bV9tb2RlcyA9IG51bV9tb2RlczsKKwlnY29ubi0+ZWRpZF9s
ZW4gPSBlZGlkX2xlbjsKKworCWlmICghbnVtX21vZGVzICYmICFlZGlkX2xlbiAmJiByZXQgIT0g
Y29ubmVjdG9yX3N0YXR1c19kaXNjb25uZWN0ZWQpCisJCWRybV9kYmdfa21zKGNvbm5lY3Rvci0+
ZGV2LCAiJXM6IE5vIG1vZGVzIG9yIEVESUQuXG4iLCBjb25uZWN0b3ItPm5hbWUpOworCisJcmV0
dXJuIHJldDsKK30KKworc3RhdGljIGludCBndWRfY29ubmVjdG9yX2RldGVjdChzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0
eCAqY3R4LCBib29sIGZvcmNlKQoreworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3Vk
X2RldmljZShjb25uZWN0b3ItPmRldik7CisJaW50IGlkeCwgcmV0OworCisJaWYgKCFkcm1fZGV2
X2VudGVyKGNvbm5lY3Rvci0+ZGV2LCAmaWR4KSkKKwkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNf
ZGlzY29ubmVjdGVkOworCisJaWYgKGZvcmNlKSB7CisJCXJldCA9IGd1ZF91c2Jfc2V0KGdkcm0s
IEdVRF9SRVFfU0VUX0NPTk5FQ1RPUl9GT1JDRV9ERVRFQ1QsCisJCQkJICBjb25uZWN0b3ItPmlu
ZGV4LCBOVUxMLCAwKTsKKwkJaWYgKHJldCkgeworCQkJcmV0ID0gY29ubmVjdG9yX3N0YXR1c191
bmtub3duOworCQkJZ290byBleGl0OworCQl9CisJfQorCisJcmV0ID0gZ3VkX2Nvbm5lY3Rvcl9z
dGF0dXNfcmVxdWVzdChjb25uZWN0b3IpOworCWlmIChyZXQgPCAwKQorCQlyZXQgPSBjb25uZWN0
b3Jfc3RhdHVzX3Vua25vd247CitleGl0OgorCWRybV9kZXZfZXhpdChpZHgpOworCisJcmV0dXJu
IHJldDsKK30KKworc3RydWN0IGd1ZF9jb25uZWN0b3JfZ2V0X2VkaWRfY3R4IHsKKwlzdHJ1Y3Qg
Z3VkX2Nvbm5lY3RvciAqZ2Nvbm47CisJdm9pZCAqYnVmOworfTsKKworc3RhdGljIGludCBndWRf
Y29ubmVjdG9yX2dldF9lZGlkX2Jsb2NrKHZvaWQgKmRhdGEsIHU4ICpidWYsIHVuc2lnbmVkIGlu
dCBibG9jaywgc2l6ZV90IGxlbikKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9nZXRfZWRpZF9j
dHggKmN0eCA9IGRhdGE7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gY3R4LT5nY29u
bjsKKwlzaXplX3Qgc3RhcnQgPSBibG9jayAqIEVESURfTEVOR1RIOworCisJaWYgKHN0YXJ0ICsg
bGVuID4gZ2Nvbm4tPmVkaWRfbGVuKQorCQlyZXR1cm4gLTE7CisKKwlpZiAoIWJsb2NrKSB7CisJ
CXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RldmljZShnY29ubi0+Y29ubmVjdG9y
LmRldik7CisJCWludCByZXQ7CisKKwkJLyogQ2hlY2sgYmVjYXVzZSBkcm1fZG9fZ2V0X2VkaWQo
KSB3aWxsIHJldHJ5IG9uIGZhaWx1cmUgKi8KKwkJaWYgKCFjdHgtPmJ1ZikKKwkJCWN0eC0+YnVm
ID0ga21hbGxvYyhnY29ubi0+ZWRpZF9sZW4sIEdGUF9LRVJORUwpOworCQlpZiAoIWN0eC0+YnVm
KQorCQkJcmV0dXJuIC0xOworCisJCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VU
X0NPTk5FQ1RPUl9FRElELCBnY29ubi0+Y29ubmVjdG9yLmluZGV4LAorCQkJCSAgY3R4LT5idWYs
IGdjb25uLT5lZGlkX2xlbik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gLTE7CisJfQorCisJbWVt
Y3B5KGJ1ZiwgY3R4LT5idWYgKyBzdGFydCwgbGVuKTsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGd1ZF9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IpCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rv
cihjb25uZWN0b3IpOworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RldmljZShj
b25uZWN0b3ItPmRldik7CisJc3RydWN0IGd1ZF9jb25uZWN0b3JfZ2V0X2VkaWRfY3R4IGVkaWRf
Y3R4ID0geworCQkuZ2Nvbm4gPSBnY29ubiwKKwl9OworCXN0cnVjdCBndWRfZGlzcGxheV9tb2Rl
X3JlcSAqcmVxbW9kZXMgPSBOVUxMOworCXVuc2lnbmVkIGludCBpLCBudW1fbW9kZXMgPSAwOwor
CXN0cnVjdCBlZGlkICplZGlkID0gTlVMTDsKKwlib29sIGVkaWRfb3ZlcnJpZGU7CisJaW50IGlk
eCwgcmV0OworCisJaWYgKCFkcm1fZGV2X2VudGVyKGNvbm5lY3Rvci0+ZGV2LCAmaWR4KSkKKwkJ
cmV0dXJuIDA7CisKKwlpZiAoY29ubmVjdG9yLT5mb3JjZSkgeworCQlyZXQgPSBndWRfY29ubmVj
dG9yX3N0YXR1c19yZXF1ZXN0KGNvbm5lY3Rvcik7CisJCWlmIChyZXQgPCAwKQorCQkJZ290byBv
dXQ7CisJfQorCisJZWRpZCA9IGRybV9kb19nZXRfZWRpZChjb25uZWN0b3IsIGd1ZF9jb25uZWN0
b3JfZ2V0X2VkaWRfYmxvY2ssICZlZGlkX2N0eCk7CisJZWRpZF9vdmVycmlkZSA9IGVkaWQgJiYg
IWVkaWRfY3R4LmJ1ZjsKKwlrZnJlZShlZGlkX2N0eC5idWYpOworCWRybV9jb25uZWN0b3JfdXBk
YXRlX2VkaWRfcHJvcGVydHkoY29ubmVjdG9yLCBlZGlkKTsKKworCWlmICghZ2Nvbm4tPm51bV9t
b2RlcyB8fCBlZGlkX292ZXJyaWRlKSB7CisJCW51bV9tb2RlcyA9IGRybV9hZGRfZWRpZF9tb2Rl
cyhjb25uZWN0b3IsIGVkaWQpOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXFtb2RlcyA9IGttYWxs
b2NfYXJyYXkoZ2Nvbm4tPm51bV9tb2Rlcywgc2l6ZW9mKCpyZXFtb2RlcyksIEdGUF9LRVJORUwp
OworCWlmICghcmVxbW9kZXMpCisJCWdvdG8gb3V0OworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2Ry
bSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX01PREVTLCBjb25uZWN0b3ItPmluZGV4LAorCQkJICBy
ZXFtb2RlcywgZ2Nvbm4tPm51bV9tb2RlcyAqIHNpemVvZigqcmVxbW9kZXMpKTsKKwlpZiAocmV0
KQorCQlnb3RvIG91dDsKKworCWZvciAoaSA9IDA7IGkgPCBnY29ubi0+bnVtX21vZGVzOyBpKysp
IHsKKwkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7CisKKwkJbW9kZSA9IGRybV9tb2Rl
X2NyZWF0ZShjb25uZWN0b3ItPmRldik7CisJCWlmICghbW9kZSkKKwkJCWdvdG8gb3V0OworCisJ
CWd1ZF90b19kaXNwbGF5X21vZGUobW9kZSwgJnJlcW1vZGVzW2ldKTsKKwkJZHJtX21vZGVfcHJv
YmVkX2FkZChjb25uZWN0b3IsIG1vZGUpOworCQludW1fbW9kZXMrKzsKKwl9CitvdXQ6CisJa2Zy
ZWUocmVxbW9kZXMpOworCWtmcmVlKGVkaWQpOworCWRybV9kZXZfZXhpdChpZHgpOworCisJcmV0
dXJuIG51bV9tb2RlczsKK30KKworc3RhdGljIGludCBndWRfY29ubmVjdG9yX2F0b21pY19jaGVj
ayhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCSAgICAgIHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqbmV3
X3N0YXRlOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9zdGF0ZTsKKworCW5ld19zdGF0ZSA9IGRybV9hdG9t
aWNfZ2V0X25ld19jb25uZWN0b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rvcik7CisJaWYgKCFuZXdf
c3RhdGUtPmNydGMpCisJCXJldHVybiAwOworCisJb2xkX3N0YXRlID0gZHJtX2F0b21pY19nZXRf
b2xkX2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yKTsKKwluZXdfY3J0Y19zdGF0ZSA9
IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBuZXdfc3RhdGUtPmNydGMpOwor
CisJaWYgKG9sZF9zdGF0ZS0+dHYubWFyZ2lucy5sZWZ0ICE9IG5ld19zdGF0ZS0+dHYubWFyZ2lu
cy5sZWZ0IHx8CisJICAgIG9sZF9zdGF0ZS0+dHYubWFyZ2lucy5yaWdodCAhPSBuZXdfc3RhdGUt
PnR2Lm1hcmdpbnMucmlnaHQgfHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLnRvcCAhPSBu
ZXdfc3RhdGUtPnR2Lm1hcmdpbnMudG9wIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYubWFyZ2lucy5i
b3R0b20gIT0gbmV3X3N0YXRlLT50di5tYXJnaW5zLmJvdHRvbSB8fAorCSAgICBvbGRfc3RhdGUt
PnR2Lm1vZGUgIT0gbmV3X3N0YXRlLT50di5tb2RlIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYuYnJp
Z2h0bmVzcyAhPSBuZXdfc3RhdGUtPnR2LmJyaWdodG5lc3MgfHwKKwkgICAgb2xkX3N0YXRlLT50
di5jb250cmFzdCAhPSBuZXdfc3RhdGUtPnR2LmNvbnRyYXN0IHx8CisJICAgIG9sZF9zdGF0ZS0+
dHYuZmxpY2tlcl9yZWR1Y3Rpb24gIT0gbmV3X3N0YXRlLT50di5mbGlja2VyX3JlZHVjdGlvbiB8
fAorCSAgICBvbGRfc3RhdGUtPnR2Lm92ZXJzY2FuICE9IG5ld19zdGF0ZS0+dHYub3ZlcnNjYW4g
fHwKKwkgICAgb2xkX3N0YXRlLT50di5zYXR1cmF0aW9uICE9IG5ld19zdGF0ZS0+dHYuc2F0dXJh
dGlvbiB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lmh1ZSAhPSBuZXdfc3RhdGUtPnR2Lmh1ZSkKKwkJ
bmV3X2NydGNfc3RhdGUtPmNvbm5lY3RvcnNfY2hhbmdlZCA9IHRydWU7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2hlbHBlcl9mdW5jcyBndWRf
Y29ubmVjdG9yX2hlbHBlcl9mdW5jcyA9IHsKKwkuZGV0ZWN0X2N0eCA9IGd1ZF9jb25uZWN0b3Jf
ZGV0ZWN0LAorCS5nZXRfbW9kZXMgPSBndWRfY29ubmVjdG9yX2dldF9tb2RlcywKKwkuYXRvbWlj
X2NoZWNrID0gZ3VkX2Nvbm5lY3Rvcl9hdG9taWNfY2hlY2ssCit9OworCitzdGF0aWMgaW50IGd1
ZF9jb25uZWN0b3JfbGF0ZV9yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
KQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9jb25uZWN0b3IoY29u
bmVjdG9yKTsKKworCWlmIChnY29ubi0+aW5pdGlhbF9icmlnaHRuZXNzIDwgMCkKKwkJcmV0dXJu
IDA7CisKKwlyZXR1cm4gZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfcmVnaXN0ZXIoZ2Nvbm4pOwor
fQorCitzdGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX2Vhcmx5X3VucmVnaXN0ZXIoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4g
PSB0b19ndWRfY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwliYWNrbGlnaHRfZGV2aWNlX3VucmVn
aXN0ZXIoZ2Nvbm4tPmJhY2tsaWdodCk7CisJY2FuY2VsX3dvcmtfc3luYygmZ2Nvbm4tPmJhY2ts
aWdodF93b3JrKTsKK30KKworc3RhdGljIHZvaWQgZ3VkX2Nvbm5lY3Rvcl9kZXN0cm95KHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdj
b25uID0gdG9fZ3VkX2Nvbm5lY3Rvcihjb25uZWN0b3IpOworCisJZHJtX2Nvbm5lY3Rvcl9jbGVh
bnVwKGNvbm5lY3Rvcik7CisJa2ZyZWUoZ2Nvbm4tPnByb3BlcnRpZXMpOworCWtmcmVlKGdjb25u
KTsKK30KKworc3RhdGljIHZvaWQgZ3VkX2Nvbm5lY3Rvcl9yZXNldChzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubiA9IHRvX2d1
ZF9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCWRybV9hdG9taWNfaGVscGVyX2Nvbm5lY3Rvcl9y
ZXNldChjb25uZWN0b3IpOworCWNvbm5lY3Rvci0+c3RhdGUtPnR2ID0gZ2Nvbm4tPmluaXRpYWxf
dHZfc3RhdGU7CisJLyogU2V0IG1hcmdpbnMgZnJvbSBjb21tYW5kIGxpbmUgKi8KKwlkcm1fYXRv
bWljX2hlbHBlcl9jb25uZWN0b3JfdHZfcmVzZXQoY29ubmVjdG9yKTsKKwlpZiAoZ2Nvbm4tPmlu
aXRpYWxfYnJpZ2h0bmVzcyA+PSAwKQorCQljb25uZWN0b3ItPnN0YXRlLT50di5icmlnaHRuZXNz
ID0gZ2Nvbm4tPmluaXRpYWxfYnJpZ2h0bmVzczsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fY29ubmVjdG9yX2Z1bmNzIGd1ZF9jb25uZWN0b3JfZnVuY3MgPSB7CisJLmZpbGxfbW9kZXMg
PSBkcm1faGVscGVyX3Byb2JlX3NpbmdsZV9jb25uZWN0b3JfbW9kZXMsCisJLmxhdGVfcmVnaXN0
ZXIgPSBndWRfY29ubmVjdG9yX2xhdGVfcmVnaXN0ZXIsCisJLmVhcmx5X3VucmVnaXN0ZXIgPSBn
dWRfY29ubmVjdG9yX2Vhcmx5X3VucmVnaXN0ZXIsCisJLmRlc3Ryb3kgPSBndWRfY29ubmVjdG9y
X2Rlc3Ryb3ksCisJLnJlc2V0ID0gZ3VkX2Nvbm5lY3Rvcl9yZXNldCwKKwkuYXRvbWljX2R1cGxp
Y2F0ZV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2Nvbm5lY3Rvcl9kdXBsaWNhdGVfc3RhdGUs
CisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX2Rl
c3Ryb3lfc3RhdGUsCit9OworCisvKgorICogVGhlIHR2Lm1vZGUgcHJvcGVydHkgaXMgc2hhcmVk
IGFtb25nIHRoZSBjb25uZWN0b3JzIGFuZCBpdHMgZW51bSBuYW1lcyBhcmUKKyAqIGRyaXZlciBz
cGVjaWZpYy4gVGhpcyBtZWFucyB0aGF0IGlmIG1vcmUgdGhhbiBvbmUgY29ubmVjdG9yIHVzZXMg
dHYubW9kZSwKKyAqIHRoZSBlbnVtIG5hbWVzIGhhcyB0byBiZSB0aGUgc2FtZS4KKyAqLworc3Rh
dGljIGludCBndWRfY29ubmVjdG9yX2FkZF90dl9tb2RlKHN0cnVjdCBndWRfZGV2aWNlICpnZHJt
LAorCQkJCSAgICAgc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTY0IHZhbCkKK3sK
Kwl1bnNpZ25lZCBpbnQgaSwgbnVtX21vZGVzOworCWNvbnN0IGNoYXIgKiptb2RlczsKKwlzaXpl
X3QgYnVmX2xlbjsKKwljaGFyICpidWY7CisJaW50IHJldDsKKworCW51bV9tb2RlcyA9IHZhbCA+
PiBHVURfQ09OTkVDVE9SX1RWX01PREVfTlVNX1NISUZUOworCisJaWYgKCFudW1fbW9kZXMpCisJ
CXJldHVybiAtRUlOVkFMOworCisJYnVmX2xlbiA9IG51bV9tb2RlcyAqIEdVRF9DT05ORUNUT1Jf
VFZfTU9ERV9OQU1FX0xFTjsKKwltb2RlcyA9IGttYWxsb2NfYXJyYXkobnVtX21vZGVzLCBzaXpl
b2YoKm1vZGVzKSwgR0ZQX0tFUk5FTCk7CisJYnVmID0ga21hbGxvYyhidWZfbGVuLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIW1vZGVzIHx8ICFidWYpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBm
cmVlOworCX0KKworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX0NPTk5FQ1RP
Ul9UVl9NT0RFX1ZBTFVFUywKKwkJCSAgY29ubmVjdG9yLT5pbmRleCwgYnVmLCBidWZfbGVuKTsK
KwlpZiAocmV0KQorCQlnb3RvIGZyZWU7CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtX21vZGVzOyBp
KyspCisJCW1vZGVzW2ldID0gJmJ1ZltpICogR1VEX0NPTk5FQ1RPUl9UVl9NT0RFX05BTUVfTEVO
XTsKKworCXJldCA9IGRybV9tb2RlX2NyZWF0ZV90dl9wcm9wZXJ0aWVzKGNvbm5lY3Rvci0+ZGV2
LCBudW1fbW9kZXMsIG1vZGVzKTsKK2ZyZWU6CisJa2ZyZWUobW9kZXMpOworCWtmcmVlKGJ1Zik7
CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgc3RydWN0IGRybV9wcm9wZXJ0eSAqCitndWRf
Y29ubmVjdG9yX3Byb3BlcnR5X2xvb2t1cChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
LCB1MTYgcHJvcCkKK3sKKwlzdHJ1Y3QgZHJtX21vZGVfY29uZmlnICpjb25maWcgPSAmY29ubmVj
dG9yLT5kZXYtPm1vZGVfY29uZmlnOworCisJc3dpdGNoIChwcm9wKSB7CisJY2FzZSBHVURfUFJP
UEVSVFlfVFZfTEVGVF9NQVJHSU46CisJCXJldHVybiBjb25maWctPnR2X2xlZnRfbWFyZ2luX3By
b3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX1JJR0hUX01BUkdJTjoKKwkJcmV0dXJuIGNv
bmZpZy0+dHZfcmlnaHRfbWFyZ2luX3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX1RP
UF9NQVJHSU46CisJCXJldHVybiBjb25maWctPnR2X3RvcF9tYXJnaW5fcHJvcGVydHk7CisJY2Fz
ZSBHVURfUFJPUEVSVFlfVFZfQk9UVE9NX01BUkdJTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfYm90
dG9tX21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9NT0RFOgorCQlyZXR1
cm4gY29uZmlnLT50dl9tb2RlX3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX0JSSUdI
VE5FU1M6CisJCXJldHVybiBjb25maWctPnR2X2JyaWdodG5lc3NfcHJvcGVydHk7CisJY2FzZSBH
VURfUFJPUEVSVFlfVFZfQ09OVFJBU1Q6CisJCXJldHVybiBjb25maWctPnR2X2NvbnRyYXN0X3By
b3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX0ZMSUNLRVJfUkVEVUNUSU9OOgorCQlyZXR1
cm4gY29uZmlnLT50dl9mbGlja2VyX3JlZHVjdGlvbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9Q
RVJUWV9UVl9PVkVSU0NBTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfb3ZlcnNjYW5fcHJvcGVydHk7
CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfU0FUVVJBVElPTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZf
c2F0dXJhdGlvbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9IVUU6CisJCXJldHVy
biBjb25maWctPnR2X2h1ZV9wcm9wZXJ0eTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gRVJSX1BUUigt
RUlOVkFMKTsKKwl9Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgKmd1ZF9jb25uZWN0b3JfdHZf
c3RhdGVfdmFsKHUxNiBwcm9wLCBzdHJ1Y3QgZHJtX3R2X2Nvbm5lY3Rvcl9zdGF0ZSAqc3RhdGUp
Cit7CisJc3dpdGNoIChwcm9wKSB7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfTEVGVF9NQVJHSU46
CisJCXJldHVybiAmc3RhdGUtPm1hcmdpbnMubGVmdDsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9S
SUdIVF9NQVJHSU46CisJCXJldHVybiAmc3RhdGUtPm1hcmdpbnMucmlnaHQ7CisJY2FzZSBHVURf
UFJPUEVSVFlfVFZfVE9QX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFyZ2lucy50b3A7CisJ
Y2FzZSBHVURfUFJPUEVSVFlfVFZfQk9UVE9NX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFy
Z2lucy5ib3R0b207CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfTU9ERToKKwkJcmV0dXJuICZzdGF0
ZS0+bW9kZTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9CUklHSFRORVNTOgorCQlyZXR1cm4gJnN0
YXRlLT5icmlnaHRuZXNzOworCWNhc2UgR1VEX1BST1BFUlRZX1RWX0NPTlRSQVNUOgorCQlyZXR1
cm4gJnN0YXRlLT5jb250cmFzdDsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9GTElDS0VSX1JFRFVD
VElPTjoKKwkJcmV0dXJuICZzdGF0ZS0+ZmxpY2tlcl9yZWR1Y3Rpb247CisJY2FzZSBHVURfUFJP
UEVSVFlfVFZfT1ZFUlNDQU46CisJCXJldHVybiAmc3RhdGUtPm92ZXJzY2FuOworCWNhc2UgR1VE
X1BST1BFUlRZX1RWX1NBVFVSQVRJT046CisJCXJldHVybiAmc3RhdGUtPnNhdHVyYXRpb247CisJ
Y2FzZSBHVURfUFJPUEVSVFlfVFZfSFVFOgorCQlyZXR1cm4gJnN0YXRlLT5odWU7CisJZGVmYXVs
dDoKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisJfQorfQorCitzdGF0aWMgaW50IGd1ZF9j
b25uZWN0b3JfYWRkX3Byb3BlcnRpZXMoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0cnVjdCBn
dWRfY29ubmVjdG9yICpnY29ubiwKKwkJCQkJdW5zaWduZWQgaW50IG51bV9wcm9wZXJ0aWVzKQor
eworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmZ2RybS0+ZHJtOworCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IgPSAmZ2Nvbm4tPmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZ3VkX3Byb3Bl
cnR5X3JlcSAqcHJvcGVydGllczsKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQgcmV0OworCisJZ2Nv
bm4tPnByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9wZXJ0aWVzLCBzaXplb2YoKmdjb25uLT5w
cm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFnY29ubi0+cHJvcGVydGllcykKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlwcm9wZXJ0aWVzID0ga2NhbGxvYyhudW1fcHJvcGVydGllcywgc2l6
ZW9mKCpwcm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9wZXJ0aWVzKQorCQlyZXR1
cm4gLUVOT01FTTsKKworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX0NPTk5F
Q1RPUl9QUk9QRVJUSUVTLCBjb25uZWN0b3ItPmluZGV4LAorCQkJICBwcm9wZXJ0aWVzLCBudW1f
cHJvcGVydGllcyAqIHNpemVvZigqcHJvcGVydGllcykpOworCWlmIChyZXQpCisJCWdvdG8gb3V0
OworCisJZm9yIChpID0gMDsgaSA8IG51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHByb3Ag
PSBsZTE2X3RvX2NwdShwcm9wZXJ0aWVzW2ldLnByb3ApOworCQl1NjQgdmFsID0gbGU2NF90b19j
cHUocHJvcGVydGllc1tpXS52YWwpOworCQlzdHJ1Y3QgZHJtX3Byb3BlcnR5ICpwcm9wZXJ0eTsK
KwkJdW5zaWduZWQgaW50ICpzdGF0ZV92YWw7CisKKwkJZHJtX2RiZyhkcm0sICJwcm9wZXJ0eTog
JXUgPSAlbGx1KDB4JWxseClcbiIsIHByb3AsIHZhbCwgdmFsKTsKKworCQlzd2l0Y2ggKHByb3Ap
IHsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfTEVGVF9NQVJHSU46CisJCQlmYWxsdGhyb3VnaDsK
KwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOOgorCQkJZmFsbHRocm91Z2g7CisJ
CWNhc2UgR1VEX1BST1BFUlRZX1RWX1RPUF9NQVJHSU46CisJCQlmYWxsdGhyb3VnaDsKKwkJY2Fz
ZSBHVURfUFJPUEVSVFlfVFZfQk9UVE9NX01BUkdJTjoKKwkJCXJldCA9IGRybV9tb2RlX2NyZWF0
ZV90dl9tYXJnaW5fcHJvcGVydGllcyhkcm0pOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsK
KwkJCWJyZWFrOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9NT0RFOgorCQkJcmV0ID0gZ3VkX2Nv
bm5lY3Rvcl9hZGRfdHZfbW9kZShnZHJtLCBjb25uZWN0b3IsIHZhbCk7CisJCQlpZiAocmV0KQor
CQkJCWdvdG8gb3V0OworCQkJdmFsID0gdmFsICYgKEJJVChHVURfQ09OTkVDVE9SX1RWX01PREVf
TlVNX1NISUZUKSAtIDEpOworCQkJYnJlYWs7CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX0JSSUdI
VE5FU1M6CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfQ09OVFJBU1Q6
CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJ
T046CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfT1ZFUlNDQU46CisJ
CQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfU0FUVVJBVElPTjoKKwkJCWZh
bGx0aHJvdWdoOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9IVUU6CisJCQkvKiBUaGlzIGlzIGEg
bm8tb3AgaWYgYWxyZWFkeSBhZGRlZC4gKi8KKwkJCXJldCA9IGRybV9tb2RlX2NyZWF0ZV90dl9w
cm9wZXJ0aWVzKGRybSwgMCwgTlVMTCk7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCQkJ
YnJlYWs7CisJCWNhc2UgR1VEX1BST1BFUlRZX0JBQ0tMSUdIVF9CUklHSFRORVNTOgorCQkJaWYg
KHZhbCA+IDEwMCkgeworCQkJCXJldCA9IC1FSU5WQUw7CisJCQkJZ290byBvdXQ7CisJCQl9CisJ
CQlnY29ubi0+aW5pdGlhbF9icmlnaHRuZXNzID0gdmFsOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6
CisJCQkvKiBOZXcgb25lcyBtaWdodCBzaG93IHVwIGluIGZ1dHVyZSBkZXZpY2VzLCBza2lwIHRo
b3NlIHdlIGRvbid0IGtub3cuICovCisJCQlkcm1fZGJnKGRybSwgIlVua25vd24gcHJvcGVydHk6
ICV1XG4iLCBwcm9wKTsKKwkJCWNvbnRpbnVlOworCQl9CisKKwkJZ2Nvbm4tPnByb3BlcnRpZXNb
Z2Nvbm4tPm51bV9wcm9wZXJ0aWVzKytdID0gcHJvcDsKKworCQlpZiAocHJvcCA9PSBHVURfUFJP
UEVSVFlfQkFDS0xJR0hUX0JSSUdIVE5FU1MpCisJCQljb250aW51ZTsgLyogbm90IGEgRFJNIHBy
b3BlcnR5ICovCisKKwkJcHJvcGVydHkgPSBndWRfY29ubmVjdG9yX3Byb3BlcnR5X2xvb2t1cChj
b25uZWN0b3IsIHByb3ApOworCQlpZiAoV0FSTl9PTihJU19FUlIocHJvcGVydHkpKSkKKwkJCWNv
bnRpbnVlOworCisJCXN0YXRlX3ZhbCA9IGd1ZF9jb25uZWN0b3JfdHZfc3RhdGVfdmFsKHByb3As
ICZnY29ubi0+aW5pdGlhbF90dl9zdGF0ZSk7CisJCWlmIChXQVJOX09OKElTX0VSUihzdGF0ZV92
YWwpKSkKKwkJCWNvbnRpbnVlOworCisJCSpzdGF0ZV92YWwgPSB2YWw7CisJCWRybV9vYmplY3Rf
YXR0YWNoX3Byb3BlcnR5KCZjb25uZWN0b3ItPmJhc2UsIHByb3BlcnR5LCAwKTsKKwl9CitvdXQ6
CisJa2ZyZWUocHJvcGVydGllcyk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgZ3VkX2Nvbm5l
Y3Rvcl9maWxsX3Byb3BlcnRpZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJ
CQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGUsCisJCQkJICBz
dHJ1Y3QgZ3VkX3Byb3BlcnR5X3JlcSAqcHJvcGVydGllcykKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5l
Y3RvciAqZ2Nvbm47CisJdW5zaWduZWQgaW50IGk7CisKKwlnY29ubiA9IHRvX2d1ZF9jb25uZWN0
b3IoY29ubmVjdG9yKTsKKworCS8qIE9ubHkgaW50ZXJlc3RlZCBpbiB0aGUgY291bnQ/ICovCisJ
aWYgKCFjb25uZWN0b3Jfc3RhdGUpCisJCXJldHVybiBnY29ubi0+bnVtX3Byb3BlcnRpZXM7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgZ2Nvbm4tPm51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHBy
b3AgPSBnY29ubi0+cHJvcGVydGllc1tpXTsKKwkJdTY0IHZhbDsKKworCQlpZiAocHJvcCA9PSBH
VURfUFJPUEVSVFlfQkFDS0xJR0hUX0JSSUdIVE5FU1MpIHsKKwkJCXZhbCA9IGNvbm5lY3Rvcl9z
dGF0ZS0+dHYuYnJpZ2h0bmVzczsKKwkJfSBlbHNlIHsKKwkJCXVuc2lnbmVkIGludCAqc3RhdGVf
dmFsOworCisJCQlzdGF0ZV92YWwgPSBndWRfY29ubmVjdG9yX3R2X3N0YXRlX3ZhbChwcm9wLCAm
Y29ubmVjdG9yX3N0YXRlLT50dik7CisJCQlpZiAoV0FSTl9PTl9PTkNFKElTX0VSUihzdGF0ZV92
YWwpKSkKKwkJCQlyZXR1cm4gUFRSX0VSUihzdGF0ZV92YWwpOworCisJCQl2YWwgPSAqc3RhdGVf
dmFsOworCQl9CisKKwkJcHJvcGVydGllc1tpXS5wcm9wID0gY3B1X3RvX2xlMTYocHJvcCk7CisJ
CXByb3BlcnRpZXNbaV0udmFsID0gY3B1X3RvX2xlNjQodmFsKTsKKwl9CisKKwlyZXR1cm4gZ2Nv
bm4tPm51bV9wcm9wZXJ0aWVzOworfQorCitpbnQgZ3VkX2Nvbm5lY3Rvcl9jcmVhdGUoc3RydWN0
IGd1ZF9kZXZpY2UgKmdkcm0sIHVuc2lnbmVkIGludCBpbmRleCkKK3sKKwlzdHJ1Y3QgZ3VkX2Nv
bm5lY3Rvcl9kZXNjcmlwdG9yX3JlcSBkZXNjOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAm
Z2RybS0+ZHJtOworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubjsKKwlzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yOworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwlpbnQg
cmV0LCBjb25uZWN0b3JfdHlwZTsKKwl1MzIgZmxhZ3M7CisKKwlyZXQgPSBndWRfdXNiX2dldChn
ZHJtLCBHVURfUkVRX0dFVF9DT05ORUNUT1IsIGluZGV4LCAmZGVzYywgc2l6ZW9mKGRlc2MpKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZ2Nvbm4gPSBremFsbG9jKHNpemVvZigqZ2Nv
bm4pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uKQorCQlyZXR1cm4gLUVOT01FTTsKKworCUlO
SVRfV09SSygmZ2Nvbm4tPmJhY2tsaWdodF93b3JrLCBndWRfY29ubmVjdG9yX2JhY2tsaWdodF91
cGRhdGVfc3RhdHVzX3dvcmspOworCWdjb25uLT5pbml0aWFsX2JyaWdodG5lc3MgPSAtRU5PREVW
OworCWZsYWdzID0gbGUzMl90b19jcHUoZGVzYy5mbGFncyk7CisJY29ubmVjdG9yID0gJmdjb25u
LT5jb25uZWN0b3I7CisKKwlkcm1fZGJnKGRybSwgIkNvbm5lY3RvcjogaW5kZXg9JXUgdHlwZT0l
dSBmbGFncz0weCV4IG51bV9wcm9wZXJ0aWVzPSV1XG4iLAorCQlpbmRleCwgZGVzYy5jb25uZWN0
b3JfdHlwZSwgZmxhZ3MsIGRlc2MubnVtX3Byb3BlcnRpZXMpOworCisJc3dpdGNoIChkZXNjLmNv
bm5lY3Rvcl90eXBlKSB7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVfUEFORUw6CisJCWNvbm5l
Y3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX1VTQjsKKwkJYnJlYWs7CisJY2FzZSBHVURf
Q09OTkVDVE9SX1RZUEVfVkdBOgorCQljb25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RP
Ul9WR0E7CisJCWJyZWFrOworCWNhc2UgR1VEX0NPTk5FQ1RPUl9UWVBFX0RWSToKKwkJY29ubmVj
dG9yX3R5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1JfRFZJRDsKKwkJYnJlYWs7CisJY2FzZSBHVURf
Q09OTkVDVE9SX1RZUEVfQ09NUE9TSVRFOgorCQljb25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NP
Tk5FQ1RPUl9Db21wb3NpdGU7CisJCWJyZWFrOworCWNhc2UgR1VEX0NPTk5FQ1RPUl9UWVBFX1NW
SURFTzoKKwkJY29ubmVjdG9yX3R5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1JfU1ZJREVPOworCQli
cmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1JfVFlQRV9DT01QT05FTlQ6CisJCWNvbm5lY3Rvcl90
eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0NvbXBvbmVudDsKKwkJYnJlYWs7CisJY2FzZSBHVURf
Q09OTkVDVE9SX1RZUEVfRElTUExBWVBPUlQ6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVf
Q09OTkVDVE9SX0Rpc3BsYXlQb3J0OworCQlicmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1JfVFlQ
RV9IRE1JOgorCQljb25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQTsKKwkJ
YnJlYWs7CisJZGVmYXVsdDogLyogZnV0dXJlIHR5cGVzICovCisJCWNvbm5lY3Rvcl90eXBlID0g
RFJNX01PREVfQ09OTkVDVE9SX1VTQjsKKwkJYnJlYWs7CisJfTsKKworCWRybV9jb25uZWN0b3Jf
aGVscGVyX2FkZChjb25uZWN0b3IsICZndWRfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyk7CisJcmV0
ID0gZHJtX2Nvbm5lY3Rvcl9pbml0KGRybSwgY29ubmVjdG9yLCAmZ3VkX2Nvbm5lY3Rvcl9mdW5j
cywgY29ubmVjdG9yX3R5cGUpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUoY29ubmVjdG9yKTsKKwkJ
cmV0dXJuIHJldDsKKwl9CisKKwlpZiAoV0FSTl9PTihjb25uZWN0b3ItPmluZGV4ICE9IGluZGV4
KSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZmxhZ3MgJiBHVURfQ09OTkVDVE9SX0ZMQUdT
X1BPTExfU1RBVFVTKQorCQljb25uZWN0b3ItPnBvbGxlZCA9IChEUk1fQ09OTkVDVE9SX1BPTExf
Q09OTkVDVCB8IERSTV9DT05ORUNUT1JfUE9MTF9ESVNDT05ORUNUKTsKKwlpZiAoZmxhZ3MgJiBH
VURfQ09OTkVDVE9SX0ZMQUdTX0lOVEVSTEFDRSkKKwkJY29ubmVjdG9yLT5pbnRlcmxhY2VfYWxs
b3dlZCA9IHRydWU7CisJaWYgKGZsYWdzICYgR1VEX0NPTk5FQ1RPUl9GTEFHU19ET1VCTEVTQ0FO
KQorCQljb25uZWN0b3ItPmRvdWJsZXNjYW5fYWxsb3dlZCA9IHRydWU7CisKKwlpZiAoZGVzYy5u
dW1fcHJvcGVydGllcykgeworCQlyZXQgPSBndWRfY29ubmVjdG9yX2FkZF9wcm9wZXJ0aWVzKGdk
cm0sIGdjb25uLCBkZXNjLm51bV9wcm9wZXJ0aWVzKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2Vy
cihkcm0tPmRldiwgIkZhaWxlZCB0byBhZGQgY29ubmVjdG9yLyV1IHByb3BlcnRpZXNcbiIsIGlu
ZGV4KTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwkvKiBUaGUgZmlyc3QgY29ubmVjdG9y
IGlzIGF0dGFjaGVkIHRvIHRoZSBleGlzdGluZyBzaW1wbGUgcGlwZSBlbmNvZGVyICovCisJaWYg
KCFjb25uZWN0b3ItPmluZGV4KSB7CisJCWVuY29kZXIgPSAmZ2RybS0+cGlwZS5lbmNvZGVyOwor
CX0gZWxzZSB7CisJCWVuY29kZXIgPSAmZ2Nvbm4tPmVuY29kZXI7CisKKwkJcmV0ID0gZHJtX3Np
bXBsZV9lbmNvZGVyX2luaXQoZHJtLCBlbmNvZGVyLCBEUk1fTU9ERV9FTkNPREVSX05PTkUpOwor
CQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQllbmNvZGVyLT5wb3NzaWJsZV9jcnRjcyA9
IDE7CisJfQorCisJcmV0dXJuIGRybV9jb25uZWN0b3JfYXR0YWNoX2VuY29kZXIoY29ubmVjdG9y
LCBlbmNvZGVyKTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2Rydi5j
IGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJ2LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi44ZjBhNjhkNjU3NjkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vZ3VkL2d1ZF9kcnYuYwpAQCAtMCwwICsxLDYyNSBAQAorLy8gU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcwor
ICovCisKKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLW1h
cHBpbmcuaD4KKyNpbmNsdWRlIDxsaW51eC9sejQuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUu
aD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9z
dHJpbmdfaGVscGVycy5oPgorI2luY2x1ZGUgPGxpbnV4L3VzYi5oPgorI2luY2x1ZGUgPGxpbnV4
L3ZtYWxsb2MuaD4KKyNpbmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKworI2luY2x1ZGUgPGRy
bS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGFtYWdlX2hlbHBlci5o
PgorI2luY2x1ZGUgPGRybS9kcm1fZGVidWdmcy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJj
Yy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fbWFuYWdl
ZC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2Jl
X2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKyNpbmNs
dWRlIDxkcm0vZ3VkLmg+CisKKyNpbmNsdWRlICJndWRfaW50ZXJuYWwuaCIKKworLyogT25seSB1
c2VkIGludGVybmFsbHkgKi8KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGd1
ZF9kcm1fZm9ybWF0X3IxID0geworCS5mb3JtYXQgPSBHVURfRFJNX0ZPUk1BVF9SMSwKKwkubnVt
X3BsYW5lcyA9IDEsCisJLmNoYXJfcGVyX2Jsb2NrID0geyAxLCAwLCAwIH0sCisJLmJsb2NrX3cg
PSB7IDgsIDAsIDAgfSwKKwkuYmxvY2tfaCA9IHsgMSwgMCwgMCB9LAorCS5oc3ViID0gMSwKKwku
dnN1YiA9IDEsCit9OworCitzdGF0aWMgaW50IGd1ZF91c2JfY29udHJvbF9tc2coc3RydWN0IHVz
Yl9kZXZpY2UgKnVzYiwgdTggaWZudW0sIGJvb2wgaW4sCisJCQkgICAgICAgdTggcmVxdWVzdCwg
dTE2IHZhbHVlLCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJdTggcmVxdWVzdHR5cGUgPSBV
U0JfVFlQRV9WRU5ET1IgfCBVU0JfUkVDSVBfSU5URVJGQUNFOworCXVuc2lnbmVkIGludCBwaXBl
OworCWludCByZXQ7CisKKwlpZiAoaW4pIHsKKwkJcGlwZSA9IHVzYl9yY3ZjdHJscGlwZSh1c2Is
IDApOworCQlyZXF1ZXN0dHlwZSB8PSBVU0JfRElSX0lOOworCX0gZWxzZSB7CisJCXBpcGUgPSB1
c2Jfc25kY3RybHBpcGUodXNiLCAwKTsKKwkJcmVxdWVzdHR5cGUgfD0gVVNCX0RJUl9PVVQ7CisJ
fQorCisJcmV0ID0gdXNiX2NvbnRyb2xfbXNnKHVzYiwgcGlwZSwgcmVxdWVzdCwgcmVxdWVzdHR5
cGUsIHZhbHVlLAorCQkJICAgICAgaWZudW0sIGJ1ZiwgbGVuLCBVU0JfQ1RSTF9HRVRfVElNRU9V
VCk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisJaWYgKHJldCAhPSBsZW4pCisJCXJl
dHVybiAtRUlPOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2dldF9kaXNwbGF5
X2Rlc2NyaXB0b3Ioc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSwKKwkJCQkgICAgICBz
dHJ1Y3QgZ3VkX2Rpc3BsYXlfZGVzY3JpcHRvcl9yZXEgKmRlc2MpCit7CisJdTggaWZudW0gPSBp
bnRlcmZhY2UtPmN1cl9hbHRzZXR0aW5nLT5kZXNjLmJJbnRlcmZhY2VOdW1iZXI7CisJc3RydWN0
IHVzYl9kZXZpY2UgKnVzYiA9IGludGVyZmFjZV90b191c2JkZXYoaW50ZXJmYWNlKTsKKwl2b2lk
ICpidWY7CisJaW50IHJldDsKKworCWJ1ZiA9IGttYWxsb2Moc2l6ZW9mKCpkZXNjKSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFidWYpCisJCXJldHVybiAtRU5PTUVNOworCisJcmV0ID0gZ3VkX3VzYl9j
b250cm9sX21zZyh1c2IsIGlmbnVtLCB0cnVlLCBHVURfUkVRX0dFVF9ERVNDUklQVE9SLCAwLCBi
dWYsIHNpemVvZigqZGVzYykpOworCW1lbWNweShkZXNjLCBidWYsIHNpemVvZigqZGVzYykpOwor
CWtmcmVlKGJ1Zik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmIChkZXNjLT5tYWdp
YyAhPSBsZTMyX3RvX2NwdShHVURfRElTUExBWV9NQUdJQykpCisJCXJldHVybiAtRU5PREFUQTsK
KworCURSTV9ERVZfREVCVUdfRFJJVkVSKCZpbnRlcmZhY2UtPmRldiwKKwkJCSAgICAgInZlcnNp
b249JXUgZmxhZ3M9MHgleCBjb21wcmVzc2lvbj0weCV4IG51bV9mb3JtYXRzPSV1IG51bV9jb25u
ZWN0b3JzPSV1IG1heF9idWZmZXJfc2l6ZT0ldVxuIiwKKwkJCSAgICAgZGVzYy0+dmVyc2lvbiwg
bGUzMl90b19jcHUoZGVzYy0+ZmxhZ3MpLCBkZXNjLT5jb21wcmVzc2lvbiwKKwkJCSAgICAgZGVz
Yy0+bnVtX2Zvcm1hdHMsIGRlc2MtPm51bV9jb25uZWN0b3JzLAorCQkJICAgICBsZTMyX3RvX2Nw
dShkZXNjLT5tYXhfYnVmZmVyX3NpemUpKTsKKworCWlmICghZGVzYy0+dmVyc2lvbiB8fCAhZGVz
Yy0+bnVtX2Zvcm1hdHMgfHwgIWRlc2MtPm51bV9jb25uZWN0b3JzIHx8CisJICAgICFkZXNjLT5t
YXhfd2lkdGggfHwgIWRlc2MtPm1heF9oZWlnaHQgfHwKKwkgICAgbGUzMl90b19jcHUoZGVzYy0+
bWluX3dpZHRoKSA+IGxlMzJfdG9fY3B1KGRlc2MtPm1heF93aWR0aCkgfHwKKwkgICAgbGUzMl90
b19jcHUoZGVzYy0+bWluX2hlaWdodCkgPiBsZTMyX3RvX2NwdShkZXNjLT5tYXhfaGVpZ2h0KSkK
KwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBndWRfdXNi
X2dldF9zdGF0dXMoc3RydWN0IHVzYl9kZXZpY2UgKnVzYiwgdTggaWZudW0sIHU4ICpzdGF0dXMp
Cit7CisJdTggKmJ1ZjsKKwlpbnQgcmV0OworCisJYnVmID0ga21hbGxvYyhzaXplb2YoKmJ1Ziks
IEdGUF9LRVJORUwpOworCWlmICghYnVmKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldCA9IGd1
ZF91c2JfY29udHJvbF9tc2codXNiLCBpZm51bSwgdHJ1ZSwgR1VEX1JFUV9HRVRfU1RBVFVTLCAw
LCBidWYsIHNpemVvZigqYnVmKSk7CisJKnN0YXR1cyA9ICpidWY7CisJa2ZyZWUoYnVmKTsKKwor
CXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3N0YXR1c190b19lcnJubyh1OCBzdGF0
dXMpCit7CisJc3dpdGNoIChzdGF0dXMpIHsKKwljYXNlIEdVRF9TVEFUVVNfT0s6CisJCXJldHVy
biAwOworCWNhc2UgR1VEX1NUQVRVU19CVVNZOgorCQlyZXR1cm4gLUVCVVNZOworCWNhc2UgR1VE
X1NUQVRVU19SRVFVRVNUX05PVF9TVVBQT1JURUQ6CisJCXJldHVybiAtRU9QTk9UU1VQUDsKKwlj
YXNlIEdVRF9TVEFUVVNfUFJPVE9DT0xfRVJST1I6CisJCXJldHVybiAtRVBST1RPOworCWNhc2Ug
R1VEX1NUQVRVU19JTlZBTElEX1BBUkFNRVRFUjoKKwkJcmV0dXJuIC1FSU5WQUw7CisJY2FzZSBH
VURfU1RBVFVTX0VSUk9SOgorCQlyZXR1cm4gLUVSRU1PVEVJTzsKKwlkZWZhdWx0OgorCQlyZXR1
cm4gLUVSRU1PVEVJTzsKKwl9Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3VzYl90cmFuc2ZlcihzdHJ1
Y3QgZ3VkX2RldmljZSAqZ2RybSwgYm9vbCBpbiwgdTggcmVxdWVzdCwgdTE2IGluZGV4LAorCQkJ
ICAgIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwlzdHJ1Y3QgdXNiX2RldmljZSAqdXNiID0g
Z3VkX3RvX3VzYl9kZXZpY2UoZ2RybSk7CisJdm9pZCAqdHJidWYgPSBOVUxMOworCWludCBpZHgs
IHJldDsKKworCWRybV9kYmcoJmdkcm0tPmRybSwgIiVzOiByZXF1ZXN0PTB4JXggaW5kZXg9JXUg
bGVuPSV6dVxuIiwKKwkJaW4gPyAiZ2V0IiA6ICJzZXQiLCByZXF1ZXN0LCBpbmRleCwgbGVuKTsK
KworCWlmICghZHJtX2Rldl9lbnRlcigmZ2RybS0+ZHJtLCAmaWR4KSkKKwkJcmV0dXJuIC1FTk9E
RVY7CisKKwltdXRleF9sb2NrKCZnZHJtLT5jdHJsX2xvY2spOworCisJaWYgKGJ1ZikgeworCQlp
ZiAoaW4pCisJCQl0cmJ1ZiA9IGttYWxsb2MobGVuLCBHRlBfS0VSTkVMKTsKKwkJZWxzZQorCQkJ
dHJidWYgPSBrbWVtZHVwKGJ1ZiwgbGVuLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCF0cmJ1Zikgewor
CQkJcmV0ID0gLUVOT01FTTsKKwkJCWdvdG8gdW5sb2NrOworCQl9CisJfQorCisJcmV0ID0gZ3Vk
X3VzYl9jb250cm9sX21zZyh1c2IsIGdkcm0tPmlmbnVtLCBpbiwgcmVxdWVzdCwgaW5kZXgsIHRy
YnVmLCBsZW4pOworCWlmIChyZXQgPT0gLUVQSVBFIHx8ICghcmV0ICYmICFpbiAmJiAoZ2RybS0+
ZmxhZ3MgJiBHVURfRElTUExBWV9GTEFHX1NUQVRVU19PTl9TRVQpKSkgeworCQlib29sIGVycm9y
ID0gcmV0OworCQl1OCBzdGF0dXM7CisKKwkJcmV0ID0gZ3VkX3VzYl9nZXRfc3RhdHVzKHVzYiwg
Z2RybS0+aWZudW0sICZzdGF0dXMpOworCQlpZiAoIXJldCkgeworCQkJaWYgKGVycm9yICYmIHN0
YXR1cyA9PSBHVURfU1RBVFVTX09LKSB7CisJCQkJZGV2X2Vycl9vbmNlKGdkcm0tPmRybS5kZXYs
CisJCQkJCSAgICAgIlVuZXhwZWN0ZWQgc3RhdHVzIE9LIGZvciBmYWlsZWQgdHJhbnNmZXJcbiIp
OworCQkJCXJldCA9IC1FUElQRTsKKwkJCX0gZWxzZSB7CisJCQkJcmV0ID0gZ3VkX3N0YXR1c190
b19lcnJubyhzdGF0dXMpOworCQkJfQorCQl9CisJfQorCisJaWYgKCFyZXQgJiYgaW4gJiYgYnVm
KQorCQltZW1jcHkoYnVmLCB0cmJ1ZiwgbGVuKTsKKworCWlmIChyZXQpIHsKKwkJZHJtX2RiZygm
Z2RybS0+ZHJtLCAicmV0PSVkXG4iLCByZXQpOworCQlnZHJtLT5zdGF0c19udW1fZXJyb3JzKys7
CisJfQorCisJa2ZyZWUodHJidWYpOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmZ2RybS0+Y3Ry
bF9sb2NrKTsKKwlkcm1fZGV2X2V4aXQoaWR4KTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBn
dWRfdXNiX2dldChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTE2IGluZGV4
LCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJcmV0dXJuIGd1ZF91c2JfdHJhbnNmZXIoZ2Ry
bSwgdHJ1ZSwgcmVxdWVzdCwgaW5kZXgsIGJ1ZiwgbGVuKTsKK30KKworaW50IGd1ZF91c2Jfc2V0
KHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1MTYgaW5kZXgsIHZvaWQgKmJ1
Ziwgc2l6ZV90IGxlbikKK3sKKwlyZXR1cm4gZ3VkX3VzYl90cmFuc2ZlcihnZHJtLCBmYWxzZSwg
cmVxdWVzdCwgaW5kZXgsIGJ1ZiwgbGVuKTsKK30KKworaW50IGd1ZF91c2Jfd3JpdGU4KHN0cnVj
dCBndWRfZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1OCB2YWwpCit7CisJcmV0dXJuIGd1ZF91
c2Jfc2V0KGdkcm0sIHJlcXVlc3QsIDAsICZ2YWwsIHNpemVvZih2YWwpKTsKK30KKworc3RhdGlj
IGludCBndWRfc2V0X3ZlcnNpb24oc3RydWN0IHVzYl9kZXZpY2UgKnVzYiwgdTggaWZudW0sIHUz
MiBmbGFncywgdTggdmVyc2lvbikKK3sKKwl1OCAqYnVmOworCWludCByZXQ7CisKKwlidWYgPSBr
bWFsbG9jKHNpemVvZigqYnVmKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFidWYpCisJCXJldHVybiAt
RU5PTUVNOworCisJKmJ1ZiA9IHZlcnNpb247CisJcmV0ID0gZ3VkX3VzYl9jb250cm9sX21zZyh1
c2IsIGlmbnVtLCBmYWxzZSwgR1VEX1JFUV9TRVRfVkVSU0lPTiwgMCwgYnVmLCBzaXplb2YoKmJ1
ZikpOworCWtmcmVlKGJ1Zik7CisJaWYgKHJldCA9PSAtRVBJUEUpCisJCXJldHVybiAtRVBST1RP
Tk9TVVBQT1JUOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAoZmxhZ3MgJiBHVURf
RElTUExBWV9GTEFHX1NUQVRVU19PTl9TRVQpIHsKKwkJdTggc3RhdHVzOworCisJCXJldCA9IGd1
ZF91c2JfZ2V0X3N0YXR1cyh1c2IsIGlmbnVtLCAmc3RhdHVzKTsKKwkJaWYgKCFyZXQgJiYgc3Rh
dHVzICE9IEdVRF9TVEFUVVNfT0spCisJCQlyZXQgPSAtRVBST1RPTk9TVVBQT1JUOworCX0KKwor
CXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2dldF9wcm9wZXJ0aWVzKHN0cnVjdCBn
dWRfZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgbnVtX3Byb3BlcnRpZXMpCit7CisJc3RydWN0
IGd1ZF9wcm9wZXJ0eV9yZXEgKnByb3BlcnRpZXM7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJl
dDsKKworCWlmICghbnVtX3Byb3BlcnRpZXMpCisJCXJldHVybiAwOworCisJZ2RybS0+cHJvcGVy
dGllcyA9IGRybW1fa2NhbGxvYygmZ2RybS0+ZHJtLCBudW1fcHJvcGVydGllcywgc2l6ZW9mKCpn
ZHJtLT5wcm9wZXJ0aWVzKSwKKwkJCQkJR0ZQX0tFUk5FTCk7CisJaWYgKCFnZHJtLT5wcm9wZXJ0
aWVzKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9w
ZXJ0aWVzLCBzaXplb2YoKnByb3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXByb3BlcnRp
ZXMpCisJCXJldHVybiAtRU5PTUVNOworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JF
UV9HRVRfUFJPUEVSVElFUywgMCwKKwkJCSAgcHJvcGVydGllcywgbnVtX3Byb3BlcnRpZXMgKiBz
aXplb2YoKnByb3BlcnRpZXMpKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCWZvciAoaSA9
IDA7IGkgPCBudW1fcHJvcGVydGllczsgaSsrKSB7CisJCXUxNiBwcm9wID0gbGUxNl90b19jcHUo
cHJvcGVydGllc1tpXS5wcm9wKTsKKwkJdTY0IHZhbCA9IGxlNjRfdG9fY3B1KHByb3BlcnRpZXNb
aV0udmFsKTsKKworCQlzd2l0Y2ggKHByb3ApIHsKKwkJY2FzZSBHVURfUFJPUEVSVFlfUk9UQVRJ
T046CisJCQkvKgorCQkJICogRFJNIFVBUEkgbWF0Y2hlcyB0aGUgcHJvdG9jb2wgc28gdXNlIHRo
ZSB2YWx1ZSBkaXJlY3RseSwKKwkJCSAqIGJ1dCBtYXNrIG91dCBhbnkgYWRkaXRpb25zIG9uIGZ1
dHVyZSBkZXZpY2VzLgorCQkJICovCisJCQl2YWwgJj0gR1VEX1JPVEFUSU9OX01BU0s7CisJCQly
ZXQgPSBkcm1fcGxhbmVfY3JlYXRlX3JvdGF0aW9uX3Byb3BlcnR5KCZnZHJtLT5waXBlLnBsYW5l
LAorCQkJCQkJCQkgRFJNX01PREVfUk9UQVRFXzAsIHZhbCk7CisJCQlicmVhazsKKwkJZGVmYXVs
dDoKKwkJCS8qIE5ldyBvbmVzIG1pZ2h0IHNob3cgdXAgaW4gZnV0dXJlIGRldmljZXMsIHNraXAg
dGhvc2Ugd2UgZG9uJ3Qga25vdy4gKi8KKwkJCWRybV9kYmcoJmdkcm0tPmRybSwgIlVua25vd24g
cHJvcGVydHk6ICV1XG4iLCBwcm9wKTsKKwkJCWNvbnRpbnVlOworCQl9CisKKwkJaWYgKHJldCkK
KwkJCWdvdG8gb3V0OworCisJCWdkcm0tPnByb3BlcnRpZXNbZ2RybS0+bnVtX3Byb3BlcnRpZXMr
K10gPSBwcm9wOworCX0KK291dDoKKwlrZnJlZShwcm9wZXJ0aWVzKTsKKworCXJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3N0YXRzX2RlYnVnZnMoc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQoreworCXN0cnVjdCBkcm1faW5mb19ub2RlICpub2RlID0gbS0+cHJpdmF0ZTsK
KwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IHRvX2d1ZF9kZXZpY2Uobm9kZS0+bWlub3ItPmRl
dik7CisJY2hhciBidWZbMTBdOworCisJc3RyaW5nX2dldF9zaXplKGdkcm0tPmJ1bGtfbGVuLCAx
LCBTVFJJTkdfVU5JVFNfMiwgYnVmLCBzaXplb2YoYnVmKSk7CisJc2VxX3ByaW50ZihtLCAiTWF4
IGJ1ZmZlciBzaXplOiAlc1xuIiwgYnVmKTsKKwlzZXFfcHJpbnRmKG0sICJOdW1iZXIgb2YgZXJy
b3JzOiAgJXVcbiIsIGdkcm0tPnN0YXRzX251bV9lcnJvcnMpOworCisJc2VxX3B1dHMobSwgIkNv
bXByZXNzaW9uOiAgICAgICIpOworCWlmIChnZHJtLT5jb21wcmVzc2lvbiAmIEdVRF9DT01QUkVT
U0lPTl9MWjQpCisJCXNlcV9wdXRzKG0sICIgbHo0Iik7CisJc2VxX3B1dHMobSwgIlxuIik7CisK
KwlpZiAoZ2RybS0+Y29tcHJlc3Npb24pIHsKKwkJdTY0IHJlbWFpbmRlcjsKKwkJdTY0IHJhdGlv
ID0gZGl2NjRfdTY0X3JlbShnZHJtLT5zdGF0c19sZW5ndGgsIGdkcm0tPnN0YXRzX2FjdHVhbF9s
ZW5ndGgsCisJCQkJCSAgJnJlbWFpbmRlcik7CisJCXU2NCByYXRpb19mcmFjID0gZGl2NjRfdTY0
KHJlbWFpbmRlciAqIDEwLCBnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoKTsKKworCQlzZXFfcHJp
bnRmKG0sICJDb21wcmVzc2lvbiByYXRpbzogJWxsdS4lbGx1XG4iLCByYXRpbywgcmF0aW9fZnJh
Yyk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2luZm9f
bGlzdCBndWRfZGVidWdmc19saXN0W10gPSB7CisJeyAic3RhdHMiLCBndWRfc3RhdHNfZGVidWdm
cywgMCwgTlVMTCB9LAorfTsKKworc3RhdGljIHZvaWQgZ3VkX2RlYnVnZnNfaW5pdChzdHJ1Y3Qg
ZHJtX21pbm9yICptaW5vcikKK3sKKwlkcm1fZGVidWdmc19jcmVhdGVfZmlsZXMoZ3VkX2RlYnVn
ZnNfbGlzdCwgQVJSQVlfU0laRShndWRfZGVidWdmc19saXN0KSwKKwkJCQkgbWlub3ItPmRlYnVn
ZnNfcm9vdCwgbWlub3IpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9zaW1wbGVfZGlz
cGxheV9waXBlX2Z1bmNzIGd1ZF9waXBlX2Z1bmNzID0geworCS5jaGVjayAgICAgID0gZ3VkX3Bp
cGVfY2hlY2ssCisJLnVwZGF0ZQkgICAgPSBndWRfcGlwZV91cGRhdGUsCisJLnByZXBhcmVfZmIg
PSBkcm1fZ2VtX2ZiX3NpbXBsZV9kaXNwbGF5X3BpcGVfcHJlcGFyZV9mYiwKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGd1ZF9tb2RlX2NvbmZpZ19mdW5j
cyA9IHsKKwkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGVfd2l0aF9kaXJ0eSwKKwkuYXRv
bWljX2NoZWNrID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2ssCisJLmF0b21pY19jb21taXQgPSBk
cm1fYXRvbWljX2hlbHBlcl9jb21taXQsCit9OworCitzdGF0aWMgY29uc3QgdTY0IGd1ZF9waXBl
X21vZGlmaWVyc1tdID0geworCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKKwlEUk1fRk9STUFUX01P
RF9JTlZBTElECit9OworCitERUZJTkVfRFJNX0dFTV9GT1BTKGd1ZF9mb3BzKTsKKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fZHJpdmVyIGd1ZF9kcm1fZHJpdmVyID0geworCS5kcml2ZXJfZmVh
dHVyZXMJPSBEUklWRVJfTU9ERVNFVCB8IERSSVZFUl9HRU0gfCBEUklWRVJfQVRPTUlDLAorCS5m
b3BzCQkJPSAmZ3VkX2ZvcHMsCisJRFJNX0dFTV9TSE1FTV9EUklWRVJfT1BTLAorCS5kZWJ1Z2Zz
X2luaXQJCT0gZ3VkX2RlYnVnZnNfaW5pdCwKKworCS5uYW1lCQkJPSAiZ3VkIiwKKwkuZGVzYwkJ
CT0gIkdlbmVyaWMgVVNCIERpc3BsYXkiLAorCS5kYXRlCQkJPSAiMjAyMDA0MjIiLAorCS5tYWpv
cgkJCT0gMSwKKwkubWlub3IJCQk9IDAsCit9OworCitzdGF0aWMgdm9pZCBndWRfZnJlZV9idWZm
ZXJzX2FuZF9tdXRleChzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLCB2b2lkICp1bnVzZWQpCit7CisJ
c3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGRybSk7CisKKwl2ZnJlZShn
ZHJtLT5jb21wcmVzc19idWYpOworCWtmcmVlKGdkcm0tPmJ1bGtfYnVmKTsKKwltdXRleF9kZXN0
cm95KCZnZHJtLT5jdHJsX2xvY2spOworCW11dGV4X2Rlc3Ryb3koJmdkcm0tPmRhbWFnZV9sb2Nr
KTsKK30KKworc3RhdGljIGludCBndWRfcHJvYmUoc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGVy
ZmFjZSwgY29uc3Qgc3RydWN0IHVzYl9kZXZpY2VfaWQgKmlkKQoreworCXU4IGlmbnVtID0gaW50
ZXJmYWNlLT5jdXJfYWx0c2V0dGluZy0+ZGVzYy5iSW50ZXJmYWNlTnVtYmVyOworCXN0cnVjdCB1
c2JfZGV2aWNlICp1c2IgPSBpbnRlcmZhY2VfdG9fdXNiZGV2KGludGVyZmFjZSk7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJmludGVyZmFjZS0+ZGV2OworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0
X2luZm8gKnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSBOVUxMOworCWJvb2wgcmdiNTY1X3N1
cHBvcnRlZCA9IGZhbHNlLCB4cmdiODg4OF9zdXBwb3J0ZWQgPSBmYWxzZTsKKwlzdHJ1Y3QgdXNi
X2VuZHBvaW50X2Rlc2NyaXB0b3IgKmJ1bGtfb3V0OworCXN0cnVjdCBndWRfZGlzcGxheV9kZXNj
cmlwdG9yX3JlcSBkZXNjOworCXVuc2lnbmVkIGludCBudW1fZm9ybWF0cyA9IDA7CisJc3RydWN0
IGd1ZF9kZXZpY2UgKmdkcm07CisJc2l6ZV90IG1heF9idWZmZXJfc2l6ZSA9IDA7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRybTsKKwl1OCAqZm9ybWF0c19kZXY7CisJdTMyICpmb3JtYXRzOworCWlu
dCByZXQsIGk7CisKKwlyZXQgPSB1c2JfZmluZF9idWxrX291dF9lbmRwb2ludChpbnRlcmZhY2Ut
PmN1cl9hbHRzZXR0aW5nLCAmYnVsa19vdXQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisK
KwlyZXQgPSBndWRfZ2V0X2Rpc3BsYXlfZGVzY3JpcHRvcihpbnRlcmZhY2UsICZkZXNjKTsKKwlp
ZiAocmV0KSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIk5vdCBhIGRpc3BsYXkgaW50
ZXJmYWNlOiByZXQ9JWRcbiIsIHJldCk7CisJCXJldHVybiAtRU5PREVWOworCX0KKworCWlmIChk
ZXNjLnZlcnNpb24gPiAxKSB7CisJCXJldCA9IGd1ZF9zZXRfdmVyc2lvbih1c2IsIGlmbnVtLCBs
ZTMyX3RvX2NwdShkZXNjLmZsYWdzKSwgMSk7CisJCWlmIChyZXQpIHsKKwkJCWlmIChyZXQgPT0g
LUVQUk9UT05PU1VQUE9SVCkKKwkJCQlkZXZfZXJyKGRldiwgIlByb3RvY29sIHZlcnNpb24gJXUg
aXMgbm90IHN1cHBvcnRlZFxuIiwKKwkJCQkJZGVzYy52ZXJzaW9uKTsKKwkJCXJldHVybiByZXQ7
CisJCX0KKwl9CisKKwlyZXQgPSBkbWFfY29lcmNlX21hc2tfYW5kX2NvaGVyZW50KGRldiwgRE1B
X0JJVF9NQVNLKDY0KSk7CisJaWYgKHJldCkKKwkJZGV2X3dhcm4oZGV2LCAiRmFpbGVkIHRvIHNl
dCBETUEgbWFza1xuIik7CisKKwlnZHJtID0gZGV2bV9kcm1fZGV2X2FsbG9jKGRldiwgJmd1ZF9k
cm1fZHJpdmVyLCBzdHJ1Y3QgZ3VkX2RldmljZSwgZHJtKTsKKwlpZiAoSVNfRVJSKGdkcm0pKQor
CQlyZXR1cm4gUFRSX0VSUihnZHJtKTsKKworCWRybSA9ICZnZHJtLT5kcm07CisJZHJtLT5tb2Rl
X2NvbmZpZy5mdW5jcyA9ICZndWRfbW9kZV9jb25maWdfZnVuY3M7CisJcmV0ID0gZHJtbV9tb2Rl
X2NvbmZpZ19pbml0KGRybSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWdkcm0tPmlm
bnVtID0gaWZudW07CisJZ2RybS0+ZmxhZ3MgPSBsZTMyX3RvX2NwdShkZXNjLmZsYWdzKTsKKwln
ZHJtLT5jb21wcmVzc2lvbiA9IGRlc2MuY29tcHJlc3Npb24gJiBHVURfQ09NUFJFU1NJT05fTFo0
OworCisJaWYgKGdkcm0tPmZsYWdzICYgR1VEX0RJU1BMQVlfRkxBR19GVUxMX1VQREFURSAmJiBn
ZHJtLT5jb21wcmVzc2lvbikKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwltdXRleF9pbml0KCZnZHJt
LT5jdHJsX2xvY2spOworCW11dGV4X2luaXQoJmdkcm0tPmRhbWFnZV9sb2NrKTsKKwlJTklUX1dP
UksoJmdkcm0tPndvcmssIGd1ZF9mbHVzaF93b3JrKTsKKwlndWRfY2xlYXJfZGFtYWdlKGdkcm0p
OworCisJcmV0ID0gZHJtbV9hZGRfYWN0aW9uX29yX3Jlc2V0KGRybSwgZ3VkX2ZyZWVfYnVmZmVy
c19hbmRfbXV0ZXgsIE5VTEwpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm0tPm1v
ZGVfY29uZmlnLm1pbl93aWR0aCA9IGxlMzJfdG9fY3B1KGRlc2MubWluX3dpZHRoKTsKKwlkcm0t
Pm1vZGVfY29uZmlnLm1heF93aWR0aCA9IGxlMzJfdG9fY3B1KGRlc2MubWF4X3dpZHRoKTsKKwlk
cm0tPm1vZGVfY29uZmlnLm1pbl9oZWlnaHQgPSBsZTMyX3RvX2NwdShkZXNjLm1pbl9oZWlnaHQp
OworCWRybS0+bW9kZV9jb25maWcubWF4X2hlaWdodCA9IGxlMzJfdG9fY3B1KGRlc2MubWF4X2hl
aWdodCk7CisKKwlmb3JtYXRzX2RldiA9IGRldm1fa21hbGxvYyhkZXYsIGRlc2MubnVtX2Zvcm1h
dHMsIEdGUF9LRVJORUwpOworCS8qIEFkZCByb29tIGZvciBlbXVsYXRlZCBYUkdCODg4OCAqLwor
CWZvcm1hdHMgPSBkZXZtX2ttYWxsb2NfYXJyYXkoZGV2LCBkZXNjLm51bV9mb3JtYXRzICsgMSwg
c2l6ZW9mKCpmb3JtYXRzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFmb3JtYXRzX2RldiB8fCAhZm9y
bWF0cykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2dldChnZHJtLCBHVURf
UkVRX0dFVF9GT1JNQVRTLCAwLCBmb3JtYXRzX2RldiwgZGVzYy5udW1fZm9ybWF0cyk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7IGkgPCBkZXNjLm51bV9mb3JtYXRz
OyBpKyspIHsKKwkJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbzsKKwkJc2l6ZV90
IGZtdF9idWZfc2l6ZTsKKwkJdTMyIGZvcm1hdDsKKworCQlmb3JtYXQgPSBndWRfdG9fZm91cmNj
KGZvcm1hdHNfZGV2W2ldKTsKKwkJaWYgKCFmb3JtYXQpIHsKKwkJCWRybV9kYmcoZHJtLCAiVW5z
dXBwb3J0ZWQgZm9ybWF0OiAweCUwMnhcbiIsIGZvcm1hdHNfZGV2W2ldKTsKKwkJCWNvbnRpbnVl
OworCQl9CisKKwkJaWYgKGZvcm1hdCA9PSBHVURfRFJNX0ZPUk1BVF9SMSkKKwkJCWluZm8gPSAm
Z3VkX2RybV9mb3JtYXRfcjE7CisJCWVsc2UKKwkJCWluZm8gPSBkcm1fZm9ybWF0X2luZm8oZm9y
bWF0KTsKKworCQlzd2l0Y2ggKGZvcm1hdCkgeworCQljYXNlIEdVRF9EUk1fRk9STUFUX1IxOgor
CQkJeHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCA9IGluZm87CisJCQlicmVhazsKKwkJY2FzZSBE
Uk1fRk9STUFUX1JHQjU2NToKKwkJCXJnYjU2NV9zdXBwb3J0ZWQgPSB0cnVlOworCQkJaWYgKCF4
cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KQorCQkJCXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQg
PSBpbmZvOworCQkJYnJlYWs7CisJCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwkJCXhyZ2I4
ODg4X3N1cHBvcnRlZCA9IHRydWU7CisJCQlicmVhazsKKwkJfTsKKworCQlmbXRfYnVmX3NpemUg
PSBkcm1fZm9ybWF0X2luZm9fbWluX3BpdGNoKGluZm8sIDAsIGRybS0+bW9kZV9jb25maWcubWF4
X3dpZHRoKSAqCisJCQkgICAgICAgZHJtLT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0OworCQltYXhf
YnVmZmVyX3NpemUgPSBtYXgobWF4X2J1ZmZlcl9zaXplLCBmbXRfYnVmX3NpemUpOworCisJCWlm
IChmb3JtYXQgPT0gR1VEX0RSTV9GT1JNQVRfUjEpCisJCQljb250aW51ZTsgLyogSW50ZXJuYWwg
bm90IGZvciB1c2Vyc3BhY2UgKi8KKworCQlmb3JtYXRzW251bV9mb3JtYXRzKytdID0gZm9ybWF0
OworCX0KKworCWlmICghbnVtX2Zvcm1hdHMgJiYgIXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQp
IHsKKwkJZGV2X2VycihkZXYsICJObyBzdXBwb3J0ZWQgcGl4ZWwgZm9ybWF0cyBmb3VuZFxuIik7
CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCS8qIFByZWZlciBzcGVlZCBvdmVyIGNvbG9yIGRl
cHRoICovCisJaWYgKHJnYjU2NV9zdXBwb3J0ZWQpCisJCWRybS0+bW9kZV9jb25maWcucHJlZmVy
cmVkX2RlcHRoID0gMTY7CisKKwlpZiAoIXhyZ2I4ODg4X3N1cHBvcnRlZCAmJiB4cmdiODg4OF9l
bXVsYXRpb25fZm9ybWF0KSB7CisJCWdkcm0tPnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSB4
cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0OworCQlmb3JtYXRzW251bV9mb3JtYXRzKytdID0gRFJN
X0ZPUk1BVF9YUkdCODg4ODsKKwl9CisKKwlpZiAoZGVzYy5tYXhfYnVmZmVyX3NpemUpCisJCW1h
eF9idWZmZXJfc2l6ZSA9IGxlMzJfdG9fY3B1KGRlc2MubWF4X2J1ZmZlcl9zaXplKTsKK3JldHJ5
OgorCS8qCisJICogVXNlIHBsYWluIGttYWxsb2MgaGVyZSBzaW5jZSBkZXZtX2ttYWxsb2MoKSBw
bGFjZXMgc3RydWN0IGRldnJlcyBhdCB0aGUgYmVnaW5uaW5nCisJICogb2YgdGhlIGJ1ZmZlciBp
dCBhbGxvY2F0ZXMuIFRoaXMgd2FzdGVzIGEgbG90IG9mIG1lbW9yeSB3aGVuIGFsbG9jYXRpbmcg
YmlnIGJ1ZmZlcnMuCisJICogQXNraW5nIGZvciAyTSB3b3VsZCBhY3R1YWxseSBhbGxvY2F0ZSA0
TS4gVGhpcyB3b3VsZCBhbHNvIHByZXZlbnQgZ2V0dGluZyB0aGUgYmlnZ2VzdAorCSAqIHBvc3Np
YmxlIGJ1ZmZlciBwb3RlbnRpYWxseSBsZWFkaW5nIHRvIHNwbGl0IHRyYW5zZmVycy4KKwkgKi8K
KwlnZHJtLT5idWxrX2J1ZiA9IGttYWxsb2MobWF4X2J1ZmZlcl9zaXplLCBHRlBfS0VSTkVMIHwg
X19HRlBfTk9XQVJOKTsKKwlpZiAoIWdkcm0tPmJ1bGtfYnVmKSB7CisJCW1heF9idWZmZXJfc2l6
ZSA9IHJvdW5kdXBfcG93X29mX3R3byhtYXhfYnVmZmVyX3NpemUpIC8gMjsKKwkJaWYgKG1heF9i
dWZmZXJfc2l6ZSA8IFNaXzUxMkspCisJCQlyZXR1cm4gLUVOT01FTTsKKwkJZ290byByZXRyeTsK
Kwl9CisKKwlnZHJtLT5idWxrX3BpcGUgPSB1c2Jfc25kYnVsa3BpcGUodXNiLCB1c2JfZW5kcG9p
bnRfbnVtKGJ1bGtfb3V0KSk7CisJZ2RybS0+YnVsa19sZW4gPSBtYXhfYnVmZmVyX3NpemU7CisK
KwlpZiAoZ2RybS0+Y29tcHJlc3Npb24gJiBHVURfQ09NUFJFU1NJT05fTFo0KSB7CisJCWdkcm0t
Pmx6NF9jb21wX21lbSA9IGRldm1fa21hbGxvYyhkZXYsIExaNF9NRU1fQ09NUFJFU1MsIEdGUF9L
RVJORUwpOworCQlpZiAoIWdkcm0tPmx6NF9jb21wX21lbSkKKwkJCXJldHVybiAtRU5PTUVNOwor
CisJCWdkcm0tPmNvbXByZXNzX2J1ZiA9IHZtYWxsb2MoZ2RybS0+YnVsa19sZW4pOworCQlpZiAo
IWdkcm0tPmNvbXByZXNzX2J1ZikKKwkJCXJldHVybiAtRU5PTUVNOworCX0KKworCXJldCA9IGRy
bV9zaW1wbGVfZGlzcGxheV9waXBlX2luaXQoZHJtLCAmZ2RybS0+cGlwZSwgJmd1ZF9waXBlX2Z1
bmNzLAorCQkJCQkgICBmb3JtYXRzLCBudW1fZm9ybWF0cywKKwkJCQkJICAgZ3VkX3BpcGVfbW9k
aWZpZXJzLCBOVUxMKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZGV2bV9rZnJlZShk
ZXYsIGZvcm1hdHMpOworCWRldm1fa2ZyZWUoZGV2LCBmb3JtYXRzX2Rldik7CisKKwlyZXQgPSBn
dWRfZ2V0X3Byb3BlcnRpZXMoZ2RybSwgZGVzYy5udW1fcHJvcGVydGllcyk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCWRybV9wbGFuZV9lbmFibGVfZmJfZGFtYWdlX2NsaXBzKCZnZHJt
LT5waXBlLnBsYW5lKTsKKworCWZvciAoaSA9IDA7IGkgPCBkZXNjLm51bV9jb25uZWN0b3JzOyBp
KyspIHsKKwkJcmV0ID0gZ3VkX2Nvbm5lY3Rvcl9jcmVhdGUoZ2RybSwgaSk7CisJCWlmIChyZXQp
CisJCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9tb2RlX2NvbmZpZ19yZXNldChkcm0pOworCisJ
dXNiX3NldF9pbnRmZGF0YShpbnRlcmZhY2UsIGdkcm0pOworCisJcmV0ID0gZHJtX2Rldl9yZWdp
c3Rlcihkcm0sIDApOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm1fa21zX2hlbHBl
cl9wb2xsX2luaXQoZHJtKTsKKworCWRybV9mYmRldl9nZW5lcmljX3NldHVwKGRybSwgMCk7CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgZ3VkX2Rpc2Nvbm5lY3Qoc3RydWN0IHVzYl9p
bnRlcmZhY2UgKmludGVyZmFjZSkKK3sKKwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IHVzYl9n
ZXRfaW50ZmRhdGEoaW50ZXJmYWNlKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gJmdkcm0t
PmRybTsKKworCWRybV9kYmcoZHJtLCAiJXM6XG4iLCBfX2Z1bmNfXyk7CisKKwlkcm1fa21zX2hl
bHBlcl9wb2xsX2ZpbmkoZHJtKTsKKwlkcm1fZGV2X3VucGx1Zyhkcm0pOworCWRybV9hdG9taWNf
aGVscGVyX3NodXRkb3duKGRybSk7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3N1c3BlbmQoc3RydWN0
IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSwgcG1fbWVzc2FnZV90IG1lc3NhZ2UpCit7CisJc3Ry
dWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVyZmFjZSk7CisKKwly
ZXR1cm4gZHJtX21vZGVfY29uZmlnX2hlbHBlcl9zdXNwZW5kKCZnZHJtLT5kcm0pOworfQorCitz
dGF0aWMgaW50IGd1ZF9yZXN1bWUoc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSkKK3sK
KwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IHVzYl9nZXRfaW50ZmRhdGEoaW50ZXJmYWNlKTsK
KworCWRybV9tb2RlX2NvbmZpZ19oZWxwZXJfcmVzdW1lKCZnZHJtLT5kcm0pOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdXNiX2RldmljZV9pZCBndWRfaWRfdGFibGVb
XSA9IHsKKwl7IFVTQl9ERVZJQ0VfSU5URVJGQUNFX0NMQVNTKDB4MWQ1MCwgMHg2MTRkLCBVU0Jf
Q0xBU1NfVkVORE9SX1NQRUMpIH0sCisJeyB9Cit9OworCitNT0RVTEVfREVWSUNFX1RBQkxFKHVz
YiwgZ3VkX2lkX3RhYmxlKTsKKworc3RhdGljIHN0cnVjdCB1c2JfZHJpdmVyIGd1ZF91c2JfZHJp
dmVyID0geworCS5uYW1lCQk9ICJndWQiLAorCS5wcm9iZQkJPSBndWRfcHJvYmUsCisJLmRpc2Nv
bm5lY3QJPSBndWRfZGlzY29ubmVjdCwKKwkuaWRfdGFibGUJPSBndWRfaWRfdGFibGUsCisJLnN1
c3BlbmQJPSBndWRfc3VzcGVuZCwKKwkucmVzdW1lCQk9IGd1ZF9yZXN1bWUsCisJLnJlc2V0X3Jl
c3VtZQk9IGd1ZF9yZXN1bWUsCit9OworCittb2R1bGVfdXNiX2RyaXZlcihndWRfdXNiX2RyaXZl
cik7CisKK01PRFVMRV9BVVRIT1IoIk5vcmFsZiBUcsO4bm5lcyIpOworTU9EVUxFX0xJQ0VOU0Uo
IkR1YWwgTUlUL0dQTCIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfaW50
ZXJuYWwuaCBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2ludGVybmFsLmgKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi40NWNiMmI2ZDViZDMKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9pbnRlcm5hbC5oCkBAIC0wLDAgKzEsMTQ5IEBA
CisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisKKyNpZm5kZWYgX19MSU5VWF9H
VURfSU5URVJOQUxfSAorI2RlZmluZSBfX0xJTlVYX0dVRF9JTlRFUk5BTF9ICisKKyNpbmNsdWRl
IDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvbXV0ZXguaD4KKyNpbmNsdWRlIDxsaW51
eC91c2IuaD4KKyNpbmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKyNpbmNsdWRlIDx1YXBpL2Ry
bS9kcm1fZm91cmNjLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9zaW1wbGVfa21zX2hlbHBlci5oPgorCitzdHJ1Y3QgZ3VkX2RldmljZSB7CisJc3Ry
dWN0IGRybV9kZXZpY2UgZHJtOworCXN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSBwaXBl
OworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXU4IGlmbnVtOworCXUzMiBmbGFnczsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICp4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0Owor
CisJdTE2ICpwcm9wZXJ0aWVzOworCXVuc2lnbmVkIGludCBudW1fcHJvcGVydGllczsKKworCXVu
c2lnbmVkIGludCBidWxrX3BpcGU7CisJdm9pZCAqYnVsa19idWY7CisJc2l6ZV90IGJ1bGtfbGVu
OworCisJdTggY29tcHJlc3Npb247CisJdm9pZCAqbHo0X2NvbXBfbWVtOworCXZvaWQgKmNvbXBy
ZXNzX2J1ZjsKKworCXU2NCBzdGF0c19sZW5ndGg7CisJdTY0IHN0YXRzX2FjdHVhbF9sZW5ndGg7
CisJdW5zaWduZWQgaW50IHN0YXRzX251bV9lcnJvcnM7CisKKwlzdHJ1Y3QgbXV0ZXggY3RybF9s
b2NrOyAvKiBTZXJpYWxpemUgZ2V0L3NldCBhbmQgc3RhdHVzIHRyYW5zZmVycyAqLworCisJc3Ry
dWN0IG11dGV4IGRhbWFnZV9sb2NrOyAvKiBQcm90ZWN0cyB0aGUgZm9sbG93aW5nIG1lbWJlcnM6
ICovCisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGRybV9yZWN0IGRhbWFn
ZTsKKwlib29sIHByZXZfZmx1c2hfZmFpbGVkOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3Qg
Z3VkX2RldmljZSAqdG9fZ3VkX2RldmljZShzdHJ1Y3QgZHJtX2RldmljZSAqZHJtKQoreworCXJl
dHVybiBjb250YWluZXJfb2YoZHJtLCBzdHJ1Y3QgZ3VkX2RldmljZSwgZHJtKTsKK30KKworc3Rh
dGljIGlubGluZSBzdHJ1Y3QgdXNiX2RldmljZSAqZ3VkX3RvX3VzYl9kZXZpY2Uoc3RydWN0IGd1
ZF9kZXZpY2UgKmdkcm0pCit7CisJcmV0dXJuIGludGVyZmFjZV90b191c2JkZXYodG9fdXNiX2lu
dGVyZmFjZShnZHJtLT5kcm0uZGV2KSk7Cit9CisKK2ludCBndWRfdXNiX2dldChzdHJ1Y3QgZ3Vk
X2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTE2IGluZGV4LCB2b2lkICpidWYsIHNpemVfdCBs
ZW4pOworaW50IGd1ZF91c2Jfc2V0KHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0
LCB1MTYgaW5kZXgsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbik7CitpbnQgZ3VkX3VzYl93cml0ZTgo
c3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHU4IHZhbCk7CisKK3ZvaWQgZ3Vk
X2NsZWFyX2RhbWFnZShzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSk7Cit2b2lkIGd1ZF9mbHVzaF93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yayk7CitpbnQgZ3VkX3BpcGVfY2hlY2soc3RydWN0
IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0
YXRlICpuZXdfcGxhbmVfc3RhdGUsCisJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUpOwordm9pZCBndWRfcGlwZV91cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxh
eV9waXBlICpwaXBlLAorCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSk7
CitpbnQgZ3VkX2Nvbm5lY3Rvcl9maWxsX3Byb3BlcnRpZXMoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKKwkJCQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jf
c3RhdGUsCisJCQkJICBzdHJ1Y3QgZ3VkX3Byb3BlcnR5X3JlcSAqcHJvcGVydGllcyk7CitpbnQg
Z3VkX2Nvbm5lY3Rvcl9jcmVhdGUoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHVuc2lnbmVkIGlu
dCBpbmRleCk7CisKKy8qIERyaXZlciBpbnRlcm5hbCBmb3VyY2MgZm9yIDEtYml0IG1vbm9jaHJv
bWUgKi8KKyNkZWZpbmUgR1VEX0RSTV9GT1JNQVRfUjEJMHgwMDAwMDEyMgorCitzdGF0aWMgaW5s
aW5lIHU4IGd1ZF9mcm9tX2ZvdXJjYyh1MzIgZm91cmNjKQoreworCXN3aXRjaCAoZm91cmNjKSB7
CisJY2FzZSBHVURfRFJNX0ZPUk1BVF9SMToKKwkJcmV0dXJuIEdVRF9QSVhFTF9GT1JNQVRfUjE7
CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJcmV0dXJuIEdVRF9QSVhFTF9GT1JNQVRfUkdC
NTY1OworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwkJcmV0dXJuIEdVRF9QSVhFTF9GT1JN
QVRfWFJHQjg4ODg7CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgorCQlyZXR1cm4gR1VEX1BJ
WEVMX0ZPUk1BVF9BUkdCODg4ODsKKwl9OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbmxp
bmUgdTMyIGd1ZF90b19mb3VyY2ModTggZm9ybWF0KQoreworCXN3aXRjaCAoZm9ybWF0KSB7CisJ
Y2FzZSBHVURfUElYRUxfRk9STUFUX1IxOgorCQlyZXR1cm4gR1VEX0RSTV9GT1JNQVRfUjE7CisJ
Y2FzZSBHVURfUElYRUxfRk9STUFUX1JHQjU2NToKKwkJcmV0dXJuIERSTV9GT1JNQVRfUkdCNTY1
OworCWNhc2UgR1VEX1BJWEVMX0ZPUk1BVF9YUkdCODg4ODoKKwkJcmV0dXJuIERSTV9GT1JNQVRf
WFJHQjg4ODg7CisJY2FzZSBHVURfUElYRUxfRk9STUFUX0FSR0I4ODg4OgorCQlyZXR1cm4gRFJN
X0ZPUk1BVF9BUkdCODg4ODsKKwl9OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbmxpbmUg
dm9pZCBndWRfZnJvbV9kaXNwbGF5X21vZGUoc3RydWN0IGd1ZF9kaXNwbGF5X21vZGVfcmVxICpk
c3QsCisJCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqc3JjKQoreworCXUzMiBm
bGFncyA9IHNyYy0+ZmxhZ3MgJiBHVURfRElTUExBWV9NT0RFX0ZMQUdfVVNFUl9NQVNLOworCisJ
aWYgKHNyYy0+dHlwZSAmIERSTV9NT0RFX1RZUEVfUFJFRkVSUkVEKQorCQlmbGFncyB8PSBHVURf
RElTUExBWV9NT0RFX0ZMQUdfUFJFRkVSUkVEOworCisJZHN0LT5jbG9jayA9IGNwdV90b19sZTMy
KHNyYy0+Y2xvY2spOworCWRzdC0+aGRpc3BsYXkgPSBjcHVfdG9fbGUxNihzcmMtPmhkaXNwbGF5
KTsKKwlkc3QtPmhzeW5jX3N0YXJ0ID0gY3B1X3RvX2xlMTYoc3JjLT5oc3luY19zdGFydCk7CisJ
ZHN0LT5oc3luY19lbmQgPSBjcHVfdG9fbGUxNihzcmMtPmhzeW5jX2VuZCk7CisJZHN0LT5odG90
YWwgPSBjcHVfdG9fbGUxNihzcmMtPmh0b3RhbCk7CisJZHN0LT52ZGlzcGxheSA9IGNwdV90b19s
ZTE2KHNyYy0+dmRpc3BsYXkpOworCWRzdC0+dnN5bmNfc3RhcnQgPSBjcHVfdG9fbGUxNihzcmMt
PnZzeW5jX3N0YXJ0KTsKKwlkc3QtPnZzeW5jX2VuZCA9IGNwdV90b19sZTE2KHNyYy0+dnN5bmNf
ZW5kKTsKKwlkc3QtPnZ0b3RhbCA9IGNwdV90b19sZTE2KHNyYy0+dnRvdGFsKTsKKwlkc3QtPmZs
YWdzID0gY3B1X3RvX2xlMzIoZmxhZ3MpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZ3VkX3Rv
X2Rpc3BsYXlfbW9kZShzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZHN0LAorCQkJCSAgICAgICBj
b25zdCBzdHJ1Y3QgZ3VkX2Rpc3BsYXlfbW9kZV9yZXEgKnNyYykKK3sKKwl1MzIgZmxhZ3MgPSBs
ZTMyX3RvX2NwdShzcmMtPmZsYWdzKTsKKworCW1lbXNldChkc3QsIDAsIHNpemVvZigqZHN0KSk7
CisJZHN0LT5jbG9jayA9IGxlMzJfdG9fY3B1KHNyYy0+Y2xvY2spOworCWRzdC0+aGRpc3BsYXkg
PSBsZTE2X3RvX2NwdShzcmMtPmhkaXNwbGF5KTsKKwlkc3QtPmhzeW5jX3N0YXJ0ID0gbGUxNl90
b19jcHUoc3JjLT5oc3luY19zdGFydCk7CisJZHN0LT5oc3luY19lbmQgPSBsZTE2X3RvX2NwdShz
cmMtPmhzeW5jX2VuZCk7CisJZHN0LT5odG90YWwgPSBsZTE2X3RvX2NwdShzcmMtPmh0b3RhbCk7
CisJZHN0LT52ZGlzcGxheSA9IGxlMTZfdG9fY3B1KHNyYy0+dmRpc3BsYXkpOworCWRzdC0+dnN5
bmNfc3RhcnQgPSBsZTE2X3RvX2NwdShzcmMtPnZzeW5jX3N0YXJ0KTsKKwlkc3QtPnZzeW5jX2Vu
ZCA9IGxlMTZfdG9fY3B1KHNyYy0+dnN5bmNfZW5kKTsKKwlkc3QtPnZ0b3RhbCA9IGxlMTZfdG9f
Y3B1KHNyYy0+dnRvdGFsKTsKKwlkc3QtPmZsYWdzID0gZmxhZ3MgJiBHVURfRElTUExBWV9NT0RF
X0ZMQUdfVVNFUl9NQVNLOworCWRzdC0+dHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVSOworCWlm
IChmbGFncyAmIEdVRF9ESVNQTEFZX01PREVfRkxBR19QUkVGRVJSRUQpCisJCWRzdC0+dHlwZSB8
PSBEUk1fTU9ERV9UWVBFX1BSRUZFUlJFRDsKKwlkcm1fbW9kZV9zZXRfbmFtZShkc3QpOworfQor
CisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX3BpcGUuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9ndWQvZ3VkX3BpcGUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjQ3OGI4OGU2OWFkMwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9ndWQvZ3VkX3BpcGUuYwpAQCAtMCwwICsxLDQ3NSBAQAorLy8gU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICov
CisKKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvbHo0Lmg+Cisj
aW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CisKKyNp
bmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fY29ubmVjdG9yLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9k
cnYuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Zvcm1hdF9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZnJhbWVidWZmZXIuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9yZWN0Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9zaW1wbGVfa21z
X2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9ndWQuaD4KKworI2luY2x1ZGUgImd1ZF9pbnRlcm5h
bC5oIgorCitzdGF0aWMgYm9vbCBndWRfaXNfYmlnX2VuZGlhbih2b2lkKQoreworI2lmIGRlZmlu
ZWQoX19CSUdfRU5ESUFOKQorCXJldHVybiB0cnVlOworI2Vsc2UKKwlyZXR1cm4gZmFsc2U7Cisj
ZW5kaWYKK30KKworc3RhdGljIHNpemVfdCBndWRfeHJnYjg4ODhfdG9fcjEyNCh1OCAqZHN0LCBj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsCisJCQkJICAgdm9pZCAqc3JjLCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgICBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3Qp
Cit7CisJdW5zaWduZWQgaW50IGJsb2NrX3dpZHRoID0gZHJtX2Zvcm1hdF9pbmZvX2Jsb2NrX3dp
ZHRoKGZvcm1hdCwgMCk7CisJdW5zaWduZWQgaW50IGJpdHNfcGVyX3BpeGVsID0gOCAvIGJsb2Nr
X3dpZHRoOworCXVuc2lnbmVkIGludCB4LCB5LCB3aWR0aCwgaGVpZ2h0OworCXU4ICpwLCAqYmxv
Y2sgPSBkc3Q7IC8qIEFzc2lnbiB0byBzaWxlbmNlIGNvbXBpbGVyIHdhcm5pbmcgKi8KKwlzaXpl
X3QgbGVuOworCXZvaWQgKmJ1ZjsKKworCVdBUk5fT05fT05DRShmb3JtYXQtPmNoYXJfcGVyX2Js
b2NrWzBdICE9IDEpOworCisJLyogU3RhcnQgb24gYSBieXRlIGJvdW5kYXJ5ICovCisJcmVjdC0+
eDEgPSBBTElHTl9ET1dOKHJlY3QtPngxLCBibG9ja193aWR0aCk7CisJd2lkdGggPSBkcm1fcmVj
dF93aWR0aChyZWN0KTsKKwloZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQocmVjdCk7CisJbGVuID0g
ZHJtX2Zvcm1hdF9pbmZvX21pbl9waXRjaChmb3JtYXQsIDAsIHdpZHRoKSAqIGhlaWdodDsKKwor
CWJ1ZiA9IGttYWxsb2Mod2lkdGggKiBoZWlnaHQsIEdGUF9LRVJORUwpOworCWlmICghYnVmKQor
CQlyZXR1cm4gMDsKKworCWRybV9mYl94cmdiODg4OF90b19ncmF5OChidWYsIHNyYywgZmIsIHJl
Y3QpOworCisJcCA9IGJ1ZjsKKwlmb3IgKHkgPSAwOyB5IDwgZHJtX3JlY3RfaGVpZ2h0KHJlY3Qp
OyB5KyspIHsKKwkJZm9yICh4ID0gMDsgeCA8IGRybV9yZWN0X3dpZHRoKHJlY3QpOyB4KyspIHsK
KwkJCWlmICghKHggJSBibG9ja193aWR0aCkpIHsKKwkJCQlibG9jayA9IGRzdCsrOworCQkJCSpi
bG9jayA9IDA7CisJCQl9CisKKwkJCSpibG9jayA8PD0gYml0c19wZXJfcGl4ZWw7CisJCQkqYmxv
Y2sgfD0gKCpwKyspID4+ICg4IC0gYml0c19wZXJfcGl4ZWwpOworCQl9CisJfQorCisJa2ZyZWUo
YnVmKTsKKworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3ByZXBfZmx1c2goc3Ry
dWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICBj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsIHN0cnVjdCBkcm1fcmVjdCAqcmVj
dCwKKwkJCSAgc3RydWN0IGd1ZF9zZXRfYnVmZmVyX3JlcSAqcmVxKQoreworCXN0cnVjdCBkbWFf
YnVmX2F0dGFjaG1lbnQgKmltcG9ydF9hdHRhY2ggPSBmYi0+b2JqWzBdLT5pbXBvcnRfYXR0YWNo
OworCXU4IGNvbXByZXNzaW9uID0gZ2RybS0+Y29tcHJlc3Npb247CisJc3RydWN0IGRtYV9idWZf
bWFwIG1hcDsKKwl2b2lkICp2YWRkciwgKmJ1ZjsKKwlzaXplX3QgcGl0Y2gsIGxlbjsKKwlpbnQg
cmV0ID0gMDsKKworCXBpdGNoID0gZHJtX2Zvcm1hdF9pbmZvX21pbl9waXRjaChmb3JtYXQsIDAs
IGRybV9yZWN0X3dpZHRoKHJlY3QpKTsKKwlsZW4gPSBwaXRjaCAqIGRybV9yZWN0X2hlaWdodChy
ZWN0KTsKKwlpZiAobGVuID4gZ2RybS0+YnVsa19sZW4pCisJCXJldHVybiAtRTJCSUc7CisKKwly
ZXQgPSBkcm1fZ2VtX3NobWVtX3ZtYXAoZmItPm9ialswXSwgJm1hcCk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKKworCXZhZGRyID0gbWFwLnZhZGRyICsgZmItPm9mZnNldHNbMF07CisKKwlp
ZiAoaW1wb3J0X2F0dGFjaCkgeworCQlyZXQgPSBkbWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3MoaW1w
b3J0X2F0dGFjaC0+ZG1hYnVmLCBETUFfRlJPTV9ERVZJQ0UpOworCQlpZiAocmV0KQorCQkJZ290
byB2dW5tYXA7CisJfQorcmV0cnk6CisJaWYgKGNvbXByZXNzaW9uKQorCQlidWYgPSBnZHJtLT5j
b21wcmVzc19idWY7CisJZWxzZQorCQlidWYgPSBnZHJtLT5idWxrX2J1ZjsKKworCS8qCisJICog
SW1wb3J0ZWQgYnVmZmVycyBhcmUgYXNzdW1lZCB0byBiZSB3cml0ZS1jb21iaW5lZCBhbmQgdGh1
cyB1bmNhY2hlZAorCSAqIHdpdGggc2xvdyByZWFkcyAoYXQgbGVhc3Qgb24gQVJNKS4KKwkgKi8K
KwlpZiAoZm9ybWF0ICE9IGZiLT5mb3JtYXQpIHsKKwkJaWYgKGZvcm1hdC0+Zm9ybWF0ID09IEdV
RF9EUk1fRk9STUFUX1IxKSB7CisJCQlsZW4gPSBndWRfeHJnYjg4ODhfdG9fcjEyNChidWYsIGZv
cm1hdCwgdmFkZHIsIGZiLCByZWN0KTsKKwkJCWlmICghbGVuKSB7CisJCQkJcmV0ID0gLUVOT01F
TTsKKwkJCQlnb3RvIGVuZF9jcHVfYWNjZXNzOworCQkJfQorCQl9IGVsc2UgaWYgKGZvcm1hdC0+
Zm9ybWF0ID09IERSTV9GT1JNQVRfUkdCNTY1KSB7CisJCQlkcm1fZmJfeHJnYjg4ODhfdG9fcmdi
NTY1KGJ1ZiwgdmFkZHIsIGZiLCByZWN0LCBndWRfaXNfYmlnX2VuZGlhbigpKTsKKwkJfQorCX0g
ZWxzZSBpZiAoZ3VkX2lzX2JpZ19lbmRpYW4oKSAmJiBmb3JtYXQtPmNwcFswXSA+IDEpIHsKKwkJ
ZHJtX2ZiX3N3YWIoYnVmLCB2YWRkciwgZmIsIHJlY3QsICFpbXBvcnRfYXR0YWNoKTsKKwl9IGVs
c2UgaWYgKGNvbXByZXNzaW9uICYmICFpbXBvcnRfYXR0YWNoICYmIHBpdGNoID09IGZiLT5waXRj
aGVzWzBdKSB7CisJCS8qIGNhbiBjb21wcmVzcyBkaXJlY3RseSBmcm9tIHRoZSBmcmFtZWJ1ZmZl
ciAqLworCQlidWYgPSB2YWRkciArIHJlY3QtPnkxICogcGl0Y2g7CisJfSBlbHNlIHsKKwkJZHJt
X2ZiX21lbWNweShidWYsIHZhZGRyLCBmYiwgcmVjdCk7CisJfQorCisJbWVtc2V0KHJlcSwgMCwg
c2l6ZW9mKCpyZXEpKTsKKwlyZXEtPnggPSBjcHVfdG9fbGUzMihyZWN0LT54MSk7CisJcmVxLT55
ID0gY3B1X3RvX2xlMzIocmVjdC0+eTEpOworCXJlcS0+d2lkdGggPSBjcHVfdG9fbGUzMihkcm1f
cmVjdF93aWR0aChyZWN0KSk7CisJcmVxLT5oZWlnaHQgPSBjcHVfdG9fbGUzMihkcm1fcmVjdF9o
ZWlnaHQocmVjdCkpOworCXJlcS0+bGVuZ3RoID0gY3B1X3RvX2xlMzIobGVuKTsKKworCWlmIChj
b21wcmVzc2lvbiAmIEdVRF9DT01QUkVTU0lPTl9MWjQpIHsKKwkJaW50IGNvbXBsZW47CisKKwkJ
Y29tcGxlbiA9IExaNF9jb21wcmVzc19kZWZhdWx0KGJ1ZiwgZ2RybS0+YnVsa19idWYsIGxlbiwg
bGVuLCBnZHJtLT5sejRfY29tcF9tZW0pOworCQlpZiAoY29tcGxlbiA8IDApIHsKKwkJCWNvbXBy
ZXNzaW9uID0gMDsKKwkJCWdvdG8gcmV0cnk7CisJCX0KKworCQlyZXEtPmNvbXByZXNzaW9uID0g
R1VEX0NPTVBSRVNTSU9OX0xaNDsKKwkJcmVxLT5jb21wcmVzc2VkX2xlbmd0aCA9IGNwdV90b19s
ZTMyKGNvbXBsZW4pOworCX0KKworZW5kX2NwdV9hY2Nlc3M6CisJaWYgKGltcG9ydF9hdHRhY2gp
CisJCWRtYV9idWZfZW5kX2NwdV9hY2Nlc3MoaW1wb3J0X2F0dGFjaC0+ZG1hYnVmLCBETUFfRlJP
TV9ERVZJQ0UpOwordnVubWFwOgorCWRybV9nZW1fc2htZW1fdnVubWFwKGZiLT5vYmpbMF0sICZt
YXApOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBndWRfZmx1c2hfcmVjdChzdHJ1
Y3QgZ3VkX2RldmljZSAqZ2RybSwgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkgIGNv
bnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCwgc3RydWN0IGRybV9yZWN0ICpyZWN0
KQoreworCXN0cnVjdCB1c2JfZGV2aWNlICp1c2IgPSBndWRfdG9fdXNiX2RldmljZShnZHJtKTsK
KwlzdHJ1Y3QgZ3VkX3NldF9idWZmZXJfcmVxIHJlcTsKKwlpbnQgcmV0LCBhY3R1YWxfbGVuZ3Ro
OworCXNpemVfdCBsZW4sIHRybGVuOworCisJZHJtX2RiZygmZ2RybS0+ZHJtLCAiRmx1c2hpbmcg
W0ZCOiVkXSAiIERSTV9SRUNUX0ZNVCAiXG4iLCBmYi0+YmFzZS5pZCwgRFJNX1JFQ1RfQVJHKHJl
Y3QpKTsKKworCXJldCA9IGd1ZF9wcmVwX2ZsdXNoKGdkcm0sIGZiLCBmb3JtYXQsIHJlY3QsICZy
ZXEpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlsZW4gPSBsZTMyX3RvX2NwdShyZXEu
bGVuZ3RoKTsKKworCWlmIChyZXEuY29tcHJlc3Npb24pCisJCXRybGVuID0gbGUzMl90b19jcHUo
cmVxLmNvbXByZXNzZWRfbGVuZ3RoKTsKKwllbHNlCisJCXRybGVuID0gbGVuOworCisJZ2RybS0+
c3RhdHNfbGVuZ3RoICs9IGxlbjsKKwkvKiBEaWQgaXQgd3JhcCBhcm91bmQ/ICovCisJaWYgKGdk
cm0tPnN0YXRzX2xlbmd0aCA8PSBsZW4gJiYgZ2RybS0+c3RhdHNfYWN0dWFsX2xlbmd0aCkgewor
CQlnZHJtLT5zdGF0c19sZW5ndGggPSBsZW47CisJCWdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGgg
PSAwOworCX0KKwlnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoICs9IHRybGVuOworCisJaWYgKCEo
Z2RybS0+ZmxhZ3MgJiBHVURfRElTUExBWV9GTEFHX0ZVTExfVVBEQVRFKSB8fCBnZHJtLT5wcmV2
X2ZsdXNoX2ZhaWxlZCkgeworCQlyZXQgPSBndWRfdXNiX3NldChnZHJtLCBHVURfUkVRX1NFVF9C
VUZGRVIsIDAsICZyZXEsIHNpemVvZihyZXEpKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7
CisJfQorCisJcmV0ID0gdXNiX2J1bGtfbXNnKHVzYiwgZ2RybS0+YnVsa19waXBlLCBnZHJtLT5i
dWxrX2J1ZiwgdHJsZW4sCisJCQkgICAmYWN0dWFsX2xlbmd0aCwgbXNlY3NfdG9famlmZmllcygz
MDAwKSk7CisJaWYgKCFyZXQgJiYgdHJsZW4gIT0gYWN0dWFsX2xlbmd0aCkKKwkJcmV0ID0gLUVJ
TzsKKwlpZiAocmV0KQorCQlnZHJtLT5zdGF0c19udW1fZXJyb3JzKys7CisKKwlyZXR1cm4gcmV0
OworfQorCit2b2lkIGd1ZF9jbGVhcl9kYW1hZ2Uoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0pCit7
CisJZ2RybS0+ZGFtYWdlLngxID0gSU5UX01BWDsKKwlnZHJtLT5kYW1hZ2UueTEgPSBJTlRfTUFY
OworCWdkcm0tPmRhbWFnZS54MiA9IDA7CisJZ2RybS0+ZGFtYWdlLnkyID0gMDsKK30KKworc3Rh
dGljIHZvaWQgZ3VkX2FkZF9kYW1hZ2Uoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0cnVjdCBk
cm1fcmVjdCAqZGFtYWdlKQoreworCWdkcm0tPmRhbWFnZS54MSA9IG1pbihnZHJtLT5kYW1hZ2Uu
eDEsIGRhbWFnZS0+eDEpOworCWdkcm0tPmRhbWFnZS55MSA9IG1pbihnZHJtLT5kYW1hZ2UueTEs
IGRhbWFnZS0+eTEpOworCWdkcm0tPmRhbWFnZS54MiA9IG1heChnZHJtLT5kYW1hZ2UueDIsIGRh
bWFnZS0+eDIpOworCWdkcm0tPmRhbWFnZS55MiA9IG1heChnZHJtLT5kYW1hZ2UueTIsIGRhbWFn
ZS0+eTIpOworfQorCitzdGF0aWMgdm9pZCBndWRfcmV0cnlfZmFpbGVkX2ZsdXNoKHN0cnVjdCBn
dWRfZGV2aWNlICpnZHJtLCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgICBzdHJ1
Y3QgZHJtX3JlY3QgKmRhbWFnZSkKK3sKKwkvKgorCSAqIHBpcGVfdXBkYXRlIHdhaXRzIGZvciB0
aGUgd29ya2VyIHdoZW4gdGhlIGRpc3BsYXkgbW9kZSBpcyBnb2luZyB0byBjaGFuZ2UuCisJICog
VGhpcyBlbnN1cmVzIHRoYXQgdGhlIHdpZHRoIGFuZCBoZWlnaHQgaXMgc3RpbGwgdGhlIHNhbWUg
bWFraW5nIGl0IHNhZmUgdG8KKwkgKiBhZGQgYmFjayB0aGUgZGFtYWdlLgorCSAqLworCisJbXV0
ZXhfbG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCWlmICghZ2RybS0+ZmIpIHsKKwkJZHJtX2Zy
YW1lYnVmZmVyX2dldChmYik7CisJCWdkcm0tPmZiID0gZmI7CisJfQorCWd1ZF9hZGRfZGFtYWdl
KGdkcm0sIGRhbWFnZSk7CisJbXV0ZXhfdW5sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwkv
KiBSZXRyeSBvbmx5IG9uY2UgdG8gYXZvaWQgYSBwb3NzaWJsZSBzdG9ybSBpbiBjYXNlIG9mIGNv
bnRpbnVlcyBlcnJvcnMuICovCisJaWYgKCFnZHJtLT5wcmV2X2ZsdXNoX2ZhaWxlZCkKKwkJcXVl
dWVfd29yayhzeXN0ZW1fbG9uZ193cSwgJmdkcm0tPndvcmspOworCWdkcm0tPnByZXZfZmx1c2hf
ZmFpbGVkID0gdHJ1ZTsKK30KKwordm9pZCBndWRfZmx1c2hfd29yayhzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSBjb250YWluZXJfb2Yod29y
aywgc3RydWN0IGd1ZF9kZXZpY2UsIHdvcmspOworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2lu
Zm8gKmZvcm1hdDsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKKwlzdHJ1Y3QgZHJtX3Jl
Y3QgZGFtYWdlOworCXVuc2lnbmVkIGludCBpLCBsaW5lczsKKwlpbnQgaWR4LCByZXQgPSAwOwor
CXNpemVfdCBwaXRjaDsKKworCWlmICghZHJtX2Rldl9lbnRlcigmZ2RybS0+ZHJtLCAmaWR4KSkK
KwkJcmV0dXJuOworCisJbXV0ZXhfbG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCWZiID0gZ2Ry
bS0+ZmI7CisJZ2RybS0+ZmIgPSBOVUxMOworCWRhbWFnZSA9IGdkcm0tPmRhbWFnZTsKKwlndWRf
Y2xlYXJfZGFtYWdlKGdkcm0pOworCW11dGV4X3VubG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOwor
CisJaWYgKCFmYikKKwkJZ290byBvdXQ7CisKKwlmb3JtYXQgPSBmYi0+Zm9ybWF0OworCWlmIChm
b3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1hSR0I4ODg4ICYmIGdkcm0tPnhyZ2I4ODg4X2Vt
dWxhdGlvbl9mb3JtYXQpCisJCWZvcm1hdCA9IGdkcm0tPnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3Jt
YXQ7CisKKwkvKiBTcGxpdCB1cGRhdGUgaWYgaXQncyB0b28gYmlnICovCisJcGl0Y2ggPSBkcm1f
Zm9ybWF0X2luZm9fbWluX3BpdGNoKGZvcm1hdCwgMCwgZHJtX3JlY3Rfd2lkdGgoJmRhbWFnZSkp
OworCWxpbmVzID0gZHJtX3JlY3RfaGVpZ2h0KCZkYW1hZ2UpOworCisJaWYgKGdkcm0tPmJ1bGtf
bGVuIDwgbGluZXMgKiBwaXRjaCkKKwkJbGluZXMgPSBnZHJtLT5idWxrX2xlbiAvIHBpdGNoOwor
CisJZm9yIChpID0gMDsgaSA8IERJVl9ST1VORF9VUChkcm1fcmVjdF9oZWlnaHQoJmRhbWFnZSks
IGxpbmVzKTsgaSsrKSB7CisJCXN0cnVjdCBkcm1fcmVjdCByZWN0ID0gZGFtYWdlOworCisJCXJl
Y3QueTEgKz0gaSAqIGxpbmVzOworCQlyZWN0LnkyID0gbWluX3QodTMyLCByZWN0LnkxICsgbGlu
ZXMsIGRhbWFnZS55Mik7CisKKwkJcmV0ID0gZ3VkX2ZsdXNoX3JlY3QoZ2RybSwgZmIsIGZvcm1h
dCwgJnJlY3QpOworCQlpZiAocmV0KSB7CisJCQlpZiAocmV0ICE9IC1FTk9ERVYgJiYgcmV0ICE9
IC1FQ09OTlJFU0VUICYmCisJCQkgICAgcmV0ICE9IC1FU0hVVERPV04gJiYgcmV0ICE9IC1FUFJP
VE8pIHsKKwkJCQlib29sIHByZXZfZmx1c2hfZmFpbGVkID0gZ2RybS0+cHJldl9mbHVzaF9mYWls
ZWQ7CisKKwkJCQlndWRfcmV0cnlfZmFpbGVkX2ZsdXNoKGdkcm0sIGZiLCAmZGFtYWdlKTsKKwkJ
CQlpZiAoIXByZXZfZmx1c2hfZmFpbGVkKQorCQkJCQlkZXZfZXJyX3JhdGVsaW1pdGVkKGZiLT5k
ZXYtPmRldiwKKwkJCQkJCQkgICAgIkZhaWxlZCB0byBmbHVzaCBmcmFtZWJ1ZmZlcjogZXJyb3I9
JWRcbiIsIHJldCk7CisJCQl9CisJCQlicmVhazsKKwkJfQorCisJCWdkcm0tPnByZXZfZmx1c2hf
ZmFpbGVkID0gZmFsc2U7CisJfQorCisJZHJtX2ZyYW1lYnVmZmVyX3B1dChmYik7CitvdXQ6CisJ
ZHJtX2Rldl9leGl0KGlkeCk7Cit9CisKK3N0YXRpYyB2b2lkIGd1ZF9mYl9xdWV1ZV9kYW1hZ2Uo
c3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJ
CXN0cnVjdCBkcm1fcmVjdCAqZGFtYWdlKQoreworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKm9s
ZF9mYiA9IE5VTEw7CisKKwltdXRleF9sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwlpZiAo
ZmIgIT0gZ2RybS0+ZmIpIHsKKwkJb2xkX2ZiID0gZ2RybS0+ZmI7CisJCWRybV9mcmFtZWJ1ZmZl
cl9nZXQoZmIpOworCQlnZHJtLT5mYiA9IGZiOworCX0KKworCWd1ZF9hZGRfZGFtYWdlKGdkcm0s
IGRhbWFnZSk7CisKKwltdXRleF91bmxvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCXF1ZXVl
X3dvcmsoc3lzdGVtX2xvbmdfd3EsICZnZHJtLT53b3JrKTsKKworCWlmIChvbGRfZmIpCisJCWRy
bV9mcmFtZWJ1ZmZlcl9wdXQob2xkX2ZiKTsKK30KKworaW50IGd1ZF9waXBlX2NoZWNrKHN0cnVj
dCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKKwkJICAgc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqbmV3X3BsYW5lX3N0YXRlLAorCQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19j
cnRjX3N0YXRlKQoreworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RldmljZShw
aXBlLT5jcnRjLmRldik7CisJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRl
ID0gcGlwZS0+cGxhbmUuc3RhdGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1v
ZGUgPSAmbmV3X2NydGNfc3RhdGUtPm1vZGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlID0gbmV3X3BsYW5lX3N0YXRlLT5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpv
bGRfZmIgPSBvbGRfcGxhbmVfc3RhdGUtPmZiOworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRl
ICpjb25uZWN0b3Jfc3RhdGUgPSBOVUxMOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
bmV3X3BsYW5lX3N0YXRlLT5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3Jt
YXQgPSBmYi0+Zm9ybWF0OworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJaW50
IGlkeCwgcmV0LCBudW1fcHJvcGVydGllczsKKwlzdHJ1Y3QgZ3VkX3N0YXRlX3JlcSAqcmVxOwor
CXVuc2lnbmVkIGludCBpOworCXNpemVfdCBsZW47CisKKwlpZiAoV0FSTl9PTl9PTkNFKCFmYikp
CisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKG9sZF9wbGFuZV9zdGF0ZS0+cm90YXRpb24gIT0g
bmV3X3BsYW5lX3N0YXRlLT5yb3RhdGlvbikKKwkJbmV3X2NydGNfc3RhdGUtPm1vZGVfY2hhbmdl
ZCA9IHRydWU7CisKKwlpZiAob2xkX2ZiICYmIG9sZF9mYi0+Zm9ybWF0ICE9IGZvcm1hdCkKKwkJ
bmV3X2NydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRydWU7CisKKwlpZiAoIW5ld19jcnRjX3N0
YXRlLT5tb2RlX2NoYW5nZWQgJiYgIW5ld19jcnRjX3N0YXRlLT5jb25uZWN0b3JzX2NoYW5nZWQp
CisJCXJldHVybiAwOworCisJLyogT25seSBvbmUgY29ubmVjdG9yIGlzIHN1cHBvcnRlZCAqLwor
CWlmIChod2VpZ2h0MzIobmV3X2NydGNfc3RhdGUtPmNvbm5lY3Rvcl9tYXNrKSAhPSAxKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCWlmIChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1hSR0I4
ODg4ICYmIGdkcm0tPnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQpCisJCWZvcm1hdCA9IGdkcm0t
PnhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQ7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2lu
X3N0YXRlKHN0YXRlLCBjb25uZWN0b3IsIGNvbm5lY3Rvcl9zdGF0ZSwgaSkgeworCQlpZiAoY29u
bmVjdG9yX3N0YXRlLT5jcnRjKQorCQkJYnJlYWs7CisJfQorCisJaWYgKFdBUk5fT05fT05DRSgh
Y29ubmVjdG9yX3N0YXRlKSkKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwludW1fcHJvcGVydGllcyA9
IGd1ZF9jb25uZWN0b3JfZmlsbF9wcm9wZXJ0aWVzKGNvbm5lY3RvciwgTlVMTCwgTlVMTCk7CisJ
aWYgKG51bV9wcm9wZXJ0aWVzIDwgMCkKKwkJcmV0dXJuIG51bV9wcm9wZXJ0aWVzOworCisJbnVt
X3Byb3BlcnRpZXMgKz0gZ2RybS0+bnVtX3Byb3BlcnRpZXM7CisKKwlsZW4gPSBzdHJ1Y3Rfc2l6
ZShyZXEsIHByb3BlcnRpZXMsIG51bV9wcm9wZXJ0aWVzKTsKKwlyZXEgPSBremFsbG9jKGxlbiwg
R0ZQX0tFUk5FTCk7CisJaWYgKCFyZXEpCisJCXJldHVybiAtRU5PTUVNOworCisJZ3VkX2Zyb21f
ZGlzcGxheV9tb2RlKCZyZXEtPm1vZGUsIG1vZGUpOworCisJcmVxLT5mb3JtYXQgPSBndWRfZnJv
bV9mb3VyY2MoZm9ybWF0LT5mb3JtYXQpOworCWlmIChXQVJOX09OX09OQ0UoIXJlcS0+Zm9ybWF0
KSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXEtPmNvbm5lY3RvciA9IGRybV9jb25uZWN0b3Jf
aW5kZXgoY29ubmVjdG9yKTsKKwlyZXEtPm51bV9wcm9wZXJ0aWVzID0gbnVtX3Byb3BlcnRpZXM7
CisKKwludW1fcHJvcGVydGllcyA9IGd1ZF9jb25uZWN0b3JfZmlsbF9wcm9wZXJ0aWVzKGNvbm5l
Y3RvciwgY29ubmVjdG9yX3N0YXRlLAorCQkJCQkJICAgICAgIHJlcS0+cHJvcGVydGllcyk7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgZ2RybS0+bnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJv
cCA9IGdkcm0tPnByb3BlcnRpZXNbaV07CisJCXU2NCB2YWw7CisKKwkJc3dpdGNoIChwcm9wKSB7
CisJCWNhc2UgR1VEX1BST1BFUlRZX1JPVEFUSU9OOgorCQkJLyogRFJNIFVBUEkgbWF0Y2hlcyB0
aGUgcHJvdG9jb2wgc28gdXNlIHZhbHVlIGRpcmVjdGx5ICovCisJCQl2YWwgPSBuZXdfcGxhbmVf
c3RhdGUtPnJvdGF0aW9uOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlXQVJOX09OX09OQ0Uo
MSk7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byBvdXQ7CisJCX0KKworCQlyZXEtPnByb3Bl
cnRpZXNbbnVtX3Byb3BlcnRpZXMgKyBpXS5wcm9wID0gY3B1X3RvX2xlMTYocHJvcCk7CisJCXJl
cS0+cHJvcGVydGllc1tudW1fcHJvcGVydGllcyArIGldLnZhbCA9IGNwdV90b19sZTY0KHZhbCk7
CisJfQorCisJaWYgKGRybV9kZXZfZW50ZXIoZmItPmRldiwgJmlkeCkpIHsKKwkJcmV0ID0gZ3Vk
X3VzYl9zZXQoZ2RybSwgR1VEX1JFUV9TRVRfU1RBVEVfQ0hFQ0ssIDAsIHJlcSwgbGVuKTsKKwkJ
ZHJtX2Rldl9leGl0KGlkeCk7CisJfSAgZWxzZSB7CisJCXJldCA9IC1FTk9ERVY7CisJfQorb3V0
OgorCWtmcmVlKHJlcSk7CisKKwlyZXR1cm4gcmV0OworfQorCit2b2lkIGd1ZF9waXBlX3VwZGF0
ZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCisJCSAgICAgc3RydWN0IGRy
bV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBw
aXBlLT5jcnRjLmRldjsKKwlzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSA9IHRvX2d1ZF9kZXZpY2Uo
ZHJtKTsKKwlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSA9IHBpcGUtPnBsYW5lLnN0YXRl
OworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmZiOworCXN0cnVjdCBkcm1f
Y3J0YyAqY3J0YyA9ICZwaXBlLT5jcnRjOworCXN0cnVjdCBkcm1fcmVjdCBkYW1hZ2U7CisJaW50
IGlkeDsKKworCWlmIChjcnRjLT5zdGF0ZS0+bW9kZV9jaGFuZ2VkIHx8ICFjcnRjLT5zdGF0ZS0+
ZW5hYmxlKSB7CisJCWNhbmNlbF93b3JrX3N5bmMoJmdkcm0tPndvcmspOworCQltdXRleF9sb2Nr
KCZnZHJtLT5kYW1hZ2VfbG9jayk7CisJCWlmIChnZHJtLT5mYikgeworCQkJZHJtX2ZyYW1lYnVm
ZmVyX3B1dChnZHJtLT5mYik7CisJCQlnZHJtLT5mYiA9IE5VTEw7CisJCX0KKwkJZ3VkX2NsZWFy
X2RhbWFnZShnZHJtKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisJfQor
CisJaWYgKCFkcm1fZGV2X2VudGVyKGRybSwgJmlkeCkpCisJCXJldHVybjsKKworCWlmICghb2xk
X3N0YXRlLT5mYikKKwkJZ3VkX3VzYl93cml0ZTgoZ2RybSwgR1VEX1JFUV9TRVRfQ09OVFJPTExF
Ul9FTkFCTEUsIDEpOworCisJaWYgKGZiICYmIChjcnRjLT5zdGF0ZS0+bW9kZV9jaGFuZ2VkIHx8
IGNydGMtPnN0YXRlLT5jb25uZWN0b3JzX2NoYW5nZWQpKQorCQlndWRfdXNiX3NldChnZHJtLCBH
VURfUkVRX1NFVF9TVEFURV9DT01NSVQsIDAsIE5VTEwsIDApOworCisJaWYgKGNydGMtPnN0YXRl
LT5hY3RpdmVfY2hhbmdlZCkKKwkJZ3VkX3VzYl93cml0ZTgoZ2RybSwgR1VEX1JFUV9TRVRfRElT
UExBWV9FTkFCTEUsIGNydGMtPnN0YXRlLT5hY3RpdmUpOworCisJaWYgKGRybV9hdG9taWNfaGVs
cGVyX2RhbWFnZV9tZXJnZWQob2xkX3N0YXRlLCBzdGF0ZSwgJmRhbWFnZSkpIHsKKwkJaWYgKGdk
cm0tPmZsYWdzICYgR1VEX0RJU1BMQVlfRkxBR19GVUxMX1VQREFURSkKKwkJCWRybV9yZWN0X2lu
aXQoJmRhbWFnZSwgMCwgMCwgZmItPndpZHRoLCBmYi0+aGVpZ2h0KTsKKwkJZ3VkX2ZiX3F1ZXVl
X2RhbWFnZShnZHJtLCBmYiwgJmRhbWFnZSk7CisJfQorCisJaWYgKCFjcnRjLT5zdGF0ZS0+ZW5h
YmxlKQorCQlndWRfdXNiX3dyaXRlOChnZHJtLCBHVURfUkVRX1NFVF9DT05UUk9MTEVSX0VOQUJM
RSwgMCk7CisKKwlkcm1fZGV2X2V4aXQoaWR4KTsKK30KZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJt
L2d1ZC5oIGIvaW5jbHVkZS9kcm0vZ3VkLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi43MjAwMjk2ZjQ2YjMKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRlL2RybS9n
dWQuaApAQCAtMCwwICsxLDM1NiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAq
LworLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpZm5kZWYg
X19MSU5VWF9HVURfSAorI2RlZmluZSBfX0xJTlVYX0dVRF9ICisKKyNpbmNsdWRlIDxsaW51eC90
eXBlcy5oPgorCisvKgorICogc3RydWN0IGd1ZF9kaXNwbGF5X2Rlc2NyaXB0b3JfcmVxIC0gRGlz
cGxheSBkZXNjcmlwdG9yCisgKiBAbWFnaWM6IE1hZ2ljIHZhbHVlIEdVRF9ESVNQTEFZX01BR0lD
CisgKiBAdmVyc2lvbjogUHJvdG9jb2wgdmVyc2lvbgorICogQGZsYWdzOiBGbGFncworICogICAg
ICAgICAtIFNUQVRVU19PTl9TRVQ6IEFsd2F5cyBkbyBhIHN0YXR1cyByZXF1ZXN0IGFmdGVyIGEg
U0VUIHJlcXVlc3QuCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBpcyB1c2VkIGJ5
IHRoZSBMaW51eCBnYWRnZXQgZHJpdmVyIHNpbmNlIGl0IGhhcworICogICAgICAgICAgICAgICAg
ICAgICAgICAgIG5vIHdheSB0byBjb250cm9sIHRoZSBzdGF0dXMgc3RhZ2Ugb2YgYSBjb250cm9s
IE9VVAorICogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QgdGhhdCBoYXMgYSBwYXls
b2FkLgorICogICAgICAgICAtIEZVTExfVVBEQVRFOiAgIEFsd2F5cyBzZW5kIHRoZSBlbnRpcmUg
ZnJhbWVidWZmZXIgd2hlbiBmbHVzaGluZyBjaGFuZ2VzLgorICogICAgICAgICAgICAgICAgICAg
ICAgICAgIFRoZSBHVURfUkVRX1NFVF9CVUZGRVIgcmVxdWVzdCB3aWxsIG5vdCBiZSBzZW50Cisg
KiAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlIGVhY2ggYnVsayB0cmFuc2ZlciwgaXQg
d2lsbCBvbmx5IGJlIHNlbnQgaWYgdGhlCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgcHJl
dmlvdXMgYnVsayB0cmFuc2ZlciBoYWQgZmFpbGVkLiBUaGlzIGdpdmVzIHRoZSBkZXZpY2UKKyAq
ICAgICAgICAgICAgICAgICAgICAgICAgICBhIGNoYW5jZSB0byByZXNldCBpdHMgc3RhdGUgbWFj
aGluZSBpZiBuZWVkZWQuCisgKiAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBmbGFnIGNh
biBub3QgYmUgdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoIGNvbXByZXNzaW9uLgorICogQGNvbXBy
ZXNzaW9uOiBTdXBwb3J0ZWQgY29tcHJlc3Npb24gdHlwZXMKKyAqICAgICAgICAgICAgICAgLSBH
VURfQ09NUFJFU1NJT05fTFo0OiBMWjQgbG9zc2xlc3MgY29tcHJlc3Npb24uCisgKiBAbWF4X2J1
ZmZlcl9zaXplOiBNYXhpbXVtIGJ1ZmZlciBzaXplIHRoZSBkZXZpY2UgY2FuIGhhbmRsZSAob3B0
aW9uYWwpLgorICogICAgICAgICAgICAgICAgICAgVGhpcyBpcyB1c2VmdWwgZm9yIGRldmljZXMg
dGhhdCBkb24ndCBoYXZlIGEgYmlnIGVub3VnaAorICogICAgICAgICAgICAgICAgICAgYnVmZmVy
IHRvIGRlY29tcHJlc3MgdGhlIGVudGlyZSBmcmFtZWJ1ZmZlciBpbiBvbmUgZ28uCisgKiBAbWlu
X3dpZHRoOiBNaW5pbXVtIHBpeGVsIHdpZHRoIHRoZSBjb250cm9sbGVyIGNhbiBoYW5kbGUKKyAq
IEBtYXhfd2lkdGg6IE1heGltdW0gd2lkdGgKKyAqIEBtaW5faGVpZ2h0OiBNaW5pbXVtIGhlaWdo
dAorICogQG1heF9oZWlnaHQ6IE1heGltdW0gaGVpZ2h0CisgKiBAbnVtX2Zvcm1hdHM6IE51bWJl
ciBvZiBzdXBwb3J0ZWQgcGl4ZWwgZm9ybWF0cworICogQG51bV9wcm9wZXJ0aWVzOiBOdW1iZXIg
b2YgcHJvcGVydGllcyB0aGF0IGFyZSBub3QgY29ubmVjdG9yIHByb3BlcnRpZXMKKyAqIEBudW1f
Y29ubmVjdG9yczogTnVtYmVyIG9mIGNvbm5lY3RvcnMKKyAqCisgKiBEZXZpY2VzIHRoYXQgaGF2
ZSBvbmx5IG9uZSBkaXNwbGF5IG1vZGUgd2lsbCBoYXZlIG1pbl93aWR0aCA9PSBtYXhfd2lkdGgK
KyAqIGFuZCBtaW5faGVpZ2h0ID09IG1heF9oZWlnaHQuCisgKi8KK3N0cnVjdCBndWRfZGlzcGxh
eV9kZXNjcmlwdG9yX3JlcSB7CisJX19sZTMyIG1hZ2ljOworI2RlZmluZSBHVURfRElTUExBWV9N
QUdJQwkJCTB4MWQ1MDYxNGQKKwlfX3U4IHZlcnNpb247CisJX19sZTMyIGZsYWdzOworI2RlZmlu
ZSBHVURfRElTUExBWV9GTEFHX1NUQVRVU19PTl9TRVQJCUJJVCgwKQorI2RlZmluZSBHVURfRElT
UExBWV9GTEFHX0ZVTExfVVBEQVRFCQlCSVQoMSkKKwlfX3U4IGNvbXByZXNzaW9uOworI2RlZmlu
ZSBHVURfQ09NUFJFU1NJT05fTFo0CQkJQklUKDApCisJX19sZTMyIG1heF9idWZmZXJfc2l6ZTsK
KwlfX2xlMzIgbWluX3dpZHRoOworCV9fbGUzMiBtYXhfd2lkdGg7CisJX19sZTMyIG1pbl9oZWln
aHQ7CisJX19sZTMyIG1heF9oZWlnaHQ7CisJX191OCBudW1fZm9ybWF0czsKKwlfX3U4IG51bV9w
cm9wZXJ0aWVzOworCV9fdTggbnVtX2Nvbm5lY3RvcnM7Cit9IF9fcGFja2VkOworCisvKgorICog
c3RydWN0IGd1ZF9wcm9wZXJ0eV9yZXEgLSBQcm9wZXJ0eQorICogQHByb3A6IFByb3BlcnR5Cisg
KiBAdmFsOiBWYWx1ZQorICovCitzdHJ1Y3QgZ3VkX3Byb3BlcnR5X3JlcSB7CisJX19sZTE2IHBy
b3A7CisJX19sZTY0IHZhbDsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBzdHJ1Y3QgZ3VkX2Rpc3Bs
YXlfbW9kZV9yZXEgLSBEaXNwbGF5IG1vZGUKKyAqIEBjbG9jazogUGl4ZWwgY2xvY2sgaW4ga0h6
CisgKiBAaGRpc3BsYXk6IEhvcml6b250YWwgZGlzcGxheSBzaXplCisgKiBAaHN5bmNfc3RhcnQ6
IEhvcml6b250YWwgc3luYyBzdGFydAorICogQGhzeW5jX2VuZDogSG9yaXpvbnRhbCBzeW5jIGVu
ZAorICogQGh0b3RhbDogSG9yaXpvbnRhbCB0b3RhbCBzaXplCisgKiBAdmRpc3BsYXk6IFZlcnRp
Y2FsIGRpc3BsYXkgc2l6ZQorICogQHZzeW5jX3N0YXJ0OiBWZXJ0aWNhbCBzeW5jIHN0YXJ0Cisg
KiBAdnN5bmNfZW5kOiBWZXJ0aWNhbCBzeW5jIGVuZAorICogQHZ0b3RhbDogVmVydGljYWwgdG90
YWwgc2l6ZQorICogQGZsYWdzOiBCaXRzIDAtMTMgYXJlIHRoZSBzYW1lIGFzIGluIHRoZSBSYW5k
UiBwcm90b2NvbCBhbmQgYWxzbyB3aGF0IERSTSB1c2VzLgorICogICAgICAgICBUaGUgZGVwcmVj
YXRlZCBiaXRzIGFyZSByZXVzZWQgZm9yIGludGVybmFsIHByb3RvY29sIGZsYWdzIGxlYXZpbmcg
dXMKKyAqICAgICAgICAgZnJlZSB0byBmb2xsb3cgRFJNIGZvciB0aGUgb3RoZXIgYml0cyBpbiB0
aGUgZnV0dXJlLgorICogICAgICAgICAtIEZMQUdfUFJFRkVSUkVEOiBTZXQgb24gdGhlIHByZWZl
cnJlZCBkaXNwbGF5IG1vZGUuCisgKi8KK3N0cnVjdCBndWRfZGlzcGxheV9tb2RlX3JlcSB7CisJ
X19sZTMyIGNsb2NrOworCV9fbGUxNiBoZGlzcGxheTsKKwlfX2xlMTYgaHN5bmNfc3RhcnQ7CisJ
X19sZTE2IGhzeW5jX2VuZDsKKwlfX2xlMTYgaHRvdGFsOworCV9fbGUxNiB2ZGlzcGxheTsKKwlf
X2xlMTYgdnN5bmNfc3RhcnQ7CisJX19sZTE2IHZzeW5jX2VuZDsKKwlfX2xlMTYgdnRvdGFsOwor
CV9fbGUzMiBmbGFnczsKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BIU1lOQwkJQklU
KDApCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19OSFNZTkMJCUJJVCgxKQorI2RlZmlu
ZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfUFZTWU5DCQlCSVQoMikKKyNkZWZpbmUgR1VEX0RJU1BM
QVlfTU9ERV9GTEFHX05WU1lOQwkJQklUKDMpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxB
R19JTlRFUkxBQ0UJCUJJVCg0KQorI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfREJMU0NB
TgkJQklUKDUpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19DU1lOQwkJQklUKDYpCisj
ZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19QQ1NZTkMJCUJJVCg3KQorI2RlZmluZSBHVURf
RElTUExBWV9NT0RFX0ZMQUdfTkNTWU5DCQlCSVQoOCkKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTU9E
RV9GTEFHX0hTS0VXCQlCSVQoOSkKKy8qIEJDYXN0IGFuZCBQaXhlbE11bHRpcGxleCBhcmUgZGVw
cmVjYXRlZCAqLworI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfREJMQ0xLCQlCSVQoMTIp
CisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19DTEtESVYyCQlCSVQoMTMpCisjZGVmaW5l
IEdVRF9ESVNQTEFZX01PREVfRkxBR19VU0VSX01BU0sJCVwKKwkJKEdVRF9ESVNQTEFZX01PREVf
RkxBR19QSFNZTkMgfCBHVURfRElTUExBWV9NT0RFX0ZMQUdfTkhTWU5DIHwgXAorCQlHVURfRElT
UExBWV9NT0RFX0ZMQUdfUFZTWU5DIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX05WU1lOQyB8IFwK
KwkJR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0lOVEVSTEFDRSB8IEdVRF9ESVNQTEFZX01PREVfRkxB
R19EQkxTQ0FOIHwgXAorCQlHVURfRElTUExBWV9NT0RFX0ZMQUdfQ1NZTkMgfCBHVURfRElTUExB
WV9NT0RFX0ZMQUdfUENTWU5DIHwgXAorCQlHVURfRElTUExBWV9NT0RFX0ZMQUdfTkNTWU5DIHwg
R1VEX0RJU1BMQVlfTU9ERV9GTEFHX0hTS0VXIHwgXAorCQlHVURfRElTUExBWV9NT0RFX0ZMQUdf
REJMQ0xLIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0NMS0RJVjIpCisvKiBJbnRlcm5hbCBwcm90
b2NvbCBmbGFncyAqLworI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfUFJFRkVSUkVECQlC
SVQoMTApCit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9jb25uZWN0b3JfZGVzY3Jp
cHRvcl9yZXEgLSBDb25uZWN0b3IgZGVzY3JpcHRvcgorICogQGNvbm5lY3Rvcl90eXBlOiBDb25u
ZWN0b3IgdHlwZSAoR1VEX0NPTk5FQ1RPUl9UWVBFXyopLgorICogICAgICAgICAgICAgICAgICBJ
ZiB0aGUgaG9zdCBkb2Vzbid0IHN1cHBvcnQgdGhlIHR5cGUgaXQgc2hvdWxkIGZhbGwgYmFjayB0
byBQQU5FTC4KKyAqIEBmbGFnczogRmxhZ3MKKyAqICAgICAgICAgLSBQT0xMX1NUQVRVUzogQ29u
bmVjdG9yIHN0YXR1cyBjYW4gY2hhbmdlIChwb2xsZWQgZXZlcnkgMTAgc2Vjb25kcykKKyAqICAg
ICAgICAgLSBJTlRFUkxBQ0U6IEludGVybGFjZWQgbW9kZXMgYXJlIHN1cHBvcnRlZAorICogICAg
ICAgICAtIERPVUJMRVNDQU46IERvdWJsZXNjYW4gbW9kZXMgYXJlIHN1cHBvcnRlZAorICogQG51
bV9wcm9wZXJ0aWVzOiBOdW1iZXIgb2Ygc3VwcG9ydGVkIHByb3BlcnRpZXMKKyAqLworc3RydWN0
IGd1ZF9jb25uZWN0b3JfZGVzY3JpcHRvcl9yZXEgeworCV9fdTggY29ubmVjdG9yX3R5cGU7Cisj
ZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9QQU5FTAkJMAorI2RlZmluZSBHVURfQ09OTkVDVE9S
X1RZUEVfVkdBCQkJMQorI2RlZmluZSBHVURfQ09OTkVDVE9SX1RZUEVfQ09NUE9TSVRFCQkyCisj
ZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9TVklERU8JCTMKKyNkZWZpbmUgR1VEX0NPTk5FQ1RP
Ul9UWVBFX0NPTVBPTkVOVAkJNAorI2RlZmluZSBHVURfQ09OTkVDVE9SX1RZUEVfRFZJCQkJNQor
I2RlZmluZSBHVURfQ09OTkVDVE9SX1RZUEVfRElTUExBWVBPUlQJCTYKKyNkZWZpbmUgR1VEX0NP
Tk5FQ1RPUl9UWVBFX0hETUkJCQk3CisJX19sZTMyIGZsYWdzOworI2RlZmluZSBHVURfQ09OTkVD
VE9SX0ZMQUdTX1BPTExfU1RBVFVTCQlCSVQoMCkKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9GTEFH
U19JTlRFUkxBQ0UJCUJJVCgxKQorI2RlZmluZSBHVURfQ09OTkVDVE9SX0ZMQUdTX0RPVUJMRVND
QU4JCUJJVCgyKQorCV9fdTggbnVtX3Byb3BlcnRpZXM7Cit9IF9fcGFja2VkOworCisvKgorICog
c3RydWN0IGd1ZF9jb25uZWN0b3Jfc3RhdHVzX3JlcSAtIENvbm5lY3RvciBzdGF0dXMKKyAqIEBz
dGF0dXM6IFN0YXR1cworICogICAgICAgICAgLSBESVNDT05ORUNURUQ6IENvbm5lY3RvciBpcyBk
aXNjb25uZWN0ZWQKKyAqICAgICAgICAgIC0gQ09OTkVDVEVEOiBDb25uZWN0b3IgaXMgY29ubmVj
dGVkCisgKiAgICAgICAgICAtIFVOS05PV046IENvbm5lY3Rpb24gc3RhdHVzIGlzIHVua25vd24K
KyAqICAgICAgICAgIEZsYWdzOgorICogICAgICAgICAgLSBDSEFOR0VEOiBBIGNoYW5nZSBoYXMg
aGFwcGVuZWQgc2luY2UgdGhlIGxhc3QgcmVxdWVzdAorICogQG51bV9tb2RlczogTnVtYmVyIG9m
IGF2YWlsYWJsZSBkaXNwbGF5IG1vZGVzCisgKiBAZWRpZF9sZW46IExlbmd0aCBvZiBFRElEIGRh
dGEKKyAqCisgKiBJZiBAbnVtX21vZGVzIGlzIHplcm8sIEVESUQgaXMgdXNlZCB0byBjcmVhdGUg
ZGlzcGxheSBtb2Rlcy4KKyAqIElmIGJvdGggQG51bV9tb2RlcyBhbmQgQGVkaWRfbGVuIGFyZSBz
ZXQsIEVESUQgaXMganVzdCBwYXNzZWQgb24gdG8gdXNlcnNwYWNlCisgKiBpbiB0aGUgRURJRCBj
b25uZWN0b3IgcHJvcGVydHkuCisgKgorICogVXNlcnNwYWNlIHdpbGwgZ2V0IGEgSE9UUExVRyB1
ZXZlbnQgaWYgb25lIG9mIHRoZSBmb2xsb3dpbmcgaXMgdHJ1ZToKKyAqIC0gQ29ubmVjdGlvbiBz
dGF0dXMgaGFzIGNoYW5nZWQKKyAqIC0gQG51bV9tb2RlcyBvciBAZWRpZF9sZW4gaGFzIGNoYW5n
ZWQKKyAqIC0gQ0hBTkdFRCBpcyBzZXQKKyAqLworc3RydWN0IGd1ZF9jb25uZWN0b3Jfc3RhdHVz
X3JlcSB7CisJX191OCBzdGF0dXM7CisjZGVmaW5lIEdVRF9DT05ORUNUT1JfU1RBVFVTX0RJU0NP
Tk5FQ1RFRAkweDAwCisjZGVmaW5lIEdVRF9DT05ORUNUT1JfU1RBVFVTX0NPTk5FQ1RFRAkJMHgw
MQorI2RlZmluZSBHVURfQ09OTkVDVE9SX1NUQVRVU19VTktOT1dOCQkweDAyCisjZGVmaW5lIEdV
RF9DT05ORUNUT1JfU1RBVFVTX0NPTk5FQ1RFRF9NQVNLCTB4MDMKKyNkZWZpbmUgR1VEX0NPTk5F
Q1RPUl9TVEFUVVNfQ0hBTkdFRAkJQklUKDcpCisJX19sZTE2IG51bV9tb2RlczsKKwlfX2xlMTYg
ZWRpZF9sZW47Cit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9zZXRfYnVmZmVyX3Jl
cSAtIFNldCBidWZmZXIgdHJhbnNmZXIgaW5mbworICogQHg6IFggcG9zaXRpb24gb2YgcmVjdGFu
Z2xlCisgKiBAeTogWSBwb3NpdGlvbgorICogQHdpZHRoOiBQaXhlbCB3aWR0aCBvZiByZWN0YW5n
bGUKKyAqIEBoZWlnaHQ6IFBpeGVsIGhlaWdodAorICogQGxlbmd0aDogQnVmZmVyIGxlbmd0aCBp
biBieXRlcworICogQGNvbXByZXNzaW9uOiBUcmFuc2ZlciBjb21wcmVzc2lvbgorICogQGNvbXBy
ZXNzZWRfbGVuZ3RoOiBDb21wcmVzc2VkIGJ1ZmZlciBsZW5ndGgKKyAqCisgKiBUaGlzIHJlcXVl
c3QgaXMgaXNzdWVkIHJpZ2h0IGJlZm9yZSB0aGUgYnVsayB0cmFuc2Zlci4KKyAqIEB4LCBAeSwg
QHdpZHRoIGFuZCBAaGVpZ2h0IHNwZWNpZmllcyB0aGUgcmVjdGFuZ2xlIHdoZXJlIHRoZSBidWZm
ZXIgc2hvdWxkIGJlCisgKiBwbGFjZWQgaW5zaWRlIHRoZSBmcmFtZWJ1ZmZlci4KKyAqLworc3Ry
dWN0IGd1ZF9zZXRfYnVmZmVyX3JlcSB7CisJX19sZTMyIHg7CisJX19sZTMyIHk7CisJX19sZTMy
IHdpZHRoOworCV9fbGUzMiBoZWlnaHQ7CisJX19sZTMyIGxlbmd0aDsKKwlfX3U4IGNvbXByZXNz
aW9uOworCV9fbGUzMiBjb21wcmVzc2VkX2xlbmd0aDsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBz
dHJ1Y3QgZ3VkX3N0YXRlX3JlcSAtIERpc3BsYXkgc3RhdGUKKyAqIEBtb2RlOiBEaXNwbGF5IG1v
ZGUKKyAqIEBmb3JtYXQ6IFBpeGVsIGZvcm1hdCBHVURfUElYRUxfRk9STUFUXyoKKyAqIEBjb25u
ZWN0b3I6IENvbm5lY3RvciBpbmRleAorICogQG51bV9wcm9wZXJ0aWVzOiBOdW1iZXIgb2YgcHJv
cGVydGllcyBpbiB0aGUgc3RhdGUKKyAqIEBwcm9wZXJ0aWVzOiBBcnJheSBvZiBwcm9wZXJ0aWVz
CisgKgorICogVGhlIGVudGlyZSBzdGF0ZSBpcyB0cmFuc2ZlcnJlZCBlYWNoIHRpbWUgdGhlcmUn
cyBhIGNoYW5nZS4KKyAqLworc3RydWN0IGd1ZF9zdGF0ZV9yZXEgeworCXN0cnVjdCBndWRfZGlz
cGxheV9tb2RlX3JlcSBtb2RlOworCV9fdTggZm9ybWF0OworCV9fdTggY29ubmVjdG9yOworCV9f
dTggbnVtX3Byb3BlcnRpZXM7CisJc3RydWN0IGd1ZF9wcm9wZXJ0eV9yZXEgcHJvcGVydGllc1td
OworfSBfX3BhY2tlZDsKKworLyogTGlzdCBvZiBzdXBwb3J0ZWQgY29ubmVjdG9yIHByb3BlcnRp
ZXM6ICovCisKKy8qIE1hcmdpbnMgaW4gcGl4ZWxzIHRvIGRlYWwgd2l0aCBvdmVyc2NhbiwgcmFu
Z2UgMC0xMDAgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0xFRlRfTUFSR0lOCQkJMQorI2Rl
ZmluZSBHVURfUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOCQkJMgorI2RlZmluZSBHVURfUFJPUEVS
VFlfVFZfVE9QX01BUkdJTgkJCTMKKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0JPVFRPTV9NQVJH
SU4JCQk0CisvKiBOdW1iZXIgb2YgbW9kZXMgYXJlIHBsYWNlZCBhdCBfU0hJRlQgaW4gdmFsIG9u
IHJldHJpZXZhbCAqLworI2RlZmluZSBHVURfUFJPUEVSVFlfVFZfTU9ERQkJCQk1CisgICNkZWZp
bmUgR1VEX0NPTk5FQ1RPUl9UVl9NT0RFX05VTV9TSElGVAkxNgorLyogQnJpZ2h0bmVzcyBpbiBw
ZXJjZW50LCByYW5nZSAwLTEwMCAqLworI2RlZmluZSBHVURfUFJPUEVSVFlfVFZfQlJJR0hUTkVT
UwkJCTYKKy8qIENvbnRyYXN0IGluIHBlcmNlbnQsIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdV
RF9QUk9QRVJUWV9UVl9DT05UUkFTVAkJCTcKKy8qIEZsaWNrZXIgcmVkdWN0aW9uIGluIHBlcmNl
bnQsIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9GTElDS0VSX1JFRFVD
VElPTgkJOAorLyogT3ZlcnNjYW4gaW4gcGVyY2VudCwgcmFuZ2UgMC0xMDAgKi8KKyNkZWZpbmUg
R1VEX1BST1BFUlRZX1RWX09WRVJTQ0FOCQkJOQorLyogU2F0dXJhdGlvbiBpbiBwZXJjZW50LCBy
YW5nZSAwLTEwMCAqLworI2RlZmluZSBHVURfUFJPUEVSVFlfVFZfU0FUVVJBVElPTgkJCTEwCisv
KiBIdWUgaW4gcGVyY2VudCwgcmFuZ2UgMC0xMDAgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RW
X0hVRQkJCQkxMQorCisvKgorICogQmFja2xpZ2h0IGJyaWdodG5lc3MgaXMgaW4gdGhlIHJhbmdl
IDAtMTAwIGluY2x1c2l2ZS4gVGhlIHZhbHVlIHJlcHJlc2VudHMgdGhlIGh1bWFuIHBlcmNlcHR1
YWwKKyAqIGJyaWdodG5lc3MgYW5kIG5vdCBhIGxpbmVhciBQV00gdmFsdWUuIDAgaXMgbWluaW11
bSBicmlnaHRuZXNzIHdoaWNoIHNob3VsZCBub3QgdHVybiB0aGUKKyAqIGJhY2tsaWdodCBjb21w
bGV0ZWx5IG9mZi4gVGhlIERQTVMgY29ubmVjdG9yIHByb3BlcnR5IHNob3VsZCBiZSB1c2VkIHRv
IGNvbnRyb2wgcG93ZXIgd2hpY2ggd2lsbAorICogdHJpZ2dlciBhIEdVRF9SRVFfU0VUX0RJU1BM
QVlfRU5BQkxFIHJlcXVlc3QuCisgKgorICogVGhpcyBkb2VzIG5vdCBtYXAgdG8gYSBEUk0gcHJv
cGVydHksIGl0IGlzIHVzZWQgd2l0aCB0aGUgYmFja2xpZ2h0IGRldmljZS4KKyAqLworI2RlZmlu
ZSBHVURfUFJPUEVSVFlfQkFDS0xJR0hUX0JSSUdIVE5FU1MJCTEyCisKKy8qIExpc3Qgb2Ygc3Vw
cG9ydGVkIHByb3BlcnRpZXMgdGhhdCBhcmUgbm90IGNvbm5lY3RvciBwcm9wZXRpZXM6ICovCisK
Ky8qCisgKiBQbGFuZSByb3RhdGlvbi4gU2hvdWxkIHJldHVybiB0aGUgc3VwcG9ydGVkIGJpdG1h
c2sgb24KKyAqIEdVRF9SRVFfR0VUX1BST1BFUlRJRVMuIEdVRF9ST1RBVElPTl8wIGlzIG1hbmRh
dG9yeS4KKyAqCisgKiBOb3RlOiBUaGlzIGlzIG5vdCBkaXNwbGF5IHJvdGF0aW9uIHNvIDkwLzI3
MCB3aWxsIG5lZWQgc2NhbGluZyB0byBtYWtlIGl0IGZpdCAodW5sZXNzIHNxdWFyZWQpLgorICov
CisjZGVmaW5lIEdVRF9QUk9QRVJUWV9ST1RBVElPTgkJCQk1MAorICAjZGVmaW5lIEdVRF9ST1RB
VElPTl8wCQkJQklUKDApCisgICNkZWZpbmUgR1VEX1JPVEFUSU9OXzkwCQkJQklUKDEpCisgICNk
ZWZpbmUgR1VEX1JPVEFUSU9OXzE4MAkJCUJJVCgyKQorICAjZGVmaW5lIEdVRF9ST1RBVElPTl8y
NzAJCQlCSVQoMykKKyAgI2RlZmluZSBHVURfUk9UQVRJT05fUkVGTEVDVF9YCQlCSVQoNCkKKyAg
I2RlZmluZSBHVURfUk9UQVRJT05fUkVGTEVDVF9ZCQlCSVQoNSkKKyAgI2RlZmluZSBHVURfUk9U
QVRJT05fTUFTSwkJCShHVURfUk9UQVRJT05fMCB8IEdVRF9ST1RBVElPTl85MCB8IFwKKwkJCQkJ
CUdVRF9ST1RBVElPTl8xODAgfCBHVURfUk9UQVRJT05fMjcwIHwgXAorCQkJCQkJR1VEX1JPVEFU
SU9OX1JFRkxFQ1RfWCB8IEdVRF9ST1RBVElPTl9SRUZMRUNUX1kpCisKKy8qIFVTQiBDb250cm9s
IHJlcXVlc3RzOiAqLworCisvKiBHZXQgc3RhdHVzIGZyb20gdGhlIGxhc3QgR0VUL1NFVCBjb250
cm9sIHJlcXVlc3QuIFZhbHVlIGlzIHU4LiAqLworI2RlZmluZSBHVURfUkVRX0dFVF9TVEFUVVMJ
CQkJMHgwMAorICAvKiBTdGF0dXMgdmFsdWVzOiAqLworICAjZGVmaW5lIEdVRF9TVEFUVVNfT0sJ
CQkJMHgwMAorICAjZGVmaW5lIEdVRF9TVEFUVVNfQlVTWQkJCTB4MDEKKyAgI2RlZmluZSBHVURf
U1RBVFVTX1JFUVVFU1RfTk9UX1NVUFBPUlRFRAkweDAyCisgICNkZWZpbmUgR1VEX1NUQVRVU19Q
Uk9UT0NPTF9FUlJPUgkJMHgwMworICAjZGVmaW5lIEdVRF9TVEFUVVNfSU5WQUxJRF9QQVJBTUVU
RVIJCTB4MDQKKyAgI2RlZmluZSBHVURfU1RBVFVTX0VSUk9SCQkJMHgwNQorCisvKiBHZXQgZGlz
cGxheSBkZXNjcmlwdG9yIGFzIGEgJmd1ZF9kaXNwbGF5X2Rlc2NyaXB0b3JfcmVxICovCisjZGVm
aW5lIEdVRF9SRVFfR0VUX0RFU0NSSVBUT1IJCQkJMHgwMQorCisvKgorICogSWYgdGhlIGhvc3Qg
ZHJpdmVyIGRvZXNuJ3Qgc3VwcG9ydCB0aGUgZGV2aWNlIHByb3RvY29sIHZlcnNpb24gaXQgd2ls
bCBzZW5kIHRoZSB2ZXJzaW9ucyBpdAorICogc3VwcG9ydHMgc3RhcnRpbmcgd2l0aCB0aGUgbGF0
ZXN0LiBJZiB0aGUgZGV2aWNlIGlzbid0IGJhY2t3YXJkcyBjb21wYXRpYmxlIG9yIGRvZXNuJ3Qg
c3VwcG9ydAorICogdGhlIHZlcnNpb24gdGhlIGhvc3Qgc3VnZ2VzdHMsIGl0IHNoYWxsIHN0YWxs
IHRoZSByZXF1ZXN0LiBUaGUgdmVyc2lvbiBpcyBzZW50IGFzIHU4LgorICovCisjZGVmaW5lIEdV
RF9SRVFfU0VUX1ZFUlNJT04JCQkJMHgzMAorCisvKiBHZXQgc3VwcG9ydGVkIHBpeGVsIGZvcm1h
dHMgYXMgYSBieXRlIGFycmF5IG9mIEdVRF9QSVhFTF9GT1JNQVRfKiAqLworI2RlZmluZSBHVURf
UkVRX0dFVF9GT1JNQVRTCQkJCTB4NDAKKyAgLyogUjEgaXMgYSAxLWJpdCBtb25vY2hyb21lIHRy
YW5zZmVyIGZvcm1hdCBwcmVzZW50ZWQgdG8gdXNlcnNwYWNlIGFzIFhSR0I4ODg4ICovCisgICNk
ZWZpbmUgR1VEX1BJWEVMX0ZPUk1BVF9SMQkJCTB4MDEKKyAgI2RlZmluZSBHVURfUElYRUxfRk9S
TUFUX1JHQjU2NQkJMHg0MAorICAjZGVmaW5lIEdVRF9QSVhFTF9GT1JNQVRfWFJHQjg4ODgJCTB4
ODAKKyAgI2RlZmluZSBHVURfUElYRUxfRk9STUFUX0FSR0I4ODg4CQkweDgxCisKKy8qCisgKiBH
ZXQgc3VwcG9ydGVkIHByb3BlcnRpZXMgdGhhdCBhcmUgbm90IGNvbm5lY3RvciBwcm9wZXRpZXMg
YXMgYSAmZ3VkX3Byb3BlcnR5X3JlcSBhcnJheS4KKyAqIGd1ZF9wcm9wZXJ0eV9yZXEudmFsIG9m
dGVuIGNvbnRhaW5zIHRoZSBpbml0aWFsIHZhbHVlIGZvciB0aGUgcHJvcGVydHkuCisgKi8KKyNk
ZWZpbmUgR1VEX1JFUV9HRVRfUFJPUEVSVElFUwkJCQkweDQxCisKKy8qIENvbm5lY3RvciByZXF1
ZXN0cyBoYXZlIHRoZSBjb25uZWN0b3IgaW5kZXggcGFzc2VkIGluIHRoZSB3VmFsdWUgZmllbGQg
Ki8KKworLyogR2V0IGNvbm5lY3RvciBkZXNjcmlwdG9yIGFzIGEgJmd1ZF9jb25uZWN0b3JfZGVz
Y3JpcHRvcl9yZXEgKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfQ09OTkVDVE9SCQkJCTB4NTAKKwor
LyoKKyAqIEdldCBwcm9wZXJ0aWVzIHN1cHBvcnRlZCBieSB0aGUgY29ubmVjdG9yIGFzIGEgJmd1
ZF9wcm9wZXJ0eV9yZXEgYXJyYXkuCisgKiBndWRfcHJvcGVydHlfcmVxLnZhbCBvZnRlbiBjb250
YWlucyB0aGUgaW5pdGlhbCB2YWx1ZSBmb3IgdGhlIHByb3BlcnR5LgorICovCisjZGVmaW5lIEdV
RF9SRVFfR0VUX0NPTk5FQ1RPUl9QUk9QRVJUSUVTCQkweDUxCisKKy8qCisgKiBJc3N1ZWQgd2hl
biB0aGVyZSdzIGEgVFZfTU9ERSBwcm9wZXJ0eSBwcmVzZW50LgorICogR2V0cyBhbiBhcnJheSBv
ZiB0aGUgc3VwcG9ydGVkIFRWX01PREUgbmFtZXMgZWFjaCBlbnRyeSBvZiBsZW5ndGgKKyAqIEdV
RF9DT05ORUNUT1JfVFZfTU9ERV9OQU1FX0xFTi4gTmFtZXMgbXVzdCBiZSBOVUwtdGVybWluYXRl
ZC4KKyAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNUT1JfVFZfTU9ERV9WQUxVRVMJCTB4
NTIKKyAgI2RlZmluZSBHVURfQ09OTkVDVE9SX1RWX01PREVfTkFNRV9MRU4JMTYKKworLyogV2hl
biB1c2Vyc3BhY2UgY2hlY2tzIGNvbm5lY3RvciBzdGF0dXMsIHRoaXMgaXMgaXNzdWVkIGZpcnN0
LCBub3QgdXNlZCBmb3IgcG9sbCByZXF1ZXN0cy4gKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfQ09O
TkVDVE9SX0ZPUkNFX0RFVEVDVAkJMHg1MworCisvKiBHZXQgY29ubmVjdG9yIHN0YXR1cyBhcyAm
Z3VkX2Nvbm5lY3Rvcl9zdGF0dXNfcmVxLiAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNU
T1JfU1RBVFVTCQkJMHg1NAorCisvKiBHZXQgJmd1ZF9kaXNwbGF5X21vZGVfcmVxIGFycmF5IG9m
IHN1cHBvcnRlZCBkaXNwbGF5IG1vZGVzICovCisjZGVmaW5lIEdVRF9SRVFfR0VUX0NPTk5FQ1RP
Ul9NT0RFUwkJCTB4NTUKKworLyogR2V0IEV4dGVuZGVkIERpc3BsYXkgSWRlbnRpZmljYXRpb24g
RGF0YSAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNUT1JfRURJRAkJCTB4NTYKKworLyog
U2V0IGJ1ZmZlciBwcm9wZXJ0aWVzIGJlZm9yZSBidWxrIHRyYW5zZmVyIGFzICZndWRfc2V0X2J1
ZmZlcl9yZXEgKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfQlVGRkVSCQkJCTB4NjAKKworLyogQ2hl
Y2sgZGlzcGxheSBjb25maWd1cmF0aW9uIGFzICZndWRfc3RhdGVfcmVxICovCisjZGVmaW5lIEdV
RF9SRVFfU0VUX1NUQVRFX0NIRUNLCQkJCTB4NjEKKworLyogQXBwbHkgdGhlIHByZXZpb3VzIFNU
QVRFX0NIRUNLIGNvbmZpZ3VyYXRpb24gKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfU1RBVEVfQ09N
TUlUCQkJMHg2MgorCisvKiBFbmFibGUvZGlzYWJsZSB0aGUgZGlzcGxheSBjb250cm9sbGVyLCB2
YWx1ZSBpcyB1ODogMC8xICovCisjZGVmaW5lIEdVRF9SRVFfU0VUX0NPTlRST0xMRVJfRU5BQkxF
CQkJMHg2MworCisvKiBFbmFibGUvZGlzYWJsZSBkaXNwbGF5L291dHB1dCAoRFBNUyksIHZhbHVl
IGlzIHU4OiAwLzEgKi8KKyNkZWZpbmUgR1VEX1JFUV9TRVRfRElTUExBWV9FTkFCTEUJCQkweDY0
CisKKyNlbmRpZgotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWwK
