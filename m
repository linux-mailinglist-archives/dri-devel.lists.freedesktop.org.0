Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2A10AB0BB5
	for <lists+dri-devel@lfdr.de>; Thu, 12 Sep 2019 11:41:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 942CB6EC52;
	Thu, 12 Sep 2019 09:41:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x643.google.com (mail-pl1-x643.google.com
 [IPv6:2607:f8b0:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4EBC66EC52
 for <dri-devel@lists.freedesktop.org>; Thu, 12 Sep 2019 09:41:29 +0000 (UTC)
Received: by mail-pl1-x643.google.com with SMTP id m9so11557236pls.8
 for <dri-devel@lists.freedesktop.org>; Thu, 12 Sep 2019 02:41:29 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=K8HzPj4CjTGqPIMExQrkFd76q28JYrYuyRqYSNyq/4c=;
 b=sbI4IorPcf2PNyx9iVTN5phnixnkb7hyu9r8AeK+jiXVOpQO7fdAAMXbQCeTVkCWAH
 8Tk4zsj9N3qJSAKLyVYRtiYevU+pscrYqdr7DBbkDIUC0BMvSGP46FGoOhaKMuz4gyzr
 Lzzn5huSDzhjB11pH2LPX2A4ebT9lyJhzfZ++vPnnLiRWoePVeAlVowQdEBZuZ5owHjx
 J8DIf6vg99yzgVQ7QcrxeBAlN1E1gZI7O/hoZsQqbRjUKW7yRnL79kQgiQA3YCO+VC17
 CFNyb6hrUpydyBRTDgAl3NQXM0mJR7bISisNRhm2jixVAYqoXRHNbV9DQb/zfV4eyox4
 V+mw==
X-Gm-Message-State: APjAAAXappqnL9hkDtR0sAPv1gyV4+ZjKopl7Hx0LSqCNdzQIwxj/DFe
 9f9ovtaitkHimWHGfaCyfxK3ajB1xHyN0Q==
X-Google-Smtp-Source: APXvYqzQKWP7aloYWrXlntiae1FVI/aefxFeH7mogABRe7PTrChaxwCSGskZ9qq5ospmeBNmBWjUbg==
X-Received: by 2002:a17:902:7b83:: with SMTP id
 w3mr12476006pll.3.1568281288738; 
 Thu, 12 Sep 2019 02:41:28 -0700 (PDT)
Received: from tfiga.tok.corp.google.com ([2401:fa00:4:4:6d27:f13:a0fa:d4b6])
 by smtp.gmail.com with ESMTPSA id
 o195sm5695859pfg.21.2019.09.12.02.41.25
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 12 Sep 2019 02:41:27 -0700 (PDT)
From: Tomasz Figa <tfiga@chromium.org>
To: David Airlie <airlied@linux.ie>, Gerd Hoffmann <kraxel@redhat.com>,
 Daniel Vetter <daniel@ffwll.ch>
Subject: [RFC PATCH] drm/virtio: Export resource handles via DMA-buf API
Date: Thu, 12 Sep 2019 18:41:21 +0900
Message-Id: <20190912094121.228435-1-tfiga@chromium.org>
X-Mailer: git-send-email 2.23.0.237.gc6a4ce50a0-goog
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=chromium.org; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=K8HzPj4CjTGqPIMExQrkFd76q28JYrYuyRqYSNyq/4c=;
 b=krDbwbOe6wjzVfF+U/pzAmXMrxhr3mUnguYMgh1Z7TqK9V/mvbvDLpDDq2aMYgpeWB
 T/ZsDxX0c8C5Pdg+UWgvKE8kCigOpvO+SYxItjUi61wMEXRogSlArgu7AfUDs3G+5/Q5
 aj60bXXpSg9XxqhtXX9cleM+9cHxoUU7fLFHU=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: zachr@chromium.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, virtualization@lists.linux-foundation.org,
 keiichiw@chromium.org, stevensd@chromium.org, marcheu@chromium.org,
 Tomasz Figa <tfiga@chromium.org>, posciak@chromium.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBpcyBhbiBlYXJseSBSRkMgdG8ganVkZ2UgdGhlIGRpcmVjdGlvbiB3ZSBhcmUg
Zm9sbG93aW5nIGluCm91ciB2aXJ0dWFsaXphdGlvbiBlZmZvcnRzIGluIENocm9tZSBPUy4gVGhl
IHB1cnBvc2UgaXMgdG8gc3RhcnQgYQpkaXNjdXNzaW9uIG9uIGhvdyB0byBoYW5kbGUgYnVmZmVy
IHNoYXJpbmcgYmV0d2VlbiBtdWx0aXBsZSB2aXJ0aW8KZGV2aWNlcy4KCk9uIGEgc2lkZSBub3Rl
LCB3ZSBhcmUgYWxzbyB3b3JraW5nIG9uIGEgdmlydGlvIHZpZGVvIGRlY29kZXIgaW50ZXJmYWNl
CmFuZCBpbXBsZW1lbnRhdGlvbiwgd2l0aCBhIFY0TDIgZHJpdmVyIGZvciBMaW51eC4gVGhvc2Ug
d2lsbCBiZSBwb3N0ZWQKZm9yIHJldmlldyBpbiB0aGUgbmVhciBmdXR1cmUgYXMgd2VsbC4KCkFu
eSBmZWVkYmFjayB3aWxsIGJlIGFwcHJlY2lhdGVkISBUaGFua3MgaW4gYWR2YW5jZS4KCj09PQoK
V2l0aCB0aGUgcmFuZ2Ugb2YgdXNlIGNhc2VzIGZvciB2aXJ0dWFsaXphdGlvbiBleHBhbmRpbmcs
IHRoZXJlIGlzIGdvaW5nCnRvIGJlIG1vcmUgdmlydGlvIGRldmljZXMgYWRkZWQgdG8gdGhlIGVj
b3N5c3RlbS4gRGV2aWNlcyBzdWNoIGFzIHZpZGVvCmRlY29kZXJzLCBlbmNvZGVycywgY2FtZXJh
cywgZXRjLiB0eXBpY2FsbHkgd29yayB0b2dldGhlciB3aXRoIHRoZQpkaXNwbGF5IGFuZCBHUFUg
aW4gYSBwaXBlbGluZSBtYW5uZXIsIHdoaWNoIGNhbiBvbmx5IGJlIGltcGxlbWVudGVkCmVmZmlj
aWVudGx5IGJ5IHNoYXJpbmcgdGhlIGJ1ZmZlcnMgYmV0d2VlbiBwcm9kdWNlcnMgYW5kIGNvbnN1
bWVycy4KCkV4aXN0aW5nIGJ1ZmZlciBtYW5hZ2VtZW50IGZyYW1ld29yayBpbiBMaW51eCwgc3Vj
aCBhcyB0aGUgdmlkZW9idWYyCmZyYW1ld29yayBpbiBWNEwyLCBpbXBsZW1lbnRzIGFsbCB0aGUg
RE1BLWJ1ZiBoYW5kbGluZyBpbnNpZGUgZ2VuZXJpYwpjb2RlIGFuZCBkbyBub3QgZXhwb3NlIGFu
eSBsb3cgbGV2ZWwgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGJ1ZmZlcnMgdG8KdGhlIGRyaXZlcnMu
CgpUbyBzZWFtbGVzc2x5IGVuYWJsZSBidWZmZXIgc2hhcmluZyB3aXRoIGRyaXZlcnMgdXNpbmcg
c3VjaCBmcmFtZXdvcmtzLAptYWtlIHRoZSB2aXJ0aW8tZ3B1IGRyaXZlciBleHBvc2UgdGhlIHJl
c291cmNlIGhhbmRsZSBhcyB0aGUgRE1BIGFkZHJlc3MKb2YgdGhlIGJ1ZmZlciByZXR1cm5lZCBm
cm9tIHRoZSBETUEtYnVmIG1hcHBpbmcgb3BlcmF0aW9uLiBBcmd1YWJseSwgdGhlCnJlc291cmNl
IGhhbmRsZSBpcyBhIGtpbmQgb2YgRE1BIGFkZHJlc3MgYWxyZWFkeSwgYXMgaXQgaXMgdGhlIGJ1
ZmZlcgppZGVudGlmaWVyIHRoYXQgdGhlIGRldmljZSBuZWVkcyB0byBhY2Nlc3MgdGhlIGJhY2tp
bmcgbWVtb3J5LCB3aGljaCBpcwpleGFjdGx5IHRoZSBzYW1lIHJvbGUgYSBETUEgYWRkcmVzcyBw
cm92aWRlcyBmb3IgbmF0aXZlIGRldmljZXMuCgpBIHZpcnRpbyBkcml2ZXIgdGhhdCBkb2VzIG1l
bW9yeSBtYW5hZ2VtZW50IGZ1bGx5IG9uIGl0cyBvd24gd291bGQgaGF2ZQpjb2RlIHNpbWlsYXIg
dG8gZm9sbG93aW5nLiBUaGUgY29kZSBpcyBpZGVudGljYWwgdG8gd2hhdCBhIHJlZ3VsYXIKZHJp
dmVyIGZvciByZWFsIGhhcmR3YXJlIHdvdWxkIGRvIHRvIGltcG9ydCBhIERNQS1idWYuCgpzdGF0
aWMgaW50IHZpcnRpb19mb29fZ2V0X3Jlc291cmNlX2hhbmRsZShzdHJ1Y3QgdmlydGlvX2ZvbyAq
Zm9vLAoJCQkJCSAgc3RydWN0IGRtYV9idWYgKmRtYV9idWYsIHUzMiAqaWQpCnsKCXN0cnVjdCBk
bWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKCXN0cnVjdCBzZ190YWJsZSAqc2d0OwoJaW50IHJl
dCA9IDA7CgoJYXR0YWNoID0gZG1hX2J1Zl9hdHRhY2goZG1hX2J1ZiwgZm9vLT5kZXYpOwoJaWYg
KElTX0VSUihhdHRhY2gpKQoJCXJldHVybiBQVFJfRVJSKGF0dGFjaCk7CgoJc2d0ID0gZG1hX2J1
Zl9tYXBfYXR0YWNobWVudChhdHRhY2gsIERNQV9CSURJUkVDVElPTkFMKTsKCWlmIChJU19FUlIo
c2d0KSkgewoJCXJldCA9IFBUUl9FUlIoc2d0KTsKCQlnb3RvIGVycl9kZXRhY2g7Cgl9CgoJaWYg
KHNndC0+bmVudHMgIT0gMSkgewoJCXJldCA9IC1FSU5WQUw7CgkJZ290byBlcnJfdW5tYXA7Cgl9
CgoJKmlkID0gc2dfZG1hX2FkZHJlc3Moc2d0LT5zZ2wpOwoKZXJyX3VubWFwOgoJZG1hX2J1Zl91
bm1hcF9hdHRhY2htZW50KGF0dGFjaCwgc2d0LCBETUFfQklESVJFQ1RJT05BTCk7CmVycl9kZXRh
Y2g6CglkbWFfYnVmX2RldGFjaChkbWFfYnVmLCBhdHRhY2gpOwoKCXJldHVybiByZXQ7Cn0KCk9u
IHRoZSBvdGhlciBoYW5kLCBhIHZpcnRpbyBkcml2ZXIgdGhhdCB1c2VzIGFuIGV4aXN0aW5nIGtl
cm5lbApmcmFtZXdvcmsgdG8gbWFuYWdlIGJ1ZmZlcnMgd291bGQgbm90IG5lZWQgdG8gZXhwbGlj
aXRseSBoYW5kbGUgYW55dGhpbmcKYXQgYWxsLCBhcyB0aGUgZnJhbWV3b3JrIHBhcnQgcmVzcG9u
c2libGUgZm9yIGltcG9ydGluZyBETUEtYnVmcyB3b3VsZAphbHJlYWR5IGRvIHRoZSB3b3JrLiBG
b3IgZXhhbXBsZSwgYSBWNEwyIGRyaXZlciB1c2luZyB0aGUgdmlkZW9idWYyCmZyYW1ld29yayB3
b3VsZCBqdXN0IGNhbGwgdGhlZSB2YjJfZG1hX2NvbnRpZ19wbGFuZV9kbWFfYWRkcigpIGZ1bmN0
aW9uCnRvIGdldCB3aGF0IHRoZSBhYm92ZSBvcGVuLWNvZGVkIGZ1bmN0aW9uIHdvdWxkIHJldHVy
bi4KClNpZ25lZC1vZmYtYnk6IFRvbWFzeiBGaWdhIDx0ZmlnYUBjaHJvbWl1bS5vcmc+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5jICAgfCAgMiArCiBkcml2ZXJzL2dw
dS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmggICB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vdmly
dGlvL3ZpcnRncHVfcHJpbWUuYyB8IDgxICsrKysrKysrKysrKysrKysrKysrKysrKysrCiAzIGZp
bGVzIGNoYW5nZWQsIDg3IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
ZHJ2LmMKaW5kZXggMGZjMzJmYTBiM2MwLi5hYzA5NWY4MTMxMzQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmly
dGlvL3ZpcnRncHVfZHJ2LmMKQEAgLTIxMCw2ICsyMTAsOCBAQCBzdGF0aWMgc3RydWN0IGRybV9k
cml2ZXIgZHJpdmVyID0gewogI2VuZGlmCiAJLnByaW1lX2hhbmRsZV90b19mZCA9IGRybV9nZW1f
cHJpbWVfaGFuZGxlX3RvX2ZkLAogCS5wcmltZV9mZF90b19oYW5kbGUgPSBkcm1fZ2VtX3ByaW1l
X2ZkX3RvX2hhbmRsZSwKKwkuZ2VtX3ByaW1lX2V4cG9ydCA9IHZpcnRncHVfZ2VtX3ByaW1lX2V4
cG9ydCwKKwkuZ2VtX3ByaW1lX2ltcG9ydCA9IHZpcnRncHVfZ2VtX3ByaW1lX2ltcG9ydCwKIAku
Z2VtX3ByaW1lX2dldF9zZ190YWJsZSA9IHZpcnRncHVfZ2VtX3ByaW1lX2dldF9zZ190YWJsZSwK
IAkuZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSA9IHZpcnRncHVfZ2VtX3ByaW1lX2ltcG9ydF9z
Z190YWJsZSwKIAkuZ2VtX3ByaW1lX3ZtYXAgPSB2aXJ0Z3B1X2dlbV9wcmltZV92bWFwLApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oIGIvZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCmluZGV4IGUyODgyOTY2MTcyNC4uNjg3Y2ZjZTkx
ODg1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCkBAIC0zNjcsNiArMzY3LDEw
IEBAIHZvaWQgdmlydGlvX2dwdV9vYmplY3RfZnJlZV9zZ190YWJsZShzdHJ1Y3QgdmlydGlvX2dw
dV9vYmplY3QgKmJvKTsKIGludCB2aXJ0aW9fZ3B1X29iamVjdF93YWl0KHN0cnVjdCB2aXJ0aW9f
Z3B1X29iamVjdCAqYm8sIGJvb2wgbm9fd2FpdCk7CiAKIC8qIHZpcnRncHVfcHJpbWUuYyAqLwor
c3RydWN0IGRtYV9idWYgKnZpcnRncHVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKm9iaiwKKwkJCQkJIGludCBmbGFncyk7CitzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnZp
cnRncHVfZ2VtX3ByaW1lX2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkJCQkJc3Ry
dWN0IGRtYV9idWYgKmJ1Zik7CiBzdHJ1Y3Qgc2dfdGFibGUgKnZpcnRncHVfZ2VtX3ByaW1lX2dl
dF9zZ190YWJsZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiBzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKnZpcnRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSgKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfcHJpbWUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vdmlydGdwdV9wcmltZS5jCmluZGV4IGRjNjQyYTg4NGI4OC4uNTYyZWIxYTJlZDVi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfcHJpbWUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfcHJpbWUuYwpAQCAtMjIsNiArMjIsOSBA
QAogICogQXV0aG9yczogQW5kcmVhcyBQb2tvcm55CiAgKi8KIAorI2luY2x1ZGUgPGxpbnV4L2Rt
YS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZGlyZWN0aW9uLmg+CisKICNpbmNsdWRlIDxk
cm0vZHJtX3ByaW1lLmg+CiAKICNpbmNsdWRlICJ2aXJ0Z3B1X2Rydi5oIgpAQCAtMzAsNiArMzMs
ODQgQEAKICAqIGRldmljZSB0aGF0IG1pZ2h0IHNoYXJlIGJ1ZmZlcnMgd2l0aCB2aXJ0Z3B1CiAg
Ki8KIAorc3RhdGljIHN0cnVjdCBzZ190YWJsZSAqCit2aXJ0Z3B1X2dlbV9tYXBfZG1hX2J1Zihz
dHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCisJCQllbnVtIGRtYV9kYXRhX2RpcmVj
dGlvbiBkaXIpCit7CisJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBhdHRhY2gtPmRtYWJ1
Zi0+cHJpdjsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3ZpcnRpb19n
cHVfb2JqKG9iaik7CisJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisJaW50IHJldDsKKworCXNndCA9
IGt6YWxsb2Moc2l6ZW9mKCpzZ3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXNndCkKKwkJcmV0dXJu
IEVSUl9QVFIoLUVOT01FTSk7CisKKwlyZXQgPSBzZ19hbGxvY190YWJsZShzZ3QsIDEsIEdGUF9L
RVJORUwpOworCWlmIChyZXQpIHsKKwkJa2ZyZWUoc2d0KTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVO
T01FTSk7CisJfQorCisJc2dfZG1hX2FkZHJlc3Moc2d0LT5zZ2wpID0gYm8tPmh3X3Jlc19oYW5k
bGU7CisJc2dfZG1hX2xlbihzZ3QtPnNnbCkgPSBvYmotPnNpemU7CisJc2d0LT5uZW50cyA9IDE7
CisKKwlyZXR1cm4gc2d0OworfQorCitzdGF0aWMgdm9pZCB2aXJ0Z3B1X2dlbV91bm1hcF9kbWFf
YnVmKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKKwkJCQkgICAgICBzdHJ1Y3Qg
c2dfdGFibGUgKnNndCwKKwkJCQkgICAgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCit7
CisJc2dfZnJlZV90YWJsZShzZ3QpOworCWtmcmVlKHNndCk7Cit9CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgZG1hX2J1Zl9vcHMgdmlydGdwdV9kbWFidWZfb3BzID0gIHsKKwkuY2FjaGVfc2d0X21h
cHBpbmcgPSB0cnVlLAorCS5hdHRhY2ggPSBkcm1fZ2VtX21hcF9hdHRhY2gsCisJLmRldGFjaCA9
IGRybV9nZW1fbWFwX2RldGFjaCwKKwkubWFwX2RtYV9idWYgPSB2aXJ0Z3B1X2dlbV9tYXBfZG1h
X2J1ZiwKKwkudW5tYXBfZG1hX2J1ZiA9IHZpcnRncHVfZ2VtX3VubWFwX2RtYV9idWYsCisJLnJl
bGVhc2UgPSBkcm1fZ2VtX2RtYWJ1Zl9yZWxlYXNlLAorCS5tbWFwID0gZHJtX2dlbV9kbWFidWZf
bW1hcCwKKwkudm1hcCA9IGRybV9nZW1fZG1hYnVmX3ZtYXAsCisJLnZ1bm1hcCA9IGRybV9nZW1f
ZG1hYnVmX3Z1bm1hcCwKK307CisKK3N0cnVjdCBkbWFfYnVmICp2aXJ0Z3B1X2dlbV9wcmltZV9l
eHBvcnQoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCisJCQkJCSBpbnQgZmxhZ3MpCit7CisJ
c3RydWN0IGRtYV9idWYgKmJ1ZjsKKworCWJ1ZiA9IGRybV9nZW1fcHJpbWVfZXhwb3J0KG9iaiwg
ZmxhZ3MpOworCWlmICghSVNfRVJSKGJ1ZikpCisJCWJ1Zi0+b3BzID0gJnZpcnRncHVfZG1hYnVm
X29wczsKKworCXJldHVybiBidWY7Cit9CisKK3N0cnVjdCBkcm1fZ2VtX29iamVjdCAqdmlydGdw
dV9nZW1fcHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJCQlzdHJ1Y3Qg
ZG1hX2J1ZiAqYnVmKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqOworCisJaWYgKGJ1
Zi0+b3BzID09ICZ2aXJ0Z3B1X2RtYWJ1Zl9vcHMpIHsKKwkJb2JqID0gYnVmLT5wcml2OworCQlp
ZiAob2JqLT5kZXYgPT0gZGV2KSB7CisJCQkvKgorCQkJICogSW1wb3J0aW5nIGRtYWJ1ZiBleHBv
cnRlZCBmcm9tIG91ciBvd24gZ2VtIGluY3JlYXNlcworCQkJICogcmVmY291bnQgb24gZ2VtIGl0
c2VsZiBpbnN0ZWFkIG9mIGZfY291bnQgb2YgZG1hYnVmLgorCQkJICovCisJCQlkcm1fZ2VtX29i
amVjdF9nZXQob2JqKTsKKwkJCXJldHVybiBvYmo7CisJCX0KKwl9CisKKwlyZXR1cm4gZHJtX2dl
bV9wcmltZV9pbXBvcnQoZGV2LCBidWYpOworfQorCiBzdHJ1Y3Qgc2dfdGFibGUgKnZpcnRncHVf
Z2VtX3ByaW1lX2dldF9zZ190YWJsZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKIHsKIAlz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3ZpcnRpb19ncHVfb2JqKG9iaik7
Ci0tIAoyLjIzLjAuMjM3LmdjNmE0Y2U1MGEwLWdvb2cKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
