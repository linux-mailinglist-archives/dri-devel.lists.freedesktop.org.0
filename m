Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 005928DCFA
	for <lists+dri-devel@lfdr.de>; Wed, 14 Aug 2019 20:27:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BC59C6E7B2;
	Wed, 14 Aug 2019 18:26:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D12596E7B2;
 Wed, 14 Aug 2019 18:26:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18112851-1500050 for multiple; Wed, 14 Aug 2019 19:26:46 +0100
MIME-Version: 1.0
To: dri-devel@lists.freedesktop.org
From: Chris Wilson <chris@chris-wilson.co.uk>
In-Reply-To: <20190814182401.25009-1-chris@chris-wilson.co.uk>
References: <20190814182401.25009-1-chris@chris-wilson.co.uk>
Message-ID: <156580720475.2301.10315695252933421468@skylake-alporthouse-com>
User-Agent: alot/0.6
Subject: Re: [PATCH] dma-buf: Restore seqlock around dma_resv updates
Date: Wed, 14 Aug 2019 19:26:44 +0100
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>, intel-gfx@lists.freedesktop.org,
 =?utf-8?q?Christian_K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UXVvdGluZyBDaHJpcyBXaWxzb24gKDIwMTktMDgtMTQgMTk6MjQ6MDEpCj4gVGhpcyByZXZlcnRz
Cj4gNjdjOTdmYjc5YTdmICgiZG1hLWJ1ZjogYWRkIHJlc2VydmF0aW9uX29iamVjdF9mZW5jZXMg
aGVscGVyIikKPiBkZDdhN2QxZmYyZjEgKCJkcm0vaTkxNTogdXNlIG5ldyByZXNlcnZhdGlvbl9v
YmplY3RfZmVuY2VzIGhlbHBlciIpCj4gMGUxZDgwODNiZGRiICgiZG1hLWJ1ZjogZnVydGhlciBy
ZWxheCByZXNlcnZhdGlvbl9vYmplY3RfYWRkX3NoYXJlZF9mZW5jZSIpCj4gNWQzNDRmNThkYTc2
ICgiZG1hLWJ1ZjogbnVrZSByZXNlcnZhdGlvbl9vYmplY3Qgc2VxIG51bWJlciIpCj4gCj4gVGhl
IHNjZW5hcmlvIHRoYXQgZGVmZWF0cyBzaW1wbHkgZ3JhYmJpbmcgYSBzZXQgb2Ygc2hhcmVkL2V4
Y2x1c2l2ZQo+IGZlbmNlcyBhbmQgdXNpbmcgdGhlbSBibGlzc2Z1bGx5IHVuZGVyIFJDVSBpcyB0
aGF0IGFueSBvZiB0aG9zZSBmZW5jZXMKPiBtYXkgYmUgcmVhbGxvY2F0ZWQgYnkgYSBTTEFCX1RZ
UEVTQUZFX0JZX1JDVSBmZW5jZSBzbGFiIGNhY2hlLiBJbiB0aGlzCj4gc2NlbmFyaW8sIHdoaWxl
IGtlZXBpbmcgdGhlIHJjdV9yZWFkX2xvY2sgd2UgbmVlZCB0byBlc3RhYmxpc2ggdGhhdCBubwo+
IGZlbmNlIHdhcyBjaGFuZ2VkIGluIHRoZSBkbWFfcmVzdiBhZnRlciBhIHJlYWQgKG9yIGZ1bGwp
IG1lbW9yeSBiYXJyaWVyLgo+IAo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNA
Y2hyaXMtd2lsc29uLmNvLnVrPgo+IENjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KCkkgc2FpZCBJIG5lZWRlZCB0byBnbyBsaWUgZG93biwgdGhhdCBwcm92ZXMgaXQu
CgpDYzogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgoKPiBDYzog
RGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KPiAtLS0KPiAgZHJpdmVycy9k
bWEtYnVmL2RtYS1idWYuYyAgICAgICAgICAgICAgICAgICAgIHwgIDMxICsrKystCj4gIGRyaXZl
cnMvZG1hLWJ1Zi9kbWEtcmVzdi5jICAgICAgICAgICAgICAgICAgICB8IDEwOSArKysrKysrKysr
KystLS0tLQo+ICAuLi4vZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAg
fCAgIDcgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2J1c3kuYyAgICAg
IHwgIDI0ICsrLS0KPiAgaW5jbHVkZS9saW51eC9kbWEtcmVzdi5oICAgICAgICAgICAgICAgICAg
ICAgIHwgMTEzICsrKysrKysrLS0tLS0tLS0tLQo+ICA1IGZpbGVzIGNoYW5nZWQsIDE3NSBpbnNl
cnRpb25zKCspLCAxMDkgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1h
LWJ1Zi9kbWEtYnVmLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jCj4gaW5kZXggYjM0MDBk
NjUyNGFiLi40MzNkOTFkNzEwZTQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1i
dWYuYwo+ICsrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVmLmMKPiBAQCAtMTk5LDcgKzE5OSw3
IEBAIHN0YXRpYyBfX3BvbGxfdCBkbWFfYnVmX3BvbGwoc3RydWN0IGZpbGUgKmZpbGUsIHBvbGxf
dGFibGUgKnBvbGwpCj4gICAgICAgICBzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqZm9iajsKPiAgICAg
ICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlX2V4Y2w7Cj4gICAgICAgICBfX3BvbGxfdCBldmVu
dHM7Cj4gLSAgICAgICB1bnNpZ25lZCBzaGFyZWRfY291bnQ7Cj4gKyAgICAgICB1bnNpZ25lZCBz
aGFyZWRfY291bnQsIHNlcTsKPiAgCj4gICAgICAgICBkbWFidWYgPSBmaWxlLT5wcml2YXRlX2Rh
dGE7Cj4gICAgICAgICBpZiAoIWRtYWJ1ZiB8fCAhZG1hYnVmLT5yZXN2KQo+IEBAIC0yMTMsOCAr
MjEzLDIxIEBAIHN0YXRpYyBfX3BvbGxfdCBkbWFfYnVmX3BvbGwoc3RydWN0IGZpbGUgKmZpbGUs
IHBvbGxfdGFibGUgKnBvbGwpCj4gICAgICAgICBpZiAoIWV2ZW50cykKPiAgICAgICAgICAgICAg
ICAgcmV0dXJuIDA7Cj4gIAo+ICtyZXRyeToKPiArICAgICAgIHNlcSA9IHJlYWRfc2VxY291bnRf
YmVnaW4oJnJlc3YtPnNlcSk7Cj4gICAgICAgICByY3VfcmVhZF9sb2NrKCk7Cj4gLSAgICAgICBk
bWFfcmVzdl9mZW5jZXMocmVzdiwgJmZlbmNlX2V4Y2wsICZmb2JqLCAmc2hhcmVkX2NvdW50KTsK
PiArCj4gKyAgICAgICBmb2JqID0gcmN1X2RlcmVmZXJlbmNlKHJlc3YtPmZlbmNlKTsKPiArICAg
ICAgIGlmIChmb2JqKQo+ICsgICAgICAgICAgICAgICBzaGFyZWRfY291bnQgPSBmb2JqLT5zaGFy
ZWRfY291bnQ7Cj4gKyAgICAgICBlbHNlCj4gKyAgICAgICAgICAgICAgIHNoYXJlZF9jb3VudCA9
IDA7Cj4gKyAgICAgICBmZW5jZV9leGNsID0gcmN1X2RlcmVmZXJlbmNlKHJlc3YtPmZlbmNlX2V4
Y2wpOwo+ICsgICAgICAgaWYgKHJlYWRfc2VxY291bnRfcmV0cnkoJnJlc3YtPnNlcSwgc2VxKSkg
ewo+ICsgICAgICAgICAgICAgICByY3VfcmVhZF91bmxvY2soKTsKPiArICAgICAgICAgICAgICAg
Z290byByZXRyeTsKPiArICAgICAgIH0KPiArCj4gICAgICAgICBpZiAoZmVuY2VfZXhjbCAmJiAo
IShldmVudHMgJiBFUE9MTE9VVCkgfHwgc2hhcmVkX2NvdW50ID09IDApKSB7Cj4gICAgICAgICAg
ICAgICAgIHN0cnVjdCBkbWFfYnVmX3BvbGxfY2JfdCAqZGNiID0gJmRtYWJ1Zi0+Y2JfZXhjbDsK
PiAgICAgICAgICAgICAgICAgX19wb2xsX3QgcGV2ZW50cyA9IEVQT0xMSU47Cj4gQEAgLTExNDQs
NiArMTE1Nyw3IEBAIHN0YXRpYyBpbnQgZG1hX2J1Zl9kZWJ1Z19zaG93KHN0cnVjdCBzZXFfZmls
ZSAqcywgdm9pZCAqdW51c2VkKQo+ICAgICAgICAgc3RydWN0IGRtYV9yZXN2ICpyb2JqOwo+ICAg
ICAgICAgc3RydWN0IGRtYV9yZXN2X2xpc3QgKmZvYmo7Cj4gICAgICAgICBzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKPiArICAgICAgIHVuc2lnbmVkIHNlcTsKPiAgICAgICAgIGludCBjb3VudCA9
IDAsIGF0dGFjaF9jb3VudCwgc2hhcmVkX2NvdW50LCBpOwo+ICAgICAgICAgc2l6ZV90IHNpemUg
PSAwOwo+ICAKPiBAQCAtMTE3NCw5ICsxMTg4LDE2IEBAIHN0YXRpYyBpbnQgZG1hX2J1Zl9kZWJ1
Z19zaG93KHN0cnVjdCBzZXFfZmlsZSAqcywgdm9pZCAqdW51c2VkKQo+ICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgYnVmX29iai0+bmFtZSA/OiAiIik7Cj4gIAo+ICAgICAgICAgICAg
ICAgICByb2JqID0gYnVmX29iai0+cmVzdjsKPiAtICAgICAgICAgICAgICAgcmN1X3JlYWRfbG9j
aygpOwo+IC0gICAgICAgICAgICAgICBkbWFfcmVzdl9mZW5jZXMocm9iaiwgJmZlbmNlLCAmZm9i
aiwgJnNoYXJlZF9jb3VudCk7Cj4gLSAgICAgICAgICAgICAgIHJjdV9yZWFkX3VubG9jaygpOwo+
ICsgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewo+ICsgICAgICAgICAgICAgICAgICAgICAg
IHNlcSA9IHJlYWRfc2VxY291bnRfYmVnaW4oJnJvYmotPnNlcSk7Cj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgcmN1X3JlYWRfbG9jaygpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGZvYmog
PSByY3VfZGVyZWZlcmVuY2Uocm9iai0+ZmVuY2UpOwo+ICsgICAgICAgICAgICAgICAgICAgICAg
IHNoYXJlZF9jb3VudCA9IGZvYmogPyBmb2JqLT5zaGFyZWRfY291bnQgOiAwOwo+ICsgICAgICAg
ICAgICAgICAgICAgICAgIGZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKHJvYmotPmZlbmNlX2V4Y2wp
Owo+ICsgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVhZF9zZXFjb3VudF9yZXRyeSgmcm9i
ai0+c2VxLCBzZXEpKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4g
KyAgICAgICAgICAgICAgICAgICAgICAgcmN1X3JlYWRfdW5sb2NrKCk7Cj4gKyAgICAgICAgICAg
ICAgIH0KPiAgCj4gICAgICAgICAgICAgICAgIGlmIChmZW5jZSkKPiAgICAgICAgICAgICAgICAg
ICAgICAgICBzZXFfcHJpbnRmKHMsICJcdEV4Y2x1c2l2ZSBmZW5jZTogJXMgJXMgJXNzaWduYWxs
ZWRcbiIsCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jIGIvZHJpdmVy
cy9kbWEtYnVmL2RtYS1yZXN2LmMKPiBpbmRleCBmNTE0MjY4M2M4NTEuLjQyYThmM2YxMTY4MSAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1hLXJlc3YuYwo+ICsrKyBiL2RyaXZlcnMv
ZG1hLWJ1Zi9kbWEtcmVzdi5jCj4gQEAgLTQ5LDYgKzQ5LDEyIEBACj4gIERFRklORV9XRF9DTEFT
UyhyZXNlcnZhdGlvbl93d19jbGFzcyk7Cj4gIEVYUE9SVF9TWU1CT0wocmVzZXJ2YXRpb25fd3df
Y2xhc3MpOwo+ICAKPiArc3RydWN0IGxvY2tfY2xhc3Nfa2V5IHJlc2VydmF0aW9uX3NlcWNvdW50
X2NsYXNzOwo+ICtFWFBPUlRfU1lNQk9MKHJlc2VydmF0aW9uX3NlcWNvdW50X2NsYXNzKTsKPiAr
Cj4gK2NvbnN0IGNoYXIgcmVzZXJ2YXRpb25fc2VxY291bnRfc3RyaW5nW10gPSAicmVzZXJ2YXRp
b25fc2VxY291bnQiOwo+ICtFWFBPUlRfU1lNQk9MKHJlc2VydmF0aW9uX3NlcWNvdW50X3N0cmlu
Zyk7Cj4gKwo+ICAvKioKPiAgICogZG1hX3Jlc3ZfbGlzdF9hbGxvYyAtIGFsbG9jYXRlIGZlbmNl
IGxpc3QKPiAgICogQHNoYXJlZF9tYXg6IG51bWJlciBvZiBmZW5jZXMgd2UgbmVlZCBzcGFjZSBm
b3IKPiBAQCAtOTYsNiArMTAyLDkgQEAgc3RhdGljIHZvaWQgZG1hX3Jlc3ZfbGlzdF9mcmVlKHN0
cnVjdCBkbWFfcmVzdl9saXN0ICpsaXN0KQo+ICB2b2lkIGRtYV9yZXN2X2luaXQoc3RydWN0IGRt
YV9yZXN2ICpvYmopCj4gIHsKPiAgICAgICAgIHd3X211dGV4X2luaXQoJm9iai0+bG9jaywgJnJl
c2VydmF0aW9uX3d3X2NsYXNzKTsKPiArCj4gKyAgICAgICBfX3NlcWNvdW50X2luaXQoJm9iai0+
c2VxLCByZXNlcnZhdGlvbl9zZXFjb3VudF9zdHJpbmcsCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgJnJlc2VydmF0aW9uX3NlcWNvdW50X2NsYXNzKTsKPiAgICAgICAgIFJDVV9JTklUX1BPSU5U
RVIob2JqLT5mZW5jZSwgTlVMTCk7Cj4gICAgICAgICBSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVu
Y2VfZXhjbCwgTlVMTCk7Cj4gIH0KPiBAQCAtMjI1LDYgKzIzNCw5IEBAIHZvaWQgZG1hX3Jlc3Zf
YWRkX3NoYXJlZF9mZW5jZShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgc3RydWN0IGRtYV9mZW5jZSAq
ZmVuY2UpCj4gICAgICAgICBmb2JqID0gZG1hX3Jlc3ZfZ2V0X2xpc3Qob2JqKTsKPiAgICAgICAg
IGNvdW50ID0gZm9iai0+c2hhcmVkX2NvdW50Owo+ICAKPiArICAgICAgIHByZWVtcHRfZGlzYWJs
ZSgpOwo+ICsgICAgICAgd3JpdGVfc2VxY291bnRfYmVnaW4oJm9iai0+c2VxKTsKPiArCj4gICAg
ICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewo+ICAKPiAgICAgICAgICAgICAgICAg
b2xkID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChmb2JqLT5zaGFyZWRbaV0sCj4gQEAgLTI0
Miw2ICsyNTQsOSBAQCB2b2lkIGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2Uoc3RydWN0IGRtYV9y
ZXN2ICpvYmosIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQo+ICAgICAgICAgUkNVX0lOSVRfUE9J
TlRFUihmb2JqLT5zaGFyZWRbaV0sIGZlbmNlKTsKPiAgICAgICAgIC8qIHBvaW50ZXIgdXBkYXRl
IG11c3QgYmUgdmlzaWJsZSBiZWZvcmUgd2UgZXh0ZW5kIHRoZSBzaGFyZWRfY291bnQgKi8KPiAg
ICAgICAgIHNtcF9zdG9yZV9tYihmb2JqLT5zaGFyZWRfY291bnQsIGNvdW50KTsKPiArCj4gKyAg
ICAgICB3cml0ZV9zZXFjb3VudF9lbmQoJm9iai0+c2VxKTsKPiArICAgICAgIHByZWVtcHRfZW5h
YmxlKCk7Cj4gICAgICAgICBkbWFfZmVuY2VfcHV0KG9sZCk7Cj4gIH0KPiAgRVhQT1JUX1NZTUJP
TChkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKTsKPiBAQCAtMjY5LDEwICsyODQsMTIgQEAgdm9p
ZCBkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgc3RydWN0IGRt
YV9mZW5jZSAqZmVuY2UpCj4gICAgICAgICAgICAgICAgIGRtYV9mZW5jZV9nZXQoZmVuY2UpOwo+
ICAKPiAgICAgICAgIHByZWVtcHRfZGlzYWJsZSgpOwo+IC0gICAgICAgcmN1X2Fzc2lnbl9wb2lu
dGVyKG9iai0+ZmVuY2VfZXhjbCwgZmVuY2UpOwo+IC0gICAgICAgLyogcG9pbnRlciB1cGRhdGUg
bXVzdCBiZSB2aXNpYmxlIGJlZm9yZSB3ZSBtb2RpZnkgdGhlIHNoYXJlZF9jb3VudCAqLwo+ICsg
ICAgICAgd3JpdGVfc2VxY291bnRfYmVnaW4oJm9iai0+c2VxKTsKPiArICAgICAgIC8qIHdyaXRl
X3NlcWNvdW50X2JlZ2luIHByb3ZpZGVzIHRoZSBuZWNlc3NhcnkgbWVtb3J5IGJhcnJpZXIgKi8K
PiArICAgICAgIFJDVV9JTklUX1BPSU5URVIob2JqLT5mZW5jZV9leGNsLCBmZW5jZSk7Cj4gICAg
ICAgICBpZiAob2xkKQo+IC0gICAgICAgICAgICAgICBzbXBfc3RvcmVfbWIob2xkLT5zaGFyZWRf
Y291bnQsIDApOwo+ICsgICAgICAgICAgICAgICBvbGQtPnNoYXJlZF9jb3VudCA9IDA7Cj4gKyAg
ICAgICB3cml0ZV9zZXFjb3VudF9lbmQoJm9iai0+c2VxKTsKPiAgICAgICAgIHByZWVtcHRfZW5h
YmxlKCk7Cj4gIAo+ICAgICAgICAgLyogaW5wbGFjZSB1cGRhdGUsIG5vIHNoYXJlZCBmZW5jZXMg
Ki8KPiBAQCAtMjk1LDE1ICszMTIsMTcgQEAgaW50IGRtYV9yZXN2X2NvcHlfZmVuY2VzKHN0cnVj
dCBkbWFfcmVzdiAqZHN0LCBzdHJ1Y3QgZG1hX3Jlc3YgKnNyYykKPiAgewo+ICAgICAgICAgc3Ry
dWN0IGRtYV9yZXN2X2xpc3QgKnNyY19saXN0LCAqZHN0X2xpc3Q7Cj4gICAgICAgICBzdHJ1Y3Qg
ZG1hX2ZlbmNlICpvbGQsICpuZXc7Cj4gLSAgICAgICB1bnNpZ25lZCBpbnQgaSwgc2hhcmVkX2Nv
dW50Owo+ICsgICAgICAgdW5zaWduZWQgaTsKPiAgCj4gICAgICAgICBkbWFfcmVzdl9hc3NlcnRf
aGVsZChkc3QpOwo+ICAKPiAgICAgICAgIHJjdV9yZWFkX2xvY2soKTsKPiArICAgICAgIHNyY19s
aXN0ID0gcmN1X2RlcmVmZXJlbmNlKHNyYy0+ZmVuY2UpOwo+ICAKPiAgcmV0cnk6Cj4gLSAgICAg
ICBkbWFfcmVzdl9mZW5jZXMoc3JjLCAmbmV3LCAmc3JjX2xpc3QsICZzaGFyZWRfY291bnQpOwo+
IC0gICAgICAgaWYgKHNoYXJlZF9jb3VudCkgewo+ICsgICAgICAgaWYgKHNyY19saXN0KSB7Cj4g
KyAgICAgICAgICAgICAgIHVuc2lnbmVkIHNoYXJlZF9jb3VudCA9IHNyY19saXN0LT5zaGFyZWRf
Y291bnQ7Cj4gKwo+ICAgICAgICAgICAgICAgICByY3VfcmVhZF91bmxvY2soKTsKPiAgCj4gICAg
ICAgICAgICAgICAgIGRzdF9saXN0ID0gZG1hX3Jlc3ZfbGlzdF9hbGxvYyhzaGFyZWRfY291bnQp
Owo+IEBAIC0zMTEsMTQgKzMzMCwxNCBAQCBpbnQgZG1hX3Jlc3ZfY29weV9mZW5jZXMoc3RydWN0
IGRtYV9yZXN2ICpkc3QsIHN0cnVjdCBkbWFfcmVzdiAqc3JjKQo+ICAgICAgICAgICAgICAgICAg
ICAgICAgIHJldHVybiAtRU5PTUVNOwo+ICAKPiAgICAgICAgICAgICAgICAgcmN1X3JlYWRfbG9j
aygpOwo+IC0gICAgICAgICAgICAgICBkbWFfcmVzdl9mZW5jZXMoc3JjLCAmbmV3LCAmc3JjX2xp
c3QsICZzaGFyZWRfY291bnQpOwo+IC0gICAgICAgICAgICAgICBpZiAoIXNyY19saXN0IHx8IHNo
YXJlZF9jb3VudCA+IGRzdF9saXN0LT5zaGFyZWRfbWF4KSB7Cj4gKyAgICAgICAgICAgICAgIHNy
Y19saXN0ID0gcmN1X2RlcmVmZXJlbmNlKHNyYy0+ZmVuY2UpOwo+ICsgICAgICAgICAgICAgICBp
ZiAoIXNyY19saXN0IHx8IHNyY19saXN0LT5zaGFyZWRfY291bnQgPiBzaGFyZWRfY291bnQpIHsK
PiAgICAgICAgICAgICAgICAgICAgICAgICBrZnJlZShkc3RfbGlzdCk7Cj4gICAgICAgICAgICAg
ICAgICAgICAgICAgZ290byByZXRyeTsKPiAgICAgICAgICAgICAgICAgfQo+ICAKPiAgICAgICAg
ICAgICAgICAgZHN0X2xpc3QtPnNoYXJlZF9jb3VudCA9IDA7Cj4gLSAgICAgICAgICAgICAgIGZv
ciAoaSA9IDA7IGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewo+ICsgICAgICAgICAgICAgICBmb3Ig
KGkgPSAwOyBpIDwgc3JjX2xpc3QtPnNoYXJlZF9jb3VudDsgKytpKSB7Cj4gICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Cj4gIAo+ICAgICAgICAgICAgICAg
ICAgICAgICAgIGZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKHNyY19saXN0LT5zaGFyZWRbaV0pOwo+
IEBAIC0zMjgsNiArMzQ3LDcgQEAgaW50IGRtYV9yZXN2X2NvcHlfZmVuY2VzKHN0cnVjdCBkbWFf
cmVzdiAqZHN0LCBzdHJ1Y3QgZG1hX3Jlc3YgKnNyYykKPiAgCj4gICAgICAgICAgICAgICAgICAg
ICAgICAgaWYgKCFkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSkpIHsKPiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGRtYV9yZXN2X2xpc3RfZnJlZShkc3RfbGlzdCk7Cj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBzcmNfbGlzdCA9IHJjdV9kZXJlZmVyZW5jZShzcmMtPmZl
bmNlKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gcmV0cnk7Cj4gICAg
ICAgICAgICAgICAgICAgICAgICAgfQo+ICAKPiBAQCAtMzQyLDE4ICszNjIsMTggQEAgaW50IGRt
YV9yZXN2X2NvcHlfZmVuY2VzKHN0cnVjdCBkbWFfcmVzdiAqZHN0LCBzdHJ1Y3QgZG1hX3Jlc3Yg
KnNyYykKPiAgICAgICAgICAgICAgICAgZHN0X2xpc3QgPSBOVUxMOwo+ICAgICAgICAgfQo+ICAK
PiAtICAgICAgIGlmIChuZXcgJiYgIWRtYV9mZW5jZV9nZXRfcmN1KG5ldykpIHsKPiAtICAgICAg
ICAgICAgICAgZG1hX3Jlc3ZfbGlzdF9mcmVlKGRzdF9saXN0KTsKPiAtICAgICAgICAgICAgICAg
Z290byByZXRyeTsKPiAtICAgICAgIH0KPiArICAgICAgIG5ldyA9IGRtYV9mZW5jZV9nZXRfcmN1
X3NhZmUoJnNyYy0+ZmVuY2VfZXhjbCk7Cj4gICAgICAgICByY3VfcmVhZF91bmxvY2soKTsKPiAg
Cj4gICAgICAgICBzcmNfbGlzdCA9IGRtYV9yZXN2X2dldF9saXN0KGRzdCk7Cj4gICAgICAgICBv
bGQgPSBkbWFfcmVzdl9nZXRfZXhjbChkc3QpOwo+ICAKPiAgICAgICAgIHByZWVtcHRfZGlzYWJs
ZSgpOwo+IC0gICAgICAgcmN1X2Fzc2lnbl9wb2ludGVyKGRzdC0+ZmVuY2VfZXhjbCwgbmV3KTsK
PiAtICAgICAgIHJjdV9hc3NpZ25fcG9pbnRlcihkc3QtPmZlbmNlLCBkc3RfbGlzdCk7Cj4gKyAg
ICAgICB3cml0ZV9zZXFjb3VudF9iZWdpbigmZHN0LT5zZXEpOwo+ICsgICAgICAgLyogd3JpdGVf
c2VxY291bnRfYmVnaW4gcHJvdmlkZXMgdGhlIG5lY2Vzc2FyeSBtZW1vcnkgYmFycmllciAqLwo+
ICsgICAgICAgUkNVX0lOSVRfUE9JTlRFUihkc3QtPmZlbmNlX2V4Y2wsIG5ldyk7Cj4gKyAgICAg
ICBSQ1VfSU5JVF9QT0lOVEVSKGRzdC0+ZmVuY2UsIGRzdF9saXN0KTsKPiArICAgICAgIHdyaXRl
X3NlcWNvdW50X2VuZCgmZHN0LT5zZXEpOwo+ICAgICAgICAgcHJlZW1wdF9lbmFibGUoKTsKPiAg
Cj4gICAgICAgICBkbWFfcmVzdl9saXN0X2ZyZWUoc3JjX2xpc3QpOwo+IEBAIC0zODgsMTggKzQw
OCwxOSBAQCBpbnQgZG1hX3Jlc3ZfZ2V0X2ZlbmNlc19yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmos
Cj4gIAo+ICAgICAgICAgZG8gewo+ICAgICAgICAgICAgICAgICBzdHJ1Y3QgZG1hX3Jlc3ZfbGlz
dCAqZm9iajsKPiAtICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGk7Cj4gKyAgICAgICAgICAg
ICAgIHVuc2lnbmVkIGludCBpLCBzZXE7Cj4gICAgICAgICAgICAgICAgIHNpemVfdCBzeiA9IDA7
Cj4gIAo+IC0gICAgICAgICAgICAgICBpID0gMDsKPiArICAgICAgICAgICAgICAgc2hhcmVkX2Nv
dW50ID0gaSA9IDA7Cj4gIAo+ICAgICAgICAgICAgICAgICByY3VfcmVhZF9sb2NrKCk7Cj4gLSAg
ICAgICAgICAgICAgIGRtYV9yZXN2X2ZlbmNlcyhvYmosICZmZW5jZV9leGNsLCAmZm9iaiwKPiAt
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc2hhcmVkX2NvdW50KTsK
PiArICAgICAgICAgICAgICAgc2VxID0gcmVhZF9zZXFjb3VudF9iZWdpbigmb2JqLT5zZXEpOwo+
ICAKPiArICAgICAgICAgICAgICAgZmVuY2VfZXhjbCA9IHJjdV9kZXJlZmVyZW5jZShvYmotPmZl
bmNlX2V4Y2wpOwo+ICAgICAgICAgICAgICAgICBpZiAoZmVuY2VfZXhjbCAmJiAhZG1hX2ZlbmNl
X2dldF9yY3UoZmVuY2VfZXhjbCkpCj4gICAgICAgICAgICAgICAgICAgICAgICAgZ290byB1bmxv
Y2s7Cj4gIAo+ICsgICAgICAgICAgICAgICBmb2JqID0gcmN1X2RlcmVmZXJlbmNlKG9iai0+ZmVu
Y2UpOwo+ICAgICAgICAgICAgICAgICBpZiAoZm9iaikKPiAgICAgICAgICAgICAgICAgICAgICAg
ICBzeiArPSBzaXplb2YoKnNoYXJlZCkgKiBmb2JqLT5zaGFyZWRfbWF4Owo+ICAKPiBAQCAtNDI3
LDYgKzQ0OCw3IEBAIGludCBkbWFfcmVzdl9nZXRfZmVuY2VzX3JjdShzdHJ1Y3QgZG1hX3Jlc3Yg
Km9iaiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ICAgICAgICAg
ICAgICAgICAgICAgICAgIH0KPiAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWQgPSBuc2hh
cmVkOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZF9jb3VudCA9IGZvYmogPyBmb2Jq
LT5zaGFyZWRfY291bnQgOiAwOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7
IGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgc2hhcmVkW2ldID0gcmN1X2RlcmVmZXJlbmNlKGZvYmotPnNoYXJlZFtpXSk7Cj4gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRtYV9mZW5jZV9nZXRfcmN1KHNoYXJlZFtp
XSkpCj4gQEAgLTQzNCw3ICs0NTYsNyBAQCBpbnQgZG1hX3Jlc3ZfZ2V0X2ZlbmNlc19yY3Uoc3Ry
dWN0IGRtYV9yZXN2ICpvYmosCj4gICAgICAgICAgICAgICAgICAgICAgICAgfQo+ICAgICAgICAg
ICAgICAgICB9Cj4gIAo+IC0gICAgICAgICAgICAgICBpZiAoaSAhPSBzaGFyZWRfY291bnQpIHsK
PiArICAgICAgICAgICAgICAgaWYgKGkgIT0gc2hhcmVkX2NvdW50IHx8IHJlYWRfc2VxY291bnRf
cmV0cnkoJm9iai0+c2VxLCBzZXEpKSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUg
KGktLSkKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtYV9mZW5jZV9wdXQoc2hh
cmVkW2ldKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICBkbWFfZmVuY2VfcHV0KGZlbmNlX2V4
Y2wpOwo+IEBAIC00NzgsMTcgKzUwMCwxOCBAQCBsb25nIGRtYV9yZXN2X3dhaXRfdGltZW91dF9y
Y3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGJvb2wgd2FpdF9hbGwsIGJvb2wgaW50ciwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgdW5zaWduZWQgbG9uZyB0aW1lb3V0KQo+ICB7Cj4gLSAgICAgICBzdHJ1Y3QgZG1hX3Jlc3Zf
bGlzdCAqZm9iajsKPiAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwo+IC0gICAgICAg
dW5zaWduZWQgc2hhcmVkX2NvdW50Owo+ICsgICAgICAgdW5zaWduZWQgc2VxLCBzaGFyZWRfY291
bnQ7Cj4gICAgICAgICBsb25nIHJldCA9IHRpbWVvdXQgPyB0aW1lb3V0IDogMTsKPiAgICAgICAg
IGludCBpOwo+ICAKPiAgcmV0cnk6Cj4gKyAgICAgICBzaGFyZWRfY291bnQgPSAwOwo+ICsgICAg
ICAgc2VxID0gcmVhZF9zZXFjb3VudF9iZWdpbigmb2JqLT5zZXEpOwo+ICAgICAgICAgcmN1X3Jl
YWRfbG9jaygpOwo+ICAgICAgICAgaSA9IC0xOwo+ICAKPiAtICAgICAgIGRtYV9yZXN2X2ZlbmNl
cyhvYmosICZmZW5jZSwgJmZvYmosICZzaGFyZWRfY291bnQpOwo+ICsgICAgICAgZmVuY2UgPSBy
Y3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZV9leGNsKTsKPiAgICAgICAgIGlmIChmZW5jZSAmJiAh
dGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSkgewo+
ICAgICAgICAgICAgICAgICBpZiAoIWRtYV9mZW5jZV9nZXRfcmN1KGZlbmNlKSkKPiAgICAgICAg
ICAgICAgICAgICAgICAgICBnb3RvIHVubG9ja19yZXRyeTsKPiBAQCAtNTAzLDYgKzUyNiwxMSBA
QCBsb25nIGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosCj4g
ICAgICAgICB9Cj4gIAo+ICAgICAgICAgaWYgKHdhaXRfYWxsKSB7Cj4gKyAgICAgICAgICAgICAg
IHN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqID0gcmN1X2RlcmVmZXJlbmNlKG9iai0+ZmVuY2Up
Owo+ICsKPiArICAgICAgICAgICAgICAgaWYgKGZvYmopCj4gKyAgICAgICAgICAgICAgICAgICAg
ICAgc2hhcmVkX2NvdW50ID0gZm9iai0+c2hhcmVkX2NvdW50Owo+ICsKPiAgICAgICAgICAgICAg
ICAgZm9yIChpID0gMDsgIWZlbmNlICYmIGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewo+ICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmxmZW5jZSA9IHJjdV9kZXJlZmVy
ZW5jZShmb2JqLT5zaGFyZWRbaV0pOwo+ICAKPiBAQCAtNTI1LDYgKzU1MywxMSBAQCBsb25nIGRt
YV9yZXN2X3dhaXRfdGltZW91dF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosCj4gIAo+ICAgICAg
ICAgcmN1X3JlYWRfdW5sb2NrKCk7Cj4gICAgICAgICBpZiAoZmVuY2UpIHsKPiArICAgICAgICAg
ICAgICAgaWYgKHJlYWRfc2VxY291bnRfcmV0cnkoJm9iai0+c2VxLCBzZXEpKSB7Cj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3B1dChmZW5jZSk7Cj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgZ290byByZXRyeTsKPiArICAgICAgICAgICAgICAgfQo+ICsKPiAgICAgICAgICAg
ICAgICAgcmV0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5jZSwgaW50ciwgcmV0KTsKPiAg
ICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3B1dChmZW5jZSk7Cj4gICAgICAgICAgICAgICAgIGlm
IChyZXQgPiAwICYmIHdhaXRfYWxsICYmIChpICsgMSA8IHNoYXJlZF9jb3VudCkpCj4gQEAgLTU2
NywxOSArNjAwLDIzIEBAIHN0YXRpYyBpbmxpbmUgaW50IGRtYV9yZXN2X3Rlc3Rfc2lnbmFsZWRf
c2luZ2xlKHN0cnVjdCBkbWFfZmVuY2UgKnBhc3NlZF9mZW5jZSkKPiAgICovCj4gIGJvb2wgZG1h
X3Jlc3ZfdGVzdF9zaWduYWxlZF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmosIGJvb2wgdGVzdF9h
bGwpCj4gIHsKPiAtICAgICAgIHN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqOwo+IC0gICAgICAg
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2VfZXhjbDsKPiAtICAgICAgIHVuc2lnbmVkIHNoYXJlZF9j
b3VudDsKPiArICAgICAgIHVuc2lnbmVkIHNlcSwgc2hhcmVkX2NvdW50Owo+ICAgICAgICAgaW50
IHJldDsKPiAgCj4gICAgICAgICByY3VfcmVhZF9sb2NrKCk7Cj4gIHJldHJ5Ogo+ICAgICAgICAg
cmV0ID0gdHJ1ZTsKPiArICAgICAgIHNoYXJlZF9jb3VudCA9IDA7Cj4gKyAgICAgICBzZXEgPSBy
ZWFkX3NlcWNvdW50X2JlZ2luKCZvYmotPnNlcSk7Cj4gIAo+IC0gICAgICAgZG1hX3Jlc3ZfZmVu
Y2VzKG9iaiwgJmZlbmNlX2V4Y2wsICZmb2JqLCAmc2hhcmVkX2NvdW50KTsKPiAgICAgICAgIGlm
ICh0ZXN0X2FsbCkgewo+ICAgICAgICAgICAgICAgICB1bnNpZ25lZCBpOwo+ICAKPiArICAgICAg
ICAgICAgICAgc3RydWN0IGRtYV9yZXN2X2xpc3QgKmZvYmogPSByY3VfZGVyZWZlcmVuY2Uob2Jq
LT5mZW5jZSk7Cj4gKwo+ICsgICAgICAgICAgICAgICBpZiAoZm9iaikKPiArICAgICAgICAgICAg
ICAgICAgICAgICBzaGFyZWRfY291bnQgPSBmb2JqLT5zaGFyZWRfY291bnQ7Cj4gKwo+ICAgICAg
ICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2hhcmVkX2NvdW50OyArK2kpIHsKPiAgICAgICAg
ICAgICAgICAgICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9IHJjdV9kZXJlZmVyZW5j
ZShmb2JqLT5zaGFyZWRbaV0pOwo+ICAKPiBAQCAtNTg5LDE0ICs2MjYsMjQgQEAgYm9vbCBkbWFf
cmVzdl90ZXN0X3NpZ25hbGVkX3JjdShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgYm9vbCB0ZXN0X2Fs
bCkKPiAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghcmV0KQo+ICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gICAgICAgICAgICAgICAgIH0KPiAtICAgICAg
IH0KPiAgCj4gLSAgICAgICBpZiAoIXNoYXJlZF9jb3VudCAmJiBmZW5jZV9leGNsKSB7Cj4gLSAg
ICAgICAgICAgICAgIHJldCA9IGRtYV9yZXN2X3Rlc3Rfc2lnbmFsZWRfc2luZ2xlKGZlbmNlX2V4
Y2wpOwo+IC0gICAgICAgICAgICAgICBpZiAocmV0IDwgMCkKPiArICAgICAgICAgICAgICAgaWYg
KHJlYWRfc2VxY291bnRfcmV0cnkoJm9iai0+c2VxLCBzZXEpKQo+ICAgICAgICAgICAgICAgICAg
ICAgICAgIGdvdG8gcmV0cnk7Cj4gICAgICAgICB9Cj4gIAo+ICsgICAgICAgaWYgKCFzaGFyZWRf
Y291bnQpIHsKPiArICAgICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2VfZXhjbCA9
IHJjdV9kZXJlZmVyZW5jZShvYmotPmZlbmNlX2V4Y2wpOwo+ICsKPiArICAgICAgICAgICAgICAg
aWYgKGZlbmNlX2V4Y2wpIHsKPiArICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBkbWFfcmVz
dl90ZXN0X3NpZ25hbGVkX3NpbmdsZShmZW5jZV9leGNsKTsKPiArICAgICAgICAgICAgICAgICAg
ICAgICBpZiAocmV0IDwgMCkKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8g
cmV0cnk7Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWFkX3NlcWNvdW50X3Jl
dHJ5KCZvYmotPnNlcSwgc2VxKSkKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdv
dG8gcmV0cnk7Cj4gKyAgICAgICAgICAgICAgIH0KPiArICAgICAgIH0KPiArCj4gICAgICAgICBy
Y3VfcmVhZF91bmxvY2soKTsKPiAgICAgICAgIHJldHVybiByZXQ7Cj4gIH0KPiBkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCj4gaW5kZXggYmM0
ZWM2YjIwYTg3Li43NmUzNTE2NDg0ZTcgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCj4gQEAgLTI1MSw3ICsyNTEsMTIgQEAgc3Rh
dGljIGludCBhbWRncHVfYW1ka2ZkX3JlbW92ZV9ldmljdGlvbl9mZW5jZShzdHJ1Y3QgYW1kZ3B1
X2JvICpibywKPiAgICAgICAgIG5ldy0+c2hhcmVkX21heCA9IG9sZC0+c2hhcmVkX21heDsKPiAg
ICAgICAgIG5ldy0+c2hhcmVkX2NvdW50ID0gazsKPiAgCj4gLSAgICAgICByY3VfYXNzaWduX3Bv
aW50ZXIocmVzdi0+ZmVuY2UsIG5ldyk7Cj4gKyAgICAgICAvKiBJbnN0YWxsIHRoZSBuZXcgZmVu
Y2UgbGlzdCwgc2VxY291bnQgcHJvdmlkZXMgdGhlIGJhcnJpZXJzICovCj4gKyAgICAgICBwcmVl
bXB0X2Rpc2FibGUoKTsKPiArICAgICAgIHdyaXRlX3NlcWNvdW50X2JlZ2luKCZyZXN2LT5zZXEp
Owo+ICsgICAgICAgUkNVX0lOSVRfUE9JTlRFUihyZXN2LT5mZW5jZSwgbmV3KTsKPiArICAgICAg
IHdyaXRlX3NlcWNvdW50X2VuZCgmcmVzdi0+c2VxKTsKPiArICAgICAgIHByZWVtcHRfZW5hYmxl
KCk7Cj4gIAo+ICAgICAgICAgLyogRHJvcCB0aGUgcmVmZXJlbmNlcyB0byB0aGUgcmVtb3ZlZCBm
ZW5jZXMgb3IgbW92ZSB0aGVtIHRvIGVmX2xpc3QgKi8KPiAgICAgICAgIGZvciAoaSA9IGosIGsg
PSAwOyBpIDwgb2xkLT5zaGFyZWRfY291bnQ7ICsraSkgewo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVzeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2J1c3kuYwo+IGluZGV4IGEyYWZmMWQ4MjkwZS4uM2Q0ZjU3NzVhNGJhIDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5LmMKPiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVzeS5jCj4gQEAgLTgzLDgg
KzgzLDcgQEAgaTkxNV9nZW1fYnVzeV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lk
ICpkYXRhLAo+ICAgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9idXN5ICphcmdzID0gZGF0YTsK
PiAgICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Cj4gICAgICAgICBzdHJ1
Y3QgZG1hX3Jlc3ZfbGlzdCAqbGlzdDsKPiAtICAgICAgIHVuc2lnbmVkIGludCBpLCBzaGFyZWRf
Y291bnQ7Cj4gLSAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpleGNsOwo+ICsgICAgICAgdW5zaWdu
ZWQgaW50IHNlcTsKPiAgICAgICAgIGludCBlcnI7Cj4gIAo+ICAgICAgICAgZXJyID0gLUVOT0VO
VDsKPiBAQCAtMTEwLDE4ICsxMDksMjkgQEAgaTkxNV9nZW1fYnVzeV9pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAo+ICAgICAgICAgICogdG8gcmVwb3J0IHRoZSBvdmVy
YWxsIGJ1c3luZXNzLiBUaGlzIGlzIHdoYXQgdGhlIHdhaXQtaW9jdGwgZG9lcy4KPiAgICAgICAg
ICAqCj4gICAgICAgICAgKi8KPiAtICAgICAgIGRtYV9yZXN2X2ZlbmNlcyhvYmotPmJhc2UucmVz
diwgJmV4Y2wsICZsaXN0LCAmc2hhcmVkX2NvdW50KTsKPiArcmV0cnk6Cj4gKyAgICAgICBzZXEg
PSByYXdfcmVhZF9zZXFjb3VudCgmb2JqLT5iYXNlLnJlc3YtPnNlcSk7Cj4gIAo+ICAgICAgICAg
LyogVHJhbnNsYXRlIHRoZSBleGNsdXNpdmUgZmVuY2UgdG8gdGhlIFJFQUQgKmFuZCogV1JJVEUg
ZW5naW5lICovCj4gLSAgICAgICBhcmdzLT5idXN5ID0gYnVzeV9jaGVja193cml0ZXIoZXhjbCk7
Cj4gKyAgICAgICBhcmdzLT5idXN5ID0KPiArICAgICAgICAgICAgICAgYnVzeV9jaGVja193cml0
ZXIocmN1X2RlcmVmZXJlbmNlKG9iai0+YmFzZS5yZXN2LT5mZW5jZV9leGNsKSk7Cj4gIAo+ICAg
ICAgICAgLyogVHJhbnNsYXRlIHNoYXJlZCBmZW5jZXMgdG8gUkVBRCBzZXQgb2YgZW5naW5lcyAq
Lwo+IC0gICAgICAgZm9yIChpID0gMDsgaSA8IHNoYXJlZF9jb3VudDsgKytpKSB7Cj4gLSAgICAg
ICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKGxpc3Qt
PnNoYXJlZFtpXSk7Cj4gKyAgICAgICBsaXN0ID0gcmN1X2RlcmVmZXJlbmNlKG9iai0+YmFzZS5y
ZXN2LT5mZW5jZSk7Cj4gKyAgICAgICBpZiAobGlzdCkgewo+ICsgICAgICAgICAgICAgICB1bnNp
Z25lZCBpbnQgc2hhcmVkX2NvdW50ID0gbGlzdC0+c2hhcmVkX2NvdW50LCBpOwo+ICAKPiAtICAg
ICAgICAgICAgICAgYXJncy0+YnVzeSB8PSBidXN5X2NoZWNrX3JlYWRlcihmZW5jZSk7Cj4gKyAg
ICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewo+ICsgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0KPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHJjdV9kZXJlZmVyZW5jZShsaXN0LT5zaGFyZWRbaV0pOwo+
ICsKPiArICAgICAgICAgICAgICAgICAgICAgICBhcmdzLT5idXN5IHw9IGJ1c3lfY2hlY2tfcmVh
ZGVyKGZlbmNlKTsKPiArICAgICAgICAgICAgICAgfQo+ICAgICAgICAgfQo+ICAKPiArICAgICAg
IGlmIChhcmdzLT5idXN5ICYmIHJlYWRfc2VxY291bnRfcmV0cnkoJm9iai0+YmFzZS5yZXN2LT5z
ZXEsIHNlcSkpCj4gKyAgICAgICAgICAgICAgIGdvdG8gcmV0cnk7Cj4gKwo+ICAgICAgICAgZXJy
ID0gMDsKPiAgb3V0Ogo+ICAgICAgICAgcmN1X3JlYWRfdW5sb2NrKCk7Cj4gZGlmZiAtLWdpdCBh
L2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaCBiL2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaAo+IGlu
ZGV4IDM4ZjI4MDJhZmFiYi4uZWU1MGQxMGYwNTJiIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvbGlu
dXgvZG1hLXJlc3YuaAo+ICsrKyBiL2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaAo+IEBAIC00Niw2
ICs0Niw4IEBACj4gICNpbmNsdWRlIDxsaW51eC9yY3VwZGF0ZS5oPgo+ICAKPiAgZXh0ZXJuIHN0
cnVjdCB3d19jbGFzcyByZXNlcnZhdGlvbl93d19jbGFzczsKPiArZXh0ZXJuIHN0cnVjdCBsb2Nr
X2NsYXNzX2tleSByZXNlcnZhdGlvbl9zZXFjb3VudF9jbGFzczsKPiArZXh0ZXJuIGNvbnN0IGNo
YXIgcmVzZXJ2YXRpb25fc2VxY291bnRfc3RyaW5nW107Cj4gIAo+ICAvKioKPiAgICogc3RydWN0
IGRtYV9yZXN2X2xpc3QgLSBhIGxpc3Qgb2Ygc2hhcmVkIGZlbmNlcwo+IEBAIC02OSw2ICs3MSw3
IEBAIHN0cnVjdCBkbWFfcmVzdl9saXN0IHsKPiAgICovCj4gIHN0cnVjdCBkbWFfcmVzdiB7Cj4g
ICAgICAgICBzdHJ1Y3Qgd3dfbXV0ZXggbG9jazsKPiArICAgICAgIHNlcWNvdW50X3Qgc2VxOwo+
ICAKPiAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgX19yY3UgKmZlbmNlX2V4Y2w7Cj4gICAgICAg
ICBzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCBfX3JjdSAqZmVuY2U7Cj4gQEAgLTc3LDI0ICs4MCw2IEBA
IHN0cnVjdCBkbWFfcmVzdiB7Cj4gICNkZWZpbmUgZG1hX3Jlc3ZfaGVsZChvYmopIGxvY2tkZXBf
aXNfaGVsZCgmKG9iaiktPmxvY2suYmFzZSkKPiAgI2RlZmluZSBkbWFfcmVzdl9hc3NlcnRfaGVs
ZChvYmopIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJihvYmopLT5sb2NrLmJhc2UpCj4gIAo+IC0vKioK
PiAtICogZG1hX3Jlc3ZfZ2V0X2V4Y2wgLSBnZXQgdGhlIHJlc2VydmF0aW9uIG9iamVjdCdzCj4g
LSAqIGV4Y2x1c2l2ZSBmZW5jZSwgd2l0aCB1cGRhdGUtc2lkZSBsb2NrIGhlbGQKPiAtICogQG9i
ajogdGhlIHJlc2VydmF0aW9uIG9iamVjdAo+IC0gKgo+IC0gKiBSZXR1cm5zIHRoZSBleGNsdXNp
dmUgZmVuY2UgKGlmIGFueSkuICBEb2VzIE5PVCB0YWtlIGEKPiAtICogcmVmZXJlbmNlLiBXcml0
ZXJzIG11c3QgaG9sZCBvYmotPmxvY2ssIHJlYWRlcnMgbWF5IG9ubHkKPiAtICogaG9sZCBhIFJD
VSByZWFkIHNpZGUgbG9jay4KPiAtICoKPiAtICogUkVUVVJOUwo+IC0gKiBUaGUgZXhjbHVzaXZl
IGZlbmNlIG9yIE5VTEwKPiAtICovCj4gLXN0YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9mZW5jZSAq
ZG1hX3Jlc3ZfZ2V0X2V4Y2woc3RydWN0IGRtYV9yZXN2ICpvYmopCj4gLXsKPiAtICAgICAgIHJl
dHVybiByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9iai0+ZmVuY2VfZXhjbCwKPiAtICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtYV9yZXN2X2hlbGQob2JqKSk7Cj4g
LX0KPiAtCj4gIC8qKgo+ICAgKiBkbWFfcmVzdl9nZXRfbGlzdCAtIGdldCB0aGUgcmVzZXJ2YXRp
b24gb2JqZWN0J3MKPiAgICogc2hhcmVkIGZlbmNlIGxpc3QsIHdpdGggdXBkYXRlLXNpZGUgbG9j
ayBoZWxkCj4gQEAgLTEwOSw1MyArOTQsNiBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBkbWFfcmVz
dl9saXN0ICpkbWFfcmVzdl9nZXRfbGlzdChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikKPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtYV9yZXN2X2hlbGQob2JqKSk7Cj4g
IH0KPiAgCj4gLS8qKgo+IC0gKiBkbWFfcmVzdl9mZW5jZXMgLSByZWFkIGNvbnNpc3RlbnQgZmVu
Y2UgcG9pbnRlcnMKPiAtICogQG9iajogcmVzZXJ2YXRpb24gb2JqZWN0IHdoZXJlIHdlIGdldCB0
aGUgZmVuY2VzIGZyb20KPiAtICogQGV4Y2w6IHBvaW50ZXIgZm9yIHRoZSBleGNsdXNpdmUgZmVu
Y2UKPiAtICogQGxpc3Q6IHBvaW50ZXIgZm9yIHRoZSBzaGFyZWQgZmVuY2UgbGlzdAo+IC0gKgo+
IC0gKiBNYWtlIHN1cmUgd2UgaGF2ZSBhIGNvbnNpc3RlbiBleGNsdXNpdmUgZmVuY2UgYW5kIHNo
YXJlZCBmZW5jZSBsaXN0Lgo+IC0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHJjdSByZWFkIHNpZGUg
bG9jayBoZWxkLgo+IC0gKi8KPiAtc3RhdGljIGlubGluZSB2b2lkIGRtYV9yZXN2X2ZlbmNlcyhz
dHJ1Y3QgZG1hX3Jlc3YgKm9iaiwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBkbWFfZmVuY2UgKipleGNsLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IGRtYV9yZXN2X2xpc3QgKipsaXN0LAo+IC0gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgdTMyICpzaGFyZWRfY291bnQpCj4gLXsKPiAtICAgICAgIGRvIHsKPiAt
ICAgICAgICAgICAgICAgKmV4Y2wgPSByY3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZV9leGNsKTsK
PiAtICAgICAgICAgICAgICAgKmxpc3QgPSByY3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZSk7Cj4g
LSAgICAgICAgICAgICAgICpzaGFyZWRfY291bnQgPSAqbGlzdCA/ICgqbGlzdCktPnNoYXJlZF9j
b3VudCA6IDA7Cj4gLSAgICAgICAgICAgICAgIHNtcF9ybWIoKTsgLyogU2VlIGRtYV9yZXN2X2Fk
ZF9leGNsX2ZlbmNlICovCj4gLSAgICAgICB9IHdoaWxlIChyY3VfYWNjZXNzX3BvaW50ZXIob2Jq
LT5mZW5jZV9leGNsKSAhPSAqZXhjbCk7Cj4gLX0KPiAtCj4gLS8qKgo+IC0gKiBkbWFfcmVzdl9n
ZXRfZXhjbF9yY3UgLSBnZXQgdGhlIHJlc2VydmF0aW9uIG9iamVjdCdzCj4gLSAqIGV4Y2x1c2l2
ZSBmZW5jZSwgd2l0aG91dCBsb2NrIGhlbGQuCj4gLSAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBv
YmplY3QKPiAtICoKPiAtICogSWYgdGhlcmUgaXMgYW4gZXhjbHVzaXZlIGZlbmNlLCB0aGlzIGF0
b21pY2FsbHkgaW5jcmVtZW50cyBpdCdzCj4gLSAqIHJlZmVyZW5jZSBjb3VudCBhbmQgcmV0dXJu
cyBpdC4KPiAtICoKPiAtICogUkVUVVJOUwo+IC0gKiBUaGUgZXhjbHVzaXZlIGZlbmNlIG9yIE5V
TEwgaWYgbm9uZQo+IC0gKi8KPiAtc3RhdGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICpkbWFf
cmVzdl9nZXRfZXhjbF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmopCj4gLXsKPiAtICAgICAgIHN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwo+IC0KPiAtICAgICAgIGlmICghcmN1X2FjY2Vzc19wb2lu
dGVyKG9iai0+ZmVuY2VfZXhjbCkpCj4gLSAgICAgICAgICAgICAgIHJldHVybiBOVUxMOwo+IC0K
PiAtICAgICAgIHJjdV9yZWFkX2xvY2soKTsKPiAtICAgICAgIGZlbmNlID0gZG1hX2ZlbmNlX2dl
dF9yY3Vfc2FmZSgmb2JqLT5mZW5jZV9leGNsKTsKPiAtICAgICAgIHJjdV9yZWFkX3VubG9jaygp
Owo+IC0KPiAtICAgICAgIHJldHVybiBmZW5jZTsKPiAtfQo+IC0KPiAgLyoqCj4gICAqIGRtYV9y
ZXN2X2xvY2sgLSBsb2NrIHRoZSByZXNlcnZhdGlvbiBvYmplY3QKPiAgICogQG9iajogdGhlIHJl
c2VydmF0aW9uIG9iamVjdAo+IEBAIC0yOTAsNiArMjI4LDUxIEBAIHN0YXRpYyBpbmxpbmUgdm9p
ZCBkbWFfcmVzdl91bmxvY2soc3RydWN0IGRtYV9yZXN2ICpvYmopCj4gICAgICAgICB3d19tdXRl
eF91bmxvY2soJm9iai0+bG9jayk7Cj4gIH0KPiAgCj4gKy8qKgo+ICsgKiBkbWFfcmVzdl9nZXRf
ZXhjbCAtIGdldCB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0J3MKPiArICogZXhjbHVzaXZlIGZlbmNl
LCB3aXRoIHVwZGF0ZS1zaWRlIGxvY2sgaGVsZAo+ICsgKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24g
b2JqZWN0Cj4gKyAqCj4gKyAqIFJldHVybnMgdGhlIGV4Y2x1c2l2ZSBmZW5jZSAoaWYgYW55KS4g
IERvZXMgTk9UIHRha2UgYQo+ICsgKiByZWZlcmVuY2UuIFdyaXRlcnMgbXVzdCBob2xkIG9iai0+
bG9jaywgcmVhZGVycyBtYXkgb25seQo+ICsgKiBob2xkIGEgUkNVIHJlYWQgc2lkZSBsb2NrLgo+
ICsgKgo+ICsgKiBSRVRVUk5TCj4gKyAqIFRoZSBleGNsdXNpdmUgZmVuY2Ugb3IgTlVMTAo+ICsg
Ki8KPiArc3RhdGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICoKPiArZG1hX3Jlc3ZfZ2V0X2V4
Y2woc3RydWN0IGRtYV9yZXN2ICpvYmopCj4gK3sKPiArICAgICAgIHJldHVybiByY3VfZGVyZWZl
cmVuY2VfcHJvdGVjdGVkKG9iai0+ZmVuY2VfZXhjbCwKPiArICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGRtYV9yZXN2X2hlbGQob2JqKSk7Cj4gK30KPiArCj4gKy8qKgo+
ICsgKiBkbWFfcmVzdl9nZXRfZXhjbF9yY3UgLSBnZXQgdGhlIHJlc2VydmF0aW9uIG9iamVjdCdz
Cj4gKyAqIGV4Y2x1c2l2ZSBmZW5jZSwgd2l0aG91dCBsb2NrIGhlbGQuCj4gKyAqIEBvYmo6IHRo
ZSByZXNlcnZhdGlvbiBvYmplY3QKPiArICoKPiArICogSWYgdGhlcmUgaXMgYW4gZXhjbHVzaXZl
IGZlbmNlLCB0aGlzIGF0b21pY2FsbHkgaW5jcmVtZW50cyBpdCdzCj4gKyAqIHJlZmVyZW5jZSBj
b3VudCBhbmQgcmV0dXJucyBpdC4KPiArICoKPiArICogUkVUVVJOUwo+ICsgKiBUaGUgZXhjbHVz
aXZlIGZlbmNlIG9yIE5VTEwgaWYgbm9uZQo+ICsgKi8KPiArc3RhdGljIGlubGluZSBzdHJ1Y3Qg
ZG1hX2ZlbmNlICoKPiArZG1hX3Jlc3ZfZ2V0X2V4Y2xfcmN1KHN0cnVjdCBkbWFfcmVzdiAqb2Jq
KQo+ICt7Cj4gKyAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKPiArCj4gKyAgICAgICBp
ZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihvYmotPmZlbmNlX2V4Y2wpKQo+ICsgICAgICAgICAgICAg
ICByZXR1cm4gTlVMTDsKPiArCj4gKyAgICAgICByY3VfcmVhZF9sb2NrKCk7Cj4gKyAgICAgICBm
ZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+ZmVuY2VfZXhjbCk7Cj4gKyAgICAg
ICByY3VfcmVhZF91bmxvY2soKTsKPiArCj4gKyAgICAgICByZXR1cm4gZmVuY2U7Cj4gK30KPiAr
Cj4gIHZvaWQgZG1hX3Jlc3ZfaW5pdChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaik7Cj4gIHZvaWQgZG1h
X3Jlc3ZfZmluaShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaik7Cj4gIGludCBkbWFfcmVzdl9yZXNlcnZl
X3NoYXJlZChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgdW5zaWduZWQgaW50IG51bV9mZW5jZXMpOwo+
IC0tIAo+IDIuMjMuMC5yYzEKPiAKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
