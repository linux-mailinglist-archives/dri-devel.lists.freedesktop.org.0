Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3891A6BC04
	for <lists+dri-devel@lfdr.de>; Wed, 17 Jul 2019 13:58:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F1CAE6E143;
	Wed, 17 Jul 2019 11:58:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 53D396E11C
 for <dri-devel@lists.freedesktop.org>; Wed, 17 Jul 2019 11:58:32 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:54758
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hniZq-0007Eh-Dt; Wed, 17 Jul 2019 13:58:30 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 05/10] drm/tinydrm: Clean up tinydrm_spi_transfer()
Date: Wed, 17 Jul 2019 13:58:12 +0200
Message-Id: <20190717115817.30110-6-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190717115817.30110-1-noralf@tronnes.org>
References: <20190717115817.30110-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=XNCIi+c9p25jbYjn7P9ykH0j8S9RkkbGNc1jq6S2N1g=; 
 b=tKCP/BwFMr93ck0+pp0njcuwtNTiRdFVPS+BD429d5dNrKAKZ+y0LpH82LlGR8nJHGutCG5FSir3gXpsHP2WBMe0DhZbLLVm3Q0n4zSJDIMlB/lqouOC2Rp32cqp9baDR7wXNXMxU6WlreF1eTOyb5nyasuoO84gHTS7Pt5/GQXOBBzMI05g1k3qgUdpzh7bptWIY3iGV+D8r4XvmmIfCjpQvm/BbPSJ3dK/eI9URzZ/gJcjdkU3hJ50XiLCLYDNS/qrcOophxNBdKjTJfttGNxrE37gkIARypJ8tX3aM8BURdj8eRPsnbpZHYAb2Q+3ALevHuQkonRoxRSgNCrdSA==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: david@lechnology.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UHJlcCB3b3JrIGJlZm9yZSBtb3ZpbmcgdGhlIGZ1bmN0aW9uIHRvIG1pcGktZGJpLgoKdGlueWRy
bV9zcGlfdHJhbnNmZXIoKSB3YXMgbWFkZSB0byBzdXBwb3J0IG9uZSBjbGFzcyBvZiBkcml2ZXJz
IGluCmRyaXZlcnMvc3RhZ2luZy9mYnRmdCB0aGF0IGhhcyBub3QgYmVlbiBjb252ZXJ0ZWQgdG8g
RFJNIHlldCwgc28gc3RyaXAKYXdheSB0aGUgdW51c2VkIGZ1bmN0aW9uYWxpdHk6Ci0gU3RhcnQg
Ynl0ZSAoaGVhZGVyKSBpcyBub3QgdXNlZC4KLSBObyBkcml2ZXIgcmVsaWVzIG9uIHRoZSBhdXRv
bWF0aWMgMTYtYml0IGJ5dGUgc3dhcHBpbmcgb24gbGl0dGxlIGVuZGlhbgogIG1hY2hpbmVzIHdp
dGggU1BJIGNvbnRyb2xsZXJzIG9ubHkgc3VwcG9ydGluZyA4IGJpdHMgcGVyIHdvcmQuCgpPdGhl
ciBjaGFuZ2VzOgotIE5vIG5lZWQgdG8gaW5pdGlhbGl6ZSByZXQKLSBObyBuZWVkIGZvciB0aGUg
V0FSTiBzaW5jZSBtaXBpLWRiaSBvbmx5IHVzZXMgOCBhbmQgMTYgYnB3LgotIFVzZSBzcGlfbWVz
c2FnZV9pbml0X3dpdGhfdHJhbnNmZXJzKCkKCkNjOiBEYXZpZCBMZWNobmVyIDxkYXZpZEBsZWNo
bm9sb2d5LmNvbT4KU2lnbmVkLW9mZi1ieTogTm9yYWxmIFRyw7hubmVzIDxub3JhbGZAdHJvbm5l
cy5vcmc+Ci0tLQogLi4uL2dwdS9kcm0vdGlueWRybS9jb3JlL3Rpbnlkcm0taGVscGVycy5jICAg
IHwgNDAgKystLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTIy
NS5jICAgICAgICAgICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL21pcGktZGJp
LmMgICAgICAgICAgICB8ICA0ICstCiBpbmNsdWRlL2RybS90aW55ZHJtL3Rpbnlkcm0taGVscGVy
cy5oICAgICAgICAgfCAgMyArLQogNCBmaWxlcyBjaGFuZ2VkLCA5IGluc2VydGlvbnMoKyksIDQy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2NvcmUv
dGlueWRybS1oZWxwZXJzLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9jb3JlL3Rpbnlkcm0t
aGVscGVycy5jCmluZGV4IGFmNWJlYzg4NjFkZS4uZDk1ZWI1MGZhOWQ0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdGlueWRybS9jb3JlL3Rpbnlkcm0taGVscGVycy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS90aW55ZHJtL2NvcmUvdGlueWRybS1oZWxwZXJzLmMKQEAgLTI0LDIzICsyNCwx
OCBAQAogICogdGlueWRybV9zcGlfdHJhbnNmZXIgLSBTUEkgdHJhbnNmZXIgaGVscGVyCiAgKiBA
c3BpOiBTUEkgZGV2aWNlCiAgKiBAc3BlZWRfaHo6IE92ZXJyaWRlIHNwZWVkIChvcHRpb25hbCkK
LSAqIEBoZWFkZXI6IE9wdGlvbmFsIGhlYWRlciB0cmFuc2ZlcgogICogQGJwdzogQml0cyBwZXIg
d29yZAogICogQGJ1ZjogQnVmZmVyIHRvIHRyYW5zZmVyCiAgKiBAbGVuOiBCdWZmZXIgbGVuZ3Ro
CiAgKgogICogVGhpcyBTUEkgdHJhbnNmZXIgaGVscGVyIGJyZWFrcyB1cCB0aGUgdHJhbnNmZXIg
b2YgQGJ1ZiBpbnRvIGNodW5rcyB3aGljaAotICogdGhlIFNQSSBtYXN0ZXIgZHJpdmVyIGNhbiBo
YW5kbGUuIElmIHRoZSBtYWNoaW5lIGlzIExpdHRsZSBFbmRpYW4gYW5kIHRoZQotICogU1BJIG1h
c3RlciBkcml2ZXIgZG9lc24ndCBzdXBwb3J0IDE2IGJpdHMgcGVyIHdvcmQsIGl0IHN3YXBzIHRo
ZSBieXRlcyBhbmQKLSAqIGRvZXMgYSA4LWJpdCB0cmFuc2Zlci4KLSAqIElmIEBoZWFkZXIgaXMg
c2V0LCBpdCBpcyBwcmVwZW5kZWQgdG8gZWFjaCBTUEkgbWVzc2FnZS4KKyAqIHRoZSBTUEkgY29u
dHJvbGxlciBkcml2ZXIgY2FuIGhhbmRsZS4KICAqCiAgKiBSZXR1cm5zOgogICogWmVybyBvbiBz
dWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KIGludCB0aW55ZHJt
X3NwaV90cmFuc2ZlcihzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpLCB1MzIgc3BlZWRfaHosCi0JCQkg
c3RydWN0IHNwaV90cmFuc2ZlciAqaGVhZGVyLCB1OCBicHcsIGNvbnN0IHZvaWQgKmJ1ZiwKLQkJ
CSBzaXplX3QgbGVuKQorCQkJIHU4IGJwdywgY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQog
ewogCXNpemVfdCBtYXhfY2h1bmsgPSBzcGlfbWF4X3RyYW5zZmVyX3NpemUoc3BpKTsKIAlzdHJ1
Y3Qgc3BpX3RyYW5zZmVyIHRyID0gewpAQCAtNDgsNDMgKzQzLDE2IEBAIGludCB0aW55ZHJtX3Nw
aV90cmFuc2ZlcihzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpLCB1MzIgc3BlZWRfaHosCiAJCS5zcGVl
ZF9oeiA9IHNwZWVkX2h6LAogCX07CiAJc3RydWN0IHNwaV9tZXNzYWdlIG07Ci0JdTE2ICpzd2Fw
X2J1ZiA9IE5VTEw7CiAJc2l6ZV90IGNodW5rOwotCWludCByZXQgPSAwOworCWludCByZXQ7CiAK
LQlpZiAoV0FSTl9PTl9PTkNFKGJwdyAhPSA4ICYmIGJwdyAhPSAxNikpCi0JCXJldHVybiAtRUlO
VkFMOwotCi0JaWYgKGJwdyA9PSAxNiAmJiAhc3BpX2lzX2Jwd19zdXBwb3J0ZWQoc3BpLCAxNikp
IHsKLQkJdHIuYml0c19wZXJfd29yZCA9IDg7Ci0JCWlmICh0aW55ZHJtX21hY2hpbmVfbGl0dGxl
X2VuZGlhbigpKSB7Ci0JCQlzd2FwX2J1ZiA9IGttYWxsb2MobWluKGxlbiwgbWF4X2NodW5rKSwg
R0ZQX0tFUk5FTCk7Ci0JCQlpZiAoIXN3YXBfYnVmKQotCQkJCXJldHVybiAtRU5PTUVNOwotCQl9
Ci0JfQotCi0Jc3BpX21lc3NhZ2VfaW5pdCgmbSk7Ci0JaWYgKGhlYWRlcikKLQkJc3BpX21lc3Nh
Z2VfYWRkX3RhaWwoaGVhZGVyLCAmbSk7Ci0Jc3BpX21lc3NhZ2VfYWRkX3RhaWwoJnRyLCAmbSk7
CisJc3BpX21lc3NhZ2VfaW5pdF93aXRoX3RyYW5zZmVycygmbSwgJnRyLCAxKTsKIAogCXdoaWxl
IChsZW4pIHsKIAkJY2h1bmsgPSBtaW4obGVuLCBtYXhfY2h1bmspOwogCiAJCXRyLnR4X2J1ZiA9
IGJ1ZjsKIAkJdHIubGVuID0gY2h1bms7Ci0KLQkJaWYgKHN3YXBfYnVmKSB7Ci0JCQljb25zdCB1
MTYgKmJ1ZjE2ID0gYnVmOwotCQkJdW5zaWduZWQgaW50IGk7Ci0KLQkJCWZvciAoaSA9IDA7IGkg
PCBjaHVuayAvIDI7IGkrKykKLQkJCQlzd2FwX2J1ZltpXSA9IHN3YWIxNihidWYxNltpXSk7Ci0K
LQkJCXRyLnR4X2J1ZiA9IHN3YXBfYnVmOwotCQl9Ci0KIAkJYnVmICs9IGNodW5rOwogCQlsZW4g
LT0gY2h1bms7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUu
YyBiL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYwppbmRleCA3YThlMWI0YTM3ZWUu
LjIxNjc3ZTNlZDM4YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTIy
NS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYwpAQCAtMzIzLDcgKzMy
Myw3IEBAIHN0YXRpYyBpbnQgaWxpOTIyNV9kYmlfY29tbWFuZChzdHJ1Y3QgbWlwaV9kYmkgKm1p
cGksIHU4ICpjbWQsIHU4ICpwYXIsCiAKIAlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAobWlwaS0+
ZGMsIDApOwogCXNwZWVkX2h6ID0gbWlwaV9kYmlfc3BpX2NtZF9tYXhfc3BlZWQoc3BpLCAxKTsK
LQlyZXQgPSB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVkX2h6LCBOVUxMLCA4LCBjbWQs
IDEpOworCXJldCA9IHRpbnlkcm1fc3BpX3RyYW5zZmVyKHNwaSwgc3BlZWRfaHosIDgsIGNtZCwg
MSk7CiAJaWYgKHJldCB8fCAhbnVtKQogCQlyZXR1cm4gcmV0OwogCkBAIC0zMzMsNyArMzMzLDcg
QEAgc3RhdGljIGludCBpbGk5MjI1X2RiaV9jb21tYW5kKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwg
dTggKmNtZCwgdTggKnBhciwKIAlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAobWlwaS0+ZGMsIDEp
OwogCXNwZWVkX2h6ID0gbWlwaV9kYmlfc3BpX2NtZF9tYXhfc3BlZWQoc3BpLCBudW0pOwogCi0J
cmV0dXJuIHRpbnlkcm1fc3BpX3RyYW5zZmVyKHNwaSwgc3BlZWRfaHosIE5VTEwsIGJwdywgcGFy
LCBudW0pOworCXJldHVybiB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVkX2h6LCBicHcs
IHBhciwgbnVtKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlf
cGlwZV9mdW5jcyBpbGk5MjI1X3BpcGVfZnVuY3MgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdGlueWRybS9taXBpLWRiaS5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1k
YmkuYwppbmRleCBhZTMxYTVjOWFhMWIuLjhmYjZjZTRjYTZmYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRy
bS9taXBpLWRiaS5jCkBAIC05MjYsNyArOTI2LDcgQEAgc3RhdGljIGludCBtaXBpX2RiaV90eXBl
YzNfY29tbWFuZChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIHU4ICpjbWQsCiAKIAlncGlvZF9zZXRf
dmFsdWVfY2Fuc2xlZXAobWlwaS0+ZGMsIDApOwogCXNwZWVkX2h6ID0gbWlwaV9kYmlfc3BpX2Nt
ZF9tYXhfc3BlZWQoc3BpLCAxKTsKLQlyZXQgPSB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNw
ZWVkX2h6LCBOVUxMLCA4LCBjbWQsIDEpOworCXJldCA9IHRpbnlkcm1fc3BpX3RyYW5zZmVyKHNw
aSwgc3BlZWRfaHosIDgsIGNtZCwgMSk7CiAJaWYgKHJldCB8fCAhbnVtKQogCQlyZXR1cm4gcmV0
OwogCkBAIC05MzYsNyArOTM2LDcgQEAgc3RhdGljIGludCBtaXBpX2RiaV90eXBlYzNfY29tbWFu
ZChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIHU4ICpjbWQsCiAJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNs
ZWVwKG1pcGktPmRjLCAxKTsKIAlzcGVlZF9oeiA9IG1pcGlfZGJpX3NwaV9jbWRfbWF4X3NwZWVk
KHNwaSwgbnVtKTsKIAotCXJldHVybiB0aW55ZHJtX3NwaV90cmFuc2ZlcihzcGksIHNwZWVkX2h6
LCBOVUxMLCBicHcsIHBhciwgbnVtKTsKKwlyZXR1cm4gdGlueWRybV9zcGlfdHJhbnNmZXIoc3Bp
LCBzcGVlZF9oeiwgYnB3LCBwYXIsIG51bSk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS9kcm0vdGlueWRybS90aW55ZHJtLWhlbHBlcnMuaCBiL2luY2x1ZGUvZHJtL3Rpbnlkcm0vdGlu
eWRybS1oZWxwZXJzLmgKaW5kZXggMTBiMzUzNzVhMDA5Li43MDhjNWE3ZDUxZTAgMTAwNjQ0Ci0t
LSBhL2luY2x1ZGUvZHJtL3Rpbnlkcm0vdGlueWRybS1oZWxwZXJzLmgKKysrIGIvaW5jbHVkZS9k
cm0vdGlueWRybS90aW55ZHJtLWhlbHBlcnMuaApAQCAtNDIsNyArNDIsNiBAQCBpbnQgdGlueWRy
bV9kaXNwbGF5X3BpcGVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLAogCQkJICAgICAgdW5z
aWduZWQgaW50IHJvdGF0aW9uKTsKIAogaW50IHRpbnlkcm1fc3BpX3RyYW5zZmVyKHN0cnVjdCBz
cGlfZGV2aWNlICpzcGksIHUzMiBzcGVlZF9oeiwKLQkJCSBzdHJ1Y3Qgc3BpX3RyYW5zZmVyICpo
ZWFkZXIsIHU4IGJwdywgY29uc3Qgdm9pZCAqYnVmLAotCQkJIHNpemVfdCBsZW4pOworCQkJIHU4
IGJwdywgY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgbGVuKTsKIAogI2VuZGlmIC8qIF9fTElOVVhf
VElOWURSTV9IRUxQRVJTX0ggKi8KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
