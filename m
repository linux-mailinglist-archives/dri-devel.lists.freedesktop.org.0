Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B86DC6D13F
	for <lists+dri-devel@lfdr.de>; Thu, 18 Jul 2019 17:38:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 06C9F6E418;
	Thu, 18 Jul 2019 15:38:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lj1-x243.google.com (mail-lj1-x243.google.com
 [IPv6:2a00:1450:4864:20::243])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 08B7E6E40C;
 Thu, 18 Jul 2019 15:37:57 +0000 (UTC)
Received: by mail-lj1-x243.google.com with SMTP id k18so27797042ljc.11;
 Thu, 18 Jul 2019 08:37:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=EUukcV3jlaamnumDfccC75aQOhb0AnTqZIzflbGgY8o=;
 b=FZ15fcFwXK8l1eg5uDZi1texd9z8rLcqV+q9dNdeI+5q+US0TJUYr+um+iMxynqm8k
 oeetbljqqigXwxFAuNwlEayCmFVZwSdS4jRTWtsei5Wub19gzWvdBka31eqj8GKYn3ik
 niRMJiPYrkQdZ84DG0iBx5RSaauQAhwF4LI2Ho9wNodwvARbr9xoayQXzCp9F+WAs+/S
 0h917kP+E0UM3Pq2WLHtPFp5etoUGwxlVqlnZ1J0u0k45ZKqvvnUdJz/vy7F76g6/DsA
 rWmlPz7Trw5m8a25WLjqGnh5iRg9anwdHmwu1VlLu7UtT9AuGgY4EVZYwNmFPyZitW6n
 7hQg==
X-Gm-Message-State: APjAAAVVJp765ObZPp40SGfpxUMYMNl6KrMdQ4FoyzgzcC/ypK2+mjIG
 yQs9ndmIJalOut7PUaMP/A2wFYjCieo=
X-Google-Smtp-Source: APXvYqzYbPmjRL9baOD8SHSwucOD14zbA5eTMl266wxlIPK126dxcxWKHsg1X/COFJcmGw3pFNzQDg==
X-Received: by 2002:a2e:8007:: with SMTP id j7mr24777828ljg.191.1563464274437; 
 Thu, 18 Jul 2019 08:37:54 -0700 (PDT)
Received: from saturn.lan (18.158-248-194.customer.lyse.net. [158.248.194.18])
 by smtp.gmail.com with ESMTPSA id
 c30sm4062388lfp.70.2019.07.18.08.37.53
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 18 Jul 2019 08:37:54 -0700 (PDT)
From: Sam Ravnborg <sam@ravnborg.org>
To: dri-devel@lists.freedesktop.org,
	openchrome-devel@lists.freedesktop.org
Subject: [PATCH v1 4/6] drm/via: drop DRM_WAIT_ON() in via_dmablit.c
Date: Thu, 18 Jul 2019 17:37:35 +0200
Message-Id: <20190718153737.28657-5-sam@ravnborg.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190718153737.28657-1-sam@ravnborg.org>
References: <20190718153737.28657-1-sam@ravnborg.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=sender:from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=EUukcV3jlaamnumDfccC75aQOhb0AnTqZIzflbGgY8o=;
 b=ebb5BUdZUJi87SEIFciC5S2xv+UUPA31j4VjkPBg8tQVi1jkLwdU9egXGjp4HWPMiF
 Xh7Br0ia9Gt41jNAqs6mayhnMmYIazXlQN2lQYXKrBUQJSCXUNtti1BcDejMRCCzqNSs
 lUR65kjS3tSVCHuaVXuR1IvwBuKl7W3dzoMRiQu8+nQLU6aHmxbIETG4kNphT+w1eKeT
 wd97LiBEfTyxlynk+Cf/zSZacsA5kxok0KteaNevRG1Lg3FRRbl0DrB3tF1ilg5vnh4U
 c/v83tp/Kf38BtKgoFd+qP2jfgHfvwt1ULflCOI8nVSF2nmtOeLJQtGtvskieilWLrnE
 09rw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Sam Ravnborg <sam@ravnborg.org>,
 "Gustavo A. R. Silva" <gustavo@embeddedor.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 Kevin Brace <kevinbrace@gmx.com>, Mike Marshall <hubcap@omnibond.com>,
 Ira Weiny <ira.weiny@intel.com>, Emil Velikov <emil.velikov@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFJNX1dBSVRfT04oKSBpcyBhIHJlbGllYyBmcm9tIHRoZSBwYXN0IGFuZCBpcyBkaXNjb3VyYWdl
ZC4KVXNlIHRoZSBzdGFuZGFyZCB3YWl0X2V2ZW50XyooKSBhcyByZXBsYWNlbWVudC4KCkJlIGNh
cmVmdWxsIHRvIGtlZXAgdGhlIHNhbWUgcmV0dXJuIHZhbHVlcy4KCnZpYV9kbWFfYmxpdF9zeW5j
KCkgY2hhbmdlZCAtRUlOVFIgdG8gLUVBR0FJTi4KTW92ZWQgdGhpcyB0byB2aWFfZG1hYmxpdF9z
eW5jKCkgc28gcmV0dXJuIHZhbHVlIGlzCmFkanVzdGVkIG9ubHkgb25jZS4KClNpZ25lZC1vZmYt
Ynk6IFNhbSBSYXZuYm9yZyA8c2FtQHJhdm5ib3JnLm9yZz4KQ2M6IEtldmluIEJyYWNlIDxrZXZp
bmJyYWNlQGdteC5jb20+CkNjOiBUaG9tYXMgSGVsbHN0cm9tIDx0aGVsbHN0cm9tQHZtd2FyZS5j
b20+CkNjOiAiR3VzdGF2byBBLiBSLiBTaWx2YSIgPGd1c3Rhdm9AZW1iZWRkZWRvci5jb20+CkNj
OiBNaWtlIE1hcnNoYWxsIDxodWJjYXBAb21uaWJvbmQuY29tPgpDYzogSXJhIFdlaW55IDxpcmEu
d2VpbnlAaW50ZWwuY29tPgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5j
aD4KQ2M6IEVtaWwgVmVsaWtvdiA8ZW1pbC52ZWxpa292QGNvbGxhYm9yYS5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5jIHwgNTQgKysrKysrKysrKysrKysrKysrKysr
Ky0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM5IGluc2VydGlvbnMoKyksIDE1IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYWJsaXQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYWJsaXQuYwppbmRleCA4N2Q4OGJkZDIwYzYuLjI3ZTJh
NjQxMTUwMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpYS92aWFfZG1hYmxpdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS92aWEvdmlhX2RtYWJsaXQuYwpAQCAtMzksNyArMzksNiBAQAog
I2luY2x1ZGUgPGxpbnV4L3ZtYWxsb2MuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+
Ci0jaW5jbHVkZSA8ZHJtL2RybV9vc19saW51eC5oPgogI2luY2x1ZGUgPGRybS9kcm1fcGNpLmg+
CiAjaW5jbHVkZSA8ZHJtL3ZpYV9kcm0uaD4KIApAQCAtNDI4LDggKzQyNywxMiBAQCB2aWFfZG1h
YmxpdF9hY3RpdmUoZHJtX3ZpYV9ibGl0cV90ICpibGl0cSwgaW50IGVuZ2luZSwgdWludDMyX3Qg
aGFuZGxlLCB3YWl0X3F1ZQogCiAvKgogICogU3luYy4gV2FpdCBmb3IgYXQgbGVhc3QgdGhyZWUg
c2Vjb25kcyBmb3IgdGhlIGJsaXQgdG8gYmUgcGVyZm9ybWVkLgorICoKKyAqIFJldHVybnM6Cisg
KiAwIGlmIGJsaXQgd2FzIHBlcmZvcm1lZCB3aXRoaW4gdGhlIHRocmVlIHNlY29uZHMgcGVyaW9k
CisgKiAtRUJVU1kgaWYgdGltZW91dCBvY2N1cmVkCisgKiAtRUFHQUlOIGlmIGEgc2lnbmFsIGlu
dGVycnVwdGVkIHRoZSB3YWl0CiAgKi8KLQogc3RhdGljIGludAogdmlhX2RtYWJsaXRfc3luYyhz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1aW50MzJfdCBoYW5kbGUsIGludCBlbmdpbmUpCiB7CkBA
IC00MzcsMTYgKzQ0MCwyNiBAQCB2aWFfZG1hYmxpdF9zeW5jKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHVpbnQzMl90IGhhbmRsZSwgaW50IGVuZ2luZSkKIAlkcm1fdmlhX3ByaXZhdGVfdCAqZGV2
X3ByaXYgPSAoZHJtX3ZpYV9wcml2YXRlX3QgKilkZXYtPmRldl9wcml2YXRlOwogCWRybV92aWFf
YmxpdHFfdCAqYmxpdHEgPSBkZXZfcHJpdi0+YmxpdF9xdWV1ZXMgKyBlbmdpbmU7CiAJd2FpdF9x
dWV1ZV9oZWFkX3QgKnF1ZXVlOwotCWludCByZXQgPSAwOworCWludCByZXQgPSAxOwogCiAJaWYg
KHZpYV9kbWFibGl0X2FjdGl2ZShibGl0cSwgZW5naW5lLCBoYW5kbGUsICZxdWV1ZSkpIHsKLQkJ
RFJNX1dBSVRfT04ocmV0LCAqcXVldWUsIDMgKiBIWiwKLQkJCSAgICAhdmlhX2RtYWJsaXRfYWN0
aXZlKGJsaXRxLCBlbmdpbmUsIGhhbmRsZSwgTlVMTCkpOworCQlyZXQgPSB3YWl0X2V2ZW50X2lu
dGVycnVwdGlibGVfdGltZW91dCgqcXVldWUsCisJCQkhdmlhX2RtYWJsaXRfYWN0aXZlKGJsaXRx
LCBlbmdpbmUsIGhhbmRsZSwgTlVMTCksCisJCQltc2Vjc190b19qaWZmaWVzKDMgKiAxMDAwKSk7
CiAJfQogCURSTV9ERUJVRygiRE1BIGJsaXQgc3luYyBoYW5kbGUgMHgleCBlbmdpbmUgJWQgcmV0
dXJuZWQgJWRcbiIsCiAJCSAgaGFuZGxlLCBlbmdpbmUsIHJldCk7CiAKLQlyZXR1cm4gcmV0Owor
CXN3aXRjaCAocmV0KSB7CisJY2FzZSAwOgorCQkvKiB0aW1lb3V0ICovCisJCXJldHVybiAtRUJV
U1k7CisJY2FzZSAtRVJFU1RBUlRTWVM6CisJCS8qIGludGVycnVwdGVkIGJ5IHNpZ25hbCAqLwor
CQlyZXR1cm4gLUVBR0FJTjsKKwlkZWZhdWx0OgorCQlyZXR1cm4gMDsKKwl9CiB9CiAKIApAQCAt
Njc3LDEzICs2OTAsMTcgQEAgdmlhX2J1aWxkX3NnX2luZm8oc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgZHJtX3ZpYV9zZ19pbmZvX3QgKnZzZywgZHJtX3ZpYV9kbWFibGkKIAogLyoKICAqIFJlc2Vy
dmUgb25lIGZyZWUgc2xvdCBpbiB0aGUgYmxpdCBxdWV1ZS4gV2lsbCB3YWl0IGZvciBvbmUgc2Vj
b25kIGZvciBvbmUKLSAqIHRvIGJlY29tZSBhdmFpbGFibGUuIE90aGVyd2lzZSAtRUJVU1kgaXMg
cmV0dXJuZWQuCisgKiB0byBiZWNvbWUgYXZhaWxhYmxlLgorICoKKyAqIFJldHVybnM6CisgKiAw
IGlmIHNsb3Qgd2FzIHJlc2VydmVkCisgKiAtRUJVU1kgaWYgdGltZW91dCB3aGlsZSB3YWl0aW5n
IGZvciBmcmVlIHNsb3QKKyAqIC1FQUdBSU4gaWYgaW50ZXJydXB0ZWQgYnkgYSBzaWduYWwKICAq
LwotCiBzdGF0aWMgaW50CiB2aWFfZG1hYmxpdF9ncmFiX3Nsb3QoZHJtX3ZpYV9ibGl0cV90ICpi
bGl0cSwgaW50IGVuZ2luZSkKIHsKLQlpbnQgcmV0ID0gMDsKKwlpbnQgcmV0OwogCXVuc2lnbmVk
IGxvbmcgaXJxc2F2ZTsKIAogCURSTV9ERUJVRygiTnVtIGZyZWUgaXMgJWRcbiIsIGJsaXRxLT5u
dW1fZnJlZSk7CkBAIC02OTEsOSArNzA4LDE5IEBAIHZpYV9kbWFibGl0X2dyYWJfc2xvdChkcm1f
dmlhX2JsaXRxX3QgKmJsaXRxLCBpbnQgZW5naW5lKQogCXdoaWxlIChibGl0cS0+bnVtX2ZyZWUg
PT0gMCkgewogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZibGl0cS0+YmxpdF9sb2NrLCBpcnFz
YXZlKTsKIAotCQlEUk1fV0FJVF9PTihyZXQsIGJsaXRxLT5idXN5X3F1ZXVlLCBIWiwgYmxpdHEt
Pm51bV9mcmVlID4gMCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gKC1FSU5UUiA9PSByZXQpID8g
LUVBR0FJTiA6IHJldDsKKwkJcmV0ID0gd2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlX3RpbWVvdXQo
YmxpdHEtPmJ1c3lfcXVldWUsCisJCQkJCQkgICAgICAgYmxpdHEtPm51bV9mcmVlID4gMCwKKwkJ
CQkJCSAgICAgICBtc2Vjc190b19qaWZmaWVzKDEwMDApKTsKKwkJc3dpdGNoIChyZXQpIHsKKwkJ
Y2FzZSAwOgorCQkJLyogdGltZW91dCAqLworCQkJcmV0dXJuIC1FQlVTWTsKKwkJY2FzZSAtRVJF
U1RBUlRTWVM6CisJCQkvKiBpbnRlcnJ1cHRlZCBieSBzaWduYWwgKi8KKwkJCXJldHVybiAtRUFH
QUlOOworCQlkZWZhdWx0OgorCQkJcmV0dXJuIDA7CisJCX0KIAogCQlzcGluX2xvY2tfaXJxc2F2
ZSgmYmxpdHEtPmJsaXRfbG9jaywgaXJxc2F2ZSk7CiAJfQpAQCAtNzg2LDkgKzgxMyw2IEBAIHZp
YV9kbWFfYmxpdF9zeW5jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVj
dCBkcm1fZmlsZSAqZmlsZV9wcml2CiAKIAllcnIgPSB2aWFfZG1hYmxpdF9zeW5jKGRldiwgc3lu
Yy0+c3luY19oYW5kbGUsIHN5bmMtPmVuZ2luZSk7CiAKLQlpZiAoLUVJTlRSID09IGVycikKLQkJ
ZXJyID0gLUVBR0FJTjsKLQogCXJldHVybiBlcnI7CiB9CiAKLS0gCjIuMjAuMQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcg
bGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
