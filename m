Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3F845C88A4F
	for <lists+dri-devel@lfdr.de>; Wed, 26 Nov 2025 09:31:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BEE9210E0C4;
	Wed, 26 Nov 2025 08:31:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from outboundhk.mxmail.xiaomi.com (outboundhk.mxmail.xiaomi.com
 [207.226.244.123])
 by gabe.freedesktop.org (Postfix) with ESMTP id D0E0D10E4EE
 for <dri-devel@lists.freedesktop.org>; Wed, 26 Nov 2025 01:50:45 +0000 (UTC)
X-CSE-ConnectionGUID: 7gPYFoFnQXykP/eZH9N83Q==
X-CSE-MsgGUID: buGJZFB2QAuxx8ZdeIettg==
X-IronPort-AV: E=Sophos;i="6.20,227,1758556800"; 
 d="scan'208,217";a="159453924"
From: =?gb2312?B?uN/P6A==?= <gaoxiang17@xiaomi.com>
To: Steven Rostedt <rostedt@goodmis.org>, Xiang Gao <gxxa03070307@gmail.com>
CC: "sumit.semwal@linaro.org" <sumit.semwal@linaro.org>,
 "christian.koenig@amd.com" <christian.koenig@amd.com>, "mhiramat@kernel.org"
 <mhiramat@kernel.org>, "linux-media@vger.kernel.org"
 <linux-media@vger.kernel.org>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "linaro-mm-sig@lists.linaro.org"
 <linaro-mm-sig@lists.linaro.org>, "linux-kernel@vger.kernel.org"
 <linux-kernel@vger.kernel.org>, "mathieu.desnoyers@efficios.com"
 <mathieu.desnoyers@efficios.com>, "dhowells@redhat.com"
 <dhowells@redhat.com>, "kuba@kernel.org" <kuba@kernel.org>,
 "brauner@kernel.org" <brauner@kernel.org>, "akpm@linux-foundation.org"
 <akpm@linux-foundation.org>, "linux-trace-kernel@vger.kernel.org"
 <linux-trace-kernel@vger.kernel.org>
Subject: =?gb2312?B?tPC4tDogW0V4dGVybmFsIE1haWxdUmU6IFtQQVRDSCB2Ml0gZG1hLWJ1Zjog?=
 =?gb2312?Q?add_some_tracepoints_to_debug.?=
Thread-Topic: [External Mail]Re: [PATCH v2] dma-buf: add some tracepoints to
 debug.
Thread-Index: AQHcXnVr7Qu6wSI//E+RqRogONuuabUEMR8r
Date: Wed, 26 Nov 2025 01:50:39 +0000
Message-ID: <0fdfc50ff0334121af34dee2f352292e@xiaomi.com>
References: <20251125162949.220488-1-gxxa03070307@gmail.com>,
 <20251125203924.3bd59b2c@gandalf.local.home>
In-Reply-To: <20251125203924.3bd59b2c@gandalf.local.home>
Accept-Language: zh-CN, en-US
Content-Language: zh-CN
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.237.88.13]
Content-Type: multipart/alternative;
 boundary="_000_0fdfc50ff0334121af34dee2f352292exiaomicom_"
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 26 Nov 2025 08:31:07 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

--_000_0fdfc50ff0334121af34dee2f352292exiaomicom_
Content-Type: text/plain; charset="gb2312"
Content-Transfer-Encoding: base64

b2ssIHRoYW5rcy4NCg0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18NCreivP7Iyzog
U3RldmVuIFJvc3RlZHQgPHJvc3RlZHRAZ29vZG1pcy5vcmc+DQq3osvNyrG85DogMjAyNcTqMTHU
wjI2yNUgOTozOToyNA0KytW8/sjLOiBYaWFuZyBHYW8NCrOty806IHN1bWl0LnNlbXdhbEBsaW5h
cm8ub3JnOyBjaHJpc3RpYW4ua29lbmlnQGFtZC5jb207IG1oaXJhbWF0QGtlcm5lbC5vcmc7IGxp
bnV4LW1lZGlhQHZnZXIua2VybmVsLm9yZzsgZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZzsgbGluYXJvLW1tLXNpZ0BsaXN0cy5saW5hcm8ub3JnOyBsaW51eC1rZXJuZWxAdmdlci5rZXJu
ZWwub3JnOyBtYXRoaWV1LmRlc25veWVyc0BlZmZpY2lvcy5jb207IGRob3dlbGxzQHJlZGhhdC5j
b207IGt1YmFAa2VybmVsLm9yZzsgYnJhdW5lckBrZXJuZWwub3JnOyBha3BtQGxpbnV4LWZvdW5k
YXRpb24ub3JnOyBsaW51eC10cmFjZS1rZXJuZWxAdmdlci5rZXJuZWwub3JnOyC438/oDQrW98zi
OiBbRXh0ZXJuYWwgTWFpbF1SZTogW1BBVENIIHYyXSBkbWEtYnVmOiBhZGQgc29tZSB0cmFjZXBv
aW50cyB0byBkZWJ1Zy4NCg0KW83isr/Tyrz+XSC0y9PKvP7AtNS009rQocPXuavLvs3isr+jrMfr
vffJ97SmwO2ho8j0ttTTyrz+sLLIq9DUtObSyaOsx+u9q9PKvP7XqreiuPhtaXNlY0B4aWFvbWku
Y29tvfjQ0Le0wKENCg0KT24gV2VkLCAyNiBOb3YgMjAyNSAwMDoyOTo0OSArMDgwMA0KWGlhbmcg
R2FvIDxneHhhMDMwNzAzMDdAZ21haWwuY29tPiB3cm90ZToNCg0KPiArKysgYi9pbmNsdWRlL3Ry
YWNlL2V2ZW50cy9kbWFfYnVmLmgNCj4gQEAgLTAsMCArMSwyODEgQEANCj4gKy8qIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovDQo+ICsjdW5kZWYgVFJBQ0VfU1lTVEVNDQo+ICsj
ZGVmaW5lIFRSQUNFX1NZU1RFTSBkbWFfYnVmDQo+ICsNCj4gKyNpZiAhZGVmaW5lZChfVFJBQ0Vf
RE1BX0JVRl9IKSB8fCBkZWZpbmVkKFRSQUNFX0hFQURFUl9NVUxUSV9SRUFEKQ0KPiArI2RlZmlu
ZSBfVFJBQ0VfRE1BX0JVRl9IDQo+ICsNCj4gKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+DQo+
ICsjaW5jbHVkZSA8bGludXgvdHJhY2Vwb2ludC5oPg0KPiArDQo+ICtUUkFDRV9FVkVOVChkbWFf
YnVmX2V4cG9ydCwNCj4gKw0KPiArICAgICBUUF9QUk9UTyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
KSwNCj4gKw0KPiArICAgICBUUF9BUkdTKGRtYWJ1ZiksDQo+ICsNCj4gKyAgICAgVFBfU1RSVUNU
X19lbnRyeSgNCj4gKyAgICAgICAgICAgICBfX3N0cmluZyhleHBfbmFtZSwgZG1hYnVmLT5leHBf
bmFtZSkNCj4gKyAgICAgICAgICAgICBfX3N0cmluZyhuYW1lLCBkbWFidWYtPm5hbWUpDQo+ICsg
ICAgICAgICAgICAgX19maWVsZChzaXplX3QsIHNpemUpDQo+ICsgICAgICAgICAgICAgX19maWVs
ZChpbm9fdCwgaW5vKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQobG9uZywgZl9yZWZjbnQpDQo+
ICsgICAgICksDQo+ICsNCj4gKyAgICAgVFBfZmFzdF9hc3NpZ24oDQo+ICsgICAgICAgICAgICAg
X19hc3NpZ25fc3RyKGV4cF9uYW1lKTsNCj4gKyAgICAgICAgICAgICBzcGluX2xvY2soJmRtYWJ1
Zi0+bmFtZV9sb2NrKTsNCj4gKyAgICAgICAgICAgICBfX2Fzc2lnbl9zdHIobmFtZSk7DQo+ICsg
ICAgICAgICAgICAgc3Bpbl91bmxvY2soJmRtYWJ1Zi0+bmFtZV9sb2NrKTsNCg0KVGhlIGFib3Zl
IGlzbid0IGRvaW5nIHdoYXQgeW91IHRoaW5rIGl0J3MgZG9pbmcuIFRoZSBuYW1lIGlzIGFzc2ln
bmVkDQpiZWZvcmUgdGhpcyBieSB0aGUgYWJvdmUgX19zdHJpbmcobmFtZSwgZG1hYnVmLT5uYW1l
KS4NCg0KWW91IHJlYWxseSBzaG91bGRuJ3QgYmUgdGFraW5nIGFueSBsb2NrcyBpbiBhIHRyYWNl
cG9pbnQuIEEgdHJhY2Vwb2ludCBpcyBhDQpjYWxsYmFjaywgdGhhdCBpc24ndCBjYWxsZWQgbW9z
dCBvZiB0aGUgdGltZS4gWW91IGNvdWxkIGJlIGhpZGluZyB2ZXJ5DQpoYXJkIHRvIGZpbmQgZGVh
ZGxvY2tzIGJ5IHRha2luZyBhIGxvY2sgaW4gYSB0cmFjZXBvaW50IGNhbGxiYWNrLg0KDQpZb3Ug
bmVlZCB0byB0YWtlIHRoZSBsb2NrIGFyb3VuZCB0aGUgdHJhY2Vwb2ludCBjYWxsIGl0c2VsZiB3
aGVyZSBpdCBpcw0KY2FsbGVkIGluIHRoZSBjb2RlLiBOb3QgaW4gdGhlIFRSQUNFX0VWRU5ULg0K
DQpZb3UgbWF5IG5lZWQgdG8gaGF2ZSBzb21ldGhpbmcgbGlrZToNCg0KQEAgLTIyMCw2ICsyMjMs
OCBAQCBzdGF0aWMgaW50IGRtYV9idWZfbW1hcF9pbnRlcm5hbChzdHJ1Y3QgZmlsZSAqZmlsZSwg
c3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpDQogICAgICAgICAgICBkbWFidWYtPnNpemUgPj4g
UEFHRV9TSElGVCkNCiAgICAgICAgICAgICAgICByZXR1cm4gLUVJTlZBTDsNCg0KKyAgICAgICBp
ZiAodHJhY2VfZG1hX2J1Zl9tbWFwX2ludGVybmFsX2VuYWJsZWQoKSkgew0KKyAgICAgICAgICAg
ICAgIGd1YXJkKHNwaW5sb2NrKSgmZG1hYnVmLT5uYW1lbG9jayk7DQorICAgICAgICAgICAgICAg
dHJhY2VfZG1hX2J1Zl9tbWFwX2ludGVybmFsKGRtYWJ1Zik7DQorICAgICAgIH0NCisNCiAgICAg
ICAgcmV0dXJuIGRtYWJ1Zi0+b3BzLT5tbWFwKGRtYWJ1Ziwgdm1hKTsNCiB9DQoNCg0KVGhlICJ0
cmFjZV9kbWFfYnVmX21tYXBfaW50ZXJuYWxfZW5hYmxlZCgpIiBpcyBhIHN0YXRpYyBicmFuY2gs
IHdoZXJlIGl0IGlzDQplaXRoZXIgYSBub3Agb3IgYSBqdW1wIHRvIHRoZSB0cmFjaW5nIGNvZGUu
IEl0J3Mgbm90IGEgbm9ybWFsIGNvbmRpdGlvbmFsDQpicmFuY2guIEl0IGFjdHMgdGhlIHNhbWUg
YXMgdHJhY2Vwb2ludHMgdGhlbXNlbHZlcyBkby4NCg0KPiArICAgICAgICAgICAgIF9fZW50cnkt
PnNpemUgPSBkbWFidWYtPnNpemU7DQo+ICsgICAgICAgICAgICAgX19lbnRyeS0+aW5vID0gZG1h
YnVmLT5maWxlLT5mX2lub2RlLT5pX2lubzsNCj4gKyAgICAgICAgICAgICBfX2VudHJ5LT5mX3Jl
ZmNudCA9IGZpbGVfY291bnQoZG1hYnVmLT5maWxlKTsNCj4gKyAgICAgKSwNCj4gKw0KPiArICAg
ICBUUF9wcmludGsoImV4cF9uYW1lPSVzIG5hbWU9JXMgc2l6ZT0lenUgaW5vPSVsdSBmX3JlZmNu
dD0lbGQiLA0KPiArICAgICAgICAgICAgICAgX19nZXRfc3RyKGV4cF9uYW1lKSwNCj4gKyAgICAg
ICAgICAgICAgIF9fZ2V0X3N0cihuYW1lKSwNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPnNp
emUsDQo+ICsgICAgICAgICAgICAgICBfX2VudHJ5LT5pbm8sDQo+ICsgICAgICAgICAgICAgICBf
X2VudHJ5LT5mX3JlZmNudCkNCj4gKyk7DQoNCkJlbG93IHNlZW1zIHRvIGJlIGEgbG90IG9mIHZl
cnkgc2ltaWxhciBUUkFDRV9FVkVOVCgpcy4gQSBUUkFDRV9FVkVOVCgpIGlzDQpsaXRlcmFsbHkg
ZGVmaW5lZCBhczoNCg0KI2RlZmluZSBUUkFDRV9FVkVOVChuYW1lLCBwcm90bywgYXJncywgdHN0
cnVjdCwgYXNzaWduLCBwcmludCkgXA0KICAgICAgICBERUNMQVJFX0VWRU5UX0NMQVNTKG5hbWUs
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXA0KICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBQQVJBTVMocHJvdG8pLCAgICAgICAgICAgICAgICAgICAgXA0KICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBQQVJBTVMoYXJncyksICAgICAgICAgICAgICAgICAgICAgXA0KICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBQQVJBTVModHN0cnVjdCksICAgICAgICAgICAgICAgICAg
XA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVJBTVMoYXNzaWduKSwgICAgICAgICAg
ICAgICAgICAgXA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVJBTVMocHJpbnQpKTsg
ICAgICAgICAgICAgICAgICAgXA0KICAgICAgICBERUZJTkVfRVZFTlQobmFtZSwgbmFtZSwgUEFS
QU1TKHByb3RvKSwgUEFSQU1TKGFyZ3MpKTsNCg0KVGhhdCBpcywgaXQgaXMgYm90aCBhIERFQ0xB
UkVfRVZFTlRfQ0xBU1MoKSBhbmQgYSBERUZJTkVfRVZFTlQoKS4gWW91IGNhbg0KbWFrZSBvbmUg
REVDTEFSRV9FVkVOVF9DTEFTUygpIGFuZCB1c2UgbWFueSBERUZJTkVfRVZFTlQoKXMgd2l0aCBp
dC4NCg0KRWFjaCBERUNMQVJFX0VWRU5UX0NMQVNTKCkgdGFrZXMgdXAgYXJvdW5kIDQgdG8gNSBr
aWxvYnl0ZXMgb2YgbWVtb3J5LiBFYWNoDQpERUZJTkVfRVZFTlQoKSB0YWtlcyBhcm91bmQgMzAw
IGJ5dGVzIHRvIDFLIG9mIG1lbW9yeS4gVGhlIG1vcmUNCkRFRklORV9FVkVOVCgpcyB5b3UgdXNl
IHdpdGggYSBzaW5nbGUgREVDTEFSRV9FVkVOVF9DTEFTUygpLCB0aGUgbW9yZQ0KbWVtb3J5IHlv
dSBzYXZlLiBQbGVhc2UgdHJ5IHRvIGRvIHRoYXQuDQoNCi0tIFN0ZXZlDQoNCg0KDQo+ICsNCj4g
K1RSQUNFX0VWRU5UKGRtYV9idWZfZmQsDQo+ICsNCj4gKyAgICAgVFBfUFJPVE8oc3RydWN0IGRt
YV9idWYgKmRtYWJ1ZiwgaW50IGZkKSwNCj4gKw0KPiArICAgICBUUF9BUkdTKGRtYWJ1ZiwgZmQp
LA0KPiArDQo+ICsgICAgIFRQX1NUUlVDVF9fZW50cnkoDQo+ICsgICAgICAgICAgICAgX19zdHJp
bmcoZXhwX25hbWUsIGRtYWJ1Zi0+ZXhwX25hbWUpDQo+ICsgICAgICAgICAgICAgX19zdHJpbmco
bmFtZSwgZG1hYnVmLT5uYW1lKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoc2l6ZV90LCBzaXpl
KQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoaW5vX3QsIGlubykNCj4gKyAgICAgICAgICAgICBf
X2ZpZWxkKGludCwgZmQpDQo+ICsgICAgICAgICAgICAgX19maWVsZChsb25nLCBmX3JlZmNudCkN
Cj4gKyAgICAgKSwNCj4gKw0KPiArICAgICBUUF9mYXN0X2Fzc2lnbigNCj4gKyAgICAgICAgICAg
ICBfX2Fzc2lnbl9zdHIoZXhwX25hbWUpOw0KPiArICAgICAgICAgICAgIHNwaW5fbG9jaygmZG1h
YnVmLT5uYW1lX2xvY2spOw0KPiArICAgICAgICAgICAgIF9fYXNzaWduX3N0cihuYW1lKTsNCj4g
KyAgICAgICAgICAgICBzcGluX3VubG9jaygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiArICAgICAg
ICAgICAgIF9fZW50cnktPnNpemUgPSBkbWFidWYtPnNpemU7DQo+ICsgICAgICAgICAgICAgX19l
bnRyeS0+aW5vID0gZG1hYnVmLT5maWxlLT5mX2lub2RlLT5pX2lubzsNCj4gKyAgICAgICAgICAg
ICBfX2VudHJ5LT5mZCA9IGZkOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPmZfcmVmY250ID0g
ZmlsZV9jb3VudChkbWFidWYtPmZpbGUpOw0KPiArICAgICApLA0KPiArDQo+ICsgICAgIFRQX3By
aW50aygiZXhwX25hbWU9JXMgbmFtZT0lcyBzaXplPSV6dSBpbm89JWx1IGZkPSVkIGZfcmVmY250
PSVsZCIsDQo+ICsgICAgICAgICAgICAgICBfX2dldF9zdHIoZXhwX25hbWUpLA0KPiArICAgICAg
ICAgICAgICAgX19nZXRfc3RyKG5hbWUpLA0KPiArICAgICAgICAgICAgICAgX19lbnRyeS0+c2l6
ZSwNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPmlubywNCj4gKyAgICAgICAgICAgICAgIF9f
ZW50cnktPmZkLA0KPiArICAgICAgICAgICAgICAgX19lbnRyeS0+Zl9yZWZjbnQpDQo+ICspOw0K
PiArDQo+ICtUUkFDRV9FVkVOVChkbWFfYnVmX21tYXBfaW50ZXJuYWwsDQo+ICsNCj4gKyAgICAg
VFBfUFJPVE8oc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiksDQo+ICsNCj4gKyAgICAgVFBfQVJHUyhk
bWFidWYpLA0KPiArDQo+ICsgICAgIFRQX1NUUlVDVF9fZW50cnkoDQo+ICsgICAgICAgICAgICAg
X19zdHJpbmcoZXhwX25hbWUsIGRtYWJ1Zi0+ZXhwX25hbWUpDQo+ICsgICAgICAgICAgICAgX19z
dHJpbmcobmFtZSwgZG1hYnVmLT5uYW1lKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoc2l6ZV90
LCBzaXplKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoaW5vX3QsIGlubykNCj4gKyAgICAgICAg
ICAgICBfX2ZpZWxkKGxvbmcsIGZfcmVmY250KQ0KPiArICAgICApLA0KPiArDQo+ICsgICAgIFRQ
X2Zhc3RfYXNzaWduKA0KPiArICAgICAgICAgICAgIF9fYXNzaWduX3N0cihleHBfbmFtZSk7DQo+
ICsgICAgICAgICAgICAgc3Bpbl9sb2NrKCZkbWFidWYtPm5hbWVfbG9jayk7DQo+ICsgICAgICAg
ICAgICAgX19hc3NpZ25fc3RyKG5hbWUpOw0KPiArICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZk
bWFidWYtPm5hbWVfbG9jayk7DQo+ICsgICAgICAgICAgICAgX19lbnRyeS0+c2l6ZSA9IGRtYWJ1
Zi0+c2l6ZTsNCj4gKyAgICAgICAgICAgICBfX2VudHJ5LT5pbm8gPSBkbWFidWYtPmZpbGUtPmZf
aW5vZGUtPmlfaW5vOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPmZfcmVmY250ID0gZmlsZV9j
b3VudChkbWFidWYtPmZpbGUpOw0KPiArICAgICApLA0KPiArDQo+ICsgICAgIFRQX3ByaW50aygi
ZXhwX25hbWU9JXMgbmFtZT0lcyBzaXplPSV6dSBpbm89JWx1IGZfcmVmY250PSVsZCIsDQo+ICsg
ICAgICAgICAgICAgICBfX2dldF9zdHIoZXhwX25hbWUpLA0KPiArICAgICAgICAgICAgICAgX19n
ZXRfc3RyKG5hbWUpLA0KPiArICAgICAgICAgICAgICAgX19lbnRyeS0+c2l6ZSwNCj4gKyAgICAg
ICAgICAgICAgIF9fZW50cnktPmlubywNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPmZfcmVm
Y250KQ0KPiArKTsNCj4gKw0KPiArVFJBQ0VfRVZFTlQoZG1hX2J1Zl9tbWFwLA0KPiArDQo+ICsg
ICAgIFRQX1BST1RPKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpLA0KPiArDQo+ICsgICAgIFRQX0FS
R1MoZG1hYnVmKSwNCj4gKw0KPiArICAgICBUUF9TVFJVQ1RfX2VudHJ5KA0KPiArICAgICAgICAg
ICAgIF9fc3RyaW5nKGV4cF9uYW1lLCBkbWFidWYtPmV4cF9uYW1lKQ0KPiArICAgICAgICAgICAg
IF9fc3RyaW5nKG5hbWUsIGRtYWJ1Zi0+bmFtZSkNCj4gKyAgICAgICAgICAgICBfX2ZpZWxkKHNp
emVfdCwgc2l6ZSkNCj4gKyAgICAgICAgICAgICBfX2ZpZWxkKGlub190LCBpbm8pDQo+ICsgICAg
ICAgICAgICAgX19maWVsZChsb25nLCBmX3JlZmNudCkNCj4gKyAgICAgKSwNCj4gKw0KPiArICAg
ICBUUF9mYXN0X2Fzc2lnbigNCj4gKyAgICAgICAgICAgICBfX2Fzc2lnbl9zdHIoZXhwX25hbWUp
Ow0KPiArICAgICAgICAgICAgIHNwaW5fbG9jaygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiArICAg
ICAgICAgICAgIF9fYXNzaWduX3N0cihuYW1lKTsNCj4gKyAgICAgICAgICAgICBzcGluX3VubG9j
aygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPnNpemUgPSBk
bWFidWYtPnNpemU7DQo+ICsgICAgICAgICAgICAgX19lbnRyeS0+aW5vID0gZG1hYnVmLT5maWxl
LT5mX2lub2RlLT5pX2lubzsNCj4gKyAgICAgICAgICAgICBfX2VudHJ5LT5mX3JlZmNudCA9IGZp
bGVfY291bnQoZG1hYnVmLT5maWxlKTsNCj4gKyAgICAgKSwNCj4gKw0KPiArICAgICBUUF9wcmlu
dGsoImV4cF9uYW1lPSVzIG5hbWU9JXMgc2l6ZT0lenUgaW5vPSVsdSBmX3JlZmNudD0lbGQiLA0K
PiArICAgICAgICAgICAgICAgX19nZXRfc3RyKGV4cF9uYW1lKSwNCj4gKyAgICAgICAgICAgICAg
IF9fZ2V0X3N0cihuYW1lKSwNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPnNpemUsDQo+ICsg
ICAgICAgICAgICAgICBfX2VudHJ5LT5pbm8sDQo+ICsgICAgICAgICAgICAgICBfX2VudHJ5LT5m
X3JlZmNudCkNCj4gKyk7DQo+ICsNCj4gK1RSQUNFX0VWRU5UKGRtYV9idWZfYXR0YWNoLA0KPiAr
DQo+ICsgICAgIFRQX1BST1RPKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkZXZpY2Ug
KmRldiksDQo+ICsNCj4gKyAgICAgVFBfQVJHUyhkbWFidWYsIGRldiksDQo+ICsNCj4gKyAgICAg
VFBfU1RSVUNUX19lbnRyeSgNCj4gKyAgICAgICAgICAgICBfX3N0cmluZyhkbmFtZSwgZGV2X25h
bWUoZGV2KSkNCj4gKyAgICAgICAgICAgICBfX3N0cmluZyhleHBfbmFtZSwgZG1hYnVmLT5leHBf
bmFtZSkNCj4gKyAgICAgICAgICAgICBfX3N0cmluZyhuYW1lLCBkbWFidWYtPm5hbWUpDQo+ICsg
ICAgICAgICAgICAgX19maWVsZChzaXplX3QsIHNpemUpDQo+ICsgICAgICAgICAgICAgX19maWVs
ZChpbm9fdCwgaW5vKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQobG9uZywgZl9yZWZjbnQpDQo+
ICsgICAgICksDQo+ICsNCj4gKyAgICAgVFBfZmFzdF9hc3NpZ24oDQo+ICsgICAgICAgICAgICAg
X19hc3NpZ25fc3RyKGRuYW1lKTsNCj4gKyAgICAgICAgICAgICBfX2Fzc2lnbl9zdHIoZXhwX25h
bWUpOw0KPiArICAgICAgICAgICAgIHNwaW5fbG9jaygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiAr
ICAgICAgICAgICAgIF9fYXNzaWduX3N0cihuYW1lKTsNCj4gKyAgICAgICAgICAgICBzcGluX3Vu
bG9jaygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPnNpemUg
PSBkbWFidWYtPnNpemU7DQo+ICsgICAgICAgICAgICAgX19lbnRyeS0+aW5vID0gZG1hYnVmLT5m
aWxlLT5mX2lub2RlLT5pX2lubzsNCj4gKyAgICAgICAgICAgICBfX2VudHJ5LT5mX3JlZmNudCA9
IGZpbGVfY291bnQoZG1hYnVmLT5maWxlKTsNCj4gKyAgICAgKSwNCj4gKw0KPiArICAgICBUUF9w
cmludGsoImRldl9uYW1lPSVzIGV4cF9uYW1lPSVzIG5hbWU9JXMgc2l6ZT0lenUgaW5vPSVsdSBm
X3JlZmNudD0lbGQiLA0KPiArICAgICAgICAgICAgICAgX19nZXRfc3RyKGRuYW1lKSwNCj4gKyAg
ICAgICAgICAgICAgIF9fZ2V0X3N0cihleHBfbmFtZSksDQo+ICsgICAgICAgICAgICAgICBfX2dl
dF9zdHIobmFtZSksDQo+ICsgICAgICAgICAgICAgICBfX2VudHJ5LT5zaXplLA0KPiArICAgICAg
ICAgICAgICAgX19lbnRyeS0+aW5vLA0KPiArICAgICAgICAgICAgICAgX19lbnRyeS0+Zl9yZWZj
bnQpDQo+ICspOw0KPiArDQo+ICtUUkFDRV9FVkVOVChkbWFfYnVmX2RldGFjaCwNCj4gKw0KPiAr
ICAgICBUUF9QUk9UTyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmKSwNCj4gKw0KPiArICAgICBUUF9B
UkdTKGRtYWJ1ZiksDQo+ICsNCj4gKyAgICAgVFBfU1RSVUNUX19lbnRyeSgNCj4gKyAgICAgICAg
ICAgICBfX3N0cmluZyhleHBfbmFtZSwgZG1hYnVmLT5leHBfbmFtZSkNCj4gKyAgICAgICAgICAg
ICBfX3N0cmluZyhuYW1lLCBkbWFidWYtPm5hbWUpDQo+ICsgICAgICAgICAgICAgX19maWVsZChz
aXplX3QsIHNpemUpDQo+ICsgICAgICAgICAgICAgX19maWVsZChpbm9fdCwgaW5vKQ0KPiArICAg
ICAgICAgICAgIF9fZmllbGQobG9uZywgZl9yZWZjbnQpDQo+ICsgICAgICksDQo+ICsNCj4gKyAg
ICAgVFBfZmFzdF9hc3NpZ24oDQo+ICsgICAgICAgICAgICAgX19hc3NpZ25fc3RyKGV4cF9uYW1l
KTsNCj4gKyAgICAgICAgICAgICBzcGluX2xvY2soJmRtYWJ1Zi0+bmFtZV9sb2NrKTsNCj4gKyAg
ICAgICAgICAgICBfX2Fzc2lnbl9zdHIobmFtZSk7DQo+ICsgICAgICAgICAgICAgc3Bpbl91bmxv
Y2soJmRtYWJ1Zi0+bmFtZV9sb2NrKTsNCj4gKyAgICAgICAgICAgICBfX2VudHJ5LT5zaXplID0g
ZG1hYnVmLT5zaXplOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPmlubyA9IGRtYWJ1Zi0+Zmls
ZS0+Zl9pbm9kZS0+aV9pbm87DQo+ICsgICAgICAgICAgICAgX19lbnRyeS0+Zl9yZWZjbnQgPSBm
aWxlX2NvdW50KGRtYWJ1Zi0+ZmlsZSk7DQo+ICsgICAgICksDQo+ICsNCj4gKyAgICAgVFBfcHJp
bnRrKCJleHBfbmFtZT0lcyBuYW1lPSVzIHNpemU9JXp1IGlubz0lbHUgZl9yZWZjbnQ9JWxkIiwN
Cj4gKyAgICAgICAgICAgICAgIF9fZ2V0X3N0cihleHBfbmFtZSksDQo+ICsgICAgICAgICAgICAg
ICBfX2dldF9zdHIobmFtZSksDQo+ICsgICAgICAgICAgICAgICBfX2VudHJ5LT5zaXplLA0KPiAr
ICAgICAgICAgICAgICAgX19lbnRyeS0+aW5vLA0KPiArICAgICAgICAgICAgICAgX19lbnRyeS0+
Zl9yZWZjbnQpDQo+ICspOw0KPiArDQo+ICtUUkFDRV9FVkVOVChkbWFfYnVmX2dldCwNCj4gKw0K
PiArICAgICBUUF9QUk9UTyhpbnQgZmQsIHN0cnVjdCBmaWxlICpmaWxlKSwNCj4gKw0KPiArICAg
ICBUUF9BUkdTKGZkLCBmaWxlKSwNCj4gKw0KPiArICAgICBUUF9TVFJVQ1RfX2VudHJ5KA0KPiAr
ICAgICAgICAgICAgIF9fc3RyaW5nKGV4cF9uYW1lLCAoKHN0cnVjdCBkbWFfYnVmICopZmlsZS0+
cHJpdmF0ZV9kYXRhKS0+ZXhwX25hbWUpDQo+ICsgICAgICAgICAgICAgX19zdHJpbmcobmFtZSwg
KChzdHJ1Y3QgZG1hX2J1ZiAqKWZpbGUtPnByaXZhdGVfZGF0YSktPm5hbWUpDQo+ICsgICAgICAg
ICAgICAgX19maWVsZChzaXplX3QsIHNpemUpDQo+ICsgICAgICAgICAgICAgX19maWVsZChpbm9f
dCwgaW5vKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoaW50LCBmZCkNCj4gKyAgICAgICAgICAg
ICBfX2ZpZWxkKGxvbmcsIGZfcmVmY250KQ0KPiArICAgICApLA0KPiArDQo+ICsgICAgIFRQX2Zh
c3RfYXNzaWduKA0KPiArICAgICAgICAgICAgIHN0cnVjdCBkbWFfYnVmICpkbWFidWYgPSAoc3Ry
dWN0IGRtYV9idWYgKilmaWxlLT5wcml2YXRlX2RhdGE7DQo+ICsNCj4gKyAgICAgICAgICAgICBf
X2Fzc2lnbl9zdHIoZXhwX25hbWUpOw0KPiArICAgICAgICAgICAgIHNwaW5fbG9jaygmZG1hYnVm
LT5uYW1lX2xvY2spOw0KPiArICAgICAgICAgICAgIF9fYXNzaWduX3N0cihuYW1lKTsNCj4gKyAg
ICAgICAgICAgICBzcGluX3VubG9jaygmZG1hYnVmLT5uYW1lX2xvY2spOw0KPiArICAgICAgICAg
ICAgIF9fZW50cnktPnNpemUgPSBkbWFidWYtPnNpemU7DQo+ICsgICAgICAgICAgICAgX19lbnRy
eS0+aW5vID0gZG1hYnVmLT5maWxlLT5mX2lub2RlLT5pX2lubzsNCj4gKyAgICAgICAgICAgICBf
X2VudHJ5LT5mZCA9IGZkOw0KPiArICAgICAgICAgICAgIF9fZW50cnktPmZfcmVmY250ID0gZmls
ZV9jb3VudChmaWxlKTsNCj4gKyAgICAgKSwNCj4gKw0KPiArICAgICBUUF9wcmludGsoImV4cF9u
YW1lPSVzIG5hbWU9JXMgc2l6ZT0lenUgaW5vPSVsdSBmZD0lZCBmX3JlZmNudD0lbGQiLA0KPiAr
ICAgICAgICAgICAgICAgX19nZXRfc3RyKGV4cF9uYW1lKSwNCj4gKyAgICAgICAgICAgICAgIF9f
Z2V0X3N0cihuYW1lKSwNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPnNpemUsDQo+ICsgICAg
ICAgICAgICAgICBfX2VudHJ5LT5pbm8sDQo+ICsgICAgICAgICAgICAgICBfX2VudHJ5LT5mZCwN
Cj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPmZfcmVmY250KQ0KPiArKTsNCj4gKw0KPiArVFJB
Q0VfRVZFTlQoZG1hX2J1Zl9wdXQsDQo+ICsNCj4gKyAgICAgVFBfUFJPVE8oc3RydWN0IGRtYV9i
dWYgKmRtYWJ1ZiksDQo+ICsNCj4gKyAgICAgVFBfQVJHUyhkbWFidWYpLA0KPiArDQo+ICsgICAg
IFRQX1NUUlVDVF9fZW50cnkoDQo+ICsgICAgICAgICAgICAgX19zdHJpbmcoZXhwX25hbWUsIGRt
YWJ1Zi0+ZXhwX25hbWUpDQo+ICsgICAgICAgICAgICAgX19zdHJpbmcobmFtZSwgZG1hYnVmLT5u
YW1lKQ0KPiArICAgICAgICAgICAgIF9fZmllbGQoc2l6ZV90LCBzaXplKQ0KPiArICAgICAgICAg
ICAgIF9fZmllbGQoaW5vX3QsIGlubykNCj4gKyAgICAgICAgICAgICBfX2ZpZWxkKGxvbmcsIGZf
cmVmY250KQ0KPiArICAgICApLA0KPiArDQo+ICsgICAgIFRQX2Zhc3RfYXNzaWduKA0KPiArICAg
ICAgICAgICAgIF9fYXNzaWduX3N0cihleHBfbmFtZSk7DQo+ICsgICAgICAgICAgICAgc3Bpbl9s
b2NrKCZkbWFidWYtPm5hbWVfbG9jayk7DQo+ICsgICAgICAgICAgICAgX19hc3NpZ25fc3RyKG5h
bWUpOw0KPiArICAgICAgICAgICAgIHNwaW5fdW5sb2NrKCZkbWFidWYtPm5hbWVfbG9jayk7DQo+
ICsgICAgICAgICAgICAgX19lbnRyeS0+c2l6ZSA9IGRtYWJ1Zi0+c2l6ZTsNCj4gKyAgICAgICAg
ICAgICBfX2VudHJ5LT5pbm8gPSBkbWFidWYtPmZpbGUtPmZfaW5vZGUtPmlfaW5vOw0KPiArICAg
ICAgICAgICAgIF9fZW50cnktPmZfcmVmY250ID0gZmlsZV9jb3VudChkbWFidWYtPmZpbGUpOw0K
PiArICAgICApLA0KPiArDQo+ICsgICAgIFRQX3ByaW50aygiZXhwX25hbWU9JXMgbmFtZT0lcyBz
aXplPSV6dSBpbm89JWx1IGZfcmVmY250PSVsZCIsDQo+ICsgICAgICAgICAgICAgICBfX2dldF9z
dHIoZXhwX25hbWUpLA0KPiArICAgICAgICAgICAgICAgX19nZXRfc3RyKG5hbWUpLA0KPiArICAg
ICAgICAgICAgICAgX19lbnRyeS0+c2l6ZSwNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPmlu
bywNCj4gKyAgICAgICAgICAgICAgIF9fZW50cnktPmZfcmVmY250KQ0KPiArKTsNCj4gKw0KPiAr
I2VuZGlmIC8qIF9UUkFDRV9ETUFfQlVGX0ggKi8NCj4gKw0KPiArLyogVGhpcyBwYXJ0IG11c3Qg
YmUgb3V0c2lkZSBwcm90ZWN0aW9uICovDQo+ICsjaW5jbHVkZSA8dHJhY2UvZGVmaW5lX3RyYWNl
Lmg+DQoNCg==

--_000_0fdfc50ff0334121af34dee2f352292exiaomicom_
Content-Type: text/html; charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<html>
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dgb2312">
<meta name=3D"Generator" content=3D"Microsoft Exchange Server">
<!-- converted from text --><style><!-- .EmailQuote { margin-left: 1pt; pad=
ding-left: 4pt; border-left: #800000 2px solid; } --></style>
</head>
<body>
<meta content=3D"text/html; charset=3DUTF-8">
<style type=3D"text/css" style=3D"">
<!--
p
	{margin-top:0;
	margin-bottom:0}
-->
</style>
<div dir=3D"ltr">
<div id=3D"x_divtagdefaultwrapper" dir=3D"ltr" style=3D"font-size:12pt; col=
or:#000000; font-family:Calibri,Helvetica,sans-serif">
<p>ok, thanks.</p>
</div>
<hr tabindex=3D"-1" style=3D"display:inline-block; width:98%">
<div id=3D"x_divRplyFwdMsg" dir=3D"ltr"><font face=3D"Calibri, sans-serif" =
color=3D"#000000" style=3D"font-size:11pt"><b>=B7=A2=BC=FE=C8=CB:</b> Steve=
n Rostedt &lt;rostedt@goodmis.org&gt;<br>
<b>=B7=A2=CB=CD=CA=B1=BC=E4:</b> 2025=C4=EA11=D4=C226=C8=D5 9:39:24<br>
<b>=CA=D5=BC=FE=C8=CB:</b> Xiang Gao<br>
<b>=B3=AD=CB=CD:</b> sumit.semwal@linaro.org; christian.koenig@amd.com; mhi=
ramat@kernel.org; linux-media@vger.kernel.org; dri-devel@lists.freedesktop.=
org; linaro-mm-sig@lists.linaro.org; linux-kernel@vger.kernel.org; mathieu.=
desnoyers@efficios.com; dhowells@redhat.com;
 kuba@kernel.org; brauner@kernel.org; akpm@linux-foundation.org; linux-trac=
e-kernel@vger.kernel.org; =B8=DF=CF=E8<br>
<b>=D6=F7=CC=E2:</b> [External Mail]Re: [PATCH v2] dma-buf: add some tracep=
oints to debug.</font>
<div>&nbsp;</div>
</div>
</div>
<font size=3D"2"><span style=3D"font-size:10pt;">
<div class=3D"PlainText">[=CD=E2=B2=BF=D3=CA=BC=FE] =B4=CB=D3=CA=BC=FE=C0=
=B4=D4=B4=D3=DA=D0=A1=C3=D7=B9=AB=CB=BE=CD=E2=B2=BF=A3=AC=C7=EB=BD=F7=C9=F7=
=B4=A6=C0=ED=A1=A3=C8=F4=B6=D4=D3=CA=BC=FE=B0=B2=C8=AB=D0=D4=B4=E6=D2=C9=A3=
=AC=C7=EB=BD=AB=D3=CA=BC=FE=D7=AA=B7=A2=B8=F8misec@xiaomi.com=BD=F8=D0=D0=
=B7=B4=C0=A1<br>
<br>
On Wed, 26 Nov 2025 00:29:49 &#43;0800<br>
Xiang Gao &lt;gxxa03070307@gmail.com&gt; wrote:<br>
<br>
&gt; &#43;&#43;&#43; b/include/trace/events/dma_buf.h<br>
&gt; @@ -0,0 &#43;1,281 @@<br>
&gt; &#43;/* SPDX-License-Identifier: GPL-2.0 */<br>
&gt; &#43;#undef TRACE_SYSTEM<br>
&gt; &#43;#define TRACE_SYSTEM dma_buf<br>
&gt; &#43;<br>
&gt; &#43;#if !defined(_TRACE_DMA_BUF_H) || defined(TRACE_HEADER_MULTI_READ=
)<br>
&gt; &#43;#define _TRACE_DMA_BUF_H<br>
&gt; &#43;<br>
&gt; &#43;#include &lt;linux/dma-buf.h&gt;<br>
&gt; &#43;#include &lt;linux/tracepoint.h&gt;<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_export,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
<br>
The above isn't doing what you think it's doing. The name is assigned<br>
before this by the above __string(name, dmabuf-&gt;name).<br>
<br>
You really shouldn't be taking any locks in a tracepoint. A tracepoint is a=
<br>
callback, that isn't called most of the time. You could be hiding very<br>
hard to find deadlocks by taking a lock in a tracepoint callback.<br>
<br>
You need to take the lock around the tracepoint call itself where it is<br>
called in the code. Not in the TRACE_EVENT.<br>
<br>
You may need to have something like:<br>
<br>
@@ -220,6 &#43;223,8 @@ static int dma_buf_mmap_internal(struct file *file,=
 struct vm_area_struct *vma)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dmabuf-&=
gt;size &gt;&gt; PAGE_SHIFT)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp; return -EINVAL;<br>
<br>
&#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (trace_dma_buf_mmap_internal_e=
nabled()) {<br>
&#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp; guard(spinlock)(&amp;dmabuf-&gt;namelock);<br>
&#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp; trace_dma_buf_mmap_internal(dmabuf);<br>
&#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&#43;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return dmabuf-&gt;ops-&gt;mmap(d=
mabuf, vma);<br>
&nbsp;}<br>
<br>
<br>
The &quot;trace_dma_buf_mmap_internal_enabled()&quot; is a static branch, w=
here it is<br>
either a nop or a jump to the tracing code. It's not a normal conditional<b=
r>
branch. It acts the same as tracepoints themselves do.<br>
<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
<br>
Below seems to be a lot of very similar TRACE_EVENT()s. A TRACE_EVENT() is<=
br>
literally defined as:<br>
<br>
#define TRACE_EVENT(name, proto, args, tstruct, assign, print) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DECLARE_EVENT_CLASS(name,&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp; PARAMS(proto),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<=
br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp; PARAMS(args),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp; PARAMS(tstruct),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp; PARAMS(assign),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp; PARAMS(print));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DEFINE_EVENT(name, name, PARAMS(=
proto), PARAMS(args));<br>
<br>
That is, it is both a DECLARE_EVENT_CLASS() and a DEFINE_EVENT(). You can<b=
r>
make one DECLARE_EVENT_CLASS() and use many DEFINE_EVENT()s with it.<br>
<br>
Each DECLARE_EVENT_CLASS() takes up around 4 to 5 kilobytes of memory. Each=
<br>
DEFINE_EVENT() takes around 300 bytes to 1K of memory. The more<br>
DEFINE_EVENT()s you use with a single DECLARE_EVENT_CLASS(), the more<br>
memory you save. Please try to do that.<br>
<br>
-- Steve<br>
<br>
<br>
<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_fd,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf, int fd)=
,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf, fd),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(int, fd)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;fd =3D fd;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu fd=3D%d f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;fd,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_mmap_internal,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_mmap,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_attach,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf, struct =
device *dev),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf, dev),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(dname, dev_name(dev))<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(dname);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;dev_name=3D%s exp_name=
=3D%s name=3D%s size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(dname),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_detach,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_get,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(int fd, struct file *file),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(fd, file),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, ((struct dma_buf *)file-&gt;private_data)-&gt;ex=
p_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, ((struct dma_buf *)file-&gt;private_data)-&gt;name)<=
br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(int, fd)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; struct dma_buf *dmabuf =3D (struct dma_buf *)file-&gt;private_data;=
<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;fd =3D fd;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu fd=3D%d f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;fd,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;TRACE_EVENT(dma_buf_put,<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_PROTO(struct dma_buf *dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_ARGS(dmabuf),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_STRUCT__entry(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(exp_name, dmabuf-&gt;exp_name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __string(name, dmabuf-&gt;name)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(size_t, size)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(ino_t, ino)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __field(long, f_refcnt)<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_fast_assign(<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(exp_name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_lock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __assign_str(name);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; spin_unlock(&amp;dmabuf-&gt;name_lock);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;size =3D dmabuf-&gt;size;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;ino =3D dmabuf-&gt;file-&gt;f_inode-&gt;i_ino;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp; __entry-&gt;f_refcnt =3D file_count(dmabuf-&gt;file);<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; ),<br>
&gt; &#43;<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp; TP_printk(&quot;exp_name=3D%s name=3D%s =
size=3D%zu ino=3D%lu f_refcnt=3D%ld&quot;,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(exp_name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __get_str(name),<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;size,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;ino,<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; __entry-&gt;f_refcnt)<br>
&gt; &#43;);<br>
&gt; &#43;<br>
&gt; &#43;#endif /* _TRACE_DMA_BUF_H */<br>
&gt; &#43;<br>
&gt; &#43;/* This part must be outside protection */<br>
&gt; &#43;#include &lt;trace/define_trace.h&gt;<br>
<br>
</div>
</span></font>
</body>
</html>

--_000_0fdfc50ff0334121af34dee2f352292exiaomicom_--
