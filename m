Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 54E44B1C14
	for <lists+dri-devel@lfdr.de>; Fri, 13 Sep 2019 13:17:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8D10F6EF1B;
	Fri, 13 Sep 2019 11:17:55 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1F7126EF1A
 for <dri-devel@lists.freedesktop.org>; Fri, 13 Sep 2019 11:17:54 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 7F3A228EC5E;
 Fri, 13 Sep 2019 12:17:52 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: Rob Herring <robh+dt@kernel.org>, Tomeu Vizoso <tomeu@tomeuvizoso.net>,
 Alyssa Rosenzweig <alyssa@rosenzweig.io>,
 Steven Price <steven.price@arm.com>
Subject: [PATCH 1/2] drm/panfrost: Allow passing extra information about BOs
 used by a job
Date: Fri, 13 Sep 2019 13:17:47 +0200
Message-Id: <20190913111748.21071-1-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Boris Brezillon <boris.brezillon@collabora.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIFJFQUQvV1JJVEUgZmxhZ3MgYXJlIHBhcnRpY3VsYXJseSB1c2VmdWwgaWYgd2Ugd2FudCB0
byBhdm9pZApzZXJpYWxpemF0aW9uIG9mIGpvYnMgdGhhdCByZWFkIGZyb20gdGhlIHNhbWUgQk8g
YnV0IG5ldmVyIHdyaXRlIHRvIGl0LgpUaGUgTk9fSU1QTElDSVRfRkVOQ0UgbWlnaHQgYmUgdXNl
ZnVsIHdoZW4gdGhlIHVzZXIga25vd3MgdGhlIEJPIGlzCnNoYXJlZCBidXQgam9icyBhcmUgdXNp
bmcgZGlmZmVyZW50IHBvcnRpb25zIG9mIHRoZSBidWZmZXIuCgpTaWduZWQtb2ZmLWJ5OiBCb3Jp
cyBCcmV6aWxsb24gPGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYyB8ICA3MiArKysrKysrKystLQogZHJpdmVy
cy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5jIHwgMTY0ICsrKysrKysrKysrKysrKysr
KystLS0tLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5oIHwgIDExICst
CiBpbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oICAgICAgICAgfCAgNDEgKysrKysrCiA0
IGZpbGVzIGNoYW5nZWQsIDI0NyBpbnNlcnRpb25zKCspLCA0MSBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKaW5kZXggZDc0NDQyZDcxMDQ4Li4wODA4
MmZkNTU3YzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9k
cnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKQEAgLTEx
OSwyMCArMTE5LDc2IEBAIHBhbmZyb3N0X2xvb2t1cF9ib3Moc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKIAkJICBzdHJ1Y3QgZHJtX3BhbmZyb3N0X3N1Ym1pdCAqYXJncywKIAkJICBzdHJ1Y3QgcGFu
ZnJvc3Rfam9iICpqb2IpCiB7Ci0Jam9iLT5ib19jb3VudCA9IGFyZ3MtPmJvX2hhbmRsZV9jb3Vu
dDsKKwlzdHJ1Y3QgZHJtX3BhbmZyb3N0X3N1Ym1pdF9ibyAqYm9fZGVzY3MgPSBOVUxMOworCXUz
MiAqaGFuZGxlcyA9IE5VTEw7CisJdTMyIGksIGJvX2NvdW50OworCWludCByZXQgPSAwOwogCi0J
aWYgKCFqb2ItPmJvX2NvdW50KQorCWJvX2NvdW50ID0gYXJncy0+Ym9fZGVzY19jb3VudCA/CisJ
CSAgIGFyZ3MtPmJvX2Rlc2NfY291bnQgOiBhcmdzLT5ib19oYW5kbGVfY291bnQ7CisJaWYgKCFi
b19jb3VudCkKIAkJcmV0dXJuIDA7CiAKLQlqb2ItPmltcGxpY2l0X2ZlbmNlcyA9IGt2bWFsbG9j
X2FycmF5KGpvYi0+Ym9fY291bnQsCi0JCQkJICBzaXplb2Yoc3RydWN0IGRtYV9mZW5jZSAqKSwK
Kwlqb2ItPmJvcyA9IGt2bWFsbG9jX2FycmF5KGJvX2NvdW50LCBzaXplb2YoKmpvYi0+Ym9zKSwK
IAkJCQkgIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKLQlpZiAoIWpvYi0+aW1wbGljaXRfZmVu
Y2VzKQorCWlmICgham9iLT5ib3MpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JcmV0dXJuIGRybV9n
ZW1fb2JqZWN0c19sb29rdXAoZmlsZV9wcml2LAotCQkJCSAgICAgICh2b2lkIF9fdXNlciAqKSh1
aW50cHRyX3QpYXJncy0+Ym9faGFuZGxlcywKLQkJCQkgICAgICBqb2ItPmJvX2NvdW50LCAmam9i
LT5ib3MpOworCWpvYi0+Ym9fY291bnQgPSBib19jb3VudDsKKwlib19kZXNjcyA9IGt2bWFsbG9j
X2FycmF5KGJvX2NvdW50LCBzaXplb2YoKmJvX2Rlc2NzKSwKKwkJCQkgIEdGUF9LRVJORUwgfCBf
X0dGUF9aRVJPKTsKKwlpZiAoIWJvX2Rlc2NzKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8g
b3V0OworCX0KKworCWlmICghYXJncy0+Ym9fZGVzY19jb3VudCkgeworCQloYW5kbGVzID0ga3Zt
YWxsb2NfYXJyYXkoYm9fY291bnQsIHNpemVvZigqaGFuZGxlcyksCisJCQkJCSBHRlBfS0VSTkVM
KTsKKwkJaWYgKCFoYW5kbGVzKSB7CisJCQlyZXQgPS1FTk9NRU07CisJCQlnb3RvIG91dDsKKwkJ
fQorCisJCWlmIChjb3B5X2Zyb21fdXNlcihoYW5kbGVzLAorCQkJCSAgICh2b2lkIF9fdXNlciAq
KSh1aW50cHRyX3QpYXJncy0+Ym9faGFuZGxlcywKKwkJCQkgICBqb2ItPmJvX2NvdW50ICogc2l6
ZW9mKCpoYW5kbGVzKSkpIHsKKwkJCXJldCA9IC1FRkFVTFQ7CisJCQlnb3RvIG91dDsKKwkJfQor
CisJCWZvciAoaSA9IDA7IGkgPCBqb2ItPmJvX2NvdW50OyBpKyspIHsKKwkJCWJvX2Rlc2NzW2ld
LmhhbmRsZSA9IGhhbmRsZXNbaV07CisJCQlib19kZXNjc1tpXS5mbGFncyA9IFBBTkZST1NUX1NV
Qk1JVF9CT19XUklURSB8CisJCQkJCSAgICBQQU5GUk9TVF9TVUJNSVRfQk9fUkVBRDsKKwkJfQor
CX0gZWxzZSBpZiAoY29weV9mcm9tX3VzZXIoYm9fZGVzY3MsCisJCQkJICAodm9pZCBfX3VzZXIg
KikodWludHB0cl90KWFyZ3MtPmJvX2Rlc2NzLAorCQkJCSAgam9iLT5ib19jb3VudCAqIHNpemVv
ZigqYm9fZGVzY3MpKSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlm
b3IgKGkgPSAwOyBpIDwgam9iLT5ib19jb3VudDsgaSsrKSB7CisJCWlmICgoYm9fZGVzY3NbaV0u
ZmxhZ3MgJiB+UEFORlJPU1RfU1VCTUlUX0JPX1ZBTElEX0ZMQUdTKSB8fAorICAgICAgICAgICAg
ICAgICAgICAhKGJvX2Rlc2NzW2ldLmZsYWdzICYgUEFORlJPU1RfU1VCTUlUX0JPX1JXKSkgewor
CQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJam9iLT5ib3NbaV0uZmxh
Z3MgPSBib19kZXNjc1tpXS5mbGFnczsKKwkJam9iLT5ib3NbaV0ub2JqID0gZHJtX2dlbV9vYmpl
Y3RfbG9va3VwKGZpbGVfcHJpdiwKKwkJCQkJCQlib19kZXNjc1tpXS5oYW5kbGUpOworCQlpZiAo
IWpvYi0+Ym9zW2ldLm9iaikgeworCQkJcmV0ID0gLUVOT0VOVDsKKwkJCWdvdG8gb3V0OworCQl9
CisJfQorCitvdXQ6CisJa3ZmcmVlKGhhbmRsZXMpOworCWt2ZnJlZShib19kZXNjcyk7CisJcmV0
dXJuIHJldDsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3Rfam9iLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmMK
aW5kZXggMDVjODVmNDVhMGRlLi5lNGI3NGZkZTkzMzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvcGFuZnJvc3Rfam9iLmMKQEAgLTE5MywyNCArMTkzLDExNiBAQCBzdGF0aWMgdm9pZCBwYW5m
cm9zdF9qb2JfaHdfc3VibWl0KHN0cnVjdCBwYW5mcm9zdF9qb2IgKmpvYiwgaW50IGpzKQogCXBt
X3J1bnRpbWVfcHV0X2F1dG9zdXNwZW5kKHBmZGV2LT5kZXYpOwogfQogCi1zdGF0aWMgdm9pZCBw
YW5mcm9zdF9hY3F1aXJlX29iamVjdF9mZW5jZXMoc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqYm9z
LAotCQkJCQkgICBpbnQgYm9fY291bnQsCi0JCQkJCSAgIHN0cnVjdCBkbWFfZmVuY2UgKippbXBs
aWNpdF9mZW5jZXMpCitzdGF0aWMgaW50IHBhbmZyb3N0X2FjcXVpcmVfb2JqZWN0X2ZlbmNlcyhz
dHJ1Y3QgcGFuZnJvc3Rfam9iICpqb2IpCiB7Ci0JaW50IGk7CisJaW50IGksIHJldDsKIAotCWZv
ciAoaSA9IDA7IGkgPCBib19jb3VudDsgaSsrKQotCQlpbXBsaWNpdF9mZW5jZXNbaV0gPSBkbWFf
cmVzdl9nZXRfZXhjbF9yY3UoYm9zW2ldLT5yZXN2KTsKKwlmb3IgKGkgPSAwOyBpIDwgam9iLT5i
b19jb3VudDsgaSsrKSB7CisJCXN0cnVjdCBwYW5mcm9zdF9qb2JfYm9fZGVzYyAqYm8gPSAmam9i
LT5ib3NbaV07CisJCXN0cnVjdCBkbWFfcmVzdiAqcm9iaiA9IGJvLT5vYmotPnJlc3Y7CisKKwkJ
aWYgKCEoam9iLT5ib3NbaV0uZmxhZ3MgJiBQQU5GUk9TVF9TVUJNSVRfQk9fV1JJVEUpKSB7CisJ
CQlyZXQgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZChyb2JqLCAxKTsKKwkJCWlmIChyZXQpCisJ
CQkJcmV0dXJuIHJldDsKKwkJfQorCisJCWlmIChiby0+ZmxhZ3MgJiBQQU5GUk9TVF9TVUJNSVRf
Qk9fTk9fSU1QTElDSVRfRkVOQ0UpCisJCQljb250aW51ZTsKKworCQlpZiAoYm8tPmZsYWdzICYg
UEFORlJPU1RfU1VCTUlUX0JPX1dSSVRFKSB7CisJCQlyZXQgPSBkbWFfcmVzdl9nZXRfZmVuY2Vz
X3JjdShyb2JqLCAmYm8tPmV4Y2wsCisJCQkJCQkgICAgICAmYm8tPnNoYXJlZF9jb3VudCwKKwkJ
CQkJCSAgICAgICZiby0+c2hhcmVkKTsKKwkJCWlmIChyZXQpCisJCQkJcmV0dXJuIHJldDsKKwkJ
fSBlbHNlIHsKKwkJCWJvLT5leGNsID0gZG1hX3Jlc3ZfZ2V0X2V4Y2xfcmN1KHJvYmopOworCQl9
CisJfQorCisJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIHBhbmZyb3N0X2F0dGFjaF9vYmpl
Y3RfZmVuY2VzKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmJvcywKLQkJCQkJICBpbnQgYm9fY291
bnQsCi0JCQkJCSAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCitzdGF0aWMgdm9pZCBwYW5mcm9z
dF9hdHRhY2hfb2JqZWN0X2ZlbmNlcyhzdHJ1Y3QgcGFuZnJvc3Rfam9iICpqb2IpCiB7CiAJaW50
IGk7CiAKLQlmb3IgKGkgPSAwOyBpIDwgYm9fY291bnQ7IGkrKykKLQkJZG1hX3Jlc3ZfYWRkX2V4
Y2xfZmVuY2UoYm9zW2ldLT5yZXN2LCBmZW5jZSk7CisJZm9yIChpID0gMDsgaSA8IGpvYi0+Ym9f
Y291bnQ7IGkrKykgeworCQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiA9IGpvYi0+Ym9zW2ld
Lm9iajsKKworCQlpZiAoam9iLT5ib3NbaV0uZmxhZ3MgJiBQQU5GUk9TVF9TVUJNSVRfQk9fV1JJ
VEUpCisJCQlkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZShvYmotPnJlc3YsCisJCQkJCQlqb2ItPnJl
bmRlcl9kb25lX2ZlbmNlKTsKKwkJZWxzZQorCQkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShv
YmotPnJlc3YsCisJCQkJCQkgIGpvYi0+cmVuZGVyX2RvbmVfZmVuY2UpOworCX0KK30KKworc3Rh
dGljIGludCBwYW5mcm9zdF9qb2JfbG9ja19ib3Moc3RydWN0IHBhbmZyb3N0X2pvYiAqam9iLAor
CQkJCSBzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKmFjcXVpcmVfY3R4KQoreworCWludCBjb250ZW5k
ZWQgPSAtMTsKKwlpbnQgaSwgcmV0OworCisJd3dfYWNxdWlyZV9pbml0KGFjcXVpcmVfY3R4LCAm
cmVzZXJ2YXRpb25fd3dfY2xhc3MpOworCityZXRyeToKKwlpZiAoY29udGVuZGVkICE9IC0xKSB7
CisJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqID0gam9iLT5ib3NbY29udGVuZGVkXS5vYmo7
CisKKwkJcmV0ID0gd3dfbXV0ZXhfbG9ja19zbG93X2ludGVycnVwdGlibGUoJm9iai0+cmVzdi0+
bG9jaywKKwkJCQkJCSAgICAgICBhY3F1aXJlX2N0eCk7CisJCWlmIChyZXQpIHsKKwkJCXd3X2Fj
cXVpcmVfZG9uZShhY3F1aXJlX2N0eCk7CisJCQlyZXR1cm4gcmV0OworCQl9CisJfQorCisJZm9y
IChpID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7IGkrKykgeworCQlpZiAoaSA9PSBjb250ZW5kZWQp
CisJCQljb250aW51ZTsKKworCQlyZXQgPSB3d19tdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmpv
Yi0+Ym9zW2ldLm9iai0+cmVzdi0+bG9jaywKKwkJCQkJCSAgYWNxdWlyZV9jdHgpOworCQlpZiAo
cmV0KSB7CisJCQlpbnQgajsKKworCQkJZm9yIChqID0gMDsgaiA8IGk7IGorKykKKwkJCQl3d19t
dXRleF91bmxvY2soJmpvYi0+Ym9zW2pdLm9iai0+cmVzdi0+bG9jayk7CisKKwkJCWlmIChjb250
ZW5kZWQgIT0gLTEgJiYgY29udGVuZGVkID49IGkpIHsKKwkJCQlzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3QgKmNvbnRlbmRlZF9vYmo7CisKKwkJCQljb250ZW5kZWRfb2JqID0gam9iLT5ib3NbY29udGVu
ZGVkXS5vYmo7CisJCQkJd3dfbXV0ZXhfdW5sb2NrKCZjb250ZW5kZWRfb2JqLT5yZXN2LT5sb2Nr
KTsKKwkJCX0KKworCQkJaWYgKHJldCA9PSAtRURFQURMSykgeworCQkJCWNvbnRlbmRlZCA9IGk7
CisJCQkJZ290byByZXRyeTsKKwkJCX0KKworCQkJd3dfYWNxdWlyZV9kb25lKGFjcXVpcmVfY3R4
KTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwl3d19hY3F1aXJlX2RvbmUoYWNxdWlyZV9j
dHgpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHBhbmZyb3N0X2pvYl91bmxvY2tf
Ym9zKHN0cnVjdCBwYW5mcm9zdF9qb2IgKmpvYiwKKwkJCQkgICAgc3RydWN0IHd3X2FjcXVpcmVf
Y3R4ICphY3F1aXJlX2N0eCkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBqb2ItPmJv
X2NvdW50OyBpKyspCisJCXd3X211dGV4X3VubG9jaygmam9iLT5ib3NbaV0ub2JqLT5yZXN2LT5s
b2NrKTsKKworCXd3X2FjcXVpcmVfZmluaShhY3F1aXJlX2N0eCk7CiB9CiAKIGludCBwYW5mcm9z
dF9qb2JfcHVzaChzdHJ1Y3QgcGFuZnJvc3Rfam9iICpqb2IpCkBAIC0yMjMsOCArMzE1LDcgQEAg
aW50IHBhbmZyb3N0X2pvYl9wdXNoKHN0cnVjdCBwYW5mcm9zdF9qb2IgKmpvYikKIAogCW11dGV4
X2xvY2soJnBmZGV2LT5zY2hlZF9sb2NrKTsKIAotCXJldCA9IGRybV9nZW1fbG9ja19yZXNlcnZh
dGlvbnMoam9iLT5ib3MsIGpvYi0+Ym9fY291bnQsCi0JCQkJCSAgICAmYWNxdWlyZV9jdHgpOwor
CXJldCA9IHBhbmZyb3N0X2pvYl9sb2NrX2Jvcyhqb2IsICZhY3F1aXJlX2N0eCk7CiAJaWYgKHJl
dCkgewogCQltdXRleF91bmxvY2soJnBmZGV2LT5zY2hlZF9sb2NrKTsKIAkJcmV0dXJuIHJldDsK
QEAgLTI0MCwxOCArMzMxLDE2IEBAIGludCBwYW5mcm9zdF9qb2JfcHVzaChzdHJ1Y3QgcGFuZnJv
c3Rfam9iICpqb2IpCiAKIAlrcmVmX2dldCgmam9iLT5yZWZjb3VudCk7IC8qIHB1dCBieSBzY2hl
ZHVsZXIgam9iIGNvbXBsZXRpb24gKi8KIAotCXBhbmZyb3N0X2FjcXVpcmVfb2JqZWN0X2ZlbmNl
cyhqb2ItPmJvcywgam9iLT5ib19jb3VudCwKLQkJCQkgICAgICAgam9iLT5pbXBsaWNpdF9mZW5j
ZXMpOworCXBhbmZyb3N0X2FjcXVpcmVfb2JqZWN0X2ZlbmNlcyhqb2IpOwogCiAJZHJtX3NjaGVk
X2VudGl0eV9wdXNoX2pvYigmam9iLT5iYXNlLCBlbnRpdHkpOwogCiAJbXV0ZXhfdW5sb2NrKCZw
ZmRldi0+c2NoZWRfbG9jayk7CiAKLQlwYW5mcm9zdF9hdHRhY2hfb2JqZWN0X2ZlbmNlcyhqb2It
PmJvcywgam9iLT5ib19jb3VudCwKLQkJCQkgICAgICBqb2ItPnJlbmRlcl9kb25lX2ZlbmNlKTsK
KwlwYW5mcm9zdF9hdHRhY2hfb2JqZWN0X2ZlbmNlcyhqb2IpOwogCiB1bmxvY2s6Ci0JZHJtX2dl
bV91bmxvY2tfcmVzZXJ2YXRpb25zKGpvYi0+Ym9zLCBqb2ItPmJvX2NvdW50LCAmYWNxdWlyZV9j
dHgpOworCXBhbmZyb3N0X2pvYl91bmxvY2tfYm9zKGpvYiwgJmFjcXVpcmVfY3R4KTsKIAogCXJl
dHVybiByZXQ7CiB9CkBAIC0yNjcsMjAgKzM1NiwyMiBAQCBzdGF0aWMgdm9pZCBwYW5mcm9zdF9q
b2JfY2xlYW51cChzdHJ1Y3Qga3JlZiAqcmVmKQogCQkJZG1hX2ZlbmNlX3B1dChqb2ItPmluX2Zl
bmNlc1tpXSk7CiAJCWt2ZnJlZShqb2ItPmluX2ZlbmNlcyk7CiAJfQotCWlmIChqb2ItPmltcGxp
Y2l0X2ZlbmNlcykgewotCQlmb3IgKGkgPSAwOyBpIDwgam9iLT5ib19jb3VudDsgaSsrKQotCQkJ
ZG1hX2ZlbmNlX3B1dChqb2ItPmltcGxpY2l0X2ZlbmNlc1tpXSk7Ci0JCWt2ZnJlZShqb2ItPmlt
cGxpY2l0X2ZlbmNlcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgam9iLT5ib19jb3VudDsgaSsrKSB7
CisJCXVuc2lnbmVkIGludCBqOworCisJCWRtYV9mZW5jZV9wdXQoam9iLT5ib3NbaV0uZXhjbCk7
CisJCWZvciAoaiA9IDA7IGogPCBqb2ItPmJvc1tpXS5zaGFyZWRfY291bnQ7IGorKykKKwkJCWRt
YV9mZW5jZV9wdXQoam9iLT5ib3NbaV0uc2hhcmVkW2pdKTsKIAl9CisKIAlkbWFfZmVuY2VfcHV0
KGpvYi0+ZG9uZV9mZW5jZSk7CiAJZG1hX2ZlbmNlX3B1dChqb2ItPnJlbmRlcl9kb25lX2ZlbmNl
KTsKIAotCWlmIChqb2ItPmJvcykgewotCQlmb3IgKGkgPSAwOyBpIDwgam9iLT5ib19jb3VudDsg
aSsrKQotCQkJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKGpvYi0+Ym9zW2ldKTsKLQkJa3Zm
cmVlKGpvYi0+Ym9zKTsKLQl9CisJZm9yIChpID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7IGkrKykK
KwkJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKGpvYi0+Ym9zW2ldLm9iaik7CiAKKwlrdmZy
ZWUoam9iLT5ib3MpOwogCWtmcmVlKGpvYik7CiB9CiAKQEAgLTMxNCwxMSArNDA1LDIyIEBAIHN0
YXRpYyBzdHJ1Y3QgZG1hX2ZlbmNlICpwYW5mcm9zdF9qb2JfZGVwZW5kZW5jeShzdHJ1Y3QgZHJt
X3NjaGVkX2pvYiAqc2NoZWRfam9iCiAJCX0KIAl9CiAKLQkvKiBJbXBsaWNpdCBmZW5jZXMsIG1h
eC4gb25lIHBlciBCTyAqLworCS8qIEltcGxpY2l0IGZlbmNlcyAqLwogCWZvciAoaSA9IDA7IGkg
PCBqb2ItPmJvX2NvdW50OyBpKyspIHsKLQkJaWYgKGpvYi0+aW1wbGljaXRfZmVuY2VzW2ldKSB7
Ci0JCQlmZW5jZSA9IGpvYi0+aW1wbGljaXRfZmVuY2VzW2ldOwotCQkJam9iLT5pbXBsaWNpdF9m
ZW5jZXNbaV0gPSBOVUxMOworCQl1bnNpZ25lZCBpbnQgajsKKworCQlpZiAoam9iLT5ib3NbaV0u
ZXhjbCkgeworCQkJZmVuY2UgPSBqb2ItPmJvc1tpXS5leGNsOworCQkJam9iLT5ib3NbaV0uZXhj
bCA9IE5VTEw7CisJCQlyZXR1cm4gZmVuY2U7CisJCX0KKworCQlmb3IgKGogPSAwOyBqIDwgam9i
LT5ib3NbaV0uc2hhcmVkX2NvdW50OyBqKyspIHsKKwkJCWlmICgham9iLT5ib3NbaV0uc2hhcmVk
W2pdKQorCQkJCWNvbnRpbnVlOworCisJCQlmZW5jZSA9IGpvYi0+Ym9zW2ldLnNoYXJlZFtqXTsK
KwkJCWpvYi0+Ym9zW2ldLnNoYXJlZFtqXSA9IE5VTEw7CiAJCQlyZXR1cm4gZmVuY2U7CiAJCX0K
IAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmgKaW5kZXggNjI0NTQxMjhh
NzkyLi41MzQ0MDY0MGE2ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9w
YW5mcm9zdF9qb2IuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9i
LmgKQEAgLTExLDYgKzExLDE0IEBAIHN0cnVjdCBwYW5mcm9zdF9kZXZpY2U7CiBzdHJ1Y3QgcGFu
ZnJvc3RfZ2VtX29iamVjdDsKIHN0cnVjdCBwYW5mcm9zdF9maWxlX3ByaXY7CiAKK3N0cnVjdCBw
YW5mcm9zdF9qb2JfYm9fZGVzYyB7CisJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7CisJc3Ry
dWN0IGRtYV9mZW5jZSAqZXhjbDsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICoqc2hhcmVkOworCXVuc2ln
bmVkIGludCBzaGFyZWRfY291bnQ7CisJdTMyIGZsYWdzOworfTsKKwogc3RydWN0IHBhbmZyb3N0
X2pvYiB7CiAJc3RydWN0IGRybV9zY2hlZF9qb2IgYmFzZTsKIApAQCAtMzEsOCArMzksNyBAQCBz
dHJ1Y3QgcGFuZnJvc3Rfam9iIHsKIAlfX3UzMiBmbHVzaF9pZDsKIAogCS8qIEV4Y2x1c2l2ZSBm
ZW5jZXMgd2UgaGF2ZSB0YWtlbiBmcm9tIHRoZSBCT3MgdG8gd2FpdCBmb3IgKi8KLQlzdHJ1Y3Qg
ZG1hX2ZlbmNlICoqaW1wbGljaXRfZmVuY2VzOwotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmJv
czsKKwlzdHJ1Y3QgcGFuZnJvc3Rfam9iX2JvX2Rlc2MgKmJvczsKIAl1MzIgYm9fY291bnQ7CiAK
IAkvKiBGZW5jZSB0byBiZSBzaWduYWxlZCBieSBkcm0tc2NoZWQgb25jZSBpdHMgZG9uZSB3aXRo
IHRoZSBqb2IgKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vcGFuZnJvc3RfZHJtLmgg
Yi9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCmluZGV4IGVjMTlkYjFlZWFkOC4uMDI5
YzZhZTFiMWYwIDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCisr
KyBiL2luY2x1ZGUvdWFwaS9kcm0vcGFuZnJvc3RfZHJtLmgKQEAgLTQwLDYgKzQwLDI4IEBAIGV4
dGVybiAiQyIgewogI2RlZmluZSBEUk1fSU9DVExfUEFORlJPU1RfUEVSRkNOVF9EVU1QCQlEUk1f
SU9XKERSTV9DT01NQU5EX0JBU0UgKyBEUk1fUEFORlJPU1RfUEVSRkNOVF9EVU1QLCBzdHJ1Y3Qg
ZHJtX3BhbmZyb3N0X3BlcmZjbnRfZHVtcCkKIAogI2RlZmluZSBQQU5GUk9TVF9KRF9SRVFfRlMg
KDEgPDwgMCkKKworI2RlZmluZSBQQU5GUk9TVF9TVUJNSVRfQk9fUkVBRAkJCSgxIDw8IDApCisj
ZGVmaW5lIFBBTkZST1NUX1NVQk1JVF9CT19XUklURQkJKDEgPDwgMSkKKyNkZWZpbmUgUEFORlJP
U1RfU1VCTUlUX0JPX1JXCQkJKFBBTkZST1NUX1NVQk1JVF9CT19SRUFEIHwgXAorCQkJCQkJIFBB
TkZST1NUX1NVQk1JVF9CT19XUklURSkKKyNkZWZpbmUgUEFORlJPU1RfU1VCTUlUX0JPX05PX0lN
UExJQ0lUX0ZFTkNFCSgxIDw8IDIpCisjZGVmaW5lIFBBTkZST1NUX1NVQk1JVF9CT19WQUxJRF9G
TEFHUwkJXAorCShQQU5GUk9TVF9TVUJNSVRfQk9fUlcgfCBQQU5GUk9TVF9TVUJNSVRfQk9fTk9f
SU1QTElDSVRfRkVOQ0UpCisKKy8qKgorICogc3RydWN0IGRybV9wYW5mcm9zdF9zdWJtaXRfYm8g
LSBCTyBkZXNjcmlwdG9yIHBhc3NlZCB0byB0aGUgc3VibWl0IGlvY3RsLgorICoKKyAqIFVzZWZ1
bCB0byBnaXZlIGRldGFpbGVkIGluZm9ybWF0aW9uIGFib3V0IEJPcyB1c2VkIGJ5IGEgZ2l2ZW4g
am9iLgorICoKKyAqIEBoYW5kbGU6IHRoZSBHRU0gaGFuZGxlCisgKiBAZmxhZ3M6IGEgY29tYmlu
YXRpb24gb2YgUEFORlJPU1RfU1VCTUlUX0JPXyoKKyAqLworc3RydWN0IGRybV9wYW5mcm9zdF9z
dWJtaXRfYm8geworCV9fdTMyIGhhbmRsZTsKKwlfX3UzMiBmbGFnczsKK307CisKIC8qKgogICog
c3RydWN0IGRybV9wYW5mcm9zdF9zdWJtaXQgLSBpb2N0bCBhcmd1bWVudCBmb3Igc3VibWl0dGlu
ZyBjb21tYW5kcyB0byB0aGUgM0QKICAqIGVuZ2luZS4KQEAgLTY4LDYgKzkwLDI1IEBAIHN0cnVj
dCBkcm1fcGFuZnJvc3Rfc3VibWl0IHsKIAogCS8qKiBBIGNvbWJpbmF0aW9uIG9mIFBBTkZST1NU
X0pEX1JFUV8qICovCiAJX191MzIgcmVxdWlyZW1lbnRzOworCisJLyoqCisJICogUG9pbnRlciB0
byBhIHUzMiBhcnJheSBvZiAmZHJtX3BhbmZyb3N0X3N1Ym1pdF9ib19kZXNjIG9iamVjdHMuIFRo
aXMKKwkgKiBmaWVsZCBpcyBtZWFudCB0byByZXBsYWNlICZkcm1fcGFuZnJvc3Rfc3VibWl0LmJv
X2hhbmRsZXMgd2hpY2ggZGlkCisJICogbm90IHByb3ZpZGUgZW5vdWdoIGluZm9ybWF0aW9uIHRv
IHJlbGF4IHN5bmNocm9uaXphdGlvbiBiZXR3ZWVuCisJICogam9icyB0aGF0IG9ubHkgb25seSBy
ZWFkIHRoZSBCTyB0aGV5IHNoYXJlLiBXaGVuIGJvdGgKKwkgKiAmZHJtX3BhbmZyb3N0X3N1Ym1p
dC5ib19oYW5kbGVzIGFuZCAmZHJtX3BhbmZyb3N0X3N1Ym1pdC5ib19kZXNjcworCSAqIGFyZSBw
cm92aWRlZCwgZHJtX3BhbmZyb3N0X3N1Ym1pdC5ib19oYW5kbGVzIGlzIGlnbm9yZWQuCisJICov
CisJX191NjQgYm9fZGVzY3M7CisKKwkvKioKKwkgKiBOdW1iZXIgb2YgQk8gZGVzY3JpcHRvcnMg
cGFzc2VkIGluIChzaXplIGlzIHRoYXQgdGltZXMKKwkgKiBzaXplb2YoZHJtX3BhbmZyb3N0X3N1
Ym1pdF9ib19kZXNjKSkuCisJICovCisJX191MzIgYm9fZGVzY19jb3VudDsKKworCS8qKiBQYWRk
aW5nLCBtdXN0IGJlIDAuICovCisJX191MzIgcGFkOwogfTsKIAogLyoqCi0tIAoyLjIxLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
