Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6CA693B210
	for <lists+dri-devel@lfdr.de>; Mon, 10 Jun 2019 11:28:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DF89F890E9;
	Mon, 10 Jun 2019 09:27:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D7E6D890E9;
 Mon, 10 Jun 2019 09:27:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 10 Jun 2019 02:27:58 -0700
X-ExtLoop1: 1
Received: from jnikula-mobl3.fi.intel.com (HELO localhost) ([10.237.66.150])
 by fmsmga001.fm.intel.com with ESMTP; 10 Jun 2019 02:27:54 -0700
From: Jani Nikula <jani.nikula@intel.com>
To: Jani Nikula <jani.nikula@intel.com>, intel-gfx@lists.freedesktop.org,
 dri-devel@lists.freedesktop.org
Subject: [PATCH v2] drm: add fallback override/firmware EDID modes workaround
Date: Mon, 10 Jun 2019 12:30:54 +0300
Message-Id: <20190610093054.28445-1-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190607110513.12072-2-jani.nikula@intel.com>
References: <20190607110513.12072-2-jani.nikula@intel.com>
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>, stable@vger.kernel.org,
 Paul Wise <pabs3@bonedaddy.net>, Harish Chegondi <harish.chegondi@intel.com>,
 =?UTF-8?q?Ilpo=20J=C3=A4rvinen?= <ilpo.jarvinen@cs.helsinki.fi>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2UndmUgbW92ZWQgdGhlIG92ZXJyaWRlIGFuZCBmaXJtd2FyZSBFRElEIChzaW1wbHkgIm92ZXJy
aWRlIEVESUQiIGZyb20Kbm93IG9uKSBoYW5kbGluZyB0byB0aGUgbG93IGxldmVsIGRybV9kb19n
ZXRfZWRpZCgpIGZ1bmN0aW9uIGluIG9yZGVyIHRvCnRyYW5zcGFyZW50bHkgdXNlIHRoZSBvdmVy
cmlkZSB0aHJvdWdob3V0IHRoZSBzdGFjay4gVGhlIGlkZWEgaXMgdGhhdAp5b3UgZ2V0IHRoZSBv
dmVycmlkZSBFRElEIHZpYSB0aGUgLT5nZXRfbW9kZXMoKSBob29rLgoKVW5mb3J0dW5hdGVseSwg
dGhlcmUgYXJlIHNjZW5hcmlvcyB3aGVyZSB0aGUgRERDIHByb2JlIGluIGRybV9nZXRfZWRpZCgp
CmNhbGxlZCB2aWEgLT5nZXRfbW9kZXMoKSBmYWlscywgYWx0aG91Z2ggdGhlIHByZWNlZGluZyAt
PmRldGVjdCgpCnN1Y2NlZWRzLgoKSW4gdGhlIGNhc2UgcmVwb3J0ZWQgYnkgUGF1bCBXaXNlLCB0
aGUgLT5kZXRlY3QoKSBob29rLAppbnRlbF9jcnRfZGV0ZWN0KCksIHJlbGllcyBvbiBob3RwbHVn
IGRldGVjdCwgYnlwYXNzaW5nIHRoZSBEREMuIEluIHRoZQpjYXNlIHJlcG9ydGVkIGJ5IElscG8g
SsOkcnZpbmVuLCB0aGVyZSBpcyBubyAtPmRldGVjdCgpIGhvb2ssIHdoaWNoIGlzCmludGVycHJl
dGVkIGFzIGNvbm5lY3RlZC4gVGhlIHN1YnNlcXVlbnQgRERDIHByb2JlIHJlYWNoZWQgdmlhCi0+
Z2V0X21vZGVzKCkgZmFpbHMsIGFuZCB3ZSBkb24ndCBldmVuIGxvb2sgYXQgdGhlIG92ZXJyaWRl
IEVESUQsCnJlc3VsdGluZyBpbiBubyBtb2RlcyBiZWluZyBhZGRlZC4KCkJlY2F1c2UgZHJtX2dl
dF9lZGlkKCkgaXMgdXNlZCB2aWEgLT5kZXRlY3QoKSBhbGwgb3ZlciB0aGUgcGxhY2UsIHdlCmNh
bid0IHRyaXZpYWxseSByZW1vdmUgdGhlIEREQyBwcm9iZSwgYXMgaXQgbGVhZHMgdG8gb3ZlcnJp
ZGUgRURJRAplZmZlY3RpdmVseSBtZWFuaW5nIGNvbm5lY3RvciBmb3JjaW5nLiBUaGUgZ29hbCBp
cyB0aGF0IGNvbm5lY3Rvcgpmb3JjaW5nIGFuZCBvdmVycmlkZSBFRElEIHJlbWFpbiBvcnRob2dv
bmFsLgoKR2VuZXJhbGx5LCB0aGUgdW5kZXJseWluZyBwcm9ibGVtIGhlcmUgaXMgdGhlIGNvbmZs
YXRpb24gb2YgLT5kZXRlY3QoKQphbmQgLT5nZXRfbW9kZXMoKSB2aWEgZHJtX2dldF9lZGlkKCku
IFRoZSBmb3JtZXIgc2hvdWxkIGp1c3QgZGV0ZWN0LCBhbmQKdGhlIGxhdHRlciBzaG91bGQganVz
dCBnZXQgdGhlIG1vZGVzLCB0eXBpY2FsbHkgdmlhIHJlYWRpbmcgdGhlIEVESUQuIEFzCmxvbmcg
YXMgZHJtX2dldF9lZGlkKCkgaXMgdXNlZCBpbiAtPmRldGVjdCgpLCBpdCBuZWVkcyB0byByZXRh
aW4gdGhlIEREQwpwcm9iZS4gT3Igc3VjaCB1c2VycyBuZWVkIHRvIGhhdmUgYSBzZXBhcmF0ZSBE
REMgcHJvYmUgc3RlcCBmaXJzdC4KClRoZSBFRElEIGNhY2hpbmcgYmV0d2VlbiAtPmRldGVjdCgp
IGFuZCAtPmdldF9tb2RlcygpIGRvbmUgYnkgc29tZQpkcml2ZXJzIGlzIGEgZnVydGhlciBjb21w
bGljYXRpb24gdGhhdCBwcmV2ZW50cyB1cyBmcm9tIG1ha2luZwpkcm1fZG9fZ2V0X2VkaWQoKSBh
ZGFwdCB0byB0aGUgdHdvIGNhc2VzLgoKV29yayBhcm91bmQgdGhlIHJlZ3Jlc3Npb24gYnkgZmFs
bGluZyBiYWNrIHRvIGEgc2VwYXJhdGUgYXR0ZW1wdCBhdApnZXR0aW5nIHRoZSBvdmVycmlkZSBF
RElEIGF0IGRybV9oZWxwZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcygpCmxldmVsLiBX
aXRoIGEgd29ya2luZyBEREMgYW5kIG92ZXJyaWRlIEVESUQsIGl0J2xsIG5ldmVyIGJlIGNhbGxl
ZDsgdGhlCm92ZXJyaWRlIEVESUQgd2lsbCBjb21lIHZpYSAtPmdldF9tb2RlcygpLiBUaGVyZSB3
aWxsIHN0aWxsIGJlIGEgZmFpbGluZwpEREMgcHJvYmUgYXR0ZW1wdCBpbiB0aGUgY2FzZXMgdGhh
dCByZXF1aXJlIHRoZSBmYWxsYmFjay4KCnYyOgotIENhbGwgZHJtX2Nvbm5lY3Rvcl91cGRhdGVf
ZWRpZF9wcm9wZXJ0eSAoUGF1bCkKLSBVcGRhdGUgY29tbWl0IG1lc3NhZ2UgYWJvdXQgRURJRCBj
YWNoaW5nIChEYW5pZWwpCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9z
aG93X2J1Zy5jZ2k/aWQ9MTA3NTgzClJlcG9ydGVkLWJ5OiBQYXVsIFdpc2UgPHBhYnMzQGJvbmVk
YWRkeS5uZXQ+CkNjOiBQYXVsIFdpc2UgPHBhYnMzQGJvbmVkYWRkeS5uZXQ+ClJlZmVyZW5jZXM6
IGh0dHA6Ly9taWQubWFpbC1hcmNoaXZlLmNvbS9hbHBpbmUuREVCLjIuMjAuMTkwNTI2MjIxMTI3
MC4yNDM5MEB3aHMtMTguY3MuaGVsc2lua2kuZmkKUmVwb3J0ZWQtYnk6IElscG8gSsOkcnZpbmVu
IDxpbHBvLmphcnZpbmVuQGNzLmhlbHNpbmtpLmZpPgpDYzogSWxwbyBKw6RydmluZW4gPGlscG8u
amFydmluZW5AY3MuaGVsc2lua2kuZmk+ClN1Z2dlc3RlZC1ieTogRGFuaWVsIFZldHRlciA8ZGFu
aWVsLnZldHRlckBmZndsbC5jaD4KUmVmZXJlbmNlczogMTVmMDgwZjA4ZDQ4ICgiZHJtL2VkaWQ6
IHJlc3BlY3QgY29ubmVjdG9yIGZvcmNlIGZvciBkcm1fZ2V0X2VkaWQgZGRjIHByb2JlIikKRml4
ZXM6IDUzZmQ0MGE5MGYzYyAoImRybTogaGFuZGxlIG92ZXJyaWRlIGFuZCBmaXJtd2FyZSBFRElE
IGF0IGRybV9kb19nZXRfZWRpZCgpIGxldmVsIikKQ2M6IDxzdGFibGVAdmdlci5rZXJuZWwub3Jn
PiAjIHY0LjE1KwpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KQ2M6
IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBIYXJp
c2ggQ2hlZ29uZGkgPGhhcmlzaC5jaGVnb25kaUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEph
bmkgTmlrdWxhIDxqYW5pLm5pa3VsYUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2Ry
bV9lZGlkLmMgICAgICAgICB8IDMwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJp
dmVycy9ncHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYyB8ICA3ICsrKysrKysKIGluY2x1ZGUvZHJt
L2RybV9lZGlkLmggICAgICAgICAgICAgfCAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDM4IGluc2Vy
dGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYyBiL2RyaXZl
cnMvZ3B1L2RybS9kcm1fZWRpZC5jCmluZGV4IGM1OWExZThjNWFkYS4uOWQ4ZjJiOTUyMDA0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2VkaWQuYwpAQCAtMTU4Nyw2ICsxNTg3LDM2IEBAIHN0YXRpYyBzdHJ1Y3QgZWRpZCAq
ZHJtX2dldF9vdmVycmlkZV9lZGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJ
cmV0dXJuIElTX0VSUihvdmVycmlkZSkgPyBOVUxMIDogb3ZlcnJpZGU7CiB9CiAKKy8qKgorICog
ZHJtX2FkZF9vdmVycmlkZV9lZGlkX21vZGVzIC0gYWRkIG1vZGVzIGZyb20gb3ZlcnJpZGUvZmly
bXdhcmUgRURJRAorICogQGNvbm5lY3RvcjogY29ubmVjdG9yIHdlJ3JlIHByb2JpbmcKKyAqCisg
KiBBZGQgbW9kZXMgZnJvbSB0aGUgb3ZlcnJpZGUvZmlybXdhcmUgRURJRCwgaWYgYXZhaWxhYmxl
LiBPbmx5IHRvIGJlIHVzZWQgZnJvbQorICogZHJtX2hlbHBlcl9wcm9iZV9zaW5nbGVfY29ubmVj
dG9yX21vZGVzKCkgYXMgYSBmYWxsYmFjayBmb3Igd2hlbiBEREMgcHJvYmUKKyAqIGZhaWxlZCBk
dXJpbmcgZHJtX2dldF9lZGlkKCkgYW5kIGNhdXNlZCB0aGUgb3ZlcnJpZGUvZmlybXdhcmUgRURJ
RCB0byBiZQorICogc2tpcHBlZC4KKyAqCisgKiBSZXR1cm46IFRoZSBudW1iZXIgb2YgbW9kZXMg
YWRkZWQgb3IgMCBpZiB3ZSBjb3VsZG4ndCBmaW5kIGFueS4KKyAqLworaW50IGRybV9hZGRfb3Zl
cnJpZGVfZWRpZF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0
cnVjdCBlZGlkICpvdmVycmlkZTsKKwlpbnQgbnVtX21vZGVzID0gMDsKKworCW92ZXJyaWRlID0g
ZHJtX2dldF9vdmVycmlkZV9lZGlkKGNvbm5lY3Rvcik7CisJaWYgKG92ZXJyaWRlKSB7CisJCWRy
bV9jb25uZWN0b3JfdXBkYXRlX2VkaWRfcHJvcGVydHkoY29ubmVjdG9yLCBvdmVycmlkZSk7CisJ
CW51bV9tb2RlcyA9IGRybV9hZGRfZWRpZF9tb2Rlcyhjb25uZWN0b3IsIG92ZXJyaWRlKTsKKwkJ
a2ZyZWUob3ZlcnJpZGUpOworCisJCURSTV9ERUJVR19LTVMoIltDT05ORUNUT1I6JWQ6JXNdIGFk
ZGluZyAlZCBtb2RlcyB2aWEgZmFsbGJhY2sgb3ZlcnJpZGUvZmlybXdhcmUgRURJRFxuIiwKKwkJ
CSAgICAgIGNvbm5lY3Rvci0+YmFzZS5pZCwgY29ubmVjdG9yLT5uYW1lLCBudW1fbW9kZXMpOwor
CX0KKworCXJldHVybiBudW1fbW9kZXM7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hZGRfb3ZlcnJp
ZGVfZWRpZF9tb2Rlcyk7CisKIC8qKgogICogZHJtX2RvX2dldF9lZGlkIC0gZ2V0IEVESUQgZGF0
YSB1c2luZyBhIGN1c3RvbSBFRElEIGJsb2NrIHJlYWQgZnVuY3Rpb24KICAqIEBjb25uZWN0b3I6
IGNvbm5lY3RvciB3ZSdyZSBwcm9iaW5nCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJt
X3Byb2JlX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYwppbmRl
eCAwMWUyNDNmMWVhOTQuLmVmMmM0NjgyMDVhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2RybV9wcm9iZV9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBl
ci5jCkBAIC00ODAsNiArNDgwLDEzIEBAIGludCBkcm1faGVscGVyX3Byb2JlX3NpbmdsZV9jb25u
ZWN0b3JfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAogCWNvdW50ID0g
KCpjb25uZWN0b3JfZnVuY3MtPmdldF9tb2RlcykoY29ubmVjdG9yKTsKIAorCS8qCisJICogRmFs
bGJhY2sgZm9yIHdoZW4gRERDIHByb2JlIGZhaWxlZCBpbiBkcm1fZ2V0X2VkaWQoKSBhbmQgdGh1
cyBza2lwcGVkCisJICogb3ZlcnJpZGUvZmlybXdhcmUgRURJRC4KKwkgKi8KKwlpZiAoY291bnQg
PT0gMCAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCkK
KwkJY291bnQgPSBkcm1fYWRkX292ZXJyaWRlX2VkaWRfbW9kZXMoY29ubmVjdG9yKTsKKwogCWlm
IChjb3VudCA9PSAwICYmIGNvbm5lY3Rvci0+c3RhdHVzID09IGNvbm5lY3Rvcl9zdGF0dXNfY29u
bmVjdGVkKQogCQljb3VudCA9IGRybV9hZGRfbW9kZXNfbm9lZGlkKGNvbm5lY3RvciwgMTAyNCwg
NzY4KTsKIAljb3VudCArPSBkcm1faGVscGVyX3Byb2JlX2FkZF9jbWRsaW5lX21vZGUoY29ubmVj
dG9yKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9lZGlkLmggYi9pbmNsdWRlL2RybS9k
cm1fZWRpZC5oCmluZGV4IDg4YjYzODAxZjlkYi4uYjk3MTk0MThjM2QyIDEwMDY0NAotLS0gYS9p
bmNsdWRlL2RybS9kcm1fZWRpZC5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9lZGlkLmgKQEAgLTQ3
OCw2ICs0NzgsNyBAQCBzdHJ1Y3QgZWRpZCAqZHJtX2dldF9lZGlkX3N3aXRjaGVyb28oc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCQkgICAgIHN0cnVjdCBpMmNfYWRhcHRlciAq
YWRhcHRlcik7CiBzdHJ1Y3QgZWRpZCAqZHJtX2VkaWRfZHVwbGljYXRlKGNvbnN0IHN0cnVjdCBl
ZGlkICplZGlkKTsKIGludCBkcm1fYWRkX2VkaWRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQpOworaW50IGRybV9hZGRfb3ZlcnJpZGVfZWRp
ZF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKIAogdTggZHJtX21hdGNo
X2NlYV9tb2RlKGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICp0b19tYXRjaCk7CiBlbnVt
IGhkbWlfcGljdHVyZV9hc3BlY3QgZHJtX2dldF9jZWFfYXNwZWN0X3JhdGlvKGNvbnN0IHU4IHZp
ZGVvX2NvZGUpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWw=
