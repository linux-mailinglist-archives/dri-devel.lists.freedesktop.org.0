Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8403B2A023F
	for <lists+dri-devel@lfdr.de>; Fri, 30 Oct 2020 11:09:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6FA876ED9A;
	Fri, 30 Oct 2020 10:09:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x344.google.com (mail-wm1-x344.google.com
 [IPv6:2a00:1450:4864:20::344])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F10D6ED92
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Oct 2020 10:09:01 +0000 (UTC)
Received: by mail-wm1-x344.google.com with SMTP id 13so2325494wmf.0
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Oct 2020 03:09:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=bLRenZ+k6OnrWeyL17PS5vv24685dEitAu61SyAKZwA=;
 b=GXHxO1RP7TK95Adu5+iOnFzwfvM1BylUWHit0kEyTRTLVttqP1P3S95IoPuxbcmlFB
 5Ozb+6/u63pPnXm1hxcZRtaICRTk3yz0dsT7WEHo9xO0nj24N6aRdnRJ88svYaFT4zH1
 M/1kNldB+IOH+DlAmBexn1ek5RHkrsQQkz1dU=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=bLRenZ+k6OnrWeyL17PS5vv24685dEitAu61SyAKZwA=;
 b=Ux+IvJLL9gG7rkdcnuVofp4rGacWLAPqp8JrRerT2GkIKgadB68vS+R3ZdwYRJnjEH
 hFLKlar/VUIceiSsMlVVi2KIm6qpGhR/WKOyzgusGYfewVFL1XqtG5cwRZt8YhjTCXcJ
 /2ZQxJElkpmtpPMVUTYFMkC1GQ7CQoKuTLY0FlT9C4qW0F+nBIx6tjjv1sa/gMghYk1N
 SEHK48DE1+iERP2y1RdzGTKUyUpH14YuV2wZkkGHYzTi2nuMwlIBZWQC20VAUxy8AVq6
 sr/aLj3YN5QhcWsFDH0/d2kcvVN6UQOSLkd06UERS8FAQyoEK3V2AonMV551erX8RBY9
 SZSA==
X-Gm-Message-State: AOAM5330PULCDHjWZARdtM76XKuY+Ba4z3Nqn6vArf93zW0M0WGaSymc
 XW+NCYIFaRHYXQLG2wYz074ApafjgLkfgVl6
X-Google-Smtp-Source: ABdhPJz/i1hJloa86kniLQRB2Ym3mXkp18H0V5ZxOvETtprEDfWEpkrDMUxmmStycaPdhj+fBSAIzQ==
X-Received: by 2002:a7b:c4c3:: with SMTP id g3mr1715102wmk.65.1604052536620;
 Fri, 30 Oct 2020 03:08:56 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id v189sm4430947wmg.14.2020.10.30.03.08.55
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 30 Oct 2020 03:08:55 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH v5 13/15] resource: Move devmem revoke code to resource
 framework
Date: Fri, 30 Oct 2020 11:08:13 +0100
Message-Id: <20201030100815.2269-14-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20201030100815.2269-1-daniel.vetter@ffwll.ch>
References: <20201030100815.2269-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-samsung-soc@vger.kernel.org, Jan Kara <jack@suse.cz>,
 Kees Cook <keescook@chromium.org>, kvm@vger.kernel.org,
 Jason Gunthorpe <jgg@ziepe.ca>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 David Hildenbrand <david@redhat.com>,
 "Rafael J. Wysocki" <rafael.j.wysocki@intel.com>, linux-mm@kvack.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Arnd Bergmann <arnd@arndb.de>, John Hubbard <jhubbard@nvidia.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Daniel Vetter <daniel.vetter@intel.com>,
 Dan Williams <dan.j.williams@intel.com>,
 Andrew Morton <akpm@linux-foundation.org>,
 linux-arm-kernel@lists.infradead.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2Ugd2FudCBhbGwgaW9tZW0gbW1hcHMgdG8gY29uc2lzdGVudGx5IHJldm9rZSBwdGVzIHdoZW4g
dGhlIGtlcm5lbAp0YWtlcyBvdmVyIGFuZCBDT05GSUdfSU9fU1RSSUNUX0RFVk1FTSBpcyBlbmFi
bGVkLiBUaGlzIGluY2x1ZGVzIHRoZQpwY2kgYmFyIG1tYXBzIGF2YWlsYWJsZSB0aHJvdWdoIHBy
b2NmcyBhbmQgc3lzZnMsIHdoaWNoIGN1cnJlbnRseSBkbwpub3QgcmV2b2tlIG1hcHBpbmdzLgoK
VG8gcHJlcGFyZSBmb3IgdGhpcywgbW92ZSB0aGUgY29kZSBmcm9tIHRoZSAvZGV2L2ttZW0gZHJp
dmVyIHRvCmtlcm5lbC9yZXNvdXJjZS5jLgoKUmV2aWV3ZWQtYnk6IEdyZWcgS3JvYWgtSGFydG1h
biA8Z3JlZ2toQGxpbnV4Zm91bmRhdGlvbi5vcmc+ClNpZ25lZC1vZmYtYnk6IERhbmllbCBWZXR0
ZXIgPGRhbmllbC52ZXR0ZXJAaW50ZWwuY29tPgpDYzogSmFzb24gR3VudGhvcnBlIDxqZ2dAemll
cGUuY2E+CkNjOiBLZWVzIENvb2sgPGtlZXNjb29rQGNocm9taXVtLm9yZz4KQ2M6IERhbiBXaWxs
aWFtcyA8ZGFuLmoud2lsbGlhbXNAaW50ZWwuY29tPgpDYzogQW5kcmV3IE1vcnRvbiA8YWtwbUBs
aW51eC1mb3VuZGF0aW9uLm9yZz4KQ2M6IEpvaG4gSHViYmFyZCA8amh1YmJhcmRAbnZpZGlhLmNv
bT4KQ2M6IErDqXLDtG1lIEdsaXNzZSA8amdsaXNzZUByZWRoYXQuY29tPgpDYzogSmFuIEthcmEg
PGphY2tAc3VzZS5jej4KQ2M6IERhbiBXaWxsaWFtcyA8ZGFuLmoud2lsbGlhbXNAaW50ZWwuY29t
PgpDYzogbGludXgtbW1Aa3ZhY2sub3JnCkNjOiBsaW51eC1hcm0ta2VybmVsQGxpc3RzLmluZnJh
ZGVhZC5vcmcKQ2M6IGxpbnV4LXNhbXN1bmctc29jQHZnZXIua2VybmVsLm9yZwpDYzogbGludXgt
bWVkaWFAdmdlci5rZXJuZWwub3JnCkNjOiBBcm5kIEJlcmdtYW5uIDxhcm5kQGFybmRiLmRlPgpD
YzogR3JlZyBLcm9haC1IYXJ0bWFuIDxncmVna2hAbGludXhmb3VuZGF0aW9uLm9yZz4KQ2M6IERh
bmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkNjOiBEYXZpZCBIaWxkZW5icmFu
ZCA8ZGF2aWRAcmVkaGF0LmNvbT4KQ2M6ICJSYWZhZWwgSi4gV3lzb2NraSIgPHJhZmFlbC5qLnd5
c29ja2lAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0
dGVyQGZmd2xsLmNoPgotLQp2MzoKLSBhZGQgYmFycmllciBmb3IgY29uc2lzdGVuY3kgYW5kIGRv
Y3VtZW50IHdoeSB3ZSBkb24ndCBoYXZlIHRvIGNoZWNrCiAgZm9yIE5VTEwgKEphc29uKQp2NAot
IEFkanVzdCBjb21tZW50cyB0byByZWZsZWN0IHRoZSBnZW5lcmFsIG5hdHVyZSBvZiB0aGlzIGlv
bWVtIHJldm9rZQogIGNvZGUgbm93IChEYW4pCi0tLQogZHJpdmVycy9jaGFyL21lbS5jICAgICB8
ICA4NSArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2xpbnV4L2lv
cG9ydC5oIHwgICA2ICstLQoga2VybmVsL3Jlc291cmNlLmMgICAgICB8IDEwMSArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQogMyBmaWxlcyBjaGFuZ2VkLCAxMDIgaW5z
ZXJ0aW9ucygrKSwgOTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL21l
bS5jIGIvZHJpdmVycy9jaGFyL21lbS5jCmluZGV4IDdkY2Y5ZTRlYTc5ZC4uNDNjODcxZGM3NDc3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NoYXIvbWVtLmMKKysrIGIvZHJpdmVycy9jaGFyL21lbS5j
CkBAIC0zMSw5ICszMSw2IEBACiAjaW5jbHVkZSA8bGludXgvdWlvLmg+CiAjaW5jbHVkZSA8bGlu
dXgvdWFjY2Vzcy5oPgogI2luY2x1ZGUgPGxpbnV4L3NlY3VyaXR5Lmg+Ci0jaW5jbHVkZSA8bGlu
dXgvcHNldWRvX2ZzLmg+Ci0jaW5jbHVkZSA8dWFwaS9saW51eC9tYWdpYy5oPgotI2luY2x1ZGUg
PGxpbnV4L21vdW50Lmg+CiAKICNpZmRlZiBDT05GSUdfSUE2NAogIyBpbmNsdWRlIDxsaW51eC9l
ZmkuaD4KQEAgLTgzNiw0MiArODMzLDYgQEAgc3RhdGljIGxvZmZfdCBtZW1vcnlfbHNlZWsoc3Ry
dWN0IGZpbGUgKmZpbGUsIGxvZmZfdCBvZmZzZXQsIGludCBvcmlnKQogCXJldHVybiByZXQ7CiB9
CiAKLXN0YXRpYyBzdHJ1Y3QgaW5vZGUgKmRldm1lbV9pbm9kZTsKLQotI2lmZGVmIENPTkZJR19J
T19TVFJJQ1RfREVWTUVNCi12b2lkIHJldm9rZV9kZXZtZW0oc3RydWN0IHJlc291cmNlICpyZXMp
Ci17Ci0JLyogcGFpcnMgd2l0aCBzbXBfc3RvcmVfcmVsZWFzZSgpIGluIGRldm1lbV9pbml0X2lu
b2RlKCkgKi8KLQlzdHJ1Y3QgaW5vZGUgKmlub2RlID0gc21wX2xvYWRfYWNxdWlyZSgmZGV2bWVt
X2lub2RlKTsKLQotCS8qCi0JICogQ2hlY2sgdGhhdCB0aGUgaW5pdGlhbGl6YXRpb24gaGFzIGNv
bXBsZXRlZC4gTG9zaW5nIHRoZSByYWNlCi0JICogaXMgb2sgYmVjYXVzZSBpdCBtZWFucyBkcml2
ZXJzIGFyZSBjbGFpbWluZyByZXNvdXJjZXMgYmVmb3JlCi0JICogdGhlIGZzX2luaXRjYWxsIGxl
dmVsIG9mIGluaXQgYW5kIHByZXZlbnQgL2Rldi9tZW0gZnJvbQotCSAqIGVzdGFibGlzaGluZyBt
YXBwaW5ncy4KLQkgKi8KLQlpZiAoIWlub2RlKQotCQlyZXR1cm47Ci0KLQkvKgotCSAqIFRoZSBl
eHBlY3RhdGlvbiBpcyB0aGF0IHRoZSBkcml2ZXIgaGFzIHN1Y2Nlc3NmdWxseSBtYXJrZWQKLQkg
KiB0aGUgcmVzb3VyY2UgYnVzeSBieSB0aGlzIHBvaW50LCBzbyBkZXZtZW1faXNfYWxsb3dlZCgp
Ci0JICogc2hvdWxkIHN0YXJ0IHJldHVybmluZyBmYWxzZSwgaG93ZXZlciBmb3IgcGVyZm9ybWFu
Y2UgdGhpcwotCSAqIGRvZXMgbm90IGl0ZXJhdGUgdGhlIGVudGlyZSByZXNvdXJjZSByYW5nZS4K
LQkgKi8KLQlpZiAoZGV2bWVtX2lzX2FsbG93ZWQoUEhZU19QRk4ocmVzLT5zdGFydCkpICYmCi0J
ICAgIGRldm1lbV9pc19hbGxvd2VkKFBIWVNfUEZOKHJlcy0+ZW5kKSkpIHsKLQkJLyoKLQkJICog
KmNyaW5nZSogaW9tZW09cmVsYXhlZCBzYXlzICJnbyBhaGVhZCwgd2hhdCdzIHRoZQotCQkgKiB3
b3JzdCB0aGF0IGNhbiBoYXBwZW4/IgotCQkgKi8KLQkJcmV0dXJuOwotCX0KLQotCXVubWFwX21h
cHBpbmdfcmFuZ2UoaW5vZGUtPmlfbWFwcGluZywgcmVzLT5zdGFydCwgcmVzb3VyY2Vfc2l6ZShy
ZXMpLCAxKTsKLX0KLSNlbmRpZgotCiBzdGF0aWMgaW50IG9wZW5fcG9ydChzdHJ1Y3QgaW5vZGUg
Kmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlscCkKIHsKIAlpbnQgcmM7CkBAIC04OTEsNyArODUyLDcg
QEAgc3RhdGljIGludCBvcGVuX3BvcnQoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUg
KmZpbHApCiAJICogcmV2b2NhdGlvbnMgd2hlbiBkcml2ZXJzIHdhbnQgdG8gdGFrZSBvdmVyIGEg
L2Rldi9tZW0gbWFwcGVkCiAJICogcmFuZ2UuCiAJICovCi0JZmlscC0+Zl9tYXBwaW5nID0gaW5v
ZGUtPmlfbWFwcGluZzsKKwlmaWxwLT5mX21hcHBpbmcgPSBpb21lbV9nZXRfbWFwcGluZygpOwog
CiAJcmV0dXJuIDA7CiB9CkBAIC0xMDIzLDQ4ICs5ODQsNiBAQCBzdGF0aWMgY2hhciAqbWVtX2Rl
dm5vZGUoc3RydWN0IGRldmljZSAqZGV2LCB1bW9kZV90ICptb2RlKQogCiBzdGF0aWMgc3RydWN0
IGNsYXNzICptZW1fY2xhc3M7CiAKLXN0YXRpYyBpbnQgZGV2bWVtX2ZzX2luaXRfZnNfY29udGV4
dChzdHJ1Y3QgZnNfY29udGV4dCAqZmMpCi17Ci0JcmV0dXJuIGluaXRfcHNldWRvKGZjLCBERVZN
RU1fTUFHSUMpID8gMCA6IC1FTk9NRU07Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgZmlsZV9zeXN0ZW1f
dHlwZSBkZXZtZW1fZnNfdHlwZSA9IHsKLQkubmFtZQkJPSAiZGV2bWVtIiwKLQkub3duZXIJCT0g
VEhJU19NT0RVTEUsCi0JLmluaXRfZnNfY29udGV4dCA9IGRldm1lbV9mc19pbml0X2ZzX2NvbnRl
eHQsCi0JLmtpbGxfc2IJPSBraWxsX2Fub25fc3VwZXIsCi19OwotCi1zdGF0aWMgaW50IGRldm1l
bV9pbml0X2lub2RlKHZvaWQpCi17Ci0Jc3RhdGljIHN0cnVjdCB2ZnNtb3VudCAqZGV2bWVtX3Zm
c19tb3VudDsKLQlzdGF0aWMgaW50IGRldm1lbV9mc19jbnQ7Ci0Jc3RydWN0IGlub2RlICppbm9k
ZTsKLQlpbnQgcmM7Ci0KLQlyYyA9IHNpbXBsZV9waW5fZnMoJmRldm1lbV9mc190eXBlLCAmZGV2
bWVtX3Zmc19tb3VudCwgJmRldm1lbV9mc19jbnQpOwotCWlmIChyYyA8IDApIHsKLQkJcHJfZXJy
KCJDYW5ub3QgbW91bnQgL2Rldi9tZW0gcHNldWRvIGZpbGVzeXN0ZW06ICVkXG4iLCByYyk7Ci0J
CXJldHVybiByYzsKLQl9Ci0KLQlpbm9kZSA9IGFsbG9jX2Fub25faW5vZGUoZGV2bWVtX3Zmc19t
b3VudC0+bW50X3NiKTsKLQlpZiAoSVNfRVJSKGlub2RlKSkgewotCQlyYyA9IFBUUl9FUlIoaW5v
ZGUpOwotCQlwcl9lcnIoIkNhbm5vdCBhbGxvY2F0ZSBpbm9kZSBmb3IgL2Rldi9tZW06ICVkXG4i
LCByYyk7Ci0JCXNpbXBsZV9yZWxlYXNlX2ZzKCZkZXZtZW1fdmZzX21vdW50LCAmZGV2bWVtX2Zz
X2NudCk7Ci0JCXJldHVybiByYzsKLQl9Ci0KLQkvKgotCSAqIFB1Ymxpc2ggL2Rldi9tZW0gaW5p
dGlhbGl6ZWQuCi0JICogUGFpcnMgd2l0aCBzbXBfbG9hZF9hY3F1aXJlKCkgaW4gcmV2b2tlX2Rl
dm1lbSgpLgotCSAqLwotCXNtcF9zdG9yZV9yZWxlYXNlKCZkZXZtZW1faW5vZGUsIGlub2RlKTsK
LQotCXJldHVybiAwOwotfQotCiBzdGF0aWMgaW50IF9faW5pdCBjaHJfZGV2X2luaXQodm9pZCkK
IHsKIAlpbnQgbWlub3I7CkBAIC0xMDg2LDggKzEwMDUsNiBAQCBzdGF0aWMgaW50IF9faW5pdCBj
aHJfZGV2X2luaXQodm9pZCkKIAkJICovCiAJCWlmICgobWlub3IgPT0gREVWUE9SVF9NSU5PUikg
JiYgIWFyY2hfaGFzX2Rldl9wb3J0KCkpCiAJCQljb250aW51ZTsKLQkJaWYgKChtaW5vciA9PSBE
RVZNRU1fTUlOT1IpICYmIGRldm1lbV9pbml0X2lub2RlKCkgIT0gMCkKLQkJCWNvbnRpbnVlOwog
CiAJCWRldmljZV9jcmVhdGUobWVtX2NsYXNzLCBOVUxMLCBNS0RFVihNRU1fTUFKT1IsIG1pbm9y
KSwKIAkJCSAgICAgIE5VTEwsIGRldmxpc3RbbWlub3JdLm5hbWUpOwpkaWZmIC0tZ2l0IGEvaW5j
bHVkZS9saW51eC9pb3BvcnQuaCBiL2luY2x1ZGUvbGludXgvaW9wb3J0LmgKaW5kZXggNTEzNWQ0
Yjg2Y2Q2Li4wMmE1NDY2MjQ1YzAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvaW9wb3J0LmgK
KysrIGIvaW5jbHVkZS9saW51eC9pb3BvcnQuaApAQCAtMzA3LDExICszMDcsNyBAQCBzdHJ1Y3Qg
cmVzb3VyY2UgKmRldm1fcmVxdWVzdF9mcmVlX21lbV9yZWdpb24oc3RydWN0IGRldmljZSAqZGV2
LAogc3RydWN0IHJlc291cmNlICpyZXF1ZXN0X2ZyZWVfbWVtX3JlZ2lvbihzdHJ1Y3QgcmVzb3Vy
Y2UgKmJhc2UsCiAJCXVuc2lnbmVkIGxvbmcgc2l6ZSwgY29uc3QgY2hhciAqbmFtZSk7CiAKLSNp
ZmRlZiBDT05GSUdfSU9fU1RSSUNUX0RFVk1FTQotdm9pZCByZXZva2VfZGV2bWVtKHN0cnVjdCBy
ZXNvdXJjZSAqcmVzKTsKLSNlbHNlCi1zdGF0aWMgaW5saW5lIHZvaWQgcmV2b2tlX2Rldm1lbShz
dHJ1Y3QgcmVzb3VyY2UgKnJlcykgeyB9OwotI2VuZGlmCitleHRlcm4gc3RydWN0IGFkZHJlc3Nf
c3BhY2UgKmlvbWVtX2dldF9tYXBwaW5nKHZvaWQpOwogCiAjZW5kaWYgLyogX19BU1NFTUJMWV9f
ICovCiAjZW5kaWYJLyogX0xJTlVYX0lPUE9SVF9IICovCmRpZmYgLS1naXQgYS9rZXJuZWwvcmVz
b3VyY2UuYyBiL2tlcm5lbC9yZXNvdXJjZS5jCmluZGV4IDNhZTJmNTZjYzc5ZC4uNWVjYzMxODdm
ZTJkIDEwMDY0NAotLS0gYS9rZXJuZWwvcmVzb3VyY2UuYworKysgYi9rZXJuZWwvcmVzb3VyY2Uu
YwpAQCAtMTgsMTIgKzE4LDE1IEBACiAjaW5jbHVkZSA8bGludXgvc3BpbmxvY2suaD4KICNpbmNs
dWRlIDxsaW51eC9mcy5oPgogI2luY2x1ZGUgPGxpbnV4L3Byb2NfZnMuaD4KKyNpbmNsdWRlIDxs
aW51eC9wc2V1ZG9fZnMuaD4KICNpbmNsdWRlIDxsaW51eC9zY2hlZC5oPgogI2luY2x1ZGUgPGxp
bnV4L3NlcV9maWxlLmg+CiAjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CiAjaW5jbHVkZSA8bGlu
dXgvcGZuLmg+CiAjaW5jbHVkZSA8bGludXgvbW0uaD4KKyNpbmNsdWRlIDxsaW51eC9tb3VudC5o
PgogI2luY2x1ZGUgPGxpbnV4L3Jlc291cmNlX2V4dC5oPgorI2luY2x1ZGUgPHVhcGkvbGludXgv
bWFnaWMuaD4KICNpbmNsdWRlIDxhc20vaW8uaD4KIAogCkBAIC0xMTE1LDYgKzExMTgsNTggQEAg
cmVzb3VyY2Vfc2l6ZV90IHJlc291cmNlX2FsaWdubWVudChzdHJ1Y3QgcmVzb3VyY2UgKnJlcykK
IAogc3RhdGljIERFQ0xBUkVfV0FJVF9RVUVVRV9IRUFEKG11eGVkX3Jlc291cmNlX3dhaXQpOwog
CitzdGF0aWMgc3RydWN0IGlub2RlICppb21lbV9pbm9kZTsKKworI2lmZGVmIENPTkZJR19JT19T
VFJJQ1RfREVWTUVNCitzdGF0aWMgdm9pZCByZXZva2VfaW9tZW0oc3RydWN0IHJlc291cmNlICpy
ZXMpCit7CisJLyogcGFpcnMgd2l0aCBzbXBfc3RvcmVfcmVsZWFzZSgpIGluIGlvbWVtX2luaXRf
aW5vZGUoKSAqLworCXN0cnVjdCBpbm9kZSAqaW5vZGUgPSBzbXBfbG9hZF9hY3F1aXJlKCZpb21l
bV9pbm9kZSk7CisKKwkvKgorCSAqIENoZWNrIHRoYXQgdGhlIGluaXRpYWxpemF0aW9uIGhhcyBj
b21wbGV0ZWQuIExvc2luZyB0aGUgcmFjZQorCSAqIGlzIG9rIGJlY2F1c2UgaXQgbWVhbnMgZHJp
dmVycyBhcmUgY2xhaW1pbmcgcmVzb3VyY2VzIGJlZm9yZQorCSAqIHRoZSBmc19pbml0Y2FsbCBs
ZXZlbCBvZiBpbml0IGFuZCBwcmV2ZW50IGlvbWVtX2dldF9tYXBwaW5nIHVzZXJzCisJICogZnJv
bSBlc3RhYmxpc2hpbmcgbWFwcGluZ3MuCisJICovCisJaWYgKCFpbm9kZSkKKwkJcmV0dXJuOwor
CisJLyoKKwkgKiBUaGUgZXhwZWN0YXRpb24gaXMgdGhhdCB0aGUgZHJpdmVyIGhhcyBzdWNjZXNz
ZnVsbHkgbWFya2VkCisJICogdGhlIHJlc291cmNlIGJ1c3kgYnkgdGhpcyBwb2ludCwgc28gZGV2
bWVtX2lzX2FsbG93ZWQoKQorCSAqIHNob3VsZCBzdGFydCByZXR1cm5pbmcgZmFsc2UsIGhvd2V2
ZXIgZm9yIHBlcmZvcm1hbmNlIHRoaXMKKwkgKiBkb2VzIG5vdCBpdGVyYXRlIHRoZSBlbnRpcmUg
cmVzb3VyY2UgcmFuZ2UuCisJICovCisJaWYgKGRldm1lbV9pc19hbGxvd2VkKFBIWVNfUEZOKHJl
cy0+c3RhcnQpKSAmJgorCSAgICBkZXZtZW1faXNfYWxsb3dlZChQSFlTX1BGTihyZXMtPmVuZCkp
KSB7CisJCS8qCisJCSAqICpjcmluZ2UqIGlvbWVtPXJlbGF4ZWQgc2F5cyAiZ28gYWhlYWQsIHdo
YXQncyB0aGUKKwkJICogd29yc3QgdGhhdCBjYW4gaGFwcGVuPyIKKwkJICovCisJCXJldHVybjsK
Kwl9CisKKwl1bm1hcF9tYXBwaW5nX3JhbmdlKGlub2RlLT5pX21hcHBpbmcsIHJlcy0+c3RhcnQs
IHJlc291cmNlX3NpemUocmVzKSwgMSk7Cit9CitzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqaW9tZW1f
Z2V0X21hcHBpbmcodm9pZCkKK3sKKwkvKgorCSAqIFRoaXMgZnVuY3Rpb24gaXMgb25seSBjYWxs
ZWQgZnJvbSBmaWxlIG9wZW4gcGF0aHMsIGhlbmNlIGd1YXJhbnRlZWQKKwkgKiB0aGF0IGZzX2lu
aXRjYWxscyBoYXZlIGNvbXBsZXRlZCBhbmQgbm8gbmVlZCB0byBjaGVjayBmb3IgTlVMTC4gQnV0
CisJICogc2luY2UgcmV2b2tlX2lvbWVtIGNhbiBiZSBjYWxsZWQgYmVmb3JlIHRoZSBpbml0Y2Fs
bCB3ZSBzdGlsbCBuZWVkCisJICogdGhlIGJhcnJpZXIgdG8gYXBwZWFzZSBjaGVja2Vycy4KKwkg
Ki8KKwlyZXR1cm4gc21wX2xvYWRfYWNxdWlyZSgmaW9tZW1faW5vZGUpLT5pX21hcHBpbmc7Cit9
CisjZWxzZQorc3RhdGljIHZvaWQgcmV2b2tlX2lvbWVtKHN0cnVjdCByZXNvdXJjZSAqcmVzKSB7
fQorc3RydWN0IGFkZHJlc3Nfc3BhY2UgKmlvbWVtX2dldF9tYXBwaW5nKHZvaWQpCit7CisJcmV0
dXJuIE5VTEw7Cit9CisjZW5kaWYKKwogLyoqCiAgKiBfX3JlcXVlc3RfcmVnaW9uIC0gY3JlYXRl
IGEgbmV3IGJ1c3kgcmVzb3VyY2UgcmVnaW9uCiAgKiBAcGFyZW50OiBwYXJlbnQgcmVzb3VyY2Ug
ZGVzY3JpcHRvcgpAQCAtMTE4Miw3ICsxMjM3LDcgQEAgc3RydWN0IHJlc291cmNlICogX19yZXF1
ZXN0X3JlZ2lvbihzdHJ1Y3QgcmVzb3VyY2UgKnBhcmVudCwKIAl3cml0ZV91bmxvY2soJnJlc291
cmNlX2xvY2spOwogCiAJaWYgKHJlcyAmJiBvcmlnX3BhcmVudCA9PSAmaW9tZW1fcmVzb3VyY2Up
Ci0JCXJldm9rZV9kZXZtZW0ocmVzKTsKKwkJcmV2b2tlX2lvbWVtKHJlcyk7CiAKIAlyZXR1cm4g
cmVzOwogfQpAQCAtMTc4Miw0ICsxODM3LDQ4IEBAIHN0YXRpYyBpbnQgX19pbml0IHN0cmljdF9p
b21lbShjaGFyICpzdHIpCiAJcmV0dXJuIDE7CiB9CiAKK3N0YXRpYyBpbnQgaW9tZW1fZnNfaW5p
dF9mc19jb250ZXh0KHN0cnVjdCBmc19jb250ZXh0ICpmYykKK3sKKwlyZXR1cm4gaW5pdF9wc2V1
ZG8oZmMsIERFVk1FTV9NQUdJQykgPyAwIDogLUVOT01FTTsKK30KKworc3RhdGljIHN0cnVjdCBm
aWxlX3N5c3RlbV90eXBlIGlvbWVtX2ZzX3R5cGUgPSB7CisJLm5hbWUJCT0gImlvbWVtIiwKKwku
b3duZXIJCT0gVEhJU19NT0RVTEUsCisJLmluaXRfZnNfY29udGV4dCA9IGlvbWVtX2ZzX2luaXRf
ZnNfY29udGV4dCwKKwkua2lsbF9zYgk9IGtpbGxfYW5vbl9zdXBlciwKK307CisKK3N0YXRpYyBp
bnQgX19pbml0IGlvbWVtX2luaXRfaW5vZGUodm9pZCkKK3sKKwlzdGF0aWMgc3RydWN0IHZmc21v
dW50ICppb21lbV92ZnNfbW91bnQ7CisJc3RhdGljIGludCBpb21lbV9mc19jbnQ7CisJc3RydWN0
IGlub2RlICppbm9kZTsKKwlpbnQgcmM7CisKKwlyYyA9IHNpbXBsZV9waW5fZnMoJmlvbWVtX2Zz
X3R5cGUsICZpb21lbV92ZnNfbW91bnQsICZpb21lbV9mc19jbnQpOworCWlmIChyYyA8IDApIHsK
KwkJcHJfZXJyKCJDYW5ub3QgbW91bnQgaW9tZW0gcHNldWRvIGZpbGVzeXN0ZW06ICVkXG4iLCBy
Yyk7CisJCXJldHVybiByYzsKKwl9CisKKwlpbm9kZSA9IGFsbG9jX2Fub25faW5vZGUoaW9tZW1f
dmZzX21vdW50LT5tbnRfc2IpOworCWlmIChJU19FUlIoaW5vZGUpKSB7CisJCXJjID0gUFRSX0VS
Uihpbm9kZSk7CisJCXByX2VycigiQ2Fubm90IGFsbG9jYXRlIGlub2RlIGZvciBpb21lbTogJWRc
biIsIHJjKTsKKwkJc2ltcGxlX3JlbGVhc2VfZnMoJmlvbWVtX3Zmc19tb3VudCwgJmlvbWVtX2Zz
X2NudCk7CisJCXJldHVybiByYzsKKwl9CisKKwkvKgorCSAqIFB1Ymxpc2ggaW9tZW0gcmV2b2Nh
dGlvbiBpbm9kZSBpbml0aWFsaXplZC4KKwkgKiBQYWlycyB3aXRoIHNtcF9sb2FkX2FjcXVpcmUo
KSBpbiByZXZva2VfaW9tZW0oKS4KKwkgKi8KKwlzbXBfc3RvcmVfcmVsZWFzZSgmaW9tZW1faW5v
ZGUsIGlub2RlKTsKKworCXJldHVybiAwOworfQorCitmc19pbml0Y2FsbChpb21lbV9pbml0X2lu
b2RlKTsKKwogX19zZXR1cCgiaW9tZW09Iiwgc3RyaWN0X2lvbWVtKTsKLS0gCjIuMjguMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
