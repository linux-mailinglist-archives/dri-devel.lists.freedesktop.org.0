Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1C517EB292
	for <lists+dri-devel@lfdr.de>; Thu, 31 Oct 2019 15:26:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB7BD6E0C2;
	Thu, 31 Oct 2019 14:26:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 17ABD6E0C2
 for <dri-devel@lists.freedesktop.org>; Thu, 31 Oct 2019 14:26:24 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: aratiu) with ESMTPSA id 57DB8290885
From: Adrian Ratiu <adrian.ratiu@collabora.com>
To: linux-arm-kernel@lists.infradead.org,
 linux-stm32@st-md-mailman.stormreply.com,
 linux-rockchip@lists.infradead.org
Subject: [PATCH 3/4] drm: imx: Add i.MX 6 MIPI DSI host driver
Date: Thu, 31 Oct 2019 16:26:32 +0200
Message-Id: <20191031142633.12460-4-adrian.ratiu@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191031142633.12460-1-adrian.ratiu@collabora.com>
References: <20191031142633.12460-1-adrian.ratiu@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Martyn Welch <martyn.welch@collabora.com>, kernel@collabora.com,
 Sjoerd Simons <sjoerd.simons@collabora.com>, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIHN1cHBvcnQgZm9yIHRoZSBTeW5vcHNpcyBEZXNpZ25XYXJlIE1JUEkgRFNJIGhv
c3QgY29udHJvbGxlcgp3aGljaCBpcyBlbWJlZGRlZCBpbiBpLk1YIDYgU29Dcy4KCkJhc2VkIG9u
IGZvbGxvd2luZyBwYXRjaGVzLCBidXQgdXBkYXRlZC9leHRlbmRlZCB0byB3b3JrIHdpdGggZXhp
c3RpbmcKc3VwcG9ydCBmb3VuZCBpbiB0aGUga2VybmVsOgoKLSBkcm06IGlteDogU3VwcG9ydCBT
eW5vcHN5cyBEZXNpZ25XYXJlIE1JUEkgRFNJIGhvc3QgY29udHJvbGxlcgogIFNpZ25lZC1vZmYt
Ynk6IExpdSBZaW5nIDxZaW5nLkxpdUBmcmVlc2NhbGUuY29tPgoKLSBBUk06IGR0c2k6IGlteDZx
ZGw6IEFkZCBzdXBwb3J0IGZvciBNSVBJIERTSSBob3N0IGNvbnRyb2xsZXIKICBTaWduZWQtb2Zm
LWJ5OiBMaXUgWWluZyA8WWluZy5MaXVAZnJlZXNjYWxlLmNvbT4KClNpZ25lZC1vZmYtYnk6IFNq
b2VyZCBTaW1vbnMgPHNqb2VyZC5zaW1vbnNAY29sbGFib3JhLmNvbT4KU2lnbmVkLW9mZi1ieTog
TWFydHluIFdlbGNoIDxtYXJ0eW4ud2VsY2hAY29sbGFib3JhLmNvbT4KU2lnbmVkLW9mZi1ieTog
QWRyaWFuIFJhdGl1IDxhZHJpYW4ucmF0aXVAY29sbGFib3JhLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vYnJpZGdlL3N5bm9wc3lzL2R3LW1pcGktZHNpLmMgfCAgMjUgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pbXgvS2NvbmZpZyAgICAgICAgICAgICAgICAgICB8ICAgNyArCiBkcml2ZXJzL2dwdS9k
cm0vaW14L01ha2VmaWxlICAgICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJt
L2lteC9kd19taXBpX2RzaS1pbXguYyAgICAgICAgIHwgNTAyICsrKysrKysrKysrKysrKysrKwog
NCBmaWxlcyBjaGFuZ2VkLCA1MjggaW5zZXJ0aW9ucygrKSwgNyBkZWxldGlvbnMoLSkKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2R3X21pcGlfZHNpLWlteC5jCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9zeW5vcHN5cy9kdy1taXBpLWRzaS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9zeW5vcHN5cy9kdy1taXBpLWRzaS5jCmluZGV4IGY4ODY5
MGQwNDQ5NC4uY2FmNTY2YmI3NGY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L3N5bm9wc3lzL2R3LW1pcGktZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9zeW5v
cHN5cy9kdy1taXBpLWRzaS5jCkBAIC0zMSw2ICszMSw4IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9w
cm9iZV9oZWxwZXIuaD4KIAogI2RlZmluZSBIV1ZFUl8xMzEJCQkweDMxMzMzMTAwCS8qIElQIHZl
cnNpb24gMS4zMSAqLworI2RlZmluZSBIV1ZFUl8xMzAJCQkweDMxMzMzMDAwCS8qIElQIHZlcnNp
b24gMS4zMCAqLworI2RlZmluZSBIV1ZFUl8xMDEJCQkweDMxMzAzMDAwCS8qIElQIHZlcnNpb24g
MS4wMSAqLwogCiAjZGVmaW5lIERTSV9WRVJTSU9OCQkJMHgwMAogI2RlZmluZSBWRVJTSU9OCQkJ
CUdFTk1BU0soMzEsIDgpCkBAIC00NTIsNyArNDU0LDcgQEAgc3RhdGljIHZvaWQgZHdfbWlwaV9k
c2lfdmlkZW9fbW9kZV9jb25maWcoc3RydWN0IGR3X21pcGlfZHNpICpkc2kpCiAJCQkJICAgVklE
X01PREVfVFlQRV9OT05fQlVSU1RfU1lOQ19FVkVOVFMpOwogCiAjaWZkZWYgQ09ORklHX0RFQlVH
X0ZTCi0JaWYgKGRzaS0+dnBnKSB7CisJaWYgKGRzaS0+aHdfdmVyc2lvbiA+IEhXVkVSXzEwMSAm
JiBkc2ktPnZwZykgewogCQlyZWdtYXBfZmllbGRfd3JpdGUoZHNpLT5yZWdzLCBkc2ktPmZpZWxk
X3ZpZF9tb2RlX3ZwZ19lbiwgMSk7CiAJCXJlZ21hcF9maWVsZF93cml0ZShkc2ktPnJlZ3MsIGRz
aS0+ZmllbGRfdmlkX21vZGVfdnBnX2hvcml6LAogCQkJCSAgIGRzaS0+dnBnX2hvcml6b250YWwg
PyAxIDogMCk7CkBAIC00NzAsOSArNDcyLDE1IEBAIHN0YXRpYyB2b2lkIGR3X21pcGlfZHNpX3Nl
dF9tb2RlKHN0cnVjdCBkd19taXBpX2RzaSAqZHNpLAogCiAJCWR3X21pcGlfZHNpX3ZpZGVvX21v
ZGVfY29uZmlnKGRzaSk7CiAKKwkJaWYgKGRzaS0+aHdfdmVyc2lvbiA9PSBIV1ZFUl8xMDEpCisJ
CQlyZWdtYXBfZmllbGRfd3JpdGUoZHNpLT5maWVsZF92aWRfbW9kZV9lbiwgMSk7CisKIAkJcmVn
bWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X3R4cmVxdWVzdGNsa2hzLCAxKTsKIAl9IGVs
c2UgewogCQlyZWdtYXBfZmllbGRfd3JpdGUoZHNpLT5maWVsZF9jbWRfbW9kZV9lbiwgMSk7CisK
KwkJaWYgKGRzaS0+aHdfdmVyc2lvbiA9PSBIV1ZFUl8xMDEpCisJCQlyZWdtYXBfZmllbGRfd3Jp
dGUoZHNpLT5maWVsZF92aWRfbW9kZV9lbiwgMCk7CiAJfQogCiAJcmVnbWFwX3dyaXRlKGRzaS0+
cmVncywgRFNJX1BXUl9VUCwgUE9XRVJVUCk7CkBAIC02NTYsOSArNjY0LDExIEBAIHN0YXRpYyB2
b2lkIGR3X21pcGlfZHNpX2RwaHlfdGltaW5nX2NvbmZpZyhzdHJ1Y3QgZHdfbWlwaV9kc2kgKmRz
aSkKIAlyZWdtYXBfZmllbGRfd3JpdGUoZHNpLT5maWVsZF9waHlfbHAyaHNfdGltZSwgMHg0MCk7
CiAJcmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X2hzMmxwX3RpbWUsIDB4NDApOwog
Ci0JcmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X21heF9yZF90aW1lLCAxMDAwMCk7
Ci0JcmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X2Nsa2xwMmhzX3RpbWUsIDB4NDAp
OwotCXJlZ21hcF9maWVsZF93cml0ZShkc2ktPmZpZWxkX3BoeV9jbGtoczJscF90aW1lLCAweDQw
KTsKKwlpZiAoZHNpLT5od192ZXJzaW9uID4gSFdWRVJfMTAxKSB7CisJCXJlZ21hcF9maWVsZF93
cml0ZShkc2ktPmZpZWxkX3BoeV9tYXhfcmRfdGltZSwgMTAwMDApOworCQlyZWdtYXBfZmllbGRf
d3JpdGUoZHNpLT5maWVsZF9waHlfY2xrbHAyaHNfdGltZSwgMHg0MCk7CisJCXJlZ21hcF9maWVs
ZF93cml0ZShkc2ktPmZpZWxkX3BoeV9jbGtoczJscF90aW1lLCAweDQwKTsKKwl9CiB9CiAKIHN0
YXRpYyB2b2lkIGR3X21pcGlfZHNpX2RwaHlfaW50ZXJmYWNlX2NvbmZpZyhzdHJ1Y3QgZHdfbWlw
aV9kc2kgKmRzaSkKQEAgLTY3OSw3ICs2ODksOCBAQCBzdGF0aWMgdm9pZCBkd19taXBpX2RzaV9k
cGh5X2luaXQoc3RydWN0IGR3X21pcGlfZHNpICpkc2kpCiAJcmVnbWFwX2ZpZWxkX3dyaXRlKGRz
aS0+ZmllbGRfcGh5X3VucnN0eiwgMCk7CiAJcmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRf
cGh5X3Vuc2h1dGRvd256LCAwKTsKIAotCXJlZ21hcF9maWVsZF93cml0ZShkc2ktPmZpZWxkX3Bo
eV9mb3JjZXBsbCwgMCk7CisJaWYgKGRzaS0+aHdfdmVyc2lvbiA+IEhXVkVSXzEwMSkKKwkJcmVn
bWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X2ZvcmNlcGxsLCAwKTsKIAogCXJlZ21hcF9m
aWVsZF93cml0ZShkc2ktPmZpZWxkX3BoeV90ZXN0Y2xyLCAwKTsKIAlyZWdtYXBfZmllbGRfd3Jp
dGUoZHNpLT5maWVsZF9waHlfdGVzdGNsciwgMSk7CkBAIC02OTUsNyArNzA2LDggQEAgc3RhdGlj
IHZvaWQgZHdfbWlwaV9kc2lfZHBoeV9lbmFibGUoc3RydWN0IGR3X21pcGlfZHNpICpkc2kpCiAJ
cmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X3VucnN0eiwgMSk7CiAJcmVnbWFwX2Zp
ZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X3Vuc2h1dGRvd256LCAxKTsKIAotCXJlZ21hcF9maWVs
ZF93cml0ZShkc2ktPmZpZWxkX3BoeV9mb3JjZXBsbCwgMSk7CisJaWYgKGRzaS0+aHdfdmVyc2lv
biA+IEhXVkVSXzEwMSkKKwkJcmVnbWFwX2ZpZWxkX3dyaXRlKGRzaS0+ZmllbGRfcGh5X2ZvcmNl
cGxsLCAxKTsKIAogCXJldCA9IHJlZ21hcF9maWVsZF9yZWFkX3BvbGxfdGltZW91dChkc2ktPmZp
ZWxkX3BoeV9zdGF0dXMsCiAJCQkJCSAgICAgdmFsLCB2YWwgJiBQSFlfTE9DSywKQEAgLTkxOSw3
ICs5MzEsNiBAQCBzdGF0aWMgdm9pZCBkd19taXBpX2RzaV9nZXRfaHdfdmVyc2lvbihzdHJ1Y3Qg
ZHdfbWlwaV9kc2kgKmRzaSkKIAkJCWRldl93YXJuKGRzaS0+ZGV2LCAiSWdub3JpbmcgcmVnbWFw
IGZpZWxkICIgI2YgIlxuIik7IFwKIAl9IHdoaWxlICgwKQogCi0KIHN0YXRpYyB2b2lkIGR3X21p
cGlfZHNpX3JlZ21hcF9maWVsZHNfaW5pdChzdHJ1Y3QgZHdfbWlwaV9kc2kgKmRzaSkKIHsKIAlj
b25zdCBzdHJ1Y3QgZHdfbWlwaV9kc2lfdmFyaWFudCAqdmFyaWFudCA9IGRzaS0+cGxhdF9kYXRh
LT52YXJpYW50OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9LY29uZmlnIGIvZHJp
dmVycy9ncHUvZHJtL2lteC9LY29uZmlnCmluZGV4IDIwN2JmNzQwOWRmYi4uMzk2NzkzZWJmNTQy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaW14L0tjb25maWcKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2lteC9LY29uZmlnCkBAIC0zOSwzICszOSwxMCBAQCBjb25maWcgRFJNX0lNWF9IRE1J
CiAJZGVwZW5kcyBvbiBEUk1fSU1YCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgaWYgeW91IHdhbnQg
dG8gdXNlIEhETUkgb24gaS5NWDYuCisKK2NvbmZpZyBEUk1fSU1YX01JUElfRFNJCisJdHJpc3Rh
dGUgIkZyZWVzY2FsZSBpLk1YIERSTSBNSVBJIERTSSIKKwlzZWxlY3QgRFJNX0RXX01JUElfRFNJ
CisJZGVwZW5kcyBvbiBEUk1fSU1YCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgaWYgeW91IHdhbnQg
dG8gdXNlIE1JUEkgRFNJIG9uIGkuTVg2LgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lt
eC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvTWFrZWZpbGUKaW5kZXggMjFjZGNjMmZh
YWJjLi42NTQzYTgxMzc2ZWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvTWFrZWZp
bGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lteC9NYWtlZmlsZQpAQCAtOSwzICs5LDQgQEAgb2Jq
LSQoQ09ORklHX0RSTV9JTVhfVFZFKSArPSBpbXgtdHZlLm8KIG9iai0kKENPTkZJR19EUk1fSU1Y
X0xEQikgKz0gaW14LWxkYi5vCiAKIG9iai0kKENPTkZJR19EUk1fSU1YX0hETUkpICs9IGR3X2hk
bWktaW14Lm8KK29iai0kKENPTkZJR19EUk1fSU1YX01JUElfRFNJKSArPSBkd19taXBpX2RzaS1p
bXgubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kd19taXBpX2RzaS1pbXguYyBi
L2RyaXZlcnMvZ3B1L2RybS9pbXgvZHdfbWlwaV9kc2ktaW14LmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4xODhjZmQ1ZmFjZTIKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaW14L2R3X21pcGlfZHNpLWlteC5jCkBAIC0wLDAgKzEsNTAyIEBACisv
LyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCsKKy8qCisgKiBpLk1YIGRybSBkcml2
ZXIgLSBNSVBJIERTSSBIb3N0IENvbnRyb2xsZXIKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTEt
MjAxNSBGcmVlc2NhbGUgU2VtaWNvbmR1Y3RvciwgSW5jLgorICovCisKKyNpbmNsdWRlIDxsaW51
eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51eC9jb21wb25lbnQuaD4KKyNpbmNsdWRlIDxsaW51eC9t
ZmQvc3lzY29uLmg+CisjaW5jbHVkZSA8bGludXgvbWZkL3N5c2Nvbi9pbXg2cS1pb211eGMtZ3By
Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvb2ZfZGV2aWNl
Lmg+CisjaW5jbHVkZSA8bGludXgvcmVnbWFwLmg+CisjaW5jbHVkZSA8bGludXgvdmlkZW9kZXYy
Lmg+CisjaW5jbHVkZSA8ZHJtL2JyaWRnZS9kd19taXBpX2RzaS5oPgorI2luY2x1ZGUgPGRybS9k
cm1fY3J0Y19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21pcGlfZHNpLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9vZi5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKworI2luY2x1ZGUg
ImlteC1kcm0uaCIKKworI2RlZmluZSBEUklWRVJfTkFNRQkiaW14LW1pcGktZHNpIgorCisjZGVm
aW5lIERTSV9EUElfQ0ZHCQkJMHgwYworI2RlZmluZSBEU0lfUENLSERMX0NGRwkJCTB4MTgKKyNk
ZWZpbmUgRFNJX0NNRF9NT0RFX0NGRwkJMHgyNAorI2RlZmluZSBEU0lfVklEX01PREVfQ0ZHCQkw
eDFjCisjZGVmaW5lIERTSV9WSURfUEtUX0NGRwkJCTB4MjAKKyNkZWZpbmUgRFNJX1RPX0NOVF9D
RkcJCQkweDQwCisjZGVmaW5lIERTSV9UTVJfTElORV9DRkcJCTB4MjgKKyNkZWZpbmUgRFNJX1ZU
SU1JTkdfQ0ZHCQkJMHgyYworI2RlZmluZSBEU0lfUEhZX1RNUl9DRkcJCQkweDMwCisjZGVmaW5l
IERTSV9HRU5fSERSCQkJMHgzNAorI2RlZmluZSBEU0lfR0VOX1BMRF9EQVRBCQkweDM4CisjZGVm
aW5lIERTSV9DTURfUEtUX1NUQVRVUwkJMHgzYworI2RlZmluZSBEU0lfUEhZX1JTVFoJCQkweDU0
CisjZGVmaW5lIERTSV9QSFlfSUZfQ0ZHCQkJMHg1OAorI2RlZmluZSBEU0lfUEhZX1NUQVRVUwkJ
CTB4NjAKKyNkZWZpbmUgRFNJX1BIWV9UU1RfQ1RSTDAJCTB4NjQKKworI2RlZmluZSBEU0lfUFdS
X1VQCQkJMHgwNAorI2RlZmluZSBSRVNFVAkJCQkwCisjZGVmaW5lIFBPV0VSVVAJCQkJQklUKDAp
CisKKyNkZWZpbmUgRFNJX1BIWV9JRl9DVFJMCQkJMHg1YworI2RlZmluZSBQSFlfSUZfQ1RSTF9S
RVNFVAkJMHgwCisjZGVmaW5lIFRYX1JFUV9DTEtfSFMJCQlCSVQoMCkKKworI2RlZmluZSBEU0lf
UEhZX1RTVF9DVFJMMAkJMHg2NAorI2RlZmluZSBQSFlfVEVTVENMSwkJCUJJVCgxKQorI2RlZmlu
ZSBQSFlfVU5URVNUQ0xLCQkJMAorI2RlZmluZSBQSFlfVEVTVENMUgkJCUJJVCgwKQorI2RlZmlu
ZSBQSFlfVU5URVNUQ0xSCQkJMAorCisjZGVmaW5lIERTSV9QSFlfVFNUX0NUUkwxCQkweDY4Cisj
ZGVmaW5lIFBIWV9URVNURU4JCQlCSVQoMTYpCisjZGVmaW5lIFBIWV9VTlRFU1RFTgkJCTAKKyNk
ZWZpbmUgUEhZX1RFU1RET1VUKG4pCQkJKCgobikgJiAweGZmKSA8PCA4KQorI2RlZmluZSBQSFlf
VEVTVERJTihuKQkJCSgoKG4pICYgMHhmZikgPDwgMCkKKworI2RlZmluZSBFTl9URUFSX0ZYCQkJ
QklUKDE0KQorI2RlZmluZSBEQ1NfTFdfVFhfTFAJCQlCSVQoMTIpCisjZGVmaW5lIEdFTl9MV19U
WF9MUAkJCUJJVCgxMSkKKyNkZWZpbmUgTUFYX1JEX1BLVF9TSVpFX0xQCQlCSVQoMTApCisjZGVm
aW5lIERDU19TV18yUF9UWF9MUAkJCUJJVCg5KQorI2RlZmluZSBEQ1NfU1dfMVBfVFhfTFAJCQlC
SVQoOCkKKyNkZWZpbmUgRENTX1NXXzBQX1RYX0xQCQkJQklUKDcpCisjZGVmaW5lIEdFTl9TUl8y
UF9UWF9MUAkJCUJJVCg2KQorI2RlZmluZSBHRU5fU1JfMVBfVFhfTFAJCQlCSVQoNSkKKyNkZWZp
bmUgR0VOX1NSXzBQX1RYX0xQCQkJQklUKDQpCisjZGVmaW5lIEdFTl9TV18yUF9UWF9MUAkJCUJJ
VCgzKQorI2RlZmluZSBHRU5fU1dfMVBfVFhfTFAJCQlCSVQoMikKKyNkZWZpbmUgR0VOX1NXXzBQ
X1RYX0xQCQkJQklUKDEpCisKKyNkZWZpbmUgQ01EX01PREVfQUxMX0xQCQkJKERDU19MV19UWF9M
UCB8IFwKKwkJCQkJIEdFTl9MV19UWF9MUCB8IFwKKwkJCQkJIE1BWF9SRF9QS1RfU0laRV9MUCB8
IFwKKwkJCQkJIERDU19TV18yUF9UWF9MUCB8IFwKKwkJCQkJIERDU19TV18xUF9UWF9MUCB8IFwK
KwkJCQkJIERDU19TV18wUF9UWF9MUCB8IFwKKwkJCQkJIEdFTl9TUl8yUF9UWF9MUCB8IFwKKwkJ
CQkJIEdFTl9TUl8xUF9UWF9MUCB8IFwKKwkJCQkJIEdFTl9TUl8wUF9UWF9MUCB8IFwKKwkJCQkJ
IEdFTl9TV18yUF9UWF9MUCB8IFwKKwkJCQkJIEdFTl9TV18xUF9UWF9MUCB8IFwKKwkJCQkJIEdF
Tl9TV18wUF9UWF9MUCkKKworI2RlZmluZSBEU0lfRVJST1JfU1QwCQkJMHg0NAorI2RlZmluZSBE
U0lfRVJST1JfU1QxCQkJMHg0OAorI2RlZmluZSBEU0lfRVJST1JfTVNLMAkJCTB4NGMKKyNkZWZp
bmUgRFNJX0VSUk9SX01TSzEJCQkweDUwCisKK3N0YXRpYyBzdHJ1Y3QgZHdfbWlwaV9kc2lfdmFy
aWFudCBpbXhfZHNpX3ZhcmlhbnQgPSB7CisJLmNmZ19kcGlfdmlkID0JCQlSRUdfRklFTEQoRFNJ
X0RQSV9DRkcsIDAsIDEpLAorCS5jZmdfZHBpX2NvbG9yX2NvZGluZyA9CQlSRUdfRklFTEQoRFNJ
X0RQSV9DRkcsIDIsIDQpLAorCS5jZmdfZHBpXzE4bG9vc2VseV9lbiA9CQlSRUdfRklFTEQoRFNJ
X0RQSV9DRkcsIDEwLCAxMCksCisJLmNmZ19kcGlfdnN5bmNfYWN0aXZlX2xvdyA9CVJFR19GSUVM
RChEU0lfRFBJX0NGRywgNiwgNiksCisJLmNmZ19kcGlfaHN5bmNfYWN0aXZlX2xvdyA9CVJFR19G
SUVMRChEU0lfRFBJX0NGRywgNywgNyksCisJLmNmZ19jbWRfbW9kZV9lbiA9CQlSRUdfRklFTEQo
RFNJX0NNRF9NT0RFX0NGRywgMCwgMCksCisJLmNmZ19jbWRfbW9kZV9hbGxfbHBfZW4gPQlSRUdf
RklFTEQoRFNJX0NNRF9NT0RFX0NGRywgMSwgMTIpLAorCS5jZmdfY21kX21vZGVfYWNrX3Jxc3Rf
ZW4gPQlSRUdfRklFTEQoRFNJX0NNRF9NT0RFX0NGRywgMTMsIDEzKSwKKwkuY2ZnX2NtZF9wa3Rf
c3RhdHVzID0JCVJFR19GSUVMRChEU0lfQ01EX1BLVF9TVEFUVVMsIDAsIDE0KSwKKwkuY2ZnX3Zp
ZF9tb2RlX2VuID0JCVJFR19GSUVMRChEU0lfVklEX01PREVfQ0ZHLCAwLCAwKSwKKwkuY2ZnX3Zp
ZF9tb2RlX3R5cGUgPQkJUkVHX0ZJRUxEKERTSV9WSURfTU9ERV9DRkcsIDEsIDIpLAorCS5jZmdf
dmlkX21vZGVfbG93X3Bvd2VyID0JUkVHX0ZJRUxEKERTSV9WSURfTU9ERV9DRkcsIDMsIDgpLAor
CS5jZmdfdmlkX3BrdF9zaXplID0JCVJFR19GSUVMRChEU0lfVklEX1BLVF9DRkcsIDAsIDEwKSwK
KwkuY2ZnX3ZpZF9oc2FfdGltZSA9CQlSRUdfRklFTEQoRFNJX1RNUl9MSU5FX0NGRywgMCwgOCks
CisJLmNmZ192aWRfaGJwX3RpbWUgPQkJUkVHX0ZJRUxEKERTSV9UTVJfTElORV9DRkcsIDksIDE3
KSwKKwkuY2ZnX3ZpZF9obGluZV90aW1lID0JCVJFR19GSUVMRChEU0lfVE1SX0xJTkVfQ0ZHLCAx
OCwgMzEpLAorCS5jZmdfdmlkX3ZzYV90aW1lID0JCVJFR19GSUVMRChEU0lfVlRJTUlOR19DRkcs
IDAsIDMpLAorCS5jZmdfdmlkX3ZicF90aW1lID0JCVJFR19GSUVMRChEU0lfVlRJTUlOR19DRkcs
IDQsIDkpLAorCS5jZmdfdmlkX3ZmcF90aW1lID0JCVJFR19GSUVMRChEU0lfVlRJTUlOR19DRkcs
IDEwLCAxNSksCisJLmNmZ192aWRfdmFjdGl2ZV90aW1lID0JCVJFR19GSUVMRChEU0lfVlRJTUlO
R19DRkcsIDE2LCAyNiksCisJLmNmZ19waHlfdHhyZXF1ZXN0Y2xraHMgPQlSRUdfRklFTEQoRFNJ
X1BIWV9JRl9DVFJMLCAwLCAwKSwKKwkuY2ZnX3BoeV9idGFfdGltZSA9CQlSRUdfRklFTEQoRFNJ
X1BIWV9UTVJfQ0ZHLCAwLCAxMSksCisJLmNmZ19waHlfbHAyaHNfdGltZSA9CQlSRUdfRklFTEQo
RFNJX1BIWV9UTVJfQ0ZHLCAxMiwgMTkpLAorCS5jZmdfcGh5X2hzMmxwX3RpbWUgPQkJUkVHX0ZJ
RUxEKERTSV9QSFlfVE1SX0NGRywgMjAsIDI3KSwKKwkuY2ZnX3BoeV90ZXN0Y2xyID0JCVJFR19G
SUVMRChEU0lfUEhZX1RTVF9DVFJMMCwgMCwgMCksCisJLmNmZ19waHlfdW5zaHV0ZG93bnogPQkJ
UkVHX0ZJRUxEKERTSV9QSFlfUlNUWiwgMCwgMCksCisJLmNmZ19waHlfdW5yc3R6ID0JCVJFR19G
SUVMRChEU0lfUEhZX1JTVFosIDEsIDEpLAorCS5jZmdfcGh5X2VuYWJsZWNsayA9CQlSRUdfRklF
TEQoRFNJX1BIWV9SU1RaLCAyLCAyKSwKKwkuY2ZnX3BoeV9ubGFuZXMgPQkJUkVHX0ZJRUxEKERT
SV9QSFlfSUZfQ0ZHLCAwLCAxKSwKKwkuY2ZnX3BoeV9zdG9wX3dhaXRfdGltZSA9CVJFR19GSUVM
RChEU0lfUEhZX0lGX0NGRywgMiwgOSksCisJLmNmZ19waHlfc3RhdHVzID0JCVJFR19GSUVMRChE
U0lfUEhZX1NUQVRVUywgMCwgMCksCisJLmNmZ19wY2toZGxfY2ZnID0JCVJFR19GSUVMRChEU0lf
UENLSERMX0NGRywgMCwgNCksCisJLmNmZ19oc3R4X3RpbWVvdXRfY291bnRlciA9CVJFR19GSUVM
RChEU0lfVE9fQ05UX0NGRywgMCwgMTUpLAorCS5jZmdfbHByeF90aW1lb3V0X2NvdW50ZXIgPQlS
RUdfRklFTEQoRFNJX1RPX0NOVF9DRkcsIDE2LCAzMSksCisJLmNmZ19pbnRfc3RhdDAgPQkJUkVH
X0ZJRUxEKERTSV9FUlJPUl9TVDAsIDAsIDIwKSwKKwkuY2ZnX2ludF9zdGF0MSA9CQlSRUdfRklF
TEQoRFNJX0VSUk9SX1NUMSwgMCwgMTcpLAorCS5jZmdfaW50X21hc2swID0JCVJFR19GSUVMRChE
U0lfRVJST1JfTVNLMCwgMCwgMjApLAorCS5jZmdfaW50X21hc2sxID0JCVJFR19GSUVMRChEU0lf
RVJST1JfTVNLMSwgMCwgMTcpLAorCS5jZmdfZ2VuX2hkciA9CQkJUkVHX0ZJRUxEKERTSV9HRU5f
SERSLCAwLCAzMSksCisJLmNmZ19nZW5fcGF5bG9hZCA9CQlSRUdfRklFTEQoRFNJX0dFTl9QTERf
REFUQSwgMCwgMzEpLAorCS52YWxfY21kX21vZGVfYWxsX2xwID0JCUNNRF9NT0RFX0FMTF9MUCwK
K307CisKK3N0cnVjdCBpbXhfbWlwaV9kc2kgeworCXN0cnVjdCBkcm1fZW5jb2RlciBlbmNvZGVy
OworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwlzdHJ1Y3QgcmVnbWFwICptdXhfc2VsOworCXN0cnVj
dCBkd19taXBpX2RzaSAqbWlwaV9kc2k7CisJc3RydWN0IGNsayAqcGxscmVmX2NsazsKKworCXN0
cnVjdCByZWdtYXAgKnJlZ3M7CisJdW5zaWduZWQgaW50IGxhbmVfbWJwczsKK307CisKK3N0cnVj
dCBkcGh5X3BsbF90ZXN0ZGluX21hcCB7CisJdW5zaWduZWQgaW50IG1heF9tYnBzOworCXU4IHRl
c3RkaW47Cit9OworCisvKiBUaGUgdGFibGUgaXMgYmFzZWQgb24gMjdNSHogRFBIWSBwbGwgcmVm
ZXJlbmNlIGNsb2NrLiAqLworc3RhdGljIGNvbnN0IHN0cnVjdCBkcGh5X3BsbF90ZXN0ZGluX21h
cCBkcHRkaW5fbWFwW10gPSB7CisJezE2MCwgMHgwNH0sIHsxODAsIDB4MjR9LCB7MjAwLCAweDQ0
fSwgezIxMCwgMHgwNn0sCisJezI0MCwgMHgyNn0sIHsyNTAsIDB4NDZ9LCB7MjcwLCAweDA4fSwg
ezMwMCwgMHgyOH0sCisJezMzMCwgMHg0OH0sIHszNjAsIDB4MmF9LCB7NDAwLCAweDRhfSwgezQ1
MCwgMHgwY30sCisJezUwMCwgMHgyY30sIHs1NTAsIDB4MGV9LCB7NjAwLCAweDJlfSwgezY1MCwg
MHgxMH0sCisJezcwMCwgMHgzMH0sIHs3NTAsIDB4MTJ9LCB7ODAwLCAweDMyfSwgezg1MCwgMHgx
NH0sCisJezkwMCwgMHgzNH0sIHs5NTAsIDB4NTR9LCB7MTAwMCwgMHg3NH0KK307CisKK3N0YXRp
YyBpbmxpbmUgc3RydWN0IGlteF9taXBpX2RzaSAqZW5jX3RvX2RzaShzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuYykKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGVuYywgc3RydWN0IGlteF9taXBpX2Rz
aSwgZW5jb2Rlcik7Cit9CisKK3N0YXRpYyB2b2lkIGlteF9taXBpX2RzaV9zZXRfaXB1X2RpX211
eChzdHJ1Y3QgaW14X21pcGlfZHNpICpkc2ksIGludCBpcHVfZGkpCit7CisJcmVnbWFwX3VwZGF0
ZV9iaXRzKGRzaS0+bXV4X3NlbCwgSU9NVVhDX0dQUjMsCisJCQkgICBJTVg2UV9HUFIzX01JUElf
TVVYX0NUTF9NQVNLLAorCQkJICAgaXB1X2RpIDw8IElNWDZRX0dQUjNfTUlQSV9NVVhfQ1RMX1NI
SUZUKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9mdW5jcyBpbXhfbWlw
aV9kc2lfZW5jb2Rlcl9mdW5jcyA9IHsKKwkuZGVzdHJveSA9IGlteF9kcm1fZW5jb2Rlcl9kZXN0
cm95LAorfTsKKworc3RhdGljIGJvb2wgaW14X21pcGlfZHNpX2VuY29kZXJfbW9kZV9maXh1cChz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCisJCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqbW9kZSwKKwkJCQkJICAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGpf
bW9kZSkKK3sKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGludCBpbXhfbWlwaV9kc2lfZW5j
b2Rlcl9hdG9taWNfY2hlY2soc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyLAorCQkJCQkgICAg
IHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICAgICBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubikKK3sKKwlzdHJ1Y3QgaW14X2NydGNfc3RhdGUgKmlteF9j
cnRjX3N0YXRlID0gdG9faW14X2NydGNfc3RhdGUoY3J0Y19zdGF0ZSk7CisKKwkvKiBUaGUgZm9s
bG93aW5nIHZhbHVlcyBhcmUgdGFrZW4gZnJvbSBkd19oZG1pX2lteF9hdG9taWNfY2hlY2sgKi8K
KwlpbXhfY3J0Y19zdGF0ZS0+YnVzX2Zvcm1hdCA9IE1FRElBX0JVU19GTVRfUkdCODg4XzFYMjQ7
CisJaW14X2NydGNfc3RhdGUtPmRpX2hzeW5jX3BpbiA9IDI7CisJaW14X2NydGNfc3RhdGUtPmRp
X3ZzeW5jX3BpbiA9IDM7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaW14X21pcGlf
ZHNpX2VuY29kZXJfY29tbWl0KHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKK3sKKwlzdHJ1
Y3QgaW14X21pcGlfZHNpICpkc2kgPSBlbmNfdG9fZHNpKGVuY29kZXIpOworCWludCBtdXggPSBk
cm1fb2ZfZW5jb2Rlcl9hY3RpdmVfcG9ydF9pZChkc2ktPmRldi0+b2Zfbm9kZSwgZW5jb2Rlcik7
CisKKwlpbXhfbWlwaV9kc2lfc2V0X2lwdV9kaV9tdXgoZHNpLCBtdXgpOworfQorCitzdGF0aWMg
dm9pZCBpbXhfbWlwaV9kc2lfZW5jb2Rlcl9kaXNhYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5j
b2RlcikKK3sKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVu
Y3MgaW14X21pcGlfZHNpX2VuY29kZXJfaGVscGVycyA9IHsKKwkubW9kZV9maXh1cCA9IGlteF9t
aXBpX2RzaV9lbmNvZGVyX21vZGVfZml4dXAsCisJLmNvbW1pdCA9IGlteF9taXBpX2RzaV9lbmNv
ZGVyX2NvbW1pdCwKKwkuZGlzYWJsZSA9IGlteF9taXBpX2RzaV9lbmNvZGVyX2Rpc2FibGUsCisJ
LmF0b21pY19jaGVjayA9IGlteF9taXBpX2RzaV9lbmNvZGVyX2F0b21pY19jaGVjaywKK307CisK
K3N0YXRpYyBpbnQgaW14X21pcGlfZHNpX3JlZ2lzdGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0s
CisJCQkJIHN0cnVjdCBpbXhfbWlwaV9kc2kgKmRzaSkKK3sKKwlpbnQgcmV0OworCisJcmV0ID0g
aW14X2RybV9lbmNvZGVyX3BhcnNlX29mKGRybSwgJmRzaS0+ZW5jb2RlciwgZHNpLT5kZXYtPm9m
X25vZGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm1fZW5jb2Rlcl9oZWxwZXJf
YWRkKCZkc2ktPmVuY29kZXIsCisJCQkgICAgICAgJmlteF9taXBpX2RzaV9lbmNvZGVyX2hlbHBl
cnMpOworCWRybV9lbmNvZGVyX2luaXQoZHJtLCAmZHNpLT5lbmNvZGVyLCAmaW14X21pcGlfZHNp
X2VuY29kZXJfZnVuY3MsCisJCQkgRFJNX01PREVfRU5DT0RFUl9EU0ksIE5VTEwpOworCXJldHVy
biAwOworfQorCitzdGF0aWMgZW51bSBkcm1fbW9kZV9zdGF0dXMgaW14X21pcGlfZHNpX21vZGVf
dmFsaWQodm9pZCAqcHJpdl9kYXRhLAorCQkJCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqbW9kZSkKK3sKKwkvKgorCSAqIFRoZSBWSURfUEtUX1NJWkUgZmllbGQgaW4gdGhlIERTSV9W
SURfUEtUX0NGRworCSAqIHJlZ2lzdGVyIGlzIDExLWJpdC4KKwkgKi8KKwlpZiAobW9kZS0+aGRp
c3BsYXkgPiAweDdmZikKKwkJcmV0dXJuIE1PREVfQkFEX0hWQUxVRTsKKworCS8qCisJICogVGhl
IFZfQUNUSVZFX0xJTkVTIGZpZWxkIGluIHRoZSBEU0lfVlRJTUlOR19DRkcKKwkgKiByZWdpc3Rl
ciBpcyAxMS1iaXQuCisJICovCisJaWYgKG1vZGUtPnZkaXNwbGF5ID4gMHg3ZmYpCisJCXJldHVy
biBNT0RFX0JBRF9WVkFMVUU7CisKKwlyZXR1cm4gTU9ERV9PSzsKK30KKworCitzdGF0aWMgdW5z
aWduZWQgaW50IG1heF9tYnBzX3RvX3Rlc3RkaW4odW5zaWduZWQgaW50IG1heF9tYnBzKQorewor
CXVuc2lnbmVkIGludCBpOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoZHB0ZGluX21h
cCk7IGkrKykKKwkJaWYgKGRwdGRpbl9tYXBbaV0ubWF4X21icHMgPT0gbWF4X21icHMpCisJCQly
ZXR1cm4gZHB0ZGluX21hcFtpXS50ZXN0ZGluOworCisJcmV0dXJuIC1FSU5WQUw7Cit9CisKK3N0
YXRpYyBjb25zdCBzdHJ1Y3QgcmVnbWFwX2NvbmZpZyBpbXhfZHNpX3JlZ21hcF9jb25maWcgPSB7
CisJLnJlZ19iaXRzID0gMzIsCisJLnZhbF9iaXRzID0gMzIsCisJLnJlZ19zdHJpZGUgPSA0LAor
CS5tYXhfcmVnaXN0ZXIgPSBEU0lfUEhZX1RTVF9DVFJMMSwKKwkubmFtZSA9IERSSVZFUl9OQU1F
LAorfTsKKworc3RhdGljIGludCBpbXhfbWlwaV9kc2lfcGh5X2luaXQodm9pZCAqcHJpdl9kYXRh
KQoreworCXN0cnVjdCBpbXhfbWlwaV9kc2kgKmRzaSA9IHByaXZfZGF0YTsKKwlzdHJ1Y3QgcmVn
bWFwICpyZWdzID0gZHNpLT5yZWdzOworCWludCB0ZXN0ZGluOworCisJdGVzdGRpbiA9IG1heF9t
YnBzX3RvX3Rlc3RkaW4oZHNpLT5sYW5lX21icHMpOworCWlmICh0ZXN0ZGluIDwgMCkgeworCQlk
ZXZfZXJyKGRzaS0+ZGV2LAorCQkJImZhaWxlZCB0byBnZXQgdGVzdGRpbiBmb3IgJWRtYnBzIGxh
bmUgY2xvY2tcbiIsCisJCQlkc2ktPmxhbmVfbWJwcyk7CisJCXJldHVybiB0ZXN0ZGluOworCX0K
KworCXJlZ21hcF93cml0ZShyZWdzLCBEU0lfUEhZX0lGX0NUUkwsIFBIWV9JRl9DVFJMX1JFU0VU
KTsKKwlyZWdtYXBfd3JpdGUocmVncywgRFNJX1BXUl9VUCwgUE9XRVJVUCk7CisKKwlyZWdtYXBf
d3JpdGUocmVncywgRFNJX1BIWV9UU1RfQ1RSTDAsIFBIWV9VTlRFU1RDTEsgfCBQSFlfVU5URVNU
Q0xSKTsKKwlyZWdtYXBfd3JpdGUocmVncywgRFNJX1BIWV9UU1RfQ1RSTDEsIFBIWV9URVNURU4g
fCBQSFlfVEVTVERPVVQoMCkgfAorCQkgICAgIFBIWV9URVNURElOKDB4NDQpKTsKKwlyZWdtYXBf
d3JpdGUocmVncywgRFNJX1BIWV9UU1RfQ1RSTDAsIFBIWV9URVNUQ0xLIHwgUEhZX1VOVEVTVENM
Uik7CisJcmVnbWFwX3dyaXRlKHJlZ3MsIERTSV9QSFlfVFNUX0NUUkwwLCBQSFlfVU5URVNUQ0xL
IHwgUEhZX1VOVEVTVENMUik7CisJcmVnbWFwX3dyaXRlKHJlZ3MsIERTSV9QSFlfVFNUX0NUUkwx
LCBQSFlfVU5URVNURU4gfCBQSFlfVEVTVERPVVQoMCkgfAorCQkgICAgIFBIWV9URVNURElOKHRl
c3RkaW4pKTsKKwlyZWdtYXBfd3JpdGUocmVncywgRFNJX1BIWV9UU1RfQ1RSTDAsIFBIWV9URVNU
Q0xLIHwgUEhZX1VOVEVTVENMUik7CisJcmVnbWFwX3dyaXRlKHJlZ3MsIERTSV9QSFlfVFNUX0NU
UkwwLCBQSFlfVU5URVNUQ0xLIHwgUEhZX1VOVEVTVENMUik7CisKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGludCBpbXhfbWlwaV9kc2lfZ2V0X2xhbmVfbWJwcyh2b2lkICpwcml2X2RhdGEsCisJ
CQkJICAgICAgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCisJCQkJICAgICAg
dW5zaWduZWQgbG9uZyBtb2RlX2ZsYWdzLCB1MzIgbGFuZXMsCisJCQkJICAgICAgdTMyIGZvcm1h
dCwgdW5zaWduZWQgaW50ICpsYW5lX21icHMpCit7CisJc3RydWN0IGlteF9taXBpX2RzaSAqZHNp
ID0gcHJpdl9kYXRhOworCWludCBicHA7CisJdW5zaWduZWQgaW50IGksIHRhcmdldF9tYnBzLCBt
cGNsazsKKwl1bnNpZ25lZCBsb25nIHBsbHJlZjsKKworCWJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zv
cm1hdF90b19icHAoZm9ybWF0KTsKKwlpZiAoYnBwIDwgMCkgeworCQlkZXZfZXJyKGRzaS0+ZGV2
LCAiZmFpbGVkIHRvIGdldCBicHAgZm9yIHBpeGVsIGZvcm1hdCAlZFxuIiwKKwkJCWZvcm1hdCk7
CisJCXJldHVybiBicHA7CisJfQorCisJcGxscmVmID0gY2xrX2dldF9yYXRlKGRzaS0+cGxscmVm
X2Nsayk7CisJaWYgKHBsbHJlZiAhPSAyNzAwMDAwMCkKKwkJZGV2X3dhcm4oZHNpLT5kZXYsICJl
eHBlY3QgMjdNSHogRFBIWSBwbGwgcmVmZXJlbmNlIGNsb2NrXG4iKTsKKworCW1wY2xrID0gRElW
X1JPVU5EX1VQKG1vZGUtPmNsb2NrLCBNU0VDX1BFUl9TRUMpOworCWlmIChtcGNsaykgeworCQkv
KiB0YWtlIDEvMC43IGJsYW5raW5nIG92ZXJoZWFkIGludG8gY29uc2lkZXJhdGlvbiAqLworCQl0
YXJnZXRfbWJwcyA9IChtcGNsayAqIChicHAgLyBsYW5lcykgKiAxMCkgLyA3OworCX0gZWxzZSB7
CisJCWRldl9kYmcoZHNpLT5kZXYsICJ1c2UgZGVmYXVsdCAxR2JwcyBEUEhZIHBsbCBjbG9ja1xu
Iik7CisJCXRhcmdldF9tYnBzID0gMTAwMDsKKwl9CisKKwlkZXZfZGJnKGRzaS0+ZGV2LCAidGFy
Z2V0IERQSFkgcGxsIGNsb2NrIGZyZXF1ZW5jeSBpcyAldU1icHNcbiIsCisJCXRhcmdldF9tYnBz
KTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRwdGRpbl9tYXApOyBpKyspIHsKKwkJ
aWYgKHRhcmdldF9tYnBzIDwgZHB0ZGluX21hcFtpXS5tYXhfbWJwcykgeworCQkJKmxhbmVfbWJw
cyA9IGRwdGRpbl9tYXBbaV0ubWF4X21icHM7CisJCQlkc2ktPmxhbmVfbWJwcyA9ICpsYW5lX21i
cHM7CisJCQlkZXZfZGJnKGRzaS0+ZGV2LAorCQkJCSJyZWFsIERQSFkgcGxsIGNsb2NrIGZyZXF1
ZW5jeSBpcyAldU1icHNcbiIsCisJCQkJKmxhbmVfbWJwcyk7CisJCQlyZXR1cm4gMDsKKwkJfQor
CX0KKworCWRldl9lcnIoZHNpLT5kZXYsICJEUEhZIGNsb2NrIGZyZXF1ZW5jeSAldU1icHMgaXMg
b3V0IG9mIHJhbmdlXG4iLAorCQl0YXJnZXRfbWJwcyk7CisKKwlyZXR1cm4gLUVJTlZBTDsKK30K
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBkd19taXBpX2RzaV9waHlfb3BzIGR3X21pcGlfZHNpX3N0
bV9waHlfb3BzID0geworCS5pbml0ID0gaW14X21pcGlfZHNpX3BoeV9pbml0LAorCS5nZXRfbGFu
ZV9tYnBzID0gaW14X21pcGlfZHNpX2dldF9sYW5lX21icHMsCit9OworCitzdGF0aWMgc3RydWN0
IGR3X21pcGlfZHNpX3BsYXRfZGF0YSBpbXg2cV9taXBpX2RzaV9kcnZfZGF0YSA9IHsKKwkubWF4
X2RhdGFfbGFuZXMgPSAyLAorCS5tb2RlX3ZhbGlkID0gaW14X21pcGlfZHNpX21vZGVfdmFsaWQs
CisJLnBoeV9vcHMgPSAmZHdfbWlwaV9kc2lfc3RtX3BoeV9vcHMsCit9OworCitzdGF0aWMgY29u
c3Qgc3RydWN0IG9mX2RldmljZV9pZCBpbXhfZHNpX2R0X2lkc1tdID0geworCXsKKwkJLmNvbXBh
dGlibGUgPSAiZnNsLGlteDZxLW1pcGktZHNpIiwKKwkJLmRhdGEgPSAmaW14NnFfbWlwaV9kc2lf
ZHJ2X2RhdGEsCisJfSwKKwl7IC8qIHNlbnRpbmVsICovIH0KK307CitNT0RVTEVfREVWSUNFX1RB
QkxFKG9mLCBpbXhfZHNpX2R0X2lkcyk7CisKK3N0YXRpYyBpbnQgaW14X21pcGlfZHNpX2JpbmQo
c3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsCisJCQkgICAgIHZvaWQg
KmRhdGEpCit7CisJc3RydWN0IGlteF9taXBpX2RzaSAqZHNpID0gZGV2X2dldF9kcnZkYXRhKGRl
dik7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IGRhdGE7CisJaW50IHJldDsKKworCXJldCA9
IGlteF9taXBpX2RzaV9yZWdpc3Rlcihkcm0sIGRzaSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCXJldCA9IGR3X21pcGlfZHNpX2JpbmQoZHNpLT5taXBpX2RzaSwgJmRzaS0+ZW5jb2Rl
cik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
dm9pZCBpbXhfbWlwaV9kc2lfdW5iaW5kKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmlj
ZSAqbWFzdGVyLAorCQkJCXZvaWQgKmRhdGEpCit7CisJc3RydWN0IGlteF9taXBpX2RzaSAqZHNp
ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlyZXR1cm4gZHdfbWlwaV9kc2lfdW5iaW5kKGRz
aS0+bWlwaV9kc2kpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGNvbXBvbmVudF9vcHMgaW14
X21pcGlfZHNpX29wcyA9IHsKKwkuYmluZAk9IGlteF9taXBpX2RzaV9iaW5kLAorCS51bmJpbmQJ
PSBpbXhfbWlwaV9kc2lfdW5iaW5kLAorfTsKKworc3RhdGljIGludCBpbXhfbWlwaV9kc2lfcHJv
YmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYg
PSAmcGRldi0+ZGV2OworCWNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgKm9mX2lkID0gb2ZfbWF0
Y2hfZGV2aWNlKGlteF9kc2lfZHRfaWRzLCBkZXYpOworCWNvbnN0IHN0cnVjdCBkd19taXBpX2Rz
aV9wbGF0X2RhdGEgKnBkYXRhID0gb2ZfaWQtPmRhdGE7CisJc3RydWN0IGlteF9taXBpX2RzaSAq
ZHNpOworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCXZvaWQgX19pb21lbSAqcmVnczsKKwlpbnQg
cmV0OworCisJZHNpID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9mKCpkc2kpLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIWRzaSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlkc2ktPmRldiA9IGRldjsKKwor
CXJlcyA9IHBsYXRmb3JtX2dldF9yZXNvdXJjZShwZGV2LCBJT1JFU09VUkNFX01FTSwgMCk7CisJ
aWYgKCFyZXMpCisJCXJldHVybiAtRU5PREVWOworCisJcmVncyA9IGRldm1faW9yZW1hcF9yZXNv
dXJjZShkZXYsIHJlcyk7CisJaWYgKElTX0VSUihyZWdzKSkgeworCQlyZXQgPSBQVFJfRVJSKHJl
Z3MpOworCQlkZXZfZGJnKGRldiwgIiVzOiBGYWlsZWQgdG8gbWFwIERTSSByZWdpc3RlcnM6ICVk
XG4iLAorCQkJX19mdW5jX18sIHJldCk7CisJCXJldHVybiAtRU5PREVWOworCX0KKworCWRzaS0+
cmVncyA9IGRldm1fcmVnbWFwX2luaXRfbW1pbyhkZXYsIHJlZ3MsICZpbXhfZHNpX3JlZ21hcF9j
b25maWcpOworCWlmIChJU19FUlIoZHNpLT5yZWdzKSkgeworCQlyZXQgPSBQVFJfRVJSKGRzaS0+
cmVncyk7CisJCWRldl9kYmcoZGV2LCAiJXM6IEZhaWxlZCB0byBjcmVhdGUgSU1YIERTSSByZWdt
YXA6ICVkLCAuXG4iLAorCQkJICAgICAgX19mdW5jX18sIHJldCk7CisJCXJldHVybiByZXQ7CisJ
fQorCisJZHNpLT5wbGxyZWZfY2xrID0gZGV2bV9jbGtfZ2V0KGRldiwgInJlZiIpOworCWlmIChJ
U19FUlIoZHNpLT5wbGxyZWZfY2xrKSkgeworCQlyZXQgPSBQVFJfRVJSKGRzaS0+cGxscmVmX2Ns
ayk7CisJCWRldl9kYmcoZGV2LCAiJXM6IFVuYWJsZSB0byBnZXQgcGxsIHJlZmVyZW5jZSBjbG9j
azogJWRcbiIsCisJCQlfX2Z1bmNfXywgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQg
PSBjbGtfcHJlcGFyZV9lbmFibGUoZHNpLT5wbGxyZWZfY2xrKTsKKwlpZiAocmV0KSB7CisJCWRl
dl9lcnIoZGV2LCAiJXM6IEZhaWxlZCB0byBlbmFibGUgcGxscmVmX2Nsa1xuIiwgX19mdW5jX18p
OworCQlyZXR1cm4gcmV0OworCX0KKworCWRzaS0+bXV4X3NlbCA9IHN5c2Nvbl9yZWdtYXBfbG9v
a3VwX2J5X3BoYW5kbGUoZGV2LT5vZl9ub2RlLCAiZ3ByIik7CisJaWYgKElTX0VSUihkc2ktPm11
eF9zZWwpKSB7CisJCXJldCA9IFBUUl9FUlIoZHNpLT5tdXhfc2VsKTsKKwkJZGV2X2VycihkZXYs
ICIlczogRmFpbGVkIHRvIGdldCBHUFIgcmVnbWFwOiAlZFxuIiwKKwkJCV9fZnVuY19fLCByZXQp
OworCQlyZXR1cm4gcmV0OworCX0KKworCWRldl9zZXRfZHJ2ZGF0YShkZXYsIGRzaSk7CisKKwlp
bXg2cV9taXBpX2RzaV9kcnZfZGF0YS5yZWdzID0gZHNpLT5yZWdzOworCWlteDZxX21pcGlfZHNp
X2Rydl9kYXRhLnZhcmlhbnQgPSAmaW14X2RzaV92YXJpYW50OworCWlteDZxX21pcGlfZHNpX2Ry
dl9kYXRhLnByaXZfZGF0YSA9IGRzaTsKKworCWRzaS0+bWlwaV9kc2kgPSBkd19taXBpX2RzaV9w
cm9iZShwZGV2LCBwZGF0YSk7CisJaWYgKElTX0VSUihkc2ktPm1pcGlfZHNpKSkgeworCQlyZXQg
PSBQVFJfRVJSKGRzaS0+bWlwaV9kc2kpOworCQlkZXZfZGJnKGRldiwgIiVzOiBVbmFibGUgdG8g
cHJvYmUgRFcgRFNJIGhvc3QgZGV2aWNlOiAlZFxuIiwKKwkJCV9fZnVuY19fLCByZXQpOworCQly
ZXR1cm4gLUVOT0RFVjsKKwl9CisKKwlyZXR1cm4gY29tcG9uZW50X2FkZCgmcGRldi0+ZGV2LCAm
aW14X21pcGlfZHNpX29wcyk7Cit9CisKK3N0YXRpYyBpbnQgaW14X21pcGlfZHNpX3JlbW92ZShz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCWNvbXBvbmVudF9kZWwoJnBkZXYtPmRl
diwgJmlteF9taXBpX2RzaV9vcHMpOworCXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IHBs
YXRmb3JtX2RyaXZlciBpbXhfbWlwaV9kc2lfZHJpdmVyID0geworCS5wcm9iZQkJPSBpbXhfbWlw
aV9kc2lfcHJvYmUsCisJLnJlbW92ZQkJPSBpbXhfbWlwaV9kc2lfcmVtb3ZlLAorCS5kcml2ZXIJ
CT0geworCQkub2ZfbWF0Y2hfdGFibGUgPSBpbXhfZHNpX2R0X2lkcywKKwkJLm5hbWUJPSBEUklW
RVJfTkFNRSwKKwl9LAorfTsKK21vZHVsZV9wbGF0Zm9ybV9kcml2ZXIoaW14X21pcGlfZHNpX2Ry
aXZlcik7CisKK01PRFVMRV9ERVNDUklQVElPTigiaS5NWCBNSVBJIERTSSBob3N0IGNvbnRyb2xs
ZXIgZHJpdmVyIik7CitNT0RVTEVfQVVUSE9SKCJMaXUgWWluZyA8WWluZy5MaXVAZnJlZXNjYWxl
LmNvbT4iKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsKK01PRFVMRV9BTElBUygicGxhdGZvcm06
IiBEUklWRVJfTkFNRSk7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
