Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A28DC596CD
	for <lists+dri-devel@lfdr.de>; Fri, 28 Jun 2019 11:03:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0F66F6E8AC;
	Fri, 28 Jun 2019 09:03:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 832D46E8A4;
 Fri, 28 Jun 2019 09:03:15 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 07C973082A28;
 Fri, 28 Jun 2019 09:03:15 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-96.ams2.redhat.com
 [10.36.116.96])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 5BDF85C706;
 Fri, 28 Jun 2019 09:03:13 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 1E5CA9D76; Fri, 28 Jun 2019 11:03:09 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 14/18] drm/amdgpu: switch driver from bo->resv to
 bo->base.resv
Date: Fri, 28 Jun 2019 11:02:59 +0200
Message-Id: <20190628090303.29467-15-kraxel@redhat.com>
In-Reply-To: <20190628090303.29467-1-kraxel@redhat.com>
References: <20190628090303.29467-1-kraxel@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Fri, 28 Jun 2019 09:03:15 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: thomas@shipmail.org, tzimmermann@suse.de, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Leo Li <sunpeng.li@amd.com>, Gerd Hoffmann <kraxel@redhat.com>,
 Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 bskeggs@redhat.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+ClJldmlld2Vk
LWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogLi4u
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgIDYgKystLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgICAgIHwgIDYgKystLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rpc3BsYXkuYyAgIHwgIDIgKy0KIGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgICB8ICAyICstCiBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMgICAgICAgfCAgNiArKy0tCiBkcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMgICAgICAgfCAgMiArLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X21uLmMgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyAgICB8IDIyICsrKysrKystLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgICAgICAgfCAgNiArKy0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMgICAgICAgfCAgNCArLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgICB8IDMwICsrKysrKysr
Ky0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMg
ICB8ICAyICstCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMg
fCAgMiArLQogMTMgZmlsZXMgY2hhbmdlZCwgNDUgaW5zZXJ0aW9ucygrKSwgNDcgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtm
ZF9ncHV2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2
bS5jCmluZGV4IGRmMjZiZjM0YjY3NS4uNmRjZTQzYmQ2MGYxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCkBAIC0yMTgsNyArMjE4LDcg
QEAgdm9pZCBhbWRncHVfYW1ka2ZkX3VucmVzZXJ2ZV9tZW1vcnlfbGltaXQoc3RydWN0IGFtZGdw
dV9ibyAqYm8pCiBzdGF0aWMgaW50IGFtZGdwdV9hbWRrZmRfcmVtb3ZlX2V2aWN0aW9uX2ZlbmNl
KHN0cnVjdCBhbWRncHVfYm8gKmJvLAogCQkJCQlzdHJ1Y3QgYW1kZ3B1X2FtZGtmZF9mZW5jZSAq
ZWYpCiB7Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8ucmVzdjsK
KwlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5iYXNlLnJlc3Y7CiAJ
c3RydWN0IHJlc2VydmF0aW9uX29iamVjdF9saXN0ICpvbGQsICpuZXc7CiAJdW5zaWduZWQgaW50
IGksIGosIGs7CiAKQEAgLTgxMiw3ICs4MTIsNyBAQCBzdGF0aWMgaW50IHByb2Nlc3Nfc3luY19w
ZHNfcmVzdihzdHJ1Y3QgYW1ka2ZkX3Byb2Nlc3NfaW5mbyAqcHJvY2Vzc19pbmZvLAogCQlzdHJ1
Y3QgYW1kZ3B1X2JvICpwZCA9IHBlZXJfdm0tPnJvb3QuYmFzZS5ibzsKIAogCQlyZXQgPSBhbWRn
cHVfc3luY19yZXN2KE5VTEwsCi0JCQkJCXN5bmMsIHBkLT50Ym8ucmVzdiwKKwkJCQkJc3luYywg
cGQtPnRiby5iYXNlLnJlc3YsCiAJCQkJCUFNREdQVV9GRU5DRV9PV05FUl9VTkRFRklORUQsIGZh
bHNlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CkBAIC04ODcsNyArODg3LDcgQEAgc3Rh
dGljIGludCBpbml0X2tmZF92bShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgdm9pZCAqKnByb2Nlc3Nf
aW5mbywKIAkJCQkgIEFNREdQVV9GRU5DRV9PV05FUl9LRkQsIGZhbHNlKTsKIAlpZiAocmV0KQog
CQlnb3RvIHdhaXRfcGRfZmFpbDsKLQlyZXQgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVzZXJ2ZV9z
aGFyZWQodm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YsIDEpOworCXJldCA9IHJlc2VydmF0aW9u
X29iamVjdF9yZXNlcnZlX3NoYXJlZCh2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2LCAx
KTsKIAlpZiAocmV0KQogCQlnb3RvIHJlc2VydmVfc2hhcmVkX2ZhaWw7CiAJYW1kZ3B1X2JvX2Zl
bmNlKHZtLT5yb290LmJhc2UuYm8sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5j
CmluZGV4IGRjNjM3MDdlNDI2Zi4uMTE4ZWM3NTE0Mjc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfY3MuYwpAQCAtNDAyLDcgKzQwMiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2Nz
X2JvX3ZhbGlkYXRlKHN0cnVjdCBhbWRncHVfY3NfcGFyc2VyICpwLAogCXN0cnVjdCB0dG1fb3Bl
cmF0aW9uX2N0eCBjdHggPSB7CiAJCS5pbnRlcnJ1cHRpYmxlID0gdHJ1ZSwKIAkJLm5vX3dhaXRf
Z3B1ID0gZmFsc2UsCi0JCS5yZXN2ID0gYm8tPnRiby5yZXN2LAorCQkucmVzdiA9IGJvLT50Ym8u
YmFzZS5yZXN2LAogCQkuZmxhZ3MgPSAwCiAJfTsKIAl1aW50MzJfdCBkb21haW47CkBAIC03MzQs
NyArNzM0LDcgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfc3luY19yaW5ncyhzdHJ1Y3QgYW1kZ3B1
X2NzX3BhcnNlciAqcCkKIAogCWxpc3RfZm9yX2VhY2hfZW50cnkoZSwgJnAtPnZhbGlkYXRlZCwg
dHYuaGVhZCkgewogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IHR0bV90b19hbWRncHVfYm8oZS0+
dHYuYm8pOwotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5yZXN2
OworCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5iYXNlLnJlc3Y7
CiAKIAkJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwgJnAtPmpvYi0+c3luYywgcmVzdiwg
cC0+ZmlscCwKIAkJCQkgICAgIGFtZGdwdV9ib19leHBsaWNpdF9zeW5jKGJvKSk7CkBAIC0xNzMy
LDcgKzE3MzIsNyBAQCBpbnQgYW1kZ3B1X2NzX2ZpbmRfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2Nz
X3BhcnNlciAqcGFyc2VyLAogCSptYXAgPSBtYXBwaW5nOwogCiAJLyogRG91YmxlIGNoZWNrIHRo
YXQgdGhlIEJPIGlzIHJlc2VydmVkIGJ5IHRoaXMgQ1MgKi8KLQlpZiAoUkVBRF9PTkNFKCgqYm8p
LT50Ym8ucmVzdi0+bG9jay5jdHgpICE9ICZwYXJzZXItPnRpY2tldCkKKwlpZiAoUkVBRF9PTkNF
KCgqYm8pLT50Ym8uYmFzZS5yZXN2LT5sb2NrLmN0eCkgIT0gJnBhcnNlci0+dGlja2V0KQogCQly
ZXR1cm4gLUVJTlZBTDsKIAogCWlmICghKCgqYm8pLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRF
X1ZSQU1fQ09OVElHVU9VUykpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZGlzcGxheS5jCmluZGV4IDUzNTY1MDk2N2IxYS4uYjVkMDIwZTE1YzM1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMKQEAgLTIwNCw3ICsyMDQsNyBAQCBp
bnQgYW1kZ3B1X2Rpc3BsYXlfY3J0Y19wYWdlX2ZsaXBfdGFyZ2V0KHN0cnVjdCBkcm1fY3J0YyAq
Y3J0YywKIAkJZ290byB1bnBpbjsKIAl9CiAKLQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9m
ZW5jZXNfcmN1KG5ld19hYm8tPnRiby5yZXN2LCAmd29yay0+ZXhjbCwKKwlyID0gcmVzZXJ2YXRp
b25fb2JqZWN0X2dldF9mZW5jZXNfcmN1KG5ld19hYm8tPnRiby5iYXNlLnJlc3YsICZ3b3JrLT5l
eGNsLAogCQkJCQkgICAgICAmd29yay0+c2hhcmVkX2NvdW50LAogCQkJCQkgICAgICAmd29yay0+
c2hhcmVkKTsKIAlpZiAodW5saWtlbHkociAhPSAwKSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKaW5kZXggNGVlNDUyZmUwNTI2Li41ZTNhMDgzMjUwMTcg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwpAQCAtMjE2
LDcgKzIxNiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RtYV9idWZfbWFwX2F0dGFjaChzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hX2J1ZiwKIAkJICogZmVuY2VzIG9uIHRoZSByZXNlcnZhdGlvbiBvYmplY3Qg
aW50byBhIHNpbmdsZSBleGNsdXNpdmUKIAkJICogZmVuY2UuCiAJCSAqLwotCQlyID0gX19yZXNl
cnZhdGlvbl9vYmplY3RfbWFrZV9leGNsdXNpdmUoYm8tPnRiby5yZXN2KTsKKwkJciA9IF9fcmVz
ZXJ2YXRpb25fb2JqZWN0X21ha2VfZXhjbHVzaXZlKGJvLT50Ym8uYmFzZS5yZXN2KTsKIAkJaWYg
KHIpCiAJCQlnb3RvIGVycm9yX3VucmVzZXJ2ZTsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfZ2VtLmMKaW5kZXggNmQ5OTFlOGRmMzU3Li5kMjZiY2ExZWZiOWQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nZW0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKQEAgLTEzNCw3ICsxMzQsNyBAQCBpbnQg
YW1kZ3B1X2dlbV9vYmplY3Rfb3BlbihzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKIAkJcmV0
dXJuIC1FUEVSTTsKIAogCWlmIChhYm8tPmZsYWdzICYgQU1ER1BVX0dFTV9DUkVBVEVfVk1fQUxX
QVlTX1ZBTElEICYmCi0JICAgIGFiby0+dGJvLnJlc3YgIT0gdm0tPnJvb3QuYmFzZS5iby0+dGJv
LnJlc3YpCisJICAgIGFiby0+dGJvLmJhc2UucmVzdiAhPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8u
YmFzZS5yZXN2KQogCQlyZXR1cm4gLUVQRVJNOwogCiAJciA9IGFtZGdwdV9ib19yZXNlcnZlKGFi
bywgZmFsc2UpOwpAQCAtMjUyLDcgKzI1Miw3IEBAIGludCBhbWRncHVfZ2VtX2NyZWF0ZV9pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlpZiAocikKIAkJCXJldHVy
biByOwogCi0JCXJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdjsKKwkJcmVzdiA9IHZt
LT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3Y7CiAJfQogCiAJciA9IGFtZGdwdV9nZW1fb2Jq
ZWN0X2NyZWF0ZShhZGV2LCBzaXplLCBhcmdzLT5pbi5hbGlnbm1lbnQsCkBAIC00MzQsNyArNDM0
LDcgQEAgaW50IGFtZGdwdV9nZW1fd2FpdF9pZGxlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJCXJldHVybiAtRU5PRU5UOwogCX0KIAlyb2JqID0gZ2VtX3RvX2Ft
ZGdwdV9ibyhnb2JqKTsKLQlyZXQgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3Jj
dShyb2JqLT50Ym8ucmVzdiwgdHJ1ZSwgdHJ1ZSwKKwlyZXQgPSByZXNlcnZhdGlvbl9vYmplY3Rf
d2FpdF90aW1lb3V0X3JjdShyb2JqLT50Ym8uYmFzZS5yZXN2LCB0cnVlLCB0cnVlLAogCQkJCQkJ
ICB0aW1lb3V0KTsKIAogCS8qIHJldCA9PSAwIG1lYW5zIG5vdCBzaWduYWxlZCwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwppbmRleCBhNzBlNWEzMjc0OWEuLjUxNDJhYTYz
NzdhMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwpAQCAtMTA4NCw3
ICsxMDg0LDcgQEAgdm9pZCBhbWRncHVfZHJpdmVyX3Bvc3RjbG9zZV9rbXMoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAlhbWRncHVfdm1fZmluaShhZGV2LCAmZnByaXYtPnZtKTsKIAogCWlmIChw
YXNpZCkKLQkJYW1kZ3B1X3Bhc2lkX2ZyZWVfZGVsYXllZChwZC0+dGJvLnJlc3YsIHBhc2lkKTsK
KwkJYW1kZ3B1X3Bhc2lkX2ZyZWVfZGVsYXllZChwZC0+dGJvLmJhc2UucmVzdiwgcGFzaWQpOwog
CWFtZGdwdV9ib191bnJlZigmcGQpOwogCiAJaWRyX2Zvcl9lYWNoX2VudHJ5KCZmcHJpdi0+Ym9f
bGlzdF9oYW5kbGVzLCBsaXN0LCBoYW5kbGUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfbW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9tbi5jCmluZGV4IDRmZjRjZjU5ODhlYS4uOWM3MjUzMWM4NDJjIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfbW4uYwpAQCAtMjE2LDcgKzIxNiw3IEBAIHN0YXRpYyB2b2lkIGFt
ZGdwdV9tbl9pbnZhbGlkYXRlX25vZGUoc3RydWN0IGFtZGdwdV9tbl9ub2RlICpub2RlLAogCQlp
ZiAoIWFtZGdwdV90dG1fdHRfYWZmZWN0X3VzZXJwdHIoYm8tPnRiby50dG0sIHN0YXJ0LCBlbmQp
KQogCQkJY29udGludWU7CiAKLQkJciA9IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRf
cmN1KGJvLT50Ym8ucmVzdiwKKwkJciA9IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRf
cmN1KGJvLT50Ym8uYmFzZS5yZXN2LAogCQkJdHJ1ZSwgZmFsc2UsIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKIAkJaWYgKHIgPD0gMCkKIAkJCURSTV9FUlJPUigiKCVsZCkgZmFpbGVkIHRvIHdhaXQg
Zm9yIHVzZXIgYm9cbiIsIHIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jCmluZGV4IGVkMmU4ODIwOGE3My4uZWMwZjY0MjA3MThmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCkBAIC01MDUsOCArNTA1LDYgQEAgc3RhdGlj
IGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCWlm
ICh1bmxpa2VseShyICE9IDApKQogCQlyZXR1cm4gcjsKIAotCWJvLT50Ym8uYmFzZS5yZXN2ID0g
Ym8tPnRiby5yZXN2OwotCiAJaWYgKCFhbWRncHVfZ21jX3ZyYW1fZnVsbF92aXNpYmxlKCZhZGV2
LT5nbWMpICYmCiAJICAgIGJvLT50Ym8ubWVtLm1lbV90eXBlID09IFRUTV9QTF9WUkFNICYmCiAJ
ICAgIGJvLT50Ym8ubWVtLnN0YXJ0IDwgYWRldi0+Z21jLnZpc2libGVfdnJhbV9zaXplID4+IFBB
R0VfU0hJRlQpCkBAIC01MTksNyArNTE3LDcgQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3Jl
YXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCSAgICBiby0+dGJvLm1lbS5wbGFjZW1l
bnQgJiBUVE1fUExfRkxBR19WUkFNKSB7CiAJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0J
CXIgPSBhbWRncHVfZmlsbF9idWZmZXIoYm8sIDAsIGJvLT50Ym8ucmVzdiwgJmZlbmNlKTsKKwkJ
ciA9IGFtZGdwdV9maWxsX2J1ZmZlcihibywgMCwgYm8tPnRiby5iYXNlLnJlc3YsICZmZW5jZSk7
CiAJCWlmICh1bmxpa2VseShyKSkKIAkJCWdvdG8gZmFpbF91bnJlc2VydmU7CiAKQEAgLTU0Miw3
ICs1NDAsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19jcmVhdGUoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCiAKIGZhaWxfdW5yZXNlcnZlOgogCWlmICghYnAtPnJlc3YpCi0JCXd3X211
dGV4X3VubG9jaygmYm8tPnRiby5yZXN2LT5sb2NrKTsKKwkJd3dfbXV0ZXhfdW5sb2NrKCZiby0+
dGJvLmJhc2UucmVzdi0+bG9jayk7CiAJYW1kZ3B1X2JvX3VucmVmKCZibyk7CiAJcmV0dXJuIHI7
CiB9CkBAIC01NjMsNyArNTYxLDcgQEAgc3RhdGljIGludCBhbWRncHVfYm9fY3JlYXRlX3NoYWRv
dyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlicC5mbGFncyA9IEFNREdQVV9HRU1fQ1JF
QVRFX0NQVV9HVFRfVVNXQyB8CiAJCUFNREdQVV9HRU1fQ1JFQVRFX1NIQURPVzsKIAlicC50eXBl
ID0gdHRtX2JvX3R5cGVfa2VybmVsOwotCWJwLnJlc3YgPSBiby0+dGJvLnJlc3Y7CisJYnAucmVz
diA9IGJvLT50Ym8uYmFzZS5yZXN2OwogCiAJciA9IGFtZGdwdV9ib19kb19jcmVhdGUoYWRldiwg
JmJwLCAmYm8tPnNoYWRvdyk7CiAJaWYgKCFyKSB7CkBAIC02MDQsMTMgKzYwMiwxMyBAQCBpbnQg
YW1kZ3B1X2JvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAogCWlmICgoZmxh
Z3MgJiBBTURHUFVfR0VNX0NSRUFURV9TSEFET1cpICYmICEoYWRldi0+ZmxhZ3MgJiBBTURfSVNf
QVBVKSkgewogCQlpZiAoIWJwLT5yZXN2KQotCQkJV0FSTl9PTihyZXNlcnZhdGlvbl9vYmplY3Rf
bG9jaygoKmJvX3B0ciktPnRiby5yZXN2LAorCQkJV0FSTl9PTihyZXNlcnZhdGlvbl9vYmplY3Rf
bG9jaygoKmJvX3B0ciktPnRiby5iYXNlLnJlc3YsCiAJCQkJCQkJTlVMTCkpOwogCiAJCXIgPSBh
bWRncHVfYm9fY3JlYXRlX3NoYWRvdyhhZGV2LCBicC0+c2l6ZSwgKmJvX3B0cik7CiAKIAkJaWYg
KCFicC0+cmVzdikKLQkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soKCpib19wdHIpLT50Ym8u
cmVzdik7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKCgqYm9fcHRyKS0+dGJvLmJhc2Uu
cmVzdik7CiAKIAkJaWYgKHIpCiAJCQlhbWRncHVfYm9fdW5yZWYoYm9fcHRyKTsKQEAgLTcwNyw3
ICs3MDUsNyBAQCBpbnQgYW1kZ3B1X2JvX2ttYXAoc3RydWN0IGFtZGdwdV9ibyAqYm8sIHZvaWQg
KipwdHIpCiAJCXJldHVybiAwOwogCX0KIAotCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90
aW1lb3V0X3JjdShiby0+dGJvLnJlc3YsIGZhbHNlLCBmYWxzZSwKKwlyID0gcmVzZXJ2YXRpb25f
b2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYm8tPnRiby5iYXNlLnJlc3YsIGZhbHNlLCBmYWxzZSwK
IAkJCQkJCU1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAociA8IDApCiAJCXJldHVybiByOwpA
QCAtMTA4NCw3ICsxMDgyLDcgQEAgaW50IGFtZGdwdV9ib19zZXRfdGlsaW5nX2ZsYWdzKHN0cnVj
dCBhbWRncHVfYm8gKmJvLCB1NjQgdGlsaW5nX2ZsYWdzKQogICovCiB2b2lkIGFtZGdwdV9ib19n
ZXRfdGlsaW5nX2ZsYWdzKHN0cnVjdCBhbWRncHVfYm8gKmJvLCB1NjQgKnRpbGluZ19mbGFncykK
IHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLnJlc3YtPmxvY2suYmFzZSk7CisJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5iYXNlLnJlc3YtPmxvY2suYmFzZSk7CiAKIAlpZiAo
dGlsaW5nX2ZsYWdzKQogCQkqdGlsaW5nX2ZsYWdzID0gYm8tPnRpbGluZ19mbGFnczsKQEAgLTEy
ODAsNyArMTI3OCw3IEBAIGludCBhbWRncHVfYm9fZmF1bHRfcmVzZXJ2ZV9ub3RpZnkoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIHZvaWQgYW1kZ3B1X2JvX2ZlbmNlKHN0cnVjdCBhbWRn
cHVfYm8gKmJvLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwKIAkJICAgICBib29sIHNoYXJlZCkK
IHsKLQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5yZXN2OworCXN0
cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKIAogCWlm
IChzaGFyZWQpCiAJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfc2hhcmVkX2ZlbmNlKHJlc3YsIGZl
bmNlKTsKQEAgLTEzMDUsNyArMTMwMyw3IEBAIGludCBhbWRncHVfYm9fc3luY193YWl0KHN0cnVj
dCBhbWRncHVfYm8gKmJvLCB2b2lkICpvd25lciwgYm9vbCBpbnRyKQogCWludCByOwogCiAJYW1k
Z3B1X3N5bmNfY3JlYXRlKCZzeW5jKTsKLQlhbWRncHVfc3luY19yZXN2KGFkZXYsICZzeW5jLCBi
by0+dGJvLnJlc3YsIG93bmVyLCBmYWxzZSk7CisJYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAmc3lu
YywgYm8tPnRiby5iYXNlLnJlc3YsIG93bmVyLCBmYWxzZSk7CiAJciA9IGFtZGdwdV9zeW5jX3dh
aXQoJnN5bmMsIGludHIpOwogCWFtZGdwdV9zeW5jX2ZyZWUoJnN5bmMpOwogCkBAIC0xMzI1LDcg
KzEzMjMsNyBAQCBpbnQgYW1kZ3B1X2JvX3N5bmNfd2FpdChzdHJ1Y3QgYW1kZ3B1X2JvICpibywg
dm9pZCAqb3duZXIsIGJvb2wgaW50cikKIHU2NCBhbWRncHVfYm9fZ3B1X29mZnNldChzdHJ1Y3Qg
YW1kZ3B1X2JvICpibykKIHsKIAlXQVJOX09OX09OQ0UoYm8tPnRiby5tZW0ubWVtX3R5cGUgPT0g
VFRNX1BMX1NZU1RFTSk7Ci0JV0FSTl9PTl9PTkNFKCF3d19tdXRleF9pc19sb2NrZWQoJmJvLT50
Ym8ucmVzdi0+bG9jaykgJiYKKwlXQVJOX09OX09OQ0UoIXd3X211dGV4X2lzX2xvY2tlZCgmYm8t
PnRiby5iYXNlLnJlc3YtPmxvY2spICYmCiAJCSAgICAgIWJvLT5waW5fY291bnQgJiYgYm8tPnRi
by50eXBlICE9IHR0bV9ib190eXBlX2tlcm5lbCk7CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVt
LnN0YXJ0ID09IEFNREdQVV9CT19JTlZBTElEX09GRlNFVCk7CiAJV0FSTl9PTl9PTkNFKGJvLT50
Ym8ubWVtLm1lbV90eXBlID09IFRUTV9QTF9WUkFNICYmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfdHRtLmMKaW5kZXggYjhhZTlhODM4YjZjLi5iOTAzYTM4MmI2YjYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAgLTQzOCw3ICs0MzgsNyBAQCBzdGF0
aWMgaW50IGFtZGdwdV9tb3ZlX2JsaXQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAog
CXIgPSBhbWRncHVfdHRtX2NvcHlfbWVtX3RvX21lbShhZGV2LCAmc3JjLCAmZHN0LAogCQkJCSAg
ICAgICBuZXdfbWVtLT5udW1fcGFnZXMgPDwgUEFHRV9TSElGVCwKLQkJCQkgICAgICAgYm8tPnJl
c3YsICZmZW5jZSk7CisJCQkJICAgICAgIGJvLT5iYXNlLnJlc3YsICZmZW5jZSk7CiAJaWYgKHIp
CiAJCWdvdG8gZXJyb3I7CiAKQEAgLTE0NTAsMTQgKzE0NTAsMTQgQEAgc3RhdGljIGJvb2wgYW1k
Z3B1X3R0bV9ib19ldmljdGlvbl92YWx1YWJsZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
LAogCSAqIGNsZWFubHkgaGFuZGxlIHBhZ2UgZmF1bHRzLgogCSAqLwogCWlmIChiby0+dHlwZSA9
PSB0dG1fYm9fdHlwZV9rZXJuZWwgJiYKLQkgICAgIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3Np
Z25hbGVkX3JjdShiby0+cmVzdiwgdHJ1ZSkpCisJICAgICFyZXNlcnZhdGlvbl9vYmplY3RfdGVz
dF9zaWduYWxlZF9yY3UoYm8tPmJhc2UucmVzdiwgdHJ1ZSkpCiAJCXJldHVybiBmYWxzZTsKIAog
CS8qIElmIGJvIGlzIGEgS0ZEIEJPLCBjaGVjayBpZiB0aGUgYm8gYmVsb25ncyB0byB0aGUgY3Vy
cmVudCBwcm9jZXNzLgogCSAqIElmIHRydWUsIHRoZW4gcmV0dXJuIGZhbHNlIGFzIGFueSBLRkQg
cHJvY2VzcyBuZWVkcyBhbGwgaXRzIEJPcyB0bwogCSAqIGJlIHJlc2lkZW50IHRvIHJ1biBzdWNj
ZXNzZnVsbHkKIAkgKi8KLQlmbGlzdCA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfbGlzdChiby0+
cmVzdik7CisJZmxpc3QgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2xpc3QoYm8tPmJhc2UucmVz
dik7CiAJaWYgKGZsaXN0KSB7CiAJCWZvciAoaSA9IDA7IGkgPCBmbGlzdC0+c2hhcmVkX2NvdW50
OyArK2kpIHsKIAkJCWYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGZsaXN0LT5zaGFyZWRb
aV0sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMKaW5kZXggNWIyZmVhM2I0
YTJjLi5mODU4NjA3YjE3YTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV91dmQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZk
LmMKQEAgLTEwNzMsNyArMTA3Myw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21zZyhz
dHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLAogCWliLT5sZW5n
dGhfZHcgPSAxNjsKIAogCWlmIChkaXJlY3QpIHsKLQkJciA9IHJlc2VydmF0aW9uX29iamVjdF93
YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8ucmVzdiwKKwkJciA9IHJlc2VydmF0aW9uX29iamVjdF93
YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8uYmFzZS5yZXN2LAogCQkJCQkJCXRydWUsIGZhbHNlLAog
CQkJCQkJCW1zZWNzX3RvX2ppZmZpZXMoMTApKTsKIAkJaWYgKHIgPT0gMCkKQEAgLTEwODUsNyAr
MTA4NSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3Jp
bmcgKnJpbmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLAogCQlpZiAocikKIAkJCWdvdG8gZXJyX2Zy
ZWU7CiAJfSBlbHNlIHsKLQkJciA9IGFtZGdwdV9zeW5jX3Jlc3YoYWRldiwgJmpvYi0+c3luYywg
Ym8tPnRiby5yZXN2LAorCQlyID0gYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAmam9iLT5zeW5jLCBi
by0+dGJvLmJhc2UucmVzdiwKIAkJCQkgICAgIEFNREdQVV9GRU5DRV9PV05FUl9VTkRFRklORUQs
IGZhbHNlKTsKIAkJaWYgKHIpCiAJCQlnb3RvIGVycl9mcmVlOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfdm0uYwppbmRleCBlNDRmOWRkMjAyZTguLjRjODZiOWNkMTUzMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKQEAgLTMwMiw3ICszMDIsNyBAQCBzdGF0
aWMgdm9pZCBhbWRncHVfdm1fYm9fYmFzZV9pbml0KHN0cnVjdCBhbWRncHVfdm1fYm9fYmFzZSAq
YmFzZSwKIAliYXNlLT5uZXh0ID0gYm8tPnZtX2JvOwogCWJvLT52bV9ibyA9IGJhc2U7CiAKLQlp
ZiAoYm8tPnRiby5yZXN2ICE9IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KQorCWlmIChiby0+
dGJvLmJhc2UucmVzdiAhPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQlyZXR1
cm47CiAKIAl2bS0+YnVsa19tb3ZlYWJsZSA9IGZhbHNlOwpAQCAtNTgzLDcgKzU4Myw3IEBAIHZv
aWQgYW1kZ3B1X3ZtX2RlbF9mcm9tX2xydV9ub3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0
ICpibykKIAlmb3IgKGJvX2Jhc2UgPSBhYm8tPnZtX2JvOyBib19iYXNlOyBib19iYXNlID0gYm9f
YmFzZS0+bmV4dCkgewogCQlzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSA9IGJvX2Jhc2UtPnZtOwogCi0J
CWlmIChhYm8tPnRiby5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KQorCQlpZiAo
YWJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJ
CQl2bS0+YnVsa19tb3ZlYWJsZSA9IGZhbHNlOwogCX0KIApAQCAtODM0LDcgKzgzNCw3IEBAIHN0
YXRpYyB2b2lkIGFtZGdwdV92bV9ib19wYXJhbShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwg
c3RydWN0IGFtZGdwdV92bSAqdm0sCiAJCWJwLT5mbGFncyB8PSBBTURHUFVfR0VNX0NSRUFURV9T
SEFET1c7CiAJYnAtPnR5cGUgPSB0dG1fYm9fdHlwZV9rZXJuZWw7CiAJaWYgKHZtLT5yb290LmJh
c2UuYm8pCi0JCWJwLT5yZXN2ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3Y7CisJCWJwLT5y
ZXN2ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdjsKIH0KIAogLyoqCkBAIC0xNjky
LDcgKzE2OTIsNyBAQCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKIAkJCXR0bSA9IGNvbnRhaW5lcl9vZihiby0+dGJvLnR0bSwgc3RydWN0IHR0bV9k
bWFfdHQsIHR0bSk7CiAJCQlwYWdlc19hZGRyID0gdHRtLT5kbWFfYWRkcmVzczsKIAkJfQotCQll
eGNsdXNpdmUgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2woYm8tPnRiby5yZXN2KTsKKwkJ
ZXhjbHVzaXZlID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsKGJvLT50Ym8uYmFzZS5yZXN2
KTsKIAl9CiAKIAlpZiAoYm8pIHsKQEAgLTE3MDIsNyArMTcwMiw3IEBAIGludCBhbWRncHVfdm1f
Ym9fdXBkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQlmbGFncyA9IDB4MDsKIAl9
CiAKLQlpZiAoY2xlYXIgfHwgKGJvICYmIGJvLT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJv
LT50Ym8ucmVzdikpCisJaWYgKGNsZWFyIHx8IChibyAmJiBiby0+dGJvLmJhc2UucmVzdiA9PSB2
bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KSkKIAkJbGFzdF91cGRhdGUgPSAmdm0tPmxh
c3RfdXBkYXRlOwogCWVsc2UKIAkJbGFzdF91cGRhdGUgPSAmYm9fdmEtPmxhc3RfcHRfdXBkYXRl
OwpAQCAtMTczMyw3ICsxNzMzLDcgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGUoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsCiAJICogdGhlIGV2aWN0ZWQgbGlzdCBzbyB0aGF0IGl0IGdldHMg
dmFsaWRhdGVkIGFnYWluIG9uIHRoZQogCSAqIG5leHQgY29tbWFuZCBzdWJtaXNzaW9uLgogCSAq
LwotCWlmIChibyAmJiBiby0+dGJvLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3Yp
IHsKKwlpZiAoYm8gJiYgYm8tPnRiby5iYXNlLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJv
LmJhc2UucmVzdikgewogCQl1aW50MzJfdCBtZW1fdHlwZSA9IGJvLT50Ym8ubWVtLm1lbV90eXBl
OwogCiAJCWlmICghKGJvLT5wcmVmZXJyZWRfZG9tYWlucyAmIGFtZGdwdV9tZW1fdHlwZV90b19k
b21haW4obWVtX3R5cGUpKSkKQEAgLTE4NjksNyArMTg2OSw3IEBAIHN0YXRpYyB2b2lkIGFtZGdw
dV92bV9mcmVlX21hcHBpbmcoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAgKi8KIHN0YXRp
YyB2b2lkIGFtZGdwdV92bV9wcnRfZmluaShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3Ry
dWN0IGFtZGdwdV92bSAqdm0pCiB7Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9
IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2OworCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3Qg
KnJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2OwogCXN0cnVjdCBkbWFfZmVu
Y2UgKmV4Y2wsICoqc2hhcmVkOwogCXVuc2lnbmVkIGksIHNoYXJlZF9jb3VudDsKIAlpbnQgcjsK
QEAgLTE5ODMsNyArMTk4Myw3IEBAIGludCBhbWRncHVfdm1faGFuZGxlX21vdmVkKHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2LAogCXdoaWxlICghbGlzdF9lbXB0eSgmdm0tPmludmFsaWRhdGVk
KSkgewogCQlib192YSA9IGxpc3RfZmlyc3RfZW50cnkoJnZtLT5pbnZhbGlkYXRlZCwgc3RydWN0
IGFtZGdwdV9ib192YSwKIAkJCQkJIGJhc2Uudm1fc3RhdHVzKTsKLQkJcmVzdiA9IGJvX3ZhLT5i
YXNlLmJvLT50Ym8ucmVzdjsKKwkJcmVzdiA9IGJvX3ZhLT5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2
OwogCQlzcGluX3VubG9jaygmdm0tPmludmFsaWRhdGVkX2xvY2spOwogCiAJCS8qIFRyeSB0byBy
ZXNlcnZlIHRoZSBCTyB0byBhdm9pZCBjbGVhcmluZyBpdHMgcHRlcyAqLwpAQCAtMjA3NCw3ICsy
MDc0LDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3ZtX2JvX2luc2VydF9tYXAoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJaWYgKG1hcHBpbmctPmZsYWdzICYgQU1ER1BVX1BURV9QUlQpCiAJ
CWFtZGdwdV92bV9wcnRfZ2V0KGFkZXYpOwogCi0JaWYgKGJvICYmIGJvLT50Ym8ucmVzdiA9PSB2
bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdiAmJgorCWlmIChibyAmJiBiby0+dGJvLmJhc2UucmVz
diA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2ICYmCiAJICAgICFib192YS0+YmFz
ZS5tb3ZlZCkgewogCQlsaXN0X21vdmUoJmJvX3ZhLT5iYXNlLnZtX3N0YXR1cywgJnZtLT5tb3Zl
ZCk7CiAJfQpAQCAtMjQwNiw3ICsyNDA2LDcgQEAgdm9pZCBhbWRncHVfdm1fYm9fdHJhY2VfY3Mo
c3RydWN0IGFtZGdwdV92bSAqdm0sIHN0cnVjdCB3d19hY3F1aXJlX2N0eCAqdGlja2V0KQogCQkJ
c3RydWN0IGFtZGdwdV9ibyAqYm87CiAKIAkJCWJvID0gbWFwcGluZy0+Ym9fdmEtPmJhc2UuYm87
Ci0JCQlpZiAoUkVBRF9PTkNFKGJvLT50Ym8ucmVzdi0+bG9jay5jdHgpICE9IHRpY2tldCkKKwkJ
CWlmIChSRUFEX09OQ0UoYm8tPnRiby5iYXNlLnJlc3YtPmxvY2suY3R4KSAhPSB0aWNrZXQpCiAJ
CQkJY29udGludWU7CiAJCX0KIApAQCAtMjQzMyw3ICsyNDMzLDcgQEAgdm9pZCBhbWRncHVfdm1f
Ym9fcm12KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCXN0cnVjdCBhbWRncHVfdm1fYm9f
YmFzZSAqKmJhc2U7CiAKIAlpZiAoYm8pIHsKLQkJaWYgKGJvLT50Ym8ucmVzdiA9PSB2bS0+cm9v
dC5iYXNlLmJvLT50Ym8ucmVzdikKKwkJaWYgKGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290
LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJCQl2bS0+YnVsa19tb3ZlYWJsZSA9IGZhbHNlOwog
CiAJCWZvciAoYmFzZSA9ICZib192YS0+YmFzZS5iby0+dm1fYm87ICpiYXNlOwpAQCAtMjQ5Nyw3
ICsyNDk3LDcgQEAgdm9pZCBhbWRncHVfdm1fYm9faW52YWxpZGF0ZShzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiwKIAlmb3IgKGJvX2Jhc2UgPSBiby0+dm1fYm87IGJvX2Jhc2U7IGJvX2Jhc2Ug
PSBib19iYXNlLT5uZXh0KSB7CiAJCXN0cnVjdCBhbWRncHVfdm0gKnZtID0gYm9fYmFzZS0+dm07
CiAKLQkJaWYgKGV2aWN0ZWQgJiYgYm8tPnRiby5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRi
by5yZXN2KSB7CisJCWlmIChldmljdGVkICYmIGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290
LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpIHsKIAkJCWFtZGdwdV92bV9ib19ldmljdGVkKGJvX2Jh
c2UpOwogCQkJY29udGludWU7CiAJCX0KQEAgLTI1MDgsNyArMjUwOCw3IEBAIHZvaWQgYW1kZ3B1
X3ZtX2JvX2ludmFsaWRhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAkJaWYgKGJv
LT50Ym8udHlwZSA9PSB0dG1fYm9fdHlwZV9rZXJuZWwpCiAJCQlhbWRncHVfdm1fYm9fcmVsb2Nh
dGVkKGJvX2Jhc2UpOwotCQllbHNlIGlmIChiby0+dGJvLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5i
by0+dGJvLnJlc3YpCisJCWVsc2UgaWYgKGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290LmJh
c2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJCQlhbWRncHVfdm1fYm9fbW92ZWQoYm9fYmFzZSk7CiAJ
CWVsc2UKIAkJCWFtZGdwdV92bV9ib19pbnZhbGlkYXRlZChib19iYXNlKTsKQEAgLTI2MzgsNyAr
MjYzOCw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2FkanVzdF9zaXplKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCB1aW50MzJfdCBtaW5fdm1fc2l6ZSwKICAqLwogbG9uZyBhbWRncHVfdm1fd2FpdF9p
ZGxlKHN0cnVjdCBhbWRncHVfdm0gKnZtLCBsb25nIHRpbWVvdXQpCiB7Ci0JcmV0dXJuIHJlc2Vy
dmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2
LAorCXJldHVybiByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdSh2bS0+cm9vdC5i
YXNlLmJvLT50Ym8uYmFzZS5yZXN2LAogCQkJCQkJICAgdHJ1ZSwgdHJ1ZSwgdGltZW91dCk7CiB9
CiAKQEAgLTI3MTMsNyArMjcxMyw3IEBAIGludCBhbWRncHVfdm1faW5pdChzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAqdm0sCiAJaWYgKHIpCiAJCWdvdG8gZXJy
b3JfZnJlZV9yb290OwogCi0JciA9IHJlc2VydmF0aW9uX29iamVjdF9yZXNlcnZlX3NoYXJlZChy
b290LT50Ym8ucmVzdiwgMSk7CisJciA9IHJlc2VydmF0aW9uX29iamVjdF9yZXNlcnZlX3NoYXJl
ZChyb290LT50Ym8uYmFzZS5yZXN2LCAxKTsKIAlpZiAocikKIAkJZ290byBlcnJvcl91bnJlc2Vy
dmU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9z
ZG1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCmluZGV4
IGRkZDE4MWY1ZWQzNy4uNjFmYzU4NGNiYjFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV92bV9zZG1hLmMKQEAgLTcyLDcgKzcyLDcgQEAgc3RhdGljIGludCBhbWRncHVf
dm1fc2RtYV9wcmVwYXJlKHN0cnVjdCBhbWRncHVfdm1fdXBkYXRlX3BhcmFtcyAqcCwKIAlpZiAo
cikKIAkJcmV0dXJuIHI7CiAKLQlyID0gYW1kZ3B1X3N5bmNfcmVzdihwLT5hZGV2LCAmcC0+am9i
LT5zeW5jLCByb290LT50Ym8ucmVzdiwKKwlyID0gYW1kZ3B1X3N5bmNfcmVzdihwLT5hZGV2LCAm
cC0+am9iLT5zeW5jLCByb290LT50Ym8uYmFzZS5yZXN2LAogCQkJICAgICBvd25lciwgZmFsc2Up
OwogCWlmIChyKQogCQlyZXR1cm4gcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQv
ZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3Bs
YXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4IGIxNmM2NTgwNzRkMi4uYTFmODZhMmRmZGYz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdw
dV9kbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1
X2RtLmMKQEAgLTU1MDksNyArNTUwOSw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kbV9jb21taXRf
cGxhbmVzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJICogZGVhZGxvY2sgZHVy
aW5nIEdQVSByZXNldCB3aGVuIHRoaXMgZmVuY2Ugd2lsbCBub3Qgc2lnbmFsCiAJCSAqIGJ1dCB3
ZSBob2xkIHJlc2VydmF0aW9uIGxvY2sgZm9yIHRoZSBCTy4KIAkJICovCi0JCXIgPSByZXNlcnZh
dGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShhYm8tPnRiby5yZXN2LCB0cnVlLAorCQlyID0g
cmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYWJvLT50Ym8uYmFzZS5yZXN2LCB0
cnVlLAogCQkJCQkJCWZhbHNlLAogCQkJCQkJCW1zZWNzX3RvX2ppZmZpZXMoNTAwMCkpOwogCQlp
ZiAodW5saWtlbHkociA8PSAwKSkKLS0gCjIuMTguMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
