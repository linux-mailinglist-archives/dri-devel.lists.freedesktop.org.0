Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 566799A54F
	for <lists+dri-devel@lfdr.de>; Fri, 23 Aug 2019 04:12:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 813706EBA6;
	Fri, 23 Aug 2019 02:12:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-oi1-f193.google.com (mail-oi1-f193.google.com
 [209.85.167.193])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABA5D6EBA5
 for <dri-devel@lists.freedesktop.org>; Fri, 23 Aug 2019 02:12:26 +0000 (UTC)
Received: by mail-oi1-f193.google.com with SMTP id l2so5938529oil.0
 for <dri-devel@lists.freedesktop.org>; Thu, 22 Aug 2019 19:12:26 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=PierwHszPjoIfoYM+aQ/lMW44n7AHzmYyHh9ldDk9CQ=;
 b=j6AhVDUU+lX/mtw7ztV+RZDv/8GW+r61x+U0zETNHFVPlLjzVsbMJnKvn3wHDeigFt
 5g0xHM+ho64Pez28bVZ2BMdBw0G99D7m44hR+vD719YgSa4cbf5puYwg43lt5ys9hurX
 kHeAHCyieN07HI2HsUoGzblM7kfclnJSfk0axuqiIT0rwQa2TK6xDUINtsygVNwDkPD5
 ph23RGpnUkSriq15sJsTjX0GV8Pr+iOaMADNZNVavPLt7jS0xfGQXArGnQSyOZqI8dji
 wFkHTW1d333GoiDVZQK3I2ZqcM61kXTdLRYGUD9AgKdHBu18KwYv3YCBUeW9P+Bw/9f6
 egbA==
X-Gm-Message-State: APjAAAVx6NxO0fRu82+bN8UvHuPcOXHdjtSktf5oHKh/Z3Xh3zCYCJfL
 NGMU0ikyL3kdx21N3nx6kJcKJSE=
X-Google-Smtp-Source: APXvYqw3YEBYRdfflKTmtg/INQ3ZJXbiNtq9DdJpK4CNkmka0js8CFemzQH4l69YwUwKJSU9sIfYIQ==
X-Received: by 2002:aca:61c5:: with SMTP id v188mr1576196oib.34.1566526344892; 
 Thu, 22 Aug 2019 19:12:24 -0700 (PDT)
Received: from xps15.herring.priv (24-155-109-49.dyn.grandenetworks.net.
 [24.155.109.49])
 by smtp.googlemail.com with ESMTPSA id c1sm457747oic.31.2019.08.22.19.12.23
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 22 Aug 2019 19:12:24 -0700 (PDT)
From: Rob Herring <robh@kernel.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 5/8] drm/shmem: Use mutex_trylock in drm_gem_shmem_purge
Date: Thu, 22 Aug 2019 21:12:13 -0500
Message-Id: <20190823021216.5862-6-robh@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190823021216.5862-1-robh@kernel.org>
References: <20190823021216.5862-1-robh@kernel.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Tomeu Vizoso <tomeu.vizoso@collabora.com>, David Airlie <airlied@linux.ie>,
 Sean Paul <sean@poorly.run>, Steven Price <steven.price@arm.com>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Robin Murphy <robin.murphy@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TG9ja2RlcCByZXBvcnRzIGEgY2lyY3VsYXIgbG9ja2luZyBkZXBlbmRlbmN5IHdpdGggcGFnZXNf
bG9jayB0YWtlbiBpbgp0aGUgc2hyaW5rZXIgY2FsbGJhY2suIFRoZSBkZWFkbG9jayBjYW4ndCBh
Y3R1YWxseSBoYXBwZW4gd2l0aCBjdXJyZW50CnVzZXJzIGF0IGxlYXN0IGFzIGEgQk8gd2lsbCBu
ZXZlciBiZSBwdXJnZWFibGUgd2hlbiBwYWdlc19sb2NrIGlzIGhlbGQuClRvIGJlIHNhZmUsIGxl
dCdzIHVzZSBtdXRleF90cnlsb2NrKCkgaW5zdGVhZCBhbmQgYmFpbCBpZiBhIEJPIGlzIGxvY2tl
ZAphbHJlYWR5LgoKV0FSTklORzogcG9zc2libGUgY2lyY3VsYXIgbG9ja2luZyBkZXBlbmRlbmN5
IGRldGVjdGVkCjUuMy4wLXJjMSsgIzEwMCBUYWludGVkOiBHICAgICAgICAgICAgIEwKLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmtzd2FwZDAv
MTcxIGlzIHRyeWluZyB0byBhY3F1aXJlIGxvY2s6CjAwMDAwMDAwOWI5ODIzZmQgKCZzaG1lbS0+
cGFnZXNfbG9jayl7Ky4rLn0sIGF0OiBkcm1fZ2VtX3NobWVtX3B1cmdlKzB4MjAvMHg0MAoKYnV0
IHRhc2sgaXMgYWxyZWFkeSBob2xkaW5nIGxvY2s6CjAwMDAwMDAwZjgyMzY5YjYgKGZzX3JlY2xh
aW0peysuKy59LCBhdDogX19mc19yZWNsYWltX2FjcXVpcmUrMHgwLzB4NDAKCndoaWNoIGxvY2sg
YWxyZWFkeSBkZXBlbmRzIG9uIHRoZSBuZXcgbG9jay4KCnRoZSBleGlzdGluZyBkZXBlbmRlbmN5
IGNoYWluIChpbiByZXZlcnNlIG9yZGVyKSBpczoKCi0+ICMxIChmc19yZWNsYWltKXsrLisufToK
ICAgICAgIGZzX3JlY2xhaW1fYWNxdWlyZS5wYXJ0LjE4KzB4MzQvMHg0MAogICAgICAgZnNfcmVj
bGFpbV9hY3F1aXJlKzB4MjAvMHgyOAogICAgICAgX19rbWFsbG9jX25vZGUrMHg2Yy8weDRjMAog
ICAgICAga3ZtYWxsb2Nfbm9kZSsweDM4LzB4YTgKICAgICAgIGRybV9nZW1fZ2V0X3BhZ2VzKzB4
ODAvMHgxZDAKICAgICAgIGRybV9nZW1fc2htZW1fZ2V0X3BhZ2VzKzB4NTgvMHhhMAogICAgICAg
ZHJtX2dlbV9zaG1lbV9nZXRfcGFnZXNfc2d0KzB4NDgvMHhkMAogICAgICAgcGFuZnJvc3RfbW11
X21hcCsweDM4LzB4ZjggW3BhbmZyb3N0XQogICAgICAgcGFuZnJvc3RfZ2VtX29wZW4rMHhjMC8w
eGU4IFtwYW5mcm9zdF0KICAgICAgIGRybV9nZW1faGFuZGxlX2NyZWF0ZV90YWlsKzB4ZTgvMHgx
OTgKICAgICAgIGRybV9nZW1faGFuZGxlX2NyZWF0ZSsweDNjLzB4NTAKICAgICAgIHBhbmZyb3N0
X2dlbV9jcmVhdGVfd2l0aF9oYW5kbGUrMHg3MC8weGEwIFtwYW5mcm9zdF0KICAgICAgIHBhbmZy
b3N0X2lvY3RsX2NyZWF0ZV9ibysweDQ4LzB4ODAgW3BhbmZyb3N0XQogICAgICAgZHJtX2lvY3Rs
X2tlcm5lbCsweGI4LzB4MTEwCiAgICAgICBkcm1faW9jdGwrMHgyNDQvMHgzZjAKICAgICAgIGRv
X3Zmc19pb2N0bCsweGJjLzB4OTEwCiAgICAgICBrc3lzX2lvY3RsKzB4NzgvMHhhOAogICAgICAg
X19hcm02NF9zeXNfaW9jdGwrMHgxYy8weDI4CiAgICAgICBlbDBfc3ZjX2NvbW1vbi5jb25zdHBy
b3AuMCsweDkwLzB4MTY4CiAgICAgICBlbDBfc3ZjX2hhbmRsZXIrMHgyOC8weDc4CiAgICAgICBl
bDBfc3ZjKzB4OC8weGMKCi0+ICMwICgmc2htZW0tPnBhZ2VzX2xvY2speysuKy59OgogICAgICAg
X19sb2NrX2FjcXVpcmUrMHhhMmMvMHgxZDcwCiAgICAgICBsb2NrX2FjcXVpcmUrMHhkYy8weDIy
OAogICAgICAgX19tdXRleF9sb2NrKzB4OGMvMHg4MDAKICAgICAgIG11dGV4X2xvY2tfbmVzdGVk
KzB4MWMvMHgyOAogICAgICAgZHJtX2dlbV9zaG1lbV9wdXJnZSsweDIwLzB4NDAKICAgICAgIHBh
bmZyb3N0X2dlbV9zaHJpbmtlcl9zY2FuKzB4YzAvMHgxODAgW3BhbmZyb3N0XQogICAgICAgZG9f
c2hyaW5rX3NsYWIrMHgyMDgvMHg1MDAKICAgICAgIHNocmlua19zbGFiKzB4MTBjLzB4MmMwCiAg
ICAgICBzaHJpbmtfbm9kZSsweDI4Yy8weDRkOAogICAgICAgYmFsYW5jZV9wZ2RhdCsweDJjOC8w
eDU3MAogICAgICAga3N3YXBkKzB4MjJjLzB4NjM4CiAgICAgICBrdGhyZWFkKzB4MTI4LzB4MTMw
CiAgICAgICByZXRfZnJvbV9mb3JrKzB4MTAvMHgxOAoKb3RoZXIgaW5mbyB0aGF0IG1pZ2h0IGhl
bHAgdXMgZGVidWcgdGhpczoKCiBQb3NzaWJsZSB1bnNhZmUgbG9ja2luZyBzY2VuYXJpbzoKCiAg
ICAgICBDUFUwICAgICAgICAgICAgICAgICAgICBDUFUxCiAgICAgICAtLS0tICAgICAgICAgICAg
ICAgICAgICAtLS0tCiAgbG9jayhmc19yZWNsYWltKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxvY2soJnNobWVtLT5wYWdlc19sb2NrKTsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxvY2soZnNfcmVjbGFpbSk7CiAgbG9jaygmc2htZW0tPnBhZ2VzX2xvY2spOwoKICoq
KiBERUFETE9DSyAqKioKCjMgbG9ja3MgaGVsZCBieSBrc3dhcGQwLzE3MToKICMwOiAwMDAwMDAw
MGY4MjM2OWI2IChmc19yZWNsYWltKXsrLisufSwgYXQ6IF9fZnNfcmVjbGFpbV9hY3F1aXJlKzB4
MC8weDQwCiAjMTogMDAwMDAwMDBjZWIzNzgwOCAoc2hyaW5rZXJfcndzZW0peysrKyt9LCBhdDog
c2hyaW5rX3NsYWIrMHhiYy8weDJjMAogIzI6IDAwMDAwMDAwZjMxZWZhODEgKCZwZmRldi0+c2hy
aW5rZXJfbG9jayl7Ky4rLn0sIGF0OiBwYW5mcm9zdF9nZW1fc2hyaW5rZXJfc2NhbisweDM0LzB4
MTgwIFtwYW5mcm9zdF0KCkZpeGVzOiAxN2FjYjlmMzVlZDcgKCJkcm0vc2htZW06IEFkZCBtYWR2
aXNlIHN0YXRlIGFuZCBwdXJnZSBoZWxwZXJzIikKQ2M6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFy
dGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+CkNjOiBNYXhpbWUgUmlwYXJkIDxtYXhpbWUu
cmlwYXJkQGJvb3RsaW4uY29tPgpDYzogU2VhbiBQYXVsIDxzZWFuQHBvb3JseS5ydW4+CkNjOiBE
YXZpZCBBaXJsaWUgPGFpcmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxA
ZmZ3bGwuY2g+ClNpZ25lZC1vZmYtYnk6IFJvYiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmMgfCA3ICsrKysrLS0KIGlu
Y2x1ZGUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmggICAgIHwgMiArLQogMiBmaWxlcyBjaGFu
Z2VkLCA2IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dl
bV9zaG1lbV9oZWxwZXIuYwppbmRleCA1NDIzZWM1NmI1MzUuLmY1OTE4NzA3NjcyZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmMKQEAgLTQxNSwxMyArNDE1LDE2IEBAIHZv
aWQgZHJtX2dlbV9zaG1lbV9wdXJnZV9sb2NrZWQoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmop
CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9nZW1fc2htZW1fcHVyZ2VfbG9ja2VkKTsKIAotdm9pZCBk
cm1fZ2VtX3NobWVtX3B1cmdlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQorYm9vbCBkcm1f
Z2VtX3NobWVtX3B1cmdlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBk
cm1fZ2VtX3NobWVtX29iamVjdCAqc2htZW0gPSB0b19kcm1fZ2VtX3NobWVtX29iaihvYmopOwog
Ci0JbXV0ZXhfbG9jaygmc2htZW0tPnBhZ2VzX2xvY2spOworCWlmICghbXV0ZXhfdHJ5bG9jaygm
c2htZW0tPnBhZ2VzX2xvY2spKQorCQlyZXR1cm4gZmFsc2U7CiAJZHJtX2dlbV9zaG1lbV9wdXJn
ZV9sb2NrZWQob2JqKTsKIAltdXRleF91bmxvY2soJnNobWVtLT5wYWdlc19sb2NrKTsKKworCXJl
dHVybiB0cnVlOwogfQogRVhQT1JUX1NZTUJPTChkcm1fZ2VtX3NobWVtX3B1cmdlKTsKIApkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaCBiL2luY2x1ZGUvZHJt
L2RybV9nZW1fc2htZW1faGVscGVyLmgKaW5kZXggY2UxNjAwZmRmYzNlLi4wMWY1MTQ1MjE2ODcg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmgKKysrIGIvaW5j
bHVkZS9kcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaApAQCAtMTM0LDcgKzEzNCw3IEBAIHN0YXRp
YyBpbmxpbmUgYm9vbCBkcm1fZ2VtX3NobWVtX2lzX3B1cmdlYWJsZShzdHJ1Y3QgZHJtX2dlbV9z
aG1lbV9vYmplY3QgKnNobWVtCiB9CiAKIHZvaWQgZHJtX2dlbV9zaG1lbV9wdXJnZV9sb2NrZWQo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopOwotdm9pZCBkcm1fZ2VtX3NobWVtX3B1cmdlKHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKK2Jvb2wgZHJtX2dlbV9zaG1lbV9wdXJnZShzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiAKIHN0cnVjdCBkcm1fZ2VtX3NobWVtX29iamVjdCAq
CiBkcm1fZ2VtX3NobWVtX2NyZWF0ZV93aXRoX2hhbmRsZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVf
cHJpdiwKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
