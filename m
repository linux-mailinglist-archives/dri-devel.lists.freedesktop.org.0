Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1563E119352
	for <lists+dri-devel@lfdr.de>; Tue, 10 Dec 2019 22:09:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DF8EE6E940;
	Tue, 10 Dec 2019 21:09:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8AEDE6E93F
 for <dri-devel@lists.freedesktop.org>; Tue, 10 Dec 2019 21:09:51 +0000 (UTC)
Received: from sasha-vm.mshome.net (c-73-47-72-35.hsd1.nh.comcast.net
 [73.47.72.35])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 39661246A7;
 Tue, 10 Dec 2019 21:09:50 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=default; t=1576012191;
 bh=vKrGV+U6ZIYLfVQT/UY7pRLhv6t2/3JYD+SUqMl5pp4=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=0YOxCbqNYbhfJnJUZ9NGh/p/B2uTi+BQce4EYQRuM4tau3f7zjHuuvabtdgK4UtRh
 SvGyKFqvyul1qPbXa8CxW6UkE1i1Ok6nTt1H8Ay5niUadZZbLqN1Up/ySAokVEN6Am
 O4FkzyXfvrs9bomE699ax5nZhXbQnm0XnF58OQfU=
From: Sasha Levin <sashal@kernel.org>
To: linux-kernel@vger.kernel.org,
	stable@vger.kernel.org
Subject: [PATCH AUTOSEL 5.4 146/350] drm/nouveau: Don't grab runtime PM refs
 for HPD IRQs
Date: Tue, 10 Dec 2019 16:04:11 -0500
Message-Id: <20191210210735.9077-107-sashal@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191210210735.9077-1-sashal@kernel.org>
References: <20191210210735.9077-1-sashal@kernel.org>
MIME-Version: 1.0
X-stable: review
X-Patchwork-Hint: Ignore
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sean Paul <sean@poorly.run>, Sasha Levin <sashal@kernel.org>,
 Daniel Vetter <daniel.vetter@ffwll.ch>, dri-devel@lists.freedesktop.org,
 Juston Li <juston.li@intel.com>, nouveau@lists.freedesktop.org,
 Harry Wentland <hwentlan@amd.com>, Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTHl1ZGUgUGF1bCA8bHl1ZGVAcmVkaGF0LmNvbT4KClsgVXBzdHJlYW0gY29tbWl0IDA5
ZTUzMDY1N2UxYzk4MmQzZGJjNWU0MzAyYmY5MjA3OTUwYzNkMGEgXQoKSW4gb3JkZXIgZm9yIHN1
c3BlbmQvcmVzdW1lIHJlcHJvYmluZyB0byB3b3JrLCB3ZSBuZWVkIHRvIGJlIGFibGUgdG8KcGVy
Zm9ybSBzaWRlYmFuZCBjb21tdW5pY2F0aW9ucyBkdXJpbmcgc3VzcGVuZC9yZXN1bWUsIGFsb25n
IHdpdGgKcnVudGltZSBQTSBzdXNwZW5kL3Jlc3VtZS4gSW4gb3JkZXIgdG8gZG8gc28sIHdlIGFs
c28gbmVlZCB0byBtYWtlIHN1cmUKdGhhdCBub3V2ZWF1IGRvZXNuJ3QgYm90aGVyIGdyYWJiaW5n
IGEgcnVudGltZSBQTSByZWZlcmVuY2UgdG8gZG8gc28sCnNpbmNlIG90aGVyd2lzZSB3ZSdsbCBz
dGFydCBkZWFkbG9ja2luZyBydW50aW1lIFBNIGFnYWluLgoKTm90ZSB0aGF0IHdlIHdlcmVuJ3Qg
YWJsZSB0byBkbyB0aGlzIGJlZm9yZSwgYmVjYXVzZSBvZiB0aGUgRFAgTVNUCmhlbHBlcnMgcHJv
Y2Vzc2luZyBVUCByZXF1ZXN0cyBmcm9tIHRvcG9sb2dpZXMgaW4gdGhlIHNhbWUgY29udGV4dCBh
cwpkcm1fZHBfbXN0X2hwZF9pcnEoKSB3aGljaCB3b3VsZCBoYXZlIGNhdXNlZCB1cyB0byBvcGVu
IG91cnNlbHZlcyB1cCB0bwpyZWNlaXZpbmcgaG90cGx1ZyBldmVudHMgYW5kIGRlYWRsb2NraW5n
IHdpdGggcnVudGltZSBzdXNwZW5kL3Jlc3VtZS4KTm93IHRoYXQgdGhvc2UgcmVxdWVzdHMgYXJl
IGhhbmRsZWQgYXN5bmNocm9ub3VzbHksIHRoaXMgY2hhbmdlIHNob3VsZApiZSBjb21wbGV0ZWx5
IHNhZmUuCgpDYzogSnVzdG9uIExpIDxqdXN0b24ubGlAaW50ZWwuY29tPgpDYzogSW1yZSBEZWFr
IDxpbXJlLmRlYWtAaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxh
QGxpbnV4LmludGVsLmNvbT4KQ2M6IEhhcnJ5IFdlbnRsYW5kIDxod2VudGxhbkBhbWQuY29tPgpD
YzogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KUmV2aWV3ZWQtYnk6IEJl
biBTa2VnZ3MgPGJza2VnZ3NAcmVkaGF0LmNvbT4KUmV2aWV3ZWQtYnk6IFNlYW4gUGF1bCA8c2Vh
bkBwb29ybHkucnVuPgpTaWduZWQtb2ZmLWJ5OiBMeXVkZSBQYXVsIDxseXVkZUByZWRoYXQuY29t
PgpMaW5rOiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3RvcC5vcmcvcGF0Y2gvbXNnaWQvMjAx
OTEwMjIwMjM2NDEuODAyNi0xMC1seXVkZUByZWRoYXQuY29tClNpZ25lZC1vZmYtYnk6IFNhc2hh
IExldmluIDxzYXNoYWxAa2VybmVsLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2Nvbm5lY3Rvci5jIHwgMzMgKysrKysrKysrKystLS0tLS0tLS0tCiAxIGZpbGUgY2hh
bmdlZCwgMTcgaW5zZXJ0aW9ucygrKSwgMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jb25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfY29ubmVjdG9yLmMKaW5kZXggOTRkZmEyZTVhOWFiZS4uYTQ0MmE5
NTVmOThjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jb25u
ZWN0b3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Nvbm5lY3Rvci5j
CkBAIC0xMTMxLDYgKzExMzEsMTYgQEAgbm91dmVhdV9jb25uZWN0b3JfaG90cGx1ZyhzdHJ1Y3Qg
bnZpZl9ub3RpZnkgKm5vdGlmeSkKIAljb25zdCBjaGFyICpuYW1lID0gY29ubmVjdG9yLT5uYW1l
OwogCXN0cnVjdCBub3V2ZWF1X2VuY29kZXIgKm52X2VuY29kZXI7CiAJaW50IHJldDsKKwlib29s
IHBsdWdnZWQgPSAocmVwLT5tYXNrICE9IE5WSUZfTk9USUZZX0NPTk5fVjBfVU5QTFVHKTsKKwor
CWlmIChyZXAtPm1hc2sgJiBOVklGX05PVElGWV9DT05OX1YwX0lSUSkgeworCQlOVl9ERUJVRyhk
cm0sICJzZXJ2aWNlICVzXG4iLCBuYW1lKTsKKwkJZHJtX2RwX2NlY19pcnEoJm52X2Nvbm5lY3Rv
ci0+YXV4KTsKKwkJaWYgKChudl9lbmNvZGVyID0gZmluZF9lbmNvZGVyKGNvbm5lY3RvciwgRENC
X09VVFBVVF9EUCkpKQorCQkJbnY1MF9tc3RtX3NlcnZpY2UobnZfZW5jb2Rlci0+ZHAubXN0bSk7
CisKKwkJcmV0dXJuIE5WSUZfTk9USUZZX0tFRVA7CisJfQogCiAJcmV0ID0gcG1fcnVudGltZV9n
ZXQoZHJtLT5kZXYtPmRldik7CiAJaWYgKHJldCA9PSAwKSB7CkBAIC0xMTUxLDI1ICsxMTYxLDE2
IEBAIG5vdXZlYXVfY29ubmVjdG9yX2hvdHBsdWcoc3RydWN0IG52aWZfbm90aWZ5ICpub3RpZnkp
CiAJCXJldHVybiBOVklGX05PVElGWV9EUk9QOwogCX0KIAotCWlmIChyZXAtPm1hc2sgJiBOVklG
X05PVElGWV9DT05OX1YwX0lSUSkgewotCQlOVl9ERUJVRyhkcm0sICJzZXJ2aWNlICVzXG4iLCBu
YW1lKTsKLQkJZHJtX2RwX2NlY19pcnEoJm52X2Nvbm5lY3Rvci0+YXV4KTsKLQkJaWYgKChudl9l
bmNvZGVyID0gZmluZF9lbmNvZGVyKGNvbm5lY3RvciwgRENCX09VVFBVVF9EUCkpKQotCQkJbnY1
MF9tc3RtX3NlcnZpY2UobnZfZW5jb2Rlci0+ZHAubXN0bSk7Ci0JfSBlbHNlIHsKLQkJYm9vbCBw
bHVnZ2VkID0gKHJlcC0+bWFzayAhPSBOVklGX05PVElGWV9DT05OX1YwX1VOUExVRyk7Ci0KKwlp
ZiAoIXBsdWdnZWQpCisJCWRybV9kcF9jZWNfdW5zZXRfZWRpZCgmbnZfY29ubmVjdG9yLT5hdXgp
OworCU5WX0RFQlVHKGRybSwgIiVzcGx1Z2dlZCAlc1xuIiwgcGx1Z2dlZCA/ICIiIDogInVuIiwg
bmFtZSk7CisJaWYgKChudl9lbmNvZGVyID0gZmluZF9lbmNvZGVyKGNvbm5lY3RvciwgRENCX09V
VFBVVF9EUCkpKSB7CiAJCWlmICghcGx1Z2dlZCkKLQkJCWRybV9kcF9jZWNfdW5zZXRfZWRpZCgm
bnZfY29ubmVjdG9yLT5hdXgpOwotCQlOVl9ERUJVRyhkcm0sICIlc3BsdWdnZWQgJXNcbiIsIHBs
dWdnZWQgPyAiIiA6ICJ1biIsIG5hbWUpOwotCQlpZiAoKG52X2VuY29kZXIgPSBmaW5kX2VuY29k
ZXIoY29ubmVjdG9yLCBEQ0JfT1VUUFVUX0RQKSkpIHsKLQkJCWlmICghcGx1Z2dlZCkKLQkJCQlu
djUwX21zdG1fcmVtb3ZlKG52X2VuY29kZXItPmRwLm1zdG0pOwotCQl9Ci0KLQkJZHJtX2hlbHBl
cl9ocGRfaXJxX2V2ZW50KGNvbm5lY3Rvci0+ZGV2KTsKKwkJCW52NTBfbXN0bV9yZW1vdmUobnZf
ZW5jb2Rlci0+ZHAubXN0bSk7CiAJfQogCisJZHJtX2hlbHBlcl9ocGRfaXJxX2V2ZW50KGNvbm5l
Y3Rvci0+ZGV2KTsKKwogCXBtX3J1bnRpbWVfbWFya19sYXN0X2J1c3koZHJtLT5kZXYtPmRldik7
CiAJcG1fcnVudGltZV9wdXRfYXV0b3N1c3BlbmQoZHJtLT5kZXYtPmRldik7CiAJcmV0dXJuIE5W
SUZfTk9USUZZX0tFRVA7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbAo=
