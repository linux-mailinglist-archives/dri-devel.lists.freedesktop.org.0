Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D57470510
	for <lists+dri-devel@lfdr.de>; Mon, 22 Jul 2019 18:08:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6833289CE2;
	Mon, 22 Jul 2019 16:08:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6F55189CB5
 for <dri-devel@lists.freedesktop.org>; Mon, 22 Jul 2019 16:08:46 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: ezequiel) with ESMTPSA id B9F8B28B0A8
From: Ezequiel Garcia <ezequiel@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH libdrm 2/2] modetest: Add a new "-r" option to set a default
 mode
Date: Mon, 22 Jul 2019 13:08:23 -0300
Message-Id: <20190722160823.26668-2-ezequiel@collabora.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190722160823.26668-1-ezequiel@collabora.com>
References: <20190722160823.26668-1-ezequiel@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ezequiel Garcia <ezequiel@collabora.com>, rohan.garg@collabora.com,
 Emil Velikov <emil.l.velikov@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBvcHRpb24gZmluZHMgdGhlIGZpcnN0IGNvbm5lY3RlZCBjb25uZWN0b3IgYW5kIHRoZW4K
c2V0cyBpdHMgcHJlZmVycmVkIG1vZGUgb24gaXQuCgpTZXQgdGhpcyBvcHRpb24gdG8gYmUgc2V0
IHdoZW4gbm8gbW9kZSBvciBwbGFuZSBpcyBzZXQKZXhwbGljaXRpbHkuIFRoaXMgYWxsb3dzIHRv
IHF1aWNrbHkgdGVzdCwgaW4gY2FzZXMgd2hlcmUKb25lIGp1c3QgbmVlZHMgc29tZXRoaW5nIGRp
c3BsYXllZC4KClNpZ25lZC1vZmYtYnk6IEV6ZXF1aWVsIEdhcmNpYSA8ZXplcXVpZWxAY29sbGFi
b3JhLmNvbT4KLS0tCiB0ZXN0cy9tb2RldGVzdC9tb2RldGVzdC5jIHwgODEgKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrLS0tCiAxIGZpbGUgY2hhbmdlZCwgNzUgaW5zZXJ0aW9u
cygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90ZXN0cy9tb2RldGVzdC9tb2RldGVz
dC5jIGIvdGVzdHMvbW9kZXRlc3QvbW9kZXRlc3QuYwppbmRleCA1ZTYyODEyN2ExMzAuLjYwNDJh
YWFlN2NjYSAxMDA2NDQKLS0tIGEvdGVzdHMvbW9kZXRlc3QvbW9kZXRlc3QuYworKysgYi90ZXN0
cy9tb2RldGVzdC9tb2RldGVzdC5jCkBAIC05MDEsNyArOTAxLDkgQEAgc3RhdGljIGludCBwaXBl
X2ZpbmRfY3J0Y19hbmRfbW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBwaXBlX2FyZyAq
cGlwZSkKIAlkcm1Nb2RlTW9kZUluZm8gKm1vZGUgPSBOVUxMOwogCWludCBpOwogCi0JcGlwZS0+
bW9kZSA9IE5VTEw7CisJLyogSWYgc2V0X3ByZWZlcnJlZCBpcyB1c2VkLCBhIG1vZGUgaXMgYWxy
ZWFkeSBzZXQuICovCisJaWYgKHBpcGUtPm1vZGUpCisJCWdvdG8gZmluZF9jcnRjOwogCiAJZm9y
IChpID0gMDsgaSA8IChpbnQpcGlwZS0+bnVtX2NvbnM7IGkrKykgewogCQltb2RlID0gY29ubmVj
dG9yX2ZpbmRfbW9kZShkZXYsIHBpcGUtPmNvbl9pZHNbaV0sCkBAIC05MTMsNyArOTE1LDkgQEAg
c3RhdGljIGludCBwaXBlX2ZpbmRfY3J0Y19hbmRfbW9kZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0
cnVjdCBwaXBlX2FyZyAqcGlwZSkKIAkJCXJldHVybiAtRUlOVkFMOwogCQl9CiAJfQorCXBpcGUt
Pm1vZGUgPSBtb2RlOwogCitmaW5kX2NydGM6CiAJLyogSWYgdGhlIENSVEMgSUQgd2FzIHNwZWNp
ZmllZCwgZ2V0IHRoZSBjb3JyZXNwb25kaW5nIENSVEMuIE90aGVyd2lzZQogCSAqIGxvY2F0ZSBh
IENSVEMgdGhhdCBjYW4gYmUgYXR0YWNoZWQgdG8gYWxsIHRoZSBjb25uZWN0b3JzLgogCSAqLwpA
QCAtOTM1LDcgKzkzOSw2IEBAIHN0YXRpYyBpbnQgcGlwZV9maW5kX2NydGNfYW5kX21vZGUoc3Ry
dWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgcGlwZV9hcmcgKnBpcGUpCiAJCXJldHVybiAtRUlOVkFM
OwogCX0KIAotCXBpcGUtPm1vZGUgPSBtb2RlOwogCXBpcGUtPmNydGMtPm1vZGUgPSBtb2RlOwog
CiAJcmV0dXJuIDA7CkBAIC0xODEzLDcgKzE4MTYsNyBAQCBzdGF0aWMgdm9pZCBwYXJzZV9maWxs
X3BhdHRlcm5zKGNoYXIgKmFyZykKIAogc3RhdGljIHZvaWQgdXNhZ2UoY2hhciAqbmFtZSkKIHsK
LQlmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiAlcyBbLWFjRGRlZk1QcHNDdnddXG4iLCBuYW1lKTsK
KwlmcHJpbnRmKHN0ZGVyciwgInVzYWdlOiAlcyBbLWFjRGRlZk1QcHNDdnJ3XVxuIiwgbmFtZSk7
CiAKIAlmcHJpbnRmKHN0ZGVyciwgIlxuIFF1ZXJ5IG9wdGlvbnM6XG5cbiIpOwogCWZwcmludGYo
c3RkZXJyLCAiXHQtY1x0bGlzdCBjb25uZWN0b3JzXG4iKTsKQEAgLTE4MjYsNiArMTgyOSw3IEBA
IHN0YXRpYyB2b2lkIHVzYWdlKGNoYXIgKm5hbWUpCiAJZnByaW50ZihzdGRlcnIsICJcdC1zIDxj
b25uZWN0b3JfaWQ+Wyw8Y29ubmVjdG9yX2lkPl1bQDxjcnRjX2lkPl06PG1vZGU+Wy08dnJlZnJl
c2g+XVtAPGZvcm1hdD5dXHRzZXQgYSBtb2RlXG4iKTsKIAlmcHJpbnRmKHN0ZGVyciwgIlx0LUNc
dHRlc3QgaHcgY3Vyc29yXG4iKTsKIAlmcHJpbnRmKHN0ZGVyciwgIlx0LXZcdHRlc3QgdnN5bmNl
ZCBwYWdlIGZsaXBwaW5nXG4iKTsKKwlmcHJpbnRmKHN0ZGVyciwgIlx0LXJcdHNldCB0aGUgcHJl
ZmVycmVkIG1vZGVcbiIpOwogCWZwcmludGYoc3RkZXJyLCAiXHQtdyA8b2JqX2lkPjo8cHJvcF9u
YW1lPjo8dmFsdWU+XHRzZXQgcHJvcGVydHlcbiIpOwogCWZwcmludGYoc3RkZXJyLCAiXHQtYSBc
dHVzZSBhdG9taWMgQVBJXG4iKTsKIAlmcHJpbnRmKHN0ZGVyciwgIlx0LUYgcGF0dGVybjEscGF0
dGVybjJcdHNwZWNpZnkgZmlsbCBwYXR0ZXJuc1xuIik7CkBAIC0xODc0LDYgKzE4NzgsOSBAQCBz
dGF0aWMgaW50IHBpcGVfcmVzb2x2ZV9jb25uZWN0b3JzKHN0cnVjdCBkZXZpY2UgKmRldiwgc3Ry
dWN0IHBpcGVfYXJnICpwaXBlKQogCWNoYXIgKmVuZHA7CiAKIAlmb3IgKGkgPSAwOyBpIDwgcGlw
ZS0+bnVtX2NvbnM7IGkrKykgeworCQkvKiBJZiBzZXRfcHJlZmVycmVkIGlzIHVzZWQsIHRoZSBj
b25uZWN0b3IgaXMgYWxyZWFkeSByZXNvbHZlZC4gKi8KKwkJaWYgKHBpcGUtPmNvbl9pZHNbaV0p
CisJCQljb250aW51ZTsKIAkJaWQgPSBzdHJ0b3VsKHBpcGUtPmNvbnNbaV0sICZlbmRwLCAxMCk7
CiAJCWlmIChlbmRwID09IHBpcGUtPmNvbnNbaV0pIHsKIAkJCWNvbm5lY3RvciA9IGdldF9jb25u
ZWN0b3JfYnlfbmFtZShkZXYsIHBpcGUtPmNvbnNbaV0pOwpAQCAtMTg4NSwxNCArMTg5Miw2MiBA
QCBzdGF0aWMgaW50IHBpcGVfcmVzb2x2ZV9jb25uZWN0b3JzKHN0cnVjdCBkZXZpY2UgKmRldiwg
c3RydWN0IHBpcGVfYXJnICpwaXBlKQogCiAJCQlpZCA9IGNvbm5lY3Rvci0+Y29ubmVjdG9yX2lk
OwogCQl9Ci0KIAkJcGlwZS0+Y29uX2lkc1tpXSA9IGlkOwogCX0KIAogCXJldHVybiAwOwogfQog
Ci1zdGF0aWMgY2hhciBvcHRzdHJbXSA9ICJhY2REOmVmRjpNOlA6cHM6Q3Z3OiI7CitzdGF0aWMg
Y2hhciBvcHRzdHJbXSA9ICJhY2REOmVmRjpNOlA6cHM6Q3ZydzoiOworCitzdGF0aWMgaW50IHBp
cGVfZmluZF9wcmVmZXJyZWQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgcGlwZV9hcmcgKnBp
cGUpCit7CisJZHJtTW9kZVJlcyAqcmVzID0gZGV2LT5yZXNvdXJjZXMtPnJlczsKKwlkcm1Nb2Rl
Q29ubmVjdG9yICpjb24gPSBOVUxMOworCWNoYXIgKmNvbl9zdHI7CisJaW50IGk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgcmVzLT5jb3VudF9jb25uZWN0b3JzOyBpKyspIHsKKwkJY29uID0gZHJtTW9k
ZUdldENvbm5lY3RvcihkZXYtPmZkLCByZXMtPmNvbm5lY3RvcnNbaV0pOworCQlpZiAoY29uLT5j
b25uZWN0aW9uID09IERSTV9NT0RFX0NPTk5FQ1RFRCkKKwkJCWJyZWFrOworCQlkcm1Nb2RlRnJl
ZUNvbm5lY3Rvcihjb24pOworCQljb24gPSBOVUxMOworCX0KKworCWlmICghY29uKSB7CisJCXBy
aW50Zigibm8gY29ubmVjdGVkIGNvbm5lY3RvciFcbiIpOworCQlyZXR1cm4gLTE7CisJfQorCisJ
Y29uX3N0ciA9IG1hbGxvYyg4KTsKKwlzcHJpbnRmKGNvbl9zdHIsICIlZCIsIGNvbi0+Y29ubmVj
dG9yX2lkKTsKKwlzdHJjcHkocGlwZS0+Zm9ybWF0X3N0ciwgIlhSMjQiKTsKKwlwaXBlLT5mb3Vy
Y2MgPSB1dGlsX2Zvcm1hdF9mb3VyY2MocGlwZS0+Zm9ybWF0X3N0cik7CisJcGlwZS0+bnVtX2Nv
bnMgPSAxOworCXBpcGUtPmNvbl9pZHMgPSBjYWxsb2MoMSwgc2l6ZW9mKCpwaXBlLT5jb25faWRz
KSk7CisJcGlwZS0+Y29ucyA9IGNhbGxvYygxLCBzaXplb2YoKnBpcGUtPmNvbnMpKTsKKwlwaXBl
LT5jb25faWRzWzBdID0gY29uLT5jb25uZWN0b3JfaWQ7CisJcGlwZS0+Y29uc1swXSA9IChjb25z
dCBjaGFyKiljb25fc3RyOworCisJLyogQSBDUlRDIHBvc3NpYmxlIHdpbGwgYmUgY2hvc2VuIGJ5
IHBpcGVfZmluZF9jcnRjX2FuZF9tb2RlLiAqLworCXBpcGUtPmNydGNfaWQgPSAodWludDMyX3Qp
LTE7CisKKwkvKiBSZXR1cm4gdGhlIGZpcnN0IG1vZGUgaWYgbm8gcHJlZmVycmVkLiAqLworCXBp
cGUtPm1vZGUgPSAmY29uLT5tb2Rlc1swXTsKKwlmb3IgKGkgPSAwOyBpIDwgY29uLT5jb3VudF9t
b2RlczsgaSsrKSB7CisJCWRybU1vZGVNb2RlSW5mbyAqY3VycmVudF9tb2RlID0gJmNvbi0+bW9k
ZXNbaV07CisKKwkJaWYgKGN1cnJlbnRfbW9kZS0+dHlwZSAmIERSTV9NT0RFX1RZUEVfUFJFRkVS
UkVEKSB7CisJCQlwaXBlLT5tb2RlID0gY3VycmVudF9tb2RlOworCQkJYnJlYWs7CisJCX0KKwl9
CisKKwlzcHJpbnRmKHBpcGUtPm1vZGVfc3RyLCAiJWR4JWQiLCBwaXBlLT5tb2RlLT5oZGlzcGxh
eSwgcGlwZS0+bW9kZS0+dmRpc3BsYXkpOworCisJcmV0dXJuIDA7Cit9CiAKIGludCBtYWluKGlu
dCBhcmdjLCBjaGFyICoqYXJndikKIHsKQEAgLTE5MDMsNiArMTk1OCw3IEBAIGludCBtYWluKGlu
dCBhcmdjLCBjaGFyICoqYXJndikKIAlpbnQgZHJvcF9tYXN0ZXIgPSAwOwogCWludCB0ZXN0X3Zz
eW5jID0gMDsKIAlpbnQgdGVzdF9jdXJzb3IgPSAwOworCWludCBzZXRfcHJlZmVycmVkID0gMDsK
IAlpbnQgdXNlX2F0b21pYyA9IDA7CiAJY2hhciAqZGV2aWNlID0gTlVMTDsKIAljaGFyICptb2R1
bGUgPSBOVUxMOwpAQCAtMTk4Nyw2ICsyMDQzLDkgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIg
Kiphcmd2KQogCQljYXNlICd2JzoKIAkJCXRlc3RfdnN5bmMgPSAxOwogCQkJYnJlYWs7CisJCWNh
c2UgJ3InOgorCQkJc2V0X3ByZWZlcnJlZCA9IDE7CisJCQlicmVhazsKIAkJY2FzZSAndyc6CiAJ
CQlwcm9wX2FyZ3MgPSByZWFsbG9jKHByb3BfYXJncywKIAkJCQkJICAgKHByb3BfY291bnQgKyAx
KSAqIHNpemVvZiAqcHJvcF9hcmdzKTsKQEAgLTIwMDgsNyArMjA2Nyw3IEBAIGludCBtYWluKGlu
dCBhcmdjLCBjaGFyICoqYXJndikKIAl9CiAKIAlpZiAoIWFyZ3MgfHwgKGFyZ3MgPT0gMSAmJiB1
c2VfYXRvbWljKSkKLQkJZW5jb2RlcnMgPSBjb25uZWN0b3JzID0gY3J0Y3MgPSBwbGFuZXMgPSBm
cmFtZWJ1ZmZlcnMgPSAxOworCQlzZXRfcHJlZmVycmVkID0gZW5jb2RlcnMgPSBjb25uZWN0b3Jz
ID0gY3J0Y3MgPSBwbGFuZXMgPSBmcmFtZWJ1ZmZlcnMgPSAxOwogCiAJZGV2LmZkID0gdXRpbF9v
cGVuKGRldmljZSwgbW9kdWxlKTsKIAlpZiAoZGV2LmZkIDwgMCkKQEAgLTIwNDQsNiArMjEwMywx
NiBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiAJCXJldHVybiAxOwogCX0KIAor
CWlmIChzZXRfcHJlZmVycmVkKSB7CisJCWNvdW50ID0gMTsKKwkJcGlwZV9hcmdzID0gY2FsbG9j
KDEsIHNpemVvZigqcGlwZV9hcmdzKSk7CisJCXJldCA9IHBpcGVfZmluZF9wcmVmZXJyZWQoJmRl
diwgJnBpcGVfYXJnc1swXSk7CisJCWlmIChyZXQpIHsKKwkJCWZwcmludGYoc3RkZXJyLCAiY2Fu
J3QgZ2V0IHByZWZlcnJlZCBjb25uZWN0b3IgYW5kIG1vZGU6ICVzXG4iLCBzdHJlcnJvcihlcnJu
bykpOworCQkJcmV0dXJuIDE7CisJCX0KKwl9CisKIAlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkr
KykgewogCQlpZiAocGlwZV9yZXNvbHZlX2Nvbm5lY3RvcnMoJmRldiwgJnBpcGVfYXJnc1tpXSkg
PCAwKSB7CiAJCQlmcmVlX3Jlc291cmNlcyhkZXYucmVzb3VyY2VzKTsKLS0gCjIuMjIuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
