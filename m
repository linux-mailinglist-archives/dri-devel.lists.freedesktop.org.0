Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 02367148F0A
	for <lists+dri-devel@lfdr.de>; Fri, 24 Jan 2020 21:03:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4A14672BA5;
	Fri, 24 Jan 2020 20:03:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5BF0372BA3;
 Fri, 24 Jan 2020 20:02:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Jan 2020 12:02:53 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,358,1574150400"; d="scan'208";a="221127526"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga008.jf.intel.com with SMTP; 24 Jan 2020 12:02:51 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 24 Jan 2020 22:02:50 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 7/8] drm/edid: Constify lots of things
Date: Fri, 24 Jan 2020 22:02:30 +0200
Message-Id: <20200124200231.10517-7-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200124200231.10517-1-ville.syrjala@linux.intel.com>
References: <20200124200231.10517-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkxl
dCdzIHRyeSB0byBtYWtlIGEgbG90IG1vcmUgc3R1ZmYgY29uc3QgaW4gdGhlIGVkaWQgcGFyc2Vy
LgoKVGhlICJkb3duc2lkZSIgaXMgdGhhdCB3ZSBjYW4gbm8gbG9uZ2VyIG1hbmdsZSB0aGUgRURJ
RCBpbiB0aGUKbWlkZGxlIG9mIHRoZSBwYXJzaW5nIHRvIGFwcGx5IHF1aXJrcyAoZHJtX21vZGVf
ZGV0YWlsZWQoKSkuCkkgZG9uJ3QgcmVhbGx5IHRoaW5rIG1hbmdsaW5nIHRoZSBibG9iIGl0c2Vs
ZiBpcyBzdWNoIGEgZ3JlYXQKaWRlYSBhbnl3YXkgc28gSSB3b24ndCBtaXNzIHRoYXQgcGFydC4g
QnV0IGlmIHdlIGRvIHdhbnQgaXQKYmFjayBJIGd1ZXNzIHdlIHNob3VsZCBkbyB0aGUgbWFuZ2xp
bmcgaW4gb25lIGV4cGxpY2l0IHBsYWNlCmJlZm9yZSB3ZSBvdGhlcndpc2UgcGFyc2UgdGhlIEVE
SUQuCgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXgu
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY29ubmVjdG9yLmMgfCAgIDQgKy0K
IGRyaXZlcnMvZ3B1L2RybS9kcm1fZWRpZC5jICAgICAgfCAzMDMgKysrKysrKysrKysrKysrKysr
LS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaCAgICAgfCAgIDQgKy0K
IDMgZmlsZXMgY2hhbmdlZCwgMTc2IGluc2VydGlvbnMoKyksIDEzNSBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Nvbm5lY3Rvci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2RybV9jb25uZWN0b3IuYwppbmRleCBmNjMyY2EwNTk2MGUuLjkyYTVjZDZmZjZiMSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9jb25uZWN0b3IuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vZHJtX2Nvbm5lY3Rvci5jCkBAIC0yMzc3LDcgKzIzNzcsNyBAQCBFWFBPUlRfU1lNQk9M
KGRybV9tb2RlX3B1dF90aWxlX2dyb3VwKTsKICAqIHRpbGUgZ3JvdXAgb3IgTlVMTCBpZiBub3Qg
Zm91bmQuCiAgKi8KIHN0cnVjdCBkcm1fdGlsZV9ncm91cCAqZHJtX21vZGVfZ2V0X3RpbGVfZ3Jv
dXAoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQkJICAgICAgIGNoYXIgdG9wb2xvZ3lbOF0p
CisJCQkJCSAgICAgICBjb25zdCB1OCB0b3BvbG9neVs4XSkKIHsKIAlzdHJ1Y3QgZHJtX3RpbGVf
Z3JvdXAgKnRnOwogCWludCBpZDsKQEAgLTI0MDcsNyArMjQwNyw3IEBAIEVYUE9SVF9TWU1CT0wo
ZHJtX21vZGVfZ2V0X3RpbGVfZ3JvdXApOwogICogbmV3IHRpbGUgZ3JvdXAgb3IgTlVMTC4KICAq
Lwogc3RydWN0IGRybV90aWxlX2dyb3VwICpkcm1fbW9kZV9jcmVhdGVfdGlsZV9ncm91cChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJCQkJICBjaGFyIHRvcG9sb2d5WzhdKQorCQkJCQkJICBj
b25zdCB1OCB0b3BvbG9neVs4XSkKIHsKIAlzdHJ1Y3QgZHJtX3RpbGVfZ3JvdXAgKnRnOwogCWlu
dCByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZWRpZC5jCmluZGV4IGZkOWI3MjQwNjdhNy4uOGU3NmVmZTE2NTRkIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2VkaWQuYwpAQCAtODgsNyArODgsNyBAQAogCiBzdHJ1Y3QgZGV0YWlsZWRfbW9kZV9jbG9z
dXJlIHsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwotCXN0cnVjdCBlZGlkICpl
ZGlkOworCWNvbnN0IHN0cnVjdCBlZGlkICplZGlkOwogCWJvb2wgcHJlZmVycmVkOwogCXUzMiBx
dWlya3M7CiAJaW50IG1vZGVzOwpAQCAtMTU4NCw4ICsxNTg0LDggQEAgTU9EVUxFX1BBUk1fREVT
QyhlZGlkX2ZpeHVwLAogCQkgIk1pbmltdW0gbnVtYmVyIG9mIHZhbGlkIEVESUQgaGVhZGVyIGJ5
dGVzICgwLTgsIGRlZmF1bHQgNikiKTsKIAogc3RhdGljIHZvaWQgZHJtX2dldF9kaXNwbGF5aWQo
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCSAgICAgIHN0cnVjdCBlZGlkICpl
ZGlkKTsKLXN0YXRpYyBpbnQgdmFsaWRhdGVfZGlzcGxheWlkKHU4ICpkaXNwbGF5aWQsIGludCBs
ZW5ndGgsIGludCBpZHgpOworCQkJICAgICAgY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpOworc3Rh
dGljIGludCB2YWxpZGF0ZV9kaXNwbGF5aWQoY29uc3QgdTggKmRpc3BsYXlpZCwgaW50IGxlbmd0
aCwgaW50IGlkeCk7CiAKIHN0YXRpYyBpbnQgZHJtX2VkaWRfYmxvY2tfY2hlY2tzdW0oY29uc3Qg
dTggKnJhd19lZGlkKQogewpAQCAtMjIwNyw0MSArMjIwNyw0MSBAQCBzdGF0aWMgYm9vbCBpc19k
ZXRhaWxlZF90aW1pbmdfZGVzY3JpcHRvcihjb25zdCB1OCBkWzE4XSkKIAlyZXR1cm4gZFswXSAh
PSAweDAwIHx8IGRbMV0gIT0gMHgwMDsKIH0KIAotdHlwZWRlZiB2b2lkIGRldGFpbGVkX2NiKHN0
cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZywgdm9pZCAqY2xvc3VyZSk7Cit0eXBlZGVmIHZv
aWQgZGV0YWlsZWRfY2IoY29uc3Qgc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nLCB2b2lk
ICpjbG9zdXJlKTsKIAogc3RhdGljIHZvaWQKLWNlYV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jayh1
OCAqZXh0LCBkZXRhaWxlZF9jYiAqY2IsIHZvaWQgKmNsb3N1cmUpCitjZWFfZm9yX2VhY2hfZGV0
YWlsZWRfYmxvY2soY29uc3QgdTggKmV4dCwgZGV0YWlsZWRfY2IgKmNiLCB2b2lkICpjbG9zdXJl
KQogewogCWludCBpLCBuOwogCXU4IGQgPSBleHRbMHgwMl07Ci0JdTggKmRldF9iYXNlID0gZXh0
ICsgZDsKKwljb25zdCB1OCAqZGV0X2Jhc2UgPSBleHQgKyBkOwogCiAJaWYgKGQgPCA0IHx8IGQg
PiAxMjcpCiAJCXJldHVybjsKIAogCW4gPSAoMTI3IC0gZCkgLyAxODsKIAlmb3IgKGkgPSAwOyBp
IDwgbjsgaSsrKQotCQljYigoc3RydWN0IGRldGFpbGVkX3RpbWluZyAqKShkZXRfYmFzZSArIDE4
ICogaSksIGNsb3N1cmUpOworCQljYigoY29uc3Qgc3RydWN0IGRldGFpbGVkX3RpbWluZyAqKShk
ZXRfYmFzZSArIDE4ICogaSksIGNsb3N1cmUpOwogfQogCiBzdGF0aWMgdm9pZAotdnRiX2Zvcl9l
YWNoX2RldGFpbGVkX2Jsb2NrKHU4ICpleHQsIGRldGFpbGVkX2NiICpjYiwgdm9pZCAqY2xvc3Vy
ZSkKK3Z0Yl9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jayhjb25zdCB1OCAqZXh0LCBkZXRhaWxlZF9j
YiAqY2IsIHZvaWQgKmNsb3N1cmUpCiB7CiAJdW5zaWduZWQgaW50IGksIG4gPSBtaW4oKGludCll
eHRbMHgwMl0sIDYpOwotCXU4ICpkZXRfYmFzZSA9IGV4dCArIDU7CisJY29uc3QgdTggKmRldF9i
YXNlID0gZXh0ICsgNTsKIAogCWlmIChleHRbMHgwMV0gIT0gMSkKIAkJcmV0dXJuOyAvKiB1bmtu
b3duIHZlcnNpb24gKi8KIAogCWZvciAoaSA9IDA7IGkgPCBuOyBpKyspCi0JCWNiKChzdHJ1Y3Qg
ZGV0YWlsZWRfdGltaW5nICopKGRldF9iYXNlICsgMTggKiBpKSwgY2xvc3VyZSk7CisJCWNiKChj
b25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICopKGRldF9iYXNlICsgMTggKiBpKSwgY2xvc3Vy
ZSk7CiB9CiAKIHN0YXRpYyB2b2lkCi1kcm1fZm9yX2VhY2hfZGV0YWlsZWRfYmxvY2sodTggKnJh
d19lZGlkLCBkZXRhaWxlZF9jYiAqY2IsIHZvaWQgKmNsb3N1cmUpCitkcm1fZm9yX2VhY2hfZGV0
YWlsZWRfYmxvY2soY29uc3QgdTggKnJhd19lZGlkLCBkZXRhaWxlZF9jYiAqY2IsIHZvaWQgKmNs
b3N1cmUpCiB7CisJY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQgPSAoc3RydWN0IGVkaWQgKilyYXdf
ZWRpZDsKIAlpbnQgaTsKLQlzdHJ1Y3QgZWRpZCAqZWRpZCA9IChzdHJ1Y3QgZWRpZCAqKXJhd19l
ZGlkOwogCiAJaWYgKGVkaWQgPT0gTlVMTCkKIAkJcmV0dXJuOwpAQCAtMjI1MCw3ICsyMjUwLDcg
QEAgZHJtX2Zvcl9lYWNoX2RldGFpbGVkX2Jsb2NrKHU4ICpyYXdfZWRpZCwgZGV0YWlsZWRfY2Ig
KmNiLCB2b2lkICpjbG9zdXJlKQogCQljYigmKGVkaWQtPmRldGFpbGVkX3RpbWluZ3NbaV0pLCBj
bG9zdXJlKTsKIAogCWZvciAoaSA9IDE7IGkgPD0gcmF3X2VkaWRbMHg3ZV07IGkrKykgewotCQl1
OCAqZXh0ID0gcmF3X2VkaWQgKyAoaSAqIEVESURfTEVOR1RIKTsKKwkJY29uc3QgdTggKmV4dCA9
IHJhd19lZGlkICsgKGkgKiBFRElEX0xFTkdUSCk7CiAJCXN3aXRjaCAoKmV4dCkgewogCQljYXNl
IENFQV9FWFQ6CiAJCQljZWFfZm9yX2VhY2hfZGV0YWlsZWRfYmxvY2soZXh0LCBjYiwgY2xvc3Vy
ZSk7CkBAIC0yMjY0LDgxICsyMjY0LDEwNSBAQCBkcm1fZm9yX2VhY2hfZGV0YWlsZWRfYmxvY2so
dTggKnJhd19lZGlkLCBkZXRhaWxlZF9jYiAqY2IsIHZvaWQgKmNsb3N1cmUpCiAJfQogfQogCitz
dHJ1Y3QgYm9vbF9jbG9zdXJlIHsKKwlib29sIHJldDsKK307CisKIHN0YXRpYyB2b2lkCi1pc19y
YihzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0LCB2b2lkICpkYXRhKQoraXNfcmIoY29uc3Qgc3Ry
dWN0IGRldGFpbGVkX3RpbWluZyAqdCwgdm9pZCAqYykKIHsKLQl1OCAqciA9ICh1OCAqKXQ7CisJ
c3RydWN0IGJvb2xfY2xvc3VyZSAqY2xvc3VyZSA9IGM7CisJY29uc3QgdTggKnIgPSAoY29uc3Qg
dTggKil0OwogCiAJaWYgKCFpc19kaXNwbGF5X2Rlc2NyaXB0b3IociwgRURJRF9ERVRBSUxfTU9O
SVRPUl9SQU5HRSkpCiAJCXJldHVybjsKIAogCWlmIChyWzE1XSAmIDB4MTApCi0JCSooYm9vbCAq
KWRhdGEgPSB0cnVlOworCQljbG9zdXJlLT5yZXQgPSB0cnVlOwogfQogCiAvKiBFRElEIDEuNCBk
ZWZpbmVzIHRoaXMgZXhwbGljaXRseS4gIEZvciBFRElEIDEuMywgd2UgZ3Vlc3MsIGJhZGx5LiAq
Lwogc3RhdGljIGJvb2wKLWRybV9tb25pdG9yX3N1cHBvcnRzX3JiKHN0cnVjdCBlZGlkICplZGlk
KQorZHJtX21vbml0b3Jfc3VwcG9ydHNfcmIoY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpCiB7CiAJ
aWYgKGVkaWQtPnJldmlzaW9uID49IDQpIHsKLQkJYm9vbCByZXQgPSBmYWxzZTsKLQkJZHJtX2Zv
cl9lYWNoX2RldGFpbGVkX2Jsb2NrKCh1OCAqKWVkaWQsIGlzX3JiLCAmcmV0KTsKLQkJcmV0dXJu
IHJldDsKKwkJc3RydWN0IGJvb2xfY2xvc3VyZSBjbG9zdXJlID0geworCQkJLnJldCA9IGZhbHNl
LAorCQl9OworCisJCWRybV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jaygodTggKillZGlkLCBpc19y
YiwgJmNsb3N1cmUpOworCisJCXJldHVybiBjbG9zdXJlLnJldDsKIAl9CiAKIAlyZXR1cm4gKChl
ZGlkLT5pbnB1dCAmIERSTV9FRElEX0lOUFVUX0RJR0lUQUwpICE9IDApOwogfQogCitzdHJ1Y3Qg
ZGF0YV9jbG9zdXJlIHsKKwljb25zdCB1OCAqZGF0YTsKK307CisKIHN0YXRpYyB2b2lkCi1maW5k
X2d0ZjIoc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdCwgdm9pZCAqZGF0YSkKK2RvX2ZpbmRfZ3Rm
Mihjb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0LCB2b2lkICpjKQogewotCXU4ICpyID0g
KHU4ICopdDsKKwlzdHJ1Y3QgZGF0YV9jbG9zdXJlICpjbG9zdXJlID0gYzsKKwljb25zdCB1OCAq
ciA9IChjb25zdCB1OCAqKXQ7CiAKIAlpZiAoIWlzX2Rpc3BsYXlfZGVzY3JpcHRvcihyLCBFRElE
X0RFVEFJTF9NT05JVE9SX1JBTkdFKSkKIAkJcmV0dXJuOwogCiAJaWYgKHJbMTBdID09IDB4MDIp
Ci0JCSoodTggKiopZGF0YSA9IHI7CisJCWNsb3N1cmUtPmRhdGEgPSByOworfQorCitzdGF0aWMg
Y29uc3QgdTggKgorZmluZF9ndGYyX2Rlc2NyaXB0b3IoY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQp
Cit7CisJc3RydWN0IGRhdGFfY2xvc3VyZSBjbG9zdXJlID0ge307CisKKwlkcm1fZm9yX2VhY2hf
ZGV0YWlsZWRfYmxvY2soKHU4ICopZWRpZCwgZG9fZmluZF9ndGYyLCAmY2xvc3VyZSk7CisKKwly
ZXR1cm4gY2xvc3VyZS5kYXRhOwogfQogCiAvKiBTZWNvbmRhcnkgR1RGIGN1cnZlIGtpY2tzIGlu
IGFib3ZlIHNvbWUgYnJlYWsgZnJlcXVlbmN5ICovCiBzdGF0aWMgaW50Ci1kcm1fZ3RmMl9oYnJl
YWsoc3RydWN0IGVkaWQgKmVkaWQpCitkcm1fZ3RmMl9oYnJlYWsoY29uc3Qgc3RydWN0IGVkaWQg
KmVkaWQpCiB7Ci0JdTggKnIgPSBOVUxMOwotCWRybV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jaygo
dTggKillZGlkLCBmaW5kX2d0ZjIsICZyKTsKLQlyZXR1cm4gciA/IChyWzEyXSAqIDIpIDogMDsK
Kwljb25zdCB1OCAqciA9IGZpbmRfZ3RmMl9kZXNjcmlwdG9yKGVkaWQpOworCisJcmV0dXJuIHIg
PyByWzEyXSAqIDIgOiAwOwogfQogCiBzdGF0aWMgaW50Ci1kcm1fZ3RmMl8yYyhzdHJ1Y3QgZWRp
ZCAqZWRpZCkKK2RybV9ndGYyXzJjKGNvbnN0IHN0cnVjdCBlZGlkICplZGlkKQogewotCXU4ICpy
ID0gTlVMTDsKLQlkcm1fZm9yX2VhY2hfZGV0YWlsZWRfYmxvY2soKHU4ICopZWRpZCwgZmluZF9n
dGYyLCAmcik7CisJY29uc3QgdTggKnIgPSBmaW5kX2d0ZjJfZGVzY3JpcHRvcihlZGlkKTsKKwog
CXJldHVybiByID8gclsxM10gOiAwOwogfQogCiBzdGF0aWMgaW50Ci1kcm1fZ3RmMl9tKHN0cnVj
dCBlZGlkICplZGlkKQorZHJtX2d0ZjJfbShjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCkKIHsKLQl1
OCAqciA9IE5VTEw7Ci0JZHJtX2Zvcl9lYWNoX2RldGFpbGVkX2Jsb2NrKCh1OCAqKWVkaWQsIGZp
bmRfZ3RmMiwgJnIpOwotCXJldHVybiByID8gKHJbMTVdIDw8IDgpICsgclsxNF0gOiAwOworCWNv
bnN0IHU4ICpyID0gZmluZF9ndGYyX2Rlc2NyaXB0b3IoZWRpZCk7CisKKwlyZXR1cm4gciA/IChy
WzE1XSA8PCA4KSB8IHJbMTRdIDogMDsKIH0KIAogc3RhdGljIGludAotZHJtX2d0ZjJfayhzdHJ1
Y3QgZWRpZCAqZWRpZCkKK2RybV9ndGYyX2soY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpCiB7Ci0J
dTggKnIgPSBOVUxMOwotCWRybV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jaygodTggKillZGlkLCBm
aW5kX2d0ZjIsICZyKTsKKwljb25zdCB1OCAqciA9IGZpbmRfZ3RmMl9kZXNjcmlwdG9yKGVkaWQp
OworCiAJcmV0dXJuIHIgPyByWzE2XSA6IDA7CiB9CiAKIHN0YXRpYyBpbnQKLWRybV9ndGYyXzJq
KHN0cnVjdCBlZGlkICplZGlkKQorZHJtX2d0ZjJfMmooY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQp
CiB7Ci0JdTggKnIgPSBOVUxMOwotCWRybV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jaygodTggKill
ZGlkLCBmaW5kX2d0ZjIsICZyKTsKKwljb25zdCB1OCAqciA9IGZpbmRfZ3RmMl9kZXNjcmlwdG9y
KGVkaWQpOworCiAJcmV0dXJuIHIgPyByWzE3XSA6IDA7CiB9CiAKQEAgLTIzNDYsNyArMjM3MCw3
IEBAIGRybV9ndGYyXzJqKHN0cnVjdCBlZGlkICplZGlkKQogICogc3RhbmRhcmRfdGltaW5nX2xl
dmVsIC0gZ2V0IHN0ZC4gdGltaW5nIGxldmVsKENWVC9HVEYvRE1UKQogICogQGVkaWQ6IEVESUQg
YmxvY2sgdG8gc2NhbgogICovCi1zdGF0aWMgaW50IHN0YW5kYXJkX3RpbWluZ19sZXZlbChzdHJ1
Y3QgZWRpZCAqZWRpZCkKK3N0YXRpYyBpbnQgc3RhbmRhcmRfdGltaW5nX2xldmVsKGNvbnN0IHN0
cnVjdCBlZGlkICplZGlkKQogewogCWlmIChlZGlkLT5yZXZpc2lvbiA+PSAyKSB7CiAJCWlmIChl
ZGlkLT5yZXZpc2lvbiA+PSA0ICYmIChlZGlkLT5mZWF0dXJlcyAmIERSTV9FRElEX0ZFQVRVUkVf
REVGQVVMVF9HVEYpKQpAQCAtMjM4MSw4ICsyNDA1LDkgQEAgYmFkX3N0ZF90aW1pbmcodTggYSwg
dTggYikKICAqIGFuZCBjb252ZXJ0IHRoZW0gaW50byBhIHJlYWwgbW9kZSB1c2luZyBDVlQvR1RG
L0RNVC4KICAqLwogc3RhdGljIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICoKLWRybV9tb2RlX3N0
ZChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCwKLQkg
ICAgIHN0cnVjdCBzdGRfdGltaW5nICp0KQorZHJtX21vZGVfc3RkKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IsCisJICAgICBjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCwKKwkgICAgIGNv
bnN0IHN0cnVjdCBzdGRfdGltaW5nICp0KQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
b25uZWN0b3ItPmRldjsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbSwgKm1vZGUgPSBOVUxM
OwpAQCAtMjUwMCw3ICsyNTI1LDcgQEAgZHJtX21vZGVfc3RkKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsIHN0cnVjdCBlZGlkICplZGlkLAogICovCiBzdGF0aWMgdm9pZAogZHJtX21v
ZGVfZG9faW50ZXJsYWNlX3F1aXJrKHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAotCQkJ
ICAgIHN0cnVjdCBkZXRhaWxlZF9waXhlbF90aW1pbmcgKnB0KQorCQkJICAgIGNvbnN0IHN0cnVj
dCBkZXRhaWxlZF9waXhlbF90aW1pbmcgKnB0KQogewogCWludCBpOwogCXN0YXRpYyBjb25zdCBz
dHJ1Y3QgewpAQCAtMjU0MywxMiArMjU2OCwxMiBAQCBkcm1fbW9kZV9kb19pbnRlcmxhY2VfcXVp
cmsoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAgKiByZXR1cm4gYSBuZXcgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUuCiAgKi8KIHN0YXRpYyBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
ZHJtX21vZGVfZGV0YWlsZWQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQkJCSAgc3RydWN0
IGVkaWQgKmVkaWQsCi0JCQkJCQkgIHN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZywKKwkJ
CQkJCSAgY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQsCisJCQkJCQkgIGNvbnN0IHN0cnVjdCBkZXRh
aWxlZF90aW1pbmcgKnRpbWluZywKIAkJCQkJCSAgdTMyIHF1aXJrcykKIHsKIAlzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbW9kZTsKLQlzdHJ1Y3QgZGV0YWlsZWRfcGl4ZWxfdGltaW5nICpwdCA9
ICZ0aW1pbmctPmRhdGEucGl4ZWxfZGF0YTsKKwljb25zdCBzdHJ1Y3QgZGV0YWlsZWRfcGl4ZWxf
dGltaW5nICpwdCA9ICZ0aW1pbmctPmRhdGEucGl4ZWxfZGF0YTsKIAl1bnNpZ25lZCBoYWN0aXZl
ID0gKHB0LT5oYWN0aXZlX2hibGFua19oaSAmIDB4ZjApIDw8IDQgfCBwdC0+aGFjdGl2ZV9sbzsK
IAl1bnNpZ25lZCB2YWN0aXZlID0gKHB0LT52YWN0aXZlX3ZibGFua19oaSAmIDB4ZjApIDw8IDQg
fCBwdC0+dmFjdGl2ZV9sbzsKIAl1bnNpZ25lZCBoYmxhbmsgPSAocHQtPmhhY3RpdmVfaGJsYW5r
X2hpICYgMHhmKSA8PCA4IHwgcHQtPmhibGFua19sbzsKQEAgLTI1OTAsOSArMjYxNSw5IEBAIHN0
YXRpYyBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZHJtX21vZGVfZGV0YWlsZWQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAkJcmV0dXJuIE5VTEw7CiAKIAlpZiAocXVpcmtzICYgRURJRF9RVUlS
S18xMzVfQ0xPQ0tfVE9PX0hJR0gpCi0JCXRpbWluZy0+cGl4ZWxfY2xvY2sgPSBjcHVfdG9fbGUx
NigxMDg4KTsKLQotCW1vZGUtPmNsb2NrID0gbGUxNl90b19jcHUodGltaW5nLT5waXhlbF9jbG9j
aykgKiAxMDsKKwkJbW9kZS0+Y2xvY2sgPSAxMDg4ICogMTA7CisJZWxzZQorCQltb2RlLT5jbG9j
ayA9IGxlMTZfdG9fY3B1KHRpbWluZy0+cGl4ZWxfY2xvY2spICogMTA7CiAKIAltb2RlLT5oZGlz
cGxheSA9IGhhY3RpdmU7CiAJbW9kZS0+aHN5bmNfc3RhcnQgPSBtb2RlLT5oZGlzcGxheSArIGhz
eW5jX29mZnNldDsKQEAgLTI2MTMsMTQgKzI2MzgsMTQgQEAgc3RhdGljIHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICpkcm1fbW9kZV9kZXRhaWxlZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWRy
bV9tb2RlX2RvX2ludGVybGFjZV9xdWlyayhtb2RlLCBwdCk7CiAKIAlpZiAocXVpcmtzICYgRURJ
RF9RVUlSS19ERVRBSUxFRF9TWU5DX1BQKSB7Ci0JCXB0LT5taXNjIHw9IERSTV9FRElEX1BUX0hT
WU5DX1BPU0lUSVZFIHwgRFJNX0VESURfUFRfVlNZTkNfUE9TSVRJVkU7CisJCW1vZGUtPmZsYWdz
IHw9IERSTV9NT0RFX0ZMQUdfUEhTWU5DIHwgRFJNX01PREVfRkxBR19OVlNZTkM7CisJfSBlbHNl
IHsKKwkJbW9kZS0+ZmxhZ3MgfD0gKHB0LT5taXNjICYgRFJNX0VESURfUFRfSFNZTkNfUE9TSVRJ
VkUpID8KKwkJCURSTV9NT0RFX0ZMQUdfUEhTWU5DIDogRFJNX01PREVfRkxBR19OSFNZTkM7CisJ
CW1vZGUtPmZsYWdzIHw9IChwdC0+bWlzYyAmIERSTV9FRElEX1BUX1ZTWU5DX1BPU0lUSVZFKSA/
CisJCQlEUk1fTU9ERV9GTEFHX1BWU1lOQyA6IERSTV9NT0RFX0ZMQUdfTlZTWU5DOwogCX0KIAot
CW1vZGUtPmZsYWdzIHw9IChwdC0+bWlzYyAmIERSTV9FRElEX1BUX0hTWU5DX1BPU0lUSVZFKSA/
Ci0JCURSTV9NT0RFX0ZMQUdfUEhTWU5DIDogRFJNX01PREVfRkxBR19OSFNZTkM7Ci0JbW9kZS0+
ZmxhZ3MgfD0gKHB0LT5taXNjICYgRFJNX0VESURfUFRfVlNZTkNfUE9TSVRJVkUpID8KLQkJRFJN
X01PREVfRkxBR19QVlNZTkMgOiBEUk1fTU9ERV9GTEFHX05WU1lOQzsKLQogc2V0X3NpemU6CiAJ
bW9kZS0+d2lkdGhfbW0gPSBwdC0+d2lkdGhfbW1fbG8gfCAocHQtPndpZHRoX2hlaWdodF9tbV9o
aSAmIDB4ZjApIDw8IDQ7CiAJbW9kZS0+aGVpZ2h0X21tID0gcHQtPmhlaWdodF9tbV9sbyB8IChw
dC0+d2lkdGhfaGVpZ2h0X21tX2hpICYgMHhmKSA8PCA4OwpAQCAtMjY0NCw3ICsyNjY5LDcgQEAg
c3RhdGljIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpkcm1fbW9kZV9kZXRhaWxlZChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCiBzdGF0aWMgYm9vbAogbW9kZV9pbl9oc3luY19yYW5nZShjb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKLQkJICAgIHN0cnVjdCBlZGlkICplZGlk
LCB1OCAqdCkKKwkJICAgIGNvbnN0IHN0cnVjdCBlZGlkICplZGlkLCBjb25zdCB1OCAqdCkKIHsK
IAlpbnQgaHN5bmMsIGhtaW4sIGhtYXg7CiAKQEAgLTI2NjEsNyArMjY4Niw3IEBAIG1vZGVfaW5f
aHN5bmNfcmFuZ2UoY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAKIHN0YXRp
YyBib29sCiBtb2RlX2luX3ZzeW5jX3JhbmdlKGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICptb2RlLAotCQkgICAgc3RydWN0IGVkaWQgKmVkaWQsIHU4ICp0KQorCQkgICAgY29uc3Qgc3Ry
dWN0IGVkaWQgKmVkaWQsIGNvbnN0IHU4ICp0KQogewogCWludCB2c3luYywgdm1pbiwgdm1heDsK
IApAQCAtMjY3Nyw3ICsyNzAyLDcgQEAgbW9kZV9pbl92c3luY19yYW5nZShjb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKIH0KIAogc3RhdGljIHUzMgotcmFuZ2VfcGl4ZWxfY2xv
Y2soc3RydWN0IGVkaWQgKmVkaWQsIHU4ICp0KQorcmFuZ2VfcGl4ZWxfY2xvY2soY29uc3Qgc3Ry
dWN0IGVkaWQgKmVkaWQsIGNvbnN0IHU4ICp0KQogewogCS8qIHVuc3BlY2lmaWVkICovCiAJaWYg
KHRbOV0gPT0gMCB8fCB0WzldID09IDI1NSkKQEAgLTI2OTIsMTEgKzI3MTcsMTIgQEAgcmFuZ2Vf
cGl4ZWxfY2xvY2soc3RydWN0IGVkaWQgKmVkaWQsIHU4ICp0KQogfQogCiBzdGF0aWMgYm9vbAot
bW9kZV9pbl9yYW5nZShjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwgc3RydWN0
IGVkaWQgKmVkaWQsCi0JICAgICAgc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nKQorbW9k
ZV9pbl9yYW5nZShjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKKwkgICAgICBj
b25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCwKKwkgICAgICBjb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGlt
aW5nICp0aW1pbmcpCiB7CiAJdTMyIG1heF9jbG9jazsKLQl1OCAqdCA9ICh1OCAqKXRpbWluZzsK
Kwljb25zdCB1OCAqdCA9IChjb25zdCB1OCAqKXRpbWluZzsKIAogCWlmICghbW9kZV9pbl9oc3lu
Y19yYW5nZShtb2RlLCBlZGlkLCB0KSkKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjczOCw4ICsyNzY0
LDkgQEAgc3RhdGljIGJvb2wgdmFsaWRfaW5mZXJyZWRfbW9kZShjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yLAogfQogCiBzdGF0aWMgaW50Ci1kcm1fZG10X21vZGVzX2Zvcl9y
YW5nZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCwK
LQkJCXN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZykKK2RybV9kbXRfbW9kZXNfZm9yX3Jh
bmdlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQljb25zdCBzdHJ1Y3QgZWRp
ZCAqZWRpZCwKKwkJCWNvbnN0IHN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZykKIHsKIAlp
bnQgaSwgbW9kZXMgPSAwOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpuZXdtb2RlOwpAQCAt
Mjc3Myw4ICsyODAwLDkgQEAgdm9pZCBkcm1fbW9kZV9maXh1cF8xMzY2eDc2OChzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbW9kZSkKIH0KIAogc3RhdGljIGludAotZHJtX2d0Zl9tb2Rlc19mb3Jf
cmFuZ2Uoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQs
Ci0JCQlzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcpCitkcm1fZ3RmX21vZGVzX2Zvcl9y
YW5nZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJY29uc3Qgc3RydWN0IGVk
aWQgKmVkaWQsCisJCQljb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcpCiB7CiAJ
aW50IGksIG1vZGVzID0gMDsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbmV3bW9kZTsKQEAg
LTI4MDEsOCArMjgyOSw5IEBAIGRybV9ndGZfbW9kZXNfZm9yX3JhbmdlKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsIHN0cnVjdCBlZGlkICplZGlkLAogfQogCiBzdGF0aWMgaW50Ci1k
cm1fY3Z0X21vZGVzX2Zvcl9yYW5nZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBz
dHJ1Y3QgZWRpZCAqZWRpZCwKLQkJCXN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZykKK2Ry
bV9jdnRfbW9kZXNfZm9yX3JhbmdlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJ
CQljb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCwKKwkJCWNvbnN0IHN0cnVjdCBkZXRhaWxlZF90aW1p
bmcgKnRpbWluZykKIHsKIAlpbnQgaSwgbW9kZXMgPSAwOwogCXN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICpuZXdtb2RlOwpAQCAtMjgzMCwxMSArMjg1OSwxMSBAQCBkcm1fY3Z0X21vZGVzX2Zvcl9y
YW5nZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCwK
IH0KIAogc3RhdGljIHZvaWQKLWRvX2luZmVycmVkX21vZGVzKHN0cnVjdCBkZXRhaWxlZF90aW1p
bmcgKnRpbWluZywgdm9pZCAqYykKK2RvX2luZmVycmVkX21vZGVzKGNvbnN0IHN0cnVjdCBkZXRh
aWxlZF90aW1pbmcgKnRpbWluZywgdm9pZCAqYykKIHsKIAlzdHJ1Y3QgZGV0YWlsZWRfbW9kZV9j
bG9zdXJlICpjbG9zdXJlID0gYzsKLQlzdHJ1Y3QgZGV0YWlsZWRfbm9uX3BpeGVsICpkYXRhID0g
JnRpbWluZy0+ZGF0YS5vdGhlcl9kYXRhOwotCXN0cnVjdCBkZXRhaWxlZF9kYXRhX21vbml0b3Jf
cmFuZ2UgKnJhbmdlID0gJmRhdGEtPmRhdGEucmFuZ2U7CisJY29uc3Qgc3RydWN0IGRldGFpbGVk
X25vbl9waXhlbCAqZGF0YSA9ICZ0aW1pbmctPmRhdGEub3RoZXJfZGF0YTsKKwljb25zdCBzdHJ1
Y3QgZGV0YWlsZWRfZGF0YV9tb25pdG9yX3JhbmdlICpyYW5nZSA9ICZkYXRhLT5kYXRhLnJhbmdl
OwogCiAJaWYgKCFpc19kaXNwbGF5X2Rlc2NyaXB0b3IoKGNvbnN0IHU4ICopdGltaW5nLCBFRElE
X0RFVEFJTF9NT05JVE9SX1JBTkdFKSkKIAkJcmV0dXJuOwpAQCAtMjg2OCw3ICsyODk3LDggQEAg
ZG9faW5mZXJyZWRfbW9kZXMoc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nLCB2b2lkICpj
KQogfQogCiBzdGF0aWMgaW50Ci1hZGRfaW5mZXJyZWRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQpCithZGRfaW5mZXJyZWRfbW9kZXMoc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJICAgY29uc3Qgc3RydWN0IGVkaWQgKmVk
aWQpCiB7CiAJc3RydWN0IGRldGFpbGVkX21vZGVfY2xvc3VyZSBjbG9zdXJlID0gewogCQkuY29u
bmVjdG9yID0gY29ubmVjdG9yLApAQCAtMjg3NiwxOCArMjkwNiwyMCBAQCBhZGRfaW5mZXJyZWRf
bW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQp
CiAJfTsKIAogCWlmICh2ZXJzaW9uX2dyZWF0ZXIoZWRpZCwgMSwgMCkpCi0JCWRybV9mb3JfZWFj
aF9kZXRhaWxlZF9ibG9jaygodTggKillZGlkLCBkb19pbmZlcnJlZF9tb2RlcywKKwkJZHJtX2Zv
cl9lYWNoX2RldGFpbGVkX2Jsb2NrKChjb25zdCB1OCAqKWVkaWQsCisJCQkJCSAgICBkb19pbmZl
cnJlZF9tb2RlcywKIAkJCQkJICAgICZjbG9zdXJlKTsKIAogCXJldHVybiBjbG9zdXJlLm1vZGVz
OwogfQogCiBzdGF0aWMgaW50Ci1kcm1fZXN0M19tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yLCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcpCitkcm1fZXN0M19tb2Rl
cyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCSAgICAgICBjb25zdCBzdHJ1Y3Qg
ZGV0YWlsZWRfdGltaW5nICp0aW1pbmcpCiB7CiAJaW50IGksIGosIG0sIG1vZGVzID0gMDsKIAlz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKLQl1OCAqZXN0ID0gKCh1OCAqKXRpbWluZykg
KyA2OworCWNvbnN0IHU4ICplc3QgPSAoKGNvbnN0IHU4ICopdGltaW5nKSArIDY7CiAKIAlmb3Ig
KGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAJCWZvciAoaiA9IDc7IGogPj0gMDsgai0tKSB7CkBAIC0y
OTEyLDcgKzI5NDQsNyBAQCBkcm1fZXN0M19tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29u
bmVjdG9yLCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcpCiB9CiAKIHN0YXRpYyB2b2lk
Ci1kb19lc3RhYmxpc2hlZF9tb2RlcyhzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZv
aWQgKmMpCitkb19lc3RhYmxpc2hlZF9tb2Rlcyhjb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5n
ICp0aW1pbmcsIHZvaWQgKmMpCiB7CiAJc3RydWN0IGRldGFpbGVkX21vZGVfY2xvc3VyZSAqY2xv
c3VyZSA9IGM7CiAKQEAgLTI5MzEsNyArMjk2Myw4IEBAIGRvX2VzdGFibGlzaGVkX21vZGVzKHN0
cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZywgdm9pZCAqYykKICAqIChkZWZpbmVkIGFib3Zl
KS4gIFRlYXNlIHRoZW0gb3V0IGFuZCBhZGQgdGhlbSB0byB0aGUgZ2xvYmFsIG1vZGVzIGxpc3Qu
CiAgKi8KIHN0YXRpYyBpbnQKLWFkZF9lc3RhYmxpc2hlZF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCkKK2FkZF9lc3RhYmxpc2hlZF9tb2Rl
cyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkgICAgICBjb25zdCBzdHJ1Y3Qg
ZWRpZCAqZWRpZCkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5kZXY7
CiAJdW5zaWduZWQgbG9uZyBlc3RfYml0cyA9IGVkaWQtPmVzdGFibGlzaGVkX3RpbWluZ3MudDEg
fApAQCAtMjk2MiwxOSArMjk5NSwxOSBAQCBhZGRfZXN0YWJsaXNoZWRfbW9kZXMoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQpCiB9CiAKIHN0YXRpYyB2
b2lkCi1kb19zdGFuZGFyZF9tb2RlcyhzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZv
aWQgKmMpCitkb19zdGFuZGFyZF9tb2Rlcyhjb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0
aW1pbmcsIHZvaWQgKmMpCiB7CiAJc3RydWN0IGRldGFpbGVkX21vZGVfY2xvc3VyZSAqY2xvc3Vy
ZSA9IGM7Ci0Jc3RydWN0IGRldGFpbGVkX25vbl9waXhlbCAqZGF0YSA9ICZ0aW1pbmctPmRhdGEu
b3RoZXJfZGF0YTsKKwljb25zdCBzdHJ1Y3QgZGV0YWlsZWRfbm9uX3BpeGVsICpkYXRhID0gJnRp
bWluZy0+ZGF0YS5vdGhlcl9kYXRhOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Ig
PSBjbG9zdXJlLT5jb25uZWN0b3I7Ci0Jc3RydWN0IGVkaWQgKmVkaWQgPSBjbG9zdXJlLT5lZGlk
OworCWNvbnN0IHN0cnVjdCBlZGlkICplZGlkID0gY2xvc3VyZS0+ZWRpZDsKIAlpbnQgaTsKIAog
CWlmICghaXNfZGlzcGxheV9kZXNjcmlwdG9yKChjb25zdCB1OCAqKXRpbWluZywgRURJRF9ERVRB
SUxfU1REX01PREVTKSkKIAkJcmV0dXJuOwogCiAJZm9yIChpID0gMDsgaSA8IDY7IGkrKykgewot
CQlzdHJ1Y3Qgc3RkX3RpbWluZyAqc3RkID0gJmRhdGEtPmRhdGEudGltaW5nc1tpXTsKKwkJY29u
c3Qgc3RydWN0IHN0ZF90aW1pbmcgKnN0ZCA9ICZkYXRhLT5kYXRhLnRpbWluZ3NbaV07CiAJCXN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICpuZXdtb2RlOwogCiAJCW5ld21vZGUgPSBkcm1fbW9kZV9z
dGQoY29ubmVjdG9yLCBlZGlkLCBzdGQpOwpAQCAtMjk5NCw3ICszMDI3LDggQEAgZG9fc3RhbmRh
cmRfbW9kZXMoc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nLCB2b2lkICpjKQogICogR1RG
IG9yIENWVC4gR3JhYiB0aGVtIGZyb20gQGVkaWQgYW5kIGFkZCB0aGVtIHRvIHRoZSBsaXN0Lgog
ICovCiBzdGF0aWMgaW50Ci1hZGRfc3RhbmRhcmRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3Rvciwgc3RydWN0IGVkaWQgKmVkaWQpCithZGRfc3RhbmRhcmRfbW9kZXMoc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJICAgY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQp
CiB7CiAJaW50IGksIG1vZGVzID0gMDsKIAlzdHJ1Y3QgZGV0YWlsZWRfbW9kZV9jbG9zdXJlIGNs
b3N1cmUgPSB7CkBAIC0zMDIzLDE4ICszMDU3LDE4IEBAIGFkZF9zdGFuZGFyZF9tb2RlcyhzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCkKIH0KIAogc3Rh
dGljIGludCBkcm1fY3Z0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCi0J
CQkgc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nKQorCQkJIGNvbnN0IHN0cnVjdCBkZXRh
aWxlZF90aW1pbmcgKnRpbWluZykKIHsKIAlpbnQgaSwgaiwgbW9kZXMgPSAwOwogCXN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICpuZXdtb2RlOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjb25u
ZWN0b3ItPmRldjsKLQlzdHJ1Y3QgY3Z0X3RpbWluZyAqY3Z0OwogCWNvbnN0IGludCByYXRlc1td
ID0geyA2MCwgODUsIDc1LCA2MCwgNTAgfTsKIAljb25zdCB1OCBlbXB0eVszXSA9IHsgMCwgMCwg
MCB9OwogCiAJZm9yIChpID0gMDsgaSA8IDQ7IGkrKykgewogCQlpbnQgdW5pbml0aWFsaXplZF92
YXIod2lkdGgpLCBoZWlnaHQ7Ci0JCWN2dCA9ICYodGltaW5nLT5kYXRhLm90aGVyX2RhdGEuZGF0
YS5jdnRbaV0pOworCQljb25zdCBzdHJ1Y3QgY3Z0X3RpbWluZyAqY3Z0ID0KKwkJCSZ0aW1pbmct
PmRhdGEub3RoZXJfZGF0YS5kYXRhLmN2dFtpXTsKIAogCQlpZiAoIW1lbWNtcChjdnQtPmNvZGUs
IGVtcHR5LCAzKSkKIAkJCWNvbnRpbnVlOwpAQCAtMzA3Miw3ICszMTA2LDcgQEAgc3RhdGljIGlu
dCBkcm1fY3Z0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiB9CiAKIHN0
YXRpYyB2b2lkCi1kb19jdnRfbW9kZShzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZv
aWQgKmMpCitkb19jdnRfbW9kZShjb25zdCBzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcs
IHZvaWQgKmMpCiB7CiAJc3RydWN0IGRldGFpbGVkX21vZGVfY2xvc3VyZSAqY2xvc3VyZSA9IGM7
CiAKQEAgLTMwODMsNyArMzExNyw4IEBAIGRvX2N2dF9tb2RlKHN0cnVjdCBkZXRhaWxlZF90aW1p
bmcgKnRpbWluZywgdm9pZCAqYykKIH0KIAogc3RhdGljIGludAotYWRkX2N2dF9tb2RlcyhzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCkKK2FkZF9jdnRf
bW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkgICAgICBjb25zdCBzdHJ1
Y3QgZWRpZCAqZWRpZCkKIHsKIAlzdHJ1Y3QgZGV0YWlsZWRfbW9kZV9jbG9zdXJlIGNsb3N1cmUg
PSB7CiAJCS5jb25uZWN0b3IgPSBjb25uZWN0b3IsCkBAIC0zMTAxLDcgKzMxMzYsNyBAQCBhZGRf
Y3Z0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIHN0cnVjdCBlZGlkICpl
ZGlkKQogc3RhdGljIHZvaWQgZml4dXBfZGV0YWlsZWRfY2VhX21vZGVfY2xvY2soc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKm1vZGUpOwogCiBzdGF0aWMgdm9pZAotZG9fZGV0YWlsZWRfbW9kZShz
dHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1pbmcsIHZvaWQgKmMpCitkb19kZXRhaWxlZF9tb2Rl
KGNvbnN0IHN0cnVjdCBkZXRhaWxlZF90aW1pbmcgKnRpbWluZywgdm9pZCAqYykKIHsKIAlzdHJ1
Y3QgZGV0YWlsZWRfbW9kZV9jbG9zdXJlICpjbG9zdXJlID0gYzsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbmV3bW9kZTsKQEAgLTMxMzcsOCArMzE3Miw4IEBAIGRvX2RldGFpbGVkX21vZGUo
c3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nLCB2b2lkICpjKQogICogQHF1aXJrczogcXVp
cmtzIHRvIGFwcGx5CiAgKi8KIHN0YXRpYyBpbnQKLWFkZF9kZXRhaWxlZF9tb2RlcyhzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBzdHJ1Y3QgZWRpZCAqZWRpZCwKLQkJICAgdTMyIHF1
aXJrcykKK2FkZF9kZXRhaWxlZF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
LAorCQkgICBzdHJ1Y3QgZWRpZCAqZWRpZCwgdTMyIHF1aXJrcykKIHsKIAlzdHJ1Y3QgZGV0YWls
ZWRfbW9kZV9jbG9zdXJlIGNsb3N1cmUgPSB7CiAJCS5jb25uZWN0b3IgPSBjb25uZWN0b3IsCkBA
IC0zMTczLDkgKzMyMDgsMTAgQEAgYWRkX2RldGFpbGVkX21vZGVzKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IsIHN0cnVjdCBlZGlkICplZGlkLAogLyoKICAqIFNlYXJjaCBFRElEIGZv
ciBDRUEgZXh0ZW5zaW9uIGJsb2NrLgogICovCi1zdGF0aWMgdTggKmRybV9maW5kX2VkaWRfZXh0
ZW5zaW9uKGNvbnN0IHN0cnVjdCBlZGlkICplZGlkLCBpbnQgZXh0X2lkKQorc3RhdGljIGNvbnN0
IHU4ICpkcm1fZmluZF9lZGlkX2V4dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCwKKwkJ
CQkJIGludCBleHRfaWQpCiB7Ci0JdTggKmVkaWRfZXh0ID0gTlVMTDsKKwljb25zdCB1OCAqZWRp
ZF9leHQgPSBOVUxMOwogCWludCBpOwogCiAJLyogTm8gRURJRCBvciBFRElEIGV4dGVuc2lvbnMg
Ki8KQEAgLTMxODQsNyArMzIyMCw3IEBAIHN0YXRpYyB1OCAqZHJtX2ZpbmRfZWRpZF9leHRlbnNp
b24oY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQsIGludCBleHRfaWQpCiAKIAkvKiBGaW5kIENFQSBl
eHRlbnNpb24gKi8KIAlmb3IgKGkgPSAwOyBpIDwgZWRpZC0+ZXh0ZW5zaW9uczsgaSsrKSB7Ci0J
CWVkaWRfZXh0ID0gKHU4ICopZWRpZCArIEVESURfTEVOR1RIICogKGkgKyAxKTsKKwkJZWRpZF9l
eHQgPSAoY29uc3QgdTggKillZGlkICsgRURJRF9MRU5HVEggKiAoaSArIDEpOwogCQlpZiAoZWRp
ZF9leHRbMF0gPT0gZXh0X2lkKQogCQkJYnJlYWs7CiAJfQpAQCAtMzE5NiwxOSArMzIzMiwxOSBA
QCBzdGF0aWMgdTggKmRybV9maW5kX2VkaWRfZXh0ZW5zaW9uKGNvbnN0IHN0cnVjdCBlZGlkICpl
ZGlkLCBpbnQgZXh0X2lkKQogfQogCiAKLXN0YXRpYyB1OCAqZHJtX2ZpbmRfZGlzcGxheWlkX2V4
dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCkKK3N0YXRpYyBjb25zdCB1OCAqZHJtX2Zp
bmRfZGlzcGxheWlkX2V4dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCkKIHsKIAlyZXR1
cm4gZHJtX2ZpbmRfZWRpZF9leHRlbnNpb24oZWRpZCwgRElTUExBWUlEX0VYVCk7CiB9CiAKLXN0
YXRpYyB1OCAqZHJtX2ZpbmRfY2VhX2V4dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCkK
K3N0YXRpYyBjb25zdCB1OCAqZHJtX2ZpbmRfY2VhX2V4dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRp
ZCAqZWRpZCkKIHsKIAlpbnQgcmV0OwogCWludCBpZHggPSAxOwogCWludCBsZW5ndGggPSBFRElE
X0xFTkdUSDsKLQlzdHJ1Y3QgZGlzcGxheWlkX2Jsb2NrICpibG9jazsKLQl1OCAqY2VhOwotCXU4
ICpkaXNwbGF5aWQ7CisJY29uc3Qgc3RydWN0IGRpc3BsYXlpZF9ibG9jayAqYmxvY2s7CisJY29u
c3QgdTggKmNlYTsKKwljb25zdCB1OCAqZGlzcGxheWlkOwogCiAJLyogTG9vayBmb3IgYSB0b3Ag
bGV2ZWwgQ0VBIGV4dGVuc2lvbiBibG9jayAqLwogCWNlYSA9IGRybV9maW5kX2VkaWRfZXh0ZW5z
aW9uKGVkaWQsIENFQV9FWFQpOwpAQCAtNDMxNSwyOCArNDM1MSwzMCBAQCBkcm1fcGFyc2VfaGRt
aV92c2RiX2F1ZGlvKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGNvbnN0IHU4ICpk
YikKIH0KIAogc3RhdGljIHZvaWQKLW1vbml0b3JfbmFtZShzdHJ1Y3QgZGV0YWlsZWRfdGltaW5n
ICp0LCB2b2lkICpkYXRhKQorbW9uaXRvcl9uYW1lKGNvbnN0IHN0cnVjdCBkZXRhaWxlZF90aW1p
bmcgKnQsIHZvaWQgKmMpCiB7CisJc3RydWN0IGRhdGFfY2xvc3VyZSAqY2xvc3VyZSA9IGM7CisK
IAlpZiAoIWlzX2Rpc3BsYXlfZGVzY3JpcHRvcigoY29uc3QgdTggKil0LCBFRElEX0RFVEFJTF9N
T05JVE9SX05BTUUpKQogCQlyZXR1cm47CiAKLQkqKHU4ICoqKWRhdGEgPSB0LT5kYXRhLm90aGVy
X2RhdGEuZGF0YS5zdHIuc3RyOworCWNsb3N1cmUtPmRhdGEgPSB0LT5kYXRhLm90aGVyX2RhdGEu
ZGF0YS5zdHIuc3RyOwogfQogCiBzdGF0aWMgaW50IGdldF9tb25pdG9yX25hbWUoc3RydWN0IGVk
aWQgKmVkaWQsIGNoYXIgbmFtZVsxM10pCiB7Ci0JY2hhciAqZWRpZF9uYW1lID0gTlVMTDsKKwlz
dHJ1Y3QgZGF0YV9jbG9zdXJlIGNsb3N1cmUgPSB7fTsKIAlpbnQgbW5sOwogCiAJaWYgKCFlZGlk
IHx8ICFuYW1lKQogCQlyZXR1cm4gMDsKIAotCWRybV9mb3JfZWFjaF9kZXRhaWxlZF9ibG9jaygo
dTggKillZGlkLCBtb25pdG9yX25hbWUsICZlZGlkX25hbWUpOwotCWZvciAobW5sID0gMDsgZWRp
ZF9uYW1lICYmIG1ubCA8IDEzOyBtbmwrKykgewotCQlpZiAoZWRpZF9uYW1lW21ubF0gPT0gMHgw
YSkKKwlkcm1fZm9yX2VhY2hfZGV0YWlsZWRfYmxvY2soKGNvbnN0IHU4ICopZWRpZCwgbW9uaXRv
cl9uYW1lLCAmY2xvc3VyZSk7CisJZm9yIChtbmwgPSAwOyBjbG9zdXJlLmRhdGEgJiYgbW5sIDwg
MTM7IG1ubCsrKSB7CisJCWlmIChjbG9zdXJlLmRhdGFbbW5sXSA9PSAweDBhKQogCQkJYnJlYWs7
CiAKLQkJbmFtZVttbmxdID0gZWRpZF9uYW1lW21ubF07CisJCW5hbWVbbW5sXSA9IGNsb3N1cmUu
ZGF0YVttbmxdOwogCX0KIAogCXJldHVybiBtbmw7CkBAIC00Mzg2LDExICs0NDI0LDkgQEAgc3Rh
dGljIHZvaWQgY2xlYXJfZWxkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiBzdGF0
aWMgdm9pZCBkcm1fZWRpZF90b19lbGQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvciwg
c3RydWN0IGVkaWQgKmVkaWQpCiB7CiAJdWludDhfdCAqZWxkID0gY29ubmVjdG9yLT5lbGQ7Ci0J
dTggKmNlYTsKLQl1OCAqZGI7CisJY29uc3QgdTggKmNlYTsKIAlpbnQgdG90YWxfc2FkX2NvdW50
ID0gMDsKIAlpbnQgbW5sOwotCWludCBkYmw7CiAKIAljbGVhcl9lbGQoY29ubmVjdG9yKTsKIApA
QCAtNDQyNSw4ICs0NDYxLDggQEAgc3RhdGljIHZvaWQgZHJtX2VkaWRfdG9fZWxkKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsIHN0cnVjdCBlZGlkICplZGlkKQogCQl9CiAKIAkJZm9y
X2VhY2hfY2VhX2RiKGNlYSwgaSwgc3RhcnQsIGVuZCkgewotCQkJZGIgPSAmY2VhW2ldOwotCQkJ
ZGJsID0gY2VhX2RiX3BheWxvYWRfbGVuKGRiKTsKKwkJCWNvbnN0IHU4ICpkYiA9ICZjZWFbaV07
CisJCQlpbnQgZGJsID0gY2VhX2RiX3BheWxvYWRfbGVuKGRiKTsKIAogCQkJc3dpdGNoIChjZWFf
ZGJfdGFnKGRiKSkgewogCQkJCWludCBzYWRfY291bnQ7CkBAIC00NDg0LDcgKzQ1MjAsNyBAQCBp
bnQgZHJtX2VkaWRfdG9fc2FkKHN0cnVjdCBlZGlkICplZGlkLCBzdHJ1Y3QgY2VhX3NhZCAqKnNh
ZHMpCiB7CiAJaW50IGNvdW50ID0gMDsKIAlpbnQgaSwgc3RhcnQsIGVuZCwgZGJsOwotCXU4ICpj
ZWE7CisJY29uc3QgdTggKmNlYTsKIAogCWNlYSA9IGRybV9maW5kX2NlYV9leHRlbnNpb24oZWRp
ZCk7CiAJaWYgKCFjZWEpIHsKQEAgLTQ1MDMsNyArNDUzOSw3IEBAIGludCBkcm1fZWRpZF90b19z
YWQoc3RydWN0IGVkaWQgKmVkaWQsIHN0cnVjdCBjZWFfc2FkICoqc2FkcykKIAl9CiAKIAlmb3Jf
ZWFjaF9jZWFfZGIoY2VhLCBpLCBzdGFydCwgZW5kKSB7Ci0JCXU4ICpkYiA9ICZjZWFbaV07CisJ
CWNvbnN0IHU4ICpkYiA9ICZjZWFbaV07CiAKIAkJaWYgKGNlYV9kYl90YWcoZGIpID09IEFVRElP
X0JMT0NLKSB7CiAJCQlpbnQgajsKQEAgLTQ1MTQsNyArNDU1MCw3IEBAIGludCBkcm1fZWRpZF90
b19zYWQoc3RydWN0IGVkaWQgKmVkaWQsIHN0cnVjdCBjZWFfc2FkICoqc2FkcykKIAkJCWlmICgh
KnNhZHMpCiAJCQkJcmV0dXJuIC1FTk9NRU07CiAJCQlmb3IgKGogPSAwOyBqIDwgY291bnQ7IGor
KykgewotCQkJCXU4ICpzYWQgPSAmZGJbMSArIGogKiAzXTsKKwkJCQljb25zdCB1OCAqc2FkID0g
JmRiWzEgKyBqICogM107CiAKIAkJCQkoKnNhZHMpW2pdLmZvcm1hdCA9IChzYWRbMF0gJiAweDc4
KSA+PiAzOwogCQkJCSgqc2Fkcylbal0uY2hhbm5lbHMgPSBzYWRbMF0gJiAweDc7CkBAIC00NjM1
LDcgKzQ2NzEsNyBAQCBFWFBPUlRfU1lNQk9MKGRybV9hdl9zeW5jX2RlbGF5KTsKICAqLwogYm9v
bCBkcm1fZGV0ZWN0X2hkbWlfbW9uaXRvcihzdHJ1Y3QgZWRpZCAqZWRpZCkKIHsKLQl1OCAqZWRp
ZF9leHQ7CisJY29uc3QgdTggKmVkaWRfZXh0OwogCWludCBpOwogCWludCBzdGFydF9vZmZzZXQs
IGVuZF9vZmZzZXQ7CiAKQEAgLTQ2NzMsNyArNDcwOSw3IEBAIEVYUE9SVF9TWU1CT0woZHJtX2Rl
dGVjdF9oZG1pX21vbml0b3IpOwogICovCiBib29sIGRybV9kZXRlY3RfbW9uaXRvcl9hdWRpbyhz
dHJ1Y3QgZWRpZCAqZWRpZCkKIHsKLQl1OCAqZWRpZF9leHQ7CisJY29uc3QgdTggKmVkaWRfZXh0
OwogCWludCBpLCBqOwogCWJvb2wgaGFzX2F1ZGlvID0gZmFsc2U7CiAJaW50IHN0YXJ0X29mZnNl
dCwgZW5kX29mZnNldDsKQEAgLTUwMTcsMTMgKzUwNTMsMTMgQEAgdTMyIGRybV9hZGRfZGlzcGxh
eV9pbmZvKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGNvbnN0IHN0cnVjdCBlZGlk
ICplZGkKIAlyZXR1cm4gcXVpcmtzOwogfQogCi1zdGF0aWMgaW50IHZhbGlkYXRlX2Rpc3BsYXlp
ZCh1OCAqZGlzcGxheWlkLCBpbnQgbGVuZ3RoLCBpbnQgaWR4KQorc3RhdGljIGludCB2YWxpZGF0
ZV9kaXNwbGF5aWQoY29uc3QgdTggKmRpc3BsYXlpZCwgaW50IGxlbmd0aCwgaW50IGlkeCkKIHsK
IAlpbnQgaTsKIAl1OCBjc3VtID0gMDsKLQlzdHJ1Y3QgZGlzcGxheWlkX2hkciAqYmFzZTsKKwlj
b25zdCBzdHJ1Y3QgZGlzcGxheWlkX2hkciAqYmFzZTsKIAotCWJhc2UgPSAoc3RydWN0IGRpc3Bs
YXlpZF9oZHIgKikmZGlzcGxheWlkW2lkeF07CisJYmFzZSA9IChjb25zdCBzdHJ1Y3QgZGlzcGxh
eWlkX2hkciAqKSZkaXNwbGF5aWRbaWR4XTsKIAogCURSTV9ERUJVR19LTVMoImJhc2UgcmV2aXNp
b24gMHgleCwgbGVuZ3RoICVkLCAlZCAlZFxuIiwKIAkJICAgICAgYmFzZS0+cmV2LCBiYXNlLT5i
eXRlcywgYmFzZS0+cHJvZF9pZCwgYmFzZS0+ZXh0X2NvdW50KTsKQEAgLTUwNDEsNyArNTA3Nyw3
IEBAIHN0YXRpYyBpbnQgdmFsaWRhdGVfZGlzcGxheWlkKHU4ICpkaXNwbGF5aWQsIGludCBsZW5n
dGgsIGludCBpZHgpCiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZHJtX21v
ZGVfZGlzcGxheWlkX2RldGFpbGVkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJCQkJICAg
IHN0cnVjdCBkaXNwbGF5aWRfZGV0YWlsZWRfdGltaW5nc18xICp0aW1pbmdzKQorCQkJCQkJCSAg
ICBjb25zdCBzdHJ1Y3QgZGlzcGxheWlkX2RldGFpbGVkX3RpbWluZ3NfMSAqdGltaW5ncykKIHsK
IAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKIAl1bnNpZ25lZCBwaXhlbF9jbG9jayA9
ICh0aW1pbmdzLT5waXhlbF9jbG9ja1swXSB8CkBAIC01MDU3LDYgKzUwOTMsNyBAQCBzdGF0aWMg
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRybV9tb2RlX2Rpc3BsYXlpZF9kZXRhaWxlZChzdHJ1
Y3QgZHJtX2RldmljZSAqZAogCXVuc2lnbmVkIHZzeW5jX3dpZHRoID0gKHRpbWluZ3MtPnZzd1sw
XSB8IHRpbWluZ3MtPnZzd1sxXSA8PCA4KSArIDE7CiAJYm9vbCBoc3luY19wb3NpdGl2ZSA9ICh0
aW1pbmdzLT5oc3luY1sxXSA+PiA3KSAmIDB4MTsKIAlib29sIHZzeW5jX3Bvc2l0aXZlID0gKHRp
bWluZ3MtPnZzeW5jWzFdID4+IDcpICYgMHgxOworCiAJbW9kZSA9IGRybV9tb2RlX2NyZWF0ZShk
ZXYpOwogCWlmICghbW9kZSkKIAkJcmV0dXJuIE5VTEw7CkBAIC01MDg2LDkgKzUxMjMsMTAgQEAg
c3RhdGljIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpkcm1fbW9kZV9kaXNwbGF5aWRfZGV0YWls
ZWQoc3RydWN0IGRybV9kZXZpY2UgKmQKIH0KIAogc3RhdGljIGludCBhZGRfZGlzcGxheWlkX2Rl
dGFpbGVkXzFfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCQkJICBz
dHJ1Y3QgZGlzcGxheWlkX2Jsb2NrICpibG9jaykKKwkJCQkJICBjb25zdCBzdHJ1Y3QgZGlzcGxh
eWlkX2Jsb2NrICpibG9jaykKIHsKLQlzdHJ1Y3QgZGlzcGxheWlkX2RldGFpbGVkX3RpbWluZ19i
bG9jayAqZGV0ID0gKHN0cnVjdCBkaXNwbGF5aWRfZGV0YWlsZWRfdGltaW5nX2Jsb2NrICopYmxv
Y2s7CisJY29uc3Qgc3RydWN0IGRpc3BsYXlpZF9kZXRhaWxlZF90aW1pbmdfYmxvY2sgKmRldCA9
CisJCShjb25zdCBzdHJ1Y3QgZGlzcGxheWlkX2RldGFpbGVkX3RpbWluZ19ibG9jayAqKWJsb2Nr
OwogCWludCBpOwogCWludCBudW1fdGltaW5nczsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
bmV3bW9kZTsKQEAgLTUwOTksNyArNTEzNyw3IEBAIHN0YXRpYyBpbnQgYWRkX2Rpc3BsYXlpZF9k
ZXRhaWxlZF8xX21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAKIAludW1f
dGltaW5ncyA9IGJsb2NrLT5udW1fYnl0ZXMgLyAyMDsKIAlmb3IgKGkgPSAwOyBpIDwgbnVtX3Rp
bWluZ3M7IGkrKykgewotCQlzdHJ1Y3QgZGlzcGxheWlkX2RldGFpbGVkX3RpbWluZ3NfMSAqdGlt
aW5ncyA9ICZkZXQtPnRpbWluZ3NbaV07CisJCWNvbnN0IHN0cnVjdCBkaXNwbGF5aWRfZGV0YWls
ZWRfdGltaW5nc18xICp0aW1pbmdzID0gJmRldC0+dGltaW5nc1tpXTsKIAogCQluZXdtb2RlID0g
ZHJtX21vZGVfZGlzcGxheWlkX2RldGFpbGVkKGNvbm5lY3Rvci0+ZGV2LCB0aW1pbmdzKTsKIAkJ
aWYgKCFuZXdtb2RlKQpAQCAtNTExMiwxMyArNTE1MCwxMyBAQCBzdGF0aWMgaW50IGFkZF9kaXNw
bGF5aWRfZGV0YWlsZWRfMV9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAog
fQogCiBzdGF0aWMgaW50IGFkZF9kaXNwbGF5aWRfZGV0YWlsZWRfbW9kZXMoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCQkJc3RydWN0IGVkaWQgKmVkaWQpCisJCQkJCWNvbnN0
IHN0cnVjdCBlZGlkICplZGlkKQogewotCXU4ICpkaXNwbGF5aWQ7CisJY29uc3QgdTggKmRpc3Bs
YXlpZDsKIAlpbnQgcmV0OwogCWludCBpZHggPSAxOwogCWludCBsZW5ndGggPSBFRElEX0xFTkdU
SDsKLQlzdHJ1Y3QgZGlzcGxheWlkX2Jsb2NrICpibG9jazsKKwljb25zdCBzdHJ1Y3QgZGlzcGxh
eWlkX2Jsb2NrICpibG9jazsKIAlpbnQgbnVtX21vZGVzID0gMDsKIAogCWRpc3BsYXlpZCA9IGRy
bV9maW5kX2Rpc3BsYXlpZF9leHRlbnNpb24oZWRpZCk7CkBAIC01NzIwLDkgKzU3NTgsMTAgQEAg
ZHJtX2hkbWlfdmVuZG9yX2luZm9mcmFtZV9mcm9tX2Rpc3BsYXlfbW9kZShzdHJ1Y3QgaGRtaV92
ZW5kb3JfaW5mb2ZyYW1lICpmcmFtZSwKIEVYUE9SVF9TWU1CT0woZHJtX2hkbWlfdmVuZG9yX2lu
Zm9mcmFtZV9mcm9tX2Rpc3BsYXlfbW9kZSk7CiAKIHN0YXRpYyBpbnQgZHJtX3BhcnNlX3RpbGVk
X2Jsb2NrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCi0JCQkJIHN0cnVjdCBkaXNw
bGF5aWRfYmxvY2sgKmJsb2NrKQorCQkJCSBjb25zdCBzdHJ1Y3QgZGlzcGxheWlkX2Jsb2NrICpi
bG9jaykKIHsKLQlzdHJ1Y3QgZGlzcGxheWlkX3RpbGVkX2Jsb2NrICp0aWxlID0gKHN0cnVjdCBk
aXNwbGF5aWRfdGlsZWRfYmxvY2sgKilibG9jazsKKwljb25zdCBzdHJ1Y3QgZGlzcGxheWlkX3Rp
bGVkX2Jsb2NrICp0aWxlID0KKwkJKGNvbnN0IHN0cnVjdCBkaXNwbGF5aWRfdGlsZWRfYmxvY2sg
KilibG9jazsKIAl1MTYgdywgaDsKIAl1OCB0aWxlX3ZfbG9jLCB0aWxlX2hfbG9jOwogCXU4IG51
bV92X3RpbGUsIG51bV9oX3RpbGU7CkBAIC01Nzc0LDEyICs1ODEzLDEyIEBAIHN0YXRpYyBpbnQg
ZHJtX3BhcnNlX3RpbGVkX2Jsb2NrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiB9
CiAKIHN0YXRpYyBpbnQgZHJtX3BhcnNlX2Rpc3BsYXlfaWQoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKLQkJCQl1OCAqZGlzcGxheWlkLCBpbnQgbGVuZ3RoLAorCQkJCWNvbnN0IHU4
ICpkaXNwbGF5aWQsIGludCBsZW5ndGgsCiAJCQkJYm9vbCBpc19lZGlkX2V4dGVuc2lvbikKIHsK
IAkvKiBpZiB0aGlzIGlzIGFuIEVESUQgZXh0ZW5zaW9uIHRoZSBmaXJzdCBieXRlIHdpbGwgYmUg
MHg3MCAqLwogCWludCBpZHggPSAwOwotCXN0cnVjdCBkaXNwbGF5aWRfYmxvY2sgKmJsb2NrOwor
CWNvbnN0IHN0cnVjdCBkaXNwbGF5aWRfYmxvY2sgKmJsb2NrOwogCWludCByZXQ7CiAKIAlpZiAo
aXNfZWRpZF9leHRlbnNpb24pCkBAIC01ODE1LDExICs1ODU0LDEzIEBAIHN0YXRpYyBpbnQgZHJt
X3BhcnNlX2Rpc3BsYXlfaWQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIH0KIAog
c3RhdGljIHZvaWQgZHJtX2dldF9kaXNwbGF5aWQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5l
Y3RvciwKLQkJCSAgICAgIHN0cnVjdCBlZGlkICplZGlkKQorCQkJICAgICAgY29uc3Qgc3RydWN0
IGVkaWQgKmVkaWQpCiB7Ci0Jdm9pZCAqZGlzcGxheWlkID0gTlVMTDsKKwljb25zdCB2b2lkICpk
aXNwbGF5aWQ7CiAJaW50IHJldDsKKwogCWNvbm5lY3Rvci0+aGFzX3RpbGUgPSBmYWxzZTsKKwog
CWRpc3BsYXlpZCA9IGRybV9maW5kX2Rpc3BsYXlpZF9leHRlbnNpb24oZWRpZCk7CiAJaWYgKCFk
aXNwbGF5aWQpIHsKIAkJLyogZHJvcCByZWZlcmVuY2UgdG8gYW55IHRpbGUgZ3JvdXAgd2UgaGFk
ICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fY29ubmVjdG9yLmggYi9pbmNsdWRlL2Ry
bS9kcm1fY29ubmVjdG9yLmgKaW5kZXggMjExMzUwMGI0MDc1Li5jMGY5Y2UzZjRiMjQgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaAorKysgYi9pbmNsdWRlL2RybS9kcm1f
Y29ubmVjdG9yLmgKQEAgLTE1ODAsOSArMTU4MCw5IEBAIHN0cnVjdCBkcm1fdGlsZV9ncm91cCB7
CiB9OwogCiBzdHJ1Y3QgZHJtX3RpbGVfZ3JvdXAgKmRybV9tb2RlX2NyZWF0ZV90aWxlX2dyb3Vw
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJCQkgIGNoYXIgdG9wb2xvZ3lbOF0pOworCQkJ
CQkJICBjb25zdCB1OCB0b3BvbG9neVs4XSk7CiBzdHJ1Y3QgZHJtX3RpbGVfZ3JvdXAgKmRybV9t
b2RlX2dldF90aWxlX2dyb3VwKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJCSAgICAgICBj
aGFyIHRvcG9sb2d5WzhdKTsKKwkJCQkJICAgICAgIGNvbnN0IHU4IHRvcG9sb2d5WzhdKTsKIHZv
aWQgZHJtX21vZGVfcHV0X3RpbGVfZ3JvdXAoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAg
ICAgc3RydWN0IGRybV90aWxlX2dyb3VwICp0Zyk7CiAKLS0gCjIuMjQuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
