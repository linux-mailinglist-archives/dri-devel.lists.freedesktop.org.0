Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C653A116BBD
	for <lists+dri-devel@lfdr.de>; Mon,  9 Dec 2019 12:06:48 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8F8DF6E39C;
	Mon,  9 Dec 2019 11:06:46 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 58EAC6E398
 for <dri-devel@lists.freedesktop.org>; Mon,  9 Dec 2019 11:06:45 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 97C54ACFE;
 Mon,  9 Dec 2019 11:06:43 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: linux-graphics-maintainer@vmware.com, thellstrom@vmware.com,
 airlied@linux.ie, daniel@ffwll.ch
Subject: [PATCH] drm/vmwgfx: Call vmw_driver_{load,
 unload}() before registering device
Date: Mon,  9 Dec 2019 12:06:41 +0100
Message-Id: <20191209110641.16134-1-tzimmermann@suse.de>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGxvYWQvdW5sb2FkIGNhbGxiYWNrcyBpbiBzdHJ1Y3QgZHJtX2RyaXZlciBhcmUgZGVwcmVj
YXRlZC4gUmVtb3ZlCnRoZW0gYW5kIGNhbGwgZnVuY3Rpb25zIGV4cGxpY2l0bHkuCgpTaWduZWQt
b2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuYyB8IDQ0ICsrKysrKysrKysrKysrKysrKysr
KysrKystLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzggaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuYyBiL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jCmluZGV4IGU5NjIwNDhmNjVkMi4uZjM0
ZjFlYjU3Y2ZhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuYwpAQCAtMjgsMTAgKzI4
LDEwIEBACiAjaW5jbHVkZSA8bGludXgvY29uc29sZS5oPgogI2luY2x1ZGUgPGxpbnV4L2RtYS1t
YXBwaW5nLmg+CiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvcGNp
Lmg+CgogI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9pb2N0bC5o
PgotI2luY2x1ZGUgPGRybS9kcm1fcGNpLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9zeXNmcy5oPgog
I2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZlci5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRt
X21vZHVsZS5oPgpAQCAtMTIxMSw4ICsxMjExLDEwIEBAIHN0YXRpYyB2b2lkIHZtd19yZW1vdmUo
c3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHBjaV9n
ZXRfZHJ2ZGF0YShwZGV2KTsKCisJZHJtX2Rldl91bnJlZ2lzdGVyKGRldik7CisJdm13X2RyaXZl
cl91bmxvYWQoZGV2KTsKKwlkcm1fZGV2X3B1dChkZXYpOwogCXBjaV9kaXNhYmxlX2RldmljZShw
ZGV2KTsKLQlkcm1fcHV0X2RldihkZXYpOwogfQoKIHN0YXRpYyBpbnQgdm13Z2Z4X3BtX25vdGlm
aWVyKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxvbmcgdmFsLApAQCAtMTMy
OSw3ICsxMzMxLDcgQEAgc3RhdGljIGludCB2bXdfcG1fZnJlZXplKHN0cnVjdCBkZXZpY2UgKmtk
ZXYpCgogCXZtd19mZW5jZV9maWZvX2Rvd24oZGV2X3ByaXYtPmZtYW4pOwogCV9fdm13X3N2Z2Ff
ZGlzYWJsZShkZXZfcHJpdik7Ci0KKwogCXZtd19yZWxlYXNlX2RldmljZV9sYXRlKGRldl9wcml2
KTsKIAlyZXR1cm4gMDsKIH0KQEAgLTEzOTEsOCArMTM5Myw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgZmlsZV9vcGVyYXRpb25zIHZtd2dmeF9kcml2ZXJfZm9wcyA9IHsKIHN0YXRpYyBzdHJ1Y3Qg
ZHJtX2RyaXZlciBkcml2ZXIgPSB7CiAJLmRyaXZlcl9mZWF0dXJlcyA9CiAJRFJJVkVSX01PREVT
RVQgfCBEUklWRVJfUkVOREVSIHwgRFJJVkVSX0FUT01JQywKLQkubG9hZCA9IHZtd19kcml2ZXJf
bG9hZCwKLQkudW5sb2FkID0gdm13X2RyaXZlcl91bmxvYWQsCiAJLmdldF92YmxhbmtfY291bnRl
ciA9IHZtd19nZXRfdmJsYW5rX2NvdW50ZXIsCiAJLmVuYWJsZV92YmxhbmsgPSB2bXdfZW5hYmxl
X3ZibGFuaywKIAkuZGlzYWJsZV92YmxhbmsgPSB2bXdfZGlzYWJsZV92YmxhbmssCkBAIC0xNDMx
LDcgKzE0MzEsMzkgQEAgc3RhdGljIHN0cnVjdCBwY2lfZHJpdmVyIHZtd19wY2lfZHJpdmVyID0g
ewoKIHN0YXRpYyBpbnQgdm13X3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1
Y3QgcGNpX2RldmljZV9pZCAqZW50KQogewotCXJldHVybiBkcm1fZ2V0X3BjaV9kZXYocGRldiwg
ZW50LCAmZHJpdmVyKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2OworCWludCByZXQ7CisKKwly
ZXQgPSBwY2lfZW5hYmxlX2RldmljZShwZGV2KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJZGV2ID0gZHJtX2Rldl9hbGxvYygmZHJpdmVyLCAmcGRldi0+ZGV2KTsKKwlpZiAoSVNfRVJS
KGRldikpIHsKKwkJcmV0ID0gUFRSX0VSUihkZXYpOworCQlnb3RvIGVycl9wY2lfZGlzYWJsZV9k
ZXZpY2U7CisJfQorCisJZGV2LT5wZGV2ID0gcGRldjsKKwlwY2lfc2V0X2RydmRhdGEocGRldiwg
ZGV2KTsKKworCXJldCA9IHZtd19kcml2ZXJfbG9hZChkZXYsIGVudC0+ZHJpdmVyX2RhdGEpOwor
CWlmIChyZXQpCisJCWdvdG8gZXJyX2RybV9kZXZfcHV0OworCisJcmV0ID0gZHJtX2Rldl9yZWdp
c3RlcihkZXYsIGVudC0+ZHJpdmVyX2RhdGEpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX3Ztd19k
cml2ZXJfdW5sb2FkOworCisJcmV0dXJuIDA7CisKK2Vycl92bXdfZHJpdmVyX3VubG9hZDoKKwl2
bXdfZHJpdmVyX3VubG9hZChkZXYpOworZXJyX2RybV9kZXZfcHV0OgorCWRybV9kZXZfcHV0KGRl
dik7CitlcnJfcGNpX2Rpc2FibGVfZGV2aWNlOgorCXBjaV9kaXNhYmxlX2RldmljZShwZGV2KTsK
KwlyZXR1cm4gcmV0OwogfQoKIHN0YXRpYyBpbnQgX19pbml0IHZtd2dmeF9pbml0KHZvaWQpCi0t
CjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
