Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 27CF51BDCD8
	for <lists+dri-devel@lfdr.de>; Wed, 29 Apr 2020 14:58:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BD5266EE85;
	Wed, 29 Apr 2020 12:57:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav21.altibox.net (asav21.altibox.net [109.247.116.8])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF7916EE60
 for <dri-devel@lists.freedesktop.org>; Wed, 29 Apr 2020 12:57:55 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav21.altibox.net (Postfix) with ESMTPSA id 9B74680191;
 Wed, 29 Apr 2020 14:48:51 +0200 (CEST)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org,
	linux-usb@vger.kernel.org
Subject: [PATCH 08/10] drm: Add Generic USB Display driver
Date: Wed, 29 Apr 2020 14:48:28 +0200
Message-Id: <20200429124830.27475-9-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20200429124830.27475-1-noralf@tronnes.org>
References: <20200429124830.27475-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=AvXAIt1P c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=SJz97ENfAAAA:8 a=gAmX6pxEAAAA:20
 a=e5mUnYsNAAAA:8 a=20KFwNOVAAAA:8 a=CUepv2jGAAAA:20
 a=2R8dU0vW1IrQXlz2apcA:9 a=SJ7Ozs4R1C1SiBBL:21 a=IjdJBDfGfkwjCRKS:21
 a=QEXdDO2ut3YA:10 a=vFet0B0WnEQeilDPIY6i:22 a=Vxmtnl_E_bksehYqCbjh:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgZ2VuZXJpYyBVU0IgZGlzcGxheSBkcml2ZXIgd2l0aCB0aGUgaW50ZW50aW9u
IHRoYXQgaXQgY2FuIGJlCnVzZWQgd2l0aCBmdXR1cmUgVVNCIGludGVyZmFjZWQgbG93IGVuZCBk
aXNwbGF5cy9hZGFwdGVycy4gVGhlIExpbnV4CmdhZGdldCBkZXZpY2UgZHJpdmVyIHdpbGwgc2Vy
dmUgYXMgdGhlIGNhbm9uaWNhbCBkZXZpY2UgaW1wbGVtZW50YXRpb24uCgpUaGUgZm9sbG93aW5n
IERSTSBwcm9wZXJ0aWVzIGFyZSBzdXBwb3J0ZWQ6Ci0gUGxhbmUgcm90YXRpb24KLSBDb25uZWN0
b3IgVFYgcHJvcGVydGllcwoKVGhlcmUgaXMgYWxzbyBzdXBwb3J0IGZvciBiYWNrbGlnaHQgYnJp
Z2h0bmVzcyBleHBvc2VkIGFzIGEgYmFja2xpZ2h0CmRldmljZS4KCkRpc3BsYXkgbW9kZXMgY2Fu
IGJlIG1hZGUgYXZhaWxhYmxlIHRvIHRoZSBob3N0IGRyaXZlciBlaXRoZXIgYXMgRFJNCmRpc3Bs
YXkgbW9kZXMgb3IgdGhyb3VnaCBFRElELiBJZiBib3RoIGFyZSBwcmVzZW50LCBFRElEIGlzIGp1
c3QgcGFzc2VkCm9uIHRvIHVzZXJzcGFjZS4KClBlcmZvcm1hbmNlIGlzIHByZWZlcnJlZCBvdmVy
IGNvbG9yIGRlcHRoLCBzbyBpZiB0aGUgZGV2aWNlIHN1cHBvcnRzClJHQjU2NSwgRFJNX0NBUF9E
VU1CX1BSRUZFUlJFRF9ERVBUSCB3aWxsIHJldHVybiAxNi4KCklmIHRoZSBkZXZpY2UgdHJhbnNm
ZXIgYnVmZmVyIGNhbid0IGZpdCBhbiB1bmNvbXByZXNzZWQgZnJhbWVidWZmZXIKdXBkYXRlLCB0
aGUgdXBkYXRlIGlzIHNwbGl0IHVwIGludG8gcGFydHMgdGhhdCBkbyBmaXQuCgpPcHRpbWFsIHVz
ZXIgZXhwZXJpZW5jZSBpcyBhY2hpZXZlZCBieSBwcm92aWRpbmcgZGFtYWdlIHJlcG9ydHMgZWl0
aGVyIGJ5CnNldHRpbmcgRkJfREFNQUdFX0NMSVBTIG9uIHBhZ2VmbGlwcyBvciBjYWxsaW5nIERS
TV9JT0NUTF9NT0RFX0RJUlRZRkIuCgpMWjQgY29tcHJlc3Npb24gaXMgdXNlZCBpZiB0aGUgZGV2
aWNlIHN1cHBvcnRzIGl0LgoKVGhlIGRyaXZlciBzdXBwb3J0cyBhIG9uZSBiaXQgbW9ub2Nocm9t
ZSB0cmFuc2ZlciBmb3JtYXQ6IFIxLiBUaGlzIGlzIG5vdAppbXBsZW1lbnRlZCBpbiB0aGUgZ2Fk
Z2V0IGRyaXZlci4gSXQgaXMgYWRkZWQgaW4gcHJlcGFyYXRpb24gZm9yIGZ1dHVyZQptb25vY2hy
b21lIGUtaW5rIGRpc3BsYXlzLgoKVGhlIGRyaXZlciBpcyBNSVQgbGljZW5zZWQgdG8gc21vb3Ro
IHRoZSBwYXRoIGZvciBhbnkgQlNEIHBvcnQgb2YgdGhlCmRyaXZlci4KClNpZ25lZC1vZmYtYnk6
IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIE1BSU5UQUlORVJTICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgOCArCiBkcml2ZXJzL2dwdS9kcm0vS2NvbmZp
ZyAgICAgICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlICAgICAg
ICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZyAgICAgICAgICAg
ICB8ICAxNCArCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL01ha2VmaWxlICAgICAgICAgICAgfCAgIDQg
KwogZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Nvbm5lY3Rvci5jIHwgNjI5ICsrKysrKysr
KysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Rydi5jICAgICAg
IHwgNjI0ICsrKysrKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9k
cm1faW50ZXJuYWwuaCAgfCAgNjYgKysrCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1fcGlw
ZS5jICAgICAgfCA0MjMgKysrKysrKysrKysrKysrKwogaW5jbHVkZS9kcm0vZ3VkX2RybS5oICAg
ICAgICAgICAgICAgICAgIHwgMzU2ICsrKysrKysrKysrKysrCiAxMCBmaWxlcyBjaGFuZ2VkLCAy
MTI3IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3Vk
L0tjb25maWcKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL01ha2VmaWxl
CiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Nvbm5lY3Rv
ci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Rydi5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2ludGVybmFs
LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1fcGlwZS5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9kcm0vZ3VkX2RybS5oCgpkaWZmIC0tZ2l0IGEv
TUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCAwOGFlOGVhNzY5MzkuLmJiNDYwOTk4NGU5
YSAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTUyODIsNiAr
NTI4MiwxNCBAQCBTOglNYWludGFpbmVkCiBGOglkcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwt
ZmVpeWFuZy1meTA3MDI0ZGkyNmEzMGQuYwogRjoJRG9jdW1lbnRhdGlvbi9kZXZpY2V0cmVlL2Jp
bmRpbmdzL2Rpc3BsYXkvcGFuZWwvZmVpeWFuZyxmeTA3MDI0ZGkyNmEzMGQudHh0CiAKK0RSTSBE
UklWRVIgRk9SIEdFTkVSSUMgVVNCIERJU1BMQVkKK006CU5vcmFsZiBUcsO4bm5lcyA8bm9yYWxm
QHRyb25uZXMub3JnPgorUzoJTWFpbnRhaW5lZAorVzoJaHR0cHM6Ly9naXRodWIuY29tL25vdHJv
L2d1ZC93aWtpCitUOglnaXQgZ2l0Oi8vYW5vbmdpdC5mcmVlZGVza3RvcC5vcmcvZHJtL2RybS1t
aXNjCitGOglkcml2ZXJzL2dwdS9kcm0vZ3VkLworRjoJaW5jbHVkZS9kcm0vZ3VkX2RybS5oCisK
IERSTSBEUklWRVIgRk9SIEdSQUlOIE1FRElBIEdNMTJVMzIwIFBST0pFQ1RPUlMKIE06CUhhbnMg
ZGUgR29lZGUgPGhkZWdvZWRlQHJlZGhhdC5jb20+CiBUOglnaXQgZ2l0Oi8vYW5vbmdpdC5mcmVl
ZGVza3RvcC5vcmcvZHJtL2RybS1taXNjCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vS2Nv
bmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCmluZGV4IGY2ZTEzZTE4YzljYS4uOTI4YmJm
NWNkYzEwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZworKysgYi9kcml2ZXJz
L2dwdS9kcm0vS2NvbmZpZwpAQCAtMzk2LDYgKzM5Niw4IEBAIHNvdXJjZSAiZHJpdmVycy9ncHUv
ZHJtL2FzcGVlZC9LY29uZmlnIgogCiBzb3VyY2UgImRyaXZlcnMvZ3B1L2RybS9tY2RlL0tjb25m
aWciCiAKK3NvdXJjZSAiZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnIgorCiAjIEtlZXAgbGVn
YWN5IGRyaXZlcnMgbGFzdAogCiBtZW51Y29uZmlnIERSTV9MRUdBQ1kKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQppbmRleCAw
ZDE3NjYyZGRlMGEuLjg2YWY2YzJkYTQwZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01h
a2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtMTIzLDMgKzEyMyw0IEBA
IG9iai0kKENPTkZJR19EUk1fTElNQSkgICs9IGxpbWEvCiBvYmotJChDT05GSUdfRFJNX1BBTkZS
T1NUKSArPSBwYW5mcm9zdC8KIG9iai0kKENPTkZJR19EUk1fQVNQRUVEX0dGWCkgKz0gYXNwZWVk
Lwogb2JqLSQoQ09ORklHX0RSTV9NQ0RFKSArPSBtY2RlLworb2JqLXkJCQkrPSBndWQvCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25maWcgYi9kcml2ZXJzL2dwdS9kcm0vZ3Vk
L0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4yMDNkNDQ5
MGYxYzcKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL0tjb25maWcKQEAg
LTAsMCArMSwxNCBAQAorIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorCitjb25m
aWcgRFJNX0dVRAorCXRyaXN0YXRlICJHZW5lcmljIFVTQiBEaXNwbGF5IgorCWRlcGVuZHMgb24g
RFJNICYmIFVTQgorCXNlbGVjdCBMWjRfQ09NUFJFU1MKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIK
KwlzZWxlY3QgRFJNX0dFTV9TSE1FTV9IRUxQRVIKKwlzZWxlY3QgRFJNX0JBQ0tMSUdIVF9IRUxQ
RVIKKwloZWxwCisJICBUaGlzIGlzIGEgRFJNIGRpc3BsYXkgZHJpdmVyIGZvciBHZW5lcmljIFVT
QiBEaXNwbGF5cyBvciBkaXNwbGF5CisJICBhZGFwdGVycy4KKworCSAgSWYgTSBpcyBzZWxlY3Rl
ZCB0aGUgbW9kdWxlIHdpbGwgYmUgY2FsbGVkIGd1ZF9kcm0uCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vZ3VkL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9NYWtlZmlsZQpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjczZWQ3ZWYzZGE5NAotLS0gL2Rl
di9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvTWFrZWZpbGUKQEAgLTAsMCArMSw0IEBA
CisjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisKK2d1ZF9kcm0tb2JqcwkJCTo9
IGd1ZF9kcm1fZHJ2Lm8gZ3VkX2RybV9waXBlLm8gZ3VkX2RybV9jb25uZWN0b3Iubworb2JqLSQo
Q09ORklHX0RSTV9HVUQpCQkrPSBndWRfZHJtLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9ndWQvZ3VkX2RybV9jb25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9j
b25uZWN0b3IuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmQxMDQy
YjU2M2E5OAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9j
b25uZWN0b3IuYwpAQCAtMCwwICsxLDYyOSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFsZiBUcsO4bm5lcworICovCisKKyNpbmNs
dWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX3N0YXRlX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fYmFja2xpZ2h0X2hlbHBlci5oPgorI2luY2x1ZGUg
PGRybS9kcm1fY29ubmVjdG9yLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcnYuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2VuY29kZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzZXRfaGVscGVyX3Z0
YWJsZXMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9w
cm9iZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVyLmg+Cisj
aW5jbHVkZSA8ZHJtL2d1ZF9kcm0uaD4KKworI2luY2x1ZGUgImd1ZF9kcm1faW50ZXJuYWwuaCIK
Kworc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yIHsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciBjb25u
ZWN0b3I7CisJc3RydWN0IGRybV9lbmNvZGVyIGVuY29kZXI7CisKKwl1MzIgZmxhZ3M7CisKKwkv
KiBTdXBwb3J0ZWQgcHJvcGVydGllcyAqLworCXUxNiAqcHJvcGVydGllczsKKwl1bnNpZ25lZCBp
bnQgbnVtX3Byb3BlcnRpZXM7CisKKwkvKiBJbml0aWFsIGdhZGdldCB0diBzdGF0ZSBpZiBhcHBs
aWNhYmxlLCBhcHBsaWVkIG9uIHN0YXRlIHJlc2V0ICovCisJc3RydWN0IGRybV90dl9jb25uZWN0
b3Jfc3RhdGUgaW5pdGlhbF90dl9zdGF0ZTsKKworCS8qCisJICogSW5pdGlhbCBnYWRnZXQgYmFj
a2xpZ2h0IGJyaWdodG5lc3MgaWYgYXBwbGljYWJsZSwgYXBwbGllZCBvbiBzdGF0ZSByZXNldC4K
KwkgKiBUaGUgdmFsdWUgLUVOT0RFViBpcyB1c2VkIGludGVybmFsbHkgdG8gc2lnbmFsIG5vIGJh
Y2tsaWdodC4KKwkgKi8KKwlpbnQgaW5pdGlhbF9icmlnaHRuZXNzOworCisJLyogU3VwcG9ydGVk
IGRpc3BsYXkgbW9kZXMgaW4gdHJhbnNmZXIgZm9ybWF0ICovCisJc3RydWN0IGd1ZF9kcm1fZGlz
cGxheV9tb2RlICptb2RlczsKKwl1bnNpZ25lZCBpbnQgbnVtX21vZGVzOworCisJLyogRURJRCAq
LworCXZvaWQgKmVkaWQ7CisJc2l6ZV90IGVkaWRfbGVuOworfTsKKworc3RhdGljIGlubGluZSBz
dHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgKnRvX2d1ZF9kcm1fY29ubmVjdG9yKHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihjb25uZWN0b3Is
IHN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciwgY29ubmVjdG9yKTsKK30KKworc3RhdGljIHZvaWQg
Z3VkX2RybV9jb25uZWN0b3JfbW9kZXNfY2xlYXIoc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpn
Y29ubikKK3sKKwlrZnJlZShnY29ubi0+bW9kZXMpOworCWdjb25uLT5tb2RlcyA9IE5VTEw7CisJ
Z2Nvbm4tPm51bV9tb2RlcyA9IDA7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0b3Jf
bW9kZXNfZ2V0KHN0cnVjdCBndWRfZHJtX2Nvbm5lY3RvciAqZ2Nvbm4sIHVuc2lnbmVkIGludCBu
dW1fbW9kZXMpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RybV9k
ZXZpY2UoZ2Nvbm4tPmNvbm5lY3Rvci5kZXYpOworCXVuc2lnbmVkIGludCBpbmRleCA9IGdjb25u
LT5jb25uZWN0b3IuaW5kZXg7CisJaW50IHJldCA9IDA7CisKKwlpZiAoIW51bV9tb2RlcykKKwkJ
Z290byBjbGVhcjsKKworCWd1ZF9kcm1fY29ubmVjdG9yX21vZGVzX2NsZWFyKGdjb25uKTsKKwor
CWdjb25uLT5tb2RlcyA9IGttYWxsb2NfYXJyYXkobnVtX21vZGVzLCBzaXplb2YoKmdjb25uLT5t
b2RlcyksIEdGUF9LRVJORUwpOworCWlmICghZ2Nvbm4tPm1vZGVzKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCWdjb25uLT5udW1fbW9kZXMgPSBudW1fbW9kZXM7CisKKwlyZXQgPSBndWRfZHJtX3Vz
Yl9nZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1JfTU9ERVMsIGluZGV4LAor
CQkJICAgICAgZ2Nvbm4tPm1vZGVzLCBudW1fbW9kZXMgKiBzaXplb2YoKmdjb25uLT5tb2Rlcykp
OworCWlmIChyZXQpCisJCWdvdG8gY2xlYXI7CisKKwlyZXR1cm4gMDsKK2NsZWFyOgorCWd1ZF9k
cm1fY29ubmVjdG9yX21vZGVzX2NsZWFyKGdjb25uKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0
YXRpYyB2b2lkIGd1ZF9kcm1fY29ubmVjdG9yX2VkaWRfY2xlYXIoc3RydWN0IGd1ZF9kcm1fY29u
bmVjdG9yICpnY29ubikKK3sKKwlrZnJlZShnY29ubi0+ZWRpZCk7CisJZ2Nvbm4tPmVkaWQgPSBO
VUxMOworCWdjb25uLT5lZGlkX2xlbiA9IDA7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25u
ZWN0b3JfZWRpZF9nZXQoc3RydWN0IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubiwgc2l6ZV90IGxl
bikKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZHJtX2RldmljZShn
Y29ubi0+Y29ubmVjdG9yLmRldik7CisJdW5zaWduZWQgaW50IGluZGV4ID0gZ2Nvbm4tPmNvbm5l
Y3Rvci5pbmRleDsKKwlpbnQgcmV0ID0gMDsKKworCWlmICghbGVuKQorCQlnb3RvIGNsZWFyOwor
CisJZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9jbGVhcihnY29ubik7CisKKwlnY29ubi0+ZWRpZCA9
IGttYWxsb2MobGVuLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uLT5lZGlkKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCWdjb25uLT5lZGlkX2xlbiA9IGxlbjsKKworCXJldCA9IGd1ZF9kcm1fdXNi
X2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUl9FRElELCBpbmRleCwgZ2Nv
bm4tPmVkaWQsIGxlbik7CisJaWYgKHJldCkKKwkJZ290byBjbGVhcjsKKworCXJldHVybiAwOwor
Y2xlYXI6CisJZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9jbGVhcihnY29ubik7CisKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fY29ubmVjdG9yX2RldGVjdF9zYWZlKHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCit7CisJc3RydWN0IGd1ZF9k
cm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29ubmVjdG9yKGNvbm5lY3Rvcik7CisJ
c3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdG9fZ3VkX2RybV9kZXZpY2UoY29ubmVjdG9y
LT5kZXYpOworCXN0cnVjdCBndWRfZHJtX3JlcV9nZXRfY29ubmVjdG9yX3N0YXR1cyByZXE7CisJ
dTE2IG51bV9tb2RlcywgZWRpZF9sZW47CisJaW50IHN0YXR1cywgcmV0OworCWJvb2wgY2hhbmdl
ZDsKKworCWlmIChmb3JjZSkgeworCQlyZXQgPSBndWRfZHJtX3VzYl9zZXQoZ2RybSwgR1VEX0RS
TV9VU0JfUkVRX1NFVF9DT05ORUNUT1JfRk9SQ0VfREVURUNULAorCQkJCSAgICAgIGNvbm5lY3Rv
ci0+aW5kZXgsIE5VTEwsIDApOworCQlpZiAocmV0KQorCQkJZ290byBmcmVlOworCX0KKworCXJl
dCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUl9T
VEFUVVMsCisJCQkgICAgICBjb25uZWN0b3ItPmluZGV4LCAmcmVxLCBzaXplb2YocmVxKSk7CisJ
aWYgKHJldCkKKwkJZ290byBmcmVlOworCisJY2hhbmdlZCA9IHJlcS5zdGF0dXMgJiBHVURfRFJN
X0NPTk5FQ1RPUl9TVEFUVVNfQ0hBTkdFRDsKKwlzdGF0dXMgPSByZXEuc3RhdHVzICYgR1VEX0RS
TV9DT05ORUNUT1JfU1RBVFVTX01BU0s7CisJaWYgKHN0YXR1cyA+IGNvbm5lY3Rvcl9zdGF0dXNf
dW5rbm93bikKKwkJc3RhdHVzID0gY29ubmVjdG9yX3N0YXR1c191bmtub3duOworCW51bV9tb2Rl
cyA9IGxlMTZfdG9fY3B1KHJlcS5udW1fbW9kZXMpOworCWVkaWRfbGVuID0gbGUxNl90b19jcHUo
cmVxLmVkaWRfbGVuKTsKKworCWlmICghbnVtX21vZGVzICYmICFlZGlkX2xlbikgeworCQlyZXQg
PSBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKKwkJZ290byBmcmVlOworCX0KKworCWlm
ICghY2hhbmdlZCAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBzdGF0dXMgJiYKKwkgICAgZ2Nvbm4t
Pm51bV9tb2RlcyA9PSBudW1fbW9kZXMgJiYgZ2Nvbm4tPmVkaWRfbGVuID09IGVkaWRfbGVuKQor
CQlyZXR1cm4gc3RhdHVzOworCisJcmV0ID0gZ3VkX2RybV9jb25uZWN0b3JfbW9kZXNfZ2V0KGdj
b25uLCBudW1fbW9kZXMpOworCWlmIChyZXQpCisJCWdvdG8gZnJlZTsKKworCXJldCA9IGd1ZF9k
cm1fY29ubmVjdG9yX2VkaWRfZ2V0KGdjb25uLCBlZGlkX2xlbik7CisJaWYgKHJldCkKKwkJZ290
byBmcmVlOworCisJcmV0dXJuIHN0YXR1czsKK2ZyZWU6CisJZ3VkX2RybV9jb25uZWN0b3JfbW9k
ZXNfY2xlYXIoZ2Nvbm4pOworCWd1ZF9kcm1fY29ubmVjdG9yX2VkaWRfY2xlYXIoZ2Nvbm4pOwor
CisJcmV0dXJuIHJldCA8IDAgPyBjb25uZWN0b3Jfc3RhdHVzX3Vua25vd24gOiByZXQ7Cit9CisK
K3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0b3JfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCisJCQkJICAgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4
LCBib29sIGZvcmNlKQoreworCWludCBpZHgsIHJldDsKKworCWlmICghZHJtX2Rldl9lbnRlcihj
b25uZWN0b3ItPmRldiwgJmlkeCkpCisJCXJldHVybiAtRU5PREVWOworCisJcmV0ID0gZ3VkX2Ry
bV9jb25uZWN0b3JfZGV0ZWN0X3NhZmUoY29ubmVjdG9yLCBmb3JjZSk7CisKKwlkcm1fZGV2X2V4
aXQoaWR4KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9jb25uZWN0
b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0
IGd1ZF9kcm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29ubmVjdG9yKGNvbm5lY3Rv
cik7CisJdW5zaWduZWQgaW50IGksIG51bV9tb2RlcyA9IDA7CisKKwlpZiAoIWdjb25uLT5udW1f
bW9kZXMpCisJCXJldHVybiBkcm1fYWRkX2VkaWRfbW9kZXMoY29ubmVjdG9yLCBnY29ubi0+ZWRp
ZCk7CisKKwlmb3IgKGkgPSAwOyBpIDwgZ2Nvbm4tPm51bV9tb2RlczsgaSsrKSB7CisJCXN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICptb2RlOworCisJCW1vZGUgPSBkcm1fbW9kZV9jcmVhdGUoY29u
bmVjdG9yLT5kZXYpOworCQlpZiAoIW1vZGUpCisJCQlnb3RvIG91dDsKKworCQlndWRfZHJtX3Rv
X2Rpc3BsYXlfbW9kZShtb2RlLCAmZ2Nvbm4tPm1vZGVzW2ldKTsKKworCQlkcm1fbW9kZV9wcm9i
ZWRfYWRkKGNvbm5lY3RvciwgbW9kZSk7CisJCW51bV9tb2RlcysrOworCX0KK291dDoKKwlpZiAo
Z2Nvbm4tPmVkaWRfbGVuKQorCQlkcm1fY29ubmVjdG9yX3VwZGF0ZV9lZGlkX3Byb3BlcnR5KGNv
bm5lY3RvciwgZ2Nvbm4tPmVkaWQpOworCisJcmV0dXJuIG51bV9tb2RlczsKK30KKworc3RhdGlj
IGludCBndWRfZHJtX2Nvbm5lY3Rvcl9hdG9taWNfY2hlY2soc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKKwkJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJ
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm5ld19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGNf
c3RhdGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRf
c3RhdGU7CisKKwluZXdfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY29ubmVjdG9yX3N0YXRl
KHN0YXRlLCBjb25uZWN0b3IpOworCWlmICghbmV3X3N0YXRlLT5jcnRjKQorCQlyZXR1cm4gMDsK
KworCW9sZF9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jb25uZWN0b3Jfc3RhdGUoc3RhdGUs
IGNvbm5lY3Rvcik7CisJbmV3X2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19z
dGF0ZShzdGF0ZSwgbmV3X3N0YXRlLT5jcnRjKTsKKworCWlmIChvbGRfc3RhdGUtPmJhY2tsaWdo
dF9icmlnaHRuZXNzICE9IG5ld19zdGF0ZS0+YmFja2xpZ2h0X2JyaWdodG5lc3MgfHwKKwkgICAg
b2xkX3N0YXRlLT50di5zdWJjb25uZWN0b3IgIT0gbmV3X3N0YXRlLT50di5zdWJjb25uZWN0b3Ig
fHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLmxlZnQgIT0gbmV3X3N0YXRlLT50di5tYXJn
aW5zLmxlZnQgfHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLnJpZ2h0ICE9IG5ld19zdGF0
ZS0+dHYubWFyZ2lucy5yaWdodCB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMudG9wICE9
IG5ld19zdGF0ZS0+dHYubWFyZ2lucy50b3AgfHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5z
LmJvdHRvbSAhPSBuZXdfc3RhdGUtPnR2Lm1hcmdpbnMuYm90dG9tIHx8CisJICAgIG9sZF9zdGF0
ZS0+dHYubW9kZSAhPSBuZXdfc3RhdGUtPnR2Lm1vZGUgfHwKKwkgICAgb2xkX3N0YXRlLT50di5i
cmlnaHRuZXNzICE9IG5ld19zdGF0ZS0+dHYuYnJpZ2h0bmVzcyB8fAorCSAgICBvbGRfc3RhdGUt
PnR2LmNvbnRyYXN0ICE9IG5ld19zdGF0ZS0+dHYuY29udHJhc3QgfHwKKwkgICAgb2xkX3N0YXRl
LT50di5mbGlja2VyX3JlZHVjdGlvbiAhPSBuZXdfc3RhdGUtPnR2LmZsaWNrZXJfcmVkdWN0aW9u
IHx8CisJICAgIG9sZF9zdGF0ZS0+dHYub3ZlcnNjYW4gIT0gbmV3X3N0YXRlLT50di5vdmVyc2Nh
biB8fAorCSAgICBvbGRfc3RhdGUtPnR2LnNhdHVyYXRpb24gIT0gbmV3X3N0YXRlLT50di5zYXR1
cmF0aW9uIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYuaHVlICE9IG5ld19zdGF0ZS0+dHYuaHVlKQor
CQluZXdfY3J0Y19zdGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2VkID0gdHJ1ZTsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzIGd1
ZF9kcm1fY29ubmVjdG9yX2hlbHBlcl9mdW5jcyA9IHsKKwkuZGV0ZWN0X2N0eCA9IGd1ZF9kcm1f
Y29ubmVjdG9yX2RldGVjdCwKKwkuZ2V0X21vZGVzID0gZ3VkX2RybV9jb25uZWN0b3JfZ2V0X21v
ZGVzLAorCS5hdG9taWNfY2hlY2sgPSBndWRfZHJtX2Nvbm5lY3Rvcl9hdG9taWNfY2hlY2ssCit9
OworCitzdGF0aWMgaW50IGd1ZF9kcm1fY29ubmVjdG9yX2xhdGVfcmVnaXN0ZXIoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgKmdj
b25uID0gdG9fZ3VkX2RybV9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCWlmIChnY29ubi0+aW5p
dGlhbF9icmlnaHRuZXNzIDwgMCkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gZHJtX2JhY2tsaWdo
dF9yZWdpc3Rlcihjb25uZWN0b3IpOworfQorCitzdGF0aWMgdm9pZCBndWRfZHJtX2Nvbm5lY3Rv
cl9kZXN0cm95KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0IGd1
ZF9kcm1fY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9kcm1fY29ubmVjdG9yKGNvbm5lY3Rvcik7
CisKKwlkcm1fY29ubmVjdG9yX2NsZWFudXAoY29ubmVjdG9yKTsKKwlndWRfZHJtX2Nvbm5lY3Rv
cl9tb2Rlc19jbGVhcihnY29ubik7CisJZ3VkX2RybV9jb25uZWN0b3JfZWRpZF9jbGVhcihnY29u
bik7CisJa2ZyZWUoZ2Nvbm4tPnByb3BlcnRpZXMpOworCWtmcmVlKGdjb25uKTsKK30KKworc3Rh
dGljIHZvaWQgZ3VkX2RybV9jb25uZWN0b3JfcmVzZXQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Ry
bV9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCWRybV9hdG9taWNfaGVscGVyX2Nvbm5lY3Rvcl9y
ZXNldChjb25uZWN0b3IpOworCWNvbm5lY3Rvci0+c3RhdGUtPnR2ID0gZ2Nvbm4tPmluaXRpYWxf
dHZfc3RhdGU7CisJLyogU2V0IG1hcmdpbnMgZnJvbSBjb21tYW5kIGxpbmUgKi8KKwlkcm1fYXRv
bWljX2hlbHBlcl9jb25uZWN0b3JfdHZfcmVzZXQoY29ubmVjdG9yKTsKKwlpZiAoZ2Nvbm4tPmlu
aXRpYWxfYnJpZ2h0bmVzcyA+PSAwKQorCQljb25uZWN0b3ItPnN0YXRlLT5iYWNrbGlnaHRfYnJp
Z2h0bmVzcyA9IGdjb25uLT5pbml0aWFsX2JyaWdodG5lc3M7Cit9CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9mdW5jcyBndWRfZHJtX2Nvbm5lY3Rvcl9mdW5jcyA9IHsKKwku
ZmlsbF9tb2RlcyA9IGRybV9oZWxwZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcywKKwku
bGF0ZV9yZWdpc3RlciA9IGd1ZF9kcm1fY29ubmVjdG9yX2xhdGVfcmVnaXN0ZXIsCisJLmVhcmx5
X3VucmVnaXN0ZXIgPSBkcm1fYmFja2xpZ2h0X3VucmVnaXN0ZXIsCisJLmRlc3Ryb3kgPSBndWRf
ZHJtX2Nvbm5lY3Rvcl9kZXN0cm95LAorCS5yZXNldCA9IGd1ZF9kcm1fY29ubmVjdG9yX3Jlc2V0
LAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9y
X2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hl
bHBlcl9jb25uZWN0b3JfZGVzdHJveV9zdGF0ZSwKK307CisKKy8qCisgKiBUaGUgdHYubW9kZSBw
cm9wZXJ0eSBpcyBzaGFyZWQgYW1vbmcgdGhlIGNvbm5lY3RvcnMgYW5kIGl0cyBlbnVtIG5hbWVz
IGFyZQorICogZHJpdmVyIHNwZWNpZmljLiBUaGlzIG1lYW5zIHRoYXQgaWYgbW9yZSB0aGFuIG9u
ZSBjb25uZWN0b3IgdXNlcyB0di5tb2RlLAorICogdGhlIGVudW0gbmFtZXMgaGFzIHRvIGJlIHRo
ZSBzYW1lLgorICovCitzdGF0aWMgaW50IGd1ZF9kcm1fY29ubmVjdG9yX2FkZF90dl9tb2RlKHN0
cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwKKwkJCQkJIHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsIHU2NCB2YWwpCit7CisJdW5zaWduZWQgaW50IGksIG51bV9tb2RlczsKKwljb25z
dCBjaGFyICoqbW9kZXM7CisJc2l6ZV90IGJ1Zl9sZW47CisJY2hhciAqYnVmOworCWludCByZXQ7
CisKKwludW1fbW9kZXMgPSB2YWwgPj4gR1VEX0RSTV9VU0JfQ09OTkVDVE9SX1RWX01PREVfTlVN
X1NISUZUOworCisJaWYgKCFudW1fbW9kZXMpCisJCXJldHVybiAtRUlOVkFMOworCisJYnVmX2xl
biA9IG51bV9tb2RlcyAqIERSTV9QUk9QX05BTUVfTEVOOworCW1vZGVzID0ga21hbGxvY19hcnJh
eShudW1fbW9kZXMsIHNpemVvZigqbW9kZXMpLCBHRlBfS0VSTkVMKTsKKwlidWYgPSBrbWFsbG9j
KGJ1Zl9sZW4sIEdGUF9LRVJORUwpOworCWlmICghbW9kZXMgfHwgIWJ1ZikgeworCQlyZXQgPSAt
RU5PTUVNOworCQlnb3RvIGZyZWU7CisJfQorCisJcmV0ID0gZ3VkX2RybV91c2JfZ2V0KGdkcm0s
IEdVRF9EUk1fVVNCX1JFUV9HRVRfQ09OTkVDVE9SX1RWX01PREVfVkFMVUVTLAorCQkJICAgICAg
Y29ubmVjdG9yLT5pbmRleCwgYnVmLCBidWZfbGVuKTsKKwlpZiAocmV0KQorCQlnb3RvIGZyZWU7
CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtX21vZGVzOyBpKyspCisJCW1vZGVzW2ldID0gJmJ1Zltp
ICogRFJNX1BST1BfTkFNRV9MRU5dOworCisJcmV0ID0gZHJtX21vZGVfY3JlYXRlX3R2X3Byb3Bl
cnRpZXMoY29ubmVjdG9yLT5kZXYsIG51bV9tb2RlcywgbW9kZXMpOworZnJlZToKKwlrZnJlZSht
b2Rlcyk7CisJa2ZyZWUoYnVmKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qg
ZHJtX3Byb3BlcnR5ICoKK2d1ZF9kcm1fY29ubmVjdG9yX3Byb3BlcnR5X2xvb2t1cChzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MTYgcHJvcCkKK3sKKwlzdHJ1Y3QgZHJtX21vZGVf
Y29uZmlnICpjb25maWcgPSAmY29ubmVjdG9yLT5kZXYtPm1vZGVfY29uZmlnOworCisJc3dpdGNo
IChwcm9wKSB7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1NFTEVDVF9TVUJDT05ORUNUT1I6
CisJCXJldHVybiBjb25maWctPnR2X3NlbGVjdF9zdWJjb25uZWN0b3JfcHJvcGVydHk7CisJY2Fz
ZSBHVURfRFJNX1BST1BFUlRZX1RWX0xFRlRfTUFSR0lOOgorCQlyZXR1cm4gY29uZmlnLT50dl9s
ZWZ0X21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfUklHSFRfTUFS
R0lOOgorCQlyZXR1cm4gY29uZmlnLT50dl9yaWdodF9tYXJnaW5fcHJvcGVydHk7CisJY2FzZSBH
VURfRFJNX1BST1BFUlRZX1RWX1RPUF9NQVJHSU46CisJCXJldHVybiBjb25maWctPnR2X3RvcF9t
YXJnaW5fcHJvcGVydHk7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0JPVFRPTV9NQVJHSU46
CisJCXJldHVybiBjb25maWctPnR2X2JvdHRvbV9tYXJnaW5fcHJvcGVydHk7CisJY2FzZSBHVURf
RFJNX1BST1BFUlRZX1RWX01PREU6CisJCXJldHVybiBjb25maWctPnR2X21vZGVfcHJvcGVydHk7
CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0JSSUdIVE5FU1M6CisJCXJldHVybiBjb25maWct
PnR2X2JyaWdodG5lc3NfcHJvcGVydHk7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0NPTlRS
QVNUOgorCQlyZXR1cm4gY29uZmlnLT50dl9jb250cmFzdF9wcm9wZXJ0eTsKKwljYXNlIEdVRF9E
Uk1fUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJT046CisJCXJldHVybiBjb25maWctPnR2X2Zs
aWNrZXJfcmVkdWN0aW9uX3Byb3BlcnR5OworCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9PVkVS
U0NBTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfb3ZlcnNjYW5fcHJvcGVydHk7CisJY2FzZSBHVURf
RFJNX1BST1BFUlRZX1RWX1NBVFVSQVRJT046CisJCXJldHVybiBjb25maWctPnR2X3NhdHVyYXRp
b25fcHJvcGVydHk7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0hVRToKKwkJcmV0dXJuIGNv
bmZpZy0+dHZfaHVlX3Byb3BlcnR5OworCWRlZmF1bHQ6CisJCXJldHVybiBFUlJfUFRSKC1FSU5W
QUwpOworCX0KK30KKworc3RhdGljIHVuc2lnbmVkIGludCAqZ3VkX2RybV9jb25uZWN0b3JfdHZf
c3RhdGVfdmFsKHUxNiBwcm9wLCBzdHJ1Y3QgZHJtX3R2X2Nvbm5lY3Rvcl9zdGF0ZSAqc3RhdGUp
Cit7CisJc3dpdGNoIChwcm9wKSB7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1NFTEVDVF9T
VUJDT05ORUNUT1I6CisJCXJldHVybiAmc3RhdGUtPnN1YmNvbm5lY3RvcjsKKwljYXNlIEdVRF9E
Uk1fUFJPUEVSVFlfVFZfTEVGVF9NQVJHSU46CisJCXJldHVybiAmc3RhdGUtPm1hcmdpbnMubGVm
dDsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOOgorCQlyZXR1cm4gJnN0
YXRlLT5tYXJnaW5zLnJpZ2h0OworCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9UT1BfTUFSR0lO
OgorCQlyZXR1cm4gJnN0YXRlLT5tYXJnaW5zLnRvcDsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlf
VFZfQk9UVE9NX01BUkdJTjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFyZ2lucy5ib3R0b207CisJY2Fz
ZSBHVURfRFJNX1BST1BFUlRZX1RWX01PREU6CisJCXJldHVybiAmc3RhdGUtPm1vZGU7CisJY2Fz
ZSBHVURfRFJNX1BST1BFUlRZX1RWX0JSSUdIVE5FU1M6CisJCXJldHVybiAmc3RhdGUtPmJyaWdo
dG5lc3M7CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0NPTlRSQVNUOgorCQlyZXR1cm4gJnN0
YXRlLT5jb250cmFzdDsKKwljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJ
T046CisJCXJldHVybiAmc3RhdGUtPmZsaWNrZXJfcmVkdWN0aW9uOworCWNhc2UgR1VEX0RSTV9Q
Uk9QRVJUWV9UVl9PVkVSU0NBTjoKKwkJcmV0dXJuICZzdGF0ZS0+b3ZlcnNjYW47CisJY2FzZSBH
VURfRFJNX1BST1BFUlRZX1RWX1NBVFVSQVRJT046CisJCXJldHVybiAmc3RhdGUtPnNhdHVyYXRp
b247CisJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0hVRToKKwkJcmV0dXJuICZzdGF0ZS0+aHVl
OworCWRlZmF1bHQ6CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCX0KK30KKworc3RhdGlj
IGludCBndWRfZHJtX2Nvbm5lY3Rvcl9hZGRfcHJvcGVydGllcyhzdHJ1Y3QgZ3VkX2RybV9kZXZp
Y2UgKmdkcm0sCisJCQkJCSAgICBzdHJ1Y3QgZ3VkX2RybV9jb25uZWN0b3IgKmdjb25uLAorCQkJ
CQkgICAgdW5zaWduZWQgaW50IG51bV9wcm9wZXJ0aWVzKQoreworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkcm0gPSAmZ2RybS0+ZHJtOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSAm
Z2Nvbm4tPmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZ3VkX2RybV9wcm9wZXJ0eSAqcHJvcGVydGllczsK
Kwlib29sIG5lZWRfdHZfcHJvcHMgPSBmYWxzZTsKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQgcmV0
OworCisJZ2Nvbm4tPnByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9wZXJ0aWVzLCBzaXplb2Yo
Kmdjb25uLT5wcm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFnY29ubi0+cHJvcGVydGll
cykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlwcm9wZXJ0aWVzID0ga2NhbGxvYyhudW1fcHJvcGVy
dGllcywgc2l6ZW9mKCpwcm9wZXJ0aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9wZXJ0aWVz
KQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCBHVURf
RFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUl9QUk9QRVJUSUVTLCBjb25uZWN0b3ItPmluZGV4LAor
CQkJICAgICAgcHJvcGVydGllcywgbnVtX3Byb3BlcnRpZXMgKiBzaXplb2YoKnByb3BlcnRpZXMp
KTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCWZvciAoaSA9IDA7IGkgPCBudW1fcHJvcGVy
dGllczsgaSsrKSB7CisJCXUxNiBwcm9wID0gbGUxNl90b19jcHUocHJvcGVydGllc1tpXS5wcm9w
KTsKKwkJdTY0IHZhbCA9IGxlNjRfdG9fY3B1KHByb3BlcnRpZXNbaV0udmFsKTsKKworCQlkcm1f
ZGJnKGRybSwgInByb3BlcnR5OiAldSA9ICVsbHUoMHglbGx4KVxuIiwgcHJvcCwgdmFsLCB2YWwp
OworCisJCXN3aXRjaCAocHJvcCkgeworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfTEVGVF9N
QVJHSU46CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1JJR0hU
X01BUkdJTjoKKwkJCWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfVE9Q
X01BUkdJTjoKKwkJCWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfQk9U
VE9NX01BUkdJTjoKKwkJCXJldCA9IGRybV9tb2RlX2NyZWF0ZV90dl9tYXJnaW5fcHJvcGVydGll
cyhkcm0pOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIG91dDsKKwkJCWJyZWFrOworCQljYXNlIEdV
RF9EUk1fUFJPUEVSVFlfVFZfTU9ERToKKwkJCXJldCA9IGd1ZF9kcm1fY29ubmVjdG9yX2FkZF90
dl9tb2RlKGdkcm0sIGNvbm5lY3RvciwgdmFsKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7
CisJCQlicmVhazsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1NFTEVDVF9TVUJDT05ORUNU
T1I6CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0JSSUdIVE5F
U1M6CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0NPTlRSQVNU
OgorCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgR1VEX0RSTV9QUk9QRVJUWV9UVl9GTElDS0VSX1JF
RFVDVElPTjoKKwkJCWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9EUk1fUFJPUEVSVFlfVFZfT1ZF
UlNDQU46CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX1NBVFVS
QVRJT046CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX0hVRToK
KwkJCW5lZWRfdHZfcHJvcHMgPSB0cnVlOworCQkJYnJlYWs7CisJCWNhc2UgR1VEX0RSTV9QUk9Q
RVJUWV9CQUNLTElHSFRfQlJJR0hUTkVTUzoKKwkJCWlmICh2YWwgPiAxMDApIHsKKwkJCQlyZXQg
PSAtRUlOVkFMOworCQkJCWdvdG8gb3V0OworCQkJfQorCQkJZ2Nvbm4tPmluaXRpYWxfYnJpZ2h0
bmVzcyA9IHZhbDsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJLyogTmV3IG9uZXMgbWlnaHQg
c2hvdyB1cCBpbiBmdXR1cmUgZGV2aWNlcywgc2tpcCB0aG9zZSB3ZSBkb24ndCBrbm93LiAqLwor
CQkJZHJtX2RiZyhkcm0sICJVbmtub3duIHByb3BlcnR5OiAldVxuIiwgcHJvcCk7CisJCQljb250
aW51ZTsKKwkJfQorCisJCWdjb25uLT5wcm9wZXJ0aWVzW2djb25uLT5udW1fcHJvcGVydGllcysr
XSA9IHByb3A7CisJfQorCisJaWYgKCFnY29ubi0+bnVtX3Byb3BlcnRpZXMpCisJCWdvdG8gb3V0
OworCisJaWYgKG5lZWRfdHZfcHJvcHMpIHsKKwkJLyogVGhpcyBpcyBhIG5vLW9wIGlmIGFscmVh
ZHkgYWRkZWQuICovCisJCXJldCA9IGRybV9tb2RlX2NyZWF0ZV90dl9wcm9wZXJ0aWVzKGRybSwg
MCwgTlVMTCk7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKwl9CisKKwlmb3IgKGkgPSAwOyBp
IDwgbnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJvcCA9IGxlMTZfdG9fY3B1KHByb3Bl
cnRpZXNbaV0ucHJvcCk7CisJCXU2NCB2YWwgPSBsZTY0X3RvX2NwdShwcm9wZXJ0aWVzW2ldLnZh
bCk7CisJCXN0cnVjdCBkcm1fcHJvcGVydHkgKnByb3BlcnR5OworCQl1bnNpZ25lZCBpbnQgKnN0
YXRlX3ZhbDsKKworCQlzd2l0Y2ggKHByb3ApIHsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX0JB
Q0tMSUdIVF9CUklHSFRORVNTOgorCQkJLyogbm90IGEgRFJNIHByb3BlcnR5ICovCisJCQljb250
aW51ZTsKKwkJY2FzZSBHVURfRFJNX1BST1BFUlRZX1RWX01PREU6CisJCQl2YWwgPSB2YWwgJiAo
QklUKEdVRF9EUk1fVVNCX0NPTk5FQ1RPUl9UVl9NT0RFX05VTV9TSElGVCkgLSAxKTsKKwkJCWJy
ZWFrOworCQl9CisKKwkJcHJvcGVydHkgPSBndWRfZHJtX2Nvbm5lY3Rvcl9wcm9wZXJ0eV9sb29r
dXAoY29ubmVjdG9yLCBwcm9wKTsKKwkJaWYgKElTX0VSUihwcm9wZXJ0eSkpCisJCQljb250aW51
ZTsKKworCQlzdGF0ZV92YWwgPSBndWRfZHJtX2Nvbm5lY3Rvcl90dl9zdGF0ZV92YWwocHJvcCwg
Jmdjb25uLT5pbml0aWFsX3R2X3N0YXRlKTsKKwkJaWYgKElTX0VSUihzdGF0ZV92YWwpKQorCQkJ
Y29udGludWU7CisKKwkJKnN0YXRlX3ZhbCA9IHZhbDsKKwkJZHJtX29iamVjdF9hdHRhY2hfcHJv
cGVydHkoJmNvbm5lY3Rvci0+YmFzZSwgcHJvcGVydHksIDApOworCX0KK291dDoKKwlrZnJlZShw
cm9wZXJ0aWVzKTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBndWRfZHJtX2Nvbm5lY3Rvcl9m
aWxsX3Byb3BlcnRpZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkgICAg
ICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlLAorCQkJCSAgICAg
IHN0cnVjdCBndWRfZHJtX3Byb3BlcnR5ICpwcm9wZXJ0aWVzKQoreworCXN0cnVjdCBndWRfZHJt
X2Nvbm5lY3RvciAqZ2Nvbm47CisJdW5zaWduZWQgaW50IGk7CisKKwlnY29ubiA9IHRvX2d1ZF9k
cm1fY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwkvKiBPbmx5IGludGVyZXN0ZWQgaW4gdGhlIGNv
dW50PyAqLworCWlmICghY29ubmVjdG9yX3N0YXRlKQorCQlyZXR1cm4gZ2Nvbm4tPm51bV9wcm9w
ZXJ0aWVzOworCisJZm9yIChpID0gMDsgaSA8IGdjb25uLT5udW1fcHJvcGVydGllczsgaSsrKSB7
CisJCXUxNiBwcm9wID0gZ2Nvbm4tPnByb3BlcnRpZXNbaV07CisJCXU2NCB2YWw7CisKKwkJaWYg
KHByb3AgPT0gR1VEX0RSTV9QUk9QRVJUWV9CQUNLTElHSFRfQlJJR0hUTkVTUykgeworCQkJdmFs
ID0gY29ubmVjdG9yX3N0YXRlLT5iYWNrbGlnaHRfYnJpZ2h0bmVzczsKKwkJfSBlbHNlIHsKKwkJ
CXVuc2lnbmVkIGludCAqc3RhdGVfdmFsOworCisJCQlzdGF0ZV92YWwgPSBndWRfZHJtX2Nvbm5l
Y3Rvcl90dl9zdGF0ZV92YWwocHJvcCwgJmNvbm5lY3Rvcl9zdGF0ZS0+dHYpOworCQkJaWYgKFdB
Uk5fT05fT05DRShJU19FUlIoc3RhdGVfdmFsKSkpCisJCQkJcmV0dXJuIFBUUl9FUlIoc3RhdGVf
dmFsKTsKKworCQkJdmFsID0gKnN0YXRlX3ZhbDsKKwkJfQorCisJCXByb3BlcnRpZXNbaV0ucHJv
cCA9IGNwdV90b19sZTE2KHByb3ApOworCQlwcm9wZXJ0aWVzW2ldLnZhbCA9IGNwdV90b19sZTY0
KHZhbCk7CisJfQorCisJcmV0dXJuIGdjb25uLT5udW1fcHJvcGVydGllczsKK30KKworaW50IGd1
ZF9kcm1fY29ubmVjdG9yX2NyZWF0ZShzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIHVuc2ln
bmVkIGludCBpbmRleCkKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X2Nvbm5lY3RvciBkZXNj
OworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmZ2RybS0+ZHJtOworCXN0cnVjdCBndWRfZHJt
X2Nvbm5lY3RvciAqZ2Nvbm47CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwlz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisJaW50IHJldDsKKworCXJldCA9IGd1ZF9kcm1f
dXNiX2dldChnZHJtLCBHVURfRFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUiwgaW5kZXgsICZkZXNj
LCBzaXplb2YoZGVzYykpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm1fZGJnKGRy
bSwgImluZGV4PSV1IHR5cGU9JXUgZmxhZ3M9MHgleCBudW1fcHJvcGVydGllcz0ldVxuIiwgaW5k
ZXgsCisJCWRlc2MuY29ubmVjdG9yX3R5cGUsIGxlMzJfdG9fY3B1KGRlc2MuZmxhZ3MpLCBkZXNj
Lm51bV9wcm9wZXJ0aWVzKTsKKworCS8qIFJFVklTSVQ6IFRoaXMgbmVlZHMgdG8gYmUgdXBkYXRl
ZCBhcyBuZXcgdHlwZXMgYXJlIGFkZGVkICovCisJaWYgKGRlc2MuY29ubmVjdG9yX3R5cGUgPiBE
Uk1fTU9ERV9DT05ORUNUT1JfU1BJKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWdjb25uID0ga3ph
bGxvYyhzaXplb2YoKmdjb25uKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFnY29ubikKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwlnY29ubi0+aW5pdGlhbF9icmlnaHRuZXNzID0gLUVOT0RFVjsKKwlnY29u
bi0+ZmxhZ3MgPSBsZTMyX3RvX2NwdShkZXNjLmZsYWdzKTsKKwljb25uZWN0b3IgPSAmZ2Nvbm4t
PmNvbm5lY3RvcjsKKworCWRybV9jb25uZWN0b3JfaGVscGVyX2FkZChjb25uZWN0b3IsICZndWRf
ZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MpOworCXJldCA9IGRybV9jb25uZWN0b3JfaW5pdChk
cm0sIGNvbm5lY3RvciwgJmd1ZF9kcm1fY29ubmVjdG9yX2Z1bmNzLCBkZXNjLmNvbm5lY3Rvcl90
eXBlKTsKKwlpZiAocmV0KSB7CisJCWtmcmVlKGNvbm5lY3Rvcik7CisJCXJldHVybiByZXQ7CisJ
fQorCisJaWYgKFdBUk5fT04oY29ubmVjdG9yLT5pbmRleCAhPSBpbmRleCkpCisJCXJldHVybiAt
RUlOVkFMOworCisJaWYgKGdjb25uLT5mbGFncyAmIEdVRF9EUk1fQ09OTkVDVE9SX0ZMQUdTX1BP
TEwpCisJCWNvbm5lY3Rvci0+cG9sbGVkID0gKERSTV9DT05ORUNUT1JfUE9MTF9DT05ORUNUIHwg
RFJNX0NPTk5FQ1RPUl9QT0xMX0RJU0NPTk5FQ1QpOworCisJaWYgKGRlc2MubnVtX3Byb3BlcnRp
ZXMpIHsKKwkJcmV0ID0gZ3VkX2RybV9jb25uZWN0b3JfYWRkX3Byb3BlcnRpZXMoZ2RybSwgZ2Nv
bm4sIGRlc2MubnVtX3Byb3BlcnRpZXMpOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKGRybS0+
ZGV2LCAiRmFpbGVkIHRvIGFkZCBjb25uZWN0b3IvJXUgcHJvcGVydGllc1xuIiwgaW5kZXgpOwor
CQkJcmV0dXJuIHJldDsKKwkJfQorCX0KKworCS8qIFRoZSBmaXJzdCBjb25uZWN0b3IgaXMgYXR0
YWNoZWQgdG8gdGhlIGV4aXN0aW5nIHNpbXBsZSBwaXBlIGVuY29kZXIgKi8KKwlpZiAoIWNvbm5l
Y3Rvci0+aW5kZXgpIHsKKwkJZW5jb2RlciA9ICZnZHJtLT5waXBlLmVuY29kZXI7CisJfSBlbHNl
IHsKKwkJZW5jb2RlciA9ICZnY29ubi0+ZW5jb2RlcjsKKworCQlyZXQgPSBkcm1fc2ltcGxlX2Vu
Y29kZXJfaW5pdChkcm0sIGVuY29kZXIsIERSTV9NT0RFX0VOQ09ERVJfTk9ORSk7CisJCWlmIChy
ZXQpCisJCQlyZXR1cm4gcmV0OworCisJCWVuY29kZXItPnBvc3NpYmxlX2NydGNzID0gMTsKKwl9
CisKKwlyZXR1cm4gZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29k
ZXIpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Rydi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Rydi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uNGUxYTAxMTVjYTZjCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2Rydi5jCkBAIC0wLDAgKzEsNjI0IEBACisvLyBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IDIwMjAgTm9yYWxmIFRyw7hu
bmVzCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9s
ejQuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9y
bV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9zdHJpbmdfaGVscGVycy5oPgorI2luY2x1ZGUg
PGxpbnV4L3VzYi5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSA8
ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVy
Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kZWJ1Z2ZzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcnYu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91
cmNjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wcmlu
dC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2Ry
bV9zaW1wbGVfa21zX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9ndWRfZHJtLmg+CisKKyNpbmNs
dWRlICJndWRfZHJtX2ludGVybmFsLmgiCisKKy8qIE9ubHkgdXNlZCBpbnRlcm5hbGx5ICovCitz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBndWRfZHJtX2Zvcm1hdF9yMSA9IHsK
KwkuZm9ybWF0ID0gR1VEX0RSTV9GT1JNQVRfUjEsCisJLm51bV9wbGFuZXMgPSAxLAorCS5jaGFy
X3Blcl9ibG9jayA9IHsgMSwgMCwgMCB9LAorCS5ibG9ja193ID0geyA4LCAwLCAwIH0sCisJLmJs
b2NrX2ggPSB7IDEsIDAsIDAgfSwKKwkuaHN1YiA9IDEsCisJLnZzdWIgPSAxLAorfTsKKworc3Rh
dGljIGludCBndWRfZ2V0X3ZlbmRvcl9kZXNjcmlwdG9yKHN0cnVjdCB1c2JfaW50ZXJmYWNlICpp
bnRlcmZhY2UsCisJCQkJICAgICBzdHJ1Y3QgZ3VkX2RybV9kaXNwbGF5X2Rlc2NyaXB0b3IgKmRl
c2MpCit7CisJdTggaWZudW0gPSBpbnRlcmZhY2UtPmN1cl9hbHRzZXR0aW5nLT5kZXNjLmJJbnRl
cmZhY2VOdW1iZXI7CisJc3RydWN0IHVzYl9kZXZpY2UgKnVzYiA9IGludGVyZmFjZV90b191c2Jk
ZXYoaW50ZXJmYWNlKTsKKwl2b2lkICpidWY7CisJaW50IHJldDsKKworCWJ1ZiA9IGttYWxsb2Mo
c2l6ZW9mKCpkZXNjKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFidWYpCisJCXJldHVybiAtRU5PTUVN
OworCisJcmV0ID0gdXNiX2NvbnRyb2xfbXNnKHVzYiwgdXNiX3JjdmN0cmxwaXBlKHVzYiwgMCks
CisJCQkgICAgICBVU0JfUkVRX0dFVF9ERVNDUklQVE9SLAorCQkJICAgICAgVVNCX0RJUl9JTiB8
IFVTQl9UWVBFX1ZFTkRPUiB8IFVTQl9SRUNJUF9JTlRFUkZBQ0UsCisJCQkgICAgICBHVURfRFJN
X1VTQl9EVF9ESVNQTEFZIDw8IDgsIGlmbnVtLCBidWYsIHNpemVvZigqZGVzYyksCisJCQkgICAg
ICBVU0JfQ1RSTF9HRVRfVElNRU9VVCk7CisKKwltZW1jcHkoZGVzYywgYnVmLCBzaXplb2YoKmRl
c2MpKTsKKwlrZnJlZShidWYpOworCisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlp
ZiAocmV0ICE9IHNpemVvZigqZGVzYykgfHwgZGVzYy0+Ykxlbmd0aCAhPSBzaXplb2YoKmRlc2Mp
IHx8CisJICAgIGRlc2MtPmJEZXNjcmlwdG9yVHlwZSAhPSBHVURfRFJNX1VTQl9EVF9ESVNQTEFZ
KQorCQlyZXR1cm4gLUVOT0RBVEE7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZFUigmaW50ZXJmYWNl
LT5kZXYsCisJCQkgICAgICJWZXJzaW9uPSV1IENvbXByZXNzaW9uPTB4JXggTnVtRm9ybWF0cz0l
dSBOdW1Db25uZWN0b3JzPSV1IE1heEJ1ZmZlclNpemVPcmRlcj0ldVxuIiwKKwkJCSAgICAgZGVz
Yy0+YlZlcnNpb24sIGRlc2MtPmJDb21wcmVzc2lvbiwgZGVzYy0+Yk51bUZvcm1hdHMsCisJCQkg
ICAgIGRlc2MtPmJOdW1Db25uZWN0b3JzLCBkZXNjLT5iTWF4QnVmZmVyU2l6ZU9yZGVyKTsKKwor
CWlmIChkZXNjLT5iVmVyc2lvbiAhPSAxIHx8ICFkZXNjLT5iTnVtRm9ybWF0cyB8fCAhZGVzYy0+
Yk51bUNvbm5lY3RvcnMgfHwKKwkgICAgIWRlc2MtPmJNYXhCdWZmZXJTaXplT3JkZXIgfHwgIWRl
c2MtPmR3TWF4V2lkdGggfHwgIWRlc2MtPmR3TWF4SGVpZ2h0IHx8CisJICAgIGxlMzJfdG9fY3B1
KGRlc2MtPmR3TWluV2lkdGgpID4gbGUzMl90b19jcHUoZGVzYy0+ZHdNYXhXaWR0aCkgfHwKKwkg
ICAgbGUzMl90b19jcHUoZGVzYy0+ZHdNaW5IZWlnaHQpID4gbGUzMl90b19jcHUoZGVzYy0+ZHdN
YXhIZWlnaHQpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGd1ZF91c2JfY29udHJvbF9tc2coc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCBib29s
IGluLAorCQkJICAgICAgIHU4IHJlcXVlc3QsIHUxNiB2YWx1ZSwgdm9pZCAqYnVmLCBzaXplX3Qg
bGVuKQoreworCXU4IHJlcXVlc3R0eXBlID0gVVNCX1RZUEVfVkVORE9SIHwgVVNCX1JFQ0lQX0lO
VEVSRkFDRTsKKwl1bnNpZ25lZCBpbnQgcGlwZTsKKwlpbnQgaWR4LCByZXQ7CisKKwlpZiAoIWRy
bV9kZXZfZW50ZXIoJmdkcm0tPmRybSwgJmlkeCkpCisJCXJldHVybiAtRU5PREVWOworCisJaWYg
KGluKSB7CisJCXBpcGUgPSB1c2JfcmN2Y3RybHBpcGUoZ2RybS0+dXNiLCAwKTsKKwkJcmVxdWVz
dHR5cGUgfD0gVVNCX0RJUl9JTjsKKwl9IGVsc2UgeworCQlwaXBlID0gdXNiX3NuZGN0cmxwaXBl
KGdkcm0tPnVzYiwgMCk7CisJCXJlcXVlc3R0eXBlIHw9IFVTQl9ESVJfT1VUOworCX0KKworCXJl
dCA9IHVzYl9jb250cm9sX21zZyhnZHJtLT51c2IsIHBpcGUsIHJlcXVlc3QsIHJlcXVlc3R0eXBl
LCB2YWx1ZSwKKwkJCSAgICAgIGdkcm0tPmlmbnVtLCBidWYsIGxlbiwgVVNCX0NUUkxfR0VUX1RJ
TUVPVVQpOworCWlmIChyZXQgPj0gMCkgeworCQlpZiAocmV0ICE9IGxlbikKKwkJCXJldCA9IC1F
SU87CisJCWVsc2UKKwkJCXJldCA9IDA7CisJfQorCisJZHJtX2Rldl9leGl0KGlkeCk7CisKKwly
ZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGd1ZF91c2JfZ2V0X3N0YXR1cyhzdHJ1Y3QgZ3Vk
X2RybV9kZXZpY2UgKmdkcm0pCit7CisJc3RydWN0IGd1ZF9kcm1fcmVxX2dldF9zdGF0dXMgKnN0
YXR1cyA9IGdkcm0tPnN0YXR1c19idWY7CisJaW50IHJldCwgc3RhdHVzX3JldHJpZXMgPSAyMDAw
IC8gNTsgLyogbWF4aW11bSB3YWl0IH4yIHNlY29uZHMgKi8KKwl1bnNpZ25lZCBsb25nIGRlbGF5
ID0gNTAwOworCisJLyoKKwkgKiBQb2xsIGR1ZSB0byBsYWNrIG9mIGRhdGEvc3RhdHVzIHN0YWdl
IGNvbnRyb2wgb24gdGhlIGdhZGdldCBzaWRlLgorCSAqCisJICogSWYgd2UgZGlkIG5vdCB1c2Ug
cG9sbGluZyBhbmQgZ2F2ZSB1cCBoZXJlIGFmdGVyIHdhaXRpbmcgMiBzZWNvbmRzLAorCSAqIHRo
ZSB3b3JrZXIgaW4gdGhlIGdhZGdldCB3b3VsZCBmaW5hbGx5IGdldCB0byBxdWV1aW5nIHVwIHRo
ZSBzdGF0dXMKKwkgKiByZXNwb25zLCBidXQgYnkgdGhhdCB0aW1lIHRoZSBob3N0IGhhcyBtb3Zl
ZCBvbi4gVGhlIGdhZGdldCBzaWRlCisJICogKGF0IGxlYXN0IGR3YzIpIHdvdWxkIG5vdyBiZSBs
ZWZ0IGluIGEgbm9uLXJlY292ZXJhYmxlIHN0YXRlLgorCSAqCisJICogV29yc3QgY2FzZSBjb21t
aXQgdGltZW91dCBpbiBEUk0gY2FuIGJlIHRlbnMgb2Ygc2Vjb25kcyAod2FpdCBmb3IKKwkgKiB2
YXJpb3VzIF9kb25lIGNvbXBsZXRpb25zKS4KKwkgKi8KKwl3aGlsZSAoc3RhdHVzX3JldHJpZXMt
LSkgeworCQlyZXQgPSBndWRfdXNiX2NvbnRyb2xfbXNnKGdkcm0sIHRydWUsIFVTQl9SRVFfR0VU
X1NUQVRVUywgMCwKKwkJCQkJICBzdGF0dXMsIHNpemVvZigqc3RhdHVzKSk7CisJCWlmIChyZXQp
CisJCQlyZXR1cm4gcmV0OworCisJCWlmICghKHN0YXR1cy0+ZmxhZ3MgJiBHVURfRFJNX1NUQVRV
U19QRU5ESU5HKSkKKwkJCXJldHVybiAtc3RhdHVzLT5lcnJubzsKKworCQl1c2xlZXBfcmFuZ2Uo
ZGVsYXksIGRlbGF5ICsgMTAwMCk7CisKKwkJaWYgKGRlbGF5IDwgNDUwMCkKKwkJCWRlbGF5ICs9
IDEwMDA7CisJfQorCisJcmV0dXJuIC1FVElNRURPVVQ7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3Vz
Yl90cmFuc2ZlcihzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIGJvb2wgaW4sIHU4IHJlcXVl
c3QsCisJCQkgICAgdTE2IGluZGV4LCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJaW50IHJl
dDsKKworCWRybV9kYmcoJmdkcm0tPmRybSwgIiVzOiByZXF1ZXN0PTB4JXggaW5kZXg9JXUgbGVu
PSV6dVxuIiwKKwkJaW4gPyAiZ2V0IiA6ICJzZXQiLCByZXF1ZXN0LCBpbmRleCwgbGVuKTsKKwor
CWlmIChsZW4gPiBHVURfRFJNX01BWF9UUkFOU0ZFUl9TSVpFKQorCQlyZXR1cm4gLUVOT01FTTsK
KworCW11dGV4X2xvY2soJmdkcm0tPmN0cmxfbG9jayk7CisKKwlpZiAoIWluICYmIGJ1ZikKKwkJ
bWVtY3B5KGdkcm0tPmN0cmxfbXNnX2J1ZiwgYnVmLCBsZW4pOworCisJcmV0ID0gZ3VkX3VzYl9j
b250cm9sX21zZyhnZHJtLCBpbiwgcmVxdWVzdCwgaW5kZXgsIGdkcm0tPmN0cmxfbXNnX2J1Ziwg
bGVuKTsKKworCS8qCisJICogT1VUIHRyYW5zZmVycyBhcmUgcHJvY2Vzc2VkIGluIGEgd29ya2Vy
IG9uIHRoZSBnYWRnZXQgc2lkZSBhZnRlcgorCSAqIHJlY2VwdGlvbiBzbyB3ZSBhbHdheXMgbmVl
ZCB0byBjaGVjayBzdGF0dXMuIElOIHRyYW5zZmVycyBhcmUKKwkgKiBwcm9jZXNzZWQgaW4gdGhl
IGludGVycnVwdCBoYW5kbGVyIGFuZCB3aWxsIGhhbHQgb24gZXJyb3IgbGV0dGluZyB1cworCSAq
IGtub3cgc29tZXRoaW5nIHdlbnQgd3JvbmcuCisJICovCisJaWYgKHJldCB8fCAhaW4pIHsKKwkJ
cmV0ID0gZ3VkX3VzYl9nZXRfc3RhdHVzKGdkcm0pOworCQlpZiAocmV0KQorCQkJZ290byB1bmxv
Y2s7CisJfQorCisJaWYgKGluICYmIGJ1ZikKKwkJbWVtY3B5KGJ1ZiwgZ2RybS0+Y3RybF9tc2df
YnVmLCBsZW4pOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmZ2RybS0+Y3RybF9sb2NrKTsKKwor
CWlmIChyZXQpIHsKKwkJZHJtX2RiZygmZ2RybS0+ZHJtLCAicmV0PSVkXG4iLCByZXQpOworCQln
ZHJtLT5zdGF0c19udW1fZXJyb3JzKys7CisJfQorCisJcmV0dXJuIHJldDsKK30KKworaW50IGd1
ZF9kcm1fdXNiX2dldChzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHUx
NiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQoreworCXJldHVybiBndWRfdXNiX3RyYW5z
ZmVyKGdkcm0sIHRydWUsIHJlcXVlc3QsIGluZGV4LCBidWYsIGxlbik7Cit9CisKK2ludCBndWRf
ZHJtX3VzYl9zZXQoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LCB1MTYg
aW5kZXgsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwlyZXR1cm4gZ3VkX3VzYl90cmFuc2Zl
cihnZHJtLCBmYWxzZSwgcmVxdWVzdCwgaW5kZXgsIGJ1ZiwgbGVuKTsKK30KKworaW50IGd1ZF9k
cm1fdXNiX3dyaXRlOChzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHU4
IHZhbCkKK3sKKwlyZXR1cm4gZ3VkX2RybV91c2Jfc2V0KGdkcm0sIHJlcXVlc3QsIDAsICZ2YWws
IHNpemVvZih2YWwpKTsKK30KKworc3RhdGljIGludCBndWRfZHJtX3VzYl9yZWFkMzIoc3RydWN0
IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0LAorCQkJICAgICAgdTMyICp2YWxzLCB1
bnNpZ25lZCBpbnQgbnVtX3ZhbHMpCit7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJldDsKKwor
CXJldCA9IGd1ZF9kcm1fdXNiX2dldChnZHJtLCByZXF1ZXN0LCAwLCB2YWxzLCBudW1fdmFscyAq
IHNpemVvZigqdmFscykpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlmb3IgKGkgPSAw
OyBpIDwgbnVtX3ZhbHM7IGkrKykKKwkJdmFsc1tpXSA9IGxlMzJfdG9fY3B1KChfX2xlMzIpdmFs
c1tpXSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBndWRfZHJtX2dldF9wcm9wZXJ0
aWVzKHN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwgdW5zaWduZWQgaW50IG51bV9wcm9wZXJ0
aWVzKQoreworCXN0cnVjdCBndWRfZHJtX3Byb3BlcnR5ICpwcm9wZXJ0aWVzOworCXVuc2lnbmVk
IGludCBpOworCWludCByZXQ7CisKKwlpZiAoIW51bV9wcm9wZXJ0aWVzKQorCQlyZXR1cm4gMDsK
KworCWdkcm0tPnByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9wZXJ0aWVzLCBzaXplb2YoKmdk
cm0tPnByb3BlcnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdkcm0tPnByb3BlcnRpZXMpCisJ
CXJldHVybiAtRU5PTUVNOworCisJcHJvcGVydGllcyA9IGtjYWxsb2MobnVtX3Byb3BlcnRpZXMs
IHNpemVvZigqcHJvcGVydGllcyksIEdGUF9LRVJORUwpOworCWlmICghcHJvcGVydGllcykKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfZHJtX3VzYl9nZXQoZ2RybSwgR1VEX0RSTV9V
U0JfUkVRX0dFVF9QUk9QRVJUSUVTLCAwLAorCQkJICAgICAgcHJvcGVydGllcywgbnVtX3Byb3Bl
cnRpZXMgKiBzaXplb2YoKnByb3BlcnRpZXMpKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKwor
CWZvciAoaSA9IDA7IGkgPCBudW1fcHJvcGVydGllczsgaSsrKSB7CisJCXUxNiBwcm9wID0gbGUx
Nl90b19jcHUocHJvcGVydGllc1tpXS5wcm9wKTsKKwkJdTY0IHZhbCA9IGxlNjRfdG9fY3B1KHBy
b3BlcnRpZXNbaV0udmFsKTsKKworCQlzd2l0Y2ggKHByb3ApIHsKKwkJY2FzZSBHVURfRFJNX1BS
T1BFUlRZX1JPVEFUSU9OOgorCQkJcmV0ID0gZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9w
ZXJ0eSgmZ2RybS0+cGlwZS5wbGFuZSwKKwkJCQkJCQkJIERSTV9NT0RFX1JPVEFURV8wLCB2YWwp
OworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQkvKiBOZXcgb25lcyBtaWdodCBzaG93IHVwIGlu
IGZ1dHVyZSBkZXZpY2VzLCBza2lwIHRob3NlIHdlIGRvbid0IGtub3cuICovCisJCQlkcm1fZGJn
KCZnZHJtLT5kcm0sICJVbmtub3duIHByb3BlcnR5OiAldVxuIiwgcHJvcCk7CisJCQljb250aW51
ZTsKKwkJfQorCisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQlnZHJtLT5wcm9wZXJ0aWVz
W2dkcm0tPm51bV9wcm9wZXJ0aWVzKytdID0gcHJvcDsKKwl9CitvdXQ6CisJa2ZyZWUocHJvcGVy
dGllcyk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgdm9pZCBndWRfZHJtX2RyaXZlcl9y
ZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNl
ICpnZHJtID0gdG9fZ3VkX2RybV9kZXZpY2UoZHJtKTsKKworCWRybV9kYmcoJmdkcm0tPmRybSwg
IiVzOlxuIiwgX19mdW5jX18pOworCisJZHJtX21vZGVfY29uZmlnX2NsZWFudXAoZHJtKTsKKwlk
cm1fZGV2X2ZpbmkoZHJtKTsKKworCWtmcmVlKGdkcm0tPnByb3BlcnRpZXMpOworCXZmcmVlKGdk
cm0tPmNvbXByZXNzX2J1Zik7CisJa2ZyZWUoZ2RybS0+YnVsa19idWYpOworCWtmcmVlKGdkcm0t
PmN0cmxfbXNnX2J1Zik7CisKKwltdXRleF9kZXN0cm95KCZnZHJtLT5jdHJsX2xvY2spOworCW11
dGV4X2Rlc3Ryb3koJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCWtmcmVlKGdkcm0pOworfQorCitz
dGF0aWMgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoKK2d1ZF9kcm1fZHJpdmVyX2dlbV9jcmVhdGVf
b2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHNpemVfdCBzaXplKQoreworCXN0cnVjdCBk
cm1fZ2VtX3NobWVtX29iamVjdCAqc2htZW07CisKKwlzaG1lbSA9IGt6YWxsb2Moc2l6ZW9mKCpz
aG1lbSksIEdGUF9LRVJORUwpOworCWlmICghc2htZW0pCisJCXJldHVybiBOVUxMOworCisJLyoK
KwkgKiBUaGlzIGRvZXNuJ3QgbWFrZSBhIGRpZmZlcmVuY2Ugb24geDg2LCBidXQgb24gQVJNIChw
aTQpIGl0IHdhcworCSAqIG5lY2Vzc2FyeSB0byBhdm9pZCBibGFjayBsaW5lcyBhbGwgb3ZlciBh
bmQgaXQgbWFkZSBpdCBwb3NzaWJsZSB0bworCSAqIGNvbXByZXNzIGRpcmVjdGx5IGZyb20gdGhl
IGZyYW1lYnVmZmVyIHdpdGhvdXQgcGVyZm9ybWFuY2UgZHJvcC4KKwkgKi8KKwlzaG1lbS0+bWFw
X2NhY2hlZCA9IHRydWU7CisKKwlyZXR1cm4gJnNobWVtLT5iYXNlOworfQorCitzdGF0aWMgaW50
IGd1ZF9kcm1fc3RhdHNfZGVidWdmcyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCit7
CisJc3RydWN0IGRybV9pbmZvX25vZGUgKm5vZGUgPSBtLT5wcml2YXRlOworCXN0cnVjdCBndWRf
ZHJtX2RldmljZSAqZ2RybSA9IHRvX2d1ZF9kcm1fZGV2aWNlKG5vZGUtPm1pbm9yLT5kZXYpOwor
CWNoYXIgYnVmWzEwXTsKKworCXN0cmluZ19nZXRfc2l6ZShnZHJtLT5idWxrX2xlbiwgMSwgU1RS
SU5HX1VOSVRTXzIsIGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCXNlcV9wcmludGYobSwgIk1heCBidWZm
ZXIgc2l6ZTogJXNcbiIsIGJ1Zik7CisJc2VxX3ByaW50ZihtLCAiTnVtYmVyIG9mIGVycm9yczog
ICV1XG4iLCBnZHJtLT5zdGF0c19udW1fZXJyb3JzKTsKKworCXNlcV9wdXRzKG0sICJDb21wcmVz
c2lvbjogICAgICAiKTsKKwlpZiAoZ2RybS0+Y29tcHJlc3Npb24gJiBHVURfRFJNX0NPTVBSRVNT
SU9OX0xaNCkKKwkJc2VxX3B1dHMobSwgIiBsejQiKTsKKwlzZXFfcHV0cyhtLCAiXG4iKTsKKwor
CWlmIChnZHJtLT5jb21wcmVzc2lvbikgeworCQl1NjQgcmVtYWluZGVyOworCQl1NjQgcmF0aW8g
PSBkaXY2NF91NjRfcmVtKGdkcm0tPnN0YXRzX2xlbmd0aCwgZ2RybS0+c3RhdHNfYWN0dWFsX2xl
bmd0aCwKKwkJCQkJICAmcmVtYWluZGVyKTsKKwkJdTY0IHJhdGlvX2ZyYWMgPSBkaXY2NF91NjQo
cmVtYWluZGVyICogMTAsIGdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGgpOworCisJCXNlcV9wcmlu
dGYobSwgIkNvbXByZXNzaW9uIHJhdGlvOiAlbGx1LiVsbHVcbiIsIHJhdGlvLCByYXRpb19mcmFj
KTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1faW5mb19s
aXN0IGd1ZF9kcm1fZGVidWdmc19saXN0W10gPSB7CisJeyAic3RhdHMiLCBndWRfZHJtX3N0YXRz
X2RlYnVnZnMsIDAsIE5VTEwgfSwKK307CisKK3N0YXRpYyBpbnQgZ3VkX2RybV9kcml2ZXJfZGVi
dWdmc19pbml0KHN0cnVjdCBkcm1fbWlub3IgKm1pbm9yKQoreworCXJldHVybiBkcm1fZGVidWdm
c19jcmVhdGVfZmlsZXMoZ3VkX2RybV9kZWJ1Z2ZzX2xpc3QsCisJCQkJCUFSUkFZX1NJWkUoZ3Vk
X2RybV9kZWJ1Z2ZzX2xpc3QpLAorCQkJCQltaW5vci0+ZGVidWdmc19yb290LCBtaW5vcik7Cit9
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgZ3Vk
X2RybV9waXBlX2Z1bmNzID0geworCS5jaGVjayAgICAgID0gZ3VkX2RybV9waXBlX2NoZWNrLAor
CS51cGRhdGUJICAgID0gZ3VkX2RybV9waXBlX3VwZGF0ZSwKKwkucHJlcGFyZV9mYiA9IGRybV9n
ZW1fZmJfc2ltcGxlX2Rpc3BsYXlfcGlwZV9wcmVwYXJlX2ZiLAorfTsKKworc3RhdGljIGNvbnN0
IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfZnVuY3MgZ3VkX2RybV9tb2RlX2NvbmZpZ19mdW5jcyA9
IHsKKwkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGVfd2l0aF9kaXJ0eSwKKwkuYXRvbWlj
X2NoZWNrID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2ssCisJLmF0b21pY19jb21taXQgPSBkcm1f
YXRvbWljX2hlbHBlcl9jb21taXQsCit9OworCitzdGF0aWMgY29uc3QgdWludDY0X3QgZ3VkX2Ry
bV9waXBlX21vZGlmaWVyc1tdID0geworCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKKwlEUk1fRk9S
TUFUX01PRF9JTlZBTElECit9OworCitERUZJTkVfRFJNX0dFTV9GT1BTKGd1ZF9kcm1fZm9wcyk7
CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZlciBndWRfZHJtX2RyaXZlciA9IHsKKwkuZHJpdmVy
X2ZlYXR1cmVzCT0gRFJJVkVSX01PREVTRVQgfCBEUklWRVJfR0VNIHwgRFJJVkVSX0FUT01JQywK
KwkuZm9wcwkJCT0gJmd1ZF9kcm1fZm9wcywKKwkucmVsZWFzZQkJPSBndWRfZHJtX2RyaXZlcl9y
ZWxlYXNlLAorCS5nZW1fY3JlYXRlX29iamVjdAk9IGd1ZF9kcm1fZHJpdmVyX2dlbV9jcmVhdGVf
b2JqZWN0LAorCURSTV9HRU1fU0hNRU1fRFJJVkVSX09QUywKKwkuZGVidWdmc19pbml0CQk9IGd1
ZF9kcm1fZHJpdmVyX2RlYnVnZnNfaW5pdCwKKworCS5uYW1lCQkJPSAiZ3VkX2RybSIsCisJLmRl
c2MJCQk9ICJHZW5lcmljIFVTQiBEaXNwbGF5IiwKKwkuZGF0ZQkJCT0gIjIwMjAwNDIyIiwKKwku
bWFqb3IJCQk9IDEsCisJLm1pbm9yCQkJPSAwLAorfTsKKworc3RhdGljIGludCBndWRfZHJtX3By
b2JlKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsCisJCQkgY29uc3Qgc3RydWN0IHVz
Yl9kZXZpY2VfaWQgKmlkKQoreworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKnhyZ2I4
ODg4X2VtdWxhdGlvbl9mb3JtYXQgPSBOVUxMOworCXUzMiAqZm9ybWF0cywgKmZvcm1hdHNfZGV2
LCBudW1fY29ubmVjdG9ycywgbnVtX2Zvcm1hdHMgPSAwOworCWJvb2wgcmdiNTY1X3N1cHBvcnRl
ZCA9IGZhbHNlLCByZ2I4ODg4X3N1cHBvcnRlZCA9IGZhbHNlOworCXN0cnVjdCB1c2JfZGV2aWNl
ICp1c2IgPSBpbnRlcmZhY2VfdG9fdXNiZGV2KGludGVyZmFjZSk7CisJc3RydWN0IHVzYl9lbmRw
b2ludF9kZXNjcmlwdG9yICpidWxrX291dDsKKwlzdHJ1Y3QgZ3VkX2RybV9kaXNwbGF5X2Rlc2Ny
aXB0b3IgZGVzYzsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaW50ZXJmYWNlLT5kZXY7CisJc3Ry
dWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm07CisJc2l6
ZV90IG1heF9idWZmZXJfc2l6ZTsKKwlpbnQgcmV0LCBpOworCisJcmV0ID0gdXNiX2ZpbmRfYnVs
a19vdXRfZW5kcG9pbnQoaW50ZXJmYWNlLT5jdXJfYWx0c2V0dGluZywgJmJ1bGtfb3V0KTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gZ3VkX2dldF92ZW5kb3JfZGVzY3JpcHRv
cihpbnRlcmZhY2UsICZkZXNjKTsKKwlpZiAocmV0KSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVS
KGRldiwgIk5vdCBhIGRpc3BsYXkgaW50ZXJmYWNlOiByZXQ9JWRcbiIsIHJldCk7CisJCXJldHVy
biAtRU5PREVWOworCX0KKworCW51bV9jb25uZWN0b3JzID0gZGVzYy5iTnVtQ29ubmVjdG9yczsK
KwltYXhfYnVmZmVyX3NpemUgPSAxIDw8IGRlc2MuYk1heEJ1ZmZlclNpemVPcmRlcjsKKworCWdk
cm0gPSBremFsbG9jKHNpemVvZigqZ2RybSksIEdGUF9LRVJORUwpOworCWlmICghZ2RybSkKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlnZHJtLT51c2IgPSB1c2I7CisJZ2RybS0+aWZudW0gPSBpbnRl
cmZhY2UtPmN1cl9hbHRzZXR0aW5nLT5kZXNjLmJJbnRlcmZhY2VOdW1iZXI7CisJZ2RybS0+Y29t
cHJlc3Npb24gPSBkZXNjLmJDb21wcmVzc2lvbiAmIEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0Owor
CisJZHJtID0gJmdkcm0tPmRybTsKKwlyZXQgPSBkZXZtX2RybV9kZXZfaW5pdChkZXYsIGRybSwg
Jmd1ZF9kcm1fZHJpdmVyKTsKKwlpZiAocmV0KSB7CisJCWtmcmVlKGdkcm0pOworCQlyZXR1cm4g
cmV0OworCX0KKworCWRybV9tb2RlX2NvbmZpZ19pbml0KGRybSk7CisJZHJtLT5tb2RlX2NvbmZp
Zy5mdW5jcyA9ICZndWRfZHJtX21vZGVfY29uZmlnX2Z1bmNzOworCisJbXV0ZXhfaW5pdCgmZ2Ry
bS0+Y3RybF9sb2NrKTsKKwltdXRleF9pbml0KCZnZHJtLT5kYW1hZ2VfbG9jayk7CisJSU5JVF9X
T1JLKCZnZHJtLT53b3JrLCBndWRfZHJtX3dvcmspOworCWd1ZF9kcm1fY2xlYXJfZGFtYWdlKGdk
cm0pOworCisJLyoKKwkgKiBkZXZtX2ttYWxsb2MoKSBwbGFjZXMgc3RydWN0IGRldnJlcyBhdCB0
aGUgYmVnaW5uaW5nIG9mIHRoZSBidWZmZXIgaXQKKwkgKiBhbGxvY2F0ZXMuIFRoaXMgY2FuIHdh
c3RlIGEgbG90IG9mIG1lbW9yeSB3aGVuIGFsbG9jYXRpbmcKKwkgKiBwb3dlci1vZi10d28gc2l6
ZWQgYnVmZmVycy4gQXNraW5nIGZvciA0ayB3b3VsZCBhY3R1YWxseSBhbGxvY2F0ZSA4ay4KKwkg
Ki8KKworCWdkcm0tPmN0cmxfbXNnX2J1ZiA9IGttYWxsb2MoR1VEX0RSTV9NQVhfVFJBTlNGRVJf
U0laRSwgR0ZQX0tFUk5FTCk7CisJZ2RybS0+c3RhdHVzX2J1ZiA9IGRldm1fa3phbGxvYyhkZXYs
IHNpemVvZihzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X3N0YXR1cyksIEdGUF9LRVJORUwpOworCWlm
ICghZ2RybS0+Y3RybF9tc2dfYnVmIHx8ICFnZHJtLT5zdGF0dXNfYnVmKQorCQlyZXR1cm4gLUVO
T01FTTsKK3JldHJ5OgorCWdkcm0tPmJ1bGtfYnVmID0ga21hbGxvYyhtYXhfYnVmZmVyX3NpemUs
IEdGUF9LRVJORUwpOworCWlmICghZ2RybS0+YnVsa19idWYpIHsKKwkJbWF4X2J1ZmZlcl9zaXpl
IC89IDI7CisJCWlmIChtYXhfYnVmZmVyX3NpemUgPCBTWl8yTSkgeyAvKiBHaXZlIHVwIGlmIHdl
IGNhbid0IGRvIDEwMjR4NzY4IFJHQjU2NSAqLworCQkJcmV0dXJuIC1FTk9NRU07CisJCX0KKwkJ
Z290byByZXRyeTsKKwl9CisKKwlnZHJtLT5idWxrX3BpcGUgPSB1c2Jfc25kYnVsa3BpcGUoZ2Ry
bS0+dXNiLCB1c2JfZW5kcG9pbnRfbnVtKGJ1bGtfb3V0KSk7CisJZ2RybS0+YnVsa19sZW4gPSBt
YXhfYnVmZmVyX3NpemU7CisKKwlpZiAoZ2RybS0+Y29tcHJlc3Npb24gJiBHVURfRFJNX0NPTVBS
RVNTSU9OX0xaNCkgeworCQlnZHJtLT5sejRfY29tcF9tZW0gPSBkZXZtX2ttYWxsb2MoZGV2LCBM
WjRfTUVNX0NPTVBSRVNTLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFnZHJtLT5sejRfY29tcF9tZW0p
CisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlnZHJtLT5jb21wcmVzc19idWYgPSB2bWFsbG9jKGdk
cm0tPmJ1bGtfbGVuKTsKKwkJaWYgKCFnZHJtLT5jb21wcmVzc19idWYpCisJCQlyZXR1cm4gLUVO
T01FTTsKKwl9CisKKwlkcm0tPm1vZGVfY29uZmlnLm1pbl93aWR0aCA9IGxlMzJfdG9fY3B1KGRl
c2MuZHdNaW5XaWR0aCk7CisJZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGggPSBsZTMyX3RvX2Nw
dShkZXNjLmR3TWF4V2lkdGgpOworCWRybS0+bW9kZV9jb25maWcubWluX2hlaWdodCA9IGxlMzJf
dG9fY3B1KGRlc2MuZHdNaW5IZWlnaHQpOworCWRybS0+bW9kZV9jb25maWcubWF4X2hlaWdodCA9
IGxlMzJfdG9fY3B1KGRlc2MuZHdNYXhIZWlnaHQpOworCisJZm9ybWF0c19kZXYgPSBkZXZtX2tt
YWxsb2NfYXJyYXkoZGV2LCBkZXNjLmJOdW1Gb3JtYXRzLCBzaXplb2YodTMyKSwgR0ZQX0tFUk5F
TCk7CisJLyogQWRkIHJvb20gZm9yIGVtdWxhdGVkIFhSR0I4ODg4ICovCisJZm9ybWF0cyA9IGRl
dm1fa21hbGxvY19hcnJheShkZXYsIGRlc2MuYk51bUZvcm1hdHMgKyAxLCBzaXplb2YodTMyKSwg
R0ZQX0tFUk5FTCk7CisJaWYgKCFmb3JtYXRzX2RldiB8fCAhZm9ybWF0cykKKwkJcmV0dXJuIC1F
Tk9NRU07CisKKwlyZXQgPSBndWRfZHJtX3VzYl9yZWFkMzIoZ2RybSwgR1VEX0RSTV9VU0JfUkVR
X0dFVF9GT1JNQVRTLCBmb3JtYXRzX2RldiwgZGVzYy5iTnVtRm9ybWF0cyk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7IGkgPCBkZXNjLmJOdW1Gb3JtYXRzOyBpKysp
IHsKKwkJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm10X2luZm87CisJCXUzMiBmb3Jt
YXQgPSBmb3JtYXRzX2RldltpXTsKKworCQlpZiAoZm9ybWF0ID09IEdVRF9EUk1fRk9STUFUX1Ix
KSB7CisJCQlmbXRfaW5mbyA9ICZndWRfZHJtX2Zvcm1hdF9yMTsKKwkJfSBlbHNlIHsKKwkJCS8q
IFRoaXMgd2lsbCB0cmlnZ2VyIGEgV0FSTiBmb3IgdW5rbm93biBmb3JtYXRzLi4uICovCisJCQlm
bXRfaW5mbyA9IGRybV9mb3JtYXRfaW5mbyhmb3JtYXQpOworCQkJaWYgKCFmbXRfaW5mbykgewor
CQkJCWRybV9kYmcoZHJtLCAiVW5rbm93biBmb3JtYXQ6IDB4JXhcbiIsIGZvcm1hdCk7CisJCQkJ
Y29udGludWU7CisJCQl9CisJCX0KKworCQlzd2l0Y2ggKGZvcm1hdCkgeworCQljYXNlIERSTV9G
T1JNQVRfWFJHQjg4ODg6CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBEUk1fRk9STUFUX0FSR0I4
ODg4OgorCQkJcmdiODg4OF9zdXBwb3J0ZWQgPSB0cnVlOworCQkJYnJlYWs7CisJCWNhc2UgRFJN
X0ZPUk1BVF9SR0I4ODg6CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBEUk1fRk9STUFUX0JHUjg4
ODoKKwkJCWRybV9kYmcoZHJtLCAiMjQtYml0IGZvcm1hdHMgYXJlIG5vdCBzdXBwb3J0ZWQuXG4i
KTsKKwkJCWNvbnRpbnVlOworCQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQkJcmdiNTY1X3N1
cHBvcnRlZCA9IHRydWU7CisJCQlpZiAoIXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQpCisJCQkJ
eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCA9IGZtdF9pbmZvOworCQkJYnJlYWs7CisJCWNhc2Ug
R1VEX0RSTV9GT1JNQVRfUjE6CisJCQlpZiAoIXhyZ2I4ODg4X2VtdWxhdGlvbl9mb3JtYXQpCisJ
CQkJeHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCA9IGZtdF9pbmZvOworCQkJLyogSW50ZXJuYWws
IG5vdCBmb3IgdXNlcnNwYWNlICovCisJCQljb250aW51ZTsKKwkJfQorCisJCWZvcm1hdHNbbnVt
X2Zvcm1hdHMrK10gPSBmb3JtYXQ7CisJfQorCisJaWYgKCFudW1fZm9ybWF0cyAmJiAheHJnYjg4
ODhfZW11bGF0aW9uX2Zvcm1hdCkgeworCQlkZXZfZXJyKGRldiwgIk5vIHN1cHBvcnRlZCBmb3Jt
YXRzIGZvdW5kXG4iKTsKKwkJcmV0dXJuIC1FTk9FTlQ7CisJfQorCisJLyogUHJlZmVyIHNwZWVk
IG92ZXIgY29sb3IgZGVwdGggKi8KKwlpZiAocmdiNTY1X3N1cHBvcnRlZCkKKwkJZHJtLT5tb2Rl
X2NvbmZpZy5wcmVmZXJyZWRfZGVwdGggPSAxNjsKKworCWlmICghcmdiODg4OF9zdXBwb3J0ZWQg
JiYgeHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkgeworCQlnZHJtLT54cmdiODg4OF9lbXVsYXRp
b25fZm9ybWF0ID0geHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdDsKKwkJZm9ybWF0c1tudW1fZm9y
bWF0cysrXSA9IERSTV9GT1JNQVRfWFJHQjg4ODg7CisJfQorCisJcmV0ID0gZHJtX3NpbXBsZV9k
aXNwbGF5X3BpcGVfaW5pdChkcm0sICZnZHJtLT5waXBlLCAmZ3VkX2RybV9waXBlX2Z1bmNzLAor
CQkJCQkgICBmb3JtYXRzLCBudW1fZm9ybWF0cywKKwkJCQkJICAgZ3VkX2RybV9waXBlX21vZGlm
aWVycywgTlVMTCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWRldm1fa2ZyZWUoZGV2
LCBmb3JtYXRzKTsKKwlkZXZtX2tmcmVlKGRldiwgZm9ybWF0c19kZXYpOworCisJcmV0ID0gZ3Vk
X2RybV9nZXRfcHJvcGVydGllcyhnZHJtLCBkZXNjLmJOdW1Qcm9wZXJ0aWVzKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OworCisJZHJtX3BsYW5lX2VuYWJsZV9mYl9kYW1hZ2VfY2xpcHMoJmdk
cm0tPnBpcGUucGxhbmUpOworCisJZm9yIChpID0gMDsgaSA8IG51bV9jb25uZWN0b3JzOyBpKysp
IHsKKwkJcmV0ID0gZ3VkX2RybV9jb25uZWN0b3JfY3JlYXRlKGdkcm0sIGkpOworCQlpZiAocmV0
KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlkcm1fbW9kZV9jb25maWdfcmVzZXQoZHJtKTsKKwor
CXVzYl9zZXRfaW50ZmRhdGEoaW50ZXJmYWNlLCBnZHJtKTsKKworCXJldCA9IGRybV9kZXZfcmVn
aXN0ZXIoZHJtLCAwKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZHJtX2ttc19oZWxw
ZXJfcG9sbF9pbml0KGRybSk7CisKKwlkcm1fZmJkZXZfZ2VuZXJpY19zZXR1cChkcm0sIDE2KTsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBndWRfZHJtX2Rpc2Nvbm5lY3Qoc3RydWN0
IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSkKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdk
cm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVyZmFjZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRy
bSA9ICZnZHJtLT5kcm07CisKKwlkcm1fZGJnKGRybSwgIiVzOlxuIiwgX19mdW5jX18pOworCisJ
ZHJtX2ttc19oZWxwZXJfcG9sbF9maW5pKGRybSk7CisJZHJtX2Rldl91bnBsdWcoZHJtKTsKKwlk
cm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93bihkcm0pOworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1f
c3VzcGVuZChzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJmYWNlLCBwbV9tZXNzYWdlX3QgbWVz
c2FnZSkKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2ludGZkYXRh
KGludGVyZmFjZSk7CisKKwlyZXR1cm4gZHJtX21vZGVfY29uZmlnX2hlbHBlcl9zdXNwZW5kKCZn
ZHJtLT5kcm0pOworfQorCitzdGF0aWMgaW50IGd1ZF9kcm1fcmVzdW1lKHN0cnVjdCB1c2JfaW50
ZXJmYWNlICppbnRlcmZhY2UpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtID0gdXNi
X2dldF9pbnRmZGF0YShpbnRlcmZhY2UpOworCisJZHJtX21vZGVfY29uZmlnX2hlbHBlcl9yZXN1
bWUoJmdkcm0tPmRybSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCB1
c2JfZGV2aWNlX2lkIGd1ZF9kcm1fdGFibGVbXSA9IHsKKwkvKgorCSAqIEZJWE1FOgorCSAqIEFw
cGx5IGZvciBhIHByb3BlciBwaWQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVubW9rby9vcGVubW9r
by11c2Itb3VpCisJICovCisJeyBVU0JfREVWSUNFX0lOVEVSRkFDRV9DTEFTUygweDFkNTAsIDB4
NjE1MCwgVVNCX0NMQVNTX1ZFTkRPUl9TUEVDKSB9LAorCXsgfQorfTsKKworTU9EVUxFX0RFVklD
RV9UQUJMRSh1c2IsIGd1ZF9kcm1fdGFibGUpOworCitzdGF0aWMgc3RydWN0IHVzYl9kcml2ZXIg
Z3VkX2RybV91c2JfZHJpdmVyID0geworCS5uYW1lCQk9ICJndWRfZHJtIiwKKwkucHJvYmUJCT0g
Z3VkX2RybV9wcm9iZSwKKwkuZGlzY29ubmVjdAk9IGd1ZF9kcm1fZGlzY29ubmVjdCwKKwkuaWRf
dGFibGUJPSBndWRfZHJtX3RhYmxlLAorCS5zdXNwZW5kCT0gZ3VkX2RybV9zdXNwZW5kLAorCS5y
ZXN1bWUJCT0gZ3VkX2RybV9yZXN1bWUsCisJLnJlc2V0X3Jlc3VtZQk9IGd1ZF9kcm1fcmVzdW1l
LAorfTsKKworbW9kdWxlX3VzYl9kcml2ZXIoZ3VkX2RybV91c2JfZHJpdmVyKTsKKworTU9EVUxF
X0FVVEhPUigiTm9yYWxmIFRyw7hubmVzIik7CitNT0RVTEVfTElDRU5TRSgiRHVhbCBNSVQvR1BM
Iik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1faW50ZXJuYWwuaCBi
L2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9pbnRlcm5hbC5oCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMzBkODZiYjAzODlkCi0tLSAvZGV2L251bGwKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX2ludGVybmFsLmgKQEAgLTAsMCArMSw2NiBAQAor
LyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworCisjaWZuZGVmIF9fTElOVVhfR1VE
X0RSTV9JTlRFUk5BTF9ICisjZGVmaW5lIF9fTElOVVhfR1VEX0RSTV9JTlRFUk5BTF9ICisKKyNp
bmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5j
bHVkZSA8bGludXgvbXV0ZXguaD4KKworI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxw
ZXIuaD4KKworc3RydWN0IGd1ZF9kcm1fZGV2aWNlIHsKKwlzdHJ1Y3QgZHJtX2RldmljZSBkcm07
CisJc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlIHBpcGU7CisJc3RydWN0IHdvcmtfc3Ry
dWN0IHdvcms7CisJc3RydWN0IHVzYl9kZXZpY2UgKnVzYjsKKwl1OCBpZm51bTsKKwljb25zdCBz
dHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICp4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0OworCisJdTE2
ICpwcm9wZXJ0aWVzOworCXVuc2lnbmVkIGludCBudW1fcHJvcGVydGllczsKKworCXVuc2lnbmVk
IGludCBidWxrX3BpcGU7CisJdm9pZCAqYnVsa19idWY7CisJc2l6ZV90IGJ1bGtfbGVuOworCisJ
dTggY29tcHJlc3Npb247CisJdm9pZCAqbHo0X2NvbXBfbWVtOworCXZvaWQgKmNvbXByZXNzX2J1
ZjsKKworCXU2NCBzdGF0c19sZW5ndGg7CisJdTY0IHN0YXRzX2FjdHVhbF9sZW5ndGg7CisJdW5z
aWduZWQgaW50IHN0YXRzX251bV9lcnJvcnM7CisKKwlzdHJ1Y3QgbXV0ZXggY3RybF9sb2NrOyAv
KiBTZXJpYWxpemUgcmVxIGFuZCBzdGF0dXMgdHJhbnNmZXJzICovCisJdm9pZCAqY3RybF9tc2df
YnVmOworCXZvaWQgKnN0YXR1c19idWY7CisKKwlzdHJ1Y3QgbXV0ZXggZGFtYWdlX2xvY2s7IC8q
IFByb3RlY3RzIHRoZSBmb2xsb3dpbmcgbWVtYmVyczogKi8KKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYjsKKwlzdHJ1Y3QgZHJtX3JlY3QgZGFtYWdlOworfTsKKworc3RhdGljIGlubGluZSBz
dHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKnRvX2d1ZF9kcm1fZGV2aWNlKHN0cnVjdCBkcm1fZGV2aWNl
ICpkcm0pCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihkcm0sIHN0cnVjdCBndWRfZHJtX2Rldmlj
ZSwgZHJtKTsKK30KKworaW50IGd1ZF9kcm1fdXNiX2dldChzdHJ1Y3QgZ3VkX2RybV9kZXZpY2Ug
Kmdkcm0sIHU4IHJlcXVlc3QsIHUxNiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKTsKK2lu
dCBndWRfZHJtX3VzYl9zZXQoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1OCByZXF1ZXN0
LCB1MTYgaW5kZXgsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbik7CitpbnQgZ3VkX2RybV91c2Jfd3Jp
dGU4KHN0cnVjdCBndWRfZHJtX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTggdmFsKTsKKwor
dm9pZCBndWRfZHJtX2NsZWFyX2RhbWFnZShzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0pOwor
dm9pZCBndWRfZHJtX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKTsKK2ludCBndWRfZHJt
X3BpcGVfY2hlY2soc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkgICAg
ICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlLAorCQkgICAgICAgc3Ry
dWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7Cit2b2lkIGd1ZF9kcm1fcGlwZV91
cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCQkJIHN0cnVjdCBk
cm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSk7CisKK2ludCBndWRfZHJtX2Nvbm5lY3Rvcl9maWxs
X3Byb3BlcnRpZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkgICAgICBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlLAorCQkJCSAgICAgIHN0
cnVjdCBndWRfZHJtX3Byb3BlcnR5ICpwcm9wZXJ0aWVzKTsKK2ludCBndWRfZHJtX2Nvbm5lY3Rv
cl9jcmVhdGUoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgaW5kZXgp
OworCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2RybV9waXBl
LmMgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9kcm1fcGlwZS5jCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNTFjZjliNTU1OThmCi0tLSAvZGV2L251bGwKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJtX3BpcGUuYwpAQCAtMCwwICsxLDQyMyBAQAorLy8g
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCAyMDIwIE5vcmFs
ZiBUcsO4bm5lcworICovCisKKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8
bGludXgvbHo0Lmg+CisjaW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGludXgvd29y
a3F1ZXVlLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9k
cm1fY29ubmVjdG9yLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9kcnYuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Zvcm1hdF9oZWxwZXIuaD4K
KyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZnJhbWVidWZm
ZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9yZWN0Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9zaW1wbGVfa21zX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9ndWRfZHJtLmg+CisKKyNp
bmNsdWRlICJndWRfZHJtX2ludGVybmFsLmgiCisKK3N0YXRpYyBib29sIGd1ZF9kcm1faXNfYmln
X2VuZGlhbih2b2lkKQoreworI2lmIGRlZmluZWQoX19CSUdfRU5ESUFOKQorCXJldHVybiB0cnVl
OworI2Vsc2UKKwlyZXR1cm4gZmFsc2U7CisjZW5kaWYKK30KKworc3RhdGljIHNpemVfdCBndWRf
ZHJtX3hyZ2I4ODg4X3RvX3IxMjQodTggKmRzdCwgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5m
byAqZm9ybWF0LAorCQkJCSAgICAgICB2b2lkICpzcmMsIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLAorCQkJCSAgICAgICBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCit7CisJdW5zaWduZWQgaW50
IGJsb2NrX3dpZHRoID0gZHJtX2Zvcm1hdF9pbmZvX2Jsb2NrX3dpZHRoKGZvcm1hdCwgMCk7CisJ
dW5zaWduZWQgaW50IGJpdHNfcGVyX3BpeGVsID0gOCAvIGJsb2NrX3dpZHRoOworCXVuc2lnbmVk
IGludCB4LCB5LCB3aWR0aCwgaGVpZ2h0OworCXU4ICpwLCAqYmxvY2sgPSBkc3Q7IC8qIEFzc2ln
biB0byBzaWxlbmNlIGNvbXBpbGVyIHdhcm5pbmcgKi8KKwlzaXplX3QgbGVuOworCXZvaWQgKmJ1
ZjsKKworCVdBUk5fT05fT05DRShmb3JtYXQtPmNoYXJfcGVyX2Jsb2NrWzBdICE9IDEpOworCisJ
LyogU3RhcnQgb24gYSBieXRlIGJvdW5kYXJ5ICovCisJcmVjdC0+eDEgPSBBTElHTl9ET1dOKHJl
Y3QtPngxLCBibG9ja193aWR0aCk7CisJd2lkdGggPSBkcm1fcmVjdF93aWR0aChyZWN0KTsKKwlo
ZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQocmVjdCk7CisJbGVuID0gZHJtX2Zvcm1hdF9pbmZvX21p
bl9waXRjaChmb3JtYXQsIDAsIHdpZHRoKSAqIGhlaWdodDsKKworCWJ1ZiA9IGttYWxsb2Mod2lk
dGggKiBoZWlnaHQsIEdGUF9LRVJORUwpOworCWlmICghYnVmKQorCQlyZXR1cm4gbGVuOyAvKiBU
byBrZWVwIGxvZ2ljIHNpbXBsZSwganVzdCB0cmFuc21pdCBnYXJiYWdlICovCisKKwlkcm1fZmJf
eHJnYjg4ODhfdG9fZ3JheTgoYnVmLCBzcmMsIGZiLCByZWN0KTsKKworCXAgPSBidWY7CisJZm9y
ICh5ID0gMDsgeSA8IGRybV9yZWN0X2hlaWdodChyZWN0KTsgeSsrKSB7CisJCWZvciAoeCA9IDA7
IHggPCBkcm1fcmVjdF93aWR0aChyZWN0KTsgeCsrKSB7CisJCQlpZiAoISh4ICUgYmxvY2tfd2lk
dGgpKSB7CisJCQkJYmxvY2sgPSBkc3QrKzsKKwkJCQkqYmxvY2sgPSAwOworCQkJfQorCisJCQkq
YmxvY2sgPDw9IGJpdHNfcGVyX3BpeGVsOworCQkJKmJsb2NrIHw9ICgqcCsrKSA+PiAoOCAtIGJp
dHNfcGVyX3BpeGVsKTsKKwkJfQorCX0KKworCWtmcmVlKGJ1Zik7CisKKwlyZXR1cm4gbGVuOwor
fQorCitzdGF0aWMgaW50IGd1ZF9kcm1fZmJfZmx1c2goc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpn
ZHJtLCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJt
X2Zvcm1hdF9pbmZvICpmb3JtYXQsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKK3sKKwlzdHJ1Y3Qg
ZG1hX2J1Zl9hdHRhY2htZW50ICppbXBvcnRfYXR0YWNoID0gZmItPm9ialswXS0+aW1wb3J0X2F0
dGFjaDsKKwlzdHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X2J1ZmZlciByZXE7CisJc2l6ZV90IHRybGVu
LCBsZW47CisJaW50IGFjdHVhbF9sZW5ndGg7CisJdm9pZCAqdmFkZHIsICpidWY7CisJaW50IHJl
dCA9IDA7CisKKwlkcm1fZGJnKCZnZHJtLT5kcm0sICJGbHVzaGluZyBbRkI6JWRdICIgRFJNX1JF
Q1RfRk1UICIgaW1wb3J0ZWQ9JXNcbiIsCisJCWZiLT5iYXNlLmlkLCBEUk1fUkVDVF9BUkcocmVj
dCksIGltcG9ydF9hdHRhY2ggPyAieWVzIiA6ICJubyIpOworCisJbGVuID0gZHJtX2Zvcm1hdF9p
bmZvX21pbl9waXRjaChmb3JtYXQsIDAsIGRybV9yZWN0X3dpZHRoKHJlY3QpKSAqIGRybV9yZWN0
X2hlaWdodChyZWN0KTsKKwlpZiAobGVuID4gZ2RybS0+YnVsa19sZW4pCisJCXJldHVybiAtRTJC
SUc7CisKKwl2YWRkciA9IGRybV9nZW1fc2htZW1fdm1hcChmYi0+b2JqWzBdKTsKKwlpZiAoIXZh
ZGRyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWlmIChpbXBvcnRfYXR0YWNoKSB7CisJCXJldCA9
IGRtYV9idWZfYmVnaW5fY3B1X2FjY2VzcyhpbXBvcnRfYXR0YWNoLT5kbWFidWYsIERNQV9GUk9N
X0RFVklDRSk7CisJCWlmIChyZXQpCisJCQlnb3RvIHZ1bm1hcDsKKwl9CisKKwlpZiAoZ2RybS0+
Y29tcHJlc3Npb24gJiBHVURfRFJNX0NPTVBSRVNTSU9OX0xaNCkKKwkJYnVmID0gZ2RybS0+Y29t
cHJlc3NfYnVmOworCWVsc2UKKwkJYnVmID0gZ2RybS0+YnVsa19idWY7CisKKwkvKgorCSAqIElt
cG9ydGVkIGJ1ZmZlcnMgYXJlIGFzc3VtZWQgdG8gYmUgd3JpdGUtY29tYmluZWQgYW5kIHRodXMg
dW5jYWNoZWQKKwkgKiB3aXRoIHNsb3cgcmVhZHMgKGF0IGxlYXN0IG9uIEFSTSkuCisJICovCisJ
aWYgKGZvcm1hdCAhPSBmYi0+Zm9ybWF0KSB7CisJCWlmIChmb3JtYXQtPmZvcm1hdCA9PSBHVURf
RFJNX0ZPUk1BVF9SMSkKKwkJCWxlbiA9IGd1ZF9kcm1feHJnYjg4ODhfdG9fcjEyNChidWYsIGZv
cm1hdCwgdmFkZHIsIGZiLCByZWN0KTsKKwkJZWxzZSBpZiAoZm9ybWF0LT5mb3JtYXQgPT0gRFJN
X0ZPUk1BVF9SR0I1NjUpCisJCQlkcm1fZmJfeHJnYjg4ODhfdG9fcmdiNTY1KGJ1ZiwgdmFkZHIs
IGZiLCByZWN0LCBndWRfZHJtX2lzX2JpZ19lbmRpYW4oKSk7CisJfSBlbHNlIGlmIChndWRfZHJt
X2lzX2JpZ19lbmRpYW4oKSAmJiBmb3JtYXQtPmNwcFswXSA+IDEpIHsKKwkJZHJtX2ZiX3N3YWIo
YnVmLCB2YWRkciwgZmIsIHJlY3QsICFpbXBvcnRfYXR0YWNoKTsKKwl9IGVsc2UgaWYgKCFpbXBv
cnRfYXR0YWNoICYmIGdkcm0tPmNvbXByZXNzaW9uICYmIGxlbiA9PSBmYi0+aGVpZ2h0ICogZmIt
PnBpdGNoZXNbMF0pIHsKKwkJLyogY2FuIGNvbXByZXNzIGRpcmVjdGx5IGZyb20gdGhlIGZyYW1l
YnVmZmVyICovCisJCWJ1ZiA9IHZhZGRyOworCX0gZWxzZSB7CisJCWRybV9mYl9tZW1jcHkoYnVm
LCB2YWRkciwgZmIsIHJlY3QpOworCX0KKworCXJlcS54ID0gY3B1X3RvX2xlMzIocmVjdC0+eDEp
OworCXJlcS55ID0gY3B1X3RvX2xlMzIocmVjdC0+eTEpOworCXJlcS53aWR0aCA9IGNwdV90b19s
ZTMyKGRybV9yZWN0X3dpZHRoKHJlY3QpKTsKKwlyZXEuaGVpZ2h0ID0gY3B1X3RvX2xlMzIoZHJt
X3JlY3RfaGVpZ2h0KHJlY3QpKTsKKwlyZXEubGVuZ3RoID0gY3B1X3RvX2xlMzIobGVuKTsKKwor
CWlmIChnZHJtLT5jb21wcmVzc2lvbiAmIEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0KSB7CisJCXJl
dCA9IExaNF9jb21wcmVzc19kZWZhdWx0KGJ1ZiwgZ2RybS0+YnVsa19idWYsIGxlbiwgbGVuLCBn
ZHJtLT5sejRfY29tcF9tZW0pOworCQlpZiAocmV0ID4gMCkKKwkJCXJlcS5jb21wcmVzc2lvbiA9
IEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0OworCX0KKworCXRybGVuID0gbGVuOworCisJaWYgKHJl
dCA+IDApIHsKKwkJcmVxLmNvbXByZXNzZWRfbGVuZ3RoID0gY3B1X3RvX2xlMzIocmV0KTsKKwkJ
dHJsZW4gPSByZXQ7CisJfSBlbHNlIGlmIChidWYgPT0gZ2RybS0+Y29tcHJlc3NfYnVmKSB7CisJ
CS8qCisJCSAqIENvbXByZXNzaW9uIGZhaWxlZCAoYnVmZmVyIGRpZG4ndCBjb21wcmVzcyB3ZWxs
KS4KKwkJICogY29tcHJlc3NfYnVmIGlzIHZtYWxsb2MnZWQgc28gd2UgbmVlZCB0byBjb3B5Lgor
CQkgKi8KKwkJbWVtY3B5KGdkcm0tPmJ1bGtfYnVmLCBnZHJtLT5jb21wcmVzc19idWYsIGxlbik7
CisJfQorCisJaWYgKGltcG9ydF9hdHRhY2gpCisJCWRtYV9idWZfZW5kX2NwdV9hY2Nlc3MoaW1w
b3J0X2F0dGFjaC0+ZG1hYnVmLCBETUFfRlJPTV9ERVZJQ0UpOworCisJZ2RybS0+c3RhdHNfbGVu
Z3RoICs9IGxlbjsKKwkvKiBEaWQgaXQgd3JhcCBhcm91bmQ/ICovCisJaWYgKGdkcm0tPnN0YXRz
X2xlbmd0aCA8PSBsZW4gJiYgZ2RybS0+c3RhdHNfYWN0dWFsX2xlbmd0aCkgeworCQlnZHJtLT5z
dGF0c19sZW5ndGggPSBsZW47CisJCWdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGggPSAwOworCX0K
KwlnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoICs9IHRybGVuOworCisJLyoKKwkgKiBUaGlzIHdp
bGwgd2FpdCBpZiBkZWNvbXByZXNzL2NvcHkgZnJvbSB0aGUgcHJldmlvdXMgZmx1c2ggaXMgc3Rp
bGwgaW4KKwkgKiBwcm9jZXNzIG9uIHRoZSBnYWRnZXQgc2lkZS4KKwkgKi8KKwlyZXQgPSBndWRf
ZHJtX3VzYl9zZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9CVUZGRVIsIDAsICZyZXEsIHNp
emVvZihyZXEpKTsKKwlpZiAocmV0KQorCQlnb3RvIHZ1bm1hcDsKKworCXJldCA9IHVzYl9idWxr
X21zZyhnZHJtLT51c2IsIGdkcm0tPmJ1bGtfcGlwZSwgZ2RybS0+YnVsa19idWYsIHRybGVuLAor
CQkJICAgJmFjdHVhbF9sZW5ndGgsIG1zZWNzX3RvX2ppZmZpZXMoMzAwMCkpOworCWlmICghcmV0
ICYmIHRybGVuICE9IGFjdHVhbF9sZW5ndGgpCisJCXJldCA9IC1FSU87CisJaWYgKHJldCkKKwkJ
Z2RybS0+c3RhdHNfbnVtX2Vycm9ycysrOwordnVubWFwOgorCWRybV9nZW1fc2htZW1fdnVubWFw
KGZiLT5vYmpbMF0sIHZhZGRyKTsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZ3VkX2RybV9j
bGVhcl9kYW1hZ2Uoc3RydWN0IGd1ZF9kcm1fZGV2aWNlICpnZHJtKQoreworCWdkcm0tPmRhbWFn
ZS54MSA9IElOVF9NQVg7CisJZ2RybS0+ZGFtYWdlLnkxID0gSU5UX01BWDsKKwlnZHJtLT5kYW1h
Z2UueDIgPSAwOworCWdkcm0tPmRhbWFnZS55MiA9IDA7Cit9CisKK3ZvaWQgZ3VkX2RybV93b3Jr
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdk
cm0gPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IGd1ZF9kcm1fZGV2aWNlLCB3b3JrKTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQ7CisJc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmI7CisJc3RydWN0IGRybV9yZWN0IGRhbWFnZTsKKwl1bnNpZ25lZCBpbnQgaSwgbGlu
ZXM7CisJaW50IGlkeCwgcmV0ID0gMDsKKwlzaXplX3QgcGl0Y2g7CisKKwlpZiAoIWRybV9kZXZf
ZW50ZXIoJmdkcm0tPmRybSwgJmlkeCkpCisJCXJldHVybjsKKworCW11dGV4X2xvY2soJmdkcm0t
PmRhbWFnZV9sb2NrKTsKKwlmYiA9IGdkcm0tPmZiOworCWdkcm0tPmZiID0gTlVMTDsKKwlkYW1h
Z2UgPSBnZHJtLT5kYW1hZ2U7CisJZ3VkX2RybV9jbGVhcl9kYW1hZ2UoZ2RybSk7CisJbXV0ZXhf
dW5sb2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwlpZiAoIWZiKQorCQlnb3RvIG91dDsKKwor
CWZvcm1hdCA9IGZiLT5mb3JtYXQ7CisJaWYgKGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRf
WFJHQjg4ODggJiYgZ2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkKKwkJZm9ybWF0ID0g
Z2RybS0+eHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdDsKKworCS8qIFNwbGl0IHVwZGF0ZSBpZiBp
dCdzIHRvbyBiaWcgKi8KKwlwaXRjaCA9IGRybV9mb3JtYXRfaW5mb19taW5fcGl0Y2goZm9ybWF0
LCAwLCBkcm1fcmVjdF93aWR0aCgmZGFtYWdlKSk7CisJbGluZXMgPSBkcm1fcmVjdF9oZWlnaHQo
JmRhbWFnZSk7CisKKwlpZiAoZ2RybS0+YnVsa19sZW4gPCBsaW5lcyAqIHBpdGNoKQorCQlsaW5l
cyA9IGdkcm0tPmJ1bGtfbGVuIC8gcGl0Y2g7CisKKwlmb3IgKGkgPSAwOyBpIDwgRElWX1JPVU5E
X1VQKGRybV9yZWN0X2hlaWdodCgmZGFtYWdlKSwgbGluZXMpOyBpKyspIHsKKwkJc3RydWN0IGRy
bV9yZWN0IHJlY3QgPSBkYW1hZ2U7CisKKwkJcmVjdC55MSArPSBpICogbGluZXM7CisJCXJlY3Qu
eTIgPSBtaW5fdCh1MzIsIHJlY3QueTEgKyBsaW5lcywgZGFtYWdlLnkyKTsKKworCQlyZXQgPSBn
dWRfZHJtX2ZiX2ZsdXNoKGdkcm0sIGZiLCBmb3JtYXQsICZyZWN0KTsKKwkJaWYgKHJldCAmJgor
CQkgICAgKHJldCAhPSAtRU5PREVWICYmIHJldCAhPSAtRUNPTk5SRVNFVCAmJiByZXQgIT0gLUVT
SFVURE9XTiAmJiByZXQgIT0gRVBST1RPKSkKKwkJCWRldl9lcnJfb25jZShmYi0+ZGV2LT5kZXYs
ICJGYWlsZWQgdG8gZmx1c2ggZnJhbWVidWZmZXI6IGVycm9yPSVkXG4iLCByZXQpOworCX0KKwor
CWRybV9mcmFtZWJ1ZmZlcl9wdXQoZmIpOworb3V0OgorCWRybV9kZXZfZXhpdChpZHgpOworfQor
CitzdGF0aWMgdm9pZCBndWRfZHJtX2ZiX3F1ZXVlX2RhbWFnZShzdHJ1Y3QgZ3VkX2RybV9kZXZp
Y2UgKmdkcm0sCisJCQkJICAgIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSAgICBz
dHJ1Y3QgZHJtX3JlY3QgKmRhbWFnZSkKK3sKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRf
ZmIgPSBOVUxMOworCisJbXV0ZXhfbG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCisJaWYgKGZi
ICE9IGdkcm0tPmZiKSB7CisJCW9sZF9mYiA9IGdkcm0tPmZiOworCQlkcm1fZnJhbWVidWZmZXJf
Z2V0KGZiKTsKKwkJZ2RybS0+ZmIgPSBmYjsKKwl9CisKKwlnZHJtLT5kYW1hZ2UueDEgPSBtaW4o
Z2RybS0+ZGFtYWdlLngxLCBkYW1hZ2UtPngxKTsKKwlnZHJtLT5kYW1hZ2UueTEgPSBtaW4oZ2Ry
bS0+ZGFtYWdlLnkxLCBkYW1hZ2UtPnkxKTsKKwlnZHJtLT5kYW1hZ2UueDIgPSBtYXgoZ2RybS0+
ZGFtYWdlLngyLCBkYW1hZ2UtPngyKTsKKwlnZHJtLT5kYW1hZ2UueTIgPSBtYXgoZ2RybS0+ZGFt
YWdlLnkyLCBkYW1hZ2UtPnkyKTsKKworCW11dGV4X3VubG9jaygmZ2RybS0+ZGFtYWdlX2xvY2sp
OworCisJcXVldWVfd29yayhzeXN0ZW1fbG9uZ193cSwgJmdkcm0tPndvcmspOworCisJaWYgKG9s
ZF9mYikKKwkJZHJtX2ZyYW1lYnVmZmVyX3B1dChvbGRfZmIpOworfQorCitpbnQgZ3VkX2RybV9w
aXBlX2NoZWNrKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKKwkJICAgICAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSwKKwkJICAgICAgIHN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCit7CisJc3RydWN0IGd1ZF9kcm1fZGV2
aWNlICpnZHJtID0gdG9fZ3VkX2RybV9kZXZpY2UocGlwZS0+Y3J0Yy5kZXYpOworCXN0cnVjdCBk
cm1fcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSA9IHBpcGUtPnBsYW5lLnN0YXRlOworCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJm5ld19jcnRjX3N0YXRlLT5tb2Rl
OworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG5ld19wbGFuZV9zdGF0ZS0+c3Rh
dGU7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqb2xkX2ZiID0gb2xkX3BsYW5lX3N0YXRlLT5m
YjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlID0gTlVMTDsK
KwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+ZmI7CisJY29u
c3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0ID0gZmItPmZvcm1hdDsKKwlzdHJ1Y3Qg
Z3VkX2RybV9yZXFfc2V0X3N0YXRlICpyZXE7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5l
Y3RvcjsKKwlpbnQgaWR4LCByZXQsIG51bV9wcm9wZXJ0aWVzOworCXVuc2lnbmVkIGludCBpOwor
CXNpemVfdCBsZW47CisKKwlpZiAoV0FSTl9PTl9PTkNFKCFmYikpCisJCXJldHVybiAtRUlOVkFM
OworCisJaWYgKG9sZF9wbGFuZV9zdGF0ZS0+cm90YXRpb24gIT0gbmV3X3BsYW5lX3N0YXRlLT5y
b3RhdGlvbikKKwkJbmV3X2NydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRydWU7CisKKwlpZiAo
b2xkX2ZiICYmIG9sZF9mYi0+Zm9ybWF0ICE9IGZvcm1hdCkKKwkJbmV3X2NydGNfc3RhdGUtPm1v
ZGVfY2hhbmdlZCA9IHRydWU7CisKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5tb2RlX2NoYW5nZWQg
JiYgIW5ld19jcnRjX3N0YXRlLT5jb25uZWN0b3JzX2NoYW5nZWQpCisJCXJldHVybiAwOworCisJ
LyogT25seSBvbmUgY29ubmVjdG9yIGlzIHN1cHBvcnRlZCAqLworCWlmIChod2VpZ2h0MzIobmV3
X2NydGNfc3RhdGUtPmNvbm5lY3Rvcl9tYXNrKSAhPSAxKQorCQlyZXR1cm4gLUVJTlZBTDsKKwor
CWlmIChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1hSR0I4ODg4ICYmIGdkcm0tPnhyZ2I4
ODg4X2VtdWxhdGlvbl9mb3JtYXQpCisJCWZvcm1hdCA9IGdkcm0tPnhyZ2I4ODg4X2VtdWxhdGlv
bl9mb3JtYXQ7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBjb25u
ZWN0b3IsIGNvbm5lY3Rvcl9zdGF0ZSwgaSkKKwkJYnJlYWs7CisKKwlpZiAoIWNvbm5lY3Rvcl9z
dGF0ZSkgeworCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOworCisJ
CS8qIFdlIGFsd2F5cyBzZW5kIHRoZSBmdWxsIHN0YXRlIHRvIHRoZSBkZXZpY2UsIHNvIGdldCB0
aGUgY29ubmVjdG9yIHN0YXRlICovCisKKwkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4o
cGlwZS0+Y3J0Yy5kZXYsICZjb25uX2l0ZXIpOworCQlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0
ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7CisJCQlpZiAobmV3X2NydGNfc3RhdGUtPmNvbm5l
Y3Rvcl9tYXNrICYgZHJtX2Nvbm5lY3Rvcl9tYXNrKGNvbm5lY3RvcikpCisJCQkJYnJlYWs7CisJ
CX0KKwkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIpOworCisJCWlmIChX
QVJOX09OX09OQ0UoIWNvbm5lY3RvcikpCisJCQlyZXR1cm4gLUVOT0VOVDsKKworCQljb25uZWN0
b3Jfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rv
cik7CisJCWlmIChJU19FUlIoY29ubmVjdG9yX3N0YXRlKSkKKwkJCXJldHVybiBQVFJfRVJSKGNv
bm5lY3Rvcl9zdGF0ZSk7CisJfQorCisJbnVtX3Byb3BlcnRpZXMgPSBndWRfZHJtX2Nvbm5lY3Rv
cl9maWxsX3Byb3BlcnRpZXMoY29ubmVjdG9yLCBOVUxMLCBOVUxMKTsKKwlpZiAobnVtX3Byb3Bl
cnRpZXMgPCAwKQorCQlyZXR1cm4gbnVtX3Byb3BlcnRpZXM7CisKKwludW1fcHJvcGVydGllcyAr
PSBnZHJtLT5udW1fcHJvcGVydGllczsKKworCWxlbiA9IHN0cnVjdF9zaXplKHJlcSwgcHJvcGVy
dGllcywgbnVtX3Byb3BlcnRpZXMpOworCXJlcSA9IGt6YWxsb2MobGVuLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIXJlcSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlndWRfZHJtX2Zyb21fZGlzcGxheV9t
b2RlKCZyZXEtPm1vZGUsIG1vZGUpOworCisJcmVxLT5mb3JtYXQgPSBjcHVfdG9fbGUzMihmb3Jt
YXQtPmZvcm1hdCk7CisJcmVxLT5jb25uZWN0b3IgPSBkcm1fY29ubmVjdG9yX2luZGV4KGNvbm5l
Y3Rvcik7CisJcmVxLT5udW1fcHJvcGVydGllcyA9IG51bV9wcm9wZXJ0aWVzOworCisJbnVtX3By
b3BlcnRpZXMgPSBndWRfZHJtX2Nvbm5lY3Rvcl9maWxsX3Byb3BlcnRpZXMoY29ubmVjdG9yLCBj
b25uZWN0b3Jfc3RhdGUsCisJCQkJCQkJICAgcmVxLT5wcm9wZXJ0aWVzKTsKKworCWZvciAoaSA9
IDA7IGkgPCBnZHJtLT5udW1fcHJvcGVydGllczsgaSsrKSB7CisJCXUxNiBwcm9wID0gZ2RybS0+
cHJvcGVydGllc1tpXTsKKwkJdTY0IHZhbDsKKworCQlzd2l0Y2ggKHByb3ApIHsKKwkJY2FzZSBH
VURfRFJNX1BST1BFUlRZX1JPVEFUSU9OOgorCQkJdmFsID0gbmV3X3BsYW5lX3N0YXRlLT5yb3Rh
dGlvbjsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJV0FSTl9PTl9PTkNFKDEpOworCQkJcmV0
ID0gLUVJTlZBTDsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJcmVxLT5wcm9wZXJ0aWVzW251bV9w
cm9wZXJ0aWVzICsgaV0ucHJvcCA9IGNwdV90b19sZTE2KHByb3ApOworCQlyZXEtPnByb3BlcnRp
ZXNbbnVtX3Byb3BlcnRpZXMgKyBpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOworCX0KKworCWlm
ICghZHJtX2Rldl9lbnRlcihmYi0+ZGV2LCAmaWR4KSkgeworCQlyZXQgPSAtRU5PREVWOworCQln
b3RvIG91dDsKKwl9CisKKwlyZXQgPSBndWRfZHJtX3VzYl9zZXQoZ2RybSwgR1VEX0RSTV9VU0Jf
UkVRX1NFVF9TVEFURV9DSEVDSywgMCwgcmVxLCBsZW4pOworCisJZHJtX2Rldl9leGl0KGlkeCk7
CitvdXQ6CisJa2ZyZWUocmVxKTsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZ3VkX2RybV9w
aXBlX3VwZGF0ZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCisJCQkgc3Ry
dWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpk
cm0gPSBwaXBlLT5jcnRjLmRldjsKKwlzdHJ1Y3QgZ3VkX2RybV9kZXZpY2UgKmdkcm0gPSB0b19n
dWRfZHJtX2RldmljZShkcm0pOworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlID0gcGlw
ZS0+cGxhbmUuc3RhdGU7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+ZmI7
CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gJnBpcGUtPmNydGM7CisJc3RydWN0IGRybV9yZWN0
IGRhbWFnZTsKKwlpbnQgaWR4OworCisJaWYgKCFkcm1fZGV2X2VudGVyKGRybSwgJmlkeCkpCisJ
CXJldHVybjsKKworCWlmICghb2xkX3N0YXRlLT5mYikKKwkJZ3VkX2RybV91c2Jfd3JpdGU4KGdk
cm0sIEdVRF9EUk1fVVNCX1JFUV9TRVRfQ09OVFJPTExFUl9FTkFCTEUsIDEpOworCisJaWYgKGZi
ICYmIChjcnRjLT5zdGF0ZS0+bW9kZV9jaGFuZ2VkIHx8IGNydGMtPnN0YXRlLT5jb25uZWN0b3Jz
X2NoYW5nZWQpKQorCQlndWRfZHJtX3VzYl9zZXQoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9T
VEFURV9DT01NSVQsIDAsIE5VTEwsIDApOworCisJaWYgKGNydGMtPnN0YXRlLT5hY3RpdmVfY2hh
bmdlZCkKKwkJZ3VkX2RybV91c2Jfd3JpdGU4KGdkcm0sIEdVRF9EUk1fVVNCX1JFUV9TRVRfRElT
UExBWV9FTkFCTEUsIGNydGMtPnN0YXRlLT5hY3RpdmUpOworCisJaWYgKGRybV9hdG9taWNfaGVs
cGVyX2RhbWFnZV9tZXJnZWQob2xkX3N0YXRlLCBzdGF0ZSwgJmRhbWFnZSkpCisJCWd1ZF9kcm1f
ZmJfcXVldWVfZGFtYWdlKGdkcm0sIGZiLCAmZGFtYWdlKTsKKworCWlmICghZmIpIHsKKwkJY2Fu
Y2VsX3dvcmtfc3luYygmZ2RybS0+d29yayk7CisKKwkJbXV0ZXhfbG9jaygmZ2RybS0+ZGFtYWdl
X2xvY2spOworCQlpZiAoZ2RybS0+ZmIpIHsKKwkJCWRybV9mcmFtZWJ1ZmZlcl9wdXQoZ2RybS0+
ZmIpOworCQkJZ2RybS0+ZmIgPSBOVUxMOworCQl9CisJCWd1ZF9kcm1fY2xlYXJfZGFtYWdlKGdk
cm0pOworCQltdXRleF91bmxvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCQlndWRfZHJtX3Vz
Yl93cml0ZTgoZ2RybSwgR1VEX0RSTV9VU0JfUkVRX1NFVF9DT05UUk9MTEVSX0VOQUJMRSwgMCk7
CisJfQorCisJZHJtX2Rldl9leGl0KGlkeCk7Cit9CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9n
dWRfZHJtLmggYi9pbmNsdWRlL2RybS9ndWRfZHJtLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi4xNWJiMzA1NzdiNTcKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRl
L2RybS9ndWRfZHJtLmgKQEAgLTAsMCArMSwzNTYgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgMjAyMCBOb3JhbGYgVHLDuG5uZXMKKyAqLwor
CisjaWZuZGVmIF9fTElOVVhfR1VEX0RSTV9ICisjZGVmaW5lIF9fTElOVVhfR1VEX0RSTV9ICisK
KyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzLmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKyNp
bmNsdWRlIDx1YXBpL2RybS9kcm1fZm91cmNjLmg+CisjaW5jbHVkZSA8dWFwaS9saW51eC91c2Iv
Y2g5Lmg+CisKKy8qCisgKiBNYXhpbXVtIHNpemUgb2YgYSBjb250cm9sIG1lc3NhZ2UsIGZpdHMg
MTIwIGRpc3BsYXkgbW9kZXMuCisgKiBJZiB0aGlzIG5lZWRzIHRvIGluY3JlYXNlLCB0aGUgSU4g
c2lkZSBpbiBmX2d1ZF9kcm1fc2V0dXAoKQorICogbmVlZHMgZml4aW5nLgorICovCisjZGVmaW5l
IEdVRF9EUk1fTUFYX1RSQU5TRkVSX1NJWkUJU1pfNEsKKworI2RlZmluZSBHVURfRFJNX1VTQl9E
VF9ESVNQTEFZCQkoVVNCX1RZUEVfVkVORE9SIHwgMHg0KQorCisvKgorICogc3RydWN0IGd1ZF9k
cm1fZGlzcGxheV9kZXNjcmlwdG9yIC0gRGlzcGxheSBkZXNjcmlwdG9yCisgKiBAYkxlbmd0aDog
U2l6ZSBvZiBkZXNjcmlwdG9yIGluIGJ5dGVzCisgKiBAYkRlc2NyaXB0b3JUeXBlOiBEZXNjcmlw
dG9yVHlwZSAoR1VEX0RSTV9VU0JfRFRfRElTUExBWSkKKyAqIEBiVmVyc2lvbjogUHJvdG9jb2wg
dmVyc2lvbgorICogQGJNYXhCdWZmZXJTaXplT3JkZXI6IE1heGltdW0gYnVmZmVyIHNpemUgdGhl
IGRldmljZSBjYW4gaGFuZGxlIGFzIGxvZzIKKyAqIEBibUZsYWdzOiBDdXJyZW50bHkgdW51c2Vk
LCBzaG91bGQgYmUgc2V0IHRvIHplcm8KKyAqIEBiQ29tcHJlc3Npb246IFN1cHBvcnRlZCBjb21w
cmVzc2lvbiB0eXBlcworICogQGR3TWluV2lkdGg6IE1pbmltdW0gcGl4ZWwgd2lkdGggdGhlIGNv
bnRyb2xsZXIgY2FuIGhhbmRsZQorICogQGR3TWF4V2lkdGg6IE1heGltdW0gd2lkdGgKKyAqIEBk
d01pbkhlaWdodDogTWluaW11bSBoZWlnaHQKKyAqIEBkd01heEhlaWdodDogTWF4aW11bSBoZWln
aHQKKyAqIEBiTnVtRm9ybWF0czogTnVtYmVyIG9mIHN1cHBvcnRlZCBwaXhlbCBmb3JtYXRzCisg
KiBAYk51bVByb3BlcnRpZXM6IE51bWJlciBvZiBwcm9wZXJ0aWVzIHRoYXQgYXJlIG5vdCBjb25u
ZWN0b3IgcG9ycGVydGllcworICogQGJOdW1Db25uZWN0b3JzOiBOdW1iZXIgb2YgY29ubmVjdG9y
cworICoKKyAqIERldmljZXMgdGhhdCBoYXZlIG9ubHkgb25lIGRpc3BsYXkgbW9kZSB3aWxsIGhh
dmUgZHdNaW5XaWR0aCA9PSBkd01heFdpZHRoCisgKiBhbmQgZHdNaW5IZWlnaHQgPT0gZHdNYXhI
ZWlnaHQuCisgKgorICovCitzdHJ1Y3QgZ3VkX2RybV9kaXNwbGF5X2Rlc2NyaXB0b3IgeworCV9f
dTggYkxlbmd0aDsKKwlfX3U4IGJEZXNjcmlwdG9yVHlwZTsKKworCV9fdTggYlZlcnNpb247CisJ
X191OCBiTWF4QnVmZmVyU2l6ZU9yZGVyOworCV9fbGUzMiBibUZsYWdzOworCisJX191OCBiQ29t
cHJlc3Npb247CisjZGVmaW5lIEdVRF9EUk1fQ09NUFJFU1NJT05fTFo0CQlCSVQoMCkKKworCV9f
bGUzMiBkd01pbldpZHRoOworCV9fbGUzMiBkd01heFdpZHRoOworCV9fbGUzMiBkd01pbkhlaWdo
dDsKKwlfX2xlMzIgZHdNYXhIZWlnaHQ7CisKKwlfX3U4IGJOdW1Gb3JtYXRzOworCV9fdTggYk51
bVByb3BlcnRpZXM7CisJX191OCBiTnVtQ29ubmVjdG9yczsKK30gX19wYWNrZWQ7CisKKy8qCisg
KiBzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X3N0YXR1cyAtIFN0YXR1cyByZXF1ZXN0CisgKiBAZmxh
Z3M6IEZsYWdzCisgKiBAZXJybm86IExpbnV4IGVycm5vIHZhbHVlCisgKgorICogVGhlIGhvc3Qg
a2VlcHMgcG9sbGluZyBmb3Igc3RhdHVzIGFzIGxvbmcgYXMgdGhlIEdVRF9EUk1fU1RBVFVTX1BF
TkRJTkcgZmxhZworICogaXMgc2V0IChvciB1bnRpbCB0aW1lb3V0KS4gUmVxdWVzdGVkIHVzaW5n
OiBVU0JfUkVRX0dFVF9TVEFUVVMuCisgKi8KK3N0cnVjdCBndWRfZHJtX3JlcV9nZXRfc3RhdHVz
IHsKKwlfX3U4IGZsYWdzOworI2RlZmluZSBHVURfRFJNX1NUQVRVU19QRU5ESU5HCUJJVCgwKQor
CV9fdTggZXJybm87Cit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9kcm1fcHJvcGVy
dHkgLSBQcm9wZXJ0eQorICogQHByb3A6IFByb3BlcnR5CisgKiBAdmFsOiBWYWx1ZQorICovCitz
dHJ1Y3QgZ3VkX2RybV9wcm9wZXJ0eSB7CisJX19sZTE2IHByb3A7CisJX19sZTY0IHZhbDsKK30g
X19wYWNrZWQ7CisKKy8qIFNlZSAmZHJtX2Rpc3BsYXlfbW9kZSBmb3IgdGhlIG1lYW5pbmcgb2Yg
dGhlc2UgZmllbGRzICovCitzdHJ1Y3QgZ3VkX2RybV9kaXNwbGF5X21vZGUgeworCV9fbGUzMiBj
bG9jazsKKwlfX2xlMTYgaGRpc3BsYXk7CisJX19sZTE2IGhzeW5jX3N0YXJ0OworCV9fbGUxNiBo
c3luY19lbmQ7CisJX19sZTE2IGh0b3RhbDsKKwlfX2xlMTYgaHNrZXc7CisJX19sZTE2IHZkaXNw
bGF5OworCV9fbGUxNiB2c3luY19zdGFydDsKKwlfX2xlMTYgdnN5bmNfZW5kOworCV9fbGUxNiB2
dG90YWw7CisJX19sZTE2IHZzY2FuOworCV9fbGUzMiB2cmVmcmVzaDsKKwlfX2xlMzIgZmxhZ3M7
CisJX191OCB0eXBlOworfSBfX3BhY2tlZDsKKworLyoKKyAqIHN0cnVjdCBndWRfZHJtX3JlcV9n
ZXRfY29ubmVjdG9yIC0gQ29ubmVjdG9yIGRlc2NyaXB0b3IKKyAqIEBjb25uZWN0b3JfdHlwZTog
Q29ubmVjdG9yIHR5cGUgKERSTV9NT0RFX0NPTk5FQ1RPUl8qKQorICogQGZsYWdzOiBGbGFncwor
ICogQG51bV9wcm9wZXJ0aWVzOiBOdW1iZXIgb2Ygc3VwcG9ydGVkIHByb3BlcnRpZXMKKyAqLwor
c3RydWN0IGd1ZF9kcm1fcmVxX2dldF9jb25uZWN0b3IgeworCV9fdTggY29ubmVjdG9yX3R5cGU7
CisKKwlfX2xlMzIgZmxhZ3M7CisjZGVmaW5lIEdVRF9EUk1fQ09OTkVDVE9SX0ZMQUdTX1BPTEwJ
QklUKDApCisKKwlfX3U4IG51bV9wcm9wZXJ0aWVzOworfSBfX3BhY2tlZDsKKworLyoKKyAqIHN0
cnVjdCBndWRfZHJtX3JlcV9nZXRfY29ubmVjdG9yX3N0YXR1cyAtIENvbm5lY3RvciBzdGF0dXMK
KyAqIEBzdGF0dXM6IFN0YXR1cywgc2VlICZkcm1fY29ubmVjdG9yX3N0YXR1cworICogQG51bV9t
b2RlczogTnVtYmVyIG9mIGF2YWlsYWJsZSBkaXNwbGF5IG1vZGVzCisgKiBAbW9kZXNfYXJyYXlf
Y2hlY2tzdW06IENSQy1DQ0lUVCBjaGVja3N1bSBvZiB0aGUgZGlzcGxheSBtb2RlIGFycmF5IGlu
IGxpdHRsZSBlbmRpYW4gZm9ybWF0CisgKiBAZWRpZF9sZW46IExlbmd0aCBvZiBFRElEIGRhdGEK
KyAqIEBlZGlkX2NoZWNrc3VtOiBDUkMtQ0NJVFQgY2hlY2tzdW0gb2YgRURJRCBkYXRhCisgKgor
ICogSWYgYm90aCBAbnVtX21vZGVzIGFuZCBAZWRpZF9sZW4gYXJlIHplcm8sIGNvbm5lY3RvciBz
dGF0dXMgaXMgc2V0IHRvCisgKiBkaXNjb25uZWN0ZWQuIElmIEBudW1fbW9kZXMgaXMgemVybywg
ZWRpZCBpcyB1c2VkIHRvIGNyZWF0ZSBkaXNwbGF5IG1vZGVzLgorICogSWYgYm90aCBhcmUgc2V0
LCBlZGlkIGlzIGp1c3QgcGFzc2VkIG9uIHRvIHVzZXJzcGFjZSBpbiB0aGUgRURJRCBjb25uZWN0
b3IKKyAqIHByb3BlcnR5LgorICoKKyAqIERpc3BsYXkgbW9kZXMgYW5kIEVESUQgYXJlIG9ubHkg
cmVxdWVzdGVkIGlmIG51bWJlci9sZW5ndGggb3IgY3JjIGRpZmZlcnMuCisgKi8KK3N0cnVjdCBn
dWRfZHJtX3JlcV9nZXRfY29ubmVjdG9yX3N0YXR1cyB7CisJX191OCBzdGF0dXM7CisjZGVmaW5l
IEdVRF9EUk1fQ09OTkVDVE9SX1NUQVRVU19NQVNLCQkweGYgLyogT25seSAyIGJpdHMgYXJlIGN1
cnJlbnRseSB1c2VkIGZvciBzdGF0dXMgKi8KKyNkZWZpbmUgR1VEX0RSTV9DT05ORUNUT1JfU1RB
VFVTX0NIQU5HRUQJQklUKDcpCisJX191MTYgbnVtX21vZGVzOworCV9fdTE2IGVkaWRfbGVuOwor
fSBfX3BhY2tlZDsKKworLyoKKyAqIHN0cnVjdCBndWRfZHJtX3JlcV9zZXRfYnVmZmVyIC0gU2V0
IGJ1ZmZlciB0cmFuc2ZlciBpbmZvCisgKiBAeDogWCBwb3NpdGlvbiBvZiByZWN0YW5nbGUKKyAq
IEB5OiBZIHBvc2l0aW9uCisgKiBAd2lkdGg6IFBpeGVsIHdpZHRoIG9mIHJlY3RhbmdsZQorICog
QGhlaWdodDogUGl4ZWwgaGVpZ2h0CisgKiBAbGVuZ3RoOiBCdWZmZXIgbGVuZ3RoIGluIGJ5dGVz
CisgKiBAY29tcHJlc3Npb246IFRyYW5zZmVyIGNvbXByZXNzaW9uCisgKiBAY29tcHJlc3NlZF9s
ZW5ndGg6IENvbXByZXNzZWQgYnVmZmVyIGxlbmd0aAorICoKKyAqIEB4LCBAeSwgQHdpZHRoIGFu
ZCBAaGVpZ2h0IHNwZWNpZmllcyB0aGUgcmVjdGFuZ2xlIHdoZXJlIHRoZSBidWZmZXIgc2hvdWxk
IGJlCisgKiBwbGFjZWQgaW5zaWRlIHRoZSBmcmFtZWJ1ZmZlci4KKyAqLworc3RydWN0IGd1ZF9k
cm1fcmVxX3NldF9idWZmZXIgeworCV9fbGUzMiB4OworCV9fbGUzMiB5OworCV9fbGUzMiB3aWR0
aDsKKwlfX2xlMzIgaGVpZ2h0OworCisJX19sZTMyIGxlbmd0aDsKKwlfX3U4IGNvbXByZXNzaW9u
OworCV9fbGUzMiBjb21wcmVzc2VkX2xlbmd0aDsKK30gX19wYWNrZWQ7CisKKy8qCisgKiBzdHJ1
Y3QgZ3VkX2RybV9yZXFfc2V0X3N0YXRlIC0gU2V0IGRpc3BsYXkgc3RhdGUKKyAqIEBtb2RlOiBE
aXNwbGF5IG1vZGUKKyAqIEBmb3JtYXQ6IFBpeGVsIGZvcm1hdAorICogQGNvbm5lY3RvcjogQ29u
bmVjdG9yIGluZGV4CisgKiBAbnVtX3Byb3BlcnRpZXM6IE51bWJlciBvZiBwcm9wZXJ0aWVzIGlu
IHRoZSBzdGF0ZQorICogQHByb3BlcnRpZXM6IEFycmF5IG9mIHByb3BlcnRpZXMKKyAqCisgKiBU
aGUgZW50aXJlIHN0YXRlIGlzIHRyYW5zZmVycmVkIGVhY2ggdGltZSB0aGVyZSdzIGEgY2hhbmdl
LgorICovCitzdHJ1Y3QgZ3VkX2RybV9yZXFfc2V0X3N0YXRlIHsKKwlzdHJ1Y3QgZ3VkX2RybV9k
aXNwbGF5X21vZGUgbW9kZTsKKwlfX2xlMzIgZm9ybWF0OworCV9fdTggY29ubmVjdG9yOworCV9f
dTggbnVtX3Byb3BlcnRpZXM7CisJc3RydWN0IGd1ZF9kcm1fcHJvcGVydHkgcHJvcGVydGllc1td
OworfSBfX3BhY2tlZDsKKworLyoKKyAqIEludGVybmFsIG1vbm9jaHJvbWUgdHJhbnNmZXIgZm9y
bWF0IHByZXNlbnRlZCB0byB1c2Vyc3BhY2UgYXMgWFJHQjg4ODguCisgKiBQaXhlbCBsaW5lcyBh
cmUgYnl0ZSBhbGlnbmVkLgorICovCisjZGVmaW5lIEdVRF9EUk1fRk9STUFUX1IxCWZvdXJjY19j
b2RlKCdSJywgJzEnLCAnICcsICcgJykKKworLyogTGlzdCBvZiBzdXBwb3J0ZWQgY29ubmVjdG9y
IHByb3BlcnRpZXM6ICovCisKKy8qIFRWIHJlbGF0ZWQgcHJvcGVydGllcywgc2VlICZkcm1fY29u
bmVjdG9yIGFuZCAmZHJtX3R2X2Nvbm5lY3Rvcl9zdGF0ZSAqLworI2RlZmluZSBHVURfRFJNX1BS
T1BFUlRZX1RWX1NFTEVDVF9TVUJDT05ORUNUT1IJCTEKKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJU
WV9UVl9MRUZUX01BUkdJTgkJCTIKKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJUWV9UVl9SSUdIVF9N
QVJHSU4JCTMKKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJUWV9UVl9UT1BfTUFSR0lOCQkJNAorI2Rl
ZmluZSBHVURfRFJNX1BST1BFUlRZX1RWX0JPVFRPTV9NQVJHSU4JCTUKKy8qIE51bWJlciBvZiBt
b2RlcyBhcmUgcGxhY2VkIGF0IF9TSElGVCBpbiB2YWwgb24gcmV0cmlldmFsICovCisjZGVmaW5l
IEdVRF9EUk1fUFJPUEVSVFlfVFZfTU9ERQkJCTYKKyAgI2RlZmluZSBHVURfRFJNX1VTQl9DT05O
RUNUT1JfVFZfTU9ERV9OVU1fU0hJRlQgICAxNgorI2RlZmluZSBHVURfRFJNX1BST1BFUlRZX1RW
X0JSSUdIVE5FU1MJCQk3CisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfQ09OVFJBU1QJCQk4
CisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJT04JCTkKKyNkZWZp
bmUgR1VEX0RSTV9QUk9QRVJUWV9UVl9PVkVSU0NBTgkJCTEwCisjZGVmaW5lIEdVRF9EUk1fUFJP
UEVSVFlfVFZfU0FUVVJBVElPTgkJCTExCisjZGVmaW5lIEdVRF9EUk1fUFJPUEVSVFlfVFZfSFVF
CQkJCTEyCisKKy8qCisgKiBCYWNrbGlnaHQgYnJpZ2h0bmVzcyBpcyBpbiB0aGUgcmFuZ2UgMC0x
MDAgaW5jbHVzaXZlLiBUaGUgdmFsdWUgcmVwcmVzZW50cworICogdGhlIGh1bWFuIHBlcmNlcHR1
YWwgYnJpZ2h0bmVzcyBhbmQgbm90IGEgbGluZWFyIFBXTSB2YWx1ZS4gMCBpcyBtaW5pbXVtCisg
KiBicmlnaHRuZXNzIHdoaWNoIHNob3VsZCBub3QgdHVybiB0aGUgYmFja2xpZ2h0IGNvbXBsZXRl
bHkgb2ZmLiBUaGUgRFBNUworICogY29ubmVjdG9yIHByb3BlcnR5IHNob3VsZCBiZSB1c2VkIHRv
IGNvbnRyb2wgcG93ZXIgd2hpY2ggd2lsbCB0cmlnZ2VyIGEKKyAqIEdVRF9EUk1fVVNCX1JFUV9T
RVRfRElTUExBWV9FTkFCTEUgcmVxdWVzdC4KKyAqCisgKiBUaGlzIGlzIG5vdCBhIHJlYWwgRFJN
IHByb3BlcnR5LCBidXQgcmF0aGVyIGEgZmFrZSBvbmUgdXNlZCBmb3IgdGhlIGJhY2tsaWdodAor
ICogZGV2aWNlLiBTZWUgZHJtX2JhY2tsaWdodF9yZWdpc3RlcigpIGZvciBtb3JlIGRldGFpbHMu
CisgKi8KKyNkZWZpbmUgR1VEX0RSTV9QUk9QRVJUWV9CQUNLTElHSFRfQlJJR0hUTkVTUwkJMTMK
KworLyogTGlzdCBvZiBzdXBwb3J0ZWQgcHJvcGVydGllcyB0aGF0IGFyZSBub3QgY29ubmVjdG9y
IHByb3BldGllczogKi8KKworLyoKKyAqIFBsYW5lIHJvdGF0aW9uLiBTaG91bGQgcmV0dXJuIHRo
ZSBzdXBwb3J0ZWQgYml0bWFzayBvbgorICogR1VEX0RSTV9VU0JfUkVRX0dFVF9QUk9QRVJUSUVT
LCBzZWUgZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgpLgorICovCisjZGVmaW5l
IEdVRF9EUk1fUFJPUEVSVFlfUk9UQVRJT04JCQk1MAorCisvKiBVU0IgQ29udHJvbCByZXF1ZXN0
czogKi8KKworLyogR2V0IHN1cHBvcnRlZCBwaXhlbCBmb3JtYXRzIGFzIGFuIGFycmF5IG9mIGZv
dXJjYyBjb2Rlcy4gU2VlIGluY2x1ZGUvdWFwaS9kcm0vZHJtX2ZvdXJjYy5oICovCisjZGVmaW5l
IEdVRF9EUk1fVVNCX1JFUV9HRVRfRk9STUFUUwkJCTB4NDAKKworLyogR2V0IHN1cHBvcnRlZCBw
cm9wZXJ0aWVzIHRoYXQgYXJlIG5vdCBjb25uZWN0b3IgcHJvcGV0aWVzIGFzIGEgJmd1ZF9kcm1f
cHJvcGVydHkgYXJyYXkgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9QUk9QRVJUSUVT
CQkJMHg0MQorCisvKiBHZXQgY29ubmVjdG9yIGRlc2NyaXB0b3IgKi8KKyNkZWZpbmUgR1VEX0RS
TV9VU0JfUkVRX0dFVF9DT05ORUNUT1IJCQkweDUwCisKKy8qIEdldCBwcm9wZXJ0aWVzIHN1cHBv
cnRlZCBieSB0aGUgY29ubmVjdG9yIGFzIGEgJmd1ZF9kcm1fcHJvcGVydHkgYXJyYXkgKi8KKyNk
ZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1JfUFJPUEVSVElFUwkweDUxCisKKy8q
CisgKiBJc3N1ZWQgd2hlbiB0aGVyZSdzIGEgdHYubW9kZSBwcm9wZXJ0eSBwcmVzZW50LgorICog
R2V0cyBhbiBhcnJheSBvZiB0di5tb2RlIGVudW0gbmFtZXMgZWFjaCBlbnRyeSBvZiBsZW5ndGgg
RFJNX1BST1BfTkFNRV9MRU4uCisgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05O
RUNUT1JfVFZfTU9ERV9WQUxVRVMJMHg1MgorCisvKiBXaGVuIHVzZXJzcGFjZSBjaGVja3Mgc3Rh
dHVzLCB0aGlzIGlzIGlzc3VlZCBmaXJzdCwgbm90IHVzZWQgZm9yIHBvbGwgcmVxdWVzdHMuICov
CisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9TRVRfQ09OTkVDVE9SX0ZPUkNFX0RFVEVDVAkweDUz
CisKKy8qIEdldCBjb25uZWN0b3Igc3RhdHVzIGFzICZndWRfZHJtX3JlcV9nZXRfY29ubmVjdG9y
X3N0YXR1cy4gKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1JfU1RBVFVT
CQkweDU0CisKKy8qIEdldCAmZ3VkX2RybV9kaXNwbGF5X21vZGUgYXJyYXkgb2Ygc3VwcG9ydGVk
IGRpc3BsYXkgbW9kZXMgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX0dFVF9DT05ORUNUT1Jf
TU9ERVMJCTB4NTUKKworI2RlZmluZSBHVURfRFJNX1VTQl9SRVFfR0VUX0NPTk5FQ1RPUl9FRElE
CQkweDU2CisKKy8qIFNldCBidWZmZXIgcHJvcGVydGllcyBiZWZvcmUgYnVsayB0cmFuc2ZlciBh
cyAmZ3VkX2RybV9yZXFfc2V0X2J1ZmZlciAqLworI2RlZmluZSBHVURfRFJNX1VTQl9SRVFfU0VU
X0JVRkZFUgkJCTB4NjAKKworLyogQ2hlY2sgZGlzcGxheSBjb25maWd1cmF0aW9uIGFzICZndWRf
ZHJtX3JlcV9zZXRfc3RhdGUgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX1NFVF9TVEFURV9D
SEVDSwkJCTB4NjEKKworLyogQXBwbHkgdGhlIHByZXZvaXVzIF9TVEFURV9DSEVDSyBjb25maWd1
cmF0aW9uICovCisjZGVmaW5lIEdVRF9EUk1fVVNCX1JFUV9TRVRfU1RBVEVfQ09NTUlUCQkweDYy
CisKKyAvKiBFbmFibGUvZGlzYWJsZSB0aGUgZGlzcGxheSBjb250cm9sbGVyLCB2YWx1ZSBpcyB1
OCAwLzEgKi8KKyNkZWZpbmUgR1VEX0RSTV9VU0JfUkVRX1NFVF9DT05UUk9MTEVSX0VOQUJMRQkJ
MHg2MworCisvKiBFbmFibGUvZGlzYWJsZSBkaXNwbGF5L291dHB1dCAoRFBNUyksIHZhbHVlIGlz
IHU4IDAvMSAqLworI2RlZmluZSBHVURfRFJNX1VTQl9SRVFfU0VUX0RJU1BMQVlfRU5BQkxFCQkw
eDY0CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBndWRfZHJtX2Zyb21fZGlzcGxheV9tb2RlKHN0cnVj
dCBndWRfZHJtX2Rpc3BsYXlfbW9kZSAqZHN0LAorCQkJCQkgICAgIGNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICpzcmMpCit7CisJdTMyIGZsYWdzID0gc3JjLT5mbGFnczsKKworCXN3aXRj
aCAoc3JjLT5waWN0dXJlX2FzcGVjdF9yYXRpbykgeworCWNhc2UgSERNSV9QSUNUVVJFX0FTUEVD
VF80XzM6CisJCWZsYWdzIHw9IERSTV9NT0RFX0ZMQUdfUElDX0FSXzRfMzsKKwkJYnJlYWs7CisJ
Y2FzZSBIRE1JX1BJQ1RVUkVfQVNQRUNUXzE2Xzk6CisJCWZsYWdzIHw9IERSTV9NT0RFX0ZMQUdf
UElDX0FSXzE2Xzk7CisJCWJyZWFrOworCWNhc2UgSERNSV9QSUNUVVJFX0FTUEVDVF82NF8yNzoK
KwkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19QSUNfQVJfNjRfMjc7CisJCWJyZWFrOworCWNhc2Ug
SERNSV9QSUNUVVJFX0FTUEVDVF8yNTZfMTM1OgorCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX1BJ
Q19BUl8yNTZfMTM1OworCQlicmVhazsKKwlkZWZhdWx0OgorCQlmbGFncyB8PSBEUk1fTU9ERV9G
TEFHX1BJQ19BUl9OT05FOworCQlicmVhazsKKwl9CisKKwlkc3QtPmNsb2NrID0gY3B1X3RvX2xl
MzIoc3JjLT5jbG9jayk7CisJZHN0LT5oZGlzcGxheSA9IGNwdV90b19sZTE2KHNyYy0+aGRpc3Bs
YXkpOworCWRzdC0+aHN5bmNfc3RhcnQgPSBjcHVfdG9fbGUxNihzcmMtPmhzeW5jX3N0YXJ0KTsK
Kwlkc3QtPmhzeW5jX2VuZCA9IGNwdV90b19sZTE2KHNyYy0+aHN5bmNfZW5kKTsKKwlkc3QtPmh0
b3RhbCA9IGNwdV90b19sZTE2KHNyYy0+aHRvdGFsKTsKKwlkc3QtPmhza2V3ID0gY3B1X3RvX2xl
MTYoc3JjLT5oc2tldyk7CisJZHN0LT52ZGlzcGxheSA9IGNwdV90b19sZTE2KHNyYy0+dmRpc3Bs
YXkpOworCWRzdC0+dnN5bmNfc3RhcnQgPSBjcHVfdG9fbGUxNihzcmMtPnZzeW5jX3N0YXJ0KTsK
Kwlkc3QtPnZzeW5jX2VuZCA9IGNwdV90b19sZTE2KHNyYy0+dnN5bmNfZW5kKTsKKwlkc3QtPnZ0
b3RhbCA9IGNwdV90b19sZTE2KHNyYy0+dnRvdGFsKTsKKwlkc3QtPnZzY2FuID0gY3B1X3RvX2xl
MTYoc3JjLT52c2Nhbik7CisJZHN0LT52cmVmcmVzaCA9IGNwdV90b19sZTMyKHNyYy0+dnJlZnJl
c2gpOworCWRzdC0+ZmxhZ3MgPSBjcHVfdG9fbGUzMihmbGFncyk7CisJZHN0LT50eXBlID0gc3Jj
LT50eXBlOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZ3VkX2RybV90b19kaXNwbGF5X21vZGUo
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRzdCwKKwkJCQkJICAgY29uc3Qgc3RydWN0IGd1ZF9k
cm1fZGlzcGxheV9tb2RlICpzcmMpCit7CisJdTMyIGZsYWdzID0gbGUzMl90b19jcHUoc3JjLT5m
bGFncyk7CisKKwlkc3QtPmNsb2NrID0gbGUzMl90b19jcHUoc3JjLT5jbG9jayk7CisJZHN0LT5o
ZGlzcGxheSA9IGxlMTZfdG9fY3B1KHNyYy0+aGRpc3BsYXkpOworCWRzdC0+aHN5bmNfc3RhcnQg
PSBsZTE2X3RvX2NwdShzcmMtPmhzeW5jX3N0YXJ0KTsKKwlkc3QtPmhzeW5jX2VuZCA9IGxlMTZf
dG9fY3B1KHNyYy0+aHN5bmNfZW5kKTsKKwlkc3QtPmh0b3RhbCA9IGxlMTZfdG9fY3B1KHNyYy0+
aHRvdGFsKTsKKwlkc3QtPmhza2V3ID0gbGUxNl90b19jcHUoc3JjLT5oc2tldyk7CisJZHN0LT52
ZGlzcGxheSA9IGxlMTZfdG9fY3B1KHNyYy0+dmRpc3BsYXkpOworCWRzdC0+dnN5bmNfc3RhcnQg
PSBsZTE2X3RvX2NwdShzcmMtPnZzeW5jX3N0YXJ0KTsKKwlkc3QtPnZzeW5jX2VuZCA9IGxlMTZf
dG9fY3B1KHNyYy0+dnN5bmNfZW5kKTsKKwlkc3QtPnZ0b3RhbCA9IGxlMTZfdG9fY3B1KHNyYy0+
dnRvdGFsKTsKKwlkc3QtPnZzY2FuID0gbGUxNl90b19jcHUoc3JjLT52c2Nhbik7CisJZHN0LT52
cmVmcmVzaCA9IGxlMzJfdG9fY3B1KHNyYy0+dnJlZnJlc2gpOworCWRzdC0+ZmxhZ3MgPSBmbGFn
cyAmIH5EUk1fTU9ERV9GTEFHX1BJQ19BUl9NQVNLOworCWRzdC0+dHlwZSA9IHNyYy0+dHlwZTsK
KworCXN3aXRjaCAoZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX1BJQ19BUl9NQVNLKSB7CisJY2FzZSBE
Uk1fTU9ERV9GTEFHX1BJQ19BUl80XzM6CisJCWRzdC0+cGljdHVyZV9hc3BlY3RfcmF0aW8gPSBI
RE1JX1BJQ1RVUkVfQVNQRUNUXzRfMzsKKwkJYnJlYWs7CisJY2FzZSBEUk1fTU9ERV9GTEFHX1BJ
Q19BUl8xNl85OgorCQlkc3QtPnBpY3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNUVVJFX0FT
UEVDVF8xNl85OworCQlicmVhazsKKwljYXNlIERSTV9NT0RFX0ZMQUdfUElDX0FSXzY0XzI3Ogor
CQlkc3QtPnBpY3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNUVVJFX0FTUEVDVF82NF8yNzsK
KwkJYnJlYWs7CisJY2FzZSBEUk1fTU9ERV9GTEFHX1BJQ19BUl8yNTZfMTM1OgorCQlkc3QtPnBp
Y3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNUVVJFX0FTUEVDVF8yNTZfMTM1OworCQlicmVh
azsKKwlkZWZhdWx0OgorCQlkc3QtPnBpY3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNUVVJF
X0FTUEVDVF9OT05FOworCQlicmVhazsKKwl9CisKKwlkcm1fbW9kZV9zZXRfbmFtZShkc3QpOwor
fQorCisjZW5kaWYKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVsCg==
