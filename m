Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2DF4551BAA
	for <lists+dri-devel@lfdr.de>; Mon, 24 Jun 2019 21:49:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A861C89A61;
	Mon, 24 Jun 2019 19:49:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x542.google.com (mail-pg1-x542.google.com
 [IPv6:2607:f8b0:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EBEA889A14
 for <dri-devel@lists.freedesktop.org>; Mon, 24 Jun 2019 19:49:22 +0000 (UTC)
Received: by mail-pg1-x542.google.com with SMTP id f21so7677582pgi.3
 for <dri-devel@lists.freedesktop.org>; Mon, 24 Jun 2019 12:49:22 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=u/zFUO3yMoIyZsB9cMbMvZRrcD9xaq1bDUjQQ/exCxE=;
 b=MgiVj0baCk5QofRKi8MVKKxaRgkolSFs2okMrbl1g97wKAj7aKTX8GUEOMr2KkC90t
 EmLDCCRHJrCYzx7OjTrM4fNnHOrmvgdreBQUdQL4Xq1eycQRmRrVZ/mM+v9pmtXNh5vU
 cvr6HPQWkeqrdj4oEiGZY/q5Yp5amtP7eSlYVG7hg/KwwXDyjF3zP113pgOZjIlXrLcS
 0iKwwSlLE0xjsOQPY9YmQoZODGQ1/3YRm0e97Sngrqr0ORGvYb/WuSulNqD97nA5gGYZ
 xiip9D1XsDH8uXA+gaKYWaZojXZlm+7bEWczHrp2sgjhIu+MfCIWoHpTfmW1RYWCJ6ft
 FGQQ==
X-Gm-Message-State: APjAAAXjnyGYuEvZipl4B+BOPDJLfafl3qqn2pzmDlBaNGOjohrVhX0W
 9xUT6h/dxM2kej6lGi61F5rhow==
X-Google-Smtp-Source: APXvYqycDhB2rQp54g7Rc7xbJaAx5qPGV38UCten+IbY5pFy1HfClabiTmWOO99TuWZUa+g7Au/UiA==
X-Received: by 2002:a17:90a:8c06:: with SMTP id
 a6mr27486142pjo.45.1561405762232; 
 Mon, 24 Jun 2019 12:49:22 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 v3sm7957031pfm.188.2019.06.24.12.49.20
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Mon, 24 Jun 2019 12:49:21 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v6 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Mon, 24 Jun 2019 19:49:07 +0000
Message-Id: <20190624194908.121273-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190624194908.121273-1-john.stultz@linaro.org>
References: <20190624194908.121273-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=u/zFUO3yMoIyZsB9cMbMvZRrcD9xaq1bDUjQQ/exCxE=;
 b=jUxO4kdUYOs9pshrX+Xan74VySeFQJHDIl+iphGX9Z4AxgeKYs5JJzAHWoc9uHajaL
 eppVw06SwQ/zRYUha9mPNufPm2QrqOeJ7E53VzhaFmm7e9NN2Tt0D8yJ/B0SAREoQMpG
 XAImkg1b9BUVu4/U8vKwFLvQw6Uf6RnvfpLKI2yYxGV+yGGnYO8Thqf35mWLhEVkl6bV
 7dUkJr4oRjqKdD+cDglUowD6nQoVI7c1PNQikNjo1U1Jo7AuZM3lmW9g5pMobvl4budm
 Ew/sv5yLARmJmr+yll9NsMxMjZhxeIQeXkKX08G2XBIDhkZ50uxFjL5Auh8pKARz1z13
 erhA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Yudongbin <yudongbin@hisilicon.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Xu YiPing <xuyiping@hisilicon.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>,
 "Chenfeng \(puck\)" <puck.chen@hisilicon.com>, dri-devel@lists.freedesktop.org,
 Chenbo Feng <fengc@google.com>, Alistair Strachan <astrachan@google.com>,
 Liam Mark <lmark@codeaurora.org>, Christoph Hellwig <hch@infradead.org>,
 "Xiaqing \(A\)" <saberlily.xia@hisilicon.com>, "Andrew F . Davis" <afd@ti.com>,
 Pratik Patel <pratikp@codeaurora.org>, butao <butao@hisilicon.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKQ2M6IExhdXJhIEFiYm90
dCA8bGFiYm90dEByZWRoYXQuY29tPgpDYzogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdh
aWduYXJkQGxpbmFyby5vcmc+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8u
b3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IFByYXRpayBQYXRl
bCA8cHJhdGlrcEBjb2RlYXVyb3JhLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IFZpbmNlbnQgRG9ubmVmb3J0IDxWaW5jZW50LkRvbm5lZm9ydEBhcm0u
Y29tPgpDYzogU3VkaXB0byBQYXVsIDxTdWRpcHRvLlBhdWxAYXJtLmNvbT4KQ2M6IEFuZHJldyBG
LiBEYXZpcyA8YWZkQHRpLmNvbT4KQ2M6IFh1IFlpUGluZyA8eHV5aXBpbmdAaGlzaWxpY29uLmNv
bT4KQ2M6ICJDaGVuZmVuZyAocHVjaykiIDxwdWNrLmNoZW5AaGlzaWxpY29uLmNvbT4KQ2M6IGJ1
dGFvIDxidXRhb0BoaXNpbGljb24uY29tPgpDYzogIlhpYXFpbmcgKEEpIiA8c2FiZXJsaWx5Lnhp
YUBoaXNpbGljb24uY29tPgpDYzogWXVkb25nYmluIDx5dWRvbmdiaW5AaGlzaWxpY29uLmNvbT4K
Q2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFkLm9yZz4KQ2M6IENoZW5ibyBGZW5n
IDxmZW5nY0Bnb29nbGUuY29tPgpDYzogQWxpc3RhaXIgU3RyYWNoYW4gPGFzdHJhY2hhbkBnb29n
bGUuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpSZXZpZXdlZC1ieTog
QmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdhaWduYXJkQGxpbmFyby5vcmc+ClNpZ25lZC1v
ZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgpDaGFuZ2UtSWQ6IElj
MmIwYzVkZmMwZGJhZmY1MjQ1YmQxYzUwMTcwYzY0YjA2YzczMDUxCi0tLQp2MjoKKiBTd2l0Y2gg
YWxsb2NhdGUgdG8gcmV0dXJuIGRtYWJ1ZiBmZAoqIFNpbXBsaWZ5IGluaXQgY29kZQoqIENoZWNr
cGF0Y2ggZml4dXBzCnYzOgoqIFN3aXRjaCB0byBpbmxpbmUgZnVuY3Rpb24gZm9yIHRvX2NtYV9o
ZWFwKCkKKiBNaW5vciBjbGVhbnVwcyBzdWdnZXN0ZWQgYnkgQnJpYW4KKiBGb2xkIGluIG5ldyBy
ZWdpc3RyYXRpb24gc3R5bGUgZnJvbSBBbmRyZXcKKiBGb2xkZWQgaW4gY2hhbmdlcyBmcm9tIEFu
ZHJldyB0byB1c2Ugc2ltcGxpZmllZCBwYWdlIGxpc3QKICBmcm9tIHRoZSBoZWFwIGhlbHBlcnMK
djQ6CiogVXNlIHRoZSBmZF9mbGFncyB3aGVuIGNyZWF0aW5nIGRtYWJ1ZiBmZCAoU3VnZ2VzdGVk
IGJ5CiAgQmVuamFtaW4pCiogVXNlIHByZWNhbGN1bGF0ZWQgcGFnZWNvdW50IChTdWdnZXN0ZWQg
YnkgQW5kcmV3KQp2NjoKKiBDaGFuZ2VkIHZhcmlhYmxlIG5hbWVzIHRvIGltcHJvdmUgY2xhcml0
eSwgYXMgc3VnZ2VzdGVkCiAgYnkgQnJpYW4KLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvS2Nv
bmZpZyAgICB8ICAgOCArKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlICAgfCAgIDEg
KwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMgfCAxNjkgKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFuZ2VkLCAxNzggaW5zZXJ0aW9ucygrKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcgYi9kcml2ZXJzL2RtYS1idWYvaGVh
cHMvS2NvbmZpZwppbmRleCAyMDUwNTI3NDQxNjkuLmE1ZWVmMDZjNDIyNiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBz
L0tjb25maWcKQEAgLTQsMyArNCwxMSBAQCBjb25maWcgRE1BQlVGX0hFQVBTX1NZU1RFTQogCWhl
bHAKIAkgIENob29zZSB0aGlzIG9wdGlvbiB0byBlbmFibGUgdGhlIHN5c3RlbSBkbWFidWYgaGVh
cC4gVGhlIHN5c3RlbSBoZWFwCiAJICBpcyBiYWNrZWQgYnkgcGFnZXMgZnJvbSB0aGUgYnVkZHkg
YWxsb2NhdG9yLiBJZiBpbiBkb3VidCwgc2F5IFkuCisKK2NvbmZpZyBETUFCVUZfSEVBUFNfQ01B
CisJYm9vbCAiRE1BLUJVRiBDTUEgSGVhcCIKKwlkZXBlbmRzIG9uIERNQUJVRl9IRUFQUyAmJiBE
TUFfQ01BCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSBkbWEtYnVmIENN
QSBoZWFwLiBUaGlzIGhlYXAgaXMgYmFja2VkCisJICBieSB0aGUgQ29udGlndW91cyBNZW1vcnkg
QWxsb2NhdG9yIChDTUEpLiBJZiB5b3VyIHN5c3RlbSBoYXMgdGhlc2UKKwkgIHJlZ2lvbnMsIHlv
dSBzaG91bGQgc2F5IFkgaGVyZS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9N
YWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQppbmRleCBkMTgwOGVjYTI1
ODEuLjZlNTRjZGVjM2RhMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2Vm
aWxlCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMSwzICsxLDQgQEAK
ICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKIG9iai15CQkJCQkrPSBoZWFwLWhl
bHBlcnMubwogb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQU19TWVNURU0pCSs9IHN5c3RlbV9oZWFw
Lm8KK29iai0kKENPTkZJR19ETUFCVUZfSEVBUFNfQ01BKQkJKz0gY21hX2hlYXAubwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMgYi9kcml2ZXJzL2RtYS1idWYv
aGVhcHMvY21hX2hlYXAuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
LmQyYjEwODc4YjYwYgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9j
bWFfaGVhcC5jCkBAIC0wLDAgKzEsMTY5IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMAorLyoKKyAqIERNQUJVRiBDTUEgaGVhcCBleHBvcnRlcgorICoKKyAqIENvcHlyaWdo
dCAoQykgMjAxMiwgMjAxOSBMaW5hcm8gTHRkLgorICogQXV0aG9yOiA8YmVuamFtaW4uZ2FpZ25h
cmRAbGluYXJvLm9yZz4gZm9yIFNULUVyaWNzc29uLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9k
ZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvZG1h
LWhlYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisjaW5jbHVkZSA8bGludXgvZXJybm8u
aD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9jbWEuaD4KKyNpbmNs
dWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L2hpZ2htZW0uaD4KKwor
I2luY2x1ZGUgImhlYXAtaGVscGVycy5oIgorCitzdHJ1Y3QgY21hX2hlYXAgeworCXN0cnVjdCBk
bWFfaGVhcCAqaGVhcDsKKwlzdHJ1Y3QgY21hICpjbWE7Cit9OworCitzdGF0aWMgdm9pZCBjbWFf
aGVhcF9mcmVlKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwlzdHJ1Y3Qg
Y21hX2hlYXAgKmNtYV9oZWFwID0gZG1hX2hlYXBfZ2V0X2RhdGEoYnVmZmVyLT5oZWFwX2J1ZmZl
ci5oZWFwKTsKKwl1bnNpZ25lZCBsb25nIG5yX3BhZ2VzID0gYnVmZmVyLT5wYWdlY291bnQ7CisJ
c3RydWN0IHBhZ2UgKmNtYV9wYWdlcyA9IGJ1ZmZlci0+cHJpdl92aXJ0OworCisJLyogZnJlZSBw
YWdlIGxpc3QgKi8KKwlrZnJlZShidWZmZXItPnBhZ2VzKTsKKwkvKiByZWxlYXNlIG1lbW9yeSAq
LworCWNtYV9yZWxlYXNlKGNtYV9oZWFwLT5jbWEsIGNtYV9wYWdlcywgbnJfcGFnZXMpOworCWtm
cmVlKGJ1ZmZlcik7Cit9CisKKy8qIGRtYWJ1ZiBoZWFwIENNQSBvcGVyYXRpb25zIGZ1bmN0aW9u
cyAqLworc3RhdGljIGludCBjbWFfaGVhcF9hbGxvY2F0ZShzdHJ1Y3QgZG1hX2hlYXAgKmhlYXAs
CisJCQkJdW5zaWduZWQgbG9uZyBsZW4sCisJCQkJdW5zaWduZWQgbG9uZyBmZF9mbGFncywKKwkJ
CQl1bnNpZ25lZCBsb25nIGhlYXBfZmxhZ3MpCit7CisJc3RydWN0IGNtYV9oZWFwICpjbWFfaGVh
cCA9IGRtYV9oZWFwX2dldF9kYXRhKGhlYXApOworCXN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIg
KmhlbHBlcl9idWZmZXI7CisJc3RydWN0IHBhZ2UgKmNtYV9wYWdlczsKKwlzaXplX3Qgc2l6ZSA9
IFBBR0VfQUxJR04obGVuKTsKKwl1bnNpZ25lZCBsb25nIG5yX3BhZ2VzID0gc2l6ZSA+PiBQQUdF
X1NISUZUOworCXVuc2lnbmVkIGxvbmcgYWxpZ24gPSBnZXRfb3JkZXIoc2l6ZSk7CisJREVGSU5F
X0RNQV9CVUZfRVhQT1JUX0lORk8oZXhwX2luZm8pOworCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7
CisJaW50IHJldCA9IC1FTk9NRU07CisJcGdvZmZfdCBwZzsKKworCWlmIChhbGlnbiA+IENPTkZJ
R19DTUFfQUxJR05NRU5UKQorCQlhbGlnbiA9IENPTkZJR19DTUFfQUxJR05NRU5UOworCisJaGVs
cGVyX2J1ZmZlciA9IGt6YWxsb2Moc2l6ZW9mKCpoZWxwZXJfYnVmZmVyKSwgR0ZQX0tFUk5FTCk7
CisJaWYgKCFoZWxwZXJfYnVmZmVyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCUlOSVRfSEVBUF9I
RUxQRVJfQlVGRkVSKGhlbHBlcl9idWZmZXIsIGNtYV9oZWFwX2ZyZWUpOworCWhlbHBlcl9idWZm
ZXItPmhlYXBfYnVmZmVyLmZsYWdzID0gaGVhcF9mbGFnczsKKwloZWxwZXJfYnVmZmVyLT5oZWFw
X2J1ZmZlci5oZWFwID0gaGVhcDsKKwloZWxwZXJfYnVmZmVyLT5oZWFwX2J1ZmZlci5zaXplID0g
bGVuOworCisJY21hX3BhZ2VzID0gY21hX2FsbG9jKGNtYV9oZWFwLT5jbWEsIG5yX3BhZ2VzLCBh
bGlnbiwgZmFsc2UpOworCWlmICghY21hX3BhZ2VzKQorCQlnb3RvIGZyZWVfYnVmOworCisJaWYg
KFBhZ2VIaWdoTWVtKGNtYV9wYWdlcykpIHsKKwkJdW5zaWduZWQgbG9uZyBucl9jbGVhcl9wYWdl
cyA9IG5yX3BhZ2VzOworCQlzdHJ1Y3QgcGFnZSAqcGFnZSA9IGNtYV9wYWdlczsKKworCQl3aGls
ZSAobnJfY2xlYXJfcGFnZXMgPiAwKSB7CisJCQl2b2lkICp2YWRkciA9IGttYXBfYXRvbWljKHBh
Z2UpOworCisJCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CisJCQlrdW5tYXBfYXRvbWlj
KHZhZGRyKTsKKwkJCXBhZ2UrKzsKKwkJCW5yX2NsZWFyX3BhZ2VzLS07CisJCX0KKwl9IGVsc2Ug
eworCQltZW1zZXQocGFnZV9hZGRyZXNzKGNtYV9wYWdlcyksIDAsIHNpemUpOworCX0KKworCWhl
bHBlcl9idWZmZXItPnBhZ2Vjb3VudCA9IG5yX3BhZ2VzOworCWhlbHBlcl9idWZmZXItPnBhZ2Vz
ID0ga21hbGxvY19hcnJheShoZWxwZXJfYnVmZmVyLT5wYWdlY291bnQsCisJCQkJCSAgICAgc2l6
ZW9mKCpoZWxwZXJfYnVmZmVyLT5wYWdlcyksCisJCQkJCSAgICAgR0ZQX0tFUk5FTCk7CisJaWYg
KCFoZWxwZXJfYnVmZmVyLT5wYWdlcykgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGZyZWVf
Y21hOworCX0KKworCWZvciAocGcgPSAwOyBwZyA8IGhlbHBlcl9idWZmZXItPnBhZ2Vjb3VudDsg
cGcrKykgeworCQloZWxwZXJfYnVmZmVyLT5wYWdlc1twZ10gPSAmY21hX3BhZ2VzW3BnXTsKKwkJ
aWYgKCFoZWxwZXJfYnVmZmVyLT5wYWdlc1twZ10pCisJCQlnb3RvIGZyZWVfcGFnZXM7CisJfQor
CisJLyogY3JlYXRlIHRoZSBkbWFidWYgKi8KKwlleHBfaW5mby5vcHMgPSAmaGVhcF9oZWxwZXJf
b3BzOworCWV4cF9pbmZvLnNpemUgPSBsZW47CisJZXhwX2luZm8uZmxhZ3MgPSBmZF9mbGFnczsK
KwlleHBfaW5mby5wcml2ID0gJmhlbHBlcl9idWZmZXItPmhlYXBfYnVmZmVyOworCWRtYWJ1ZiA9
IGRtYV9idWZfZXhwb3J0KCZleHBfaW5mbyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJl
dCA9IFBUUl9FUlIoZG1hYnVmKTsKKwkJZ290byBmcmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9i
dWZmZXItPmhlYXBfYnVmZmVyLmRtYWJ1ZiA9IGRtYWJ1ZjsKKwloZWxwZXJfYnVmZmVyLT5wcml2
X3ZpcnQgPSBjbWFfcGFnZXM7CisKKwlyZXQgPSBkbWFfYnVmX2ZkKGRtYWJ1ZiwgZmRfZmxhZ3Mp
OworCWlmIChyZXQgPCAwKSB7CisJCWRtYV9idWZfcHV0KGRtYWJ1Zik7CisJCS8qIGp1c3QgcmV0
dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJlbGVhc2UgYW5kIHRoYXQgd2lsbCBmcmVlICovCisJCXJl
dHVybiByZXQ7CisJfQorCisJcmV0dXJuIHJldDsKKworZnJlZV9wYWdlczoKKwlrZnJlZShoZWxw
ZXJfYnVmZmVyLT5wYWdlcyk7CitmcmVlX2NtYToKKwljbWFfcmVsZWFzZShjbWFfaGVhcC0+Y21h
LCBjbWFfcGFnZXMsIG5yX3BhZ2VzKTsKK2ZyZWVfYnVmOgorCWtmcmVlKGhlbHBlcl9idWZmZXIp
OworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNtYV9oZWFw
X29wcyA9IHsKKwkuYWxsb2NhdGUgPSBjbWFfaGVhcF9hbGxvY2F0ZSwKK307CisKK3N0YXRpYyBp
bnQgX19hZGRfY21hX2hlYXAoc3RydWN0IGNtYSAqY21hLCB2b2lkICpkYXRhKQoreworCXN0cnVj
dCBjbWFfaGVhcCAqY21hX2hlYXA7CisJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9p
bmZvOworCisJY21hX2hlYXAgPSBremFsbG9jKHNpemVvZigqY21hX2hlYXApLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIWNtYV9oZWFwKQorCQlyZXR1cm4gLUVOT01FTTsKKwljbWFfaGVhcC0+Y21hID0g
Y21hOworCisJZXhwX2luZm8ubmFtZSA9IGNtYV9nZXRfbmFtZShjbWEpOworCWV4cF9pbmZvLm9w
cyA9ICZjbWFfaGVhcF9vcHM7CisJZXhwX2luZm8ucHJpdiA9IGNtYV9oZWFwOworCisJY21hX2hl
YXAtPmhlYXAgPSBkbWFfaGVhcF9hZGQoJmV4cF9pbmZvKTsKKwlpZiAoSVNfRVJSKGNtYV9oZWFw
LT5oZWFwKSkgeworCQlpbnQgcmV0ID0gUFRSX0VSUihjbWFfaGVhcC0+aGVhcCk7CisKKwkJa2Zy
ZWUoY21hX2hlYXApOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGFkZF9jbWFfaGVhcHModm9pZCkKK3sKKwljbWFfZm9yX2VhY2hfYXJlYShfX2FkZF9j
bWFfaGVhcCwgTlVMTCk7CisJcmV0dXJuIDA7Cit9CitkZXZpY2VfaW5pdGNhbGwoYWRkX2NtYV9o
ZWFwcyk7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
