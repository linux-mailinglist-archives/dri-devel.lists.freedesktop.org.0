Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D7530EE63F
	for <lists+dri-devel@lfdr.de>; Mon,  4 Nov 2019 18:39:54 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D08206E79A;
	Mon,  4 Nov 2019 17:39:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x442.google.com (mail-pf1-x442.google.com
 [IPv6:2607:f8b0:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 678896E79A
 for <dri-devel@lists.freedesktop.org>; Mon,  4 Nov 2019 17:39:51 +0000 (UTC)
Received: by mail-pf1-x442.google.com with SMTP id p26so12729230pfq.8
 for <dri-devel@lists.freedesktop.org>; Mon, 04 Nov 2019 09:39:51 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=tqUgfD6J26IDGcrOaE5JALNx00ywjTuLlRjpqn3J8b8=;
 b=YQIoT4LiX9tVk/I8Pi0FVfcJewltkhHNw5QDUUjtCTIQ1E0u+DXPQskVU9RLcTfOV8
 Bul/xOQ6zT/6ALS8TeyellPTQEwc2I1SxabNCO/dhbp8WLoQ7W3lurV/U9dBtqQ2N8XN
 mJqIvl6kl1zK3bXoTmV9RlAh1kHDVe5cpApQ7m+CPGDs9p8/qfTfXDwxPQXxobSVIW3A
 KKrgtCGdmfMyte1qeJu9cKR9Gln9Xnafbey6+05e1UnzVERUP5y1eMz9mUMP89UqBZlm
 tnbDWqAly3rM6lt/FjmYZQt2Bqdn1l8zIZcf9xgQMwUWuqLfzwakxymVJgE8umFek28j
 GIcw==
X-Gm-Message-State: APjAAAUJCV+s0lVTL+LYWzU/pcl80oxH9sREto8oDnr5pcejb77WscyS
 5mHnI8idQQIhYg4emXamdp6nYAGTyuc=
X-Google-Smtp-Source: APXvYqy6AGU4waE66mHIwcbc+qrL64JP3OkuPlxqz88KmxLF1+NAbjyWx1AraIIAjcF+WIJ3QQNayA==
X-Received: by 2002:a63:151:: with SMTP id 78mr28973075pgb.95.1572889190458;
 Mon, 04 Nov 2019 09:39:50 -0800 (PST)
Received: from localhost ([100.118.89.215])
 by smtp.gmail.com with ESMTPSA id y24sm20894808pfr.116.2019.11.04.09.39.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 04 Nov 2019 09:39:49 -0800 (PST)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/2 v2] drm/atomic: fix self-refresh helpers crtc state
 dereference
Date: Mon,  4 Nov 2019 09:37:36 -0800
Message-Id: <20191104173737.142558-1-robdclark@gmail.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=tqUgfD6J26IDGcrOaE5JALNx00ywjTuLlRjpqn3J8b8=;
 b=soRjtNEeL4D7NTU6MKSNZmvW/YQMSUw4MivNuB+vacYLS9phcwkMDXoTsEql77XHMK
 ku3/NC4+8vQatzqIQidHSwCdiPcYqozapjH2k6snddsCLVAM4EhHqRYgV4cDlm9664Ap
 Mvby3qtJWHW9IsLS2LYYzqtNeegALeNPAfQNnrjsgmioA7CFQbkykCwD47aHseaRbGZU
 0PkS7bjg7l/Y21Ia3E3pGc8zzNyKcBP0AnV3uB0lNXC5TIto5n2SmdgKubVXEShe/Hes
 wJ/5Cpv0Bkrpq7Bnm/WcGgz4W5MKZOk7vl3Fo8cLtOtPh/xO1HSYX9xIQHikkfAGl3go
 1Zxg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Rob Clark <robdclark@chromium.org>, David Airlie <airlied@linux.ie>,
 open list <linux-kernel@vger.kernel.org>, Sean Paul <seanpaul@chromium.org>,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKZHJtX3NlbGZfcmVmcmVz
aF9oZWxwZXJfdXBkYXRlX2F2Z190aW1lcygpIHdhcyBpbmNvcnJlY3RseSBhY2Nlc3NpbmcgdGhl
Cm5ldyBpbmNvbWluZyBzdGF0ZSBhZnRlciBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfaHdfZG9u
ZSgpLiAgQnV0IHRoaXMKc3RhdGUgbWlnaHQgaGF2ZSBhbHJlYWR5IGJlZW4gc3VwZXJjZWVkZWQg
YnkgYW4gIW5vbmJsb2NrIGF0b21pYyB1cGRhdGUKcmVzdWx0aW5nIGluIGRlcmVmZXJlbmNpbmcg
YW4gYWxyZWFkeSBmcmVlJ2QgY3J0Y19zdGF0ZS4KClRPRE8gSSAqdGhpbmsqIHRoaXMgd2lsbCBt
b3JlIG9yIGxlc3MgZG8gdGhlIHJpZ2h0IHRoaW5nLi4gYWx0aG91Z2h0IEknbQpub3QgMTAwJSBz
dXJlIGlmLCBmb3IgZXhhbXBsZSwgd2UgZW50ZXIgcHNyIGluIGEgbm9uYmxvY2sgY29tbWl0LCBh
bmQKdGhlbiBsZWF2ZSBwc3IgaW4gYSAhbm9uYmxvY2sgY29tbWl0IHRoYXQgb3ZlcnRha2VzIHRo
ZSBjb21wbGV0aW9uIG9mCnRoZSBub25ibG9jayBjb21taXQuICBOb3Qgc3VyZSBpZiB0aGlzIHNv
cnQgb2Ygc2NlbmFyaW8gY2FuIGhhcHBlbiBpbgpwcmFjdGljZS4gIEJ1dCBub3QgY3Jhc2hpbmcg
aXMgYmV0dGVyIHRoYW4gY3Jhc2hpbmcsIHNvIEkgZ3Vlc3Mgd2UKc2hvdWxkIGVpdGhlciB0YWtl
IHRoaXMgcGF0Y2ggb3IgcmV2ZXIgdGhlIHNlbGYtcmVmcmVzaCBoZWxwZXJzIHVudGlsClNlYW4g
Y2FuIGZpZ3VyZSBvdXQgYSBiZXR0ZXIgc29sdXRpb24uCgpGaXhlczogZDRkYTRlMzMzNDFjICgi
ZHJtOiBNZWFzdXJlIFNlbGYgUmVmcmVzaCBFbnRyeS9FeGl0IHRpbWVzIHRvIGF2b2lkIHRocmFz
aGluZyIpCkNjOiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4KU2lnbmVkLW9mZi1i
eTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9kcm1fYXRvbWljX2hlbHBlci5jICAgICAgIHwgMTQgKysrKysrKysrKysrKy0KIGRyaXZlcnMv
Z3B1L2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5jIHwgMTUgKysrKysrKysrLS0tLS0tCiBp
bmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oICAgICB8ICAzICsrLQogMyBmaWxl
cyBjaGFuZ2VkLCAyNCBpbnNlcnRpb25zKCspLCA4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9hdG9taWNfaGVscGVyLmMKaW5kZXggM2VmMmFjNTJjZTk0Li42NDg0OTRjODEzZTUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCkBAIC0xNTgxLDggKzE1ODEsMTEgQEAgc3RhdGlj
IHZvaWQgY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gb2xkX3N0YXRlLT5kZXY7CiAJY29uc3Qgc3RydWN0
IGRybV9tb2RlX2NvbmZpZ19oZWxwZXJfZnVuY3MgKmZ1bmNzOworCXN0cnVjdCBkcm1fY3J0Y19z
dGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0IGRybV9jcnRjICpjcnRjOwogCWt0aW1lX3Qg
c3RhcnQ7CiAJczY0IGNvbW1pdF90aW1lX21zOworCXVuc2lnbmVkIGksIG5ld19zZWxmX3JlZnJl
c2hfbWFzayA9IDA7CiAKIAlmdW5jcyA9IGRldi0+bW9kZV9jb25maWcuaGVscGVyX3ByaXZhdGU7
CiAKQEAgLTE2MDIsNiArMTYwNSwxNCBAQCBzdGF0aWMgdm9pZCBjb21taXRfdGFpbChzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCiAJZHJtX2F0b21pY19oZWxwZXJfd2FpdF9m
b3JfZGVwZW5kZW5jaWVzKG9sZF9zdGF0ZSk7CiAKKwkvKgorCSAqIFdlIGNhbm5vdCBzYWZlbHkg
YWNjZXNzIG5ld19jcnRjX3N0YXRlIGFmdGVyIGRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9od19k
b25lKCkKKwkgKiBzbyBmaWd1cmUgb3V0IHdoaWNoIGNydGMncyBoYXZlIHNlbGYtcmVmcmVzaCBh
Y3RpdmUgYmVmb3JlaGFuZDoKKwkgKi8KKwlmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0ZShvbGRf
c3RhdGUsIGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKQorCQlpZiAobmV3X2NydGNfc3RhdGUtPnNl
bGZfcmVmcmVzaF9hY3RpdmUpCisJCQluZXdfc2VsZl9yZWZyZXNoX21hc2sgfD0gQklUKGkpOwor
CiAJaWYgKGZ1bmNzICYmIGZ1bmNzLT5hdG9taWNfY29tbWl0X3RhaWwpCiAJCWZ1bmNzLT5hdG9t
aWNfY29tbWl0X3RhaWwob2xkX3N0YXRlKTsKIAllbHNlCkBAIC0xNjEwLDcgKzE2MjEsOCBAQCBz
dGF0aWMgdm9pZCBjb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRl
KQogCWNvbW1pdF90aW1lX21zID0ga3RpbWVfbXNfZGVsdGEoa3RpbWVfZ2V0KCksIHN0YXJ0KTsK
IAlpZiAoY29tbWl0X3RpbWVfbXMgPiAwKQogCQlkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl91cGRh
dGVfYXZnX3RpbWVzKG9sZF9zdGF0ZSwKLQkJCQkJCSAodW5zaWduZWQgbG9uZyljb21taXRfdGlt
ZV9tcyk7CisJCQkJCQkgKHVuc2lnbmVkIGxvbmcpY29tbWl0X3RpbWVfbXMsCisJCQkJCQkgbmV3
X3NlbGZfcmVmcmVzaF9tYXNrKTsKIAogCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9jbGVhbnVw
X2RvbmUob2xkX3N0YXRlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9zZWxm
X3JlZnJlc2hfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxw
ZXIuYwppbmRleCA2OGY0NzY1YTU4OTYuLjAxMWI4ZDVmN2RkNiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMKQEAgLTEzMyw2ICsxMzMsOCBAQCBzdGF0aWMgdm9p
ZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9lbnRyeV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAq
d29yaykKICAqIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX3VwZGF0ZV9hdmdfdGltZXMgLSBVcGRh
dGVzIGEgY3J0YydzIFNSIHRpbWUgYXZlcmFnZXMKICAqIEBzdGF0ZTogdGhlIHN0YXRlIHdoaWNo
IGhhcyBqdXN0IGJlZW4gYXBwbGllZCB0byBoYXJkd2FyZQogICogQGNvbW1pdF90aW1lX21zOiB0
aGUgYW1vdW50IG9mIHRpbWUgaW4gbXMgdGhhdCB0aGlzIGNvbW1pdCB0b29rIHRvIGNvbXBsZXRl
CisgKiBAbmV3X3NlbGZfcmVmcmVzaF9tYXNrOiBiaXRtYXNrIG9mIGNydGMncyB0aGF0IGhhdmUg
c2VsZl9yZWZyZXNoX2FjdGl2ZSBpbgorICogICAgbmV3IHN0YXRlCiAgKgogICogQ2FsbGVkIGFm
dGVyICZkcm1fbW9kZV9jb25maWdfZnVuY3MuYXRvbWljX2NvbW1pdF90YWlsLCB0aGlzIGZ1bmN0
aW9uIHdpbGwKICAqIHVwZGF0ZSB0aGUgYXZlcmFnZSBlbnRyeS9leGl0IHNlbGYgcmVmcmVzaCB0
aW1lcyBvbiBzZWxmIHJlZnJlc2ggdHJhbnNpdGlvbnMuCkBAIC0xNDAsMjIgKzE0MiwyMyBAQCBz
dGF0aWMgdm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9lbnRyeV93b3JrKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKICAqIGVudGVyaW5nIHNlbGYgcmVmcmVzaCBtb2RlIGFmdGVyIGFjdGl2
aXR5LgogICovCiB2b2lkIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX3VwZGF0ZV9hdmdfdGltZXMo
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkJCQkgICAgICB1bnNpZ25lZCBpbnQg
Y29tbWl0X3RpbWVfbXMpCisJCQkJCSAgICAgIHVuc2lnbmVkIGludCBjb21taXRfdGltZV9tcywK
KwkJCQkJICAgICAgdW5zaWduZWQgaW50IG5ld19zZWxmX3JlZnJlc2hfbWFzaykKIHsKIAlzdHJ1
Y3QgZHJtX2NydGMgKmNydGM7Ci0Jc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSwgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGU7CiAJaW50IGk7CiAKLQlmb3JfZWFjaF9vbGRuZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0
Yywgb2xkX2NydGNfc3RhdGUsCi0JCQkJICAgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKKwlmb3Jf
ZWFjaF9vbGRfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIGkpIHsK
KwkJYm9vbCBuZXdfc2VsZl9yZWZyZXNoX2FjdGl2ZSA9IG5ld19zZWxmX3JlZnJlc2hfbWFzayAm
IEJJVChpKTsKIAkJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3JfZGF0YSA9IGNydGMt
PnNlbGZfcmVmcmVzaF9kYXRhOwogCQlzdHJ1Y3QgZXdtYV9wc3JfdGltZSAqdGltZTsKIAogCQlp
ZiAob2xkX2NydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUgPT0KLQkJICAgIG5ld19jcnRj
X3N0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQkgICAgbmV3X3NlbGZfcmVmcmVzaF9hY3Rp
dmUpCiAJCQljb250aW51ZTsKIAotCQlpZiAobmV3X2NydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9h
Y3RpdmUpCisJCWlmIChuZXdfc2VsZl9yZWZyZXNoX2FjdGl2ZSkKIAkJCXRpbWUgPSAmc3JfZGF0
YS0+ZW50cnlfYXZnX21zOwogCQllbHNlCiAJCQl0aW1lID0gJnNyX2RhdGEtPmV4aXRfYXZnX21z
OwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaCBiL2lu
Y2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKaW5kZXggNWI3OWQyNTNmYjQ2Li5i
MmMwOGIzMjhhYTEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVs
cGVyLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaApAQCAtMTMs
NyArMTMsOCBAQCBzdHJ1Y3QgZHJtX2NydGM7CiAKIHZvaWQgZHJtX3NlbGZfcmVmcmVzaF9oZWxw
ZXJfYWx0ZXJfc3RhdGUoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIHZvaWQgZHJt
X3NlbGZfcmVmcmVzaF9oZWxwZXJfdXBkYXRlX2F2Z190aW1lcyhzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUsCi0JCQkJCSAgICAgIHVuc2lnbmVkIGludCBjb21taXRfdGltZV9tcyk7CisJ
CQkJCSAgICAgIHVuc2lnbmVkIGludCBjb21taXRfdGltZV9tcywKKwkJCQkJICAgICAgdW5zaWdu
ZWQgaW50IG5ld19zZWxmX3JlZnJlc2hfbWFzayk7CiAKIGludCBkcm1fc2VsZl9yZWZyZXNoX2hl
bHBlcl9pbml0KHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiB2b2lkIGRybV9zZWxmX3JlZnJlc2hf
aGVscGVyX2NsZWFudXAoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
