Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 53C8A49473
	for <lists+dri-devel@lfdr.de>; Mon, 17 Jun 2019 23:39:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C3B7C89FEC;
	Mon, 17 Jun 2019 21:39:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CB7C689FD9;
 Mon, 17 Jun 2019 21:39:12 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: koike) with ESMTPSA id 3987B260D9A
From: Helen Koike <helen.koike@collabora.com>
To: dri-devel@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH v9 1/2] drm/i915: Introduce async plane update to i915
Date: Mon, 17 Jun 2019 18:38:53 -0300
Message-Id: <20190617213854.32330-1-helen.koike@collabora.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: tfiga@chromium.org, mcasas@google.com, zhenyu.z.wang@intel.com,
 David Airlie <airlied@linux.ie>, daniel.vetter@ffwll.ch,
 linux-kernel@vger.kernel.org, tina.zhang@intel.com,
 Gustavo Padovan <gustavo.padovan@collabora.com>,
 Helen Koike <helen.koike@collabora.com>, Rodrigo Vivi <rodrigo.vivi@intel.com>,
 Enric Balletbo i Serra <enric.balletbo@collabora.com>, kernel@collabora.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogR3VzdGF2byBQYWRvdmFuIDxndXN0YXZvLnBhZG92YW5AY29sbGFib3JhLmNvbT4KCkFk
ZCBpbXBsZW1lbnRhdGlvbiBmb3IgYXN5bmMgcGxhbmUgdXBkYXRlIGNhbGxiYWNrcwoKU2lnbmVk
LW9mZi1ieTogR3VzdGF2byBQYWRvdmFuIDxndXN0YXZvLnBhZG92YW5AY29sbGFib3JhLmNvbT4K
U2lnbmVkLW9mZi1ieTogRW5yaWMgQmFsbGV0Ym8gaSBTZXJyYSA8ZW5yaWMuYmFsbGV0Ym9AY29s
bGFib3JhLmNvbT4KU2lnbmVkLW9mZi1ieTogVGluYSBaaGFuZyA8dGluYS56aGFuZ0BpbnRlbC5j
b20+ClNpZ25lZC1vZmYtYnk6IEhlbGVuIEtvaWtlIDxoZWxlbi5rb2lrZUBjb2xsYWJvcmEuY29t
PgpUZXN0ZWQtYnk6IFRpbmEgWmhhbmcgPHRpbmEuemhhbmdAaW50ZWwuY29tPgoKLS0tCkhpLAoK
SSB0ZXN0ZWQgdGhpcyBwYXRjaCBzZXQgd2l0aCBpZ3QgKGtzbV9jdXJzb3JfbGVnYWN5IGFuZCBw
bGFuZV9jdXJzb3JfbGVnYWN5KQphbmQgZm91bmQgbm8gcmVncmVzc2lvbnMuCgpUaGlzIHBhdGNo
IGRlcGVuZHMgb24gWzFdICJbUEFUQ0hdIGRybTogZG9uJ3QgYmxvY2sgZmIgY2hhbmdlcyBmb3Ig
YXN5bmMgcGxhbmUgdXBkYXRlcyIsCndoaWNoIGlzIGFscmVhZHkgb24gZHJtLW1pc2MsIG90aGVy
d2lzZSB0aGVyZSB3aWxsIGJlIGEgcmVncmVzc2lvbiBvbiBpZ3QgdGVzdHM6CgogICAgICAgIGN1
cnNvci12cy1mbGlwLWF0b21pYy10cmFuc2l0aW9ucy12YXJ5aW5nLXNpemUKICAgICAgICBjdXJz
b3ItdnMtZmxpcC10b2dnbGUKICAgICAgICBjdXJzb3ItdnMtZmxpcC12YXJ5aW5nLXNpemUKCndp
dGggZXJyb3JzIG9mIHR5cGU6CgoiQ1JJVElDQUw6IGNvbXBsZXRlZCA5NyBjdXJzb3IgdXBkYXRl
ZCBpbiBhIHBlcmlvZCBvZiAzMCBmbGlwcywgd2UKZXhwZWN0IHRvIGNvbXBsZXRlIGFwcHJveGlt
YXRlbHkgMTUzNjAgdXBkYXRlcywgd2l0aCB0aGUgdGhyZXNob2xkIHNldAphdCA3NjgwIgoKV2hl
biBwaWNraW5nIHRoaXMgcGF0Y2gsIHBsZWFzZSBiYWNrbWVyZ2UgWzFdIGludG8gZHJtLWludGVs
IHRyZWUuCgpbMV0gaHR0cHM6Ly9jZ2l0LmZyZWVkZXNrdG9wLm9yZy9kcm0vZHJtLW1pc2MvY29t
bWl0Lz9oPWRybS1taXNjLWZpeGVzJmlkPTg5YTRhYWMwYWIwZTZmNWVlYTEwZDdiZjQ4NjlkZDE1
YzNkZTJjZDQKClRoYW5rcwpIZWxlbgoKQ2hhbmdlcyBpbiB2OToKIC0gdjg6IGh0dHBzOi8vcGF0
Y2h3b3JrLmtlcm5lbC5vcmcvcGF0Y2gvMTA4NDMzOTUvCiAtIEFkZGVkIHRlc3RlZC1ieSB0YWcK
IC0gc3VibWl0dGVkIHRvICBpbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnIHRvIGludm9r
ZSBDSQogLSByZWJhc2VkIGFuZCBmaXhlZCBjb25mbGljdHMgb24gdG9wIG9mIGRybS10aXAKCkNo
YW5nZXMgaW4gdjg6CiAtIHY3OiBodHRwczovL2xrbWwub3JnL2xrbWwvMjAxOC82LzgvMTY4CiAt
IHY3IHdhcyBzcGxpdGVkIGluIHR3bywgb25lIHRoYXQgYWRkcyB0aGUgYXN5bmMgY2FsbGJhY2tz
IGFuZCBhbm90aGVyCiB0aGF0IHVwZGF0ZXMgdGhlIGN1cnNvci4KIC0gcmViYXNlIHdpdGggZHJt
LWludGVsCiAtIGFsbG93IGFzeW5jIHVwZGF0ZSBpbiBhbGwgdHlwZXMgb2YgcGxhbmVzLCBub3Qg
b25seSBjdXJzb3IKIC0gYWRkIHdhdGVybWFyayBjaGVja3MgaW4gYXN5bmMgdXBkYXRlCiAtIHJl
bW92ZSBieXBhc3Mgb2YgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYigpIGluIGNhc2Ugb2YgYXN5bmMg
dXBkYXRlCiAtIGFkZCBtaXNzaW5nIGRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKGRl
diwgc3RhdGUpIGNhbGwgaW4KIGludGVsX2F0b21pY19jb21taXQoKS4KIC0gdXNlIHN3YXAoKSBm
dW5jdGlvbiBpbiBhc3luYyB1cGRhdGUgdG8gc2V0IHRoZSBvbGRfZmIgaW4gdGhlCiBuZXdfc3Rh
dGUgb2JqZWN0LgogLSB1c2UgaGVscGVycyBpbnRlbF91cGRhdGVfcGxhbmUoKS9pbnRlbF9kaXNh
YmxlX3BsYW5lKCkKCkNoYW5nZXMgaW4gdjc6Ci0gUmViYXNlIG9uIHRvcCBvZiBkcm0taW50ZWwg
cmVwb3NpdG9yeS4gSG9wZWZ1bGx5IG5vdyB3aWxsIHBsYXkKICBuaWNlbHkgd2l0aCBhdXRvYnVp
bGRlcnMuCgpDaGFuZ2VzIGluIHY2OgotIFJld29yayB0aGUgaW50ZWxfcGxhbmVfYXRvbWljX2Fz
eW5jX3VwZGF0ZSBkdWUgZHJpdmVyIGNoYW5nZWQgZnJvbQogIGxhc3QgdGltZS4KLSBSZW1vdmVk
IHRoZSBtdXRleF9sb2NrL3VubG9jayBhcyBjYXVzZXMgYSBkZWFkbG9jay4KCkNoYW5nZXMgaW4g
djU6Ci0gQ2FsbCBkcm1fYXRvbWljX2hlbHBlcl9hc3luY19jaGVjaygpIGZyb20gdGhlIGNoZWNr
IGhvb2sKCkNoYW5nZXMgaW4gdjQ6Ci0gU2V0IGNvcnJlY3Qgdm1hIHRvIG5ldyBzdGF0ZSBmb3Ig
Y2xlYW51cAotIE1vdmUgc2l6ZSBjaGVja3MgYmFjayB0byBkcml2ZXJzIChWaWxsZSBTeXJqw6Rs
w6QpCgpDaGFuZ2VzIGluIHYzOgotIE1vdmUgZmIgc2V0dGluZyB0byBjb3JlIGFuZCB1c2UgbmV3
IHN0YXRlIChFcmljIEFuaG9sdCkKCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljX3BsYW5lLmMgfCA3MSArKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAgOSArKysKIDIgZmlsZXMgY2hhbmdlZCwgODAg
aW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2F0b21pY19wbGFuZS5jCmluZGV4IDMwYmQ0ZTc2ZmZmOS4uNTY4ODFhN2VjNDhlIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKQEAg
LTM0OCw4ICszNDgsNzkgQEAgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZXNfb25fY3J0YyhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAl9CiB9CiAKK3N0YXRpYyBpbnQgaW50ZWxfcGxh
bmVfYXRvbWljX2FzeW5jX2NoZWNrKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCQkgIHN0
cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZTsKKworCWNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9leGlzdGluZ19jcnRj
X3N0YXRlKHN0YXRlLT5zdGF0ZSwKKwkJCQkJCQlzdGF0ZS0+Y3J0Yyk7CisJaWYgKFdBUk5fT04o
IWNydGNfc3RhdGUpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCS8qCisJICogV2hlbiBjcnRjIGlz
IGluYWN0aXZlIG9yIHRoZXJlIGlzIGEgbW9kZXNldCBwZW5kaW5nLAorCSAqIHdhaXQgZm9yIGl0
IHRvIGNvbXBsZXRlIGluIHRoZSBzbG93cGF0aAorCSAqLworCWlmICghY3J0Y19zdGF0ZS0+YWN0
aXZlIHx8IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Y19zdGF0ZSktPnVwZGF0ZV9waXBlKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCS8qCisJICogSWYgYW55IHBhcmFtZXRlcnMgY2hhbmdlIHRoYXQg
bWF5IGFmZmVjdCB3YXRlcm1hcmtzLAorCSAqIHRha2UgdGhlIHNsb3dwYXRoLiBPbmx5IGNoYW5n
aW5nIGZiIG9yIHBvc2l0aW9uIHNob3VsZCBiZQorCSAqIGluIHRoZSBmYXN0cGF0aC4KKwkgKi8K
KwlpZiAocGxhbmUtPnN0YXRlLT5jcnRjICE9IHN0YXRlLT5jcnRjIHx8CisJICAgIHBsYW5lLT5z
dGF0ZS0+c3JjX3cgIT0gc3RhdGUtPnNyY193IHx8CisJICAgIHBsYW5lLT5zdGF0ZS0+c3JjX2gg
IT0gc3RhdGUtPnNyY19oIHx8CisJICAgIHBsYW5lLT5zdGF0ZS0+Y3J0Y193ICE9IHN0YXRlLT5j
cnRjX3cgfHwKKwkgICAgcGxhbmUtPnN0YXRlLT5jcnRjX2ggIT0gc3RhdGUtPmNydGNfaCB8fAor
CSAgICAhcGxhbmUtPnN0YXRlLT5mYiAhPSAhc3RhdGUtPmZiKQorCQlyZXR1cm4gLUVJTlZBTDsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9hdG9taWNfYXN5bmNf
dXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCQkgICAgc3RydWN0IGRybV9wbGFu
ZV9zdGF0ZSAqbmV3X3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVs
X25ld19zdGF0ZSA9CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdfc3RhdGUtPnN0YXRlKTsK
KwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmUp
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBsYW5lLT5zdGF0ZS0+Y3J0YzsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGM7CisJaW50IGk7CisKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShp
bnRlbF9uZXdfc3RhdGUsIGludGVsX2NydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkKKwkJ
V0FSTl9PTihuZXdfY3J0Y19zdGF0ZS0+d20ubmVlZF9wb3N0dmJsX3VwZGF0ZSB8fAorCQkJbmV3
X2NydGNfc3RhdGUtPnVwZGF0ZV93bV9wb3N0KTsKKworCWk5MTVfZ2VtX3RyYWNrX2ZiKGludGVs
X2ZiX29iaihwbGFuZS0+c3RhdGUtPmZiKSwKKwkJCSAgaW50ZWxfZmJfb2JqKG5ld19zdGF0ZS0+
ZmIpLAorCQkJICBpbnRlbF9wbGFuZS0+ZnJvbnRidWZmZXJfYml0KTsKKworCXBsYW5lLT5zdGF0
ZS0+c3JjX3ggPSBuZXdfc3RhdGUtPnNyY194OworCXBsYW5lLT5zdGF0ZS0+c3JjX3kgPSBuZXdf
c3RhdGUtPnNyY195OworCXBsYW5lLT5zdGF0ZS0+Y3J0Y194ID0gbmV3X3N0YXRlLT5jcnRjX3g7
CisJcGxhbmUtPnN0YXRlLT5jcnRjX3kgPSBuZXdfc3RhdGUtPmNydGNfeTsKKworCXN3YXAocGxh
bmUtPnN0YXRlLT5mYiwgbmV3X3N0YXRlLT5mYik7CisKKwlpZiAocGxhbmUtPnN0YXRlLT52aXNp
YmxlKQorCQlpbnRlbF91cGRhdGVfcGxhbmUoaW50ZWxfcGxhbmUsCisJCQkJICAgdG9faW50ZWxf
Y3J0Y19zdGF0ZShjcnRjLT5zdGF0ZSksCisJCQkJICAgdG9faW50ZWxfcGxhbmVfc3RhdGUocGxh
bmUtPnN0YXRlKSk7CisJZWxzZQorCQlpbnRlbF9kaXNhYmxlX3BsYW5lKGludGVsX3BsYW5lLAor
CQkJCSAgICB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPnN0YXRlKSk7Cit9CisKIGNvbnN0IHN0
cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzIGludGVsX3BsYW5lX2hlbHBlcl9mdW5jcyA9IHsK
IAkucHJlcGFyZV9mYiA9IGludGVsX3ByZXBhcmVfcGxhbmVfZmIsCiAJLmNsZWFudXBfZmIgPSBp
bnRlbF9jbGVhbnVwX3BsYW5lX2ZiLAogCS5hdG9taWNfY2hlY2sgPSBpbnRlbF9wbGFuZV9hdG9t
aWNfY2hlY2ssCisJLmF0b21pY19hc3luY19jaGVjayA9IGludGVsX3BsYW5lX2F0b21pY19hc3lu
Y19jaGVjaywKKwkuYXRvbWljX2FzeW5jX3VwZGF0ZSA9IGludGVsX3BsYW5lX2F0b21pY19hc3lu
Y191cGRhdGUsCiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYwppbmRleCA4ZDdlNGM4YjYwYmMuLmJmNTA1YjcwYTAzNyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0MDA3LDYgKzE0MDA3LDE1IEBA
IHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlpbnQg
cmV0ID0gMDsKIAorCWlmIChzdGF0ZS0+YXN5bmNfdXBkYXRlKSB7CisJCXJldCA9IGRybV9hdG9t
aWNfaGVscGVyX3ByZXBhcmVfcGxhbmVzKGRldiwgc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0
dXJuIHJldDsKKwkJZHJtX2F0b21pY19oZWxwZXJfYXN5bmNfY29tbWl0KGRldiwgc3RhdGUpOwor
CQlkcm1fYXRvbWljX2hlbHBlcl9jbGVhbnVwX3BsYW5lcyhkZXYsIHN0YXRlKTsKKwkJcmV0dXJu
IDA7CisJfQorCiAJaW50ZWxfc3RhdGUtPndha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgm
ZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCiAJZHJtX2F0b21pY19zdGF0ZV9nZXQoc3RhdGUpOwot
LSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
