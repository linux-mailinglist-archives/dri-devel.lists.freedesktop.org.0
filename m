Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 452356A51A
	for <lists+dri-devel@lfdr.de>; Tue, 16 Jul 2019 11:43:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2903D6E0F2;
	Tue, 16 Jul 2019 09:43:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x849.google.com (mail-qt1-x849.google.com
 [IPv6:2607:f8b0:4864:20::849])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 93A546E0F2
 for <dri-devel@lists.freedesktop.org>; Tue, 16 Jul 2019 09:43:16 +0000 (UTC)
Received: by mail-qt1-x849.google.com with SMTP id x7so17497683qtp.15
 for <dri-devel@lists.freedesktop.org>; Tue, 16 Jul 2019 02:43:16 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=bxnd7jbFgA5PnggDnLHj9AcSFdDAS1VVYbrZD5pqwCE=;
 b=snJ+AwGvGwbc/f7I8PxkrqcSfTS22zE9wF0RMc9cDdGTqMWTEovSqgI01RltnyKLrQ
 Qfodn/rrSrOp4TwuDZ+YoyJz0WREjGGSyRif5Zw+p42yviZxb+HanrLqHKBiuLVrxAJP
 Mqm6P2eo6D99B2gpkhssYVGsE8mht5xApzobUgqLe9ZbdBg9NvJNXzbSsMg5SkynQrja
 OgTm1XlEqGwbmSUQ6K3ClDrXSddXH4FZicVH14Uh433y2kUPrWjGpWGkSrV+wDfoL3JG
 JmlGI2/Sv90tI3cmo+DepV+TEt/firk104gtRQg3oO3GnUddW/1zkBFJ84wZ/pdDheMA
 bqTw==
X-Gm-Message-State: APjAAAX7cERD3Rcg39MSaR3MHGBjeKgeJHUApGX1YiisV5ai8KeMtFLO
 MBGE/kdnK+TceVLGuPB3uPVx+Ek5+kvRJvof9qjDOQ==
X-Google-Smtp-Source: APXvYqzEuJRlbRQ7IW0hg6RRwvHVYaBIiK/vw7kpA6ARu5LVwrxI93DEmRdKAZiTiYfrd3RJmN/8kyvHmjUkvfmRudR83Q==
X-Received: by 2002:a0c:af16:: with SMTP id i22mr23308479qvc.234.1563270195222; 
 Tue, 16 Jul 2019 02:43:15 -0700 (PDT)
Date: Tue, 16 Jul 2019 02:42:46 -0700
In-Reply-To: <20190716094302.180360-1-brendanhiggins@google.com>
Message-Id: <20190716094302.180360-3-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190716094302.180360-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.22.0.510.g264f2c817a-goog
Subject: [PATCH v10 02/18] kunit: test: add test resource management API
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, jpoimboe@redhat.com, 
 keescook@google.com, kieran.bingham@ideasonboard.com, mcgrof@kernel.org, 
 peterz@infradead.org, robh@kernel.org, sboyd@kernel.org, shuah@kernel.org, 
 tytso@mit.edu, yamada.masahiro@socionext.com
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=bxnd7jbFgA5PnggDnLHj9AcSFdDAS1VVYbrZD5pqwCE=;
 b=H95IVD0rpl+F9UHqu8nt4w+V0KLsNLZ0zvz5i5G3Swm53pe7TW9rjPbz+173afn/kB
 K49wPSYzr3npfIVWKFPw+ouPnF2g8HzKUi99LFMYsfD664dr+BorxzW24AaPaOLpPKSm
 6qCTahEHPiDEw+kwF1CMNMqvkN4Wi67edYwUk1uKn1MvmDU3+k5MnoTXsBQKrioHCA/c
 Fb7zuznFgw1BeeG3JcQAVBoEYKQdjpBF6QIsKk49E45sOdHjteM2E6FyXQGKApXyCODy
 TO2GIbZ6v6gxqYitgYnL+42AU2cGi0M2x12t+F7VXdxIK3IhUBhQYJMVE2ulziSeVSEo
 sorA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, kunit-dev@googlegroups.com,
 richard@nod.at, rdunlap@infradead.org, linux-kernel@vger.kernel.org,
 mpe@ellerman.id.au, linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIGEgY29tbW9uIEFQSSBmb3IgdGVzdCBtYW5hZ2VkIHJlc291cmNlcyBsaWtlIG1lbW9y
eSBhbmQgdGVzdApvYmplY3RzLiBBIGxvdCBvZiB0aW1lcyBhIHRlc3Qgd2lsbCB3YW50IHRvIHNl
dCB1cCBpbmZyYXN0cnVjdHVyZSB0byBiZQp1c2VkIGluIHRlc3QgY2FzZXM7IHRoaXMgY291bGQg
YmUgYW55dGhpbmcgZnJvbSBqdXN0IHdhbnRpbmcgdG8gYWxsb2NhdGUKc29tZSBtZW1vcnkgdG8g
c2V0dGluZyB1cCBhIGRyaXZlciBzdGFjazsgdGhpcyBkZWZpbmVzIGZhY2lsaXRpZXMgZm9yCmNy
ZWF0aW5nICJ0ZXN0IHJlc291cmNlcyIgd2hpY2ggYXJlIG1hbmFnZWQgYnkgdGhlIHRlc3QgaW5m
cmFzdHJ1Y3R1cmUKYW5kIGFyZSBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYXQgdGhlIGNvbmNs
dXNpb24gb2YgdGhlIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBCcmVuZGFuIEhpZ2dpbnMgPGJyZW5k
YW5oaWdnaW5zQGdvb2dsZS5jb20+ClJldmlld2VkLWJ5OiBHcmVnIEtyb2FoLUhhcnRtYW4gPGdy
ZWdraEBsaW51eGZvdW5kYXRpb24ub3JnPgpSZXZpZXdlZC1ieTogTG9nYW4gR3VudGhvcnBlIDxs
b2dhbmdAZGVsdGF0ZWUuY29tPgotLS0KIGluY2x1ZGUva3VuaXQvdGVzdC5oIHwgMTQzICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGt1bml0L3Rlc3QuYyAgICAg
ICAgIHwgIDkyICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwg
MjM1IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2t1bml0L3Rlc3QuaCBiL2lu
Y2x1ZGUva3VuaXQvdGVzdC5oCmluZGV4IGUwYjM0YWNiOWVlNGUuLjEyMTk2NzE5Y2Y4ZjQgMTAw
NjQ0Ci0tLSBhL2luY2x1ZGUva3VuaXQvdGVzdC5oCisrKyBiL2luY2x1ZGUva3VuaXQvdGVzdC5o
CkBAIC0xMCw2ICsxMCw3MCBAQAogI2RlZmluZSBfS1VOSVRfVEVTVF9ICiAKICNpbmNsdWRlIDxs
aW51eC90eXBlcy5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKworc3RydWN0IGt1bml0X3Jl
c291cmNlOworCit0eXBlZGVmIGludCAoKmt1bml0X3Jlc291cmNlX2luaXRfdCkoc3RydWN0IGt1
bml0X3Jlc291cmNlICosIHZvaWQgKik7Cit0eXBlZGVmIHZvaWQgKCprdW5pdF9yZXNvdXJjZV9m
cmVlX3QpKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqKTsKKworLyoqCisgKiBzdHJ1Y3Qga3VuaXRf
cmVzb3VyY2UgLSByZXByZXNlbnRzIGEgKnRlc3QgbWFuYWdlZCByZXNvdXJjZSoKKyAqIEBhbGxv
Y2F0aW9uOiBmb3IgdGhlIHVzZXIgdG8gc3RvcmUgYXJiaXRyYXJ5IGRhdGEuCisgKiBAZnJlZTog
YSB1c2VyIHN1cHBsaWVkIGZ1bmN0aW9uIHRvIGZyZWUgdGhlIHJlc291cmNlLiBQb3B1bGF0ZWQg
YnkKKyAqIGt1bml0X2FsbG9jX3Jlc291cmNlKCkuCisgKgorICogUmVwcmVzZW50cyBhICp0ZXN0
IG1hbmFnZWQgcmVzb3VyY2UqLCBhIHJlc291cmNlIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBi
ZQorICogY2xlYW5lZCB1cCBhdCB0aGUgZW5kIG9mIGEgdGVzdCBjYXNlLgorICoKKyAqIEV4YW1w
bGU6CisgKgorICogLi4gY29kZS1ibG9jazo6IGMKKyAqCisgKglzdHJ1Y3Qga3VuaXRfa21hbGxv
Y19wYXJhbXMgeworICoJCXNpemVfdCBzaXplOworICoJCWdmcF90IGdmcDsKKyAqCX07CisgKgor
ICoJc3RhdGljIGludCBrdW5pdF9rbWFsbG9jX2luaXQoc3RydWN0IGt1bml0X3Jlc291cmNlICpy
ZXMsIHZvaWQgKmNvbnRleHQpCisgKgl7CisgKgkJc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1z
ICpwYXJhbXMgPSBjb250ZXh0OworICoJCXJlcy0+YWxsb2NhdGlvbiA9IGttYWxsb2MocGFyYW1z
LT5zaXplLCBwYXJhbXMtPmdmcCk7CisgKgorICoJCWlmICghcmVzLT5hbGxvY2F0aW9uKQorICoJ
CQlyZXR1cm4gLUVOT01FTTsKKyAqCisgKgkJcmV0dXJuIDA7CisgKgl9CisgKgorICoJc3RhdGlj
IHZvaWQga3VuaXRfa21hbGxvY19mcmVlKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzKQorICoJ
eworICoJCWtmcmVlKHJlcy0+YWxsb2NhdGlvbik7CisgKgl9CisgKgorICoJdm9pZCAqa3VuaXRf
a21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNpemVfdCBzaXplLCBnZnBfdCBnZnApCisgKgl7
CisgKgkJc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHBhcmFtczsKKyAqCQlzdHJ1Y3Qga3Vu
aXRfcmVzb3VyY2UgKnJlczsKKyAqCisgKgkJcGFyYW1zLnNpemUgPSBzaXplOworICoJCXBhcmFt
cy5nZnAgPSBnZnA7CisgKgorICoJCXJlcyA9IGt1bml0X2FsbG9jX3Jlc291cmNlKHRlc3QsIGt1
bml0X2ttYWxsb2NfaW5pdCwKKyAqCQkJa3VuaXRfa21hbGxvY19mcmVlLCAmcGFyYW1zKTsKKyAq
CQlpZiAocmVzKQorICoJCQlyZXR1cm4gcmVzLT5hbGxvY2F0aW9uOworICoKKyAqCQlyZXR1cm4g
TlVMTDsKKyAqCX0KKyAqLworc3RydWN0IGt1bml0X3Jlc291cmNlIHsKKwl2b2lkICphbGxvY2F0
aW9uOworCWt1bml0X3Jlc291cmNlX2ZyZWVfdCBmcmVlOworCisJLyogcHJpdmF0ZTogaW50ZXJu
YWwgdXNlIG9ubHkuICovCisJc3RydWN0IGxpc3RfaGVhZCBub2RlOworfTsKIAogc3RydWN0IGt1
bml0OwogCkBAIC0xMDksNiArMTczLDEzIEBAIHN0cnVjdCBrdW5pdCB7CiAJICogaGF2ZSB0ZXJt
aW5hdGVkLgogCSAqLwogCWJvb2wgc3VjY2VzczsgLyogUmVhZCBvbmx5IGFmdGVyIHRlc3RfY2Fz
ZSBmaW5pc2hlcyEgKi8KKwlzcGlubG9ja190IGxvY2s7IC8qIEdhdXJkcyBhbGwgbXV0YWJsZSB0
ZXN0IHN0YXRlLiAqLworCS8qCisJICogQmVjYXVzZSByZXNvdXJjZXMgaXMgYSBsaXN0IHRoYXQg
bWF5IGJlIHVwZGF0ZWQgbXVsdGlwbGUgdGltZXMgKHdpdGgKKwkgKiBuZXcgcmVzb3VyY2VzKSBm
cm9tIGFueSB0aHJlYWQgYXNzb2NpYXRlZCB3aXRoIGEgdGVzdCBjYXNlLCB3ZSBtdXN0CisJICog
cHJvdGVjdCBpdCB3aXRoIHNvbWUgdHlwZSBvZiBsb2NrLgorCSAqLworCXN0cnVjdCBsaXN0X2hl
YWQgcmVzb3VyY2VzOyAvKiBQcm90ZWN0ZWQgYnkgbG9jay4gKi8KIH07CiAKIHZvaWQga3VuaXRf
aW5pdF90ZXN0KHN0cnVjdCBrdW5pdCAqdGVzdCwgY29uc3QgY2hhciAqbmFtZSk7CkBAIC0xNDEs
NiArMjEyLDc4IEBAIGludCBrdW5pdF9ydW5fdGVzdHMoc3RydWN0IGt1bml0X3N1aXRlICpzdWl0
ZSk7CiAJCX0JCQkJCQkJICAgICAgIFwKIAkJbGF0ZV9pbml0Y2FsbChrdW5pdF9zdWl0ZV9pbml0
IyNzdWl0ZSkKIAorLyoqCisgKiBMaWtlIGt1bml0X2FsbG9jX3Jlc291cmNlKCkgYmVsb3csIGJ1
dCByZXR1cm5zIHRoZSAmc3RydWN0IGt1bml0X3Jlc291cmNlCisgKiBvYmplY3QgdGhhdCBjb250
YWlucyB0aGUgYWxsb2NhdGlvbi4gVGhpcyBpcyBtb3N0bHkgZm9yIHRlc3RpbmcgcHVycG9zZXMu
CisgKi8KK3N0cnVjdCBrdW5pdF9yZXNvdXJjZSAqa3VuaXRfYWxsb2NfYW5kX2dldF9yZXNvdXJj
ZShzdHJ1Y3Qga3VuaXQgKnRlc3QsCisJCQkJCQkgICAga3VuaXRfcmVzb3VyY2VfaW5pdF90IGlu
aXQsCisJCQkJCQkgICAga3VuaXRfcmVzb3VyY2VfZnJlZV90IGZyZWUsCisJCQkJCQkgICAgZ2Zw
X3QgaW50ZXJuYWxfZ2ZwLAorCQkJCQkJICAgIHZvaWQgKmNvbnRleHQpOworCisvKioKKyAqIGt1
bml0X2FsbG9jX3Jlc291cmNlKCkgLSBBbGxvY2F0ZXMgYSAqdGVzdCBtYW5hZ2VkIHJlc291cmNl
Ki4KKyAqIEB0ZXN0OiBUaGUgdGVzdCBjb250ZXh0IG9iamVjdC4KKyAqIEBpbml0OiBhIHVzZXIg
c3VwcGxpZWQgZnVuY3Rpb24gdG8gaW5pdGlhbGl6ZSB0aGUgcmVzb3VyY2UuCisgKiBAZnJlZTog
YSB1c2VyIHN1cHBsaWVkIGZ1bmN0aW9uIHRvIGZyZWUgdGhlIHJlc291cmNlLgorICogQGludGVy
bmFsX2dmcDogZ2ZwIHRvIHVzZSBmb3IgaW50ZXJuYWwgYWxsb2NhdGlvbnMsIGlmIHVuc3VyZSwg
dXNlIEdGUF9LRVJORUwKKyAqIEBjb250ZXh0OiBmb3IgdGhlIHVzZXIgdG8gcGFzcyBpbiBhcmJp
dHJhcnkgZGF0YSB0byB0aGUgaW5pdCBmdW5jdGlvbi4KKyAqCisgKiBBbGxvY2F0ZXMgYSAqdGVz
dCBtYW5hZ2VkIHJlc291cmNlKiwgYSByZXNvdXJjZSB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHkg
YmUKKyAqIGNsZWFuZWQgdXAgYXQgdGhlIGVuZCBvZiBhIHRlc3QgY2FzZS4gU2VlICZzdHJ1Y3Qg
a3VuaXRfcmVzb3VyY2UgZm9yIGFuCisgKiBleGFtcGxlLgorICoKKyAqIE5PVEU6IEtVbml0IG5l
ZWRzIHRvIGFsbG9jYXRlIG1lbW9yeSBmb3IgZWFjaCBrdW5pdF9yZXNvdXJjZSBvYmplY3QuIFlv
dSBtdXN0CisgKiBzcGVjaWZ5IGFuIEBpbnRlcm5hbF9nZnAgdGhhdCBpcyBjb21wYXRpYmxlIHdp
dGggdGhlIHVzZSBjb250ZXh0IG9mIHlvdXIKKyAqIHJlc291cmNlLgorICovCitzdGF0aWMgaW5s
aW5lIHZvaWQgKmt1bml0X2FsbG9jX3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVzdCwKKwkJCQkJ
IGt1bml0X3Jlc291cmNlX2luaXRfdCBpbml0LAorCQkJCQkga3VuaXRfcmVzb3VyY2VfZnJlZV90
IGZyZWUsCisJCQkJCSBnZnBfdCBpbnRlcm5hbF9nZnAsCisJCQkJCSB2b2lkICpjb250ZXh0KQor
eworCXN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzOworCisJcmVzID0ga3VuaXRfYWxsb2NfYW5k
X2dldF9yZXNvdXJjZSh0ZXN0LCBpbml0LCBmcmVlLCBpbnRlcm5hbF9nZnAsCisJCQkJCSAgIGNv
bnRleHQpOworCisJaWYgKHJlcykKKwkJcmV0dXJuIHJlcy0+YWxsb2NhdGlvbjsKKworCXJldHVy
biBOVUxMOworfQorCit2b2lkIGt1bml0X2ZyZWVfcmVzb3VyY2Uoc3RydWN0IGt1bml0ICp0ZXN0
LCBzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcyk7CisKKy8qKgorICoga3VuaXRfa21hbGxvYygp
IC0gTGlrZSBrbWFsbG9jKCkgZXhjZXB0IHRoZSBhbGxvY2F0aW9uIGlzICp0ZXN0IG1hbmFnZWQq
LgorICogQHRlc3Q6IFRoZSB0ZXN0IGNvbnRleHQgb2JqZWN0LgorICogQHNpemU6IFRoZSBzaXpl
IGluIGJ5dGVzIG9mIHRoZSBkZXNpcmVkIG1lbW9yeS4KKyAqIEBnZnA6IGZsYWdzIHBhc3NlZCB0
byB1bmRlcmx5aW5nIGttYWxsb2MoKS4KKyAqCisgKiBKdXN0IGxpa2UgYGttYWxsb2MoLi4uKWAs
IGV4Y2VwdCB0aGUgYWxsb2NhdGlvbiBpcyBtYW5hZ2VkIGJ5IHRoZSB0ZXN0IGNhc2UKKyAqIGFu
ZCBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYWZ0ZXIgdGhlIHRlc3QgY2FzZSBjb25jbHVk
ZXMuIFNlZSAmc3RydWN0CisgKiBrdW5pdF9yZXNvdXJjZSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4K
KyAqLwordm9pZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNpemVfdCBzaXpl
LCBnZnBfdCBnZnApOworCisvKioKKyAqIGt1bml0X2t6YWxsb2MoKSAtIEp1c3QgbGlrZSBrdW5p
dF9rbWFsbG9jKCksIGJ1dCB6ZXJvZXMgdGhlIGFsbG9jYXRpb24uCisgKiBAdGVzdDogVGhlIHRl
c3QgY29udGV4dCBvYmplY3QuCisgKiBAc2l6ZTogVGhlIHNpemUgaW4gYnl0ZXMgb2YgdGhlIGRl
c2lyZWQgbWVtb3J5LgorICogQGdmcDogZmxhZ3MgcGFzc2VkIHRvIHVuZGVybHlpbmcga21hbGxv
YygpLgorICoKKyAqIFNlZSBremFsbG9jKCkgYW5kIGt1bml0X2ttYWxsb2MoKSBmb3IgbW9yZSBp
bmZvcm1hdGlvbi4KKyAqLworc3RhdGljIGlubGluZSB2b2lkICprdW5pdF9remFsbG9jKHN0cnVj
dCBrdW5pdCAqdGVzdCwgc2l6ZV90IHNpemUsIGdmcF90IGdmcCkKK3sKKwlyZXR1cm4ga3VuaXRf
a21hbGxvYyh0ZXN0LCBzaXplLCBnZnAgfCBfX0dGUF9aRVJPKTsKK30KKwordm9pZCBrdW5pdF9j
bGVhbnVwKHN0cnVjdCBrdW5pdCAqdGVzdCk7CisKIHZvaWQgX19wcmludGYoMywgNCkga3VuaXRf
cHJpbnRrKGNvbnN0IGNoYXIgKmxldmVsLAogCQkJCSBjb25zdCBzdHJ1Y3Qga3VuaXQgKnRlc3Qs
CiAJCQkJIGNvbnN0IGNoYXIgKmZtdCwgLi4uKTsKZGlmZiAtLWdpdCBhL2t1bml0L3Rlc3QuYyBi
L2t1bml0L3Rlc3QuYwppbmRleCBkMzAyY2ZmMGYxZGM3Li40YzE3OGE4MTdmMmZlIDEwMDY0NAot
LS0gYS9rdW5pdC90ZXN0LmMKKysrIGIva3VuaXQvdGVzdC5jCkBAIC0xMjIsNiArMTIyLDggQEAg
c3RhdGljIHZvaWQga3VuaXRfcHJpbnRfdGVzdF9jYXNlX29rX25vdF9vayhzdHJ1Y3Qga3VuaXRf
Y2FzZSAqdGVzdF9jYXNlLAogCiB2b2lkIGt1bml0X2luaXRfdGVzdChzdHJ1Y3Qga3VuaXQgKnRl
c3QsIGNvbnN0IGNoYXIgKm5hbWUpCiB7CisJc3Bpbl9sb2NrX2luaXQoJnRlc3QtPmxvY2spOwor
CUlOSVRfTElTVF9IRUFEKCZ0ZXN0LT5yZXNvdXJjZXMpOwogCXRlc3QtPm5hbWUgPSBuYW1lOwog
CXRlc3QtPnN1Y2Nlc3MgPSB0cnVlOwogfQpAQCAtMTUzLDYgKzE1NSw4IEBAIHN0YXRpYyB2b2lk
IGt1bml0X3J1bl9jYXNlKHN0cnVjdCBrdW5pdF9zdWl0ZSAqc3VpdGUsCiAJaWYgKHN1aXRlLT5l
eGl0KQogCQlzdWl0ZS0+ZXhpdCgmdGVzdCk7CiAKKwlrdW5pdF9jbGVhbnVwKCZ0ZXN0KTsKKwog
CXRlc3RfY2FzZS0+c3VjY2VzcyA9IHRlc3Quc3VjY2VzczsKIH0KIApAQCAtMTczLDYgKzE3Nyw5
NCBAQCBpbnQga3VuaXRfcnVuX3Rlc3RzKHN0cnVjdCBrdW5pdF9zdWl0ZSAqc3VpdGUpCiAJcmV0
dXJuIDA7CiB9CiAKK3N0cnVjdCBrdW5pdF9yZXNvdXJjZSAqa3VuaXRfYWxsb2NfYW5kX2dldF9y
ZXNvdXJjZShzdHJ1Y3Qga3VuaXQgKnRlc3QsCisJCQkJCQkgICAga3VuaXRfcmVzb3VyY2VfaW5p
dF90IGluaXQsCisJCQkJCQkgICAga3VuaXRfcmVzb3VyY2VfZnJlZV90IGZyZWUsCisJCQkJCQkg
ICAgZ2ZwX3QgaW50ZXJuYWxfZ2ZwLAorCQkJCQkJICAgIHZvaWQgKmNvbnRleHQpCit7CisJc3Ry
dWN0IGt1bml0X3Jlc291cmNlICpyZXM7CisJaW50IHJldDsKKworCXJlcyA9IGt6YWxsb2Moc2l6
ZW9mKCpyZXMpLCBpbnRlcm5hbF9nZnApOworCWlmICghcmVzKQorCQlyZXR1cm4gTlVMTDsKKwor
CXJldCA9IGluaXQocmVzLCBjb250ZXh0KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gTlVMTDsKKwor
CXJlcy0+ZnJlZSA9IGZyZWU7CisJc3Bpbl9sb2NrKCZ0ZXN0LT5sb2NrKTsKKwlsaXN0X2FkZF90
YWlsKCZyZXMtPm5vZGUsICZ0ZXN0LT5yZXNvdXJjZXMpOworCXNwaW5fdW5sb2NrKCZ0ZXN0LT5s
b2NrKTsKKworCXJldHVybiByZXM7Cit9CisKK3ZvaWQga3VuaXRfZnJlZV9yZXNvdXJjZShzdHJ1
Y3Qga3VuaXQgKnRlc3QsIHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzKQoreworCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnRlc3QtPmxvY2spOworCisJcmVzLT5mcmVlKHJlcyk7CisJbGlzdF9kZWwo
JnJlcy0+bm9kZSk7CisJa2ZyZWUocmVzKTsKK30KKworc3RydWN0IGt1bml0X2ttYWxsb2NfcGFy
YW1zIHsKKwlzaXplX3Qgc2l6ZTsKKwlnZnBfdCBnZnA7Cit9OworCitzdGF0aWMgaW50IGt1bml0
X2ttYWxsb2NfaW5pdChzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcywgdm9pZCAqY29udGV4dCkK
K3sKKwlzdHJ1Y3Qga3VuaXRfa21hbGxvY19wYXJhbXMgKnBhcmFtcyA9IGNvbnRleHQ7CisKKwly
ZXMtPmFsbG9jYXRpb24gPSBrbWFsbG9jKHBhcmFtcy0+c2l6ZSwgcGFyYW1zLT5nZnApOworCWlm
ICghcmVzLT5hbGxvY2F0aW9uKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgdm9pZCBrdW5pdF9rbWFsbG9jX2ZyZWUoc3RydWN0IGt1bml0X3Jlc291cmNlICpy
ZXMpCit7CisJa2ZyZWUocmVzLT5hbGxvY2F0aW9uKTsKK30KKwordm9pZCAqa3VuaXRfa21hbGxv
YyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNpemVfdCBzaXplLCBnZnBfdCBnZnApCit7CisJc3RydWN0
IGt1bml0X2ttYWxsb2NfcGFyYW1zIHBhcmFtcyA9IHsKKwkJLnNpemUgPSBzaXplLAorCQkuZ2Zw
ID0gZ2ZwCisJfTsKKworCXJldHVybiBrdW5pdF9hbGxvY19yZXNvdXJjZSh0ZXN0LAorCQkJCSAg
ICBrdW5pdF9rbWFsbG9jX2luaXQsCisJCQkJICAgIGt1bml0X2ttYWxsb2NfZnJlZSwKKwkJCQkg
ICAgZ2ZwLAorCQkJCSAgICAmcGFyYW1zKTsKK30KKwordm9pZCBrdW5pdF9jbGVhbnVwKHN0cnVj
dCBrdW5pdCAqdGVzdCkKK3sKKwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlc291cmNlLCAqcmVz
b3VyY2Vfc2FmZTsKKworCXNwaW5fbG9jaygmdGVzdC0+bG9jayk7CisJLyoKKwkgKiB0ZXN0LT5y
ZXNvdXJjZXMgaXMgYSBzdGFjayAtIGVhY2ggYWxsb2NhdGlvbiBtdXN0IGJlIGZyZWVkIGluIHRo
ZQorCSAqIHJldmVyc2Ugb3JkZXIgZnJvbSB3aGljaCBpdCB3YXMgYWRkZWQgc2luY2Ugb25lIHJl
c291cmNlIG1heSBkZXBlbmQKKwkgKiBvbiBhbm90aGVyIGZvciBpdHMgZW50aXJlIGxpZmV0aW1l
LgorCSAqLworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZV9yZXZlcnNlKHJlc291cmNlLAorCQkJ
CQkgcmVzb3VyY2Vfc2FmZSwKKwkJCQkJICZ0ZXN0LT5yZXNvdXJjZXMsCisJCQkJCSBub2RlKSB7
CisJCWt1bml0X2ZyZWVfcmVzb3VyY2UodGVzdCwgcmVzb3VyY2UpOworCX0KKwlzcGluX3VubG9j
aygmdGVzdC0+bG9jayk7Cit9CisKIHZvaWQga3VuaXRfcHJpbnRrKGNvbnN0IGNoYXIgKmxldmVs
LAogCQkgIGNvbnN0IHN0cnVjdCBrdW5pdCAqdGVzdCwKIAkJICBjb25zdCBjaGFyICpmbXQsIC4u
LikKLS0gCjIuMjIuMC41MTAuZzI2NGYyYzgxN2EtZ29vZwoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
