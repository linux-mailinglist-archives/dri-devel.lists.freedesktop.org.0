Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7C0BFA7C68
	for <lists+dri-devel@lfdr.de>; Wed,  4 Sep 2019 09:14:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 59A6A891D7;
	Wed,  4 Sep 2019 07:14:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 573 seconds by postgrey-1.36 at gabe;
 Tue, 03 Sep 2019 11:05:19 UTC
Received: from ironport.ite.com.tw (60-251-196-230.HINET-IP.hinet.net
 [60.251.196.230])
 by gabe.freedesktop.org (Postfix) with ESMTP id E6125892B6
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Sep 2019 11:05:19 +0000 (UTC)
Received: from unknown (HELO mse.ite.com.tw) ([192.168.35.30])
 by ironport.ite.com.tw with ESMTP; 03 Sep 2019 18:55:47 +0800
Received: from csbcas.internal.ite.com.tw (csbcas1.internal.ite.com.tw
 [192.168.65.46]) by mse.ite.com.tw with ESMTP id x83AtgV6074929;
 Tue, 3 Sep 2019 18:55:42 +0800 (GMT-8)
 (envelope-from allen.chen@ite.com.tw)
Received: from allen-VirtualBox.internal.ite.com.tw (192.168.70.14) by
 csbcas1.internal.ite.com.tw (192.168.65.45) with Microsoft SMTP Server (TLS)
 id 14.3.352.0; Tue, 3 Sep 2019 18:55:43 +0800
From: allen <allen.chen@ite.com.tw>
To: 
Subject: [PATCH v2 2/2] drm/bridge: add it6505 driver
Date: Tue, 3 Sep 2019 18:51:54 +0800
Message-ID: <1567507915-9844-3-git-send-email-allen.chen@ite.com.tw>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1567507915-9844-1-git-send-email-allen.chen@ite.com.tw>
References: <1567507915-9844-1-git-send-email-allen.chen@ite.com.tw>
MIME-Version: 1.0
X-Originating-IP: [192.168.70.14]
X-MAIL: mse.ite.com.tw x83AtgV6074929
X-Mailman-Approved-At: Wed, 04 Sep 2019 07:14:38 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Archit Taneja <architt@codeaurora.org>, Jitao Shi <jitao.shi@mediatek.com>,
 Jau-Chih Tseng <Jau-Chih.Tseng@ite.com.tw>, Yilun Lin <yllin@google.com>,
 Allen Chen <allen.chen@ite.com.tw>, David Airlie <airlied@linux.ie>,
 open list <linux-kernel@vger.kernel.org>,
 "open list:DRM DRIVERS" <dri-devel@lists.freedesktop.org>,
 "moderated list:ARM/Mediatek SoC
 support" <linux-mediatek@lists.infradead.org>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Pi-Hsun Shih <pihsun@chromium.org>, Matthias Brugger <matthias.bgg@gmail.com>,
 "moderated list:ARM/Mediatek SoC support"
 <linux-arm-kernel@lists.infradead.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQWxsZW4gQ2hlbiA8YWxsZW4uY2hlbkBpdGUuY29tLnR3PgoKVGhpcyBhZGRzIHN1cHBv
cnQgZm9yIHRoZSBpVEUgSVQ2NTA1LgpUaGlzIGRldmljZSBjYW4gY29udmVydCBEUEkgc2lnbmFs
IHRvIERQIG91dHB1dC4KClNpZ25lZC1vZmYtYnk6IEppdGFvIFNoaSA8aml0YW8uc2hpQG1lZGlh
dGVrLmNvbT4KU2lnbmVkLW9mZi1ieTogWWlsdW4gTGluIDx5bGxpbkBnb29nbGUuY29tPgpTaWdu
ZWQtb2ZmLWJ5OiBBbGxlbiBDaGVuIDxhbGxlbi5jaGVuQGl0ZS5jb20udHc+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnICAgICAgfCAgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9i
cmlkZ2UvTWFrZWZpbGUgICAgIHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2l0ZS1p
dDY1MDUuYyB8IDI1MzEgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDMgZmls
ZXMgY2hhbmdlZCwgMjUzOSBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9pdGUtaXQ2NTA1LmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL0tjb25maWcgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKaW5kZXgg
YjZlNTYyMS4uODg0MzI4OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9LY29u
ZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvS2NvbmZpZwpAQCAtNDMsNiArNDMsMTMg
QEAgY29uZmlnIERSTV9EVU1CX1ZHQV9EQUMKIAkgIFN1cHBvcnQgZm9yIG5vbi1wcm9ncmFtbWFi
bGUgUkdCIHRvIFZHQSBEQUMgYnJpZGdlcywgc3VjaCBhcyBBREkKIAkgIEFEVjcxMjMsIFRJIFRI
UzgxMzQgYW5kIFRIUzgxMzUgb3IgcGFzc2l2ZSByZXNpc3RvciBsYWRkZXIgREFDcy4KIAorY29u
ZmlnIERSTV9JVEVfSVQ2NTA1CisJdHJpc3RhdGUgIklURSBJVDY1MDUgRFAgYnJpZGdlIgorCWRl
cGVuZHMgb24gT0YKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwloZWxwCisJICBJVEUgSVQ2NTA1
IERQIGJyaWRnZSBjaGlwIGRyaXZlci4KKwogY29uZmlnIERSTV9MVkRTX0VOQ09ERVIKIAl0cmlz
dGF0ZSAiVHJhbnNwYXJlbnQgcGFyYWxsZWwgdG8gTFZEUyBlbmNvZGVyIHN1cHBvcnQiCiAJZGVw
ZW5kcyBvbiBPRgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZSBi
L2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvTWFrZWZpbGUKaW5kZXggMDZjYmRjYy4uNzdkNjBiMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQorKysgYi9kcml2ZXJz
L2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlCkBAIC0yLDYgKzIsNyBAQAogb2JqLSQoQ09ORklHX0RS
TV9BTkFMT0dJWF9BTlg3OFhYKSArPSBhbmFsb2dpeC1hbng3OHh4Lm8KIG9iai0kKENPTkZJR19E
Uk1fQ0ROU19EU0kpICs9IGNkbnMtZHNpLm8KIG9iai0kKENPTkZJR19EUk1fRFVNQl9WR0FfREFD
KSArPSBkdW1iLXZnYS1kYWMubworb2JqLSQoQ09ORklHX0RSTV9JVEVfSVQ2NTA1KSArPSBpdGUt
aXQ2NTA1Lm8KIG9iai0kKENPTkZJR19EUk1fTFZEU19FTkNPREVSKSArPSBsdmRzLWVuY29kZXIu
bwogb2JqLSQoQ09ORklHX0RSTV9NRUdBQ0hJUFNfU1REUFhYWFhfR0VfQjg1MFYzX0ZXKSArPSBt
ZWdhY2hpcHMtc3RkcHh4eHgtZ2UtYjg1MHYzLWZ3Lm8KIG9iai0kKENPTkZJR19EUk1fTlhQX1BU
TjM0NjApICs9IG54cC1wdG4zNDYwLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2UvaXRlLWl0NjUwNS5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9pdGUtaXQ2NTA1LmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uNTAzMTIwMAotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvaXRlLWl0NjUwNS5jCkBAIC0wLDAgKzEsMjUzMSBA
QAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQg
KGMpIDIwMTgsIFRoZSBMaW51eCBGb3VuZGF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgorICov
CisjaW5jbHVkZSA8bGludXgvYml0cy5oPgorI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5j
bHVkZSA8bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvZXJyLmg+CisjaW5jbHVkZSA8
bGludXgvZXh0Y29uLmg+CisjaW5jbHVkZSA8bGludXgvZnMuaD4KKyNpbmNsdWRlIDxsaW51eC9n
cGlvL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvaTJjLmg+CisjaW5jbHVkZSA8bGludXgv
aW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+CisjaW5jbHVkZSA8bGludXgv
bW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvcmVnbWFwLmg+CisjaW5jbHVkZSA8bGludXgvcmVn
dWxhdG9yL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKworI2luY2x1ZGUg
PGNyeXB0by9oYXNoLmg+CisjaW5jbHVkZSA8Y3J5cHRvL3NoYS5oPgorCisjaW5jbHVkZSA8ZHJt
L2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jcnRjLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9jcnRjX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHBfaGVscGVyLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9lZGlkLmg+CisKKyNkZWZpbmUgQVggMAorI2RlZmluZSBCWCAx
CisjZGVmaW5lIEFVRFNFTCBJMlMKKyNkZWZpbmUgQVVEVFlQRSBMUENNCisjZGVmaW5lIEFVREZT
IEFVRDQ4SworI2RlZmluZSBBVURDSCAyCisvKiAwOiBTdGFuZGFyZCBJMlM7MTogMzJiaXQgSTJT
ICovCisjZGVmaW5lIEkyU0lOUFVURk1UIDEKKy8qIDA6IExlZnQtanVzdGlmaWVkOzE6IFJpZ2h0
LWp1c3RpZmllZCAqLworI2RlZmluZSBJMlNKVVNUSUZJRUQgMAorLyogMDogRGF0YSBkZWxheSAx
VCBjb3JyZXNwb25kIHRvIFdTOzE6IE5vIGRhdGEgZGVsYXkgY29ycmVzcG9uZCB0byBXUyAqLwor
I2RlZmluZSBJMlNEQVRBREVMQVkgMAorLyogMDogaXMgbGVmdCBjaGFubmVsOzE6IGlzIHJpZ2h0
IGNoYW5uZWwgKi8KKyNkZWZpbmUgSTJTV1NDSEFOTkVMIDAKKy8qIDA6IE1TQiBzaGlmdCBmaXJz
dDsxOiBMU0Igc2hpZnQgZmlyc3QgKi8KKyNkZWZpbmUgSTJTREFUQVNFUSAwCisKKyNkZWZpbmUg
TEFORVNXQVAgMAorI2RlZmluZSBMQU5FIDQKKyNkZWZpbmUgX0hCUiAxCisjZGVmaW5lIEVOU1ND
IDEKKyNkZWZpbmUgRkxBR1RSQUlORE9XTiAxNTAKKyNkZWZpbmUgUE9MTElOR0tTVkxJU1QgNDAw
CisjZGVmaW5lIFRSQUlORkFJTENOVCA1CisjZGVmaW5lIFRSQUlORkFJTEhQRCAzCisjZGVmaW5l
IEFVWF9XQUlUX1RJTUVPVVRfTVMgMTUKKyNkZWZpbmUgUENMS19ERUxBWSAxCisjZGVmaW5lIFBD
TEtfSU5WIDAKKyNkZWZpbmUgRURJRFJFVFJZVElNRSA1CisjZGVmaW5lIFNIT1dWSURFT1RJTUlO
RyAyCisjZGVmaW5lIFBXUk9GRlJFVFJZVElNRSA1CisjZGVmaW5lIE1BWFBDTEsgODAwMDAKKyNk
ZWZpbmUgREVGQVVMVEhEQ1AgMQorI2RlZmluZSBERUZBVUxUQVVESU8gMAorI2RlZmluZSBERUZB
VUxUUFdST05PRkYgMQorI2RlZmluZSBERUZBVUxURFJWSE9MRCAwCisjZGVmaW5lIERFRkFVTFRQ
V1JPTiAwCisjZGVmaW5lIEFVWF9GSUZPX01BWF9TSVpFIDB4MTAKKworLyogQVggb3IgQlggKi8K
KyNkZWZpbmUgQ0hJUF9WRVJTSU9OIEJYCisKKy8qCisgKiAwOiBmb3IgYml0bGFuZAorICogMTog
Zm9yIGdvb2dsZSBrdWt1aSBwMiwgaHVhcWluCisgKi8KKyNkZWZpbmUgQUZFX1NFVFRJTkcgMQor
Cit1OCBhZmVfc2V0dGluZ190YWJsZVsyXVszXSA9IHsKKwl7MCwgMCwgMH0sCisJezB4OTMsIDB4
MmEsIDB4ODV9Cit9OworCitlbnVtIHN5c19zdGF0dXMgeworCVNZU19VTlBMVUcgPSAwLAorCVNZ
U19IUEQsCisJU1lTX0FVVE9UUkFJTiwKKwlTWVNfV0FJVCwKKwlTWVNfVFJBSU5GQUlMLAorCVNZ
U19SZUhEQ1AsCisJU1lTX05PUk9QLAorCVNZU19Vbmtub3duLAorfTsKKworZW51bSBpdDY1MDVf
YXVkX3NlbCB7CisJSTJTID0gMCwKKwlTUERJRiwKK307CisKK2VudW0gaXQ2NTA1X2F1ZF9mcyB7
CisJQVVEMjRLID0gMHg2LAorCUFVRDMySyA9IDB4MywKKwlBVUQ0OEsgPSAweDIsCisJQVVEOTZL
ID0gMHhBLAorCUFVRDE5MksgPSAweEUsCisJQVVENDRQMUsgPSAweDAsCisJQVVEODhQMksgPSAw
eDgsCisJQVVEMTc2UDRLID0gMHhDLAorfTsKKworZW51bSBpdDY1MDVfYXVkX3R5cGUgeworCUxQ
Q00gPSAwLAorCU5MUENNLAorCURTUywKKwlIQlIsCit9OworCitlbnVtIGF1ZF93b3JkX2xlbmd0
aCB7CisJQVVEMTZCSVQgPSAwLAorCUFVRDE4QklULAorCUFVRDIwQklULAorCUFVRDI0QklULAor
fTsKKworLyogQXVkaW8gU2FtcGxlIFdvcmQgTGVuZ3RoOiBBVUQxNkJJVCwgQVVEMThCSVQsIEFV
RDIwQklULCBBVUQyNEJJVCAqLworI2RlZmluZSBBVURXT1JETEVOR1RIIEFVRDI0QklUCisKK3N0
cnVjdCBpdDY1MDVfcGxhdGZvcm1fZGF0YSB7CisJc3RydWN0IHJlZ3VsYXRvciAqcHdyMTg7CisJ
c3RydWN0IHJlZ3VsYXRvciAqb3ZkZDsKKwlzdHJ1Y3QgZ3Bpb19kZXNjICpncGlvZF9ocGQ7CisJ
c3RydWN0IGdwaW9fZGVzYyAqZ3Bpb2RfcmVzZXQ7Cit9OworCitzdHJ1Y3QgaXQ2NTA1IHsKKwlz
dHJ1Y3QgZHJtX2RwX2F1eCBhdXg7CisJc3RydWN0IGRybV9icmlkZ2UgYnJpZGdlOworCXN0cnVj
dCBpMmNfY2xpZW50ICpjbGllbnQ7CisJc3RydWN0IGVkaWQgKmVkaWQ7CisJc3RydWN0IGRybV9j
b25uZWN0b3IgY29ubmVjdG9yOworCXN0cnVjdCBkcm1fZHBfbGluayBsaW5rOworCXN0cnVjdCBp
dDY1MDVfcGxhdGZvcm1fZGF0YSBwZGF0YTsKKwlzdHJ1Y3QgbXV0ZXggbG9jazsKKwlzdHJ1Y3Qg
bXV0ZXggbW9kZV9sb2NrOworCXN0cnVjdCByZWdtYXAgKnJlZ21hcDsKKwlzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSB2aWRfaW5mbzsKKworCXN0cnVjdCBub3RpZmllcl9ibG9jayBldmVudF9uYjsK
KwlzdHJ1Y3QgZXh0Y29uX2RldiAqZXh0Y29uOworCXN0cnVjdCB3b3JrX3N0cnVjdCBleHRjb25f
d3E7CisJZW51bSBzeXNfc3RhdHVzIHN0YXR1czsKKwlib29sIGhicjsKKwl1OCBlbl9zc2M7CisJ
Ym9vbCBsYW5lc3dhcF9kaXNhYmxlZDsKKwlib29sIGxhbmVzd2FwOworCisJZW51bSBpdDY1MDVf
YXVkX3NlbCBhdWRfc2VsOworCWVudW0gaXQ2NTA1X2F1ZF9mcyBhdWRfZnM7CisJZW51bSBpdDY1
MDVfYXVkX3R5cGUgYXVkX3R5cGU7CisJdTggYXVkX2NoOworCXU4IGkyc19pbnB1dF9mbXQ7CisJ
dTggaTJzX2p1c3RpZmllZDsKKwl1OCBpMnNfZGF0YV9kZWxheTsKKwl1OCBpMnNfd3NfY2hhbm5l
bDsKKwl1OCBpMnNfZGF0YV9zZXE7CisJdTggdmlkc3RhYmxlX2RvbmU7CisJZW51bSBhdWRfd29y
ZF9sZW5ndGggYXVkd29yZGxlbmd0aDsKKwl1bnNpZ25lZCBpbnQgZW5faGRjcDsKKwl1bnNpZ25l
ZCBpbnQgZW5fcHdyb25vZmY7CisJdW5zaWduZWQgaW50IGVuX2F1ZGlvOworCXU4IGNudGZzbTsK
Kwl1OCB0cmFpbl9mYWlsX2hwZDsKKwlib29sIGNwX2NhcGFibGU7CisJYm9vbCBjcF9kb25lOwor
CXU4IGRvd25zdHJlYW1fcmVwZWF0ZXI7CisJdTggc2hhaW5wdXRbNjRdOworCXU4IGF2WzVdWzRd
OworCXU4IGJ2WzVdWzRdOworCWJvb2wgcG93ZXJlZDsKKwkvKiBpdDY1MDUgZHJpdmVyIGhvbGQg
b3B0aW9uICovCisJdW5zaWduZWQgaW50IGRydl9ob2xkOworfTsKKworc3RhdGljIGNvbnN0IHN0
cnVjdCByZWdtYXBfcmFuZ2UgaXQ2NTA1X2JyaWRnZV92b2xhdGlsZV9yYW5nZXNbXSA9IHsKKwl7
IC5yYW5nZV9taW4gPSAwLCAucmFuZ2VfbWF4ID0gMHhGRiB9LAorfTsKKworc3RhdGljIGNvbnN0
IHN0cnVjdCByZWdtYXBfYWNjZXNzX3RhYmxlIGl0NjUwNV9icmlkZ2Vfdm9sYXRpbGVfdGFibGUg
PSB7CisJLnllc19yYW5nZXMgPSBpdDY1MDVfYnJpZGdlX3ZvbGF0aWxlX3JhbmdlcywKKwkubl95
ZXNfcmFuZ2VzID0gQVJSQVlfU0laRShpdDY1MDVfYnJpZGdlX3ZvbGF0aWxlX3JhbmdlcyksCit9
OworCitzdGF0aWMgY29uc3Qgc3RydWN0IHJlZ21hcF9jb25maWcgaXQ2NTA1X2JyaWRnZV9yZWdt
YXBfY29uZmlnID0geworCS5yZWdfYml0cyA9IDgsCisJLnZhbF9iaXRzID0gOCwKKwkudm9sYXRp
bGVfdGFibGUgPSAmaXQ2NTA1X2JyaWRnZV92b2xhdGlsZV90YWJsZSwKKwkuY2FjaGVfdHlwZSA9
IFJFR0NBQ0hFX05PTkUsCit9OworCitzdGF0aWMgaW50IGRwdHhyZChzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUsIHVuc2lnbmVkIGludCByZWdfYWRkciwKKwkJICB1bnNpZ25lZCBpbnQgKnZhbHVlKQor
eworCWludCBlcnI7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7
CisKKwllcnIgPSByZWdtYXBfcmVhZChpdDY1MDUtPnJlZ21hcCwgcmVnX2FkZHIsIHZhbHVlKTsK
KwlpZiAoZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgInJlYWQgZmFpbGVkIHJlZ1sw
eCV4XSBlcnI6ICVkIiwgcmVnX2FkZHIsCisJCQkgICAgICBlcnIpOworCQlyZXR1cm4gZXJyOwor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBpdDY1MDVfZHVtcChzdHJ1Y3QgaXQ2
NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IHRlbXBbMTZdLCBpLCBqOworCXU4IHZhbHVl
WzE2XTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCWZv
ciAoaSA9IDA7IGkgPD0gMHhmZjsgaSArPSAxNikgeworCQlmb3IgKGogPSAwOyBqIDwgMTY7IGor
KykgeworCQkJZHB0eHJkKGl0NjUwNSwgaSArIGosIHRlbXAgKyBqKTsKKwkJCXZhbHVlW2pdID0g
dGVtcFtqXTsKKwkJfQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJbMHglMDJ4XSA9ICUx
NnBoIiwgaSwgdmFsdWUpOworCX0KK30KKworc3RhdGljIGludCBkcHR4d3Ioc3RydWN0IGl0NjUw
NSAqaXQ2NTA1LCB1bnNpZ25lZCBpbnQgcmVnX2FkZHIsCisJCSAgdW5zaWduZWQgaW50IHJlZ192
YWwpCit7CisJaW50IGVycjsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQt
PmRldjsKKworCWVyciA9IHJlZ21hcF93cml0ZShpdDY1MDUtPnJlZ21hcCwgcmVnX2FkZHIsIHJl
Z192YWwpOworCisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJ3cml0ZSBm
YWlsZWQgcmVnWzB4JXhdID0gMHgleCBlcnIgPSAlZCIsCisJCQkgICAgICByZWdfYWRkciwgcmVn
X3ZhbCwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBkcHR4c2V0KHN0cnVjdCBpdDY1MDUgKml0NjUwNSwgdW5zaWduZWQgaW50IHJlZywgdW5z
aWduZWQgaW50IG1hc2ssCisJCSAgIHVuc2lnbmVkIGludCB2YWx1ZSkKK3sKKwlpbnQgZXJyOwor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZXJyID0gcmVn
bWFwX3VwZGF0ZV9iaXRzKGl0NjUwNS0+cmVnbWFwLCByZWcsIG1hc2ssIHZhbHVlKTsKKwlpZiAo
ZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9SKAorCQkJZGV2LCAid3JpdGUgcmVnWzB4JXhdID0g
MHgleCBtYXNrID0gMHgleCBmYWlsZWQgZXJyICVkIiwKKwkJCXJlZywgdmFsdWUsIG1hc2ssIGVy
cik7CisJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRw
dHhfZGVidWdfcHJpbnQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1LCB1bnNpZ25lZCBpbnQgcmVnLAor
CQkJICAgICBjb25zdCBjaGFyICpwcmVmaXgpCit7CisJdW5zaWduZWQgaW50IHZhbDsKKwlpbnQg
ZXJyOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYg
KGxpa2VseSghKGRybV9kZWJ1ZyAmIERSTV9VVF9EUklWRVIpKSkKKwkJcmV0dXJuOworCisJZXJy
ID0gZHB0eHJkKGl0NjUwNSwgcmVnLCAmdmFsKTsKKwlpZiAoZXJyIDwgMCkKKwkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiJXMgcmVnJTAyeCByZWFkIGVycm9yIiwgcHJlZml4LCByZWcpOwor
CWVsc2UKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiJXMgcmVnJTAyeCA9IDB4JTAyeCIs
IHByZWZpeCwgcmVnLAorCQkJCSAgICAgdmFsKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3Qg
aXQ2NTA1ICpjb25uZWN0b3JfdG9faXQ2NTA1KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjKQorewor
CXJldHVybiBjb250YWluZXJfb2YoYywgc3RydWN0IGl0NjUwNSwgY29ubmVjdG9yKTsKK30KKwor
c3RhdGljIGlubGluZSBzdHJ1Y3QgaXQ2NTA1ICpicmlkZ2VfdG9faXQ2NTA1KHN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2UpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihicmlkZ2UsIHN0cnVjdCBp
dDY1MDUsIGJyaWRnZSk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9pbml0X2ZzbShzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJaXQ2NTA1LT5hdWRfc2VsID0gQVVEU0VMOworCWl0NjUwNS0+
YXVkX2ZzID0gQVVERlM7CisJaXQ2NTA1LT5hdWRfY2ggPSBBVURDSDsKKwlpdDY1MDUtPmF1ZF90
eXBlID0gQVVEVFlQRTsKKwlpdDY1MDUtPmkyc19pbnB1dF9mbXQgPSBJMlNJTlBVVEZNVDsKKwlp
dDY1MDUtPmkyc19qdXN0aWZpZWQgPSBJMlNKVVNUSUZJRUQ7CisJaXQ2NTA1LT5pMnNfZGF0YV9k
ZWxheSA9IEkyU0RBVEFERUxBWTsKKwlpdDY1MDUtPmkyc193c19jaGFubmVsID0gSTJTV1NDSEFO
TkVMOworCWl0NjUwNS0+aTJzX2RhdGFfc2VxID0gSTJTREFUQVNFUTsKKwlpdDY1MDUtPmF1ZHdv
cmRsZW5ndGggPSBBVURXT1JETEVOR1RIOworCWl0NjUwNS0+ZW5fYXVkaW8gPSBERUZBVUxUQVVE
SU87CisJaXQ2NTA1LT5lbl9oZGNwID0gREVGQVVMVEhEQ1A7CisKKwlpdDY1MDUtPmhiciA9IF9I
QlI7CisJaXQ2NTA1LT5lbl9zc2MgPSBFTlNTQzsKKwlpdDY1MDUtPmxhbmVzd2FwID0gTEFORVNX
QVA7CisJaXQ2NTA1LT52aWRzdGFibGVfZG9uZSA9IDA7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV90ZXJtaW5hdGlvbl9vbihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisjaWYgKENISVBfVkVS
U0lPTiA9PSBCWCkKKwlkcHR4c2V0KGl0NjUwNSwgMHg1RCwgMHg4MCwgMHgwMCk7CisJZHB0eHNl
dChpdDY1MDUsIDB4NUUsIDB4MDIsIDB4MDIpOworI2VuZGlmCit9CisKK3N0YXRpYyB2b2lkIGl0
NjUwNV90ZXJtaW5hdGlvbl9vZmYoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworI2lmIChDSElQ
X1ZFUlNJT04gPT0gQlgpCisJZHB0eHNldChpdDY1MDUsIDB4NUQsIDB4ODAsIDB4ODApOworCWRw
dHhzZXQoaXQ2NTA1LCAweDVFLCAweDAyLCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHg1Qywg
MHhGMCwgMHgwMCk7CisjZW5kaWYKK30KKworc3RhdGljIGJvb2wgZHB0eF9nZXRzaW5raHBkKHN0
cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwl1bnNpZ25lZCBpbnQgdmFsdWU7CisJaW50IHJldDsK
KworCXJldCA9IGRwdHhyZChpdDY1MDUsIDB4MEQsICZ2YWx1ZSk7CisKKwlpZiAocmV0IDwgMCkK
KwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIEJJVCgxKSkgPT0gQklUKDEpOwor
fQorCitzdGF0aWMgdm9pZCBkcHR4X2NoZ2Jhbmsoc3RydWN0IGl0NjUwNSAqaXQ2NTA1LCB1bnNp
Z25lZCBpbnQgYmFua19pZCkKK3sKKwlkcHR4c2V0KGl0NjUwNSwgMHgwRiwgMHgwMSwgYmFua19p
ZCAmIEJJVCgwKSk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9pbnRfbWFza19vbihzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJZHB0eHdyKGl0NjUwNSwgMHgwOSwgMHgxRik7CisJZHB0eHdy
KGl0NjUwNSwgMHgwQSwgMHgwNyk7CisJZHB0eHdyKGl0NjUwNSwgMHgwQiwgMHg5MCk7Cit9CisK
K3N0YXRpYyB2b2lkIGl0NjUwNV9pbnRfbWFza19vZmYoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQor
eworCWRwdHh3cihpdDY1MDUsIDB4MDksIDB4MDApOworCWRwdHh3cihpdDY1MDUsIDB4MEEsIDB4
MDApOworCWRwdHh3cihpdDY1MDUsIDB4MEIsIDB4MDApOworfQorCitzdGF0aWMgdm9pZCBkcHR4
X2luaXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWRwdHh3cihpdDY1MDUsIDB4MDUsIDB4
M0IpOworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA1LCAw
eDFGKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMTUwMCk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV9pbml0X2FuZF9tYXNrX29uKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlkcHR4X2luaXQo
aXQ2NTA1KTsKKwlpdDY1MDVfaW50X21hc2tfb24oaXQ2NTA1KTsKK30KKworc3RhdGljIGludCBp
dDY1MDVfcG93ZXJvbihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGl0NjUwNV9w
bGF0Zm9ybV9kYXRhICpwZGF0YSA9ICZpdDY1MDUtPnBkYXRhOworCWludCBlcnIgPSAwOworCXN0
cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKGl0NjUwNS0+
cG93ZXJlZCkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJpdDY1MDUgYWxyZWFkeSBw
b3dlcmVkIG9uIik7CisJCXJldHVybiAwOworCX0KKworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRl
diwgIml0NjUwNSBzdGFydCB0byBwb3dlciBvbiIpOworCisJZXJyID0gcmVndWxhdG9yX2VuYWJs
ZShwZGF0YS0+cHdyMTgpOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIHRvIGVuYWJs
ZSBwd3IxOCByZWd1bGF0b3IiLAorCQkJICAgICBlcnIgPyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQi
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCS8qIHRpbWUgaW50ZXJ2YWwgYmV0d2VlbiBJ
VkREIGFuZCBPVkREIGF0IGxlYXN0IGJlIDFtcyAqLworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAw
KTsKKwllcnIgPSByZWd1bGF0b3JfZW5hYmxlKHBkYXRhLT5vdmRkKTsKKwlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICIlcyB0byBlbmFibGUgb3ZkZCByZWd1bGF0b3IiLAorCQkJICAgICBlcnIg
PyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQiKTsKKwlpZiAoZXJyKSB7CisJCXJlZ3VsYXRvcl9kaXNh
YmxlKHBkYXRhLT5wd3IxOCk7CisJCXJldHVybiBlcnI7CisJfQorCS8qIHRpbWUgaW50ZXJ2YWwg
YmV0d2VlbiBPVkREIGFuZCBTWVNSU1ROIGF0IGxlYXN0IGJlIDEwbXMgKi8KKwl1c2xlZXBfcmFu
Z2UoMTAwMDAsIDIwMDAwKTsKKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAocGRhdGEtPmdwaW9k
X3Jlc2V0LCAwKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisJZ3Bpb2Rfc2V0X3ZhbHVl
X2NhbnNsZWVwKHBkYXRhLT5ncGlvZF9yZXNldCwgMSk7CisJdXNsZWVwX3JhbmdlKDEwMDAwLCAy
MDAwMCk7CisKKwlpdDY1MDVfaW5pdF9hbmRfbWFza19vbihpdDY1MDUpOworCWl0NjUwNS0+cG93
ZXJlZCA9IHRydWU7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X3Bvd2Vyb2Zm
KHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1X3BsYXRmb3JtX2RhdGEg
KnBkYXRhID0gJml0NjUwNS0+cGRhdGE7CisJaW50IGVyciA9IDA7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpZiAoIWl0NjUwNS0+cG93ZXJlZCkgewor
CQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJwb3dlciBoYWQgYmVlbiBhbHJlYWR5IG9mZiIp
OworCQlyZXR1cm4gMDsKKwl9CisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKHBkYXRhLT5ncGlv
ZF9yZXNldCwgMCk7CisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUocGRhdGEtPnB3cjE4KTsKKwlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICIlcyB0byBkaXNhYmxlIHB3cjE4IHJlZ3VsYXRvciIs
CisJCQkgICAgIGVyciA/ICJGYWlsZWQiIDogIlN1Y2NlZWRlZCIpOworCWlmIChlcnIpCisJCXJl
dHVybiBlcnI7CisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUocGRhdGEtPm92ZGQpOworCURSTV9E
RVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIHRvIGRpc2FibGUgb3ZkZCByZWd1bGF0b3IiLAorCQkJ
ICAgICBlcnIgPyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQiKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4g
ZXJyOworCisJa2ZyZWUoaXQ2NTA1LT5lZGlkKTsKKwlpdDY1MDUtPmVkaWQgPSBOVUxMOworCWl0
NjUwNS0+cG93ZXJlZCA9IGZhbHNlOworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBzaG93
X3ZpZF9pbmZvKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlpbnQgaHN5bmNfcG9sLCB2c3lu
Y19wb2wsIGludGVybGFjZWQ7CisJaW50IGh0b3RhbCwgaGRlcywgaGRldywgaGZwaCwgaHN5bmN3
OworCWludCB2dG90YWwsIHZkZXMsIHZkZXcsIHZmcGgsIHZzeW5jdzsKKwlpbnQgcmRkYXRhLCBy
ZGRhdGExLCBpOworCWludCBwY2xrLCBzdW07CisKKwl1c2xlZXBfcmFuZ2UoMTAwMDAsIDE1MDAw
KTsKKwlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwlkcHR4cmQoaXQ2NTA1LCAweGEwLCAmcmRk
YXRhKTsKKwloc3luY19wb2wgPSByZGRhdGEgJiBCSVQoMCk7CisJdnN5bmNfcG9sID0gKHJkZGF0
YSAmIEJJVCgyKSkgPj4gMjsKKwlpbnRlcmxhY2VkID0gKHJkZGF0YSAmIEJJVCg0KSkgPj4gNDsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTEsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTIs
ICZyZGRhdGExKTsKKwlodG90YWwgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTMsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTQs
ICZyZGRhdGExKTsKKworCWhkZXMgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTUsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTYs
ICZyZGRhdGExKTsKKworCWhkZXcgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTcsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTgs
ICZyZGRhdGExKTsKKworCWhmcGggPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTksICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YWEs
ICZyZGRhdGExKTsKKworCWhzeW5jdyA9ICgocmRkYXRhMSAmIDB4MUYpIDw8IDgpICsgcmRkYXRh
OworCisJZHB0eHJkKGl0NjUwNSwgMHhhYiwgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhh
YywgJnJkZGF0YTEpOworCXZ0b3RhbCA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRh
OworCisJZHB0eHJkKGl0NjUwNSwgMHhhZCwgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhh
ZSwgJnJkZGF0YTEpOworCXZkZXMgPSAoKHJkZGF0YTEgJiAweDBGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YWYsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YjAs
ICZyZGRhdGExKTsKKwl2ZGV3ID0gKChyZGRhdGExICYgMHgwRikgPDwgOCkgKyByZGRhdGE7CisK
KwlkcHR4cmQoaXQ2NTA1LCAweGIxLCAmcmRkYXRhKTsKKwlkcHR4cmQoaXQ2NTA1LCAweGIyLCAm
cmRkYXRhMSk7CisJdmZwaCA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJ
ZHB0eHJkKGl0NjUwNSwgMHhiMywgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhiNCwgJnJk
ZGF0YTEpOworCXZzeW5jdyA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJ
c3VtID0gMDsKKwlmb3IgKGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKKwkJZHB0eHNldChpdDY1MDUs
IDB4MTIsIDB4ODAsIDB4ODApOworCQl1c2xlZXBfcmFuZ2UoMTAwMDAsIDE1MDAwKTsKKwkJZHB0
eHNldChpdDY1MDUsIDB4MTIsIDB4ODAsIDB4MDApOworCisJCWRwdHhyZChpdDY1MDUsIDB4MTMs
ICZyZGRhdGEpOworCQlkcHR4cmQoaXQ2NTA1LCAweDE0LCAmcmRkYXRhMSk7CisJCXJkZGF0YSA9
ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJCXN1bSArPSByZGRhdGE7CisJ
fQorCisJc3VtIC89IDEwMDsKKwlwY2xrID0gMTM1MDAgKiAyMDQ4IC8gc3VtOworCWl0NjUwNS0+
dmlkX2luZm8uY2xvY2sgPSBwY2xrOworCWl0NjUwNS0+dmlkX2luZm8uaGRpc3BsYXkgPSBoZGV3
OworCWl0NjUwNS0+dmlkX2luZm8uaHN5bmNfc3RhcnQgPSBoZGV3ICsgaGZwaDsKKwlpdDY1MDUt
PnZpZF9pbmZvLmhzeW5jX2VuZCA9IGhkZXcgKyBoZnBoICsgaHN5bmN3OworCWl0NjUwNS0+dmlk
X2luZm8uaHRvdGFsID0gaHRvdGFsOworCWl0NjUwNS0+dmlkX2luZm8udmRpc3BsYXkgPSB2ZGV3
OworCWl0NjUwNS0+dmlkX2luZm8udnN5bmNfc3RhcnQgPSB2ZGV3ICsgdmZwaDsKKwlpdDY1MDUt
PnZpZF9pbmZvLnZzeW5jX2VuZCA9IHZkZXcgKyB2ZnBoICsgdnN5bmN3OworCWl0NjUwNS0+dmlk
X2luZm8udnRvdGFsID0gdnRvdGFsOworCWl0NjUwNS0+dmlkX2luZm8udnJlZnJlc2ggPSBwY2xr
IC8gaHRvdGFsIC8gdnRvdGFsOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoJml0NjUwNS0+Y2xp
ZW50LT5kZXYsIERSTV9NT0RFX0ZNVCwKKwkJCSAgICAgRFJNX01PREVfQVJHKCZpdDY1MDUtPnZp
ZF9pbmZvKSk7Cit9CisKK3N0YXRpYyB2b2lkIHNob3dfYXVkX21jbnQoc3RydWN0IGl0NjUwNSAq
aXQ2NTA1KQoreworCXVuc2lnbmVkIGludCBhdWRuLCByZWdkZSwgcmVnZGYsIHJlZ2UwLCB2Y2xr
LCBhY2xrLCBhdWRtY2FsLCBhdWRtY250OworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUt
PmNsaWVudC0+ZGV2OworCisJZHB0eHJkKGl0NjUwNSwgMHhkZSwgJnJlZ2RlKTsKKwlkcHR4cmQo
aXQ2NTA1LCAweGRmLCAmcmVnZGYpOworCWRwdHhyZChpdDY1MDUsIDB4ZTAsICZyZWdlMCk7CisJ
YXVkbiA9IHJlZ2RlICsgKHJlZ2RmIDw8IDgpICsgKHJlZ2UwIDw8IDE2KTsKKwlpZiAoaXQ2NTA1
LT5oYnIpCisJCXZjbGsgPSAyNzAwMDAwOworCWVsc2UKKwkJdmNsayA9IDE2MjAwMDA7CisJc3dp
dGNoIChpdDY1MDUtPmF1ZF9mcykgeworCWNhc2UgQVVEMzJLOgorCQlhY2xrID0gMzIwOworCQli
cmVhazsKKwljYXNlIEFVRDQ4SzoKKwkJYWNsayA9IDQ4MDsKKwkJYnJlYWs7CisJY2FzZSBBVUQ5
Nks6CisJCWFjbGsgPSA5NjA7CisJCWJyZWFrOworCWNhc2UgQVVEMTkySzoKKwkJYWNsayA9IDE5
MjA7CisJCWJyZWFrOworCWNhc2UgQVVENDRQMUs6CisJCWFjbGsgPSA0NDE7CisJY2FzZSBBVUQ4
OFAySzoKKwkJYWNsayA9IDg4MjsKKwkJYnJlYWs7CisJY2FzZSBBVUQxNzZQNEs6CisJCWFjbGsg
PSAxNzY0OworCQlicmVhazsKKwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisJYXVkbWNhbCA9IGF1
ZG4gKiBhY2xrIC8gdmNsayAqIDUxMjsKKwlkcHR4cmQoaXQ2NTA1LCAweGU0LCAmcmVnZGUpOwor
CWRwdHhyZChpdDY1MDUsIDB4ZTUsICZyZWdkZik7CisJZHB0eHJkKGl0NjUwNSwgMHhlNiwgJnJl
Z2UwKTsKKwlhdWRtY250ID0gKHJlZ2UwIDw8IDE2KSArIChyZWdkZiA8PCA4KSArIHJlZ2RlOwor
CURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgImF1ZGlvIE46MHglMDZ4IiwgYXVkbik7CisJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LCAiYXVkaW8gTWNhbDoweCUwNngiLCBhdWRtY2FsKTsKKwlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJhdWRpbyBNY250OjB4JTA2eCIsIGF1ZG1jbnQpOwor
fQorCitzdGF0aWMgY29uc3QgY2hhciAqY29uc3Qgc3RhdGVfc3RyaW5nW10gPSB7CisJW1NZU19V
TlBMVUddID0gIlNZU19VTlBMVUciLAorCVtTWVNfSFBEXSA9ICJTWVNfSFBEIiwKKwlbU1lTX0FV
VE9UUkFJTl0gPSAiU1lTX0FVVE9UUkFJTiIsCisJW1NZU19XQUlUXSA9ICJTWVNfV0FJVCIsCisJ
W1NZU19UUkFJTkZBSUxdID0gIlNZU19UUkFJTkZBSUwiLAorCVtTWVNfUmVIRENQXSA9ICJTWVNf
UmVIRENQIiwKKwlbU1lTX05PUk9QXSA9ICJTWVNfTk9ST1AiLAorCVtTWVNfVW5rbm93bl0gPSAi
U1lTX1Vua25vd24iLAorfTsKKworc3RhdGljIHZvaWQgZHB0eF9zeXNfY2hnKHN0cnVjdCBpdDY1
MDUgKml0NjUwNSwgZW51bSBzeXNfc3RhdHVzIG5ld3N0YXRlKQoreworCWludCBpID0gMDsKKwlz
dHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCWlmIChuZXdzdGF0
ZSAhPSBTWVNfVU5QTFVHKSB7CisJCWlmICghZHB0eF9nZXRzaW5raHBkKGl0NjUwNSkpCisJCQlu
ZXdzdGF0ZSA9IFNZU19VTlBMVUc7CisJfQorCWlmIChpdDY1MDUtPnN0YXR1cyA9PSBuZXdzdGF0
ZSkKKwkJcmV0dXJuOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAic3lzX3N0YXRlIGNo
YW5nZTogJXMgLT4gJXMiLAorCQkJICAgICBzdGF0ZV9zdHJpbmdbaXQ2NTA1LT5zdGF0dXNdLAor
CQkJICAgICBzdGF0ZV9zdHJpbmdbbmV3c3RhdGVdKTsKKwlpdDY1MDUtPnN0YXR1cyA9IG5ld3N0
YXRlOworCisJc3dpdGNoIChpdDY1MDUtPnN0YXR1cykgeworCWNhc2UgU1lTX1VOUExVRzoKKwkJ
a2ZyZWUoaXQ2NTA1LT5lZGlkKTsKKwkJaXQ2NTA1LT5lZGlkID0gTlVMTDsKKwkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiRnJlZSBpdDY1MDUgRURJRCBtZW1vcnkiKTsKKwkJaXQ2NTA1X2lu
aXRfYW5kX21hc2tfb24oaXQ2NTA1KTsKKwkJaXQ2NTA1X3Rlcm1pbmF0aW9uX29mZihpdDY1MDUp
OworCQlicmVhazsKKwljYXNlIFNZU19IUEQ6CisJCWl0NjUwNV90ZXJtaW5hdGlvbl9vbihpdDY1
MDUpOworCQlicmVhazsKKwljYXNlIFNZU19BVVRPVFJBSU46CisJCWJyZWFrOworCWNhc2UgU1lT
X1dBSVQ6CisJCWJyZWFrOworCWNhc2UgU1lTX1JlSERDUDoKKwkJYnJlYWs7CisJY2FzZSBTWVNf
Tk9ST1A6CisJCWZvciAoaSA9IDA7IGkgPCBTSE9XVklERU9USU1JTkc7IGkrKykKKwkJCXNob3df
dmlkX2luZm8oaXQ2NTA1KTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfVFJBSU5GQUlMOgorCQkvKiBp
dDY1MDUgZ29lcyB0byBpZGxlICovCisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFrOworCX0K
K30KKworc3RhdGljIGJvb2wgaXQ2NTA1X2F1eF9vcF9maW5pc2hlZChzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUpCit7CisJdW5zaWduZWQgaW50IHZhbHVlOworCWludCBlcnI7CisKKwllcnIgPSByZWdt
YXBfcmVhZChpdDY1MDUtPnJlZ21hcCwgMHgyYiwgJnZhbHVlKTsKKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIEJJVCg1KSkgPT0gMDsKK30KKworc3Rh
dGljIGludCBkcHR4X2F1eHdhaXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXVuc2lnbmVk
IGludCBzdGF0dXM7CisJdW5zaWduZWQgbG9uZyB0aW1lb3V0OworCWludCBlcnI7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwl0aW1lb3V0ID0gamlmZmll
cyArIG1zZWNzX3RvX2ppZmZpZXMoQVVYX1dBSVRfVElNRU9VVF9NUykgKyAxOworCisJd2hpbGUg
KCFpdDY1MDVfYXV4X29wX2ZpbmlzaGVkKGl0NjUwNSkpIHsKKwkJaWYgKHRpbWVfYWZ0ZXIoamlm
ZmllcywgdGltZW91dCkpIHsKKwkJCURSTV9ERVZfRVJST1IoZGV2LCAiVGltZWQgb3V0IHdhaXRp
bmcgQVVYIHRvIGZpbmlzaCIpOworCQkJcmV0dXJuIC1FVElNRURPVVQ7CisJCX0KKwkJdXNsZWVw
X3JhbmdlKDEwMDAsIDIwMDApOworCX0KKworCWVyciA9IGRwdHhyZChpdDY1MDUsIDB4OWYsICZz
dGF0dXMpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRv
IHJlYWQgQVVYIGNoYW5uZWw6ICVkIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlpZiAo
c3RhdHVzICYgMHgwMykgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byB3YWl0IGZv
ciBBVVggKHN0YXR1czogMHgleCkiLAorCQkJICAgICAgc3RhdHVzKTsKKwkJcmV0dXJuIC1FVElN
RURPVVQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK2VudW0gYXV4X2NtZF90eXBlIHsKKwlDTURf
QVVYX05BVElWRV9SRUFEID0gMHgwLAorCUNNRF9BVVhfTkFUSVZFX1dSSVRFID0gMHg1LAorCUNN
RF9BVVhfSTJDX0VESURfUkVBRCA9IDB4QiwKK307CisKK2VudW0gYXV4X2NtZF9yZXBseSB7CisJ
UkVQTFlfQUNLLAorCVJFUExZX05BQ0ssCisJUkVQTFlfREVGRVIsCit9OworCitzdGF0aWMgc3Np
emVfdCBpdDY1MDVfYXV4X2RvX3RyYW5zZmVyKHN0cnVjdCBpdDY1MDUgKml0NjUwNSwKKwkJCQkg
ICAgICBlbnVtIGF1eF9jbWRfdHlwZSBjbWQsCisJCQkJICAgICAgdW5zaWduZWQgaW50IGFkZHJl
c3MsIHU4ICpidWZmZXIsCisJCQkJICAgICAgc2l6ZV90IHNpemUsIGVudW0gYXV4X2NtZF9yZXBs
eSAqcmVwbHkpCit7CisJaW50IHJldDsKKwlpbnQgaTsKKwlpbnQgc3RhdHVzLCB2YWw7CisKKwlp
ZiAoY21kID09IENNRF9BVVhfSTJDX0VESURfUkVBRCkgeworCQkvKiBEUCBBVVggRURJRCBGSUZP
IGhhcyBtYXhpbXVtIGxlbmd0aCBvZiAxNiBieXRlcy4gKi8KKwkJc2l6ZSA9IG1pbl90KHNpemVf
dCwgc2l6ZSwgQVVYX0ZJRk9fTUFYX1NJWkUpOworCQkvKiBFbmFibGUgQVVYIEZJRk8gcmVhZCBi
YWNrIGFuZCBjbGVhciBGSUZPICovCisJCWRwdHh3cihpdDY1MDUsIDB4MjMsIDB4QzMpOworCQlk
cHR4d3IoaXQ2NTA1LCAweDIzLCAweEMyKTsKKwl9IGVsc2UgeworCQkvKiBUaGUgRFAgQVVYIHRy
YW5zbWl0IGJ1ZmZlciBoYXMgNCBieXRlcy4gKi8KKwkJc2l6ZSA9IG1pbl90KHNpemVfdCwgc2l6
ZSwgNCk7CisJCWRwdHh3cihpdDY1MDUsIDB4MjMsIDB4NDIpOworCX0KKworCS8qIFN0YXJ0IEFk
ZHJlc3NbNzowXSAqLworCWRwdHh3cihpdDY1MDUsIDB4MjQsIChhZGRyZXNzID4+IDApICYgMHhG
Rik7CisJLyogU3RhcnQgQWRkcmVzc1sxNTo4XSAqLworCWRwdHh3cihpdDY1MDUsIDB4MjUsIChh
ZGRyZXNzID4+IDgpICYgMHhGRik7CisJLyogV3JpdGVOdW1bMzowXStTdGFydEFkclsxOToxNl0g
Ki8KKwlkcHR4d3IoaXQ2NTA1LCAweDI2LCAoKGFkZHJlc3MgPj4gMTYpICYgMHgwRikgfCAoKHNp
emUgLSAxKSA8PCA0KSk7CisKKwlpZiAoY21kID09IENNRF9BVVhfTkFUSVZFX1dSSVRFKQorCQly
ZWdtYXBfYnVsa193cml0ZShpdDY1MDUtPnJlZ21hcCwgMHgyNywgYnVmZmVyLCBzaXplKTsKKwor
CS8qIEF1eCBGaXJlICovCisJZHB0eHdyKGl0NjUwNSwgMHgyQiwgY21kKTsKKworCXJldCA9IGRw
dHhfYXV4d2FpdChpdDY1MDUpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJcmV0
ID0gZHB0eHJkKGl0NjUwNSwgMHg5RiwgJnN0YXR1cyk7CisJaWYgKHJldCA8IDApCisJCXJldHVy
biByZXQ7CisKKwlzd2l0Y2ggKChzdGF0dXMgPj4gNikgJiAweDMpIHsKKwljYXNlIDA6CisJCSpy
ZXBseSA9IFJFUExZX0FDSzsKKwkJYnJlYWs7CisJY2FzZSAxOgorCQkqcmVwbHkgPSBSRVBMWV9O
QUNLOworCQlyZXR1cm4gMDsKKwljYXNlIDI6CisJCSpyZXBseSA9IFJFUExZX0RFRkVSOworCQly
ZXR1cm4gMDsKKwljYXNlIDM6CisJCXJldHVybiAtRVRJTUVET1VUOworCX0KKworCWlmIChjbWQg
PT0gQ01EX0FVWF9OQVRJVkVfV1JJVEUpCisJCWdvdG8gb3V0OworCisJaWYgKGNtZCA9PSBDTURf
QVVYX0kyQ19FRElEX1JFQUQpIHsKKwkJZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykgeworCQkJ
cmV0ID0gZHB0eHJkKGl0NjUwNSwgMHgyRiwgJnZhbCk7CisJCQlpZiAocmV0IDwgMCkKKwkJCQly
ZXR1cm4gcmV0OworCQkJYnVmZmVyW2ldID0gdmFsOworCQl9CisJfSBlbHNlIHsKKwkJZm9yIChp
ID0gMDsgaSA8IHNpemU7IGkrKykgeworCQkJcmV0ID0gZHB0eHJkKGl0NjUwNSwgMHgyQyArIGks
ICZ2YWwpOworCQkJaWYgKHJldCA8IDApCisJCQkJcmV0dXJuIHJldDsKKwkJCWJ1ZmZlcltzaXpl
IC0gMSAtIGldID0gdmFsOworCQl9CisJfQorCitvdXQ6CisJZHB0eHdyKGl0NjUwNSwgMHgyMywg
MHg0MCk7CisJcmV0dXJuIHNpemU7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGl0NjUwNV9hdXhfdHJh
bnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwKKwkJCQkgICBzdHJ1Y3QgZHJtX2RwX2F1eF9t
c2cgKm1zZykKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBjb250YWluZXJfb2YoYXV4LCBz
dHJ1Y3QgaXQ2NTA1LCBhdXgpOworCXU4IGNtZDsKKwlib29sIGlzX2kyYyA9ICEobXNnLT5yZXF1
ZXN0ICYgRFBfQVVYX05BVElWRV9XUklURSk7CisJaW50IHJldDsKKwllbnVtIGF1eF9jbWRfcmVw
bHkgcmVwbHk7CisKKwkvKiBJVDY1MDUgZG9lc24ndCBzdXBwb3J0IGFyYml0cmFyeSBJMkMgcmVh
ZCAvIHdyaXRlLiAqLworCWlmIChpc19pMmMpCisJCXJldHVybiAtRUlOVkFMOworCisJc3dpdGNo
IChtc2ctPnJlcXVlc3QpIHsKKwljYXNlIERQX0FVWF9OQVRJVkVfUkVBRDoKKwkJY21kID0gQ01E
X0FVWF9OQVRJVkVfUkVBRDsKKwkJYnJlYWs7CisJY2FzZSBEUF9BVVhfTkFUSVZFX1dSSVRFOgor
CQljbWQgPSBDTURfQVVYX05BVElWRV9XUklURTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0
dXJuIC1FSU5WQUw7CisJfQorCisJcmV0ID0gaXQ2NTA1X2F1eF9kb190cmFuc2ZlcihpdDY1MDUs
IGNtZCwgbXNnLT5hZGRyZXNzLCBtc2ctPmJ1ZmZlciwKKwkJCQkgICAgIG1zZy0+c2l6ZSwgJnJl
cGx5KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCXN3aXRjaCAocmVwbHkpIHsK
KwljYXNlIFJFUExZX0FDSzoKKwkJbXNnLT5yZXBseSA9IERQX0FVWF9OQVRJVkVfUkVQTFlfQUNL
OworCQlicmVhazsKKwljYXNlIFJFUExZX05BQ0s6CisJCW1zZy0+cmVwbHkgPSBEUF9BVVhfTkFU
SVZFX1JFUExZX05BQ0s7CisJCWJyZWFrOworCWNhc2UgUkVQTFlfREVGRVI6CisJCW1zZy0+cmVw
bHkgPSBEUF9BVVhfTkFUSVZFX1JFUExZX0RFRkVSOworCQlicmVhazsKKwl9CisKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgaW50IGRwdHhfZ2V0X2VkaWRibG9jayh2b2lkICpkYXRhLCB1OCAq
YnVmLCB1bnNpZ25lZCBpbnQgYmxvY2tubywKKwkJCSAgICAgIHNpemVfdCBsZW4pCit7CisJc3Ry
dWN0IGl0NjUwNSAqaXQ2NTA1ID0gZGF0YTsKKwlpbnQgb2Zmc2V0LCByZXQ7CisJc3RydWN0IGRl
dmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisJZW51bSBhdXhfY21kX3JlcGx5IHJl
cGx5OworCisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MDgsIDB4MDgpOworCWRwdHhzZXQoaXQ2
NTA1LCAweDA1LCAweDA4LCAweDAwKTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJibG9j
a251bSA9ICVkIiwgYmxvY2tubyk7CisKKwlmb3IgKG9mZnNldCA9IDA7IG9mZnNldCA8IEVESURf
TEVOR1RIOyBvZmZzZXQgKz0gOCkgeworCQlyZXQgPSBpdDY1MDVfYXV4X2RvX3RyYW5zZmVyKGl0
NjUwNSwgQ01EX0FVWF9JMkNfRURJRF9SRUFELAorCQkJCQkgICAgIGJsb2Nrbm8gKiBFRElEX0xF
TkdUSCArIG9mZnNldCwKKwkJCQkJICAgICBidWYgKyBvZmZzZXQsIDgsICZyZXBseSk7CisJCWlm
IChyZXQgPCAwKQorCQkJcmV0dXJuIHJldDsKKwkJaWYgKHJlcGx5ICE9IFJFUExZX0FDSykKKwkJ
CXJldHVybiAtRUlPOworCisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlsweCUwMnhdOiAl
OHBoIiwgb2Zmc2V0LAorCQkJCSAgICAgYnVmICsgb2Zmc2V0KTsKKwl9CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBpdDY1MDVfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gY29ubmVjdG9yX3RvX2l0NjUw
NShjb25uZWN0b3IpOworCWludCBlcnIsIG51bV9tb2RlcyA9IDA7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpdDY1MDUtPnRyYWluX2ZhaWxfaHBkID0g
VFJBSU5GQUlMSFBEOworCWlmIChpdDY1MDUtPmVkaWQpCisJCXJldHVybiBkcm1fYWRkX2VkaWRf
bW9kZXMoY29ubmVjdG9yLCBpdDY1MDUtPmVkaWQpOworCW11dGV4X2xvY2soJml0NjUwNS0+bW9k
ZV9sb2NrKTsKKworCWl0NjUwNV9kdW1wKGl0NjUwNSk7CisJZHB0eF9kZWJ1Z19wcmludChpdDY1
MDUsIDB4OUYsICJhdXggc3RhdHVzIik7CisJaXQ2NTA1LT5lZGlkID0KKwkJZHJtX2RvX2dldF9l
ZGlkKCZpdDY1MDUtPmNvbm5lY3RvciwgZHB0eF9nZXRfZWRpZGJsb2NrLCBpdDY1MDUpOworCWlm
ICghaXQ2NTA1LT5lZGlkKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHJlYWQg
RURJRCIpOworCQlnb3RvIHVubG9jazsKKwl9CisKKwllcnIgPSBkcm1fY29ubmVjdG9yX3VwZGF0
ZV9lZGlkX3Byb3BlcnR5KGNvbm5lY3RvciwgaXQ2NTA1LT5lZGlkKTsKKwlpZiAoZXJyKSB7CisJ
CURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHVwZGF0ZSBFRElEIHByb3BlcnR5OiAlZCIs
IGVycik7CisJCWdvdG8gdW5sb2NrOworCX0KKworCW51bV9tb2RlcyA9IGRybV9hZGRfZWRpZF9t
b2Rlcyhjb25uZWN0b3IsIGl0NjUwNS0+ZWRpZCk7CisKK3VubG9jazoKKwltdXRleF91bmxvY2so
Jml0NjUwNS0+bW9kZV9sb2NrKTsKKworCXJldHVybiBudW1fbW9kZXM7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MgaXQ2NTA1X2Nvbm5lY3Rvcl9o
ZWxwZXJfZnVuY3MgPSB7CisJLmdldF9tb2RlcyA9IGl0NjUwNV9nZXRfbW9kZXMsCit9OworCitz
dGF0aWMgZW51bSBkcm1fY29ubmVjdG9yX3N0YXR1cyBpdDY1MDVfZGV0ZWN0KHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCSAgICAgICBib29sIGZvcmNlKQoreworCXN0cnVj
dCBpdDY1MDUgKml0NjUwNSA9IGNvbm5lY3Rvcl90b19pdDY1MDUoY29ubmVjdG9yKTsKKworCWlm
IChncGlvZF9nZXRfdmFsdWUoaXQ2NTA1LT5wZGF0YS5ncGlvZF9ocGQpKQorCQlyZXR1cm4gY29u
bmVjdG9yX3N0YXR1c19kaXNjb25uZWN0ZWQ7CisKKwlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19j
b25uZWN0ZWQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9mdW5jcyBp
dDY1MDVfY29ubmVjdG9yX2Z1bmNzID0geworCS5maWxsX21vZGVzID0gZHJtX2hlbHBlcl9wcm9i
ZV9zaW5nbGVfY29ubmVjdG9yX21vZGVzLAorCS5kZXRlY3QgPSBpdDY1MDVfZGV0ZWN0LAorCS5k
ZXN0cm95ID0gZHJtX2Nvbm5lY3Rvcl9jbGVhbnVwLAorCS5yZXNldCA9IGRybV9hdG9taWNfaGVs
cGVyX2Nvbm5lY3Rvcl9yZXNldCwKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGRybV9hdG9t
aWNfaGVscGVyX2Nvbm5lY3Rvcl9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0
YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX2Rlc3Ryb3lfc3RhdGUsCit9OworCitz
dGF0aWMgaW50IGl0NjUwNV9leHRjb25fbm90aWZpZXIoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpz
ZWxmLAorCQkJCSAgdW5zaWduZWQgbG9uZyBldmVudCwgdm9pZCAqcHRyKQoreworCXN0cnVjdCBp
dDY1MDUgKml0NjUwNSA9IGNvbnRhaW5lcl9vZihzZWxmLCBzdHJ1Y3QgaXQ2NTA1LCBldmVudF9u
Yik7CisKKwlzY2hlZHVsZV93b3JrKCZpdDY1MDUtPmV4dGNvbl93cSk7CisJcmV0dXJuIE5PVElG
WV9ET05FOworfQorCitzdGF0aWMgdm9pZCBpdDY1MDVfZXh0Y29uX3dvcmsoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGNvbnRhaW5lcl9vZih3
b3JrLCBzdHJ1Y3QgaXQ2NTA1LCBleHRjb25fd3EpOworCWludCBzdGF0ZSA9IGV4dGNvbl9nZXRf
c3RhdGUoaXQ2NTA1LT5leHRjb24sIEVYVENPTl9ESVNQX0RQKTsKKwl1bnNpZ25lZCBpbnQgcHdy
b2ZmcmV0cnkgPSAwOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2
OworCisJaWYgKGl0NjUwNS0+ZHJ2X2hvbGQpCisJCXJldHVybjsKKwltdXRleF9sb2NrKCZpdDY1
MDUtPmxvY2spOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkVYVENPTl9ESVNQX0RQID0g
MHglMDJ4Iiwgc3RhdGUpOworCWlmIChzdGF0ZSA+IDApIHsKKwkJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAic3RhcnQgdG8gcG93ZXIgb24iKTsKKwkJbXNsZWVwKDEwMDApOworCQlpdDY1MDVf
cG93ZXJvbihpdDY1MDUpOworCQlpZiAoIWRwdHhfZ2V0c2lua2hwZChpdDY1MDUpKQorCQkJaXQ2
NTA1X3Rlcm1pbmF0aW9uX29mZihpdDY1MDUpOworCX0gZWxzZSB7CisJCWlmIChpdDY1MDUtPmVu
X3B3cm9ub2ZmKSB7CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJzdGFydCB0byBwb3dl
ciBvZmYiKTsKKwkJCXdoaWxlIChpdDY1MDVfcG93ZXJvZmYoaXQ2NTA1KSAmJgorCQkJICAgICAg
IHB3cm9mZnJldHJ5KysgPCBQV1JPRkZSRVRSWVRJTUUpIHsKKwkJCQlEUk1fREVWX0RFQlVHX0RS
SVZFUihkZXYsCisJCQkJCQkgICAgICJwb3dlciBvZmYgZmFpbCAlZCB0aW1lcyIsCisJCQkJCQkg
ICAgIHB3cm9mZnJldHJ5KTsKKwkJCX0KKwkJCWRybV9oZWxwZXJfaHBkX2lycV9ldmVudChpdDY1
MDUtPmNvbm5lY3Rvci5kZXYpOworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAicG93ZXIg
b2ZmIGl0NjUwNSBzdWNjZXNzISIpOworCQl9CisJfQorCW11dGV4X3VubG9jaygmaXQ2NTA1LT5s
b2NrKTsKK30KKworc3RhdGljIGludCBpdDY1MDVfdXNlX25vdGlmaWVyX21vZHVsZShzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJaW50IHJldDsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2
NTA1LT5jbGllbnQtPmRldjsKKworCWl0NjUwNS0+ZXZlbnRfbmIubm90aWZpZXJfY2FsbCA9IGl0
NjUwNV9leHRjb25fbm90aWZpZXI7CisJSU5JVF9XT1JLKCZpdDY1MDUtPmV4dGNvbl93cSwgaXQ2
NTA1X2V4dGNvbl93b3JrKTsKKwlyZXQgPSBkZXZtX2V4dGNvbl9yZWdpc3Rlcl9ub3RpZmllcigm
aXQ2NTA1LT5jbGllbnQtPmRldiwKKwkJCQkJICAgIGl0NjUwNS0+ZXh0Y29uLCBFWFRDT05fRElT
UF9EUCwKKwkJCQkJICAgICZpdDY1MDUtPmV2ZW50X25iKTsKKwlpZiAocmV0KSB7CisJCURSTV9E
RVZfRVJST1IoZGV2LCAiZmFpbGVkIHRvIHJlZ2lzdGVyIG5vdGlmaWVyIGZvciBEUCIpOworCQly
ZXR1cm4gcmV0OworCX0KKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpdDY1MDVfYnJpZGdl
X2F0dGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBpdDY1MDUgKml0
NjUwNSA9IGJyaWRnZV90b19pdDY1MDUoYnJpZGdlKTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJ
aW50IGVycjsKKworCWRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCWlmICghYnJpZGdlLT5l
bmNvZGVyKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiUGFyZW50IGVuY29kZXIgb2JqZWN0IG5v
dCBmb3VuZCIpOworCQlyZXR1cm4gLUVOT0RFVjsKKwl9CisKKwllcnIgPSBkcm1fY29ubmVjdG9y
X2luaXQoYnJpZGdlLT5kZXYsICZpdDY1MDUtPmNvbm5lY3RvciwKKwkJCQkgJml0NjUwNV9jb25u
ZWN0b3JfZnVuY3MsCisJCQkJIERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNwbGF5UG9ydCk7CisJaWYg
KGVyciA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBj
b25uZWN0b3I6ICVkIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlkcm1fY29ubmVjdG9y
X2hlbHBlcl9hZGQoJml0NjUwNS0+Y29ubmVjdG9yLAorCQkJCSAmaXQ2NTA1X2Nvbm5lY3Rvcl9o
ZWxwZXJfZnVuY3MpOworCisJaXQ2NTA1LT5jb25uZWN0b3IucG9sbGVkID0gRFJNX0NPTk5FQ1RP
Ul9QT0xMX0hQRDsKKworCWVyciA9IGRybV9jb25uZWN0b3JfYXR0YWNoX2VuY29kZXIoJml0NjUw
NS0+Y29ubmVjdG9yLCBicmlkZ2UtPmVuY29kZXIpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9E
RVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIGxpbmsgdXAgY29ubmVjdG9yIHRvIGVuY29kZXI6ICVk
IiwKKwkJCSAgICAgIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJZXJyID0gZHJtX2Nvbm5l
Y3Rvcl9yZWdpc3RlcigmaXQ2NTA1LT5jb25uZWN0b3IpOworCWlmIChlcnIgPCAwKSB7CisJCURS
TV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHJlZ2lzdGVyIGNvbm5lY3RvcjogJWQiLCBlcnIp
OworCQlyZXR1cm4gZXJyOworCX0KKworCWVyciA9IGl0NjUwNV91c2Vfbm90aWZpZXJfbW9kdWxl
KGl0NjUwNSk7CisJaWYgKGVyciA8IDApIHsKKwkJZHJtX2Nvbm5lY3Rvcl91bnJlZ2lzdGVyKCZp
dDY1MDUtPmNvbm5lY3Rvcik7CisJCXJldHVybiBlcnI7CisJfQorCXNjaGVkdWxlX3dvcmsoJml0
NjUwNS0+ZXh0Y29uX3dxKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBpdDY1MDVf
YnJpZGdlX2RldGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBpdDY1
MDUgKml0NjUwNSA9IGJyaWRnZV90b19pdDY1MDUoYnJpZGdlKTsKKworCWRldm1fZXh0Y29uX3Vu
cmVnaXN0ZXJfbm90aWZpZXIoJml0NjUwNS0+Y2xpZW50LT5kZXYsIGl0NjUwNS0+ZXh0Y29uLAor
CQkJCQlFWFRDT05fRElTUF9EUCwgJml0NjUwNS0+ZXZlbnRfbmIpOworCWZsdXNoX3dvcmsoJml0
NjUwNS0+ZXh0Y29uX3dxKTsKKwlkcm1fY29ubmVjdG9yX3VucmVnaXN0ZXIoJml0NjUwNS0+Y29u
bmVjdG9yKTsKK30KKworc3RhdGljIGVudW0gZHJtX21vZGVfc3RhdHVzCitpdDY1MDVfYnJpZGdl
X21vZGVfdmFsaWQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCSBjb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKK3sKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwkJcmV0dXJuIE1PREVfTk9fSU5URVJMQUNFOworCisJLyogTWF4IDEy
MDBwIGF0IDUuNCBHaHosIG9uZSBsYW5lICovCisJaWYgKG1vZGUtPmNsb2NrID4gTUFYUENMSykK
KwkJcmV0dXJuIE1PREVfQ0xPQ0tfSElHSDsKKworCXJldHVybiBNT0RFX09LOworfQorCitzdGF0
aWMgaW50IGl0NjUwNV9zZW5kX3ZpZGVvX2luZm9mcmFtZShzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUs
CisJCQkJICAgICAgIHN0cnVjdCBoZG1pX2F2aV9pbmZvZnJhbWUgKmZyYW1lKQoreworCXU4IGJ1
ZmZlcltIRE1JX0lORk9GUkFNRV9IRUFERVJfU0laRSArIEhETUlfQVZJX0lORk9GUkFNRV9TSVpF
XTsKKwlpbnQgZXJyOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2
OworCisJZXJyID0gaGRtaV9hdmlfaW5mb2ZyYW1lX3BhY2soZnJhbWUsIGJ1ZmZlciwgc2l6ZW9m
KGJ1ZmZlcikpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVk
IHRvIHBhY2sgQVZJIGluZm9mcmFtZTogJWRcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQor
CisJZXJyID0gZHB0eHNldChpdDY1MDUsIDB4ZTgsIDB4MDEsIDB4MDApOworCWlmIChlcnIpCisJ
CXJldHVybiBlcnI7CisKKwllcnIgPSByZWdtYXBfYnVsa193cml0ZShpdDY1MDUtPnJlZ21hcCwg
MHhlOSwKKwkJCQlidWZmZXIgKyBIRE1JX0lORk9GUkFNRV9IRUFERVJfU0laRSwKKwkJCQlmcmFt
ZS0+bGVuZ3RoKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gZHB0eHNldChp
dDY1MDUsIDB4ZTgsIDB4MDEsIDB4MDEpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2JyaWRnZV9tb2RlX3NldChzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2Rl
LAorCQkJCSAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKQoreworCXN0
cnVjdCBpdDY1MDUgKml0NjUwNSA9IGJyaWRnZV90b19pdDY1MDUoYnJpZGdlKTsKKwlzdHJ1Y3Qg
aGRtaV9hdmlfaW5mb2ZyYW1lIGZyYW1lOworCWludCBlcnI7CisJc3RydWN0IGRldmljZSAqZGV2
ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwltdXRleF9sb2NrKCZpdDY1MDUtPm1vZGVfbG9j
ayk7CisJZXJyID0gZHJtX2hkbWlfYXZpX2luZm9mcmFtZV9mcm9tX2Rpc3BsYXlfbW9kZSgmZnJh
bWUsIGFkanVzdGVkX21vZGUsCisJCQkJCQkgICAgICAgZmFsc2UpOworCWlmIChlcnIpIHsKKwkJ
RFJNX0RFVl9FUlJPUihkZXYsICJGYWlsZWQgdG8gc2V0dXAgQVZJIGluZm9mcmFtZTogJWQiLCBl
cnIpOworCQlnb3RvIHVubG9jazsKKwl9CisJaXQ2NTA1LT52aWRfaW5mby5iYXNlLmlkID0gYWRq
dXN0ZWRfbW9kZS0+YmFzZS5pZDsKKwlzdHJsY3B5KGl0NjUwNS0+dmlkX2luZm8ubmFtZSwgYWRq
dXN0ZWRfbW9kZS0+bmFtZSwKKwkJRFJNX0RJU1BMQVlfTU9ERV9MRU4pOworCWl0NjUwNS0+dmlk
X2luZm8udHlwZSA9IGFkanVzdGVkX21vZGUtPnR5cGU7CisJaXQ2NTA1LT52aWRfaW5mby5mbGFn
cyA9IGFkanVzdGVkX21vZGUtPmZsYWdzOworCWVyciA9IGl0NjUwNV9zZW5kX3ZpZGVvX2luZm9m
cmFtZShpdDY1MDUsICZmcmFtZSk7CisJaWYgKGVycikKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJG
YWlsZWQgdG8gc2VuZCBBVkkgaW5mb2ZyYW1lOiAlZCIsIGVycik7CisKK3VubG9jazoKKwltdXRl
eF91bmxvY2soJml0NjUwNS0+bW9kZV9sb2NrKTsKK30KKworc3RhdGljIHZvaWQgZHB0eF9zZXRf
YXVkX2ZtdChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IGF1ZHNyYzsK
KwkvKiBJMlMgTU9ERSAqLworCWRwdHh3cihpdDY1MDUsIDB4QjksCisJICAgICAgIChpdDY1MDUt
PmF1ZHdvcmRsZW5ndGggPDwgNSkgfCAoaXQ2NTA1LT5pMnNfZGF0YV9zZXEgPDwgNCkgfAorCQkg
ICAgICAgKGl0NjUwNS0+aTJzX3dzX2NoYW5uZWwgPDwgMykgfAorCQkgICAgICAgKGl0NjUwNS0+
aTJzX2RhdGFfZGVsYXkgPDwgMikgfAorCQkgICAgICAgKGl0NjUwNS0+aTJzX2p1c3RpZmllZCA8
PCAxKSB8IGl0NjUwNS0+aTJzX2lucHV0X2ZtdCk7CisJaWYgKGl0NjUwNS0+YXVkX3NlbCA9PSBT
UERJRikgeworCQlkcHR4d3IoaXQ2NTA1LCAweEJBLCAweDAwKTsKKwkJLyogMHgzMCA9IDEyOCpG
UyAqLworCQlkcHR4c2V0KGl0NjUwNSwgMHgxMSwgMHhGMCwgMHgzMCk7CisJfSBlbHNlIHsKKwkJ
ZHB0eHdyKGl0NjUwNSwgMHhCQSwgMHhlNCk7CisJfQorCisJZHB0eHdyKGl0NjUwNSwgMHhCQiwg
MHgyMCk7CisJZHB0eHdyKGl0NjUwNSwgMHhCQywgMHgwMCk7CisJYXVkc3JjID0gMTsKKworCWlm
IChpdDY1MDUtPmF1ZF9jaCA+IDIpCisJCWF1ZHNyYyB8PSAyOworCisJaWYgKGl0NjUwNS0+YXVk
X2NoID4gNCkKKwkJYXVkc3JjIHw9IDQ7CisKKwlpZiAoaXQ2NTA1LT5hdWRfY2ggPiA2KQorCQlh
dWRzcmMgfD0gODsKKworCWF1ZHNyYyB8PSBpdDY1MDUtPmF1ZF9zZWwgPDwgNDsKKworCWRwdHh3
cihpdDY1MDUsIDB4QjgsIGF1ZHNyYyk7Cit9CisKK3N0YXRpYyB2b2lkIGRwdHhfc2V0X2F1ZF9j
aHN0cyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJZW51bSBpdDY1MDVfYXVkX2ZzIGF1ZGZz
ID0gaXQ2NTA1LT5hdWRfZnM7CisKKwkvKiBDaGFubmVsIFN0YXR1cyAqLworCWRwdHh3cihpdDY1
MDUsIDB4QkYsIGl0NjUwNS0+YXVkX3R5cGUgPDwgMSk7CisJZHB0eHdyKGl0NjUwNSwgMHhDMCwg
MHgwMCk7CisJZHB0eHdyKGl0NjUwNSwgMHhDMSwgMHgwMCk7CisJZHB0eHdyKGl0NjUwNSwgMHhD
MiwgYXVkZnMpOworCXN3aXRjaCAoaXQ2NTA1LT5hdWR3b3JkbGVuZ3RoKSB7CisJY2FzZSBBVUQx
NkJJVDoKKwkJZHB0eHdyKGl0NjUwNSwgMHhDMywgKH5hdWRmcyA8PCA0KSArIDB4MDIpOworCQli
cmVhazsKKworCWNhc2UgQVVEMThCSVQ6CisJCWRwdHh3cihpdDY1MDUsIDB4QzMsICh+YXVkZnMg
PDwgNCkgKyAweDA0KTsKKwkJYnJlYWs7CisKKwljYXNlIEFVRDIwQklUOgorCQlkcHR4d3IoaXQ2
NTA1LCAweEMzLCAofmF1ZGZzIDw8IDQpICsgMHgwMyk7CisJCWJyZWFrOworCisJY2FzZSBBVUQy
NEJJVDoKKwkJZHB0eHdyKGl0NjUwNSwgMHhDMywgKH5hdWRmcyA8PCA0KSArIDB4MEIpOworCQli
cmVhazsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGRwdHhfc2V0X2F1ZGlvX2luZm9mcmFtZShzdHJ1
Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xp
ZW50LT5kZXY7CisKKwlkcHR4d3IoaXQ2NTA1LCAweGY3LCBpdDY1MDUtPmF1ZF9jaCAtIDEpOwor
CisJc3dpdGNoIChpdDY1MDUtPmF1ZF9jaCkgeworCWNhc2UgMjoKKwkJZHB0eHdyKGl0NjUwNSwg
MHhGOSwgMHgwMCk7CisJCWJyZWFrOworCWNhc2UgMzoKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwg
MHgwMSk7CisJCWJyZWFrOworCWNhc2UgNDoKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwgMHgwMyk7
CisJCWJyZWFrOworCWNhc2UgNToKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwgMHgwNyk7CisJCWJy
ZWFrOworCWNhc2UgNjoKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwgMHgwQik7CisJCWJyZWFrOwor
CWNhc2UgNzoKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwgMHgwRik7CisJCWJyZWFrOworCWNhc2Ug
ODoKKwkJZHB0eHdyKGl0NjUwNSwgMHhGOSwgMHgxRik7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJ
CURSTV9ERVZfRVJST1IoZGV2LCAiYXVkaW8gY2hhbm5lbCBudW1iZXIgZXJyb3I6ICV1IiwKKwkJ
CSAgICAgIGl0NjUwNS0+YXVkX2NoKTsKKwl9CisJLyogRW5hYmxlIEF1ZGlvIEluZm9GcmFtZSAq
LworCWRwdHhzZXQoaXQ2NTA1LCAweEU4LCAweDIyLCAweDIyKTsKK30KKworc3RhdGljIHZvaWQg
aXQ2NTA1X3NldF9hdWRpbyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGRldmlj
ZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisJdW5zaWduZWQgaW50IHJlZ2JlOworCisJ
LyogQXVkaW8gQ2xvY2sgRG9tYWluIFJlc2V0ICovCisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4
MDIsIDB4MDIpOworCS8qIEF1ZGlvIG11dGUgKi8KKwlkcHR4c2V0KGl0NjUwNSwgMHhEMywgMHgy
MCwgMHgyMCk7CisJLyogUmVsZWFzZSBBdWRpbyBDbG9jayBEb21haW4gUmVzZXQgKi8KKwlkcHR4
c2V0KGl0NjUwNSwgMHgwNSwgMHgwMiwgMHgwMCk7CisKKwlkcHR4cmQoaXQ2NTA1LCAweEJFLCAm
cmVnYmUpOworCWlmIChyZWdiZSA9PSAweEZGKQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYs
ICJubyBhdWRpbyBpbnB1dCIpOworCWVsc2UKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
YXVkaW8gaW5wdXQgZnM6ICVkLiVkIGtIeiIsCisJCQkJICAgICA2NzUwIC8gcmVnYmUsIDY3NTAw
ICUgcmVnYmUpOworCWRwdHhfc2V0X2F1ZF9mbXQoaXQ2NTA1KTsKKwlkcHR4X3NldF9hdWRfY2hz
dHMoaXQ2NTA1KTsKKwlkcHR4X3NldF9hdWRpb19pbmZvZnJhbWUoaXQ2NTA1KTsKKworCS8qIEVu
YWJsZSBFbmhhbmNlZCBBdWRpbyBUaW1lU3RtcCBNb2RlICovCisJZHB0eHNldChpdDY1MDUsIDB4
RDQsIDB4MDQsIDB4MDQpOworCS8qIERpc2FibGUgRnVsbCBBdWRpbyBQYWNrZXQgKi8KKwlkcHR4
c2V0KGl0NjUwNSwgMHhCQiwgMHgxMCwgMHgwMCk7CisKKwlkcHR4d3IoaXQ2NTA1LCAweERFLCAw
eDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweERGLCAweDgwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweEUw
LCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHhCOCwgMHg4MCwgMHg4MCk7CisJZHB0eHNldChp
dDY1MDUsIDB4QjgsIDB4ODAsIDB4MDApOworCWRwdHhzZXQoaXQ2NTA1LCAweEQzLCAweDIwLCAw
eDAwKTsKK30KKworLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgorICogRFBDRCBSZWFkIGFuZCBFRElECisg
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqLworCitzdGF0aWMgdW5zaWduZWQgaW50IGRwdHhfZHBjZHJkKHN0
cnVjdCBpdDY1MDUgKml0NjUwNSwgdW5zaWduZWQgbG9uZyBvZmZzZXQpCit7CisJdTggdmFsdWU7
CisJaW50IHJldDsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsK
KworCXJldCA9IGRybV9kcF9kcGNkX3JlYWRiKCZpdDY1MDUtPmF1eCwgb2Zmc2V0LCAmdmFsdWUp
OworCWlmIChyZXQgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRFBDRCByZWFkIGZhaWxl
ZCBbMHgleF0gcmV0OiAlZCIsIG9mZnNldCwKKwkJCSAgICAgIHJldCk7CisJCXJldHVybiAwOwor
CX0KKwlyZXR1cm4gdmFsdWU7Cit9CisKK3N0YXRpYyBpbnQgZHB0eF9kcGNkd3Ioc3RydWN0IGl0
NjUwNSAqaXQ2NTA1LCB1bnNpZ25lZCBsb25nIG9mZnNldCwKKwkJICAgICAgIHVuc2lnbmVkIGxv
bmcgZGF0YWluKQoreworCWludCByZXQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+
Y2xpZW50LT5kZXY7CisKKwlyZXQgPSBkcm1fZHBfZHBjZF93cml0ZWIoJml0NjUwNS0+YXV4LCBv
ZmZzZXQsIGRhdGFpbik7CisJaWYgKHJldCA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJE
UENEIHdyaXRlIGZhaWxlZCBbMHgleF0gcmV0OiAlZCIsIG9mZnNldCwKKwkJCSAgICAgIHJldCk7
CisJCXJldHVybiByZXQ7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGl0NjUwNV9n
ZXRfZHBjZChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIGludCBvZmZzZXQsIHU4ICpkcGNkLCBpbnQg
bnVtKQoreworCWludCBpLCByZXQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xp
ZW50LT5kZXY7CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtOyBpICs9IDQpIHsKKwkJcmV0ID0gZHJt
X2RwX2RwY2RfcmVhZCgmaXQ2NTA1LT5hdXgsIG9mZnNldCArIGksIGRwY2QgKyBpLAorCQkJCSAg
ICAgICBtaW4obnVtIC0gaSwgNCkpOworCQlpZiAocmV0IDwgMCkKKwkJCXJldHVybiByZXQ7CisJ
fQorCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiRFBDRFsweCV4XSA9ICUqcGgiLCBvZmZz
ZXQsIG51bSwgZHBjZCk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9wYXJz
ZV9kcGNkKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwl1OCBkcGNkW0RQX1JFQ0VJVkVSX0NB
UF9TSVpFXTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKwlp
bnQgYmNhcHM7CisJc3RydWN0IGRybV9kcF9saW5rICpsaW5rID0gJml0NjUwNS0+bGluazsKKwor
CWRybV9kcF9saW5rX3Byb2JlKCZpdDY1MDUtPmF1eCwgbGluayk7CisJaXQ2NTA1X2dldF9kcGNk
KGl0NjUwNSwgRFBfRFBDRF9SRVYsIGRwY2QsIEFSUkFZX1NJWkUoZHBjZCkpOworCisJRFJNX0RF
Vl9ERUJVR19EUklWRVIoZGV2LCAiIyMjIyMjIyMjRFBDRCBSZXYuOiAlZC4lZCMjIyMjIyMjIyMj
IiwKKwkJCSAgICAgbGluay0+cmV2aXNpb24gPj4gNCwgbGluay0+cmV2aXNpb24gJiAweDBGKTsK
KworCXN3aXRjaCAobGluay0+cmF0ZSkgeworCWNhc2UgMTYyMDAwOgorCQlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsCisJCQkJICAgICAiTWF4aW11bSBMaW5rIFJhdGU6IDEuNjJHYnBzIHBlciBs
YW5lIik7CisJCWlmIChpdDY1MDUtPmhicikgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoCisJ
CQkJZGV2LCAiTm90IHN1cHBvcnQgSEJSIE1vZGUsIHdpbGwgdHJhaW4gTEJSIik7CisJCQlpdDY1
MDUtPmhiciA9IGZhbHNlOworCQl9IGVsc2UgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2
LCAiVHJhaW5pbmcgTEJSIik7CisJCX0KKwkJYnJlYWs7CisKKwljYXNlIDI3MDAwMDoKKwkJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LAorCQkJCSAgICAgIk1heGltdW0gTGluayBSYXRlOiAyLjdH
YnBzIHBlciBsYW5lIik7CisJCWlmICghaXQ2NTA1LT5oYnIpIHsKKwkJCURSTV9ERVZfREVCVUdf
RFJJVkVSKAorCQkJCWRldiwgIlN1cHBvcnQgSEJSIE1vZGUsIHdpbGwgdHJhaW4gTEJSIik7CisJ
CQlpdDY1MDUtPmhiciA9IGZhbHNlOworCQl9IGVsc2UgeworCQkJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAiVHJhaW5pbmcgSEJSIik7CisJCX0KKwkJYnJlYWs7CisKKwljYXNlIDU0MDAwMDoK
KwkJLyogVE9ETyhwaWhzdW4pOiBDaGVjayBpZiB0aGlzIGlzIGNvcnJlY3QuIEhCUiBoZXJlPyAq
LworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsCisJCQkJICAgICAiTWF4aW11bSBMaW5rIFJh
dGU6IDIuN0dicHMgcGVyIGxhbmUiKTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQlEUk1fREVW
X0VSUk9SKGRldiwgIlVua25vd24gTWF4aW11bSBMaW5rIFJhdGU6ICV1IiwKKwkJCSAgICAgIGxp
bmstPnJhdGUpOworCQlicmVhazsKKwl9CisKKwlpZiAobGluay0+bnVtX2xhbmVzID09IDEgfHwg
bGluay0+bnVtX2xhbmVzID09IDIgfHwKKwkgICAgbGluay0+bnVtX2xhbmVzID09IDQpIHsKKwkJ
RFJNX0RFVl9ERUJVR19EUklWRVIoCisJCQlkZXYsICJMYW5lIENvdW50OiAldSBsYW5lIiwgbGlu
ay0+bnVtX2xhbmVzKTsKKwkJaWYgKGxpbmstPm51bV9sYW5lcyA+IExBTkUpCisJCQlsaW5rLT5u
dW1fbGFuZXMgPSBMQU5FOworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJUcmFpbmluZyAl
dSBsYW5lIiwgbGluay0+bnVtX2xhbmVzKTsKKwl9IGVsc2UgeworCQlEUk1fREVWX0VSUk9SKGRl
diwgIkxhbmUgQ291bnQgRXJyb3I6ICV1IiwgbGluay0+bnVtX2xhbmVzKTsKKwl9CisKKwlpZiAo
bGluay0+Y2FwYWJpbGl0aWVzICYgRFBfTElOS19DQVBfRU5IQU5DRURfRlJBTUlORykKKwkJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU3VwcG9ydCBFbmhhbmNlZCBGcmFtaW5nIik7CisJZWxz
ZQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsCisJCQkJICAgICAiQ2FuIG5vdCBzdXBwb3J0
IEVuaGFuY2VkIEZyYW1pbmcgTW9kZSIpOworCisJaWYgKGRwY2RbRFBfTUFYX0RPV05TUFJFQURd
ICYgRFBfTUFYX0RPV05TUFJFQURfMF81KSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwK
KwkJCQkgICAgICJNYXhpbXVtIERvd24tU3ByZWFkOiAwLjUsIHN1cHBvcnQgU1NDISIpOworCX0g
ZWxzZSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwKKwkJCQkgICAgICJNYXhpbXVtIERv
d24tU3ByZWFkOiAwLCBObyBzdXBwb3J0IFNTQyEiKTsKKwkJaXQ2NTA1LT5lbl9zc2MgPSAwOwor
CX0KKworCWlmIChsaW5rLT5yZXZpc2lvbiA+PSAweDExICYmCisJICAgIGRwY2RbRFBfTUFYX0RP
V05TUFJFQURdICYgRFBfTk9fQVVYX0hBTkRTSEFLRV9MSU5LX1RSQUlOSU5HKQorCQlEUk1fREVW
X0RFQlVHX0RSSVZFUihkZXYsICJTdXBwb3J0IE5vIEFVWCBUcmFpbmluZyIpOworCWVsc2UKKwkJ
RFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiQ2FuIG5vdCBzdXBwb3J0IE5vIEFVWCBUcmFpbmlu
ZyIpOworCisJYmNhcHMgPSBkcHR4X2RwY2RyZChpdDY1MDUsIERQX0FVWF9IRENQX0JDQVBTKTsK
KwlpZiAoYmNhcHMgJiBEUF9CQ0FQU19IRENQX0NBUEFCTEUpIHsKKwkJRFJNX0RFVl9ERUJVR19E
UklWRVIoZGV2LCAiU2luayBzdXBwb3J0IEhEQ1AhIik7CisJCWl0NjUwNS0+Y3BfY2FwYWJsZSA9
IHRydWU7CisJfSBlbHNlIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU2luayBub3Qg
c3VwcG9ydCBIRENQISIpOworCQlpdDY1MDUtPmNwX2NhcGFibGUgPSBmYWxzZTsKKwkJaXQ2NTA1
LT5lbl9oZGNwID0gMDsKKwl9CisKKwlpZiAoYmNhcHMgJiBEUF9CQ0FQU19SRVBFQVRFUl9QUkVT
RU5UKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkRvd25zdHJlYW0gaXMgcmVwZWF0
ZXIhISIpOworCQlpdDY1MDUtPmRvd25zdHJlYW1fcmVwZWF0ZXIgPSB0cnVlOworCX0gZWxzZSB7
CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkRvd25zdHJlYW0gaXMgcmVjZWl2ZXIhISIp
OworCQlpdDY1MDUtPmRvd25zdHJlYW1fcmVwZWF0ZXIgPSBmYWxzZTsKKwl9Cit9CisKK3N0YXRp
YyB2b2lkIGl0NjUwNV9lbmFibGVfaGRjcChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJdTgg
YmtzdnNbNV0sIGM7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7
CisKKwkvKiBEaXNhYmxlIENQX0Rlc2lyZWQgKi8KKwlkcHR4c2V0KGl0NjUwNSwgMHgzOCwgMHgw
QiwgMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MTAsIDB4MTApOworCisJdXNsZWVw
X3JhbmdlKDEwMDAsIDE1MDApOworCWMgPSBkcHR4X2RwY2RyZChpdDY1MDUsIERQX0FVWF9IRENQ
X0JDQVBTKTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJEUENEWzB4NjgwMjhdOiAweCV4
XG4iLCBjKTsKKwlpZiAoIWMpCisJCXJldHVybjsKKworCWRwdHhzZXQoaXQ2NTA1LCAweDA1LCAw
eDEwLCAweDAwKTsKKwkvKiBEaXNhYmxlIENQX0Rlc2lyZWQgKi8KKwlkcHR4c2V0KGl0NjUwNSwg
MHgzOCwgMHgwMSwgMHgwMCk7CisJLyogVXNlIFIwJyAxMDBtcyB3YWl0aW5nICovCisJZHB0eHNl
dChpdDY1MDUsIDB4MzgsIDB4MDgsIDB4MDApOworCS8qIGNsZWFyIHRoZSByZXBlYXRlciBMaXN0
IENoayBEb25lIGFuZCBmYWlsIGJpdCAqLworCWRwdHhzZXQoaXQ2NTA1LCAweDM5LCAweDMwLCAw
eDAwKTsKKworCWl0NjUwNV9nZXRfZHBjZChpdDY1MDUsIERQX0FVWF9IRENQX0JLU1YsIGJrc3Zz
LCBBUlJBWV9TSVpFKGJrc3ZzKSk7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJTaW5r
IEJLU1YgPSAlNXBoIiwgYmtzdnMpOworCisJLyogU2VsZWN0IEFuIEdlbmVyYXRvciAqLworCWRw
dHhzZXQoaXQ2NTA1LCAweDNBLCAweDAxLCAweDAxKTsKKwkvKiBFbmFibGUgQW4gR2VuZXJhdG9y
ICovCisJZHB0eHNldChpdDY1MDUsIDB4M0EsIDB4MDIsIDB4MDIpOworCS8qIGRlbGF5MW1zKDEw
KTsqLworCXVzbGVlcF9yYW5nZSgxMDAwMCwgMTUwMDApOworCS8qIFN0b3AgQW4gR2VuZXJhdG9y
ICovCisJZHB0eHNldChpdDY1MDUsIDB4M0EsIDB4MDIsIDB4MDApOworCisJZHB0eHNldChpdDY1
MDUsIDB4MzgsIDB4MDEsIDB4MDEpOworCWRwdHhzZXQoaXQ2NTA1LCAweDM5LCAweDAxLCAweDAx
KTsKK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2xhbmVzcGVlZF9zZXR1cChzdHJ1Y3QgaXQ2NTA1
ICppdDY1MDUpCit7CisJaWYgKCFpdDY1MDUtPmhicikgeworCQlkcHR4c2V0KGl0NjUwNSwgMHgx
NiwgMHgwMSwgMHgwMSk7CisJCWRwdHhzZXQoaXQ2NTA1LCAweDVDLCAweDAyLCAweDAwKTsKKwl9
IGVsc2UgeworCQlkcHR4c2V0KGl0NjUwNSwgMHgxNiwgMHgwMSwgMHgwMCk7CisJCWRwdHhzZXQo
aXQ2NTA1LCAweDVDLCAweDAyLCAweDAyKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9s
YW5lX3N3YXAoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWludCBlcnI7CisJdW5pb24gZXh0
Y29uX3Byb3BlcnR5X3ZhbHVlIHByb3BlcnR5OworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1
MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKCFpdDY1MDUtPmxhbmVzd2FwX2Rpc2FibGVkKSB7CisJ
CWVyciA9IGV4dGNvbl9nZXRfcHJvcGVydHkoaXQ2NTA1LT5leHRjb24sIEVYVENPTl9ESVNQX0RQ
LAorCQkJCQkgIEVYVENPTl9QUk9QX1VTQl9UWVBFQ19QT0xBUklUWSwKKwkJCQkJICAmcHJvcGVy
dHkpOworCQlpZiAoZXJyKSB7CisJCQlEUk1fREVWX0VSUk9SKGRldiwgImdldCBwcm9wZXJ0eSBm
YWlsISIpOworCQkJcmV0dXJuOworCQl9CisJCWl0NjUwNS0+bGFuZXN3YXAgPSBwcm9wZXJ0eS5p
bnR2YWw7CisJfQorCisJZHB0eHNldChpdDY1MDUsIDB4MTYsIDB4MDgsIGl0NjUwNS0+bGFuZXN3
YXAgPyAweDA4IDogMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MTYsIDB4MDYsIChpdDY1MDUt
PmxpbmsubnVtX2xhbmVzIC0gMSkgPDwgMSk7CisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
aXQ2NTA1LT5sYW5lc3dhcCA9IDB4JXgiLCBpdDY1MDUtPmxhbmVzd2FwKTsKKworCWlmIChpdDY1
MDUtPmxhbmVzd2FwKSB7CisJCXN3aXRjaCAoaXQ2NTA1LT5saW5rLm51bV9sYW5lcykgeworCQlj
YXNlIDE6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1QywgMHhGMSwgMHg4MSk7CisJCQlicmVhazsK
KwkJY2FzZSAyOgorCQkJZHB0eHNldChpdDY1MDUsIDB4NUMsIDB4RjEsIDB4QzEpOworCQkJYnJl
YWs7CisJCWRlZmF1bHQ6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1QywgMHhGMSwgMHhGMSk7CisJ
CQlicmVhazsKKwkJfQorCX0gZWxzZSB7CisJCXN3aXRjaCAoaXQ2NTA1LT5saW5rLm51bV9sYW5l
cykgeworCQljYXNlIDE6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1QywgMHhGMSwgMHgxMSk7CisJ
CQlicmVhazsKKwkJY2FzZSAyOgorCQkJZHB0eHNldChpdDY1MDUsIDB4NUMsIDB4RjEsIDB4MzEp
OworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1QywgMHhGMSwg
MHhGMSk7CisJCQlicmVhazsKKwkJfQorCX0KK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2xhbmVf
Y29uZmlnKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlpdDY1MDVfbGFuZXNwZWVkX3NldHVw
KGl0NjUwNSk7CisJaXQ2NTA1X2xhbmVfc3dhcChpdDY1MDUpOworfQorCitzdGF0aWMgdm9pZCBp
dDY1MDVfc2V0X3NzYyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlkcHR4c2V0KGl0NjUwNSwgMHgxNiwgMHgx
MCwgaXQ2NTA1LT5lbl9zc2MgPDwgNCk7CisJaWYgKGl0NjUwNS0+ZW5fc3NjKSB7CisJCURSTV9E
RVZfREVCVUdfRFJJVkVSKGRldiwgIkVuYWJsZSAyN00gNDQ2MyBQUE0gU1NDIik7CisJCWRwdHhf
Y2hnYmFuayhpdDY1MDUsIDEpOworCQlkcHR4d3IoaXQ2NTA1LCAweDg4LCAweDllKTsKKwkJZHB0
eHdyKGl0NjUwNSwgMHg4OSwgMHgxYyk7CisJCWRwdHh3cihpdDY1MDUsIDB4OEEsIDB4NDIpOwor
CQlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwkJZHB0eHdyKGl0NjUwNSwgMHg1OCwgMHgwNyk7
CisJCWRwdHh3cihpdDY1MDUsIDB4NTksIDB4MjkpOworCQlkcHR4d3IoaXQ2NTA1LCAweDVBLCAw
eDAzKTsKKwkJLyogU3RhbXAgSW50ZXJydXB0IFN0ZXAgKi8KKwkJZHB0eHNldChpdDY1MDUsIDB4
RDQsIDB4MzAsIDB4MTApOworCQlkcHR4X2RwY2R3cihpdDY1MDUsIERQX0RPV05TUFJFQURfQ1RS
TCwgRFBfU1BSRUFEX0FNUF8wXzUpOworCX0gZWxzZSB7CisJCWRwdHhfZHBjZHdyKGl0NjUwNSwg
RFBfRE9XTlNQUkVBRF9DVFJMLCAweDAwKTsKKwkJZHB0eHNldChpdDY1MDUsIDB4RDQsIDB4MzAs
IDB4MDApOworCX0KK30KKworc3RhdGljIHZvaWQgcGNsa19waGFzZShzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUpCit7CisJZHB0eHNldChpdDY1MDUsIDB4MTAsIDB4MDMsIFBDTEtfREVMQVkpOworCWRw
dHhzZXQoaXQ2NTA1LCAweDEyLCAweDEwLCBQQ0xLX0lOViA8PCA0KTsKK30KKworc3RhdGljIHZv
aWQgYWZlX2RyaXZpbmdfc2V0dGluZyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisJdW5zaWduZWQgaW50IGFmZV9z
ZXR0aW5nOworCisJYWZlX3NldHRpbmcgPSBBRkVfU0VUVElORzsKKwlpZiAoYWZlX3NldHRpbmcg
Pj0gQVJSQVlfU0laRShhZmVfc2V0dGluZ190YWJsZSkpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYs
ICJhZmUgc2V0dGluZyB2YWx1ZSBlcnJvciBhbmQgdXNlIGRlZmF1bHQiKTsKKwkJYWZlX3NldHRp
bmcgPSAwOworCX0KKwlpZiAoYWZlX3NldHRpbmcpIHsKKwkJZHB0eF9jaGdiYW5rKGl0NjUwNSwg
MSk7CisJCWRwdHh3cihpdDY1MDUsIDB4N0UsIGFmZV9zZXR0aW5nX3RhYmxlW2FmZV9zZXR0aW5n
XVswXSk7CisJCWRwdHh3cihpdDY1MDUsIDB4N0YsIGFmZV9zZXR0aW5nX3RhYmxlW2FmZV9zZXR0
aW5nXVsxXSk7CisJCWRwdHh3cihpdDY1MDUsIDB4ODEsIGFmZV9zZXR0aW5nX3RhYmxlW2FmZV9z
ZXR0aW5nXVsyXSk7CisJCWRwdHhfY2hnYmFuayhpdDY1MDUsIDApOworCX0KK30KKworc3RhdGlj
IHZvaWQgZHB0eF9vdXRwdXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCS8qIGNoYW5nZSBi
YW5rIDAgKi8KKwlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY0
LCAweDEwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY1LCAweDgwKTsKKwlkcHR4d3IoaXQ2NTA1LCAw
eDY2LCAweDEwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY3LCAweDRGKTsKKwlkcHR4d3IoaXQ2NTA1
LCAweDY4LCAweDA5KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY5LCAweEJBKTsKKwlkcHR4d3IoaXQ2
NTA1LCAweDZBLCAweDNCKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZCLCAweDRCKTsKKwlkcHR4d3Io
aXQ2NTA1LCAweDZDLCAweDNFKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZELCAweDRGKTsKKwlkcHR4
d3IoaXQ2NTA1LCAweDZFLCAweDA5KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZGLCAweDU2KTsKKwlk
cHR4d3IoaXQ2NTA1LCAweDcwLCAweDBFKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDcxLCAweDAwKTsK
KwlkcHR4d3IoaXQ2NTA1LCAweDcyLCAweDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDczLCAweDRG
KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc0LCAweDA5KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc1LCAw
eDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc2LCAweDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc3
LCAweEU3KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc4LCAweDEwKTsKKwlkcHR4d3IoaXQ2NTA1LCAw
eEU4LCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHhDRSwgMHg3MCwgMHg2MCk7CisJZHB0eHdy
KGl0NjUwNSwgMHhDQSwgMHg0RCk7CisJZHB0eHdyKGl0NjUwNSwgMHhDOSwgMHhGNSk7CisJZHB0
eHdyKGl0NjUwNSwgMHg1QywgMHgwMik7CisKKwlkcm1fZHBfbGlua19wb3dlcl91cCgmaXQ2NTA1
LT5hdXgsICZpdDY1MDUtPmxpbmspOworCWRwdHhzZXQoaXQ2NTA1LCAweDU5LCAweDAxLCAweDAx
KTsKKwlkcHR4c2V0KGl0NjUwNSwgMHg1QSwgMHgwNSwgMHgwMSk7CisJZHB0eHdyKGl0NjUwNSwg
MHgxMiwgMHgwMSk7CisJZHB0eHdyKGl0NjUwNSwgMHhDQiwgMHgxNyk7CisJZHB0eHdyKGl0NjUw
NSwgMHgxMSwgMHgwOSk7CisJZHB0eHdyKGl0NjUwNSwgMHgyMCwgMHgyOCk7CisJZHB0eHNldChp
dDY1MDUsIDB4MjMsIDB4MzAsIDB4MDApOworCWRwdHhzZXQoaXQ2NTA1LCAweDNBLCAweDA0LCAw
eDA0KTsKKwlkcHR4c2V0KGl0NjUwNSwgMHgxNSwgMHgwMSwgMHgwMSk7CisJZHB0eHdyKGl0NjUw
NSwgMHgwQywgMHgwOCk7CisKKwlkcHR4c2V0KGl0NjUwNSwgMHg1RiwgMHgyMCwgMHgwMCk7CisJ
aXQ2NTA1X2xhbmVfY29uZmlnKGl0NjUwNSk7CisKKwlpdDY1MDVfc2V0X3NzYyhpdDY1MDUpOwor
CisJaWYgKGl0NjUwNS0+bGluay5jYXBhYmlsaXRpZXMgJiBEUF9MSU5LX0NBUF9FTkhBTkNFRF9G
UkFNSU5HKSB7CisJCWRwdHh3cihpdDY1MDUsIDB4RDMsIDB4MzMpOworCQlkcHR4X2RwY2R3cihp
dDY1MDUsIERQX0xBTkVfQ09VTlRfU0VULAorCQkJICAgIERQX0xBTkVfQ09VTlRfRU5IQU5DRURf
RlJBTUVfRU4pOworCX0gZWxzZSB7CisJCWRwdHh3cihpdDY1MDUsIDB4RDMsIDB4MzIpOworCX0K
KworCWRwdHhzZXQoaXQ2NTA1LCAweDE1LCAweDAyLCAweDAyKTsKKwlkcHR4c2V0KGl0NjUwNSwg
MHgxNSwgMHgwMiwgMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MDMsIDB4MDIpOwor
CWRwdHhzZXQoaXQ2NTA1LCAweDA1LCAweDAzLCAweDAwKTsKKworCS8qIHJlZzYwWzJdID0gSW5E
RFIgKi8KKwlkcHR4d3IoaXQ2NTA1LCAweDYwLCAweDQ0KTsKKwkvKiBNNDQ0QjI0IGZvcm1hdCAq
LworCWRwdHh3cihpdDY1MDUsIDB4NjIsIDB4MDEpOworCS8qIHNlbGVjdCBSR0IgQnlwYXNzIENT
QyAqLworCWRwdHh3cihpdDY1MDUsIDB4NjMsIDB4MDApOworCisJcGNsa19waGFzZShpdDY1MDUp
OworCWRwdHhzZXQoaXQ2NTA1LCAweDYxLCAweDAxLCAweDAxKTsKKwlkcHR4d3IoaXQ2NTA1LCAw
eDA2LCAweEZGKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA3LCAweEZGKTsKKwlkcHR4d3IoaXQ2NTA1
LCAweDA4LCAweEZGKTsKKworCWRwdHhzZXQoaXQ2NTA1LCAweGQzLCAweDMwLCAweDAwKTsKKwlk
cHR4c2V0KGl0NjUwNSwgMHhkNCwgMHg0MSwgMHg0MSk7CisJZHB0eHNldChpdDY1MDUsIDB4ZTgs
IDB4MTEsIDB4MTEpOworCisJYWZlX2RyaXZpbmdfc2V0dGluZyhpdDY1MDUpOworCWRwdHh3cihp
dDY1MDUsIDB4MTcsIDB4MDQpOworCWRwdHh3cihpdDY1MDUsIDB4MTcsIDB4MDEpOworfQorCitz
dGF0aWMgdm9pZCBkcHR4X3Byb2Nlc3Nfc3lzX3dhaXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQor
eworCWludCByZWcwZTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRl
djsKKworCWRwdHhyZChpdDY1MDUsIDB4MEUsICZyZWcwZSk7CisJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAiU1lTX1dBSVQgc3RhdGUgcmVnMGU9MHglMDJ4IiwgcmVnMGUpOworCisJaWYgKHJl
ZzBlICYgQklUKDQpKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF1dG8gTGluayBU
cmFpbmluZyBTdWNjZXNzLi4uIik7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkxpbmsg
U3RhdGU6IDB4JXgiLCByZWcwZSAmIDB4MUYpOworCQlpZiAoaXQ2NTA1LT5lbl9hdWRpbykgewor
CQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiRW5hYmxlIGF1ZGlvISIpOworCQkJaXQ2NTA1
X3NldF9hdWRpbyhpdDY1MDUpOworCQl9CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIml0
NjUwNS0+VmlkU3RhYmxlX0RvbmUgPSAlMDJ4IiwKKwkJCQkgICAgIGl0NjUwNS0+dmlkc3RhYmxl
X2RvbmUpOworCQlpZiAoaXQ2NTA1LT5jcF9jYXBhYmxlKSB7CisJCQlEUk1fREVWX0RFQlVHX0RS
SVZFUihkZXYsICJTdXBwb3J0IEhEQ1AiKTsKKwkJCWlmIChpdDY1MDUtPmVuX2hkY3ApIHsKKwkJ
CQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJFbmFibGUgSERDUCIpOworCQkJCWRwdHhfc3lz
X2NoZyhpdDY1MDUsIFNZU19SZUhEQ1ApOworCQkJfSBlbHNlIHsKKwkJCQlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICJEaXNhYmxlIEhEQ1AiKTsKKwkJCQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBT
WVNfTk9ST1ApOworCQkJfQorCQl9IGVsc2UgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2
LCAiTm90IHN1cHBvcnQgSERDUCIpOworCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX05PUk9Q
KTsKKwkJfQorCX0gZWxzZSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF1dG8gTGlu
ayBUcmFpbmluZyBmYWlsIHN0ZXAgJWQiLAorCQkJCSAgICAgaXQ2NTA1LT5jbnRmc20pOworCQlk
cHR4X2RlYnVnX3ByaW50KGl0NjUwNSwgMHgwRCwgInN5c3RlbSBzdGF0dXMiKTsKKwkJaWYgKGl0
NjUwNS0+Y250ZnNtID4gMCkgeworCQkJaXQ2NTA1LT5jbnRmc20tLTsKKwkJCWRwdHhfc3lzX2No
ZyhpdDY1MDUsIFNZU19BVVRPVFJBSU4pOworCQl9IGVsc2UgeworCQkJRFJNX0RFVl9ERUJVR19E
UklWRVIoZGV2LCAiQXV0byBUcmFpbmluZyBGYWlsICVkIHRpbWVzIiwKKwkJCQkJICAgICBUUkFJ
TkZBSUxDTlQpOworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU3lzIGNoYW5nZSB0byBT
WVNfSFBEIik7CisJCQlkcHR4X2RwY2R3cihpdDY1MDUsIERQX1RSQUlOSU5HX1BBVFRFUk5fU0VU
LCAweDAwKTsKKwkJCWlmIChpdDY1MDUtPnRyYWluX2ZhaWxfaHBkID4gMCkgeworCQkJCWl0NjUw
NS0+dHJhaW5fZmFpbF9ocGQtLTsKKwkJCQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBTWVNfSFBEKTsK
KwkJCX0gZWxzZSB7CisJCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX1RSQUlORkFJTCk7CisJ
CQl9CisJCX0KKwl9Cit9CisKK3N0YXRpYyB2b2lkIGRwdHhfc3lzX2ZzbShzdHJ1Y3QgaXQ2NTA1
ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJlZzBlOworCXN0cnVjdCBkZXZp
Y2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKGl0NjUwNS0+c3RhdHVzICE9
IFNZU19VTlBMVUcgJiYgIWRwdHhfZ2V0c2lua2hwZChpdDY1MDUpKQorCQlkcHR4X3N5c19jaGco
aXQ2NTA1LCBTWVNfVU5QTFVHKTsKKworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgInN0YXRl
OiAlcyIsIHN0YXRlX3N0cmluZ1tpdDY1MDUtPnN0YXR1c10pOworCXN3aXRjaCAoaXQ2NTA1LT5z
dGF0dXMpIHsKKwljYXNlIFNZU19VTlBMVUc6CisJCWRybV9oZWxwZXJfaHBkX2lycV9ldmVudChp
dDY1MDUtPmNvbm5lY3Rvci5kZXYpOworCQlicmVhazsKKworCWNhc2UgU1lTX0hQRDoKKwkJZHB0
eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4OUYsICJhdXggc3RhdHVzIik7CisJCWRybV9oZWxwZXJf
aHBkX2lycV9ldmVudChpdDY1MDUtPmNvbm5lY3Rvci5kZXYpOworCQlpdDY1MDVfaW5pdF9mc20o
aXQ2NTA1KTsKKwkJLyogR0VURFBDRCAqLworCQlpdDY1MDVfcGFyc2VfZHBjZChpdDY1MDUpOwor
CisJCS8qCisJCSAqIHRyYWluaW5nIGZhaWwgVFJBSU5GQUlMQ05UIHRpbWVzLAorCQkgKiB0aGVu
IGNoYW5nZSB0byBIUEQgdG8gcmVzdGFydAorCQkgKi8KKwkJaXQ2NTA1LT5jbnRmc20gPSBUUkFJ
TkZBSUxDTlQ7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIndpbGwgVHJhaW4gJXMgJWQg
bGFuZXMiLAorCQkJCSAgICAgaXQ2NTA1LT5oYnIgPyAiSEJSIiA6ICJMQlIiLAorCQkJCSAgICAg
aXQ2NTA1LT5saW5rLm51bV9sYW5lcyk7CisJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19BVVRP
VFJBSU4pOworCQlicmVhazsKKworCWNhc2UgU1lTX0FVVE9UUkFJTjoKKwkJZHB0eF9vdXRwdXQo
aXQ2NTA1KTsKKworCQkvKgorCQkgKiB3YWl0aW5nIGZvciB0cmFpbmluZyBkb3duIGZsYWcKKwkJ
ICogYmVjYXVzZSB3ZSBkb24ndCBrbm93CisJCSAqIGhvdyBsb25nIHRoaXMgc3RlcCB3aWxsIGJl
IGNvbXBsZXRlZAorCQkgKiBzbyB1c2Ugc3RlcCAxbXMgdG8gd2FpdAorCQkgKi8KKwkJZm9yIChp
ID0gMDsgaSA8IEZMQUdUUkFJTkRPV047IGkrKykgeworCQkJdXNsZWVwX3JhbmdlKDEwMDAsIDIw
MDApOworCQkJZHB0eHJkKGl0NjUwNSwgMHgwRSwgJnJlZzBlKTsKKwkJCWlmIChyZWcwZSAmIEJJ
VCg0KSkKKwkJCQlicmVhazsKKwkJfQorCisJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19XQUlU
KTsKKwkJYnJlYWs7CisKKwljYXNlIFNZU19XQUlUOgorCQlkcHR4X3Byb2Nlc3Nfc3lzX3dhaXQo
aXQ2NTA1KTsKKwkJYnJlYWs7CisKKwljYXNlIFNZU19SZUhEQ1A6CisJCW1zbGVlcCgyNDAwKTsK
KwkJZHB0eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4M0IsICJhcjBfbG93Iik7CisJCWRwdHhfZGVi
dWdfcHJpbnQoaXQ2NTA1LCAweDNDLCAiYXIwX2hpZ2giKTsKKwkJZHB0eF9kZWJ1Z19wcmludChp
dDY1MDUsIDB4NDUsICJicjBfbG93Iik7CisJCWRwdHhfZGVidWdfcHJpbnQoaXQ2NTA1LCAweDQ2
LCAiYnIwX2hpZ2giKTsKKwkJaXQ2NTA1X2VuYWJsZV9oZGNwKGl0NjUwNSk7CisJCURSTV9ERVZf
REVCVUdfRFJJVkVSKGRldiwgIlNZU19SZUhEQ1AgZW5kIik7CisJCWJyZWFrOworCisJY2FzZSBT
WVNfTk9ST1A6CisJCWJyZWFrOworCisJY2FzZSBTWVNfVFJBSU5GQUlMOgorCQlicmVhazsKKwor
CWRlZmF1bHQ6CisJCURSTV9ERVZfRVJST1IoZGV2LCAic3lzX3N0YXRlIGNoYW5nZSB0byB1bmtu
b3duX3N0YXRlOiAlZCIsCisJCQkgICAgICBpdDY1MDUtPnN0YXR1cyk7CisJCWJyZWFrOworCX0K
K30KKworc3RhdGljIGludCBzaGExX2RpZ2VzdChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIHU4ICpz
aGExX2lucHV0LCB1bnNpZ25lZCBpbnQgc2l6ZSwKKwkJICAgICAgIHU4ICpvdXRwdXRfYXYpCit7
CisJc3RydWN0IHNoYXNoX2Rlc2MgKmRlc2M7CisJc3RydWN0IGNyeXB0b19zaGFzaCAqdGZtOwor
CWludCBlcnI7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisK
Kwl0Zm0gPSBjcnlwdG9fYWxsb2Nfc2hhc2goInNoYTEiLCAwLCAwKTsKKwlpZiAoSVNfRVJSKHRm
bSkpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJjcnlwdG9fYWxsb2Nfc2hhc2ggc2hhMSBmYWls
ZWQiKTsKKwkJcmV0dXJuIFBUUl9FUlIodGZtKTsKKwl9CisJZGVzYyA9IGt6YWxsb2Moc2l6ZW9m
KCpkZXNjKSArIGNyeXB0b19zaGFzaF9kZXNjc2l6ZSh0Zm0pLCBHRlBfS0VSTkVMKTsKKwlpZiAo
IWRlc2MpIHsKKwkJY3J5cHRvX2ZyZWVfc2hhc2godGZtKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJ
fQorCisJZGVzYy0+dGZtID0gdGZtOworCWVyciA9IGNyeXB0b19zaGFzaF9kaWdlc3QoZGVzYywg
c2hhMV9pbnB1dCwgc2l6ZSwgb3V0cHV0X2F2KTsKKwlpZiAoZXJyKQorCQlEUk1fREVWX0VSUk9S
KGRldiwgImNyeXB0b19zaGFzaF9kaWdlc3Qgc2hhMSBmYWlsZWQiKTsKKworCWNyeXB0b19mcmVl
X3NoYXNoKHRmbSk7CisJa2ZyZWUoZGVzYyk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGlu
dCBpdDY1MDVfbWFrZXVwX3NoYTFfaW5wdXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWlu
dCBtc2djbnQgPSAwLCBpOworCXVuc2lnbmVkIGludCB2YWx1ZTsKKwl1OCBhbTBbOF0sIGJpbmZv
WzJdOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZHB0
eHNldChpdDY1MDUsIDB4M0EsIDB4MjAsIDB4MjApOworCWZvciAoaSA9IDA7IGkgPCA4OyBpKysp
IHsKKwkJZHB0eHJkKGl0NjUwNSwgMHg0QyArIGksICZ2YWx1ZSk7CisJCWFtMFtpXSA9IHZhbHVl
OworCX0KKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWFkIGFtMCA9ICU4cGgiLCBhbTAp
OworCWRwdHhzZXQoaXQ2NTA1LCAweDNBLCAweDIwLCAweDAwKTsKKworCWl0NjUwNV9nZXRfZHBj
ZChpdDY1MDUsIERQX0FVWF9IRENQX0JJTkZPLCBiaW5mbywgQVJSQVlfU0laRShiaW5mbykpOwor
CURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF0dGFjaGVkIGRldmljZXM6ICUwMngiLCBiaW5m
b1swXSAmIDB4N0YpOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiJXMgMTI3IGRldmlj
ZXMgYXJlIGF0dGFjaGVkIiwKKwkJCSAgICAgKGJpbmZvWzBdICYgQklUKDcpKSA/ICJvdmVyIiA6
ICJ1bmRlciIpOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgImRlcHRoLCBhdHRhY2hlZCBs
ZXZlbHM6ICUwMngiLAorCQkJICAgICBiaW5mb1sxXSAmIDB4MDcpOworCURSTV9ERVZfREVCVUdf
RFJJVkVSKGRldiwgIiVzIHRoYW4gc2V2ZW4gbGV2ZWxzIGNhc2NhZGVkIiwKKwkJCSAgICAgKGJp
bmZvWzFdICYgQklUKDMpKSA/ICJtb3JlIiA6ICJsZXNzIik7CisKKwlmb3IgKGkgPSAwOyBpIDwg
KGJpbmZvWzBdICYgMHg3Rik7IGkrKykgeworCQlpdDY1MDVfZ2V0X2RwY2QoaXQ2NTA1LCBEUF9B
VVhfSERDUF9LU1ZfRklGTyArIChpICUgMykgKiA1LAorCQkJCWl0NjUwNS0+c2hhaW5wdXQgKyBt
c2djbnQsIDUpOworCQltc2djbnQgKz0gNTsKKworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYs
ICJLU1YgTGlzdCAlZCBkZXZpY2UgOiAlNXBoIiwgaSwKKwkJCQkgICAgIGl0NjUwNS0+c2hhaW5w
dXQgKyBpICogNSk7CisJfQorCWl0NjUwNS0+c2hhaW5wdXRbbXNnY250KytdID0gYmluZm9bMF07
CisJaXQ2NTA1LT5zaGFpbnB1dFttc2djbnQrK10gPSBiaW5mb1sxXTsKKwlmb3IgKGkgPSAwOyBp
IDwgODsgaSsrKQorCQlpdDY1MDUtPnNoYWlucHV0W21zZ2NudCsrXSA9IGFtMFtpXTsKKworCURS
TV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlNIQSBNZXNzYWdlIENvdW50ID0gJWQiLCBtc2djbnQp
OworCXJldHVybiBtc2djbnQ7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9jaGVja19zaGExX3Jl
c3VsdChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IGksIHNoYXBhc3M7
CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlEUk1fREVW
X0RFQlVHX0RSSVZFUihkZXYsICJTSEEgY2FsY3VsYXRlIGNvbXBsZXRlIik7CisJZm9yIChpID0g
MDsgaSA8IDU7IGkrKykKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiYXYgJWQ6ICU0cGgi
LCBpLCBpdDY1MDUtPmF2W2ldKTsKKworCXNoYXBhc3MgPSAxOworCWZvciAoaSA9IDA7IGkgPCA1
OyBpKyspIHsKKwkJaXQ2NTA1X2dldF9kcGNkKGl0NjUwNSwgRFBfQVVYX0hEQ1BfVl9QUklNRShp
KSwgaXQ2NTA1LT5idltpXSwKKwkJCQk0KTsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
YnYgJWQ6ICU0cGgiLCBpLCBpdDY1MDUtPmJ2W2ldKTsKKwkJaWYgKChpdDY1MDUtPmJ2W2ldWzNd
ICE9IGl0NjUwNS0+YXZbaV1bMF0pIHx8CisJCSAgICAoaXQ2NTA1LT5idltpXVsyXSAhPSBpdDY1
MDUtPmF2W2ldWzFdKSB8fAorCQkgICAgKGl0NjUwNS0+YnZbaV1bMV0gIT0gaXQ2NTA1LT5hdltp
XVsyXSkgfHwKKwkJICAgIChpdDY1MDUtPmJ2W2ldWzBdICE9IGl0NjUwNS0+YXZbaV1bM10pKSB7
CisJCQlzaGFwYXNzID0gMDsKKwkJfQorCX0KKwlpZiAoc2hhcGFzcykgeworCQlEUk1fREVWX0RF
QlVHX0RSSVZFUihkZXYsICJTSEEgY2hlY2sgcmVzdWx0IHBhc3MhIik7CisJCWRwdHhzZXQoaXQ2
NTA1LCAweDM5LCBCSVQoNCksIEJJVCg0KSk7CisJfSBlbHNlIHsKKwkJRFJNX0RFVl9ERUJVR19E
UklWRVIoZGV2LCAiU0hBIGNoZWNrIHJlc3VsdCBmYWlsIik7CisJCWRwdHhzZXQoaXQ2NTA1LCAw
eDM5LCBCSVQoNSksIEJJVCg1KSk7CisJfQorfQorCitzdGF0aWMgdm9pZCB0b19mc21fc3RhdHVz
KHN0cnVjdCBpdDY1MDUgKml0NjUwNSwgZW51bSBzeXNfc3RhdHVzIHN0YXR1cykKK3sKKwl3aGls
ZSAoaXQ2NTA1LT5zdGF0dXMgIT0gc3RhdHVzICYmIGl0NjUwNS0+c3RhdHVzICE9IFNZU19UUkFJ
TkZBSUwpIHsKKwkJZHB0eF9zeXNfZnNtKGl0NjUwNSk7CisJCWlmIChpdDY1MDUtPnN0YXR1cyA9
PSBTWVNfVU5QTFVHKQorCQkJcmV0dXJuOworCX0KK30KKworc3RhdGljIHZvaWQgZ29fb25fZnNt
KHN0cnVjdCBpdDY1MDUgKml0NjUwNSk7CisKK3N0YXRpYyB1OCBkcF9saW5rX3N0YXR1cyhjb25z
dCB1OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVU19TSVpFXSwgaW50IHIpCit7CisJcmV0dXJu
IGxpbmtfc3RhdHVzW3IgLSBEUF9MQU5FMF8xX1NUQVRVU107Cit9CisKK3N0YXRpYyB2b2lkIGhw
ZF9pcnEoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXU4IGRwY2Rfc2lua19jb3VudCwgZHBj
ZF9pcnFfdmVjdG9yOworCXU4IGxpbmtfc3RhdHVzW0RQX0xJTktfU1RBVFVTX1NJWkVdOworCXVu
c2lnbmVkIGludCBic3RhdHVzOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVu
dC0+ZGV2OworCisJZHBjZF9zaW5rX2NvdW50ID0gZHB0eF9kcGNkcmQoaXQ2NTA1LCBEUF9TSU5L
X0NPVU5UKTsKKwlkcGNkX2lycV92ZWN0b3IgPSBkcHR4X2RwY2RyZChpdDY1MDUsIERQX0RFVklD
RV9TRVJWSUNFX0lSUV9WRUNUT1IpOworCWRybV9kcF9kcGNkX3JlYWRfbGlua19zdGF0dXMoJml0
NjUwNS0+YXV4LCBsaW5rX3N0YXR1cyk7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJk
cGNkX3NpbmtfY291bnQgPSAweCV4IiwgZHBjZF9zaW5rX2NvdW50KTsKKwlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICJkcGNkX2lycV92ZWN0b3IgPSAweCV4IiwgZHBjZF9pcnFfdmVjdG9yKTsK
KwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJsaW5rX3N0YXR1cyA9ICUqcGgiLCBBUlJBWV9T
SVpFKGxpbmtfc3RhdHVzKSwKKwkJCSAgICAgbGlua19zdGF0dXMpOworCisJaWYgKGRwY2RfaXJx
X3ZlY3RvciAmIERQX0NQX0lSUSkgeworCQlic3RhdHVzID0gZHB0eF9kcGNkcmQoaXQ2NTA1LCBE
UF9BVVhfSERDUF9CU1RBVFVTKTsKKwkJZHB0eHNldChpdDY1MDUsIDB4MzksIDB4MDIsIDB4MDIp
OworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJSZWNlaXZlIENQX0lSUSwgYnN0YXR1cyA9
IDB4JTAyeCIsCisJCQkJICAgICBic3RhdHVzKTsKKwkJZHB0eF9kZWJ1Z19wcmludChpdDY1MDUs
IDB4NTUsICIiKTsKKworCQlpZiAoYnN0YXR1cyAmIERQX0JTVEFUVVNfUkVBRFkpCisJCQlEUk1f
REVWX0RFQlVHX0RSSVZFUihkZXYsICJIRENQIEtTViBsaXN0IHJlYWR5Iik7CisKKwkJaWYgKGJz
dGF0dXMgJiBEUF9CU1RBVFVTX0xJTktfRkFJTFVSRSkgeworCQkJRFJNX0RFVl9ERUJVR19EUklW
RVIoCisJCQkJZGV2LCAiTGluayBJbnRlZ3JpdHkgRmFpbCwgcmVzdGFydCBIRENQIik7CisJCQly
ZXR1cm47CisJCX0KKwkJaWYgKGJzdGF0dXMgJiBEUF9CU1RBVFVTX1IwX1BSSU1FX1JFQURZKQor
CQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiSERDUCBSMCcgcmVhZHkiKTsKKwl9CisKKwlp
ZiAoZHBfbGlua19zdGF0dXMobGlua19zdGF0dXMsIERQX0xBTkVfQUxJR05fU1RBVFVTX1VQREFU
RUQpICYKKwkgICAgRFBfTElOS19TVEFUVVNfVVBEQVRFRCkgeworCQlpZiAoIWRybV9kcF9jaGFu
bmVsX2VxX29rKGxpbmtfc3RhdHVzLAorCQkJCQkgIGl0NjUwNS0+bGluay5udW1fbGFuZXMpKSB7
CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJMaW5rIFJlLVRyYWluaW5nIik7CisJCQlk
cHR4c2V0KGl0NjUwNSwgMHhEMywgMHgzMCwgMHgzMCk7CisJCQlkcHR4c2V0KGl0NjUwNSwgMHhF
OCwgMHgzMywgMHgwMCk7CisJCQltc2xlZXAoNTAwKTsKKwkJCWRwdHhfc3lzX2NoZyhpdDY1MDUs
IFNZU19IUEQpOworCQkJZ29fb25fZnNtKGl0NjUwNSk7CisJCX0KKwl9Cit9CisKK3N0YXRpYyB2
b2lkIGdvX29uX2ZzbShzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpZiAoaXQ2NTA1LT5jcF9jYXBhYmxlKSB7
CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlN1cHBvcnQgSERDUCwgY3BfY2FwYWJsZTog
JWQiLAorCQkJCSAgICAgaXQ2NTA1LT5jcF9jYXBhYmxlKTsKKwkJaWYgKGl0NjUwNS0+ZW5faGRj
cCkgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiRW5hYmxlIEhEQ1AiKTsKKwkJCXRv
X2ZzbV9zdGF0dXMoaXQ2NTA1LCBTWVNfUmVIRENQKTsKKwkJCWRwdHhfc3lzX2ZzbShpdDY1MDUp
OworCisJCX0gZWxzZSB7CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJEaXNhYmxlIEhE
Q1AiKTsKKwkJCXRvX2ZzbV9zdGF0dXMoaXQ2NTA1LCBTWVNfTk9ST1ApOworCQl9CisJfSBlbHNl
IHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiTm90IHN1cHBvcnQgSERDUCIpOworCQl0
b19mc21fc3RhdHVzKGl0NjUwNSwgU1lTX05PUk9QKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGl0
NjUwNV9jaGVja19yZWcwNihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIHVuc2lnbmVkIGludCByZWcw
NikKK3sKKwl1bnNpZ25lZCBpbnQgcmRkYXRhOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1
MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKHJlZzA2ICYgQklUKDApKSB7CisJCS8qIGhwZCBwaW4g
c3RhdHVzIGNoYW5nZSAqLworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJIUEQgQ2hhbmdl
IEludGVycnVwdCIpOworCQlpZiAoZHB0eF9nZXRzaW5raHBkKGl0NjUwNSkpIHsKKwkJCWRwdHhf
c3lzX2NoZyhpdDY1MDUsIFNZU19IUEQpOworCQkJZHB0eF9zeXNfZnNtKGl0NjUwNSk7CisJCQlk
cHR4cmQoaXQ2NTA1LCAweDBELCAmcmRkYXRhKTsKKwkJCWlmIChyZGRhdGEgJiBCSVQoMikpIHsK
KwkJCQlnb19vbl9mc20oaXQ2NTA1KTsKKwkJCX0gZWxzZSB7CisJCQkJZHB0eHdyKGl0NjUwNSwg
MHgwNSwgMHgwMCk7CisJCQkJZHB0eHNldChpdDY1MDUsIDB4NjEsIDB4MDIsIDB4MDIpOworCQkJ
CWRwdHhzZXQoaXQ2NTA1LCAweDYxLCAweDAyLCAweDAwKTsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJ
CWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19VTlBMVUcpOworCQkJZHB0eF9zeXNfZnNtKGl0NjUw
NSk7CisJCQlyZXR1cm47CisJCX0KKwl9CisKKwlpZiAoaXQ2NTA1LT5jcF9jYXBhYmxlKSB7CisJ
CWlmIChyZWcwNiAmIEJJVCg0KSkgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LAorCQkJ
CQkgICAgICJIRENQIGVuY3J5cHRpb24gRG9uZSBJbnRlcnJ1cHQiKTsKKwkJCWl0NjUwNS0+Y3Bf
ZG9uZSA9IDE7CisJCQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBTWVNfTk9ST1ApOworCQl9CisKKwkJ
aWYgKHJlZzA2ICYgQklUKDMpKSB7CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUigKKwkJCQlkZXYs
ICJIRENQIGVuY3J5cHRpb24gRmFpbCBJbnRlcnJ1cHQsIHJldHJ5Iik7CisJCQlpdDY1MDUtPmNw
X2RvbmUgPSAwOworCQkJaXQ2NTA1X2luaXRfYW5kX21hc2tfb24oaXQ2NTA1KTsKKwkJfQorCX0K
KworCWlmIChyZWcwNiAmIEJJVCgxKSkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJI
UEQgSVJRIEludGVycnVwdCIpOworCQlocGRfaXJxKGl0NjUwNSk7CisJfQorCisJaWYgKHJlZzA2
ICYgQklUKDIpKSB7CisJCWRwdHhyZChpdDY1MDUsIDB4MEQsICZyZGRhdGEpOworCisJCWlmIChy
ZGRhdGEgJiBCSVQoMikpIHsKKwkJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlZpZGVvIFN0
YWJsZSBPbiBJbnRlcnJ1cHQiKTsKKwkJCWl0NjUwNS0+dmlkc3RhYmxlX2RvbmUgPSAxOworCQkJ
ZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX0FVVE9UUkFJTik7CisJCQlnb19vbl9mc20oaXQ2NTA1
KTsKKwkJfSBlbHNlIHsKKwkJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlZpZGVvIFN0YWJs
ZSBPZmYgSW50ZXJydXB0Iik7CisJCQlpdDY1MDUtPnZpZHN0YWJsZV9kb25lID0gMDsKKwkJfQor
CX0KK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2NoZWNrX3JlZzA3KHN0cnVjdCBpdDY1MDUgKml0
NjUwNSwgdW5zaWduZWQgaW50IHJlZzA3KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1
MDUtPmNsaWVudC0+ZGV2OworCXVuc2lnbmVkIGludCBsZW4sIGk7CisJdW5zaWduZWQgaW50IGJz
dGF0dXM7CisKKwlpZiAoaXQ2NTA1LT5zdGF0dXMgPT0gU1lTX1VOUExVRykKKwkJcmV0dXJuOwor
CWlmIChyZWcwNyAmIEJJVCgwKSkKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiQVVYIFBD
IFJlcXVlc3QgRmFpbCBJbnRlcnJ1cHQiKTsKKworCWlmIChyZWcwNyAmIEJJVCgxKSkgeworCQlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJIRENQIGV2ZW50IEludGVycnVwdCIpOworCQlmb3Ig
KGkgPSAwOyBpIDwgUE9MTElOR0tTVkxJU1Q7IGkrKykgeworCQkJYnN0YXR1cyA9IGRwdHhfZHBj
ZHJkKGl0NjUwNSwgRFBfQVVYX0hEQ1BfQlNUQVRVUyk7CisJCQl1c2xlZXBfcmFuZ2UoMjAwMCwg
MzAwMCk7CisJCQlpZiAoYnN0YXR1cyAmIERQX0JTVEFUVVNfUkVBRFkpCisJCQkJYnJlYWs7CisJ
CX0KKworCQkvKgorCQkgKiBSZWFkIEJzdGF0dXMgdG8gZGV0ZXJtaW5lIHdoYXQgaGFwcGVuZWQK
KwkJICovCisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkJzdGF0dXM6IDB4JTAyeCIsIGJz
dGF0dXMpOworCQlkcHR4X2RlYnVnX3ByaW50KGl0NjUwNSwgMHgzQiwgImFyMF9sb3ciKTsKKwkJ
ZHB0eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4M0MsICJhcjBfaGlnaCIpOworCQlkcHR4X2RlYnVn
X3ByaW50KGl0NjUwNSwgMHg0NSwgImJyMF9sb3ciKTsKKwkJZHB0eF9kZWJ1Z19wcmludChpdDY1
MDUsIDB4NDYsICJicjBfaGlnaCIpOworCisJCWlmIChic3RhdHVzICYgRFBfQlNUQVRVU19SRUFE
WSkgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiSERDUCBLU1YgbGlzdCByZWFkeSIp
OworCQkJbGVuID0gaXQ2NTA1X21ha2V1cF9zaGExX2lucHV0KGl0NjUwNSk7CisJCQlzaGExX2Rp
Z2VzdChpdDY1MDUsIGl0NjUwNS0+c2hhaW5wdXQsIGxlbiwKKwkJCQkgICAgKHU4ICopaXQ2NTA1
LT5hdik7CisJCQlpdDY1MDVfY2hlY2tfc2hhMV9yZXN1bHQoaXQ2NTA1KTsKKwkJfQorCX0KKwlp
ZiAoaXQ2NTA1LT5lbl9hdWRpbyAmJiAocmVnMDcgJiBCSVQoMikpKSB7CisJCURSTV9ERVZfREVC
VUdfRFJJVkVSKGRldiwgIkF1ZGlvIEZJRk8gT3ZlckZsb3cgSW50ZXJydXB0Iik7CisJCWRwdHhf
ZGVidWdfcHJpbnQoaXQ2NTA1LCAweEJFLCAiIik7CisJCWRwdHhzZXQoaXQ2NTA1LCAweEQzLCAw
eDIwLCAweDIwKTsKKwkJZHB0eHNldChpdDY1MDUsIDB4RTgsIDB4MjIsIDB4MDApOworCQlkcHR4
c2V0KGl0NjUwNSwgMHhCOCwgMHg4MCwgMHg4MCk7CisJCWRwdHhzZXQoaXQ2NTA1LCAweEI4LCAw
eDgwLCAweDAwKTsKKwkJaXQ2NTA1X3NldF9hdWRpbyhpdDY1MDUpOworCX0KKwlpZiAoaXQ2NTA1
LT5lbl9hdWRpbyAmJiAocmVnMDcgJiBCSVQoNSkpKQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihk
ZXYsICJBdWRpbyBpbmZvZnJhbWUgcGFja2V0IGRvbmUiKTsKK30KKworc3RhdGljIHZvaWQgaXQ2
NTA1X2NoZWNrX3JlZzA4KHN0cnVjdCBpdDY1MDUgKml0NjUwNSwgdW5zaWduZWQgaW50IHJlZzA4
KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYg
KGl0NjUwNS0+c3RhdHVzID09IFNZU19VTlBMVUcpCisJCXJldHVybjsKKwlpZiAoaXQ2NTA1LT5l
bl9hdWRpbyAmJiAocmVnMDggJiBCSVQoMSkpKQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYs
ICJBdWRpbyBUaW1lU3RhbXAgUGFja2V0IERvbmUhIik7CisKKwlpZiAoaXQ2NTA1LT5lbl9hdWRp
byAmJiAocmVnMDggJiBCSVQoMykpKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF1
ZGlvIE0gRXJyb3IgSW50ZXJydXB0IC4uLiIpOworCQlzaG93X2F1ZF9tY250KGl0NjUwNSk7CisJ
fQorCWlmIChyZWcwOCAmIEJJVCg0KSkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJM
aW5rIFRyYWluaW5nIEZhaWwgSW50ZXJydXB0Iik7CisJCS8qIHJlc3RhcnQgdHJhaW5pbmcgKi8K
KwkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX0FVVE9UUkFJTik7CisJCWdvX29uX2ZzbShpdDY1
MDUpOworCX0KKworCWlmIChyZWcwOCAmIEJJVCg3KSkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZF
UihkZXYsICJJTyBMYXRjaCBGSUZPIE92ZXJGbG93IEludGVycnVwdCIpOworCQlkcHR4c2V0KGl0
NjUwNSwgMHg2MSwgMHgwMiwgMHgwMik7CisJCWRwdHhzZXQoaXQ2NTA1LCAweDYxLCAweDAyLCAw
eDAwKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9kcHR4X2lycShzdHJ1Y3QgaXQ2NTA1
ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IHJlZzA2LCByZWcwNywgcmVnMDgsIHJlZzBkOwor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZHB0eHJkKGl0
NjUwNSwgMHgwNiwgJnJlZzA2KTsKKwlkcHR4cmQoaXQ2NTA1LCAweDA3LCAmcmVnMDcpOworCWRw
dHhyZChpdDY1MDUsIDB4MDgsICZyZWcwOCk7CisJZHB0eHJkKGl0NjUwNSwgMHgwRCwgJnJlZzBk
KTsKKworCWRwdHh3cihpdDY1MDUsIDB4MDYsIHJlZzA2KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA3
LCByZWcwNyk7CisJZHB0eHdyKGl0NjUwNSwgMHgwOCwgcmVnMDgpOworCisJRFJNX0RFVl9ERUJV
R19EUklWRVIoZGV2LCAicmVnMDYgPSAweCUwMngiLCByZWcwNik7CisJRFJNX0RFVl9ERUJVR19E
UklWRVIoZGV2LCAicmVnMDcgPSAweCUwMngiLCByZWcwNyk7CisJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAicmVnMDggPSAweCUwMngiLCByZWcwOCk7CisJRFJNX0RFVl9ERUJVR19EUklWRVIo
ZGV2LCAicmVnMGQgPSAweCUwMngiLCByZWcwZCk7CisKKwlpZiAocmVnMDYgIT0gMCkKKwkJaXQ2
NTA1X2NoZWNrX3JlZzA2KGl0NjUwNSwgcmVnMDYpOworCisJaWYgKHJlZzA3ICE9IDApCisJCWl0
NjUwNV9jaGVja19yZWcwNyhpdDY1MDUsIHJlZzA3KTsKKworCWlmIChyZWcwOCAhPSAwKQorCQlp
dDY1MDVfY2hlY2tfcmVnMDgoaXQ2NTA1LCByZWcwOCk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV9icmlkZ2VfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGl0
NjUwNSAqaXQ2NTA1ID0gYnJpZGdlX3RvX2l0NjUwNShicmlkZ2UpOworCisJaWYgKCFpdDY1MDUt
PmRydl9ob2xkKSB7CisJCWl0NjUwNV9pbnRfbWFza19vbihpdDY1MDUpOworCQlkcHR4X3N5c19j
aGcoaXQ2NTA1LCBTWVNfSFBEKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9icmlkZ2Vf
ZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBpdDY1MDUgKml0
NjUwNSA9IGJyaWRnZV90b19pdDY1MDUoYnJpZGdlKTsKKworCWRwdHhfc3lzX2NoZyhpdDY1MDUs
IFNZU19VTlBMVUcpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9icmlkZ2VfZnVuY3Mg
aXQ2NTA1X2JyaWRnZV9mdW5jcyA9IHsKKwkuYXR0YWNoID0gaXQ2NTA1X2JyaWRnZV9hdHRhY2gs
CisJLmRldGFjaCA9IGl0NjUwNV9icmlkZ2VfZGV0YWNoLAorCS5tb2RlX3ZhbGlkID0gaXQ2NTA1
X2JyaWRnZV9tb2RlX3ZhbGlkLAorCS5tb2RlX3NldCA9IGl0NjUwNV9icmlkZ2VfbW9kZV9zZXQs
CisJLmVuYWJsZSA9IGl0NjUwNV9icmlkZ2VfZW5hYmxlLAorCS5kaXNhYmxlID0gaXQ2NTA1X2Jy
aWRnZV9kaXNhYmxlLAorfTsKKworc3RhdGljIHZvaWQgaXQ2NTA1X2NsZWFyX2ludChzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJZHB0eHdyKGl0NjUwNSwgMHgwNiwgMHhGRik7CisJZHB0eHdy
KGl0NjUwNSwgMHgwNywgMHhGRik7CisJZHB0eHdyKGl0NjUwNSwgMHgwOCwgMHhGRik7Cit9CisK
K3N0YXRpYyBpcnFyZXR1cm5fdCBpdDY1MDVfaW50cF90aHJlYWRlZF9oYW5kbGVyKGludCB1bnVz
ZWQsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gZGF0YTsKKwlzdHJ1
Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCW1zbGVlcCgxNTApOwor
CW11dGV4X2xvY2soJml0NjUwNS0+bG9jayk7CisKKwlpZiAoaXQ2NTA1LT5kcnZfaG9sZCA9PSAw
ICYmIGl0NjUwNS0+cG93ZXJlZCkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJpbnRv
IGl0NjUwNV9kcHR4X2lycSIpOworCQlpdDY1MDVfZHB0eF9pcnEoaXQ2NTA1KTsKKwl9CisKKwlt
dXRleF91bmxvY2soJml0NjUwNS0+bG9jayk7CisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCitz
dGF0aWMgaW50IGl0NjUwNV9pbml0X3BkYXRhKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlz
dHJ1Y3QgaXQ2NTA1X3BsYXRmb3JtX2RhdGEgKnBkYXRhID0gJml0NjUwNS0+cGRhdGE7CisJc3Ry
dWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwkvKiAxLjBWIGRpZ2l0
YWwgY29yZSBwb3dlciByZWd1bGF0b3IgICovCisJcGRhdGEtPnB3cjE4ID0gZGV2bV9yZWd1bGF0
b3JfZ2V0KGRldiwgInB3cjE4Iik7CisJaWYgKElTX0VSUihwZGF0YS0+cHdyMTgpKSB7CisJCURS
TV9ERVZfRVJST1IoZGV2LCAicHdyMTggcmVndWxhdG9yIG5vdCBmb3VuZCIpOworCQlyZXR1cm4g
UFRSX0VSUihwZGF0YS0+cHdyMTgpOworCX0KKworCXBkYXRhLT5vdmRkID0gZGV2bV9yZWd1bGF0
b3JfZ2V0KGRldiwgIm92ZGQiKTsKKwlpZiAoSVNfRVJSKHBkYXRhLT5vdmRkKSkgeworCQlEUk1f
REVWX0VSUk9SKGRldiwgIm92ZGQgcmVndWxhdG9yIG5vdCBmb3VuZCIpOworCQlyZXR1cm4gUFRS
X0VSUihwZGF0YS0+b3ZkZCk7CisJfQorCisJLyogR1BJTyBmb3IgSFBEICovCisJcGRhdGEtPmdw
aW9kX2hwZCA9IGRldm1fZ3Bpb2RfZ2V0KGRldiwgImhwZCIsIEdQSU9EX0lOKTsKKwlpZiAoSVNf
RVJSKHBkYXRhLT5ncGlvZF9ocGQpKQorCQlyZXR1cm4gUFRSX0VSUihwZGF0YS0+Z3Bpb2RfaHBk
KTsKKworCS8qIEdQSU8gZm9yIGNoaXAgcmVzZXQgKi8KKwlwZGF0YS0+Z3Bpb2RfcmVzZXQgPSBk
ZXZtX2dwaW9kX2dldChkZXYsICJyZXNldCIsIEdQSU9EX09VVF9ISUdIKTsKKworCXJldHVybiBQ
VFJfRVJSX09SX1pFUk8ocGRhdGEtPmdwaW9kX3Jlc2V0KTsKK30KKworc3RhdGljIHNzaXplX3Qg
ZHJ2X2hvbGRfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLAorCQkJICAgICBjaGFyICpidWYpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0g
ZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlyZXR1cm4gc2NucHJpbnRmKGJ1ZiwgUEFHRV9TSVpF
LCAiJWRcbiIsIGl0NjUwNS0+ZHJ2X2hvbGQpOworfQorCitzdGF0aWMgc3NpemVfdCBkcnZfaG9s
ZF9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LAorCQkJICAgICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJc3RydWN0IGl0
NjUwNSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlpZiAoa3N0cnRvaW50KGJ1
ZiwgMTAsICZpdDY1MDUtPmRydl9ob2xkKSA8IDApCisJCXJldHVybiAtRUlOVkFMOworCisJaWYg
KGl0NjUwNS0+ZHJ2X2hvbGQpIHsKKwkJaXQ2NTA1X2ludF9tYXNrX29mZihpdDY1MDUpOworCX0g
ZWxzZSB7CisJCWl0NjUwNV9jbGVhcl9pbnQoaXQ2NTA1KTsKKwkJaXQ2NTA1X2ludF9tYXNrX29u
KGl0NjUwNSk7CisJfQorCXJldHVybiBjb3VudDsKK30KKworc3RhdGljIHNzaXplX3QgcHJpbnRf
dGltaW5nX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwgY2hhciAqYnVmKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGRldl9n
ZXRfZHJ2ZGF0YShkZXYpOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICp2aWQgPSAmaXQ2NTA1
LT52aWRfaW5mbzsKKwljaGFyICpzdHIgPSBidWYsICplbmQgPSBidWYgKyBQQUdFX1NJWkU7CisK
KwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiLS0tdmlkZW8gdGltaW5nLS0tXG4i
KTsKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiUENMSzolZC4lMDNkTUh6XG4i
LCB2aWQtPmNsb2NrIC8gMTAwMCwKKwkJCSB2aWQtPmNsb2NrICUgMTAwMCk7CisJc3RyICs9IHNj
bnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIkhUb3RhbDolZFxuIiwgdmlkLT5odG90YWwpOworCXN0
ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIsICJIQWN0aXZlOiVkXG4iLCB2aWQtPmhkaXNw
bGF5KTsKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiSEZyb250UG9yY2g6JWRc
biIsCisJCQkgdmlkLT5oc3luY19zdGFydCAtIHZpZC0+aGRpc3BsYXkpOworCXN0ciArPSBzY25w
cmludGYoc3RyLCBlbmQgLSBzdHIsICJIU3luY1dpZHRoOiVkXG4iLAorCQkJIHZpZC0+aHN5bmNf
ZW5kIC0gdmlkLT5oc3luY19zdGFydCk7CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0
ciwgIkhCYWNrUG9yY2g6JWRcbiIsCisJCQkgdmlkLT5odG90YWwgLSB2aWQtPmhzeW5jX2VuZCk7
CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIlZUb3RhbDolZFxuIiwgdmlkLT52
dG90YWwpOworCXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIsICJWQWN0aXZlOiVkXG4i
LCB2aWQtPnZkaXNwbGF5KTsKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiVkZy
b250UG9yY2g6JWRcbiIsCisJCQkgdmlkLT52c3luY19zdGFydCAtIHZpZC0+dmRpc3BsYXkpOwor
CXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIsICJWU3luY1dpZHRoOiVkXG4iLAorCQkJ
IHZpZC0+dnN5bmNfZW5kIC0gdmlkLT52c3luY19zdGFydCk7CisJc3RyICs9IHNjbnByaW50Zihz
dHIsIGVuZCAtIHN0ciwgIlZCYWNrUG9yY2g6JWRcbiIsCisJCQkgdmlkLT52dG90YWwgLSB2aWQt
PnZzeW5jX2VuZCk7CisKKwlyZXR1cm4gc3RyIC0gYnVmOworfQorCitzdGF0aWMgc3NpemVfdCBz
aGFfZGVidWdfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRl
ICphdHRyLAorCQkJICAgICAgY2hhciAqYnVmKQoreworCWludCBpID0gMDsKKwljaGFyICpzdHIg
PSBidWYsICplbmQgPSBidWYgKyBQQUdFX1NJWkU7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0g
ZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3Ry
LCAic2hhIGlucHV0OlxuIik7CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoaXQ2NTA1LT5z
aGFpbnB1dCk7IGkgKz0gMTYpCisJCXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIsICIl
MTZwaFxuIiwKKwkJCQkgaXQ2NTA1LT5zaGFpbnB1dCArIGkpOworCisJc3RyICs9IHNjbnByaW50
ZihzdHIsIGVuZCAtIHN0ciwgImF2OlxuIik7CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUo
aXQ2NTA1LT5hdik7IGkrKykKKwkJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIiU0
cGhcbiIsIGl0NjUwNS0+YXZbaV0pOworCisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0
ciwgImJ2OlxuIik7CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoaXQ2NTA1LT5idik7IGkr
KykKKwkJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIiU0cGhcbiIsIGl0NjUwNS0+
YnZbaV0pOworCisJcmV0dXJuIGVuZCAtIHN0cjsKK30KKworc3RhdGljIHNzaXplX3QgZW5faGRj
cF9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
CisJCQkgICAgY2hhciAqYnVmKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGRldl9nZXRf
ZHJ2ZGF0YShkZXYpOworCisJcmV0dXJuIHNjbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiVkXG4i
LCBpdDY1MDUtPmVuX2hkY3ApOworfQorCitzdGF0aWMgc3NpemVfdCBlbl9oZGNwX3N0b3JlKHN0
cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkgICAg
IGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUw
NSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCXVuc2lnbmVkIGludCByZWczZiwgaGRjcDsKKwor
CWlmIChrc3RydG9pbnQoYnVmLCAxMCwgJml0NjUwNS0+ZW5faGRjcCkgPCAwKQorCQlyZXR1cm4g
LUVJTlZBTDsKKworCWlmICghaXQ2NTA1LT5wb3dlcmVkIHx8IGl0NjUwNS0+c3RhdHVzID09IFNZ
U19VTlBMVUcpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LAorCQkJCSAgICAgInBvd2Vy
IGRvd24gb3IgdW5wbHVnLCBjYW4gbm90IGZpcmUgSERDUCIpOworCQlyZXR1cm4gLUVJTlZBTDsK
Kwl9CisKKwlpZiAoaXQ2NTA1LT5lbl9oZGNwKSB7CisJCWlmIChpdDY1MDUtPmNwX2NhcGFibGUp
IHsKKwkJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19SZUhEQ1ApOworCQkJZHB0eF9zeXNfZnNt
KGl0NjUwNSk7CisJCX0gZWxzZSB7CisJCQlEUk1fREVWX0VSUk9SKGRldiwgInNpbmsgbm90IHN1
cHBvcnQgSERDUCIpOworCQkJaXQ2NTA1LT5jcF9kb25lID0gMDsKKwkJfQorCX0gZWxzZSB7CisJ
CWRwdHhzZXQoaXQ2NTA1LCAweDA1LCAweDEwLCAweDEwKTsKKwkJZHB0eHNldChpdDY1MDUsIDB4
MDUsIDB4MTAsIDB4MDApOworCQlkcHR4cmQoaXQ2NTA1LCAweDNGLCAmcmVnM2YpOworCQloZGNw
ID0gKHJlZzNmICYgQklUKDcpKSA+PiA3OworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICIl
cyB0byBkaXNhYmxlIGhkY3AiLAorCQkJCSAgICAgaGRjcCA/ICJmYWlsZWQiIDogInN1Y2NlZWRl
ZCIpOworCQlpdDY1MDUtPmNwX2RvbmUgPSBoZGNwOworCX0KKwlyZXR1cm4gY291bnQ7Cit9CisK
K3N0YXRpYyBzc2l6ZV90IGVuX3B3cm9ub2ZmX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJ
CXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCit7CisJc3RydWN0IGl0
NjUwNSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlyZXR1cm4gc2NucHJpbnRm
KGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIGl0NjUwNS0+ZW5fcHdyb25vZmYpOworfQorCitzdGF0
aWMgc3NpemVfdCBlbl9wd3Jvbm9mZl9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJIHN0
cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjb25zdCBjaGFyICpidWYsCisJCQkJIHNpemVf
dCBjb3VudCkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2
KTsKKworCWlmIChrc3RydG9pbnQoYnVmLCAxMCwgJml0NjUwNS0+ZW5fcHdyb25vZmYpIDwgMCkK
KwkJcmV0dXJuIC1FSU5WQUw7CisJcmV0dXJuIGNvdW50OworfQorCitzdGF0aWMgc3NpemVfdCBl
bl9hdWRpb19zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUg
KmF0dHIsCisJCQkgICAgIGNoYXIgKmJ1ZikKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBk
ZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCXJldHVybiBzY25wcmludGYoYnVmLCBQQUdFX1NJWkUs
ICIlZFxuIiwgaXQ2NTA1LT5lbl9hdWRpbyk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGVuX2F1ZGlv
X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
CisJCQkgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCkKK3sKKwlzdHJ1Y3QgaXQ2
NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCWlmIChrc3RydG9pbnQoYnVm
LCAxMCwgJml0NjUwNS0+ZW5fYXVkaW8pIDwgMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKCFp
dDY1MDUtPnBvd2VyZWQgfHwgaXQ2NTA1LT5zdGF0dXMgPT0gU1lTX1VOUExVRykgeworCQlEUk1f
REVWX0RFQlVHX0RSSVZFUigKKwkJCWRldiwgInBvd2VyIGRvd24gb3IgdW5wbHVnLCBjYW4gbm90
IG91dHB1dCBhdWRpbyIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoaXQ2NTA1LT5l
bl9hdWRpbykgeworCQlpdDY1MDVfc2V0X2F1ZGlvKGl0NjUwNSk7CisJfSBlbHNlIHsKKwkJZHB0
eHNldChpdDY1MDUsIDB4MDUsIDB4MDIsIDB4MDIpOworCQlkcHR4c2V0KGl0NjUwNSwgMHgwNSwg
MHgwMiwgMHgwMCk7CisJfQorCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIGF1ZGlvIiwK
KwkJCSAgICAgaXQ2NTA1LT5lbl9hdWRpbyA/ICJFbmFibGUiIDogIkRpc2FibGUiKTsKKwlyZXR1
cm4gY291bnQ7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGZvcmNlX3B3cm9ub2ZmX3N0b3JlKHN0cnVj
dCBkZXZpY2UgKmRldiwKKwkJCQkgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJ
CQkJICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQoreworCXN0cnVjdCBpdDY1MDUg
Kml0NjUwNSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCWludCBwd3I7CisKKwlpZiAoa3N0cnRv
aW50KGJ1ZiwgMTAsICZwd3IpIDwgMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKHB3cikKKwkJ
aXQ2NTA1X3Bvd2Vyb24oaXQ2NTA1KTsKKwllbHNlCisJCWl0NjUwNV9wb3dlcm9mZihpdDY1MDUp
OworCXJldHVybiBjb3VudDsKK30KKworc3RhdGljIHNzaXplX3QgcHdyX3N0YXR1c19zaG93KHN0
cnVjdCBkZXZpY2UgKmRldiwKKwkJCSAgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwgY2hhciAqYnVmKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGRldl9nZXRfZHJ2ZGF0
YShkZXYpOworCisJcmV0dXJuIHNjbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiVkXG4iLCBpdDY1
MDUtPnBvd2VyZWQpOworfQorCitzdGF0aWMgREVWSUNFX0FUVFJfUk8ocHJpbnRfdGltaW5nKTsK
K3N0YXRpYyBERVZJQ0VfQVRUUl9STyhwd3Jfc3RhdHVzKTsKK3N0YXRpYyBERVZJQ0VfQVRUUl9S
TyhzaGFfZGVidWcpOworc3RhdGljIERFVklDRV9BVFRSX1dPKGZvcmNlX3B3cm9ub2ZmKTsKK3N0
YXRpYyBERVZJQ0VfQVRUUl9SVyhkcnZfaG9sZCk7CitzdGF0aWMgREVWSUNFX0FUVFJfUlcoZW5f
aGRjcCk7CitzdGF0aWMgREVWSUNFX0FUVFJfUlcoZW5fcHdyb25vZmYpOworc3RhdGljIERFVklD
RV9BVFRSX1JXKGVuX2F1ZGlvKTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBhdHRyaWJ1dGUgKml0
NjUwNV9hdHRyc1tdID0geworCSZkZXZfYXR0cl9kcnZfaG9sZC5hdHRyLAorCSZkZXZfYXR0cl9w
cmludF90aW1pbmcuYXR0ciwKKwkmZGV2X2F0dHJfc2hhX2RlYnVnLmF0dHIsCisJJmRldl9hdHRy
X2VuX2hkY3AuYXR0ciwKKwkmZGV2X2F0dHJfZW5fcHdyb25vZmYuYXR0ciwKKwkmZGV2X2F0dHJf
ZW5fYXVkaW8uYXR0ciwKKwkmZGV2X2F0dHJfZm9yY2VfcHdyb25vZmYuYXR0ciwKKwkmZGV2X2F0
dHJfcHdyX3N0YXR1cy5hdHRyLAorCU5VTEwsCit9OworCitzdGF0aWMgaW50IGl0NjUwNV9pMmNf
cHJvYmUoc3RydWN0IGkyY19jbGllbnQgKmNsaWVudCwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgaTJj
X2RldmljZV9pZCAqaWQpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1OworCXN0cnVjdCBpdDY1
MDVfcGxhdGZvcm1fZGF0YSAqcGRhdGE7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJmNsaWVudC0+
ZGV2OworCXN0cnVjdCBleHRjb25fZGV2ICpleHRjb247CisJaW50IGVyciwgaW50cF9pcnE7CisK
KwlpdDY1MDUgPSBkZXZtX2t6YWxsb2MoJmNsaWVudC0+ZGV2LCBzaXplb2YoKml0NjUwNSksIEdG
UF9LRVJORUwpOworCWlmICghaXQ2NTA1KQorCQlyZXR1cm4gLUVOT01FTTsKKworCW11dGV4X2lu
aXQoJml0NjUwNS0+bG9jayk7CisJbXV0ZXhfaW5pdCgmaXQ2NTA1LT5tb2RlX2xvY2spOworCisJ
cGRhdGEgPSAmaXQ2NTA1LT5wZGF0YTsKKworCWl0NjUwNS0+YnJpZGdlLm9mX25vZGUgPSBjbGll
bnQtPmRldi5vZl9ub2RlOworCWl0NjUwNS0+Y2xpZW50ID0gY2xpZW50OworCWkyY19zZXRfY2xp
ZW50ZGF0YShjbGllbnQsIGl0NjUwNSk7CisKKwkvKiBnZXQgZXh0Y29uIGRldmljZSBmcm9tIERU
UyAqLworCWV4dGNvbiA9IGV4dGNvbl9nZXRfZWRldl9ieV9waGFuZGxlKGRldiwgMCk7CisJaWYg
KFBUUl9FUlIoZXh0Y29uKSA9PSAtRVBST0JFX0RFRkVSKQorCQlyZXR1cm4gLUVQUk9CRV9ERUZF
UjsKKwlpZiAoSVNfRVJSKGV4dGNvbikpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJjYW4gbm90
IGdldCBleHRjb24gZGV2aWNlISIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpdDY1MDUt
PmV4dGNvbiA9IGV4dGNvbjsKKworCWl0NjUwNS0+bGFuZXN3YXBfZGlzYWJsZWQgPQorCQlkZXZp
Y2VfcHJvcGVydHlfcmVhZF9ib29sKGRldiwgIm5vLWxhbmVzd2FwIik7CisKKwllcnIgPSBpdDY1
MDVfaW5pdF9wZGF0YShpdDY1MDUpOworCWlmIChlcnIpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYs
ICJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwZGF0YTogJWQiLCBlcnIpOworCQlyZXR1cm4gZXJyOwor
CX0KKworCWl0NjUwNS0+cmVnbWFwID0KKwkJZGV2bV9yZWdtYXBfaW5pdF9pMmMoY2xpZW50LCAm
aXQ2NTA1X2JyaWRnZV9yZWdtYXBfY29uZmlnKTsKKwlpZiAoSVNfRVJSKGl0NjUwNS0+cmVnbWFw
KSkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgInJlZ21hcCBpMmMgaW5pdCBmYWlsZWQiKTsKKwkJ
cmV0dXJuIFBUUl9FUlIoaXQ2NTA1LT5yZWdtYXApOworCX0KKworCWludHBfaXJxID0gY2xpZW50
LT5pcnE7CisKKwlpZiAoIWludHBfaXJxKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVk
IHRvIGdldCBDQUJMRV9ERVQgYW5kIElOVFAgSVJRIik7CisJCXJldHVybiAtRU5PREVWOworCX0K
KworCWVyciA9IGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEoJmNsaWVudC0+ZGV2LCBpbnRwX2ly
cSwgTlVMTCwKKwkJCQkJaXQ2NTA1X2ludHBfdGhyZWFkZWRfaGFuZGxlciwKKwkJCQkJSVJRRl9U
UklHR0VSX0ZBTExJTkcgfCBJUlFGX09ORVNIT1QsCisJCQkJCSJpdDY1MDUtaW50cCIsIGl0NjUw
NSk7CisJaWYgKGVycikgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byByZXF1ZXN0
IElOVFAgdGhyZWFkZWQgSVJROiAlZCIsCisJCQkgICAgICBlcnIpOworCQlyZXR1cm4gZXJyOwor
CX0KKworCS8qIFJlZ2lzdGVyIGF1eCBjaGFubmVsICovCisJaXQ2NTA1LT5hdXgubmFtZSA9ICJE
UC1BVVgiOworCWl0NjUwNS0+YXV4LmRldiA9IGRldjsKKwlpdDY1MDUtPmF1eC50cmFuc2ZlciA9
IGl0NjUwNV9hdXhfdHJhbnNmZXI7CisJZXJyID0gZHJtX2RwX2F1eF9yZWdpc3RlcigmaXQ2NTA1
LT5hdXgpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRv
IHJlZ2lzdGVyIGF1eDogJWQiLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCWl0NjUwNS0+
ZW5fcHdyb25vZmYgPSBERUZBVUxUUFdST05PRkY7CisJaXQ2NTA1LT5kcnZfaG9sZCA9IERFRkFV
TFREUlZIT0xEOworCWl0NjUwNS0+ZW5faGRjcCA9IERFRkFVTFRIRENQOworCWl0NjUwNS0+ZW5f
YXVkaW8gPSBERUZBVUxUQVVESU87CisJaXQ2NTA1LT5wb3dlcmVkID0gMDsKKworCWlmIChERUZB
VUxUUFdST04pCisJCWl0NjUwNV9wb3dlcm9uKGl0NjUwNSk7CisJZXJyID0gc3lzZnNfY3JlYXRl
X2ZpbGVzKCZjbGllbnQtPmRldi5rb2JqLCBpdDY1MDVfYXR0cnMpOworCWlmIChlcnIpIHsKKwkJ
ZHJtX2RwX2F1eF91bnJlZ2lzdGVyKCZpdDY1MDUtPmF1eCk7CisJCXJldHVybiBlcnI7CisJfQor
CisJaXQ2NTA1LT5icmlkZ2UuZnVuY3MgPSAmaXQ2NTA1X2JyaWRnZV9mdW5jczsKKwlkcm1fYnJp
ZGdlX2FkZCgmaXQ2NTA1LT5icmlkZ2UpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGl0
NjUwNV9yZW1vdmUoc3RydWN0IGkyY19jbGllbnQgKmNsaWVudCkKK3sKKwlzdHJ1Y3QgaXQ2NTA1
ICppdDY1MDUgPSBpMmNfZ2V0X2NsaWVudGRhdGEoY2xpZW50KTsKKworCWRybV9icmlkZ2VfcmVt
b3ZlKCZpdDY1MDUtPmJyaWRnZSk7CisJc3lzZnNfcmVtb3ZlX2ZpbGVzKCZjbGllbnQtPmRldi5r
b2JqLCBpdDY1MDVfYXR0cnMpOworCWtmcmVlKGl0NjUwNS0+ZWRpZCk7CisJaXQ2NTA1LT5lZGlk
ID0gTlVMTDsKKwlkcm1fY29ubmVjdG9yX3VucmVnaXN0ZXIoJml0NjUwNS0+Y29ubmVjdG9yKTsK
Kwlkcm1fZHBfYXV4X3VucmVnaXN0ZXIoJml0NjUwNS0+YXV4KTsKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkIGl0NjUwNV9pZFtdID0geworCXsgIml0
NjUwNSIsIDAgfSwKKwl7IH0KK307CisKK01PRFVMRV9ERVZJQ0VfVEFCTEUoaTJjLCBpdDY1MDVf
aWQpOworCitzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBpdDY1MDVfb2ZfbWF0Y2hb
XSA9IHsKKwl7IC5jb21wYXRpYmxlID0gIml0ZSxpdDY1MDUiIH0sCisJeyB9Cit9OworCitzdHJ1
Y3QgaTJjX2RyaXZlciBpdDY1MDVfaTJjX2RyaXZlciA9IHsKKwkuZHJpdmVyID0geworCQkubmFt
ZSA9ICJpdDY1MDVfZHB0eCIsCisJCS5vd25lciA9IFRISVNfTU9EVUxFLAorCQkub2ZfbWF0Y2hf
dGFibGUgPSBpdDY1MDVfb2ZfbWF0Y2gsCisJfSwKKwkucHJvYmUgPSBpdDY1MDVfaTJjX3Byb2Jl
LAorCS5yZW1vdmUgPSBpdDY1MDVfcmVtb3ZlLAorCS5pZF90YWJsZSA9IGl0NjUwNV9pZCwKK307
CisKK21vZHVsZV9pMmNfZHJpdmVyKGl0NjUwNV9pMmNfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhP
UigiSml0YW8gU2hpIDxqaXRhby5zaGlAbWVkaWF0ZWsuY29tPiIpOworTU9EVUxFX0RFU0NSSVBU
SU9OKCJJVDY1MDUgRGlzcGxheVBvcnQgVHJhbnNtaXR0ZXIgZHJpdmVyIik7CitNT0RVTEVfTElD
RU5TRSgiR1BMIHYyIik7Ci0tIAoxLjkuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
