Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0AF46573E6
	for <lists+dri-devel@lfdr.de>; Wed, 26 Jun 2019 23:49:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 123576E52A;
	Wed, 26 Jun 2019 21:49:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BE29D6E529;
 Wed, 26 Jun 2019 21:49:05 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Jun 2019 14:49:05 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,421,1557212400"; d="scan'208";a="164492176"
Received: from iweiny-desk2.sc.intel.com ([10.3.52.157])
 by orsmga003.jf.intel.com with ESMTP; 26 Jun 2019 14:49:04 -0700
Date: Wed, 26 Jun 2019 14:49:04 -0700
From: Ira Weiny <ira.weiny@intel.com>
To: Christoph Hellwig <hch@lst.de>
Subject: Re: [PATCH 17/25] PCI/P2PDMA: use the dev_pagemap internal refcount
Message-ID: <20190626214903.GE8399@iweiny-DESK2.sc.intel.com>
References: <20190626122724.13313-1-hch@lst.de>
 <20190626122724.13313-18-hch@lst.de>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190626122724.13313-18-hch@lst.de>
User-Agent: Mutt/1.11.1 (2018-12-01)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-nvdimm@lists.01.org, linux-pci@vger.kernel.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org, =?iso-8859-1?B?Suly9G1l?= Glisse <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, Ben Skeggs <bskeggs@redhat.com>,
 nouveau@lists.freedesktop.org, Dan Williams <dan.j.williams@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gV2VkLCBKdW4gMjYsIDIwMTkgYXQgMDI6Mjc6MTZQTSArMDIwMCwgQ2hyaXN0b3BoIEhlbGx3
aWcgd3JvdGU6Cj4gVGhlIGZ1bmN0aW9uYWxpdHkgaXMgaWRlbnRpY2FsIHRvIHRoZSBvbmUgY3Vy
cmVudGx5IG9wZW4gY29kZWQgaW4KPiBwMnBkbWEuYy4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RvcGggSGVsbHdpZyA8aGNoQGxzdC5kZT4KClJldmlld2VkLWJ5OiBJcmEgV2VpbnkgPGlyYS53
ZWlueUBpbnRlbC5jb20+Cgo+IC0tLQo+ICBkcml2ZXJzL3BjaS9wMnBkbWEuYyB8IDU3ICsrKyst
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCj4gIDEgZmlsZSBjaGFuZ2Vk
LCA0IGluc2VydGlvbnMoKyksIDUzIGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9kcml2
ZXJzL3BjaS9wMnBkbWEuYyBiL2RyaXZlcnMvcGNpL3AycGRtYS5jCj4gaW5kZXggZWJkOGNlM2Ji
YTJlLi42MDhmODRkZjYwNGEgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9wY2kvcDJwZG1hLmMKPiAr
KysgYi9kcml2ZXJzL3BjaS9wMnBkbWEuYwo+IEBAIC0yNCwxMiArMjQsNiBAQCBzdHJ1Y3QgcGNp
X3AycGRtYSB7Cj4gIAlib29sIHAycG1lbV9wdWJsaXNoZWQ7Cj4gIH07Cj4gIAo+IC1zdHJ1Y3Qg
cDJwZG1hX3BhZ2VtYXAgewo+IC0Jc3RydWN0IGRldl9wYWdlbWFwIHBnbWFwOwo+IC0Jc3RydWN0
IHBlcmNwdV9yZWYgcmVmOwo+IC0Jc3RydWN0IGNvbXBsZXRpb24gcmVmX2RvbmU7Cj4gLX07Cj4g
LQo+ICBzdGF0aWMgc3NpemVfdCBzaXplX3Nob3coc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3Qg
ZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKPiAgCQkJIGNoYXIgKmJ1ZikKPiAgewo+IEBAIC03OCwz
MiArNzIsNiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGF0dHJpYnV0ZV9ncm91cCBwMnBtZW1fZ3Jv
dXAgPSB7Cj4gIAkubmFtZSA9ICJwMnBtZW0iLAo+ICB9Owo+ICAKPiAtc3RhdGljIHN0cnVjdCBw
MnBkbWFfcGFnZW1hcCAqdG9fcDJwX3BnbWFwKHN0cnVjdCBwZXJjcHVfcmVmICpyZWYpCj4gLXsK
PiAtCXJldHVybiBjb250YWluZXJfb2YocmVmLCBzdHJ1Y3QgcDJwZG1hX3BhZ2VtYXAsIHJlZik7
Cj4gLX0KPiAtCj4gLXN0YXRpYyB2b2lkIHBjaV9wMnBkbWFfcGVyY3B1X3JlbGVhc2Uoc3RydWN0
IHBlcmNwdV9yZWYgKnJlZikKPiAtewo+IC0Jc3RydWN0IHAycGRtYV9wYWdlbWFwICpwMnBfcGdt
YXAgPSB0b19wMnBfcGdtYXAocmVmKTsKPiAtCj4gLQljb21wbGV0ZSgmcDJwX3BnbWFwLT5yZWZf
ZG9uZSk7Cj4gLX0KPiAtCj4gLXN0YXRpYyB2b2lkIHBjaV9wMnBkbWFfcGVyY3B1X2tpbGwoc3Ry
dWN0IGRldl9wYWdlbWFwICpwZ21hcCkKPiAtewo+IC0JcGVyY3B1X3JlZl9raWxsKHBnbWFwLT5y
ZWYpOwo+IC19Cj4gLQo+IC1zdGF0aWMgdm9pZCBwY2lfcDJwZG1hX3BlcmNwdV9jbGVhbnVwKHN0
cnVjdCBkZXZfcGFnZW1hcCAqcGdtYXApCj4gLXsKPiAtCXN0cnVjdCBwMnBkbWFfcGFnZW1hcCAq
cDJwX3BnbWFwID0KPiAtCQljb250YWluZXJfb2YocGdtYXAsIHN0cnVjdCBwMnBkbWFfcGFnZW1h
cCwgcGdtYXApOwo+IC0KPiAtCXdhaXRfZm9yX2NvbXBsZXRpb24oJnAycF9wZ21hcC0+cmVmX2Rv
bmUpOwo+IC0JcGVyY3B1X3JlZl9leGl0KCZwMnBfcGdtYXAtPnJlZik7Cj4gLX0KPiAtCj4gIHN0
YXRpYyB2b2lkIHBjaV9wMnBkbWFfcmVsZWFzZSh2b2lkICpkYXRhKQo+ICB7Cj4gIAlzdHJ1Y3Qg
cGNpX2RldiAqcGRldiA9IGRhdGE7Cj4gQEAgLTE1MywxMSArMTIxLDYgQEAgc3RhdGljIGludCBw
Y2lfcDJwZG1hX3NldHVwKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQo+ICAJcmV0dXJuIGVycm9yOwo+
ICB9Cj4gIAo+IC1zdGF0aWMgY29uc3Qgc3RydWN0IGRldl9wYWdlbWFwX29wcyBwY2lfcDJwZG1h
X3BhZ2VtYXBfb3BzID0gewo+IC0JLmtpbGwJCT0gcGNpX3AycGRtYV9wZXJjcHVfa2lsbCwKPiAt
CS5jbGVhbnVwCT0gcGNpX3AycGRtYV9wZXJjcHVfY2xlYW51cCwKPiAtfTsKPiAtCj4gIC8qKgo+
ICAgKiBwY2lfcDJwZG1hX2FkZF9yZXNvdXJjZSAtIGFkZCBtZW1vcnkgZm9yIHVzZSBhcyBwMnAg
bWVtb3J5Cj4gICAqIEBwZGV2OiB0aGUgZGV2aWNlIHRvIGFkZCB0aGUgbWVtb3J5IHRvCj4gQEAg
LTE3MSw3ICsxMzQsNiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRldl9wYWdlbWFwX29wcyBwY2lf
cDJwZG1hX3BhZ2VtYXBfb3BzID0gewo+ICBpbnQgcGNpX3AycGRtYV9hZGRfcmVzb3VyY2Uoc3Ry
dWN0IHBjaV9kZXYgKnBkZXYsIGludCBiYXIsIHNpemVfdCBzaXplLAo+ICAJCQkgICAgdTY0IG9m
ZnNldCkKPiAgewo+IC0Jc3RydWN0IHAycGRtYV9wYWdlbWFwICpwMnBfcGdtYXA7Cj4gIAlzdHJ1
Y3QgZGV2X3BhZ2VtYXAgKnBnbWFwOwo+ICAJdm9pZCAqYWRkcjsKPiAgCWludCBlcnJvcjsKPiBA
QCAtMTk0LDI2ICsxNTYsMTUgQEAgaW50IHBjaV9wMnBkbWFfYWRkX3Jlc291cmNlKHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCBpbnQgYmFyLCBzaXplX3Qgc2l6ZSwKPiAgCQkJcmV0dXJuIGVycm9yOwo+
ICAJfQo+ICAKPiAtCXAycF9wZ21hcCA9IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBzaXplb2Yo
KnAycF9wZ21hcCksIEdGUF9LRVJORUwpOwo+IC0JaWYgKCFwMnBfcGdtYXApCj4gKwlwZ21hcCA9
IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBzaXplb2YoKnBnbWFwKSwgR0ZQX0tFUk5FTCk7Cj4g
KwlpZiAoIXBnbWFwKQo+ICAJCXJldHVybiAtRU5PTUVNOwo+IC0KPiAtCWluaXRfY29tcGxldGlv
bigmcDJwX3BnbWFwLT5yZWZfZG9uZSk7Cj4gLQllcnJvciA9IHBlcmNwdV9yZWZfaW5pdCgmcDJw
X3BnbWFwLT5yZWYsCj4gLQkJCXBjaV9wMnBkbWFfcGVyY3B1X3JlbGVhc2UsIDAsIEdGUF9LRVJO
RUwpOwo+IC0JaWYgKGVycm9yKQo+IC0JCWdvdG8gcGdtYXBfZnJlZTsKPiAtCj4gLQlwZ21hcCA9
ICZwMnBfcGdtYXAtPnBnbWFwOwo+IC0KPiAgCXBnbWFwLT5yZXMuc3RhcnQgPSBwY2lfcmVzb3Vy
Y2Vfc3RhcnQocGRldiwgYmFyKSArIG9mZnNldDsKPiAgCXBnbWFwLT5yZXMuZW5kID0gcGdtYXAt
PnJlcy5zdGFydCArIHNpemUgLSAxOwo+ICAJcGdtYXAtPnJlcy5mbGFncyA9IHBjaV9yZXNvdXJj
ZV9mbGFncyhwZGV2LCBiYXIpOwo+IC0JcGdtYXAtPnJlZiA9ICZwMnBfcGdtYXAtPnJlZjsKPiAg
CXBnbWFwLT50eXBlID0gTUVNT1JZX0RFVklDRV9QQ0lfUDJQRE1BOwo+ICAJcGdtYXAtPnBjaV9w
MnBkbWFfYnVzX29mZnNldCA9IHBjaV9idXNfYWRkcmVzcyhwZGV2LCBiYXIpIC0KPiAgCQlwY2lf
cmVzb3VyY2Vfc3RhcnQocGRldiwgYmFyKTsKPiAtCXBnbWFwLT5vcHMgPSAmcGNpX3AycGRtYV9w
YWdlbWFwX29wczsKPiAgCj4gIAlhZGRyID0gZGV2bV9tZW1yZW1hcF9wYWdlcygmcGRldi0+ZGV2
LCBwZ21hcCk7Cj4gIAlpZiAoSVNfRVJSKGFkZHIpKSB7Cj4gQEAgLTIyNCw3ICsxNzUsNyBAQCBp
bnQgcGNpX3AycGRtYV9hZGRfcmVzb3VyY2Uoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGludCBiYXIs
IHNpemVfdCBzaXplLAo+ICAJZXJyb3IgPSBnZW5fcG9vbF9hZGRfb3duZXIocGRldi0+cDJwZG1h
LT5wb29sLCAodW5zaWduZWQgbG9uZylhZGRyLAo+ICAJCQlwY2lfYnVzX2FkZHJlc3MocGRldiwg
YmFyKSArIG9mZnNldCwKPiAgCQkJcmVzb3VyY2Vfc2l6ZSgmcGdtYXAtPnJlcyksIGRldl90b19u
b2RlKCZwZGV2LT5kZXYpLAo+IC0JCQkmcDJwX3BnbWFwLT5yZWYpOwo+ICsJCQlwZ21hcC0+cmVm
KTsKPiAgCWlmIChlcnJvcikKPiAgCQlnb3RvIHBhZ2VzX2ZyZWU7Cj4gIAo+IEBAIC0yMzYsNyAr
MTg3LDcgQEAgaW50IHBjaV9wMnBkbWFfYWRkX3Jlc291cmNlKHN0cnVjdCBwY2lfZGV2ICpwZGV2
LCBpbnQgYmFyLCBzaXplX3Qgc2l6ZSwKPiAgcGFnZXNfZnJlZToKPiAgCWRldm1fbWVtdW5tYXBf
cGFnZXMoJnBkZXYtPmRldiwgcGdtYXApOwo+ICBwZ21hcF9mcmVlOgo+IC0JZGV2bV9rZnJlZSgm
cGRldi0+ZGV2LCBwMnBfcGdtYXApOwo+ICsJZGV2bV9rZnJlZSgmcGRldi0+ZGV2LCBwZ21hcCk7
Cj4gIAlyZXR1cm4gZXJyb3I7Cj4gIH0KPiAgRVhQT1JUX1NZTUJPTF9HUEwocGNpX3AycGRtYV9h
ZGRfcmVzb3VyY2UpOwo+IC0tIAo+IDIuMjAuMQo+IAo+IF9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCj4gTGludXgtbnZkaW1tIG1haWxpbmcgbGlzdAo+IExp
bnV4LW52ZGltbUBsaXN0cy4wMS5vcmcKPiBodHRwczovL2xpc3RzLjAxLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2xpbnV4LW52ZGltbQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWw=
