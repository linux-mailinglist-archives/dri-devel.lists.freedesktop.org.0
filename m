Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5DBE610C279
	for <lists+dri-devel@lfdr.de>; Thu, 28 Nov 2019 03:42:49 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2E8E26E038;
	Thu, 28 Nov 2019 02:42:46 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw01.mediatek.com (unknown [210.61.82.183])
 by gabe.freedesktop.org (Postfix) with ESMTP id E02F66E5EA
 for <dri-devel@lists.freedesktop.org>; Thu, 28 Nov 2019 02:42:44 +0000 (UTC)
X-UUID: fb23e03461034fbe965408c5ddd1f299-20191128
X-UUID: fb23e03461034fbe965408c5ddd1f299-20191128
Received: from mtkexhb01.mediatek.inc [(172.21.101.102)] by
 mailgw01.mediatek.com (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 1801275288; Thu, 28 Nov 2019 10:42:42 +0800
Received: from mtkcas07.mediatek.inc (172.21.101.84) by
 mtkmbs07n1.mediatek.inc (172.21.101.16) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Thu, 28 Nov 2019 10:42:37 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas07.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Thu, 28 Nov 2019 10:42:46 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH v1 2/6] drm/mediatek: use DRM core's atomic commit helper
Date: Thu, 28 Nov 2019 10:42:34 +0800
Message-ID: <20191128024238.9399-3-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191128024238.9399-1-bibby.hsieh@mediatek.com>
References: <20191128024238.9399-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=mediatek.com; s=dk; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From;
 bh=P14uNYy6cxrL8Pyp9u5v/yKUSyTUz15inZ/F7fxu4b0=; 
 b=jHhAyBZJV0Zymth1ctWE4rTFEIURswvS8/atRSPG8i6y2SFObWeX/eBkusTSh+Aj2V3v1N/1E/IZeZ0ygAHBPaM7dhyrRA+1oYpP8iKMnadOXg7arHnfaFQlXz+Mu1B2739rvH+ilgjoOlqCcaGL1MyngL/gaDb4UPSuyZ3QVfs=;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, srv_heupstream@mediatek.com,
 linux-kernel@vger.kernel.org, tfiga@chromium.org,
 Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIERSTSBjb3JlIGF0b21pYyBoZWxwZXIgbm93IHN1cHBvcnRzIGFzeW5jaHJvbm91cyBjb21t
aXRzIG5hdGl2ZWx5Lg0KVGhlIGN1c3RvbSBkcm0gaW1wbGVtZW50YXRpb24gaXNuJ3QgbmVlZGVk
IGFueW1vcmUsIHJlbW92ZSBpdC4NCg0KU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWggPGJpYmJ5
LmhzaWVoQG1lZGlhdGVrLmNvbT4NCi0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX2Rydi5jIHwgODYgKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiBkcml2ZXJzL2dwdS9k
cm0vbWVkaWF0ZWsvbXRrX2RybV9kcnYuaCB8ICA3IC0tLQ0KIDIgZmlsZXMgY2hhbmdlZCwgNSBp
bnNlcnRpb25zKCspLCA4OCBkZWxldGlvbnMoLSkNCg0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tZWRpYXRlay9tdGtfZHJtX2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kcm1fZHJ2LmMNCmluZGV4IDY1ODhkYzZkZDVlMy4uMTZlNTc3MWQxODJlIDEwMDY0NA0KLS0t
IGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fZHJ2LmMNCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Rydi5jDQpAQCAtMzYsODkgKzM2LDE0IEBADQogI2Rl
ZmluZSBEUklWRVJfTUFKT1IgMQ0KICNkZWZpbmUgRFJJVkVSX01JTk9SIDANCiANCi1zdGF0aWMg
dm9pZCBtdGtfYXRvbWljX3NjaGVkdWxlKHN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgKnByaXZhdGUs
DQotCQkJCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkNCi17DQotCXByaXZhdGUtPmNv
bW1pdC5zdGF0ZSA9IHN0YXRlOw0KLQlzY2hlZHVsZV93b3JrKCZwcml2YXRlLT5jb21taXQud29y
ayk7DQotfQ0KLQ0KLXN0YXRpYyB2b2lkIG10a19hdG9taWNfY29tcGxldGUoc3RydWN0IG10a19k
cm1fcHJpdmF0ZSAqcHJpdmF0ZSwNCi0JCQkJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
KQ0KLXsNCi0Jc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IHByaXZhdGUtPmRybTsNCi0NCi0JZHJt
X2F0b21pY19oZWxwZXJfd2FpdF9mb3JfZmVuY2VzKGRybSwgc3RhdGUsIGZhbHNlKTsNCi0NCi0J
LyoNCi0JICogTWVkaWF0ZWsgZHJtIHN1cHBvcnRzIHJ1bnRpbWUgUE0sIHNvIHBsYW5lIHJlZ2lz
dGVycyBjYW5ub3QgYmUNCi0JICogd3JpdHRlbiB3aGVuIHRoZWlyIGNydGMgaXMgZGlzYWJsZWQu
DQotCSAqDQotCSAqIFRoZSBjb21tZW50IGZvciBkcm1fYXRvbWljX2hlbHBlcl9jb21taXQgc3Rh
dGVzOg0KLQkgKiAgICAgRm9yIGRyaXZlcnMgc3VwcG9ydGluZyBydW50aW1lIFBNIHRoZSByZWNv
bW1lbmRlZCBzZXF1ZW5jZSBpcw0KLQkgKg0KLQkgKiAgICAgZHJtX2F0b21pY19oZWxwZXJfY29t
bWl0X21vZGVzZXRfZGlzYWJsZXMoZGV2LCBzdGF0ZSk7DQotCSAqICAgICBkcm1fYXRvbWljX2hl
bHBlcl9jb21taXRfbW9kZXNldF9lbmFibGVzKGRldiwgc3RhdGUpOw0KLQkgKiAgICAgZHJtX2F0
b21pY19oZWxwZXJfY29tbWl0X3BsYW5lcyhkZXYsIHN0YXRlLA0KLQkgKiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBEUk1fUExBTkVfQ09NTUlUX0FDVElWRV9PTkxZKTsNCi0J
ICoNCi0JICogU2VlIHRoZSBrZXJuZWxkb2MgZW50cmllcyBmb3IgdGhlc2UgdGhyZWUgZnVuY3Rp
b25zIGZvciBtb3JlIGRldGFpbHMuDQotCSAqLw0KLQlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRf
bW9kZXNldF9kaXNhYmxlcyhkcm0sIHN0YXRlKTsNCi0JZHJtX2F0b21pY19oZWxwZXJfY29tbWl0
X21vZGVzZXRfZW5hYmxlcyhkcm0sIHN0YXRlKTsNCi0JZHJtX2F0b21pY19oZWxwZXJfY29tbWl0
X3BsYW5lcyhkcm0sIHN0YXRlLA0KLQkJCQkJRFJNX1BMQU5FX0NPTU1JVF9BQ1RJVkVfT05MWSk7
DQotDQotCWRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX3ZibGFua3MoZHJtLCBzdGF0ZSk7DQot
DQotCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKGRybSwgc3RhdGUpOw0KLQlkcm1f
YXRvbWljX3N0YXRlX3B1dChzdGF0ZSk7DQotfQ0KLQ0KLXN0YXRpYyB2b2lkIG10a19hdG9taWNf
d29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspDQotew0KLQlzdHJ1Y3QgbXRrX2RybV9wcml2
YXRlICpwcml2YXRlID0gY29udGFpbmVyX29mKHdvcmssDQotCQkJc3RydWN0IG10a19kcm1fcHJp
dmF0ZSwgY29tbWl0LndvcmspOw0KLQ0KLQltdGtfYXRvbWljX2NvbXBsZXRlKHByaXZhdGUsIHBy
aXZhdGUtPmNvbW1pdC5zdGF0ZSk7DQotfQ0KLQ0KLXN0YXRpYyBpbnQgbXRrX2F0b21pY19jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwNCi0JCQkgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSwNCi0JCQkgICAgIGJvb2wgYXN5bmMpDQotew0KLQlzdHJ1Y3QgbXRrX2RybV9w
cml2YXRlICpwcml2YXRlID0gZHJtLT5kZXZfcHJpdmF0ZTsNCi0JaW50IHJldDsNCi0NCi0JcmV0
ID0gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFyZV9wbGFuZXMoZHJtLCBzdGF0ZSk7DQotCWlmIChy
ZXQpDQotCQlyZXR1cm4gcmV0Ow0KLQ0KLQltdXRleF9sb2NrKCZwcml2YXRlLT5jb21taXQubG9j
ayk7DQotCWZsdXNoX3dvcmsoJnByaXZhdGUtPmNvbW1pdC53b3JrKTsNCi0NCi0JcmV0ID0gZHJt
X2F0b21pY19oZWxwZXJfc3dhcF9zdGF0ZShzdGF0ZSwgdHJ1ZSk7DQotCWlmIChyZXQpIHsNCi0J
CW11dGV4X3VubG9jaygmcHJpdmF0ZS0+Y29tbWl0LmxvY2spOw0KLQkJZHJtX2F0b21pY19oZWxw
ZXJfY2xlYW51cF9wbGFuZXMoZHJtLCBzdGF0ZSk7DQotCQlyZXR1cm4gcmV0Ow0KLQl9DQotDQot
CWRybV9hdG9taWNfc3RhdGVfZ2V0KHN0YXRlKTsNCi0JaWYgKGFzeW5jKQ0KLQkJbXRrX2F0b21p
Y19zY2hlZHVsZShwcml2YXRlLCBzdGF0ZSk7DQotCWVsc2UNCi0JCW10a19hdG9taWNfY29tcGxl
dGUocHJpdmF0ZSwgc3RhdGUpOw0KLQ0KLQltdXRleF91bmxvY2soJnByaXZhdGUtPmNvbW1pdC5s
b2NrKTsNCi0NCi0JcmV0dXJuIDA7DQotfQ0KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX21vZGVf
Y29uZmlnX2hlbHBlcl9mdW5jcyBtdGtfZHJtX21vZGVfY29uZmlnX2hlbHBlcnMgPSB7DQorCS5h
dG9taWNfY29tbWl0X3RhaWwgPSBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfdGFpbF9ycG0sDQor
fTsNCiANCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBtdGtfZHJt
X21vZGVfY29uZmlnX2Z1bmNzID0gew0KIAkuZmJfY3JlYXRlID0gbXRrX2RybV9tb2RlX2ZiX2Ny
ZWF0ZSwNCiAJLmF0b21pY19jaGVjayA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrLA0KLQkuYXRv
bWljX2NvbW1pdCA9IG10a19hdG9taWNfY29tbWl0LA0KKwkuYXRvbWljX2NvbW1pdCA9IGRybV9h
dG9taWNfaGVscGVyX2NvbW1pdCwNCiB9Ow0KIA0KIHN0YXRpYyBjb25zdCBlbnVtIG10a19kZHBf
Y29tcF9pZCBtdDI3MDFfbXRrX2RkcF9tYWluW10gPSB7DQpAQCAtMjY1LDYgKzE5MCw3IEBAIHN0
YXRpYyBpbnQgbXRrX2RybV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZHJtKQ0KIAlkcm0t
Pm1vZGVfY29uZmlnLm1heF93aWR0aCA9IDQwOTY7DQogCWRybS0+bW9kZV9jb25maWcubWF4X2hl
aWdodCA9IDQwOTY7DQogCWRybS0+bW9kZV9jb25maWcuZnVuY3MgPSAmbXRrX2RybV9tb2RlX2Nv
bmZpZ19mdW5jczsNCisJZHJtLT5tb2RlX2NvbmZpZy5oZWxwZXJfcHJpdmF0ZSA9ICZtdGtfZHJt
X21vZGVfY29uZmlnX2hlbHBlcnM7DQogDQogCXJldCA9IGNvbXBvbmVudF9iaW5kX2FsbChkcm0t
PmRldiwgZHJtKTsNCiAJaWYgKHJldCkNCkBAIC01NDAsOCArNDY2LDYgQEAgc3RhdGljIGludCBt
dGtfZHJtX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpDQogCWlmICghcHJpdmF0
ZSkNCiAJCXJldHVybiAtRU5PTUVNOw0KIA0KLQltdXRleF9pbml0KCZwcml2YXRlLT5jb21taXQu
bG9jayk7DQotCUlOSVRfV09SSygmcHJpdmF0ZS0+Y29tbWl0LndvcmssIG10a19hdG9taWNfd29y
ayk7DQogCXByaXZhdGUtPmRhdGEgPSBvZl9kZXZpY2VfZ2V0X21hdGNoX2RhdGEoZGV2KTsNCiAN
CiAJbWVtID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlKHBkZXYsIElPUkVTT1VSQ0VfTUVNLCAwKTsN
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Rydi5oDQppbmRleCBiNmE4MjcyOGQ1NjMu
LjlmNGNlNjAxNzRmNiAxMDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX2Rydi5oDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kcnYuaA0K
QEAgLTQ2LDEzICs0Niw2IEBAIHN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgew0KIAlzdHJ1Y3QgZGV2
aWNlX25vZGUgKmNvbXBfbm9kZVtERFBfQ09NUE9ORU5UX0lEX01BWF07DQogCXN0cnVjdCBtdGtf
ZGRwX2NvbXAgKmRkcF9jb21wW0REUF9DT01QT05FTlRfSURfTUFYXTsNCiAJY29uc3Qgc3RydWN0
IG10a19tbXN5c19kcml2ZXJfZGF0YSAqZGF0YTsNCi0NCi0Jc3RydWN0IHsNCi0JCXN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZTsNCi0JCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOw0KLQkJ
c3RydWN0IG11dGV4IGxvY2s7DQotCX0gY29tbWl0Ow0KLQ0KIAlzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3VzcGVuZF9zdGF0ZTsNCiANCiAJYm9vbCBkbWFfcGFybXNfYWxsb2NhdGVkOw0KLS0g
DQoyLjE4LjANCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
