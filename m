Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D38C875545
	for <lists+dri-devel@lfdr.de>; Thu, 25 Jul 2019 19:19:48 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BF0E36E7D8;
	Thu, 25 Jul 2019 17:19:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0C4BD6E7D7
 for <dri-devel@lists.freedesktop.org>; Thu, 25 Jul 2019 17:19:37 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 62BC1AFE1;
 Thu, 25 Jul 2019 17:19:35 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org, airlied@redhat.com,
 yc_chen@aspeedtech.com, Christian.Koenig@amd.com
Subject: [PATCH v2 1/3] drm/vram: Provide vmap and vunmap operations for GEM
 VRAM objects
Date: Thu, 25 Jul 2019 19:19:30 +0200
Message-Id: <20190725171932.31189-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190725171932.31189-1-tzimmermann@suse.de>
References: <20190725171932.31189-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHBhdHRlcm4gb2YgdGVtcG9yYXJpbHkgcGlubmluZyBhbmQga21hcC1pbmcgdGhlIEJPJ3Mg
bWVtb3J5IGlzCmNvbW1vbiBlbm91Z2ggdG8ganVzdGlmeSBoZWxwZXIgZnVuY3Rpb25zIHRoYXQg
ZG8gYW5kIHVuZG8gdGhlc2UKb3BlcmF0aW9ucy4KClRoZSBpbXBsZW1lbnRhdGlvbiBvZiB2bWFw
IGFuZCB2dW5tYXAgZm9yIEdFTSBWUkFNIGhlbHBlcnMgaXMKYWxyZWFkeSBpbiBQUklNRSBoZWxw
ZXJzLiBUaGUgcGF0Y2ggbW92ZXMgdGhlIG9wZXJhdGlvbnMgdG8gc2VwYXJhdGUKZnVuY3Rpb25z
IGFuZCBleHBvcnRzIHRoZW0gZm9yIGdlbmVyYWwgdXNlLgoKVGhlIHBhdGNoIGFsc28gYWRkcyBh
IG5vdGUgYWJvdXQgcG9zc2libGUga21hcCBjb3VudGluZy4gU28gZmFyIHRoaXMKaXNuJ3QgcmVx
dWlyZWQgYnkgZHJpdmVycywgYnV0IG1vcmUgY29tcGxleCB1c2UgY2FzZXMgbWlnaHQgbWFrZSBp
dApuZWNlc3NhcnkuCgp2MjoKCSogZml4IGRvY3VtZW50YXRpb24KCSogYWRkIGNyb3NzIHJlZmVy
ZW5jZXMgdG8gZnVuY3Rpb24gZG9jdW1lbnRhdGlvbgoJKiBkb2N1bWVudCAodGhlIGxhY2sgb2Yp
IHJlZi1jb3VudGluZyBmb3IgR0VNIFZSQU0gQk8gbWFwcGluZ3MKClNpZ25lZC1vZmYtYnk6IFRo
b21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgfCA2MyArKysrKysrKysrKysrKysrKysrKysrLS0tLS0K
IGluY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaCAgICAgfCAxMyArKysrKysKIDIgZmls
ZXMgY2hhbmdlZCwgNjYgaW5zZXJ0aW9ucygrKSwgMTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKaW5kZXggZTBmYmZiNjU3MGNmLi5mOWIyYjhlMTJiNDkg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwpAQCAtMzQwLDYgKzM0MCw1NiBA
QCB2b2lkIGRybV9nZW1fdnJhbV9rdW5tYXAoc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdi
bykKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92cmFtX2t1bm1hcCk7CiAKKy8qKgorICogZHJt
X2dlbV92cmFtX3ZtYXAoKSAtIFBpbnMgYW5kIG1hcHMgYSBHRU0gVlJBTSBvYmplY3QgaW50byBr
ZXJuZWwgYWRkcmVzcworCXNwYWNlCisgKiBAZ2JvOglUaGUgR0VNIFZSQU0gb2JqZWN0IHRvIG1h
cAorICoKKyAqIFRoZSB2bWFwIGZ1bmN0aW9uIHBpbnMgYSBHRU0gVlJBTSBvYmplY3QgdG8gaXRz
IGN1cnJlbnQgbG9jYXRpb24sIGVpdGhlcgorICogc3lzdGVtIG9yIHZpZGVvIG1lbW9yeSwgYW5k
IG1hcHMgaXRzIGJ1ZmZlciBpbnRvIGtlcm5lbCBhZGRyZXNzIHNwYWNlLiBBcworICogcGlubmVk
IG9iamVjdCBjYW5ub3QgYmUgcmVsb2NhdGVkLCB5b3Ugc2hvdWxkIG5vdCBwZXJtYW5lbnRseSBw
aW4gb2JqZWN0cy4KKyAqIENhbGwgZHJtX2dlbV92cmFtX3Z1bm1hcCgpIHdpdGggdGhlIHJldHVy
bmVkIGFkZHJlc3MgdG8gdW5tYXAgYW5kIHVucGluCisgKiB0aGUgR0VNIFZSQU0gb2JqZWN0Lgor
ICoKKyAqIElmIHlvdSBoYXZlIHNwZWNpYWwgcmVxdWlyZW1lbnRzIGZvciB0aGUgcGlubmluZyBv
ciBtYXBwaW5nIG9wZXJhdGlvbnMsCisgKiBjYWxsIGRybV9nZW1fdnJhbV9waW4oKSBhbmQgZHJt
X2dlbV92cmFtX2ttYXAoKSBkaXJlY3RseS4KKyAqCisgKiBSZXR1cm5zOgorICogVGhlIGJ1ZmZl
cidzIHZpcnR1YWwgYWRkcmVzcyBvbiBzdWNjZXNzLCBvcgorICogYW4gRVJSX1BUUigpLWVuY29k
ZWQgZXJyb3IgY29kZSBvdGhlcndpc2UuCisgKi8KK3ZvaWQgKmRybV9nZW1fdnJhbV92bWFwKHN0
cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8pCit7CisJaW50IHJldDsKKwl2b2lkICpiYXNl
OworCisJcmV0ID0gZHJtX2dlbV92cmFtX3BpbihnYm8sIDApOworCWlmIChyZXQpCisJCXJldHVy
biBFUlJfUFRSKHJldCk7CisJYmFzZSA9IGRybV9nZW1fdnJhbV9rbWFwKGdibywgdHJ1ZSwgTlVM
TCk7CisJaWYgKElTX0VSUihiYXNlKSkgeworCQlkcm1fZ2VtX3ZyYW1fdW5waW4oZ2JvKTsKKwkJ
cmV0dXJuIGJhc2U7CisJfQorCXJldHVybiBiYXNlOworfQorRVhQT1JUX1NZTUJPTChkcm1fZ2Vt
X3ZyYW1fdm1hcCk7CisKKy8qKgorICogZHJtX2dlbV92cmFtX3Z1bm1hcCgpIC0gVW5tYXBzIGFu
ZCB1bnBpbnMgYSBHRU0gVlJBTSBvYmplY3QKKyAqIEBnYm86CVRoZSBHRU0gVlJBTSBvYmplY3Qg
dG8gdW5tYXAKKyAqIEB2YWRkcjoJVGhlIG1hcHBpbmcncyBiYXNlIGFkZHJlc3MgYXMgcmV0dXJu
ZWQgYnkgZHJtX2dlbV92cmFtX3ZtYXAoKQorICoKKyAqIEEgY2FsbCB0byBkcm1fZ2VtX3ZyYW1f
dnVubWFwKCkgdW5tYXBzIGFuZCB1bnBpbnMgYSBHRU0gVlJBTSBidWZmZXIuIFNlZQorICogdGhl
IGRvY3VtZW50YXRpb24gZm9yIGRybV9nZW1fdnJhbV92bWFwKCkgZm9yIG1vcmUgaW5mb3JtYXRp
b24uCisgKi8KK3ZvaWQgZHJtX2dlbV92cmFtX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV92cmFtX29i
amVjdCAqZ2JvLCB2b2lkICp2YWRkcikKK3sKKwlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7CisJ
ZHJtX2dlbV92cmFtX3VucGluKGdibyk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV92
dW5tYXApOworCiAvKioKICAqIGRybV9nZW1fdnJhbV9maWxsX2NyZWF0ZV9kdW1iKCkgLSBcCiAJ
SGVscGVyIGZvciBpbXBsZW1lbnRpbmcgJnN0cnVjdCBkcm1fZHJpdmVyLmR1bWJfY3JlYXRlCkBA
IC01OTUsMTcgKzY0NSwxMSBAQCBzdGF0aWMgdm9pZCBkcm1fZ2VtX3ZyYW1fb2JqZWN0X3VucGlu
KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtKQogc3RhdGljIHZvaWQgKmRybV9nZW1fdnJhbV9v
YmplY3Rfdm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSkKIHsKIAlzdHJ1Y3QgZHJtX2dl
bV92cmFtX29iamVjdCAqZ2JvID0gZHJtX2dlbV92cmFtX29mX2dlbShnZW0pOwotCWludCByZXQ7
CiAJdm9pZCAqYmFzZTsKIAotCXJldCA9IGRybV9nZW1fdnJhbV9waW4oZ2JvLCAwKTsKLQlpZiAo
cmV0KQorCWJhc2UgPSBkcm1fZ2VtX3ZyYW1fdm1hcChnYm8pOworCWlmIChJU19FUlIoYmFzZSkp
CiAJCXJldHVybiBOVUxMOwotCWJhc2UgPSBkcm1fZ2VtX3ZyYW1fa21hcChnYm8sIHRydWUsIE5V
TEwpOwotCWlmIChJU19FUlIoYmFzZSkpIHsKLQkJZHJtX2dlbV92cmFtX3VucGluKGdibyk7Ci0J
CXJldHVybiBOVUxMOwotCX0KIAlyZXR1cm4gYmFzZTsKIH0KIApAQCAtNjIwLDggKzY2NCw3IEBA
IHN0YXRpYyB2b2lkIGRybV9nZW1fdnJhbV9vYmplY3RfdnVubWFwKHN0cnVjdCBkcm1fZ2VtX29i
amVjdCAqZ2VtLAogewogCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8gPSBkcm1fZ2Vt
X3ZyYW1fb2ZfZ2VtKGdlbSk7CiAKLQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7Ci0JZHJtX2dl
bV92cmFtX3VucGluKGdibyk7CisJZHJtX2dlbV92cmFtX3Z1bm1hcChnYm8sIHZhZGRyKTsKIH0K
IAogLyoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaCBiL2lu
Y2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaAppbmRleCBiNDFkOTMyZWI1M2EuLjg4ZGE0
NjU1MmQwNyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oCisr
KyBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaApAQCAtMzQsNiArMzQsMTcgQEAg
c3RydWN0IHZtX2FyZWFfc3RydWN0OwogICogYmFja2VkIGJ5IFZSQU0uIEl0IGNhbiBiZSB1c2Vk
IGZvciBzaW1wbGUgZnJhbWVidWZmZXIgZGV2aWNlcyB3aXRoCiAgKiBkZWRpY2F0ZWQgbWVtb3J5
LiBUaGUgYnVmZmVyIG9iamVjdCBjYW4gYmUgZXZpY3RlZCB0byBzeXN0ZW0gbWVtb3J5IGlmCiAg
KiB2aWRlbyBtZW1vcnkgYmVjb21lcyBzY2FyY2UuCisgKgorICogR0VNIFZSQU0gb2JqZWN0cyBw
ZXJmb3JtIGEgcmVmZXJlbmNlIGNvdW50aW5nIGZvciBwaW4gb3BlcmF0aW9ucy4gU28gYQorICog
YnVmZmVyIG9iamVjdCB0aGF0IGhhcyBiZWVuIHBpbm5lZCBOIHRpbWVzIHdpdGggZHJtX2dlbV92
cmFtX3BpbigpIG11c3QKKyAqIGJlIHVucGlubmVkIE4gdGltZXMgd2l0aCBkcm1fZ2VtX3ZyYW1f
dW5waW4oKS4KKyAqCisgKiBTbyBmYXIsIGRyaXZlcnMgYmFzZWQgb24gVlJBTSBoZWxwZXJzIGRv
bid0IGhhdmUgb3ZlcmxhcHBpbmcKKyAqIG1hcHBpbmcgb3BlcmF0aW9ucy4gQSBkcml2ZXIgdGVt
cG9yYXJpbHkgbWFwcyBhbiBvYmplY3Qgd2l0aAorICogZHJtX2dlbV92cmFtX2ttYXAoKWFuZCB1
bm1hcHMgaXQgQVNBUCB3aXRoIGRybV9nZW1fdnJhbV9rdW5tYXAoKS4gVGhpcworICogd29ya3Mg
d2VsbCBmb3IgZmJkZXYgZW11bGF0aW9uIG9yIGN1cnNvciBpbWFnZXMuICBJZiB3ZSBldmVyIGhh
dmUgYQorICogZHJpdmVyIHdpdGggYnVmZmVyIG9iamVjdHMgdGhhdCBhcmUgbWFwcGVkIGJ5IG11
bHRpcGxlIGNvZGUgZnJhZ21lbnRzCisgKiBjb25jdXJyZW50bHksIHdlIG1heSBuZWVkIGEgbWFw
IGNvdW50ZXIgdG8gZ2V0IHRoZSBtYXBwaW5nIHJpZ2h0LgogICovCiBzdHJ1Y3QgZHJtX2dlbV92
cmFtX29iamVjdCB7CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0IGdlbTsKQEAgLTg0LDYgKzk1LDgg
QEAgaW50IGRybV9nZW1fdnJhbV91bnBpbihzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2Jv
KTsKIHZvaWQgKmRybV9nZW1fdnJhbV9rbWFwKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpn
Ym8sIGJvb2wgbWFwLAogCQkJYm9vbCAqaXNfaW9tZW0pOwogdm9pZCBkcm1fZ2VtX3ZyYW1fa3Vu
bWFwKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8pOwordm9pZCAqZHJtX2dlbV92cmFt
X3ZtYXAoc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibyk7Cit2b2lkIGRybV9nZW1fdnJh
bV92dW5tYXAoc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibywgdm9pZCAqdmFkZHIpOwog
CiBpbnQgZHJtX2dlbV92cmFtX2ZpbGxfY3JlYXRlX2R1bWIoc3RydWN0IGRybV9maWxlICpmaWxl
LAogCQkJCSAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLS0gCjIuMjIuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
