Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 11EFE17674F
	for <lists+dri-devel@lfdr.de>; Mon,  2 Mar 2020 23:28:44 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A85CC6E8DB;
	Mon,  2 Mar 2020 22:27:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EA01B6E8F0
 for <dri-devel@lists.freedesktop.org>; Mon,  2 Mar 2020 22:27:37 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id t11so1866468wrw.5
 for <dri-devel@lists.freedesktop.org>; Mon, 02 Mar 2020 14:27:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=jOHkIB418sI1cQQW2C00uPuecWo7JOzZ7gK8pCd9+74=;
 b=MjtzDScZOjZGzV7cBj5lnT6j57rGzDMuqqYZR5UOyeuP8knKPeMIbBXtcCHWKWJLqF
 9F+vdYv5YLmbx8oPvR798XDMN2xlKuxsJQtIWtyxPKHmWhU584eccpj9DVi4bNI7YuZY
 dLq7no+Q0BUjHeITaC0fNB6rXOpXfL3WbPY70=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=jOHkIB418sI1cQQW2C00uPuecWo7JOzZ7gK8pCd9+74=;
 b=ABuyJD/veg3eobmbbZMerw3gQg3DJYEJLAyEvpqmdzM2pyjRaAMZRmu7SUk9yBiRZg
 UGKHfSURx5Hi5ld0s05v73XQSUK6gvabOtEz3GrvfhygX7BMk391fYirwfd4gdRVESm3
 c1BFYPgPxWhIy3emhQvC+NdadXltTer7TSD9UDbf7/RM2PjLIKg/0o1QQU0oXGM9c4jZ
 f1wv7GdM7nTdq4aEMadIn/SAlxX1dSnIphpRZzJ2wrHX6vrbYo3sAZezBaV+MLKuprFD
 ijc+wj50ZaG1A3phz6tN1vrjBQ7iPChzGwdd/yRkDQ845NFC+P4HQgXG3Ltfow0lIDkB
 t3eA==
X-Gm-Message-State: ANhLgQ17TJCppUF8YokfMUUy6aU+6juUL1yu61br8ECm2tY4z70Rtorp
 S065o97jkmKDJBaqU4qFsYJH1ymagyw=
X-Google-Smtp-Source: ADFU+vt39jkgB2bYmLKWaMRjr3SHp92CdK1uD2SxLv1aFwIFg3BbH5LXqeWeVc0QvsV8hHOgMweqrQ==
X-Received: by 2002:a5d:6051:: with SMTP id j17mr1573488wrt.151.1583188056152; 
 Mon, 02 Mar 2020 14:27:36 -0800 (PST)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id o18sm26114589wrv.60.2020.03.02.14.27.35
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 02 Mar 2020 14:27:35 -0800 (PST)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 45/51] drm/gm12u320: Simplify upload work
Date: Mon,  2 Mar 2020 23:26:25 +0100
Message-Id: <20200302222631.3861340-46-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200302222631.3861340-1-daniel.vetter@ffwll.ch>
References: <20200302222631.3861340-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@intel.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 Hans de Goede <hdegoede@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBoYXZpbmcgYSB3b3JrIGl0ZW0gdGhhdCBuZXZlciBzdG9wcyAod2hpY2ggcmVh
bGx5IHNob3VsZCBiZQphIGt0aHJlYWQpLCB3aXRoIGEgZGVkaWNhdGVkIHdvcmtxdWV1ZSB0byBu
b3QgdXBzZXQgYW55b25lIGVsc2UsIHVzZSBhCmRlbGF5ZWQgd29yay4gQSBidW5jaCBvZiBjaGFu
Z2VzOgoKLSBXZSBjYW4gdGhyb3cgb3V0IGFsbCB0aGUgY3VzdG9tIHdha2V1cCBhbmQgcmVxdWV1
ZSBsb2dpYyBhbmQgc3RhdGUKICB0cmFja2luZy4gSWYgd2Ugc2NoZWR1bGUgdGhlIHdvcmsgd2l0
aCBhIDAgZGVsYXkgaXQnbGwgZ2V0CiAgc2NoZWR1bGVkIGltbWVkaWF0ZWx5LgoKLSBQZXJzaXN0
ZW50IHN0YXRlIChmcmFtZSAmIGRyYXdfc3RhdHVzX3RpbWVvdXQpIG5lZWQgdG8gYmUgbW92ZWQg
b3V0CiAgb2YgdGhlIHdvcmsuCgotIGRpZmYgaXMgYmlnZ2VyIHRoYW4gdGhlIGNoYW5nZXMsIGJp
Z2dlc3QgY2h1bmsgaXMgcmVpbmRlbnRpbmcgdGhlCiAgd29yayBmbiBiZWNhdXNlIGl0IGxvc3Qg
aXRzIHdoaWxlIGxvb3AuCgpMb3RzIG9mIGNvZGUgZGVsZXRpbmcgYXMgY29uc2VxdWVuY2UgYWxs
IG92ZXIuIFNwZWNpZmljYWxseSB3ZSBjYW4KZGVsZXRlIHRoZSBkcm1fZHJpdmVyLnJlbGVhc2Ug
Y29kZSBub3chCgp2MjogUmV2aWV3IGZyb20gSGFuczoKLSBVc2UgbW9kX2RlbGF5ZWRfd29yayBp
biB0aGUgcGxhbmUgdXBkYXRlIHBhdGggdG8gbWFrZSBzdXJlIHdlIGRvCiAgYWN0dWFsbHkgc2No
ZWR1bGUgaW1tZWRpYXRlbHkpLiBJbiB0aGUgd29ya2VyIHdlIHN0aWxsIHdhbnQKICBxdWV1ZV9k
ZWxheWVkX3dvcmssIHdoaWNoIHdvbid0IG1vZGlmeSB0aGUgdGltZW91dCB3aGVuIHRoZSB3b3Jr
IGlzCiAgYWxyZWFkeSBzY2hlZHVsZWQuIFdoaWNoIGlzIGV4YWN0bHkgd2hhdCB3ZSB3YW50IGlm
IHRoZSB3b3JrIHJhY2VzCiAgd2l0aCBhIHBsYW5lIHVwZGF0ZS4KLSBTd2l0Y2ggdG8gc3lzdGVt
X2xvbmdfd3EsIEhhbnMgc2F5cyBvbiB1c2IyIGEgcGxhbmUgdXBsb2FkIGNhbiB0YWtlCiAgODAg
bXMuCgpSZXZpZXdlZC1ieTogSGFucyBkZSBHb2VkZSA8aGRlZ29lZGVAcmVkaGF0LmNvbT4KU2ln
bmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBI
YW5zIGRlIEdvZWRlIDxoZGVnb2VkZUByZWRoYXQuY29tPgpDYzogIk5vcmFsZiBUcsO4bm5lcyIg
PG5vcmFsZkB0cm9ubmVzLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdGlueS9nbTEydTMyMC5j
IHwgMTcxICsrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
NjggaW5zZXJ0aW9ucygrKSwgMTAzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS90aW55L2dtMTJ1MzIwLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlueS9nbTEydTMyMC5j
CmluZGV4IDk2MjdjYmMzZWM2NC4uNmYwZWEyODI3ZDYyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vdGlueS9nbTEydTMyMC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90aW55L2dtMTJ1MzIw
LmMKQEAgLTg5LDEzICs4OSwxMiBAQCBzdHJ1Y3QgZ20xMnUzMjBfZGV2aWNlIHsKIAl1bnNpZ25l
ZCBjaGFyICAgICAgICAgICAgICAgICAgICpjbWRfYnVmOwogCXVuc2lnbmVkIGNoYXIgICAgICAg
ICAgICAgICAgICAgKmRhdGFfYnVmW0dNMTJVMzIwX0JMT0NLX0NPVU5UXTsKIAlzdHJ1Y3Qgewot
CQlib29sICAgICAgICAgICAgICAgICAgICAgcnVuOwotCQlzdHJ1Y3Qgd29ya3F1ZXVlX3N0cnVj
dCAqd29ya3E7Ci0JCXN0cnVjdCB3b3JrX3N0cnVjdCAgICAgICB3b3JrOwotCQl3YWl0X3F1ZXVl
X2hlYWRfdCAgICAgICAgd2FpdHE7CisJCXN0cnVjdCBkZWxheWVkX3dvcmsgICAgICAgd29yazsK
IAkJc3RydWN0IG11dGV4ICAgICAgICAgICAgIGxvY2s7CiAJCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgICpmYjsKIAkJc3RydWN0IGRybV9yZWN0ICAgICAgICAgIHJlY3Q7CisJCWludCBmcmFtZTsK
KwkJaW50IGRyYXdfc3RhdHVzX3RpbWVvdXQ7CiAJfSBmYl91cGRhdGU7CiB9OwogCkBAIC0xODMs
MTkgKzE4Miw5IEBAIHN0YXRpYyBpbnQgZ20xMnUzMjBfdXNiX2FsbG9jKHN0cnVjdCBnbTEydTMy
MF9kZXZpY2UgKmdtMTJ1MzIwKQogCQkgICAgICAgZGF0YV9ibG9ja19mb290ZXIsIERBVEFfQkxP
Q0tfRk9PVEVSX1NJWkUpOwogCX0KIAotCWdtMTJ1MzIwLT5mYl91cGRhdGUud29ya3EgPSBjcmVh
dGVfc2luZ2xldGhyZWFkX3dvcmtxdWV1ZShEUklWRVJfTkFNRSk7Ci0JaWYgKCFnbTEydTMyMC0+
ZmJfdXBkYXRlLndvcmtxKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXJldHVybiAwOwogfQogCi1z
dGF0aWMgdm9pZCBnbTEydTMyMF91c2JfZnJlZShzdHJ1Y3QgZ20xMnUzMjBfZGV2aWNlICpnbTEy
dTMyMCkKLXsKLQlpZiAoZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrcSkKLQkJZGVzdHJveV93b3Jr
cXVldWUoZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrcSk7Ci19Ci0KIHN0YXRpYyBpbnQgZ20xMnUz
MjBfbWlzY19yZXF1ZXN0KHN0cnVjdCBnbTEydTMyMF9kZXZpY2UgKmdtMTJ1MzIwLAogCQkJCSB1
OCByZXFfYSwgdTggcmVxX2IsCiAJCQkJIHU4IGFyZ19hLCB1OCBhcmdfYiwgdTggYXJnX2MsIHU4
IGFyZ19kKQpAQCAtMzM4LDgwICszMjcsNzcgQEAgc3RhdGljIHZvaWQgZ20xMnUzMjBfY29weV9m
Yl90b19ibG9ja3Moc3RydWN0IGdtMTJ1MzIwX2RldmljZSAqZ20xMnUzMjApCiBzdGF0aWMgdm9p
ZCBnbTEydTMyMF9mYl91cGRhdGVfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJ
c3RydWN0IGdtMTJ1MzIwX2RldmljZSAqZ20xMnUzMjAgPQotCQljb250YWluZXJfb2Yod29yaywg
c3RydWN0IGdtMTJ1MzIwX2RldmljZSwgZmJfdXBkYXRlLndvcmspOwotCWludCBkcmF3X3N0YXR1
c190aW1lb3V0ID0gRklSU1RfRlJBTUVfVElNRU9VVDsKKwkJY29udGFpbmVyX29mKHRvX2RlbGF5
ZWRfd29yayh3b3JrKSwgc3RydWN0IGdtMTJ1MzIwX2RldmljZSwKKwkJCSAgICAgZmJfdXBkYXRl
LndvcmspOwogCWludCBibG9jaywgYmxvY2tfc2l6ZSwgbGVuOwotCWludCBmcmFtZSA9IDA7CiAJ
aW50IHJldCA9IDA7CiAKLQl3aGlsZSAoZ20xMnUzMjAtPmZiX3VwZGF0ZS5ydW4pIHsKLQkJZ20x
MnUzMjBfY29weV9mYl90b19ibG9ja3MoZ20xMnUzMjApOwotCi0JCWZvciAoYmxvY2sgPSAwOyBi
bG9jayA8IEdNMTJVMzIwX0JMT0NLX0NPVU5UOyBibG9jaysrKSB7Ci0JCQlpZiAoYmxvY2sgPT0g
R00xMlUzMjBfQkxPQ0tfQ09VTlQgLSAxKQotCQkJCWJsb2NrX3NpemUgPSBEQVRBX0xBU1RfQkxP
Q0tfU0laRTsKLQkJCWVsc2UKLQkJCQlibG9ja19zaXplID0gREFUQV9CTE9DS19TSVpFOwotCi0J
CQkvKiBTZW5kIGRhdGEgY29tbWFuZCB0byBkZXZpY2UgKi8KLQkJCW1lbWNweShnbTEydTMyMC0+
Y21kX2J1ZiwgY21kX2RhdGEsIENNRF9TSVpFKTsKLQkJCWdtMTJ1MzIwLT5jbWRfYnVmWzhdID0g
YmxvY2tfc2l6ZSAmIDB4ZmY7Ci0JCQlnbTEydTMyMC0+Y21kX2J1Zls5XSA9IGJsb2NrX3NpemUg
Pj4gODsKLQkJCWdtMTJ1MzIwLT5jbWRfYnVmWzIwXSA9IDB4ZmMgLSBibG9jayAqIDQ7Ci0JCQln
bTEydTMyMC0+Y21kX2J1ZlsyMV0gPSBibG9jayB8IChmcmFtZSA8PCA3KTsKLQotCQkJcmV0ID0g
dXNiX2J1bGtfbXNnKGdtMTJ1MzIwLT51ZGV2LAotCQkJCXVzYl9zbmRidWxrcGlwZShnbTEydTMy
MC0+dWRldiwgREFUQV9TTkRfRVBUKSwKLQkJCQlnbTEydTMyMC0+Y21kX2J1ZiwgQ01EX1NJWkUs
ICZsZW4sCi0JCQkJQ01EX1RJTUVPVVQpOwotCQkJaWYgKHJldCB8fCBsZW4gIT0gQ01EX1NJWkUp
Ci0JCQkJZ290byBlcnI7Ci0KLQkJCS8qIFNlbmQgZGF0YSBibG9jayB0byBkZXZpY2UgKi8KLQkJ
CXJldCA9IHVzYl9idWxrX21zZyhnbTEydTMyMC0+dWRldiwKLQkJCQl1c2Jfc25kYnVsa3BpcGUo
Z20xMnUzMjAtPnVkZXYsIERBVEFfU05EX0VQVCksCi0JCQkJZ20xMnUzMjAtPmRhdGFfYnVmW2Js
b2NrXSwgYmxvY2tfc2l6ZSwKLQkJCQkmbGVuLCBEQVRBX1RJTUVPVVQpOwotCQkJaWYgKHJldCB8
fCBsZW4gIT0gYmxvY2tfc2l6ZSkKLQkJCQlnb3RvIGVycjsKLQotCQkJLyogUmVhZCBzdGF0dXMg
Ki8KLQkJCXJldCA9IHVzYl9idWxrX21zZyhnbTEydTMyMC0+dWRldiwKLQkJCQl1c2JfcmN2YnVs
a3BpcGUoZ20xMnUzMjAtPnVkZXYsIERBVEFfUkNWX0VQVCksCi0JCQkJZ20xMnUzMjAtPmNtZF9i
dWYsIFJFQURfU1RBVFVTX1NJWkUsICZsZW4sCi0JCQkJQ01EX1RJTUVPVVQpOwotCQkJaWYgKHJl
dCB8fCBsZW4gIT0gUkVBRF9TVEFUVVNfU0laRSkKLQkJCQlnb3RvIGVycjsKLQkJfQorCWdtMTJ1
MzIwX2NvcHlfZmJfdG9fYmxvY2tzKGdtMTJ1MzIwKTsKKworCWZvciAoYmxvY2sgPSAwOyBibG9j
ayA8IEdNMTJVMzIwX0JMT0NLX0NPVU5UOyBibG9jaysrKSB7CisJCWlmIChibG9jayA9PSBHTTEy
VTMyMF9CTE9DS19DT1VOVCAtIDEpCisJCQlibG9ja19zaXplID0gREFUQV9MQVNUX0JMT0NLX1NJ
WkU7CisJCWVsc2UKKwkJCWJsb2NrX3NpemUgPSBEQVRBX0JMT0NLX1NJWkU7CisKKwkJLyogU2Vu
ZCBkYXRhIGNvbW1hbmQgdG8gZGV2aWNlICovCisJCW1lbWNweShnbTEydTMyMC0+Y21kX2J1Ziwg
Y21kX2RhdGEsIENNRF9TSVpFKTsKKwkJZ20xMnUzMjAtPmNtZF9idWZbOF0gPSBibG9ja19zaXpl
ICYgMHhmZjsKKwkJZ20xMnUzMjAtPmNtZF9idWZbOV0gPSBibG9ja19zaXplID4+IDg7CisJCWdt
MTJ1MzIwLT5jbWRfYnVmWzIwXSA9IDB4ZmMgLSBibG9jayAqIDQ7CisJCWdtMTJ1MzIwLT5jbWRf
YnVmWzIxXSA9CisJCQlibG9jayB8IChnbTEydTMyMC0+ZmJfdXBkYXRlLmZyYW1lIDw8IDcpOwog
Ci0JCS8qIFNlbmQgZHJhdyBjb21tYW5kIHRvIGRldmljZSAqLwotCQltZW1jcHkoZ20xMnUzMjAt
PmNtZF9idWYsIGNtZF9kcmF3LCBDTURfU0laRSk7CiAJCXJldCA9IHVzYl9idWxrX21zZyhnbTEy
dTMyMC0+dWRldiwKIAkJCXVzYl9zbmRidWxrcGlwZShnbTEydTMyMC0+dWRldiwgREFUQV9TTkRf
RVBUKSwKLQkJCWdtMTJ1MzIwLT5jbWRfYnVmLCBDTURfU0laRSwgJmxlbiwgQ01EX1RJTUVPVVQp
OworCQkJZ20xMnUzMjAtPmNtZF9idWYsIENNRF9TSVpFLCAmbGVuLAorCQkJQ01EX1RJTUVPVVQp
OwogCQlpZiAocmV0IHx8IGxlbiAhPSBDTURfU0laRSkKIAkJCWdvdG8gZXJyOwogCisJCS8qIFNl
bmQgZGF0YSBibG9jayB0byBkZXZpY2UgKi8KKwkJcmV0ID0gdXNiX2J1bGtfbXNnKGdtMTJ1MzIw
LT51ZGV2LAorCQkJdXNiX3NuZGJ1bGtwaXBlKGdtMTJ1MzIwLT51ZGV2LCBEQVRBX1NORF9FUFQp
LAorCQkJZ20xMnUzMjAtPmRhdGFfYnVmW2Jsb2NrXSwgYmxvY2tfc2l6ZSwKKwkJCSZsZW4sIERB
VEFfVElNRU9VVCk7CisJCWlmIChyZXQgfHwgbGVuICE9IGJsb2NrX3NpemUpCisJCQlnb3RvIGVy
cjsKKwogCQkvKiBSZWFkIHN0YXR1cyAqLwogCQlyZXQgPSB1c2JfYnVsa19tc2coZ20xMnUzMjAt
PnVkZXYsCiAJCQl1c2JfcmN2YnVsa3BpcGUoZ20xMnUzMjAtPnVkZXYsIERBVEFfUkNWX0VQVCks
CiAJCQlnbTEydTMyMC0+Y21kX2J1ZiwgUkVBRF9TVEFUVVNfU0laRSwgJmxlbiwKLQkJCWRyYXdf
c3RhdHVzX3RpbWVvdXQpOworCQkJQ01EX1RJTUVPVVQpOwogCQlpZiAocmV0IHx8IGxlbiAhPSBS
RUFEX1NUQVRVU19TSVpFKQogCQkJZ290byBlcnI7Ci0KLQkJZHJhd19zdGF0dXNfdGltZW91dCA9
IENNRF9USU1FT1VUOwotCQlmcmFtZSA9ICFmcmFtZTsKLQotCQkvKgotCQkgKiBXZSBtdXN0IGRy
YXcgYSBmcmFtZSBldmVyeSAycyBvdGhlcndpc2UgdGhlIHByb2plY3RvcgotCQkgKiBzd2l0Y2hl
cyBiYWNrIHRvIHNob3dpbmcgaXRzIGxvZ28uCi0JCSAqLwotCQl3YWl0X2V2ZW50X3RpbWVvdXQo
Z20xMnUzMjAtPmZiX3VwZGF0ZS53YWl0cSwKLQkJCQkgICAhZ20xMnUzMjAtPmZiX3VwZGF0ZS5y
dW4gfHwKLQkJCQkJZ20xMnUzMjAtPmZiX3VwZGF0ZS5mYiAhPSBOVUxMLAotCQkJCSAgIElETEVf
VElNRU9VVCk7CiAJfQorCisJLyogU2VuZCBkcmF3IGNvbW1hbmQgdG8gZGV2aWNlICovCisJbWVt
Y3B5KGdtMTJ1MzIwLT5jbWRfYnVmLCBjbWRfZHJhdywgQ01EX1NJWkUpOworCXJldCA9IHVzYl9i
dWxrX21zZyhnbTEydTMyMC0+dWRldiwKKwkJdXNiX3NuZGJ1bGtwaXBlKGdtMTJ1MzIwLT51ZGV2
LCBEQVRBX1NORF9FUFQpLAorCQlnbTEydTMyMC0+Y21kX2J1ZiwgQ01EX1NJWkUsICZsZW4sIENN
RF9USU1FT1VUKTsKKwlpZiAocmV0IHx8IGxlbiAhPSBDTURfU0laRSkKKwkJZ290byBlcnI7CisK
KwkvKiBSZWFkIHN0YXR1cyAqLworCXJldCA9IHVzYl9idWxrX21zZyhnbTEydTMyMC0+dWRldiwK
KwkJdXNiX3JjdmJ1bGtwaXBlKGdtMTJ1MzIwLT51ZGV2LCBEQVRBX1JDVl9FUFQpLAorCQlnbTEy
dTMyMC0+Y21kX2J1ZiwgUkVBRF9TVEFUVVNfU0laRSwgJmxlbiwKKwkJZ20xMnUzMjAtPmZiX3Vw
ZGF0ZS5kcmF3X3N0YXR1c190aW1lb3V0KTsKKwlpZiAocmV0IHx8IGxlbiAhPSBSRUFEX1NUQVRV
U19TSVpFKQorCQlnb3RvIGVycjsKKworCWdtMTJ1MzIwLT5mYl91cGRhdGUuZHJhd19zdGF0dXNf
dGltZW91dCA9IENNRF9USU1FT1VUOworCWdtMTJ1MzIwLT5mYl91cGRhdGUuZnJhbWUgPSAhZ20x
MnUzMjAtPmZiX3VwZGF0ZS5mcmFtZTsKKworCS8qCisJICogV2UgbXVzdCBkcmF3IGEgZnJhbWUg
ZXZlcnkgMnMgb3RoZXJ3aXNlIHRoZSBwcm9qZWN0b3IKKwkgKiBzd2l0Y2hlcyBiYWNrIHRvIHNo
b3dpbmcgaXRzIGxvZ28uCisJICovCisJcXVldWVfZGVsYXllZF93b3JrKHN5c3RlbV9sb25nX3dx
LCAmZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrLAorCQkJICAgSURMRV9USU1FT1VUKTsKKwogCXJl
dHVybjsKIGVycjoKIAkvKiBEbyBub3QgbG9nIGVycm9ycyBjYXVzZWQgYnkgbW9kdWxlIHVubG9h
ZCBvciBkZXZpY2UgdW5wbHVnICovCkBAIC00NDYsMzYgKzQzMiwyNCBAQCBzdGF0aWMgdm9pZCBn
bTEydTMyMF9mYl9tYXJrX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCW11dGV4
X3VubG9jaygmZ20xMnUzMjAtPmZiX3VwZGF0ZS5sb2NrKTsKIAogCWlmICh3YWtldXApCi0JCXdh
a2VfdXAoJmdtMTJ1MzIwLT5mYl91cGRhdGUud2FpdHEpOworCQltb2RfZGVsYXllZF93b3JrKHN5
c3RlbV9sb25nX3dxLCAmZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrLCAwKTsKIAogCWlmIChvbGRf
ZmIpCiAJCWRybV9mcmFtZWJ1ZmZlcl9wdXQob2xkX2ZiKTsKIH0KIAotc3RhdGljIHZvaWQgZ20x
MnUzMjBfc3RhcnRfZmJfdXBkYXRlKHN0cnVjdCBnbTEydTMyMF9kZXZpY2UgKmdtMTJ1MzIwKQot
ewotCW11dGV4X2xvY2soJmdtMTJ1MzIwLT5mYl91cGRhdGUubG9jayk7Ci0JZ20xMnUzMjAtPmZi
X3VwZGF0ZS5ydW4gPSB0cnVlOwotCW11dGV4X3VubG9jaygmZ20xMnUzMjAtPmZiX3VwZGF0ZS5s
b2NrKTsKLQotCXF1ZXVlX3dvcmsoZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrcSwgJmdtMTJ1MzIw
LT5mYl91cGRhdGUud29yayk7Ci19Ci0KIHN0YXRpYyB2b2lkIGdtMTJ1MzIwX3N0b3BfZmJfdXBk
YXRlKHN0cnVjdCBnbTEydTMyMF9kZXZpY2UgKmdtMTJ1MzIwKQogewotCW11dGV4X2xvY2soJmdt
MTJ1MzIwLT5mYl91cGRhdGUubG9jayk7Ci0JZ20xMnUzMjAtPmZiX3VwZGF0ZS5ydW4gPSBmYWxz
ZTsKLQltdXRleF91bmxvY2soJmdtMTJ1MzIwLT5mYl91cGRhdGUubG9jayk7CisJc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqb2xkX2ZiOwogCi0Jd2FrZV91cCgmZ20xMnUzMjAtPmZiX3VwZGF0ZS53
YWl0cSk7Ci0JY2FuY2VsX3dvcmtfc3luYygmZ20xMnUzMjAtPmZiX3VwZGF0ZS53b3JrKTsKKwlj
YW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmdtMTJ1MzIwLT5mYl91cGRhdGUud29yayk7CiAKIAlt
dXRleF9sb2NrKCZnbTEydTMyMC0+ZmJfdXBkYXRlLmxvY2spOwotCWlmIChnbTEydTMyMC0+ZmJf
dXBkYXRlLmZiKSB7Ci0JCWRybV9mcmFtZWJ1ZmZlcl9wdXQoZ20xMnUzMjAtPmZiX3VwZGF0ZS5m
Yik7Ci0JCWdtMTJ1MzIwLT5mYl91cGRhdGUuZmIgPSBOVUxMOwotCX0KKwlvbGRfZmIgPSBnbTEy
dTMyMC0+ZmJfdXBkYXRlLmZiOworCWdtMTJ1MzIwLT5mYl91cGRhdGUuZmIgPSBOVUxMOwogCW11
dGV4X3VubG9jaygmZ20xMnUzMjAtPmZiX3VwZGF0ZS5sb2NrKTsKKworCWRybV9mcmFtZWJ1ZmZl
cl9wdXQob2xkX2ZiKTsKIH0KIAogc3RhdGljIGludCBnbTEydTMyMF9zZXRfZWNvbW9kZShzdHJ1
Y3QgZ20xMnUzMjBfZGV2aWNlICpnbTEydTMyMCkKQEAgLTU4MywxMSArNTU3LDExIEBAIHN0YXRp
YyB2b2lkIGdtMTJ1MzIwX3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlw
ZSAqcGlwZSwKIAkJCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSBz
dHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZ20xMnUzMjBf
ZGV2aWNlICpnbTEydTMyMCA9IHBpcGUtPmNydGMuZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3Qg
ZHJtX3JlY3QgcmVjdCA9IHsgMCwgMCwgR00xMlUzMjBfVVNFUl9XSURUSCwgR00xMlUzMjBfSEVJ
R0hUIH07CisJc3RydWN0IGdtMTJ1MzIwX2RldmljZSAqZ20xMnUzMjAgPSBwaXBlLT5jcnRjLmRl
di0+ZGV2X3ByaXZhdGU7CiAKKwlnbTEydTMyMC0+ZmJfdXBkYXRlLmRyYXdfc3RhdHVzX3RpbWVv
dXQgPSBGSVJTVF9GUkFNRV9USU1FT1VUOwogCWdtMTJ1MzIwX2ZiX21hcmtfZGlydHkocGxhbmVf
c3RhdGUtPmZiLCAmcmVjdCk7Ci0JZ20xMnUzMjBfc3RhcnRfZmJfdXBkYXRlKGdtMTJ1MzIwKTsK
IH0KIAogc3RhdGljIHZvaWQgZ20xMnUzMjBfcGlwZV9kaXNhYmxlKHN0cnVjdCBkcm1fc2ltcGxl
X2Rpc3BsYXlfcGlwZSAqcGlwZSkKQEAgLTYyMiwxMyArNTk2LDYgQEAgc3RhdGljIGNvbnN0IHVp
bnQ2NF90IGdtMTJ1MzIwX3BpcGVfbW9kaWZpZXJzW10gPSB7CiAJRFJNX0ZPUk1BVF9NT0RfSU5W
QUxJRAogfTsKIAotc3RhdGljIHZvaWQgZ20xMnUzMjBfZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKLXsKLQlzdHJ1Y3QgZ20xMnUzMjBfZGV2aWNlICpnbTEydTMyMCA9IGRl
di0+ZGV2X3ByaXZhdGU7Ci0KLQlnbTEydTMyMF91c2JfZnJlZShnbTEydTMyMCk7Ci19Ci0KIERF
RklORV9EUk1fR0VNX0ZPUFMoZ20xMnUzMjBfZm9wcyk7CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2Ry
aXZlciBnbTEydTMyMF9kcm1fZHJpdmVyID0gewpAQCAtNjQwLDcgKzYwNyw2IEBAIHN0YXRpYyBz
dHJ1Y3QgZHJtX2RyaXZlciBnbTEydTMyMF9kcm1fZHJpdmVyID0gewogCS5tYWpvcgkJID0gRFJJ
VkVSX01BSk9SLAogCS5taW5vcgkJID0gRFJJVkVSX01JTk9SLAogCi0JLnJlbGVhc2UJID0gZ20x
MnUzMjBfZHJpdmVyX3JlbGVhc2UsCiAJLmZvcHMJCSA9ICZnbTEydTMyMF9mb3BzLAogCURSTV9H
RU1fU0hNRU1fRFJJVkVSX09QUywKIH07CkBAIC02NzAsOSArNjM2LDggQEAgc3RhdGljIGludCBn
bTEydTMyMF91c2JfcHJvYmUoc3RydWN0IHVzYl9pbnRlcmZhY2UgKmludGVyZmFjZSwKIAkJcmV0
dXJuIC1FTk9NRU07CiAKIAlnbTEydTMyMC0+dWRldiA9IGludGVyZmFjZV90b191c2JkZXYoaW50
ZXJmYWNlKTsKLQlJTklUX1dPUksoJmdtMTJ1MzIwLT5mYl91cGRhdGUud29yaywgZ20xMnUzMjBf
ZmJfdXBkYXRlX3dvcmspOworCUlOSVRfREVMQVlFRF9XT1JLKCZnbTEydTMyMC0+ZmJfdXBkYXRl
LndvcmssIGdtMTJ1MzIwX2ZiX3VwZGF0ZV93b3JrKTsKIAltdXRleF9pbml0KCZnbTEydTMyMC0+
ZmJfdXBkYXRlLmxvY2spOwotCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmdtMTJ1MzIwLT5mYl91cGRh
dGUud2FpdHEpOwogCiAJZGV2ID0gJmdtMTJ1MzIwLT5kZXY7CiAJcmV0ID0gZGV2bV9kcm1fZGV2
X2luaXQoJmludGVyZmFjZS0+ZGV2LCBkZXYsICZnbTEydTMyMF9kcm1fZHJpdmVyKTsKLS0gCjIu
MjQuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
