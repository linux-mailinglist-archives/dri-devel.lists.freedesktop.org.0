Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7BC8D7D3EE
	for <lists+dri-devel@lfdr.de>; Thu,  1 Aug 2019 05:45:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 950CF6E362;
	Thu,  1 Aug 2019 03:45:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x443.google.com (mail-pf1-x443.google.com
 [IPv6:2607:f8b0:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 54E086E362
 for <dri-devel@lists.freedesktop.org>; Thu,  1 Aug 2019 03:45:27 +0000 (UTC)
Received: by mail-pf1-x443.google.com with SMTP id y15so33164550pfn.5
 for <dri-devel@lists.freedesktop.org>; Wed, 31 Jul 2019 20:45:27 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=HhMIn30NGQPjpNlDhfy9DcnrYxhEXRl6eLNUApeeF2w=;
 b=O2ZBOzx6Xxb/ayyLk4BMzpbBRuvmI64f9WyF+ms0OPyGKspytCCjX+VLHcEWkJ5jbp
 78cUGpQ97uL9UOAzsvnysfS+4CS94eXz8nRVVAd025Uh+RFdBIIRzG1YNYURqTGlCQ1l
 S9lXhGrT83C/08Y2qGbrrdS5RTvdh8SATaiVHUXFk5yp9T9RzorOhRjIMrH5n/FzdanS
 oGXm3LHV0uDVOU51de4Es8jhVI/9UVYpz9M20Gum6WVEvmn+qMNb1RadPX1vlY1V/ByY
 bPoDZv1+DxDK9XuYdURriWzFJL3aOpkOCoHwvNCGixq+t99E1sEgVI63imKOjMSuceve
 H3cA==
X-Gm-Message-State: APjAAAXk0fF8OxYZlSoR7PKsEjhwCciu2ASFcHRgH+g0N4IN+Mr9lgVv
 pbCodIEjCQpGmxq6C1rNB+oYeg==
X-Google-Smtp-Source: APXvYqzmDE3vrbXtgfpWu0Jf/Brz4wpDtd1VmuWSpxeAOSd9rkgS8DKORyoZVSUdxBfo777rZkNnHg==
X-Received: by 2002:a65:654d:: with SMTP id
 a13mr100328602pgw.196.1564631125865; 
 Wed, 31 Jul 2019 20:45:25 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 h70sm64775674pgc.36.2019.07.31.20.45.24
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Wed, 31 Jul 2019 20:45:25 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v3 26/26] drm: kirin: Move ade drm init to kirin drm drv
Date: Thu,  1 Aug 2019 03:44:39 +0000
Message-Id: <20190801034439.98227-27-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190801034439.98227-1-john.stultz@linaro.org>
References: <20190801034439.98227-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=HhMIn30NGQPjpNlDhfy9DcnrYxhEXRl6eLNUApeeF2w=;
 b=yaE2aHpJcLNGKXg1altIIh5GNPFlGtSSFrlmrvbBhzQSCv71asI2Y7odiccGrQkEZf
 z3Xt5p1bLoXT/bSZCS9ov/O/cHQMBc3hjyi0bE0BpF5ItV3lbbQu+P7E7CUPUY6/CzLp
 hNdi0LXvTqBc1h3GGHLINxCn9jQJVJt4hmrlGEPFoDv88itgmSp1jTwum1DenSGNLL03
 PnHeOmOKuKsuhbn+USbugKVqkCRE+yh7jK9C33YFUhFyKB06bjye/TbE0hR2MCQlypxd
 cXzXsTj8QUG2U8tq3ans4HrlceHfXzYM9GevndFNuP9b+JBo68VRLV9gLyQ0iMDqBS5Z
 RJTA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Xu YiPing <xuyiping@hisilicon.com>, David Airlie <airlied@linux.ie>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Rongrong Zou <zourongrong@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWHUgWWlQaW5nIDx4dXlpcGluZ0BoaXNpbGljb24uY29tPgoKQXMgcGFydCBvZiByZWZh
Y3RvcmluZyB0aGUga2lyaW4gZHJpdmVyIHRvIGJldHRlciBzdXBwb3J0CmRpZmZlcmVudCBoYXJk
d2FyZSByZXZpc2lvbnMsIHRoaXMgcGF0Y2ggcmVuYW1lcyBhZGVfZGF0YSB0bwpraXJpbl9kcm1f
cHJpdmF0ZSwgYW5kIG1vdmVzIGNydGNfaW5pdCBhbmQgcGxhbmVfaW5pdCB0bwpraXJpbiBkcm0g
ZHJ2IHRvby4gTm93IHRoYXQgdGhleSBhcmUgZ2VuZXJpYyB0aGUgZnVuY3Rpb25zCmNhbiBiZSBz
aGFyZWQgYmV0d2VlbiB0aGUga2lyaW42MjAgYW5kICh0byBiZSBhZGRlZCBsYXRlcikKa2lyaW45
NjAgc3BlY2lmaWMgc3VwcG9ydCBjb2RlLgoKQ2M6IFJvbmdyb25nIFpvdSA8em91cm9uZ3JvbmdA
Z21haWwuY29tPgpDYzogRGF2aWQgQWlybGllIDxhaXJsaWVkQGxpbnV4LmllPgpDYzogRGFuaWVs
IFZldHRlciA8ZGFuaWVsQGZmd2xsLmNoPgpDYzogZHJpLWRldmVsIDxkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnPgpDYzogU2FtIFJhdm5ib3JnIDxzYW1AcmF2bmJvcmcub3JnPgpSZXZp
ZXdlZC1ieTogU2FtIFJhdm5ib3JnIDxzYW1AcmF2bmJvcmcub3JnPgpTaWduZWQtb2ZmLWJ5OiBY
dSBZaVBpbmcgPHh1eWlwaW5nQGhpc2lsaWNvbi5jb20+Cltqc3R1bHR6OiBSZXdvcmRlZCBjb21t
aXQgbWVzc2FnZV0KU2lnbmVkLW9mZi1ieTogSm9obiBTdHVsdHogPGpvaG4uc3R1bHR6QGxpbmFy
by5vcmc+Ci0tLQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9hZGUuYyAg
IHwgMTIzIC0tLS0tLS0tLS0tLS0tLQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmlu
X2RybV9kcnYuYyAgIHwgMTQxICsrKysrKysrKysrKysrKystLQogLi4uL2dwdS9kcm0vaGlzaWxp
Y29uL2tpcmluL2tpcmluX2RybV9kcnYuaCAgIHwgICA1IC0KIDMgZmlsZXMgY2hhbmdlZCwgMTI5
IGluc2VydGlvbnMoKyksIDE0MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9hZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9o
aXNpbGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5jCmluZGV4IGFiMGM1ZDAzOTAzZC4uNDI4MjA2
ZWNjZmEwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmlu
X2RybV9hZGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2Ry
bV9hZGUuYwpAQCAtNTMsMTMgKzUzLDYgQEAgc3RydWN0IGFkZV9od19jdHggewogCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YzsKIH07CiAKLXN0cnVjdCBhZGVfZGF0YSB7Ci0Jc3RydWN0IGtpcmluX2Ny
dGMgY3J0YzsKLQlzdHJ1Y3Qga2lyaW5fcGxhbmUgcGxhbmVzW0FERV9DSF9OVU1dOwotCXN0cnVj
dCBhZGVfaHdfY3R4ICpod19jdHg7Ci19OwotCi0vKiBhZGUtZm9ybWF0IGluZm86ICovCiBzdGF0
aWMgY29uc3Qgc3RydWN0IGtpcmluX2Zvcm1hdCBhZGVfZm9ybWF0c1tdID0gewogCS8qIDE2YnBw
IFJHQjogKi8KIAl7IERSTV9GT1JNQVRfUkdCNTY1LCBBREVfUkdCXzU2NSB9LApAQCAtNTcxLDM2
ICs1NjQsNiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGFkZV9jcnRjX2Z1
bmNzID0gewogCS5kaXNhYmxlX3ZibGFuawk9IGFkZV9jcnRjX2Rpc2FibGVfdmJsYW5rLAogfTsK
IAotc3RhdGljIGludCBraXJpbl9kcm1fY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKLQkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lICpwbGFu
ZSwKLQkJCSAgICAgICBjb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQot
ewotCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcG9ydDsKLQlpbnQgcmV0OwotCi0JLyogc2V0IGNydGMg
cG9ydCBzbyB0aGF0Ci0JICogZHJtX29mX2ZpbmRfcG9zc2libGVfY3J0Y3MgY2FsbCB3b3Jrcwot
CSAqLwotCXBvcnQgPSBvZl9nZXRfY2hpbGRfYnlfbmFtZShkZXYtPmRldi0+b2Zfbm9kZSwgInBv
cnQiKTsKLQlpZiAoIXBvcnQpIHsKLQkJRFJNX0VSUk9SKCJubyBwb3J0IG5vZGUgZm91bmQgaW4g
JXBPRlxuIiwgZGV2LT5kZXYtPm9mX25vZGUpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0Jb2Zf
bm9kZV9wdXQocG9ydCk7Ci0JY3J0Yy0+cG9ydCA9IHBvcnQ7Ci0KLQlyZXQgPSBkcm1fY3J0Y19p
bml0X3dpdGhfcGxhbmVzKGRldiwgY3J0YywgcGxhbmUsIE5VTEwsCi0JCQkJCWRyaXZlcl9kYXRh
LT5jcnRjX2Z1bmNzLCBOVUxMKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRv
IGluaXQgY3J0Yy5cbiIpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCWRybV9jcnRjX2hlbHBlcl9h
ZGQoY3J0YywgZHJpdmVyX2RhdGEtPmNydGNfaGVscGVyX2Z1bmNzKTsKLQotCXJldHVybiAwOwot
fQotCiBzdGF0aWMgdm9pZCBhZGVfcmRtYV9zZXQodm9pZCBfX2lvbWVtICpiYXNlLCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkJCSB1MzIgY2gsIHUzMiB5LCB1MzIgaW5faCwgdTMyIGZt
dCkKIHsKQEAgLTg5MywyOCArODU2LDYgQEAgc3RhdGljIHN0cnVjdCBkcm1fcGxhbmVfZnVuY3Mg
YWRlX3BsYW5lX2Z1bmNzID0gewogCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNf
aGVscGVyX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCiB9OwogCi1zdGF0aWMgaW50IGtpcmluX2RybV9w
bGFuZV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJc3RydWN0IGtpcmluX3BsYW5l
ICprcGxhbmUsCi0JCQkJZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlLAotCQkJCWNvbnN0IHN0cnVj
dCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGEpCi17Ci0JaW50IHJldCA9IDA7Ci0KLQlyZXQg
PSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoZGV2LCAma3BsYW5lLT5iYXNlLCAxLAotCQkJCSAg
ICAgICBkcml2ZXJfZGF0YS0+cGxhbmVfZnVuY3MsCi0JCQkJICAgICAgIGRyaXZlcl9kYXRhLT5j
aGFubmVsX2Zvcm1hdHMsCi0JCQkJICAgICAgIGRyaXZlcl9kYXRhLT5jaGFubmVsX2Zvcm1hdHNf
Y250LAotCQkJCSAgICAgICBOVUxMLCB0eXBlLCBOVUxMKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9F
UlJPUigiZmFpbCB0byBpbml0IHBsYW5lLCBjaD0lZFxuIiwga3BsYW5lLT5jaCk7Ci0JCXJldHVy
biByZXQ7Ci0JfQotCi0JZHJtX3BsYW5lX2hlbHBlcl9hZGQoJmtwbGFuZS0+YmFzZSwgZHJpdmVy
X2RhdGEtPnBsYW5lX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIHZv
aWQgKmFkZV9od19jdHhfYWxsb2Moc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAkJCQkJ
CQkgIHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIHsKQEAgLTk4NCw3MSArOTI1LDEwIEBAIHN0YXRp
YyB2b2lkICphZGVfaHdfY3R4X2FsbG9jKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCiAJ
cmV0dXJuIGN0eDsKIH0KIAotc3RhdGljIGludCBhZGVfZHJtX2luaXQoc3RydWN0IHBsYXRmb3Jt
X2RldmljZSAqcGRldikKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gcGxhdGZvcm1fZ2V0
X2RydmRhdGEocGRldik7Ci0Jc3RydWN0IGFkZV9kYXRhICphZGU7Ci0Jc3RydWN0IGFkZV9od19j
dHggKmN0eDsKLQlzdHJ1Y3Qga2lyaW5fY3J0YyAqa2NydGM7Ci0Jc3RydWN0IGtpcmluX3BsYW5l
ICprcGxhbmU7Ci0JZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlOwotCWludCByZXQ7Ci0JdTMyIGNo
OwotCi0JYWRlID0gZGV2bV9remFsbG9jKGRldi0+ZGV2LCBzaXplb2YoKmFkZSksIEdGUF9LRVJO
RUwpOwotCWlmICghYWRlKSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGFsbG9jIGFkZV9kYXRh
XG4iKTsKLQkJcmV0dXJuIC1FTk9NRU07Ci0JfQotCi0JY3R4ID0gYWRlX2RyaXZlcl9kYXRhLmFs
bG9jX2h3X2N0eChwZGV2LCAmYWRlLT5jcnRjLmJhc2UpOwotCWlmIChJU19FUlIoY3R4KSkgewot
CQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIGtpcmluX3ByaXYgaHcgY3R4XG4iKTsK
LQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCWFkZS0+aHdfY3R4ID0gY3R4OwotCi0Ja2NydGMgPSAm
YWRlLT5jcnRjOwotCWtjcnRjLT5od19jdHggPSBjdHg7Ci0KLQkvKgotCSAqIHBsYW5lIGluaXQK
LQkgKiBUT0RPOiBOb3cgb25seSBzdXBwb3J0IHByaW1hcnkgcGxhbmUsIG92ZXJsYXkgcGxhbmVz
Ci0JICogbmVlZCB0byBkby4KLQkgKi8KLQlmb3IgKGNoID0gMDsgY2ggPCBhZGVfZHJpdmVyX2Rh
dGEubnVtX3BsYW5lczsgY2grKykgewotCQlrcGxhbmUgPSAmYWRlLT5wbGFuZXNbY2hdOwotCQlr
cGxhbmUtPmNoID0gY2g7Ci0JCWtwbGFuZS0+aHdfY3R4ID0gY3R4OwotCi0JCWlmIChjaCA9PSBh
ZGVfZHJpdmVyX2RhdGEucHJpbV9wbGFuZSkKLQkJCXR5cGUgPSBEUk1fUExBTkVfVFlQRV9QUklN
QVJZOwotCQllbHNlCi0JCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKLQotCQlyZXQg
PSBraXJpbl9kcm1fcGxhbmVfaW5pdChkZXYsIGtwbGFuZSwgdHlwZSwgJmFkZV9kcml2ZXJfZGF0
YSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCS8qIGNydGMgaW5pdCAqLwot
CXJldCA9IGtpcmluX2RybV9jcnRjX2luaXQoZGV2LCAma2NydGMtPmJhc2UsCi0JCQkJJmFkZS0+
cGxhbmVzW2FkZV9kcml2ZXJfZGF0YS5wcmltX3BsYW5lXS5iYXNlLAotCQkJCSZhZGVfZHJpdmVy
X2RhdGEpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3Rh
dGljIHZvaWQgYWRlX2h3X2N0eF9jbGVhbnVwKHZvaWQgKmh3X2N0eCkKIHsKIH0KIAotc3RhdGlj
IHZvaWQgYWRlX2RybV9jbGVhbnVwKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCi17Ci19
Ci0KIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGFkZV9tb2RlX2Nv
bmZpZ19mdW5jcyA9IHsKIAkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGUsCiAJLmF0b21p
Y19jaGVjayA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrLApAQCAtMTA5OSw3ICs5NzksNCBAQCBz
dHJ1Y3Qga2lyaW5fZHJtX2RhdGEgYWRlX2RyaXZlcl9kYXRhID0gewogCiAJLmFsbG9jX2h3X2N0
eCA9IGFkZV9od19jdHhfYWxsb2MsCiAJLmNsZWFudXBfaHdfY3R4ID0gYWRlX2h3X2N0eF9jbGVh
bnVwLAotCi0JLmluaXQgPSBhZGVfZHJtX2luaXQsCi0JLmNsZWFudXAgPSBhZGVfZHJtX2NsZWFu
dXAKIH07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmlu
X2RybV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Ry
di5jCmluZGV4IGNjNzliZDRlY2VjMi4uNjlhYTVlMTgyMWQ2IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuYwpAQCAtMjgsNiArMjgsMTMwIEBA
CiAKICNpbmNsdWRlICJraXJpbl9kcm1fZHJ2LmgiCiAKKyNkZWZpbmUgS0lSSU5fTUFYX1BMQU5F
CTIKKworc3RydWN0IGtpcmluX2RybV9wcml2YXRlIHsKKwlzdHJ1Y3Qga2lyaW5fY3J0YyBjcnRj
OworCXN0cnVjdCBraXJpbl9wbGFuZSBwbGFuZXNbS0lSSU5fTUFYX1BMQU5FXTsKKwl2b2lkICpo
d19jdHg7Cit9OworCitzdGF0aWMgaW50IGtpcmluX2RybV9jcnRjX2luaXQoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCXN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLAorCQkJCWNvbnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGEpCit7
CisJc3RydWN0IGRldmljZV9ub2RlICpwb3J0OworCWludCByZXQ7CisKKwkvKiBzZXQgY3J0YyBw
b3J0IHNvIHRoYXQKKwkgKiBkcm1fb2ZfZmluZF9wb3NzaWJsZV9jcnRjcyBjYWxsIHdvcmtzCisJ
ICovCisJcG9ydCA9IG9mX2dldF9jaGlsZF9ieV9uYW1lKGRldi0+ZGV2LT5vZl9ub2RlLCAicG9y
dCIpOworCWlmICghcG9ydCkgeworCQlEUk1fRVJST1IoIm5vIHBvcnQgbm9kZSBmb3VuZCBpbiAl
cE9GXG4iLCBkZXYtPmRldi0+b2Zfbm9kZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlvZl9u
b2RlX3B1dChwb3J0KTsKKwljcnRjLT5wb3J0ID0gcG9ydDsKKworCXJldCA9IGRybV9jcnRjX2lu
aXRfd2l0aF9wbGFuZXMoZGV2LCBjcnRjLCBwbGFuZSwgTlVMTCwKKwkJCQkJZHJpdmVyX2RhdGEt
PmNydGNfZnVuY3MsIE5VTEwpOworCWlmIChyZXQpIHsKKwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8g
aW5pdCBjcnRjLlxuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJtX2NydGNfaGVscGVyX2Fk
ZChjcnRjLCBkcml2ZXJfZGF0YS0+Y3J0Y19oZWxwZXJfZnVuY3MpOworCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQga2lyaW5fZHJtX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJCQkJZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBl
LAorCQkJCWNvbnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZGF0YSkKK3sKKwlpbnQgcmV0ID0g
MDsKKworCXJldCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdChkZXYsIHBsYW5lLCAxLCBkYXRh
LT5wbGFuZV9mdW5jcywKKwkJCQlkYXRhLT5jaGFubmVsX2Zvcm1hdHMsCisJCQkJZGF0YS0+Y2hh
bm5lbF9mb3JtYXRzX2NudCwKKwkJCQlOVUxMLCB0eXBlLCBOVUxMKTsKKwlpZiAocmV0KSB7CisJ
CURSTV9FUlJPUigiZmFpbCB0byBpbml0IHBsYW5lLCBjaD0lZFxuIiwgMCk7CisJCXJldHVybiBy
ZXQ7CisJfQorCisJZHJtX3BsYW5lX2hlbHBlcl9hZGQocGxhbmUsIGRhdGEtPnBsYW5lX2hlbHBl
cl9mdW5jcyk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQga2lyaW5fZHJtX3ByaXZh
dGVfY2xlYW51cChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCXN0cnVjdCBraXJpbl9kcm1f
cHJpdmF0ZSAqa2lyaW5fcHJpdiA9IGRldi0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGtpcmluX2Ry
bV9kYXRhICpkYXRhOworCisJZGF0YSA9IChzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKilvZl9kZXZp
Y2VfZ2V0X21hdGNoX2RhdGEoZGV2LT5kZXYpOworCWlmIChkYXRhLT5jbGVhbnVwX2h3X2N0eCkK
KwkJZGF0YS0+Y2xlYW51cF9od19jdHgoa2lyaW5fcHJpdi0+aHdfY3R4KTsKKworCWRldm1fa2Zy
ZWUoZGV2LT5kZXYsIGtpcmluX3ByaXYpOworCWRldi0+ZGV2X3ByaXZhdGUgPSBOVUxMOworfQor
CitzdGF0aWMgaW50IGtpcmluX2RybV9wcml2YXRlX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKKwkJCQljb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQoreworCXN0
cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYgPSB0b19wbGF0Zm9ybV9kZXZpY2UoZGV2LT5kZXYp
OworCXN0cnVjdCBraXJpbl9kcm1fcHJpdmF0ZSAqa2lyaW5fcHJpdjsKKwlzdHJ1Y3QgZHJtX3Bs
YW5lICpwcmltX3BsYW5lOworCWVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZTsKKwl2b2lkICpjdHg7
CisJaW50IHJldDsKKwl1MzIgY2g7CisKKwlraXJpbl9wcml2ID0gZGV2bV9remFsbG9jKGRldi0+
ZGV2LCBzaXplb2YoKmtpcmluX3ByaXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWtpcmluX3ByaXYp
IHsKKwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2Mga2lyaW5fZHJtX3ByaXZhdGVcbiIpOwor
CQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwljdHggPSBkcml2ZXJfZGF0YS0+YWxsb2NfaHdfY3R4
KHBkZXYsICZraXJpbl9wcml2LT5jcnRjLmJhc2UpOworCWlmIChJU19FUlIoY3R4KSkgeworCQlE
Uk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIGtpcmluX3ByaXYgaHcgY3R4XG4iKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCWtpcmluX3ByaXYtPmh3X2N0eCA9IGN0eDsKKworCS8qCisJ
ICogcGxhbmUgaW5pdAorCSAqIFRPRE86IE5vdyBvbmx5IHN1cHBvcnQgcHJpbWFyeSBwbGFuZSwg
b3ZlcmxheSBwbGFuZXMKKwkgKiBuZWVkIHRvIGRvLgorCSAqLworCWZvciAoY2ggPSAwOyBjaCA8
IGRyaXZlcl9kYXRhLT5udW1fcGxhbmVzOyBjaCsrKSB7CisJCWlmIChjaCA9PSBkcml2ZXJfZGF0
YS0+cHJpbV9wbGFuZSkKKwkJCXR5cGUgPSBEUk1fUExBTkVfVFlQRV9QUklNQVJZOworCQllbHNl
CisJCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKKwkJcmV0ID0ga2lyaW5fZHJtX3Bs
YW5lX2luaXQoZGV2LCAma2lyaW5fcHJpdi0+cGxhbmVzW2NoXS5iYXNlLAorCQkJCQkgICB0eXBl
LCBkcml2ZXJfZGF0YSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCQlraXJpbl9wcml2
LT5wbGFuZXNbY2hdLmNoID0gY2g7CisJCWtpcmluX3ByaXYtPnBsYW5lc1tjaF0uaHdfY3R4ID0g
Y3R4OworCX0KKworCS8qIGNydGMgaW5pdCAqLworCXByaW1fcGxhbmUgPSAma2lyaW5fcHJpdi0+
cGxhbmVzW2RyaXZlcl9kYXRhLT5wcmltX3BsYW5lXS5iYXNlOworCXJldCA9IGtpcmluX2RybV9j
cnRjX2luaXQoZGV2LCAma2lyaW5fcHJpdi0+Y3J0Yy5iYXNlLAorCQkJCSAgcHJpbV9wbGFuZSwg
ZHJpdmVyX2RhdGEpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisJa2lyaW5fcHJpdi0+Y3J0
Yy5od19jdHggPSBjdHg7CisJZGV2LT5kZXZfcHJpdmF0ZSA9IGtpcmluX3ByaXY7CisKKwlyZXR1
cm4gMDsKK30KIAogc3RhdGljIGludCBraXJpbl9kcm1fa21zX2luaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJCQljb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQpA
QCAtNDMsNyArMTY3LDcgQEAgc3RhdGljIGludCBraXJpbl9kcm1fa21zX2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAlkZXYtPm1vZGVfY29uZmlnLmZ1bmNzID0gZHJpdmVyX2RhdGEtPm1v
ZGVfY29uZmlnX2Z1bmNzOwogCiAJLyogZGlzcGxheSBjb250cm9sbGVyIGluaXQgKi8KLQlyZXQg
PSBkcml2ZXJfZGF0YS0+aW5pdCh0b19wbGF0Zm9ybV9kZXZpY2UoZGV2LT5kZXYpKTsKKwlyZXQg
PSBraXJpbl9kcm1fcHJpdmF0ZV9pbml0KGRldiwgZHJpdmVyX2RhdGEpOwogCWlmIChyZXQpCiAJ
CWdvdG8gZXJyX21vZGVfY29uZmlnX2NsZWFudXA7CiAKQEAgLTUxLDcgKzE3NSw3IEBAIHN0YXRp
YyBpbnQga2lyaW5fZHJtX2ttc19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0ID0g
Y29tcG9uZW50X2JpbmRfYWxsKGRldi0+ZGV2LCBkZXYpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VS
Uk9SKCJmYWlsZWQgdG8gYmluZCBhbGwgY29tcG9uZW50LlxuIik7Ci0JCWdvdG8gZXJyX2RjX2Ns
ZWFudXA7CisJCWdvdG8gZXJyX3ByaXZhdGVfY2xlYW51cDsKIAl9CiAKIAkvKiB2YmxhbmsgaW5p
dCAqLwpAQCAtNzMsMTEgKzE5NywxMCBAQCBzdGF0aWMgaW50IGtpcmluX2RybV9rbXNfaW5pdChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiBlcnJfdW5iaW5kX2FsbDoKIAljb21wb25lbnRfdW5i
aW5kX2FsbChkZXYtPmRldiwgZGV2KTsKLWVycl9kY19jbGVhbnVwOgotCWRyaXZlcl9kYXRhLT5j
bGVhbnVwKHRvX3BsYXRmb3JtX2RldmljZShkZXYtPmRldikpOworZXJyX3ByaXZhdGVfY2xlYW51
cDoKKwlraXJpbl9kcm1fcHJpdmF0ZV9jbGVhbnVwKGRldik7CiBlcnJfbW9kZV9jb25maWdfY2xl
YW51cDoKIAlkcm1fbW9kZV9jb25maWdfY2xlYW51cChkZXYpOwotCiAJcmV0dXJuIHJldDsKIH0K
IApAQCAtODgsMTQgKzIxMSw4IEBAIHN0YXRpYyBpbnQgY29tcGFyZV9vZihzdHJ1Y3QgZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEpCiAKIHN0YXRpYyBpbnQga2lyaW5fZHJtX2ttc19jbGVhbnVwKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0JY29uc3Qgc3RydWN0IGtpcmluX2RybV9kYXRhICpk
cml2ZXJfZGF0YTsKLQogCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaShkZXYpOwotCi0JZHJpdmVy
X2RhdGEgPSBvZl9kZXZpY2VfZ2V0X21hdGNoX2RhdGEoZGV2LT5kZXYpOwotCWlmIChkcml2ZXJf
ZGF0YS0+Y2xlYW51cCkKLQkJZHJpdmVyX2RhdGEtPmNsZWFudXAodG9fcGxhdGZvcm1fZGV2aWNl
KGRldi0+ZGV2KSk7Ci0KKwlraXJpbl9kcm1fcHJpdmF0ZV9jbGVhbnVwKGRldik7CiAJZHJtX21v
ZGVfY29uZmlnX2NsZWFudXAoZGV2KTsKIAogCXJldHVybiAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmggYi9kcml2ZXJzL2dwdS9k
cm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuaAppbmRleCAxNjYzNjEwZDJjZDguLjRk
NWMwNWEyNDA2NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9r
aXJpbl9kcm1fZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJp
bl9kcm1fZHJ2LmgKQEAgLTcsOCArNyw2IEBACiAjaWZuZGVmIF9fS0lSSU5fRFJNX0RSVl9IX18K
ICNkZWZpbmUgX19LSVJJTl9EUk1fRFJWX0hfXwogCi0jZGVmaW5lIE1BWF9DUlRDCTIKLQogI2Rl
ZmluZSB0b19raXJpbl9jcnRjKGNydGMpIFwKIAljb250YWluZXJfb2YoY3J0Yywgc3RydWN0IGtp
cmluX2NydGMsIGJhc2UpCiAKQEAgLTUzLDkgKzUxLDYgQEAgc3RydWN0IGtpcmluX2RybV9kYXRh
IHsKIAl2b2lkICooKmFsbG9jX2h3X2N0eCkoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwK
IAkJCSAgICAgIHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiAJdm9pZCAoKmNsZWFudXBfaHdfY3R4
KSh2b2lkICpod19jdHgpOwotCi0JaW50ICgqaW5pdCkoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldik7Ci0Jdm9pZCAoKmNsZWFudXApKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpOwog
fTsKIAogZXh0ZXJuIHN0cnVjdCBraXJpbl9kcm1fZGF0YSBhZGVfZHJpdmVyX2RhdGE7Ci0tIAoy
LjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRy
aS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
