Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 53B321C8B9
	for <lists+dri-devel@lfdr.de>; Tue, 14 May 2019 14:31:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 446C88929B;
	Tue, 14 May 2019 12:31:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 832BE892E6;
 Tue, 14 May 2019 12:31:36 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id 7so2630448wmo.2;
 Tue, 14 May 2019 05:31:36 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Vr37EeAl3nno9ysND4oopQHULilqggcJqdTsRWkvaDA=;
 b=BSOhLdUUt6Lgjb/wAVIO8JtpOARZ2nLPTaJXj0s5T7Eu7fUOuRFDcaRjlcg9jcHonO
 p2jF82K/sBv8u7bGvGH1KecSIin9BLKaxgNrXuJR+Y3bmCUETC8wMBRnN8uID/lBKXRn
 3vzL3VOhK9OIw4J40dwMlp/iQqxVg1WP02AMjCt57s999eugz/Pzr3sPg2hc+fJ5vUMA
 c/bNFl07txF1jkj9uL6snaI1jtqmPUqq/oVx5CeKoA8luDJmwxjfKJvU6cqwMk5gW3Fc
 P1iHhtiE55IrxmLJYnZeOBw6mzm2+y7PM32OH0RjRxIyTIlt66i3wYNgeCrenEQkh1Qj
 g38A==
X-Gm-Message-State: APjAAAVdXbkJRcSrVU2VfnbnvgC8BAhRTIN/4lH8NTrLIImcHT1b5NLg
 REVMJYxE4seWJPgYNt4IFmY1fWTY
X-Google-Smtp-Source: APXvYqyNqiZCq1qC/6q+QVRfLED3EcxtAeRJ40ekB3Hx73nLjaXQL67L2wMz+Rqk9+sdJ33GJKPyEg==
X-Received: by 2002:a1c:ef0c:: with SMTP id n12mr1844343wmh.3.1557837094984;
 Tue, 14 May 2019 05:31:34 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:7d94:f6f9:368b:5a3b])
 by smtp.gmail.com with ESMTPSA id n4sm6128704wmb.22.2019.05.14.05.31.34
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Tue, 14 May 2019 05:31:34 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Marek.Olsak@amd.com, David1.Zhou@amd.com, Prike.Liang@amd.com,
 dri-devel@lists.freedesktop.org, amd-gfx@lists.freedesktop.org
Subject: [PATCH 06/11] drm/ttm: cleanup ttm_bo_mem_space
Date: Tue, 14 May 2019 14:31:22 +0200
Message-Id: <20190514123127.1650-6-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190514123127.1650-1-christian.koenig@amd.com>
References: <20190514123127.1650-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=Vr37EeAl3nno9ysND4oopQHULilqggcJqdTsRWkvaDA=;
 b=uoX/B3TmrznpGyoki2jsTPpUxS2eTUsbO/l5N5IEBNzEy4xbUmeDkz1y3HcIj8OdHj
 zvKyPfYTeYDBA0vIM8ONoShy0BnhTHYB/XVzqYYIRsTc30PFSSv0XnJ1dhJvxpG3+/IQ
 E+i0v+3r+mTqBCCYReErqPQU6z6DjvnUlkzl6mnShsHPui5ixfb/1EWonnSsglTwOb4K
 z/dJLnhIGx9+HpjhofPRr9PZwtll0YX8Hri37nCPPGYRnle6J+fKb8wpPbdaBhI8Ko9O
 yJiDF9vU0BclcUXDqc/9hjy3mIH/13eZ4ZA6etLdALCdFePkKMGY/8X9QwKXojmA+4EA
 +3BA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2UgdHJpZWQgdGhpcyBvbmNlIGJlZm9yZSwgYnV0IHRoYXQgdHVybmVkIG91dCB0byBiZSBtb3Jl
CmNvbXBsaWNhdGVkIHRoYW4gdGhvdWdodC4gV2l0aCBhbGwgdGhlIHJpZ2h0IHByZXJlcXVpc2l0
ZXMKaXQgbG9va3MgbGlrZSB3ZSBjYW4gZG8gdGhpcyBub3cuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL3R0bS90dG1fYm8uYyB8IDEyOCArKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0t
LQogMSBmaWxlIGNoYW5nZWQsIDY3IGluc2VydGlvbnMoKyksIDYxIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0v
dHRtL3R0bV9iby5jCmluZGV4IDFmZTMwMmRlZTFhOC4uZWMwYmNjMDI0MWE4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX2JvLmMKQEAgLTk2OSwxMyArOTY5LDEyIEBAIHN0YXRpYyBpbnQgdHRtX2JvX2FkZF9tb3Zl
X2ZlbmNlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAgKiBzcGFjZSwgb3Igd2UndmUg
ZXZpY3RlZCBldmVyeXRoaW5nIGFuZCB0aGVyZSBpc24ndCBlbm91Z2ggc3BhY2UuCiAgKi8KIHN0
YXRpYyBpbnQgdHRtX2JvX21lbV9mb3JjZV9zcGFjZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvLAotCQkJCQl1aW50MzJfdCBtZW1fdHlwZSwKLQkJCQkJY29uc3Qgc3RydWN0IHR0bV9wbGFj
ZSAqcGxhY2UsCi0JCQkJCXN0cnVjdCB0dG1fbWVtX3JlZyAqbWVtLAotCQkJCQlzdHJ1Y3QgdHRt
X29wZXJhdGlvbl9jdHggKmN0eCkKKwkJCQkgIGNvbnN0IHN0cnVjdCB0dG1fcGxhY2UgKnBsYWNl
LAorCQkJCSAgc3RydWN0IHR0bV9tZW1fcmVnICptZW0sCisJCQkJICBzdHJ1Y3QgdHRtX29wZXJh
dGlvbl9jdHggKmN0eCkKIHsKIAlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9IGJvLT5iZGV2
OwotCXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuID0gJmJkZXYtPm1hblttZW1fdHlw
ZV07CisJc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW21lbS0+
bWVtX3R5cGVdOwogCWludCByZXQ7CiAKIAlkbyB7CkBAIC05ODQsMTEgKzk4MywxMiBAQCBzdGF0
aWMgaW50IHR0bV9ib19tZW1fZm9yY2Vfc3BhY2Uoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpi
bywKIAkJCXJldHVybiByZXQ7CiAJCWlmIChtZW0tPm1tX25vZGUpCiAJCQlicmVhazsKLQkJcmV0
ID0gdHRtX21lbV9ldmljdF9maXJzdChiZGV2LCBtZW1fdHlwZSwgcGxhY2UsIGN0eCwgYm8tPnJl
c3YpOworCQlyZXQgPSB0dG1fbWVtX2V2aWN0X2ZpcnN0KGJkZXYsIG1lbS0+bWVtX3R5cGUsIHBs
YWNlLAorCQkJCQkgIGN0eCwgYm8tPnJlc3YpOwogCQlpZiAodW5saWtlbHkocmV0ICE9IDApKQog
CQkJcmV0dXJuIHJldDsKIAl9IHdoaWxlICgxKTsKLQltZW0tPm1lbV90eXBlID0gbWVtX3R5cGU7
CisKIAlyZXR1cm4gdHRtX2JvX2FkZF9tb3ZlX2ZlbmNlKGJvLCBtYW4sIG1lbSk7CiB9CiAKQEAg
LTEwMzYsNiArMTAzNiw1MSBAQCBzdGF0aWMgYm9vbCB0dG1fYm9fbXRfY29tcGF0aWJsZShzdHJ1
Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiwKIAlyZXR1cm4gdHJ1ZTsKIH0KIAorLyoqCisg
KiB0dG1fYm9fbWVtX3BsYWNlbWVudCAtIGNoZWNrIGlmIHBsYWNlbWVudCBpcyBjb21wYXRpYmxl
CisgKiBAYm86IEJPIHRvIGZpbmQgbWVtb3J5IGZvcgorICogQHBsYWNlOiB3aGVyZSB0byBzZWFy
Y2gKKyAqIEBtZW06IHRoZSBtZW1vcnkgb2JqZWN0IHRvIGZpbGwgaW4KKyAqIEBjdHg6IG9wZXJh
dGlvbiBjb250ZXh0CisgKgorICogQ2hlY2sgaWYgcGxhY2VtZW50IGlzIGNvbXBhdGlibGUgYW5k
IGZpbGwgaW4gbWVtIHN0cnVjdHVyZS4KKyAqIFJldHVybnMgLUVCVVNZIGlmIHBsYWNlbWVudCB3
b24ndCB3b3JrIG9yIG5lZ2F0aXZlIGVycm9yIGNvZGUuCisgKiAwIHdoZW4gcGxhY2VtZW50IGNh
biBiZSB1c2VkLgorICovCitzdGF0aWMgaW50IHR0bV9ib19tZW1fcGxhY2VtZW50KHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8sCisJCQkJY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2Us
CisJCQkJc3RydWN0IHR0bV9tZW1fcmVnICptZW0sCisJCQkJc3RydWN0IHR0bV9vcGVyYXRpb25f
Y3R4ICpjdHgpCit7CisJc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYgPSBiby0+YmRldjsKKwl1
aW50MzJfdCBtZW1fdHlwZSA9IFRUTV9QTF9TWVNURU07CisJc3RydWN0IHR0bV9tZW1fdHlwZV9t
YW5hZ2VyICptYW47CisJdWludDMyX3QgY3VyX2ZsYWdzID0gMDsKKwlpbnQgcmV0OworCisJcmV0
ID0gdHRtX21lbV90eXBlX2Zyb21fcGxhY2UocGxhY2UsICZtZW1fdHlwZSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCW1hbiA9ICZiZGV2LT5tYW5bbWVtX3R5cGVdOworCWlmICghbWFu
LT5oYXNfdHlwZSB8fCAhbWFuLT51c2VfdHlwZSkKKwkJcmV0dXJuIC1FQlVTWTsKKworCWlmICgh
dHRtX2JvX210X2NvbXBhdGlibGUobWFuLCBtZW1fdHlwZSwgcGxhY2UsICZjdXJfZmxhZ3MpKQor
CQlyZXR1cm4gLUVCVVNZOworCisJY3VyX2ZsYWdzID0gdHRtX2JvX3NlbGVjdF9jYWNoaW5nKG1h
biwgYm8tPm1lbS5wbGFjZW1lbnQsIGN1cl9mbGFncyk7CisJLyoKKwkgKiBVc2UgdGhlIGFjY2Vz
cyBhbmQgb3RoZXIgbm9uLW1hcHBpbmctcmVsYXRlZCBmbGFnIGJpdHMgZnJvbQorCSAqIHRoZSBt
ZW1vcnkgcGxhY2VtZW50IGZsYWdzIHRvIHRoZSBjdXJyZW50IGZsYWdzCisJICovCisJdHRtX2Zs
YWdfbWFza2VkKCZjdXJfZmxhZ3MsIHBsYWNlLT5mbGFncywgflRUTV9QTF9NQVNLX01FTVRZUEUp
OworCisJbWVtLT5tZW1fdHlwZSA9IG1lbV90eXBlOworCW1lbS0+cGxhY2VtZW50ID0gY3VyX2Zs
YWdzOworCXJldHVybiAwOworfQorCiAvKioKICAqIENyZWF0ZXMgc3BhY2UgZm9yIG1lbW9yeSBy
ZWdpb24gQG1lbSBhY2NvcmRpbmcgdG8gaXRzIHR5cGUuCiAgKgpAQCAtMTA1MCwxMSArMTA5NSw3
IEBAIGludCB0dG1fYm9fbWVtX3NwYWNlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJ
CQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCkKIHsKIAlzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiA9IGJvLT5iZGV2OwotCXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuOwot
CXVpbnQzMl90IG1lbV90eXBlID0gVFRNX1BMX1NZU1RFTTsKLQl1aW50MzJfdCBjdXJfZmxhZ3Mg
PSAwOwogCWJvb2wgdHlwZV9mb3VuZCA9IGZhbHNlOwotCWJvb2wgdHlwZV9vayA9IGZhbHNlOwog
CWludCBpLCByZXQ7CiAKIAlyZXQgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVzZXJ2ZV9zaGFyZWQo
Ym8tPnJlc3YsIDEpOwpAQCAtMTA2NCwzNyArMTEwNSwyMCBAQCBpbnQgdHRtX2JvX21lbV9zcGFj
ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCW1lbS0+bW1fbm9kZSA9IE5VTEw7CiAJ
Zm9yIChpID0gMDsgaSA8IHBsYWNlbWVudC0+bnVtX3BsYWNlbWVudDsgKytpKSB7CiAJCWNvbnN0
IHN0cnVjdCB0dG1fcGxhY2UgKnBsYWNlID0gJnBsYWNlbWVudC0+cGxhY2VtZW50W2ldOworCQlz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbjsKIAotCQlyZXQgPSB0dG1fbWVtX3R5cGVf
ZnJvbV9wbGFjZShwbGFjZSwgJm1lbV90eXBlKTsKKwkJcmV0ID0gdHRtX2JvX21lbV9wbGFjZW1l
bnQoYm8sIHBsYWNlLCBtZW0sIGN0eCk7CisJCWlmIChyZXQgPT0gLUVCVVNZKQorCQkJY29udGlu
dWU7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwotCQltYW4gPSAmYmRldi0+bWFuW21lbV90
eXBlXTsKLQkJaWYgKCFtYW4tPmhhc190eXBlIHx8ICFtYW4tPnVzZV90eXBlKQotCQkJY29udGlu
dWU7Ci0KLQkJdHlwZV9vayA9IHR0bV9ib19tdF9jb21wYXRpYmxlKG1hbiwgbWVtX3R5cGUsIHBs
YWNlLAotCQkJCQkJJmN1cl9mbGFncyk7Ci0KLQkJaWYgKCF0eXBlX29rKQotCQkJY29udGludWU7
CiAKIAkJdHlwZV9mb3VuZCA9IHRydWU7Ci0JCWN1cl9mbGFncyA9IHR0bV9ib19zZWxlY3RfY2Fj
aGluZyhtYW4sIGJvLT5tZW0ucGxhY2VtZW50LAotCQkJCQkJICBjdXJfZmxhZ3MpOwotCQkvKgot
CQkgKiBVc2UgdGhlIGFjY2VzcyBhbmQgb3RoZXIgbm9uLW1hcHBpbmctcmVsYXRlZCBmbGFnIGJp
dHMgZnJvbQotCQkgKiB0aGUgbWVtb3J5IHBsYWNlbWVudCBmbGFncyB0byB0aGUgY3VycmVudCBm
bGFncwotCQkgKi8KLQkJdHRtX2ZsYWdfbWFza2VkKCZjdXJfZmxhZ3MsIHBsYWNlLT5mbGFncywK
LQkJCQl+VFRNX1BMX01BU0tfTUVNVFlQRSk7Ci0KLQkJaWYgKG1lbV90eXBlID09IFRUTV9QTF9T
WVNURU0pIHsKLQkJCW1lbS0+bWVtX3R5cGUgPSBtZW1fdHlwZTsKLQkJCW1lbS0+cGxhY2VtZW50
ID0gY3VyX2ZsYWdzOwotCQkJbWVtLT5tbV9ub2RlID0gTlVMTDsKKwkJbWVtLT5tbV9ub2RlID0g
TlVMTDsKKwkJaWYgKG1lbS0+bWVtX3R5cGUgPT0gVFRNX1BMX1NZU1RFTSkKIAkJCXJldHVybiAw
OwotCQl9CiAKKwkJbWFuID0gJmJkZXYtPm1hblttZW0tPm1lbV90eXBlXTsKIAkJcmV0ID0gKCpt
YW4tPmZ1bmMtPmdldF9ub2RlKShtYW4sIGJvLCBwbGFjZSwgbWVtKTsKIAkJaWYgKHVubGlrZWx5
KHJldCkpCiAJCQlyZXR1cm4gcmV0OwpAQCAtMTEwNSw4ICsxMTI5LDYgQEAgaW50IHR0bV9ib19t
ZW1fc3BhY2Uoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJCQkoKm1hbi0+ZnVuYy0+
cHV0X25vZGUpKG1hbiwgbWVtKTsKIAkJCQlyZXR1cm4gcmV0OwogCQkJfQotCQkJbWVtLT5tZW1f
dHlwZSA9IG1lbV90eXBlOwotCQkJbWVtLT5wbGFjZW1lbnQgPSBjdXJfZmxhZ3M7CiAJCQlyZXR1
cm4gMDsKIAkJfQogCX0KQEAgLTExMTQsMzcgKzExMzYsMjEgQEAgaW50IHR0bV9ib19tZW1fc3Bh
Y2Uoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAlmb3IgKGkgPSAwOyBpIDwgcGxhY2Vt
ZW50LT5udW1fYnVzeV9wbGFjZW1lbnQ7ICsraSkgewogCQljb25zdCBzdHJ1Y3QgdHRtX3BsYWNl
ICpwbGFjZSA9ICZwbGFjZW1lbnQtPmJ1c3lfcGxhY2VtZW50W2ldOwogCi0JCXJldCA9IHR0bV9t
ZW1fdHlwZV9mcm9tX3BsYWNlKHBsYWNlLCAmbWVtX3R5cGUpOworCQlyZXQgPSB0dG1fYm9fbWVt
X3BsYWNlbWVudChibywgcGxhY2UsIG1lbSwgY3R4KTsKKwkJaWYgKHJldCA9PSAtRUJVU1kpCisJ
CQljb250aW51ZTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7Ci0JCW1hbiA9ICZiZGV2LT5t
YW5bbWVtX3R5cGVdOwotCQlpZiAoIW1hbi0+aGFzX3R5cGUgfHwgIW1hbi0+dXNlX3R5cGUpCi0J
CQljb250aW51ZTsKLQkJaWYgKCF0dG1fYm9fbXRfY29tcGF0aWJsZShtYW4sIG1lbV90eXBlLCBw
bGFjZSwgJmN1cl9mbGFncykpCi0JCQljb250aW51ZTsKIAogCQl0eXBlX2ZvdW5kID0gdHJ1ZTsK
LQkJY3VyX2ZsYWdzID0gdHRtX2JvX3NlbGVjdF9jYWNoaW5nKG1hbiwgYm8tPm1lbS5wbGFjZW1l
bnQsCi0JCQkJCQkgIGN1cl9mbGFncyk7Ci0JCS8qCi0JCSAqIFVzZSB0aGUgYWNjZXNzIGFuZCBv
dGhlciBub24tbWFwcGluZy1yZWxhdGVkIGZsYWcgYml0cyBmcm9tCi0JCSAqIHRoZSBtZW1vcnkg
cGxhY2VtZW50IGZsYWdzIHRvIHRoZSBjdXJyZW50IGZsYWdzCi0JCSAqLwotCQl0dG1fZmxhZ19t
YXNrZWQoJmN1cl9mbGFncywgcGxhY2UtPmZsYWdzLAotCQkJCX5UVE1fUExfTUFTS19NRU1UWVBF
KTsKLQotCQlpZiAobWVtX3R5cGUgPT0gVFRNX1BMX1NZU1RFTSkgewotCQkJbWVtLT5tZW1fdHlw
ZSA9IG1lbV90eXBlOwotCQkJbWVtLT5wbGFjZW1lbnQgPSBjdXJfZmxhZ3M7Ci0JCQltZW0tPm1t
X25vZGUgPSBOVUxMOworCQltZW0tPm1tX25vZGUgPSBOVUxMOworCQlpZiAobWVtLT5tZW1fdHlw
ZSA9PSBUVE1fUExfU1lTVEVNKQogCQkJcmV0dXJuIDA7Ci0JCX0KIAotCQlyZXQgPSB0dG1fYm9f
bWVtX2ZvcmNlX3NwYWNlKGJvLCBtZW1fdHlwZSwgcGxhY2UsIG1lbSwgY3R4KTsKLQkJaWYgKHJl
dCA9PSAwICYmIG1lbS0+bW1fbm9kZSkgewotCQkJbWVtLT5wbGFjZW1lbnQgPSBjdXJfZmxhZ3M7
CisJCXJldCA9IHR0bV9ib19tZW1fZm9yY2Vfc3BhY2UoYm8sIHBsYWNlLCBtZW0sIGN0eCk7CisJ
CWlmIChyZXQgPT0gMCAmJiBtZW0tPm1tX25vZGUpCiAJCQlyZXR1cm4gMDsKLQkJfQorCiAJCWlm
IChyZXQgJiYgcmV0ICE9IC1FQlVTWSkKIAkJCXJldHVybiByZXQ7CiAJfQotLSAKMi4xNy4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
