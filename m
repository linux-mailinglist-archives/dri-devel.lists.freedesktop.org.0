Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D73E10F85A
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 08:10:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0628B6E3BC;
	Tue,  3 Dec 2019 07:10:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw01.mediatek.com (unknown [210.61.82.183])
 by gabe.freedesktop.org (Postfix) with ESMTP id C17226E3B7
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 07:10:41 +0000 (UTC)
X-UUID: 9fddb8fb02dd4ad59f1f968389efce58-20191203
X-UUID: 9fddb8fb02dd4ad59f1f968389efce58-20191203
Received: from mtkcas06.mediatek.inc [(172.21.101.30)] by mailgw01.mediatek.com
 (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 172410000; Tue, 03 Dec 2019 15:10:39 +0800
Received: from MTKCAS06.mediatek.inc (172.21.101.30) by
 mtkmbs05n2.mediatek.inc (172.21.101.140) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Tue, 3 Dec 2019 15:10:22 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by MTKCAS06.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Tue, 3 Dec 2019 15:10:20 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH v2 3/6] drm/mediatek: update cursors by using async atomic
 update
Date: Tue, 3 Dec 2019 15:10:33 +0800
Message-ID: <20191203071036.14158-4-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191203071036.14158-1-bibby.hsieh@mediatek.com>
References: <20191203071036.14158-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=mediatek.com; s=dk; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From;
 bh=ALb9eTY4ZWuID2Vkmm7K94CdWCk3b0cs7y9hwg3nxDE=; 
 b=Q9gs55Yf+9Yg9p9XAL8N2jjFbmOfMQTSVL/r4v0oiPLKjIy9h7vvVqmtfUcuK1hhLlWvglpTaoO9LkPr2gmQA6s19tptFeCz7nsw6UsRbqxUHogZQ8xk71m3Yr4hzGEBSYiFrQVwD3Q/cDg4vKSBXqmzYC7blnl+sMtTFdiTCtQ=;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, srv_heupstream@mediatek.com,
 linux-kernel@vger.kernel.org, tfiga@chromium.org,
 Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3VwcG9ydCB0byBhc3luYyB1cGRhdGVzIG9mIGN1cnNvcnMgYnkgdXNpbmcgdGhlIG5ldyBhdG9t
aWMNCmludGVyZmFjZSBmb3IgdGhhdC4NCg0KU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWggPGJp
YmJ5LmhzaWVoQG1lZGlhdGVrLmNvbT4NCi0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9t
dGtfZHJtX2NydGMuYyAgfCAzMyArKysrKysrKysrKysrKysrDQogZHJpdmVycy9ncHUvZHJtL21l
ZGlhdGVrL210a19kcm1fY3J0Yy5oICB8ICAyICsNCiBkcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsv
bXRrX2RybV9wbGFuZS5jIHwgNTAgKysrKysrKysrKysrKysrKysrKysrKysrDQogZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuaCB8ICAyICsNCiA0IGZpbGVzIGNoYW5nZWQs
IDg3IGluc2VydGlvbnMoKykNCg0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRl
ay9tdGtfZHJtX2NydGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMu
Yw0KaW5kZXggNGMyNWFkMjE4MmIwLi5iMjNmZTc0YjhiMGEgMTAwNjQ0DQotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMNCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9t
ZWRpYXRlay9tdGtfZHJtX2NydGMuYw0KQEAgLTQyMiw2ICs0MjIsMzkgQEAgaW50IG10a19kcm1f
Y3J0Y19wbGFuZV9jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLA0KIAlyZXR1cm4gMDsNCiB9DQogDQordm9pZCBtdGtfZHJtX2NydGNfYXN5bmNfdXBk
YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQorCQkJ
ICAgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19zdGF0ZSkNCit7DQorCXN0cnVjdCBt
dGtfZHJtX3ByaXZhdGUgKnByaXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOw0KKwlzdHJ1Y3Qg
bXRrX2RybV9jcnRjICptdGtfY3J0YyA9IHRvX210a19jcnRjKGNydGMpOw0KKwljb25zdCBzdHJ1
Y3QgZHJtX3BsYW5lX2hlbHBlcl9mdW5jcyAqcGxhbmVfaGVscGVyX2Z1bmNzID0NCisJCQlwbGFu
ZS0+aGVscGVyX3ByaXZhdGU7DQorCWludCBpOw0KKw0KKwlpZiAoIW10a19jcnRjLT5lbmFibGVk
KQ0KKwkJcmV0dXJuOw0KKw0KKwlwbGFuZV9oZWxwZXJfZnVuY3MtPmF0b21pY191cGRhdGUocGxh
bmUsIG5ld19zdGF0ZSk7DQorDQorCWZvciAoaSA9IDA7IGkgPCBtdGtfY3J0Yy0+bGF5ZXJfbnI7
IGkrKykgew0KKwkJc3RydWN0IGRybV9wbGFuZSAqcGxhbmUgPSAmbXRrX2NydGMtPnBsYW5lc1tp
XTsNCisJCXN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOw0KKw0KKwkJcGxhbmVf
c3RhdGUgPSB0b19tdGtfcGxhbmVfc3RhdGUocGxhbmUtPnN0YXRlKTsNCisJCWlmIChwbGFuZV9z
dGF0ZS0+cGVuZGluZy5hc3luY19kaXJ0eSkgew0KKwkJCXBsYW5lX3N0YXRlLT5wZW5kaW5nLmNv
bmZpZyA9IHRydWU7DQorCQkJcGxhbmVfc3RhdGUtPnBlbmRpbmcuYXN5bmNfdXBkYXRlID0gZmFs
c2U7DQorCQkJcGxhbmVfc3RhdGUtPnBlbmRpbmcuYXN5bmNfZGlydHkgPSBmYWxzZTsNCisJCX0N
CisJfQ0KKwltdGtfY3J0Yy0+cGVuZGluZ19wbGFuZXMgPSB0cnVlOw0KKwlpZiAocHJpdi0+ZGF0
YS0+c2hhZG93X3JlZ2lzdGVyKSB7DQorCQltdGtfZGlzcF9tdXRleF9hY3F1aXJlKG10a19jcnRj
LT5tdXRleCk7DQorCQltdGtfY3J0Y19kZHBfY29uZmlnKGNydGMpOw0KKwkJbXRrX2Rpc3BfbXV0
ZXhfcmVsZWFzZShtdGtfY3J0Yy0+bXV0ZXgpOw0KKwl9DQorfQ0KKw0KIHN0YXRpYyB2b2lkIG10
a19kcm1fY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywNCiAJCQkJICAg
ICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlKQ0KIHsNCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmggYi9kcml2ZXJzL2dwdS9kcm0v
bWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgNCmluZGV4IDZhZmUxYzE5NTU3YS4uYTJiNDY3N2E0NTFj
IDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5oDQor
KysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgNCkBAIC0yMSw1ICsy
MSw3IEBAIGludCBtdGtfZHJtX2NydGNfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2
LA0KIAkJCXVuc2lnbmVkIGludCBwYXRoX2xlbik7DQogaW50IG10a19kcm1fY3J0Y19wbGFuZV9j
aGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0KIAkJ
CSAgICAgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUpOw0KK3ZvaWQgbXRrX2RybV9jcnRj
X2FzeW5jX3VwZGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1fcGxhbmUgKnBs
YW5lLA0KKwkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7DQog
DQogI2VuZGlmIC8qIE1US19EUk1fQ1JUQ19IICovDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9t
dGtfZHJtX3BsYW5lLmMNCmluZGV4IGNkN2M5N2ViN2VlNi4uNmJkYjQyZjA2OGZiIDEwMDY0NA0K
LS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYw0KKysrIGIvZHJp
dmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYw0KQEAgLTcsNiArNyw3IEBADQog
I2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+DQogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hl
bHBlci5oPg0KICNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPg0KKyNpbmNsdWRlIDxkcm0vZHJt
X2F0b21pY191YXBpLmg+DQogI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+DQogI2lu
Y2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPg0KIA0KQEAgLTcwLDYgKzcx
LDUwIEBAIHN0YXRpYyB2b2lkIG10a19kcm1fcGxhbmVfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJt
X3BsYW5lICpwbGFuZSwNCiAJa2ZyZWUodG9fbXRrX3BsYW5lX3N0YXRlKHN0YXRlKSk7DQogfQ0K
IA0KK3N0YXRpYyBpbnQgbXRrX3BsYW5lX2F0b21pY19hc3luY19jaGVjayhzdHJ1Y3QgZHJtX3Bs
YW5lICpwbGFuZSwNCisJCQkJCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQ0KK3sNCisJ
c3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOw0KKw0KKwlpZiAocGxhbmUgIT0gc3Rh
dGUtPmNydGMtPmN1cnNvcikNCisJCXJldHVybiAtRUlOVkFMOw0KKw0KKwlpZiAoIXBsYW5lLT5z
dGF0ZSkNCisJCXJldHVybiAtRUlOVkFMOw0KKw0KKwlpZiAoIXBsYW5lLT5zdGF0ZS0+ZmIpDQor
CQlyZXR1cm4gLUVJTlZBTDsNCisNCisJaWYgKHN0YXRlLT5zdGF0ZSkNCisJCWNydGNfc3RhdGUg
PSBkcm1fYXRvbWljX2dldF9leGlzdGluZ19jcnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwNCisJCQkJ
CQkJCXN0YXRlLT5jcnRjKTsNCisJZWxzZSAvKiBTcGVjaWFsIGNhc2UgZm9yIGFzeW5jaHJvbm91
cyBjdXJzb3IgdXBkYXRlcy4gKi8NCisJCWNydGNfc3RhdGUgPSBzdGF0ZS0+Y3J0Yy0+c3RhdGU7
DQorDQorCXJldHVybiBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZShwbGFuZS0+
c3RhdGUsIGNydGNfc3RhdGUsDQorCQkJCQkJICAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5H
LA0KKwkJCQkJCSAgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywNCisJCQkJCQkgICB0cnVl
LCB0cnVlKTsNCit9DQorDQorc3RhdGljIHZvaWQgbXRrX3BsYW5lX2F0b21pY19hc3luY191cGRh
dGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQorCQkJCQkgIHN0cnVjdCBkcm1fcGxhbmVfc3Rh
dGUgKm5ld19zdGF0ZSkNCit7DQorCXN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRlID0gdG9f
bXRrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0ZSk7DQorDQorCXBsYW5lLT5zdGF0ZS0+Y3J0Y194
ID0gbmV3X3N0YXRlLT5jcnRjX3g7DQorCXBsYW5lLT5zdGF0ZS0+Y3J0Y195ID0gbmV3X3N0YXRl
LT5jcnRjX3k7DQorCXBsYW5lLT5zdGF0ZS0+Y3J0Y19oID0gbmV3X3N0YXRlLT5jcnRjX2g7DQor
CXBsYW5lLT5zdGF0ZS0+Y3J0Y193ID0gbmV3X3N0YXRlLT5jcnRjX3c7DQorCXBsYW5lLT5zdGF0
ZS0+c3JjX3ggPSBuZXdfc3RhdGUtPnNyY194Ow0KKwlwbGFuZS0+c3RhdGUtPnNyY195ID0gbmV3
X3N0YXRlLT5zcmNfeTsNCisJcGxhbmUtPnN0YXRlLT5zcmNfaCA9IG5ld19zdGF0ZS0+c3JjX2g7
DQorCXBsYW5lLT5zdGF0ZS0+c3JjX3cgPSBuZXdfc3RhdGUtPnNyY193Ow0KKwlzdGF0ZS0+cGVu
ZGluZy5hc3luY191cGRhdGUgPSB0cnVlOw0KKw0KKwltdGtfZHJtX2NydGNfYXN5bmNfdXBkYXRl
KG5ld19zdGF0ZS0+Y3J0YywgcGxhbmUsIG5ld19zdGF0ZSk7DQorfQ0KKw0KIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIG10a19wbGFuZV9mdW5jcyA9IHsNCiAJLnVwZGF0ZV9w
bGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwNCiAJLmRpc2FibGVfcGxhbmUg
PSBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLA0KQEAgLTE0MSw2ICsxODYsOSBAQCBz
dGF0aWMgdm9pZCBtdGtfcGxhbmVfYXRvbWljX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFu
ZSwNCiAJc3RhdGUtPnBlbmRpbmcucm90YXRpb24gPSBwbGFuZS0+c3RhdGUtPnJvdGF0aW9uOw0K
IAl3bWIoKTsgLyogTWFrZSBzdXJlIHRoZSBhYm92ZSBwYXJhbWV0ZXJzIGFyZSBzZXQgYmVmb3Jl
IHVwZGF0ZSAqLw0KIAlzdGF0ZS0+cGVuZGluZy5kaXJ0eSA9IHRydWU7DQorDQorCWlmIChzdGF0
ZS0+cGVuZGluZy5hc3luY191cGRhdGUpDQorCQlzdGF0ZS0+cGVuZGluZy5hc3luY19kaXJ0eSA9
IHRydWU7DQogfQ0KIA0KIHN0YXRpYyB2b2lkIG10a19wbGFuZV9hdG9taWNfZGlzYWJsZShzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwNCkBAIC0xNTgsNiArMjA2LDggQEAgc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzIG10a19wbGFuZV9oZWxwZXJfZnVuY3MgPSB7DQog
CS5hdG9taWNfY2hlY2sgPSBtdGtfcGxhbmVfYXRvbWljX2NoZWNrLA0KIAkuYXRvbWljX3VwZGF0
ZSA9IG10a19wbGFuZV9hdG9taWNfdXBkYXRlLA0KIAkuYXRvbWljX2Rpc2FibGUgPSBtdGtfcGxh
bmVfYXRvbWljX2Rpc2FibGUsDQorCS5hdG9taWNfYXN5bmNfdXBkYXRlID0gbXRrX3BsYW5lX2F0
b21pY19hc3luY191cGRhdGUsDQorCS5hdG9taWNfYXN5bmNfY2hlY2sgPSBtdGtfcGxhbmVfYXRv
bWljX2FzeW5jX2NoZWNrLA0KIH07DQogDQogaW50IG10a19wbGFuZV9pbml0KHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vbWVk
aWF0ZWsvbXRrX2RybV9wbGFuZS5oDQppbmRleCA3NjA4ODVlMzViMjcuLjQxODgyNDY1ZGQ2NyAx
MDA2NDQNCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmgNCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmgNCkBAIC0yMiw2ICsy
Miw4IEBAIHN0cnVjdCBtdGtfcGxhbmVfcGVuZGluZ19zdGF0ZSB7DQogCXVuc2lnbmVkIGludAkJ
CWhlaWdodDsNCiAJdW5zaWduZWQgaW50CQkJcm90YXRpb247DQogCWJvb2wJCQkJZGlydHk7DQor
CWJvb2wJCQkJYXN5bmNfZGlydHk7DQorCWJvb2wJCQkJYXN5bmNfdXBkYXRlOw0KIH07DQogDQog
c3RydWN0IG10a19wbGFuZV9zdGF0ZSB7DQotLSANCjIuMTguMA0KX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
