Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 810D48D291
	for <lists+dri-devel@lfdr.de>; Wed, 14 Aug 2019 13:55:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6795B88344;
	Wed, 14 Aug 2019 11:54:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from metis.ext.pengutronix.de (metis.ext.pengutronix.de
 [IPv6:2001:67c:670:201:290:27ff:fe1d:cc33])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3E7CA8994D
 for <dri-devel@lists.freedesktop.org>; Wed, 14 Aug 2019 11:54:57 +0000 (UTC)
Received: from dude02.hi.pengutronix.de ([2001:67c:670:100:1d::28]
 helo=dude02.pengutronix.de.)
 by metis.ext.pengutronix.de with esmtp (Exim 4.92)
 (envelope-from <p.zabel@pengutronix.de>)
 id 1hxrrj-00036w-H7; Wed, 14 Aug 2019 13:54:55 +0200
From: Philipp Zabel <p.zabel@pengutronix.de>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 4/7] gpu: ipu-v3: image-convert: fix image downsize
 coefficients and tiling calculation
Date: Wed, 14 Aug 2019 13:54:41 +0200
Message-Id: <20190814115444.13024-4-p.zabel@pengutronix.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190814115444.13024-1-p.zabel@pengutronix.de>
References: <20190814115444.13024-1-p.zabel@pengutronix.de>
MIME-Version: 1.0
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::28
X-SA-Exim-Mail-From: p.zabel@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de);
 SAEximRunCond expanded to false
X-PTX-Original-Recipient: dri-devel@lists.freedesktop.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@pengutronix.de, Steve Longerbeam <slongerbeam@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBlZmZlY3RpdmVseSByZXZlcnRzIGNvbW1pdCA5MTJiYmY3ZTljYTQgKCJncHU6
IGlwdS12MzoKaW1hZ2UtY29udmVydDogRml4IGltYWdlIGRvd25zaXplIGNvZWZmaWNpZW50cyIp
IGFuZCByZXBsYWNlcyBpdCB3aXRoIGEKZGlmZmVyZW50IHNvbHV0aW9uIGJhc2VkIG9uIHRoZSBw
cmVjZWRpbmcgcGF0Y2hlcy4KClRoZSBwcmV2aW91cyBmaXggdHJpZWQgdG8gc29sdmUgdGhlIHBy
b2JsZW0gb2YgaW50ZXJtZWRpYXRlIHRpbGUgc2l6ZQpiZXR3ZWVuIElDIGRvd25zaXppbmcgYW5k
IG1haW4gcHJvY2Vzc2luZyBzZWN0aW9ucyBub3QgYmVpbmcgbGltaXRlZCB0bwoxMDI0IHBpeGVs
cyBieSBkb3duc2l6aW5nIHRoZSBpbnB1dCBpbWFnZSB0byBhIHNtYWxsZXIgaW50ZXJtZWRpYXRl
IHNpemUKaW4gdGhlIGRvd25zaXppbmcgYm94IGZpbHRlci4gVGhpcyBjYXVzZXMgdW5uZWNlc3Nh
cnkgYmx1cnJpbmcsCmVzcGVjaWFsbHkgZm9yIHNjYWxpbmcgZmFjdG9ycyBjbG9zZSB0byAxLgoK
Tm93IHRoYXQgdGhlIHNlYW0gcG9zaXRpb24gY2FsY3VsYXRpb24gbWFrZXMgc3VyZSB0aGF0IHRo
ZSAxMDI0IHBpeGVsCmludGVybWVkaWF0ZSB0aWxlIHNpemUgbGltaXQgaXMgbm90IGV4Y2VlZGVk
LCBjYWxjdWxhdGUgdGhlIG51bWJlciBvZgp0aWxlcyBmcm9tIHRoZSBtYXhpbXVtIG9mIGludGVy
bWVkaWF0ZSBzaXplIGFuZCBvdXRwdXQgc2l6ZSBhbmQgYXZvaWQKdW5uZWNlc3NhcnkgZG93bnNp
emluZy4KClNpZ25lZC1vZmYtYnk6IFBoaWxpcHAgWmFiZWwgPHAuemFiZWxAcGVuZ3V0cm9uaXgu
ZGU+Ci0tLQogZHJpdmVycy9ncHUvaXB1LXYzL2lwdS1pbWFnZS1jb252ZXJ0LmMgfCA0OSArKysr
KysrKysrKysrKysrLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDMxIGluc2VydGlvbnMoKyks
IDE4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2lwdS12My9pcHUtaW1h
Z2UtY29udmVydC5jIGIvZHJpdmVycy9ncHUvaXB1LXYzL2lwdS1pbWFnZS1jb252ZXJ0LmMKaW5k
ZXggOWY2MzFhMGMzOWVhLi5jY2YxMWI2NTRiNTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2lw
dS12My9pcHUtaW1hZ2UtY29udmVydC5jCisrKyBiL2RyaXZlcnMvZ3B1L2lwdS12My9pcHUtaW1h
Z2UtY29udmVydC5jCkBAIC0zNzYsOCArMzc2LDExIEBAIHN0YXRpYyBpbmxpbmUgaW50IG51bV9z
dHJpcGVzKGludCBkaW0pCiAKIC8qCiAgKiBDYWxjdWxhdGUgZG93bnNpemluZyBjb2VmZmljaWVu
dHMsIHdoaWNoIGFyZSB0aGUgc2FtZSBmb3IgYWxsIHRpbGVzLAotICogYW5kIGJpbGluZWFyIHJl
c2l6aW5nIGNvZWZmaWNpZW50cywgd2hpY2ggYXJlIHVzZWQgdG8gZmluZCB0aGUgYmVzdAotICog
c2VhbSBwb3NpdGlvbnMuCisgKiBhbmQgaW5pdGlhbCBiaWxpbmVhciByZXNpemluZyBjb2VmZmlj
aWVudHMsIHdoaWNoIGFyZSB1c2VkIHRvIGZpbmQgdGhlCisgKiBiZXN0IHNlYW0gcG9zaXRpb25z
LgorICogQWxzbyBkZXRlcm1pbmUgdGhlIG51bWJlciBvZiB0aWxlcyBuZWNlc3NhcnkgdG8gZ3Vh
cmFudGVlIHRoYXQgbm8gdGlsZQorICogaXMgbGFyZ2VyIHRoYW4gMTAyNCBwaXhlbHMgaW4gZWl0
aGVyIGRpbWVuc2lvbiBhdCB0aGUgb3V0cHV0IGFuZCBiZXR3ZWVuCisgKiBJQyBkb3duc2l6aW5n
IGFuZCBtYWluIHByb2Nlc3Npbmcgc2VjdGlvbnMuCiAgKi8KIHN0YXRpYyBpbnQgY2FsY19pbWFn
ZV9yZXNpemVfY29lZmZpY2llbnRzKHN0cnVjdCBpcHVfaW1hZ2VfY29udmVydF9jdHggKmN0eCwK
IAkJCQkJICBzdHJ1Y3QgaXB1X2ltYWdlICppbiwKQEAgLTM5MSw2ICszOTQsOCBAQCBzdGF0aWMg
aW50IGNhbGNfaW1hZ2VfcmVzaXplX2NvZWZmaWNpZW50cyhzdHJ1Y3QgaXB1X2ltYWdlX2NvbnZl
cnRfY3R4ICpjdHgsCiAJdTMyIHJlc2l6ZWRfaGVpZ2h0ID0gb3V0LT5yZWN0LmhlaWdodDsKIAl1
MzIgcmVzaXplX2NvZWZmX2g7CiAJdTMyIHJlc2l6ZV9jb2VmZl92OworCXUzMiBjb2xzOworCXUz
MiByb3dzOwogCiAJaWYgKGlwdV9yb3RfbW9kZV9pc19pcnQoY3R4LT5yb3RfbW9kZSkpIHsKIAkJ
cmVzaXplZF93aWR0aCA9IG91dC0+cmVjdC5oZWlnaHQ7CkBAIC00MDEsMTQgKzQwNiwxMiBAQCBz
dGF0aWMgaW50IGNhbGNfaW1hZ2VfcmVzaXplX2NvZWZmaWNpZW50cyhzdHJ1Y3QgaXB1X2ltYWdl
X2NvbnZlcnRfY3R4ICpjdHgsCiAJaWYgKFdBUk5fT04ocmVzaXplZF93aWR0aCA9PSAwIHx8IHJl
c2l6ZWRfaGVpZ2h0ID09IDApKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCXdoaWxlIChkb3duc2l6
ZWRfd2lkdGggPiAxMDI0IHx8Ci0JICAgICAgIGRvd25zaXplZF93aWR0aCA+PSByZXNpemVkX3dp
ZHRoICogMikgeworCXdoaWxlIChkb3duc2l6ZWRfd2lkdGggPj0gcmVzaXplZF93aWR0aCAqIDIp
IHsKIAkJZG93bnNpemVkX3dpZHRoID4+PSAxOwogCQlkb3duc2l6ZV9jb2VmZl9oKys7CiAJfQog
Ci0Jd2hpbGUgKGRvd25zaXplZF9oZWlnaHQgPiAxMDI0IHx8Ci0JICAgICAgIGRvd25zaXplZF9o
ZWlnaHQgPj0gcmVzaXplZF9oZWlnaHQgKiAyKSB7CisJd2hpbGUgKGRvd25zaXplZF9oZWlnaHQg
Pj0gcmVzaXplZF9oZWlnaHQgKiAyKSB7CiAJCWRvd25zaXplZF9oZWlnaHQgPj49IDE7CiAJCWRv
d25zaXplX2NvZWZmX3YrKzsKIAl9CkBAIC00MjIsMTAgKzQyNSwxOCBAQCBzdGF0aWMgaW50IGNh
bGNfaW1hZ2VfcmVzaXplX2NvZWZmaWNpZW50cyhzdHJ1Y3QgaXB1X2ltYWdlX2NvbnZlcnRfY3R4
ICpjdHgsCiAJcmVzaXplX2NvZWZmX2ggPSA4MTkyICogKGRvd25zaXplZF93aWR0aCAtIDEpIC8g
KHJlc2l6ZWRfd2lkdGggLSAxKTsKIAlyZXNpemVfY29lZmZfdiA9IDgxOTIgKiAoZG93bnNpemVk
X2hlaWdodCAtIDEpIC8gKHJlc2l6ZWRfaGVpZ2h0IC0gMSk7CiAKKwkvKgorCSAqIEJvdGggdGhl
IG91dHB1dCBvZiB0aGUgSUMgZG93bnNpemluZyBzZWN0aW9uIGJlZm9yZSBiZWluZyBwYXNzZWQg
dG8KKwkgKiB0aGUgSUMgbWFpbiBwcm9jZXNzaW5nIHNlY3Rpb24gYW5kIHRoZSBmaW5hbCBvdXRw
dXQgb2YgdGhlIElDIG1haW4KKwkgKiBwcm9jZXNzaW5nIHNlY3Rpb24gbXVzdCBiZSA8PSAxMDI0
IHBpeGVscyBpbiBib3RoIGRpbWVuc2lvbnMuCisJICovCisJY29scyA9IG51bV9zdHJpcGVzKG1h
eF90KHUzMiwgZG93bnNpemVkX3dpZHRoLCByZXNpemVkX3dpZHRoKSk7CisJcm93cyA9IG51bV9z
dHJpcGVzKG1heF90KHUzMiwgZG93bnNpemVkX2hlaWdodCwgcmVzaXplZF9oZWlnaHQpKTsKKwog
CWRldl9kYmcoY3R4LT5jaGFuLT5wcml2LT5pcHUtPmRldiwKIAkJIiVzOiBoc2NhbGU6ID4+JXUs
ICo4MTkyLyV1IHZzY2FsZTogPj4ldSwgKjgxOTIvJXUsICV1eCV1IHRpbGVzXG4iLAogCQlfX2Z1
bmNfXywgZG93bnNpemVfY29lZmZfaCwgcmVzaXplX2NvZWZmX2gsIGRvd25zaXplX2NvZWZmX3Ys
Ci0JCXJlc2l6ZV9jb2VmZl92LCBjdHgtPmluLm51bV9jb2xzLCBjdHgtPmluLm51bV9yb3dzKTsK
KwkJcmVzaXplX2NvZWZmX3YsIGNvbHMsIHJvd3MpOwogCiAJaWYgKGRvd25zaXplX2NvZWZmX2gg
PiAyIHx8IGRvd25zaXplX2NvZWZmX3YgID4gMiB8fAogCSAgICByZXNpemVfY29lZmZfaCA+IDB4
M2ZmZiB8fCByZXNpemVfY29lZmZfdiA+IDB4M2ZmZikKQEAgLTQzNSw2ICs0NDYsOCBAQCBzdGF0
aWMgaW50IGNhbGNfaW1hZ2VfcmVzaXplX2NvZWZmaWNpZW50cyhzdHJ1Y3QgaXB1X2ltYWdlX2Nv
bnZlcnRfY3R4ICpjdHgsCiAJY3R4LT5kb3duc2l6ZV9jb2VmZl92ID0gZG93bnNpemVfY29lZmZf
djsKIAljdHgtPmltYWdlX3Jlc2l6ZV9jb2VmZl9oID0gcmVzaXplX2NvZWZmX2g7CiAJY3R4LT5p
bWFnZV9yZXNpemVfY29lZmZfdiA9IHJlc2l6ZV9jb2VmZl92OworCWN0eC0+aW4ubnVtX2NvbHMg
PSBjb2xzOworCWN0eC0+aW4ubnVtX3Jvd3MgPSByb3dzOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0y
MDM2LDIyICsyMDQ5LDI2IEBAIGlwdV9pbWFnZV9jb252ZXJ0X3ByZXBhcmUoc3RydWN0IGlwdV9z
b2MgKmlwdSwgZW51bSBpcHVfaWNfdGFzayBpY190YXNrLAogCWN0eC0+Y2hhbiA9IGNoYW47CiAJ
aW5pdF9jb21wbGV0aW9uKCZjdHgtPmFib3J0ZWQpOwogCisJY3R4LT5yb3RfbW9kZSA9IHJvdF9t
b2RlOworCisJLyogU2V0cyBjdHgtPmluLm51bV9yb3dzL2NvbHMgYXMgd2VsbCAqLworCXJldCA9
IGNhbGNfaW1hZ2VfcmVzaXplX2NvZWZmaWNpZW50cyhjdHgsIGluLCBvdXQpOworCWlmIChyZXQp
CisJCWdvdG8gb3V0X2ZyZWU7CisKIAlzX2ltYWdlID0gJmN0eC0+aW47CiAJZF9pbWFnZSA9ICZj
dHgtPm91dDsKIAogCS8qIHNldCB0aWxpbmcgYW5kIHJvdGF0aW9uICovCi0JZF9pbWFnZS0+bnVt
X3Jvd3MgPSBudW1fc3RyaXBlcyhvdXQtPnBpeC5oZWlnaHQpOwotCWRfaW1hZ2UtPm51bV9jb2xz
ID0gbnVtX3N0cmlwZXMob3V0LT5waXgud2lkdGgpOwogCWlmIChpcHVfcm90X21vZGVfaXNfaXJ0
KHJvdF9tb2RlKSkgewotCQlzX2ltYWdlLT5udW1fcm93cyA9IGRfaW1hZ2UtPm51bV9jb2xzOwot
CQlzX2ltYWdlLT5udW1fY29scyA9IGRfaW1hZ2UtPm51bV9yb3dzOworCQlkX2ltYWdlLT5udW1f
cm93cyA9IHNfaW1hZ2UtPm51bV9jb2xzOworCQlkX2ltYWdlLT5udW1fY29scyA9IHNfaW1hZ2Ut
Pm51bV9yb3dzOwogCX0gZWxzZSB7Ci0JCXNfaW1hZ2UtPm51bV9yb3dzID0gZF9pbWFnZS0+bnVt
X3Jvd3M7Ci0JCXNfaW1hZ2UtPm51bV9jb2xzID0gZF9pbWFnZS0+bnVtX2NvbHM7CisJCWRfaW1h
Z2UtPm51bV9yb3dzID0gc19pbWFnZS0+bnVtX3Jvd3M7CisJCWRfaW1hZ2UtPm51bV9jb2xzID0g
c19pbWFnZS0+bnVtX2NvbHM7CiAJfQogCiAJY3R4LT5udW1fdGlsZXMgPSBkX2ltYWdlLT5udW1f
Y29scyAqIGRfaW1hZ2UtPm51bV9yb3dzOwotCWN0eC0+cm90X21vZGUgPSByb3RfbW9kZTsKIAog
CXJldCA9IGZpbGxfaW1hZ2UoY3R4LCBzX2ltYWdlLCBpbiwgSU1BR0VfQ09OVkVSVF9JTik7CiAJ
aWYgKHJldCkKQEAgLTIwNjAsMTAgKzIwNzcsNiBAQCBpcHVfaW1hZ2VfY29udmVydF9wcmVwYXJl
KHN0cnVjdCBpcHVfc29jICppcHUsIGVudW0gaXB1X2ljX3Rhc2sgaWNfdGFzaywKIAlpZiAocmV0
KQogCQlnb3RvIG91dF9mcmVlOwogCi0JcmV0ID0gY2FsY19pbWFnZV9yZXNpemVfY29lZmZpY2ll
bnRzKGN0eCwgaW4sIG91dCk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXRfZnJlZTsKLQogCWNhbGNf
b3V0X3RpbGVfbWFwKGN0eCk7CiAKIAlmaW5kX3NlYW1zKGN0eCwgc19pbWFnZSwgZF9pbWFnZSk7
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
