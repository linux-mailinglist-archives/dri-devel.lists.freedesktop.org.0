Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C285FFF921
	for <lists+dri-devel@lfdr.de>; Sun, 17 Nov 2019 12:46:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7A10B6E357;
	Sun, 17 Nov 2019 11:45:09 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 763C16E16B
 for <dri-devel@lists.freedesktop.org>; Sun, 17 Nov 2019 02:41:50 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1]) (Authenticated sender: sre)
 with ESMTPSA id E80A528F767
Received: by earth.universe (Postfix, from userid 1000)
 id C56D93C0C84; Sun, 17 Nov 2019 03:41:39 +0100 (CET)
From: Sebastian Reichel <sebastian.reichel@collabora.com>
To: Sebastian Reichel <sre@kernel.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>
Subject: [RFCv1 12/42] drm/omap: dsi: introduce mipi_dsi_host
Date: Sun, 17 Nov 2019 03:39:58 +0100
Message-Id: <20191117024028.2233-13-sebastian.reichel@collabora.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191117024028.2233-1-sebastian.reichel@collabora.com>
References: <20191117024028.2233-1-sebastian.reichel@collabora.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 17 Nov 2019 11:44:18 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com, Tony Lindgren <tony@atomide.com>,
 "H. Nikolaus Schaller" <hns@goldelico.com>, Merlijn Wajer <merlijn@wizzup.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 dri-devel@lists.freedesktop.org, linux-omap@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBtb3ZlcyBmcm9tIGN1c3RvbSBwbGF0Zm9ybSBkcml2ZXIgaW5mcmFzdHJ1Y3R1cmUgdG8g
bWlwaV9kc2lfaG9zdAphbmQgbWlwaV9kc2lfZGV2aWNlLiBOb3RlLCB0aGF0IHRoaXMgaXMgYSBn
cmFkdWF0ZSBzdGVwIGFuZCB0aGUgZHJpdmVyCm9ubHkgdXNlcyB0aGUgZGV2aWNlcyB0eXBlcyBh
bmQgdHJhbnNmZXIgZnVuY3Rpb24sIGJ1dCBub3QgeWV0IHRoZSBuZXcKZGV2aWNlIGJpbmRpbmcg
c3R5bGUgb3IgZHJtX3BhbmVsLgoKU2lnbmVkLW9mZi1ieTogU2ViYXN0aWFuIFJlaWNoZWwgPHNl
YmFzdGlhbi5yZWljaGVsQGNvbGxhYm9yYS5jb20+Ci0tLQogLi4uL2dwdS9kcm0vb21hcGRybS9k
aXNwbGF5cy9wYW5lbC1kc2ktY20uYyAgIHwgMTE5ICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5jICAgICAgICAgICAgIHwgIDU0ICsrKysrKy0tCiBk
cml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21hcGRzcy5oICAgICAgICAgfCAgIDQgLQogMyBm
aWxlcyBjaGFuZ2VkLCAxMDIgaW5zZXJ0aW9ucygrKSwgNzUgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZGlzcGxheXMvcGFuZWwtZHNpLWNtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vb21hcGRybS9kaXNwbGF5cy9wYW5lbC1kc2ktY20uYwppbmRleCBiNTA1
YmZkMjIxZmMuLmUyZTU2Y2MxY2Q2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL29tYXBk
cm0vZGlzcGxheXMvcGFuZWwtZHNpLWNtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0v
ZGlzcGxheXMvcGFuZWwtZHNpLWNtLmMKQEAgLTE0LDcgKzE0LDYgQEAKICNpbmNsdWRlIDxsaW51
eC9pbnRlcnJ1cHQuaD4KICNpbmNsdWRlIDxsaW51eC9qaWZmaWVzLmg+CiAjaW5jbHVkZSA8bGlu
dXgvbW9kdWxlLmg+Ci0jaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CiAjaW5jbHVk
ZSA8bGludXgvc2NoZWQvc2lnbmFsLmg+CiAjaW5jbHVkZSA8bGludXgvc2xhYi5oPgogI2luY2x1
ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgpAQCAtMzksMTMgKzM4LDEzIEBACiAjZGVmaW5lIERDU19H
RVRfSUQzCQkweGRjCiAKIHN0cnVjdCBwYW5lbF9kcnZfZGF0YSB7CisJc3RydWN0IG1pcGlfZHNp
X2RldmljZSAqZHNpOworCiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSBkc3NkZXY7CiAJc3RydWN0
IG9tYXBfZHNzX2RldmljZSAqc3JjOwogCiAJc3RydWN0IHZpZGVvbW9kZSB2bTsKIAotCXN0cnVj
dCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXY7Ci0KIAlzdHJ1Y3QgbXV0ZXggbG9jazsKIAogCXN0cnVj
dCBiYWNrbGlnaHRfZGV2aWNlICpibGRldjsKQEAgLTEzOSw3ICsxMzgsNyBAQCBzdGF0aWMgdm9p
ZCBod19ndWFyZF93YWl0KHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEpCiAKIHN0YXRpYyBp
bnQgZHNpY21fZGNzX3JlYWRfMShzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhLCB1OCBkY3Nf
Y21kLCB1OCAqZGF0YSkKIHsKLQlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMgPSBkZGF0YS0+
c3JjOworCXN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSA9IGRkYXRhLT5kc2k7CiAJY29uc3Qg
c3RydWN0IG1pcGlfZHNpX21zZyBtc2cgPSB7CiAJCS5jaGFubmVsID0gZGRhdGEtPmNoYW5uZWws
CiAJCS50eXBlID0gTUlQSV9EU0lfRENTX1JFQUQsCkBAIC0xNDksMTIgKzE0OCwxMiBAQCBzdGF0
aWMgaW50IGRzaWNtX2Rjc19yZWFkXzEoc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSwgdTgg
ZGNzX2NtZCwgdTggKmRhdGEpCiAJCS5yeF9idWYgPSBkYXRhCiAJfTsKIAotCXJldHVybiBzcmMt
Pm9wcy0+ZHNpLnRyYW5zZmVyKHNyYywgJm1zZyk7CisJcmV0dXJuIGRzaS0+aG9zdC0+b3BzLT50
cmFuc2Zlcihkc2ktPmhvc3QsICZtc2cpOwogfQogCiBzdGF0aWMgaW50IGRzaWNtX2Rjc193cml0
ZV8wKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEsIHU4IGRjc19jbWQpCiB7Ci0Jc3RydWN0
IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKKwlzdHJ1Y3QgbWlwaV9kc2lfZGV2
aWNlICpkc2kgPSBkZGF0YS0+ZHNpOwogCWNvbnN0IHN0cnVjdCBtaXBpX2RzaV9tc2cgbXNnID0g
ewogCQkuY2hhbm5lbCA9IGRkYXRhLT5jaGFubmVsLAogCQkudHlwZSA9IE1JUElfRFNJX0RDU19T
SE9SVF9XUklURSwKQEAgLTE2MiwxMiArMTYxLDEyIEBAIHN0YXRpYyBpbnQgZHNpY21fZGNzX3dy
aXRlXzAoc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSwgdTggZGNzX2NtZCkKIAkJLnR4X2xl
biA9IDEsCiAJfTsKIAotCXJldHVybiBzcmMtPm9wcy0+ZHNpLnRyYW5zZmVyKHNyYywgJm1zZyk7
CisJcmV0dXJuIGRzaS0+aG9zdC0+b3BzLT50cmFuc2Zlcihkc2ktPmhvc3QsICZtc2cpOwogfQog
CiBzdGF0aWMgaW50IGRzaWNtX2Rjc193cml0ZV8xKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRh
dGEsIHU4IGRjc19jbWQsIHU4IHBhcmFtKQogewotCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKnNy
YyA9IGRkYXRhLT5zcmM7CisJc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNpID0gZGRhdGEtPmRz
aTsKIAljb25zdCB1OCBidWZbXSA9IHsgZGNzX2NtZCwgcGFyYW0gfTsKIAljb25zdCBzdHJ1Y3Qg
bWlwaV9kc2lfbXNnIG1zZyA9IHsKIAkJLmNoYW5uZWwgPSBkZGF0YS0+Y2hhbm5lbCwKQEAgLTE3
NiwxMyArMTc1LDEzIEBAIHN0YXRpYyBpbnQgZHNpY21fZGNzX3dyaXRlXzEoc3RydWN0IHBhbmVs
X2Rydl9kYXRhICpkZGF0YSwgdTggZGNzX2NtZCwgdTggcGFyYW0pCiAJCS50eF9sZW4gPSAyLAog
CX07CiAKLQlyZXR1cm4gc3JjLT5vcHMtPmRzaS50cmFuc2ZlcihzcmMsICZtc2cpOworCXJldHVy
biBkc2ktPmhvc3QtPm9wcy0+dHJhbnNmZXIoZHNpLT5ob3N0LCAmbXNnKTsKIH0KIAogc3RhdGlj
IGludCBkc2ljbV9zbGVlcF9pbihzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhKQogCiB7Ci0J
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKKwlzdHJ1Y3QgbWlwaV9k
c2lfZGV2aWNlICpkc2kgPSBkZGF0YS0+ZHNpOwogCWludCByOwogCWNvbnN0IHU4IGNtZCA9IE1J
UElfRENTX0VOVEVSX1NMRUVQX01PREU7CiAJY29uc3Qgc3RydWN0IG1pcGlfZHNpX21zZyBtc2cg
PSB7CkBAIC0xOTQsNyArMTkzLDcgQEAgc3RhdGljIGludCBkc2ljbV9zbGVlcF9pbihzdHJ1Y3Qg
cGFuZWxfZHJ2X2RhdGEgKmRkYXRhKQogCiAJaHdfZ3VhcmRfd2FpdChkZGF0YSk7CiAKLQlyID0g
c3JjLT5vcHMtPmRzaS50cmFuc2ZlcihzcmMsICZtc2cpOworCXIgPSBkc2ktPmhvc3QtPm9wcy0+
dHJhbnNmZXIoZHNpLT5ob3N0LCAmbXNnKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKQEAgLTI0
Miw3ICsyNDEsNyBAQCBzdGF0aWMgaW50IGRzaWNtX2dldF9pZChzdHJ1Y3QgcGFuZWxfZHJ2X2Rh
dGEgKmRkYXRhLCB1OCAqaWQxLCB1OCAqaWQyLCB1OCAqaWQzKQogc3RhdGljIGludCBkc2ljbV9z
ZXRfdXBkYXRlX3dpbmRvdyhzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhLAogCQl1MTYgeCwg
dTE2IHksIHUxNiB3LCB1MTYgaCkKIHsKLQlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMgPSBk
ZGF0YS0+c3JjOworCXN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSA9IGRkYXRhLT5kc2k7CiAJ
aW50IHI7CiAJdTE2IHgxID0geDsKIAl1MTYgeDIgPSB4ICsgdyAtIDE7CkBAIC0yODAsMTEgKzI3
OSwxMSBAQCBzdGF0aWMgaW50IGRzaWNtX3NldF91cGRhdGVfd2luZG93KHN0cnVjdCBwYW5lbF9k
cnZfZGF0YSAqZGRhdGEsCiAJfTsKIAogCi0JciA9IHNyYy0+b3BzLT5kc2kudHJhbnNmZXIoc3Jj
LCAmbXNnWCk7CisJciA9IGRzaS0+aG9zdC0+b3BzLT50cmFuc2Zlcihkc2ktPmhvc3QsICZtc2dY
KTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlyID0gc3JjLT5vcHMtPmRzaS50cmFuc2Zlcihz
cmMsICZtc2dZKTsKKwlyID0gZHNpLT5ob3N0LT5vcHMtPnRyYW5zZmVyKGRzaS0+aG9zdCwgJm1z
Z1kpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKIApAQCAtMzI3LDcgKzMyNiw3IEBAIHN0YXRpYyBp
bnQgZHNpY21fZW50ZXJfdWxwcyhzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhKQogCXJldHVy
biAwOwogCiBlcnI6Ci0JZGV2X2VycigmZGRhdGEtPnBkZXYtPmRldiwgImVudGVyIFVMUFMgZmFp
bGVkIik7CisJZGV2X2VycigmZGRhdGEtPmRzaS0+ZGV2LCAiZW50ZXIgVUxQUyBmYWlsZWQiKTsK
IAlkc2ljbV9wYW5lbF9yZXNldChkZGF0YSk7CiAKIAlkZGF0YS0+dWxwc19lbmFibGVkID0gZmFs
c2U7CkBAIC0zNTAsNyArMzQ5LDcgQEAgc3RhdGljIGludCBkc2ljbV9leGl0X3VscHMoc3RydWN0
IHBhbmVsX2Rydl9kYXRhICpkZGF0YSkKIAogCXIgPSBfZHNpY21fZW5hYmxlX3RlKGRkYXRhLCB0
cnVlKTsKIAlpZiAocikgewotCQlkZXZfZXJyKCZkZGF0YS0+cGRldi0+ZGV2LCAiZmFpbGVkIHRv
IHJlLWVuYWJsZSBURSIpOworCQlkZXZfZXJyKCZkZGF0YS0+ZHNpLT5kZXYsICJmYWlsZWQgdG8g
cmUtZW5hYmxlIFRFIik7CiAJCWdvdG8gZXJyMjsKIAl9CiAKQEAgLTM2NCw3ICszNjMsNyBAQCBz
dGF0aWMgaW50IGRzaWNtX2V4aXRfdWxwcyhzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhKQog
CXJldHVybiAwOwogCiBlcnIyOgotCWRldl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYsICJmYWlsZWQg
dG8gZXhpdCBVTFBTIik7CisJZGV2X2VycigmZGRhdGEtPmRzaS0+ZGV2LCAiZmFpbGVkIHRvIGV4
aXQgVUxQUyIpOwogCiAJciA9IGRzaWNtX3BhbmVsX3Jlc2V0KGRkYXRhKTsKIAlpZiAoIXIpIHsK
QEAgLTQwMSw3ICs0MDAsNyBAQCBzdGF0aWMgaW50IGRzaWNtX2JsX3VwZGF0ZV9zdGF0dXMoc3Ry
dWN0IGJhY2tsaWdodF9kZXZpY2UgKmRldikKIAllbHNlCiAJCWxldmVsID0gMDsKIAotCWRldl9k
YmcoJmRkYXRhLT5wZGV2LT5kZXYsICJ1cGRhdGUgYnJpZ2h0bmVzcyB0byAlZFxuIiwgbGV2ZWwp
OworCWRldl9kYmcoJmRkYXRhLT5kc2ktPmRldiwgInVwZGF0ZSBicmlnaHRuZXNzIHRvICVkXG4i
LCBsZXZlbCk7CiAKIAltdXRleF9sb2NrKCZkZGF0YS0+bG9jayk7CiAKQEAgLTYzOCw3ICs2Mzcs
NyBAQCBzdGF0aWMgaW50IGRzaWNtX3Bvd2VyX29uKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRh
dGEpCiAJaWYgKGRkYXRhLT52cG5sKSB7CiAJCXIgPSByZWd1bGF0b3JfZW5hYmxlKGRkYXRhLT52
cG5sKTsKIAkJaWYgKHIpIHsKLQkJCWRldl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYsCisJCQlkZXZf
ZXJyKCZkZGF0YS0+ZHNpLT5kZXYsCiAJCQkJImZhaWxlZCB0byBlbmFibGUgVlBOTDogJWRcbiIs
IHIpOwogCQkJcmV0dXJuIHI7CiAJCX0KQEAgLTY0Nyw3ICs2NDYsNyBAQCBzdGF0aWMgaW50IGRz
aWNtX3Bvd2VyX29uKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEpCiAJaWYgKGRkYXRhLT52
ZGRpKSB7CiAJCXIgPSByZWd1bGF0b3JfZW5hYmxlKGRkYXRhLT52ZGRpKTsKIAkJaWYgKHIpIHsK
LQkJCWRldl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYsCisJCQlkZXZfZXJyKCZkZGF0YS0+ZHNpLT5k
ZXYsCiAJCQkJImZhaWxlZCB0byBlbmFibGUgVkRESTogJWRcbiIsIHIpOwogCQkJZ290byBlcnJf
dnBubDsKIAkJfQpAQCAtNjU1LDcgKzY1NCw3IEBAIHN0YXRpYyBpbnQgZHNpY21fcG93ZXJfb24o
c3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSkKIAogCXIgPSBzcmMtPm9wcy0+ZHNpLnNldF9j
b25maWcoc3JjLCAmZHNpX2NvbmZpZyk7CiAJaWYgKHIpIHsKLQkJZGV2X2VycigmZGRhdGEtPnBk
ZXYtPmRldiwgImZhaWxlZCB0byBjb25maWd1cmUgRFNJXG4iKTsKKwkJZGV2X2VycigmZGRhdGEt
PmRzaS0+ZGV2LCAiZmFpbGVkIHRvIGNvbmZpZ3VyZSBEU0lcbiIpOwogCQlnb3RvIGVycl92ZGRp
OwogCX0KIApAQCAtNzAyLDcgKzcwMSw3IEBAIHN0YXRpYyBpbnQgZHNpY21fcG93ZXJfb24oc3Ry
dWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSkKIAlkZGF0YS0+ZW5hYmxlZCA9IDE7CiAKIAlpZiAo
IWRkYXRhLT5pbnRyb19wcmludGVkKSB7Ci0JCWRldl9pbmZvKCZkZGF0YS0+cGRldi0+ZGV2LCAi
cGFuZWwgcmV2aXNpb24gJTAyeC4lMDJ4LiUwMnhcbiIsCisJCWRldl9pbmZvKCZkZGF0YS0+ZHNp
LT5kZXYsICJwYW5lbCByZXZpc2lvbiAlMDJ4LiUwMnguJTAyeFxuIiwKIAkJCWlkMSwgaWQyLCBp
ZDMpOwogCQlkZGF0YS0+aW50cm9fcHJpbnRlZCA9IHRydWU7CiAJfQpAQCAtNzExLDcgKzcxMCw3
IEBAIHN0YXRpYyBpbnQgZHNpY21fcG93ZXJfb24oc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0
YSkKIAogCXJldHVybiAwOwogZXJyOgotCWRldl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYsICJlcnJv
ciB3aGlsZSBlbmFibGluZyBwYW5lbCwgaXNzdWluZyBIVyByZXNldFxuIik7CisJZGV2X2Vycigm
ZGRhdGEtPmRzaS0+ZGV2LCAiZXJyb3Igd2hpbGUgZW5hYmxpbmcgcGFuZWwsIGlzc3VpbmcgSFcg
cmVzZXRcbiIpOwogCiAJZHNpY21faHdfcmVzZXQoZGRhdGEpOwogCkBAIC03MzgsNyArNzM3LDcg
QEAgc3RhdGljIHZvaWQgZHNpY21fcG93ZXJfb2ZmKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRh
dGEpCiAJCXIgPSBkc2ljbV9zbGVlcF9pbihkZGF0YSk7CiAKIAlpZiAocikgewotCQlkZXZfZXJy
KCZkZGF0YS0+cGRldi0+ZGV2LAorCQlkZXZfZXJyKCZkZGF0YS0+ZHNpLT5kZXYsCiAJCQkJImVy
cm9yIGRpc2FibGluZyBwYW5lbCwgaXNzdWluZyBIVyByZXNldFxuIik7CiAJCWRzaWNtX2h3X3Jl
c2V0KGRkYXRhKTsKIAl9CkBAIC03NTUsNyArNzU0LDcgQEAgc3RhdGljIHZvaWQgZHNpY21fcG93
ZXJfb2ZmKHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEpCiAKIHN0YXRpYyBpbnQgZHNpY21f
cGFuZWxfcmVzZXQoc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSkKIHsKLQlkZXZfZXJyKCZk
ZGF0YS0+cGRldi0+ZGV2LCAicGVyZm9ybWluZyBMQ0QgcmVzZXRcbiIpOworCWRldl9lcnIoJmRk
YXRhLT5kc2ktPmRldiwgInBlcmZvcm1pbmcgTENEIHJlc2V0XG4iKTsKIAogCWRzaWNtX3Bvd2Vy
X29mZihkZGF0YSk7CiAJZHNpY21faHdfcmVzZXQoZGRhdGEpOwpAQCAtNzY2LDcgKzc2NSw3IEBA
IHN0YXRpYyBpbnQgZHNpY21fY29ubmVjdChzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpzcmMsCiAJ
CQkgc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHN0KQogewogCXN0cnVjdCBwYW5lbF9kcnZfZGF0
YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzdCk7Ci0Jc3RydWN0IGRldmljZSAqZGV2ID0gJmRk
YXRhLT5wZGV2LT5kZXY7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJmRkYXRhLT5kc2ktPmRldjsK
IAlpbnQgcjsKIAogCXIgPSBzcmMtPm9wcy0+ZHNpLnJlcXVlc3RfdmMoc3JjLCBkZGF0YS0+Y2hh
bm5lbCk7CkBAIC04MTEsNyArODEwLDcgQEAgc3RhdGljIHZvaWQgZHNpY21fZW5hYmxlKHN0cnVj
dCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldikKIAogCXJldHVybjsKIGVycjoKLQlkZXZfZGJnKCZk
ZGF0YS0+cGRldi0+ZGV2LCAiZW5hYmxlIGZhaWxlZCAoJWQpXG4iLCByKTsKKwlkZXZfZGJnKCZk
ZGF0YS0+ZHNpLT5kZXYsICJlbmFibGUgZmFpbGVkICglZClcbiIsIHIpOwogCW11dGV4X3VubG9j
aygmZGRhdGEtPmxvY2spOwogfQogCkBAIC04NDMsNyArODQyLDcgQEAgc3RhdGljIHZvaWQgZHNp
Y21fZnJhbWVkb25lX2NiKGludCBlcnIsIHZvaWQgKmRhdGEpCiAJc3RydWN0IHBhbmVsX2Rydl9k
YXRhICpkZGF0YSA9IGRhdGE7CiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEt
PnNyYzsKIAotCWRldl9kYmcoJmRkYXRhLT5wZGV2LT5kZXYsICJmcmFtZWRvbmUsIGVyciAlZFxu
IiwgZXJyKTsKKwlkZXZfZGJnKCZkZGF0YS0+ZHNpLT5kZXYsICJmcmFtZWRvbmUsIGVyciAlZFxu
IiwgZXJyKTsKIAlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3JjKTsKIH0KIApAQCAtODY3LDcg
Kzg2Niw3IEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBkc2ljbV90ZV9pc3IoaW50IGlycSwgdm9pZCAq
ZGF0YSkKIAogCXJldHVybiBJUlFfSEFORExFRDsKIGVycjoKLQlkZXZfZXJyKCZkZGF0YS0+cGRl
di0+ZGV2LCAic3RhcnQgdXBkYXRlIGZhaWxlZFxuIik7CisJZGV2X2VycigmZGRhdGEtPmRzaS0+
ZGV2LCAic3RhcnQgdXBkYXRlIGZhaWxlZFxuIik7CiAJc3JjLT5vcHMtPmRzaS5idXNfdW5sb2Nr
KHNyYyk7CiAJcmV0dXJuIElSUV9IQU5ETEVEOwogfQpAQCAtODc4LDcgKzg3Nyw3IEBAIHN0YXRp
YyB2b2lkIGRzaWNtX3RlX3RpbWVvdXRfd29ya19jYWxsYmFjayhzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
KndvcmspCiAJCQkJCXRlX3RpbWVvdXRfd29yay53b3JrKTsKIAlzdHJ1Y3Qgb21hcF9kc3NfZGV2
aWNlICpzcmMgPSBkZGF0YS0+c3JjOwogCi0JZGV2X2VycigmZGRhdGEtPnBkZXYtPmRldiwgIlRF
IG5vdCByZWNlaXZlZCBmb3IgMjUwbXMhXG4iKTsKKwlkZXZfZXJyKCZkZGF0YS0+ZHNpLT5kZXYs
ICJURSBub3QgcmVjZWl2ZWQgZm9yIDI1MG1zIVxuIik7CiAKIAlhdG9taWNfc2V0KCZkZGF0YS0+
ZG9fdXBkYXRlLCAwKTsKIAlzcmMtPm9wcy0+ZHNpLmJ1c191bmxvY2soc3JjKTsKQEAgLTg5MSw3
ICs4OTAsNyBAQCBzdGF0aWMgaW50IGRzaWNtX3VwZGF0ZShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNl
ICpkc3NkZXYsCiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAlp
bnQgcjsKIAotCWRldl9kYmcoJmRkYXRhLT5wZGV2LT5kZXYsICJ1cGRhdGUgJWQsICVkLCAlZCB4
ICVkXG4iLCB4LCB5LCB3LCBoKTsKKwlkZXZfZGJnKCZkZGF0YS0+ZHNpLT5kZXYsICJ1cGRhdGUg
JWQsICVkLCAlZCB4ICVkXG4iLCB4LCB5LCB3LCBoKTsKIAogCW11dGV4X2xvY2soJmRkYXRhLT5s
b2NrKTsKIAlzcmMtPm9wcy0+ZHNpLmJ1c19sb2NrKHNyYyk7CkBAIC05MzYsMTQgKzkzNSwxNCBA
QCBzdGF0aWMgaW50IGRzaWNtX3N5bmMoc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQog
CXN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzc2Rldik7CiAJ
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAotCWRldl9kYmcoJmRk
YXRhLT5wZGV2LT5kZXYsICJzeW5jXG4iKTsKKwlkZXZfZGJnKCZkZGF0YS0+ZHNpLT5kZXYsICJz
eW5jXG4iKTsKIAogCW11dGV4X2xvY2soJmRkYXRhLT5sb2NrKTsKIAlzcmMtPm9wcy0+ZHNpLmJ1
c19sb2NrKHNyYyk7CiAJc3JjLT5vcHMtPmRzaS5idXNfdW5sb2NrKHNyYyk7CiAJbXV0ZXhfdW5s
b2NrKCZkZGF0YS0+bG9jayk7CiAKLQlkZXZfZGJnKCZkZGF0YS0+cGRldi0+ZGV2LCAic3luYyBk
b25lXG4iKTsKKwlkZXZfZGJnKCZkZGF0YS0+ZHNpLT5kZXYsICJzeW5jIGRvbmVcbiIpOwogCiAJ
cmV0dXJuIDA7CiB9CkBAIC0xMDIwLDcgKzEwMTksNyBAQCBzdGF0aWMgaW50IGRzaWNtX3NldF9t
YXhfcnhfcGFja2V0X3NpemUoc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUxNiBzaXplKQogewogCXN0cnVjdCBw
YW5lbF9kcnZfZGF0YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzc2Rldik7Ci0Jc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKKwlzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNl
ICpkc2kgPSBkZGF0YS0+ZHNpOwogCiAJY29uc3QgdTggYnVmW10gPSB7CiAJCXNpemUgJiAweGZm
LApAQCAtMTAzNCw3ICsxMDMzLDcgQEAgc3RhdGljIGludCBkc2ljbV9zZXRfbWF4X3J4X3BhY2tl
dF9zaXplKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwKIAkJLnR4X2xlbiA9IDIsCiAJ
fTsKIAotCXJldHVybiBzcmMtPm9wcy0+ZHNpLnRyYW5zZmVyKHNyYywgJm1zZyk7CisJcmV0dXJu
IGRzaS0+aG9zdC0+b3BzLT50cmFuc2Zlcihkc2ktPmhvc3QsICZtc2cpOwogfQogCiBzdGF0aWMg
aW50IGRzaWNtX21lbW9yeV9yZWFkKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwKQEAg
LTEwNDIsNiArMTA0MSw3IEBAIHN0YXRpYyBpbnQgZHNpY21fbWVtb3J5X3JlYWQoc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqZHNzZGV2LAogCQl1MTYgeCwgdTE2IHksIHUxNiB3LCB1MTYgaCkKIHsK
IAlzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0gdG9fcGFuZWxfZGF0YShkc3NkZXYpOwor
CXN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSA9IGRkYXRhLT5kc2k7CiAJc3RydWN0IG9tYXBf
ZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKIAlpbnQgcjsKIAlpbnQgZmlyc3QgPSAxOwpA
QCAtMTA5Myw3ICsxMDkzLDcgQEAgc3RhdGljIGludCBkc2ljbV9tZW1vcnlfcmVhZChzdHJ1Y3Qg
b21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCiAJCX07CiAJCWZpcnN0ID0gMDsKIAotCQlyID0gc3Jj
LT5vcHMtPmRzaS50cmFuc2ZlcihzcmMsICZtc2cpOworCQlyID0gZHNpLT5ob3N0LT5vcHMtPnRy
YW5zZmVyKGRzaS0+aG9zdCwgJm1zZyk7CiAJCWlmIChyIDwgMCkgewogCQkJZGV2X2Vycihkc3Nk
ZXYtPmRldiwgInJlYWQgZXJyb3JcbiIpOwogCQkJZ290byBlcnIzOwpAQCAtMTEwMiwxMiArMTEw
MiwxMiBAQCBzdGF0aWMgaW50IGRzaWNtX21lbW9yeV9yZWFkKHN0cnVjdCBvbWFwX2Rzc19kZXZp
Y2UgKmRzc2RldiwKIAkJYnVmX3VzZWQgKz0gcjsKIAogCQlpZiAociA8IHBsZW4pIHsKLQkJCWRl
dl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYsICJzaG9ydCByZWFkXG4iKTsKKwkJCWRldl9lcnIoJmRk
YXRhLT5kc2ktPmRldiwgInNob3J0IHJlYWRcbiIpOwogCQkJYnJlYWs7CiAJCX0KIAogCQlpZiAo
c2lnbmFsX3BlbmRpbmcoY3VycmVudCkpIHsKLQkJCWRldl9lcnIoJmRkYXRhLT5wZGV2LT5kZXYs
ICJzaWduYWwgcGVuZGluZywgIgorCQkJZGV2X2VycigmZGRhdGEtPmRzaS0+ZGV2LCAic2lnbmFs
IHBlbmRpbmcsICIKIAkJCQkJImFib3J0aW5nIG1lbW9yeSByZWFkXG4iKTsKIAkJCXIgPSAtRVJF
U1RBUlRTWVM7CiAJCQlnb3RvIGVycjM7CkBAIC0xMjAxLDI4ICsxMjAxLDI4IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3Qgb21hcF9kc3NfZHJpdmVyIGRzaWNtX2Rzc19kcml2ZXIgPSB7CiAJLm1lbW9y
eV9yZWFkCT0gZHNpY21fbWVtb3J5X3JlYWQsCiB9OwogCi1zdGF0aWMgaW50IGRzaWNtX3Byb2Jl
X29mKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCitzdGF0aWMgaW50IGRzaWNtX3Byb2Jl
X29mKHN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSkKIHsKLQlzdHJ1Y3QgZGV2aWNlX25vZGUg
Km5vZGUgPSBwZGV2LT5kZXYub2Zfbm9kZTsKKwlzdHJ1Y3QgZGV2aWNlX25vZGUgKm5vZGUgPSBk
c2ktPmRldi5vZl9ub2RlOwogCXN0cnVjdCBkZXZpY2Vfbm9kZSAqYmFja2xpZ2h0OwotCXN0cnVj
dCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsKKwlz
dHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0gbWlwaV9kc2lfZ2V0X2RydmRhdGEoZHNpKTsK
IAlzdHJ1Y3QgZGlzcGxheV90aW1pbmcgdGltaW5nOwogCWludCBlcnI7CiAKIAlkZGF0YS0+Y2hh
bm5lbCA9IFRDSDsKIAotCWRkYXRhLT5yZXNldF9ncGlvID0gZGV2bV9ncGlvZF9nZXQoJnBkZXYt
PmRldiwgInJlc2V0IiwgR1BJT0RfT1VUX0xPVyk7CisJZGRhdGEtPnJlc2V0X2dwaW8gPSBkZXZt
X2dwaW9kX2dldCgmZHNpLT5kZXYsICJyZXNldCIsIEdQSU9EX09VVF9MT1cpOwogCWlmIChJU19F
UlIoZGRhdGEtPnJlc2V0X2dwaW8pKSB7CiAJCWVyciA9IFBUUl9FUlIoZGRhdGEtPnJlc2V0X2dw
aW8pOwotCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJyZXNldCBncGlvIHJlcXVlc3QgZmFpbGVkOiAl
ZCIsIGVycik7CisJCWRldl9lcnIoJmRzaS0+ZGV2LCAicmVzZXQgZ3BpbyByZXF1ZXN0IGZhaWxl
ZDogJWQiLCBlcnIpOwogCQlyZXR1cm4gZXJyOwogCX0KIAotCWRkYXRhLT5leHRfdGVfZ3BpbyA9
IGRldm1fZ3Bpb2RfZ2V0X29wdGlvbmFsKCZwZGV2LT5kZXYsICJ0ZSIsCisJZGRhdGEtPmV4dF90
ZV9ncGlvID0gZGV2bV9ncGlvZF9nZXRfb3B0aW9uYWwoJmRzaS0+ZGV2LCAidGUiLAogCQkJCQkJ
ICAgICBHUElPRF9JTik7CiAJaWYgKElTX0VSUihkZGF0YS0+ZXh0X3RlX2dwaW8pKSB7CiAJCWVy
ciA9IFBUUl9FUlIoZGRhdGEtPmV4dF90ZV9ncGlvKTsKLQkJZGV2X2VycigmcGRldi0+ZGV2LCAi
VEUgZ3BpbyByZXF1ZXN0IGZhaWxlZDogJWQiLCBlcnIpOworCQlkZXZfZXJyKCZkc2ktPmRldiwg
IlRFIGdwaW8gcmVxdWVzdCBmYWlsZWQ6ICVkIiwgZXJyKTsKIAkJcmV0dXJuIGVycjsKIAl9CiAK
QEAgLTEyMzMsNyArMTIzMyw3IEBAIHN0YXRpYyBpbnQgZHNpY21fcHJvYmVfb2Yoc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldikKIAkJCWRkYXRhLT52bS5waXhlbGNsb2NrID0KIAkJCQlkZGF0
YS0+dm0uaGFjdGl2ZSAqIGRkYXRhLT52bS52YWN0aXZlICogNjA7CiAJfSBlbHNlIHsKLQkJZGV2
X3dhcm4oJnBkZXYtPmRldiwKKwkJZGV2X3dhcm4oJmRzaS0+ZGV2LAogCQkJICJmYWlsZWQgdG8g
Z2V0IHZpZGVvIHRpbWluZywgdXNpbmcgZGVmYXVsdHNcbiIpOwogCX0KIApAQCAtMTI0Myw3ICsx
MjQzLDcgQEAgc3RhdGljIGludCBkc2ljbV9wcm9iZV9vZihzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNl
ICpwZGV2KQogCWRkYXRhLT5oZWlnaHRfbW0gPSAwOwogCW9mX3Byb3BlcnR5X3JlYWRfdTMyKG5v
ZGUsICJoZWlnaHQtbW0iLCAmZGRhdGEtPmhlaWdodF9tbSk7CiAKLQlkZGF0YS0+dnBubCA9IGRl
dm1fcmVndWxhdG9yX2dldF9vcHRpb25hbCgmcGRldi0+ZGV2LCAidnBubCIpOworCWRkYXRhLT52
cG5sID0gZGV2bV9yZWd1bGF0b3JfZ2V0X29wdGlvbmFsKCZkc2ktPmRldiwgInZwbmwiKTsKIAlp
ZiAoSVNfRVJSKGRkYXRhLT52cG5sKSkgewogCQllcnIgPSBQVFJfRVJSKGRkYXRhLT52cG5sKTsK
IAkJaWYgKGVyciA9PSAtRVBST0JFX0RFRkVSKQpAQCAtMTI1MSw3ICsxMjUxLDcgQEAgc3RhdGlj
IGludCBkc2ljbV9wcm9iZV9vZihzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCQlkZGF0
YS0+dnBubCA9IE5VTEw7CiAJfQogCi0JZGRhdGEtPnZkZGkgPSBkZXZtX3JlZ3VsYXRvcl9nZXRf
b3B0aW9uYWwoJnBkZXYtPmRldiwgInZkZGkiKTsKKwlkZGF0YS0+dmRkaSA9IGRldm1fcmVndWxh
dG9yX2dldF9vcHRpb25hbCgmZHNpLT5kZXYsICJ2ZGRpIik7CiAJaWYgKElTX0VSUihkZGF0YS0+
dmRkaSkpIHsKIAkJZXJyID0gUFRSX0VSUihkZGF0YS0+dmRkaSk7CiAJCWlmIChlcnIgPT0gLUVQ
Uk9CRV9ERUZFUikKQEAgLTEyNzYsMTEgKzEyNzYsMTEgQEAgc3RhdGljIGludCBkc2ljbV9wcm9i
ZV9vZihzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCXJldHVybiAwOwogfQogCi1zdGF0
aWMgaW50IGRzaWNtX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCitzdGF0aWMg
aW50IGRzaWNtX3Byb2JlKHN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSkKIHsKIAlzdHJ1Y3Qg
cGFuZWxfZHJ2X2RhdGEgKmRkYXRhOwogCXN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpibGRldiA9
IE5VTEw7Ci0Jc3RydWN0IGRldmljZSAqZGV2ID0gJnBkZXYtPmRldjsKKwlzdHJ1Y3QgZGV2aWNl
ICpkZXYgPSAmZHNpLT5kZXY7CiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2OwogCWlu
dCByOwogCkBAIC0xMjkwLDE0ICsxMjkwLDE0IEBAIHN0YXRpYyBpbnQgZHNpY21fcHJvYmUoc3Ry
dWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAlpZiAoIWRkYXRhKQogCQlyZXR1cm4gLUVOT01F
TTsKIAotCXBsYXRmb3JtX3NldF9kcnZkYXRhKHBkZXYsIGRkYXRhKTsKLQlkZGF0YS0+cGRldiA9
IHBkZXY7CisJbWlwaV9kc2lfc2V0X2RydmRhdGEoZHNpLCBkZGF0YSk7CisJZGRhdGEtPmRzaSA9
IGRzaTsKIAogCWRkYXRhLT52bS5oYWN0aXZlID0gODY0OwogCWRkYXRhLT52bS52YWN0aXZlID0g
NDgwOwogCWRkYXRhLT52bS5waXhlbGNsb2NrID0gODY0ICogNDgwICogNjA7CiAKLQlyID0gZHNp
Y21fcHJvYmVfb2YocGRldik7CisJciA9IGRzaWNtX3Byb2JlX29mKGRzaSk7CiAJaWYgKHIpCiAJ
CXJldHVybiByOwogCkBAIC0xMzc5LDEyICsxMzc5LDEyIEBAIHN0YXRpYyBpbnQgZHNpY21fcHJv
YmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAlyZXR1cm4gcjsKIH0KIAotc3RhdGlj
IGludCBfX2V4aXQgZHNpY21fcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCitz
dGF0aWMgaW50IF9fZXhpdCBkc2ljbV9yZW1vdmUoc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNp
KQogewotCXN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0
YShwZGV2KTsKKwlzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhID0gbWlwaV9kc2lfZ2V0X2Ry
dmRhdGEoZHNpKTsKIAlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYgPSAmZGRhdGEtPmRz
c2RldjsKIAotCWRldl9kYmcoJnBkZXYtPmRldiwgInJlbW92ZVxuIik7CisJZGV2X2RiZygmZHNp
LT5kZXYsICJyZW1vdmVcbiIpOwogCiAJb21hcGRzc19kZXZpY2VfdW5yZWdpc3Rlcihkc3NkZXYp
OwogCkBAIC0xMzkyLDcgKzEzOTIsNyBAQCBzdGF0aWMgaW50IF9fZXhpdCBkc2ljbV9yZW1vdmUo
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAkJZHNpY21fZGlzYWJsZShkc3NkZXYpOwog
CW9tYXBkc3NfZGV2aWNlX2Rpc2Nvbm5lY3QoZGRhdGEtPnNyYywgZHNzZGV2KTsKIAotCXN5c2Zz
X3JlbW92ZV9ncm91cCgmcGRldi0+ZGV2LmtvYmosICZkc2ljbV9hdHRyX2dyb3VwKTsKKwlzeXNm
c19yZW1vdmVfZ3JvdXAoJmRzaS0+ZGV2LmtvYmosICZkc2ljbV9hdHRyX2dyb3VwKTsKIAogCWlm
IChkZGF0YS0+ZXh0YmxkZXYpCiAJCXB1dF9kZXZpY2UoJmRkYXRhLT5leHRibGRldi0+ZGV2KTsK
QEAgLTE0MTMsNyArMTQxMyw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGRz
aWNtX29mX21hdGNoW10gPSB7CiAKIE1PRFVMRV9ERVZJQ0VfVEFCTEUob2YsIGRzaWNtX29mX21h
dGNoKTsKIAotc3RhdGljIHN0cnVjdCBwbGF0Zm9ybV9kcml2ZXIgZHNpY21fZHJpdmVyID0gewor
c3RhdGljIHN0cnVjdCBtaXBpX2RzaV9kcml2ZXIgZHNpY21fZHJpdmVyID0gewogCS5wcm9iZSA9
IGRzaWNtX3Byb2JlLAogCS5yZW1vdmUgPSBfX2V4aXRfcChkc2ljbV9yZW1vdmUpLAogCS5kcml2
ZXIgPSB7CkBAIC0xNDIyLDggKzE0MjIsNyBAQCBzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2RyaXZl
ciBkc2ljbV9kcml2ZXIgPSB7CiAJCS5zdXBwcmVzc19iaW5kX2F0dHJzID0gdHJ1ZSwKIAl9LAog
fTsKLQotbW9kdWxlX3BsYXRmb3JtX2RyaXZlcihkc2ljbV9kcml2ZXIpOworbW9kdWxlX21pcGlf
ZHNpX2RyaXZlcihkc2ljbV9kcml2ZXIpOwogCiBNT0RVTEVfQVVUSE9SKCJUb21pIFZhbGtlaW5l
biA8dG9taS52YWxrZWluZW5AdGkuY29tPiIpOwogTU9EVUxFX0RFU0NSSVBUSU9OKCJHZW5lcmlj
IERTSSBDb21tYW5kIE1vZGUgUGFuZWwgRHJpdmVyIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vb21hcGRybS9kc3MvZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3MvZHNp
LmMKaW5kZXggZDM5Yjg0NDA5NjU2Li5jNDEwN2ZlNWE1M2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9vbWFwZHJtL2Rzcy9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9k
c3MvZHNpLmMKQEAgLTMzNCw2ICszMzQsOCBAQCBzdHJ1Y3QgZHNpX2RhdGEgewogCXN0cnVjdCBy
ZWdtYXAgKnN5c2NvbjsKIAlzdHJ1Y3QgZHNzX2RldmljZSAqZHNzOwogCisJc3RydWN0IG1pcGlf
ZHNpX2hvc3QgaG9zdDsKKwogCXN0cnVjdCBkaXNwY19jbG9ja19pbmZvIHVzZXJfZGlzcGNfY2lu
Zm87CiAJc3RydWN0IGRzc19wbGxfY2xvY2tfaW5mbyB1c2VyX2RzaV9jaW5mbzsKIApAQCAtNDMy
LDYgKzQzNCwxMSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBkc2lfZGF0YSAqdG9fZHNpX2RhdGEo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQogCXJldHVybiBkZXZfZ2V0X2RydmRhdGEo
ZHNzZGV2LT5kZXYpOwogfQogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBkc2lfZGF0YSAqaG9zdF90
b19vbWFwKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0KQoreworCXJldHVybiBjb250YWluZXJf
b2YoaG9zdCwgc3RydWN0IGRzaV9kYXRhLCBob3N0KTsKK30KKwogc3RhdGljIGlubGluZSB2b2lk
IGRzaV93cml0ZV9yZWcoc3RydWN0IGRzaV9kYXRhICpkc2ksCiAJCQkJIGNvbnN0IHN0cnVjdCBk
c2lfcmVnIGlkeCwgdTMyIHZhbCkKIHsKQEAgLTQ3MDksOSArNDcxNiwxMiBAQCBzdGF0aWMgdm9p
ZCBkc2lfcmVsZWFzZV92YyhzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsIGludCBjaGFu
bmVsKQogCX0KIH0KIAotc3RhdGljIHNzaXplX3Qgb21hcF9kc2lfdHJhbnNmZXIoc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqZHNzZGV2LAotCQkJCSBjb25zdCBzdHJ1Y3QgbWlwaV9kc2lfbXNnICpt
c2cpCitzdGF0aWMgc3NpemVfdCBvbWFwX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2Rz
aV9ob3N0ICpob3N0LAorCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBtaXBpX2RzaV9tc2cgKm1zZykK
IHsKKwlzdHJ1Y3QgZHNpX2RhdGEgKmRzaSA9IGhvc3RfdG9fb21hcChob3N0KTsKKwlzdHJ1Y3Qg
b21hcF9kc3NfZGV2aWNlICpkc3NkZXYgPSAmZHNpLT5vdXRwdXQ7CisKIAlzd2l0Y2ggKG1zZy0+
dHlwZSkgewogCWNhc2UgTUlQSV9EU0lfR0VORVJJQ19TSE9SVF9XUklURV8wX1BBUkFNOgogCWNh
c2UgTUlQSV9EU0lfR0VORVJJQ19TSE9SVF9XUklURV8xX1BBUkFNOgpAQCAtNDc4NSwxMSArNDc5
NSwzMCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IG9tYXBfZHNzX2RldmljZV9vcHMgZHNpX29wcyA9
IHsKIAogCQkucmVxdWVzdF92YyA9IGRzaV9yZXF1ZXN0X3ZjLAogCQkucmVsZWFzZV92YyA9IGRz
aV9yZWxlYXNlX3ZjLAotCi0JCS50cmFuc2ZlciA9IG9tYXBfZHNpX3RyYW5zZmVyLAogCX0sCiB9
OwogCitpbnQgb21hcF9kc2lfaG9zdF9hdHRhY2goc3RydWN0IG1pcGlfZHNpX2hvc3QgKmhvc3Qs
CisJCQkgc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNpKQoreworCS8qIFRPRE86IGNvbnZlcnQg
ZHJpdmVyIGZyb20gY3VzdG9tIGJpbmRpbmcgbWV0aG9kIHRvIHRoaXMgb25lICovCisJcmV0dXJu
IDA7Cit9CisKK2ludCBvbWFwX2RzaV9ob3N0X2RldGFjaChzdHJ1Y3QgbWlwaV9kc2lfaG9zdCAq
aG9zdCwKKwkJCSBzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2kpCit7CisJLyogVE9ETzogY29u
dmVydCBkcml2ZXIgZnJvbSBjdXN0b20gYmluZGluZyBtZXRob2QgdG8gdGhpcyBvbmUgKi8KKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBtaXBpX2RzaV9ob3N0X29wcyBvbWFw
X2RzaV9ob3N0X29wcyA9IHsKKwkuYXR0YWNoID0gb21hcF9kc2lfaG9zdF9hdHRhY2gsCisJLmRl
dGFjaCA9IG9tYXBfZHNpX2hvc3RfZGV0YWNoLAorCS50cmFuc2ZlciA9IG9tYXBfZHNpX2hvc3Rf
dHJhbnNmZXIsCit9OworCisKIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgKiBQTEwKICAqLwpA
QCAtNTI1OCwxNSArNTI4NywxOCBAQCBzdGF0aWMgaW50IGRzaV9wcm9iZShzdHJ1Y3QgcGxhdGZv
cm1fZGV2aWNlICpwZGV2KQogCQlkc2ktPm51bV9sYW5lc19zdXBwb3J0ZWQgPSAzOwogCX0KIAot
CXIgPSBvZl9wbGF0Zm9ybV9wb3B1bGF0ZShkZXYtPm9mX25vZGUsIE5VTEwsIE5VTEwsIGRldik7
Ci0JaWYgKHIpIHsKLQkJRFNTRVJSKCJGYWlsZWQgdG8gcG9wdWxhdGUgRFNJIGNoaWxkIGRldmlj
ZXM6ICVkXG4iLCByKTsKKwlkc2ktPmhvc3Qub3BzID0gJm9tYXBfZHNpX2hvc3Rfb3BzOworCWRz
aS0+aG9zdC5kZXYgPSAmcGRldi0+ZGV2OworCisJciA9IG1pcGlfZHNpX2hvc3RfcmVnaXN0ZXIo
JmRzaS0+aG9zdCk7CisJaWYgKHIgPCAwKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwgImZhaWxl
ZCB0byByZWdpc3RlciBEU0kgaG9zdDogJWRcbiIsIHIpOwogCQlnb3RvIGVycl9wbV9kaXNhYmxl
OwogCX0KIAogCXIgPSBkc2lfaW5pdF9vdXRwdXQoZHNpKTsKIAlpZiAocikKLQkJZ290byBlcnJf
b2ZfZGVwb3B1bGF0ZTsKKwkJZ290byBlcnJfZHNpX2hvc3RfdW5yZWdpc3RlcjsKIAogCXIgPSBk
c2lfcHJvYmVfb2YoZHNpKTsKIAlpZiAocikgewpAQCAtNTI4Miw4ICs1MzE0LDggQEAgc3RhdGlj
IGludCBkc2lfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAogZXJyX3VuaW5p
dF9vdXRwdXQ6CiAJZHNpX3VuaW5pdF9vdXRwdXQoZHNpKTsKLWVycl9vZl9kZXBvcHVsYXRlOgot
CW9mX3BsYXRmb3JtX2RlcG9wdWxhdGUoZGV2KTsKK2Vycl9kc2lfaG9zdF91bnJlZ2lzdGVyOgor
CW1pcGlfZHNpX2hvc3RfdW5yZWdpc3RlcigmZHNpLT5ob3N0KTsKIGVycl9wbV9kaXNhYmxlOgog
CXBtX3J1bnRpbWVfZGlzYWJsZShkZXYpOwogCXJldHVybiByOwpAQCAtNTI5Nyw3ICs1MzI5LDcg
QEAgc3RhdGljIGludCBkc2lfcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiAK
IAlkc2lfdW5pbml0X291dHB1dChkc2kpOwogCi0Jb2ZfcGxhdGZvcm1fZGVwb3B1bGF0ZSgmcGRl
di0+ZGV2KTsKKwltaXBpX2RzaV9ob3N0X3VucmVnaXN0ZXIoJmRzaS0+aG9zdCk7CiAKIAlwbV9y
dW50aW1lX2Rpc2FibGUoJnBkZXYtPmRldik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9vbWFwZHJtL2Rzcy9vbWFwZHNzLmggYi9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21h
cGRzcy5oCmluZGV4IDE0M2ZmMzQ2YzMxMS4uYmUzN2M5ZWIyMTJjIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mvb21hcGRzcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9v
bWFwZHJtL2Rzcy9vbWFwZHNzLmgKQEAgLTMxMCwxMCArMzEwLDYgQEAgc3RydWN0IG9tYXBkc3Nf
ZHNpX29wcyB7CiAKIAlpbnQgKCpyZXF1ZXN0X3ZjKShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpk
c3NkZXYsIGludCBjaGFubmVsKTsKIAl2b2lkICgqcmVsZWFzZV92Yykoc3RydWN0IG9tYXBfZHNz
X2RldmljZSAqZHNzZGV2LCBpbnQgY2hhbm5lbCk7Ci0KLQkvKiBkYXRhIHRyYW5zZmVyICovCi0J
c3NpemVfdCAoKnRyYW5zZmVyKShzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCi0JCQlj
b25zdCBzdHJ1Y3QgbWlwaV9kc2lfbXNnICptc2cpOwogfTsKIAogc3RydWN0IG9tYXBfZHNzX2Rl
dmljZV9vcHMgewotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWw=
