Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 75E67190196
	for <lists+dri-devel@lfdr.de>; Tue, 24 Mar 2020 00:09:50 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E27D86E417;
	Mon, 23 Mar 2020 23:09:46 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 784D36E3F7
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Mar 2020 23:09:17 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id b12so1329896wmj.3
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Mar 2020 16:09:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=bXWzJyNyLbGHlPdTSeQ2p04pdVs2Jh1frI4wzcxy23Q=;
 b=sWA5Cg0FsNet6iEB/lXV+dj/AZITzorkUp0sXqEzwSKLPdebnS1JdHZe9fE8caJ4Az
 trXKqXeQkKoVdVDbLTTw6ePxqo5eczZStAS6m0q/xdC6BSb3wA0xBuHYCrxkrOfmes/9
 0sMMfFazqSxW9HXpVbVQuRTFh09dqtooaL+N1Ner1mi1xCukeeIKoq+2ub23mHtw4pSe
 aSHLo9ckZXD0qyheLeFy8cmrj5y74eT1z+eUNMpsc7rR8KzBU5Oosf2Zeg94w0ISXDi0
 fRIwgZ9dLA/NHfnMWcBbMPZFLq36zXleV4xZpROIKQAZUDsSEkxYq8tv+SrHGJ1o7OBy
 //Xg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=bXWzJyNyLbGHlPdTSeQ2p04pdVs2Jh1frI4wzcxy23Q=;
 b=AFMl+44ZAiuwSAERxk1kJDMi2W5zEqSRnQP17fk4EF2DTerNXqZ30RnEatMSVvwzUu
 u6RQuQH1CJPryE1G3zM/Mf559CMt0gzFL09FCIaz6FRnYH7/zDmVbgXoLE73MIV7s5yQ
 SpMeVgtRGiMUSUfEHFWASxdbUT9B2QqWJ9GIYlcFsrlv/KgWZZP/JpP3a2u0TK2/HM5J
 Vdb/2gADurDp2IrYuJUcxf1MHVtys64JACiH0EPTzjICkatHfkoKg3NqgqwF37imkHPB
 vIulShJkeWC9KhiGO2q/MjiFPiDD6CKTcwOVA5p2/VYPkLJrPLN4oBFzTt7TrTSlboIL
 wFsQ==
X-Gm-Message-State: ANhLgQ36Vqrx67qu+ovMkErOLIx2dzQMo5hkoa5KQsCXMDMMBe+7djOB
 DnTA25kZGdCKksmaVmm3NZtdVO/f
X-Google-Smtp-Source: ADFU+vtXj6s6ZzW05p7a7slu78dMUU5ogOyPZsAFXAHydjVoRLxNHO+WEQzCQ2uFxIwM9JtEIovXNA==
X-Received: by 2002:a1c:2842:: with SMTP id o63mr1802873wmo.73.1585004955757; 
 Mon, 23 Mar 2020 16:09:15 -0700 (PDT)
Received: from sroland-t5810.vmware.com (46-126-183-173.dynamic.hispeed.ch.
 [46.126.183.173])
 by smtp.gmail.com with ESMTPSA id q185sm1641937wme.10.2020.03.23.16.09.15
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 23 Mar 2020 16:09:15 -0700 (PDT)
From: Roland Scheidegger <rscheidegger.oss@gmail.com>
X-Google-Original-From: Roland Scheidegger <sroland@vmware.com>
To: dri-devel@lists.freedesktop.org,
	airlied@redhat.com,
	daniel@ffwll.ch
Subject: [PATCH v2 10/17] drm/vmwgfx: Add support for indirect and dispatch
 commands
Date: Tue, 24 Mar 2020 00:08:54 +0100
Message-Id: <20200323230901.13302-11-sroland@vmware.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200323230901.13302-1-sroland@vmware.com>
References: <20200323230901.13302-1-sroland@vmware.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-graphics-maintainer@vmware.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGVlcGFrIFJhd2F0IDxkcmF3YXQuZmxvc3NAZ21haWwuY29tPgoKVmFsaWRhdGUgaW5k
aXJlY3QgYW5kIGRpc3BhdGNoIGNvbW1hbmRzIGluIGNvbW1hbmQgYnVmZmVyLgoKU2lnbmVkLW9m
Zi1ieTogRGVlcGFrIFJhd2F0IDxkcmF3YXQuZmxvc3NAZ21haWwuY29tPgpSZXZpZXdlZC1ieTog
VGhvbWFzIEhlbGxzdHLDtm0gKFZNd2FyZSkgPHRob21hc19vc0BzaGlwbWFpbC5vcmc+ClJldmll
d2VkLWJ5OiBSb2xhbmQgU2NoZWlkZWdnZXIgPHNyb2xhbmRAdm13YXJlLmNvbT4KU2lnbmVkLW9m
Zi1ieTogUm9sYW5kIFNjaGVpZGVnZ2VyIDxzcm9sYW5kQHZtd2FyZS5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZXhlY2J1Zi5jIHwgNzAgKysrKysrKysrKysrKysrKysr
KysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDcwIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9leGVjYnVmLmMgYi9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF9leGVjYnVmLmMKaW5kZXggZWQ1NmQ5OTE4YzZhLi5lY2FiNmNiYmM4ZDMg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2V4ZWNidWYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9leGVjYnVmLmMKQEAgLTI4MTYsNiArMjgx
NiwxNiBAQCBzdGF0aWMgaW50IHZtd19jbWRfaW50cmFfc3VyZmFjZV9jb3B5KHN0cnVjdCB2bXdf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICZjbWQtPmJvZHkuc3VyZmFjZS5zaWQsIE5VTEwpOwog
fQogCitzdGF0aWMgaW50IHZtd19jbWRfc201KHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYs
CisJCSAgICAgICBzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3X2NvbnRleHQsCisJCSAgICAgICBT
VkdBM2RDbWRIZWFkZXIgKmhlYWRlcikKK3sKKwlpZiAoIWhhc19zbTVfY29udGV4dChkZXZfcHJp
dikpCisJCXJldHVybiAtRUlOVkFMOworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgdm13
X2NtZF9zbTVfdmlld19kZWZpbmUoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkg
ICBzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3X2NvbnRleHQsCiAJCQkJICAgU1ZHQTNkQ21kSGVh
ZGVyICpoZWFkZXIpCkBAIC0yOTM4LDYgKzI5NDgsNTcgQEAgc3RhdGljIGludCB2bXdfY21kX3Nl
dF9jc191YXYoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gcmV0OwogfQog
CitzdGF0aWMgaW50IHZtd19jbWRfaW5kZXhlZF9pbnN0YW5jZWRfaW5kaXJlY3Qoc3RydWN0IHZt
d19wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICAgICAgc3RydWN0IHZtd19zd19jb250ZXh0ICpz
d19jb250ZXh0LAorCQkJCQkgICAgICBTVkdBM2RDbWRIZWFkZXIgKmhlYWRlcikKK3sKKwlzdHJ1
Y3Qgdm13X2RyYXdfaW5kZXhlZF9pbnN0YW5jZWRfaW5kaXJlY3RfY21kIHsKKwkJU1ZHQTNkQ21k
SGVhZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21kRFhEcmF3SW5kZXhlZEluc3RhbmNlZEluZGlyZWN0
IGJvZHk7CisJfSAqY21kID0gY29udGFpbmVyX29mKGhlYWRlciwgdHlwZW9mKCpjbWQpLCBoZWFk
ZXIpOworCisJaWYgKCFoYXNfc201X2NvbnRleHQoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVJTlZB
TDsKKworCXJldHVybiB2bXdfY21kX3Jlc19jaGVjayhkZXZfcHJpdiwgc3dfY29udGV4dCwgdm13
X3Jlc19zdXJmYWNlLAorCQkJCSBWTVdfUkVTX0RJUlRZX05PTkUsIHVzZXJfc3VyZmFjZV9jb252
ZXJ0ZXIsCisJCQkJICZjbWQtPmJvZHkuYXJnc0J1ZmZlclNpZCwgTlVMTCk7Cit9CisKK3N0YXRp
YyBpbnQgdm13X2NtZF9pbnN0YW5jZWRfaW5kaXJlY3Qoc3RydWN0IHZtd19wcml2YXRlICpkZXZf
cHJpdiwKKwkJCQkgICAgICBzdHJ1Y3Qgdm13X3N3X2NvbnRleHQgKnN3X2NvbnRleHQsCisJCQkJ
ICAgICAgU1ZHQTNkQ21kSGVhZGVyICpoZWFkZXIpCit7CisJc3RydWN0IHZtd19kcmF3X2luc3Rh
bmNlZF9pbmRpcmVjdF9jbWQgeworCQlTVkdBM2RDbWRIZWFkZXIgaGVhZGVyOworCQlTVkdBM2RD
bWREWERyYXdJbnN0YW5jZWRJbmRpcmVjdCBib2R5OworCX0gKmNtZCA9IGNvbnRhaW5lcl9vZiho
ZWFkZXIsIHR5cGVvZigqY21kKSwgaGVhZGVyKTsKKworCWlmICghaGFzX3NtNV9jb250ZXh0KGRl
dl9wcml2KSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXR1cm4gdm13X2NtZF9yZXNfY2hlY2so
ZGV2X3ByaXYsIHN3X2NvbnRleHQsIHZtd19yZXNfc3VyZmFjZSwKKwkJCQkgVk1XX1JFU19ESVJU
WV9OT05FLCB1c2VyX3N1cmZhY2VfY29udmVydGVyLAorCQkJCSAmY21kLT5ib2R5LmFyZ3NCdWZm
ZXJTaWQsIE5VTEwpOworfQorCitzdGF0aWMgaW50IHZtd19jbWRfZGlzcGF0Y2hfaW5kaXJlY3Qo
c3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgICAgIHN0cnVjdCB2bXdfc3dfY29u
dGV4dCAqc3dfY29udGV4dCwKKwkJCQkgICAgIFNWR0EzZENtZEhlYWRlciAqaGVhZGVyKQorewor
CXN0cnVjdCB2bXdfZGlzcGF0Y2hfaW5kaXJlY3RfY21kIHsKKwkJU1ZHQTNkQ21kSGVhZGVyIGhl
YWRlcjsKKwkJU1ZHQTNkQ21kRFhEaXNwYXRjaEluZGlyZWN0IGJvZHk7CisJfSAqY21kID0gY29u
dGFpbmVyX29mKGhlYWRlciwgdHlwZW9mKCpjbWQpLCBoZWFkZXIpOworCisJaWYgKCFoYXNfc201
X2NvbnRleHQoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiB2bXdfY21k
X3Jlc19jaGVjayhkZXZfcHJpdiwgc3dfY29udGV4dCwgdm13X3Jlc19zdXJmYWNlLAorCQkJCSBW
TVdfUkVTX0RJUlRZX05PTkUsIHVzZXJfc3VyZmFjZV9jb252ZXJ0ZXIsCisJCQkJICZjbWQtPmJv
ZHkuYXJnc0J1ZmZlclNpZCwgTlVMTCk7Cit9CisKIHN0YXRpYyBpbnQgdm13X2NtZF9jaGVja19u
b3RfM2Qoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwKIAkJCQlzdHJ1Y3Qgdm13X3N3X2Nv
bnRleHQgKnN3X2NvbnRleHQsCiAJCQkJdm9pZCAqYnVmLCB1aW50MzJfdCAqc2l6ZSkKQEAgLTMz
MDMsOCArMzM2NCwxNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHZtd19jbWRfZW50cnkgdm13X2Nt
ZF9lbnRyaWVzW1NWR0FfM0RfQ01EX01BWF0gPSB7CiAJCSAgICBmYWxzZSwgdHJ1ZSksCiAJVk1X
X0NNRF9ERUYoU1ZHQV8zRF9DTURfRFhfU0VUX1VBX1ZJRVdTLCAmdm13X2NtZF9zZXRfdWF2LCB0
cnVlLCBmYWxzZSwKIAkJICAgIHRydWUpLAorCVZNV19DTURfREVGKFNWR0FfM0RfQ01EX0RYX0RS
QVdfSU5ERVhFRF9JTlNUQU5DRURfSU5ESVJFQ1QsCisJCSAgICAmdm13X2NtZF9pbmRleGVkX2lu
c3RhbmNlZF9pbmRpcmVjdCwgdHJ1ZSwgZmFsc2UsIHRydWUpLAorCVZNV19DTURfREVGKFNWR0Ff
M0RfQ01EX0RYX0RSQVdfSU5TVEFOQ0VEX0lORElSRUNULAorCQkgICAgJnZtd19jbWRfaW5zdGFu
Y2VkX2luZGlyZWN0LCB0cnVlLCBmYWxzZSwgdHJ1ZSksCisJVk1XX0NNRF9ERUYoU1ZHQV8zRF9D
TURfRFhfRElTUEFUQ0gsICZ2bXdfY21kX3NtNSwgdHJ1ZSwgZmFsc2UsIHRydWUpLAorCVZNV19D
TURfREVGKFNWR0FfM0RfQ01EX0RYX0RJU1BBVENIX0lORElSRUNULAorCQkgICAgJnZtd19jbWRf
ZGlzcGF0Y2hfaW5kaXJlY3QsIHRydWUsIGZhbHNlLCB0cnVlKSwKIAlWTVdfQ01EX0RFRihTVkdB
XzNEX0NNRF9EWF9TRVRfQ1NfVUFfVklFV1MsICZ2bXdfY21kX3NldF9jc191YXYsIHRydWUsCiAJ
CSAgICBmYWxzZSwgdHJ1ZSksCisJVk1XX0NNRF9ERUYoU1ZHQV8zRF9DTURfRFhfREVGSU5FX0RF
UFRIU1RFTkNJTF9WSUVXX1YyLAorCQkgICAgJnZtd19jbWRfc201X3ZpZXdfZGVmaW5lLCB0cnVl
LCBmYWxzZSwgdHJ1ZSksCiB9OwogCiBib29sIHZtd19jbWRfZGVzY3JpYmUoY29uc3Qgdm9pZCAq
YnVmLCB1MzIgKnNpemUsIGNoYXIgY29uc3QgKipjbWQpCi0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
