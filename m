Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A949287FC2
	for <lists+dri-devel@lfdr.de>; Fri,  9 Oct 2020 03:04:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8D4446EB95;
	Fri,  9 Oct 2020 01:04:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 27FAD6EB93
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Oct 2020 01:04:20 +0000 (UTC)
IronPort-SDR: wOc+ENpq7DSYaBkWqKUTXG7a3WrufbDMkaI0zI+d5j9PhE51N6grFNUY8sCbUSQrTttHIZjHrA
 EFqr4K0kgGyA==
X-IronPort-AV: E=McAfee;i="6000,8403,9768"; a="162789785"
X-IronPort-AV: E=Sophos;i="5.77,353,1596524400"; d="scan'208";a="162789785"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 08 Oct 2020 18:04:20 -0700
IronPort-SDR: y1uRstfYpkVrS2BtLZc2O35FKVTin6wXem7LQ7hYhIxZubHJTu/yuL8VP6TA+xJWbzYbwje5xe
 MRKLKFg0Vihw==
X-IronPort-AV: E=Sophos;i="5.77,353,1596524400"; d="scan'208";a="343626288"
Received: from mgleaso-mobl.amr.corp.intel.com (HELO
 achrisan-DESK2.amr.corp.intel.com) ([10.251.146.83])
 by fmsmga004-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-SHA;
 08 Oct 2020 18:04:19 -0700
From: Anitha Chrisanthus <anitha.chrisanthus@intel.com>
To: dri-devel@lists.freedesktop.org, anitha.chrisanthus@intel.com,
 devicetree@vger.kernel.org
Subject: [PATCH v9 3/5] drm/kmb: Add support for KeemBay Display
Date: Thu,  8 Oct 2020 18:04:01 -0700
Message-Id: <1602205443-9036-4-git-send-email-anitha.chrisanthus@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1602205443-9036-1-git-send-email-anitha.chrisanthus@intel.com>
References: <1602205443-9036-1-git-send-email-anitha.chrisanthus@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@intel.com, edmund.j.dea@intel.com, sam@ravnborg.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBhIGJhc2ljIEtNUyBhdG9taWMgbW9kZXNldHRpbmcgZGlzcGxheSBkcml2ZXIgZm9y
IEtlZW1CYXkgZmFtaWx5IG9mClNPQ3MuIERyaXZlciBoYXMgbm8gMkQgb3IgM0QgZ3JhcGhpY3Mu
SXQgY2FsbHMgaW50byB0aGUgQURWIGJyaWRnZQpkcml2ZXIgYXQgdGhlIGNvbm5lY3RvciBsZXZl
bC4KClNpbmdsZSBDUlRDIHdpdGggTENEIGNvbnRyb2xsZXItPm1pcGkgRFNJLT4gQURWIGJyaWRn
ZQoKT25seSAxMDgwcCByZXNvbHV0aW9uIGFuZCBzaW5nbGUgcGxhbmUgaXMgc3VwcG9ydGVkIGF0
IHRoaXMgdGltZS4KCnYyOiBtb3ZlZCBleHRlcm4gdG8gLmgsIHJlbW92ZWQgbGljZW5zZSB0ZXh0
CiAgICB1c2UgZHJtX2Rldl9pbml0LCB1cGNsYXNzZWQgZGV2X3ByaXZhdGUsIHJlbW92ZWQgSEFW
RV9JUlEuKFNhbSkKCnYzOiBTcXVhc2hlZCBhbGwgNTkgY29tbWl0cyB0byBvbmUKCnY0OiByZXZp
ZXcgY2hhbmdlcyBmcm9tIFNhbSBSYXZuYm9yZwoJcmVuYW1lZCBkZXZfcCB0byBrbWIKCW1vdmVk
IGNsb2NrcyB1bmRlciBrbWJfY2xvY2ssIGNvbnNvbGlkYXRlZCBjbGsgaW5pdGlhbGl6YXRpb25z
Cgl1c2UgZHJtbSBmdW5jdGlvbnMKCXVzZSBEUk1fR0VNX0NNQV9EUklWRVJfT1BTX1ZNQVAKCnY1
OiBjb3JyZWN0ZWQgc3BlbGxpbmdzCnY2OiBjb3JyZWN0ZWQgY2hlY2twYXRjaCB3YXJuaW5ncwp2
NzogcmV2aWV3IGNoYW5nZXMgU2FtIFJhdm5ib3JnIGFuZCBUaG9tYXMgWmltbWVybWFuCglyZW1v
dmVkIGttYl9jcnRjLmgga21iX2NydGNfY2xlYW51cCAoVGhvbWFzKQoJcmVuYW1lZCBtb2RlX3Nl
dCwga21iX2xvYWQsIGlubGluZWQgdW5sb2FkIChUaG9tYXMpCgltb3ZlZCByZW1haW5pbmcgbG9n
Z2luZyB0byBkcm1fKihUaG9tYXMpCglyZS1vcmdlZCBkcml2ZXIgaW5pdGlhbGl6YXRpb24gKFRo
b21hcykKCW1vdmVkIHBsYW5lX3N0YXR1cyB0byBkcm1fcHJpdmF0ZSAoU2FtKQoJcmVtb3ZlZCB1
bm5lY2Vzc2FyeSBsb2dzIGFuZCBkZWZpbmVzIGFuZCBpZmRlZiBjb2RlcyAoU2FtKQoJY2FsbCBo
ZWxwZXJfY2hlY2sgaW4gcGxhbmVfYXRvbWljX2NoZWNrIChTYW0pCglyZW5hbWVkIHNldCB0byBn
ZXQgZm9yIGJwcCBhbmQgZm9ybWF0IGZ1bmN0aW9ucyhTYW0pCgl1c2UgZHJtIGhlbHBlciBmdW5j
dGlvbnMgZm9yIHJlc2V0LCBkdXBsaWNhdGUvZGVzdHJveSBzdGF0ZSBpbnN0ZWFkCglvZiBrbWIg
ZnVuY3Rpb25zIChTYW0pCglyZW1vdmVkIGttYl9wcml2IGZyb20ga21iX3BsYW5lIGFuZCByZW1v
dmVkIGttYl9wbGFuZV9zdGF0ZSAoU2FtKQp2ODogZ2V0IGNsa19wbGwwIGZyb20gZGlzcGxheSBu
b2RlIGluIGR0CnY5OiBtb3ZlZCBjc2NfY29lZl9sY2QgdG8gcGxhbmUuYyAoRGFuaWVsIFZldHRl
cikKICAgIGNhbGwgZHJtX2F0b21pY19oZWxwZXJfc2h1dGRvd24gaW4gcmVtb3ZlIChEYW5pZWwg
VikKICAgIHVzZSBkcm1fY3J0Y19oYW5kbGVfdmJsYW5rIChEYW5pZWwgVikKICAgIHJlbmFtZWQg
a21iX2RzaV9od19pbml0IHRvIGttYl9kc2lfbW9kZV9zZXQgKERhbmllbCBWKQogICAgY29tcGxp
bWVudGFyeSBjaGFuZ2VzIHRvIGRldmljZSB0cmVlIGNoYW5nZXMgKFJvYikKCkNjOiBTYW0gUmF2
bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+ClNpZ25lZC1vZmYtYnk6IEFuaXRoYSBDaHJpc2FudGh1
cyA8YW5pdGhhLmNocmlzYW50aHVzQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IEJvYiBQYWF1d2Ug
PGJvYi5qLnBhYXV3ZUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfY3J0
Yy5jICB8IDIyNCArKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuYyAg
IHwgNjc2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMv
Z3B1L2RybS9rbWIva21iX2Rydi5oICAgfCAxNzAgKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJt
L2ttYi9rbWJfcGxhbmUuYyB8IDQ4OCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJp
dmVycy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuaCB8IDEwMiArKysrKysKIDUgZmlsZXMgY2hhbmdl
ZCwgMTY2MCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJt
L2ttYi9rbWJfY3J0Yy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2ttYi9r
bWJfZHJ2LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYu
aAogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5oCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2tt
Yi9rbWJfY3J0Yy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjcyZGNiZGYK
LS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9jcnRjLmMKQEAgLTAs
MCArMSwyMjQgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKKy8q
CisgKiBDb3B5cmlnaHQgwqkgMjAxOC0yMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lu
Y2x1ZGUgPGxpbnV4L2Nsay5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2dyYXBoLmg+CisjaW5jbHVk
ZSA8bGludXgvcGxhdGZvcm1fZGF0YS9zaW1wbGVmYi5oPgorCisjaW5jbHVkZSA8dmlkZW8vdmlk
ZW9tb2RlLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9k
cm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgorI2luY2x1ZGUg
PGRybS9kcm1fY3J0Y19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RlYnVnZnMuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9mYl9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxw
ZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2dlbV9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9vZi5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV92YmxhbmsuaD4KKworI2luY2x1ZGUgImttYl9kcnYuaCIKKyNpbmNsdWRlICJrbWJf
ZHNpLmgiCisjaW5jbHVkZSAia21iX3BsYW5lLmgiCisjaW5jbHVkZSAia21iX3JlZ3MuaCIKKwor
c3RydWN0IGttYl9jcnRjX3RpbWluZyB7CisJdTMyIHZmcm9udF9wb3JjaDsKKwl1MzIgdmJhY2tf
cG9yY2g7CisJdTMyIHZzeW5jX2xlbjsKKwl1MzIgaGZyb250X3BvcmNoOworCXUzMiBoYmFja19w
b3JjaDsKKwl1MzIgaHN5bmNfbGVuOworfTsKKworc3RhdGljIGludCBrbWJfY3J0Y19lbmFibGVf
dmJsYW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gY3J0Yy0+ZGV2OworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9IHRvX2ttYihkZXYp
OworCisJLyogQ2xlYXIgaW50ZXJydXB0ICovCisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9JTlRf
Q0xFQVIsIExDRF9JTlRfVkVSVF9DT01QKTsKKwkvKiBTZXQgd2hpY2ggaW50ZXJ2YWwgdG8gZ2Vu
ZXJhdGUgdmVydGljYWwgaW50ZXJydXB0ICovCisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9WU1RB
VFVTX0NPTVBBUkUsCisJCSAgICAgIExDRF9WU1RBVFVTX0NPTVBBUkVfVlNZTkMpOworCS8qIEVu
YWJsZSB2ZXJ0aWNhbCBpbnRlcnJ1cHQgKi8KKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENE
X0lOVF9FTkFCTEUsCisJCQkgICAgTENEX0lOVF9WRVJUX0NPTVApOworCXJldHVybiAwOworfQor
CitzdGF0aWMgdm9pZCBrbWJfY3J0Y19kaXNhYmxlX3ZibGFuayhzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3Qga21i
X2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCS8qIENsZWFyIGludGVycnVwdCAq
LworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5UX1ZFUlRfQ09NUCk7
CisJLyogRGlzYWJsZSB2ZXJ0aWNhbCBpbnRlcnJ1cHQgKi8KKwlrbWJfY2xyX2JpdG1hc2tfbGNk
KGttYiwgTENEX0lOVF9FTkFCTEUsCisJCQkgICAgTENEX0lOVF9WRVJUX0NPTVApOworfQorCitz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGttYl9jcnRjX2Z1bmNzID0geworCS5k
ZXN0cm95ID0gZHJtX2NydGNfY2xlYW51cCwKKwkuc2V0X2NvbmZpZyA9IGRybV9hdG9taWNfaGVs
cGVyX3NldF9jb25maWcsCisJLnBhZ2VfZmxpcCA9IGRybV9hdG9taWNfaGVscGVyX3BhZ2VfZmxp
cCwKKwkucmVzZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0LAorCS5hdG9taWNfZHVw
bGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kdXBsaWNhdGVfc3RhdGUsCisJ
LmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0
YXRlLAorCS5lbmFibGVfdmJsYW5rID0ga21iX2NydGNfZW5hYmxlX3ZibGFuaywKKwkuZGlzYWJs
ZV92YmxhbmsgPSBrbWJfY3J0Y19kaXNhYmxlX3ZibGFuaywKK307CisKK3N0YXRpYyB2b2lkIGtt
Yl9jcnRjX3NldF9tb2RlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gY3J0Yy0+ZGV2OworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptID0gJmNy
dGMtPnN0YXRlLT5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBrbWJfY3J0Y190aW1pbmcgdm07CisJ
aW50IHZzeW5jX3N0YXJ0X29mZnNldDsKKwlpbnQgdnN5bmNfZW5kX29mZnNldDsKKwlzdHJ1Y3Qg
a21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKwl1bnNpZ25lZCBpbnQgdmFsID0g
MDsKKworCS8qIEluaXRpYWxpemUgbWlwaSAqLworCWttYl9kc2lfbW9kZV9zZXQoZGV2LCBtKTsK
Kwlkcm1faW5mbyhkZXYsCisJCSAidmZwPSAlZCB2YnA9ICVkIHZzeWNfbGVuPSVkIGhmcD0lZCBo
YnA9JWQgaHN5bmNfbGVuPSVkXG4iLAorCQkgbS0+Y3J0Y192c3luY19zdGFydCAtIG0tPmNydGNf
dmRpc3BsYXksCisJCSBtLT5jcnRjX3Z0b3RhbCAtIG0tPmNydGNfdnN5bmNfZW5kLAorCQkgbS0+
Y3J0Y192c3luY19lbmQgLSBtLT5jcnRjX3ZzeW5jX3N0YXJ0LAorCQkgbS0+Y3J0Y19oc3luY19z
dGFydCAtIG0tPmNydGNfaGRpc3BsYXksCisJCSBtLT5jcnRjX2h0b3RhbCAtIG0tPmNydGNfaHN5
bmNfZW5kLAorCQkgbS0+Y3J0Y19oc3luY19lbmQgLSBtLT5jcnRjX2hzeW5jX3N0YXJ0KTsKKwl2
YWwgPSBrbWJfcmVhZF9sY2Qoa21iLCBMQ0RfSU5UX0VOQUJMRSk7CisJa21iX2Nscl9iaXRtYXNr
X2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLCB2YWwpOworCWttYl9zZXRfYml0bWFza19sY2Qoa21i
LCBMQ0RfSU5UX0NMRUFSLCB+MHgwKTsKKwl2bS52ZnJvbnRfcG9yY2ggPSAyOworCXZtLnZiYWNr
X3BvcmNoID0gMjsKKwl2bS52c3luY19sZW4gPSA4OworCXZtLmhmcm9udF9wb3JjaCA9IDA7CisJ
dm0uaGJhY2tfcG9yY2ggPSAwOworCXZtLmhzeW5jX2xlbiA9IDI4OworCisJdnN5bmNfc3RhcnRf
b2Zmc2V0ID0gIG0tPmNydGNfdnN5bmNfc3RhcnQgLSAgbS0+Y3J0Y19oc3luY19zdGFydDsKKwl2
c3luY19lbmRfb2Zmc2V0ID0gIG0tPmNydGNfdnN5bmNfZW5kIC0gbS0+Y3J0Y19oc3luY19lbmQ7
CisKKwlkcm1fZGJnKGRldiwgIiVzIDogJWRhY3RpdmUgaGVpZ2h0PSAlZCB2YnA9JWQgdmZwPSVk
IHZzeW5jLXc9JWQgaC1hY3RpdmU9JWQgaC1icD0lZCBoLWZwPSVkIGh5c25jLWw9JWQiLAorCQlf
X2Z1bmNfXywgX19MSU5FX18sCisJCQltLT5jcnRjX3ZkaXNwbGF5LCB2bS52YmFja19wb3JjaCwg
dm0udmZyb250X3BvcmNoLAorCQkJdm0udnN5bmNfbGVuLCBtLT5jcnRjX2hkaXNwbGF5LCB2bS5o
YmFja19wb3JjaCwKKwkJCXZtLmhmcm9udF9wb3JjaCwgdm0uaHN5bmNfbGVuKTsKKwlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX1ZfQUNUSVZFSEVJR0hULAorCQkgICAgICBtLT5jcnRjX3ZkaXNwbGF5
IC0gMSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9WX0JBQ0tQT1JDSCwgdm0udmJhY2tfcG9y
Y2gpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVl9GUk9OVFBPUkNILCB2bS52ZnJvbnRfcG9y
Y2gpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVlNZTkNfV0lEVEgsIHZtLnZzeW5jX2xlbiAt
IDEpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSF9BQ1RJVkVXSURUSCwKKwkJICAgICAgbS0+
Y3J0Y19oZGlzcGxheSAtIDEpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSF9CQUNLUE9SQ0gs
IHZtLmhiYWNrX3BvcmNoKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0hfRlJPTlRQT1JDSCwg
dm0uaGZyb250X3BvcmNoKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0hTWU5DX1dJRFRILCB2
bS5oc3luY19sZW4gLSAxKTsKKwkvKiBUaGlzIGlzIGhhcmRjb2RlZCBhcyAwIGluIHRoZSBNeXJp
YWR4IGNvZGUgKi8KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX1ZTWU5DX1NUQVJULCAwKTsKKwlr
bWJfd3JpdGVfbGNkKGttYiwgTENEX1ZTWU5DX0VORCwgMCk7CisJLyogQmFjayBncm91bmQgY29s
b3IgKi8KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0JHX0NPTE9VUl9MUywgMHg0KTsKKwlpZiAo
bS0+ZmxhZ3MgPT0gRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKKwkJa21iX3dyaXRlX2xjZChr
bWIsCisJCQkgICAgICBMQ0RfVlNZTkNfV0lEVEhfRVZFTiwgdm0udnN5bmNfbGVuIC0gMSk7CisJ
CWttYl93cml0ZV9sY2Qoa21iLAorCQkJICAgICAgTENEX1ZfQkFDS1BPUkNIX0VWRU4sIHZtLnZi
YWNrX3BvcmNoKTsKKwkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkgICAgICBMQ0RfVl9GUk9OVFBP
UkNIX0VWRU4sIHZtLnZmcm9udF9wb3JjaCk7CisJCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVl9B
Q1RJVkVIRUlHSFRfRVZFTiwKKwkJCSAgICAgIG0tPmNydGNfdmRpc3BsYXkgLSAxKTsKKwkJLyog
VGhpcyBpcyBoYXJkY29kZWQgYXMgMTAgaW4gdGhlIE15cmlhZHggY29kZSAqLworCQlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX1ZTWU5DX1NUQVJUX0VWRU4sIDEwKTsKKwkJa21iX3dyaXRlX2xjZChr
bWIsIExDRF9WU1lOQ19FTkRfRVZFTiwgMTApOworCX0KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENE
X1RJTUlOR19HRU5fVFJJRywgRU5BQkxFKTsKKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENE
X0NPTlRST0wsIExDRF9DVFJMX0VOQUJMRSk7CisJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsIExD
RF9JTlRfRU5BQkxFLCB2YWwpOworfQorCitzdGF0aWMgdm9pZCBrbWJfY3J0Y19hdG9taWNfZW5h
YmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUg
Km9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpsY2QgPSBjcnRjX3RvX2tt
Yl9wcml2KGNydGMpOworCisJY2xrX3ByZXBhcmVfZW5hYmxlKGxjZC0+Y2xrKTsKKwlrbWJfY3J0
Y19zZXRfbW9kZShjcnRjKTsKKwlkcm1fY3J0Y192Ymxhbmtfb24oY3J0Yyk7Cit9CisKK3N0YXRp
YyB2b2lkIGttYl9jcnRjX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJ
CQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3RydWN0IGttYl9k
cm1fcHJpdmF0ZSAqbGNkID0gY3J0Y190b19rbWJfcHJpdihjcnRjKTsKKworCS8qIGR1ZSB0byBo
dyBsaW1pdGF0aW9ucywgcGxhbmVzIG5lZWQgdG8gYmUgb2ZmIHdoZW4gY3J0YyBpcyBvZmYgKi8K
Kwlkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lc19vbl9jcnRjKG9sZF9zdGF0ZSwgZmFs
c2UpOworCisJZHJtX2NydGNfdmJsYW5rX29mZihjcnRjKTsKKwljbGtfZGlzYWJsZV91bnByZXBh
cmUobGNkLT5jbGspOworfQorCitzdGF0aWMgdm9pZCBrbWJfY3J0Y19hdG9taWNfYmVnaW4oc3Ry
dWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkK
K3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2OworCXN0cnVjdCBrbWJfZHJt
X3ByaXZhdGUgKmttYiA9IHRvX2ttYihkZXYpOworCisJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIs
IExDRF9JTlRfRU5BQkxFLAorCQkJICAgIExDRF9JTlRfVkVSVF9DT01QKTsKK30KKworc3RhdGlj
IHZvaWQga21iX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkg
IHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGMtPmRldjsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2
KTsKKworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0VOQUJMRSwKKwkJCSAgICBM
Q0RfSU5UX1ZFUlRfQ09NUCk7CisKKwlzcGluX2xvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xv
Y2spOworCWlmIChjcnRjLT5zdGF0ZS0+ZXZlbnQpCisJCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2
ZW50KGNydGMsIGNydGMtPnN0YXRlLT5ldmVudCk7CisJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVM
TDsKKwlzcGluX3VubG9ja19pcnEoJmNydGMtPmRldi0+ZXZlbnRfbG9jayk7Cit9CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfaGVscGVyX2Z1bmNzIGttYl9jcnRjX2hlbHBlcl9mdW5j
cyA9IHsKKwkuYXRvbWljX2JlZ2luID0ga21iX2NydGNfYXRvbWljX2JlZ2luLAorCS5hdG9taWNf
ZW5hYmxlID0ga21iX2NydGNfYXRvbWljX2VuYWJsZSwKKwkuYXRvbWljX2Rpc2FibGUgPSBrbWJf
Y3J0Y19hdG9taWNfZGlzYWJsZSwKKwkuYXRvbWljX2ZsdXNoID0ga21iX2NydGNfYXRvbWljX2Zs
dXNoLAorfTsKKworaW50IGttYl9zZXR1cF9jcnRjKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7
CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7CisJc3RydWN0IGtt
Yl9wbGFuZSAqcHJpbWFyeTsKKwlpbnQgcmV0OworCisJcHJpbWFyeSA9IGttYl9wbGFuZV9pbml0
KGRybSk7CisJaWYgKElTX0VSUihwcmltYXJ5KSkKKwkJcmV0dXJuIFBUUl9FUlIocHJpbWFyeSk7
CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhfcGxhbmVzKGRybSwgJmttYi0+Y3J0YywgJnBy
aW1hcnktPmJhc2VfcGxhbmUsCisJCQkJCU5VTEwsICZrbWJfY3J0Y19mdW5jcywgTlVMTCk7CisJ
aWYgKHJldCkgeworCQlrbWJfcGxhbmVfZGVzdHJveSgmcHJpbWFyeS0+YmFzZV9wbGFuZSk7CisJ
CXJldHVybiByZXQ7CisJfQorCisJZHJtX2NydGNfaGVscGVyX2FkZCgma21iLT5jcnRjLCAma21i
X2NydGNfaGVscGVyX2Z1bmNzKTsKKwlyZXR1cm4gMDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9rbWIva21iX2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfZHJ2LmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uNGE1YmVjZjQKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuYwpAQCAtMCwwICsxLDY3NiBAQAorLy8g
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQorLyoKKyAqIENvcHlyaWdodCDC
qSAyMDE4LTIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvY2xr
Lmg+CisjaW5jbHVkZSA8bGludXgvY29uc29sZS5oPgorI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4K
KyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZl9ncmFwaC5oPgor
I2luY2x1ZGUgPGxpbnV4L29mX3Jlc2VydmVkX21lbS5oPgorI2luY2x1ZGUgPGxpbnV4L3BsYXRm
b3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KKyNpbmNsdWRlIDxs
aW51eC9zcGlubG9jay5oPgorCisjaW5jbHVkZSA8ZHJtL2RybS5oPgorI2luY2x1ZGUgPGRybS9k
cm1fYXRvbWljLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9jcnRjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kZXZpY2UuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2Rydi5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmJfY21hX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fZmJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fY21hX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1faW9jdGwuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2lycS5oPgorI2luY2x1
ZGUgPGRybS9kcm1fb2YuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CisKKyNpbmNsdWRlICJrbWJfZHJ2LmgiCisjaW5jbHVk
ZSAia21iX2RzaS5oIgorI2luY2x1ZGUgImttYl9yZWdzLmgiCisKK2ludCBrbWJfdW5kZXJfZmxv
dyA9IDAsIGttYl9mbHVzaF9kb25lID0gMCwgbGF5ZXJfbm8gPSAwOworc3RhdGljIHN0cnVjdCBr
bWJfY2xvY2sga21iX2NsazsKKworc3RhdGljIHN0cnVjdCBkcm1fYnJpZGdlICphZHZfYnJpZGdl
OworCitpbnQga21iX2Rpc3BsYXlfY2xrX2VuYWJsZShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpr
bWIpCit7CisJaW50IHJldCA9IDA7CisKKwlyZXQgPSBjbGtfcHJlcGFyZV9lbmFibGUoa21iX2Ns
ay5jbGtfbGNkKTsKKwlpZiAocmV0KSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiRmFpbGVkIHRv
IGVuYWJsZSBMQ0QgY2xvY2s6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJl
dCA9IGNsa19wcmVwYXJlX2VuYWJsZShrbWJfY2xrLmNsa19taXBpKTsKKwlpZiAocmV0KSB7CisJ
CWRybV9lcnIoJmttYi0+ZHJtLCAiRmFpbGVkIHRvIGVuYWJsZSBNSVBJIGNsb2NrOiAlZFxuIiwg
cmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSBjbGtfcHJlcGFyZV9lbmFibGUoa21i
X2Nsay5jbGtfbWlwaV9lY2ZnKTsKKwlpZiAocmV0KSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLAor
CQkJIkZhaWxlZCB0byBlbmFibGUgTUlQSV9FQ0ZHIGNsb2NrOiAlZFxuIiwgcmV0KTsKKwkJcmV0
dXJuIHJldDsKKwl9CisKKwlyZXQgPSBjbGtfcHJlcGFyZV9lbmFibGUoa21iX2Nsay5jbGtfbWlw
aV9jZmcpOworCWlmIChyZXQpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sCisJCQkiRmFpbGVkIHRv
IGVuYWJsZSBNSVBJX0NGRyBjbG9jazogJWRcbiIsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQor
CURSTV9JTkZPKCJTVUNDRVNTIDogZW5hYmxlZCBMQ0QgTUlQSSBjbG9ja3NcbiIpOworCXJldHVy
biAwOworfQorCitpbnQga21iX2luaXRpYWxpemVfY2xvY2tzKHN0cnVjdCBrbWJfZHJtX3ByaXZh
dGUgKmttYiwgc3RydWN0IGRldmljZSAqZGV2KQoreworCXVuc2lnbmVkIGxvbmcgY2xrOworCWlu
dCByZXQgPSAwOworCisJa21iX2Nsay5jbGtfbGNkID0gY2xrX2dldChkZXYsICJjbGtfbGNkIik7
CisJaWYgKElTX0VSUihrbWJfY2xrLmNsa19sY2QpKSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAi
Y2xrX2dldCgpIGZhaWxlZCBjbGtfbGNkXG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIoa21iX2Nsay5j
bGtfbGNkKTsKKwl9CisKKwlrbWJfY2xrLmNsa19taXBpID0gY2xrX2dldChkZXYsICJjbGtfbWlw
aSIpOworCWlmIChJU19FUlIoa21iX2Nsay5jbGtfbWlwaSkpIHsKKwkJZHJtX2Vycigma21iLT5k
cm0sICJjbGtfZ2V0KCkgZmFpbGVkIGNsa19taXBpXG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIoa21i
X2Nsay5jbGtfbWlwaSk7CisJfQorCisJa21iX2Nsay5jbGtfbWlwaV9lY2ZnID0gY2xrX2dldChk
ZXYsICJjbGtfbWlwaV9lY2ZnIik7CisJaWYgKElTX0VSUihrbWJfY2xrLmNsa19taXBpX2VjZmcp
KSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiY2xrX2dldCgpIGZhaWxlZCBjbGtfbWlwaV9lY2Zn
XG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIoa21iX2Nsay5jbGtfbWlwaV9lY2ZnKTsKKwl9CisKKwlr
bWJfY2xrLmNsa19taXBpX2NmZyA9IGNsa19nZXQoZGV2LCAiY2xrX21pcGlfY2ZnIik7CisJaWYg
KElTX0VSUihrbWJfY2xrLmNsa19taXBpX2NmZykpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJj
bGtfZ2V0KCkgZmFpbGVkIGNsa19taXBpX2NmZ1xuIik7CisJCXJldHVybiBQVFJfRVJSKGttYl9j
bGsuY2xrX21pcGlfY2ZnKTsKKwl9CisKKwlrbWJfY2xrLmNsa19wbGwwID0gY2xrX2dldChkZXYs
ICJjbGtfcGxsMCIpOworCWlmIChJU19FUlIoa21iX2Nsay5jbGtfcGxsMCkpIHsKKwkJZHJtX2Vy
cigma21iLT5kcm0sICJjbGtfZ2V0KCkgZmFpbGVkIGNsa19wbGwwICIpOworCQlyZXR1cm4gUFRS
X0VSUihrbWJfY2xrLmNsa19wbGwwKTsKKwl9CisJa21iLT5zeXNfY2xrX21oeiA9IGNsa19nZXRf
cmF0ZShrbWJfY2xrLmNsa19wbGwwKSAvIDEwMDAwMDA7CisJZHJtX2luZm8oJmttYi0+ZHJtLCAi
c3lzdGVtIGNsayA9ICVkIE1oeiIsIGttYi0+c3lzX2Nsa19taHopOworCisJLyogU2V0IExDRCBj
bG9jayB0byAyMDAgTWh6ICovCisJY2xrX3NldF9yYXRlKGttYl9jbGsuY2xrX2xjZCwgS01CX0xD
RF9ERUZBVUxUX0NMSyk7CisJaWYgKGNsa19nZXRfcmF0ZShrbWJfY2xrLmNsa19sY2QpICE9IEtN
Ql9MQ0RfREVGQVVMVF9DTEspIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJmYWlsZWQgdG8gc2V0
IHRvIGNsa19sY2QgdG8gJWRcbiIsCisJCQlLTUJfTENEX0RFRkFVTFRfQ0xLKTsKKwkJcmV0dXJu
IC0xOworCX0KKwlkcm1fZGJnKCZrbWItPmRybSwgImNsa19sY2QgPSAlbGRcbiIsIGNsa19nZXRf
cmF0ZShrbWJfY2xrLmNsa19sY2QpKTsKKworCS8qIFNldCBNSVBJIGNsb2NrIHRvIDI0IE1oeiAq
LworCWNsa19zZXRfcmF0ZShrbWJfY2xrLmNsa19taXBpLCBLTUJfTUlQSV9ERUZBVUxUX0NMSyk7
CisJaWYgKGNsa19nZXRfcmF0ZShrbWJfY2xrLmNsa19taXBpKSAhPSBLTUJfTUlQSV9ERUZBVUxU
X0NMSykgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0byBzZXQgdG8gY2xrX21pcGkg
dG8gJWRcbiIsCisJCQlLTUJfTUlQSV9ERUZBVUxUX0NMSyk7CisJCXJldHVybiAtMTsKKwl9CisJ
ZHJtX2RiZygma21iLT5kcm0sICJjbGtfbWlwaSA9ICVsZFxuIiwgY2xrX2dldF9yYXRlKGttYl9j
bGsuY2xrX21pcGkpKTsKKworCWNsayA9IGNsa19nZXRfcmF0ZShrbWJfY2xrLmNsa19taXBpX2Vj
ZmcpOworCWlmIChjbGsgIT0gS01CX01JUElfREVGQVVMVF9DRkdfQ0xLKSB7CisJCS8qIFNldCBN
SVBJX0VDRkcgY2xvY2sgdG8gMjQgTWh6ICovCisJCWNsa19zZXRfcmF0ZShrbWJfY2xrLmNsa19t
aXBpX2VjZmcsIEtNQl9NSVBJX0RFRkFVTFRfQ0ZHX0NMSyk7CisJCWNsayA9IGNsa19nZXRfcmF0
ZShrbWJfY2xrLmNsa19taXBpX2VjZmcpOworCQlpZiAoY2xrICE9IEtNQl9NSVBJX0RFRkFVTFRf
Q0ZHX0NMSykgeworCQkJZHJtX2Vycigma21iLT5kcm0sCisJCQkJImZhaWxlZCB0byBzZXQgdG8g
Y2xrX21pcGlfZWNmZyB0byAlZFxuIiwKKwkJCQkgS01CX01JUElfREVGQVVMVF9DRkdfQ0xLKTsK
KwkJCXJldHVybiAtMTsKKwkJfQorCX0KKworCWNsayA9IGNsa19nZXRfcmF0ZShrbWJfY2xrLmNs
a19taXBpX2NmZyk7CisJaWYgKGNsayAhPSBLTUJfTUlQSV9ERUZBVUxUX0NGR19DTEspIHsKKwkJ
LyogU2V0IE1JUElfQ0ZHIGNsb2NrIHRvIDI0IE1oeiAqLworCQljbGtfc2V0X3JhdGUoa21iX2Ns
ay5jbGtfbWlwaV9jZmcsIDI0MDAwMDAwKTsKKwkJY2xrID0gY2xrX2dldF9yYXRlKGttYl9jbGsu
Y2xrX21pcGlfY2ZnKTsKKwkJaWYgKGNsayAhPSBLTUJfTUlQSV9ERUZBVUxUX0NGR19DTEspIHsK
KwkJCWRybV9lcnIoJmttYi0+ZHJtLAorCQkJCSJmYWlsZWQgdG8gc2V0IGNsa19taXBpX2NmZyB0
byAlZFxuIiwKKwkJCQkgIEtNQl9NSVBJX0RFRkFVTFRfQ0ZHX0NMSyk7CisJCQlyZXR1cm4gLTE7
CisJCX0KKwl9CisKKwlyZXQgPSBrbWJfZGlzcGxheV9jbGtfZW5hYmxlKGttYik7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKworCS8qIEVuYWJsZSBNU1NfQ0FNX0NMS19DVFJMIGZvciBNSVBJ
IFRYIGFuZCBMQ0QgKi8KKwlrbWJfc2V0X2JpdG1hc2tfbXNzY2FtKGttYiwgTVNTX0NBTV9DTEtf
Q1RSTCwgMHgxZmZmKTsKKwlrbWJfc2V0X2JpdG1hc2tfbXNzY2FtKGttYiwgTVNTX0NBTV9SU1RO
X0NUUkwsIDB4ZmZmZmZmZmYpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGttYl9kaXNw
bGF5X2Nsa19kaXNhYmxlKHZvaWQpCit7CisJaWYgKGttYl9jbGsuY2xrX2xjZCkKKwkJY2xrX2Rp
c2FibGVfdW5wcmVwYXJlKGttYl9jbGsuY2xrX2xjZCk7CisJaWYgKGttYl9jbGsuY2xrX21pcGkp
CisJCWNsa19kaXNhYmxlX3VucHJlcGFyZShrbWJfY2xrLmNsa19taXBpKTsKKwlpZiAoa21iX2Ns
ay5jbGtfbWlwaV9lY2ZnKQorCQljbGtfZGlzYWJsZV91bnByZXBhcmUoa21iX2Nsay5jbGtfbWlw
aV9lY2ZnKTsKKwlpZiAoa21iX2Nsay5jbGtfbWlwaV9jZmcpCisJCWNsa19kaXNhYmxlX3VucHJl
cGFyZShrbWJfY2xrLmNsa19taXBpX2NmZyk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lk
IF9faW9tZW0gKmttYl9tYXBfbW1pbyhzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLCBjaGFyICpuYW1l
KQoreworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBk
ZXYgPSB0b19wbGF0Zm9ybV9kZXZpY2UoZHJtLT5kZXYpOworCXZvaWQgX19pb21lbSAqbWVtOwor
CisJcmVzID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlX2J5bmFtZShwZGV2LCBJT1JFU09VUkNFX01F
TSwgbmFtZSk7CisJaWYgKCFyZXMpIHsKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gZ2V0IHJl
c291cmNlIGZvciAlcyIsIG5hbWUpOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwl9CisJ
bWVtID0gZGV2bV9pb3JlbWFwX3Jlc291cmNlKGRybS0+ZGV2LCByZXMpOworCWlmIChJU19FUlIo
bWVtKSkKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gaW9yZW1hcCAlcyByZWdpc3RlcnMiLCBu
YW1lKTsKKwlyZXR1cm4gbWVtOworfQorCitzdGF0aWMgaW50IGttYl9od19pbml0KHN0cnVjdCBk
cm1fZGV2aWNlICpkcm0sIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCit7CisJc3RydWN0IGttYl9kcm1f
cHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7CisJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRl
diA9IHRvX3BsYXRmb3JtX2RldmljZShkcm0tPmRldik7CisJaW50IGlycV9sY2Q7CisJaW50IHJl
dCA9IDA7CisKKwkvKiBNYXAgTENEIE1NSU8gcmVnaXN0ZXJzICovCisJa21iLT5sY2RfbW1pbyA9
IGttYl9tYXBfbW1pbyhkcm0sICJsY2QiKTsKKwlpZiAoSVNfRVJSKGttYi0+bGNkX21taW8pKSB7
CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVkIHRvIG1hcCBMQ0QgcmVnaXN0ZXJzXG4iKTsK
KwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJLyogTWFwIE1JUEkgTU1JTyByZWdpc3RlcnMgKi8K
KwlrbWItPm1pcGlfbW1pbyA9IGttYl9tYXBfbW1pbyhkcm0sICJtaXBpIik7CisJaWYgKElTX0VS
UihrbWItPm1pcGlfbW1pbykpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJmYWlsZWQgdG8gbWFw
IE1JUEkgcmVnaXN0ZXJzXG4iKTsKKwkJaW91bm1hcChrbWItPmxjZF9tbWlvKTsKKwkJcmV0dXJu
IC1FTk9NRU07CisJfQorCisJLyogVGhpcyBpcyBvbmx5IGZvciBNSVBJX1RYX01TU19MQ0RfTUlQ
SV9DRkcgYW5kCisJICogTVNTX0NBTV9DTEtfQ1RSTCByZWdpc3RlcgorCSAqLworCWttYi0+bXNz
Y2FtX21taW8gPSBrbWJfbWFwX21taW8oZHJtLCAibXNzY2FtIik7CisJaWYgKElTX0VSUihrbWIt
Pm1zc2NhbV9tbWlvKSkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0byBtYXAgTVNT
Q0FNIHJlZ2lzdGVyc1xuIik7CisJCWlvdW5tYXAoa21iLT5sY2RfbW1pbyk7CisJCWlvdW5tYXAo
a21iLT5taXBpX21taW8pOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlpZiAoSVNfRVJSKGtt
Yi0+bXNzY2FtX21taW8pKSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVkIHRvIG1hcCBN
U1NDQU0gcmVnaXN0ZXJzXG4iKTsKKwkJaW91bm1hcChrbWItPmxjZF9tbWlvKTsKKwkJaW91bm1h
cChrbWItPm1pcGlfbW1pbyk7CisJCXJldHVybiAtRU5PTUVNOworCX0KKwkvKiBFbmFibGUgZGlz
cGxheSBjbG9ja3MgKi8KKwlrbWJfaW5pdGlhbGl6ZV9jbG9ja3Moa21iLCAmcGRldi0+ZGV2KTsK
KworCS8qIFJlZ2lzdGVyIGlycXMgaGVyZSAtIHNlY3Rpb24gMTcuMyBpbiBkYXRhYm9vaworCSAq
IGxpc3RzIExDRCBhdCA3OSBhbmQgODIgZm9yIE1JUEkgdW5kZXIgTVNTIENQVSAtCisJICogZmly
bXdhcmUgaGFzIHJlZGlyZWN0ZWQgNzkgdG8gQTUzIElSUSAzMworCSAqLworCisJLyogQWxsb2Nh
dGUgTENEIGludGVycnVwdCByZXNvdXJjZXMgKi8KKwlpcnFfbGNkID0gcGxhdGZvcm1fZ2V0X2ly
cShwZGV2LCAwKTsKKwlpZiAoaXJxX2xjZCA8IDApIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJp
cnFfbGNkIG5vdCBmb3VuZCIpOworCQlnb3RvIHNldHVwX2ZhaWw7CisJfQorCisJLyogR2V0IHRo
ZSBvcHRpb25hbCBmcmFtZWJ1ZmZlciBtZW1vcnkgcmVzb3VyY2UgKi8KKwlyZXQgPSBvZl9yZXNl
cnZlZF9tZW1fZGV2aWNlX2luaXQoZHJtLT5kZXYpOworCWlmIChyZXQgJiYgcmV0ICE9IC1FTk9E
RVYpCisJCXJldHVybiByZXQ7CisKKwlzcGluX2xvY2tfaW5pdCgma21iLT5pcnFfbG9jayk7CisK
KwlrbWItPmlycV9sY2QgPSBpcnFfbGNkOworCisJcmV0dXJuIDA7CisKKyBzZXR1cF9mYWlsOgor
CW9mX3Jlc2VydmVkX21lbV9kZXZpY2VfcmVsZWFzZShkcm0tPmRldik7CisKKwlyZXR1cm4gcmV0
OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBrbWJfbW9k
ZV9jb25maWdfZnVuY3MgPSB7CisJLmZiX2NyZWF0ZSA9IGRybV9nZW1fZmJfY3JlYXRlLAorCS5h
dG9taWNfY2hlY2sgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVjaywKKwkuYXRvbWljX2NvbW1pdCA9
IGRybV9hdG9taWNfaGVscGVyX2NvbW1pdCwKK307CisKK3N0YXRpYyBpbnQga21iX3NldHVwX21v
ZGVfY29uZmlnKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7CisJaW50IHJldDsKKwlzdHJ1Y3Qg
a21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKworCXJldCA9IGRybW1fbW9kZV9j
b25maWdfaW5pdChkcm0pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisJZHJtLT5tb2RlX2Nv
bmZpZy5taW5fd2lkdGggPSBLTUJfTUlOX1dJRFRIOworCWRybS0+bW9kZV9jb25maWcubWluX2hl
aWdodCA9IEtNQl9NSU5fSEVJR0hUOworCWRybS0+bW9kZV9jb25maWcubWF4X3dpZHRoID0gS01C
X01BWF9XSURUSDsKKwlkcm0tPm1vZGVfY29uZmlnLm1heF9oZWlnaHQgPSBLTUJfTUFYX0hFSUdI
VDsKKwlkcm0tPm1vZGVfY29uZmlnLmZ1bmNzID0gJmttYl9tb2RlX2NvbmZpZ19mdW5jczsKKwor
CXJldCA9IGttYl9zZXR1cF9jcnRjKGRybSk7CisJaWYgKHJldCA8IDApIHsKKwkJZHJtX2Vycihk
cm0sICJmYWlsZWQgdG8gY3JlYXRlIGNydGNcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCS8q
IEluaXRpYWxpemUgTUlQSSBEU0kgKi8KKwlyZXQgPSBrbWJfZHNpX2luaXQoZHJtLCBhZHZfYnJp
ZGdlKTsKKwlpZiAocmV0KSB7CisJCWRybV9lcnIoZHJtLCAiZmFpbGVkIHRvIGluaXRpYWxpemUg
RFNJXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwkvKiBTZXQgdGhlIENSVEMncyBwb3J0IHNv
IHRoYXQgdGhlIGVuY29kZXIgY29tcG9uZW50IGNhbiBmaW5kIGl0ICovCisJa21iLT5jcnRjLnBv
cnQgPSBvZl9ncmFwaF9nZXRfcG9ydF9ieV9pZChkcm0tPmRldi0+b2Zfbm9kZSwgMCk7CisJcmV0
ID0gZHJtX3ZibGFua19pbml0KGRybSwgZHJtLT5tb2RlX2NvbmZpZy5udW1fY3J0Yyk7CisJaWYg
KHJldCA8IDApIHsKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gaW5pdGlhbGl6ZSB2Ymxhbmtc
biIpOworCQlwbV9ydW50aW1lX2Rpc2FibGUoZHJtLT5kZXYpOworCQlyZXR1cm4gcmV0OworCX0K
KworCWRybV9tb2RlX2NvbmZpZ19yZXNldChkcm0pOworCXJldHVybiAwOworfQorCitzdGF0aWMg
aXJxcmV0dXJuX3QgaGFuZGxlX2xjZF9pcnEoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwl1
bnNpZ25lZCBsb25nIHN0YXR1cywgdmFsLCB2YWwxOworCWludCBwbGFuZV9pZCwgZG1hMF9zdGF0
ZSwgZG1hMV9zdGF0ZTsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZGV2
KTsKKworCXN0YXR1cyA9IGttYl9yZWFkX2xjZChrbWIsIExDRF9JTlRfU1RBVFVTKTsKKworCWlm
IChzdGF0dXMgJiBMQ0RfSU5UX0VPRikgeworCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0lOVF9D
TEVBUiwgTENEX0lOVF9FT0YpOworCisJCS8qIFdoZW4gZGlzYWJsaW5nL2VuYWJsaW5nIExDRCBs
YXllcnMsIHRoZSBjaGFuZ2UgdGFrZXMgZWZmZWN0CisJCSAqIGltbWVkaWF0ZWx5IGFuZCBkb2Vz
IG5vdCB3YWl0IGZvciBFT0YgKGVuZCBvZiBmcmFtZSkuCisJCSAqIFdoZW4ga21iX3BsYW5lX2F0
b21pY19kaXNhYmxlIGlzIGNhbGxlZCwgbWFyayB0aGUgcGxhbmUgYXMKKwkJICogZGlzYWJsZWQg
YnV0IGFjdHVhbGx5IGRpc2FibGUgdGhlIHBsYW5lIHdoZW4gRU9GIGlycSBpcworCQkgKiBiZWlu
ZyBoYW5kbGVkLgorCQkgKi8KKwkJZm9yIChwbGFuZV9pZCA9IExBWUVSXzA7CisJCQkJcGxhbmVf
aWQgPCBLTUJfTUFYX1BMQU5FUzsgcGxhbmVfaWQrKykgeworCQkJaWYgKGttYi0+cGxhbmVfc3Rh
dHVzW3BsYW5lX2lkXS5kaXNhYmxlKSB7CisJCQkJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsCisJ
CQkJCQkgICAgTENEX0xBWUVSbl9ETUFfQ0ZHCisJCQkJCQkgICAgKHBsYW5lX2lkKSwKKwkJCQkJ
CSAgICBMQ0RfRE1BX0xBWUVSX0VOQUJMRSk7CisKKwkJCQlrbWJfY2xyX2JpdG1hc2tfbGNkKGtt
YiwgTENEX0NPTlRST0wsCisJCQkJCQkgICAga21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRdLmN0
cmwpOworCisJCQkJa21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRdLmRpc2FibGUgPSBmYWxzZTsK
KwkJCX0KKwkJfQorCQlpZiAoa21iX3VuZGVyX2Zsb3cpIHsKKwkJCS8qIERNQSBSZWNvdmVyeSBh
ZnRlciB1bmRlcmZsb3cgKi8KKwkJCWRtYTBfc3RhdGUgPSAobGF5ZXJfbm8gPT0gMCkgPworCQkJ
ICAgIExDRF9WSURFTzBfRE1BMF9TVEFURSA6IExDRF9WSURFTzFfRE1BMF9TVEFURTsKKwkJCWRt
YTFfc3RhdGUgPSAobGF5ZXJfbm8gPT0gMCkgPworCQkJICAgIExDRF9WSURFTzBfRE1BMV9TVEFU
RSA6IExDRF9WSURFTzFfRE1BMV9TVEFURTsKKworCQkJZG8geworCQkJCWttYl93cml0ZV9sY2Qo
a21iLCBMQ0RfRklGT19GTFVTSCwgMSk7CisJCQkJdmFsID0ga21iX3JlYWRfbGNkKGttYiwgZG1h
MF9zdGF0ZSkKKwkJCQkgICAgJiBMQ0RfRE1BX1NUQVRFX0FDVElWRTsKKwkJCQl2YWwxID0ga21i
X3JlYWRfbGNkKGttYiwgZG1hMV9zdGF0ZSkKKwkJCQkgICAgJiBMQ0RfRE1BX1NUQVRFX0FDVElW
RTsKKwkJCX0gd2hpbGUgKCh2YWwgfHwgdmFsMSkpOworCQkJLyogZGlzYWJsZSBkbWEgKi8KKwkJ
CWttYl9jbHJfYml0bWFza19sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9DRkcobGF5ZXJfbm8pLAor
CQkJCQkgICAgTENEX0RNQV9MQVlFUl9FTkFCTEUpOworCQkJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9GSUZPX0ZMVVNILCAxKTsKKwkJCWttYl9mbHVzaF9kb25lID0gMTsKKwkJCWttYl91bmRlcl9m
bG93ID0gMDsKKwkJfQorCX0KKworCWlmIChzdGF0dXMgJiBMQ0RfSU5UX0xJTkVfQ01QKSB7CisJ
CS8qIGNsZWFyIGxpbmUgY29tcGFyZSBpbnRlcnJ1cHQgKi8KKwkJa21iX3dyaXRlX2xjZChrbWIs
IExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfTElORV9DTVApOworCX0KKworCWlmIChzdGF0dXMgJiBM
Q0RfSU5UX1ZFUlRfQ09NUCkgeworCQkvKiBSZWFkIFZTVEFUVVMgKi8KKwkJdmFsID0ga21iX3Jl
YWRfbGNkKGttYiwgTENEX1ZTVEFUVVMpOworCQl2YWwgPSAodmFsICYgTENEX1ZTVEFUVVNfVkVS
VElDQUxfU1RBVFVTX01BU0spOworCQlzd2l0Y2ggKHZhbCkgeworCQljYXNlIExDRF9WU1RBVFVT
X0NPTVBBUkVfVlNZTkM6CisJCQkvKiBDbGVhciB2ZXJ0aWNhbCBjb21wYXJlIGludGVycnVwdCAq
LworCQkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfVkVSVF9DT01Q
KTsKKwkJCWlmIChrbWJfZmx1c2hfZG9uZSkgeworCQkJCWttYl9zZXRfYml0bWFza19sY2Qoa21i
LAorCQkJCQkJICAgIExDRF9MQVlFUm5fRE1BX0NGRworCQkJCQkJICAgIChsYXllcl9ubyksCisJ
CQkJCQkgICAgTENEX0RNQV9MQVlFUl9FTkFCTEUpOworCQkJCWttYl9mbHVzaF9kb25lID0gMDsK
KwkJCX0KKwkJCWRybV9jcnRjX2hhbmRsZV92YmxhbmsoJmttYi0+Y3J0Yyk7CisJCQlicmVhazsK
KwkJY2FzZSBMQ0RfVlNUQVRVU19DT01QQVJFX0JBQ0tQT1JDSDoKKwkJY2FzZSBMQ0RfVlNUQVRV
U19DT01QQVJFX0FDVElWRToKKwkJY2FzZSBMQ0RfVlNUQVRVU19DT01QQVJFX0ZST05UX1BPUkNI
OgorCQkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9JTlRfQ0xFQVIsIExDRF9JTlRfVkVSVF9DT01Q
KTsKKwkJCWJyZWFrOworCQl9CisJfQorCWlmIChzdGF0dXMgJiBMQ0RfSU5UX0RNQV9FUlIpIHsK
KwkJdmFsID0KKwkJICAgIChzdGF0dXMgJiBMQ0RfSU5UX0RNQV9FUlIgJgorCQkgICAgIGttYl9y
ZWFkX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFKSk7CisJCS8qIExBWUVSMCAtIFZMMCAqLworCQlp
ZiAodmFsICYgKExBWUVSMF9ETUFfRklGT19VTkRFUkZMT1cgfAorCQkJICAgTEFZRVIwX0RNQV9D
Ql9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjBfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKSkg
eworCQkJa21iX3VuZGVyX2Zsb3crKzsKKwkJCWRybV9pbmZvKCZrbWItPmRybSwKKwkJCQkgIiFM
QVlFUjA6VkwwIERNQSBVTkRFUkZMT1cgdmFsID0gMHglbHgsdW5kZXJfZmxvdz0lZCIsCisJCQkg
ICAgIHZhbCwga21iX3VuZGVyX2Zsb3cpOworCQkJLyogZGlzYWJsZSB1bmRlcmZsb3cgaW50ZXJy
dXB0ICovCisJCQlrbWJfY2xyX2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9FTkFCTEUsCisJCQkJ
CSAgICBMQVlFUjBfRE1BX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVSMF9ETUFfQ0Jf
RklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIwX0RNQV9DUl9GSUZPX1VOREVSRkxPVyk7
CisJCQlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9DTEVBUiwKKwkJCQkJICAgIExB
WUVSMF9ETUFfQ0JfRklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIwX0RNQV9GSUZPX1VO
REVSRkxPVyB8CisJCQkJCSAgICBMQVlFUjBfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKTsKKwkJCS8q
IGRpc2FibGUgYXV0byByZXN0YXJ0IG1vZGUgKi8KKwkJCWttYl9jbHJfYml0bWFza19sY2Qoa21i
LCBMQ0RfTEFZRVJuX0RNQV9DRkcoMCksCisJCQkJCSAgICBMQ0RfRE1BX0xBWUVSX0NPTlRfUElO
R19QT05HX1VQREFURSk7CisJCQlsYXllcl9ubyA9IDA7CisJCX0KKworCQlpZiAodmFsICYgTEFZ
RVIwX0RNQV9GSUZPX09WRVJGTE9XKQorCQkJZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVS
MDpWTDAgRE1BIE9WRVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAmIExBWUVS
MF9ETUFfQ0JfRklGT19PVkVSRkxPVykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlF
UjA6VkwwIERNQSBDQiBPVkVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisJCWlmICh2YWwgJiBM
QVlFUjBfRE1BX0NSX0ZJRk9fT1ZFUkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQki
TEFZRVIwOlZMMCBETUEgQ1IgT1ZFUkZMT1cgdmFsID0gMHglbHgiLCB2YWwpOworCisJCS8qIExB
WUVSMSAtIFZMMSAqLworCQlpZiAodmFsICYgKExBWUVSMV9ETUFfRklGT19VTkRFUkZMT1cgfAor
CQkJICAgTEFZRVIxX0RNQV9DQl9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjFfRE1BX0NS
X0ZJRk9fVU5ERVJGTE9XKSkgeworCQkJa21iX3VuZGVyX2Zsb3crKzsKKwkJCWRybV9pbmZvKCZr
bWItPmRybSwKKwkJCQkgIiFMQVlFUjE6VkwxIERNQSBVTkRFUkZMT1cgdmFsID0gMHglbHgsIHVu
ZGVyX2Zsb3c9JWQiLAorCQkJICAgICB2YWwsIGttYl91bmRlcl9mbG93KTsKKwkJCS8qIGRpc2Fi
bGUgdW5kZXJmbG93IGludGVycnVwdCAqLworCQkJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsIExD
RF9JTlRfRU5BQkxFLAorCQkJCQkgICAgTEFZRVIxX0RNQV9GSUZPX1VOREVSRkxPVyB8CisJCQkJ
CSAgICBMQVlFUjFfRE1BX0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVSMV9ETUFf
Q1JfRklGT19VTkRFUkZMT1cpOworCQkJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRf
Q0xFQVIsCisJCQkJCSAgICBMQVlFUjFfRE1BX0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAg
IExBWUVSMV9ETUFfRklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIxX0RNQV9DUl9GSUZP
X1VOREVSRkxPVyk7CisJCQkvKiBkaXNhYmxlIGF1dG8gcmVzdGFydCBtb2RlICovCisJCQlrbWJf
Y2xyX2JpdG1hc2tfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfQ0ZHKDEpLAorCQkJCQkgICAgTENE
X0RNQV9MQVlFUl9DT05UX1BJTkdfUE9OR19VUERBVEUpOworCQkJbGF5ZXJfbm8gPSAxOworCQl9
CisKKwkJLyogTEFZRVIxIC0gVkwxICovCisJCWlmICh2YWwgJiBMQVlFUjFfRE1BX0ZJRk9fT1ZF
UkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIxOlZMMSBETUEgT1ZFUkZM
T1cgdmFsID0gMHglbHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIxX0RNQV9DQl9GSUZPX09W
RVJGTE9XKQorCQkJZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMTpWTDEgRE1BIENCIE9W
RVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAmIExBWUVSMV9ETUFfQ1JfRklG
T19PVkVSRkxPVykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjE6VkwxIERNQSBD
UiBPVkVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisKKwkJLyogTEFZRVIyIC0gR0wwICovCisJ
CWlmICh2YWwgJiBMQVlFUjJfRE1BX0ZJRk9fVU5ERVJGTE9XKQorCQkJZHJtX2RiZygma21iLT5k
cm0sCisJCQkJIkxBWUVSMjpHTDAgRE1BIFVOREVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisJ
CWlmICh2YWwgJiBMQVlFUjJfRE1BX0ZJRk9fT1ZFUkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRy
bSwKKwkJCQkiTEFZRVIyOkdMMCBETUEgT1ZFUkZMT1cgdmFsID0gMHglbHgiLCB2YWwpOworCisJ
CS8qIExBWUVSMyAtIEdMMSAqLworCQlpZiAodmFsICYgTEFZRVIzX0RNQV9GSUZPX1VOREVSRkxP
VykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjM6R0wxIERNQSBVTkRFUkZMT1cg
dmFsID0gMHglbHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIzX0RNQV9GSUZPX1VOREVSRkxP
VykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjM6R0wxIERNQSBPVkVSRkxPVyB2
YWwgPSAweCVseCIsIHZhbCk7CisJfQorCisJaWYgKHN0YXR1cyAmIExDRF9JTlRfTEFZRVIpIHsK
KwkJLyogQ2xlYXIgbGF5ZXIgaW50ZXJydXB0cyAqLworCQlrbWJfd3JpdGVfbGNkKGttYiwgTENE
X0lOVF9DTEVBUiwgTENEX0lOVF9MQVlFUik7CisJfQorCisJLyogQ2xlYXIgYWxsIGludGVycnVw
dHMgKi8KKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9DTEVBUiwgMSk7CisJcmV0
dXJuIElSUV9IQU5ETEVEOworfQorCisvKiBJUlEgaGFuZGxlciAqLworc3RhdGljIGlycXJldHVy
bl90IGttYl9pc3IoaW50IGlycSwgdm9pZCAqYXJnKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSAoc3RydWN0IGRybV9kZXZpY2UgKilhcmc7CisKKwloYW5kbGVfbGNkX2lycShkZXYpOwor
CXJldHVybiBJUlFfSEFORExFRDsKK30KKworc3RhdGljIHZvaWQga21iX2lycV9yZXNldChzdHJ1
Y3QgZHJtX2RldmljZSAqZHJtKQoreworCWttYl93cml0ZV9sY2QodG9fa21iKGRybSksIExDRF9J
TlRfQ0xFQVIsIDB4RkZGRik7CisJa21iX3dyaXRlX2xjZCh0b19rbWIoZHJtKSwgTENEX0lOVF9F
TkFCTEUsIDApOworfQorCitERUZJTkVfRFJNX0dFTV9DTUFfRk9QUyhmb3BzKTsKKworc3RhdGlj
IHN0cnVjdCBkcm1fZHJpdmVyIGttYl9kcml2ZXIgPSB7CisJLmRyaXZlcl9mZWF0dXJlcyA9IERS
SVZFUl9HRU0gfAorCSAgICBEUklWRVJfTU9ERVNFVCB8IERSSVZFUl9BVE9NSUMsCisJLmlycV9o
YW5kbGVyID0ga21iX2lzciwKKwkuaXJxX3ByZWluc3RhbGwgPSBrbWJfaXJxX3Jlc2V0LAorCS5p
cnFfdW5pbnN0YWxsID0ga21iX2lycV9yZXNldCwKKwkvKiBHRU0gT3BlcmF0aW9ucyAqLworCS5m
b3BzID0gJmZvcHMsCisJRFJNX0dFTV9DTUFfRFJJVkVSX09QU19WTUFQLAorCS5uYW1lID0gImtt
Yi1kcm0iLAorCS5kZXNjID0gIktFRU1CQVkgRElTUExBWSBEUklWRVIgIiwKKwkuZGF0ZSA9ICIy
MDIwMTAwOCIsCisJLm1ham9yID0gMSwKKwkubWlub3IgPSAwLAorfTsKKworc3RhdGljIGludCBr
bWJfcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IGRldmlj
ZSAqZGV2ID0gJnBkZXYtPmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gZGV2X2dldF9k
cnZkYXRhKGRldik7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRybSk7
CisKKwlkcm1fZGV2X3VucmVnaXN0ZXIoZHJtKTsKKwlkcm1fa21zX2hlbHBlcl9wb2xsX2Zpbmko
ZHJtKTsKKwlvZl9ub2RlX3B1dChrbWItPmNydGMucG9ydCk7CisJa21iLT5jcnRjLnBvcnQgPSBO
VUxMOworCXBtX3J1bnRpbWVfZ2V0X3N5bmMoZHJtLT5kZXYpOworCWRybV9pcnFfdW5pbnN0YWxs
KGRybSk7CisJcG1fcnVudGltZV9wdXRfc3luYyhkcm0tPmRldik7CisJcG1fcnVudGltZV9kaXNh
YmxlKGRybS0+ZGV2KTsKKworCW9mX3Jlc2VydmVkX21lbV9kZXZpY2VfcmVsZWFzZShkcm0tPmRl
dik7CisKKwkvKiBSZWxlYXNlIGNsa3MgKi8KKwlrbWJfZGlzcGxheV9jbGtfZGlzYWJsZSgpOwor
CWNsa19wdXQoa21iX2Nsay5jbGtfbGNkKTsKKwljbGtfcHV0KGttYl9jbGsuY2xrX21pcGkpOwor
CisJZGV2X3NldF9kcnZkYXRhKGRldiwgTlVMTCk7CisKKwkvKiBVbnJlZ2lzdGVyIERTSSBob3N0
ICovCisJa21iX2RzaV9ob3N0X3VucmVnaXN0ZXIoKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9zaHV0
ZG93bihkcm0pOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGttYl9wcm9iZShzdHJ1Y3Qg
cGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9IGdldF9kZXZp
Y2UoJnBkZXYtPmRldik7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iOworCWludCByZXQg
PSAwOworCisJLyogVGhlIGJyaWRnZSAoQURWIDc1MzUpIHdpbGwgcmV0dXJuIC1FUFJPQkVfREVG
RVIgdW50aWwgaXQKKwkgKiBoYXMgYSBtaXBpX2RzaV9ob3N0IHRvIHJlZ2lzdGVyIGl0cyBkZXZp
Y2UgdG8uIFNvLCB3ZQorCSAqIGZpcnN0IHJlZ2lzdGVyIHRoZSBEU0kgaG9zdCBkdXJpbmcgcHJv
YmUgdGltZSwgYW5kIHRoZW4gcmV0dXJuCisJICogLUVQUk9CRV9ERUZFUiB1bnRpbCB0aGUgYnJp
ZGdlIGlzIGxvYWRlZC4gUHJvYmUgd2lsbCBiZSBjYWxsZWQgYWdhaW4KKwkgKiAgYW5kIHRoZW4g
dGhlIHJlc3Qgb2YgdGhlIGRyaXZlciBpbml0aWFsaXphdGlvbiBjYW4gcHJvY2VlZAorCSAqICBh
ZnRlcndhcmRzIGFuZCB0aGUgYnJpZGdlIGNhbiBiZSBzdWNjZXNzZnVsbHkgYXR0YWNoZWQuCisJ
ICovCisJYWR2X2JyaWRnZSA9IGttYl9kc2lfaG9zdF9icmlkZ2VfaW5pdChkZXYpOworCisJaWYg
KGFkdl9icmlkZ2UgPT0gRVJSX1BUUigtRVBST0JFX0RFRkVSKSkgeworCQlyZXR1cm4gLUVQUk9C
RV9ERUZFUjsKKwl9IGVsc2UgaWYgKElTX0VSUihhZHZfYnJpZGdlKSkgeworCQlEUk1fRVJST1Io
InByb2JlIGZhaWxlZCB0byBpbml0aWFsaXplIERTSSBob3N0IGJyaWRnZVxuIik7CisJCXJldHVy
biBQVFJfRVJSKGFkdl9icmlkZ2UpOworCX0KKworCS8qIENyZWF0ZSBEUk0gZGV2aWNlICovCisJ
a21iID0gZGV2bV9kcm1fZGV2X2FsbG9jKGRldiwgJmttYl9kcml2ZXIsCisJCQkJIHN0cnVjdCBr
bWJfZHJtX3ByaXZhdGUsIGRybSk7CisJaWYgKElTX0VSUihrbWIpKQorCQlyZXR1cm4gUFRSX0VS
UihrbWIpOworCisJZGV2X3NldF9kcnZkYXRhKGRldiwgJmttYi0+ZHJtKTsKKworCXJldCA9IGtt
Yl9od19pbml0KCZrbWItPmRybSwgMCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZnJlZTE7CisK
KwlyZXQgPSBrbWJfc2V0dXBfbW9kZV9jb25maWcoJmttYi0+ZHJtKTsKKwlpZiAocmV0KQorCQln
b3RvIGVycl9mcmVlOworCisJcmV0ID0gZHJtX2lycV9pbnN0YWxsKCZrbWItPmRybSwga21iLT5p
cnFfbGNkKTsKKwlpZiAocmV0IDwgMCkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0
byBpbnN0YWxsIElSUSBoYW5kbGVyXG4iKTsKKwkJZ290byBlcnJfaXJxOworCX0KKworCWRybV9r
bXNfaGVscGVyX3BvbGxfaW5pdCgma21iLT5kcm0pOworCisJLyogUmVnaXN0ZXIgZ3JhcGhpY3Mg
ZGV2aWNlIHdpdGggdGhlIGtlcm5lbCAqLworCXJldCA9IGRybV9kZXZfcmVnaXN0ZXIoJmttYi0+
ZHJtLCAwKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9yZWdpc3RlcjsKKworCXJldHVybiAwOwor
CisgZXJyX3JlZ2lzdGVyOgorCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaSgma21iLT5kcm0pOwor
IGVycl9pcnE6CisJcG1fcnVudGltZV9kaXNhYmxlKGttYi0+ZHJtLmRldik7CisgZXJyX2ZyZWU6
CisJZHJtX2NydGNfY2xlYW51cCgma21iLT5jcnRjKTsKKwlkcm1fbW9kZV9jb25maWdfY2xlYW51
cCgma21iLT5kcm0pOworIGVycl9mcmVlMToKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBOVUxMKTsK
KwlrbWJfZHNpX2hvc3RfdW5yZWdpc3RlcigpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQga21iX29mX21hdGNoW10gPSB7CisJey5jb21wYXRp
YmxlID0gImludGVsLGtlZW1iYXktZGlzcGxheSJ9LAorCXt9LAorfTsKKworTU9EVUxFX0RFVklD
RV9UQUJMRShvZiwga21iX29mX21hdGNoKTsKKworc3RhdGljIGludCBfX21heWJlX3VudXNlZCBr
bWJfcG1fc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRybSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmtt
YiA9IGRybSA/IHRvX2ttYihkcm0pIDogTlVMTDsKKworCWRybV9rbXNfaGVscGVyX3BvbGxfZGlz
YWJsZShkcm0pOworCisJa21iLT5zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX3N1c3BlbmQoZHJt
KTsKKwlpZiAoSVNfRVJSKGttYi0+c3RhdGUpKSB7CisJCWRybV9rbXNfaGVscGVyX3BvbGxfZW5h
YmxlKGRybSk7CisJCXJldHVybiBQVFJfRVJSKGttYi0+c3RhdGUpOworCX0KKworCXJldHVybiAw
OworfQorCitzdGF0aWMgaW50IF9fbWF5YmVfdW51c2VkIGttYl9wbV9yZXN1bWUoc3RydWN0IGRl
dmljZSAqZGV2KQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBkZXZfZ2V0X2RydmRhdGEo
ZGV2KTsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSBkcm0gPyB0b19rbWIoZHJtKSA6
IE5VTEw7CisKKwlpZiAoIWttYikKKwkJcmV0dXJuIDA7CisKKwlkcm1fYXRvbWljX2hlbHBlcl9y
ZXN1bWUoZHJtLCBrbWItPnN0YXRlKTsKKwlkcm1fa21zX2hlbHBlcl9wb2xsX2VuYWJsZShkcm0p
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBTSU1QTEVfREVWX1BNX09QUyhrbWJfcG1fb3Bz
LCBrbWJfcG1fc3VzcGVuZCwga21iX3BtX3Jlc3VtZSk7CisKK3N0YXRpYyBzdHJ1Y3QgcGxhdGZv
cm1fZHJpdmVyIGttYl9wbGF0Zm9ybV9kcml2ZXIgPSB7CisJLnByb2JlID0ga21iX3Byb2JlLAor
CS5yZW1vdmUgPSBrbWJfcmVtb3ZlLAorCS5kcml2ZXIgPSB7CisJCS5uYW1lID0gImttYi1kcm0i
LAorCQkucG0gPSAma21iX3BtX29wcywKKwkJLm9mX21hdGNoX3RhYmxlID0ga21iX29mX21hdGNo
LAorCX0sCit9OworCittb2R1bGVfcGxhdGZvcm1fZHJpdmVyKGttYl9wbGF0Zm9ybV9kcml2ZXIp
OworCitNT0RVTEVfQVVUSE9SKCJJbnRlbCBDb3Jwb3JhdGlvbiIpOworTU9EVUxFX0RFU0NSSVBU
SU9OKCJLZWVtYmF5IERpc3BsYXkgZHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuaCBiL2RyaXZlcnMvZ3B1
L2RybS9rbWIva21iX2Rydi5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjM1
MmYyZDIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuaApA
QCAtMCwwICsxLDE3MCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25s
eQorICoKKyAqIENvcHlyaWdodCDCqSAyMDE4LTIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLwor
CisjaWZuZGVmIF9fS01CX0RSVl9IX18KKyNkZWZpbmUgX19LTUJfRFJWX0hfXworCisjaW5jbHVk
ZSAia21iX3BsYW5lLmgiCisjaW5jbHVkZSAia21iX3JlZ3MuaCIKKworI2RlZmluZSBLTUJfTUFY
X1dJRFRICQkJMTkyMCAvKm1heCB3aWR0aCBpbiBwaXhlbHMgKi8KKyNkZWZpbmUgS01CX01BWF9I
RUlHSFQJCQkxMDgwIC8qbWF4IGhlaWdodCBpbiBwaXhlbHMgKi8KKyNkZWZpbmUgS01CX01JTl9X
SURUSCAgICAgICAgICAgICAgICAgICAxOTIwIC8qbWF4IHdpZHRoIGluIHBpeGVscyAqLworI2Rl
ZmluZSBLTUJfTUlOX0hFSUdIVCAgICAgICAgICAgICAgICAgIDEwODAgLyptYXggaGVpZ2h0IGlu
IHBpeGVscyAqLworI2RlZmluZSBLTUJfTENEX0RFRkFVTFRfQ0xLCQkyMDAwMDAwMDAKKyNkZWZp
bmUgS01CX01JUElfREVGQVVMVF9DTEsJCTI0MDAwMDAwCisjZGVmaW5lIEtNQl9NSVBJX0RFRkFV
TFRfQ0ZHX0NMSwkyNDAwMDAwMAorI2RlZmluZSBLTUJfU1lTX0NMS19NSFoJCQk1MDAKKworI2Rl
ZmluZSBJQ0FNX01NSU8JCTB4M2IxMDAwMDAKKyNkZWZpbmUgSUNBTV9MQ0RfT0ZGU0VUCQkweDEw
ODAKKyNkZWZpbmUgSUNBTV9NTUlPX1NJWkUJCTB4MjAwMAorCitzdHJ1Y3Qga21iX2RybV9wcml2
YXRlIHsKKwlzdHJ1Y3QgZHJtX2RldmljZQkJZHJtOworCXZvaWQgX19pb21lbQkJCSpsY2RfbW1p
bzsKKwl2b2lkIF9faW9tZW0JCQkqbWlwaV9tbWlvOworCXZvaWQgX19pb21lbQkJCSptc3NjYW1f
bW1pbzsKKwlzdHJ1Y3QgY2xrCQkJKmNsazsKKwlzdHJ1Y3QgZHJtX2NydGMJCQljcnRjOworCXN0
cnVjdCBrbWJfcGxhbmUJCSpwbGFuZTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZQkJKnN0YXRl
OworCXNwaW5sb2NrX3QJCQlpcnFfbG9jazsKKwlpbnQJCQkJaXJxX2xjZDsKKwlpbnQJCQkJaXJx
X21pcGk7CisJaW50CQkJCXN5c19jbGtfbWh6OworCWRtYV9hZGRyX3QJCQlmYl9hZGRyOworCXN0
cnVjdCBsYXllcl9zdGF0dXMJCXBsYW5lX3N0YXR1c1tLTUJfTUFYX1BMQU5FU107Cit9OworCitz
dHJ1Y3Qga21iX2Nsb2NrIHsKKwlzdHJ1Y3QgY2xrICpjbGtfbGNkOworCXN0cnVjdCBjbGsgKmNs
a19taXBpOworCXN0cnVjdCBjbGsgKmNsa19taXBpX2VjZmc7CisJc3RydWN0IGNsayAqY2xrX21p
cGlfY2ZnOworCXN0cnVjdCBjbGsgKmNsa19wbGwwOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1
Y3Qga21iX2RybV9wcml2YXRlICp0b19rbWIoY29uc3Qgc3RydWN0IGRybV9kZXZpY2UgKmRldikK
K3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGRldiwgc3RydWN0IGttYl9kcm1fcHJpdmF0ZSwgZHJt
KTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpjcnRjX3RvX2tt
Yl9wcml2KGNvbnN0IHN0cnVjdCBkcm1fY3J0YyAqeCkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29m
KHgsIHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUsIGNydGMpOworfQorCitzdHJ1Y3QgYmx0X2xheWVy
X2NvbmZpZyB7CisJdW5zaWduZWQgY2hhciBsYXllcl9mb3JtYXQ7Cit9OworCitzdGF0aWMgaW5s
aW5lIHZvaWQga21iX3dyaXRlX2xjZChzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJ
CQkgdW5zaWduZWQgaW50IHJlZywgdTMyIHZhbHVlKQoreworCXdyaXRlbCh2YWx1ZSwgKGRldl9w
LT5sY2RfbW1pbyArIHJlZykpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX3dyaXRlX21p
cGkoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICB1bnNpZ25lZCBpbnQgcmVn
LCB1MzIgdmFsdWUpCit7CisJd3JpdGVsKHZhbHVlLCAoZGV2X3AtPm1pcGlfbW1pbyArIHJlZykp
OworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX3dyaXRlX21zc2NhbShzdHJ1Y3Qga21iX2Ry
bV9wcml2YXRlICpkZXZfcCwKKwkJCQkgICAgdW5zaWduZWQgaW50IHJlZywgdTMyIHZhbHVlKQor
eworCXdyaXRlbCh2YWx1ZSwgKGRldl9wLT5tc3NjYW1fbW1pbyArIHJlZykpOworfQorCitzdGF0
aWMgaW5saW5lIHUzMiBrbWJfcmVhZF9tc3NjYW0oc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2
X3AsCisJCQkJICB1bnNpZ25lZCBpbnQgcmVnKQoreworCXJldHVybiByZWFkbChkZXZfcC0+bXNz
Y2FtX21taW8gKyByZWcpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX3NldF9iaXRtYXNr
X21zc2NhbShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkJICB1bnNpZ25lZCBp
bnQgcmVnLCB1MzIgbWFzaykKK3sKKwl1MzIgcmVnX3ZhbCA9IGttYl9yZWFkX21zc2NhbShkZXZf
cCwgcmVnKTsKKworCWttYl93cml0ZV9tc3NjYW0oZGV2X3AsIHJlZywgKHJlZ192YWwgfCBtYXNr
KSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdTMyIGttYl9yZWFkX2xjZChzdHJ1Y3Qga21iX2RybV9w
cml2YXRlICpkZXZfcCwgdW5zaWduZWQgaW50IHJlZykKK3sKKwlyZXR1cm4gcmVhZGwoZGV2X3At
PmxjZF9tbWlvICsgcmVnKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl9zZXRfYml0bWFz
a19sY2Qoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgICAgIHVuc2lnbmVk
IGludCByZWcsIHUzMiBtYXNrKQoreworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbGNkKGRldl9w
LCByZWcpOworCisJa21iX3dyaXRlX2xjZChkZXZfcCwgcmVnLCAocmVnX3ZhbCB8IG1hc2spKTsK
K30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl9jbHJfYml0bWFza19sY2Qoc3RydWN0IGttYl9k
cm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgICAgIHVuc2lnbmVkIGludCByZWcsIHUzMiBtYXNr
KQoreworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbGNkKGRldl9wLCByZWcpOworCisJa21iX3dy
aXRlX2xjZChkZXZfcCwgcmVnLCAocmVnX3ZhbCAmICh+bWFzaykpKTsKK30KKworc3RhdGljIGlu
bGluZSB1MzIga21iX3JlYWRfbWlwaShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwgdW5z
aWduZWQgaW50IHJlZykKK3sKKwlyZXR1cm4gcmVhZGwoZGV2X3AtPm1pcGlfbW1pbyArIHJlZyk7
Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfd3JpdGVfYml0c19taXBpKHN0cnVjdCBrbWJf
ZHJtX3ByaXZhdGUgKmRldl9wLAorCQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcmVnLCB1MzIgb2Zm
c2V0LAorCQkJCSAgICAgICB1MzIgbnVtX2JpdHMsIHUzMiB2YWx1ZSkKK3sKKwl1MzIgcmVnX3Zh
bCA9IGttYl9yZWFkX21pcGkoZGV2X3AsIHJlZyk7CisJdTMyIG1hc2sgPSAoMSA8PCBudW1fYml0
cykgLSAxOworCisJdmFsdWUgJj0gbWFzazsKKwltYXNrIDw8PSBvZmZzZXQ7CisJcmVnX3ZhbCAm
PSAofm1hc2spOworCXJlZ192YWwgfD0gKHZhbHVlIDw8IG9mZnNldCk7CisJa21iX3dyaXRlX21p
cGkoZGV2X3AsIHJlZywgcmVnX3ZhbCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfc2V0
X2JpdF9taXBpKHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmRldl9wLAorCQkJCSAgICB1bnNpZ25l
ZCBpbnQgcmVnLCB1MzIgb2Zmc2V0KQoreworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbWlwaShk
ZXZfcCwgcmVnKTsKKworCWttYl93cml0ZV9taXBpKGRldl9wLCByZWcsIHJlZ192YWwgfCAoMSA8
PCBvZmZzZXQpKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl9jbHJfYml0X21pcGkoc3Ry
dWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgIHVuc2lnbmVkIGludCByZWcsIHUz
MiBvZmZzZXQpCit7CisJdTMyIHJlZ192YWwgPSBrbWJfcmVhZF9taXBpKGRldl9wLCByZWcpOwor
CisJa21iX3dyaXRlX21pcGkoZGV2X3AsIHJlZywgcmVnX3ZhbCAmICh+KDEgPDwgb2Zmc2V0KSkp
OworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX3NldF9iaXRtYXNrX21pcGkoc3RydWN0IGtt
Yl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJCXVuc2lnbmVkIGludCByZWcsIHUzMiBtYXNrKQor
eworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbWlwaShkZXZfcCwgcmVnKTsKKworCWttYl93cml0
ZV9taXBpKGRldl9wLCByZWcsIChyZWdfdmFsIHwgbWFzaykpOworfQorCitzdGF0aWMgaW5saW5l
IHZvaWQga21iX2Nscl9iaXRtYXNrX21pcGkoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3As
CisJCQkJCXVuc2lnbmVkIGludCByZWcsIHUzMiBtYXNrKQoreworCXUzMiByZWdfdmFsID0ga21i
X3JlYWRfbWlwaShkZXZfcCwgcmVnKTsKKworCWttYl93cml0ZV9taXBpKGRldl9wLCByZWcsIChy
ZWdfdmFsICYgKH5tYXNrKSkpOworfQorCitpbnQga21iX3NldHVwX2NydGMoc3RydWN0IGRybV9k
ZXZpY2UgKmRldik7Cit2b2lkIGttYl9zZXRfc2Nhbm91dChzdHJ1Y3Qga21iX2RybV9wcml2YXRl
ICpsY2QpOworI2VuZGlmIC8qIF9fS01CX0RSVl9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9rbWIva21iX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5j
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjM0MGYzYWMKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5jCkBAIC0wLDAgKzEsNDg4IEBA
CisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CisvKgorICogQ29weXJp
Z2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxkcm0v
ZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1
ZGUgPGRybS9kcm1fY3J0Yy5oPgorI2luY2x1ZGUgPGRybS9kcm1fY3J0Y19oZWxwZXIuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX2ZiX2NtYV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9n
ZW1fY21hX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fbWFuYWdlZC5oPgorI2luY2x1ZGUg
PGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CisKKyNpbmNsdWRlICJrbWJfZHJ2LmgiCisjaW5jbHVk
ZSAia21iX3BsYW5lLmgiCisjaW5jbHVkZSAia21iX3JlZ3MuaCIKKworY29uc3QgdTMyIGxheWVy
X2lycXNbXSA9IHsKKwlMQ0RfSU5UX1ZMMCwKKwlMQ0RfSU5UX1ZMMSwKKwlMQ0RfSU5UX0dMMCwK
KwlMQ0RfSU5UX0dMMQorfTsKKworLyogQ29udmVyc2lvbiAoeXV2LT5yZ2IpIG1hdHJpeCBmcm9t
IG15cmlhZHggKi8KK3N0YXRpYyBjb25zdCB1MzIgY3NjX2NvZWZfbGNkW10gPSB7CisJMTAyNCwg
MCwgMTQzNiwKKwkxMDI0LCAtMzUyLCAtNzMxLAorCTEwMjQsIDE4MTQsIDAsCisJLTE3OSwgMTI1
LCAtMjI2Cit9OworCitzdGF0aWMgdW5zaWduZWQgaW50IGNoZWNrX3BpeGVsX2Zvcm1hdChzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwgdTMyIGZvcm1hdCkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9
IDA7IGkgPCBwbGFuZS0+Zm9ybWF0X2NvdW50OyBpKyspIHsKKwkJaWYgKHBsYW5lLT5mb3JtYXRf
dHlwZXNbaV0gPT0gZm9ybWF0KQorCQkJcmV0dXJuIDA7CisJfQorCXJldHVybiAtRUlOVkFMOwor
fQorCitzdGF0aWMgaW50IGttYl9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCisJCQkJICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYjsKKwlpbnQgcmV0OworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZTsKKwlib29sIGNhbl9wb3NpdGlvbjsKKworCWZiID0gc3RhdGUtPmZiOworCWlm
ICghZmIgfHwgIXN0YXRlLT5jcnRjKQorCQlyZXR1cm4gMDsKKworCXJldCA9IGNoZWNrX3BpeGVs
X2Zvcm1hdChwbGFuZSwgZmItPmZvcm1hdC0+Zm9ybWF0KTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OworCisJaWYgKHN0YXRlLT5jcnRjX3cgPiBLTUJfTUFYX1dJRFRIIHx8IHN0YXRlLT5jcnRj
X2ggPiBLTUJfTUFYX0hFSUdIVCkKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKHN0YXRlLT5jcnRj
X3cgPCBLTUJfTUlOX1dJRFRIIHx8IHN0YXRlLT5jcnRjX2ggPCBLTUJfTUlOX0hFSUdIVCkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJY2FuX3Bvc2l0aW9uID0gKHBsYW5lLT50eXBlID09IERSTV9QTEFO
RV9UWVBFX09WRVJMQVkpOworCWNydGNfc3RhdGUgPQorCQlkcm1fYXRvbWljX2dldF9leGlzdGlu
Z19jcnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwgc3RhdGUtPmNydGMpOworCXJldHVybiBkcm1fYXRv
bWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZShzdGF0ZSwgY3J0Y19zdGF0ZSwKKwkJCQkJCSBE
Uk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCisJCQkJCQkgRFJNX1BMQU5FX0hFTFBFUl9OT19T
Q0FMSU5HLAorCQkJCQkJIGNhbl9wb3NpdGlvbiwgdHJ1ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGtt
Yl9wbGFuZV9hdG9taWNfZGlzYWJsZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkgICAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBrbWJfcGxhbmUgKmtt
Yl9wbGFuZSA9IHRvX2ttYl9wbGFuZShwbGFuZSk7CisJaW50IHBsYW5lX2lkID0ga21iX3BsYW5l
LT5pZDsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWI7CisKKwlrbWIgPSB0b19rbWIocGxh
bmUtPmRldik7CisKKwlzd2l0Y2ggKHBsYW5lX2lkKSB7CisJY2FzZSBMQVlFUl8wOgorCQlrbWIt
PnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uY3RybCA9IExDRF9DVFJMX1ZMMV9FTkFCTEU7CisJCWJy
ZWFrOworCWNhc2UgTEFZRVJfMToKKwkJa21iLT5wbGFuZV9zdGF0dXNbcGxhbmVfaWRdLmN0cmwg
PSBMQ0RfQ1RSTF9WTDJfRU5BQkxFOworCQlicmVhazsKKwljYXNlIExBWUVSXzI6CisJCWttYi0+
cGxhbmVfc3RhdHVzW3BsYW5lX2lkXS5jdHJsID0gTENEX0NUUkxfR0wxX0VOQUJMRTsKKwkJYnJl
YWs7CisJY2FzZSBMQVlFUl8zOgorCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uY3RybCA9
IExDRF9DVFJMX0dMMl9FTkFCTEU7CisJCWJyZWFrOworCX0KKworCWttYi0+cGxhbmVfc3RhdHVz
W3BsYW5lX2lkXS5kaXNhYmxlID0gdHJ1ZTsKK30KKwordW5zaWduZWQgaW50IGdldF9waXhlbF9m
b3JtYXQodTMyIGZvcm1hdCkKK3sKKwl1bnNpZ25lZCBpbnQgdmFsID0gMDsKKworCXN3aXRjaCAo
Zm9ybWF0KSB7CisJCS8qIHBsYW5hciBmb3JtYXRzICovCisJY2FzZSBEUk1fRk9STUFUX1lVVjQ0
NDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9ZQ0JDUjQ0NFBMQU4gfCBMQ0RfTEFZRVJfUExB
TkFSX1NUT1JBR0U7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9ZVlU0NDQ6CisJCXZhbCA9
IExDRF9MQVlFUl9GT1JNQVRfWUNCQ1I0NDRQTEFOIHwgTENEX0xBWUVSX1BMQU5BUl9TVE9SQUdF
CisJCSAgICB8IExDRF9MQVlFUl9DUkNCX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JN
QVRfWVVWNDIyOgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1lDQkNSNDIyUExBTiB8IExDRF9M
QVlFUl9QTEFOQVJfU1RPUkFHRTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1lWVTQyMjoK
KwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9ZQ0JDUjQyMlBMQU4gfCBMQ0RfTEFZRVJfUExBTkFS
X1NUT1JBR0UKKwkJICAgIHwgTENEX0xBWUVSX0NSQ0JfT1JERVI7CisJCWJyZWFrOworCWNhc2Ug
RFJNX0ZPUk1BVF9ZVVY0MjA6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfWUNCQ1I0MjBQTEFO
IHwgTENEX0xBWUVSX1BMQU5BUl9TVE9SQUdFOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRf
WVZVNDIwOgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1lDQkNSNDIwUExBTiB8IExDRF9MQVlF
Ul9QTEFOQVJfU1RPUkFHRQorCQkgICAgfCBMQ0RfTEFZRVJfQ1JDQl9PUkRFUjsKKwkJYnJlYWs7
CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfTlYxMiB8
IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX05W
MjE6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfTlYxMiB8IExDRF9MQVlFUl9QTEFOQVJfU1RP
UkFHRQorCQkgICAgfCBMQ0RfTEFZRVJfQ1JDQl9PUkRFUjsKKwkJYnJlYWs7CisJCS8qIHBhY2tl
ZCBmb3JtYXRzICovCisJCS8qIGxvb2tzIGh3IHJlcXVpcmVzIEIgJiBHIHRvIGJlIHN3YXBwZWQg
d2hlbiBSR0IgKi8KKwljYXNlIERSTV9GT1JNQVRfUkdCMzMyOgorCQl2YWwgPSBMQ0RfTEFZRVJf
Rk9STUFUX1JHQjMzMiB8IExDRF9MQVlFUl9CR1JfT1JERVI7CisJCWJyZWFrOworCWNhc2UgRFJN
X0ZPUk1BVF9YQkdSNDQ0NDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0JYNDQ0NDsKKwkJ
YnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX0FSR0I0NDQ0OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9S
TUFUX1JHQkE0NDQ0IHwgTENEX0xBWUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1f
Rk9STUFUX0FCR1I0NDQ0OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQkE0NDQ0OworCQli
cmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE1NTU6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JN
QVRfWFJHQjE1NTUgfCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9G
T1JNQVRfWEJHUjE1NTU6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfWFJHQjE1NTU7CisJCWJy
ZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTU1NToKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1B
VF9SR0JBMTU1NSB8IExDRF9MQVlFUl9CR1JfT1JERVI7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZP
Uk1BVF9BQkdSMTU1NToKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0JBMTU1NTsKKwkJYnJl
YWs7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9S
R0I1NjUgfCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRf
QkdSNTY1OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjU2NTsKKwkJYnJlYWs7CisJY2Fz
ZSBEUk1fRk9STUFUX1JHQjg4ODoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0I4ODggfCBM
Q0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfQkdSODg4Ogor
CQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjg4ODsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9S
TUFUX1hSR0I4ODg4OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQlg4ODg4IHwgTENEX0xB
WUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgorCQl2
YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQlg4ODg4OworCQlicmVhazsKKwljYXNlIERSTV9GT1JN
QVRfQVJHQjg4ODg6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTg4ODggfCBMQ0RfTEFZ
RVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfQUJHUjg4ODg6CisJCXZh
bCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTg4ODg7CisJCWJyZWFrOworCX0KKwlEUk1fSU5GT19P
TkNFKCIlcyA6ICVkIGZvcm1hdD0weCV4IHZhbD0weCV4XG4iLAorCQkgICAgICBfX2Z1bmNfXywg
X19MSU5FX18sIGZvcm1hdCwgdmFsKTsKKwlyZXR1cm4gdmFsOworfQorCit1bnNpZ25lZCBpbnQg
Z2V0X2JpdHNfcGVyX3BpeGVsKGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCkK
K3sKKwl1MzIgYnBwID0gMDsKKwl1bnNpZ25lZCBpbnQgdmFsID0gMDsKKworCWlmIChmb3JtYXQt
Pm51bV9wbGFuZXMgPiAxKSB7CisJCXZhbCA9IExDRF9MQVlFUl84QlBQOworCQlyZXR1cm4gdmFs
OworCX0KKworCWJwcCArPSA4ICogZm9ybWF0LT5jcHBbMF07CisKKwlzd2l0Y2ggKGJwcCkgewor
CWNhc2UgODoKKwkJdmFsID0gTENEX0xBWUVSXzhCUFA7CisJCWJyZWFrOworCWNhc2UgMTY6CisJ
CXZhbCA9IExDRF9MQVlFUl8xNkJQUDsKKwkJYnJlYWs7CisJY2FzZSAyNDoKKwkJdmFsID0gTENE
X0xBWUVSXzI0QlBQOworCQlicmVhazsKKwljYXNlIDMyOgorCQl2YWwgPSBMQ0RfTEFZRVJfMzJC
UFA7CisJCWJyZWFrOworCX0KKworCURSTV9ERUJVRygiYnBwPSVkIHZhbD0weCV4XG4iLCBicHAs
IHZhbCk7CisJcmV0dXJuIHZhbDsKK30KKworc3RhdGljIHZvaWQgY29uZmlnX2NzYyhzdHJ1Y3Qg
a21iX2RybV9wcml2YXRlICprbWIsIGludCBwbGFuZV9pZCkKK3sKKwkvKiBZVVYgdG8gUkdCIGNv
bnZlcnNpb24gdXNpbmcgdGhlIGZpeGVkIG1hdHJpeCBjc2NfY29lZl9sY2QgKi8KKwlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfQ09FRkYxMShwbGFuZV9pZCksIGNzY19jb2VmX2xj
ZFswXSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMTIocGxhbmVf
aWQpLCBjc2NfY29lZl9sY2RbMV0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NT
Q19DT0VGRjEzKHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzJdKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0xBWUVSbl9DU0NfQ09FRkYyMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFszXSk7CisJ
a21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMjIocGxhbmVfaWQpLCBjc2Nf
Y29lZl9sY2RbNF0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjIz
KHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzVdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xB
WUVSbl9DU0NfQ09FRkYzMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFs2XSk7CisJa21iX3dyaXRl
X2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMzIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2Rb
N10pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjMzKHBsYW5lX2lk
KSwgY3NjX2NvZWZfbGNkWzhdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0Nf
T0ZGMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFs5XSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9MQVlFUm5fQ1NDX09GRjIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2RbMTBdKTsKKwlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfT0ZGMyhwbGFuZV9pZCksIGNzY19jb2VmX2xjZFsx
MV0pOworfQorCitzdGF0aWMgdm9pZCBrbWJfcGxhbmVfYXRvbWljX3VwZGF0ZShzdHJ1Y3QgZHJt
X3BsYW5lICpwbGFuZSwKKwkJCQkgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7
CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAq
a21iOworCXVuc2lnbmVkIGludCB3aWR0aDsKKwl1bnNpZ25lZCBpbnQgaGVpZ2h0OworCXVuc2ln
bmVkIGludCBkbWFfbGVuOworCXN0cnVjdCBrbWJfcGxhbmUgKmttYl9wbGFuZTsKKwl1bnNpZ25l
ZCBpbnQgZG1hX2NmZzsKKwl1bnNpZ25lZCBpbnQgY3RybCA9IDAsIHZhbCA9IDAsIG91dF9mb3Jt
YXQgPSAwOworCXVuc2lnbmVkIGludCBzcmNfdywgc3JjX2gsIGNydGNfeCwgY3J0Y195OworCXVu
c2lnbmVkIGNoYXIgcGxhbmVfaWQ7CisJaW50IG51bV9wbGFuZXM7CisJc3RhdGljIGRtYV9hZGRy
X3QgYWRkcltNQVhfU1VCX1BMQU5FU107CisKKwlpZiAoIXBsYW5lIHx8ICFwbGFuZS0+c3RhdGUg
fHwgIXN0YXRlKQorCQlyZXR1cm47CisKKwlmYiA9IHBsYW5lLT5zdGF0ZS0+ZmI7CisJaWYgKCFm
YikKKwkJcmV0dXJuOworCW51bV9wbGFuZXMgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOworCWtt
Yl9wbGFuZSA9IHRvX2ttYl9wbGFuZShwbGFuZSk7CisJcGxhbmVfaWQgPSBrbWJfcGxhbmUtPmlk
OworCisJa21iID0gdG9fa21iKHBsYW5lLT5kZXYpOworCisJaWYgKGttYl91bmRlcl9mbG93IHx8
IGttYl9mbHVzaF9kb25lKSB7CisJCWRybV9kYmcoJmttYi0+ZHJtLCAicGxhbmVfdXBkYXRlOnVu
ZGVyZmxvdyEhISEgcmV0dXJuaW5nIik7CisJCXJldHVybjsKKwl9CisKKwlzcmNfdyA9IChwbGFu
ZS0+c3RhdGUtPnNyY193ID4+IDE2KTsKKwlzcmNfaCA9IHBsYW5lLT5zdGF0ZS0+c3JjX2ggPj4g
MTY7CisJY3J0Y194ID0gcGxhbmUtPnN0YXRlLT5jcnRjX3g7CisJY3J0Y195ID0gcGxhbmUtPnN0
YXRlLT5jcnRjX3k7CisKKwlkcm1fZGJnKCZrbWItPmRybSwKKwkJInNyY193PSVkIHNyY19oPSVk
LCBmYi0+Zm9ybWF0LT5mb3JtYXQ9MHgleCBmYi0+ZmxhZ3M9MHgleFxuIiwKKwkJICBzcmNfdywg
c3JjX2gsIGZiLT5mb3JtYXQtPmZvcm1hdCwgZmItPmZsYWdzKTsKKworCXdpZHRoID0gZmItPndp
ZHRoOworCWhlaWdodCA9IGZiLT5oZWlnaHQ7CisJZG1hX2xlbiA9ICh3aWR0aCAqIGhlaWdodCAq
IGZiLT5mb3JtYXQtPmNwcFswXSk7CisJZHJtX2RiZygma21iLT5kcm0sICJkbWFfbGVuPSVkICIs
IGRtYV9sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9MRU4ocGxhbmVf
aWQpLCBkbWFfbGVuKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfTEVOX1NI
QURPVyhwbGFuZV9pZCksIGRtYV9sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJu
X0RNQV9MSU5FX1ZTVFJJREUocGxhbmVfaWQpLAorCQkgICAgICBmYi0+cGl0Y2hlc1swXSk7CisJ
a21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0xJTkVfV0lEVEgocGxhbmVfaWQpLAor
CQkgICAgICAod2lkdGggKiBmYi0+Zm9ybWF0LT5jcHBbMF0pKTsKKworCWFkZHJbWV9QTEFORV0g
PSBkcm1fZmJfY21hX2dldF9nZW1fYWRkcihmYiwgcGxhbmUtPnN0YXRlLCAwKTsKKwlrbWItPmZi
X2FkZHIgPSBhZGRyW1lfUExBTkVdOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RN
QV9TVEFSVF9BRERSKHBsYW5lX2lkKSwKKwkJICAgICAgYWRkcltZX1BMQU5FXSArIGZiLT5vZmZz
ZXRzWzBdKTsKKwl2YWwgPSBnZXRfcGl4ZWxfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7CisJ
dmFsIHw9IGdldF9iaXRzX3Blcl9waXhlbChmYi0+Zm9ybWF0KTsKKwkvKiBQcm9ncmFtIENiL0Ny
IGZvciBwbGFuYXIgZm9ybWF0cyAqLworCWlmIChudW1fcGxhbmVzID4gMSkgeworCQlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfQ0JfTElORV9WU1RSSURFKHBsYW5lX2lkKSwKKwkJ
CSAgICAgIHdpZHRoICogZmItPmZvcm1hdC0+Y3BwWzBdKTsKKwkJa21iX3dyaXRlX2xjZChrbWIs
IExDRF9MQVlFUm5fRE1BX0NCX0xJTkVfV0lEVEgocGxhbmVfaWQpLAorCQkJICAgICAgKHdpZHRo
ICogZmItPmZvcm1hdC0+Y3BwWzBdKSk7CisKKwkJYWRkcltVX1BMQU5FXSA9IGRybV9mYl9jbWFf
Z2V0X2dlbV9hZGRyKGZiLCBwbGFuZS0+c3RhdGUsCisJCQkJCQkJVV9QTEFORSk7CisJCS8qIGNo
ZWNrIGlmIENiL0NyIGlzIHN3YXBwZWQqLworCQlpZiAobnVtX3BsYW5lcyA9PSAzICYmICh2YWwg
JiBMQ0RfTEFZRVJfQ1JDQl9PUkRFUikpCisJCQlrbWJfd3JpdGVfbGNkKGttYiwKKwkJCQkgICAg
ICBMQ0RfTEFZRVJuX0RNQV9TVEFSVF9DUl9BRFIocGxhbmVfaWQpLAorCQkJCQlhZGRyW1VfUExB
TkVdKTsKKwkJZWxzZQorCQkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkJICAgICAgTENEX0xBWUVS
bl9ETUFfU1RBUlRfQ0JfQURSKHBsYW5lX2lkKSwKKwkJCQkJYWRkcltVX1BMQU5FXSk7CisKKwkJ
aWYgKG51bV9wbGFuZXMgPT0gMykgeworCQkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkJICAgICAg
TENEX0xBWUVSbl9ETUFfQ1JfTElORV9WU1RSSURFKHBsYW5lX2lkKSwKKwkJCQkgICAgICAoKHdp
ZHRoKSAqIGZiLT5mb3JtYXQtPmNwcFswXSkpOworCisJCQlrbWJfd3JpdGVfbGNkKGttYiwKKwkJ
CQkgICAgICBMQ0RfTEFZRVJuX0RNQV9DUl9MSU5FX1dJRFRIKHBsYW5lX2lkKSwKKwkJCQkgICAg
ICAoKHdpZHRoKSAqIGZiLT5mb3JtYXQtPmNwcFswXSkpOworCisJCQlhZGRyW1ZfUExBTkVdID0g
ZHJtX2ZiX2NtYV9nZXRfZ2VtX2FkZHIoZmIsCisJCQkJCQkJCXBsYW5lLT5zdGF0ZSwKKwkJCQkJ
CQkJVl9QTEFORSk7CisKKwkJCS8qIGNoZWNrIGlmIENiL0NyIGlzIHN3YXBwZWQqLworCQkJaWYg
KHZhbCAmIExDRF9MQVlFUl9DUkNCX09SREVSKQorCQkJCWttYl93cml0ZV9sY2Qoa21iLAorCQkJ
CQkgICAgICBMQ0RfTEFZRVJuX0RNQV9TVEFSVF9DQl9BRFIocGxhbmVfaWQpLAorCQkJCQkgICAg
ICBhZGRyW1ZfUExBTkVdKTsKKwkJCWVsc2UKKwkJCQlrbWJfd3JpdGVfbGNkKGttYiwKKwkJCQkJ
ICAgICAgTENEX0xBWUVSbl9ETUFfU1RBUlRfQ1JfQURSKHBsYW5lX2lkKSwKKwkJCQkJICAgICAg
YWRkcltWX1BMQU5FXSk7CisJCX0KKwl9CisKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVS
bl9XSURUSChwbGFuZV9pZCksIHNyY193IC0gMSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9M
QVlFUm5fSEVJR0hUKHBsYW5lX2lkKSwgc3JjX2ggLSAxKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwg
TENEX0xBWUVSbl9DT0xfU1RBUlQocGxhbmVfaWQpLCBjcnRjX3gpOworCWttYl93cml0ZV9sY2Qo
a21iLCBMQ0RfTEFZRVJuX1JPV19TVEFSVChwbGFuZV9pZCksIGNydGNfeSk7CisKKwl2YWwgfD0g
TENEX0xBWUVSX0ZJRk9fMTAwOworCisJaWYgKHZhbCAmIExDRF9MQVlFUl9QTEFOQVJfU1RPUkFH
RSkgeworCQl2YWwgfD0gTENEX0xBWUVSX0NTQ19FTjsKKworCQkvKiBFbmFibGUgQ1NDIGlmIGlu
cHV0IGlzIHBsYW5hciBhbmQgb3V0cHV0IGlzIFJHQiAqLworCQljb25maWdfY3NjKGttYiwgcGxh
bmVfaWQpOworCX0KKworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NGRyhwbGFuZV9p
ZCksIHZhbCk7CisKKwlzd2l0Y2ggKHBsYW5lX2lkKSB7CisJY2FzZSBMQVlFUl8wOgorCQljdHJs
ID0gTENEX0NUUkxfVkwxX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8xOgorCQljdHJs
ID0gTENEX0NUUkxfVkwyX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8yOgorCQljdHJs
ID0gTENEX0NUUkxfR0wxX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8zOgorCQljdHJs
ID0gTENEX0NUUkxfR0wyX0VOQUJMRTsKKwkJYnJlYWs7CisJfQorCisJY3RybCB8PSBMQ0RfQ1RS
TF9QUk9HUkVTU0lWRSB8IExDRF9DVFJMX1RJTV9HRU5fRU5BQkxFCisJICAgIHwgTENEX0NUUkxf
Q09OVElOVU9VUyB8IExDRF9DVFJMX09VVFBVVF9FTkFCTEVEOworCisJLyogTENEIGlzIGNvbm5l
Y3RlZCB0byBNSVBJIG9uIGttYgorCSAqIFRoZXJlZm9yZSB0aGlzIGJpdCBpcyByZXF1aXJlZCBm
b3IgRFNJIFR4CisJICovCisJY3RybCB8PSBMQ0RfQ1RSTF9WSFNZTkNfSURMRV9MVkw7CisKKwlr
bWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0NPTlRST0wsIGN0cmwpOworCisJLyogRklYTUUg
bm8gZG9jIG9uIGhvdyB0byBzZXQgb3V0cHV0IGZvcm1hdCx0aGVzZSB2YWx1ZXMgYXJlCisJICog
dGFrZW4gZnJvbSB0aGUgTXlyaWFkeCB0ZXN0cworCSAqLworCW91dF9mb3JtYXQgfD0gTENEX09V
VEZfRk9STUFUX1JHQjg4ODsKKworCS8qIExlYXZlIFJHQiBvcmRlcixjb252ZXJzaW9uIG1vZGUg
YW5kIGNsaXAgbW9kZSB0byBkZWZhdWx0ICovCisJLyogZG8gbm90IGludGVybGVhdmUgUkdCIGNo
YW5uZWxzIGZvciBtaXBpIFR4IGNvbXBhdGliaWxpdHkgKi8KKwlvdXRfZm9ybWF0IHw9IExDRF9P
VVRGX01JUElfUkdCX01PREU7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9PVVRfRk9STUFUX0NG
Rywgb3V0X2Zvcm1hdCk7CisKKwlkbWFfY2ZnID0gTENEX0RNQV9MQVlFUl9FTkFCTEUgfCBMQ0Rf
RE1BX0xBWUVSX1ZTVFJJREVfRU4gfAorCSAgICBMQ0RfRE1BX0xBWUVSX0NPTlRfVVBEQVRFIHwg
TENEX0RNQV9MQVlFUl9BWElfQlVSU1RfMTY7CisKKwkvKiBFbmFibGUgRE1BICovCisJa21iX3dy
aXRlX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NGRyhwbGFuZV9pZCksIGRtYV9jZmcpOworCWRy
bV9kYmcoJmttYi0+ZHJtLCAiZG1hX2NmZz0weCV4IExDRF9ETUFfQ0ZHPTB4JXhcbiIsIGRtYV9j
ZmcsCisJCWttYl9yZWFkX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NGRyhwbGFuZV9pZCkpKTsK
KworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5UX0VPRiB8
CisJCQlMQ0RfSU5UX0RNQV9FUlIpOworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5U
X0VOQUJMRSwgTENEX0lOVF9FT0YgfAorCQkJTENEX0lOVF9ETUFfRVJSKTsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzIGttYl9wbGFuZV9oZWxwZXJfZnVu
Y3MgPSB7CisJLmF0b21pY19jaGVjayA9IGttYl9wbGFuZV9hdG9taWNfY2hlY2ssCisJLmF0b21p
Y191cGRhdGUgPSBrbWJfcGxhbmVfYXRvbWljX3VwZGF0ZSwKKwkuYXRvbWljX2Rpc2FibGUgPSBr
bWJfcGxhbmVfYXRvbWljX2Rpc2FibGUKK307CisKK3ZvaWQga21iX3BsYW5lX2Rlc3Ryb3koc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUpCit7CisJc3RydWN0IGttYl9wbGFuZSAqa21iX3BsYW5lID0g
dG9fa21iX3BsYW5lKHBsYW5lKTsKKworCWRybV9wbGFuZV9jbGVhbnVwKHBsYW5lKTsKKwlrZnJl
ZShrbWJfcGxhbmUpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBr
bWJfcGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3Vw
ZGF0ZV9wbGFuZSwKKwkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVf
cGxhbmUsCisJLmRlc3Ryb3kgPSBrbWJfcGxhbmVfZGVzdHJveSwKKwkucmVzZXQgPSBkcm1fYXRv
bWljX2hlbHBlcl9wbGFuZV9yZXNldCwKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGRybV9h
dG9taWNfaGVscGVyX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3Rh
dGUgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kZXN0cm95X3N0YXRlLAorfTsKKworc3RydWN0
IGttYl9wbGFuZSAqa21iX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSkKK3sKKwlz
dHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKwlzdHJ1Y3Qga21iX3Bs
YW5lICpwbGFuZSA9IE5VTEw7CisJc3RydWN0IGttYl9wbGFuZSAqcHJpbWFyeSA9IE5VTEw7CisJ
aW50IGkgPSAwOworCWludCByZXQgPSAwOworCWVudW0gZHJtX3BsYW5lX3R5cGUgcGxhbmVfdHlw
ZTsKKwljb25zdCB1MzIgKnBsYW5lX2Zvcm1hdHM7CisJaW50IG51bV9wbGFuZV9mb3JtYXRzOwor
CisJZm9yIChpID0gMDsgaSA8IEtNQl9NQVhfUExBTkVTOyBpKyspIHsKKwkJcGxhbmUgPSBkcm1t
X2t6YWxsb2MoZHJtLCBzaXplb2YoKnBsYW5lKSwgR0ZQX0tFUk5FTCk7CisKKwkJaWYgKCFwbGFu
ZSkgeworCQkJZHJtX2Vycihkcm0sICJGYWlsZWQgdG8gYWxsb2NhdGUgcGxhbmVcbiIpOworCQkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJCX0KKworCQlwbGFuZV90eXBlID0gKGkgPT0gMCkg
PyBEUk1fUExBTkVfVFlQRV9QUklNQVJZIDoKKwkJICAgIERSTV9QTEFORV9UWVBFX09WRVJMQVk7
CisJCWlmIChpIDwgMikgeworCQkJcGxhbmVfZm9ybWF0cyA9IGttYl9mb3JtYXRzX3Y7CisJCQlu
dW1fcGxhbmVfZm9ybWF0cyA9IEFSUkFZX1NJWkUoa21iX2Zvcm1hdHNfdik7CisJCX0gZWxzZSB7
CisJCQlwbGFuZV9mb3JtYXRzID0ga21iX2Zvcm1hdHNfZzsKKwkJCW51bV9wbGFuZV9mb3JtYXRz
ID0gQVJSQVlfU0laRShrbWJfZm9ybWF0c19nKTsKKwkJfQorCisJCXJldCA9IGRybV91bml2ZXJz
YWxfcGxhbmVfaW5pdChkcm0sICZwbGFuZS0+YmFzZV9wbGFuZSwKKwkJCQkJICAgICAgIFBPU1NJ
QkxFX0NSVENTLCAma21iX3BsYW5lX2Z1bmNzLAorCQkJCQkgICAgICAgcGxhbmVfZm9ybWF0cywg
bnVtX3BsYW5lX2Zvcm1hdHMsCisJCQkJCSAgICAgICBOVUxMLCBwbGFuZV90eXBlLCAicGxhbmUg
JWQiLCBpKTsKKwkJaWYgKHJldCA8IDApIHsKKwkJCWRybV9lcnIoZHJtLCAiZHJtX3VuaXZlcnNh
bF9wbGFuZV9pbml0IGZhaWxlZCAocmV0PSVkKSIsCisJCQkJcmV0KTsKKwkJCWdvdG8gY2xlYW51
cDsKKwkJfQorCQlkcm1fZGJnKGRybSwgIiVzIDogJWQgaT0lZCB0eXBlPSVkIiwKKwkJCV9fZnVu
Y19fLCBfX0xJTkVfXywKKwkJCSAgaSwgcGxhbmVfdHlwZSk7CisJCWRybV9wbGFuZV9oZWxwZXJf
YWRkKCZwbGFuZS0+YmFzZV9wbGFuZSwKKwkJCQkgICAgICZrbWJfcGxhbmVfaGVscGVyX2Z1bmNz
KTsKKwkJaWYgKHBsYW5lX3R5cGUgPT0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWSkgeworCQkJcHJp
bWFyeSA9IHBsYW5lOworCQkJa21iLT5wbGFuZSA9IHBsYW5lOworCQl9CisJCWRybV9kYmcoZHJt
LCAiJXMgOiAlZCBwcmltYXJ5PSVwXG4iLCBfX2Z1bmNfXywgX19MSU5FX18sCisJCQkmcHJpbWFy
eS0+YmFzZV9wbGFuZSk7CisJCXBsYW5lLT5pZCA9IGk7CisJfQorCisJcmV0dXJuIHByaW1hcnk7
CitjbGVhbnVwOgorCWRybW1fa2ZyZWUoZHJtLCBwbGFuZSk7CisJcmV0dXJuIEVSUl9QVFIocmV0
KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmggYi9kcml2
ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAuLjU2NGY2OGYKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0va21iL2tt
Yl9wbGFuZS5oCkBAIC0wLDAgKzEsMTAyIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMC1vbmx5CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpZm5kZWYgX19LTUJfUExBTkVfSF9fCisjZGVmaW5lIF9fS01CX1BMQU5F
X0hfXworCitleHRlcm4gaW50IGttYl91bmRlcl9mbG93OworZXh0ZXJuIGludCBrbWJfZmx1c2hf
ZG9uZTsKKworI2RlZmluZSBMQ0RfSU5UX1ZMMF9FUlIgKChMQVlFUjBfRE1BX0ZJRk9fVU5ERVJG
TE9XKSB8IFwKKwkJCShMQVlFUjBfRE1BX0ZJRk9fT1ZFUkZMT1cpIHwgXAorCQkJKExBWUVSMF9E
TUFfQ0JfRklGT19PVkVSRkxPVykgfCBcCisJCQkoTEFZRVIwX0RNQV9DQl9GSUZPX1VOREVSRkxP
VykgfCBcCisJCQkoTEFZRVIwX0RNQV9DUl9GSUZPX09WRVJGTE9XKSB8IFwKKwkJCShMQVlFUjBf
RE1BX0NSX0ZJRk9fVU5ERVJGTE9XKSkKKworI2RlZmluZSBMQ0RfSU5UX1ZMMV9FUlIgKChMQVlF
UjFfRE1BX0ZJRk9fVU5ERVJGTE9XKSB8IFwKKwkJCShMQVlFUjFfRE1BX0ZJRk9fT1ZFUkZMT1cp
IHwgXAorCQkJKExBWUVSMV9ETUFfQ0JfRklGT19PVkVSRkxPVykgfCBcCisJCQkoTEFZRVIxX0RN
QV9DQl9GSUZPX1VOREVSRkxPVykgfCBcCisJCQkoTEFZRVIxX0RNQV9DUl9GSUZPX09WRVJGTE9X
KSB8IFwKKwkJCShMQVlFUjFfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKSkKKworI2RlZmluZSBMQ0Rf
SU5UX0dMMF9FUlIgKExBWUVSMl9ETUFfRklGT19PVkVSRkxPVyB8IExBWUVSMl9ETUFfRklGT19V
TkRFUkZMT1cpCisjZGVmaW5lIExDRF9JTlRfR0wxX0VSUiAoTEFZRVIzX0RNQV9GSUZPX09WRVJG
TE9XIHwgTEFZRVIzX0RNQV9GSUZPX1VOREVSRkxPVykKKyNkZWZpbmUgTENEX0lOVF9WTDAgKExB
WUVSMF9ETUFfRE9ORSB8IExBWUVSMF9ETUFfSURMRSB8IExDRF9JTlRfVkwwX0VSUikKKyNkZWZp
bmUgTENEX0lOVF9WTDEgKExBWUVSMV9ETUFfRE9ORSB8IExBWUVSMV9ETUFfSURMRSB8IExDRF9J
TlRfVkwxX0VSUikKKyNkZWZpbmUgTENEX0lOVF9HTDAgKExBWUVSMl9ETUFfRE9ORSB8IExBWUVS
Ml9ETUFfSURMRSB8IExDRF9JTlRfR0wwX0VSUikKKyNkZWZpbmUgTENEX0lOVF9HTDEgKExBWUVS
M19ETUFfRE9ORSB8IExBWUVSM19ETUFfSURMRSB8IExDRF9JTlRfR0wxX0VSUikKKyNkZWZpbmUg
TENEX0lOVF9ETUFfRVJSIChMQ0RfSU5UX1ZMMF9FUlIgfCBMQ0RfSU5UX1ZMMV9FUlIgXAorCQl8
IExDRF9JTlRfR0wwX0VSUiB8IExDRF9JTlRfR0wxX0VSUikKKworI2RlZmluZSBQT1NTSUJMRV9D
UlRDUyAxCisjZGVmaW5lIHRvX2ttYl9wbGFuZSh4KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGtt
Yl9wbGFuZSwgYmFzZV9wbGFuZSkKKworZW51bSBsYXllcl9pZCB7CisJTEFZRVJfMCwKKwlMQVlF
Ul8xLAorCUxBWUVSXzIsCisJTEFZRVJfMywKKwkvKiBLTUJfTUFYX1BMQU5FUyAqLworfTsKKwor
I2RlZmluZSBLTUJfTUFYX1BMQU5FUyAxCisKK2VudW0gc3ViX3BsYW5lX2lkIHsKKwlZX1BMQU5F
LAorCVVfUExBTkUsCisJVl9QTEFORSwKKwlNQVhfU1VCX1BMQU5FUywKK307CisKK3N0cnVjdCBr
bWJfcGxhbmUgeworCXN0cnVjdCBkcm1fcGxhbmUgYmFzZV9wbGFuZTsKKwl1bnNpZ25lZCBjaGFy
IGlkOworfTsKKworLyogR3JhcGhpY3MgbGF5ZXIgKGxheWVycyAyICYgMykgZm9ybWF0cywgb25s
eSBwYWNrZWQgZm9ybWF0cyAgYXJlIHN1cHBvcnRlZCAqLworc3RhdGljIGNvbnN0IHUzMiBrbWJf
Zm9ybWF0c19nW10gPSB7CisJRFJNX0ZPUk1BVF9SR0IzMzIsCisJRFJNX0ZPUk1BVF9YUkdCNDQ0
NCwgRFJNX0ZPUk1BVF9YQkdSNDQ0NCwKKwlEUk1fRk9STUFUX0FSR0I0NDQ0LCBEUk1fRk9STUFU
X0FCR1I0NDQ0LAorCURSTV9GT1JNQVRfWFJHQjE1NTUsIERSTV9GT1JNQVRfWEJHUjE1NTUsCisJ
RFJNX0ZPUk1BVF9BUkdCMTU1NSwgRFJNX0ZPUk1BVF9BQkdSMTU1NSwKKwlEUk1fRk9STUFUX1JH
QjU2NSwgRFJNX0ZPUk1BVF9CR1I1NjUsCisJRFJNX0ZPUk1BVF9SR0I4ODgsIERSTV9GT1JNQVRf
QkdSODg4LAorCURSTV9GT1JNQVRfWFJHQjg4ODgsIERSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJN
X0ZPUk1BVF9BUkdCODg4OCwgRFJNX0ZPUk1BVF9BQkdSODg4OCwKK307CisKKyNkZWZpbmUgTUFY
X0ZPUk1BVF9HCShBUlJBWV9TSVpFKGttYl9mb3JtYXRzX2cpKQorI2RlZmluZSBNQVhfRk9STUFU
X1YJKEFSUkFZX1NJWkUoa21iX2Zvcm1hdHNfdikpCisKKy8qIFZpZGVvIGxheWVyICggMCAmIDEp
IGZvcm1hdHMsIHBhY2tlZCBhbmQgcGxhbmFyIGZvcm1hdHMgYXJlIHN1cHBvcnRlZCAqLworc3Rh
dGljIGNvbnN0IHUzMiBrbWJfZm9ybWF0c192W10gPSB7CisJLyogcGFja2VkIGZvcm1hdHMgKi8K
KwlEUk1fRk9STUFUX1JHQjMzMiwKKwlEUk1fRk9STUFUX1hSR0I0NDQ0LCBEUk1fRk9STUFUX1hC
R1I0NDQ0LAorCURSTV9GT1JNQVRfQVJHQjQ0NDQsIERSTV9GT1JNQVRfQUJHUjQ0NDQsCisJRFJN
X0ZPUk1BVF9YUkdCMTU1NSwgRFJNX0ZPUk1BVF9YQkdSMTU1NSwKKwlEUk1fRk9STUFUX0FSR0Ix
NTU1LCBEUk1fRk9STUFUX0FCR1IxNTU1LAorCURSTV9GT1JNQVRfUkdCNTY1LCBEUk1fRk9STUFU
X0JHUjU2NSwKKwlEUk1fRk9STUFUX1JHQjg4OCwgRFJNX0ZPUk1BVF9CR1I4ODgsCisJRFJNX0ZP
Uk1BVF9YUkdCODg4OCwgRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4ODg4
LCBEUk1fRk9STUFUX0FCR1I4ODg4LAorCS8qcGxhbmFyIGZvcm1hdHMgKi8KKwlEUk1fRk9STUFU
X1lVVjQyMCwgRFJNX0ZPUk1BVF9ZVlU0MjAsCisJRFJNX0ZPUk1BVF9ZVVY0MjIsIERSTV9GT1JN
QVRfWVZVNDIyLAorCURSTV9GT1JNQVRfWVVWNDQ0LCBEUk1fRk9STUFUX1lWVTQ0NCwKKwlEUk1f
Rk9STUFUX05WMTIsIERSTV9GT1JNQVRfTlYyMSwKK307CisKK3N0cnVjdCBsYXllcl9zdGF0dXMg
eworCWJvb2wgZGlzYWJsZTsKKwl1MzIgY3RybDsKK307CisKK3N0cnVjdCBrbWJfcGxhbmUgKmtt
Yl9wbGFuZV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pOwordm9pZCBrbWJfcGxhbmVfZGVz
dHJveShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSk7CisjZW5kaWYgLyogX19LTUJfUExBTkVfSF9f
ICovCi0tIAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRl
dmVsCg==
