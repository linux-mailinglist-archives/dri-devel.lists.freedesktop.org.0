Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 716C19C6B9
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 02:19:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C1ECB6E159;
	Mon, 26 Aug 2019 00:19:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay6-d.mail.gandi.net (relay6-d.mail.gandi.net
 [217.70.183.198])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 175E76E101
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Aug 2019 13:51:09 +0000 (UTC)
X-Originating-IP: 87.18.63.98
Received: from uno.homenet.telecomitalia.it (unknown [87.18.63.98])
 (Authenticated sender: jacopo@jmondi.org)
 by relay6-d.mail.gandi.net (Postfix) with ESMTPSA id AC8B6C000C;
 Sun, 25 Aug 2019 13:51:05 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli@fpond.eu, airlied@linux.ie,
 daniel@ffwll.ch
Subject: [PATCH v3 10/14] drm: rcar-du: kms: Collect CMM instances
Date: Sun, 25 Aug 2019 15:51:50 +0200
Message-Id: <20190825135154.11488-11-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190825135154.11488-1-jacopo+renesas@jmondi.org>
References: <20190825135154.11488-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 26 Aug 2019 00:18:56 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: muroya@ksk.co.jp, koji.matsuoka.xm@renesas.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-renesas-soc@vger.kernel.org, VenkataRajesh.Kalakodima@in.bosch.com,
 Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Harsha.ManjulaMallikarjun@in.bosch.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW1wbGVtZW50IGRldmljZSB0cmVlIHBhcnNpbmcgdG8gY29sbGVjdCB0aGUgYXZhaWxhYmxlIENN
TSBpbnN0YW5jZXMKZGVzY3JpYmVkIGJ5IHRoZSAnY21tcycgcHJvcGVydHkuIEFzc29jaWF0ZSBD
TU1zIHdpdGggQ1JUQ3MgYW5kIHN0b3JlIGEKbWFzayBvZiBhY3RpdmUgQ01NcyBpbiB0aGUgRFUg
Z3JvdXAgZm9yIGxhdGVyIGVuYWJsZW1lbnQuCgpFbmZvcmNlIHRoZSBzdXNwZW5kL3Jlc3VtZSBv
cmRlcmluZyBvZiBEVSBhbmQgQ01NIGJ5IGNyZWF0aW5nIGEKc3RhdGVsZXNzIGRldmljZSBsaW5r
IGJldHdlZW4gdGhlIHR3byB0byBtYWtlIHN1cmUgdGhlIENNTSBzdXBwbGllcgpkZXZpY2Ugc3Vz
cGVuZHMgYWZ0ZXIgYW5kIHJlc3VtZXMgYmVmb3JlIHRoZSBEVSBjb25zdW1lci4KClNpZ25lZC1v
ZmYtYnk6IEphY29wbyBNb25kaSA8amFjb3BvK3JlbmVzYXNAam1vbmRpLm9yZz4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYyAgfCAgNiArKysKIGRyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5oICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L3JjYXJfZHVfZHJ2LmggICB8ICAzICsrCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2Fy
X2R1X2dyb3VwLmggfCAgMiArCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5j
ICAgfCA2MyArKysrKysrKysrKysrKysrKysrKysrKysrCiA1IGZpbGVzIGNoYW5nZWQsIDc2IGlu
c2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2NydGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5jCmluZGV4IDJk
YTQ2ZTNkYzRhZS4uMjNmMWQ2Y2MxNzE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2R1X2NydGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2NydGMuYwpAQCAtMTE5NCw2ICsxMTk0LDEyIEBAIGludCByY2FyX2R1X2NydGNfY3JlYXRlKHN0
cnVjdCByY2FyX2R1X2dyb3VwICpyZ3JwLCB1bnNpZ25lZCBpbnQgc3dpbmRleCwKIAlpZiAocmV0
IDwgMCkKIAkJcmV0dXJuIHJldDsKIAorCS8qIENNTSBtaWdodCBiZSBkaXNhYmxlZCBmb3IgdGhp
cyBDUlRDLiAqLworCWlmIChyY2R1LT5jbW1zW3N3aW5kZXhdKSB7CisJCXJjcnRjLT5jbW0gPSBy
Y2R1LT5jbW1zW3N3aW5kZXhdOworCQlyZ3JwLT5jbW1zX21hc2sgfD0gQklUKGh3aW5kZXggJSAy
KTsKKwl9CisKIAlkcm1fY3J0Y19oZWxwZXJfYWRkKGNydGMsICZjcnRjX2hlbHBlcl9mdW5jcyk7
CiAKIAkvKiBTdGFydCB3aXRoIHZlcnRpY2FsIGJsYW5raW5nIGludGVycnVwdCByZXBvcnRpbmcg
ZGlzYWJsZWQuICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2NydGMuaCBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5oCmluZGV4IDNi
N2ZjNjY4OTk2Zi4uNWYyOTQwYzQyMjI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2R1X2NydGMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2NydGMuaApAQCAtMzksNiArMzksNyBAQCBzdHJ1Y3QgcmNhcl9kdV92c3A7CiAgKiBAdmJsYW5r
X3dhaXQ6IHdhaXQgcXVldWUgdXNlZCB0byBzaWduYWwgdmVydGljYWwgYmxhbmtpbmcKICAqIEB2
YmxhbmtfY291bnQ6IG51bWJlciBvZiB2ZXJ0aWNhbCBibGFua2luZyBpbnRlcnJ1cHRzIHRvIHdh
aXQgZm9yCiAgKiBAZ3JvdXA6IENSVEMgZ3JvdXAgdGhpcyBDUlRDIGJlbG9uZ3MgdG8KKyAqIEBj
bW06IENNTSBhc3NvY2lhdGVkIHdpdGggdGhpcyBDUlRDCiAgKiBAdnNwOiBWU1AgZmVlZGluZyB2
aWRlbyB0byB0aGlzIENSVEMKICAqIEB2c3BfcGlwZTogaW5kZXggb2YgdGhlIFZTUCBwaXBlbGlu
ZSBmZWVkaW5nIHZpZGVvIHRvIHRoaXMgQ1JUQwogICogQHdyaXRlYmFjazogdGhlIHdyaXRlYmFj
ayBjb25uZWN0b3IKQEAgLTY0LDYgKzY1LDcgQEAgc3RydWN0IHJjYXJfZHVfY3J0YyB7CiAJdW5z
aWduZWQgaW50IHZibGFua19jb3VudDsKIAogCXN0cnVjdCByY2FyX2R1X2dyb3VwICpncm91cDsK
KwlzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpjbW07CiAJc3RydWN0IHJjYXJfZHVfdnNwICp2c3A7
CiAJdW5zaWduZWQgaW50IHZzcF9waXBlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
cmNhci1kdS9yY2FyX2R1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9k
cnYuaAppbmRleCBhMDBkY2NjNDQ3YWEuLjMwMGVjNjBiYTMxYiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2R1X2Rydi5oCkBAIC0xMyw2ICsxMyw3IEBACiAjaW5jbHVkZSA8bGludXgva2Vy
bmVsLmg+CiAjaW5jbHVkZSA8bGludXgvd2FpdC5oPgogCisjaW5jbHVkZSAicmNhcl9jbW0uaCIK
ICNpbmNsdWRlICJyY2FyX2R1X2NydGMuaCIKICNpbmNsdWRlICJyY2FyX2R1X2dyb3VwLmgiCiAj
aW5jbHVkZSAicmNhcl9kdV92c3AuaCIKQEAgLTcwLDYgKzcxLDcgQEAgc3RydWN0IHJjYXJfZHVf
ZGV2aWNlX2luZm8gewogCiAjZGVmaW5lIFJDQVJfRFVfTUFYX0NSVENTCQk0CiAjZGVmaW5lIFJD
QVJfRFVfTUFYX0dST1VQUwkJRElWX1JPVU5EX1VQKFJDQVJfRFVfTUFYX0NSVENTLCAyKQorI2Rl
ZmluZSBSQ0FSX0RVX01BWF9DTU1TCQk0CiAjZGVmaW5lIFJDQVJfRFVfTUFYX1ZTUFMJCTQKIAog
c3RydWN0IHJjYXJfZHVfZGV2aWNlIHsKQEAgLTg2LDYgKzg4LDcgQEAgc3RydWN0IHJjYXJfZHVf
ZGV2aWNlIHsKIAlzdHJ1Y3QgcmNhcl9kdV9lbmNvZGVyICplbmNvZGVyc1tSQ0FSX0RVX09VVFBV
VF9NQVhdOwogCiAJc3RydWN0IHJjYXJfZHVfZ3JvdXAgZ3JvdXBzW1JDQVJfRFVfTUFYX0dST1VQ
U107CisJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqY21tc1tSQ0FSX0RVX01BWF9DTU1TXTsKIAlz
dHJ1Y3QgcmNhcl9kdV92c3AgdnNwc1tSQ0FSX0RVX01BWF9WU1BTXTsKIAogCXN0cnVjdCB7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3VwLmggYi9kcml2
ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3VwLmgKaW5kZXggODc5NTBjMWY2YTUyLi5l
OTkwNjYwOWM2MzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVf
Z3JvdXAuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3VwLmgKQEAg
LTIyLDYgKzIyLDcgQEAgc3RydWN0IHJjYXJfZHVfZGV2aWNlOwogICogQG1taW9fb2Zmc2V0OiBy
ZWdpc3RlcnMgb2Zmc2V0IGluIHRoZSBkZXZpY2UgbWVtb3J5IG1hcAogICogQGluZGV4OiBncm91
cCBpbmRleAogICogQGNoYW5uZWxzX21hc2s6IGJpdG1hc2sgb2YgcG9wdWxhdGVkIERVIGNoYW5u
ZWxzIGluIHRoaXMgZ3JvdXAKKyAqIEBjbW1zX21hc2s6IGJpdG1hc2sgb2YgYXZhaWxhYmxlIENN
TXMgaW4gdGhpcyBncm91cAogICogQG51bV9jcnRjczogbnVtYmVyIG9mIENSVENzIGluIHRoaXMg
Z3JvdXAgKDEgb3IgMikKICAqIEB1c2VfY291bnQ6IG51bWJlciBvZiB1c2VycyBvZiB0aGUgZ3Jv
dXAgKHJjYXJfZHVfZ3JvdXBfKGdldHxwdXQpKQogICogQHVzZWRfY3J0Y3M6IG51bWJlciBvZiBD
UlRDcyBjdXJyZW50bHkgaW4gdXNlCkBAIC0zNyw2ICszOCw3IEBAIHN0cnVjdCByY2FyX2R1X2dy
b3VwIHsKIAl1bnNpZ25lZCBpbnQgaW5kZXg7CiAKIAl1bnNpZ25lZCBpbnQgY2hhbm5lbHNfbWFz
azsKKwl1bnNpZ25lZCBpbnQgY21tc19tYXNrOwogCXVuc2lnbmVkIGludCBudW1fY3J0Y3M7CiAJ
dW5zaWduZWQgaW50IHVzZV9jb3VudDsKIAl1bnNpZ25lZCBpbnQgdXNlZF9jcnRjczsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMgYi9kcml2ZXJzL2dw
dS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jCmluZGV4IDJkYzljYWVlODc2Ny4uNjFjYTFkM2Mz
NzlhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMKQEAgLTE3LDcgKzE3LDkg
QEAKICNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1f
dmJsYW5rLmg+CiAKKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KICNpbmNsdWRlIDxsaW51eC9v
Zl9ncmFwaC5oPgorI2luY2x1ZGUgPGxpbnV4L29mX3BsYXRmb3JtLmg+CiAjaW5jbHVkZSA8bGlu
dXgvd2FpdC5oPgogCiAjaW5jbHVkZSAicmNhcl9kdV9jcnRjLmgiCkBAIC02MTQsNiArNjE2LDYy
IEBAIHN0YXRpYyBpbnQgcmNhcl9kdV92c3BzX2luaXQoc3RydWN0IHJjYXJfZHVfZGV2aWNlICpy
Y2R1KQogCXJldHVybiByZXQ7CiB9CiAKK3N0YXRpYyBpbnQgcmNhcl9kdV9jbW1faW5pdChzdHJ1
Y3QgcmNhcl9kdV9kZXZpY2UgKnJjZHUpCit7CisJY29uc3Qgc3RydWN0IGRldmljZV9ub2RlICpu
cCA9IHJjZHUtPmRldi0+b2Zfbm9kZTsKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQgY2VsbHM7CisK
KwljZWxscyA9IG9mX3Byb3BlcnR5X2NvdW50X3UzMl9lbGVtcyhucCwgImNtbXMiKTsKKwlpZiAo
Y2VsbHMgPT0gLUVJTlZBTCkKKwkJcmV0dXJuIDA7CisKKwlpZiAoY2VsbHMgPiBSQ0FSX0RVX01B
WF9DTU1TIHx8IGNlbGxzID4gcmNkdS0+bnVtX2NydGNzKSB7CisJCWRldl9lcnIocmNkdS0+ZGV2
LAorCQkJIkludmFsaWQgbnVtYmVyIG9mIGVudHJpZXMgaW4gJ2NtbXMnIHByb3BlcnR5XG4iKTsK
KwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJZm9yIChpID0gMDsgaSA8IGNlbGxzOyArK2kpIHsK
KwkJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldjsKKwkJc3RydWN0IGRldmljZV9saW5rICps
aW5rOworCQlzdHJ1Y3QgZGV2aWNlX25vZGUgKmNtbTsKKworCQljbW0gPSBvZl9wYXJzZV9waGFu
ZGxlKG5wLCAiY21tcyIsIGkpOworCQlpZiAoSVNfRVJSKGNtbSkpIHsKKwkJCWRldl9lcnIocmNk
dS0+ZGV2LCAiRmFpbGVkIHRvIHBhcnNlICdjbW1zJyBwcm9wZXJ0eVxuIik7CisJCQlyZXR1cm4g
UFRSX0VSUihjbW0pOworCQl9CisKKwkJaWYgKCFvZl9kZXZpY2VfaXNfYXZhaWxhYmxlKGNtbSkp
IHsKKwkJCS8qIEl0J3MgZmluZSB0byBoYXZlIGEgcGhhbmRsZSB0byBhIG5vbi1lbmFibGVkIENN
TS4gKi8KKwkJCW9mX25vZGVfcHV0KGNtbSk7CisJCQljb250aW51ZTsKKwkJfQorCisJCXBkZXYg
PSBvZl9maW5kX2RldmljZV9ieV9ub2RlKGNtbSk7CisJCWlmIChJU19FUlIocGRldikpIHsKKwkJ
CWRldl9lcnIocmNkdS0+ZGV2LCAiTm8gZGV2aWNlIGZvdW5kIGZvciBDTU0ldVxuIiwgaSk7CisJ
CQlvZl9ub2RlX3B1dChjbW0pOworCQkJcmV0dXJuIFBUUl9FUlIocGRldik7CisJCX0KKworCQlv
Zl9ub2RlX3B1dChjbW0pOworCisJCWxpbmsgPSBkZXZpY2VfbGlua19hZGQocmNkdS0+ZGV2LCAm
cGRldi0+ZGV2LAorCQkJCSAgICAgICBETF9GTEFHX1NUQVRFTEVTUyk7CisJCWlmICghbGluaykg
eworCQkJZGV2X2VycihyY2R1LT5kZXYsCisJCQkJIkZhaWxlZCB0byBjcmVhdGUgZGV2aWNlIGxp
bmsgdG8gQ01NJXVcbiIsIGkpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKworCQlyY2R1LT5j
bW1zW2ldID0gcGRldjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwogaW50IHJjYXJfZHVfbW9kZXNl
dF9pbml0KHN0cnVjdCByY2FyX2R1X2RldmljZSAqcmNkdSkKIHsKIAlzdGF0aWMgY29uc3QgdW5z
aWduZWQgaW50IG1taW9fb2Zmc2V0c1tdID0gewpAQCAtNzA0LDYgKzc2MiwxMSBAQCBpbnQgcmNh
cl9kdV9tb2Rlc2V0X2luaXQoc3RydWN0IHJjYXJfZHVfZGV2aWNlICpyY2R1KQogCQkJcmV0dXJu
IHJldDsKIAl9CiAKKwkvKiBJbml0aWFsaXplIHRoZSBDb2xvciBNYW5hZ2VtZW50IE1vZHVsZXMu
ICovCisJcmV0ID0gcmNhcl9kdV9jbW1faW5pdChyY2R1KTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OworCiAJLyogQ3JlYXRlIHRoZSBDUlRDcy4gKi8KIAlmb3IgKHN3aW5kZXggPSAwLCBod2lu
ZGV4ID0gMDsgc3dpbmRleCA8IHJjZHUtPm51bV9jcnRjczsgKytod2luZGV4KSB7CiAJCXN0cnVj
dCByY2FyX2R1X2dyb3VwICpyZ3JwOwotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZl
bEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
