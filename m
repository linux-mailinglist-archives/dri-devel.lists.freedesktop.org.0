Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7BD4938AA9
	for <lists+dri-devel@lfdr.de>; Fri,  7 Jun 2019 14:50:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CB92689CD8;
	Fri,  7 Jun 2019 12:50:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D8F3989CD4;
 Fri,  7 Jun 2019 12:50:42 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id s3so1955673wms.2;
 Fri, 07 Jun 2019 05:50:42 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=nMUIW24i/QncsPgBSI0lHn3Qu77ZyRoob4OW2IIiNSs=;
 b=ZuExgQp651hBt1yddIkEnoN+ehxMzY/+u5i6amr3QARUWisfLzmEuZ4qMOPnxEljdv
 tvRwu6LhRbT+Gr8Nxw9K1Q3bEaADZE3/JmGgbc5LfWzeRNnZwRBm51eoxeH9FGu+TMLU
 MgvyFlYAncgfDz8S2JdA0OBnOXUA6jNOMf6STRzHOWmX1HG2n19Kf6ZPY1SymLYZ/JeO
 rOaOlLWCNpn3p0ytpCrHDdD++JvjtMXSxDfQOnWNBCK9mnB+Heqp7H/VsFTIkifL3rFc
 g/96VO3pKer8k8YzD1z8QA7tJ+a5bfuk0sLW1eE+nOq2Ede4NZ229sEgPl/nzgpsGEa/
 Pz9w==
X-Gm-Message-State: APjAAAWrT3FgpBxDWNuHKSGAN0S6P4WprLKCtZ08jFTxQf17Qp6kkOWj
 c7cl/82vQR12/CY8GSe7Mz3N1IY8
X-Google-Smtp-Source: APXvYqy2u+5uFks+ICpdvoV6sSkF8smHHC0kng6ZB9Vj0pjqIH9uZxHYusKlHLMVzT8OBFezhQ9jDQ==
X-Received: by 2002:a1c:3886:: with SMTP id f128mr3534500wma.151.1559911841057; 
 Fri, 07 Jun 2019 05:50:41 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c5a0:21d3:d7e7:98b7])
 by smtp.gmail.com with ESMTPSA id 32sm3923249wra.35.2019.06.07.05.50.40
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Fri, 07 Jun 2019 05:50:40 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: intel-gfx@lists.freedesktop.org, dri-devel@lists.freedesktop.org,
 daniel.vetter@ffwll.ch
Subject: [PATCH 1/6] dma-buf: add dynamic DMA-buf handling v9
Date: Fri,  7 Jun 2019 14:50:34 +0200
Message-Id: <20190607125039.2240-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=nMUIW24i/QncsPgBSI0lHn3Qu77ZyRoob4OW2IIiNSs=;
 b=fo0vUx/WjxhN35BI1r0FDDYDDZKSiWD0qiVOQlyp07O3TxD9aFWeIV/V48FlwyxF3e
 EvbQxT8WjoQkwjU/Z5hvFvXbEXwnAofT9BR6a1VVVMZEbZwPbElwEJekdU6Empb2zTzN
 WMyd0EICytBE+RO6t6BcG1d7GvvL7GwHsFC03Yr5e3jXQlRSJFaX1OBp/5WM6An0Dq6c
 03w89Hxux7AV+uyJ/+yryNdeUc+epH2PjqjVzOYwhm25dH7spXzOi+md8TmljCjsP5yZ
 Kh1PLd4EqbDWqW2y95fTA39i3KdTwgPS14/uqY1QreczXjtHr8Ki5LUqR5n1cM/zV0o4
 +aMQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gdGhlIGV4cG9ydGVyIHNpZGUgd2UgYWRkIG9wdGlvbmFsIGV4cGxpY2l0IHBpbm5pbmcgY2Fs
bGJhY2tzLiBJZiB0aG9zZQpjYWxsYmFja3MgYXJlIGltcGxlbWVudGVkIHRoZSBmcmFtZXdvcmsg
bm8gbG9uZ2VyIGNhY2hlcyBzZyB0YWJsZXMgYW5kIHRoZQptYXAvdW5tYXAgY2FsbGJhY2tzIGFy
ZSBhbHdheXMgY2FsbGVkIHdpdGggdGhlIGxvY2sgb2YgdGhlIHJlc2VydmF0aW9uIG9iamVjdApo
ZWxkLgoKT24gdGhlIGltcG9ydGVyIHNpZGUgd2UgYWRkIGFuIG9wdGlvbmFsIGludmFsaWRhdGUg
Y2FsbGJhY2suIFRoaXMgY2FsbGJhY2sgaXMKdXNlZCBieSB0aGUgZXhwb3J0ZXIgdG8gaW5mb3Jt
IHRoZSBpbXBvcnRlcnMgdGhhdCB0aGVpciBtYXBwaW5ncyBzaG91bGQgYmUKZGVzdHJveWVkIGFz
IHNvb24gYXMgcG9zc2libGUuCgpUaGlzIGFsbG93cyB0aGUgZXhwb3J0ZXIgdG8gcHJvdmlkZSB0
aGUgbWFwcGluZ3Mgd2l0aG91dCB0aGUgbmVlZCB0byBwaW4KdGhlIGJhY2tpbmcgc3RvcmUuCgp2
MjogZG9uJ3QgdHJ5IHRvIGludmFsaWRhdGUgbWFwcGluZ3Mgd2hlbiB0aGUgY2FsbGJhY2sgaXMg
TlVMTCwKICAgIGxvY2sgdGhlIHJlc2VydmF0aW9uIG9iaiB3aGlsZSB1c2luZyB0aGUgYXR0YWNo
bWVudHMsCiAgICBhZGQgaGVscGVyIHRvIHNldCB0aGUgY2FsbGJhY2sKdjM6IG1vdmUgZmxhZyBm
b3IgaW52YWxpZGF0aW9uIHN1cHBvcnQgaW50byB0aGUgRE1BLWJ1ZiwKICAgIHVzZSBuZXcgYXR0
YWNoX2luZm8gc3RydWN0dXJlIHRvIHNldCB0aGUgY2FsbGJhY2sKdjQ6IHVzZSBpbXBvcnRlcl9w
cml2IGZpZWxkIGluc3RlYWQgb2YgbWFuZ2xpbmcgZXhwb3J0ZXIgcHJpdi4KdjU6IGRyb3AgaW52
YWxpZGF0aW9uX3N1cHBvcnRlZCBmbGFnCnY2OiBzcXVhc2ggdG9nZXRoZXIgd2l0aCBwaW4vdW5w
aW4gY2hhbmdlcwp2NzogcGluL3VucGluIHRha2VzIGFuIGF0dGFjaG1lbnQgbm93CnY4OiBudWtl
IGRtYV9idWZfYXR0YWNobWVudF8obWFwfHVubWFwKV9sb2NrZWQsCiAgICBldmVyeXRoaW5nIGlz
IG5vdyBoYW5kbGVkIGJhY2t3YXJkIGNvbXBhdGlibGUKdjk6IGFsd2F5cyBjYWNoZSB3aGVuIGV4
cG9ydC9pbXBvcnRlciBkb24ndCBhZ3JlZSBvbiBkeW5hbWljIGhhbmRsaW5nCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJp
dmVycy9kbWEtYnVmL2RtYS1idWYuYyB8IDE4OCArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKystLQogaW5jbHVkZS9saW51eC9kbWEtYnVmLmggICB8IDEwOSArKysrKysrKysrKysr
KysrKysrKy0tCiAyIGZpbGVzIGNoYW5nZWQsIDI4MyBpbnNlcnRpb25zKCspLCAxNCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jIGIvZHJpdmVycy9k
bWEtYnVmL2RtYS1idWYuYwppbmRleCBhMmQzNGM2YjgwYTUuLmY3NTY4NzBiYTUwOSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYworKysgYi9kcml2ZXJzL2RtYS1idWYvZG1h
LWJ1Zi5jCkBAIC00MDksNiArNDA5LDkgQEAgc3RydWN0IGRtYV9idWYgKmRtYV9idWZfZXhwb3J0
KGNvbnN0IHN0cnVjdCBkbWFfYnVmX2V4cG9ydF9pbmZvICpleHBfaW5mbykKIAkJcmV0dXJuIEVS
Ul9QVFIoLUVJTlZBTCk7CiAJfQogCisJaWYgKFdBUk5fT04oZXhwX2luZm8tPm9wcy0+Y2FjaGVf
c2d0X21hcHBpbmcgJiYgZXhwX2luZm8tPm9wcy0+cGluKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVJ
TlZBTCk7CisKIAlpZiAoIXRyeV9tb2R1bGVfZ2V0KGV4cF9pbmZvLT5vd25lcikpCiAJCXJldHVy
biBFUlJfUFRSKC1FTk9FTlQpOwogCkBAIC01MzAsMTAgKzUzMywxMiBAQCB2b2lkIGRtYV9idWZf
cHV0KHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCiBFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX3B1
dCk7CiAKIC8qKgotICogZG1hX2J1Zl9hdHRhY2ggLSBBZGQgdGhlIGRldmljZSB0byBkbWFfYnVm
J3MgYXR0YWNobWVudHMgbGlzdDsgb3B0aW9uYWxseSwKKyAqIGRtYV9idWZfZHluYW1pY19hdHRh
Y2ggLSBBZGQgdGhlIGRldmljZSB0byBkbWFfYnVmJ3MgYXR0YWNobWVudHMgbGlzdDsgb3B0aW9u
YWxseSwKICAqIGNhbGxzIGF0dGFjaCgpIG9mIGRtYV9idWZfb3BzIHRvIGFsbG93IGRldmljZS1z
cGVjaWZpYyBhdHRhY2ggZnVuY3Rpb25hbGl0eQotICogQGRtYWJ1ZjoJW2luXQlidWZmZXIgdG8g
YXR0YWNoIGRldmljZSB0by4KLSAqIEBkZXY6CVtpbl0JZGV2aWNlIHRvIGJlIGF0dGFjaGVkLgor
ICogQGRtYWJ1ZjoJCVtpbl0JYnVmZmVyIHRvIGF0dGFjaCBkZXZpY2UgdG8uCisgKiBAZGV2OgkJ
W2luXQlkZXZpY2UgdG8gYmUgYXR0YWNoZWQuCisgKiBAaW1wb3J0ZXJfb3BzCVtpbl0JaW1wb3J0
ZXIgb3BlcmF0aW9ucyBmb3IgdGhlIGF0dGFjaG1lbnQKKyAqIEBpbXBvcnRlcl9wcml2CVtpbl0J
aW1wb3J0ZXIgcHJpdmF0ZSBwb2ludGVyIGZvciB0aGUgYXR0YWNobWVudAogICoKICAqIFJldHVy
bnMgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCBwb2ludGVyIGZvciB0aGlzIGF0dGFjaG1lbnQu
IEF0dGFjaG1lbnRzCiAgKiBtdXN0IGJlIGNsZWFuZWQgdXAgYnkgY2FsbGluZyBkbWFfYnVmX2Rl
dGFjaCgpLgpAQCAtNTQ3LDggKzU1MiwxMCBAQCBFWFBPUlRfU1lNQk9MX0dQTChkbWFfYnVmX3B1
dCk7CiAgKiBhY2Nlc3NpYmxlIHRvIEBkZXYsIGFuZCBjYW5ub3QgYmUgbW92ZWQgdG8gYSBtb3Jl
IHN1aXRhYmxlIHBsYWNlLiBUaGlzIGlzCiAgKiBpbmRpY2F0ZWQgd2l0aCB0aGUgZXJyb3IgY29k
ZSAtRUJVU1kuCiAgKi8KLXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmRtYV9idWZfYXR0YWNo
KHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCi0JCQkJCSAgc3RydWN0IGRldmljZSAqZGV2KQorc3Ry
dWN0IGRtYV9idWZfYXR0YWNobWVudCAqCitkbWFfYnVmX2R5bmFtaWNfYXR0YWNoKHN0cnVjdCBk
bWFfYnVmICpkbWFidWYsIHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJICAgICAgIGNvbnN0IHN0cnVj
dCBkbWFfYnVmX2F0dGFjaF9vcHMgKmltcG9ydGVyX29wcywKKwkJICAgICAgIHZvaWQgKmltcG9y
dGVyX3ByaXYpCiB7CiAJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOwogCWludCBy
ZXQ7CkBAIC01NjIsNiArNTY5LDggQEAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqZG1hX2J1
Zl9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKIAogCWF0dGFjaC0+ZGV2ID0gZGV2Owog
CWF0dGFjaC0+ZG1hYnVmID0gZG1hYnVmOworCWF0dGFjaC0+aW1wb3J0ZXJfb3BzID0gaW1wb3J0
ZXJfb3BzOworCWF0dGFjaC0+aW1wb3J0ZXJfcHJpdiA9IGltcG9ydGVyX3ByaXY7CiAKIAltdXRl
eF9sb2NrKCZkbWFidWYtPmxvY2spOwogCkBAIC01NzAsMTYgKzU3OSw3MiBAQCBzdHJ1Y3QgZG1h
X2J1Zl9hdHRhY2htZW50ICpkbWFfYnVmX2F0dGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAog
CQlpZiAocmV0KQogCQkJZ290byBlcnJfYXR0YWNoOwogCX0KKwlyZXNlcnZhdGlvbl9vYmplY3Rf
bG9jayhkbWFidWYtPnJlc3YsIE5VTEwpOwogCWxpc3RfYWRkKCZhdHRhY2gtPm5vZGUsICZkbWFi
dWYtPmF0dGFjaG1lbnRzKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGRtYWJ1Zi0+cmVz
dik7CiAKIAltdXRleF91bmxvY2soJmRtYWJ1Zi0+bG9jayk7CiAKKwkvKiBXaGVuIGVpdGhlciB0
aGUgaW1wb3J0ZXIgb3IgdGhlIGV4cG9ydGVyIGNhbid0IGhhbmRsZSBkeW5hbWljCisJICogbWFw
cGluZ3Mgd2UgY2FjaGUgdGhlIG1hcHBpbmcgaGVyZSB0byBhdm9pZCBpc3N1ZXMgd2l0aCB0aGUK
KwkgKiByZXNlcnZhdGlvbiBvYmplY3QgbG9jay4KKwkgKi8KKwlpZiAoZG1hX2J1Zl9hdHRhY2ht
ZW50X2lzX2R5bmFtaWMoYXR0YWNoKSAhPQorCSAgICBkbWFfYnVmX2lzX2R5bmFtaWMoZG1hYnVm
KSkgeworCQlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKKworCQlpZiAoZG1hX2J1Zl9pc19keW5hbWlj
KGF0dGFjaC0+ZG1hYnVmKSkgeworCQkJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2soYXR0YWNoLT5k
bWFidWYtPnJlc3YsIE5VTEwpOworCQkJcmV0ID0gZG1hX2J1Zl9waW4oYXR0YWNoKTsKKwkJCWlm
IChyZXQpCisJCQkJZ290byBlcnJfdW5sb2NrOworCQl9CisKKwkJc2d0ID0gZG1hYnVmLT5vcHMt
Pm1hcF9kbWFfYnVmKGF0dGFjaCwgRE1BX0JJRElSRUNUSU9OQUwpOworCQlpZiAoIXNndCkKKwkJ
CXNndCA9IEVSUl9QVFIoLUVOT01FTSk7CisJCWlmIChJU19FUlIoc2d0KSkgeworCQkJcmV0ID0g
UFRSX0VSUihzZ3QpOworCQkJZ290byBlcnJfdW5waW47CisJCX0KKwkJaWYgKGRtYV9idWZfaXNf
ZHluYW1pYyhhdHRhY2gtPmRtYWJ1ZikpCisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGF0
dGFjaC0+ZG1hYnVmLT5yZXN2KTsKKwkJYXR0YWNoLT5zZ3QgPSBzZ3Q7CisJCWF0dGFjaC0+ZGly
ID0gRE1BX0JJRElSRUNUSU9OQUw7CisJfQorCiAJcmV0dXJuIGF0dGFjaDsKIAogZXJyX2F0dGFj
aDoKIAlrZnJlZShhdHRhY2gpOwogCW11dGV4X3VubG9jaygmZG1hYnVmLT5sb2NrKTsKIAlyZXR1
cm4gRVJSX1BUUihyZXQpOworCitlcnJfdW5waW46CisJaWYgKGRtYV9idWZfaXNfZHluYW1pYyhh
dHRhY2gtPmRtYWJ1ZikpCisJCWRtYV9idWZfdW5waW4oYXR0YWNoKTsKKworZXJyX3VubG9jazoK
KwlpZiAoZG1hX2J1Zl9pc19keW5hbWljKGF0dGFjaC0+ZG1hYnVmKSkKKwkJcmVzZXJ2YXRpb25f
b2JqZWN0X3VubG9jayhhdHRhY2gtPmRtYWJ1Zi0+cmVzdik7CisKKwlkbWFfYnVmX2RldGFjaChk
bWFidWYsIGF0dGFjaCk7CisJcmV0dXJuIEVSUl9QVFIocmV0KTsKK30KK0VYUE9SVF9TWU1CT0xf
R1BMKGRtYV9idWZfZHluYW1pY19hdHRhY2gpOworCisvKioKKyAqIGRtYV9idWZfYXR0YWNoIC0g
V3JhcHBlciBmb3IgZG1hX2J1Zl9keW5hbWljX2F0dGFjaAorICogQGRtYWJ1ZjoJW2luXQlidWZm
ZXIgdG8gYXR0YWNoIGRldmljZSB0by4KKyAqIEBkZXY6CVtpbl0JZGV2aWNlIHRvIGJlIGF0dGFj
aGVkLgorICoKKyAqIFdyYXBwZXIgdG8gY2FsbCBkbWFfYnVmX2R5bmFtaWNfYXR0YWNoKCkgZm9y
IGRyaXZlcnMgd2hpY2ggc3RpbGwgdXNlIGEgc3RhdGljCisgKiBtYXBwaW5nLgorICovCitzdHJ1
Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICpkbWFfYnVmX2F0dGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1h
YnVmLAorCQkJCQkgIHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlyZXR1cm4gZG1hX2J1Zl9keW5h
bWljX2F0dGFjaChkbWFidWYsIGRldiwgTlVMTCwgTlVMTCk7CiB9CiBFWFBPUlRfU1lNQk9MX0dQ
TChkbWFfYnVmX2F0dGFjaCk7CiAKQEAgLTU5NiwxMSArNjYxLDIyIEBAIHZvaWQgZG1hX2J1Zl9k
ZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAq
YXR0YWNoKQogCWlmIChXQVJOX09OKCFkbWFidWYgfHwgIWF0dGFjaCkpCiAJCXJldHVybjsKIAot
CWlmIChhdHRhY2gtPnNndCkKKwlpZiAoYXR0YWNoLT5zZ3QpIHsKKwkJaWYgKGRtYV9idWZfaXNf
ZHluYW1pYyhhdHRhY2gtPmRtYWJ1ZikpCisJCQlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhhdHRh
Y2gtPmRtYWJ1Zi0+cmVzdiwgTlVMTCk7CisKIAkJZG1hYnVmLT5vcHMtPnVubWFwX2RtYV9idWYo
YXR0YWNoLCBhdHRhY2gtPnNndCwgYXR0YWNoLT5kaXIpOwogCisJCWlmIChkbWFfYnVmX2lzX2R5
bmFtaWMoYXR0YWNoLT5kbWFidWYpKSB7CisJCQlkbWFfYnVmX3VucGluKGF0dGFjaCk7CisJCQly
ZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsKKwkJfQorCX0K
KwogCW11dGV4X2xvY2soJmRtYWJ1Zi0+bG9jayk7CisJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2so
ZG1hYnVmLT5yZXN2LCBOVUxMKTsKIAlsaXN0X2RlbCgmYXR0YWNoLT5ub2RlKTsKKwlyZXNlcnZh
dGlvbl9vYmplY3RfdW5sb2NrKGRtYWJ1Zi0+cmVzdik7CiAJaWYgKGRtYWJ1Zi0+b3BzLT5kZXRh
Y2gpCiAJCWRtYWJ1Zi0+b3BzLT5kZXRhY2goZG1hYnVmLCBhdHRhY2gpOwogCkBAIC02MDksNiAr
Njg1LDQ0IEBAIHZvaWQgZG1hX2J1Zl9kZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgc3Ry
dWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQogfQogRVhQT1JUX1NZTUJPTF9HUEwoZG1h
X2J1Zl9kZXRhY2gpOwogCisvKioKKyAqIGRtYV9idWZfcGluIC0gTG9jayBkb3duIHRoZSBETUEt
YnVmCisgKgorICogQGF0dGFjaDoJW2luXQlhdHRhY2htZW50IHdoaWNoIHNob3VsZCBiZSBwaW5u
ZWQKKyAqCisgKiBSZXR1cm5zOgorICogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2Rl
IG9uIGZhaWx1cmUuCisgKi8KK2ludCBkbWFfYnVmX3BpbihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2ht
ZW50ICphdHRhY2gpCit7CisJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiA9IGF0dGFjaC0+ZG1hYnVm
OworCWludCByZXQgPSAwOworCisJcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGRtYWJ1
Zi0+cmVzdik7CisKKwlpZiAoZG1hYnVmLT5vcHMtPnBpbikKKwkJcmV0ID0gZG1hYnVmLT5vcHMt
PnBpbihhdHRhY2gpOworCisJcmV0dXJuIHJldDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKGRtYV9i
dWZfcGluKTsKKworLyoqCisgKiBkbWFfYnVmX3VucGluIC0gUmVtb3ZlIGxvY2sgZnJvbSBETUEt
YnVmCisgKgorICogQGF0dGFjaDoJW2luXQlhdHRhY2htZW50IHdoaWNoIHNob3VsZCBiZSB1bnBp
bm5lZAorICovCit2b2lkIGRtYV9idWZfdW5waW4oc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAq
YXR0YWNoKQoreworCXN0cnVjdCBkbWFfYnVmICpkbWFidWYgPSBhdHRhY2gtPmRtYWJ1ZjsKKwor
CXJlc2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZChkbWFidWYtPnJlc3YpOworCisJaWYgKGRt
YWJ1Zi0+b3BzLT51bnBpbikKKwkJZG1hYnVmLT5vcHMtPnVucGluKGF0dGFjaCk7Cit9CitFWFBP
UlRfU1lNQk9MX0dQTChkbWFfYnVmX3VucGluKTsKKwogLyoqCiAgKiBkbWFfYnVmX21hcF9hdHRh
Y2htZW50IC0gUmV0dXJucyB0aGUgc2NhdHRlcmxpc3QgdGFibGUgb2YgdGhlIGF0dGFjaG1lbnQ7
CiAgKiBtYXBwZWQgaW50byBfZGV2aWNlXyBhZGRyZXNzIHNwYWNlLiBJcyBhIHdyYXBwZXIgZm9y
IG1hcF9kbWFfYnVmKCkgb2YgdGhlCkBAIC02MjgsNiArNzQyLDcgQEAgc3RydWN0IHNnX3RhYmxl
ICpkbWFfYnVmX21hcF9hdHRhY2htZW50KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aCwKIAkJCQkJZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQogewogCXN0cnVjdCBz
Z190YWJsZSAqc2dfdGFibGU7CisJaW50IHI7CiAKIAltaWdodF9zbGVlcCgpOwogCkBAIC02NDYs
MTAgKzc2MSwzOCBAQCBzdHJ1Y3Qgc2dfdGFibGUgKmRtYV9idWZfbWFwX2F0dGFjaG1lbnQoc3Ry
dWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAogCQlyZXR1cm4gYXR0YWNoLT5zZ3Q7CiAJ
fQogCisJaWYgKGRtYV9idWZfYXR0YWNobWVudF9pc19keW5hbWljKGF0dGFjaCkpIHsKKwkJcmVz
ZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsKKworCQkv
KgorCQkgKiBNYXBwaW5nIGEgRE1BLWJ1ZiBjYW4gdHJpZ2dlciBpdHMgaW52YWxpZGF0aW9uLCBw
cmV2ZW50CisJCSAqIHNlbmRpbmcgdGhpcyBldmVudCB0byB0aGUgY2FsbGVyIGJ5IHRlbXBvcmFy
eSByZW1vdmluZworCQkgKiB0aGlzIGF0dGFjaG1lbnQgZnJvbSB0aGUgbGlzdC4KKwkJICovCisJ
CWxpc3RfZGVsKCZhdHRhY2gtPm5vZGUpOworCisJfSBlbHNlIGlmIChkbWFfYnVmX2lzX2R5bmFt
aWMoYXR0YWNoLT5kbWFidWYpKSB7CisJCXJlc2VydmF0aW9uX29iamVjdF9sb2NrKGF0dGFjaC0+
ZG1hYnVmLT5yZXN2LCBOVUxMKTsKKwkJciA9IGRtYV9idWZfcGluKGF0dGFjaCk7CisJCWlmIChy
KSB7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGF0dGFjaC0+ZG1hYnVmLT5yZXN2KTsK
KwkJCXJldHVybiBFUlJfUFRSKHIpOworCQl9CisJfQorCiAJc2dfdGFibGUgPSBhdHRhY2gtPmRt
YWJ1Zi0+b3BzLT5tYXBfZG1hX2J1ZihhdHRhY2gsIGRpcmVjdGlvbik7CiAJaWYgKCFzZ190YWJs
ZSkKIAkJc2dfdGFibGUgPSBFUlJfUFRSKC1FTk9NRU0pOwogCisJaWYgKGRtYV9idWZfYXR0YWNo
bWVudF9pc19keW5hbWljKGF0dGFjaCkpIHsKKwkJbGlzdF9hZGQoJmF0dGFjaC0+bm9kZSwgJmF0
dGFjaC0+ZG1hYnVmLT5hdHRhY2htZW50cyk7CisKKwl9IGVsc2UgaWYgKGRtYV9idWZfaXNfZHlu
YW1pYyhhdHRhY2gtPmRtYWJ1ZikpIHsKKwkJaWYgKElTX0VSUihzZ190YWJsZSkpCisJCQlkbWFf
YnVmX3VucGluKGF0dGFjaCk7CisJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYXR0YWNoLT5k
bWFidWYtPnJlc3YpOworCX0KKwogCWlmICghSVNfRVJSKHNnX3RhYmxlKSAmJiBhdHRhY2gtPmRt
YWJ1Zi0+b3BzLT5jYWNoZV9zZ3RfbWFwcGluZykgewogCQlhdHRhY2gtPnNndCA9IHNnX3RhYmxl
OwogCQlhdHRhY2gtPmRpciA9IGRpcmVjdGlvbjsKQEAgLTY4MSwxMCArODI0LDQxIEBAIHZvaWQg
ZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aCwKIAlpZiAoYXR0YWNoLT5zZ3QgPT0gc2dfdGFibGUpCiAJCXJldHVybjsKIAorCWlmIChkbWFf
YnVmX2F0dGFjaG1lbnRfaXNfZHluYW1pYyhhdHRhY2gpKQorCQlyZXNlcnZhdGlvbl9vYmplY3Rf
YXNzZXJ0X2hlbGQoYXR0YWNoLT5kbWFidWYtPnJlc3YpOworCWVsc2UgaWYgKGRtYV9idWZfaXNf
ZHluYW1pYyhhdHRhY2gtPmRtYWJ1ZikpCisJCXJlc2VydmF0aW9uX29iamVjdF9sb2NrKGF0dGFj
aC0+ZG1hYnVmLT5yZXN2LCBOVUxMKTsKKwogCWF0dGFjaC0+ZG1hYnVmLT5vcHMtPnVubWFwX2Rt
YV9idWYoYXR0YWNoLCBzZ190YWJsZSwgZGlyZWN0aW9uKTsKKworCWlmIChkbWFfYnVmX2lzX2R5
bmFtaWMoYXR0YWNoLT5kbWFidWYpICYmCisJICAgICFkbWFfYnVmX2F0dGFjaG1lbnRfaXNfZHlu
YW1pYyhhdHRhY2gpKSB7CisJCWRtYV9idWZfdW5waW4oYXR0YWNoKTsKKwkJcmVzZXJ2YXRpb25f
b2JqZWN0X3VubG9jayhhdHRhY2gtPmRtYWJ1Zi0+cmVzdik7CisJfQogfQogRVhQT1JUX1NZTUJP
TF9HUEwoZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50KTsKIAorLyoqCisgKiBkbWFfYnVmX2ludmFs
aWRhdGVfbWFwcGluZ3MgLSBpbnZhbGlkYXRlIGFsbCBtYXBwaW5ncyBvZiB0aGlzIGRtYV9idWYK
KyAqCisgKiBAZG1hYnVmOglbaW5dCWJ1ZmZlciB3aGljaCBtYXBwaW5ncyBzaG91bGQgYmUgaW52
YWxpZGF0ZWQKKyAqCisgKiBJbmZvcm1zIGFsbCBhdHRhY2htZW5zdCB0aGF0IHRoZXkgbmVlZCB0
byBkZXN0cm95IGFuZCByZWNyZWF0ZWQgYWxsIHRoZWlyCisgKiBtYXBwaW5ncy4KKyAqLwordm9p
ZCBkbWFfYnVmX2ludmFsaWRhdGVfbWFwcGluZ3Moc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sK
KwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7CisKKwlyZXNlcnZhdGlvbl9vYmpl
Y3RfYXNzZXJ0X2hlbGQoZG1hYnVmLT5yZXN2KTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnkoYXR0
YWNoLCAmZG1hYnVmLT5hdHRhY2htZW50cywgbm9kZSkKKwkJaWYgKGF0dGFjaC0+aW1wb3J0ZXJf
b3BzICYmIGF0dGFjaC0+aW1wb3J0ZXJfb3BzLT5pbnZhbGlkYXRlKQorCQkJYXR0YWNoLT5pbXBv
cnRlcl9vcHMtPmludmFsaWRhdGUoYXR0YWNoKTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKGRtYV9i
dWZfaW52YWxpZGF0ZV9tYXBwaW5ncyk7CisKIC8qKgogICogRE9DOiBjcHUgYWNjZXNzCiAgKgpA
QCAtMTA5NywxMCArMTI3MSwxMiBAQCBzdGF0aWMgaW50IGRtYV9idWZfZGVidWdfc2hvdyhzdHJ1
Y3Qgc2VxX2ZpbGUgKnMsIHZvaWQgKnVudXNlZCkKIAkJc2VxX3B1dHMocywgIlx0QXR0YWNoZWQg
RGV2aWNlczpcbiIpOwogCQlhdHRhY2hfY291bnQgPSAwOwogCisJCXJlc2VydmF0aW9uX29iamVj
dF9sb2NrKGJ1Zl9vYmotPnJlc3YsIE5VTEwpOwogCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGF0dGFj
aF9vYmosICZidWZfb2JqLT5hdHRhY2htZW50cywgbm9kZSkgewogCQkJc2VxX3ByaW50ZihzLCAi
XHQlc1xuIiwgZGV2X25hbWUoYXR0YWNoX29iai0+ZGV2KSk7CiAJCQlhdHRhY2hfY291bnQrKzsK
IAkJfQorCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGJ1Zl9vYmotPnJlc3YpOwogCiAJCXNl
cV9wcmludGYocywgIlRvdGFsICVkIGRldmljZXMgYXR0YWNoZWRcblxuIiwKIAkJCQlhdHRhY2hf
Y291bnQpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9kbWEtYnVmLmggYi9pbmNsdWRlL2xp
bnV4L2RtYS1idWYuaAppbmRleCA0NWI5NzY3ZTY3ZWMuLjUzMDlmMWNlYWVmZSAxMDA2NDQKLS0t
IGEvaW5jbHVkZS9saW51eC9kbWEtYnVmLmgKKysrIGIvaW5jbHVkZS9saW51eC9kbWEtYnVmLmgK
QEAgLTk5LDE0ICs5OSw0MCBAQCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgewogCSAqLwogCXZvaWQgKCpk
ZXRhY2gpKHN0cnVjdCBkbWFfYnVmICosIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKik7CiAK
KwkvKioKKwkgKiBAcGluOgorCSAqCisJICogVGhpcyBpcyBjYWxsZWQgYnkgZG1hX2J1Zl9waW4g
YW5kIGxldHMgdGhlIGV4cG9ydGVyIGtub3cgdGhhdCB0aGUKKwkgKiBETUEtYnVmIGNhbid0IGJl
IG1vdmVkIGFueSBtb3JlLgorCSAqCisJICogVGhpcyBpcyBjYWxsZWQgd2l0aCB0aGUgZG1hYnVm
LT5yZXN2IG9iamVjdCBsb2NrZWQuCisJICoKKwkgKiBUaGlzIGNhbGxiYWNrIGlzIG9wdGlvbmFs
LgorCSAqCisJICogUmV0dXJuczoKKwkgKgorCSAqIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJy
b3IgY29kZSBvbiBmYWlsdXJlLgorCSAqLworCWludCAoKnBpbikoc3RydWN0IGRtYV9idWZfYXR0
YWNobWVudCAqKTsKKworCS8qKgorCSAqIEB1bnBpbjoKKwkgKgorCSAqIFRoaXMgaXMgY2FsbGVk
IGJ5IGRtYV9idWZfdW5waW4gYW5kIGxldHMgdGhlIGV4cG9ydGVyIGtub3cgdGhhdCB0aGUKKwkg
KiBETUEtYnVmIGNhbiBiZSBtb3ZlZCBhZ2Fpbi4KKwkgKgorCSAqIFRoaXMgaXMgY2FsbGVkIHdp
dGggdGhlIGRtYWJ1Zi0+cmVzdiBvYmplY3QgbG9ja2VkLgorCSAqCisJICogVGhpcyBjYWxsYmFj
ayBpcyBvcHRpb25hbC4KKwkgKi8KKwl2b2lkICgqdW5waW4pKHN0cnVjdCBkbWFfYnVmX2F0dGFj
aG1lbnQgKik7CisKIAkvKioKIAkgKiBAbWFwX2RtYV9idWY6CiAJICoKIAkgKiBUaGlzIGlzIGNh
bGxlZCBieSBkbWFfYnVmX21hcF9hdHRhY2htZW50KCkgYW5kIGlzIHVzZWQgdG8gbWFwIGEKIAkg
KiBzaGFyZWQgJmRtYV9idWYgaW50byBkZXZpY2UgYWRkcmVzcyBzcGFjZSwgYW5kIGl0IGlzIG1h
bmRhdG9yeS4gSXQKLQkgKiBjYW4gb25seSBiZSBjYWxsZWQgaWYgQGF0dGFjaCBoYXMgYmVlbiBj
YWxsZWQgc3VjY2Vzc2Z1bGx5LiBUaGlzCi0JICogZXNzZW50aWFsbHkgcGlucyB0aGUgRE1BIGJ1
ZmZlciBpbnRvIHBsYWNlLCBhbmQgaXQgY2Fubm90IGJlIG1vdmVkCi0JICogYW55IG1vcmUKKwkg
KiBjYW4gb25seSBiZSBjYWxsZWQgaWYgQGF0dGFjaCBoYXMgYmVlbiBjYWxsZWQgc3VjY2Vzc2Z1
bGx5LgogCSAqCiAJICogVGhpcyBjYWxsIG1heSBzbGVlcCwgZS5nLiB3aGVuIHRoZSBiYWNraW5n
IHN0b3JhZ2UgZmlyc3QgbmVlZHMgdG8gYmUKIAkgKiBhbGxvY2F0ZWQsIG9yIG1vdmVkIHRvIGEg
bG9jYXRpb24gc3VpdGFibGUgZm9yIGFsbCBjdXJyZW50bHkgYXR0YWNoZWQKQEAgLTEyNyw2ICsx
NTMsOSBAQCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgewogCSAqIGFueSBvdGhlciBraW5kIG9mIHNoYXJp
bmcgdGhhdCB0aGUgZXhwb3J0ZXIgbWlnaHQgd2lzaCB0byBtYWtlCiAJICogYXZhaWxhYmxlIHRv
IGJ1ZmZlci11c2Vycy4KIAkgKgorCSAqIFRoaXMgaXMgYWx3YXlzIGNhbGxlZCB3aXRoIHRoZSBk
bWFidWYtPnJlc3Ygb2JqZWN0IGxvY2tlZCB3aGVuCisJICogdGhlIHBpbi91bnBpbiBjYWxsYmFj
a3MgYXJlIGltcGxlbWVudGVkLgorCSAqCiAJICogUmV0dXJuczoKIAkgKgogCSAqIEEgJnNnX3Rh
YmxlIHNjYXR0ZXIgbGlzdCBvZiBvciB0aGUgYmFja2luZyBzdG9yYWdlIG9mIHRoZSBETUEgYnVm
ZmVyLApAQCAtMTQ0LDkgKzE3Myw2IEBAIHN0cnVjdCBkbWFfYnVmX29wcyB7CiAJICoKIAkgKiBU
aGlzIGlzIGNhbGxlZCBieSBkbWFfYnVmX3VubWFwX2F0dGFjaG1lbnQoKSBhbmQgc2hvdWxkIHVu
bWFwIGFuZAogCSAqIHJlbGVhc2UgdGhlICZzZ190YWJsZSBhbGxvY2F0ZWQgaW4gQG1hcF9kbWFf
YnVmLCBhbmQgaXQgaXMgbWFuZGF0b3J5LgotCSAqIEl0IHNob3VsZCBhbHNvIHVucGluIHRoZSBi
YWNraW5nIHN0b3JhZ2UgaWYgdGhpcyBpcyB0aGUgbGFzdCBtYXBwaW5nCi0JICogb2YgdGhlIERN
QSBidWZmZXIsIGl0IHRoZSBleHBvcnRlciBzdXBwb3J0cyBiYWNraW5nIHN0b3JhZ2UKLQkgKiBt
aWdyYXRpb24uCiAJICovCiAJdm9pZCAoKnVubWFwX2RtYV9idWYpKHN0cnVjdCBkbWFfYnVmX2F0
dGFjaG1lbnQgKiwKIAkJCSAgICAgIHN0cnVjdCBzZ190YWJsZSAqLApAQCAtMzExLDYgKzMzNywz
NSBAQCBzdHJ1Y3QgZG1hX2J1ZiB7CiAJfSBjYl9leGNsLCBjYl9zaGFyZWQ7CiB9OwogCisvKioK
KyAqIHN0cnVjdCBkbWFfYnVmX2F0dGFjaF9vcHMgLSBpbXBvcnRlciBvcGVyYXRpb25zIGZvciBh
biBhdHRhY2htZW50CisgKiBAaW52YWxpZGF0ZTogW29wdGlvbmFsXSBpbnZhbGlkYXRlIGFsbCBt
YXBwaW5ncyBtYWRlIHVzaW5nIHRoaXMgYXR0YWNobWVudC4KKyAqCisgKiBBdHRhY2htZW50IG9w
ZXJhdGlvbnMgaW1wbGVtZW50ZWQgYnkgdGhlIGltcG9ydGVyLgorICovCitzdHJ1Y3QgZG1hX2J1
Zl9hdHRhY2hfb3BzIHsKKwkvKioKKwkgKiBAaW52YWxpZGF0ZToKKwkgKgorCSAqIElmIHRoZSBp
bnZhbGlkYXRlIGNhbGxiYWNrIGlzIHByb3ZpZGVkIHRoZSBmcmFtZXdvcmsgY2FuIGF2b2lkCisJ
ICogcGlubmluZyB0aGUgYmFja2luZyBzdG9yZSB3aGlsZSBtYXBwaW5ncyBleGlzdHMuCisJICoK
KwkgKiBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aXRoIHRoZSBsb2NrIG9mIHRoZSByZXNlcnZh
dGlvbiBvYmplY3QKKwkgKiBhc3NvY2lhdGVkIHdpdGggdGhlIGRtYV9idWYgaGVsZCBhbmQgdGhl
IG1hcHBpbmcgZnVuY3Rpb24gbXVzdCBiZQorCSAqIGNhbGxlZCB3aXRoIHRoaXMgbG9jayBoZWxk
IGFzIHdlbGwuIFRoaXMgbWFrZXMgc3VyZSB0aGF0IG5vIG1hcHBpbmcKKwkgKiBpcyBjcmVhdGVk
IGNvbmN1cnJlbnRseSB3aXRoIGFuIG9uZ29pbmcgaW52YWxpZGF0aW9uLgorCSAqCisJICogQWZ0
ZXIgdGhlIGNhbGxiYWNrIGFsbCBleGlzdGluZyBtYXBwaW5ncyBhcmUgc3RpbGwgdmFsaWQgdW50
aWwgYWxsCisJICogZmVuY2VzIGluIHRoZSBkbWFfYnVmcyByZXNlcnZhdGlvbiBvYmplY3QgYXJl
IHNpZ25hbGVkLiBBZnRlciBnZXR0aW5nIGFuCisJICogaW52YWxpZGF0aW9uIGNhbGxiYWNrIGFs
bCBtYXBwaW5ncyBzaG91bGQgYmUgZGVzdHJveWVkIGJ5IHRoZSBpbXBvcnRlciB1c2luZworCSAq
IHRoZSBub3JtYWwgZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50KCkgZnVuY3Rpb24gYXMgc29vbiBh
cyBwb3NzaWJsZS4KKwkgKgorCSAqIE5ldyBtYXBwaW5ncyBjYW4gYmUgY3JlYXRlZCBpbW1lZGlh
dGVseSwgYnV0IGNhbid0IGJlIHVzZWQgYmVmb3JlIHRoZQorCSAqIGV4Y2x1c2l2ZSBmZW5jZSBp
biB0aGUgZG1hX2J1ZnMgcmVzZXJ2YXRpb24gb2JqZWN0IGlzIHNpZ25hbGVkLgorCSAqLworCXZv
aWQgKCppbnZhbGlkYXRlKShzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gpOworfTsK
KwogLyoqCiAgKiBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50IC0gaG9sZHMgZGV2aWNlLWJ1ZmZl
ciBhdHRhY2htZW50IGRhdGEKICAqIEBkbWFidWY6IGJ1ZmZlciBmb3IgdGhpcyBhdHRhY2htZW50
LgpAQCAtMzE5LDYgKzM3NCw4IEBAIHN0cnVjdCBkbWFfYnVmIHsKICAqIEBzZ3Q6IGNhY2hlZCBt
YXBwaW5nLgogICogQGRpcjogZGlyZWN0aW9uIG9mIGNhY2hlZCBtYXBwaW5nLgogICogQHByaXY6
IGV4cG9ydGVyIHNwZWNpZmljIGF0dGFjaG1lbnQgZGF0YS4KKyAqIEBpbXBvcnRlcl9vcHM6IGlt
cG9ydGVyIG9wZXJhdGlvbnMgZm9yIHRoaXMgYXR0YWNobWVudC4KKyAqIEBpbXBvcnRlcl9wcml2
OiBpbXBvcnRlciBzcGVjaWZpYyBhdHRhY2htZW50IGRhdGEuCiAgKgogICogVGhpcyBzdHJ1Y3R1
cmUgaG9sZHMgdGhlIGF0dGFjaG1lbnQgaW5mb3JtYXRpb24gYmV0d2VlbiB0aGUgZG1hX2J1ZiBi
dWZmZXIKICAqIGFuZCBpdHMgdXNlciBkZXZpY2UocykuIFRoZSBsaXN0IGNvbnRhaW5zIG9uZSBh
dHRhY2htZW50IHN0cnVjdCBwZXIgZGV2aWNlCkBAIC0zMzYsNiArMzkzLDkgQEAgc3RydWN0IGRt
YV9idWZfYXR0YWNobWVudCB7CiAJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CiAJZW51bSBkbWFfZGF0
YV9kaXJlY3Rpb24gZGlyOwogCXZvaWQgKnByaXY7CisKKwljb25zdCBzdHJ1Y3QgZG1hX2J1Zl9h
dHRhY2hfb3BzICppbXBvcnRlcl9vcHM7CisJdm9pZCAqaW1wb3J0ZXJfcHJpdjsKIH07CiAKIC8q
KgpAQCAtMzg2LDEwICs0NDYsNDIgQEAgc3RhdGljIGlubGluZSB2b2lkIGdldF9kbWFfYnVmKHN0
cnVjdCBkbWFfYnVmICpkbWFidWYpCiAJZ2V0X2ZpbGUoZG1hYnVmLT5maWxlKTsKIH0KIAorLyoq
CisgKiBkbWFfYnVmX2lzX2R5bmFtaWMgLSBjaGVjayBpZiBhIERNQS1idWYgdXNlcyBkeW5hbWlj
IG1hcHBpbmdzLgorICogQGRtYWJ1ZjogdGhlIERNQS1idWYgdG8gY2hlY2sKKyAqCisgKiBSZXR1
cm5zIHRydWUgaWYgYSBETUEtYnVmIGV4cG9ydGVyIHdhbnRzIHRvIGNyZWF0ZSBkeW5hbWljIHNn
IHRhYmxlIG1hcHBpbmdzCisgKiBmb3IgZWFjaCBhdHRhY2htZW50LiBGYWxzZSBpZiBvbmx5IGEg
c2luZ2xlIHN0YXRpYyBzZyB0YWJsZSBzaG91bGQgYmUgdXNlZC4KKyAqLworc3RhdGljIGlubGlu
ZSBib29sIGRtYV9idWZfaXNfZHluYW1pYyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmKQoreworCXJl
dHVybiAhIWRtYWJ1Zi0+b3BzLT5waW47Cit9CisKKy8qKgorICogZG1hX2J1Zl9hdHRhY2htZW50
X2lzX2R5bmFtaWMgLSBjaGVjayBpZiBhIERNQS1idWYgYXR0YWNobWVudCB1c2VzIGR5bmFtaWMK
KyAqIG1hcHBpbnNnCisgKiBAYXR0YWNoOiB0aGUgRE1BLWJ1ZiBhdHRhY2htZW50IHRvIGNoZWNr
CisgKgorICogUmV0dXJucyB0cnVlIGlmIGEgRE1BLWJ1ZiBpbXBvcnRlciB3YW50cyB0byB1c2Ug
ZHluYW1pYyBzZyB0YWJsZSBtYXBwaW5ncyBhbmQKKyAqIGNhbGxzIHRoZSBtYXAvdW5tYXAgZnVu
Y3Rpb25zIHdpdGggdGhlIHJlc2VydmF0aW9uIG9iamVjdCBsb2NrZWQuCisgKi8KK3N0YXRpYyBp
bmxpbmUgYm9vbAorZG1hX2J1Zl9hdHRhY2htZW50X2lzX2R5bmFtaWMoc3RydWN0IGRtYV9idWZf
YXR0YWNobWVudCAqYXR0YWNoKQoreworCXJldHVybiBhdHRhY2gtPmltcG9ydGVyX29wcyAmJiBh
dHRhY2gtPmltcG9ydGVyX29wcy0+aW52YWxpZGF0ZTsKK30KKwogc3RydWN0IGRtYV9idWZfYXR0
YWNobWVudCAqZG1hX2J1Zl9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKLQkJCQkJCQlz
dHJ1Y3QgZGV2aWNlICpkZXYpOworCQkJCQkgIHN0cnVjdCBkZXZpY2UgKmRldik7CitzdHJ1Y3Qg
ZG1hX2J1Zl9hdHRhY2htZW50ICoKK2RtYV9idWZfZHluYW1pY19hdHRhY2goc3RydWN0IGRtYV9i
dWYgKmRtYWJ1Ziwgc3RydWN0IGRldmljZSAqZGV2LAorCQkgICAgICAgY29uc3Qgc3RydWN0IGRt
YV9idWZfYXR0YWNoX29wcyAqaW1wb3J0ZXJfb3BzLAorCQkgICAgICAgdm9pZCAqaW1wb3J0ZXJf
cHJpdik7CiB2b2lkIGRtYV9idWZfZGV0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCi0JCQkJ
c3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqZG1hYnVmX2F0dGFjaCk7CisJCSAgICBzdHJ1Y3Qg
ZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gpOworaW50IGRtYV9idWZfcGluKHN0cnVjdCBkbWFf
YnVmX2F0dGFjaG1lbnQgKmF0dGFjaCk7Cit2b2lkIGRtYV9idWZfdW5waW4oc3RydWN0IGRtYV9i
dWZfYXR0YWNobWVudCAqYXR0YWNoKTsKIAogc3RydWN0IGRtYV9idWYgKmRtYV9idWZfZXhwb3J0
KGNvbnN0IHN0cnVjdCBkbWFfYnVmX2V4cG9ydF9pbmZvICpleHBfaW5mbyk7CiAKQEAgLTQwMSw2
ICs0OTMsNyBAQCBzdHJ1Y3Qgc2dfdGFibGUgKmRtYV9idWZfbWFwX2F0dGFjaG1lbnQoc3RydWN0
IGRtYV9idWZfYXR0YWNobWVudCAqLAogCQkJCQllbnVtIGRtYV9kYXRhX2RpcmVjdGlvbik7CiB2
b2lkIGRtYV9idWZfdW5tYXBfYXR0YWNobWVudChzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICos
IHN0cnVjdCBzZ190YWJsZSAqLAogCQkJCWVudW0gZG1hX2RhdGFfZGlyZWN0aW9uKTsKK3ZvaWQg
ZG1hX2J1Zl9pbnZhbGlkYXRlX21hcHBpbmdzKHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmKTsKIGlu
dCBkbWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYgKmRtYV9idWYsCiAJCQkg
ICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcik7CiBpbnQgZG1hX2J1Zl9lbmRfY3B1X2Fj
Y2VzcyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiwKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApk
cmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
