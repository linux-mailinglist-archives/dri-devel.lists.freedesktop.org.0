Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2EF91F122E
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 10:31:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B28DC6EC79;
	Wed,  6 Nov 2019 09:31:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6CCE66EC78
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 09:31:28 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 22637B421;
 Wed,  6 Nov 2019 09:31:26 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch,
	christian.koenig@amd.com,
	noralf@tronnes.org
Subject: [PATCH 7/8] drm/fb-helper: Select between fb_{sys,
 cfb}_read() and _write()
Date: Wed,  6 Nov 2019 10:31:20 +0100
Message-Id: <20191106093121.21762-8-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106093121.21762-1-tzimmermann@suse.de>
References: <20191106093121.21762-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

R2VuZXJpYyBmYmRldiBlbXVsYXRpb24gdXNlZCB0byBhY2Nlc3MgZnJhbWVidWZmZXJzIGFzIGlm
IHRoZXkgd2VyZQpsb2NhdGVkIGluIHN5c3RlbSBtZW1vcnkuCgpEZXBlbmRpbmcgb24gdGhlIHdo
ZXRoZXIgdGhlIGZyYW1lYnVmZmVyIGlzIGluIEkvTyBvciBzeXN0ZW0gbWVtb3J5LAp0aGUgZmJk
ZXYgZW11bGF0aW9uIG5vdyBjYWxscyB0aGUgY29ycmVjdCBmdW5jdGlvbnMgZm9yIGFjY2Vzc2lu
ZyBlYWNoLgpUaGlzIGNoYW5nZSBhbGxvd3MgdG8gc3VwcG9ydCBnZW5lcmljIGZiZGV2IGVtdWxh
dGlvbiBvbiBzeXN0ZW1zIHRoYXQKdHJlYXQgYm90aCBtZW1vcnkgYXJlYXMgZGlmZmVyZW50bHku
CgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2ZiX2hlbHBlci5jIHwgMTEwICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tCiBpbmNsdWRlL2RybS9kcm1fZmJfaGVscGVyLmggICAgIHwgIDE0
ICsrKysKIDIgZmlsZXMgY2hhbmdlZCwgMTE4IGluc2VydGlvbnMoKyksIDYgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9mYl9oZWxwZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZmJfaGVscGVyLmMKaW5kZXggZWZmNzVmYWQ3Y2FiLi4xNzRlNmQ5NzIyM2Yg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZmJfaGVscGVyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9mYl9oZWxwZXIuYwpAQCAtNzcxLDYgKzc3MSw0NSBAQCB2b2lkIGRybV9m
Yl9oZWxwZXJfc3lzX2ltYWdlYmxpdChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywKIH0KIEVYUE9SVF9T
WU1CT0woZHJtX2ZiX2hlbHBlcl9zeXNfaW1hZ2VibGl0KTsKIAorLyoqCisgKiBkcm1fZmJfaGVs
cGVyX2NmYl9yZWFkIC0gd3JhcHBlciBhcm91bmQgZmJfY2ZiX3JlYWQKKyAqIEBpbmZvOiBmYl9p
bmZvIHN0cnVjdCBwb2ludGVyCisgKiBAYnVmOiB1c2Vyc3BhY2UgYnVmZmVyIHRvIHJlYWQgZnJv
bSBmcmFtZWJ1ZmZlciBtZW1vcnkKKyAqIEBjb3VudDogbnVtYmVyIG9mIGJ5dGVzIHRvIHJlYWQg
ZnJvbSBmcmFtZWJ1ZmZlciBtZW1vcnkKKyAqIEBwcG9zOiByZWFkIG9mZnNldCB3aXRoaW4gZnJh
bWVidWZmZXIgbWVtb3J5CisgKgorICogQSB3cmFwcGVyIGFyb3VuZCBmYl9jZmJfcmVhZCBpbXBs
ZW1lbnRlZCBieSBmYmRldiBjb3JlCisgKi8KK3NzaXplX3QgZHJtX2ZiX2hlbHBlcl9jZmJfcmVh
ZChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgY2hhciBfX3VzZXIgKmJ1ZiwKKwkJCSAgICAgICBzaXpl
X3QgY291bnQsIGxvZmZfdCAqcHBvcykKK3sKKwlyZXR1cm4gZmJfY2ZiX3JlYWQoaW5mbywgYnVm
LCBjb3VudCwgcHBvcyk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9mYl9oZWxwZXJfY2ZiX3JlYWQp
OworCisvKioKKyAqIGRybV9mYl9oZWxwZXJfY2ZiX3dyaXRlIC0gd3JhcHBlciBhcm91bmQgZmJf
Y2ZiX3dyaXRlCisgKiBAaW5mbzogZmJfaW5mbyBzdHJ1Y3QgcG9pbnRlcgorICogQGJ1ZjogdXNl
cnNwYWNlIGJ1ZmZlciB0byB3cml0ZSB0byBmcmFtZWJ1ZmZlciBtZW1vcnkKKyAqIEBjb3VudDog
bnVtYmVyIG9mIGJ5dGVzIHRvIHdyaXRlIHRvIGZyYW1lYnVmZmVyIG1lbW9yeQorICogQHBwb3M6
IHdyaXRlIG9mZnNldCB3aXRoaW4gZnJhbWVidWZmZXIgbWVtb3J5CisgKgorICogQSB3cmFwcGVy
IGFyb3VuZCBmYl9jZmJfd3JpdGUgaW1wbGVtZW50ZWQgYnkgZmJkZXYgY29yZQorICovCitzc2l6
ZV90IGRybV9mYl9oZWxwZXJfY2ZiX3dyaXRlKHN0cnVjdCBmYl9pbmZvICppbmZvLCBjb25zdCBj
aGFyIF9fdXNlciAqYnVmLAorCQkJCXNpemVfdCBjb3VudCwgbG9mZl90ICpwcG9zKQoreworCXNz
aXplX3QgcmV0OworCisJcmV0ID0gZmJfY2ZiX3dyaXRlKGluZm8sIGJ1ZiwgY291bnQsIHBwb3Mp
OworCWlmIChyZXQgPiAwKQorCQlkcm1fZmJfaGVscGVyX2RpcnR5KGluZm8sIDAsIDAsIGluZm8t
PnZhci54cmVzLAorCQkJCSAgICBpbmZvLT52YXIueXJlcyk7CisKKwlyZXR1cm4gcmV0OworfQor
RVhQT1JUX1NZTUJPTChkcm1fZmJfaGVscGVyX2NmYl93cml0ZSk7CisKIC8qKgogICogZHJtX2Zi
X2hlbHBlcl9jZmJfZmlsbHJlY3QgLSB3cmFwcGVyIGFyb3VuZCBjZmJfZmlsbHJlY3QKICAqIEBp
bmZvOiBmYmRldiByZWdpc3RlcmVkIGJ5IHRoZSBoZWxwZXIKQEAgLTIxMjIsNiArMjE2MSw1OSBA
QCBzdGF0aWMgaW50IGRybV9mYmRldl9mYl9tbWFwKHN0cnVjdCBmYl9pbmZvICppbmZvLCBzdHJ1
Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKIAkJcmV0dXJuIC1FTk9ERVY7CiB9CiAKK3N0YXRpYyBz
c2l6ZV90IGRybV9mYmRldl9mYl9yZWFkKHN0cnVjdCBmYl9pbmZvICppbmZvLCBjaGFyIF9fdXNl
ciAqYnVmLAorCQkJCSBzaXplX3QgY291bnQsIGxvZmZfdCAqcHBvcykKK3sKKwlzdHJ1Y3QgZHJt
X2ZiX2hlbHBlciAqZmJfaGVscGVyID0gaW5mby0+cGFyOworCisJaWYgKGZiX2hlbHBlci0+c2Ny
ZWVuX2J1ZmZlcl9pc19pb21lbSkKKwkJcmV0dXJuIGRybV9mYl9oZWxwZXJfY2ZiX3JlYWQoaW5m
bywgYnVmLCBjb3VudCwgcHBvcyk7CisJcmV0dXJuIGRybV9mYl9oZWxwZXJfc3lzX3JlYWQoaW5m
bywgYnVmLCBjb3VudCwgcHBvcyk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGRybV9mYmRldl9mYl93
cml0ZShzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgY29uc3QgY2hhciBfX3VzZXIgKmJ1ZiwKKwkJCQkg
IHNpemVfdCBjb3VudCwgbG9mZl90ICpwcG9zKQoreworCXN0cnVjdCBkcm1fZmJfaGVscGVyICpm
Yl9oZWxwZXIgPSBpbmZvLT5wYXI7CisKKwlpZiAoZmJfaGVscGVyLT5zY3JlZW5fYnVmZmVyX2lz
X2lvbWVtKQorCQlyZXR1cm4gZHJtX2ZiX2hlbHBlcl9jZmJfd3JpdGUoaW5mbywgYnVmLCBjb3Vu
dCwgcHBvcyk7CisJcmV0dXJuIGRybV9mYl9oZWxwZXJfc3lzX3dyaXRlKGluZm8sIGJ1ZiwgY291
bnQsIHBwb3MpOworfQorCitzdGF0aWMgdm9pZCBkcm1fZmJkZXZfZmJfZmlsbHJlY3Qoc3RydWN0
IGZiX2luZm8gKmluZm8sCisJCQkJICBjb25zdCBzdHJ1Y3QgZmJfZmlsbHJlY3QgKnJlY3QpCit7
CisJc3RydWN0IGRybV9mYl9oZWxwZXIgKmZiX2hlbHBlciA9IGluZm8tPnBhcjsKKworCWlmIChm
Yl9oZWxwZXItPnNjcmVlbl9idWZmZXJfaXNfaW9tZW0pCisJCWRybV9mYl9oZWxwZXJfY2ZiX2Zp
bGxyZWN0KGluZm8sIHJlY3QpOworCWVsc2UKKwkJZHJtX2ZiX2hlbHBlcl9zeXNfZmlsbHJlY3Qo
aW5mbywgcmVjdCk7Cit9CisKK3N0YXRpYyB2b2lkIGRybV9mYmRldl9mYl9jb3B5YXJlYShzdHJ1
Y3QgZmJfaW5mbyAqaW5mbywKKwkJCQkgIGNvbnN0IHN0cnVjdCBmYl9jb3B5YXJlYSAqcmVnaW9u
KQoreworCXN0cnVjdCBkcm1fZmJfaGVscGVyICpmYl9oZWxwZXIgPSBpbmZvLT5wYXI7CisKKwlp
ZiAoZmJfaGVscGVyLT5zY3JlZW5fYnVmZmVyX2lzX2lvbWVtKQorCQlkcm1fZmJfaGVscGVyX2Nm
Yl9jb3B5YXJlYShpbmZvLCByZWdpb24pOworCWVsc2UKKwkJZHJtX2ZiX2hlbHBlcl9zeXNfY29w
eWFyZWEoaW5mbywgcmVnaW9uKTsKK30KKworc3RhdGljIHZvaWQgZHJtX2ZiZGV2X2ZiX2ltYWdl
YmxpdChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywKKwkJCQkgICBjb25zdCBzdHJ1Y3QgZmJfaW1hZ2Ug
KmltYWdlKQoreworCXN0cnVjdCBkcm1fZmJfaGVscGVyICpmYl9oZWxwZXIgPSBpbmZvLT5wYXI7
CisKKwlpZiAoZmJfaGVscGVyLT5zY3JlZW5fYnVmZmVyX2lzX2lvbWVtKQorCQlkcm1fZmJfaGVs
cGVyX2NmYl9pbWFnZWJsaXQoaW5mbywgaW1hZ2UpOworCWVsc2UKKwkJZHJtX2ZiX2hlbHBlcl9z
eXNfaW1hZ2VibGl0KGluZm8sIGltYWdlKTsKK30KKwogc3RhdGljIHN0cnVjdCBmYl9vcHMgZHJt
X2ZiZGV2X2ZiX29wcyA9IHsKIAkub3duZXIJCT0gVEhJU19NT0RVTEUsCiAJRFJNX0ZCX0hFTFBF
Ul9ERUZBVUxUX09QUywKQEAgLTIxMjksMTEgKzIyMjEsMTEgQEAgc3RhdGljIHN0cnVjdCBmYl9v
cHMgZHJtX2ZiZGV2X2ZiX29wcyA9IHsKIAkuZmJfcmVsZWFzZQk9IGRybV9mYmRldl9mYl9yZWxl
YXNlLAogCS5mYl9kZXN0cm95CT0gZHJtX2ZiZGV2X2ZiX2Rlc3Ryb3ksCiAJLmZiX21tYXAJPSBk
cm1fZmJkZXZfZmJfbW1hcCwKLQkuZmJfcmVhZAk9IGRybV9mYl9oZWxwZXJfc3lzX3JlYWQsCi0J
LmZiX3dyaXRlCT0gZHJtX2ZiX2hlbHBlcl9zeXNfd3JpdGUsCi0JLmZiX2ZpbGxyZWN0CT0gZHJt
X2ZiX2hlbHBlcl9zeXNfZmlsbHJlY3QsCi0JLmZiX2NvcHlhcmVhCT0gZHJtX2ZiX2hlbHBlcl9z
eXNfY29weWFyZWEsCi0JLmZiX2ltYWdlYmxpdAk9IGRybV9mYl9oZWxwZXJfc3lzX2ltYWdlYmxp
dCwKKwkuZmJfcmVhZAk9IGRybV9mYmRldl9mYl9yZWFkLAorCS5mYl93cml0ZQk9IGRybV9mYmRl
dl9mYl93cml0ZSwKKwkuZmJfZmlsbHJlY3QJPSBkcm1fZmJkZXZfZmJfZmlsbHJlY3QsCisJLmZi
X2NvcHlhcmVhCT0gZHJtX2ZiZGV2X2ZiX2NvcHlhcmVhLAorCS5mYl9pbWFnZWJsaXQJPSBkcm1f
ZmJkZXZfZmJfaW1hZ2VibGl0LAogfTsKIAogc3RhdGljIHN0cnVjdCBmYl9kZWZlcnJlZF9pbyBk
cm1fZmJkZXZfZGVmaW8gPSB7CkBAIC0yMjA5LDEwICsyMzAxLDE1IEBAIGludCBkcm1fZmJfaGVs
cGVyX2dlbmVyaWNfcHJvYmUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmZiX2hlbHBlciwKIAkJZmJp
LT5zY3JlZW5fYnVmZmVyID0gc2hhZG93OwogCQlmYmktPmZiZGVmaW8gPSAmZHJtX2ZiZGV2X2Rl
ZmlvOwogCisJCS8qIFRoZSBzaGFkb3dmYiBpcyBhbHdheXMgaW4gc3lzdGVtIG1lbW9yeS4gKi8K
KwkJZmJfaGVscGVyLT5zY3JlZW5fYnVmZmVyX2lzX2lvbWVtID0gZmFsc2U7CisKIAkJZmJfZGVm
ZXJyZWRfaW9faW5pdChmYmkpOwogCX0gZWxzZSB7CisJCWJvb2wgaXNfaW9tZW07CisKIAkJLyog
YnVmZmVyIGlzIG1hcHBlZCBmb3IgSFcgZnJhbWVidWZmZXIgKi8KLQkJdmFkZHIgPSBkcm1fY2xp
ZW50X2J1ZmZlcl92bWFwKGZiX2hlbHBlci0+YnVmZmVyLCBOVUxMKTsKKwkJdmFkZHIgPSBkcm1f
Y2xpZW50X2J1ZmZlcl92bWFwKGZiX2hlbHBlci0+YnVmZmVyLCAmaXNfaW9tZW0pOwogCQlpZiAo
SVNfRVJSKHZhZGRyKSkKIAkJCXJldHVybiBQVFJfRVJSKHZhZGRyKTsKIApAQCAtMjIyMyw2ICsy
MzIwLDcgQEAgaW50IGRybV9mYl9oZWxwZXJfZ2VuZXJpY19wcm9iZShzdHJ1Y3QgZHJtX2ZiX2hl
bHBlciAqZmJfaGVscGVyLAogCQkJZmJpLT5maXguc21lbV9zdGFydCA9CiAJCQkJcGFnZV90b19w
aHlzKHZpcnRfdG9fcGFnZShmYmktPnNjcmVlbl9idWZmZXIpKTsKICNlbmRpZgorCQlmYl9oZWxw
ZXItPnNjcmVlbl9idWZmZXJfaXNfaW9tZW0gPSBpc19pb21lbTsKIAl9CiAKIAlyZXR1cm4gMDsK
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9mYl9oZWxwZXIuaCBiL2luY2x1ZGUvZHJtL2Ry
bV9mYl9oZWxwZXIuaAppbmRleCAyMzM4ZTlmOTRhMDMuLmFmY2VhZThkYjRhZiAxMDA2NDQKLS0t
IGEvaW5jbHVkZS9kcm0vZHJtX2ZiX2hlbHBlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9mYl9o
ZWxwZXIuaApAQCAtMTU1LDYgKzE1NSwxNSBAQCBzdHJ1Y3QgZHJtX2ZiX2hlbHBlciB7CiAJICov
CiAJc3RydWN0IGxpc3RfaGVhZCBrZXJuZWxfZmJfbGlzdDsKIAorCS8qKgorCSAqIEBzY3JlZW5f
YnVmZmVyX2lzX2lvbWVtCisJICoKKwkgKiBUcnVlIGlmIGluZm8tPnNjcmVlbl9idWZmZXIgcmVm
ZXJzIHRvIEkvTyBtZW1vcnksIGZhbHNlIG90aGVyd2lzZS4KKwkgKiBEZXBlbmRpbmcgb24gdGhp
cyBmbGFnLCBmYl9vcHMgc2hvdWxkIGVpdGhlciB1c2Ugc3lzIHRvIGNmYgorCSAqIGZ1bmN0aW9u
cy4KKwkgKi8KKwlib29sIHNjcmVlbl9idWZmZXJfaXNfaW9tZW07CisKIAkvKioKIAkgKiBAZGVs
YXllZF9ob3RwbHVnOgogCSAqCkBAIC0yNDgsNiArMjU3LDExIEBAIHZvaWQgZHJtX2ZiX2hlbHBl
cl9zeXNfY29weWFyZWEoc3RydWN0IGZiX2luZm8gKmluZm8sCiB2b2lkIGRybV9mYl9oZWxwZXJf
c3lzX2ltYWdlYmxpdChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywKIAkJCQkgY29uc3Qgc3RydWN0IGZi
X2ltYWdlICppbWFnZSk7CiAKK3NzaXplX3QgZHJtX2ZiX2hlbHBlcl9jZmJfcmVhZChzdHJ1Y3Qg
ZmJfaW5mbyAqaW5mbywgY2hhciBfX3VzZXIgKmJ1ZiwKKwkJCSAgICAgICBzaXplX3QgY291bnQs
IGxvZmZfdCAqcHBvcyk7Citzc2l6ZV90IGRybV9mYl9oZWxwZXJfY2ZiX3dyaXRlKHN0cnVjdCBm
Yl9pbmZvICppbmZvLCBjb25zdCBjaGFyIF9fdXNlciAqYnVmLAorCQkJCXNpemVfdCBjb3VudCwg
bG9mZl90ICpwcG9zKTsKKwogdm9pZCBkcm1fZmJfaGVscGVyX2NmYl9maWxscmVjdChzdHJ1Y3Qg
ZmJfaW5mbyAqaW5mbywKIAkJCQljb25zdCBzdHJ1Y3QgZmJfZmlsbHJlY3QgKnJlY3QpOwogdm9p
ZCBkcm1fZmJfaGVscGVyX2NmYl9jb3B5YXJlYShzdHJ1Y3QgZmJfaW5mbyAqaW5mbywKLS0gCjIu
MjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
