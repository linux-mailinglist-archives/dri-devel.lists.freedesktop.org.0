Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 71143BCD0C
	for <lists+dri-devel@lfdr.de>; Tue, 24 Sep 2019 18:45:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F16746EA65;
	Tue, 24 Sep 2019 16:45:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A9BFA6EA7D
 for <dri-devel@lists.freedesktop.org>; Tue, 24 Sep 2019 16:45:51 +0000 (UTC)
Received: from sasha-vm.mshome.net (c-73-47-72-35.hsd1.nh.comcast.net
 [73.47.72.35])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 87C83217D9;
 Tue, 24 Sep 2019 16:45:50 +0000 (UTC)
From: Sasha Levin <sashal@kernel.org>
To: linux-kernel@vger.kernel.org,
	stable@vger.kernel.org
Subject: [PATCH AUTOSEL 5.2 01/70] drm/vkms: Fix crc worker races
Date: Tue, 24 Sep 2019 12:44:40 -0400
Message-Id: <20190924164549.27058-1-sashal@kernel.org>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
X-stable: review
X-Patchwork-Hint: Ignore
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=kernel.org; s=default; t=1569343551;
 bh=rIKf7LtdZcL+QQJa9NkH9hjNvOfePb4mc/FQ3u++flo=;
 h=From:To:Cc:Subject:Date:From;
 b=vQzK7NxO6DNdqsX2ZBWTqw+IaRr/h7sHhDI6wfYb5CANoNhr9C8P9LnnXkrjIMzye
 uVYVKYwREFbB4mK/Ah0lLcqCigAyJgDxZ/5yQpL18ReSBwpWxEL63tLKsp6DD0sMj1
 pJPeCkngs4V0UfUhA7QXjdTQTyq1h/cAhHsZtem0=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sasha Levin <sashal@kernel.org>, Haneen Mohammed <hamohammed.sa@gmail.com>,
 Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>, dri-devel@lists.freedesktop.org,
 Shayenne Moura <shayenneluzmoura@gmail.com>,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KClsgVXBzdHJlYW0g
Y29tbWl0IDE4ZDA5NTJhODM4YmE1NTk2NTViMGNkOWNmODUwOTdhZDYzZDliY2EgXQoKVGhlIGlz
c3VlIHdlIGhhdmUgaXMgdGhhdCB0aGUgY3JjIHdvcmtlciBtaWdodCBmYWxsIGJlaGluZC4gV2Un
dmUKdHJpZWQgdG8gaGFuZGxlIHRoaXMgYnkgdHJhY2tpbmcgYm90aCB0aGUgZWFybGllc3QgZnJh
bWUgZm9yIHdoaWNoIGl0CnN0aWxsIG5lZWRzIHRvIGNvbXB1dGUgYSBjcmMsIGFuZCB0aGUgbGFz
dCBvbmUuIFBsdXMgd2hlbiB0aGUKY3J0Y19zdGF0ZSBjaGFuZ2VzLCB3ZSBoYXZlIGEgbmV3IHdv
cmsgaXRlbSwgd2hpY2ggYXJlIGFsbCBydW4gaW4Kb3JkZXIgZHVlIHRvIHRoZSBvcmRlcmVkIHdv
cmtxdWV1ZSB3ZSBhbGxvY2F0ZSBmb3IgZWFjaCB2a21zIGNydGMuCgpUcm91YmxlIGlzIHRoZXJl
J3MgYmVlbiBhIGZldyBzbWFsbCBpc3N1ZXMgaW4gdGhlIGN1cnJlbnQgY29kZToKLSB3ZSBuZWVk
IHRvIGNhcHR1cmUgZnJhbWVfZW5kIGluIHRoZSB2YmxhbmsgaHJ0aW1lciwgbm90IGluIHRoZQog
IHdvcmtlci4gVGhlIHdvcmtlciBtaWdodCBydW4gbXVjaCBsYXRlciwgYW5kIHRoZW4gd2UgZ2Vu
ZXJhdGUgYSBsb3QKICBvZiBjcmMgZm9yIHdoaWNoIHRoZXJlJ3MgYWxyZWFkeSBhIGRpZmZlcmVu
dCB3b3JrZXIgcXVldWVkIHVwLgotIGZyYW1lIG51bWJlciBtaWdodCBiZSAwLCBzbyBjcmVhdGUg
YSBuZXcgY3JjX3BlbmRpbmcgYm9vbGVhbiB0bwogIHRyYWNrIHRoaXMgd2l0aG91dCBjb25mdXNp
b24uCi0gd2UgbmVlZCB0byBhdG9taWNhbGx5IGdyYWIgZnJhbWVfc3RhcnQvZW5kIGFuZCBjbGVh
ciBpdCwgc28gZG8gdGhhdAogIGFsbCBpbiBvbmUgZ28uIFRoaXMgaXMgbm90IGdvaW5nIHRvIGNy
ZWF0ZSBhIG5ldyByYWNlLCBiZWNhdXNlIGlmIHdlCiAgcmFjZSB3aXRoIHRoZSBocnRpbWVyIHRo
ZW4gb3VyIHdvcmsgd2lsbCBiZSByZS1ydW4uCi0gb25seSByYWNlIHRoYXQgY2FuIGhhcHBlbiBp
cyB0aGUgZm9sbG93aW5nOgogIDEuIHdvcmtlciBzdGFydHMKICAyLiBocnRpbWVyIHJ1bnMgYW5k
IHVwZGF0ZXMgZnJhbWVfZW5kCiAgMy4gd29ya2VyIGdyYWJzIGZyYW1lX3N0YXJ0L2VuZCwgYWxy
ZWFkeSByZWFkaW5nIHRoZSBuZXcgZnJhbWVfZW5kLAogIGFuZCBjbGVhcnMgY3JjX3BlbmRpbmcK
ICA0LiBocnRpbWVyIGNhbGxzIHF1ZXVlX3dvcmsoKQogIDUuIHdvcmtlciBjb21wbGV0ZXMKICA2
LiB3b3JrZXIgZ2V0cyAgcmUtcnVuLCBjcmNfcGVuZGluZyBpcyBmYWxzZQogIEV4cGxhaW4gdGhp
cyBjYXNlIGEgYml0IGJldHRlciBieSByZXdvcmRpbmcgdGhlIGNvbW1lbnQuCgp2MjogRGVtb3Rl
IHdhcm5pbmcgbGV2ZWwgb3V0cHV0IHRvIGRlYnVnIHdoZW4gd2UgZmFpbCB0byByZXF1ZXVlLCB0
aGlzCmlzIGV4cGVjdGVkIHVuZGVyIGhpZ2ggbG9hZCB3aGVuIHRoZSBjcmMgd29ya2VyIGNhbid0
IHF1aXRlIGtlZXAgdXAuCgpDYzogU2hheWVubmUgTW91cmEgPHNoYXllbm5lbHV6bW91cmFAZ21h
aWwuY29tPgpDYzogUm9kcmlnbyBTaXF1ZWlyYSA8cm9kcmlnb3NpcXVlaXJhbWVsb0BnbWFpbC5j
b20+CkNjOiBIYW5lZW4gTW9oYW1tZWQgPGhhbW9oYW1tZWQuc2FAZ21haWwuY29tPgpDYzogRGFu
aWVsIFZldHRlciA8ZGFuaWVsQGZmd2xsLmNoPgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVy
IDxkYW5pZWwudmV0dGVyQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFJvZHJpZ28gU2lxdWVpcmEg
PHJvZHJpZ29zaXF1ZWlyYW1lbG9AZ21haWwuY29tPgpUZXN0ZWQtYnk6IFJvZHJpZ28gU2lxdWVp
cmEgPHJvZHJpZ29zaXF1ZWlyYW1lbG9AZ21haWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBSb2RyaWdv
IFNpcXVlaXJhIDxyb2RyaWdvc2lxdWVpcmFtZWxvQGdtYWlsLmNvbT4KTGluazogaHR0cHM6Ly9w
YXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMTkwNjA2MjIyNzUxLjMyNTY3
LTItZGFuaWVsLnZldHRlckBmZndsbC5jaApTaWduZWQtb2ZmLWJ5OiBTYXNoYSBMZXZpbiA8c2Fz
aGFsQGtlcm5lbC5vcmc+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcmMuYyAgfCAy
NyArKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNf
Y3J0Yy5jIHwgIDkgKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Rydi5oICB8
ICAyICsrCiAzIGZpbGVzIGNoYW5nZWQsIDIyIGluc2VydGlvbnMoKyksIDE2IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3JjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vdmttcy92a21zX2NyYy5jCmluZGV4IGQ3YjQwOWEzYzBmOGMuLjY2NjAzZGE2MzRm
ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3JjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcmMuYwpAQCAtMTY2LDE2ICsxNjYsMjQgQEAgdm9pZCB2
a21zX2NyY193b3JrX2hhbmRsZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGRy
bV9wbGFuZSAqcGxhbmU7CiAJdTMyIGNyYzMyID0gMDsKIAl1NjQgZnJhbWVfc3RhcnQsIGZyYW1l
X2VuZDsKKwlib29sIGNyY19wZW5kaW5nOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlzcGlu
X2xvY2tfaXJxc2F2ZSgmb3V0LT5zdGF0ZV9sb2NrLCBmbGFncyk7CiAJZnJhbWVfc3RhcnQgPSBj
cnRjX3N0YXRlLT5mcmFtZV9zdGFydDsKIAlmcmFtZV9lbmQgPSBjcnRjX3N0YXRlLT5mcmFtZV9l
bmQ7CisJY3JjX3BlbmRpbmcgPSBjcnRjX3N0YXRlLT5jcmNfcGVuZGluZzsKKwljcnRjX3N0YXRl
LT5mcmFtZV9zdGFydCA9IDA7CisJY3J0Y19zdGF0ZS0+ZnJhbWVfZW5kID0gMDsKKwljcnRjX3N0
YXRlLT5jcmNfcGVuZGluZyA9IGZhbHNlOwogCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJm91dC0+
c3RhdGVfbG9jaywgZmxhZ3MpOwogCi0JLyogX3ZibGFua19oYW5kbGUoKSBoYXNuJ3QgdXBkYXRl
ZCBmcmFtZV9zdGFydCB5ZXQgKi8KLQlpZiAoIWZyYW1lX3N0YXJ0IHx8IGZyYW1lX3N0YXJ0ID09
IGZyYW1lX2VuZCkKLQkJZ290byBvdXQ7CisJLyoKKwkgKiBXZSByYWNlZCB3aXRoIHRoZSB2Ymxh
bmsgaHJ0aW1lciBhbmQgcHJldmlvdXMgd29yayBhbHJlYWR5IGNvbXB1dGVkCisJICogdGhlIGNy
Yywgbm90aGluZyB0byBkby4KKwkgKi8KKwlpZiAoIWNyY19wZW5kaW5nKQorCQlyZXR1cm47CiAK
IAlkcm1fZm9yX2VhY2hfcGxhbmUocGxhbmUsICZ2ZGV2LT5kcm0pIHsKIAkJc3RydWN0IHZrbXNf
cGxhbmVfc3RhdGUgKnZwbGFuZV9zdGF0ZTsKQEAgLTE5NiwyMCArMjA0LDExIEBAIHZvaWQgdmtt
c19jcmNfd29ya19oYW5kbGUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWlmIChwcmltYXJ5
X2NyYykKIAkJY3JjMzIgPSBfdmttc19nZXRfY3JjKHByaW1hcnlfY3JjLCBjdXJzb3JfY3JjKTsK
IAotCWZyYW1lX2VuZCA9IGRybV9jcnRjX2FjY3VyYXRlX3ZibGFua19jb3VudChjcnRjKTsKLQot
CS8qIHF1ZXVlX3dvcmsgY2FuIGZhaWwgdG8gc2NoZWR1bGUgY3JjX3dvcms7IGFkZCBjcmMgZm9y
Ci0JICogbWlzc2luZyBmcmFtZXMKKwkvKgorCSAqIFRoZSB3b3JrZXIgY2FuIGZhbGwgYmVoaW5k
IHRoZSB2YmxhbmsgaHJ0aW1lciwgbWFrZSBzdXJlIHdlIGNhdGNoIHVwLgogCSAqLwogCXdoaWxl
IChmcmFtZV9zdGFydCA8PSBmcmFtZV9lbmQpCiAJCWRybV9jcnRjX2FkZF9jcmNfZW50cnkoY3J0
YywgdHJ1ZSwgZnJhbWVfc3RhcnQrKywgJmNyYzMyKTsKLQotb3V0OgotCS8qIHRvIGF2b2lkIHVz
aW5nIHRoZSBzYW1lIHZhbHVlIGZvciBmcmFtZSBudW1iZXIgYWdhaW4gKi8KLQlzcGluX2xvY2tf
aXJxc2F2ZSgmb3V0LT5zdGF0ZV9sb2NrLCBmbGFncyk7Ci0JY3J0Y19zdGF0ZS0+ZnJhbWVfZW5k
ID0gZnJhbWVfZW5kOwotCWNydGNfc3RhdGUtPmZyYW1lX3N0YXJ0ID0gMDsKLQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZvdXQtPnN0YXRlX2xvY2ssIGZsYWdzKTsKIH0KIAogc3RhdGljIGludCB2
a21zX2NyY19wYXJzZV9zb3VyY2UoY29uc3QgY2hhciAqc3JjX25hbWUsIGJvb2wgKmVuYWJsZWQp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2NydGMuYyBiL2RyaXZlcnMv
Z3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jCmluZGV4IGU0NDdiNzU4OGQwNmUuLjc3YTFmNWZhNWQ1
YzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jCkBAIC0zMCwxMyArMzAsMTggQEAgc3RhdGlj
IGVudW0gaHJ0aW1lcl9yZXN0YXJ0IHZrbXNfdmJsYW5rX3NpbXVsYXRlKHN0cnVjdCBocnRpbWVy
ICp0aW1lcikKIAkJICogaGFzIHJlYWQgdGhlIGRhdGEKIAkJICovCiAJCXNwaW5fbG9jaygmb3V0
cHV0LT5zdGF0ZV9sb2NrKTsKLQkJaWYgKCFzdGF0ZS0+ZnJhbWVfc3RhcnQpCisJCWlmICghc3Rh
dGUtPmNyY19wZW5kaW5nKQogCQkJc3RhdGUtPmZyYW1lX3N0YXJ0ID0gZnJhbWU7CisJCWVsc2UK
KwkJCURSTV9ERUJVR19EUklWRVIoImNyYyB3b3JrZXIgZmFsbGluZyBiZWhpbmQsIGZyYW1lX3N0
YXJ0OiAlbGx1LCBmcmFtZV9lbmQ6ICVsbHVcbiIsCisJCQkJCSBzdGF0ZS0+ZnJhbWVfc3RhcnQs
IGZyYW1lKTsKKwkJc3RhdGUtPmZyYW1lX2VuZCA9IGZyYW1lOworCQlzdGF0ZS0+Y3JjX3BlbmRp
bmcgPSB0cnVlOwogCQlzcGluX3VubG9jaygmb3V0cHV0LT5zdGF0ZV9sb2NrKTsKIAogCQlyZXQg
PSBxdWV1ZV93b3JrKG91dHB1dC0+Y3JjX3dvcmtxLCAmc3RhdGUtPmNyY193b3JrKTsKIAkJaWYg
KCFyZXQpCi0JCQlEUk1fV0FSTigiZmFpbGVkIHRvIHF1ZXVlIHZrbXNfY3JjX3dvcmtfaGFuZGxl
Iik7CisJCQlEUk1fREVCVUdfRFJJVkVSKCJ2a21zX2NyY193b3JrX2hhbmRsZSBhbHJlYWR5IHF1
ZXVlZFxuIik7CiAJfQogCiAJc3Bpbl91bmxvY2soJm91dHB1dC0+bG9jayk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMv
dmttc19kcnYuaAppbmRleCA4MWYxY2ZiZWI5MzYyLi4zYzdlMDZiMTllZmQ1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
a21zL3ZrbXNfZHJ2LmgKQEAgLTU2LDYgKzU2LDggQEAgc3RydWN0IHZrbXNfcGxhbmVfc3RhdGUg
ewogc3RydWN0IHZrbXNfY3J0Y19zdGF0ZSB7CiAJc3RydWN0IGRybV9jcnRjX3N0YXRlIGJhc2U7
CiAJc3RydWN0IHdvcmtfc3RydWN0IGNyY193b3JrOworCisJYm9vbCBjcmNfcGVuZGluZzsKIAl1
NjQgZnJhbWVfc3RhcnQ7CiAJdTY0IGZyYW1lX2VuZDsKIH07Ci0tIAoyLjIwLjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
