Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DA503B093B
	for <lists+dri-devel@lfdr.de>; Thu, 12 Sep 2019 09:08:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 66B686EBC4;
	Thu, 12 Sep 2019 07:08:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ironport.ite.com.tw (60-251-196-230.HINET-IP.hinet.net
 [60.251.196.230])
 by gabe.freedesktop.org (Postfix) with ESMTP id 65F026E029
 for <dri-devel@lists.freedesktop.org>; Thu, 12 Sep 2019 03:35:20 +0000 (UTC)
Received: from unknown (HELO mse.ite.com.tw) ([192.168.35.30])
 by ironport.ite.com.tw with ESMTP; 12 Sep 2019 11:35:19 +0800
Received: from csbcas.internal.ite.com.tw (csbcas1.internal.ite.com.tw
 [192.168.65.46]) by mse.ite.com.tw with ESMTP id x8C3ZHWg095059;
 Thu, 12 Sep 2019 11:35:17 +0800 (GMT-8)
 (envelope-from allen.chen@ite.com.tw)
Received: from allen-VirtualBox.internal.ite.com.tw (192.168.70.14) by
 csbcas1.internal.ite.com.tw (192.168.65.45) with Microsoft SMTP Server (TLS)
 id 14.3.352.0; Thu, 12 Sep 2019 11:35:17 +0800
From: allen <allen.chen@ite.com.tw>
To: 
Subject: [PATCH v3 2/2] drm/bridge: add it6505 driver
Date: Thu, 12 Sep 2019 11:32:29 +0800
Message-ID: <1568259199-5827-3-git-send-email-allen.chen@ite.com.tw>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1568259199-5827-1-git-send-email-allen.chen@ite.com.tw>
References: <1568259199-5827-1-git-send-email-allen.chen@ite.com.tw>
MIME-Version: 1.0
X-Originating-IP: [192.168.70.14]
X-MAIL: mse.ite.com.tw x8C3ZHWg095059
X-Mailman-Approved-At: Thu, 12 Sep 2019 07:07:54 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jernej Skrabec <jernej.skrabec@siol.net>,
 Jitao Shi <jitao.shi@mediatek.com>, Jau-Chih Tseng <Jau-Chih.Tseng@ite.com.tw>,
 Yilun Lin <yllin@google.com>, Allen Chen <allen.chen@ite.com.tw>,
 David Airlie <airlied@linux.ie>, Neil Armstrong <narmstrong@baylibre.com>,
 open list <linux-kernel@vger.kernel.org>, "open
 list:DRM DRIVERS" <dri-devel@lists.freedesktop.org>,
 Jonas Karlman <jonas@kwiboo.se>,
 "moderated list:ARM/Mediatek SoC support" <linux-mediatek@lists.infradead.org>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Pi-Hsun Shih <pihsun@chromium.org>, Matthias Brugger <matthias.bgg@gmail.com>,
 "moderated
 list:ARM/Mediatek SoC support" <linux-arm-kernel@lists.infradead.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQWxsZW4gQ2hlbiA8YWxsZW4uY2hlbkBpdGUuY29tLnR3PgoKVGhpcyBhZGRzIHN1cHBv
cnQgZm9yIHRoZSBpVEUgSVQ2NTA1LgpUaGlzIGRldmljZSBjYW4gY29udmVydCBEUEkgc2lnbmFs
IHRvIERQIG91dHB1dC4KClNpZ25lZC1vZmYtYnk6IEppdGFvIFNoaSA8aml0YW8uc2hpQG1lZGlh
dGVrLmNvbT4KU2lnbmVkLW9mZi1ieTogWWlsdW4gTGluIDx5bGxpbkBnb29nbGUuY29tPgpTaWdu
ZWQtb2ZmLWJ5OiBBbGxlbiBDaGVuIDxhbGxlbi5jaGVuQGl0ZS5jb20udHc+ClNpZ25lZC1vZmYt
Ynk6IFBpLUhzdW4gU2hpaCA8cGloc3VuQGNocm9taXVtLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL0tjb25maWcgICAgICB8ICAgIDcgKwogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9N
YWtlZmlsZSAgICAgfCAgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvaXRlLWl0NjUwNS5j
IHwgMjUzMSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFu
Z2VkLCAyNTM5IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL2l0ZS1pdDY1MDUuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2UvS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvS2NvbmZpZwppbmRleCAxY2M5ZjUw
Li5kOGQ3ZDI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnCkBAIC00NSw2ICs0NSwxMyBAQCBjb25m
aWcgRFJNX0RVTUJfVkdBX0RBQwogCSAgU3VwcG9ydCBmb3Igbm9uLXByb2dyYW1tYWJsZSBSR0Ig
dG8gVkdBIERBQyBicmlkZ2VzLCBzdWNoIGFzIEFESQogCSAgQURWNzEyMywgVEkgVEhTODEzNCBh
bmQgVEhTODEzNSBvciBwYXNzaXZlIHJlc2lzdG9yIGxhZGRlciBEQUNzLgogCitjb25maWcgRFJN
X0lURV9JVDY1MDUKKwl0cmlzdGF0ZSAiSVRFIElUNjUwNSBEUCBicmlkZ2UiCisJZGVwZW5kcyBv
biBPRgorCXNlbGVjdCBEUk1fS01TX0hFTFBFUgorCWhlbHAKKwkgIElURSBJVDY1MDUgRFAgYnJp
ZGdlIGNoaXAgZHJpdmVyLgorCiBjb25maWcgRFJNX0xWRFNfRU5DT0RFUgogCXRyaXN0YXRlICJU
cmFuc3BhcmVudCBwYXJhbGxlbCB0byBMVkRTIGVuY29kZXIgc3VwcG9ydCIKIAlkZXBlbmRzIG9u
IE9GCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQppbmRleCA0OTM0ZmNmLi5mNWFiY2E1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9icmlkZ2UvTWFrZWZpbGUKQEAgLTIsNiArMiw3IEBACiBvYmotJChDT05GSUdfRFJNX0FOQUxP
R0lYX0FOWDc4WFgpICs9IGFuYWxvZ2l4LWFueDc4eHgubwogb2JqLSQoQ09ORklHX0RSTV9DRE5T
X0RTSSkgKz0gY2Rucy1kc2kubwogb2JqLSQoQ09ORklHX0RSTV9EVU1CX1ZHQV9EQUMpICs9IGR1
bWItdmdhLWRhYy5vCitvYmotJChDT05GSUdfRFJNX0lURV9JVDY1MDUpICs9IGl0ZS1pdDY1MDUu
bwogb2JqLSQoQ09ORklHX0RSTV9MVkRTX0VOQ09ERVIpICs9IGx2ZHMtZW5jb2Rlci5vCiBvYmot
JChDT05GSUdfRFJNX01FR0FDSElQU19TVERQWFhYWF9HRV9CODUwVjNfRlcpICs9IG1lZ2FjaGlw
cy1zdGRweHh4eC1nZS1iODUwdjMtZncubwogb2JqLSQoQ09ORklHX0RSTV9OWFBfUFROMzQ2MCkg
Kz0gbnhwLXB0bjM0NjAubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9pdGUt
aXQ2NTA1LmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2l0ZS1pdDY1MDUuYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi41ZTA0NmY2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2JyaWRnZS9pdGUtaXQ2NTA1LmMKQEAgLTAsMCArMSwyNTMxIEBACisvLyBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAoYykgMjAx
OCwgVGhlIExpbnV4IEZvdW5kYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuCisgKi8KKyNpbmNs
dWRlIDxsaW51eC9iaXRzLmg+CisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxs
aW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9l
eHRjb24uaD4KKyNpbmNsdWRlIDxsaW51eC9mcy5oPgorI2luY2x1ZGUgPGxpbnV4L2dwaW8vY29u
c3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9pMmMuaD4KKyNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1
cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUu
aD4KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9yZWd1bGF0b3Iv
Y29uc3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCisjaW5jbHVkZSA8Y3J5cHRv
L2hhc2guaD4KKyNpbmNsdWRlIDxjcnlwdG8vc2hhLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0
b21pY19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX2NydGNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcF9oZWxwZXIuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX2VkaWQuaD4KKworI2RlZmluZSBBWCAwCisjZGVmaW5lIEJYIDEKKyNkZWZp
bmUgQVVEU0VMIEkyUworI2RlZmluZSBBVURUWVBFIExQQ00KKyNkZWZpbmUgQVVERlMgQVVENDhL
CisjZGVmaW5lIEFVRENIIDIKKy8qIDA6IFN0YW5kYXJkIEkyUzsxOiAzMmJpdCBJMlMgKi8KKyNk
ZWZpbmUgSTJTSU5QVVRGTVQgMQorLyogMDogTGVmdC1qdXN0aWZpZWQ7MTogUmlnaHQtanVzdGlm
aWVkICovCisjZGVmaW5lIEkyU0pVU1RJRklFRCAwCisvKiAwOiBEYXRhIGRlbGF5IDFUIGNvcnJl
c3BvbmQgdG8gV1M7MTogTm8gZGF0YSBkZWxheSBjb3JyZXNwb25kIHRvIFdTICovCisjZGVmaW5l
IEkyU0RBVEFERUxBWSAwCisvKiAwOiBpcyBsZWZ0IGNoYW5uZWw7MTogaXMgcmlnaHQgY2hhbm5l
bCAqLworI2RlZmluZSBJMlNXU0NIQU5ORUwgMAorLyogMDogTVNCIHNoaWZ0IGZpcnN0OzE6IExT
QiBzaGlmdCBmaXJzdCAqLworI2RlZmluZSBJMlNEQVRBU0VRIDAKKworI2RlZmluZSBMQU5FU1dB
UCAwCisjZGVmaW5lIExBTkUgNAorI2RlZmluZSBfSEJSIDEKKyNkZWZpbmUgRU5TU0MgMQorI2Rl
ZmluZSBGTEFHVFJBSU5ET1dOIDE1MAorI2RlZmluZSBQT0xMSU5HS1NWTElTVCA0MDAKKyNkZWZp
bmUgVFJBSU5GQUlMQ05UIDUKKyNkZWZpbmUgVFJBSU5GQUlMSFBEIDMKKyNkZWZpbmUgQVVYX1dB
SVRfVElNRU9VVF9NUyAxNQorI2RlZmluZSBQQ0xLX0RFTEFZIDEKKyNkZWZpbmUgUENMS19JTlYg
MAorI2RlZmluZSBFRElEUkVUUllUSU1FIDUKKyNkZWZpbmUgU0hPV1ZJREVPVElNSU5HIDIKKyNk
ZWZpbmUgUFdST0ZGUkVUUllUSU1FIDUKKyNkZWZpbmUgTUFYUENMSyA4MDAwMAorI2RlZmluZSBE
RUZBVUxUSERDUCAxCisjZGVmaW5lIERFRkFVTFRBVURJTyAwCisjZGVmaW5lIERFRkFVTFRQV1JP
Tk9GRiAxCisjZGVmaW5lIERFRkFVTFREUlZIT0xEIDAKKyNkZWZpbmUgREVGQVVMVFBXUk9OIDAK
KyNkZWZpbmUgQVVYX0ZJRk9fTUFYX1NJWkUgMHgxMAorCisvKiBBWCBvciBCWCAqLworI2RlZmlu
ZSBDSElQX1ZFUlNJT04gQlgKKworLyoKKyAqIDA6IGZvciBiaXRsYW5kCisgKiAxOiBmb3IgZ29v
Z2xlIGt1a3VpIHAyLCBodWFxaW4KKyAqLworI2RlZmluZSBBRkVfU0VUVElORyAxCisKK3N0YXRp
YyB1OCBhZmVfc2V0dGluZ190YWJsZVsyXVszXSA9IHsKKwl7MCwgMCwgMH0sCisJezB4OTMsIDB4
MmEsIDB4ODV9Cit9OworCitlbnVtIHN5c19zdGF0dXMgeworCVNZU19VTlBMVUcgPSAwLAorCVNZ
U19IUEQsCisJU1lTX0FVVE9UUkFJTiwKKwlTWVNfV0FJVCwKKwlTWVNfVFJBSU5GQUlMLAorCVNZ
U19SZUhEQ1AsCisJU1lTX05PUk9QLAorCVNZU19Vbmtub3duLAorfTsKKworZW51bSBpdDY1MDVf
YXVkX3NlbCB7CisJSTJTID0gMCwKKwlTUERJRiwKK307CisKK2VudW0gaXQ2NTA1X2F1ZF9mcyB7
CisJQVVEMjRLID0gMHg2LAorCUFVRDMySyA9IDB4MywKKwlBVUQ0OEsgPSAweDIsCisJQVVEOTZL
ID0gMHhBLAorCUFVRDE5MksgPSAweEUsCisJQVVENDRQMUsgPSAweDAsCisJQVVEODhQMksgPSAw
eDgsCisJQVVEMTc2UDRLID0gMHhDLAorfTsKKworZW51bSBpdDY1MDVfYXVkX3R5cGUgeworCUxQ
Q00gPSAwLAorCU5MUENNLAorCURTUywKKwlIQlIsCit9OworCitlbnVtIGF1ZF93b3JkX2xlbmd0
aCB7CisJQVVEMTZCSVQgPSAwLAorCUFVRDE4QklULAorCUFVRDIwQklULAorCUFVRDI0QklULAor
fTsKKworLyogQXVkaW8gU2FtcGxlIFdvcmQgTGVuZ3RoOiBBVUQxNkJJVCwgQVVEMThCSVQsIEFV
RDIwQklULCBBVUQyNEJJVCAqLworI2RlZmluZSBBVURXT1JETEVOR1RIIEFVRDI0QklUCisKK3N0
cnVjdCBpdDY1MDVfcGxhdGZvcm1fZGF0YSB7CisJc3RydWN0IHJlZ3VsYXRvciAqcHdyMTg7CisJ
c3RydWN0IHJlZ3VsYXRvciAqb3ZkZDsKKwlzdHJ1Y3QgZ3Bpb19kZXNjICpncGlvZF9ocGQ7CisJ
c3RydWN0IGdwaW9fZGVzYyAqZ3Bpb2RfcmVzZXQ7Cit9OworCitzdHJ1Y3QgaXQ2NTA1IHsKKwlz
dHJ1Y3QgZHJtX2RwX2F1eCBhdXg7CisJc3RydWN0IGRybV9icmlkZ2UgYnJpZGdlOworCXN0cnVj
dCBpMmNfY2xpZW50ICpjbGllbnQ7CisJc3RydWN0IGVkaWQgKmVkaWQ7CisJc3RydWN0IGRybV9j
b25uZWN0b3IgY29ubmVjdG9yOworCXN0cnVjdCBkcm1fZHBfbGluayBsaW5rOworCXN0cnVjdCBp
dDY1MDVfcGxhdGZvcm1fZGF0YSBwZGF0YTsKKwlzdHJ1Y3QgbXV0ZXggbG9jazsKKwlzdHJ1Y3Qg
bXV0ZXggbW9kZV9sb2NrOworCXN0cnVjdCByZWdtYXAgKnJlZ21hcDsKKwlzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSB2aWRfaW5mbzsKKworCXN0cnVjdCBub3RpZmllcl9ibG9jayBldmVudF9uYjsK
KwlzdHJ1Y3QgZXh0Y29uX2RldiAqZXh0Y29uOworCXN0cnVjdCB3b3JrX3N0cnVjdCBleHRjb25f
d3E7CisJZW51bSBzeXNfc3RhdHVzIHN0YXR1czsKKwlib29sIGhicjsKKwl1OCBlbl9zc2M7CisJ
Ym9vbCBsYW5lc3dhcF9kaXNhYmxlZDsKKwlib29sIGxhbmVzd2FwOworCisJZW51bSBpdDY1MDVf
YXVkX3NlbCBhdWRfc2VsOworCWVudW0gaXQ2NTA1X2F1ZF9mcyBhdWRfZnM7CisJZW51bSBpdDY1
MDVfYXVkX3R5cGUgYXVkX3R5cGU7CisJdTggYXVkX2NoOworCXU4IGkyc19pbnB1dF9mbXQ7CisJ
dTggaTJzX2p1c3RpZmllZDsKKwl1OCBpMnNfZGF0YV9kZWxheTsKKwl1OCBpMnNfd3NfY2hhbm5l
bDsKKwl1OCBpMnNfZGF0YV9zZXE7CisJdTggdmlkc3RhYmxlX2RvbmU7CisJZW51bSBhdWRfd29y
ZF9sZW5ndGggYXVkd29yZGxlbmd0aDsKKwl1bnNpZ25lZCBpbnQgZW5faGRjcDsKKwl1bnNpZ25l
ZCBpbnQgZW5fcHdyb25vZmY7CisJdW5zaWduZWQgaW50IGVuX2F1ZGlvOworCXU4IGNudGZzbTsK
Kwl1OCB0cmFpbl9mYWlsX2hwZDsKKwlib29sIGNwX2NhcGFibGU7CisJYm9vbCBjcF9kb25lOwor
CXU4IGRvd25zdHJlYW1fcmVwZWF0ZXI7CisJdTggc2hhaW5wdXRbNjRdOworCXU4IGF2WzVdWzRd
OworCXU4IGJ2WzVdWzRdOworCWJvb2wgcG93ZXJlZDsKKwkvKiBpdDY1MDUgZHJpdmVyIGhvbGQg
b3B0aW9uICovCisJdW5zaWduZWQgaW50IGRydl9ob2xkOworfTsKKworc3RhdGljIGNvbnN0IHN0
cnVjdCByZWdtYXBfcmFuZ2UgaXQ2NTA1X2JyaWRnZV92b2xhdGlsZV9yYW5nZXNbXSA9IHsKKwl7
IC5yYW5nZV9taW4gPSAwLCAucmFuZ2VfbWF4ID0gMHhGRiB9LAorfTsKKworc3RhdGljIGNvbnN0
IHN0cnVjdCByZWdtYXBfYWNjZXNzX3RhYmxlIGl0NjUwNV9icmlkZ2Vfdm9sYXRpbGVfdGFibGUg
PSB7CisJLnllc19yYW5nZXMgPSBpdDY1MDVfYnJpZGdlX3ZvbGF0aWxlX3JhbmdlcywKKwkubl95
ZXNfcmFuZ2VzID0gQVJSQVlfU0laRShpdDY1MDVfYnJpZGdlX3ZvbGF0aWxlX3JhbmdlcyksCit9
OworCitzdGF0aWMgY29uc3Qgc3RydWN0IHJlZ21hcF9jb25maWcgaXQ2NTA1X2JyaWRnZV9yZWdt
YXBfY29uZmlnID0geworCS5yZWdfYml0cyA9IDgsCisJLnZhbF9iaXRzID0gOCwKKwkudm9sYXRp
bGVfdGFibGUgPSAmaXQ2NTA1X2JyaWRnZV92b2xhdGlsZV90YWJsZSwKKwkuY2FjaGVfdHlwZSA9
IFJFR0NBQ0hFX05PTkUsCit9OworCitzdGF0aWMgaW50IGRwdHhyZChzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUsIHVuc2lnbmVkIGludCByZWdfYWRkciwKKwkJICB1bnNpZ25lZCBpbnQgKnZhbHVlKQor
eworCWludCBlcnI7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7
CisKKwllcnIgPSByZWdtYXBfcmVhZChpdDY1MDUtPnJlZ21hcCwgcmVnX2FkZHIsIHZhbHVlKTsK
KwlpZiAoZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgInJlYWQgZmFpbGVkIHJlZ1sw
eCV4XSBlcnI6ICVkIiwgcmVnX2FkZHIsCisJCQkgICAgICBlcnIpOworCQlyZXR1cm4gZXJyOwor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBpdDY1MDVfZHVtcChzdHJ1Y3QgaXQ2
NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IHRlbXBbMTZdLCBpLCBqOworCXU4IHZhbHVl
WzE2XTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCWZv
ciAoaSA9IDA7IGkgPD0gMHhmZjsgaSArPSAxNikgeworCQlmb3IgKGogPSAwOyBqIDwgMTY7IGor
KykgeworCQkJZHB0eHJkKGl0NjUwNSwgaSArIGosIHRlbXAgKyBqKTsKKwkJCXZhbHVlW2pdID0g
dGVtcFtqXTsKKwkJfQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJbMHglMDJ4XSA9ICUx
NnBoIiwgaSwgdmFsdWUpOworCX0KK30KKworc3RhdGljIGludCBkcHR4d3Ioc3RydWN0IGl0NjUw
NSAqaXQ2NTA1LCB1bnNpZ25lZCBpbnQgcmVnX2FkZHIsCisJCSAgdW5zaWduZWQgaW50IHJlZ192
YWwpCit7CisJaW50IGVycjsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQt
PmRldjsKKworCWVyciA9IHJlZ21hcF93cml0ZShpdDY1MDUtPnJlZ21hcCwgcmVnX2FkZHIsIHJl
Z192YWwpOworCisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJ3cml0ZSBm
YWlsZWQgcmVnWzB4JXhdID0gMHgleCBlcnIgPSAlZCIsCisJCQkgICAgICByZWdfYWRkciwgcmVn
X3ZhbCwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBkcHR4c2V0KHN0cnVjdCBpdDY1MDUgKml0NjUwNSwgdW5zaWduZWQgaW50IHJlZywgdW5z
aWduZWQgaW50IG1hc2ssCisJCSAgIHVuc2lnbmVkIGludCB2YWx1ZSkKK3sKKwlpbnQgZXJyOwor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZXJyID0gcmVn
bWFwX3VwZGF0ZV9iaXRzKGl0NjUwNS0+cmVnbWFwLCByZWcsIG1hc2ssIHZhbHVlKTsKKwlpZiAo
ZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9SKAorCQkJZGV2LCAid3JpdGUgcmVnWzB4JXhdID0g
MHgleCBtYXNrID0gMHgleCBmYWlsZWQgZXJyICVkIiwKKwkJCXJlZywgdmFsdWUsIG1hc2ssIGVy
cik7CisJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRw
dHhfZGVidWdfcHJpbnQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1LCB1bnNpZ25lZCBpbnQgcmVnLAor
CQkJICAgICBjb25zdCBjaGFyICpwcmVmaXgpCit7CisJdW5zaWduZWQgaW50IHZhbDsKKwlpbnQg
ZXJyOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYg
KGxpa2VseSghKGRybV9kZWJ1ZyAmIERSTV9VVF9EUklWRVIpKSkKKwkJcmV0dXJuOworCisJZXJy
ID0gZHB0eHJkKGl0NjUwNSwgcmVnLCAmdmFsKTsKKwlpZiAoZXJyIDwgMCkKKwkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiJXMgcmVnJTAyeCByZWFkIGVycm9yIiwgcHJlZml4LCByZWcpOwor
CWVsc2UKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiJXMgcmVnJTAyeCA9IDB4JTAyeCIs
IHByZWZpeCwgcmVnLAorCQkJCSAgICAgdmFsKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3Qg
aXQ2NTA1ICpjb25uZWN0b3JfdG9faXQ2NTA1KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjKQorewor
CXJldHVybiBjb250YWluZXJfb2YoYywgc3RydWN0IGl0NjUwNSwgY29ubmVjdG9yKTsKK30KKwor
c3RhdGljIGlubGluZSBzdHJ1Y3QgaXQ2NTA1ICpicmlkZ2VfdG9faXQ2NTA1KHN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2UpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihicmlkZ2UsIHN0cnVjdCBp
dDY1MDUsIGJyaWRnZSk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9pbml0X2ZzbShzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJaXQ2NTA1LT5hdWRfc2VsID0gQVVEU0VMOworCWl0NjUwNS0+
YXVkX2ZzID0gQVVERlM7CisJaXQ2NTA1LT5hdWRfY2ggPSBBVURDSDsKKwlpdDY1MDUtPmF1ZF90
eXBlID0gQVVEVFlQRTsKKwlpdDY1MDUtPmkyc19pbnB1dF9mbXQgPSBJMlNJTlBVVEZNVDsKKwlp
dDY1MDUtPmkyc19qdXN0aWZpZWQgPSBJMlNKVVNUSUZJRUQ7CisJaXQ2NTA1LT5pMnNfZGF0YV9k
ZWxheSA9IEkyU0RBVEFERUxBWTsKKwlpdDY1MDUtPmkyc193c19jaGFubmVsID0gSTJTV1NDSEFO
TkVMOworCWl0NjUwNS0+aTJzX2RhdGFfc2VxID0gSTJTREFUQVNFUTsKKwlpdDY1MDUtPmF1ZHdv
cmRsZW5ndGggPSBBVURXT1JETEVOR1RIOworCWl0NjUwNS0+ZW5fYXVkaW8gPSBERUZBVUxUQVVE
SU87CisJaXQ2NTA1LT5lbl9oZGNwID0gREVGQVVMVEhEQ1A7CisKKwlpdDY1MDUtPmhiciA9IF9I
QlI7CisJaXQ2NTA1LT5lbl9zc2MgPSBFTlNTQzsKKwlpdDY1MDUtPmxhbmVzd2FwID0gTEFORVNX
QVA7CisJaXQ2NTA1LT52aWRzdGFibGVfZG9uZSA9IDA7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV90ZXJtaW5hdGlvbl9vbihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisjaWYgKENISVBfVkVS
U0lPTiA9PSBCWCkKKwlkcHR4c2V0KGl0NjUwNSwgMHg1RCwgMHg4MCwgMHgwMCk7CisJZHB0eHNl
dChpdDY1MDUsIDB4NUUsIDB4MDIsIDB4MDIpOworI2VuZGlmCit9CisKK3N0YXRpYyB2b2lkIGl0
NjUwNV90ZXJtaW5hdGlvbl9vZmYoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworI2lmIChDSElQ
X1ZFUlNJT04gPT0gQlgpCisJZHB0eHNldChpdDY1MDUsIDB4NUQsIDB4ODAsIDB4ODApOworCWRw
dHhzZXQoaXQ2NTA1LCAweDVFLCAweDAyLCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHg1Qywg
MHhGMCwgMHgwMCk7CisjZW5kaWYKK30KKworc3RhdGljIGJvb2wgZHB0eF9nZXRzaW5raHBkKHN0
cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwl1bnNpZ25lZCBpbnQgdmFsdWU7CisJaW50IHJldDsK
KworCXJldCA9IGRwdHhyZChpdDY1MDUsIDB4MEQsICZ2YWx1ZSk7CisKKwlpZiAocmV0IDwgMCkK
KwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIEJJVCgxKSkgPT0gQklUKDEpOwor
fQorCitzdGF0aWMgdm9pZCBkcHR4X2NoZ2Jhbmsoc3RydWN0IGl0NjUwNSAqaXQ2NTA1LCB1bnNp
Z25lZCBpbnQgYmFua19pZCkKK3sKKwlkcHR4c2V0KGl0NjUwNSwgMHgwRiwgMHgwMSwgYmFua19p
ZCAmIEJJVCgwKSk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9pbnRfbWFza19vbihzdHJ1Y3Qg
aXQ2NTA1ICppdDY1MDUpCit7CisJZHB0eHdyKGl0NjUwNSwgMHgwOSwgMHgxRik7CisJZHB0eHdy
KGl0NjUwNSwgMHgwQSwgMHgwNyk7CisJZHB0eHdyKGl0NjUwNSwgMHgwQiwgMHg5MCk7Cit9CisK
K3N0YXRpYyB2b2lkIGl0NjUwNV9pbnRfbWFza19vZmYoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQor
eworCWRwdHh3cihpdDY1MDUsIDB4MDksIDB4MDApOworCWRwdHh3cihpdDY1MDUsIDB4MEEsIDB4
MDApOworCWRwdHh3cihpdDY1MDUsIDB4MEIsIDB4MDApOworfQorCitzdGF0aWMgdm9pZCBkcHR4
X2luaXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWRwdHh3cihpdDY1MDUsIDB4MDUsIDB4
M0IpOworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA1LCAw
eDFGKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMTUwMCk7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV9pbml0X2FuZF9tYXNrX29uKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlkcHR4X2luaXQo
aXQ2NTA1KTsKKwlpdDY1MDVfaW50X21hc2tfb24oaXQ2NTA1KTsKK30KKworc3RhdGljIGludCBp
dDY1MDVfcG93ZXJvbihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJc3RydWN0IGl0NjUwNV9w
bGF0Zm9ybV9kYXRhICpwZGF0YSA9ICZpdDY1MDUtPnBkYXRhOworCWludCBlcnIgPSAwOworCXN0
cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKGl0NjUwNS0+
cG93ZXJlZCkgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJpdDY1MDUgYWxyZWFkeSBw
b3dlcmVkIG9uIik7CisJCXJldHVybiAwOworCX0KKworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRl
diwgIml0NjUwNSBzdGFydCB0byBwb3dlciBvbiIpOworCisJZXJyID0gcmVndWxhdG9yX2VuYWJs
ZShwZGF0YS0+cHdyMTgpOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIHRvIGVuYWJs
ZSBwd3IxOCByZWd1bGF0b3IiLAorCQkJICAgICBlcnIgPyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQi
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCS8qIHRpbWUgaW50ZXJ2YWwgYmV0d2VlbiBJ
VkREIGFuZCBPVkREIGF0IGxlYXN0IGJlIDFtcyAqLworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAw
KTsKKwllcnIgPSByZWd1bGF0b3JfZW5hYmxlKHBkYXRhLT5vdmRkKTsKKwlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICIlcyB0byBlbmFibGUgb3ZkZCByZWd1bGF0b3IiLAorCQkJICAgICBlcnIg
PyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQiKTsKKwlpZiAoZXJyKSB7CisJCXJlZ3VsYXRvcl9kaXNh
YmxlKHBkYXRhLT5wd3IxOCk7CisJCXJldHVybiBlcnI7CisJfQorCS8qIHRpbWUgaW50ZXJ2YWwg
YmV0d2VlbiBPVkREIGFuZCBTWVNSU1ROIGF0IGxlYXN0IGJlIDEwbXMgKi8KKwl1c2xlZXBfcmFu
Z2UoMTAwMDAsIDIwMDAwKTsKKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAocGRhdGEtPmdwaW9k
X3Jlc2V0LCAwKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisJZ3Bpb2Rfc2V0X3ZhbHVl
X2NhbnNsZWVwKHBkYXRhLT5ncGlvZF9yZXNldCwgMSk7CisJdXNsZWVwX3JhbmdlKDEwMDAwLCAy
MDAwMCk7CisKKwlpdDY1MDVfaW5pdF9hbmRfbWFza19vbihpdDY1MDUpOworCWl0NjUwNS0+cG93
ZXJlZCA9IHRydWU7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X3Bvd2Vyb2Zm
KHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1X3BsYXRmb3JtX2RhdGEg
KnBkYXRhID0gJml0NjUwNS0+cGRhdGE7CisJaW50IGVyciA9IDA7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpZiAoIWl0NjUwNS0+cG93ZXJlZCkgewor
CQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJwb3dlciBoYWQgYmVlbiBhbHJlYWR5IG9mZiIp
OworCQlyZXR1cm4gMDsKKwl9CisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKHBkYXRhLT5ncGlv
ZF9yZXNldCwgMCk7CisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUocGRhdGEtPnB3cjE4KTsKKwlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICIlcyB0byBkaXNhYmxlIHB3cjE4IHJlZ3VsYXRvciIs
CisJCQkgICAgIGVyciA/ICJGYWlsZWQiIDogIlN1Y2NlZWRlZCIpOworCWlmIChlcnIpCisJCXJl
dHVybiBlcnI7CisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUocGRhdGEtPm92ZGQpOworCURSTV9E
RVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIHRvIGRpc2FibGUgb3ZkZCByZWd1bGF0b3IiLAorCQkJ
ICAgICBlcnIgPyAiRmFpbGVkIiA6ICJTdWNjZWVkZWQiKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4g
ZXJyOworCisJa2ZyZWUoaXQ2NTA1LT5lZGlkKTsKKwlpdDY1MDUtPmVkaWQgPSBOVUxMOworCWl0
NjUwNS0+cG93ZXJlZCA9IGZhbHNlOworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBzaG93
X3ZpZF9pbmZvKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlpbnQgaHN5bmNfcG9sLCB2c3lu
Y19wb2wsIGludGVybGFjZWQ7CisJaW50IGh0b3RhbCwgaGRlcywgaGRldywgaGZwaCwgaHN5bmN3
OworCWludCB2dG90YWwsIHZkZXMsIHZkZXcsIHZmcGgsIHZzeW5jdzsKKwlpbnQgcmRkYXRhLCBy
ZGRhdGExLCBpOworCWludCBwY2xrLCBzdW07CisKKwl1c2xlZXBfcmFuZ2UoMTAwMDAsIDE1MDAw
KTsKKwlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwlkcHR4cmQoaXQ2NTA1LCAweGEwLCAmcmRk
YXRhKTsKKwloc3luY19wb2wgPSByZGRhdGEgJiBCSVQoMCk7CisJdnN5bmNfcG9sID0gKHJkZGF0
YSAmIEJJVCgyKSkgPj4gMjsKKwlpbnRlcmxhY2VkID0gKHJkZGF0YSAmIEJJVCg0KSkgPj4gNDsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTEsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTIs
ICZyZGRhdGExKTsKKwlodG90YWwgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTMsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTQs
ICZyZGRhdGExKTsKKworCWhkZXMgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTUsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTYs
ICZyZGRhdGExKTsKKworCWhkZXcgPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTcsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YTgs
ICZyZGRhdGExKTsKKworCWhmcGggPSAoKHJkZGF0YTEgJiAweDFGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YTksICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YWEs
ICZyZGRhdGExKTsKKworCWhzeW5jdyA9ICgocmRkYXRhMSAmIDB4MUYpIDw8IDgpICsgcmRkYXRh
OworCisJZHB0eHJkKGl0NjUwNSwgMHhhYiwgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhh
YywgJnJkZGF0YTEpOworCXZ0b3RhbCA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRh
OworCisJZHB0eHJkKGl0NjUwNSwgMHhhZCwgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhh
ZSwgJnJkZGF0YTEpOworCXZkZXMgPSAoKHJkZGF0YTEgJiAweDBGKSA8PCA4KSArIHJkZGF0YTsK
KworCWRwdHhyZChpdDY1MDUsIDB4YWYsICZyZGRhdGEpOworCWRwdHhyZChpdDY1MDUsIDB4YjAs
ICZyZGRhdGExKTsKKwl2ZGV3ID0gKChyZGRhdGExICYgMHgwRikgPDwgOCkgKyByZGRhdGE7CisK
KwlkcHR4cmQoaXQ2NTA1LCAweGIxLCAmcmRkYXRhKTsKKwlkcHR4cmQoaXQ2NTA1LCAweGIyLCAm
cmRkYXRhMSk7CisJdmZwaCA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJ
ZHB0eHJkKGl0NjUwNSwgMHhiMywgJnJkZGF0YSk7CisJZHB0eHJkKGl0NjUwNSwgMHhiNCwgJnJk
ZGF0YTEpOworCXZzeW5jdyA9ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJ
c3VtID0gMDsKKwlmb3IgKGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKKwkJZHB0eHNldChpdDY1MDUs
IDB4MTIsIDB4ODAsIDB4ODApOworCQl1c2xlZXBfcmFuZ2UoMTAwMDAsIDE1MDAwKTsKKwkJZHB0
eHNldChpdDY1MDUsIDB4MTIsIDB4ODAsIDB4MDApOworCisJCWRwdHhyZChpdDY1MDUsIDB4MTMs
ICZyZGRhdGEpOworCQlkcHR4cmQoaXQ2NTA1LCAweDE0LCAmcmRkYXRhMSk7CisJCXJkZGF0YSA9
ICgocmRkYXRhMSAmIDB4MEYpIDw8IDgpICsgcmRkYXRhOworCisJCXN1bSArPSByZGRhdGE7CisJ
fQorCisJc3VtIC89IDEwMDsKKwlwY2xrID0gMTM1MDAgKiAyMDQ4IC8gc3VtOworCWl0NjUwNS0+
dmlkX2luZm8uY2xvY2sgPSBwY2xrOworCWl0NjUwNS0+dmlkX2luZm8uaGRpc3BsYXkgPSBoZGV3
OworCWl0NjUwNS0+dmlkX2luZm8uaHN5bmNfc3RhcnQgPSBoZGV3ICsgaGZwaDsKKwlpdDY1MDUt
PnZpZF9pbmZvLmhzeW5jX2VuZCA9IGhkZXcgKyBoZnBoICsgaHN5bmN3OworCWl0NjUwNS0+dmlk
X2luZm8uaHRvdGFsID0gaHRvdGFsOworCWl0NjUwNS0+dmlkX2luZm8udmRpc3BsYXkgPSB2ZGV3
OworCWl0NjUwNS0+dmlkX2luZm8udnN5bmNfc3RhcnQgPSB2ZGV3ICsgdmZwaDsKKwlpdDY1MDUt
PnZpZF9pbmZvLnZzeW5jX2VuZCA9IHZkZXcgKyB2ZnBoICsgdnN5bmN3OworCWl0NjUwNS0+dmlk
X2luZm8udnRvdGFsID0gdnRvdGFsOworCWl0NjUwNS0+dmlkX2luZm8udnJlZnJlc2ggPSBwY2xr
IC8gaHRvdGFsIC8gdnRvdGFsOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoJml0NjUwNS0+Y2xp
ZW50LT5kZXYsIERSTV9NT0RFX0ZNVCwKKwkJCSAgICAgRFJNX01PREVfQVJHKCZpdDY1MDUtPnZp
ZF9pbmZvKSk7Cit9CisKK3N0YXRpYyB2b2lkIHNob3dfYXVkX21jbnQoc3RydWN0IGl0NjUwNSAq
aXQ2NTA1KQoreworCXVuc2lnbmVkIGludCBhdWRuLCByZWdkZSwgcmVnZGYsIHJlZ2UwLCB2Y2xr
LCBhY2xrLCBhdWRtY2FsLCBhdWRtY250OworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUt
PmNsaWVudC0+ZGV2OworCisJZHB0eHJkKGl0NjUwNSwgMHhkZSwgJnJlZ2RlKTsKKwlkcHR4cmQo
aXQ2NTA1LCAweGRmLCAmcmVnZGYpOworCWRwdHhyZChpdDY1MDUsIDB4ZTAsICZyZWdlMCk7CisJ
YXVkbiA9IHJlZ2RlICsgKHJlZ2RmIDw8IDgpICsgKHJlZ2UwIDw8IDE2KTsKKwlpZiAoaXQ2NTA1
LT5oYnIpCisJCXZjbGsgPSAyNzAwMDAwOworCWVsc2UKKwkJdmNsayA9IDE2MjAwMDA7CisJc3dp
dGNoIChpdDY1MDUtPmF1ZF9mcykgeworCWNhc2UgQVVEMzJLOgorCQlhY2xrID0gMzIwOworCQli
cmVhazsKKwljYXNlIEFVRDQ4SzoKKwkJYWNsayA9IDQ4MDsKKwkJYnJlYWs7CisJY2FzZSBBVUQ5
Nks6CisJCWFjbGsgPSA5NjA7CisJCWJyZWFrOworCWNhc2UgQVVEMTkySzoKKwkJYWNsayA9IDE5
MjA7CisJCWJyZWFrOworCWNhc2UgQVVENDRQMUs6CisJCWFjbGsgPSA0NDE7CisJY2FzZSBBVUQ4
OFAySzoKKwkJYWNsayA9IDg4MjsKKwkJYnJlYWs7CisJY2FzZSBBVUQxNzZQNEs6CisJCWFjbGsg
PSAxNzY0OworCQlicmVhazsKKwlkZWZhdWx0OgorCQlhY2xrID0gMDsKKwkJYnJlYWs7CisJfQor
CWF1ZG1jYWwgPSBhdWRuICogYWNsayAvIHZjbGsgKiA1MTI7CisJZHB0eHJkKGl0NjUwNSwgMHhl
NCwgJnJlZ2RlKTsKKwlkcHR4cmQoaXQ2NTA1LCAweGU1LCAmcmVnZGYpOworCWRwdHhyZChpdDY1
MDUsIDB4ZTYsICZyZWdlMCk7CisJYXVkbWNudCA9IChyZWdlMCA8PCAxNikgKyAocmVnZGYgPDwg
OCkgKyByZWdkZTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJhdWRpbyBOOjB4JTA2eCIs
IGF1ZG4pOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgImF1ZGlvIE1jYWw6MHglMDZ4Iiwg
YXVkbWNhbCk7CisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiYXVkaW8gTWNudDoweCUwNngi
LCBhdWRtY250KTsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKmNvbnN0IHN0YXRlX3N0cmluZ1td
ID0geworCVtTWVNfVU5QTFVHXSA9ICJTWVNfVU5QTFVHIiwKKwlbU1lTX0hQRF0gPSAiU1lTX0hQ
RCIsCisJW1NZU19BVVRPVFJBSU5dID0gIlNZU19BVVRPVFJBSU4iLAorCVtTWVNfV0FJVF0gPSAi
U1lTX1dBSVQiLAorCVtTWVNfVFJBSU5GQUlMXSA9ICJTWVNfVFJBSU5GQUlMIiwKKwlbU1lTX1Jl
SERDUF0gPSAiU1lTX1JlSERDUCIsCisJW1NZU19OT1JPUF0gPSAiU1lTX05PUk9QIiwKKwlbU1lT
X1Vua25vd25dID0gIlNZU19Vbmtub3duIiwKK307CisKK3N0YXRpYyB2b2lkIGRwdHhfc3lzX2No
ZyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIGVudW0gc3lzX3N0YXR1cyBuZXdzdGF0ZSkKK3sKKwlp
bnQgaSA9IDA7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisK
KwlpZiAobmV3c3RhdGUgIT0gU1lTX1VOUExVRykgeworCQlpZiAoIWRwdHhfZ2V0c2lua2hwZChp
dDY1MDUpKQorCQkJbmV3c3RhdGUgPSBTWVNfVU5QTFVHOworCX0KKwlpZiAoaXQ2NTA1LT5zdGF0
dXMgPT0gbmV3c3RhdGUpCisJCXJldHVybjsKKworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwg
InN5c19zdGF0ZSBjaGFuZ2U6ICVzIC0+ICVzIiwKKwkJCSAgICAgc3RhdGVfc3RyaW5nW2l0NjUw
NS0+c3RhdHVzXSwKKwkJCSAgICAgc3RhdGVfc3RyaW5nW25ld3N0YXRlXSk7CisJaXQ2NTA1LT5z
dGF0dXMgPSBuZXdzdGF0ZTsKKworCXN3aXRjaCAoaXQ2NTA1LT5zdGF0dXMpIHsKKwljYXNlIFNZ
U19VTlBMVUc6CisJCWtmcmVlKGl0NjUwNS0+ZWRpZCk7CisJCWl0NjUwNS0+ZWRpZCA9IE5VTEw7
CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkZyZWUgaXQ2NTA1IEVESUQgbWVtb3J5Iik7
CisJCWl0NjUwNV9pbml0X2FuZF9tYXNrX29uKGl0NjUwNSk7CisJCWl0NjUwNV90ZXJtaW5hdGlv
bl9vZmYoaXQ2NTA1KTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfSFBEOgorCQlpdDY1MDVfdGVybWlu
YXRpb25fb24oaXQ2NTA1KTsKKwkJYnJlYWs7CisJY2FzZSBTWVNfQVVUT1RSQUlOOgorCQlicmVh
azsKKwljYXNlIFNZU19XQUlUOgorCQlicmVhazsKKwljYXNlIFNZU19SZUhEQ1A6CisJCWJyZWFr
OworCWNhc2UgU1lTX05PUk9QOgorCQlmb3IgKGkgPSAwOyBpIDwgU0hPV1ZJREVPVElNSU5HOyBp
KyspCisJCQlzaG93X3ZpZF9pbmZvKGl0NjUwNSk7CisJCWJyZWFrOworCWNhc2UgU1lTX1RSQUlO
RkFJTDoKKwkJLyogaXQ2NTA1IGdvZXMgdG8gaWRsZSAqLworCQlicmVhazsKKwlkZWZhdWx0Ogor
CQlicmVhazsKKwl9Cit9CisKK3N0YXRpYyBib29sIGl0NjUwNV9hdXhfb3BfZmluaXNoZWQoc3Ry
dWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXVuc2lnbmVkIGludCB2YWx1ZTsKKwlpbnQgZXJyOwor
CisJZXJyID0gcmVnbWFwX3JlYWQoaXQ2NTA1LT5yZWdtYXAsIDB4MmIsICZ2YWx1ZSk7CisJaWYg
KGVyciA8IDApCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiAodmFsdWUgJiBCSVQoNSkpID09
IDA7Cit9CisKK3N0YXRpYyBpbnQgZHB0eF9hdXh3YWl0KHN0cnVjdCBpdDY1MDUgKml0NjUwNSkK
K3sKKwl1bnNpZ25lZCBpbnQgc3RhdHVzOworCXVuc2lnbmVkIGxvbmcgdGltZW91dDsKKwlpbnQg
ZXJyOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJdGlt
ZW91dCA9IGppZmZpZXMgKyBtc2Vjc190b19qaWZmaWVzKEFVWF9XQUlUX1RJTUVPVVRfTVMpICsg
MTsKKworCXdoaWxlICghaXQ2NTA1X2F1eF9vcF9maW5pc2hlZChpdDY1MDUpKSB7CisJCWlmICh0
aW1lX2FmdGVyKGppZmZpZXMsIHRpbWVvdXQpKSB7CisJCQlEUk1fREVWX0VSUk9SKGRldiwgIlRp
bWVkIG91dCB3YWl0aW5nIEFVWCB0byBmaW5pc2giKTsKKwkJCXJldHVybiAtRVRJTUVET1VUOwor
CQl9CisJCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsKKwl9CisKKwllcnIgPSBkcHR4cmQoaXQ2
NTA1LCAweDlmLCAmc3RhdHVzKTsKKwlpZiAoZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGRl
diwgIkZhaWxlZCB0byByZWFkIEFVWCBjaGFubmVsOiAlZCIsIGVycik7CisJCXJldHVybiBlcnI7
CisJfQorCisJaWYgKHN0YXR1cyAmIDB4MDMpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJGYWls
ZWQgdG8gd2FpdCBmb3IgQVVYIChzdGF0dXM6IDB4JXgpIiwKKwkJCSAgICAgIHN0YXR1cyk7CisJ
CXJldHVybiAtRVRJTUVET1VUOworCX0KKworCXJldHVybiAwOworfQorCitlbnVtIGF1eF9jbWRf
dHlwZSB7CisJQ01EX0FVWF9OQVRJVkVfUkVBRCA9IDB4MCwKKwlDTURfQVVYX05BVElWRV9XUklU
RSA9IDB4NSwKKwlDTURfQVVYX0kyQ19FRElEX1JFQUQgPSAweEIsCit9OworCitlbnVtIGF1eF9j
bWRfcmVwbHkgeworCVJFUExZX0FDSywKKwlSRVBMWV9OQUNLLAorCVJFUExZX0RFRkVSLAorfTsK
Kworc3RhdGljIHNzaXplX3QgaXQ2NTA1X2F1eF9kb190cmFuc2ZlcihzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUsCisJCQkJICAgICAgZW51bSBhdXhfY21kX3R5cGUgY21kLAorCQkJCSAgICAgIHVuc2ln
bmVkIGludCBhZGRyZXNzLCB1OCAqYnVmZmVyLAorCQkJCSAgICAgIHNpemVfdCBzaXplLCBlbnVt
IGF1eF9jbWRfcmVwbHkgKnJlcGx5KQoreworCWludCByZXQ7CisJaW50IGk7CisJaW50IHN0YXR1
cywgdmFsOworCisJaWYgKGNtZCA9PSBDTURfQVVYX0kyQ19FRElEX1JFQUQpIHsKKwkJLyogRFAg
QVVYIEVESUQgRklGTyBoYXMgbWF4aW11bSBsZW5ndGggb2YgMTYgYnl0ZXMuICovCisJCXNpemUg
PSBtaW5fdChzaXplX3QsIHNpemUsIEFVWF9GSUZPX01BWF9TSVpFKTsKKwkJLyogRW5hYmxlIEFV
WCBGSUZPIHJlYWQgYmFjayBhbmQgY2xlYXIgRklGTyAqLworCQlkcHR4d3IoaXQ2NTA1LCAweDIz
LCAweEMzKTsKKwkJZHB0eHdyKGl0NjUwNSwgMHgyMywgMHhDMik7CisJfSBlbHNlIHsKKwkJLyog
VGhlIERQIEFVWCB0cmFuc21pdCBidWZmZXIgaGFzIDQgYnl0ZXMuICovCisJCXNpemUgPSBtaW5f
dChzaXplX3QsIHNpemUsIDQpOworCQlkcHR4d3IoaXQ2NTA1LCAweDIzLCAweDQyKTsKKwl9CisK
KwkvKiBTdGFydCBBZGRyZXNzWzc6MF0gKi8KKwlkcHR4d3IoaXQ2NTA1LCAweDI0LCAoYWRkcmVz
cyA+PiAwKSAmIDB4RkYpOworCS8qIFN0YXJ0IEFkZHJlc3NbMTU6OF0gKi8KKwlkcHR4d3IoaXQ2
NTA1LCAweDI1LCAoYWRkcmVzcyA+PiA4KSAmIDB4RkYpOworCS8qIFdyaXRlTnVtWzM6MF0rU3Rh
cnRBZHJbMTk6MTZdICovCisJZHB0eHdyKGl0NjUwNSwgMHgyNiwgKChhZGRyZXNzID4+IDE2KSAm
IDB4MEYpIHwgKChzaXplIC0gMSkgPDwgNCkpOworCisJaWYgKGNtZCA9PSBDTURfQVVYX05BVElW
RV9XUklURSkKKwkJcmVnbWFwX2J1bGtfd3JpdGUoaXQ2NTA1LT5yZWdtYXAsIDB4MjcsIGJ1ZmZl
ciwgc2l6ZSk7CisKKwkvKiBBdXggRmlyZSAqLworCWRwdHh3cihpdDY1MDUsIDB4MkIsIGNtZCk7
CisKKwlyZXQgPSBkcHR4X2F1eHdhaXQoaXQ2NTA1KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJu
IHJldDsKKworCXJldCA9IGRwdHhyZChpdDY1MDUsIDB4OUYsICZzdGF0dXMpOworCWlmIChyZXQg
PCAwKQorCQlyZXR1cm4gcmV0OworCisJc3dpdGNoICgoc3RhdHVzID4+IDYpICYgMHgzKSB7CisJ
Y2FzZSAwOgorCQkqcmVwbHkgPSBSRVBMWV9BQ0s7CisJCWJyZWFrOworCWNhc2UgMToKKwkJKnJl
cGx5ID0gUkVQTFlfTkFDSzsKKwkJcmV0dXJuIDA7CisJY2FzZSAyOgorCQkqcmVwbHkgPSBSRVBM
WV9ERUZFUjsKKwkJcmV0dXJuIDA7CisJY2FzZSAzOgorCQlyZXR1cm4gLUVUSU1FRE9VVDsKKwl9
CisKKwlpZiAoY21kID09IENNRF9BVVhfTkFUSVZFX1dSSVRFKQorCQlnb3RvIG91dDsKKworCWlm
IChjbWQgPT0gQ01EX0FVWF9JMkNfRURJRF9SRUFEKSB7CisJCWZvciAoaSA9IDA7IGkgPCBzaXpl
OyBpKyspIHsKKwkJCXJldCA9IGRwdHhyZChpdDY1MDUsIDB4MkYsICZ2YWwpOworCQkJaWYgKHJl
dCA8IDApCisJCQkJcmV0dXJuIHJldDsKKwkJCWJ1ZmZlcltpXSA9IHZhbDsKKwkJfQorCX0gZWxz
ZSB7CisJCWZvciAoaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKKwkJCXJldCA9IGRwdHhyZChpdDY1
MDUsIDB4MkMgKyBpLCAmdmFsKTsKKwkJCWlmIChyZXQgPCAwKQorCQkJCXJldHVybiByZXQ7CisJ
CQlidWZmZXJbc2l6ZSAtIDEgLSBpXSA9IHZhbDsKKwkJfQorCX0KKworb3V0OgorCWRwdHh3cihp
dDY1MDUsIDB4MjMsIDB4NDApOworCXJldHVybiBzaXplOworfQorCitzdGF0aWMgc3NpemVfdCBp
dDY1MDVfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCisJCQkJICAgc3RydWN0
IGRybV9kcF9hdXhfbXNnICptc2cpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gY29udGFp
bmVyX29mKGF1eCwgc3RydWN0IGl0NjUwNSwgYXV4KTsKKwl1OCBjbWQ7CisJYm9vbCBpc19pMmMg
PSAhKG1zZy0+cmVxdWVzdCAmIERQX0FVWF9OQVRJVkVfV1JJVEUpOworCWludCByZXQ7CisJZW51
bSBhdXhfY21kX3JlcGx5IHJlcGx5OworCisJLyogSVQ2NTA1IGRvZXNuJ3Qgc3VwcG9ydCBhcmJp
dHJhcnkgSTJDIHJlYWQgLyB3cml0ZS4gKi8KKwlpZiAoaXNfaTJjKQorCQlyZXR1cm4gLUVJTlZB
TDsKKworCXN3aXRjaCAobXNnLT5yZXF1ZXN0KSB7CisJY2FzZSBEUF9BVVhfTkFUSVZFX1JFQUQ6
CisJCWNtZCA9IENNRF9BVVhfTkFUSVZFX1JFQUQ7CisJCWJyZWFrOworCWNhc2UgRFBfQVVYX05B
VElWRV9XUklURToKKwkJY21kID0gQ01EX0FVWF9OQVRJVkVfV1JJVEU7CisJCWJyZWFrOworCWRl
ZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldCA9IGl0NjUwNV9hdXhfZG9fdHJh
bnNmZXIoaXQ2NTA1LCBjbWQsIG1zZy0+YWRkcmVzcywgbXNnLT5idWZmZXIsCisJCQkJICAgICBt
c2ctPnNpemUsICZyZXBseSk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlzd2l0
Y2ggKHJlcGx5KSB7CisJY2FzZSBSRVBMWV9BQ0s6CisJCW1zZy0+cmVwbHkgPSBEUF9BVVhfTkFU
SVZFX1JFUExZX0FDSzsKKwkJYnJlYWs7CisJY2FzZSBSRVBMWV9OQUNLOgorCQltc2ctPnJlcGx5
ID0gRFBfQVVYX05BVElWRV9SRVBMWV9OQUNLOworCQlicmVhazsKKwljYXNlIFJFUExZX0RFRkVS
OgorCQltc2ctPnJlcGx5ID0gRFBfQVVYX05BVElWRV9SRVBMWV9ERUZFUjsKKwkJYnJlYWs7CisJ
fQorCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBkcHR4X2dldF9lZGlkYmxvY2sodm9p
ZCAqZGF0YSwgdTggKmJ1ZiwgdW5zaWduZWQgaW50IGJsb2Nrbm8sCisJCQkgICAgICBzaXplX3Qg
bGVuKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGRhdGE7CisJaW50IG9mZnNldCwgcmV0
OworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCWVudW0gYXV4
X2NtZF9yZXBseSByZXBseTsKKworCWRwdHhzZXQoaXQ2NTA1LCAweDA1LCAweDA4LCAweDA4KTsK
KwlkcHR4c2V0KGl0NjUwNSwgMHgwNSwgMHgwOCwgMHgwMCk7CisJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAiYmxvY2tudW0gPSAlZCIsIGJsb2Nrbm8pOworCisJZm9yIChvZmZzZXQgPSAwOyBv
ZmZzZXQgPCBFRElEX0xFTkdUSDsgb2Zmc2V0ICs9IDgpIHsKKwkJcmV0ID0gaXQ2NTA1X2F1eF9k
b190cmFuc2ZlcihpdDY1MDUsIENNRF9BVVhfSTJDX0VESURfUkVBRCwKKwkJCQkJICAgICBibG9j
a25vICogRURJRF9MRU5HVEggKyBvZmZzZXQsCisJCQkJCSAgICAgYnVmICsgb2Zmc2V0LCA4LCAm
cmVwbHkpOworCQlpZiAocmV0IDwgMCkKKwkJCXJldHVybiByZXQ7CisJCWlmIChyZXBseSAhPSBS
RVBMWV9BQ0spCisJCQlyZXR1cm4gLUVJTzsKKworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYs
ICJbMHglMDJ4XTogJThwaCIsIG9mZnNldCwKKwkJCQkgICAgIGJ1ZiArIG9mZnNldCk7CisJfQor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X2dldF9tb2RlcyhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGNvbm5l
Y3Rvcl90b19pdDY1MDUoY29ubmVjdG9yKTsKKwlpbnQgZXJyLCBudW1fbW9kZXMgPSAwOworCXN0
cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaXQ2NTA1LT50cmFp
bl9mYWlsX2hwZCA9IFRSQUlORkFJTEhQRDsKKwlpZiAoaXQ2NTA1LT5lZGlkKQorCQlyZXR1cm4g
ZHJtX2FkZF9lZGlkX21vZGVzKGNvbm5lY3RvciwgaXQ2NTA1LT5lZGlkKTsKKwltdXRleF9sb2Nr
KCZpdDY1MDUtPm1vZGVfbG9jayk7CisKKwlpdDY1MDVfZHVtcChpdDY1MDUpOworCWRwdHhfZGVi
dWdfcHJpbnQoaXQ2NTA1LCAweDlGLCAiYXV4IHN0YXR1cyIpOworCWl0NjUwNS0+ZWRpZCA9CisJ
CWRybV9kb19nZXRfZWRpZCgmaXQ2NTA1LT5jb25uZWN0b3IsIGRwdHhfZ2V0X2VkaWRibG9jaywg
aXQ2NTA1KTsKKwlpZiAoIWl0NjUwNS0+ZWRpZCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZh
aWxlZCB0byByZWFkIEVESUQiKTsKKwkJZ290byB1bmxvY2s7CisJfQorCisJZXJyID0gZHJtX2Nv
bm5lY3Rvcl91cGRhdGVfZWRpZF9wcm9wZXJ0eShjb25uZWN0b3IsIGl0NjUwNS0+ZWRpZCk7CisJ
aWYgKGVycikgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byB1cGRhdGUgRURJRCBw
cm9wZXJ0eTogJWQiLCBlcnIpOworCQlnb3RvIHVubG9jazsKKwl9CisKKwludW1fbW9kZXMgPSBk
cm1fYWRkX2VkaWRfbW9kZXMoY29ubmVjdG9yLCBpdDY1MDUtPmVkaWQpOworCit1bmxvY2s6CisJ
bXV0ZXhfdW5sb2NrKCZpdDY1MDUtPm1vZGVfbG9jayk7CisKKwlyZXR1cm4gbnVtX21vZGVzOwor
fQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzIGl0NjUw
NV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzID0geworCS5nZXRfbW9kZXMgPSBpdDY1MDVfZ2V0X21v
ZGVzLAorfTsKKworc3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMgaXQ2NTA1X2RldGVj
dChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCQkgICAgICAgYm9vbCBmb3Jj
ZSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBjb25uZWN0b3JfdG9faXQ2NTA1KGNvbm5l
Y3Rvcik7CisKKwlpZiAoZ3Bpb2RfZ2V0X3ZhbHVlKGl0NjUwNS0+cGRhdGEuZ3Bpb2RfaHBkKSkK
KwkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVjdGVkOworCisJcmV0dXJuIGNvbm5l
Y3Rvcl9zdGF0dXNfY29ubmVjdGVkOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25u
ZWN0b3JfZnVuY3MgaXQ2NTA1X2Nvbm5lY3Rvcl9mdW5jcyA9IHsKKwkuZmlsbF9tb2RlcyA9IGRy
bV9oZWxwZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcywKKwkuZGV0ZWN0ID0gaXQ2NTA1
X2RldGVjdCwKKwkuZGVzdHJveSA9IGRybV9jb25uZWN0b3JfY2xlYW51cCwKKwkucmVzZXQgPSBk
cm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfcmVzZXQsCisJLmF0b21pY19kdXBsaWNhdGVfc3Rh
dGUgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9t
aWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2Nvbm5lY3Rvcl9kZXN0cm95X3N0
YXRlLAorfTsKKworc3RhdGljIGludCBpdDY1MDVfZXh0Y29uX25vdGlmaWVyKHN0cnVjdCBub3Rp
Zmllcl9ibG9jayAqc2VsZiwKKwkJCQkgIHVuc2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0cikK
K3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBjb250YWluZXJfb2Yoc2VsZiwgc3RydWN0IGl0
NjUwNSwgZXZlbnRfbmIpOworCisJc2NoZWR1bGVfd29yaygmaXQ2NTA1LT5leHRjb25fd3EpOwor
CXJldHVybiBOT1RJRllfRE9ORTsKK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2V4dGNvbl93b3Jr
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBj
b250YWluZXJfb2Yod29yaywgc3RydWN0IGl0NjUwNSwgZXh0Y29uX3dxKTsKKwlpbnQgc3RhdGUg
PSBleHRjb25fZ2V0X3N0YXRlKGl0NjUwNS0+ZXh0Y29uLCBFWFRDT05fRElTUF9EUCk7CisJdW5z
aWduZWQgaW50IHB3cm9mZnJldHJ5ID0gMDsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1
LT5jbGllbnQtPmRldjsKKworCWlmIChpdDY1MDUtPmRydl9ob2xkKQorCQlyZXR1cm47CisJbXV0
ZXhfbG9jaygmaXQ2NTA1LT5sb2NrKTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJFWFRD
T05fRElTUF9EUCA9IDB4JTAyeCIsIHN0YXRlKTsKKwlpZiAoc3RhdGUgPiAwKSB7CisJCURSTV9E
RVZfREVCVUdfRFJJVkVSKGRldiwgInN0YXJ0IHRvIHBvd2VyIG9uIik7CisJCW1zbGVlcCgxMDAw
KTsKKwkJaXQ2NTA1X3Bvd2Vyb24oaXQ2NTA1KTsKKwkJaWYgKCFkcHR4X2dldHNpbmtocGQoaXQ2
NTA1KSkKKwkJCWl0NjUwNV90ZXJtaW5hdGlvbl9vZmYoaXQ2NTA1KTsKKwl9IGVsc2UgeworCQlp
ZiAoaXQ2NTA1LT5lbl9wd3Jvbm9mZikgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
c3RhcnQgdG8gcG93ZXIgb2ZmIik7CisJCQl3aGlsZSAoaXQ2NTA1X3Bvd2Vyb2ZmKGl0NjUwNSkg
JiYKKwkJCSAgICAgICBwd3JvZmZyZXRyeSsrIDwgUFdST0ZGUkVUUllUSU1FKSB7CisJCQkJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LAorCQkJCQkJICAgICAicG93ZXIgb2ZmIGZhaWwgJWQgdGlt
ZXMiLAorCQkJCQkJICAgICBwd3JvZmZyZXRyeSk7CisJCQl9CisJCQlkcm1faGVscGVyX2hwZF9p
cnFfZXZlbnQoaXQ2NTA1LT5jb25uZWN0b3IuZGV2KTsKKwkJCURSTV9ERVZfREVCVUdfRFJJVkVS
KGRldiwgInBvd2VyIG9mZiBpdDY1MDUgc3VjY2VzcyEiKTsKKwkJfQorCX0KKwltdXRleF91bmxv
Y2soJml0NjUwNS0+bG9jayk7Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X3VzZV9ub3RpZmllcl9t
b2R1bGUoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWludCByZXQ7CisJc3RydWN0IGRldmlj
ZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpdDY1MDUtPmV2ZW50X25iLm5vdGlm
aWVyX2NhbGwgPSBpdDY1MDVfZXh0Y29uX25vdGlmaWVyOworCUlOSVRfV09SSygmaXQ2NTA1LT5l
eHRjb25fd3EsIGl0NjUwNV9leHRjb25fd29yayk7CisJcmV0ID0gZGV2bV9leHRjb25fcmVnaXN0
ZXJfbm90aWZpZXIoJml0NjUwNS0+Y2xpZW50LT5kZXYsCisJCQkJCSAgICBpdDY1MDUtPmV4dGNv
biwgRVhUQ09OX0RJU1BfRFAsCisJCQkJCSAgICAmaXQ2NTA1LT5ldmVudF9uYik7CisJaWYgKHJl
dCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgImZhaWxlZCB0byByZWdpc3RlciBub3RpZmllciBm
b3IgRFAiKTsKKwkJcmV0dXJuIHJldDsKKwl9CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
aXQ2NTA1X2JyaWRnZV9hdHRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1
Y3QgaXQ2NTA1ICppdDY1MDUgPSBicmlkZ2VfdG9faXQ2NTA1KGJyaWRnZSk7CisJc3RydWN0IGRl
dmljZSAqZGV2OworCWludCBlcnI7CisKKwlkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKwlp
ZiAoIWJyaWRnZS0+ZW5jb2RlcikgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIlBhcmVudCBlbmNv
ZGVyIG9iamVjdCBub3QgZm91bmQiKTsKKwkJcmV0dXJuIC1FTk9ERVY7CisJfQorCisJZXJyID0g
ZHJtX2Nvbm5lY3Rvcl9pbml0KGJyaWRnZS0+ZGV2LCAmaXQ2NTA1LT5jb25uZWN0b3IsCisJCQkJ
ICZpdDY1MDVfY29ubmVjdG9yX2Z1bmNzLAorCQkJCSBEUk1fTU9ERV9DT05ORUNUT1JfRGlzcGxh
eVBvcnQpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRv
IGluaXRpYWxpemUgY29ubmVjdG9yOiAlZCIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJ
ZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRkKCZpdDY1MDUtPmNvbm5lY3RvciwKKwkJCQkgJml0NjUw
NV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzKTsKKworCWl0NjUwNS0+Y29ubmVjdG9yLnBvbGxlZCA9
IERSTV9DT05ORUNUT1JfUE9MTF9IUEQ7CisKKwllcnIgPSBkcm1fY29ubmVjdG9yX2F0dGFjaF9l
bmNvZGVyKCZpdDY1MDUtPmNvbm5lY3RvciwgYnJpZGdlLT5lbmNvZGVyKTsKKwlpZiAoZXJyIDwg
MCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byBsaW5rIHVwIGNvbm5lY3RvciB0
byBlbmNvZGVyOiAlZCIsCisJCQkgICAgICBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCWVy
ciA9IGRybV9jb25uZWN0b3JfcmVnaXN0ZXIoJml0NjUwNS0+Y29ubmVjdG9yKTsKKwlpZiAoZXJy
IDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byByZWdpc3RlciBjb25uZWN0
b3I6ICVkIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwllcnIgPSBpdDY1MDVfdXNlX25v
dGlmaWVyX21vZHVsZShpdDY1MDUpOworCWlmIChlcnIgPCAwKSB7CisJCWRybV9jb25uZWN0b3Jf
dW5yZWdpc3RlcigmaXQ2NTA1LT5jb25uZWN0b3IpOworCQlyZXR1cm4gZXJyOworCX0KKwlzY2hl
ZHVsZV93b3JrKCZpdDY1MDUtPmV4dGNvbl93cSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IHZvaWQgaXQ2NTA1X2JyaWRnZV9kZXRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sK
KwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBicmlkZ2VfdG9faXQ2NTA1KGJyaWRnZSk7CisKKwlk
ZXZtX2V4dGNvbl91bnJlZ2lzdGVyX25vdGlmaWVyKCZpdDY1MDUtPmNsaWVudC0+ZGV2LCBpdDY1
MDUtPmV4dGNvbiwKKwkJCQkJRVhUQ09OX0RJU1BfRFAsICZpdDY1MDUtPmV2ZW50X25iKTsKKwlm
bHVzaF93b3JrKCZpdDY1MDUtPmV4dGNvbl93cSk7CisJZHJtX2Nvbm5lY3Rvcl91bnJlZ2lzdGVy
KCZpdDY1MDUtPmNvbm5lY3Rvcik7Cit9CisKK3N0YXRpYyBlbnVtIGRybV9tb2RlX3N0YXR1cwor
aXQ2NTA1X2JyaWRnZV9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkg
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCit7CisJaWYgKG1vZGUtPmZsYWdz
ICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpCisJCXJldHVybiBNT0RFX05PX0lOVEVSTEFDRTsK
KworCS8qIE1heCAxMjAwcCBhdCA1LjQgR2h6LCBvbmUgbGFuZSAqLworCWlmIChtb2RlLT5jbG9j
ayA+IE1BWFBDTEspCisJCXJldHVybiBNT0RFX0NMT0NLX0hJR0g7CisKKwlyZXR1cm4gTU9ERV9P
SzsKK30KKworc3RhdGljIGludCBpdDY1MDVfc2VuZF92aWRlb19pbmZvZnJhbWUoc3RydWN0IGl0
NjUwNSAqaXQ2NTA1LAorCQkJCSAgICAgICBzdHJ1Y3QgaGRtaV9hdmlfaW5mb2ZyYW1lICpmcmFt
ZSkKK3sKKwl1OCBidWZmZXJbSERNSV9JTkZPRlJBTUVfSEVBREVSX1NJWkUgKyBIRE1JX0FWSV9J
TkZPRlJBTUVfU0laRV07CisJaW50IGVycjsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1
LT5jbGllbnQtPmRldjsKKworCWVyciA9IGhkbWlfYXZpX2luZm9mcmFtZV9wYWNrKGZyYW1lLCBi
dWZmZXIsIHNpemVvZihidWZmZXIpKTsKKwlpZiAoZXJyIDwgMCkgeworCQlEUk1fREVWX0VSUk9S
KGRldiwgIkZhaWxlZCB0byBwYWNrIEFWSSBpbmZvZnJhbWU6ICVkXG4iLCBlcnIpOworCQlyZXR1
cm4gZXJyOworCX0KKworCWVyciA9IGRwdHhzZXQoaXQ2NTA1LCAweGU4LCAweDAxLCAweDAwKTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gcmVnbWFwX2J1bGtfd3JpdGUoaXQ2
NTA1LT5yZWdtYXAsIDB4ZTksCisJCQkJYnVmZmVyICsgSERNSV9JTkZPRlJBTUVfSEVBREVSX1NJ
WkUsCisJCQkJZnJhbWUtPmxlbmd0aCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVy
ciA9IGRwdHhzZXQoaXQ2NTA1LCAweGU4LCAweDAxLCAweDAxKTsKKwlpZiAoZXJyKQorCQlyZXR1
cm4gZXJyOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9icmlkZ2VfbW9k
ZV9zZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkgICBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZSwKKwkJCQkgICBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBicmlkZ2VfdG9faXQ2NTA1KGJyaWRn
ZSk7CisJc3RydWN0IGhkbWlfYXZpX2luZm9mcmFtZSBmcmFtZTsKKwlpbnQgZXJyOworCXN0cnVj
dCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJbXV0ZXhfbG9jaygmaXQ2
NTA1LT5tb2RlX2xvY2spOworCWVyciA9IGRybV9oZG1pX2F2aV9pbmZvZnJhbWVfZnJvbV9kaXNw
bGF5X21vZGUoJmZyYW1lLCBhZGp1c3RlZF9tb2RlLAorCQkJCQkJICAgICAgIGZhbHNlKTsKKwlp
ZiAoZXJyKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHNldHVwIEFWSSBpbmZv
ZnJhbWU6ICVkIiwgZXJyKTsKKwkJZ290byB1bmxvY2s7CisJfQorCWl0NjUwNS0+dmlkX2luZm8u
YmFzZS5pZCA9IGFkanVzdGVkX21vZGUtPmJhc2UuaWQ7CisJc3RybGNweShpdDY1MDUtPnZpZF9p
bmZvLm5hbWUsIGFkanVzdGVkX21vZGUtPm5hbWUsCisJCURSTV9ESVNQTEFZX01PREVfTEVOKTsK
KwlpdDY1MDUtPnZpZF9pbmZvLnR5cGUgPSBhZGp1c3RlZF9tb2RlLT50eXBlOworCWl0NjUwNS0+
dmlkX2luZm8uZmxhZ3MgPSBhZGp1c3RlZF9tb2RlLT5mbGFnczsKKwllcnIgPSBpdDY1MDVfc2Vu
ZF92aWRlb19pbmZvZnJhbWUoaXQ2NTA1LCAmZnJhbWUpOworCWlmIChlcnIpCisJCURSTV9ERVZf
RVJST1IoZGV2LCAiRmFpbGVkIHRvIHNlbmQgQVZJIGluZm9mcmFtZTogJWQiLCBlcnIpOworCit1
bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZpdDY1MDUtPm1vZGVfbG9jayk7Cit9CisKK3N0YXRpYyB2
b2lkIGRwdHhfc2V0X2F1ZF9mbXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXVuc2lnbmVk
IGludCBhdWRzcmM7CisJLyogSTJTIE1PREUgKi8KKwlkcHR4d3IoaXQ2NTA1LCAweEI5LAorCSAg
ICAgICAoaXQ2NTA1LT5hdWR3b3JkbGVuZ3RoIDw8IDUpIHwgKGl0NjUwNS0+aTJzX2RhdGFfc2Vx
IDw8IDQpIHwKKwkJICAgICAgIChpdDY1MDUtPmkyc193c19jaGFubmVsIDw8IDMpIHwKKwkJICAg
ICAgIChpdDY1MDUtPmkyc19kYXRhX2RlbGF5IDw8IDIpIHwKKwkJICAgICAgIChpdDY1MDUtPmky
c19qdXN0aWZpZWQgPDwgMSkgfCBpdDY1MDUtPmkyc19pbnB1dF9mbXQpOworCWlmIChpdDY1MDUt
PmF1ZF9zZWwgPT0gU1BESUYpIHsKKwkJZHB0eHdyKGl0NjUwNSwgMHhCQSwgMHgwMCk7CisJCS8q
IDB4MzAgPSAxMjgqRlMgKi8KKwkJZHB0eHNldChpdDY1MDUsIDB4MTEsIDB4RjAsIDB4MzApOwor
CX0gZWxzZSB7CisJCWRwdHh3cihpdDY1MDUsIDB4QkEsIDB4ZTQpOworCX0KKworCWRwdHh3cihp
dDY1MDUsIDB4QkIsIDB4MjApOworCWRwdHh3cihpdDY1MDUsIDB4QkMsIDB4MDApOworCWF1ZHNy
YyA9IDE7CisKKwlpZiAoaXQ2NTA1LT5hdWRfY2ggPiAyKQorCQlhdWRzcmMgfD0gMjsKKworCWlm
IChpdDY1MDUtPmF1ZF9jaCA+IDQpCisJCWF1ZHNyYyB8PSA0OworCisJaWYgKGl0NjUwNS0+YXVk
X2NoID4gNikKKwkJYXVkc3JjIHw9IDg7CisKKwlhdWRzcmMgfD0gaXQ2NTA1LT5hdWRfc2VsIDw8
IDQ7CisKKwlkcHR4d3IoaXQ2NTA1LCAweEI4LCBhdWRzcmMpOworfQorCitzdGF0aWMgdm9pZCBk
cHR4X3NldF9hdWRfY2hzdHMoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWVudW0gaXQ2NTA1
X2F1ZF9mcyBhdWRmcyA9IGl0NjUwNS0+YXVkX2ZzOworCisJLyogQ2hhbm5lbCBTdGF0dXMgKi8K
KwlkcHR4d3IoaXQ2NTA1LCAweEJGLCBpdDY1MDUtPmF1ZF90eXBlIDw8IDEpOworCWRwdHh3cihp
dDY1MDUsIDB4QzAsIDB4MDApOworCWRwdHh3cihpdDY1MDUsIDB4QzEsIDB4MDApOworCWRwdHh3
cihpdDY1MDUsIDB4QzIsIGF1ZGZzKTsKKwlzd2l0Y2ggKGl0NjUwNS0+YXVkd29yZGxlbmd0aCkg
eworCWNhc2UgQVVEMTZCSVQ6CisJCWRwdHh3cihpdDY1MDUsIDB4QzMsICh+YXVkZnMgPDwgNCkg
KyAweDAyKTsKKwkJYnJlYWs7CisKKwljYXNlIEFVRDE4QklUOgorCQlkcHR4d3IoaXQ2NTA1LCAw
eEMzLCAofmF1ZGZzIDw8IDQpICsgMHgwNCk7CisJCWJyZWFrOworCisJY2FzZSBBVUQyMEJJVDoK
KwkJZHB0eHdyKGl0NjUwNSwgMHhDMywgKH5hdWRmcyA8PCA0KSArIDB4MDMpOworCQlicmVhazsK
KworCWNhc2UgQVVEMjRCSVQ6CisJCWRwdHh3cihpdDY1MDUsIDB4QzMsICh+YXVkZnMgPDwgNCkg
KyAweDBCKTsKKwkJYnJlYWs7CisJfQorfQorCitzdGF0aWMgdm9pZCBkcHR4X3NldF9hdWRpb19p
bmZvZnJhbWUoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9
ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZHB0eHdyKGl0NjUwNSwgMHhmNywgaXQ2NTA1LT5h
dWRfY2ggLSAxKTsKKworCXN3aXRjaCAoaXQ2NTA1LT5hdWRfY2gpIHsKKwljYXNlIDI6CisJCWRw
dHh3cihpdDY1MDUsIDB4RjksIDB4MDApOworCQlicmVhazsKKwljYXNlIDM6CisJCWRwdHh3cihp
dDY1MDUsIDB4RjksIDB4MDEpOworCQlicmVhazsKKwljYXNlIDQ6CisJCWRwdHh3cihpdDY1MDUs
IDB4RjksIDB4MDMpOworCQlicmVhazsKKwljYXNlIDU6CisJCWRwdHh3cihpdDY1MDUsIDB4Rjks
IDB4MDcpOworCQlicmVhazsKKwljYXNlIDY6CisJCWRwdHh3cihpdDY1MDUsIDB4RjksIDB4MEIp
OworCQlicmVhazsKKwljYXNlIDc6CisJCWRwdHh3cihpdDY1MDUsIDB4RjksIDB4MEYpOworCQli
cmVhazsKKwljYXNlIDg6CisJCWRwdHh3cihpdDY1MDUsIDB4RjksIDB4MUYpOworCQlicmVhazsK
KwlkZWZhdWx0OgorCQlEUk1fREVWX0VSUk9SKGRldiwgImF1ZGlvIGNoYW5uZWwgbnVtYmVyIGVy
cm9yOiAldSIsCisJCQkgICAgICBpdDY1MDUtPmF1ZF9jaCk7CisJfQorCS8qIEVuYWJsZSBBdWRp
byBJbmZvRnJhbWUgKi8KKwlkcHR4c2V0KGl0NjUwNSwgMHhFOCwgMHgyMiwgMHgyMik7Cit9CisK
K3N0YXRpYyB2b2lkIGl0NjUwNV9zZXRfYXVkaW8oc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQorewor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCXVuc2lnbmVkIGlu
dCByZWdiZTsKKworCS8qIEF1ZGlvIENsb2NrIERvbWFpbiBSZXNldCAqLworCWRwdHhzZXQoaXQ2
NTA1LCAweDA1LCAweDAyLCAweDAyKTsKKwkvKiBBdWRpbyBtdXRlICovCisJZHB0eHNldChpdDY1
MDUsIDB4RDMsIDB4MjAsIDB4MjApOworCS8qIFJlbGVhc2UgQXVkaW8gQ2xvY2sgRG9tYWluIFJl
c2V0ICovCisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MDIsIDB4MDApOworCisJZHB0eHJkKGl0
NjUwNSwgMHhCRSwgJnJlZ2JlKTsKKwlpZiAocmVnYmUgPT0gMHhGRikKKwkJRFJNX0RFVl9ERUJV
R19EUklWRVIoZGV2LCAibm8gYXVkaW8gaW5wdXQiKTsKKwllbHNlCisJCURSTV9ERVZfREVCVUdf
RFJJVkVSKGRldiwgImF1ZGlvIGlucHV0IGZzOiAlZC4lZCBrSHoiLAorCQkJCSAgICAgNjc1MCAv
IHJlZ2JlLCA2NzUwMCAlIHJlZ2JlKTsKKwlkcHR4X3NldF9hdWRfZm10KGl0NjUwNSk7CisJZHB0
eF9zZXRfYXVkX2Noc3RzKGl0NjUwNSk7CisJZHB0eF9zZXRfYXVkaW9faW5mb2ZyYW1lKGl0NjUw
NSk7CisKKwkvKiBFbmFibGUgRW5oYW5jZWQgQXVkaW8gVGltZVN0bXAgTW9kZSAqLworCWRwdHhz
ZXQoaXQ2NTA1LCAweEQ0LCAweDA0LCAweDA0KTsKKwkvKiBEaXNhYmxlIEZ1bGwgQXVkaW8gUGFj
a2V0ICovCisJZHB0eHNldChpdDY1MDUsIDB4QkIsIDB4MTAsIDB4MDApOworCisJZHB0eHdyKGl0
NjUwNSwgMHhERSwgMHgwMCk7CisJZHB0eHdyKGl0NjUwNSwgMHhERiwgMHg4MCk7CisJZHB0eHdy
KGl0NjUwNSwgMHhFMCwgMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4QjgsIDB4ODAsIDB4ODAp
OworCWRwdHhzZXQoaXQ2NTA1LCAweEI4LCAweDgwLCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwg
MHhEMywgMHgyMCwgMHgwMCk7Cit9CisKKy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKKyAqIERQQ0QgUmVh
ZCBhbmQgRURJRAorICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKworc3RhdGljIHVuc2lnbmVkIGludCBk
cHR4X2RwY2RyZChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0KQor
eworCXU4IHZhbHVlOworCWludCByZXQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+
Y2xpZW50LT5kZXY7CisKKwlyZXQgPSBkcm1fZHBfZHBjZF9yZWFkYigmaXQ2NTA1LT5hdXgsIG9m
ZnNldCwgJnZhbHVlKTsKKwlpZiAocmV0IDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgIkRQ
Q0QgcmVhZCBmYWlsZWQgWzB4JWx4XSByZXQ6ICVkIiwgb2Zmc2V0LAorCQkJICAgICAgcmV0KTsK
KwkJcmV0dXJuIDA7CisJfQorCXJldHVybiB2YWx1ZTsKK30KKworc3RhdGljIGludCBkcHR4X2Rw
Y2R3cihzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAorCQkgICAg
ICAgdW5zaWduZWQgbG9uZyBkYXRhaW4pCit7CisJaW50IHJldDsKKwlzdHJ1Y3QgZGV2aWNlICpk
ZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCXJldCA9IGRybV9kcF9kcGNkX3dyaXRlYigm
aXQ2NTA1LT5hdXgsIG9mZnNldCwgZGF0YWluKTsKKwlpZiAocmV0IDwgMCkgeworCQlEUk1fREVW
X0VSUk9SKGRldiwgIkRQQ0Qgd3JpdGUgZmFpbGVkIFsweCVseF0gcmV0OiAlZCIsIG9mZnNldCwK
KwkJCSAgICAgIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGl0NjUwNV9nZXRfZHBjZChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUsIGludCBvZmZzZXQs
IHU4ICpkcGNkLCBpbnQgbnVtKQoreworCWludCBpLCByZXQ7CisJc3RydWN0IGRldmljZSAqZGV2
ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtOyBpICs9IDQp
IHsKKwkJcmV0ID0gZHJtX2RwX2RwY2RfcmVhZCgmaXQ2NTA1LT5hdXgsIG9mZnNldCArIGksIGRw
Y2QgKyBpLAorCQkJCSAgICAgICBtaW4obnVtIC0gaSwgNCkpOworCQlpZiAocmV0IDwgMCkKKwkJ
CXJldHVybiByZXQ7CisJfQorCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiRFBDRFsweCV4
XSA9ICUqcGgiLCBvZmZzZXQsIG51bSwgZHBjZCk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2
b2lkIGl0NjUwNV9wYXJzZV9kcGNkKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwl1OCBkcGNk
W0RQX1JFQ0VJVkVSX0NBUF9TSVpFXTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5j
bGllbnQtPmRldjsKKwlpbnQgYmNhcHM7CisJc3RydWN0IGRybV9kcF9saW5rICpsaW5rID0gJml0
NjUwNS0+bGluazsKKworCWRybV9kcF9saW5rX3Byb2JlKCZpdDY1MDUtPmF1eCwgbGluayk7CisJ
aXQ2NTA1X2dldF9kcGNkKGl0NjUwNSwgRFBfRFBDRF9SRVYsIGRwY2QsIEFSUkFZX1NJWkUoZHBj
ZCkpOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiIyMjIyMjIyMjRFBDRCBSZXYuOiAl
ZC4lZCMjIyMjIyMjIyMjIiwKKwkJCSAgICAgbGluay0+cmV2aXNpb24gPj4gNCwgbGluay0+cmV2
aXNpb24gJiAweDBGKTsKKworCXN3aXRjaCAobGluay0+cmF0ZSkgeworCWNhc2UgMTYyMDAwOgor
CQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsCisJCQkJICAgICAiTWF4aW11bSBMaW5rIFJhdGU6
IDEuNjJHYnBzIHBlciBsYW5lIik7CisJCWlmIChpdDY1MDUtPmhicikgeworCQkJRFJNX0RFVl9E
RUJVR19EUklWRVIoCisJCQkJZGV2LCAiTm90IHN1cHBvcnQgSEJSIE1vZGUsIHdpbGwgdHJhaW4g
TEJSIik7CisJCQlpdDY1MDUtPmhiciA9IGZhbHNlOworCQl9IGVsc2UgeworCQkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiVHJhaW5pbmcgTEJSIik7CisJCX0KKwkJYnJlYWs7CisKKwljYXNl
IDI3MDAwMDoKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LAorCQkJCSAgICAgIk1heGltdW0g
TGluayBSYXRlOiAyLjdHYnBzIHBlciBsYW5lIik7CisJCWlmICghaXQ2NTA1LT5oYnIpIHsKKwkJ
CURSTV9ERVZfREVCVUdfRFJJVkVSKAorCQkJCWRldiwgIlN1cHBvcnQgSEJSIE1vZGUsIHdpbGwg
dHJhaW4gTEJSIik7CisJCQlpdDY1MDUtPmhiciA9IGZhbHNlOworCQl9IGVsc2UgeworCQkJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LCAiVHJhaW5pbmcgSEJSIik7CisJCX0KKwkJYnJlYWs7CisK
KwljYXNlIDU0MDAwMDoKKwkJLyogVE9ETyhwaWhzdW4pOiBDaGVjayBpZiB0aGlzIGlzIGNvcnJl
Y3QuIEhCUiBoZXJlPyAqLworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsCisJCQkJICAgICAi
TWF4aW11bSBMaW5rIFJhdGU6IDIuN0dicHMgcGVyIGxhbmUiKTsKKwkJYnJlYWs7CisKKwlkZWZh
dWx0OgorCQlEUk1fREVWX0VSUk9SKGRldiwgIlVua25vd24gTWF4aW11bSBMaW5rIFJhdGU6ICV1
IiwKKwkJCSAgICAgIGxpbmstPnJhdGUpOworCQlicmVhazsKKwl9CisKKwlpZiAobGluay0+bnVt
X2xhbmVzID09IDEgfHwgbGluay0+bnVtX2xhbmVzID09IDIgfHwKKwkgICAgbGluay0+bnVtX2xh
bmVzID09IDQpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoCisJCQlkZXYsICJMYW5lIENvdW50
OiAldSBsYW5lIiwgbGluay0+bnVtX2xhbmVzKTsKKwkJaWYgKGxpbmstPm51bV9sYW5lcyA+IExB
TkUpCisJCQlsaW5rLT5udW1fbGFuZXMgPSBMQU5FOworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihk
ZXYsICJUcmFpbmluZyAldSBsYW5lIiwgbGluay0+bnVtX2xhbmVzKTsKKwl9IGVsc2UgeworCQlE
Uk1fREVWX0VSUk9SKGRldiwgIkxhbmUgQ291bnQgRXJyb3I6ICV1IiwgbGluay0+bnVtX2xhbmVz
KTsKKwl9CisKKwlpZiAobGluay0+Y2FwYWJpbGl0aWVzICYgRFBfTElOS19DQVBfRU5IQU5DRURf
RlJBTUlORykKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU3VwcG9ydCBFbmhhbmNlZCBG
cmFtaW5nIik7CisJZWxzZQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsCisJCQkJICAgICAi
Q2FuIG5vdCBzdXBwb3J0IEVuaGFuY2VkIEZyYW1pbmcgTW9kZSIpOworCisJaWYgKGRwY2RbRFBf
TUFYX0RPV05TUFJFQURdICYgRFBfTUFYX0RPV05TUFJFQURfMF81KSB7CisJCURSTV9ERVZfREVC
VUdfRFJJVkVSKGRldiwKKwkJCQkgICAgICJNYXhpbXVtIERvd24tU3ByZWFkOiAwLjUsIHN1cHBv
cnQgU1NDISIpOworCX0gZWxzZSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwKKwkJCQkg
ICAgICJNYXhpbXVtIERvd24tU3ByZWFkOiAwLCBObyBzdXBwb3J0IFNTQyEiKTsKKwkJaXQ2NTA1
LT5lbl9zc2MgPSAwOworCX0KKworCWlmIChsaW5rLT5yZXZpc2lvbiA+PSAweDExICYmCisJICAg
IGRwY2RbRFBfTUFYX0RPV05TUFJFQURdICYgRFBfTk9fQVVYX0hBTkRTSEFLRV9MSU5LX1RSQUlO
SU5HKQorCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJTdXBwb3J0IE5vIEFVWCBUcmFpbmlu
ZyIpOworCWVsc2UKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiQ2FuIG5vdCBzdXBwb3J0
IE5vIEFVWCBUcmFpbmluZyIpOworCisJYmNhcHMgPSBkcHR4X2RwY2RyZChpdDY1MDUsIERQX0FV
WF9IRENQX0JDQVBTKTsKKwlpZiAoYmNhcHMgJiBEUF9CQ0FQU19IRENQX0NBUEFCTEUpIHsKKwkJ
RFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU2luayBzdXBwb3J0IEhEQ1AhIik7CisJCWl0NjUw
NS0+Y3BfY2FwYWJsZSA9IHRydWU7CisJfSBlbHNlIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIo
ZGV2LCAiU2luayBub3Qgc3VwcG9ydCBIRENQISIpOworCQlpdDY1MDUtPmNwX2NhcGFibGUgPSBm
YWxzZTsKKwkJaXQ2NTA1LT5lbl9oZGNwID0gMDsKKwl9CisKKwlpZiAoYmNhcHMgJiBEUF9CQ0FQ
U19SRVBFQVRFUl9QUkVTRU5UKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkRvd25z
dHJlYW0gaXMgcmVwZWF0ZXIhISIpOworCQlpdDY1MDUtPmRvd25zdHJlYW1fcmVwZWF0ZXIgPSB0
cnVlOworCX0gZWxzZSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkRvd25zdHJlYW0g
aXMgcmVjZWl2ZXIhISIpOworCQlpdDY1MDUtPmRvd25zdHJlYW1fcmVwZWF0ZXIgPSBmYWxzZTsK
Kwl9Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUwNV9lbmFibGVfaGRjcChzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUpCit7CisJdTggYmtzdnNbNV0sIGM7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUw
NS0+Y2xpZW50LT5kZXY7CisKKwkvKiBEaXNhYmxlIENQX0Rlc2lyZWQgKi8KKwlkcHR4c2V0KGl0
NjUwNSwgMHgzOCwgMHgwQiwgMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MTAsIDB4
MTApOworCisJdXNsZWVwX3JhbmdlKDEwMDAsIDE1MDApOworCWMgPSBkcHR4X2RwY2RyZChpdDY1
MDUsIERQX0FVWF9IRENQX0JDQVBTKTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJEUENE
WzB4NjgwMjhdOiAweCV4XG4iLCBjKTsKKwlpZiAoIWMpCisJCXJldHVybjsKKworCWRwdHhzZXQo
aXQ2NTA1LCAweDA1LCAweDEwLCAweDAwKTsKKwkvKiBEaXNhYmxlIENQX0Rlc2lyZWQgKi8KKwlk
cHR4c2V0KGl0NjUwNSwgMHgzOCwgMHgwMSwgMHgwMCk7CisJLyogVXNlIFIwJyAxMDBtcyB3YWl0
aW5nICovCisJZHB0eHNldChpdDY1MDUsIDB4MzgsIDB4MDgsIDB4MDApOworCS8qIGNsZWFyIHRo
ZSByZXBlYXRlciBMaXN0IENoayBEb25lIGFuZCBmYWlsIGJpdCAqLworCWRwdHhzZXQoaXQ2NTA1
LCAweDM5LCAweDMwLCAweDAwKTsKKworCWl0NjUwNV9nZXRfZHBjZChpdDY1MDUsIERQX0FVWF9I
RENQX0JLU1YsIGJrc3ZzLCBBUlJBWV9TSVpFKGJrc3ZzKSk7CisKKwlEUk1fREVWX0RFQlVHX0RS
SVZFUihkZXYsICJTaW5rIEJLU1YgPSAlNXBoIiwgYmtzdnMpOworCisJLyogU2VsZWN0IEFuIEdl
bmVyYXRvciAqLworCWRwdHhzZXQoaXQ2NTA1LCAweDNBLCAweDAxLCAweDAxKTsKKwkvKiBFbmFi
bGUgQW4gR2VuZXJhdG9yICovCisJZHB0eHNldChpdDY1MDUsIDB4M0EsIDB4MDIsIDB4MDIpOwor
CS8qIGRlbGF5MW1zKDEwKTsqLworCXVzbGVlcF9yYW5nZSgxMDAwMCwgMTUwMDApOworCS8qIFN0
b3AgQW4gR2VuZXJhdG9yICovCisJZHB0eHNldChpdDY1MDUsIDB4M0EsIDB4MDIsIDB4MDApOwor
CisJZHB0eHNldChpdDY1MDUsIDB4MzgsIDB4MDEsIDB4MDEpOworCWRwdHhzZXQoaXQ2NTA1LCAw
eDM5LCAweDAxLCAweDAxKTsKK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2xhbmVzcGVlZF9zZXR1
cChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJaWYgKCFpdDY1MDUtPmhicikgeworCQlkcHR4
c2V0KGl0NjUwNSwgMHgxNiwgMHgwMSwgMHgwMSk7CisJCWRwdHhzZXQoaXQ2NTA1LCAweDVDLCAw
eDAyLCAweDAwKTsKKwl9IGVsc2UgeworCQlkcHR4c2V0KGl0NjUwNSwgMHgxNiwgMHgwMSwgMHgw
MCk7CisJCWRwdHhzZXQoaXQ2NTA1LCAweDVDLCAweDAyLCAweDAyKTsKKwl9Cit9CisKK3N0YXRp
YyB2b2lkIGl0NjUwNV9sYW5lX3N3YXAoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCWludCBl
cnI7CisJdW5pb24gZXh0Y29uX3Byb3BlcnR5X3ZhbHVlIHByb3BlcnR5OworCXN0cnVjdCBkZXZp
Y2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKCFpdDY1MDUtPmxhbmVzd2Fw
X2Rpc2FibGVkKSB7CisJCWVyciA9IGV4dGNvbl9nZXRfcHJvcGVydHkoaXQ2NTA1LT5leHRjb24s
IEVYVENPTl9ESVNQX0RQLAorCQkJCQkgIEVYVENPTl9QUk9QX1VTQl9UWVBFQ19QT0xBUklUWSwK
KwkJCQkJICAmcHJvcGVydHkpOworCQlpZiAoZXJyKSB7CisJCQlEUk1fREVWX0VSUk9SKGRldiwg
ImdldCBwcm9wZXJ0eSBmYWlsISIpOworCQkJcmV0dXJuOworCQl9CisJCWl0NjUwNS0+bGFuZXN3
YXAgPSBwcm9wZXJ0eS5pbnR2YWw7CisJfQorCisJZHB0eHNldChpdDY1MDUsIDB4MTYsIDB4MDgs
IGl0NjUwNS0+bGFuZXN3YXAgPyAweDA4IDogMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MTYs
IDB4MDYsIChpdDY1MDUtPmxpbmsubnVtX2xhbmVzIC0gMSkgPDwgMSk7CisJRFJNX0RFVl9ERUJV
R19EUklWRVIoZGV2LCAiaXQ2NTA1LT5sYW5lc3dhcCA9IDB4JXgiLCBpdDY1MDUtPmxhbmVzd2Fw
KTsKKworCWlmIChpdDY1MDUtPmxhbmVzd2FwKSB7CisJCXN3aXRjaCAoaXQ2NTA1LT5saW5rLm51
bV9sYW5lcykgeworCQljYXNlIDE6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1QywgMHhGMSwgMHg4
MSk7CisJCQlicmVhazsKKwkJY2FzZSAyOgorCQkJZHB0eHNldChpdDY1MDUsIDB4NUMsIDB4RjEs
IDB4QzEpOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1Qywg
MHhGMSwgMHhGMSk7CisJCQlicmVhazsKKwkJfQorCX0gZWxzZSB7CisJCXN3aXRjaCAoaXQ2NTA1
LT5saW5rLm51bV9sYW5lcykgeworCQljYXNlIDE6CisJCQlkcHR4c2V0KGl0NjUwNSwgMHg1Qywg
MHhGMSwgMHgxMSk7CisJCQlicmVhazsKKwkJY2FzZSAyOgorCQkJZHB0eHNldChpdDY1MDUsIDB4
NUMsIDB4RjEsIDB4MzEpOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlkcHR4c2V0KGl0NjUw
NSwgMHg1QywgMHhGMSwgMHhGMSk7CisJCQlicmVhazsKKwkJfQorCX0KK30KKworc3RhdGljIHZv
aWQgaXQ2NTA1X2xhbmVfY29uZmlnKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlpdDY1MDVf
bGFuZXNwZWVkX3NldHVwKGl0NjUwNSk7CisJaXQ2NTA1X2xhbmVfc3dhcChpdDY1MDUpOworfQor
CitzdGF0aWMgdm9pZCBpdDY1MDVfc2V0X3NzYyhzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJ
c3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlkcHR4c2V0KGl0
NjUwNSwgMHgxNiwgMHgxMCwgaXQ2NTA1LT5lbl9zc2MgPDwgNCk7CisJaWYgKGl0NjUwNS0+ZW5f
c3NjKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkVuYWJsZSAyN00gNDQ2MyBQUE0g
U1NDIik7CisJCWRwdHhfY2hnYmFuayhpdDY1MDUsIDEpOworCQlkcHR4d3IoaXQ2NTA1LCAweDg4
LCAweDllKTsKKwkJZHB0eHdyKGl0NjUwNSwgMHg4OSwgMHgxYyk7CisJCWRwdHh3cihpdDY1MDUs
IDB4OEEsIDB4NDIpOworCQlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwkJZHB0eHdyKGl0NjUw
NSwgMHg1OCwgMHgwNyk7CisJCWRwdHh3cihpdDY1MDUsIDB4NTksIDB4MjkpOworCQlkcHR4d3Io
aXQ2NTA1LCAweDVBLCAweDAzKTsKKwkJLyogU3RhbXAgSW50ZXJydXB0IFN0ZXAgKi8KKwkJZHB0
eHNldChpdDY1MDUsIDB4RDQsIDB4MzAsIDB4MTApOworCQlkcHR4X2RwY2R3cihpdDY1MDUsIERQ
X0RPV05TUFJFQURfQ1RSTCwgRFBfU1BSRUFEX0FNUF8wXzUpOworCX0gZWxzZSB7CisJCWRwdHhf
ZHBjZHdyKGl0NjUwNSwgRFBfRE9XTlNQUkVBRF9DVFJMLCAweDAwKTsKKwkJZHB0eHNldChpdDY1
MDUsIDB4RDQsIDB4MzAsIDB4MDApOworCX0KK30KKworc3RhdGljIHZvaWQgcGNsa19waGFzZShz
dHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJZHB0eHNldChpdDY1MDUsIDB4MTAsIDB4MDMsIFBD
TEtfREVMQVkpOworCWRwdHhzZXQoaXQ2NTA1LCAweDEyLCAweDEwLCBQQ0xLX0lOViA8PCA0KTsK
K30KKworc3RhdGljIHZvaWQgYWZlX2RyaXZpbmdfc2V0dGluZyhzdHJ1Y3QgaXQ2NTA1ICppdDY1
MDUpCit7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisJdW5z
aWduZWQgaW50IGFmZV9zZXR0aW5nOworCisJYWZlX3NldHRpbmcgPSBBRkVfU0VUVElORzsKKwlp
ZiAoYWZlX3NldHRpbmcgPj0gQVJSQVlfU0laRShhZmVfc2V0dGluZ190YWJsZSkpIHsKKwkJRFJN
X0RFVl9FUlJPUihkZXYsICJhZmUgc2V0dGluZyB2YWx1ZSBlcnJvciBhbmQgdXNlIGRlZmF1bHQi
KTsKKwkJYWZlX3NldHRpbmcgPSAwOworCX0KKwlpZiAoYWZlX3NldHRpbmcpIHsKKwkJZHB0eF9j
aGdiYW5rKGl0NjUwNSwgMSk7CisJCWRwdHh3cihpdDY1MDUsIDB4N0UsIGFmZV9zZXR0aW5nX3Rh
YmxlW2FmZV9zZXR0aW5nXVswXSk7CisJCWRwdHh3cihpdDY1MDUsIDB4N0YsIGFmZV9zZXR0aW5n
X3RhYmxlW2FmZV9zZXR0aW5nXVsxXSk7CisJCWRwdHh3cihpdDY1MDUsIDB4ODEsIGFmZV9zZXR0
aW5nX3RhYmxlW2FmZV9zZXR0aW5nXVsyXSk7CisJCWRwdHhfY2hnYmFuayhpdDY1MDUsIDApOwor
CX0KK30KKworc3RhdGljIHZvaWQgZHB0eF9vdXRwdXQoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQor
eworCS8qIGNoYW5nZSBiYW5rIDAgKi8KKwlkcHR4X2NoZ2JhbmsoaXQ2NTA1LCAwKTsKKwlkcHR4
d3IoaXQ2NTA1LCAweDY0LCAweDEwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY1LCAweDgwKTsKKwlk
cHR4d3IoaXQ2NTA1LCAweDY2LCAweDEwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY3LCAweDRGKTsK
KwlkcHR4d3IoaXQ2NTA1LCAweDY4LCAweDA5KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDY5LCAweEJB
KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZBLCAweDNCKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZCLCAw
eDRCKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZDLCAweDNFKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZE
LCAweDRGKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDZFLCAweDA5KTsKKwlkcHR4d3IoaXQ2NTA1LCAw
eDZGLCAweDU2KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDcwLCAweDBFKTsKKwlkcHR4d3IoaXQ2NTA1
LCAweDcxLCAweDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDcyLCAweDAwKTsKKwlkcHR4d3IoaXQ2
NTA1LCAweDczLCAweDRGKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc0LCAweDA5KTsKKwlkcHR4d3Io
aXQ2NTA1LCAweDc1LCAweDAwKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc2LCAweDAwKTsKKwlkcHR4
d3IoaXQ2NTA1LCAweDc3LCAweEU3KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDc4LCAweDEwKTsKKwlk
cHR4d3IoaXQ2NTA1LCAweEU4LCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHhDRSwgMHg3MCwg
MHg2MCk7CisJZHB0eHdyKGl0NjUwNSwgMHhDQSwgMHg0RCk7CisJZHB0eHdyKGl0NjUwNSwgMHhD
OSwgMHhGNSk7CisJZHB0eHdyKGl0NjUwNSwgMHg1QywgMHgwMik7CisKKwlkcm1fZHBfbGlua19w
b3dlcl91cCgmaXQ2NTA1LT5hdXgsICZpdDY1MDUtPmxpbmspOworCWRwdHhzZXQoaXQ2NTA1LCAw
eDU5LCAweDAxLCAweDAxKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHg1QSwgMHgwNSwgMHgwMSk7CisJ
ZHB0eHdyKGl0NjUwNSwgMHgxMiwgMHgwMSk7CisJZHB0eHdyKGl0NjUwNSwgMHhDQiwgMHgxNyk7
CisJZHB0eHdyKGl0NjUwNSwgMHgxMSwgMHgwOSk7CisJZHB0eHdyKGl0NjUwNSwgMHgyMCwgMHgy
OCk7CisJZHB0eHNldChpdDY1MDUsIDB4MjMsIDB4MzAsIDB4MDApOworCWRwdHhzZXQoaXQ2NTA1
LCAweDNBLCAweDA0LCAweDA0KTsKKwlkcHR4c2V0KGl0NjUwNSwgMHgxNSwgMHgwMSwgMHgwMSk7
CisJZHB0eHdyKGl0NjUwNSwgMHgwQywgMHgwOCk7CisKKwlkcHR4c2V0KGl0NjUwNSwgMHg1Riwg
MHgyMCwgMHgwMCk7CisJaXQ2NTA1X2xhbmVfY29uZmlnKGl0NjUwNSk7CisKKwlpdDY1MDVfc2V0
X3NzYyhpdDY1MDUpOworCisJaWYgKGl0NjUwNS0+bGluay5jYXBhYmlsaXRpZXMgJiBEUF9MSU5L
X0NBUF9FTkhBTkNFRF9GUkFNSU5HKSB7CisJCWRwdHh3cihpdDY1MDUsIDB4RDMsIDB4MzMpOwor
CQlkcHR4X2RwY2R3cihpdDY1MDUsIERQX0xBTkVfQ09VTlRfU0VULAorCQkJICAgIERQX0xBTkVf
Q09VTlRfRU5IQU5DRURfRlJBTUVfRU4pOworCX0gZWxzZSB7CisJCWRwdHh3cihpdDY1MDUsIDB4
RDMsIDB4MzIpOworCX0KKworCWRwdHhzZXQoaXQ2NTA1LCAweDE1LCAweDAyLCAweDAyKTsKKwlk
cHR4c2V0KGl0NjUwNSwgMHgxNSwgMHgwMiwgMHgwMCk7CisJZHB0eHNldChpdDY1MDUsIDB4MDUs
IDB4MDMsIDB4MDIpOworCWRwdHhzZXQoaXQ2NTA1LCAweDA1LCAweDAzLCAweDAwKTsKKworCS8q
IHJlZzYwWzJdID0gSW5ERFIgKi8KKwlkcHR4d3IoaXQ2NTA1LCAweDYwLCAweDQ0KTsKKwkvKiBN
NDQ0QjI0IGZvcm1hdCAqLworCWRwdHh3cihpdDY1MDUsIDB4NjIsIDB4MDEpOworCS8qIHNlbGVj
dCBSR0IgQnlwYXNzIENTQyAqLworCWRwdHh3cihpdDY1MDUsIDB4NjMsIDB4MDApOworCisJcGNs
a19waGFzZShpdDY1MDUpOworCWRwdHhzZXQoaXQ2NTA1LCAweDYxLCAweDAxLCAweDAxKTsKKwlk
cHR4d3IoaXQ2NTA1LCAweDA2LCAweEZGKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA3LCAweEZGKTsK
KwlkcHR4d3IoaXQ2NTA1LCAweDA4LCAweEZGKTsKKworCWRwdHhzZXQoaXQ2NTA1LCAweGQzLCAw
eDMwLCAweDAwKTsKKwlkcHR4c2V0KGl0NjUwNSwgMHhkNCwgMHg0MSwgMHg0MSk7CisJZHB0eHNl
dChpdDY1MDUsIDB4ZTgsIDB4MTEsIDB4MTEpOworCisJYWZlX2RyaXZpbmdfc2V0dGluZyhpdDY1
MDUpOworCWRwdHh3cihpdDY1MDUsIDB4MTcsIDB4MDQpOworCWRwdHh3cihpdDY1MDUsIDB4MTcs
IDB4MDEpOworfQorCitzdGF0aWMgdm9pZCBkcHR4X3Byb2Nlc3Nfc3lzX3dhaXQoc3RydWN0IGl0
NjUwNSAqaXQ2NTA1KQoreworCWludCByZWcwZTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2
NTA1LT5jbGllbnQtPmRldjsKKworCWRwdHhyZChpdDY1MDUsIDB4MEUsICZyZWcwZSk7CisJRFJN
X0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU1lTX1dBSVQgc3RhdGUgcmVnMGU9MHglMDJ4IiwgcmVn
MGUpOworCisJaWYgKHJlZzBlICYgQklUKDQpKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRl
diwgIkF1dG8gTGluayBUcmFpbmluZyBTdWNjZXNzLi4uIik7CisJCURSTV9ERVZfREVCVUdfRFJJ
VkVSKGRldiwgIkxpbmsgU3RhdGU6IDB4JXgiLCByZWcwZSAmIDB4MUYpOworCQlpZiAoaXQ2NTA1
LT5lbl9hdWRpbykgeworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiRW5hYmxlIGF1ZGlv
ISIpOworCQkJaXQ2NTA1X3NldF9hdWRpbyhpdDY1MDUpOworCQl9CisJCURSTV9ERVZfREVCVUdf
RFJJVkVSKGRldiwgIml0NjUwNS0+VmlkU3RhYmxlX0RvbmUgPSAlMDJ4IiwKKwkJCQkgICAgIGl0
NjUwNS0+dmlkc3RhYmxlX2RvbmUpOworCQlpZiAoaXQ2NTA1LT5jcF9jYXBhYmxlKSB7CisJCQlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJTdXBwb3J0IEhEQ1AiKTsKKwkJCWlmIChpdDY1MDUt
PmVuX2hkY3ApIHsKKwkJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJFbmFibGUgSERDUCIp
OworCQkJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19SZUhEQ1ApOworCQkJfSBlbHNlIHsKKwkJ
CQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJEaXNhYmxlIEhEQ1AiKTsKKwkJCQlkcHR4X3N5
c19jaGcoaXQ2NTA1LCBTWVNfTk9ST1ApOworCQkJfQorCQl9IGVsc2UgeworCQkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiTm90IHN1cHBvcnQgSERDUCIpOworCQkJZHB0eF9zeXNfY2hnKGl0
NjUwNSwgU1lTX05PUk9QKTsKKwkJfQorCX0gZWxzZSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVS
KGRldiwgIkF1dG8gTGluayBUcmFpbmluZyBmYWlsIHN0ZXAgJWQiLAorCQkJCSAgICAgaXQ2NTA1
LT5jbnRmc20pOworCQlkcHR4X2RlYnVnX3ByaW50KGl0NjUwNSwgMHgwRCwgInN5c3RlbSBzdGF0
dXMiKTsKKwkJaWYgKGl0NjUwNS0+Y250ZnNtID4gMCkgeworCQkJaXQ2NTA1LT5jbnRmc20tLTsK
KwkJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19BVVRPVFJBSU4pOworCQl9IGVsc2UgeworCQkJ
RFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiQXV0byBUcmFpbmluZyBGYWlsICVkIHRpbWVzIiwK
KwkJCQkJICAgICBUUkFJTkZBSUxDTlQpOworCQkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
U3lzIGNoYW5nZSB0byBTWVNfSFBEIik7CisJCQlkcHR4X2RwY2R3cihpdDY1MDUsIERQX1RSQUlO
SU5HX1BBVFRFUk5fU0VULCAweDAwKTsKKwkJCWlmIChpdDY1MDUtPnRyYWluX2ZhaWxfaHBkID4g
MCkgeworCQkJCWl0NjUwNS0+dHJhaW5fZmFpbF9ocGQtLTsKKwkJCQlkcHR4X3N5c19jaGcoaXQ2
NTA1LCBTWVNfSFBEKTsKKwkJCX0gZWxzZSB7CisJCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lT
X1RSQUlORkFJTCk7CisJCQl9CisJCX0KKwl9Cit9CisKK3N0YXRpYyB2b2lkIGRwdHhfc3lzX2Zz
bShzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJlZzBl
OworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJaWYgKGl0
NjUwNS0+c3RhdHVzICE9IFNZU19VTlBMVUcgJiYgIWRwdHhfZ2V0c2lua2hwZChpdDY1MDUpKQor
CQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBTWVNfVU5QTFVHKTsKKworCURSTV9ERVZfREVCVUdfRFJJ
VkVSKGRldiwgInN0YXRlOiAlcyIsIHN0YXRlX3N0cmluZ1tpdDY1MDUtPnN0YXR1c10pOworCXN3
aXRjaCAoaXQ2NTA1LT5zdGF0dXMpIHsKKwljYXNlIFNZU19VTlBMVUc6CisJCWRybV9oZWxwZXJf
aHBkX2lycV9ldmVudChpdDY1MDUtPmNvbm5lY3Rvci5kZXYpOworCQlicmVhazsKKworCWNhc2Ug
U1lTX0hQRDoKKwkJZHB0eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4OUYsICJhdXggc3RhdHVzIik7
CisJCWRybV9oZWxwZXJfaHBkX2lycV9ldmVudChpdDY1MDUtPmNvbm5lY3Rvci5kZXYpOworCQlp
dDY1MDVfaW5pdF9mc20oaXQ2NTA1KTsKKwkJLyogR0VURFBDRCAqLworCQlpdDY1MDVfcGFyc2Vf
ZHBjZChpdDY1MDUpOworCisJCS8qCisJCSAqIHRyYWluaW5nIGZhaWwgVFJBSU5GQUlMQ05UIHRp
bWVzLAorCQkgKiB0aGVuIGNoYW5nZSB0byBIUEQgdG8gcmVzdGFydAorCQkgKi8KKwkJaXQ2NTA1
LT5jbnRmc20gPSBUUkFJTkZBSUxDTlQ7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIndp
bGwgVHJhaW4gJXMgJWQgbGFuZXMiLAorCQkJCSAgICAgaXQ2NTA1LT5oYnIgPyAiSEJSIiA6ICJM
QlIiLAorCQkJCSAgICAgaXQ2NTA1LT5saW5rLm51bV9sYW5lcyk7CisJCWRwdHhfc3lzX2NoZyhp
dDY1MDUsIFNZU19BVVRPVFJBSU4pOworCQlicmVhazsKKworCWNhc2UgU1lTX0FVVE9UUkFJTjoK
KwkJZHB0eF9vdXRwdXQoaXQ2NTA1KTsKKworCQkvKgorCQkgKiB3YWl0aW5nIGZvciB0cmFpbmlu
ZyBkb3duIGZsYWcKKwkJICogYmVjYXVzZSB3ZSBkb24ndCBrbm93CisJCSAqIGhvdyBsb25nIHRo
aXMgc3RlcCB3aWxsIGJlIGNvbXBsZXRlZAorCQkgKiBzbyB1c2Ugc3RlcCAxbXMgdG8gd2FpdAor
CQkgKi8KKwkJZm9yIChpID0gMDsgaSA8IEZMQUdUUkFJTkRPV047IGkrKykgeworCQkJdXNsZWVw
X3JhbmdlKDEwMDAsIDIwMDApOworCQkJZHB0eHJkKGl0NjUwNSwgMHgwRSwgJnJlZzBlKTsKKwkJ
CWlmIChyZWcwZSAmIEJJVCg0KSkKKwkJCQlicmVhazsKKwkJfQorCisJCWRwdHhfc3lzX2NoZyhp
dDY1MDUsIFNZU19XQUlUKTsKKwkJYnJlYWs7CisKKwljYXNlIFNZU19XQUlUOgorCQlkcHR4X3By
b2Nlc3Nfc3lzX3dhaXQoaXQ2NTA1KTsKKwkJYnJlYWs7CisKKwljYXNlIFNZU19SZUhEQ1A6CisJ
CW1zbGVlcCgyNDAwKTsKKwkJZHB0eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4M0IsICJhcjBfbG93
Iik7CisJCWRwdHhfZGVidWdfcHJpbnQoaXQ2NTA1LCAweDNDLCAiYXIwX2hpZ2giKTsKKwkJZHB0
eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4NDUsICJicjBfbG93Iik7CisJCWRwdHhfZGVidWdfcHJp
bnQoaXQ2NTA1LCAweDQ2LCAiYnIwX2hpZ2giKTsKKwkJaXQ2NTA1X2VuYWJsZV9oZGNwKGl0NjUw
NSk7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlNZU19SZUhEQ1AgZW5kIik7CisJCWJy
ZWFrOworCisJY2FzZSBTWVNfTk9ST1A6CisJCWJyZWFrOworCisJY2FzZSBTWVNfVFJBSU5GQUlM
OgorCQlicmVhazsKKworCWRlZmF1bHQ6CisJCURSTV9ERVZfRVJST1IoZGV2LCAic3lzX3N0YXRl
IGNoYW5nZSB0byB1bmtub3duX3N0YXRlOiAlZCIsCisJCQkgICAgICBpdDY1MDUtPnN0YXR1cyk7
CisJCWJyZWFrOworCX0KK30KKworc3RhdGljIGludCBzaGExX2RpZ2VzdChzdHJ1Y3QgaXQ2NTA1
ICppdDY1MDUsIHU4ICpzaGExX2lucHV0LCB1bnNpZ25lZCBpbnQgc2l6ZSwKKwkJICAgICAgIHU4
ICpvdXRwdXRfYXYpCit7CisJc3RydWN0IHNoYXNoX2Rlc2MgKmRlc2M7CisJc3RydWN0IGNyeXB0
b19zaGFzaCAqdGZtOworCWludCBlcnI7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+
Y2xpZW50LT5kZXY7CisKKwl0Zm0gPSBjcnlwdG9fYWxsb2Nfc2hhc2goInNoYTEiLCAwLCAwKTsK
KwlpZiAoSVNfRVJSKHRmbSkpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJjcnlwdG9fYWxsb2Nf
c2hhc2ggc2hhMSBmYWlsZWQiKTsKKwkJcmV0dXJuIFBUUl9FUlIodGZtKTsKKwl9CisJZGVzYyA9
IGt6YWxsb2Moc2l6ZW9mKCpkZXNjKSArIGNyeXB0b19zaGFzaF9kZXNjc2l6ZSh0Zm0pLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIWRlc2MpIHsKKwkJY3J5cHRvX2ZyZWVfc2hhc2godGZtKTsKKwkJcmV0
dXJuIC1FTk9NRU07CisJfQorCisJZGVzYy0+dGZtID0gdGZtOworCWVyciA9IGNyeXB0b19zaGFz
aF9kaWdlc3QoZGVzYywgc2hhMV9pbnB1dCwgc2l6ZSwgb3V0cHV0X2F2KTsKKwlpZiAoZXJyKQor
CQlEUk1fREVWX0VSUk9SKGRldiwgImNyeXB0b19zaGFzaF9kaWdlc3Qgc2hhMSBmYWlsZWQiKTsK
KworCWNyeXB0b19mcmVlX3NoYXNoKHRmbSk7CisJa2ZyZWUoZGVzYyk7CisJcmV0dXJuIGVycjsK
K30KKworc3RhdGljIGludCBpdDY1MDVfbWFrZXVwX3NoYTFfaW5wdXQoc3RydWN0IGl0NjUwNSAq
aXQ2NTA1KQoreworCWludCBtc2djbnQgPSAwLCBpOworCXVuc2lnbmVkIGludCB2YWx1ZTsKKwl1
OCBhbTBbOF0sIGJpbmZvWzJdOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVu
dC0+ZGV2OworCisJZHB0eHNldChpdDY1MDUsIDB4M0EsIDB4MjAsIDB4MjApOworCWZvciAoaSA9
IDA7IGkgPCA4OyBpKyspIHsKKwkJZHB0eHJkKGl0NjUwNSwgMHg0QyArIGksICZ2YWx1ZSk7CisJ
CWFtMFtpXSA9IHZhbHVlOworCX0KKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWFkIGFt
MCA9ICU4cGgiLCBhbTApOworCWRwdHhzZXQoaXQ2NTA1LCAweDNBLCAweDIwLCAweDAwKTsKKwor
CWl0NjUwNV9nZXRfZHBjZChpdDY1MDUsIERQX0FVWF9IRENQX0JJTkZPLCBiaW5mbywgQVJSQVlf
U0laRShiaW5mbykpOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF0dGFjaGVkIGRldmlj
ZXM6ICUwMngiLCBiaW5mb1swXSAmIDB4N0YpOworCisJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2
LCAiJXMgMTI3IGRldmljZXMgYXJlIGF0dGFjaGVkIiwKKwkJCSAgICAgKGJpbmZvWzBdICYgQklU
KDcpKSA/ICJvdmVyIiA6ICJ1bmRlciIpOworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgImRl
cHRoLCBhdHRhY2hlZCBsZXZlbHM6ICUwMngiLAorCQkJICAgICBiaW5mb1sxXSAmIDB4MDcpOwor
CURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIiVzIHRoYW4gc2V2ZW4gbGV2ZWxzIGNhc2NhZGVk
IiwKKwkJCSAgICAgKGJpbmZvWzFdICYgQklUKDMpKSA/ICJtb3JlIiA6ICJsZXNzIik7CisKKwlm
b3IgKGkgPSAwOyBpIDwgKGJpbmZvWzBdICYgMHg3Rik7IGkrKykgeworCQlpdDY1MDVfZ2V0X2Rw
Y2QoaXQ2NTA1LCBEUF9BVVhfSERDUF9LU1ZfRklGTyArIChpICUgMykgKiA1LAorCQkJCWl0NjUw
NS0+c2hhaW5wdXQgKyBtc2djbnQsIDUpOworCQltc2djbnQgKz0gNTsKKworCQlEUk1fREVWX0RF
QlVHX0RSSVZFUihkZXYsICJLU1YgTGlzdCAlZCBkZXZpY2UgOiAlNXBoIiwgaSwKKwkJCQkgICAg
IGl0NjUwNS0+c2hhaW5wdXQgKyBpICogNSk7CisJfQorCWl0NjUwNS0+c2hhaW5wdXRbbXNnY250
KytdID0gYmluZm9bMF07CisJaXQ2NTA1LT5zaGFpbnB1dFttc2djbnQrK10gPSBiaW5mb1sxXTsK
Kwlmb3IgKGkgPSAwOyBpIDwgODsgaSsrKQorCQlpdDY1MDUtPnNoYWlucHV0W21zZ2NudCsrXSA9
IGFtMFtpXTsKKworCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlNIQSBNZXNzYWdlIENvdW50
ID0gJWQiLCBtc2djbnQpOworCXJldHVybiBtc2djbnQ7Cit9CisKK3N0YXRpYyB2b2lkIGl0NjUw
NV9jaGVja19zaGExX3Jlc3VsdChzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUpCit7CisJdW5zaWduZWQg
aW50IGksIHNoYXBhc3M7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5k
ZXY7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJTSEEgY2FsY3VsYXRlIGNvbXBsZXRl
Iik7CisJZm9yIChpID0gMDsgaSA8IDU7IGkrKykKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2
LCAiYXYgJWQ6ICU0cGgiLCBpLCBpdDY1MDUtPmF2W2ldKTsKKworCXNoYXBhc3MgPSAxOworCWZv
ciAoaSA9IDA7IGkgPCA1OyBpKyspIHsKKwkJaXQ2NTA1X2dldF9kcGNkKGl0NjUwNSwgRFBfQVVY
X0hEQ1BfVl9QUklNRShpKSwgaXQ2NTA1LT5idltpXSwKKwkJCQk0KTsKKwkJRFJNX0RFVl9ERUJV
R19EUklWRVIoZGV2LCAiYnYgJWQ6ICU0cGgiLCBpLCBpdDY1MDUtPmJ2W2ldKTsKKwkJaWYgKChp
dDY1MDUtPmJ2W2ldWzNdICE9IGl0NjUwNS0+YXZbaV1bMF0pIHx8CisJCSAgICAoaXQ2NTA1LT5i
dltpXVsyXSAhPSBpdDY1MDUtPmF2W2ldWzFdKSB8fAorCQkgICAgKGl0NjUwNS0+YnZbaV1bMV0g
IT0gaXQ2NTA1LT5hdltpXVsyXSkgfHwKKwkJICAgIChpdDY1MDUtPmJ2W2ldWzBdICE9IGl0NjUw
NS0+YXZbaV1bM10pKSB7CisJCQlzaGFwYXNzID0gMDsKKwkJfQorCX0KKwlpZiAoc2hhcGFzcykg
eworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJTSEEgY2hlY2sgcmVzdWx0IHBhc3MhIik7
CisJCWRwdHhzZXQoaXQ2NTA1LCAweDM5LCBCSVQoNCksIEJJVCg0KSk7CisJfSBlbHNlIHsKKwkJ
RFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU0hBIGNoZWNrIHJlc3VsdCBmYWlsIik7CisJCWRw
dHhzZXQoaXQ2NTA1LCAweDM5LCBCSVQoNSksIEJJVCg1KSk7CisJfQorfQorCitzdGF0aWMgdm9p
ZCB0b19mc21fc3RhdHVzKHN0cnVjdCBpdDY1MDUgKml0NjUwNSwgZW51bSBzeXNfc3RhdHVzIHN0
YXR1cykKK3sKKwl3aGlsZSAoaXQ2NTA1LT5zdGF0dXMgIT0gc3RhdHVzICYmIGl0NjUwNS0+c3Rh
dHVzICE9IFNZU19UUkFJTkZBSUwpIHsKKwkJZHB0eF9zeXNfZnNtKGl0NjUwNSk7CisJCWlmIChp
dDY1MDUtPnN0YXR1cyA9PSBTWVNfVU5QTFVHKQorCQkJcmV0dXJuOworCX0KK30KKworc3RhdGlj
IHZvaWQgZ29fb25fZnNtKHN0cnVjdCBpdDY1MDUgKml0NjUwNSk7CisKK3N0YXRpYyB1OCBkcF9s
aW5rX3N0YXR1cyhjb25zdCB1OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVU19TSVpFXSwgaW50
IHIpCit7CisJcmV0dXJuIGxpbmtfc3RhdHVzW3IgLSBEUF9MQU5FMF8xX1NUQVRVU107Cit9CisK
K3N0YXRpYyB2b2lkIGhwZF9pcnEoc3RydWN0IGl0NjUwNSAqaXQ2NTA1KQoreworCXU4IGRwY2Rf
c2lua19jb3VudCwgZHBjZF9pcnFfdmVjdG9yOworCXU4IGxpbmtfc3RhdHVzW0RQX0xJTktfU1RB
VFVTX1NJWkVdOworCXVuc2lnbmVkIGludCBic3RhdHVzOworCXN0cnVjdCBkZXZpY2UgKmRldiA9
ICZpdDY1MDUtPmNsaWVudC0+ZGV2OworCisJZHBjZF9zaW5rX2NvdW50ID0gZHB0eF9kcGNkcmQo
aXQ2NTA1LCBEUF9TSU5LX0NPVU5UKTsKKwlkcGNkX2lycV92ZWN0b3IgPSBkcHR4X2RwY2RyZChp
dDY1MDUsIERQX0RFVklDRV9TRVJWSUNFX0lSUV9WRUNUT1IpOworCWRybV9kcF9kcGNkX3JlYWRf
bGlua19zdGF0dXMoJml0NjUwNS0+YXV4LCBsaW5rX3N0YXR1cyk7CisKKwlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICJkcGNkX3NpbmtfY291bnQgPSAweCV4IiwgZHBjZF9zaW5rX2NvdW50KTsK
KwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJkcGNkX2lycV92ZWN0b3IgPSAweCV4IiwgZHBj
ZF9pcnFfdmVjdG9yKTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJsaW5rX3N0YXR1cyA9
ICUqcGgiLAorCQkJICAgICAoaW50KUFSUkFZX1NJWkUobGlua19zdGF0dXMpLCBsaW5rX3N0YXR1
cyk7CisKKwlpZiAoZHBjZF9pcnFfdmVjdG9yICYgRFBfQ1BfSVJRKSB7CisJCWJzdGF0dXMgPSBk
cHR4X2RwY2RyZChpdDY1MDUsIERQX0FVWF9IRENQX0JTVEFUVVMpOworCQlkcHR4c2V0KGl0NjUw
NSwgMHgzOSwgMHgwMiwgMHgwMik7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIlJlY2Vp
dmUgQ1BfSVJRLCBic3RhdHVzID0gMHglMDJ4IiwKKwkJCQkgICAgIGJzdGF0dXMpOworCQlkcHR4
X2RlYnVnX3ByaW50KGl0NjUwNSwgMHg1NSwgIiIpOworCisJCWlmIChic3RhdHVzICYgRFBfQlNU
QVRVU19SRUFEWSkKKwkJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkhEQ1AgS1NWIGxpc3Qg
cmVhZHkiKTsKKworCQlpZiAoYnN0YXR1cyAmIERQX0JTVEFUVVNfTElOS19GQUlMVVJFKSB7CisJ
CQlEUk1fREVWX0RFQlVHX0RSSVZFUigKKwkJCQlkZXYsICJMaW5rIEludGVncml0eSBGYWlsLCBy
ZXN0YXJ0IEhEQ1AiKTsKKwkJCXJldHVybjsKKwkJfQorCQlpZiAoYnN0YXR1cyAmIERQX0JTVEFU
VVNfUjBfUFJJTUVfUkVBRFkpCisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJIRENQIFIw
JyByZWFkeSIpOworCX0KKworCWlmIChkcF9saW5rX3N0YXR1cyhsaW5rX3N0YXR1cywgRFBfTEFO
RV9BTElHTl9TVEFUVVNfVVBEQVRFRCkgJgorCSAgICBEUF9MSU5LX1NUQVRVU19VUERBVEVEKSB7
CisJCWlmICghZHJtX2RwX2NoYW5uZWxfZXFfb2sobGlua19zdGF0dXMsCisJCQkJCSAgaXQ2NTA1
LT5saW5rLm51bV9sYW5lcykpIHsKKwkJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkxpbmsg
UmUtVHJhaW5pbmciKTsKKwkJCWRwdHhzZXQoaXQ2NTA1LCAweEQzLCAweDMwLCAweDMwKTsKKwkJ
CWRwdHhzZXQoaXQ2NTA1LCAweEU4LCAweDMzLCAweDAwKTsKKwkJCW1zbGVlcCg1MDApOworCQkJ
ZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX0hQRCk7CisJCQlnb19vbl9mc20oaXQ2NTA1KTsKKwkJ
fQorCX0KK30KKworc3RhdGljIHZvaWQgZ29fb25fZnNtKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkK
K3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRldjsKKworCWlmIChp
dDY1MDUtPmNwX2NhcGFibGUpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiU3VwcG9y
dCBIRENQLCBjcF9jYXBhYmxlOiAlZCIsCisJCQkJICAgICBpdDY1MDUtPmNwX2NhcGFibGUpOwor
CQlpZiAoaXQ2NTA1LT5lbl9oZGNwKSB7CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJF
bmFibGUgSERDUCIpOworCQkJdG9fZnNtX3N0YXR1cyhpdDY1MDUsIFNZU19SZUhEQ1ApOworCQkJ
ZHB0eF9zeXNfZnNtKGl0NjUwNSk7CisKKwkJfSBlbHNlIHsKKwkJCURSTV9ERVZfREVCVUdfRFJJ
VkVSKGRldiwgIkRpc2FibGUgSERDUCIpOworCQkJdG9fZnNtX3N0YXR1cyhpdDY1MDUsIFNZU19O
T1JPUCk7CisJCX0KKwl9IGVsc2UgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJOb3Qg
c3VwcG9ydCBIRENQIik7CisJCXRvX2ZzbV9zdGF0dXMoaXQ2NTA1LCBTWVNfTk9ST1ApOworCX0K
K30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2NoZWNrX3JlZzA2KHN0cnVjdCBpdDY1MDUgKml0NjUw
NSwgdW5zaWduZWQgaW50IHJlZzA2KQoreworCXVuc2lnbmVkIGludCByZGRhdGE7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisKKwlpZiAocmVnMDYgJiBCSVQo
MCkpIHsKKwkJLyogaHBkIHBpbiBzdGF0dXMgY2hhbmdlICovCisJCURSTV9ERVZfREVCVUdfRFJJ
VkVSKGRldiwgIkhQRCBDaGFuZ2UgSW50ZXJydXB0Iik7CisJCWlmIChkcHR4X2dldHNpbmtocGQo
aXQ2NTA1KSkgeworCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX0hQRCk7CisJCQlkcHR4X3N5
c19mc20oaXQ2NTA1KTsKKwkJCWRwdHhyZChpdDY1MDUsIDB4MEQsICZyZGRhdGEpOworCQkJaWYg
KHJkZGF0YSAmIEJJVCgyKSkgeworCQkJCWdvX29uX2ZzbShpdDY1MDUpOworCQkJfSBlbHNlIHsK
KwkJCQlkcHR4d3IoaXQ2NTA1LCAweDA1LCAweDAwKTsKKwkJCQlkcHR4c2V0KGl0NjUwNSwgMHg2
MSwgMHgwMiwgMHgwMik7CisJCQkJZHB0eHNldChpdDY1MDUsIDB4NjEsIDB4MDIsIDB4MDApOwor
CQkJfQorCQl9IGVsc2UgeworCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX1VOUExVRyk7CisJ
CQlkcHR4X3N5c19mc20oaXQ2NTA1KTsKKwkJCXJldHVybjsKKwkJfQorCX0KKworCWlmIChpdDY1
MDUtPmNwX2NhcGFibGUpIHsKKwkJaWYgKHJlZzA2ICYgQklUKDQpKSB7CisJCQlEUk1fREVWX0RF
QlVHX0RSSVZFUihkZXYsCisJCQkJCSAgICAgIkhEQ1AgZW5jcnlwdGlvbiBEb25lIEludGVycnVw
dCIpOworCQkJaXQ2NTA1LT5jcF9kb25lID0gMTsKKwkJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZ
U19OT1JPUCk7CisJCX0KKworCQlpZiAocmVnMDYgJiBCSVQoMykpIHsKKwkJCURSTV9ERVZfREVC
VUdfRFJJVkVSKAorCQkJCWRldiwgIkhEQ1AgZW5jcnlwdGlvbiBGYWlsIEludGVycnVwdCwgcmV0
cnkiKTsKKwkJCWl0NjUwNS0+Y3BfZG9uZSA9IDA7CisJCQlpdDY1MDVfaW5pdF9hbmRfbWFza19v
bihpdDY1MDUpOworCQl9CisJfQorCisJaWYgKHJlZzA2ICYgQklUKDEpKSB7CisJCURSTV9ERVZf
REVCVUdfRFJJVkVSKGRldiwgIkhQRCBJUlEgSW50ZXJydXB0Iik7CisJCWhwZF9pcnEoaXQ2NTA1
KTsKKwl9CisKKwlpZiAocmVnMDYgJiBCSVQoMikpIHsKKwkJZHB0eHJkKGl0NjUwNSwgMHgwRCwg
JnJkZGF0YSk7CisKKwkJaWYgKHJkZGF0YSAmIEJJVCgyKSkgeworCQkJRFJNX0RFVl9ERUJVR19E
UklWRVIoZGV2LCAiVmlkZW8gU3RhYmxlIE9uIEludGVycnVwdCIpOworCQkJaXQ2NTA1LT52aWRz
dGFibGVfZG9uZSA9IDE7CisJCQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBTWVNfQVVUT1RSQUlOKTsK
KwkJCWdvX29uX2ZzbShpdDY1MDUpOworCQl9IGVsc2UgeworCQkJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAiVmlkZW8gU3RhYmxlIE9mZiBJbnRlcnJ1cHQiKTsKKwkJCWl0NjUwNS0+dmlkc3Rh
YmxlX2RvbmUgPSAwOworCQl9CisJfQorfQorCitzdGF0aWMgdm9pZCBpdDY1MDVfY2hlY2tfcmVn
MDcoc3RydWN0IGl0NjUwNSAqaXQ2NTA1LCB1bnNpZ25lZCBpbnQgcmVnMDcpCit7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50LT5kZXY7CisJdW5zaWduZWQgaW50IGxlbiwg
aTsKKwl1bnNpZ25lZCBpbnQgYnN0YXR1czsKKworCWlmIChpdDY1MDUtPnN0YXR1cyA9PSBTWVNf
VU5QTFVHKQorCQlyZXR1cm47CisJaWYgKHJlZzA3ICYgQklUKDApKQorCQlEUk1fREVWX0RFQlVH
X0RSSVZFUihkZXYsICJBVVggUEMgUmVxdWVzdCBGYWlsIEludGVycnVwdCIpOworCisJaWYgKHJl
ZzA3ICYgQklUKDEpKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkhEQ1AgZXZlbnQg
SW50ZXJydXB0Iik7CisJCWZvciAoaSA9IDA7IGkgPCBQT0xMSU5HS1NWTElTVDsgaSsrKSB7CisJ
CQlic3RhdHVzID0gZHB0eF9kcGNkcmQoaXQ2NTA1LCBEUF9BVVhfSERDUF9CU1RBVFVTKTsKKwkJ
CXVzbGVlcF9yYW5nZSgyMDAwLCAzMDAwKTsKKwkJCWlmIChic3RhdHVzICYgRFBfQlNUQVRVU19S
RUFEWSkKKwkJCQlicmVhazsKKwkJfQorCisJCS8qCisJCSAqIFJlYWQgQnN0YXR1cyB0byBkZXRl
cm1pbmUgd2hhdCBoYXBwZW5lZAorCQkgKi8KKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAi
QnN0YXR1czogMHglMDJ4IiwgYnN0YXR1cyk7CisJCWRwdHhfZGVidWdfcHJpbnQoaXQ2NTA1LCAw
eDNCLCAiYXIwX2xvdyIpOworCQlkcHR4X2RlYnVnX3ByaW50KGl0NjUwNSwgMHgzQywgImFyMF9o
aWdoIik7CisJCWRwdHhfZGVidWdfcHJpbnQoaXQ2NTA1LCAweDQ1LCAiYnIwX2xvdyIpOworCQlk
cHR4X2RlYnVnX3ByaW50KGl0NjUwNSwgMHg0NiwgImJyMF9oaWdoIik7CisKKwkJaWYgKGJzdGF0
dXMgJiBEUF9CU1RBVFVTX1JFQURZKSB7CisJCQlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJI
RENQIEtTViBsaXN0IHJlYWR5Iik7CisJCQlsZW4gPSBpdDY1MDVfbWFrZXVwX3NoYTFfaW5wdXQo
aXQ2NTA1KTsKKwkJCXNoYTFfZGlnZXN0KGl0NjUwNSwgaXQ2NTA1LT5zaGFpbnB1dCwgbGVuLAor
CQkJCSAgICAodTggKilpdDY1MDUtPmF2KTsKKwkJCWl0NjUwNV9jaGVja19zaGExX3Jlc3VsdChp
dDY1MDUpOworCQl9CisJfQorCWlmIChpdDY1MDUtPmVuX2F1ZGlvICYmIChyZWcwNyAmIEJJVCgy
KSkpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoZGV2LCAiQXVkaW8gRklGTyBPdmVyRmxvdyBJ
bnRlcnJ1cHQiKTsKKwkJZHB0eF9kZWJ1Z19wcmludChpdDY1MDUsIDB4QkUsICIiKTsKKwkJZHB0
eHNldChpdDY1MDUsIDB4RDMsIDB4MjAsIDB4MjApOworCQlkcHR4c2V0KGl0NjUwNSwgMHhFOCwg
MHgyMiwgMHgwMCk7CisJCWRwdHhzZXQoaXQ2NTA1LCAweEI4LCAweDgwLCAweDgwKTsKKwkJZHB0
eHNldChpdDY1MDUsIDB4QjgsIDB4ODAsIDB4MDApOworCQlpdDY1MDVfc2V0X2F1ZGlvKGl0NjUw
NSk7CisJfQorCWlmIChpdDY1MDUtPmVuX2F1ZGlvICYmIChyZWcwNyAmIEJJVCg1KSkpCisJCURS
TV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIkF1ZGlvIGluZm9mcmFtZSBwYWNrZXQgZG9uZSIpOwor
fQorCitzdGF0aWMgdm9pZCBpdDY1MDVfY2hlY2tfcmVnMDgoc3RydWN0IGl0NjUwNSAqaXQ2NTA1
LCB1bnNpZ25lZCBpbnQgcmVnMDgpCit7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+
Y2xpZW50LT5kZXY7CisKKwlpZiAoaXQ2NTA1LT5zdGF0dXMgPT0gU1lTX1VOUExVRykKKwkJcmV0
dXJuOworCWlmIChpdDY1MDUtPmVuX2F1ZGlvICYmIChyZWcwOCAmIEJJVCgxKSkpCisJCURSTV9E
RVZfREVCVUdfRFJJVkVSKGRldiwgIkF1ZGlvIFRpbWVTdGFtcCBQYWNrZXQgRG9uZSEiKTsKKwor
CWlmIChpdDY1MDUtPmVuX2F1ZGlvICYmIChyZWcwOCAmIEJJVCgzKSkpIHsKKwkJRFJNX0RFVl9E
RUJVR19EUklWRVIoZGV2LCAiQXVkaW8gTSBFcnJvciBJbnRlcnJ1cHQgLi4uIik7CisJCXNob3df
YXVkX21jbnQoaXQ2NTA1KTsKKwl9CisJaWYgKHJlZzA4ICYgQklUKDQpKSB7CisJCURSTV9ERVZf
REVCVUdfRFJJVkVSKGRldiwgIkxpbmsgVHJhaW5pbmcgRmFpbCBJbnRlcnJ1cHQiKTsKKwkJLyog
cmVzdGFydCB0cmFpbmluZyAqLworCQlkcHR4X3N5c19jaGcoaXQ2NTA1LCBTWVNfQVVUT1RSQUlO
KTsKKwkJZ29fb25fZnNtKGl0NjUwNSk7CisJfQorCisJaWYgKHJlZzA4ICYgQklUKDcpKSB7CisJ
CURSTV9ERVZfREVCVUdfRFJJVkVSKGRldiwgIklPIExhdGNoIEZJRk8gT3ZlckZsb3cgSW50ZXJy
dXB0Iik7CisJCWRwdHhzZXQoaXQ2NTA1LCAweDYxLCAweDAyLCAweDAyKTsKKwkJZHB0eHNldChp
dDY1MDUsIDB4NjEsIDB4MDIsIDB4MDApOworCX0KK30KKworc3RhdGljIHZvaWQgaXQ2NTA1X2Rw
dHhfaXJxKHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwl1bnNpZ25lZCBpbnQgcmVnMDYsIHJl
ZzA3LCByZWcwOCwgcmVnMGQ7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJml0NjUwNS0+Y2xpZW50
LT5kZXY7CisKKwlkcHR4cmQoaXQ2NTA1LCAweDA2LCAmcmVnMDYpOworCWRwdHhyZChpdDY1MDUs
IDB4MDcsICZyZWcwNyk7CisJZHB0eHJkKGl0NjUwNSwgMHgwOCwgJnJlZzA4KTsKKwlkcHR4cmQo
aXQ2NTA1LCAweDBELCAmcmVnMGQpOworCisJZHB0eHdyKGl0NjUwNSwgMHgwNiwgcmVnMDYpOwor
CWRwdHh3cihpdDY1MDUsIDB4MDcsIHJlZzA3KTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA4LCByZWcw
OCk7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWcwNiA9IDB4JTAyeCIsIHJlZzA2
KTsKKwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWcwNyA9IDB4JTAyeCIsIHJlZzA3KTsK
KwlEUk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWcwOCA9IDB4JTAyeCIsIHJlZzA4KTsKKwlE
Uk1fREVWX0RFQlVHX0RSSVZFUihkZXYsICJyZWcwZCA9IDB4JTAyeCIsIHJlZzBkKTsKKworCWlm
IChyZWcwNiAhPSAwKQorCQlpdDY1MDVfY2hlY2tfcmVnMDYoaXQ2NTA1LCByZWcwNik7CisKKwlp
ZiAocmVnMDcgIT0gMCkKKwkJaXQ2NTA1X2NoZWNrX3JlZzA3KGl0NjUwNSwgcmVnMDcpOworCisJ
aWYgKHJlZzA4ICE9IDApCisJCWl0NjUwNV9jaGVja19yZWcwOChpdDY1MDUsIHJlZzA4KTsKK30K
Kworc3RhdGljIHZvaWQgaXQ2NTA1X2JyaWRnZV9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBicmlkZ2VfdG9faXQ2NTA1KGJyaWRn
ZSk7CisKKwlpZiAoIWl0NjUwNS0+ZHJ2X2hvbGQpIHsKKwkJaXQ2NTA1X2ludF9tYXNrX29uKGl0
NjUwNSk7CisJCWRwdHhfc3lzX2NoZyhpdDY1MDUsIFNZU19IUEQpOworCX0KK30KKworc3RhdGlj
IHZvaWQgaXQ2NTA1X2JyaWRnZV9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7
CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gYnJpZGdlX3RvX2l0NjUwNShicmlkZ2UpOworCisJ
ZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX1VOUExVRyk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX2JyaWRnZV9mdW5jcyBpdDY1MDVfYnJpZGdlX2Z1bmNzID0geworCS5hdHRhY2ggPSBp
dDY1MDVfYnJpZGdlX2F0dGFjaCwKKwkuZGV0YWNoID0gaXQ2NTA1X2JyaWRnZV9kZXRhY2gsCisJ
Lm1vZGVfdmFsaWQgPSBpdDY1MDVfYnJpZGdlX21vZGVfdmFsaWQsCisJLm1vZGVfc2V0ID0gaXQ2
NTA1X2JyaWRnZV9tb2RlX3NldCwKKwkuZW5hYmxlID0gaXQ2NTA1X2JyaWRnZV9lbmFibGUsCisJ
LmRpc2FibGUgPSBpdDY1MDVfYnJpZGdlX2Rpc2FibGUsCit9OworCitzdGF0aWMgdm9pZCBpdDY1
MDVfY2xlYXJfaW50KHN0cnVjdCBpdDY1MDUgKml0NjUwNSkKK3sKKwlkcHR4d3IoaXQ2NTA1LCAw
eDA2LCAweEZGKTsKKwlkcHR4d3IoaXQ2NTA1LCAweDA3LCAweEZGKTsKKwlkcHR4d3IoaXQ2NTA1
LCAweDA4LCAweEZGKTsKK30KKworc3RhdGljIGlycXJldHVybl90IGl0NjUwNV9pbnRwX3RocmVh
ZGVkX2hhbmRsZXIoaW50IHVudXNlZCwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDUgPSBkYXRhOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpdDY1MDUtPmNsaWVudC0+ZGV2
OworCisJbXNsZWVwKDE1MCk7CisJbXV0ZXhfbG9jaygmaXQ2NTA1LT5sb2NrKTsKKworCWlmIChp
dDY1MDUtPmRydl9ob2xkID09IDAgJiYgaXQ2NTA1LT5wb3dlcmVkKSB7CisJCURSTV9ERVZfREVC
VUdfRFJJVkVSKGRldiwgImludG8gaXQ2NTA1X2RwdHhfaXJxIik7CisJCWl0NjUwNV9kcHR4X2ly
cShpdDY1MDUpOworCX0KKworCW11dGV4X3VubG9jaygmaXQ2NTA1LT5sb2NrKTsKKwlyZXR1cm4g
SVJRX0hBTkRMRUQ7Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X2luaXRfcGRhdGEoc3RydWN0IGl0
NjUwNSAqaXQ2NTA1KQoreworCXN0cnVjdCBpdDY1MDVfcGxhdGZvcm1fZGF0YSAqcGRhdGEgPSAm
aXQ2NTA1LT5wZGF0YTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaXQ2NTA1LT5jbGllbnQtPmRl
djsKKworCS8qIDEuMFYgZGlnaXRhbCBjb3JlIHBvd2VyIHJlZ3VsYXRvciAgKi8KKwlwZGF0YS0+
cHdyMTggPSBkZXZtX3JlZ3VsYXRvcl9nZXQoZGV2LCAicHdyMTgiKTsKKwlpZiAoSVNfRVJSKHBk
YXRhLT5wd3IxOCkpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYsICJwd3IxOCByZWd1bGF0b3Igbm90
IGZvdW5kIik7CisJCXJldHVybiBQVFJfRVJSKHBkYXRhLT5wd3IxOCk7CisJfQorCisJcGRhdGEt
Pm92ZGQgPSBkZXZtX3JlZ3VsYXRvcl9nZXQoZGV2LCAib3ZkZCIpOworCWlmIChJU19FUlIocGRh
dGEtPm92ZGQpKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAib3ZkZCByZWd1bGF0b3Igbm90IGZv
dW5kIik7CisJCXJldHVybiBQVFJfRVJSKHBkYXRhLT5vdmRkKTsKKwl9CisKKwkvKiBHUElPIGZv
ciBIUEQgKi8KKwlwZGF0YS0+Z3Bpb2RfaHBkID0gZGV2bV9ncGlvZF9nZXQoZGV2LCAiaHBkIiwg
R1BJT0RfSU4pOworCWlmIChJU19FUlIocGRhdGEtPmdwaW9kX2hwZCkpCisJCXJldHVybiBQVFJf
RVJSKHBkYXRhLT5ncGlvZF9ocGQpOworCisJLyogR1BJTyBmb3IgY2hpcCByZXNldCAqLworCXBk
YXRhLT5ncGlvZF9yZXNldCA9IGRldm1fZ3Bpb2RfZ2V0KGRldiwgInJlc2V0IiwgR1BJT0RfT1VU
X0hJR0gpOworCisJcmV0dXJuIFBUUl9FUlJfT1JfWkVSTyhwZGF0YS0+Z3Bpb2RfcmVzZXQpOwor
fQorCitzdGF0aWMgc3NpemVfdCBkcnZfaG9sZF9zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkgICAgIGNoYXIgKmJ1ZikKK3sKKwlzdHJ1
Y3QgaXQ2NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCXJldHVybiBzY25w
cmludGYoYnVmLCBQQUdFX1NJWkUsICIlZFxuIiwgaXQ2NTA1LT5kcnZfaG9sZCk7Cit9CisKK3N0
YXRpYyBzc2l6ZV90IGRydl9ob2xkX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRl
dmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBj
b3VudCkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsK
KworCWlmIChrc3RydG9pbnQoYnVmLCAxMCwgJml0NjUwNS0+ZHJ2X2hvbGQpIDwgMCkKKwkJcmV0
dXJuIC1FSU5WQUw7CisKKwlpZiAoaXQ2NTA1LT5kcnZfaG9sZCkgeworCQlpdDY1MDVfaW50X21h
c2tfb2ZmKGl0NjUwNSk7CisJfSBlbHNlIHsKKwkJaXQ2NTA1X2NsZWFyX2ludChpdDY1MDUpOwor
CQlpdDY1MDVfaW50X21hc2tfb24oaXQ2NTA1KTsKKwl9CisJcmV0dXJuIGNvdW50OworfQorCitz
dGF0aWMgc3NpemVfdCBwcmludF90aW1pbmdfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJ
IHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCit7CisJc3RydWN0IGl0
NjUwNSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKnZpZCA9ICZpdDY1MDUtPnZpZF9pbmZvOworCWNoYXIgKnN0ciA9IGJ1ZiwgKmVuZCA9
IGJ1ZiArIFBBR0VfU0laRTsKKworCXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIsICIt
LS12aWRlbyB0aW1pbmctLS1cbiIpOworCXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBzdHIs
ICJQQ0xLOiVkLiUwM2RNSHpcbiIsIHZpZC0+Y2xvY2sgLyAxMDAwLAorCQkJIHZpZC0+Y2xvY2sg
JSAxMDAwKTsKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiSFRvdGFsOiVkXG4i
LCB2aWQtPmh0b3RhbCk7CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIkhBY3Rp
dmU6JWRcbiIsIHZpZC0+aGRpc3BsYXkpOworCXN0ciArPSBzY25wcmludGYoc3RyLCBlbmQgLSBz
dHIsICJIRnJvbnRQb3JjaDolZFxuIiwKKwkJCSB2aWQtPmhzeW5jX3N0YXJ0IC0gdmlkLT5oZGlz
cGxheSk7CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIkhTeW5jV2lkdGg6JWRc
biIsCisJCQkgdmlkLT5oc3luY19lbmQgLSB2aWQtPmhzeW5jX3N0YXJ0KTsKKwlzdHIgKz0gc2Nu
cHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiSEJhY2tQb3JjaDolZFxuIiwKKwkJCSB2aWQtPmh0b3Rh
bCAtIHZpZC0+aHN5bmNfZW5kKTsKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAi
VlRvdGFsOiVkXG4iLCB2aWQtPnZ0b3RhbCk7CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAt
IHN0ciwgIlZBY3RpdmU6JWRcbiIsIHZpZC0+dmRpc3BsYXkpOworCXN0ciArPSBzY25wcmludGYo
c3RyLCBlbmQgLSBzdHIsICJWRnJvbnRQb3JjaDolZFxuIiwKKwkJCSB2aWQtPnZzeW5jX3N0YXJ0
IC0gdmlkLT52ZGlzcGxheSk7CisJc3RyICs9IHNjbnByaW50ZihzdHIsIGVuZCAtIHN0ciwgIlZT
eW5jV2lkdGg6JWRcbiIsCisJCQkgdmlkLT52c3luY19lbmQgLSB2aWQtPnZzeW5jX3N0YXJ0KTsK
KwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiVkJhY2tQb3JjaDolZFxuIiwKKwkJ
CSB2aWQtPnZ0b3RhbCAtIHZpZC0+dnN5bmNfZW5kKTsKKworCXJldHVybiBzdHIgLSBidWY7Cit9
CisKK3N0YXRpYyBzc2l6ZV90IHNoYV9kZWJ1Z19zaG93KHN0cnVjdCBkZXZpY2UgKmRldiwgc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkgICAgICBjaGFyICpidWYpCit7CisJaW50
IGkgPSAwOworCWNoYXIgKnN0ciA9IGJ1ZiwgKmVuZCA9IGJ1ZiArIFBBR0VfU0laRTsKKwlzdHJ1
Y3QgaXQ2NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCXN0ciArPSBzY25w
cmludGYoc3RyLCBlbmQgLSBzdHIsICJzaGEgaW5wdXQ6XG4iKTsKKwlmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShpdDY1MDUtPnNoYWlucHV0KTsgaSArPSAxNikKKwkJc3RyICs9IHNjbnByaW50
ZihzdHIsIGVuZCAtIHN0ciwgIiUxNnBoXG4iLAorCQkJCSBpdDY1MDUtPnNoYWlucHV0ICsgaSk7
CisKKwlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiYXY6XG4iKTsKKwlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRShpdDY1MDUtPmF2KTsgaSsrKQorCQlzdHIgKz0gc2NucHJpbnRm
KHN0ciwgZW5kIC0gc3RyLCAiJTRwaFxuIiwgaXQ2NTA1LT5hdltpXSk7CisKKwlzdHIgKz0gc2Nu
cHJpbnRmKHN0ciwgZW5kIC0gc3RyLCAiYnY6XG4iKTsKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShpdDY1MDUtPmJ2KTsgaSsrKQorCQlzdHIgKz0gc2NucHJpbnRmKHN0ciwgZW5kIC0gc3Ry
LCAiJTRwaFxuIiwgaXQ2NTA1LT5idltpXSk7CisKKwlyZXR1cm4gZW5kIC0gc3RyOworfQorCitz
dGF0aWMgc3NpemVfdCBlbl9oZGNwX3Nob3coc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2
aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCSAgICBjaGFyICpidWYpCit7CisJc3RydWN0IGl0NjUw
NSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlyZXR1cm4gc2NucHJpbnRmKGJ1
ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIGl0NjUwNS0+ZW5faGRjcCk7Cit9CisKK3N0YXRpYyBzc2l6
ZV90IGVuX2hkY3Bfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwKKwkJCSAgICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJ
c3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJdW5zaWduZWQg
aW50IHJlZzNmLCBoZGNwOworCisJaWYgKGtzdHJ0b2ludChidWYsIDEwLCAmaXQ2NTA1LT5lbl9o
ZGNwKSA8IDApCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKCFpdDY1MDUtPnBvd2VyZWQgfHwg
aXQ2NTA1LT5zdGF0dXMgPT0gU1lTX1VOUExVRykgeworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihk
ZXYsCisJCQkJICAgICAicG93ZXIgZG93biBvciB1bnBsdWcsIGNhbiBub3QgZmlyZSBIRENQIik7
CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmIChpdDY1MDUtPmVuX2hkY3ApIHsKKwkJaWYg
KGl0NjUwNS0+Y3BfY2FwYWJsZSkgeworCQkJZHB0eF9zeXNfY2hnKGl0NjUwNSwgU1lTX1JlSERD
UCk7CisJCQlkcHR4X3N5c19mc20oaXQ2NTA1KTsKKwkJfSBlbHNlIHsKKwkJCURSTV9ERVZfRVJS
T1IoZGV2LCAic2luayBub3Qgc3VwcG9ydCBIRENQIik7CisJCQlpdDY1MDUtPmNwX2RvbmUgPSAw
OworCQl9CisJfSBlbHNlIHsKKwkJZHB0eHNldChpdDY1MDUsIDB4MDUsIDB4MTAsIDB4MTApOwor
CQlkcHR4c2V0KGl0NjUwNSwgMHgwNSwgMHgxMCwgMHgwMCk7CisJCWRwdHhyZChpdDY1MDUsIDB4
M0YsICZyZWczZik7CisJCWhkY3AgPSAocmVnM2YgJiBCSVQoNykpID4+IDc7CisJCURSTV9ERVZf
REVCVUdfRFJJVkVSKGRldiwgIiVzIHRvIGRpc2FibGUgaGRjcCIsCisJCQkJICAgICBoZGNwID8g
ImZhaWxlZCIgOiAic3VjY2VlZGVkIik7CisJCWl0NjUwNS0+Y3BfZG9uZSA9IGhkY3A7CisJfQor
CXJldHVybiBjb3VudDsKK30KKworc3RhdGljIHNzaXplX3QgZW5fcHdyb25vZmZfc2hvdyhzdHJ1
Y3QgZGV2aWNlICpkZXYsCisJCQkJc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIg
KmJ1ZikKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICppdDY1MDUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsK
KworCXJldHVybiBzY25wcmludGYoYnVmLCBQQUdFX1NJWkUsICIlZFxuIiwgaXQ2NTA1LT5lbl9w
d3Jvbm9mZik7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGVuX3B3cm9ub2ZmX3N0b3JlKHN0cnVjdCBk
ZXZpY2UgKmRldiwKKwkJCQkgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsIGNvbnN0IGNo
YXIgKmJ1ZiwKKwkJCQkgc2l6ZV90IGNvdW50KQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9
IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJaWYgKGtzdHJ0b2ludChidWYsIDEwLCAmaXQ2NTA1
LT5lbl9wd3Jvbm9mZikgPCAwKQorCQlyZXR1cm4gLUVJTlZBTDsKKwlyZXR1cm4gY291bnQ7Cit9
CisKK3N0YXRpYyBzc2l6ZV90IGVuX2F1ZGlvX3Nob3coc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1
Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCSAgICAgY2hhciAqYnVmKQoreworCXN0cnVj
dCBpdDY1MDUgKml0NjUwNSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJcmV0dXJuIHNjbnBy
aW50ZihidWYsIFBBR0VfU0laRSwgIiVkXG4iLCBpdDY1MDUtPmVuX2F1ZGlvKTsKK30KKworc3Rh
dGljIHNzaXplX3QgZW5fYXVkaW9fc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2
aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCSAgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNv
dW50KQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwor
CisJaWYgKGtzdHJ0b2ludChidWYsIDEwLCAmaXQ2NTA1LT5lbl9hdWRpbykgPCAwKQorCQlyZXR1
cm4gLUVJTlZBTDsKKwlpZiAoIWl0NjUwNS0+cG93ZXJlZCB8fCBpdDY1MDUtPnN0YXR1cyA9PSBT
WVNfVU5QTFVHKSB7CisJCURSTV9ERVZfREVCVUdfRFJJVkVSKAorCQkJZGV2LCAicG93ZXIgZG93
biBvciB1bnBsdWcsIGNhbiBub3Qgb3V0cHV0IGF1ZGlvIik7CisJCXJldHVybiAtRUlOVkFMOwor
CX0KKworCWlmIChpdDY1MDUtPmVuX2F1ZGlvKSB7CisJCWl0NjUwNV9zZXRfYXVkaW8oaXQ2NTA1
KTsKKwl9IGVsc2UgeworCQlkcHR4c2V0KGl0NjUwNSwgMHgwNSwgMHgwMiwgMHgwMik7CisJCWRw
dHhzZXQoaXQ2NTA1LCAweDA1LCAweDAyLCAweDAwKTsKKwl9CisJRFJNX0RFVl9ERUJVR19EUklW
RVIoZGV2LCAiJXMgYXVkaW8iLAorCQkJICAgICBpdDY1MDUtPmVuX2F1ZGlvID8gIkVuYWJsZSIg
OiAiRGlzYWJsZSIpOworCXJldHVybiBjb3VudDsKK30KKworc3RhdGljIHNzaXplX3QgZm9yY2Vf
cHdyb25vZmZfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LAorCQkJCSAgICBzdHJ1Y3QgZGV2aWNl
X2F0dHJpYnV0ZSAqYXR0ciwKKwkJCQkgICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQp
Cit7CisJc3RydWN0IGl0NjUwNSAqaXQ2NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50
IHB3cjsKKworCWlmIChrc3RydG9pbnQoYnVmLCAxMCwgJnB3cikgPCAwKQorCQlyZXR1cm4gLUVJ
TlZBTDsKKwlpZiAocHdyKQorCQlpdDY1MDVfcG93ZXJvbihpdDY1MDUpOworCWVsc2UKKwkJaXQ2
NTA1X3Bvd2Vyb2ZmKGl0NjUwNSk7CisJcmV0dXJuIGNvdW50OworfQorCitzdGF0aWMgc3NpemVf
dCBwd3Jfc3RhdHVzX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJICAgICAgIHN0cnVjdCBk
ZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCit7CisJc3RydWN0IGl0NjUwNSAqaXQ2
NTA1ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlyZXR1cm4gc2NucHJpbnRmKGJ1ZiwgUEFH
RV9TSVpFLCAiJWRcbiIsIGl0NjUwNS0+cG93ZXJlZCk7Cit9CisKK3N0YXRpYyBERVZJQ0VfQVRU
Ul9STyhwcmludF90aW1pbmcpOworc3RhdGljIERFVklDRV9BVFRSX1JPKHB3cl9zdGF0dXMpOwor
c3RhdGljIERFVklDRV9BVFRSX1JPKHNoYV9kZWJ1Zyk7CitzdGF0aWMgREVWSUNFX0FUVFJfV08o
Zm9yY2VfcHdyb25vZmYpOworc3RhdGljIERFVklDRV9BVFRSX1JXKGRydl9ob2xkKTsKK3N0YXRp
YyBERVZJQ0VfQVRUUl9SVyhlbl9oZGNwKTsKK3N0YXRpYyBERVZJQ0VfQVRUUl9SVyhlbl9wd3Jv
bm9mZik7CitzdGF0aWMgREVWSUNFX0FUVFJfUlcoZW5fYXVkaW8pOworCitzdGF0aWMgY29uc3Qg
c3RydWN0IGF0dHJpYnV0ZSAqaXQ2NTA1X2F0dHJzW10gPSB7CisJJmRldl9hdHRyX2Rydl9ob2xk
LmF0dHIsCisJJmRldl9hdHRyX3ByaW50X3RpbWluZy5hdHRyLAorCSZkZXZfYXR0cl9zaGFfZGVi
dWcuYXR0ciwKKwkmZGV2X2F0dHJfZW5faGRjcC5hdHRyLAorCSZkZXZfYXR0cl9lbl9wd3Jvbm9m
Zi5hdHRyLAorCSZkZXZfYXR0cl9lbl9hdWRpby5hdHRyLAorCSZkZXZfYXR0cl9mb3JjZV9wd3Jv
bm9mZi5hdHRyLAorCSZkZXZfYXR0cl9wd3Jfc3RhdHVzLmF0dHIsCisJTlVMTCwKK307CisKK3N0
YXRpYyBpbnQgaXQ2NTA1X2kyY19wcm9iZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50LAorCQkJ
ICAgIGNvbnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkICppZCkKK3sKKwlzdHJ1Y3QgaXQ2NTA1ICpp
dDY1MDU7CisJc3RydWN0IGl0NjUwNV9wbGF0Zm9ybV9kYXRhICpwZGF0YTsKKwlzdHJ1Y3QgZGV2
aWNlICpkZXYgPSAmY2xpZW50LT5kZXY7CisJc3RydWN0IGV4dGNvbl9kZXYgKmV4dGNvbjsKKwlp
bnQgZXJyLCBpbnRwX2lycTsKKworCWl0NjUwNSA9IGRldm1fa3phbGxvYygmY2xpZW50LT5kZXYs
IHNpemVvZigqaXQ2NTA1KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFpdDY1MDUpCisJCXJldHVybiAt
RU5PTUVNOworCisJbXV0ZXhfaW5pdCgmaXQ2NTA1LT5sb2NrKTsKKwltdXRleF9pbml0KCZpdDY1
MDUtPm1vZGVfbG9jayk7CisKKwlwZGF0YSA9ICZpdDY1MDUtPnBkYXRhOworCisJaXQ2NTA1LT5i
cmlkZ2Uub2Zfbm9kZSA9IGNsaWVudC0+ZGV2Lm9mX25vZGU7CisJaXQ2NTA1LT5jbGllbnQgPSBj
bGllbnQ7CisJaTJjX3NldF9jbGllbnRkYXRhKGNsaWVudCwgaXQ2NTA1KTsKKworCS8qIGdldCBl
eHRjb24gZGV2aWNlIGZyb20gRFRTICovCisJZXh0Y29uID0gZXh0Y29uX2dldF9lZGV2X2J5X3Bo
YW5kbGUoZGV2LCAwKTsKKwlpZiAoUFRSX0VSUihleHRjb24pID09IC1FUFJPQkVfREVGRVIpCisJ
CXJldHVybiAtRVBST0JFX0RFRkVSOworCWlmIChJU19FUlIoZXh0Y29uKSkgeworCQlEUk1fREVW
X0VSUk9SKGRldiwgImNhbiBub3QgZ2V0IGV4dGNvbiBkZXZpY2UhIik7CisJCXJldHVybiAtRUlO
VkFMOworCX0KKworCWl0NjUwNS0+ZXh0Y29uID0gZXh0Y29uOworCisJaXQ2NTA1LT5sYW5lc3dh
cF9kaXNhYmxlZCA9CisJCWRldmljZV9wcm9wZXJ0eV9yZWFkX2Jvb2woZGV2LCAibm8tbGFuZXN3
YXAiKTsKKworCWVyciA9IGl0NjUwNV9pbml0X3BkYXRhKGl0NjUwNSk7CisJaWYgKGVycikgewor
CQlEUk1fREVWX0VSUk9SKGRldiwgIkZhaWxlZCB0byBpbml0aWFsaXplIHBkYXRhOiAlZCIsIGVy
cik7CisJCXJldHVybiBlcnI7CisJfQorCisJaXQ2NTA1LT5yZWdtYXAgPQorCQlkZXZtX3JlZ21h
cF9pbml0X2kyYyhjbGllbnQsICZpdDY1MDVfYnJpZGdlX3JlZ21hcF9jb25maWcpOworCWlmIChJ
U19FUlIoaXQ2NTA1LT5yZWdtYXApKSB7CisJCURSTV9ERVZfRVJST1IoZGV2LCAicmVnbWFwIGky
YyBpbml0IGZhaWxlZCIpOworCQlyZXR1cm4gUFRSX0VSUihpdDY1MDUtPnJlZ21hcCk7CisJfQor
CisJaW50cF9pcnEgPSBjbGllbnQtPmlycTsKKworCWlmICghaW50cF9pcnEpIHsKKwkJRFJNX0RF
Vl9FUlJPUihkZXYsICJGYWlsZWQgdG8gZ2V0IENBQkxFX0RFVCBhbmQgSU5UUCBJUlEiKTsKKwkJ
cmV0dXJuIC1FTk9ERVY7CisJfQorCisJZXJyID0gZGV2bV9yZXF1ZXN0X3RocmVhZGVkX2lycSgm
Y2xpZW50LT5kZXYsIGludHBfaXJxLCBOVUxMLAorCQkJCQlpdDY1MDVfaW50cF90aHJlYWRlZF9o
YW5kbGVyLAorCQkJCQlJUlFGX1RSSUdHRVJfRkFMTElORyB8IElSUUZfT05FU0hPVCwKKwkJCQkJ
Iml0NjUwNS1pbnRwIiwgaXQ2NTA1KTsKKwlpZiAoZXJyKSB7CisJCURSTV9ERVZfRVJST1IoZGV2
LCAiRmFpbGVkIHRvIHJlcXVlc3QgSU5UUCB0aHJlYWRlZCBJUlE6ICVkIiwKKwkJCSAgICAgIGVy
cik7CisJCXJldHVybiBlcnI7CisJfQorCisJLyogUmVnaXN0ZXIgYXV4IGNoYW5uZWwgKi8KKwlp
dDY1MDUtPmF1eC5uYW1lID0gIkRQLUFVWCI7CisJaXQ2NTA1LT5hdXguZGV2ID0gZGV2OworCWl0
NjUwNS0+YXV4LnRyYW5zZmVyID0gaXQ2NTA1X2F1eF90cmFuc2ZlcjsKKwllcnIgPSBkcm1fZHBf
YXV4X3JlZ2lzdGVyKCZpdDY1MDUtPmF1eCk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0RFVl9F
UlJPUihkZXYsICJGYWlsZWQgdG8gcmVnaXN0ZXIgYXV4OiAlZCIsIGVycik7CisJCXJldHVybiBl
cnI7CisJfQorCisJaXQ2NTA1LT5lbl9wd3Jvbm9mZiA9IERFRkFVTFRQV1JPTk9GRjsKKwlpdDY1
MDUtPmRydl9ob2xkID0gREVGQVVMVERSVkhPTEQ7CisJaXQ2NTA1LT5lbl9oZGNwID0gREVGQVVM
VEhEQ1A7CisJaXQ2NTA1LT5lbl9hdWRpbyA9IERFRkFVTFRBVURJTzsKKwlpdDY1MDUtPnBvd2Vy
ZWQgPSAwOworCisJaWYgKERFRkFVTFRQV1JPTikKKwkJaXQ2NTA1X3Bvd2Vyb24oaXQ2NTA1KTsK
KwllcnIgPSBzeXNmc19jcmVhdGVfZmlsZXMoJmNsaWVudC0+ZGV2LmtvYmosIGl0NjUwNV9hdHRy
cyk7CisJaWYgKGVycikgeworCQlkcm1fZHBfYXV4X3VucmVnaXN0ZXIoJml0NjUwNS0+YXV4KTsK
KwkJcmV0dXJuIGVycjsKKwl9CisKKwlpdDY1MDUtPmJyaWRnZS5mdW5jcyA9ICZpdDY1MDVfYnJp
ZGdlX2Z1bmNzOworCWRybV9icmlkZ2VfYWRkKCZpdDY1MDUtPmJyaWRnZSk7CisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyBpbnQgaXQ2NTA1X3JlbW92ZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50
KQoreworCXN0cnVjdCBpdDY1MDUgKml0NjUwNSA9IGkyY19nZXRfY2xpZW50ZGF0YShjbGllbnQp
OworCisJZHJtX2JyaWRnZV9yZW1vdmUoJml0NjUwNS0+YnJpZGdlKTsKKwlzeXNmc19yZW1vdmVf
ZmlsZXMoJmNsaWVudC0+ZGV2LmtvYmosIGl0NjUwNV9hdHRycyk7CisJa2ZyZWUoaXQ2NTA1LT5l
ZGlkKTsKKwlpdDY1MDUtPmVkaWQgPSBOVUxMOworCWRybV9jb25uZWN0b3JfdW5yZWdpc3Rlcigm
aXQ2NTA1LT5jb25uZWN0b3IpOworCWRybV9kcF9hdXhfdW5yZWdpc3RlcigmaXQ2NTA1LT5hdXgp
OworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGkyY19kZXZpY2VfaWQgaXQ2
NTA1X2lkW10gPSB7CisJeyAiaXQ2NTA1IiwgMCB9LAorCXsgfQorfTsKKworTU9EVUxFX0RFVklD
RV9UQUJMRShpMmMsIGl0NjUwNV9pZCk7CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNl
X2lkIGl0NjUwNV9vZl9tYXRjaFtdID0geworCXsgLmNvbXBhdGlibGUgPSAiaXRlLGl0NjUwNSIg
fSwKKwl7IH0KK307CisKK3N0YXRpYyBzdHJ1Y3QgaTJjX2RyaXZlciBpdDY1MDVfaTJjX2RyaXZl
ciA9IHsKKwkuZHJpdmVyID0geworCQkubmFtZSA9ICJpdDY1MDVfZHB0eCIsCisJCS5vZl9tYXRj
aF90YWJsZSA9IGl0NjUwNV9vZl9tYXRjaCwKKwl9LAorCS5wcm9iZSA9IGl0NjUwNV9pMmNfcHJv
YmUsCisJLnJlbW92ZSA9IGl0NjUwNV9yZW1vdmUsCisJLmlkX3RhYmxlID0gaXQ2NTA1X2lkLAor
fTsKKworbW9kdWxlX2kyY19kcml2ZXIoaXQ2NTA1X2kyY19kcml2ZXIpOworCitNT0RVTEVfQVVU
SE9SKCJKaXRhbyBTaGkgPGppdGFvLnNoaUBtZWRpYXRlay5jb20+Iik7CitNT0RVTEVfREVTQ1JJ
UFRJT04oIklUNjUwNSBEaXNwbGF5UG9ydCBUcmFuc21pdHRlciBkcml2ZXIiKTsKK01PRFVMRV9M
SUNFTlNFKCJHUEwgdjIiKTsKLS0gCjEuOS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWw=
