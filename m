Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 634108637A
	for <lists+dri-devel@lfdr.de>; Thu,  8 Aug 2019 15:44:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2606889137;
	Thu,  8 Aug 2019 13:44:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B4406E84E
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Aug 2019 13:44:24 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 30F40C0546D5;
 Thu,  8 Aug 2019 13:44:24 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-144.ams2.redhat.com
 [10.36.116.144])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 02A885C220;
 Thu,  8 Aug 2019 13:44:18 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 31E8C17444; Thu,  8 Aug 2019 15:44:18 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 01/17] drm/ttm: turn ttm_bo_device.vma_manager into a
 pointer
Date: Thu,  8 Aug 2019 15:44:01 +0200
Message-Id: <20190808134417.10610-2-kraxel@redhat.com>
In-Reply-To: <20190808134417.10610-1-kraxel@redhat.com>
References: <20190808134417.10610-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Thu, 08 Aug 2019 13:44:24 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: tzimmermann@suse.de, David Airlie <airlied@linux.ie>,
 open list <linux-kernel@vger.kernel.org>, Huang Rui <ray.huang@amd.com>,
 Gerd Hoffmann <kraxel@redhat.com>, Christian Koenig <christian.koenig@amd.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVuYW1lIHRoZSBlbWJlZGRlZCBzdHJ1Y3Qgdm1hX29mZnNldF9tYW5hZ2VyLCBpdCBpcyBuYW1l
ZCBfdm1hX21hbmFnZXIKbm93LiAgdHRtX2JvX2RldmljZS52bWFfbWFuYWdlciBpcyBhIHBvaW50
ZXIgbm93LCBwb2ludGluZyB0byB0aGUKZW1iZWRkZWQgdHRtX2JvX2RldmljZS5fdm1hX21hbmFn
ZXIgYnkgZGVmYXVsdC4KCkFkZCB0dG1fYm9fZGV2aWNlX2luaXRfd2l0aF92bWFfbWFuYWdlcigp
IGZ1bmN0aW9uIHdoaWNoIGFsbG93cyB0bwppbml0aWFsaXplIHR0bSB3aXRoIGEgZGlmZmVyZW50
IHZtYSBtYW5hZ2VyLgoKU2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhh
dC5jb20+Ci0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCB8IDExICsrKysrKysr
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jICAgIHwgMjkgKysrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMgfCAgNiArKyst
LS0KIDMgZmlsZXMgY2hhbmdlZCwgMzMgaW5zZXJ0aW9ucygrKSwgMTMgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCBiL2luY2x1ZGUvZHJt
L3R0bS90dG1fYm9fZHJpdmVyLmgKaW5kZXggM2YxOTM1YzE5YTY2Li4yZjg0ZDZiY2QxYTcgMTAw
NjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKKysrIGIvaW5jbHVkZS9k
cm0vdHRtL3R0bV9ib19kcml2ZXIuaApAQCAtNDQxLDcgKzQ0MSw4IEBAIGV4dGVybiBzdHJ1Y3Qg
dHRtX2JvX2dsb2JhbCB7CiAgKgogICogQGRyaXZlcjogUG9pbnRlciB0byBhIHN0cnVjdCB0dG1f
Ym9fZHJpdmVyIHN0cnVjdCBzZXR1cCBieSB0aGUgZHJpdmVyLgogICogQG1hbjogQW4gYXJyYXkg
b2YgbWVtX3R5cGVfbWFuYWdlcnMuCi0gKiBAdm1hX21hbmFnZXI6IEFkZHJlc3Mgc3BhY2UgbWFu
YWdlcgorICogQHZtYV9tYW5hZ2VyOiBBZGRyZXNzIHNwYWNlIG1hbmFnZXIgKHBvaW50ZXIpCisg
KiBAX3ZtYV9tYW5hZ2VyOiBBZGRyZXNzIHNwYWNlIG1hbmFnZXIgKGVuYmVkZGVkKQogICogbHJ1
X2xvY2s6IFNwaW5sb2NrIHRoYXQgcHJvdGVjdHMgdGhlIGJ1ZmZlcitkZXZpY2UgbHJ1IGxpc3Rz
IGFuZAogICogZGRlc3Ryb3kgbGlzdHMuCiAgKiBAZGV2X21hcHBpbmc6IEEgcG9pbnRlciB0byB0
aGUgc3RydWN0IGFkZHJlc3Nfc3BhY2UgcmVwcmVzZW50aW5nIHRoZQpAQCAtNDY0LDcgKzQ2NSw4
IEBAIHN0cnVjdCB0dG1fYm9fZGV2aWNlIHsKIAkvKgogCSAqIFByb3RlY3RlZCBieSBpbnRlcm5h
bCBsb2Nrcy4KIAkgKi8KLQlzdHJ1Y3QgZHJtX3ZtYV9vZmZzZXRfbWFuYWdlciB2bWFfbWFuYWdl
cjsKKwlzdHJ1Y3QgZHJtX3ZtYV9vZmZzZXRfbWFuYWdlciAqdm1hX21hbmFnZXI7CisJc3RydWN0
IGRybV92bWFfb2Zmc2V0X21hbmFnZXIgX3ZtYV9tYW5hZ2VyOwogCiAJLyoKIAkgKiBQcm90ZWN0
ZWQgYnkgdGhlIGdsb2JhbDpscnUgbG9jay4KQEAgLTU5Nyw2ICs1OTksMTEgQEAgaW50IHR0bV9i
b19kZXZpY2VfaW5pdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJICAgICAgIHN0cnVj
dCB0dG1fYm9fZHJpdmVyICpkcml2ZXIsCiAJCSAgICAgICBzdHJ1Y3QgYWRkcmVzc19zcGFjZSAq
bWFwcGluZywKIAkJICAgICAgIGJvb2wgbmVlZF9kbWEzMik7CitpbnQgdHRtX2JvX2RldmljZV9p
bml0X3dpdGhfdm1hX21hbmFnZXIoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCisJCQkJCXN0
cnVjdCB0dG1fYm9fZHJpdmVyICpkcml2ZXIsCisJCQkJCXN0cnVjdCBhZGRyZXNzX3NwYWNlICpt
YXBwaW5nLAorCQkJCQlzdHJ1Y3QgZHJtX3ZtYV9vZmZzZXRfbWFuYWdlciAqdm1hX21hbmFnZXIs
CisJCQkJCWJvb2wgbmVlZF9kbWEzMik7CiAKIC8qKgogICogdHRtX2JvX3VubWFwX3ZpcnR1YWwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9k
cm0vdHRtL3R0bV9iby5jCmluZGV4IDEwYTg2MWExNjkwYy4uMGVkMWExMTgyOTYyIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2JvLmMKQEAgLTY3Miw3ICs2NzIsNyBAQCBzdGF0aWMgdm9pZCB0dG1fYm9fcmVsZWFz
ZShzdHJ1Y3Qga3JlZiAqa3JlZikKIAlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9IGJvLT5i
ZGV2OwogCXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuID0gJmJkZXYtPm1hbltiby0+
bWVtLm1lbV90eXBlXTsKIAotCWRybV92bWFfb2Zmc2V0X3JlbW92ZSgmYmRldi0+dm1hX21hbmFn
ZXIsICZiby0+YmFzZS52bWFfbm9kZSk7CisJZHJtX3ZtYV9vZmZzZXRfcmVtb3ZlKGJkZXYtPnZt
YV9tYW5hZ2VyLCAmYm8tPmJhc2Uudm1hX25vZGUpOwogCXR0bV9tZW1faW9fbG9jayhtYW4sIGZh
bHNlKTsKIAl0dG1fbWVtX2lvX2ZyZWVfdm0oYm8pOwogCXR0bV9tZW1faW9fdW5sb2NrKG1hbik7
CkBAIC0xMzUzLDcgKzEzNTMsNyBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0
bV9ib19kZXZpY2UgKmJkZXYsCiAJICovCiAJaWYgKGJvLT50eXBlID09IHR0bV9ib190eXBlX2Rl
dmljZSB8fAogCSAgICBiby0+dHlwZSA9PSB0dG1fYm9fdHlwZV9zZykKLQkJcmV0ID0gZHJtX3Zt
YV9vZmZzZXRfYWRkKCZiZGV2LT52bWFfbWFuYWdlciwgJmJvLT5iYXNlLnZtYV9ub2RlLAorCQly
ZXQgPSBkcm1fdm1hX29mZnNldF9hZGQoYmRldi0+dm1hX21hbmFnZXIsICZiby0+YmFzZS52bWFf
bm9kZSwKIAkJCQkJIGJvLT5tZW0ubnVtX3BhZ2VzKTsKIAogCS8qIHBhc3NlZCByZXNlcnZhdGlv
biBvYmplY3RzIHNob3VsZCBhbHJlYWR5IGJlIGxvY2tlZCwKQEAgLTE3MDQsNyArMTcwNCw3IEBA
IGludCB0dG1fYm9fZGV2aWNlX3JlbGVhc2Uoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYpCiAJ
CQlwcl9kZWJ1ZygiU3dhcCBsaXN0ICVkIHdhcyBjbGVhblxuIiwgaSk7CiAJc3Bpbl91bmxvY2so
Jmdsb2ItPmxydV9sb2NrKTsKIAotCWRybV92bWFfb2Zmc2V0X21hbmFnZXJfZGVzdHJveSgmYmRl
di0+dm1hX21hbmFnZXIpOworCWRybV92bWFfb2Zmc2V0X21hbmFnZXJfZGVzdHJveSgmYmRldi0+
X3ZtYV9tYW5hZ2VyKTsKIAogCWlmICghcmV0KQogCQl0dG1fYm9fZ2xvYmFsX3JlbGVhc2UoKTsK
QEAgLTE3MTMsMTAgKzE3MTMsMTEgQEAgaW50IHR0bV9ib19kZXZpY2VfcmVsZWFzZShzdHJ1Y3Qg
dHRtX2JvX2RldmljZSAqYmRldikKIH0KIEVYUE9SVF9TWU1CT0wodHRtX2JvX2RldmljZV9yZWxl
YXNlKTsKIAotaW50IHR0bV9ib19kZXZpY2VfaW5pdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRl
diwKLQkJICAgICAgIHN0cnVjdCB0dG1fYm9fZHJpdmVyICpkcml2ZXIsCi0JCSAgICAgICBzdHJ1
Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZywKLQkJICAgICAgIGJvb2wgbmVlZF9kbWEzMikKK2lu
dCB0dG1fYm9fZGV2aWNlX2luaXRfd2l0aF92bWFfbWFuYWdlcihzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiwKKwkJCQkJc3RydWN0IHR0bV9ib19kcml2ZXIgKmRyaXZlciwKKwkJCQkJc3RydWN0
IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcsCisJCQkJCXN0cnVjdCBkcm1fdm1hX29mZnNldF9tYW5h
Z2VyICp2bWFfbWFuYWdlciwKKwkJCQkJYm9vbCBuZWVkX2RtYTMyKQogewogCXN0cnVjdCB0dG1f
Ym9fZ2xvYmFsICpnbG9iID0gJnR0bV9ib19nbG9iOwogCWludCByZXQ7CkBAIC0xNzM3LDcgKzE3
MzgsOCBAQCBpbnQgdHRtX2JvX2RldmljZV9pbml0KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2
LAogCWlmICh1bmxpa2VseShyZXQgIT0gMCkpCiAJCWdvdG8gb3V0X25vX3N5czsKIAotCWRybV92
bWFfb2Zmc2V0X21hbmFnZXJfaW5pdCgmYmRldi0+dm1hX21hbmFnZXIsCisJYmRldi0+dm1hX21h
bmFnZXIgPSB2bWFfbWFuYWdlcjsKKwlkcm1fdm1hX29mZnNldF9tYW5hZ2VyX2luaXQoJmJkZXYt
Pl92bWFfbWFuYWdlciwKIAkJCQkgICAgRFJNX0ZJTEVfUEFHRV9PRkZTRVRfU1RBUlQsCiAJCQkJ
ICAgIERSTV9GSUxFX1BBR0VfT0ZGU0VUX1NJWkUpOwogCUlOSVRfREVMQVlFRF9XT1JLKCZiZGV2
LT53cSwgdHRtX2JvX2RlbGF5ZWRfd29ya3F1ZXVlKTsKQEAgLTE3NTQsNiArMTc1NiwxNyBAQCBp
bnQgdHRtX2JvX2RldmljZV9pbml0KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCXR0bV9i
b19nbG9iYWxfcmVsZWFzZSgpOwogCXJldHVybiByZXQ7CiB9CitFWFBPUlRfU1lNQk9MKHR0bV9i
b19kZXZpY2VfaW5pdF93aXRoX3ZtYV9tYW5hZ2VyKTsKKworaW50IHR0bV9ib19kZXZpY2VfaW5p
dChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKKwkJICAgICAgIHN0cnVjdCB0dG1fYm9fZHJp
dmVyICpkcml2ZXIsCisJCSAgICAgICBzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZywKKwkJ
ICAgICAgIGJvb2wgbmVlZF9kbWEzMikKK3sKKwlyZXR1cm4gdHRtX2JvX2RldmljZV9pbml0X3dp
dGhfdm1hX21hbmFnZXIoYmRldiwgZHJpdmVyLCBtYXBwaW5nLAorCQkJCQkJICAgJmJkZXYtPl92
bWFfbWFuYWdlciwKKwkJCQkJCSAgIG5lZWRfZG1hMzIpOworfQogRVhQT1JUX1NZTUJPTCh0dG1f
Ym9fZGV2aWNlX2luaXQpOwogCiAvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fYm9fdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKaW5kZXggODVmNWJj
YmUwYzc2Li5kNGVlY2RlOGQwNTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRt
X2JvX3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwpAQCAtNDA5LDE2
ICs0MDksMTYgQEAgc3RhdGljIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqdHRtX2JvX3ZtX2xv
b2t1cChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAlzdHJ1Y3QgZHJtX3ZtYV9vZmZzZXRf
bm9kZSAqbm9kZTsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gTlVMTDsKIAotCWRy
bV92bWFfb2Zmc2V0X2xvY2tfbG9va3VwKCZiZGV2LT52bWFfbWFuYWdlcik7CisJZHJtX3ZtYV9v
ZmZzZXRfbG9ja19sb29rdXAoYmRldi0+dm1hX21hbmFnZXIpOwogCi0Jbm9kZSA9IGRybV92bWFf
b2Zmc2V0X2xvb2t1cF9sb2NrZWQoJmJkZXYtPnZtYV9tYW5hZ2VyLCBvZmZzZXQsIHBhZ2VzKTsK
Kwlub2RlID0gZHJtX3ZtYV9vZmZzZXRfbG9va3VwX2xvY2tlZChiZGV2LT52bWFfbWFuYWdlciwg
b2Zmc2V0LCBwYWdlcyk7CiAJaWYgKGxpa2VseShub2RlKSkgewogCQlibyA9IGNvbnRhaW5lcl9v
Zihub2RlLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QsCiAJCQkJICBiYXNlLnZtYV9ub2RlKTsK
IAkJYm8gPSB0dG1fYm9fZ2V0X3VubGVzc196ZXJvKGJvKTsKIAl9CiAKLQlkcm1fdm1hX29mZnNl
dF91bmxvY2tfbG9va3VwKCZiZGV2LT52bWFfbWFuYWdlcik7CisJZHJtX3ZtYV9vZmZzZXRfdW5s
b2NrX2xvb2t1cChiZGV2LT52bWFfbWFuYWdlcik7CiAKIAlpZiAoIWJvKQogCQlwcl9lcnIoIkNv
dWxkIG5vdCBmaW5kIGJ1ZmZlciBvYmplY3QgdG8gbWFwXG4iKTsKLS0gCjIuMTguMQoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
