Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 633D697977
	for <lists+dri-devel@lfdr.de>; Wed, 21 Aug 2019 14:32:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 559D16E32C;
	Wed, 21 Aug 2019 12:32:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D95CC6E316
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Aug 2019 12:32:00 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id p17so1844294wrf.11
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Aug 2019 05:32:00 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=N0zzGM8v41eOHCbSQA8yKPg6o6HCQG8GTTvuJGvyuNA=;
 b=eFlOACFKbd+B9pFjlJzGR1RM9KGIxZXzFEvrrxFFel1x/cnwHuH2CMcytGVa71Q9uP
 pq8PTfCgtUTEWVynmZUjxASwC4zeb3DPtUK4OVFWV0awbjwPX1544UGZ2mQ3lgE1ChR4
 ie/pLHR9IPoRAC37ib6NX36uRhcWivqGFrMgGuo4WGLgjd9guiON38mCDaewVMHMygHq
 3hyfFIAJKvg7LaCrW9eEhbutClG90eLKuojlnbTijos5PhSFN/c7xAWJ874hbaLYyrQk
 rIl6tOcDABpb501djZ/mSkBs5EyO004l7/ZO0TN+QP347pNXal654AiCk4wExE41yIkS
 SBrA==
X-Gm-Message-State: APjAAAX8qHpHc7//eyyQiPj7aFeDUgPIa7jfO3BxD+F/F6z40ALu0c0u
 ZMKnstQa7XxcKk7Sgh+Kil+d1hr8
X-Google-Smtp-Source: APXvYqzmkCAwGIBNgpbuCvJkvFytPCJ2vvIyrxQD7icPKfBoLCfVC45NP410xThlSUQgiRtiTBsEXg==
X-Received: by 2002:adf:dfc4:: with SMTP id q4mr39569519wrn.54.1566390717935; 
 Wed, 21 Aug 2019 05:31:57 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:8189:dd33:a934:c4fa])
 by smtp.gmail.com with ESMTPSA id v3sm23084571wrq.34.2019.08.21.05.31.55
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 21 Aug 2019 05:31:56 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, chris@chris-wilson.co.uk,
 daniel.vetter@ffwll.ch, sumit.semwal@linaro.org,
 linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org
Subject: [PATCH 08/10] dma-buf/resv: replace shared fence with new fences
 container
Date: Wed, 21 Aug 2019 14:31:45 +0200
Message-Id: <20190821123147.110736-9-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190821123147.110736-1-christian.koenig@amd.com>
References: <20190821123147.110736-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=N0zzGM8v41eOHCbSQA8yKPg6o6HCQG8GTTvuJGvyuNA=;
 b=Is2rjH57MI4MTGXhmRnV7kfPnbgvir3xwEDz6Fk+zcA5fc11pdP7ju+1E7Mp5H4z7W
 2jplSUT8ZERwkPJjUtuxXVFCkWgS88pvo3B0qBLn+3rB5qJ5oMP8GKQC2aWAgkOvaCGD
 xGklYntaeINd7UtgoOC1NUtxqSommc+INoHXNgKqv+ORPea9mIT29+TjTiU5RgqrTkzg
 JNiFkzlKarTEyP8huyVBM7q+/7TCCn3sEKHQOwt8fzfh6wBhBPDf49NHpucOTR2GnWVs
 0xP7JM042E83Wqhnmrb23KtpZCEks1l+8n19235sKX2k8h913X1n8gP01yNA8IqLx0Mo
 j7rQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgb2xkIHNoYXJlZCBmZW5jZXMgd2l0aCB0aGUgbmV3IHJlYWRlcnMgY29udGFp
bmVyCmFuZCBjaGFuZ2UgYWxsIGNhbGxlcnMgYWNjb3JkaW5nbHkuCgpTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9k
bWEtYnVmL2RtYS1idWYuYyAgICAgICAgICAgICAgICAgICAgIHwgIDk5ICstLS0KIGRyaXZlcnMv
ZG1hLWJ1Zi9kbWEtcmVzdi5jICAgICAgICAgICAgICAgICAgICB8IDUyNCArKystLS0tLS0tLS0t
LS0tLS0KIC4uLi9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jICB8ICA1
OCArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyAgIHwgIDM3
ICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCAgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgICAgICB8ICAxNyAr
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAgICAgIHwgIDE5ICst
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYyAgICAgICAgfCAgIDMgKy0K
IGRyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtLmMgICAgICAgICB8ICAxOCArLQog
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMgIHwgICA2ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVzeS5jICAgICAgfCAgMjAgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYyAgICB8ICAgMiArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgICA0ICstCiBkcml2
ZXJzL2dwdS9kcm0vbGltYS9saW1hX2dlbS5jICAgICAgICAgICAgICAgfCAgIDQgKy0KIGRyaXZl
cnMvZ3B1L2RybS9tc20vbXNtX2dlbS5jICAgICAgICAgICAgICAgICB8ICAxNCArLQogZHJpdmVy
cy9ncHUvZHJtL21zbS9tc21fZ2VtX3N1Ym1pdC5jICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYyAgICAgICB8ICAxOSArLQogZHJpdmVycy9n
cHUvZHJtL3F4bC9xeGxfZGVidWdmcy5jICAgICAgICAgICAgIHwgIDExICstCiBkcml2ZXJzL2dw
dS9kcm0vcXhsL3F4bF9yZWxlYXNlLmMgICAgICAgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1
L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUv
ZHJtL3JhZGVvbi9yYWRlb25fc3luYy5jICAgICAgICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9k
cm0vcmFkZW9uL3JhZGVvbl92bS5jICAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvLmMgICAgICAgICAgICAgICAgICB8ICAyMiArLQogZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fZXhlY2J1Zl91dGlsLmMgICAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0v
dmM0L3ZjNF9nZW0uYyAgICAgICAgICAgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS92
Z2VtL3ZnZW1fZmVuY2UuYyAgICAgICAgICAgICB8ICAgNCArLQogaW5jbHVkZS9saW51eC9kbWEt
cmVzdi5oICAgICAgICAgICAgICAgICAgICAgIHwgIDQyICstCiAyOCBmaWxlcyBjaGFuZ2VkLCAy
MjQgaW5zZXJ0aW9ucygrKSwgNzQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
ZG1hLWJ1Zi9kbWEtYnVmLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1Zi5jCmluZGV4IDQzM2Q5
MWQ3MTBlNC4uMjIwY2ZhOWNhODJiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1hLWJ1
Zi5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtYnVmLmMKQEAgLTE1LDYgKzE1LDcgQEAKICNp
bmNsdWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgogI2luY2x1
ZGUgPGxpbnV4L2RtYS1mZW5jZS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJheS5o
PgogI2luY2x1ZGUgPGxpbnV4L2Fub25faW5vZGVzLmg+CiAjaW5jbHVkZSA8bGludXgvZXhwb3J0
Lmg+CiAjaW5jbHVkZSA8bGludXgvZGVidWdmcy5oPgpAQCAtMTk0LDEyICsxOTUsMTAgQEAgc3Rh
dGljIHZvaWQgZG1hX2J1Zl9wb2xsX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NiICpjYikKIAogc3RhdGljIF9fcG9sbF90IGRtYV9idWZfcG9sbChzdHJ1Y3Qg
ZmlsZSAqZmlsZSwgcG9sbF90YWJsZSAqcG9sbCkKIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZV9leGNsLCAqcmVhZGVyczsKIAlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmOwogCXN0cnVjdCBkbWFf
cmVzdiAqcmVzdjsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqZm9iajsKLQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZV9leGNsOwogCV9fcG9sbF90IGV2ZW50czsKLQl1bnNpZ25lZCBzaGFyZWRfY291
bnQsIHNlcTsKIAogCWRtYWJ1ZiA9IGZpbGUtPnByaXZhdGVfZGF0YTsKIAlpZiAoIWRtYWJ1ZiB8
fCAhZG1hYnVmLT5yZXN2KQpAQCAtMjEzLDI2ICsyMTIsMTUgQEAgc3RhdGljIF9fcG9sbF90IGRt
YV9idWZfcG9sbChzdHJ1Y3QgZmlsZSAqZmlsZSwgcG9sbF90YWJsZSAqcG9sbCkKIAlpZiAoIWV2
ZW50cykKIAkJcmV0dXJuIDA7CiAKLXJldHJ5OgotCXNlcSA9IHJlYWRfc2VxY291bnRfYmVnaW4o
JnJlc3YtPnNlcSk7CiAJcmN1X3JlYWRfbG9jaygpOworCWZlbmNlX2V4Y2wgPSBkbWFfZmVuY2Vf
Z2V0X3JjdV9zYWZlKCZyZXN2LT5mZW5jZV9leGNsKTsKKwlyZWFkZXJzID0gZG1hX3Jlc3ZfZmVu
Y2VzX2dldF9yY3UoJnJlc3YtPnJlYWRlcnMpOwogCi0JZm9iaiA9IHJjdV9kZXJlZmVyZW5jZShy
ZXN2LT5mZW5jZSk7Ci0JaWYgKGZvYmopCi0JCXNoYXJlZF9jb3VudCA9IGZvYmotPnNoYXJlZF9j
b3VudDsKLQllbHNlCi0JCXNoYXJlZF9jb3VudCA9IDA7Ci0JZmVuY2VfZXhjbCA9IHJjdV9kZXJl
ZmVyZW5jZShyZXN2LT5mZW5jZV9leGNsKTsKLQlpZiAocmVhZF9zZXFjb3VudF9yZXRyeSgmcmVz
di0+c2VxLCBzZXEpKSB7Ci0JCXJjdV9yZWFkX3VubG9jaygpOwotCQlnb3RvIHJldHJ5OwotCX0K
LQotCWlmIChmZW5jZV9leGNsICYmICghKGV2ZW50cyAmIEVQT0xMT1VUKSB8fCBzaGFyZWRfY291
bnQgPT0gMCkpIHsKKwlpZiAoZmVuY2VfZXhjbCAmJiAoIShldmVudHMgJiBFUE9MTE9VVCkgfHwg
IXJlYWRlcnMpKSB7CiAJCXN0cnVjdCBkbWFfYnVmX3BvbGxfY2JfdCAqZGNiID0gJmRtYWJ1Zi0+
Y2JfZXhjbDsKIAkJX19wb2xsX3QgcGV2ZW50cyA9IEVQT0xMSU47CiAKLQkJaWYgKHNoYXJlZF9j
b3VudCA9PSAwKQorCQlpZiAoIXJlYWRlcnMpCiAJCQlwZXZlbnRzIHw9IEVQT0xMT1VUOwogCiAJ
CXNwaW5fbG9ja19pcnEoJmRtYWJ1Zi0+cG9sbC5sb2NrKTsKQEAgLTI0NCwxMiArMjMyLDggQEAg
c3RhdGljIF9fcG9sbF90IGRtYV9idWZfcG9sbChzdHJ1Y3QgZmlsZSAqZmlsZSwgcG9sbF90YWJs
ZSAqcG9sbCkKIAkJc3Bpbl91bmxvY2tfaXJxKCZkbWFidWYtPnBvbGwubG9jayk7CiAKIAkJaWYg
KGV2ZW50cyAmIHBldmVudHMpIHsKLQkJCWlmICghZG1hX2ZlbmNlX2dldF9yY3UoZmVuY2VfZXhj
bCkpIHsKLQkJCQkvKiBmb3JjZSBhIHJlY2hlY2sgKi8KLQkJCQlldmVudHMgJj0gfnBldmVudHM7
Ci0JCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2ItPmNiKTsKLQkJCX0gZWxzZSBpZiAoIWRt
YV9mZW5jZV9hZGRfY2FsbGJhY2soZmVuY2VfZXhjbCwgJmRjYi0+Y2IsCi0JCQkJCQkJICAgZG1h
X2J1Zl9wb2xsX2NiKSkgeworCQkJaWYgKCFkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGZlbmNlX2V4
Y2wsICZkY2ItPmNiLAorCQkJCQkJICAgIGRtYV9idWZfcG9sbF9jYikpIHsKIAkJCQlldmVudHMg
Jj0gfnBldmVudHM7CiAJCQkJZG1hX2ZlbmNlX3B1dChmZW5jZV9leGNsKTsKIAkJCX0gZWxzZSB7
CkBAIC0yNjMsOSArMjQ3LDggQEAgc3RhdGljIF9fcG9sbF90IGRtYV9idWZfcG9sbChzdHJ1Y3Qg
ZmlsZSAqZmlsZSwgcG9sbF90YWJsZSAqcG9sbCkKIAkJfQogCX0KIAotCWlmICgoZXZlbnRzICYg
RVBPTExPVVQpICYmIHNoYXJlZF9jb3VudCA+IDApIHsKKwlpZiAoKGV2ZW50cyAmIEVQT0xMT1VU
KSAmJiByZWFkZXJzKSB7CiAJCXN0cnVjdCBkbWFfYnVmX3BvbGxfY2JfdCAqZGNiID0gJmRtYWJ1
Zi0+Y2Jfc2hhcmVkOwotCQlpbnQgaTsKIAogCQkvKiBPbmx5IHF1ZXVlIGEgbmV3IGNhbGxiYWNr
IGlmIG5vIGV2ZW50IGhhcyBmaXJlZCB5ZXQgKi8KIAkJc3Bpbl9sb2NrX2lycSgmZG1hYnVmLT5w
b2xsLmxvY2spOwpAQCAtMjc4LDMyICsyNjEsMTUgQEAgc3RhdGljIF9fcG9sbF90IGRtYV9idWZf
cG9sbChzdHJ1Y3QgZmlsZSAqZmlsZSwgcG9sbF90YWJsZSAqcG9sbCkKIAkJaWYgKCEoZXZlbnRz
ICYgRVBPTExPVVQpKQogCQkJZ290byBvdXQ7CiAKLQkJZm9yIChpID0gMDsgaSA8IHNoYXJlZF9j
b3VudDsgKytpKSB7Ci0JCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9IHJjdV9kZXJlZmVyZW5j
ZShmb2JqLT5zaGFyZWRbaV0pOwotCi0JCQlpZiAoIWRtYV9mZW5jZV9nZXRfcmN1KGZlbmNlKSkg
ewotCQkJCS8qCi0JCQkJICogZmVuY2UgcmVmY291bnQgZHJvcHBlZCB0byB6ZXJvLCB0aGlzIG1l
YW5zCi0JCQkJICogdGhhdCBmb2JqIGhhcyBiZWVuIGZyZWVkCi0JCQkJICoKLQkJCQkgKiBjYWxs
IGRtYV9idWZfcG9sbF9jYiBhbmQgZm9yY2UgYSByZWNoZWNrIQotCQkJCSAqLwotCQkJCWV2ZW50
cyAmPSB+RVBPTExPVVQ7Ci0JCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2ItPmNiKTsKLQkJ
CQlicmVhazsKLQkJCX0KLQkJCWlmICghZG1hX2ZlbmNlX2FkZF9jYWxsYmFjayhmZW5jZSwgJmRj
Yi0+Y2IsCi0JCQkJCQkgICAgZG1hX2J1Zl9wb2xsX2NiKSkgewotCQkJCWRtYV9mZW5jZV9wdXQo
ZmVuY2UpOwotCQkJCWV2ZW50cyAmPSB+RVBPTExPVVQ7Ci0JCQkJYnJlYWs7Ci0JCQl9Ci0JCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKLQkJfQotCi0JCS8qIE5vIGNhbGxiYWNrIHF1ZXVlZCwgd2Fr
ZSB1cCBhbnkgYWRkaXRpb25hbCB3YWl0ZXJzLiAqLwotCQlpZiAoaSA9PSBzaGFyZWRfY291bnQp
CisJCWlmICghZG1hX2ZlbmNlX2FkZF9jYWxsYmFjayhyZWFkZXJzLCAmZGNiLT5jYiwKKwkJCQkJ
ICAgIGRtYV9idWZfcG9sbF9jYikpIHsKKwkJCWRtYV9mZW5jZV9wdXQocmVhZGVycyk7CisJCQll
dmVudHMgJj0gfkVQT0xMT1VUOworCQl9IGVsc2UgeworCQkJLyogTm8gY2FsbGJhY2sgcXVldWVk
LCB3YWtlIHVwIGFueSBhZGRpdGlvbmFsIHdhaXRlcnMuICovCisJCQlkbWFfZmVuY2VfcHV0KHJl
YWRlcnMpOwogCQkJZG1hX2J1Zl9wb2xsX2NiKE5VTEwsICZkY2ItPmNiKTsKKwkJfQogCX0KIAog
b3V0OgpAQCAtMTE1NCwxMSArMTEyMCwxMCBAQCBzdGF0aWMgaW50IGRtYV9idWZfZGVidWdfc2hv
dyhzdHJ1Y3Qgc2VxX2ZpbGUgKnMsIHZvaWQgKnVudXNlZCkKIAlpbnQgcmV0OwogCXN0cnVjdCBk
bWFfYnVmICpidWZfb2JqOwogCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaF9vYmo7
CisJc3RydWN0IGRtYV9mZW5jZV9hcnJheV9jdXJzb3IgY3Vyc29yOwogCXN0cnVjdCBkbWFfcmVz
diAqcm9iajsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqZm9iajsKLQlzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZTsKLQl1bnNpZ25lZCBzZXE7Ci0JaW50IGNvdW50ID0gMCwgYXR0YWNoX2NvdW50LCBz
aGFyZWRfY291bnQsIGk7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsICpyZWFkZXJzOworCWlu
dCBjb3VudCA9IDAsIGF0dGFjaF9jb3VudDsKIAlzaXplX3Qgc2l6ZSA9IDA7CiAKIAlyZXQgPSBt
dXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRiX2xpc3QubG9jayk7CkBAIC0xMTg4LDMyICsxMTUz
LDIwIEBAIHN0YXRpYyBpbnQgZG1hX2J1Zl9kZWJ1Z19zaG93KHN0cnVjdCBzZXFfZmlsZSAqcywg
dm9pZCAqdW51c2VkKQogCQkJCWJ1Zl9vYmotPm5hbWUgPzogIiIpOwogCiAJCXJvYmogPSBidWZf
b2JqLT5yZXN2OwotCQl3aGlsZSAodHJ1ZSkgewotCQkJc2VxID0gcmVhZF9zZXFjb3VudF9iZWdp
bigmcm9iai0+c2VxKTsKLQkJCXJjdV9yZWFkX2xvY2soKTsKLQkJCWZvYmogPSByY3VfZGVyZWZl
cmVuY2Uocm9iai0+ZmVuY2UpOwotCQkJc2hhcmVkX2NvdW50ID0gZm9iaiA/IGZvYmotPnNoYXJl
ZF9jb3VudCA6IDA7Ci0JCQlmZW5jZSA9IHJjdV9kZXJlZmVyZW5jZShyb2JqLT5mZW5jZV9leGNs
KTsKLQkJCWlmICghcmVhZF9zZXFjb3VudF9yZXRyeSgmcm9iai0+c2VxLCBzZXEpKQotCQkJCWJy
ZWFrOwotCQkJcmN1X3JlYWRfdW5sb2NrKCk7Ci0JCX0KLQorCQlyY3VfcmVhZF9sb2NrKCk7CisJ
CWZlbmNlID0gZG1hX3Jlc3ZfZ2V0X2V4Y2wocm9iaik7CisJCXJlYWRlcnMgPSBkbWFfcmVzdl9m
ZW5jZXNfZ2V0X3JjdSgmcm9iai0+cmVhZGVycyk7CiAJCWlmIChmZW5jZSkKIAkJCXNlcV9wcmlu
dGYocywgIlx0RXhjbHVzaXZlIGZlbmNlOiAlcyAlcyAlc3NpZ25hbGxlZFxuIiwKIAkJCQkgICBm
ZW5jZS0+b3BzLT5nZXRfZHJpdmVyX25hbWUoZmVuY2UpLAogCQkJCSAgIGZlbmNlLT5vcHMtPmdl
dF90aW1lbGluZV9uYW1lKGZlbmNlKSwKIAkJCQkgICBkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZmVu
Y2UpID8gIiIgOiAidW4iKTsKLQkJZm9yIChpID0gMDsgaSA8IHNoYXJlZF9jb3VudDsgaSsrKSB7
Ci0JCQlmZW5jZSA9IHJjdV9kZXJlZmVyZW5jZShmb2JqLT5zaGFyZWRbaV0pOwotCQkJaWYgKCFk
bWFfZmVuY2VfZ2V0X3JjdShmZW5jZSkpCi0JCQkJY29udGludWU7Ci0JCQlzZXFfcHJpbnRmKHMs
ICJcdFNoYXJlZCBmZW5jZTogJXMgJXMgJXNzaWduYWxsZWRcbiIsCisJCWRtYV9mZW5jZV9hcnJh
eV9mb3JfZWFjaChmZW5jZSwgY3Vyc29yLCByZWFkZXJzKQorCQkJc2VxX3ByaW50ZihzLCAiXHRS
ZWFkZXJzIGZlbmNlOiAlcyAlcyAlc3NpZ25hbGxlZFxuIiwKIAkJCQkgICBmZW5jZS0+b3BzLT5n
ZXRfZHJpdmVyX25hbWUoZmVuY2UpLAogCQkJCSAgIGZlbmNlLT5vcHMtPmdldF90aW1lbGluZV9u
YW1lKGZlbmNlKSwKIAkJCQkgICBkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZmVuY2UpID8gIiIgOiAi
dW4iKTsKLQkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQl9CisJCWRtYV9mZW5jZV9wdXQocmVh
ZGVycyk7CiAJCXJjdV9yZWFkX3VubG9jaygpOwogCiAJCXNlcV9wdXRzKHMsICJcdEF0dGFjaGVk
IERldmljZXM6XG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jIGIv
ZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMKaW5kZXggODMwMzNiM2U4NTIxLi44NzIzYWYwYTdh
NGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVzdi5jCisrKyBiL2RyaXZlcnMv
ZG1hLWJ1Zi9kbWEtcmVzdi5jCkBAIC0zOSwxMiArMzksMTEgQEAKIC8qKgogICogRE9DOiBSZXNl
cnZhdGlvbiBPYmplY3QgT3ZlcnZpZXcKICAqCi0gKiBUaGUgcmVzZXJ2YXRpb24gb2JqZWN0IHBy
b3ZpZGVzIGEgbWVjaGFuaXNtIHRvIG1hbmFnZSBzaGFyZWQgYW5kCisgKiBUaGUgcmVzZXJ2YXRp
b24gb2JqZWN0IHByb3ZpZGVzIGEgbWVjaGFuaXNtIHRvIG1hbmFnZSByZWFkZXJzIGFuZAogICog
ZXhjbHVzaXZlIGZlbmNlcyBhc3NvY2lhdGVkIHdpdGggYSBidWZmZXIuICBBIHJlc2VydmF0aW9u
IG9iamVjdAogICogY2FuIGhhdmUgYXR0YWNoZWQgb25lIGV4Y2x1c2l2ZSBmZW5jZSAobm9ybWFs
bHkgYXNzb2NpYXRlZCB3aXRoCi0gKiB3cml0ZSBvcGVyYXRpb25zKSBvciBOIHNoYXJlZCBmZW5j
ZXMgKHJlYWQgb3BlcmF0aW9ucykuICBUaGUgUkNVCi0gKiBtZWNoYW5pc20gaXMgdXNlZCB0byBw
cm90ZWN0IHJlYWQgYWNjZXNzIHRvIGZlbmNlcyBmcm9tIGxvY2tlZAotICogd3JpdGUtc2lkZSB1
cGRhdGVzLgorICogd3JpdGUgb3BlcmF0aW9ucykgb3IgTiByZWFkIGZlbmNlcy4gIFRoZSBSQ1Ug
bWVjaGFuaXNtIGlzIHVzZWQgdG8KKyAqIHByb3RlY3QgcmVhZCBhY2Nlc3MgdG8gZmVuY2VzIGZy
b20gbG9ja2VkIHdyaXRlLXNpZGUgdXBkYXRlcy4KICAqLwogCiBERUZJTkVfV0RfQ0xBU1MocmVz
ZXJ2YXRpb25fd3dfY2xhc3MpOwpAQCAtMjM1LDE3ICsyMzQsMTggQEAgdm9pZCBkbWFfcmVzdl9m
ZW5jZXNfYWRkKHN0cnVjdCBkbWFfcmVzdl9mZW5jZXMgKmZlbmNlcywKIAlzdHJ1Y3QgZG1hX2Zl
bmNlICpvbGQ7CiAJdW5zaWduZWQgaW50IGk7CiAKLSNpZm5kZWYgQ09ORklHX0RFQlVHX01VVEVY
RVMKIAlmb3IgKGkgPSAwOyBpIDwgc3RhZ2VkLT5udW1fZmVuY2VzOyArK2kpIHsKIAkJb2xkID0g
c3RhZ2VkLT5mZW5jZXNbaV07CiAKLQkJaWYgKG9sZC0+Y29udGV4dCA9PSBmZW5jZS0+Y29udGV4
dCB8fAotCQkgICAgZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKG9sZCkpIHsKKwkJaWYgKG9sZC0+Y29u
dGV4dCA9PSBmZW5jZS0+Y29udGV4dAorI2lmbmRlZiBDT05GSUdfREVCVUdfTVVURVhFUworCQkg
ICAgfHwgZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKG9sZCkKKyNlbmRpZgorCQkgICAgKSB7CiAJCQlk
bWFfZmVuY2VfcHV0KG9sZCk7CiAJCQlnb3RvIHJlcGxhY2U7CiAJCX0KIAl9Ci0jZW5kaWYKIAog
CUJVR19PTihzdGFnZWQtPm51bV9mZW5jZXMgPj0gZG1hX2ZlbmNlX2FycmF5X21heF9mZW5jZXMo
c3RhZ2VkKSk7CiAJaSA9IHN0YWdlZC0+bnVtX2ZlbmNlcysrOwpAQCAtMjc2LDQ2ICsyNzYsNiBA
QCB2b2lkIGRtYV9yZXN2X2ZlbmNlc19jb21taXQoc3RydWN0IGRtYV9yZXN2ICpvYmosCiB9CiBF
WFBPUlRfU1lNQk9MKGRtYV9yZXN2X2ZlbmNlc19jb21taXQpOwogCi0vKioKLSAqIGRtYV9yZXN2
X2xpc3RfYWxsb2MgLSBhbGxvY2F0ZSBmZW5jZSBsaXN0Ci0gKiBAc2hhcmVkX21heDogbnVtYmVy
IG9mIGZlbmNlcyB3ZSBuZWVkIHNwYWNlIGZvcgotICoKLSAqIEFsbG9jYXRlIGEgbmV3IGRtYV9y
ZXN2X2xpc3QgYW5kIG1ha2Ugc3VyZSB0byBjb3JyZWN0bHkgaW5pdGlhbGl6ZQotICogc2hhcmVk
X21heC4KLSAqLwotc3RhdGljIHN0cnVjdCBkbWFfcmVzdl9saXN0ICpkbWFfcmVzdl9saXN0X2Fs
bG9jKHVuc2lnbmVkIGludCBzaGFyZWRfbWF4KQotewotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICps
aXN0OwotCi0JbGlzdCA9IGttYWxsb2Mob2Zmc2V0b2YodHlwZW9mKCpsaXN0KSwgc2hhcmVkW3No
YXJlZF9tYXhdKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFsaXN0KQotCQlyZXR1cm4gTlVMTDsKLQot
CWxpc3QtPnNoYXJlZF9tYXggPSAoa3NpemUobGlzdCkgLSBvZmZzZXRvZih0eXBlb2YoKmxpc3Qp
LCBzaGFyZWQpKSAvCi0JCXNpemVvZigqbGlzdC0+c2hhcmVkKTsKLQotCXJldHVybiBsaXN0Owot
fQotCi0vKioKLSAqIGRtYV9yZXN2X2xpc3RfZnJlZSAtIGZyZWUgZmVuY2UgbGlzdAotICogQGxp
c3Q6IGxpc3QgdG8gZnJlZQotICoKLSAqIEZyZWUgYSBkbWFfcmVzdl9saXN0IGFuZCBtYWtlIHN1
cmUgdG8gZHJvcCBhbGwgcmVmZXJlbmNlcy4KLSAqLwotc3RhdGljIHZvaWQgZG1hX3Jlc3ZfbGlz
dF9mcmVlKHN0cnVjdCBkbWFfcmVzdl9saXN0ICpsaXN0KQotewotCXVuc2lnbmVkIGludCBpOwot
Ci0JaWYgKCFsaXN0KQotCQlyZXR1cm47Ci0KLQlmb3IgKGkgPSAwOyBpIDwgbGlzdC0+c2hhcmVk
X2NvdW50OyArK2kpCi0JCWRtYV9mZW5jZV9wdXQocmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChs
aXN0LT5zaGFyZWRbaV0sIHRydWUpKTsKLQotCWtmcmVlX3JjdShsaXN0LCByY3UpOwotfQotCiAv
KioKICAqIGRtYV9yZXN2X2luaXQgLSBpbml0aWFsaXplIGEgcmVzZXJ2YXRpb24gb2JqZWN0CiAg
KiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CkBAIC0zMjYsOCArMjg2LDggQEAgdm9pZCBk
bWFfcmVzdl9pbml0KHN0cnVjdCBkbWFfcmVzdiAqb2JqKQogCiAJX19zZXFjb3VudF9pbml0KCZv
YmotPnNlcSwgcmVzZXJ2YXRpb25fc2VxY291bnRfc3RyaW5nLAogCQkJJnJlc2VydmF0aW9uX3Nl
cWNvdW50X2NsYXNzKTsKLQlSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVuY2UsIE5VTEwpOwogCVJD
VV9JTklUX1BPSU5URVIob2JqLT5mZW5jZV9leGNsLCBOVUxMKTsKKwlkbWFfcmVzdl9mZW5jZXNf
aW5pdCgmb2JqLT5yZWFkZXJzKTsKIH0KIEVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfaW5pdCk7CiAK
QEAgLTMzNywxNTEgKzI5NywxNiBAQCBFWFBPUlRfU1lNQk9MKGRtYV9yZXN2X2luaXQpOwogICov
CiB2b2lkIGRtYV9yZXN2X2Zpbmkoc3RydWN0IGRtYV9yZXN2ICpvYmopCiB7Ci0Jc3RydWN0IGRt
YV9yZXN2X2xpc3QgKmZvYmo7Ci0Jc3RydWN0IGRtYV9mZW5jZSAqZXhjbDsKLQogCS8qCiAJICog
VGhpcyBvYmplY3Qgc2hvdWxkIGJlIGRlYWQgYW5kIGFsbCByZWZlcmVuY2VzIG11c3QgaGF2ZQog
CSAqIGJlZW4gcmVsZWFzZWQgdG8gaXQsIHNvIG5vIG5lZWQgdG8gYmUgcHJvdGVjdGVkIHdpdGgg
cmN1LgogCSAqLwotCWV4Y2wgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9iai0+ZmVuY2Vf
ZXhjbCwgMSk7Ci0JaWYgKGV4Y2wpCi0JCWRtYV9mZW5jZV9wdXQoZXhjbCk7Ci0KLQlmb2JqID0g
cmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChvYmotPmZlbmNlLCAxKTsKLQlkbWFfcmVzdl9saXN0
X2ZyZWUoZm9iaik7CisJZG1hX2ZlbmNlX3B1dChyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9i
ai0+ZmVuY2VfZXhjbCwgdHJ1ZSkpOworCWRtYV9yZXN2X2ZlbmNlc19maW5pKCZvYmotPnJlYWRl
cnMpOwogCXd3X211dGV4X2Rlc3Ryb3koJm9iai0+bG9jayk7CiB9CiBFWFBPUlRfU1lNQk9MKGRt
YV9yZXN2X2ZpbmkpOwogCi0vKioKLSAqIGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkIC0gUmVzZXJ2
ZSBzcGFjZSB0byBhZGQgc2hhcmVkIGZlbmNlcyB0bwotICogYSBkbWFfcmVzdi4KLSAqIEBvYmo6
IHJlc2VydmF0aW9uIG9iamVjdAotICogQG51bV9mZW5jZXM6IG51bWJlciBvZiBmZW5jZXMgd2Ug
d2FudCB0byBhZGQKLSAqCi0gKiBTaG91bGQgYmUgY2FsbGVkIGJlZm9yZSBkbWFfcmVzdl9hZGRf
c2hhcmVkX2ZlbmNlKCkuICBNdXN0Ci0gKiBiZSBjYWxsZWQgd2l0aCBvYmotPmxvY2sgaGVsZC4K
LSAqCi0gKiBSRVRVUk5TCi0gKiBaZXJvIGZvciBzdWNjZXNzLCBvciAtZXJybm8KLSAqLwotaW50
IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCB1bnNpZ25lZCBp
bnQgbnVtX2ZlbmNlcykKLXsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqb2xkLCAqbmV3OwotCXVu
c2lnbmVkIGludCBpLCBqLCBrLCBtYXg7Ci0KLQlkbWFfcmVzdl9hc3NlcnRfaGVsZChvYmopOwot
Ci0Jb2xkID0gZG1hX3Jlc3ZfZ2V0X2xpc3Qob2JqKTsKLQotCWlmIChvbGQgJiYgb2xkLT5zaGFy
ZWRfbWF4KSB7Ci0JCWlmICgob2xkLT5zaGFyZWRfY291bnQgKyBudW1fZmVuY2VzKSA8PSBvbGQt
PnNoYXJlZF9tYXgpCi0JCQlyZXR1cm4gMDsKLQkJZWxzZQotCQkJbWF4ID0gbWF4KG9sZC0+c2hh
cmVkX2NvdW50ICsgbnVtX2ZlbmNlcywKLQkJCQkgIG9sZC0+c2hhcmVkX21heCAqIDIpOwotCX0g
ZWxzZSB7Ci0JCW1heCA9IDQ7Ci0JfQotCi0JbmV3ID0gZG1hX3Jlc3ZfbGlzdF9hbGxvYyhtYXgp
OwotCWlmICghbmV3KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCS8qCi0JICogbm8gbmVlZCB0byBi
dW1wIGZlbmNlIHJlZmNvdW50cywgcmN1X3JlYWQgYWNjZXNzCi0JICogcmVxdWlyZXMgdGhlIHVz
ZSBvZiBrcmVmX2dldF91bmxlc3NfemVybywgYW5kIHRoZQotCSAqIHJlZmVyZW5jZXMgZnJvbSB0
aGUgb2xkIHN0cnVjdCBhcmUgY2FycmllZCBvdmVyIHRvCi0JICogdGhlIG5ldy4KLQkgKi8KLQlm
b3IgKGkgPSAwLCBqID0gMCwgayA9IG1heDsgaSA8IChvbGQgPyBvbGQtPnNoYXJlZF9jb3VudCA6
IDApOyArK2kpIHsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Ci0KLQkJZmVuY2UgPSByY3Vf
ZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9sZC0+c2hhcmVkW2ldLAotCQkJCQkJICBkbWFfcmVzdl9o
ZWxkKG9iaikpOwotCQlpZiAoZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkKLQkJCVJDVV9J
TklUX1BPSU5URVIobmV3LT5zaGFyZWRbLS1rXSwgZmVuY2UpOwotCQllbHNlCi0JCQlSQ1VfSU5J
VF9QT0lOVEVSKG5ldy0+c2hhcmVkW2orK10sIGZlbmNlKTsKLQl9Ci0JbmV3LT5zaGFyZWRfY291
bnQgPSBqOwotCi0JLyoKLQkgKiBXZSBhcmUgbm90IGNoYW5naW5nIHRoZSBlZmZlY3RpdmUgc2V0
IG9mIGZlbmNlcyBoZXJlIHNvIGNhbgotCSAqIG1lcmVseSB1cGRhdGUgdGhlIHBvaW50ZXIgdG8g
dGhlIG5ldyBhcnJheTsgYm90aCBleGlzdGluZwotCSAqIHJlYWRlcnMgYW5kIG5ldyByZWFkZXJz
IHdpbGwgc2VlIGV4YWN0bHkgdGhlIHNhbWUgc2V0IG9mCi0JICogYWN0aXZlICh1bnNpZ25hbGVk
KSBzaGFyZWQgZmVuY2VzLiBJbmRpdmlkdWFsIGZlbmNlcyBhbmQgdGhlCi0JICogb2xkIGFycmF5
IGFyZSBwcm90ZWN0ZWQgYnkgUkNVIGFuZCBzbyB3aWxsIG5vdCB2YW5pc2ggdW5kZXIKLQkgKiB0
aGUgZ2F6ZSBvZiB0aGUgcmN1X3JlYWRfbG9jaygpIHJlYWRlcnMuCi0JICovCi0JcmN1X2Fzc2ln
bl9wb2ludGVyKG9iai0+ZmVuY2UsIG5ldyk7Ci0KLQlpZiAoIW9sZCkKLQkJcmV0dXJuIDA7Ci0K
LQkvKiBEcm9wIHRoZSByZWZlcmVuY2VzIHRvIHRoZSBzaWduYWxlZCBmZW5jZXMgKi8KLQlmb3Ig
KGkgPSBrOyBpIDwgbWF4OyArK2kpIHsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Ci0KLQkJ
ZmVuY2UgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG5ldy0+c2hhcmVkW2ldLAotCQkJCQkJ
ICBkbWFfcmVzdl9oZWxkKG9iaikpOwotCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKLQl9Ci0Ja2Zy
ZWVfcmN1KG9sZCwgcmN1KTsKLQotCXJldHVybiAwOwotfQotRVhQT1JUX1NZTUJPTChkbWFfcmVz
dl9yZXNlcnZlX3NoYXJlZCk7Ci0KLS8qKgotICogZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSAt
IEFkZCBhIGZlbmNlIHRvIGEgc2hhcmVkIHNsb3QKLSAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBv
YmplY3QKLSAqIEBmZW5jZTogdGhlIHNoYXJlZCBmZW5jZSB0byBhZGQKLSAqCi0gKiBBZGQgYSBm
ZW5jZSB0byBhIHNoYXJlZCBzbG90LCBvYmotPmxvY2sgbXVzdCBiZSBoZWxkLCBhbmQKLSAqIGRt
YV9yZXN2X3Jlc2VydmVfc2hhcmVkKCkgaGFzIGJlZW4gY2FsbGVkLgotICovCi12b2lkIGRtYV9y
ZXN2X2FkZF9zaGFyZWRfZmVuY2Uoc3RydWN0IGRtYV9yZXN2ICpvYmosIHN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlKQotewotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqOwotCXN0cnVjdCBkbWFf
ZmVuY2UgKm9sZDsKLQl1bnNpZ25lZCBpbnQgaSwgY291bnQ7Ci0KLQlkbWFfZmVuY2VfZ2V0KGZl
bmNlKTsKLQotCWRtYV9yZXN2X2Fzc2VydF9oZWxkKG9iaik7Ci0KLQlmb2JqID0gZG1hX3Jlc3Zf
Z2V0X2xpc3Qob2JqKTsKLQljb3VudCA9IGZvYmotPnNoYXJlZF9jb3VudDsKLQotCXByZWVtcHRf
ZGlzYWJsZSgpOwotCXdyaXRlX3NlcWNvdW50X2JlZ2luKCZvYmotPnNlcSk7Ci0KLQlmb3IgKGkg
PSAwOyBpIDwgY291bnQ7ICsraSkgewotCi0JCW9sZCA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0
ZWQoZm9iai0+c2hhcmVkW2ldLAotCQkJCQkJZG1hX3Jlc3ZfaGVsZChvYmopKTsKLQkJaWYgKG9s
ZC0+Y29udGV4dCA9PSBmZW5jZS0+Y29udGV4dCB8fAotCQkgICAgZG1hX2ZlbmNlX2lzX3NpZ25h
bGVkKG9sZCkpCi0JCQlnb3RvIHJlcGxhY2U7Ci0JfQotCi0JQlVHX09OKGZvYmotPnNoYXJlZF9j
b3VudCA+PSBmb2JqLT5zaGFyZWRfbWF4KTsKLQlvbGQgPSBOVUxMOwotCWNvdW50Kys7Ci0KLXJl
cGxhY2U6Ci0JUkNVX0lOSVRfUE9JTlRFUihmb2JqLT5zaGFyZWRbaV0sIGZlbmNlKTsKLQkvKiBw
b2ludGVyIHVwZGF0ZSBtdXN0IGJlIHZpc2libGUgYmVmb3JlIHdlIGV4dGVuZCB0aGUgc2hhcmVk
X2NvdW50ICovCi0Jc21wX3N0b3JlX21iKGZvYmotPnNoYXJlZF9jb3VudCwgY291bnQpOwotCi0J
d3JpdGVfc2VxY291bnRfZW5kKCZvYmotPnNlcSk7Ci0JcHJlZW1wdF9lbmFibGUoKTsKLQlkbWFf
ZmVuY2VfcHV0KG9sZCk7Ci19Ci1FWFBPUlRfU1lNQk9MKGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVu
Y2UpOwotCiAvKioKICAqIGRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlIC0gQWRkIGFuIGV4Y2x1c2l2
ZSBmZW5jZS4KICAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBvYmplY3QKQEAgLTUwMSw2ICszMjYs
NyBAQCB2b2lkIGRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCBz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIAl3cml0ZV9zZXFjb3VudF9iZWdpbigmb2JqLT5zZXEp
OwogCS8qIHdyaXRlX3NlcWNvdW50X2JlZ2luIHByb3ZpZGVzIHRoZSBuZWNlc3NhcnkgbWVtb3J5
IGJhcnJpZXIgKi8KIAlSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVuY2VfZXhjbCwgZmVuY2UpOwor
CWRtYV9yZXN2X2ZlbmNlc19zZXQob2JqLCAmb2JqLT5yZWFkZXJzLCBmZW5jZSk7CiAJd3JpdGVf
c2VxY291bnRfZW5kKCZvYmotPnNlcSk7CiAJcHJlZW1wdF9lbmFibGUoKTsKIApAQCAtNTE2LDkg
KzM0Miw3IEBAIEVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UpOwogICovCiB2
b2lkIGRtYV9yZXN2X3BydW5lX2ZlbmNlcyhzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikKIHsKLQlzdHJ1
Y3QgZG1hX3Jlc3ZfbGlzdCAqbGlzdDsKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKLQl1bnNp
Z25lZCBpbnQgaTsKIAogCWRtYV9yZXN2X2Fzc2VydF9oZWxkKG9iaik7CiAKQEAgLTUyOCwyMCAr
MzUyLDkgQEAgdm9pZCBkbWFfcmVzdl9wcnVuZV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2ICpvYmop
CiAJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCX0KIAotCWxpc3QgPSBkbWFfcmVzdl9nZXRfbGlz
dChvYmopOwotCWlmICghbGlzdCkKLQkJcmV0dXJuOwotCi0JZm9yIChpID0gMDsgaSA8IGxpc3Qt
PnNoYXJlZF9jb3VudDsgKytpKSB7Ci0JCWZlbmNlID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3Rl
ZChsaXN0LT5zaGFyZWRbaV0sCi0JCQkJCQkgIGRtYV9yZXN2X2hlbGQob2JqKSk7Ci0KLQkJaWYg
KCFkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZmVuY2UpKQotCQkJY29udGludWU7Ci0KLQkJUkNVX0lO
SVRfUE9JTlRFUihsaXN0LT5zaGFyZWRbaV0sIGRtYV9mZW5jZV9nZXRfc3R1YigpKTsKLQkJZG1h
X2ZlbmNlX3B1dChmZW5jZSk7Ci0JfQorCWZlbmNlID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKG9i
aiwgJm9iai0+cmVhZGVycyk7CisJaWYgKGRtYV9mZW5jZV9pc19zaWduYWxlZChmZW5jZSkpCisJ
CWRtYV9yZXN2X2ZlbmNlc19zZXQob2JqLCAmb2JqLT5yZWFkZXJzLCBOVUxMKTsKIH0KIEVYUE9S
VF9TWU1CT0woZG1hX3Jlc3ZfcHJ1bmVfZmVuY2VzKTsKIApAQCAtNTU0LDczICszNjcsMjUgQEAg
RVhQT1JUX1NZTUJPTChkbWFfcmVzdl9wcnVuZV9mZW5jZXMpOwogKi8KIGludCBkbWFfcmVzdl9j
b3B5X2ZlbmNlcyhzdHJ1Y3QgZG1hX3Jlc3YgKmRzdCwgc3RydWN0IGRtYV9yZXN2ICpzcmMpCiB7
Ci0Jc3RydWN0IGRtYV9yZXN2X2xpc3QgKnNyY19saXN0LCAqZHN0X2xpc3Q7Ci0Jc3RydWN0IGRt
YV9mZW5jZSAqb2xkLCAqbmV3OwotCXVuc2lnbmVkIGk7CisJc3RydWN0IGRtYV9mZW5jZSAqb2xk
LCAqZXhjbCwgKnJlYWRlcnM7CiAKIAlkbWFfcmVzdl9hc3NlcnRfaGVsZChkc3QpOwogCiAJcmN1
X3JlYWRfbG9jaygpOwotCXNyY19saXN0ID0gcmN1X2RlcmVmZXJlbmNlKHNyYy0+ZmVuY2UpOwot
Ci1yZXRyeToKLQlpZiAoc3JjX2xpc3QpIHsKLQkJdW5zaWduZWQgc2hhcmVkX2NvdW50ID0gc3Jj
X2xpc3QtPnNoYXJlZF9jb3VudDsKLQotCQlyY3VfcmVhZF91bmxvY2soKTsKLQotCQlkc3RfbGlz
dCA9IGRtYV9yZXN2X2xpc3RfYWxsb2Moc2hhcmVkX2NvdW50KTsKLQkJaWYgKCFkc3RfbGlzdCkK
LQkJCXJldHVybiAtRU5PTUVNOwotCi0JCXJjdV9yZWFkX2xvY2soKTsKLQkJc3JjX2xpc3QgPSBy
Y3VfZGVyZWZlcmVuY2Uoc3JjLT5mZW5jZSk7Ci0JCWlmICghc3JjX2xpc3QgfHwgc3JjX2xpc3Qt
PnNoYXJlZF9jb3VudCA+IHNoYXJlZF9jb3VudCkgewotCQkJa2ZyZWUoZHN0X2xpc3QpOwotCQkJ
Z290byByZXRyeTsKLQkJfQotCi0JCWRzdF9saXN0LT5zaGFyZWRfY291bnQgPSAwOwotCQlmb3Ig
KGkgPSAwOyBpIDwgc3JjX2xpc3QtPnNoYXJlZF9jb3VudDsgKytpKSB7Ci0JCQlzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZTsKLQotCQkJZmVuY2UgPSByY3VfZGVyZWZlcmVuY2Uoc3JjX2xpc3QtPnNo
YXJlZFtpXSk7Ci0JCQlpZiAodGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULAot
CQkJCSAgICAgJmZlbmNlLT5mbGFncykpCi0JCQkJY29udGludWU7Ci0KLQkJCWlmICghZG1hX2Zl
bmNlX2dldF9yY3UoZmVuY2UpKSB7Ci0JCQkJZG1hX3Jlc3ZfbGlzdF9mcmVlKGRzdF9saXN0KTsK
LQkJCQlzcmNfbGlzdCA9IHJjdV9kZXJlZmVyZW5jZShzcmMtPmZlbmNlKTsKLQkJCQlnb3RvIHJl
dHJ5OwotCQkJfQotCi0JCQlpZiAoZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkgewotCQkJ
CWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQkJCWNvbnRpbnVlOwotCQkJfQotCi0JCQlyY3VfYXNz
aWduX3BvaW50ZXIoZHN0X2xpc3QtPnNoYXJlZFtkc3RfbGlzdC0+c2hhcmVkX2NvdW50KytdLCBm
ZW5jZSk7Ci0JCX0KLQl9IGVsc2UgewotCQlkc3RfbGlzdCA9IE5VTEw7Ci0JfQotCi0JbmV3ID0g
ZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmc3JjLT5mZW5jZV9leGNsKTsKKwlleGNsID0gZG1hX2Zl
bmNlX2dldF9yY3Vfc2FmZSgmc3JjLT5mZW5jZV9leGNsKTsKKwlyZWFkZXJzID0gZG1hX3Jlc3Zf
ZmVuY2VzX2dldF9yY3UoJnNyYy0+cmVhZGVycyk7CiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAKLQlz
cmNfbGlzdCA9IGRtYV9yZXN2X2dldF9saXN0KGRzdCk7CiAJb2xkID0gZG1hX3Jlc3ZfZ2V0X2V4
Y2woZHN0KTsKIAogCXByZWVtcHRfZGlzYWJsZSgpOwogCXdyaXRlX3NlcWNvdW50X2JlZ2luKCZk
c3QtPnNlcSk7CiAJLyogd3JpdGVfc2VxY291bnRfYmVnaW4gcHJvdmlkZXMgdGhlIG5lY2Vzc2Fy
eSBtZW1vcnkgYmFycmllciAqLwotCVJDVV9JTklUX1BPSU5URVIoZHN0LT5mZW5jZV9leGNsLCBu
ZXcpOwotCVJDVV9JTklUX1BPSU5URVIoZHN0LT5mZW5jZSwgZHN0X2xpc3QpOworCVJDVV9JTklU
X1BPSU5URVIoZHN0LT5mZW5jZV9leGNsLCBleGNsKTsKKwlkbWFfcmVzdl9mZW5jZXNfc2V0KGRz
dCwgJmRzdC0+cmVhZGVycywgcmVhZGVycyk7CiAJd3JpdGVfc2VxY291bnRfZW5kKCZkc3QtPnNl
cSk7CiAJcHJlZW1wdF9lbmFibGUoKTsKIAotCWRtYV9yZXN2X2xpc3RfZnJlZShzcmNfbGlzdCk7
CiAJZG1hX2ZlbmNlX3B1dChvbGQpOwogCiAJcmV0dXJuIDA7CkBAIC02MjgsNyArMzkzLDcgQEAg
aW50IGRtYV9yZXN2X2NvcHlfZmVuY2VzKHN0cnVjdCBkbWFfcmVzdiAqZHN0LCBzdHJ1Y3QgZG1h
X3Jlc3YgKnNyYykKIEVYUE9SVF9TWU1CT0woZG1hX3Jlc3ZfY29weV9mZW5jZXMpOwogCiAvKioK
LSAqIGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1IC0gR2V0IGFuIG9iamVjdCdzIHNoYXJlZCBhbmQg
ZXhjbHVzaXZlCisgKiBkbWFfcmVzdl9nZXRfZmVuY2VzX3JjdSAtIEdldCBhbiBvYmplY3QncyBy
ZWFkZXJzIGFuZCBleGNsdXNpdmUKICAqIGZlbmNlcyB3aXRob3V0IHVwZGF0ZSBzaWRlIGxvY2sg
aGVsZAogICogQG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdAogICogQHBmZW5jZV9leGNsOiB0
aGUgcmV0dXJuZWQgZXhjbHVzaXZlIGZlbmNlIChvciBOVUxMKQpAQCAtNjQ1LDkyICs0MTAsNTEg
QEAgaW50IGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1KHN0cnVjdCBkbWFfcmVzdiAqb2JqLAogCQkJ
ICAgIHVuc2lnbmVkICpwc2hhcmVkX2NvdW50LAogCQkJICAgIHN0cnVjdCBkbWFfZmVuY2UgKioq
cHNoYXJlZCkKIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICoqc2hhcmVkID0gTlVMTDsKLQlzdHJ1Y3Qg
ZG1hX2ZlbmNlICpmZW5jZV9leGNsOworCXN0cnVjdCBkbWFfZmVuY2UgKmV4Y2wsICpyZWFkZXJz
OworCXN0cnVjdCBkbWFfZmVuY2UgKipzaGFyZWQ7CiAJdW5zaWduZWQgaW50IHNoYXJlZF9jb3Vu
dDsKLQlpbnQgcmV0ID0gMTsKLQotCWRvIHsKLQkJc3RydWN0IGRtYV9yZXN2X2xpc3QgKmZvYmo7
Ci0JCXVuc2lnbmVkIGludCBpLCBzZXE7Ci0JCXNpemVfdCBzeiA9IDA7Ci0KLQkJc2hhcmVkX2Nv
dW50ID0gaSA9IDA7Ci0KLQkJcmN1X3JlYWRfbG9jaygpOwotCQlzZXEgPSByZWFkX3NlcWNvdW50
X2JlZ2luKCZvYmotPnNlcSk7Ci0KLQkJZmVuY2VfZXhjbCA9IHJjdV9kZXJlZmVyZW5jZShvYmot
PmZlbmNlX2V4Y2wpOwotCQlpZiAoZmVuY2VfZXhjbCAmJiAhZG1hX2ZlbmNlX2dldF9yY3UoZmVu
Y2VfZXhjbCkpCi0JCQlnb3RvIHVubG9jazsKLQotCQlmb2JqID0gcmN1X2RlcmVmZXJlbmNlKG9i
ai0+ZmVuY2UpOwotCQlpZiAoZm9iaikKLQkJCXN6ICs9IHNpemVvZigqc2hhcmVkKSAqIGZvYmot
PnNoYXJlZF9tYXg7Ci0KLQkJaWYgKCFwZmVuY2VfZXhjbCAmJiBmZW5jZV9leGNsKQotCQkJc3og
Kz0gc2l6ZW9mKCpzaGFyZWQpOwotCi0JCWlmIChzeikgewotCQkJc3RydWN0IGRtYV9mZW5jZSAq
Km5zaGFyZWQ7Ci0KLQkJCW5zaGFyZWQgPSBrcmVhbGxvYyhzaGFyZWQsIHN6LAotCQkJCQkgICBH
RlBfTk9XQUlUIHwgX19HRlBfTk9XQVJOKTsKLQkJCWlmICghbnNoYXJlZCkgewotCQkJCXJjdV9y
ZWFkX3VubG9jaygpOwotCi0JCQkJZG1hX2ZlbmNlX3B1dChmZW5jZV9leGNsKTsKLQkJCQlmZW5j
ZV9leGNsID0gTlVMTDsKLQotCQkJCW5zaGFyZWQgPSBrcmVhbGxvYyhzaGFyZWQsIHN6LCBHRlBf
S0VSTkVMKTsKLQkJCQlpZiAobnNoYXJlZCkgewotCQkJCQlzaGFyZWQgPSBuc2hhcmVkOwotCQkJ
CQljb250aW51ZTsKLQkJCQl9Ci0KLQkJCQlyZXQgPSAtRU5PTUVNOwotCQkJCWJyZWFrOwotCQkJ
fQotCQkJc2hhcmVkID0gbnNoYXJlZDsKLQkJCXNoYXJlZF9jb3VudCA9IGZvYmogPyBmb2JqLT5z
aGFyZWRfY291bnQgOiAwOwotCQkJZm9yIChpID0gMDsgaSA8IHNoYXJlZF9jb3VudDsgKytpKSB7
Ci0JCQkJc2hhcmVkW2ldID0gcmN1X2RlcmVmZXJlbmNlKGZvYmotPnNoYXJlZFtpXSk7Ci0JCQkJ
aWYgKCFkbWFfZmVuY2VfZ2V0X3JjdShzaGFyZWRbaV0pKQotCQkJCQlicmVhazsKLQkJCX0KLQkJ
fQogCi0JCWlmIChpICE9IHNoYXJlZF9jb3VudCB8fCByZWFkX3NlcWNvdW50X3JldHJ5KCZvYmot
PnNlcSwgc2VxKSkgewotCQkJd2hpbGUgKGktLSkKLQkJCQlkbWFfZmVuY2VfcHV0KHNoYXJlZFtp
XSk7Ci0JCQlkbWFfZmVuY2VfcHV0KGZlbmNlX2V4Y2wpOwotCQkJZ290byB1bmxvY2s7Ci0JCX0K
KwlyY3VfcmVhZF9sb2NrKCk7CisJZXhjbCA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+
ZmVuY2VfZXhjbCk7CisJcmVhZGVycyA9IGRtYV9yZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmotPnJl
YWRlcnMpOworCXJjdV9yZWFkX3VubG9jaygpOwogCi0JCXJldCA9IDA7Ci11bmxvY2s6Ci0JCXJj
dV9yZWFkX3VubG9jaygpOwotCX0gd2hpbGUgKHJldCk7CisJc2hhcmVkX2NvdW50ID0gcmVhZGVy
cyA/IDEgOiAwOworCWlmIChleGNsICYmICFwZmVuY2VfZXhjbCkKKwkJKytzaGFyZWRfY291bnQ7
CiAKLQlpZiAocGZlbmNlX2V4Y2wpCi0JCSpwZmVuY2VfZXhjbCA9IGZlbmNlX2V4Y2w7Ci0JZWxz
ZSBpZiAoZmVuY2VfZXhjbCkKLQkJc2hhcmVkWysrc2hhcmVkX2NvdW50XSA9IGZlbmNlX2V4Y2w7
CisJaWYgKHNoYXJlZF9jb3VudCkgeworCQlzaGFyZWQgPSBrbWFsbG9jX2FycmF5KHNoYXJlZF9j
b3VudCwgc2l6ZW9mKCpzaGFyZWQpLAorCQkJCSAgICAgICBHRlBfS0VSTkVMKTsKKwkJaWYgKCFz
aGFyZWQpIHsKKwkJCWRtYV9mZW5jZV9wdXQoZXhjbCk7CisJCQlkbWFfZmVuY2VfcHV0KHJlYWRl
cnMpOworCQkJcmV0dXJuIC1FTk9NRU07CisJCX0KIAotCWlmICghc2hhcmVkX2NvdW50KSB7Ci0J
CWtmcmVlKHNoYXJlZCk7Ci0JCXNoYXJlZCA9IE5VTEw7CisJCXNoYXJlZF9jb3VudCA9IDA7CisJ
CWlmIChyZWFkZXJzKQorCQkJc2hhcmVkW3NoYXJlZF9jb3VudCsrXSA9IHJlYWRlcnM7CisJCWlm
IChleGNsICYmICFwZmVuY2VfZXhjbCkKKwkJCXNoYXJlZFtzaGFyZWRfY291bnQrK10gPSBleGNs
OworCisJCSpwc2hhcmVkID0gc2hhcmVkOworCQkqcHNoYXJlZF9jb3VudCA9IHNoYXJlZF9jb3Vu
dDsKKwl9IGVsc2UgeworCQkqcHNoYXJlZCA9IE5VTEw7CisJCSpwc2hhcmVkX2NvdW50ID0gMDsK
IAl9CiAKLQkqcHNoYXJlZF9jb3VudCA9IHNoYXJlZF9jb3VudDsKLQkqcHNoYXJlZCA9IHNoYXJl
ZDsKLQlyZXR1cm4gcmV0OworCWlmIChwZmVuY2VfZXhjbCkKKwkJKnBmZW5jZV9leGNsID0gZXhj
bDsKKworCXJldHVybiAwOwogfQogRVhQT1JUX1NZTUJPTF9HUEwoZG1hX3Jlc3ZfZ2V0X2ZlbmNl
c19yY3UpOwogCiAvKioKICAqIGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3UgLSBXYWl0IG9uIHJl
c2VydmF0aW9uJ3Mgb2JqZWN0cwotICogc2hhcmVkIGFuZC9vciBleGNsdXNpdmUgZmVuY2VzLgor
ICogcmVhZGVycyBhbmQvb3IgZXhjbHVzaXZlIGZlbmNlcy4KICAqIEBvYmo6IHRoZSByZXNlcnZh
dGlvbiBvYmplY3QKICAqIEB3YWl0X2FsbDogaWYgdHJ1ZSwgd2FpdCBvbiBhbGwgZmVuY2VzLCBl
bHNlIHdhaXQgb24ganVzdCBleGNsdXNpdmUgZmVuY2UKICAqIEBpbnRyOiBpZiB0cnVlLCBkbyBp
bnRlcnJ1cHRpYmxlIHdhaXQKQEAgLTc0NCw5MyArNDY4LDI5IEBAIGxvbmcgZG1hX3Jlc3Zfd2Fp
dF90aW1lb3V0X3JjdShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwKIAkJCSAgICAgICBib29sIHdhaXRf
YWxsLCBib29sIGludHIsCiAJCQkgICAgICAgdW5zaWduZWQgbG9uZyB0aW1lb3V0KQogewotCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwotCXVuc2lnbmVkIHNlcSwgc2hhcmVkX2NvdW50OworCXN0
cnVjdCBkbWFfZmVuY2UgKmV4Y2wsICpyZWFkZXJzOwogCWxvbmcgcmV0ID0gdGltZW91dCA/IHRp
bWVvdXQgOiAxOwotCWludCBpOwogCi1yZXRyeToKLQlzaGFyZWRfY291bnQgPSAwOwotCXNlcSA9
IHJlYWRfc2VxY291bnRfYmVnaW4oJm9iai0+c2VxKTsKIAlyY3VfcmVhZF9sb2NrKCk7Ci0JaSA9
IC0xOwotCi0JZmVuY2UgPSByY3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZV9leGNsKTsKLQlpZiAo
ZmVuY2UgJiYgIXRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5m
bGFncykpIHsKLQkJaWYgKCFkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSkpCi0JCQlnb3RvIHVubG9j
a19yZXRyeTsKLQotCQlpZiAoZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkgewotCQkJZG1h
X2ZlbmNlX3B1dChmZW5jZSk7Ci0JCQlmZW5jZSA9IE5VTEw7Ci0JCX0KLQotCX0gZWxzZSB7Ci0J
CWZlbmNlID0gTlVMTDsKLQl9Ci0KLQlpZiAod2FpdF9hbGwpIHsKLQkJc3RydWN0IGRtYV9yZXN2
X2xpc3QgKmZvYmogPSByY3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZSk7Ci0KLQkJaWYgKGZvYmop
Ci0JCQlzaGFyZWRfY291bnQgPSBmb2JqLT5zaGFyZWRfY291bnQ7Ci0KLQkJZm9yIChpID0gMDsg
IWZlbmNlICYmIGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAq
bGZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKGZvYmotPnNoYXJlZFtpXSk7Ci0KLQkJCWlmICh0ZXN0
X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsCi0JCQkJICAgICAmbGZlbmNlLT5mbGFn
cykpCi0JCQkJY29udGludWU7Ci0KLQkJCWlmICghZG1hX2ZlbmNlX2dldF9yY3UobGZlbmNlKSkK
LQkJCQlnb3RvIHVubG9ja19yZXRyeTsKLQotCQkJaWYgKGRtYV9mZW5jZV9pc19zaWduYWxlZChs
ZmVuY2UpKSB7Ci0JCQkJZG1hX2ZlbmNlX3B1dChsZmVuY2UpOwotCQkJCWNvbnRpbnVlOwotCQkJ
fQotCi0JCQlmZW5jZSA9IGxmZW5jZTsKLQkJCWJyZWFrOwotCQl9Ci0JfQotCisJZXhjbCA9IGRt
YV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+ZmVuY2VfZXhjbCk7CisJcmVhZGVycyA9IGRtYV9y
ZXN2X2ZlbmNlc19nZXRfcmN1KCZvYmotPnJlYWRlcnMpOwogCXJjdV9yZWFkX3VubG9jaygpOwot
CWlmIChmZW5jZSkgewotCQlpZiAocmVhZF9zZXFjb3VudF9yZXRyeSgmb2JqLT5zZXEsIHNlcSkp
IHsKLQkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQkJZ290byByZXRyeTsKLQkJfQogCi0JCXJl
dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsIGludHIsIHJldCk7Ci0JCWRtYV9mZW5j
ZV9wdXQoZmVuY2UpOwotCQlpZiAocmV0ID4gMCAmJiB3YWl0X2FsbCAmJiAoaSArIDEgPCBzaGFy
ZWRfY291bnQpKQotCQkJZ290byByZXRyeTsKKwlpZiAod2FpdF9hbGwgJiYgcmVhZGVycykgewor
CQlyZXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KHJlYWRlcnMsIGludHIsIHJldCk7CisJCWlm
IChyZXQgPD0gMCkKKwkJCWdvdG8gb3V0OwogCX0KLQlyZXR1cm4gcmV0OwotCi11bmxvY2tfcmV0
cnk6Ci0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0JZ290byByZXRyeTsKLX0KLUVYUE9SVF9TWU1CT0xf
R1BMKGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3UpOwotCi0KLXN0YXRpYyBpbmxpbmUgaW50IGRt
YV9yZXN2X3Rlc3Rfc2lnbmFsZWRfc2luZ2xlKHN0cnVjdCBkbWFfZmVuY2UgKnBhc3NlZF9mZW5j
ZSkKLXsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgKmxmZW5jZSA9IHBhc3NlZF9mZW5jZTsK
LQlpbnQgcmV0ID0gMTsKIAotCWlmICghdGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURf
QklULCAmbGZlbmNlLT5mbGFncykpIHsKLQkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShsZmVu
Y2UpOwotCQlpZiAoIWZlbmNlKQotCQkJcmV0dXJuIC0xOworCWlmIChleGNsKQorCQlyZXQgPSBk
bWFfZmVuY2Vfd2FpdF90aW1lb3V0KGV4Y2wsIGludHIsIHJldCk7CiAKLQkJcmV0ID0gISFkbWFf
ZmVuY2VfaXNfc2lnbmFsZWQoZmVuY2UpOwotCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKLQl9Citv
dXQ6CisJZG1hX2ZlbmNlX3B1dChleGNsKTsKKwlkbWFfZmVuY2VfcHV0KHJlYWRlcnMpOwogCXJl
dHVybiByZXQ7CiB9CitFWFBPUlRfU1lNQk9MX0dQTChkbWFfcmVzdl93YWl0X3RpbWVvdXRfcmN1
KTsKIAogLyoqCiAgKiBkbWFfcmVzdl90ZXN0X3NpZ25hbGVkX3JjdSAtIFRlc3QgaWYgYSByZXNl
cnZhdGlvbiBvYmplY3QncwpAQCAtODQ0LDUxICs1MDQsMjMgQEAgc3RhdGljIGlubGluZSBpbnQg
ZG1hX3Jlc3ZfdGVzdF9zaWduYWxlZF9zaW5nbGUoc3RydWN0IGRtYV9mZW5jZSAqcGFzc2VkX2Zl
bmNlKQogICovCiBib29sIGRtYV9yZXN2X3Rlc3Rfc2lnbmFsZWRfcmN1KHN0cnVjdCBkbWFfcmVz
diAqb2JqLCBib29sIHRlc3RfYWxsKQogewotCXVuc2lnbmVkIHNlcSwgc2hhcmVkX2NvdW50Owot
CWludCByZXQ7CisJc3RydWN0IGRtYV9mZW5jZSAqZXhjbCwgKnJlYWRlcnM7CisJYm9vbCByZXQg
PSB0cnVlOwogCiAJcmN1X3JlYWRfbG9jaygpOwotcmV0cnk6Ci0JcmV0ID0gdHJ1ZTsKLQlzaGFy
ZWRfY291bnQgPSAwOwotCXNlcSA9IHJlYWRfc2VxY291bnRfYmVnaW4oJm9iai0+c2VxKTsKLQot
CWlmICh0ZXN0X2FsbCkgewotCQl1bnNpZ25lZCBpOwotCi0JCXN0cnVjdCBkbWFfcmVzdl9saXN0
ICpmb2JqID0gcmN1X2RlcmVmZXJlbmNlKG9iai0+ZmVuY2UpOwotCi0JCWlmIChmb2JqKQotCQkJ
c2hhcmVkX2NvdW50ID0gZm9iai0+c2hhcmVkX2NvdW50OwotCi0JCWZvciAoaSA9IDA7IGkgPCBz
aGFyZWRfY291bnQ7ICsraSkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UgPSByY3VfZGVy
ZWZlcmVuY2UoZm9iai0+c2hhcmVkW2ldKTsKLQotCQkJcmV0ID0gZG1hX3Jlc3ZfdGVzdF9zaWdu
YWxlZF9zaW5nbGUoZmVuY2UpOwotCQkJaWYgKHJldCA8IDApCi0JCQkJZ290byByZXRyeTsKLQkJ
CWVsc2UgaWYgKCFyZXQpCi0JCQkJYnJlYWs7Ci0JCX0KLQotCQlpZiAocmVhZF9zZXFjb3VudF9y
ZXRyeSgmb2JqLT5zZXEsIHNlcSkpCi0JCQlnb3RvIHJldHJ5OwotCX0KKwlleGNsID0gZG1hX2Zl
bmNlX2dldF9yY3Vfc2FmZSgmb2JqLT5mZW5jZV9leGNsKTsKKwlyZWFkZXJzID0gZG1hX3Jlc3Zf
ZmVuY2VzX2dldF9yY3UoJm9iai0+cmVhZGVycyk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAKLQlp
ZiAoIXNoYXJlZF9jb3VudCkgewotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZV9leGNsID0gcmN1
X2RlcmVmZXJlbmNlKG9iai0+ZmVuY2VfZXhjbCk7CisJaWYgKGV4Y2wpCisJCXJldCA9IGRtYV9m
ZW5jZV9pc19zaWduYWxlZChleGNsKTsKIAotCQlpZiAoZmVuY2VfZXhjbCkgewotCQkJcmV0ID0g
ZG1hX3Jlc3ZfdGVzdF9zaWduYWxlZF9zaW5nbGUoZmVuY2VfZXhjbCk7Ci0JCQlpZiAocmV0IDwg
MCkKLQkJCQlnb3RvIHJldHJ5OworCWlmICh0ZXN0X2FsbCAmJiByZWFkZXJzKQorCQlyZXQgJj0g
ZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKHJlYWRlcnMpOwogCi0JCQlpZiAocmVhZF9zZXFjb3VudF9y
ZXRyeSgmb2JqLT5zZXEsIHNlcSkpCi0JCQkJZ290byByZXRyeTsKLQkJfQotCX0KKwlkbWFfZmVu
Y2VfcHV0KGV4Y2wpOworCWRtYV9mZW5jZV9wdXQocmVhZGVycyk7CiAKLQlyY3VfcmVhZF91bmxv
Y2soKTsKIAlyZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTF9HUEwoZG1hX3Jlc3ZfdGVzdF9z
aWduYWxlZF9yY3UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2FtZGtmZF9ncHV2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Ft
ZGtmZF9ncHV2bS5jCmluZGV4IDc2ZTM1MTY0ODRlNy4uZWM0ZjI5OTM0YjA5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCkBAIC0yMyw2
ICsyMyw3IEBACiAjZGVmaW5lIHByX2ZtdChmbXQpICJrZmQya2dkOiAiIGZtdAogCiAjaW5jbHVk
ZSA8bGludXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJheS5oPgog
I2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9wYWdlbWFwLmg+CiAjaW5j
bHVkZSA8bGludXgvc2NoZWQvbW0uaD4KQEAgLTIxOSw1NCArMjIwLDI3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X2FtZGtmZF9yZW1vdmVfZXZpY3Rpb25fZmVuY2Uoc3RydWN0IGFtZGdwdV9ibyAqYm8s
CiAJCQkJCXN0cnVjdCBhbWRncHVfYW1ka2ZkX2ZlbmNlICplZikKIHsKIAlzdHJ1Y3QgZG1hX3Jl
c3YgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAqb2xk
LCAqbmV3OwotCXVuc2lnbmVkIGludCBpLCBqLCBrOworCXVuc2lnbmVkIGludCBpOworCWludCBy
OwogCiAJaWYgKCFlZikKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlvbGQgPSBkbWFfcmVzdl9nZXRf
bGlzdChyZXN2KTsKLQlpZiAoIW9sZCkKLQkJcmV0dXJuIDA7Ci0KLQluZXcgPSBrbWFsbG9jKG9m
ZnNldG9mKHR5cGVvZigqbmV3KSwgc2hhcmVkW29sZC0+c2hhcmVkX21heF0pLAotCQkgICAgICBH
RlBfS0VSTkVMKTsKLQlpZiAoIW5ldykKLQkJcmV0dXJuIC1FTk9NRU07CisJciA9IGRtYV9yZXN2
X2ZlbmNlc19yZXNlcnZlKHJlc3YsICZyZXN2LT5yZWFkZXJzLCAwKTsKKwlpZiAocikKKwkJcmV0
dXJuIHI7CiAKLQkvKiBHbyB0aHJvdWdoIGFsbCB0aGUgc2hhcmVkIGZlbmNlcyBpbiB0aGUgcmVz
ZXZhdGlvbiBvYmplY3QgYW5kIHNvcnQKLQkgKiB0aGUgaW50ZXJlc3Rpbmcgb25lcyB0byB0aGUg
ZW5kIG9mIHRoZSBsaXN0LgotCSAqLwotCWZvciAoaSA9IDAsIGogPSBvbGQtPnNoYXJlZF9jb3Vu
dCwgayA9IDA7IGkgPCBvbGQtPnNoYXJlZF9jb3VudDsgKytpKSB7CisJZm9yIChpID0gMDsgaSA8
IHJlc3YtPnJlYWRlcnMuc3RhZ2VkLT5udW1fZmVuY2VzOyArK2kpIHsKIAkJc3RydWN0IGRtYV9m
ZW5jZSAqZjsKIAotCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChvbGQtPnNoYXJlZFtp
XSwKLQkJCQkJICAgICAgZG1hX3Jlc3ZfaGVsZChyZXN2KSk7Ci0KLQkJaWYgKGYtPmNvbnRleHQg
PT0gZWYtPmJhc2UuY29udGV4dCkKLQkJCVJDVV9JTklUX1BPSU5URVIobmV3LT5zaGFyZWRbLS1q
XSwgZik7Ci0JCWVsc2UKLQkJCVJDVV9JTklUX1BPSU5URVIobmV3LT5zaGFyZWRbaysrXSwgZik7
CisJCWYgPSByZXN2LT5yZWFkZXJzLnN0YWdlZC0+ZmVuY2VzW2ldOworCQlpZiAoZi0+Y29udGV4
dCA9PSBlZi0+YmFzZS5jb250ZXh0KSB7CisJCQlyZXN2LT5yZWFkZXJzLnN0YWdlZC0+ZmVuY2Vz
W2ldID0gZG1hX2ZlbmNlX2dldF9zdHViKCk7CisJCQlkbWFfZmVuY2VfcHV0KGYpOworCQl9CiAJ
fQotCW5ldy0+c2hhcmVkX21heCA9IG9sZC0+c2hhcmVkX21heDsKLQluZXctPnNoYXJlZF9jb3Vu
dCA9IGs7Ci0KLQkvKiBJbnN0YWxsIHRoZSBuZXcgZmVuY2UgbGlzdCwgc2VxY291bnQgcHJvdmlk
ZXMgdGhlIGJhcnJpZXJzICovCi0JcHJlZW1wdF9kaXNhYmxlKCk7Ci0Jd3JpdGVfc2VxY291bnRf
YmVnaW4oJnJlc3YtPnNlcSk7Ci0JUkNVX0lOSVRfUE9JTlRFUihyZXN2LT5mZW5jZSwgbmV3KTsK
LQl3cml0ZV9zZXFjb3VudF9lbmQoJnJlc3YtPnNlcSk7Ci0JcHJlZW1wdF9lbmFibGUoKTsKIAot
CS8qIERyb3AgdGhlIHJlZmVyZW5jZXMgdG8gdGhlIHJlbW92ZWQgZmVuY2VzIG9yIG1vdmUgdGhl
bSB0byBlZl9saXN0ICovCi0JZm9yIChpID0gaiwgayA9IDA7IGkgPCBvbGQtPnNoYXJlZF9jb3Vu
dDsgKytpKSB7Ci0JCXN0cnVjdCBkbWFfZmVuY2UgKmY7Ci0KLQkJZiA9IHJjdV9kZXJlZmVyZW5j
ZV9wcm90ZWN0ZWQobmV3LT5zaGFyZWRbaV0sCi0JCQkJCSAgICAgIGRtYV9yZXN2X2hlbGQocmVz
dikpOwotCQlkbWFfZmVuY2VfcHV0KGYpOwotCX0KLQlrZnJlZV9yY3Uob2xkLCByY3UpOworCWRt
YV9yZXN2X2ZlbmNlc19jb21taXQocmVzdiwgJnJlc3YtPnJlYWRlcnMpOwogCiAJcmV0dXJuIDA7
CiB9CkBAIC04NDAsNiArODE0LDcgQEAgc3RhdGljIGludCBwcm9jZXNzX3VwZGF0ZV9wZHMoc3Ry
dWN0IGFtZGtmZF9wcm9jZXNzX2luZm8gKnByb2Nlc3NfaW5mbywKIHN0YXRpYyBpbnQgaW5pdF9r
ZmRfdm0oc3RydWN0IGFtZGdwdV92bSAqdm0sIHZvaWQgKipwcm9jZXNzX2luZm8sCiAJCSAgICAg
ICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZWYpCiB7CisJc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gdm0t
PnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdjsKIAlzdHJ1Y3QgYW1ka2ZkX3Byb2Nlc3NfaW5m
byAqaW5mbyA9IE5VTEw7CiAJaW50IHJldDsKIApAQCAtODg3LDcgKzg2Miw3IEBAIHN0YXRpYyBp
bnQgaW5pdF9rZmRfdm0oc3RydWN0IGFtZGdwdV92bSAqdm0sIHZvaWQgKipwcm9jZXNzX2luZm8s
CiAJCQkJICBBTURHUFVfRkVOQ0VfT1dORVJfS0ZELCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJZ290
byB3YWl0X3BkX2ZhaWw7Ci0JcmV0ID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQodm0tPnJvb3Qu
YmFzZS5iby0+dGJvLmJhc2UucmVzdiwgMSk7CisJcmV0ID0gZG1hX3Jlc3ZfZmVuY2VzX3Jlc2Vy
dmUocmVzdiwgJnJlc3YtPnJlYWRlcnMsIDEpOwogCWlmIChyZXQpCiAJCWdvdG8gcmVzZXJ2ZV9z
aGFyZWRfZmFpbDsKIAlhbWRncHVfYm9fZmVuY2Uodm0tPnJvb3QuYmFzZS5ibywKQEAgLTIxMzIs
NyArMjEwNyw4IEBAIGludCBhbWRncHVfYW1ka2ZkX2FkZF9nd3NfdG9fcHJvY2Vzcyh2b2lkICpp
bmZvLCB2b2lkICpnd3MsIHN0cnVjdCBrZ2RfbWVtICoqbWVtCiAJICogQWRkIHByb2Nlc3MgZXZp
Y3Rpb24gZmVuY2UgdG8gYm8gc28gdGhleSBjYW4KIAkgKiBldmljdCBlYWNoIG90aGVyLgogCSAq
LwotCXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKGd3c19iby0+dGJvLmJhc2UucmVzdiwg
MSk7CisJcmV0ID0gZG1hX3Jlc3ZfZmVuY2VzX3Jlc2VydmUoZ3dzX2JvLT50Ym8uYmFzZS5yZXN2
LAorCQkJCSAgICAgICZnd3NfYm8tPnRiby5iYXNlLnJlc3YtPnJlYWRlcnMsIDEpOwogCWlmIChy
ZXQpCiAJCWdvdG8gcmVzZXJ2ZV9zaGFyZWRfZmFpbDsKIAlhbWRncHVfYm9fZmVuY2UoZ3dzX2Jv
LCAmcHJvY2Vzc19pbmZvLT5ldmljdGlvbl9mZW5jZS0+YmFzZSwgdHJ1ZSk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwppbmRleCBiZjBmMDA1MDg5ODcuLjNl
NDY4NTU2NWY4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X2RtYV9idWYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1
Zi5jCkBAIC0xMzksNDMgKzEzOSwxMiBAQCBpbnQgYW1kZ3B1X2dlbV9wcmltZV9tbWFwKHN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqb2JqLAogc3RhdGljIGludAogX19kbWFfcmVzdl9tYWtlX2V4Y2x1
c2l2ZShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikKIHsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2Vz
OwotCXVuc2lnbmVkIGludCBjb3VudDsKLQlpbnQgcjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFk
ZXJzID0gZG1hX2ZlbmNlX2dldF9yY3Uob2JqLT5yZWFkZXJzLmZlbmNlKTsKIAotCWlmICghZG1h
X3Jlc3ZfZ2V0X2xpc3Qob2JqKSkgLyogbm8gc2hhcmVkIGZlbmNlcyB0byBjb252ZXJ0ICovCi0J
CXJldHVybiAwOwotCi0JciA9IGRtYV9yZXN2X2dldF9mZW5jZXNfcmN1KG9iaiwgTlVMTCwgJmNv
dW50LCAmZmVuY2VzKTsKLQlpZiAocikKLQkJcmV0dXJuIHI7Ci0KLQlpZiAoY291bnQgPT0gMCkg
ewotCQkvKiBOb3cgdGhhdCB3YXMgdW5leHBlY3RlZC4gKi8KLQl9IGVsc2UgaWYgKGNvdW50ID09
IDEpIHsKLQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLCBmZW5jZXNbMF0pOwotCQlkbWFf
ZmVuY2VfcHV0KGZlbmNlc1swXSk7Ci0JCWtmcmVlKGZlbmNlcyk7Ci0JfSBlbHNlIHsKLQkJc3Ry
dWN0IGRtYV9mZW5jZV9hcnJheSAqYXJyYXk7Ci0KLQkJYXJyYXkgPSBkbWFfZmVuY2VfYXJyYXlf
Y3JlYXRlKGNvdW50LCBmZW5jZXMsCi0JCQkJCSAgICAgICBkbWFfZmVuY2VfY29udGV4dF9hbGxv
YygxKSwgMCwKLQkJCQkJICAgICAgIGZhbHNlKTsKLQkJaWYgKCFhcnJheSkKLQkJCWdvdG8gZXJy
X2ZlbmNlc19wdXQ7Ci0KLQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLCAmYXJyYXktPmJh
c2UpOwotCQlkbWFfZmVuY2VfcHV0KCZhcnJheS0+YmFzZSk7Ci0JfQorCWRtYV9yZXN2X2FkZF9l
eGNsX2ZlbmNlKG9iaiwgcmVhZGVycyk7CisJZG1hX2ZlbmNlX3B1dChyZWFkZXJzKTsKIAogCXJl
dHVybiAwOwotCi1lcnJfZmVuY2VzX3B1dDoKLQl3aGlsZSAoY291bnQtLSkKLQkJZG1hX2ZlbmNl
X3B1dChmZW5jZXNbY291bnRdKTsKLQlrZnJlZShmZW5jZXMpOwotCXJldHVybiAtRU5PTUVNOwog
fQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9v
YmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwppbmRl
eCAyZjExZWJkOTU1MjguLmEyZGRkZDhkODk3YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtMTI4Niw3ICsxMjg2LDcgQEAgdm9pZCBhbWRncHVfYm9f
ZmVuY2Uoc3RydWN0IGFtZGdwdV9ibyAqYm8sIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogCXN0
cnVjdCBkbWFfcmVzdiAqcmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2OwogCiAJaWYgKHNoYXJlZCkK
LQkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShyZXN2LCBmZW5jZSk7CisJCWRtYV9yZXN2X2Zl
bmNlc19hZGQoJnJlc3YtPnJlYWRlcnMsIGZlbmNlKTsKIAllbHNlCiAJCWRtYV9yZXN2X2FkZF9l
eGNsX2ZlbmNlKHJlc3YsIGZlbmNlKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfc3luYy5jCmluZGV4IDk1ZTVlOTNlZGQxOC4uZjhiYzViYWYwYTQ0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfc3luYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9zeW5jLmMKQEAgLTI4LDYgKzI4LDggQEAKICAqICAgIENo
cmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KICAqLwogCisjaW5jbHVk
ZSA8bGludXgvZG1hLWZlbmNlLWFycmF5Lmg+CisKICNpbmNsdWRlICJhbWRncHUuaCIKICNpbmNs
dWRlICJhbWRncHVfdHJhY2UuaCIKICNpbmNsdWRlICJhbWRncHVfYW1ka2ZkLmgiCkBAIC0xOTMs
MTAgKzE5NSw5IEBAIGludCBhbWRncHVfc3luY19yZXN2KHN0cnVjdCBhbWRncHVfZGV2aWNlICph
ZGV2LAogCQkgICAgIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKIAkJICAgICB2b2lkICpvd25lciwg
Ym9vbCBleHBsaWNpdF9zeW5jKQogewotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmbGlzdDsKLQlz
dHJ1Y3QgZG1hX2ZlbmNlICpmOworCXN0cnVjdCBkbWFfZmVuY2VfYXJyYXlfY3Vyc29yIGN1cnNv
cjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmLCAqYXJyYXk7CiAJdm9pZCAqZmVuY2Vfb3duZXI7Ci0J
dW5zaWduZWQgaTsKIAlpbnQgciA9IDA7CiAKIAlpZiAocmVzdiA9PSBOVUxMKQpAQCAtMjA1LDE0
ICsyMDYsMTIgQEAgaW50IGFtZGdwdV9zeW5jX3Jlc3Yoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsCiAJLyogYWx3YXlzIHN5bmMgdG8gdGhlIGV4Y2x1c2l2ZSBmZW5jZSAqLwogCWYgPSBkbWFf
cmVzdl9nZXRfZXhjbChyZXN2KTsKIAlyID0gYW1kZ3B1X3N5bmNfZmVuY2UoYWRldiwgc3luYywg
ZiwgZmFsc2UpOwotCi0JZmxpc3QgPSBkbWFfcmVzdl9nZXRfbGlzdChyZXN2KTsKLQlpZiAoIWZs
aXN0IHx8IHIpCisJaWYgKHIpCiAJCXJldHVybiByOwogCi0JZm9yIChpID0gMDsgaSA8IGZsaXN0
LT5zaGFyZWRfY291bnQ7ICsraSkgewotCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChm
bGlzdC0+c2hhcmVkW2ldLAotCQkJCQkgICAgICBkbWFfcmVzdl9oZWxkKHJlc3YpKTsKKwlhcnJh
eSA9IGRtYV9yZXN2X2ZlbmNlc19kZXJlZihyZXN2LCAmcmVzdi0+cmVhZGVycyk7CisJZG1hX2Zl
bmNlX2FycmF5X2Zvcl9lYWNoKGYsIGN1cnNvciwgYXJyYXkpIHsKKwogCQkvKiBXZSBvbmx5IHdh
bnQgdG8gdHJpZ2dlciBLRkQgZXZpY3Rpb24gZmVuY2VzIG9uCiAJCSAqIGV2aWN0IG9yIG1vdmUg
am9icy4gU2tpcCBLRkQgZmVuY2VzIG90aGVyd2lzZS4KIAkJICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggZmIwOTMxNGJjZmQ0Li4zYzJlZmQxNGY5NDUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAgLTM5LDYgKzM5LDcgQEAK
ICNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvc3dhcC5oPgogI2luY2x1
ZGUgPGxpbnV4L3N3aW90bGIuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UtYXJyYXkuaD4K
IAogI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2FwaS5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRt
X2JvX2RyaXZlci5oPgpAQCAtMTQ3MCw5ICsxNDcxLDggQEAgc3RhdGljIGJvb2wgYW1kZ3B1X3R0
bV9ib19ldmljdGlvbl92YWx1YWJsZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogewog
CXVuc2lnbmVkIGxvbmcgbnVtX3BhZ2VzID0gYm8tPm1lbS5udW1fcGFnZXM7CiAJc3RydWN0IGRy
bV9tbV9ub2RlICpub2RlID0gYm8tPm1lbS5tbV9ub2RlOwotCXN0cnVjdCBkbWFfcmVzdl9saXN0
ICpmbGlzdDsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpmOwotCWludCBpOworCXN0cnVjdCBkbWFfZmVu
Y2VfYXJyYXlfY3Vyc29yIGN1cnNvcjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmLCAqYXJyYXk7CiAK
IAkvKiBEb24ndCBldmljdCBWTSBwYWdlIHRhYmxlcyB3aGlsZSB0aGV5IGFyZSBidXN5LCBvdGhl
cndpc2Ugd2UgY2FuJ3QKIAkgKiBjbGVhbmx5IGhhbmRsZSBwYWdlIGZhdWx0cy4KQEAgLTE0ODUs
MTUgKzE0ODUsMTAgQEAgc3RhdGljIGJvb2wgYW1kZ3B1X3R0bV9ib19ldmljdGlvbl92YWx1YWJs
ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCSAqIElmIHRydWUsIHRoZW4gcmV0dXJu
IGZhbHNlIGFzIGFueSBLRkQgcHJvY2VzcyBuZWVkcyBhbGwgaXRzIEJPcyB0bwogCSAqIGJlIHJl
c2lkZW50IHRvIHJ1biBzdWNjZXNzZnVsbHkKIAkgKi8KLQlmbGlzdCA9IGRtYV9yZXN2X2dldF9s
aXN0KGJvLT5iYXNlLnJlc3YpOwotCWlmIChmbGlzdCkgewotCQlmb3IgKGkgPSAwOyBpIDwgZmxp
c3QtPnNoYXJlZF9jb3VudDsgKytpKSB7Ci0JCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3Rl
ZChmbGlzdC0+c2hhcmVkW2ldLAotCQkJCWRtYV9yZXN2X2hlbGQoYm8tPmJhc2UucmVzdikpOwot
CQkJaWYgKGFtZGtmZF9mZW5jZV9jaGVja19tbShmLCBjdXJyZW50LT5tbSkpCi0JCQkJcmV0dXJu
IGZhbHNlOwotCQl9Ci0JfQorCWFycmF5ID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKGJvLT5iYXNl
LnJlc3YsICZiby0+YmFzZS5yZXN2LT5yZWFkZXJzKTsKKwlkbWFfZmVuY2VfYXJyYXlfZm9yX2Vh
Y2goZiwgY3Vyc29yLCBhcnJheSkKKwkJaWYgKGFtZGtmZF9mZW5jZV9jaGVja19tbShmLCBjdXJy
ZW50LT5tbSkpCisJCQlyZXR1cm4gZmFsc2U7CiAKIAlzd2l0Y2ggKGJvLT5tZW0ubWVtX3R5cGUp
IHsKIAljYXNlIFRUTV9QTF9UVDoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMK
aW5kZXggZjU1NTg0M2RhZWYwLi5jMjY5ZDRjMTY5YzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV92bS5jCkBAIC0yNzI0LDcgKzI3MjQsOCBAQCBpbnQgYW1kZ3B1X3ZtX2luaXQo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCWlmIChy
KQogCQlnb3RvIGVycm9yX2ZyZWVfcm9vdDsKIAotCXIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJl
ZChyb290LT50Ym8uYmFzZS5yZXN2LCAxKTsKKwlyID0gZG1hX3Jlc3ZfZmVuY2VzX3Jlc2VydmUo
cm9vdC0+dGJvLmJhc2UucmVzdiwKKwkJCQkgICAgJnJvb3QtPnRiby5iYXNlLnJlc3YtPnJlYWRl
cnMsIDEpOwogCWlmIChyKQogCQlnb3RvIGVycm9yX3VucmVzZXJ2ZTsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfZ2VtLmMKaW5kZXggN2Q4M2UwNGVjMzZlLi4xNWYzNmNjZDZlNTMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYwpAQCAtNyw2ICs3LDcgQEAKICNpbmNs
dWRlIDxsaW51eC9zaG1lbV9mcy5oPgogI2luY2x1ZGUgPGxpbnV4L3NjaGVkL21tLmg+CiAjaW5j
bHVkZSA8bGludXgvc2NoZWQvdGFzay5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJh
eS5oPgogCiAjaW5jbHVkZSAiZXRuYXZpdl9kcnYuaCIKICNpbmNsdWRlICJldG5hdml2X2dlbS5o
IgpAQCAtNDU5LDkgKzQ2MCw5IEBAIHN0YXRpYyB2b2lkIGV0bmF2aXZfZ2VtX2Rlc2NyaWJlX2Zl
bmNlKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogc3RhdGljIHZvaWQgZXRuYXZpdl9nZW1fZGVz
Y3JpYmUoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVjdCBzZXFfZmlsZSAqbSkKIHsK
IAlzdHJ1Y3QgZXRuYXZpdl9nZW1fb2JqZWN0ICpldG5hdml2X29iaiA9IHRvX2V0bmF2aXZfYm8o
b2JqKTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5X2N1cnNvciBjdXJzb3I7CiAJc3RydWN0IGRt
YV9yZXN2ICpyb2JqID0gb2JqLT5yZXN2OwotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqOwot
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqcmVh
ZGVyczsKIAl1bnNpZ25lZCBsb25nIG9mZiA9IGRybV92bWFfbm9kZV9zdGFydCgmb2JqLT52bWFf
bm9kZSk7CiAKIAlzZXFfcHJpbnRmKG0sICIlMDh4OiAlYyAlMmQgKCUyZCkgJTA4bHggJXAgJXpk
XG4iLApAQCAtNDcwLDE2ICs0NzEsOSBAQCBzdGF0aWMgdm9pZCBldG5hdml2X2dlbV9kZXNjcmli
ZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3RydWN0IHNlcV9maWxlICptKQogCQkJb2Zm
LCBldG5hdml2X29iai0+dmFkZHIsIG9iai0+c2l6ZSk7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0J
Zm9iaiA9IHJjdV9kZXJlZmVyZW5jZShyb2JqLT5mZW5jZSk7Ci0JaWYgKGZvYmopIHsKLQkJdW5z
aWduZWQgaW50IGksIHNoYXJlZF9jb3VudCA9IGZvYmotPnNoYXJlZF9jb3VudDsKLQotCQlmb3Ig
KGkgPSAwOyBpIDwgc2hhcmVkX2NvdW50OyBpKyspIHsKLQkJCWZlbmNlID0gcmN1X2RlcmVmZXJl
bmNlKGZvYmotPnNoYXJlZFtpXSk7Ci0JCQlldG5hdml2X2dlbV9kZXNjcmliZV9mZW5jZShmZW5j
ZSwgIlNoYXJlZCIsIG0pOwotCQl9Ci0JfQotCisJcmVhZGVycyA9IGRtYV9yZXN2X2ZlbmNlc19k
ZXJlZihyb2JqLCAmcm9iai0+cmVhZGVycyk7CisJZG1hX2ZlbmNlX2FycmF5X2Zvcl9lYWNoKGZl
bmNlLCBjdXJzb3IsIHJlYWRlcnMpCisJCWV0bmF2aXZfZ2VtX2Rlc2NyaWJlX2ZlbmNlKGZlbmNl
LCAiU2hhcmVkIiwgbSk7CiAJZmVuY2UgPSByY3VfZGVyZWZlcmVuY2Uocm9iai0+ZmVuY2VfZXhj
bCk7CiAJaWYgKGZlbmNlKQogCQlldG5hdml2X2dlbV9kZXNjcmliZV9mZW5jZShmZW5jZSwgIkV4
Y2x1c2l2ZSIsIG0pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZp
dl9nZW1fc3VibWl0LmMgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJt
aXQuYwppbmRleCA5OThjOTZiNDBkOGEuLjVmYWFiOGYwZTY3ZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMKQEAgLTE2OCw3ICsxNjgsNyBAQCBzdGF0
aWMgaW50IHN1Ym1pdF9mZW5jZV9zeW5jKHN0cnVjdCBldG5hdml2X2dlbV9zdWJtaXQgKnN1Ym1p
dCkKIAkJc3RydWN0IGRtYV9yZXN2ICpyb2JqID0gYm8tPm9iai0+YmFzZS5yZXN2OwogCiAJCWlm
ICghKGJvLT5mbGFncyAmIEVUTkFfU1VCTUlUX0JPX1dSSVRFKSkgewotCQkJcmV0ID0gZG1hX3Jl
c3ZfcmVzZXJ2ZV9zaGFyZWQocm9iaiwgMSk7CisJCQlyZXQgPSBkbWFfcmVzdl9mZW5jZXNfcmVz
ZXJ2ZShyb2JqLCAmcm9iai0+cmVhZGVycywgMSk7CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiBy
ZXQ7CiAJCX0KQEAgLTIwMiw4ICsyMDIsOCBAQCBzdGF0aWMgdm9pZCBzdWJtaXRfYXR0YWNoX29i
amVjdF9mZW5jZXMoc3RydWN0IGV0bmF2aXZfZ2VtX3N1Ym1pdCAqc3VibWl0KQogCQkJZG1hX3Jl
c3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLT5yZXN2LAogCQkJCQkJCSAgc3VibWl0LT5vdXRfZmVuY2Up
OwogCQllbHNlCi0JCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKG9iai0+cmVzdiwKLQkJCQkJ
CQkgICAgc3VibWl0LT5vdXRfZmVuY2UpOworCQkJZG1hX3Jlc3ZfZmVuY2VzX2FkZCgmb2JqLT5y
ZXN2LT5yZWFkZXJzLAorCQkJCQkgICAgc3VibWl0LT5vdXRfZmVuY2UpOwogCiAJCXN1Ym1pdF91
bmxvY2tfb2JqZWN0KHN1Ym1pdCwgaSk7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2J1c3kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9idXN5LmMKaW5kZXggM2Q0ZjU3NzVhNGJhLi4wZjE4YmE5N2IyMjggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2J1c3kuYwpAQCAtNCw2ICs0LDggQEAKICAqIENvcHly
aWdodCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCisjaW5jbHVkZSA8bGlu
dXgvZG1hLWZlbmNlLWFycmF5Lmg+CisKICNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmUuaCIKIAog
I2luY2x1ZGUgImk5MTVfZ2VtX2lvY3Rscy5oIgpAQCAtODEsOCArODMsOSBAQCBpOTE1X2dlbV9i
dXN5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCSAgICBzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9idXN5ICphcmdzID0g
ZGF0YTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5X2N1cnNvciBjdXJzb3I7CisJc3RydWN0IGRt
YV9mZW5jZSAqZmVuY2UsICpyZWFkZXJzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7Ci0Jc3RydWN0IGRtYV9yZXN2X2xpc3QgKmxpc3Q7CiAJdW5zaWduZWQgaW50IHNlcTsKIAlp
bnQgZXJyOwogCkBAIC0xMTcsMTcgKzEyMCwxMCBAQCBpOTE1X2dlbV9idXN5X2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCWJ1c3lfY2hlY2tfd3JpdGVyKHJjdV9k
ZXJlZmVyZW5jZShvYmotPmJhc2UucmVzdi0+ZmVuY2VfZXhjbCkpOwogCiAJLyogVHJhbnNsYXRl
IHNoYXJlZCBmZW5jZXMgdG8gUkVBRCBzZXQgb2YgZW5naW5lcyAqLwotCWxpc3QgPSByY3VfZGVy
ZWZlcmVuY2Uob2JqLT5iYXNlLnJlc3YtPmZlbmNlKTsKLQlpZiAobGlzdCkgewotCQl1bnNpZ25l
ZCBpbnQgc2hhcmVkX2NvdW50ID0gbGlzdC0+c2hhcmVkX2NvdW50LCBpOwotCi0JCWZvciAoaSA9
IDA7IGkgPCBzaGFyZWRfY291bnQ7ICsraSkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Ug
PQotCQkJCXJjdV9kZXJlZmVyZW5jZShsaXN0LT5zaGFyZWRbaV0pOwotCi0JCQlhcmdzLT5idXN5
IHw9IGJ1c3lfY2hlY2tfcmVhZGVyKGZlbmNlKTsKLQkJfQotCX0KKwlyZWFkZXJzID0gZG1hX3Jl
c3ZfZmVuY2VzX2dldF9yY3UoJm9iai0+YmFzZS5yZXN2LT5yZWFkZXJzKTsKKwlkbWFfZmVuY2Vf
YXJyYXlfZm9yX2VhY2goZmVuY2UsIGN1cnNvciwgcmVhZGVycykKKwkJYXJncy0+YnVzeSB8PSBi
dXN5X2NoZWNrX3JlYWRlcihmZW5jZSk7CisJZG1hX2ZlbmNlX3B1dChyZWFkZXJzKTsKIAogCWlm
IChhcmdzLT5idXN5ICYmIHJlYWRfc2VxY291bnRfcmV0cnkoJm9iai0+YmFzZS5yZXN2LT5zZXEs
IHNlcSkpCiAJCWdvdG8gcmV0cnk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9iYXRjaF9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRj
aF9wb29sLmMKaW5kZXggMjc0Y2Y1YjE5ZmM5Li5iMGY3NjBjMDcwYjAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKQEAgLTExMiw3ICsxMTIsNyBAQCBpOTE1
X2dlbV9iYXRjaF9wb29sX2dldChzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCwKIAkJ
CSAqIHRyYXBwaW5nIGEgcmVmZXJlbmNlIHRvIGFsbCB0aGUgb2xkIGZlbmNlcywgcmF0aGVyCiAJ
CQkgKiB0aGFuIHJlcGxhY2UgdGhlIGV4aXN0aW5nIGZlbmNlLgogCQkJICovCi0JCQlpZiAocmN1
X2FjY2Vzc19wb2ludGVyKHJlc3YtPmZlbmNlKSkgeworCQkJaWYgKHJjdV9hY2Nlc3NfcG9pbnRl
cihyZXN2LT5yZWFkZXJzLmZlbmNlKSkgewogCQkJCWRtYV9yZXN2X2xvY2socmVzdiwgTlVMTCk7
CiAJCQkJZG1hX3Jlc3ZfcHJ1bmVfZmVuY2VzKHJlc3YpOwogCQkJCWRtYV9yZXN2X3VubG9jayhy
ZXN2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IGZjYmU0MzNhOTY4Yy4uMjY3YmU5MmM0
YzdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTkxMSw4ICs5MTEsOCBAQCBzdGF0aWMg
dm9pZCBleHBvcnRfZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJICovCiAJaWYgKGZsYWdz
ICYgRVhFQ19PQkpFQ1RfV1JJVEUpCiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHJlc3YsICZy
cS0+ZmVuY2UpOwotCWVsc2UgaWYgKGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHJlc3YsIDEpID09
IDApCi0JCWRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2UocmVzdiwgJnJxLT5mZW5jZSk7CisJZWxz
ZSBpZiAoZG1hX3Jlc3ZfZmVuY2VzX3Jlc2VydmUocmVzdiwgJnJlc3YtPnJlYWRlcnMsIDEpID09
IDApCisJCWRtYV9yZXN2X2ZlbmNlc19hZGQoJnJlc3YtPnJlYWRlcnMsICZycS0+ZmVuY2UpOwog
fQogCiBpbnQgaTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbGltYS9saW1hX2dlbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2xpbWEvbGltYV9nZW0uYwppbmRleCBmZjNkOWFjYzI0ZmMuLjFkNWVmM2Q2ZDNlMiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2xpbWEvbGltYV9nZW0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vbGltYS9saW1hX2dlbS5jCkBAIC0xMzYsNyArMTM2LDcgQEAgc3RhdGljIGludCBsaW1h
X2dlbV9zeW5jX2JvKHN0cnVjdCBsaW1hX3NjaGVkX3Rhc2sgKnRhc2ssIHN0cnVjdCBsaW1hX2Jv
ICpibywKIAlpbnQgZXJyID0gMDsKIAogCWlmICghd3JpdGUpIHsKLQkJZXJyID0gZG1hX3Jlc3Zf
cmVzZXJ2ZV9zaGFyZWQoYm8tPmdlbS5yZXN2LCAxKTsKKwkJZXJyID0gZG1hX3Jlc3ZfZmVuY2Vz
X3Jlc2VydmUoJmJvLT5nZW0ucmVzdi0+cmVhZGVycywgMSk7CiAJCWlmIChlcnIpCiAJCQlyZXR1
cm4gZXJyOwogCX0KQEAgLTI5OCw3ICsyOTgsNyBAQCBpbnQgbGltYV9nZW1fc3VibWl0KHN0cnVj
dCBkcm1fZmlsZSAqZmlsZSwgc3RydWN0IGxpbWFfc3VibWl0ICpzdWJtaXQpCiAJCWlmIChzdWJt
aXQtPmJvc1tpXS5mbGFncyAmIExJTUFfU1VCTUlUX0JPX1dSSVRFKQogCQkJZG1hX3Jlc3ZfYWRk
X2V4Y2xfZmVuY2UoYm9zW2ldLT5nZW0ucmVzdiwgZmVuY2UpOwogCQllbHNlCi0JCQlkbWFfcmVz
dl9hZGRfc2hhcmVkX2ZlbmNlKGJvc1tpXS0+Z2VtLnJlc3YsIGZlbmNlKTsKKwkJCWRtYV9yZXN2
X2ZlbmNlc19hZGQoJmJvc1tpXS0+Z2VtLnJlc3YtPnJlYWRlcnMsIGZlbmNlKTsKIAl9CiAKIAls
aW1hX2dlbV91bmxvY2tfYm9zKGJvcywgc3VibWl0LT5ucl9ib3MsICZjdHgpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21z
bV9nZW0uYwppbmRleCA5MGUzZGMzYjkyN2EuLjNkOWExZDUzYzMwOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL21zbS9tc21fZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
Z2VtLmMKQEAgLTY2MywxMSArNjYzLDEwIEBAIHZvaWQgbXNtX2dlbV92dW5tYXAoc3RydWN0IGRy
bV9nZW1fb2JqZWN0ICpvYmosIGVudW0gbXNtX2dlbV9sb2NrIHN1YmNsYXNzKQogaW50IG1zbV9n
ZW1fc3luY19vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiAJCXN0cnVjdCBtc21f
ZmVuY2VfY29udGV4dCAqZmN0eCwgYm9vbCBleGNsdXNpdmUpCiB7Ci0Jc3RydWN0IGRtYV9yZXN2
X2xpc3QgKmZvYmo7Ci0Jc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CisJc3RydWN0IGRtYV9mZW5j
ZV9hcnJheV9jdXJzb3IgY3Vyc29yOworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCAqcmVhZGVy
czsKIAlpbnQgaSwgcmV0OwogCi0JZm9iaiA9IGRtYV9yZXN2X2dldF9saXN0KG9iai0+cmVzdik7
CiAJZmVuY2UgPSBkbWFfcmVzdl9nZXRfZXhjbChvYmotPnJlc3YpOwogCS8qIGRvbid0IG5lZWQg
dG8gd2FpdCBvbiBvdXIgb3duIGZlbmNlcywgc2luY2UgcmluZyBpcyBmaWZvICovCiAJaWYgKGZl
bmNlICYmIChmZW5jZS0+Y29udGV4dCAhPSBmY3R4LT5jb250ZXh0KSkgewpAQCAtNjc2LDEyICs2
NzUsMTEgQEAgaW50IG1zbV9nZW1fc3luY19vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpv
YmosCiAJCQlyZXR1cm4gcmV0OwogCX0KIAotCWlmICghZXhjbHVzaXZlIHx8ICFmb2JqKQorCWlm
ICghZXhjbHVzaXZlKQogCQlyZXR1cm4gMDsKIAotCWZvciAoaSA9IDA7IGkgPCBmb2JqLT5zaGFy
ZWRfY291bnQ7IGkrKykgewotCQlmZW5jZSA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoZm9i
ai0+c2hhcmVkW2ldLAotCQkJCQkJZG1hX3Jlc3ZfaGVsZChvYmotPnJlc3YpKTsKKwlyZWFkZXJz
ID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKG9iai0+cmVzdiwgJm9iai0+cmVzLT5yZWFkZXJzKTsK
KwlkbWFfZmVuY2VfYXJyYXlfZm9yX2VhY2goZmVuY2UsIGN1cnNvciwgcmVhZGVycykgewogCQlp
ZiAoZmVuY2UtPmNvbnRleHQgIT0gZmN0eC0+Y29udGV4dCkgewogCQkJcmV0ID0gZG1hX2ZlbmNl
X3dhaXQoZmVuY2UsIHRydWUpOwogCQkJaWYgKHJldCkKQEAgLTcwMSw3ICs2OTksNyBAQCB2b2lk
IG1zbV9nZW1fbW92ZV90b19hY3RpdmUoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiAJaWYg
KGV4Y2x1c2l2ZSkKIAkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLT5yZXN2LCBmZW5jZSk7
CiAJZWxzZQotCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKG9iai0+cmVzdiwgZmVuY2UpOwor
CQlkbWFfcmVzdl9mZW5jZXNfYWRkKCZvYmotPnJlc3YtPnJlYWRlcnMsIGZlbmNlKTsKIAlsaXN0
X2RlbF9pbml0KCZtc21fb2JqLT5tbV9saXN0KTsKIAlsaXN0X2FkZF90YWlsKCZtc21fb2JqLT5t
bV9saXN0LCAmZ3B1LT5hY3RpdmVfbGlzdCk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vbXNtL21zbV9nZW1fc3VibWl0LmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fc3Vi
bWl0LmMKaW5kZXggMmUxNTU2YjdhZjI2Li40ZDAzOGQyMDA0ZmIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9tc20vbXNtX2dlbV9zdWJtaXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNt
L21zbV9nZW1fc3VibWl0LmMKQEAgLTIyNSw4ICsyMjUsOCBAQCBzdGF0aWMgaW50IHN1Ym1pdF9m
ZW5jZV9zeW5jKHN0cnVjdCBtc21fZ2VtX3N1Ym1pdCAqc3VibWl0LCBib29sIG5vX2ltcGxpY2l0
KQogCQkJICogc3RyYW5nZSBwbGFjZSB0byBjYWxsIGl0LiAgT1RPSCB0aGlzIGlzIGEKIAkJCSAq
IGNvbnZlbmllbnQgY2FuLWZhaWwgcG9pbnQgdG8gaG9vayBpdCBpbi4KIAkJCSAqLwotCQkJcmV0
ID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQobXNtX29iai0+YmFzZS5yZXN2LAotCQkJCQkJCQkx
KTsKKwkJCXJldCA9IGRtYV9yZXN2X2ZlbmNlc19yZXNlcnZlKCZtc21fb2JqLT5iYXNlLnJlc3Yt
PnJlYWRlcnMsCisJCQkJCQkgICAgICAxKTsKIAkJCWlmIChyZXQpCiAJCQkJcmV0dXJuIHJldDsK
IAkJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jIGIv
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IGUwYjFiYmVlOTM2Zi4u
NmIzZmFkMDNiMzQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1
X2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCkBAIC0xNjYw
LDcgKzE2NjAsNyBAQCBub3V2ZWF1X2JvX2ZlbmNlKHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCBz
dHJ1Y3Qgbm91dmVhdV9mZW5jZSAqZmVuY2UsIGJvb2wgZXhjbAogCWlmIChleGNsdXNpdmUpCiAJ
CWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHJlc3YsICZmZW5jZS0+YmFzZSk7CiAJZWxzZSBpZiAo
ZmVuY2UpCi0JCWRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2UocmVzdiwgJmZlbmNlLT5iYXNlKTsK
KwkJZG1hX3Jlc3ZfZmVuY2VzX2FkZCgmcmVzdi0+cmVhZGVycywgJmZlbmNlLT5iYXNlKTsKIH0K
IAogc3RydWN0IHR0bV9ib19kcml2ZXIgbm91dmVhdV9ib19kcml2ZXIgPSB7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9k
cm0vbm91dmVhdS9ub3V2ZWF1X2ZlbmNlLmMKaW5kZXggNDJkZGRkYmI0OWU0Li4zNTBjZDJhOWVh
NTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmVuY2UuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2ZlbmNlLmMKQEAgLTI4LDYgKzI4
LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L2t0aW1lLmg+CiAjaW5jbHVkZSA8bGludXgvaHJ0aW1l
ci5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS1hcnJheS5oPgogI2luY2x1ZGUgPHRyYWNl
L2V2ZW50cy9kbWFfZmVuY2UuaD4KIAogI2luY2x1ZGUgPG52aWYvY2w4MjZlLmg+CkBAIC0zMzQs
MjIgKzMzNSwyMCBAQCBpbnQKIG5vdXZlYXVfZmVuY2Vfc3luYyhzdHJ1Y3Qgbm91dmVhdV9ibyAq
bnZibywgc3RydWN0IG5vdXZlYXVfY2hhbm5lbCAqY2hhbiwgYm9vbCBleGNsdXNpdmUsIGJvb2wg
aW50cikKIHsKIAlzdHJ1Y3Qgbm91dmVhdV9mZW5jZV9jaGFuICpmY3R4ID0gY2hhbi0+ZmVuY2U7
Ci0Jc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gbnZi
by0+Ym8uYmFzZS5yZXN2OwotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqOworCXN0cnVjdCBk
bWFfZmVuY2VfYXJyYXlfY3Vyc29yIGN1cnNvcjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwg
KnJlYWRlcnM7CiAJc3RydWN0IG5vdXZlYXVfZmVuY2UgKmY7Ci0JaW50IHJldCA9IDAsIGk7CisJ
aW50IHJldCA9IDA7CiAKIAlpZiAoIWV4Y2x1c2l2ZSkgewotCQlyZXQgPSBkbWFfcmVzdl9yZXNl
cnZlX3NoYXJlZChyZXN2LCAxKTsKKwkJcmV0ID0gZG1hX3Jlc3ZfZmVuY2VzX3Jlc2VydmUocmVz
diwgJnJlc3YtPnJlYWRlcnMsIDEpOwogCiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0K
IAotCWZvYmogPSBkbWFfcmVzdl9nZXRfbGlzdChyZXN2KTsKIAlmZW5jZSA9IGRtYV9yZXN2X2dl
dF9leGNsKHJlc3YpOwotCiAJaWYgKGZlbmNlKSB7CiAJCXN0cnVjdCBub3V2ZWF1X2NoYW5uZWwg
KnByZXYgPSBOVUxMOwogCQlib29sIG11c3Rfd2FpdCA9IHRydWU7CkBAIC0zNjksMTYgKzM2OCwx
NCBAQCBub3V2ZWF1X2ZlbmNlX3N5bmMoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8sIHN0cnVjdCBu
b3V2ZWF1X2NoYW5uZWwgKmNoYW4sIGJvb2wgZQogCQlyZXR1cm4gcmV0OwogCX0KIAotCWlmICgh
ZXhjbHVzaXZlIHx8ICFmb2JqKQorCWlmICghZXhjbHVzaXZlKQogCQlyZXR1cm4gcmV0OwogCi0J
Zm9yIChpID0gMDsgaSA8IGZvYmotPnNoYXJlZF9jb3VudCAmJiAhcmV0OyArK2kpIHsKKwlyZWFk
ZXJzID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKHJlc3YsICZyZXN2LT5yZWFkZXJzKTsKKwlkbWFf
ZmVuY2VfYXJyYXlfZm9yX2VhY2goZmVuY2UsIGN1cnNvciwgcmVhZGVycykgewogCQlzdHJ1Y3Qg
bm91dmVhdV9jaGFubmVsICpwcmV2ID0gTlVMTDsKIAkJYm9vbCBtdXN0X3dhaXQgPSB0cnVlOwog
Ci0JCWZlbmNlID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChmb2JqLT5zaGFyZWRbaV0sCi0J
CQkJCQlkbWFfcmVzdl9oZWxkKHJlc3YpKTsKLQogCQlmID0gbm91dmVhdV9sb2NhbF9mZW5jZShm
ZW5jZSwgY2hhbi0+ZHJtKTsKIAkJaWYgKGYpIHsKIAkJCXJjdV9yZWFkX2xvY2soKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9xeGwvcXhsX2RlYnVnZnMuYwppbmRleCBhNGY0MTc1YmJkYmUuLjg5YjkxNzkzYTY1NyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9xeGwvcXhsX2RlYnVnZnMuYwpAQCAtMjgsNiArMjgsOCBAQAogICogIEFsb24gTGV2
eSA8YWxldnlAcmVkaGF0LmNvbT4KICAqLwogCisjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLWFy
cmF5Lmg+CisKICNpbmNsdWRlIDxkcm0vZHJtX2RlYnVnZnMuaD4KICNpbmNsdWRlIDxkcm0vZHJt
X2ZpbGUuaD4KIApAQCAtNTcsMTIgKzU5LDE1IEBAIHF4bF9kZWJ1Z2ZzX2J1ZmZlcnNfaW5mbyhz
dHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJc3RydWN0IHF4bF9ibyAqYm87CiAKIAls
aXN0X2Zvcl9lYWNoX2VudHJ5KGJvLCAmcWRldi0+Z2VtLm9iamVjdHMsIGxpc3QpIHsKLQkJc3Ry
dWN0IGRtYV9yZXN2X2xpc3QgKmZvYmo7CisJCXN0cnVjdCBkbWFfcmVzdiAqcmVzdiA9IGJvLT50
Ym8uYmFzZS5yZXN2OworCQlzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5ICphcnJheTsKKwkJc3RydWN0
IGRtYV9mZW5jZSAqcmVhZGVyczsKIAkJaW50IHJlbDsKIAogCQlyY3VfcmVhZF9sb2NrKCk7Ci0J
CWZvYmogPSByY3VfZGVyZWZlcmVuY2UoYm8tPnRiby5iYXNlLnJlc3YtPmZlbmNlKTsKLQkJcmVs
ID0gZm9iaiA/IGZvYmotPnNoYXJlZF9jb3VudCA6IDA7CisJCXJlYWRlcnMgPSBkbWFfcmVzdl9m
ZW5jZXNfZGVyZWYocmVzdiwgJnJlc3YtPnJlYWRlcnMpOworCQlhcnJheSA9IHRvX2RtYV9mZW5j
ZV9hcnJheShyZWFkZXJzKTsKKwkJcmVsID0gYXJyYXkgPyBhcnJheS0+bnVtX2ZlbmNlcyA6IHJl
YWRlcnMgPyAxIDogMDsKIAkJcmN1X3JlYWRfdW5sb2NrKCk7CiAKIAkJc2VxX3ByaW50ZihtLCAi
c2l6ZSAlbGQsIHBjICVkLCBudW0gcmVsZWFzZXMgJWRcbiIsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vcXhsL3F4bF9yZWxlYXNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9yZWxl
YXNlLmMKaW5kZXggMzEyMjE2Y2FlZWEyLi5iNzNjYmJjNjAxNjcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9xeGwvcXhsX3JlbGVhc2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4
bF9yZWxlYXNlLmMKQEAgLTIyOSw2ICsyMjksNyBAQCBpbnQgcXhsX3JlbGVhc2VfbGlzdF9hZGQo
c3RydWN0IHF4bF9yZWxlYXNlICpyZWxlYXNlLCBzdHJ1Y3QgcXhsX2JvICpibykKIHN0YXRpYyBp
bnQgcXhsX3JlbGVhc2VfdmFsaWRhdGVfYm8oc3RydWN0IHF4bF9ibyAqYm8pCiB7CiAJc3RydWN0
IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsgdHJ1ZSwgZmFsc2UgfTsKKwlzdHJ1Y3QgZG1hX3Jl
c3YgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKIAlpbnQgcmV0OwogCiAJaWYgKCFiby0+cGlu
X2NvdW50KSB7CkBAIC0yMzgsNyArMjM5LDcgQEAgc3RhdGljIGludCBxeGxfcmVsZWFzZV92YWxp
ZGF0ZV9ibyhzdHJ1Y3QgcXhsX2JvICpibykKIAkJCXJldHVybiByZXQ7CiAJfQogCi0JcmV0ID0g
ZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQoYm8tPnRiby5iYXNlLnJlc3YsIDEpOworCXJldCA9IGRt
YV9yZXN2X2ZlbmNlc19yZXNlcnZlKHJlc3YsICZyZXN2LT5yZWFkZXJzLCAxKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCkBAIC00NTgsNyArNDU5LDcgQEAgdm9pZCBxeGxfcmVsZWFzZV9m
ZW5jZV9idWZmZXJfb2JqZWN0cyhzdHJ1Y3QgcXhsX3JlbGVhc2UgKnJlbGVhc2UpCiAJbGlzdF9m
b3JfZWFjaF9lbnRyeShlbnRyeSwgJnJlbGVhc2UtPmJvcywgaGVhZCkgewogCQlibyA9IGVudHJ5
LT5ibzsKIAotCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKGJvLT5iYXNlLnJlc3YsICZyZWxl
YXNlLT5iYXNlKTsKKwkJZG1hX3Jlc3ZfZmVuY2VzX2FkZCgmYm8tPmJhc2UucmVzdi0+cmVhZGVy
cywgJnJlbGVhc2UtPmJhc2UpOwogCQl0dG1fYm9fYWRkX3RvX2xydShibyk7CiAJCWRtYV9yZXN2
X3VubG9jayhiby0+YmFzZS5yZXN2KTsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
cmFkZW9uL3JhZGVvbl9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29i
amVjdC5jCmluZGV4IDJhYmUxZWFiNDcxZi4uMzdhYmRlOTFhNzliIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
cmFkZW9uL3JhZGVvbl9vYmplY3QuYwpAQCAtODczLDcgKzg3Myw3IEBAIHZvaWQgcmFkZW9uX2Jv
X2ZlbmNlKHN0cnVjdCByYWRlb25fYm8gKmJvLCBzdHJ1Y3QgcmFkZW9uX2ZlbmNlICpmZW5jZSwK
IAlzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKIAogCWlmIChzaGFy
ZWQpCi0JCWRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2UocmVzdiwgJmZlbmNlLT5iYXNlKTsKKwkJ
ZG1hX3Jlc3ZfZmVuY2VzX2FkZCgmcmVzdi0+cmVhZGVycywgJmZlbmNlLT5iYXNlKTsKIAllbHNl
CiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHJlc3YsICZmZW5jZS0+YmFzZSk7CiB9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9zeW5jLmMgYi9kcml2ZXJzL2dw
dS9kcm0vcmFkZW9uL3JhZGVvbl9zeW5jLmMKaW5kZXggNTVjYzc3YTczYzdiLi45NzFkZDZjMDFl
NjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3N5bmMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9zeW5jLmMKQEAgLTI3LDYgKzI3LDcgQEAK
ICAqIEF1dGhvcnM6CiAgKiAgICBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFt
ZC5jb20+CiAgKi8KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UtYXJyYXkuaD4KIAogI2luY2x1
ZGUgInJhZGVvbi5oIgogI2luY2x1ZGUgInJhZGVvbl90cmFjZS5oIgpAQCAtOTAsMTAgKzkxLDkg
QEAgaW50IHJhZGVvbl9zeW5jX3Jlc3Yoc3RydWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYsCiAJCSAg
ICAgc3RydWN0IGRtYV9yZXN2ICpyZXN2LAogCQkgICAgIGJvb2wgc2hhcmVkKQogewotCXN0cnVj
dCBkbWFfcmVzdl9saXN0ICpmbGlzdDsKLQlzdHJ1Y3QgZG1hX2ZlbmNlICpmOworCXN0cnVjdCBk
bWFfZmVuY2VfYXJyYXlfY3Vyc29yIGN1cnNvcjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmLCAqcmVh
ZGVyczsKIAlzdHJ1Y3QgcmFkZW9uX2ZlbmNlICpmZW5jZTsKLQl1bnNpZ25lZCBpOwogCWludCBy
ID0gMDsKIAogCS8qIGFsd2F5cyBzeW5jIHRvIHRoZSBleGNsdXNpdmUgZmVuY2UgKi8KQEAgLTEw
NCwxMyArMTA0LDExIEBAIGludCByYWRlb25fc3luY19yZXN2KHN0cnVjdCByYWRlb25fZGV2aWNl
ICpyZGV2LAogCWVsc2UgaWYgKGYpCiAJCXIgPSBkbWFfZmVuY2Vfd2FpdChmLCB0cnVlKTsKIAot
CWZsaXN0ID0gZG1hX3Jlc3ZfZ2V0X2xpc3QocmVzdik7Ci0JaWYgKHNoYXJlZCB8fCAhZmxpc3Qg
fHwgcikKKwlpZiAoc2hhcmVkIHx8IHIpCiAJCXJldHVybiByOwogCi0JZm9yIChpID0gMDsgaSA8
IGZsaXN0LT5zaGFyZWRfY291bnQ7ICsraSkgewotCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3Rl
Y3RlZChmbGlzdC0+c2hhcmVkW2ldLAotCQkJCQkgICAgICBkbWFfcmVzdl9oZWxkKHJlc3YpKTsK
KwlyZWFkZXJzID0gZG1hX3Jlc3ZfZmVuY2VzX2RlcmVmKHJlc3YsICZyZXN2LT5yZWFkZXJzKTsK
KwlkbWFfZmVuY2VfYXJyYXlfZm9yX2VhY2goZiwgY3Vyc29yLCByZWFkZXJzKSB7CiAJCWZlbmNl
ID0gdG9fcmFkZW9uX2ZlbmNlKGYpOwogCQlpZiAoZmVuY2UgJiYgZmVuY2UtPnJkZXYgPT0gcmRl
dikKIAkJCXJhZGVvbl9zeW5jX2ZlbmNlKHN5bmMsIGZlbmNlKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3Jh
ZGVvbl92bS5jCmluZGV4IGUwYWQ1NDc3ODZlOC4uYzRjNDc0ZTI4M2JkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl92bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9y
YWRlb24vcmFkZW9uX3ZtLmMKQEAgLTgyNiwxMiArODI2LDEzIEBAIHN0YXRpYyBpbnQgcmFkZW9u
X3ZtX3VwZGF0ZV9wdGVzKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2LAogCWZvciAoYWRkciA9
IHN0YXJ0OyBhZGRyIDwgZW5kOyApIHsKIAkJdWludDY0X3QgcHRfaWR4ID0gYWRkciA+PiByYWRl
b25fdm1fYmxvY2tfc2l6ZTsKIAkJc3RydWN0IHJhZGVvbl9ibyAqcHQgPSB2bS0+cGFnZV90YWJs
ZXNbcHRfaWR4XS5ibzsKKwkJc3RydWN0IGRtYV9yZXN2ICpyZXN2ID0gcHQtPnRiby5iYXNlLnJl
c3Y7CiAJCXVuc2lnbmVkIG5wdGVzOwogCQl1aW50NjRfdCBwdGU7CiAJCWludCByOwogCiAJCXJh
ZGVvbl9zeW5jX3Jlc3YocmRldiwgJmliLT5zeW5jLCBwdC0+dGJvLmJhc2UucmVzdiwgdHJ1ZSk7
Ci0JCXIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZChwdC0+dGJvLmJhc2UucmVzdiwgMSk7CisJ
CXIgPSBkbWFfcmVzdl9mZW5jZXNfcmVzZXJ2ZShyZXN2LCAmcmVzdi0+cmVhZGVycywgMSk7CiAJ
CWlmIChyKQogCQkJcmV0dXJuIHI7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCmluZGV4IGY3OGY1MmNjMmU2
ZC4uMTllZWVmYmJiNjVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKQEAgLTQ1MywyMiArNDUzLDE1IEBA
IHN0YXRpYyBpbnQgdHRtX2JvX2luZGl2aWR1YWxpemVfcmVzdihzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvKQogCiBzdGF0aWMgdm9pZCB0dG1fYm9fZmx1c2hfYWxsX2ZlbmNlcyhzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvKQogewotCXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmb2JqOwog
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwotCWludCBpOwogCi0JZm9iaiA9IGRtYV9yZXN2X2dl
dF9saXN0KCZiby0+YmFzZS5fcmVzdik7CiAJZmVuY2UgPSBkbWFfcmVzdl9nZXRfZXhjbCgmYm8t
PmJhc2UuX3Jlc3YpOwogCWlmIChmZW5jZSAmJiAhZmVuY2UtPm9wcy0+c2lnbmFsZWQpCiAJCWRt
YV9mZW5jZV9lbmFibGVfc3dfc2lnbmFsaW5nKGZlbmNlKTsKIAotCWZvciAoaSA9IDA7IGZvYmog
JiYgaSA8IGZvYmotPnNoYXJlZF9jb3VudDsgKytpKSB7Ci0JCWZlbmNlID0gcmN1X2RlcmVmZXJl
bmNlX3Byb3RlY3RlZChmb2JqLT5zaGFyZWRbaV0sCi0JCQkJCWRtYV9yZXN2X2hlbGQoYm8tPmJh
c2UucmVzdikpOwotCi0JCWlmICghZmVuY2UtPm9wcy0+c2lnbmFsZWQpCi0JCQlkbWFfZmVuY2Vf
ZW5hYmxlX3N3X3NpZ25hbGluZyhmZW5jZSk7Ci0JfQorCWZlbmNlID0gZG1hX3Jlc3ZfZmVuY2Vz
X2RlcmVmKCZiby0+YmFzZS5fcmVzdiwgJmJvLT5iYXNlLl9yZXN2LnJlYWRlcnMpOworCWlmIChm
ZW5jZSAmJiAhZmVuY2UtPm9wcy0+c2lnbmFsZWQpCisJCWRtYV9mZW5jZV9lbmFibGVfc3dfc2ln
bmFsaW5nKGZlbmNlKTsKIH0KIAogc3RhdGljIHZvaWQgdHRtX2JvX2NsZWFudXBfcmVmc19vcl9x
dWV1ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQpAQCAtOTMyLDkgKzkyNSwxMSBAQCBz
dGF0aWMgaW50IHR0bV9ib19hZGRfbW92ZV9mZW5jZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvLAogCXNwaW5fdW5sb2NrKCZtYW4tPm1vdmVfbG9jayk7CiAKIAlpZiAoZmVuY2UpIHsKLQkJ
ZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZShiby0+YmFzZS5yZXN2LCBmZW5jZSk7CisJCXN0cnVj
dCBkbWFfcmVzdiAqcmVzdiA9IGJvLT5iYXNlLnJlc3Y7CisKKwkJZG1hX3Jlc3ZfZmVuY2VzX2Fk
ZCgmcmVzdi0+cmVhZGVycywgZmVuY2UpOwogCi0JCXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hh
cmVkKGJvLT5iYXNlLnJlc3YsIDEpOworCQlyZXQgPSBkbWFfcmVzdl9mZW5jZXNfcmVzZXJ2ZShy
ZXN2LCAmcmVzdi0+cmVhZGVycywgMSk7CiAJCWlmICh1bmxpa2VseShyZXQpKSB7CiAJCQlkbWFf
ZmVuY2VfcHV0KGZlbmNlKTsKIAkJCXJldHVybiByZXQ7CkBAIC0xMDkxLDcgKzEwODYsOCBAQCBp
bnQgdHRtX2JvX21lbV9zcGFjZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCWJvb2wg
dHlwZV9mb3VuZCA9IGZhbHNlOwogCWludCBpLCByZXQ7CiAKLQlyZXQgPSBkbWFfcmVzdl9yZXNl
cnZlX3NoYXJlZChiby0+YmFzZS5yZXN2LCAxKTsKKwlyZXQgPSBkbWFfcmVzdl9mZW5jZXNfcmVz
ZXJ2ZShiby0+YmFzZS5yZXN2LAorCQkJCSAgICAgICZiby0+YmFzZS5yZXN2LT5yZWFkZXJzLCAx
KTsKIAlpZiAodW5saWtlbHkocmV0KSkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9leGVjYnVmX3V0aWwuYwppbmRleCAxMzFkYWU4ZjQxNzAuLmI5YTI3NzhkZjY3YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKQEAgLTEzMCw4ICsxMzAsOSBAQCBp
bnQgdHRtX2V1X3Jlc2VydmVfYnVmZmVycyhzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKnRpY2tldCwK
IAkJCWlmICghZW50cnktPm51bV9zaGFyZWQpCiAJCQkJY29udGludWU7CiAKLQkJCXJldCA9IGRt
YV9yZXN2X3Jlc2VydmVfc2hhcmVkKGJvLT5iYXNlLnJlc3YsCi0JCQkJCQkJCWVudHJ5LT5udW1f
c2hhcmVkKTsKKwkJCXJldCA9IGRtYV9yZXN2X2ZlbmNlc19yZXNlcnZlKGJvLT5iYXNlLnJlc3Ys
CisJCQkJCQkgICAgICAmYm8tPmJhc2UucmVzdi0+cmVhZGVycywKKwkJCQkJCSAgICAgIGVudHJ5
LT5udW1fc2hhcmVkKTsKIAkJCWlmICghcmV0KQogCQkJCWNvbnRpbnVlOwogCQl9CkBAIC0xNTMs
OCArMTU0LDkgQEAgaW50IHR0bV9ldV9yZXNlcnZlX2J1ZmZlcnMoc3RydWN0IHd3X2FjcXVpcmVf
Y3R4ICp0aWNrZXQsCiAJCX0KIAogCQlpZiAoIXJldCAmJiBlbnRyeS0+bnVtX3NoYXJlZCkKLQkJ
CXJldCA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKGJvLT5iYXNlLnJlc3YsCi0JCQkJCQkJCWVu
dHJ5LT5udW1fc2hhcmVkKTsKKwkJCXJldCA9IGRtYV9yZXN2X2ZlbmNlc19yZXNlcnZlKGJvLT5i
YXNlLnJlc3YsCisJCQkJCQkgICAgICAmYm8tPmJhc2UucmVzdi0+cmVhZGVycywKKwkJCQkJCSAg
ICAgIGVudHJ5LT5udW1fc2hhcmVkKTsKIAogCQlpZiAodW5saWtlbHkocmV0ICE9IDApKSB7CiAJ
CQlpZiAocmV0ID09IC1FSU5UUikKQEAgLTIwMSw3ICsyMDMsNyBAQCB2b2lkIHR0bV9ldV9mZW5j
ZV9idWZmZXJfb2JqZWN0cyhzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKnRpY2tldCwKIAlsaXN0X2Zv
cl9lYWNoX2VudHJ5KGVudHJ5LCBsaXN0LCBoZWFkKSB7CiAJCWJvID0gZW50cnktPmJvOwogCQlp
ZiAoZW50cnktPm51bV9zaGFyZWQpCi0JCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKGJvLT5i
YXNlLnJlc3YsIGZlbmNlKTsKKwkJCWRtYV9yZXN2X2ZlbmNlc19hZGQoJmJvLT5iYXNlLnJlc3Yt
PnJlYWRlcnMsIGZlbmNlKTsKIAkJZWxzZQogCQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UoYm8t
PmJhc2UucmVzdiwgZmVuY2UpOwogCQlpZiAobGlzdF9lbXB0eSgmYm8tPmxydSkpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS92YzQv
dmM0X2dlbS5jCmluZGV4IDdhMDZjYjZlMzFjNS4uMjUzZjgzMmMyOWQ1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmM0L3Zj
NF9nZW0uYwpAQCAtNTQzLDcgKzU0Myw3IEBAIHZjNF91cGRhdGVfYm9fc2Vxbm9zKHN0cnVjdCB2
YzRfZXhlY19pbmZvICpleGVjLCB1aW50NjRfdCBzZXFubykKIAkJYm8gPSB0b192YzRfYm8oJmV4
ZWMtPmJvW2ldLT5iYXNlKTsKIAkJYm8tPnNlcW5vID0gc2Vxbm87CiAKLQkJZG1hX3Jlc3ZfYWRk
X3NoYXJlZF9mZW5jZShiby0+YmFzZS5iYXNlLnJlc3YsIGV4ZWMtPmZlbmNlKTsKKwkJZG1hX3Jl
c3ZfZmVuY2VzX2FkZCgmYm8tPmJhc2UuYmFzZS5yZXN2LT5yZWFkZXJzLCBleGVjLT5mZW5jZSk7
CiAJfQogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShibywgJmV4ZWMtPnVucmVmX2xpc3QsIHVucmVm
X2hlYWQpIHsKQEAgLTY0Miw3ICs2NDIsNyBAQCB2YzRfbG9ja19ib19yZXNlcnZhdGlvbnMoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwKIAlmb3IgKGkgPSAwOyBpIDwgZXhlYy0+Ym9fY291bnQ7IGkr
KykgewogCQlibyA9ICZleGVjLT5ib1tpXS0+YmFzZTsKIAotCQlyZXQgPSBkbWFfcmVzdl9yZXNl
cnZlX3NoYXJlZChiby0+cmVzdiwgMSk7CisJCXJldCA9IGRtYV9yZXN2X2ZlbmNlc19yZXNlcnZl
KCZiby0+cmVzdi0+cmVhZGVycywgMSk7CiAJCWlmIChyZXQpIHsKIAkJCXZjNF91bmxvY2tfYm9f
cmVzZXJ2YXRpb25zKGRldiwgZXhlYywgYWNxdWlyZV9jdHgpOwogCQkJcmV0dXJuIHJldDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92Z2VtL3ZnZW1fZmVuY2UuYyBiL2RyaXZlcnMvZ3B1
L2RybS92Z2VtL3ZnZW1fZmVuY2UuYwppbmRleCA5MjY4ZjZmYzNmNjYuLmRlZWVmM2Q0ZGViYSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZnZW0vdmdlbV9mZW5jZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS92Z2VtL3ZnZW1fZmVuY2UuYwpAQCAtMTYyLDggKzE2Miw4IEBAIGludCB2Z2Vt
X2ZlbmNlX2F0dGFjaF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWRtYV9yZXN2X2xv
Y2socmVzdiwgTlVMTCk7CiAJaWYgKGFyZy0+ZmxhZ3MgJiBWR0VNX0ZFTkNFX1dSSVRFKQogCQlk
bWFfcmVzdl9hZGRfZXhjbF9mZW5jZShyZXN2LCBmZW5jZSk7Ci0JZWxzZSBpZiAoKHJldCA9IGRt
YV9yZXN2X3Jlc2VydmVfc2hhcmVkKHJlc3YsIDEpKSA9PSAwKQotCQlkbWFfcmVzdl9hZGRfc2hh
cmVkX2ZlbmNlKHJlc3YsIGZlbmNlKTsKKwllbHNlIGlmICgocmV0ID0gZG1hX3Jlc3ZfZmVuY2Vz
X3Jlc2VydmUocmVzdiwgJnJlc3YtPnJlYWRlcnMsIDEpKSA9PSAwKQorCQlkbWFfcmVzdl9mZW5j
ZXNfYWRkKCZyZXN2LT5yZWFkZXJzLCBmZW5jZSk7CiAJZG1hX3Jlc3ZfdW5sb2NrKHJlc3YpOwog
CiAJLyogUmVjb3JkIHRoZSBmZW5jZSBpbiBvdXIgaWRyIGZvciBsYXRlciBzaWduYWxpbmcgKi8K
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaCBiL2luY2x1ZGUvbGludXgvZG1h
LXJlc3YuaAppbmRleCBjNzBmMTNmYTY3ODkuLmIyM2UxNjk3NWYzOSAxMDA2NDQKLS0tIGEvaW5j
bHVkZS9saW51eC9kbWEtcmVzdi5oCisrKyBiL2luY2x1ZGUvbGludXgvZG1hLXJlc3YuaApAQCAt
NzIsMzIgKzcyLDE5IEBAIHZvaWQgZG1hX3Jlc3ZfZmVuY2VzX2FkZChzdHJ1Y3QgZG1hX3Jlc3Zf
ZmVuY2VzICpmZW5jZXMsCiB2b2lkIGRtYV9yZXN2X2ZlbmNlc19jb21taXQoc3RydWN0IGRtYV9y
ZXN2ICpvYmosCiAJCQkgICAgc3RydWN0IGRtYV9yZXN2X2ZlbmNlcyAqZmVuY2VzKTsKIAotLyoq
Ci0gKiBzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCAtIGEgbGlzdCBvZiBzaGFyZWQgZmVuY2VzCi0gKiBA
cmN1OiBmb3IgaW50ZXJuYWwgdXNlCi0gKiBAc2hhcmVkX2NvdW50OiB0YWJsZSBvZiBzaGFyZWQg
ZmVuY2VzCi0gKiBAc2hhcmVkX21heDogZm9yIGdyb3dpbmcgc2hhcmVkIGZlbmNlIHRhYmxlCi0g
KiBAc2hhcmVkOiBzaGFyZWQgZmVuY2UgdGFibGUKLSAqLwotc3RydWN0IGRtYV9yZXN2X2xpc3Qg
ewotCXN0cnVjdCByY3VfaGVhZCByY3U7Ci0JdTMyIHNoYXJlZF9jb3VudCwgc2hhcmVkX21heDsK
LQlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpzaGFyZWRbXTsKLX07Ci0KIC8qKgogICogc3RydWN0
IGRtYV9yZXN2IC0gYSByZXNlcnZhdGlvbiBvYmplY3QgbWFuYWdlcyBmZW5jZXMgZm9yIGEgYnVm
ZmVyCiAgKiBAbG9jazogdXBkYXRlIHNpZGUgbG9jawogICogQHNlcTogc2VxdWVuY2UgY291bnQg
Zm9yIG1hbmFnaW5nIFJDVSByZWFkLXNpZGUgc3luY2hyb25pemF0aW9uCiAgKiBAZmVuY2VfZXhj
bDogdGhlIGV4Y2x1c2l2ZSBmZW5jZSwgaWYgdGhlcmUgaXMgb25lIGN1cnJlbnRseQotICogQGZl
bmNlOiBsaXN0IG9mIGN1cnJlbnQgc2hhcmVkIGZlbmNlcworICogQHJlYWRlcnM6IGFycmF5IG9m
IHJlYWQgb3BlcmF0aW9ucyBmb3IgaW1wbGljaXQgc3luYwogICovCiBzdHJ1Y3QgZG1hX3Jlc3Yg
ewogCXN0cnVjdCB3d19tdXRleCBsb2NrOwogCXNlcWNvdW50X3Qgc2VxOwogCiAJc3RydWN0IGRt
YV9mZW5jZSBfX3JjdSAqZmVuY2VfZXhjbDsKLQlzdHJ1Y3QgZG1hX3Jlc3ZfbGlzdCBfX3JjdSAq
ZmVuY2U7CisJc3RydWN0IGRtYV9yZXN2X2ZlbmNlcwlyZWFkZXJzOwogfTsKIAogI2RlZmluZSBk
bWFfcmVzdl9oZWxkKG9iaikgbG9ja2RlcF9pc19oZWxkKCYob2JqKS0+bG9jay5iYXNlKQpAQCAt
MTI5LDIwICsxMTYsNiBAQCBkbWFfcmVzdl9mZW5jZXNfZ2V0X3JjdShzdHJ1Y3QgZG1hX3Jlc3Zf
ZmVuY2VzICpmZW5jZXMpCiAJcmV0dXJuIGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJmZlbmNlcy0+
ZmVuY2UpOwogfQogCi0vKioKLSAqIGRtYV9yZXN2X2dldF9saXN0IC0gZ2V0IHRoZSByZXNlcnZh
dGlvbiBvYmplY3QncwotICogc2hhcmVkIGZlbmNlIGxpc3QsIHdpdGggdXBkYXRlLXNpZGUgbG9j
ayBoZWxkCi0gKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0Ci0gKgotICogUmV0dXJucyB0
aGUgc2hhcmVkIGZlbmNlIGxpc3QuICBEb2VzIE5PVCB0YWtlIHJlZmVyZW5jZXMgdG8KLSAqIHRo
ZSBmZW5jZS4gIFRoZSBvYmotPmxvY2sgbXVzdCBiZSBoZWxkLgotICovCi1zdGF0aWMgaW5saW5l
IHN0cnVjdCBkbWFfcmVzdl9saXN0ICpkbWFfcmVzdl9nZXRfbGlzdChzdHJ1Y3QgZG1hX3Jlc3Yg
Km9iaikKLXsKLQlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChvYmotPmZlbmNlLAot
CQkJCQkgZG1hX3Jlc3ZfaGVsZChvYmopKTsKLX0KLQogLyoqCiAgKiBkbWFfcmVzdl9sb2NrIC0g
bG9jayB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CiAgKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2Jq
ZWN0CkBAIC0yNjYsMTQgKzIzOSw3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHd3X2FjcXVpcmVf
Y3R4ICpkbWFfcmVzdl9sb2NraW5nX2N0eChzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikKICAqLwogc3Rh
dGljIGlubGluZSB2b2lkIGRtYV9yZXN2X3VubG9jayhzdHJ1Y3QgZG1hX3Jlc3YgKm9iaikKIHsK
LSNpZmRlZiBDT05GSUdfREVCVUdfTVVURVhFUwotCS8qIFRlc3Qgc2hhcmVkIGZlbmNlIHNsb3Qg
cmVzZXJ2YXRpb24gKi8KLQlpZiAocmN1X2FjY2Vzc19wb2ludGVyKG9iai0+ZmVuY2UpKSB7Ci0J
CXN0cnVjdCBkbWFfcmVzdl9saXN0ICpmZW5jZSA9IGRtYV9yZXN2X2dldF9saXN0KG9iaik7Ci0K
LQkJZmVuY2UtPnNoYXJlZF9tYXggPSBmZW5jZS0+c2hhcmVkX2NvdW50OwotCX0KLSNlbmRpZgor
CWRtYV9yZXN2X2ZlbmNlc19jb21taXQob2JqLCAmb2JqLT5yZWFkZXJzKTsKIAl3d19tdXRleF91
bmxvY2soJm9iai0+bG9jayk7CiB9CiAKQEAgLTMyNCw4ICsyOTAsNiBAQCBkbWFfcmVzdl9nZXRf
ZXhjbF9yY3Uoc3RydWN0IGRtYV9yZXN2ICpvYmopCiAKIHZvaWQgZG1hX3Jlc3ZfaW5pdChzdHJ1
Y3QgZG1hX3Jlc3YgKm9iaik7CiB2b2lkIGRtYV9yZXN2X2Zpbmkoc3RydWN0IGRtYV9yZXN2ICpv
YmopOwotaW50IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHN0cnVjdCBkbWFfcmVzdiAqb2JqLCB1
bnNpZ25lZCBpbnQgbnVtX2ZlbmNlcyk7Ci12b2lkIGRtYV9yZXN2X2FkZF9zaGFyZWRfZmVuY2Uo
c3RydWN0IGRtYV9yZXN2ICpvYmosIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogdm9pZCBk
bWFfcmVzdl9hZGRfZXhjbF9mZW5jZShzdHJ1Y3QgZG1hX3Jlc3YgKm9iaiwgc3RydWN0IGRtYV9m
ZW5jZSAqZmVuY2UpOwogdm9pZCBkbWFfcmVzdl9wcnVuZV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2
ICpvYmopOwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWw=
