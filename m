Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2B66AD70F4
	for <lists+dri-devel@lfdr.de>; Tue, 15 Oct 2019 10:28:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B86616E632;
	Tue, 15 Oct 2019 08:28:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lf1-x141.google.com (mail-lf1-x141.google.com
 [IPv6:2a00:1450:4864:20::141])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C1F766E632
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 08:28:23 +0000 (UTC)
Received: by mail-lf1-x141.google.com with SMTP id w67so13788277lff.4
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 01:28:23 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=TqyXsc6PlVzrcPKyygecv+nh/Spcb5WfABEp5L+UujQ=;
 b=Zdn2ahQyxhH9fj+sCfzVZZPDN5Cl+eBcNPC8J3oiw6mOC09duYaepUmX9Yo3xTGEvU
 q3uMgrHoe9ubSU0CIosZBhiBQhcVPxrJ4H/2A9qXfMxVg1iDg6IaiJaEesnUQ6N7N2Th
 /4kuaabBASA3ihyRhaBkShh1drlYpceLZQO/P5WE+YJVEiWes6o3IfkU1WRUCmtY8CwS
 34EQrxBs14x551wkb9/g12dTUYCg/mTXXdr5Q2fs0b3urwjtuBbpajYo4qohmgJ8mMqj
 sSwIcazc+E6ZVKeZpCWM5lOCRrh0xmy9Lj0fufwop8l8S4hZAbbpSi4SAQk4DhCnaP38
 QiJg==
X-Gm-Message-State: APjAAAWn/7OJ3AOW0sy65gCI4od2BG3HL6l9ez3XogDxzv6ShFJjgn45
 /IFrp8oUf3ILZK6pJ7BLjd/yUg==
X-Google-Smtp-Source: APXvYqx2qj0pRf2vxKQnn1wJtQ/lv/Io3Wh6vxRWjmRhj7444an8wWYjNtq7uGCz7ROtcu28KFu26A==
X-Received: by 2002:ac2:5986:: with SMTP id w6mr20689070lfn.120.1571128101721; 
 Tue, 15 Oct 2019 01:28:21 -0700 (PDT)
Received: from genomnajs.ideon.se ([85.235.10.227])
 by smtp.gmail.com with ESMTPSA id y3sm4795141lji.53.2019.10.15.01.28.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 15 Oct 2019 01:28:20 -0700 (PDT)
From: Linus Walleij <linus.walleij@linaro.org>
To: Thierry Reding <thierry.reding@gmail.com>, Sam Ravnborg <sam@ravnborg.org>,
 dri-devel@lists.freedesktop.org
Subject: [PATCH 3/3 v2] drm/panel: Add driver for Sony ACX424AKP panel
Date: Tue, 15 Oct 2019 10:28:11 +0200
Message-Id: <20191015082811.29497-3-linus.walleij@linaro.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191015082811.29497-1-linus.walleij@linaro.org>
References: <20191015082811.29497-1-linus.walleij@linaro.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=TqyXsc6PlVzrcPKyygecv+nh/Spcb5WfABEp5L+UujQ=;
 b=YAFIaN5uCL8QM21RQAIrZr5DIv5fP5DXR3LhHI/bgXTkMJxJB7h8/gTF/8u0WSRDVM
 yCuchvOLVDi468OcCNzfWokUBblba/GFWricyHuVs2h23VcGfln/Q9nBKnyXbUxH6Ty9
 JWNHrFkgzLJxpw852GzNsWm7QkpPpDSCeZ9yrpWxwKPqAYHIJpCZxNLtpaqu/HSp/d0i
 1ksekk0/0RrTXKh8xe030nnmPvB/Qakhj0PrsPaEoSHKMGQYvmOVWxvgV5dCWNWhiZQO
 aUGlyh8PBeytaGc5FDiG1F8mimV3+wIhgWIgCsGHeWWYrEcx0i9y9iC0gfpy3Cf8Aunl
 ovig==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIFNvbnkgQUNYNDI0QUtQIGlzIGEgY29tbWFuZC92aWRlb21vZGUgRFNJIHBhbmVsIGZvcgpt
b2JpbGUgZGV2aWNlcy4gSXQgaXMgdXNlZCBvbiB0aGUgU1QtRXJpY3Nzb24gSFJFRjUyMApyZWZl
cmVuY2UgZGVzaWduLiBXZSBzdXBwb3J0IHZpZGVvIG1vZGUgYnkgZGVmYXVsdCwgYnV0Cml0IGlz
IHBvc3NpYmxlIHRvIHN3aXRjaCB0aGUgcGFuZWwgaW50byBjb21tYW5kIG1vZGUKYnkgdXNpbmcg
dGhlIGJvb2wgcHJvcGVydHkgImRzaS1jb21tYW5kLW1vZGUiLgoKU2lnbmVkLW9mZi1ieTogTGlu
dXMgV2FsbGVpaiA8bGludXMud2FsbGVpakBsaW5hcm8ub3JnPgotLS0KQ2hhbmdlTG9nIHYxLT52
MjoKLSBGaXggdXAgdGhlIElEIHJlYWQgZnVuY3Rpb24gdG8gc3BsaXQgaW50byByZWFkaW5nIGhl
YWRlciwKICB2ZXJzaW9uIGFuZCBJRCwgc3RvcmUgdGhlIHZlcnNpb24gaW4gdGhlIHN0cnVjdC4K
LSBHZXQgcmlkIG9mIGEgc3VycGx1cyBzZW1pY29sb24gZm91bmQgYnkgdGhlIGJ1aWxkIHJvYm90
CiAgd2hpbGUgcmV3cml0aW5nIHRoZSBhYm92ZSBjb2RlLgotIFVzZSB1bnNpZ25lZCBpbnQgaW4g
cHJvYmUoKSBsb29wLgotIFNldCB2cmVmcmVzaCB0byA2MEh6LCBhcyBnb29kIGFzIGFueSwgdGhl
IG1lYXN1cmVkIHZyZWZyZXNoCiAgaW4gY29udGlub3VzIGNvbW1hbmQgbW9kZSBpcyB+MTE3IEh6
LgotIFVzZSBhIGRpZmZlcmVudCBmb3IoKSBpZGlvbSB3aGlsZSByZXRyeWluZyB0byByZWFkIElE
CiAgNSB0aW1lcy4KLSBEcm9wIHRoZSBzeW5jIHB1bHNlIHNldHRpbmcsIHdlIGFyZSBub3QgdXNp
bmcgdGhpcywgdGhpcwogIHBhbmVsIHVzZXMgYW4gZXZlbnQuCi0gVXNlIHRoZSBnZW5lcmljICJl
bmZvcmNlLXZpZGVvLW1vZGUiIGZvciB2aWRlbyBtb2RlCiAgZW5mb3JjZW1lbnQuCi0tLQogZHJp
dmVycy9ncHUvZHJtL3BhbmVsL0tjb25maWcgICAgICAgICAgICAgICAgfCAgIDcgKwogZHJpdmVy
cy9ncHUvZHJtL3BhbmVsL01ha2VmaWxlICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9n
cHUvZHJtL3BhbmVsL3BhbmVsLXNvbnktYWN4NDI0YWtwLmMgfCA1NDIgKysrKysrKysrKysrKysr
KysrKwogaW5jbHVkZS92aWRlby9taXBpX2Rpc3BsYXkuaCAgICAgICAgICAgICAgICAgfCAgIDEg
KwogNCBmaWxlcyBjaGFuZ2VkLCA1NTEgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFjeDQyNGFrcC5jCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3BhbmVsL0tjb25maWcgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwv
S2NvbmZpZwppbmRleCBmMTUyYmM0ZWViNTMuLjk1OWRmNWJlYTdkMiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3BhbmVsL0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL0tj
b25maWcKQEAgLTMxNiw2ICszMTYsMTMgQEAgY29uZmlnIERSTV9QQU5FTF9TSVRST05JWF9TVDc3
ODlWCiAJICBTYXkgWSBoZXJlIGlmIHlvdSB3YW50IHRvIGVuYWJsZSBzdXBwb3J0IGZvciB0aGUg
U2l0cm9uaXgKIAkgIFNUNzc4OVYgY29udHJvbGxlciBmb3IgMjQweDMyMCBMQ0QgcGFuZWxzCiAK
K2NvbmZpZyBEUk1fUEFORUxfU09OWV9BQ1g0MjRBS1AKKwl0cmlzdGF0ZSAiU29ueSBBQ1g0MjRB
S1AgRFNJIGNvbW1hbmQgbW9kZSBwYW5lbCIKKwlkZXBlbmRzIG9uIE9GCisJZGVwZW5kcyBvbiBE
Uk1fTUlQSV9EU0kKKwlkZXBlbmRzIG9uIEJBQ0tMSUdIVF9DTEFTU19ERVZJQ0UKKwlzZWxlY3Qg
VklERU9NT0RFX0hFTFBFUlMKKwogY29uZmlnIERSTV9QQU5FTF9TT05ZX0FDWDU2NUFLTQogCXRy
aXN0YXRlICJTb255IEFDWDU2NUFLTSBwYW5lbCIKIAlkZXBlbmRzIG9uIEdQSU9MSUIgJiYgT0Yg
JiYgU1BJCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUKaW5kZXggYjZjZDM5ZmUwZjIwLi4wYjUxNzkzZTNi
NDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUKQEAgLTMzLDYgKzMzLDcgQEAgb2JqLSQoQ09ORklH
X0RSTV9QQU5FTF9TSEFSUF9MUzAzN1Y3RFcwMSkgKz0gcGFuZWwtc2hhcnAtbHMwMzd2N2R3MDEu
bwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9TSEFSUF9MUzA0M1QxTEUwMSkgKz0gcGFuZWwtc2hh
cnAtbHMwNDN0MWxlMDEubwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9TSVRST05JWF9TVDc3MDEp
ICs9IHBhbmVsLXNpdHJvbml4LXN0NzcwMS5vCiBvYmotJChDT05GSUdfRFJNX1BBTkVMX1NJVFJP
TklYX1NUNzc4OVYpICs9IHBhbmVsLXNpdHJvbml4LXN0Nzc4OXYubworb2JqLSQoQ09ORklHX0RS
TV9QQU5FTF9TT05ZX0FDWDQyNEFLUCkgKz0gcGFuZWwtc29ueS1hY3g0MjRha3Aubwogb2JqLSQo
Q09ORklHX0RSTV9QQU5FTF9TT05ZX0FDWDU2NUFLTSkgKz0gcGFuZWwtc29ueS1hY3g1NjVha20u
bwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9UUE9fVEQwMjhUVEVDMSkgKz0gcGFuZWwtdHBvLXRk
MDI4dHRlYzEubwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9UUE9fVEQwNDNNVEVBMSkgKz0gcGFu
ZWwtdHBvLXRkMDQzbXRlYTEubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmVsL3Bh
bmVsLXNvbnktYWN4NDI0YWtwLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtc29ueS1h
Y3g0MjRha3AuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjk2YTE0
NTBiNjk5ZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1z
b255LWFjeDQyNGFrcC5jCkBAIC0wLDAgKzEsNTQyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMCsKKy8qCisgKiBNSVBJLURTSSBTb255IEFDWDQyNEFLUCBwYW5lbCBkcml2
ZXIuIFRoaXMgaXMgYSA0ODB4ODY0CisgKiBBTU9MRUQgcGFuZWwgd2l0aCBhIGNvbW1hbmQtb25s
eSBEU0kgaW50ZXJmYWNlLgorICoKKyAqIENvcHlyaWdodCAoQykgTGluYXJvIEx0ZC4gMjAxOQor
ICogQXV0aG9yOiBMaW51cyBXYWxsZWlqCisgKiBCYXNlZCBvbiBjb2RlIGFuZCBrbm93LWhvdyBm
cm9tIE1hcmN1cyBMb3JlbnR6b24KKyAqIENvcHlyaWdodCAoQykgU1QtRXJpY3Nzb24gU0EgMjAx
MAorICovCisKKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9t
aXBpX2RzaS5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGFuZWwuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X3ByaW50Lmg+CisjaW5jbHVkZSA8dmlkZW8vbWlwaV9kaXNwbGF5Lmg+CisKKyNpbmNsdWRlIDxs
aW51eC9ncGlvL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvcmVndWxhdG9yL2NvbnN1bWVy
Lmg+CisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2lu
Y2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L2JhY2tsaWdodC5oPgorCisj
ZGVmaW5lIEFDWDQyNF9EQ1NfUkVBRF9JRDEJCTB4REEKKyNkZWZpbmUgQUNYNDI0X0RDU19SRUFE
X0lEMgkJMHhEQgorI2RlZmluZSBBQ1g0MjRfRENTX1JFQURfSUQzCQkweERDCisKKyNkZWZpbmUg
RElTUExBWV9TT05ZX0FDWDQyNEFLUF9JRDEJMHg4MTFiCisjZGVmaW5lIERJU1BMQVlfU09OWV9B
Q1g0MjRBS1BfSUQyCTB4ODExYQorI2RlZmluZSBESVNQTEFZX1NPTllfQUNYNDI0QUtQX0lEMwkw
eDgwMDAKKworc3RydWN0IGFjeDQyNGFrcCB7CisJc3RydWN0IGRldmljZSAqZGV2OworCXN0cnVj
dCBkcm1fcGFuZWwgcGFuZWw7CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJsOworCXN0cnVj
dCByZWd1bGF0b3IgKnN1cHBseTsKKwlzdHJ1Y3QgZ3Bpb19kZXNjICpyZXNldF9ncGlvOworCXU4
IHZlcnNpb247CisJYm9vbCB2aWRlb19tb2RlOworfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlIHNvbnlfYWN4NDI0YWtwX3ZpZF9tb2RlID0geworCS5jbG9jayA9IDMz
MDAwMCwKKwkuaGRpc3BsYXkgPSA0ODAsCisJLmhzeW5jX3N0YXJ0ID0gNDgwICsgMTUsCisJLmhz
eW5jX2VuZCA9IDQ4MCArIDE1ICsgMCwKKwkuaHRvdGFsID0gNDgwICsgMTUgKyAwICsgMTUsCisJ
LnZkaXNwbGF5ID0gODY0LAorCS52c3luY19zdGFydCA9IDg2NCArIDE0LAorCS52c3luY19lbmQg
PSA4NjQgKyAxNCArIDEsCisJLnZ0b3RhbCA9IDg2NCArIDE0ICsgMSArIDExLAorCS52cmVmcmVz
aCA9IDYwLAorCS53aWR0aF9tbSA9IDQ4LAorCS5oZWlnaHRfbW0gPSA4NCwKKwkuZmxhZ3MgPSBE
Uk1fTU9ERV9GTEFHX1BWU1lOQywKK307CisKKy8qCisgKiBUaGUgdGltaW5ncyBhcmUgbm90IHZl
cnkgaGVscGZ1bCBhcyB0aGUgZGlzcGxheSBpcyB1c2VkIGluCisgKiBjb21tYW5kIG1vZGUgdXNp
bmcgdGhlIG1heGltdW0gSFMgZnJlcXVlbmN5LgorICovCitzdGF0aWMgY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgc29ueV9hY3g0MjRha3BfY21kX21vZGUgPSB7CisJLmNsb2NrID0gNDIw
MTYwLAorCS5oZGlzcGxheSA9IDQ4MCwKKwkuaHN5bmNfc3RhcnQgPSA0ODAgKyAxNTQsCisJLmhz
eW5jX2VuZCA9IDQ4MCArIDE1NCArIDE2LAorCS5odG90YWwgPSA0ODAgKyAxNTQgKyAxNiArIDMy
LAorCS52ZGlzcGxheSA9IDg2NCwKKwkudnN5bmNfc3RhcnQgPSA4NjQgKyAxLAorCS52c3luY19l
bmQgPSA4NjQgKyAxICsgMSwKKwkudnRvdGFsID0gODY0ICsgMSArIDEgKyAxLAorCS8qCisJICog
U29tZSBkZXNpcmVkIHJlZnJlc2ggcmF0ZSwgZXhwZXJpbWVudHMgYXQgdGhlIG1heGltdW0gInBp
eGVsIgorCSAqIGNsb2NrIHNwZWVkIChIUyBjbG9jayA0MjAgTUh6KSB5aWVsZHMgYXJvdW5kIDEx
N0h6LgorCSAqLworCS52cmVmcmVzaCA9IDYwLAorCS53aWR0aF9tbSA9IDQ4LAorCS5oZWlnaHRf
bW0gPSA4NCwKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGFjeDQyNGFrcCAqcGFuZWxfdG9f
YWN4NDI0YWtwKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXJldHVybiBjb250YWluZXJf
b2YocGFuZWwsIHN0cnVjdCBhY3g0MjRha3AsIHBhbmVsKTsKK30KKworI2RlZmluZSBGT1NDCQkJ
MjAgLyogMjBNaHogKi8KKyNkZWZpbmUgU0NBTEVfRkFDVE9SX05TX0RJVl9NSFoJMTAwMAorCitz
dGF0aWMgaW50IGFjeDQyNGFrcF9zZXRfYnJpZ2h0bmVzcyhzdHJ1Y3QgYmFja2xpZ2h0X2Rldmlj
ZSAqYmwpCit7CisJc3RydWN0IGFjeDQyNGFrcCAqYWN4ID0gYmxfZ2V0X2RhdGEoYmwpOworCXN0
cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaSA9IHRvX21pcGlfZHNpX2RldmljZShhY3gtPmRldik7
CisJaW50IHBlcmlvZF9ucyA9IDEwMjM7CisJaW50IGR1dHlfbnMgPSBibC0+cHJvcHMuYnJpZ2h0
bmVzczsKKwl1OCBwd21fcmF0aW87CisJdTggcHdtX2RpdjsKKwl1OCBwYXI7CisJaW50IHJldDsK
KworCS8qIENhbGN1bGF0ZSB0aGUgUFdNIGR1dHkgY3ljbGUgaW4gbi8yNTYncyAqLworCXB3bV9y
YXRpbyA9IG1heCgoKGR1dHlfbnMgKiAyNTYpIC8gcGVyaW9kX25zKSAtIDEsIDEpOworCXB3bV9k
aXYgPSBtYXgoMSwKKwkJICAgICAgKChGT1NDICogcGVyaW9kX25zKSAvIDI1NikgLworCQkgICAg
ICBTQ0FMRV9GQUNUT1JfTlNfRElWX01IWik7CisKKwkvKiBTZXQgdXAgUFdNIGR1dHljeWNsZSBP
TkUgYnl0ZSAoZGlmZmVycyBmcm9tIHRoZSBzdGFuZGFyZCkgKi8KKwlEUk1fREVWX0RFQlVHKGFj
eC0+ZGV2LCAiY2FsY3VsYXRlZCBkdXR5IGN5Y2xlICUwMnhcbiIsIHB3bV9yYXRpbyk7CisJcmV0
ID0gbWlwaV9kc2lfZGNzX3dyaXRlKGRzaSwgTUlQSV9EQ1NfU0VUX0RJU1BMQVlfQlJJR0hUTkVT
UywKKwkJCQkgJnB3bV9yYXRpbywgMSk7CisJaWYgKHJldCA8IDApIHsKKwkJRFJNX0RFVl9FUlJP
UihhY3gtPmRldiwKKwkJCSAgICAgICJmYWlsZWQgdG8gc2V0IGRpc3BsYXkgUFdNIHJhdGlvICgl
ZClcbiIsCisJCQkgICAgICByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCS8qCisJICogU2Vx
dWVuY2UgdG8gd3JpdGUgUFdNRElWOgorCSAqCWFkZHJlc3MJCWRhdGEKKwkgKgkweEYzCQkweEFB
ICAgQ01EMiBVbmxvY2sKKwkgKgkweDAwCQkweDAxICAgRW50ZXIgQ01EMiBwYWdlIDAKKwkgKgkw
WDdECQkweDAxICAgTm8gcmVsb2FkIE1UUCBvZiBDTUQyIFAxCisJICoJMHgyMgkJUFdNRElWCisJ
ICoJMHg3RgkJMHhBQSAgIENNRDIgcGFnZSAxIGxvY2sKKwkgKi8KKwlwYXIgPSAweGFhOworCXJl
dCA9IG1pcGlfZHNpX2Rjc193cml0ZShkc2ksIDB4ZjMsICZwYXIsIDEpOworCWlmIChyZXQgPCAw
KSB7CisJCURSTV9ERVZfRVJST1IoYWN4LT5kZXYsCisJCQkgICAgICAiZmFpbGVkIHRvIHVubG9j
ayBDTUQgMiAoJWQpXG4iLAorCQkJICAgICAgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisJcGFy
ID0gMHgwMTsKKwlyZXQgPSBtaXBpX2RzaV9kY3Nfd3JpdGUoZHNpLCAweDAwLCAmcGFyLCAxKTsK
KwlpZiAocmV0IDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2LAorCQkJICAgICAgImZh
aWxlZCB0byBlbnRlciBwYWdlIDEgKCVkKVxuIiwKKwkJCSAgICAgIHJldCk7CisJCXJldHVybiBy
ZXQ7CisJfQorCXBhciA9IDB4MDE7CisJcmV0ID0gbWlwaV9kc2lfZGNzX3dyaXRlKGRzaSwgMHg3
ZCwgJnBhciwgMSk7CisJaWYgKHJldCA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihhY3gtPmRldiwK
KwkJCSAgICAgICJmYWlsZWQgdG8gZGlzYWJsZSBNVFAgcmVsb2FkICglZClcbiIsCisJCQkgICAg
ICByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKwlyZXQgPSBtaXBpX2RzaV9kY3Nfd3JpdGUoZHNp
LCAweDIyLCAmcHdtX2RpdiwgMSk7CisJaWYgKHJldCA8IDApIHsKKwkJRFJNX0RFVl9FUlJPUihh
Y3gtPmRldiwKKwkJCSAgICAgICJmYWlsZWQgdG8gc2V0IFBXTSBkaXZpc29yICglZClcbiIsCisJ
CQkgICAgICByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKwlwYXIgPSAweGFhOworCXJldCA9IG1p
cGlfZHNpX2Rjc193cml0ZShkc2ksIDB4N2YsICZwYXIsIDEpOworCWlmIChyZXQgPCAwKSB7CisJ
CURSTV9ERVZfRVJST1IoYWN4LT5kZXYsCisJCQkgICAgICAiZmFpbGVkIHRvIGxvY2sgQ01EIDIg
KCVkKVxuIiwKKwkJCSAgICAgIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCisJLyogRW5hYmxl
IGJhY2tsaWdodCAqLworCXBhciA9IDB4MjQ7CisJcmV0ID0gbWlwaV9kc2lfZGNzX3dyaXRlKGRz
aSwgTUlQSV9EQ1NfV1JJVEVfQ09OVFJPTF9ESVNQTEFZLAorCQkJCSAmcGFyLCAxKTsKKwlpZiAo
cmV0IDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2LAorCQkJICAgICAgImZhaWxlZCB0
byBlbmFibGUgZGlzcGxheSBiYWNrbGlnaHQgKCVkKVxuIiwKKwkJCSAgICAgIHJldCk7CisJCXJl
dHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgYmFj
a2xpZ2h0X29wcyBhY3g0MjRha3BfYmxfb3BzID0geworCS51cGRhdGVfc3RhdHVzID0gYWN4NDI0
YWtwX3NldF9icmlnaHRuZXNzLAorfTsKKworc3RhdGljIGludCBhY3g0MjRha3BfcmVhZF9pZChz
dHJ1Y3QgYWN4NDI0YWtwICphY3gpCit7CisJc3RydWN0IG1pcGlfZHNpX2RldmljZSAqZHNpID0g
dG9fbWlwaV9kc2lfZGV2aWNlKGFjeC0+ZGV2KTsKKwl1OCBoZWFkZXIsIHZlcnNpb24sIGlkOwor
CXUxNiB2YWw7CisJaW50IHJldDsKKworCXJldCA9IG1pcGlfZHNpX2Rjc19yZWFkKGRzaSwgQUNY
NDI0X0RDU19SRUFEX0lEMSwgJmhlYWRlciwgMSk7CisJaWYgKHJldCA8IDApIHsKKwkJRFJNX0RF
Vl9FUlJPUihhY3gtPmRldiwgImNvdWxkIG5vdCByZWFkIElEIGhlYWRlciBieXRlXG4iKTsKKwkJ
cmV0dXJuIHJldDsKKwl9CisJcmV0ID0gbWlwaV9kc2lfZGNzX3JlYWQoZHNpLCBBQ1g0MjRfRENT
X1JFQURfSUQyLCAmaWQsIDEpOworCWlmIChyZXQgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoYWN4
LT5kZXYsICJjb3VsZCBub3QgcmVhZCBkZXZpY2UgSUQgYnl0ZVxuIik7CisJCXJldHVybiByZXQ7
CisJfQorCXJldCA9IG1pcGlfZHNpX2Rjc19yZWFkKGRzaSwgQUNYNDI0X0RDU19SRUFEX0lEMywg
JnZlcnNpb24sIDEpOworCWlmIChyZXQgPCAwKSB7CisJCURSTV9ERVZfRVJST1IoYWN4LT5kZXYs
ICJjb3VsZCBub3QgcmVhZCB2ZXJzaW9uIGJ5dGVcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKwor
CWlmIChoZWFkZXIgPT0gMHgwMCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2LCAiZGV2aWNl
IElEIGhlYWRlciBpcyB6ZXJvXG4iKTsKKwkJcmV0dXJuIC1FTk9ERVY7CisJfQorCisJdmFsID0g
KGlkIDw8IDgpIHwgdmVyc2lvbjsKKwlzd2l0Y2ggKHZhbCkgeworCWNhc2UgRElTUExBWV9TT05Z
X0FDWDQyNEFLUF9JRDE6CisJY2FzZSBESVNQTEFZX1NPTllfQUNYNDI0QUtQX0lEMjoKKwljYXNl
IERJU1BMQVlfU09OWV9BQ1g0MjRBS1BfSUQzOgorCQlEUk1fREVWX0lORk8oYWN4LT5kZXYsICJw
YW5lbCBJRCAlMDJ4LCB2ZXJzaW9uOiAlMDJ4XG4iLAorCQkJICAgICBpZCwgdmVyc2lvbik7CisJ
CWJyZWFrOworCWRlZmF1bHQ6CisJCURSTV9ERVZfSU5GTyhhY3gtPmRldiwgInVua25vd24gcGFu
ZWwgSUQgJTAyeCwgdmVyc2lvbjogJTAyeFxuIiwKKwkJCSAgICAgaWQsIHZlcnNpb24pOworCQli
cmVhazsKKwl9CisJYWN4LT52ZXJzaW9uID0gdmVyc2lvbjsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgaW50IGFjeDQyNGFrcF9wb3dlcl9vbihzdHJ1Y3QgYWN4NDI0YWtwICphY3gpCit7CisJ
aW50IHJldDsKKworCXJldCA9IHJlZ3VsYXRvcl9lbmFibGUoYWN4LT5zdXBwbHkpOworCWlmIChy
ZXQpIHsKKwkJRFJNX0RFVl9FUlJPUihhY3gtPmRldiwgImZhaWxlZCB0byBlbmFibGUgc3VwcGx5
ICglZClcbiIsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCisJLyogQXNzZXJ0IFJFU0VUICov
CisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKGFjeC0+cmVzZXRfZ3BpbywgMSk7CisJdWRlbGF5
KDIwKTsKKwkvKiBEZS1hc3NlcnQgUkVTRVQgKi8KKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAo
YWN4LT5yZXNldF9ncGlvLCAwKTsKKwltc2xlZXAoMTEpOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQgYWN4NDI0YWtwX3ByZXBhcmUoc3RydWN0IGRybV9wYW5lbCAqcGFuZWwpCit7CisJ
c3RydWN0IGFjeDQyNGFrcCAqYWN4ID0gcGFuZWxfdG9fYWN4NDI0YWtwKHBhbmVsKTsKKwlzdHJ1
Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2kgPSB0b19taXBpX2RzaV9kZXZpY2UoYWN4LT5kZXYpOwor
CWNvbnN0IHU4IG1kZGkgPSAzOworCWludCByZXQ7CisKKwlyZXQgPSBhY3g0MjRha3BfcG93ZXJf
b24oYWN4KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJLyogRW5hYmUgdGVhcmluZyBt
b2RlOiBzZW5kIFRFICh0ZWFyaW5nIGVmZmVjdCkgYXQgVkJMQU5LICovCisJcmV0ID0gbWlwaV9k
c2lfZGNzX3NldF90ZWFyX29uKGRzaSwKKwkJCQkgICAgICAgTUlQSV9EU0lfRENTX1RFQVJfTU9E
RV9WQkxBTkspOworCWlmIChyZXQpIHsKKwkJRFJNX0RFVl9FUlJPUihhY3gtPmRldiwgImZhaWxl
ZCB0byBlbmFibGUgdmJsYW5rIFRFICglZClcbiIsCisJCQkgICAgICByZXQpOworCQlyZXR1cm4g
cmV0OworCX0KKworCS8qIFNldCBNRERJICovCisJcmV0ID0gbWlwaV9kc2lfZGNzX3dyaXRlKGRz
aSwgTUlQSV9EU0lfRENTX1NFVF9NRERJLAorCQkJCSAmbWRkaSwgc2l6ZW9mKG1kZGkpKTsKKwlp
ZiAocmV0IDwgMCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2LCAiZmFpbGVkIHRvIHNldCBN
RERJICglZClcbiIsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCisJYWN4LT5ibC0+cHJvcHMu
cG93ZXIgPSBGQl9CTEFOS19OT1JNQUw7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQg
YWN4NDI0YWtwX3Bvd2VyX29mZihzdHJ1Y3QgYWN4NDI0YWtwICphY3gpCit7CisJLyogQXNzZXJ0
IFJFU0VUICovCisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKGFjeC0+cmVzZXRfZ3BpbywgMSk7
CisJbXNsZWVwKDExKTsKKworCXJlZ3VsYXRvcl9kaXNhYmxlKGFjeC0+c3VwcGx5KTsKK30KKwor
c3RhdGljIGludCBhY3g0MjRha3BfdW5wcmVwYXJlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQor
eworCXN0cnVjdCBhY3g0MjRha3AgKmFjeCA9IHBhbmVsX3RvX2FjeDQyNGFrcChwYW5lbCk7CisK
KwlhY3g0MjRha3BfcG93ZXJfb2ZmKGFjeCk7CisJYWN4LT5ibC0+cHJvcHMucG93ZXIgPSBGQl9C
TEFOS19QT1dFUkRPV047CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBhY3g0MjRha3Bf
ZW5hYmxlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0cnVjdCBhY3g0MjRha3AgKmFj
eCA9IHBhbmVsX3RvX2FjeDQyNGFrcChwYW5lbCk7CisJc3RydWN0IG1pcGlfZHNpX2RldmljZSAq
ZHNpID0gdG9fbWlwaV9kc2lfZGV2aWNlKGFjeC0+ZGV2KTsKKwlpbnQgcmV0OworCisJLyogRXhp
dCBzbGVlcCBtb2RlICovCisJcmV0ID0gbWlwaV9kc2lfZGNzX2V4aXRfc2xlZXBfbW9kZShkc2kp
OworCWlmIChyZXQpIHsKKwkJRFJNX0RFVl9FUlJPUihhY3gtPmRldiwgImZhaWxlZCB0byBleGl0
IHNsZWVwIG1vZGUgKCVkKVxuIiwKKwkJCSAgICAgIHJldCk7CisJCXJldHVybiByZXQ7CisJfQor
CW1zbGVlcCgxNDApOworCisJcmV0ID0gbWlwaV9kc2lfZGNzX3NldF9kaXNwbGF5X29uKGRzaSk7
CisJaWYgKHJldCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2LCAiZmFpbGVkIHRvIHR1cm4g
ZGlzcGxheSBvbiAoJWQpXG4iLAorCQkJICAgICAgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisJ
aWYgKGFjeC0+dmlkZW9fbW9kZSkgeworCQkvKiBJbiB2aWRlbyBtb2RlIHR1cm4gcGVyaXBoZXJh
bCBvbiAqLworCQlyZXQgPSBtaXBpX2RzaV90dXJuX29uX3BlcmlwaGVyYWwoZHNpKTsKKwkJaWYg
KHJldCkgeworCQkJZGV2X2VycihhY3gtPmRldiwgImZhaWxlZCB0byB0dXJuIG9uIHBlcmlwaGVy
YWxcbiIpOworCQkJcmV0dXJuIHJldDsKKwkJfQorCX0KKworCWFjeC0+YmwtPnByb3BzLnBvd2Vy
ID0gRkJfQkxBTktfVU5CTEFOSzsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFjeDQy
NGFrcF9kaXNhYmxlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0cnVjdCBhY3g0MjRh
a3AgKmFjeCA9IHBhbmVsX3RvX2FjeDQyNGFrcChwYW5lbCk7CisJc3RydWN0IG1pcGlfZHNpX2Rl
dmljZSAqZHNpID0gdG9fbWlwaV9kc2lfZGV2aWNlKGFjeC0+ZGV2KTsKKwl1OCBwYXI7CisJaW50
IHJldDsKKworCS8qIERpc2FibGUgYmFja2xpZ2h0ICovCisJcGFyID0gMHgwMDsKKwlyZXQgPSBt
aXBpX2RzaV9kY3Nfd3JpdGUoZHNpLCBNSVBJX0RDU19XUklURV9DT05UUk9MX0RJU1BMQVksCisJ
CQkJICZwYXIsIDEpOworCWlmIChyZXQpIHsKKwkJRFJNX0RFVl9FUlJPUihhY3gtPmRldiwKKwkJ
CSAgICAgICJmYWlsZWQgdG8gZGlzYWJsZSBkaXNwbGF5IGJhY2tsaWdodCAoJWQpXG4iLAorCQkJ
ICAgICAgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSBtaXBpX2RzaV9kY3Nfc2V0
X2Rpc3BsYXlfb2ZmKGRzaSk7CisJaWYgKHJldCkgeworCQlEUk1fREVWX0VSUk9SKGFjeC0+ZGV2
LCAiZmFpbGVkIHRvIHR1cm4gZGlzcGxheSBvZmYgKCVkKVxuIiwKKwkJCSAgICAgIHJldCk7CisJ
CXJldHVybiByZXQ7CisJfQorCisJLyogRW50ZXIgc2xlZXAgbW9kZSAqLworCXJldCA9IG1pcGlf
ZHNpX2Rjc19lbnRlcl9zbGVlcF9tb2RlKGRzaSk7CisJaWYgKHJldCkgeworCQlEUk1fREVWX0VS
Uk9SKGFjeC0+ZGV2LCAiZmFpbGVkIHRvIGVudGVyIHNsZWVwIG1vZGUgKCVkKVxuIiwKKwkJCSAg
ICAgIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCW1zbGVlcCg4NSk7CisKKwlhY3gtPmJsLT5w
cm9wcy5wb3dlciA9IEZCX0JMQU5LX05PUk1BTDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGFjeDQyNGFrcF9nZXRfbW9kZXMoc3RydWN0IGRybV9wYW5lbCAqcGFuZWwpCit7CisJc3Ry
dWN0IGFjeDQyNGFrcCAqYWN4ID0gcGFuZWxfdG9fYWN4NDI0YWtwKHBhbmVsKTsKKwlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gcGFuZWwtPmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbW9kZTsKKworCWlmIChhY3gtPnZpZGVvX21vZGUpCisJCW1vZGUgPSBk
cm1fbW9kZV9kdXBsaWNhdGUocGFuZWwtPmRybSwKKwkJCQkJICAmc29ueV9hY3g0MjRha3Bfdmlk
X21vZGUpOworCWVsc2UKKwkJbW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0ZShwYW5lbC0+ZHJtLAor
CQkJCQkgICZzb255X2FjeDQyNGFrcF9jbWRfbW9kZSk7CisJaWYgKCFtb2RlKSB7CisJCURSTV9F
UlJPUigiYmFkIG1vZGUgb3IgZmFpbGVkIHRvIGFkZCBtb2RlXG4iKTsKKwkJcmV0dXJuIC1FSU5W
QUw7CisJfQorCWRybV9tb2RlX3NldF9uYW1lKG1vZGUpOworCW1vZGUtPnR5cGUgPSBEUk1fTU9E
RV9UWVBFX0RSSVZFUiB8IERSTV9NT0RFX1RZUEVfUFJFRkVSUkVEOworCisJY29ubmVjdG9yLT5k
aXNwbGF5X2luZm8ud2lkdGhfbW0gPSBtb2RlLT53aWR0aF9tbTsKKwljb25uZWN0b3ItPmRpc3Bs
YXlfaW5mby5oZWlnaHRfbW0gPSBtb2RlLT5oZWlnaHRfbW07CisKKwlkcm1fbW9kZV9wcm9iZWRf
YWRkKGNvbm5lY3RvciwgbW9kZSk7CisKKwlyZXR1cm4gMTsgLyogTnVtYmVyIG9mIG1vZGVzICov
Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BhbmVsX2Z1bmNzIGFjeDQyNGFrcF9kcm1f
ZnVuY3MgPSB7CisJLmRpc2FibGUgPSBhY3g0MjRha3BfZGlzYWJsZSwKKwkudW5wcmVwYXJlID0g
YWN4NDI0YWtwX3VucHJlcGFyZSwKKwkucHJlcGFyZSA9IGFjeDQyNGFrcF9wcmVwYXJlLAorCS5l
bmFibGUgPSBhY3g0MjRha3BfZW5hYmxlLAorCS5nZXRfbW9kZXMgPSBhY3g0MjRha3BfZ2V0X21v
ZGVzLAorfTsKKworc3RhdGljIGludCBhY3g0MjRha3BfcHJvYmUoc3RydWN0IG1pcGlfZHNpX2Rl
dmljZSAqZHNpKQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZkc2ktPmRldjsKKwlzdHJ1Y3Qg
YWN4NDI0YWtwICphY3g7CisJaW50IHJldDsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWFjeCA9IGRl
dm1fa3phbGxvYyhkZXYsIHNpemVvZihzdHJ1Y3QgYWN4NDI0YWtwKSwgR0ZQX0tFUk5FTCk7CisJ
aWYgKCFhY3gpCisJCXJldHVybiAtRU5PTUVNOworCWFjeC0+dmlkZW9fbW9kZSA9IG9mX3Byb3Bl
cnR5X3JlYWRfYm9vbChkZXYtPm9mX25vZGUsCisJCQkJCQkiZW5mb3JjZS12aWRlby1tb2RlIik7
CisKKwltaXBpX2RzaV9zZXRfZHJ2ZGF0YShkc2ksIGFjeCk7CisJYWN4LT5kZXYgPSBkZXY7CisK
Kwlkc2ktPmxhbmVzID0gMjsKKwlkc2ktPmZvcm1hdCA9IE1JUElfRFNJX0ZNVF9SR0I4ODg7CisJ
LyoKKwkgKiBGSVhNRTogdGhlc2UgY29tZSBmcm9tIHRoZSBTVC1Fcmljc3NvbiB2ZW5kb3IgZHJp
dmVyIGZvciB0aGUKKwkgKiBIUkVGNTIwIGFuZCBzZWVtcyB0byByZWZsZWN0IGxpbWl0YXRpb25z
IGluIHRoZSBQTExzIG9uIHRoYXQKKwkgKiBwbGF0Zm9ybSwgaWYgeW91IGhhdmUgdGhlIGRhdGFz
aGVldCwgcGxlYXNlIGNyb3NzLWNoZWNrIHRoZQorCSAqIGFjdHVhbCBtYXggcmF0ZXMuCisJICov
CisJZHNpLT5scF9yYXRlID0gMTkyMDAwMDA7CisJZHNpLT5oc19yYXRlID0gNDIwMTYwMDAwOwor
CisJaWYgKGFjeC0+dmlkZW9fbW9kZSkKKwkJLyogQnVyc3QgbW9kZSB1c2luZyBldmVudCBmb3Ig
c3luYyAqLworCQlkc2ktPm1vZGVfZmxhZ3MgPQorCQkJTUlQSV9EU0lfTU9ERV9WSURFTyB8CisJ
CQlNSVBJX0RTSV9NT0RFX1ZJREVPX0JVUlNUOworCWVsc2UKKwkJZHNpLT5tb2RlX2ZsYWdzID0K
KwkJCU1JUElfRFNJX0NMT0NLX05PTl9DT05USU5VT1VTIHwKKwkJCU1JUElfRFNJX01PREVfRU9U
X1BBQ0tFVDsKKworCWFjeC0+c3VwcGx5ID0gZGV2bV9yZWd1bGF0b3JfZ2V0KGRldiwgInZkZGki
KTsKKwlpZiAoSVNfRVJSKGFjeC0+c3VwcGx5KSkKKwkJcmV0dXJuIFBUUl9FUlIoYWN4LT5zdXBw
bHkpOworCisJLyogVGhpcyBhc3NlcnRzIFJFU0VUIGJ5IGRlZmF1bHQgKi8KKwlhY3gtPnJlc2V0
X2dwaW8gPSBkZXZtX2dwaW9kX2dldF9vcHRpb25hbChkZXYsICJyZXNldCIsCisJCQkJCQkgR1BJ
T0RfT1VUX0hJR0gpOworCWlmIChJU19FUlIoYWN4LT5yZXNldF9ncGlvKSkgeworCQlyZXQgPSBQ
VFJfRVJSKGFjeC0+cmVzZXRfZ3Bpbyk7CisJCWlmIChyZXQgIT0gLUVQUk9CRV9ERUZFUikKKwkJ
CURSTV9ERVZfRVJST1IoZGV2LCAiZmFpbGVkIHRvIHJlcXVlc3QgR1BJTyAoJWQpXG4iLAorCQkJ
CSAgICAgIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJtX3BhbmVsX2luaXQoJmFjeC0+
cGFuZWwpOworCWFjeC0+cGFuZWwuZGV2ID0gZGV2OworCWFjeC0+cGFuZWwuZnVuY3MgPSAmYWN4
NDI0YWtwX2RybV9mdW5jczsKKworCWFjeC0+YmwgPSBkZXZtX2JhY2tsaWdodF9kZXZpY2VfcmVn
aXN0ZXIoZGV2LCAiYWN4NDI0YWtwIiwgZGV2LCBhY3gsCisJCQkJCQkgJmFjeDQyNGFrcF9ibF9v
cHMsIE5VTEwpOworCWlmIChJU19FUlIoYWN4LT5ibCkpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYs
ICJmYWlsZWQgdG8gcmVnaXN0ZXIgYmFja2xpZ2h0IGRldmljZVxuIik7CisJCXJldHVybiBQVFJf
RVJSKGFjeC0+YmwpOworCX0KKwlhY3gtPmJsLT5wcm9wcy5tYXhfYnJpZ2h0bmVzcyA9IDEwMjM7
CisJYWN4LT5ibC0+cHJvcHMuYnJpZ2h0bmVzcyA9IDUxMjsKKwlhY3gtPmJsLT5wcm9wcy5wb3dl
ciA9IEZCX0JMQU5LX1BPV0VSRE9XTjsKKworCXJldCA9IGRybV9wYW5lbF9hZGQoJmFjeC0+cGFu
ZWwpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gYWN4NDI0YWtwX3Bv
d2VyX29uKGFjeCk7CisJaWYgKHJldCkgeworCQlEUk1fREVWX0VSUk9SKGRldiwgImZhaWxlZCB0
byBwb3dlciB1cCBkaXNwbGF5XG4iKTsKKwkJZ290byBvdXRfcmVtb3ZlOworCX0KKworCS8qIFRy
eSA1IHRpbWVzIHRvIHJlYWQgdGhlIGRldmljZSBJRCAqLworCWZvciAoaSA9IDA7IGkgPCA1OyBp
KyspIHsKKwkJcmV0ID0gYWN4NDI0YWtwX3JlYWRfaWQoYWN4KTsKKwkJaWYgKCFyZXQpCisJCQli
cmVhazsKKwl9CisKKwlpZiAocmV0KSB7CisJCURSTV9ERVZfRVJST1IoYWN4LT5kZXYsICJmYWls
ZWQgdG8gcmVhZCBwYW5lbCBJRCAoJWQpXG4iLCByZXQpOworCQlnb3RvIG91dF9wb3dlcm9mZjsK
Kwl9CisJYWN4NDI0YWtwX3Bvd2VyX29mZihhY3gpOworCisJcmV0ID0gbWlwaV9kc2lfYXR0YWNo
KGRzaSk7CisJaWYgKHJldCA8IDApCisJCWdvdG8gb3V0X3Bvd2Vyb2ZmOworCisJcmV0dXJuIDA7
CisKK291dF9wb3dlcm9mZjoKKwlhY3g0MjRha3BfcG93ZXJfb2ZmKGFjeCk7CitvdXRfcmVtb3Zl
OgorCWRybV9wYW5lbF9yZW1vdmUoJmFjeC0+cGFuZWwpOworCXJldHVybiByZXQ7Cit9CisKK3N0
YXRpYyBpbnQgYWN4NDI0YWtwX3JlbW92ZShzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2kpCit7
CisJc3RydWN0IGFjeDQyNGFrcCAqYWN4ID0gbWlwaV9kc2lfZ2V0X2RydmRhdGEoZHNpKTsKKwor
CW1pcGlfZHNpX2RldGFjaChkc2kpOworCWRybV9wYW5lbF9yZW1vdmUoJmFjeC0+cGFuZWwpOwor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGFjeDQy
NGFrcF9vZl9tYXRjaFtdID0geworCXsgLmNvbXBhdGlibGUgPSAic29ueSxhY3g0MjRha3AiIH0s
CisJeyB9Cit9OworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgYWN4NDI0YWtwX29mX21hdGNoKTsK
Kworc3RhdGljIHN0cnVjdCBtaXBpX2RzaV9kcml2ZXIgYWN4NDI0YWtwX2RyaXZlciA9IHsKKwku
cHJvYmUgPSBhY3g0MjRha3BfcHJvYmUsCisJLnJlbW92ZSA9IGFjeDQyNGFrcF9yZW1vdmUsCisJ
LmRyaXZlciA9IHsKKwkJLm5hbWUgPSAicGFuZWwtc29ueS1hY3g0MjRha3AiLAorCQkub2ZfbWF0
Y2hfdGFibGUgPSBhY3g0MjRha3Bfb2ZfbWF0Y2gsCisJfSwKK307Cittb2R1bGVfbWlwaV9kc2lf
ZHJpdmVyKGFjeDQyNGFrcF9kcml2ZXIpOworCitNT0RVTEVfQVVUSE9SKCJMaW51cyBXYWxsZWkg
PGxpbnVzLndhbGxlaWpAbGluYXJvLm9yZz4iKTsKK01PRFVMRV9ERVNDUklQVElPTigiTUlQSS1E
U0kgU29ueSBhY3g0MjRha3AgUGFuZWwgRHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYy
Iik7CmRpZmYgLS1naXQgYS9pbmNsdWRlL3ZpZGVvL21pcGlfZGlzcGxheS5oIGIvaW5jbHVkZS92
aWRlby9taXBpX2Rpc3BsYXkuaAppbmRleCBjYmE1N2E2NzhkYWYuLmNmOTljNmE1MTlkNSAxMDA2
NDQKLS0tIGEvaW5jbHVkZS92aWRlby9taXBpX2Rpc3BsYXkuaAorKysgYi9pbmNsdWRlL3ZpZGVv
L21pcGlfZGlzcGxheS5oCkBAIC0xMjUsNiArMTI1LDcgQEAgZW51bSB7CiAJTUlQSV9EQ1NfR0VU
X0NBQkNfTUlOX0JSSUdIVE5FU1MgPSAweDVGLAkvKiBNSVBJIERDUyAxLjMgKi8KIAlNSVBJX0RD
U19SRUFEX0REQl9TVEFSVAkJPSAweEExLAogCU1JUElfRENTX1JFQURfRERCX0NPTlRJTlVFCT0g
MHhBOCwKKwlNSVBJX0RTSV9EQ1NfU0VUX01EREkJCT0gMHhBRSwKIH07CiAKIC8qIE1JUEkgRENT
IHBpeGVsIGZvcm1hdHMgKi8KLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
