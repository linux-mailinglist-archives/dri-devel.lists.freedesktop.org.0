Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 70BFFECA69
	for <lists+dri-devel@lfdr.de>; Fri,  1 Nov 2019 22:42:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8CEAC6F87E;
	Fri,  1 Nov 2019 21:42:50 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x543.google.com (mail-pg1-x543.google.com
 [IPv6:2607:f8b0:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A97166F87E
 for <dri-devel@lists.freedesktop.org>; Fri,  1 Nov 2019 21:42:46 +0000 (UTC)
Received: by mail-pg1-x543.google.com with SMTP id u23so7282148pgo.0
 for <dri-devel@lists.freedesktop.org>; Fri, 01 Nov 2019 14:42:46 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=ic1ZpoaxH4o5hN+jZyuQG7BFBmFdykhkFLy2KrPXauE=;
 b=QZnjGXMeZhWuLd9Dmc8Pw7fFElnD4Ahi3zYrZBGM+N25Mpw/nWS4ob4zOOU7l4Tz3C
 PWGLW6QkaHsGYNQjZ8TjjmpHCoO80BXTxba3HzDakQ9oEUnKJuBALLSrPcOccx99BXwz
 Z9seRf2TdRiSjbhqmnAj5ZW27TBSwtsdNRAQz/ldK/bGUBXoI7z6SuaRnVrKZmrWg1y4
 jV4rFuMUNN+A3N1lgqS3Jv9kDD49dhKyBPKGS/uaCrj6sO2evqFPXCX6gxpjE/LsIJgF
 6WzWl00LSjFWJXgB5bnr7Q2fa4VnfMcq8rRh/Pe9VkGHnkkRXQ5nTsWY6JcTO8r3S4le
 28Dg==
X-Gm-Message-State: APjAAAVMjIU0pQVqIRrac6bFHu4Bg1XeEKDJHQAcZJRSMWqUt9Ze8fep
 NB2vZrwaUzAe6TVGCXBn1qnBBg==
X-Google-Smtp-Source: APXvYqy6frzI7U/VA15cERaQjYmXqqq7+5rwfFiC7kkijDc2gWx4U93L3lELG52xFLy14bWnrbu8eA==
X-Received: by 2002:a63:fc09:: with SMTP id j9mr1375669pgi.272.1572644566184; 
 Fri, 01 Nov 2019 14:42:46 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 u36sm8299058pgn.29.2019.11.01.14.42.45
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 01 Nov 2019 14:42:45 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v14 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Fri,  1 Nov 2019 21:42:37 +0000
Message-Id: <20191101214238.78015-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191101214238.78015-1-john.stultz@linaro.org>
References: <20191101214238.78015-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=ic1ZpoaxH4o5hN+jZyuQG7BFBmFdykhkFLy2KrPXauE=;
 b=JKvzcazticc0ZdMfUBlPVHXilu1UxDDvy/M9b8wl91FkCZcIeG/OU90Cep6mbLs+Hn
 cgwEfB0vxNTVTV+H0fsPiWyRorolX+8zSmZACQxDMJmBiPLP65s5q3+AGrrIWPQKx2OX
 4PhLJE1wqyzU8m12JlnYfkDDpBsicu3uBZAo9kVxMuylli66KeMwo3+XuNXIzV3c9D+y
 SRZhBSxELJdxaAFJg+TFq2v5YXwYPNxq9+JooolXPON1BARRI/KfF+9u3+a5jxBwA3fm
 47pf2rtjRAcmm8uMCk+Y2EkBHfwzrEi6PpLVPia3aPzTuhkXyD9oBRr8o3/J4NJmhgrV
 KsUA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Sandeep Patil <sspatil@google.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKTk9URTogVGhpcyBwYXRj
aCBvbmx5IGFkZHMgdGhlIGRlZmF1bHQgQ01BIGhlYXAuIFdlIHdpbGwgZW5hYmxlCnNlbGVjdGl2
ZWx5IGFkZGluZyBvdGhlciBDTUEgbWVtb3J5IHJlZ2lvbnMgdG8gdGhlIGRtYWJ1ZiBoZWFwcwpp
bnRlcmZhY2Ugd2l0aCBhIGxhdGVyIHBhdGNoICh3aGljaCByZXF1aXJlcyBhIGR0IGJpbmRpbmcp
CgpDYzogTGF1cmEgQWJib3R0IDxsYWJib3R0QHJlZGhhdC5jb20+CkNjOiBCZW5qYW1pbiBHYWln
bmFyZCA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4KQ2M6IFN1bWl0IFNlbXdhbCA8c3Vt
aXQuc2Vtd2FsQGxpbmFyby5vcmc+CkNjOiBMaWFtIE1hcmsgPGxtYXJrQGNvZGVhdXJvcmEub3Jn
PgpDYzogUHJhdGlrIFBhdGVsIDxwcmF0aWtwQGNvZGVhdXJvcmEub3JnPgpDYzogQnJpYW4gU3Rh
cmtleSA8QnJpYW4uU3RhcmtleUBhcm0uY29tPgpDYzogVmluY2VudCBEb25uZWZvcnQgPFZpbmNl
bnQuRG9ubmVmb3J0QGFybS5jb20+CkNjOiBTdWRpcHRvIFBhdWwgPFN1ZGlwdG8uUGF1bEBhcm0u
Y29tPgpDYzogQW5kcmV3IEYuIERhdmlzIDxhZmRAdGkuY29tPgpDYzogQ2hyaXN0b3BoIEhlbGx3
aWcgPGhjaEBpbmZyYWRlYWQub3JnPgpDYzogQ2hlbmJvIEZlbmcgPGZlbmdjQGdvb2dsZS5jb20+
CkNjOiBBbGlzdGFpciBTdHJhY2hhbiA8YXN0cmFjaGFuQGdvb2dsZS5jb20+CkNjOiBIcmlkeWEg
VmFsc2FyYWp1IDxocmlkeWFAZ29vZ2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwgPHNzcGF0aWxA
Z29vZ2xlLmNvbT4KQ2M6IEhpbGxmIERhbnRvbiA8aGRhbnRvbkBzaW5hLmNvbT4KQ2M6IERhdmUg
QWlybGllIDxhaXJsaWVkQGdtYWlsLmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKUmV2aWV3ZWQtYnk6IEJlbmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBs
aW5hcm8ub3JnPgpSZXZpZXdlZC1ieTogQnJpYW4gU3RhcmtleSA8YnJpYW4uc3RhcmtleUBhcm0u
Y29tPgpBY2tlZC1ieTogTGF1cmEgQWJib3R0IDxsYWJib3R0QHJlZGhhdC5jb20+ClRlc3RlZC1i
eTogQXlhbiBLdW1hciBIYWxkZXIgPGF5YW4uaGFsZGVyQGFybS5jb20+ClNpZ25lZC1vZmYtYnk6
IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogU3dpdGNoIGFs
bG9jYXRlIHRvIHJldHVybiBkbWFidWYgZmQKKiBTaW1wbGlmeSBpbml0IGNvZGUKKiBDaGVja3Bh
dGNoIGZpeHVwcwp2MzoKKiBTd2l0Y2ggdG8gaW5saW5lIGZ1bmN0aW9uIGZvciB0b19jbWFfaGVh
cCgpCiogTWlub3IgY2xlYW51cHMgc3VnZ2VzdGVkIGJ5IEJyaWFuCiogRm9sZCBpbiBuZXcgcmVn
aXN0cmF0aW9uIHN0eWxlIGZyb20gQW5kcmV3CiogRm9sZGVkIGluIGNoYW5nZXMgZnJvbSBBbmRy
ZXcgdG8gdXNlIHNpbXBsaWZpZWQgcGFnZSBsaXN0CiAgZnJvbSB0aGUgaGVhcCBoZWxwZXJzCnY0
OgoqIFVzZSB0aGUgZmRfZmxhZ3Mgd2hlbiBjcmVhdGluZyBkbWFidWYgZmQgKFN1Z2dlc3RlZCBi
eQogIEJlbmphbWluKQoqIFVzZSBwcmVjYWxjdWxhdGVkIHBhZ2Vjb3VudCAoU3VnZ2VzdGVkIGJ5
IEFuZHJldykKdjY6CiogQ2hhbmdlZCB2YXJpYWJsZSBuYW1lcyB0byBpbXByb3ZlIGNsYXJpdHks
IGFzIHN1Z2dlc3RlZAogIGJ5IEJyaWFuCnY3OgoqIFVzZSBuZXdseSBsb3dlci1jYXNlZCBpbml0
X2hlYXBfaGVscGVyX2J1ZmZlciBoZWxwZXIKKiBVc2UgbmV3IGRtYWJ1ZiBleHBvcnQgaGVscGVy
CnY4OgoqIE1ha2Ugc3RydWN0IGRtYV9oZWFwX29wcyBjb25zdCAoU3VnZ2VzdGVkIGJ5IENocmlz
dG9waCkKKiBDb25kZW5zZSBkbWFfaGVhcF9idWZmZXIgYW5kIGhlYXBfaGVscGVyX2J1ZmZlciAo
c3VnZ2VzdGVkIGJ5CiAgQ2hyaXN0b3BoKQoqIENoZWNrcGF0Y2ggd2hpdGVzcGFjZSBmaXh1cHMK
djk6CiogUmVtb3ZpbmcgbmVlZGxlc3MgY2hlY2sgbm90ZWQgYnkgQnJpYW4gU3RhcmtleQoqIFJl
bmFtZSBkbWFfaGVhcF9nZXRfZGF0YS0+ZG1hX2hlYXBfZ2V0X2RydmRhdGEgc3VnZ2VzdGVkCiAg
YnkgSGlsZiBEYW50b24KKiBDaGVjayBzaWduYWxzIGFmdGVyIGNsZWFyaW5nIG1lbW9yeSBwYWdl
cyB0byBhdm9pZCBkb2luZwogIG5lZWRsZXNzIHdvcmsgaWYgdGhlIHRhc2sgaXMga2lsbGVkIGFz
IHN1Z2dlc3RlZCBieSBIaWxmCnYxMjoKKiBSZXdvcmsgdG8gb25seSBhZGQgdGhlIGRlZmF1bHQg
Q01BIGhlYXAKLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyAgICB8ICAgOCArKwog
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVm
L2hlYXBzL2NtYV9oZWFwLmMgfCAxNzggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwog
MyBmaWxlcyBjaGFuZ2VkLCAxODcgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRy
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEt
YnVmL2hlYXBzL0tjb25maWcgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwppbmRleCAy
MDUwNTI3NDQxNjkuLmE1ZWVmMDZjNDIyNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hl
YXBzL0tjb25maWcKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKQEAgLTQsMyAr
NCwxMSBAQCBjb25maWcgRE1BQlVGX0hFQVBTX1NZU1RFTQogCWhlbHAKIAkgIENob29zZSB0aGlz
IG9wdGlvbiB0byBlbmFibGUgdGhlIHN5c3RlbSBkbWFidWYgaGVhcC4gVGhlIHN5c3RlbSBoZWFw
CiAJICBpcyBiYWNrZWQgYnkgcGFnZXMgZnJvbSB0aGUgYnVkZHkgYWxsb2NhdG9yLiBJZiBpbiBk
b3VidCwgc2F5IFkuCisKK2NvbmZpZyBETUFCVUZfSEVBUFNfQ01BCisJYm9vbCAiRE1BLUJVRiBD
TUEgSGVhcCIKKwlkZXBlbmRzIG9uIERNQUJVRl9IRUFQUyAmJiBETUFfQ01BCisJaGVscAorCSAg
Q2hvb3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSBkbWEtYnVmIENNQSBoZWFwLiBUaGlzIGhlYXAg
aXMgYmFja2VkCisJICBieSB0aGUgQ29udGlndW91cyBNZW1vcnkgQWxsb2NhdG9yIChDTUEpLiBJ
ZiB5b3VyIHN5c3RlbSBoYXMgdGhlc2UKKwkgIHJlZ2lvbnMsIHlvdSBzaG91bGQgc2F5IFkgaGVy
ZS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSBiL2RyaXZlcnMv
ZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQppbmRleCBkMTgwOGVjYTI1ODEuLjZlNTRjZGVjM2RhMCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCisrKyBiL2RyaXZlcnMv
ZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMSwzICsxLDQgQEAKICMgU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IEdQTC0yLjAKIG9iai15CQkJCQkrPSBoZWFwLWhlbHBlcnMubwogb2JqLSQoQ09O
RklHX0RNQUJVRl9IRUFQU19TWVNURU0pCSs9IHN5c3RlbV9oZWFwLm8KK29iai0kKENPTkZJR19E
TUFCVUZfSEVBUFNfQ01BKQkJKz0gY21hX2hlYXAubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEt
YnVmL2hlYXBzL2NtYV9oZWFwLmMgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYwpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjA2NDkyNmI1ZDczNQotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCkBAIC0wLDAg
KzEsMTc4IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIERN
QUJVRiBDTUEgaGVhcCBleHBvcnRlcgorICoKKyAqIENvcHlyaWdodCAoQykgMjAxMiwgMjAxOSBM
aW5hcm8gTHRkLgorICogQXV0aG9yOiA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4gZm9y
IFNULUVyaWNzc29uLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9jbWEuaD4KKyNpbmNsdWRlIDxs
aW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGlu
dXgvZG1hLWhlYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtY29udGlndW91cy5oPgorI2luY2x1
ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGlu
dXgvaGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4
L3NsYWIuaD4KKyNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4
L3NjaGVkL3NpZ25hbC5oPgorCisjaW5jbHVkZSAiaGVhcC1oZWxwZXJzLmgiCisKK3N0cnVjdCBj
bWFfaGVhcCB7CisJc3RydWN0IGRtYV9oZWFwICpoZWFwOworCXN0cnVjdCBjbWEgKmNtYTsKK307
CisKK3N0YXRpYyB2b2lkIGNtYV9oZWFwX2ZyZWUoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hlYXAgPSBkbWFfaGVhcF9nZXRfZHJ2
ZGF0YShidWZmZXItPmhlYXApOworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBidWZmZXItPnBh
Z2Vjb3VudDsKKwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzID0gYnVmZmVyLT5wcml2X3ZpcnQ7CisK
KwkvKiBmcmVlIHBhZ2UgbGlzdCAqLworCWtmcmVlKGJ1ZmZlci0+cGFnZXMpOworCS8qIHJlbGVh
c2UgbWVtb3J5ICovCisJY21hX3JlbGVhc2UoY21hX2hlYXAtPmNtYSwgY21hX3BhZ2VzLCBucl9w
YWdlcyk7CisJa2ZyZWUoYnVmZmVyKTsKK30KKworLyogZG1hYnVmIGhlYXAgQ01BIG9wZXJhdGlv
bnMgZnVuY3Rpb25zICovCitzdGF0aWMgaW50IGNtYV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBkbWFf
aGVhcCAqaGVhcCwKKwkJCSAgICAgdW5zaWduZWQgbG9uZyBsZW4sCisJCQkgICAgIHVuc2lnbmVk
IGxvbmcgZmRfZmxhZ3MsCisJCQkgICAgIHVuc2lnbmVkIGxvbmcgaGVhcF9mbGFncykKK3sKKwlz
dHJ1Y3QgY21hX2hlYXAgKmNtYV9oZWFwID0gZG1hX2hlYXBfZ2V0X2RydmRhdGEoaGVhcCk7CisJ
c3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqaGVscGVyX2J1ZmZlcjsKKwlzdHJ1Y3QgcGFnZSAq
Y21hX3BhZ2VzOworCXNpemVfdCBzaXplID0gUEFHRV9BTElHTihsZW4pOworCXVuc2lnbmVkIGxv
bmcgbnJfcGFnZXMgPSBzaXplID4+IFBBR0VfU0hJRlQ7CisJdW5zaWduZWQgbG9uZyBhbGlnbiA9
IGdldF9vcmRlcihzaXplKTsKKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmOworCWludCByZXQgPSAt
RU5PTUVNOworCXBnb2ZmX3QgcGc7CisKKwlpZiAoYWxpZ24gPiBDT05GSUdfQ01BX0FMSUdOTUVO
VCkKKwkJYWxpZ24gPSBDT05GSUdfQ01BX0FMSUdOTUVOVDsKKworCWhlbHBlcl9idWZmZXIgPSBr
emFsbG9jKHNpemVvZigqaGVscGVyX2J1ZmZlciksIEdGUF9LRVJORUwpOworCWlmICghaGVscGVy
X2J1ZmZlcikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpbml0X2hlYXBfaGVscGVyX2J1ZmZlciho
ZWxwZXJfYnVmZmVyLCBjbWFfaGVhcF9mcmVlKTsKKwloZWxwZXJfYnVmZmVyLT5mbGFncyA9IGhl
YXBfZmxhZ3M7CisJaGVscGVyX2J1ZmZlci0+aGVhcCA9IGhlYXA7CisJaGVscGVyX2J1ZmZlci0+
c2l6ZSA9IGxlbjsKKworCWNtYV9wYWdlcyA9IGNtYV9hbGxvYyhjbWFfaGVhcC0+Y21hLCBucl9w
YWdlcywgYWxpZ24sIGZhbHNlKTsKKwlpZiAoIWNtYV9wYWdlcykKKwkJZ290byBmcmVlX2J1ZjsK
KworCWlmIChQYWdlSGlnaE1lbShjbWFfcGFnZXMpKSB7CisJCXVuc2lnbmVkIGxvbmcgbnJfY2xl
YXJfcGFnZXMgPSBucl9wYWdlczsKKwkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBjbWFfcGFnZXM7CisK
KwkJd2hpbGUgKG5yX2NsZWFyX3BhZ2VzID4gMCkgeworCQkJdm9pZCAqdmFkZHIgPSBrbWFwX2F0
b21pYyhwYWdlKTsKKworCQkJbWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJWkUpOworCQkJa3VubWFw
X2F0b21pYyh2YWRkcik7CisJCQkvKgorCQkJICogQXZvaWQgd2FzdGluZyB0aW1lIHplcm9pbmcg
bWVtb3J5IGlmIHRoZSBwcm9jZXNzCisJCQkgKiBoYXMgYmVlbiBraWxsZWQgYnkgYnkgU0lHS0lM
TAorCQkJICovCisJCQlpZiAoZmF0YWxfc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQkJZ290
byBmcmVlX2NtYTsKKworCQkJcGFnZSsrOworCQkJbnJfY2xlYXJfcGFnZXMtLTsKKwkJfQorCX0g
ZWxzZSB7CisJCW1lbXNldChwYWdlX2FkZHJlc3MoY21hX3BhZ2VzKSwgMCwgc2l6ZSk7CisJfQor
CisJaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50ID0gbnJfcGFnZXM7CisJaGVscGVyX2J1ZmZlci0+
cGFnZXMgPSBrbWFsbG9jX2FycmF5KGhlbHBlcl9idWZmZXItPnBhZ2Vjb3VudCwKKwkJCQkJICAg
ICBzaXplb2YoKmhlbHBlcl9idWZmZXItPnBhZ2VzKSwKKwkJCQkJICAgICBHRlBfS0VSTkVMKTsK
KwlpZiAoIWhlbHBlcl9idWZmZXItPnBhZ2VzKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8g
ZnJlZV9jbWE7CisJfQorCisJZm9yIChwZyA9IDA7IHBnIDwgaGVscGVyX2J1ZmZlci0+cGFnZWNv
dW50OyBwZysrKQorCQloZWxwZXJfYnVmZmVyLT5wYWdlc1twZ10gPSAmY21hX3BhZ2VzW3BnXTsK
KworCS8qIGNyZWF0ZSB0aGUgZG1hYnVmICovCisJZG1hYnVmID0gaGVhcF9oZWxwZXJfZXhwb3J0
X2RtYWJ1ZihoZWxwZXJfYnVmZmVyLCBmZF9mbGFncyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7
CisJCXJldCA9IFBUUl9FUlIoZG1hYnVmKTsKKwkJZ290byBmcmVlX3BhZ2VzOworCX0KKworCWhl
bHBlcl9idWZmZXItPmRtYWJ1ZiA9IGRtYWJ1ZjsKKwloZWxwZXJfYnVmZmVyLT5wcml2X3ZpcnQg
PSBjbWFfcGFnZXM7CisKKwlyZXQgPSBkbWFfYnVmX2ZkKGRtYWJ1ZiwgZmRfZmxhZ3MpOworCWlm
IChyZXQgPCAwKSB7CisJCWRtYV9idWZfcHV0KGRtYWJ1Zik7CisJCS8qIGp1c3QgcmV0dXJuLCBh
cyBwdXQgd2lsbCBjYWxsIHJlbGVhc2UgYW5kIHRoYXQgd2lsbCBmcmVlICovCisJCXJldHVybiBy
ZXQ7CisJfQorCisJcmV0dXJuIHJldDsKKworZnJlZV9wYWdlczoKKwlrZnJlZShoZWxwZXJfYnVm
ZmVyLT5wYWdlcyk7CitmcmVlX2NtYToKKwljbWFfcmVsZWFzZShjbWFfaGVhcC0+Y21hLCBjbWFf
cGFnZXMsIG5yX3BhZ2VzKTsKK2ZyZWVfYnVmOgorCWtmcmVlKGhlbHBlcl9idWZmZXIpOworCXJl
dHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNtYV9oZWFw
X29wcyA9IHsKKwkuYWxsb2NhdGUgPSBjbWFfaGVhcF9hbGxvY2F0ZSwKK307CisKK3N0YXRpYyBp
bnQgX19hZGRfY21hX2hlYXAoc3RydWN0IGNtYSAqY21hLCB2b2lkICpkYXRhKQoreworCXN0cnVj
dCBjbWFfaGVhcCAqY21hX2hlYXA7CisJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9p
bmZvOworCisJY21hX2hlYXAgPSBremFsbG9jKHNpemVvZigqY21hX2hlYXApLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIWNtYV9oZWFwKQorCQlyZXR1cm4gLUVOT01FTTsKKwljbWFfaGVhcC0+Y21hID0g
Y21hOworCisJZXhwX2luZm8ubmFtZSA9IGNtYV9nZXRfbmFtZShjbWEpOworCWV4cF9pbmZvLm9w
cyA9ICZjbWFfaGVhcF9vcHM7CisJZXhwX2luZm8ucHJpdiA9IGNtYV9oZWFwOworCisJY21hX2hl
YXAtPmhlYXAgPSBkbWFfaGVhcF9hZGQoJmV4cF9pbmZvKTsKKwlpZiAoSVNfRVJSKGNtYV9oZWFw
LT5oZWFwKSkgeworCQlpbnQgcmV0ID0gUFRSX0VSUihjbWFfaGVhcC0+aGVhcCk7CisKKwkJa2Zy
ZWUoY21hX2hlYXApOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGFkZF9kZWZhdWx0X2NtYV9oZWFwKHZvaWQpCit7CisJc3RydWN0IGNtYSAqZGVmYXVs
dF9jbWEgPSBkZXZfZ2V0X2NtYV9hcmVhKE5VTEwpOworCWludCByZXQgPSAwOworCisJaWYgKGRl
ZmF1bHRfY21hKQorCQlyZXQgPSBfX2FkZF9jbWFfaGVhcChkZWZhdWx0X2NtYSwgTlVMTCk7CisK
KwlyZXR1cm4gcmV0OworfQorbW9kdWxlX2luaXQoYWRkX2RlZmF1bHRfY21hX2hlYXApOworTU9E
VUxFX0RFU0NSSVBUSU9OKCJETUEtQlVGIENNQSBIZWFwIik7CitNT0RVTEVfTElDRU5TRSgiR1BM
IHYyIik7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
