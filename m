Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0CF9BD095D
	for <lists+dri-devel@lfdr.de>; Wed,  9 Oct 2019 10:15:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 86BBF6E2C8;
	Wed,  9 Oct 2019 08:15:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 718D36E2C8;
 Wed,  9 Oct 2019 08:15:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Oct 2019 01:15:29 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,273,1566889200"; d="scan'208";a="394945084"
Received: from shawnle1-build-machine.itwn.intel.com ([10.5.253.9])
 by fmsmga006.fm.intel.com with ESMTP; 09 Oct 2019 01:15:26 -0700
From: Lee Shawn C <shawn.c.lee@intel.com>
To: intel-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Subject: [PATCH v2] drm/i915: customize DPCD brightness control for specific
 panel
Date: Thu, 10 Oct 2019 00:13:46 +0800
Message-Id: <20191009161346.21306-1-shawn.c.lee@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191004215851.31446-1-shawn.c.lee@intel.com>
References: <20191004215851.31446-1-shawn.c.lee@intel.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Cooper Chiou <cooper.chiou@intel.com>, Jani Nikula <jani.nikula@intel.com>,
 Gustavo Padovan <gustavo@padovan.org>, Lee Shawn C <shawn.c.lee@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYW5lbCAobWFudWZhY3R1cmVyIGlzIFNEQywgcHJvZHVjdCBJRCBpcyAweDQxNDEpCnVz
ZWQgbWFudWZhY3R1cmVyIGRlZmluZWQgRFBDRCByZWdpc3RlciB0byBjb250cm9sIGJyaWdodG5l
c3MKdGhhdCBub3QgZGVmaW5lZCBpbiBlRFAgc3BlYyBzbyBmYXIuIFRoaXMgY2hhbmdlIGZvbGxv
dyBwYW5lbAp2ZW5kb3IncyBpbnN0cnVjdGlvbiB0byBzdXBwb3J0IGJyaWdodG5lc3MgYWRqdXN0
bWVudC4KCkJ1Z3ppbGxhOiBodHRwczovL2J1Z3MuZnJlZWRlc2t0b3Aub3JnL3Nob3dfYnVnLmNn
aT9pZD05Nzg4MwoKVjI6IFRvIGNoZWNrIHNpbmsgT1VJIGluc3RlYWQgb2YgRURJRCBxdWlyay4K
ICAgIEFjY29yZGluZyB0byBUQ09OJ3MgY2FwYWJpbGl0eSB0byBkZWNpZGUgdG8gZW5hYmxlIHRo
aXMKICAgIG1ldGhvZCBmb3IgYnJpZ2h0bmVzcyBjb250cm9sLgoKQ2M6IEphbmkgTmlrdWxhIDxq
YW5pLm5pa3VsYUBpbnRlbC5jb20+CkNjOiBBZGFtIEphY2tzb24gPGFqYXhAcmVkaGF0LmNvbT4K
Q2M6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+
CkNjOiBHdXN0YXZvIFBhZG92YW4gPGd1c3Rhdm9AcGFkb3Zhbi5vcmc+CkNjOiBDb29wZXIgQ2hp
b3UgPGNvb3Blci5jaGlvdUBpbnRlbC5jb20+CgpTaWduZWQtb2ZmLWJ5OiBMZWUgU2hhd24gQyA8
c2hhd24uYy5sZWVAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZHBfaGVscGVy
LmMgICAgICAgICAgICAgICB8ICAxOCArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHAuYyAgICAgICB8ICAgNyArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9h
dXhfYmFja2xpZ2h0LmMgfCAxMzggKysrKysrKysrKysrKysrKystCiBpbmNsdWRlL2RybS9kcm1f
ZHBfaGVscGVyLmggICAgICAgICAgICAgICAgICAgfCAgMjAgKysrCiA0IGZpbGVzIGNoYW5nZWQs
IDE3NiBpbnNlcnRpb25zKCspLCA3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZHBfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX2hlbHBlci5j
CmluZGV4IGYzNzM3OThkODJmNi4uMDJmNzk1ODdjMzM3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2RwX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfaGVscGVy
LmMKQEAgLTEyNjgsNiArMTI2OCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHBjZF9xdWlyayBk
cGNkX3F1aXJrX2xpc3RbXSA9IHsKIAl7IE9VSSgweDAwLCAweDEwLCAweGZhKSwgREVWSUNFX0lE
X0FOWSwgZmFsc2UsIEJJVChEUF9EUENEX1FVSVJLX05PX1BTUikgfSwKIAkvKiBDSDc1MTEgc2Vl
bXMgdG8gbGVhdmUgU0lOS19DT1VOVCB6ZXJvZWQgKi8KIAl7IE9VSSgweDAwLCAweDAwLCAweDAw
KSwgREVWSUNFX0lEKCdDJywgJ0gnLCAnNycsICc1JywgJzEnLCAnMScpLCBmYWxzZSwgQklUKERQ
X0RQQ0RfUVVJUktfTk9fU0lOS19DT1VOVCkgfSwKKwkvKiBTYW1zdW5nIGVEUCBwYW5lbCAqLwor
CXsgT1VJKDB4YmEsIDB4NDEsIDB4NTkpLCBERVZJQ0VfSURfQU5ZLCBmYWxzZSwgQklUKERQX0RQ
Q0RfUVVJUktfQ1VTVE9NSVpFX0JSSUdIVE5FU1NfQ09OVFJPTCkgfSwKIH07CiAKICN1bmRlZiBP
VUkKQEAgLTEyODEsNyArMTI4Myw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHBjZF9xdWlyayBk
cGNkX3F1aXJrX2xpc3RbXSA9IHsKICAqIHRvIGRldmljZSBpZGVudGlmaWNhdGlvbiBzdHJpbmcg
YW5kIGhhcmR3YXJlL2Zpcm13YXJlIHJldmlzaW9ucyBsYXRlci4KICAqLwogc3RhdGljIHUzMgot
ZHJtX2RwX2dldF9xdWlya3MoY29uc3Qgc3RydWN0IGRybV9kcF9kcGNkX2lkZW50ICppZGVudCwg
Ym9vbCBpc19icmFuY2gpCitkcm1fZHBfZ2V0X3F1aXJrcyhjb25zdCBzdHJ1Y3QgZHJtX2RwX2Rw
Y2RfaWRlbnQgKmlkZW50LCBib29sIGlzX2JyYW5jaCwgdTggKnRjb25fY2FwKQogewogCWNvbnN0
IHN0cnVjdCBkcGNkX3F1aXJrICpxdWlyazsKIAl1MzIgcXVpcmtzID0gMDsKQEAgLTEzMDEsNiAr
MTMwMywxMSBAQCBkcm1fZHBfZ2V0X3F1aXJrcyhjb25zdCBzdHJ1Y3QgZHJtX2RwX2RwY2RfaWRl
bnQgKmlkZW50LCBib29sIGlzX2JyYW5jaCkKIAkJICAgIG1lbWNtcChxdWlyay0+ZGV2aWNlX2lk
LCBpZGVudC0+ZGV2aWNlX2lkLCBzaXplb2YoaWRlbnQtPmRldmljZV9pZCkpICE9IDApCiAJCQlj
b250aW51ZTsKIAorCQlpZiAocXVpcmstPnF1aXJrcyA9PSBEUF9EUENEX1FVSVJLX0NVU1RPTUla
RV9CUklHSFRORVNTX0NPTlRST0wgJiYKKwkJICAgICghKHRjb25fY2FwWzFdICYgRFBfQlJJR0hU
TkVTU19DT05UUk9MX05JVFMpIHx8CisJCSAgICAgISh0Y29uX2NhcFsyXSAmIERQX0JSSUdIVE5F
U1NfQ09OVFJPTF9CWV9BVVgpKSkKKwkJCQljb250aW51ZTsKKwogCQlxdWlya3MgfD0gcXVpcmst
PnF1aXJrczsKIAl9CiAKQEAgLTEzMjcsMTIgKzEzMzQsMTkgQEAgaW50IGRybV9kcF9yZWFkX2Rl
c2Moc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9kcF9kZXNjICpkZXNjLAogCXN0
cnVjdCBkcm1fZHBfZHBjZF9pZGVudCAqaWRlbnQgPSAmZGVzYy0+aWRlbnQ7CiAJdW5zaWduZWQg
aW50IG9mZnNldCA9IGlzX2JyYW5jaCA/IERQX0JSQU5DSF9PVUkgOiBEUF9TSU5LX09VSTsKIAlp
bnQgcmV0LCBkZXZfaWRfbGVuOworCXU4IHRjb25fY2FwWzRdID0gezB9OwogCiAJcmV0ID0gZHJt
X2RwX2RwY2RfcmVhZChhdXgsIG9mZnNldCwgaWRlbnQsIHNpemVvZigqaWRlbnQpKTsKIAlpZiAo
cmV0IDwgMCkKIAkJcmV0dXJuIHJldDsKIAotCWRlc2MtPnF1aXJrcyA9IGRybV9kcF9nZXRfcXVp
cmtzKGlkZW50LCBpc19icmFuY2gpOworCWlmIChvZmZzZXQgPT0gRFBfU0lOS19PVUkpIHsKKwkJ
cmV0ID0gZHJtX2RwX2RwY2RfcmVhZChhdXgsIERQX0VEUF9UQ09OX0NBUEFCSUxJVFlfQllURTAs
IHRjb25fY2FwLCBzaXplb2YodGNvbl9jYXApKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4g
cmV0OworCX0KKworCWRlc2MtPnF1aXJrcyA9IGRybV9kcF9nZXRfcXVpcmtzKGlkZW50LCBpc19i
cmFuY2gsIHRjb25fY2FwKTsKIAogCWRldl9pZF9sZW4gPSBzdHJubGVuKGlkZW50LT5kZXZpY2Vf
aWQsIHNpemVvZihpZGVudC0+ZGV2aWNlX2lkKSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHAuYwppbmRleCAyYjFlNzFmOTkyYjAuLjc2NmI0YjI1MjE0NyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtNzA4Miw2ICs3MDgyLDEzIEBAIHN0
YXRpYyBib29sIGludGVsX2VkcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCQlnb3RvIG91dF92ZGRfb2ZmOwogCX0KIAorCWlmIChkcm1fZHBfaGFzX3F1aXJrKCZp
bnRlbF9kcC0+ZGVzYywKKwkgICAgRFBfRFBDRF9RVUlSS19DVVNUT01JWkVfQlJJR0hUTkVTU19D
T05UUk9MKSkgeworCQlpOTE1X21vZHBhcmFtcy5lbmFibGVfZHBjZF9iYWNrbGlnaHQgPSB0cnVl
OworCQlpOTE1X21vZHBhcmFtcy5mYXN0Ym9vdCA9IGZhbHNlOworCQlEUk1fREVCVUdfS01TKCJV
c2luZyBzcGVjaWZpYyBEUENEIHRvIGNvbnRyb2wgYnJpZ2h0bmVzc1xuIik7CisJfQorCiAJbXV0
ZXhfbG9jaygmZGV2LT5tb2RlX2NvbmZpZy5tdXRleCk7CiAJZWRpZCA9IGRybV9nZXRfZWRpZChj
b25uZWN0b3IsICZpbnRlbF9kcC0+YXV4LmRkYyk7CiAJaWYgKGVkaWQpIHsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMKaW5k
ZXggMDIwNDIyZGEyYWUyLi4wOTQ4MGU3NzJiZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jCkBAIC0yNSw2ICsyNSwx
MTEgQEAKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxf
ZHBfYXV4X2JhY2tsaWdodC5oIgogCisjZGVmaW5lIEVEUF9DVVNUT01JWkVfTUFYX0JSSUdIVE5F
U1NfTEVWRUwJKDUxMikKKworc3RhdGljIHVpbnQzMl90IGludGVsX2RwX2F1eF9nZXRfY3VzdG9t
aXplX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmY29ubmVjdG9yLT5lbmNv
ZGVyLT5iYXNlKTsKKwl1aW50OF90IHJlYWRfdmFsWzJdID0geyAweDAgfTsKKworCWlmIChkcm1f
ZHBfZHBjZF9yZWFkKCZpbnRlbF9kcC0+YXV4LCBEUF9FRFBfQlJJR0hUTkVTU19OSVRTLAorCQkJ
ICAgICAmcmVhZF92YWwsIHNpemVvZihyZWFkX3ZhbCkpIDwgMCkgeworCQlEUk1fREVCVUdfS01T
KCJGYWlsZWQgdG8gcmVhZCBEUENEIHJlZ2lzdGVyICV4XG4iLAorCQkJRFBfRURQX0JSSUdIVE5F
U1NfTklUUyk7CisJCXJldHVybiAwOworCX0KKworCXJldHVybiAocmVhZF92YWxbMV0gPDwgOCB8
IHJlYWRfdmFsWzBdKTsKK30KKworc3RhdGljIHZvaWQKK2ludGVsX2RwX2F1eF9zZXRfY3VzdG9t
aXplX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0
ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRv
X2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rvci0+ZW5jb2Rlci0+YmFzZSk7
CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXVpbnQ4
X3QgbmV3X3ZhbHNbNF07CisKKwlpZiAobGV2ZWwgPiBwYW5lbC0+YmFja2xpZ2h0Lm1heCkKKwkJ
bGV2ZWwgPSBwYW5lbC0+YmFja2xpZ2h0Lm1heDsKKworCW5ld192YWxzWzBdID0gbGV2ZWwgJiAw
eEZGOworCW5ld192YWxzWzFdID0gKGxldmVsICYgMHhGRjAwKSA+PiA4OworCW5ld192YWxzWzJd
ID0gMDsKKwluZXdfdmFsc1szXSA9IDA7CisKKwlpZiAoZHJtX2RwX2RwY2Rfd3JpdGUoJmludGVs
X2RwLT5hdXgsIERQX0VEUF9CUklHSFRORVNTX05JVFMsIG5ld192YWxzLCA0KSA8IDApCisJCURS
TV9ERUJVR19LTVMoIkZhaWxlZCB0byB3cml0ZSBhdXggYmFja2xpZ2h0IGxldmVsXG4iKTsKK30K
Kworc3RhdGljIHZvaWQgaW50ZWxfZHBfYXV4X2VuYWJsZV9jdXN0b21pemVfYmFja2xpZ2h0KGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCQkgIGNvbnN0IHN0
cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25u
ZWN0b3IpOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNv
bm5lY3Rvci0+ZW5jb2Rlci0+YmFzZSk7CisJdWludDhfdCByZWFkX3ZhbFs0XSwgaTsKKwl1aW50
OF90IHdyaXRlX3ZhbFs4XSA9IHsweDAwLCAweDAwLCAweEYwLCAweDAxLCAweDkwLCAweDAxLCAw
eDAwLCAweDAwfTsKKworCWlmIChkcm1fZHBfZHBjZF93cml0ZSgmaW50ZWxfZHAtPmF1eCwgRFBf
RURQX1BBTkVMX0xVTUlOQU5DRV9PVkVSUklERSwgd3JpdGVfdmFsLCBzaXplb2Yod3JpdGVfdmFs
KSkgPCAwKQorCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3JpdGUgcGFuZWwgbHVtaW5hbmNl
LlxuIik7CisKKwlpZiAoZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9FRFBf
QlJJR0hUTkVTU19PUFRJTUlaQVRJT04sIDB4MDEpIDwgMCkKKwkJRFJNX0RFQlVHX0tNUygiRmFp
bGVkIHRvIHdyaXRlICV4XG4iLAorCQkJRFBfRURQX0JSSUdIVE5FU1NfT1BUSU1JWkFUSU9OKTsK
KwkvKiB3cml0ZSBzb3VyY2UgT1VJICovCisJd3JpdGVfdmFsWzBdID0gMHgwMDsKKwl3cml0ZV92
YWxbMV0gPSAweGFhOworCXdyaXRlX3ZhbFsyXSA9IDB4MDE7CisJaWYgKGRybV9kcF9kcGNkX3dy
aXRlKCZpbnRlbF9kcC0+YXV4LCBEUF9TT1VSQ0VfT1VJLCB3cml0ZV92YWwsIDMpIDwgMCkKKwkJ
RFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHdyaXRlIE9VSVxuIik7CisKKwlpZiAoZHJtX2RwX2Rw
Y2RfcmVhZGIoJmludGVsX2RwLT5hdXgsIERQX0VEUF9HRVRTRVRfQ1RSTF9QQVJBTVMsIHJlYWRf
dmFsKSAhPSAxKQorCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gcmVhZCAleFxuIiwKKwkJCURQ
X0VEUF9HRVRTRVRfQ1RSTF9QQVJBTVMpOworCisJaWYgKGRybV9kcF9kcGNkX3dyaXRlYigmaW50
ZWxfZHAtPmF1eCwgRFBfRURQX0dFVFNFVF9DVFJMX1BBUkFNUywgMCkgIT0gMSkKKwkJRFJNX0RF
QlVHX0tNUygiRmFpbGVkIHRvIHdyaXRlICV4XG4iLAorCQkJRFBfRURQX0dFVFNFVF9DVFJMX1BB
UkFNUyk7CisKKwlpZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsIERQX0VEUF9H
RVRTRVRfQ1RSTF9QQVJBTVMsIHJlYWRfdmFsKSAhPSAxKQorCQlEUk1fREVCVUdfS01TKCJGYWls
ZWQgdG8gcmVhZCAleFxuIiwKKwkJCURQX0VEUF9HRVRTRVRfQ1RSTF9QQVJBTVMpOworCisJaWYg
KGRybV9kcF9kcGNkX3JlYWQoJmludGVsX2RwLT5hdXgsIERQX0VEUF9DT05URU5UX0xVTUlOQU5D
RSwgJnJlYWRfdmFsLCBzaXplb2YocmVhZF92YWwpKSA8IDApCisJCURSTV9ERUJVR19LTVMoIkZh
aWxlZCB0byByZWFkICV4XG4iLAorCQkJRFBfRURQX0NPTlRFTlRfTFVNSU5BTkNFKTsKKworCW1l
bXNldChyZWFkX3ZhbCwgMHgwLCA0KTsKKwlpZiAoZHJtX2RwX2RwY2Rfd3JpdGUoJmludGVsX2Rw
LT5hdXgsIERQX0VEUF9DT05URU5UX0xVTUlOQU5DRSwgcmVhZF92YWwsIHNpemVvZihyZWFkX3Zh
bCkpIDwgMCkKKwkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHdyaXRlICV4XG4iLAorCQkJRFBf
RURQX0NPTlRFTlRfTFVNSU5BTkNFKTsKKworCWlmIChkcm1fZHBfZHBjZF9yZWFkYigmaW50ZWxf
ZHAtPmF1eCwgRFBfRURQX0dFVFNFVF9DVFJMX1BBUkFNUywgcmVhZF92YWwpICE9IDEpCisJCURS
TV9ERUJVR19LTVMoIkZhaWxlZCB0byByZWFkICV4XG4iLAorCQkJRFBfRURQX0dFVFNFVF9DVFJM
X1BBUkFNUyk7CisKKwlpZiAoZHJtX2RwX2RwY2RfcmVhZCgmaW50ZWxfZHAtPmF1eCwgRFBfU09V
UkNFX09VSSwgcmVhZF92YWwsIDQpIDwgMCkKKwkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHJl
YWQgT1VJXG4iKTsKKworCURSTV9ERUJVR19LTVMoImdvdCBPVUkgJTNwaFxuIiwgcmVhZF92YWwp
OworCisJZm9yIChpID0gMDsgaSA8IDY7IGkrKykgeworCQlpbnRlbF9kcF9hdXhfc2V0X2N1c3Rv
bWl6ZV9iYWNrbGlnaHQoY29ubl9zdGF0ZSwgY29ubmVjdG9yLT5wYW5lbC5iYWNrbGlnaHQubGV2
ZWwpOworCisJCW1zbGVlcCg2MCk7CisJCWlmIChpbnRlbF9kcF9hdXhfZ2V0X2N1c3RvbWl6ZV9i
YWNrbGlnaHQoY29ubmVjdG9yKSkKKwkJCXJldHVybjsKKwl9CisKKwlEUk1fREVCVUdfS01TKCJS
ZXN0b3JlIGJyaWdodG5lc3MgbWF5IGhhdmUgcHJvYmxlbS5cbiIpOworfQorCitzdGF0aWMgdm9p
ZCBpbnRlbF9kcF9hdXhfZGlzYWJsZV9jdXN0b21pemVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKK3sKKwkvLyBkbyBub3RoaW5nCisJ
cmV0dXJuOworfQorCiBzdGF0aWMgdm9pZCBzZXRfYXV4X2JhY2tsaWdodF9lbmFibGUoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwgYm9vbCBlbmFibGUpCiB7CiAJdTggcmVnX3ZhbCA9IDA7CkBA
IC0yMjUsNiArMzMwLDE5IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2F1eF9kaXNhYmxlX2JhY2ts
aWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkCiAJc2V0X2F1eF9iYWNr
bGlnaHRfZW5hYmxlKGVuY190b19pbnRlbF9kcChvbGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVy
KSwgZmFsc2UpOwogfQogCitzdGF0aWMgaW50IGludGVsX2RwX2F1eF9zZXR1cF9jdXN0b21pemVf
YmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkJZW51bSBw
aXBlIHBpcGUpCit7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBh
bmVsOworCisJcGFuZWwtPmJhY2tsaWdodC5tYXggPSBFRFBfQ1VTVE9NSVpFX01BWF9CUklHSFRO
RVNTX0xFVkVMOworCXBhbmVsLT5iYWNrbGlnaHQubWluID0gMDsKKwlwYW5lbC0+YmFja2xpZ2h0
LmxldmVsID0gcGFuZWwtPmJhY2tsaWdodC5nZXQoY29ubmVjdG9yKTsKKwlwYW5lbC0+YmFja2xp
Z2h0LmVuYWJsZWQgPSBwYW5lbC0+YmFja2xpZ2h0LmxldmVsICE9IDA7CisKKwlyZXR1cm4gMDsK
K30KKwogc3RhdGljIGludCBpbnRlbF9kcF9hdXhfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCQkJZW51bSBwaXBlIHBpcGUpCiB7CkBAIC0yNjUs
NiArMzgzLDcgQEAgaW50IGludGVsX2RwX2F1eF9pbml0X2JhY2tsaWdodF9mdW5jcyhzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCiB7CiAJc3RydWN0IGludGVsX3BhbmVs
ICpwYW5lbCA9ICZpbnRlbF9jb25uZWN0b3ItPnBhbmVsOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmaW50ZWxfY29ubmVjdG9y
LT5lbmNvZGVyLT5iYXNlKTsKIAogCWlmIChpOTE1X21vZHBhcmFtcy5lbmFibGVfZHBjZF9iYWNr
bGlnaHQgPT0gMCB8fAogCSAgICAoaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2RwY2RfYmFja2xpZ2h0
ID09IC0xICYmCkBAIC0yNzQsMTEgKzM5MywyMCBAQCBpbnQgaW50ZWxfZHBfYXV4X2luaXRfYmFj
a2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKIAlp
ZiAoIWludGVsX2RwX2F1eF9kaXNwbGF5X2NvbnRyb2xfY2FwYWJsZShpbnRlbF9jb25uZWN0b3Ip
KQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXBhbmVsLT5iYWNrbGlnaHQuc2V0dXAgPSBpbnRlbF9k
cF9hdXhfc2V0dXBfYmFja2xpZ2h0OwotCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlID0gaW50ZWxf
ZHBfYXV4X2VuYWJsZV9iYWNrbGlnaHQ7Ci0JcGFuZWwtPmJhY2tsaWdodC5kaXNhYmxlID0gaW50
ZWxfZHBfYXV4X2Rpc2FibGVfYmFja2xpZ2h0OwotCXBhbmVsLT5iYWNrbGlnaHQuc2V0ID0gaW50
ZWxfZHBfYXV4X3NldF9iYWNrbGlnaHQ7Ci0JcGFuZWwtPmJhY2tsaWdodC5nZXQgPSBpbnRlbF9k
cF9hdXhfZ2V0X2JhY2tsaWdodDsKKwlpZiAoZHJtX2RwX2hhc19xdWlyaygmaW50ZWxfZHAtPmRl
c2MsCisJICAgIERQX0RQQ0RfUVVJUktfQ1VTVE9NSVpFX0JSSUdIVE5FU1NfQ09OVFJPTCkpIHsK
KwkJcGFuZWwtPmJhY2tsaWdodC5zZXR1cCAgID0gaW50ZWxfZHBfYXV4X3NldHVwX2N1c3RvbWl6
ZV9iYWNrbGlnaHQ7CisJCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlICA9IGludGVsX2RwX2F1eF9l
bmFibGVfY3VzdG9taXplX2JhY2tsaWdodDsKKwkJcGFuZWwtPmJhY2tsaWdodC5kaXNhYmxlID0g
aW50ZWxfZHBfYXV4X2Rpc2FibGVfY3VzdG9taXplX2JhY2tsaWdodDsKKwkJcGFuZWwtPmJhY2ts
aWdodC5zZXQgPSBpbnRlbF9kcF9hdXhfc2V0X2N1c3RvbWl6ZV9iYWNrbGlnaHQ7CisJCXBhbmVs
LT5iYWNrbGlnaHQuZ2V0ID0gaW50ZWxfZHBfYXV4X2dldF9jdXN0b21pemVfYmFja2xpZ2h0Owor
CX0gZWxzZSB7CisJCXBhbmVsLT5iYWNrbGlnaHQuc2V0dXAgICA9IGludGVsX2RwX2F1eF9zZXR1
cF9iYWNrbGlnaHQ7CisJCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlICA9IGludGVsX2RwX2F1eF9l
bmFibGVfYmFja2xpZ2h0OworCQlwYW5lbC0+YmFja2xpZ2h0LmRpc2FibGUgPSBpbnRlbF9kcF9h
dXhfZGlzYWJsZV9iYWNrbGlnaHQ7CisJCXBhbmVsLT5iYWNrbGlnaHQuc2V0ID0gaW50ZWxfZHBf
YXV4X3NldF9iYWNrbGlnaHQ7CisJCXBhbmVsLT5iYWNrbGlnaHQuZ2V0ID0gaW50ZWxfZHBfYXV4
X2dldF9iYWNrbGlnaHQ7CisJfQogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9pbmNsdWRl
L2RybS9kcm1fZHBfaGVscGVyLmggYi9pbmNsdWRlL2RybS9kcm1fZHBfaGVscGVyLmgKaW5kZXgg
ZWQxYTk4NTc0NWJhLi41ODFkMWJhODQzNWQgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9k
cF9oZWxwZXIuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZHBfaGVscGVyLmgKQEAgLTc0MCw2ICs3
NDAsMjAgQEAKIC8qIHVwIHRvIElEX1NMT1RfNjMgYXQgMHgyZmYgKi8KIAogI2RlZmluZSBEUF9T
T1VSQ0VfT1VJCQkJICAgIDB4MzAwCisjZGVmaW5lIERQX0VEUF9UQ09OX0NBUEFCSUxJVFlfQllU
RTAJICAgIDB4MzQwCisKKyNkZWZpbmUgRFBfRURQX1RDT05fQ0FQQUJJTElUWV9CWVRFMQkgICAg
MHgzNDEKKyMgZGVmaW5lIERQX0JSSUdIVE5FU1NfQ09OVFJPTF9OSVRTCSAgICAweDEwCisKKyNk
ZWZpbmUgRFBfRURQX1RDT05fQ0FQQUJJTElUWV9CWVRFMgkgICAgMHgzNDIKKyMgZGVmaW5lIERQ
X0JSSUdIVE5FU1NfQ09OVFJPTF9CWV9BVVgJICAgIDB4MDEKKworI2RlZmluZSBEUF9FRFBfR0VU
U0VUX0NUUkxfUEFSQU1TCSAgICAweDM0NAorI2RlZmluZSBEUF9FRFBfQ09OVEVOVF9MVU1JTkFO
Q0UJICAgIDB4MzQ2CisjZGVmaW5lIERQX0VEUF9QQU5FTF9MVU1JTkFOQ0VfT1ZFUlJJREUgICAg
IDB4MzRBCisjZGVmaW5lIERQX0VEUF9CUklHSFRORVNTX05JVFMJCSAgICAweDM1NAorI2RlZmlu
ZSBEUF9FRFBfQlJJR0hUTkVTU19PUFRJTUlaQVRJT04JICAgIDB4MzU4CisKICNkZWZpbmUgRFBf
U0lOS19PVUkJCQkgICAgMHg0MDAKICNkZWZpbmUgRFBfQlJBTkNIX09VSQkJCSAgICAweDUwMAog
I2RlZmluZSBEUF9CUkFOQ0hfSUQgICAgICAgICAgICAgICAgICAgICAgICAweDUwMwpAQCAtMTQ3
NSw2ICsxNDg5LDEyIEBAIGVudW0gZHJtX2RwX3F1aXJrIHsKIAkgKiBUaGUgZHJpdmVyIHNob3Vs
ZCBpZ25vcmUgU0lOS19DT1VOVCBkdXJpbmcgZGV0ZWN0aW9uLgogCSAqLwogCURQX0RQQ0RfUVVJ
UktfTk9fU0lOS19DT1VOVCwKKwkvKioKKwkgKiBARFBfRFBDRF9RVUlSS19OT05fU1RBTkRBUkRf
QlJJR0hUTkVTU19DT05UUk9MOgorCSAqCisJICogVGhlIGRldmljZSB1c2VkIHNwZWNpZmljIERQ
Q0QgcmVnaXN0ZXIgdG8gY29udHJvbCBicmlnaHRuZXNzLgorCSAqLworCURQX0RQQ0RfUVVJUktf
Q1VTVE9NSVpFX0JSSUdIVE5FU1NfQ09OVFJPTCwKIH07CiAKIC8qKgotLSAKMi4xNy4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
