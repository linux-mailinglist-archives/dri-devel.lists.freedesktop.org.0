Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 492D91BD45
	for <lists+dri-devel@lfdr.de>; Mon, 13 May 2019 20:37:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F4A3891DC;
	Mon, 13 May 2019 18:37:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x543.google.com (mail-pg1-x543.google.com
 [IPv6:2607:f8b0:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DE0DA891D4
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 18:37:35 +0000 (UTC)
Received: by mail-pg1-x543.google.com with SMTP id w22so7201272pgi.6
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 11:37:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=hz3ZGtoAymkx6t8CRx6nzIb0wfkZta9h4Him4Tyc0Qg=;
 b=Ve+nv3oUKZNPsvveozbdvKqUvdz1FnSfKX5qTVFaINNfw7LdbwBNEAeY1VwDiHDDA8
 GWg6X3AXKY8BJDbzQO3drAs/dquaTeiMl+o7JAfTL/oeElirJyQKlm64QNNp95L3QWWF
 akUD5rIsrayFzdfs2G+u/LTawaZUND9ysluaOthsreuaMlThz/e6KVI8P5c4b1JmYeWs
 8Mm7Dm6K59ZEz1i4aj2S7K/cBD6L6PWxXruU3RSI+6j5aJOpyOIfbh18hEW/up6lgpdT
 RjbNGkSgWO4O3yB6b+iCO9XO0ury7bdT86yedYOl8OjSDOqqqGFqKpFFZCq/iUl1qTNe
 dnxQ==
X-Gm-Message-State: APjAAAU+mp4c0PPdTYoo2oA2IKmO2BrQA05bhM4ViAq8bL0iTpokvVXY
 jM4k7T1eplzui4c3HM3f1epxtA==
X-Google-Smtp-Source: APXvYqyK4NnZKSimS2Z6YiFEMmckA26zjmHx/NLhwAahG04NSE5vlfx5aBkeZUEDBhbscNc0MW2sJw==
X-Received: by 2002:a65:6659:: with SMTP id z25mr33066763pgv.10.1557772655342; 
 Mon, 13 May 2019 11:37:35 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:4e72:b9ff:fe99:466a])
 by smtp.gmail.com with ESMTPSA id
 u11sm17334881pfh.130.2019.05.13.11.37.33
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 13 May 2019 11:37:34 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH 2/5 v4] dma-buf: heaps: Add heap helpers
Date: Mon, 13 May 2019 11:37:24 -0700
Message-Id: <20190513183727.15755-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190513183727.15755-1-john.stultz@linaro.org>
References: <20190513183727.15755-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=hz3ZGtoAymkx6t8CRx6nzIb0wfkZta9h4Him4Tyc0Qg=;
 b=pvpkBGXVzKfKWGXQGmMHOJ8L8VHi+CfFfXuwrBVLL/uvzV6YTP1fhJ5E6zJTOjMBbG
 ahTJd9ZHNL5zIwbehZI8xrFyJO8n6PkVli5F0RfX6wjjUGw7Uw5xRMXFAqxYaHu9TTb+
 WfHCptIUK47k4x2Djuus6YXY8PF+f4NAQHlaruEq6iRa+hZr7YkW5ZC6WCTxs0YM6P/s
 SVD6wa/QsSZZ7q4QVlVH3osNU6BVeNkLtgQbIa695w3s27rSsRKvLMCaiuvVOCfJ9QUC
 rzpmwg1X1RzjDO7iHyI/gNS51H9o6J52Bds3Bmy0VAoyAXuTFDk6djZA95AxrDN7NkRJ
 6eDw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Yudongbin <yudongbin@hisilicon.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Xu YiPing <xuyiping@hisilicon.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>,
 "Chenfeng \(puck\)" <puck.chen@hisilicon.com>, dri-devel@lists.freedesktop.org,
 Chenbo Feng <fengc@google.com>, Alistair Strachan <astrachan@google.com>,
 Liam Mark <lmark@codeaurora.org>, Christoph Hellwig <hch@infradead.org>,
 "Xiaqing \(A\)" <saberlily.xia@hisilicon.com>, "Andrew F . Davis" <afd@ti.com>,
 Pratik Patel <pratikp@codeaurora.org>, butao <butao@hisilicon.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGdlbmVyaWMgaGVscGVyIGRtYWJ1ZiBvcHMgZm9yIGRtYSBoZWFwcywgc28gd2UgY2FuIHJl
ZHVjZQp0aGUgYW1vdW50IG9mIGR1cGxpY2F0aXZlIGNvZGUgZm9yIHRoZSBleHBvcnRlZCBkbWFi
dWZzLgoKVGhpcyBjb2RlIGlzIGFuIGV2b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVt
ZW50YXRpb24sIHNvCnRoYW5rcyB0byBpdHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50
ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBaYXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwg
YW5kIG90aGVycyEKCkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQg
U2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29k
ZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsgUGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNj
OiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5l
Zm9ydCA8VmluY2VudC5Eb25uZWZvcnRAYXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0
by5QYXVsQGFybS5jb20+CkNjOiBBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBYdSBZ
aVBpbmcgPHh1eWlwaW5nQGhpc2lsaWNvbi5jb20+CkNjOiAiQ2hlbmZlbmcgKHB1Y2spIiA8cHVj
ay5jaGVuQGhpc2lsaWNvbi5jb20+CkNjOiBidXRhbyA8YnV0YW9AaGlzaWxpY29uLmNvbT4KQ2M6
ICJYaWFxaW5nIChBKSIgPHNhYmVybGlseS54aWFAaGlzaWxpY29uLmNvbT4KQ2M6IFl1ZG9uZ2Jp
biA8eXVkb25nYmluQGhpc2lsaWNvbi5jb20+CkNjOiBDaHJpc3RvcGggSGVsbHdpZyA8aGNoQGlu
ZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8gRmVuZyA8ZmVuZ2NAZ29vZ2xlLmNvbT4KQ2M6IEFsaXN0
YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5AZ29vZ2xlLmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKU2lnbmVkLW9mZi1ieTogSm9obiBTdHVsdHogPGpvaG4uc3R1bHR6QGxp
bmFyby5vcmc+Ci0tLQp2MjoKKiBSZW1vdmVkIGNhY2hlIG1hbmFnZW1lbnQgcGVyZm9ybWFuY2Ug
aGFjayB0aGF0IEkgaGFkCiAgYWNjaWRlbnRhbGx5IGZvbGRlZCBpbi4KKiBSZW1vdmVkIHN0YXRz
IGNvZGUgdGhhdCB3YXMgaW4gaGVscGVycwoqIExvdHMgb2YgY2hlY2twYXRjaCBjbGVhbnVwcwp2
MzoKKiBVbmlubGluZSBJTklUX0hFQVBfSEVMUEVSX0JVRkZFUiAoc3VnZ2VzdGVkIGJ5IENocmlz
dG9waCkKKiBTd2l0Y2ggdG8gV0FSTiBvbiBidWZmZXIgZGVzdHJveSBmYWlsdXJlIChzdWdnZXN0
ZWQgYnkgQnJpYW4pCiogYnVmZmVyLT5rbWFwX2NudCBkZWNyZW1lbnRpbmcgY2xlYW51cCAoc3Vn
Z2VzdGVkIGJ5IENocmlzdG9waCkKKiBFeHRyYSBidWZmZXItPnZhZGRyIGNoZWNraW5nIGluIGRt
YV9oZWFwX2RtYV9idWZfa21hcAogIChzdWdnZXN0ZWQgYnkgQnJpYW4pCiogU3dpdGNoIHRvX2hl
bHBlcl9idWZmZXIgZnJvbSBtYWNybyB0byBpbmxpbmUgZnVuY3Rpb24KICAoc3VnZ2VzdGVkIGJ5
IEJlbmphbWluKQoqIFJlbmFtZSBrbWFwLT52bWFwIChmb2xkZWQgaW4gZnJvbSBBbmRyZXcpCiog
VXNlIHZtYXAgZm9yIHZtYXBwaW5nIC0gbm90IGJlZ2luX2NwdV9hY2Nlc3MgKGZvbGRlZCBpbiBm
cm9tCiAgQW5kcmV3KQoqIERyb3Aga21hcCBmb3Igbm93LCBhcyBpdHMgb3B0aW9uYWwgKGZvbGRl
ZCBpbiBmcm9tIEFuZHJldykKKiBGb2xkIGRtYV9oZWFwX21hcF91c2VyIGludG8gdGhlIHNpbmds
ZSBjYWxsZXIgKGZvbGVkIGluIGZyb20KICBBbmRyZXcpCiogRm9sZGVkIGluIHBhdGNoIGZyb20g
QW5kcmV3IHRvIHRyYWNrIHBhZ2UgbGlzdCBwZXIgaGVhcCBub3QKICBzZ2xpc3QsIHdoaWNoIHNp
bXBsaWZpZXMgdGhlIHRyYWNraW5nIGxvZ2ljCnY0OgoqIE1vdmVkIGRtYS1oZWFwLmggY2hhbmdl
IG91dCB0byBwcmV2aW91cyBwYXRjaAotLS0KIGRyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSAgICAg
ICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgICAgICAgfCAg
IDIgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jIHwgMjYxICsrKysrKysr
KysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5o
IHwgIDU1ICsrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAzMTkgaW5zZXJ0aW9ucygrKQogY3JlYXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuYwogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuaAoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQppbmRl
eCBiMDMzMmYxNDM0MTMuLjA5YzJmMmRiOWNmNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVm
L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQpAQCAtMSw0ICsxLDUgQEAK
IG9iai15IDo9IGRtYS1idWYubyBkbWEtZmVuY2UubyBkbWEtZmVuY2UtYXJyYXkubyByZXNlcnZh
dGlvbi5vIHNlcW5vLWZlbmNlLm8KK29iai0kKENPTkZJR19ETUFCVUZfSEVBUFMpCSs9IGhlYXBz
Lwogb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQUykJKz0gZG1hLWhlYXAubwogb2JqLSQoQ09ORklH
X1NZTkNfRklMRSkJCSs9IHN5bmNfZmlsZS5vCiBvYmotJChDT05GSUdfU1dfU1lOQykJCSs9IHN3
X3N5bmMubyBzeW5jX2RlYnVnLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9N
YWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmRlNDk4OTgxMTJkYgotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMCwwICsxLDIgQEAKKyMgU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKK29iai15CQkJCQkrPSBoZWFwLWhlbHBlcnMubwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jIGIvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uMDBjYmRiYmI5N2U1Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9k
bWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCkBAIC0wLDAgKzEsMjYxIEBACisvLyBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNpbmNsdWRl
IDxsaW51eC9pZHIuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgv
c2xhYi5oPgorI2luY2x1ZGUgPGxpbnV4L3VhY2Nlc3MuaD4KKyNpbmNsdWRlIDx1YXBpL2xpbnV4
L2RtYS1oZWFwLmg+CisKKyNpbmNsdWRlICJoZWFwLWhlbHBlcnMuaCIKKwordm9pZCBJTklUX0hF
QVBfSEVMUEVSX0JVRkZFUihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIsCisJCQkg
ICAgIHZvaWQgKCpmcmVlKShzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICopKQoreworCWJ1ZmZl
ci0+cHJpdmF0ZV9mbGFncyA9IDA7CisJYnVmZmVyLT5wcml2X3ZpcnQgPSBOVUxMOworCW11dGV4
X2luaXQoJmJ1ZmZlci0+bG9jayk7CisJYnVmZmVyLT52bWFwX2NudCA9IDA7CisJYnVmZmVyLT52
YWRkciA9IE5VTEw7CisJSU5JVF9MSVNUX0hFQUQoJmJ1ZmZlci0+YXR0YWNobWVudHMpOworCWJ1
ZmZlci0+ZnJlZSA9IGZyZWU7Cit9CisKKworc3RhdGljIHZvaWQgKmRtYV9oZWFwX21hcF9rZXJu
ZWwoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXZvaWQgKnZhZGRyOwor
CisJdmFkZHIgPSB2bWFwKGJ1ZmZlci0+cGFnZXMsIGJ1ZmZlci0+cGFnZWNvdW50LCBWTV9NQVAs
IFBBR0VfS0VSTkVMKTsKKwlpZiAoIXZhZGRyKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsK
KworCXJldHVybiB2YWRkcjsKK30KKwordm9pZCBkbWFfaGVhcF9idWZmZXJfZGVzdHJveShzdHJ1
Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1ZmZlcikKK3sKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJf
YnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVyKTsKKworCWlmIChi
dWZmZXItPnZtYXBfY250ID4gMCkgeworCQlXQVJOKCIlczogYnVmZmVyIHN0aWxsIG1hcHBlZCBp
biB0aGUga2VybmVsXG4iLAorCQkJICAgICBfX2Z1bmNfXyk7CisJCXZ1bm1hcChidWZmZXItPnZh
ZGRyKTsKKwl9CisKKwlidWZmZXItPmZyZWUoYnVmZmVyKTsKK30KKworc3RhdGljIHZvaWQgKmRt
YV9oZWFwX2J1ZmZlcl92bWFwX2dldChzdHJ1Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1ZmZl
cikKK3sKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVm
ZmVyKGhlYXBfYnVmZmVyKTsKKwl2b2lkICp2YWRkcjsKKworCWlmIChidWZmZXItPnZtYXBfY250
KSB7CisJCWJ1ZmZlci0+dm1hcF9jbnQrKzsKKwkJcmV0dXJuIGJ1ZmZlci0+dmFkZHI7CisJfQor
CXZhZGRyID0gZG1hX2hlYXBfbWFwX2tlcm5lbChidWZmZXIpOworCWlmIChXQVJOX09OQ0UoIXZh
ZGRyLAorCQkgICAgICAiaGVhcC0+b3BzLT5tYXBfa2VybmVsIHNob3VsZCByZXR1cm4gRVJSX1BU
UiBvbiBlcnJvciIpKQorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKKwlpZiAoSVNfRVJSKHZh
ZGRyKSkKKwkJcmV0dXJuIHZhZGRyOworCWJ1ZmZlci0+dmFkZHIgPSB2YWRkcjsKKwlidWZmZXIt
PnZtYXBfY250Kys7CisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9i
dWZmZXJfdm1hcF9wdXQoc3RydWN0IGRtYV9oZWFwX2J1ZmZlciAqaGVhcF9idWZmZXIpCit7CisJ
c3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gdG9faGVscGVyX2J1ZmZlcihoZWFw
X2J1ZmZlcik7CisKKwlpZiAoIS0tYnVmZmVyLT52bWFwX2NudCkgeworCQl2dW5tYXAoYnVmZmVy
LT52YWRkcik7CisJCWJ1ZmZlci0+dmFkZHIgPSBOVUxMOworCX0KK30KKworc3RydWN0IGRtYV9o
ZWFwc19hdHRhY2htZW50IHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJc3RydWN0IHNnX3RhYmxl
IHRhYmxlOworCXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKK307CisKK3N0YXRpYyBpbnQgZG1hX2hl
YXBfYXR0YWNoKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkgICAgICBzdHJ1Y3QgZG1hX2J1
Zl9hdHRhY2htZW50ICphdHRhY2htZW50KQoreworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVu
dCAqYTsKKwlzdHJ1Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1ZmZlciA9IGRtYWJ1Zi0+cHJp
djsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVmZmVy
KGhlYXBfYnVmZmVyKTsKKwlpbnQgcmV0OworCisJYSA9IGt6YWxsb2Moc2l6ZW9mKCphKSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFhKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldCA9IHNnX2FsbG9j
X3RhYmxlX2Zyb21fcGFnZXMoJmEtPnRhYmxlLCBidWZmZXItPnBhZ2VzLAorCQkJCQlidWZmZXIt
PnBhZ2Vjb3VudCwgMCwKKwkJCQkJYnVmZmVyLT5wYWdlY291bnQgPDwgUEFHRV9TSElGVCwKKwkJ
CQkJR0ZQX0tFUk5FTCk7CisJaWYgKHJldCkgeworCQlrZnJlZShhKTsKKwkJcmV0dXJuIHJldDsK
Kwl9CisKKwlhLT5kZXYgPSBhdHRhY2htZW50LT5kZXY7CisJSU5JVF9MSVNUX0hFQUQoJmEtPmxp
c3QpOworCisJYXR0YWNobWVudC0+cHJpdiA9IGE7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxv
Y2spOworCWxpc3RfYWRkKCZhLT5saXN0LCAmYnVmZmVyLT5hdHRhY2htZW50cyk7CisJbXV0ZXhf
dW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRt
YV9oZWFwX2RldGF0Y2goc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCQlzdHJ1Y3QgZG1hX2J1
Zl9hdHRhY2htZW50ICphdHRhY2htZW50KQoreworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVu
dCAqYSA9IGF0dGFjaG1lbnQtPnByaXY7CisJc3RydWN0IGRtYV9oZWFwX2J1ZmZlciAqaGVhcF9i
dWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVy
ID0gdG9faGVscGVyX2J1ZmZlcihoZWFwX2J1ZmZlcik7CisKKwltdXRleF9sb2NrKCZidWZmZXIt
PmxvY2spOworCWxpc3RfZGVsKCZhLT5saXN0KTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9j
ayk7CisKKwlzZ19mcmVlX3RhYmxlKCZhLT50YWJsZSk7CisJa2ZyZWUoYSk7Cit9CisKK3N0YXRp
YyBzdHJ1Y3Qgc2dfdGFibGUgKmRtYV9oZWFwX21hcF9kbWFfYnVmKAorCQkJCQlzdHJ1Y3QgZG1h
X2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50LAorCQkJCQllbnVtIGRtYV9kYXRhX2RpcmVjdGlv
biBkaXJlY3Rpb24pCit7CisJc3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphID0gYXR0YWNo
bWVudC0+cHJpdjsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOworCisJdGFibGUgPSAmYS0+dGFi
bGU7CisKKwlpZiAoIWRtYV9tYXBfc2coYXR0YWNobWVudC0+ZGV2LCB0YWJsZS0+c2dsLCB0YWJs
ZS0+bmVudHMsCisJCQlkaXJlY3Rpb24pKQorCQl0YWJsZSA9IEVSUl9QVFIoLUVOT01FTSk7CisJ
cmV0dXJuIHRhYmxlOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF91bm1hcF9kbWFfYnVmKHN0
cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQsCisJCQkgICAgICBzdHJ1Y3Qgc2df
dGFibGUgKnRhYmxlLAorCQkJICAgICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9u
KQoreworCWRtYV91bm1hcF9zZyhhdHRhY2htZW50LT5kZXYsIHRhYmxlLT5zZ2wsIHRhYmxlLT5u
ZW50cywgZGlyZWN0aW9uKTsKK30KKworc3RhdGljIHZtX2ZhdWx0X3QgZG1hX2hlYXBfdm1fZmF1
bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCit7CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEg
PSB2bWYtPnZtYTsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSB2bWEtPnZt
X3ByaXZhdGVfZGF0YTsKKworCXZtZi0+cGFnZSA9IGJ1ZmZlci0+cGFnZXNbdm1mLT5wZ29mZl07
CisJZ2V0X3BhZ2Uodm1mLT5wYWdlKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qg
c3RydWN0IHZtX29wZXJhdGlvbnNfc3RydWN0IGRtYV9oZWFwX3ZtX29wcyA9IHsKKwkuZmF1bHQg
PSBkbWFfaGVhcF92bV9mYXVsdCwKK307CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBfbW1hcChzdHJ1
Y3QgZG1hX2J1ZiAqZG1hYnVmLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKK3sKKwlzdHJ1
Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3Qg
aGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVy
KTsKKworCWlmICgodm1hLT52bV9mbGFncyAmIChWTV9TSEFSRUQgfCBWTV9NQVlTSEFSRSkpID09
IDApCisJCXJldHVybiAtRUlOVkFMOworCisJdm1hLT52bV9vcHMgPSAmZG1hX2hlYXBfdm1fb3Bz
OworCXZtYS0+dm1fcHJpdmF0ZV9kYXRhID0gYnVmZmVyOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyB2b2lkIGRtYV9oZWFwX2RtYV9idWZfcmVsZWFzZShzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
KQoreworCXN0cnVjdCBkbWFfaGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwor
CWRtYV9oZWFwX2J1ZmZlcl9kZXN0cm95KGJ1ZmZlcik7Cit9CisKK3N0YXRpYyBpbnQgZG1hX2hl
YXBfZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFidWYsCisJCQkJ
CWVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBf
YnVmZmVyICpoZWFwX2J1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJf
YnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVyKTsKKwlzdHJ1Y3Qg
ZG1hX2hlYXBzX2F0dGFjaG1lbnQgKmE7CisJaW50IHJldCA9IDA7CisKKwltdXRleF9sb2NrKCZi
dWZmZXItPmxvY2spOworCWxpc3RfZm9yX2VhY2hfZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVu
dHMsIGxpc3QpIHsKKwkJZG1hX3N5bmNfc2dfZm9yX2NwdShhLT5kZXYsIGEtPnRhYmxlLnNnbCwg
YS0+dGFibGUubmVudHMsCisJCQkJICAgIGRpcmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygm
YnVmZmVyLT5sb2NrKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZG1hX2hlYXBf
ZG1hX2J1Zl9lbmRfY3B1X2FjY2VzcyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAorCQkJCSAgICAg
IGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBf
YnVmZmVyICpoZWFwX2J1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJf
YnVmZmVyICpidWZmZXIgPSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVyKTsKKwlzdHJ1Y3Qg
ZG1hX2hlYXBzX2F0dGFjaG1lbnQgKmE7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOwor
CWxpc3RfZm9yX2VhY2hfZW50cnkoYSwgJmJ1ZmZlci0+YXR0YWNobWVudHMsIGxpc3QpIHsKKwkJ
ZG1hX3N5bmNfc2dfZm9yX2RldmljZShhLT5kZXYsIGEtPnRhYmxlLnNnbCwgYS0+dGFibGUubmVu
dHMsCisJCQkJICAgICAgIGRpcmVjdGlvbik7CisJfQorCW11dGV4X3VubG9jaygmYnVmZmVyLT5s
b2NrKTsKKworCXJldHVybiAwOworfQorCit2b2lkICpkbWFfaGVhcF9kbWFfYnVmX3ZtYXAoc3Ry
dWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1
ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIg
PSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVyKTsKKwl2b2lkICp2YWRkcjsKKworCW11dGV4
X2xvY2soJmJ1ZmZlci0+bG9jayk7CisJdmFkZHIgPSBkbWFfaGVhcF9idWZmZXJfdm1hcF9nZXQo
aGVhcF9idWZmZXIpOworCW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKKworCXJldHVybiB2
YWRkcjsKK30KKwordm9pZCBkbWFfaGVhcF9kbWFfYnVmX3Z1bm1hcChzdHJ1Y3QgZG1hX2J1ZiAq
ZG1hYnVmLCB2b2lkICp2YWRkcikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBfYnVmZmVyICpoZWFwX2J1
ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIg
PSB0b19oZWxwZXJfYnVmZmVyKGhlYXBfYnVmZmVyKTsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+
bG9jayk7CisJZG1hX2hlYXBfYnVmZmVyX3ZtYXBfcHV0KGhlYXBfYnVmZmVyKTsKKwltdXRleF91
bmxvY2soJmJ1ZmZlci0+bG9jayk7Cit9CisKK2NvbnN0IHN0cnVjdCBkbWFfYnVmX29wcyBoZWFw
X2hlbHBlcl9vcHMgPSB7CisJLm1hcF9kbWFfYnVmID0gZG1hX2hlYXBfbWFwX2RtYV9idWYsCisJ
LnVubWFwX2RtYV9idWYgPSBkbWFfaGVhcF91bm1hcF9kbWFfYnVmLAorCS5tbWFwID0gZG1hX2hl
YXBfbW1hcCwKKwkucmVsZWFzZSA9IGRtYV9oZWFwX2RtYV9idWZfcmVsZWFzZSwKKwkuYXR0YWNo
ID0gZG1hX2hlYXBfYXR0YWNoLAorCS5kZXRhY2ggPSBkbWFfaGVhcF9kZXRhdGNoLAorCS5iZWdp
bl9jcHVfYWNjZXNzID0gZG1hX2hlYXBfZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNzLAorCS5lbmRf
Y3B1X2FjY2VzcyA9IGRtYV9oZWFwX2RtYV9idWZfZW5kX2NwdV9hY2Nlc3MsCisJLnZtYXAgPSBk
bWFfaGVhcF9kbWFfYnVmX3ZtYXAsCisJLnZ1bm1hcCA9IGRtYV9oZWFwX2RtYV9idWZfdnVubWFw
LAorfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuaCBi
L2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuaApuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLmExNzUwMmRjMjJlMwotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuaApAQCAtMCwwICsxLDU1IEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLworLyoKKyAqIERNQUJVRiBIZWFwcyBo
ZWxwZXIgY29kZQorICoKKyAqIENvcHlyaWdodCAoQykgMjAxMSBHb29nbGUsIEluYy4KKyAqIENv
cHlyaWdodCAoQykgMjAxOSBMaW5hcm8gTHRkLgorICovCisKKyNpZm5kZWYgX0hFQVBfSEVMUEVS
U19ICisjZGVmaW5lIF9IRUFQX0hFTFBFUlNfSAorCisjaW5jbHVkZSA8bGludXgvZG1hLWhlYXAu
aD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisKKy8qKgorICogc3RydWN0IGRtYV9oZWFwX2J1
ZmZlciAtIG1ldGFkYXRhIGZvciBhIHBhcnRpY3VsYXIgYnVmZmVyCisgKiBAaGVhcDoJCWJhY2sg
cG9pbnRlciB0byB0aGUgaGVhcCB0aGUgYnVmZmVyIGNhbWUgZnJvbQorICogQGRtYWJ1ZjoJCWJh
Y2tpbmcgZG1hLWJ1ZiBmb3IgdGhpcyBidWZmZXIKKyAqIEBzaXplOgkJc2l6ZSBvZiB0aGUgYnVm
ZmVyCisgKiBAZmxhZ3M6CQlidWZmZXIgc3BlY2lmaWMgZmxhZ3MKKyAqLworc3RydWN0IGRtYV9o
ZWFwX2J1ZmZlciB7CisJc3RydWN0IGRtYV9oZWFwICpoZWFwOworCXN0cnVjdCBkbWFfYnVmICpk
bWFidWY7CisJc2l6ZV90IHNpemU7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKK307CisKK3N0cnVj
dCBoZWFwX2hlbHBlcl9idWZmZXIgeworCXN0cnVjdCBkbWFfaGVhcF9idWZmZXIgaGVhcF9idWZm
ZXI7CisKKwl1bnNpZ25lZCBsb25nIHByaXZhdGVfZmxhZ3M7CisJdm9pZCAqcHJpdl92aXJ0Owor
CXN0cnVjdCBtdXRleCBsb2NrOworCWludCB2bWFwX2NudDsKKwl2b2lkICp2YWRkcjsKKwlwZ29m
Zl90IHBhZ2Vjb3VudDsKKwlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOworCXN0cnVjdCBsaXN0X2hlYWQg
YXR0YWNobWVudHM7CisKKwl2b2lkICgqZnJlZSkoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyKTsKKworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVy
ICp0b19oZWxwZXJfYnVmZmVyKAorCQkJCQkJc3RydWN0IGRtYV9oZWFwX2J1ZmZlciAqaCkKK3sK
KwlyZXR1cm4gY29udGFpbmVyX29mKGgsIHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIsIGhlYXBf
YnVmZmVyKTsKK30KKwordm9pZCBJTklUX0hFQVBfSEVMUEVSX0JVRkZFUihzdHJ1Y3QgaGVhcF9o
ZWxwZXJfYnVmZmVyICpidWZmZXIsCisJCQkJIHZvaWQgKCpmcmVlKShzdHJ1Y3QgaGVhcF9oZWxw
ZXJfYnVmZmVyICopKTsKK2V4dGVybiBjb25zdCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgaGVhcF9oZWxw
ZXJfb3BzOworCisjZW5kaWYgLyogX0hFQVBfSEVMUEVSU19IICovCi0tIAoyLjE3LjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWls
aW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
