Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F11E032DDC6
	for <lists+dri-devel@lfdr.de>; Fri,  5 Mar 2021 00:20:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2AE276EA89;
	Thu,  4 Mar 2021 23:20:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pj1-x1031.google.com (mail-pj1-x1031.google.com
 [IPv6:2607:f8b0:4864:20::1031])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B1216EA89
 for <dri-devel@lists.freedesktop.org>; Thu,  4 Mar 2021 23:20:21 +0000 (UTC)
Received: by mail-pj1-x1031.google.com with SMTP id s23so428290pji.1
 for <dri-devel@lists.freedesktop.org>; Thu, 04 Mar 2021 15:20:21 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=ii5pLXD2o0NGRI7J9va73Vq97pj3xACBVXZkTcA+ReU=;
 b=yQjXwBLc0O4odFqDIudXA0hwporccTe8AyopoQfYsvVJKuGq0mcsgQWYmabazWIQgG
 fP9zW5mFbccE6zRbj9xVs2DO5SqdaZ4tWxIihuCpm3T02yFIC6xtJsHWKU9qe1q0aNJy
 atfP525A+hA7ukkDjpvlx3MFGyYIPjd2UDjxR8drxMoxEiu4szP6fhvtbQZ4XXM/qWok
 nwKOVKMx6n6okVWrD8xOkcLwPFb7d4Kl9FMnqVBo+2ov44mVwftnF9HW0Bkbt8727Wod
 LqQcFwdx95lajJOBgJHUpi3CiDIvQ1BFWmKGvrElNBpnql8K/lucVrDh4Ad5mF9hgdp8
 fQWQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=ii5pLXD2o0NGRI7J9va73Vq97pj3xACBVXZkTcA+ReU=;
 b=RcJgJujsHvNyKkZ2qCJUeLwhHjUvzlPn75eRmZ8fm8h58whijr7nv3Gdi9KSdtoya2
 5eJTNmVOQf9Azwn4m0luyoNSPhJ/esBKcWA8hlCf5rRK2QaCReV7kyEoDA+9cwZK8bhy
 Lw8APnxQvyhuTOpBUJK2vL4WmE3mR40NMLSHW86B2DmCJ23AaS1/qWORq7EWqhC5iF5Q
 JR7mX46XGIHvgUesKefmktO7AOzNIBi1/wBFhMPHESqTlNsCeu/St+9q1PrlRAJeXIv3
 NXunaB6i70tkRdn87+hAauYJ+9L6f+kh3Nrkkic5/7AgWmIHNf0AByAcMebJnuuYZzdC
 uEAA==
X-Gm-Message-State: AOAM532Y0yK8UMNLhcC1GyHf9rBn3X3+puNzvrEGrNQV/k3jv02PQPpG
 F6Ppu3Xsa8rRi66SZqCu3eHIlA==
X-Google-Smtp-Source: ABdhPJzJwH4qXNcw/4c+SGoQp8DrK+YcikTPLI9do6sETSRiExO0Vk6pM5rfAx78p9/2e+ugdXohQw==
X-Received: by 2002:a17:902:124:b029:e3:fe16:fdf5 with SMTP id
 33-20020a1709020124b02900e3fe16fdf5mr6361806plb.1.1614900021199; 
 Thu, 04 Mar 2021 15:20:21 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 u66sm429290pfc.72.2021.03.04.15.20.19
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 04 Mar 2021 15:20:20 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v8 4/5] dma-buf: system_heap: Add drm pagepool support to
 system heap
Date: Thu,  4 Mar 2021 23:20:10 +0000
Message-Id: <20210304232011.1479036-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210304232011.1479036-1-john.stultz@linaro.org>
References: <20210304232011.1479036-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, Sandeep Patil <sspatil@google.com>,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Christian Koenig <christian.koenig@amd.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXRpbGl6ZSB0aGUgZHJtIHBhZ2Vwb29sIGNvZGUgdG8gc3BlZWQgdXAgYWxsb2NhdGlvbgpwZXJm
b3JtYW5jZS4KClRoaXMgaXMgc2ltaWxhciB0byB0aGUgSU9OIHBhZ2Vwb29sIHVzYWdlLCBidXQg
dHJpZXMgdG8KdXRpbGl6ZSBnZW5lcmljIGNvZGUgaW5zdGVhZCBvZiBhIGN1c3RvbSBpbXBsZW1l
bnRhdGlvbi4KCkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBDaHJpc3Rp
YW4gS29lbmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBTdW1pdCBTZW13YWwgPHN1
bWl0LnNlbXdhbEBsaW5hcm8ub3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9y
Zz4KQ2M6IENocmlzIEdvbGRzd29ydGh5IDxjZ29sZHN3b0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IExh
dXJhIEFiYm90dCA8bGFiYm90dEBrZXJuZWwub3JnPgpDYzogQnJpYW4gU3RhcmtleSA8QnJpYW4u
U3RhcmtleUBhcm0uY29tPgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlhQGdvb2dsZS5jb20+
CkNjOiBTdXJlbiBCYWdoZGFzYXJ5YW4gPHN1cmVuYkBnb29nbGUuY29tPgpDYzogU2FuZGVlcCBQ
YXRpbCA8c3NwYXRpbEBnb29nbGUuY29tPgpDYzogRGFuaWVsIE1lbnR6IDxkYW5pZWxtZW50ekBn
b29nbGUuY29tPgpDYzogw5hyamFuIEVpZGUgPG9yamFuLmVpZGVAYXJtLmNvbT4KQ2M6IFJvYmlu
IE11cnBoeSA8cm9iaW4ubXVycGh5QGFybS5jb20+CkNjOiBFemVxdWllbCBHYXJjaWEgPGV6ZXF1
aWVsQGNvbGxhYm9yYS5jb20+CkNjOiBTaW1vbiBTZXIgPGNvbnRhY3RAZW1lcnNpb24uZnI+CkNj
OiBKYW1lcyBKb25lcyA8amFqb25lc0BudmlkaWEuY29tPgpDYzogbGludXgtbWVkaWFAdmdlci5r
ZXJuZWwub3JnCkNjOiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClNpZ25lZC1vZmYt
Ynk6IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogRml4IGJ1
aWxkIGlzc3VlIGNhdXNlZCBieSBzZWxlY3RpbmcgUEFHRV9QT09MIHcvbyBORVQKICBhcyBSZXBv
cnRlZC1ieToga2VybmVsIHRlc3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+CnYzOgoqIFNpbXBsaWZ5
IHRoZSBwYWdlIHplcm9pbmcgbG9naWMgYSBiaXQgYnkgdXNpbmcga21hcF9hdG9taWMKICBpbnN0
ZWFkIG9mIHZtYXAgYXMgc3VnZ2VzdGVkIGJ5IERhbmllbCBNZW50egp2NToKKiBTaGlmdCBhd2F5
IGZyb20gbmV0d29ya2luZyBwYWdlIHBvb2wgY29tcGxldGVseSB0bwogIGRtYWJ1ZiBwYWdlIHBv
b2wgaW1wbGVtZW50YXRpb24KdjY6CiogU3dpdGNoIGFnYWluIHRvIHVzaW5nIHRoZSBkcm1fcGFn
ZV9wb29sIGNvZGUgc2hhcmVkIHcvCiAgdHRtX3Bvb2wKdjc6CiogU2xpZ2h0IHJld29yayBmb3Ig
ZHJtX3BhZ2VfcG9vbCBjaGFuZ2VzCnY4OgoqIFJld29yayB0byB1c2UgdGhlIHJld3JpdHRlbiBk
cm1fcGFnZV9wb29sIGxvZ2ljCiogRHJvcCBleHBsaWNpdCBidWZmZXIgemVyb2luZywgYXMgdGhl
IGRybV9wYWdlX3Bvb2wgaGFuZGxlcyB0aGF0Ci0tLQogZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tj
b25maWcgICAgICAgfCAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hlYXAuYyB8
IDI3ICsrKysrKysrKysrKysrKysrKysrKysrKy0tLQogMiBmaWxlcyBjaGFuZ2VkLCAyNSBpbnNl
cnRpb25zKCspLCAzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9o
ZWFwcy9LY29uZmlnIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKaW5kZXggZjdhZWY4
YmM3MTE5Li43ZTI4OTM0ZTBkZWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9L
Y29uZmlnCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCkBAIC00LDYgKzQsNyBA
QCBjb25maWcgRE1BQlVGX0hFQVBTX0RFRkVSUkVEX0ZSRUUKIGNvbmZpZyBETUFCVUZfSEVBUFNf
U1lTVEVNCiAJYm9vbCAiRE1BLUJVRiBTeXN0ZW0gSGVhcCIKIAlkZXBlbmRzIG9uIERNQUJVRl9I
RUFQUworCXNlbGVjdCBEUk1fUEFHRV9QT09MCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9u
IHRvIGVuYWJsZSB0aGUgc3lzdGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhlYXAKIAkgIGlz
IGJhY2tlZCBieSBwYWdlcyBmcm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGluIGRvdWJ0LCBz
YXkgWS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jIGIv
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKaW5kZXggMjllNDlhYzE3MjUxLi4w
MDYyNzE4ODFkODUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVh
cC5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCkBAIC0yMSw2ICsy
MSw4IEBACiAjaW5jbHVkZSA8bGludXgvc2xhYi5oPgogI2luY2x1ZGUgPGxpbnV4L3ZtYWxsb2Mu
aD4KIAorI2luY2x1ZGUgPGRybS9wYWdlX3Bvb2wuaD4KKwogc3RhdGljIHN0cnVjdCBkbWFfaGVh
cCAqc3lzX2hlYXA7CiAKIHN0cnVjdCBzeXN0ZW1faGVhcF9idWZmZXIgewpAQCAtNTMsNiArNTUs
NyBAQCBzdGF0aWMgZ2ZwX3Qgb3JkZXJfZmxhZ3NbXSA9IHtISUdIX09SREVSX0dGUCwgTE9XX09S
REVSX0dGUCwgTE9XX09SREVSX0dGUH07CiAgKi8KIHN0YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQg
b3JkZXJzW10gPSB7OCwgNCwgMH07CiAjZGVmaW5lIE5VTV9PUkRFUlMgQVJSQVlfU0laRShvcmRl
cnMpCitzdHJ1Y3QgZHJtX3BhZ2VfcG9vbCBwb29sc1tOVU1fT1JERVJTXTsKIAogc3RhdGljIHN0
cnVjdCBzZ190YWJsZSAqZHVwX3NnX3RhYmxlKHN0cnVjdCBzZ190YWJsZSAqdGFibGUpCiB7CkBA
IC0yODEsMTggKzI4NCwyOCBAQCBzdGF0aWMgdm9pZCBzeXN0ZW1faGVhcF92dW5tYXAoc3RydWN0
IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IGRtYV9idWZfbWFwICptYXApCiAJZG1hX2J1Zl9tYXBf
Y2xlYXIobWFwKTsKIH0KIAorc3RhdGljIHVuc2lnbmVkIGxvbmcgc3lzdGVtX2hlYXBfZnJlZV9w
YWdlcyhzdHJ1Y3QgZHJtX3BhZ2VfcG9vbCAqcG9vbCwgc3RydWN0IHBhZ2UgKnApCit7CisJX19m
cmVlX3BhZ2VzKHAsIHBvb2wtPm9yZGVyKTsKKwlyZXR1cm4gMSA8PCBwb29sLT5vcmRlcjsKK30K
Kwogc3RhdGljIHZvaWQgc3lzdGVtX2hlYXBfZG1hX2J1Zl9yZWxlYXNlKHN0cnVjdCBkbWFfYnVm
ICpkbWFidWYpCiB7CiAJc3RydWN0IHN5c3RlbV9oZWFwX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVm
LT5wcml2OwogCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7CiAJc3RydWN0IHNjYXR0ZXJsaXN0ICpz
ZzsKLQlpbnQgaTsKKwlpbnQgaSwgajsKIAogCXRhYmxlID0gJmJ1ZmZlci0+c2dfdGFibGU7CiAJ
Zm9yX2VhY2hfc2codGFibGUtPnNnbCwgc2csIHRhYmxlLT5uZW50cywgaSkgewogCQlzdHJ1Y3Qg
cGFnZSAqcGFnZSA9IHNnX3BhZ2Uoc2cpOwogCi0JCV9fZnJlZV9wYWdlcyhwYWdlLCBjb21wb3Vu
ZF9vcmRlcihwYWdlKSk7CisJCWZvciAoaiA9IDA7IGogPCBOVU1fT1JERVJTOyBqKyspIHsKKwkJ
CWlmIChjb21wb3VuZF9vcmRlcihwYWdlKSA9PSBvcmRlcnNbal0pCisJCQkJYnJlYWs7CisJCX0K
KwkJZHJtX3BhZ2VfcG9vbF9hZGQoJnBvb2xzW2pdLCBwYWdlKTsKIAl9CiAJc2dfZnJlZV90YWJs
ZSh0YWJsZSk7CiAJa2ZyZWUoYnVmZmVyKTsKQEAgLTMyMyw3ICszMzYsOSBAQCBzdGF0aWMgc3Ry
dWN0IHBhZ2UgKmFsbG9jX2xhcmdlc3RfYXZhaWxhYmxlKHVuc2lnbmVkIGxvbmcgc2l6ZSwKIAkJ
aWYgKG1heF9vcmRlciA8IG9yZGVyc1tpXSkKIAkJCWNvbnRpbnVlOwogCi0JCXBhZ2UgPSBhbGxv
Y19wYWdlcyhvcmRlcl9mbGFnc1tpXSwgb3JkZXJzW2ldKTsKKwkJcGFnZSA9IGRybV9wYWdlX3Bv
b2xfcmVtb3ZlKCZwb29sc1tpXSk7CisJCWlmICghcGFnZSkKKwkJCXBhZ2UgPSBhbGxvY19wYWdl
cyhvcmRlcl9mbGFnc1tpXSwgb3JkZXJzW2ldKTsKIAkJaWYgKCFwYWdlKQogCQkJY29udGludWU7
CiAJCXJldHVybiBwYWdlOwpAQCAtNDIzLDYgKzQzOCwxMiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGRtYV9oZWFwX29wcyBzeXN0ZW1faGVhcF9vcHMgPSB7CiBzdGF0aWMgaW50IHN5c3RlbV9oZWFw
X2NyZWF0ZSh2b2lkKQogewogCXN0cnVjdCBkbWFfaGVhcF9leHBvcnRfaW5mbyBleHBfaW5mbzsK
KwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBOVU1fT1JERVJTOyBpKyspIHsKKwkJZHJtX3Bh
Z2VfcG9vbF9pbml0KCZwb29sc1tpXSwgb3JkZXJzW2ldLAorCQkJCSAgIHN5c3RlbV9oZWFwX2Zy
ZWVfcGFnZXMpOworCX0KIAogCWV4cF9pbmZvLm5hbWUgPSAic3lzdGVtIjsKIAlleHBfaW5mby5v
cHMgPSAmc3lzdGVtX2hlYXBfb3BzOwotLSAKMi4yNS4xCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZl
bEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
