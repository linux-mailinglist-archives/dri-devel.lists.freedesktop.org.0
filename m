Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C156B99506F
	for <lists+dri-devel@lfdr.de>; Tue,  8 Oct 2024 15:41:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 32EAB10E544;
	Tue,  8 Oct 2024 13:41:23 +0000 (UTC)
Authentication-Results: gabe.freedesktop.org;
	dkim=pass (1024-bit key; unprotected) header.d=ideasonboard.com header.i=@ideasonboard.com header.b="KAx4tdC2";
	dkim-atps=neutral
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CCE6D10E1DE
 for <dri-devel@lists.freedesktop.org>; Mon,  7 Oct 2024 17:01:39 +0000 (UTC)
Received: from isaac-ThinkPad-T16-Gen-2.local
 (cpc89244-aztw30-2-0-cust6594.18-1.cable.virginm.net [86.31.185.195])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id 90ED1792;
 Mon,  7 Oct 2024 19:00:00 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=ideasonboard.com;
 s=mail; t=1728320401;
 bh=AbMEOw93QpMNA2VLo4O5BMIQ6k/dgsGjKI0UHF5F9yc=;
 h=Subject:From:To:Cc:Date:In-Reply-To:References:From;
 b=KAx4tdC2+hP7gWXw0kQgcd/huRYwMJ6wLpgLfYLxlw+vwF770PoE01iuMG/sucTRe
 19EjJgZJ8bzfgpGWIwH1YdmLmoHS85vvKnGqimzOPM3tNO/yUunbeB2ry7xWTpVoCT
 JZqGxArpraB98jG/B/WktnJkizqD4aXDg6jieJJY=
Message-ID: <7ae0cd7774f4b3e30cc033a7e543546732dbced0.camel@ideasonboard.com>
Subject: Re: [PATCH] drm: lcdif: Use adjusted_mode .clock instead of
 .crtc_clock
From: Isaac Scott <isaac.scott@ideasonboard.com>
To: Marek Vasut <marex@denx.de>, Alexander Stein
 <alexander.stein@ew.tq-group.com>, dri-devel@lists.freedesktop.org
Cc: Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@gmail.com>, Fabio
 Estevam <festevam@gmail.com>, Lucas Stach <l.stach@pengutronix.de>, "Lukas
 F . Hartmann"	 <lukas@mntmn.com>, Maarten Lankhorst
 <maarten.lankhorst@linux.intel.com>,  Maxime Ripard <mripard@kernel.org>,
 Pengutronix Kernel Team <kernel@pengutronix.de>, Sascha Hauer	
 <s.hauer@pengutronix.de>, Shawn Guo <shawnguo@kernel.org>, Stefan Agner	
 <stefan@agner.ch>, Thomas Zimmermann <tzimmermann@suse.de>,
 imx@lists.linux.dev, 	kernel@dh-electronics.com,
 linux-arm-kernel@lists.infradead.org, 	kieran.bingham@ideasonboard.com
Date: Mon, 07 Oct 2024 18:01:33 +0100
In-Reply-To: <ab2eb32e-a458-4c9b-8324-27ccb00336c5@denx.de>
References: <20240531202813.277109-1-marex@denx.de>
 <1897634.CQOukoFCf9@steina-w>
 <ab2eb32e-a458-4c9b-8324-27ccb00336c5@denx.de>
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
User-Agent: Evolution 3.54.0 (by Flathub.org) 
MIME-Version: 1.0
X-Mailman-Approved-At: Tue, 08 Oct 2024 13:41:08 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Hi Marek,

On Sat, 2024-07-06 at 02:16 +0200, Marek Vasut wrote:
> On 6/24/24 11:19 AM, Alexander Stein wrote:
> > Am Freitag, 31. Mai 2024, 22:27:21 CEST schrieb Marek Vasut:
> > > In case an upstream bridge modified the required clock frequency
> > > in its .atomic_check callback by setting adjusted_mode.clock ,
> > > make sure that clock frequency is generated by the LCDIFv3 block.
> > >=20
> > > This is useful e.g. when LCDIFv3 feeds DSIM which feeds TC358767
> > > with (e)DP output, where the TC358767 expects precise timing on
> > > its input side, the precise timing must be generated by the
> > > LCDIF.
> > >=20
> > > Signed-off-by: Marek Vasut <marex@denx.de>
> >=20
> > With the other rc358767 patches in place, this does the trick.
> > Reviewed-by: Alexander Stein <alexander.stein@ew.tq-group.com>
>=20
> I'll pick this up next week if there is no objection.

Unfortunately, this has caused a regression that is present in v6.12-
rc1 on the i.MX8MP PHYTEC Pollux using the
arch/arm64/boot/dts/freescale/imx8mp-phyboard-pollux-rdk.dts. The
display is the edt,etml1010g3dra panel, as per the upstream dts. We
bisected to this commit, and reverting this change fixed the screen.

We then tried to retest this on top of v6.12-rc2, and found we also had
to revert commit ff06ea04e4cf3ba2f025024776e83bfbdfa05155 ("clk: imx:
clk-imx8mp: Allow media_disp pixel clock reconfigure parent rate")
alongside this. Reverting these two commits makes the display work
again at -rc2.

Do you have any suggestions on anything we might be missing on our end?
Please let me know if there's anything you'd like me to test as I'm not
sure what the underlying fault was here.

Best wishes,
Isaac

=C2=A0

