Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5B0DEE13B6
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 10:10:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8D0256E9A0;
	Wed, 23 Oct 2019 08:10:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM02-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr770123.outbound.protection.outlook.com [40.107.77.123])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 61F236E5D3
 for <dri-devel@lists.freedesktop.org>; Tue, 22 Oct 2019 11:10:42 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=ktT+vw7f8VHyM1wxkVdy2M7xtKVcM+YfZraDChaCxEkyVug9hrOd+oRPAKfkvENAXpXmoRR5D1SkAqDfRxQghFE0FwBdL5TyG465lv/ccGYsdcXf/AQH1R/enqRwQJXRJ1qXOKdJUmRDyLr/am0po051M4wQA+5WqJNtpg4JuCVQ3trQjRKto+W/qJ8z9++ZpUUFUui62WujwXnTyiKMHYtfWqlgWmA53wOz8sR7n8e/pVNaWcW3/vfRq725279/Sufg7c4x5dYrys3I5kopvhZZDlbYNFLVidcKNGVyRcuiACp4sGClyYz4ukVLU13lWl5y68AnXjaOJl6gjHRO4A==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=BHSUGl34pj1HHUokjc4arZOyEuhujugHBngBTztkMeI=;
 b=L2EtojoccouRpDp0Cx1acJwhD/YGlWafbGXd1jT7guZXGI6uI05uCMmk5et6b7eIpgRdPPalH65R4hUvXhciqmseDxCHakWGXvKCQZ3nWw7iTdxTcg+Osy16C53LpN7sX3Kpuj0NAdftSBy1ED7AAbRPEknU4/yY72+4NZ00VyXezx3fy4+wQUZ092dMcRW2o0xHMuynNQZuBaMtUHqSwetpQvBi2knp7ctZtahbSz03vysGv1ZXMWY+CnwkjN59S4o0pCWwzDoLXcO5hg0UAwDCZ97lg5yaMAGouE/ouniU63OD1XGDVWOy5iTEI6PVUAoFncGUNE/lhcvIyoOGcA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from DM6PR21MB1401.namprd21.prod.outlook.com (10.255.109.88) by
 DM6PR21MB1259.namprd21.prod.outlook.com (20.179.50.205) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2387.14; Tue, 22 Oct 2019 11:10:39 +0000
Received: from DM6PR21MB1401.namprd21.prod.outlook.com
 ([fe80::f1f4:d235:9586:d22b]) by DM6PR21MB1401.namprd21.prod.outlook.com
 ([fe80::f1f4:d235:9586:d22b%2]) with mapi id 15.20.2387.019; Tue, 22 Oct 2019
 11:10:39 +0000
From: Wei Hu <weh@microsoft.com>
To: "b.zolnierkie@samsung.com" <b.zolnierkie@samsung.com>, KY Srinivasan
 <kys@microsoft.com>, Haiyang Zhang <haiyangz@microsoft.com>, Stephen
 Hemminger <sthemmin@microsoft.com>, "sashal@kernel.org" <sashal@kernel.org>,
 "hch@lst.de" <hch@lst.de>, "m.szyprowski@samsung.com"
 <m.szyprowski@samsung.com>, "robin.murphy@arm.com" <robin.murphy@arm.com>,
 "mchehab+samsung@kernel.org" <mchehab+samsung@kernel.org>, "sam@ravnborg.org"
 <sam@ravnborg.org>, "gregkh@linuxfoundation.org"
 <gregkh@linuxfoundation.org>, "alexandre.belloni@bootlin.com"
 <alexandre.belloni@bootlin.com>, "info@metux.net" <info@metux.net>,
 "arnd@arndb.de" <arnd@arndb.de>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "linux-fbdev@vger.kernel.org"
 <linux-fbdev@vger.kernel.org>, "linux-kernel@vger.kernel.org"
 <linux-kernel@vger.kernel.org>, "linux-hyperv@vger.kernel.org"
 <linux-hyperv@vger.kernel.org>, "iommu@lists.linux-foundation.org"
 <iommu@lists.linux-foundation.org>, "dcui@microsoft.com"
 <dcui@microsoft.com>, Michael Kelley <mikelley@microsoft.com>
Subject: [PATCH] video: hyperv: hyperv_fb: Use physical memory for fb on
 HyperV Gen 1 VMs.
Thread-Topic: [PATCH] video: hyperv: hyperv_fb: Use physical memory for fb on
 HyperV Gen 1 VMs.
Thread-Index: AQHViMlWrXYtpApox02C+wFzOSr7Mg==
Date: Tue, 22 Oct 2019 11:10:39 +0000
Message-ID: <20191022110905.4032-1-weh@microsoft.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: SG2PR04CA0130.apcprd04.prod.outlook.com
 (2603:1096:3:16::14) To DM6PR21MB1401.namprd21.prod.outlook.com
 (2603:10b6:5:22d::24)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.20.1
x-originating-ip: [167.220.255.113]
x-ms-publictraffictype: Email
x-ms-office365-filtering-ht: Tenant
x-ms-office365-filtering-correlation-id: 4a1af491-9518-4244-7875-08d756e078c8
x-ms-traffictypediagnostic: DM6PR21MB1259:|DM6PR21MB1259:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <DM6PR21MB12599C11A66D7F3BF1734BD4BB680@DM6PR21MB1259.namprd21.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:2150;
x-forefront-prvs: 01986AE76B
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(4636009)(376002)(396003)(346002)(136003)(39860400002)(366004)(199004)(189003)(81166006)(81156014)(4326008)(102836004)(66066001)(386003)(478600001)(6506007)(5660300002)(10290500003)(8676002)(25786009)(26005)(1511001)(86362001)(52116002)(50226002)(1250700005)(186003)(14454004)(2906002)(486006)(66946007)(66476007)(66556008)(64756008)(66446008)(2616005)(6512007)(2501003)(3450700001)(476003)(10090500001)(3846002)(71200400001)(6116002)(7736002)(6436002)(43066004)(305945005)(36756003)(1076003)(6486002)(71190400001)(22452003)(316002)(8936002)(107886003)(110136005)(6636002)(7416002)(2201001)(256004)(99286004)(14444005)(921003)(1121003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:DM6PR21MB1259;
 H:DM6PR21MB1401.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
received-spf: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam: BCL:0;
x-microsoft-antispam-message-info: PQU+7VaUvGj1mqm91W0omWbc87ppLVYaJwOdYTLlr5kFwcP200ZLc6a3+p+7vj7CwE3t+WnjpXGUpvRozZlAEeVDKNZsMYus4WFJ/d3XD04y03WQzxstUt4x1B9qzs4p+MWgmYzCRJnsA2JzU8PHMcLmPgR115fgiQsx0Cr42iweTeBoJF+SisF1Sg+Lqu4lwMT4Omor3UCONal9q6xfiwHDptBLpQa83iXWI/oEoVEGGd2mRcfufzNPYMUxj0N9DenxQYRDX49Y3nlZKy2o0DYO5FNA525kXJe0C8h6ogKz5xR0MWzD67AQQky182j4w6mONQ7f8S/EnZwNT4iDUpTpuRuVBkYPy/9IC/5Vk/4v8cftFuvTxtfXby8rdH8J1mleZloj7tc4+EJy6dgo8TawTlVv3XEkHwv7NxePf7T0RhxO46y6+l9h4/0JzYWQ
MIME-Version: 1.0
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 4a1af491-9518-4244-7875-08d756e078c8
X-MS-Exchange-CrossTenant-originalarrivaltime: 22 Oct 2019 11:10:39.8313 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: ra9Ep++yvm7iQqxw4kL7JFE6dMDwH0cJJxogZMyhTOwMlD+Fkt0EgPUcXBX5L7w4lmgOAG51qoZMhAzmi/+RIw==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR21MB1259
X-Mailman-Approved-At: Wed, 23 Oct 2019 08:09:38 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=BHSUGl34pj1HHUokjc4arZOyEuhujugHBngBTztkMeI=;
 b=E3qoSZTrypLrZRvMcCYGGsj3RF8BHYKP38mpJR+6Dt2/30cC9DvYCQjxKX94+raRln+ldyfwgvFe8zT/mbjNvzflkCeUfzgVJrXq60umdiy3tNq/+lLIbgbQX6ahglEmCRDao0x0jA2n8PwPsVH/IxaAN10QC37atyEx1RMKdtw=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: Wei Hu <weh@microsoft.com>
Cc: Wei Hu <weh@microsoft.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gSHlwZXItViwgR2VuZXJhdGlvbiAxIFZNcyBjYW4gZGlyZWN0bHkgdXNlIFZNJ3MgcGh5c2lj
YWwgbWVtb3J5IGZvcgp0aGVpciBmcmFtZWJ1ZmZlcnMuIFRoaXMgY2FuIGltcHJvdmUgdGhlIGVm
ZmljaWVuY3kgb2YgZnJhbWVidWZmZXIgYW5kCm92ZXJhbGwgcGVyZm9ybWVuY2UgZm9yIFZNLiBU
aGUgcGh5c2ljYWwgbWVtb3J5IGFzc2lnbmVkIHRvIGZyYW1lYnVmZmVyCm11c3QgYmUgY29udGln
dW91cy4gV2UgdXNlIENNQSBhbGxvY2F0b3IgdG8gZ2V0IGNvbnRpZ3VvdXNlIHBoeXNpY2lhbApt
ZW1vcnkgd2hlbiB0aGUgZnJhbWVidWZmZXIgc2l6ZSBpcyBncmVhdGVyIHRoYW4gNE1CLiBGb3Ig
c2l6ZSB1bmRlcgo0TUIsIHdlIHVzZSBhbGxvY19wYWdlcyB0byBhY2hpZXZlIHRoaXMuCgpUbyBl
bmFibGUgZnJhbWVidWZmZXIgbWVtb3J5IGFsbG9jYXRpb24gZnJvbSBDTUEsIHN1cHBseSBhIGtl
cm5lbApwYXJhbWV0ZXIgdG8gZ2l2ZSBlbm91Z2ggc3BhY2UgdG8gQ01BIGFsbG9jYXRvciBhdCBi
b290IHRpbWUuIEZvcgpleGFtcGxlOgogICAgY21hPTEzMG0KVGhpcyBnaXZlcyAxMzBNQiBtZW1v
cnkgdG8gQ0FNIGFsbG9jYXRvciB0aGF0IGNhbiBiZSBhbGxvY2F0ZWQgdG8KZnJhbWVidWZmZXIu
IElmIHRoaXMgZmFpbHMsIHdlIGZhbGwgYmFjayB0byB0aGUgb2xkIHdheSBvZiB1c2luZwptbWlv
IGZvciBmcmFtZWJ1ZmZlci4KClNpZ25lZC1vZmYtYnk6IFdlaSBIdSA8d2VoQG1pY3Jvc29mdC5j
b20+Ci0tLQogZHJpdmVycy92aWRlby9mYmRldi9LY29uZmlnICAgICB8ICAgMSArCiBkcml2ZXJz
L3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jIHwgMTc5ICsrKysrKysrKysrKysrKysrKysrKysrKyst
LS0tLS0tCiBrZXJuZWwvZG1hL2NvbnRpZ3VvdXMuYyAgICAgICAgIHwgICAyICsKIDMgZmlsZXMg
Y2hhbmdlZCwgMTQ3IGluc2VydGlvbnMoKyksIDM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZpZyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZp
ZwppbmRleCBhYTk1NDFiZjk2NGIuLmY1MzQwNTk0NjFlZSAxMDA2NDQKLS0tIGEvZHJpdmVycy92
aWRlby9mYmRldi9LY29uZmlnCisrKyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZpZwpAQCAt
MjIxNSw2ICsyMjE1LDcgQEAgY29uZmlnIEZCX0hZUEVSVgogCXNlbGVjdCBGQl9DRkJfQ09QWUFS
RUEKIAlzZWxlY3QgRkJfQ0ZCX0lNQUdFQkxJVAogCXNlbGVjdCBGQl9ERUZFUlJFRF9JTworCXNl
bGVjdCBETUFfQ01BCiAJaGVscAogCSAgVGhpcyBmcmFtZWJ1ZmZlciBkcml2ZXIgc3VwcG9ydHMg
TWljcm9zb2Z0IEh5cGVyLVYgU3ludGhldGljIFZpZGVvLgogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jIGIvZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIu
YwppbmRleCAzZjYwYjdiYzg1ODkuLmVhMmZkMzQ4MTIyNSAxMDA2NDQKLS0tIGEvZHJpdmVycy92
aWRlby9mYmRldi9oeXBlcnZfZmIuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5cGVydl9m
Yi5jCkBAIC0zMSw2ICszMSwxNiBAQAogICogInNldC12bXZpZGVvIiBjb21tYW5kLiBGb3IgZXhh
bXBsZQogICogICAgIHNldC12bXZpZGVvIC12bW5hbWUgbmFtZSAtaG9yaXpvbnRhbHJlc29sdXRp
b246MTkyMCBcCiAgKiAtdmVydGljYWxyZXNvbHV0aW9uOjEyMDAgLXJlc29sdXRpb250eXBlIHNp
bmdsZQorICoKKyAqIEdlbiAxIFZNcyBhbHNvIHN1cHBvcnQgZGlyZWN0bHkgdXNpbmcgVk0ncyBw
aHlpc2NhbCBtZW1vcnkgZm9yIGZyYW1lYnVmZmVyLgorICogSXQgY291bGQgaW1wcm92ZSB0aGUg
ZWZmaWNpZW5jeSBhbmQgcGVyZm9ybWFuY2UgZm9yIGZyYW1lYnVmZmVyIGFuZCBWTS4KKyAqIFRo
aXMgcmVxdWlyZXMgdG8gYWxsb2NhdGUgY29udGlndW91cyBwaHlzaWNhbCBtZW1vcnkgZnJvbSBM
aW51eCBrZXJuZWwncworICogQ01BIG1lbW9yeSBhbGxvY2F0b3IuIFRvIGVuYWJsZSB0aGlzLCBz
dXBwbHkgYSBrZXJuZWwgcGFyYW1ldGVyIHRvIGdpdmUKKyAqIGVub3VnaCBtZW1vcnkgc3BhY2Ug
dG8gQ01BIGFsbG9jYXRvciBmb3IgZnJhbWVidWZmZXIuIEZvciBleGFtcGxlOgorICogICAgY21h
PTEzMG0KKyAqIFRoaXMgZ2l2ZXMgMTMwTUIgbWVtb3J5IHRvIENNQSBhbGxvY2F0b3IgdGhhdCBj
YW4gYmUgYWxsb2NhdGVkIHRvCisgKiBmcmFtZWJ1ZmZlci4gRm9yIHJlZmVyZW5jZSwgOEsgcmVz
b2x1dGlvbiAoNzY4MHg0MzIwKSB0YWtlcyBhYm91dAorICogMTI3TUIgbWVtb3J5LgogICovCiAK
ICNkZWZpbmUgcHJfZm10KGZtdCkgS0JVSUxEX01PRE5BTUUgIjogIiBmbXQKQEAgLTQyLDYgKzUy
LDcgQEAKICNpbmNsdWRlIDxsaW51eC9mYi5oPgogI2luY2x1ZGUgPGxpbnV4L3BjaS5oPgogI2lu
Y2x1ZGUgPGxpbnV4L2VmaS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1jb250aWd1b3VzLmg+CiAK
ICNpbmNsdWRlIDxsaW51eC9oeXBlcnYuaD4KIApAQCAtMjI3LDcgKzIzOCw2IEBAIHN0cnVjdCBz
eW50aHZpZF9tc2cgewogfSBfX3BhY2tlZDsKIAogCi0KIC8qIEZCIGRyaXZlciBkZWZpbml0aW9u
cyBhbmQgc3RydWN0dXJlcyAqLwogI2RlZmluZSBIVkZCX1dJRFRIIDExNTIgLyogZGVmYXVsdCBz
Y3JlZW4gd2lkdGggKi8KICNkZWZpbmUgSFZGQl9IRUlHSFQgODY0IC8qIGRlZmF1bHQgc2NyZWVu
IGhlaWdodCAqLwpAQCAtMjU2LDYgKzI2Niw5IEBAIHN0cnVjdCBodmZiX3BhciB7CiAJLyogSWYg
dHJ1ZSwgdGhlIFZTQyBub3RpZmllcyB0aGUgVlNQIG9uIGV2ZXJ5IGZyYW1lYnVmZmVyIGNoYW5n
ZSAqLwogCWJvb2wgc3luY2hyb25vdXNfZmI7CiAKKwkvKiBJZiB0cnVlLCBuZWVkIHRvIGNvcHkg
ZnJvbSBkZWZlcnJlZCBJTyBtZW0gdG8gZnJhbWVidWZmZXIgbWVtICovCisJYm9vbCBuZWVkX2Rv
Y29weTsKKwogCXN0cnVjdCBub3RpZmllcl9ibG9jayBodmZiX3BhbmljX25iOwogCiAJLyogTWVt
b3J5IGZvciBkZWZlcnJlZCBJTyBhbmQgZnJhbWUgYnVmZmVyIGl0c2VsZiAqLwpAQCAtNDMyLDcg
KzQ0NSw3IEBAIHN0YXRpYyB2b2lkIHN5bnRodmlkX2RlZmVycmVkX2lvKHN0cnVjdCBmYl9pbmZv
ICpwLAogCQltYXh5ID0gbWF4X3QoaW50LCBtYXh5LCB5Mik7CiAKIAkJLyogQ29weSBmcm9tIGRp
byBzcGFjZSB0byBtbWlvIGFkZHJlc3MgKi8KLQkJaWYgKHBhci0+ZmJfcmVhZHkpCisJCWlmIChw
YXItPmZiX3JlYWR5ICYmIHBhci0+bmVlZF9kb2NvcHkpCiAJCQlodmZiX2RvY29weShwYXIsIHN0
YXJ0LCBQQUdFX1NJWkUpOwogCX0KIApAQCAtNzQ5LDEyICs3NjIsMTIgQEAgc3RhdGljIHZvaWQg
aHZmYl91cGRhdGVfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKncpCiAJCXJldHVybjsKIAogCS8q
IENvcHkgdGhlIGRpcnR5IHJlY3RhbmdsZSB0byBmcmFtZSBidWZmZXIgbWVtb3J5ICovCi0JZm9y
IChqID0geTE7IGogPCB5MjsgaisrKSB7Ci0JCWh2ZmJfZG9jb3B5KHBhciwKLQkJCSAgICBqICog
aW5mby0+Zml4LmxpbmVfbGVuZ3RoICsKLQkJCSAgICAoeDEgKiBzY3JlZW5fZGVwdGggLyA4KSwK
LQkJCSAgICAoeDIgLSB4MSkgKiBzY3JlZW5fZGVwdGggLyA4KTsKLQl9CisJaWYgKHBhci0+bmVl
ZF9kb2NvcHkpCisJCWZvciAoaiA9IHkxOyBqIDwgeTI7IGorKykKKwkJCWh2ZmJfZG9jb3B5KHBh
ciwKKwkJCQkgICAgaiAqIGluZm8tPmZpeC5saW5lX2xlbmd0aCArCisJCQkJICAgICh4MSAqIHNj
cmVlbl9kZXB0aCAvIDgpLAorCQkJCSAgICAoeDIgLSB4MSkgKiBzY3JlZW5fZGVwdGggLyA4KTsK
IAogCS8qIFJlZnJlc2ggKi8KIAlpZiAocGFyLT5mYl9yZWFkeSAmJiBwYXItPnVwZGF0ZSkKQEAg
LTc5OSw3ICs4MTIsOCBAQCBzdGF0aWMgaW50IGh2ZmJfb25fcGFuaWMoc3RydWN0IG5vdGlmaWVy
X2Jsb2NrICpuYiwKIAlwYXIgPSBjb250YWluZXJfb2YobmIsIHN0cnVjdCBodmZiX3BhciwgaHZm
Yl9wYW5pY19uYik7CiAJcGFyLT5zeW5jaHJvbm91c19mYiA9IHRydWU7CiAJaW5mbyA9IHBhci0+
aW5mbzsKLQlodmZiX2RvY29weShwYXIsIDAsIGRpb19mYl9zaXplKTsKKwlpZiAocGFyLT5uZWVk
X2RvY29weSkKKwkJaHZmYl9kb2NvcHkocGFyLCAwLCBkaW9fZmJfc2l6ZSk7CiAJc3ludGh2aWRf
dXBkYXRlKGluZm8sIDAsIDAsIElOVF9NQVgsIElOVF9NQVgpOwogCiAJcmV0dXJuIE5PVElGWV9E
T05FOwpAQCAtOTM4LDYgKzk1Miw2MiBAQCBzdGF0aWMgdm9pZCBodmZiX2dldF9vcHRpb24oc3Ry
dWN0IGZiX2luZm8gKmluZm8pCiAJcmV0dXJuOwogfQogCisvKgorICogQWxsb2NhdGUgZW5vdWdo
IGNvbnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5LgorICogUmV0dXJuIHBoeXNpY2FsIGFkZHJlc3Mg
aWYgc3VjY2VlZGVkIG9yIC0xIGlmIGZhaWxlZC4KKyAqLworc3RhdGljIHVuc2lnbmVkIGxvbmcg
aHZmYl9nZXRfcGh5bWVtKHVuc2lnbmVkIGludCByZXF1ZXN0X3NpemUpCit7CisJc3RydWN0IHBh
Z2UgKnBhZ2UgPSBOVUxMOworCXVuc2lnbmVkIGludCByZXF1ZXN0X3BhZ2VzOworCXVuc2lnbmVk
IGxvbmcgcGFkZHIgPSAwOworCXVuc2lnbmVkIGludCBvcmRlciA9IGdldF9vcmRlcihyZXF1ZXN0
X3NpemUpOworCisJaWYgKHJlcXVlc3Rfc2l6ZSA9PSAwKQorCQlyZXR1cm4gLTE7CisKKwkvKiBU
cnkgY2FsbCBhbGxvY19wYWdlcyBpZiB0aGUgc2l6ZSBpcyBsZXNzIHRoYW4gMl5NQVhfT1JERVIg
Ki8KKwlpZiAob3JkZXIgPCBNQVhfT1JERVIpIHsKKwkJcGFnZSA9IGFsbG9jX3BhZ2VzKEdGUF9L
RVJORUwgfCBfX0dGUF9aRVJPLCBvcmRlcik7CisJCWlmICghcGFnZSkKKwkJCXJldHVybiAtMTsK
KworCQlyZXF1ZXN0X3BhZ2VzID0gKDEgPDwgb3JkZXIpOworCQlnb3RvIGdldF9waHltZW0xOwor
CX0KKworCS8qIEFsbG9jYXRlIGZyb20gQ01BICovCisJLy8gcmVxdWVzdF9wYWdlcyA9IChyZXF1
ZXN0X3NpemUgPj4gUEFHRV9TSElGVCkgKyAxOworCXJlcXVlc3RfcGFnZXMgPSAocm91bmRfdXAo
cmVxdWVzdF9zaXplLCBQQUdFX1NJWkUpID4+IFBBR0VfU0hJRlQpOworCXBhZ2UgPSBkbWFfYWxs
b2NfZnJvbV9jb250aWd1b3VzKE5VTEwsIHJlcXVlc3RfcGFnZXMsIDAsIGZhbHNlKTsKKworCWlm
IChwYWdlID09IE5VTEwpCisJCXJldHVybiAtMTsKKworZ2V0X3BoeW1lbTE6CisJcGFkZHIgPSAo
cGFnZV90b19wZm4ocGFnZSkgPDwgUEFHRV9TSElGVCk7CisKKwlwcl9pbmZvKCJBbGxvY2F0ZWQg
JWQgcGFnZXMgc3RhcnRzIGF0IHBoeXNpY2FsIGFkZHIgMHglbHhcbiIsCisJCXJlcXVlc3RfcGFn
ZXMsIHBhZGRyKTsKKworCXJldHVybiBwYWRkcjsKK30KKworLyogUmVsZWFzZSBjb250aWd1b3Vz
IHBoeXNpY2FsIG1lbW9yeSAqLworc3RhdGljIHZvaWQgaHZmYl9yZWxlYXNlX3BoeW1lbSh1bnNp
Z25lZCBsb25nIHBhZGRyLCB1bnNpZ25lZCBpbnQgc2l6ZSkKK3sKKwl1bnNpZ25lZCBpbnQgb3Jk
ZXIgPSBnZXRfb3JkZXIoc2l6ZSk7CisKKwlpZiAob3JkZXIgPCBNQVhfT1JERVIpCisJCV9fZnJl
ZV9wYWdlcyhwZm5fdG9fcGFnZShwYWRkciA+PiBQQUdFX1NISUZUKSwgb3JkZXIpOworCWVsc2UK
KwkJZG1hX3JlbGVhc2VfZnJvbV9jb250aWd1b3VzKE5VTEwsCisJCQkJCSAgICBwZm5fdG9fcGFn
ZShwYWRkciA+PiBQQUdFX1NISUZUKSwKKwkJCQkJICAgIChyb3VuZF91cChzaXplLCBQQUdFX1NJ
WkUpID4+CisJCQkJCSAgICAgUEFHRV9TSElGVCkpOworCQkJCQkgICAgLy8gKHNpemUgPj4gUEFH
RV9TSElGVCkgKyAxKTsKK30KKwogCiAvKiBHZXQgZnJhbWVidWZmZXIgbWVtb3J5IGZyb20gSHlw
ZXItViB2aWRlbyBwY2kgc3BhY2UgKi8KIHN0YXRpYyBpbnQgaHZmYl9nZXRtZW0oc3RydWN0IGh2
X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8pCkBAIC05NDcsOCArMTAxNyw1OCBA
QCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBm
Yl9pbmZvICppbmZvKQogCXZvaWQgX19pb21lbSAqZmJfdmlydDsKIAlpbnQgZ2VuMnZtID0gZWZp
X2VuYWJsZWQoRUZJX0JPT1QpOwogCXJlc291cmNlX3NpemVfdCBwb3Rfc3RhcnQsIHBvdF9lbmQ7
CisJdW5zaWduZWQgbG9uZyBwYWRkcjsKIAlpbnQgcmV0OwogCisJaWYgKCFnZW4ydm0pIHsKKwkJ
cGRldiA9IHBjaV9nZXRfZGV2aWNlKFBDSV9WRU5ET1JfSURfTUlDUk9TT0ZULAorCQkJUENJX0RF
VklDRV9JRF9IWVBFUlZfVklERU8sIE5VTEwpOworCQlpZiAoIXBkZXYpIHsKKwkJCXByX2Vycigi
VW5hYmxlIHRvIGZpbmQgUENJIEh5cGVyLVYgdmlkZW9cbiIpOworCQkJcmV0dXJuIC1FTk9ERVY7
CisJCX0KKwl9CisKKwlpbmZvLT5hcGVydHVyZXMgPSBhbGxvY19hcGVydHVyZXMoMSk7CisJaWYg
KCFpbmZvLT5hcGVydHVyZXMpCisJCWdvdG8gZXJyMTsKKworCWlmIChnZW4ydm0pIHsKKwkJaW5m
by0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uYmFzZSA9IHNjcmVlbl9pbmZvLmxmYl9iYXNlOworCQlp
bmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5zaXplID0gc2NyZWVuX2luZm8ubGZiX3NpemU7CisJ
fSBlbHNlIHsKKwkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uYmFzZSA9IHBjaV9yZXNvdXJj
ZV9zdGFydChwZGV2LCAwKTsKKwkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHBj
aV9yZXNvdXJjZV9sZW4ocGRldiwgMCk7CisJfQorCisJLyoKKwkgKiBGb3IgR2VuIDEgVk0sIHdl
IGNhbiBkaXJlY3RseSB1c2UgdGhlIGNvbnRpZ3VvdXMgbWVtb3J5CisJICogZnJvbSBWTS4gSWYg
d2Ugc3VjY2VzcywgZGVmZXJyZWQgSU8gaGFwcGVucyBkaXJlY3RseQorCSAqIG9uIHRoaXMgYWxs
b2NhdGVkIGZyYW1lYnVmZmVyIG1lbW9yeSwgYXZvaWRpbmcgZXh0cmEKKwkgKiBtZW1vcnkgY29w
eS4KKwkgKi8KKwlpZiAoIWdlbjJ2bSkgeworCQlwYWRkciA9IGh2ZmJfZ2V0X3BoeW1lbShzY3Jl
ZW5fZmJfc2l6ZSk7CisJCWlmIChwYWRkciAhPSAodW5zaWduZWQgbG9uZykgLTEpIHsKKwkJCXBh
ci0+bW1pb19wcCA9IHBhZGRyOworCQkJcGFyLT5tbWlvX3ZwID0gcGFyLT5kaW9fdnAgPSBfX3Zh
KHBhZGRyKTsKKworCQkJaW5mby0+Zml4LnNtZW1fc3RhcnQgPSBwYWRkcjsKKwkJCWluZm8tPmZp
eC5zbWVtX2xlbiA9IHNjcmVlbl9mYl9zaXplOworCQkJaW5mby0+c2NyZWVuX2Jhc2UgPSBwYXIt
Pm1taW9fdnA7CisJCQlpbmZvLT5zY3JlZW5fc2l6ZSA9IHNjcmVlbl9mYl9zaXplOworCisJCQlw
YXItPm5lZWRfZG9jb3B5ID0gZmFsc2U7CisJCQlnb3RvIGdldG1lbTE7CisJCX0gZWxzZSB7CisJ
CQlwcl9pbmZvKCJVbmFibGUgdG8gYWxsb2NhdGUgZW5vdWdoIGNvbnRpZ3VvdXMgcGh5c2ljYWwg
bWVtb3J5IG9uIEdlbiAxIFZNLiBVc2UgTU1JTyBpbnN0ZWFkLlxuIik7CisJCX0KKwl9CisKKwkv
KgorCSAqIENhbm5vdCB1c2UgdGhlIGNvbnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5LgorCSAqIEFs
bG9jYXRlIG1taW8gc3BhY2UgZm9yIGZyYW1lYnVmZmVyLgorCSAqLwogCWRpb19mYl9zaXplID0K
IAkJc2NyZWVuX3dpZHRoICogc2NyZWVuX2hlaWdodCAqIHNjcmVlbl9kZXB0aCAvIDg7CiAKQEAg
LTk1NiwxMyArMTA3Niw2IEBAIHN0YXRpYyBpbnQgaHZmYl9nZXRtZW0oc3RydWN0IGh2X2Rldmlj
ZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8pCiAJCXBvdF9zdGFydCA9IDA7CiAJCXBvdF9l
bmQgPSAtMTsKIAl9IGVsc2UgewotCQlwZGV2ID0gcGNpX2dldF9kZXZpY2UoUENJX1ZFTkRPUl9J
RF9NSUNST1NPRlQsCi0JCQkgICAgICBQQ0lfREVWSUNFX0lEX0hZUEVSVl9WSURFTywgTlVMTCk7
Ci0JCWlmICghcGRldikgewotCQkJcHJfZXJyKCJVbmFibGUgdG8gZmluZCBQQ0kgSHlwZXItViB2
aWRlb1xuIik7Ci0JCQlyZXR1cm4gLUVOT0RFVjsKLQkJfQotCiAJCWlmICghKHBjaV9yZXNvdXJj
ZV9mbGFncyhwZGV2LCAwKSAmIElPUkVTT1VSQ0VfTUVNKSB8fAogCQkgICAgcGNpX3Jlc291cmNl
X2xlbihwZGV2LCAwKSA8IHNjcmVlbl9mYl9zaXplKSB7CiAJCQlwcl9lcnIoIlJlc291cmNlIG5v
dCBhdmFpbGFibGUgb3IgKDB4JWx4IDwgMHglbHgpXG4iLApAQCAtOTkxLDIwICsxMTA0LDYgQEAg
c3RhdGljIGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3QgZmJf
aW5mbyAqaW5mbykKIAlpZiAocGFyLT5kaW9fdnAgPT0gTlVMTCkKIAkJZ290byBlcnIzOwogCi0J
aW5mby0+YXBlcnR1cmVzID0gYWxsb2NfYXBlcnR1cmVzKDEpOwotCWlmICghaW5mby0+YXBlcnR1
cmVzKQotCQlnb3RvIGVycjQ7Ci0KLQlpZiAoZ2VuMnZtKSB7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+
cmFuZ2VzWzBdLmJhc2UgPSBzY3JlZW5faW5mby5sZmJfYmFzZTsKLQkJaW5mby0+YXBlcnR1cmVz
LT5yYW5nZXNbMF0uc2l6ZSA9IHNjcmVlbl9pbmZvLmxmYl9zaXplOwotCQlyZW1vdmVfY29uZmxp
Y3RpbmdfZnJhbWVidWZmZXJzKGluZm8tPmFwZXJ0dXJlcywKLQkJCQkJCUtCVUlMRF9NT0ROQU1F
LCBmYWxzZSk7Ci0JfSBlbHNlIHsKLQkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uYmFzZSA9
IHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAwKTsKLQkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNb
MF0uc2l6ZSA9IHBjaV9yZXNvdXJjZV9sZW4ocGRldiwgMCk7Ci0JfQotCiAJLyogUGh5c2ljYWwg
YWRkcmVzcyBvZiBGQiBkZXZpY2UgKi8KIAlwYXItPm1taW9fcHAgPSBwYXItPm1lbS0+c3RhcnQ7
CiAJLyogVmlydHVhbCBhZGRyZXNzIG9mIEZCIGRldmljZSAqLwpAQCAtMTAxNSwxMyArMTExNCwx
NyBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVj
dCBmYl9pbmZvICppbmZvKQogCWluZm8tPnNjcmVlbl9iYXNlID0gcGFyLT5kaW9fdnA7CiAJaW5m
by0+c2NyZWVuX3NpemUgPSBkaW9fZmJfc2l6ZTsKIAorCXBhci0+bmVlZF9kb2NvcHkgPSB0cnVl
OworCitnZXRtZW0xOgorCXJlbW92ZV9jb25mbGljdGluZ19mcmFtZWJ1ZmZlcnMoaW5mby0+YXBl
cnR1cmVzLAorCQkJCQlLQlVJTERfTU9ETkFNRSwgZmFsc2UpOworCiAJaWYgKCFnZW4ydm0pCiAJ
CXBjaV9kZXZfcHV0KHBkZXYpOwogCiAJcmV0dXJuIDA7CiAKLWVycjQ6Ci0JdmZyZWUocGFyLT5k
aW9fdnApOwogZXJyMzoKIAlpb3VubWFwKGZiX3ZpcnQpOwogZXJyMjoKQEAgLTEwMzksOSArMTE0
MiwxNCBAQCBzdGF0aWMgdm9pZCBodmZiX3B1dG1lbShzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKIHsK
IAlzdHJ1Y3QgaHZmYl9wYXIgKnBhciA9IGluZm8tPnBhcjsKIAotCXZmcmVlKHBhci0+ZGlvX3Zw
KTsKLQlpb3VubWFwKGluZm8tPnNjcmVlbl9iYXNlKTsKLQl2bWJ1c19mcmVlX21taW8ocGFyLT5t
ZW0tPnN0YXJ0LCBzY3JlZW5fZmJfc2l6ZSk7CisJaWYgKHBhci0+bmVlZF9kb2NvcHkpIHsKKwkJ
dmZyZWUocGFyLT5kaW9fdnApOworCQlpb3VubWFwKGluZm8tPnNjcmVlbl9iYXNlKTsKKwkJdm1i
dXNfZnJlZV9tbWlvKHBhci0+bWVtLT5zdGFydCwgc2NyZWVuX2ZiX3NpemUpOworCX0gZWxzZSB7
CisJCWh2ZmJfcmVsZWFzZV9waHltZW0oaW5mby0+Zml4LnNtZW1fc3RhcnQsIHNjcmVlbl9mYl9z
aXplKTsKKwl9CisKIAlwYXItPm1lbSA9IE5VTEw7CiB9CiAKQEAgLTEwNjAsNiArMTE2OCw3IEBA
IHN0YXRpYyBpbnQgaHZmYl9wcm9iZShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LAogCXBhciA9IGlu
Zm8tPnBhcjsKIAlwYXItPmluZm8gPSBpbmZvOwogCXBhci0+ZmJfcmVhZHkgPSBmYWxzZTsKKwlw
YXItPm5lZWRfZG9jb3B5ID0gZmFsc2U7CiAJaW5pdF9jb21wbGV0aW9uKCZwYXItPndhaXQpOwog
CUlOSVRfREVMQVlFRF9XT1JLKCZwYXItPmR3b3JrLCBodmZiX3VwZGF0ZV93b3JrKTsKIApkaWZm
IC0tZ2l0IGEva2VybmVsL2RtYS9jb250aWd1b3VzLmMgYi9rZXJuZWwvZG1hL2NvbnRpZ3VvdXMu
YwppbmRleCA2OWNmYjQzNDUzODguLjQ1NTNmNGNjYTgwZSAxMDA2NDQKLS0tIGEva2VybmVsL2Rt
YS9jb250aWd1b3VzLmMKKysrIGIva2VybmVsL2RtYS9jb250aWd1b3VzLmMKQEAgLTE5Nyw2ICsx
OTcsNyBAQCBzdHJ1Y3QgcGFnZSAqZG1hX2FsbG9jX2Zyb21fY29udGlndW91cyhzdHJ1Y3QgZGV2
aWNlICpkZXYsIHNpemVfdCBjb3VudCwKIAogCXJldHVybiBjbWFfYWxsb2MoZGV2X2dldF9jbWFf
YXJlYShkZXYpLCBjb3VudCwgYWxpZ24sIG5vX3dhcm4pOwogfQorRVhQT1JUX1NZTUJPTChkbWFf
YWxsb2NfZnJvbV9jb250aWd1b3VzKTsKIAogLyoqCiAgKiBkbWFfcmVsZWFzZV9mcm9tX2NvbnRp
Z3VvdXMoKSAtIHJlbGVhc2UgYWxsb2NhdGVkIHBhZ2VzCkBAIC0yMTMsNiArMjE0LDcgQEAgYm9v
bCBkbWFfcmVsZWFzZV9mcm9tX2NvbnRpZ3VvdXMoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3Qg
cGFnZSAqcGFnZXMsCiB7CiAJcmV0dXJuIGNtYV9yZWxlYXNlKGRldl9nZXRfY21hX2FyZWEoZGV2
KSwgcGFnZXMsIGNvdW50KTsKIH0KK0VYUE9SVF9TWU1CT0woZG1hX3JlbGVhc2VfZnJvbV9jb250
aWd1b3VzKTsKIAogLyoqCiAgKiBkbWFfYWxsb2NfY29udGlndW91cygpIC0gYWxsb2NhdGUgY29u
dGlndW91cyBwYWdlcwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
