Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 29A9913B0BD
	for <lists+dri-devel@lfdr.de>; Tue, 14 Jan 2020 18:22:04 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 091C46E428;
	Tue, 14 Jan 2020 17:21:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yw1-xc44.google.com (mail-yw1-xc44.google.com
 [IPv6:2607:f8b0:4864:20::c44])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 819CB6E428
 for <dri-devel@lists.freedesktop.org>; Tue, 14 Jan 2020 17:21:58 +0000 (UTC)
Received: by mail-yw1-xc44.google.com with SMTP id l14so9665070ywj.9
 for <dri-devel@lists.freedesktop.org>; Tue, 14 Jan 2020 09:21:58 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vANXz+nURZZ/MQfFkvN0tPAVlzc3P2+SzbZ/4XzfYpo=;
 b=BEIqifLOpaExUDicSFq52yOaMb04TC0QTU72V2VBUv0z0WprtRd/ceAHlkcC2B1GTH
 zLDwzS6JBUTQayb1cP4Yk4TeBdjYHk1sBwmmyi5zUxL9uD+ssDuWRTzB3DGIZ7BC4AGW
 y14LyJptT/MhUrtdQdrrmF8Ky95zPQJfzqhGvYpg4UJ+/0rufNj15j/1t4ouT3E9F1n9
 udPWVsPgYHaJdb7vUdxNl2wKGmnX6/NpIN/AlUEsiTCB68E9lZuxVjqBcdYaDV0MlPn6
 GKGp7TokOhmq2uwJFSaP1mhOylbRnUWASR384vzUr3MGmlEt4BZ6s7tTKKDuHRjmVrSb
 Ll8Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vANXz+nURZZ/MQfFkvN0tPAVlzc3P2+SzbZ/4XzfYpo=;
 b=qVV/IymlkOQazJlrdRfkPPUldGv4MhT9EtA/4JOtHgJHLjxnOhm6/FPD97Y3JNfrrR
 U1xEMCJy5d3MUjyWzMsqPsk5TqNUpCu78a27x/Xq4ox1WnO1EU1AsOBZ70FXxD4BCuLV
 HV8SrmTrO+7pMkRv8SmhQ14nTIpbtW4Zob1LpHJSi53Lo1dCsoST7KaDzdM0HdgFPtpT
 LQ8mJnVNYn4ch1ZPnmcCUNPwalP3Xmho7J66Wxs+Rl8IQGKddGEEUOzf1Q8jRz/L637z
 SJYMktO8e8+TN/N6Lmzy++yzk6qwb8LKdDgfJ31nWqFOExxFEgZ4EXRw2kCKRq81vLZs
 XVNA==
X-Gm-Message-State: APjAAAVAOhn8b0YrjYStVtF7fZ76PVjiRIlSti9erlo5pHqYIwp5XRrs
 A9ng4AApguSuUNrGcuM+gM0iKtdLQ5RUZA==
X-Google-Smtp-Source: APXvYqw8PfzSQ49c60YIHP/lbQkMx8qAxygmeWvuQe8Wt1zmpOhEe1Sa76YlotP5DxNh6QtmbXylCw==
X-Received: by 2002:a25:860f:: with SMTP id y15mr16862313ybk.427.1579022517354; 
 Tue, 14 Jan 2020 09:21:57 -0800 (PST)
Received: from localhost ([2620:0:1013:11:1e1:4760:6ce4:fc64])
 by smtp.gmail.com with ESMTPSA id e76sm7019128ywe.25.2020.01.14.09.21.56
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 14 Jan 2020 09:21:56 -0800 (PST)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4] drm/trace: Buffer DRM logs in a ringbuffer accessible via
 debugfs
Date: Tue, 14 Jan 2020 12:21:43 -0500
Message-Id: <20200114172155.215463-1-sean@poorly.run>
X-Mailer: git-send-email 2.25.0.rc1.283.g88dfdc4193-goog
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jonathan Corbet <corbet@lwn.net>, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel.vetter@ffwll.ch>, linux-doc@vger.kernel.org,
 Sean Paul <seanpaul@chromium.org>, Steven Rostedt <rostedt@goodmis.org>,
 Thomas Zimmermann <tzimmermann@suse.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGlzIHBhdGNoIHVzZXMg
YSByaW5nX2J1ZmZlciB0byBrZWVwIGEgImZsaWdodCByZWNvcmRlciIgKG5hbWUgY3JlZGl0IFdl
c3RvbikKb2YgRFJNIGxvZ3MgZm9yIGEgc3BlY2lmaWVkIHNldCBvZiBkZWJ1ZyBjYXRlZ29yaWVz
LiBUaGUgdXNlciB3cml0ZXMgYQpiaXRtYXNrIG9mIGRlYnVnIGNhdGVnb3JpZXMgdG8gdGhlICJ0
cmFjZV9tYXNrIiBub2RlIGFuZCBjYW4gcmVhZCBsb2cKbWVzc2FnZXMgZnJvbSB0aGUgInRyYWNl
IiBub2RlLgoKVGhlc2Ugbm9kZXMgY3VycmVudGx5IGV4aXN0IGluIGRlYnVnZnMgdW5kZXIgdGhl
IGRyaSBkaXJlY3RvcnkuIEkKaW50ZW5kZWQgb24gZXhwb3NpbmcgYWxsIG9mIHRoaXMgdGhyb3Vn
aCB0cmFjZWZzIG9yaWdpbmFsbHksIGJ1dCB0aGUKdHJhY2VmcyBlbnRyeSBwb2ludHMgYXJlIG5v
dCBleHBvc2VkLCBzbyB0aGVyZSdzIG5vIHdheSB0byBjcmVhdGUKdHJhY2VmcyBmaWxlcyBmcm9t
IGRyaXZlcnMgYXQgdGhlIG1vbWVudC4gSSB0aGluayBpdCB3b3VsZCBiZSBhCndvcnRod2hpbGUg
ZW5kZWF2b3VyLCBidXQgb25lIHJlcXVpcmluZyBtb3JlIHRpbWUgYW5kIGNvbnZlcnNhdGlvbiB0
bwplbnN1cmUgdGhlIGRybSB0cmFjZXMgZml0IHNvbWV3aGVyZSBzZW5zaWJsZS4KCkNjOiBEYW5p
ZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgpDYzogRGF2aWQgQWlybGllIDxhaXJs
aWVkQGdtYWlsLmNvbT4KQ2M6IEphbmkgTmlrdWxhIDxqYW5pLm5pa3VsYUBsaW51eC5pbnRlbC5j
b20+CkNjOiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+
CkNjOiBQZWtrYSBQYWFsYW5lbiA8cHBhYWxhbmVuQGdtYWlsLmNvbT4KQ2M6IFJvYiBDbGFyayA8
cm9iZGNsYXJrQGdtYWlsLmNvbT4KQ2M6IFN0ZXZlbiBSb3N0ZWR0IDxyb3N0ZWR0QGdvb2RtaXMu
b3JnPgpDYzogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1c2UuZGU+CkNjOiBWaWxs
ZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4KTGluazogaHR0cHM6Ly9wYXRjaHdv
cmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMTkxMDEwMjA0ODIzLjE5NTU0MC0xLXNl
YW5AcG9vcmx5LnJ1biAjdjEKTGluazogaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvYXJj
aGl2ZXMvZHJpLWRldmVsLzIwMTktTm92ZW1iZXIvMjQzMjMwLmh0bWwgI3YyCkxpbms6IGh0dHBz
Oi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MTIxMjIwMzMwMS4x
NDI0MzctMS1zZWFuQHBvb3JseS5ydW4gI3YzCgpDaGFuZ2VzIGluIHYyOgotIFdlbnQgd2l0aCBh
IGNvbXBsZXRlbHkgZGlmZmVyZW50IGFwcHJvYWNoOgpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9hcmNoaXZlcy9kcmktZGV2ZWwvMjAxOS1Ob3ZlbWJlci8yNDMyMzAuaHRtbAoKQ2hhbmdl
cyBpbiB2MzoKLSBDaGFuZ2VkIGNvbW1pdCBtZXNzYWdlIHRvIGJlIGEgYml0IGxlc3MgUkZDLXkK
LSBNYWtlIGNsYXNzX2RybV9jYXRlZ29yeV9sb2cgYW4gYWN0dWFsIHRyYWNlIGNsYXNzCgpDaGFu
Z2VzIGluIHY0OgotIEluc3RlYWQgb2YgW2FiXXVzaW5nIHRyYWNlIGV2ZW50cyBhbmQgdGhlIHN5
c3RlbSB0cmFjZSBidWZmZXIsIHVzZSBvdXIKICBvd24gcmluZ2J1ZmZlcgotLS0KLS0tCiBEb2N1
bWVudGF0aW9uL2dwdS9kcm0tdWFwaS5yc3QgfCAgIDkgKwogZHJpdmVycy9ncHUvZHJtL0tjb25m
aWcgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZSAgICAgICB8ICAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL2RybV9kcnYuYyAgICAgIHwgICAzICsKIGRyaXZlcnMvZ3B1L2Ry
bS9kcm1fcHJpbnQuYyAgICB8ICA4MCArKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX3RyYWNl
LmMgICAgfCAzNzYgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2Ry
bS9kcm1fcHJpbnQuaCAgICAgICAgfCAgMzkgKysrKwogNyBmaWxlcyBjaGFuZ2VkLCA0ODcgaW5z
ZXJ0aW9ucygrKSwgMjMgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9n
cHUvZHJtL2RybV90cmFjZS5jCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLXVh
cGkucnN0IGIvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLXVhcGkucnN0CmluZGV4IDU2ZmVjNmVkMWFk
OC4uMDg5ZWI2ZmQzZTk0IDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL2dwdS9kcm0tdWFwaS5y
c3QKKysrIGIvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLXVhcGkucnN0CkBAIC0zMTIsNiArMzEyLDE1
IEBAIERlYnVnZnMgU3VwcG9ydAogLi4ga2VybmVsLWRvYzo6IGRyaXZlcnMvZ3B1L2RybS9kcm1f
ZGVidWdmcy5jCiAgICA6ZXhwb3J0OgogCitEUk0gVHJhY2luZworLS0tLS0tLS0tLS0tLS0tCisK
Ky4uIGtlcm5lbC1kb2M6OiBkcml2ZXJzL2dwdS9kcm0vZHJtX3RyYWNlLmMKKyAgIDpkb2M6IERS
TSBUcmFjaW5nCisKKy4uIGtlcm5lbC1kb2M6OiBkcml2ZXJzL2dwdS9kcm0vZHJtX3RyYWNlLmMK
KyAgIDppbnRlcm5hbDoKKwogU3lzZnMgU3VwcG9ydAogPT09PT09PT09PT09PQogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCmlu
ZGV4IGQwYWE2Y2ZmMmUwMi4uOWQ4MDc3ZTg3YWZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZwpAQCAtMTQsNiArMTQsNyBA
QCBtZW51Y29uZmlnIERSTQogCXNlbGVjdCBJMkMKIAlzZWxlY3QgSTJDX0FMR09CSVQKIAlzZWxl
Y3QgRE1BX1NIQVJFRF9CVUZGRVIKKwlzZWxlY3QgUklOR19CVUZGRVIKIAlzZWxlY3QgU1lOQ19G
SUxFCiAJaGVscAogCSAgS2VybmVsLWxldmVsIHN1cHBvcnQgZm9yIHRoZSBEaXJlY3QgUmVuZGVy
aW5nIEluZnJhc3RydWN0dXJlIChEUkkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vTWFr
ZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUKaW5kZXggNjQ5MzA4OGEwZmRkLi44OGI0
Njc0OTM0ZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vTWFrZWZpbGUKQEAgLTI5LDcgKzI5LDcgQEAgZHJtLSQoQ09ORklHX0RSTV9Q
QU5FTCkgKz0gZHJtX3BhbmVsLm8KIGRybS0kKENPTkZJR19PRikgKz0gZHJtX29mLm8KIGRybS0k
KENPTkZJR19BR1ApICs9IGRybV9hZ3BzdXBwb3J0Lm8KIGRybS0kKENPTkZJR19QQ0kpICs9IGRy
bV9wY2kubwotZHJtLSQoQ09ORklHX0RFQlVHX0ZTKSArPSBkcm1fZGVidWdmcy5vIGRybV9kZWJ1
Z2ZzX2NyYy5vCitkcm0tJChDT05GSUdfREVCVUdfRlMpICs9IGRybV9kZWJ1Z2ZzLm8gZHJtX2Rl
YnVnZnNfY3JjLm8gZHJtX3RyYWNlLm8KIGRybS0kKENPTkZJR19EUk1fTE9BRF9FRElEX0ZJUk1X
QVJFKSArPSBkcm1fZWRpZF9sb2FkLm8KIAogZHJtX3ZyYW1faGVscGVyLXkgOj0gZHJtX2dlbV92
cmFtX2hlbHBlci5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHJ2LmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2Rydi5jCmluZGV4IDdjMThhOTgwY2Q0Yi4uOTgyNjBiOWY4MDA0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fZHJ2LmMKQEAgLTExMTQsNiArMTExNCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZmlsZV9vcGVyYXRpb25zIGRybV9zdHViX2ZvcHMgPSB7CiBzdGF0aWMgdm9pZCBkcm1fY29yZV9l
eGl0KHZvaWQpCiB7CiAJdW5yZWdpc3Rlcl9jaHJkZXYoRFJNX01BSk9SLCAiZHJtIik7CisJZHJt
X3RyYWNlX2NsZWFudXAoKTsKIAlkZWJ1Z2ZzX3JlbW92ZShkcm1fZGVidWdmc19yb290KTsKIAlk
cm1fc3lzZnNfZGVzdHJveSgpOwogCWlkcl9kZXN0cm95KCZkcm1fbWlub3JzX2lkcik7CkBAIC0x
MTM1LDYgKzExMzYsOCBAQCBzdGF0aWMgaW50IF9faW5pdCBkcm1fY29yZV9pbml0KHZvaWQpCiAK
IAlkcm1fZGVidWdmc19yb290ID0gZGVidWdmc19jcmVhdGVfZGlyKCJkcmkiLCBOVUxMKTsKIAor
CVdBUk5fT04oZHJtX3RyYWNlX2luaXQoZHJtX2RlYnVnZnNfcm9vdCkpOworCiAJcmV0ID0gcmVn
aXN0ZXJfY2hyZGV2KERSTV9NQUpPUiwgImRybSIsICZkcm1fc3R1Yl9mb3BzKTsKIAlpZiAocmV0
IDwgMCkKIAkJZ290byBlcnJvcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJp
bnQuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJpbnQuYwppbmRleCAxMTFiOTMyY2YyYTkuLjBh
YzE4Njc5MzdiZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9wcmludC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJpbnQuYwpAQCAtMjYyLDIxICsyNjIsMzcgQEAgdm9pZCBk
cm1fZGV2X2RiZyhjb25zdCBzdHJ1Y3QgZGV2aWNlICpkZXYsIGVudW0gZHJtX2RlYnVnX2NhdGVn
b3J5IGNhdGVnb3J5LAogCXN0cnVjdCB2YV9mb3JtYXQgdmFmOwogCXZhX2xpc3QgYXJnczsKIAot
CWlmICghZHJtX2RlYnVnX2VuYWJsZWQoY2F0ZWdvcnkpKQotCQlyZXR1cm47Ci0KLQl2YV9zdGFy
dChhcmdzLCBmb3JtYXQpOwotCXZhZi5mbXQgPSBmb3JtYXQ7Ci0JdmFmLnZhID0gJmFyZ3M7Ci0K
LQlpZiAoZGV2KQotCQlkZXZfcHJpbnRrKEtFUk5fREVCVUcsIGRldiwgIlsiIERSTV9OQU1FICI6
JXBzXSAlcFYiLAotCQkJICAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApLCAmdmFmKTsKLQll
bHNlCi0JCXByaW50ayhLRVJOX0RFQlVHICJbIiBEUk1fTkFNRSAiOiVwc10gJXBWIiwKLQkJICAg
ICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSwgJnZhZik7CisJaWYgKGRybV9kZWJ1Z19l
bmFibGVkKGNhdGVnb3J5KSkgeworCQl2YV9zdGFydChhcmdzLCBmb3JtYXQpOworCQl2YWYuZm10
ID0gZm9ybWF0OworCQl2YWYudmEgPSAmYXJnczsKKworCQlpZiAoZGV2KQorCQkJZGV2X3ByaW50
ayhLRVJOX0RFQlVHLCBkZXYsICJbIiBEUk1fTkFNRSAiOiVwc10gJXBWIiwKKwkJCQkgICBfX2J1
aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCksICZ2YWYpOworCQllbHNlCisJCQlwcmludGsoS0VSTl9E
RUJVRyAiWyIgRFJNX05BTUUgIjolcHNdICVwViIsCisJCQkgICAgICAgX19idWlsdGluX3JldHVy
bl9hZGRyZXNzKDApLCAmdmFmKTsKKworCQl2YV9lbmQoYXJncyk7CisJfQogCi0JdmFfZW5kKGFy
Z3MpOworCWlmIChkcm1fdHJhY2VfZW5hYmxlZChjYXRlZ29yeSkpIHsKKwkJdmFfc3RhcnQoYXJn
cywgZm9ybWF0KTsKKwkJdmFmLmZtdCA9IGZvcm1hdDsKKwkJdmFmLnZhID0gJmFyZ3M7CisKKwkJ
aWYgKGRldikKKwkJCWRybV9kZXZfdHJhY2VfcHJpbnRmKGRldiwgIlslcHNdICVwViIsCisJCQkJ
CSAgICAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApLAorCQkJCQkgICAgICZ2YWYpOworCQll
bHNlCisJCQlkcm1fdHJhY2VfcHJpbnRmKCJbJXBzXSAlcFYiLAorCQkJCQkgX19idWlsdGluX3Jl
dHVybl9hZGRyZXNzKDApLAorCQkJCQkgJnZhZik7CisKKwkJdmFfZW5kKGFyZ3MpOworCX0KIH0K
IEVYUE9SVF9TWU1CT0woZHJtX2Rldl9kYmcpOwogCkBAIC0yODUsMTcgKzMwMSwyOCBAQCB2b2lk
IF9fZHJtX2RiZyhlbnVtIGRybV9kZWJ1Z19jYXRlZ29yeSBjYXRlZ29yeSwgY29uc3QgY2hhciAq
Zm9ybWF0LCAuLi4pCiAJc3RydWN0IHZhX2Zvcm1hdCB2YWY7CiAJdmFfbGlzdCBhcmdzOwogCi0J
aWYgKCFkcm1fZGVidWdfZW5hYmxlZChjYXRlZ29yeSkpCi0JCXJldHVybjsKIAotCXZhX3N0YXJ0
KGFyZ3MsIGZvcm1hdCk7Ci0JdmFmLmZtdCA9IGZvcm1hdDsKLQl2YWYudmEgPSAmYXJnczsKKwlp
ZiAoZHJtX2RlYnVnX2VuYWJsZWQoY2F0ZWdvcnkpKSB7CisJCXZhX3N0YXJ0KGFyZ3MsIGZvcm1h
dCk7CisJCXZhZi5mbXQgPSBmb3JtYXQ7CisJCXZhZi52YSA9ICZhcmdzOwogCi0JcHJpbnRrKEtF
Uk5fREVCVUcgIlsiIERSTV9OQU1FICI6JXBzXSAlcFYiLAotCSAgICAgICBfX2J1aWx0aW5fcmV0
dXJuX2FkZHJlc3MoMCksICZ2YWYpOworCQlwcmludGsoS0VSTl9ERUJVRyAiWyIgRFJNX05BTUUg
IjolcHNdICVwViIsCisJCSAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCksICZ2YWYp
OwogCi0JdmFfZW5kKGFyZ3MpOworCQl2YV9lbmQoYXJncyk7CisJfQorCisJaWYgKGRybV90cmFj
ZV9lbmFibGVkKGNhdGVnb3J5KSkgeworCQl2YV9zdGFydChhcmdzLCBmb3JtYXQpOworCQl2YWYu
Zm10ID0gZm9ybWF0OworCQl2YWYudmEgPSAmYXJnczsKKworCQlkcm1fdHJhY2VfcHJpbnRmKCJb
JXBzXSAlcFYiLCBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCksCisJCQkJICZ2YWYpOworCisJ
CXZhX2VuZChhcmdzKTsKKwl9CiB9CiBFWFBPUlRfU1lNQk9MKF9fZHJtX2RiZyk7CiAKQEAgLTMx
Miw2ICszMzksMTUgQEAgdm9pZCBfX2RybV9lcnIoY29uc3QgY2hhciAqZm9ybWF0LCAuLi4pCiAJ
ICAgICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSwgJnZhZik7CiAKIAl2YV9lbmQoYXJn
cyk7CisKKwl2YV9zdGFydChhcmdzLCBmb3JtYXQpOworCXZhZi5mbXQgPSBmb3JtYXQ7CisJdmFm
LnZhID0gJmFyZ3M7CisKKwlkcm1fdHJhY2VfcHJpbnRmKCJbJXBzXSAqRVJST1IqICVwViIsIF9f
YnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSwKKwkJCSAmdmFmKTsKKworCXZhX2VuZChhcmdzKTsK
IH0KIEVYUE9SVF9TWU1CT0woX19kcm1fZXJyKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV90cmFjZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV90cmFjZS5jCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMGU3Y2YzNDJkMWQ5Ci0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV90cmFjZS5jCkBAIC0wLDAgKzEsMzc2IEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IChDKSAyMDIw
IEdvb2dsZSwgSW5jLgorICoKKyAqIEF1dGhvcnM6CisgKiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNo
cm9taXVtLm9yZz4KKyAqLworCisjaW5jbHVkZSA8bGludXgvY3B1bWFzay5oPgorI2luY2x1ZGUg
PGxpbnV4L2RlYnVnZnMuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxs
aW51eC9yaW5nX2J1ZmZlci5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRlIDxs
aW51eC9zdGF0Lmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fcHJpbnQuaD4KKworI2RlZmluZSBEUk1fVFJBQ0VfTUFYX0xFTgkyNTYKKworLyoqCisg
KiBET0M6IERSTSBUcmFjaW5nCisgKgorICogKnRsO2RyKiBEUk0gdHJhY2luZyBpcyBhIGxpZ2h0
d2VpZ2h0IGFsdGVybmF0aXZlIHRvIHRyYWRpdGlvbmFsIERSTSBkZWJ1ZworICogbG9nZ2luZy4K
KyAqCisgKiBXaGlsZSBEUk0gbG9nZ2luZyBpcyBxdWl0ZSBjb252ZW5pZW50IHdoZW4gcmVwcm9k
dWNpbmcgYSBzcGVjaWZpYyBpc3N1ZSwgaXQKKyAqIGRvZXNuJ3QgaGVscCB3aGVuIHNvbWV0aGlu
ZyBnb2VzIHdyb25nIHVuZXhwZWN0ZWRseS4gVGhlcmUgYXJlIGEgY291cGxlCisgKiByZWFzb25z
IHdoeSBvbmUgZG9lcyBub3Qgd2FudCB0byBlbmFibGUgRFJNIGxvZ2dpbmcgYXQgYWxsIHRpbWVz
OgorICoKKyAqIDEuIFdlIGRvbid0IHdhbnQgdG8gb3ZlcndoZWxtIHN5c2xvZyB3aXRoIGRybSBz
cGFtLCBvdGhlcnMgaGF2ZSB0byB1c2UgaXQgdG9vCisgKiAyLiBDb25zb2xlIGxvZ2dpbmcgaXMg
c2xvdworICoKKyAqIERSTSB0cmFjaW5nIGFpbXMgdG8gc29sdmUgYm90aCB0aGVzZSBwcm9ibGVt
cy4KKyAqCisgKiBUbyB1c2UgRFJNIHRyYWNpbmcsIHdyaXRlIGEgRFJNIGRlYnVnIGNhdGVnb3J5
IG1hc2sgKHRoaXMgaXMgYSBiaXRtYXNrIG9mCisgKiAmZHJtX2RlYnVnX2NhdGVnb3J5IHZhbHVl
cykgdG8gdGhlIHRyYWNlX21hc2sgZmlsZToKKyAqIDo6CisgKgorICogICAgZWc6IGVjaG8gMHgx
MDYgPiAvc3lzL2tlcm5lbC9kZWJ1Zy9kcmkvdHJhY2VfbWFzaworICoKKyAqIE9uY2UgYWN0aXZl
LCBhbGwgbG9nIG1lc3NhZ2VzIGluIHRoZSBzcGVjaWZpZWQgY2F0ZWdvcmllcyB3aWxsIGJlIHdy
aXR0ZW4gdG8KKyAqIHRoZSBEUk0gdHJhY2UuIE9uY2UgYXQgY2FwYWNpdHksIHRoZSB0cmFjZSB3
aWxsIG92ZXJ3cml0ZSBvbGQgbWVzc2FnZXMgd2l0aAorICogbmV3IG9uZXMuIEF0IGFueSBwb2lu
dCwgb25lIGNhbiByZWFkIHRoZSB0cmFjZSBmaWxlIHRvIGV4dHJhY3QgdGhlIHByZXZpb3VzIE4K
KyAqIERSTSBtZXNzYWdlczoKKyAqIDo6CisgKgorICogICAgZWc6IGNhdCAvc3lzL2tlcm5lbC9k
ZWJ1Zy9kcmkvdHJhY2UKKyAqCisgKiBDb25zaWRlcmF0aW9ucworICogKioqKioqKioqKioqKioK
KyAqIFRoZSBjb250ZW50cyBvZiB0aGUgRFJNIFRyYWNlIGFyZSAqKm5vdCoqIGNvbnNpZGVyZWQg
VUFCSS4gKipETyBOT1QgZGVwZW5kIG9uCisgKiB0aGUgdmFsdWVzIG9mIHRoZXNlIHRyYWNlcyBp
biB5b3VyIHVzZXJzcGFjZS4qKiBUaGVzZSB0cmFjZXMgYXJlIGludGVuZGVkIGZvcgorICogZW50
ZXJ0YWlubWVudCBwdXJwb3NlcyBvbmx5LiBUaGUgY29udGVudHMgb2YgdGhlc2UgbG9ncyBjYXJy
eSBubyB3YXJyYW50eSwKKyAqIGV4cHJlc3NlZCBvciBpbXBsaWVkLgorICoKKyAqIE5ldyB0cmFj
ZXMgY2FuIG5vdCBiZSBhZGRlZCB0byB0aGUgdHJhY2UgYnVmZmVyIHdoaWxlIGl0IGlzIGJlaW5n
IHJlYWQuIElmCisgKiB0aGlzIHByb3ZlcyB0byBiZSBhIHByb2JsZW0sIGl0IGNhbiBiZSBtaXRp
Z2F0ZWQgYnkgbWFraW5nIGEgY29weSBvZiB0aGUKKyAqIGJ1ZmZlciBvbiBzdGFydCBvZiByZWFk
LiBTaW5jZSBEUk0gdHJhY2UgaXMgbm90IG1lYW50IHRvIGJlIGNvbnRpbnVvdXNseQorICogcmVh
ZCwgdGhpcyBsb3NzIGlzIGFjY2VwdGFibGUuCisgKgorICogVGhlIHRpbWVzdGFtcHMgb24gbG9n
cyBhcmUgQ1BVLWxvY2FsLiBBcyBzdWNoLCBsb2cgbWVzc2FnZXMgZnJvbSBkaWZmZXJlbnQKKyAq
IENQVXMgbWF5IGhhdmUgc2xpZ2h0bHkgZGlmZmVyZW50IGlkZWFzIGFib3V0IHRpbWUuCisgKgor
ICogU2luY2UgZWFjaCBDUFUgaGFzIGl0cyBvd24gYnVmZmVyLCB0aGV5IHdvbid0IGFsbCBvdmVy
ZmxvdyBhdCB0aGUgc2FtZSByYXRlLgorICogVGhpcyBtZWFucyB0aGF0IG1lc3NhZ2VzIGZyb20g
YSBwYXJ0aWN1bGFybHkgYWN0aXZlIENQVSBjb3VsZCBiZSBkcm9wcGVkCisgKiB3aGlsZSBhbiBp
bmFjdGl2ZSBDUFUgbWlnaHQgaGF2ZSBtdWNoIG9sZGVyIGxvZyBtZXNzYWdlcy4gU28gZG9uJ3Qg
YmUgZm9vbGVkCisgKiBpZiB5b3Ugc2VlbSB0byBiZSBtaXNzaW5nIGxvZyBtZXNzYWdlcyB3aGVu
IHlvdSBzZWUgYSBzd2l0Y2ggYmV0d2VlbiBDUFVzIGluCisgKiB0aGUgbG9ncy4KKyAqCisgKiBJ
bnRlcm5hbHMKKyAqICoqKioqKioqKgorICogVGhlIERSTSBUcmFjaW5nIGZ1bmN0aW9ucyBhcmUg
aW50ZW50aW9uYWxseSB1bmV4cG9ydGVkLCB0aGV5IGFyZSBub3QgbWVhbnQgdG8KKyAqIGJlIHVz
ZWQgYnkgZHJpdmVycyBkaXJlY3RseS4gVGhlIHJlYXNvbnMgYXJlIHR3b2ZvbGQ6CisgKgorICog
MS4gQWxsIG1lc3NhZ2VzIGdvaW5nIHRvIHRyYWNlcyBzaG91bGQgYWxzbyBnbyB0byB0aGUgY29u
c29sZSBsb2dzLiBUaGlzCisgKiAgICBlbnN1cmVzIHVzZXJzIGNhbiBjaG9vc2UgdGhlaXIgbG9n
Z2luZyBtZWRpdW0gd2l0aG91dCBmZWFyIHRoZXkncmUgbG9zaW5nCisgKiAgICBtZXNzYWdlcy4K
KyAqIDIuIFdyaXRpbmcgZGlyZWN0bHkgdG8gdGhlIHRyYWNlIHNraXBzIGNhdGVnb3J5IGZpbHRl
cmluZywgcmVzdWx0aW5nIGluIHRyYWNlCisgKiAgICBzcGFtLgorICovCisKK3N0cnVjdCBkcm1f
dHJhY2VfaW5mbyB7CisJc3RydWN0IHJpbmdfYnVmZmVyICpidWZmZXI7CisJc3RydWN0IGRlbnRy
eSAqZGVidWdmczsKKwlzdHJ1Y3QgZGVudHJ5ICpkZWJ1Z2ZzX21hc2s7CisJZW51bSBkcm1fZGVi
dWdfY2F0ZWdvcnkgY2F0ZWdvcnlfbWFzazsKK307CitzdGF0aWMgc3RydWN0IGRybV90cmFjZV9p
bmZvIGRybV90cmFjZTsKKworc3RydWN0IGRybV90cmFjZV9zZXFfaXRlciB7CisJbG9mZl90IHBv
czsKKwljcHVtYXNrX3Zhcl90IGNwdV9tYXNrOworCWludCBjcHU7CisJdTY0IHRzOworfTsKKwor
c3RhdGljIHZvaWQgKmRybV90cmFjZV9zZXFfc3RhcnQoc3RydWN0IHNlcV9maWxlICpzZXFfZmls
ZSwgbG9mZl90ICpwb3MpCit7CisJc3RydWN0IGRybV90cmFjZV9pbmZvICppbmZvID0gc2VxX2Zp
bGUtPnByaXZhdGU7CisJc3RydWN0IGRybV90cmFjZV9zZXFfaXRlciAqaXRlcjsKKwlpbnQgY3B1
OworCisJaXRlciA9IGt6YWxsb2Moc2l6ZW9mKCppdGVyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFp
dGVyKQorCQlyZXR1cm4gTlVMTDsKKworCWlmICghemFsbG9jX2NwdW1hc2tfdmFyKCZpdGVyLT5j
cHVfbWFzaywgR0ZQX0tFUk5FTCkpCisJCXJldHVybiBOVUxMOworCisJLyoKKwkgKiBUT0RPOiBX
ZSBjb3VsZCBkbyBiZXR0ZXIgdGhhbiBzdG9wcGluZyByZWNvcmQgZm9yIHRoZSBlbnRpcmV0eSBv
ZiB0aGUKKwkgKgkgcmVhZCBzZXNzaW9uLgorCSAqLworCXJpbmdfYnVmZmVyX3JlY29yZF9vZmYo
aW5mby0+YnVmZmVyKTsKKworCS8qCisJICogcG9zIGlzIG9ubHkgdXNlZCBhcyBhIG1lYW5zIG9m
IGRldGVybWluaW5nIHdoZXRoZXIgd2UncmUgYXQgdGhlIHN0YXJ0CisJICogb2YgdGhlIHZpcnR1
YWwgZmlsZSwgb3IgY29udGludWluZyBhIHJlYWQuIFdlIGRvbid0IHdhbnQgdG8gc2tpcCBvdmVy
CisJICogbG9nIGxpbmVzIHNpbmNlIHRoYXQncyBub3QgYSBtZWFuaW5nZnVsIHRoaW5nIHRvIGRv
LgorCSAqLworCWl0ZXItPnBvcyA9ICpwb3M7CisKKwlpdGVyLT5jcHUgPSAtMTsKKworCS8qCisJ
ICogVGhlcmUncyBubyB3YXkgdG8gZXh0cmFjdCB0aGUgcmluZyBidWZmZXIncyBjcHVtYXNrLCBz
byB3ZSdsbCB0cnkKKwkgKiBldmVyeSBwb3NzaWJsZSBjcHUgYW5kIHNraXAgdGhlIGludmFsaWQg
ZW50cmllcy4KKwkgKi8KKwlmb3JfZWFjaF9wb3NzaWJsZV9jcHUoY3B1KSB7CisJCWlmIChyaW5n
X2J1ZmZlcl9lbnRyaWVzX2NwdShpbmZvLT5idWZmZXIsIGNwdSkpCisJCQljcHVtYXNrX3NldF9j
cHUoY3B1LCBpdGVyLT5jcHVfbWFzayk7CisJfQorCisJcmV0dXJuIGl0ZXI7Cit9CisKK3N0YXRp
YyB2b2lkICpkcm1fdHJhY2Vfc2VxX25leHQoc3RydWN0IHNlcV9maWxlICpzZXFfZmlsZSwgdm9p
ZCAqZGF0YSwKKwkJCQlsb2ZmX3QgKnBvcykKK3sKKwlzdHJ1Y3QgZHJtX3RyYWNlX2luZm8gKmlu
Zm8gPSBzZXFfZmlsZS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX3RyYWNlX3NlcV9pdGVyICppdGVy
ID0gZGF0YTsKKwlpbnQgY3B1OworCisJKnBvcyA9ICsraXRlci0+cG9zOworCWl0ZXItPmNwdSA9
IC0xOworCWl0ZXItPnRzID0gMDsKKworCS8qIEZpbmQgdGhlIG9sZGVzdCBldmVudCBhY3Jvc3Mg
b3VyIGNwdV9tYXNrICovCisJZm9yX2VhY2hfY3B1KGNwdSwgaXRlci0+Y3B1X21hc2spIHsKKwkJ
dTY0IHRzOworCisJCWlmICghcmluZ19idWZmZXJfcGVlayhpbmZvLT5idWZmZXIsIGNwdSwgJnRz
LCBOVUxMKSkgeworCQkJY3B1bWFza19jbGVhcl9jcHUoY3B1LCBpdGVyLT5jcHVfbWFzayk7CisJ
CQljb250aW51ZTsKKwkJfQorCQlpZiAoaXRlci0+Y3B1ID09IC0xIHx8IHRzIDwgaXRlci0+dHMp
IHsKKwkJCWl0ZXItPnRzID0gdHM7CisJCQlpdGVyLT5jcHUgPSBjcHU7CisJCX0KKwl9CisJaWYg
KGl0ZXItPmNwdSA9PSAtMSkKKwkJcmV0dXJuIE5VTEw7CisKKwlyZXR1cm4gaXRlcjsKK30KKwor
c3RhdGljIHZvaWQgZHJtX3RyYWNlX3NlcV9zdG9wKHN0cnVjdCBzZXFfZmlsZSAqc2VxX2ZpbGUs
IHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRybV90cmFjZV9pbmZvICppbmZvID0gc2VxX2ZpbGUt
PnByaXZhdGU7CisJc3RydWN0IGRybV90cmFjZV9zZXFfaXRlciAqaXRlciA9IGRhdGE7CisKKwlm
cmVlX2NwdW1hc2tfdmFyKGl0ZXItPmNwdV9tYXNrKTsKKwlrZnJlZShpdGVyKTsKKworCXJpbmdf
YnVmZmVyX3JlY29yZF9vbihpbmZvLT5idWZmZXIpOworfQorCitzdGF0aWMgaW50IGRybV90cmFj
ZV9zZXFfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKnNlcV9maWxlLCB2b2lkICpkYXRhKQoreworCXN0
cnVjdCBkcm1fdHJhY2VfaW5mbyAqaW5mbyA9IHNlcV9maWxlLT5wcml2YXRlOworCXN0cnVjdCBk
cm1fdHJhY2Vfc2VxX2l0ZXIgKml0ZXIgPSBkYXRhOworCXN0cnVjdCByaW5nX2J1ZmZlcl9ldmVu
dCAqZXZlbnQ7CisJdTY0IHRzLCB1c2VjOworCisJaWYgKGl0ZXItPnBvcyA9PSAwKSB7CisJCXNl
cV9wcmludGYoc2VxX2ZpbGUsICJbJTNzICUxMnNdICVzXG4iLCAiY3B1IiwgInRpbWVzdGFtcCIs
CisJCQkgICAibWVzc2FnZSIpOworCQlyZXR1cm4gMDsKKwl9IGVsc2UgaWYgKGl0ZXItPmNwdSA9
PSAtMSkgeworCQkvKiBUaGlzIGhhcHBlbnMgd2hlbiB3ZSBzdGFydCBhIHNlc3Npb24gd2l0aCBw
b3NpdGlvbiA+IDAgKi8KKwkJcmV0dXJuIFNFUV9TS0lQOworCX0KKworCWV2ZW50ID0gcmluZ19i
dWZmZXJfY29uc3VtZShpbmZvLT5idWZmZXIsIGl0ZXItPmNwdSwgJnRzLCBOVUxMKTsKKworCXRz
ICs9IDUwMDsKKwkvKiB0cyBjb252ZXJ0cyBmcm9tIG5zLT51cyAqLworCWRvX2Rpdih0cywgMTAw
MCk7CisJLyogdHMgY29udmVydHMgZnJvbSB1cy0+cyAqLworCXVzZWMgPSBkb19kaXYodHMsIFVT
RUNfUEVSX1NFQyk7CisKKwlzZXFfcHJpbnRmKHNlcV9maWxlLCAiWyUzdSAlNWxsdS4lMDZsbHVd
ICVzIiwgaXRlci0+Y3B1LCB0cywgdXNlYywKKwkJICAgKGNvbnN0IGNoYXIgKilyaW5nX2J1ZmZl
cl9ldmVudF9kYXRhKGV2ZW50KSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBzZXFfb3BlcmF0aW9ucyBkcm1fdHJhY2Vfc29wcyA9IHsKKwkuc3RhcnQgPSBkcm1fdHJh
Y2Vfc2VxX3N0YXJ0LAorCS5uZXh0ID0gZHJtX3RyYWNlX3NlcV9uZXh0LAorCS5zdG9wID0gZHJt
X3RyYWNlX3NlcV9zdG9wLAorCS5zaG93ICA9IGRybV90cmFjZV9zZXFfc2hvdworfTsKKworc3Rh
dGljIGludCBkcm1fdHJhY2VfZm9wX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZp
bGUgKmZpbGUpCit7CisJc3RydWN0IHNlcV9maWxlICpzZXFfZmlsZTsKKwlpbnQgcmV0OworCisJ
cmV0ID0gc2VxX29wZW4oZmlsZSwgJmRybV90cmFjZV9zb3BzKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJc2VxX2ZpbGUgPSAoc3RydWN0IHNlcV9maWxlICopZmlsZS0+cHJpdmF0ZV9k
YXRhOworCXNlcV9maWxlLT5wcml2YXRlID0gaW5vZGUtPmlfcHJpdmF0ZTsgLyogdGhpcyBpcyBk
cm1fdHJhY2VfaW5mbyAqLworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZmlsZV9vcGVyYXRpb25zIGRybV90cmFjZV9mb3BzID0geworCS5vcGVuID0gZHJtX3RyYWNlX2Zv
cF9vcGVuLAorCS5yZWFkID0gc2VxX3JlYWQsCisJLmxsc2VlayA9IHNlcV9sc2VlaywKKwkucmVs
ZWFzZSA9IHNlcV9yZWxlYXNlLAorfTsKKworLyoqCisgKiBkcm1fdHJhY2VfaW5pdCAtIGluaXRp
YWxpemVzIHRyYWNpbmcgZm9yIGRybSBjb3JlCisgKiBAZGVidWdmc19yb290OiB0aGUgZGVudHJ5
IGZvciBkcm0gY29yZSdzIGRlYnVnZnMgcm9vdAorICoKKyAqIFRoaXMgZnVuY3Rpb24gaXMgY2Fs
bGVkIG9uIGRybSBjb3JlIGluaXQuIEl0IGlzIHJlc3BvbnNpYmxlIGZvciBpbml0aWFsaXppbmcK
KyAqIGRybSB0cmFjaW5nLiBUaGlzIGZ1bmN0aW9uIG11c3QgYmUgbWF0Y2hlZCBieSBhIGNhbGwg
dG8gZHJtX3RyYWNlX2NsZWFudXAoKS4KKyAqCisgKiBSZXR1cm5zOiAwIG9uIHN1Y2Nlc3MsIC1l
cnJubyBvbiBmYWlsdXJlCisgKi8KK2ludCBkcm1fdHJhY2VfaW5pdChzdHJ1Y3QgZGVudHJ5ICpk
ZWJ1Z2ZzX3Jvb3QpCit7CisJc3RydWN0IGRybV90cmFjZV9pbmZvICppbmZvID0gJmRybV90cmFj
ZTsKKwlpbnQgcmV0OworCisJaW5mby0+YnVmZmVyID0gcmluZ19idWZmZXJfYWxsb2MoUEFHRV9T
SVpFICogMiwgUkJfRkxfT1ZFUldSSVRFKTsKKwlpZiAoIWluZm8tPmJ1ZmZlcikKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwlpbmZvLT5kZWJ1Z2ZzX21hc2sgPSBkZWJ1Z2ZzX2NyZWF0ZV91MzIoInRy
YWNlX21hc2siLAorCQkJCQkJU19JRlJFRyB8IFNfSVJVR08gfCBTX0lXVVNSLAorCQkJCQkJZGVi
dWdmc19yb290LAorCQkJCQkJJmluZm8tPmNhdGVnb3J5X21hc2spOworCWlmIChJU19FUlIoaW5m
by0+ZGVidWdmcykpIHsKKwkJcmV0ID0gUFRSX0VSUihpbmZvLT5kZWJ1Z2ZzKTsKKwkJZ290byBl
cnJfZGVidWdmc19tYXNrOworCX0KKworCWluZm8tPmRlYnVnZnMgPSBkZWJ1Z2ZzX2NyZWF0ZV9m
aWxlKCJ0cmFjZSIsIFNfSUZSRUcgfCBTX0lSVUdPLAorCQkJCQkgICAgZGVidWdmc19yb290LCBp
bmZvLAorCQkJCQkgICAgJmRybV90cmFjZV9mb3BzKTsKKwlpZiAoSVNfRVJSKGluZm8tPmRlYnVn
ZnMpKSB7CisJCXJldCA9IFBUUl9FUlIoaW5mby0+ZGVidWdmcyk7CisJCWdvdG8gZXJyX2RlYnVn
ZnM7CisJfQorCisJcmV0dXJuIDA7CisKK2Vycl9kZWJ1Z2ZzX21hc2s6CisJZGVidWdmc19yZW1v
dmUoaW5mby0+ZGVidWdmc19tYXNrKTsKK2Vycl9kZWJ1Z2ZzOgorCXJpbmdfYnVmZmVyX2ZyZWUo
aW5mby0+YnVmZmVyKTsKKwlyZXR1cm4gcmV0OworfQorCisvKioKKyAqIGRybV90cmFjZV9jbGVh
bnVwIC0gY2xlYW5zIHVwIHRyYWNpbmcgZm9yIGRybSBjb3JlCisgKgorICogVGhpcyBmdW5jdGlv
biBpcyByZXNwb25zaWJsZSBmb3IgY2xlYW5pbmcgdXAgYW55dGhpbmcgdGhhdCB3YXMgcHJldmlv
dXNseQorICogaW5pdGlhbGl6ZWQgaW4gZHJtX3RyYWNlX2luaXQoKQorICovCit2b2lkIGRybV90
cmFjZV9jbGVhbnVwKCkKK3sKKwlzdHJ1Y3QgZHJtX3RyYWNlX2luZm8gKmluZm8gPSAmZHJtX3Ry
YWNlOworCisJZGVidWdmc19yZW1vdmUoaW5mby0+ZGVidWdmcyk7CisJZGVidWdmc19yZW1vdmUo
aW5mby0+ZGVidWdmc19tYXNrKTsKKwlyaW5nX2J1ZmZlcl9mcmVlKGluZm8tPmJ1ZmZlcik7CisJ
bWVtc2V0KGluZm8sIDAsIHNpemVvZigqaW5mbykpOworfQorCisvKioKKyAqIGRybV90cmFjZV9l
bmFibGVkIC0gY2hlY2sgaWYgYSBkZWJ1ZyBjYXRlZ29yeSBoYXMgdHJhY2VzIGVuYWJsZWQKKyAq
IEBjYXRlZ29yeTogdGhlIGRlYnVnIGNhdGVnb3J5IHRvIGNoZWNrCisgKgorICogUmV0dXJucyB0
cnVlIGlmIHRoZSBnaXZlbiBjYXRlZ29yeSBoYXMgZHJtIHRyYWNlcyBlbmFibGVkLCBmYWxzZSBv
dGhlcndpc2UuCisgKi8KK2Jvb2wgZHJtX3RyYWNlX2VuYWJsZWQoZW51bSBkcm1fZGVidWdfY2F0
ZWdvcnkgY2F0ZWdvcnkpCit7CisJcmV0dXJuIFJFQURfT05DRShkcm1fdHJhY2UuY2F0ZWdvcnlf
bWFzaykgJiBjYXRlZ29yeTsKK30KKworc3RhdGljIGludCBkcm1fdHJhY2Vfd3JpdGUoY29uc3Qg
dm9pZCAqZGF0YSwgdW5zaWduZWQgaW50IGxlbikKK3sKKwlzdHJ1Y3QgZHJtX3RyYWNlX2luZm8g
KmluZm8gPSAmZHJtX3RyYWNlOworCXN0cnVjdCByaW5nX2J1ZmZlcl9ldmVudCAqZXZlbnQ7CisJ
dm9pZCAqZXZlbnRfYm9keTsKKworCWV2ZW50ID0gcmluZ19idWZmZXJfbG9ja19yZXNlcnZlKGlu
Zm8tPmJ1ZmZlciwgbGVuKTsKKwlpZiAoIWV2ZW50KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWV2
ZW50X2JvZHkgPSByaW5nX2J1ZmZlcl9ldmVudF9kYXRhKGV2ZW50KTsKKwltZW1jcHkoZXZlbnRf
Ym9keSwgZGF0YSwgbGVuKTsKKworCXJldHVybiByaW5nX2J1ZmZlcl91bmxvY2tfY29tbWl0KGlu
Zm8tPmJ1ZmZlciwgZXZlbnQpOworfQorCisvKioKKyAqIGRybV90cmFjZV9wcmludGYgLSBhZGRz
IGFuIGVudHJ5IHRvIHRoZSBkcm0gdHJhY2UKKyAqIEBmb3JtYXQ6IHByaW50ZiBmb3JtYXQgb2Yg
dGhlIG1lc3NhZ2UgdG8gYWRkIHRvIHRoZSB0cmFjZQorICoKKyAqIFRoaXMgZnVuY3Rpb24gYWRk
cyBhIG5ldyBlbnRyeSBpbiB0aGUgZHJtIHRyYWNlLgorICovCit2b2lkIGRybV90cmFjZV9wcmlu
dGYoY29uc3QgY2hhciAqZm9ybWF0LCAuLi4pCit7CisJY2hhciBidWZbRFJNX1RSQUNFX01BWF9M
RU5dOworCXZhX2xpc3QgYXJnczsKKwlpbnQgcmV0OworCisJdmFfc3RhcnQoYXJncywgZm9ybWF0
KTsKKwlyZXQgPSB2c25wcmludGYoYnVmLCBzaXplb2YoYnVmKSwgZm9ybWF0LCBhcmdzKTsKKwl2
YV9lbmQoYXJncyk7CisKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuOworCWVsc2UgaWYgKHJldCA+
PSBzaXplb2YoYnVmKSkKKwkJcmV0ID0gc2l6ZW9mKGJ1ZikgLSAxOworCisJZHJtX3RyYWNlX3dy
aXRlKGJ1ZiwgcmV0ICsgMSk7Cit9CisKKy8qKgorICogZHJtX2Rldl90cmFjZV9wcmludGYgLSBh
ZGRzIGFuIGVudHJ5IHRvIHRoZSBkcm0gdHJhY2UKKyAqIEBkZXY6IHBvaW50ZXIgdG8gZGV2aWNl
IHNvIHdlIGNhbiBwcmludCB0aGUgbmFtZQorICogQGZvcm1hdDogcHJpbnRmIGZvcm1hdCBvZiB0
aGUgbWVzc2FnZSB0byBhZGQgdG8gdGhlIHRyYWNlCisgKgorICogVGhpcyBmdW5jdGlvbiBhZGRz
IGEgbmV3IGVudHJ5IGluIHRoZSBkcm0gdHJhY2UuCisgKi8KK3ZvaWQgZHJtX2Rldl90cmFjZV9w
cmludGYoY29uc3Qgc3RydWN0IGRldmljZSAqZGV2LCBjb25zdCBjaGFyICpmb3JtYXQsIC4uLikK
K3sKKwljaGFyIGJ1ZltEUk1fVFJBQ0VfTUFYX0xFTl07CisJc3RydWN0IHZhX2Zvcm1hdCB2YWY7
CisJdmFfbGlzdCBhcmdzOworCWludCByZXQ7CisKKwl2YV9zdGFydChhcmdzLCBmb3JtYXQpOwor
CXZhZi5mbXQgPSBmb3JtYXQ7CisJdmFmLnZhID0gJmFyZ3M7CisJcmV0ID0gc25wcmludGYoYnVm
LCBzaXplb2YoYnVmKSwgIiVzICVzOiAlcFYiLCBkZXZfZHJpdmVyX3N0cmluZyhkZXYpLAorCQkg
ICAgICAgZGV2X25hbWUoZGV2KSwgJnZhZik7CisJdmFfZW5kKGFyZ3MpOworCisJaWYgKHJldCA8
IDApCisJCXJldHVybjsKKwllbHNlIGlmIChyZXQgPj0gc2l6ZW9mKGJ1ZikpCisJCXJldCA9IHNp
emVvZihidWYpIC0gMTsKKworCWRybV90cmFjZV93cml0ZShidWYsIHJldCArIDEpOworfQpkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX3ByaW50LmggYi9pbmNsdWRlL2RybS9kcm1fcHJpbnQu
aAppbmRleCA4Zjk5ZDM4OTc5MmQuLjFmM2RhZTcxNTBmMCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9k
cm0vZHJtX3ByaW50LmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX3ByaW50LmgKQEAgLTMyMCw2ICsz
MjAsNDUgQEAgc3RhdGljIGlubGluZSBib29sIGRybV9kZWJ1Z19lbmFibGVkKGVudW0gZHJtX2Rl
YnVnX2NhdGVnb3J5IGNhdGVnb3J5KQogCXJldHVybiB1bmxpa2VseShfX2RybV9kZWJ1ZyAmIGNh
dGVnb3J5KTsKIH0KIAorI2lmZGVmIENPTkZJR19ERUJVR19GUworCitpbnQgZHJtX3RyYWNlX2lu
aXQoc3RydWN0IGRlbnRyeSAqZGVidWdmc19yb290KTsKK2Jvb2wgZHJtX3RyYWNlX2VuYWJsZWQo
ZW51bSBkcm1fZGVidWdfY2F0ZWdvcnkgY2F0ZWdvcnkpOworX19wcmludGYoMSwgMikKK3ZvaWQg
ZHJtX3RyYWNlX3ByaW50Zihjb25zdCBjaGFyICpmb3JtYXQsIC4uLik7CitfX3ByaW50ZigyLCAz
KQordm9pZCBkcm1fZGV2X3RyYWNlX3ByaW50Zihjb25zdCBzdHJ1Y3QgZGV2aWNlICpkZXYsIGNv
bnN0IGNoYXIgKmZvcm1hdCwgLi4uKTsKK3ZvaWQgZHJtX3RyYWNlX2NsZWFudXAodm9pZCk7CisK
KyNlbHNlCisKK3N0YXRpYyBpbmxpbmUgaW50IGRybV90cmFjZV9pbml0KHN0cnVjdCBkZW50cnkg
KmRlYnVnZnNfcm9vdCkKK3sKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlubGluZSBib29sIGRy
bV90cmFjZV9lbmFibGVkKGVudW0gZHJtX2RlYnVnX2NhdGVnb3J5IGNhdGVnb3J5KQoreworCXJl
dHVybiBmYWxzZTsKK30KKworX19wcmludGYoMSwgMikKK3N0YXRpYyBpbmxpbmUgdm9pZCBkcm1f
dHJhY2VfcHJpbnRmKGNvbnN0IGNoYXIgKmZvcm1hdCwgLi4uKQoreworfQorCitfX3ByaW50Zigy
LCAzKQorc3RhdGljIGlubGluZSB2b2lkIGRybV9kZXZfdHJhY2VfcHJpbnRmKGNvbnN0IHN0cnVj
dCBkZXZpY2UgKmRldiwKKwkJCQkJY29uc3QgY2hhciAqZm9ybWF0LCAuLi4pCit7Cit9CisKK3N0
YXRpYyBpbmxpbmUgdm9pZCBkcm1fdHJhY2VfY2xlYW51cCh2b2lkKQoreworfQorCisjZW5kaWYK
KwogLyoKICAqIHN0cnVjdCBkZXZpY2UgYmFzZWQgbG9nZ2luZwogICoKLS0gClNlYW4gUGF1bCwg
U29mdHdhcmUgRW5naW5lZXIsIEdvb2dsZSAvIENocm9taXVtIE9TCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
