Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 34BD9C2536
	for <lists+dri-devel@lfdr.de>; Mon, 30 Sep 2019 18:34:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0BBA389CC1;
	Mon, 30 Sep 2019 16:34:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 21B7389CC1
 for <dri-devel@lists.freedesktop.org>; Mon, 30 Sep 2019 16:34:02 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id r5so12070340wrm.12
 for <dri-devel@lists.freedesktop.org>; Mon, 30 Sep 2019 09:34:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=168TNc/E7xzrNDuPngaaRqgrf/QZc7wJChTmbxfsUQ4=;
 b=lNMyqvizGRth8Xnb012vFayNFZZklFNverjLHbTub5q/5R4Hlt9l8StAzoDtnU7VEl
 Vyiv47pcOsG8KHlZdD3kZeHplOJWhLEiQ3bNnogvuOKqbByB6NJU/tvtKcJRXzxl9Tqj
 NH2dhkm2stMZI6cGcZIyVZbahVEdxmr/E2yti4/beUxNaTuxxfkdFvu9BgCj/5tdJ2Sc
 9/kTJ3xVPtSr/0Ic3yu/oSniqQcxcpEaUcdPS4UlZ1usdWw+s80IdgYtIgO5tf9TeUT0
 vEIjqqUIQnuMAjBUJhoOQkBmHB1LVPt9S0vXviFIcPbWHaD73Pm7YUP67M7GBvzQBzUM
 OlXQ==
X-Gm-Message-State: APjAAAX4w2o3C7+F7ASDQ3jy2bqJQFDwFEUUYkp+33Fih9uQdFMUONeB
 WNlvSXF8DYXnVJtSvSFr4mDzx1La
X-Google-Smtp-Source: APXvYqycVoTsrMJqIDQfxOBwR1yr1QGVWGG2IBAfjuO6G62iGYMoX1Pp0x8SZ/twNyFwtRz9kDGPRA==
X-Received: by 2002:a5d:61c4:: with SMTP id q4mr13434262wrv.327.1569861240579; 
 Mon, 30 Sep 2019 09:34:00 -0700 (PDT)
Received: from baker.fritz.box ([2a02:908:1252:fb60:1d0f:3bdf:36c3:3a61])
 by smtp.gmail.com with ESMTPSA id o14sm8658108wrw.11.2019.09.30.09.33.59
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 30 Sep 2019 09:33:59 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: thellstrom@vmware.com, linux-graphics-maintainer@vmware.com,
 dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/ttm: move cpu_writers handling into vmwgfx v2
Date: Mon, 30 Sep 2019 18:33:58 +0200
Message-Id: <20190930163358.27898-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.14.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=168TNc/E7xzrNDuPngaaRqgrf/QZc7wJChTmbxfsUQ4=;
 b=FjxbF55FPOgAQRUr7TEv5l0BBL/Oc2ERWT6PjfgzD+wEv2cGEdG+zGFoYAoTLOF9xr
 RTSKnI1H1LoUCjnyGm0tOFfOBHFvfunZYNyR21exmC7DZckMHLHqzl3ILptO5RnxX6f9
 LghCITPoc9ojdibW2qvlYnBpfC7lzxSCqC58qr5n4/H5xt3/GPOOV7NWREelbzRaEj1d
 FueDPpDTFDQJlFqrUxqvm/Q/M0sCDejjg8qyOS39PibmywV12uA71ZRylxTm5PGExIQI
 vkfibVdYSes9Fd1k2U3f0T3zFukXRGb+QShqrsjsL9n9HKj8ZySb13XD7HaB1+sd1hFZ
 6jQg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2tvZW5pZy5sZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+
CgpUaGlzIGZlYXR1cmUgaXMgb25seSB1c2VkIGJ5IHZtd2dmeCBhbmQgc3VwZXJmbG91cyBmb3Ig
ZXZlcnlib2R5IGVsc2UuCgp2MjogdXNlIHZtd19idWZmZXJfb2JqZWN0IGluc3RlYWQgb2Ygdm13
X3VzZXJfYm8uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29l
bmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyAgICAgICAgICAg
ICAgIHwgMjcgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1f
Ym9fdXRpbC5jICAgICAgICAgIHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1
Zl91dGlsLmMgICAgIHwgIDcgKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9i
by5jICAgICAgICAgfCAzNiArKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5oICAgICAgICB8ICAyICsrCiBkcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3Ztd2dmeF9leGVjYnVmLmMgICAgfCAgOCArKysrKysrCiBkcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jICAgfCAgNCArKysrCiBkcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF92YWxpZGF0aW9uLmMgfCAgNCArKysrCiBpbmNsdWRlL2RybS90dG0vdHRt
X2JvX2FwaS5oICAgICAgICAgICAgICAgfCAzMSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiA5
IGZpbGVzIGNoYW5nZWQsIDQ5IGluc2VydGlvbnMoKyksIDcxIGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9iby5jCmluZGV4IDg4MWNmMjZkNjk4ZS4uYTlhYWVjZGQ3NDgxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRt
X2JvLmMKQEAgLTE1Myw3ICsxNTMsNiBAQCBzdGF0aWMgdm9pZCB0dG1fYm9fcmVsZWFzZV9saXN0
KHN0cnVjdCBrcmVmICpsaXN0X2tyZWYpCiAKIAlCVUdfT04oa3JlZl9yZWFkKCZiby0+bGlzdF9r
cmVmKSk7CiAJQlVHX09OKGtyZWZfcmVhZCgmYm8tPmtyZWYpKTsKLQlCVUdfT04oYXRvbWljX3Jl
YWQoJmJvLT5jcHVfd3JpdGVycykpOwogCUJVR19PTihiby0+bWVtLm1tX25vZGUgIT0gTlVMTCk7
CiAJQlVHX09OKCFsaXN0X2VtcHR5KCZiby0+bHJ1KSk7CiAJQlVHX09OKCFsaXN0X2VtcHR5KCZi
by0+ZGRlc3Ryb3kpKTsKQEAgLTEzMTEsNyArMTMxMCw2IEBAIGludCB0dG1fYm9faW5pdF9yZXNl
cnZlZChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAogCWtyZWZfaW5pdCgmYm8tPmtyZWYp
OwogCWtyZWZfaW5pdCgmYm8tPmxpc3Rfa3JlZik7Ci0JYXRvbWljX3NldCgmYm8tPmNwdV93cml0
ZXJzLCAwKTsKIAlJTklUX0xJU1RfSEVBRCgmYm8tPmxydSk7CiAJSU5JVF9MSVNUX0hFQUQoJmJv
LT5kZGVzdHJveSk7CiAJSU5JVF9MSVNUX0hFQUQoJmJvLT5zd2FwKTsKQEAgLTE4MjMsMzEgKzE4
MjEsNiBAQCBpbnQgdHRtX2JvX3dhaXQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIH0K
IEVYUE9SVF9TWU1CT0wodHRtX2JvX3dhaXQpOwogCi1pbnQgdHRtX2JvX3N5bmNjcHVfd3JpdGVf
Z3JhYihzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBib29sIG5vX3dhaXQpCi17Ci0JaW50
IHJldCA9IDA7Ci0KLQkvKgotCSAqIFVzaW5nIHR0bV9ib19yZXNlcnZlIG1ha2VzIHN1cmUgdGhl
IGxydSBsaXN0cyBhcmUgdXBkYXRlZC4KLQkgKi8KLQotCXJldCA9IHR0bV9ib19yZXNlcnZlKGJv
LCB0cnVlLCBub193YWl0LCBOVUxMKTsKLQlpZiAodW5saWtlbHkocmV0ICE9IDApKQotCQlyZXR1
cm4gcmV0OwotCXJldCA9IHR0bV9ib193YWl0KGJvLCB0cnVlLCBub193YWl0KTsKLQlpZiAobGlr
ZWx5KHJldCA9PSAwKSkKLQkJYXRvbWljX2luYygmYm8tPmNwdV93cml0ZXJzKTsKLQl0dG1fYm9f
dW5yZXNlcnZlKGJvKTsKLQlyZXR1cm4gcmV0OwotfQotRVhQT1JUX1NZTUJPTCh0dG1fYm9fc3lu
Y2NwdV93cml0ZV9ncmFiKTsKLQotdm9pZCB0dG1fYm9fc3luY2NwdV93cml0ZV9yZWxlYXNlKHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCi17Ci0JYXRvbWljX2RlYygmYm8tPmNwdV93cml0
ZXJzKTsKLX0KLUVYUE9SVF9TWU1CT0wodHRtX2JvX3N5bmNjcHVfd3JpdGVfcmVsZWFzZSk7Ci0K
IC8qKgogICogQSBidWZmZXIgb2JqZWN0IHNocmluayBtZXRob2QgdGhhdCB0cmllcyB0byBzd2Fw
IG91dCB0aGUgZmlyc3QKICAqIGJ1ZmZlciBvYmplY3Qgb24gdGhlIGJvX2dsb2JhbDo6c3dhcF9s
cnUgbGlzdC4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYyBi
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYwppbmRleCBmZTgxYzU2NWU3ZWYuLmIw
MDAzOWRjYjQ4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYwpAQCAtNTExLDcgKzUxMSw2
IEBAIHN0YXRpYyBpbnQgdHRtX2J1ZmZlcl9vYmplY3RfdHJhbnNmZXIoc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibywKIAltdXRleF9pbml0KCZmYm8tPmJhc2Uud3VfbXV0ZXgpOwogCWZiby0+
YmFzZS5tb3ZpbmcgPSBOVUxMOwogCWRybV92bWFfbm9kZV9yZXNldCgmZmJvLT5iYXNlLmJhc2Uu
dm1hX25vZGUpOwotCWF0b21pY19zZXQoJmZiby0+YmFzZS5jcHVfd3JpdGVycywgMCk7CiAKIAlr
cmVmX2luaXQoJmZiby0+YmFzZS5saXN0X2tyZWYpOwogCWtyZWZfaW5pdCgmZmJvLT5iYXNlLmty
ZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9leGVjYnVmX3V0aWwuYwppbmRleCAxMzFkYWU4ZjQx
NzAuLjA1MTllMWI1YTQ5YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhl
Y2J1Zl91dGlsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMK
QEAgLTExMywxMiArMTEzLDcgQEAgaW50IHR0bV9ldV9yZXNlcnZlX2J1ZmZlcnMoc3RydWN0IHd3
X2FjcXVpcmVfY3R4ICp0aWNrZXQsCiAJCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSBl
bnRyeS0+Ym87CiAKIAkJcmV0ID0gX190dG1fYm9fcmVzZXJ2ZShibywgaW50ciwgKHRpY2tldCA9
PSBOVUxMKSwgdGlja2V0KTsKLQkJaWYgKCFyZXQgJiYgdW5saWtlbHkoYXRvbWljX3JlYWQoJmJv
LT5jcHVfd3JpdGVycykgPiAwKSkgewotCQkJZG1hX3Jlc3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3Yp
OwotCi0JCQlyZXQgPSAtRUJVU1k7Ci0KLQkJfSBlbHNlIGlmIChyZXQgPT0gLUVBTFJFQURZICYm
IGR1cHMpIHsKKwkJaWYgKHJldCA9PSAtRUFMUkVBRFkgJiYgZHVwcykgewogCQkJc3RydWN0IHR0
bV92YWxpZGF0ZV9idWZmZXIgKnNhZmUgPSBlbnRyeTsKIAkJCWVudHJ5ID0gbGlzdF9wcmV2X2Vu
dHJ5KGVudHJ5LCBoZWFkKTsKIAkJCWxpc3RfZGVsKCZzYWZlLT5oZWFkKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13
Z2Z4L3Ztd2dmeF9iby5jCmluZGV4IGEwNWVmOWQwYTJlNy4uNWRkZDI1NzNiNjRjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKQEAgLTc2LDYgKzc2LDI2IEBAIHZtd191c2VyX2J1ZmZl
cl9vYmplY3Qoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAlyZXR1cm4gY29udGFpbmVy
X29mKHZtd19ibywgc3RydWN0IHZtd191c2VyX2J1ZmZlcl9vYmplY3QsIHZibyk7CiB9CiAKKy8q
KgorICogdm13X2JvX3ZlcmlmeV9zeW5jY3B1IC0gVmVyaWZ5IGlmIGdyYWIgZm9yIENQVSBhY2Nl
c3MgZXhpc3RzCisgKgorICogQGxpc3Q6IGxpc3Qgb2YgdHRtX3ZhbGlkYXRlX2J1ZmZlciBvYmpl
Y3RzCisgKgorICogUmV0dXJuOgorICogLUVCVVNZIGlmIGEgQ1BVIGdyYWIgaXMgZm91bmQsIDAg
b3RoZXJ3aXNlLgorICovCitpbnQgdm13X2JvX3ZlcmlmeV9zeW5jY3B1KHN0cnVjdCBsaXN0X2hl
YWQgKmxpc3QpCit7CisJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgKmVudHJ5OworCisJbGlz
dF9mb3JfZWFjaF9lbnRyeShlbnRyeSwgbGlzdCwgaGVhZCkgeworCQlzdHJ1Y3Qgdm13X2J1ZmZl
cl9vYmplY3QgKmJvID0gdm13X2J1ZmZlcl9vYmplY3QoZW50cnktPmJvKTsKKworICAgICAgICAg
ICAgICAgIGlmICh1bmxpa2VseShhdG9taWNfcmVhZCgmYm8tPmNwdV93cml0ZXJzKSA+IDApKQor
CQkJcmV0dXJuIC1FQlVTWTsKKwl9CisJcmV0dXJuIDA7Cit9CiAKIC8qKgogICogdm13X2JvX3Bp
bl9pbl9wbGFjZW1lbnQgLSBWYWxpZGF0ZSBhIGJ1ZmZlciB0byBwbGFjZW1lbnQuCkBAIC01NjUs
NyArNTg1LDcgQEAgc3RhdGljIHZvaWQgdm13X3VzZXJfYm9fcmVmX29ial9yZWxlYXNlKHN0cnVj
dCB0dG1fYmFzZV9vYmplY3QgKmJhc2UsCiAKIAlzd2l0Y2ggKHJlZl90eXBlKSB7CiAJY2FzZSBU
VE1fUkVGX1NZTkNDUFVfV1JJVEU6Ci0JCXR0bV9ib19zeW5jY3B1X3dyaXRlX3JlbGVhc2UoJnVz
ZXJfYm8tPnZiby5iYXNlKTsKKwkJYXRvbWljX2RlYygmdXNlcl9iby0+dmJvLmNwdV93cml0ZXJz
KTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJV0FSTl9PTkNFKHRydWUsICJVbmRlZmluZWQgYnVm
ZmVyIG9iamVjdCByZWZlcmVuY2UgcmVsZWFzZS5cbiIpOwpAQCAtNjgxLDEyICs3MDEsMTIgQEAg
c3RhdGljIGludCB2bXdfdXNlcl9ib19zeW5jY3B1X2dyYWIoc3RydWN0IHZtd191c2VyX2J1ZmZl
cl9vYmplY3QgKnVzZXJfYm8sCiAJCQkJICAgIHN0cnVjdCB0dG1fb2JqZWN0X2ZpbGUgKnRmaWxl
LAogCQkJCSAgICB1aW50MzJfdCBmbGFncykKIHsKKwlib29sIG5vbmJsb2NrID0gISEoZmxhZ3Mg
JiBkcm1fdm13X3N5bmNjcHVfZG9udGJsb2NrKTsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvID0gJnVzZXJfYm8tPnZiby5iYXNlOwogCWJvb2wgZXhpc3RlZDsKIAlpbnQgcmV0OwogCiAJ
aWYgKGZsYWdzICYgZHJtX3Ztd19zeW5jY3B1X2FsbG93X2NzKSB7Ci0JCWJvb2wgbm9uYmxvY2sg
PSAhIShmbGFncyAmIGRybV92bXdfc3luY2NwdV9kb250YmxvY2spOwogCQlsb25nIGxyZXQ7CiAK
IAkJbHJldCA9IGRtYV9yZXN2X3dhaXRfdGltZW91dF9yY3UKQEAgLTY5OSwxNSArNzE5LDIwIEBA
IHN0YXRpYyBpbnQgdm13X3VzZXJfYm9fc3luY2NwdV9ncmFiKHN0cnVjdCB2bXdfdXNlcl9idWZm
ZXJfb2JqZWN0ICp1c2VyX2JvLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlyZXQgPSB0dG1fYm9fc3lu
Y2NwdV93cml0ZV9ncmFiCi0JCShibywgISEoZmxhZ3MgJiBkcm1fdm13X3N5bmNjcHVfZG9udGJs
b2NrKSk7CisJcmV0ID0gdHRtX2JvX3Jlc2VydmUoYm8sIHRydWUsIG5vbmJsb2NrLCBOVUxMKTsK
KwlpZiAodW5saWtlbHkocmV0ICE9IDApKQorCQlyZXR1cm4gcmV0OworCXJldCA9IHR0bV9ib193
YWl0KGJvLCB0cnVlLCBub25ibG9jayk7CisJaWYgKGxpa2VseShyZXQgPT0gMCkpCisJCWF0b21p
Y19pbmMoJnVzZXJfYm8tPnZiby5jcHVfd3JpdGVycyk7CisJdHRtX2JvX3VucmVzZXJ2ZShibyk7
CiAJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkKIAkJcmV0dXJuIHJldDsKIAogCXJldCA9IHR0bV9y
ZWZfb2JqZWN0X2FkZCh0ZmlsZSwgJnVzZXJfYm8tPnByaW1lLmJhc2UsCiAJCQkJIFRUTV9SRUZf
U1lOQ0NQVV9XUklURSwgJmV4aXN0ZWQsIGZhbHNlKTsKIAlpZiAocmV0ICE9IDAgfHwgZXhpc3Rl
ZCkKLQkJdHRtX2JvX3N5bmNjcHVfd3JpdGVfcmVsZWFzZSgmdXNlcl9iby0+dmJvLmJhc2UpOwor
CQlhdG9taWNfZGVjKCZ1c2VyX2JvLT52Ym8uY3B1X3dyaXRlcnMpOwogCiAJcmV0dXJuIHJldDsK
IH0KQEAgLTczMSw3ICs3NTYsNiBAQCBzdGF0aWMgaW50IHZtd191c2VyX2JvX3N5bmNjcHVfcmVs
ZWFzZSh1aW50MzJfdCBoYW5kbGUsCiAJcmV0dXJuIDA7CiB9CiAKLQogLyoqCiAgKiB2bXdfdXNl
cl9ib19zeW5jY3B1X2lvY3RsIC0gaW9jdGwgZnVuY3Rpb24gaW1wbGVtZW50aW5nIHRoZSBzeW5j
Y3B1CiAgKiBmdW5jdGlvbmFsaXR5LgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuaAppbmRl
eCBhZGIwNDM2NTI4YzcuLjg5NGVkODA0MTg2ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC92bXdnZnhfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
ZHJ2LmgKQEAgLTkwLDYgKzkwLDcgQEAgc3RydWN0IHZtd19idWZmZXJfb2JqZWN0IHsKIAlzdHJ1
Y3QgdHRtX2J1ZmZlcl9vYmplY3QgYmFzZTsKIAlzdHJ1Y3QgbGlzdF9oZWFkIHJlc19saXN0Owog
CXMzMiBwaW5fY291bnQ7CisJYXRvbWljX3QgY3B1X3dyaXRlcnM7CiAJLyogTm90IHJlZi1jb3Vu
dGVkLiAgUHJvdGVjdGVkIGJ5IGJpbmRpbmdfbXV0ZXggKi8KIAlzdHJ1Y3Qgdm13X3Jlc291cmNl
ICpkeF9xdWVyeV9jdHg7CiAJLyogUHJvdGVjdGVkIGJ5IHJlc2VydmF0aW9uICovCkBAIC03NzMs
NiArNzc0LDcgQEAgZXh0ZXJuIHZvaWQgdm13X2JvX21vdmVfbm90aWZ5KHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sCiBleHRlcm4gdm9pZCB2bXdfYm9fc3dhcF9ub3RpZnkoc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0ICpibyk7CiBleHRlcm4gc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICoK
IHZtd191c2VyX2JvX25vcmVmX2xvb2t1cChzdHJ1Y3QgdHRtX29iamVjdF9maWxlICp0ZmlsZSwg
dTMyIGhhbmRsZSk7CitleHRlcm4gaW50IHZtd19ib192ZXJpZnlfc3luY2NwdShzdHJ1Y3QgbGlz
dF9oZWFkICpsaXN0KTsKIAogLyoqCiAgKiB2bXdfdXNlcl9ib19ub3JlZl9yZWxlYXNlIC0gcmVs
ZWFzZSBhIGJ1ZmZlciBvYmplY3QgcG9pbnRlciBsb29rZWQgdXAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2V4ZWNidWYuYyBiL2RyaXZlcnMvZ3B1L2RybS92bXdn
Zngvdm13Z2Z4X2V4ZWNidWYuYwppbmRleCBmZjg2ZDQ5ZGM1ZTguLjA3Mzg0MzZiOTBlZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZXhlY2J1Zi5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2V4ZWNidWYuYwpAQCAtMzczNyw2ICszNzM3LDEw
IEBAIGludCB2bXdfZXhlY2J1Zl9wcm9jZXNzKHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAog
CWlmICh1bmxpa2VseShyZXQgIT0gMCkpCiAJCWdvdG8gb3V0X2Vycl9ub3JlczsKIAorCXJldCA9
IHZtd19ib192ZXJpZnlfc3luY2NwdSgmdmFsX2N0eC5ib19saXN0KTsKKwlpZiAodW5saWtlbHko
cmV0ICE9IDApKQorCQlnb3RvIG91dF9lcnI7CisKIAlyZXQgPSB2bXdfdmFsaWRhdGlvbl9ib192
YWxpZGF0ZSgmdmFsX2N0eCwgdHJ1ZSk7CiAJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkKIAkJZ290
byBvdXRfZXJyOwpAQCAtMzkzNiw2ICszOTQwLDEwIEBAIHZvaWQgX192bXdfZXhlY2J1Zl9yZWxl
YXNlX3Bpbm5lZF9ibyhzdHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2LAogCWlmIChyZXQpCiAJ
CWdvdG8gb3V0X25vX3Jlc2VydmU7CiAKKwlyZXQgPSB2bXdfYm9fdmVyaWZ5X3N5bmNjcHUoJnZh
bF9jdHguYm9fbGlzdCk7CisJaWYgKHVubGlrZWx5KHJldCAhPSAwKSkKKwkJZ290byBvdXRfbm9f
ZW1pdDsKKwogCWlmIChkZXZfcHJpdi0+cXVlcnlfY2lkX3ZhbGlkKSB7CiAJCUJVR19PTihmZW5j
ZSAhPSBOVUxMKTsKIAkJcmV0ID0gdm13X2ZpZm9fZW1pdF9kdW1teV9xdWVyeShkZXZfcHJpdiwg
ZGV2X3ByaXYtPnF1ZXJ5X2NpZCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4
L3Ztd2dmeF9yZXNvdXJjZS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcmVzb3Vy
Y2UuYwppbmRleCAwYjU0NzI0NTA2MzMuLmI0OTZjZTVjMTczNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcmVzb3VyY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jCkBAIC00NjksNiArNDY5LDEwIEBAIHZtd19yZXNvdXJj
ZV9jaGVja19idWZmZXIoc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQsCiAJaWYgKHVubGlr
ZWx5KHJldCAhPSAwKSkKIAkJZ290byBvdXRfbm9fcmVzZXJ2ZTsKIAorCXJldCA9IHZtd19ib192
ZXJpZnlfc3luY2NwdSgmdmFsX2xpc3QpOworCWlmICh1bmxpa2VseShyZXQgIT0gMCkpCisJCWdv
dG8gb3V0X25vX3ZhbGlkYXRlOworCiAJaWYgKHJlcy0+ZnVuYy0+bmVlZHNfYmFja3VwICYmIGxp
c3RfZW1wdHkoJnJlcy0+bW9iX2hlYWQpKQogCQlyZXR1cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdmFsaWRhdGlvbi5jIGIvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC92bXdnZnhfdmFsaWRhdGlvbi5jCmluZGV4IGY2MTFiMjI5MGExYi4uYTdiZWFlYzkx
ZjU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF92YWxpZGF0aW9u
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdmFsaWRhdGlvbi5jCkBAIC03
MjUsNiArNzI1LDEwIEBAIGludCB2bXdfdmFsaWRhdGlvbl9wcmVwYXJlKHN0cnVjdCB2bXdfdmFs
aWRhdGlvbl9jb250ZXh0ICpjdHgsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfbm9fYm9fcmVzZXJ2
ZTsKIAorCXJldCA9IHZtd19ib192ZXJpZnlfc3luY2NwdSgmY3R4LT5ib19saXN0KTsKKwlpZiAo
dW5saWtlbHkocmV0ICE9IDApKQorCQlnb3RvIG91dF9ub192YWxpZGF0ZTsKKwogCXJldCA9IHZt
d192YWxpZGF0aW9uX2JvX3ZhbGlkYXRlKGN0eCwgaW50cik7CiAJaWYgKHJldCkKIAkJZ290byBv
dXRfbm9fdmFsaWRhdGU7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5o
IGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRleCA0M2M0OTI5YTIxNzEuLjFkNjIz
YzE0MGYwNyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAorKysgYi9p
bmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCkBAIC0xNDcsNyArMTQ3LDYgQEAgc3RydWN0IHR0
bV90dDsKICAqIGhvbGRzIGEgcG9pbnRlciB0byBhIHBlcnNpc3RlbnQgc2htZW0gb2JqZWN0Lgog
ICogQHR0bTogVFRNIHN0cnVjdHVyZSBob2xkaW5nIHN5c3RlbSBwYWdlcy4KICAqIEBldmljdGVk
OiBXaGV0aGVyIHRoZSBvYmplY3Qgd2FzIGV2aWN0ZWQgd2l0aG91dCB1c2VyLXNwYWNlIGtub3dp
bmcuCi0gKiBAY3B1X3dyaXRlczogRm9yIHN5bmNocm9uaXphdGlvbi4gTnVtYmVyIG9mIGNwdSB3
cml0ZXJzLgogICogQGxydTogTGlzdCBoZWFkIGZvciB0aGUgbHJ1IGxpc3QuCiAgKiBAZGRlc3Ry
b3k6IExpc3QgaGVhZCBmb3IgdGhlIGRlbGF5ZWQgZGVzdHJveSBsaXN0LgogICogQHN3YXA6IExp
c3QgaGVhZCBmb3Igc3dhcCBMUlUgbGlzdC4KQEAgLTE5OCwxMSArMTk3LDYgQEAgc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0IHsKIAlzdHJ1Y3QgdHRtX3R0ICp0dG07CiAJYm9vbCBldmljdGVkOwog
Ci0JLyoqCi0JICogTWVtYmVycyBwcm90ZWN0ZWQgYnkgdGhlIGJvOjpyZXNlcnZlZCBsb2NrIG9u
bHkgd2hlbiB3cml0dGVuIHRvLgotCSAqLwotCi0JYXRvbWljX3QgY3B1X3dyaXRlcnM7CiAKIAkv
KioKIAkgKiBNZW1iZXJzIHByb3RlY3RlZCBieSB0aGUgYmRldjo6bHJ1X2xvY2suCkBAIC00NDEs
MzEgKzQzNSw2IEBAIHZvaWQgdHRtX2JvX3VubG9ja19kZWxheWVkX3dvcmtxdWV1ZShzdHJ1Y3Qg
dHRtX2JvX2RldmljZSAqYmRldiwgaW50IHJlc2NoZWQpOwogYm9vbCB0dG1fYm9fZXZpY3Rpb25f
dmFsdWFibGUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJCSAgICAgIGNvbnN0IHN0
cnVjdCB0dG1fcGxhY2UgKnBsYWNlKTsKIAotLyoqCi0gKiB0dG1fYm9fc3luY2NwdV93cml0ZV9n
cmFiCi0gKgotICogQGJvOiBUaGUgYnVmZmVyIG9iamVjdDoKLSAqIEBub193YWl0OiBSZXR1cm4g
aW1tZWRpYXRlbHkgaWYgYnVmZmVyIGlzIGJ1c3kuCi0gKgotICogU3luY2hyb25pemVzIGEgYnVm
ZmVyIG9iamVjdCBmb3IgQ1BVIFJXIGFjY2Vzcy4gVGhpcyBtZWFucwotICogY29tbWFuZCBzdWJt
aXNzaW9uIHRoYXQgYWZmZWN0cyB0aGUgYnVmZmVyIHdpbGwgcmV0dXJuIC1FQlVTWQotICogdW50
aWwgdHRtX2JvX3N5bmNjcHVfd3JpdGVfcmVsZWFzZSBpcyBjYWxsZWQuCi0gKgotICogUmV0dXJu
cwotICogLUVCVVNZIGlmIHRoZSBidWZmZXIgaXMgYnVzeSBhbmQgbm9fd2FpdCBpcyB0cnVlLgot
ICogLUVSRVNUQVJUU1lTIGlmIGludGVycnVwdGVkIGJ5IGEgc2lnbmFsLgotICovCi1pbnQgdHRt
X2JvX3N5bmNjcHVfd3JpdGVfZ3JhYihzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBib29s
IG5vX3dhaXQpOwotCi0vKioKLSAqIHR0bV9ib19zeW5jY3B1X3dyaXRlX3JlbGVhc2U6Ci0gKgot
ICogQGJvIDogVGhlIGJ1ZmZlciBvYmplY3QuCi0gKgotICogUmVsZWFzZXMgYSBzeW5jY3B1IGxv
Y2suCi0gKi8KLXZvaWQgdHRtX2JvX3N5bmNjcHVfd3JpdGVfcmVsZWFzZShzdHJ1Y3QgdHRtX2J1
ZmZlcl9vYmplY3QgKmJvKTsKLQogLyoqCiAgKiB0dG1fYm9fYWNjX3NpemUKICAqCi0tIAoyLjE0
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
