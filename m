Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32884E3891
	for <lists+dri-devel@lfdr.de>; Thu, 24 Oct 2019 18:46:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 117406E4B3;
	Thu, 24 Oct 2019 16:46:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CEAA86E48F
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 16:45:45 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id w18so26321758wrt.3
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 09:45:45 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=mmTEcYYOmMVHIgwlChAlJWnry5CbvcEzASf8WlmOdH8=;
 b=TiHuQFx5+sqiOr28O9VkXLBx/kVSdcCJhEVK4N6nQxh9udp7te+iTbN6RdyVMNmp6l
 MMjML3sZsKmhRMaW7t2foxywcW2ZfFcQJufyLx+G0O4isk89bTb+DBYWZz4rBWn21DMO
 noijs9CgXYXv/qEW4GdV8AhNgc5J1SX4ZKCXaWpota8Hrc+8fFwlea0WKxKoIZZmZqpl
 lsaFj82jVo4IyEDl1EHXazYR/jXh2lSsswRQBNBwYlxHwF5+UqSKYgfC9eoQ/LwvGa6R
 mq5zzE4aAQNimtKpFf7wzldlriMek+iGesg9OZIjGWcCcDnxrU6Wh/jOBvI07VUZgBbQ
 ouyQ==
X-Gm-Message-State: APjAAAXt6Bl07FEUMNVkcCuwr/0YRJW5kraKceo7iiUe59G6Gb8qJLdS
 2nGwlqQaGkCkZJF2FMN7/fY=
X-Google-Smtp-Source: APXvYqztzQhFZ0jCrnFjNG5K/u0QloolIVfKSzI5/Asqw55Zi+2J0kMPh5AJXMUmHCD7ibJjy27bPA==
X-Received: by 2002:adf:ffc5:: with SMTP id x5mr4759973wrs.93.1571935543980;
 Thu, 24 Oct 2019 09:45:43 -0700 (PDT)
Received: from localhost (p2E5BE2CE.dip0.t-ipconnect.de. [46.91.226.206])
 by smtp.gmail.com with ESMTPSA id d2sm3453994wmd.2.2019.10.24.09.45.42
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 24 Oct 2019 09:45:42 -0700 (PDT)
From: Thierry Reding <thierry.reding@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH 03/32] drm/tegra: dp: Track link capabilities alongside
 settings
Date: Thu, 24 Oct 2019 18:45:05 +0200
Message-Id: <20191024164534.132764-4-thierry.reding@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191024164534.132764-1-thierry.reding@gmail.com>
References: <20191024164534.132764-1-thierry.reding@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=mmTEcYYOmMVHIgwlChAlJWnry5CbvcEzASf8WlmOdH8=;
 b=rZMG/4BaNuz8+ClmCKXMj58pw7SG855zvpbJZgbGHdcLErwPuIipT9j7mIW5zzJapT
 kKPpi6C68hGR7U+OFiXo0rutEu/Hw+MbkOcSYpkAX0Vr3xINuArUvqZIKJ72r9z4dWy6
 wWt1wC8Qa4xAB8HjRNjJRyYQoePJXp6x8su3ijlOXKBpl2fkr0KAHXCyIiVULpPk7Njj
 KVJ5mm+rxKkHvVZQOUKfNAmJuGhtX3NIdjvb9qFxzGepoNqMbvYJjEzMV+RTYserOcpq
 hwTKKpDDHU/6KzZr5089azRe4dj3DaKOJK1QIPuvV/SfP+kdL8YUvyl4EWMYwv2BgX01
 v+Aw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlhLmNvbT4KClN0b3JlIGNhcGFiaWxp
dGllcyBpbiBtYXhfKiBmaWVsZHMgYW5kIGFkZCBzZXBhcmF0ZSBmaWVsZHMgZm9yIHRoZQpjdXJy
ZW50bHkgc2VsZWN0ZWQgc2V0dGluZ3MuCgpTaWduZWQtb2ZmLWJ5OiBUaGllcnJ5IFJlZGluZyA8
dHJlZGluZ0BudmlkaWEuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcC5jICAgIHwg
MTYgKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RwLmggICAgfCAxNSAr
KysrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5jIHwgIDggKysrKy0t
LS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9zb3IuYyAgIHwgMjggKysrKysrKysrKysrKystLS0t
LS0tLS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAzOSBpbnNlcnRpb25zKCspLCAyOCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHAuYyBiL2RyaXZlcnMv
Z3B1L2RybS90ZWdyYS9kcC5jCmluZGV4IGMxOTA2MGI4NzUzYS4uZTU1ZWZkNDZhN2Q5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dGVncmEvZHAuYwpAQCAtMTQsOSArMTQsMTIgQEAgc3RhdGljIHZvaWQgZHJtX2RwX2xpbmtfcmVz
ZXQoc3RydWN0IGRybV9kcF9saW5rICpsaW5rKQogCQlyZXR1cm47CiAKIAlsaW5rLT5yZXZpc2lv
biA9IDA7Ci0JbGluay0+cmF0ZSA9IDA7Ci0JbGluay0+bnVtX2xhbmVzID0gMDsKKwlsaW5rLT5t
YXhfcmF0ZSA9IDA7CisJbGluay0+bWF4X2xhbmVzID0gMDsKIAlsaW5rLT5jYXBhYmlsaXRpZXMg
PSAwOworCisJbGluay0+cmF0ZSA9IDA7CisJbGluay0+bGFuZXMgPSAwOwogfQogCiAvKioKQEAg
LTQyLDEyICs0NSwxNSBAQCBpbnQgZHJtX2RwX2xpbmtfcHJvYmUoc3RydWN0IGRybV9kcF9hdXgg
KmF1eCwgc3RydWN0IGRybV9kcF9saW5rICpsaW5rKQogCQlyZXR1cm4gZXJyOwogCiAJbGluay0+
cmV2aXNpb24gPSB2YWx1ZXNbMF07Ci0JbGluay0+cmF0ZSA9IGRybV9kcF9id19jb2RlX3RvX2xp
bmtfcmF0ZSh2YWx1ZXNbMV0pOwotCWxpbmstPm51bV9sYW5lcyA9IHZhbHVlc1syXSAmIERQX01B
WF9MQU5FX0NPVU5UX01BU0s7CisJbGluay0+bWF4X3JhdGUgPSBkcm1fZHBfYndfY29kZV90b19s
aW5rX3JhdGUodmFsdWVzWzFdKTsKKwlsaW5rLT5tYXhfbGFuZXMgPSB2YWx1ZXNbMl0gJiBEUF9N
QVhfTEFORV9DT1VOVF9NQVNLOwogCiAJaWYgKHZhbHVlc1syXSAmIERQX0VOSEFOQ0VEX0ZSQU1F
X0NBUCkKIAkJbGluay0+Y2FwYWJpbGl0aWVzIHw9IERQX0xJTktfQ0FQX0VOSEFOQ0VEX0ZSQU1J
Tkc7CiAKKwlsaW5rLT5yYXRlID0gbGluay0+bWF4X3JhdGU7CisJbGluay0+bGFuZXMgPSBsaW5r
LT5tYXhfbGFuZXM7CisKIAlyZXR1cm4gMDsKIH0KIApAQCAtMTMxLDcgKzEzNyw3IEBAIGludCBk
cm1fZHBfbGlua19jb25maWd1cmUoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9k
cF9saW5rICpsaW5rKQogCWludCBlcnI7CiAKIAl2YWx1ZXNbMF0gPSBkcm1fZHBfbGlua19yYXRl
X3RvX2J3X2NvZGUobGluay0+cmF0ZSk7Ci0JdmFsdWVzWzFdID0gbGluay0+bnVtX2xhbmVzOwor
CXZhbHVlc1sxXSA9IGxpbmstPmxhbmVzOwogCiAJaWYgKGxpbmstPmNhcGFiaWxpdGllcyAmIERQ
X0xJTktfQ0FQX0VOSEFOQ0VEX0ZSQU1JTkcpCiAJCXZhbHVlc1sxXSB8PSBEUF9MQU5FX0NPVU5U
X0VOSEFOQ0VEX0ZSQU1FX0VOOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2Rw
LmggYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHAuaAppbmRleCAxY2YyNTJlNzMwOWEuLmVjMDM0
MmQ0Yzk1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RwLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3RlZ3JhL2RwLmgKQEAgLTEyLDE3ICsxMiwyMiBAQCBzdHJ1Y3QgZHJtX2Rw
X2F1eDsKICNkZWZpbmUgRFBfTElOS19DQVBfRU5IQU5DRURfRlJBTUlORyAoMSA8PCAwKQogCiAv
KioKLSAqIHN0cnVjdCBkcm1fZHBfbGluayAtIERQIGxpbmsgY2FwYWJpbGl0aWVzCisgKiBzdHJ1
Y3QgZHJtX2RwX2xpbmsgLSBEUCBsaW5rIGNhcGFiaWxpdGllcyBhbmQgY29uZmlndXJhdGlvbgog
ICogQHJldmlzaW9uOiBEUCBzcGVjaWZpY2F0aW9uIHJldmlzaW9uIHN1cHBvcnRlZCBvbiB0aGUg
bGluawotICogQHJhdGU6IG1heGltdW0gY2xvY2sgcmF0ZSBzdXBwb3J0ZWQgb24gdGhlIGxpbmsK
LSAqIEBudW1fbGFuZXM6IG1heGltdW0gbnVtYmVyIG9mIGxhbmVzIHN1cHBvcnRlZCBvbiB0aGUg
bGluaworICogQG1heF9yYXRlOiBtYXhpbXVtIGNsb2NrIHJhdGUgc3VwcG9ydGVkIG9uIHRoZSBs
aW5rCisgKiBAbWF4X2xhbmVzOiBtYXhpbXVtIG51bWJlciBvZiBsYW5lcyBzdXBwb3J0ZWQgb24g
dGhlIGxpbmsKICAqIEBjYXBhYmlsaXRpZXM6IGJpdG1hc2sgb2YgY2FwYWJpbGl0aWVzIHN1cHBv
cnRlZCBvbiB0aGUgbGluaworICogQHJhdGU6IGN1cnJlbnRseSBjb25maWd1cmVkIGxpbmsgcmF0
ZQorICogQGxhbmVzOiBjdXJyZW50bHkgY29uZmlndXJlZCBudW1iZXIgb2YgbGFuZXMKICAqLwog
c3RydWN0IGRybV9kcF9saW5rIHsKIAl1bnNpZ25lZCBjaGFyIHJldmlzaW9uOwotCXVuc2lnbmVk
IGludCByYXRlOwotCXVuc2lnbmVkIGludCBudW1fbGFuZXM7CisJdW5zaWduZWQgaW50IG1heF9y
YXRlOworCXVuc2lnbmVkIGludCBtYXhfbGFuZXM7CiAJdW5zaWduZWQgbG9uZyBjYXBhYmlsaXRp
ZXM7CisKKwl1bnNpZ25lZCBpbnQgcmF0ZTsKKwl1bnNpZ25lZCBpbnQgbGFuZXM7CiB9OwogCiBp
bnQgZHJtX2RwX2xpbmtfcHJvYmUoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9k
cF9saW5rICpsaW5rKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5j
IGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RwYXV4LmMKaW5kZXggODgzZWQyZjAyNWMzLi5iZDMz
NjFjZWE0OWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5jCkBAIC04NDksMTQgKzg0OSwxNCBAQCBpbnQg
ZHJtX2RwX2F1eF90cmFpbihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LCBzdHJ1Y3QgZHJtX2RwX2xp
bmsgKmxpbmssCiAJaWYgKHRwID09IERQX1RSQUlOSU5HX1BBVFRFUk5fRElTQUJMRSkKIAkJcmV0
dXJuIDA7CiAKLQlmb3IgKGkgPSAwOyBpIDwgbGluay0+bnVtX2xhbmVzOyBpKyspCisJZm9yIChp
ID0gMDsgaSA8IGxpbmstPmxhbmVzOyBpKyspCiAJCXZhbHVlc1tpXSA9IERQX1RSQUlOX01BWF9Q
UkVfRU1QSEFTSVNfUkVBQ0hFRCB8CiAJCQkgICAgRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMCB8
CiAJCQkgICAgRFBfVFJBSU5fTUFYX1NXSU5HX1JFQUNIRUQgfAogCQkJICAgIERQX1RSQUlOX1ZP
TFRBR0VfU1dJTkdfTEVWRUxfMDsKIAogCWVyciA9IGRybV9kcF9kcGNkX3dyaXRlKGF1eCwgRFBf
VFJBSU5JTkdfTEFORTBfU0VULCB2YWx1ZXMsCi0JCQkJbGluay0+bnVtX2xhbmVzKTsKKwkJCQls
aW5rLT5sYW5lcyk7CiAJaWYgKGVyciA8IDApCiAJCXJldHVybiBlcnI7CiAKQEAgLTg2OCwxMyAr
ODY4LDEzIEBAIGludCBkcm1fZHBfYXV4X3RyYWluKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsIHN0
cnVjdCBkcm1fZHBfbGluayAqbGluaywKIAogCXN3aXRjaCAodHApIHsKIAljYXNlIERQX1RSQUlO
SU5HX1BBVFRFUk5fMToKLQkJaWYgKCFkcm1fZHBfY2xvY2tfcmVjb3Zlcnlfb2soc3RhdHVzLCBs
aW5rLT5udW1fbGFuZXMpKQorCQlpZiAoIWRybV9kcF9jbG9ja19yZWNvdmVyeV9vayhzdGF0dXMs
IGxpbmstPmxhbmVzKSkKIAkJCXJldHVybiAtRUFHQUlOOwogCiAJCWJyZWFrOwogCiAJY2FzZSBE
UF9UUkFJTklOR19QQVRURVJOXzI6Ci0JCWlmICghZHJtX2RwX2NoYW5uZWxfZXFfb2soc3RhdHVz
LCBsaW5rLT5udW1fbGFuZXMpKQorCQlpZiAoIWRybV9kcF9jaGFubmVsX2VxX29rKHN0YXR1cywg
bGluay0+bGFuZXMpKQogCQkJcmV0dXJuIC1FQUdBSU47CiAKIAkJYnJlYWs7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvc29yLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvc29y
LmMKaW5kZXggOTFkNWM1MDQxZDJjLi5kY2E3MTI1MGQ4OGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS90ZWdyYS9zb3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvc29yLmMKQEAg
LTY1MCw3ICs2NTAsNyBAQCBzdGF0aWMgaW50IHRlZ3JhX3Nvcl9kcF90cmFpbl9mYXN0KHN0cnVj
dCB0ZWdyYV9zb3IgKnNvciwKIAlpZiAoZXJyIDwgMCkKIAkJcmV0dXJuIGVycjsKIAotCWZvciAo
aSA9IDAsIHZhbHVlID0gMDsgaSA8IGxpbmstPm51bV9sYW5lczsgaSsrKSB7CisJZm9yIChpID0g
MCwgdmFsdWUgPSAwOyBpIDwgbGluay0+bGFuZXM7IGkrKykgewogCQl1bnNpZ25lZCBsb25nIGxh
bmUgPSBTT1JfRFBfVFBHX0NIQU5ORUxfQ09ESU5HIHwKIAkJCQkgICAgIFNPUl9EUF9UUEdfU0NS
QU1CTEVSX05PTkUgfAogCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJOX1RSQUlOMTsKQEAgLTY3
MSw3ICs2NzEsNyBAQCBzdGF0aWMgaW50IHRlZ3JhX3Nvcl9kcF90cmFpbl9mYXN0KHN0cnVjdCB0
ZWdyYV9zb3IgKnNvciwKIAl2YWx1ZSB8PSBTT1JfRFBfU1BBUkVfTUFDUk9fU09SX0NMSzsKIAl0
ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9EUF9TUEFSRTApOwogCi0JZm9yIChpID0g
MCwgdmFsdWUgPSAwOyBpIDwgbGluay0+bnVtX2xhbmVzOyBpKyspIHsKKwlmb3IgKGkgPSAwLCB2
YWx1ZSA9IDA7IGkgPCBsaW5rLT5sYW5lczsgaSsrKSB7CiAJCXVuc2lnbmVkIGxvbmcgbGFuZSA9
IFNPUl9EUF9UUEdfQ0hBTk5FTF9DT0RJTkcgfAogCQkJCSAgICAgU09SX0RQX1RQR19TQ1JBTUJM
RVJfTk9ORSB8CiAJCQkJICAgICBTT1JfRFBfVFBHX1BBVFRFUk5fVFJBSU4yOwpAQCAtNjg2LDcg
KzY4Niw3IEBAIHN0YXRpYyBpbnQgdGVncmFfc29yX2RwX3RyYWluX2Zhc3Qoc3RydWN0IHRlZ3Jh
X3NvciAqc29yLAogCWlmIChlcnIgPCAwKQogCQlyZXR1cm4gZXJyOwogCi0JZm9yIChpID0gMCwg
dmFsdWUgPSAwOyBpIDwgbGluay0+bnVtX2xhbmVzOyBpKyspIHsKKwlmb3IgKGkgPSAwLCB2YWx1
ZSA9IDA7IGkgPCBsaW5rLT5sYW5lczsgaSsrKSB7CiAJCXVuc2lnbmVkIGxvbmcgbGFuZSA9IFNP
Ul9EUF9UUEdfQ0hBTk5FTF9DT0RJTkcgfAogCQkJCSAgICAgU09SX0RQX1RQR19TQ1JBTUJMRVJf
R0FMSU9TIHwKIAkJCQkgICAgIFNPUl9EUF9UUEdfUEFUVEVSTl9OT05FOwpAQCAtOTEzLDExICs5
MTMsMTEgQEAgc3RhdGljIGludCB0ZWdyYV9zb3JfY29tcHV0ZV9jb25maWcoc3RydWN0IHRlZ3Jh
X3NvciAqc29yLAogCXUzMiBudW1fc3ltc19wZXJfbGluZTsKIAl1bnNpZ25lZCBpbnQgaTsKIAot
CWlmICghbGlua19yYXRlIHx8ICFsaW5rLT5udW1fbGFuZXMgfHwgIXBjbGsgfHwgIWNvbmZpZy0+
Yml0c19wZXJfcGl4ZWwpCisJaWYgKCFsaW5rX3JhdGUgfHwgIWxpbmstPmxhbmVzIHx8ICFwY2xr
IHx8ICFjb25maWctPmJpdHNfcGVyX3BpeGVsKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCW91dHB1
dCA9IGxpbmtfcmF0ZSAqIDggKiBsaW5rLT5udW1fbGFuZXM7CiAJaW5wdXQgPSBwY2xrICogY29u
ZmlnLT5iaXRzX3Blcl9waXhlbDsKKwlvdXRwdXQgPSBsaW5rX3JhdGUgKiA4ICogbGluay0+bGFu
ZXM7CiAKIAlpZiAoaW5wdXQgPj0gb3V0cHV0KQogCQlyZXR1cm4gLUVSQU5HRTsKQEAgLTk2MCw3
ICs5NjAsNyBAQCBzdGF0aWMgaW50IHRlZ3JhX3Nvcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgdGVn
cmFfc29yICpzb3IsCiAJd2F0ZXJtYXJrID0gZGl2X3U2NCh3YXRlcm1hcmsgKyBwYXJhbXMuZXJy
b3IsIGYpOwogCWNvbmZpZy0+d2F0ZXJtYXJrID0gd2F0ZXJtYXJrICsgKGNvbmZpZy0+Yml0c19w
ZXJfcGl4ZWwgLyA4KSArIDI7CiAJbnVtX3N5bXNfcGVyX2xpbmUgPSAobW9kZS0+aGRpc3BsYXkg
KiBjb25maWctPmJpdHNfcGVyX3BpeGVsKSAqCi0JCQkgICAgKGxpbmstPm51bV9sYW5lcyAqIDgp
OworCQkJICAgIChsaW5rLT5sYW5lcyAqIDgpOwogCiAJaWYgKGNvbmZpZy0+d2F0ZXJtYXJrID4g
MzApIHsKIAkJY29uZmlnLT53YXRlcm1hcmsgPSAzMDsKQEAgLTk4MCwxMiArOTgwLDEyIEBAIHN0
YXRpYyBpbnQgdGVncmFfc29yX2NvbXB1dGVfY29uZmlnKHN0cnVjdCB0ZWdyYV9zb3IgKnNvciwK
IAlpZiAobGluay0+Y2FwYWJpbGl0aWVzICYgRFBfTElOS19DQVBfRU5IQU5DRURfRlJBTUlORykK
IAkJY29uZmlnLT5oYmxhbmtfc3ltYm9scyAtPSAzOwogCi0JY29uZmlnLT5oYmxhbmtfc3ltYm9s
cyAtPSAxMiAvIGxpbmstPm51bV9sYW5lczsKKwljb25maWctPmhibGFua19zeW1ib2xzIC09IDEy
IC8gbGluay0+bGFuZXM7CiAKIAkvKiBjb21wdXRlIHRoZSBudW1iZXIgb2Ygc3ltYm9scyBwZXIg
dmVydGljYWwgYmxhbmtpbmcgaW50ZXJ2YWwgKi8KIAludW0gPSAobW9kZS0+aGRpc3BsYXkgLSAy
NSkgKiBsaW5rX3JhdGU7CiAJY29uZmlnLT52Ymxhbmtfc3ltYm9scyA9IGRpdl91NjQobnVtLCBw
Y2xrKTsKLQljb25maWctPnZibGFua19zeW1ib2xzIC09IDM2IC8gbGluay0+bnVtX2xhbmVzICsg
NDsKKwljb25maWctPnZibGFua19zeW1ib2xzIC09IDM2IC8gbGluay0+bGFuZXMgKyA0OwogCiAJ
ZGV2X2RiZyhzb3ItPmRldiwgImJsYW5rIHN5bWJvbHM6IEg6JXUgVjoldVxuIiwgY29uZmlnLT5o
Ymxhbmtfc3ltYm9scywKIAkJY29uZmlnLT52Ymxhbmtfc3ltYm9scyk7CkBAIC0xODMxLDE3ICsx
ODMxLDE3IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9lZHBfZW5hYmxlKHN0cnVjdCBkcm1fZW5j
b2RlciAqZW5jb2RlcikKIAkvKiBwb3dlciBEUCBsYW5lcyAqLwogCXZhbHVlID0gdGVncmFfc29y
X3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwogCi0JaWYgKGxpbmsubnVt
X2xhbmVzIDw9IDIpCisJaWYgKGxpbmsubGFuZXMgPD0gMikKIAkJdmFsdWUgJj0gfihTT1JfRFBf
UEFEQ1RMX1BEX1RYRF8zIHwgU09SX0RQX1BBRENUTF9QRF9UWERfMik7CiAJZWxzZQogCQl2YWx1
ZSB8PSBTT1JfRFBfUEFEQ1RMX1BEX1RYRF8zIHwgU09SX0RQX1BBRENUTF9QRF9UWERfMjsKIAot
CWlmIChsaW5rLm51bV9sYW5lcyA8PSAxKQorCWlmIChsaW5rLmxhbmVzIDw9IDEpCiAJCXZhbHVl
ICY9IH5TT1JfRFBfUEFEQ1RMX1BEX1RYRF8xOwogCWVsc2UKIAkJdmFsdWUgfD0gU09SX0RQX1BB
RENUTF9QRF9UWERfMTsKIAotCWlmIChsaW5rLm51bV9sYW5lcyA9PSAwKQorCWlmIChsaW5rLmxh
bmVzID09IDApCiAJCXZhbHVlICY9IH5TT1JfRFBfUEFEQ1RMX1BEX1RYRF8wOwogCWVsc2UKIAkJ
dmFsdWUgfD0gU09SX0RQX1BBRENUTF9QRF9UWERfMDsKQEAgLTE4NTAsNyArMTg1MCw3IEBAIHN0
YXRpYyB2b2lkIHRlZ3JhX3Nvcl9lZHBfZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rl
cikKIAogCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgU09SX0RQX0xJTktDVEwwKTsKIAl2
YWx1ZSAmPSB+U09SX0RQX0xJTktDVExfTEFORV9DT1VOVF9NQVNLOwotCXZhbHVlIHw9IFNPUl9E
UF9MSU5LQ1RMX0xBTkVfQ09VTlQobGluay5udW1fbGFuZXMpOworCXZhbHVlIHw9IFNPUl9EUF9M
SU5LQ1RMX0xBTkVfQ09VTlQobGluay5sYW5lcyk7CiAJdGVncmFfc29yX3dyaXRlbChzb3IsIHZh
bHVlLCBTT1JfRFBfTElOS0NUTDApOwogCiAJLyogc3RhcnQgbGFuZSBzZXF1ZW5jZXIgKi8KQEAg
LTE5MDcsNyArMTkwNyw3IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9lZHBfZW5hYmxlKHN0cnVj
dCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBj
b25maWd1cmUgZURQIGxpbms6ICVkXG4iLCBlcnIpOwogCiAJcmF0ZSA9IGRybV9kcF9saW5rX3Jh
dGVfdG9fYndfY29kZShsaW5rLnJhdGUpOwotCWxhbmVzID0gbGluay5udW1fbGFuZXM7CisJbGFu
ZXMgPSBsaW5rLmxhbmVzOwogCiAJdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBTT1JfQ0xL
X0NOVFJMKTsKIAl2YWx1ZSAmPSB+U09SX0NMS19DTlRSTF9EUF9MSU5LX1NQRUVEX01BU0s7CkBA
IC0xOTI1LDcgKzE5MjUsNyBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZWRwX2VuYWJsZShzdHJ1
Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAKIAkvKiBkaXNhYmxlIHRyYWluaW5nIHBhdHRlcm4g
Z2VuZXJhdG9yICovCiAKLQlmb3IgKGkgPSAwOyBpIDwgbGluay5udW1fbGFuZXM7IGkrKykgewor
CWZvciAoaSA9IDA7IGkgPCBsaW5rLmxhbmVzOyBpKyspIHsKIAkJdW5zaWduZWQgbG9uZyBsYW5l
ID0gU09SX0RQX1RQR19DSEFOTkVMX0NPRElORyB8CiAJCQkJICAgICBTT1JfRFBfVFBHX1NDUkFN
QkxFUl9HQUxJT1MgfAogCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJOX05PTkU7Ci0tIAoyLjIz
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
