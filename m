Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 548AF88604
	for <lists+dri-devel@lfdr.de>; Sat, 10 Aug 2019 00:28:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DE0636EF27;
	Fri,  9 Aug 2019 22:27:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 44A6F6EF0F;
 Fri,  9 Aug 2019 22:27:22 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Aug 2019 15:27:22 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,366,1559545200"; d="scan'208";a="176927082"
Received: from jmath3-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.5.86])
 by fmsmga007.fm.intel.com with ESMTP; 09 Aug 2019 15:27:20 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v3 26/37] drm/i915: error capture with no ggtt slot
Date: Fri,  9 Aug 2019 23:26:32 +0100
Message-Id: <20190809222643.23142-27-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190809222643.23142-1-matthew.auld@intel.com>
References: <20190809222643.23142-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>,
 Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVs
LmNvbT4KCklmIHRoZSBhcGVydHVyZSBpcyBub3QgYXZhaWxhYmxlIGluIEhXIHdlIGNhbid0IHVz
ZSBhIGdndHQgc2xvdCBhbmQgd2MKY29weSwgc28gZmFsbCBiYWNrIHRvIHJlZ3VsYXIga21hcC4K
ClNpZ25lZC1vZmYtYnk6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3Nw
dXJpb0BpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEFiZGllbCBKYW51bGd1ZSA8YWJkaWVsLmph
bnVsZ3VlQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYyAgIHwgMTkgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmMgfCA2NCArKysrKysrKysrKysrKysrKysrKysrLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwg
NjMgaW5zZXJ0aW9ucygrKSwgMjAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYwppbmRleCBkZDI4YzU0NTI3ZTMuLjA4MTlhYzk4MzdkYyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTI2MzAsNyArMjYzMCw4IEBAIHN0YXRpYyB2b2lkIGdndHRf
cmVsZWFzZV9ndWNfdG9wKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiBzdGF0aWMgdm9pZCBjbGVh
bnVwX2luaXRfZ2d0dChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewogCWdndHRfcmVsZWFzZV9n
dWNfdG9wKGdndHQpOwotCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7
CisJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSkpCisJCWRy
bV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7CiB9CiAKIHN0YXRpYyBpbnQg
aW5pdF9nZ3R0KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCkBAIC0yNjYxLDEzICsyNjYyLDE1IEBA
IHN0YXRpYyBpbnQgaW5pdF9nZ3R0KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAotCS8qIFJlc2VydmUgYSBtYXBwYWJsZSBzbG90IGZvciBvdXIgbG9j
a2xlc3MgZXJyb3IgY2FwdHVyZSAqLwotCXJldCA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5n
ZSgmZ2d0dC0+dm0ubW0sICZnZ3R0LT5lcnJvcl9jYXB0dXJlLAotCQkJCQkgIFBBR0VfU0laRSwg
MCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKLQkJCQkJICAwLCBnZ3R0LT5tYXBwYWJsZV9lbmQs
Ci0JCQkJCSAgRFJNX01NX0lOU0VSVF9MT1cpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJ
aWYgKEhBU19NQVBQQUJMRV9BUEVSVFVSRShnZ3R0LT52bS5pOTE1KSkgeworCQkvKiBSZXNlcnZl
IGEgbWFwcGFibGUgc2xvdCBmb3Igb3VyIGxvY2tsZXNzIGVycm9yIGNhcHR1cmUgKi8KKwkJcmV0
ID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgJmdndHQtPmVycm9y
X2NhcHR1cmUsCisJCQkJCQkgIFBBR0VfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwK
KwkJCQkJCSAgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAorCQkJCQkJICBEUk1fTU1fSU5TRVJUX0xP
Vyk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KIAogCS8qCiAJICogVGhlIHVwcGVy
IHBvcnRpb24gb2YgdGhlIEd1QyBhZGRyZXNzIHNwYWNlIGhhcyBhIHNpemVhYmxlIGhvbGUKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IDkyOTg2ZDNmNjk5NS4uMTllYjVj
Y2JhMzg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKQEAgLTQwLDYgKzQw
LDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX292ZXJsYXkuaCIKIAogI2luY2x1ZGUgImdl
bS9pOTE1X2dlbV9jb250ZXh0LmgiCisjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2xtZW0uaCIKIAog
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9ncHVfZXJyb3IuaCIKQEAgLTIz
NSw2ICsyMzYsNyBAQCBzdHJ1Y3QgY29tcHJlc3MgewogCXN0cnVjdCBwYWdldmVjIHBvb2w7CiAJ
c3RydWN0IHpfc3RyZWFtX3MgenN0cmVhbTsKIAl2b2lkICp0bXA7CisJYm9vbCB3YzsKIH07CiAK
IHN0YXRpYyBib29sIGNvbXByZXNzX2luaXQoc3RydWN0IGNvbXByZXNzICpjKQpAQCAtMjkyLDcg
KzI5NCw3IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1Y3QgY29tcHJlc3MgKmMsCiAJ
c3RydWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSAmYy0+enN0cmVhbTsKIAogCXpzdHJlYW0tPm5l
eHRfaW4gPSBzcmM7Ci0JaWYgKGMtPnRtcCAmJiBpOTE1X21lbWNweV9mcm9tX3djKGMtPnRtcCwg
c3JjLCBQQUdFX1NJWkUpKQorCWlmIChjLT53YyAmJiBjLT50bXAgJiYgaTkxNV9tZW1jcHlfZnJv
bV93YyhjLT50bXAsIHNyYywgUEFHRV9TSVpFKSkKIAkJenN0cmVhbS0+bmV4dF9pbiA9IGMtPnRt
cDsKIAl6c3RyZWFtLT5hdmFpbF9pbiA9IFBBR0VfU0laRTsKIApAQCAtMzY3LDYgKzM2OSw3IEBA
IHN0YXRpYyB2b2lkIGVycl9jb21wcmVzc2lvbl9tYXJrZXIoc3RydWN0IGRybV9pOTE1X2Vycm9y
X3N0YXRlX2J1ZiAqbSkKIAogc3RydWN0IGNvbXByZXNzIHsKIAlzdHJ1Y3QgcGFnZXZlYyBwb29s
OworCWJvb2wgd2M7CiB9OwogCiBzdGF0aWMgYm9vbCBjb21wcmVzc19pbml0KHN0cnVjdCBjb21w
cmVzcyAqYykKQEAgLTM4OSw3ICszOTIsNyBAQCBzdGF0aWMgaW50IGNvbXByZXNzX3BhZ2Uoc3Ry
dWN0IGNvbXByZXNzICpjLAogCWlmICghcHRyKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmICgh
aTkxNV9tZW1jcHlfZnJvbV93YyhwdHIsIHNyYywgUEFHRV9TSVpFKSkKKwlpZiAoIShjLT53YyAm
JiBpOTE1X21lbWNweV9mcm9tX3djKHB0ciwgc3JjLCBQQUdFX1NJWkUpKSkKIAkJbWVtY3B5KHB0
ciwgc3JjLCBQQUdFX1NJWkUpOwogCWRzdC0+cGFnZXNbZHN0LT5wYWdlX2NvdW50KytdID0gcHRy
OwogCkBAIC05NjMsNyArOTY2LDYgQEAgaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKmRz
dDsKIAl1bnNpZ25lZCBsb25nIG51bV9wYWdlczsKIAlzdHJ1Y3Qgc2d0X2l0ZXIgaXRlcjsKLQlk
bWFfYWRkcl90IGRtYTsKIAlpbnQgcmV0OwogCiAJbWlnaHRfc2xlZXAoKTsKQEAgLTk4OCwxNyAr
OTkwLDUzIEBAIGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAlkc3QtPnBhZ2VfY291bnQgPSAwOwogCWRzdC0+dW51c2VkID0gMDsKIAorCWNv
bXByZXNzLT53YyA9IGk5MTVfZ2VtX29iamVjdF9pc19sbWVtKHZtYS0+b2JqKSB8fAorCQkgICAg
ICAgZHJtX21tX25vZGVfYWxsb2NhdGVkKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsKKwogCXJldCA9
IC1FSU5WQUw7Ci0JZm9yX2VhY2hfc2d0X2RtYShkbWEsIGl0ZXIsIHZtYS0+cGFnZXMpIHsKKwlp
ZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKSkgewogCQl2b2lk
IF9faW9tZW0gKnM7CisJCWRtYV9hZGRyX3QgZG1hOwogCi0JCWdndHQtPnZtLmluc2VydF9wYWdl
KCZnZ3R0LT52bSwgZG1hLCBzbG90LCBJOTE1X0NBQ0hFX05PTkUsIDApOworCQlmb3JfZWFjaF9z
Z3RfZG1hKGRtYSwgaXRlciwgdm1hLT5wYWdlcykgeworCQkJZ2d0dC0+dm0uaW5zZXJ0X3BhZ2Uo
JmdndHQtPnZtLCBkbWEsIHNsb3QsCisJCQkJCSAgICAgSTkxNV9DQUNIRV9OT05FLCAwKTsKIAot
CQlzID0gaW9fbWFwcGluZ19tYXBfd2MoJmdndHQtPmlvbWFwLCBzbG90LCBQQUdFX1NJWkUpOwot
CQlyZXQgPSBjb21wcmVzc19wYWdlKGNvbXByZXNzLCAodm9pZCAgX19mb3JjZSAqKXMsIGRzdCk7
Ci0JCWlvX21hcHBpbmdfdW5tYXAocyk7Ci0JCWlmIChyZXQpCi0JCQlicmVhazsKKwkJCXMgPSBp
b19tYXBwaW5nX21hcF93YygmZ2d0dC0+aW9tYXAsIHNsb3QsIFBBR0VfU0laRSk7CisJCQlyZXQg
PSBjb21wcmVzc19wYWdlKGNvbXByZXNzLCAodm9pZCAgX19mb3JjZSAqKXMsIGRzdCk7CisJCQlp
b19tYXBwaW5nX3VubWFwKHMpOworCQkJaWYgKHJldCkKKwkJCQlicmVhazsKKwkJfQorCX0gZWxz
ZSBpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2xtZW0odm1hLT5vYmopKSB7CisJCXZvaWQgKnM7CisJ
CWRtYV9hZGRyX3QgZG1hOworCQlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtID0gdm1h
LT5vYmotPm1tLnJlZ2lvbjsKKworCQlmb3JfZWFjaF9zZ3RfZG1hKGRtYSwgaXRlciwgdm1hLT5w
YWdlcykgeworCQkJcyA9IGlvX21hcHBpbmdfbWFwX2F0b21pY193YygmbWVtLT5pb21hcCwgZG1h
KTsKKwkJCXJldCA9IGNvbXByZXNzX3BhZ2UoY29tcHJlc3MsIHMsIGRzdCk7CisJCQlpb19tYXBw
aW5nX3VubWFwX2F0b21pYyhzKTsKKworCQkJaWYgKHJldCkKKwkJCQlicmVhazsKKwkJfQorCX0g
ZWxzZSB7CisJCXZvaWQgKnM7CisJCXN0cnVjdCBwYWdlICpwYWdlOworCisJCWZvcl9lYWNoX3Nn
dF9wYWdlKHBhZ2UsIGl0ZXIsIHZtYS0+cGFnZXMpIHsKKwkJCWRybV9jbGZsdXNoX3BhZ2VzKCZw
YWdlLCAxKTsKKworCQkJcyA9IGttYXBfYXRvbWljKHBhZ2UpOworCQkJcmV0ID0gY29tcHJlc3Nf
cGFnZShjb21wcmVzcywgcywgZHN0KTsKKwkJCWt1bm1hcF9hdG9taWMocyk7CisKKwkJCWlmIChy
ZXQpCisJCQkJYnJlYWs7CisKKwkJCWRybV9jbGZsdXNoX3BhZ2VzKCZwYWdlLCAxKTsKKwkJfQog
CX0KIAogCWlmIChyZXQgfHwgY29tcHJlc3NfZmx1c2goY29tcHJlc3MsIGRzdCkpIHsKQEAgLTE2
NjQsOSArMTcwMiwxMSBAQCBzdGF0aWMgdW5zaWduZWQgbG9uZyBjYXB0dXJlX2ZpbmRfZXBvY2go
Y29uc3Qgc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKIHN0YXRpYyB2b2lkIGNhcHR1cmVf
ZmluaXNoKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiB7CiAJc3RydWN0IGk5MTVfZ2d0
dCAqZ2d0dCA9ICZlcnJvci0+aTkxNS0+Z2d0dDsKLQljb25zdCB1NjQgc2xvdCA9IGdndHQtPmVy
cm9yX2NhcHR1cmUuc3RhcnQ7CiAKLQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIHNs
b3QsIFBBR0VfU0laRSk7CisJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJyb3Jf
Y2FwdHVyZSkpIHsKKwkJY29uc3QgdTY0IHNsb3QgPSBnZ3R0LT5lcnJvcl9jYXB0dXJlLnN0YXJ0
OworCQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIHNsb3QsIFBBR0VfU0laRSk7CisJ
fQogfQogCiAjZGVmaW5lIERBWV9BU19TRUNPTkRTKHgpICgyNCAqIDYwICogNjAgKiAoeCkpCi0t
IAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
