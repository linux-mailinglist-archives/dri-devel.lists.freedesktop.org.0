Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CD49B36F7CE
	for <lists+dri-devel@lfdr.de>; Fri, 30 Apr 2021 11:25:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4F6646F507;
	Fri, 30 Apr 2021 09:25:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x631.google.com (mail-ej1-x631.google.com
 [IPv6:2a00:1450:4864:20::631])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8BB626F507
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 09:25:14 +0000 (UTC)
Received: by mail-ej1-x631.google.com with SMTP id f24so5677292ejc.6
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 02:25:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=qvUgYtue2jAobf3uJ0ZZJZ10buNslOFzETteRqurBrc=;
 b=gWdRsBmNmr91vqyO7hc5YzIo4a3N/kXLMDOT2VDXILAJlZ4EaEjWJrVgYDokP09mnB
 wFuapQA0vkj3y2g3zhoT5RHN+Ad/maiT8ERLd/dfj6P4A2BJxIkqX1W3LLnoox4huKMy
 WM7Qgul1mZxpBbcpa08Tsz3u/KdyALcN9lLC/WkrIjvYjZoJmrSQ8p+Alahxy8l6vXek
 nXIG6p43PRRx1lNXTZ2zfYTbCYPe4V6si+MtCbeM8ezHi/w0hsHBHGKe/1jjDD+tL0bj
 Kot4bEmwQWxOiJwOtb1YCbtGUHywkt5t6slHZ0stvfaSAiJCDyjDoopB29GDU0tywsvf
 Vhxw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=qvUgYtue2jAobf3uJ0ZZJZ10buNslOFzETteRqurBrc=;
 b=eZKVnSr2Y2oBeP9uNCqYIq8+EfX5zq/TNJrJYRHDyWaGsc+Cr2iaobONYPV7TovyKc
 AimYCu8BU4T5OcNa50PQvRPmcHYTSVAod5xoGzwMIvpjgRBLyRD6VZJIimIK0LdeO1vz
 369/i10eLTHldA9sFSXetQSy7hHhX4eP4DI5JhFdEG8DuLx7aov1XHT/lypVBFdLNryT
 TWCdx36EssBNS4y1GJak6loZtuIpnAJm4lxZKbaHZr+dx0AeMBROUz5fs/c79suf55WU
 eWmWIa02DChtDdde+R8c6l55GPh8xUPGRWA6yLyaMHWY3+/OMA0Z+sVuqxMKyBmwHMAO
 ZZng==
X-Gm-Message-State: AOAM531XRv24EY5n4vApfAUxUjyZy4AaJv/APFCO535SnnrJWVFf5hgk
 2jX2TMItrXgQU6HgIXbxu3d8Tz4Cf3s=
X-Google-Smtp-Source: ABdhPJzTeYZVC0sbclxgoLRLm+faGHPnaJJUkhDNVaiEoyGJK+eCDZucMDyPBG9R9iQVVkHsxg10qA==
X-Received: by 2002:a17:907:10cb:: with SMTP id
 rv11mr3216923ejb.379.1619774713169; 
 Fri, 30 Apr 2021 02:25:13 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:d08c:9633:b7a2:37e2])
 by smtp.gmail.com with ESMTPSA id h23sm1550959ejx.90.2021.04.30.02.25.12
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 30 Apr 2021 02:25:12 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 05/13] drm/ttm: allocate resource object instead of embedding
 it
Date: Fri, 30 Apr 2021 11:25:00 +0200
Message-Id: <20210430092508.60710-5-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210430092508.60710-1-christian.koenig@amd.com>
References: <20210430092508.60710-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@ffwll.ch, matthew.william.auld@gmail.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VG8gaW1wcm92ZSB0aGUgaGFuZGxpbmcgd2Ugd2FudCB0aGUgZXN0YWJsaXNoIHRoZSByZXNvdXJj
ZSBvYmplY3QgYXMgYmFzZQpjbGFzcyBmb3IgdGhlIGJhY2tlbmQgYWxsb2NhdGlvbnMuCgpTaWdu
ZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jIHwgIDQgKy0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICB8IDU0ICsrKysrKystLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICAgICAgIHwgIDIgKy0K
IGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3R0bS5jICAgICAgICB8ICAyICstCiBkcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jICAgICAgICAgICAgICAgfCA3NiArKysrKysrLS0tLS0t
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMgICAgICAgICAgfCA0
MSArKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Jlc291cmNlLmMgICAgICAg
ICB8IDMwICsrKysrKy0tLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZl
ci5jIHwgIDIgKy0KIGluY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmggICAgICAgICAgICAgICB8
ICAxIC0KIGluY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggICAgICAgICAgICB8IDEwICsr
LQogaW5jbHVkZS9kcm0vdHRtL3R0bV9yZXNvdXJjZS5oICAgICAgICAgICAgIHwgIDQgKy0KIDEx
IGZpbGVzIGNoYW5nZWQsIDEwMSBpbnNlcnRpb25zKCspLCAxMjUgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCmluZGV4IDZiYjlkOWQwNTMy
Ni4uZTY2OWEzYWRhYzQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jCkBAIC0zNjIsMTQgKzM2MiwxNCBAQCBpbnQgYW1kZ3B1X2JvX2NyZWF0ZV9rZXJuZWxf
YXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJaWYgKGNwdV9hZGRyKQogCQlhbWRncHVf
Ym9fa3VubWFwKCpib19wdHIpOwogCi0JdHRtX3Jlc291cmNlX2ZyZWUoJigqYm9fcHRyKS0+dGJv
LCAoKmJvX3B0ciktPnRiby5yZXNvdXJjZSk7CisJdHRtX3Jlc291cmNlX2ZyZWUoJigqYm9fcHRy
KS0+dGJvLCAmKCpib19wdHIpLT50Ym8ucmVzb3VyY2UpOwogCiAJZm9yIChpID0gMDsgaSA8ICgq
Ym9fcHRyKS0+cGxhY2VtZW50Lm51bV9wbGFjZW1lbnQ7ICsraSkgewogCQkoKmJvX3B0ciktPnBs
YWNlbWVudHNbaV0uZnBmbiA9IG9mZnNldCA+PiBQQUdFX1NISUZUOwogCQkoKmJvX3B0ciktPnBs
YWNlbWVudHNbaV0ubHBmbiA9IChvZmZzZXQgKyBzaXplKSA+PiBQQUdFX1NISUZUOwogCX0KIAly
ID0gdHRtX2JvX21lbV9zcGFjZSgmKCpib19wdHIpLT50Ym8sICYoKmJvX3B0ciktPnBsYWNlbWVu
dCwKLQkJCSAgICAgKCpib19wdHIpLT50Ym8ucmVzb3VyY2UsICZjdHgpOworCQkJICAgICAmKCpi
b19wdHIpLT50Ym8ucmVzb3VyY2UsICZjdHgpOwogCWlmIChyKQogCQlnb3RvIGVycm9yOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggNTgxNTIzZDIxMmQyLi4z
ZmUyNDgyYTQwYjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAg
LTUwMyw3ICs1MDMsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19tb3ZlKHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3QsCiAJCQlyZXR1cm4gcjsKIAogCQlhbWRncHVfdHRt
X2JhY2tlbmRfdW5iaW5kKGJvLT5iZGV2LCBiby0+dHRtKTsKLQkJdHRtX3Jlc291cmNlX2ZyZWUo
Ym8sIGJvLT5yZXNvdXJjZSk7CisJCXR0bV9yZXNvdXJjZV9mcmVlKGJvLCAmYm8tPnJlc291cmNl
KTsKIAkJdHRtX2JvX2Fzc2lnbl9tZW0oYm8sIG5ld19tZW0pOwogCQlnb3RvIG91dDsKIAl9CkBA
IC0xMDAxLDkgKzEwMDEsOSBAQCBpbnQgYW1kZ3B1X3R0bV9hbGxvY19nYXJ0KHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8pCiAJc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRncHVf
dHRtX2FkZXYoYm8tPmJkZXYpOwogCXN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCBjdHggPSB7IGZh
bHNlLCBmYWxzZSB9OwogCXN0cnVjdCBhbWRncHVfdHRtX3R0ICpndHQgPSAodm9pZCAqKWJvLT50
dG07Ci0Jc3RydWN0IHR0bV9yZXNvdXJjZSB0bXA7CiAJc3RydWN0IHR0bV9wbGFjZW1lbnQgcGxh
Y2VtZW50OwogCXN0cnVjdCB0dG1fcGxhY2UgcGxhY2VtZW50czsKKwlzdHJ1Y3QgdHRtX3Jlc291
cmNlICp0bXA7CiAJdWludDY0X3QgYWRkciwgZmxhZ3M7CiAJaW50IHI7CiAKQEAgLTEwMTMsMzcg
KzEwMTMsMzcgQEAgaW50IGFtZGdwdV90dG1fYWxsb2NfZ2FydChzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvKQogCWFkZHIgPSBhbWRncHVfZ21jX2FncF9hZGRyKGJvKTsKIAlpZiAoYWRkciAh
PSBBTURHUFVfQk9fSU5WQUxJRF9PRkZTRVQpIHsKIAkJYm8tPnJlc291cmNlLT5zdGFydCA9IGFk
ZHIgPj4gUEFHRV9TSElGVDsKLQl9IGVsc2UgeworCQlyZXR1cm4gMDsKKwl9CiAKLQkJLyogYWxs
b2NhdGUgR0FSVCBzcGFjZSAqLwotCQlwbGFjZW1lbnQubnVtX3BsYWNlbWVudCA9IDE7Ci0JCXBs
YWNlbWVudC5wbGFjZW1lbnQgPSAmcGxhY2VtZW50czsKLQkJcGxhY2VtZW50Lm51bV9idXN5X3Bs
YWNlbWVudCA9IDE7Ci0JCXBsYWNlbWVudC5idXN5X3BsYWNlbWVudCA9ICZwbGFjZW1lbnRzOwot
CQlwbGFjZW1lbnRzLmZwZm4gPSAwOwotCQlwbGFjZW1lbnRzLmxwZm4gPSBhZGV2LT5nbWMuZ2Fy
dF9zaXplID4+IFBBR0VfU0hJRlQ7Ci0JCXBsYWNlbWVudHMubWVtX3R5cGUgPSBUVE1fUExfVFQ7
Ci0JCXBsYWNlbWVudHMuZmxhZ3MgPSBiby0+cmVzb3VyY2UtPnBsYWNlbWVudDsKLQotCQlyID0g
dHRtX2JvX21lbV9zcGFjZShibywgJnBsYWNlbWVudCwgJnRtcCwgJmN0eCk7Ci0JCWlmICh1bmxp
a2VseShyKSkKLQkJCXJldHVybiByOworCS8qIGFsbG9jYXRlIEdBUlQgc3BhY2UgKi8KKwlwbGFj
ZW1lbnQubnVtX3BsYWNlbWVudCA9IDE7CisJcGxhY2VtZW50LnBsYWNlbWVudCA9ICZwbGFjZW1l
bnRzOworCXBsYWNlbWVudC5udW1fYnVzeV9wbGFjZW1lbnQgPSAxOworCXBsYWNlbWVudC5idXN5
X3BsYWNlbWVudCA9ICZwbGFjZW1lbnRzOworCXBsYWNlbWVudHMuZnBmbiA9IDA7CisJcGxhY2Vt
ZW50cy5scGZuID0gYWRldi0+Z21jLmdhcnRfc2l6ZSA+PiBQQUdFX1NISUZUOworCXBsYWNlbWVu
dHMubWVtX3R5cGUgPSBUVE1fUExfVFQ7CisJcGxhY2VtZW50cy5mbGFncyA9IGJvLT5yZXNvdXJj
ZS0+cGxhY2VtZW50OwogCi0JCS8qIGNvbXB1dGUgUFRFIGZsYWdzIGZvciB0aGlzIGJ1ZmZlciBv
YmplY3QgKi8KLQkJZmxhZ3MgPSBhbWRncHVfdHRtX3R0X3B0ZV9mbGFncyhhZGV2LCBiby0+dHRt
LCAmdG1wKTsKKwlyID0gdHRtX2JvX21lbV9zcGFjZShibywgJnBsYWNlbWVudCwgJnRtcCwgJmN0
eCk7CisJaWYgKHVubGlrZWx5KHIpKQorCQlyZXR1cm4gcjsKIAotCQkvKiBCaW5kIHBhZ2VzICov
Ci0JCWd0dC0+b2Zmc2V0ID0gKHU2NCl0bXAuc3RhcnQgPDwgUEFHRV9TSElGVDsKLQkJciA9IGFt
ZGdwdV90dG1fZ2FydF9iaW5kKGFkZXYsIGJvLCBmbGFncyk7Ci0JCWlmICh1bmxpa2VseShyKSkg
ewotCQkJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZ0bXApOwotCQkJcmV0dXJuIHI7Ci0JCX0KKwkv
KiBjb21wdXRlIFBURSBmbGFncyBmb3IgdGhpcyBidWZmZXIgb2JqZWN0ICovCisJZmxhZ3MgPSBh
bWRncHVfdHRtX3R0X3B0ZV9mbGFncyhhZGV2LCBiby0+dHRtLCB0bXApOwogCi0JCXR0bV9yZXNv
dXJjZV9mcmVlKGJvLCBiby0+cmVzb3VyY2UpOwotCQl0dG1fYm9fYXNzaWduX21lbShibywgJnRt
cCk7CisJLyogQmluZCBwYWdlcyAqLworCWd0dC0+b2Zmc2V0ID0gKHU2NCl0bXAtPnN0YXJ0IDw8
IFBBR0VfU0hJRlQ7CisJciA9IGFtZGdwdV90dG1fZ2FydF9iaW5kKGFkZXYsIGJvLCBmbGFncyk7
CisJaWYgKHVubGlrZWx5KHIpKSB7CisJCXR0bV9yZXNvdXJjZV9mcmVlKGJvLCAmdG1wKTsKKwkJ
cmV0dXJuIHI7CiAJfQogCisJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZiby0+cmVzb3VyY2UpOwor
CXR0bV9ib19hc3NpZ25fbWVtKGJvLCB0bXApOworCiAJcmV0dXJuIDA7CiB9CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfYm8uYwppbmRleCA5ZWFhMzI3NGJkMDIuLmJlNTQ2YTJkM2UzNiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYwpAQCAtMTAwOSw3ICsxMDA5LDcgQEAg
bm91dmVhdV9ib19tb3ZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3Qs
CiAJaWYgKG9sZF9yZWctPm1lbV90eXBlID09IFRUTV9QTF9UVCAmJgogCSAgICBuZXdfcmVnLT5t
ZW1fdHlwZSA9PSBUVE1fUExfU1lTVEVNKSB7CiAJCW5vdXZlYXVfdHRtX3R0X3VuYmluZChiby0+
YmRldiwgYm8tPnR0bSk7Ci0JCXR0bV9yZXNvdXJjZV9mcmVlKGJvLCBiby0+cmVzb3VyY2UpOwor
CQl0dG1fcmVzb3VyY2VfZnJlZShibywgJmJvLT5yZXNvdXJjZSk7CiAJCXR0bV9ib19hc3NpZ25f
bWVtKGJvLCBuZXdfcmVnKTsKIAkJZ290byBvdXQ7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3JhZGVvbi9yYWRlb25fdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVv
bl90dG0uYwppbmRleCA0Nzg3YmMyODEyODEuLjUxOTFlOTk0YmZmNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Jh
ZGVvbi9yYWRlb25fdHRtLmMKQEAgLTI0MSw3ICsyNDEsNyBAQCBzdGF0aWMgaW50IHJhZGVvbl9i
b19tb3ZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3QsCiAJaWYgKG9s
ZF9tZW0tPm1lbV90eXBlID09IFRUTV9QTF9UVCAmJgogCSAgICBuZXdfbWVtLT5tZW1fdHlwZSA9
PSBUVE1fUExfU1lTVEVNKSB7CiAJCXJhZGVvbl90dG1fdHRfdW5iaW5kKGJvLT5iZGV2LCBiby0+
dHRtKTsKLQkJdHRtX3Jlc291cmNlX2ZyZWUoYm8sIGJvLT5yZXNvdXJjZSk7CisJCXR0bV9yZXNv
dXJjZV9mcmVlKGJvLCAmYm8tPnJlc291cmNlKTsKIAkJdHRtX2JvX2Fzc2lnbl9tZW0oYm8sIG5l
d19tZW0pOwogCQlnb3RvIG91dDsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYwppbmRleCBkNmNiMmIyODli
YTUuLjg1MTdjODIzYWZjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCkBAIC0yMjMsNyArMjIzLDcgQEAg
c3RhdGljIHZvaWQgdHRtX2JvX2NsZWFudXBfbWVtdHlwZV91c2Uoc3RydWN0IHR0bV9idWZmZXJf
b2JqZWN0ICpibykKIAkJYm8tPmJkZXYtPmZ1bmNzLT5kZWxldGVfbWVtX25vdGlmeShibyk7CiAK
IAl0dG1fYm9fdHRfZGVzdHJveShibyk7Ci0JdHRtX3Jlc291cmNlX2ZyZWUoYm8sIGJvLT5yZXNv
dXJjZSk7CisJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZiby0+cmVzb3VyY2UpOwogfQogCiBzdGF0
aWMgaW50IHR0bV9ib19pbmRpdmlkdWFsaXplX3Jlc3Yoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0
ICpibykKQEAgLTQ4OSw3ICs0ODksNyBAQCBzdGF0aWMgaW50IHR0bV9ib19ldmljdChzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgp
CiB7CiAJc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYgPSBiby0+YmRldjsKLQlzdHJ1Y3QgdHRtX3Jl
c291cmNlIGV2aWN0X21lbTsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlICpldmljdF9tZW07CiAJc3Ry
dWN0IHR0bV9wbGFjZW1lbnQgcGxhY2VtZW50OwogCXN0cnVjdCB0dG1fcGxhY2UgaG9wOwogCWlu
dCByZXQgPSAwOwpAQCAtNTE5LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgdHRtX2JvX2V2aWN0KHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCWdvdG8gb3V0OwogCX0KIAotCXJldCA9IHR0
bV9ib19oYW5kbGVfbW92ZV9tZW0oYm8sICZldmljdF9tZW0sIHRydWUsIGN0eCwgJmhvcCk7CisJ
cmV0ID0gdHRtX2JvX2hhbmRsZV9tb3ZlX21lbShibywgZXZpY3RfbWVtLCB0cnVlLCBjdHgsICZo
b3ApOwogCWlmICh1bmxpa2VseShyZXQpKSB7CiAJCVdBUk4ocmV0ID09IC1FTVVMVElIT1AsICJV
bmV4cGVjdGVkIG11bHRpaG9wIGluIGV2aWN0aW9uIC0gbGlrZWx5IGRyaXZlciBidWdcbiIpOwog
CQlpZiAocmV0ICE9IC1FUkVTVEFSVFNZUykKQEAgLTcyNiwxNCArNzI2LDE1IEBAIHN0YXRpYyBp
bnQgdHRtX2JvX2FkZF9tb3ZlX2ZlbmNlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAg
Ki8KIHN0YXRpYyBpbnQgdHRtX2JvX21lbV9mb3JjZV9zcGFjZShzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvLAogCQkJCSAgY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UsCi0JCQkJICBz
dHJ1Y3QgdHRtX3Jlc291cmNlICptZW0sCisJCQkJICBzdHJ1Y3QgdHRtX3Jlc291cmNlICoqbWVt
LAogCQkJCSAgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpCiB7CiAJc3RydWN0IHR0bV9k
ZXZpY2UgKmJkZXYgPSBiby0+YmRldjsKLQlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1h
biA9IHR0bV9tYW5hZ2VyX3R5cGUoYmRldiwgbWVtLT5tZW1fdHlwZSk7CisJc3RydWN0IHR0bV9y
ZXNvdXJjZV9tYW5hZ2VyICptYW47CiAJc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQ7CiAJ
aW50IHJldDsKIAorCW1hbiA9IHR0bV9tYW5hZ2VyX3R5cGUoYmRldiwgKCptZW0pLT5tZW1fdHlw
ZSk7CiAJdGlja2V0ID0gZG1hX3Jlc3ZfbG9ja2luZ19jdHgoYm8tPmJhc2UucmVzdik7CiAJZG8g
ewogCQlyZXQgPSB0dG1fcmVzb3VyY2VfYWxsb2MoYm8sIHBsYWNlLCBtZW0pOwpAQCAtNzQ3LDM3
ICs3NDgsNyBAQCBzdGF0aWMgaW50IHR0bV9ib19tZW1fZm9yY2Vfc3BhY2Uoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibywKIAkJCXJldHVybiByZXQ7CiAJfSB3aGlsZSAoMSk7CiAKLQlyZXR1
cm4gdHRtX2JvX2FkZF9tb3ZlX2ZlbmNlKGJvLCBtYW4sIG1lbSwgY3R4LT5ub193YWl0X2dwdSk7
Ci19Ci0KLS8qKgotICogdHRtX2JvX21lbV9wbGFjZW1lbnQgLSBjaGVjayBpZiBwbGFjZW1lbnQg
aXMgY29tcGF0aWJsZQotICogQGJvOiBCTyB0byBmaW5kIG1lbW9yeSBmb3IKLSAqIEBwbGFjZTog
d2hlcmUgdG8gc2VhcmNoCi0gKiBAbWVtOiB0aGUgbWVtb3J5IG9iamVjdCB0byBmaWxsIGluCi0g
KgotICogQ2hlY2sgaWYgcGxhY2VtZW50IGlzIGNvbXBhdGlibGUgYW5kIGZpbGwgaW4gbWVtIHN0
cnVjdHVyZS4KLSAqIFJldHVybnMgLUVCVVNZIGlmIHBsYWNlbWVudCB3b24ndCB3b3JrIG9yIG5l
Z2F0aXZlIGVycm9yIGNvZGUuCi0gKiAwIHdoZW4gcGxhY2VtZW50IGNhbiBiZSB1c2VkLgotICov
Ci1zdGF0aWMgaW50IHR0bV9ib19tZW1fcGxhY2VtZW50KHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8sCi0JCQkJY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UsCi0JCQkJc3RydWN0IHR0
bV9yZXNvdXJjZSAqbWVtKQotewotCXN0cnVjdCB0dG1fZGV2aWNlICpiZGV2ID0gYm8tPmJkZXY7
Ci0Jc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW47Ci0KLQltYW4gPSB0dG1fbWFuYWdl
cl90eXBlKGJkZXYsIHBsYWNlLT5tZW1fdHlwZSk7Ci0JaWYgKCFtYW4gfHwgIXR0bV9yZXNvdXJj
ZV9tYW5hZ2VyX3VzZWQobWFuKSkKLQkJcmV0dXJuIC1FQlVTWTsKLQotCW1lbS0+bWVtX3R5cGUg
PSBwbGFjZS0+bWVtX3R5cGU7Ci0JbWVtLT5wbGFjZW1lbnQgPSBwbGFjZS0+ZmxhZ3M7Ci0KLQlz
cGluX2xvY2soJmJvLT5iZGV2LT5scnVfbG9jayk7Ci0JdHRtX2JvX21vdmVfdG9fbHJ1X3RhaWwo
Ym8sIG1lbSwgTlVMTCk7Ci0Jc3Bpbl91bmxvY2soJmJvLT5iZGV2LT5scnVfbG9jayk7Ci0JcmV0
dXJuIDA7CisJcmV0dXJuIHR0bV9ib19hZGRfbW92ZV9mZW5jZShibywgbWFuLCAqbWVtLCBjdHgt
Pm5vX3dhaXRfZ3B1KTsKIH0KIAogLyoKQEAgLTc5MCw3ICs3NjEsNyBAQCBzdGF0aWMgaW50IHR0
bV9ib19tZW1fcGxhY2VtZW50KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAgKi8KIGlu
dCB0dG1fYm9fbWVtX3NwYWNlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQlzdHJ1
Y3QgdHRtX3BsYWNlbWVudCAqcGxhY2VtZW50LAotCQkJc3RydWN0IHR0bV9yZXNvdXJjZSAqbWVt
LAorCQkJc3RydWN0IHR0bV9yZXNvdXJjZSAqKm1lbSwKIAkJCXN0cnVjdCB0dG1fb3BlcmF0aW9u
X2N0eCAqY3R4KQogewogCXN0cnVjdCB0dG1fZGV2aWNlICpiZGV2ID0gYm8tPmJkZXY7CkBAIC04
MDUsOCArNzc2LDggQEAgaW50IHR0bV9ib19tZW1fc3BhY2Uoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywKIAkJY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UgPSAmcGxhY2VtZW50LT5w
bGFjZW1lbnRbaV07CiAJCXN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuOwogCi0JCXJl
dCA9IHR0bV9ib19tZW1fcGxhY2VtZW50KGJvLCBwbGFjZSwgbWVtKTsKLQkJaWYgKHJldCkKKwkJ
bWFuID0gdHRtX21hbmFnZXJfdHlwZShiZGV2LCBwbGFjZS0+bWVtX3R5cGUpOworCQlpZiAoIW1h
biB8fCAhdHRtX3Jlc291cmNlX21hbmFnZXJfdXNlZChtYW4pKQogCQkJY29udGludWU7CiAKIAkJ
dHlwZV9mb3VuZCA9IHRydWU7CkBAIC04MTYsOCArNzg3LDcgQEAgaW50IHR0bV9ib19tZW1fc3Bh
Y2Uoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJaWYgKHVubGlrZWx5KHJldCkpCiAJ
CQlnb3RvIGVycm9yOwogCi0JCW1hbiA9IHR0bV9tYW5hZ2VyX3R5cGUoYmRldiwgbWVtLT5tZW1f
dHlwZSk7Ci0JCXJldCA9IHR0bV9ib19hZGRfbW92ZV9mZW5jZShibywgbWFuLCBtZW0sIGN0eC0+
bm9fd2FpdF9ncHUpOworCQlyZXQgPSB0dG1fYm9fYWRkX21vdmVfZmVuY2UoYm8sIG1hbiwgKm1l
bSwgY3R4LT5ub193YWl0X2dwdSk7CiAJCWlmICh1bmxpa2VseShyZXQpKSB7CiAJCQl0dG1fcmVz
b3VyY2VfZnJlZShibywgbWVtKTsKIAkJCWlmIChyZXQgPT0gLUVCVVNZKQpAQCAtODMwLDkgKzgw
MCwxMCBAQCBpbnQgdHRtX2JvX21lbV9zcGFjZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
LAogCiAJZm9yIChpID0gMDsgaSA8IHBsYWNlbWVudC0+bnVtX2J1c3lfcGxhY2VtZW50OyArK2kp
IHsKIAkJY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UgPSAmcGxhY2VtZW50LT5idXN5X3Bs
YWNlbWVudFtpXTsKKwkJc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW47CiAKLQkJcmV0
ID0gdHRtX2JvX21lbV9wbGFjZW1lbnQoYm8sIHBsYWNlLCBtZW0pOwotCQlpZiAocmV0KQorCQlt
YW4gPSB0dG1fbWFuYWdlcl90eXBlKGJkZXYsIHBsYWNlLT5tZW1fdHlwZSk7CisJCWlmICghbWFu
IHx8ICF0dG1fcmVzb3VyY2VfbWFuYWdlcl91c2VkKG1hbikpCiAJCQljb250aW51ZTsKIAogCQl0
eXBlX2ZvdW5kID0gdHJ1ZTsKQEAgLTg1OSwxMiArODMwLDEyIEBAIGludCB0dG1fYm9fbWVtX3Nw
YWNlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiBFWFBPUlRfU1lNQk9MKHR0bV9ib19t
ZW1fc3BhY2UpOwogCiBzdGF0aWMgaW50IHR0bV9ib19ib3VuY2VfdGVtcF9idWZmZXIoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibywKLQkJCQkgICAgIHN0cnVjdCB0dG1fcmVzb3VyY2UgKm1l
bSwKKwkJCQkgICAgIHN0cnVjdCB0dG1fcmVzb3VyY2UgKiptZW0sCiAJCQkJICAgICBzdHJ1Y3Qg
dHRtX29wZXJhdGlvbl9jdHggKmN0eCwKIAkJCQkgICAgIHN0cnVjdCB0dG1fcGxhY2UgKmhvcCkK
IHsKIAlzdHJ1Y3QgdHRtX3BsYWNlbWVudCBob3BfcGxhY2VtZW50OwotCXN0cnVjdCB0dG1fcmVz
b3VyY2UgaG9wX21lbTsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlICpob3BfbWVtOwogCWludCByZXQ7
CiAKIAlob3BfcGxhY2VtZW50Lm51bV9wbGFjZW1lbnQgPSBob3BfcGxhY2VtZW50Lm51bV9idXN5
X3BsYWNlbWVudCA9IDE7CkBAIC04NzUsNyArODQ2LDcgQEAgc3RhdGljIGludCB0dG1fYm9fYm91
bmNlX3RlbXBfYnVmZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAkvKiBtb3ZlIHRvIHRoZSBib3VuY2UgZG9tYWluICovCi0JcmV0ID0g
dHRtX2JvX2hhbmRsZV9tb3ZlX21lbShibywgJmhvcF9tZW0sIGZhbHNlLCBjdHgsIE5VTEwpOwor
CXJldCA9IHR0bV9ib19oYW5kbGVfbW92ZV9tZW0oYm8sIGhvcF9tZW0sIGZhbHNlLCBjdHgsIE5V
TEwpOwogCWlmIChyZXQpIHsKIAkJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZob3BfbWVtKTsKIAkJ
cmV0dXJuIHJldDsKQEAgLTg4NywxNCArODU4LDEyIEBAIHN0YXRpYyBpbnQgdHRtX2JvX21vdmVf
YnVmZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQkgICAgICBzdHJ1Y3QgdHRt
X3BsYWNlbWVudCAqcGxhY2VtZW50LAogCQkJICAgICAgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
ICpjdHgpCiB7CisJc3RydWN0IHR0bV9yZXNvdXJjZSAqbWVtOwogCXN0cnVjdCB0dG1fcGxhY2Ug
aG9wOwotCXN0cnVjdCB0dG1fcmVzb3VyY2UgbWVtOwogCWludCByZXQ7CiAKIAlkbWFfcmVzdl9h
c3NlcnRfaGVsZChiby0+YmFzZS5yZXN2KTsKIAotCW1lbXNldCgmaG9wLCAwLCBzaXplb2YoaG9w
KSk7Ci0KIAkvKgogCSAqIERldGVybWluZSB3aGVyZSB0byBtb3ZlIHRoZSBidWZmZXIuCiAJICoK
QEAgLTkwOCw3ICs4NzcsNyBAQCBzdGF0aWMgaW50IHR0bV9ib19tb3ZlX2J1ZmZlcihzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiBib3VuY2U6
Ci0JcmV0ID0gdHRtX2JvX2hhbmRsZV9tb3ZlX21lbShibywgJm1lbSwgZmFsc2UsIGN0eCwgJmhv
cCk7CisJcmV0ID0gdHRtX2JvX2hhbmRsZV9tb3ZlX21lbShibywgbWVtLCBmYWxzZSwgY3R4LCAm
aG9wKTsKIAlpZiAocmV0ID09IC1FTVVMVElIT1ApIHsKIAkJcmV0ID0gdHRtX2JvX2JvdW5jZV90
ZW1wX2J1ZmZlcihibywgJm1lbSwgY3R4LCAmaG9wKTsKIAkJaWYgKHJldCkKQEAgLTEwMjcsOCAr
OTk2LDcgQEAgaW50IHR0bV9ib19pbml0X3Jlc2VydmVkKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2
LAogCWJvLT5iZGV2ID0gYmRldjsKIAliby0+dHlwZSA9IHR5cGU7CiAJYm8tPnBhZ2VfYWxpZ25t
ZW50ID0gcGFnZV9hbGlnbm1lbnQ7Ci0JYm8tPnJlc291cmNlID0gJmJvLT5fbWVtOwotCXR0bV9y
ZXNvdXJjZV9hbGxvYyhibywgJnN5c19tZW0sIGJvLT5yZXNvdXJjZSk7CisJdHRtX3Jlc291cmNl
X2FsbG9jKGJvLCAmc3lzX21lbSwgJmJvLT5yZXNvdXJjZSk7CiAJYm8tPm1vdmluZyA9IE5VTEw7
CiAJYm8tPnBpbl9jb3VudCA9IDA7CiAJYm8tPnNnID0gc2c7CkBAIC0xMTY4LDcgKzExMzYsNyBA
QCBpbnQgdHRtX2JvX3N3YXBvdXQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywgc3RydWN0
IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgsCiAJICovCiAJaWYgKGJvLT5yZXNvdXJjZS0+bWVtX3R5
cGUgIT0gVFRNX1BMX1NZU1RFTSkgewogCQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0g
eyBmYWxzZSwgZmFsc2UgfTsKLQkJc3RydWN0IHR0bV9yZXNvdXJjZSBldmljdF9tZW07CisJCXN0
cnVjdCB0dG1fcmVzb3VyY2UgKmV2aWN0X21lbTsKIAkJc3RydWN0IHR0bV9wbGFjZSBwbGFjZSwg
aG9wOwogCiAJCW1lbXNldCgmcGxhY2UsIDAsIHNpemVvZihwbGFjZSkpOwpAQCAtMTE4MCw3ICsx
MTQ4LDcgQEAgaW50IHR0bV9ib19zd2Fwb3V0KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8s
IHN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCAqY3R4LAogCQlpZiAodW5saWtlbHkocmV0KSkKIAkJ
CWdvdG8gb3V0OwogCi0JCXJldCA9IHR0bV9ib19oYW5kbGVfbW92ZV9tZW0oYm8sICZldmljdF9t
ZW0sIHRydWUsICZjdHgsICZob3ApOworCQlyZXQgPSB0dG1fYm9faGFuZGxlX21vdmVfbWVtKGJv
LCBldmljdF9tZW0sIHRydWUsICZjdHgsICZob3ApOwogCQlpZiAodW5saWtlbHkocmV0ICE9IDAp
KSB7CiAJCQlXQVJOKHJldCA9PSAtRU1VTFRJSE9QLCAiVW5leHBlY3RlZCBtdWx0aWhvcCBpbiBz
d2FwdXQgLSBsaWtlbHkgZHJpdmVyIGJ1Zy5cbiIpOwogCQkJZ290byBvdXQ7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9ib191dGlsLmMKaW5kZXggYWVkZjAyYTMxYzcwLi5lNDE3Njc3Yzc5MWYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vdHRtL3R0bV9ib191dGlsLmMKQEAgLTE3NiwxNiArMTc2LDE3IEBAIGludCB0dG1fYm9fbW92
ZV9tZW1jcHkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJICAgICAgIHN0cnVjdCB0
dG1fb3BlcmF0aW9uX2N0eCAqY3R4LAogCQkgICAgICAgc3RydWN0IHR0bV9yZXNvdXJjZSAqbmV3
X21lbSkKIHsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlICpvbGRfbWVtID0gYm8tPnJlc291cmNlOwog
CXN0cnVjdCB0dG1fZGV2aWNlICpiZGV2ID0gYm8tPmJkZXY7Ci0Jc3RydWN0IHR0bV9yZXNvdXJj
ZV9tYW5hZ2VyICptYW4gPSB0dG1fbWFuYWdlcl90eXBlKGJkZXYsIG5ld19tZW0tPm1lbV90eXBl
KTsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbjsKIAlzdHJ1Y3QgdHRtX3R0ICp0
dG0gPSBiby0+dHRtOwotCXN0cnVjdCB0dG1fcmVzb3VyY2UgKm9sZF9tZW0gPSBiby0+cmVzb3Vy
Y2U7Ci0Jc3RydWN0IHR0bV9yZXNvdXJjZSBvbGRfY29weSA9ICpvbGRfbWVtOwogCXZvaWQgKm9s
ZF9pb21hcDsKIAl2b2lkICpuZXdfaW9tYXA7CiAJaW50IHJldDsKIAl1bnNpZ25lZCBsb25nIGk7
CiAKKwltYW4gPSB0dG1fbWFuYWdlcl90eXBlKGJkZXYsIG5ld19tZW0tPm1lbV90eXBlKTsKKwog
CXJldCA9IHR0bV9ib193YWl0X2N0eChibywgY3R4KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0
OwpAQCAtMjAxLDcgKzIwMiw3IEBAIGludCB0dG1fYm9fbW92ZV9tZW1jcHkoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibywKIAkgKiBTaW5nbGUgVFRNIG1vdmUuIE5PUC4KIAkgKi8KIAlpZiAo
b2xkX2lvbWFwID09IE5VTEwgJiYgbmV3X2lvbWFwID09IE5VTEwpCi0JCWdvdG8gb3V0MjsKKwkJ
Z290byBvdXQxOwogCiAJLyoKIAkgKiBEb24ndCBtb3ZlIG5vbmV4aXN0ZW50IGRhdGEuIENsZWFy
IGRlc3RpbmF0aW9uIGluc3RlYWQuCkBAIC0yMTAsNyArMjExLDcgQEAgaW50IHR0bV9ib19tb3Zl
X21lbWNweShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCSAgICAodHRtID09IE5VTEwg
fHwgKCF0dG1fdHRfaXNfcG9wdWxhdGVkKHR0bSkgJiYKIAkJCSAgICAgISh0dG0tPnBhZ2VfZmxh
Z3MgJiBUVE1fUEFHRV9GTEFHX1NXQVBQRUQpKSkpIHsKIAkJbWVtc2V0X2lvKG5ld19pb21hcCwg
MCwgbmV3X21lbS0+bnVtX3BhZ2VzKlBBR0VfU0laRSk7Ci0JCWdvdG8gb3V0MjsKKwkJZ290byBv
dXQxOwogCX0KIAogCS8qCkBAIC0yMzUsMjcgKzIzNiwyNSBAQCBpbnQgdHRtX2JvX21vdmVfbWVt
Y3B5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQlyZXQgPSB0dG1fY29weV9pb19w
YWdlKG5ld19pb21hcCwgb2xkX2lvbWFwLCBpKTsKIAkJfQogCQlpZiAocmV0KQotCQkJZ290byBv
dXQxOworCQkJYnJlYWs7CiAJfQogCW1iKCk7Ci1vdXQyOgotCW9sZF9jb3B5ID0gKm9sZF9tZW07
CitvdXQxOgorCXR0bV9yZXNvdXJjZV9pb3VubWFwKGJkZXYsIG5ld19tZW0sIG5ld19pb21hcCk7
CitvdXQ6CisJdHRtX3Jlc291cmNlX2lvdW5tYXAoYmRldiwgb2xkX21lbSwgb2xkX2lvbWFwKTsK
IAorCWlmIChyZXQpIHsKKwkJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZuZXdfbWVtKTsKKwkJcmV0
dXJuIHJldDsKKwl9CisKKwl0dG1fcmVzb3VyY2VfZnJlZShibywgJmJvLT5yZXNvdXJjZSk7CiAJ
dHRtX2JvX2Fzc2lnbl9tZW0oYm8sIG5ld19tZW0pOwogCiAJaWYgKCFtYW4tPnVzZV90dCkKIAkJ
dHRtX2JvX3R0X2Rlc3Ryb3koYm8pOwogCi1vdXQxOgotCXR0bV9yZXNvdXJjZV9pb3VubWFwKGJk
ZXYsIG9sZF9tZW0sIG5ld19pb21hcCk7Ci1vdXQ6Ci0JdHRtX3Jlc291cmNlX2lvdW5tYXAoYmRl
diwgJm9sZF9jb3B5LCBvbGRfaW9tYXApOwotCi0JLyoKLQkgKiBPbiBlcnJvciwga2VlcCB0aGUg
bW0gbm9kZSEKLQkgKi8KLQlpZiAoIXJldCkKLQkJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZvbGRf
Y29weSk7CiAJcmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0wodHRtX2JvX21vdmVfbWVtY3B5
KTsKQEAgLTU2Niw3ICs1NjUsNyBAQCBzdGF0aWMgaW50IHR0bV9ib193YWl0X2ZyZWVfbm9kZShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCiAJaWYgKCFkc3RfdXNlX3R0KQogCQl0dG1f
Ym9fdHRfZGVzdHJveShibyk7Ci0JdHRtX3Jlc291cmNlX2ZyZWUoYm8sIGJvLT5yZXNvdXJjZSk7
CisJdHRtX3Jlc291cmNlX2ZyZWUoYm8sICZiby0+cmVzb3VyY2UpOwogCXJldHVybiAwOwogfQog
CkBAIC02MjksNyArNjI4LDcgQEAgc3RhdGljIHZvaWQgdHRtX2JvX21vdmVfcGlwZWxpbmVfZXZp
Y3Qoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAl9CiAJc3Bpbl91bmxvY2soJmZyb20t
Pm1vdmVfbG9jayk7CiAKLQl0dG1fcmVzb3VyY2VfZnJlZShibywgYm8tPnJlc291cmNlKTsKKwl0
dG1fcmVzb3VyY2VfZnJlZShibywgJmJvLT5yZXNvdXJjZSk7CiAKIAlkbWFfZmVuY2VfcHV0KGJv
LT5tb3ZpbmcpOwogCWJvLT5tb3ZpbmcgPSBkbWFfZmVuY2VfZ2V0KGZlbmNlKTsKQEAgLTY3OCw3
ICs2NzcsNyBAQCBpbnQgdHRtX2JvX3BpcGVsaW5lX2d1dHRpbmcoc3RydWN0IHR0bV9idWZmZXJf
b2JqZWN0ICpibykKIAlpZiAocmV0KQogCQl0dG1fYm9fd2FpdChibywgZmFsc2UsIGZhbHNlKTsK
IAotCXR0bV9yZXNvdXJjZV9hbGxvYyhibywgJnN5c19tZW0sIGJvLT5yZXNvdXJjZSk7CisJdHRt
X3Jlc291cmNlX2FsbG9jKGJvLCAmc3lzX21lbSwgJmJvLT5yZXNvdXJjZSk7CiAJYm8tPnR0bSA9
IE5VTEw7CiAKIAlkbWFfcmVzdl91bmxvY2soJmdob3N0LT5iYXNlLl9yZXN2KTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Jlc291cmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0v
dHRtL3R0bV9yZXNvdXJjZS5jCmluZGV4IGNlYzJlNmZiMWM1Mi4uN2ViY2MzZTY4MThjIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9yZXNvdXJjZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS90dG0vdHRtX3Jlc291cmNlLmMKQEAgLTI3LDExICsyNywxNCBAQAogCiBpbnQgdHRt
X3Jlc291cmNlX2FsbG9jKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCSAgICAgICBj
b25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSwKLQkJICAgICAgIHN0cnVjdCB0dG1fcmVzb3Vy
Y2UgKnJlcykKKwkJICAgICAgIHN0cnVjdCB0dG1fcmVzb3VyY2UgKipyZXNfcHRyKQogewogCXN0
cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuID0KLQkJdHRtX21hbmFnZXJfdHlwZShiby0+
YmRldiwgcmVzLT5tZW1fdHlwZSk7CisJCXR0bV9tYW5hZ2VyX3R5cGUoYm8tPmJkZXYsIHBsYWNl
LT5tZW1fdHlwZSk7CisJc3RydWN0IHR0bV9yZXNvdXJjZSAqcmVzOworCWludCByOwogCisJcmVz
ID0ga21hbGxvYyhzaXplb2YoKnJlcyksIEdGUF9LRVJORUwpOwogCXJlcy0+bW1fbm9kZSA9IE5V
TEw7CiAJcmVzLT5zdGFydCA9IDA7CiAJcmVzLT5udW1fcGFnZXMgPSBQRk5fVVAoYm8tPmJhc2Uu
c2l6ZSk7CkBAIC00MSwxOCArNDQsMjcgQEAgaW50IHR0bV9yZXNvdXJjZV9hbGxvYyhzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCXJlcy0+YnVzLm9mZnNldCA9IDA7CiAJcmVzLT5idXMu
aXNfaW9tZW0gPSBmYWxzZTsKIAlyZXMtPmJ1cy5jYWNoaW5nID0gdHRtX2NhY2hlZDsKKwlyID0g
bWFuLT5mdW5jLT5hbGxvYyhtYW4sIGJvLCBwbGFjZSwgcmVzKTsKKwlpZiAocikgeworCQlrZnJl
ZShyZXMpOworCQlyZXR1cm4gcjsKKwl9CiAKLQlyZXR1cm4gbWFuLT5mdW5jLT5hbGxvYyhtYW4s
IGJvLCBwbGFjZSwgcmVzKTsKKwkqcmVzX3B0ciA9IHJlczsKKwlyZXR1cm4gMDsKIH0KIAotdm9p
ZCB0dG1fcmVzb3VyY2VfZnJlZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBzdHJ1Y3Qg
dHRtX3Jlc291cmNlICpyZXMpCit2b2lkIHR0bV9yZXNvdXJjZV9mcmVlKHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sIHN0cnVjdCB0dG1fcmVzb3VyY2UgKipyZXMpCiB7Ci0Jc3RydWN0IHR0
bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4gPQotCQl0dG1fbWFuYWdlcl90eXBlKGJvLT5iZGV2LCBy
ZXMtPm1lbV90eXBlKTsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbjsKIAotCW1h
bi0+ZnVuYy0+ZnJlZShtYW4sIHJlcyk7Ci0JcmVzLT5tbV9ub2RlID0gTlVMTDsKLQlyZXMtPm1l
bV90eXBlID0gVFRNX1BMX1NZU1RFTTsKKwlpZiAoISpyZXMpCisJCXJldHVybjsKKworCW1hbiA9
IHR0bV9tYW5hZ2VyX3R5cGUoYm8tPmJkZXYsICgqcmVzKS0+bWVtX3R5cGUpOworCW1hbi0+ZnVu
Yy0+ZnJlZShtYW4sICpyZXMpOworCWtmcmVlKCpyZXMpOworCSpyZXMgPSBOVUxMOwogfQogRVhQ
T1JUX1NZTUJPTCh0dG1fcmVzb3VyY2VfZnJlZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngv
dm13Z2Z4X3R0bV9idWZmZXIuYwppbmRleCBiYjFkNDUzZjdjYTYuLjRjMzQyMTZhOWFiOCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYwpAQCAtNzQ2LDcgKzc0
Niw3IEBAIHN0YXRpYyBpbnQgdm13X21vdmUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
IAkJCWdvdG8gZmFpbDsKIAogCQl2bXdfdHRtX3VuYmluZChiby0+YmRldiwgYm8tPnR0bSk7Ci0J
CXR0bV9yZXNvdXJjZV9mcmVlKGJvLCBiby0+cmVzb3VyY2UpOworCQl0dG1fcmVzb3VyY2VfZnJl
ZShibywgJmJvLT5yZXNvdXJjZSk7CiAJCXR0bV9ib19hc3NpZ25fbWVtKGJvLCBuZXdfbWVtKTsK
IAkJcmV0dXJuIDA7CiAJfSBlbHNlIHsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1f
Ym9fYXBpLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCmluZGV4IDE4NzZhM2Q2ZGY3
My4uZDhiYjQ2MjI4Y2M3IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5o
CisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmgKQEAgLTEzNyw3ICsxMzcsNiBAQCBz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgewogCSAqLwogCiAJc3RydWN0IHR0bV9yZXNvdXJjZSAq
cmVzb3VyY2U7Ci0Jc3RydWN0IHR0bV9yZXNvdXJjZSBfbWVtOwogCXN0cnVjdCB0dG1fdHQgKnR0
bTsKIAlib29sIGRlbGV0ZWQ7CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9f
ZHJpdmVyLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCmluZGV4IDFhOWJhMGIx
MzYyMi4uZWFkMGVmNzEzNmM4IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2Ry
aXZlci5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKQEAgLTk2LDcgKzk2
LDcgQEAgc3RydWN0IHR0bV9scnVfYnVsa19tb3ZlIHsKICAqLwogaW50IHR0bV9ib19tZW1fc3Bh
Y2Uoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJICAgICBzdHJ1Y3QgdHRtX3BsYWNl
bWVudCAqcGxhY2VtZW50LAotCQkgICAgIHN0cnVjdCB0dG1fcmVzb3VyY2UgKm1lbSwKKwkJICAg
ICBzdHJ1Y3QgdHRtX3Jlc291cmNlICoqbWVtLAogCQkgICAgIHN0cnVjdCB0dG1fb3BlcmF0aW9u
X2N0eCAqY3R4KTsKIAogLyoqCkBAIC0xODgsOCArMTg4LDggQEAgdHRtX2JvX21vdmVfdG9fbHJ1
X3RhaWxfdW5sb2NrZWQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIHN0YXRpYyBpbmxp
bmUgdm9pZCB0dG1fYm9fYXNzaWduX21lbShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAog
CQkJCSAgICAgc3RydWN0IHR0bV9yZXNvdXJjZSAqbmV3X21lbSkKIHsKLQliby0+X21lbSA9ICpu
ZXdfbWVtOwotCW5ld19tZW0tPm1tX25vZGUgPSBOVUxMOworCVdBUk5fT04oYm8tPnJlc291cmNl
KTsKKwliby0+cmVzb3VyY2UgPSBuZXdfbWVtOwogfQogCiAvKioKQEAgLTIwMiw5ICsyMDIsNyBA
QCBzdGF0aWMgaW5saW5lIHZvaWQgdHRtX2JvX2Fzc2lnbl9tZW0oc3RydWN0IHR0bV9idWZmZXJf
b2JqZWN0ICpibywKIHN0YXRpYyBpbmxpbmUgdm9pZCB0dG1fYm9fbW92ZV9udWxsKHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQkJICAgIHN0cnVjdCB0dG1fcmVzb3VyY2UgKm5ld19t
ZW0pCiB7Ci0Jc3RydWN0IHR0bV9yZXNvdXJjZSAqb2xkX21lbSA9IGJvLT5yZXNvdXJjZTsKLQot
CVdBUk5fT04ob2xkX21lbS0+bW1fbm9kZSAhPSBOVUxMKTsKKwl0dG1fcmVzb3VyY2VfZnJlZShi
bywgJmJvLT5yZXNvdXJjZSk7CiAJdHRtX2JvX2Fzc2lnbl9tZW0oYm8sIG5ld19tZW0pOwogfQog
CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX3Jlc291cmNlLmggYi9pbmNsdWRlL2Ry
bS90dG0vdHRtX3Jlc291cmNlLmgKaW5kZXggODkwYjlkMzY5NTE5Li5jMTdjMWE1MjA3MGQgMTAw
NjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL3R0bS90dG1fcmVzb3VyY2UuaAorKysgYi9pbmNsdWRlL2Ry
bS90dG0vdHRtX3Jlc291cmNlLmgKQEAgLTIyNSw4ICsyMjUsOCBAQCB0dG1fcmVzb3VyY2VfbWFu
YWdlcl9jbGVhbnVwKHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuKQogCiBpbnQgdHRt
X3Jlc291cmNlX2FsbG9jKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCSAgICAgICBj
b25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSwKLQkJICAgICAgIHN0cnVjdCB0dG1fcmVzb3Vy
Y2UgKnJlcyk7Ci12b2lkIHR0bV9yZXNvdXJjZV9mcmVlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8sIHN0cnVjdCB0dG1fcmVzb3VyY2UgKnJlcyk7CisJCSAgICAgICBzdHJ1Y3QgdHRtX3Jl
c291cmNlICoqcmVzKTsKK3ZvaWQgdHRtX3Jlc291cmNlX2ZyZWUoc3RydWN0IHR0bV9idWZmZXJf
b2JqZWN0ICpibywgc3RydWN0IHR0bV9yZXNvdXJjZSAqKnJlcyk7CiAKIHZvaWQgdHRtX3Jlc291
cmNlX21hbmFnZXJfaW5pdChzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbiwKIAkJCSAg
ICAgICB1bnNpZ25lZCBsb25nIHBfc2l6ZSk7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
