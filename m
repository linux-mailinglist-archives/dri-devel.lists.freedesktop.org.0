Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C70C39B907
	for <lists+dri-devel@lfdr.de>; Sat, 24 Aug 2019 01:48:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 341526E04A;
	Fri, 23 Aug 2019 23:47:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x643.google.com (mail-pl1-x643.google.com
 [IPv6:2607:f8b0:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4FFD26E04A
 for <dri-devel@lists.freedesktop.org>; Fri, 23 Aug 2019 23:47:56 +0000 (UTC)
Received: by mail-pl1-x643.google.com with SMTP id c2so6436079plz.13
 for <dri-devel@lists.freedesktop.org>; Fri, 23 Aug 2019 16:47:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=8bGuZw+Xvqfus3X3QJCnkAVsni9ADJWHXyxrhLBcVV0=;
 b=qX0brMfHWxN4GkgzhF1Bto6Iv+k67Xa4DDq+rDsgfXt1CUZwFoikFa6wQbL5rI5EDJ
 4kIMBYqZBHCqoUn18FPzTQs19WiuuZ2Q+nssnD8WIV43f3TsP3DSgyqWlYg5srFyFSC+
 iaThlsTJ8MDeVrBGPpciBMPhVkaeSoADeUxhhLr6LEt6GxvhE8pSMRECXkv1y/kx02Ez
 tF0W4eBBbxnYIakc0ITGhrfqZwBSs5Y8/8NpUfYbzrU6GDazpvwn9yRAjhwnQrpCIcPW
 g2M5MLRJ8UCXs134/6OoM+54jUCR2Fdx/iL2y7emRphmlI+EElkyPgNLaLPui0A4Jckg
 5paA==
X-Gm-Message-State: APjAAAXOuTBejoxwQS/i6J9RH6P795IypAd+seLfp7IGDmo4lqSCs3s9
 RzBoVndTS0489HjvKt1mxl7fWg==
X-Google-Smtp-Source: APXvYqwY97jDVw0hX9Y2+1khKGy9N2OlznKH8pOXWU0nQPBADq4Am1ggi0qJPZFOYtvbwkZrtDItow==
X-Received: by 2002:a17:902:b406:: with SMTP id
 x6mr7292522plr.114.1566604075757; 
 Fri, 23 Aug 2019 16:47:55 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 a5sm3185097pjs.31.2019.08.23.16.47.54
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 23 Aug 2019 16:47:55 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v8 2/5] dma-buf: heaps: Add heap helpers
Date: Fri, 23 Aug 2019 23:47:44 +0000
Message-Id: <20190823234747.106510-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190823234747.106510-1-john.stultz@linaro.org>
References: <20190823234747.106510-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=8bGuZw+Xvqfus3X3QJCnkAVsni9ADJWHXyxrhLBcVV0=;
 b=gSMsB24n9kmc3UmgvTzKDXwCHjFEvl1lEx/4AmAQiYur6IAHnpnT2a0KiZ66jMQqbE
 W6aOa1/dThMk20MwyeRKxqJAz15lMqN3RTkQT07NAzZ5YRsol84tka6VpHjCETzYl0A3
 Im6tjaOjPhu0un1PI5bFBL/GP2n1sgz8lB82/JqhKrhujzuS2LYQkLyqX5nJqHnT0+Yb
 4MfO6h7T5XoOYPPpa9f9QOj465wwKZZSwFwbl5xkq02WFwDZhV3E3v2CfzIm6dJgFHDN
 9aZgA6TvW1Ve+wgH21A0JwAPTi04sRnhlDRgGdiLTe7zTlgK3nXCiDSiUhfzXB2Nvjpo
 NNtQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGdlbmVyaWMgaGVscGVyIGRtYWJ1ZiBvcHMgZm9yIGRtYSBoZWFwcywgc28gd2UgY2FuIHJl
ZHVjZQp0aGUgYW1vdW50IG9mIGR1cGxpY2F0aXZlIGNvZGUgZm9yIHRoZSBleHBvcnRlZCBkbWFi
dWZzLgoKVGhpcyBjb2RlIGlzIGFuIGV2b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVt
ZW50YXRpb24sIHNvCnRoYW5rcyB0byBpdHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50
ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBaYXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwg
YW5kIG90aGVycyEKCkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQg
U2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29k
ZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsgUGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNj
OiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5l
Zm9ydCA8VmluY2VudC5Eb25uZWZvcnRAYXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0
by5QYXVsQGFybS5jb20+CkNjOiBBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBDaHJp
c3RvcGggSGVsbHdpZyA8aGNoQGluZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8gRmVuZyA8ZmVuZ2NA
Z29vZ2xlLmNvbT4KQ2M6IEFsaXN0YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5AZ29vZ2xlLmNvbT4K
Q2M6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogZHJpLWRldmVsQGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpSZXZpZXdlZC1ieTogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmph
bWluLmdhaWduYXJkQGxpbmFyby5vcmc+ClNpZ25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2hu
LnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogUmVtb3ZlZCBjYWNoZSBtYW5hZ2VtZW50IHBl
cmZvcm1hbmNlIGhhY2sgdGhhdCBJIGhhZAogIGFjY2lkZW50YWxseSBmb2xkZWQgaW4uCiogUmVt
b3ZlZCBzdGF0cyBjb2RlIHRoYXQgd2FzIGluIGhlbHBlcnMKKiBMb3RzIG9mIGNoZWNrcGF0Y2gg
Y2xlYW51cHMKdjM6CiogVW5pbmxpbmUgSU5JVF9IRUFQX0hFTFBFUl9CVUZGRVIgKHN1Z2dlc3Rl
ZCBieSBDaHJpc3RvcGgpCiogU3dpdGNoIHRvIFdBUk4gb24gYnVmZmVyIGRlc3Ryb3kgZmFpbHVy
ZSAoc3VnZ2VzdGVkIGJ5IEJyaWFuKQoqIGJ1ZmZlci0+a21hcF9jbnQgZGVjcmVtZW50aW5nIGNs
ZWFudXAgKHN1Z2dlc3RlZCBieSBDaHJpc3RvcGgpCiogRXh0cmEgYnVmZmVyLT52YWRkciBjaGVj
a2luZyBpbiBkbWFfaGVhcF9kbWFfYnVmX2ttYXAKICAoc3VnZ2VzdGVkIGJ5IEJyaWFuKQoqIFN3
aXRjaCB0b19oZWxwZXJfYnVmZmVyIGZyb20gbWFjcm8gdG8gaW5saW5lIGZ1bmN0aW9uCiAgKHN1
Z2dlc3RlZCBieSBCZW5qYW1pbikKKiBSZW5hbWUga21hcC0+dm1hcCAoZm9sZGVkIGluIGZyb20g
QW5kcmV3KQoqIFVzZSB2bWFwIGZvciB2bWFwcGluZyAtIG5vdCBiZWdpbl9jcHVfYWNjZXNzIChm
b2xkZWQgaW4gZnJvbQogIEFuZHJldykKKiBEcm9wIGttYXAgZm9yIG5vdywgYXMgaXRzIG9wdGlv
bmFsIChmb2xkZWQgaW4gZnJvbSBBbmRyZXcpCiogRm9sZCBkbWFfaGVhcF9tYXBfdXNlciBpbnRv
IHRoZSBzaW5nbGUgY2FsbGVyIChmb2xlZCBpbiBmcm9tCiAgQW5kcmV3KQoqIEZvbGRlZCBpbiBw
YXRjaCBmcm9tIEFuZHJldyB0byB0cmFjayBwYWdlIGxpc3QgcGVyIGhlYXAgbm90CiAgc2dsaXN0
LCB3aGljaCBzaW1wbGlmaWVzIHRoZSB0cmFja2luZyBsb2dpYwp2NDoKKiBNb3ZlZCBkbWEtaGVh
cC5oIGNoYW5nZSBvdXQgdG8gcHJldmlvdXMgcGF0Y2gKdjY6CiogTWlub3IgY2xlYW51cHMgYW5k
IHR5cG8gZml4ZXMgc3VnZ2VzdGVkIGJ5IEJyaWFuCnY3OgoqIFJlbW92ZWQgc3RyYXkgOwoqIE1h
a2UgaW5pdF9oZWFwX2hlbHBlcl9idWZmZXIgbG93ZXJjYXNlLCBhcyBzdWdnZXN0ZWQgYnkgQ2hy
aXN0b3BoCiogQWRkIGRtYWJ1ZiBleHBvcnQgaGVscGVyIHRvIHJlZHVjZSBib2lsZXJwbGF0ZSBj
b2RlCnY4OgoqIFJlbW92ZSB1bnVzZWQgcHJpdmF0ZV9mbGFncyB2YWx1ZQoqIENvbmRlbnNlIGRt
YV9oZWFwX2J1ZmZlciBhbmQgaGVhcF9oZWxwZXJfYnVmZmVyIChzdWdnZXN0ZWQgYnkKICBDaHJp
c3RvcGgpCiogRml4IGluZGVudGF0aW9uIGJ5IHVzaW5nIHNob3J0ZXIgYXJndW1lbnQgbmFtZXMg
KHN1Z2dlc3RlZCBieQogIENocmlzdG9waCkKKiBBZGQgZmx1c2hfa2VybmVsX3ZtYXBfcmFuZ2Uv
aW52YWxpZGF0ZV9rZXJuZWxfdm1hcF9yYW5nZSBjYWxscwogIChzdWdnZXN0ZWQgYnkgQ2hyaXN0
b3BoKQoqIENoZWNrcGF0Y2ggd2hpdGVzcGFjZSBmaXh1cHMKLS0tCiBkcml2ZXJzL2RtYS1idWYv
TWFrZWZpbGUgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2Vm
aWxlICAgICAgIHwgICAyICsKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMuYyB8
IDI2OSArKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9o
ZWFwLWhlbHBlcnMuaCB8ICA1NSArKysrKysKIDQgZmlsZXMgY2hhbmdlZCwgMzI3IGluc2VydGlv
bnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmgK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvTWFrZWZpbGUgYi9kcml2ZXJzL2RtYS1idWYv
TWFrZWZpbGUKaW5kZXggMWNiM2RkMTA0ODI1Li5lM2UzZGNhMjllNDYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2RtYS1idWYvTWFrZWZpbGUKQEAg
LTEsNiArMSw3IEBACiAjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKIG9i
ai15IDo9IGRtYS1idWYubyBkbWEtZmVuY2UubyBkbWEtZmVuY2UtYXJyYXkubyBkbWEtZmVuY2Ut
Y2hhaW4ubyBcCiAJIHJlc2VydmF0aW9uLm8gc2Vxbm8tZmVuY2Uubworb2JqLSQoQ09ORklHX0RN
QUJVRl9IRUFQUykJKz0gaGVhcHMvCiBvYmotJChDT05GSUdfRE1BQlVGX0hFQVBTKQkrPSBkbWEt
aGVhcC5vCiBvYmotJChDT05GSUdfU1lOQ19GSUxFKQkJKz0gc3luY19maWxlLm8KIG9iai0kKENP
TkZJR19TV19TWU5DKQkJKz0gc3dfc3luYy5vIHN5bmNfZGVidWcubwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2Vm
aWxlCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZGU0OTg5ODExMmRi
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCkBAIC0w
LDAgKzEsMiBAQAorIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorb2JqLXkJCQkJ
CSs9IGhlYXAtaGVscGVycy5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVh
cC1oZWxwZXJzLmMgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMKbmV3IGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iMjUwMGQ4MzFmZTMKLS0tIC9kZXYv
bnVsbAorKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmMKQEAgLTAsMCAr
MSwyNjkgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisjaW5jbHVkZSA8
bGludXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgorI2luY2x1ZGUgPGxp
bnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2hpZ2htZW0uaD4KKyNpbmNsdWRlIDxsaW51eC9p
ZHIuaD4KKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgor
I2luY2x1ZGUgPGxpbnV4L3VhY2Nlc3MuaD4KKyNpbmNsdWRlIDx1YXBpL2xpbnV4L2RtYS1oZWFw
Lmg+CisjaW5jbHVkZSAiaGVhcC1oZWxwZXJzLmgiCisKK3ZvaWQgaW5pdF9oZWFwX2hlbHBlcl9i
dWZmZXIoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyLAorCQkJICAgICB2b2lkICgq
ZnJlZSkoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqKSkKK3sKKwlidWZmZXItPnByaXZfdmly
dCA9IE5VTEw7CisJbXV0ZXhfaW5pdCgmYnVmZmVyLT5sb2NrKTsKKwlidWZmZXItPnZtYXBfY250
ID0gMDsKKwlidWZmZXItPnZhZGRyID0gTlVMTDsKKwlidWZmZXItPnBhZ2Vjb3VudCA9IDA7CisJ
YnVmZmVyLT5wYWdlcyA9IE5VTEw7CisJSU5JVF9MSVNUX0hFQUQoJmJ1ZmZlci0+YXR0YWNobWVu
dHMpOworCWJ1ZmZlci0+ZnJlZSA9IGZyZWU7Cit9CisKK3N0cnVjdCBkbWFfYnVmICpoZWFwX2hl
bHBlcl9leHBvcnRfZG1hYnVmKHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciwKKwkJ
CQkJICBpbnQgZmRfZmxhZ3MpCit7CisJREVGSU5FX0RNQV9CVUZfRVhQT1JUX0lORk8oZXhwX2lu
Zm8pOworCisJZXhwX2luZm8ub3BzID0gJmhlYXBfaGVscGVyX29wczsKKwlleHBfaW5mby5zaXpl
ID0gYnVmZmVyLT5zaXplOworCWV4cF9pbmZvLmZsYWdzID0gZmRfZmxhZ3M7CisJZXhwX2luZm8u
cHJpdiA9IGJ1ZmZlcjsKKworCXJldHVybiBkbWFfYnVmX2V4cG9ydCgmZXhwX2luZm8pOworfQor
CitzdGF0aWMgdm9pZCAqZG1hX2hlYXBfbWFwX2tlcm5lbChzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVm
ZmVyICpidWZmZXIpCit7CisJdm9pZCAqdmFkZHI7CisKKwl2YWRkciA9IHZtYXAoYnVmZmVyLT5w
YWdlcywgYnVmZmVyLT5wYWdlY291bnQsIFZNX01BUCwgUEFHRV9LRVJORUwpOworCWlmICghdmFk
ZHIpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJcmV0dXJuIHZhZGRyOworfQorCitz
dGF0aWMgdm9pZCBkbWFfaGVhcF9idWZmZXJfZGVzdHJveShzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVm
ZmVyICpidWZmZXIpCit7CisJaWYgKGJ1ZmZlci0+dm1hcF9jbnQgPiAwKSB7CisJCVdBUk4oIiVz
OiBidWZmZXIgc3RpbGwgbWFwcGVkIGluIHRoZSBrZXJuZWxcbiIsIF9fZnVuY19fKTsKKwkJdnVu
bWFwKGJ1ZmZlci0+dmFkZHIpOworCX0KKworCWJ1ZmZlci0+ZnJlZShidWZmZXIpOworfQorCitz
dGF0aWMgdm9pZCAqZG1hX2hlYXBfYnVmZmVyX3ZtYXBfZ2V0KHN0cnVjdCBoZWFwX2hlbHBlcl9i
dWZmZXIgKmJ1ZmZlcikKK3sKKwl2b2lkICp2YWRkcjsKKworCWlmIChidWZmZXItPnZtYXBfY250
KSB7CisJCWJ1ZmZlci0+dm1hcF9jbnQrKzsKKwkJcmV0dXJuIGJ1ZmZlci0+dmFkZHI7CisJfQor
CXZhZGRyID0gZG1hX2hlYXBfbWFwX2tlcm5lbChidWZmZXIpOworCWlmIChXQVJOX09OQ0UoIXZh
ZGRyLAorCQkgICAgICAiaGVhcC0+b3BzLT5tYXBfa2VybmVsIHNob3VsZCByZXR1cm4gRVJSX1BU
UiBvbiBlcnJvciIpKQorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKKwlpZiAoSVNfRVJSKHZh
ZGRyKSkKKwkJcmV0dXJuIHZhZGRyOworCWJ1ZmZlci0+dmFkZHIgPSB2YWRkcjsKKwlidWZmZXIt
PnZtYXBfY250Kys7CisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9i
dWZmZXJfdm1hcF9wdXQoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCWlm
ICghLS1idWZmZXItPnZtYXBfY250KSB7CisJCXZ1bm1hcChidWZmZXItPnZhZGRyKTsKKwkJYnVm
ZmVyLT52YWRkciA9IE5VTEw7CisJfQorfQorCitzdHJ1Y3QgZG1hX2hlYXBzX2F0dGFjaG1lbnQg
eworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwlzdHJ1Y3Qgc2dfdGFibGUgdGFibGU7CisJc3RydWN0
IGxpc3RfaGVhZCBsaXN0OworfTsKKworc3RhdGljIGludCBkbWFfaGVhcF9hdHRhY2goc3RydWN0
IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCSAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFj
aG1lbnQpCit7CisJc3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphOworCXN0cnVjdCBoZWFw
X2hlbHBlcl9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlpbnQgcmV0OworCisJYSA9
IGt6YWxsb2Moc2l6ZW9mKCphKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFhKQorCQlyZXR1cm4gLUVO
T01FTTsKKworCXJldCA9IHNnX2FsbG9jX3RhYmxlX2Zyb21fcGFnZXMoJmEtPnRhYmxlLCBidWZm
ZXItPnBhZ2VzLAorCQkJCQlidWZmZXItPnBhZ2Vjb3VudCwgMCwKKwkJCQkJYnVmZmVyLT5wYWdl
Y291bnQgPDwgUEFHRV9TSElGVCwKKwkJCQkJR0ZQX0tFUk5FTCk7CisJaWYgKHJldCkgeworCQlr
ZnJlZShhKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlhLT5kZXYgPSBhdHRhY2htZW50LT5kZXY7
CisJSU5JVF9MSVNUX0hFQUQoJmEtPmxpc3QpOworCisJYXR0YWNobWVudC0+cHJpdiA9IGE7CisK
KwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOworCWxpc3RfYWRkKCZhLT5saXN0LCAmYnVmZmVy
LT5hdHRhY2htZW50cyk7CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFwX2RldGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1h
YnVmLAorCQkJICAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7CisJ
c3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsKKwlzdHJ1
Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9s
b2NrKCZidWZmZXItPmxvY2spOworCWxpc3RfZGVsKCZhLT5saXN0KTsKKwltdXRleF91bmxvY2so
JmJ1ZmZlci0+bG9jayk7CisKKwlzZ19mcmVlX3RhYmxlKCZhLT50YWJsZSk7CisJa2ZyZWUoYSk7
Cit9CisKK3N0YXRpYworc3RydWN0IHNnX3RhYmxlICpkbWFfaGVhcF9tYXBfZG1hX2J1ZihzdHJ1
Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50LAorCQkJCSAgICAgIGVudW0gZG1hX2Rh
dGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBzX2F0dGFjaG1lbnQg
KmEgPSBhdHRhY2htZW50LT5wcml2OworCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7CisKKwl0YWJs
ZSA9ICZhLT50YWJsZTsKKworCWlmICghZG1hX21hcF9zZyhhdHRhY2htZW50LT5kZXYsIHRhYmxl
LT5zZ2wsIHRhYmxlLT5uZW50cywKKwkJCWRpcmVjdGlvbikpCisJCXRhYmxlID0gRVJSX1BUUigt
RU5PTUVNKTsKKwlyZXR1cm4gdGFibGU7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFwX3VubWFw
X2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCwKKwkJCQkgICBz
dHJ1Y3Qgc2dfdGFibGUgKnRhYmxlLAorCQkJCSAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRp
cmVjdGlvbikKK3sKKwlkbWFfdW5tYXBfc2coYXR0YWNobWVudC0+ZGV2LCB0YWJsZS0+c2dsLCB0
YWJsZS0+bmVudHMsIGRpcmVjdGlvbik7Cit9CisKK3N0YXRpYyB2bV9mYXVsdF90IGRtYV9oZWFw
X3ZtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQoreworCXN0cnVjdCB2bV9hcmVhX3N0cnVj
dCAqdm1hID0gdm1mLT52bWE7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0g
dm1hLT52bV9wcml2YXRlX2RhdGE7CisKKwl2bWYtPnBhZ2UgPSBidWZmZXItPnBhZ2VzW3ZtZi0+
cGdvZmZdOworCWdldF9wYWdlKHZtZi0+cGFnZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBkbWFfaGVhcF92bV9vcHMgPSB7CisJ
LmZhdWx0ID0gZG1hX2hlYXBfdm1fZmF1bHQsCit9OworCitzdGF0aWMgaW50IGRtYV9oZWFwX21t
YXAoc3RydWN0IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCit7
CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJ
aWYgKCh2bWEtPnZtX2ZsYWdzICYgKFZNX1NIQVJFRCB8IFZNX01BWVNIQVJFKSkgPT0gMCkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwl2bWEtPnZtX29wcyA9ICZkbWFfaGVhcF92bV9vcHM7CisJdm1h
LT52bV9wcml2YXRlX2RhdGEgPSBidWZmZXI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZv
aWQgZG1hX2hlYXBfZG1hX2J1Zl9yZWxlYXNlKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCit7CisJ
c3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJZG1h
X2hlYXBfYnVmZmVyX2Rlc3Ryb3koYnVmZmVyKTsKK30KKworc3RhdGljIGludCBkbWFfaGVhcF9k
bWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCQkJICAg
ICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJc3RydWN0IGhlYXBfaGVs
cGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBkbWFfaGVhcHNfYXR0
YWNobWVudCAqYTsKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+bG9jayk7
CisKKwlpZiAoYnVmZmVyLT52bWFwX2NudCkKKwkJaW52YWxpZGF0ZV9rZXJuZWxfdm1hcF9yYW5n
ZShidWZmZXItPnZhZGRyLCBidWZmZXItPnNpemUpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShh
LCAmYnVmZmVyLT5hdHRhY2htZW50cywgbGlzdCkgeworCQlkbWFfc3luY19zZ19mb3JfY3B1KGEt
PmRldiwgYS0+dGFibGUuc2dsLCBhLT50YWJsZS5uZW50cywKKwkJCQkgICAgZGlyZWN0aW9uKTsK
Kwl9CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIGludCBkbWFfaGVhcF9kbWFfYnVmX2VuZF9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVm
ICpkbWFidWYsCisJCQkJCSAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sK
KwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3Ry
dWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2Nr
KTsKKworCWlmIChidWZmZXItPnZtYXBfY250KQorCQlmbHVzaF9rZXJuZWxfdm1hcF9yYW5nZShi
dWZmZXItPnZhZGRyLCBidWZmZXItPnNpemUpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShhLCAm
YnVmZmVyLT5hdHRhY2htZW50cywgbGlzdCkgeworCQlkbWFfc3luY19zZ19mb3JfZGV2aWNlKGEt
PmRldiwgYS0+dGFibGUuc2dsLCBhLT50YWJsZS5uZW50cywKKwkJCQkgICAgICAgZGlyZWN0aW9u
KTsKKwl9CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyB2b2lkICpkbWFfaGVhcF9kbWFfYnVmX3ZtYXAoc3RydWN0IGRtYV9idWYgKmRtYWJ1
ZikKK3sKKwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7
CisJdm9pZCAqdmFkZHI7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOworCXZhZGRyID0g
ZG1hX2hlYXBfYnVmZmVyX3ZtYXBfZ2V0KGJ1ZmZlcik7CisJbXV0ZXhfdW5sb2NrKCZidWZmZXIt
PmxvY2spOworCisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9kbWFf
YnVmX3Z1bm1hcChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCB2b2lkICp2YWRkcikKK3sKKwlzdHJ1
Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9s
b2NrKCZidWZmZXItPmxvY2spOworCWRtYV9oZWFwX2J1ZmZlcl92bWFwX3B1dChidWZmZXIpOwor
CW11dGV4X3VubG9jaygmYnVmZmVyLT5sb2NrKTsKK30KKworY29uc3Qgc3RydWN0IGRtYV9idWZf
b3BzIGhlYXBfaGVscGVyX29wcyA9IHsKKwkubWFwX2RtYV9idWYgPSBkbWFfaGVhcF9tYXBfZG1h
X2J1ZiwKKwkudW5tYXBfZG1hX2J1ZiA9IGRtYV9oZWFwX3VubWFwX2RtYV9idWYsCisJLm1tYXAg
PSBkbWFfaGVhcF9tbWFwLAorCS5yZWxlYXNlID0gZG1hX2hlYXBfZG1hX2J1Zl9yZWxlYXNlLAor
CS5hdHRhY2ggPSBkbWFfaGVhcF9hdHRhY2gsCisJLmRldGFjaCA9IGRtYV9oZWFwX2RldGFjaCwK
KwkuYmVnaW5fY3B1X2FjY2VzcyA9IGRtYV9oZWFwX2RtYV9idWZfYmVnaW5fY3B1X2FjY2VzcywK
KwkuZW5kX2NwdV9hY2Nlc3MgPSBkbWFfaGVhcF9kbWFfYnVmX2VuZF9jcHVfYWNjZXNzLAorCS52
bWFwID0gZG1hX2hlYXBfZG1hX2J1Zl92bWFwLAorCS52dW5tYXAgPSBkbWFfaGVhcF9kbWFfYnVm
X3Z1bm1hcCwKK307CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxw
ZXJzLmggYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmgKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5lYmUxYzE1ZjE2Y2YKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmgKQEAgLTAsMCArMSw1NSBA
QAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBETUFCVUYg
SGVhcHMgaGVscGVyIGNvZGUKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTEgR29vZ2xlLCBJbmMu
CisgKiBDb3B5cmlnaHQgKEMpIDIwMTkgTGluYXJvIEx0ZC4KKyAqLworCisjaWZuZGVmIF9IRUFQ
X0hFTFBFUlNfSAorI2RlZmluZSBfSEVBUF9IRUxQRVJTX0gKKworI2luY2x1ZGUgPGxpbnV4L2Rt
YS1oZWFwLmg+CisjaW5jbHVkZSA8bGludXgvbGlzdC5oPgorCisvKioKKyAqIHN0cnVjdCBoZWFw
X2hlbHBlcl9idWZmZXIgLSBoZWxwZXIgYnVmZmVyIG1ldGFkYXRhCisgKiBAaGVhcDoJCWJhY2sg
cG9pbnRlciB0byB0aGUgaGVhcCB0aGUgYnVmZmVyIGNhbWUgZnJvbQorICogQGRtYWJ1ZjoJCWJh
Y2tpbmcgZG1hLWJ1ZiBmb3IgdGhpcyBidWZmZXIKKyAqIEBzaXplOgkJc2l6ZSBvZiB0aGUgYnVm
ZmVyCisgKiBAZmxhZ3M6CQlidWZmZXIgc3BlY2lmaWMgZmxhZ3MKKyAqIEBwcml2X3ZpcnQJCXBv
aW50ZXIgdG8gaGVhcCBzcGVjaWZpYyBwcml2YXRlIHZhbHVlCisgKiBAbG9jawkJbXV0ZXh0IHRv
IHByb3RlY3QgdGhlIGRhdGEgaW4gdGhpcyBzdHJ1Y3R1cmUKKyAqIEB2bWFwX2NudAkJY291bnQg
b2Ygdm1hcCByZWZlcmVuY2VzIG9uIHRoZSBidWZmZXIKKyAqIEB2YWRkcgkJdm1hcCdlZCB2aXJ0
dWFsIGFkZHJlc3MKKyAqIEBwYWdlY291bnQJCW51bWJlciBvZiBwYWdlcyBpbiB0aGUgYnVmZmVy
CisgKiBAcGFnZXMJCWxpc3Qgb2YgcGFnZSBwb2ludGVycworICogQGF0dGFjaG1lbnQJCWxpc3Qg
b2YgZGV2aWNlIGF0dGFjaG1lbnRzCisgKgorICogQGZyZWUJCWhlYXAgY2FsbGJhY2sgdG8gZnJl
ZSB0aGUgYnVmZmVyCisgKi8KK3N0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgeworCXN0cnVjdCBk
bWFfaGVhcCAqaGVhcDsKKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmOworCXNpemVfdCBzaXplOwor
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwl2b2lkICpwcml2X3ZpcnQ7CisJc3RydWN0IG11dGV4
IGxvY2s7CisJaW50IHZtYXBfY250OworCXZvaWQgKnZhZGRyOworCXBnb2ZmX3QgcGFnZWNvdW50
OworCXN0cnVjdCBwYWdlICoqcGFnZXM7CisJc3RydWN0IGxpc3RfaGVhZCBhdHRhY2htZW50czsK
KworCXZvaWQgKCpmcmVlKShzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIpOworfTsK
Kwordm9pZCBpbml0X2hlYXBfaGVscGVyX2J1ZmZlcihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVy
ICpidWZmZXIsCisJCQkgICAgIHZvaWQgKCpmcmVlKShzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVy
ICopKTsKKworc3RydWN0IGRtYV9idWYgKmhlYXBfaGVscGVyX2V4cG9ydF9kbWFidWYoc3RydWN0
IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyLAorCQkJCQkgIGludCBmZF9mbGFncyk7CisKK2V4
dGVybiBjb25zdCBzdHJ1Y3QgZG1hX2J1Zl9vcHMgaGVhcF9oZWxwZXJfb3BzOworI2VuZGlmIC8q
IF9IRUFQX0hFTFBFUlNfSCAqLwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
