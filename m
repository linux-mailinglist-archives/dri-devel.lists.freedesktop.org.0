Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 62CBB2B443
	for <lists+dri-devel@lfdr.de>; Mon, 27 May 2019 14:05:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8ACA489CD8;
	Mon, 27 May 2019 12:04:47 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from newverein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 37A7189C8D
 for <dri-devel@lists.freedesktop.org>; Thu, 23 May 2019 06:54:15 +0000 (UTC)
Received: by newverein.lst.de (Postfix, from userid 2005)
 id 8FD7668B05; Thu, 23 May 2019 08:53:52 +0200 (CEST)
From: Torsten Duwe <duwe@lst.de>
To: Maxime Ripard <maxime.ripard@bootlin.com>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Subject: [PATCH 3/6] drm/bridge: extract some Analogix I2C DP common code
References: <20190523065013.2719D68B05@newverein.lst.de>
Message-Id: <20190523065352.8FD7668B05@newverein.lst.de>
Date: Thu, 23 May 2019 08:53:52 +0200 (CEST)
X-Mailman-Approved-At: Mon, 27 May 2019 12:03:54 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKU29tZSBjb2RlIGNhbiBiZSBz
aGFyZWQgd2l0aGluIGRpZmZlcmVudCBEUCBicmlkZ2VzIGJ5IEFuYWxvZ2l4LgoKRXh0cmFjdCB0
aGVtIHRvIGEgbmV3IG1vZHVsZS4KClNpZ25lZC1vZmYtYnk6IEljZW5vd3kgWmhlbmcgPGljZW5v
d3lAYW9zYy5pbz4KU2lnbmVkLW9mZi1ieTogVmFzaWx5IEtob3J1emhpY2sgPGFuYXJzb3VsQGdt
YWlsLmNvbT4KU2lnbmVkLW9mZi1ieTogVG9yc3RlbiBEdXdlIDxkdXdlQHN1c2UuZGU+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnICAgICAgICAgICAgfCAgIDQg
KwogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZSAgICAgICAgICAgfCAg
IDIgKwogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1hbng3OHh4LmMg
fCAxNDYgKy0tLS0tLS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5h
bG9naXgtaTJjLWRwdHguYyAgICB8IDE2OSArKysrKysrKysrKysrKysrKysrKysKIC4uLi9ncHUv
ZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oICAgIHwgICAyICsKIDUgZmls
ZXMgY2hhbmdlZCwgMTc4IGluc2VydGlvbnMoKyksIDE0NSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1k
cHR4LmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tjb25m
aWcgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tjb25maWcKaW5kZXggYzRkMzQz
YTJmMDRkLi5lZDJkMDVjMTI1NDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2Uv
YW5hbG9naXgvS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tj
b25maWcKQEAgLTEsNiArMSw3IEBACiAjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4w
LW9ubHkKIGNvbmZpZyBEUk1fQU5BTE9HSVhfQU5YNzhYWAogCXRyaXN0YXRlICJBbmFsb2dpeCBB
Tlg3OFhYIGJyaWRnZSIKKwlzZWxlY3QgRFJNX0FOQUxPR0lYX0RQX0kyQwogCXNlbGVjdCBEUk1f
S01TX0hFTFBFUgogCXNlbGVjdCBSRUdNQVBfSTJDCiAJaGVscApAQCAtMTEsMyArMTIsNiBAQCBj
b25maWcgRFJNX0FOQUxPR0lYX0FOWDc4WFgKIGNvbmZpZyBEUk1fQU5BTE9HSVhfRFAKIAl0cmlz
dGF0ZQogCWRlcGVuZHMgb24gRFJNCisKK2NvbmZpZyBEUk1fQU5BTE9HSVhfRFBfSTJDCisJdHJp
c3RhdGUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvTWFrZWZp
bGUgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlCmluZGV4IGNlMTY4
N2U2MDk3NS4uMmQ1MjNiNjc0ODdkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2FuYWxvZ2l4L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgv
TWFrZWZpbGUKQEAgLTEsNCArMSw2IEBACiAjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwt
Mi4wLW9ubHkKIGFuYWxvZ2l4X2RwLW9ianMgOj0gYW5hbG9naXhfZHBfY29yZS5vIGFuYWxvZ2l4
X2RwX3JlZy5vCithbmFsb2dpeF9kcF9pMmMtb2JqcyA6PSBhbmFsb2dpeC1pMmMtZHB0eC5vCiBv
YmotJChDT05GSUdfRFJNX0FOQUxPR0lYX0FOWDc4WFgpICs9IGFuYWxvZ2l4LWFueDc4eHgubwog
b2JqLSQoQ09ORklHX0RSTV9BTkFMT0dJWF9EUCkgKz0gYW5hbG9naXhfZHAubworb2JqLSQoQ09O
RklHX0RSTV9BTkFMT0dJWF9EUF9JMkMpICs9IGFuYWxvZ2l4X2RwX2kyYy5vCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4eHguYyBiL2Ry
aXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54Nzh4eC5jCmluZGV4IGY4
NDMzYzkzZjQ2My4uYmY4MjkxZDBkZGQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJp
ZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4eHguYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJp
ZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDc4eHguYwpAQCAtNDUsOCArNDUsNiBAQAogI2RlZmlu
ZSBJMkNfSURYX1JYX1AxCQk0CiAKICNkZWZpbmUgWFRBTF9DTEsJCTI3MCAvKiAyN00gKi8KLSNk
ZWZpbmUgQVVYX0NIX0JVRkZFUl9TSVpFCTE2Ci0jZGVmaW5lIEFVWF9XQUlUX1RJTUVPVVRfTVMJ
MTUKIAogc3RhdGljIGNvbnN0IHU4IGFueDc4eHhfaTJjX2FkZHJlc3Nlc1tdID0gewogCVtJMkNf
SURYX1RYX1AwXSA9IFRYX1AwLApAQCAtMTA5LDE1MyArMTA3LDExIEBAIHN0YXRpYyBpbnQgYW54
Nzh4eF9jbGVhcl9iaXRzKHN0cnVjdCByZWdtYXAgKm1hcCwgdTggcmVnLCB1OCBtYXNrKQogCXJl
dHVybiByZWdtYXBfdXBkYXRlX2JpdHMobWFwLCByZWcsIG1hc2ssIDApOwogfQogCi1zdGF0aWMg
Ym9vbCBhbng3OHh4X2F1eF9vcF9maW5pc2hlZChzdHJ1Y3QgYW54Nzh4eCAqYW54Nzh4eCkKLXsK
LQl1bnNpZ25lZCBpbnQgdmFsdWU7Ci0JaW50IGVycjsKLQotCWVyciA9IHJlZ21hcF9yZWFkKGFu
eDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKLQkJCSAg
JnZhbHVlKTsKLQlpZiAoZXJyIDwgMCkKLQkJcmV0dXJuIGZhbHNlOwotCi0JcmV0dXJuICh2YWx1
ZSAmIFNQX0FVWF9FTikgPT0gMDsKLX0KLQotc3RhdGljIGludCBhbng3OHh4X2F1eF93YWl0KHN0
cnVjdCBhbng3OHh4ICphbng3OHh4KQotewotCXVuc2lnbmVkIGxvbmcgdGltZW91dDsKLQl1bnNp
Z25lZCBpbnQgc3RhdHVzOwotCWludCBlcnI7Ci0KLQl0aW1lb3V0ID0gamlmZmllcyArIG1zZWNz
X3RvX2ppZmZpZXMoQVVYX1dBSVRfVElNRU9VVF9NUykgKyAxOwotCi0Jd2hpbGUgKCFhbng3OHh4
X2F1eF9vcF9maW5pc2hlZChhbng3OHh4KSkgewotCQlpZiAodGltZV9hZnRlcihqaWZmaWVzLCB0
aW1lb3V0KSkgewotCQkJaWYgKCFhbng3OHh4X2F1eF9vcF9maW5pc2hlZChhbng3OHh4KSkgewot
CQkJCURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgQVVYIHRvIGZpbmlzaFxuIik7Ci0JCQkJ
cmV0dXJuIC1FVElNRURPVVQ7Ci0JCQl9Ci0KLQkJCWJyZWFrOwotCQl9Ci0KLQkJdXNsZWVwX3Jh
bmdlKDEwMDAsIDIwMDApOwotCX0KLQotCS8qIFJlYWQgdGhlIEFVWCBjaGFubmVsIGFjY2VzcyBz
dGF0dXMgKi8KLQllcnIgPSByZWdtYXBfcmVhZChhbng3OHh4LT5tYXBbSTJDX0lEWF9UWF9QMF0s
IFNQX0FVWF9DSF9TVEFUVVNfUkVHLAotCQkJICAmc3RhdHVzKTsKLQlpZiAoZXJyIDwgMCkgewot
CQlEUk1fRVJST1IoIkZhaWxlZCB0byByZWFkIGZyb20gQVVYIGNoYW5uZWw6ICVkXG4iLCBlcnIp
OwotCQlyZXR1cm4gZXJyOwotCX0KLQotCWlmIChzdGF0dXMgJiBTUF9BVVhfU1RBVFVTKSB7Ci0J
CURSTV9FUlJPUigiRmFpbGVkIHRvIHdhaXQgZm9yIEFVWCBjaGFubmVsIChzdGF0dXM6ICUwMngp
XG4iLAotCQkJICBzdGF0dXMpOwotCQlyZXR1cm4gLUVUSU1FRE9VVDsKLQl9Ci0KLQlyZXR1cm4g
MDsKLX0KLQotc3RhdGljIGludCBhbng3OHh4X2F1eF9hZGRyZXNzKHN0cnVjdCBhbng3OHh4ICph
bng3OHh4LCB1bnNpZ25lZCBpbnQgYWRkcikKLXsKLQlpbnQgZXJyOwotCi0JZXJyID0gcmVnbWFw
X3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfQVVYX0FERFJfN18wX1JFRywK
LQkJCSAgIGFkZHIgJiAweGZmKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JZXJyID0g
cmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfQVVYX0FERFJfMTVf
OF9SRUcsCi0JCQkgICAoYWRkciAmIDB4ZmYwMCkgPj4gOCk7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCS8qCi0JICogRFAgQVVYIENIIEFkZHJlc3MgUmVnaXN0ZXIgIzIsIG9ubHkgdXBk
YXRlIGJpdHNbMzowXQotCSAqIFs3OjRdIFJFU0VSVkVECi0JICogWzM6MF0gQVVYX0FERFJbMTk6
MTZdLCBSZWdpc3RlciBjb250cm9sIEFVWCBDSCBhZGRyZXNzLgotCSAqLwotCWVyciA9IHJlZ21h
cF91cGRhdGVfYml0cyhhbng3OHh4LT5tYXBbSTJDX0lEWF9UWF9QMF0sCi0JCQkJIFNQX0FVWF9B
RERSXzE5XzE2X1JFRywKLQkJCQkgU1BfQVVYX0FERFJfMTlfMTZfTUFTSywKLQkJCQkgKGFkZHIg
JiAweGYwMDAwKSA+PiAxNik7Ci0KLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJu
IDA7Ci19Ci0KIHN0YXRpYyBzc2l6ZV90IGFueDc4eHhfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1f
ZHBfYXV4ICphdXgsCiAJCQkJICAgIHN0cnVjdCBkcm1fZHBfYXV4X21zZyAqbXNnKQogewogCXN0
cnVjdCBhbng3OHh4ICphbng3OHh4ID0gY29udGFpbmVyX29mKGF1eCwgc3RydWN0IGFueDc4eHgs
IGF1eCk7Ci0JdTggY3RybDEgPSBtc2ctPnJlcXVlc3Q7Ci0JdTggY3RybDIgPSBTUF9BVVhfRU47
Ci0JdTggKmJ1ZmZlciA9IG1zZy0+YnVmZmVyOwotCWludCBlcnI7Ci0KLQkvKiBUaGUgRFAgQVVY
IHRyYW5zbWl0IGFuZCByZWNlaXZlIGJ1ZmZlciBoYXMgMTYgYnl0ZXMuICovCi0JaWYgKFdBUk5f
T04obXNnLT5zaXplID4gQVVYX0NIX0JVRkZFUl9TSVpFKSkKLQkJcmV0dXJuIC1FMkJJRzsKLQot
CS8qIFplcm8tc2l6ZWQgbWVzc2FnZXMgc3BlY2lmeSBhZGRyZXNzLW9ubHkgdHJhbnNhY3Rpb25z
LiAqLwotCWlmIChtc2ctPnNpemUgPCAxKQotCQljdHJsMiB8PSBTUF9BRERSX09OTFk7Ci0JZWxz
ZQkvKiBGb3Igbm9uLXplcm8tc2l6ZWQgc2V0IHRoZSBsZW5ndGggZmllbGQuICovCi0JCWN0cmwx
IHw9IChtc2ctPnNpemUgLSAxKSA8PCBTUF9BVVhfTEVOR1RIX1NISUZUOwotCi0JaWYgKChtc2ct
PnJlcXVlc3QgJiBEUF9BVVhfSTJDX1JFQUQpID09IDApIHsKLQkJLyogV2hlbiBXUklURSB8IE1P
VCB3cml0ZSB2YWx1ZXMgdG8gZGF0YSBidWZmZXIgKi8KLQkJZXJyID0gcmVnbWFwX2J1bGtfd3Jp
dGUoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJCQlTUF9EUF9CVUZfREFUQTBfUkVH
LCBidWZmZXIsCi0JCQkJCW1zZy0+c2l6ZSk7Ci0JCWlmIChlcnIpCi0JCQlyZXR1cm4gZXJyOwot
CX0KLQotCS8qIFdyaXRlIGFkZHJlc3MgYW5kIHJlcXVlc3QgKi8KLQllcnIgPSBhbng3OHh4X2F1
eF9hZGRyZXNzKGFueDc4eHgsIG1zZy0+YWRkcmVzcyk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVy
cjsKLQotCWVyciA9IHJlZ21hcF93cml0ZShhbng3OHh4LT5tYXBbSTJDX0lEWF9UWF9QMF0sIFNQ
X0RQX0FVWF9DSF9DVFJMMV9SRUcsCi0JCQkgICBjdHJsMSk7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCS8qIFN0YXJ0IHRyYW5zYWN0aW9uICovCi0JZXJyID0gcmVnbWFwX3VwZGF0ZV9i
aXRzKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwKLQkJCQkgU1BfRFBfQVVYX0NIX0NUUkwy
X1JFRywgU1BfQUREUl9PTkxZIHwKLQkJCQkgU1BfQVVYX0VOLCBjdHJsMik7Ci0JaWYgKGVycikK
LQkJcmV0dXJuIGVycjsKLQotCWVyciA9IGFueDc4eHhfYXV4X3dhaXQoYW54Nzh4eCk7Ci0JaWYg
KGVycikKLQkJcmV0dXJuIGVycjsKLQotCW1zZy0+cmVwbHkgPSBEUF9BVVhfSTJDX1JFUExZX0FD
SzsKLQotCWlmICgobXNnLT5zaXplID4gMCkgJiYgKG1zZy0+cmVxdWVzdCAmIERQX0FVWF9JMkNf
UkVBRCkpIHsKLQkJLyogUmVhZCB2YWx1ZXMgZnJvbSBkYXRhIGJ1ZmZlciAqLwotCQllcnIgPSBy
ZWdtYXBfYnVsa19yZWFkKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwKLQkJCQkgICAgICAg
U1BfRFBfQlVGX0RBVEEwX1JFRywgYnVmZmVyLAotCQkJCSAgICAgICBtc2ctPnNpemUpOwotCQlp
ZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQl9Ci0KLQllcnIgPSBhbng3OHh4X2NsZWFyX2JpdHMo
YW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJCSBTUF9EUF9BVVhfQ0hfQ1RSTDJfUkVH
LCBTUF9BRERSX09OTFkpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gbXNn
LT5zaXplOworCXJldHVybiBhbnhfYXV4X3RyYW5zZmVyKGFueDc4eHgtPm1hcFtJMkNfSURYX1RY
X1AwXSwgbXNnKTsKIH0KIAogc3RhdGljIGludCBhbng3OHh4X3NldF9ocGQoc3RydWN0IGFueDc4
eHggKmFueDc4eHgpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4
L2FuYWxvZ2l4LWkyYy1kcHR4LmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2Fu
YWxvZ2l4LWkyYy1kcHR4LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li45Y2IzMDk2MjAzMmUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKQEAgLTAsMCArMSwxNjkgQEAKKy8vIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0KGMpIDIwMTcgSWNl
bm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgorICoKKyAqIEJhc2VkIG9uIGFuYWxvZ2l4LWFu
eDc4eHguYywgd2hpY2ggaXM6CisgKiAgIENvcHlyaWdodChjKSAyMDE2LCBBbmFsb2dpeCBTZW1p
Y29uZHVjdG9yLiBBbGwgcmlnaHRzIHJlc2VydmVkLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9t
b2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKworI2luY2x1ZGUgPGRybS9kcm0u
aD4KKyNpbmNsdWRlIDxkcm0vZHJtUC5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHBfaGVscGVyLmg+
CisKKyNpbmNsdWRlICJhbmFsb2dpeC1pMmMtZHB0eC5oIgorCisjZGVmaW5lIEFVWF9XQUlUX1RJ
TUVPVVRfTVMJMTUKKyNkZWZpbmUgQVVYX0NIX0JVRkZFUl9TSVpFCTE2CisKK3N0YXRpYyBpbnQg
YW54X2NsZWFyX2JpdHMoc3RydWN0IHJlZ21hcCAqbWFwLCB1OCByZWcsIHU4IG1hc2spCit7CisJ
cmV0dXJuIHJlZ21hcF91cGRhdGVfYml0cyhtYXAsIHJlZywgbWFzaywgMCk7Cit9CisKK3N0YXRp
YyBib29sIGFueF9hdXhfb3BfZmluaXNoZWQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJ
dW5zaWduZWQgaW50IHZhbHVlOworCWludCBlcnI7CisKKwllcnIgPSByZWdtYXBfcmVhZChtYXBf
ZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgJnZhbHVlKTsKKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIFNQX0FVWF9FTikgPT0gMDsKK30KKwor
c3RhdGljIGludCBhbnhfYXV4X3dhaXQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJdW5z
aWduZWQgbG9uZyB0aW1lb3V0OworCXVuc2lnbmVkIGludCBzdGF0dXM7CisJaW50IGVycjsKKwor
CXRpbWVvdXQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlmZmllcyhBVVhfV0FJVF9USU1FT1VUX01T
KSArIDE7CisKKwl3aGlsZSAoIWFueF9hdXhfb3BfZmluaXNoZWQobWFwX2RwdHgpKSB7CisJCWlm
ICh0aW1lX2FmdGVyKGppZmZpZXMsIHRpbWVvdXQpKSB7CisJCQlpZiAoIWFueF9hdXhfb3BfZmlu
aXNoZWQobWFwX2RwdHgpKSB7CisJCQkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBBVVgg
dG8gZmluaXNoXG4iKTsKKwkJCQlyZXR1cm4gLUVUSU1FRE9VVDsKKwkJCX0KKworCQkJYnJlYWs7
CisJCX0KKworCQl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisJfQorCisJLyogUmVhZCB0aGUg
QVVYIGNoYW5uZWwgYWNjZXNzIHN0YXR1cyAqLworCWVyciA9IHJlZ21hcF9yZWFkKG1hcF9kcHR4
LCBTUF9BVVhfQ0hfU1RBVFVTX1JFRywgJnN0YXR1cyk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJN
X0VSUk9SKCJGYWlsZWQgdG8gcmVhZCBmcm9tIEFVWCBjaGFubmVsOiAlZFxuIiwgZXJyKTsKKwkJ
cmV0dXJuIGVycjsKKwl9CisKKwlpZiAoc3RhdHVzICYgU1BfQVVYX1NUQVRVUykgeworCQlEUk1f
RVJST1IoIkZhaWxlZCB0byB3YWl0IGZvciBBVVggY2hhbm5lbCAoc3RhdHVzOiAlMDJ4KVxuIiwK
KwkJCSAgc3RhdHVzKTsKKwkJcmV0dXJuIC1FVElNRURPVVQ7CisJfQorCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgYW54X2F1eF9hZGRyZXNzKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LCB1
bnNpZ25lZCBpbnQgYWRkcikKK3sKKwlpbnQgZXJyOworCisJZXJyID0gcmVnbWFwX3dyaXRlKG1h
cF9kcHR4LCBTUF9BVVhfQUREUl83XzBfUkVHLCBhZGRyICYgMHhmZik7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShtYXBfZHB0eCwgU1BfQVVYX0FERFJf
MTVfOF9SRUcsCisJCQkgICAoYWRkciAmIDB4ZmYwMCkgPj4gOCk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKKworCS8qCisJICogRFAgQVVYIENIIEFkZHJlc3MgUmVnaXN0ZXIgIzIsIG9ubHkg
dXBkYXRlIGJpdHNbMzowXQorCSAqIFs3OjRdIFJFU0VSVkVECisJICogWzM6MF0gQVVYX0FERFJb
MTk6MTZdLCBSZWdpc3RlciBjb250cm9sIEFVWCBDSCBhZGRyZXNzLgorCSAqLworCWVyciA9IHJl
Z21hcF91cGRhdGVfYml0cyhtYXBfZHB0eCwgU1BfQVVYX0FERFJfMTlfMTZfUkVHLAorCQkJCSBT
UF9BVVhfQUREUl8xOV8xNl9NQVNLLAorCQkJCSAoYWRkciAmIDB4ZjAwMDApID4+IDE2KTsKKwor
CWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gMDsKK30KKworc3NpemVfdCBhbnhf
YXV4X3RyYW5zZmVyKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LCBzdHJ1Y3QgZHJtX2RwX2F1eF9t
c2cgKm1zZykKK3sKKwl1OCBjdHJsMSA9IG1zZy0+cmVxdWVzdDsKKwl1OCBjdHJsMiA9IFNQX0FV
WF9FTjsKKwl1OCAqYnVmZmVyID0gbXNnLT5idWZmZXI7CisJaW50IGVycjsKKworCS8qIFRoZSBE
UCBBVVggdHJhbnNtaXQgYW5kIHJlY2VpdmUgYnVmZmVyIGhhcyAxNiBieXRlcy4gKi8KKwlpZiAo
V0FSTl9PTihtc2ctPnNpemUgPiBBVVhfQ0hfQlVGRkVSX1NJWkUpKQorCQlyZXR1cm4gLUUyQklH
OworCisJLyogWmVyby1zaXplZCBtZXNzYWdlcyBzcGVjaWZ5IGFkZHJlc3Mtb25seSB0cmFuc2Fj
dGlvbnMuICovCisJaWYgKG1zZy0+c2l6ZSA8IDEpCisJCWN0cmwyIHw9IFNQX0FERFJfT05MWTsK
KwllbHNlCS8qIEZvciBub24temVyby1zaXplZCBzZXQgdGhlIGxlbmd0aCBmaWVsZC4gKi8KKwkJ
Y3RybDEgfD0gKG1zZy0+c2l6ZSAtIDEpIDw8IFNQX0FVWF9MRU5HVEhfU0hJRlQ7CisKKwlpZiAo
KG1zZy0+cmVxdWVzdCAmIERQX0FVWF9JMkNfUkVBRCkgPT0gMCkgeworCQkvKiBXaGVuIFdSSVRF
IHwgTU9UIHdyaXRlIHZhbHVlcyB0byBkYXRhIGJ1ZmZlciAqLworCQllcnIgPSByZWdtYXBfYnVs
a193cml0ZShtYXBfZHB0eCwKKwkJCQkJU1BfRFBfQlVGX0RBVEEwX1JFRywgYnVmZmVyLAorCQkJ
CQltc2ctPnNpemUpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBXcml0
ZSBhZGRyZXNzIGFuZCByZXF1ZXN0ICovCisJZXJyID0gYW54X2F1eF9hZGRyZXNzKG1hcF9kcHR4
LCBtc2ctPmFkZHJlc3MpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSByZWdt
YXBfd3JpdGUobWFwX2RwdHgsIFNQX0RQX0FVWF9DSF9DVFJMMV9SRUcsIGN0cmwxKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogU3RhcnQgdHJhbnNhY3Rpb24gKi8KKwllcnIgPSBy
ZWdtYXBfdXBkYXRlX2JpdHMobWFwX2RwdHgsIFNQX0RQX0FVWF9DSF9DVFJMMl9SRUcsCisJCQkJ
IFNQX0FERFJfT05MWSB8IFNQX0FVWF9FTiwgY3RybDIpOworCWlmIChlcnIpCisJCXJldHVybiBl
cnI7CisKKwllcnIgPSBhbnhfYXV4X3dhaXQobWFwX2RwdHgpOworCWlmIChlcnIpCisJCXJldHVy
biBlcnI7CisKKwltc2ctPnJlcGx5ID0gRFBfQVVYX0kyQ19SRVBMWV9BQ0s7CisKKwlpZiAoKG1z
Zy0+c2l6ZSA+IDApICYmIChtc2ctPnJlcXVlc3QgJiBEUF9BVVhfSTJDX1JFQUQpKSB7CisJCS8q
IFJlYWQgdmFsdWVzIGZyb20gZGF0YSBidWZmZXIgKi8KKwkJZXJyID0gcmVnbWFwX2J1bGtfcmVh
ZChtYXBfZHB0eCwKKwkJCQkgICAgICAgU1BfRFBfQlVGX0RBVEEwX1JFRywgYnVmZmVyLAorCQkJ
CSAgICAgICBtc2ctPnNpemUpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwll
cnIgPSBhbnhfY2xlYXJfYml0cyhtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgU1Bf
QUREUl9PTkxZKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIG1zZy0+c2l6
ZTsKK30KK0VYUE9SVF9TWU1CT0woYW54X2F1eF90cmFuc2Zlcik7CisKK01PRFVMRV9ERVNDUklQ
VElPTigiQW5hbG9naXggRGlzcGxheVBvcnQgVHJhbnNtaXR0ZXIgY29tbW9uIGNvZGUiKTsKK01P
RFVMRV9BVVRIT1IoIkljZW5vd3kgWmhlbmcgPGljZW5vd3lAYW9zYy5pbz4iKTsKK01PRFVMRV9M
SUNFTlNFKCJHUEwgdjIiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvYW5hbG9naXgtaTJjLWRwdHguaCBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9n
aXgvYW5hbG9naXgtaTJjLWRwdHguaAppbmRleCBiYzA4MzFiMTI3YmYuLmMyY2E4NTQ2MTNhMCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMt
ZHB0eC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtaTJj
LWRwdHguaApAQCAtMjQ1LDQgKzI0NSw2IEBACiAvKiBEUCBBVVggQnVmZmVyIERhdGEgUmVnaXN0
ZXJzICovCiAjZGVmaW5lIFNQX0RQX0JVRl9EQVRBMF9SRUcJCTB4ZjAKIAorc3NpemVfdCBhbnhf
YXV4X3RyYW5zZmVyKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LCBzdHJ1Y3QgZHJtX2RwX2F1eF9t
c2cgKm1zZyk7CisKICNlbmRpZgotLSAKMi4xNi40CgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
