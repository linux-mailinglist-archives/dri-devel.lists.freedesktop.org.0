Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 560142B6F4
	for <lists+dri-devel@lfdr.de>; Mon, 27 May 2019 15:48:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5AD6F6E21A;
	Mon, 27 May 2019 13:48:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fllv0015.ext.ti.com (fllv0015.ext.ti.com [198.47.19.141])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 83F516E20F
 for <dri-devel@lists.freedesktop.org>; Mon, 27 May 2019 13:48:21 +0000 (UTC)
Received: from lelv0266.itg.ti.com ([10.180.67.225])
 by fllv0015.ext.ti.com (8.15.2/8.15.2) with ESMTP id x4RDmD8N012518;
 Mon, 27 May 2019 08:48:13 -0500
Received: from DLEE100.ent.ti.com (dlee100.ent.ti.com [157.170.170.30])
 by lelv0266.itg.ti.com (8.15.2/8.15.2) with ESMTPS id x4RDmDhg055064
 (version=TLSv1.2 cipher=AES256-GCM-SHA384 bits=256 verify=FAIL);
 Mon, 27 May 2019 08:48:13 -0500
Received: from DLEE101.ent.ti.com (157.170.170.31) by DLEE100.ent.ti.com
 (157.170.170.30) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5; Mon, 27
 May 2019 08:48:13 -0500
Received: from fllv0040.itg.ti.com (10.64.41.20) by DLEE101.ent.ti.com
 (157.170.170.31) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5 via
 Frontend Transport; Mon, 27 May 2019 08:48:13 -0500
Received: from jadmar.ti.com (ileax41-snat.itg.ti.com [10.172.224.153])
 by fllv0040.itg.ti.com (8.15.2/8.15.2) with ESMTP id x4RDlviJ065947;
 Mon, 27 May 2019 08:48:11 -0500
From: Jyri Sarha <jsarha@ti.com>
To: <alsa-devel@alsa-project.org>, <devicetree@vger.kernel.org>,
 <dri-devel@lists.freedesktop.org>
Subject: [PATCH v8 6/6] drm/bridge: sii902x: Implement HDMI audio support
Date: Mon, 27 May 2019 16:47:57 +0300
Message-ID: <ef6895d016554b1e0c8b388d4993bcd6a3699341.1558964241.git.jsarha@ti.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <cover.1558964241.git.jsarha@ti.com>
References: <cover.1558964241.git.jsarha@ti.com>
MIME-Version: 1.0
X-EXCLAIMER-MD-CONFIG: e1e8a2fd-e40a-4ac6-ac9b-f7e9cc9ee180
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ti.com; s=ti-com-17Q1; t=1558964893;
 bh=8htxxYwVuVexeT6tGtkINtgVw0R60e9Wid5CiXQrcmU=;
 h=From:To:CC:Subject:Date:In-Reply-To:References;
 b=W99kAPbEUHTcmmo3fcYvJdkeyC4VN3Zlk5lzESfo/zsvKueF5FJ8qg+O+6tOt55qb
 k8WFw4/f4O6I3q6RX/K2UL2SaM29AP8zNO+ALjFY9a3rU6Qr/25aikUnqiRFeisCy0
 /zZ0LKu3ezRD6768PqCkC9DV3zsFS9f/KvnIfXqU=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: peter.ujfalusi@ti.com, tomi.valkeinen@ti.com,
 laurent.pinchart@ideasonboard.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW1wbGVtZW50IEhETUkgYXVkaW8gc3VwcG9ydCBieSB1c2luZyBBU29DIEhETUkgY29kZWMuIFRo
ZSBjb21taXQKaW1wbGVtZW50cyB0aGUgbmVjZXNzYXJ5IGNhbGxiYWNrcyBhbmQgY29uZmlndXJh
dGlvbiBmb3IgdGhlIEhETUkKY29kZWMgYW5kIHJlZ2lzdGVycyBhIHZpcnR1YWwgcGxhdGZvcm0g
ZGV2aWNlIGZvciB0aGUgY29kZWMgdG8gYXR0YWNoLgoKU2lnbmVkLW9mZi1ieTogSnlyaSBTYXJo
YSA8anNhcmhhQHRpLmNvbT4KUmV2aWV3ZWQtYnk6IEFuZHJ6ZWogSGFqZGEgPGEuaGFqZGFAc2Ft
c3VuZy5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9zaWk5MDJ4LmMgfCA0NjkgKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrLQogMSBmaWxlIGNoYW5nZWQsIDQ2MyBpbnNlcnRp
b25zKCspLCA2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2Uvc2lpOTAyeC5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9zaWk5MDJ4LmMKaW5kZXggMTlm
OTgyYTAwZGJhLi5iYzMzMjVjNWU1YzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2Uvc2lpOTAyeC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2Uvc2lpOTAyeC5jCkBAIC0y
Nyw2ICsyNyw3IEBACiAjaW5jbHVkZSA8bGludXgvaTJjLmg+CiAjaW5jbHVkZSA8bGludXgvbW9k
dWxlLmg+CiAjaW5jbHVkZSA8bGludXgvcmVnbWFwLmg+CisjaW5jbHVkZSA8bGludXgvY2xrLmg+
CiAKICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJt
X2Rydi5oPgpAQCAtMzQsNiArMzUsOCBAQAogI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KICNp
bmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgogCisjaW5jbHVkZSA8c291bmQvaGRtaS1j
b2RlYy5oPgorCiAjZGVmaW5lIFNJSTkwMlhfVFBJX1ZJREVPX0RBVEEJCQkweDAKIAogI2RlZmlu
ZSBTSUk5MDJYX1RQSV9QSVhFTF9SRVBFVElUSU9OCQkweDgKQEAgLTc1LDYgKzc4LDc3IEBACiAj
ZGVmaW5lIFNJSTkwMlhfQVZJX1BPV0VSX1NUQVRFX01TSwkJR0VOTUFTSygxLCAwKQogI2RlZmlu
ZSBTSUk5MDJYX0FWSV9QT1dFUl9TVEFURV9EKGwpCQkoKGwpICYgU0lJOTAyWF9BVklfUE9XRVJf
U1RBVEVfTVNLKQogCisvKiBBdWRpbyAgKi8KKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX0VOQUJM
RV9NQVBQSU5HX1JFRwkweDFmCisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19DT05GSUdfRklGTzAJ
CQkoMCA8PCAwKQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfQ09ORklHX0ZJRk8xCQkJKDEgPDwg
MCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX0NPTkZJR19GSUZPMgkJCSgyIDw8IDApCisjZGVm
aW5lIFNJSTkwMlhfVFBJX0kyU19DT05GSUdfRklGTzMJCQkoMyA8PCAwKQorI2RlZmluZSBTSUk5
MDJYX1RQSV9JMlNfTEVGVF9SSUdIVF9TV0FQCQkJKDEgPDwgMikKKyNkZWZpbmUgU0lJOTAyWF9U
UElfSTJTX0FVVE9fRE9XTlNBTVBMRQkJCSgxIDw8IDMpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0ky
U19TRUxFQ1RfU0QwCQkJKDAgPDwgNCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX1NFTEVDVF9T
RDEJCQkoMSA8PCA0KQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfU0VMRUNUX1NEMgkJCSgyIDw8
IDQpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19TRUxFQ1RfU0QzCQkJKDMgPDwgNCkKKyNkZWZp
bmUgU0lJOTAyWF9UUElfSTJTX0ZJRk9fRU5BQkxFCQkJKDEgPDwgNykKKworI2RlZmluZSBTSUk5
MDJYX1RQSV9JMlNfSU5QVVRfQ09ORklHX1JFRwkweDIwCisjZGVmaW5lIFNJSTkwMlhfVFBJX0ky
U19GSVJTVF9CSVRfU0hJRlRfWUVTCQkoMCA8PCAwKQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNf
RklSU1RfQklUX1NISUZUX05PCQkoMSA8PCAwKQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfU0Rf
RElSRUNUSU9OX01TQl9GSVJTVAkJKDAgPDwgMSkKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX1NE
X0RJUkVDVElPTl9MU0JfRklSU1QJCSgxIDw8IDEpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19T
RF9KVVNUSUZZX0xFRlQJCQkoMCA8PCAyKQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfU0RfSlVT
VElGWV9SSUdIVAkJKDEgPDwgMikKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX1dTX1BPTEFSSVRZ
X0xPVwkJCSgwIDw8IDMpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19XU19QT0xBUklUWV9ISUdI
CQkoMSA8PCAzKQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfTUNMS19NVUxUSVBMSUVSXzEyOAkJ
KDAgPDwgNCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX01DTEtfTVVMVElQTElFUl8yNTYJCSgx
IDw8IDQpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19NQ0xLX01VTFRJUExJRVJfMzg0CQkoMiA8
PCA0KQorI2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfTUNMS19NVUxUSVBMSUVSXzUxMgkJKDMgPDwg
NCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX01DTEtfTVVMVElQTElFUl83NjgJCSg0IDw8IDQp
CisjZGVmaW5lIFNJSTkwMlhfVFBJX0kyU19NQ0xLX01VTFRJUExJRVJfMTAyNAkJKDUgPDwgNCkK
KyNkZWZpbmUgU0lJOTAyWF9UUElfSTJTX01DTEtfTVVMVElQTElFUl8xMTUyCQkoNiA8PCA0KQor
I2RlZmluZSBTSUk5MDJYX1RQSV9JMlNfTUNMS19NVUxUSVBMSUVSXzE5MgkJKDcgPDwgNCkKKyNk
ZWZpbmUgU0lJOTAyWF9UUElfSTJTX1NDS19FREdFX0ZBTExJTkcJCSgwIDw8IDcpCisjZGVmaW5l
IFNJSTkwMlhfVFBJX0kyU19TQ0tfRURHRV9SSVNJTkcJCQkoMSA8PCA3KQorCisjZGVmaW5lIFNJ
STkwMlhfVFBJX0kyU19TVFJNX0hEUl9CQVNFCTB4MjEKKyNkZWZpbmUgU0lJOTAyWF9UUElfSTJT
X1NUUk1fSERSX1NJWkUJNQorCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0NPTkZJR19CWVRF
Ml9SRUcJMHgyNgorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19DT0RJTkdfU1RSRUFNX0hFQURF
UgkJKDAgPDwgMCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVESU9fQ09ESU5HX1BDTQkJCSgxIDw8
IDApCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0NPRElOR19BQzMJCQkoMiA8PCAwKQorI2Rl
ZmluZSBTSUk5MDJYX1RQSV9BVURJT19DT0RJTkdfTVBFRzEJCQkoMyA8PCAwKQorI2RlZmluZSBT
SUk5MDJYX1RQSV9BVURJT19DT0RJTkdfTVAzCQkJKDQgPDwgMCkKKyNkZWZpbmUgU0lJOTAyWF9U
UElfQVVESU9fQ09ESU5HX01QRUcyCQkJKDUgPDwgMCkKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVE
SU9fQ09ESU5HX0FBQwkJCSg2IDw8IDApCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0NPRElO
R19EVFMJCQkoNyA8PCAwKQorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19DT0RJTkdfQVRSQUMJ
CQkoOCA8PCAwKQorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19NVVRFX0RJU0FCTEUJCQkoMCA8
PCA0KQorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19NVVRFX0VOQUJMRQkJCSgxIDw8IDQpCisj
ZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0xBWU9VVF8yX0NIQU5ORUxTCQkoMCA8PCA1KQorI2Rl
ZmluZSBTSUk5MDJYX1RQSV9BVURJT19MQVlPVVRfOF9DSEFOTkVMUwkJKDEgPDwgNSkKKyNkZWZp
bmUgU0lJOTAyWF9UUElfQVVESU9fSU5URVJGQUNFX0RJU0FCTEUJCSgwIDw8IDYpCisjZGVmaW5l
IFNJSTkwMlhfVFBJX0FVRElPX0lOVEVSRkFDRV9TUERJRgkJKDEgPDwgNikKKyNkZWZpbmUgU0lJ
OTAyWF9UUElfQVVESU9fSU5URVJGQUNFX0kyUwkJCSgyIDw8IDYpCisKKyNkZWZpbmUgU0lJOTAy
WF9UUElfQVVESU9fQ09ORklHX0JZVEUzX1JFRwkweDI3CisjZGVmaW5lIFNJSTkwMlhfVFBJX0FV
RElPX0ZSRVFfU1RSRUFNCQkJKDAgPDwgMykKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVESU9fRlJF
UV8zMktIWgkJCSgxIDw8IDMpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfNDRLSFoJ
CQkoMiA8PCAzKQorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19GUkVRXzQ4S0haCQkJKDMgPDwg
MykKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVESU9fRlJFUV84OEtIWgkJCSg0IDw8IDMpCisjZGVm
aW5lIFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfOTZLSFoJCQkoNSA8PCAzKQorI2RlZmluZSBTSUk5
MDJYX1RQSV9BVURJT19GUkVRXzE3NktIWgkJCSg2IDw8IDMpCisjZGVmaW5lIFNJSTkwMlhfVFBJ
X0FVRElPX0ZSRVFfMTkyS0haCQkJKDcgPDwgMykKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVESU9f
U0FNUExFX1NJWkVfU1RSRUFNCQkoMCA8PCA2KQorI2RlZmluZSBTSUk5MDJYX1RQSV9BVURJT19T
QU1QTEVfU0laRV8xNgkJKDEgPDwgNikKKyNkZWZpbmUgU0lJOTAyWF9UUElfQVVESU9fU0FNUExF
X1NJWkVfMjAJCSgyIDw8IDYpCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX1NBTVBMRV9TSVpF
XzI0CQkoMyA8PCA2KQorCisjZGVmaW5lIFNJSTkwMlhfVFBJX0FVRElPX0NPTkZJR19CWVRFNF9S
RUcJMHgyOAorCiAjZGVmaW5lIFNJSTkwMlhfSU5UX0VOQUJMRQkJCTB4M2MKICNkZWZpbmUgU0lJ
OTAyWF9JTlRfU1RBVFVTCQkJMHgzZAogI2RlZmluZSBTSUk5MDJYX0hPVFBMVUdfRVZFTlQJCQlC
SVQoMCkKQEAgLTgyLDYgKzE1NiwxNiBAQAogCiAjZGVmaW5lIFNJSTkwMlhfUkVHX1RQSV9SUUIJ
CQkweGM3CiAKKy8qIEluZGlyZWN0IGludGVybmFsIHJlZ2lzdGVyIGFjY2VzcyAqLworI2RlZmlu
ZSBTSUk5MDJYX0lORF9TRVRfUEFHRQkJCTB4YmMKKyNkZWZpbmUgU0lJOTAyWF9JTkRfT0ZGU0VU
CQkJMHhiZAorI2RlZmluZSBTSUk5MDJYX0lORF9WQUxVRQkJCTB4YmUKKworI2RlZmluZSBTSUk5
MDJYX1RQSV9NSVNDX0lORk9GUkFNRV9CQVNFCQkweGJmCisjZGVmaW5lIFNJSTkwMlhfVFBJX01J
U0NfSU5GT0ZSQU1FX0VORAkJMHhkZQorI2RlZmluZSBTSUk5MDJYX1RQSV9NSVNDX0lORk9GUkFN
RV9TSVpFCVwKKwkoU0lJOTAyWF9UUElfTUlTQ19JTkZPRlJBTUVfRU5EIC0gU0lJOTAyWF9UUElf
TUlTQ19JTkZPRlJBTUVfQkFTRSkKKwogI2RlZmluZSBTSUk5MDJYX0kyQ19CVVNfQUNRVUlTSVRJ
T05fVElNRU9VVF9NUwk1MDAKIAogc3RydWN0IHNpaTkwMnggewpAQCAtOTEsNiArMTc1LDE2IEBA
IHN0cnVjdCBzaWk5MDJ4IHsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciBjb25uZWN0b3I7CiAJc3Ry
dWN0IGdwaW9fZGVzYyAqcmVzZXRfZ3BpbzsKIAlzdHJ1Y3QgaTJjX211eF9jb3JlICppMmNtdXg7
CisJLyoKKwkgKiBNdXRleCBwcm90ZWN0cyBhdWRpbyBhbmQgdmlkZW8gZnVuY3Rpb25zIGZyb20g
aW50ZXJmZXJpbmcKKwkgKiBlYWNoIG90aGVyLCBieSBrZWVwaW5nIHRoZWlyIGkyYyBjb21tYW5k
IHNlcXVlbmNlcyBhdG9taWMuCisJICovCisJc3RydWN0IG11dGV4IG11dGV4OworCXN0cnVjdCBz
aWk5MDJ4X2F1ZGlvIHsKKwkJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldjsKKwkJc3RydWN0
IGNsayAqbWNsazsKKwkJdTMyIGkyc19maWZvX3NlcXVlbmNlWzRdOworCX0gYXVkaW87CiB9Owog
CiBzdGF0aWMgaW50IHNpaTkwMnhfcmVhZF91bmxvY2tlZChzdHJ1Y3QgaTJjX2NsaWVudCAqaTJj
LCB1OCByZWcsIHU4ICp2YWwpCkBAIC0xNjIsOCArMjU2LDEyIEBAIHNpaTkwMnhfY29ubmVjdG9y
X2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBib29sIGZvcmNlKQogCXN0
cnVjdCBzaWk5MDJ4ICpzaWk5MDJ4ID0gY29ubmVjdG9yX3RvX3NpaTkwMngoY29ubmVjdG9yKTsK
IAl1bnNpZ25lZCBpbnQgc3RhdHVzOwogCisJbXV0ZXhfbG9jaygmc2lpOTAyeC0+bXV0ZXgpOwor
CiAJcmVnbWFwX3JlYWQoc2lpOTAyeC0+cmVnbWFwLCBTSUk5MDJYX0lOVF9TVEFUVVMsICZzdGF0
dXMpOwogCisJbXV0ZXhfdW5sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CisKIAlyZXR1cm4gKHN0YXR1
cyAmIFNJSTkwMlhfUExVR0dFRF9TVEFUVVMpID8KIAkgICAgICAgY29ubmVjdG9yX3N0YXR1c19j
b25uZWN0ZWQgOiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKIH0KQEAgLTE4NSw2ICsy
ODMsOCBAQCBzdGF0aWMgaW50IHNpaTkwMnhfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IpCiAJc3RydWN0IGVkaWQgKmVkaWQ7CiAJaW50IG51bSA9IDAsIHJldDsKIAor
CW11dGV4X2xvY2soJnNpaTkwMngtPm11dGV4KTsKKwogCWVkaWQgPSBkcm1fZ2V0X2VkaWQoY29u
bmVjdG9yLCBzaWk5MDJ4LT5pMmNtdXgtPmFkYXB0ZXJbMF0pOwogCWRybV9jb25uZWN0b3JfdXBk
YXRlX2VkaWRfcHJvcGVydHkoY29ubmVjdG9yLCBlZGlkKTsKIAlpZiAoZWRpZCkgewpAQCAtMTk4
LDE0ICsyOTgsMTkgQEAgc3RhdGljIGludCBzaWk5MDJ4X2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yKQogCXJldCA9IGRybV9kaXNwbGF5X2luZm9fc2V0X2J1c19mb3Jt
YXRzKCZjb25uZWN0b3ItPmRpc3BsYXlfaW5mbywKIAkJCQkJICAgICAgICZidXNfZm9ybWF0LCAx
KTsKIAlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCQlnb3RvIGVycm9yX291dDsKIAogCXJldCA9
IHJlZ21hcF91cGRhdGVfYml0cyhzaWk5MDJ4LT5yZWdtYXAsIFNJSTkwMlhfU1lTX0NUUkxfREFU
QSwKIAkJCQkgU0lJOTAyWF9TWVNfQ1RSTF9PVVRQVVRfTU9ERSwgb3V0cHV0X21vZGUpOwogCWlm
IChyZXQpCi0JCXJldHVybiByZXQ7CisJCWdvdG8gZXJyb3Jfb3V0OworCisJcmV0ID0gbnVtOwor
CitlcnJvcl9vdXQ6CisJbXV0ZXhfdW5sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CiAKLQlyZXR1cm4g
bnVtOworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBlbnVtIGRybV9tb2RlX3N0YXR1cyBzaWk5
MDJ4X21vZGVfdmFsaWQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKQEAgLTIyNSwy
MCArMzMwLDI4IEBAIHN0YXRpYyB2b2lkIHNpaTkwMnhfYnJpZGdlX2Rpc2FibGUoc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSkKIHsKIAlzdHJ1Y3Qgc2lpOTAyeCAqc2lpOTAyeCA9IGJyaWRnZV90
b19zaWk5MDJ4KGJyaWRnZSk7CiAKKwltdXRleF9sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CisKIAly
ZWdtYXBfdXBkYXRlX2JpdHMoc2lpOTAyeC0+cmVnbWFwLCBTSUk5MDJYX1NZU19DVFJMX0RBVEEs
CiAJCQkgICBTSUk5MDJYX1NZU19DVFJMX1BXUl9EV04sCiAJCQkgICBTSUk5MDJYX1NZU19DVFJM
X1BXUl9EV04pOworCisJbXV0ZXhfdW5sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CiB9CiAKIHN0YXRp
YyB2b2lkIHNpaTkwMnhfYnJpZGdlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQog
ewogCXN0cnVjdCBzaWk5MDJ4ICpzaWk5MDJ4ID0gYnJpZGdlX3RvX3NpaTkwMngoYnJpZGdlKTsK
IAorCW11dGV4X2xvY2soJnNpaTkwMngtPm11dGV4KTsKKwogCXJlZ21hcF91cGRhdGVfYml0cyhz
aWk5MDJ4LT5yZWdtYXAsIFNJSTkwMlhfUFdSX1NUQVRFX0NUUkwsCiAJCQkgICBTSUk5MDJYX0FW
SV9QT1dFUl9TVEFURV9NU0ssCiAJCQkgICBTSUk5MDJYX0FWSV9QT1dFUl9TVEFURV9EKDApKTsK
IAlyZWdtYXBfdXBkYXRlX2JpdHMoc2lpOTAyeC0+cmVnbWFwLCBTSUk5MDJYX1NZU19DVFJMX0RB
VEEsCiAJCQkgICBTSUk5MDJYX1NZU19DVFJMX1BXUl9EV04sIDApOworCisJbXV0ZXhfdW5sb2Nr
KCZzaWk5MDJ4LT5tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIHNpaTkwMnhfYnJpZGdlX21vZGVf
c2V0KHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCkBAIC0yNjUsMjcgKzM3OCwzMiBAQCBzdGF0
aWMgdm9pZCBzaWk5MDJ4X2JyaWRnZV9tb2RlX3NldChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdl
LAogCWJ1Zls5XSA9IFNJSTkwMlhfVFBJX0FWSV9JTlBVVF9SQU5HRV9BVVRPIHwKIAkJIFNJSTkw
MlhfVFBJX0FWSV9JTlBVVF9DT0xPUlNQQUNFX1JHQjsKIAorCW11dGV4X2xvY2soJnNpaTkwMngt
Pm11dGV4KTsKKwogCXJldCA9IHJlZ21hcF9idWxrX3dyaXRlKHJlZ21hcCwgU0lJOTAyWF9UUElf
VklERU9fREFUQSwgYnVmLCAxMCk7CiAJaWYgKHJldCkKLQkJcmV0dXJuOworCQlnb3RvIG91dDsK
IAogCXJldCA9IGRybV9oZG1pX2F2aV9pbmZvZnJhbWVfZnJvbV9kaXNwbGF5X21vZGUoJmZyYW1l
LAogCQkJCQkJICAgICAgICZzaWk5MDJ4LT5jb25uZWN0b3IsIGFkaik7CiAJaWYgKHJldCA8IDAp
IHsKIAkJRFJNX0VSUk9SKCJjb3VsZG4ndCBmaWxsIEFWSSBpbmZvZnJhbWVcbiIpOwotCQlyZXR1
cm47CisJCWdvdG8gb3V0OwogCX0KIAogCXJldCA9IGhkbWlfYXZpX2luZm9mcmFtZV9wYWNrKCZm
cmFtZSwgYnVmLCBzaXplb2YoYnVmKSk7CiAJaWYgKHJldCA8IDApIHsKIAkJRFJNX0VSUk9SKCJm
YWlsZWQgdG8gcGFjayBBVkkgaW5mb2ZyYW1lOiAlZFxuIiwgcmV0KTsKLQkJcmV0dXJuOworCQln
b3RvIG91dDsKIAl9CiAKIAkvKiBEbyBub3Qgc2VuZCB0aGUgaW5mb2ZyYW1lIGhlYWRlciwgYnV0
IGtlZXAgdGhlIENSQyBmaWVsZC4gKi8KIAlyZWdtYXBfYnVsa193cml0ZShyZWdtYXAsIFNJSTkw
MlhfVFBJX0FWSV9JTkZPRlJBTUUsCiAJCQkgIGJ1ZiArIEhETUlfSU5GT0ZSQU1FX0hFQURFUl9T
SVpFIC0gMSwKIAkJCSAgSERNSV9BVklfSU5GT0ZSQU1FX1NJWkUgKyAxKTsKKworb3V0OgorCW11
dGV4X3VubG9jaygmc2lpOTAyeC0+bXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IHNpaTkwMnhfYnJp
ZGdlX2F0dGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQpAQCAtMzI2LDYgKzQ0NCwzMzUg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIHNpaTkwMnhfYnJpZGdlX2Z1
bmNzID0gewogCS5lbmFibGUgPSBzaWk5MDJ4X2JyaWRnZV9lbmFibGUsCiB9OwogCitzdGF0aWMg
aW50IHNpaTkwMnhfbXV0ZShzdHJ1Y3Qgc2lpOTAyeCAqc2lpOTAyeCwgYm9vbCBtdXRlKQorewor
CXN0cnVjdCBkZXZpY2UgKmRldiA9ICZzaWk5MDJ4LT5pMmMtPmRldjsKKwl1bnNpZ25lZCBpbnQg
dmFsID0gbXV0ZSA/IFNJSTkwMlhfVFBJX0FVRElPX01VVEVfRU5BQkxFIDoKKwkJU0lJOTAyWF9U
UElfQVVESU9fTVVURV9ESVNBQkxFOworCisJZGV2X2RiZyhkZXYsICIlczogJXNcbiIsIF9fZnVu
Y19fLCBtdXRlID8gIk11dGVkIiA6ICJVbm11dGVkIik7CisKKwlyZXR1cm4gcmVnbWFwX3VwZGF0
ZV9iaXRzKHNpaTkwMngtPnJlZ21hcCwKKwkJCQkgIFNJSTkwMlhfVFBJX0FVRElPX0NPTkZJR19C
WVRFMl9SRUcsCisJCQkJICBTSUk5MDJYX1RQSV9BVURJT19NVVRFX0VOQUJMRSwgdmFsKTsKK30K
Kworc3RhdGljIGNvbnN0IGludCBzaWk5MDJ4X21jbGtfZGl2X3RhYmxlW10gPSB7CisJMTI4LCAy
NTYsIDM4NCwgNTEyLCA3NjgsIDEwMjQsIDExNTIsIDE5MiB9OworCitzdGF0aWMgaW50IHNpaTkw
Mnhfc2VsZWN0X21jbGtfZGl2KHU4ICppMnNfY29uZmlnX3JlZywgdW5zaWduZWQgaW50IHJhdGUs
CisJCQkJICAgdW5zaWduZWQgaW50IG1jbGspCit7CisJaW50IGRpdiA9IG1jbGsgLyByYXRlOwor
CWludCBkaXN0YW5jZSA9IDEwMDAwMDsKKwl1OCBpLCBuZWFyZXN0ID0gMDsKKworCWZvciAoaSA9
IDA7IGkgPCBBUlJBWV9TSVpFKHNpaTkwMnhfbWNsa19kaXZfdGFibGUpOyBpKyspIHsKKwkJdW5z
aWduZWQgaW50IGQgPSBhYnMoZGl2IC0gc2lpOTAyeF9tY2xrX2Rpdl90YWJsZVtpXSk7CisKKwkJ
aWYgKGQgPj0gZGlzdGFuY2UpCisJCQljb250aW51ZTsKKworCQluZWFyZXN0ID0gaTsKKwkJZGlz
dGFuY2UgPSBkOworCQlpZiAoZCA9PSAwKQorCQkJYnJlYWs7CisJfQorCisJKmkyc19jb25maWdf
cmVnIHw9IG5lYXJlc3QgPDwgNDsKKworCXJldHVybiBzaWk5MDJ4X21jbGtfZGl2X3RhYmxlW25l
YXJlc3RdOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IHNpaTkwMnhfc2FtcGxlX2ZyZXEgewor
CXUzMiBmcmVxOworCXU4IHZhbDsKK30gc2lpOTAyeF9zYW1wbGVfZnJlcVtdID0geworCXsgLmZy
ZXEgPSAzMjAwMCwJLnZhbCA9IFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfMzJLSFogfSwKKwl7IC5m
cmVxID0gNDQwMDAsCS52YWwgPSBTSUk5MDJYX1RQSV9BVURJT19GUkVRXzQ0S0haIH0sCisJeyAu
ZnJlcSA9IDQ4MDAwLAkudmFsID0gU0lJOTAyWF9UUElfQVVESU9fRlJFUV80OEtIWiB9LAorCXsg
LmZyZXEgPSA4ODAwMCwJLnZhbCA9IFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfODhLSFogfSwKKwl7
IC5mcmVxID0gOTYwMDAsCS52YWwgPSBTSUk5MDJYX1RQSV9BVURJT19GUkVRXzk2S0haIH0sCisJ
eyAuZnJlcSA9IDE3NjAwMCwJLnZhbCA9IFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfMTc2S0haIH0s
CisJeyAuZnJlcSA9IDE5MjAwMCwJLnZhbCA9IFNJSTkwMlhfVFBJX0FVRElPX0ZSRVFfMTkyS0ha
IH0sCit9OworCitzdGF0aWMgaW50IHNpaTkwMnhfYXVkaW9faHdfcGFyYW1zKHN0cnVjdCBkZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKKwkJCQkgICBzdHJ1Y3QgaGRtaV9jb2RlY19kYWlmbXQgKmRh
aWZtdCwKKwkJCQkgICBzdHJ1Y3QgaGRtaV9jb2RlY19wYXJhbXMgKnBhcmFtcykKK3sKKwlzdHJ1
Y3Qgc2lpOTAyeCAqc2lpOTAyeCA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCXU4IGkyc19jb25m
aWdfcmVnID0gU0lJOTAyWF9UUElfSTJTX1NEX0RJUkVDVElPTl9NU0JfRklSU1Q7CisJdTggY29u
ZmlnX2J5dGUyX3JlZyA9IChTSUk5MDJYX1RQSV9BVURJT19JTlRFUkZBQ0VfSTJTIHwKKwkJCSAg
ICAgICBTSUk5MDJYX1RQSV9BVURJT19NVVRFX0VOQUJMRSB8CisJCQkgICAgICAgU0lJOTAyWF9U
UElfQVVESU9fQ09ESU5HX1BDTSk7CisJdTggY29uZmlnX2J5dGUzX3JlZyA9IDA7CisJdTggaW5m
b2ZyYW1lX2J1ZltIRE1JX0lORk9GUkFNRV9TSVpFKEFVRElPKV07CisJdW5zaWduZWQgbG9uZyBt
Y2xrX3JhdGU7CisJaW50IGksIHJldDsKKworCWlmIChkYWlmbXQtPmJpdF9jbGtfbWFzdGVyIHx8
IGRhaWZtdC0+ZnJhbWVfY2xrX21hc3RlcikgeworCQlkZXZfZGJnKGRldiwgIiVzOiBJMlMgbWFz
dGVyIG1vZGUgbm90IHN1cHBvcnRlZFxuIiwgX19mdW5jX18pOworCQlyZXR1cm4gLUVJTlZBTDsK
Kwl9CisKKwlzd2l0Y2ggKGRhaWZtdC0+Zm10KSB7CisJY2FzZSBIRE1JX0kyUzoKKwkJaTJzX2Nv
bmZpZ19yZWcgfD0gU0lJOTAyWF9UUElfSTJTX0ZJUlNUX0JJVF9TSElGVF9ZRVMgfAorCQkJU0lJ
OTAyWF9UUElfSTJTX1NEX0pVU1RJRllfTEVGVDsKKwkJYnJlYWs7CisJY2FzZSBIRE1JX1JJR0hU
X0o6CisJCWkyc19jb25maWdfcmVnIHw9IFNJSTkwMlhfVFBJX0kyU19TRF9KVVNUSUZZX1JJR0hU
OworCQlicmVhazsKKwljYXNlIEhETUlfTEVGVF9KOgorCQlpMnNfY29uZmlnX3JlZyB8PSBTSUk5
MDJYX1RQSV9JMlNfU0RfSlVTVElGWV9MRUZUOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlkZXZf
ZGJnKGRldiwgIiVzOiBVbnN1cHBvcnRlZCBpMnMgZm9ybWF0ICV1XG4iLCBfX2Z1bmNfXywKKwkJ
CWRhaWZtdC0+Zm10KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKGRhaWZtdC0+Yml0
X2Nsa19pbnYpCisJCWkyc19jb25maWdfcmVnIHw9IFNJSTkwMlhfVFBJX0kyU19TQ0tfRURHRV9G
QUxMSU5HOworCWVsc2UKKwkJaTJzX2NvbmZpZ19yZWcgfD0gU0lJOTAyWF9UUElfSTJTX1NDS19F
REdFX1JJU0lORzsKKworCWlmIChkYWlmbXQtPmZyYW1lX2Nsa19pbnYpCisJCWkyc19jb25maWdf
cmVnIHw9IFNJSTkwMlhfVFBJX0kyU19XU19QT0xBUklUWV9MT1c7CisJZWxzZQorCQlpMnNfY29u
ZmlnX3JlZyB8PSBTSUk5MDJYX1RQSV9JMlNfV1NfUE9MQVJJVFlfSElHSDsKKworCWlmIChwYXJh
bXMtPmNoYW5uZWxzID4gMikKKwkJY29uZmlnX2J5dGUyX3JlZyB8PSBTSUk5MDJYX1RQSV9BVURJ
T19MQVlPVVRfOF9DSEFOTkVMUzsKKwllbHNlCisJCWNvbmZpZ19ieXRlMl9yZWcgfD0gU0lJOTAy
WF9UUElfQVVESU9fTEFZT1VUXzJfQ0hBTk5FTFM7CisKKwlzd2l0Y2ggKHBhcmFtcy0+c2FtcGxl
X3dpZHRoKSB7CisJY2FzZSAxNjoKKwkJY29uZmlnX2J5dGUzX3JlZyB8PSBTSUk5MDJYX1RQSV9B
VURJT19TQU1QTEVfU0laRV8xNjsKKwkJYnJlYWs7CisJY2FzZSAyMDoKKwkJY29uZmlnX2J5dGUz
X3JlZyB8PSBTSUk5MDJYX1RQSV9BVURJT19TQU1QTEVfU0laRV8yMDsKKwkJYnJlYWs7CisJY2Fz
ZSAyNDoKKwljYXNlIDMyOgorCQljb25maWdfYnl0ZTNfcmVnIHw9IFNJSTkwMlhfVFBJX0FVRElP
X1NBTVBMRV9TSVpFXzI0OworCQlicmVhazsKKwlkZWZhdWx0OgorCQlkZXZfZXJyKGRldiwgIiVz
OiBVbnN1cHBvcnRlZCBzYW1wbGUgd2lkdGggJXVcbiIsIF9fZnVuY19fLAorCQkJcGFyYW1zLT5z
YW1wbGVfd2lkdGgpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShzaWk5MDJ4X3NhbXBsZV9mcmVxKTsgaSsrKSB7CisJCWlmIChwYXJhbXMtPnNh
bXBsZV9yYXRlID09IHNpaTkwMnhfc2FtcGxlX2ZyZXFbaV0uZnJlcSkgeworCQkJY29uZmlnX2J5
dGUzX3JlZyB8PSBzaWk5MDJ4X3NhbXBsZV9mcmVxW2ldLnZhbDsKKwkJCWJyZWFrOworCQl9CisJ
fQorCisJcmV0ID0gY2xrX3ByZXBhcmVfZW5hYmxlKHNpaTkwMngtPmF1ZGlvLm1jbGspOworCWlm
IChyZXQpIHsKKwkJZGV2X2VycihkZXYsICJFbmFibGluZyBtY2xrIGZhaWxlZDogJWRcbiIsIHJl
dCk7CisJCXJldHVybiByZXQ7CisJfQorCisJbWNsa19yYXRlID0gY2xrX2dldF9yYXRlKHNpaTkw
MngtPmF1ZGlvLm1jbGspOworCisJcmV0ID0gc2lpOTAyeF9zZWxlY3RfbWNsa19kaXYoJmkyc19j
b25maWdfcmVnLCBwYXJhbXMtPnNhbXBsZV9yYXRlLAorCQkJCSAgICAgIG1jbGtfcmF0ZSk7CisJ
aWYgKG1jbGtfcmF0ZSAhPSByZXQgKiBwYXJhbXMtPnNhbXBsZV9yYXRlKQorCQlkZXZfZGJnKGRl
diwgIkluYWNjdXJhdGUgcmVmZXJlbmNlIGNsb2NrICglbGQvJWQgIT0gJXUpXG4iLAorCQkJbWNs
a19yYXRlLCByZXQsIHBhcmFtcy0+c2FtcGxlX3JhdGUpOworCisJbXV0ZXhfbG9jaygmc2lpOTAy
eC0+bXV0ZXgpOworCisJcmV0ID0gcmVnbWFwX3dyaXRlKHNpaTkwMngtPnJlZ21hcCwKKwkJCSAg
IFNJSTkwMlhfVFBJX0FVRElPX0NPTkZJR19CWVRFMl9SRUcsCisJCQkgICBjb25maWdfYnl0ZTJf
cmVnKTsKKwlpZiAocmV0IDwgMCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSByZWdtYXBfd3JpdGUo
c2lpOTAyeC0+cmVnbWFwLCBTSUk5MDJYX1RQSV9JMlNfSU5QVVRfQ09ORklHX1JFRywKKwkJCSAg
IGkyc19jb25maWdfcmVnKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCWZvciAoaSA9IDA7
IHNpaTkwMngtPmF1ZGlvLmkyc19maWZvX3NlcXVlbmNlW2ldICYmCisJCSAgICAgaSA8IEFSUkFZ
X1NJWkUoc2lpOTAyeC0+YXVkaW8uaTJzX2ZpZm9fc2VxdWVuY2UpOyBpKyspCisJCXJlZ21hcF93
cml0ZShzaWk5MDJ4LT5yZWdtYXAsCisJCQkgICAgIFNJSTkwMlhfVFBJX0kyU19FTkFCTEVfTUFQ
UElOR19SRUcsCisJCQkgICAgIHNpaTkwMngtPmF1ZGlvLmkyc19maWZvX3NlcXVlbmNlW2ldKTsK
KworCXJldCA9IHJlZ21hcF93cml0ZShzaWk5MDJ4LT5yZWdtYXAsIFNJSTkwMlhfVFBJX0FVRElP
X0NPTkZJR19CWVRFM19SRUcsCisJCQkgICBjb25maWdfYnl0ZTNfcmVnKTsKKwlpZiAocmV0KQor
CQlnb3RvIG91dDsKKworCXJldCA9IHJlZ21hcF9idWxrX3dyaXRlKHNpaTkwMngtPnJlZ21hcCwg
U0lJOTAyWF9UUElfSTJTX1NUUk1fSERSX0JBU0UsCisJCQkJcGFyYW1zLT5pZWMuc3RhdHVzLAor
CQkJCW1pbigoc2l6ZV90KSBTSUk5MDJYX1RQSV9JMlNfU1RSTV9IRFJfU0laRSwKKwkJCQkgICAg
c2l6ZW9mKHBhcmFtcy0+aWVjLnN0YXR1cykpKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKwor
CXJldCA9IGhkbWlfYXVkaW9faW5mb2ZyYW1lX3BhY2soJnBhcmFtcy0+Y2VhLCBpbmZvZnJhbWVf
YnVmLAorCQkJCQlzaXplb2YoaW5mb2ZyYW1lX2J1ZikpOworCWlmIChyZXQgPCAwKSB7CisJCWRl
dl9lcnIoZGV2LCAiJXM6IEZhaWxlZCB0byBwYWNrIGF1ZGlvIGluZm9mcmFtZTogJWRcbiIsCisJ
CQlfX2Z1bmNfXywgcmV0KTsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0gcmVnbWFwX2J1bGtf
d3JpdGUoc2lpOTAyeC0+cmVnbWFwLAorCQkJCVNJSTkwMlhfVFBJX01JU0NfSU5GT0ZSQU1FX0JB
U0UsCisJCQkJaW5mb2ZyYW1lX2J1ZiwKKwkJCQltaW4ocmV0LCBTSUk5MDJYX1RQSV9NSVNDX0lO
Rk9GUkFNRV9TSVpFKSk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwkvKiBEZWNvZGUgTGV2
ZWwgMCBQYWNrZXRzICovCisJcmV0ID0gcmVnbWFwX3dyaXRlKHNpaTkwMngtPnJlZ21hcCwgU0lJ
OTAyWF9JTkRfU0VUX1BBR0UsIDB4MDIpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0
ID0gcmVnbWFwX3dyaXRlKHNpaTkwMngtPnJlZ21hcCwgU0lJOTAyWF9JTkRfT0ZGU0VULCAweDI0
KTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IHJlZ21hcF93cml0ZShzaWk5MDJ4
LT5yZWdtYXAsIFNJSTkwMlhfSU5EX1ZBTFVFLCAweDAyKTsKKwlpZiAocmV0KQorCQlnb3RvIG91
dDsKKworCWRldl9kYmcoZGV2LCAiJXM6IGhkbWkgYXVkaW8gZW5hYmxlZFxuIiwgX19mdW5jX18p
Oworb3V0OgorCW11dGV4X3VubG9jaygmc2lpOTAyeC0+bXV0ZXgpOworCisJaWYgKHJldCkgewor
CQljbGtfZGlzYWJsZV91bnByZXBhcmUoc2lpOTAyeC0+YXVkaW8ubWNsayk7CisJCWRldl9lcnIo
ZGV2LCAiJXM6IGhkbWkgYXVkaW8gZW5hYmxlIGZhaWxlZDogJWRcbiIsIF9fZnVuY19fLAorCQkJ
cmV0KTsKKwl9CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgdm9pZCBzaWk5MDJ4X2F1ZGlv
X3NodXRkb3duKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3Qgc2lp
OTAyeCAqc2lpOTAyeCA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJbXV0ZXhfbG9jaygmc2lp
OTAyeC0+bXV0ZXgpOworCisJcmVnbWFwX3dyaXRlKHNpaTkwMngtPnJlZ21hcCwgU0lJOTAyWF9U
UElfQVVESU9fQ09ORklHX0JZVEUyX1JFRywKKwkJICAgICBTSUk5MDJYX1RQSV9BVURJT19JTlRF
UkZBQ0VfRElTQUJMRSk7CisKKwltdXRleF91bmxvY2soJnNpaTkwMngtPm11dGV4KTsKKworCWNs
a19kaXNhYmxlX3VucHJlcGFyZShzaWk5MDJ4LT5hdWRpby5tY2xrKTsKK30KKworaW50IHNpaTkw
MnhfYXVkaW9fZGlnaXRhbF9tdXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwgYm9v
bCBlbmFibGUpCit7CisJc3RydWN0IHNpaTkwMnggKnNpaTkwMnggPSBkZXZfZ2V0X2RydmRhdGEo
ZGV2KTsKKworCW11dGV4X2xvY2soJnNpaTkwMngtPm11dGV4KTsKKworCXNpaTkwMnhfbXV0ZShz
aWk5MDJ4LCBlbmFibGUpOworCisJbXV0ZXhfdW5sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBzaWk5MDJ4X2F1ZGlvX2dldF9lbGQoc3RydWN0IGRl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkJCSB1aW50OF90ICpidWYsIHNpemVfdCBsZW4pCit7
CisJc3RydWN0IHNpaTkwMnggKnNpaTkwMnggPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCW11
dGV4X2xvY2soJnNpaTkwMngtPm11dGV4KTsKKworCW1lbWNweShidWYsIHNpaTkwMngtPmNvbm5l
Y3Rvci5lbGQsCisJICAgICAgIG1pbihzaXplb2Yoc2lpOTAyeC0+Y29ubmVjdG9yLmVsZCksIGxl
bikpOworCisJbXV0ZXhfdW5sb2NrKCZzaWk5MDJ4LT5tdXRleCk7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBoZG1pX2NvZGVjX29wcyBzaWk5MDJ4X2F1ZGlvX2NvZGVj
X29wcyA9IHsKKwkuaHdfcGFyYW1zID0gc2lpOTAyeF9hdWRpb19od19wYXJhbXMsCisJLmF1ZGlv
X3NodXRkb3duID0gc2lpOTAyeF9hdWRpb19zaHV0ZG93biwKKwkuZGlnaXRhbF9tdXRlID0gc2lp
OTAyeF9hdWRpb19kaWdpdGFsX211dGUsCisJLmdldF9lbGQgPSBzaWk5MDJ4X2F1ZGlvX2dldF9l
bGQsCit9OworCitzdGF0aWMgaW50IHNpaTkwMnhfYXVkaW9fY29kZWNfaW5pdChzdHJ1Y3Qgc2lp
OTAyeCAqc2lpOTAyeCwKKwkJCQkgICAgc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0YXRpYyBj
b25zdCB1OCBhdWRpb19maWZvX2lkW10gPSB7CisJCVNJSTkwMlhfVFBJX0kyU19DT05GSUdfRklG
TzAsCisJCVNJSTkwMlhfVFBJX0kyU19DT05GSUdfRklGTzEsCisJCVNJSTkwMlhfVFBJX0kyU19D
T05GSUdfRklGTzIsCisJCVNJSTkwMlhfVFBJX0kyU19DT05GSUdfRklGTzMsCisJfTsKKwlzdGF0
aWMgY29uc3QgdTggaTJzX2xhbmVfaWRbXSA9IHsKKwkJU0lJOTAyWF9UUElfSTJTX1NFTEVDVF9T
RDAsCisJCVNJSTkwMlhfVFBJX0kyU19TRUxFQ1RfU0QxLAorCQlTSUk5MDJYX1RQSV9JMlNfU0VM
RUNUX1NEMiwKKwkJU0lJOTAyWF9UUElfSTJTX1NFTEVDVF9TRDMsCisJfTsKKwlzdHJ1Y3QgaGRt
aV9jb2RlY19wZGF0YSBjb2RlY19kYXRhID0geworCQkub3BzID0gJnNpaTkwMnhfYXVkaW9fY29k
ZWNfb3BzLAorCQkuaTJzID0gMSwgLyogT25seSBpMnMgc3VwcG9ydCBmb3Igbm93LiAqLworCQku
c3BkaWYgPSAwLAorCQkubWF4X2kyc19jaGFubmVscyA9IDAsCisJfTsKKwl1OCBsYW5lc1s0XTsK
Kwl1MzIgbnVtX2xhbmVzLCBpOworCisJaWYgKCFvZl9wcm9wZXJ0eV9yZWFkX2Jvb2woZGV2LT5v
Zl9ub2RlLCAiI3NvdW5kLWRhaS1jZWxscyIpKSB7CisJCWRldl9kYmcoZGV2LCAiJXM6IE5vIFwi
I3NvdW5kLWRhaS1jZWxsc1wiLCBubyBhdWRpb1xuIiwKKwkJCV9fZnVuY19fKTsKKwkJcmV0dXJu
IDA7CisJfQorCisJbnVtX2xhbmVzID0gb2ZfcHJvcGVydHlfcmVhZF92YXJpYWJsZV91OF9hcnJh
eShkZXYtPm9mX25vZGUsCisJCQkJCQkgICAgICAgInNpbCxpMnMtZGF0YS1sYW5lcyIsCisJCQkJ
CQkgICAgICAgbGFuZXMsIDEsCisJCQkJCQkgICAgICAgQVJSQVlfU0laRShsYW5lcykpOworCisJ
aWYgKG51bV9sYW5lcyA9PSAtRUlOVkFMKSB7CisJCWRldl9kYmcoZGV2LAorCQkJIiVzOiBObyBc
InNpbCxpMnMtZGF0YS1sYW5lc1wiLCB1c2UgZGVmYXVsdCA8MD5cbiIsCisJCQlfX2Z1bmNfXyk7
CisJCW51bV9sYW5lcyA9IDE7CisJCWxhbmVzWzBdID0gMDsKKwl9IGVsc2UgaWYgKG51bV9sYW5l
cyA8IDApIHsKKwkJZGV2X2VycihkZXYsCisJCQkiJXM6IEVycm9yIGdldHRpbiBcInNpbCxpMnMt
ZGF0YS1sYW5lc1wiOiAlZFxuIiwKKwkJCV9fZnVuY19fLCBudW1fbGFuZXMpOworCQlyZXR1cm4g
bnVtX2xhbmVzOworCX0KKwljb2RlY19kYXRhLm1heF9pMnNfY2hhbm5lbHMgPSAyICogbnVtX2xh
bmVzOworCisJZm9yIChpID0gMDsgaSA8IG51bV9sYW5lczsgaSsrKQorCQlzaWk5MDJ4LT5hdWRp
by5pMnNfZmlmb19zZXF1ZW5jZVtpXSB8PSBhdWRpb19maWZvX2lkW2ldIHwKKwkJCWkyc19sYW5l
X2lkW2xhbmVzW2ldXSB8CVNJSTkwMlhfVFBJX0kyU19GSUZPX0VOQUJMRTsKKworCWlmIChJU19F
UlIoc2lpOTAyeC0+YXVkaW8ubWNsaykpIHsKKwkJZGV2X2VycihkZXYsICIlczogTm8gY2xvY2sg
KGF1ZGlvIG1jbGspIGZvdW5kOiAlbGRcbiIsCisJCQlfX2Z1bmNfXywgUFRSX0VSUihzaWk5MDJ4
LT5hdWRpby5tY2xrKSk7CisJCXJldHVybiAwOworCX0KKworCXNpaTkwMngtPmF1ZGlvLnBkZXYg
PSBwbGF0Zm9ybV9kZXZpY2VfcmVnaXN0ZXJfZGF0YSgKKwkJZGV2LCBIRE1JX0NPREVDX0RSVl9O
QU1FLCBQTEFURk9STV9ERVZJRF9BVVRPLAorCQkmY29kZWNfZGF0YSwgc2l6ZW9mKGNvZGVjX2Rh
dGEpKTsKKworCXJldHVybiBQVFJfRVJSX09SX1pFUk8oc2lpOTAyeC0+YXVkaW8ucGRldik7Cit9
CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgcmVnbWFwX3JhbmdlIHNpaTkwMnhfdm9sYXRpbGVfcmFu
Z2VzW10gPSB7CiAJeyAucmFuZ2VfbWluID0gMCwgLnJhbmdlX21heCA9IDB4ZmYgfSwKIH07CkBA
IC0zMzgsNiArNzg1LDggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCByZWdtYXBfYWNjZXNzX3RhYmxl
IHNpaTkwMnhfdm9sYXRpbGVfdGFibGUgPSB7CiBzdGF0aWMgY29uc3Qgc3RydWN0IHJlZ21hcF9j
b25maWcgc2lpOTAyeF9yZWdtYXBfY29uZmlnID0gewogCS5yZWdfYml0cyA9IDgsCiAJLnZhbF9i
aXRzID0gOCwKKwkuZGlzYWJsZV9sb2NraW5nID0gdHJ1ZSwgLyogc3RydWN0IHNpaTkwMnggbXV0
ZXggc2hvdWxkIGJlIGVub3VnaCAqLworCS5tYXhfcmVnaXN0ZXIgPSBTSUk5MDJYX1RQSV9NSVND
X0lORk9GUkFNRV9FTkQsCiAJLnZvbGF0aWxlX3RhYmxlID0gJnNpaTkwMnhfdm9sYXRpbGVfdGFi
bGUsCiAJLmNhY2hlX3R5cGUgPSBSRUdDQUNIRV9OT05FLAogfTsKQEAgLTM0Nyw5ICs3OTYsMTMg
QEAgc3RhdGljIGlycXJldHVybl90IHNpaTkwMnhfaW50ZXJydXB0KGludCBpcnEsIHZvaWQgKmRh
dGEpCiAJc3RydWN0IHNpaTkwMnggKnNpaTkwMnggPSBkYXRhOwogCXVuc2lnbmVkIGludCBzdGF0
dXMgPSAwOwogCisJbXV0ZXhfbG9jaygmc2lpOTAyeC0+bXV0ZXgpOworCiAJcmVnbWFwX3JlYWQo
c2lpOTAyeC0+cmVnbWFwLCBTSUk5MDJYX0lOVF9TVEFUVVMsICZzdGF0dXMpOwogCXJlZ21hcF93
cml0ZShzaWk5MDJ4LT5yZWdtYXAsIFNJSTkwMlhfSU5UX1NUQVRVUywgc3RhdHVzKTsKIAorCW11
dGV4X3VubG9jaygmc2lpOTAyeC0+bXV0ZXgpOworCiAJaWYgKChzdGF0dXMgJiBTSUk5MDJYX0hP
VFBMVUdfRVZFTlQpICYmIHNpaTkwMngtPmJyaWRnZS5kZXYpCiAJCWRybV9oZWxwZXJfaHBkX2ly
cV9ldmVudChzaWk5MDJ4LT5icmlkZ2UuZGV2KTsKIApAQCAtNTEwLDYgKzk2Myw4IEBAIHN0YXRp
YyBpbnQgc2lpOTAyeF9wcm9iZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50LAogCQlyZXR1cm4g
UFRSX0VSUihzaWk5MDJ4LT5yZXNldF9ncGlvKTsKIAl9CiAKKwltdXRleF9pbml0KCZzaWk5MDJ4
LT5tdXRleCk7CisKIAlzaWk5MDJ4X3Jlc2V0KHNpaTkwMngpOwogCiAJcmV0ID0gcmVnbWFwX3dy
aXRlKHNpaTkwMngtPnJlZ21hcCwgU0lJOTAyWF9SRUdfVFBJX1JRQiwgMHgwKTsKQEAgLTU1MCw2
ICsxMDA1LDggQEAgc3RhdGljIGludCBzaWk5MDJ4X3Byb2JlKHN0cnVjdCBpMmNfY2xpZW50ICpj
bGllbnQsCiAJc2lpOTAyeC0+YnJpZGdlLnRpbWluZ3MgPSAmZGVmYXVsdF9zaWk5MDJ4X3RpbWlu
Z3M7CiAJZHJtX2JyaWRnZV9hZGQoJnNpaTkwMngtPmJyaWRnZSk7CiAKKwlzaWk5MDJ4X2F1ZGlv
X2NvZGVjX2luaXQoc2lpOTAyeCwgZGV2KTsKKwogCWkyY19zZXRfY2xpZW50ZGF0YShjbGllbnQs
IHNpaTkwMngpOwogCiAJc2lpOTAyeC0+aTJjbXV4ID0gaTJjX211eF9hbGxvYyhjbGllbnQtPmFk
YXB0ZXIsIGRldiwKLS0gClRleGFzIEluc3RydW1lbnRzIEZpbmxhbmQgT3ksIFBvcmtrYWxhbmth
dHUgMjIsIDAwMTgwIEhlbHNpbmtpLiBZLXR1bm51cy9CdXNpbmVzcyBJRDogMDYxNTUyMS00LiBL
b3RpcGFpa2thL0RvbWljaWxlOiBIZWxzaW5raQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
