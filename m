Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A7B9FC01F6
	for <lists+dri-devel@lfdr.de>; Fri, 27 Sep 2019 11:13:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D69B6EEC6;
	Fri, 27 Sep 2019 09:13:09 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 684886EEC6
 for <dri-devel@lists.freedesktop.org>; Fri, 27 Sep 2019 09:13:06 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 485F5AFE3;
 Fri, 27 Sep 2019 09:13:04 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@linux.ie,
	daniel@ffwll.ch,
	kraxel@redhat.com,
	sam@ravnborg.org
Subject: [PATCH v3 5/7] drm/mgag200: Move cursor BO swapping into
 mgag200_show_cursor()
Date: Fri, 27 Sep 2019 11:12:59 +0200
Message-Id: <20190927091301.10574-6-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190927091301.10574-1-tzimmermann@suse.de>
References: <20190927091301.10574-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2VsZWN0aW5nIHRoZSBjb3JyZWN0IEJPIGZvciB0aGUgbmV3IGN1cnNvciBpbWFnZSBpcyBub3Qg
cmVsZXZhbnQKb3V0c2lkZSBvZiBtZ2FnMjAwX3Nob3dfY3Vyc29yKCkuIExldCB0aGUgZnVuY3Rp
b24gZG8gdGhlIHdvcmsuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1l
cm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2N1cnNv
ci5jIHwgMTIwICsrKysrKysrKysrLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNTYgaW5z
ZXJ0aW9ucygrKSwgNjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L21nYWcyMDAvbWdhZzIwMF9jdXJzb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcy
MDBfY3Vyc29yLmMKaW5kZXggNWZjNDdhYjBlOGZkLi5lZDY5YjM5NmFjMDIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfY3Vyc29yLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL21nYWcyMDAvbWdhZzIwMF9jdXJzb3IuYwpAQCAtMTE2LDIxICsxMTYsNjkgQEAgc3Rh
dGljIHZvaWQgbWdhZzIwMF9jdXJzb3Jfc2V0X2Jhc2Uoc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYs
IHU2NCBhZGRyZXNzKQogCVdSRUdfREFDKE1HQTEwNjRfQ1VSU09SX0JBU0VfQURSX0hJLCBhZGRy
aCk7CiB9CiAKLXN0YXRpYyBpbnQgbWdhZzIwMF9zaG93X2N1cnNvcihzdHJ1Y3QgbWdhX2Rldmlj
ZSAqbWRldiwgdm9pZCAqZHN0LCB2b2lkICpzcmMsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IHdp
ZHRoLCB1bnNpZ25lZCBpbnQgaGVpZ2h0LAotCQkJICAgICAgIHU2NCBkc3RfZ3B1KQorc3RhdGlj
IGludCBtZ2FnMjAwX3Nob3dfY3Vyc29yKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2LCB2b2lkICpz
cmMsCisJCQkgICAgICAgdW5zaWduZWQgaW50IHdpZHRoLCB1bnNpZ25lZCBpbnQgaGVpZ2h0KQog
eworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBtZGV2LT5kZXY7CisJc3RydWN0IGRybV9nZW1f
dnJhbV9vYmplY3QgKnBpeGVsc18xID0gbWRldi0+Y3Vyc29yLnBpeGVsc18xOworCXN0cnVjdCBk
cm1fZ2VtX3ZyYW1fb2JqZWN0ICpwaXhlbHNfMiA9IG1kZXYtPmN1cnNvci5waXhlbHNfMjsKKwlz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqcGl4ZWxzX2N1cnJlbnQgPSBtZGV2LT5jdXJzb3Iu
cGl4ZWxzX2N1cnJlbnQ7CisJc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKnBpeGVsc19uZXh0
OworCXZvaWQgKmRzdDsKKwlzNjQgb2ZmOwogCWludCByZXQ7CiAKKwlpZiAoIXBpeGVsc18xIHx8
ICFwaXhlbHNfMikgeworCQlXUkVHOChNR0FfQ1VSUE9TWEwsIDApOworCQlXUkVHOChNR0FfQ1VS
UE9TWEgsIDApOworCQlyZXR1cm4gLUVOT1RTVVBQOyAvKiBEaWRuJ3QgYWxsb2NhdGUgc3BhY2Ug
Zm9yIGN1cnNvcnMgKi8KKwl9CisKKwlpZiAoV0FSTl9PTihwaXhlbHNfY3VycmVudCAmJgorCQkg
ICAgcGl4ZWxzXzEgIT0gcGl4ZWxzX2N1cnJlbnQgJiYKKwkJICAgIHBpeGVsc18yICE9IHBpeGVs
c19jdXJyZW50KSkgeworCQlyZXR1cm4gLUVOT1RTVVBQOyAvKiBpbmNvbnNpc3RlbnQgc3RhdGUg
Ki8KKwl9CisKKwlpZiAocGl4ZWxzX2N1cnJlbnQgPT0gcGl4ZWxzXzEpCisJCXBpeGVsc19uZXh0
ID0gcGl4ZWxzXzI7CisJZWxzZQorCQlwaXhlbHNfbmV4dCA9IHBpeGVsc18xOworCisJZHN0ID0g
ZHJtX2dlbV92cmFtX3ZtYXAocGl4ZWxzX25leHQpOworCWlmIChJU19FUlIoZHN0KSkgeworCQly
ZXQgPSBQVFJfRVJSKGRzdCk7CisJCWRldl9lcnIoJmRldi0+cGRldi0+ZGV2LAorCQkJImZhaWxl
ZCB0byBtYXAgY3Vyc29yIHVwZGF0ZXM6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0K
KwlvZmYgPSBkcm1fZ2VtX3ZyYW1fb2Zmc2V0KHBpeGVsc19uZXh0KTsKKwlpZiAob2ZmIDwgMCkg
eworCQlyZXQgPSAoaW50KW9mZjsKKwkJZGV2X2VycigmZGV2LT5wZGV2LT5kZXYsCisJCQkiZmFp
bGVkIHRvIGdldCBjdXJzb3Igc2Nhbm91dCBhZGRyZXNzOiAlZFxuIiwgcmV0KTsKKwkJZ290byBl
cnJfZHJtX2dlbV92cmFtX3Z1bm1hcDsKKwl9CisKIAlyZXQgPSBtZ2FnMjAwX2N1cnNvcl91cGRh
dGUobWRldiwgZHN0LCBzcmMsIHdpZHRoLCBoZWlnaHQpOwogCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0JbWdhZzIwMF9jdXJzb3Jfc2V0X2Jhc2UobWRldiwgZHN0X2dwdSk7CisJCWdvdG8gZXJy
X2RybV9nZW1fdnJhbV92dW5tYXA7CisJbWdhZzIwMF9jdXJzb3Jfc2V0X2Jhc2UobWRldiwgb2Zm
KTsKIAogCS8qIEFkanVzdCBjdXJzb3IgY29udHJvbCByZWdpc3RlciB0byB0dXJuIG9uIHRoZSBj
dXJzb3IgKi8KIAlXUkVHX0RBQyhNR0ExMDY0X0NVUlNPUl9DVEwsIDQpOyAvKiAxNi1jb2xvdXIg
cGFsbGV0aXplZCBjdXJzb3IgbW9kZSAqLwogCisJaWYgKHBpeGVsc19jdXJyZW50KQorCQlkcm1f
Z2VtX3ZyYW1fdW5waW4ocGl4ZWxzX2N1cnJlbnQpOworCW1kZXYtPmN1cnNvci5waXhlbHNfY3Vy
cmVudCA9IHBpeGVsc19uZXh0OworCisJZHJtX2dlbV92cmFtX3Z1bm1hcChwaXhlbHNfbmV4dCwg
ZHN0KTsKKwogCXJldHVybiAwOworCitlcnJfZHJtX2dlbV92cmFtX3Z1bm1hcDoKKwlkcm1fZ2Vt
X3ZyYW1fdnVubWFwKHBpeGVsc19uZXh0LCBkc3QpOworCXJldHVybiByZXQ7CiB9CiAKIC8qCkBA
IC0xOTcsMjggKzI0NSwxMCBAQCBpbnQgbWdhZzIwMF9jcnRjX2N1cnNvcl9zZXQoc3RydWN0IGRy
bV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwKIHsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2OwogCXN0cnVjdCBtZ2FfZGV2aWNlICptZGV2ID0gKHN0
cnVjdCBtZ2FfZGV2aWNlICopZGV2LT5kZXZfcHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2dlbV92cmFt
X29iamVjdCAqcGl4ZWxzXzEgPSBtZGV2LT5jdXJzb3IucGl4ZWxzXzE7Ci0Jc3RydWN0IGRybV9n
ZW1fdnJhbV9vYmplY3QgKnBpeGVsc18yID0gbWRldi0+Y3Vyc29yLnBpeGVsc18yOwotCXN0cnVj
dCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpwaXhlbHNfY3VycmVudCA9IG1kZXYtPmN1cnNvci5waXhl
bHNfY3VycmVudDsKLQlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqcGl4ZWxzX25leHQ7CiAJ
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3Qg
KmdibyA9IE5VTEw7CiAJaW50IHJldDsKLQl1OCAqc3JjLCAqZHN0OwotCXM2NCBncHVfYWRkcjsK
LQl1NjQgZHN0X2dwdTsKLQotCWlmICghcGl4ZWxzXzEgfHwgIXBpeGVsc18yKSB7Ci0JCVdSRUc4
KE1HQV9DVVJQT1NYTCwgMCk7Ci0JCVdSRUc4KE1HQV9DVVJQT1NYSCwgMCk7Ci0JCXJldHVybiAt
RU5PVFNVUFA7IC8qIERpZG4ndCBhbGxvY2F0ZSBzcGFjZSBmb3IgY3Vyc29ycyAqLwotCX0KLQot
CWlmIChXQVJOX09OKHBpeGVsc19jdXJyZW50ICYmCi0JCSAgICBwaXhlbHNfMSAhPSBwaXhlbHNf
Y3VycmVudCAmJgotCQkgICAgcGl4ZWxzXzIgIT0gcGl4ZWxzX2N1cnJlbnQpKSB7Ci0JCXJldHVy
biAtRU5PVFNVUFA7IC8qIGluY29uc2lzdGVudCBzdGF0ZSAqLwotCX0KKwl1OCAqc3JjOwogCiAJ
aWYgKCFoYW5kbGUgfHwgIWZpbGVfcHJpdikgewogCQltZ2FnMjAwX2hpZGVfY3Vyc29yKG1kZXYp
OwpAQCAtMjMxLDExICsyNjEsNiBAQCBpbnQgbWdhZzIwMF9jcnRjX2N1cnNvcl9zZXQoc3RydWN0
IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwKIAkJcmV0dXJuIC1F
SU5WQUw7CiAJfQogCi0JaWYgKHBpeGVsc19jdXJyZW50ID09IHBpeGVsc18xKQotCQlwaXhlbHNf
bmV4dCA9IHBpeGVsc18yOwotCWVsc2UKLQkJcGl4ZWxzX25leHQgPSBwaXhlbHNfMTsKLQogCW9i
aiA9IGRybV9nZW1fb2JqZWN0X2xvb2t1cChmaWxlX3ByaXYsIGhhbmRsZSk7CiAJaWYgKCFvYmop
CiAJCXJldHVybiAtRU5PRU5UOwpAQCAtMjQ4LDQ4ICsyNzMsMTUgQEAgaW50IG1nYWcyMDBfY3J0
Y19jdXJzb3Jfc2V0KHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9maWxlICpmaWxl
X3ByaXYsCiAJCWdvdG8gZXJyX2RybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZDsKIAl9CiAKLQkv
KiBQaW4gYW5kIG1hcCB1cC1jb21pbmcgYnVmZmVyIHRvIHdyaXRlIGNvbG91ciBpbmRpY2VzICov
Ci0JcmV0ID0gZHJtX2dlbV92cmFtX3BpbihwaXhlbHNfbmV4dCwgRFJNX0dFTV9WUkFNX1BMX0ZM
QUdfVlJBTSk7Ci0JaWYgKHJldCkgewotCQlkZXZfZXJyKCZkZXYtPnBkZXYtPmRldiwKLQkJCSJm
YWlsZWQgdG8gcGluIGN1cnNvciBidWZmZXI6ICVkXG4iLCByZXQpOwotCQlnb3RvIGVycl9kcm1f
Z2VtX3ZyYW1fdnVubWFwOwotCX0KLQlkc3QgPSBkcm1fZ2VtX3ZyYW1fa21hcChwaXhlbHNfbmV4
dCwgdHJ1ZSwgTlVMTCk7Ci0JaWYgKElTX0VSUihkc3QpKSB7Ci0JCXJldCA9IFBUUl9FUlIoZHN0
KTsKLQkJZGV2X2VycigmZGV2LT5wZGV2LT5kZXYsCi0JCQkiZmFpbGVkIHRvIGttYXAgY3Vyc29y
IHVwZGF0ZXM6ICVkXG4iLCByZXQpOwotCQlnb3RvIGVycl9kcm1fZ2VtX3ZyYW1fdW5waW5fZHN0
OwotCX0KLQlncHVfYWRkciA9IGRybV9nZW1fdnJhbV9vZmZzZXQocGl4ZWxzX25leHQpOwotCWlm
IChncHVfYWRkciA8IDApIHsKLQkJcmV0ID0gKGludClncHVfYWRkcjsKLQkJZGV2X2VycigmZGV2
LT5wZGV2LT5kZXYsCi0JCQkiZmFpbGVkIHRvIGdldCBjdXJzb3Igc2Nhbm91dCBhZGRyZXNzOiAl
ZFxuIiwgcmV0KTsKLQkJZ290byBlcnJfZHJtX2dlbV92cmFtX2t1bm1hcF9kc3Q7Ci0JfQotCWRz
dF9ncHUgPSAodTY0KWdwdV9hZGRyOwotCi0JcmV0ID0gbWdhZzIwMF9zaG93X2N1cnNvcihtZGV2
LCBkc3QsIHNyYywgd2lkdGgsIGhlaWdodCwgZHN0X2dwdSk7CisJcmV0ID0gbWdhZzIwMF9zaG93
X2N1cnNvcihtZGV2LCBzcmMsIHdpZHRoLCBoZWlnaHQpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJy
X2RybV9nZW1fdnJhbV9rdW5tYXBfZHN0OworCQlnb3RvIGVycl9kcm1fZ2VtX3ZyYW1fdnVubWFw
OwogCiAJLyogTm93IHVwZGF0ZSBpbnRlcm5hbCBidWZmZXIgcG9pbnRlcnMgKi8KLQlpZiAocGl4
ZWxzX2N1cnJlbnQpCi0JCWRybV9nZW1fdnJhbV91bnBpbihwaXhlbHNfY3VycmVudCk7Ci0JbWRl
di0+Y3Vyc29yLnBpeGVsc19jdXJyZW50ID0gcGl4ZWxzX25leHQ7Ci0KLQlkcm1fZ2VtX3ZyYW1f
a3VubWFwKHBpeGVsc19uZXh0KTsKIAlkcm1fZ2VtX3ZyYW1fdnVubWFwKGdibywgc3JjKTsKIAlk
cm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQob2JqKTsKIAogCXJldHVybiAwOwotCi1lcnJfZHJt
X2dlbV92cmFtX2t1bm1hcF9kc3Q6Ci0JZHJtX2dlbV92cmFtX2t1bm1hcChwaXhlbHNfbmV4dCk7
Ci1lcnJfZHJtX2dlbV92cmFtX3VucGluX2RzdDoKLQlkcm1fZ2VtX3ZyYW1fdW5waW4ocGl4ZWxz
X25leHQpOwogZXJyX2RybV9nZW1fdnJhbV92dW5tYXA6CiAJZHJtX2dlbV92cmFtX3Z1bm1hcChn
Ym8sIHNyYyk7CiBlcnJfZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkOgotLSAKMi4yMy4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
