Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 36E7EABFC9
	for <lists+dri-devel@lfdr.de>; Fri,  6 Sep 2019 20:47:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B51196E103;
	Fri,  6 Sep 2019 18:47:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x542.google.com (mail-pg1-x542.google.com
 [IPv6:2607:f8b0:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D89DF6E0C9
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Sep 2019 18:47:25 +0000 (UTC)
Received: by mail-pg1-x542.google.com with SMTP id u72so3949312pgb.10
 for <dri-devel@lists.freedesktop.org>; Fri, 06 Sep 2019 11:47:25 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=KVL9YJVaN0K/3JG0n0LztVYzncreOeCUAfx3hVIPBEE=;
 b=JN61IyTekFfQbyL4B/JVvU2kTVQzygENpCAiE+FpyaPwu8hgZ2zPOf4+1HaQwU22Mi
 klaq9QhjHGokt40TB0FMibPDX7xBkqFhCPK9w2hrZ/u1utQWig1O2FE+IsxJgvBrhbo2
 YasO8J7jQzFQIhqhlZBHkhuu0ExZCvqdsifzSDxENQ2nnI8am0atISMJB10cmPXSmCoa
 rkJWpihM3m7aG2sZQ4VNX4Xdt2qKDt7BsMvi3asWjuzCmxbgANg1bXhVvRJEDuUp4CHl
 wxMhh818x2GBjVLsXc+06h81gjjxT6+C0PFQ911UKPUUBcF6ARnsBLIHP4b3ZREp9fDh
 HDEw==
X-Gm-Message-State: APjAAAU5fXlzvCJYqRWCGcYPsG9cCe7wTd63a3eIKg+khigqWoNHSEdV
 N4Dwd8kL+nz4t7sPL66AtTvklw==
X-Google-Smtp-Source: APXvYqz4chd2+REgJXKkbAm91TfTsmVUh8s+TgHZrTjx22wJQ7vV7AKnnRBLZABU6JHj6U3AJj8P8w==
X-Received: by 2002:aa7:98d2:: with SMTP id e18mr12497884pfm.188.1567795645292; 
 Fri, 06 Sep 2019 11:47:25 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 o35sm4889462pgm.29.2019.09.06.11.47.23
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 06 Sep 2019 11:47:24 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RESEND][PATCH v8 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Fri,  6 Sep 2019 18:47:11 +0000
Message-Id: <20190906184712.91980-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190906184712.91980-1-john.stultz@linaro.org>
References: <20190906184712.91980-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=KVL9YJVaN0K/3JG0n0LztVYzncreOeCUAfx3hVIPBEE=;
 b=ra6TFRdOwZNDHqi6K59QZDCyIhFQ4519NA11YqiBRehn86tktRkIl/FKQAhB9wAf9S
 OfIlTPkfRJA5sv/Krh1+hjLkd92l7f5WoSDKsY8ZmS5TjnWMd3xYZycYOvYR61Xk+RA9
 Fs5V0PVHEZokyx/Ja5JXliNTeHZXOAxBGSfYphio+7xjWkUqbdyuJA9oBbHAhSVXzR69
 MHgAA45auLxnMB7dN5L02XdBotK19s7hGAXR2yDKH9TRCdlo1u8fQp0LmK6A1vKna8AD
 i16fvpDm15fbIgr1zZ5aS87kvaFkI3+xl+BlBThcjxlRQA5aeTSrVBUMOmzQMC1U9olI
 G+0g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKQ2M6IExhdXJhIEFiYm90
dCA8bGFiYm90dEByZWRoYXQuY29tPgpDYzogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdh
aWduYXJkQGxpbmFyby5vcmc+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8u
b3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IFByYXRpayBQYXRl
bCA8cHJhdGlrcEBjb2RlYXVyb3JhLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IFZpbmNlbnQgRG9ubmVmb3J0IDxWaW5jZW50LkRvbm5lZm9ydEBhcm0u
Y29tPgpDYzogU3VkaXB0byBQYXVsIDxTdWRpcHRvLlBhdWxAYXJtLmNvbT4KQ2M6IEFuZHJldyBG
LiBEYXZpcyA8YWZkQHRpLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFk
Lm9yZz4KQ2M6IENoZW5ibyBGZW5nIDxmZW5nY0Bnb29nbGUuY29tPgpDYzogQWxpc3RhaXIgU3Ry
YWNoYW4gPGFzdHJhY2hhbkBnb29nbGUuY29tPgpDYzogSHJpZHlhIFZhbHNhcmFqdSA8aHJpZHlh
QGdvb2dsZS5jb20+CkNjOiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClJldmlld2Vk
LWJ5OiBCZW5qYW1pbiBHYWlnbmFyZCA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4KU2ln
bmVkLW9mZi1ieTogSm9obiBTdHVsdHogPGpvaG4uc3R1bHR6QGxpbmFyby5vcmc+Ci0tLQp2MjoK
KiBTd2l0Y2ggYWxsb2NhdGUgdG8gcmV0dXJuIGRtYWJ1ZiBmZAoqIFNpbXBsaWZ5IGluaXQgY29k
ZQoqIENoZWNrcGF0Y2ggZml4dXBzCnYzOgoqIFN3aXRjaCB0byBpbmxpbmUgZnVuY3Rpb24gZm9y
IHRvX2NtYV9oZWFwKCkKKiBNaW5vciBjbGVhbnVwcyBzdWdnZXN0ZWQgYnkgQnJpYW4KKiBGb2xk
IGluIG5ldyByZWdpc3RyYXRpb24gc3R5bGUgZnJvbSBBbmRyZXcKKiBGb2xkZWQgaW4gY2hhbmdl
cyBmcm9tIEFuZHJldyB0byB1c2Ugc2ltcGxpZmllZCBwYWdlIGxpc3QKICBmcm9tIHRoZSBoZWFw
IGhlbHBlcnMKdjQ6CiogVXNlIHRoZSBmZF9mbGFncyB3aGVuIGNyZWF0aW5nIGRtYWJ1ZiBmZCAo
U3VnZ2VzdGVkIGJ5CiAgQmVuamFtaW4pCiogVXNlIHByZWNhbGN1bGF0ZWQgcGFnZWNvdW50IChT
dWdnZXN0ZWQgYnkgQW5kcmV3KQp2NjoKKiBDaGFuZ2VkIHZhcmlhYmxlIG5hbWVzIHRvIGltcHJv
dmUgY2xhcml0eSwgYXMgc3VnZ2VzdGVkCiAgYnkgQnJpYW4Kdjc6CiogVXNlIG5ld2x5IGxvd2Vy
LWNhc2VkIGluaXRfaGVhcF9oZWxwZXJfYnVmZmVyIGhlbHBlcgoqIFVzZSBuZXcgZG1hYnVmIGV4
cG9ydCBoZWxwZXIKdjg6CiogTWFrZSBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNvbnN0IChTdWdnZXN0
ZWQgYnkgQ2hyaXN0b3BoKQoqIENvbmRlbnNlIGRtYV9oZWFwX2J1ZmZlciBhbmQgaGVhcF9oZWxw
ZXJfYnVmZmVyIChzdWdnZXN0ZWQgYnkKICBDaHJpc3RvcGgpCiogQ2hlY2twYXRjaCB3aGl0ZXNw
YWNlIGZpeHVwcwotLS0KIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnICAgIHwgICA4ICsr
CiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1i
dWYvaGVhcHMvY21hX2hlYXAuYyB8IDE2NCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
CiAzIGZpbGVzIGNoYW5nZWQsIDE3MyBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Rt
YS1idWYvaGVhcHMvS2NvbmZpZyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmluZGV4
IDIwNTA1Mjc0NDE2OS4uYTVlZWYwNmM0MjI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYv
aGVhcHMvS2NvbmZpZworKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAtNCwz
ICs0LDExIEBAIGNvbmZpZyBETUFCVUZfSEVBUFNfU1lTVEVNCiAJaGVscAogCSAgQ2hvb3NlIHRo
aXMgb3B0aW9uIHRvIGVuYWJsZSB0aGUgc3lzdGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhl
YXAKIAkgIGlzIGJhY2tlZCBieSBwYWdlcyBmcm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGlu
IGRvdWJ0LCBzYXkgWS4KKworY29uZmlnIERNQUJVRl9IRUFQU19DTUEKKwlib29sICJETUEtQlVG
IENNQSBIZWFwIgorCWRlcGVuZHMgb24gRE1BQlVGX0hFQVBTICYmIERNQV9DTUEKKwloZWxwCisJ
ICBDaG9vc2UgdGhpcyBvcHRpb24gdG8gZW5hYmxlIGRtYS1idWYgQ01BIGhlYXAuIFRoaXMgaGVh
cCBpcyBiYWNrZWQKKwkgIGJ5IHRoZSBDb250aWd1b3VzIE1lbW9yeSBBbGxvY2F0b3IgKENNQSku
IElmIHlvdXIgc3lzdGVtIGhhcyB0aGVzZQorCSAgcmVnaW9ucywgeW91IHNob3VsZCBzYXkgWSBo
ZXJlLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlIGIvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCmluZGV4IGQxODA4ZWNhMjU4MS4uNmU1NGNkZWMzZGEw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFrZWZpbGUKKysrIGIvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCkBAIC0xLDMgKzEsNCBAQAogIyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMAogb2JqLXkJCQkJCSs9IGhlYXAtaGVscGVycy5vCiBvYmotJChD
T05GSUdfRE1BQlVGX0hFQVBTX1NZU1RFTSkJKz0gc3lzdGVtX2hlYXAubworb2JqLSQoQ09ORklH
X0RNQUJVRl9IRUFQU19DTUEpCQkrPSBjbWFfaGVhcC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2Rt
YS1idWYvaGVhcHMvY21hX2hlYXAuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5j
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYjhmNjdiN2M2YTVjCi0t
LSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMKQEAgLTAs
MCArMSwxNjQgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICog
RE1BQlVGIENNQSBoZWFwIGV4cG9ydGVyCisgKgorICogQ29weXJpZ2h0IChDKSAyMDEyLCAyMDE5
IExpbmFybyBMdGQuCisgKiBBdXRob3I6IDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPiBm
b3IgU1QtRXJpY3Nzb24uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorI2luY2x1
ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtaGVhcC5oPgorI2luY2x1
ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRlIDxsaW51eC9lcnJuby5oPgorI2luY2x1ZGUgPGxp
bnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4L2NtYS5oPgorI2luY2x1ZGUgPGxpbnV4L3NjYXR0
ZXJsaXN0Lmg+CisjaW5jbHVkZSA8bGludXgvaGlnaG1lbS5oPgorCisjaW5jbHVkZSAiaGVhcC1o
ZWxwZXJzLmgiCisKK3N0cnVjdCBjbWFfaGVhcCB7CisJc3RydWN0IGRtYV9oZWFwICpoZWFwOwor
CXN0cnVjdCBjbWEgKmNtYTsKK307CisKK3N0YXRpYyB2b2lkIGNtYV9oZWFwX2ZyZWUoc3RydWN0
IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hl
YXAgPSBkbWFfaGVhcF9nZXRfZGF0YShidWZmZXItPmhlYXApOworCXVuc2lnbmVkIGxvbmcgbnJf
cGFnZXMgPSBidWZmZXItPnBhZ2Vjb3VudDsKKwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzID0gYnVm
ZmVyLT5wcml2X3ZpcnQ7CisKKwkvKiBmcmVlIHBhZ2UgbGlzdCAqLworCWtmcmVlKGJ1ZmZlci0+
cGFnZXMpOworCS8qIHJlbGVhc2UgbWVtb3J5ICovCisJY21hX3JlbGVhc2UoY21hX2hlYXAtPmNt
YSwgY21hX3BhZ2VzLCBucl9wYWdlcyk7CisJa2ZyZWUoYnVmZmVyKTsKK30KKworLyogZG1hYnVm
IGhlYXAgQ01BIG9wZXJhdGlvbnMgZnVuY3Rpb25zICovCitzdGF0aWMgaW50IGNtYV9oZWFwX2Fs
bG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKKwkJCSAgICAgdW5zaWduZWQgbG9uZyBsZW4s
CisJCQkgICAgIHVuc2lnbmVkIGxvbmcgZmRfZmxhZ3MsCisJCQkgICAgIHVuc2lnbmVkIGxvbmcg
aGVhcF9mbGFncykKK3sKKwlzdHJ1Y3QgY21hX2hlYXAgKmNtYV9oZWFwID0gZG1hX2hlYXBfZ2V0
X2RhdGEoaGVhcCk7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqaGVscGVyX2J1ZmZlcjsK
KwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzOworCXNpemVfdCBzaXplID0gUEFHRV9BTElHTihsZW4p
OworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBzaXplID4+IFBBR0VfU0hJRlQ7CisJdW5zaWdu
ZWQgbG9uZyBhbGlnbiA9IGdldF9vcmRlcihzaXplKTsKKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
OworCWludCByZXQgPSAtRU5PTUVNOworCXBnb2ZmX3QgcGc7CisKKwlpZiAoYWxpZ24gPiBDT05G
SUdfQ01BX0FMSUdOTUVOVCkKKwkJYWxpZ24gPSBDT05GSUdfQ01BX0FMSUdOTUVOVDsKKworCWhl
bHBlcl9idWZmZXIgPSBremFsbG9jKHNpemVvZigqaGVscGVyX2J1ZmZlciksIEdGUF9LRVJORUwp
OworCWlmICghaGVscGVyX2J1ZmZlcikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpbml0X2hlYXBf
aGVscGVyX2J1ZmZlcihoZWxwZXJfYnVmZmVyLCBjbWFfaGVhcF9mcmVlKTsKKwloZWxwZXJfYnVm
ZmVyLT5mbGFncyA9IGhlYXBfZmxhZ3M7CisJaGVscGVyX2J1ZmZlci0+aGVhcCA9IGhlYXA7CisJ
aGVscGVyX2J1ZmZlci0+c2l6ZSA9IGxlbjsKKworCWNtYV9wYWdlcyA9IGNtYV9hbGxvYyhjbWFf
aGVhcC0+Y21hLCBucl9wYWdlcywgYWxpZ24sIGZhbHNlKTsKKwlpZiAoIWNtYV9wYWdlcykKKwkJ
Z290byBmcmVlX2J1ZjsKKworCWlmIChQYWdlSGlnaE1lbShjbWFfcGFnZXMpKSB7CisJCXVuc2ln
bmVkIGxvbmcgbnJfY2xlYXJfcGFnZXMgPSBucl9wYWdlczsKKwkJc3RydWN0IHBhZ2UgKnBhZ2Ug
PSBjbWFfcGFnZXM7CisKKwkJd2hpbGUgKG5yX2NsZWFyX3BhZ2VzID4gMCkgeworCQkJdm9pZCAq
dmFkZHIgPSBrbWFwX2F0b21pYyhwYWdlKTsKKworCQkJbWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJ
WkUpOworCQkJa3VubWFwX2F0b21pYyh2YWRkcik7CisJCQlwYWdlKys7CisJCQlucl9jbGVhcl9w
YWdlcy0tOworCQl9CisJfSBlbHNlIHsKKwkJbWVtc2V0KHBhZ2VfYWRkcmVzcyhjbWFfcGFnZXMp
LCAwLCBzaXplKTsKKwl9CisKKwloZWxwZXJfYnVmZmVyLT5wYWdlY291bnQgPSBucl9wYWdlczsK
KwloZWxwZXJfYnVmZmVyLT5wYWdlcyA9IGttYWxsb2NfYXJyYXkoaGVscGVyX2J1ZmZlci0+cGFn
ZWNvdW50LAorCQkJCQkgICAgIHNpemVvZigqaGVscGVyX2J1ZmZlci0+cGFnZXMpLAorCQkJCQkg
ICAgIEdGUF9LRVJORUwpOworCWlmICghaGVscGVyX2J1ZmZlci0+cGFnZXMpIHsKKwkJcmV0ID0g
LUVOT01FTTsKKwkJZ290byBmcmVlX2NtYTsKKwl9CisKKwlmb3IgKHBnID0gMDsgcGcgPCBoZWxw
ZXJfYnVmZmVyLT5wYWdlY291bnQ7IHBnKyspIHsKKwkJaGVscGVyX2J1ZmZlci0+cGFnZXNbcGdd
ID0gJmNtYV9wYWdlc1twZ107CisJCWlmICghaGVscGVyX2J1ZmZlci0+cGFnZXNbcGddKQorCQkJ
Z290byBmcmVlX3BhZ2VzOworCX0KKworCS8qIGNyZWF0ZSB0aGUgZG1hYnVmICovCisJZG1hYnVm
ID0gaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1ZihoZWxwZXJfYnVmZmVyLCBmZF9mbGFncyk7CisJ
aWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJldCA9IFBUUl9FUlIoZG1hYnVmKTsKKwkJZ290byBm
cmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9idWZmZXItPmRtYWJ1ZiA9IGRtYWJ1ZjsKKwloZWxw
ZXJfYnVmZmVyLT5wcml2X3ZpcnQgPSBjbWFfcGFnZXM7CisKKwlyZXQgPSBkbWFfYnVmX2ZkKGRt
YWJ1ZiwgZmRfZmxhZ3MpOworCWlmIChyZXQgPCAwKSB7CisJCWRtYV9idWZfcHV0KGRtYWJ1Zik7
CisJCS8qIGp1c3QgcmV0dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJlbGVhc2UgYW5kIHRoYXQgd2ls
bCBmcmVlICovCisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIHJldDsKKworZnJlZV9wYWdl
czoKKwlrZnJlZShoZWxwZXJfYnVmZmVyLT5wYWdlcyk7CitmcmVlX2NtYToKKwljbWFfcmVsZWFz
ZShjbWFfaGVhcC0+Y21hLCBjbWFfcGFnZXMsIG5yX3BhZ2VzKTsKK2ZyZWVfYnVmOgorCWtmcmVl
KGhlbHBlcl9idWZmZXIpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZG1hX2hlYXBfb3BzIGNtYV9oZWFwX29wcyA9IHsKKwkuYWxsb2NhdGUgPSBjbWFfaGVhcF9hbGxv
Y2F0ZSwKK307CisKK3N0YXRpYyBpbnQgX19hZGRfY21hX2hlYXAoc3RydWN0IGNtYSAqY21hLCB2
b2lkICpkYXRhKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hlYXA7CisJc3RydWN0IGRtYV9o
ZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCisJY21hX2hlYXAgPSBremFsbG9jKHNpemVvZigq
Y21hX2hlYXApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNtYV9oZWFwKQorCQlyZXR1cm4gLUVOT01F
TTsKKwljbWFfaGVhcC0+Y21hID0gY21hOworCisJZXhwX2luZm8ubmFtZSA9IGNtYV9nZXRfbmFt
ZShjbWEpOworCWV4cF9pbmZvLm9wcyA9ICZjbWFfaGVhcF9vcHM7CisJZXhwX2luZm8ucHJpdiA9
IGNtYV9oZWFwOworCisJY21hX2hlYXAtPmhlYXAgPSBkbWFfaGVhcF9hZGQoJmV4cF9pbmZvKTsK
KwlpZiAoSVNfRVJSKGNtYV9oZWFwLT5oZWFwKSkgeworCQlpbnQgcmV0ID0gUFRSX0VSUihjbWFf
aGVhcC0+aGVhcCk7CisKKwkJa2ZyZWUoY21hX2hlYXApOworCQlyZXR1cm4gcmV0OworCX0KKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFkZF9jbWFfaGVhcHModm9pZCkKK3sKKwljbWFf
Zm9yX2VhY2hfYXJlYShfX2FkZF9jbWFfaGVhcCwgTlVMTCk7CisJcmV0dXJuIDA7Cit9CitkZXZp
Y2VfaW5pdGNhbGwoYWRkX2NtYV9oZWFwcyk7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
