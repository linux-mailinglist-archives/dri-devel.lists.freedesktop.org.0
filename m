Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DDE359D2BA
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 17:27:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DBB5A6E25B;
	Mon, 26 Aug 2019 15:27:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A159B6E229
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 15:27:03 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id DE89B28BF6D;
 Mon, 26 Aug 2019 16:27:01 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 12/21] drm/bridge: Add a drm_bridge_state object
Date: Mon, 26 Aug 2019 17:26:40 +0200
Message-Id: <20190826152649.13820-13-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190826152649.13820-1-boris.brezillon@collabora.com>
References: <20190826152649.13820-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Jernej Skrabec <jernej.skrabec@siol.net>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>, Jonas Karlman <jonas@kwiboo.se>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Thierry Reding <thierry.reding@gmail.com>, Chris Healy <Chris.Healy@zii.aero>,
 Boris Brezillon <boris.brezillon@collabora.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T25lIG9mIHRoZSBsYXN0IHJlbWFpbmluZyBvYmplY3RzIHRvIG5vdCBoYXZlIGl0cyBhdG9taWMg
c3RhdGUuCgpUaGlzIGlzIGJlaW5nIG1vdGl2YXRlZCBieSBvdXIgYXR0ZW1wdCB0byBzdXBwb3J0
IHJ1bnRpbWUgYnVzLWZvcm1hdApuZWdvdGlhdGlvbiBiZXR3ZWVuIGVsZW1lbnRzIG9mIHRoZSBi
cmlkZ2UgY2hhaW4uClRoaXMgcGF0Y2gganVzdCBwYXZlcyB0aGUgcm9hZCBmb3Igc3VjaCBhIGZl
YXR1cmUgYnkgYWRkaW5nIGEgbmV3CmRybV9icmlkZ2Vfc3RhdGUgb2JqZWN0IGluaGVyaXRpbmcg
ZnJvbSBkcm1fcHJpdmF0ZV9vYmogc28gd2UgY2FuCnJlLXVzZSBzb21lIG9mIHRoZSBleGlzdGlu
ZyBzdGF0ZSBpbml0aWFsaXphdGlvbi90cmFja2luZyBsb2dpYy4KClNpZ25lZC1vZmYtYnk6IEJv
cmlzIEJyZXppbGxvbiA8Ym9yaXMuYnJlemlsbG9uQGNvbGxhYm9yYS5jb20+Ci0tLQpDaGFuZ2Vz
IGluIHYyOgoqIFVzZSBkcm1fZm9yX2VhY2hfYnJpZGdlX2luX2NoYWluKCkKKiBSZW5hbWUgaGVs
cGVycyB0byBiZSBtb3JlIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgRFJNIEFQSQoq
IEltcHJvdmUvZml4IHRoZSBkb2MKLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jICAg
ICAgICB8ICAzOSArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYyB8
ICAyMCArKysrCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAgICAgICB8IDE2OCArKysr
KysrKysrKysrKysrKysrKysrKysrKystCiBpbmNsdWRlL2RybS9kcm1fYXRvbWljLmggICAgICAg
ICAgICB8ICAgMyArCiBpbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggICAgICAgICAgICB8IDExOCAr
KysrKysrKysrKysrKysrKysrCiA1IGZpbGVzIGNoYW5nZWQsIDM0MyBpbnNlcnRpb25zKCspLCA1
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCmluZGV4IDQxOTM4MWFiYmRkMS4uNmMyNDlj
ZTM5MzgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKQEAgLTMwLDYgKzMwLDcgQEAKIAogI2luY2x1ZGUg
PGRybS9kcm1fYXRvbWljLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfdWFwaS5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fYnJpZGdlLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9kZWJ1Z2ZzLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9kZXZpY2UuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2Rydi5oPgpAQCAt
MTAxMCw2ICsxMDExLDQ0IEBAIHN0YXRpYyB2b2lkIGRybV9hdG9taWNfY29ubmVjdG9yX3ByaW50
X3N0YXRlKHN0cnVjdCBkcm1fcHJpbnRlciAqcCwKIAkJY29ubmVjdG9yLT5mdW5jcy0+YXRvbWlj
X3ByaW50X3N0YXRlKHAsIHN0YXRlKTsKIH0KIAorLyoqCisgKiBkcm1fYXRvbWljX2FkZF9lbmNv
ZGVyX2JyaWRnZXMgLSBhZGQgYnJpZGdlcyBhdHRhY2hlZCB0byBhbiBlbmNvZGVyCisgKiBAc3Rh
dGU6IGF0b21pYyBzdGF0ZQorICogQGVuY29kZXI6IERSTSBlbmNvZGVyCisgKgorICogVGhpcyBm
dW5jdGlvbiBhZGRzIGFsbCBicmlkZ2VzIGF0dGFjaGVkIHRvIEBlbmNvZGVyLiBUaGlzIGlzIG5l
ZWRlZCB0byBhZGQKKyAqIGJyaWRnZSBzdGF0ZXMgdG8gQHN0YXRlIGFuZCBtYWtlIHRoZW0gYXZh
aWxhYmxlIHdoZW4KKyAqICZicmlkZ2VfZnVuY3MuYXRvbWljX3tjaGVjayxwcmVfZW5hYmxlLGVu
YWJsZSxkaXNhYmxlX3Bvc3RfZGlzYWJsZX0oKSBhcmUKKyAqIGNhbGxlZAorICoKKyAqIFJldHVy
bnM6CisgKiAwIG9uIHN1Y2Nlc3Mgb3IgY2FuIGZhaWwgd2l0aCAtRURFQURMSyBvciAtRU5PTUVN
LiBXaGVuIHRoZSBlcnJvciBpcyBFREVBRExLCisgKiB0aGVuIHRoZSB3L3cgbXV0ZXggY29kZSBo
YXMgZGV0ZWN0ZWQgYSBkZWFkbG9jayBhbmQgdGhlIGVudGlyZSBhdG9taWMKKyAqIHNlcXVlbmNl
IG11c3QgYmUgcmVzdGFydGVkLiBBbGwgb3RoZXIgZXJyb3JzIGFyZSBmYXRhbC4KKyAqLworaW50
Citkcm1fYXRvbWljX2FkZF9lbmNvZGVyX2JyaWRnZXMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUg
KnN0YXRlLAorCQkJICAgICAgIHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKK3sKKwlzdHJ1
Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqYnJpZGdlX3N0YXRlOworCXN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2U7CisKKwlpZiAoIWVuY29kZXIpCisJCXJldHVybiAwOworCisJRFJNX0RFQlVHX0FUT01J
QygiQWRkaW5nIGFsbCBicmlkZ2VzIGZvciBbZW5jb2RlcjolZDolc10gdG8gJXBcbiIsCisJCQkg
ZW5jb2Rlci0+YmFzZS5pZCwgZW5jb2Rlci0+bmFtZSwgc3RhdGUpOworCisJZHJtX2Zvcl9lYWNo
X2JyaWRnZV9pbl9jaGFpbihlbmNvZGVyLCBicmlkZ2UpIHsKKwkJYnJpZGdlX3N0YXRlID0gZHJt
X2F0b21pY19nZXRfYnJpZGdlX3N0YXRlKHN0YXRlLCBicmlkZ2UpOworCQlpZiAoSVNfRVJSKGJy
aWRnZV9zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihicmlkZ2Vfc3RhdGUpOworCX0KKworCXJl
dHVybiAwOworfQorRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2FkZF9lbmNvZGVyX2JyaWRnZXMp
OworCiAvKioKICAqIGRybV9hdG9taWNfYWRkX2FmZmVjdGVkX2Nvbm5lY3RvcnMgLSBhZGQgY29u
bmVjdG9ycyBmb3IgY3J0YwogICogQHN0YXRlOiBhdG9taWMgc3RhdGUKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9h
dG9taWNfaGVscGVyLmMKaW5kZXggY2NjZDllMzUzMWMxLi5iM2Y1OWU3NTdiMzAgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCkBAIC03MzYsNiArNzM2LDI2IEBAIGRybV9hdG9taWNf
aGVscGVyX2NoZWNrX21vZGVzZXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCXJldHVybiBy
ZXQ7CiAJfQogCisJLyoKKwkgKiBJdGVyYXRlIG92ZXIgYWxsIGNvbm5lY3RvcnMgYWdhaW4sIGFu
ZCBhZGQgYWxsIGFmZmVjdGVkIGJyaWRnZXMgdG8KKwkgKiB0aGUgc3RhdGUuCisJICovCisJZm9y
X2VhY2hfb2xkbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLAorCQkJCQkg
ICBvbGRfY29ubmVjdG9yX3N0YXRlLAorCQkJCQkgICBuZXdfY29ubmVjdG9yX3N0YXRlLCBpKSB7
CisJCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKworCQllbmNvZGVyID0gb2xkX2Nvbm5l
Y3Rvcl9zdGF0ZS0+YmVzdF9lbmNvZGVyOworCQlyZXQgPSBkcm1fYXRvbWljX2FkZF9lbmNvZGVy
X2JyaWRnZXMoc3RhdGUsIGVuY29kZXIpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwor
CQllbmNvZGVyID0gbmV3X2Nvbm5lY3Rvcl9zdGF0ZS0+YmVzdF9lbmNvZGVyOworCQlyZXQgPSBk
cm1fYXRvbWljX2FkZF9lbmNvZGVyX2JyaWRnZXMoc3RhdGUsIGVuY29kZXIpOworCQlpZiAocmV0
KQorCQkJcmV0dXJuIHJldDsKKwl9CisKIAlyZXQgPSBtb2RlX3ZhbGlkKHN0YXRlKTsKIAlpZiAo
cmV0KQogCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9icmlk
Z2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMKaW5kZXggNjk1YWQ2N2QzM2E1Li42
YzJkNzY5MTQ1NWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwpAQCAtMjUsNiArMjUsNyBAQAogI2luY2x1
ZGUgPGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUgPGxpbnV4L211dGV4Lmg+CiAKKyNpbmNsdWRl
IDxkcm0vZHJtX2F0b21pY19zdGF0ZV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2JyaWRn
ZS5oPgogI2luY2x1ZGUgPGRybS9kcm1fZW5jb2Rlci5oPgogCkBAIC04OSw2ICs5MCwzOCBAQCB2
b2lkIGRybV9icmlkZ2VfcmVtb3ZlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiB9CiBFWFBP
UlRfU1lNQk9MKGRybV9icmlkZ2VfcmVtb3ZlKTsKIAorc3RhdGljIHN0cnVjdCBkcm1fcHJpdmF0
ZV9zdGF0ZSAqCitkcm1fYnJpZGdlX2F0b21pY19kdXBsaWNhdGVfcHJpdl9zdGF0ZShzdHJ1Y3Qg
ZHJtX3ByaXZhdGVfb2JqICpvYmopCit7CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9IGRy
bV9wcml2X3RvX2JyaWRnZShvYmopOworCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZTsK
KworCWlmIChicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZHVwbGljYXRlX3N0YXRlKQorCQlzdGF0ZSA9
IGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kdXBsaWNhdGVfc3RhdGUoYnJpZGdlKTsKKwllbHNlCisJ
CXN0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShicmlkZ2Up
OworCisJcmV0dXJuICZzdGF0ZS0+YmFzZTsKK30KKworc3RhdGljIHZvaWQKK2RybV9icmlkZ2Vf
YXRvbWljX2Rlc3Ryb3lfcHJpdl9zdGF0ZShzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpvYmosCisJ
CQkJICAgICBzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKnMpCit7CisJc3RydWN0IGRybV9icmlk
Z2Vfc3RhdGUgKnN0YXRlID0gZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKHMpOworCXN0cnVjdCBk
cm1fYnJpZGdlICpicmlkZ2UgPSBkcm1fcHJpdl90b19icmlkZ2Uob2JqKTsKKworCWlmIChicmlk
Z2UtPmZ1bmNzLT5hdG9taWNfZGVzdHJveV9zdGF0ZSkKKwkJYnJpZGdlLT5mdW5jcy0+YXRvbWlj
X2Rlc3Ryb3lfc3RhdGUoYnJpZGdlLCBzdGF0ZSk7CisJZWxzZQorCQlkcm1fYXRvbWljX2hlbHBl
cl9icmlkZ2VfZGVzdHJveV9zdGF0ZShicmlkZ2UsIHN0YXRlKTsKK30KKworc3RhdGljIGNvbnN0
IHN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZV9mdW5jcyBkcm1fYnJpZGdlX3ByaXZfc3RhdGVfZnVu
Y3MgPSB7CisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBkcm1fYnJpZGdlX2F0b21pY19kdXBs
aWNhdGVfcHJpdl9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYnJpZGdlX2F0
b21pY19kZXN0cm95X3ByaXZfc3RhdGUsCit9OworCiAvKioKICAqIGRybV9icmlkZ2VfYXR0YWNo
IC0gYXR0YWNoIHRoZSBicmlkZ2UgdG8gYW4gZW5jb2RlcidzIGNoYWluCiAgKgpAQCAtMTE0LDYg
KzE0Nyw3IEBAIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9yZW1vdmUpOwogaW50IGRybV9icmlk
Z2VfYXR0YWNoKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRybV9icmlkZ2Ug
KmJyaWRnZSwKIAkJICAgICAgc3RydWN0IGRybV9icmlkZ2UgKnByZXZpb3VzKQogeworCXN0cnVj
dCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZTsKIAlMSVNUX0hFQUQodG1wX2xpc3QpOwogCWludCBy
ZXQ7CiAKQEAgLTEzMiwxMyArMTY2LDI0IEBAIGludCBkcm1fYnJpZGdlX2F0dGFjaChzdHJ1Y3Qg
ZHJtX2VuY29kZXIgKmVuY29kZXIsIHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAKIAlpZiAo
YnJpZGdlLT5mdW5jcy0+YXR0YWNoKSB7CiAJCXJldCA9IGJyaWRnZS0+ZnVuY3MtPmF0dGFjaChi
cmlkZ2UpOwotCQlpZiAocmV0IDwgMCkgewotCQkJYnJpZGdlLT5kZXYgPSBOVUxMOwotCQkJYnJp
ZGdlLT5lbmNvZGVyID0gTlVMTDsKLQkJCXJldHVybiByZXQ7Ci0JCX0KKwkJaWYgKHJldCA8IDAp
CisJCQlnb3RvIGVycl9yZXNldF9icmlkZ2U7CiAJfQogCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0
b21pY19yZXNldCkKKwkJc3RhdGUgPSBicmlkZ2UtPmZ1bmNzLT5hdG9taWNfcmVzZXQoYnJpZGdl
KTsKKwllbHNlCisJCXN0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX3Jlc2V0KGJyaWRn
ZSk7CisKKwlpZiAoSVNfRVJSKHN0YXRlKSkgeworCQlyZXQgPSBQVFJfRVJSKHN0YXRlKTsKKwkJ
Z290byBlcnJfZGV0YWNoX2JyaWRnZTsKKwl9CisKKwlkcm1fYXRvbWljX3ByaXZhdGVfb2JqX2lu
aXQoYnJpZGdlLT5kZXYsICZicmlkZ2UtPmJhc2UsCisJCQkJICAgICZzdGF0ZS0+YmFzZSwKKwkJ
CQkgICAgJmRybV9icmlkZ2VfcHJpdl9zdGF0ZV9mdW5jcyk7CisKIAlpZiAoYnJpZGdlID09ICZl
bmNvZGVyLT5icmlkZ2UpCiAJCWxpc3Rfc3BsaWNlKCZ0bXBfbGlzdCwgJmVuY29kZXItPmJyaWRn
ZV9jaGFpbik7CiAJZWxzZSBpZiAoIXByZXZpb3VzKQpAQCAtMTQ3LDYgKzE5MiwxNSBAQCBpbnQg
ZHJtX2JyaWRnZV9hdHRhY2goc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyLCBzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlLAogCQlsaXN0X3NwbGljZSgmdG1wX2xpc3QsICZwcmV2aW91cy0+Y2hh
aW5fbm9kZSk7CiAKIAlyZXR1cm4gMDsKKworZXJyX2RldGFjaF9icmlkZ2U6CisJaWYgKGJyaWRn
ZS0+ZnVuY3MtPmRldGFjaCkKKwkJYnJpZGdlLT5mdW5jcy0+ZGV0YWNoKGJyaWRnZSk7CisKK2Vy
cl9yZXNldF9icmlkZ2U6CisJYnJpZGdlLT5kZXYgPSBOVUxMOworCWJyaWRnZS0+ZW5jb2RlciA9
IE5VTEw7CisJcmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9hdHRhY2gp
OwogCkBAIC0xNTgsNiArMjEyLDggQEAgdm9pZCBkcm1fYnJpZGdlX2RldGFjaChzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlKQogCWlmIChXQVJOX09OKCFicmlkZ2UtPmRldikpCiAJCXJldHVybjsK
IAorCWRybV9hdG9taWNfcHJpdmF0ZV9vYmpfZmluaSgmYnJpZGdlLT5iYXNlKTsKKwogCWlmIChi
cmlkZ2UtPmZ1bmNzLT5kZXRhY2gpCiAJCWJyaWRnZS0+ZnVuY3MtPmRldGFjaChicmlkZ2UpOwog
CkBAIC00OTIsNiArNTQ4LDEwOCBAQCB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJs
ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogfQogRVhQT1JUX1NZTUJPTChkcm1fYXRvbWlj
X2JyaWRnZV9jaGFpbl9lbmFibGUpOwogCisvKioKKyAqIGRybV9hdG9taWNfaGVscGVyX2JyaWRn
ZV9kZXN0cm95X3N0YXRlKCkgLSBEZWZhdWx0IGRlc3Ryb3kgc3RhdGUgaGVscGVyCisgKiBAYnJp
ZGdlOiB0aGUgYnJpZGdlIHRoaXMgc3RhdGUgcmVmZXJzIHRvCisgKiBAc3RhdGU6IHN0YXRlIG9i
amVjdCB0byBkZXN0cm95CisgKgorICogSnVzdCBhIHNpbXBsZSBrZnJlZSgpIGZvciBub3cuCisg
Ki8KK3ZvaWQgZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2Rlc3Ryb3lfc3RhdGUoc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkJICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0
ZSkKK3sKKwlrZnJlZShzdGF0ZSk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVy
X2JyaWRnZV9kZXN0cm95X3N0YXRlKTsKKworLyoqCisgKiBfX2RybV9hdG9taWNfaGVscGVyX2Jy
aWRnZV9yZXNldCgpIC0gSW5pdGlhbGl6ZSBhIGJyaWRnZSBzdGF0ZSB0byBpdHMKKyAqCQkJCQlk
ZWZhdWx0CisgKiBAYnJpZGdlOiB0aGUgYnJpZGdlIHRoaXMgc3RhdGUgaXMgcmVmZXJzIHRvCisg
KiBAc3RhdGU6IGJyaWRnZSBzdGF0ZSB0byBpbml0aWFsaXplCisgKgorICogRm9yIG5vdyBpdCdz
IGp1c3QgYSBtZW1zZXQoMCkgcGx1cyBhIHN0YXRlLT5icmlkZ2UgYXNzaWdubWVudC4gTWlnaHQK
KyAqIGJlIGV4dGVuZGVkIGluIHRoZSBmdXR1cmUuCisgKi8KK3ZvaWQgX19kcm1fYXRvbWljX2hl
bHBlcl9icmlkZ2VfcmVzZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkgICAgICBz
dHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpCit7CisJbWVtc2V0KHN0YXRlLCAwLCBzaXpl
b2YoKnN0YXRlKSk7CisJc3RhdGUtPmJyaWRnZSA9IGJyaWRnZTsKK30KK0VYUE9SVF9TWU1CT0wo
X19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQpOworCisvKioKKyAqIGRybV9hdG9taWNf
aGVscGVyX2JyaWRnZV9yZXNldCgpIC0gZGVmYXVsdCAmZHJtX3BsYW5lX2Z1bmNzLnJlc2V0IGhv
b2sgZm9yCisgKgkJCQkgICAgICBicmlkZ2VzCisgKiBAYnJpZGdlOiB0aGUgYnJpZGdlIHRvIHJl
c2V0IHN0YXRlIG9uCisgKgorICogUmVzZXRzIHRoZSBhdG9taWMgc3RhdGUgZm9yIEBicmlkZ2Ug
YnkgZnJlZWluZyB0aGUgc3RhdGUgcG9pbnRlciAod2hpY2gKKyAqIG1pZ2h0IGJlIE5VTEwsIGUu
Zy4gYXQgZHJpdmVyIGxvYWQgdGltZSkgYW5kIGFsbG9jYXRpbmcgYSBuZXcgZW1wdHkgc3RhdGUK
KyAqIG9iamVjdC4KKyAqCisgKiBSRVRVUk5TOgorICogQSB2YWxpZCBkcm1fYnJpZGdlX3N0YXRl
IG9iamVjdCBpbiBjYXNlIG9mIHN1Y2Nlc3MsIGFuIEVSUl9QVFIoKQorICogZ2l2aW5nIHRoZSBy
ZWFvbiBvZiB0aGUgZmFpbHVyZSBvdGhlcndpc2UuCisgKi8KK3N0cnVjdCBkcm1fYnJpZGdlX3N0
YXRlICoKK2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9yZXNldChzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlKQoreworCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGU7CisKKwli
cmlkZ2Vfc3RhdGUgPSBremFsbG9jKHNpemVvZigqYnJpZGdlX3N0YXRlKSwgR0ZQX0tFUk5FTCk7
CisJaWYgKCFicmlkZ2Vfc3RhdGUpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJX19k
cm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQoYnJpZGdlLCBicmlkZ2Vfc3RhdGUpOworCXJl
dHVybiBicmlkZ2Vfc3RhdGU7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2Jy
aWRnZV9yZXNldCk7CisKKy8qKgorICogX19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfZHVwbGlj
YXRlX3N0YXRlKCkgLSBDb3B5IHRoZSBjb250ZW50IG9mIHRoZQorICoJCQkJCQkgIGN1cnJlbnQg
YnJpZGdlIHN0YXRlIGludG8gYQorICoJCQkJCQkgIG5ldyBvbmUKKyAqIEBicmlkZ2U6IGJyaWRn
ZSBlbGVtZW50IHRoZSBvbGQgYW5kIG5ldyBzdGF0ZXMgYXJlIHJlZmVycmluZyB0bworICogQG5l
dzogbmV3IGJyaWRnZSBzdGF0ZSB0byBjb3B5IHRvCisgKgorICogU2hvdWxkIGJlIHVzZWQgYnkg
Y3VzdG9tICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19kdXBsaWNhdGUoKSBpbXBsZW1lbnRhdGlv
bgorICogdG8gY29weSB0aGUgcHJldmlvdXMgc3RhdGUgaW50byB0aGUgbmV3IG9iamVjdC4KKyAq
Lwordm9pZCBfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBsaWNhdGVfc3RhdGUoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkJCXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpuZXcp
Cit7CisJX19kcm1fYXRvbWljX2hlbHBlcl9wcml2YXRlX29ial9kdXBsaWNhdGVfc3RhdGUoJmJy
aWRnZS0+YmFzZSwKKwkJCQkJCQkmbmV3LT5iYXNlKTsKKwluZXctPmJyaWRnZSA9IGJyaWRnZTsK
K30KK0VYUE9SVF9TWU1CT0woX19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfZHVwbGljYXRlX3N0
YXRlKTsKKworLyoqCisgKiBkcm1fYXRvbWljX2hlbHBlcl9kdXBsaWNhdGVfYnJpZGdlX3N0YXRl
KCkgLSBEZWZhdWx0IGR1cGxpY2F0ZSBzdGF0ZSBoZWxwZXIKKyAqIEBicmlkZ2U6IGJyaWRnZSBj
b250YWluaW5nIHRoZSBzdGF0ZSB0byBkdXBsaWNhdGUKKyAqCisgKiBEZWZhdWx0IGltcGxlbWVu
dGF0aW9uIG9mICZkcm1fYnJpZGdlX2Z1bmNzLmF0b21pY19kdXBsaWNhdGUoKS4KKyAqCisgKiBS
RVRVUk5TOgorICogYSB2YWxpZCBzdGF0ZSBvYmplY3Qgb3IgTlVMTCBpZiB0aGUgYWxsb2NhdGlv
biBmYWlscy4KKyAqLworc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0b21pY19oZWxw
ZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQorewor
CXN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpuZXc7CisKKwlpZiAoV0FSTl9PTighYnJpZGdlLT5i
YXNlLnN0YXRlKSkKKwkJcmV0dXJuIE5VTEw7CisKKwluZXcgPSBremFsbG9jKHNpemVvZigqbmV3
KSwgR0ZQX0tFUk5FTCk7CisJaWYgKG5ldykKKwkJX19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2Vf
ZHVwbGljYXRlX3N0YXRlKGJyaWRnZSwgbmV3KTsKKworCXJldHVybiBuZXc7Cit9CitFWFBPUlRf
U1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBsaWNhdGVfc3RhdGUpOworCiAjaWZk
ZWYgQ09ORklHX09GCiAvKioKICAqIG9mX2RybV9maW5kX2JyaWRnZSAtIGZpbmQgdGhlIGJyaWRn
ZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBkZXZpY2Ugbm9kZSBpbgpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS9kcm0vZHJtX2F0b21pYy5oIGIvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oCmluZGV4IDkyN2Ux
MjA1ZDdhYS4uMWMwYTA4MjE3NzEyIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fYXRvbWlj
LmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oCkBAIC02NjAsNiArNjYwLDkgQEAgX19k
cm1fYXRvbWljX2dldF9jdXJyZW50X3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSwKIAlyZXR1cm4gcGxhbmUtPnN0YXRlOwogfQogCitpbnQgX19tdXN0X2NoZWNrCitk
cm1fYXRvbWljX2FkZF9lbmNvZGVyX2JyaWRnZXMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlLAorCQkJICAgICAgIHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rlcik7CiBpbnQgX19tdXN0
X2NoZWNrCiBkcm1fYXRvbWljX2FkZF9hZmZlY3RlZF9jb25uZWN0b3JzKHN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgZHJtX2NydGMgKmNydGMpOwpkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oIGIvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5o
CmluZGV4IGNmMDViMzBmMjk2Ny4uMTFiMjBlMmE5ZmM2IDEwMDY0NAotLS0gYS9pbmNsdWRlL2Ry
bS9kcm1fYnJpZGdlLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCkBAIC0yNSw2ICsy
NSw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvY3R5cGUu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgogI2luY2x1ZGUgPGRybS9kcm1fbW9kZV9v
YmplY3QuaD4KICNpbmNsdWRlIDxkcm0vZHJtX21vZGVzLmg+CiAKQEAgLTMyLDYgKzMzLDIzIEBA
IHN0cnVjdCBkcm1fYnJpZGdlOwogc3RydWN0IGRybV9icmlkZ2VfdGltaW5nczsKIHN0cnVjdCBk
cm1fcGFuZWw7CiAKKy8qKgorICogc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgLSBBdG9taWMgYnJp
ZGdlIHN0YXRlIG9iamVjdAorICogQGJhc2U6IGluaGVyaXQgZnJvbSAmZHJtX3ByaXZhdGVfc3Rh
dGUKKyAqIEBicmlkZ2U6IHRoZSBicmlkZ2UgdGhpcyBzdGF0ZSByZWZlcnMgdG8KKyAqLworc3Ry
dWN0IGRybV9icmlkZ2Vfc3RhdGUgeworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSBiYXNlOwor
CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0
IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1f
cHJpdmF0ZV9zdGF0ZSAqcHJpdikKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKHByaXYsIHN0cnVj
dCBkcm1fYnJpZGdlX3N0YXRlLCBiYXNlKTsKK30KKwogLyoqCiAgKiBzdHJ1Y3QgZHJtX2JyaWRn
ZV9mdW5jcyAtIGRybV9icmlkZ2UgY29udHJvbCBmdW5jdGlvbnMKICAqLwpAQCAtMzM3LDYgKzM1
NSw0OCBAQCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7CiAJICovCiAJdm9pZCAoKmF0b21pY19w
b3N0X2Rpc2FibGUpKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCQkJICAgIHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisKKwkvKioKKwkgKiBAYXRvbWljX2R1cGxpY2F0ZV9z
dGF0ZToKKwkgKgorCSAqIER1cGxpY2F0ZSB0aGUgY3VycmVudCBicmlkZ2Ugc3RhdGUgb2JqZWN0
ICh3aGljaCBpcyBndWFyYW50ZWVkIHRvIGJlCisJICogbm9uLU5VTEwpLgorCSAqCisJICogVGhl
IGF0b21pY19kdXBsaWNhdGVfc3RhdGUoKSBpcyBvcHRpb25hbCwgdGhlIGNvcmUgZmFsbHMgYmFj
ayBvbgorCSAqICZkcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfZHVwbGljYXRlX3N0YXRlKCkgd2hl
biBub3QgaW1wbGVtZW50ZWQuCisJICoKKwkgKiBSRVRVUk5TOgorCSAqIEEgdmFsaWQgZHJtX2Jy
aWRnZV9zdGF0ZSBvYmplY3Qgb3IgTlVMTCBpZiB0aGUgYWxsb2NhdGlvbiBmYWlscy4KKwkgKi8K
KwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqKCphdG9taWNfZHVwbGljYXRlX3N0YXRlKShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKKworCS8qKgorCSAqIEBhdG9taWNfZGVzdHJveV9zdGF0
ZToKKwkgKgorCSAqIERlc3Ryb3kgYSBicmlkZ2Ugc3RhdGUgb2JqZWN0IHByZXZpb3VzbHkgYWxs
b2NhdGVkIGJ5CisJICogJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSgp
LgorCSAqCisJICogVGhlIGF0b21pY19kZXN0cm95X3N0YXRlIGhvb2sgaXMgb3B0aW9uYWwsIHRo
ZSBjb3JlZiBmYWxscyBiYWNrIG9uCisJICogJmRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0
cm95X3N0YXRlKCkgd2hlbiBub3QgaW1wbGVtZW50ZWQuCisJICovCisJdm9pZCAoKmF0b21pY19k
ZXN0cm95X3N0YXRlKShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgICAgc3RydWN0
IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRlKTsKKworCS8qKgorCSAqIEBhdG9taWNfcmVzZXQ6CisJ
ICoKKwkgKiBSZXNldCB0aGUgYnJpZGdlIHRvIGEgcHJlZGVmaW5lZCBzdGF0ZSAob3IgcmV0cmll
dmUgaXRzIGN1cnJlbnQKKwkgKiBzdGF0ZSkgYW5kIHJldHVybiBhICZkcm1fYnJpZGdlX3N0YXRl
IG9iamVjdCBtYXRjaGluZyB0aGlzIHN0YXRlLgorCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVk
IGF0IGF0dGFjaCB0aW1lLgorCSAqCisJICogVGhlIGF0b21pY19yZXNldCBob29rIGlzIG9wdGlv
bmFsLCB0aGUgY29yZSBmYWxscyBiYWNrIG9uCisJICogJmRybV9hdG9taWNfaGVscGVyX2JyaWRn
ZV9yZXNldCgpIHdoZW4gbm90IGltcGxlbWVudGVkLgorCSAqCisJICogUkVUVVJOUzoKKwkgKiBB
IHZhbGlkIGRybV9icmlkZ2Vfc3RhdGUgb2JqZWN0IGluIGNhc2Ugb2Ygc3VjY2VzcywgYW4gRVJS
X1BUUigpCisJICogZ2l2aW5nIHRoZSByZWFvbiBvZiB0aGUgZmFpbHVyZSBvdGhlcndpc2UuCisJ
ICovCisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKigqYXRvbWljX3Jlc2V0KShzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlKTsKIH07CiAKIC8qKgpAQCAtMzc5LDYgKzQzOSw4IEBAIHN0cnVjdCBk
cm1fYnJpZGdlX3RpbWluZ3MgewogICogc3RydWN0IGRybV9icmlkZ2UgLSBjZW50cmFsIERSTSBi
cmlkZ2UgY29udHJvbCBzdHJ1Y3R1cmUKICAqLwogc3RydWN0IGRybV9icmlkZ2UgeworCS8qKiBA
YmFzZTogaW5oZXJpdCBmcm9tICZkcm1fcHJpdmF0ZV9vYmplY3QgKi8KKwlzdHJ1Y3QgZHJtX3By
aXZhdGVfb2JqIGJhc2U7CiAJLyoqIEBkZXY6IERSTSBkZXZpY2UgdGhpcyBicmlkZ2UgYmVsb25n
cyB0byAqLwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXY7CiAJLyoqIEBlbmNvZGVyOiBlbmNvZGVy
IHRvIHdoaWNoIHRoaXMgYnJpZGdlIGlzIGNvbm5lY3RlZCAqLwpAQCAtNDAzLDYgKzQ2NSwxMiBA
QCBzdHJ1Y3QgZHJtX2JyaWRnZSB7CiAJdm9pZCAqZHJpdmVyX3ByaXZhdGU7CiB9OwogCitzdGF0
aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlICoKK2RybV9wcml2X3RvX2JyaWRnZShzdHJ1Y3Qg
ZHJtX3ByaXZhdGVfb2JqICpwcml2KQoreworCXJldHVybiBjb250YWluZXJfb2YocHJpdiwgc3Ry
dWN0IGRybV9icmlkZ2UsIGJhc2UpOworfQorCiB2b2lkIGRybV9icmlkZ2VfYWRkKHN0cnVjdCBk
cm1fYnJpZGdlICpicmlkZ2UpOwogdm9pZCBkcm1fYnJpZGdlX3JlbW92ZShzdHJ1Y3QgZHJtX2Jy
aWRnZSAqYnJpZGdlKTsKIHN0cnVjdCBkcm1fYnJpZGdlICpvZl9kcm1fZmluZF9icmlkZ2Uoc3Ry
dWN0IGRldmljZV9ub2RlICpucCk7CkBAIC00NDUsNiArNTEzLDU2IEBAIHZvaWQgZHJtX2F0b21p
Y19icmlkZ2VfY2hhaW5fcHJlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogdm9p
ZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKIAkJCQkgICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAordm9pZCBfX2Ry
bV9hdG9taWNfaGVscGVyX2JyaWRnZV9yZXNldChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAor
CQkJCSAgICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSk7CitzdHJ1Y3QgZHJtX2Jy
aWRnZV9zdGF0ZSAqCitkcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQoc3RydWN0IGRybV9i
cmlkZ2UgKmJyaWRnZSk7Cit2b2lkIGRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0cm95X3N0
YXRlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRn
ZV9zdGF0ZSAqc3RhdGUpOwordm9pZCBfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBsaWNh
dGVfc3RhdGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkJCXN0cnVjdCBkcm1fYnJp
ZGdlX3N0YXRlICpuZXcpOworc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0b21pY19o
ZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsK
Kworc3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWljX2dl
dF9icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICAgIHN0
cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpv
Ympfc3RhdGU7CisKKwlvYmpfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9wcml2YXRlX29ial9zdGF0
ZShzdGF0ZSwgJmJyaWRnZS0+YmFzZSk7CisJaWYgKCFvYmpfc3RhdGUpCisJCXJldHVybiBOVUxM
OworCisJcmV0dXJuIGRybV9wcml2X3RvX2JyaWRnZV9zdGF0ZShvYmpfc3RhdGUpOworfQorCitz
dGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICoKK2RybV9hdG9taWNfZ2V0X29s
ZF9icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCXN0cnVj
dCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpvYmpf
c3RhdGU7CisKKwlvYmpfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfcHJpdmF0ZV9vYmpfc3Rh
dGUoc3RhdGUsICZicmlkZ2UtPmJhc2UpOworCWlmICghb2JqX3N0YXRlKQorCQlyZXR1cm4gTlVM
TDsKKworCXJldHVybiBkcm1fcHJpdl90b19icmlkZ2Vfc3RhdGUob2JqX3N0YXRlKTsKK30KKwor
c3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqCitkcm1fYXRvbWljX2dldF9u
ZXdfYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQlzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAqb2Jq
X3N0YXRlOworCisJb2JqX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X3ByaXZhdGVfb2JqX3N0
YXRlKHN0YXRlLCAmYnJpZGdlLT5iYXNlKTsKKwlpZiAoIW9ial9zdGF0ZSkKKwkJcmV0dXJuIE5V
TEw7CisKKwlyZXR1cm4gZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKG9ial9zdGF0ZSk7Cit9CisK
ICNpZmRlZiBDT05GSUdfRFJNX1BBTkVMX0JSSURHRQogc3RydWN0IGRybV9icmlkZ2UgKmRybV9w
YW5lbF9icmlkZ2VfYWRkKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsLAogCQkJCQl1MzIgY29ubmVj
dG9yX3R5cGUpOwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWw=
