Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 17FAA5F4FF
	for <lists+dri-devel@lfdr.de>; Thu,  4 Jul 2019 10:54:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8698B6E315;
	Thu,  4 Jul 2019 08:54:20 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 058DF6E315;
 Thu,  4 Jul 2019 08:54:19 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Jul 2019 01:54:19 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,450,1557212400"; d="scan'208";a="247882861"
Received: from ovasilev-desk1.fi.intel.com ([10.237.72.57])
 by orsmga001.jf.intel.com with ESMTP; 04 Jul 2019 01:54:17 -0700
From: Oleg Vasilev <oleg.vasilev@intel.com>
To: dri-devel@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Subject: [PATCH] drm/vkms: prime import support
Date: Thu,  4 Jul 2019 11:54:10 +0300
Message-Id: <20190704085410.12749-1-oleg.vasilev@intel.com>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Haneen Mohammed <hamohammed.sa@gmail.com>,
 Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QnJpbmcgZG1hYnVmIHNoYXJpbmcgdGhyb3VnaCBpbXBsZW1lbnRpbmcgcHJpbWVfaW1wb3J0X3Nn
X3RhYmxlIGNhbGxiYWNrLgpUaGlzIHdpbGwgaGVscCB0byB2YWxpZGF0ZSB1c2Vyc3BhY2UgY29u
Zm9ybWFuY2UgaW4gcHJpbWUgY29uZmlndXJhdGlvbnMKd2l0aG91dCB1c2luZyBhbnkgYWN0dWFs
IGhhcmR3YXJlIChlLmcuIGluIHRoZSBjbG91ZCkuCgpDYzogUm9kcmlnbyBTaXF1ZWlyYSA8cm9k
cmlnb3NpcXVlaXJhbWVsb0BnbWFpbC5jb20+CkNjOiBIYW5lZW4gTW9oYW1tZWQgPGhhbW9oYW1t
ZWQuc2FAZ21haWwuY29tPgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsQGZmd2xsLmNoPgpTaWdu
ZWQtb2ZmLWJ5OiBPbGVnIFZhc2lsZXYgPG9sZWcudmFzaWxldkBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuYyB8ICA2ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0v
dmttcy92a21zX2Rydi5oIHwgIDkgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19n
ZW0uYyB8IDQ2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFu
Z2VkLCA2MSBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMv
dmttc19kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfZHJ2LmMKaW5kZXggY2M1M2Vm
ODhhMzMxLi5iNzFjMTZkOWNhMDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3Zr
bXNfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuYwpAQCAtMTAsNiAr
MTAsNyBAQAogICovCiAKICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51
eC9kbWEtYnVmLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KICNpbmNsdWRlIDxkcm0vZHJt
X2F0b21pYy5oPgogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgpAQCAtOTYsNiAr
OTcsOCBAQCBzdGF0aWMgc3RydWN0IGRybV9kcml2ZXIgdmttc19kcml2ZXIgPSB7CiAJLmdlbV92
bV9vcHMJCT0gJnZrbXNfZ2VtX3ZtX29wcywKIAkuZ2VtX2ZyZWVfb2JqZWN0X3VubG9ja2VkID0g
dmttc19nZW1fZnJlZV9vYmplY3QsCiAJLmdldF92YmxhbmtfdGltZXN0YW1wCT0gdmttc19nZXRf
dmJsYW5rX3RpbWVzdGFtcCwKKwkucHJpbWVfZmRfdG9faGFuZGxlCT0gZHJtX2dlbV9wcmltZV9m
ZF90b19oYW5kbGUsCisJLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUgPSB2a21zX3ByaW1lX2lt
cG9ydF9zZ190YWJsZSwKIAogCS5uYW1lCQkJPSBEUklWRVJfTkFNRSwKIAkuZGVzYwkJCT0gRFJJ
VkVSX0RFU0MsCkBAIC0xNDcsNiArMTUwLDkgQEAgc3RhdGljIGludCBfX2luaXQgdmttc19pbml0
KHZvaWQpCiAKIAlyZXQgPSBkcm1fZGV2X2luaXQoJnZrbXNfZGV2aWNlLT5kcm0sICZ2a21zX2Ry
aXZlciwKIAkJCSAgICZ2a21zX2RldmljZS0+cGxhdGZvcm0tPmRldik7CisKKwlkbWFfY29lcmNl
X21hc2tfYW5kX2NvaGVyZW50KHZrbXNfZGV2aWNlLT5kcm0uZGV2LAorCQkJCSAgICAgRE1BX0JJ
VF9NQVNLKDY0KSk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5yZWdpc3RlcjsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92
a21zL3ZrbXNfZHJ2LmgKaW5kZXggMTJiNGRiN2FjNjQxLi5mYjE1MTAxYzhmM2UgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3ZrbXMvdmttc19kcnYuaApAQCAtMTI2LDYgKzEyNiw5IEBAIHN0cnVjdCBkcm1fZ2VtX29iamVj
dCAqdmttc19nZW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJICAgICAgIHUz
MiAqaGFuZGxlLAogCQkJCSAgICAgICB1NjQgc2l6ZSk7CiAKK3N0cnVjdCB2a21zX2dlbV9vYmpl
Y3QgKnZrbXNfZ2VtX2NyZWF0ZV9wcml2YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJ
CQl1NjQgc2l6ZSk7CisKIHZtX2ZhdWx0X3Qgdmttc19nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0
ICp2bWYpOwogCiBpbnQgdmttc19kdW1iX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsIHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCkBAIC0xMzcsNiArMTQwLDEyIEBAIGludCB2a21zX2dlbV92
bWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKIAogdm9pZCB2a21zX2dlbV92dW5tYXAo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopOwogCisvKiBQcmltZSAqLworc3RydWN0IGRybV9n
ZW1fb2JqZWN0ICoKK3ZrbXNfcHJpbWVfaW1wb3J0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsCisJCQkgICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCisJCQkgICBz
dHJ1Y3Qgc2dfdGFibGUgKnNnKTsKKwogLyogQ1JDIFN1cHBvcnQgKi8KIGNvbnN0IGNoYXIgKmNv
bnN0ICp2a21zX2dldF9jcmNfc291cmNlcyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkJCXNp
emVfdCAqY291bnQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19nZW0u
YyBiL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfZ2VtLmMKaW5kZXggNjkwNDhlNzMzNzdkLi5h
MWI4Mzc0NjBmNjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfZ2VtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19nZW0uYwpAQCAtMSw1ICsxLDYgQEAKIC8v
IFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wKwogCisjaW5jbHVkZSA8bGludXgvZG1h
LWJ1Zi5oPgogI2luY2x1ZGUgPGxpbnV4L3NobWVtX2ZzLmg+CiAKICNpbmNsdWRlICJ2a21zX2Ry
di5oIgpAQCAtMTE3LDYgKzExOCwyNSBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnZrbXNfZ2Vt
X2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXJldHVybiAmb2JqLT5nZW07CiB9CiAK
K3N0cnVjdCB2a21zX2dlbV9vYmplY3QgKnZrbXNfZ2VtX2NyZWF0ZV9wcml2YXRlKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsCisJCQkJCQl1NjQgc2l6ZSkKK3sKKwlzdHJ1Y3Qgdmttc19nZW1fb2Jq
ZWN0ICpvYmo7CisKKwlvYmogPSBremFsbG9jKHNpemVvZigqb2JqKSwgR0ZQX0tFUk5FTCk7CisK
KwlpZiAoIW9iaikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlzaXplID0gcm91bmR1
cChzaXplLCBQQUdFX1NJWkUpOworCisJZHJtX2dlbV9wcml2YXRlX29iamVjdF9pbml0KGRldiwg
Jm9iai0+Z2VtLCBzaXplKTsKKworCW11dGV4X2luaXQoJm9iai0+cGFnZXNfbG9jayk7CisKKwly
ZXR1cm4gb2JqOworfQorCiBpbnQgdmttc19kdW1iX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUsIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAgICAgc3RydWN0IGRybV9tb2RlX2NyZWF0
ZV9kdW1iICphcmdzKQogewpAQCAtMjE3LDMgKzIzNywyOSBAQCBpbnQgdmttc19nZW1fdm1hcChz
dHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKIAltdXRleF91bmxvY2soJnZrbXNfb2JqLT5wYWdl
c19sb2NrKTsKIAlyZXR1cm4gcmV0OwogfQorCitzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgordmtt
c19wcmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJCSAgIHN0
cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKKwkJCSAgIHN0cnVjdCBzZ190YWJsZSAq
c2cpCit7CisJc3RydWN0IHZrbXNfZ2VtX29iamVjdCAqb2JqOworCWludCBucGFnZXM7CisKKwlv
YmogPSBfX3ZrbXNfZ2VtX2NyZWF0ZShkZXYsIGF0dGFjaC0+ZG1hYnVmLT5zaXplKTsKKwlpZiAo
SVNfRVJSKG9iaikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOworCisJbnBhZ2VzID0gUEFHRV9B
TElHTihhdHRhY2gtPmRtYWJ1Zi0+c2l6ZSkgLyBQQUdFX1NJWkU7CisJRFJNX0RFQlVHX1BSSU1F
KCJJbXBvcnRpbmcgJWQgIHBhZ2VzXG4iLCBucGFnZXMpOworCisJb2JqLT5wYWdlcyA9IGt2bWFs
bG9jX2FycmF5KG5wYWdlcywgc2l6ZW9mKHN0cnVjdCBwYWdlICopLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIW9iai0+cGFnZXMpIHsKKwkJdmttc19nZW1fZnJlZV9vYmplY3QoJm9iai0+Z2VtKTsKKwkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJfQorCisJZHJtX3ByaW1lX3NnX3RvX3BhZ2VfYWRk
cl9hcnJheXMoc2csIG9iai0+cGFnZXMsIE5VTEwsCisJCQkJCSBucGFnZXMpOworCXJldHVybiAm
b2JqLT5nZW07Cit9Ci0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
