Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0ED19B56A1
	for <lists+dri-devel@lfdr.de>; Tue, 17 Sep 2019 22:04:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 14A396ED3D;
	Tue, 17 Sep 2019 20:04:53 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yw1-xc42.google.com (mail-yw1-xc42.google.com
 [IPv6:2607:f8b0:4864:20::c42])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EED7F6ED3D
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Sep 2019 20:04:50 +0000 (UTC)
Received: by mail-yw1-xc42.google.com with SMTP id 201so1605658ywn.13
 for <dri-devel@lists.freedesktop.org>; Tue, 17 Sep 2019 13:04:50 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=wkqE9utRolz42+Kkf6uy7tQVtznTQJwx51DLaVFkD8s=;
 b=HVHgVRI+Dfc90atQHZYYdRaH/r1r389z5U2Wo3TzWaHgghpNDANH2D7row4JtCSIRS
 7ytwNzJV3WhvZcH21RnCJA3TILbx8GEwbDiYa8KbRsqriS8/kOa+s4mnjZJaAu1oDXHS
 sr4o8uX+rI1zWx+/Ocm7/kePmtwnA3jTuutoreuehoDyOBfaZaIgphjqUn6MGIdty/Xz
 v0+ufebv2cviTbS+ibA81UL1/uU/bRjbGVT8DCiSlMZR0vhg6VIQPhwfeL7OUuzSMaVw
 b8Z3lL/KO2wGIqyHcOOeetYCPaXSJO8EmlSE5C+2bN06BW0wCRXv4U+/IkLzOqr9PSkw
 JaIw==
X-Gm-Message-State: APjAAAW4+16IJjGMzDCn2NWRxxuSYZ5vGyRPAyIFvOXdNcfI84wYWEoI
 K17I5a4fpUjhuARWanLXqoZFxFmvLDgoJQ==
X-Google-Smtp-Source: APXvYqw/X4iooG1+kY/6j/ft28vKNqk/hvJe0EcXnSU5e0gkJiQebL+/eMVtLWPKP2YnCfWB/DbM6g==
X-Received: by 2002:a81:98cb:: with SMTP id p194mr347606ywg.0.1568750689894;
 Tue, 17 Sep 2019 13:04:49 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id g128sm662175ywb.13.2019.09.17.13.04.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 17 Sep 2019 13:04:49 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 2/2] drm: Measure Self Refresh Entry/Exit times to avoid
 thrashing
Date: Tue, 17 Sep 2019 16:04:33 -0400
Message-Id: <20190917200443.64481-2-sean@poorly.run>
X-Mailer: git-send-email 2.23.0.237.gc6a4ce50a0-goog
In-Reply-To: <20190917200443.64481-1-sean@poorly.run>
References: <20190917200443.64481-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=wkqE9utRolz42+Kkf6uy7tQVtznTQJwx51DLaVFkD8s=;
 b=FqCh2jMzJpjxjY2DX73H9fuioBZym3EBg3tQDrGlIaKQQ8MADR2/GVZcMk1xt9Wh3t
 wNaqjS1jlj1LQKOf2QzzLdtXry2kDx1eo7LsQZEJMWxTfthInm98AVx6vLyr3JR8/2ec
 YRT4ew6L6rQE2YjAR8jV096ZtSGXpmDrOzpuqGMwoPypw5M0wGXsryRZ3f1BeelvmrH2
 8Y6/V80OFd3OOSea0UgJcEzlct6oWBH7odL44VZ0CAzzDw2/FMvepoC39jDnkOflAHI7
 JXwLg8CTOJBk8ccQyDRtFX7RAhfk+RFARL1OBsCjzY+3xfFASxbIFYYGEmjEn5e8i3v1
 9L8Q==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>, David Airlie <airlied@linux.ie>,
 Sean Paul <seanpaul@chromium.org>, jekarl@iki.fi, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpDdXJyZW50bHkgdGhlIHNl
bGYgcmVmcmVzaCBpZGxlIHRpbWVyIGlzIGEgY29uc3Qgc2V0IGJ5IHRoZSBjcnRjLiBUaGlzCmlz
IGZpbmUgaWYgdGhlIHNlbGYgcmVmcmVzaCBlbnRyeS9leGl0IHRpbWVzIGFyZSB3ZWxsLWtub3du
IGZvciBhbGwKcGFuZWxzIHVzZWQgb24gdGhhdCBjcnRjLiBIb3dldmVyIHBhbmVscyBhbmQgd29y
a2xvYWRzIGNhbiB2YXJ5IHF1aXRlIGEKYml0LCBhbmQgYSB0aW1lb3V0IHdoaWNoIHdvcmtzIHdl
bGwgZm9yIG9uZSBkb2Vzbid0IHdvcmsgd2VsbCBmb3IKYW5vdGhlci4KCkluIHRoZSBleHRyZW1l
LCBpZiB0aGUgdGltZW91dCBpcyB0b28gc2hvcnQgd2UgY291bGQgZ2V0IGluIGEgc2l0dWF0aW9u
CndoZXJlIHRoZSBzZWxmIHJlZnJlc2ggZXhpdHMgYXJlIHRha2luZyBzbyBsb25nIHdlIHF1ZXVl
IHVwIGEgc2VsZiByZWZyZXNoCmVudHJ5IGJlZm9yZSB0aGUgZXhpdCBjb21taXQgaXMgZXZlbiBm
aW5pc2hlZC4KClRoaXMgcGF0Y2ggY2hhbmdlcyB0aGUgaWRsZSB0aW1lb3V0IHRvIGEgbW92aW5n
IGF2ZXJhZ2Ugb2YgdGhlIGVudHJ5CnRpbWVzICsgYSBtb3ZpbmcgYXZlcmFnZSBvZiBleGl0IHRp
bWVzICsgdGhlIGNydGMgY29uc3RhbnQuCgpUaGlzIHBhdGNoIHdhcyB0ZXN0ZWQgb24gcm9ja2No
aXAsIHdpdGggYSAia2V2aW4iIENyT1MgcGFuZWwgdGhlIGlkbGUKZGVsYXkgYXZlcmFnZXMgb3V0
IHRvIGFib3V0IH4yMzVtcyAoMzUgZW50cnkgKyAxMDAgZXhpdCArIDEwMCBjb25zdCkuIE9uCnRo
ZSBzYW1lIGJvYXJkLCB0aGUgImJvYiIgcGFuZWwgaWRsZSBkZWxheSBsYW5kcyBhcm91bmQgfjM0
MG1zICg5MCBlbnRyeQorIDE1MCBleGl0ICsgMTAwIGNvbnN0KS4KClNpZ25lZC1vZmYtYnk6IFNl
YW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1f
YXRvbWljX2hlbHBlci5jICAgICAgIHwgMjAgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2RybV9z
ZWxmX3JlZnJlc2hfaGVscGVyLmMgfCA3MSArKysrKysrKysrKysrKysrKysrKysrLQogaW5jbHVk
ZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaCAgICAgfCAgMiArCiAzIGZpbGVzIGNoYW5n
ZWQsIDkyIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWlj
X2hlbHBlci5jCmluZGV4IDlkN2U0ZGE2YzI5Mi4uM2YxM2ZhOWE5ZTI0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pY19oZWxwZXIuYwpAQCAtMjYsNiArMjYsNyBAQAogICovCiAKICNpbmNsdWRlIDxs
aW51eC9kbWEtZmVuY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9rdGltZS5oPgogCiAjaW5jbHVkZSA8
ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KQEAg
LTE1NzAsOSArMTU3MSwyMyBAQCBzdGF0aWMgdm9pZCBjb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBvbGRf
c3RhdGUtPmRldjsKIAljb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2hlbHBlcl9mdW5jcyAq
ZnVuY3M7CisJa3RpbWVfdCBzdGFydDsKKwlzNjQgY29tbWl0X3RpbWVfbXM7CiAKIAlmdW5jcyA9
IGRldi0+bW9kZV9jb25maWcuaGVscGVyX3ByaXZhdGU7CiAKKwkvKgorCSAqIFdlJ3JlIG1lYXN1
cmluZyB0aGUgX2VudGlyZV8gY29tbWl0LCBzbyB0aGUgdGltZSB3aWxsIHZhcnkgZGVwZW5kaW5n
CisJICogb24gaG93IG1hbnkgZmVuY2VzIGFuZCBvYmplY3RzIGFyZSBpbnZvbHZlZC4gRm9yIHRo
ZSBwdXJwb3NlcyBvZiBzZWxmCisJICogcmVmcmVzaCwgdGhpcyBpcyBkZXNpcmFibGUgc2luY2Ug
aXQnbGwgZ2l2ZSB1cyBhbiBpZGVhIG9mIGhvdworCSAqIGNvbmdlc3RlZCB0aGluZ3MgYXJlLiBU
aGlzIHdpbGwgaW5mb3JtIG91ciBkZWNpc2lvbiBvbiBob3cgb2Z0ZW4gd2UKKwkgKiBzaG91bGQg
ZW50ZXIgc2VsZiByZWZyZXNoIGFmdGVyIGlkbGUuCisJICoKKwkgKiBUaGVzZSB0aW1lcyB3aWxs
IGJlIGF2ZXJhZ2VkIG91dCBpbiB0aGUgc2VsZiByZWZyZXNoIGhlbHBlcnMgdG8gYXZvaWQKKwkg
KiBvdmVycmVhY3Rpbmcgb3ZlciBvbmUgb3V0bGllciBmcmFtZQorCSAqLworCXN0YXJ0ID0ga3Rp
bWVfZ2V0KCk7CisKIAlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9mZW5jZXMoZGV2LCBvbGRf
c3RhdGUsIGZhbHNlKTsKIAogCWRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX2RlcGVuZGVuY2ll
cyhvbGRfc3RhdGUpOwpAQCAtMTU4Miw2ICsxNTk3LDExIEBAIHN0YXRpYyB2b2lkIGNvbW1pdF90
YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiAJZWxzZQogCQlkcm1fYXRv
bWljX2hlbHBlcl9jb21taXRfdGFpbChvbGRfc3RhdGUpOwogCisJY29tbWl0X3RpbWVfbXMgPSBr
dGltZV9tc19kZWx0YShrdGltZV9nZXQoKSwgc3RhcnQpOworCWlmIChjb21taXRfdGltZV9tcyA+
IDApCisJCWRybV9zZWxmX3JlZnJlc2hfaGVscGVyX3VwZGF0ZV9hdmdfdGltZXMob2xkX3N0YXRl
LAorCQkJCQkJICh1bnNpZ25lZCBsb25nKWNvbW1pdF90aW1lX21zKTsKKwogCWRybV9hdG9taWNf
aGVscGVyX2NvbW1pdF9jbGVhbnVwX2RvbmUob2xkX3N0YXRlKTsKIAogCWRybV9hdG9taWNfc3Rh
dGVfcHV0KG9sZF9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3NlbGZf
cmVmcmVzaF9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBl
ci5jCmluZGV4IDkwOTVjZWJmMjE0Ny4uNTIyNDMwZjhlZWYxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuYwpAQCAtNSw2ICs1LDcgQEAKICAqIEF1dGhvcnM6CiAg
KiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4KICAqLworI2luY2x1ZGUgPGxpbnV4
L2F2ZXJhZ2UuaD4KICNpbmNsdWRlIDxsaW51eC9iaXRvcHMuaD4KICNpbmNsdWRlIDxsaW51eC9z
bGFiLmg+CiAjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CkBAIC01MCwxMCArNTEsMTYgQEAK
ICAqIGF0b21pY19jaGVjayB3aGVuICZkcm1fY3J0Y19zdGF0ZS5zZWxmX3JlZnJlc2hfYWN0aXZl
IGlzIHRydWUuCiAgKi8KIAorREVDTEFSRV9FV01BKHBzcl90aW1lLCA0LCA0KQorCiBzdHJ1Y3Qg
ZHJtX3NlbGZfcmVmcmVzaF9kYXRhIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CiAJc3RydWN0
IGRlbGF5ZWRfd29yayBlbnRyeV93b3JrOwogCXVuc2lnbmVkIGludCBlbnRyeV9kZWxheV9tczsK
KworCXN0cnVjdCBtdXRleCBhdmdfbXV0ZXg7CisJc3RydWN0IGV3bWFfcHNyX3RpbWUgZW50cnlf
YXZnX21zOworCXN0cnVjdCBld21hX3Bzcl90aW1lIGV4aXRfYXZnX21zOwogfTsKIAogc3RhdGlj
IHZvaWQgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfZW50cnlfd29yayhzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCkBAIC0xMjEsNiArMTI4LDU5IEBAIHN0YXRpYyB2b2lkIGRybV9zZWxmX3JlZnJl
c2hfaGVscGVyX2VudHJ5X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWRybV9tb2Rl
c2V0X2FjcXVpcmVfZmluaSgmY3R4KTsKIH0KIAorLyoqCisgKiBkcm1fc2VsZl9yZWZyZXNoX2hl
bHBlcl91cGRhdGVfYXZnX3RpbWVzIC0gVXBkYXRlcyBhIGNydGMncyBTUiB0aW1lIGF2ZXJhZ2Vz
CisgKiBAc3RhdGU6IHRoZSBzdGF0ZSB3aGljaCBoYXMganVzdCBiZWVuIGFwcGxpZWQgdG8gaGFy
ZHdhcmUKKyAqIEBjb21taXRfdGltZV9tczogdGhlIGFtb3VudCBvZiB0aW1lIGluIG1zIHRoYXQg
dGhpcyBjb21taXQgdG9vayB0byBjb21wbGV0ZQorICoKKyAqIENhbGxlZCBhZnRlciAmZHJtX21v
ZGVfY29uZmlnX2Z1bmNzLmF0b21pY19jb21taXRfdGFpbCwgdGhpcyBmdW5jdGlvbiB3aWxsCisg
KiB1cGRhdGUgdGhlIGF2ZXJhZ2UgZW50cnkvZXhpdCBzZWxmIHJlZnJlc2ggdGltZXMgb24gc2Vs
ZiByZWZyZXNoIHRyYW5zaXRpb25zLgorICogVGhlc2UgYXZlcmFnZXMgd2lsbCBiZSB1c2VkIHdo
ZW4gY2FsY3VsYXRpbmcgaG93IGxvbmcgdG8gZGVsYXkgYmVmb3JlCisgKiBlbnRlcmluZyBzZWxm
IHJlZnJlc2ggbW9kZSBhZnRlciBhY3Rpdml0eS4KKyAqLwordm9pZCBkcm1fc2VsZl9yZWZyZXNo
X2hlbHBlcl91cGRhdGVfYXZnX3RpbWVzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwK
KwkJCQkJICAgICAgdW5zaWduZWQgaW50IGNvbW1pdF90aW1lX21zKQoreworCXN0cnVjdCBkcm1f
Y3J0YyAqY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLCAqbmV3
X2NydGNfc3RhdGU7CisJaW50IGk7CisKKwlmb3JfZWFjaF9vbGRuZXdfY3J0Y19pbl9zdGF0ZShz
dGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCisJCQkJICAgICAgbmV3X2NydGNfc3RhdGUsIGkp
IHsKKwkJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3JfZGF0YSA9IGNydGMtPnNlbGZf
cmVmcmVzaF9kYXRhOworCQlzdHJ1Y3QgZXdtYV9wc3JfdGltZSAqdGltZTsKKworCQlpZiAob2xk
X2NydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUgPT0KKwkJICAgIG5ld19jcnRjX3N0YXRl
LT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQkJY29udGludWU7CisKKwkJaWYgKG5ld19jcnRjX3N0
YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQkJdGltZSA9ICZzcl9kYXRhLT5lbnRyeV9hdmdf
bXM7CisJCWVsc2UKKwkJCXRpbWUgPSAmc3JfZGF0YS0+ZXhpdF9hdmdfbXM7CisKKwkJLyoKKwkJ
ICogSXQgbWlnaHQgYmUgbmljZSBpZiB3ZSBjb3VsZCByZWx5IG9uICZkcm1fY3J0Yy5tdXRleCB0
bworCQkgKiBwcm90ZWN0ICZkcm1fc2VsZl9yZWZyZXNoX2RhdGEuZXhpdF9hdmdfbXMsIGFzIHdl
IGRvIHdpdGgKKwkJICogJmRybV9zZWxmX3JlZnJlc2hfZGF0YS5lbnRyeV9hdmdfbXMsIGJ1dCB0
aGVyZSBhcmUgYSBmZXcKKwkJICogcmVhc29ucyB3aHkgYSBzZXBhcmF0ZSBsb2NrIGlzIGEgYmV0
dGVyIGNob2ljZToKKwkJICogLSBXZSBjYW4ndCByZWx5IG9uICZkcm1fY3J0Yy5tdXRleCBiZWlu
ZyBoZWxkIGhlcmUgaWYgd2UncmUKKwkJICogICBkb2luZyBhIG5vbmJsb2NraW5nIGNvbW1pdAor
CQkgKiAtIFdlIGNhbid0IGdyYWIgJmRybV9jcnRjLm11dGV4IGhlcmUgc2luY2UgZHJtX21vZGVz
ZXRfbG9jaygpCisJCSAqICAgZG9lc24ndCB0ZWxsIHVzIHdoZXRoZXIgdGhlIGxvY2sgd2FzIGFs
cmVhZHkgaGVsZCBpbiB0aGUKKwkJICogICBhY3F1aXJlIGNvbnRleHQgKGl0IGVhdHMgLUVBTFJF
QURZKSwgc28gd2UgY2FuJ3QgdGVsbCBpZiB3ZQorCQkgKiAgIHNob3VsZCBkcm9wIGl0IG9yIG5v
dAorCQkgKiAtIFdlIGRvbid0IG5lZWQgc3VjaCBhIGhlYXZ5LWhhbmRlZCBsb2NrIGZvciB3aGF0
IHdlJ3JlCisJCSAqICAgdHJ5aW5nIHRvIGRvIGhlcmUsIGNvbW1pdCBvcmRlcmluZyBkb2Vzbid0
IG1hdHRlciwgc28gYQorCQkgKiAgIHBvaW50LW9mLXVzZSBsb2NrIHdpbGwgYmUgbGVzcyBjb250
ZW50aW91cworCQkgKi8KKwkJbXV0ZXhfbG9jaygmc3JfZGF0YS0+YXZnX211dGV4KTsKKwkJZXdt
YV9wc3JfdGltZV9hZGQodGltZSwgY29tbWl0X3RpbWVfbXMpOworCQltdXRleF91bmxvY2soJnNy
X2RhdGEtPmF2Z19tdXRleCk7CisJfQorfQorRVhQT1JUX1NZTUJPTChkcm1fc2VsZl9yZWZyZXNo
X2hlbHBlcl91cGRhdGVfYXZnX3RpbWVzKTsKKwogLyoqCiAgKiBkcm1fc2VsZl9yZWZyZXNoX2hl
bHBlcl9hbHRlcl9zdGF0ZSAtIEFsdGVycyB0aGUgYXRvbWljIHN0YXRlIGZvciBTUiBleGl0CiAg
KiBAc3RhdGU6IHRoZSBzdGF0ZSBjdXJyZW50bHkgYmVpbmcgY2hlY2tlZApAQCAtMTUyLDYgKzIx
Miw3IEBAIHZvaWQgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfYWx0ZXJfc3RhdGUoc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3Rh
dGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKIAkJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0
YSAqc3JfZGF0YTsKKwkJdW5zaWduZWQgaW50IGRlbGF5OwogCiAJCS8qIERvbid0IHRyaWdnZXIg
dGhlIGVudHJ5IHRpbWVyIHdoZW4gd2UncmUgYWxyZWFkeSBpbiBTUiAqLwogCQlpZiAoY3J0Y19z
dGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSkKQEAgLTE2MSw4ICsyMjIsMTMgQEAgdm9pZCBkcm1f
c2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJCWlmICghc3JfZGF0YSkKIAkJCWNvbnRpbnVlOwogCisJCW11dGV4X2xvY2soJnNy
X2RhdGEtPmF2Z19tdXRleCk7CisJCWRlbGF5ID0gZXdtYV9wc3JfdGltZV9yZWFkKCZzcl9kYXRh
LT5lbnRyeV9hdmdfbXMpICsKKwkJCWV3bWFfcHNyX3RpbWVfcmVhZCgmc3JfZGF0YS0+ZXhpdF9h
dmdfbXMpICsKKwkJCXNyX2RhdGEtPmVudHJ5X2RlbGF5X21zOworCQltdXRleF91bmxvY2soJnNy
X2RhdGEtPmF2Z19tdXRleCk7CiAJCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmc3JfZGF0
YS0+ZW50cnlfd29yaywKLQkJCQkgbXNlY3NfdG9famlmZmllcyhzcl9kYXRhLT5lbnRyeV9kZWxh
eV9tcykpOworCQkJCSBtc2Vjc190b19qaWZmaWVzKGRlbGF5KSk7CiAJfQogfQogRVhQT1JUX1NZ
TUJPTChkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZSk7CkBAIC0xOTEsNiArMjU3
LDkgQEAgaW50IGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQoc3RydWN0IGRybV9jcnRjICpj
cnRjLAogCQkJICBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9lbnRyeV93b3JrKTsKIAlzcl9kYXRh
LT5lbnRyeV9kZWxheV9tcyA9IGVudHJ5X2RlbGF5X21zOwogCXNyX2RhdGEtPmNydGMgPSBjcnRj
OworCW11dGV4X2luaXQoJnNyX2RhdGEtPmF2Z19tdXRleCk7CisJZXdtYV9wc3JfdGltZV9pbml0
KCZzcl9kYXRhLT5lbnRyeV9hdmdfbXMpOworCWV3bWFfcHNyX3RpbWVfaW5pdCgmc3JfZGF0YS0+
ZXhpdF9hdmdfbXMpOwogCiAJY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGEgPSBzcl9kYXRhOwogCXJl
dHVybiAwOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIu
aCBiL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKaW5kZXggMzk3YTU4M2Nj
Y2E3Li5mZjc3NzY5MGM1NjQgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJl
c2hfaGVscGVyLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaApA
QCAtMTIsNiArMTIsOCBAQCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZTsKIHN0cnVjdCBkcm1fY3J0
YzsKIAogdm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZShzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqc3RhdGUpOwordm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl91cGRh
dGVfYXZnX3RpbWVzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkJICAgICAg
dW5zaWduZWQgaW50IGNvbW1pdF90aW1lX21zKTsKIAogaW50IGRybV9zZWxmX3JlZnJlc2hfaGVs
cGVyX2luaXQoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJCSB1bnNpZ25lZCBpbnQgZW50cnlf
ZGVsYXlfbXMpOwotLSAKU2VhbiBQYXVsLCBTb2Z0d2FyZSBFbmdpbmVlciwgR29vZ2xlIC8gQ2hy
b21pdW0gT1MKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
