Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B3A8359633
	for <lists+dri-devel@lfdr.de>; Fri,  9 Apr 2021 09:17:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CCFC56EB83;
	Fri,  9 Apr 2021 07:17:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x52d.google.com (mail-ed1-x52d.google.com
 [IPv6:2a00:1450:4864:20::52d])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0204E6E47E
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Apr 2021 07:17:28 +0000 (UTC)
Received: by mail-ed1-x52d.google.com with SMTP id w18so5390583edc.0
 for <dri-devel@lists.freedesktop.org>; Fri, 09 Apr 2021 00:17:28 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=gbjvidtHezwGj4SvL2Dc9DE4DP5+DorOADCoNSePk0o=;
 b=r5imc+noURb/sXKErdXVdbUdGts2IWxjfj5so6adBwjlq4IAcXJeNbVW/IydyIy8OE
 /ZvbzxhoSjZIJV8g3P3QepUFZSpKDDI+DbQJb2QHBnYlNkP6yByWo0arkonzdJRLYO6w
 juj+aswm7fZYfMB9yeZooUD2jpvciU2nweFoe3A2EeoCHr52pdDRQMTK1XzGU5Ntj+/e
 3gApRInc3hLv+qTx0pwI91QTLvAJ7RJYti7IJSVTrBM09paQbZwEKVSDb+s4dA0fqkRg
 1oUeeSfJJzvJQ3eLQwuWZFgsq895QmaCLfL080HYqTo8gZBp3teFwrPqQz55ckn8ZuEA
 riEA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=gbjvidtHezwGj4SvL2Dc9DE4DP5+DorOADCoNSePk0o=;
 b=Wyrh3LrC3mGhuXIzCMHDgld0fA8HolL47XhaFIwLg2Pyx7VE/S1ntAgb9b6SFkn/CY
 fM7a+29FS/bUmw/sY+bdz0rNiczIHlaiEHfOG9msJaYF84Pf0J5zn7J9HTMHHK+WZ2ye
 gj5ZqIJpaYN/fXJXb29a1lHyTNbxdrVySg/8fGdJCDCLg0hPHWlWwXJ93rvKbwHEP1hW
 UlPAxHsDOuLbEYBdkKShr+g1QsqWfHHNjDq9xyDAb7duJ0mX9IIkDCi8jV7Dj9wkummx
 u2PKVTKaSLanC3SCjKXoZ0A6/63QgPGL4eD5HIZodj+O5x7ns55srtgOerkjrqEvTmoz
 u6hQ==
X-Gm-Message-State: AOAM532seWmSQBCqq4aZ+5dnJ1yN5UB6ZTVapUExNr6+KSC9rKB7ZLIc
 KYlihZzXBO5419lJdiCmcyvWYhozSOY=
X-Google-Smtp-Source: ABdhPJwY0JBCnC6/OSxNGZjnksFU03VbvOIrPRv9gylJl43S3ie4aCAulRekCGDv/19tTtCYZA7oFg==
X-Received: by 2002:a05:6402:2786:: with SMTP id
 b6mr16140557ede.310.1617952647643; 
 Fri, 09 Apr 2021 00:17:27 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:216f:9340:7a2b:4f98])
 by smtp.gmail.com with ESMTPSA id w1sm905369edt.89.2021.04.09.00.17.27
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 09 Apr 2021 00:17:27 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-mm@kvack.org
Subject: [PATCH 2/2] drm/ttm: optimize the pool shrinker a bit
Date: Fri,  9 Apr 2021 09:17:25 +0200
Message-Id: <20210409071725.1532-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210409071725.1532-1-christian.koenig@amd.com>
References: <20210409071725.1532-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: akpm@linux-foundation.org, ray.huang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3dpdGNoIGJhY2sgdG8gdXNpbmcgYSBzcGlubG9jayBhZ2FpbiBieSBtb3ZpbmcgdGhlIElPTU1V
IHVubWFwIG91dHNpZGUKb2YgdGhlIGxvY2tlZCByZWdpb24uCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
c3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL3R0bS90dG1fcG9vbC5jIHwgNDAgKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0t
LQogMSBmaWxlIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDIyIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bvb2wuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX3Bvb2wuYwppbmRleCBjYjM4YjFhMTdiMDkuLmE4YjRhYmU2ODdjZSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX3Bvb2wuYwpAQCAtNzAsNyArNzAsNyBAQCBzdGF0aWMgc3RydWN0IHR0bV9wb29s
X3R5cGUgZ2xvYmFsX3VuY2FjaGVkW01BWF9PUkRFUl07CiBzdGF0aWMgc3RydWN0IHR0bV9wb29s
X3R5cGUgZ2xvYmFsX2RtYTMyX3dyaXRlX2NvbWJpbmVkW01BWF9PUkRFUl07CiBzdGF0aWMgc3Ry
dWN0IHR0bV9wb29sX3R5cGUgZ2xvYmFsX2RtYTMyX3VuY2FjaGVkW01BWF9PUkRFUl07CiAKLXN0
YXRpYyBzdHJ1Y3QgbXV0ZXggc2hyaW5rZXJfbG9jazsKK3N0YXRpYyBzcGlubG9ja190IHNocmlu
a2VyX2xvY2s7CiBzdGF0aWMgc3RydWN0IGxpc3RfaGVhZCBzaHJpbmtlcl9saXN0Owogc3RhdGlj
IHN0cnVjdCBzaHJpbmtlciBtbV9zaHJpbmtlcjsKIApAQCAtMjYzLDkgKzI2Myw5IEBAIHN0YXRp
YyB2b2lkIHR0bV9wb29sX3R5cGVfaW5pdChzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQsIHN0cnVj
dCB0dG1fcG9vbCAqcG9vbCwKIAlzcGluX2xvY2tfaW5pdCgmcHQtPmxvY2spOwogCUlOSVRfTElT
VF9IRUFEKCZwdC0+cGFnZXMpOwogCi0JbXV0ZXhfbG9jaygmc2hyaW5rZXJfbG9jayk7CisJc3Bp
bl9sb2NrKCZzaHJpbmtlcl9sb2NrKTsKIAlsaXN0X2FkZF90YWlsKCZwdC0+c2hyaW5rZXJfbGlz
dCwgJnNocmlua2VyX2xpc3QpOwotCW11dGV4X3VubG9jaygmc2hyaW5rZXJfbG9jayk7CisJc3Bp
bl91bmxvY2soJnNocmlua2VyX2xvY2spOwogfQogCiAvKiBSZW1vdmUgYSBwb29sX3R5cGUgZnJv
bSB0aGUgZ2xvYmFsIHNocmlua2VyIGxpc3QgYW5kIGZyZWUgYWxsIHBhZ2VzICovCkBAIC0yNzMs
OSArMjczLDkgQEAgc3RhdGljIHZvaWQgdHRtX3Bvb2xfdHlwZV9maW5pKHN0cnVjdCB0dG1fcG9v
bF90eXBlICpwdCkKIHsKIAlzdHJ1Y3QgcGFnZSAqcDsKIAotCW11dGV4X2xvY2soJnNocmlua2Vy
X2xvY2spOworCXNwaW5fbG9jaygmc2hyaW5rZXJfbG9jayk7CiAJbGlzdF9kZWwoJnB0LT5zaHJp
bmtlcl9saXN0KTsKLQltdXRleF91bmxvY2soJnNocmlua2VyX2xvY2spOworCXNwaW5fdW5sb2Nr
KCZzaHJpbmtlcl9sb2NrKTsKIAogCXdoaWxlICgocCA9IHR0bV9wb29sX3R5cGVfdGFrZShwdCkp
KQogCQl0dG1fcG9vbF9mcmVlX3BhZ2UocHQtPnBvb2wsIHB0LT5jYWNoaW5nLCBwdC0+b3JkZXIs
IHApOwpAQCAtMzEzLDI0ICszMTMsMTkgQEAgc3RhdGljIHN0cnVjdCB0dG1fcG9vbF90eXBlICp0
dG1fcG9vbF9zZWxlY3RfdHlwZShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsCiBzdGF0aWMgdW5zaWdu
ZWQgaW50IHR0bV9wb29sX3Nocmluayh2b2lkKQogewogCXN0cnVjdCB0dG1fcG9vbF90eXBlICpw
dDsKLQl1bnNpZ25lZCBpbnQgbnVtX2ZyZWVkOwogCXN0cnVjdCBwYWdlICpwOwogCi0JbXV0ZXhf
bG9jaygmc2hyaW5rZXJfbG9jayk7CisJc3Bpbl9sb2NrKCZzaHJpbmtlcl9sb2NrKTsKIAlwdCA9
IGxpc3RfZmlyc3RfZW50cnkoJnNocmlua2VyX2xpc3QsIHR5cGVvZigqcHQpLCBzaHJpbmtlcl9s
aXN0KTsKKwlsaXN0X21vdmVfdGFpbCgmcHQtPnNocmlua2VyX2xpc3QsICZzaHJpbmtlcl9saXN0
KTsKKwlzcGluX3VubG9jaygmc2hyaW5rZXJfbG9jayk7CiAKIAlwID0gdHRtX3Bvb2xfdHlwZV90
YWtlKHB0KTsKLQlpZiAocCkgewotCQl0dG1fcG9vbF9mcmVlX3BhZ2UocHQtPnBvb2wsIHB0LT5j
YWNoaW5nLCBwdC0+b3JkZXIsIHApOwotCQludW1fZnJlZWQgPSAxIDw8IHB0LT5vcmRlcjsKLQl9
IGVsc2UgewotCQludW1fZnJlZWQgPSAwOwotCX0KLQotCWxpc3RfbW92ZV90YWlsKCZwdC0+c2hy
aW5rZXJfbGlzdCwgJnNocmlua2VyX2xpc3QpOwotCW11dGV4X3VubG9jaygmc2hyaW5rZXJfbG9j
ayk7CisJaWYgKCFwKQorCQlyZXR1cm4gMDsKIAotCXJldHVybiBudW1fZnJlZWQ7CisJdHRtX3Bv
b2xfZnJlZV9wYWdlKHB0LT5wb29sLCBwdC0+Y2FjaGluZywgcHQtPm9yZGVyLCBwKTsKKwlyZXR1
cm4gMSA8PCBwdC0+b3JkZXI7CiB9CiAKIC8qIFJldHVybiB0aGUgYWxsb2NhdGlvbiBvcmRlciBi
YXNlZCBmb3IgYSBwYWdlICovCkBAIC01MzAsNiArNTI1LDcgQEAgdm9pZCB0dG1fcG9vbF9maW5p
KHN0cnVjdCB0dG1fcG9vbCAqcG9vbCkKIAkJCWZvciAoaiA9IDA7IGogPCBNQVhfT1JERVI7ICsr
aikKIAkJCQl0dG1fcG9vbF90eXBlX2ZpbmkoJnBvb2wtPmNhY2hpbmdbaV0ub3JkZXJzW2pdKTsK
IAl9CisJc3luY19zaHJpbmtlcnMoKTsKIH0KIAogLyogQXMgbG9uZyBhcyBwYWdlcyBhcmUgYXZh
aWxhYmxlIG1ha2Ugc3VyZSB0byByZWxlYXNlIGF0IGxlYXN0IG9uZSAqLwpAQCAtNjA0LDcgKzYw
MCw3IEBAIHN0YXRpYyBpbnQgdHRtX3Bvb2xfZGVidWdmc19nbG9iYWxzX3Nob3coc3RydWN0IHNl
cV9maWxlICptLCB2b2lkICpkYXRhKQogewogCXR0bV9wb29sX2RlYnVnZnNfaGVhZGVyKG0pOwog
Ci0JbXV0ZXhfbG9jaygmc2hyaW5rZXJfbG9jayk7CisJc3Bpbl9sb2NrKCZzaHJpbmtlcl9sb2Nr
KTsKIAlzZXFfcHV0cyhtLCAid2NcdDoiKTsKIAl0dG1fcG9vbF9kZWJ1Z2ZzX29yZGVycyhnbG9i
YWxfd3JpdGVfY29tYmluZWQsIG0pOwogCXNlcV9wdXRzKG0sICJ1Y1x0OiIpOwpAQCAtNjEzLDcg
KzYwOSw3IEBAIHN0YXRpYyBpbnQgdHRtX3Bvb2xfZGVidWdmc19nbG9iYWxzX3Nob3coc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCXR0bV9wb29sX2RlYnVnZnNfb3JkZXJzKGdsb2Jh
bF9kbWEzMl93cml0ZV9jb21iaW5lZCwgbSk7CiAJc2VxX3B1dHMobSwgInVjIDMyXHQ6Iik7CiAJ
dHRtX3Bvb2xfZGVidWdmc19vcmRlcnMoZ2xvYmFsX2RtYTMyX3VuY2FjaGVkLCBtKTsKLQltdXRl
eF91bmxvY2soJnNocmlua2VyX2xvY2spOworCXNwaW5fdW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsK
IAogCXR0bV9wb29sX2RlYnVnZnNfZm9vdGVyKG0pOwogCkBAIC02NDAsNyArNjM2LDcgQEAgaW50
IHR0bV9wb29sX2RlYnVnZnMoc3RydWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3Qgc2VxX2ZpbGUg
Km0pCiAKIAl0dG1fcG9vbF9kZWJ1Z2ZzX2hlYWRlcihtKTsKIAotCW11dGV4X2xvY2soJnNocmlu
a2VyX2xvY2spOworCXNwaW5fbG9jaygmc2hyaW5rZXJfbG9jayk7CiAJZm9yIChpID0gMDsgaSA8
IFRUTV9OVU1fQ0FDSElOR19UWVBFUzsgKytpKSB7CiAJCXNlcV9wdXRzKG0sICJETUEgIik7CiAJ
CXN3aXRjaCAoaSkgewpAQCAtNjU2LDcgKzY1Miw3IEBAIGludCB0dG1fcG9vbF9kZWJ1Z2ZzKHN0
cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHNlcV9maWxlICptKQogCQl9CiAJCXR0bV9wb29s
X2RlYnVnZnNfb3JkZXJzKHBvb2wtPmNhY2hpbmdbaV0ub3JkZXJzLCBtKTsKIAl9Ci0JbXV0ZXhf
dW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsKKwlzcGluX3VubG9jaygmc2hyaW5rZXJfbG9jayk7CiAK
IAl0dG1fcG9vbF9kZWJ1Z2ZzX2Zvb3RlcihtKTsKIAlyZXR1cm4gMDsKQEAgLTY5Myw3ICs2ODks
NyBAQCBpbnQgdHRtX3Bvb2xfbWdyX2luaXQodW5zaWduZWQgbG9uZyBudW1fcGFnZXMpCiAJaWYg
KCFwYWdlX3Bvb2xfc2l6ZSkKIAkJcGFnZV9wb29sX3NpemUgPSBudW1fcGFnZXM7CiAKLQltdXRl
eF9pbml0KCZzaHJpbmtlcl9sb2NrKTsKKwlzcGluX2xvY2tfaW5pdCgmc2hyaW5rZXJfbG9jayk7
CiAJSU5JVF9MSVNUX0hFQUQoJnNocmlua2VyX2xpc3QpOwogCiAJZm9yIChpID0gMDsgaSA8IE1B
WF9PUkRFUjsgKytpKSB7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbAo=
