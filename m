Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D6CF12F32AA
	for <lists+dri-devel@lfdr.de>; Tue, 12 Jan 2021 15:10:50 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B13E189C0A;
	Tue, 12 Jan 2021 14:10:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ot1-x336.google.com (mail-ot1-x336.google.com
 [IPv6:2607:f8b0:4864:20::336])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 693D489C0A
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Jan 2021 14:10:48 +0000 (UTC)
Received: by mail-ot1-x336.google.com with SMTP id d20so2362995otl.3
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Jan 2021 06:10:48 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=UbPDjVV7eiQE46lz9pUrptUivTdvHnasMOEhzxvTzBY=;
 b=lFaHaRJ4KevrpARMBGlPgAjgZ2hYJ21iDib61cTdKeO1Za+X/dktW0nhTZ0aZjK8+k
 W1vJuyBPCAch11E4HaOZmPiEx2qGwFWzOB1LSnGN53Xopc9iGfN+BvVtn8OcRcW0Xplx
 ODvv0vHzjo3i3lJw7Hn+QFXJkLVUd9a/6cXsk=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=UbPDjVV7eiQE46lz9pUrptUivTdvHnasMOEhzxvTzBY=;
 b=XfaNdruZHU4kSPPcYttOnwYeEhezTCPoj8Wt41QOxCZkOQOIbtbtCx9WRHsuy6yePb
 1xGaXsGRRSpDLYBrUYLbBjKQV/7lvTJidFxI0DfuR7A/qgR8DoFGcqwQirot6Qg8c8lx
 wLkvZE6YnJMWVEOanZoeZfOtVKYCkEDYcfNJxhdecJeQAbxtBp77mXLpA7TWaQewFqjp
 f2si6ZCwdf1wwOYbswsn3cRvo/aF0EnhoF//TocdxydhPzRmby2tCpVW2DGnYJwfpxli
 hOjiGovP70hW46Ghw10h0XxxNKc3J+DmGA2/RNfsuSPO12dlxLw5EH790wczAvVRtge0
 5Hww==
X-Gm-Message-State: AOAM5314sUAH9S7kae3hs4sifGyaHpwsOvAZr3NTBFo9RLiwll4uaGa+
 NoBQ9220PVS9oViHQqumohgBG7QO2XkAcBVOz0LJCApIB9Rn+g==
X-Google-Smtp-Source: ABdhPJxU11oI0IKxVCuXwbDyCKJ1ijEy95wo8Ig2GXuMwrYoMCooo/o6GbaB8HUdXs2v2k7kkuIlDP8oSPu2G00LLA8=
X-Received: by 2002:a05:6830:1bef:: with SMTP id
 k15mr2811331otb.303.1610460647749; 
 Tue, 12 Jan 2021 06:10:47 -0800 (PST)
MIME-Version: 1.0
References: <20210111135721.2704-1-christian.koenig@amd.com>
 <CAKMK7uEZkVigevevxCQAYykzkGPPE7QcXULi_rYP+26x3GS86g@mail.gmail.com>
 <73a3423f-fe7e-efba-2740-1d548543706a@gmail.com>
In-Reply-To: <73a3423f-fe7e-efba-2740-1d548543706a@gmail.com>
From: Daniel Vetter <daniel@ffwll.ch>
Date: Tue, 12 Jan 2021 15:10:36 +0100
Message-ID: <CAKMK7uFjAG8bDSc6YtLWdUrcFRdReSh0pG4q+mcUue+8Kw+msA@mail.gmail.com>
Subject: Re: [PATCH] drm/ttm: make the pool shrinker lock a mutex
To: =?UTF-8?Q?Christian_K=C3=B6nig?= <christian.koenig@amd.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mikhail Gavrilov <mikhail.v.gavrilov@gmail.com>,
 dri-devel <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVHVlLCBKYW4gMTIsIDIwMjEgYXQgMzowNiBQTSBDaHJpc3RpYW4gS8O2bmlnCjxja29lbmln
LmxlaWNodHp1bWVya2VuQGdtYWlsLmNvbT4gd3JvdGU6Cj4KPiBBbSAxMi4wMS4yMSB1bSAxNTow
MyBzY2hyaWViIERhbmllbCBWZXR0ZXI6Cj4gPiBPbiBNb24sIEphbiAxMSwgMjAyMSBhdCAyOjU3
IFBNIENocmlzdGlhbiBLw7ZuaWcKPiA+IDxja29lbmlnLmxlaWNodHp1bWVya2VuQGdtYWlsLmNv
bT4gd3JvdGU6Cj4gPj4gc2V0X3BhZ2VzX3diKCkgbWlnaHQgc2xlZXAgYW5kIHNvIHdlIGNhbid0
IGRvIHRoaXMgaW4gYW4gYXRvbWljIGNvbnRleHQuCj4gPj4KPiA+PiBTaWduZWQtb2ZmLWJ5OiBD
aHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Cj4gPj4gUmVwb3J0ZWQt
Ynk6IE1pa2hhaWwgR2F2cmlsb3YgPG1pa2hhaWwudi5nYXZyaWxvdkBnbWFpbC5jb20+Cj4gPj4g
Rml4ZXM6IGQwOTlmYzhmNTQwYSAoImRybS90dG06IG5ldyBUVCBiYWNrZW5kIGFsbG9jYXRpb24g
cG9vbCB2MyIpCj4gPiBIbSBJIGd1ZXNzIGxvbmcgdGVybSBwcm9wZXIgZml4IHdvdWxkIGJlIHRv
IHB1bGwgdGhlIHNocmlua2VyIGludG8gdHdvCj4gPiBwYXJ0cywgZmlyc3QgcGFydCB0YWtlcyB0
aGUgcmlnaHQgYW1vdW50IG9mIGVudHJpZXMgb2YgdGhlIGxpc3QsCj4gPiBob2xkaW5nIHRoZSBs
b2NrLiAybmQgcGFydCBkb2VzIHRoZSByZWxlYXNpbmcgKG9yIG1heWJlIGF0IGxlYXN0IGluCj4g
PiBiYXRjaGVzKS4gbHJ1IGxvY2tzIHNob3VsZCBiZSBjaGVhcCwgZG9pbmcgZXhwZW5zaXZlIHN0
dWZmIGxpa2UKPiA+IGZsdXNoaW5nIG9yIHJld3JpdGluZyBwdGVzIG1pZ2h0IG5vdCBiZSB0aGUg
YmVzdCBpZGVhLgo+Cj4gWWVhaCwgYWdyZWUuIEl0IHNob3VsZCBhY3R1YWxseSBiZSB0cml2aWFs
LCBidXQgSSBkaWRuJ3Qgd2FudGVkIHRoZQo+IGNodXJuIGluIGZpeGVzLgo+Cj4gU28ganVzdCBn
b2luZyBmb3IgdGhlIGVhc3kgZml4IG5vdyBhbmQgdGhlIG9wdGltYWwgbGF0ZXIgb24uCgpNYWtl
cyBzZW5zZS4gTWF5YmUgYWRkIHRoYXQgYXMgYW4gZXhwbGFuYXRpb24gdG8gdGhlIGNvbW1pdCBt
ZXNzYWdlLAppZiB5b3UgaGF2ZW4ndCBwdXNoZWQgeWV0LiBBLWI6IG9uIHRoZSBwYXRjaC4KLURh
bmllbAoKPgo+IFJlZ2FyZHMsCj4gQ2hyaXN0aWFuLgo+Cj4gPiAtRGFuaWVsCj4gPgo+ID4+IC0t
LQo+ID4+ICAgZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jIHwgMjAgKysrKysrKysrKy0t
LS0tLS0tLS0KPiA+PiAgIDEgZmlsZSBjaGFuZ2VkLCAxMCBpbnNlcnRpb25zKCspLCAxMCBkZWxl
dGlvbnMoLSkKPiA+Pgo+ID4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9w
b29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKPiA+PiBpbmRleCBhMDBiN2Fi
OWMxNGMuLjZhNmVlYmE0MjNkMSAxMDA2NDQKPiA+PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9wb29sLmMKPiA+PiArKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKPiA+
PiBAQCAtNjYsNyArNjYsNyBAQCBzdGF0aWMgc3RydWN0IHR0bV9wb29sX3R5cGUgZ2xvYmFsX3Vu
Y2FjaGVkW01BWF9PUkRFUl07Cj4gPj4gICBzdGF0aWMgc3RydWN0IHR0bV9wb29sX3R5cGUgZ2xv
YmFsX2RtYTMyX3dyaXRlX2NvbWJpbmVkW01BWF9PUkRFUl07Cj4gPj4gICBzdGF0aWMgc3RydWN0
IHR0bV9wb29sX3R5cGUgZ2xvYmFsX2RtYTMyX3VuY2FjaGVkW01BWF9PUkRFUl07Cj4gPj4KPiA+
PiAtc3RhdGljIHNwaW5sb2NrX3Qgc2hyaW5rZXJfbG9jazsKPiA+PiArc3RhdGljIHN0cnVjdCBt
dXRleCBzaHJpbmtlcl9sb2NrOwo+ID4+ICAgc3RhdGljIHN0cnVjdCBsaXN0X2hlYWQgc2hyaW5r
ZXJfbGlzdDsKPiA+PiAgIHN0YXRpYyBzdHJ1Y3Qgc2hyaW5rZXIgbW1fc2hyaW5rZXI7Cj4gPj4K
PiA+PiBAQCAtMjQ5LDkgKzI0OSw5IEBAIHN0YXRpYyB2b2lkIHR0bV9wb29sX3R5cGVfaW5pdChz
dHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQsIHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwKPiA+PiAgICAg
ICAgICBzcGluX2xvY2tfaW5pdCgmcHQtPmxvY2spOwo+ID4+ICAgICAgICAgIElOSVRfTElTVF9I
RUFEKCZwdC0+cGFnZXMpOwo+ID4+Cj4gPj4gLSAgICAgICBzcGluX2xvY2soJnNocmlua2VyX2xv
Y2spOwo+ID4+ICsgICAgICAgbXV0ZXhfbG9jaygmc2hyaW5rZXJfbG9jayk7Cj4gPj4gICAgICAg
ICAgbGlzdF9hZGRfdGFpbCgmcHQtPnNocmlua2VyX2xpc3QsICZzaHJpbmtlcl9saXN0KTsKPiA+
PiAtICAgICAgIHNwaW5fdW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsKPiA+PiArICAgICAgIG11dGV4
X3VubG9jaygmc2hyaW5rZXJfbG9jayk7Cj4gPj4gICB9Cj4gPj4KPiA+PiAgIC8qIFJlbW92ZSBh
IHBvb2xfdHlwZSBmcm9tIHRoZSBnbG9iYWwgc2hyaW5rZXIgbGlzdCBhbmQgZnJlZSBhbGwgcGFn
ZXMgKi8KPiA+PiBAQCAtMjU5LDkgKzI1OSw5IEBAIHN0YXRpYyB2b2lkIHR0bV9wb29sX3R5cGVf
ZmluaShzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQpCj4gPj4gICB7Cj4gPj4gICAgICAgICAgc3Ry
dWN0IHBhZ2UgKnAsICp0bXA7Cj4gPj4KPiA+PiAtICAgICAgIHNwaW5fbG9jaygmc2hyaW5rZXJf
bG9jayk7Cj4gPj4gKyAgICAgICBtdXRleF9sb2NrKCZzaHJpbmtlcl9sb2NrKTsKPiA+PiAgICAg
ICAgICBsaXN0X2RlbCgmcHQtPnNocmlua2VyX2xpc3QpOwo+ID4+IC0gICAgICAgc3Bpbl91bmxv
Y2soJnNocmlua2VyX2xvY2spOwo+ID4+ICsgICAgICAgbXV0ZXhfdW5sb2NrKCZzaHJpbmtlcl9s
b2NrKTsKPiA+Pgo+ID4+ICAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShwLCB0bXAs
ICZwdC0+cGFnZXMsIGxydSkKPiA+PiAgICAgICAgICAgICAgICAgIHR0bV9wb29sX2ZyZWVfcGFn
ZShwdC0+cG9vbCwgcHQtPmNhY2hpbmcsIHB0LT5vcmRlciwgcCk7Cj4gPj4gQEAgLTMwMiw3ICsz
MDIsNyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IHR0bV9wb29sX3Nocmluayh2b2lkKQo+ID4+ICAg
ICAgICAgIHVuc2lnbmVkIGludCBudW1fZnJlZWQ7Cj4gPj4gICAgICAgICAgc3RydWN0IHBhZ2Ug
KnA7Cj4gPj4KPiA+PiAtICAgICAgIHNwaW5fbG9jaygmc2hyaW5rZXJfbG9jayk7Cj4gPj4gKyAg
ICAgICBtdXRleF9sb2NrKCZzaHJpbmtlcl9sb2NrKTsKPiA+PiAgICAgICAgICBwdCA9IGxpc3Rf
Zmlyc3RfZW50cnkoJnNocmlua2VyX2xpc3QsIHR5cGVvZigqcHQpLCBzaHJpbmtlcl9saXN0KTsK
PiA+Pgo+ID4+ICAgICAgICAgIHAgPSB0dG1fcG9vbF90eXBlX3Rha2UocHQpOwo+ID4+IEBAIC0z
MTQsNyArMzE0LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCB0dG1fcG9vbF9zaHJpbmsodm9pZCkK
PiA+PiAgICAgICAgICB9Cj4gPj4KPiA+PiAgICAgICAgICBsaXN0X21vdmVfdGFpbCgmcHQtPnNo
cmlua2VyX2xpc3QsICZzaHJpbmtlcl9saXN0KTsKPiA+PiAtICAgICAgIHNwaW5fdW5sb2NrKCZz
aHJpbmtlcl9sb2NrKTsKPiA+PiArICAgICAgIG11dGV4X3VubG9jaygmc2hyaW5rZXJfbG9jayk7
Cj4gPj4KPiA+PiAgICAgICAgICByZXR1cm4gbnVtX2ZyZWVkOwo+ID4+ICAgfQo+ID4+IEBAIC01
NjQsNyArNTY0LDcgQEAgaW50IHR0bV9wb29sX2RlYnVnZnMoc3RydWN0IHR0bV9wb29sICpwb29s
LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCj4gPj4gICB7Cj4gPj4gICAgICAgICAgdW5zaWduZWQgaW50
IGk7Cj4gPj4KPiA+PiAtICAgICAgIHNwaW5fbG9jaygmc2hyaW5rZXJfbG9jayk7Cj4gPj4gKyAg
ICAgICBtdXRleF9sb2NrKCZzaHJpbmtlcl9sb2NrKTsKPiA+Pgo+ID4+ICAgICAgICAgIHNlcV9w
dXRzKG0sICJcdCAiKTsKPiA+PiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgTUFYX09SREVSOyAr
K2kpCj4gPj4gQEAgLTYwMCw3ICs2MDAsNyBAQCBpbnQgdHRtX3Bvb2xfZGVidWdmcyhzdHJ1Y3Qg
dHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCBzZXFfZmlsZSAqbSkKPiA+PiAgICAgICAgICBzZXFfcHJp
bnRmKG0sICJcbnRvdGFsXHQ6ICU4bHUgb2YgJThsdVxuIiwKPiA+PiAgICAgICAgICAgICAgICAg
ICAgIGF0b21pY19sb25nX3JlYWQoJmFsbG9jYXRlZF9wYWdlcyksIHBhZ2VfcG9vbF9zaXplKTsK
PiA+Pgo+ID4+IC0gICAgICAgc3Bpbl91bmxvY2soJnNocmlua2VyX2xvY2spOwo+ID4+ICsgICAg
ICAgbXV0ZXhfdW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsKPiA+Pgo+ID4+ICAgICAgICAgIHJldHVy
biAwOwo+ID4+ICAgfQo+ID4+IEBAIC02NDQsNyArNjQ0LDcgQEAgaW50IHR0bV9wb29sX21ncl9p
bml0KHVuc2lnbmVkIGxvbmcgbnVtX3BhZ2VzKQo+ID4+ICAgICAgICAgIGlmICghcGFnZV9wb29s
X3NpemUpCj4gPj4gICAgICAgICAgICAgICAgICBwYWdlX3Bvb2xfc2l6ZSA9IG51bV9wYWdlczsK
PiA+Pgo+ID4+IC0gICAgICAgc3Bpbl9sb2NrX2luaXQoJnNocmlua2VyX2xvY2spOwo+ID4+ICsg
ICAgICAgbXV0ZXhfaW5pdCgmc2hyaW5rZXJfbG9jayk7Cj4gPj4gICAgICAgICAgSU5JVF9MSVNU
X0hFQUQoJnNocmlua2VyX2xpc3QpOwo+ID4+Cj4gPj4gICAgICAgICAgZm9yIChpID0gMDsgaSA8
IE1BWF9PUkRFUjsgKytpKSB7Cj4gPj4gLS0KPiA+PiAyLjI1LjEKPiA+Pgo+ID4+IF9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCj4gPj4gZHJpLWRldmVsIG1h
aWxpbmcgbGlzdAo+ID4+IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKPiA+PiBodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo+ID4K
PiA+Cj4KCgotLSAKRGFuaWVsIFZldHRlcgpTb2Z0d2FyZSBFbmdpbmVlciwgSW50ZWwgQ29ycG9y
YXRpb24KaHR0cDovL2Jsb2cuZmZ3bGwuY2gKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVsCg==
