Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A87041CB7
	for <lists+dri-devel@lfdr.de>; Wed, 12 Jun 2019 08:54:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 15DDF8922B;
	Wed, 12 Jun 2019 06:53:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from imap1.codethink.co.uk (imap1.codethink.co.uk [176.9.8.82])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 976F48916D
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 14:24:13 +0000 (UTC)
Received: from [167.98.27.226] (helo=happy.office.codethink.co.uk)
 by imap1.codethink.co.uk with esmtpsa (Exim 4.84_2 #1 (Debian))
 id 1hahOS-0003vU-K7; Tue, 11 Jun 2019 15:04:56 +0100
From: Michael Drake <michael.drake@codethink.co.uk>
To: Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 dri-devel@lists.freedesktop.org, devicetree@vger.kernel.org,
 linux-kernel@vger.kernel.org, Michael Drake <michael.drake@codethink.co.uk>
Subject: [PATCH v1 04/11] ti948: Add support for configuration via device
 properties
Date: Tue, 11 Jun 2019 15:04:05 +0100
Message-Id: <20190611140412.32151-5-michael.drake@codethink.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190611140412.32151-1-michael.drake@codethink.co.uk>
References: <20190611140412.32151-1-michael.drake@codethink.co.uk>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 12 Jun 2019 06:53:41 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, linux-kernel@lists.codethink.co.uk,
 David Airlie <airlied@linux.ie>, Nate Case <ncase@tesla.com>,
 Rob Herring <robh+dt@kernel.org>, Patrick Glaser <pglaser@tesla.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhbGxvd3MgdGhlIGRldmljZSB0byBiZSBjb25maWd1cmVkIGZvciB0aGUgYm9hcmQgaW4K
ZGV2aWNlIHRyZWUsIG9yIGluIEFDUEkgdGFibGVzLiAgVGhlIGRldmljZSBub2RlIHByb3BlcnRp
ZXMKY2FuIHByb3ZpZGUgYW4gYXJyYXkgb2YgcmVnaXN0ZXIgYWRkcmVzc2VzIGFuZCB2YWx1ZXMg
dG8gYmUKd3JpdHRlbiB0byBjb25maWd1cmUgdGhlIGRldmljZSBmb3IgdGhlIGJvYXJkLgoKVGhl
IGNvbmZpZyBpcyB3cml0dGVuIHRvIHRoZSBkZXZpY2Ugb24gcHJvYmUgYW5kIG9uIFBNIHJlc3Vt
ZS4KClNpZ25lZC1vZmYtYnk6IE1pY2hhZWwgRHJha2UgPG1pY2hhZWwuZHJha2VAY29kZXRoaW5r
LmNvLnVrPgpDYzogUGF0cmljayBHbGFzZXIgPHBnbGFzZXJAdGVzbGEuY29tPgpDYzogTmF0ZSBD
YXNlIDxuY2FzZUB0ZXNsYS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90aTk0OC5j
IHwgMTA2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQogMSBmaWxlIGNoYW5nZWQs
IDEwNSBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2JyaWRnZS90aTk0OC5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90aTk0OC5jCmlu
ZGV4IGMyMjI1MjAzNmJiZS4uOWNiMzcyMTVmMDQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL3RpOTQ4LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90aTk0OC5jCkBA
IC0xOSw2ICsxOSw3IEBACiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGlu
dXgvcmVnbWFwLmg+CiAjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxsaW51eC9z
bGFiLmg+CiAjaW5jbHVkZSA8bGludXgvaTJjLmg+CiAKIC8qIE51bWJlciBvZiB0aW1lcyB0byB0
cnkgY2hlY2tpbmcgZm9yIGRldmljZSBvbiBicmluZ3VwLiAqLwpAQCAtMTIyLDYgKzEyMyw4IEBA
IHN0cnVjdCB0aTk0OF9yZWdfdmFsIHsKICAqIHN0cnVjdCB0aTk0OF9jdHggLSB0aTk0OCBkcml2
ZXIgY29udGV4dAogICogQGkyYzogICAgICAgICBIYW5kbGUgZm9yIHRoZSBkZXZpY2UncyBpMmMg
Y2xpZW50LgogICogQHJlZ21hcDogICAgICBIYW5kbGUgZm9yIHRoZSBkZXZpY2UncyByZWdtYXAu
CisgKiBAY29uZmlnOiAgICAgIEFycmF5IG9mIHJlZ2lzdGVyIHZhbHVlcyBsb2FkZWQgZnJvbSBk
ZXZpY2UgcHJvcGVydGllcy4KKyAqIEBjb25maWdfbGVuOiAgTnVtYmVyIG9mIGVudHJpZXMgaW4g
Y29uZmlnLgogICogQHJlZ19uYW1lczogICBBcnJheSBvZiByZWd1bGF0b3IgbmFtZXMsIG9yIE5V
TEwuCiAgKiBAcmVnczogICAgICAgIEFycmF5IG9mIHJlZ3VsYXRvcnMsIG9yIE5VTEwuCiAgKiBA
cmVnX2NvdW50OiAgIE51bWJlciBvZiBlbnRyaWVzIGluIHJlZ19uYW1lcyBhbmQgcmVncyBhcnJh
eXMuCkBAIC0xMjksNiArMTMyLDggQEAgc3RydWN0IHRpOTQ4X3JlZ192YWwgewogc3RydWN0IHRp
OTQ4X2N0eCB7CiAJc3RydWN0IGkyY19jbGllbnQgKmkyYzsKIAlzdHJ1Y3QgcmVnbWFwICpyZWdt
YXA7CisJc3RydWN0IHRpOTQ4X3JlZ192YWwgKmNvbmZpZzsKKwlzaXplX3QgY29uZmlnX2xlbjsK
IAljb25zdCBjaGFyICoqcmVnX25hbWVzOwogCXN0cnVjdCByZWd1bGF0b3IgKipyZWdzOwogCXNp
emVfdCByZWdfY291bnQ7CkBAIC0yMTIsNiArMjE3LDQyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
cmVnbWFwX2NvbmZpZyB0aTk0OF9yZWdtYXBfY29uZmlnID0gewogCS53cml0ZWFibGVfcmVnID0g
dGk5NDhfd3JpdGVhYmxlX3JlZywKIH07CiAKK3N0YXRpYyBpbnQgdGk5NDhfd3JpdGVfc2VxdWVu
Y2UoCisJCXN0cnVjdCB0aTk0OF9jdHggKnRpOTQ4LAorCQljb25zdCBzdHJ1Y3QgdGk5NDhfcmVn
X3ZhbCAqc2VxdWVuY2UsCisJCXUzMiBlbnRyaWVzKQoreworCWludCBpOworCisJZm9yIChpID0g
MDsgaSA8IGVudHJpZXM7IGkrKykgeworCQljb25zdCBzdHJ1Y3QgdGk5NDhfcmVnX3ZhbCAqciA9
IHNlcXVlbmNlICsgaTsKKwkJaW50IHJldCA9IHJlZ21hcF93cml0ZSh0aTk0OC0+cmVnbWFwLCBy
LT5hZGRyLCByLT52YWx1ZSk7CisKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0OworCX0K
KworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHRpOTQ4X3dyaXRlX2NvbmZpZ19zZXEoc3Ry
dWN0IHRpOTQ4X2N0eCAqdGk5NDgpCit7CisJaW50IHJldDsKKworCWlmICh0aTk0OC0+Y29uZmln
ID09IE5VTEwpIHsKKwkJZGV2X2luZm8oJnRpOTQ4LT5pMmMtPmRldiwgIk5vIGNvbmZpZyBmb3Ig
dGk5NDggZGV2aWNlXG4iKTsKKwkJcmV0dXJuIDA7CisJfQorCisJcmV0ID0gdGk5NDhfd3JpdGVf
c2VxdWVuY2UodGk5NDgsIHRpOTQ4LT5jb25maWcsIHRpOTQ4LT5jb25maWdfbGVuKTsKKwlpZiAo
cmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCWRldl9pbmZvKCZ0aTk0OC0+aTJjLT5kZXYsICJT
dWNjZXNzZnVsbHkgY29uZmlndXJlZCB0aTk0OFxuIik7CisKKwlyZXR1cm4gcmV0OworfQorCiBz
dGF0aWMgaW5saW5lIHU4IHRpOTQ4X2RldmljZV9hZGRyZXNzKHN0cnVjdCB0aTk0OF9jdHggKnRp
OTQ4KQogewogCXJldHVybiB0aTk0OC0+aTJjLT5hZGRyOwpAQCAtMzQ1LDcgKzM4Niw3IEBAIHN0
YXRpYyBpbnQgdGk5NDhfcG1fcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIAlpZiAocmV0ICE9
IDApCiAJCXJldHVybiByZXQ7CiAKLQlyZXR1cm4gMDsKKwlyZXR1cm4gdGk5NDhfd3JpdGVfY29u
ZmlnX3NlcSh0aTk0OCk7CiB9CiAKIHN0YXRpYyBpbnQgdGk5NDhfcG1fc3VzcGVuZChzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCkBAIC00MzQsNiArNDc1LDY1IEBAIHN0YXRpYyBpbnQgdGk5NDhfZ2V0X3Jl
Z3VsYXRvcnMoc3RydWN0IHRpOTQ4X2N0eCAqdGk5NDgpCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRp
YyBpbnQgdGk5NDhfZ2V0X2NvbmZpZyhzdHJ1Y3QgdGk5NDhfY3R4ICp0aTk0OCkKK3sKKwlpbnQg
aTsKKwlpbnQgcmV0OworCXU4ICpjb25maWc7CisJc2l6ZV90IGNvbmZpZ19sZW47CisKKwlyZXQg
PSBkZXZpY2VfcHJvcGVydHlfcmVhZF91OF9hcnJheSgmdGk5NDgtPmkyYy0+ZGV2LAorCQkJImNv
bmZpZyIsIE5VTEwsIDApOworCWlmIChyZXQgPT0gLUVJTlZBTCB8fAorCSAgICByZXQgPT0gLUVO
T0RBVEEgfHwKKwkgICAgcmV0ID09IDApIHsKKwkJLyogImNvbmZpZyIgcHJvcGVydHkgd2FzIGVp
dGhlcjoKKwkJICogICAtIHVuc2V0CisJCSAqICAgLSB2YWx1ZWxlc3MKKwkJICogICAtIHNldCB0
byBlbXB0eSBsaXN0CisJCSAqIE5vdCBhbiBlcnJvcjsgY29udGludWUgd2l0aG91dCBjb25maWcu
CisJCSAqLworCQlkZXZfaW5mbygmdGk5NDgtPmkyYy0+ZGV2LCAiTm8gY29uZmlnIGRlZmluZWQg
Zm9yIGRldmljZS5cbiIpOworCQlyZXR1cm4gMDsKKworCX0gZWxzZSBpZiAocmV0IDwgMCkgewor
CQlyZXR1cm4gcmV0OworCX0gZWxzZSBpZiAocmV0ICYgMHgxKSB7CisJCWRldl9lcnIoJnRpOTQ4
LT5pMmMtPmRldiwKKwkJCSJEZXZpY2UgcHJvcGVydHkgJ2NvbmZpZycgbmVlZHMgZXZlbiBlbnRy
eSBjb3VudC5cbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwljb25maWdfbGVuID0gcmV0
OworCisJY29uZmlnID0ga21hbGxvY19hcnJheShjb25maWdfbGVuLCBzaXplb2YoKmNvbmZpZyks
IEdGUF9LRVJORUwpOworCWlmICghY29uZmlnKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldCA9
IGRldmljZV9wcm9wZXJ0eV9yZWFkX3U4X2FycmF5KCZ0aTk0OC0+aTJjLT5kZXYsICJjb25maWci
LAorCQkJY29uZmlnLCBjb25maWdfbGVuKTsKKwlpZiAocmV0IDwgMCkgeworCQlrZnJlZShjb25m
aWcpOworCQlyZXR1cm4gcmV0OworCX0KKworCXRpOTQ4LT5jb25maWcgPSBkZXZtX2ttYWxsb2Nf
YXJyYXkoJnRpOTQ4LT5pMmMtPmRldiwKKwkJCWNvbmZpZ19sZW4gLyAyLCBzaXplb2YoKnRpOTQ4
LT5jb25maWcpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXRpOTQ4LT5jb25maWcpIHsKKwkJa2ZyZWUo
Y29uZmlnKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJdGk5NDgtPmNvbmZpZ19sZW4gPSBj
b25maWdfbGVuIC8gMjsKKwlmb3IgKGkgPSAwOyBpIDwgY29uZmlnX2xlbjsgaSArPSAyKSB7CisJ
CXRpOTQ4LT5jb25maWdbaSAvIDJdLmFkZHIgPSBjb25maWdbaV07CisJCXRpOTQ4LT5jb25maWdb
aSAvIDJdLnZhbHVlID0gY29uZmlnW2kgKyAxXTsKKwl9CisJa2ZyZWUoY29uZmlnKTsKKworCXJl
dHVybiAwOworfQorCiBzdGF0aWMgaW50IHRpOTQ4X3Byb2JlKHN0cnVjdCBpMmNfY2xpZW50ICpj
bGllbnQsCiAJCWNvbnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkICppZCkKIHsKQEAgLTQ1Niw2ICs1
NTYsMTAgQEAgc3RhdGljIGludCB0aTk0OF9wcm9iZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50
LAogCWlmIChyZXQgIT0gMCkKIAkJcmV0dXJuIHJldDsKIAorCXJldCA9IHRpOTQ4X2dldF9jb25m
aWcodGk5NDgpOworCWlmIChyZXQgIT0gMCkKKwkJcmV0dXJuIHJldDsKKwogCWkyY19zZXRfY2xp
ZW50ZGF0YShjbGllbnQsIHRpOTQ4KTsKIAogCXJldCA9IHRpOTQ4X3BtX3Jlc3VtZSgmY2xpZW50
LT5kZXYpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWw=
