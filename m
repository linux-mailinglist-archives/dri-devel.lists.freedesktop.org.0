Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DC5565D16D
	for <lists+dri-devel@lfdr.de>; Tue,  2 Jul 2019 16:19:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 28DA589E26;
	Tue,  2 Jul 2019 14:19:20 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D464889F92
 for <dri-devel@lists.freedesktop.org>; Tue,  2 Jul 2019 14:19:15 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 395A9307D84D;
 Tue,  2 Jul 2019 14:19:14 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-96.ams2.redhat.com
 [10.36.116.96])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 281991750A;
 Tue,  2 Jul 2019 14:19:10 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 75EEA17535; Tue,  2 Jul 2019 16:19:05 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6 11/18] drm/virtio: switch from ttm to gem shmem helpers
Date: Tue,  2 Jul 2019 16:18:56 +0200
Message-Id: <20190702141903.1131-12-kraxel@redhat.com>
In-Reply-To: <20190702141903.1131-1-kraxel@redhat.com>
References: <20190702141903.1131-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Tue, 02 Jul 2019 14:19:15 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 gurchetansingh@chromium.org, Gerd Hoffmann <kraxel@redhat.com>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

dmlydGlvLWdwdSBiYXNpY2FsbHkgbmVlZHMgYSBzZ190YWJsZSBmb3IgdGhlIGJvLCB0byB0ZWxs
IHRoZSBob3N0IHdoZXJlCnRoZSBiYWNraW5nIHBhZ2VzIGZvciB0aGUgb2JqZWN0IGFyZS4gIFNv
IHRoZSBnZW0gc2htZW0gaGVscGVycyBhcmUgYQpwZXJmZWN0IGZpdC4gIFNvbWUgZHJtX2dlbV9v
YmplY3RfZnVuY3MgbmVlZCB0aGluIHdyYXBwZXJzIHRvIHVwZGF0ZSB0aGUKaG9zdCBzdGF0ZSwg
YnV0IG90aGVyd2lzZSB0aGUgaGVscGVycyBoYW5kbGUgZXZlcnl0aGluZyBqdXN0IGZpbmUuCgpP
bmNlIHRoZSBmZW5jaW5nIHdhcyBzb3J0ZWQgdGhlIHN3aXRjaCB3YXMgc3VycHJpc2luZ2x5IGVh
c3kgYW5kIGZvciB0aGUKbW9zdCBwYXJ0IGp1c3QgcmVtb3ZpbmcgdGhlIHR0bSBjb2RlLgoKdjQ6
IGZpeCBkcm1fZ2VtX29iamVjdF9mdW5jcyBuYW1lLgoKU2lnbmVkLW9mZi1ieTogR2VyZCBIb2Zm
bWFubiA8a3JheGVsQHJlZGhhdC5jb20+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwu
dmV0dGVyQGZmd2xsLmNoPgotLS0KIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYu
aCAgICB8ICA1MiArLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmMgICAg
fCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyAgICB8ICAxNiAr
LQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMgIHwgIDE5ICstCiBkcml2
ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMgICAgfCAgIDkgLQogZHJpdmVycy9ncHUv
ZHJtL3ZpcnRpby92aXJ0Z3B1X29iamVjdC5jIHwgMTQ2ICsrKystLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ByaW1lLmMgIHwgIDM3IC0tLQogZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X3R0bS5jICAgIHwgMzA0IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMgICAgIHwgIDI0ICstCiBkcml2ZXJz
L2dwdS9kcm0vdmlydGlvL0tjb25maWcgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vTWFrZWZpbGUgICAgICAgICB8ICAgMiArLQogMTEgZmlsZXMgY2hhbmdlZCwgODIg
aW5zZXJ0aW9ucygrKSwgNTQ5IGRlbGV0aW9ucygtKQogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV90dG0uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9kcnYuaAppbmRleCAxMjE2ODA2N2E4NzQuLmY4YTU4NjAyOTQwMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9kcnYuaApAQCAtMzMsMTQgKzMzLDExIEBACiAKICNpbmNsdWRlIDxkcm0v
ZHJtUC5oPgogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1f
c2htZW1faGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxk
cm0vZHJtX2VuY29kZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgogI2luY2x1
ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fYXBp
Lmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmg+Ci0jaW5jbHVkZSA8ZHJtL3R0
bS90dG1fcGxhY2VtZW50Lmg+Ci0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fbW9kdWxlLmg+CiAKICNk
ZWZpbmUgRFJJVkVSX05BTUUgInZpcnRpb19ncHUiCiAjZGVmaW5lIERSSVZFUl9ERVNDICJ2aXJ0
aW8gR1BVIgpAQCAtNjgsMjEgKzY1LDE2IEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9wYXJh
bXMgewogfTsKIAogc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0IHsKLQlzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgZ2VtX2Jhc2U7CisJc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0IGJhc2U7CiAJdWlu
dDMyX3QgaHdfcmVzX2hhbmRsZTsKIAogCXN0cnVjdCBzZ190YWJsZSAqcGFnZXM7CiAJdWludDMy
X3QgbWFwcGVkOwotCXZvaWQgKnZtYXA7CiAJYm9vbCBkdW1iOwotCXN0cnVjdCB0dG1fcGxhY2Ug
ICAgICAgICAgICAgICAgcGxhY2VtZW50X2NvZGU7Ci0Jc3RydWN0IHR0bV9wbGFjZW1lbnQJCXBs
YWNlbWVudDsKLQlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QJdGJvOwotCXN0cnVjdCB0dG1fYm9f
a21hcF9vYmoJCWttYXA7CiAJYm9vbCBjcmVhdGVkOwogfTsKICNkZWZpbmUgZ2VtX3RvX3ZpcnRp
b19ncHVfb2JqKGdvYmopIFwKLQljb250YWluZXJfb2YoKGdvYmopLCBzdHJ1Y3QgdmlydGlvX2dw
dV9vYmplY3QsIGdlbV9iYXNlKQorCWNvbnRhaW5lcl9vZigoZ29iaiksIHN0cnVjdCB2aXJ0aW9f
Z3B1X29iamVjdCwgYmFzZS5iYXNlKQogCiBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkg
ewogCXN0cnVjdCB3d19hY3F1aXJlX2N0eCB0aWNrZXQ7CkBAIC0xNTMsMTAgKzE0NSw2IEBAIHN0
cnVjdCB2aXJ0aW9fZ3B1X2ZyYW1lYnVmZmVyIHsKICNkZWZpbmUgdG9fdmlydGlvX2dwdV9mcmFt
ZWJ1ZmZlcih4KSBcCiAJY29udGFpbmVyX29mKHgsIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZyYW1lYnVm
ZmVyLCBiYXNlKQogCi1zdHJ1Y3QgdmlydGlvX2dwdV9tbWFuIHsKLQlzdHJ1Y3QgdHRtX2JvX2Rl
dmljZQkJYmRldjsKLX07Ci0KIHN0cnVjdCB2aXJ0aW9fZ3B1X3F1ZXVlIHsKIAlzdHJ1Y3Qgdmly
dHF1ZXVlICp2cTsKIAlzcGlubG9ja190IHFsb2NrOwpAQCAtMTg1LDggKzE3Myw2IEBAIHN0cnVj
dCB2aXJ0aW9fZ3B1X2RldmljZSB7CiAKIAlzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldjsKIAot
CXN0cnVjdCB2aXJ0aW9fZ3B1X21tYW4gbW1hbjsKLQogCXN0cnVjdCB2aXJ0aW9fZ3B1X291dHB1
dCBvdXRwdXRzW1ZJUlRJT19HUFVfTUFYX1NDQU5PVVRTXTsKIAl1aW50MzJfdCBudW1fc2Nhbm91
dHM7CiAKQEAgLTM1NywxMSArMzQzLDYgQEAgc3RydWN0IGRybV9wbGFuZSAqdmlydGlvX2dwdV9w
bGFuZV9pbml0KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJCQkJCWVudW0gZHJt
X3BsYW5lX3R5cGUgdHlwZSwKIAkJCQkJaW50IGluZGV4KTsKIAotLyogdmlydGlvX2dwdV90dG0u
YyAqLwotaW50IHZpcnRpb19ncHVfdHRtX2luaXQoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2
Z2Rldik7Ci12b2lkIHZpcnRpb19ncHVfdHRtX2Zpbmkoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNl
ICp2Z2Rldik7Ci1pbnQgdmlydGlvX2dwdV9tbWFwKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qg
dm1fYXJlYV9zdHJ1Y3QgKnZtYSk7Ci0KIC8qIHZpcnRpb19ncHVfZmVuY2UuYyAqLwogYm9vbCB2
aXJ0aW9fZmVuY2Vfc2lnbmFsZWQoc3RydWN0IGRtYV9mZW5jZSAqZik7CiBzdHJ1Y3QgdmlydGlv
X2dwdV9mZW5jZSAqdmlydGlvX2dwdV9mZW5jZV9hbGxvYygKQEAgLTM3Myw1OCArMzU0LDQ3IEBA
IHZvaWQgdmlydGlvX2dwdV9mZW5jZV9ldmVudF9wcm9jZXNzKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rl
dmljZSAqdmRldiwKIAkJCQkgICAgdTY0IGxhc3Rfc2VxKTsKIAogLyogdmlydGlvX2dwdV9vYmpl
Y3QgKi8KK3N0cnVjdCBkcm1fZ2VtX29iamVjdCAqdmlydGlvX2dwdV9jcmVhdGVfb2JqZWN0KHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJCQlzaXplX3Qgc2l6ZSk7CiBpbnQgdmlydGlvX2dw
dV9vYmplY3RfY3JlYXRlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJCQkgICAg
IHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9wYXJhbXMgKnBhcmFtcywKIAkJCSAgICAgc3RydWN0
IHZpcnRpb19ncHVfb2JqZWN0ICoqYm9fcHRyLAogCQkJICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9m
ZW5jZSAqZmVuY2UpOwotdm9pZCB2aXJ0aW9fZ3B1X29iamVjdF9rdW5tYXAoc3RydWN0IHZpcnRp
b19ncHVfb2JqZWN0ICpibyk7Ci1pbnQgdmlydGlvX2dwdV9vYmplY3Rfa21hcChzdHJ1Y3Qgdmly
dGlvX2dwdV9vYmplY3QgKmJvKTsKLWludCB2aXJ0aW9fZ3B1X29iamVjdF9nZXRfc2dfdGFibGUo
c3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICpxZGV2LAotCQkJCSAgIHN0cnVjdCB2aXJ0aW9fZ3B1
X29iamVjdCAqYm8pOwotdm9pZCB2aXJ0aW9fZ3B1X29iamVjdF9mcmVlX3NnX3RhYmxlKHN0cnVj
dCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pOwogCiAvKiB2aXJ0Z3B1X3ByaW1lLmMgKi8KLXN0cnVj
dCBzZ190YWJsZSAqdmlydGdwdV9nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqKTsKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqdmlydGdwdV9nZW1fcHJpbWVf
aW1wb3J0X3NnX3RhYmxlKAogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkbWFfYnVm
X2F0dGFjaG1lbnQgKmF0dGFjaCwKIAlzdHJ1Y3Qgc2dfdGFibGUgKnNndCk7Ci12b2lkICp2aXJ0
Z3B1X2dlbV9wcmltZV92bWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKLXZvaWQgdmly
dGdwdV9nZW1fcHJpbWVfdnVubWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCB2b2lkICp2
YWRkcik7Ci1pbnQgdmlydGdwdV9nZW1fcHJpbWVfbW1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
Km9iaiwKLQkJCSAgIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKTsKIAogc3RhdGljIGlubGlu
ZSBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QqCiB2aXJ0aW9fZ3B1X29iamVjdF9yZWYoc3RydWN0
IHZpcnRpb19ncHVfb2JqZWN0ICpibykKIHsKLQl0dG1fYm9fZ2V0KCZiby0+dGJvKTsKKwlkcm1f
Z2VtX29iamVjdF9nZXQoJmJvLT5iYXNlLmJhc2UpOwogCXJldHVybiBibzsKIH0KIAogc3RhdGlj
IGlubGluZSB2b2lkIHZpcnRpb19ncHVfb2JqZWN0X3VucmVmKHN0cnVjdCB2aXJ0aW9fZ3B1X29i
amVjdCAqKmJvKQogewotCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqdGJvOwotCiAJaWYgKCgq
Ym8pID09IE5VTEwpCiAJCXJldHVybjsKLQl0Ym8gPSAmKCgqYm8pLT50Ym8pOwotCXR0bV9ib19w
dXQodGJvKTsKKwlkcm1fZ2VtX29iamVjdF9wdXQoJigqYm8pLT5iYXNlLmJhc2UpOwogCSpibyA9
IE5VTEw7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdTY0IHZpcnRpb19ncHVfb2JqZWN0X21tYXBfb2Zm
c2V0KHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pCiB7Ci0JcmV0dXJuIGRybV92bWFfbm9k
ZV9vZmZzZXRfYWRkcigmYm8tPnRiby52bWFfbm9kZSk7CisJcmV0dXJuIGRybV92bWFfbm9kZV9v
ZmZzZXRfYWRkcigmYm8tPmJhc2UuYmFzZS52bWFfbm9kZSk7CiB9CiAKIHN0YXRpYyBpbmxpbmUg
aW50IHZpcnRpb19ncHVfb2JqZWN0X3Jlc2VydmUoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpi
bykKIHsKIAlpbnQgcjsKIAotCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfbG9ja19pbnRlcnJ1cHRp
YmxlKGJvLT5nZW1fYmFzZS5yZXN2LCBOVUxMKTsKKwlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X2xv
Y2tfaW50ZXJydXB0aWJsZShiby0+YmFzZS5iYXNlLnJlc3YsIE5VTEwpOwogCWlmICh1bmxpa2Vs
eShyICE9IDApKSB7CiAJCWlmIChyICE9IC1FSU5UUikgewogCQkJc3RydWN0IHZpcnRpb19ncHVf
ZGV2aWNlICpxZGV2ID0KLQkJCQliby0+Z2VtX2Jhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKKwkJCQli
by0+YmFzZS5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAJCQlkZXZfZXJyKHFkZXYtPmRldiwgIiVw
IHJlc2VydmUgZmFpbGVkXG4iLCBibyk7CiAJCX0KIAkJcmV0dXJuIHI7CkBAIC00MzQsNyArNDA0
LDcgQEAgc3RhdGljIGlubGluZSBpbnQgdmlydGlvX2dwdV9vYmplY3RfcmVzZXJ2ZShzdHJ1Y3Qg
dmlydGlvX2dwdV9vYmplY3QgKmJvKQogCiBzdGF0aWMgaW5saW5lIHZvaWQgdmlydGlvX2dwdV9v
YmplY3RfdW5yZXNlcnZlKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8pCiB7Ci0JcmVzZXJ2
YXRpb25fb2JqZWN0X3VubG9jayhiby0+Z2VtX2Jhc2UucmVzdik7CisJcmVzZXJ2YXRpb25fb2Jq
ZWN0X3VubG9jayhiby0+YmFzZS5iYXNlLnJlc3YpOwogfQogCiAvKiB2aXJnbCBkZWJ1ZnMgKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuYyBiL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuYwppbmRleCA5OWJjZDI5MGYxZmIuLjhjZTE5
M2UyODAwYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuYwpAQCAtMTgyLDE3ICsx
ODIsNyBAQCBNT0RVTEVfQVVUSE9SKCJEYXZlIEFpcmxpZSA8YWlybGllZEByZWRoYXQuY29tPiIp
OwogTU9EVUxFX0FVVEhPUigiR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+Iik7CiBN
T0RVTEVfQVVUSE9SKCJBbG9uIExldnkiKTsKIAotc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29w
ZXJhdGlvbnMgdmlydGlvX2dwdV9kcml2ZXJfZm9wcyA9IHsKLQkub3duZXIgPSBUSElTX01PRFVM
RSwKLQkub3BlbiA9IGRybV9vcGVuLAotCS5tbWFwID0gdmlydGlvX2dwdV9tbWFwLAotCS5wb2xs
ID0gZHJtX3BvbGwsCi0JLnJlYWQgPSBkcm1fcmVhZCwKLQkudW5sb2NrZWRfaW9jdGwJPSBkcm1f
aW9jdGwsCi0JLnJlbGVhc2UgPSBkcm1fcmVsZWFzZSwKLQkuY29tcGF0X2lvY3RsID0gZHJtX2Nv
bXBhdF9pb2N0bCwKLQkubGxzZWVrID0gbm9vcF9sbHNlZWssCi19OworREVGSU5FX0RSTV9HRU1f
U0hNRU1fRk9QUyh2aXJ0aW9fZ3B1X2RyaXZlcl9mb3BzKTsKIAogc3RhdGljIHN0cnVjdCBkcm1f
ZHJpdmVyIGRyaXZlciA9IHsKIAkuZHJpdmVyX2ZlYXR1cmVzID0gRFJJVkVSX01PREVTRVQgfCBE
UklWRVJfR0VNIHwgRFJJVkVSX1JFTkRFUiB8IERSSVZFUl9BVE9NSUMsCkBAIC0yMDcsMTUgKzE5
Nyw5IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZlciBkcml2ZXIgPSB7CiAjZW5kaWYKIAkucHJp
bWVfaGFuZGxlX3RvX2ZkID0gZHJtX2dlbV9wcmltZV9oYW5kbGVfdG9fZmQsCiAJLnByaW1lX2Zk
X3RvX2hhbmRsZSA9IGRybV9nZW1fcHJpbWVfZmRfdG9faGFuZGxlLAotCS5nZW1fcHJpbWVfZ2V0
X3NnX3RhYmxlID0gdmlydGdwdV9nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlLAogCS5nZW1fcHJpbWVf
aW1wb3J0X3NnX3RhYmxlID0gdmlydGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlLAotCS5n
ZW1fcHJpbWVfdm1hcCA9IHZpcnRncHVfZ2VtX3ByaW1lX3ZtYXAsCi0JLmdlbV9wcmltZV92dW5t
YXAgPSB2aXJ0Z3B1X2dlbV9wcmltZV92dW5tYXAsCi0JLmdlbV9wcmltZV9tbWFwID0gdmlydGdw
dV9nZW1fcHJpbWVfbW1hcCwKIAotCS5nZW1fZnJlZV9vYmplY3RfdW5sb2NrZWQgPSB2aXJ0aW9f
Z3B1X2dlbV9mcmVlX29iamVjdCwKLQkuZ2VtX29wZW5fb2JqZWN0ID0gdmlydGlvX2dwdV9nZW1f
b2JqZWN0X29wZW4sCi0JLmdlbV9jbG9zZV9vYmplY3QgPSB2aXJ0aW9fZ3B1X2dlbV9vYmplY3Rf
Y2xvc2UsCisJLmdlbV9jcmVhdGVfb2JqZWN0ID0gdmlydGlvX2dwdV9jcmVhdGVfb2JqZWN0LAog
CS5mb3BzID0gJnZpcnRpb19ncHVfZHJpdmVyX2ZvcHMsCiAKIAkuaW9jdGxzID0gdmlydGlvX2dw
dV9pb2N0bHMsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZ2Vt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZ2VtLmMKaW5kZXggZTg4ZGY1ZTA2
ZDA2Li44YTk1ODY0NDA0Y2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmly
dGdwdV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZ2VtLmMKQEAg
LTI2LDE0ICsyNiw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybVAuaD4KICNpbmNsdWRlICJ2aXJ0Z3B1
X2Rydi5oIgogCi12b2lkIHZpcnRpb19ncHVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqZ2VtX29iaikKLXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKm9iaiA9IGdl
bV90b192aXJ0aW9fZ3B1X29iaihnZW1fb2JqKTsKLQotCWlmIChvYmopCi0JCXZpcnRpb19ncHVf
b2JqZWN0X3VucmVmKCZvYmopOwotfQotCiBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QqCiB2aXJ0
aW9fZ3B1X2FsbG9jX29iamVjdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJc3RydWN0IHZp
cnRpb19ncHVfb2JqZWN0X3BhcmFtcyAqcGFyYW1zLApAQCAtNjQsMTYgKzU2LDE2IEBAIGludCB2
aXJ0aW9fZ3B1X2dlbV9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAogCWlmIChJU19FUlIo
b2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAotCXJldCA9IGRybV9nZW1faGFuZGxlX2Ny
ZWF0ZShmaWxlLCAmb2JqLT5nZW1fYmFzZSwgJmhhbmRsZSk7CisJcmV0ID0gZHJtX2dlbV9oYW5k
bGVfY3JlYXRlKGZpbGUsICZvYmotPmJhc2UuYmFzZSwgJmhhbmRsZSk7CiAJaWYgKHJldCkgewot
CQlkcm1fZ2VtX29iamVjdF9yZWxlYXNlKCZvYmotPmdlbV9iYXNlKTsKKwkJZHJtX2dlbV9vYmpl
Y3RfcmVsZWFzZSgmb2JqLT5iYXNlLmJhc2UpOwogCQlyZXR1cm4gcmV0OwogCX0KIAotCSpvYmpf
cCA9ICZvYmotPmdlbV9iYXNlOworCSpvYmpfcCA9ICZvYmotPmJhc2UuYmFzZTsKIAogCS8qIGRy
b3AgcmVmZXJlbmNlIGZyb20gYWxsb2NhdGUgLSBoYW5kbGUgaG9sZHMgaXQgbm93ICovCi0JZHJt
X2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZvYmotPmdlbV9iYXNlKTsKKwlkcm1fZ2VtX29iamVj
dF9wdXRfdW5sb2NrZWQoJm9iai0+YmFzZS5iYXNlKTsKIAogCSpoYW5kbGVfcCA9IGhhbmRsZTsK
IAlyZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9p
b2N0bC5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKaW5kZXggMWZh
OGFhOTFkNTkwLi4xMDcwNTc4MTZlMWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0
aW8vdmlydGdwdV9pb2N0bC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9p
b2N0bC5jCkBAIC0yNyw3ICsyNyw2IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtUC5oPgogI2luY2x1
ZGUgPGRybS92aXJ0Z3B1X2RybS5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRtX2V4ZWNidWZfdXRp
bC5oPgogI2luY2x1ZGUgPGxpbnV4L3N5bmNfZmlsZS5oPgogCiAjaW5jbHVkZSAidmlydGdwdV9k
cnYuaCIKQEAgLTI1OSw3ICsyNTgsNyBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfcmVzb3VyY2Vf
Y3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJZG1hX2Zl
bmNlX3B1dCgmZmVuY2UtPmYpOwogCWlmIChJU19FUlIocW9iaikpCiAJCXJldHVybiBQVFJfRVJS
KHFvYmopOwotCW9iaiA9ICZxb2JqLT5nZW1fYmFzZTsKKwlvYmogPSAmcW9iai0+YmFzZS5iYXNl
OwogCiAJcmV0ID0gZHJtX2dlbV9oYW5kbGVfY3JlYXRlKGZpbGVfcHJpdiwgb2JqLCAmaGFuZGxl
KTsKIAlpZiAocmV0KSB7CkBAIC0yODYsNyArMjg1LDcgQEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1
X3Jlc291cmNlX2luZm9faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAogCXFvYmogPSBnZW1fdG9fdmlydGlvX2dwdV9vYmooZ29iaik7CiAKLQlyaS0+c2l6ZSA9IHFv
YmotPmdlbV9iYXNlLnNpemU7CisJcmktPnNpemUgPSBxb2JqLT5iYXNlLmJhc2Uuc2l6ZTsKIAly
aS0+cmVzX2hhbmRsZSA9IHFvYmotPmh3X3Jlc19oYW5kbGU7CiAJZHJtX2dlbV9vYmplY3RfcHV0
X3VubG9ja2VkKGdvYmopOwogCXJldHVybiAwOwpAQCAtMjk5LDcgKzI5OCw2IEBAIHN0YXRpYyBp
bnQgdmlydGlvX2dwdV90cmFuc2Zlcl9mcm9tX2hvc3RfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2ID0gZGV2LT5kZXZfcHJpdmF0
ZTsKIAlzdHJ1Y3QgdmlydGlvX2dwdV9mcHJpdiAqdmZwcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7
CiAJc3RydWN0IGRybV92aXJ0Z3B1XzNkX3RyYW5zZmVyX2Zyb21faG9zdCAqYXJncyA9IGRhdGE7
Ci0Jc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsgdHJ1ZSwgZmFsc2UgfTsKIAlzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmogPSBOVUxMOwogCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVj
dCAqcW9iaiA9IE5VTEw7CiAJc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKmZlbmNlOwpAQCAtMzIw
LDEwICszMTgsNiBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfdHJhbnNmZXJfZnJvbV9ob3N0X2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYgKHJldCkKIAkJZ290byBvdXQ7CiAKLQly
ZXQgPSB0dG1fYm9fdmFsaWRhdGUoJnFvYmotPnRibywgJnFvYmotPnBsYWNlbWVudCwgJmN0eCk7
Ci0JaWYgKHVubGlrZWx5KHJldCkpCi0JCWdvdG8gb3V0X3VucmVzOwotCiAJY29udmVydF90b19o
d19ib3goJmJveCwgJmFyZ3MtPmJveCk7CiAKIAlmZW5jZSA9IHZpcnRpb19ncHVfZmVuY2VfYWxs
b2ModmdkZXYpOwpAQCAtMzM1LDcgKzMyOSw3IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV90cmFu
c2Zlcl9mcm9tX2hvc3RfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJKHZnZGV2LCBx
b2JqLT5od19yZXNfaGFuZGxlLAogCQkgdmZwcml2LT5jdHhfaWQsIG9mZnNldCwgYXJncy0+bGV2
ZWwsCiAJCSAmYm94LCBmZW5jZSk7Ci0JcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2ZlbmNl
KHFvYmotPnRiby5yZXN2LAorCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5jZShxb2Jq
LT5iYXNlLmJhc2UucmVzdiwKIAkJCQkJICAmZmVuY2UtPmYpOwogCiAJZG1hX2ZlbmNlX3B1dCgm
ZmVuY2UtPmYpOwpAQCAtMzUyLDcgKzM0Niw2IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV90cmFu
c2Zlcl90b19ob3N0X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJ
c3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3Ry
dWN0IHZpcnRpb19ncHVfZnByaXYgKnZmcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OwogCXN0cnVj
dCBkcm1fdmlydGdwdV8zZF90cmFuc2Zlcl90b19ob3N0ICphcmdzID0gZGF0YTsKLQlzdHJ1Y3Qg
dHRtX29wZXJhdGlvbl9jdHggY3R4ID0geyB0cnVlLCBmYWxzZSB9OwogCXN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqZ29iaiA9IE5VTEw7CiAJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpxb2JqID0g
TlVMTDsKIAlzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2U7CkBAIC0zNzAsMTAgKzM2Myw2
IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV90cmFuc2Zlcl90b19ob3N0X2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKHJldCkKIAkJZ290byBvdXQ7CiAKLQly
ZXQgPSB0dG1fYm9fdmFsaWRhdGUoJnFvYmotPnRibywgJnFvYmotPnBsYWNlbWVudCwgJmN0eCk7
Ci0JaWYgKHVubGlrZWx5KHJldCkpCi0JCWdvdG8gb3V0X3VucmVzOwotCiAJY29udmVydF90b19o
d19ib3goJmJveCwgJmFyZ3MtPmJveCk7CiAJaWYgKCF2Z2Rldi0+aGFzX3ZpcmdsXzNkKSB7CiAJ
CXZpcnRpb19ncHVfY21kX3RyYW5zZmVyX3RvX2hvc3RfMmQKQEAgLTM4OSw3ICszNzgsNyBAQCBz
dGF0aWMgaW50IHZpcnRpb19ncHVfdHJhbnNmZXJfdG9faG9zdF9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJKHZnZGV2LCBxb2JqLAogCQkJIHZmcHJpdiA/IHZm
cHJpdi0+Y3R4X2lkIDogMCwgb2Zmc2V0LAogCQkJIGFyZ3MtPmxldmVsLCAmYm94LCBmZW5jZSk7
Ci0JCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5jZShxb2JqLT50Ym8ucmVzdiwKKwkJ
cmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2ZlbmNlKHFvYmotPmJhc2UuYmFzZS5yZXN2LAog
CQkJCQkJICAmZmVuY2UtPmYpOwogCQlkbWFfZmVuY2VfcHV0KCZmZW5jZS0+Zik7CiAJfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2ttcy5jIGIvZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2ttcy5jCmluZGV4IDg0YjZhNmJmMDBjNi4uMGJjNmFiYWVh
ZmNhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfa21zLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2ttcy5jCkBAIC0xNzEsMTIgKzE3MSw2
IEBAIGludCB2aXJ0aW9fZ3B1X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJZ290byBl
cnJfdmJ1ZnM7CiAJfQogCi0JcmV0ID0gdmlydGlvX2dwdV90dG1faW5pdCh2Z2Rldik7Ci0JaWYg
KHJldCkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0IHR0bSAlZFxuIiwgcmV0KTsKLQkJ
Z290byBlcnJfdHRtOwotCX0KLQogCS8qIGdldCBkaXNwbGF5IGluZm8gKi8KIAl2aXJ0aW9fY3Jl
YWQodmdkZXYtPnZkZXYsIHN0cnVjdCB2aXJ0aW9fZ3B1X2NvbmZpZywKIAkJICAgICBudW1fc2Nh
bm91dHMsICZudW1fc2Nhbm91dHMpOwpAQCAtMjA4LDggKzIwMiw2IEBAIGludCB2aXJ0aW9fZ3B1
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlyZXR1cm4gMDsKIAogZXJyX3NjYW5vdXRz
OgotCXZpcnRpb19ncHVfdHRtX2ZpbmkodmdkZXYpOwotZXJyX3R0bToKIAl2aXJ0aW9fZ3B1X2Zy
ZWVfdmJ1ZnModmdkZXYpOwogZXJyX3ZidWZzOgogCXZnZGV2LT52ZGV2LT5jb25maWctPmRlbF92
cXModmdkZXYtPnZkZXYpOwpAQCAtMjQwLDcgKzIzMiw2IEBAIHZvaWQgdmlydGlvX2dwdV9kZWlu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAl2Z2Rldi0+dmRldi0+Y29uZmlnLT5kZWxfdnFz
KHZnZGV2LT52ZGV2KTsKIAogCXZpcnRpb19ncHVfbW9kZXNldF9maW5pKHZnZGV2KTsKLQl2aXJ0
aW9fZ3B1X3R0bV9maW5pKHZnZGV2KTsKIAl2aXJ0aW9fZ3B1X2ZyZWVfdmJ1ZnModmdkZXYpOwog
CXZpcnRpb19ncHVfY2xlYW51cF9jYXBfY2FjaGUodmdkZXYpOwogCWtmcmVlKHZnZGV2LT5jYXBz
ZXRzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9vYmplY3Qu
YyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9vYmplY3QuYwppbmRleCAyOTAyNDg3
ZjA1MWEuLmZiOWQwNWE2OGY0YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9vYmpl
Y3QuYwpAQCAtMjMsOCArMjMsNiBAQAogICogV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBP
UiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiAgKi8KIAotI2luY2x1ZGUgPGRybS90
dG0vdHRtX2V4ZWNidWZfdXRpbC5oPgotCiAjaW5jbHVkZSAidmlydGdwdV9kcnYuaCIKIAogc3Rh
dGljIGludCB2aXJ0aW9fZ3B1X3Jlc291cmNlX2lkX2dldChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZp
Y2UgKnZnZGV2LApAQCAtNTcsMzkgKzU1LDQ1IEBAIHN0YXRpYyB2b2lkIHZpcnRpb19ncHVfcmVz
b3VyY2VfaWRfcHV0KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsIHVpbnQzMl90CiAj
ZW5kaWYKIH0KIAotc3RhdGljIHZvaWQgdmlydGlvX2dwdV90dG1fYm9fZGVzdHJveShzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKnRibykKK3N0YXRpYyB2b2lkIHZpcnRpb19ncHVfZnJlZV9vYmpl
Y3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0Jc3RydWN0IHZpcnRpb19ncHVfb2Jq
ZWN0ICpibzsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2OwotCi0JYm8gPSBjb250
YWluZXJfb2YodGJvLCBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QsIHRibyk7Ci0JdmdkZXYgPSAo
c3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICopYm8tPmdlbV9iYXNlLmRldi0+ZGV2X3ByaXZhdGU7
CisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibyA9IGdlbV90b192aXJ0aW9fZ3B1X29iaihv
YmopOworCXN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPSBiby0+YmFzZS5iYXNlLmRl
di0+ZGV2X3ByaXZhdGU7CiAKKwlpZiAoYm8tPnBhZ2VzKQorCQl2aXJ0aW9fZ3B1X29iamVjdF9k
ZXRhY2godmdkZXYsIGJvKTsKIAlpZiAoYm8tPmNyZWF0ZWQpCiAJCXZpcnRpb19ncHVfY21kX3Vu
cmVmX3Jlc291cmNlKHZnZGV2LCBiby0+aHdfcmVzX2hhbmRsZSk7Ci0JaWYgKGJvLT5wYWdlcykK
LQkJdmlydGlvX2dwdV9vYmplY3RfZnJlZV9zZ190YWJsZShibyk7Ci0JaWYgKGJvLT52bWFwKQot
CQl2aXJ0aW9fZ3B1X29iamVjdF9rdW5tYXAoYm8pOwotCWRybV9nZW1fb2JqZWN0X3JlbGVhc2Uo
JmJvLT5nZW1fYmFzZSk7CiAJdmlydGlvX2dwdV9yZXNvdXJjZV9pZF9wdXQodmdkZXYsIGJvLT5o
d19yZXNfaGFuZGxlKTsKLQlrZnJlZShibyk7CisKKwlkcm1fZ2VtX3NobWVtX2ZyZWVfb2JqZWN0
KG9iaik7CiB9CiAKLXN0YXRpYyB2b2lkIHZpcnRpb19ncHVfaW5pdF90dG1fcGxhY2VtZW50KHN0
cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqdmdibykKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2dl
bV9vYmplY3RfZnVuY3MgdmlydGlvX2dwdV9nZW1fZnVuY3MgPSB7CisJLmZyZWUgPSB2aXJ0aW9f
Z3B1X2ZyZWVfb2JqZWN0LAorCS5vcGVuID0gdmlydGlvX2dwdV9nZW1fb2JqZWN0X29wZW4sCisJ
LmNsb3NlID0gdmlydGlvX2dwdV9nZW1fb2JqZWN0X2Nsb3NlLAorCisJLnByaW50X2luZm8gPSBk
cm1fZ2VtX3NobWVtX3ByaW50X2luZm8sCisJLnBpbiA9IGRybV9nZW1fc2htZW1fcGluLAorCS51
bnBpbiA9IGRybV9nZW1fc2htZW1fdW5waW4sCisJLmdldF9zZ190YWJsZSA9IGRybV9nZW1fc2ht
ZW1fZ2V0X3NnX3RhYmxlLAorCS52bWFwID0gZHJtX2dlbV9zaG1lbV92bWFwLAorCS52dW5tYXAg
PSBkcm1fZ2VtX3NobWVtX3Z1bm1hcCwKKwkudm1fb3BzID0gJmRybV9nZW1fc2htZW1fdm1fb3Bz
LAorfTsKKworc3RydWN0IGRybV9nZW1fb2JqZWN0ICp2aXJ0aW9fZ3B1X2NyZWF0ZV9vYmplY3Qo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJCQkJCXNpemVfdCBzaXplKQogewotCXUzMiBjID0g
MTsKKwlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvOwogCi0Jdmdiby0+cGxhY2VtZW50LnBs
YWNlbWVudCA9ICZ2Z2JvLT5wbGFjZW1lbnRfY29kZTsKLQl2Z2JvLT5wbGFjZW1lbnQuYnVzeV9w
bGFjZW1lbnQgPSAmdmdiby0+cGxhY2VtZW50X2NvZGU7Ci0Jdmdiby0+cGxhY2VtZW50X2NvZGUu
ZnBmbiA9IDA7Ci0Jdmdiby0+cGxhY2VtZW50X2NvZGUubHBmbiA9IDA7Ci0Jdmdiby0+cGxhY2Vt
ZW50X2NvZGUuZmxhZ3MgPQotCQlUVE1fUExfTUFTS19DQUNISU5HIHwgVFRNX1BMX0ZMQUdfVFQg
fAotCQlUVE1fUExfRkxBR19OT19FVklDVDsKLQl2Z2JvLT5wbGFjZW1lbnQubnVtX3BsYWNlbWVu
dCA9IGM7Ci0Jdmdiby0+cGxhY2VtZW50Lm51bV9idXN5X3BsYWNlbWVudCA9IGM7CisJYm8gPSBr
emFsbG9jKHNpemVvZigqYm8pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJvKQorCQlyZXR1cm4gTlVM
TDsKIAorCWJvLT5iYXNlLmJhc2UuZnVuY3MgPSAmdmlydGlvX2dwdV9nZW1fZnVuY3M7CisJcmV0
dXJuICZiby0+YmFzZS5iYXNlOwogfQogCiBpbnQgdmlydGlvX2dwdV9vYmplY3RfY3JlYXRlKHN0
cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCkBAIC05OCwyNyArMTAyLDIyIEBAIGludCB2
aXJ0aW9fZ3B1X29iamVjdF9jcmVhdGUoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwK
IAkJCSAgICAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKmZlbmNlKQogewogCXN0cnVjdCB2aXJ0
aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqcyA9IE5VTEw7CisJc3RydWN0IGRybV9nZW1fc2htZW1f
b2JqZWN0ICpzaG1lbV9vYmo7CiAJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibzsKLQlzaXpl
X3QgYWNjX3NpemU7CiAJaW50IHJldDsKIAogCSpib19wdHIgPSBOVUxMOwogCi0JYWNjX3NpemUg
PSB0dG1fYm9fZG1hX2FjY19zaXplKCZ2Z2Rldi0+bW1hbi5iZGV2LCBwYXJhbXMtPnNpemUsCi0J
CQkJICAgICAgIHNpemVvZihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QpKTsKKwlwYXJhbXMtPnNp
emUgPSByb3VuZHVwKHBhcmFtcy0+c2l6ZSwgUEFHRV9TSVpFKTsKKwlzaG1lbV9vYmogPSBkcm1f
Z2VtX3NobWVtX2NyZWF0ZSh2Z2Rldi0+ZGRldiwgcGFyYW1zLT5zaXplKTsKKwlpZiAoSVNfRVJS
KHNobWVtX29iaikpCisJCXJldHVybiBQVFJfRVJSKHNobWVtX29iaik7CisJYm8gPSBnZW1fdG9f
dmlydGlvX2dwdV9vYmooJnNobWVtX29iai0+YmFzZSk7CiAKLQlibyA9IGt6YWxsb2Moc2l6ZW9m
KHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCksIEdGUF9LRVJORUwpOwotCWlmIChibyA9PSBOVUxM
KQotCQlyZXR1cm4gLUVOT01FTTsKIAlyZXQgPSB2aXJ0aW9fZ3B1X3Jlc291cmNlX2lkX2dldCh2
Z2RldiwgJmJvLT5od19yZXNfaGFuZGxlKTsKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfZnJl
ZV9nZW07CiAKLQlwYXJhbXMtPnNpemUgPSByb3VuZHVwKHBhcmFtcy0+c2l6ZSwgUEFHRV9TSVpF
KTsKLQlyZXQgPSBkcm1fZ2VtX29iamVjdF9pbml0KHZnZGV2LT5kZGV2LCAmYm8tPmdlbV9iYXNl
LCBwYXJhbXMtPnNpemUpOwotCWlmIChyZXQgIT0gMCkKLQkJZ290byBlcnJfcHV0X2lkOwotCiAJ
Ym8tPmR1bWIgPSBwYXJhbXMtPmR1bWI7CiAKIAlpZiAoZmVuY2UpIHsKQEAgLTEyNiw3ICsxMjUs
NyBAQCBpbnQgdmlydGlvX2dwdV9vYmplY3RfY3JlYXRlKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rldmlj
ZSAqdmdkZXYsCiAJCW9ianMgPSB2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKDEpOwogCQlpZiAoIW9i
anMpCiAJCQlnb3RvIGVycl9wdXRfaWQ7Ci0JCXZpcnRpb19ncHVfYXJyYXlfYWRkX29iaihvYmpz
LCAmYm8tPmdlbV9iYXNlKTsKKwkJdmlydGlvX2dwdV9hcnJheV9hZGRfb2JqKG9ianMsICZiby0+
YmFzZS5iYXNlKTsKIAogCQlyZXQgPSB2aXJ0aW9fZ3B1X2FycmF5X2xvY2tfcmVzdihvYmpzKTsK
IAkJaWYgKHJldCAhPSAwKQpAQCAtMTQxLDE1ICsxNDAsMTEgQEAgaW50IHZpcnRpb19ncHVfb2Jq
ZWN0X2NyZWF0ZShzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJCQkgICAgICAg
b2JqcywgZmVuY2UpOwogCX0KIAotCXZpcnRpb19ncHVfaW5pdF90dG1fcGxhY2VtZW50KGJvKTsK
LQlyZXQgPSB0dG1fYm9faW5pdCgmdmdkZXYtPm1tYW4uYmRldiwgJmJvLT50Ym8sIHBhcmFtcy0+
c2l6ZSwKLQkJCSAgdHRtX2JvX3R5cGVfZGV2aWNlLCAmYm8tPnBsYWNlbWVudCwgMCwKLQkJCSAg
dHJ1ZSwgYWNjX3NpemUsIE5VTEwsCi0JCQkgIGJvLT5nZW1fYmFzZS5yZXN2LAotCQkJICAmdmly
dGlvX2dwdV90dG1fYm9fZGVzdHJveSk7Ci0JLyogdHRtX2JvX2luaXQgZmFpbHVyZSB3aWxsIGNh
bGwgdGhlIGRlc3Ryb3kgKi8KLQlpZiAocmV0ICE9IDApCisJcmV0ID0gdmlydGlvX2dwdV9vYmpl
Y3RfYXR0YWNoKHZnZGV2LCBibywgTlVMTCk7CisJaWYgKHJldCAhPSAwKSB7CisJCXZpcnRpb19n
cHVfZnJlZV9vYmplY3QoJnNobWVtX29iai0+YmFzZSk7CiAJCXJldHVybiByZXQ7CisJfQogCiAJ
KmJvX3B0ciA9IGJvOwogCXJldHVybiAwOwpAQCAtMTU5LDY1ICsxNTQsNiBAQCBpbnQgdmlydGlv
X2dwdV9vYmplY3RfY3JlYXRlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiBlcnJf
cHV0X2lkOgogCXZpcnRpb19ncHVfcmVzb3VyY2VfaWRfcHV0KHZnZGV2LCBiby0+aHdfcmVzX2hh
bmRsZSk7CiBlcnJfZnJlZV9nZW06Ci0Ja2ZyZWUoYm8pOworCWRybV9nZW1fc2htZW1fZnJlZV9v
YmplY3QoJnNobWVtX29iai0+YmFzZSk7CiAJcmV0dXJuIHJldDsKIH0KLQotdm9pZCB2aXJ0aW9f
Z3B1X29iamVjdF9rdW5tYXAoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0ICpibykKLXsKLQliby0+
dm1hcCA9IE5VTEw7Ci0JdHRtX2JvX2t1bm1hcCgmYm8tPmttYXApOwotfQotCi1pbnQgdmlydGlv
X2dwdV9vYmplY3Rfa21hcChzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKmJvKQotewotCWJvb2wg
aXNfaW9tZW07Ci0JaW50IHI7Ci0KLQlXQVJOX09OKGJvLT52bWFwKTsKLQotCXIgPSB0dG1fYm9f
a21hcCgmYm8tPnRibywgMCwgYm8tPnRiby5udW1fcGFnZXMsICZiby0+a21hcCk7Ci0JaWYgKHIp
Ci0JCXJldHVybiByOwotCWJvLT52bWFwID0gdHRtX2ttYXBfb2JqX3ZpcnR1YWwoJmJvLT5rbWFw
LCAmaXNfaW9tZW0pOwotCXJldHVybiAwOwotfQotCi1pbnQgdmlydGlvX2dwdV9vYmplY3RfZ2V0
X3NnX3RhYmxlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqcWRldiwKLQkJCQkgICBzdHJ1Y3Qg
dmlydGlvX2dwdV9vYmplY3QgKmJvKQotewotCWludCByZXQ7Ci0Jc3RydWN0IHBhZ2UgKipwYWdl
cyA9IGJvLT50Ym8udHRtLT5wYWdlczsKLQlpbnQgbnJfcGFnZXMgPSBiby0+dGJvLm51bV9wYWdl
czsKLQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0gewotCQkuaW50ZXJydXB0aWJsZSA9
IGZhbHNlLAotCQkubm9fd2FpdF9ncHUgPSBmYWxzZQotCX07Ci0KLQkvKiB3dGYgc3dhcHBpbmcg
Ki8KLQlpZiAoYm8tPnBhZ2VzKQotCQlyZXR1cm4gMDsKLQotCWlmIChiby0+dGJvLnR0bS0+c3Rh
dGUgPT0gdHRfdW5wb3B1bGF0ZWQpCi0JCWJvLT50Ym8udHRtLT5iZGV2LT5kcml2ZXItPnR0bV90
dF9wb3B1bGF0ZShiby0+dGJvLnR0bSwgJmN0eCk7Ci0JYm8tPnBhZ2VzID0ga21hbGxvYyhzaXpl
b2Yoc3RydWN0IHNnX3RhYmxlKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFiby0+cGFnZXMpCi0JCWdv
dG8gb3V0OwotCi0JcmV0ID0gc2dfYWxsb2NfdGFibGVfZnJvbV9wYWdlcyhiby0+cGFnZXMsIHBh
Z2VzLCBucl9wYWdlcywgMCwKLQkJCQkJbnJfcGFnZXMgPDwgUEFHRV9TSElGVCwgR0ZQX0tFUk5F
TCk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXQ7Ci0JcmV0dXJuIDA7Ci1vdXQ6Ci0Ja2ZyZWUoYm8t
PnBhZ2VzKTsKLQliby0+cGFnZXMgPSBOVUxMOwotCXJldHVybiAtRU5PTUVNOwotfQotCi12b2lk
IHZpcnRpb19ncHVfb2JqZWN0X2ZyZWVfc2dfdGFibGUoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0
ICpibykKLXsKLQlzZ19mcmVlX3RhYmxlKGJvLT5wYWdlcyk7Ci0Ja2ZyZWUoYm8tPnBhZ2VzKTsK
LQliby0+cGFnZXMgPSBOVUxMOwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRp
by92aXJ0Z3B1X3ByaW1lLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfcHJpbWUu
YwppbmRleCA4ZmJmNzFiZDBjNWUuLjE4YTE1NWNkMDhkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ByaW1lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRp
by92aXJ0Z3B1X3ByaW1lLmMKQEAgLTI4LDQ2ICsyOCw5IEBACiAgKiBkZXZpY2UgdGhhdCBtaWdo
dCBzaGFyZSBidWZmZXJzIHdpdGggdmlydGdwdQogICovCiAKLXN0cnVjdCBzZ190YWJsZSAqdmly
dGdwdV9nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQot
ewotCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoo
b2JqKTsKLQotCWlmICghYm8tPnRiby50dG0tPnBhZ2VzIHx8ICFiby0+dGJvLnR0bS0+bnVtX3Bh
Z2VzKQotCQkvKiBzaG91bGQgbm90IGhhcHBlbiAqLwotCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFM
KTsKLQotCXJldHVybiBkcm1fcHJpbWVfcGFnZXNfdG9fc2coYm8tPnRiby50dG0tPnBhZ2VzLAot
CQkJCSAgICAgYm8tPnRiby50dG0tPm51bV9wYWdlcyk7Ci19Ci0KIHN0cnVjdCBkcm1fZ2VtX29i
amVjdCAqdmlydGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlKAogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKIAlzdHJ1Y3Qgc2df
dGFibGUgKnRhYmxlKQogewogCXJldHVybiBFUlJfUFRSKC1FTk9ERVYpOwogfQotCi12b2lkICp2
aXJ0Z3B1X2dlbV9wcmltZV92bWFwKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQotewotCXN0
cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoob2JqKTsK
LQlpbnQgcmV0OwotCi0JcmV0ID0gdmlydGlvX2dwdV9vYmplY3Rfa21hcChibyk7Ci0JaWYgKHJl
dCkKLQkJcmV0dXJuIE5VTEw7Ci0JcmV0dXJuIGJvLT52bWFwOwotfQotCi12b2lkIHZpcnRncHVf
Z2VtX3ByaW1lX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgdm9pZCAqdmFkZHIp
Ci17Ci0JdmlydGlvX2dwdV9vYmplY3Rfa3VubWFwKGdlbV90b192aXJ0aW9fZ3B1X29iaihvYmop
KTsKLX0KLQotaW50IHZpcnRncHVfZ2VtX3ByaW1lX21tYXAoc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmosCi0JCQkgICBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKLXsKLQlzdHJ1Y3Qgdmly
dGlvX2dwdV9vYmplY3QgKmJvID0gZ2VtX3RvX3ZpcnRpb19ncHVfb2JqKG9iaik7Ci0KLQliby0+
Z2VtX2Jhc2Uudm1hX25vZGUudm1fbm9kZS5zdGFydCA9IGJvLT50Ym8udm1hX25vZGUudm1fbm9k
ZS5zdGFydDsKLQlyZXR1cm4gZHJtX2dlbV9wcmltZV9tbWFwKG9iaiwgdm1hKTsKLX0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1
L2RybS92aXJ0aW8vdmlydGdwdV90dG0uYwpkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MzAwZWYzYTgzNTM4Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X3R0bS5jCisrKyAvZGV2L251bGwKQEAgLTEsMzA0ICswLDAgQEAKLS8qCi0gKiBDb3B5
cmlnaHQgKEMpIDIwMTUgUmVkIEhhdCwgSW5jLgotICogQWxsIFJpZ2h0cyBSZXNlcnZlZC4KLSAq
Ci0gKiBBdXRob3JzOgotICogICAgRGF2ZSBBaXJsaWUKLSAqICAgIEFsb24gTGV2eQotICoKLSAq
IFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVy
c29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQg
ZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAotICogdG8gZGVhbCBpbiB0aGUg
U29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlv
bgotICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRp
c3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3
YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAqIFNvZnR3YXJlIGlzIGZ1
cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0g
KgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3Rp
Y2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KLSAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9y
dGlvbnMgb2YgdGhlIFNvZnR3YXJlLgotICoKLSAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAi
QVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCi0gKiBJTVBM
SUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNI
QU5UQUJJTElUWSwKLSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05J
TkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAotICogVEhFIENPUFlSSUdIVCBIT0xERVIo
UykgT1IgQVVUSE9SKFMpIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCi0gKiBP
VEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9S
IE9USEVSV0lTRSwKLSAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lU
SCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgotICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNP
RlRXQVJFLgotICovCi0KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KLSNpbmNsdWRl
IDxkcm0vdHRtL3R0bV9ib19kcml2ZXIuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wbGFjZW1l
bnQuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmg+Ci0jaW5jbHVkZSA8ZHJt
L3R0bS90dG1fbW9kdWxlLmg+Ci0jaW5jbHVkZSA8ZHJtL2RybVAuaD4KLSNpbmNsdWRlIDxkcm0v
ZHJtLmg+Ci0jaW5jbHVkZSA8ZHJtL3ZpcnRncHVfZHJtLmg+Ci0jaW5jbHVkZSAidmlydGdwdV9k
cnYuaCIKLQotI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+Ci0KLXN0YXRpYyBzdHJ1Y3QKLXZpcnRp
b19ncHVfZGV2aWNlICp2aXJ0aW9fZ3B1X2dldF92Z2RldihzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldikKLXsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9tbWFuICptbWFuOwotCXN0cnVjdCB2aXJ0aW9f
Z3B1X2RldmljZSAqdmdkZXY7Ci0KLQltbWFuID0gY29udGFpbmVyX29mKGJkZXYsIHN0cnVjdCB2
aXJ0aW9fZ3B1X21tYW4sIGJkZXYpOwotCXZnZGV2ID0gY29udGFpbmVyX29mKG1tYW4sIHN0cnVj
dCB2aXJ0aW9fZ3B1X2RldmljZSwgbW1hbik7Ci0JcmV0dXJuIHZnZGV2OwotfQotCi1pbnQgdmly
dGlvX2dwdV9tbWFwKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZt
YSkKLXsKLQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdjsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9k
ZXZpY2UgKnZnZGV2OwotCWludCByOwotCi0JZmlsZV9wcml2ID0gZmlscC0+cHJpdmF0ZV9kYXRh
OwotCXZnZGV2ID0gZmlsZV9wcml2LT5taW5vci0+ZGV2LT5kZXZfcHJpdmF0ZTsKLQlpZiAodmdk
ZXYgPT0gTlVMTCkgewotCQlEUk1fRVJST1IoCi0JCSAiZmlscC0+cHJpdmF0ZV9kYXRhLT5taW5v
ci0+ZGV2LT5kZXZfcHJpdmF0ZSA9PSBOVUxMXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQot
CXIgPSB0dG1fYm9fbW1hcChmaWxwLCB2bWEsICZ2Z2Rldi0+bW1hbi5iZGV2KTsKLQotCXJldHVy
biByOwotfQotCi1zdGF0aWMgaW50IHZpcnRpb19ncHVfaW52YWxpZGF0ZV9jYWNoZXMoc3RydWN0
IHR0bV9ib19kZXZpY2UgKmJkZXYsCi0JCQkJCXVpbnQzMl90IGZsYWdzKQotewotCXJldHVybiAw
OwotfQotCi1zdGF0aWMgaW50IHR0bV9ib19tYW5fZ2V0X25vZGUoc3RydWN0IHR0bV9tZW1fdHlw
ZV9tYW5hZ2VyICptYW4sCi0JCQkgICAgICAgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
LQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSwKLQkJCSAgICAgICBzdHJ1
Y3QgdHRtX21lbV9yZWcgKm1lbSkKLXsKLQltZW0tPm1tX25vZGUgPSAodm9pZCAqKTE7Ci0JcmV0
dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIHR0bV9ib19tYW5fcHV0X25vZGUoc3RydWN0IHR0bV9t
ZW1fdHlwZV9tYW5hZ2VyICptYW4sCi0JCQkJc3RydWN0IHR0bV9tZW1fcmVnICptZW0pCi17Ci0J
bWVtLT5tbV9ub2RlID0gKHZvaWQgKilOVUxMOwotfQotCi1zdGF0aWMgaW50IHR0bV9ib19tYW5f
aW5pdChzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiwKLQkJCSAgIHVuc2lnbmVkIGxv
bmcgcF9zaXplKQotewotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHR0bV9ib19tYW5fdGFr
ZWRvd24oc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4pCi17Ci0JcmV0dXJuIDA7Ci19
Ci0KLXN0YXRpYyB2b2lkIHR0bV9ib19tYW5fZGVidWcoc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5h
Z2VyICptYW4sCi0JCQkgICAgIHN0cnVjdCBkcm1fcHJpbnRlciAqcHJpbnRlcikKLXsKLX0KLQot
c3RhdGljIGNvbnN0IHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlcl9mdW5jIHZpcnRpb19ncHVf
Ym9fbWFuYWdlcl9mdW5jID0gewotCS5pbml0ID0gdHRtX2JvX21hbl9pbml0LAotCS50YWtlZG93
biA9IHR0bV9ib19tYW5fdGFrZWRvd24sCi0JLmdldF9ub2RlID0gdHRtX2JvX21hbl9nZXRfbm9k
ZSwKLQkucHV0X25vZGUgPSB0dG1fYm9fbWFuX3B1dF9ub2RlLAotCS5kZWJ1ZyA9IHR0bV9ib19t
YW5fZGVidWcKLX07Ci0KLXN0YXRpYyBpbnQgdmlydGlvX2dwdV9pbml0X21lbV90eXBlKHN0cnVj
dCB0dG1fYm9fZGV2aWNlICpiZGV2LCB1aW50MzJfdCB0eXBlLAotCQkJCSAgICBzdHJ1Y3QgdHRt
X21lbV90eXBlX21hbmFnZXIgKm1hbikKLXsKLQlzd2l0Y2ggKHR5cGUpIHsKLQljYXNlIFRUTV9Q
TF9TWVNURU06Ci0JCS8qIFN5c3RlbSBtZW1vcnkgKi8KLQkJbWFuLT5mbGFncyA9IFRUTV9NRU1U
WVBFX0ZMQUdfTUFQUEFCTEU7Ci0JCW1hbi0+YXZhaWxhYmxlX2NhY2hpbmcgPSBUVE1fUExfTUFT
S19DQUNISU5HOwotCQltYW4tPmRlZmF1bHRfY2FjaGluZyA9IFRUTV9QTF9GTEFHX0NBQ0hFRDsK
LQkJYnJlYWs7Ci0JY2FzZSBUVE1fUExfVFQ6Ci0JCW1hbi0+ZnVuYyA9ICZ2aXJ0aW9fZ3B1X2Jv
X21hbmFnZXJfZnVuYzsKLQkJbWFuLT5mbGFncyA9IFRUTV9NRU1UWVBFX0ZMQUdfTUFQUEFCTEU7
Ci0JCW1hbi0+YXZhaWxhYmxlX2NhY2hpbmcgPSBUVE1fUExfTUFTS19DQUNISU5HOwotCQltYW4t
PmRlZmF1bHRfY2FjaGluZyA9IFRUTV9QTF9GTEFHX0NBQ0hFRDsKLQkJYnJlYWs7Ci0JZGVmYXVs
dDoKLQkJRFJNX0VSUk9SKCJVbnN1cHBvcnRlZCBtZW1vcnkgdHlwZSAldVxuIiwgKHVuc2lnbmVk
IGludCl0eXBlKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgdm9pZCB2aXJ0aW9fZ3B1X2V2aWN0X2ZsYWdzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sCi0JCQkJc3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCkKLXsKLQlzdGF0aWMgY29u
c3Qgc3RydWN0IHR0bV9wbGFjZSBwbGFjZW1lbnRzID0gewotCQkuZnBmbiAgPSAwLAotCQkubHBm
biAgPSAwLAotCQkuZmxhZ3MgPSBUVE1fUExfTUFTS19DQUNISU5HIHwgVFRNX1BMX0ZMQUdfU1lT
VEVNLAotCX07Ci0KLQlwbGFjZW1lbnQtPnBsYWNlbWVudCA9ICZwbGFjZW1lbnRzOwotCXBsYWNl
bWVudC0+YnVzeV9wbGFjZW1lbnQgPSAmcGxhY2VtZW50czsKLQlwbGFjZW1lbnQtPm51bV9wbGFj
ZW1lbnQgPSAxOwotCXBsYWNlbWVudC0+bnVtX2J1c3lfcGxhY2VtZW50ID0gMTsKLX0KLQotc3Rh
dGljIGludCB2aXJ0aW9fZ3B1X3ZlcmlmeV9hY2Nlc3Moc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0
ICpibywKLQkJCQkgICAgc3RydWN0IGZpbGUgKmZpbHApCi17Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyBpbnQgdmlydGlvX2dwdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9ib19kZXZp
Y2UgKmJkZXYsCi0JCQkJCSBzdHJ1Y3QgdHRtX21lbV9yZWcgKm1lbSkKLXsKLQlzdHJ1Y3QgdHRt
X21lbV90eXBlX21hbmFnZXIgKm1hbiA9ICZiZGV2LT5tYW5bbWVtLT5tZW1fdHlwZV07Ci0KLQlt
ZW0tPmJ1cy5hZGRyID0gTlVMTDsKLQltZW0tPmJ1cy5vZmZzZXQgPSAwOwotCW1lbS0+YnVzLnNp
emUgPSBtZW0tPm51bV9wYWdlcyA8PCBQQUdFX1NISUZUOwotCW1lbS0+YnVzLmJhc2UgPSAwOwot
CW1lbS0+YnVzLmlzX2lvbWVtID0gZmFsc2U7Ci0JaWYgKCEobWFuLT5mbGFncyAmIFRUTV9NRU1U
WVBFX0ZMQUdfTUFQUEFCTEUpKQotCQlyZXR1cm4gLUVJTlZBTDsKLQlzd2l0Y2ggKG1lbS0+bWVt
X3R5cGUpIHsKLQljYXNlIFRUTV9QTF9TWVNURU06Ci0JY2FzZSBUVE1fUExfVFQ6Ci0JCS8qIHN5
c3RlbSBtZW1vcnkgKi8KLQkJcmV0dXJuIDA7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIC1FSU5WQUw7
Ci0JfQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X3R0bV9pb19tZW1f
ZnJlZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKLQkJCQkgICAgICAgc3RydWN0IHR0bV9t
ZW1fcmVnICptZW0pCi17Ci19Ci0KLS8qCi0gKiBUVE0gYmFja2VuZCBmdW5jdGlvbnMuCi0gKi8K
LXN0cnVjdCB2aXJ0aW9fZ3B1X3R0bV90dCB7Ci0Jc3RydWN0IHR0bV9kbWFfdHQJCXR0bTsKLQlz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgICAgICAgICpvYmo7Ci19OwotCi1zdGF0aWMgaW50IHZp
cnRpb19ncHVfdHRtX3R0X2JpbmQoc3RydWN0IHR0bV90dCAqdHRtLAotCQkJCSAgc3RydWN0IHR0
bV9tZW1fcmVnICpib19tZW0pCi17Ci0Jc3RydWN0IHZpcnRpb19ncHVfdHRtX3R0ICpndHQgPQot
CQljb250YWluZXJfb2YodHRtLCBzdHJ1Y3QgdmlydGlvX2dwdV90dG1fdHQsIHR0bS50dG0pOwot
CXN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYgPQotCQl2aXJ0aW9fZ3B1X2dldF92Z2Rl
dihndHQtPm9iai0+dGJvLmJkZXYpOwotCi0JdmlydGlvX2dwdV9vYmplY3RfYXR0YWNoKHZnZGV2
LCBndHQtPm9iaiwgTlVMTCk7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgdmlydGlvX2dw
dV90dG1fdHRfdW5iaW5kKHN0cnVjdCB0dG1fdHQgKnR0bSkKLXsKLQlzdHJ1Y3QgdmlydGlvX2dw
dV90dG1fdHQgKmd0dCA9Ci0JCWNvbnRhaW5lcl9vZih0dG0sIHN0cnVjdCB2aXJ0aW9fZ3B1X3R0
bV90dCwgdHRtLnR0bSk7Ci0Jc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiA9Ci0JCXZp
cnRpb19ncHVfZ2V0X3ZnZGV2KGd0dC0+b2JqLT50Ym8uYmRldik7Ci0KLQl2aXJ0aW9fZ3B1X29i
amVjdF9kZXRhY2godmdkZXYsIGd0dC0+b2JqKTsKLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZv
aWQgdmlydGlvX2dwdV90dG1fdHRfZGVzdHJveShzdHJ1Y3QgdHRtX3R0ICp0dG0pCi17Ci0Jc3Ry
dWN0IHZpcnRpb19ncHVfdHRtX3R0ICpndHQgPQotCQljb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qg
dmlydGlvX2dwdV90dG1fdHQsIHR0bS50dG0pOwotCi0JdHRtX2RtYV90dF9maW5pKCZndHQtPnR0
bSk7Ci0Ja2ZyZWUoZ3R0KTsKLX0KLQotc3RhdGljIHN0cnVjdCB0dG1fYmFja2VuZF9mdW5jIHZp
cnRpb19ncHVfdHRfZnVuYyA9IHsKLQkuYmluZCA9ICZ2aXJ0aW9fZ3B1X3R0bV90dF9iaW5kLAot
CS51bmJpbmQgPSAmdmlydGlvX2dwdV90dG1fdHRfdW5iaW5kLAotCS5kZXN0cm95ID0gJnZpcnRp
b19ncHVfdHRtX3R0X2Rlc3Ryb3ksCi19OwotCi1zdGF0aWMgc3RydWN0IHR0bV90dCAqdmlydGlv
X2dwdV90dG1fdHRfY3JlYXRlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCi0JCQkJCSAg
ICAgICB1aW50MzJfdCBwYWdlX2ZsYWdzKQotewotCXN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAq
dmdkZXY7Ci0Jc3RydWN0IHZpcnRpb19ncHVfdHRtX3R0ICpndHQ7Ci0KLQl2Z2RldiA9IHZpcnRp
b19ncHVfZ2V0X3ZnZGV2KGJvLT5iZGV2KTsKLQlndHQgPSBremFsbG9jKHNpemVvZihzdHJ1Y3Qg
dmlydGlvX2dwdV90dG1fdHQpLCBHRlBfS0VSTkVMKTsKLQlpZiAoZ3R0ID09IE5VTEwpCi0JCXJl
dHVybiBOVUxMOwotCWd0dC0+dHRtLnR0bS5mdW5jID0gJnZpcnRpb19ncHVfdHRfZnVuYzsKLQln
dHQtPm9iaiA9IGNvbnRhaW5lcl9vZihibywgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0LCB0Ym8p
OwotCWlmICh0dG1fZG1hX3R0X2luaXQoJmd0dC0+dHRtLCBibywgcGFnZV9mbGFncykpIHsKLQkJ
a2ZyZWUoZ3R0KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQotCXJldHVybiAmZ3R0LT50dG0udHRtOwot
fQotCi1zdGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X2JvX3N3YXBfbm90aWZ5KHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqdGJvKQotewotCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm87Ci0KLQli
byA9IGNvbnRhaW5lcl9vZih0Ym8sIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCwgdGJvKTsKLQot
CWlmIChiby0+cGFnZXMpCi0JCXZpcnRpb19ncHVfb2JqZWN0X2ZyZWVfc2dfdGFibGUoYm8pOwot
fQotCi1zdGF0aWMgc3RydWN0IHR0bV9ib19kcml2ZXIgdmlydGlvX2dwdV9ib19kcml2ZXIgPSB7
Ci0JLnR0bV90dF9jcmVhdGUgPSAmdmlydGlvX2dwdV90dG1fdHRfY3JlYXRlLAotCS5pbnZhbGlk
YXRlX2NhY2hlcyA9ICZ2aXJ0aW9fZ3B1X2ludmFsaWRhdGVfY2FjaGVzLAotCS5pbml0X21lbV90
eXBlID0gJnZpcnRpb19ncHVfaW5pdF9tZW1fdHlwZSwKLQkuZXZpY3Rpb25fdmFsdWFibGUgPSB0
dG1fYm9fZXZpY3Rpb25fdmFsdWFibGUsCi0JLmV2aWN0X2ZsYWdzID0gJnZpcnRpb19ncHVfZXZp
Y3RfZmxhZ3MsCi0JLnZlcmlmeV9hY2Nlc3MgPSAmdmlydGlvX2dwdV92ZXJpZnlfYWNjZXNzLAot
CS5pb19tZW1fcmVzZXJ2ZSA9ICZ2aXJ0aW9fZ3B1X3R0bV9pb19tZW1fcmVzZXJ2ZSwKLQkuaW9f
bWVtX2ZyZWUgPSAmdmlydGlvX2dwdV90dG1faW9fbWVtX2ZyZWUsCi0JLnN3YXBfbm90aWZ5ID0g
JnZpcnRpb19ncHVfYm9fc3dhcF9ub3RpZnksCi19OwotCi1pbnQgdmlydGlvX2dwdV90dG1faW5p
dChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KQotewotCWludCByOwotCi0JLyogTm8g
b3RoZXJzIHVzZXIgb2YgYWRkcmVzcyBzcGFjZSBzbyBzZXQgaXQgdG8gMCAqLwotCXIgPSB0dG1f
Ym9fZGV2aWNlX2luaXQoJnZnZGV2LT5tbWFuLmJkZXYsCi0JCQkgICAgICAgJnZpcnRpb19ncHVf
Ym9fZHJpdmVyLAotCQkJICAgICAgIHZnZGV2LT5kZGV2LT5hbm9uX2lub2RlLT5pX21hcHBpbmcs
Ci0JCQkgICAgICAgZmFsc2UpOwotCWlmIChyKSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIGluaXRp
YWxpemluZyBidWZmZXIgb2JqZWN0IGRyaXZlciglZCkuXG4iLCByKTsKLQkJZ290byBlcnJfZGV2
X2luaXQ7Ci0JfQotCi0JciA9IHR0bV9ib19pbml0X21tKCZ2Z2Rldi0+bW1hbi5iZGV2LCBUVE1f
UExfVFQsIDApOwotCWlmIChyKSB7Ci0JCURSTV9FUlJPUigiRmFpbGVkIGluaXRpYWxpemluZyBH
VFQgaGVhcC5cbiIpOwotCQlnb3RvIGVycl9tbV9pbml0OwotCX0KLQlyZXR1cm4gMDsKLQotZXJy
X21tX2luaXQ6Ci0JdHRtX2JvX2RldmljZV9yZWxlYXNlKCZ2Z2Rldi0+bW1hbi5iZGV2KTsKLWVy
cl9kZXZfaW5pdDoKLQlyZXR1cm4gcjsKLX0KLQotdm9pZCB2aXJ0aW9fZ3B1X3R0bV9maW5pKHN0
cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYpCi17Ci0JdHRtX2JvX2RldmljZV9yZWxlYXNl
KCZ2Z2Rldi0+bW1hbi5iZGV2KTsKLQlEUk1fSU5GTygidmlydGlvX2dwdTogdHRtIGZpbmFsaXpl
ZFxuIik7Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEu
YyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCmluZGV4IDAzYjdlMDg0NWQ5
OC4uZmM5MDhkNWNiMjE3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRn
cHVfdnEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYwpAQCAtOTc5
LDE3ICs5NzksMjEgQEAgaW50IHZpcnRpb19ncHVfb2JqZWN0X2F0dGFjaChzdHJ1Y3QgdmlydGlv
X2dwdV9kZXZpY2UgKnZnZGV2LAogCWJvb2wgdXNlX2RtYV9hcGkgPSAhdmlydGlvX2hhc19pb21t
dV9xdWlyayh2Z2Rldi0+dmRldik7CiAJc3RydWN0IHZpcnRpb19ncHVfbWVtX2VudHJ5ICplbnRz
OwogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Ci0JaW50IHNpLCBuZW50czsKKwlpbnQgc2ksIG5l
bnRzLCByZXQ7CiAKIAlpZiAoV0FSTl9PTl9PTkNFKCFvYmotPmNyZWF0ZWQpKQogCQlyZXR1cm4g
LUVJTlZBTDsKKwlpZiAoV0FSTl9PTl9PTkNFKG9iai0+cGFnZXMpKQorCQlyZXR1cm4gLUVJTlZB
TDsKIAotCWlmICghb2JqLT5wYWdlcykgewotCQlpbnQgcmV0OworCXJldCA9IGRybV9nZW1fc2ht
ZW1fcGluKCZvYmotPmJhc2UuYmFzZSk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiAtRUlOVkFM
OwogCi0JCXJldCA9IHZpcnRpb19ncHVfb2JqZWN0X2dldF9zZ190YWJsZSh2Z2Rldiwgb2JqKTsK
LQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7CisJb2JqLT5wYWdlcyA9IGRybV9nZW1fc2htZW1f
Z2V0X3NnX3RhYmxlKCZvYmotPmJhc2UuYmFzZSk7CisJaWYgKG9iai0+cGFnZXMgPT0gTlVMTCkg
eworCQlkcm1fZ2VtX3NobWVtX3VucGluKCZvYmotPmJhc2UuYmFzZSk7CisJCXJldHVybiAtRUlO
VkFMOwogCX0KIAogCWlmICh1c2VfZG1hX2FwaSkgewpAQCAtMTAyOCw2ICsxMDMyLDkgQEAgdm9p
ZCB2aXJ0aW9fZ3B1X29iamVjdF9kZXRhY2goc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rl
diwKIHsKIAlib29sIHVzZV9kbWFfYXBpID0gIXZpcnRpb19oYXNfaW9tbXVfcXVpcmsodmdkZXYt
PnZkZXYpOwogCisJaWYgKFdBUk5fT05fT05DRSghb2JqLT5wYWdlcykpCisJCXJldHVybjsKKwog
CWlmICh1c2VfZG1hX2FwaSAmJiBvYmotPm1hcHBlZCkgewogCQlzdHJ1Y3QgdmlydGlvX2dwdV9m
ZW5jZSAqZmVuY2UgPSB2aXJ0aW9fZ3B1X2ZlbmNlX2FsbG9jKHZnZGV2KTsKIAkJLyogZGV0YWNo
IGJhY2tpbmcgYW5kIHdhaXQgZm9yIHRoZSBob3N0IHByb2Nlc3MgaXQgLi4uICovCkBAIC0xMDQz
LDYgKzEwNTAsMTEgQEAgdm9pZCB2aXJ0aW9fZ3B1X29iamVjdF9kZXRhY2goc3RydWN0IHZpcnRp
b19ncHVfZGV2aWNlICp2Z2RldiwKIAl9IGVsc2UgewogCQl2aXJ0aW9fZ3B1X2NtZF9yZXNvdXJj
ZV9pbnZhbF9iYWNraW5nKHZnZGV2LCBvYmotPmh3X3Jlc19oYW5kbGUsIE5VTEwpOwogCX0KKwor
CXNnX2ZyZWVfdGFibGUob2JqLT5wYWdlcyk7CisJb2JqLT5wYWdlcyA9IE5VTEw7CisKKwlkcm1f
Z2VtX3NobWVtX3VucGluKCZvYmotPmJhc2UuYmFzZSk7CiB9CiAKIHZvaWQgdmlydGlvX2dwdV9j
dXJzb3JfcGluZyhzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9L
Y29uZmlnCmluZGV4IGJhMzZlOTMzYmI0OS4uZWZmMzA0NzA1MmQ0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdmlydGlvL0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby9L
Y29uZmlnCkBAIC0zLDcgKzMsNyBAQCBjb25maWcgRFJNX1ZJUlRJT19HUFUKIAl0cmlzdGF0ZSAi
VmlydGlvIEdQVSBkcml2ZXIiCiAJZGVwZW5kcyBvbiBEUk0gJiYgVklSVElPICYmIE1NVQogCXNl
bGVjdCBEUk1fS01TX0hFTFBFUgotCXNlbGVjdCBEUk1fVFRNCisJc2VsZWN0IERSTV9HRU1fU0hN
RU1fSEVMUEVSCiAJaGVscAogCSAgIFRoaXMgaXMgdGhlIHZpcnR1YWwgR1BVIGRyaXZlciBmb3Ig
dmlydGlvLiAgSXQgY2FuIGJlIHVzZWQgd2l0aAogCSAgIFFFTVUgYmFzZWQgVk1NcyAobGlrZSBL
Vk0gb3IgWGVuKS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vTWFrZWZpbGUg
Yi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL01ha2VmaWxlCmluZGV4IDQ1OGU2MDZhOTM2Zi4uOTJh
YTJiM2QzNDlkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL01ha2VmaWxlCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vTWFrZWZpbGUKQEAgLTQsNyArNCw3IEBACiAjIERp
cmVjdCBSZW5kZXJpbmcgSW5mcmFzdHJ1Y3R1cmUgKERSSSkgaW4gWEZyZWU4NiA0LjEuMCBhbmQg
aGlnaGVyLgogCiB2aXJ0aW8tZ3B1LXkgOj0gdmlydGdwdV9kcnYubyB2aXJ0Z3B1X2ttcy5vIHZp
cnRncHVfZ2VtLm8gXAotCXZpcnRncHVfZGlzcGxheS5vIHZpcnRncHVfdnEubyB2aXJ0Z3B1X3R0
bS5vIFwKKwl2aXJ0Z3B1X2Rpc3BsYXkubyB2aXJ0Z3B1X3ZxLm8gXAogCXZpcnRncHVfZmVuY2Uu
byB2aXJ0Z3B1X29iamVjdC5vIHZpcnRncHVfZGVidWdmcy5vIHZpcnRncHVfcGxhbmUubyBcCiAJ
dmlydGdwdV9pb2N0bC5vIHZpcnRncHVfcHJpbWUubyB2aXJ0Z3B1X3RyYWNlX3BvaW50cy5vCiAK
LS0gCjIuMTguMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
