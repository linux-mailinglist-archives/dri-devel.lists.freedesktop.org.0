Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7CEC86E180
	for <lists+dri-devel@lfdr.de>; Fri, 19 Jul 2019 09:16:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D1CDF6E595;
	Fri, 19 Jul 2019 07:16:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 45F4C6E3F7
 for <dri-devel@lists.freedesktop.org>; Thu, 18 Jul 2019 15:03:46 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id F15B01516;
 Thu, 18 Jul 2019 08:03:45 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 286533F71F;
 Thu, 18 Jul 2019 08:03:45 -0700 (PDT)
Subject: Re: [PATCH 4/5] drm/panfrost: Add support for GPU heap allocations
To: Rob Herring <robh@kernel.org>, dri-devel@lists.freedesktop.org
References: <20190717183352.22519-1-robh@kernel.org>
 <20190717183352.22519-4-robh@kernel.org>
From: Steven Price <steven.price@arm.com>
Message-ID: <0605b17e-4a6b-df9d-6684-38952ce5a09d@arm.com>
Date: Thu, 18 Jul 2019 16:03:44 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190717183352.22519-4-robh@kernel.org>
Content-Language: en-GB
X-Mailman-Approved-At: Fri, 19 Jul 2019 07:16:02 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Boris Brezillon <boris.brezillon@collabora.com>,
 Robin Murphy <robin.murphy@arm.com>, Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 Alyssa Rosenzweig <alyssa@rosenzweig.io>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMTcvMDcvMjAxOSAxOTozMywgUm9iIEhlcnJpbmcgd3JvdGU6Cj4gVGhlIG1pZGdhcmQvYmlm
cm9zdCBHUFVzIG5lZWQgdG8gYWxsb2NhdGUgR1BVIGhlYXAgbWVtb3J5IHdoaWNoIGlzCj4gYWxs
b2NhdGVkIG9uIEdQVSBwYWdlIGZhdWx0cyBhbmQgbm90IHBpbm5lZCBpbiBtZW1vcnkuIFRoZSB2
ZW5kb3IgZHJpdmVyCj4gY2FsbHMgdGhpcyBmdW5jdGlvbmFsaXR5IEdST1dfT05fR1BGLgo+IAo+
IFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGF0IEJPcyBhbGxvY2F0ZWQgd2l0aCB0aGUK
PiBQQU5GUk9TVF9CT19OT0VYRUMgZmxhZyBhcmUgbmV2ZXIgbW1hcHBlZCBvciBleHBvcnRlZC4g
Qm90aCBvZiB0aG9zZSBtYXkKPiBhY3R1YWxseSB3b3JrLCBidXQgSSdtIHVuc3VyZSBpZiB0aGVy
ZSdzIHNvbWUgaW50ZXJhY3Rpb24gdGhlcmUuIEl0Cj4gd291bGQgY2F1c2UgdGhlIHdob2xlIG9i
amVjdCB0byBiZSBwaW5uZWQgaW4gbWVtb3J5IHdoaWNoIHdvdWxkIGRlZmVhdAo+IHRoZSBwb2lu
dCBvZiB0aGlzLgo+IAo+IE9uIGZhdWx0cywgd2UgbWFwIGluIDJNQiBhdCBhIHRpbWUgaW4gb3Jk
ZXIgdG8gdXRpbGl6ZSBodWdlIHBhZ2VzIChpZgo+IGVuYWJsZWQpLiBDdXJyZW50bHksIG9uY2Ug
d2UndmUgbWFwcGVkIHBhZ2VzIGluLCB0aGV5IGFyZSBvbmx5IHVubWFwcGVkCj4gaWYgdGhlIEJP
IGlzIGZyZWVkLiBPbmNlIHdlIGFkZCBzaHJpbmtlciBzdXBwb3J0LCB3ZSBjYW4gdW5tYXAgcGFn
ZXMKPiB3aXRoIHRoZSBzaHJpbmtlci4KPiAKPiBDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpv
c29AY29sbGFib3JhLmNvbT4KPiBDYzogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25A
Y29sbGFib3JhLmNvbT4KPiBDYzogUm9iaW4gTXVycGh5IDxyb2Jpbi5tdXJwaHlAYXJtLmNvbT4K
PiBDYzogU3RldmVuIFByaWNlIDxzdGV2ZW4ucHJpY2VAYXJtLmNvbT4KPiBDYzogQWx5c3NhIFJv
c2VuendlaWcgPGFseXNzYUByb3Nlbnp3ZWlnLmlvPgo+IFNpZ25lZC1vZmYtYnk6IFJvYiBIZXJy
aW5nIDxyb2JoQGtlcm5lbC5vcmc+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9U
T0RPICAgICAgICAgICB8ICAgMiAtCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9z
dF9kcnYuYyB8ICAgMiArLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2Vt
LmMgfCAgMTQgKystCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaCB8
ICAgOCArKwo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMgfCAxMTQg
KysrKysrKysrKysrKysrKysrKysrLS0tCj4gIGluY2x1ZGUvdWFwaS9kcm0vcGFuZnJvc3RfZHJt
LmggICAgICAgICB8ICAgMSArCj4gIDYgZmlsZXMgY2hhbmdlZCwgMTI1IGluc2VydGlvbnMoKyks
IDE2IGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvVE9ETyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9UT0RPCj4gaW5kZXggYzJlNDRhZGQz
N2Q4Li42NDEyOWJmNzM5MzMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L1RPRE8KPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvVE9ETwo+IEBAIC0xNCw4ICsx
NCw2IEBACj4gICAgVGhlIGhhcmQgcGFydCBpcyBoYW5kbGluZyB3aGVuIG1vcmUgYWRkcmVzcyBz
cGFjZXMgYXJlIG5lZWRlZCB0aGFuIHdoYXQKPiAgICB0aGUgaC93IHByb3ZpZGVzLgo+ICAKPiAt
LSBTdXBwb3J0IHBpbm5pbmcgcGFnZXMgb24gZGVtYW5kIChHUFUgcGFnZSBmYXVsdHMpLgo+IC0K
PiAgLSBTdXBwb3J0IHVzZXJzcGFjZSBjb250cm9sbGVkIEdQVSB2aXJ0dWFsIGFkZHJlc3Nlcy4g
TmVlZGVkIGZvciBWdWxrYW4uIChUb21ldSkKPiAgCj4gIC0gU3VwcG9ydCBmb3IgbWFkdmlzZSBh
bmQgYSBzaHJpbmtlci4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4g
aW5kZXggYjkxZTk5MWJjNmEzLi45ZTg3ZDAwNjAyMDIgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3Bh
bmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4gQEAgLTUwLDcgKzUwLDcgQEAgc3RhdGljIGludCBwYW5m
cm9zdF9pb2N0bF9jcmVhdGVfYm8oc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
PiAgCXN0cnVjdCBkcm1fcGFuZnJvc3RfY3JlYXRlX2JvICphcmdzID0gZGF0YTsKPiAgCj4gIAlp
ZiAoIWFyZ3MtPnNpemUgfHwgYXJncy0+cGFkIHx8Cj4gLQkgICAgKGFyZ3MtPmZsYWdzICYgflBB
TkZST1NUX0JPX05PRVhFQykpCj4gKwkgICAgKGFyZ3MtPmZsYWdzICYgfihQQU5GUk9TVF9CT19O
T0VYRUMgfCBQQU5GUk9TVF9CT19IRUFQKSkpCj4gIAkJcmV0dXJuIC1FSU5WQUw7Cj4gIAo+ICAJ
Ym8gPSBwYW5mcm9zdF9nZW1fY3JlYXRlX3dpdGhfaGFuZGxlKGZpbGUsIGRldiwgYXJncy0+c2l6
ZSwgYXJncy0+ZmxhZ3MsCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9w
YW5mcm9zdF9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+
IGluZGV4IDM3ZmZlYzgzOTFkYS4uNTI4Mzk2MDAwMDM4IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9w
YW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+IEBAIC04Nyw3ICs4NywxMCBAQCBzdGF0aWMgaW50IHBh
bmZyb3N0X2dlbV9tYXAoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIHN0cnVjdCBwYW5m
cm9zdF9nZW1fbwo+ICAJaWYgKHJldCkKPiAgCQlyZXR1cm4gcmV0Owo+ICAKPiAtCXJldHVybiBw
YW5mcm9zdF9tbXVfbWFwKGJvKTsKPiArCWlmICghYm8tPmlzX2hlYXApCj4gKwkJcmV0ID0gcGFu
ZnJvc3RfbW11X21hcChibyk7Cj4gKwo+ICsJcmV0dXJuIHJldDsKPiAgfQo+ICAKPiAgc3RydWN0
IHBhbmZyb3N0X2dlbV9vYmplY3QgKgo+IEBAIC0xMDEsNyArMTA0LDExIEBAIHBhbmZyb3N0X2dl
bV9jcmVhdGVfd2l0aF9oYW5kbGUoc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYsCj4gIAlzdHJ1
Y3QgZHJtX2dlbV9zaG1lbV9vYmplY3QgKnNobWVtOwo+ICAJc3RydWN0IHBhbmZyb3N0X2dlbV9v
YmplY3QgKmJvOwo+ICAKPiAtCXNpemUgPSByb3VuZHVwKHNpemUsIFBBR0VfU0laRSk7Cj4gKwkv
KiBSb3VuZCB1cCBoZWFwIGFsbG9jYXRpb25zIHRvIDJNQiB0byBrZWVwIGZhdWx0IGhhbmRsaW5n
IHNpbXBsZSAqLwo+ICsJaWYgKGZsYWdzICYgUEFORlJPU1RfQk9fSEVBUCkKPiArCQlzaXplID0g
cm91bmR1cChzaXplLCBTWl8yTSk7Cj4gKwllbHNlCj4gKwkJc2l6ZSA9IHJvdW5kdXAoc2l6ZSwg
UEFHRV9TSVpFKTsKPiAgCj4gIAlzaG1lbSA9IGRybV9nZW1fc2htZW1fY3JlYXRlX3dpdGhfaGFu
ZGxlKGZpbGVfcHJpdiwgZGV2LCBzaXplLCBoYW5kbGUpOwo+ICAJaWYgKElTX0VSUihzaG1lbSkp
Cj4gQEAgLTEwOSw2ICsxMTYsOSBAQCBwYW5mcm9zdF9nZW1fY3JlYXRlX3dpdGhfaGFuZGxlKHN0
cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAo+ICAKPiAgCWJvID0gdG9fcGFuZnJvc3RfYm8oJnNo
bWVtLT5iYXNlKTsKPiAgCWJvLT5ub2V4ZWMgPSAhIShmbGFncyAmIFBBTkZST1NUX0JPX05PRVhF
Qyk7Cj4gKwliby0+aXNfaGVhcCA9ICEhKGZsYWdzICYgUEFORlJPU1RfQk9fSEVBUCk7Cj4gKwlp
ZiAoYm8tPmlzX2hlYXApCj4gKwkJYm8tPm5vZXhlYyA9IHRydWU7CgpXaGlsZSBJIGFncmVlIGFu
IGV4ZWN1dGFibGUgaGVhcCBpcyBwcmV0dHkgd2VpcmQsIEknZCBwcmVmZXIgbWFraW5nIHRoaXMK
ZXhwbGljaXQgLSBpLmUuIGZhaWxpbmcgdGhlIGFsbG9jYXRpb24gaWYgdGhlIGZsYWdzIGRvbid0
IG1ha2Ugc2Vuc2UuCgo+ICAKPiAgCXJldCA9IHBhbmZyb3N0X2dlbV9tYXAocGZkZXYsIGJvKTsK
PiAgCWlmIChyZXQpCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9nZW0uaCBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaAo+IGlu
ZGV4IDEzMmYwMjM5OWI3Yi4uYzUwMGNhNmI5MDcyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9nZW0uaAo+IEBAIC0xMyw2ICsxMyw3IEBAIHN0cnVjdCBwYW5mcm9zdF9n
ZW1fb2JqZWN0IHsKPiAgCXN0cnVjdCBkcm1fbW1fbm9kZSBub2RlOwo+ICAJYm9vbCBpc19tYXBw
ZWQJCToxOwo+ICAJYm9vbCBub2V4ZWMJCToxOwo+ICsJYm9vbCBpc19oZWFwCQk6MTsKPiAgfTsK
PiAgCj4gIHN0YXRpYyBpbmxpbmUKPiBAQCAtMjEsNiArMjIsMTMgQEAgc3RydWN0ICBwYW5mcm9z
dF9nZW1fb2JqZWN0ICp0b19wYW5mcm9zdF9ibyhzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikK
PiAgCXJldHVybiBjb250YWluZXJfb2YodG9fZHJtX2dlbV9zaG1lbV9vYmoob2JqKSwgc3RydWN0
IHBhbmZyb3N0X2dlbV9vYmplY3QsIGJhc2UpOwo+ICB9Cj4gIAo+ICtzdGF0aWMgaW5saW5lCj4g
K3N0cnVjdCAgcGFuZnJvc3RfZ2VtX29iamVjdCAqZHJtX21tX25vZGVfdG9fcGFuZnJvc3RfYm8o
c3RydWN0IGRybV9tbV9ub2RlICpub2RlKQo+ICt7Cj4gKwlyZXR1cm4gY29udGFpbmVyX29mKG5v
ZGUsIHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0LCBub2RlKTsKPiArfQo+ICsKPiArCgpOSVQ6
IEV4dHJhIGJsYW5rIGxpbmUKCj4gIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqcGFuZnJvc3RfZ2Vt
X2NyZWF0ZV9vYmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc2l6ZV90IHNpemUpOwo+ICAK
PiAgc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3RfbW11LmMKPiBpbmRleCBkMTg0ODRhMDdiZmEuLjNiOTVjNzAyNzE4OCAxMDA2NDQK
PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiArKysgYi9k
cml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiBAQCAtMyw2ICszLDcgQEAK
PiAgLyogQ29weXJpZ2h0IChDKSAyMDE5IEFybSBMdGQuICovCj4gICNpbmNsdWRlIDxsaW51eC9i
aXRmaWVsZC5oPgo+ICAjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KPiArI2luY2x1ZGUgPGxpbnV4
L2RtYS1tYXBwaW5nLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KPiAgI2luY2x1
ZGUgPGxpbnV4L2lvLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9pb3BvbGwuaD4KPiBAQCAtMTAsNiAr
MTEsNyBAQAo+ICAjaW5jbHVkZSA8bGludXgvaW9tbXUuaD4KPiAgI2luY2x1ZGUgPGxpbnV4L3Bs
YXRmb3JtX2RldmljZS5oPgo+ICAjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgo+ICsjaW5j
bHVkZSA8bGludXgvc2htZW1fZnMuaD4KPiAgI2luY2x1ZGUgPGxpbnV4L3NpemVzLmg+Cj4gIAo+
ICAjaW5jbHVkZSAicGFuZnJvc3RfZGV2aWNlLmgiCj4gQEAgLTI1NywxMiArMjU5LDEyIEBAIHZv
aWQgcGFuZnJvc3RfbW11X3VubWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibykKPiAg
CQlzaXplX3QgdW5tYXBwZWRfcGFnZTsKPiAgCQlzaXplX3QgcGdzaXplID0gZ2V0X3Bnc2l6ZShp
b3ZhLCBsZW4gLSB1bm1hcHBlZF9sZW4pOwo+ICAKPiAtCQl1bm1hcHBlZF9wYWdlID0gb3BzLT51
bm1hcChvcHMsIGlvdmEsIHBnc2l6ZSk7Cj4gLQkJaWYgKCF1bm1hcHBlZF9wYWdlKQo+IC0JCQli
cmVhazsKPiAtCj4gLQkJaW92YSArPSB1bm1hcHBlZF9wYWdlOwo+IC0JCXVubWFwcGVkX2xlbiAr
PSB1bm1hcHBlZF9wYWdlOwo+ICsJCWlmIChvcHMtPmlvdmFfdG9fcGh5cyhvcHMsIGlvdmEpKSB7
Cj4gKwkJCXVubWFwcGVkX3BhZ2UgPSBvcHMtPnVubWFwKG9wcywgaW92YSwgcGdzaXplKTsKPiAr
CQkJV0FSTl9PTih1bm1hcHBlZF9wYWdlICE9IHBnc2l6ZSk7Cj4gKwkJfQo+ICsJCWlvdmEgKz0g
cGdzaXplOwo+ICsJCXVubWFwcGVkX2xlbiArPSBwZ3NpemU7Cj4gIAl9Cj4gIAo+ICAJbW11X2h3
X2RvX29wZXJhdGlvbihwZmRldiwgMCwgYm8tPm5vZGUuc3RhcnQgPDwgUEFHRV9TSElGVCwKPiBA
QCAtMjk4LDYgKzMwMCw4NiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGlvbW11X2dhdGhlcl9vcHMg
bW11X3RsYl9vcHMgPSB7Cj4gIAkudGxiX3N5bmMJPSBtbXVfdGxiX3N5bmNfY29udGV4dCwKPiAg
fTsKPiAgCj4gK3N0YXRpYyBzdHJ1Y3QgZHJtX21tX25vZGUgKmFkZHJfdG9fZHJtX21tX25vZGUo
c3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiAr
CXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZTsKPiArCXU2NCBvZmZzZXQgPSBhZGRyID4+IFBBR0Vf
U0hJRlQ7Cj4gKwo+ICsJZHJtX21tX2Zvcl9lYWNoX25vZGUobm9kZSwgJnBmZGV2LT5tbSkgewo+
ICsJCWlmIChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYgb2Zmc2V0IDwgKG5vZGUtPnN0YXJ0ICsg
bm9kZS0+c2l6ZSkpCj4gKwkJCXJldHVybiBub2RlOwo+ICsJfQo+ICsJcmV0dXJuIE5VTEw7Cj4g
K30KPiArCj4gKyNkZWZpbmUgTlVNX0ZBVUxUX1BBR0VTIChTWl8yTSAvIFBBR0VfU0laRSkKPiAr
Cj4gK2ludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiArCWludCByZXQsIGk7Cj4gKwlzdHJ1
Y3QgZHJtX21tX25vZGUgKm5vZGU7Cj4gKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm87
Cj4gKwlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZzsKPiArCXBnb2ZmX3QgcGFnZV9vZmZz
ZXQ7Cj4gKwlzdHJ1Y3Qgc2dfdGFibGUgc2d0ID0ge307Cj4gKwlzdHJ1Y3QgcGFnZSAqKnBhZ2Vz
Owo+ICsKPiArCW5vZGUgPSBhZGRyX3RvX2RybV9tbV9ub2RlKHBmZGV2LCBhcywgYWRkcik7Cj4g
KwlpZiAoIW5vZGUpCj4gKwkJcmV0dXJuIC1FTk9FTlQ7Cj4gKwo+ICsJYm8gPSBkcm1fbW1fbm9k
ZV90b19wYW5mcm9zdF9ibyhub2RlKTsKPiArCWlmICghYm8tPmlzX2hlYXApIHsKPiArCQlkZXZf
V0FSTihwZmRldi0+ZGV2LCAibWF0Y2hpbmcgQk8gaXMgbm90IGhlYXAgdHlwZSAoR1BVIFZBID0g
JWxseCkiLAo+ICsJCQkgbm9kZS0+c3RhcnQgPDwgUEFHRV9TSElGVCk7Cj4gKwkJcmV0dXJuIC1F
SU5WQUw7Cj4gKwl9Cj4gKwkvKiBBc3N1bWUgMk1CIGFsaWdubWVudCBhbmQgc2l6ZSBtdWx0aXBs
ZSAqLwo+ICsJYWRkciAmPSB+KCh1NjQpU1pfMk0gLSAxKTsKPiArCXBhZ2Vfb2Zmc2V0ID0gYWRk
ciA+PiBQQUdFX1NISUZUOwo+ICsJcGFnZV9vZmZzZXQgLT0gbm9kZS0+c3RhcnQ7Cj4gKwo+ICsJ
cGFnZXMgPSBrdm1hbGxvY19hcnJheShOVU1fRkFVTFRfUEFHRVMsIHNpemVvZihzdHJ1Y3QgcGFn
ZSAqKSwgR0ZQX0tFUk5FTCk7Cj4gKwlpZiAoIXBhZ2VzKQo+ICsJCXJldHVybiAtRU5PTUVNOwo+
ICsKPiArCW1hcHBpbmcgPSBiby0+YmFzZS5iYXNlLmZpbHAtPmZfbWFwcGluZzsKPiArCW1hcHBp
bmdfc2V0X3VuZXZpY3RhYmxlKG1hcHBpbmcpOwo+ICsKPiArCWZvciAoaSA9IDA7IGkgPCBOVU1f
RkFVTFRfUEFHRVM7IGkrKykgewo+ICsJCXBhZ2VzW2ldID0gc2htZW1fcmVhZF9tYXBwaW5nX3Bh
Z2UobWFwcGluZywgcGFnZV9vZmZzZXQgKyBpKTsKPiArCQlpZiAoSVNfRVJSKHBhZ2VzW2ldKSkg
ewo+ICsJCQlyZXQgPSBQVFJfRVJSKHBhZ2VzW2ldKTsKPiArCQkJZ290byBlcnJfcGFnZXM7Cj4g
KwkJfQo+ICsJfQo+ICsKPiArCXJldCA9IHNnX2FsbG9jX3RhYmxlX2Zyb21fcGFnZXMoJnNndCwg
cGFnZXMsIE5VTV9GQVVMVF9QQUdFUywgMCwKPiArCQkJCQlTWl8yTSwgR0ZQX0tFUk5FTCk7Cj4g
KwlpZiAocmV0KQo+ICsJCWdvdG8gZXJyX3BhZ2VzOwo+ICsKPiArCWlmIChkbWFfbWFwX3NnKHBm
ZGV2LT5kZXYsIHNndC5zZ2wsIHNndC5uZW50cywgRE1BX0JJRElSRUNUSU9OQUwpID09IDApIHsK
PiArCQlyZXQgPSAtRUlOVkFMOwo+ICsJCWdvdG8gZXJyX21hcDsKPiArCX0KPiArCj4gKwltbXVf
bWFwX3NnKHBmZGV2LCBhZGRyLCBJT01NVV9XUklURSB8IElPTU1VX1JFQUQgfCBJT01NVV9OT0VY
RUMsICZzZ3QpOwo+ICsKPiArCW1tdV93cml0ZShwZmRldiwgTU1VX0lOVF9DTEVBUiwgQklUKGFz
KSk7Cj4gKwliby0+aXNfbWFwcGVkID0gdHJ1ZTsKPiArCj4gKwlkZXZfZGJnKHBmZGV2LT5kZXYs
ICJtYXBwZWQgcGFnZSBmYXVsdCBAICVsbHgiLCBhZGRyKTsKPiArCj4gKwlyZXR1cm4gMDsKCllv
dSBzdGlsbCBuZWVkIHRvIGZyZWUgc2d0IGFuZCBwYWdlcyAtIHNvIHRoaXMgc2hvdWxkIGJlOgoK
cmV0ID0gMDsKCnRvIGZhbGwgdGhyb3VnaCB0byB0aGUgY2xlYW4gdXAgYmVsb3c6Cgo+ICsKPiAr
ZXJyX21hcDoKPiArCXNnX2ZyZWVfdGFibGUoJnNndCk7Cj4gK2Vycl9wYWdlczoKPiArCWt2ZnJl
ZShwYWdlcyk7Cj4gKwlyZXR1cm4gcmV0Owo+ICt9Cj4gKwoKQnV0IGFjdHVhbGx5LCB5b3UgbmVl
ZCB0byBzdG9yZSB0aGUgcGFnZXMgYWxsb2NhdGVkIGluIHRoZSBidWZmZXIgb2JqZWN0CnNvIHRo
YXQgdGhleSBjYW4gYmUgZnJlZWQgbGF0ZXIuIEF0IHRoZSBtb21lbnQgeW91IGhhdmUgYSBiaWcg
bWVtb3J5IGxlYWsuCgo+ICBzdGF0aWMgY29uc3QgY2hhciAqYWNjZXNzX3R5cGVfbmFtZShzdHJ1
Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwKPiAgCQl1MzIgZmF1bHRfc3RhdHVzKQo+ICB7Cj4g
QEAgLTMyMywxMyArNDA1LDExIEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBwYW5mcm9zdF9tbXVfaXJx
X2hhbmRsZXIoaW50IGlycSwgdm9pZCAqZGF0YSkKPiAgewo+ICAJc3RydWN0IHBhbmZyb3N0X2Rl
dmljZSAqcGZkZXYgPSBkYXRhOwo+ICAJdTMyIHN0YXR1cyA9IG1tdV9yZWFkKHBmZGV2LCBNTVVf
SU5UX1NUQVQpOwo+IC0JaW50IGk7Cj4gKwlpbnQgaSwgcmV0Owo+ICAKPiAgCWlmICghc3RhdHVz
KQo+ICAJCXJldHVybiBJUlFfTk9ORTsKPiAgCj4gLQlkZXZfZXJyKHBmZGV2LT5kZXYsICJtbXUg
aXJxIHN0YXR1cz0leFxuIiwgc3RhdHVzKTsKPiAtCj4gIAlmb3IgKGkgPSAwOyBzdGF0dXM7IGkr
Kykgewo+ICAJCXUzMiBtYXNrID0gQklUKGkpIHwgQklUKGkgKyAxNik7Cj4gIAkJdTY0IGFkZHI7
Cj4gQEAgLTM1MCw2ICs0MzAsMTcgQEAgc3RhdGljIGlycXJldHVybl90IHBhbmZyb3N0X21tdV9p
cnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRhKQo+ICAJCWFjY2Vzc190eXBlID0gKGZhdWx0
X3N0YXR1cyA+PiA4KSAmIDB4MzsKPiAgCQlzb3VyY2VfaWQgPSAoZmF1bHRfc3RhdHVzID4+IDE2
KTsKPiAgCj4gKwkJLyogUGFnZSBmYXVsdCBvbmx5ICovCj4gKwkJaWYgKChzdGF0dXMgJiBtYXNr
KSA9PSBCSVQoaSkpIHsKPiArCQkJV0FSTl9PTihleGNlcHRpb25fdHlwZSA8IDB4QzEgfHwgZXhj
ZXB0aW9uX3R5cGUgPiAweEM0KTsKPiArCj4gKwkJCXJldCA9IHBhbmZyb3N0X21tdV9tYXBfZmF1
bHRfYWRkcihwZmRldiwgaSwgYWRkcik7Cj4gKwkJCWlmICghcmV0KSB7Cj4gKwkJCQlzdGF0dXMg
Jj0gfm1hc2s7Cj4gKwkJCQljb250aW51ZTsKCkluIHRoaXMgY2FzZSB0aGUgSVJRIGlzbid0IGhh
bmRsZWQgYW5kIHdpbGwgcmVtYWluIGFzc2VydGVkLCB3aGljaApwcm9iYWJseSBpc24ndCBnb2lu
ZyB0byBlbmQgcGFydGljdWxhcmx5IHdlbGwuCgpJZGVhbGx5IHlvdSB3b3VsZCBzd2l0Y2ggdGhl
IGFkZHJlc3Mgc3BhY2UgdG8gVU5NQVBQRUQgdG8ga2lsbCBvZmYgdGhlCmpvYiwgYnV0IGF0IHRo
ZSB2ZXJ5IGxlYXN0IHdlIHNob3VsZCBhY2tub3dsZWRnZSB0aGUgaW50ZXJydXB0IGFuZCBsZXQK
dGhlIEdQVSB0aW1lb3V0IHJlc2V0IHRoZSBHUFUgdG8gcmVjb3ZlciAod2hpY2ggaXMgZXF1aXZh
bGVudCB3aGlsZSB3ZQpzdGlsbCBvbmx5IHVzZSB0aGUgb25lIEFTIG9uIHRoZSBHUFUpLgoKU3Rl
dmUKCj4gKwkJCX0KPiArCQl9Cj4gKwo+ICAJCS8qIHRlcm1pbmFsIGZhdWx0LCBwcmludCBpbmZv
IGFib3V0IHRoZSBmYXVsdCAqLwo+ICAJCWRldl9lcnIocGZkZXYtPmRldiwKPiAgCQkJIlVuaGFu
ZGxlZCBQYWdlIGZhdWx0IGluIEFTJWQgYXQgVkEgMHglMDE2bGxYXG4iCj4gQEAgLTM5MSw4ICs0
ODIsOSBAQCBpbnQgcGFuZnJvc3RfbW11X2luaXQoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZk
ZXYpCj4gIAlpZiAoaXJxIDw9IDApCj4gIAkJcmV0dXJuIC1FTk9ERVY7Cj4gIAo+IC0JZXJyID0g
ZGV2bV9yZXF1ZXN0X2lycShwZmRldi0+ZGV2LCBpcnEsIHBhbmZyb3N0X21tdV9pcnFfaGFuZGxl
ciwKPiAtCQkJICAgICAgIElSUUZfU0hBUkVELCAibW11IiwgcGZkZXYpOwo+ICsJZXJyID0gZGV2
bV9yZXF1ZXN0X3RocmVhZGVkX2lycShwZmRldi0+ZGV2LCBpcnEsIE5VTEwsCj4gKwkJCQkJcGFu
ZnJvc3RfbW11X2lycV9oYW5kbGVyLAo+ICsJCQkJCUlSUUZfT05FU0hPVCwgIm1tdSIsIHBmZGV2
KTsKPiAgCj4gIAlpZiAoZXJyKSB7Cj4gIAkJZGV2X2VycihwZmRldi0+ZGV2LCAiZmFpbGVkIHRv
IHJlcXVlc3QgbW11IGlycSIpOwo+IGRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL3BhbmZy
b3N0X2RybS5oIGIvaW5jbHVkZS91YXBpL2RybS9wYW5mcm9zdF9kcm0uaAo+IGluZGV4IDE3ZmI1
ZDIwMGY3YS4uOTE1MGRkNzVhYWQ4IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vcGFu
ZnJvc3RfZHJtLmgKPiArKysgYi9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCj4gQEAg
LTgzLDYgKzgzLDcgQEAgc3RydWN0IGRybV9wYW5mcm9zdF93YWl0X2JvIHsKPiAgfTsKPiAgCj4g
ICNkZWZpbmUgUEFORlJPU1RfQk9fTk9FWEVDCTEKPiArI2RlZmluZSBQQU5GUk9TVF9CT19IRUFQ
CTIKPiAgCj4gIC8qKgo+ICAgKiBzdHJ1Y3QgZHJtX3BhbmZyb3N0X2NyZWF0ZV9ibyAtIGlvY3Rs
IGFyZ3VtZW50IGZvciBjcmVhdGluZyBQYW5mcm9zdCBCT3MuCj4gCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
