Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5AF809A551
	for <lists+dri-devel@lfdr.de>; Fri, 23 Aug 2019 04:12:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DB5906EBA9;
	Fri, 23 Aug 2019 02:12:38 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ot1-f66.google.com (mail-ot1-f66.google.com
 [209.85.210.66])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A02A76EBA3
 for <dri-devel@lists.freedesktop.org>; Fri, 23 Aug 2019 02:12:24 +0000 (UTC)
Received: by mail-ot1-f66.google.com with SMTP id b1so7390873otp.6
 for <dri-devel@lists.freedesktop.org>; Thu, 22 Aug 2019 19:12:24 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=LH1bRwy5I9A+NDROM4NYf/ieDn59EUywDqCfaAShmXM=;
 b=dbTajU5D2Fjsr/WUIIuiRvwyJeTmOfD9XCz3lJTpQbR9x1FWRuJyVNF07GIlriPqfu
 R7NwVpkAv2vu2Td+x6N1DZxsxwE6foT45uGR+nNgfx1lkLd22ByMUTobHksc2vEl3f6v
 wopihC6eL+ih+Hslk8pqoIVTIoSNdKb1USYm7IgLA1lbGehI6d4Ky5UCMvvGVVvtgvM/
 H0DsERutzQXWv5KhkSm1agdWSPHvqROyKdcZyIU9pxwjBoul2qyW6if79vHnIR7eh7DB
 9QrPNDq9KN8aEzyv9RSWgUBMdcKU6PZVFY1WHY02lYWPe9Hyf3osz35juqXFDqK/9fLL
 6UFw==
X-Gm-Message-State: APjAAAV9/OWvGQOVZudYjDBKUA83Quy6Jmyc3ys1oxFECTpp0PQG47/V
 BcsmHwsahRAQnmfggjafEF/haUA=
X-Google-Smtp-Source: APXvYqxELgh/M3X6yTq5+C7YIi0J515Bmox9vfdj1TAvgVzMxn7+7hKqRfz4oQNb+3VGZDH0SBKnUw==
X-Received: by 2002:a9d:645a:: with SMTP id m26mr2091155otl.211.1566526343528; 
 Thu, 22 Aug 2019 19:12:23 -0700 (PDT)
Received: from xps15.herring.priv (24-155-109-49.dyn.grandenetworks.net.
 [24.155.109.49])
 by smtp.googlemail.com with ESMTPSA id c1sm457747oic.31.2019.08.22.19.12.22
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 22 Aug 2019 19:12:22 -0700 (PDT)
From: Rob Herring <robh@kernel.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 4/8] drm/shmem: Do dma_unmap_sg before purging pages
Date: Thu, 22 Aug 2019 21:12:12 -0500
Message-Id: <20190823021216.5862-5-robh@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190823021216.5862-1-robh@kernel.org>
References: <20190823021216.5862-1-robh@kernel.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Tomeu Vizoso <tomeu.vizoso@collabora.com>, David Airlie <airlied@linux.ie>,
 Sean Paul <sean@poorly.run>, Steven Price <steven.price@arm.com>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Robin Murphy <robin.murphy@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q2FsbGluZyBkbWFfdW5tYXBfc2coKSBpbiBkcm1fZ2VtX3NobWVtX2ZyZWVfb2JqZWN0KCkgaXMg
dG9vIGxhdGUgaWYgdGhlCmJhY2tpbmcgcGFnZXMgaGF2ZSBhbHJlYWR5IGJlZW4gcmVsZWFzZWQg
YnkgdGhlIHNocmlua2VyLiBUaGUgcmVzdWx0IGlzCnRoZSBmb2xsb3dpbmcgYWJvcnQ6CgpVbmFi
bGUgdG8gaGFuZGxlIGtlcm5lbCBwYWdpbmcgcmVxdWVzdCBhdCB2aXJ0dWFsIGFkZHJlc3MgZmZm
ZjgwMDAwOThlZDAwMApNZW0gYWJvcnQgaW5mbzoKICBFU1IgPSAweDk2MDAwMTQ3CiAgRXhjZXB0
aW9uIGNsYXNzID0gREFCVCAoY3VycmVudCBFTCksIElMID0gMzIgYml0cwogIFNFVCA9IDAsIEZu
ViA9IDAKICBFQSA9IDAsIFMxUFRXID0gMApEYXRhIGFib3J0IGluZm86CiAgSVNWID0gMCwgSVNT
ID0gMHgwMDAwMDE0NwogIENNID0gMSwgV25SID0gMQpzd2FwcGVyIHBndGFibGU6IDRrIHBhZ2Vz
LCA0OC1iaXQgVkFzLCBwZ2RwPTAwMDAwMDAwMDJmNTEwMDAKW2ZmZmY4MDAwMDk4ZWQwMDBdIHBn
ZD0wMDAwMDAwMDQwMWY4MDAzLCBwdWQ9MDAwMDAwMDA0MDFmNzAwMywgcG1kPTAwMDAwMDAwNDAx
YjEwMDMsIHB0ZT0wMGU4MDAwMDA5OGVkNzEyCkludGVybmFsIGVycm9yOiBPb3BzOiA5NjAwMDE0
NyBbIzFdIFNNUApNb2R1bGVzIGxpbmtlZCBpbjogcGFuZnJvc3QgZ3B1X3NjaGVkCkNQVTogNSBQ
SUQ6IDkwMiBDb21tOiBnbm9tZS1zaGVsbCBOb3QgdGFpbnRlZCA1LjMuMC1yYzErICM5NQpIYXJk
d2FyZSBuYW1lOiA5NmJvYXJkcyBSb2NrOTYwIChEVCkKcHN0YXRlOiA0MDAwMDAwNSAoblpjdiBk
YWlmIC1QQU4gLVVBTykKcGMgOiBfX2RtYV9pbnZfYXJlYSsweDQwLzB4NTgKbHIgOiBhcmNoX3N5
bmNfZG1hX2Zvcl9jcHUrMHgyOC8weDMwCnNwIDogZmZmZjAwMDAxMzIxYmEzMAp4Mjk6IGZmZmYw
MDAwMTMyMWJhMzAgeDI4OiBmZmZmMDAwMDEzMjFiZDA4CngyNzogMDAwMDAwMDAwMDAwMDAwMCB4
MjY6IDAwMDAwMDAwMDAwMDAwMDkKeDI1OiAwMDAwZmZmZmMxZjg2MTcwIHgyNDogMDAwMDAwMDAw
MDAwMDAwMAp4MjM6IDAwMDAwMDAwMDAwMDAwMDAgeDIyOiAwMDAwMDAwMDAwMDAwMDAwCngyMTog
MDAwMDAwMDAwMDAyMTAwMCB4MjA6IGZmZmY4MDAwM2JiMmQ4MTAKeDE5OiAwMDAwMDAwMDA5OGVk
MDAwIHgxODogMDAwMDAwMDAwMDAwMDAwMAp4MTc6IDAwMDAwMDAwMDAwMDAwMDAgeDE2OiBmZmZm
ODAwMDIzZmQ5NDgwCngxNTogMDAwMDAwMDAwMDAwMDAwMCB4MTQ6IDAwMDAwMDAwMDAwMDAwMDAK
eDEzOiAwMDAwMDAwMDAwMDAwMDAwIHgxMjogMDAwMDAwMDAwMDAwMDAwMAp4MTE6IDAwMDAwMDAw
ZmZmYjlmZmYgeDEwOiAwMDAwMDAwMDAwMDAwMDAwCng5IDogMDAwMDAwMDAwMDAwMDAwMCB4OCA6
IGZmZmY4MDAwMjNmZDljMTgKeDcgOiAwMDAwMDAwMDAwMDAwMDAwIHg2IDogMDAwMDAwMDBmZmZm
ZmZmZgp4NSA6IDAwMDAwMDAwMDAwMDAwMDAgeDQgOiAwMDAwMDAwMDAwMDIxMDAwClB1cmdpbmcg
NTY5MzQ0MCBieXRlcwp4MyA6IDAwMDAwMDAwMDAwMDAwM2YgeDIgOiAwMDAwMDAwMDAwMDAwMDQw
CngxIDogZmZmZjgwMDAwOTkwZTAwMCB4MCA6IGZmZmY4MDAwMDk4ZWQwMDAKQ2FsbCB0cmFjZToK
IF9fZG1hX2ludl9hcmVhKzB4NDAvMHg1OAogZG1hX2RpcmVjdF9zeW5jX3NpbmdsZV9mb3JfY3B1
KzB4N2MvMHg4MAogZG1hX2RpcmVjdF91bm1hcF9wYWdlKzB4ODAvMHg4OAogZG1hX2RpcmVjdF91
bm1hcF9zZysweDU0LzB4ODAKIGRybV9nZW1fc2htZW1fZnJlZV9vYmplY3QrMHhmYy8weDEwOAog
cGFuZnJvc3RfZ2VtX2ZyZWVfb2JqZWN0KzB4MTE4LzB4MTI4IFtwYW5mcm9zdF0KIGRybV9nZW1f
b2JqZWN0X2ZyZWUrMHgxOC8weDkwCiBkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQrMHg1OC8w
eDgwCiBkcm1fZ2VtX29iamVjdF9oYW5kbGVfcHV0X3VubG9ja2VkKzB4NjQvMHhiMAogZHJtX2dl
bV9vYmplY3RfcmVsZWFzZV9oYW5kbGUrMHg3MC8weDk4CiBkcm1fZ2VtX2hhbmRsZV9kZWxldGUr
MHg2NC8weGIwCiBkcm1fZ2VtX2Nsb3NlX2lvY3RsKzB4MjgvMHgzOAogZHJtX2lvY3RsX2tlcm5l
bCsweGI4LzB4MTEwCiBkcm1faW9jdGwrMHgyNDQvMHgzZjAKIGRvX3Zmc19pb2N0bCsweGJjLzB4
OTEwCiBrc3lzX2lvY3RsKzB4NzgvMHhhOAogX19hcm02NF9zeXNfaW9jdGwrMHgxYy8weDI4CiBl
bDBfc3ZjX2NvbW1vbi5jb25zdHByb3AuMCsweDg4LzB4MTUwCiBlbDBfc3ZjX2hhbmRsZXIrMHgy
OC8weDc4CiBlbDBfc3ZjKzB4OC8weGMKIENvZGU6IDhhMjMwMDAwIDU0MDAwMDYwIGQ1MGI3ZTIw
IDE0MDAwMDAyIChkNTA4NzYyMCkKCkZpeGVzOiAxN2FjYjlmMzVlZDcgKCJkcm0vc2htZW06IEFk
ZCBtYWR2aXNlIHN0YXRlIGFuZCBwdXJnZSBoZWxwZXJzIikKQ2M6IE1hYXJ0ZW4gTGFua2hvcnN0
IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+CkNjOiBNYXhpbWUgUmlwYXJkIDxt
YXhpbWUucmlwYXJkQGJvb3RsaW4uY29tPgpDYzogU2VhbiBQYXVsIDxzZWFuQHBvb3JseS5ydW4+
CkNjOiBEYXZpZCBBaXJsaWUgPGFpcmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWxAZmZ3bGwuY2g+ClJldmlld2VkLWJ5OiBTdGV2ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBh
cm0uY29tPgpTaWduZWQtb2ZmLWJ5OiBSb2IgSGVycmluZyA8cm9iaEBrZXJuZWwub3JnPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5jIHwgNiArKysrKysKIDEgZmls
ZSBjaGFuZ2VkLCA2IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2dlbV9zaG1lbV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3NobWVtX2hl
bHBlci5jCmluZGV4IGRmOGYyYzhhZGIyYi4uNTQyM2VjNTZiNTM1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2dlbV9zaG1lbV9oZWxwZXIuYwpAQCAtMzkwLDYgKzM5MCwxMiBAQCB2b2lkIGRybV9nZW1f
c2htZW1fcHVyZ2VfbG9ja2VkKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQogCiAJV0FSTl9P
TighZHJtX2dlbV9zaG1lbV9pc19wdXJnZWFibGUoc2htZW0pKTsKIAorCWRtYV91bm1hcF9zZyhv
YmotPmRldi0+ZGV2LCBzaG1lbS0+c2d0LT5zZ2wsCisJCSAgICAgc2htZW0tPnNndC0+bmVudHMs
IERNQV9CSURJUkVDVElPTkFMKTsKKwlzZ19mcmVlX3RhYmxlKHNobWVtLT5zZ3QpOworCWtmcmVl
KHNobWVtLT5zZ3QpOworCXNobWVtLT5zZ3QgPSBOVUxMOworCiAJZHJtX2dlbV9zaG1lbV9wdXRf
cGFnZXNfbG9ja2VkKHNobWVtKTsKIAogCXNobWVtLT5tYWR2ID0gLTE7Ci0tIAoyLjIwLjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
