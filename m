Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C4D9D36CD2
	for <lists+dri-devel@lfdr.de>; Thu,  6 Jun 2019 09:04:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 85775894FF;
	Thu,  6 Jun 2019 07:03:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [210.61.82.184])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CA65B898C0
 for <dri-devel@lists.freedesktop.org>; Wed,  5 Jun 2019 11:48:48 +0000 (UTC)
X-UUID: 8082b2029f8c4d95ae7e212162aa0e3c-20190605
X-UUID: 8082b2029f8c4d95ae7e212162aa0e3c-20190605
Received: from mtkcas08.mediatek.inc [(172.21.101.126)] by
 mailgw02.mediatek.com (envelope-from <yongqiang.niu@mediatek.com>)
 (mhqrelay.mediatek.com ESMTP with TLS)
 with ESMTP id 1600541998; Wed, 05 Jun 2019 19:43:42 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs01n1.mediatek.inc (172.21.101.68) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Wed, 5 Jun 2019 19:43:42 +0800
Received: from localhost.localdomain (10.17.3.153) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via Frontend
 Transport; Wed, 5 Jun 2019 19:43:41 +0800
From: <yongqiang.niu@mediatek.com>
To: CK Hu <ck.hu@mediatek.com>, Philipp Zabel <p.zabel@pengutronix.de>, Rob
 Herring <robh+dt@kernel.org>, Matthias Brugger <matthias.bgg@gmail.com>
Subject: [PATCH v3, 06/27] drm/mediatek: add mutex mod into ddp private data
Date: Wed, 5 Jun 2019 19:42:45 +0800
Message-ID: <1559734986-7379-7-git-send-email-yongqiang.niu@mediatek.com>
X-Mailer: git-send-email 1.8.1.1.dirty
In-Reply-To: <1559734986-7379-1-git-send-email-yongqiang.niu@mediatek.com>
References: <1559734986-7379-1-git-send-email-yongqiang.niu@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-Mailman-Approved-At: Thu, 06 Jun 2019 07:03:45 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, devicetree@vger.kernel.org,
 Yongqiang Niu <yongqiang.niu@mediatek.com>, David Airlie <airlied@linux.ie>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mediatek@lists.infradead.org, linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWW9uZ3FpYW5nIE5pdSA8eW9uZ3FpYW5nLm5pdUBtZWRpYXRlay5jb20+CgpleGNlcHQg
bXV0ZXggbW9kLCBtdXRleCBtb2QgcmVnLG11dGV4IHNvZiByZWcsCmFuZCBtdXRleCBzb2YgaWQg
d2lsbCBiZSBkZHAgcHJpdmF0ZSBkYXRhCgpTaWduZWQtb2ZmLWJ5OiBZb25ncWlhbmcgTml1IDx5
b25ncWlhbmcubml1QG1lZGlhdGVrLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsv
bXRrX2RybV9kZHAuYyB8IDUzICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCAzNiBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHAuYyBiL2RyaXZlcnMvZ3B1
L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcC5jCmluZGV4IDU3OWNlMjguLmFlOTRkNDQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcC5jCkBAIC00MSwxMiArNDEsMTIgQEAKICNk
ZWZpbmUgRElTUF9SRUdfQ09ORklHX0RTSV9TRUwJCQkweDA1MAogI2RlZmluZSBESVNQX1JFR19D
T05GSUdfRFBJX1NFTAkJCTB4MDY0CiAKLSNkZWZpbmUgRElTUF9SRUdfTVVURVhfRU4obikJKDB4
MjAgKyAweDIwICogKG4pKQotI2RlZmluZSBESVNQX1JFR19NVVRFWChuKQkoMHgyNCArIDB4MjAg
KiAobikpCi0jZGVmaW5lIERJU1BfUkVHX01VVEVYX1JTVChuKQkoMHgyOCArIDB4MjAgKiAobikp
Ci0jZGVmaW5lIERJU1BfUkVHX01VVEVYX01PRChuKQkoMHgyYyArIDB4MjAgKiAobikpCi0jZGVm
aW5lIERJU1BfUkVHX01VVEVYX1NPRihuKQkoMHgzMCArIDB4MjAgKiAobikpCi0jZGVmaW5lIERJ
U1BfUkVHX01VVEVYX01PRDIobikJKDB4MzQgKyAweDIwICogKG4pKQorI2RlZmluZSBESVNQX1JF
R19NVVRFWF9FTihuKQkJCSgweDIwICsgMHgyMCAqIChuKSkKKyNkZWZpbmUgRElTUF9SRUdfTVVU
RVgobikJCQkoMHgyNCArIDB4MjAgKiAobikpCisjZGVmaW5lIERJU1BfUkVHX01VVEVYX1JTVChu
KQkJCSgweDI4ICsgMHgyMCAqIChuKSkKKyNkZWZpbmUgRElTUF9SRUdfTVVURVhfTU9EKG4pCQkJ
KDB4MmMgKyAweDIwICogKG4pKQorI2RlZmluZSBESVNQX1JFR19NVVRFWF9TT0YobikJCQkoMHgz
MCArIDB4MjAgKiAobikpCisjZGVmaW5lIERJU1BfUkVHX01VVEVYX01PRDIobikJCQkoMHgzNCAr
IDB4MjAgKiAobikpCiAKICNkZWZpbmUgSU5UX01VVEVYCQkJCUJJVCgxKQogCkBAIC0xNDcsMTIg
KzE0NywxNiBAQCBzdHJ1Y3QgbXRrX2Rpc3BfbXV0ZXggewogCWJvb2wgY2xhaW1lZDsKIH07CiAK
K3N0cnVjdCBtdGtfZGRwX2RhdGEgeworCWNvbnN0IHVuc2lnbmVkIGludCAqbXV0ZXhfbW9kOwor
fTsKKwogc3RydWN0IG10a19kZHAgewogCXN0cnVjdCBkZXZpY2UJCQkqZGV2OwogCXN0cnVjdCBj
bGsJCQkqY2xrOwogCXZvaWQgX19pb21lbQkJCSpyZWdzOwogCXN0cnVjdCBtdGtfZGlzcF9tdXRl
eAkJbXV0ZXhbMTBdOwotCWNvbnN0IHVuc2lnbmVkIGludAkJKm11dGV4X21vZDsKKwljb25zdCBz
dHJ1Y3QgbXRrX2RkcF9kYXRhCSpkYXRhOwogfTsKIAogc3RhdGljIGNvbnN0IHVuc2lnbmVkIGlu
dCBtdDI3MDFfbXV0ZXhfbW9kW0REUF9DT01QT05FTlRfSURfTUFYXSA9IHsKQEAgLTIwMiw2ICsy
MDYsMTggQEAgc3RydWN0IG10a19kZHAgewogCVtERFBfQ09NUE9ORU5UX1dETUExXSA9IE1UODE3
M19NVVRFWF9NT0RfRElTUF9XRE1BMSwKIH07CiAKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgbXRrX2Rk
cF9kYXRhIG10MjcwMV9kZHBfZHJpdmVyX2RhdGEgPSB7CisJLm11dGV4X21vZCA9IG10MjcwMV9t
dXRleF9tb2QsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IG10a19kZHBfZGF0YSBtdDI3MTJf
ZGRwX2RyaXZlcl9kYXRhID0geworCS5tdXRleF9tb2QgPSBtdDI3MTJfbXV0ZXhfbW9kLAorfTsK
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBtdGtfZGRwX2RhdGEgbXQ4MTczX2RkcF9kcml2ZXJfZGF0
YSA9IHsKKwkubXV0ZXhfbW9kID0gbXQ4MTczX211dGV4X21vZCwKK307CisKIHN0YXRpYyB1bnNp
Z25lZCBpbnQgbXRrX2RkcF9tb3V0X2VuKGVudW0gbXRrX2RkcF9jb21wX2lkIGN1ciwKIAkJCQkg
ICAgZW51bSBtdGtfZGRwX2NvbXBfaWQgbmV4dCwKIAkJCQkgICAgdW5zaWduZWQgaW50ICphZGRy
KQpAQCAtNDY0LDE1ICs0ODAsMTUgQEAgdm9pZCBtdGtfZGlzcF9tdXRleF9hZGRfY29tcChzdHJ1
Y3QgbXRrX2Rpc3BfbXV0ZXggKm11dGV4LAogCQlyZWcgPSBNVVRFWF9TT0ZfRFBJMTsKIAkJYnJl
YWs7CiAJZGVmYXVsdDoKLQkJaWYgKGRkcC0+bXV0ZXhfbW9kW2lkXSA8IDMyKSB7CisJCWlmIChk
ZHAtPmRhdGEtPm11dGV4X21vZFtpZF0gPCAzMikgewogCQkJb2Zmc2V0ID0gRElTUF9SRUdfTVVU
RVhfTU9EKG11dGV4LT5pZCk7CiAJCQlyZWcgPSByZWFkbF9yZWxheGVkKGRkcC0+cmVncyArIG9m
ZnNldCk7Ci0JCQlyZWcgfD0gMSA8PCBkZHAtPm11dGV4X21vZFtpZF07CisJCQlyZWcgfD0gMSA8
PCBkZHAtPmRhdGEtPm11dGV4X21vZFtpZF07CiAJCQl3cml0ZWxfcmVsYXhlZChyZWcsIGRkcC0+
cmVncyArIG9mZnNldCk7CiAJCX0gZWxzZSB7CiAJCQlvZmZzZXQgPSBESVNQX1JFR19NVVRFWF9N
T0QyKG11dGV4LT5pZCk7CiAJCQlyZWcgPSByZWFkbF9yZWxheGVkKGRkcC0+cmVncyArIG9mZnNl
dCk7Ci0JCQlyZWcgfD0gMSA8PCAoZGRwLT5tdXRleF9tb2RbaWRdIC0gMzIpOworCQkJcmVnIHw9
IDEgPDwgKGRkcC0+ZGF0YS0+bXV0ZXhfbW9kW2lkXSAtIDMyKTsKIAkJCXdyaXRlbF9yZWxheGVk
KHJlZywgZGRwLT5yZWdzICsgb2Zmc2V0KTsKIAkJfQogCQlyZXR1cm47CkBAIC01MDIsMTUgKzUx
OCwxNSBAQCB2b2lkIG10a19kaXNwX211dGV4X3JlbW92ZV9jb21wKHN0cnVjdCBtdGtfZGlzcF9t
dXRleCAqbXV0ZXgsCiAJCQkgICAgICAgZGRwLT5yZWdzICsgRElTUF9SRUdfTVVURVhfU09GKG11
dGV4LT5pZCkpOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlpZiAoZGRwLT5tdXRleF9tb2RbaWRd
IDwgMzIpIHsKKwkJaWYgKGRkcC0+ZGF0YS0+bXV0ZXhfbW9kW2lkXSA8IDMyKSB7CiAJCQlvZmZz
ZXQgPSBESVNQX1JFR19NVVRFWF9NT0QobXV0ZXgtPmlkKTsKIAkJCXJlZyA9IHJlYWRsX3JlbGF4
ZWQoZGRwLT5yZWdzICsgb2Zmc2V0KTsKLQkJCXJlZyAmPSB+KDEgPDwgZGRwLT5tdXRleF9tb2Rb
aWRdKTsKKwkJCXJlZyAmPSB+KDEgPDwgZGRwLT5kYXRhLT5tdXRleF9tb2RbaWRdKTsKIAkJCXdy
aXRlbF9yZWxheGVkKHJlZywgZGRwLT5yZWdzICsgb2Zmc2V0KTsKIAkJfSBlbHNlIHsKIAkJCW9m
ZnNldCA9IERJU1BfUkVHX01VVEVYX01PRDIobXV0ZXgtPmlkKTsKIAkJCXJlZyA9IHJlYWRsX3Jl
bGF4ZWQoZGRwLT5yZWdzICsgb2Zmc2V0KTsKLQkJCXJlZyAmPSB+KDEgPDwgKGRkcC0+bXV0ZXhf
bW9kW2lkXSAtIDMyKSk7CisJCQlyZWcgJj0gfigxIDw8IChkZHAtPmRhdGEtPm11dGV4X21vZFtp
ZF0gLSAzMikpOwogCQkJd3JpdGVsX3JlbGF4ZWQocmVnLCBkZHAtPnJlZ3MgKyBvZmZzZXQpOwog
CQl9CiAJCWJyZWFrOwpAQCAtNTg1LDcgKzYwMSw3IEBAIHN0YXRpYyBpbnQgbXRrX2RkcF9wcm9i
ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCQlyZXR1cm4gUFRSX0VSUihkZHAtPnJl
Z3MpOwogCX0KIAotCWRkcC0+bXV0ZXhfbW9kID0gb2ZfZGV2aWNlX2dldF9tYXRjaF9kYXRhKGRl
dik7CisJZGRwLT5kYXRhID0gb2ZfZGV2aWNlX2dldF9tYXRjaF9kYXRhKGRldik7CiAKIAlwbGF0
Zm9ybV9zZXRfZHJ2ZGF0YShwZGV2LCBkZHApOwogCkBAIC01OTgsOSArNjE0LDEyIEBAIHN0YXRp
YyBpbnQgbXRrX2RkcF9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIH0KIAog
c3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgZGRwX2RyaXZlcl9kdF9tYXRjaFtdID0g
ewotCXsgLmNvbXBhdGlibGUgPSAibWVkaWF0ZWssbXQyNzAxLWRpc3AtbXV0ZXgiLCAuZGF0YSA9
IG10MjcwMV9tdXRleF9tb2R9LAotCXsgLmNvbXBhdGlibGUgPSAibWVkaWF0ZWssbXQyNzEyLWRp
c3AtbXV0ZXgiLCAuZGF0YSA9IG10MjcxMl9tdXRleF9tb2R9LAotCXsgLmNvbXBhdGlibGUgPSAi
bWVkaWF0ZWssbXQ4MTczLWRpc3AtbXV0ZXgiLCAuZGF0YSA9IG10ODE3M19tdXRleF9tb2R9LAor
CXsgLmNvbXBhdGlibGUgPSAibWVkaWF0ZWssbXQyNzAxLWRpc3AtbXV0ZXgiLAorCSAgLmRhdGEg
PSAmbXQyNzAxX2RkcF9kcml2ZXJfZGF0YX0sCisJeyAuY29tcGF0aWJsZSA9ICJtZWRpYXRlayxt
dDI3MTItZGlzcC1tdXRleCIsCisJICAuZGF0YSA9ICZtdDI3MTJfZGRwX2RyaXZlcl9kYXRhfSwK
Kwl7IC5jb21wYXRpYmxlID0gIm1lZGlhdGVrLG10ODE3My1kaXNwLW11dGV4IiwKKwkgIC5kYXRh
ID0gJm10ODE3M19kZHBfZHJpdmVyX2RhdGF9LAogCXt9LAogfTsKIE1PRFVMRV9ERVZJQ0VfVEFC
TEUob2YsIGRkcF9kcml2ZXJfZHRfbWF0Y2gpOwotLSAKMS44LjEuMS5kaXJ0eQoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcg
bGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
