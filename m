Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 091F628718E
	for <lists+dri-devel@lfdr.de>; Thu,  8 Oct 2020 11:32:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 305C96EA4D;
	Thu,  8 Oct 2020 09:31:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x62a.google.com (mail-ej1-x62a.google.com
 [IPv6:2a00:1450:4864:20::62a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9C5E46EA4D
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Oct 2020 09:31:57 +0000 (UTC)
Received: by mail-ej1-x62a.google.com with SMTP id a3so7072428ejy.11
 for <dri-devel@lists.freedesktop.org>; Thu, 08 Oct 2020 02:31:57 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=2MrF68p74yCTyaytOA1z5upFOM7QcdWhw5fIQLqFytc=;
 b=k6FHcm1E2S7rpUviQwnbp3Onf6afNbNiDpvVHKdy65er7Wstst1lC0hAVhaYKeoVSI
 1kfrLKzZgxKOWlv7enfsaA5FQirL4f28jZVb/HNhPomJ18sCznjpPDaRT2z6fjUEhKDY
 C3m4OhntKk1SEJoRCSnGIff9sPt1+0aVPN0DswbzmNf9PyohapMyOyspdvrlQULn0tel
 MtulAI/mXa3xAXogsbVggf0Tge6QpgEfaKOTQxQwgN3FrzJdJ70a3OVy5hDTmYKZRn5L
 PH1+AnWEwvgICF7P5DJdFbC1Og+p86eRxGq7qOqkIzuYx4mepQCUgRTbn9WZdMd7OGoJ
 Wl4Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=2MrF68p74yCTyaytOA1z5upFOM7QcdWhw5fIQLqFytc=;
 b=CYUFobmNkq56VYe2FpgXlOtmlehY/2f70oLqkOl7j26/yvx9HulOsTPAyAN+f3FNBm
 blssn7y7As9jwIX75msDuTzaV+rVXoCYOA3/qnVXK1OvzeOl2WroCAyzESrVdcprp2RE
 wtHNgUEcXo4JudZBJ3QUejWGVYzeL28g+CKN2Fzxu9n0dva8IXm+7fUSVZvmnFMEMuVW
 yZ12ofCxw6OhstR3bO8+Ev5KVykgMwnbVYIu/qdLNXcapp/yT2ViKaY0bhEEQIYSF0be
 wZi0EgcG8IGVSz2lP9RyUfJD9ImYtyg3GUCRrICqPYMFETLo41UvCB/4KJ+rY1O9ySgs
 lfCA==
X-Gm-Message-State: AOAM5319u0Se6TjMBL9g0Pi4JPkXvaLIeob9+lGrL4US78NBwoytwLoS
 aqui2i2VhWXu9aTpJbm/YXD1wQf/8pw=
X-Google-Smtp-Source: ABdhPJykn/IF8+5O/kJ9GF0+308qhsW2xf+NMmYniE17W6KBlXX1GTDVf+9E1X66GZwWLnaJ3RlrEQ==
X-Received: by 2002:a17:906:cede:: with SMTP id
 si30mr8062408ejb.236.1602149515586; 
 Thu, 08 Oct 2020 02:31:55 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:4c64:a9a0:5e0:905a])
 by smtp.gmail.com with ESMTPSA id e2sm3649911ejd.81.2020.10.08.02.31.54
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 08 Oct 2020 02:31:55 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org,
	daniel@ffwll.ch
Subject: [PATCH 1/4] drm/ttm: set the tt caching state at creation time
Date: Thu,  8 Oct 2020 11:31:51 +0200
Message-Id: <20201008093154.2991-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWxsIGRyaXZlcnMgY2FuIGRldGVybWluZSB0aGUgdHQgY2FjaGluZyBzdGF0ZSBhdCBjcmVhdGlv
biB0aW1lLApubyBuZWVkIHRvIGRvIHRoaXMgb24gdGhlIGZseSBkdXJpbmcgZXZlcnkgdmFsaWRh
dGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdA
YW1kLmNvbT4KUmV2aWV3ZWQtYnk6IE1pY2hhZWwgSi4gUnVobCA8bWljaGFlbC5qLnJ1aGxAaW50
ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYyAgICB8
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgICAgfCAxMSAr
KysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jICAgICAgfCAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9zZ2RtYS5jICAgIHwgMTMgKysrKysr
KystCiBkcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF90dG0uYyAgICAgICAgICAgICAgfCAgMiArLQog
ZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdHRtLmMgICAgICAgIHwgMTYgKysrKysrKyst
LQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYWdwX2JhY2tlbmQuYyAgICAgIHwgIDIgKy0KIGRy
aXZlcnMvZ3B1L2RybS90dG0vdHRtX3BhZ2VfYWxsb2MuYyAgICAgICB8IDI2ICsrKysrKysrLS0t
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9jX2RtYS5jICAgfCAyMCAr
KysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV90dC5jICAgICAgICAgICAgICAg
fCAzMyArKysrKysrKysrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4
X3R0bV9idWZmZXIuYyB8ICA2ICsrLS0KIGluY2x1ZGUvZHJtL3R0bS90dG1fY2FjaGluZy5oICAg
ICAgICAgICAgICB8IDM0ICsrKysrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvZHJtL3R0bS90
dG1fdHQuaCAgICAgICAgICAgICAgICAgICB8IDE2ICsrKystLS0tLS0KIDEzIGZpbGVzIGNoYW5n
ZWQsIDEyMyBpbnNlcnRpb25zKCspLCA2MCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBpbmNsdWRlL2RybS90dG0vdHRtX2NhY2hpbmcuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9nbWMuYwppbmRleCAyMTNlZjA5MGJiMGUuLjNjNWFkNjllZmYxOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dtYy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYwpAQCAtMTI0LDcgKzEyNCw3IEBAIHVpbnQ2
NF90IGFtZGdwdV9nbWNfYWdwX2FkZHIoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGFtZGdwdV90dG1fYWRldihiby0+YmRldik7CiAJ
c3RydWN0IHR0bV9kbWFfdHQgKnR0bTsKIAotCWlmIChiby0+bnVtX3BhZ2VzICE9IDEgfHwgYm8t
PnR0bS0+Y2FjaGluZ19zdGF0ZSA9PSB0dF9jYWNoZWQpCisJaWYgKGJvLT5udW1fcGFnZXMgIT0g
MSB8fCBiby0+dHRtLT5jYWNoaW5nID09IHR0bV9jYWNoZWQpCiAJCXJldHVybiBBTURHUFVfQk9f
SU5WQUxJRF9PRkZTRVQ7CiAKIAl0dG0gPSBjb250YWluZXJfb2YoYm8tPnR0bSwgc3RydWN0IHR0
bV9kbWFfdHQsIHR0bSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5k
ZXggMzk5OTYxMDM1YWU2Li43ZjQxYTQ3ZTczNTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfdHRtLmMKQEAgLTEyOTIsNyArMTI5Miw5IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV90
dG1fYmFja2VuZF9kZXN0cm95KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogc3RhdGljIHN0
cnVjdCB0dG1fdHQgKmFtZGdwdV90dG1fdHRfY3JlYXRlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8sCiAJCQkJCSAgIHVpbnQzMl90IHBhZ2VfZmxhZ3MpCiB7CisJc3RydWN0IGFtZGdwdV9i
byAqYWJvID0gdHRtX3RvX2FtZGdwdV9ibyhibyk7CiAJc3RydWN0IGFtZGdwdV90dG1fdHQgKmd0
dDsKKwllbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmc7CiAKIAlndHQgPSBremFsbG9jKHNpemVvZihz
dHJ1Y3QgYW1kZ3B1X3R0bV90dCksIEdGUF9LRVJORUwpOwogCWlmIChndHQgPT0gTlVMTCkgewpA
QCAtMTMwMCw4ICsxMzAyLDEzIEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0ICphbWRncHVfdHRtX3R0
X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCX0KIAlndHQtPmdvYmogPSAm
Ym8tPmJhc2U7CiAKKwlpZiAoYWJvLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRFX0NQVV9HVFRf
VVNXQykKKwkJY2FjaGluZyA9IHR0bV93cml0ZV9jb21iaW5lZDsKKwllbHNlCisJCWNhY2hpbmcg
PSB0dG1fY2FjaGVkOworCiAJLyogYWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB1bmluaXRpYWxpemVk
IHBhZ2UgZW50cmllcyAqLwotCWlmICh0dG1fc2dfdHRfaW5pdCgmZ3R0LT50dG0sIGJvLCBwYWdl
X2ZsYWdzKSkgeworCWlmICh0dG1fc2dfdHRfaW5pdCgmZ3R0LT50dG0sIGJvLCBwYWdlX2ZsYWdz
LCBjYWNoaW5nKSkgewogCQlrZnJlZShndHQpOwogCQlyZXR1cm4gTlVMTDsKIAl9CkBAIC0xNTI1
LDcgKzE1MzIsNyBAQCB1aW50NjRfdCBhbWRncHVfdHRtX3R0X3BkZV9mbGFncyhzdHJ1Y3QgdHRt
X3R0ICp0dG0sIHN0cnVjdCB0dG1fcmVzb3VyY2UgKm1lbSkKIAlpZiAobWVtICYmIG1lbS0+bWVt
X3R5cGUgPT0gVFRNX1BMX1RUKSB7CiAJCWZsYWdzIHw9IEFNREdQVV9QVEVfU1lTVEVNOwogCi0J
CWlmICh0dG0tPmNhY2hpbmdfc3RhdGUgPT0gdHRfY2FjaGVkKQorCQlpZiAodHRtLT5jYWNoaW5n
ID09IHR0bV9jYWNoZWQpCiAJCQlmbGFncyB8PSBBTURHUFVfUFRFX1NOT09QRUQ7CiAJfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwppbmRleCAzMjEzNDI5Zjg0NDQuLmFkNThk
MGFmNTE0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC05MTgsNyAr
OTE4LDcgQEAgc3RhdGljIHN0cnVjdCB0dG1fdHQgKmJvX2RyaXZlcl90dG1fdHRfY3JlYXRlKHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJaWYgKCF0dCkKIAkJcmV0dXJuIE5VTEw7CiAK
LQlyZXQgPSB0dG1fdHRfaW5pdCh0dCwgYm8sIHBhZ2VfZmxhZ3MpOworCXJldCA9IHR0bV90dF9p
bml0KHR0LCBibywgcGFnZV9mbGFncywgdHRtX2NhY2hlZCk7CiAJaWYgKHJldCA8IDApCiAJCWdv
dG8gZXJyX3R0bV90dF9pbml0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVh
dS9ub3V2ZWF1X3NnZG1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3NnZG1h
LmMKaW5kZXggODA2ZDllYzMxMGY1Li5jZDZmZGViYWU3OTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfc2dkbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X3NnZG1hLmMKQEAgLTUsNiArNSw3IEBACiAjaW5jbHVkZSAibm91dmVhdV9k
cnYuaCIKICNpbmNsdWRlICJub3V2ZWF1X21lbS5oIgogI2luY2x1ZGUgIm5vdXZlYXVfdHRtLmgi
CisjaW5jbHVkZSAibm91dmVhdV9iby5oIgogCiBzdHJ1Y3Qgbm91dmVhdV9zZ2RtYV9iZSB7CiAJ
LyogdGhpcyBoYXMgdG8gYmUgdGhlIGZpcnN0IGZpZWxkIHNvIHBvcHVsYXRlL3VucG9wdWxhdGVk
IGluCkBAIC02NywxMyArNjgsMjMgQEAgbm91dmVhdV9zZ2RtYV91bmJpbmQoc3RydWN0IHR0bV9i
b19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fdHQgKnR0bSkKIHN0cnVjdCB0dG1fdHQgKgogbm91
dmVhdV9zZ2RtYV9jcmVhdGVfdHRtKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIHVpbnQz
Ml90IHBhZ2VfZmxhZ3MpCiB7CisJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2Jk
ZXYoYm8tPmJkZXYpOworCXN0cnVjdCBub3V2ZWF1X2JvICpudmJvID0gbm91dmVhdV9ibyhibyk7
CiAJc3RydWN0IG5vdXZlYXVfc2dkbWFfYmUgKm52YmU7CisJZW51bSB0dG1fY2FjaGluZyBjYWNo
aW5nOworCisJaWYgKG52Ym8tPmZvcmNlX2NvaGVyZW50KQorCQljYWNoaW5nID0gdHRtX3VuY2Fj
aGVkOworCWVsc2UgaWYgKGRybS0+YWdwLmJyaWRnZSkKKwkJY2FjaGluZyA9IHR0bV93cml0ZV9j
b21iaW5lZDsKKwllbHNlCisJCWNhY2hpbmcgPSB0dG1fY2FjaGVkOwogCiAJbnZiZSA9IGt6YWxs
b2Moc2l6ZW9mKCpudmJlKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFudmJlKQogCQlyZXR1cm4gTlVM
TDsKIAotCWlmICh0dG1fZG1hX3R0X2luaXQoJm52YmUtPnR0bSwgYm8sIHBhZ2VfZmxhZ3MpKSB7
CisJaWYgKHR0bV9kbWFfdHRfaW5pdCgmbnZiZS0+dHRtLCBibywgcGFnZV9mbGFncywgY2FjaGlu
ZykpIHsKIAkJa2ZyZWUobnZiZSk7CiAJCXJldHVybiBOVUxMOwogCX0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfdHRt
LmMKaW5kZXggNjY5YmNlYjU4MjA1Li5mNTA4NjM0OTNmNjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9xeGwvcXhsX3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5j
CkBAIC0xMzMsNyArMTMzLDcgQEAgc3RhdGljIHN0cnVjdCB0dG1fdHQgKnF4bF90dG1fdHRfY3Jl
YXRlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJdHRtID0ga3phbGxvYyhzaXplb2Yo
c3RydWN0IHR0bV90dCksIEdGUF9LRVJORUwpOwogCWlmICh0dG0gPT0gTlVMTCkKIAkJcmV0dXJu
IE5VTEw7Ci0JaWYgKHR0bV90dF9pbml0KHR0bSwgYm8sIHBhZ2VfZmxhZ3MpKSB7CisJaWYgKHR0
bV90dF9pbml0KHR0bSwgYm8sIHBhZ2VfZmxhZ3MsIHR0bV9jYWNoZWQpKSB7CiAJCWtmcmVlKHR0
bSk7CiAJCXJldHVybiBOVUxMOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yYWRl
b24vcmFkZW9uX3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdHRtLmMKaW5k
ZXggNjNlMzhiMDVhNWJjLi4xMzBhN2NlYTM1YzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9yYWRlb24vcmFkZW9uX3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9u
X3R0bS5jCkBAIC01NDYsNyArNTQ2LDcgQEAgc3RhdGljIGludCByYWRlb25fdHRtX2JhY2tlbmRf
YmluZChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJV0FSTigxLCAibm90aGluZyB0byBi
aW5kICVsdSBwYWdlcyBmb3IgbXJlZyAlcCBiYWNrICVwIVxuIiwKIAkJICAgICB0dG0tPm51bV9w
YWdlcywgYm9fbWVtLCB0dG0pOwogCX0KLQlpZiAodHRtLT5jYWNoaW5nX3N0YXRlID09IHR0X2Nh
Y2hlZCkKKwlpZiAodHRtLT5jYWNoaW5nID09IHR0bV9jYWNoZWQpCiAJCWZsYWdzIHw9IFJBREVP
Tl9HQVJUX1BBR0VfU05PT1A7CiAJciA9IHJhZGVvbl9nYXJ0X2JpbmQocmRldiwgZ3R0LT5vZmZz
ZXQsIHR0bS0+bnVtX3BhZ2VzLAogCQkJICAgICB0dG0tPnBhZ2VzLCBndHQtPnR0bS5kbWFfYWRk
cmVzcywgZmxhZ3MpOwpAQCAtNTkwLDYgKzU5MCwxMCBAQCBzdGF0aWMgc3RydWN0IHR0bV90dCAq
cmFkZW9uX3R0bV90dF9jcmVhdGUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIHsKIAlz
dHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldjsKIAlzdHJ1Y3QgcmFkZW9uX3R0bV90dCAqZ3R0Owor
CWVudW0gdHRtX2NhY2hpbmcgY2FjaGluZzsKKwlzdHJ1Y3QgcmFkZW9uX2JvICpyYm87CisKKwly
Ym8gPSBjb250YWluZXJfb2YoYm8sIHN0cnVjdCByYWRlb25fYm8sIHRibyk7CiAKIAlyZGV2ID0g
cmFkZW9uX2dldF9yZGV2KGJvLT5iZGV2KTsKICNpZiBJU19FTkFCTEVEKENPTkZJR19BR1ApCkBA
IC02MDMsNyArNjA3LDE1IEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0ICpyYWRlb25fdHRtX3R0X2Ny
ZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCWlmIChndHQgPT0gTlVMTCkgewog
CQlyZXR1cm4gTlVMTDsKIAl9Ci0JaWYgKHR0bV9kbWFfdHRfaW5pdCgmZ3R0LT50dG0sIGJvLCBw
YWdlX2ZsYWdzKSkgeworCisJaWYgKHJiby0+ZmxhZ3MgJiBSQURFT05fR0VNX0dUVF9VQykKKwkJ
Y2FjaGluZyA9IHR0bV91bmNhY2hlZDsKKwllbHNlIGlmIChyYm8tPmZsYWdzICYgUkFERU9OX0dF
TV9HVFRfV0MpCisJCWNhY2hpbmcgPSB0dG1fd3JpdGVfY29tYmluZWQ7CisJZWxzZQorCQljYWNo
aW5nID0gdHRtX2NhY2hlZDsKKworCWlmICh0dG1fZG1hX3R0X2luaXQoJmd0dC0+dHRtLCBibywg
cGFnZV9mbGFncywgY2FjaGluZykpIHsKIAkJa2ZyZWUoZ3R0KTsKIAkJcmV0dXJuIE5VTEw7CiAJ
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYWdwX2JhY2tlbmQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS90dG0vdHRtX2FncF9iYWNrZW5kLmMKaW5kZXggYTk4ZmQ3OTViNzUyLi5h
NzIzMDYyZDM3ZTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2FncF9iYWNr
ZW5kLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYWdwX2JhY2tlbmQuYwpAQCAtMTM2
LDcgKzEzNiw3IEBAIHN0cnVjdCB0dG1fdHQgKnR0bV9hZ3BfdHRfY3JlYXRlKHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8sCiAJYWdwX2JlLT5tZW0gPSBOVUxMOwogCWFncF9iZS0+YnJpZGdl
ID0gYnJpZGdlOwogCi0JaWYgKHR0bV90dF9pbml0KCZhZ3BfYmUtPnR0bSwgYm8sIHBhZ2VfZmxh
Z3MpKSB7CisJaWYgKHR0bV90dF9pbml0KCZhZ3BfYmUtPnR0bSwgYm8sIHBhZ2VfZmxhZ3MsIHR0
bV93cml0ZV9jb21iaW5lZCkpIHsKIAkJa2ZyZWUoYWdwX2JlKTsKIAkJcmV0dXJuIE5VTEw7CiAJ
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jIGIvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jCmluZGV4IDExMTAzMWNiYjZkZi4uYzhm
Njc5MDk2MmI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9j
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jCkBAIC0yMjAsMTQg
KzIyMCwxNCBAQCBzdGF0aWMgc3RydWN0IHR0bV9wb29sX21hbmFnZXIgKl9tYW5hZ2VyOwogLyoq
CiAgKiBTZWxlY3QgdGhlIHJpZ2h0IHBvb2wgb3IgcmVxdWVzdGVkIGNhY2hpbmcgc3RhdGUgYW5k
IHR0bSBmbGFncy4gKi8KIHN0YXRpYyBzdHJ1Y3QgdHRtX3BhZ2VfcG9vbCAqdHRtX2dldF9wb29s
KGludCBmbGFncywgYm9vbCBodWdlLAotCQkJCQkgIGVudW0gdHRtX2NhY2hpbmdfc3RhdGUgY3N0
YXRlKQorCQkJCQkgIGVudW0gdHRtX2NhY2hpbmcgY3N0YXRlKQogewogCWludCBwb29sX2luZGV4
OwogCi0JaWYgKGNzdGF0ZSA9PSB0dF9jYWNoZWQpCisJaWYgKGNzdGF0ZSA9PSB0dG1fY2FjaGVk
KQogCQlyZXR1cm4gTlVMTDsKIAotCWlmIChjc3RhdGUgPT0gdHRfd2MpCisJaWYgKGNzdGF0ZSA9
PSB0dG1fd3JpdGVfY29tYmluZWQpCiAJCXBvb2xfaW5kZXggPSAweDA7CiAJZWxzZQogCQlwb29s
X2luZGV4ID0gMHgxOwpAQCAtNDQxLDE3ICs0NDEsMTcgQEAgc3RhdGljIHZvaWQgdHRtX3Bvb2xf
bW1fc2hyaW5rX2Zpbmkoc3RydWN0IHR0bV9wb29sX21hbmFnZXIgKm1hbmFnZXIpCiB9CiAKIHN0
YXRpYyBpbnQgdHRtX3NldF9wYWdlc19jYWNoaW5nKHN0cnVjdCBwYWdlICoqcGFnZXMsCi0JCWVu
dW0gdHRtX2NhY2hpbmdfc3RhdGUgY3N0YXRlLCB1bnNpZ25lZCBjcGFnZXMpCisJCWVudW0gdHRt
X2NhY2hpbmcgY3N0YXRlLCB1bnNpZ25lZCBjcGFnZXMpCiB7CiAJaW50IHIgPSAwOwogCS8qIFNl
dCBwYWdlIGNhY2hpbmcgKi8KIAlzd2l0Y2ggKGNzdGF0ZSkgewotCWNhc2UgdHRfdW5jYWNoZWQ6
CisJY2FzZSB0dG1fdW5jYWNoZWQ6CiAJCXIgPSB0dG1fc2V0X3BhZ2VzX2FycmF5X3VjKHBhZ2Vz
LCBjcGFnZXMpOwogCQlpZiAocikKIAkJCXByX2VycigiRmFpbGVkIHRvIHNldCAlZCBwYWdlcyB0
byB1YyFcbiIsIGNwYWdlcyk7CiAJCWJyZWFrOwotCWNhc2UgdHRfd2M6CisJY2FzZSB0dG1fd3Jp
dGVfY29tYmluZWQ6CiAJCXIgPSB0dG1fc2V0X3BhZ2VzX2FycmF5X3djKHBhZ2VzLCBjcGFnZXMp
OwogCQlpZiAocikKIAkJCXByX2VycigiRmFpbGVkIHRvIHNldCAlZCBwYWdlcyB0byB3YyFcbiIs
IGNwYWdlcyk7CkBAIC00ODYsNyArNDg2LDcgQEAgc3RhdGljIHZvaWQgdHRtX2hhbmRsZV9jYWNo
aW5nX2ZhaWx1cmUoc3RydWN0IHBhZ2UgKipmYWlsZWRfcGFnZXMsCiAgKiBwYWdlcyByZXR1cm5l
ZCBpbiBwYWdlcyBhcnJheS4KICAqLwogc3RhdGljIGludCB0dG1fYWxsb2NfbmV3X3BhZ2VzKHN0
cnVjdCBsaXN0X2hlYWQgKnBhZ2VzLCBnZnBfdCBnZnBfZmxhZ3MsCi0JCQkgICAgICAgaW50IHR0
bV9mbGFncywgZW51bSB0dG1fY2FjaGluZ19zdGF0ZSBjc3RhdGUsCisJCQkgICAgICAgaW50IHR0
bV9mbGFncywgZW51bSB0dG1fY2FjaGluZyBjc3RhdGUsCiAJCQkgICAgICAgdW5zaWduZWQgY291
bnQsIHVuc2lnbmVkIG9yZGVyKQogewogCXN0cnVjdCBwYWdlICoqY2FjaGluZ19hcnJheTsKQEAg
LTU2Niw3ICs1NjYsNyBAQCBzdGF0aWMgaW50IHR0bV9hbGxvY19uZXdfcGFnZXMoc3RydWN0IGxp
c3RfaGVhZCAqcGFnZXMsIGdmcF90IGdmcF9mbGFncywKICAqIHBhZ2VzIGlzIHNtYWxsLgogICov
CiBzdGF0aWMgdm9pZCB0dG1fcGFnZV9wb29sX2ZpbGxfbG9ja2VkKHN0cnVjdCB0dG1fcGFnZV9w
b29sICpwb29sLCBpbnQgdHRtX2ZsYWdzLAotCQkJCSAgICAgIGVudW0gdHRtX2NhY2hpbmdfc3Rh
dGUgY3N0YXRlLAorCQkJCSAgICAgIGVudW0gdHRtX2NhY2hpbmcgY3N0YXRlLAogCQkJCSAgICAg
IHVuc2lnbmVkIGNvdW50LCB1bnNpZ25lZCBsb25nICppcnFfZmxhZ3MpCiB7CiAJc3RydWN0IHBh
Z2UgKnA7CkBAIC02MjYsNyArNjI2LDcgQEAgc3RhdGljIHZvaWQgdHRtX3BhZ2VfcG9vbF9maWxs
X2xvY2tlZChzdHJ1Y3QgdHRtX3BhZ2VfcG9vbCAqcG9vbCwgaW50IHR0bV9mbGFncywKIHN0YXRp
YyBpbnQgdHRtX3BhZ2VfcG9vbF9nZXRfcGFnZXMoc3RydWN0IHR0bV9wYWdlX3Bvb2wgKnBvb2ws
CiAJCQkJICAgc3RydWN0IGxpc3RfaGVhZCAqcGFnZXMsCiAJCQkJICAgaW50IHR0bV9mbGFncywK
LQkJCQkgICBlbnVtIHR0bV9jYWNoaW5nX3N0YXRlIGNzdGF0ZSwKKwkJCQkgICBlbnVtIHR0bV9j
YWNoaW5nIGNzdGF0ZSwKIAkJCQkgICB1bnNpZ25lZCBjb3VudCwgdW5zaWduZWQgb3JkZXIpCiB7
CiAJdW5zaWduZWQgbG9uZyBpcnFfZmxhZ3M7CkBAIC03MDMsNyArNzAzLDcgQEAgc3RhdGljIGlu
dCB0dG1fcGFnZV9wb29sX2dldF9wYWdlcyhzdHJ1Y3QgdHRtX3BhZ2VfcG9vbCAqcG9vbCwKIAog
LyogUHV0IGFsbCBwYWdlcyBpbiBwYWdlcyBsaXN0IHRvIGNvcnJlY3QgcG9vbCB0byB3YWl0IGZv
ciByZXVzZSAqLwogc3RhdGljIHZvaWQgdHRtX3B1dF9wYWdlcyhzdHJ1Y3QgcGFnZSAqKnBhZ2Vz
LCB1bnNpZ25lZCBucGFnZXMsIGludCBmbGFncywKLQkJCSAgZW51bSB0dG1fY2FjaGluZ19zdGF0
ZSBjc3RhdGUpCisJCQkgIGVudW0gdHRtX2NhY2hpbmcgY3N0YXRlKQogewogCXN0cnVjdCB0dG1f
cGFnZV9wb29sICpwb29sID0gdHRtX2dldF9wb29sKGZsYWdzLCBmYWxzZSwgY3N0YXRlKTsKICNp
ZmRlZiBDT05GSUdfVFJBTlNQQVJFTlRfSFVHRVBBR0UKQEAgLTgyMSw3ICs4MjEsNyBAQCBzdGF0
aWMgdm9pZCB0dG1fcHV0X3BhZ2VzKHN0cnVjdCBwYWdlICoqcGFnZXMsIHVuc2lnbmVkIG5wYWdl
cywgaW50IGZsYWdzLAogICogY2FjaGVkIHBhZ2VzLgogICovCiBzdGF0aWMgaW50IHR0bV9nZXRf
cGFnZXMoc3RydWN0IHBhZ2UgKipwYWdlcywgdW5zaWduZWQgbnBhZ2VzLCBpbnQgZmxhZ3MsCi0J
CQkgZW51bSB0dG1fY2FjaGluZ19zdGF0ZSBjc3RhdGUpCisJCQkgZW51bSB0dG1fY2FjaGluZyBj
c3RhdGUpCiB7CiAJc3RydWN0IHR0bV9wYWdlX3Bvb2wgKnBvb2wgPSB0dG1fZ2V0X3Bvb2woZmxh
Z3MsIGZhbHNlLCBjc3RhdGUpOwogI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQpA
QCAtMTA0MCw3ICsxMDQwLDcgQEAgdHRtX3Bvb2xfdW5wb3B1bGF0ZV9oZWxwZXIoc3RydWN0IHR0
bV90dCAqdHRtLCB1bnNpZ25lZCBtZW1fY291bnRfdXBkYXRlKQogCiBwdXRfcGFnZXM6CiAJdHRt
X3B1dF9wYWdlcyh0dG0tPnBhZ2VzLCB0dG0tPm51bV9wYWdlcywgdHRtLT5wYWdlX2ZsYWdzLAot
CQkgICAgICB0dG0tPmNhY2hpbmdfc3RhdGUpOworCQkgICAgICB0dG0tPmNhY2hpbmcpOwogCXR0
bV90dF9zZXRfdW5wb3B1bGF0ZWQodHRtKTsKIH0KIApAQCAtMTA1Nyw3ICsxMDU3LDcgQEAgaW50
IHR0bV9wb29sX3BvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9vcGVyYXRp
b25fY3R4ICpjdHgpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJcmV0ID0gdHRtX2dldF9wYWdlcyh0
dG0tPnBhZ2VzLCB0dG0tPm51bV9wYWdlcywgdHRtLT5wYWdlX2ZsYWdzLAotCQkJICAgIHR0bS0+
Y2FjaGluZ19zdGF0ZSk7CisJCQkgICAgdHRtLT5jYWNoaW5nKTsKIAlpZiAodW5saWtlbHkocmV0
ICE9IDApKSB7CiAJCXR0bV9wb29sX3VucG9wdWxhdGVfaGVscGVyKHR0bSwgMCk7CiAJCXJldHVy
biByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9jX2Rt
YS5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvY19kbWEuYwppbmRleCAxMDQ1
YTVjMjZlZTMuLjY2MjViNDNmNjI1NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fcGFnZV9hbGxvY19kbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2Fs
bG9jX2RtYS5jCkBAIC0zMjUsMTUgKzMyNSwxNSBAQCBzdGF0aWMgc3RydWN0IGRtYV9wYWdlICpf
X3R0bV9kbWFfYWxsb2NfcGFnZShzdHJ1Y3QgZG1hX3Bvb2wgKnBvb2wpCiAJfQogCXJldHVybiBk
X3BhZ2U7CiB9Ci1zdGF0aWMgZW51bSBwb29sX3R5cGUgdHRtX3RvX3R5cGUoaW50IGZsYWdzLCBl
bnVtIHR0bV9jYWNoaW5nX3N0YXRlIGNzdGF0ZSkKK3N0YXRpYyBlbnVtIHBvb2xfdHlwZSB0dG1f
dG9fdHlwZShpbnQgZmxhZ3MsIGVudW0gdHRtX2NhY2hpbmcgY3N0YXRlKQogewogCWVudW0gcG9v
bF90eXBlIHR5cGUgPSBJU19VTkRFRklORUQ7CiAKIAlpZiAoZmxhZ3MgJiBUVE1fUEFHRV9GTEFH
X0RNQTMyKQogCQl0eXBlIHw9IElTX0RNQTMyOwotCWlmIChjc3RhdGUgPT0gdHRfY2FjaGVkKQor
CWlmIChjc3RhdGUgPT0gdHRtX2NhY2hlZCkKIAkJdHlwZSB8PSBJU19DQUNIRUQ7Ci0JZWxzZSBp
ZiAoY3N0YXRlID09IHR0X3VuY2FjaGVkKQorCWVsc2UgaWYgKGNzdGF0ZSA9PSB0dG1fdW5jYWNo
ZWQpCiAJCXR5cGUgfD0gSVNfVUM7CiAJZWxzZQogCQl0eXBlIHw9IElTX1dDOwpAQCAtNjYzLDcg
KzY2Myw3IEBAIHN0YXRpYyBzdHJ1Y3QgZG1hX3Bvb2wgKnR0bV9kbWFfZmluZF9wb29sKHN0cnVj
dCBkZXZpY2UgKmRldiwKICAqIGFyZSBwYWdlcyB0aGF0IGhhdmUgY2hhbmdlZCB0aGVpciBjYWNo
aW5nIHN0YXRlIGFscmVhZHkgcHV0IHRoZW0gdG8gdGhlCiAgKiBwb29sLgogICovCi1zdGF0aWMg
dm9pZCB0dG1fZG1hX2hhbmRsZV9jYWNoaW5nX3N0YXRlX2ZhaWx1cmUoc3RydWN0IGRtYV9wb29s
ICpwb29sLAorc3RhdGljIHZvaWQgdHRtX2RtYV9oYW5kbGVfY2FjaGluZ19mYWlsdXJlKHN0cnVj
dCBkbWFfcG9vbCAqcG9vbCwKIAkJCQkJCSBzdHJ1Y3QgbGlzdF9oZWFkICpkX3BhZ2VzLAogCQkJ
CQkJIHN0cnVjdCBwYWdlICoqZmFpbGVkX3BhZ2VzLAogCQkJCQkJIHVuc2lnbmVkIGNwYWdlcykK
QEAgLTczNCw3ICs3MzQsNyBAQCBzdGF0aWMgaW50IHR0bV9kbWFfcG9vbF9hbGxvY19uZXdfcGFn
ZXMoc3RydWN0IGRtYV9wb29sICpwb29sLAogCQkJCXIgPSB0dG1fc2V0X3BhZ2VzX2NhY2hpbmco
cG9vbCwgY2FjaGluZ19hcnJheSwKIAkJCQkJCQkgIGNwYWdlcyk7CiAJCQkJaWYgKHIpCi0JCQkJ
CXR0bV9kbWFfaGFuZGxlX2NhY2hpbmdfc3RhdGVfZmFpbHVyZSgKKwkJCQkJdHRtX2RtYV9oYW5k
bGVfY2FjaGluZ19mYWlsdXJlKAogCQkJCQkJcG9vbCwgZF9wYWdlcywgY2FjaGluZ19hcnJheSwK
IAkJCQkJCWNwYWdlcyk7CiAJCQl9CkBAIC03NjAsNyArNzYwLDcgQEAgc3RhdGljIGludCB0dG1f
ZG1hX3Bvb2xfYWxsb2NfbmV3X3BhZ2VzKHN0cnVjdCBkbWFfcG9vbCAqcG9vbCwKIAkJCQlyID0g
dHRtX3NldF9wYWdlc19jYWNoaW5nKHBvb2wsIGNhY2hpbmdfYXJyYXksCiAJCQkJCQkJICBjcGFn
ZXMpOwogCQkJCWlmIChyKSB7Ci0JCQkJCXR0bV9kbWFfaGFuZGxlX2NhY2hpbmdfc3RhdGVfZmFp
bHVyZSgKKwkJCQkJdHRtX2RtYV9oYW5kbGVfY2FjaGluZ19mYWlsdXJlKAogCQkJCQkgICAgIHBv
b2wsIGRfcGFnZXMsIGNhY2hpbmdfYXJyYXksCiAJCQkJCSAgICAgY3BhZ2VzKTsKIAkJCQkJZ290
byBvdXQ7CkBAIC03NzMsNyArNzczLDcgQEAgc3RhdGljIGludCB0dG1fZG1hX3Bvb2xfYWxsb2Nf
bmV3X3BhZ2VzKHN0cnVjdCBkbWFfcG9vbCAqcG9vbCwKIAlpZiAoY3BhZ2VzKSB7CiAJCXIgPSB0
dG1fc2V0X3BhZ2VzX2NhY2hpbmcocG9vbCwgY2FjaGluZ19hcnJheSwgY3BhZ2VzKTsKIAkJaWYg
KHIpCi0JCQl0dG1fZG1hX2hhbmRsZV9jYWNoaW5nX3N0YXRlX2ZhaWx1cmUocG9vbCwgZF9wYWdl
cywKKwkJCXR0bV9kbWFfaGFuZGxlX2NhY2hpbmdfZmFpbHVyZShwb29sLCBkX3BhZ2VzLAogCQkJ
CQljYWNoaW5nX2FycmF5LCBjcGFnZXMpOwogCX0KIG91dDoKQEAgLTkwNCw3ICs5MDQsNyBAQCBp
bnQgdHRtX2RtYV9wb3B1bGF0ZShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IGRl
dmljZSAqZGV2LAogCUlOSVRfTElTVF9IRUFEKCZ0dG1fZG1hLT5wYWdlc19saXN0KTsKIAlpID0g
MDsKIAotCXR5cGUgPSB0dG1fdG9fdHlwZSh0dG0tPnBhZ2VfZmxhZ3MsIHR0bS0+Y2FjaGluZ19z
dGF0ZSk7CisJdHlwZSA9IHR0bV90b190eXBlKHR0bS0+cGFnZV9mbGFncywgdHRtLT5jYWNoaW5n
KTsKIAogI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQogCWlmICh0dG0tPnBhZ2Vf
ZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX0RNQTMyKQpAQCAtMTAwMCw3ICsxMDAwLDcgQEAgdm9pZCB0
dG1fZG1hX3VucG9wdWxhdGUoc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEsIHN0cnVjdCBkZXZp
Y2UgKmRldikKIAl1bnNpZ25lZCBjb3VudCwgaSwgbnBhZ2VzID0gMDsKIAl1bnNpZ25lZCBsb25n
IGlycV9mbGFnczsKIAotCXR5cGUgPSB0dG1fdG9fdHlwZSh0dG0tPnBhZ2VfZmxhZ3MsIHR0bS0+
Y2FjaGluZ19zdGF0ZSk7CisJdHlwZSA9IHR0bV90b190eXBlKHR0bS0+cGFnZV9mbGFncywgdHRt
LT5jYWNoaW5nKTsKIAogI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQogCXBvb2wg
PSB0dG1fZG1hX2ZpbmRfcG9vbChkZXYsIHR5cGUgfCBJU19IVUdFKTsKQEAgLTEwMzIsNyArMTAz
Miw3IEBAIHZvaWQgdHRtX2RtYV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1h
LCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiAJCXJldHVybjsKIAogCWlzX2NhY2hlZCA9ICh0dG1fZG1h
X2ZpbmRfcG9vbChwb29sLT5kZXYsCi0JCSAgICAgdHRtX3RvX3R5cGUodHRtLT5wYWdlX2ZsYWdz
LCB0dF9jYWNoZWQpKSA9PSBwb29sKTsKKwkJICAgICB0dG1fdG9fdHlwZSh0dG0tPnBhZ2VfZmxh
Z3MsIHR0bV9jYWNoZWQpKSA9PSBwb29sKTsKIAogCS8qIG1ha2Ugc3VyZSBwYWdlcyBhcnJheSBt
YXRjaCBsaXN0IGFuZCBjb3VudCBudW1iZXIgb2YgcGFnZXMgKi8KIAljb3VudCA9IDA7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV90dC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fdHQuYwppbmRleCAyM2U5NjA0YmM5MjQuLmE0NjVmNTFkZjAyNyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fdHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV90dC5jCkBAIC0xMTQsMzEgKzExNCwzMCBAQCBzdGF0aWMgaW50IHR0bV9zZ190dF9hbGxvY19w
YWdlX2RpcmVjdG9yeShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtKQogCXJldHVybiAwOwogfQogCi1z
dGF0aWMgaW50IHR0bV90dF9zZXRfY2FjaGluZyhzdHJ1Y3QgdHRtX3R0ICp0dG0sCi0JCQkgICAg
ICBlbnVtIHR0bV9jYWNoaW5nX3N0YXRlIGNfc3RhdGUpCitzdGF0aWMgaW50IHR0bV90dF9zZXRf
Y2FjaGluZyhzdHJ1Y3QgdHRtX3R0ICp0dG0sIGVudW0gdHRtX2NhY2hpbmcgY2FjaGluZykKIHsK
LQlpZiAodHRtLT5jYWNoaW5nX3N0YXRlID09IGNfc3RhdGUpCisJaWYgKHR0bS0+Y2FjaGluZyA9
PSBjYWNoaW5nKQogCQlyZXR1cm4gMDsKIAogCS8qIENhbid0IGNoYW5nZSB0aGUgY2FjaGluZyBz
dGF0ZSBhZnRlciBUVCBpcyBwb3B1bGF0ZWQgKi8KIAlpZiAoV0FSTl9PTl9PTkNFKHR0bV90dF9p
c19wb3B1bGF0ZWQodHRtKSkpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JdHRtLT5jYWNoaW5nX3N0
YXRlID0gY19zdGF0ZTsKKwl0dG0tPmNhY2hpbmcgPSBjYWNoaW5nOwogCiAJcmV0dXJuIDA7CiB9
CiAKIGludCB0dG1fdHRfc2V0X3BsYWNlbWVudF9jYWNoaW5nKHN0cnVjdCB0dG1fdHQgKnR0bSwg
dWludDMyX3QgcGxhY2VtZW50KQogewotCWVudW0gdHRtX2NhY2hpbmdfc3RhdGUgc3RhdGU7CisJ
ZW51bSB0dG1fY2FjaGluZyBzdGF0ZTsKIAogCWlmIChwbGFjZW1lbnQgJiBUVE1fUExfRkxBR19X
QykKLQkJc3RhdGUgPSB0dF93YzsKKwkJc3RhdGUgPSB0dG1fd3JpdGVfY29tYmluZWQ7CiAJZWxz
ZSBpZiAocGxhY2VtZW50ICYgVFRNX1BMX0ZMQUdfVU5DQUNIRUQpCi0JCXN0YXRlID0gdHRfdW5j
YWNoZWQ7CisJCXN0YXRlID0gdHRtX3VuY2FjaGVkOwogCWVsc2UKLQkJc3RhdGUgPSB0dF9jYWNo
ZWQ7CisJCXN0YXRlID0gdHRtX2NhY2hlZDsKIAogCXJldHVybiB0dG1fdHRfc2V0X2NhY2hpbmco
dHRtLCBzdGF0ZSk7CiB9CkBAIC0xNjIsMjAgKzE2MSwyMiBAQCB2b2lkIHR0bV90dF9kZXN0cm95
KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX3R0ICp0dG0pCiAKIHN0YXRp
YyB2b2lkIHR0bV90dF9pbml0X2ZpZWxkcyhzdHJ1Y3QgdHRtX3R0ICp0dG0sCiAJCQkgICAgICAg
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKLQkJCSAgICAgICB1aW50MzJfdCBwYWdlX2Zs
YWdzKQorCQkJICAgICAgIHVpbnQzMl90IHBhZ2VfZmxhZ3MsCisJCQkgICAgICAgZW51bSB0dG1f
Y2FjaGluZyBjYWNoaW5nKQogewogCXR0bS0+bnVtX3BhZ2VzID0gYm8tPm51bV9wYWdlczsKLQl0
dG0tPmNhY2hpbmdfc3RhdGUgPSB0dF9jYWNoZWQ7CisJdHRtLT5jYWNoaW5nID0gdHRtX2NhY2hl
ZDsKIAl0dG0tPnBhZ2VfZmxhZ3MgPSBwYWdlX2ZsYWdzOwogCXR0bV90dF9zZXRfdW5wb3B1bGF0
ZWQodHRtKTsKIAl0dG0tPnN3YXBfc3RvcmFnZSA9IE5VTEw7CiAJdHRtLT5zZyA9IGJvLT5zZzsK
Kwl0dG0tPmNhY2hpbmcgPSBjYWNoaW5nOwogfQogCiBpbnQgdHRtX3R0X2luaXQoc3RydWN0IHR0
bV90dCAqdHRtLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAotCQl1aW50MzJfdCBwYWdl
X2ZsYWdzKQorCQl1aW50MzJfdCBwYWdlX2ZsYWdzLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcp
CiB7Ci0JdHRtX3R0X2luaXRfZmllbGRzKHR0bSwgYm8sIHBhZ2VfZmxhZ3MpOworCXR0bV90dF9p
bml0X2ZpZWxkcyh0dG0sIGJvLCBwYWdlX2ZsYWdzLCBjYWNoaW5nKTsKIAogCWlmICh0dG1fdHRf
YWxsb2NfcGFnZV9kaXJlY3RvcnkodHRtKSkgewogCQlwcl9lcnIoIkZhaWxlZCBhbGxvY2F0aW5n
IHBhZ2UgdGFibGVcbiIpOwpAQCAtMTkzLDExICsxOTQsMTEgQEAgdm9pZCB0dG1fdHRfZmluaShz
dHJ1Y3QgdHRtX3R0ICp0dG0pCiBFWFBPUlRfU1lNQk9MKHR0bV90dF9maW5pKTsKIAogaW50IHR0
bV9kbWFfdHRfaW5pdChzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibywKLQkJICAgIHVpbnQzMl90IHBhZ2VfZmxhZ3MpCisJCSAgICB1aW50MzJf
dCBwYWdlX2ZsYWdzLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcpCiB7CiAJc3RydWN0IHR0bV90
dCAqdHRtID0gJnR0bV9kbWEtPnR0bTsKIAotCXR0bV90dF9pbml0X2ZpZWxkcyh0dG0sIGJvLCBw
YWdlX2ZsYWdzKTsKKwl0dG1fdHRfaW5pdF9maWVsZHModHRtLCBibywgcGFnZV9mbGFncywgY2Fj
aGluZyk7CiAKIAlJTklUX0xJU1RfSEVBRCgmdHRtX2RtYS0+cGFnZXNfbGlzdCk7CiAJaWYgKHR0
bV9kbWFfdHRfYWxsb2NfcGFnZV9kaXJlY3RvcnkodHRtX2RtYSkpIHsKQEAgLTIwOSwxMiArMjEw
LDEyIEBAIGludCB0dG1fZG1hX3R0X2luaXQoc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEsIHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiBFWFBPUlRfU1lNQk9MKHR0bV9kbWFfdHRfaW5p
dCk7CiAKIGludCB0dG1fc2dfdHRfaW5pdChzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3Ry
dWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKLQkJICAgdWludDMyX3QgcGFnZV9mbGFncykKKwkJ
ICAgdWludDMyX3QgcGFnZV9mbGFncywgZW51bSB0dG1fY2FjaGluZyBjYWNoaW5nKQogewogCXN0
cnVjdCB0dG1fdHQgKnR0bSA9ICZ0dG1fZG1hLT50dG07CiAJaW50IHJldDsKIAotCXR0bV90dF9p
bml0X2ZpZWxkcyh0dG0sIGJvLCBwYWdlX2ZsYWdzKTsKKwl0dG1fdHRfaW5pdF9maWVsZHModHRt
LCBibywgcGFnZV9mbGFncywgY2FjaGluZyk7CiAKIAlJTklUX0xJU1RfSEVBRCgmdHRtX2RtYS0+
cGFnZXNfbGlzdCk7CiAJaWYgKHBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5jCmluZGV4IDdiNWZkNTI4ODg3MC4u
MWZhN2Y5NDM4ZWM0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90
dG1fYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZl
ci5jCkBAIC02NDcsOSArNjQ3LDExIEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0ICp2bXdfdHRtX3R0
X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCXZtd19iZS0+bW9iID0gTlVM
TDsKIAogCWlmICh2bXdfYmUtPmRldl9wcml2LT5tYXBfbW9kZSA9PSB2bXdfZG1hX2FsbG9jX2Nv
aGVyZW50KQotCQlyZXQgPSB0dG1fZG1hX3R0X2luaXQoJnZtd19iZS0+ZG1hX3R0bSwgYm8sIHBh
Z2VfZmxhZ3MpOworCQlyZXQgPSB0dG1fZG1hX3R0X2luaXQoJnZtd19iZS0+ZG1hX3R0bSwgYm8s
IHBhZ2VfZmxhZ3MsCisJCQkJICAgICAgdHRtX2NhY2hlZCk7CiAJZWxzZQotCQlyZXQgPSB0dG1f
dHRfaW5pdCgmdm13X2JlLT5kbWFfdHRtLnR0bSwgYm8sIHBhZ2VfZmxhZ3MpOworCQlyZXQgPSB0
dG1fdHRfaW5pdCgmdm13X2JlLT5kbWFfdHRtLnR0bSwgYm8sIHBhZ2VfZmxhZ3MsCisJCQkJICB0
dG1fY2FjaGVkKTsKIAlpZiAodW5saWtlbHkocmV0ICE9IDApKQogCQlnb3RvIG91dF9ub19pbml0
OwogCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90dG0vdHRtX2NhY2hpbmcuaCBiL2luY2x1ZGUv
ZHJtL3R0bS90dG1fY2FjaGluZy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uMTYxNjI0ZGNmNmJlCi0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0
bV9jYWNoaW5nLmgKQEAgLTAsMCArMSwzNCBAQAorLyoKKyAqIENvcHlyaWdodCAyMDIwIEFkdmFu
Y2VkIE1pY3JvIERldmljZXMsIEluYy4KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFu
dGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBv
ZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAi
U29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rp
b24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBj
b3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLAorICog
YW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25z
IHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3Qg
dG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQg
bm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCisg
KiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKyAq
CisgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBP
RiBBTlkgS0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElN
SVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZP
UiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQg
U0hBTEwKKyAqIFRIRSBDT1BZUklHSFQgSE9MREVSKFMpIE9SIEFVVEhPUihTKSBCRSBMSUFCTEUg
Rk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUgorICogT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElO
IEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsCisgKiBBUklTSU5HIEZS
T00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0Ug
T1IKKyAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKyAqCisgKiBBdXRob3JzOiBD
aHJpc3RpYW4gS8O2bmlnCisgKi8KKworI2lmbmRlZiBfVFRNX0NBQ0hJTkdfSF8KKyNkZWZpbmUg
X1RUTV9DQUNISU5HX0hfCisKK2VudW0gdHRtX2NhY2hpbmcgeworCXR0bV91bmNhY2hlZCwKKwl0
dG1fd3JpdGVfY29tYmluZWQsCisJdHRtX2NhY2hlZAorfTsKKworI2VuZGlmCmRpZmYgLS1naXQg
YS9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmggYi9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKaW5k
ZXggNWQxODM1ZDQ0MDg0Li5jMzljNzIyZDUxODQgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL3R0
bS90dG1fdHQuaAorKysgYi9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKQEAgLTI4LDYgKzI4LDcg
QEAKICNkZWZpbmUgX1RUTV9UVF9IXwogCiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKyNpbmNs
dWRlIDxkcm0vdHRtL3R0bV9jYWNoaW5nLmg+CiAKIHN0cnVjdCB0dG1fdHQ7CiBzdHJ1Y3QgdHRt
X3Jlc291cmNlOwpAQCAtNDIsMTIgKzQzLDYgQEAgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4Owog
CiAjZGVmaW5lIFRUTV9QQUdFX0ZMQUdfUFJJVl9QT1BVTEFURUQgICgxIDw8IDMxKQogCi1lbnVt
IHR0bV9jYWNoaW5nX3N0YXRlIHsKLQl0dF91bmNhY2hlZCwKLQl0dF93YywKLQl0dF9jYWNoZWQK
LX07Ci0KIC8qKgogICogc3RydWN0IHR0bV90dAogICoKQEAgLTY5LDcgKzY0LDcgQEAgc3RydWN0
IHR0bV90dCB7CiAJdW5zaWduZWQgbG9uZyBudW1fcGFnZXM7CiAJc3RydWN0IHNnX3RhYmxlICpz
ZzsgLyogZm9yIFNHIG9iamVjdHMgdmlhIGRtYS1idWYgKi8KIAlzdHJ1Y3QgZmlsZSAqc3dhcF9z
dG9yYWdlOwotCWVudW0gdHRtX2NhY2hpbmdfc3RhdGUgY2FjaGluZ19zdGF0ZTsKKwllbnVtIHR0
bV9jYWNoaW5nIGNhY2hpbmc7CiB9OwogCiBzdGF0aWMgaW5saW5lIGJvb2wgdHRtX3R0X2lzX3Bv
cHVsYXRlZChzdHJ1Y3QgdHRtX3R0ICp0dCkKQEAgLTEyMSw2ICsxMTYsNyBAQCBpbnQgdHRtX3R0
X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBib29sIHplcm9fYWxsb2MpOwog
ICogQHR0bTogVGhlIHN0cnVjdCB0dG1fdHQuCiAgKiBAYm86IFRoZSBidWZmZXIgb2JqZWN0IHdl
IGNyZWF0ZSB0aGUgdHRtIGZvci4KICAqIEBwYWdlX2ZsYWdzOiBQYWdlIGZsYWdzIGFzIGlkZW50
aWZpZWQgYnkgVFRNX1BBR0VfRkxBR19YWCBmbGFncy4KKyAqIEBjYWNoaW5nOiB0aGUgZGVzaXJl
ZCBjYWNoaW5nIHN0YXRlIG9mIHRoZSBwYWdlcwogICoKICAqIENyZWF0ZSBhIHN0cnVjdCB0dG1f
dHQgdG8gYmFjayBkYXRhIHdpdGggc3lzdGVtIG1lbW9yeSBwYWdlcy4KICAqIE5vIHBhZ2VzIGFy
ZSBhY3R1YWxseSBhbGxvY2F0ZWQuCkBAIC0xMjgsMTEgKzEyNCwxMSBAQCBpbnQgdHRtX3R0X2Ny
ZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLCBib29sIHplcm9fYWxsb2MpOwogICog
TlVMTDogT3V0IG9mIG1lbW9yeS4KICAqLwogaW50IHR0bV90dF9pbml0KHN0cnVjdCB0dG1fdHQg
KnR0bSwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKLQkJdWludDMyX3QgcGFnZV9mbGFn
cyk7CisJCXVpbnQzMl90IHBhZ2VfZmxhZ3MsIGVudW0gdHRtX2NhY2hpbmcgY2FjaGluZyk7CiBp
bnQgdHRtX2RtYV90dF9pbml0KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRt
X2J1ZmZlcl9vYmplY3QgKmJvLAotCQkgICAgdWludDMyX3QgcGFnZV9mbGFncyk7CisJCSAgICB1
aW50MzJfdCBwYWdlX2ZsYWdzLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcpOwogaW50IHR0bV9z
Z190dF9pbml0KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvLAotCQkgICB1aW50MzJfdCBwYWdlX2ZsYWdzKTsKKwkJICAgdWludDMyX3QgcGFn
ZV9mbGFncywgZW51bSB0dG1fY2FjaGluZyBjYWNoaW5nKTsKIAogLyoqCiAgKiB0dG1fdHRfZmlu
aQotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWwK
