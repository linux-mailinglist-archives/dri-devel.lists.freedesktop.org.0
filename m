Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D2616173B0
	for <lists+dri-devel@lfdr.de>; Wed,  8 May 2019 10:27:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D9630897E0;
	Wed,  8 May 2019 08:26:55 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 081978973E
 for <dri-devel@lists.freedesktop.org>; Wed,  8 May 2019 08:26:43 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 81BE2AF01;
 Wed,  8 May 2019 08:26:41 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, airlied@linux.ie, kraxel@redhat.com,
 christian.koenig@amd.com, ray.huang@amd.com, hdegoede@redhat.com,
 noralf@tronnes.org, sam@ravnborg.org, z.liuxinliang@hisilicon.com,
 zourongrong@gmail.com, kong.kongxinwei@hisilicon.com,
 puck.chen@hisilicon.com
Subject: [PATCH v5 13/20] drm/bochs: Convert bochs driver to VRAM MM
Date: Wed,  8 May 2019 10:26:23 +0200
Message-Id: <20190508082630.15116-14-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190508082630.15116-1-tzimmermann@suse.de>
References: <20190508082630.15116-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGRhdGEgc3RydWN0dXJlIHxzdHJ1Y3QgZHJtX3ZyYW1fbW18IGFuZCBpdHMgaGVscGVycyBy
ZXBsYWNlIGJvY2hzJwpUVE0tYmFzZWQgbWVtb3J5IG1hbmFnZXIuIEl0J3MgdGhlIHNhbWUgaW1w
bGVtZW50YXRpb247IGV4Y2VwdCBmb3IgdGhlCnR5cGUgbmFtZXMuCgp2NToKCSogc2V0IC5sbHNl
ZWsgdmlhIERSTV9WUkFNX01NX0ZJTEVfT1BFUkFUSU9OUwp2NDoKCSogZG9uJ3Qgc2VsZWN0IERS
TV9UVE0gb3IgRFJNX1ZSQU1fTU1fSEVMUEVSCnYzOgoJKiB1c2UgZHJtX2dlbV92cmFtX21tX2Z1
bmNzCgkqIGNvbnZlcnQgZHJpdmVyIHRvIGRybV9kZXZpY2UtYmFzZWQgaW5zdGFuY2UKdjI6Cgkq
IGltcGxlbWVudCBib2Noc19tbWFwKCkgd2l0aCBkcm1fdnJhbV9tbV9tbWFwKCkKClNpZ25lZC1v
ZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9ib2Nocy9LY29uZmlnICAgICB8ICAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vYm9j
aHMvYm9jaHMuaCAgICAgfCAgMTMgKy0tCiBkcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfZHJ2
LmMgfCAgMTUgKy0tCiBkcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfbW0uYyAgfCAxNDggKyst
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDExIGluc2VydGlv
bnMoKyksIDE2NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYm9j
aHMvS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9ib2Nocy9LY29uZmlnCmluZGV4IDRjYmNmZjll
MmViOC4uZTFmNmFlOWRkMDQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvS2Nv
bmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvS2NvbmZpZwpAQCAtMiw3ICsyLDYgQEAg
Y29uZmlnIERSTV9CT0NIUwogCXRyaXN0YXRlICJEUk0gU3VwcG9ydCBmb3IgYm9jaHMgZGlzcGkg
dmdhIGludGVyZmFjZSAocWVtdSBzdGR2Z2EpIgogCWRlcGVuZHMgb24gRFJNICYmIFBDSSAmJiBN
TVUKIAlzZWxlY3QgRFJNX0tNU19IRUxQRVIKLQlzZWxlY3QgRFJNX1RUTQogCXNlbGVjdCBEUk1f
VlJBTV9IRUxQRVIKIAloZWxwCiAJICBDaG9vc2UgdGhpcyBvcHRpb24gZm9yIHFlbXUuCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9i
b2Nocy9ib2Nocy5oCmluZGV4IGIwYTRjM2Y5MDQ5Ny4uY2MzNWQ0OTIxNDJjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYm9j
aHMvYm9jaHMuaApAQCAtMTIsOCArMTIsNyBAQAogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaD4KIAotI2luY2x1ZGUgPGRybS90dG0v
dHRtX2JvX2RyaXZlci5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRtX3BhZ2VfYWxsb2MuaD4KKyNp
bmNsdWRlIDxkcm0vZHJtX3ZyYW1fbW1faGVscGVyLmg+CiAKIC8qIC0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8K
IApAQCAtNzQsMTIgKzczLDYgQEAgc3RydWN0IGJvY2hzX2RldmljZSB7CiAJc3RydWN0IGRybV9k
ZXZpY2UgKmRldjsKIAlzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgcGlwZTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciBjb25uZWN0b3I7Ci0KLQkvKiB0dG0gKi8KLQlzdHJ1Y3QgewotCQlz
dHJ1Y3QgdHRtX2JvX2RldmljZSBiZGV2OwotCQlib29sIGluaXRpYWxpemVkOwotCX0gdHRtOwog
fTsKIAogLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwpAQCAtOTksMTAgKzkyLDYgQEAgaW50IGJvY2hzX2h3
X2xvYWRfZWRpZChzdHJ1Y3QgYm9jaHNfZGV2aWNlICpib2Nocyk7CiAvKiBib2Noc19tbS5jICov
CiBpbnQgYm9jaHNfbW1faW5pdChzdHJ1Y3QgYm9jaHNfZGV2aWNlICpib2Nocyk7CiB2b2lkIGJv
Y2hzX21tX2Zpbmkoc3RydWN0IGJvY2hzX2RldmljZSAqYm9jaHMpOwotaW50IGJvY2hzX21tYXAo
c3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKTsKLQotaW50IGJv
Y2hzX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwgc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKLQkJICAgICAgc3RydWN0IGRybV9tb2RlX2NyZWF0ZV9kdW1iICphcmdzKTsKIAogLyog
Ym9jaHNfa21zLmMgKi8KIGludCBib2Noc19rbXNfaW5pdChzdHJ1Y3QgYm9jaHNfZGV2aWNlICpi
b2Nocyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfZHJ2LmMgYi9k
cml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfZHJ2LmMKaW5kZXggMWIxMDQ3YWRhMTMwLi40YzQy
NTQzOWM3N2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ib2Nocy9ib2Noc19kcnYuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHNfZHJ2LmMKQEAgLTYzLDE0ICs2Myw3IEBA
IHN0YXRpYyBpbnQgYm9jaHNfbG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBib2Noc19mb3BzID0gewogCS5vd25lcgkJPSBU
SElTX01PRFVMRSwKLQkub3BlbgkJPSBkcm1fb3BlbiwKLQkucmVsZWFzZQk9IGRybV9yZWxlYXNl
LAotCS51bmxvY2tlZF9pb2N0bAk9IGRybV9pb2N0bCwKLQkuY29tcGF0X2lvY3RsCT0gZHJtX2Nv
bXBhdF9pb2N0bCwKLQkucG9sbAkJPSBkcm1fcG9sbCwKLQkucmVhZAkJPSBkcm1fcmVhZCwKLQku
bGxzZWVrCQk9IG5vX2xsc2VlaywKLQkubW1hcCAgICAgICAgICAgPSBib2Noc19tbWFwLAorCURS
TV9WUkFNX01NX0ZJTEVfT1BFUkFUSU9OUwogfTsKIAogc3RhdGljIHN0cnVjdCBkcm1fZHJpdmVy
IGJvY2hzX2RyaXZlciA9IHsKQEAgLTgyLDExICs3NSw3IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2Ry
aXZlciBib2Noc19kcml2ZXIgPSB7CiAJLmRhdGUJCQk9ICIyMDEzMDkyNSIsCiAJLm1ham9yCQkJ
PSAxLAogCS5taW5vcgkJCT0gMCwKLQkuZ2VtX2ZyZWVfb2JqZWN0X3VubG9ja2VkID0KLQkJZHJt
X2dlbV92cmFtX2RyaXZlcl9nZW1fZnJlZV9vYmplY3RfdW5sb2NrZWQsCi0JLmR1bWJfY3JlYXRl
ICAgICAgICAgICAgPSBib2Noc19kdW1iX2NyZWF0ZSwKLQkuZHVtYl9tYXBfb2Zmc2V0ICAgICAg
ICA9IGRybV9nZW1fdnJhbV9kcml2ZXJfZHVtYl9tbWFwX29mZnNldCwKLQorCURSTV9HRU1fVlJB
TV9EUklWRVIsCiAJRFJNX0dFTV9WUkFNX0RSSVZFUl9QUklNRSwKIH07CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9ib2Nocy9ib2Noc19tbS5jIGIvZHJpdmVycy9ncHUvZHJtL2JvY2hz
L2JvY2hzX21tLmMKaW5kZXggYjE5ZmY4MDk0MDQ5Li5jZmI0OTcxNDBmNmYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9ib2Nocy9ib2Noc19tbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9i
b2Nocy9ib2Noc19tbS5jCkBAIC05LDE1NSArOSwyMyBAQAogCiAvKiAtLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICov
CiAKLXN0YXRpYyBpbmxpbmUgc3RydWN0IGJvY2hzX2RldmljZSAqYm9jaHNfYmRldihzdHJ1Y3Qg
dHRtX2JvX2RldmljZSAqYmQpCi17Ci0JcmV0dXJuIGNvbnRhaW5lcl9vZihiZCwgc3RydWN0IGJv
Y2hzX2RldmljZSwgdHRtLmJkZXYpOwotfQotCi1zdGF0aWMgaW50IGJvY2hzX2JvX2luaXRfbWVt
X3R5cGUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHVpbnQzMl90IHR5cGUsCi0JCQkJICBz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbikKLXsKLQlzd2l0Y2ggKHR5cGUpIHsKLQlj
YXNlIFRUTV9QTF9TWVNURU06Ci0JCW1hbi0+ZmxhZ3MgPSBUVE1fTUVNVFlQRV9GTEFHX01BUFBB
QkxFOwotCQltYW4tPmF2YWlsYWJsZV9jYWNoaW5nID0gVFRNX1BMX01BU0tfQ0FDSElORzsKLQkJ
bWFuLT5kZWZhdWx0X2NhY2hpbmcgPSBUVE1fUExfRkxBR19DQUNIRUQ7Ci0JCWJyZWFrOwotCWNh
c2UgVFRNX1BMX1ZSQU06Ci0JCW1hbi0+ZnVuYyA9ICZ0dG1fYm9fbWFuYWdlcl9mdW5jOwotCQlt
YW4tPmZsYWdzID0gVFRNX01FTVRZUEVfRkxBR19GSVhFRCB8Ci0JCQlUVE1fTUVNVFlQRV9GTEFH
X01BUFBBQkxFOwotCQltYW4tPmF2YWlsYWJsZV9jYWNoaW5nID0gVFRNX1BMX0ZMQUdfVU5DQUNI
RUQgfAotCQkJVFRNX1BMX0ZMQUdfV0M7Ci0JCW1hbi0+ZGVmYXVsdF9jYWNoaW5nID0gVFRNX1BM
X0ZMQUdfV0M7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCURSTV9FUlJPUigiVW5zdXBwb3J0ZWQg
bWVtb3J5IHR5cGUgJXVcbiIsICh1bnNpZ25lZCl0eXBlKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0J
fQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGJvY2hzX3R0bV9pb19tZW1fcmVzZXJ2ZShz
dHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKLQkJCQkgICAgc3RydWN0IHR0bV9tZW1fcmVnICpt
ZW0pCi17Ci0Jc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW21l
bS0+bWVtX3R5cGVdOwotCXN0cnVjdCBib2Noc19kZXZpY2UgKmJvY2hzID0gYm9jaHNfYmRldihi
ZGV2KTsKLQotCW1lbS0+YnVzLmFkZHIgPSBOVUxMOwotCW1lbS0+YnVzLm9mZnNldCA9IDA7Ci0J
bWVtLT5idXMuc2l6ZSA9IG1lbS0+bnVtX3BhZ2VzIDw8IFBBR0VfU0hJRlQ7Ci0JbWVtLT5idXMu
YmFzZSA9IDA7Ci0JbWVtLT5idXMuaXNfaW9tZW0gPSBmYWxzZTsKLQlpZiAoIShtYW4tPmZsYWdz
ICYgVFRNX01FTVRZUEVfRkxBR19NQVBQQUJMRSkpCi0JCXJldHVybiAtRUlOVkFMOwotCXN3aXRj
aCAobWVtLT5tZW1fdHlwZSkgewotCWNhc2UgVFRNX1BMX1NZU1RFTToKLQkJLyogc3lzdGVtIG1l
bW9yeSAqLwotCQlyZXR1cm4gMDsKLQljYXNlIFRUTV9QTF9WUkFNOgotCQltZW0tPmJ1cy5vZmZz
ZXQgPSBtZW0tPnN0YXJ0IDw8IFBBR0VfU0hJRlQ7Ci0JCW1lbS0+YnVzLmJhc2UgPSBib2Nocy0+
ZmJfYmFzZTsKLQkJbWVtLT5idXMuaXNfaW9tZW0gPSB0cnVlOwotCQlicmVhazsKLQlkZWZhdWx0
OgotCQlyZXR1cm4gLUVJTlZBTDsKLQkJYnJlYWs7Ci0JfQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgdm9pZCBib2Noc190dG1faW9fbWVtX2ZyZWUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
Ci0JCQkJICBzdHJ1Y3QgdHRtX21lbV9yZWcgKm1lbSkKLXsKLX0KLQotc3RhdGljIHZvaWQgYm9j
aHNfdHRtX2JhY2tlbmRfZGVzdHJveShzdHJ1Y3QgdHRtX3R0ICp0dCkKLXsKLQl0dG1fdHRfZmlu
aSh0dCk7Ci0Ja2ZyZWUodHQpOwotfQotCi1zdGF0aWMgc3RydWN0IHR0bV9iYWNrZW5kX2Z1bmMg
Ym9jaHNfdHRfYmFja2VuZF9mdW5jID0gewotCS5kZXN0cm95ID0gJmJvY2hzX3R0bV9iYWNrZW5k
X2Rlc3Ryb3ksCi19OwotCi1zdGF0aWMgc3RydWN0IHR0bV90dCAqYm9jaHNfdHRtX3R0X2NyZWF0
ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAotCQkJCQkgIHVpbnQzMl90IHBhZ2VfZmxh
Z3MpCi17Ci0Jc3RydWN0IHR0bV90dCAqdHQ7Ci0KLQl0dCA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVj
dCB0dG1fdHQpLCBHRlBfS0VSTkVMKTsKLQlpZiAodHQgPT0gTlVMTCkKLQkJcmV0dXJuIE5VTEw7
Ci0JdHQtPmZ1bmMgPSAmYm9jaHNfdHRfYmFja2VuZF9mdW5jOwotCWlmICh0dG1fdHRfaW5pdCh0
dCwgYm8sIHBhZ2VfZmxhZ3MpKSB7Ci0JCWtmcmVlKHR0KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQot
CXJldHVybiB0dDsKLX0KLQotc3RhdGljIHN0cnVjdCB0dG1fYm9fZHJpdmVyIGJvY2hzX2JvX2Ry
aXZlciA9IHsKLQkudHRtX3R0X2NyZWF0ZSA9IGJvY2hzX3R0bV90dF9jcmVhdGUsCi0JLmluaXRf
bWVtX3R5cGUgPSBib2Noc19ib19pbml0X21lbV90eXBlLAotCS5ldmljdGlvbl92YWx1YWJsZSA9
IHR0bV9ib19ldmljdGlvbl92YWx1YWJsZSwKLQkuZXZpY3RfZmxhZ3MgPSBkcm1fZ2VtX3ZyYW1f
Ym9fZHJpdmVyX2V2aWN0X2ZsYWdzLAotCS5tb3ZlID0gTlVMTCwKLQkudmVyaWZ5X2FjY2VzcyA9
IGRybV9nZW1fdnJhbV9ib19kcml2ZXJfdmVyaWZ5X2FjY2VzcywKLQkuaW9fbWVtX3Jlc2VydmUg
PSAmYm9jaHNfdHRtX2lvX21lbV9yZXNlcnZlLAotCS5pb19tZW1fZnJlZSA9ICZib2Noc190dG1f
aW9fbWVtX2ZyZWUsCi19OwotCiBpbnQgYm9jaHNfbW1faW5pdChzdHJ1Y3QgYm9jaHNfZGV2aWNl
ICpib2NocykKIHsKLQlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9ICZib2Nocy0+dHRtLmJk
ZXY7Ci0JaW50IHJldDsKLQotCXJldCA9IHR0bV9ib19kZXZpY2VfaW5pdCgmYm9jaHMtPnR0bS5i
ZGV2LAotCQkJCSAmYm9jaHNfYm9fZHJpdmVyLAotCQkJCSBib2Nocy0+ZGV2LT5hbm9uX2lub2Rl
LT5pX21hcHBpbmcsCi0JCQkJIHRydWUpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJFcnJv
ciBpbml0aWFsaXNpbmcgYm8gZHJpdmVyOyAlZFxuIiwgcmV0KTsKLQkJcmV0dXJuIHJldDsKLQl9
CisJc3RydWN0IGRybV92cmFtX21tICp2bW07CiAKLQlyZXQgPSB0dG1fYm9faW5pdF9tbShiZGV2
LCBUVE1fUExfVlJBTSwKLQkJCSAgICAgYm9jaHMtPmZiX3NpemUgPj4gUEFHRV9TSElGVCk7Ci0J
aWYgKHJldCkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0dG0gVlJBTSBpbml0OiAlZFxuIiwgcmV0
KTsKLQkJcmV0dXJuIHJldDsKLQl9CisJdm1tID0gZHJtX3ZyYW1faGVscGVyX2FsbG9jX21tKGJv
Y2hzLT5kZXYsIGJvY2hzLT5mYl9iYXNlLAorCQkJCSAgICAgICBib2Nocy0+ZmJfc2l6ZSwKKwkJ
CQkgICAgICAgJmRybV9nZW1fdnJhbV9tbV9mdW5jcyk7CisJaWYgKElTX0VSUih2bW0pKQorCQly
ZXR1cm4gUFRSX0VSUih2bW0pOwogCi0JYm9jaHMtPnR0bS5pbml0aWFsaXplZCA9IHRydWU7CiAJ
cmV0dXJuIDA7CiB9CiAKIHZvaWQgYm9jaHNfbW1fZmluaShzdHJ1Y3QgYm9jaHNfZGV2aWNlICpi
b2NocykKIHsKLQlpZiAoIWJvY2hzLT50dG0uaW5pdGlhbGl6ZWQpCisJaWYgKCFib2Nocy0+ZGV2
LT52cmFtX21tKQogCQlyZXR1cm47CiAKLQl0dG1fYm9fZGV2aWNlX3JlbGVhc2UoJmJvY2hzLT50
dG0uYmRldik7Ci0JYm9jaHMtPnR0bS5pbml0aWFsaXplZCA9IGZhbHNlOwotfQotCi1pbnQgYm9j
aHNfbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCi17
Ci0Jc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7Ci0Jc3Ry
dWN0IGJvY2hzX2RldmljZSAqYm9jaHMgPSBmaWxlX3ByaXYtPm1pbm9yLT5kZXYtPmRldl9wcml2
YXRlOwotCi0JcmV0dXJuIHR0bV9ib19tbWFwKGZpbHAsIHZtYSwgJmJvY2hzLT50dG0uYmRldik7
Ci19Ci0KLS8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KLQotaW50IGJvY2hzX2R1bWJfY3JlYXRlKHN0cnVj
dCBkcm1fZmlsZSAqZmlsZSwgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgICAgc3RydWN0
IGRybV9tb2RlX2NyZWF0ZV9kdW1iICphcmdzKQotewotCXN0cnVjdCBib2Noc19kZXZpY2UgKmJv
Y2hzID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCXJldHVybiBkcm1fZ2VtX3ZyYW1fZmlsbF9jcmVh
dGVfZHVtYihmaWxlLCBkZXYsICZib2Nocy0+dHRtLmJkZXYsIDAsCi0JCQkJCSAgICAgZmFsc2Us
IGFyZ3MpOworCWRybV92cmFtX2hlbHBlcl9yZWxlYXNlX21tKGJvY2hzLT5kZXYpOwogfQotLSAK
Mi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpk
cmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
