Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CE5DF96CC4
	for <lists+dri-devel@lfdr.de>; Wed, 21 Aug 2019 01:07:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B8FA16E8CC;
	Tue, 20 Aug 2019 23:07:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x444.google.com (mail-pf1-x444.google.com
 [IPv6:2607:f8b0:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CA8B06E8CA
 for <dri-devel@lists.freedesktop.org>; Tue, 20 Aug 2019 23:07:10 +0000 (UTC)
Received: by mail-pf1-x444.google.com with SMTP id o70so93458pfg.5
 for <dri-devel@lists.freedesktop.org>; Tue, 20 Aug 2019 16:07:10 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=KJXVIjjEjcS++SJh1XiEkct02jaX19GJ8MzEi/j2O6Y=;
 b=tMxVBcgKjzgBZ+/AsDkla3umO9Vnjd8EWVHF/vi8lEwi9wCp7/ikZimTregaGNvw/h
 w08L3xAVnJt1LwpoBJzhuWQlKSPSJlGMuNFjkUM6uP3ga8wHKkRwK0V2Fx/LOv5sj1Ex
 JMBFyxwObHLaJeBrGf9tL6NMhMkzmEXAFvTxnTJPb7+Y9aSCxZ+F35QuZLp3CMhAG5Mg
 BP3ZyPYF9UitHvEKJEiU/+Qh+/UoG9Ubush1lbtc5LiG3ohsyirztwCKQ6Yhaaocl4ay
 YZef+f+b/eOVAs76yu3fEyO0H4xIqMNrNLAT88uTO5Axi43IwWuEYjrm5AT89zNNEMNY
 EJ9Q==
X-Gm-Message-State: APjAAAVPJ4emzOXgp1aOTJiU+GmbKVITxvHOTzBVBQeAtVxj9yCperN7
 JmMsgpqEG1BdjYjSE6ovVSnlSw==
X-Google-Smtp-Source: APXvYqzkTPoH3ukxS5Wn0/KyT91dTrz5lXdrPCWUlIFdTnx3kYaikaoqgLJ9iXUI+R9eo95/dL4hRw==
X-Received: by 2002:aa7:9e0a:: with SMTP id y10mr32219595pfq.93.1566342429744; 
 Tue, 20 Aug 2019 16:07:09 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 q4sm27564747pff.183.2019.08.20.16.07.08
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 20 Aug 2019 16:07:08 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v5 25/25] drm: kirin: Move ade drm init to kirin drm drv
Date: Tue, 20 Aug 2019 23:06:26 +0000
Message-Id: <20190820230626.23253-26-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190820230626.23253-1-john.stultz@linaro.org>
References: <20190820230626.23253-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=KJXVIjjEjcS++SJh1XiEkct02jaX19GJ8MzEi/j2O6Y=;
 b=O86/E66UeBeESApeniO67zDOQ7uSYz51tlNrdPllkA5Ebv8MR1OX+O2o2DbxHxFHr2
 xjnC34UlJTendJgI0xPKBarRPKxLmQIlZ+OsKqYypVqyBA5xrw0kK9+3nSqTKoBFER+h
 KaYAt00cDh63+XQhMOB/dcUQM73+/WrvtEyGKKDJJR/Yqx3vXkrtQc8w8wIiRp0llmH+
 N5zeWh7JjIrrmTRATxkptT0KAY12fDMfr8zrEpXQffCpUEKUvkOKW1XtiA2ihZnDTrpy
 SFZMzL7WjANmzlRT6DCaP8IvqKt5ZRR4SLHlyphlGbwM2F4MPgxTvyBDu5cLPak5+4Ak
 eIHw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Xu YiPing <xuyiping@hisilicon.com>, David Airlie <airlied@linux.ie>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Rongrong Zou <zourongrong@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWHUgWWlQaW5nIDx4dXlpcGluZ0BoaXNpbGljb24uY29tPgoKQXMgcGFydCBvZiByZWZh
Y3RvcmluZyB0aGUga2lyaW4gZHJpdmVyIHRvIGJldHRlciBzdXBwb3J0CmRpZmZlcmVudCBoYXJk
d2FyZSByZXZpc2lvbnMsIHRoaXMgcGF0Y2ggcmVuYW1lcyBhZGVfZGF0YSB0bwpraXJpbl9kcm1f
cHJpdmF0ZSwgYW5kIG1vdmVzIGNydGNfaW5pdCBhbmQgcGxhbmVfaW5pdCB0bwpraXJpbiBkcm0g
ZHJ2IHRvby4gTm93IHRoYXQgdGhleSBhcmUgZ2VuZXJpYyB0aGUgZnVuY3Rpb25zCmNhbiBiZSBz
aGFyZWQgYmV0d2VlbiB0aGUga2lyaW42MjAgYW5kICh0byBiZSBhZGRlZCBsYXRlcikKa2lyaW45
NjAgc3BlY2lmaWMgc3VwcG9ydCBjb2RlLgoKQ2M6IFJvbmdyb25nIFpvdSA8em91cm9uZ3JvbmdA
Z21haWwuY29tPgpDYzogWGlubGlhbmcgTGl1IDx6LmxpdXhpbmxpYW5nQGhpc2lsaWNvbi5jb20+
CkNjOiBEYXZpZCBBaXJsaWUgPGFpcmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWxAZmZ3bGwuY2g+CkNjOiBkcmktZGV2ZWwgPGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmc+CkNjOiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+CkFja2VkLWJ5OiBYaW5s
aWFuZyBMaXUgPHoubGl1eGlubGlhbmdAaGlzaWxpY29uLmNvbT4KUmV2aWV3ZWQtYnk6IFNhbSBS
YXZuYm9yZyA8c2FtQHJhdm5ib3JnLm9yZz4KU2lnbmVkLW9mZi1ieTogWHUgWWlQaW5nIDx4dXlp
cGluZ0BoaXNpbGljb24uY29tPgpbanN0dWx0ejogUmV3b3JkZWQgY29tbWl0IG1lc3NhZ2VdClNp
Z25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjU6
IGNoZWNrcGF0Y2ggLS1zdHJpY3Qgd2hpdGVzcGFjZSBmaXh1cHMgbm90aWNlZCBieSBTYW0KLS0t
CiAuLi4vZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5jICAgfCAxMjUgLS0t
LS0tLS0tLS0tLS0tLQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYu
YyAgIHwgMTQxICsrKysrKysrKysrKysrKystLQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2tpcmlu
L2tpcmluX2RybV9kcnYuaCAgIHwgICA1IC0KIDMgZmlsZXMgY2hhbmdlZCwgMTI5IGluc2VydGlv
bnMoKyksIDE0MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlz
aWxpY29uL2tpcmluL2tpcmluX2RybV9hZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24v
a2lyaW4va2lyaW5fZHJtX2FkZS5jCmluZGV4IGJiZGZlYWM5NDZhNy4uNzNjZDI4YTZlYTA3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9hZGUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9hZGUuYwpA
QCAtNTMsMTMgKzUzLDYgQEAgc3RydWN0IGFkZV9od19jdHggewogCXN0cnVjdCBkcm1fY3J0YyAq
Y3J0YzsKIH07CiAKLXN0cnVjdCBhZGVfZGF0YSB7Ci0Jc3RydWN0IGtpcmluX2NydGMgY3J0YzsK
LQlzdHJ1Y3Qga2lyaW5fcGxhbmUgcGxhbmVzW0FERV9DSF9OVU1dOwotCXN0cnVjdCBhZGVfaHdf
Y3R4ICpod19jdHg7Ci19OwotCi0vKiBhZGUtZm9ybWF0IGluZm86ICovCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGtpcmluX2Zvcm1hdCBhZGVfZm9ybWF0c1tdID0gewogCS8qIDE2YnBwIFJHQjogKi8K
IAl7IERSTV9GT1JNQVRfUkdCNTY1LCBBREVfUkdCXzU2NSB9LApAQCAtNTcxLDM2ICs1NjQsNiBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGFkZV9jcnRjX2Z1bmNzID0gewog
CS5kaXNhYmxlX3ZibGFuawk9IGFkZV9jcnRjX2Rpc2FibGVfdmJsYW5rLAogfTsKIAotc3RhdGlj
IGludCBraXJpbl9kcm1fY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBk
cm1fY3J0YyAqY3J0YywKLQkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKLQkJCSAg
ICAgICBjb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQotewotCXN0cnVj
dCBkZXZpY2Vfbm9kZSAqcG9ydDsKLQlpbnQgcmV0OwotCi0JLyogc2V0IGNydGMgcG9ydCBzbyB0
aGF0Ci0JICogZHJtX29mX2ZpbmRfcG9zc2libGVfY3J0Y3MgY2FsbCB3b3JrcwotCSAqLwotCXBv
cnQgPSBvZl9nZXRfY2hpbGRfYnlfbmFtZShkZXYtPmRldi0+b2Zfbm9kZSwgInBvcnQiKTsKLQlp
ZiAoIXBvcnQpIHsKLQkJRFJNX0VSUk9SKCJubyBwb3J0IG5vZGUgZm91bmQgaW4gJXBPRlxuIiwg
ZGV2LT5kZXYtPm9mX25vZGUpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0Jb2Zfbm9kZV9wdXQo
cG9ydCk7Ci0JY3J0Yy0+cG9ydCA9IHBvcnQ7Ci0KLQlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhf
cGxhbmVzKGRldiwgY3J0YywgcGxhbmUsIE5VTEwsCi0JCQkJCWRyaXZlcl9kYXRhLT5jcnRjX2Z1
bmNzLCBOVUxMKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXQgY3J0
Yy5cbiIpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCWRybV9jcnRjX2hlbHBlcl9hZGQoY3J0Yywg
ZHJpdmVyX2RhdGEtPmNydGNfaGVscGVyX2Z1bmNzKTsKLQotCXJldHVybiAwOwotfQotCiBzdGF0
aWMgdm9pZCBhZGVfcmRtYV9zZXQodm9pZCBfX2lvbWVtICpiYXNlLCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKIAkJCSB1MzIgY2gsIHUzMiB5LCB1MzIgaW5faCwgdTMyIGZtdCkKIHsKQEAg
LTg5MywyOCArODU2LDYgQEAgc3RhdGljIHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgYWRlX3BsYW5l
X2Z1bmNzID0gewogCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX3Bs
YW5lX2Rlc3Ryb3lfc3RhdGUsCiB9OwogCi1zdGF0aWMgaW50IGtpcmluX2RybV9wbGFuZV9pbml0
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJc3RydWN0IGtpcmluX3BsYW5lICprcGxhbmUs
Ci0JCQkJZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlLAotCQkJCWNvbnN0IHN0cnVjdCBraXJpbl9k
cm1fZGF0YSAqZHJpdmVyX2RhdGEpCi17Ci0JaW50IHJldCA9IDA7Ci0KLQlyZXQgPSBkcm1fdW5p
dmVyc2FsX3BsYW5lX2luaXQoZGV2LCAma3BsYW5lLT5iYXNlLCAxLAotCQkJCSAgICAgICBkcml2
ZXJfZGF0YS0+cGxhbmVfZnVuY3MsCi0JCQkJICAgICAgIGRyaXZlcl9kYXRhLT5jaGFubmVsX2Zv
cm1hdHMsCi0JCQkJICAgICAgIGRyaXZlcl9kYXRhLT5jaGFubmVsX2Zvcm1hdHNfY250LAotCQkJ
CSAgICAgICBOVUxMLCB0eXBlLCBOVUxMKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZmFp
bCB0byBpbml0IHBsYW5lLCBjaD0lZFxuIiwga3BsYW5lLT5jaCk7Ci0JCXJldHVybiByZXQ7Ci0J
fQotCi0JZHJtX3BsYW5lX2hlbHBlcl9hZGQoJmtwbGFuZS0+YmFzZSwgZHJpdmVyX2RhdGEtPnBs
YW5lX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIHZvaWQgKmFkZV9o
d19jdHhfYWxsb2Moc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAkJCSAgICAgIHN0cnVj
dCBkcm1fY3J0YyAqY3J0YykKIHsKQEAgLTk4NCw3MyArOTI1LDEwIEBAIHN0YXRpYyB2b2lkICph
ZGVfaHdfY3R4X2FsbG9jKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCiAJcmV0dXJuIGN0
eDsKIH0KIAotc3RhdGljIGludCBhZGVfZHJtX2luaXQoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEo
cGRldik7Ci0Jc3RydWN0IGFkZV9kYXRhICphZGU7Ci0Jc3RydWN0IGFkZV9od19jdHggKmN0eDsK
LQlzdHJ1Y3Qga2lyaW5fY3J0YyAqa2NydGM7Ci0Jc3RydWN0IGtpcmluX3BsYW5lICprcGxhbmU7
Ci0JZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlOwotCWludCBwcmltX3BsYW5lOwotCWludCByZXQ7
Ci0JdTMyIGNoOwotCi0JYWRlID0gZGV2bV9remFsbG9jKGRldi0+ZGV2LCBzaXplb2YoKmFkZSks
IEdGUF9LRVJORUwpOwotCWlmICghYWRlKSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIGFsbG9j
IGFkZV9kYXRhXG4iKTsKLQkJcmV0dXJuIC1FTk9NRU07Ci0JfQotCi0JY3R4ID0gYWRlX2RyaXZl
cl9kYXRhLmFsbG9jX2h3X2N0eChwZGV2LCAmYWRlLT5jcnRjLmJhc2UpOwotCWlmIChJU19FUlIo
Y3R4KSkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIGtpcmluX3ByaXYgaHcg
Y3R4XG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCWFkZS0+aHdfY3R4ID0gY3R4OwotCi0J
a2NydGMgPSAmYWRlLT5jcnRjOwotCWtjcnRjLT5od19jdHggPSBjdHg7Ci0KLQkvKgotCSAqIHBs
YW5lIGluaXQKLQkgKiBUT0RPOiBOb3cgb25seSBzdXBwb3J0IHByaW1hcnkgcGxhbmUsIG92ZXJs
YXkgcGxhbmVzCi0JICogbmVlZCB0byBkby4KLQkgKi8KLQlmb3IgKGNoID0gMDsgY2ggPCBhZGVf
ZHJpdmVyX2RhdGEubnVtX3BsYW5lczsgY2grKykgewotCQlrcGxhbmUgPSAmYWRlLT5wbGFuZXNb
Y2hdOwotCQlrcGxhbmUtPmNoID0gY2g7Ci0JCWtwbGFuZS0+aHdfY3R4ID0gY3R4OwotCi0JCWlm
IChjaCA9PSBhZGVfZHJpdmVyX2RhdGEucHJpbV9wbGFuZSkKLQkJCXR5cGUgPSBEUk1fUExBTkVf
VFlQRV9QUklNQVJZOwotCQllbHNlCi0JCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsK
LQotCQlyZXQgPSBraXJpbl9kcm1fcGxhbmVfaW5pdChkZXYsIGtwbGFuZSwgdHlwZSwgJmFkZV9k
cml2ZXJfZGF0YSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCS8qIGNydGMg
aW5pdCAqLwotCXByaW1fcGxhbmUgPSBhZGVfZHJpdmVyX2RhdGEucHJpbV9wbGFuZTsKLQlyZXQg
PSBraXJpbl9kcm1fY3J0Y19pbml0KGRldiwgJmtjcnRjLT5iYXNlLAotCQkJCSAgJmFkZS0+cGxh
bmVzW3ByaW1fcGxhbmVdLmJhc2UsCi0JCQkJICAmYWRlX2RyaXZlcl9kYXRhKTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkIGFkZV9od19j
dHhfY2xlYW51cCh2b2lkICpod19jdHgpCiB7CiB9CiAKLXN0YXRpYyB2b2lkIGFkZV9kcm1fY2xl
YW51cChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQotewotfQotCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBhZGVfbW9kZV9jb25maWdfZnVuY3MgPSB7CiAJ
LmZiX2NyZWF0ZSA9IGRybV9nZW1fZmJfY3JlYXRlLAogCS5hdG9taWNfY2hlY2sgPSBkcm1fYXRv
bWljX2hlbHBlcl9jaGVjaywKQEAgLTEwOTgsNyArOTc2LDQgQEAgc3RydWN0IGtpcmluX2RybV9k
YXRhIGFkZV9kcml2ZXJfZGF0YSA9IHsKIAogCS5hbGxvY19od19jdHggPSBhZGVfaHdfY3R4X2Fs
bG9jLAogCS5jbGVhbnVwX2h3X2N0eCA9IGFkZV9od19jdHhfY2xlYW51cCwKLQotCS5pbml0ID0g
YWRlX2RybV9pbml0LAotCS5jbGVhbnVwID0gYWRlX2RybV9jbGVhbnVwCiB9OwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuYwppbmRleCBmNWRmODgz
Nzg1OTEuLmQzMTQ1YWU4NzdkNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNv
bi9raXJpbi9raXJpbl9kcm1fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9r
aXJpbi9raXJpbl9kcm1fZHJ2LmMKQEAgLTI5LDYgKzI5LDEzMCBAQAogCiAjaW5jbHVkZSAia2ly
aW5fZHJtX2Rydi5oIgogCisjZGVmaW5lIEtJUklOX01BWF9QTEFORQkyCisKK3N0cnVjdCBraXJp
bl9kcm1fcHJpdmF0ZSB7CisJc3RydWN0IGtpcmluX2NydGMgY3J0YzsKKwlzdHJ1Y3Qga2lyaW5f
cGxhbmUgcGxhbmVzW0tJUklOX01BWF9QTEFORV07CisJdm9pZCAqaHdfY3R4OworfTsKKworc3Rh
dGljIGludCBraXJpbl9kcm1fY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVj
dCBkcm1fY3J0YyAqY3J0YywKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJ
CSAgICAgICBjb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQoreworCXN0
cnVjdCBkZXZpY2Vfbm9kZSAqcG9ydDsKKwlpbnQgcmV0OworCisJLyogc2V0IGNydGMgcG9ydCBz
byB0aGF0CisJICogZHJtX29mX2ZpbmRfcG9zc2libGVfY3J0Y3MgY2FsbCB3b3JrcworCSAqLwor
CXBvcnQgPSBvZl9nZXRfY2hpbGRfYnlfbmFtZShkZXYtPmRldi0+b2Zfbm9kZSwgInBvcnQiKTsK
KwlpZiAoIXBvcnQpIHsKKwkJRFJNX0VSUk9SKCJubyBwb3J0IG5vZGUgZm91bmQgaW4gJXBPRlxu
IiwgZGV2LT5kZXYtPm9mX25vZGUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJb2Zfbm9kZV9w
dXQocG9ydCk7CisJY3J0Yy0+cG9ydCA9IHBvcnQ7CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dp
dGhfcGxhbmVzKGRldiwgY3J0YywgcGxhbmUsIE5VTEwsCisJCQkJCWRyaXZlcl9kYXRhLT5jcnRj
X2Z1bmNzLCBOVUxMKTsKKwlpZiAocmV0KSB7CisJCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXQg
Y3J0Yy5cbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9jcnRjX2hlbHBlcl9hZGQoY3J0
YywgZHJpdmVyX2RhdGEtPmNydGNfaGVscGVyX2Z1bmNzKTsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgaW50IGtpcmluX2RybV9wbGFuZV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0
cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCWVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSwKKwkJ
CQljb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRhdGEpCit7CisJaW50IHJldCA9IDA7CisK
KwlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoZGV2LCBwbGFuZSwgMSwgZGF0YS0+cGxh
bmVfZnVuY3MsCisJCQkJICAgICAgIGRhdGEtPmNoYW5uZWxfZm9ybWF0cywKKwkJCQkgICAgICAg
ZGF0YS0+Y2hhbm5lbF9mb3JtYXRzX2NudCwKKwkJCQkgICAgICAgTlVMTCwgdHlwZSwgTlVMTCk7
CisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoImZhaWwgdG8gaW5pdCBwbGFuZSwgY2g9JWRcbiIs
IDApOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9wbGFuZV9oZWxwZXJfYWRkKHBsYW5lLCBk
YXRhLT5wbGFuZV9oZWxwZXJfZnVuY3MpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lk
IGtpcmluX2RybV9wcml2YXRlX2NsZWFudXAoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwlz
dHJ1Y3Qga2lyaW5fZHJtX3ByaXZhdGUgKmtpcmluX3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOwor
CXN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZGF0YTsKKworCWRhdGEgPSAoc3RydWN0IGtpcmluX2Ry
bV9kYXRhICopb2ZfZGV2aWNlX2dldF9tYXRjaF9kYXRhKGRldi0+ZGV2KTsKKwlpZiAoZGF0YS0+
Y2xlYW51cF9od19jdHgpCisJCWRhdGEtPmNsZWFudXBfaHdfY3R4KGtpcmluX3ByaXYtPmh3X2N0
eCk7CisKKwlkZXZtX2tmcmVlKGRldi0+ZGV2LCBraXJpbl9wcml2KTsKKwlkZXYtPmRldl9wcml2
YXRlID0gTlVMTDsKK30KKworc3RhdGljIGludCBraXJpbl9kcm1fcHJpdmF0ZV9pbml0KHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsCisJCQkJICBjb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRy
aXZlcl9kYXRhKQoreworCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYgPSB0b19wbGF0Zm9y
bV9kZXZpY2UoZGV2LT5kZXYpOworCXN0cnVjdCBraXJpbl9kcm1fcHJpdmF0ZSAqa2lyaW5fcHJp
djsKKwlzdHJ1Y3QgZHJtX3BsYW5lICpwcmltX3BsYW5lOworCWVudW0gZHJtX3BsYW5lX3R5cGUg
dHlwZTsKKwl2b2lkICpjdHg7CisJaW50IHJldDsKKwl1MzIgY2g7CisKKwlraXJpbl9wcml2ID0g
ZGV2bV9remFsbG9jKGRldi0+ZGV2LCBzaXplb2YoKmtpcmluX3ByaXYpLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWtpcmluX3ByaXYpIHsKKwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2Mga2lyaW5f
ZHJtX3ByaXZhdGVcbiIpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwljdHggPSBkcml2ZXJf
ZGF0YS0+YWxsb2NfaHdfY3R4KHBkZXYsICZraXJpbl9wcml2LT5jcnRjLmJhc2UpOworCWlmIChJ
U19FUlIoY3R4KSkgeworCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIGtpcmluX3By
aXYgaHcgY3R4XG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCWtpcmluX3ByaXYtPmh3X2N0
eCA9IGN0eDsKKworCS8qCisJICogcGxhbmUgaW5pdAorCSAqIFRPRE86IE5vdyBvbmx5IHN1cHBv
cnQgcHJpbWFyeSBwbGFuZSwgb3ZlcmxheSBwbGFuZXMKKwkgKiBuZWVkIHRvIGRvLgorCSAqLwor
CWZvciAoY2ggPSAwOyBjaCA8IGRyaXZlcl9kYXRhLT5udW1fcGxhbmVzOyBjaCsrKSB7CisJCWlm
IChjaCA9PSBkcml2ZXJfZGF0YS0+cHJpbV9wbGFuZSkKKwkJCXR5cGUgPSBEUk1fUExBTkVfVFlQ
RV9QUklNQVJZOworCQllbHNlCisJCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKKwkJ
cmV0ID0ga2lyaW5fZHJtX3BsYW5lX2luaXQoZGV2LCAma2lyaW5fcHJpdi0+cGxhbmVzW2NoXS5i
YXNlLAorCQkJCQkgICB0eXBlLCBkcml2ZXJfZGF0YSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4g
cmV0OworCQlraXJpbl9wcml2LT5wbGFuZXNbY2hdLmNoID0gY2g7CisJCWtpcmluX3ByaXYtPnBs
YW5lc1tjaF0uaHdfY3R4ID0gY3R4OworCX0KKworCS8qIGNydGMgaW5pdCAqLworCXByaW1fcGxh
bmUgPSAma2lyaW5fcHJpdi0+cGxhbmVzW2RyaXZlcl9kYXRhLT5wcmltX3BsYW5lXS5iYXNlOwor
CXJldCA9IGtpcmluX2RybV9jcnRjX2luaXQoZGV2LCAma2lyaW5fcHJpdi0+Y3J0Yy5iYXNlLAor
CQkJCSAgcHJpbV9wbGFuZSwgZHJpdmVyX2RhdGEpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CisJa2lyaW5fcHJpdi0+Y3J0Yy5od19jdHggPSBjdHg7CisJZGV2LT5kZXZfcHJpdmF0ZSA9IGtp
cmluX3ByaXY7CisKKwlyZXR1cm4gMDsKK30KIAogc3RhdGljIGludCBraXJpbl9kcm1fa21zX2lu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBraXJpbl9k
cm1fZGF0YSAqZHJpdmVyX2RhdGEpCkBAIC00NCw3ICsxNjgsNyBAQCBzdGF0aWMgaW50IGtpcmlu
X2RybV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWRldi0+bW9kZV9jb25maWcu
ZnVuY3MgPSBkcml2ZXJfZGF0YS0+bW9kZV9jb25maWdfZnVuY3M7CiAKIAkvKiBkaXNwbGF5IGNv
bnRyb2xsZXIgaW5pdCAqLwotCXJldCA9IGRyaXZlcl9kYXRhLT5pbml0KHRvX3BsYXRmb3JtX2Rl
dmljZShkZXYtPmRldikpOworCXJldCA9IGtpcmluX2RybV9wcml2YXRlX2luaXQoZGV2LCBkcml2
ZXJfZGF0YSk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJfbW9kZV9jb25maWdfY2xlYW51cDsKIApA
QCAtNTIsNyArMTc2LDcgQEAgc3RhdGljIGludCBraXJpbl9kcm1fa21zX2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAlyZXQgPSBjb21wb25lbnRfYmluZF9hbGwoZGV2LT5kZXYsIGRldik7
CiAJaWYgKHJldCkgewogCQlEUk1fRVJST1IoImZhaWxlZCB0byBiaW5kIGFsbCBjb21wb25lbnQu
XG4iKTsKLQkJZ290byBlcnJfZGNfY2xlYW51cDsKKwkJZ290byBlcnJfcHJpdmF0ZV9jbGVhbnVw
OwogCX0KIAogCS8qIHZibGFuayBpbml0ICovCkBAIC03NCwxMSArMTk4LDEwIEBAIHN0YXRpYyBp
bnQga2lyaW5fZHJtX2ttc19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAKIGVycl91bmJp
bmRfYWxsOgogCWNvbXBvbmVudF91bmJpbmRfYWxsKGRldi0+ZGV2LCBkZXYpOwotZXJyX2RjX2Ns
ZWFudXA6Ci0JZHJpdmVyX2RhdGEtPmNsZWFudXAodG9fcGxhdGZvcm1fZGV2aWNlKGRldi0+ZGV2
KSk7CitlcnJfcHJpdmF0ZV9jbGVhbnVwOgorCWtpcmluX2RybV9wcml2YXRlX2NsZWFudXAoZGV2
KTsKIGVycl9tb2RlX2NvbmZpZ19jbGVhbnVwOgogCWRybV9tb2RlX2NvbmZpZ19jbGVhbnVwKGRl
dik7Ci0KIAlyZXR1cm4gcmV0OwogfQogCkBAIC04OSwxNCArMjEyLDggQEAgc3RhdGljIGludCBj
b21wYXJlX29mKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqZGF0YSkKIAogc3RhdGljIGludCBr
aXJpbl9kcm1fa21zX2NsZWFudXAoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQljb25zdCBz
dHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhOwotCiAJZHJtX2ttc19oZWxwZXJfcG9s
bF9maW5pKGRldik7Ci0KLQlkcml2ZXJfZGF0YSA9IG9mX2RldmljZV9nZXRfbWF0Y2hfZGF0YShk
ZXYtPmRldik7Ci0JaWYgKGRyaXZlcl9kYXRhLT5jbGVhbnVwKQotCQlkcml2ZXJfZGF0YS0+Y2xl
YW51cCh0b19wbGF0Zm9ybV9kZXZpY2UoZGV2LT5kZXYpKTsKLQorCWtpcmluX2RybV9wcml2YXRl
X2NsZWFudXAoZGV2KTsKIAlkcm1fbW9kZV9jb25maWdfY2xlYW51cChkZXYpOwogCiAJcmV0dXJu
IDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2Ry
bV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5o
CmluZGV4IDE2NjM2MTBkMmNkOC4uNGQ1YzA1YTI0MDY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuaApAQCAtNyw4ICs3LDYgQEAKICNpZm5k
ZWYgX19LSVJJTl9EUk1fRFJWX0hfXwogI2RlZmluZSBfX0tJUklOX0RSTV9EUlZfSF9fCiAKLSNk
ZWZpbmUgTUFYX0NSVEMJMgotCiAjZGVmaW5lIHRvX2tpcmluX2NydGMoY3J0YykgXAogCWNvbnRh
aW5lcl9vZihjcnRjLCBzdHJ1Y3Qga2lyaW5fY3J0YywgYmFzZSkKIApAQCAtNTMsOSArNTEsNiBA
QCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgewogCXZvaWQgKigqYWxsb2NfaHdfY3R4KShzdHJ1Y3Qg
cGxhdGZvcm1fZGV2aWNlICpwZGV2LAogCQkJICAgICAgc3RydWN0IGRybV9jcnRjICpjcnRjKTsK
IAl2b2lkICgqY2xlYW51cF9od19jdHgpKHZvaWQgKmh3X2N0eCk7Ci0KLQlpbnQgKCppbml0KShz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKLQl2b2lkICgqY2xlYW51cCkoc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldik7CiB9OwogCiBleHRlcm4gc3RydWN0IGtpcmluX2RybV9kYXRh
IGFkZV9kcml2ZXJfZGF0YTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
