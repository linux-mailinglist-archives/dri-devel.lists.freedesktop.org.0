Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EA4D710FFD8
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 15:15:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0DCC16E5EE;
	Tue,  3 Dec 2019 14:15:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C57E36E5DD
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 14:15:26 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id DC4A9290572;
 Tue,  3 Dec 2019 14:15:24 +0000 (GMT)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 03/11] drm: Stop accessing encoder->bridge directly
Date: Tue,  3 Dec 2019 15:15:07 +0100
Message-Id: <20191203141515.3597631-4-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203141515.3597631-1-boris.brezillon@collabora.com>
References: <20191203141515.3597631-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2UgYXJlIGFib3V0IHRvIHJlcGxhY2UgdGhlIHNpbmdsZS1saW5rZWQgYnJpZGdlIGxpc3QgYnkg
YSBkb3VibGUtbGlua2VkCm9uZSBiYXNlZCBvbiBsaXN0LmgsIGxlYWRpbmcgdG8gdGhlIHN1cHBy
ZXNzaW9uIG9mIHRoZSBlbmNvZGVyLT5icmlkZ2UKZmllbGQuIEJ1dCBiZWZvcmUgd2UgY2FuIGRv
IHRoYXQgd2UgbXVzdCBwcm92aWRlIGEKZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdl
KCkgYnJpZGdlIGhlbHBlciBhbmQgcGF0Y2ggYWxsIGRyaXZlcnMKYW5kIGNvcmUgaGVscGVycyB0
byB1c2UgaXQgaW5zdGVhZCBvZiBkaXJlY3RseSBhY2Nlc3NpbmcgZW5jb2Rlci0+YnJpZGdlLgoK
Tm90ZSB0aGF0IHdlIHN0aWxsIGhhdmUgMiBkcml2ZXJzIChWQzQgYW5kIEV4eW5vcykgbWFuaXB1
bGF0aW5nIHRoZQplbmNvZGVyLT5icmlkZ2UgZmllbGQgZGlyZWN0bHkgYmVjYXVzZSB0aGV5IG5l
ZWQgdG8gY3V0IHRoZSBicmlkZ2UgY2hhaW4KaW4gb3JkZXIgdG8gY29udHJvbCB0aGUgZW5hYmxl
L2Rpc2FibGUgc2VxdWVuY2UuIFRoaXMgaXMgZGVmaW5pdGVseQpub3Qgc29tZXRoaW5nIHdlIHdh
bnQgdG8gZW5jb3VyYWdlLCBzbyBsZXQncyBrZWVwIHRob3NlIDIgb2RkaXRpZXMKYXJvdW5kIHVu
dGlsIHdlIGZpbmQgYSBiZXR0ZXIgc29sdXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBCb3JpcyBCcmV6
aWxsb24gPGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgpSZXZpZXdlZC1ieTogTGF1cmVu
dCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgpSZXZpZXdlZC1i
eTogTmVpbCBBcm1zdHJvbmcgPG5hcm1zdHJvbmdAYmF5bGlicmUuY29tPgotLS0KQ2hhbmdlcyBp
biB2NDoKKiBDb2Rpbmcgc3R5bGUgaXNzdWVzCiogQWRkIFJicwoqIEFkanVzdCB0aGUgY29tbWl0
IG1lc3NhZ2UgdG8gZXhwbGFpbiB3aHkgVkM0IGFuZCBleHlub3Mgc3RpbGwKICBhY2Nlc3MgZW5j
b2Rlci0+YnJpZGdlIGRpcmVjdGx5CgpDaGFuZ2VzIGluIHYzOgoqIE5vbmUKCkNoYW5nZXMgaW4g
djI6CiogTm9uZQotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jICAgIHwg
MjYgKysrKysrKysrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZW5jb2Rl
ci5jICAgICAgICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5j
ICAgICB8ICA0ICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYyAgIHwg
MTAgKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMgfCAx
MCArKysrKysrLS0tCiBpbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggICAgICAgICAgICAgICB8IDE1
ICsrKysrKysrKysrKysrKwogNiBmaWxlcyBjaGFuZ2VkLCA1MiBpbnNlcnRpb25zKCspLCAxNiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxw
ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCmluZGV4IGNmNjc4YmU1
OGZhNC4uMjljMzExNWJmOWUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21p
Y19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwpAQCAt
NDE5LDYgKzQxOSw3IEBAIG1vZGVfZml4dXAoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgbmV3
X2Nvbm5fc3RhdGUsIGkpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2hlbHBlcl9mdW5j
cyAqZnVuY3M7CiAJCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwkJc3RydWN0IGRybV9i
cmlkZ2UgKmJyaWRnZTsKIAogCQlXQVJOX09OKCEhbmV3X2Nvbm5fc3RhdGUtPmJlc3RfZW5jb2Rl
ciAhPSAhIW5ld19jb25uX3N0YXRlLT5jcnRjKTsKIApAQCAtNDM1LDcgKzQzNiw4IEBAIG1vZGVf
Zml4dXAoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQllbmNvZGVyID0gbmV3X2Nv
bm5fc3RhdGUtPmJlc3RfZW5jb2RlcjsKIAkJZnVuY3MgPSBlbmNvZGVyLT5oZWxwZXJfcHJpdmF0
ZTsKIAotCQlyZXQgPSBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoZW5jb2Rlci0+YnJpZGdl
LAorCQlicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7
CisJCXJldCA9IGRybV9icmlkZ2VfY2hhaW5fbW9kZV9maXh1cChicmlkZ2UsCiAJCQkJCSZuZXdf
Y3J0Y19zdGF0ZS0+bW9kZSwKIAkJCQkJJm5ld19jcnRjX3N0YXRlLT5hZGp1c3RlZF9tb2RlKTsK
IAkJaWYgKCFyZXQpIHsKQEAgLTQ5Myw2ICs0OTUsNyBAQCBzdGF0aWMgZW51bSBkcm1fbW9kZV9z
dGF0dXMgbW9kZV92YWxpZF9wYXRoKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJ
CQkJCSAgICBzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbW9kZSkKIHsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOwogCWVu
dW0gZHJtX21vZGVfc3RhdHVzIHJldDsKIAogCXJldCA9IGRybV9lbmNvZGVyX21vZGVfdmFsaWQo
ZW5jb2RlciwgbW9kZSk7CkBAIC01MDIsNyArNTA1LDggQEAgc3RhdGljIGVudW0gZHJtX21vZGVf
c3RhdHVzIG1vZGVfdmFsaWRfcGF0aChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAog
CQlyZXR1cm4gcmV0OwogCX0KIAotCXJldCA9IGRybV9icmlkZ2VfY2hhaW5fbW9kZV92YWxpZChl
bmNvZGVyLT5icmlkZ2UsIG1vZGUpOworCWJyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X2Zp
cnN0X2JyaWRnZShlbmNvZGVyKTsKKwlyZXQgPSBkcm1fYnJpZGdlX2NoYWluX21vZGVfdmFsaWQo
YnJpZGdlLCBtb2RlKTsKIAlpZiAocmV0ICE9IE1PREVfT0spIHsKIAkJRFJNX0RFQlVHX0FUT01J
QygiW0JSSURHRV0gbW9kZV92YWxpZCgpIGZhaWxlZFxuIik7CiAJCXJldHVybiByZXQ7CkBAIC05
ODUsNiArOTg5LDcgQEAgZGlzYWJsZV9vdXRwdXRzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiAJZm9yX2VhY2hfb2xkbmV3X2Nvbm5l
Y3Rvcl9pbl9zdGF0ZShvbGRfc3RhdGUsIGNvbm5lY3Rvciwgb2xkX2Nvbm5fc3RhdGUsIG5ld19j
b25uX3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3Mg
KmZ1bmNzOwogCQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisJCXN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2U7CiAKIAkJLyogU2h1dCBkb3duIGV2ZXJ5dGhpbmcgdGhhdCdzIGluIHRoZSBj
aGFuZ2VzZXQgYW5kIGN1cnJlbnRseQogCQkgKiBzdGlsbCBvbi4gU28gbmVlZCB0byBjaGVjayB0
aGUgb2xkLCBzYXZlZCBzdGF0ZS4gKi8KQEAgLTEwMjEsNyArMTAyNiw4IEBAIGRpc2FibGVfb3V0
cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xk
X3N0YXRlKQogCQkgKiBFYWNoIGVuY29kZXIgaGFzIGF0IG1vc3Qgb25lIGNvbm5lY3RvciAoc2lu
Y2Ugd2UgYWx3YXlzIHN0ZWFsCiAJCSAqIGl0IGF3YXkpLCBzbyB3ZSB3b24ndCBjYWxsIGRpc2Fi
bGUgaG9va3MgdHdpY2UuCiAJCSAqLwotCQlkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9kaXNhYmxl
KGVuY29kZXItPmJyaWRnZSwgb2xkX3N0YXRlKTsKKwkJYnJpZGdlID0gZHJtX2JyaWRnZV9jaGFp
bl9nZXRfZmlyc3RfYnJpZGdlKGVuY29kZXIpOworCQlkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9k
aXNhYmxlKGJyaWRnZSwgb2xkX3N0YXRlKTsKIAogCQkvKiBSaWdodCBmdW5jdGlvbiBkZXBlbmRz
IHVwb24gdGFyZ2V0IHN0YXRlLiAqLwogCQlpZiAoZnVuY3MpIHsKQEAgLTEwMzUsOCArMTA0MSw3
IEBAIGRpc2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCQkJCWZ1bmNzLT5kcG1zKGVuY29kZXIsIERSTV9NT0RF
X0RQTVNfT0ZGKTsKIAkJfQogCi0JCWRybV9hdG9taWNfYnJpZGdlX2NoYWluX3Bvc3RfZGlzYWJs
ZShlbmNvZGVyLT5icmlkZ2UsCi0JCQkJCQkgICAgIG9sZF9zdGF0ZSk7CisJCWRybV9hdG9taWNf
YnJpZGdlX2NoYWluX3Bvc3RfZGlzYWJsZShicmlkZ2UsIG9sZF9zdGF0ZSk7CiAJfQogCiAJZm9y
X2VhY2hfb2xkbmV3X2NydGNfaW5fc3RhdGUob2xkX3N0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0
ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKQEAgLTExOTAsNiArMTE5NSw3IEBAIGNydGNfc2V0X21v
ZGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9z
dGF0ZSkKIAkJY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2hlbHBlcl9mdW5jcyAqZnVuY3M7CiAJ
CXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKIAkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsICphZGp1c3RlZF9tb2RlOworCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOwogCiAJ
CWlmICghbmV3X2Nvbm5fc3RhdGUtPmJlc3RfZW5jb2RlcikKIAkJCWNvbnRpbnVlOwpAQCAtMTIx
Nyw4ICsxMjIzLDggQEAgY3J0Y19zZXRfbW9kZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCQkJZnVuY3MtPm1vZGVfc2V0KGVuY29k
ZXIsIG1vZGUsIGFkanVzdGVkX21vZGUpOwogCQl9CiAKLQkJZHJtX2JyaWRnZV9jaGFpbl9tb2Rl
X3NldChlbmNvZGVyLT5icmlkZ2UsIG1vZGUsCi0JCQkJCSAgYWRqdXN0ZWRfbW9kZSk7CisJCWJy
aWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShlbmNvZGVyKTsKKwkJZHJt
X2JyaWRnZV9jaGFpbl9tb2RlX3NldChicmlkZ2UsIG1vZGUsIGFkanVzdGVkX21vZGUpOwogCX0K
IH0KIApAQCAtMTMxNyw2ICsxMzIzLDcgQEAgdm9pZCBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRf
bW9kZXNldF9lbmFibGVzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJZm9yX2VhY2hfbmV3X2Nv
bm5lY3Rvcl9pbl9zdGF0ZShvbGRfc3RhdGUsIGNvbm5lY3RvciwgbmV3X2Nvbm5fc3RhdGUsIGkp
IHsKIAkJY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2hlbHBlcl9mdW5jcyAqZnVuY3M7CiAJCXN0
cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsK
IAogCQlpZiAoIW5ld19jb25uX3N0YXRlLT5iZXN0X2VuY29kZXIpCiAJCQljb250aW51ZTsKQEAg
LTEzMzUsNyArMTM0Miw4IEBAIHZvaWQgZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X21vZGVzZXRf
ZW5hYmxlcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgKiBFYWNoIGVuY29kZXIgaGFzIGF0
IG1vc3Qgb25lIGNvbm5lY3RvciAoc2luY2Ugd2UgYWx3YXlzIHN0ZWFsCiAJCSAqIGl0IGF3YXkp
LCBzbyB3ZSB3b24ndCBjYWxsIGVuYWJsZSBob29rcyB0d2ljZS4KIAkJICovCi0JCWRybV9hdG9t
aWNfYnJpZGdlX2NoYWluX3ByZV9lbmFibGUoZW5jb2Rlci0+YnJpZGdlLCBvbGRfc3RhdGUpOwor
CQlicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7CisJ
CWRybV9hdG9taWNfYnJpZGdlX2NoYWluX3ByZV9lbmFibGUoYnJpZGdlLCBvbGRfc3RhdGUpOwog
CiAJCWlmIChmdW5jcykgewogCQkJaWYgKGZ1bmNzLT5hdG9taWNfZW5hYmxlKQpAQCAtMTM0Niw3
ICsxMzU0LDcgQEAgdm9pZCBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfbW9kZXNldF9lbmFibGVz
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJZnVuY3MtPmNvbW1pdChlbmNvZGVyKTsKIAkJ
fQogCi0JCWRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZShlbmNvZGVyLT5icmlkZ2UsIG9s
ZF9zdGF0ZSk7CisJCWRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZShicmlkZ2UsIG9sZF9z
dGF0ZSk7CiAJfQogCiAJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X3dyaXRlYmFja3MoZGV2LCBv
bGRfc3RhdGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2VuY29kZXIuYwppbmRleCBmY2QzYWYxYWM0MzIuLmEyY2M3ZTcy
NDFhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMKQEAgLTE2Nyw5ICsxNjcsMTAgQEAgdm9pZCBkcm1f
ZW5jb2Rlcl9jbGVhbnVwKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAkgKi8KIAogCWlm
IChlbmNvZGVyLT5icmlkZ2UpIHsKLQkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9IGVuY29k
ZXItPmJyaWRnZTsKKwkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKIAkJc3RydWN0IGRybV9i
cmlkZ2UgKm5leHQ7CiAKKwkJYnJpZGdlID0gZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJp
ZGdlKGVuY29kZXIpOwogCQl3aGlsZSAoYnJpZGdlKSB7CiAJCQluZXh0ID0gZHJtX2JyaWRnZV9n
ZXRfbmV4dF9icmlkZ2UoYnJpZGdlKTsKIAkJCWRybV9icmlkZ2VfZGV0YWNoKGJyaWRnZSk7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5jIGIvZHJpdmVycy9n
cHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYwppbmRleCBjM2VhNzIyMDY1YzQuLjU3NmI0YjdkY2Q4
OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5jCkBAIC0xMDEsNiArMTAxLDcgQEAgZHJt
X21vZGVfdmFsaWRhdGVfcGlwZWxpbmUoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAK
IAkvKiBTdGVwIDI6IFZhbGlkYXRlIGFnYWluc3QgZW5jb2RlcnMgYW5kIGNydGNzICovCiAJZHJt
X2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2Rlcikg
eworCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOwogCQlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7
CiAKIAkJcmV0ID0gZHJtX2VuY29kZXJfbW9kZV92YWxpZChlbmNvZGVyLCBtb2RlKTsKQEAgLTEx
Miw3ICsxMTMsOCBAQCBkcm1fbW9kZV92YWxpZGF0ZV9waXBlbGluZShzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZSwKIAkJCWNvbnRpbnVlOwogCQl9CiAKLQkJcmV0ID0gZHJtX2JyaWRnZV9j
aGFpbl9tb2RlX3ZhbGlkKGVuY29kZXItPmJyaWRnZSwgbW9kZSk7CisJCWJyaWRnZSA9IGRybV9i
cmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShlbmNvZGVyKTsKKwkJcmV0ID0gZHJtX2JyaWRn
ZV9jaGFpbl9tb2RlX3ZhbGlkKGJyaWRnZSwgbW9kZSk7CiAJCWlmIChyZXQgIT0gTU9ERV9PSykg
ewogCQkJLyogVGhlcmUgaXMgYWxzbyBubyBwb2ludCBpbiBjb250aW51aW5nIGZvciBjcnRjIGNo
ZWNrCiAJCQkgKiBoZXJlLiAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAv
ZWRwX2JyaWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRwX2JyaWRnZS5jCmluZGV4
IDI5NTBiYmE0YWNhOS4uYjY1YjVjYzJkYmEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
bXNtL2VkcC9lZHBfYnJpZGdlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRwX2Jy
aWRnZS5jCkBAIC01NSw4ICs1NSwxNCBAQCBzdGF0aWMgdm9pZCBlZHBfYnJpZGdlX21vZGVfc2V0
KHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJREJHKCJzZXQgbW9kZTogIiBEUk1fTU9ERV9G
TVQsIERSTV9NT0RFX0FSRyhtb2RlKSk7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KGNvbm5lY3Rv
ciwgJmRldi0+bW9kZV9jb25maWcuY29ubmVjdG9yX2xpc3QsIGhlYWQpIHsKLQkJaWYgKChjb25u
ZWN0b3ItPmVuY29kZXIgIT0gTlVMTCkgJiYKLQkJCShjb25uZWN0b3ItPmVuY29kZXItPmJyaWRn
ZSA9PSBicmlkZ2UpKSB7CisJCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciA9IGNvbm5lY3Rv
ci0+ZW5jb2RlcjsKKwkJc3RydWN0IGRybV9icmlkZ2UgKmZpcnN0X2JyaWRnZTsKKworCQlpZiAo
IWNvbm5lY3Rvci0+ZW5jb2RlcikKKwkJCWNvbnRpbnVlOworCisJCWZpcnN0X2JyaWRnZSA9IGRy
bV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShlbmNvZGVyKTsKKwkJaWYgKGJyaWRnZSA9
PSBmaXJzdF9icmlkZ2UpIHsKIAkJCW1zbV9lZHBfY3RybF90aW1pbmdfY2ZnKGVkcC0+Y3RybCwK
IAkJCQlhZGp1c3RlZF9tb2RlLCAmY29ubmVjdG9yLT5kaXNwbGF5X2luZm8pOwogCQkJYnJlYWs7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5jCmluZGV4IDJkYTQ2ZTNkYzRhZS4u
ZjJhZTRjNDEwMjQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2NydGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYwpAQCAt
MTQsNiArMTQsNyBAQAogCiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxk
cm0vZHJtX2F0b21pY19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2JyaWRnZS5oPgogI2lu
Y2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgogI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CiAjaW5j
bHVkZSA8ZHJtL2RybV9mYl9jbWFfaGVscGVyLmg+CkBAIC02ODAsOSArNjgxLDEwIEBAIHN0YXRp
YyB2b2lkIHJjYXJfZHVfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IAkJCXJjZHUtPmVuY29kZXJzW1JDQVJfRFVfT1VUUFVUX0xWRFMwICsgcmNydGMtPmluZGV4XTsK
IAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPQogCQkJJmNydGMtPnN0YXRl
LT5hZGp1c3RlZF9tb2RlOworCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOwogCi0JCXJjYXJf
bHZkc19jbGtfZW5hYmxlKGVuY29kZXItPmJhc2UuYnJpZGdlLAotCQkJCSAgICAgbW9kZS0+Y2xv
Y2sgKiAxMDAwKTsKKwkJYnJpZGdlID0gZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdl
KCZlbmNvZGVyLT5iYXNlKTsKKwkJcmNhcl9sdmRzX2Nsa19lbmFibGUoYnJpZGdlLCBtb2RlLT5j
bG9jayAqIDEwMDApOwogCX0KIAogCXJjYXJfZHVfY3J0Y19zdGFydChyY3J0Yyk7CkBAIC03MDIs
MTIgKzcwNCwxNCBAQCBzdGF0aWMgdm9pZCByY2FyX2R1X2NydGNfYXRvbWljX2Rpc2FibGUoc3Ry
dWN0IGRybV9jcnRjICpjcnRjLAogCSAgICByc3RhdGUtPm91dHB1dHMgPT0gQklUKFJDQVJfRFVf
T1VUUFVUX0RQQUQwKSkgewogCQlzdHJ1Y3QgcmNhcl9kdV9lbmNvZGVyICplbmNvZGVyID0KIAkJ
CXJjZHUtPmVuY29kZXJzW1JDQVJfRFVfT1VUUFVUX0xWRFMwICsgcmNydGMtPmluZGV4XTsKKwkJ
c3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKIAogCQkvKgogCQkgKiBEaXNhYmxlIHRoZSBMVkRT
IGNsb2NrIG91dHB1dCwgc2VlCiAJCSAqIHJjYXJfZHVfY3J0Y19hdG9taWNfZW5hYmxlKCkuCiAJ
CSAqLwotCQlyY2FyX2x2ZHNfY2xrX2Rpc2FibGUoZW5jb2Rlci0+YmFzZS5icmlkZ2UpOworCQli
cmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoJmVuY29kZXItPmJhc2Up
OworCQlyY2FyX2x2ZHNfY2xrX2Rpc2FibGUoYnJpZGdlKTsKIAl9CiAKIAlzcGluX2xvY2tfaXJx
KCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2Jy
aWRnZS5oIGIvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCmluZGV4IDQ2ZmMxN2M2M2E0NC4uYmQ3
OGMyNTZiMWVkIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKKysrIGIvaW5j
bHVkZS9kcm0vZHJtX2JyaWRnZS5oCkBAIC0yNSw2ICsyNSw3IEBACiAKICNpbmNsdWRlIDxsaW51
eC9saXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvY3R5cGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Vu
Y29kZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX21vZGVfb2JqZWN0Lmg+CiAjaW5jbHVkZSA8ZHJt
L2RybV9tb2Rlcy5oPgogCkBAIC00MjIsNiArNDIzLDIwIEBAIGRybV9icmlkZ2VfZ2V0X25leHRf
YnJpZGdlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJcmV0dXJuIGJyaWRnZS0+bmV4dDsK
IH0KIAorLyoqCisgKiBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoKSAtIEdldCB0
aGUgZmlyc3QgYnJpZGdlIGluIHRoZSBjaGFpbgorICogQGVuY29kZXI6IGVuY29kZXIgb2JqZWN0
CisgKgorICogUkVUVVJOUzoKKyAqIHRoZSBmaXJzdCBicmlkZ2UgaW4gdGhlIGNoYWluLCBvciBO
VUxMIGlmIEBlbmNvZGVyIGhhcyBubyBicmlkZ2UgYXR0YWNoZWQKKyAqIHRvIGl0LgorICovCitz
dGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlICoKK2RybV9icmlkZ2VfY2hhaW5fZ2V0X2Zp
cnN0X2JyaWRnZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCit7CisJcmV0dXJuIGVuY29k
ZXItPmJyaWRnZTsKK30KKwogYm9vbCBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsCiAJCQkJIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKTsKLS0g
CjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
