Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AA511E1FDD
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:46:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5CC8D6EB2D;
	Wed, 23 Oct 2019 15:46:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E86516E10B
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:32 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 1F33528F911;
 Wed, 23 Oct 2019 16:45:31 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 16/21] drm/bridge: lvds-encoder: Implement basic bus format
 negotiation
Date: Wed, 23 Oct 2019 17:45:07 +0200
Message-Id: <20191023154512.9762-17-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U29tZSBMVkRTIGVuY29kZXIgbWlnaHQgc3VwcG9ydCBzZXZlcmFsIGlucHV0L291dHB1dCBidXMg
Zm9ybWF0cy4gQWRkCmEgd2F5IHRvIGRlc2NyaWJlIHRoZSBvbmUgdXNlZCBvbiBhIHNwZWNpZmlj
IGRlc2lnbiBieSBhZGRpbmcgb3B0aW9uYWwKJ2RhdGEtbWFwcGluZycgcHJvcGVydGllcyB0byB0
aGUgaW5wdXQvb3V0cHV0IHBvcnRzLgoKU2lnbmVkLW9mZi1ieTogQm9yaXMgQnJlemlsbG9uIDxi
b3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4KLS0tCkNoYW5nZXMgaW4gdjM6CiogVXNlIGJ1
cy13aWR0aCBmb3IgdGhlIHJnYjI0L3JnYjE4IGRpc3RpbmN0aW9uCiogQWRqdXN0IGNvZGUgdG8g
bWF0Y2ggY29yZSBjaGFuZ2VzCiogR2V0IHJpZCBvZiBvZl9nZXRfZGF0YV9tYXBwaW5nKCkKKiBE
b24ndCBpbXBsZW1lbnQgLT5hdG9taWNfY2hlY2soKSAodGhlIGNvcmUgbm93IHRha2VzIGNhcmUg
b2YgYnVzCiAgZmxhZ3MgcHJvcGFnYXRpb24pCgpDaGFuZ2VzIGluIHYyOgoqIE1ha2UgdGhlIGJ1
cy1mb3JtYXQgbmVnb3RpYXRpb24gbG9naWMgbW9yZSBnZW5lcmljCi0tLQogZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9sdmRzLWVuY29kZXIuYyB8IDcyICsrKysrKysrKysrKysrKysrKysrKysrKysr
KwogMSBmaWxlIGNoYW5nZWQsIDcyIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYnJpZGdlL2x2ZHMtZW5jb2Rlci5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9s
dmRzLWVuY29kZXIuYwppbmRleCBlMjEzMmE4ZDUxMDYuLmEyYThmN2Y0YWM5NyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9sdmRzLWVuY29kZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYnJpZGdlL2x2ZHMtZW5jb2Rlci5jCkBAIC02LDYgKzYsNyBAQAogI2luY2x1ZGUgPGxp
bnV4L2dwaW8vY29uc3VtZXIuaD4KICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRl
IDxsaW51eC9vZi5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgogI2luY2x1ZGUgPGxp
bnV4L29mX2dyYXBoLmg+CiAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CiAKQEAg
LTE2LDYgKzE3LDggQEAgc3RydWN0IGx2ZHNfZW5jb2RlciB7CiAJc3RydWN0IGRybV9icmlkZ2Ug
YnJpZGdlOwogCXN0cnVjdCBkcm1fYnJpZGdlICpwYW5lbF9icmlkZ2U7CiAJc3RydWN0IGdwaW9f
ZGVzYyAqcG93ZXJkb3duX2dwaW87CisJdTMyIG91dHB1dF9mbXQ7CisJdTMyIGlucHV0X2ZtdDsK
IH07CiAKIHN0YXRpYyBpbnQgbHZkc19lbmNvZGVyX2F0dGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlKQpAQCAtNDgsMTAgKzUxLDQwIEBAIHN0YXRpYyB2b2lkIGx2ZHNfZW5jb2Rlcl9kaXNh
YmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVl
cChsdmRzX2VuY29kZXItPnBvd2VyZG93bl9ncGlvLCAxKTsKIH0KIAorc3RhdGljIHUzMiAqbHZk
c19hdG9taWNfZ2V0X2lucHV0X2J1c19mbXRzKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJ
CQkJCSAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGUsCisJCQkJCSAgIHN0
cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICAgc3RydWN0IGRybV9jb25u
ZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsCisJCQkJCSAgIHUzMiBvdXRwdXRfZm10LAorCQkJCQkg
ICB1bnNpZ25lZCBpbnQgKm51bV9pbnB1dF9mbXRzKQoreworCXN0cnVjdCBsdmRzX2VuY29kZXIg
Kmx2ZHNfZW5jb2RlciA9IGNvbnRhaW5lcl9vZihicmlkZ2UsCisJCQkJCQkJIHN0cnVjdCBsdmRz
X2VuY29kZXIsCisJCQkJCQkJIGJyaWRnZSk7CisJdTMyICppbnB1dF9mbXRzOworCisJaWYgKG91
dHB1dF9mbXQgPT0gTUVESUFfQlVTX0ZNVF9GSVhFRCB8fAorCSAgICBvdXRwdXRfZm10ID09IGx2
ZHNfZW5jb2Rlci0+b3V0cHV0X2ZtdCkKKwkJKm51bV9pbnB1dF9mbXRzID0gMTsKKwllbHNlCisJ
CSpudW1faW5wdXRfZm10cyA9IDA7CisKKwlpZiAoISpudW1faW5wdXRfZm10cykKKwkJcmV0dXJu
IE5VTEw7CisKKwlpbnB1dF9mbXRzID0ga2NhbGxvYygqbnVtX2lucHV0X2ZtdHMsIHNpemVvZigq
aW5wdXRfZm10cyksIEdGUF9LRVJORUwpOworCWlmICghaW5wdXRfZm10cykKKwkJcmV0dXJuIE5V
TEw7CisKKwlpbnB1dF9mbXRzWzBdID0gbHZkc19lbmNvZGVyLT5pbnB1dF9mbXQ7CisJcmV0dXJu
IGlucHV0X2ZtdHM7Cit9CisKIHN0YXRpYyBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyBmdW5jcyA9
IHsKIAkuYXR0YWNoID0gbHZkc19lbmNvZGVyX2F0dGFjaCwKIAkuZW5hYmxlID0gbHZkc19lbmNv
ZGVyX2VuYWJsZSwKIAkuZGlzYWJsZSA9IGx2ZHNfZW5jb2Rlcl9kaXNhYmxlLAorCS5hdG9taWNf
Z2V0X2lucHV0X2J1c19mbXRzID0gbHZkc19hdG9taWNfZ2V0X2lucHV0X2J1c19mbXRzLAogfTsK
IAogc3RhdGljIGludCBsdmRzX2VuY29kZXJfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKQEAgLTYyLDExICs5NSwxNiBAQCBzdGF0aWMgaW50IGx2ZHNfZW5jb2Rlcl9wcm9iZShz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcGFuZWxf
bm9kZTsKIAlzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbDsKIAlzdHJ1Y3QgbHZkc19lbmNvZGVyICps
dmRzX2VuY29kZXI7CisJY29uc3QgY2hhciAqb3V0cHV0X2RhdGFfbWFwcGluZyA9IE5VTEw7CisJ
dTMyIGlucHV0X2J1c193aWR0aCA9IDA7CiAKIAlsdmRzX2VuY29kZXIgPSBkZXZtX2t6YWxsb2Mo
ZGV2LCBzaXplb2YoKmx2ZHNfZW5jb2RlciksIEdGUF9LRVJORUwpOwogCWlmICghbHZkc19lbmNv
ZGVyKQogCQlyZXR1cm4gLUVOT01FTTsKIAorCWx2ZHNfZW5jb2Rlci0+aW5wdXRfZm10ID0gTUVE
SUFfQlVTX0ZNVF9GSVhFRDsKKwlsdmRzX2VuY29kZXItPm91dHB1dF9mbXQgPSBNRURJQV9CVVNf
Rk1UX0ZJWEVEOworCiAJbHZkc19lbmNvZGVyLT5wb3dlcmRvd25fZ3BpbyA9IGRldm1fZ3Bpb2Rf
Z2V0X29wdGlvbmFsKGRldiwgInBvd2VyZG93biIsCiAJCQkJCQkJICAgICAgIEdQSU9EX09VVF9I
SUdIKTsKIAlpZiAoSVNfRVJSKGx2ZHNfZW5jb2Rlci0+cG93ZXJkb3duX2dwaW8pKSB7CkBAIC03
Nyw2ICsxMTUsMjUgQEAgc3RhdGljIGludCBsdmRzX2VuY29kZXJfcHJvYmUoc3RydWN0IHBsYXRm
b3JtX2RldmljZSAqcGRldikKIAkJcmV0dXJuIGVycjsKIAl9CiAKKwlwb3J0ID0gb2ZfZ3JhcGhf
Z2V0X3BvcnRfYnlfaWQoZGV2LT5vZl9ub2RlLCAwKTsKKwlpZiAoIXBvcnQpIHsKKwkJZGV2X2Ri
ZyhkZXYsICJwb3J0IDAgbm90IGZvdW5kXG4iKTsKKwkJcmV0dXJuIC1FTlhJTzsKKwl9CisKKwlv
Zl9ub2RlX3B1dChwb3J0KTsKKworCWlmIChvZl9wcm9wZXJ0eV9yZWFkX3UzMihwb3J0LCAiYnVz
LXdpZHRoIiwgJmlucHV0X2J1c193aWR0aCkpIHsKKwkJbHZkc19lbmNvZGVyLT5pbnB1dF9mbXQg
PSBNRURJQV9CVVNfRk1UX0ZJWEVEOworCX0gZWxzZSBpZiAoaW5wdXRfYnVzX3dpZHRoID09IDE4
KSB7CisJCWx2ZHNfZW5jb2Rlci0+aW5wdXRfZm10ID0gTUVESUFfQlVTX0ZNVF9SR0I2NjZfMVgx
ODsKKwl9IGVsc2UgaWYgKGlucHV0X2J1c193aWR0aCA9PSAyNCkgeworCQlsdmRzX2VuY29kZXIt
PmlucHV0X2ZtdCA9IE1FRElBX0JVU19GTVRfUkdCODg4XzFYMjQ7CisJfSBlbHNlIHsKKwkJZGV2
X2RiZyhkZXYsICJ1bnN1cHBvcnRlZCBidXMtd2lkdGgpXG4iKTsKKwkJcmV0dXJuIC1FTk9UU1VQ
UDsKKwl9CisKIAkvKiBMb2NhdGUgdGhlIHBhbmVsIERUIG5vZGUuICovCiAJcG9ydCA9IG9mX2dy
YXBoX2dldF9wb3J0X2J5X2lkKGRldi0+b2Zfbm9kZSwgMSk7CiAJaWYgKCFwb3J0KSB7CkBAIC04
NCw2ICsxNDEsMjEgQEAgc3RhdGljIGludCBsdmRzX2VuY29kZXJfcHJvYmUoc3RydWN0IHBsYXRm
b3JtX2RldmljZSAqcGRldikKIAkJcmV0dXJuIC1FTlhJTzsKIAl9CiAKKwlvZl9wcm9wZXJ0eV9y
ZWFkX3N0cmluZyhwb3J0LCAiZGF0YS1tYXBwaW5nIiwgJm91dHB1dF9kYXRhX21hcHBpbmcpOwor
CWlmICghb3V0cHV0X2RhdGFfbWFwcGluZykgeworCQlsdmRzX2VuY29kZXItPm91dHB1dF9mbXQg
PSBNRURJQV9CVVNfRk1UX0ZJWEVEOworCX0gZWxzZSBpZiAoIXN0cmNtcChvdXRwdXRfZGF0YV9t
YXBwaW5nLCAiamVpZGEtMTgiKSkgeworCQlsdmRzX2VuY29kZXItPm91dHB1dF9mbXQgPSBNRURJ
QV9CVVNfRk1UX1JHQjY2Nl8xWDdYM19TUFdHOworCX0gZWxzZSBpZiAoIXN0cmNtcChvdXRwdXRf
ZGF0YV9tYXBwaW5nLCAiamVpZGEtMjQiKSkgeworCQlsdmRzX2VuY29kZXItPm91dHB1dF9mbXQg
PSBNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDdYNF9KRUlEQTsKKwl9IGVsc2UgaWYgKCFzdHJjbXAo
b3V0cHV0X2RhdGFfbWFwcGluZywgInZlc2EtMjQiKSkgeworCQlsdmRzX2VuY29kZXItPm91dHB1
dF9mbXQgPSBNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDdYNF9TUFdHOworCX0gZWxzZSB7CisJCW9m
X25vZGVfcHV0KHBvcnQpOworCQlkZXZfZGJnKGRldiwgInVuc3VwcG9ydGVkIG91dHB1dCBkYXRh
LW1hcHBpbmdcbiIpOworCQlyZXR1cm4gLUVOT1RTVVBQOworCX0KKwogCWVuZHBvaW50ID0gb2Zf
Z2V0X2NoaWxkX2J5X25hbWUocG9ydCwgImVuZHBvaW50Iik7CiAJb2Zfbm9kZV9wdXQocG9ydCk7
CiAJaWYgKCFlbmRwb2ludCkgewotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
