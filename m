Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 006E4C90B9
	for <lists+dri-devel@lfdr.de>; Wed,  2 Oct 2019 20:23:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AB1E16E199;
	Wed,  2 Oct 2019 18:23:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x543.google.com (mail-pg1-x543.google.com
 [IPv6:2607:f8b0:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E881E6E18F
 for <dri-devel@lists.freedesktop.org>; Wed,  2 Oct 2019 18:23:03 +0000 (UTC)
Received: by mail-pg1-x543.google.com with SMTP id q1so4314343pgb.0
 for <dri-devel@lists.freedesktop.org>; Wed, 02 Oct 2019 11:23:03 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=eElMbkeXFNh8roijamZYuXGa0qKH4FDMB8JHRgQiFiY=;
 b=OouV4RolZLlm+BhrTf4CJI6W5c+lKqecLGUM7ceaLPXAa1eSK5YRonDS06KWzHNpUE
 eoT44gVAv+/HO1F7+XHw4+CYKa7njhniSBm6Y7XvRKa+IMChOtf4eypDBcm+xXtuCpSZ
 XQhgaefKaHqXiOFw+HfOnfcZgMZZN/4HMlmWVDfbs4Br5ONZGX9e38Io3vwrNvFyTDQ1
 E5+5i22uZo63kX6ESzamqvs5JkOOh6uWebGbrP988/Sqf1dAs4bJFuGMJWabJUWATlpj
 rwUTZiSwp9oes3GB4BJ/Ksit9Z1DNIRVTgmhM4ge3CktMWvWQdbbYkLcYU0E+/N/PHCU
 9IPw==
X-Gm-Message-State: APjAAAXhYiw5Thgwd3Ope6YkfH/+f+Fx0DKaXjVj7uZV2Ciw7A/0yRh1
 B0b5am2s87c6XIogOE8fdahdew==
X-Google-Smtp-Source: APXvYqy2D+kP5E1aO4RnUjGArwgOkSfwKLJl3Y1jQGy+xhSlDt7KPGE6SLbGGnImVpxKJwZj+4FvZw==
X-Received: by 2002:aa7:800d:: with SMTP id j13mr6208111pfi.187.1570040583384; 
 Wed, 02 Oct 2019 11:23:03 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 q132sm171102pfq.16.2019.10.02.11.23.01
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 02 Oct 2019 11:23:02 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v9 2/5] dma-buf: heaps: Add heap helpers
Date: Wed,  2 Oct 2019 18:22:52 +0000
Message-Id: <20191002182255.21808-3-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191002182255.21808-1-john.stultz@linaro.org>
References: <20191002182255.21808-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=eElMbkeXFNh8roijamZYuXGa0qKH4FDMB8JHRgQiFiY=;
 b=YabBkWhyffb6zAISiVxkipOX9eAnhPzB6T/mV5JD22PWb/tSP4w6t2eRc9SXH49RGR
 KpqaVgM53HXC93UqJB4qhuACYlPC+5/Q6bQz6z3SFciEdn+1FLmAy7rWpjCxpUdlSte+
 6TNb1jUhm/OXxBmh1rAxztPqPHjANDYZLrfqAZCJQ3L0lfyVDlli3XeelIQZMEiyk/0A
 wuF4DIprHQZTNIoCSi6ProZ0JarwVB+SdqNT5O16pCquHJnz+bT7Q7RedVqyrsucixna
 8DUP9pApYc9Q57oV1zUc9x6X8bTmYtBPx9e5O9EiXLrCCiJHygJJegBBvVHAODXSGVOA
 fU0g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGdlbmVyaWMgaGVscGVyIGRtYWJ1ZiBvcHMgZm9yIGRtYSBoZWFwcywgc28gd2UgY2FuIHJl
ZHVjZQp0aGUgYW1vdW50IG9mIGR1cGxpY2F0aXZlIGNvZGUgZm9yIHRoZSBleHBvcnRlZCBkbWFi
dWZzLgoKVGhpcyBjb2RlIGlzIGFuIGV2b2x1dGlvbiBvZiB0aGUgQW5kcm9pZCBJT04gaW1wbGVt
ZW50YXRpb24sIHNvCnRoYW5rcyB0byBpdHMgb3JpZ2luYWwgYXV0aG9ycyBhbmQgbWFpbnRhaW50
ZXJzOgogIFJlYmVjY2EgU2NodWx0eiBaYXZpbiwgQ29saW4gQ3Jvc3MsIExhdXJhIEFiYm90dCwg
YW5kIG90aGVycyEKCkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KQ2M6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpDYzogU3VtaXQg
U2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29k
ZWF1cm9yYS5vcmc+CkNjOiBQcmF0aWsgUGF0ZWwgPHByYXRpa3BAY29kZWF1cm9yYS5vcmc+CkNj
OiBCcmlhbiBTdGFya2V5IDxCcmlhbi5TdGFya2V5QGFybS5jb20+CkNjOiBWaW5jZW50IERvbm5l
Zm9ydCA8VmluY2VudC5Eb25uZWZvcnRAYXJtLmNvbT4KQ2M6IFN1ZGlwdG8gUGF1bCA8U3VkaXB0
by5QYXVsQGFybS5jb20+CkNjOiBBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CkNjOiBDaHJp
c3RvcGggSGVsbHdpZyA8aGNoQGluZnJhZGVhZC5vcmc+CkNjOiBDaGVuYm8gRmVuZyA8ZmVuZ2NA
Z29vZ2xlLmNvbT4KQ2M6IEFsaXN0YWlyIFN0cmFjaGFuIDxhc3RyYWNoYW5AZ29vZ2xlLmNvbT4K
Q2M6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogSGlsbGYgRGFudG9u
IDxoZGFudG9uQHNpbmEuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpS
ZXZpZXdlZC1ieTogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdhaWduYXJkQGxpbmFyby5v
cmc+ClJldmlld2VkLWJ5OiBCcmlhbiBTdGFya2V5IDxicmlhbi5zdGFya2V5QGFybS5jb20+CkFj
a2VkLWJ5OiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAcmVkaGF0LmNvbT4KVGVzdGVkLWJ5OiBBeWFu
IEt1bWFyIEhhbGRlciA8YXlhbi5oYWxkZXJAYXJtLmNvbT4KU2lnbmVkLW9mZi1ieTogSm9obiBT
dHVsdHogPGpvaG4uc3R1bHR6QGxpbmFyby5vcmc+Ci0tLQp2MjoKKiBSZW1vdmVkIGNhY2hlIG1h
bmFnZW1lbnQgcGVyZm9ybWFuY2UgaGFjayB0aGF0IEkgaGFkCiAgYWNjaWRlbnRhbGx5IGZvbGRl
ZCBpbi4KKiBSZW1vdmVkIHN0YXRzIGNvZGUgdGhhdCB3YXMgaW4gaGVscGVycwoqIExvdHMgb2Yg
Y2hlY2twYXRjaCBjbGVhbnVwcwp2MzoKKiBVbmlubGluZSBJTklUX0hFQVBfSEVMUEVSX0JVRkZF
UiAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBTd2l0Y2ggdG8gV0FSTiBvbiBidWZmZXIgZGVz
dHJveSBmYWlsdXJlIChzdWdnZXN0ZWQgYnkgQnJpYW4pCiogYnVmZmVyLT5rbWFwX2NudCBkZWNy
ZW1lbnRpbmcgY2xlYW51cCAoc3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBFeHRyYSBidWZmZXIt
PnZhZGRyIGNoZWNraW5nIGluIGRtYV9oZWFwX2RtYV9idWZfa21hcAogIChzdWdnZXN0ZWQgYnkg
QnJpYW4pCiogU3dpdGNoIHRvX2hlbHBlcl9idWZmZXIgZnJvbSBtYWNybyB0byBpbmxpbmUgZnVu
Y3Rpb24KICAoc3VnZ2VzdGVkIGJ5IEJlbmphbWluKQoqIFJlbmFtZSBrbWFwLT52bWFwIChmb2xk
ZWQgaW4gZnJvbSBBbmRyZXcpCiogVXNlIHZtYXAgZm9yIHZtYXBwaW5nIC0gbm90IGJlZ2luX2Nw
dV9hY2Nlc3MgKGZvbGRlZCBpbiBmcm9tCiAgQW5kcmV3KQoqIERyb3Aga21hcCBmb3Igbm93LCBh
cyBpdHMgb3B0aW9uYWwgKGZvbGRlZCBpbiBmcm9tIEFuZHJldykKKiBGb2xkIGRtYV9oZWFwX21h
cF91c2VyIGludG8gdGhlIHNpbmdsZSBjYWxsZXIgKGZvbGVkIGluIGZyb20KICBBbmRyZXcpCiog
Rm9sZGVkIGluIHBhdGNoIGZyb20gQW5kcmV3IHRvIHRyYWNrIHBhZ2UgbGlzdCBwZXIgaGVhcCBu
b3QKICBzZ2xpc3QsIHdoaWNoIHNpbXBsaWZpZXMgdGhlIHRyYWNraW5nIGxvZ2ljCnY0OgoqIE1v
dmVkIGRtYS1oZWFwLmggY2hhbmdlIG91dCB0byBwcmV2aW91cyBwYXRjaAp2NjoKKiBNaW5vciBj
bGVhbnVwcyBhbmQgdHlwbyBmaXhlcyBzdWdnZXN0ZWQgYnkgQnJpYW4Kdjc6CiogUmVtb3ZlZCBz
dHJheSA7CiogTWFrZSBpbml0X2hlYXBfaGVscGVyX2J1ZmZlciBsb3dlcmNhc2UsIGFzIHN1Z2dl
c3RlZCBieSBDaHJpc3RvcGgKKiBBZGQgZG1hYnVmIGV4cG9ydCBoZWxwZXIgdG8gcmVkdWNlIGJv
aWxlcnBsYXRlIGNvZGUKdjg6CiogUmVtb3ZlIHVudXNlZCBwcml2YXRlX2ZsYWdzIHZhbHVlCiog
Q29uZGVuc2UgZG1hX2hlYXBfYnVmZmVyIGFuZCBoZWFwX2hlbHBlcl9idWZmZXIgKHN1Z2dlc3Rl
ZCBieQogIENocmlzdG9waCkKKiBGaXggaW5kZW50YXRpb24gYnkgdXNpbmcgc2hvcnRlciBhcmd1
bWVudCBuYW1lcyAoc3VnZ2VzdGVkIGJ5CiAgQ2hyaXN0b3BoKQoqIEFkZCBmbHVzaF9rZXJuZWxf
dm1hcF9yYW5nZS9pbnZhbGlkYXRlX2tlcm5lbF92bWFwX3JhbmdlIGNhbGxzCiAgKHN1Z2dlc3Rl
ZCBieSBDaHJpc3RvcGgpCiogQ2hlY2twYXRjaCB3aGl0ZXNwYWNlIGZpeHVwcwp2OToKKiBNaW5v
ciBjbGVhbnVwcyBzdWdnZXN0ZWQgYnkgQnJpYW4gU3RhcmtleQotLS0KIGRyaXZlcnMvZG1hLWJ1
Zi9NYWtlZmlsZSAgICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvTWFr
ZWZpbGUgICAgICAgfCAgIDIgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5j
IHwgMjY2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9kbWEtYnVmL2hlYXBz
L2hlYXAtaGVscGVycy5oIHwgIDU1ICsrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAzMjQgaW5zZXJ0
aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmls
ZQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMu
YwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9oZWFwLWhlbHBlcnMu
aAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1
Zi9NYWtlZmlsZQppbmRleCBjYWVlNWViM2QzNTEuLjljMTkwMDI2YmZhYiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQpA
QCAtMiw2ICsyLDcgQEAKIG9iai15IDo9IGRtYS1idWYubyBkbWEtZmVuY2UubyBkbWEtZmVuY2Ut
YXJyYXkubyBkbWEtZmVuY2UtY2hhaW4ubyBcCiAJIGRtYS1yZXN2Lm8gc2Vxbm8tZmVuY2Uubwog
b2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQUykJKz0gZG1hLWhlYXAubworb2JqLSQoQ09ORklHX0RN
QUJVRl9IRUFQUykJKz0gaGVhcHMvCiBvYmotJChDT05GSUdfU1lOQ19GSUxFKQkJKz0gc3luY19m
aWxlLm8KIG9iai0kKENPTkZJR19TV19TWU5DKQkJKz0gc3dfc3luYy5vIHN5bmNfZGVidWcubwog
b2JqLSQoQ09ORklHX1VETUFCVUYpCQkrPSB1ZG1hYnVmLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
ZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmRlNDk4OTgxMTJkYgotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMCwwICsx
LDIgQEAKKyMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKK29iai15CQkJCQkrPSBo
ZWFwLWhlbHBlcnMubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVs
cGVycy5jIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMmRkMmM0ZDJlZjFjCi0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2hlYXAtaGVscGVycy5jCkBAIC0wLDAgKzEsMjY2
IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorI2luY2x1ZGUgPGxpbnV4
L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9l
cnIuaD4KKyNpbmNsdWRlIDxsaW51eC9oaWdobWVtLmg+CisjaW5jbHVkZSA8bGludXgvaWRyLmg+
CisjaW5jbHVkZSA8bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNs
dWRlIDxsaW51eC91YWNjZXNzLmg+CisjaW5jbHVkZSA8dWFwaS9saW51eC9kbWEtaGVhcC5oPgor
I2luY2x1ZGUgImhlYXAtaGVscGVycy5oIgorCit2b2lkIGluaXRfaGVhcF9oZWxwZXJfYnVmZmVy
KHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKmJ1ZmZlciwKKwkJCSAgICAgdm9pZCAoKmZyZWUp
KHN0cnVjdCBoZWFwX2hlbHBlcl9idWZmZXIgKikpCit7CisJYnVmZmVyLT5wcml2X3ZpcnQgPSBO
VUxMOworCW11dGV4X2luaXQoJmJ1ZmZlci0+bG9jayk7CisJYnVmZmVyLT52bWFwX2NudCA9IDA7
CisJYnVmZmVyLT52YWRkciA9IE5VTEw7CisJYnVmZmVyLT5wYWdlY291bnQgPSAwOworCWJ1ZmZl
ci0+cGFnZXMgPSBOVUxMOworCUlOSVRfTElTVF9IRUFEKCZidWZmZXItPmF0dGFjaG1lbnRzKTsK
KwlidWZmZXItPmZyZWUgPSBmcmVlOworfQorCitzdHJ1Y3QgZG1hX2J1ZiAqaGVhcF9oZWxwZXJf
ZXhwb3J0X2RtYWJ1ZihzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIsCisJCQkJCSAg
aW50IGZkX2ZsYWdzKQoreworCURFRklORV9ETUFfQlVGX0VYUE9SVF9JTkZPKGV4cF9pbmZvKTsK
KworCWV4cF9pbmZvLm9wcyA9ICZoZWFwX2hlbHBlcl9vcHM7CisJZXhwX2luZm8uc2l6ZSA9IGJ1
ZmZlci0+c2l6ZTsKKwlleHBfaW5mby5mbGFncyA9IGZkX2ZsYWdzOworCWV4cF9pbmZvLnByaXYg
PSBidWZmZXI7CisKKwlyZXR1cm4gZG1hX2J1Zl9leHBvcnQoJmV4cF9pbmZvKTsKK30KKworc3Rh
dGljIHZvaWQgKmRtYV9oZWFwX21hcF9rZXJuZWwoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyKQoreworCXZvaWQgKnZhZGRyOworCisJdmFkZHIgPSB2bWFwKGJ1ZmZlci0+cGFnZXMs
IGJ1ZmZlci0+cGFnZWNvdW50LCBWTV9NQVAsIFBBR0VfS0VSTkVMKTsKKwlpZiAoIXZhZGRyKQor
CQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKworCXJldHVybiB2YWRkcjsKK30KKworc3RhdGlj
IHZvaWQgZG1hX2hlYXBfYnVmZmVyX2Rlc3Ryb3koc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAq
YnVmZmVyKQoreworCWlmIChidWZmZXItPnZtYXBfY250ID4gMCkgeworCQlXQVJOKCIlczogYnVm
ZmVyIHN0aWxsIG1hcHBlZCBpbiB0aGUga2VybmVsXG4iLCBfX2Z1bmNfXyk7CisJCXZ1bm1hcChi
dWZmZXItPnZhZGRyKTsKKwl9CisKKwlidWZmZXItPmZyZWUoYnVmZmVyKTsKK30KKworc3RhdGlj
IHZvaWQgKmRtYV9oZWFwX2J1ZmZlcl92bWFwX2dldChzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVy
ICpidWZmZXIpCit7CisJdm9pZCAqdmFkZHI7CisKKwlpZiAoYnVmZmVyLT52bWFwX2NudCkgewor
CQlidWZmZXItPnZtYXBfY250Kys7CisJCXJldHVybiBidWZmZXItPnZhZGRyOworCX0KKwl2YWRk
ciA9IGRtYV9oZWFwX21hcF9rZXJuZWwoYnVmZmVyKTsKKwlpZiAoSVNfRVJSKHZhZGRyKSkKKwkJ
cmV0dXJuIHZhZGRyOworCWJ1ZmZlci0+dmFkZHIgPSB2YWRkcjsKKwlidWZmZXItPnZtYXBfY250
Kys7CisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9idWZmZXJfdm1h
cF9wdXQoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCWlmICghLS1idWZm
ZXItPnZtYXBfY250KSB7CisJCXZ1bm1hcChidWZmZXItPnZhZGRyKTsKKwkJYnVmZmVyLT52YWRk
ciA9IE5VTEw7CisJfQorfQorCitzdHJ1Y3QgZG1hX2hlYXBzX2F0dGFjaG1lbnQgeworCXN0cnVj
dCBkZXZpY2UgKmRldjsKKwlzdHJ1Y3Qgc2dfdGFibGUgdGFibGU7CisJc3RydWN0IGxpc3RfaGVh
ZCBsaXN0OworfTsKKworc3RhdGljIGludCBkbWFfaGVhcF9hdHRhY2goc3RydWN0IGRtYV9idWYg
KmRtYWJ1ZiwKKwkJCSAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7
CisJc3RydWN0IGRtYV9oZWFwc19hdHRhY2htZW50ICphOworCXN0cnVjdCBoZWFwX2hlbHBlcl9i
dWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJpdjsKKwlpbnQgcmV0OworCisJYSA9IGt6YWxsb2Mo
c2l6ZW9mKCphKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFhKQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CXJldCA9IHNnX2FsbG9jX3RhYmxlX2Zyb21fcGFnZXMoJmEtPnRhYmxlLCBidWZmZXItPnBhZ2Vz
LAorCQkJCQlidWZmZXItPnBhZ2Vjb3VudCwgMCwKKwkJCQkJYnVmZmVyLT5wYWdlY291bnQgPDwg
UEFHRV9TSElGVCwKKwkJCQkJR0ZQX0tFUk5FTCk7CisJaWYgKHJldCkgeworCQlrZnJlZShhKTsK
KwkJcmV0dXJuIHJldDsKKwl9CisKKwlhLT5kZXYgPSBhdHRhY2htZW50LT5kZXY7CisJSU5JVF9M
SVNUX0hFQUQoJmEtPmxpc3QpOworCisJYXR0YWNobWVudC0+cHJpdiA9IGE7CisKKwltdXRleF9s
b2NrKCZidWZmZXItPmxvY2spOworCWxpc3RfYWRkKCZhLT5saXN0LCAmYnVmZmVyLT5hdHRhY2ht
ZW50cyk7CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyB2b2lkIGRtYV9oZWFwX2RldGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAorCQkJ
ICAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7CisJc3RydWN0IGRt
YV9oZWFwc19hdHRhY2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsKKwlzdHJ1Y3QgaGVhcF9o
ZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9sb2NrKCZidWZm
ZXItPmxvY2spOworCWxpc3RfZGVsKCZhLT5saXN0KTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+
bG9jayk7CisKKwlzZ19mcmVlX3RhYmxlKCZhLT50YWJsZSk7CisJa2ZyZWUoYSk7Cit9CisKK3N0
YXRpYworc3RydWN0IHNnX3RhYmxlICpkbWFfaGVhcF9tYXBfZG1hX2J1ZihzdHJ1Y3QgZG1hX2J1
Zl9hdHRhY2htZW50ICphdHRhY2htZW50LAorCQkJCSAgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0
aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3QgZG1hX2hlYXBzX2F0dGFjaG1lbnQgKmEgPSBhdHRh
Y2htZW50LT5wcml2OworCXN0cnVjdCBzZ190YWJsZSAqdGFibGU7CisKKwl0YWJsZSA9ICZhLT50
YWJsZTsKKworCWlmICghZG1hX21hcF9zZyhhdHRhY2htZW50LT5kZXYsIHRhYmxlLT5zZ2wsIHRh
YmxlLT5uZW50cywKKwkJCWRpcmVjdGlvbikpCisJCXRhYmxlID0gRVJSX1BUUigtRU5PTUVNKTsK
KwlyZXR1cm4gdGFibGU7Cit9CisKK3N0YXRpYyB2b2lkIGRtYV9oZWFwX3VubWFwX2RtYV9idWYo
c3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNobWVudCwKKwkJCQkgICBzdHJ1Y3Qgc2df
dGFibGUgKnRhYmxlLAorCQkJCSAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikK
K3sKKwlkbWFfdW5tYXBfc2coYXR0YWNobWVudC0+ZGV2LCB0YWJsZS0+c2dsLCB0YWJsZS0+bmVu
dHMsIGRpcmVjdGlvbik7Cit9CisKK3N0YXRpYyB2bV9mYXVsdF90IGRtYV9oZWFwX3ZtX2ZhdWx0
KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQoreworCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hID0g
dm1mLT52bWE7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gdm1hLT52bV9w
cml2YXRlX2RhdGE7CisKKwl2bWYtPnBhZ2UgPSBidWZmZXItPnBhZ2VzW3ZtZi0+cGdvZmZdOwor
CWdldF9wYWdlKHZtZi0+cGFnZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBkbWFfaGVhcF92bV9vcHMgPSB7CisJLmZhdWx0ID0g
ZG1hX2hlYXBfdm1fZmF1bHQsCit9OworCitzdGF0aWMgaW50IGRtYV9oZWFwX21tYXAoc3RydWN0
IGRtYV9idWYgKmRtYWJ1Ziwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCit7CisJc3RydWN0
IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJaWYgKCh2bWEt
PnZtX2ZsYWdzICYgKFZNX1NIQVJFRCB8IFZNX01BWVNIQVJFKSkgPT0gMCkKKwkJcmV0dXJuIC1F
SU5WQUw7CisKKwl2bWEtPnZtX29wcyA9ICZkbWFfaGVhcF92bV9vcHM7CisJdm1hLT52bV9wcml2
YXRlX2RhdGEgPSBidWZmZXI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgZG1hX2hl
YXBfZG1hX2J1Zl9yZWxlYXNlKHN0cnVjdCBkbWFfYnVmICpkbWFidWYpCit7CisJc3RydWN0IGhl
YXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCisJZG1hX2hlYXBfYnVm
ZmVyX2Rlc3Ryb3koYnVmZmVyKTsKK30KKworc3RhdGljIGludCBkbWFfaGVhcF9kbWFfYnVmX2Jl
Z2luX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYgKmRtYWJ1ZiwKKwkJCQkJICAgICBlbnVtIGRt
YV9kYXRhX2RpcmVjdGlvbiBkaXJlY3Rpb24pCit7CisJc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZl
ciAqYnVmZmVyID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBkbWFfaGVhcHNfYXR0YWNobWVudCAq
YTsKKwlpbnQgcmV0ID0gMDsKKworCW11dGV4X2xvY2soJmJ1ZmZlci0+bG9jayk7CisKKwlpZiAo
YnVmZmVyLT52bWFwX2NudCkKKwkJaW52YWxpZGF0ZV9rZXJuZWxfdm1hcF9yYW5nZShidWZmZXIt
PnZhZGRyLCBidWZmZXItPnNpemUpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShhLCAmYnVmZmVy
LT5hdHRhY2htZW50cywgbGlzdCkgeworCQlkbWFfc3luY19zZ19mb3JfY3B1KGEtPmRldiwgYS0+
dGFibGUuc2dsLCBhLT50YWJsZS5uZW50cywKKwkJCQkgICAgZGlyZWN0aW9uKTsKKwl9CisJbXV0
ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGlu
dCBkbWFfaGVhcF9kbWFfYnVmX2VuZF9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFidWYs
CisJCQkJCSAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKK3sKKwlzdHJ1Y3Qg
aGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJc3RydWN0IGRtYV9o
ZWFwc19hdHRhY2htZW50ICphOworCisJbXV0ZXhfbG9jaygmYnVmZmVyLT5sb2NrKTsKKworCWlm
IChidWZmZXItPnZtYXBfY250KQorCQlmbHVzaF9rZXJuZWxfdm1hcF9yYW5nZShidWZmZXItPnZh
ZGRyLCBidWZmZXItPnNpemUpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShhLCAmYnVmZmVyLT5h
dHRhY2htZW50cywgbGlzdCkgeworCQlkbWFfc3luY19zZ19mb3JfZGV2aWNlKGEtPmRldiwgYS0+
dGFibGUuc2dsLCBhLT50YWJsZS5uZW50cywKKwkJCQkgICAgICAgZGlyZWN0aW9uKTsKKwl9CisJ
bXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2
b2lkICpkbWFfaGVhcF9kbWFfYnVmX3ZtYXAoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sKKwlz
dHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisJdm9pZCAq
dmFkZHI7CisKKwltdXRleF9sb2NrKCZidWZmZXItPmxvY2spOworCXZhZGRyID0gZG1hX2hlYXBf
YnVmZmVyX3ZtYXBfZ2V0KGJ1ZmZlcik7CisJbXV0ZXhfdW5sb2NrKCZidWZmZXItPmxvY2spOwor
CisJcmV0dXJuIHZhZGRyOworfQorCitzdGF0aWMgdm9pZCBkbWFfaGVhcF9kbWFfYnVmX3Z1bm1h
cChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLCB2b2lkICp2YWRkcikKK3sKKwlzdHJ1Y3QgaGVhcF9o
ZWxwZXJfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9sb2NrKCZidWZm
ZXItPmxvY2spOworCWRtYV9oZWFwX2J1ZmZlcl92bWFwX3B1dChidWZmZXIpOworCW11dGV4X3Vu
bG9jaygmYnVmZmVyLT5sb2NrKTsKK30KKworY29uc3Qgc3RydWN0IGRtYV9idWZfb3BzIGhlYXBf
aGVscGVyX29wcyA9IHsKKwkubWFwX2RtYV9idWYgPSBkbWFfaGVhcF9tYXBfZG1hX2J1ZiwKKwku
dW5tYXBfZG1hX2J1ZiA9IGRtYV9oZWFwX3VubWFwX2RtYV9idWYsCisJLm1tYXAgPSBkbWFfaGVh
cF9tbWFwLAorCS5yZWxlYXNlID0gZG1hX2hlYXBfZG1hX2J1Zl9yZWxlYXNlLAorCS5hdHRhY2gg
PSBkbWFfaGVhcF9hdHRhY2gsCisJLmRldGFjaCA9IGRtYV9oZWFwX2RldGFjaCwKKwkuYmVnaW5f
Y3B1X2FjY2VzcyA9IGRtYV9oZWFwX2RtYV9idWZfYmVnaW5fY3B1X2FjY2VzcywKKwkuZW5kX2Nw
dV9hY2Nlc3MgPSBkbWFfaGVhcF9kbWFfYnVmX2VuZF9jcHVfYWNjZXNzLAorCS52bWFwID0gZG1h
X2hlYXBfZG1hX2J1Zl92bWFwLAorCS52dW5tYXAgPSBkbWFfaGVhcF9kbWFfYnVmX3Z1bm1hcCwK
K307CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmggYi9k
cml2ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAwMDAwLi45MTFjOTMxZjdmMDYKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2
ZXJzL2RtYS1idWYvaGVhcHMvaGVhcC1oZWxwZXJzLmgKQEAgLTAsMCArMSw1NSBAQAorLyogU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBETUFCVUYgSGVhcHMgaGVs
cGVyIGNvZGUKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTEgR29vZ2xlLCBJbmMuCisgKiBDb3B5
cmlnaHQgKEMpIDIwMTkgTGluYXJvIEx0ZC4KKyAqLworCisjaWZuZGVmIF9IRUFQX0hFTFBFUlNf
SAorI2RlZmluZSBfSEVBUF9IRUxQRVJTX0gKKworI2luY2x1ZGUgPGxpbnV4L2RtYS1oZWFwLmg+
CisjaW5jbHVkZSA8bGludXgvbGlzdC5oPgorCisvKioKKyAqIHN0cnVjdCBoZWFwX2hlbHBlcl9i
dWZmZXIgLSBoZWxwZXIgYnVmZmVyIG1ldGFkYXRhCisgKiBAaGVhcDoJCWJhY2sgcG9pbnRlciB0
byB0aGUgaGVhcCB0aGUgYnVmZmVyIGNhbWUgZnJvbQorICogQGRtYWJ1ZjoJCWJhY2tpbmcgZG1h
LWJ1ZiBmb3IgdGhpcyBidWZmZXIKKyAqIEBzaXplOgkJc2l6ZSBvZiB0aGUgYnVmZmVyCisgKiBA
ZmxhZ3M6CQlidWZmZXIgc3BlY2lmaWMgZmxhZ3MKKyAqIEBwcml2X3ZpcnQJCXBvaW50ZXIgdG8g
aGVhcCBzcGVjaWZpYyBwcml2YXRlIHZhbHVlCisgKiBAbG9jawkJbXV0ZXh0IHRvIHByb3RlY3Qg
dGhlIGRhdGEgaW4gdGhpcyBzdHJ1Y3R1cmUKKyAqIEB2bWFwX2NudAkJY291bnQgb2Ygdm1hcCBy
ZWZlcmVuY2VzIG9uIHRoZSBidWZmZXIKKyAqIEB2YWRkcgkJdm1hcCdlZCB2aXJ0dWFsIGFkZHJl
c3MKKyAqIEBwYWdlY291bnQJCW51bWJlciBvZiBwYWdlcyBpbiB0aGUgYnVmZmVyCisgKiBAcGFn
ZXMJCWxpc3Qgb2YgcGFnZSBwb2ludGVycworICogQGF0dGFjaG1lbnRzCQlsaXN0IG9mIGRldmlj
ZSBhdHRhY2htZW50cworICoKKyAqIEBmcmVlCQloZWFwIGNhbGxiYWNrIHRvIGZyZWUgdGhlIGJ1
ZmZlcgorICovCitzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyIHsKKwlzdHJ1Y3QgZG1hX2hlYXAg
KmhlYXA7CisJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKKwlzaXplX3Qgc2l6ZTsKKwl1bnNpZ25l
ZCBsb25nIGZsYWdzOworCisJdm9pZCAqcHJpdl92aXJ0OworCXN0cnVjdCBtdXRleCBsb2NrOwor
CWludCB2bWFwX2NudDsKKwl2b2lkICp2YWRkcjsKKwlwZ29mZl90IHBhZ2Vjb3VudDsKKwlzdHJ1
Y3QgcGFnZSAqKnBhZ2VzOworCXN0cnVjdCBsaXN0X2hlYWQgYXR0YWNobWVudHM7CisKKwl2b2lk
ICgqZnJlZSkoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKTsKK307CisKK3ZvaWQg
aW5pdF9oZWFwX2hlbHBlcl9idWZmZXIoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVy
LAorCQkJICAgICB2b2lkICgqZnJlZSkoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqKSk7CisK
K3N0cnVjdCBkbWFfYnVmICpoZWFwX2hlbHBlcl9leHBvcnRfZG1hYnVmKHN0cnVjdCBoZWFwX2hl
bHBlcl9idWZmZXIgKmJ1ZmZlciwKKwkJCQkJICBpbnQgZmRfZmxhZ3MpOworCitleHRlcm4gY29u
c3Qgc3RydWN0IGRtYV9idWZfb3BzIGhlYXBfaGVscGVyX29wczsKKyNlbmRpZiAvKiBfSEVBUF9I
RUxQRVJTX0ggKi8KLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVs
