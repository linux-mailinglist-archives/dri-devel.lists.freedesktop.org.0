Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 15E2BF1232
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 10:31:44 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4745C6EC7C;
	Wed,  6 Nov 2019 09:31:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABBAB6EC77
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 09:31:26 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 093CBB40C;
 Wed,  6 Nov 2019 09:31:25 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch,
	christian.koenig@amd.com,
	noralf@tronnes.org
Subject: [PATCH 2/8] drm/qxl: Tell caller if kmap() returned I/O memory
Date: Wed,  6 Nov 2019 10:31:15 +0100
Message-Id: <20191106093121.21762-3-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106093121.21762-1-tzimmermann@suse.de>
References: <20191106093121.21762-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV0dXJuaW5nIGEgZmxhZyBmcm9tIGttYXAoKSB3aGV0aGVyIG1hcHBlZCBwYWdlcyByZWZlciB0
byBzeXN0ZW0gb3IKSS9PIG1lbW9yeS4gVGhpcyBwcmVwYXJlcyBmb3IgYSByZXNwZWN0aXZlIGNo
YW5nZSB0byB2bWFwKCkuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1l
cm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9kaXNwbGF5LmMgfCA2
ICsrKy0tLQogZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfZHJhdy5jICAgIHwgNCArKy0tCiBkcml2
ZXJzL2dwdS9kcm0vcXhsL3F4bF9kcnYuaCAgICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vcXhs
L3F4bF9vYmplY3QuYyAgfCA3ICsrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVj
dC5oICB8IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3ByaW1lLmMgICB8IDIgKy0KIDYg
ZmlsZXMgY2hhbmdlZCwgMTEgaW5zZXJ0aW9ucygrKSwgMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJt
L3F4bC9xeGxfZGlzcGxheS5jCmluZGV4IDE2ZDczYjIyZjNmNS4uODNjOGRmMmY5ZDY0IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3F4bC9xeGxfZGlzcGxheS5jCkBAIC02MDYsNyArNjA2LDcgQEAgc3RhdGljIHZvaWQg
cXhsX2N1cnNvcl9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQl1c2Vy
X2JvID0gZ2VtX3RvX3F4bF9ibyhvYmopOwogCiAJCS8qIHBpbm5pbmcgaXMgZG9uZSBpbiB0aGUg
cHJlcGFyZS9jbGVhbnVwIGZyYW1ldmJ1ZmZlciAqLwotCQlyZXQgPSBxeGxfYm9fa21hcCh1c2Vy
X2JvLCAmdXNlcl9wdHIpOworCQlyZXQgPSBxeGxfYm9fa21hcCh1c2VyX2JvLCAmdXNlcl9wdHIs
IE5VTEwpOwogCQlpZiAocmV0KQogCQkJZ290byBvdXRfZnJlZV9yZWxlYXNlOwogCkBAIC02MjQs
NyArNjI0LDcgQEAgc3RhdGljIHZvaWQgcXhsX2N1cnNvcl9hdG9taWNfdXBkYXRlKHN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lLAogCQlpZiAocmV0KQogCQkJZ290byBvdXRfdW5waW47CiAKLQkJcmV0
ID0gcXhsX2JvX2ttYXAoY3Vyc29yX2JvLCAodm9pZCAqKikmY3Vyc29yKTsKKwkJcmV0ID0gcXhs
X2JvX2ttYXAoY3Vyc29yX2JvLCAodm9pZCAqKikmY3Vyc29yLCBOVUxMKTsKIAkJaWYgKHJldCkK
IAkJCWdvdG8gb3V0X2JhY2tvZmY7CiAKQEAgLTExNjcsNyArMTE2Nyw3IEBAIGludCBxeGxfY3Jl
YXRlX21vbml0b3JzX29iamVjdChzdHJ1Y3QgcXhsX2RldmljZSAqcWRldikKIAlpZiAocmV0KQog
CQlyZXR1cm4gcmV0OwogCi0JcXhsX2JvX2ttYXAocWRldi0+bW9uaXRvcnNfY29uZmlnX2JvLCBO
VUxMKTsKKwlxeGxfYm9fa21hcChxZGV2LT5tb25pdG9yc19jb25maWdfYm8sIE5VTEwsIE5VTEwp
OwogCiAJcWRldi0+bW9uaXRvcnNfY29uZmlnID0gcWRldi0+bW9uaXRvcnNfY29uZmlnX2JvLT5r
cHRyOwogCXFkZXYtPnJhbV9oZWFkZXItPm1vbml0b3JzX2NvbmZpZyA9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9kcmF3LmMgYi9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9k
cmF3LmMKaW5kZXggNWJlYmYxZWExYzVkLi45NjJmYzFhYTAwYjcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9xeGwvcXhsX2RyYXcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9k
cmF3LmMKQEAgLTQ1LDcgKzQ1LDcgQEAgc3RhdGljIHN0cnVjdCBxeGxfcmVjdCAqZHJhd2FibGVf
c2V0X2NsaXBwaW5nKHN0cnVjdCBxeGxfZGV2aWNlICpxZGV2LAogCXN0cnVjdCBxeGxfY2xpcF9y
ZWN0cyAqZGV2X2NsaXBzOwogCWludCByZXQ7CiAKLQlyZXQgPSBxeGxfYm9fa21hcChjbGlwc19i
bywgKHZvaWQgKiopJmRldl9jbGlwcyk7CisJcmV0ID0gcXhsX2JvX2ttYXAoY2xpcHNfYm8sICh2
b2lkICoqKSZkZXZfY2xpcHMsIE5VTEwpOwogCWlmIChyZXQpIHsKIAkJcmV0dXJuIE5VTEw7CiAJ
fQpAQCAtMTk3LDcgKzE5Nyw3IEBAIHZvaWQgcXhsX2RyYXdfZGlydHlfZmIoc3RydWN0IHF4bF9k
ZXZpY2UgKnFkZXYsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfcmVsZWFzZV9iYWNrb2ZmOwogCi0J
cmV0ID0gcXhsX2JvX2ttYXAoYm8sICh2b2lkICoqKSZzdXJmYWNlX2Jhc2UpOworCXJldCA9IHF4
bF9ib19rbWFwKGJvLCAodm9pZCAqKikmc3VyZmFjZV9iYXNlLCBOVUxMKTsKIAlpZiAocmV0KQog
CQlnb3RvIG91dF9yZWxlYXNlX2JhY2tvZmY7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9xeGwvcXhsX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfZHJ2LmgKaW5kZXggMjdl
NDVhMmQ2YjUyLi5lNzQ5YzBkMGU4MTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9xeGwv
cXhsX2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX2Rydi5oCkBAIC0zNDIsNyAr
MzQyLDcgQEAgaW50IHF4bF9nZW1fb2JqZWN0X29wZW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpv
YmosIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKIHZvaWQgcXhsX2dlbV9vYmplY3RfY2xv
c2Uoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmls
ZV9wcml2KTsKIHZvaWQgcXhsX2JvX2ZvcmNlX2RlbGV0ZShzdHJ1Y3QgcXhsX2RldmljZSAqcWRl
dik7Ci1pbnQgcXhsX2JvX2ttYXAoc3RydWN0IHF4bF9ibyAqYm8sIHZvaWQgKipwdHIpOworaW50
IHF4bF9ib19rbWFwKHN0cnVjdCBxeGxfYm8gKmJvLCB2b2lkICoqcHRyLCBib29sICppc19pb21l
bSk7CiAKIC8qIHF4bF9kdW1iLmMgKi8KIGludCBxeGxfbW9kZV9kdW1iX2NyZWF0ZShzdHJ1Y3Qg
ZHJtX2ZpbGUgKmZpbGVfcHJpdiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhs
X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKaW5kZXggYWI3MmRj
MzQ3NmU5Li44NTA3YWMyYzdkNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhs
X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jCkBAIC0xNDMs
OSArMTQzLDggQEAgaW50IHF4bF9ib19jcmVhdGUoc3RydWN0IHF4bF9kZXZpY2UgKnFkZXYsCiAJ
cmV0dXJuIDA7CiB9CiAKLWludCBxeGxfYm9fa21hcChzdHJ1Y3QgcXhsX2JvICpibywgdm9pZCAq
KnB0cikKK2ludCBxeGxfYm9fa21hcChzdHJ1Y3QgcXhsX2JvICpibywgdm9pZCAqKnB0ciwgYm9v
bCAqaXNfaW9tZW0pCiB7Ci0JYm9vbCBpc19pb21lbTsKIAlpbnQgcjsKIAogCWlmIChiby0+a3B0
cikgewpAQCAtMTU3LDcgKzE1Niw3IEBAIGludCBxeGxfYm9fa21hcChzdHJ1Y3QgcXhsX2JvICpi
bywgdm9pZCAqKnB0cikKIAlyID0gdHRtX2JvX2ttYXAoJmJvLT50Ym8sIDAsIGJvLT50Ym8ubnVt
X3BhZ2VzLCAmYm8tPmttYXApOwogCWlmIChyKQogCQlyZXR1cm4gcjsKLQliby0+a3B0ciA9IHR0
bV9rbWFwX29ial92aXJ0dWFsKCZiby0+a21hcCwgJmlzX2lvbWVtKTsKKwliby0+a3B0ciA9IHR0
bV9rbWFwX29ial92aXJ0dWFsKCZiby0+a21hcCwgaXNfaW9tZW0pOwogCWlmIChwdHIpCiAJCSpw
dHIgPSBiby0+a3B0cjsKIAliby0+bWFwX2NvdW50ID0gMTsKQEAgLTE4Nyw3ICsxODYsNyBAQCB2
b2lkICpxeGxfYm9fa21hcF9hdG9taWNfcGFnZShzdHJ1Y3QgcXhsX2RldmljZSAqcWRldiwKIAkJ
cmV0dXJuIHJwdHI7CiAJfQogCi0JcmV0ID0gcXhsX2JvX2ttYXAoYm8sICZycHRyKTsKKwlyZXQg
PSBxeGxfYm9fa21hcChibywgJnJwdHIsIE5VTEwpOwogCWlmIChyZXQpCiAJCXJldHVybiBOVUxM
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9vYmplY3QuaCBiL2RyaXZl
cnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5oCmluZGV4IDhhZTU0YmE3ODU3Yy4uNzljYjM2M2Iz
YjhiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9vYmplY3QuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vcXhsL3F4bF9vYmplY3QuaApAQCAtOTEsNyArOTEsNyBAQCBleHRlcm4g
aW50IHF4bF9ib19jcmVhdGUoc3RydWN0IHF4bF9kZXZpY2UgKnFkZXYsCiAJCQkgYm9vbCBrZXJu
ZWwsIGJvb2wgcGlubmVkLCB1MzIgZG9tYWluLAogCQkJIHN0cnVjdCBxeGxfc3VyZmFjZSAqc3Vy
ZiwKIAkJCSBzdHJ1Y3QgcXhsX2JvICoqYm9fcHRyKTsKLWV4dGVybiBpbnQgcXhsX2JvX2ttYXAo
c3RydWN0IHF4bF9ibyAqYm8sIHZvaWQgKipwdHIpOworZXh0ZXJuIGludCBxeGxfYm9fa21hcChz
dHJ1Y3QgcXhsX2JvICpibywgdm9pZCAqKnB0ciwgYm9vbCAqaXNfaW9tZW0pOwogZXh0ZXJuIHZv
aWQgcXhsX2JvX2t1bm1hcChzdHJ1Y3QgcXhsX2JvICpibyk7CiB2b2lkICpxeGxfYm9fa21hcF9h
dG9taWNfcGFnZShzdHJ1Y3QgcXhsX2RldmljZSAqcWRldiwgc3RydWN0IHF4bF9ibyAqYm8sIGlu
dCBwYWdlX29mZnNldCk7CiB2b2lkIHF4bF9ib19rdW5tYXBfYXRvbWljX3BhZ2Uoc3RydWN0IHF4
bF9kZXZpY2UgKnFkZXYsIHN0cnVjdCBxeGxfYm8gKmJvLCB2b2lkICptYXApOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfcHJpbWUuYyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwv
cXhsX3ByaW1lLmMKaW5kZXggN2QzODE2ZmNhNWE4Li5lNjdlYmJkZWI3ZjIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3ByaW1lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3F4
bC9xeGxfcHJpbWUuYwpAQCAtNjAsNyArNjAsNyBAQCB2b2lkICpxeGxfZ2VtX3ByaW1lX3ZtYXAo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiAJdm9pZCAqcHRyOwogCWludCByZXQ7CiAKLQly
ZXQgPSBxeGxfYm9fa21hcChibywgJnB0cik7CisJcmV0ID0gcXhsX2JvX2ttYXAoYm8sICZwdHIs
IE5VTEwpOwogCWlmIChyZXQgPCAwKQogCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCi0tIAoyLjIz
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
