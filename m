Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1B703F41DD
	for <lists+dri-devel@lfdr.de>; Fri,  8 Nov 2019 09:14:12 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 38F336F891;
	Fri,  8 Nov 2019 08:13:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from gloria.sntech.de (gloria.sntech.de [185.11.138.130])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4ECCC6F817
 for <dri-devel@lists.freedesktop.org>; Fri,  8 Nov 2019 00:03:10 +0000 (UTC)
Received: from ip5f5a6266.dynamic.kabel-deutschland.de ([95.90.98.102]
 helo=phil.fritz.box)
 by gloria.sntech.de with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128)
 (Exim 4.89) (envelope-from <heiko.stuebner@theobroma-systems.com>)
 id 1iSrk1-00065H-HQ; Fri, 08 Nov 2019 01:03:05 +0100
From: Heiko Stuebner <heiko.stuebner@theobroma-systems.com>
To: dri-devel@lists.freedesktop.org,
	a.hajda@samsung.com
Subject: [PATCH v2 3/5] drm/rockchip: add ability to handle external dphys in
 mipi-dsi
Date: Fri,  8 Nov 2019 01:02:51 +0100
Message-Id: <20191108000253.8560-4-heiko.stuebner@theobroma-systems.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191108000253.8560-1-heiko.stuebner@theobroma-systems.com>
References: <20191108000253.8560-1-heiko.stuebner@theobroma-systems.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Fri, 08 Nov 2019 08:12:31 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: mark.rutland@arm.com, devicetree@vger.kernel.org, jernej.skrabec@siol.net,
 jonas@kwiboo.se, linux-kernel@vger.kernel.org, narmstrong@baylibre.com,
 philippe.cornu@st.com, yannick.fertre@st.com,
 linux-rockchip@lists.infradead.org, robh+dt@kernel.org,
 Laurent.pinchart@ideasonboard.com,
 Heiko Stuebner <heiko.stuebner@theobroma-systems.com>,
 linux-arm-kernel@lists.infradead.org, christoph.muellner@theobroma-systems.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2hpbGUgdGhlIGNvbW1vbiBjYXNlIGlzIHRoYXQgdGhlIGRzaSBjb250cm9sbGVyIHVzZXMgYW4g
aW50ZXJuYWwgZHBoeSwKYWNjZXNzZWQgdGhyb3VnaCB0aGUgcGh5IHJlZ2lzdGVycyBpbnNpZGUg
dGhlIGRzaSBjb250cm9sbGVyLCB0aGVyZSBpcwphbHNvIHRoZSBwb3NzaWJpbGl0eSB0byB1c2Ug
YSBzZXBhcmF0ZSBkcGh5IGZyb20gYSBkaWZmZXJlbnQgdmVuZG9yLgoKT25lIHN1Y2ggY2FzZSBp
cyB0aGUgUm9ja2NoaXAgcHgzMCB0aGF0IHVzZXMgYSBJbm5vc2lsaWNvbiBNaXBpIGRwaHksCnNv
IGFkZCB0aGUgc3VwcG9ydCBmb3IgaGFuZGxpbmcgc3VjaCBhIGNvbnN0ZWxsYXRpb24sIGluY2x1
ZGluZyB0aGUgcGxsCmFsc28gZ2V0dGluZyBnZW5lcmF0ZWQgaW5zaWRlIHRoYXQgZXh0ZXJuYWwg
cGh5LgoKU2lnbmVkLW9mZi1ieTogSGVpa28gU3R1ZWJuZXIgPGhlaWtvLnN0dWVibmVyQHRoZW9i
cm9tYS1zeXN0ZW1zLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9yb2NrY2hpcC9kdy1taXBpLWRzaS1y
b2NrY2hpcC5jICAgfCA2OCArKysrKysrKysrKysrKysrKy0tCiAxIGZpbGUgY2hhbmdlZCwgNjQg
aW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vcm9ja2NoaXAvZHctbWlwaS1kc2ktcm9ja2NoaXAuYyBiL2RyaXZlcnMvZ3B1L2RybS9yb2Nr
Y2hpcC9kdy1taXBpLWRzaS1yb2NrY2hpcC5jCmluZGV4IGJjMDczZWM1YzE4My4uMWU2NTc4Zjkx
MWEwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvZHctbWlwaS1kc2ktcm9j
a2NoaXAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvZHctbWlwaS1kc2ktcm9ja2No
aXAuYwpAQCAtMTIsNiArMTIsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21mZC9zeXNjb24uaD4KICNp
bmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2UuaD4KKyNp
bmNsdWRlIDxsaW51eC9waHkvcGh5Lmg+CiAjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgog
I2luY2x1ZGUgPGxpbnV4L3JlZ21hcC5oPgogCkBAIC0yMjMsNiArMjI0LDEwIEBAIHN0cnVjdCBk
d19taXBpX2RzaV9yb2NrY2hpcCB7CiAJYm9vbCBpc19zbGF2ZTsKIAlzdHJ1Y3QgZHdfbWlwaV9k
c2lfcm9ja2NoaXAgKnNsYXZlOwogCisJLyogb3B0aW9uYWwgZXh0ZXJuYWwgZHBoeSAqLworCXN0
cnVjdCBwaHkgKnBoeTsKKwl1bmlvbiBwaHlfY29uZmlndXJlX29wdHMgcGh5X29wdHM7CisKIAl1
bnNpZ25lZCBpbnQgbGFuZV9tYnBzOyAvKiBwZXIgbGFuZSAqLwogCXUxNiBpbnB1dF9kaXY7CiAJ
dTE2IGZlZWRiYWNrX2RpdjsKQEAgLTM1OSw2ICszNjQsOSBAQCBzdGF0aWMgaW50IGR3X21pcGlf
ZHNpX3BoeV9pbml0KHZvaWQgKnByaXZfZGF0YSkKIAlzdHJ1Y3QgZHdfbWlwaV9kc2lfcm9ja2No
aXAgKmRzaSA9IHByaXZfZGF0YTsKIAlpbnQgcmV0LCBpLCB2Y287CiAKKwlpZiAoZHNpLT5waHkp
CisJCXJldHVybiAwOworCiAJLyoKIAkgKiBHZXQgdmNvIGZyb20gZnJlcXVlbmN5KGxhbmVfbWJw
cykKIAkgKiB2Y28JZnJlcXVlbmN5IHRhYmxlCkBAIC00NjcsNiArNDc1LDI4IEBAIHN0YXRpYyBp
bnQgZHdfbWlwaV9kc2lfcGh5X2luaXQodm9pZCAqcHJpdl9kYXRhKQogCXJldHVybiByZXQ7CiB9
CiAKK3N0YXRpYyB2b2lkIGR3X21pcGlfZHNpX3BoeV9wb3dlcl9vbih2b2lkICpwcml2X2RhdGEp
Cit7CisJc3RydWN0IGR3X21pcGlfZHNpX3JvY2tjaGlwICpkc2kgPSBwcml2X2RhdGE7CisJaW50
IHJldDsKKworCXJldCA9IHBoeV9zZXRfbW9kZShkc2ktPnBoeSwgUEhZX01PREVfTUlQSV9EUEhZ
KTsKKwlpZiAocmV0KSB7CisJCURSTV9ERVZfRVJST1IoZHNpLT5kZXYsICJmYWlsZWQgdG8gc2V0
IHBoeSBtb2RlOiAlZFxuIiwgcmV0KTsKKwkJcmV0dXJuOworCX0KKworCXBoeV9jb25maWd1cmUo
ZHNpLT5waHksICZkc2ktPnBoeV9vcHRzKTsKKwlwaHlfcG93ZXJfb24oZHNpLT5waHkpOworfQor
CitzdGF0aWMgdm9pZCBkd19taXBpX2RzaV9waHlfcG93ZXJfb2ZmKHZvaWQgKnByaXZfZGF0YSkK
K3sKKwlzdHJ1Y3QgZHdfbWlwaV9kc2lfcm9ja2NoaXAgKmRzaSA9IHByaXZfZGF0YTsKKworCXBo
eV9wb3dlcl9vZmYoZHNpLT5waHkpOworfQorCiBzdGF0aWMgaW50CiBkd19taXBpX2RzaV9nZXRf
bGFuZV9tYnBzKHZvaWQgKnByaXZfZGF0YSwgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsCiAJCQkgIHVuc2lnbmVkIGxvbmcgbW9kZV9mbGFncywgdTMyIGxhbmVzLCB1MzIgZm9y
bWF0LApAQCAtNTA0LDYgKzUzNCwxNyBAQCBkd19taXBpX2RzaV9nZXRfbGFuZV9tYnBzKHZvaWQg
KnByaXZfZGF0YSwgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJCQkJICAg
ICAgIkRQSFkgY2xvY2sgZnJlcXVlbmN5IGlzIG91dCBvZiByYW5nZVxuIik7CiAJfQogCisJLyog
Zm9yIGV4dGVybmFsIHBoeSBvbmx5IGEgdGhlIG1pcGlfZHBoeV9jb25maWcgaXMgbmVjZXNzYXJ5
ICovCisJaWYgKGRzaS0+cGh5KSB7CisJCXBoeV9taXBpX2RwaHlfZ2V0X2RlZmF1bHRfY29uZmln
KG1vZGUtPmNsb2NrICogMTAwMCAqIDEwIC8gOCwKKwkJCQkJCSBicHAsIGxhbmVzLAorCQkJCQkJ
ICZkc2ktPnBoeV9vcHRzLm1pcGlfZHBoeSk7CisJCWRzaS0+bGFuZV9tYnBzID0gdGFyZ2V0X21i
cHM7CisJCSpsYW5lX21icHMgPSBkc2ktPmxhbmVfbWJwczsKKworCQlyZXR1cm4gMDsKKwl9CisK
IAlmaW4gPSBjbGtfZ2V0X3JhdGUoZHNpLT5wbGxyZWZfY2xrKTsKIAlmb3V0ID0gdGFyZ2V0X21i
cHMgKiBVU0VDX1BFUl9TRUM7CiAKQEAgLTU2MSw2ICs2MDIsOCBAQCBkd19taXBpX2RzaV9nZXRf
bGFuZV9tYnBzKHZvaWQgKnByaXZfZGF0YSwgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsCiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHdfbWlwaV9kc2lfcGh5X29wcyBkd19taXBp
X2RzaV9yb2NrY2hpcF9waHlfb3BzID0gewogCS5pbml0ID0gZHdfbWlwaV9kc2lfcGh5X2luaXQs
CisJLnBvd2VyX29uID0gZHdfbWlwaV9kc2lfcGh5X3Bvd2VyX29uLAorCS5wb3dlcl9vZmYgPSBk
d19taXBpX2RzaV9waHlfcG93ZXJfb2ZmLAogCS5nZXRfbGFuZV9tYnBzID0gZHdfbWlwaV9kc2lf
Z2V0X2xhbmVfbWJwcywKIH07CiAKQEAgLTkyMCwxMiArOTYzLDI5IEBAIHN0YXRpYyBpbnQgZHdf
bWlwaV9kc2lfcm9ja2NoaXBfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAJfQogCisJLyogdHJ5IHRvIGdldCBhIHBvc3NpYmxlIGV4dGVybmFs
IGRwaHkgKi8KKwlkc2ktPnBoeSA9IGRldm1fcGh5X29wdGlvbmFsX2dldChkZXYsICJkcGh5Iik7
CisJaWYgKElTX0VSUihkc2ktPnBoeSkpIHsKKwkJcmV0ID0gUFRSX0VSUihkc2ktPnBoeSk7CisJ
CURSTV9ERVZfRVJST1IoZGV2LCAiZmFpbGVkIHRvIGdldCBtaXBpIGRwaHk6ICVkXG4iLCByZXQp
OworCQlyZXR1cm4gcmV0OworCX0KKwogCWRzaS0+cGxscmVmX2NsayA9IGRldm1fY2xrX2dldChk
ZXYsICJyZWYiKTsKIAlpZiAoSVNfRVJSKGRzaS0+cGxscmVmX2NsaykpIHsKLQkJcmV0ID0gUFRS
X0VSUihkc2ktPnBsbHJlZl9jbGspOwotCQlEUk1fREVWX0VSUk9SKGRldiwKLQkJCSAgICAgICJV
bmFibGUgdG8gZ2V0IHBsbCByZWZlcmVuY2UgY2xvY2s6ICVkXG4iLCByZXQpOwotCQlyZXR1cm4g
cmV0OworCQlpZiAoZHNpLT5waHkpIHsKKwkJCS8qCisJCQkgKiBpZiBleHRlcm5hbCBwaHkgaXMg
cHJlc2VudCwgcGxsIHdpbGwgYmUKKwkJCSAqIGdlbmVyYXRlZCB0aGVyZS4KKwkJCSAqLworCQkJ
ZHNpLT5wbGxyZWZfY2xrID0gTlVMTDsKKwkJfSBlbHNlIHsKKwkJCXJldCA9IFBUUl9FUlIoZHNp
LT5wbGxyZWZfY2xrKTsKKwkJCURSTV9ERVZfRVJST1IoZGV2LAorCQkJCSAgICAgICJVbmFibGUg
dG8gZ2V0IHBsbCByZWZlcmVuY2UgY2xvY2s6ICVkXG4iLAorCQkJCSAgICAgIHJldCk7CisJCQly
ZXR1cm4gcmV0OworCQl9CiAJfQogCiAJaWYgKGRzaS0+Y2RhdGEtPmZsYWdzICYgRFdfTUlQSV9O
RUVEU19QSFlfQ0ZHX0NMSykgewotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
