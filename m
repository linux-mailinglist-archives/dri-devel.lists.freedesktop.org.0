Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4BBD32D8EF5
	for <lists+dri-devel@lfdr.de>; Sun, 13 Dec 2020 18:07:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0BA3C89F2A;
	Sun, 13 Dec 2020 17:07:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3E30A89EEB;
 Sun, 13 Dec 2020 17:07:18 +0000 (UTC)
IronPort-SDR: p5TcyEfyvHb8xoWLydxMcMgP8X0Cp/bj8EOzKxkSPkd4Mp2aPegq1fo0BWrlvpFa4jAIgsiq7e
 jVOlBbFXOlhA==
X-IronPort-AV: E=McAfee;i="6000,8403,9834"; a="172050583"
X-IronPort-AV: E=Sophos;i="5.78,416,1599548400"; d="scan'208";a="172050583"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 13 Dec 2020 09:07:17 -0800
IronPort-SDR: 1Bw+O7ywM7xyE6TTeFX1LAezgr2ryaZ6liwnM7TSj8WAaGP2l56jGXakH1dP8sB9qK2nmCJ0l0
 PBrPY1SU/Y+w==
X-IronPort-AV: E=Sophos;i="5.78,416,1599548400"; d="scan'208";a="366739089"
Received: from ihazan-mobl1.ger.corp.intel.com (HELO josouza-mobl2.intel.com)
 ([10.255.70.79])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 13 Dec 2020 09:07:14 -0800
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/damage_helper: Check if damage clips has valid values
Date: Sun, 13 Dec 2020 09:07:28 -0800
Message-Id: <20201213170728.290406-1-jose.souza@intel.com>
X-Mailer: git-send-email 2.29.2
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Deepak Rawat <drawat@vmware.com>, Sean Paul <seanpaul@chromium.org>,
 =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>,
 Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXNlcnNwYWNlIGNhbiBzZXQgYSBkYW1hZ2UgY2xpcCB3aXRoIGEgbmVnYXRpdmUgY29vcmRpbmF0
ZSwgbmVnYXRpdmUKd2lkdGggb3IgaGVpZ2h0IG9yIGxhcmdlciB0aGFuIHRoZSBwbGFuZS4KVGhp
cyBpbnZhbGlkIHZhbHVlcyBjb3VsZCBjYXVzZSBpc3N1ZXMgaW4gc29tZSBIVyBvciBldmVuIHdv
cnN0IGVuYWJsZQpzZWN1cml0eSBmbGF3cy4KCkNjOiBHd2FuLWd5ZW9uZyBNdW4gPGd3YW4tZ3ll
b25nLm11bkBpbnRlbC5jb20+CkNjOiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4K
Q2M6IEZhYmlvIEVzdGV2YW0gPGZlc3RldmFtQGdtYWlsLmNvbT4KQ2M6IERlZXBhayBSYXdhdCA8
ZHJhd2F0QHZtd2FyZS5jb20+CkNjOiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClNp
Z25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jIHwgIDQgKystCiBkcml2
ZXJzL2dwdS9kcm0vZHJtX2RhbWFnZV9oZWxwZXIuYyB8IDQ5ICsrKysrKysrKysrKysrKysrKysr
KysrLS0tLS0tCiBpbmNsdWRlL2RybS9kcm1fZGFtYWdlX2hlbHBlci5oICAgICB8ICA0ICstLQog
MyBmaWxlcyBjaGFuZ2VkLCA0NSBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fYXRvbWljX2hlbHBlci5jCmluZGV4IGJhMTUwNzAzNmYyNi4uYzZiMzQxZWNhZTJj
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwpAQCAtODk3LDcgKzg5Nyw5IEBAIGRy
bV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiAJ
CWRybV9hdG9taWNfaGVscGVyX3BsYW5lX2NoYW5nZWQoc3RhdGUsIG9sZF9wbGFuZV9zdGF0ZSwg
bmV3X3BsYW5lX3N0YXRlLCBwbGFuZSk7CiAKLQkJZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxh
bmVfZGFtYWdlKHN0YXRlLCBuZXdfcGxhbmVfc3RhdGUpOworCQlyZXQgPSBkcm1fYXRvbWljX2hl
bHBlcl9jaGVja19wbGFuZV9kYW1hZ2Uoc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CisJCWlmIChy
ZXQpCisJCQlyZXR1cm4gcmV0OwogCiAJCWlmICghZnVuY3MgfHwgIWZ1bmNzLT5hdG9taWNfY2hl
Y2spCiAJCQljb250aW51ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZGFtYWdl
X2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9kYW1hZ2VfaGVscGVyLmMKaW5kZXggM2E0
MTI2ZGMyNTIwLi45YWRiMzY5NDQwYmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
ZGFtYWdlX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZGFtYWdlX2hlbHBlci5j
CkBAIC0xMDQsMzYgKzEwNCw2NyBAQCB2b2lkIGRybV9wbGFuZV9lbmFibGVfZmJfZGFtYWdlX2Ns
aXBzKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKQogRVhQT1JUX1NZTUJPTChkcm1fcGxhbmVfZW5h
YmxlX2ZiX2RhbWFnZV9jbGlwcyk7CiAKIC8qKgotICogZHJtX2F0b21pY19oZWxwZXJfY2hlY2tf
cGxhbmVfZGFtYWdlIC0gVmVyaWZ5IHBsYW5lIGRhbWFnZSBvbiBhdG9taWNfY2hlY2suCisgKiBk
cm1fYXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9kYW1hZ2UgLSBWZXJpZnkgcGxhbmUgZGFtYWdl
IGNsaXBzIG9uCisgKiBhdG9taWNfY2hlY2suCiAgKiBAc3RhdGU6IFRoZSBkcml2ZXIgc3RhdGUg
b2JqZWN0LgotICogQHBsYW5lX3N0YXRlOiBQbGFuZSBzdGF0ZSBmb3Igd2hpY2ggdG8gdmVyaWZ5
IGRhbWFnZS4KKyAqIEBwbGFuZV9zdGF0ZTogUGxhbmUgc3RhdGUgZm9yIHdoaWNoIHRvIHZlcmlm
eSBkYW1hZ2UgY2xpcHMuCiAgKgotICogVGhpcyBoZWxwZXIgZnVuY3Rpb24gbWFrZXMgc3VyZSB0
aGF0IGRhbWFnZSBmcm9tIHBsYW5lIHN0YXRlIGlzIGRpc2NhcmRlZAotICogZm9yIGZ1bGwgbW9k
ZXNldC4gSWYgdGhlcmUgYXJlIG1vcmUgcmVhc29ucyBhIGRyaXZlciB3b3VsZCB3YW50IHRvIGRv
IGEgZnVsbAotICogcGxhbmUgdXBkYXRlIHJhdGhlciB0aGFuIHByb2Nlc3NpbmcgaW5kaXZpZHVh
bCBkYW1hZ2UgcmVnaW9ucywgdGhlbiB0aG9zZQotICogY2FzZXMgc2hvdWxkIGJlIHRha2VuIGNh
cmUgb2YgaGVyZS4KKyAqIFRoaXMgaGVscGVyIGNoZWNrcyBpZiBhbGwgZGFtYWdlIGNsaXBzIGhh
cyB2YWxpZCB2YWx1ZXMgYW5kIG1ha2VzIHN1cmUgdGhhdAorICogZGFtYWdlIGNsaXBzIGZyb20g
cGxhbmUgc3RhdGUgaXMgZGlzY2FyZGVkIGZvciBmdWxsIG1vZGVzZXQuIElmIHRoZXJlIGFyZQor
ICogbW9yZSByZWFzb25zIGEgZHJpdmVyIHdvdWxkIHdhbnQgdG8gZG8gYSBmdWxsIHBsYW5lIHVw
ZGF0ZSByYXRoZXIgdGhhbgorICogcHJvY2Vzc2luZyBpbmRpdmlkdWFsIGRhbWFnZSByZWdpb25z
LCB0aGVuIHRob3NlIGNhc2VzIHNob3VsZCBiZSB0YWtlbiBjYXJlCisgKiBvZiBoZXJlLgogICoK
ICAqIE5vdGUgdGhhdCAmZHJtX3BsYW5lX3N0YXRlLmZiX2RhbWFnZV9jbGlwcyA9PSBOVUxMIGlu
IHBsYW5lIHN0YXRlIG1lYW5zIHRoYXQKICAqIGZ1bGwgcGxhbmUgdXBkYXRlIHNob3VsZCBoYXBw
ZW4uIEl0IGFsc28gZW5zdXJlIGhlbHBlciBpdGVyYXRvciB3aWxsIHJldHVybgogICogJmRybV9w
bGFuZV9zdGF0ZS5zcmMgYXMgZGFtYWdlLgorICoKKyAqIFJldHVybjogWmVybyBvbiBzdWNjZXNz
LCBuZWdhdGl2ZSBlcnJubyBvbiBmYWlsdXJlLgogICovCi12b2lkIGRybV9hdG9taWNfaGVscGVy
X2NoZWNrX3BsYW5lX2RhbWFnZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0JCQkJ
CSAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCitpbnQgZHJtX2F0b21pY19o
ZWxwZXJfY2hlY2tfcGxhbmVfZGFtYWdlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwK
KwkJCQkJIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogeworCXN0cnVjdCBk
cm1fbW9kZV9yZWN0ICpkYW1hZ2VkX2NsaXBzOwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZTsKKwl1bnNpZ25lZCBpbnQgbnVtX2NsaXBzLCB3LCBoOworCisJbnVtX2NsaXBzID0g
ZHJtX3BsYW5lX2dldF9kYW1hZ2VfY2xpcHNfY291bnQocGxhbmVfc3RhdGUpOworCWlmICghbnVt
X2NsaXBzKQorCQlyZXR1cm4gMDsKIAogCWlmIChwbGFuZV9zdGF0ZS0+Y3J0YykgewogCQljcnRj
X3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsCiAJCQkJCQkJICAg
cGxhbmVfc3RhdGUtPmNydGMpOwogCiAJCWlmIChXQVJOX09OKCFjcnRjX3N0YXRlKSkKLQkJCXJl
dHVybjsKKwkJCXJldHVybiAwOwogCiAJCWlmIChkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNl
dChjcnRjX3N0YXRlKSkgewogCQkJZHJtX3Byb3BlcnR5X2Jsb2JfcHV0KHBsYW5lX3N0YXRlLT5m
Yl9kYW1hZ2VfY2xpcHMpOwogCQkJcGxhbmVfc3RhdGUtPmZiX2RhbWFnZV9jbGlwcyA9IE5VTEw7
CisJCQlyZXR1cm4gMDsKIAkJfQogCX0KKworCXcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3Rh
dGUtPnNyYykgPj4gMTY7CisJaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnNyYykg
Pj4gMTY7CisJZGFtYWdlZF9jbGlwcyA9IGRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBzKHBsYW5l
X3N0YXRlKTsKKworCWZvciAoOyBudW1fY2xpcHM7IG51bV9jbGlwcy0tLCBkYW1hZ2VkX2NsaXBz
KyspIHsKKwkJaWYgKGRhbWFnZWRfY2xpcHMtPngxIDwgMCB8fCBkYW1hZ2VkX2NsaXBzLT54MiA8
IDAgfHwKKwkJICAgIGRhbWFnZWRfY2xpcHMtPnkxIDwgMCB8fCBkYW1hZ2VkX2NsaXBzLT55MiA8
IDApCisJCQlyZXR1cm4gLUVJTlZBTDsKKworCQlpZiAoZGFtYWdlZF9jbGlwcy0+eDIgPCBkYW1h
Z2VkX2NsaXBzLT54MSB8fAorCQkgICAgZGFtYWdlZF9jbGlwcy0+eTIgPCBkYW1hZ2VkX2NsaXBz
LT55MSkKKwkJCXJldHVybiAtRUlOVkFMOworCisJCWlmICgoZGFtYWdlZF9jbGlwcy0+eDIgLSBk
YW1hZ2VkX2NsaXBzLT54MSkgPiB3IHx8CisJCSAgICAoZGFtYWdlZF9jbGlwcy0+eTIgLSBkYW1h
Z2VkX2NsaXBzLT55MSkgPiBoKQorCQkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0dXJuIDA7
CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lX2RhbWFnZSk7
CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9kYW1hZ2VfaGVscGVyLmggYi9pbmNsdWRl
L2RybS9kcm1fZGFtYWdlX2hlbHBlci5oCmluZGV4IDQwYzM0YTViZjE0OS4uNWUzNDRkMWEyYjIy
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fZGFtYWdlX2hlbHBlci5oCisrKyBiL2luY2x1
ZGUvZHJtL2RybV9kYW1hZ2VfaGVscGVyLmgKQEAgLTY1LDggKzY1LDggQEAgc3RydWN0IGRybV9h
dG9taWNfaGVscGVyX2RhbWFnZV9pdGVyIHsKIH07CiAKIHZvaWQgZHJtX3BsYW5lX2VuYWJsZV9m
Yl9kYW1hZ2VfY2xpcHMoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUpOwotdm9pZCBkcm1fYXRvbWlj
X2hlbHBlcl9jaGVja19wbGFuZV9kYW1hZ2Uoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
LAotCQkJCQkgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKK2ludCBkcm1f
YXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9kYW1hZ2Uoc3RydWN0IGRybV9hdG9taWNfc3RhdGUg
KnN0YXRlLAorCQkJCQkgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogaW50
IGRybV9hdG9taWNfaGVscGVyX2RpcnR5ZmIoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJ
CQkgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzLAog
CQkJICAgICAgdW5zaWduZWQgaW50IGNvbG9yLCBzdHJ1Y3QgZHJtX2NsaXBfcmVjdCAqY2xpcHMs
Ci0tIAoyLjI5LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bAo=
