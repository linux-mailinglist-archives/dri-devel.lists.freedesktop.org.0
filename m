Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 75AB82B5096
	for <lists+dri-devel@lfdr.de>; Mon, 16 Nov 2020 20:14:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 419CF89B22;
	Mon, 16 Nov 2020 19:14:33 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x641.google.com (mail-ej1-x641.google.com
 [IPv6:2a00:1450:4864:20::641])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1F34689B22
 for <dri-devel@lists.freedesktop.org>; Mon, 16 Nov 2020 19:14:31 +0000 (UTC)
Received: by mail-ej1-x641.google.com with SMTP id f23so26055561ejk.2
 for <dri-devel@lists.freedesktop.org>; Mon, 16 Nov 2020 11:14:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=9RcHkU7RWibujPr6chkIf9Z7EwX1mrx4T1WqhehngFk=;
 b=SibV6ERlN9qUa+O+HBwLqOQjGziU4NFGiCN+6igODVBaUf1Ee5bPINFcFvCQ/bsYQz
 BuKWDLCtBrddauOwOhkgGxudd1NjvTMtZ7h7hLd4sk8TK0C6aNOz8CzCV2RCX2L1jPDa
 auaHU3R+IJstEdV5M+MDN6zU7yOH7OIWa2F93o//D4sqkpNhXFJBLikCajIsKNzl0W4w
 lyRluIN8X9TEMmo40M0Qsuq8IlOMr0zNOruQBqrCiIC+qe/t1KUJeLXY/dHLBHNj7El+
 zlaH3i9r+RyAuwiucM3i/s747v831whegroPM2aRF4IYOdXNqBUaLrsEEmQxfGSC2ITG
 qnGA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=9RcHkU7RWibujPr6chkIf9Z7EwX1mrx4T1WqhehngFk=;
 b=M3Wat51iSPwrdjKtoMXB35SeR4GSpyYT8NUJPDizJAKNYQNIbEbrk2wXCxRbtJCTtu
 8DU/WZQqrzvSz29w+bRwhNlRrR89GtG/61nbV0TkQxstnap9ZA95N2xKUK5fmDqhu6XF
 ilRuvLnzKFGWACrsOGqhFJ02OC+G6qqN55fqje/iFsiBQYz4052aujoL2n71bEBVKRVw
 ahCanZeCHMz9oY/l6NvmN100M3fAPcyKo5nW1hBgs6eETg49gwYIqj53+t2rAPejaYva
 Zds8o42hWR68ZTp8NKyZ1H00vcCOlYYB8E3+UpPNZQHKxiinBTSjoYvS5mztSVYvdLEz
 aHiQ==
X-Gm-Message-State: AOAM533QvYRLoV8lWL6rJ6I/Gu+A2IzlXKn3k4uXwWR3P4GPkt6GfGIM
 hfNwhNGPWJqxVsRC0mYeook=
X-Google-Smtp-Source: ABdhPJxD8eBT77HsVqR3BpNmk/aBkXttKskAC7aX0NMUKxUxoolkpnr5vnVY7wVnrEp2cWeFaSornA==
X-Received: by 2002:a17:906:53d1:: with SMTP id
 p17mr3736964ejo.158.1605554070562; 
 Mon, 16 Nov 2020 11:14:30 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:dba0:d379:de47:24df])
 by smtp.gmail.com with ESMTPSA id cz14sm11179967edb.46.2020.11.16.11.14.29
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 16 Nov 2020 11:14:30 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: airlied@gmail.com,
	dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/amdgpu: fix check oder in amdgpu_bo_move
Date: Mon, 16 Nov 2020 20:14:29 +0100
Message-Id: <20201116191429.1636-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVvcmRlciB0aGUgY29kZSB0byBmaXggY2hlY2tpbmcgaWYgYmxpdHRpbmcgaXMgYXZhaWxhYmxl
LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQu
Y29tPgpGaXhlczogZjVhODlhNWNhZTgxIGRybS9hbWRncHUvdHRtOiB1c2UgbXVsdGlob3AKLS0t
CiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgfCA1MyArKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMjMgaW5zZXJ0aW9ucygrKSwgMzAgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCmluZGV4IDY3
NmZiNTIwZTA0NC4uYzQzOGQyOTBhNmRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3R0bS5jCkBAIC01NTEsMjUgKzU1MSwxMiBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19tb3Zl
KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3QsCiAJc3RydWN0IHR0bV9y
ZXNvdXJjZSAqb2xkX21lbSA9ICZiby0+bWVtOwogCWludCByOwogCi0JaWYgKChvbGRfbWVtLT5t
ZW1fdHlwZSA9PSBUVE1fUExfU1lTVEVNICYmCi0JICAgICBuZXdfbWVtLT5tZW1fdHlwZSA9PSBU
VE1fUExfVlJBTSkgfHwKLQkgICAgKG9sZF9tZW0tPm1lbV90eXBlID09IFRUTV9QTF9WUkFNICYm
Ci0JICAgICBuZXdfbWVtLT5tZW1fdHlwZSA9PSBUVE1fUExfU1lTVEVNKSkgewotCQlob3AtPmZw
Zm4gPSAwOwotCQlob3AtPmxwZm4gPSAwOwotCQlob3AtPm1lbV90eXBlID0gVFRNX1BMX1RUOwot
CQlob3AtPmZsYWdzID0gMDsKLQkJcmV0dXJuIC1FTVVMVElIT1A7Ci0JfQotCiAJaWYgKG5ld19t
ZW0tPm1lbV90eXBlID09IFRUTV9QTF9UVCkgewogCQlyID0gYW1kZ3B1X3R0bV9iYWNrZW5kX2Jp
bmQoYm8tPmJkZXYsIGJvLT50dG0sIG5ld19tZW0pOwogCQlpZiAocikKIAkJCXJldHVybiByOwog
CX0KIAotCWFtZGdwdV9ib19tb3ZlX25vdGlmeShibywgZXZpY3QsIG5ld19tZW0pOwotCiAJLyog
Q2FuJ3QgbW92ZSBhIHBpbm5lZCBCTyAqLwogCWFibyA9IHR0bV90b19hbWRncHVfYm8oYm8pOwog
CWlmIChXQVJOX09OX09OQ0UoYWJvLT50Ym8ucGluX2NvdW50ID4gMCkpCkBAIC01NzksMjQgKzU2
NiwyMyBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19tb3ZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqYm8sIGJvb2wgZXZpY3QsCiAKIAlpZiAob2xkX21lbS0+bWVtX3R5cGUgPT0gVFRNX1BMX1NZ
U1RFTSAmJiBiby0+dHRtID09IE5VTEwpIHsKIAkJdHRtX2JvX21vdmVfbnVsbChibywgbmV3X21l
bSk7Ci0JCXJldHVybiAwOworCQlnb3RvIG91dDsKIAl9CiAJaWYgKG9sZF9tZW0tPm1lbV90eXBl
ID09IFRUTV9QTF9TWVNURU0gJiYKIAkgICAgbmV3X21lbS0+bWVtX3R5cGUgPT0gVFRNX1BMX1RU
KSB7CiAJCXR0bV9ib19tb3ZlX251bGwoYm8sIG5ld19tZW0pOwotCQlyZXR1cm4gMDsKKwkJZ290
byBvdXQ7CiAJfQotCiAJaWYgKG9sZF9tZW0tPm1lbV90eXBlID09IFRUTV9QTF9UVCAmJgogCSAg
ICBuZXdfbWVtLT5tZW1fdHlwZSA9PSBUVE1fUExfU1lTVEVNKSB7CiAJCXIgPSB0dG1fYm9fd2Fp
dF9jdHgoYm8sIGN0eCk7CiAJCWlmIChyKQotCQkJZ290byBmYWlsOworCQkJcmV0dXJuIHI7CiAK
IAkJYW1kZ3B1X3R0bV9iYWNrZW5kX3VuYmluZChiby0+YmRldiwgYm8tPnR0bSk7CiAJCXR0bV9y
ZXNvdXJjZV9mcmVlKGJvLCAmYm8tPm1lbSk7CiAJCXR0bV9ib19hc3NpZ25fbWVtKGJvLCBuZXdf
bWVtKTsKLQkJcmV0dXJuIDA7CisJCWdvdG8gb3V0OwogCX0KIAogCWlmIChvbGRfbWVtLT5tZW1f
dHlwZSA9PSBBTURHUFVfUExfR0RTIHx8CkBAIC02MDcsMjcgKzU5MywzNyBAQCBzdGF0aWMgaW50
IGFtZGdwdV9ib19tb3ZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZpY3Qs
CiAJICAgIG5ld19tZW0tPm1lbV90eXBlID09IEFNREdQVV9QTF9PQSkgewogCQkvKiBOb3RoaW5n
IHRvIHNhdmUgaGVyZSAqLwogCQl0dG1fYm9fbW92ZV9udWxsKGJvLCBuZXdfbWVtKTsKLQkJcmV0
dXJuIDA7CisJCWdvdG8gb3V0OwogCX0KIAotCWlmICghYWRldi0+bW1hbi5idWZmZXJfZnVuY3Nf
ZW5hYmxlZCkgeworCWlmIChhZGV2LT5tbWFuLmJ1ZmZlcl9mdW5jc19lbmFibGVkKSB7CisJCWlm
ICgoKG9sZF9tZW0tPm1lbV90eXBlID09IFRUTV9QTF9TWVNURU0gJiYKKwkJICAgICAgbmV3X21l
bS0+bWVtX3R5cGUgPT0gVFRNX1BMX1ZSQU0pIHx8CisJCSAgICAgKG9sZF9tZW0tPm1lbV90eXBl
ID09IFRUTV9QTF9WUkFNICYmCisJCSAgICAgIG5ld19tZW0tPm1lbV90eXBlID09IFRUTV9QTF9T
WVNURU0pKSkgeworCQkJaG9wLT5mcGZuID0gMDsKKwkJCWhvcC0+bHBmbiA9IDA7CisJCQlob3At
Pm1lbV90eXBlID0gVFRNX1BMX1RUOworCQkJaG9wLT5mbGFncyA9IDA7CisJCQlyZXR1cm4gLUVN
VUxUSUhPUDsKKwkJfQorCisJCXIgPSBhbWRncHVfbW92ZV9ibGl0KGJvLCBldmljdCwgbmV3X21l
bSwgb2xkX21lbSk7CisJfSBlbHNlIHsKIAkJciA9IC1FTk9ERVY7Ci0JCWdvdG8gbWVtY3B5Owog
CX0KIAotCXIgPSBhbWRncHVfbW92ZV9ibGl0KGJvLCBldmljdCwgbmV3X21lbSwgb2xkX21lbSk7
CiAJaWYgKHIpIHsKLW1lbWNweToKIAkJLyogQ2hlY2sgdGhhdCBhbGwgbWVtb3J5IGlzIENQVSBh
Y2Nlc3NpYmxlICovCiAJCWlmICghYW1kZ3B1X21lbV92aXNpYmxlKGFkZXYsIG9sZF9tZW0pIHx8
CiAJCSAgICAhYW1kZ3B1X21lbV92aXNpYmxlKGFkZXYsIG5ld19tZW0pKSB7CiAJCQlwcl9lcnIo
Ik1vdmUgYnVmZmVyIGZhbGxiYWNrIHRvIG1lbWNweSB1bmF2YWlsYWJsZVxuIik7Ci0JCQlnb3Rv
IGZhaWw7CisJCQlyZXR1cm4gcjsKIAkJfQogCiAJCXIgPSB0dG1fYm9fbW92ZV9tZW1jcHkoYm8s
IGN0eCwgbmV3X21lbSk7CiAJCWlmIChyKQotCQkJZ290byBmYWlsOworCQkJcmV0dXJuIHI7CiAJ
fQogCiAJaWYgKGJvLT50eXBlID09IHR0bV9ib190eXBlX2RldmljZSAmJgpAQCAtNjM5LDE0ICs2
MzUsMTEgQEAgc3RhdGljIGludCBhbWRncHVfYm9fbW92ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmpl
Y3QgKmJvLCBib29sIGV2aWN0LAogCQlhYm8tPmZsYWdzICY9IH5BTURHUFVfR0VNX0NSRUFURV9D
UFVfQUNDRVNTX1JFUVVJUkVEOwogCX0KIAorb3V0OgogCS8qIHVwZGF0ZSBzdGF0aXN0aWNzICov
CiAJYXRvbWljNjRfYWRkKCh1NjQpYm8tPm51bV9wYWdlcyA8PCBQQUdFX1NISUZULCAmYWRldi0+
bnVtX2J5dGVzX21vdmVkKTsKKwlhbWRncHVfYm9fbW92ZV9ub3RpZnkoYm8sIGV2aWN0LCBuZXdf
bWVtKTsKIAlyZXR1cm4gMDsKLWZhaWw6Ci0Jc3dhcCgqbmV3X21lbSwgYm8tPm1lbSk7Ci0JYW1k
Z3B1X2JvX21vdmVfbm90aWZ5KGJvLCBmYWxzZSwgbmV3X21lbSk7Ci0Jc3dhcCgqbmV3X21lbSwg
Ym8tPm1lbSk7Ci0JcmV0dXJuIHI7CiB9CiAKIC8qKgotLSAKMi4yNS4xCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
