Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E706FBB38D
	for <lists+dri-devel@lfdr.de>; Mon, 23 Sep 2019 14:20:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E74BF6E890;
	Mon, 23 Sep 2019 12:20:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 53E176E890
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Sep 2019 12:20:31 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: andrzej.p) with ESMTPSA id 275AD283BCE
From: Andrzej Pietrasiewicz <andrzej.p@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/rockchip: Add AFBC support
Date: Mon, 23 Sep 2019 14:20:13 +0200
Message-Id: <20190923122014.18229-1-andrzej.p@collabora.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, David Airlie <airlied@linux.ie>,
 Sean Paul <sean@poorly.run>, Maxime Ripard <mripard@kernel.org>,
 linux-kernel@vger.kernel.org, linux-rockchip@lists.infradead.org,
 kernel@collabora.com, Ezequiel Garcia <ezequiel@collabora.com>,
 linux-arm-kernel@lists.infradead.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRXplcXVpZWwgR2FyY2lhIDxlemVxdWllbEBjb2xsYWJvcmEuY29tPgoKQUZCQyBpcyBh
IHByb3ByaWV0YXJ5IGxvc3NsZXNzIGltYWdlIGNvbXByZXNzaW9uIHByb3RvY29sIGFuZCBmb3Jt
YXQuCkl0IGhlbHBzIHJlZHVjZSBtZW1vcnkgYmFuZHdpZHRoIG9mIHRoZSBncmFwaGljcyBwaXBl
bGluZSBvcGVyYXRpb25zLgpUaGlzLCBpbiB0dXJuLCBpbXByb3ZlcyBwb3dlciBlZmZpY2llbmN5
LgoKU2lnbmVkLW9mZi1ieTogRXplcXVpZWwgR2FyY2lhIDxlemVxdWllbEBjb2xsYWJvcmEuY29t
PgpbbG9ja2luZyBpbXByb3ZlbWVudHNdClNpZ25lZC1vZmYtYnk6IFRvbWV1IFZpem9zbyA8dG9t
ZXUudml6b3NvQGNvbGxhYm9yYS5jb20+CltzcXVhc2hpbmcgdGhlIGFib3ZlLCBjb21taXQgbWVz
c2FnZSBhbmQgUm9ja2NoaXAgQUZCQyBtb2RpZmllcl0KU2lnbmVkLW9mZi1ieTogQW5kcnplaiBQ
aWV0cmFzaWV3aWN6IDxhbmRyemVqLnBAY29sbGFib3JhLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmMgIHwgMjcgKysrKysrCiBkcml2ZXJzL2dwdS9k
cm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jIHwgOTQgKysrKysrKysrKysrKysrKysrKyst
CiBkcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5oIHwgMTIgKysrCiBk
cml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfdm9wX3JlZy5jIHwgMTggKysrKwogaW5j
bHVkZS91YXBpL2RybS9kcm1fZm91cmNjLmggICAgICAgICAgICAgICB8ICAzICsKIDUgZmlsZXMg
Y2hhbmdlZCwgMTUxIGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jIGIvZHJpdmVycy9ncHUv
ZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jCmluZGV4IDY0Y2E4N2NmNmQ1MC4uNTE3ODkz
OWE5YzI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJt
X2ZiLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jCkBA
IC0yNCw2ICsyNCwyNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlcl9mdW5j
cyByb2NrY2hpcF9kcm1fZmJfZnVuY3MgPSB7CiAJLmRpcnR5CSAgICAgICA9IGRybV9hdG9taWNf
aGVscGVyX2RpcnR5ZmIsCiB9OwogCitzdGF0aWMgaW50Cityb2NrY2hpcF92ZXJpZnlfYWZiY19t
b2Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJCSBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJf
Y21kMiAqbW9kZV9jbWQpCit7CisJaWYgKG1vZGVfY21kLT5tb2RpZmllclswXSAmCisJICAgIH5E
Uk1fRk9STUFUX01PRF9BUk1fQUZCQyhBRkJDX0ZPUk1BVF9NT0RfUk9DS0NISVApKSB7CisJCURS
TV9ERVZfRVJST1IoZGV2LT5kZXYsCisJCQkgICAgICAiVW5zdXBwb3J0ZWQgZm9ybWF0IG1vZGlm
aWVyIDB4JWxseFxuIiwKKwkJCSAgICAgIG1vZGVfY21kLT5tb2RpZmllclswXSk7CisJCXJldHVy
biAtRUlOVkFMOworCX0KKworCWlmIChtb2RlX2NtZC0+d2lkdGggPiAyNTYwKSB7CisJCURSTV9E
RVZfRVJST1IoZGV2LT5kZXYsCisJCQkgICAgICAiVW5zdXBwb3J0ZWQgd2lkdGggJWRcbiIsIG1v
ZGVfY21kLT53aWR0aCk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQor
CiBzdGF0aWMgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqCiByb2NrY2hpcF9mYl9hbGxvYyhzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqbW9kZV9j
bWQsCiAJCSAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqLCB1bnNpZ25lZCBpbnQgbnVtX3Bs
YW5lcykKQEAgLTMyLDYgKzUzLDEyIEBAIHJvY2tjaGlwX2ZiX2FsbG9jKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICptb2RlX2NtCiAJaW50IHJl
dDsKIAlpbnQgaTsKIAorCWlmIChtb2RlX2NtZC0+bW9kaWZpZXJbMF0pIHsKKwkJcmV0ID0gcm9j
a2NoaXBfdmVyaWZ5X2FmYmNfbW9kKGRldiwgbW9kZV9jbWQpOworCQlpZiAocmV0KQorCQkJcmV0
dXJuIEVSUl9QVFIocmV0KTsKKwl9CisKIAlmYiA9IGt6YWxsb2Moc2l6ZW9mKCpmYiksIEdGUF9L
RVJORUwpOwogCWlmICghZmIpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYyBiL2RyaXZlcnMv
Z3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMKaW5kZXggMjFiNjhlZWE0NmNjLi41
MGJmMjE0ZDIxZGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hp
cF9kcm1fdm9wLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92
b3AuYwpAQCAtNDYsNiArNDYsMTMgQEAKIAkJdm9wX3JlZ19zZXQodm9wLCAmd2luLT5waHktPnNj
bC0+ZXh0LT5uYW1lLCBcCiAJCQkgICAgd2luLT5iYXNlLCB+MCwgdiwgI25hbWUpCiAKKyNkZWZp
bmUgVk9QX0FGQkNfU0VUKHgsIG5hbWUsIHYpIFwKKwlkbyB7IFwKKwkJaWYgKHZvcC0+ZGF0YS0+
YWZiYykgXAorCQkJdm9wX3JlZ19zZXQodm9wLCAmdm9wLT5kYXRhLT5hZmJjLT5uYW1lLCBcCisJ
CQkJMCwgfjAsIHYsICNuYW1lKTsgXAorCX0gd2hpbGUgKDApCisKICNkZWZpbmUgVk9QX1dJTl9Z
VVYyWVVWX1NFVCh2b3AsIHdpbl95dXYyeXV2LCBuYW1lLCB2KSBcCiAJZG8geyBcCiAJCWlmICh3
aW5feXV2Mnl1diAmJiB3aW5feXV2Mnl1di0+bmFtZS5tYXNrKSBcCkBAIC0xMjMsNiArMTMwLDgg
QEAgc3RydWN0IHZvcCB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXY7CiAJYm9vbCBpc19l
bmFibGVkOwogCisJc3RydWN0IHZvcF93aW4gKmFmYmNfd2luOworCiAJc3RydWN0IGNvbXBsZXRp
b24gZHNwX2hvbGRfY29tcGxldGlvbjsKIAogCS8qIHByb3RlY3RlZCBieSBkZXYtPmV2ZW50X2xv
Y2sgKi8KQEAgLTI0NSw2ICsyNTQsMzAgQEAgc3RhdGljIGJvb2wgaGFzX3JiX3N3YXBwZWQodWlu
dDMyX3QgZm9ybWF0KQogCX0KIH0KIAorI2RlZmluZSBBRkJDX0ZNVF9SR0I1NjUgICAgICAgIDB4
MAorI2RlZmluZSBBRkJDX0ZNVF9VOFU4VThVOCAgICAgIDB4NQorI2RlZmluZSBBRkJDX0ZNVF9V
OFU4VTggICAgICAgIDB4NAorCitzdGF0aWMgaW50IHZvcF9jb252ZXJ0X2FmYmNfZm9ybWF0KHVp
bnQzMl90IGZvcm1hdCkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9Y
UkdCODg4ODoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1hC
R1I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJcmV0dXJuIEFGQkNfRk1UX1U4
VThVOFU4OworCWNhc2UgRFJNX0ZPUk1BVF9SR0I4ODg6CisJY2FzZSBEUk1fRk9STUFUX0JHUjg4
ODoKKwkJcmV0dXJuIEFGQkNfRk1UX1U4VThVODsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1Ogor
CWNhc2UgRFJNX0ZPUk1BVF9CR1I1NjU6CisJCXJldHVybiBBRkJDX0ZNVF9SR0I1NjU7CisJZGVm
YXVsdDoKKwkJRFJNX0VSUk9SKCJ1bnN1cHBvcnRlZCBhZmJjIGZvcm1hdFslMDh4XVxuIiwgZm9y
bWF0KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorfQorCiBzdGF0aWMgZW51bSB2b3BfZGF0YV9m
b3JtYXQgdm9wX2NvbnZlcnRfZm9ybWF0KHVpbnQzMl90IGZvcm1hdCkKIHsKIAlzd2l0Y2ggKGZv
cm1hdCkgewpAQCAtNTg3LDEwICs2MjAsMTYgQEAgc3RhdGljIGludCB2b3BfZW5hYmxlKHN0cnVj
dCBkcm1fY3J0YyAqY3J0YykKIAogCQl2b3Bfd2luX2Rpc2FibGUodm9wLCB3aW4pOwogCX0KLQlz
cGluX3VubG9jaygmdm9wLT5yZWdfbG9jayk7CisKKwlpZiAodm9wLT5kYXRhLT5hZmJjKSB7CisJ
CVZPUF9BRkJDX1NFVCh2b3AsIGVuYWJsZSwgMCk7CisJCXZvcC0+YWZiY193aW4gPSBOVUxMOwor
CX0KIAogCXZvcF9jZmdfZG9uZSh2b3ApOwogCisJc3Bpbl91bmxvY2soJnZvcC0+cmVnX2xvY2sp
OworCiAJLyoKIAkgKiBBdCBoZXJlLCB2b3AgY2xvY2sgJiBpb21tdSBpcyBlbmFibGUsIFIvVyB2
b3AgcmVncyB3b3VsZCBiZSBzYWZlLgogCSAqLwpAQCAtNzE5LDYgKzc1OCwzMiBAQCBzdGF0aWMg
aW50IHZvcF9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCXJl
dHVybiAtRUlOVkFMOwogCX0KIAorCWlmIChmYi0+bW9kaWZpZXIgJiBEUk1fRk9STUFUX01PRF9B
Uk1fQUZCQyhBRkJDX0ZPUk1BVF9NT0RfUk9DS0NISVApKSB7CisJCXN0cnVjdCB2b3AgKnZvcCA9
IHRvX3ZvcChjcnRjKTsKKworCQlpZiAoIXZvcC0+ZGF0YS0+YWZiYykgeworCQkJRFJNX0VSUk9S
KCJWT1AgZG9lcyBub3Qgc3VwcG9ydCBBRkJDXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9
CisKKwkJcmV0ID0gdm9wX2NvbnZlcnRfYWZiY19mb3JtYXQoZmItPmZvcm1hdC0+Zm9ybWF0KTsK
KwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0OworCisJCWlmIChzdGF0ZS0+c3JjLngxIHx8
IHN0YXRlLT5zcmMueTEpIHsKKwkJCURSTV9FUlJPUigiQUZCQyBkb2VzIG5vdCBzdXBwb3J0IG9m
ZnNldCBkaXNwbGF5XG4iKTsKKwkJCURSTV9FUlJPUigieHBvcz0lZCwgeXBvcz0lZCwgb2Zmc2V0
PSVkXG4iLAorCQkJCXN0YXRlLT5zcmMueDEsIHN0YXRlLT5zcmMueTEsIGZiLT5vZmZzZXRzWzBd
KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisKKwkJaWYgKHN0YXRlLT5yb3RhdGlvbiAmJiBz
dGF0ZS0+cm90YXRpb24gIT0gRFJNX01PREVfUk9UQVRFXzApIHsKKwkJCURSTV9FUlJPUigiQUZC
QyBkb2VzIG5vdCBzdXBwb3J0IHJvdGF0aW9uXG4iKTsKKwkJCURSTV9FUlJPUigicm90YXRpb249
JWRcbiIsIHN0YXRlLT5yb3RhdGlvbik7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCX0KKwog
CXJldHVybiAwOwogfQogCkBAIC03MzIsNiArNzk3LDkgQEAgc3RhdGljIHZvaWQgdm9wX3BsYW5l
X2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmICghb2xkX3N0YXRl
LT5jcnRjKQogCQlyZXR1cm47CiAKKwlpZiAodm9wLT5hZmJjX3dpbiA9PSB2b3Bfd2luKQorCQl2
b3AtPmFmYmNfd2luID0gTlVMTDsKKwogCXNwaW5fbG9jaygmdm9wLT5yZWdfbG9jayk7CiAKIAl2
b3Bfd2luX2Rpc2FibGUodm9wLCB3aW4pOwpAQCAtNzc0LDYgKzg0Miw5IEBAIHN0YXRpYyB2b2lk
IHZvcF9wbGFuZV9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmIChX
QVJOX09OKCF2b3AtPmlzX2VuYWJsZWQpKQogCQlyZXR1cm47CiAKKwlpZiAodm9wLT5hZmJjX3dp
biA9PSB2b3Bfd2luKQorCQl2b3AtPmFmYmNfd2luID0gTlVMTDsKKwogCWlmICghc3RhdGUtPnZp
c2libGUpIHsKIAkJdm9wX3BsYW5lX2F0b21pY19kaXNhYmxlKHBsYW5lLCBvbGRfc3RhdGUpOwog
CQlyZXR1cm47CkBAIC04MDgsNiArODc5LDIwIEBAIHN0YXRpYyB2b2lkIHZvcF9wbGFuZV9hdG9t
aWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJc3Bpbl9sb2NrKCZ2b3AtPnJl
Z19sb2NrKTsKIAorCWlmIChmYi0+bW9kaWZpZXIgJiBEUk1fRk9STUFUX01PRF9BUk1fQUZCQyhB
RkJDX0ZPUk1BVF9NT0RfUk9DS0NISVApKSB7CisJCWludCBhZmJjX2Zvcm1hdCA9IHZvcF9jb252
ZXJ0X2FmYmNfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7CisKKwkJVk9QX0FGQkNfU0VUKHZv
cCwgZm9ybWF0LCBhZmJjX2Zvcm1hdCB8IDEgPDwgNCk7CisJCVZPUF9BRkJDX1NFVCh2b3AsIGhy
ZWdfYmxvY2tfc3BsaXQsIDApOworCQlWT1BfQUZCQ19TRVQodm9wLCB3aW5fc2VsLCB3aW5faW5k
ZXgpOworCQlWT1BfQUZCQ19TRVQodm9wLCBoZHJfcHRyLCBkbWFfYWRkcik7CisJCVZPUF9BRkJD
X1NFVCh2b3AsIHBpY19zaXplLCBhY3RfaW5mbyk7CisKKwkJdm9wLT5hZmJjX3dpbiA9IHZvcF93
aW47CisKKwkJcHJfaW5mbygiQUZCQyBvbiBwbGFuZSAlc1xuIiwgcGxhbmUtPm5hbWUpOworCX0K
KwogCVZPUF9XSU5fU0VUKHZvcCwgd2luLCBmb3JtYXQsIGZvcm1hdCk7CiAJVk9QX1dJTl9TRVQo
dm9wLCB3aW4sIHlyZ2JfdmlyLCBESVZfUk9VTkRfVVAoZmItPnBpdGNoZXNbMF0sIDQpKTsKIAlW
T1BfV0lOX1NFVCh2b3AsIHdpbiwgeXJnYl9tc3QsIGRtYV9hZGRyKTsKQEAgLTExNjMsNiArMTI0
OCw3IEBAIHN0YXRpYyB2b2lkIHZvcF9jcnRjX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCiAKIAlzcGluX2xvY2soJnZvcC0+cmVnX2xvY2spOwogCisJVk9QX0FGQkNfU0VUKHZv
cCwgZW5hYmxlLCB2b3AtPmFmYmNfd2luID8gMHgxIDogMCk7CiAJdm9wX2NmZ19kb25lKHZvcCk7
CiAKIAlzcGluX3VubG9jaygmdm9wLT5yZWdfbG9jayk7CkBAIC0xNDcxLDcgKzE1NTcsOCBAQCBz
dGF0aWMgaW50IHZvcF9jcmVhdGVfY3J0YyhzdHJ1Y3Qgdm9wICp2b3ApCiAJCQkJCSAgICAgICAw
LCAmdm9wX3BsYW5lX2Z1bmNzLAogCQkJCQkgICAgICAgd2luX2RhdGEtPnBoeS0+ZGF0YV9mb3Jt
YXRzLAogCQkJCQkgICAgICAgd2luX2RhdGEtPnBoeS0+bmZvcm1hdHMsCi0JCQkJCSAgICAgICBO
VUxMLCB3aW5fZGF0YS0+dHlwZSwgTlVMTCk7CisJCQkJCSAgICAgICB3aW5fZGF0YS0+cGh5LT5m
b3JtYXRfbW9kaWZpZXJzLAorCQkJCQkgICAgICAgd2luX2RhdGEtPnR5cGUsIE5VTEwpOwogCQlp
ZiAocmV0KSB7CiAJCQlEUk1fREVWX0VSUk9SKHZvcC0+ZGV2LCAiZmFpbGVkIHRvIGluaXQgcGxh
bmUgJWRcbiIsCiAJCQkJICAgICAgcmV0KTsKQEAgLTE1MTEsNyArMTU5OCw4IEBAIHN0YXRpYyBp
bnQgdm9wX2NyZWF0ZV9jcnRjKHN0cnVjdCB2b3AgKnZvcCkKIAkJCQkJICAgICAgICZ2b3BfcGxh
bmVfZnVuY3MsCiAJCQkJCSAgICAgICB3aW5fZGF0YS0+cGh5LT5kYXRhX2Zvcm1hdHMsCiAJCQkJ
CSAgICAgICB3aW5fZGF0YS0+cGh5LT5uZm9ybWF0cywKLQkJCQkJICAgICAgIE5VTEwsIHdpbl9k
YXRhLT50eXBlLCBOVUxMKTsKKwkJCQkJICAgICAgIHdpbl9kYXRhLT5waHktPmZvcm1hdF9tb2Rp
ZmllcnMsCisJCQkJCSAgICAgICB3aW5fZGF0YS0+dHlwZSwgTlVMTCk7CiAJCWlmIChyZXQpIHsK
IAkJCURSTV9ERVZfRVJST1Iodm9wLT5kZXYsICJmYWlsZWQgdG8gaW5pdCBvdmVybGF5ICVkXG4i
LAogCQkJCSAgICAgIHJldCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAv
cm9ja2NoaXBfZHJtX3ZvcC5oIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2Ry
bV92b3AuaAppbmRleCAyMTQ5YTg4OWMyOWQuLmRjOGIxMjAyNTI2OSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5oCkBAIC03Nyw2ICs3NywxNiBAQCBzdHJ1
Y3Qgdm9wX21pc2MgewogCXN0cnVjdCB2b3BfcmVnIGdsb2JhbF9yZWdkb25lX2VuOwogfTsKIAor
c3RydWN0IHZvcF9hZmJjIHsKKwlzdHJ1Y3Qgdm9wX3JlZyBlbmFibGU7CisJc3RydWN0IHZvcF9y
ZWcgd2luX3NlbDsKKwlzdHJ1Y3Qgdm9wX3JlZyBmb3JtYXQ7CisJc3RydWN0IHZvcF9yZWcgaHJl
Z19ibG9ja19zcGxpdDsKKwlzdHJ1Y3Qgdm9wX3JlZyBwaWNfc2l6ZTsKKwlzdHJ1Y3Qgdm9wX3Jl
ZyBoZHJfcHRyOworCXN0cnVjdCB2b3BfcmVnIHJzdG47Cit9OworCiBzdHJ1Y3Qgdm9wX2ludHIg
ewogCWNvbnN0IGludCAqaW50cnM7CiAJdWludDMyX3QgbmludHJzOwpAQCAtMTI4LDYgKzEzOCw3
IEBAIHN0cnVjdCB2b3Bfd2luX3BoeSB7CiAJY29uc3Qgc3RydWN0IHZvcF9zY2xfcmVncyAqc2Ns
OwogCWNvbnN0IHVpbnQzMl90ICpkYXRhX2Zvcm1hdHM7CiAJdWludDMyX3QgbmZvcm1hdHM7CisJ
Y29uc3QgdWludDY0X3QgKmZvcm1hdF9tb2RpZmllcnM7CiAKIAlzdHJ1Y3Qgdm9wX3JlZyBlbmFi
bGU7CiAJc3RydWN0IHZvcF9yZWcgZ2F0ZTsKQEAgLTE2OSw2ICsxODAsNyBAQCBzdHJ1Y3Qgdm9w
X2RhdGEgewogCWNvbnN0IHN0cnVjdCB2b3Bfb3V0cHV0ICpvdXRwdXQ7CiAJY29uc3Qgc3RydWN0
IHZvcF93aW5feXV2Mnl1dl9kYXRhICp3aW5feXV2Mnl1djsKIAljb25zdCBzdHJ1Y3Qgdm9wX3dp
bl9kYXRhICp3aW47CisJY29uc3Qgc3RydWN0IHZvcF9hZmJjICphZmJjOwogCXVuc2lnbmVkIGlu
dCB3aW5fc2l6ZTsKIAogI2RlZmluZSBWT1BfRkVBVFVSRV9PVVRQVVRfUkdCMTAJQklUKDApCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfdm9wX3JlZy5jIGIv
ZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX3ZvcF9yZWcuYwppbmRleCA3YjljNzQ3
NTBmNmQuLmU5ZmYwYzQzYzM5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlw
L3JvY2tjaGlwX3ZvcF9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2No
aXBfdm9wX3JlZy5jCkBAIC0zMCw2ICszMCwxMiBAQAogI2RlZmluZSBWT1BfUkVHX01BU0tfU1lO
QyhvZmYsIF9tYXNrLCBfc2hpZnQpIFwKIAkJX1ZPUF9SRUcob2ZmLCBfbWFzaywgX3NoaWZ0LCB0
cnVlLCBmYWxzZSkKIAorc3RhdGljIGNvbnN0IHVpbnQ2NF90IGZvcm1hdF9tb2RpZmllcnNfYWZi
Y1tdID0geworCURSTV9GT1JNQVRfTU9EX0FSTV9BRkJDKEFGQkNfRk9STUFUX01PRF9ST0NLQ0hJ
UCksCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307
CisKIHN0YXRpYyBjb25zdCB1aW50MzJfdCBmb3JtYXRzX3dpbl9mdWxsW10gPSB7CiAJRFJNX0ZP
Uk1BVF9YUkdCODg4OCwKIAlEUk1fRk9STUFUX0FSR0I4ODg4LApAQCAtNjY3LDYgKzY3Myw3IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3Qgdm9wX3dpbl9waHkgcmszMzY4X3dpbjAxX2RhdGEgPSB7CiAJ
LnNjbCA9ICZyazMyODhfd2luX2Z1bGxfc2NsLAogCS5kYXRhX2Zvcm1hdHMgPSBmb3JtYXRzX3dp
bl9mdWxsLAogCS5uZm9ybWF0cyA9IEFSUkFZX1NJWkUoZm9ybWF0c193aW5fZnVsbCksCisJLmZv
cm1hdF9tb2RpZmllcnMgPSBmb3JtYXRfbW9kaWZpZXJzX2FmYmMsCiAJLmVuYWJsZSA9IFZPUF9S
RUcoUkszMzY4X1dJTjBfQ1RSTDAsIDB4MSwgMCksCiAJLmZvcm1hdCA9IFZPUF9SRUcoUkszMzY4
X1dJTjBfQ1RSTDAsIDB4NywgMSksCiAJLnJiX3N3YXAgPSBWT1BfUkVHKFJLMzM2OF9XSU4wX0NU
UkwwLCAweDEsIDEyKSwKQEAgLTc1OCw2ICs3NjUsMTYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB2
b3BfZGF0YSByazMzNjZfdm9wID0gewogCS53aW5fc2l6ZSA9IEFSUkFZX1NJWkUocmszMzY4X3Zv
cF93aW5fZGF0YSksCiB9OwogCitzdGF0aWMgY29uc3Qgc3RydWN0IHZvcF9hZmJjIHJrMzM5OV9h
ZmJjID0geworCS5yc3RuID0gVk9QX1JFRyhSSzMzOTlfQUZCQ0QwX0NUUkwsIDB4MSwgMyksCisJ
LmVuYWJsZSA9IFZPUF9SRUcoUkszMzk5X0FGQkNEMF9DVFJMLCAweDEsIDApLAorCS53aW5fc2Vs
ID0gVk9QX1JFRyhSSzMzOTlfQUZCQ0QwX0NUUkwsIDB4MywgMSksCisJLmZvcm1hdCA9IFZPUF9S
RUcoUkszMzk5X0FGQkNEMF9DVFJMLCAweDFmLCAxNiksCisJLmhyZWdfYmxvY2tfc3BsaXQgPSBW
T1BfUkVHKFJLMzM5OV9BRkJDRDBfQ1RSTCwgMHgxLCAyMSksCisJLmhkcl9wdHIgPSBWT1BfUkVH
KFJLMzM5OV9BRkJDRDBfSERSX1BUUiwgMHhmZmZmZmZmZiwgMCksCisJLnBpY19zaXplID0gVk9Q
X1JFRyhSSzMzOTlfQUZCQ0QwX1BJQ19TSVpFLCAweGZmZmZmZmZmLCAwKSwKK307CisKIHN0YXRp
YyBjb25zdCBzdHJ1Y3Qgdm9wX291dHB1dCByazMzOTlfb3V0cHV0ID0gewogCS5kcF9waW5fcG9s
ID0gVk9QX1JFRyhSSzMzOTlfRFNQX0NUUkwxLCAweGYsIDE2KSwKIAkucmdiX3Bpbl9wb2wgPSBW
T1BfUkVHKFJLMzM2OF9EU1BfQ1RSTDEsIDB4ZiwgMTYpLApAQCAtODA4LDYgKzgyNSw3IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3Qgdm9wX2RhdGEgcmszMzk5X3ZvcF9iaWcgPSB7CiAJLm1vZGVzZXQg
PSAmcmszMjg4X21vZGVzZXQsCiAJLm91dHB1dCA9ICZyazMzOTlfb3V0cHV0LAogCS5taXNjID0g
JnJrMzM2OF9taXNjLAorCS5hZmJjID0gJnJrMzM5OV9hZmJjLAogCS53aW4gPSByazMzNjhfdm9w
X3dpbl9kYXRhLAogCS53aW5fc2l6ZSA9IEFSUkFZX1NJWkUocmszMzY4X3ZvcF93aW5fZGF0YSks
CiAJLndpbl95dXYyeXV2ID0gcmszMzk5X3ZvcF9iaWdfd2luX3l1djJ5dXZfZGF0YSwKZGlmZiAt
LWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vZHJtX2ZvdXJjYy5oIGIvaW5jbHVkZS91YXBpL2RybS9k
cm1fZm91cmNjLmgKaW5kZXggM2ZlZWFhM2Y5ODdhLi5iYTZjYWYwNmM4MjQgMTAwNjQ0Ci0tLSBh
L2luY2x1ZGUvdWFwaS9kcm0vZHJtX2ZvdXJjYy5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vZHJt
X2ZvdXJjYy5oCkBAIC03NDIsNiArNzQyLDkgQEAgZXh0ZXJuICJDIiB7CiAgKi8KICNkZWZpbmUg
QUZCQ19GT1JNQVRfTU9EX0JDSCAgICAgKDFVTEwgPDwgMTEpCiAKKyNkZWZpbmUgQUZCQ19GT1JN
QVRfTU9EX1JPQ0tDSElQIFwKKwkoQUZCQ19GT1JNQVRfTU9EX0JMT0NLX1NJWkVfMTZ4MTYgfCBB
RkJDX0ZPUk1BVF9NT0RfU1BBUlNFKQorCiAvKgogICogQWxsd2lubmVyIHRpbGVkIG1vZGlmaWVy
CiAgKgotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
