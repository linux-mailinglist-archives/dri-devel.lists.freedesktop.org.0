Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C0423B0777
	for <lists+dri-devel@lfdr.de>; Thu, 12 Sep 2019 06:13:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A8CE16EBCA;
	Thu, 12 Sep 2019 04:12:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 369626E0E8;
 Wed, 11 Sep 2019 17:56:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Sep 2019 10:56:10 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,492,1559545200"; d="scan'208";a="196964768"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.9.135])
 by orsmga002.jf.intel.com with ESMTP; 11 Sep 2019 10:56:10 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 2/2] drm/connector: Allow max possible encoders to attach to a
 connector
Date: Wed, 11 Sep 2019 10:56:03 -0700
Message-Id: <20190911175603.30356-2-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190911175603.30356-1-jose.souza@intel.com>
References: <20190911175603.30356-1-jose.souza@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: nouveau@lists.freedesktop.org,
 =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>,
 amd-gfx@lists.freedesktop.org, Alex Deucher <alexander.deucher@amd.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpDdXJyZW50bHkgd2UgcmVzdHJpY3QgdGhlIG51bWJlciBvZiBlbmNvZGVycyB0aGF0IGNhbiBi
ZSBsaW5rZWQgdG8KYSBjb25uZWN0b3IgdG8gMywgaW5jcmVhc2UgaXQgdG8gbWF0Y2ggdGhlIG1h
eGltdW0gbnVtYmVyIG9mIGVuY29kZXJzCnRoYXQgY2FuIGJlIGluaXRpYWxpemVkKDMyKS4KClRv
IG1vcmUgZWZmaWVudGx5IGRvIHRoYXQgbGV0cyBzd2l0Y2ggZnJvbSBhbiBhcnJheSBvZiBlbmNv
ZGVyIGlkcyB0bwpiaXRtYXNrLgoKdjI6IEZpeGluZyBtaXNzZWQgcmV0dXJuIG9uIGFtZGdwdV9k
bV9jb25uZWN0b3JfdG9fZW5jb2RlcigpCgpTdWdnZXN0ZWQtYnk6IFZpbGxlIFN5cmrDpGzDpCA8
dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxl
LnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogQWxleCBEZXVjaGVyIDxhbGV4YW5kZXIuZGV1
Y2hlckBhbWQuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpDYzogaW50
ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpDYzogbm91dmVhdUBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKQ2M6IGFtZC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnClJldmlld2VkLWJ5OiBWaWxs
ZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBEaGluYWthcmFuIFBhbmRpeWFuIDxkaGluYWthcmFuLnBhbmRpeWFuQGludGVsLmNvbT4KU2ln
bmVkLW9mZi1ieTogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+
Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY29ubmVjdG9ycy5jICAgIHwgMjMg
KysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2RjZV92aXJ0dWFsLmMgICAg
ICB8ICA1ICstLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5j
IHwgIDggKysrLQogZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnRfbW9kZXNldC5jICAgICAgICAg
IHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY29ubmVjdG9yLmMgICAgICAgICAgICAgICB8
IDQwICsrKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVy
LmMgICAgICAgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9k
aXNwLmMgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52NTAvZGlz
cC5jICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfY29ubmVj
dG9yLmMgICB8ICA3ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2Nvbm5lY3Rv
cnMuYyAgICB8IDI3ICsrKysrLS0tLS0tLS0KIGluY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaCAg
ICAgICAgICAgICAgICAgICB8IDE4ICsrKystLS0tLQogMTEgZmlsZXMgY2hhbmdlZCwgNTUgaW5z
ZXJ0aW9ucygrKSwgODMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2Nvbm5lY3RvcnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9jb25uZWN0b3JzLmMKaW5kZXggZWNlNTVjOGZhNjczLi5kODcyOTI4NWY3MzEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jb25uZWN0b3Jz
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Nvbm5lY3RvcnMuYwpA
QCAtMjE3LDExICsyMTcsMTAgQEAgYW1kZ3B1X2Nvbm5lY3Rvcl91cGRhdGVfc2NyYXRjaF9yZWdz
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJc3RydWN0IGRybV9lbmNvZGVyICpl
bmNvZGVyOwogCWNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2hlbHBlcl9mdW5jcyAqY29ubmVj
dG9yX2Z1bmNzID0gY29ubmVjdG9yLT5oZWxwZXJfcHJpdmF0ZTsKIAlib29sIGNvbm5lY3RlZDsK
LQlpbnQgaTsKIAogCWJlc3RfZW5jb2RlciA9IGNvbm5lY3Rvcl9mdW5jcy0+YmVzdF9lbmNvZGVy
KGNvbm5lY3Rvcik7CiAKLQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIo
Y29ubmVjdG9yLCBlbmNvZGVyLCBpKSB7CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJs
ZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2RlcikgewogCQlpZiAoKGVuY29kZXIgPT0gYmVzdF9l
bmNvZGVyKSAmJiAoc3RhdHVzID09IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKSkKIAkJCWNv
bm5lY3RlZCA9IHRydWU7CiAJCWVsc2UKQEAgLTIzNiw5ICsyMzUsOCBAQCBhbWRncHVfY29ubmVj
dG9yX2ZpbmRfZW5jb2RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJICAg
ICAgIGludCBlbmNvZGVyX3R5cGUpCiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwot
CWludCBpOwogCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5l
Y3RvciwgZW5jb2RlciwgaSkgeworCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5j
b2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKIAkJaWYgKGVuY29kZXItPmVuY29kZXJfdHlwZSA9
PSBlbmNvZGVyX3R5cGUpCiAJCQlyZXR1cm4gZW5jb2RlcjsKIAl9CkBAIC0zNDcsMTAgKzM0NSw5
IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2VuY29kZXIgKgogYW1kZ3B1X2Nvbm5lY3Rvcl9iZXN0X3Np
bmdsZV9lbmNvZGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0
IGRybV9lbmNvZGVyICplbmNvZGVyOwotCWludCBpOwogCiAJLyogcGljayB0aGUgZmlyc3Qgb25l
ICovCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3Rvciwg
ZW5jb2RlciwgaSkKKwlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29u
bmVjdG9yLCBlbmNvZGVyKQogCQlyZXR1cm4gZW5jb2RlcjsKIAogCXJldHVybiBOVUxMOwpAQCAt
MTA2NSw5ICsxMDYyLDggQEAgYW1kZ3B1X2Nvbm5lY3Rvcl9kdmlfZGV0ZWN0KHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCiAJLyogZmluZCBhbmFsb2cgZW5jb2Rl
ciAqLwogCWlmIChhbWRncHVfY29ubmVjdG9yLT5kYWNfbG9hZF9kZXRlY3QpIHsKIAkJc3RydWN0
IGRybV9lbmNvZGVyICplbmNvZGVyOwotCQlpbnQgaTsKIAotCQlkcm1fY29ubmVjdG9yX2Zvcl9l
YWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyLCBpKSB7CisJCWRybV9jb25u
ZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKIAkJ
CWlmIChlbmNvZGVyLT5lbmNvZGVyX3R5cGUgIT0gRFJNX01PREVfRU5DT0RFUl9EQUMgJiYKIAkJ
CSAgICBlbmNvZGVyLT5lbmNvZGVyX3R5cGUgIT0gRFJNX01PREVfRU5DT0RFUl9UVkRBQykKIAkJ
CQljb250aW51ZTsKQEAgLTExMTcsOSArMTExMyw4IEBAIGFtZGdwdV9jb25uZWN0b3JfZHZpX2Vu
Y29kZXIoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgYW1kZ3B1
X2Nvbm5lY3RvciAqYW1kZ3B1X2Nvbm5lY3RvciA9IHRvX2FtZGdwdV9jb25uZWN0b3IoY29ubmVj
dG9yKTsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JaW50IGk7CiAKLQlkcm1fY29u
bmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyLCBpKSB7
CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5j
b2RlcikgewogCQlpZiAoYW1kZ3B1X2Nvbm5lY3Rvci0+dXNlX2RpZ2l0YWwgPT0gdHJ1ZSkgewog
CQkJaWYgKGVuY29kZXItPmVuY29kZXJfdHlwZSA9PSBEUk1fTU9ERV9FTkNPREVSX1RNRFMpCiAJ
CQkJcmV0dXJuIGVuY29kZXI7CkBAIC0xMTM0LDcgKzExMjksNyBAQCBhbWRncHVfY29ubmVjdG9y
X2R2aV9lbmNvZGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAKIAkvKiB0aGVu
IGNoZWNrIHVzZSBkaWdpdGlhbCAqLwogCS8qIHBpY2sgdGhlIGZpcnN0IG9uZSAqLwotCWRybV9j
b25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIsIGkp
CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5j
b2RlcikKIAkJcmV0dXJuIGVuY29kZXI7CiAKIAlyZXR1cm4gTlVMTDsKQEAgLTEyNzEsOSArMTI2
Niw4IEBAIHUxNiBhbWRncHVfY29ubmVjdG9yX2VuY29kZXJfZ2V0X2RwX2JyaWRnZV9lbmNvZGVy
X2lkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uCiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICpl
bmNvZGVyOwogCXN0cnVjdCBhbWRncHVfZW5jb2RlciAqYW1kZ3B1X2VuY29kZXI7Ci0JaW50IGk7
CiAKLQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBl
bmNvZGVyLCBpKSB7CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNv
bm5lY3RvciwgZW5jb2RlcikgewogCQlhbWRncHVfZW5jb2RlciA9IHRvX2FtZGdwdV9lbmNvZGVy
KGVuY29kZXIpOwogCiAJCXN3aXRjaCAoYW1kZ3B1X2VuY29kZXItPmVuY29kZXJfaWQpIHsKQEAg
LTEyOTIsMTAgKzEyODYsOSBAQCBzdGF0aWMgYm9vbCBhbWRncHVfY29ubmVjdG9yX2VuY29kZXJf
aXNfaGJyMihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewogCXN0cnVjdCBkcm1f
ZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1Y3QgYW1kZ3B1X2VuY29kZXIgKmFtZGdwdV9lbmNvZGVy
OwotCWludCBpOwogCWJvb2wgZm91bmQgPSBmYWxzZTsKIAotCWRybV9jb25uZWN0b3JfZm9yX2Vh
Y2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIsIGkpIHsKKwlkcm1fY29ubmVj
dG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKSB7CiAJCWFt
ZGdwdV9lbmNvZGVyID0gdG9fYW1kZ3B1X2VuY29kZXIoZW5jb2Rlcik7CiAJCWlmIChhbWRncHVf
ZW5jb2Rlci0+Y2FwcyAmIEFUT01fRU5DT0RFUl9DQVBfUkVDT1JEX0hCUjIpCiAJCQlmb3VuZCA9
IHRydWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9kY2VfdmlydHVh
bC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvZGNlX3ZpcnR1YWwuYwppbmRleCBjOTYw
OGFlODY0M2IuLmU0Zjk0ODYzMzMyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvZGNlX3ZpcnR1YWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9kY2Vf
dmlydHVhbC5jCkBAIC0yNjAsMTUgKzI2MCwxNCBAQCBzdGF0aWMgc3RydWN0IGRybV9lbmNvZGVy
ICoKIGRjZV92aXJ0dWFsX2VuY29kZXIoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikK
IHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JaW50IGk7CiAKLQlkcm1fY29ubmVj
dG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyLCBpKSB7CisJ
ZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2Rl
cikgewogCQlpZiAoZW5jb2Rlci0+ZW5jb2Rlcl90eXBlID09IERSTV9NT0RFX0VOQ09ERVJfVklS
VFVBTCkKIAkJCXJldHVybiBlbmNvZGVyOwogCX0KIAogCS8qIHBpY2sgdGhlIGZpcnN0IG9uZSAq
LwotCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVu
Y29kZXIsIGkpCisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5l
Y3RvciwgZW5jb2RlcikKIAkJcmV0dXJuIGVuY29kZXI7CiAKIAlyZXR1cm4gTlVMTDsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4
IGUxYjA5YmI0MzJiZC4uODYwYzI5YzQ4OWMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMKQEAgLTQ4MzYsNyArNDgzNiwxMyBAQCBz
dGF0aWMgaW50IHRvX2RybV9jb25uZWN0b3JfdHlwZShlbnVtIHNpZ25hbF90eXBlIHN0KQogCiBz
dGF0aWMgc3RydWN0IGRybV9lbmNvZGVyICphbWRncHVfZG1fY29ubmVjdG9yX3RvX2VuY29kZXIo
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlyZXR1cm4gZHJtX2VuY29kZXJf
ZmluZChjb25uZWN0b3ItPmRldiwgTlVMTCwgY29ubmVjdG9yLT5lbmNvZGVyX2lkc1swXSk7CisJ
c3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCisJLyogVGhlcmUgaXMgb25seSBvbmUgZW5j
b2RlciBwZXIgY29ubmVjdG9yICovCisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9l
bmNvZGVyKGNvbm5lY3RvciwgZW5jb2RlcikKKwkJcmV0dXJuIGVuY29kZXI7CisKKwlyZXR1cm4g
TlVMTDsKIH0KIAogc3RhdGljIHZvaWQgYW1kZ3B1X2RtX2dldF9uYXRpdmVfbW9kZShzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9jbGllbnRfbW9kZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnRfbW9kZXNldC5j
CmluZGV4IGM4OTIyYjdjYWMwOS4uODk1YjczZjIzMDc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2NsaWVudF9tb2Rlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9jbGll
bnRfbW9kZXNldC5jCkBAIC00MTUsOSArNDE1LDggQEAgc3RhdGljIGJvb2wgY29ubmVjdG9yX2hh
c19wb3NzaWJsZV9jcnRjKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkJCXN0
cnVjdCBkcm1fY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0J
aW50IGk7CiAKLQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVj
dG9yLCBlbmNvZGVyLCBpKSB7CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNv
ZGVyKGNvbm5lY3RvciwgZW5jb2RlcikgewogCQlpZiAoZW5jb2Rlci0+cG9zc2libGVfY3J0Y3Mg
JiBkcm1fY3J0Y19tYXNrKGNydGMpKQogCQkJcmV0dXJuIHRydWU7CiAJfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2RybV9jb25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fY29u
bmVjdG9yLmMKaW5kZXggM2UyYTYzMmNmODYxLi5hNmJiZjE2NmI0N2UgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9kcm1fY29ubmVjdG9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9j
b25uZWN0b3IuYwpAQCAtMzY1LDggKzM2NSw2IEBAIEVYUE9SVF9TWU1CT0woZHJtX2Nvbm5lY3Rv
cl9hdHRhY2hfZWRpZF9wcm9wZXJ0eSk7CiBpbnQgZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfZW5jb2Rl
cihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCSBzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIpCiB7Ci0JaW50IGk7Ci0KIAkvKgogCSAqIEluIHRoZSBwYXN0LCBkcml2ZXJz
IGhhdmUgYXR0ZW1wdGVkIHRvIG1vZGVsIHRoZSBzdGF0aWMgYXNzb2NpYXRpb24KIAkgKiBvZiBj
b25uZWN0b3IgdG8gZW5jb2RlciBpbiBzaW1wbGUgY29ubmVjdG9yL2VuY29kZXIgZGV2aWNlcyB1
c2luZyBhCkBAIC0zODEsMTggKzM3OSwxNSBAQCBpbnQgZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfZW5j
b2RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCWlmIChXQVJOX09OKGNvbm5l
Y3Rvci0+ZW5jb2RlcikpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoY29ubmVjdG9yLT5lbmNvZGVyX2lkcyk7IGkrKykgewotCQlpZiAoY29ubmVjdG9y
LT5lbmNvZGVyX2lkc1tpXSA9PSAwKSB7Ci0JCQljb25uZWN0b3ItPmVuY29kZXJfaWRzW2ldID0g
ZW5jb2Rlci0+YmFzZS5pZDsKLQkJCXJldHVybiAwOwotCQl9Ci0JfQotCXJldHVybiAtRU5PTUVN
OworCWNvbm5lY3Rvci0+cG9zc2libGVfZW5jb2RlcnMgfD0gZHJtX2VuY29kZXJfbWFzayhlbmNv
ZGVyKTsKKworCXJldHVybiAwOwogfQogRVhQT1JUX1NZTUJPTChkcm1fY29ubmVjdG9yX2F0dGFj
aF9lbmNvZGVyKTsKIAogLyoqCi0gKiBkcm1fY29ubmVjdG9yX2hhc19wb3NzaWJsZV9lbmNvZGVy
IC0gY2hlY2sgaWYgdGhlIGNvbm5lY3RvciBhbmQgZW5jb2RlciBhcmUgYXNzb3NpY2F0ZWQgd2l0
aCBlYWNoIG90aGVyCisgKiBkcm1fY29ubmVjdG9yX2hhc19wb3NzaWJsZV9lbmNvZGVyIC0gY2hl
Y2sgaWYgdGhlIGNvbm5lY3RvciBhbmQgZW5jb2RlciBhcmUKKyAqIGFzc29jaWF0ZWQgd2l0aCBl
YWNoIG90aGVyCiAgKiBAY29ubmVjdG9yOiB0aGUgY29ubmVjdG9yCiAgKiBAZW5jb2RlcjogdGhl
IGVuY29kZXIKICAqCkBAIC00MDIsMTUgKzM5Nyw3IEBAIEVYUE9SVF9TWU1CT0woZHJtX2Nvbm5l
Y3Rvcl9hdHRhY2hfZW5jb2Rlcik7CiBib29sIGRybV9jb25uZWN0b3JfaGFzX3Bvc3NpYmxlX2Vu
Y29kZXIoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCQkJc3RydWN0IGRybV9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jOwotCWludCBpOwot
Ci0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5j
LCBpKSB7Ci0JCWlmIChlbmMgPT0gZW5jb2RlcikKLQkJCXJldHVybiB0cnVlOwotCX0KLQotCXJl
dHVybiBmYWxzZTsKKwlyZXR1cm4gY29ubmVjdG9yLT5wb3NzaWJsZV9lbmNvZGVycyAmIGRybV9l
bmNvZGVyX21hc2soZW5jb2Rlcik7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9jb25uZWN0b3JfaGFz
X3Bvc3NpYmxlX2VuY29kZXIpOwogCkBAIC0yMTIxLDcgKzIxMDgsNiBAQCBpbnQgZHJtX21vZGVf
Z2V0Y29ubmVjdG9yKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaW50IGVu
Y29kZXJzX2NvdW50ID0gMDsKIAlpbnQgcmV0ID0gMDsKIAlpbnQgY29waWVkID0gMDsKLQlpbnQg
aTsKIAlzdHJ1Y3QgZHJtX21vZGVfbW9kZWluZm8gdV9tb2RlOwogCXN0cnVjdCBkcm1fbW9kZV9t
b2RlaW5mbyBfX3VzZXIgKm1vZGVfcHRyOwogCXVpbnQzMl90IF9fdXNlciAqZW5jb2Rlcl9wdHI7
CkBAIC0yMTM2LDE0ICsyMTIyLDEzIEBAIGludCBkcm1fbW9kZV9nZXRjb25uZWN0b3Ioc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlpZiAoIWNvbm5lY3RvcikKIAkJcmV0dXJu
IC1FTk9FTlQ7CiAKLQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29u
bmVjdG9yLCBlbmNvZGVyLCBpKQotCQllbmNvZGVyc19jb3VudCsrOworCWVuY29kZXJzX2NvdW50
ID0gaHdlaWdodDMyKGNvbm5lY3Rvci0+cG9zc2libGVfZW5jb2RlcnMpOwogCiAJaWYgKChvdXRf
cmVzcC0+Y291bnRfZW5jb2RlcnMgPj0gZW5jb2RlcnNfY291bnQpICYmIGVuY29kZXJzX2NvdW50
KSB7CiAJCWNvcGllZCA9IDA7CiAJCWVuY29kZXJfcHRyID0gKHVpbnQzMl90IF9fdXNlciAqKSh1
bnNpZ25lZCBsb25nKShvdXRfcmVzcC0+ZW5jb2RlcnNfcHRyKTsKIAotCQlkcm1fY29ubmVjdG9y
X2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyLCBpKSB7CisJCWRy
bV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIp
IHsKIAkJCWlmIChwdXRfdXNlcihlbmNvZGVyLT5iYXNlLmlkLCBlbmNvZGVyX3B0ciArIGNvcGll
ZCkpIHsKIAkJCQlyZXQgPSAtRUZBVUxUOwogCQkJCWdvdG8gb3V0OwpAQCAtMjM0Miw2ICsyMzI3
LDExIEBAIEVYUE9SVF9TWU1CT0woZHJtX21vZGVfY3JlYXRlX3RpbGVfZ3JvdXApOwogc3RydWN0
IGRybV9lbmNvZGVyICoKIGRybV9jb25uZWN0b3JfZ2V0X3NpbmdsZV9lbmNvZGVyKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0JV0FSTl9PTihjb25uZWN0b3ItPmVuY29kZXJf
aWRzWzFdKTsKLQlyZXR1cm4gZHJtX2VuY29kZXJfZmluZChjb25uZWN0b3ItPmRldiwgTlVMTCwg
Y29ubmVjdG9yLT5lbmNvZGVyX2lkc1swXSk7CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVy
OworCisJV0FSTl9PTihod2VpZ2h0MzIoY29ubmVjdG9yLT5wb3NzaWJsZV9lbmNvZGVycykgPiAx
KTsKKwlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBl
bmNvZGVyKQorCQlyZXR1cm4gZW5jb2RlcjsKKworCXJldHVybiBOVUxMOwogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fcHJvYmVfaGVscGVyLmMKaW5kZXggMzUxY2JjNDBmMGY4Li5hN2M4N2FiZTg4ZDAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYwpAQCAtOTMsNyArOTMsNiBAQCBkcm1fbW9kZV92YWxp
ZGF0ZV9waXBlbGluZShzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5kZXY7CiAJZW51bSBkcm1fbW9kZV9zdGF0dXMgcmV0
ID0gTU9ERV9PSzsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JaW50IGk7CiAKIAkv
KiBTdGVwIDE6IFZhbGlkYXRlIGFnYWluc3QgY29ubmVjdG9yICovCiAJcmV0ID0gZHJtX2Nvbm5l
Y3Rvcl9tb2RlX3ZhbGlkKGNvbm5lY3RvciwgbW9kZSk7CkBAIC0xMDEsNyArMTAwLDcgQEAgZHJt
X21vZGVfdmFsaWRhdGVfcGlwZWxpbmUoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJ
CXJldHVybiByZXQ7CiAKIAkvKiBTdGVwIDI6IFZhbGlkYXRlIGFnYWluc3QgZW5jb2RlcnMgYW5k
IGNydGNzICovCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5l
Y3RvciwgZW5jb2RlciwgaSkgeworCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5j
b2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKIAkJc3RydWN0IGRybV9jcnRjICpjcnRjOwogCiAJ
CXJldCA9IGRybV9lbmNvZGVyX21vZGVfdmFsaWQoZW5jb2RlciwgbW9kZSk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9kaXNwLmMgYi9kcml2ZXJzL2dwdS9k
cm0vbm91dmVhdS9kaXNwbnYwNC9kaXNwLmMKaW5kZXggZGM2NDg2M2I1ZmQ4Li40NGVlODJkMGM5
YjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjA0L2Rpc3AuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9kaXNwLmMKQEAgLTI1Niw3ICsy
NTYsNyBAQCBudjA0X2Rpc3BsYXlfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY29ubmVjdG9yLCBjdCwKIAkJCQkgJmRldi0+bW9kZV9j
b25maWcuY29ubmVjdG9yX2xpc3QsIGhlYWQpIHsKLQkJaWYgKCFjb25uZWN0b3ItPmVuY29kZXJf
aWRzWzBdKSB7CisJCWlmICghY29ubmVjdG9yLT5wb3NzaWJsZV9lbmNvZGVycykgewogCQkJTlZf
V0FSTihkcm0sICIlcyBoYXMgbm8gZW5jb2RlcnMsIHJlbW92aW5nXG4iLAogCQkJCWNvbm5lY3Rv
ci0+bmFtZSk7CiAJCQljb25uZWN0b3ItPmZ1bmNzLT5kZXN0cm95KGNvbm5lY3Rvcik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC9kaXNwLmMgYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC9kaXNwLmMKaW5kZXggMzA3NTg0MTA3ZDc3Li45OGM4
NzE5NWQ3MTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjUwL2Rp
c3AuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC9kaXNwLmMKQEAgLTIz
OTEsNyArMjM5MSw3IEBAIG52NTBfZGlzcGxheV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRl
dikKIAogCS8qIGN1bGwgYW55IGNvbm5lY3RvcnMgd2UgY3JlYXRlZCB0aGF0IGRvbid0IGhhdmUg
YW4gZW5jb2RlciAqLwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjb25uZWN0b3IsIHRtcCwg
JmRldi0+bW9kZV9jb25maWcuY29ubmVjdG9yX2xpc3QsIGhlYWQpIHsKLQkJaWYgKGNvbm5lY3Rv
ci0+ZW5jb2Rlcl9pZHNbMF0pCisJCWlmIChjb25uZWN0b3ItPnBvc3NpYmxlX2VuY29kZXJzKQog
CQkJY29udGludWU7CiAKIAkJTlZfV0FSTihkcm0sICIlcyBoYXMgbm8gZW5jb2RlcnMsIHJlbW92
aW5nXG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jb25u
ZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfY29ubmVjdG9yLmMKaW5k
ZXggNTY4NzFkMzRlM2ZiLi4zYTVkYjE3YmM1YzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfY29ubmVjdG9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZl
YXUvbm91dmVhdV9jb25uZWN0b3IuYwpAQCAtMzY1LDkgKzM2NSw4IEBAIGZpbmRfZW5jb2Rlcihz
dHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBpbnQgdHlwZSkKIHsKIAlzdHJ1Y3Qgbm91
dmVhdV9lbmNvZGVyICpudl9lbmNvZGVyOwogCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jOwotCWlu
dCBpOwogCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3Rv
ciwgZW5jLCBpKSB7CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNv
bm5lY3RvciwgZW5jKSB7CiAJCW52X2VuY29kZXIgPSBub3V2ZWF1X2VuY29kZXIoZW5jKTsKIAog
CQlpZiAodHlwZSA9PSBEQ0JfT1VUUFVUX0FOWSB8fApAQCAtNDE0LDEwICs0MTMsMTAgQEAgbm91
dmVhdV9jb25uZWN0b3JfZGRjX2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
KQogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjb25uZWN0b3ItPmRldjsKIAlzdHJ1Y3Qgbm91
dmVhdV9lbmNvZGVyICpudl9lbmNvZGVyID0gTlVMTCwgKmZvdW5kID0gTlVMTDsKIAlzdHJ1Y3Qg
ZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JaW50IGksIHJldDsKKwlpbnQgcmV0OwogCWJvb2wgc3dp
dGNoZXJvb19kZGMgPSBmYWxzZTsKIAotCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVf
ZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIsIGkpIHsKKwlkcm1fY29ubmVjdG9yX2Zvcl9lYWNo
X3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKSB7CiAJCW52X2VuY29kZXIgPSBu
b3V2ZWF1X2VuY29kZXIoZW5jb2Rlcik7CiAKIAkJc3dpdGNoIChudl9lbmNvZGVyLT5kY2ItPnR5
cGUpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2Nvbm5lY3Rv
cnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2Nvbm5lY3RvcnMuYwppbmRleCBi
Njg0Y2Q3MTk2MTIuLmMwNzQyN2QzYzE5OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Jh
ZGVvbi9yYWRlb25fY29ubmVjdG9ycy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFk
ZW9uX2Nvbm5lY3RvcnMuYwpAQCAtMjQ5LDExICsyNDksMTAgQEAgcmFkZW9uX2Nvbm5lY3Rvcl91
cGRhdGVfc2NyYXRjaF9yZWdzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0g
ZHJtX2MKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CiAJY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3JfaGVscGVyX2Z1bmNzICpjb25uZWN0b3JfZnVuY3MgPSBjb25uZWN0b3ItPmhlbHBl
cl9wcml2YXRlOwogCWJvb2wgY29ubmVjdGVkOwotCWludCBpOwogCiAJYmVzdF9lbmNvZGVyID0g
Y29ubmVjdG9yX2Z1bmNzLT5iZXN0X2VuY29kZXIoY29ubmVjdG9yKTsKIAotCWRybV9jb25uZWN0
b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIsIGkpIHsKKwlk
cm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVy
KSB7CiAJCWlmICgoZW5jb2RlciA9PSBiZXN0X2VuY29kZXIpICYmIChzdGF0dXMgPT0gY29ubmVj
dG9yX3N0YXR1c19jb25uZWN0ZWQpKQogCQkJY29ubmVjdGVkID0gdHJ1ZTsKIAkJZWxzZQpAQCAt
MjY5LDkgKzI2OCw4IEBAIHJhZGVvbl9jb25uZWN0b3JfdXBkYXRlX3NjcmF0Y2hfcmVncyhzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIGRybV9jCiBzdGF0aWMgc3RydWN0IGRy
bV9lbmNvZGVyICpyYWRlb25fZmluZF9lbmNvZGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IsIGludCBlbmNvZGVyX3R5cGUpCiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVy
OwotCWludCBpOwogCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNv
bm5lY3RvciwgZW5jb2RlciwgaSkgeworCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVf
ZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKIAkJaWYgKGVuY29kZXItPmVuY29kZXJfdHlw
ZSA9PSBlbmNvZGVyX3R5cGUpCiAJCQlyZXR1cm4gZW5jb2RlcjsKIAl9CkBAIC0zODAsMTAgKzM3
OCw5IEBAIHN0YXRpYyBpbnQgcmFkZW9uX2RkY19nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIHN0YXRpYyBzdHJ1Y3QgZHJtX2VuY29kZXIgKnJhZGVvbl9iZXN0X3Np
bmdsZV9lbmNvZGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0
IGRybV9lbmNvZGVyICplbmNvZGVyOwotCWludCBpOwogCiAJLyogcGljayB0aGUgZmlyc3Qgb25l
ICovCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3Rvciwg
ZW5jb2RlciwgaSkKKwlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29u
bmVjdG9yLCBlbmNvZGVyKQogCQlyZXR1cm4gZW5jb2RlcjsKIAogCXJldHVybiBOVUxMOwpAQCAt
NDI4LDE0ICs0MjUsMTMgQEAgcmFkZW9uX2Nvbm5lY3Rvcl9hbmFsb2dfZW5jb2Rlcl9jb25mbGlj
dF9zb2x2ZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCiAJbGlzdF9mb3JfZWFj
aF9lbnRyeShjb25mbGljdCwgJmRldi0+bW9kZV9jb25maWcuY29ubmVjdG9yX2xpc3QsIGhlYWQp
IHsKIAkJc3RydWN0IGRybV9lbmNvZGVyICplbmM7Ci0JCWludCBpOwogCiAJCWlmIChjb25mbGlj
dCA9PSBjb25uZWN0b3IpCiAJCQljb250aW51ZTsKIAogCQlyYWRlb25fY29uZmxpY3QgPSB0b19y
YWRlb25fY29ubmVjdG9yKGNvbmZsaWN0KTsKIAotCQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bv
c3NpYmxlX2VuY29kZXIoY29uZmxpY3QsIGVuYywgaSkgeworCQlkcm1fY29ubmVjdG9yX2Zvcl9l
YWNoX3Bvc3NpYmxlX2VuY29kZXIoY29uZmxpY3QsIGVuYykgewogCQkJLyogaWYgdGhlIElEcyBt
YXRjaCAqLwogCQkJaWYgKGVuYyA9PSBlbmNvZGVyKSB7CiAJCQkJaWYgKGNvbmZsaWN0LT5zdGF0
dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpCkBAIC0xMzYzLDkgKzEzNTksNyBAQCBy
YWRlb25fZHZpX2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBib29sIGZv
cmNlKQogCiAJLyogZmluZCBhbmFsb2cgZW5jb2RlciAqLwogCWlmIChyYWRlb25fY29ubmVjdG9y
LT5kYWNfbG9hZF9kZXRlY3QpIHsKLQkJaW50IGk7Ci0KLQkJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFj
aF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2RlciwgaSkgeworCQlkcm1fY29ubmVj
dG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKSB7CiAJCQlp
ZiAoZW5jb2Rlci0+ZW5jb2Rlcl90eXBlICE9IERSTV9NT0RFX0VOQ09ERVJfREFDICYmCiAJCQkg
ICAgZW5jb2Rlci0+ZW5jb2Rlcl90eXBlICE9IERSTV9NT0RFX0VOQ09ERVJfVFZEQUMpCiAJCQkJ
Y29udGludWU7CkBAIC0xNDQzLDkgKzE0MzcsOCBAQCBzdGF0aWMgc3RydWN0IGRybV9lbmNvZGVy
ICpyYWRlb25fZHZpX2VuY29kZXIoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsK
IAlzdHJ1Y3QgcmFkZW9uX2Nvbm5lY3RvciAqcmFkZW9uX2Nvbm5lY3RvciA9IHRvX3JhZGVvbl9j
b25uZWN0b3IoY29ubmVjdG9yKTsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JaW50
IGk7CiAKLQlkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9y
LCBlbmNvZGVyLCBpKSB7CisJZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVy
KGNvbm5lY3RvciwgZW5jb2RlcikgewogCQlpZiAocmFkZW9uX2Nvbm5lY3Rvci0+dXNlX2RpZ2l0
YWwgPT0gdHJ1ZSkgewogCQkJaWYgKGVuY29kZXItPmVuY29kZXJfdHlwZSA9PSBEUk1fTU9ERV9F
TkNPREVSX1RNRFMpCiAJCQkJcmV0dXJuIGVuY29kZXI7CkBAIC0xNDYwLDcgKzE0NTMsNyBAQCBz
dGF0aWMgc3RydWN0IGRybV9lbmNvZGVyICpyYWRlb25fZHZpX2VuY29kZXIoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvcikKIAogCS8qIHRoZW4gY2hlY2sgdXNlIGRpZ2l0aWFsICovCiAJ
LyogcGljayB0aGUgZmlyc3Qgb25lICovCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJs
ZV9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2RlciwgaSkKKwlkcm1fY29ubmVjdG9yX2Zvcl9lYWNo
X3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKQogCQlyZXR1cm4gZW5jb2RlcjsK
IAogCXJldHVybiBOVUxMOwpAQCAtMTYwMyw5ICsxNTk2LDggQEAgdTE2IHJhZGVvbl9jb25uZWN0
b3JfZW5jb2Rlcl9nZXRfZHBfYnJpZGdlX2VuY29kZXJfaWQoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm4KIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0IHJhZGVvbl9l
bmNvZGVyICpyYWRlb25fZW5jb2RlcjsKLQlpbnQgaTsKIAotCWRybV9jb25uZWN0b3JfZm9yX2Vh
Y2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIsIGkpIHsKKwlkcm1fY29ubmVj
dG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNvZGVyKSB7CiAJCXJh
ZGVvbl9lbmNvZGVyID0gdG9fcmFkZW9uX2VuY29kZXIoZW5jb2Rlcik7CiAKIAkJc3dpdGNoIChy
YWRlb25fZW5jb2Rlci0+ZW5jb2Rlcl9pZCkgewpAQCAtMTYyNCwxMCArMTYxNiw5IEBAIHN0YXRp
YyBib29sIHJhZGVvbl9jb25uZWN0b3JfZW5jb2Rlcl9pc19oYnIyKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVj
dCByYWRlb25fZW5jb2RlciAqcmFkZW9uX2VuY29kZXI7Ci0JaW50IGk7CiAJYm9vbCBmb3VuZCA9
IGZhbHNlOwogCi0JZHJtX2Nvbm5lY3Rvcl9mb3JfZWFjaF9wb3NzaWJsZV9lbmNvZGVyKGNvbm5l
Y3RvciwgZW5jb2RlciwgaSkgeworCWRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5j
b2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKIAkJcmFkZW9uX2VuY29kZXIgPSB0b19yYWRlb25f
ZW5jb2RlcihlbmNvZGVyKTsKIAkJaWYgKHJhZGVvbl9lbmNvZGVyLT5jYXBzICYgQVRPTV9FTkNP
REVSX0NBUF9SRUNPUkRfSEJSMikKIAkJCWZvdW5kID0gdHJ1ZTsKZGlmZiAtLWdpdCBhL2luY2x1
ZGUvZHJtL2RybV9jb25uZWN0b3IuaCBiL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaAppbmRl
eCA2ODFjYjU5MGY5NTIuLmM2ZTk5M2U3OGRiZCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJt
X2Nvbm5lY3Rvci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaApAQCAtMTI4OCwx
MiArMTI4OCwxMiBAQCBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciB7CiAJLyoqIEBvdmVycmlkZV9lZGlk
OiBoYXMgdGhlIEVESUQgYmVlbiBvdmVyd3JpdHRlbiB0aHJvdWdoIGRlYnVnZnMgZm9yIHRlc3Rp
bmc/ICovCiAJYm9vbCBvdmVycmlkZV9lZGlkOwogCi0jZGVmaW5lIERSTV9DT05ORUNUT1JfTUFY
X0VOQ09ERVIgMwogCS8qKgotCSAqIEBlbmNvZGVyX2lkczogVmFsaWQgZW5jb2RlcnMgZm9yIHRo
aXMgY29ubmVjdG9yLiBQbGVhc2Ugb25seSB1c2UKLQkgKiBkcm1fY29ubmVjdG9yX2Zvcl9lYWNo
X3Bvc3NpYmxlX2VuY29kZXIoKSB0byBlbnVtZXJhdGUgdGhlc2UuCisJICogQHBvc3NpYmxlX2Vu
Y29kZXJzOiBCaXQgbWFzayBvZiBlbmNvZGVycyB0aGF0IGNhbiBkcml2ZSB0aGlzCisJICogY29u
bmVjdG9yLCBkcm1fZW5jb2Rlcl9pbmRleCgpIGRldGVybWluZXMgdGhlIGluZGV4IGludG8gdGhl
IGJpdGZpZWxkCisJICogYW5kIHRoZSBiaXRzIGFyZSBzZXQgd2l0aCBkcm1fY29ubmVjdG9yX2F0
dGFjaF9lbmNvZGVyKCkuCiAJICovCi0JdWludDMyX3QgZW5jb2Rlcl9pZHNbRFJNX0NPTk5FQ1RP
Ul9NQVhfRU5DT0RFUl07CisJdTMyIHBvc3NpYmxlX2VuY29kZXJzOwogCiAJLyoqCiAJICogQGVu
Y29kZXI6IEN1cnJlbnRseSBib3VuZCBlbmNvZGVyIGRyaXZpbmcgdGhpcyBjb25uZWN0b3IsIGlm
IGFueS4KQEAgLTE2MDgsMTMgKzE2MDgsOSBAQCBib29sIGRybV9jb25uZWN0b3JfaGFzX3Bvc3Np
YmxlX2VuY29kZXIoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKICAqIGRybV9jb25u
ZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2RlciAtIGl0ZXJhdGUgY29ubmVjdG9yJ3MgcG9z
c2libGUgZW5jb2RlcnMKICAqIEBjb25uZWN0b3I6ICZzdHJ1Y3QgZHJtX2Nvbm5lY3RvciBwb2lu
dGVyCiAgKiBAZW5jb2RlcjogJnN0cnVjdCBkcm1fZW5jb2RlciBwb2ludGVyIHVzZWQgYXMgY3Vy
c29yCi0gKiBAX19pOiBpbnQgaXRlcmF0aW9uIGN1cnNvciwgZm9yIG1hY3JvLWludGVybmFsIHVz
ZQogICovCi0jZGVmaW5lIGRybV9jb25uZWN0b3JfZm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihj
b25uZWN0b3IsIGVuY29kZXIsIF9faSkgXAotCWZvciAoKF9faSkgPSAwOyAoX19pKSA8IEFSUkFZ
X1NJWkUoKGNvbm5lY3RvciktPmVuY29kZXJfaWRzKSAmJiBcCi0JCSAgICAgKGNvbm5lY3Rvcikt
PmVuY29kZXJfaWRzWyhfX2kpXSAhPSAwOyAoX19pKSsrKSBcCi0JCWZvcl9lYWNoX2lmKChlbmNv
ZGVyKSA9IFwKLQkJCSAgICBkcm1fZW5jb2Rlcl9maW5kKChjb25uZWN0b3IpLT5kZXYsIE5VTEws
IFwKLQkJCQkJICAgICAoY29ubmVjdG9yKS0+ZW5jb2Rlcl9pZHNbKF9faSldKSkgXAorI2RlZmlu
ZSBkcm1fY29ubmVjdG9yX2Zvcl9lYWNoX3Bvc3NpYmxlX2VuY29kZXIoY29ubmVjdG9yLCBlbmNv
ZGVyKSBcCisJZHJtX2Zvcl9lYWNoX2VuY29kZXJfbWFzayhlbmNvZGVyLCAoY29ubmVjdG9yKS0+
ZGV2LCBcCisJCQkJICAoY29ubmVjdG9yKS0+cG9zc2libGVfZW5jb2RlcnMpCiAKICNlbmRpZgot
LSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
