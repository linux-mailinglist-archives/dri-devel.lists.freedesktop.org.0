Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E9C5F9F08A
	for <lists+dri-devel@lfdr.de>; Tue, 27 Aug 2019 18:45:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 131AA891A4;
	Tue, 27 Aug 2019 16:45:40 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-io1-xd44.google.com (mail-io1-xd44.google.com
 [IPv6:2607:f8b0:4864:20::d44])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2E331891A4
 for <dri-devel@lists.freedesktop.org>; Tue, 27 Aug 2019 16:45:39 +0000 (UTC)
Received: by mail-io1-xd44.google.com with SMTP id b10so38812379ioj.2
 for <dri-devel@lists.freedesktop.org>; Tue, 27 Aug 2019 09:45:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=bgEZL7FHXVC38tkVb8BiSRS9kzc42h1C+rKp2AsOFAo=;
 b=juTOJa5yaUINiJy3psL67C18+yWUalfxg2MrGPuBVzTdOO6jBES2uisu5xpIllmeQL
 KaF8B1oxhNF+PYbyZtfWx5s8MRKhZlASD2jApLqXfQxOXZs7qt5cnlqCcvHTQJeSR8FZ
 egPP8lHaAhP5AKYE/f8FpAwe3aaqbwJsUldI4NhuMjyXY3/2w5SRGIy9e/+wRekvWuEH
 Kv5tnMJ2qNJbjXC6zSRiBRHhpLNRW4BdICZRifi8436s/4XHuvuRMLfCmiIoVnxmxsKN
 MYCKAYnbdXCr1MuyGTcQPWjrlEiVsrW3CvdekC8EgC0oVp26ly8Ii6OZZcMp5ka9Bkgs
 PFVw==
X-Gm-Message-State: APjAAAVkdRVUucrQLXSxD4Wnn/KP15PZLONgSuOU8hacRE9wmj0oE9mu
 TfFeDlOZdBuK/zzfLPJbrnZg8xRXlLMGUcZ6XZQ=
X-Google-Smtp-Source: APXvYqwMDuQ1qPyVS6ef0qkkeTM17FDw8fs2kRk6HNwsBmCQAJLs9dkPFKkpzSV5F8vJTpvLB0sUGUBT0Atm2qMcXC0=
X-Received: by 2002:a6b:6f06:: with SMTP id k6mr33986129ioc.232.1566924338329; 
 Tue, 27 Aug 2019 09:45:38 -0700 (PDT)
MIME-Version: 1.0
References: <20190813082509.29324-1-kraxel@redhat.com>
 <20190813082509.29324-3-kraxel@redhat.com>
In-Reply-To: <20190813082509.29324-3-kraxel@redhat.com>
From: Chia-I Wu <olvaffe@gmail.com>
Date: Tue, 27 Aug 2019 09:45:27 -0700
Message-ID: <CAPaKu7T2AA83wLchMDmLEEb-VgvdfCP3_Dz8drrH9hptgXPn9g@mail.gmail.com>
Subject: Re: [PATCH 2/2] drm/virtio: notify virtqueues without holding spinlock
To: Gerd Hoffmann <kraxel@redhat.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=bgEZL7FHXVC38tkVb8BiSRS9kzc42h1C+rKp2AsOFAo=;
 b=T6sitAXXsulHPQdxWkBxQoQ5ma3ksEOLb1V/hrE/6RubIs6kJkFPQSGzCSYd/uGPXe
 rgQU8z5g7+cFRG1QF7yW25qsZURMuJMXmyb9xujtNB8s3WQe1gVLdlRtRfNRyOCg75iu
 Rti4wabkh6aPySTaup/hsr7t4vvn0h5ZHCRepu/NOuHzMVwVRuJ25j0lSKQevAVXEoJ7
 ewe34JV3U7tris/s7XI2ZwwfYV3drOlobjk0Kf86c0BDwMmsN1akmTeeUjv8ZMLks6re
 8SWY68KxAnL5hZADc6L82KxM9iSsdCaIIsTFwC+bvxjIhnzKtigG2D/6woMhYUs7FAl8
 KHPg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 ML dri-devel <dri-devel@lists.freedesktop.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVHVlLCBBdWcgMTMsIDIwMTkgYXQgMToyNSBBTSBHZXJkIEhvZmZtYW5uIDxrcmF4ZWxAcmVk
aGF0LmNvbT4gd3JvdGU6Cj4KPiBTcGxpdCB2aXJ0cXVldWVfa2ljaygpIGNhbGwgaW50byB2aXJ0
cXVldWVfa2lja19wcmVwYXJlKCksIHdoaWNoCj4gcmVxdWlyZXMgc2VyaWFsaXphdGlvbiwgYW5k
IHZpcnRxdWV1ZV9ub3RpZnkoKSwgd2hpY2ggZG9lcyBub3QuICBNb3ZlCj4gdGhlIHZpcnRxdWV1
ZV9ub3RpZnkoKSBjYWxsIG91dCBvZiB0aGUgY3JpdGljYWwgc2VjdGlvbiBwcm90ZWN0ZWQgYnkg
dGhlCj4gcXVldWUgbG9jay4gIFRoaXMgYXZvaWRzIHRyaWdnZXJpbmcgYSB2bWV4aXQgd2hpbGUg
aG9sZGluZyB0aGUgbG9jayBhbmQKPiB0aGVyZWJ5IGZpeGVzIGEgcmF0aGVyIGJhZCBzcGlubG9j
ayBjb250ZW50aW9uLgo+Cj4gU3VnZ2VzdGVkLWJ5OiBDaGlhLUkgV3UgPG9sdmFmZmVAZ21haWwu
Y29tPgo+IFNpZ25lZC1vZmYtYnk6IEdlcmQgSG9mZm1hbm4gPGtyYXhlbEByZWRoYXQuY29tPgpT
ZXJpZXMgaXMKClJldmlld2VkLWJ5OiBDaGlhLUkgV3UgPG9sdmFmZmVAZ21haWwuY29tPgo+IC0t
LQo+ICBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYyB8IDI1ICsrKysrKysrKysr
KysrKysrKystLS0tLS0KPiAgMSBmaWxlIGNoYW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDYgZGVs
ZXRpb25zKC0pCj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1
X3ZxLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYwo+IGluZGV4IGNhOTFl
ODNmZmFlZi4uZTQxYzk2MTQzMzQyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0
aW8vdmlydGdwdV92cS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3Zx
LmMKPiBAQCAtMjUyLDcgKzI1Miw3IEBAIHZvaWQgdmlydGlvX2dwdV9kZXF1ZXVlX2N1cnNvcl9m
dW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKPiAgICAgICAgIHdha2VfdXAoJnZnZGV2LT5j
dXJzb3JxLmFja19xdWV1ZSk7Cj4gIH0KPgo+IC1zdGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X3F1ZXVl
X2N0cmxfYnVmZmVyX2xvY2tlZChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAo+ICtz
dGF0aWMgYm9vbCB2aXJ0aW9fZ3B1X3F1ZXVlX2N0cmxfYnVmZmVyX2xvY2tlZChzdHJ1Y3Qgdmly
dGlvX2dwdV9kZXZpY2UgKnZnZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X3ZidWZmZXIgKnZidWYpCj4gICAgICAg
ICAgICAgICAgIF9fcmVsZWFzZXMoJnZnZGV2LT5jdHJscS5xbG9jaykKPiAgICAgICAgICAgICAg
ICAgX19hY3F1aXJlcygmdmdkZXYtPmN0cmxxLnFsb2NrKQo+IEBAIC0yNjAsMTAgKzI2MCwxMSBA
QCBzdGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X3F1ZXVlX2N0cmxfYnVmZmVyX2xvY2tlZChzdHJ1Y3Qg
dmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAo+ICAgICAgICAgc3RydWN0IHZpcnRxdWV1ZSAqdnEg
PSB2Z2Rldi0+Y3RybHEudnE7Cj4gICAgICAgICBzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnc1szXSwg
dmNtZCwgdm91dCwgdnJlc3A7Cj4gICAgICAgICBpbnQgb3V0Y250ID0gMCwgaW5jbnQgPSAwOwo+
ICsgICAgICAgYm9vbCBub3RpZnkgPSBmYWxzZTsKPiAgICAgICAgIGludCByZXQ7Cj4KPiAgICAg
ICAgIGlmICghdmdkZXYtPnZxc19yZWFkeSkKPiAtICAgICAgICAgICAgICAgcmV0dXJuOwo+ICsg
ICAgICAgICAgICAgICByZXR1cm4gbm90aWZ5Owo+Cj4gICAgICAgICBzZ19pbml0X29uZSgmdmNt
ZCwgdmJ1Zi0+YnVmLCB2YnVmLT5zaXplKTsKPiAgICAgICAgIHNnc1tvdXRjbnQgKyBpbmNudF0g
PSAmdmNtZDsKPiBAQCAtMjkyLDE2ICsyOTMsMjEgQEAgc3RhdGljIHZvaWQgdmlydGlvX2dwdV9x
dWV1ZV9jdHJsX2J1ZmZlcl9sb2NrZWQoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwK
PiAgICAgICAgICAgICAgICAgdHJhY2VfdmlydGlvX2dwdV9jbWRfcXVldWUodnEsCj4gICAgICAg
ICAgICAgICAgICAgICAgICAgKHN0cnVjdCB2aXJ0aW9fZ3B1X2N0cmxfaGRyICopdmJ1Zi0+YnVm
KTsKPgo+IC0gICAgICAgICAgICAgICB2aXJ0cXVldWVfa2ljayh2cSk7Cj4gKyAgICAgICAgICAg
ICAgIG5vdGlmeSA9IHZpcnRxdWV1ZV9raWNrX3ByZXBhcmUodnEpOwo+ICAgICAgICAgfQo+ICsg
ICAgICAgcmV0dXJuIG5vdGlmeTsKPiAgfQo+Cj4gIHN0YXRpYyB2b2lkIHZpcnRpb19ncHVfcXVl
dWVfY3RybF9idWZmZXIoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKPiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X3ZidWZm
ZXIgKnZidWYpCj4gIHsKPiArICAgICAgIGJvb2wgbm90aWZ5Owo+ICsKPiAgICAgICAgIHNwaW5f
bG9jaygmdmdkZXYtPmN0cmxxLnFsb2NrKTsKPiAtICAgICAgIHZpcnRpb19ncHVfcXVldWVfY3Ry
bF9idWZmZXJfbG9ja2VkKHZnZGV2LCB2YnVmKTsKPiArICAgICAgIG5vdGlmeSA9IHZpcnRpb19n
cHVfcXVldWVfY3RybF9idWZmZXJfbG9ja2VkKHZnZGV2LCB2YnVmKTsKPiAgICAgICAgIHNwaW5f
dW5sb2NrKCZ2Z2Rldi0+Y3RybHEucWxvY2spOwo+ICsgICAgICAgaWYgKG5vdGlmeSkKPiArICAg
ICAgICAgICAgICAgdmlydHF1ZXVlX25vdGlmeSh2Z2Rldi0+Y3RybHEudnEpOwo+ICB9Cj4KPiAg
c3RhdGljIHZvaWQgdmlydGlvX2dwdV9xdWV1ZV9mZW5jZWRfY3RybF9idWZmZXIoc3RydWN0IHZp
cnRpb19ncHVfZGV2aWNlICp2Z2RldiwKPiBAQCAtMzEwLDYgKzMxNiw3IEBAIHN0YXRpYyB2b2lk
IHZpcnRpb19ncHVfcXVldWVfZmVuY2VkX2N0cmxfYnVmZmVyKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rl
dmljZSAqdmdkZXYsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgKmZlbmNlKQo+ICB7Cj4gICAgICAgICBzdHJ1
Y3QgdmlydHF1ZXVlICp2cSA9IHZnZGV2LT5jdHJscS52cTsKPiArICAgICAgIGJvb2wgbm90aWZ5
Owo+Cj4gIGFnYWluOgo+ICAgICAgICAgc3Bpbl9sb2NrKCZ2Z2Rldi0+Y3RybHEucWxvY2spOwo+
IEBAIC0zMzAsOCArMzM3LDEwIEBAIHN0YXRpYyB2b2lkIHZpcnRpb19ncHVfcXVldWVfZmVuY2Vk
X2N0cmxfYnVmZmVyKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCj4KPiAgICAgICAg
IGlmIChmZW5jZSkKPiAgICAgICAgICAgICAgICAgdmlydGlvX2dwdV9mZW5jZV9lbWl0KHZnZGV2
LCBoZHIsIGZlbmNlKTsKPiAtICAgICAgIHZpcnRpb19ncHVfcXVldWVfY3RybF9idWZmZXJfbG9j
a2VkKHZnZGV2LCB2YnVmKTsKPiArICAgICAgIG5vdGlmeSA9IHZpcnRpb19ncHVfcXVldWVfY3Ry
bF9idWZmZXJfbG9ja2VkKHZnZGV2LCB2YnVmKTsKPiAgICAgICAgIHNwaW5fdW5sb2NrKCZ2Z2Rl
di0+Y3RybHEucWxvY2spOwo+ICsgICAgICAgaWYgKG5vdGlmeSkKPiArICAgICAgICAgICAgICAg
dmlydHF1ZXVlX25vdGlmeSh2Z2Rldi0+Y3RybHEudnEpOwo+ICB9Cj4KPiAgc3RhdGljIHZvaWQg
dmlydGlvX2dwdV9xdWV1ZV9jdXJzb3Ioc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwK
PiBAQCAtMzM5LDYgKzM0OCw3IEBAIHN0YXRpYyB2b2lkIHZpcnRpb19ncHVfcXVldWVfY3Vyc29y
KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCj4gIHsKPiAgICAgICAgIHN0cnVjdCB2
aXJ0cXVldWUgKnZxID0gdmdkZXYtPmN1cnNvcnEudnE7Cj4gICAgICAgICBzdHJ1Y3Qgc2NhdHRl
cmxpc3QgKnNnc1sxXSwgY2NtZDsKPiArICAgICAgIGJvb2wgbm90aWZ5Owo+ICAgICAgICAgaW50
IHJldDsKPiAgICAgICAgIGludCBvdXRjbnQ7Cj4KPiBAQCAtMzYxLDEwICszNzEsMTMgQEAgc3Rh
dGljIHZvaWQgdmlydGlvX2dwdV9xdWV1ZV9jdXJzb3Ioc3RydWN0IHZpcnRpb19ncHVfZGV2aWNl
ICp2Z2RldiwKPiAgICAgICAgICAgICAgICAgdHJhY2VfdmlydGlvX2dwdV9jbWRfcXVldWUodnEs
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgKHN0cnVjdCB2aXJ0aW9fZ3B1X2N0cmxfaGRyICop
dmJ1Zi0+YnVmKTsKPgo+IC0gICAgICAgICAgICAgICB2aXJ0cXVldWVfa2ljayh2cSk7Cj4gKyAg
ICAgICAgICAgICAgIG5vdGlmeSA9IHZpcnRxdWV1ZV9raWNrX3ByZXBhcmUodnEpOwo+ICAgICAg
ICAgfQo+Cj4gICAgICAgICBzcGluX3VubG9jaygmdmdkZXYtPmN1cnNvcnEucWxvY2spOwo+ICsK
PiArICAgICAgIGlmIChub3RpZnkpCj4gKyAgICAgICAgICAgICAgIHZpcnRxdWV1ZV9ub3RpZnko
dnEpOwo+ICB9Cj4KPiAgLyoganVzdCBjcmVhdGUgZ2VtIG9iamVjdHMgZm9yIHVzZXJzcGFjZSBh
bmQgbG9uZyBsaXZlZCBvYmplY3RzLAo+IC0tCj4gMi4xOC4xCj4KX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
