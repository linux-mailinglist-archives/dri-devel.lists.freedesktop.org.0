Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 99B6F3012C8
	for <lists+dri-devel@lfdr.de>; Sat, 23 Jan 2021 04:47:08 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 890DA6EAC3;
	Sat, 23 Jan 2021 03:47:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x62a.google.com (mail-pl1-x62a.google.com
 [IPv6:2607:f8b0:4864:20::62a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 303666EAC5
 for <dri-devel@lists.freedesktop.org>; Sat, 23 Jan 2021 03:47:01 +0000 (UTC)
Received: by mail-pl1-x62a.google.com with SMTP id e9so4404807plh.3
 for <dri-devel@lists.freedesktop.org>; Fri, 22 Jan 2021 19:47:01 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=h/R7WJXx2yBQ6X+1N6Z+Yf8F4SerrZkQy0BygNc6vpE=;
 b=vpEYOxpR8Y/Oem4gX5RpQq2v98GT324JwoxUNrJx9PtgK5ZucfAWkMZnaQUNRs/nEb
 mASnX4KvGuLesOhAG8dpOYFBgOr9KQ/xjMf7kUcZ7fF0TA6wK//9QTuiz9hamom6PdUF
 XN7p5JIw/Lqu1/VMI0A59PKOPwwiie6hPblFjrvqywR0z5cK3RWjKiSWsX+b29qXAZFx
 V5f6FBI3QT1RSsQ8U++DxRDXVhYYANiWDaIAr897fVTJv+3gMPdGNda2LOloEtQsbPN9
 UdezgFSS3kaGQ/dbMPcC2ey+RnczdgFRYreLve2gbDOshI9Mu7XQ80RqByQLcXUm0ZCv
 v1ag==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=h/R7WJXx2yBQ6X+1N6Z+Yf8F4SerrZkQy0BygNc6vpE=;
 b=cCqoe//fMSHO3Jwg5vDwNNFZOmwfM4nvtHxd59Y0Ew9wRQYMuYsVWaxvoWfQ5Gltiu
 k+PjP50mMPJaCu+mUBo7yJ4dqJy5gJvs54tF7n7qT6pXU78ufU2B9yU/4xJfEabXRFAf
 YkYVkWlntsHRmlxaQlBl1aZp37LF442BbRBbEiC7W97F7ao5/OQAFou07gfAUlRPU/oC
 p/ZhZPZS6y1KWyej0uNUPTKsQHG5hq3njXDPco2gNXGt2U48hfHdaiSVVrOIc96bQt0o
 0uca+NY8oiBhl4DEQ0W95opJEqVyqnyKunVwvJ9KyVZmANokqAjjJYKiTZgv01ygKj5D
 Uc9Q==
X-Gm-Message-State: AOAM531NkoDaNfz3DQtgvNOjhucdLg7cHewexxedfg/QQh38cGDEZW5c
 K1maANqMMFIIp3frPQYDbbHCSw==
X-Google-Smtp-Source: ABdhPJzar9M76uw2JJgl51y1Mh8wsVNOiW/hoHOoNIN+8H5SVsn0OMu+AFzEWQB+IfdwIgvmGNPFvA==
X-Received: by 2002:a17:902:9b90:b029:de:76e8:ee4b with SMTP id
 y16-20020a1709029b90b02900de76e8ee4bmr7862362plp.20.1611373620760; 
 Fri, 22 Jan 2021 19:47:00 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 q24sm10316702pfs.72.2021.01.22.19.46.59
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 22 Jan 2021 19:46:59 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v2 2/3] dma-buf: system_heap: Add pagepool support to system
 heap
Date: Sat, 23 Jan 2021 03:46:54 +0000
Message-Id: <20210123034655.102813-2-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20210123034655.102813-1-john.stultz@linaro.org>
References: <20210123034655.102813-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, Sandeep Patil <sspatil@google.com>,
 Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV1c2UvYWJ1c2UgdGhlIHBhZ2Vwb29sIGNvZGUgZnJvbSB0aGUgbmV0d29yayBjb2RlIHRvIHNw
ZWVkCnVwIGFsbG9jYXRpb24gcGVyZm9ybWFuY2UuCgpUaGlzIGlzIHNpbWlsYXIgdG8gdGhlIElP
TiBwYWdlcG9vbCB1c2FnZSwgYnV0IHRyaWVzIHRvCnV0aWxpemUgZ2VuZXJpYyBjb2RlIGluc3Rl
YWQgb2YgYSBjdXN0b20gaW1wbGVtZW50YXRpb24uCgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVs
QGZmd2xsLmNoPgpDYzogU3VtaXQgU2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6
IExpYW0gTWFyayA8bG1hcmtAY29kZWF1cm9yYS5vcmc+CkNjOiBDaHJpcyBHb2xkc3dvcnRoeSA8
Y2dvbGRzd29AY29kZWF1cm9yYS5vcmc+CkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAa2VybmVs
Lm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJrZXlAYXJtLmNvbT4KQ2M6IEhyaWR5
YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogU3VyZW4gQmFnaGRhc2FyeWFuIDxz
dXJlbmJAZ29vZ2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwgPHNzcGF0aWxAZ29vZ2xlLmNvbT4K
Q2M6IERhbmllbCBNZW50eiA8ZGFuaWVsbWVudHpAZ29vZ2xlLmNvbT4KQ2M6IMOYcmphbiBFaWRl
IDxvcmphbi5laWRlQGFybS5jb20+CkNjOiBSb2JpbiBNdXJwaHkgPHJvYmluLm11cnBoeUBhcm0u
Y29tPgpDYzogRXplcXVpZWwgR2FyY2lhIDxlemVxdWllbEBjb2xsYWJvcmEuY29tPgpDYzogU2lt
b24gU2VyIDxjb250YWN0QGVtZXJzaW9uLmZyPgpDYzogSmFtZXMgSm9uZXMgPGpham9uZXNAbnZp
ZGlhLmNvbT4KQ2M6IGxpbnV4LW1lZGlhQHZnZXIua2VybmVsLm9yZwpDYzogZHJpLWRldmVsQGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVs
dHpAbGluYXJvLm9yZz4KLS0tCnYyOgoqIEZpeCBidWlsZCBpc3N1ZSBjYXVzZWQgYnkgc2VsZWN0
aW5nIFBBR0VfUE9PTCB3L28gTkVUCiAgYXMgUmVwb3J0ZWQtYnk6IGtlcm5lbCB0ZXN0IHJvYm90
IDxsa3BAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnICAgICAg
IHwgIDIgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMgfCA2OCArKysrKysr
KysrKysrKysrKysrKysrKysrKystLQogMiBmaWxlcyBjaGFuZ2VkLCA2NiBpbnNlcnRpb25zKCsp
LCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29u
ZmlnIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKaW5kZXggZWNmNjUyMDRmNzE0Li43
NDhlODQwZTZlZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCisr
KyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCkBAIC00LDYgKzQsOCBAQCBjb25maWcg
RE1BQlVGX0hFQVBTX0RFRkVSUkVEX0ZSRUUKIGNvbmZpZyBETUFCVUZfSEVBUFNfU1lTVEVNCiAJ
Ym9vbCAiRE1BLUJVRiBTeXN0ZW0gSGVhcCIKIAlkZXBlbmRzIG9uIERNQUJVRl9IRUFQUworCXNl
bGVjdCBORVQKKwlzZWxlY3QgUEFHRV9QT09MCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9u
IHRvIGVuYWJsZSB0aGUgc3lzdGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhlYXAKIAkgIGlz
IGJhY2tlZCBieSBwYWdlcyBmcm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGluIGRvdWJ0LCBz
YXkgWS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jIGIv
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKaW5kZXggMTdlMGU5YTY4YmFmLi44
ODVlMzA4OTRiNzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVh
cC5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCkBAIC0yMCw2ICsy
MCw3IEBACiAjaW5jbHVkZSA8bGludXgvc2NhdHRlcmxpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9z
bGFiLmg+CiAjaW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgorI2luY2x1ZGUgPG5ldC9wYWdlX3Bv
b2wuaD4KIAogc3RhdGljIHN0cnVjdCBkbWFfaGVhcCAqc3lzX2hlYXA7CiAKQEAgLTUzLDYgKzU0
LDcgQEAgc3RhdGljIGdmcF90IG9yZGVyX2ZsYWdzW10gPSB7SElHSF9PUkRFUl9HRlAsIExPV19P
UkRFUl9HRlAsIExPV19PUkRFUl9HRlB9OwogICovCiBzdGF0aWMgY29uc3QgdW5zaWduZWQgaW50
IG9yZGVyc1tdID0gezgsIDQsIDB9OwogI2RlZmluZSBOVU1fT1JERVJTIEFSUkFZX1NJWkUob3Jk
ZXJzKQorc3RydWN0IHBhZ2VfcG9vbCAqcG9vbHNbTlVNX09SREVSU107CiAKIHN0YXRpYyBzdHJ1
Y3Qgc2dfdGFibGUgKmR1cF9zZ190YWJsZShzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlKQogewpAQCAt
MjgxLDE4ICsyODMsNTkgQEAgc3RhdGljIHZvaWQgc3lzdGVtX2hlYXBfdnVubWFwKHN0cnVjdCBk
bWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQogCWRtYV9idWZfbWFwX2Ns
ZWFyKG1hcCk7CiB9CiAKK3N0YXRpYyBpbnQgc3lzdGVtX2hlYXBfY2xlYXJfcGFnZXMoc3RydWN0
IHBhZ2UgKipwYWdlcywgaW50IG51bSwgcGdwcm90X3QgcGdwcm90KQoreworCXZvaWQgKmFkZHIg
PSB2bWFwKHBhZ2VzLCBudW0sIFZNX01BUCwgcGdwcm90KTsKKworCWlmICghYWRkcikKKwkJcmV0
dXJuIC1FTk9NRU07CisJbWVtc2V0KGFkZHIsIDAsIFBBR0VfU0laRSAqIG51bSk7CisJdnVubWFw
KGFkZHIpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHN5c3RlbV9oZWFwX3plcm9fYnVm
ZmVyKHN0cnVjdCBzeXN0ZW1faGVhcF9idWZmZXIgKmJ1ZmZlcikKK3sKKwlzdHJ1Y3Qgc2dfdGFi
bGUgKnNndCA9ICZidWZmZXItPnNnX3RhYmxlOworCXN0cnVjdCBzZ19wYWdlX2l0ZXIgcGl0ZXI7
CisJc3RydWN0IHBhZ2UgKnBhZ2VzWzMyXTsKKwlpbnQgcCA9IDA7CisJaW50IHJldCA9IDA7CisK
Kwlmb3JfZWFjaF9zZ3RhYmxlX3BhZ2Uoc2d0LCAmcGl0ZXIsIDApIHsKKwkJcGFnZXNbcCsrXSA9
IHNnX3BhZ2VfaXRlcl9wYWdlKCZwaXRlcik7CisJCWlmIChwID09IEFSUkFZX1NJWkUocGFnZXMp
KSB7CisJCQlyZXQgPSBzeXN0ZW1faGVhcF9jbGVhcl9wYWdlcyhwYWdlcywgcCwgUEFHRV9LRVJO
RUwpOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCQkJcCA9IDA7CisJCX0KKwl9CisJ
aWYgKHApCisJCXJldCA9IHN5c3RlbV9oZWFwX2NsZWFyX3BhZ2VzKHBhZ2VzLCBwLCBQQUdFX0tF
Uk5FTCk7CisKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdm9pZCBzeXN0ZW1faGVhcF9kbWFf
YnVmX3JlbGVhc2Uoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKIHsKIAlzdHJ1Y3Qgc3lzdGVtX2hl
YXBfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CiAJc3RydWN0IHNnX3RhYmxlICp0YWJs
ZTsKIAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCWludCBpOworCWludCBpLCBqOworCisJLyog
WmVybyB0aGUgYnVmZmVyIHBhZ2VzIGJlZm9yZSBhZGRpbmcgYmFjayB0byB0aGUgcG9vbCAqLwor
CXN5c3RlbV9oZWFwX3plcm9fYnVmZmVyKGJ1ZmZlcik7CiAKIAl0YWJsZSA9ICZidWZmZXItPnNn
X3RhYmxlOwogCWZvcl9lYWNoX3NnKHRhYmxlLT5zZ2wsIHNnLCB0YWJsZS0+bmVudHMsIGkpIHsK
IAkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBzZ19wYWdlKHNnKTsKIAotCQlfX2ZyZWVfcGFnZXMocGFn
ZSwgY29tcG91bmRfb3JkZXIocGFnZSkpOworCQlmb3IgKGogPSAwOyBqIDwgTlVNX09SREVSUzsg
aisrKSB7CisJCQlpZiAoY29tcG91bmRfb3JkZXIocGFnZSkgPT0gb3JkZXJzW2pdKQorCQkJCWJy
ZWFrOworCQl9CisJCXBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdlKHBvb2xzW2pdLCBwYWdlLCBmYWxz
ZSk7CiAJfQogCXNnX2ZyZWVfdGFibGUodGFibGUpOwogCWtmcmVlKGJ1ZmZlcik7CkBAIC0zMjIs
OCArMzY1LDcgQEAgc3RhdGljIHN0cnVjdCBwYWdlICphbGxvY19sYXJnZXN0X2F2YWlsYWJsZSh1
bnNpZ25lZCBsb25nIHNpemUsCiAJCQljb250aW51ZTsKIAkJaWYgKG1heF9vcmRlciA8IG9yZGVy
c1tpXSkKIAkJCWNvbnRpbnVlOwotCi0JCXBhZ2UgPSBhbGxvY19wYWdlcyhvcmRlcl9mbGFnc1tp
XSwgb3JkZXJzW2ldKTsKKwkJcGFnZSA9IHBhZ2VfcG9vbF9hbGxvY19wYWdlcyhwb29sc1tpXSwg
b3JkZXJfZmxhZ3NbaV0pOwogCQlpZiAoIXBhZ2UpCiAJCQljb250aW51ZTsKIAkJcmV0dXJuIHBh
Z2U7CkBAIC00MjgsNiArNDcwLDI0IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2hlYXBfb3Bz
IHN5c3RlbV9oZWFwX29wcyA9IHsKIHN0YXRpYyBpbnQgc3lzdGVtX2hlYXBfY3JlYXRlKHZvaWQp
CiB7CiAJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCWludCBpOworCisJ
Zm9yIChpID0gMDsgaSA8IE5VTV9PUkRFUlM7IGkrKykgeworCQlzdHJ1Y3QgcGFnZV9wb29sX3Bh
cmFtcyBwcDsKKworCQltZW1zZXQoJnBwLCAwLCBzaXplb2YocHApKTsKKwkJcHAub3JkZXIgPSBv
cmRlcnNbaV07CisJCXBvb2xzW2ldID0gcGFnZV9wb29sX2NyZWF0ZSgmcHApOworCisJCWlmIChJ
U19FUlIocG9vbHNbaV0pKSB7CisJCQlpbnQgajsKKworCQkJcHJfZXJyKCIlczogcGFnZSBwb29s
IGNyZWF0aW9uIGZhaWxlZCFcbiIsIF9fZnVuY19fKTsKKwkJCWZvciAoaiA9IDA7IGogPCBpOyBq
KyspCisJCQkJcGFnZV9wb29sX2Rlc3Ryb3kocG9vbHNbal0pOworCQkJcmV0dXJuIFBUUl9FUlIo
cG9vbHNbaV0pOworCQl9CisJfQogCiAJZXhwX2luZm8ubmFtZSA9ICJzeXN0ZW0iOwogCWV4cF9p
bmZvLm9wcyA9ICZzeXN0ZW1faGVhcF9vcHM7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
