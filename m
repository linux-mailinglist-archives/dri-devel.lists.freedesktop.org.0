Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 44C97115099
	for <lists+dri-devel@lfdr.de>; Fri,  6 Dec 2019 13:47:32 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8C45C6F9F4;
	Fri,  6 Dec 2019 12:47:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D254A6FA02
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Dec 2019 12:47:18 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 53CEBB3F9;
 Fri,  6 Dec 2019 12:47:17 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, sam@ravnborg.org, kraxel@redhat.com,
 emil.velikov@collabora.com, noralf@tronnes.org, zboszor@pr.hu
Subject: [PATCH v2 4/9] drm/udl: Inline DPMS code into CRTC enable and disable
 functions
Date: Fri,  6 Dec 2019 13:47:08 +0100
Message-Id: <20191206124713.5748-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191206124713.5748-1-tzimmermann@suse.de>
References: <20191206124713.5748-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFBNUyBmdW5jdGlvbmFsaXR5IGlzIG9ubHkgdXNlZCBieSB0aGUgQ1JUQydzIGVuYWJsZSBhbmQg
ZGlzYWJsZQpmdW5jdGlvbnMuIElubGluZSB0aGUgY29kZS4KClNpZ25lZC1vZmYtYnk6IFRob21h
cyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS91
ZGwvdWRsX21vZGVzZXQuYyB8IDg0ICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCAzMCBpbnNlcnRpb25zKCspLCA1NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9tb2Rlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
dWRsL3VkbF9tb2Rlc2V0LmMKaW5kZXggNzI4ODRjYmRhMTMxLi40NjgxNDQ2YzIzMjMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX21vZGVzZXQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vdWRsL3VkbF9tb2Rlc2V0LmMKQEAgLTQ4LDI1ICs0OCw5IEBAIHN0YXRpYyBjaGFyICp1
ZGxfdmlkcmVnX3VubG9jayhjaGFyICpidWYpCiAgKiAgMHgwMSBIIGFuZCBWIHN5bmMgb2ZmIChz
Y3JlZW4gYmxhbmsgYnV0IHBvd2VyZWQpCiAgKiAgMHgwNyBEUE1TIHBvd2VyZG93biAocmVxdWly
ZXMgbW9kZXNldCB0byBjb21lIGJhY2spCiAgKi8KLXN0YXRpYyBjaGFyICp1ZGxfc2V0X2JsYW5r
KGNoYXIgKmJ1ZiwgaW50IGRwbXNfbW9kZSkKK3N0YXRpYyBjaGFyICp1ZGxfc2V0X2JsYW5rX21v
ZGUoY2hhciAqYnVmLCB1OCBtb2RlKQogewotCXU4IHJlZzsKLQlzd2l0Y2ggKGRwbXNfbW9kZSkg
ewotCWNhc2UgRFJNX01PREVfRFBNU19PRkY6Ci0JCXJlZyA9IDB4MDc7Ci0JCWJyZWFrOwotCWNh
c2UgRFJNX01PREVfRFBNU19TVEFOREJZOgotCQlyZWcgPSAweDA1OwotCQlicmVhazsKLQljYXNl
IERSTV9NT0RFX0RQTVNfU1VTUEVORDoKLQkJcmVnID0gMHgwMTsKLQkJYnJlYWs7Ci0JY2FzZSBE
Uk1fTU9ERV9EUE1TX09OOgotCQlyZWcgPSAweDAwOwotCQlicmVhazsKLQl9Ci0KLQlyZXR1cm4g
dWRsX3NldF9yZWdpc3RlcihidWYsIDB4MWYsIHJlZyk7CisJcmV0dXJuIHVkbF9zZXRfcmVnaXN0
ZXIoYnVmLCAweDFmLCBtb2RlKTsKIH0KIAogc3RhdGljIGNoYXIgKnVkbF9zZXRfY29sb3JfZGVw
dGgoY2hhciAqYnVmLCB1OCBzZWxlY3Rpb24pCkBAIC0yMzcsNiArMjIxLDExIEBAIHN0YXRpYyBp
bnQgdWRsX2NydGNfd3JpdGVfbW9kZV90b19odyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiAJY2hh
ciAqYnVmOwogCWludCByZXR2YWw7CiAKKwlpZiAodWRsLT5tb2RlX2J1Zl9sZW4gPT0gMCkgewor
CQlEUk1fRVJST1IoIk5vIG1vZGUgc2V0XG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCiAJ
dXJiID0gdWRsX2dldF91cmIoZGV2KTsKIAlpZiAoIXVyYikKIAkJcmV0dXJuIC1FTk9NRU07CkBA
IC0yNDksMzggKzIzOCw2IEBAIHN0YXRpYyBpbnQgdWRsX2NydGNfd3JpdGVfbW9kZV90b19odyhz
dHJ1Y3QgZHJtX2NydGMgKmNydGMpCiAJcmV0dXJuIHJldHZhbDsKIH0KIAotCi1zdGF0aWMgdm9p
ZCB1ZGxfY3J0Y19kcG1zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgaW50IG1vZGUpCi17Ci0Jc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKLQlzdHJ1Y3QgdWRsX2RldmljZSAqdWRs
ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQlpbnQgcmV0dmFsOwotCi0JaWYgKG1vZGUgPT0gRFJNX01P
REVfRFBNU19PRkYpIHsKLQkJY2hhciAqYnVmOwotCQlzdHJ1Y3QgdXJiICp1cmI7Ci0JCXVyYiA9
IHVkbF9nZXRfdXJiKGRldik7Ci0JCWlmICghdXJiKQotCQkJcmV0dXJuOwotCi0JCWJ1ZiA9IChj
aGFyICopdXJiLT50cmFuc2Zlcl9idWZmZXI7Ci0JCWJ1ZiA9IHVkbF92aWRyZWdfbG9jayhidWYp
OwotCQlidWYgPSB1ZGxfc2V0X2JsYW5rKGJ1ZiwgbW9kZSk7Ci0JCWJ1ZiA9IHVkbF92aWRyZWdf
dW5sb2NrKGJ1Zik7Ci0KLQkJYnVmID0gdWRsX2R1bW15X3JlbmRlcihidWYpOwotCQlyZXR2YWwg
PSB1ZGxfc3VibWl0X3VyYihkZXYsIHVyYiwgYnVmIC0gKGNoYXIgKikKLQkJCQkJdXJiLT50cmFu
c2Zlcl9idWZmZXIpOwotCX0gZWxzZSB7Ci0JCWlmICh1ZGwtPm1vZGVfYnVmX2xlbiA9PSAwKSB7
Ci0JCQlEUk1fRVJST1IoIlRyeWluZyB0byBlbmFibGUgRFBNUyB3aXRoIG5vIG1vZGVcbiIpOwot
CQkJcmV0dXJuOwotCQl9Ci0JCXVkbF9jcnRjX3dyaXRlX21vZGVfdG9faHcoY3J0Yyk7Ci0JfQot
Ci19Ci0KIC8qCiAgKiBTaW1wbGUgZGlzcGxheSBwaXBlbGluZQogICovCkBAIC0zMTEsNiArMjY4
LDggQEAgdWRsX3NpbXBsZV9kaXNwbGF5X3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rp
c3BsYXlfcGlwZSAqcGlwZSwKIAljaGFyICp3cnB0cjsKIAlpbnQgY29sb3JfZGVwdGggPSBVRExf
Q09MT1JfREVQVEhfMTZCUFA7CiAKKwljcnRjX3N0YXRlLT5ub192YmxhbmsgPSB0cnVlOworCiAJ
dWRsLT5jcnRjID0gY3J0YzsKIAogCWJ1ZiA9IChjaGFyICopdWRsLT5tb2RlX2J1ZjsKQEAgLTMy
Nyw3ICsyODYsNyBAQCB1ZGxfc2ltcGxlX2Rpc3BsYXlfcGlwZV9lbmFibGUoc3RydWN0IGRybV9z
aW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCXdycHRyID0gdWRsX3NldF9iYXNlOGJwcCh3cnB0
ciwgMiAqIG1vZGUtPnZkaXNwbGF5ICogbW9kZS0+aGRpc3BsYXkpOwogCiAJd3JwdHIgPSB1ZGxf
c2V0X3ZpZF9jbWRzKHdycHRyLCBtb2RlKTsKLQl3cnB0ciA9IHVkbF9zZXRfYmxhbmsod3JwdHIs
IERSTV9NT0RFX0RQTVNfT04pOworCXdycHRyID0gdWRsX3NldF9ibGFua19tb2RlKHdycHRyLCAw
eDAwKTsKIAl3cnB0ciA9IHVkbF92aWRyZWdfdW5sb2NrKHdycHRyKTsKIAogCXdycHRyID0gdWRs
X2R1bW15X3JlbmRlcih3cnB0cik7CkBAIC0zMzksMTUgKzI5OCwzMiBAQCB1ZGxfc2ltcGxlX2Rp
c3BsYXlfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAog
CiAJdWRsX2hhbmRsZV9kYW1hZ2UoZmIsIDAsIDAsIGZiLT53aWR0aCwgZmItPmhlaWdodCk7CiAK
LQl1ZGxfY3J0Y19kcG1zKCZwaXBlLT5jcnRjLCBEUk1fTU9ERV9EUE1TX09OKTsKKwlpZiAoIWNy
dGNfc3RhdGUtPm1vZGVfY2hhbmdlZCkKKwkJcmV0dXJuOwogCi0JY3J0Y19zdGF0ZS0+bm9fdmJs
YW5rID0gdHJ1ZTsKKwkvKiBlbmFibGUgZGlzcGxheSAqLworCXVkbF9jcnRjX3dyaXRlX21vZGVf
dG9faHcoY3J0Yyk7CiB9CiAKIHN0YXRpYyB2b2lkCiB1ZGxfc2ltcGxlX2Rpc3BsYXlfcGlwZV9k
aXNhYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSkKIHsKLQl1ZGxfY3J0
Y19kcG1zKCZwaXBlLT5jcnRjLCBEUk1fTU9ERV9EUE1TX09GRik7CisJc3RydWN0IGRybV9jcnRj
ICpjcnRjPSAmcGlwZS0+Y3J0YzsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2
OworCXN0cnVjdCB1cmIgKnVyYjsKKwljaGFyICpidWY7CisKKwl1cmIgPSB1ZGxfZ2V0X3VyYihk
ZXYpOworCWlmICghdXJiKQorCQlyZXR1cm47CisKKwlidWYgPSAoY2hhciAqKXVyYi0+dHJhbnNm
ZXJfYnVmZmVyOworCWJ1ZiA9IHVkbF92aWRyZWdfbG9jayhidWYpOworCWJ1ZiA9IHVkbF9zZXRf
YmxhbmtfbW9kZShidWYsIDB4MDcpOworCWJ1ZiA9IHVkbF92aWRyZWdfdW5sb2NrKGJ1Zik7CisJ
YnVmID0gdWRsX2R1bW15X3JlbmRlcihidWYpOworCisJdWRsX3N1Ym1pdF91cmIoZGV2LCB1cmIs
IGJ1ZiAtIChjaGFyICopdXJiLT50cmFuc2Zlcl9idWZmZXIpOwogfQogCiBzdGF0aWMgaW50Ci0t
IAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
