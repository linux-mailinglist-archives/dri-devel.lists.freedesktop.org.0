Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3FCB03D1D7
	for <lists+dri-devel@lfdr.de>; Tue, 11 Jun 2019 18:10:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 15DBD89228;
	Tue, 11 Jun 2019 16:10:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BD05F89258
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 16:10:16 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id j19so15164300qtr.12
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 09:10:16 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=IcjTX53+88NTX1Of/etOSSbzEJ34gjPlAbSUER4je44=;
 b=CgWJtqvNaglGyDs4HbrGYjl36wzrP8YJBgZCWzjUCQyScXM7gy4IBxVBYCTfuNhaVe
 AMs0L0taf86A+WC/fckoa6LCZnHOCEdKlHtke306Hqo3KVB6Lj5Jl6azTqdb/VDgUnh0
 JWyHp0+8mwybocYuZI5aaKnjNin6DoG/luLqpb3axbwoditPI7dHz1PXm9habCRQjU/7
 H00fGQGS4dw0lOk8umsFkaq07sASRPcrRCpAbIpSGhe1hNNAlrMIWCQZjaQ+eEmUWbJY
 F9QrkWYSjgUXM1ZIwN83ioO8MBQ856xjzxkMVTDZiisAT2hftFRPAlTANdRLUoLRw1qF
 jBTw==
X-Gm-Message-State: APjAAAXjcgcB3/KG0tvx7PnWUDXF7n8bOjpErQaJt39HQZbtfNjbG0XF
 lXHYyt5rjg2Jv0EGQTgxD09jNXRcP2M=
X-Google-Smtp-Source: APXvYqx09hVB1nYJWQKeg12JwC5uaUX0eTzaRJzjjifsmwFiNPFxvEowV1lJZVaQrDMIvoj+O9473g==
X-Received: by 2002:a0c:a944:: with SMTP id z4mr4223419qva.92.1560269415817;
 Tue, 11 Jun 2019 09:10:15 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id d188sm6755094qkf.40.2019.06.11.09.10.14
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Tue, 11 Jun 2019 09:10:15 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 10/11] drm/rockchip: Don't fully disable vop on self refresh
Date: Tue, 11 Jun 2019 12:08:24 -0400
Message-Id: <20190611160844.257498-11-sean@poorly.run>
X-Mailer: git-send-email 2.22.0.rc2.383.gf4fbbf30c2-goog
In-Reply-To: <20190611160844.257498-1-sean@poorly.run>
References: <20190611160844.257498-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=IcjTX53+88NTX1Of/etOSSbzEJ34gjPlAbSUER4je44=;
 b=E+4k4cMWZkWG3av7jzrtIC9XVpdI/5VCrQzYYUUZFaOv2aA3XbVLpBeS+QGwXUbCao
 Wu1lYE+AcPx4r1athjoPTa0VkbjMv1I75A0myQmIrmyzt/PerOUYf54wJa5QqW7TZT0u
 YRgKvLmepV5WbwGH7f4/weRTTdKa02paJu0yqYtx51vH2SggV3bih5EGwPcs1NzELLkT
 zVvf9wsOLu1qdL0JchKYM5IzAmm8GZPQ2t5NdtyM8O6deLWCveyN+Ls/XaQvMvyXA92Z
 Fa0RvSCgi4j2oF2vjGo9JaQstGXqpfrjqhzi8SFBmUEIibjzNqBHRtlm+ClCLvMeh8mG
 ggkA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Zain Wang <wzz@rock-chips.com>, David Airlie <airlied@linux.ie>,
 Tomasz Figa <tfiga@chromium.org>, linux-rockchip@lists.infradead.org,
 Sean Paul <seanpaul@chromium.org>,
 "Kristian H . Kristensen" <hoegsberg@chromium.org>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpJbnN0ZWFkIG9mIGZ1bGx5
IGRpc2FibGluZyBhbmQgcmUtZW5hYmxpbmcgdGhlIHZvcCBvbiBzZWxmIHJlZnJlc2gKdHJhbnNp
dGlvbnMsIG9ubHkgZGlzYWJsZSB0aGUgYWN0aXZlIHdpbmRvd3MuIFRoaXMgd2lsbCBzcGVlZCB1
cApzZWxmIHJlZnJlc2ggZXhpdHMgc3Vic3RhbnRpYWxseSBhbmQgaXMgc3RpbGwgYSBwb3dlci1z
YXZpbmdzIHdpbi4KClRoaXMgcGF0Y2ggaW50ZWdyYXRlcyBwb3J0aW9ucyBvZiBaYWluJ3MgcGF0
Y2ggZnJvbSBoZXJlOgpodHRwczovL3BhdGNod29yay5rZXJuZWwub3JnL3BhdGNoLzk2MTUwNjMv
CgpDaGFuZ2VzIGluIHYyOgotIE5vbmUKQ2hhbmdlcyBpbiB2MzoKLSBOb25lCkNoYW5nZXMgaW4g
djQ6Ci0gQWRqdXN0IGZvciBwcmVjZWRpbmcgdm9wX3dpbl9kaXNhYmxlIGNoYW5nZXMKQ2hhbmdl
cyBpbiB2NToKLSBOb25lCgpMaW5rIHRvIHYxOiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3Rv
cC5vcmcvcGF0Y2gvbXNnaWQvMjAxOTAyMjgyMTA5MzkuODMzODYtNS1zZWFuQHBvb3JseS5ydW4K
TGluayB0byB2MjogaHR0cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lk
LzIwMTkwMzI2MjA0NTA5Ljk2NTE1LTQtc2VhbkBwb29ybHkucnVuCkxpbmsgdG8gdjM6IGh0dHBz
Oi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MDUwMjE5NDk1Ni4y
MTg0NDEtMTAtc2VhbkBwb29ybHkucnVuCkxpbmsgdG8gdjQ6IGh0dHBzOi8vcGF0Y2h3b3JrLmZy
ZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MDUwODE2MDkyMC4xNDQ3MzktMTEtc2VhbkBw
b29ybHkucnVuCgpDYzogWmFpbiBXYW5nIDx3enpAcm9jay1jaGlwcy5jb20+CkNjOiBUb21hc3og
RmlnYSA8dGZpZ2FAY2hyb21pdW0ub3JnPgpDYzogS3Jpc3RpYW4gSC4gS3Jpc3RlbnNlbiA8aG9l
Z3NiZXJnQGNocm9taXVtLm9yZz4KVGVzdGVkLWJ5OiBIZWlrbyBTdHVlYm5lciA8aGVpa29Ac250
ZWNoLmRlPgpTaWduZWQtb2ZmLWJ5OiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jIHwgNDEgKysr
KysrKysrKysrKysrKysrLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzYgaW5zZXJ0aW9ucygrKSwgNSBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9ja2No
aXBfZHJtX3ZvcC5jIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3Au
YwppbmRleCA4M2M2ODg0ZjU1OGQ1Li4xMmNhNjcyODQ4MTFlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcm9ja2NoaXAvcm9ja2NoaXBfZHJtX3ZvcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMKQEAgLTEzNCw2ICsxMzQsNyBAQCBzdHJ1Y3Qg
dm9wIHsKIAlib29sIGlzX2VuYWJsZWQ7CiAKIAlzdHJ1Y3QgY29tcGxldGlvbiBkc3BfaG9sZF9j
b21wbGV0aW9uOworCXVuc2lnbmVkIGludCB3aW5fZW5hYmxlZDsKIAogCS8qIHByb3RlY3RlZCBi
eSBkZXYtPmV2ZW50X2xvY2sgKi8KIAlzdHJ1Y3QgZHJtX3BlbmRpbmdfdmJsYW5rX2V2ZW50ICpl
dmVudDsKQEAgLTU1MCw2ICs1NTEsNyBAQCBzdGF0aWMgdm9pZCB2b3Bfd2luX2Rpc2FibGUoc3Ry
dWN0IHZvcCAqdm9wLCBjb25zdCBzdHJ1Y3Qgdm9wX3dpbiAqdm9wX3dpbikKIAl9CiAKIAlWT1Bf
V0lOX1NFVCh2b3AsIHdpbiwgZW5hYmxlLCAwKTsKKwl2b3AtPndpbl9lbmFibGVkICY9IH5CSVQo
Vk9QX1dJTl9UT19JTkRFWCh2b3Bfd2luKSk7CiB9CiAKIHN0YXRpYyBpbnQgdm9wX2VuYWJsZShz
dHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlKQpA
QCAtNjMyLDYgKzYzNCwyNSBAQCBzdGF0aWMgaW50IHZvcF9lbmFibGUoc3RydWN0IGRybV9jcnRj
ICpjcnRjLCBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9zdGF0ZSkKIAlyZXR1cm4gcmV0Owog
fQogCitzdGF0aWMgdm9pZCByb2NrY2hpcF9kcm1fc2V0X3dpbl9lbmFibGVkKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywgYm9vbCBlbmFibGVkKQoreworICAgICAgICBzdHJ1Y3Qgdm9wICp2b3AgPSB0
b192b3AoY3J0Yyk7CisgICAgICAgIGludCBpOworCisgICAgICAgIHNwaW5fbG9jaygmdm9wLT5y
ZWdfbG9jayk7CisKKyAgICAgICAgZm9yIChpID0gMDsgaSA8IHZvcC0+ZGF0YS0+d2luX3NpemU7
IGkrKykgeworICAgICAgICAgICAgICAgIHN0cnVjdCB2b3Bfd2luICp2b3Bfd2luID0gJnZvcC0+
d2luW2ldOworICAgICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCB2b3Bfd2luX2RhdGEgKndpbiA9
IHZvcF93aW4tPmRhdGE7CisKKyAgICAgICAgICAgICAgICBWT1BfV0lOX1NFVCh2b3AsIHdpbiwg
ZW5hYmxlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZWQgJiYgKHZvcC0+d2lu
X2VuYWJsZWQgJiBCSVQoaSkpKTsKKyAgICAgICAgfQorICAgICAgICB2b3BfY2ZnX2RvbmUodm9w
KTsKKworICAgICAgICBzcGluX3VubG9jaygmdm9wLT5yZWdfbG9jayk7Cit9CisKIHN0YXRpYyB2
b2lkIHZvcF9jcnRjX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkg
ICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3RhdGUpCiB7CkBAIC02MzksMTUgKzY2MCwx
NiBAQCBzdGF0aWMgdm9pZCB2b3BfY3J0Y19hdG9taWNfZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCiAKIAlXQVJOX09OKHZvcC0+ZXZlbnQpOwogCi0JbXV0ZXhfbG9jaygmdm9wLT52b3Bf
bG9jayk7CisJaWYgKGNydGMtPnN0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQlyb2NrY2hp
cF9kcm1fc2V0X3dpbl9lbmFibGVkKGNydGMsIGZhbHNlKTsKIAotCWlmICghdm9wLT5pc19lbmFi
bGVkKSB7Ci0JCW11dGV4X3VubG9jaygmdm9wLT52b3BfbG9jayk7Ci0JCXJldHVybjsKLQl9CisJ
bXV0ZXhfbG9jaygmdm9wLT52b3BfbG9jayk7CiAKIAlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMp
OwogCisJaWYgKGNydGMtPnN0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQlnb3RvIG91dDsK
KwogCS8qCiAJICogVm9wIHN0YW5kYnkgd2lsbCB0YWtlIGVmZmVjdCBhdCBlbmQgb2YgY3VycmVu
dCBmcmFtZSwKIAkgKiBpZiBkc3AgaG9sZCB2YWxpZCBpcnEgaGFwcGVuLCBpdCBtZWFucyBzdGFu
ZGJ5IGNvbXBsZXRlLgpAQCAtNjc4LDYgKzcwMCw4IEBAIHN0YXRpYyB2b2lkIHZvcF9jcnRjX2F0
b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAljbGtfZGlzYWJsZSh2b3AtPmRj
bGspOwogCXZvcF9jb3JlX2Nsa3NfZGlzYWJsZSh2b3ApOwogCXBtX3J1bnRpbWVfcHV0KHZvcC0+
ZGV2KTsKKworb3V0OgogCW11dGV4X3VubG9jaygmdm9wLT52b3BfbG9jayk7CiAKIAlpZiAoY3J0
Yy0+c3RhdGUtPmV2ZW50ICYmICFjcnRjLT5zdGF0ZS0+YWN0aXZlKSB7CkBAIC04OTUsNiArOTE5
LDcgQEAgc3RhdGljIHZvaWQgdm9wX3BsYW5lX2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFu
ZSAqcGxhbmUsCiAJfQogCiAJVk9QX1dJTl9TRVQodm9wLCB3aW4sIGVuYWJsZSwgMSk7CisJdm9w
LT53aW5fZW5hYmxlZCB8PSBCSVQod2luX2luZGV4KTsKIAlzcGluX3VubG9jaygmdm9wLT5yZWdf
bG9jayk7CiB9CiAKQEAgLTEwNTEsNiArMTA3NiwxMiBAQCBzdGF0aWMgdm9pZCB2b3BfY3J0Y19h
dG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAlpbnQgZGl0aGVyX2JwYyA9IHMt
Pm91dHB1dF9icGMgPyBzLT5vdXRwdXRfYnBjIDogMTA7CiAJaW50IHJldDsKIAorCWlmIChvbGRf
c3RhdGUgJiYgb2xkX3N0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKSB7CisJCWRybV9jcnRjX3Zi
bGFua19vbihjcnRjKTsKKwkJcm9ja2NoaXBfZHJtX3NldF93aW5fZW5hYmxlZChjcnRjLCB0cnVl
KTsKKwkJcmV0dXJuOworCX0KKwogCW11dGV4X2xvY2soJnZvcC0+dm9wX2xvY2spOwogCiAJV0FS
Tl9PTih2b3AtPmV2ZW50KTsKLS0gClNlYW4gUGF1bCwgU29mdHdhcmUgRW5naW5lZXIsIEdvb2ds
ZSAvIENocm9taXVtIE9TCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
