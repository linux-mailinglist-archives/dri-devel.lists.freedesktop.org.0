Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BCA98793E
	for <lists+dri-devel@lfdr.de>; Fri,  9 Aug 2019 14:04:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 916FB6EDE7;
	Fri,  9 Aug 2019 12:04:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from metis.ext.pengutronix.de (metis.ext.pengutronix.de
 [IPv6:2001:67c:670:201:290:27ff:fe1d:cc33])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 659756EDD7
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 12:04:04 +0000 (UTC)
Received: from dude02.hi.pengutronix.de ([2001:67c:670:100:1d::28]
 helo=dude02.pengutronix.de.)
 by metis.ext.pengutronix.de with esmtp (Exim 4.92)
 (envelope-from <l.stach@pengutronix.de>)
 id 1hw3cm-00050R-Ml; Fri, 09 Aug 2019 14:04:00 +0200
From: Lucas Stach <l.stach@pengutronix.de>
To: etnaviv@lists.freedesktop.org
Subject: [PATCH v2 1/2] drm/etnaviv: dump only failing submit
Date: Fri,  9 Aug 2019 14:03:58 +0200
Message-Id: <20190809120359.31659-1-l.stach@pengutronix.de>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::28
X-SA-Exim-Mail-From: l.stach@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de);
 SAEximRunCond expanded to false
X-PTX-Original-Recipient: dri-devel@lists.freedesktop.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: patchwork-lst@pengutronix.de, kernel@pengutronix.de,
 dri-devel@lists.freedesktop.org, Russell King <linux+etnaviv@armlinux.org.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHVlIHRvIHRoZSB0cmFja2luZyBwcm92aWRlZCBieSB0aGUgc2NoZWR1bGVyIHdlIGtub3cgZXhh
Y3RseSB3aGljaApzdWJtaXQgaXMgZmFpbGluZy4gT25seSBkdW1wIHRoaXMgc2luZ2xlIHN1Ym1p
dCBhbmQgdGhlIHJlcXVpcmVkCmF1eGlsaWFyeSBpbmZvcm1hdGlvbi4gVGhpcyBjdXRzIGRvd24g
dGhlIHNpemUgb2YgdGhlIGRldmNvcmVkdW1wcwpieSBvbmx5IGluY2x1ZGluZyByZWxldmFudCBp
bmZvcm1hdGlvbi4KClNpZ25lZC1vZmYtYnk6IEx1Y2FzIFN0YWNoIDxsLnN0YWNoQHBlbmd1dHJv
bml4LmRlPgpSZXZpZXdlZC1ieTogUGhpbGlwcCBaYWJlbCA8cC56YWJlbEBwZW5ndXRyb25peC5k
ZT4KLS0tCnYyOiBkcm9wcGVkIGNoYW5nZSB0byBldG5hdml2X2NvcmVfZHVtcF9tbXUKLS0tCiBk
cml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2R1bXAuYyAgfCA0NSArKysrKysrKystLS0t
LS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X3NjaGVkLmMgfCAg
MiArLQogMiBmaWxlcyBjaGFuZ2VkLCAxNiBpbnNlcnRpb25zKCspLCAzMSBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2R1bXAuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZHVtcC5jCmluZGV4IDU1YzM3Mzc5ZTM4OS4u
Mjk5ODQ2MTkwZTRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2
X2R1bXAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2R1bXAuYwpAQCAt
MTEwLDE2ICsxMTAsMTUgQEAgc3RhdGljIHZvaWQgZXRuYXZpdl9jb3JlX2R1bXBfbWVtKHN0cnVj
dCBjb3JlX2R1bXBfaXRlcmF0b3IgKml0ZXIsIHUzMiB0eXBlLAogCWV0bmF2aXZfY29yZV9kdW1w
X2hlYWRlcihpdGVyLCB0eXBlLCBpdGVyLT5kYXRhICsgc2l6ZSk7CiB9CiAKLXZvaWQgZXRuYXZp
dl9jb3JlX2R1bXAoc3RydWN0IGV0bmF2aXZfZ3B1ICpncHUpCit2b2lkIGV0bmF2aXZfY29yZV9k
dW1wKHN0cnVjdCBldG5hdml2X2dlbV9zdWJtaXQgKnN1Ym1pdCkKIHsKKwlzdHJ1Y3QgZXRuYXZp
dl9ncHUgKmdwdSA9IHN1Ym1pdC0+Z3B1OwogCXN0cnVjdCBjb3JlX2R1bXBfaXRlcmF0b3IgaXRl
cjsKLQlzdHJ1Y3QgZXRuYXZpdl92cmFtX21hcHBpbmcgKnZyYW07CiAJc3RydWN0IGV0bmF2aXZf
Z2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBldG5hdml2X2dlbV9zdWJtaXQgKnN1Ym1pdDsKLQlz
dHJ1Y3QgZHJtX3NjaGVkX2pvYiAqc19qb2I7CiAJdW5zaWduZWQgaW50IG5fb2JqLCBuX2JvbWFw
X3BhZ2VzOwogCXNpemVfdCBmaWxlX3NpemUsIG1tdV9zaXplOwogCV9fbGU2NCAqYm9tYXAsICpi
b21hcF9zdGFydDsKKwlpbnQgaTsKIAogCS8qIE9ubHkgY2F0Y2ggdGhlIGZpcnN0IGV2ZW50LCBv
ciB3aGVuIG1hbnVhbGx5IHJlLWFybWVkICovCiAJaWYgKCFldG5hdml2X2R1bXBfY29yZSkKQEAg
LTEzMCwyNiArMTI5LDE2IEBAIHZvaWQgZXRuYXZpdl9jb3JlX2R1bXAoc3RydWN0IGV0bmF2aXZf
Z3B1ICpncHUpCiAKIAltbXVfc2l6ZSA9IGV0bmF2aXZfaW9tbXVfZHVtcF9zaXplKGdwdS0+bW11
KTsKIAotCS8qIFdlIGFsd2F5cyBkdW1wIHJlZ2lzdGVycywgbW11LCByaW5nIGFuZCBlbmQgbWFy
a2VyICovCi0Jbl9vYmogPSA0OworCS8qIFdlIGFsd2F5cyBkdW1wIHJlZ2lzdGVycywgbW11LCBy
aW5nLCBoYW5naW5nIGNtZGJ1ZiBhbmQgZW5kIG1hcmtlciAqLworCW5fb2JqID0gNTsKIAluX2Jv
bWFwX3BhZ2VzID0gMDsKIAlmaWxlX3NpemUgPSBBUlJBWV9TSVpFKGV0bmF2aXZfZHVtcF9yZWdp
c3RlcnMpICoKIAkJCXNpemVvZihzdHJ1Y3QgZXRuYXZpdl9kdW1wX3JlZ2lzdGVycykgKwotCQkg
ICAgbW11X3NpemUgKyBncHUtPmJ1ZmZlci5zaXplOwotCi0JLyogQWRkIGluIHRoZSBhY3RpdmUg
Y29tbWFuZCBidWZmZXJzICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShzX2pvYiwgJmdwdS0+c2No
ZWQucmluZ19taXJyb3JfbGlzdCwgbm9kZSkgewotCQlzdWJtaXQgPSB0b19ldG5hdml2X3N1Ym1p
dChzX2pvYik7Ci0JCWZpbGVfc2l6ZSArPSBzdWJtaXQtPmNtZGJ1Zi5zaXplOwotCQluX29iaisr
OwotCX0KKwkJICAgIG1tdV9zaXplICsgZ3B1LT5idWZmZXIuc2l6ZSArIHN1Ym1pdC0+Y21kYnVm
LnNpemU7CiAKIAkvKiBBZGQgaW4gdGhlIGFjdGl2ZSBidWZmZXIgb2JqZWN0cyAqLwotCWxpc3Rf
Zm9yX2VhY2hfZW50cnkodnJhbSwgJmdwdS0+bW11LT5tYXBwaW5ncywgbW11X25vZGUpIHsKLQkJ
aWYgKCF2cmFtLT51c2UpCi0JCQljb250aW51ZTsKLQotCQlvYmogPSB2cmFtLT5vYmplY3Q7CisJ
Zm9yIChpID0gMDsgaSA8IHN1Ym1pdC0+bnJfYm9zOyBpKyspIHsKKwkJb2JqID0gc3VibWl0LT5i
b3NbaV0ub2JqOwogCQlmaWxlX3NpemUgKz0gb2JqLT5iYXNlLnNpemU7CiAJCW5fYm9tYXBfcGFn
ZXMgKz0gb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVDsKIAkJbl9vYmorKzsKQEAgLTE4NSwx
MiArMTc0LDkgQEAgdm9pZCBldG5hdml2X2NvcmVfZHVtcChzdHJ1Y3QgZXRuYXZpdl9ncHUgKmdw
dSkKIAkJCSAgICAgIGdwdS0+YnVmZmVyLnNpemUsCiAJCQkgICAgICBldG5hdml2X2NtZGJ1Zl9n
ZXRfdmEoJmdwdS0+YnVmZmVyKSk7CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHNfam9iLCAmZ3B1
LT5zY2hlZC5yaW5nX21pcnJvcl9saXN0LCBub2RlKSB7Ci0JCXN1Ym1pdCA9IHRvX2V0bmF2aXZf
c3VibWl0KHNfam9iKTsKLQkJZXRuYXZpdl9jb3JlX2R1bXBfbWVtKCZpdGVyLCBFVERVTVBfQlVG
X0NNRCwKLQkJCQkgICAgICBzdWJtaXQtPmNtZGJ1Zi52YWRkciwgc3VibWl0LT5jbWRidWYuc2l6
ZSwKLQkJCQkgICAgICBldG5hdml2X2NtZGJ1Zl9nZXRfdmEoJnN1Ym1pdC0+Y21kYnVmKSk7Ci0J
fQorCWV0bmF2aXZfY29yZV9kdW1wX21lbSgmaXRlciwgRVREVU1QX0JVRl9DTUQsCisJCQkgICAg
ICBzdWJtaXQtPmNtZGJ1Zi52YWRkciwgc3VibWl0LT5jbWRidWYuc2l6ZSwKKwkJCSAgICAgIGV0
bmF2aXZfY21kYnVmX2dldF92YSgmc3VibWl0LT5jbWRidWYpKTsKIAogCS8qIFJlc2VydmUgc3Bh
Y2UgZm9yIHRoZSBib21hcCAqLwogCWlmIChuX2JvbWFwX3BhZ2VzKSB7CkBAIC0yMDMsMTQgKzE4
OSwxMyBAQCB2b2lkIGV0bmF2aXZfY29yZV9kdW1wKHN0cnVjdCBldG5hdml2X2dwdSAqZ3B1KQog
CQlib21hcF9zdGFydCA9IGJvbWFwID0gTlVMTDsKIAl9CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5
KHZyYW0sICZncHUtPm1tdS0+bWFwcGluZ3MsIG1tdV9ub2RlKSB7CisJZm9yIChpID0gMDsgaSA8
IHN1Ym1pdC0+bnJfYm9zOyBpKyspIHsKKwkJc3RydWN0IGV0bmF2aXZfdnJhbV9tYXBwaW5nICp2
cmFtOwogCQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOwogCQl2b2lkICp2YWRkcjsKIAotCQlpZiAodnJh
bS0+dXNlID09IDApCi0JCQljb250aW51ZTsKLQotCQlvYmogPSB2cmFtLT5vYmplY3Q7CisJCW9i
aiA9IHN1Ym1pdC0+Ym9zW2ldLm9iajsKKwkJdnJhbSA9IHN1Ym1pdC0+Ym9zW2ldLm1hcHBpbmc7
CiAKIAkJbXV0ZXhfbG9jaygmb2JqLT5sb2NrKTsKIAkJcGFnZXMgPSBldG5hdml2X2dlbV9nZXRf
cGFnZXMob2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZf
c2NoZWQuYyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfc2NoZWQuYwppbmRleCA0
ZWE4ZGYwM2NkMzguLjRlM2U5NWRjZTZkOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0
bmF2aXYvZXRuYXZpdl9zY2hlZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2
aXZfc2NoZWQuYwpAQCAtMTE1LDcgKzExNSw3IEBAIHN0YXRpYyB2b2lkIGV0bmF2aXZfc2NoZWRf
dGltZWRvdXRfam9iKHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCiAJCWRybV9zY2hl
ZF9pbmNyZWFzZV9rYXJtYShzY2hlZF9qb2IpOwogCiAJLyogZ2V0IHRoZSBHUFUgYmFjayBpbnRv
IHRoZSBpbml0IHN0YXRlICovCi0JZXRuYXZpdl9jb3JlX2R1bXAoZ3B1KTsKKwlldG5hdml2X2Nv
cmVfZHVtcChzdWJtaXQpOwogCWV0bmF2aXZfZ3B1X3JlY292ZXJfaGFuZyhncHUpOwogCiAJZHJt
X3NjaGVkX3Jlc3VibWl0X2pvYnMoJmdwdS0+c2NoZWQpOwotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBs
aXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
