Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D7525179C7
	for <lists+dri-devel@lfdr.de>; Wed,  8 May 2019 14:53:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 46D61898CE;
	Wed,  8 May 2019 12:53:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-it1-x143.google.com (mail-it1-x143.google.com
 [IPv6:2607:f8b0:4864:20::143])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3900C898CE
 for <dri-devel@lists.freedesktop.org>; Wed,  8 May 2019 12:53:43 +0000 (UTC)
Received: by mail-it1-x143.google.com with SMTP id p18so2243883itm.1
 for <dri-devel@lists.freedesktop.org>; Wed, 08 May 2019 05:53:43 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=fOxewZ6F4UkRlgUDgIG8b01uUd/JLGdb08vRphblGO8=;
 b=bSxWROfjjoc4z3Ec5dEEznLYe3DdijJqndM3fTszE+2r9tmTtABpyRLrlTaC0TStMZ
 Xvwd45YZmqdh3ZM8TYTKj9FGP8Zz1NXKWq9Vg58R6ms7ydFJbNmhMHBvnx8W7DBKj/oh
 qhFVH/GeONx9k+TOpOOGU77WrBI2V/hagmsz7goodPqKdnEeow8ZzTm0rnTUBvI/c6wr
 tvovc9a8bJvKl2w/MoEtfOnX5RN1vCztz6q69QKBXBBJJc8/dhN16mp+7mp6XphSLqiS
 fkA/MxRE0Iifx0y2t86n9JEbBcx/ZC7pFptRzUJt+9Cta3ODDfIm7ZM6A7uEY7ad2M+k
 UxiA==
X-Gm-Message-State: APjAAAWRvbc9eDlWwvajNpMb6fiebiP1gjTq5SHD4kMk9AVAz/yv5BoS
 IUbOUQOubgeGIeMdrPWpKEN1JpAN4sJd0Fz1cOdYIA==
X-Google-Smtp-Source: APXvYqxTOaTKSP6Y4xp7zX6TXu+mrqFipCZ+q5PCEtcvm1fcsLRgiecuPJQcL6DTL76l+F8BEK8k91+fFAdk6vedQeY=
X-Received: by 2002:a02:7f81:: with SMTP id r123mr28622059jac.85.1557320022540; 
 Wed, 08 May 2019 05:53:42 -0700 (PDT)
MIME-Version: 1.0
References: <20190508120542.28377-1-chris@chris-wilson.co.uk>
 <20190508120542.28377-2-chris@chris-wilson.co.uk>
In-Reply-To: <20190508120542.28377-2-chris@chris-wilson.co.uk>
From: Daniel Vetter <daniel@ffwll.ch>
Date: Wed, 8 May 2019 14:53:30 +0200
Message-ID: <CAKMK7uHBZ9Fz=PQjDFW9E6P5HQh6zk4zR1PCyecZoCMQm_a-yw@mail.gmail.com>
Subject: Re: [PATCH 1/2] drm/i915: Seal races between async GPU cancellation, 
 retirement and signaling
To: Chris Wilson <chris@chris-wilson.co.uk>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=fOxewZ6F4UkRlgUDgIG8b01uUd/JLGdb08vRphblGO8=;
 b=KDa1WJRcDDG656kltxsmTqC/X0Lg7/urHYdu2BdbmAAgtSgNg5kI50HRhU0gWd6LsO
 fDGUjif876swkNlreBFZprfO7FYfdI16YgVb8v3eMbagr2DR27y4UoZpCCsDZlr5B/Pu
 yLhH2AEApswMYyBDeN9I8P/YTfKOgCimh06NE=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel <dri-devel@lists.freedesktop.org>,
 Tvrtko Ursulin <tvrtko.ursulin@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gV2VkLCBNYXkgOCwgMjAxOSBhdCAyOjA2IFBNIENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMt
d2lsc29uLmNvLnVrPiB3cm90ZToKPgo+IEN1cnJlbnRseSB0aGVyZSBpcyBhbiB1bmRlcmx5aW5n
IGFzc3VtcHRpb24gdGhhdCBpOTE1X3JlcXVlc3RfdW5zdWJtaXQoKQo+IGlzIHN5bmNocm9ub3Vz
IHdydCB0aGUgR1BVIC0tIHRoYXQgaXMgdGhlIHJlcXVlc3QgaXMgbm8gbG9uZ2VyIGluIGZsaWdo
dAo+IGFzIHdlIHJlbW92ZSBpdC4gSW4gdGhlIG5lYXIgZnV0dXJlIHRoYXQgbWF5IGNoYW5nZSwg
YW5kIHRoaXMgbWF5IHVwc2V0Cj4gb3VyIHNpZ25hbGluZyBhcyB3ZSBjYW4gcHJvY2VzcyBhbiBp
bnRlcnJ1cHQgZm9yIHRoYXQgcmVxdWVzdCB3aGlsZSBpdAo+IGlzIG5vIGxvbmdlciBpbiBmbGln
aHQuCj4KPiBDUFUwICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1BVMQo+IGlu
dGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEKPiAocXVldWUgcmVxdWVzdCBjb21wbGV0aW9uKQo+
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpOTE1X3JlcXVlc3RfY2Fu
Y2VsX3NpZ25hbGluZwo+IC4uLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu
Li4KPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaTkxNV9yZXF1ZXN0
X2VuYWJsZV9zaWduYWxpbmcKPiBkbWFfZmVuY2Vfc2lnbmFsCj4KPiBIZW5jZSBpbiB0aGUgdGlt
ZSBpdCB0b29rIHVzIHRvIGRyb3AgdGhlIGxvY2sgdG8gc2lnbmFsIHRoZSByZXF1ZXN0LCBhCj4g
cHJlZW1wdGlvbiBldmVudCBtYXkgaGF2ZSBvY2N1cnJlZCBhbmQgcmUtcXVldWVkIHRoZSByZXF1
ZXN0LiBJbiB0aGUKPiBwcm9jZXNzLCB0aGF0IHJlcXVlc3Qgd291bGQgaGF2ZSBzZWVuIEk5MTVf
RkVOQ0VfRkxBR19TSUdOQUwgY2xlYXIgYW5kCj4gc28gcmV1c2VkIHRoZSBycS0+c2lnbmFsX2xp
bmsgdGhhdCB3YXMgaW4gdXNlIG9uIENQVTAsIGxlYWRpbmcgdG8gYmFkCj4gcG9pbnRlciBjaGFz
aW5nIGluIGludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEuCj4KPiBBIHJlbGF0ZWQgaXNzdWUg
d2FzIHRoYXQgaWYgc29tZW9uZSBzdGFydGVkIGxpc3RlbmluZyBmb3IgYSBzaWduYWwgb24gYQo+
IGNvbXBsZXRlZCBidXQgbm8gbG9uZ2VyIGluLWZsaWdodCByZXF1ZXN0LCB3ZSBtaXNzZWQgdGhl
IG9wcG9ydHVuaXR5IHRvCj4gaW1tZWRpYXRlbHkgc2lnbmFsIHRoYXQgcmVxdWVzdC4KPgo+IEZ1
cnRoZXJtb3JlLCBhcyBpbnRlbF9jb250ZXh0cyBtYXkgYmUgaW1tZWRpYXRlbHkgcmVsZWFzZWQg
ZHVyaW5nCj4gcmVxdWVzdCByZXRpcmVtZW50LCBpbiBvcmRlciB0byBiZSBlbnRpcmVseSBzdXJl
IHRoYXQKPiBpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxIG1heSBubyBsb25nZXIgZGVyZWZl
cmVuY2UgdGhlIGludGVsX2NvbnRleHQKPiAoY2UtPnNpZ25hbHMgYW5kIGNlLT5zaWduYWxfbGlu
ayksIHdlIG11c3Qgd2FpdCBmb3IgaXJxIHNwaW5sb2NrLgo+Cj4gSW4gb3JkZXIgdG8gcHJldmVu
dCB0aGUgcmFjZSwgd2UgdXNlIGEgYml0IGluIHRoZSBmZW5jZS5mbGFncyB0byBzaWduYWwKPiB0
aGUgdHJhbnNmZXIgb250byB0aGUgc2lnbmFsIGxpc3QgaW5zaWRlIGludGVsX2VuZ2luZV9icmVh
ZGNydW1ic19pcnEuCj4gRm9yIHNpbXBsaWNpdHksIHdlIHVzZSB0aGUgRE1BX0ZFTkNFX0ZMQUdf
U0lHTkFMRURfQklUIGFzIGl0IHRoZW4KPiBxdWlja2x5IHNpZ25hbHMgdG8gYW55IG91dHNpZGUg
b2JzZXJ2ZXIgdGhhdCB0aGUgZmVuY2UgaXMgaW5kZWVkIHNpZ25hbGVkLgo+Cj4gdjI6IFNrZXRj
aCBvdXQgcG90ZW50aWFsIGRtYS1mZW5jZSBBUEkgZm9yIG1hbnVhbCBzaWduYWxpbmcKPiB2Mzog
QW5kIHRoZSB0ZXN0X2FuZF9zZXRfYml0KCkKPgo+IEZpeGVzOiA1MmMwZmRiMjVjN2MgKCJkcm0v
aTkxNTogUmVwbGFjZSBnbG9iYWwgYnJlYWRjcnVtYnMgd2l0aCBwZXItY29udGV4dCBpbnRlcnJ1
cHQgdHJhY2tpbmciKQo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMt
d2lsc29uLmNvLnVrPgo+IENjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwu
Y29tPgo+IFJldmlld2VkLWJ5OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwu
Y29tPgoKT2sgY2hhdHRlZCBhIGJpdCB3aXRoIENocmlzIG9uIGlyYywgYW5kIHdlIGFscmVhZHkg
YWxsb3cgZHJpdmVycyB0bwpwYXNzIHdoYXRldmVyIHNwaW5sb2NrIGlzIHN1aXRhYmxlIGZvciB0
aGVpciByZXF1ZXN0L2ZlbmNlCmhhbmRsaW5nL3JldGlyaW5nLCBzbyBhbGxvd2luZyB0byBzcGxp
dCB1cCB0aGlzIGFsbCBtYWtlcyBzZW5zZSBJCnRoaW5rLiBIYXMgbXkgYWNrIG9uIHRoZSBhcHBy
b2FjaC4KCkkgdGhpbmsgaXQnZCBiZSBnb29kIHRvIHNwZWxsIG91dCB0aGUgb3B0aW1pemF0aW9u
IHRoaXMgYWxsb3dzCihzeW5jaHJvbm91cyBjbGVhbnVwIGluc3RlYWQgb2YgcmVmY291bnRpbmcg
YWxsLiB0aGUuIHRoaW5ncy4pIHBsdXMKc2hvd2Nhc2UgdGhlIGxpbmsgYmV0d2VlbiB0aGUgZmVu
Y2UtPmxvY2sgcG9pbnRlciBhbmQgdGhlIHNwbGl0LXVwCl9fZG1hX3NpZ25hbCBmdW5jdGlvbnMg
aW4gdGhlIGtlcm5lbGRvYy4gRGVmaW5pdGVseSBmb3IgdGhlIGNvcmUKcGF0Y2guCgpBbHNvIG5v
dCBzdXJlIHdoeSBfX25vdGlmeSBhbmQgX190aW1lc3RhbXAgaGFzIGEgZG91YmxlIHVuZGVyc2Nv
cmUgaW4KdGhlIG1pZGRsZS4gVGhhdCBjb2xvciBjaG9pY2UgY29uZnVzZXMgbWUgYSBiaXQgOi0p
CgpDaGVlcnMsIERhbmllbAoKPiAtLS0KPiAgZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS5jICAg
ICAgICAgICAgICAgICB8ICAxICsKPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJl
YWRjcnVtYnMuYyB8IDc4ICsrKysrKysrKysrKysrKy0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgIHwgIDEgKwo+ICBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jIHwgIDEgLQo+ICA0IGZpbGVzIGNoYW5nZWQsIDU5IGlu
c2VydGlvbnMoKyksIDIyIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1h
LWJ1Zi9kbWEtZmVuY2UuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwo+IGluZGV4IDNh
YTg3MzNmODMyYS4uOWJmMDYwNDI2MTlhIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9k
bWEtZmVuY2UuYwo+ICsrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwo+IEBAIC0yOSw2
ICsyOSw3IEBACj4KPiAgRVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9lbWl0KTsK
PiAgRVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9lbmFibGVfc2lnbmFsKTsKPiAr
RVhQT1JUX1RSQUNFUE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9zaWduYWxlZCk7Cj4KPiAgc3RhdGlj
IERFRklORV9TUElOTE9DSyhkbWFfZmVuY2Vfc3R1Yl9sb2NrKTsKPiAgc3RhdGljIHN0cnVjdCBk
bWFfZmVuY2UgZG1hX2ZlbmNlX3N0dWI7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9icmVhZGNydW1icy5jCj4gaW5kZXggZmU0NTVmMDFhYTY1Li5jMDkyYmRmNWYwYmYgMTAwNjQ0
Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMKPiBAQCAtMjMs
NiArMjMsNyBAQAo+ICAgKi8KPgo+ICAjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgo+ICsjaW5j
bHVkZSA8dHJhY2UvZXZlbnRzL2RtYV9mZW5jZS5oPgo+ICAjaW5jbHVkZSA8dWFwaS9saW51eC9z
Y2hlZC90eXBlcy5oPgo+Cj4gICNpbmNsdWRlICJpOTE1X2Rydi5oIgo+IEBAIC05Niw5ICs5Nywz
OSBAQCBjaGVja19zaWduYWxfb3JkZXIoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKPiAgICAgICAgIHJldHVybiB0cnVlOwo+ICB9Cj4KPiArc3RhdGlj
IGJvb2wKPiArX19kbWFfZmVuY2Vfc2lnbmFsKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQo+ICt7
Cj4gKyAgICAgICByZXR1cm4gIXRlc3RfYW5kX3NldF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFM
RURfQklULCAmZmVuY2UtPmZsYWdzKTsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQKPiArX19kbWFf
ZmVuY2Vfc2lnbmFsX190aW1lc3RhbXAoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIGt0aW1lX3Qg
dGltZXN0YW1wKQo+ICt7Cj4gKyAgICAgICBmZW5jZS0+dGltZXN0YW1wID0gdGltZXN0YW1wOwo+
ICsgICAgICAgc2V0X2JpdChETUFfRkVOQ0VfRkxBR19USU1FU1RBTVBfQklULCAmZmVuY2UtPmZs
YWdzKTsKPiArICAgICAgIHRyYWNlX2RtYV9mZW5jZV9zaWduYWxlZChmZW5jZSk7Cj4gK30KPiAr
Cj4gK3N0YXRpYyB2b2lkCj4gK19fZG1hX2ZlbmNlX3NpZ25hbF9fbm90aWZ5KHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlKQo+ICt7Cj4gKyAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjdXIsICp0
bXA7Cj4gKwo+ICsgICAgICAgbG9ja2RlcF9hc3NlcnRfaGVsZChmZW5jZS0+bG9jayk7Cj4gKyAg
ICAgICBsb2NrZGVwX2Fzc2VydF9pcnFzX2Rpc2FibGVkKCk7Cj4gKwo+ICsgICAgICAgbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2UtPmNiX2xpc3QsIG5vZGUpIHsKPiAr
ICAgICAgICAgICAgICAgSU5JVF9MSVNUX0hFQUQoJmN1ci0+bm9kZSk7Cj4gKyAgICAgICAgICAg
ICAgIGN1ci0+ZnVuYyhmZW5jZSwgY3VyKTsKPiArICAgICAgIH0KPiArICAgICAgIElOSVRfTElT
VF9IRUFEKCZmZW5jZS0+Y2JfbGlzdCk7Cj4gK30KPiArCj4gIHZvaWQgaW50ZWxfZW5naW5lX2Jy
ZWFkY3J1bWJzX2lycShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIHsKPiAgICAg
ICAgIHN0cnVjdCBpbnRlbF9icmVhZGNydW1icyAqYiA9ICZlbmdpbmUtPmJyZWFkY3J1bWJzOwo+
ICsgICAgICAgY29uc3Qga3RpbWVfdCB0aW1lc3RhbXAgPSBrdGltZV9nZXQoKTsKPiAgICAgICAg
IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgKmNuOwo+ICAgICAgICAgc3RydWN0IGxpc3RfaGVh
ZCAqcG9zLCAqbmV4dDsKPiAgICAgICAgIExJU1RfSEVBRChzaWduYWwpOwo+IEBAIC0xMjIsNiAr
MTUzLDEwIEBAIHZvaWQgaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCj4KPiAgICAgICAgICAgICAgICAgICAgICAgICBHRU1fQlVHX09O
KCF0ZXN0X2JpdChJOTE1X0ZFTkNFX0ZMQUdfU0lHTkFMLAo+ICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICZycS0+ZmVuY2UuZmxhZ3MpKTsKPiArICAgICAgICAg
ICAgICAgICAgICAgICBjbGVhcl9iaXQoSTkxNV9GRU5DRV9GTEFHX1NJR05BTCwgJnJxLT5mZW5j
ZS5mbGFncyk7Cj4gKwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGlmICghX19kbWFfZmVuY2Vf
c2lnbmFsKCZycS0+ZmVuY2UpKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
dGludWU7Cj4KPiAgICAgICAgICAgICAgICAgICAgICAgICAvKgo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAqIFF1ZXVlIGZvciBleGVjdXRpb24gYWZ0ZXIgZHJvcHBpbmcgdGhlIHNpZ25hbGlu
Zwo+IEBAIC0xMjksMTQgKzE2NCw2IEBAIHZvaWQgaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2ly
cShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gICAgICAgICAgICAgICAgICAgICAg
ICAgICogbW9yZSBzaWduYWxlcnMgdG8gdGhlIHNhbWUgY29udGV4dCBvciBlbmdpbmUuCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICovCj4gICAgICAgICAgICAgICAgICAgICAgICAgaTkxNV9y
ZXF1ZXN0X2dldChycSk7Cj4gLQo+IC0gICAgICAgICAgICAgICAgICAgICAgIC8qCj4gLSAgICAg
ICAgICAgICAgICAgICAgICAgICogV2UgbWF5IHJhY2Ugd2l0aCBkaXJlY3QgaW52b2NhdGlvbiBv
Zgo+IC0gICAgICAgICAgICAgICAgICAgICAgICAqIGRtYV9mZW5jZV9zaWduYWwoKSwgZS5nLiBp
OTE1X3JlcXVlc3RfcmV0aXJlKCksCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICogc28gd2Ug
bmVlZCB0byBhY3F1aXJlIG91ciByZWZlcmVuY2UgdG8gdGhlIHJlcXVlc3QKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgKiBiZWZvcmUgd2UgY2FuY2VsIHRoZSBicmVhZGNydW1iLgo+IC0gICAg
ICAgICAgICAgICAgICAgICAgICAqLwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2Jp
dChJOTE1X0ZFTkNFX0ZMQUdfU0lHTkFMLCAmcnEtPmZlbmNlLmZsYWdzKTsKPiAgICAgICAgICAg
ICAgICAgICAgICAgICBsaXN0X2FkZF90YWlsKCZycS0+c2lnbmFsX2xpbmssICZzaWduYWwpOwo+
ICAgICAgICAgICAgICAgICB9Cj4KPiBAQCAtMTU5LDcgKzE4NiwxMiBAQCB2b2lkIGludGVsX2Vu
Z2luZV9icmVhZGNydW1ic19pcnEoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9Cj4gICAgICAgICAgICAgICAg
ICAgICAgICAgbGlzdF9lbnRyeShwb3MsIHR5cGVvZigqcnEpLCBzaWduYWxfbGluayk7Cj4KPiAt
ICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3NpZ25hbCgmcnEtPmZlbmNlKTsKPiArICAgICAgICAg
ICAgICAgX19kbWFfZmVuY2Vfc2lnbmFsX190aW1lc3RhbXAoJnJxLT5mZW5jZSwgdGltZXN0YW1w
KTsKPiArCj4gKyAgICAgICAgICAgICAgIHNwaW5fbG9jaygmcnEtPmxvY2spOwo+ICsgICAgICAg
ICAgICAgICBfX2RtYV9mZW5jZV9zaWduYWxfX25vdGlmeSgmcnEtPmZlbmNlKTsKPiArICAgICAg
ICAgICAgICAgc3Bpbl91bmxvY2soJnJxLT5sb2NrKTsKPiArCj4gICAgICAgICAgICAgICAgIGk5
MTVfcmVxdWVzdF9wdXQocnEpOwo+ICAgICAgICAgfQo+ICB9Cj4gQEAgLTI2MSwxOSArMjkzLDE3
IEBAIHZvaWQgaW50ZWxfZW5naW5lX2ZpbmlfYnJlYWRjcnVtYnMoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQo+Cj4gIGJvb2wgaTkxNV9yZXF1ZXN0X2VuYWJsZV9icmVhZGNydW1iKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQo+ICB7Cj4gLSAgICAgICBzdHJ1Y3QgaW50ZWxfYnJlYWRj
cnVtYnMgKmIgPSAmcnEtPmVuZ2luZS0+YnJlYWRjcnVtYnM7Cj4gLQo+IC0gICAgICAgR0VNX0JV
R19PTih0ZXN0X2JpdChJOTE1X0ZFTkNFX0ZMQUdfU0lHTkFMLCAmcnEtPmZlbmNlLmZsYWdzKSk7
Cj4gKyAgICAgICBsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+bG9jayk7Cj4gKyAgICAgICBsb2Nr
ZGVwX2Fzc2VydF9pcnFzX2Rpc2FibGVkKCk7Cj4KPiAtICAgICAgIGlmICghdGVzdF9iaXQoSTkx
NV9GRU5DRV9GTEFHX0FDVElWRSwgJnJxLT5mZW5jZS5mbGFncykpCj4gLSAgICAgICAgICAgICAg
IHJldHVybiB0cnVlOwo+IC0KPiAtICAgICAgIHNwaW5fbG9jaygmYi0+aXJxX2xvY2spOwo+IC0g
ICAgICAgaWYgKHRlc3RfYml0KEk5MTVfRkVOQ0VfRkxBR19BQ1RJVkUsICZycS0+ZmVuY2UuZmxh
Z3MpICYmCj4gLSAgICAgICAgICAgIV9fcmVxdWVzdF9jb21wbGV0ZWQocnEpKSB7Cj4gKyAgICAg
ICBpZiAodGVzdF9iaXQoSTkxNV9GRU5DRV9GTEFHX0FDVElWRSwgJnJxLT5mZW5jZS5mbGFncykp
IHsKPiArICAgICAgICAgICAgICAgc3RydWN0IGludGVsX2JyZWFkY3J1bWJzICpiID0gJnJxLT5l
bmdpbmUtPmJyZWFkY3J1bWJzOwo+ICAgICAgICAgICAgICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UgPSBycS0+aHdfY29udGV4dDsKPiAgICAgICAgICAgICAgICAgc3RydWN0IGxpc3RfaGVh
ZCAqcG9zOwo+Cj4gKyAgICAgICAgICAgICAgIHNwaW5fbG9jaygmYi0+aXJxX2xvY2spOwo+ICsg
ICAgICAgICAgICAgICBHRU1fQlVHX09OKHRlc3RfYml0KEk5MTVfRkVOQ0VfRkxBR19TSUdOQUws
ICZycS0+ZmVuY2UuZmxhZ3MpKTsKPiArCj4gICAgICAgICAgICAgICAgIF9faW50ZWxfYnJlYWRj
cnVtYnNfYXJtX2lycShiKTsKPgo+ICAgICAgICAgICAgICAgICAvKgo+IEBAIC0zMDMsOCArMzMz
LDggQEAgYm9vbCBpOTE1X3JlcXVlc3RfZW5hYmxlX2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCj4gICAgICAgICAgICAgICAgIEdFTV9CVUdfT04oIWNoZWNrX3NpZ25hbF9vcmRl
cihjZSwgcnEpKTsKPgo+ICAgICAgICAgICAgICAgICBzZXRfYml0KEk5MTVfRkVOQ0VfRkxBR19T
SUdOQUwsICZycS0+ZmVuY2UuZmxhZ3MpOwo+ICsgICAgICAgICAgICAgICBzcGluX3VubG9jaygm
Yi0+aXJxX2xvY2spOwo+ICAgICAgICAgfQo+IC0gICAgICAgc3Bpbl91bmxvY2soJmItPmlycV9s
b2NrKTsKPgo+ICAgICAgICAgcmV0dXJuICFfX3JlcXVlc3RfY29tcGxldGVkKHJxKTsKPiAgfQo+
IEBAIC0zMTMsOSArMzQzLDE1IEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2NhbmNlbF9icmVhZGNydW1i
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgaW50ZWxfYnJl
YWRjcnVtYnMgKmIgPSAmcnEtPmVuZ2luZS0+YnJlYWRjcnVtYnM7Cj4KPiAtICAgICAgIGlmICgh
dGVzdF9iaXQoSTkxNV9GRU5DRV9GTEFHX1NJR05BTCwgJnJxLT5mZW5jZS5mbGFncykpCj4gLSAg
ICAgICAgICAgICAgIHJldHVybjsKPiArICAgICAgIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT5s
b2NrKTsKPiArICAgICAgIGxvY2tkZXBfYXNzZXJ0X2lycXNfZGlzYWJsZWQoKTsKPgo+ICsgICAg
ICAgLyoKPiArICAgICAgICAqIFdlIG11c3Qgd2FpdCBmb3IgYi0+aXJxX2xvY2sgc28gdGhhdCB3
ZSBrbm93IHRoZSBpbnRlcnJ1cHQgaGFuZGxlcgo+ICsgICAgICAgICogaGFzIHJlbGVhc2VkIGl0
cyByZWZlcmVuY2UgdG8gdGhlIGludGVsX2NvbnRleHQgYW5kIGhhcyBjb21wbGV0ZWQKPiArICAg
ICAgICAqIHRoZSBETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQvSTkxNV9GRU5DRV9GTEFHX1NJ
R05BTCBkYW5jZSAoaWYKPiArICAgICAgICAqIHJlcXVpcmVkKS4KPiArICAgICAgICAqLwo+ICAg
ICAgICAgc3Bpbl9sb2NrKCZiLT5pcnFfbG9jayk7Cj4gICAgICAgICBpZiAodGVzdF9iaXQoSTkx
NV9GRU5DRV9GTEFHX1NJR05BTCwgJnJxLT5mZW5jZS5mbGFncykpIHsKPiAgICAgICAgICAgICAg
ICAgc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gcnEtPmh3X2NvbnRleHQ7Cj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmMKPiBpbmRleCBmYTk1NWI3YjZkZWYuLmJlZDIxMzE0OGNiYiAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwo+ICsrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCj4gQEAgLTQzNyw2ICs0MzcsNyBA
QCB2b2lkIF9faTkxNV9yZXF1ZXN0X3N1Ym1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0
KQo+ICAgICAgICAgc2V0X2JpdChJOTE1X0ZFTkNFX0ZMQUdfQUNUSVZFLCAmcmVxdWVzdC0+ZmVu
Y2UuZmxhZ3MpOwo+Cj4gICAgICAgICBpZiAodGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfRU5BQkxF
X1NJR05BTF9CSVQsICZyZXF1ZXN0LT5mZW5jZS5mbGFncykgJiYKPiArICAgICAgICAgICAhdGVz
dF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmcmVxdWVzdC0+ZmVuY2UuZmxhZ3Mp
ICYmCj4gICAgICAgICAgICAgIWk5MTVfcmVxdWVzdF9lbmFibGVfYnJlYWRjcnVtYihyZXF1ZXN0
KSkKPiAgICAgICAgICAgICAgICAgaW50ZWxfZW5naW5lX3F1ZXVlX2JyZWFkY3J1bWJzKGVuZ2lu
ZSk7Cj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1p
c3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKPiBp
bmRleCAzODBkODNhMmJmYjYuLmVhMGUzNzM0ZDM3YyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwo+IEBAIC0yMyw3ICsyMyw2IEBACj4gICAqLwo+
Cj4gICNpbmNsdWRlIDxsaW51eC9jaXJjX2J1Zi5oPgo+IC0jaW5jbHVkZSA8dHJhY2UvZXZlbnRz
L2RtYV9mZW5jZS5oPgo+Cj4gICNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKPiAgI2lu
Y2x1ZGUgImd0L2ludGVsX2xyY19yZWcuaCIKPiAtLQo+IDIuMjAuMQo+Cj4gX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KPiBkcmktZGV2ZWwgbWFpbGluZyBs
aXN0Cj4gZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwo+IGh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCgoKCi0tIApEYW5pZWwgVmV0
dGVyClNvZnR3YXJlIEVuZ2luZWVyLCBJbnRlbCBDb3Jwb3JhdGlvbgorNDEgKDApIDc5IDM2NSA1
NyA0OCAtIGh0dHA6Ly9ibG9nLmZmd2xsLmNoCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
