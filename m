Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 504F82C64BA
	for <lists+dri-devel@lfdr.de>; Fri, 27 Nov 2020 13:10:44 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D1ACB6EC85;
	Fri, 27 Nov 2020 12:09:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 72EFA6EC34;
 Fri, 27 Nov 2020 12:09:21 +0000 (UTC)
IronPort-SDR: lB5YLuSKpuULykhxhSwz8ldN3rpDHGQIAPNsDJ8jV8KHhebAeZcMFhnI2Q/FocvnbdEPgBI68L
 Dd2fsOE/GzMA==
X-IronPort-AV: E=McAfee;i="6000,8403,9817"; a="172540657"
X-IronPort-AV: E=Sophos;i="5.78,374,1599548400"; d="scan'208";a="172540657"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 27 Nov 2020 04:09:21 -0800
IronPort-SDR: KFyJ3KdZzs623aA0dQs9vR2sfwvLnOqE4GLcb5kX8Y6PcQh1feNMHplY/c7URXf1MFKdi5JMDb
 N1T1HMX01XXw==
X-IronPort-AV: E=Sophos;i="5.78,374,1599548400"; d="scan'208";a="548028935"
Received: from mjgleeso-mobl.ger.corp.intel.com (HELO
 mwauld-desk1.ger.corp.intel.com) ([10.251.85.2])
 by orsmga005-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 27 Nov 2020 04:09:19 -0800
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC PATCH 062/162] drm/i915/selftests: Prepare execlists for
 obj->mm.lock removal
Date: Fri, 27 Nov 2020 12:05:38 +0000
Message-Id: <20201127120718.454037-63-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20201127120718.454037-1-matthew.auld@intel.com>
References: <20201127120718.454037-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org,
 =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNv
bT4KCkNvbnZlcnQgbm9ybWFsIGZ1bmN0aW9ucyB0byB1bmxvY2tlZCB2ZXJzaW9ucyB3aGVyZSBu
ZWVkZWQuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9y
c3RAbGludXguaW50ZWwuY29tPgpDYzogVGhvbWFzIEhlbGxzdHLDtm0gPHRob21hcy5oZWxsc3Ry
b21AbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2V4ZWNsaXN0cy5jIHwgMzQgKysrKysrKysrKy0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAx
NyBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2V4ZWNsaXN0cy5jCmluZGV4IDk1ZDQxYzAxZDBlMC4uMTI0MDExZjZmYjUx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYwpAQCAt
MTAwNyw3ICsxMDA3LDcgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQg
KmFyZykKIAkJZ290byBlcnJfb2JqOwogCX0KIAotCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bp
bl9tYXAob2JqLCBJOTE1X01BUF9XQyk7CisJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21h
cF91bmxvY2tlZChvYmosIEk5MTVfTUFQX1dDKTsKIAlpZiAoSVNfRVJSKHZhZGRyKSkgewogCQll
cnIgPSBQVFJfRVJSKHZhZGRyKTsKIAkJZ290byBlcnJfb2JqOwpAQCAtMTMxNSw3ICsxMzE1LDcg
QEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2b2lkICphcmcpCiAJCWdvdG8gZXJy
X29iajsKIAl9CiAKLQl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9N
QVBfV0MpOworCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXBfdW5sb2NrZWQob2JqLCBJ
OTE1X01BUF9XQyk7CiAJaWYgKElTX0VSUih2YWRkcikpIHsKIAkJZXJyID0gUFRSX0VSUih2YWRk
cik7CiAJCWdvdG8gZXJyX29iajsKQEAgLTE1NjIsNyArMTU2Miw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJZ290byBlcnJfY3R4X2xvOwogCX0KIAot
CW1hcCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCW1hcCA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwX3VubG9ja2VkKG9iaiwgSTkxNV9NQVBfV0MpOwogCWlm
IChJU19FUlIobWFwKSkgewogCQllcnIgPSBQVFJfRVJSKG1hcCk7CiAJCWdvdG8gZXJyX29iajsK
QEAgLTI2NzgsNyArMjY3OCw3IEBAIHN0YXRpYyBpbnQgY3JlYXRlX2dhbmcoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lLAogCWlmIChlcnIpCiAJCWdvdG8gZXJyX29iajsKIAotCWNzID0g
aTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJOTE1X01BUF9XQyk7CisJY3MgPSBpOTE1X2dl
bV9vYmplY3RfcGluX21hcF91bmxvY2tlZChvYmosIEk5MTVfTUFQX1dDKTsKIAlpZiAoSVNfRVJS
KGNzKSkKIAkJZ290byBlcnJfb2JqOwogCkBAIC0yOTYwLDcgKzI5NjAsNyBAQCBzdGF0aWMgaW50
IGxpdmVfcHJlZW1wdF9nYW5nKHZvaWQgKmFyZykKIAkJICogaXQgd2lsbCB0ZXJtaW5hdGUgdGhl
IG5leHQgbG93ZXN0IHNwaW5uZXIgdW50aWwgdGhlcmUKIAkJICogYXJlIG5vIG1vcmUgc3Bpbm5l
cnMgYW5kIHRoZSBnYW5nIGlzIGNvbXBsZXRlLgogCQkgKi8KLQkJY3MgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChycS0+YmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0MpOworCQljcyA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fbWFwX3VubG9ja2VkKHJxLT5iYXRjaC0+b2JqLCBJOTE1X01BUF9XQyk7CiAJ
CWlmICghSVNfRVJSKGNzKSkgewogCQkJKmNzID0gMDsKIAkJCWk5MTVfZ2VtX29iamVjdF91bnBp
bl9tYXAocnEtPmJhdGNoLT5vYmopOwpAQCAtMzAyNSw3ICszMDI1LDcgQEAgY3JlYXRlX2dwcl91
c2VyKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcmV0dXJuIEVSUl9QVFIoZXJy
KTsKIAl9CiAKLQljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0Mp
OworCWNzID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXBfdW5sb2NrZWQob2JqLCBJOTE1X01BUF9X
Qyk7CiAJaWYgKElTX0VSUihjcykpIHsKIAkJaTkxNV92bWFfcHV0KHZtYSk7CiAJCXJldHVybiBF
UlJfQ0FTVChjcyk7CkBAIC0zMjM1LDcgKzMyMzUsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1w
dF91c2VyKHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGdsb2JhbCkpCiAJCXJldHVybiBQVFJfRVJS
KGdsb2JhbCk7CiAKLQlyZXN1bHQgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChnbG9iYWwtPm9i
aiwgSTkxNV9NQVBfV0MpOworCXJlc3VsdCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwX3VubG9j
a2VkKGdsb2JhbC0+b2JqLCBJOTE1X01BUF9XQyk7CiAJaWYgKElTX0VSUihyZXN1bHQpKSB7CiAJ
CWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZnbG9iYWwsIDApOwogCQlyZXR1cm4gUFRSX0VS
UihyZXN1bHQpOwpAQCAtMzYyOCw3ICszNjI4LDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRf
c21va2Uodm9pZCAqYXJnKQogCQlnb3RvIGVycl9mcmVlOwogCX0KIAotCWNzID0gaTkxNV9nZW1f
b2JqZWN0X3Bpbl9tYXAoc21va2UuYmF0Y2gsIEk5MTVfTUFQX1dCKTsKKwljcyA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fbWFwX3VubG9ja2VkKHNtb2tlLmJhdGNoLCBJOTE1X01BUF9XQik7CiAJaWYg
KElTX0VSUihjcykpIHsKIAkJZXJyID0gUFRSX0VSUihjcyk7CiAJCWdvdG8gZXJyX2JhdGNoOwpA
QCAtNDIzMSw3ICs0MjMxLDcgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUo
c3RydWN0IGludGVsX2d0ICpndCwKIAkJZ290byBvdXRfZW5kOwogCX0KIAotCWNzID0gaTkxNV9n
ZW1fb2JqZWN0X3Bpbl9tYXAoc2NyYXRjaC0+b2JqLCBJOTE1X01BUF9XQik7CisJY3MgPSBpOTE1
X2dlbV9vYmplY3RfcGluX21hcF91bmxvY2tlZChzY3JhdGNoLT5vYmosIEk5MTVfTUFQX1dCKTsK
IAlpZiAoSVNfRVJSKGNzKSkgewogCQllcnIgPSBQVFJfRVJSKGNzKTsKIAkJZ290byBvdXRfZW5k
OwpAQCAtNTI1OSw3ICs1MjU5LDcgQEAgc3RhdGljIGludCBfX2xpdmVfbHJjX2dwcihzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCWdvdG8gZXJyX3JxOwogCX0KIAotCWNzID0gaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAoc2NyYXRjaC0+b2JqLCBJOTE1X01BUF9XQik7CisJY3MgPSBp
OTE1X2dlbV9vYmplY3RfcGluX21hcF91bmxvY2tlZChzY3JhdGNoLT5vYmosIEk5MTVfTUFQX1dC
KTsKIAlpZiAoSVNfRVJSKGNzKSkgewogCQllcnIgPSBQVFJfRVJSKGNzKTsKIAkJZ290byBlcnJf
cnE7CkBAIC01NTUzLDcgKzU1NTMsNyBAQCBzdG9yZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwgc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoKQogCWlmIChJU19FUlIoYmF0Y2gpKQog
CQlyZXR1cm4gYmF0Y2g7CiAKLQljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJhdGNoLT5v
YmosIEk5MTVfTUFQX1dDKTsKKwljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwX3VubG9ja2Vk
KGJhdGNoLT5vYmosIEk5MTVfTUFQX1dDKTsKIAlpZiAoSVNfRVJSKGNzKSkgewogCQlpOTE1X3Zt
YV9wdXQoYmF0Y2gpOwogCQlyZXR1cm4gRVJSX0NBU1QoY3MpOwpAQCAtNTcxNyw3ICs1NzE3LDcg
QEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqbG9hZF9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwgdTMyIHBvaXNvbikKIAlpZiAoSVNfRVJSKGJhdGNoKSkKIAkJcmV0dXJuIGJhdGNo
OwogCi0JY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChiYXRjaC0+b2JqLCBJOTE1X01BUF9X
Qyk7CisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcF91bmxvY2tlZChiYXRjaC0+b2JqLCBJ
OTE1X01BUF9XQyk7CiAJaWYgKElTX0VSUihjcykpIHsKIAkJaTkxNV92bWFfcHV0KGJhdGNoKTsK
IAkJcmV0dXJuIEVSUl9DQVNUKGNzKTsKQEAgLTU4MzEsMjkgKzU4MzEsMjkgQEAgc3RhdGljIGlu
dCBjb21wYXJlX2lzb2xhdGlvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJdTMy
ICpkZWZhdWx0czsKIAlpbnQgZXJyID0gMDsKIAotCUFbMF0gPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChyZWZbMF0tPm9iaiwgSTkxNV9NQVBfV0MpOworCUFbMF0gPSBpOTE1X2dlbV9vYmplY3Rf
cGluX21hcF91bmxvY2tlZChyZWZbMF0tPm9iaiwgSTkxNV9NQVBfV0MpOwogCWlmIChJU19FUlIo
QVswXSkpCiAJCXJldHVybiBQVFJfRVJSKEFbMF0pOwogCi0JQVsxXSA9IGk5MTVfZ2VtX29iamVj
dF9waW5fbWFwKHJlZlsxXS0+b2JqLCBJOTE1X01BUF9XQyk7CisJQVsxXSA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwX3VubG9ja2VkKHJlZlsxXS0+b2JqLCBJOTE1X01BUF9XQyk7CiAJaWYgKElT
X0VSUihBWzFdKSkgewogCQllcnIgPSBQVFJfRVJSKEFbMV0pOwogCQlnb3RvIGVycl9BMDsKIAl9
CiAKLQlCWzBdID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAocmVzdWx0WzBdLT5vYmosIEk5MTVf
TUFQX1dDKTsKKwlCWzBdID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXBfdW5sb2NrZWQocmVzdWx0
WzBdLT5vYmosIEk5MTVfTUFQX1dDKTsKIAlpZiAoSVNfRVJSKEJbMF0pKSB7CiAJCWVyciA9IFBU
Ul9FUlIoQlswXSk7CiAJCWdvdG8gZXJyX0ExOwogCX0KIAotCUJbMV0gPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChyZXN1bHRbMV0tPm9iaiwgSTkxNV9NQVBfV0MpOworCUJbMV0gPSBpOTE1X2dl
bV9vYmplY3RfcGluX21hcF91bmxvY2tlZChyZXN1bHRbMV0tPm9iaiwgSTkxNV9NQVBfV0MpOwog
CWlmIChJU19FUlIoQlsxXSkpIHsKIAkJZXJyID0gUFRSX0VSUihCWzFdKTsKIAkJZ290byBlcnJf
QjA7CiAJfQogCi0JbHJjID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoY2UtPnN0YXRlLT5vYmos
CisJbHJjID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXBfdW5sb2NrZWQoY2UtPnN0YXRlLT5vYmos
CiAJCQkJICAgICAgaTkxNV9jb2hlcmVudF9tYXBfdHlwZShlbmdpbmUtPmk5MTUpKTsKIAlpZiAo
SVNfRVJSKGxyYykpIHsKIAkJZXJyID0gUFRSX0VSUihscmMpOwotLSAKMi4yNi4yCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
