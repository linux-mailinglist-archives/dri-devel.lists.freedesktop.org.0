Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 35CF8BF5CB
	for <lists+dri-devel@lfdr.de>; Thu, 26 Sep 2019 17:23:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AF6B06ED7B;
	Thu, 26 Sep 2019 15:23:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id E5EB06ED77
 for <dri-devel@lists.freedesktop.org>; Thu, 26 Sep 2019 15:23:20 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 43D2F28;
 Thu, 26 Sep 2019 08:23:20 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id D47503F534;
 Thu, 26 Sep 2019 08:23:18 -0700 (PDT)
Subject: Re: [PATCH v4] drm: Don't free jobs in wait_event_interruptible()
To: "Grodzovsky, Andrey" <Andrey.Grodzovsky@amd.com>,
 Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>,
 "Koenig, Christian" <Christian.Koenig@amd.com>
References: <20190926141630.14258-1-steven.price@arm.com>
 <b457a269-4aa9-7e3b-283e-b4920455e396@amd.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <48214f02-e853-015f-55cc-397c7b06cb5d@arm.com>
Date: Thu, 26 Sep 2019 16:23:17 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <b457a269-4aa9-7e3b-283e-b4920455e396@amd.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: "Deucher, Alexander" <Alexander.Deucher@amd.com>,
 Nayan Deshmukh <nayan26deshmukh@gmail.com>,
 Sharat Masetty <smasetty@codeaurora.org>,
 "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
 "dri-devel@lists.freedesktop.org" <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjYvMDkvMjAxOSAxNjoxNCwgR3JvZHpvdnNreSwgQW5kcmV5IHdyb3RlOgo+IAo+IE9uIDkv
MjYvMTkgMTA6MTYgQU0sIFN0ZXZlbiBQcmljZSB3cm90ZToKPj4gZHJtX3NjaGVkX2NsZWFudXBf
am9icygpIGF0dGVtcHRzIHRvIGZyZWUgZmluaXNoZWQgam9icywgaG93ZXZlciBiZWNhdXNlCj4+
IGl0IGlzIGNhbGxlZCBhcyB0aGUgY29uZGl0aW9uIG9mIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJs
ZSgpIGl0IG11c3Qgbm90Cj4+IHNsZWVwLiBVbmZvcnR1YW50bHkgc29tZSBmcmVlIGNhbGxiYWNr
cyAobm90aWJseSBmb3IgUGFuZnJvc3QpIGRvIHNsZWVwLgo+Pgo+PiBJbnN0ZWFkIGxldCdzIHJl
bmFtZSBkcm1fc2NoZWRfY2xlYW51cF9qb2JzKCkgdG8KPj4gZHJtX3NjaGVkX2dldF9jbGVhbnVw
X2pvYigpIGFuZCBzaW1wbHkgcmV0dXJuIGEgam9iIGZvciBwcm9jZXNzaW5nIGlmCj4+IHRoZXJl
IGlzIG9uZS4gVGhlIGNhbGxlciBjYW4gdGhlbiBjYWxsIHRoZSBmcmVlX2pvYigpIGNhbGxiYWNr
IG91dHNpZGUKPj4gdGhlIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZSgpIHdoZXJlIHNsZWVwaW5n
IGlzIHBvc3NpYmxlIGJlZm9yZQo+PiByZS1jaGVja2luZyBhbmQgcmV0dXJuaW5nIHRvIHNsZWVw
IGlmIG5lY2Vzc2FyeS4KPj4KPj4gU2lnbmVkLW9mZi1ieTogU3RldmVuIFByaWNlIDxzdGV2ZW4u
cHJpY2VAYXJtLmNvbT4KPj4gLS0tCj4+IENoYW5nZXMgZnJvbSB2MzoKPj4gICAqIGRybV9zY2hl
ZF9tYWluKCkgcmUtYXJtcyB0aGUgdGltZW91dCBmb3IgdGhlIG5leHQgam9iIGFmdGVyIGNhbGxp
bmcKPj4gICAgIGZyZWVfam9iKCkKPj4KPj4gICBkcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3Nj
aGVkX21haW4uYyB8IDQ1ICsrKysrKysrKysrKysrKy0tLS0tLS0tLS0tCj4+ICAgMSBmaWxlIGNo
YW5nZWQsIDI2IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQo+Pgo+PiBkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9tYWluLmMgYi9kcml2ZXJzL2dwdS9k
cm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiBpbmRleCA5YTBlZTc0ZDgyZGMuLjE0ODQ2ODQ0
N2JhOSAxMDA2NDQKPj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9tYWlu
LmMKPj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9tYWluLmMKPj4gQEAg
LTYyMiw0MyArNjIyLDQxIEBAIHN0YXRpYyB2b2lkIGRybV9zY2hlZF9wcm9jZXNzX2pvYihzdHJ1
Y3QgZG1hX2ZlbmNlICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKPj4gICB9Cj4+ICAgCj4+
ICAgLyoqCj4+IC0gKiBkcm1fc2NoZWRfY2xlYW51cF9qb2JzIC0gZGVzdHJveSBmaW5pc2hlZCBq
b2JzCj4+ICsgKiBkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iIC0gZmV0Y2ggdGhlIG5leHQgZmlu
aXNoZWQgam9iIHRvIGJlIGRlc3Ryb3llZAo+PiAgICAqCj4+ICAgICogQHNjaGVkOiBzY2hlZHVs
ZXIgaW5zdGFuY2UKPj4gICAgKgo+PiAtICogUmVtb3ZlIGFsbCBmaW5pc2hlZCBqb2JzIGZyb20g
dGhlIG1pcnJvciBsaXN0IGFuZCBkZXN0cm95IHRoZW0uCj4+ICsgKiBSZXR1cm5zIHRoZSBuZXh0
IGZpbmlzaGVkIGpvYiBmcm9tIHRoZSBtaXJyb3IgbGlzdCAoaWYgdGhlcmUgaXMgb25lKQo+PiAr
ICogcmVhZHkgZm9yIGl0IHRvIGJlIGRlc3Ryb3llZC4KPj4gICAgKi8KPj4gLXN0YXRpYyB2b2lk
IGRybV9zY2hlZF9jbGVhbnVwX2pvYnMoc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCkK
Pj4gK3N0YXRpYyBzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAqCj4+ICtkcm1fc2NoZWRfZ2V0X2NsZWFu
dXBfam9iKHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAqc2NoZWQpCj4+ICAgewo+PiArCXN0cnVj
dCBkcm1fc2NoZWRfam9iICpqb2IgPSBOVUxMOwo+PiAgIAl1bnNpZ25lZCBsb25nIGZsYWdzOwo+
PiAgIAo+PiAgIAkvKiBEb24ndCBkZXN0cm95IGpvYnMgd2hpbGUgdGhlIHRpbWVvdXQgd29ya2Vy
IGlzIHJ1bm5pbmcgKi8KPj4gICAJaWYgKHNjaGVkLT50aW1lb3V0ICE9IE1BWF9TQ0hFRFVMRV9U
SU1FT1VUICYmCj4+ICAgCSAgICAhY2FuY2VsX2RlbGF5ZWRfd29yaygmc2NoZWQtPndvcmtfdGRy
KSkKPj4gLQkJcmV0dXJuOwo+PiAtCj4+ICsJCXJldHVybiBOVUxMOwo+PiAgIAo+PiAtCXdoaWxl
ICghbGlzdF9lbXB0eSgmc2NoZWQtPnJpbmdfbWlycm9yX2xpc3QpKSB7Cj4+IC0JCXN0cnVjdCBk
cm1fc2NoZWRfam9iICpqb2I7Cj4+ICsJc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkLT5qb2JfbGlz
dF9sb2NrLCBmbGFncyk7Cj4+ICAgCj4+IC0JCWpvYiA9IGxpc3RfZmlyc3RfZW50cnkoJnNjaGVk
LT5yaW5nX21pcnJvcl9saXN0LAo+PiArCWpvYiA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgm
c2NoZWQtPnJpbmdfbWlycm9yX2xpc3QsCj4+ICAgCQkJCSAgICAgICBzdHJ1Y3QgZHJtX3NjaGVk
X2pvYiwgbm9kZSk7Cj4+IC0JCWlmICghZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKCZqb2ItPnNfZmVu
Y2UtPmZpbmlzaGVkKSkKPj4gLQkJCWJyZWFrOwo+PiAgIAo+PiAtCQlzcGluX2xvY2tfaXJxc2F2
ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPj4gKwlpZiAoam9iICYmIGRtYV9mZW5j
ZV9pc19zaWduYWxlZCgmam9iLT5zX2ZlbmNlLT5maW5pc2hlZCkpIHsKPj4gICAJCS8qIHJlbW92
ZSBqb2IgZnJvbSByaW5nX21pcnJvcl9saXN0ICovCj4+ICAgCQlsaXN0X2RlbF9pbml0KCZqb2It
Pm5vZGUpOwo+PiAtCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+am9iX2xpc3RfbG9j
aywgZmxhZ3MpOwo+PiAtCj4+IC0JCXNjaGVkLT5vcHMtPmZyZWVfam9iKGpvYik7Cj4+ICsJfSBl
bHNlIHsKPj4gKwkJam9iID0gTlVMTDsKPj4gKwkJLyogcXVldWUgdGltZW91dCBmb3IgbmV4dCBq
b2IgKi8KPj4gKwkJZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQoc2NoZWQpOwo+PiAgIAl9Cj4+ICAg
Cj4+IC0JLyogcXVldWUgdGltZW91dCBmb3IgbmV4dCBqb2IgKi8KPj4gLQlzcGluX2xvY2tfaXJx
c2F2ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPj4gLQlkcm1fc2NoZWRfc3RhcnRf
dGltZW91dChzY2hlZCk7Cj4+ICAgCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNjaGVkLT5qb2Jf
bGlzdF9sb2NrLCBmbGFncyk7Cj4+ICAgCj4+ICsJcmV0dXJuIGpvYjsKPj4gICB9Cj4+ICAgCj4+
ICAgLyoqCj4+IEBAIC02OTgsMTIgKzY5NiwyMSBAQCBzdGF0aWMgaW50IGRybV9zY2hlZF9tYWlu
KHZvaWQgKnBhcmFtKQo+PiAgIAkJc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZTsKPj4g
ICAJCXN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2I7Cj4+ICAgCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKPj4gKwkJc3RydWN0IGRybV9zY2hlZF9qb2IgKmNsZWFudXBfam9iID0gTlVM
TDsKPj4gICAKPj4gICAJCXdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZShzY2hlZC0+d2FrZV91cF93
b3JrZXIsCj4+IC0JCQkJCSAoZHJtX3NjaGVkX2NsZWFudXBfam9icyhzY2hlZCksCj4+ICsJCQkJ
CSAoY2xlYW51cF9qb2IgPSBkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iKHNjaGVkKSkgfHwKPj4g
ICAJCQkJCSAoIWRybV9zY2hlZF9ibG9ja2VkKHNjaGVkKSAmJgo+PiAgIAkJCQkJICAoZW50aXR5
ID0gZHJtX3NjaGVkX3NlbGVjdF9lbnRpdHkoc2NoZWQpKSkgfHwKPj4gLQkJCQkJIGt0aHJlYWRf
c2hvdWxkX3N0b3AoKSkpOwo+PiArCQkJCQkga3RocmVhZF9zaG91bGRfc3RvcCgpKTsKPj4gKwo+
PiArCQl3aGlsZSAoY2xlYW51cF9qb2IpIHsKPj4gKwkJCXNjaGVkLT5vcHMtPmZyZWVfam9iKGNs
ZWFudXBfam9iKTsKPj4gKwkJCS8qIHF1ZXVlIHRpbWVvdXQgZm9yIG5leHQgam9iICovCj4+ICsJ
CQlkcm1fc2NoZWRfc3RhcnRfdGltZW91dChzY2hlZCk7Cj4+ICsKPj4gKwkJCWNsZWFudXBfam9i
ID0gZHJtX3NjaGVkX2dldF9jbGVhbnVwX2pvYihzY2hlZCk7Cj4+ICsJCX0KPiAKPiAKPiBXaHkg
ZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQgaXMgY2FsbGVkIGJvdGggaGVyZSBhbmQgaW5zaWRlIAo+
IGRybV9zY2hlZF9nZXRfY2xlYW51cF9qb2IgPyBBbmQgYWxzbyB3aHkgY2FsbCBpdCBtdWx0aXBs
ZSB0aW1lcyBpbiB0aGUgCj4gbG9vcCBpbnN0ZWFkIG9mIG9ubHkgb25jZSBhZnRlciB0aGUgbG9v
cCBpcyBkb25lwqAgPwoKQ2hyaXN0aWFuIHBvaW50ZWQgb3V0IHRvIGJlIHRoYXQgdGhlIGZpcnN0
IHRoaW5nCmRybV9zY2hlZF9nZXRfY2xlYW51cF9qb2IgZG9lcyBpcyBjYWxsIGNhbmNlbF9kZWxh
eWVkX3dvcmsoKSwgYW5kIGlmCnRoYXQgcmV0dXJucyBmYWxzZSB0aGVuIGl0IGJhaWxzIG91dCB3
aXRoIGEgTlVMTCByZXR1cm4uIFNvIHRvIGFjdHVhbGx5CmdldCBhbm90aGVyIGpvYiAoaWYgb25l
IGV4aXN0cykgdGhlIHRpbWVvdXQgaGFzIHRvIGJlIHJlc3RhcnRlZC4KCkl0J3MgYWxzbyBuZWNl
c3NhcnkgdG8gcmVzdGFydCB0aGUgdGltZW91dCBpbiB0aGUgY2FzZSB3aGVyZSB0aGUgcmV0dXJu
CmlzIE5VTEwgd2hpY2ggaXMgaGFuZGxlZCBpbiB0aGUgZnVuY3Rpb24gaXRzZWxmLgoKVEJIIEkn
bSBub3Qgc3VyZSB3aGV0aGVyIHRoaXMgd2hpbGUgbG9vcCBpcyB3b3J0aCBpdCAtIGl0IG1heSBi
ZSBiZXR0ZXIKdG8gcmVwbGFjZSBpdCB3aXRoIHNpbXBseToKCglpZiAoY2xlYW51cF9qb2IpIHsK
CQlzY2hlZC0+b3BzLT5mcmVlX2pvYihjbGVhbnVwX2pvYik7CgkJLyogcXVldWUgdGltZW91dCBm
b3IgbmV4dCBqb2IgKi8KCQlkcm1fc2NoZWRfc3RhcnRfdGltZW91dChzY2hlZCk7Cgl9CgpUaGUg
b3V0ZXIgbG9vcCB3b3VsZCB0aGVuIGhhbmRsZSB0aGUgbmV4dCBjYWxsIHRvCmRybV9zY2hlZF9n
ZXRfY2xlYW51cF9qb2IoKSBhcyBuZWNlc3NhcnkuCgpTdGV2ZQpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
