Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 43D459D21A
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 16:57:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9CE6389F9F;
	Mon, 26 Aug 2019 14:57:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 951B589F8E
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 14:57:37 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id d16so16186977wme.2
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 07:57:37 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=qr169mH//wra/FZqs+J4o27Nb6o+9jXbc+hUaCfBlw4=;
 b=lQlwF+5p8s6sFMN4BamidSJ+Effq0Kw4lExwAyKACO7eeqJH0t2CT8WwcZZuqql1c9
 CPyQultUU6/P/K1Mmyt5pntZd1alRWk5CgbUo7Fzh14P1iKPWMxEDZgYn9IrBtpVEqbm
 JntvHhDF6U4d9/3E38hdZugv847kVPrwCZbYZhnT0xty6X+K0z0Ta0J2f18MPyUGqWda
 DI2/EQiP7ON2fD2R/9Q26OZio9dJSVOAuVawQoARnqE+wg1NkgCYeLpT79OnTbmu8+kH
 RBkMagzVOeF3JKRHpKPFRmTtV4Gd7ZMpn2dwon2o1pxouxsAP0q7Fbfw2cAyOO6zJvsE
 30Ug==
X-Gm-Message-State: APjAAAW5OiJgmlWYFnAeqGhbLxQ95yMzOZ8WpzFBfl7D66zMRzZvv8QQ
 +b7m3du0qELaVSXGfooXW78vHaz9
X-Google-Smtp-Source: APXvYqzFxm4esv8qKesGZ4Tdm/WpDilocSgmZtylyZpEHX20jb8O8/75GCGIRX/unVlHYPjWvOPBZQ==
X-Received: by 2002:a1c:9855:: with SMTP id a82mr20621083wme.134.1566831455779; 
 Mon, 26 Aug 2019 07:57:35 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:b0e3:7a12:98e5:ca6])
 by smtp.gmail.com with ESMTPSA id z8sm9865624wmi.7.2019.08.26.07.57.35
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 26 Aug 2019 07:57:35 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, chris@chris-wilson.co.uk,
 daniel.vetter@ffwll.ch, sumit.semwal@linaro.org,
 linux-media@vger.kernel.org, linaro-mm-sig@lists.linaro.org
Subject: [PATCH 3/9] dma-buf: add dma_fence_array_alloc/free
Date: Mon, 26 Aug 2019 16:57:25 +0200
Message-Id: <20190826145731.1725-4-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190826145731.1725-1-christian.koenig@amd.com>
References: <20190826145731.1725-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=qr169mH//wra/FZqs+J4o27Nb6o+9jXbc+hUaCfBlw4=;
 b=DN08kfxDmiApfFOUjNg4DxrMasEDzd3NSBjAJhBviJhds/xOhYATXNq+PE2la3Mzor
 UfTMpdovsAcAwxfVri2QWktL9nWhnIoJdAibNVh7jZpu5Lv+gkLdXGMiBt2gaBw5sSkk
 9LzcqEt4z5izEWW0up+u2rkz+U57AoZsClfYrgYafEmgxDPT5clqUHk4rCrdvcoTdH9V
 U1Y3xFAdEtjFhmXJSjydKfrh0ZMAfPvBxbzu9Y7/vU3lsyZnQ7XV5idPDtofXBcNPCUN
 xNAk58/9NvrR9ElsIlcI/vWCK74iEjeBLeXj3kRb4JSYCfCUmm6g+xAp/P9szoq+bQr2
 HkFQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBzZXBlcmF0ZXMgYWxsb2NhdGlvbiBhbmQgaW5pdGlhbGl6YXRpb24gb2YgdGhlIGRtYV9m
ZW5jZV9hcnJheSBvYmplY3QKYW5kIGFsbG93cyBhbGxvY2F0aW5nIHRoZSBmZW5jZSBhcnJheSB0
b2dldGhlciB3aXRoIHRoZSBkbWFfZmVuY2VfYXJyYXkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3Rp
YW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9kbWEtYnVm
L2RtYS1mZW5jZS1hcnJheS5jIHwgMTAxICsrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLQog
aW5jbHVkZS9saW51eC9kbWEtZmVuY2UtYXJyYXkuaCAgIHwgIDUwICsrKysrKysrKysrKystLQog
MiBmaWxlcyBjaGFuZ2VkLCAxMTUgaW5zZXJ0aW9ucygrKSwgMzYgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1hcnJheS5jIGIvZHJpdmVycy9kbWEt
YnVmL2RtYS1mZW5jZS1hcnJheS5jCmluZGV4IDUyMDY4ZWU1ZWIzNS4uNDY2NDYwN2YwYWJjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLWFycmF5LmMKKysrIGIvZHJpdmVy
cy9kbWEtYnVmL2RtYS1mZW5jZS1hcnJheS5jCkBAIC0xMTksMTQgKzExOSw3IEBAIHN0YXRpYyBi
b29sIGRtYV9mZW5jZV9hcnJheV9zaWduYWxlZChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIAog
c3RhdGljIHZvaWQgZG1hX2ZlbmNlX2FycmF5X3JlbGVhc2Uoc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UpCiB7Ci0Jc3RydWN0IGRtYV9mZW5jZV9hcnJheSAqYXJyYXkgPSB0b19kbWFfZmVuY2VfYXJy
YXkoZmVuY2UpOwotCXVuc2lnbmVkIGk7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgYXJyYXktPm51bV9m
ZW5jZXM7ICsraSkKLQkJZG1hX2ZlbmNlX3B1dChhcnJheS0+ZmVuY2VzW2ldKTsKLQotCWtmcmVl
KGFycmF5LT5mZW5jZXMpOwotCWRtYV9mZW5jZV9mcmVlKGZlbmNlKTsKKwlkbWFfZmVuY2VfYXJy
YXlfZnJlZShjb250YWluZXJfb2YoZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2VfYXJyYXksIGJhc2Up
KTsKIH0KIAogY29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMgZG1hX2ZlbmNlX2FycmF5X29wcyA9
IHsKQEAgLTEzOSw1MiArMTMyLDk2IEBAIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIGRtYV9m
ZW5jZV9hcnJheV9vcHMgPSB7CiBFWFBPUlRfU1lNQk9MKGRtYV9mZW5jZV9hcnJheV9vcHMpOwog
CiAvKioKLSAqIGRtYV9mZW5jZV9hcnJheV9jcmVhdGUgLSBDcmVhdGUgYSBjdXN0b20gZmVuY2Ug
YXJyYXkKKyAqIGRtYV9mZW5jZV9hcnJheV9hbGxvYyAtIEFsbG9jYXRlIGEgY3VzdG9tIGZlbmNl
IGFycmF5CiAgKiBAbnVtX2ZlbmNlczoJCVtpbl0JbnVtYmVyIG9mIGZlbmNlcyB0byBhZGQgaW4g
dGhlIGFycmF5Ci0gKiBAZmVuY2VzOgkJW2luXQlhcnJheSBjb250YWluaW5nIHRoZSBmZW5jZXMK
LSAqIEBjb250ZXh0OgkJW2luXQlmZW5jZSBjb250ZXh0IHRvIHVzZQotICogQHNlcW5vOgkJW2lu
XQlzZXF1ZW5jZSBudW1iZXIgdG8gdXNlCi0gKiBAc2lnbmFsX29uX2FueToJW2luXQlzaWduYWwg
b24gYW55IGZlbmNlIGluIHRoZSBhcnJheQorICogQGZlbmNlczoJCVtpbl0Jb3B0aW9uYWwgYXJy
YXkgY29udGFpbmluZyB0aGUgZmVuY2VzCiAgKgotICogQWxsb2NhdGUgYSBkbWFfZmVuY2VfYXJy
YXkgb2JqZWN0IGFuZCBpbml0aWFsaXplIHRoZSBiYXNlIGZlbmNlIHdpdGgKLSAqIGRtYV9mZW5j
ZV9pbml0KCkuCi0gKiBJbiBjYXNlIG9mIGVycm9yIGl0IHJldHVybnMgTlVMTC4KKyAqIEFsbG9j
YXRlIGEgZG1hX2ZlbmNlX2FycmF5IG9iamVjdCwgaW4gY2FzZSBvZiBlcnJvciBpdCByZXR1cm5z
IE5VTEwuCiAgKgotICogVGhlIGNhbGxlciBzaG91bGQgYWxsb2NhdGUgdGhlIGZlbmNlcyBhcnJh
eSB3aXRoIG51bV9mZW5jZXMgc2l6ZQotICogYW5kIGZpbGwgaXQgd2l0aCB0aGUgZmVuY2VzIGl0
IHdhbnRzIHRvIGFkZCB0byB0aGUgb2JqZWN0LiBPd25lcnNoaXAgb2YgdGhpcwotICogYXJyYXkg
aXMgdGFrZW4gYW5kIGRtYV9mZW5jZV9wdXQoKSBpcyB1c2VkIG9uIGVhY2ggZmVuY2Ugb24gcmVs
ZWFzZS4KLSAqCi0gKiBJZiBAc2lnbmFsX29uX2FueSBpcyB0cnVlIHRoZSBmZW5jZSBhcnJheSBz
aWduYWxzIGlmIGFueSBmZW5jZSBpbiB0aGUgYXJyYXkKLSAqIHNpZ25hbHMsIG90aGVyd2lzZSBp
dCBzaWduYWxzIHdoZW4gYWxsIGZlbmNlcyBpbiB0aGUgYXJyYXkgc2lnbmFsLgorICogVGhlIGZl
bmNlcyBhcnJheSBpcyBvcHRpb25hbCBhbmQgaWYgTlVMTCBhbGxvY2F0ZWQgdG9nZXRoZXIgd2l0
aCB0aGUKKyAqIGRtYV9mZW5jZV9hcnJheSBvYmplY3QuCiAgKi8KLXN0cnVjdCBkbWFfZmVuY2Vf
YXJyYXkgKmRtYV9mZW5jZV9hcnJheV9jcmVhdGUoaW50IG51bV9mZW5jZXMsCi0JCQkJCSAgICAg
ICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2VzLAotCQkJCQkgICAgICAgdTY0IGNvbnRleHQsIHVu
c2lnbmVkIHNlcW5vLAotCQkJCQkgICAgICAgYm9vbCBzaWduYWxfb25fYW55KQorc3RydWN0IGRt
YV9mZW5jZV9hcnJheSAqZG1hX2ZlbmNlX2FycmF5X2FsbG9jKGludCBudW1fZmVuY2VzLAorCQkJ
CQkgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2VzKQogewogCXN0cnVjdCBkbWFfZmVuY2Vf
YXJyYXkgKmFycmF5OwogCXNpemVfdCBzaXplID0gc2l6ZW9mKCphcnJheSk7CiAKIAkvKiBBbGxv
Y2F0ZSB0aGUgY2FsbGJhY2sgc3RydWN0dXJlcyBiZWhpbmQgdGhlIGFycmF5LiAqLwogCXNpemUg
Kz0gbnVtX2ZlbmNlcyAqIHNpemVvZihzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5X2NiKTsKKworCS8q
IEFsbG9jYXRlIHRoZSBmZW5jZXMgc3RydWN0dXJlcyBiZWhpbmQgdGhlIGNhbGxiYWNrcyAqLwor
CWlmICghZmVuY2VzKQorCQlzaXplICs9IG51bV9mZW5jZXMgKiBzaXplb2Yoc3RydWN0IGRtYV9m
ZW5jZSAqKTsKKwogCWFycmF5ID0ga3phbGxvYyhzaXplLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWFy
cmF5KQogCQlyZXR1cm4gTlVMTDsKIAorCWlmICghZmVuY2VzKSB7CisJCXN0cnVjdCBkbWFfZmVu
Y2VfYXJyYXlfY2IgKmNiID0gKHZvaWQgKikoJmFycmF5WzFdKTsKKworCQludW1fZmVuY2VzID0g
ZG1hX2ZlbmNlX2FycmF5X21heF9mZW5jZXMoYXJyYXkpOworCQlmZW5jZXMgPSAodm9pZCAqKSgm
Y2JbbnVtX2ZlbmNlc10pOworCX0KKwlhcnJheS0+ZmVuY2VzID0gZmVuY2VzOworCXJldHVybiBh
cnJheTsKK30KK0VYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX2FycmF5X2FsbG9jKTsKKworLyoqCisg
KiBkbWFfZmVuY2VfYXJyYXlfaW5pdCAtIGluaXQgYSBjdXN0b20gZmVuY2UgYXJyYXkKKyAqIEBh
cnJheToJCVtpbl0JdGhlIHByZS1hbGxvY2F0ZWQgYXJyYXkgdG8gaW5pdAorICogQGNvbnRleHQ6
CQlbaW5dCWZlbmNlIGNvbnRleHQgdG8gdXNlCisgKiBAc2Vxbm86CQlbaW5dCXNlcXVlbmNlIG51
bWJlciB0byB1c2UKKyAqIEBzaWduYWxfb25fYW55OglbaW5dCXNpZ25hbCBvbiBhbnkgZmVuY2Ug
aW4gdGhlIGFycmF5CisgKgorICogSW5pdGlhbGl6ZSB0aGUgYmFzZSBmZW5jZSB3aXRoIGRtYV9m
ZW5jZV9pbml0KCkuCisgKgorICogVGhlIGNhbGxlciBzaG91bGQgYWxsb2NhdGUgdGhlIGZlbmNl
cyBhcnJheSB3aXRoIG51bV9mZW5jZXMgc2l6ZQorICogYW5kIGZpbGwgaXQgd2l0aCB0aGUgZmVu
Y2VzIGl0IHdhbnRzIHRvIGFkZCB0byB0aGUgb2JqZWN0LiBPd25lcnNoaXAgb2YgdGhpcworICog
YXJyYXkgaXMgdGFrZW4gYW5kIGRtYV9mZW5jZV9wdXQoKSBpcyB1c2VkIG9uIGVhY2ggZmVuY2Ug
b24gcmVsZWFzZS4KKyAqCisgKiBJZiBAc2lnbmFsX29uX2FueSBpcyB0cnVlIHRoZSBmZW5jZSBh
cnJheSBzaWduYWxzIGlmIGFueSBmZW5jZSBpbiB0aGUgYXJyYXkKKyAqIHNpZ25hbHMsIG90aGVy
d2lzZSBpdCBzaWduYWxzIHdoZW4gYWxsIGZlbmNlcyBpbiB0aGUgYXJyYXkgc2lnbmFsLgorICov
Cit2b2lkIGRtYV9mZW5jZV9hcnJheV9pbml0KHN0cnVjdCBkbWFfZmVuY2VfYXJyYXkgKmFycmF5
LCB1NjQgY29udGV4dCwKKwkJCSAgdW5zaWduZWQgaW50IHNlcW5vLCBib29sIHNpZ25hbF9vbl9h
bnkpCit7CiAJc3Bpbl9sb2NrX2luaXQoJmFycmF5LT5sb2NrKTsKIAlkbWFfZmVuY2VfaW5pdCgm
YXJyYXktPmJhc2UsICZkbWFfZmVuY2VfYXJyYXlfb3BzLCAmYXJyYXktPmxvY2ssCiAJCSAgICAg
ICBjb250ZXh0LCBzZXFubyk7CiAJaW5pdF9pcnFfd29yaygmYXJyYXktPndvcmssIGlycV9kbWFf
ZmVuY2VfYXJyYXlfd29yayk7CiAKLQlhcnJheS0+bnVtX2ZlbmNlcyA9IG51bV9mZW5jZXM7Ci0J
YXRvbWljX3NldCgmYXJyYXktPm51bV9wZW5kaW5nLCBzaWduYWxfb25fYW55ID8gMSA6IG51bV9m
ZW5jZXMpOwotCWFycmF5LT5mZW5jZXMgPSBmZW5jZXM7Ci0KKwlhdG9taWNfc2V0KCZhcnJheS0+
bnVtX3BlbmRpbmcsIHNpZ25hbF9vbl9hbnkgPyAxIDogYXJyYXktPm51bV9mZW5jZXMpOwogCWFy
cmF5LT5iYXNlLmVycm9yID0gUEVORElOR19FUlJPUjsKK30KK0VYUE9SVF9TWU1CT0woZG1hX2Zl
bmNlX2FycmF5X2luaXQpOwogCi0JcmV0dXJuIGFycmF5OworLyoqCisgKiBkbWFfZmVuY2VfYXJy
YXlfZnJlZSAtIGZyZWUgYSBkbWFfZmVuY2VfYXJyYXkgb2JqZWN0CisgKiBAYXJyYXk6IHRoZSBv
YmplY3QgdG8gZnJlZQorICoKKyAqIFRoZSBhIGRtYV9mZW5jZV9hcnJheSBhbmQgZHJvcCBhbGwg
cmVmZXJlbmNlcyB0byB0aGUgZmVuY2VzIGl0IGNvbnRhaW5zLgorICovCit2b2lkIGRtYV9mZW5j
ZV9hcnJheV9mcmVlKHN0cnVjdCBkbWFfZmVuY2VfYXJyYXkgKmFycmF5KQoreworCXVuc2lnbmVk
IGk7CisKKwlpZiAoIWFycmF5KQorCQlyZXR1cm47CisKKwlmb3IgKGkgPSAwOyBpIDwgYXJyYXkt
Pm51bV9mZW5jZXM7ICsraSkKKwkJZG1hX2ZlbmNlX3B1dChhcnJheS0+ZmVuY2VzW2ldKTsKKwor
CS8qIENoZWNrIGlmIGZlbmNlcyBhcmUgcGFydCBvZiB0aGUgYXJyYXkgKi8KKwlpZiAoKHU4ICop
YXJyYXktPmZlbmNlcyA8ICh1OCAqKWFycmF5IHx8CisJICAgICh1OCAqKWFycmF5LT5mZW5jZXMg
PiAoKHU4ICopYXJyYXkpICsga3NpemUoYXJyYXkpKQorCQlrZnJlZShhcnJheS0+ZmVuY2VzKTsK
KworCWRtYV9mZW5jZV9mcmVlKCZhcnJheS0+YmFzZSk7CiB9Ci1FWFBPUlRfU1lNQk9MKGRtYV9m
ZW5jZV9hcnJheV9jcmVhdGUpOworRVhQT1JUX1NZTUJPTChkbWFfZmVuY2VfYXJyYXlfZnJlZSk7
CiAKIC8qKgogICogZG1hX2ZlbmNlX21hdGNoX2NvbnRleHQgLSBDaGVjayBpZiBhbGwgZmVuY2Vz
IGFyZSBmcm9tIHRoZSBnaXZlbiBjb250ZXh0CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2Rt
YS1mZW5jZS1hcnJheS5oIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UtYXJyYXkuaAppbmRleCBm
OTljZDdlYjI0ZTAuLmJlODVjMDZiNTI0ZCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9kbWEt
ZmVuY2UtYXJyYXkuaAorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS1hcnJheS5oCkBAIC0x
NCw2ICsxNCw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UuaD4KICNpbmNsdWRlIDxs
aW51eC9pcnFfd29yay5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KIAogLyoqCiAgKiBzdHJ1
Y3QgZG1hX2ZlbmNlX2FycmF5X2NiIC0gY2FsbGJhY2sgaGVscGVyIGZvciBmZW5jZSBhcnJheQpA
QCAtNzQsMTAgKzc1LDUxIEBAIHRvX2RtYV9mZW5jZV9hcnJheShzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZSkKIAlyZXR1cm4gY29udGFpbmVyX29mKGZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5
LCBiYXNlKTsKIH0KIAotc3RydWN0IGRtYV9mZW5jZV9hcnJheSAqZG1hX2ZlbmNlX2FycmF5X2Ny
ZWF0ZShpbnQgbnVtX2ZlbmNlcywKLQkJCQkJICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKipmZW5j
ZXMsCi0JCQkJCSAgICAgICB1NjQgY29udGV4dCwgdW5zaWduZWQgc2Vxbm8sCi0JCQkJCSAgICAg
ICBib29sIHNpZ25hbF9vbl9hbnkpOworLyoqCisgKiBkbWFfZmVuY2VfYXJyYXlfbWF4X2ZlbmNl
cyAtIGNhbGN1bGF0ZSBtYXhpbXVtIG51bWJlciBvZiBmZW5jZXMKKyAqIEBhcnJheToJW2luXQl0
aGUgZG1hX2ZlbmNlX2FycmF5IHRvIHVzZQorICoKKyAqIFJldHVybnMgdGhlIG1heGltdW0gbnVt
YmVyIG9mIGZlbmNlcyBhIGRtYV9mZW5jZV9hcnJheSBjYW4gc3RvcmUuCisgKi8KK3N0YXRpYyBp
bmxpbmUgdW5zaWduZWQgaW50CitkbWFfZmVuY2VfYXJyYXlfbWF4X2ZlbmNlcyhzdHJ1Y3QgZG1h
X2ZlbmNlX2FycmF5ICphcnJheSkKK3sKKwlyZXR1cm4gKGtzaXplKGFycmF5KSAtIHNpemVvZigq
YXJyYXkpKSAvCisJCShzaXplb2Yoc3RydWN0IGRtYV9mZW5jZV9hcnJheV9jYikgKworCQkgc2l6
ZW9mKHN0cnVjdCBkbWFfZmVuY2UgKikpOworfQorCitzdHJ1Y3QgZG1hX2ZlbmNlX2FycmF5ICpk
bWFfZmVuY2VfYXJyYXlfYWxsb2MoaW50IG51bV9mZW5jZXMsCisJCQkJCSAgICAgIHN0cnVjdCBk
bWFfZmVuY2UgKipmZW5jZXMpOwordm9pZCBkbWFfZmVuY2VfYXJyYXlfaW5pdChzdHJ1Y3QgZG1h
X2ZlbmNlX2FycmF5ICphcnJheSwgdTY0IGNvbnRleHQsCisJCQkgIHVuc2lnbmVkIGludCBzZXFu
bywgYm9vbCBzaWduYWxfb25fYW55KTsKK3ZvaWQgZG1hX2ZlbmNlX2FycmF5X2ZyZWUoc3RydWN0
IGRtYV9mZW5jZV9hcnJheSAqYXJyYXkpOworCisvKioKKyAqIGRtYV9mZW5jZV9hcnJheV9jcmVh
dGUgLSBDcmVhdGUgYSBjdXN0b20gZmVuY2UgYXJyYXkKKyAqIEBudW1fZmVuY2VzOgkJW2luXQlu
dW1iZXIgb2YgZmVuY2VzIHRvIGFkZCBpbiB0aGUgYXJyYXkKKyAqIEBmZW5jZXM6CQlbaW5dCWFy
cmF5IGNvbnRhaW5pbmcgdGhlIGZlbmNlcworICogQGNvbnRleHQ6CQlbaW5dCWZlbmNlIGNvbnRl
eHQgdG8gdXNlCisgKiBAc2Vxbm86CQlbaW5dCXNlcXVlbmNlIG51bWJlciB0byB1c2UKKyAqIEBz
aWduYWxfb25fYW55OglbaW5dCXNpZ25hbCBvbiBhbnkgZmVuY2UgaW4gdGhlIGFycmF5CisgKgor
ICogV3JhcHBlciBhcm91bmQgZG1hX2ZlbmNlX2FycmF5X2FsbG9jIGFuZCBkbWFfZmVuY2VfYXJy
YXlfaW5pdC4gUmV0dXJucyBOVUxMCisgKiBvbiBhbGxvY2F0aW9uIGZhaWx1cmUuCisgKi8KK3N0
YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9mZW5jZV9hcnJheSAqCitkbWFfZmVuY2VfYXJyYXlfY3Jl
YXRlKGludCBudW1fZmVuY2VzLCBzdHJ1Y3QgZG1hX2ZlbmNlICoqZmVuY2VzLCB1NjQgY29udGV4
dCwKKwkJICAgICAgIHVuc2lnbmVkIHNlcW5vLCBib29sIHNpZ25hbF9vbl9hbnkpCit7CisJc3Ry
dWN0IGRtYV9mZW5jZV9hcnJheSAqYXJyYXk7CisKKwlhcnJheSA9IGRtYV9mZW5jZV9hcnJheV9h
bGxvYyhudW1fZmVuY2VzLCBmZW5jZXMpOworCWlmICghYXJyYXkpCisJCXJldHVybiBOVUxMOwor
CisJYXJyYXktPm51bV9mZW5jZXMgPSBudW1fZmVuY2VzOworCWRtYV9mZW5jZV9hcnJheV9pbml0
KGFycmF5LCBjb250ZXh0LCBzZXFubywgc2lnbmFsX29uX2FueSk7CisJcmV0dXJuIGFycmF5Owor
fQogCiBib29sIGRtYV9mZW5jZV9tYXRjaF9jb250ZXh0KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
LCB1NjQgY29udGV4dCk7CiAKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
