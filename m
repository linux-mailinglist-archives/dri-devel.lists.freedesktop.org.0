Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F1E1A27567B
	for <lists+dri-devel@lfdr.de>; Wed, 23 Sep 2020 12:37:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 516F96E92E;
	Wed, 23 Sep 2020 10:37:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-oi1-x244.google.com (mail-oi1-x244.google.com
 [IPv6:2607:f8b0:4864:20::244])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8A9326E92E
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Sep 2020 10:37:38 +0000 (UTC)
Received: by mail-oi1-x244.google.com with SMTP id t76so24508686oif.7
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Sep 2020 03:37:38 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=dfS8bSS+06hQE0qWnnZuaBFQQAdqVz3IqVwpKRDCHi4=;
 b=fdMqx/PkNamM0iR2p4y+nAVBhBRk2izzUD8jjwAQvU1Mt9sT1BlqJc0Llhetghe/ke
 UJF4BqMJXdhqrw3E9Fw0hFvKbqf147kDxce/Jdb+Q/bN/tsr6oToxkjK8Ot5SniCWW9A
 6ahBUoAQz0OHbqRA9LVDBWqKAkeCkjqAq2s+s=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=dfS8bSS+06hQE0qWnnZuaBFQQAdqVz3IqVwpKRDCHi4=;
 b=oGcIy7wrrnTyMyV0RVBuicptkieLy2pAxaj2hH4YoguLq1pldb7zSYZTdjViVBSe6p
 he6aGjRxtWyNHyMCJr0L5km0c6U6ZxsNIMGgLZuXD1FefjNJgGK7nRTHuxu9tky/Pl5X
 BHvbmTWqr9Epz8cST2N77nlzjbfOuJVypaPnuIBYXIMLzzCVBhqVZSK65+U7civTj/9e
 NT3FbdRv9HzBYK0JpHXJZ7yu45PtSKtwNKyZyzC0WR2kW06vaYp1/u65uBiPDoOCevJI
 OyNU3hQmXa4So6APiU+S1Pzj2H/6qcpUSy6MXqpOEa0vpaPakGpdHIgMqZ2KUhiRFkIu
 oZmA==
X-Gm-Message-State: AOAM5321rdNksLjSBPikBMsz4s3b/D+TS71PHOGRPENyXdA8ac+WUmIK
 pH+aLcpFdZYEI3tKvz/a7OIK/YNr4iOwAVdgoXW8uA==
X-Google-Smtp-Source: ABdhPJzm7c/PQ1BnKzYSqD/qfo0Dr76BNXmMMj54WAHw/w0fqE+27e0DMaEypfmUh7IFVmd7azxeyLv7MDuHy/bABfk=
X-Received: by 2002:aca:6083:: with SMTP id u125mr5345464oib.14.1600857457879; 
 Wed, 23 Sep 2020 03:37:37 -0700 (PDT)
MIME-Version: 1.0
References: <20200922181834.2913552-1-daniel.vetter@ffwll.ch>
 <20200923103137.GD6112@intel.com>
In-Reply-To: <20200923103137.GD6112@intel.com>
From: Daniel Vetter <daniel.vetter@ffwll.ch>
Date: Wed, 23 Sep 2020 12:37:26 +0200
Message-ID: <CAKMK7uEEv1w2D1NYzuU-m-UkseHgBy45-93wK2oEQdayD5CH5A@mail.gmail.com>
Subject: Re: [PATCH] drm: document and enforce rules around "spurious" EBUSY
 from atomic_commit
To: =?UTF-8?B?VmlsbGUgU3lyasOkbMOk?= <ville.syrjala@linux.intel.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: DRI Development <dri-devel@lists.freedesktop.org>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 stable <stable@vger.kernel.org>, Daniel Vetter <daniel.vetter@intel.com>,
 Pekka Paalanen <pekka.paalanen@collabora.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gV2VkLCBTZXAgMjMsIDIwMjAgYXQgMTI6MzEgUE0gVmlsbGUgU3lyasOkbMOkCjx2aWxsZS5z
eXJqYWxhQGxpbnV4LmludGVsLmNvbT4gd3JvdGU6Cj4KPiBPbiBUdWUsIFNlcCAyMiwgMjAyMCBh
dCAwODoxODozNFBNICswMjAwLCBEYW5pZWwgVmV0dGVyIHdyb3RlOgo+ID4gV2hlbiBkb2luZyBh
biBhdG9taWMgbW9kZXNldCB3aXRoIEFMTE9XX01PREVTRVQgZHJpdmVycyBhcmUgYWxsb3dlZCB0
bwo+ID4gcHVsbCBpbiBhcmJpdHJhcnkgb3RoZXIgcmVzb3VyY2VzLCBpbmNsdWRpbmcgQ1JUQ3Mg
KGUuZy4gd2hlbgo+ID4gcmVjb25maWd1cmluZyBnbG9iYWwgcmVzb3VyY2VzKS4KPiA+Cj4gPiBC
dXQgaW4gbm9uYmxvY2tpbmcgbW9kZSB1c2Vyc3BhY2UgaGFzIHRoZW4gbm8gaWRlYSB0aGlzIGhh
cHBlbmVkLAo+ID4gd2hpY2ggY2FuIGxlYWQgdG8gc3B1cmlvdXMgRUJVU1kgY2FsbHMsIGJvdGg6
Cj4gPiAtIHdoZW4gdGhhdCBvdGhlciBDUlRDIGlzIGN1cnJlbnRseSBidXN5IGRvaW5nIGEgcGFn
ZV9mbGlwIHRoZQo+ID4gICBBTExPV19NT0RFU0VUIGNvbW1pdCBjYW4gZmFpbCB3aXRoIGFuIEVC
VVNZCj4gPiAtIG9uIHRoZSBvdGhlciBDUlRDIGEgbm9ybWFsIGF0b21pYyBmbGlwIGNhbiBmYWls
IHdpdGggRUJVU1kgYmVjYXVzZQo+ID4gICBvZiB0aGUgYWRkaXRpb25hbCBjb21taXQgaW5zZXJ0
ZWQgYnkgdGhlIGtlcm5lbCB3aXRob3V0IHVzZXJzcGFjZSdzCj4gPiAgIGtub3dsZWRnZQo+ID4K
PiA+IEZvciBibG9ja2luZyBjb21taXRzIHRoaXMgaXNuJ3QgYSBwcm9ibGVtLCBiZWNhdXNlIGV2
ZXJ5b25lIGVsc2Ugd2lsbAo+ID4ganVzdCBibG9jayB1bnRpbCBhbGwgdGhlIENSVEMgYXJlIHJl
Y29uZmlndXJlZC4gT25seSB0aGluZyB1c2Vyc3BhY2UKPiA+IGNhbiBub3RpY2UgaXMgdGhlIGRy
b3BwZWQgZnJhbWVzIHdpdGhvdXQgYW55IHJlYXNvbiBmb3Igd2h5IGZyYW1lcyBnb3QKPiA+IGRy
b3BwZWQuCj4gPgo+ID4gQ29uc2Vuc3VzIGlzIHRoYXQgd2UgbmVlZCBuZXcgdWFwaSB0byBoYW5k
bGUgdGhpcyBwcm9wZXJseSwgYnV0IG5vIG9uZQo+ID4gaGFzIGFueSBpZGVhIHdoYXQgZXhhY3Rs
eSB0aGUgbmV3IHVhcGkgc2hvdWxkIGxvb2sgbGlrZS4gU2luY2UgdGhpcwo+ID4gaGFzIGJlZW4g
c2hpcHBpbmcgZm9yIHllYXJzIGFscmVhZHkgY29tcG9zaXRvcnMgbmVlZCB0byBkZWFsIG5vIG1h
dHRlcgo+ID4gd2hhdCwgc28gYXMgYSBmaXJzdCBzdGVwIGp1c3QgdHJ5IHRvIGVuZm9yY2UgdGhp
cyBhY3Jvc3MgZHJpdmVycwo+ID4gYmV0dGVyIHdpdGggc29tZSBjaGVja3MuCj4gPgo+ID4gdjI6
IEFkZCBjb21tZW50cyBhbmQgYSBXQVJOX09OIHRvIGVuZm9yY2UgdGhpcyBvbmx5IHdoZW4gYWxs
b3dlZCAtIHdlCj4gPiBkb24ndCB3YW50IHRvIHNpbGVudGx5IGNvbnZlcnQgcGFnZSBmbGlwcyBp
bnRvIGJsb2NraW5nIHBsYW5lIHVwZGF0ZXMKPiA+IGp1c3QgYmVjYXVzZSB0aGUgZHJpdmVyIGlz
IGJ1Z2d5Lgo+ID4KPiA+IHYzOiBGaXggaW52ZXJ0ZWQgV0FSTl9PTiAoUGVra2EpLgo+ID4KPiA+
IHY0OiBEcm9wIHRoZSB1YXBpIGNoYW5nZXMsIG9ubHkgYWRkIGEgV0FSTl9PTiBmb3Igbm93IHRv
IGVuZm9yY2Ugc29tZQo+ID4gcnVsZXMgZm9yIGRyaXZlcnMuCj4gPgo+ID4gUmVmZXJlbmNlczog
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvYXJjaGl2ZXMvZHJpLWRldmVsLzIwMTgtSnVs
eS8xODIyODEuaHRtbAo+ID4gQnVnemlsbGE6IGh0dHBzOi8vZ2l0bGFiLmZyZWVkZXNrdG9wLm9y
Zy93YXlsYW5kL3dlc3Rvbi9pc3N1ZXMvMjQjbm90ZV85NTY4Cj4gPiBDYzogRGFuaWVsIFN0b25l
IDxkYW5pZWxAZm9vaXNoYmFyLm9yZz4KPiA+IENjOiBQZWtrYSBQYWFsYW5lbiA8cGVra2EucGFh
bGFuZW5AY29sbGFib3JhLmNvLnVrPgo+ID4gQ2M6IFNpbW9uIFNlciA8Y29udGFjdEBlbWVyc2lv
bi5mcj4KPiA+IENjOiBzdGFibGVAdmdlci5rZXJuZWwub3JnCj4gPiBDYzogVmlsbGUgU3lyasOk
bMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KPiA+IFNpZ25lZC1vZmYtYnk6IERh
bmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAaW50ZWwuY29tPgo+ID4gLS0tCj4gPiAgZHJpdmVy
cy9ncHUvZHJtL2RybV9hdG9taWMuYyB8IDI3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKwo+
ID4gIDEgZmlsZSBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspCj4gPgo+ID4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21p
Yy5jCj4gPiBpbmRleCA1ODUyN2YxNTE5ODQuLmVmMTA2ZTcxNTNhNiAxMDA2NDQKPiA+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKPiA+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fYXRvbWljLmMKPiA+IEBAIC0yODEsNiArMjgxLDEwIEBAIEVYUE9SVF9TWU1CT0woX19kcm1f
YXRvbWljX3N0YXRlX2ZyZWUpOwo+ID4gICAqIG5lZWRlZC4gSXQgd2lsbCBhbHNvIGdyYWIgdGhl
IHJlbGV2YW50IENSVEMgbG9jayB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc3RhdGUKPiA+ICAgKiBp
cyBjb25zaXN0ZW50Lgo+ID4gICAqCj4gPiArICogV0FSTklORzogRHJpdmVycyBtYXkgb25seSBh
ZGQgbmV3IENSVEMgc3RhdGVzIHRvIGEgQHN0YXRlIGlmCj4gPiArICogZHJtX2F0b21pY19zdGF0
ZS5hbGxvd19tb2Rlc2V0IGlzIHNldCwgb3IgaWYgaXQncyBhIGRyaXZlci1pbnRlcm5hbCBjb21t
aXQKPiA+ICsgKiBub3QgY3JlYXRlZCBieSB1c2Vyc3BhY2UgdGhyb3VnaCBhbiBJT0NUTCBjYWxs
Lgo+ID4gKyAqCj4gPiAgICogUmV0dXJuczoKPiA+ICAgKgo+ID4gICAqIEVpdGhlciB0aGUgYWxs
b2NhdGVkIHN0YXRlIG9yIHRoZSBlcnJvciBjb2RlIGVuY29kZWQgaW50byB0aGUgcG9pbnRlci4g
V2hlbgo+ID4gQEAgLTEyNjIsMTAgKzEyNjYsMTUgQEAgaW50IGRybV9hdG9taWNfY2hlY2tfb25s
eShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCj4gPiAgICAgICBzdHJ1Y3QgZHJtX2Ny
dGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOwo+ID4gICAgICAgc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm47Cj4gPiAgICAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsK
PiA+ICsgICAgIHVuc2lnbmVkIHJlcXVlc3RlZF9jcnRjID0gMDsKPiA+ICsgICAgIHVuc2lnbmVk
IGFmZmVjdGVkX2NydGMgPSAwOwo+ID4gICAgICAgaW50IGksIHJldCA9IDA7Cj4gPgo+ID4gICAg
ICAgRFJNX0RFQlVHX0FUT01JQygiY2hlY2tpbmcgJXBcbiIsIHN0YXRlKTsKPiA+Cj4gPiArICAg
ICBmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUs
IGkpCj4gPiArICAgICAgICAgICAgIHJlcXVlc3RlZF9jcnRjIHw9IGRybV9jcnRjX21hc2soY3J0
Yyk7Cj4gPiArCj4gPiAgICAgICBmb3JfZWFjaF9vbGRuZXdfcGxhbmVfaW5fc3RhdGUoc3RhdGUs
IHBsYW5lLCBvbGRfcGxhbmVfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSwgaSkgewo+ID4gICAgICAg
ICAgICAgICByZXQgPSBkcm1fYXRvbWljX3BsYW5lX2NoZWNrKG9sZF9wbGFuZV9zdGF0ZSwgbmV3
X3BsYW5lX3N0YXRlKTsKPiA+ICAgICAgICAgICAgICAgaWYgKHJldCkgewo+ID4gQEAgLTEzMTMs
NiArMTMyMiwyNCBAQCBpbnQgZHJtX2F0b21pY19jaGVja19vbmx5KHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSkKPiA+ICAgICAgICAgICAgICAgfQo+ID4gICAgICAgfQo+ID4KPiA+ICsg
ICAgIGZvcl9lYWNoX25ld19jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0
ZSwgaSkKPgo+IEluY29uc2lzdGVudCBvbGQgdnMuIG5ldy4KCldpbGwgZml4LCBidXQgYWxzbyBk
b2Vzbid0IG1hdHRlciBzaW5jZSBJIGRvbid0IGNhcmUgYWJvdXQgdGhlIHN0YXRlLApqdXN0IHRo
YXQgaXQncyBpbiB0aGVyZS4KCj4gPiArICAgICAgICAgICAgIGFmZmVjdGVkX2NydGMgfD0gZHJt
X2NydGNfbWFzayhjcnRjKTsKPiA+ICsKPiA+ICsgICAgIC8qCj4gPiArICAgICAgKiBGb3IgY29t
bWl0cyB0aGF0IGFsbG93IG1vZGVzZXRzIGRyaXZlcnMgY2FuIGFkZCBvdGhlciBDUlRDcyB0byB0
aGUKPiA+ICsgICAgICAqIGF0b21pYyBjb21taXQsIGUuZy4gd2hlbiB0aGV5IG5lZWQgdG8gcmVh
bGxvY2F0ZSBnbG9iYWwgcmVzb3VyY2VzLgo+ID4gKyAgICAgICogVGhpcyBjYW4gY2F1c2Ugc3B1
cmlvdXMgRUJVU1ksIHdoaWNoIHJvYnMgY29tcG9zaXRvcnMgb2YgYSB2ZXJ5Cj4gPiArICAgICAg
KiBlZmZlY3RpdmUgc2FuaXR5IGNoZWNrIGZvciB0aGVpciBkcmF3aW5nIGxvb3AuIFRoZXJlZm9y
IG9ubHkgYWxsb3cKPiA+ICsgICAgICAqIHRoaXMgZm9yIG1vZGVzZXQgY29tbWl0cy4KPiA+ICsg
ICAgICAqCj4gPiArICAgICAgKiBGSVhNRTogU2hvdWxkIGFkZCBhZmZlY3RlZF9jcnRjIG1hc2sg
dG8gdGhlIEFUT01JQyBJT0NUTCBhcyBhbiBvdXRwdXQKPiA+ICsgICAgICAqIHNvIGNvbXBvc2l0
b3JzIGtub3cgd2hhdCdzIGdvaW5nIG9uLgo+ID4gKyAgICAgICovCj4gPiArICAgICBpZiAoYWZm
ZWN0ZWRfY3J0YyAhPSByZXF1ZXN0ZWRfY3J0Yykgewo+ID4gKyAgICAgICAgICAgICAvKiBhZGRp
bmcgb3RoZXIgQ1JUQyBpcyBvbmx5IGFsbG93ZWQgZm9yIG1vZGVzZXQgY29tbWl0cyAqLwo+ID4g
KyAgICAgICAgICAgICBXQVJOX09OKCFzdGF0ZS0+YWxsb3dfbW9kZXNldCk7Cj4gPiArICAgICB9
Cj4KPiBJIHRoaW5rIHRoaXMgbWVhbnMgcHJldHR5IG11Y2ggYWxsIG5vbi1wYWdlZmxpcCBjb21t
aXRzIHdpbGwKPiBoYXZlIHRvIGhhdmUgYWxsb3dfbW9kZXNldD09dHJ1ZSBvbiBpOTE1IG9yIGVs
c2Ugd2UganVzdCBjYW4ndAo+IGd1YXJhbnRlZSB0aGF0IHdlIGNhbiBhbnl0aGluZyAoZHVlIHRv
IHNhZ3YgYW5kL29yIGNkY2xrIG1haW5seSkuCgpJIGd1ZXNzIG5vdCBlbm91Z2ggbWFjaGluZXMg
d2l0aCBtdWx0aXBsZSBvdXRwdXRzIGluIHRoZSBzaGFyZHMuCgo+IEFsc28gYSBiaXQgYmFmZmxl
ZCB0aGF0IENJIGRpZG4ndCBoaXQgdGhpcy4gSSB0aGluayBpdCBzaG91bGQgYmUKPiB0b3RhbGx5
IHBvc3NpYmxlIHRvIGhpdCB0aGlzIG5vdy4gVG8gYXZvaWQgdGhhdCBJIGd1ZXNzIHdlJ2QganVz
dAo+IG5lZWQgdG8gbWFrZSBpbnRlbF9hdG9taWNfc2VyaWFsaXplX2dsb2JhbF9zdGF0ZSgpIGZh
aWwgaWYgaXQKPiBoYXMgdG8gYWRkIGFueSBuZXcgY3J0Y3Mgd2hlbiBhbGxvd19tb2Rlc2V0PT1m
YWxzZS4gSG9wZWZ1bGx5Cj4gdGhlcmUgYXJlbid0IG1hbnkgb3RoZXIgcGxhY2VzIHRoYXQgYWRk
IGNydGNzIHRvIHRoZSBzdGF0ZQo+IHdpdGhvdXQgZm9yY2luZyBhIG1vZGVzZXQgb24gdGhlbS4K
Ck9oIHdlIGRvbid0IGRvIHRoYXQ/IFRoYXQgZmVlbHMgbGlrZSBhIHByZXR0eSBiYWQgYnVnIC4u
LiBXYWNraW5nCnJhbmRvbSBvdGhlciBjcnRjIHdpdGhvdXQgYWxsb3dfbW9kZXNldCBpcyBwcmV0
dHkgbmFzdHkuCi1EYW5pZWwKCj4KPiA+ICsKPiA+ICAgICAgIHJldHVybiAwOwo+ID4gIH0KPiA+
ICBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfY2hlY2tfb25seSk7Cj4gPiAtLQo+ID4gMi4yOC4w
Cj4KPiAtLQo+IFZpbGxlIFN5cmrDpGzDpAo+IEludGVsCgoKCi0tIApEYW5pZWwgVmV0dGVyClNv
ZnR3YXJlIEVuZ2luZWVyLCBJbnRlbCBDb3Jwb3JhdGlvbgpodHRwOi8vYmxvZy5mZndsbC5jaApf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
