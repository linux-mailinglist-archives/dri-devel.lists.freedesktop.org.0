Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DC0546FE00
	for <lists+dri-devel@lfdr.de>; Mon, 22 Jul 2019 12:43:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F09FD89C07;
	Mon, 22 Jul 2019 10:43:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9FD1D89A61
 for <dri-devel@lists.freedesktop.org>; Mon, 22 Jul 2019 10:43:26 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:55388
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hpVmu-0001lD-NQ; Mon, 22 Jul 2019 12:43:24 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 3/9] drm/tinydrm: Rename remaining variable mipi -> dbidev
Date: Mon, 22 Jul 2019 12:43:06 +0200
Message-Id: <20190722104312.16184-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190722104312.16184-1-noralf@tronnes.org>
References: <20190722104312.16184-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=5LOtaFwFcFN3ZeDXIdgAYOxOGZJhXd90goB/K+pGlHU=; 
 b=eHwtYnLn/gQPoGRLFFzp2aBOR3/Q1nbQ5UjKce1Jbdh09IvVMghBFTrO+nKzl3GxPBht+n2MXFDJmzCwEJMQDy7ucCMcd0EiRkRbMdTEy/o1JNxfyM+ArOiA/5tZj9MS/vPc/BIB33Tuo1JIaRmZEbXk+am2TEAAsMQMFTXoDFim2xdZDLcjHu3QngvOm5Yr38XM1E7jaPUSXtdHyTbfEm6VJ3k7zMmMnqkHaBKnylN0yepz6I4+1jSXbgXq4leglsl6qaBjsSvZu9DVqO86i9r4Kfh1jhL6y7BvBB0x3hm1O70sEa+H8ZoNFp1AzU59WIJ+D6r6zoB0QPf/6Pmk0Q==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sam@ravnborg.org, david@lechnology.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

c3RydWN0IG1pcGlfZGJpIGlzIGdvaW5nIHRvIGJlIHNwbGl0IGludG8gYW4gaW50ZXJmYWNlIHBh
cnQgYW5kIGEgZGlzcGxheQpwaXBlbGluZSBwYXJ0LiBUaGUgaW50ZXJmYWNlIHBhcnQgY2FuIGJl
IHVzZWQgYnkgZHJpdmVycyB0aGF0IG5lZWQgdG8KaW5pdGlhbGl6ZSB0aGUgY29udHJvbGxlciwg
YnV0IHRoYXQgd29uJ3QgdXBsb2FkIHRoZSBmcmFtZWJ1ZmZlciBvdmVyCnRoaXMgaW50ZXJmYWNl
LgoKdGlueWRybSB1c2VzIHRoZSB2YXJpYWJsZSBuYW1lICdtaXBpJyBidXQgdGhpcyBpcyBub3Qg
YSBnb29kIG5hbWUgc2luY2UKTUlQSSByZWZlcnMgdG8gYSBsb3Qgb2Ygc3RhbmRhcmRzLiBUaGlz
IHBhdGNoIGNoYW5nZXMgdGhlIHZhcmlhYmxlIG5hbWUKdG8gJ2RiaWRldicgd2hlcmUgaXQgcmVm
ZXJzIHRvIHRoZSBwaXBlbGluZSBwYXJ0IG9mIHN0cnVjdCBtaXBpX2RiaS4KCkNjOiBFcmljIEFu
aG9sdCA8ZXJpY0BhbmhvbHQubmV0PgpDYzogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9n
eS5jb20+ClJldmlld2VkLWJ5OiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+ClNpZ25l
ZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS90aW55ZHJtL2h4ODM1N2QuYyAgfCAgMzAgKysrKy0tLS0KIGRyaXZlcnMvZ3B1
L2RybS90aW55ZHJtL2lsaTkyMjUuYyAgfCAgNDIgKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJt
L3Rpbnlkcm0vaWxpOTM0MS5jICB8ICAzMCArKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL3Rpbnlk
cm0vbWkwMjgzcXQuYyB8ICAzNiArKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL21p
cGktZGJpLmMgfCAxMjAgKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS90aW55ZHJtL3N0NzU4Ni5jICAgfCAgMzQgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS90
aW55ZHJtL3N0NzczNXIuYyAgfCAgMzAgKysrKy0tLS0KIGluY2x1ZGUvZHJtL3Rpbnlkcm0vbWlw
aS1kYmkuaCAgICAgfCAgMTAgKy0tCiA4IGZpbGVzIGNoYW5nZWQsIDE2NiBpbnNlcnRpb25zKCsp
LCAxNjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0v
aHg4MzU3ZC5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaHg4MzU3ZC5jCmluZGV4IGY1MDNk
MTRhYTM2Yi4uZTExM2M0MzRmZjU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRy
bS9oeDgzNTdkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaHg4MzU3ZC5jCkBAIC00
Nyw4ICs0Nyw4IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3RydWN0IGRybV9zaW1w
bGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
ewotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRl
dik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkgPSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJp
ZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkg
KmRiaSA9IGRiaWRldjsKIAl1OCBhZGRyX21vZGU7CiAJaW50IHJldCwgaWR4OwogCkBAIC01Nyw3
ICs1Nyw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVf
ZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAotCXJldCA9IG1p
cGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQobWlwaSk7CisJcmV0ID0gbWlwaV9kYmlf
cG93ZXJvbl9jb25kaXRpb25hbF9yZXNldChkYmlkZXYpOwogCWlmIChyZXQgPCAwKQogCQlnb3Rv
IG91dF9leGl0OwogCWlmIChyZXQgPT0gMSkKQEAgLTE1OSw3ICsxNTksNyBAQCBzdGF0aWMgdm9p
ZCB5eDI0MHF2MjlfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwK
IAl1c2xlZXBfcmFuZ2UoNTAwMCwgNzAwMCk7CiAKIG91dF9lbmFibGU6Ci0Jc3dpdGNoIChtaXBp
LT5yb3RhdGlvbikgeworCXN3aXRjaCAoZGJpZGV2LT5yb3RhdGlvbikgewogCWRlZmF1bHQ6CiAJ
CWFkZHJfbW9kZSA9IEhYODM1N0RfTUFEQ1RMX01YIHwgSFg4MzU3RF9NQURDVExfTVk7CiAJCWJy
ZWFrOwpAQCAtMTc0LDcgKzE3NCw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3Ry
dWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQlicmVhazsKIAl9CiAJbWlwaV9k
YmlfY29tbWFuZChkYmksIE1JUElfRENTX1NFVF9BRERSRVNTX01PREUsIGFkZHJfbW9kZSk7Ci0J
bWlwaV9kYmlfZW5hYmxlX2ZsdXNoKG1pcGksIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwlt
aXBpX2RiaV9lbmFibGVfZmx1c2goZGJpZGV2LCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiBv
dXRfZXhpdDoKIAlkcm1fZGV2X2V4aXQoaWR4KTsKIH0KQEAgLTIyMCwyMCArMjIwLDIwIEBAIE1P
RFVMRV9ERVZJQ0VfVEFCTEUoc3BpLCBoeDgzNTdkX2lkKTsKIHN0YXRpYyBpbnQgaHg4MzU3ZF9w
cm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogewogCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZz
cGktPmRldjsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldjsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZHJtOwotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaTsKIAlzdHJ1Y3QgZ3Bpb19kZXNjICpkYzsKIAl1
MzIgcm90YXRpb24gPSAwOwogCWludCByZXQ7CiAKLQltaXBpID0ga3phbGxvYyhzaXplb2YoKm1p
cGkpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIW1pcGkpCisJZGJpZGV2ID0ga3phbGxvYyhzaXplb2Yo
KmRiaWRldiksIEdGUF9LRVJORUwpOworCWlmICghZGJpZGV2KQogCQlyZXR1cm4gLUVOT01FTTsK
IAotCWRybSA9ICZtaXBpLT5kcm07CisJZHJtID0gJmRiaWRldi0+ZHJtOwogCXJldCA9IGRldm1f
ZHJtX2Rldl9pbml0KGRldiwgZHJtLCAmaHg4MzU3ZF9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJ
a2ZyZWUobWlwaSk7CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC0y
NDUsMTcgKzI0NSwxNyBAQCBzdGF0aWMgaW50IGh4ODM1N2RfcHJvYmUoc3RydWN0IHNwaV9kZXZp
Y2UgKnNwaSkKIAkJcmV0dXJuIFBUUl9FUlIoZGMpOwogCX0KIAotCW1pcGktPmJhY2tsaWdodCA9
IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKLQlpZiAoSVNfRVJSKG1pcGktPmJhY2tsaWdo
dCkpCi0JCXJldHVybiBQVFJfRVJSKG1pcGktPmJhY2tsaWdodCk7CisJZGJpZGV2LT5iYWNrbGln
aHQgPSBkZXZtX29mX2ZpbmRfYmFja2xpZ2h0KGRldik7CisJaWYgKElTX0VSUihkYmlkZXYtPmJh
Y2tsaWdodCkpCisJCXJldHVybiBQVFJfRVJSKGRiaWRldi0+YmFja2xpZ2h0KTsKIAogCWRldmlj
ZV9wcm9wZXJ0eV9yZWFkX3UzMihkZXYsICJyb3RhdGlvbiIsICZyb3RhdGlvbik7CiAKLQlyZXQg
PSBtaXBpX2RiaV9zcGlfaW5pdChzcGksIG1pcGksIGRjKTsKKwlyZXQgPSBtaXBpX2RiaV9zcGlf
aW5pdChzcGksIGRiaWRldiwgZGMpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQg
PSBtaXBpX2RiaV9pbml0KG1pcGksICZoeDgzNTdkX3BpcGVfZnVuY3MsICZ5eDM1MGh2MTVfbW9k
ZSwgcm90YXRpb24pOworCXJldCA9IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAmaHg4MzU3ZF9waXBl
X2Z1bmNzLCAmeXgzNTBodjE1X21vZGUsIHJvdGF0aW9uKTsKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMgYi9k
cml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKaW5kZXggYzgzN2QxNDIzMzYyLi4yMDlh
NzVkYWI3Y2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKQEAgLTc4LDEwICs3OCwxMCBA
QCBzdGF0aWMgaW5saW5lIGludCBpbGk5MjI1X2NvbW1hbmQoc3RydWN0IG1pcGlfZGJpICpkYmks
IHU4IGNtZCwgdTE2IGRhdGEpCiBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2RpcnR5KHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiB7CiAJc3RydWN0IGRy
bV9nZW1fY21hX29iamVjdCAqY21hX29iaiA9IGRybV9mYl9jbWFfZ2V0X2dlbV9vYmooZmIsIDAp
OwotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2RiaShmYi0+ZGV2KTsKKwlz
dHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9IGRybV90b19taXBpX2RiaShmYi0+ZGV2KTsKIAl1bnNp
Z25lZCBpbnQgaGVpZ2h0ID0gcmVjdC0+eTIgLSByZWN0LT55MTsKIAl1bnNpZ25lZCBpbnQgd2lk
dGggPSByZWN0LT54MiAtIHJlY3QtPngxOwotCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gbWlwaTsK
KwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAlib29sIHN3YXAgPSBkYmktPnN3YXBf
Ynl0ZXM7CiAJdTE2IHhfc3RhcnQsIHlfc3RhcnQ7CiAJdTE2IHgxLCB4MiwgeTEsIHkyOwpAQCAt
ODksNyArODksNyBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2RpcnR5KHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiAJYm9vbCBmdWxsOwogCXZvaWQg
KnRyOwogCi0JaWYgKCFtaXBpLT5lbmFibGVkKQorCWlmICghZGJpZGV2LT5lbmFibGVkKQogCQly
ZXR1cm47CiAKIAlpZiAoIWRybV9kZXZfZW50ZXIoZmItPmRldiwgJmlkeCkpCkBAIC0xMDEsMTUg
KzEwMSwxNSBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiAKIAlpZiAoIWRiaS0+ZGMgfHwgIWZ1
bGwgfHwgc3dhcCB8fAogCSAgICBmYi0+Zm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9YUkdC
ODg4OCkgewotCQl0ciA9IG1pcGktPnR4X2J1ZjsKLQkJcmV0ID0gbWlwaV9kYmlfYnVmX2NvcHko
bWlwaS0+dHhfYnVmLCBmYiwgcmVjdCwgc3dhcCk7CisJCXRyID0gZGJpZGV2LT50eF9idWY7CisJ
CXJldCA9IG1pcGlfZGJpX2J1Zl9jb3B5KGRiaWRldi0+dHhfYnVmLCBmYiwgcmVjdCwgc3dhcCk7
CiAJCWlmIChyZXQpCiAJCQlnb3RvIGVycl9tc2c7CiAJfSBlbHNlIHsKIAkJdHIgPSBjbWFfb2Jq
LT52YWRkcjsKIAl9CiAKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJc3dpdGNoIChkYmlk
ZXYtPnJvdGF0aW9uKSB7CiAJZGVmYXVsdDoKIAkJeDEgPSByZWN0LT54MTsKIAkJeDIgPSByZWN0
LT54MiAtIDE7CkBAIC0xODMsMTAgKzE4MywxMCBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVf
ZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAkJCQlzdHJ1Y3Qg
ZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0gZHJtX3RvX21pcGlfZGJp
KHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9IGRybV90b19taXBp
X2RiaShwaXBlLT5jcnRjLmRldik7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+ZmI7CiAJc3RydWN0IGRldmljZSAqZGV2ID0gcGlwZS0+Y3J0Yy5kZXYtPmRldjsK
LQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmkgPSBk
YmlkZXY7CiAJc3RydWN0IGRybV9yZWN0IHJlY3QgPSB7CiAJCS54MSA9IDAsCiAJCS54MiA9IGZi
LT53aWR0aCwKQEAgLTIzMyw3ICsyMzMsNyBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVfZW5h
YmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAogCW1zbGVlcCg1MCk7
CiAKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJc3dpdGNoIChkYmlkZXYtPnJvdGF0aW9u
KSB7CiAJZGVmYXVsdDoKIAkJYW1faWQgPSAweDMwOwogCQlicmVhazsKQEAgLTI4Myw3ICsyODMs
NyBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rp
c3BsYXlfcGlwZSAqcGlwZSwKIAogCWlsaTkyMjVfY29tbWFuZChkYmksIElMSTkyMjVfRElTUExB
WV9DT05UUk9MXzEsIDB4MTAxNyk7CiAKLQltaXBpLT5lbmFibGVkID0gdHJ1ZTsKKwlkYmlkZXYt
PmVuYWJsZWQgPSB0cnVlOwogCWlsaTkyMjVfZmJfZGlydHkoZmIsICZyZWN0KTsKIG91dF9leGl0
OgogCWRybV9kZXZfZXhpdChpZHgpOwpAQCAtMjkxLDggKzI5MSw4IEBAIHN0YXRpYyB2b2lkIGls
aTkyMjVfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAog
CiBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNw
bGF5X3BpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0gZHJtX3RvX21pcGlf
ZGJpKHBpcGUtPmNydGMuZGV2KTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3Ry
dWN0IG1pcGlfZGJpICpkYmlkZXYgPSBkcm1fdG9fbWlwaV9kYmkocGlwZS0+Y3J0Yy5kZXYpOwor
CXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2OwogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsK
IApAQCAtMzAzLDcgKzMwMyw3IEBAIHN0YXRpYyB2b2lkIGlsaTkyMjVfcGlwZV9kaXNhYmxlKHN0
cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSkKIAkgKiB1bnBsdWcuCiAJICovCiAK
LQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFkYmlkZXYtPmVuYWJsZWQpCiAJCXJldHVybjsK
IAogCWlsaTkyMjVfY29tbWFuZChkYmksIElMSTkyMjVfRElTUExBWV9DT05UUk9MXzEsIDB4MDAw
MCk7CkBAIC0zMTIsNyArMzEyLDcgQEAgc3RhdGljIHZvaWQgaWxpOTIyNV9waXBlX2Rpc2FibGUo
c3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlKQogCW1zbGVlcCg1MCk7CiAJaWxp
OTIyNV9jb21tYW5kKGRiaSwgSUxJOTIyNV9QT1dFUl9DT05UUk9MXzEsIDB4MGEwMik7CiAKLQlt
aXBpLT5lbmFibGVkID0gZmFsc2U7CisJZGJpZGV2LT5lbmFibGVkID0gZmFsc2U7CiB9CiAKIHN0
YXRpYyBpbnQgaWxpOTIyNV9kYmlfY29tbWFuZChzdHJ1Y3QgbWlwaV9kYmkgKmRiaSwgdTggKmNt
ZCwgdTggKnBhciwKQEAgLTM3OCwyMiArMzc4LDIyIEBAIE1PRFVMRV9ERVZJQ0VfVEFCTEUoc3Bp
LCBpbGk5MjI1X2lkKTsKIHN0YXRpYyBpbnQgaWxpOTIyNV9wcm9iZShzdHJ1Y3Qgc3BpX2Rldmlj
ZSAqc3BpKQogewogCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZzcGktPmRldjsKKwlzdHJ1Y3QgbWlw
aV9kYmkgKmRiaWRldjsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtOwotCXN0cnVjdCBtaXBpX2Ri
aSAqbWlwaTsKIAlzdHJ1Y3QgbWlwaV9kYmkgKmRiaTsKIAlzdHJ1Y3QgZ3Bpb19kZXNjICpyczsK
IAl1MzIgcm90YXRpb24gPSAwOwogCWludCByZXQ7CiAKLQltaXBpID0ga3phbGxvYyhzaXplb2Yo
Km1pcGkpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIW1pcGkpCisJZGJpZGV2ID0ga3phbGxvYyhzaXpl
b2YoKmRiaWRldiksIEdGUF9LRVJORUwpOworCWlmICghZGJpZGV2KQogCQlyZXR1cm4gLUVOT01F
TTsKIAotCWRiaSA9IG1pcGk7Ci0JZHJtID0gJm1pcGktPmRybTsKKwlkYmkgPSBkYmlkZXY7CisJ
ZHJtID0gJmRiaWRldi0+ZHJtOwogCXJldCA9IGRldm1fZHJtX2Rldl9pbml0KGRldiwgZHJtLCAm
aWxpOTIyNV9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJa2ZyZWUobWlwaSk7CisJCWtmcmVlKGRi
aWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC00MjAsNyArNDIwLDcgQEAgc3RhdGljIGlu
dCBpbGk5MjI1X3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCiAJLyogb3ZlcnJpZGUgdGhl
IGNvbW1hbmQgZnVuY3Rpb24gc2V0IGluICBtaXBpX2RiaV9zcGlfaW5pdCgpICovCiAJZGJpLT5j
b21tYW5kID0gaWxpOTIyNV9kYmlfY29tbWFuZDsKIAotCXJldCA9IG1pcGlfZGJpX2luaXQobWlw
aSwgJmlsaTkyMjVfcGlwZV9mdW5jcywgJmlsaTkyMjVfbW9kZSwgcm90YXRpb24pOworCXJldCA9
IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAmaWxpOTIyNV9waXBlX2Z1bmNzLCAmaWxpOTIyNV9tb2Rl
LCByb3RhdGlvbik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTM0MS5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0v
aWxpOTM0MS5jCmluZGV4IDA1YmE1YWIxN2VjNi4uZGZhOGM2ZTk1MmM4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MzQxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Rp
bnlkcm0vaWxpOTM0MS5jCkBAIC01Myw4ICs1Myw4IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9l
bmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJICAgICBzdHJ1
Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19t
aXBpX2RiaShwaXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkgPSBtaXBpOwor
CXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2
KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAl1OCBhZGRyX21vZGU7CiAJaW50
IHJldCwgaWR4OwogCkBAIC02Myw3ICs2Myw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFi
bGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVHX0tN
UygiXG4iKTsKIAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQobWlw
aSk7CisJcmV0ID0gbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9yZXNldChkYmlkZXYpOwog
CWlmIChyZXQgPCAwKQogCQlnb3RvIG91dF9leGl0OwogCWlmIChyZXQgPT0gMSkKQEAgLTExMyw3
ICsxMTMsNyBAQCBzdGF0aWMgdm9pZCB5eDI0MHF2MjlfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxl
X2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAltc2xlZXAoMTAwKTsKIAogb3V0X2VuYWJsZToKLQlzd2l0
Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJc3dpdGNoIChkYmlkZXYtPnJvdGF0aW9uKSB7CiAJZGVm
YXVsdDoKIAkJYWRkcl9tb2RlID0gSUxJOTM0MV9NQURDVExfTVg7CiAJCWJyZWFrOwpAQCAtMTMw
LDcgKzEzMCw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3RydWN0IGRybV9zaW1w
bGVfZGlzcGxheV9waXBlICpwaXBlLAogCX0KIAlhZGRyX21vZGUgfD0gSUxJOTM0MV9NQURDVExf
QkdSOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfQUREUkVTU19NT0RFLCBh
ZGRyX21vZGUpOwotCW1pcGlfZGJpX2VuYWJsZV9mbHVzaChtaXBpLCBjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7CisJbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKGRiaWRldiwgY3J0Y19zdGF0ZSwgcGxh
bmVfc3RhdGUpOwogb3V0X2V4aXQ6CiAJZHJtX2Rldl9leGl0KGlkeCk7CiB9CkBAIC0xNzYsMjIg
KzE3NiwyMiBAQCBNT0RVTEVfREVWSUNFX1RBQkxFKHNwaSwgaWxpOTM0MV9pZCk7CiBzdGF0aWMg
aW50IGlsaTkzNDFfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSkKIHsKIAlzdHJ1Y3QgZGV2
aWNlICpkZXYgPSAmc3BpLT5kZXY7CisJc3RydWN0IG1pcGlfZGJpICpkYmlkZXY7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRybTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGk7CiAJc3RydWN0IG1pcGlf
ZGJpICpkYmk7CiAJc3RydWN0IGdwaW9fZGVzYyAqZGM7CiAJdTMyIHJvdGF0aW9uID0gMDsKIAlp
bnQgcmV0OwogCi0JbWlwaSA9IGt6YWxsb2Moc2l6ZW9mKCptaXBpKSwgR0ZQX0tFUk5FTCk7Ci0J
aWYgKCFtaXBpKQorCWRiaWRldiA9IGt6YWxsb2Moc2l6ZW9mKCpkYmlkZXYpLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIWRiaWRldikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlkYmkgPSBtaXBpOwotCWRy
bSA9ICZtaXBpLT5kcm07CisJZGJpID0gZGJpZGV2OworCWRybSA9ICZkYmlkZXYtPmRybTsKIAly
ZXQgPSBkZXZtX2RybV9kZXZfaW5pdChkZXYsIGRybSwgJmlsaTkzNDFfZHJpdmVyKTsKIAlpZiAo
cmV0KSB7Ci0JCWtmcmVlKG1pcGkpOworCQlrZnJlZShkYmlkZXYpOwogCQlyZXR1cm4gcmV0Owog
CX0KIApAQCAtMjA5LDkgKzIwOSw5IEBAIHN0YXRpYyBpbnQgaWxpOTM0MV9wcm9iZShzdHJ1Y3Qg
c3BpX2RldmljZSAqc3BpKQogCQlyZXR1cm4gUFRSX0VSUihkYyk7CiAJfQogCi0JbWlwaS0+YmFj
a2xpZ2h0ID0gZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYpOwotCWlmIChJU19FUlIobWlwaS0+
YmFja2xpZ2h0KSkKLQkJcmV0dXJuIFBUUl9FUlIobWlwaS0+YmFja2xpZ2h0KTsKKwlkYmlkZXYt
PmJhY2tsaWdodCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKKwlpZiAoSVNfRVJSKGRi
aWRldi0+YmFja2xpZ2h0KSkKKwkJcmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5iYWNrbGlnaHQpOwog
CiAJZGV2aWNlX3Byb3BlcnR5X3JlYWRfdTMyKGRldiwgInJvdGF0aW9uIiwgJnJvdGF0aW9uKTsK
IApAQCAtMjE5LDcgKzIxOSw3IEBAIHN0YXRpYyBpbnQgaWxpOTM0MV9wcm9iZShzdHJ1Y3Qgc3Bp
X2RldmljZSAqc3BpKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBtaXBpX2Ri
aV9pbml0KG1pcGksICZpbGk5MzQxX3BpcGVfZnVuY3MsICZ5eDI0MHF2MjlfbW9kZSwgcm90YXRp
b24pOworCXJldCA9IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAmaWxpOTM0MV9waXBlX2Z1bmNzLCAm
eXgyNDBxdjI5X21vZGUsIHJvdGF0aW9uKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9taTAyODNxdC5jIGIvZHJpdmVycy9n
cHUvZHJtL3Rpbnlkcm0vbWkwMjgzcXQuYwppbmRleCBhZGM4YzQ4NzJkM2YuLjlkMjg0ZmIyNGMz
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWkwMjgzcXQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdGlueWRybS9taTAyODNxdC5jCkBAIC01MSw4ICs1MSw4IEBAIHN0YXRp
YyB2b2lkIG1pMDI4M3F0X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBp
cGUsCiAJCQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgIHN0
cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAq
bWlwaSA9IGRybV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJp
ICpkYmkgPSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJp
KHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAl1OCBh
ZGRyX21vZGU7CiAJaW50IHJldCwgaWR4OwogCkBAIC02MSw3ICs2MSw3IEBAIHN0YXRpYyB2b2lk
IG1pMDI4M3F0X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAK
IAlEUk1fREVCVUdfS01TKCJcbiIpOwogCi0JcmV0ID0gbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRp
b25hbF9yZXNldChtaXBpKTsKKwlyZXQgPSBtaXBpX2RiaV9wb3dlcm9uX2NvbmRpdGlvbmFsX3Jl
c2V0KGRiaWRldik7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8gb3V0X2V4aXQ7CiAJaWYgKHJldCA9
PSAxKQpAQCAtMTE3LDcgKzExNyw3IEBAIHN0YXRpYyB2b2lkIG1pMDI4M3F0X2VuYWJsZShzdHJ1
Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJICogQXMgYSByZXN1bHQsIHdlIG5l
ZWQgdG8gYWx3YXlzIGFwcGx5IHRoZSByb3RhdGlvbiB2YWx1ZQogCSAqIHJlZ2FyZGxlc3Mgb2Yg
dGhlIGRpc3BsYXkgIm9uL29mZiIgc3RhdGUuCiAJICovCi0Jc3dpdGNoIChtaXBpLT5yb3RhdGlv
bikgeworCXN3aXRjaCAoZGJpZGV2LT5yb3RhdGlvbikgewogCWRlZmF1bHQ6CiAJCWFkZHJfbW9k
ZSA9IElMSTkzNDFfTUFEQ1RMX01WIHwgSUxJOTM0MV9NQURDVExfTVkgfAogCQkJICAgIElMSTkz
NDFfTUFEQ1RMX01YOwpAQCAtMTM0LDcgKzEzNCw3IEBAIHN0YXRpYyB2b2lkIG1pMDI4M3F0X2Vu
YWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJfQogCWFkZHJfbW9k
ZSB8PSBJTEk5MzQxX01BRENUTF9CR1I7CiAJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENT
X1NFVF9BRERSRVNTX01PREUsIGFkZHJfbW9kZSk7Ci0JbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKG1p
cGksIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwltaXBpX2RiaV9lbmFibGVfZmx1c2goZGJp
ZGV2LCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiBvdXRfZXhpdDoKIAlkcm1fZGV2X2V4aXQo
aWR4KTsKIH0KQEAgLTE4MCwyMiArMTgwLDIyIEBAIE1PRFVMRV9ERVZJQ0VfVEFCTEUoc3BpLCBt
aTAyODNxdF9pZCk7CiBzdGF0aWMgaW50IG1pMDI4M3F0X3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNl
ICpzcGkpCiB7CiAJc3RydWN0IGRldmljZSAqZGV2ID0gJnNwaS0+ZGV2OworCXN0cnVjdCBtaXBp
X2RiaSAqZGJpZGV2OwogCXN0cnVjdCBkcm1fZGV2aWNlICpkcm07Ci0Jc3RydWN0IG1pcGlfZGJp
ICptaXBpOwogCXN0cnVjdCBtaXBpX2RiaSAqZGJpOwogCXN0cnVjdCBncGlvX2Rlc2MgKmRjOwog
CXUzMiByb3RhdGlvbiA9IDA7CiAJaW50IHJldDsKIAotCW1pcGkgPSBremFsbG9jKHNpemVvZigq
bWlwaSksIEdGUF9LRVJORUwpOwotCWlmICghbWlwaSkKKwlkYmlkZXYgPSBremFsbG9jKHNpemVv
ZigqZGJpZGV2KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkYmlkZXYpCiAJCXJldHVybiAtRU5PTUVN
OwogCi0JZGJpID0gbWlwaTsKLQlkcm0gPSAmbWlwaS0+ZHJtOworCWRiaSA9IGRiaWRldjsKKwlk
cm0gPSAmZGJpZGV2LT5kcm07CiAJcmV0ID0gZGV2bV9kcm1fZGV2X2luaXQoZGV2LCBkcm0sICZt
aTAyODNxdF9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJa2ZyZWUobWlwaSk7CisJCWtmcmVlKGRi
aWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC0yMTMsMTMgKzIxMywxMyBAQCBzdGF0aWMg
aW50IG1pMDI4M3F0X3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCiAJCXJldHVybiBQVFJf
RVJSKGRjKTsKIAl9CiAKLQltaXBpLT5yZWd1bGF0b3IgPSBkZXZtX3JlZ3VsYXRvcl9nZXQoZGV2
LCAicG93ZXIiKTsKLQlpZiAoSVNfRVJSKG1pcGktPnJlZ3VsYXRvcikpCi0JCXJldHVybiBQVFJf
RVJSKG1pcGktPnJlZ3VsYXRvcik7CisJZGJpZGV2LT5yZWd1bGF0b3IgPSBkZXZtX3JlZ3VsYXRv
cl9nZXQoZGV2LCAicG93ZXIiKTsKKwlpZiAoSVNfRVJSKGRiaWRldi0+cmVndWxhdG9yKSkKKwkJ
cmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5yZWd1bGF0b3IpOwogCi0JbWlwaS0+YmFja2xpZ2h0ID0g
ZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYpOwotCWlmIChJU19FUlIobWlwaS0+YmFja2xpZ2h0
KSkKLQkJcmV0dXJuIFBUUl9FUlIobWlwaS0+YmFja2xpZ2h0KTsKKwlkYmlkZXYtPmJhY2tsaWdo
dCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKKwlpZiAoSVNfRVJSKGRiaWRldi0+YmFj
a2xpZ2h0KSkKKwkJcmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5iYWNrbGlnaHQpOwogCiAJZGV2aWNl
X3Byb3BlcnR5X3JlYWRfdTMyKGRldiwgInJvdGF0aW9uIiwgJnJvdGF0aW9uKTsKIApAQCAtMjI3
LDcgKzIyNyw3IEBAIHN0YXRpYyBpbnQgbWkwMjgzcXRfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2Ug
KnNwaSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gbWlwaV9kYmlfaW5pdCht
aXBpLCAmbWkwMjgzcXRfcGlwZV9mdW5jcywgJm1pMDI4M3F0X21vZGUsIHJvdGF0aW9uKTsKKwly
ZXQgPSBtaXBpX2RiaV9pbml0KGRiaWRldiwgJm1pMDI4M3F0X3BpcGVfZnVuY3MsICZtaTAyODNx
dF9tb2RlLCByb3RhdGlvbik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuYyBiL2RyaXZlcnMvZ3B1L2RybS90
aW55ZHJtL21pcGktZGJpLmMKaW5kZXggOTNiOWIzYWM1NTY4Li45NWIwMzJhNGIzNGIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL21pcGktZGJpLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuYwpAQCAtMjQxLDE2ICsyNDEsMTYgQEAgRVhQT1JUX1NZ
TUJPTChtaXBpX2RiaV9idWZfY29weSk7CiBzdGF0aWMgdm9pZCBtaXBpX2RiaV9mYl9kaXJ0eShz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgc3RydWN0IGRybV9yZWN0ICpyZWN0KQogewogCXN0
cnVjdCBkcm1fZ2VtX2NtYV9vYmplY3QgKmNtYV9vYmogPSBkcm1fZmJfY21hX2dldF9nZW1fb2Jq
KGZiLCAwKTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlwaV9kYmkoZmItPmRl
dik7CisJc3RydWN0IG1pcGlfZGJpICpkYmlkZXYgPSBkcm1fdG9fbWlwaV9kYmkoZmItPmRldik7
CiAJdW5zaWduZWQgaW50IGhlaWdodCA9IHJlY3QtPnkyIC0gcmVjdC0+eTE7CiAJdW5zaWduZWQg
aW50IHdpZHRoID0gcmVjdC0+eDIgLSByZWN0LT54MTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9
IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmkgPSBkYmlkZXY7CiAJYm9vbCBzd2FwID0gZGJp
LT5zd2FwX2J5dGVzOwogCWludCBpZHgsIHJldCA9IDA7CiAJYm9vbCBmdWxsOwogCXZvaWQgKnRy
OwogCi0JaWYgKCFtaXBpLT5lbmFibGVkKQorCWlmICghZGJpZGV2LT5lbmFibGVkKQogCQlyZXR1
cm47CiAKIAlpZiAoIWRybV9kZXZfZW50ZXIoZmItPmRldiwgJmlkeCkpCkBAIC0yNjIsOCArMjYy
LDggQEAgc3RhdGljIHZvaWQgbWlwaV9kYmlfZmJfZGlydHkoc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIAogCWlmICghZGJpLT5kYyB8fCAhZnVsbCB8
fCBzd2FwIHx8CiAJICAgIGZiLT5mb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1hSR0I4ODg4
KSB7Ci0JCXRyID0gbWlwaS0+dHhfYnVmOwotCQlyZXQgPSBtaXBpX2RiaV9idWZfY29weShtaXBp
LT50eF9idWYsIGZiLCByZWN0LCBzd2FwKTsKKwkJdHIgPSBkYmlkZXYtPnR4X2J1ZjsKKwkJcmV0
ID0gbWlwaV9kYmlfYnVmX2NvcHkoZGJpZGV2LT50eF9idWYsIGZiLCByZWN0LCBzd2FwKTsKIAkJ
aWYgKHJldCkKIAkJCWdvdG8gZXJyX21zZzsKIAl9IGVsc2UgewpAQCAtMzE1LDcgKzMxNSw3IEBA
IEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcGlwZV91cGRhdGUpOwogCiAvKioKICAqIG1pcGlfZGJp
X2VuYWJsZV9mbHVzaCAtIE1JUEkgREJJIGVuYWJsZSBoZWxwZXIKLSAqIEBtaXBpOiBNSVBJIERC
SSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJIGRldmljZSBzdHJ1Y3R1cmUKICAqIEBj
cnRjX3N0YXRlOiBDUlRDIHN0YXRlCiAgKiBAcGxhbmVfc3RhdGU6IFBsYW5lIHN0YXRlCiAgKgpA
QCAtMzI3LDcgKzMyNyw3IEBAIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcGlwZV91cGRhdGUpOwog
ICogZnJhbWVidWZmZXIgZmx1c2hpbmcsIGNhbid0IHVzZSB0aGlzIGZ1bmN0aW9uIHNpbmNlIHRo
ZXkgYm90aCB1c2UgdGhlIHNhbWUKICAqIGZsdXNoaW5nIGNvZGUuCiAgKi8KLXZvaWQgbWlwaV9k
YmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK3ZvaWQgbWlwaV9kYmlfZW5h
YmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2LAogCQkJICAgc3RydWN0IGRybV9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7CkBAIC0zNDAsMzcgKzM0MCwzNyBAQCB2b2lkIG1pcGlfZGJpX2VuYWJsZV9mbHVz
aChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksCiAJfTsKIAlpbnQgaWR4OwogCi0JaWYgKCFkcm1fZGV2
X2VudGVyKCZtaXBpLT5kcm0sICZpZHgpKQorCWlmICghZHJtX2Rldl9lbnRlcigmZGJpZGV2LT5k
cm0sICZpZHgpKQogCQlyZXR1cm47CiAKLQltaXBpLT5lbmFibGVkID0gdHJ1ZTsKKwlkYmlkZXYt
PmVuYWJsZWQgPSB0cnVlOwogCW1pcGlfZGJpX2ZiX2RpcnR5KGZiLCAmcmVjdCk7Ci0JYmFja2xp
Z2h0X2VuYWJsZShtaXBpLT5iYWNrbGlnaHQpOworCWJhY2tsaWdodF9lbmFibGUoZGJpZGV2LT5i
YWNrbGlnaHQpOwogCiAJZHJtX2Rldl9leGl0KGlkeCk7CiB9CiBFWFBPUlRfU1lNQk9MKG1pcGlf
ZGJpX2VuYWJsZV9mbHVzaCk7CiAKLXN0YXRpYyB2b2lkIG1pcGlfZGJpX2JsYW5rKHN0cnVjdCBt
aXBpX2RiaSAqbWlwaSkKK3N0YXRpYyB2b2lkIG1pcGlfZGJpX2JsYW5rKHN0cnVjdCBtaXBpX2Ri
aSAqZGJpZGV2KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmbWlwaS0+ZHJtOworCXN0
cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmZGJpZGV2LT5kcm07CiAJdTE2IGhlaWdodCA9IGRybS0+
bW9kZV9jb25maWcubWluX2hlaWdodDsKIAl1MTYgd2lkdGggPSBkcm0tPm1vZGVfY29uZmlnLm1p
bl93aWR0aDsKIAlzaXplX3QgbGVuID0gd2lkdGggKiBoZWlnaHQgKiAyOwotCXN0cnVjdCBtaXBp
X2RiaSAqZGJpID0gbWlwaTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAlpbnQg
aWR4OwogCiAJaWYgKCFkcm1fZGV2X2VudGVyKGRybSwgJmlkeCkpCiAJCXJldHVybjsKIAotCW1l
bXNldChtaXBpLT50eF9idWYsIDAsIGxlbik7CisJbWVtc2V0KGRiaWRldi0+dHhfYnVmLCAwLCBs
ZW4pOwogCiAJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NFVF9DT0xVTU5fQUREUkVT
UywgMCwgMCwKIAkJCSAod2lkdGggPj4gOCkgJiAweEZGLCAod2lkdGggLSAxKSAmIDB4RkYpOwog
CW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfUEFHRV9BRERSRVNTLCAwLCAwLAog
CQkJIChoZWlnaHQgPj4gOCkgJiAweEZGLCAoaGVpZ2h0IC0gMSkgJiAweEZGKTsKIAltaXBpX2Ri
aV9jb21tYW5kX2J1ZihkYmksIE1JUElfRENTX1dSSVRFX01FTU9SWV9TVEFSVCwKLQkJCSAgICAg
KHU4ICopbWlwaS0+dHhfYnVmLCBsZW4pOworCQkJICAgICAodTggKilkYmlkZXYtPnR4X2J1Ziwg
bGVuKTsKIAogCWRybV9kZXZfZXhpdChpZHgpOwogfQpAQCAtMzg1LDMxICszODUsMzEgQEAgc3Rh
dGljIHZvaWQgbWlwaV9kYmlfYmxhbmsoc3RydWN0IG1pcGlfZGJpICptaXBpKQogICovCiB2b2lk
IG1pcGlfZGJpX3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBp
cGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNy
dGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9IGRybV90b19taXBpX2RiaShwaXBl
LT5jcnRjLmRldik7CiAKLQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFkYmlkZXYtPmVuYWJs
ZWQpCiAJCXJldHVybjsKIAogCURSTV9ERUJVR19LTVMoIlxuIik7CiAKLQltaXBpLT5lbmFibGVk
ID0gZmFsc2U7CisJZGJpZGV2LT5lbmFibGVkID0gZmFsc2U7CiAKLQlpZiAobWlwaS0+YmFja2xp
Z2h0KQotCQliYWNrbGlnaHRfZGlzYWJsZShtaXBpLT5iYWNrbGlnaHQpOworCWlmIChkYmlkZXYt
PmJhY2tsaWdodCkKKwkJYmFja2xpZ2h0X2Rpc2FibGUoZGJpZGV2LT5iYWNrbGlnaHQpOwogCWVs
c2UKLQkJbWlwaV9kYmlfYmxhbmsobWlwaSk7CisJCW1pcGlfZGJpX2JsYW5rKGRiaWRldik7CiAK
LQlpZiAobWlwaS0+cmVndWxhdG9yKQotCQlyZWd1bGF0b3JfZGlzYWJsZShtaXBpLT5yZWd1bGF0
b3IpOworCWlmIChkYmlkZXYtPnJlZ3VsYXRvcikKKwkJcmVndWxhdG9yX2Rpc2FibGUoZGJpZGV2
LT5yZWd1bGF0b3IpOwogfQogRVhQT1JUX1NZTUJPTChtaXBpX2RiaV9waXBlX2Rpc2FibGUpOwog
CiBzdGF0aWMgaW50IG1pcGlfZGJpX2Nvbm5lY3Rvcl9nZXRfbW9kZXMoc3RydWN0IGRybV9jb25u
ZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlw
aV9kYmkoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3Rv
X21pcGlfZGJpKGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9k
ZTsKIAotCW1vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUoY29ubmVjdG9yLT5kZXYsICZtaXBpLT5t
b2RlKTsKKwltb2RlID0gZHJtX21vZGVfZHVwbGljYXRlKGNvbm5lY3Rvci0+ZGV2LCAmZGJpZGV2
LT5tb2RlKTsKIAlpZiAoIW1vZGUpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gZHVwbGljYXRl
IG1vZGVcbiIpOwogCQlyZXR1cm4gMDsKQEAgLTQ3MSw3ICs0NzEsNyBAQCBzdGF0aWMgY29uc3Qg
dWludDMyX3QgbWlwaV9kYmlfZm9ybWF0c1tdID0gewogCiAvKioKICAqIG1pcGlfZGJpX2luaXRf
d2l0aF9mb3JtYXRzIC0gTUlQSSBEQkkgaW5pdGlhbGl6YXRpb24gd2l0aCBjdXN0b20gZm9ybWF0
cwotICogQG1pcGk6ICZtaXBpX2RiaSBzdHJ1Y3R1cmUgdG8gaW5pdGlhbGl6ZQorICogQGRiaWRl
djogTUlQSSBEQkkgZGV2aWNlIHN0cnVjdHVyZSB0byBpbml0aWFsaXplCiAgKiBAZnVuY3M6IERp
c3BsYXkgcGlwZSBmdW5jdGlvbnMKICAqIEBmb3JtYXRzOiBBcnJheSBvZiBzdXBwb3J0ZWQgZm9y
bWF0cyAoRFJNX0ZPUk1BVFxfXCopLgogICogQGZvcm1hdF9jb3VudDogTnVtYmVyIG9mIGVsZW1l
bnRzIGluIEBmb3JtYXRzCkBAIC00OTIsNyArNDkyLDcgQEAgc3RhdGljIGNvbnN0IHVpbnQzMl90
IG1pcGlfZGJpX2Zvcm1hdHNbXSA9IHsKICAqIFJldHVybnM6CiAgKiBaZXJvIG9uIHN1Y2Nlc3Ms
IG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwotaW50IG1pcGlfZGJpX2luaXRf
d2l0aF9mb3JtYXRzKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK2ludCBtaXBpX2RiaV9pbml0X3dp
dGhfZm9ybWF0cyhzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiwKIAkJCSAgICAgICBjb25zdCBzdHJ1
Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgKmZ1bmNzLAogCQkJICAgICAgIGNvbnN0
IHVpbnQzMl90ICpmb3JtYXRzLCB1bnNpZ25lZCBpbnQgZm9ybWF0X2NvdW50LAogCQkJICAgICAg
IGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLApAQCAtNTAyLDQyICs1MDIsNDIg
QEAgaW50IG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwK
IAkJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAogCQlEUk1fRk9STUFUX01PRF9JTlZBTElECiAJfTsK
LQlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gJm1pcGktPmRybTsKKwlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZHJtID0gJmRiaWRldi0+ZHJtOwogCWludCByZXQ7CiAKLQlpZiAoIW1pcGktPmNvbW1hbmQp
CisJaWYgKCFkYmlkZXYtPmNvbW1hbmQpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JbWlwaS0+dHhf
YnVmID0gZGV2bV9rbWFsbG9jKGRybS0+ZGV2LCB0eF9idWZfc2l6ZSwgR0ZQX0tFUk5FTCk7Ci0J
aWYgKCFtaXBpLT50eF9idWYpCisJZGJpZGV2LT50eF9idWYgPSBkZXZtX2ttYWxsb2MoZHJtLT5k
ZXYsIHR4X2J1Zl9zaXplLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRldi0+dHhfYnVmKQogCQly
ZXR1cm4gLUVOT01FTTsKIAotCWRybV9tb2RlX2NvcHkoJm1pcGktPm1vZGUsIG1vZGUpOwotCXJl
dCA9IG1pcGlfZGJpX3JvdGF0ZV9tb2RlKCZtaXBpLT5tb2RlLCByb3RhdGlvbik7CisJZHJtX21v
ZGVfY29weSgmZGJpZGV2LT5tb2RlLCBtb2RlKTsKKwlyZXQgPSBtaXBpX2RiaV9yb3RhdGVfbW9k
ZSgmZGJpZGV2LT5tb2RlLCByb3RhdGlvbik7CiAJaWYgKHJldCkgewogCQlEUk1fRVJST1IoIkls
bGVnYWwgcm90YXRpb24gdmFsdWUgJXVcbiIsIHJvdGF0aW9uKTsKIAkJcmV0dXJuIC1FSU5WQUw7
CiAJfQogCi0JZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRkKCZtaXBpLT5jb25uZWN0b3IsICZtaXBp
X2RiaV9jb25uZWN0b3JfaGZ1bmNzKTsKLQlyZXQgPSBkcm1fY29ubmVjdG9yX2luaXQoZHJtLCAm
bWlwaS0+Y29ubmVjdG9yLCAmbWlwaV9kYmlfY29ubmVjdG9yX2Z1bmNzLAorCWRybV9jb25uZWN0
b3JfaGVscGVyX2FkZCgmZGJpZGV2LT5jb25uZWN0b3IsICZtaXBpX2RiaV9jb25uZWN0b3JfaGZ1
bmNzKTsKKwlyZXQgPSBkcm1fY29ubmVjdG9yX2luaXQoZHJtLCAmZGJpZGV2LT5jb25uZWN0b3Is
ICZtaXBpX2RiaV9jb25uZWN0b3JfZnVuY3MsCiAJCQkJIERSTV9NT0RFX0NPTk5FQ1RPUl9TUEkp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBkcm1fc2ltcGxlX2Rpc3BsYXlf
cGlwZV9pbml0KGRybSwgJm1pcGktPnBpcGUsIGZ1bmNzLCBmb3JtYXRzLCBmb3JtYXRfY291bnQs
Ci0JCQkJCSAgIG1vZGlmaWVycywgJm1pcGktPmNvbm5lY3Rvcik7CisJcmV0ID0gZHJtX3NpbXBs
ZV9kaXNwbGF5X3BpcGVfaW5pdChkcm0sICZkYmlkZXYtPnBpcGUsIGZ1bmNzLCBmb3JtYXRzLCBm
b3JtYXRfY291bnQsCisJCQkJCSAgIG1vZGlmaWVycywgJmRiaWRldi0+Y29ubmVjdG9yKTsKIAlp
ZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JZHJtX3BsYW5lX2VuYWJsZV9mYl9kYW1hZ2VfY2xp
cHMoJm1pcGktPnBpcGUucGxhbmUpOworCWRybV9wbGFuZV9lbmFibGVfZmJfZGFtYWdlX2NsaXBz
KCZkYmlkZXYtPnBpcGUucGxhbmUpOwogCiAJZHJtLT5tb2RlX2NvbmZpZy5mdW5jcyA9ICZtaXBp
X2RiaV9tb2RlX2NvbmZpZ19mdW5jczsKLQlkcm0tPm1vZGVfY29uZmlnLm1pbl93aWR0aCA9IG1p
cGktPm1vZGUuaGRpc3BsYXk7Ci0JZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGggPSBtaXBpLT5t
b2RlLmhkaXNwbGF5OwotCWRybS0+bW9kZV9jb25maWcubWluX2hlaWdodCA9IG1pcGktPm1vZGUu
dmRpc3BsYXk7Ci0JZHJtLT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0ID0gbWlwaS0+bW9kZS52ZGlz
cGxheTsKLQltaXBpLT5yb3RhdGlvbiA9IHJvdGF0aW9uOworCWRybS0+bW9kZV9jb25maWcubWlu
X3dpZHRoID0gZGJpZGV2LT5tb2RlLmhkaXNwbGF5OworCWRybS0+bW9kZV9jb25maWcubWF4X3dp
ZHRoID0gZGJpZGV2LT5tb2RlLmhkaXNwbGF5OworCWRybS0+bW9kZV9jb25maWcubWluX2hlaWdo
dCA9IGRiaWRldi0+bW9kZS52ZGlzcGxheTsKKwlkcm0tPm1vZGVfY29uZmlnLm1heF9oZWlnaHQg
PSBkYmlkZXYtPm1vZGUudmRpc3BsYXk7CisJZGJpZGV2LT5yb3RhdGlvbiA9IHJvdGF0aW9uOwog
CiAJRFJNX0RFQlVHX0tNUygicm90YXRpb24gPSAldVxuIiwgcm90YXRpb24pOwogCkBAIC01NDcs
NyArNTQ3LDcgQEAgRVhQT1JUX1NZTUJPTChtaXBpX2RiaV9pbml0X3dpdGhfZm9ybWF0cyk7CiAK
IC8qKgogICogbWlwaV9kYmlfaW5pdCAtIE1JUEkgREJJIGluaXRpYWxpemF0aW9uCi0gKiBAbWlw
aTogJm1pcGlfZGJpIHN0cnVjdHVyZSB0byBpbml0aWFsaXplCisgKiBAZGJpZGV2OiBNSVBJIERC
SSBkZXZpY2Ugc3RydWN0dXJlIHRvIGluaXRpYWxpemUKICAqIEBmdW5jczogRGlzcGxheSBwaXBl
IGZ1bmN0aW9ucwogICogQG1vZGU6IERpc3BsYXkgbW9kZQogICogQHJvdGF0aW9uOiBJbml0aWFs
IHJvdGF0aW9uIGluIGRlZ3JlZXMgQ291bnRlciBDbG9jayBXaXNlCkBAIC01NjIsMTUgKzU2Miwx
NSBAQCBFWFBPUlRfU1lNQk9MKG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzKTsKICAqIFJldHVy
bnM6CiAgKiBaZXJvIG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4K
ICAqLwotaW50IG1pcGlfZGJpX2luaXQoc3RydWN0IG1pcGlfZGJpICptaXBpLAoraW50IG1pcGlf
ZGJpX2luaXQoc3RydWN0IG1pcGlfZGJpICpkYmlkZXYsCiAJCSAgY29uc3Qgc3RydWN0IGRybV9z
aW1wbGVfZGlzcGxheV9waXBlX2Z1bmNzICpmdW5jcywKIAkJICBjb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqbW9kZSwgdW5zaWduZWQgaW50IHJvdGF0aW9uKQogewogCXNpemVfdCBidWZz
aXplID0gbW9kZS0+dmRpc3BsYXkgKiBtb2RlLT5oZGlzcGxheSAqIHNpemVvZih1MTYpOwogCi0J
bWlwaS0+ZHJtLm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDE2OworCWRiaWRldi0+ZHJt
Lm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDE2OwogCi0JcmV0dXJuIG1pcGlfZGJpX2lu
aXRfd2l0aF9mb3JtYXRzKG1pcGksIGZ1bmNzLCBtaXBpX2RiaV9mb3JtYXRzLAorCXJldHVybiBt
aXBpX2RiaV9pbml0X3dpdGhfZm9ybWF0cyhkYmlkZXYsIGZ1bmNzLCBtaXBpX2RiaV9mb3JtYXRz
LAogCQkJCQkgIEFSUkFZX1NJWkUobWlwaV9kYmlfZm9ybWF0cyksIG1vZGUsCiAJCQkJCSAgcm90
YXRpb24sIGJ1ZnNpemUpOwogfQpAQCAtNjQ2LDE0ICs2NDYsMTQgQEAgYm9vbCBtaXBpX2RiaV9k
aXNwbGF5X2lzX29uKHN0cnVjdCBtaXBpX2RiaSAqZGJpKQogfQogRVhQT1JUX1NZTUJPTChtaXBp
X2RiaV9kaXNwbGF5X2lzX29uKTsKIAotc3RhdGljIGludCBtaXBpX2RiaV9wb3dlcm9uX3Jlc2V0
X2NvbmRpdGlvbmFsKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwgYm9vbCBjb25kKQorc3RhdGljIGlu
dCBtaXBpX2RiaV9wb3dlcm9uX3Jlc2V0X2NvbmRpdGlvbmFsKHN0cnVjdCBtaXBpX2RiaSAqZGJp
ZGV2LCBib29sIGNvbmQpCiB7Ci0Jc3RydWN0IGRldmljZSAqZGV2ID0gbWlwaS0+ZHJtLmRldjsK
LQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IGRldmljZSAqZGV2ID0gZGJp
ZGV2LT5kcm0uZGV2OworCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2OwogCWludCByZXQ7
CiAKLQlpZiAobWlwaS0+cmVndWxhdG9yKSB7Ci0JCXJldCA9IHJlZ3VsYXRvcl9lbmFibGUobWlw
aS0+cmVndWxhdG9yKTsKKwlpZiAoZGJpZGV2LT5yZWd1bGF0b3IpIHsKKwkJcmV0ID0gcmVndWxh
dG9yX2VuYWJsZShkYmlkZXYtPnJlZ3VsYXRvcik7CiAJCWlmIChyZXQpIHsKIAkJCURSTV9ERVZf
RVJST1IoZGV2LCAiRmFpbGVkIHRvIGVuYWJsZSByZWd1bGF0b3IgKCVkKVxuIiwgcmV0KTsKIAkJ
CXJldHVybiByZXQ7CkBAIC02NjcsOCArNjY3LDggQEAgc3RhdGljIGludCBtaXBpX2RiaV9wb3dl
cm9uX3Jlc2V0X2NvbmRpdGlvbmFsKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwgYm9vbCBjb25kKQog
CXJldCA9IG1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TT0ZUX1JFU0VUKTsKIAlpZiAo
cmV0KSB7CiAJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHNlbmQgcmVzZXQgY29tbWFu
ZCAoJWQpXG4iLCByZXQpOwotCQlpZiAobWlwaS0+cmVndWxhdG9yKQotCQkJcmVndWxhdG9yX2Rp
c2FibGUobWlwaS0+cmVndWxhdG9yKTsKKwkJaWYgKGRiaWRldi0+cmVndWxhdG9yKQorCQkJcmVn
dWxhdG9yX2Rpc2FibGUoZGJpZGV2LT5yZWd1bGF0b3IpOwogCQlyZXR1cm4gcmV0OwogCX0KIApA
QCAtNjg3LDcgKzY4Nyw3IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfcG93ZXJvbl9yZXNldF9jb25k
aXRpb25hbChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIGJvb2wgY29uZCkKIAogLyoqCiAgKiBtaXBp
X2RiaV9wb3dlcm9uX3Jlc2V0IC0gTUlQSSBEQkkgcG93ZXJvbiBhbmQgcmVzZXQKLSAqIEBtaXBp
OiBNSVBJIERCSSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJIGRldmljZSBzdHJ1Y3R1
cmUKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGVuYWJsZXMgdGhlIHJlZ3VsYXRvciBpZiB1c2VkIGFu
ZCBkb2VzIGEgaGFyZHdhcmUgYW5kIHNvZnR3YXJlCiAgKiByZXNldC4KQEAgLTY5NSwxNSArNjk1
LDE1IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfcG93ZXJvbl9yZXNldF9jb25kaXRpb25hbChzdHJ1
Y3QgbWlwaV9kYmkgKm1pcGksIGJvb2wgY29uZCkKICAqIFJldHVybnM6CiAgKiBaZXJvIG9uIHN1
Y2Nlc3MsIG9yIGEgbmVnYXRpdmUgZXJyb3IgY29kZS4KICAqLwotaW50IG1pcGlfZGJpX3Bvd2Vy
b25fcmVzZXQoc3RydWN0IG1pcGlfZGJpICptaXBpKQoraW50IG1pcGlfZGJpX3Bvd2Vyb25fcmVz
ZXQoc3RydWN0IG1pcGlfZGJpICpkYmlkZXYpCiB7Ci0JcmV0dXJuIG1pcGlfZGJpX3Bvd2Vyb25f
cmVzZXRfY29uZGl0aW9uYWwobWlwaSwgZmFsc2UpOworCXJldHVybiBtaXBpX2RiaV9wb3dlcm9u
X3Jlc2V0X2NvbmRpdGlvbmFsKGRiaWRldiwgZmFsc2UpOwogfQogRVhQT1JUX1NZTUJPTChtaXBp
X2RiaV9wb3dlcm9uX3Jlc2V0KTsKIAogLyoqCiAgKiBtaXBpX2RiaV9wb3dlcm9uX2NvbmRpdGlv
bmFsX3Jlc2V0IC0gTUlQSSBEQkkgcG93ZXJvbiBhbmQgY29uZGl0aW9uYWwgcmVzZXQKLSAqIEBt
aXBpOiBNSVBJIERCSSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJIGRldmljZSBzdHJ1
Y3R1cmUKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGVuYWJsZXMgdGhlIHJlZ3VsYXRvciBpZiB1c2Vk
IGFuZCBpZiB0aGUgZGlzcGxheSBpcyBvZmYsIGl0CiAgKiBkb2VzIGEgaGFyZHdhcmUgYW5kIHNv
ZnR3YXJlIHJlc2V0LiBJZiBtaXBpX2RiaV9kaXNwbGF5X2lzX29uKCkgZGV0ZXJtaW5lcwpAQCAt
NzEzLDkgKzcxMyw5IEBAIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcG93ZXJvbl9yZXNldCk7CiAg
KiBaZXJvIGlmIHRoZSBjb250cm9sbGVyIHdhcyByZXNldCwgMSBpZiB0aGUgZGlzcGxheSB3YXMg
YWxyZWFkeSBvbiwgb3IgYQogICogbmVnYXRpdmUgZXJyb3IgY29kZS4KICAqLwotaW50IG1pcGlf
ZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQoc3RydWN0IG1pcGlfZGJpICptaXBpKQoraW50
IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQoc3RydWN0IG1pcGlfZGJpICpkYmlk
ZXYpCiB7Ci0JcmV0dXJuIG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXRfY29uZGl0aW9uYWwobWlwaSwg
dHJ1ZSk7CisJcmV0dXJuIG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXRfY29uZGl0aW9uYWwoZGJpZGV2
LCB0cnVlKTsKIH0KIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9y
ZXNldCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL3N0NzU4Ni5jIGIv
ZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vc3Q3NTg2LmMKaW5kZXggODMzOWU3ZGM1ZDkyLi5jZjBk
N2EyNjAwOWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL3N0NzU4Ni5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL3N0NzU4Ni5jCkBAIC0xMTQsMTEgKzExNCwxMSBA
QCBzdGF0aWMgaW50IHN0NzU4Nl9idWZfY29weSh2b2lkICpkc3QsIHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAogCiBzdGF0aWMgdm9pZCBzdDc1ODZfZmJfZGlydHkoc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIHsKLQlzdHJ1Y3QgbWlwaV9kYmkg
Km1pcGkgPSBkcm1fdG9fbWlwaV9kYmkoZmItPmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkg
PSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKGZiLT5k
ZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2OwogCWludCBzdGFydCwgZW5kLCBp
ZHgsIHJldCA9IDA7CiAKLQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFkYmlkZXYtPmVuYWJs
ZWQpCiAJCXJldHVybjsKIAogCWlmICghZHJtX2Rldl9lbnRlcihmYi0+ZGV2LCAmaWR4KSkKQEAg
LTEzMCw3ICsxMzAsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfZmJfZGlydHkoc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIAogCURSTV9ERUJVR19LTVMo
IkZsdXNoaW5nIFtGQjolZF0gIiBEUk1fUkVDVF9GTVQgIlxuIiwgZmItPmJhc2UuaWQsIERSTV9S
RUNUX0FSRyhyZWN0KSk7CiAKLQlyZXQgPSBzdDc1ODZfYnVmX2NvcHkobWlwaS0+dHhfYnVmLCBm
YiwgcmVjdCk7CisJcmV0ID0gc3Q3NTg2X2J1Zl9jb3B5KGRiaWRldi0+dHhfYnVmLCBmYiwgcmVj
dCk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJfbXNnOwogCkBAIC0xNDYsNyArMTQ2LDcgQEAgc3Rh
dGljIHZvaWQgc3Q3NTg2X2ZiX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1
Y3QgZHJtX3JlY3QgKnJlY3QpCiAJCQkgKHJlY3QtPnkyID4+IDgpICYgMHhGRiwgKHJlY3QtPnky
IC0gMSkgJiAweEZGKTsKIAogCXJldCA9IG1pcGlfZGJpX2NvbW1hbmRfYnVmKGRiaSwgTUlQSV9E
Q1NfV1JJVEVfTUVNT1JZX1NUQVJULAotCQkJCSAgICh1OCAqKW1pcGktPnR4X2J1ZiwKKwkJCQkg
ICAodTggKilkYmlkZXYtPnR4X2J1ZiwKIAkJCQkgICAoZW5kIC0gc3RhcnQpICogKHJlY3QtPnky
IC0gcmVjdC0+eTEpKTsKIGVycl9tc2c6CiAJaWYgKHJldCkKQEAgLTE3Nyw5ICsxNzcsOSBAQCBz
dGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9w
aXBlICpwaXBlLAogCQkJICAgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1
Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlwaV9kYmkocGlwZS0+Y3J0Yy5kZXYpOworCXN0
cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsK
IAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5mYjsKLQlzdHJ1Y3Qg
bWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmkgPSBkYmlkZXY7CiAJ
c3RydWN0IGRybV9yZWN0IHJlY3QgPSB7CiAJCS54MSA9IDAsCiAJCS54MiA9IGZiLT53aWR0aCwK
QEAgLTE5NCw3ICsxOTQsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3RydWN0
IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsK
IAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQobWlwaSk7CisJcmV0ID0gbWlwaV9kYmlf
cG93ZXJvbl9yZXNldChkYmlkZXYpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X2V4aXQ7CiAKQEAg
LTIyMiw3ICsyMjIsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3RydWN0IGRy
bV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBTVDc1
ODZfRElTUF9NT0RFX0dSQVkpOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBTVDc1ODZfRU5BQkxF
X0REUkFNLCAweDAyKTsKIAotCXN3aXRjaCAobWlwaS0+cm90YXRpb24pIHsKKwlzd2l0Y2ggKGRi
aWRldi0+cm90YXRpb24pIHsKIAlkZWZhdWx0OgogCQlhZGRyX21vZGUgPSAweDAwOwogCQlicmVh
azsKQEAgLTI0NSw3ICsyNDUsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3Ry
dWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJbXNsZWVwKDEwMCk7CiAKLQlt
aXBpLT5lbmFibGVkID0gdHJ1ZTsKKwlkYmlkZXYtPmVuYWJsZWQgPSB0cnVlOwogCXN0NzU4Nl9m
Yl9kaXJ0eShmYiwgJnJlY3QpOwogCiAJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NF
VF9ESVNQTEFZX09OKTsKQEAgLTMxOCwyMyArMzE4LDIzIEBAIE1PRFVMRV9ERVZJQ0VfVEFCTEUo
c3BpLCBzdDc1ODZfaWQpOwogc3RhdGljIGludCBzdDc1ODZfcHJvYmUoc3RydWN0IHNwaV9kZXZp
Y2UgKnNwaSkKIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmc3BpLT5kZXY7CisJc3RydWN0IG1p
cGlfZGJpICpkYmlkZXY7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKLQlzdHJ1Y3QgbWlwaV9k
YmkgKm1pcGk7CiAJc3RydWN0IG1pcGlfZGJpICpkYmk7CiAJc3RydWN0IGdwaW9fZGVzYyAqYTA7
CiAJdTMyIHJvdGF0aW9uID0gMDsKIAlzaXplX3QgYnVmc2l6ZTsKIAlpbnQgcmV0OwogCi0JbWlw
aSA9IGt6YWxsb2Moc2l6ZW9mKCptaXBpKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFtaXBpKQorCWRi
aWRldiA9IGt6YWxsb2Moc2l6ZW9mKCpkYmlkZXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRl
dikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlkYmkgPSBtaXBpOwotCWRybSA9ICZtaXBpLT5kcm07
CisJZGJpID0gZGJpZGV2OworCWRybSA9ICZkYmlkZXYtPmRybTsKIAlyZXQgPSBkZXZtX2RybV9k
ZXZfaW5pdChkZXYsIGRybSwgJnN0NzU4Nl9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJa2ZyZWUo
bWlwaSk7CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC0zNjMsNyAr
MzYzLDcgQEAgc3RhdGljIGludCBzdDc1ODZfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSkK
IAkvKiBDYW5ub3QgcmVhZCBmcm9tIHRoaXMgY29udHJvbGxlciB2aWEgU1BJICovCiAJZGJpLT5y
ZWFkX2NvbW1hbmRzID0gTlVMTDsKIAotCXJldCA9IG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRz
KG1pcGksICZzdDc1ODZfcGlwZV9mdW5jcywKKwlyZXQgPSBtaXBpX2RiaV9pbml0X3dpdGhfZm9y
bWF0cyhkYmlkZXYsICZzdDc1ODZfcGlwZV9mdW5jcywKIAkJCQkJIHN0NzU4Nl9mb3JtYXRzLCBB
UlJBWV9TSVpFKHN0NzU4Nl9mb3JtYXRzKSwKIAkJCQkJICZzdDc1ODZfbW9kZSwgcm90YXRpb24s
IGJ1ZnNpemUpOwogCWlmIChyZXQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRy
bS9zdDc3MzVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9zdDc3MzVyLmMKaW5kZXggNDMw
OWFlMjk5NzY2Li41YjIzNjU3NjU5YzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55
ZHJtL3N0NzczNXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9zdDc3MzVyLmMKQEAg
LTQyLDggKzQyLDggQEAgc3RhdGljIHZvaWQgamRfdDE4MDAzX3QwMV9waXBlX2VuYWJsZShzdHJ1
Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJCQkJICAgICAgc3RydWN0IGRybV9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2Ri
aShwaXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkgPSBtaXBpOworCXN0cnVj
dCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlz
dHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAlpbnQgcmV0LCBpZHg7CiAJdTggYWRkcl9t
b2RlOwogCkBAIC01Miw3ICs1Miw3IEBAIHN0YXRpYyB2b2lkIGpkX3QxODAwM190MDFfcGlwZV9l
bmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVH
X0tNUygiXG4iKTsKIAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQobWlwaSk7CisJcmV0
ID0gbWlwaV9kYmlfcG93ZXJvbl9yZXNldChkYmlkZXYpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0
X2V4aXQ7CiAKQEAgLTczLDcgKzczLDcgQEAgc3RhdGljIHZvaWQgamRfdDE4MDAzX3QwMV9waXBl
X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJbWlwaV9kYmlf
Y29tbWFuZChkYmksIFNUNzczNVJfUFdDVFI1LCAweDhhLCAweGVlKTsKIAltaXBpX2RiaV9jb21t
YW5kKGRiaSwgU1Q3NzM1Ul9WTUNUUjEsIDB4MGUpOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBN
SVBJX0RDU19FWElUX0lOVkVSVF9NT0RFKTsKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJ
c3dpdGNoIChkYmlkZXYtPnJvdGF0aW9uKSB7CiAJZGVmYXVsdDoKIAkJYWRkcl9tb2RlID0gU1Q3
NzM1Ul9NWCB8IFNUNzczNVJfTVk7CiAJCWJyZWFrOwpAQCAtMTA0LDcgKzEwNCw3IEBAIHN0YXRp
YyB2b2lkIGpkX3QxODAwM190MDFfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxh
eV9waXBlICpwaXBlLAogCiAJbXNsZWVwKDIwKTsKIAotCW1pcGlfZGJpX2VuYWJsZV9mbHVzaCht
aXBpLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKGRi
aWRldiwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwogb3V0X2V4aXQ6CiAJZHJtX2Rldl9leGl0
KGlkeCk7CiB9CkBAIC0xNTAsMjIgKzE1MCwyMiBAQCBNT0RVTEVfREVWSUNFX1RBQkxFKHNwaSwg
c3Q3NzM1cl9pZCk7CiBzdGF0aWMgaW50IHN0NzczNXJfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2Ug
KnNwaSkKIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmc3BpLT5kZXY7CisJc3RydWN0IG1pcGlf
ZGJpICpkYmlkZXY7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKLQlzdHJ1Y3QgbWlwaV9kYmkg
Km1pcGk7CiAJc3RydWN0IG1pcGlfZGJpICpkYmk7CiAJc3RydWN0IGdwaW9fZGVzYyAqZGM7CiAJ
dTMyIHJvdGF0aW9uID0gMDsKIAlpbnQgcmV0OwogCi0JbWlwaSA9IGt6YWxsb2Moc2l6ZW9mKCpt
aXBpKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFtaXBpKQorCWRiaWRldiA9IGt6YWxsb2Moc2l6ZW9m
KCpkYmlkZXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRldikKIAkJcmV0dXJuIC1FTk9NRU07
CiAKLQlkYmkgPSBtaXBpOwotCWRybSA9ICZtaXBpLT5kcm07CisJZGJpID0gZGJpZGV2OworCWRy
bSA9ICZkYmlkZXYtPmRybTsKIAlyZXQgPSBkZXZtX2RybV9kZXZfaW5pdChkZXYsIGRybSwgJnN0
NzczNXJfZHJpdmVyKTsKIAlpZiAocmV0KSB7Ci0JCWtmcmVlKG1pcGkpOworCQlrZnJlZShkYmlk
ZXYpOwogCQlyZXR1cm4gcmV0OwogCX0KIApAQCAtMTgzLDkgKzE4Myw5IEBAIHN0YXRpYyBpbnQg
c3Q3NzM1cl9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCQlyZXR1cm4gUFRSX0VSUihk
Yyk7CiAJfQogCi0JbWlwaS0+YmFja2xpZ2h0ID0gZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYp
OwotCWlmIChJU19FUlIobWlwaS0+YmFja2xpZ2h0KSkKLQkJcmV0dXJuIFBUUl9FUlIobWlwaS0+
YmFja2xpZ2h0KTsKKwlkYmlkZXYtPmJhY2tsaWdodCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQo
ZGV2KTsKKwlpZiAoSVNfRVJSKGRiaWRldi0+YmFja2xpZ2h0KSkKKwkJcmV0dXJuIFBUUl9FUlIo
ZGJpZGV2LT5iYWNrbGlnaHQpOwogCiAJZGV2aWNlX3Byb3BlcnR5X3JlYWRfdTMyKGRldiwgInJv
dGF0aW9uIiwgJnJvdGF0aW9uKTsKIApAQCAtMTk2LDcgKzE5Niw3IEBAIHN0YXRpYyBpbnQgc3Q3
NzM1cl9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCS8qIENhbm5vdCByZWFkIGZyb20g
QWRhZnJ1aXQgMS44IiBkaXNwbGF5IHZpYSBTUEkgKi8KIAlkYmktPnJlYWRfY29tbWFuZHMgPSBO
VUxMOwogCi0JcmV0ID0gbWlwaV9kYmlfaW5pdChtaXBpLCAmamRfdDE4MDAzX3QwMV9waXBlX2Z1
bmNzLCAmamRfdDE4MDAzX3QwMV9tb2RlLCByb3RhdGlvbik7CisJcmV0ID0gbWlwaV9kYmlfaW5p
dChkYmlkZXYsICZqZF90MTgwMDNfdDAxX3BpcGVfZnVuY3MsICZqZF90MTgwMDNfdDAxX21vZGUs
IHJvdGF0aW9uKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9pbmNs
dWRlL2RybS90aW55ZHJtL21pcGktZGJpLmggYi9pbmNsdWRlL2RybS90aW55ZHJtL21pcGktZGJp
LmgKaW5kZXggMDRiNTRlYzYxYmMyLi5iN2IzMDExMzBhZjcgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
ZHJtL3Rpbnlkcm0vbWlwaS1kYmkuaAorKysgYi9pbmNsdWRlL2RybS90aW55ZHJtL21pcGktZGJp
LmgKQEAgLTc5LDI1ICs3OSwyNSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBtaXBpX2RiaSAqZHJt
X3RvX21pcGlfZGJpKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCiAKIGludCBtaXBpX2RiaV9zcGlf
aW5pdChzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpLCBzdHJ1Y3QgbWlwaV9kYmkgKmRiaSwKIAkJICAg
ICAgc3RydWN0IGdwaW9fZGVzYyAqZGMpOwotaW50IG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRz
KHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK2ludCBtaXBpX2RiaV9pbml0X3dpdGhfZm9ybWF0cyhz
dHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBs
ZV9kaXNwbGF5X3BpcGVfZnVuY3MgKmZ1bmNzLAogCQkJICAgICAgIGNvbnN0IHVpbnQzMl90ICpm
b3JtYXRzLCB1bnNpZ25lZCBpbnQgZm9ybWF0X2NvdW50LAogCQkJICAgICAgIGNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAogCQkJICAgICAgIHVuc2lnbmVkIGludCByb3RhdGlv
biwgc2l6ZV90IHR4X2J1Zl9zaXplKTsKLWludCBtaXBpX2RiaV9pbml0KHN0cnVjdCBtaXBpX2Ri
aSAqbWlwaSwKK2ludCBtaXBpX2RiaV9pbml0KHN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2LAogCQkg
IGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5jcyAqZnVuY3MsCiAJCSAg
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsIHVuc2lnbmVkIGludCByb3RhdGlv
bik7CiB2b2lkIG1pcGlfZGJpX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRybSk7CiB2b2lk
IG1pcGlfZGJpX3BpcGVfdXBkYXRlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlw
ZSwKIAkJCSAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKTsKLXZvaWQgbWlwaV9k
YmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK3ZvaWQgbWlwaV9kYmlfZW5h
YmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2LAogCQkJICAgc3RydWN0IGRybV9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbl9z
dGF0ZSk7CiB2b2lkIG1pcGlfZGJpX3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNw
bGF5X3BpcGUgKnBpcGUpOwogdm9pZCBtaXBpX2RiaV9od19yZXNldChzdHJ1Y3QgbWlwaV9kYmkg
KmRiaSk7CiBib29sIG1pcGlfZGJpX2Rpc3BsYXlfaXNfb24oc3RydWN0IG1pcGlfZGJpICpkYmkp
OwotaW50IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQoc3RydWN0IG1pcGlfZGJpICptaXBpKTsKLWlu
dCBtaXBpX2RiaV9wb3dlcm9uX2NvbmRpdGlvbmFsX3Jlc2V0KHN0cnVjdCBtaXBpX2RiaSAqbWlw
aSk7CitpbnQgbWlwaV9kYmlfcG93ZXJvbl9yZXNldChzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldik7
CitpbnQgbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9yZXNldChzdHJ1Y3QgbWlwaV9kYmkg
KmRiaWRldik7CiAKIHUzMiBtaXBpX2RiaV9zcGlfY21kX21heF9zcGVlZChzdHJ1Y3Qgc3BpX2Rl
dmljZSAqc3BpLCBzaXplX3QgbGVuKTsKIGludCBtaXBpX2RiaV9zcGlfdHJhbnNmZXIoc3RydWN0
IHNwaV9kZXZpY2UgKnNwaSwgdTMyIHNwZWVkX2h6LAotLSAKMi4yMC4xCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
