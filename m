Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 309F62C237
	for <lists+dri-devel@lfdr.de>; Tue, 28 May 2019 11:04:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0392589E7C;
	Tue, 28 May 2019 09:03:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ED1B789E9E
 for <dri-devel@lists.freedesktop.org>; Tue, 28 May 2019 09:03:36 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id n17so30688493edb.0
 for <dri-devel@lists.freedesktop.org>; Tue, 28 May 2019 02:03:36 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=qp8gYAWJCiDOhrz1RfuOYXHHnFuqBtMXvmbENgYp7nA=;
 b=JEmpLQZtlQhBcqVjcCW3QjEJggZpXcI/Xc1Z4L0uyUlcdoOY3NuNrkx4hUAlMA/cU1
 mh9TYYT7t4oVLXR2s9a+TOlBMfQZW4qv3tmBgqB9k0YtFLDZHgpSjv/DY6Cvk8f1lRc6
 uudlWo58j/EPEl0Y/4t109G9ymt79TpusHDo2vDq8EZf0ymbrMf3IS14kkeFAa8XEeSX
 PVL1gZKBMZVyOwKSZ2UBS2TtyfPfa1ZS7TX8rIPhmVz6p2dsv+YXeNiCyjHOrmr29+Cq
 8g8rBA/S5GcsuUOj158k288570Wbk8L1aT3IOfGPK7lMzpJ0IKW/ryBuqJSX+QURZcNt
 YuRQ==
X-Gm-Message-State: APjAAAWuJPXugHVjcMeAGqSqSjdiItJgHG5qq6XdLbPTNPASscaoCjpR
 mTXWUAhQJ+5k9rwhLCu5Gmj81w==
X-Google-Smtp-Source: APXvYqxWwkOmq1B5WlNL4LZsiFHjKy9tx1xdx2Sqd/9u6FMIp/LEyZi1VfAxiFE3W+jJaainnSnkzA==
X-Received: by 2002:a17:906:491b:: with SMTP id
 b27mr33967503ejq.234.1559034215068; 
 Tue, 28 May 2019 02:03:35 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id x49sm4072656edm.25.2019.05.28.02.03.33
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Tue, 28 May 2019 02:03:34 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH 16/33] fbdev: lock_fb_info cannot fail
Date: Tue, 28 May 2019 11:02:47 +0200
Message-Id: <20190528090304.9388-17-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528090304.9388-1-daniel.vetter@ffwll.ch>
References: <20190528090304.9388-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=qp8gYAWJCiDOhrz1RfuOYXHHnFuqBtMXvmbENgYp7nA=;
 b=D/Qm2B4Nwv9VOkhXwW2zqWA9R6pO/8mljnKNDoMbQqwe10J4DIpCovISBE10ZfmIiz
 DUfZs/QewB0L/nMLc+4gH29xMFxS8TlJqHQOMPNMiOtE5d5W6SGFISi4qVJuzIvKRILw
 UsMDYJ37BMOxsF4thN3vvqssEwWctti5fq1Os=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Thompson <daniel.thompson@linaro.org>,
 Sergey Senozhatsky <sergey.senozhatsky@gmail.com>,
 Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 "Gustavo A. R. Silva" <gustavo@embeddedor.com>, linux-fbdev@vger.kernel.org,
 DRI Development <dri-devel@lists.freedesktop.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Yisheng Xie <ysxie@foxmail.com>, Hans de Goede <hdegoede@redhat.com>,
 Mikulas Patocka <mpatocka@redhat.com>, Daniel Vetter <daniel.vetter@intel.com>,
 Sam Ravnborg <sam@ravnborg.org>, Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXZlciBzaW5jZQoKY29tbWl0IGM0Nzc0N2ZkZTkzMWMwMjQ1NTY4M2JkMDBlYTQzZWFhNjJmMzVi
MGUKQXV0aG9yOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRhdGlvbi5vcmc+
CkRhdGU6ICAgV2VkIE1heSAxMSAxNDo1ODozNCAyMDExIC0wNzAwCgogICAgZmJtZW06IG1ha2Ug
cmVhZC93cml0ZS9pb2N0bCB1c2UgdGhlIGZyYW1lIGJ1ZmZlciBhdCBvcGVuIHRpbWUKCmZiZGV2
IGhhcyBnYWluZWQgcHJvcGVyIHJlZmNvdW50aW5nIGZvciB0aGUgZmJpbmZvIGF0dGFjaGVkIHRv
IGFueQpvcGVuIGZpbGVzLCB3aGljaCBtZWFucyB0aGF0IHRoZSBiYWNraW5nIGRyaXZlciAoc3Rv
cmVkIGluCmZiX2luZm8tPmZib3BzKSBjYW5ub3QgdW50aW1lbHkgZGlzYXBwZWFyIGFueW1vcmUu
CgpUaGUgb25seSB0aGluZyB0aGF0IGNhbiBoYXBwZW4gaXMgdGhhdCB0aGUgZW50aXJlIGRldmlj
ZSBqdXN0IG91dHJpZ2h0CmRpc2FwcGVhcnMgYW5kIGdldHMgdW5yZWdpc3RlcmVkLCBidXQgZmls
ZV9mYl9pbmZvIGRvZXMgY2hlY2sgZm9yCnRoYXQuIEV4Y2VwdCB0aGF0IGl0J3MgcmFjeSAtIGl0
IG9ubHkgY2hlY2tzIG9uY2UgYXQgdGhlIHN0YXJ0IG9mIGEKZmlsZV9vcHMsIHRoZXJlJ3Mgbm8g
Z3VhcmFudGVlIHRoYXQgdGhlIHVuZGVybHlpbmcgZmJkZXYgd29uJ3QKdW50aW1lbHkgZGlzYXBw
ZWFyLiBBc2lkZTogQSBwcm9wZXIgd2F5IHRvIGZpeCB0aGF0IHJhY2UgaXMgcHJvYmFibHkKdG8g
cmVwbGljYXRlIHRoZSBzcmN1IHRyaWNrZXJ5IHdlJ3ZlIHJvbGxlZCBvdXQgaW4gZHJtLgoKQnV0
IGdpdmVuIHRoYXQgdGhpcyByYWNlIGhhcyBleGlzdGVkIHNpbmNlIGZvcmV2ZXIgaXQncyBwcm9i
YWJseSBub3QKb25lIHdlIG5lZWQgdG8gZml4IHJpZ2h0IGF3YXkuIGRvX3VucmVnaXN0ZXJfZnJh
bWVidWZmZXIgYWxzbyBub3doZXJlCmNsZWFycyBmYl9pbmZvLT5mYm9wcywgaGVuY2UgdGhlIGNo
ZWNrIGluIGxvY2tfZmJfaW5mbyBjYW4ndCBwb3NzaWJsZQpjYXRjaCBhIGRpc2FwcGVhcmluZyBm
YmRldiBsYXRlciBvbi4KCkxvbmcgc3Rvcnkgc2hvcnQ6IEV2ZXIgc2luY2UgdGhlIGFib3ZlIGNv
bW1pdCB0aGUgZmJfaW5mby0+ZmJvcHMKY2hlY2tzIGhhdmUgZXNzZW50aWFsbHkgYmVjb21lIGRl
YWQgY29kZS4gUmVtb3ZlIHRoaXMgYWxsLgoKQXNpZGUgZnJvbSB0aGUgZmlsZV9vcHMgY2FsbGJh
Y2tzLCBhbmQgc3R1ZmYgY2FsbGVkIGZyb20gdGhlcmUKdGhlcmUncyBvbmx5IHJlZ2lzdGVyL3Vu
cmVnaXN0ZXIgY29kZSBsZWZ0LiBJZiB0aGF0IGdvZXMgd3JvbmcgYSBkcml2ZXIKbWFuYWdlZCB0
byByZWdpc3Rlci91bnJlZ2lzdGVyIGEgZGV2aWNlIGluc3RhbmNlIHR3aWNlIG9yIGluIHRoZSB3
cm9uZwpvcmRlci4gIFRoYXQncyBqdXN0IGEgZHJpdmVyIGJ1Zy4KCnYyOgotIGZiX21tYXAgaGFk
IGFuIG9wZW4tY29kZWQgdmVyc2lvbiBvZiB0aGUgZmJpbmZvLT5mb3BzIGNoZWNrLCBiZWNhdXNl
CiAgaXQgZG9lc24ndCBuZWVkIHRoZSBmYmluZm8tPmxvY2suIERlbGV0ZSB0aGF0IHRvby4KLSBV
c2UgdGhlIHdyYXBwZXIgZnVuY3Rpb24gaW4gZmJfb3Blbi9yZWxlYXNlIG5vdywgc2luY2Ugbm8g
ZGlmZmVyZW5jZQogIGFueW1vcmUuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5p
ZWwudmV0dGVyQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFNhbSBSYXZuYm9yZyA8c2FtQHJhdm5i
b3JnLm9yZz4KUmV2aWV3ZWQtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3Jz
dEBsaW51eC5pbnRlbC5jb20+CkNjOiBCYXJ0bG9taWVqIFpvbG5pZXJraWV3aWN6IDxiLnpvbG5p
ZXJraWVAc2Ftc3VuZy5jb20+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xs
LmNoPgpDYzogSGFucyBkZSBHb2VkZSA8aGRlZ29lZGVAcmVkaGF0LmNvbT4KQ2M6IFlpc2hlbmcg
WGllIDx5c3hpZUBmb3htYWlsLmNvbT4KQ2M6IFNlcmdleSBTZW5vemhhdHNreSA8c2VyZ2V5LnNl
bm96aGF0c2t5QGdtYWlsLmNvbT4KQ2M6ICJOb3JhbGYgVHLDuG5uZXMiIDxub3JhbGZAdHJvbm5l
cy5vcmc+CkNjOiBQZXRlciBSb3NpbiA8cGVkYUBheGVudGlhLnNlPgpDYzogIk1pY2hhxYIgTWly
b3PFgmF3IiA8bWlycS1saW51eEByZXJlLnFtcW0ucGw+CkNjOiBNaWt1bGFzIFBhdG9ja2EgPG1w
YXRvY2thQHJlZGhhdC5jb20+CkNjOiAiR3VzdGF2byBBLiBSLiBTaWx2YSIgPGd1c3Rhdm9AZW1i
ZWRkZWRvci5jb20+CkNjOiBsaW51eC1mYmRldkB2Z2VyLmtlcm5lbC5vcmcKLS0tCiBkcml2ZXJz
L3ZpZGVvL2ZiZGV2L2NvcmUvZmJjbWFwLmMgfCAgNiArLS0KIGRyaXZlcnMvdmlkZW8vZmJkZXYv
Y29yZS9mYmNvbi5jICB8ICAzICstCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJtZW0uYyAg
fCA3MyArKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2xpbnV4L2ZiLmgg
ICAgICAgICAgICAgICAgfCAgNSArKy0KIDQgZmlsZXMgY2hhbmdlZCwgMjMgaW5zZXJ0aW9ucygr
KSwgNjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9jb3Jl
L2ZiY21hcC5jIGIvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZiY21hcC5jCmluZGV4IDI4MTFj
NGFmZGUwMS4uZTVhZTMzYzFhOGU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2Nv
cmUvZmJjbWFwLmMKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZiY21hcC5jCkBAIC0y
ODUsMTEgKzI4NSw3IEBAIGludCBmYl9zZXRfdXNlcl9jbWFwKHN0cnVjdCBmYl9jbWFwX3VzZXIg
KmNtYXAsIHN0cnVjdCBmYl9pbmZvICppbmZvKQogCQlnb3RvIG91dDsKIAl9CiAJdW1hcC5zdGFy
dCA9IGNtYXAtPnN0YXJ0OwotCWlmICghbG9ja19mYl9pbmZvKGluZm8pKSB7Ci0JCXJjID0gLUVO
T0RFVjsKLQkJZ290byBvdXQ7Ci0JfQotCisJbG9ja19mYl9pbmZvKGluZm8pOwogCXJjID0gZmJf
c2V0X2NtYXAoJnVtYXAsIGluZm8pOwogCXVubG9ja19mYl9pbmZvKGluZm8pOwogb3V0OgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZiY29uLmMgYi9kcml2ZXJzL3ZpZGVv
L2ZiZGV2L2NvcmUvZmJjb24uYwppbmRleCA1YTlmZTBjMGRkM2MuLmE3ZTJkNWI4ODkxNCAxMDA2
NDQKLS0tIGEvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZiY29uLmMKKysrIGIvZHJpdmVycy92
aWRlby9mYmRldi9jb3JlL2ZiY29uLmMKQEAgLTIzNjQsOCArMjM2NCw3IEBAIHN0YXRpYyB2b2lk
IGZiY29uX2dlbmVyaWNfYmxhbmsoc3RydWN0IHZjX2RhdGEgKnZjLCBzdHJ1Y3QgZmJfaW5mbyAq
aW5mbywKIAl9CiAKIAotCWlmICghbG9ja19mYl9pbmZvKGluZm8pKQotCQlyZXR1cm47CisJbG9j
a19mYl9pbmZvKGluZm8pOwogCWV2ZW50LmluZm8gPSBpbmZvOwogCWV2ZW50LmRhdGEgPSAmYmxh
bms7CiAJZmJfbm90aWZpZXJfY2FsbF9jaGFpbihGQl9FVkVOVF9DT05CTEFOSywgJmV2ZW50KTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jIGIvZHJpdmVycy92
aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKaW5kZXggYmVkNzY5OGFkMThhLi5kNzM3NjIzMjRjYTIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jCisrKyBiL2RyaXZl
cnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5jCkBAIC04MCwxNyArODAsNiBAQCBzdGF0aWMgdm9p
ZCBwdXRfZmJfaW5mbyhzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIAkJZmJfaW5mby0+ZmJvcHMt
PmZiX2Rlc3Ryb3koZmJfaW5mbyk7CiB9CiAKLWludCBsb2NrX2ZiX2luZm8oc3RydWN0IGZiX2lu
Zm8gKmluZm8pCi17Ci0JbXV0ZXhfbG9jaygmaW5mby0+bG9jayk7Ci0JaWYgKCFpbmZvLT5mYm9w
cykgewotCQltdXRleF91bmxvY2soJmluZm8tPmxvY2spOwotCQlyZXR1cm4gMDsKLQl9Ci0JcmV0
dXJuIDE7Ci19Ci1FWFBPUlRfU1lNQk9MKGxvY2tfZmJfaW5mbyk7Ci0KIC8qCiAgKiBIZWxwZXJz
CiAgKi8KQEAgLTExMjEsOCArMTExMCw3IEBAIHN0YXRpYyBsb25nIGRvX2ZiX2lvY3RsKHN0cnVj
dCBmYl9pbmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogCiAJc3dpdGNoIChjbWQpIHsKIAlj
YXNlIEZCSU9HRVRfVlNDUkVFTklORk86Ci0JCWlmICghbG9ja19mYl9pbmZvKGluZm8pKQotCQkJ
cmV0dXJuIC1FTk9ERVY7CisJCWxvY2tfZmJfaW5mbyhpbmZvKTsKIAkJdmFyID0gaW5mby0+dmFy
OwogCQl1bmxvY2tfZmJfaW5mbyhpbmZvKTsKIApAQCAtMTEzMiwxMCArMTEyMCw3IEBAIHN0YXRp
YyBsb25nIGRvX2ZiX2lvY3RsKHN0cnVjdCBmYl9pbmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21k
LAogCQlpZiAoY29weV9mcm9tX3VzZXIoJnZhciwgYXJncCwgc2l6ZW9mKHZhcikpKQogCQkJcmV0
dXJuIC1FRkFVTFQ7CiAJCWNvbnNvbGVfbG9jaygpOwotCQlpZiAoIWxvY2tfZmJfaW5mbyhpbmZv
KSkgewotCQkJY29uc29sZV91bmxvY2soKTsKLQkJCXJldHVybiAtRU5PREVWOwotCQl9CisJCWxv
Y2tfZmJfaW5mbyhpbmZvKTsKIAkJaW5mby0+ZmxhZ3MgfD0gRkJJTkZPX01JU0NfVVNFUkVWRU5U
OwogCQlyZXQgPSBmYl9zZXRfdmFyKGluZm8sICZ2YXIpOwogCQlpbmZvLT5mbGFncyAmPSB+RkJJ
TkZPX01JU0NfVVNFUkVWRU5UOwpAQCAtMTE0NSw4ICsxMTMwLDcgQEAgc3RhdGljIGxvbmcgZG9f
ZmJfaW9jdGwoc3RydWN0IGZiX2luZm8gKmluZm8sIHVuc2lnbmVkIGludCBjbWQsCiAJCQlyZXQg
PSAtRUZBVUxUOwogCQlicmVhazsKIAljYXNlIEZCSU9HRVRfRlNDUkVFTklORk86Ci0JCWlmICgh
bG9ja19mYl9pbmZvKGluZm8pKQotCQkJcmV0dXJuIC1FTk9ERVY7CisJCWxvY2tfZmJfaW5mbyhp
bmZvKTsKIAkJZml4ID0gaW5mby0+Zml4OwogCQlpZiAoaW5mby0+ZmxhZ3MgJiBGQklORk9fSElE
RV9TTUVNX1NUQVJUKQogCQkJZml4LnNtZW1fc3RhcnQgPSAwOwpAQCAtMTE2Miw4ICsxMTQ2LDcg
QEAgc3RhdGljIGxvbmcgZG9fZmJfaW9jdGwoc3RydWN0IGZiX2luZm8gKmluZm8sIHVuc2lnbmVk
IGludCBjbWQsCiAJY2FzZSBGQklPR0VUQ01BUDoKIAkJaWYgKGNvcHlfZnJvbV91c2VyKCZjbWFw
LCBhcmdwLCBzaXplb2YoY21hcCkpKQogCQkJcmV0dXJuIC1FRkFVTFQ7Ci0JCWlmICghbG9ja19m
Yl9pbmZvKGluZm8pKQotCQkJcmV0dXJuIC1FTk9ERVY7CisJCWxvY2tfZmJfaW5mbyhpbmZvKTsK
IAkJY21hcF9mcm9tID0gaW5mby0+Y21hcDsKIAkJdW5sb2NrX2ZiX2luZm8oaW5mbyk7CiAJCXJl
dCA9IGZiX2NtYXBfdG9fdXNlcigmY21hcF9mcm9tLCAmY21hcCk7CkBAIC0xMTcyLDEwICsxMTU1
LDcgQEAgc3RhdGljIGxvbmcgZG9fZmJfaW9jdGwoc3RydWN0IGZiX2luZm8gKmluZm8sIHVuc2ln
bmVkIGludCBjbWQsCiAJCWlmIChjb3B5X2Zyb21fdXNlcigmdmFyLCBhcmdwLCBzaXplb2YodmFy
KSkpCiAJCQlyZXR1cm4gLUVGQVVMVDsKIAkJY29uc29sZV9sb2NrKCk7Ci0JCWlmICghbG9ja19m
Yl9pbmZvKGluZm8pKSB7Ci0JCQljb25zb2xlX3VubG9jaygpOwotCQkJcmV0dXJuIC1FTk9ERVY7
Ci0JCX0KKwkJbG9ja19mYl9pbmZvKGluZm8pOwogCQlyZXQgPSBmYl9wYW5fZGlzcGxheShpbmZv
LCAmdmFyKTsKIAkJdW5sb2NrX2ZiX2luZm8oaW5mbyk7CiAJCWNvbnNvbGVfdW5sb2NrKCk7CkBA
IC0xMTkyLDggKzExNzIsNyBAQCBzdGF0aWMgbG9uZyBkb19mYl9pb2N0bChzdHJ1Y3QgZmJfaW5m
byAqaW5mbywgdW5zaWduZWQgaW50IGNtZCwKIAkJCXJldHVybiAtRUlOVkFMOwogCQljb24yZmIu
ZnJhbWVidWZmZXIgPSAtMTsKIAkJZXZlbnQuZGF0YSA9ICZjb24yZmI7Ci0JCWlmICghbG9ja19m
Yl9pbmZvKGluZm8pKQotCQkJcmV0dXJuIC1FTk9ERVY7CisJCWxvY2tfZmJfaW5mbyhpbmZvKTsK
IAkJZXZlbnQuaW5mbyA9IGluZm87CiAJCWZiX25vdGlmaWVyX2NhbGxfY2hhaW4oRkJfRVZFTlRf
R0VUX0NPTlNPTEVfTUFQLCAmZXZlbnQpOwogCQl1bmxvY2tfZmJfaW5mbyhpbmZvKTsKQEAgLTEy
MTQsMTAgKzExOTMsNyBAQCBzdGF0aWMgbG9uZyBkb19mYl9pb2N0bChzdHJ1Y3QgZmJfaW5mbyAq
aW5mbywgdW5zaWduZWQgaW50IGNtZCwKIAkJfQogCQlldmVudC5kYXRhID0gJmNvbjJmYjsKIAkJ
Y29uc29sZV9sb2NrKCk7Ci0JCWlmICghbG9ja19mYl9pbmZvKGluZm8pKSB7Ci0JCQljb25zb2xl
X3VubG9jaygpOwotCQkJcmV0dXJuIC1FTk9ERVY7Ci0JCX0KKwkJbG9ja19mYl9pbmZvKGluZm8p
OwogCQlldmVudC5pbmZvID0gaW5mbzsKIAkJcmV0ID0gZmJfbm90aWZpZXJfY2FsbF9jaGFpbihG
Ql9FVkVOVF9TRVRfQ09OU09MRV9NQVAsICZldmVudCk7CiAJCXVubG9ja19mYl9pbmZvKGluZm8p
OwpAQCAtMTIyNSwxMCArMTIwMSw3IEBAIHN0YXRpYyBsb25nIGRvX2ZiX2lvY3RsKHN0cnVjdCBm
Yl9pbmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogCQlicmVhazsKIAljYXNlIEZCSU9CTEFO
SzoKIAkJY29uc29sZV9sb2NrKCk7Ci0JCWlmICghbG9ja19mYl9pbmZvKGluZm8pKSB7Ci0JCQlj
b25zb2xlX3VubG9jaygpOwotCQkJcmV0dXJuIC1FTk9ERVY7Ci0JCX0KKwkJbG9ja19mYl9pbmZv
KGluZm8pOwogCQlpbmZvLT5mbGFncyB8PSBGQklORk9fTUlTQ19VU0VSRVZFTlQ7CiAJCXJldCA9
IGZiX2JsYW5rKGluZm8sIGFyZyk7CiAJCWluZm8tPmZsYWdzICY9IH5GQklORk9fTUlTQ19VU0VS
RVZFTlQ7CkBAIC0xMjM2LDggKzEyMDksNyBAQCBzdGF0aWMgbG9uZyBkb19mYl9pb2N0bChzdHJ1
Y3QgZmJfaW5mbyAqaW5mbywgdW5zaWduZWQgaW50IGNtZCwKIAkJY29uc29sZV91bmxvY2soKTsK
IAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpCi0JCQlyZXR1
cm4gLUVOT0RFVjsKKwkJbG9ja19mYl9pbmZvKGluZm8pOwogCQlmYiA9IGluZm8tPmZib3BzOwog
CQlpZiAoZmItPmZiX2lvY3RsKQogCQkJcmV0ID0gZmItPmZiX2lvY3RsKGluZm8sIGNtZCwgYXJn
KTsKQEAgLTEzNTcsOCArMTMyOSw3IEBAIHN0YXRpYyBpbnQgZmJfZ2V0X2ZzY3JlZW5pbmZvKHN0
cnVjdCBmYl9pbmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogewogCXN0cnVjdCBmYl9maXhf
c2NyZWVuaW5mbyBmaXg7CiAKLQlpZiAoIWxvY2tfZmJfaW5mbyhpbmZvKSkKLQkJcmV0dXJuIC1F
Tk9ERVY7CisJbG9ja19mYl9pbmZvKGluZm8pOwogCWZpeCA9IGluZm8tPmZpeDsKIAlpZiAoaW5m
by0+ZmxhZ3MgJiBGQklORk9fSElERV9TTUVNX1NUQVJUKQogCQlmaXguc21lbV9zdGFydCA9IDA7
CkBAIC0xNDE4LDggKzEzODksNiBAQCBmYl9tbWFwKHN0cnVjdCBmaWxlICpmaWxlLCBzdHJ1Y3Qg
dm1fYXJlYV9zdHJ1Y3QgKiB2bWEpCiAJaWYgKCFpbmZvKQogCQlyZXR1cm4gLUVOT0RFVjsKIAlm
YiA9IGluZm8tPmZib3BzOwotCWlmICghZmIpCi0JCXJldHVybiAtRU5PREVWOwogCW11dGV4X2xv
Y2soJmluZm8tPm1tX2xvY2spOwogCWlmIChmYi0+ZmJfbW1hcCkgewogCQlpbnQgcmVzOwpAQCAt
MTQ4Myw3ICsxNDUyLDcgQEAgX19yZWxlYXNlcygmaW5mby0+bG9jaykKIAlpZiAoSVNfRVJSKGlu
Zm8pKQogCQlyZXR1cm4gUFRSX0VSUihpbmZvKTsKIAotCW11dGV4X2xvY2soJmluZm8tPmxvY2sp
OworCWxvY2tfZmJfaW5mbyhpbmZvKTsKIAlpZiAoIXRyeV9tb2R1bGVfZ2V0KGluZm8tPmZib3Bz
LT5vd25lcikpIHsKIAkJcmVzID0gLUVOT0RFVjsKIAkJZ290byBvdXQ7CkBAIC0xNDk5LDcgKzE0
NjgsNyBAQCBfX3JlbGVhc2VzKCZpbmZvLT5sb2NrKQogCQlmYl9kZWZlcnJlZF9pb19vcGVuKGlu
Zm8sIGlub2RlLCBmaWxlKTsKICNlbmRpZgogb3V0OgotCW11dGV4X3VubG9jaygmaW5mby0+bG9j
ayk7CisJdW5sb2NrX2ZiX2luZm8oaW5mbyk7CiAJaWYgKHJlcykKIAkJcHV0X2ZiX2luZm8oaW5m
byk7CiAJcmV0dXJuIHJlczsKQEAgLTE1MTIsMTEgKzE0ODEsMTEgQEAgX19yZWxlYXNlcygmaW5m
by0+bG9jaykKIHsKIAlzdHJ1Y3QgZmJfaW5mbyAqIGNvbnN0IGluZm8gPSBmaWxlLT5wcml2YXRl
X2RhdGE7CiAKLQltdXRleF9sb2NrKCZpbmZvLT5sb2NrKTsKKwlsb2NrX2ZiX2luZm8oaW5mbyk7
CiAJaWYgKGluZm8tPmZib3BzLT5mYl9yZWxlYXNlKQogCQlpbmZvLT5mYm9wcy0+ZmJfcmVsZWFz
ZShpbmZvLDEpOwogCW1vZHVsZV9wdXQoaW5mby0+ZmJvcHMtPm93bmVyKTsKLQltdXRleF91bmxv
Y2soJmluZm8tPmxvY2spOworCXVubG9ja19mYl9pbmZvKGluZm8pOwogCXB1dF9mYl9pbmZvKGlu
Zm8pOwogCXJldHVybiAwOwogfQpAQCAtMTczNCwxNCArMTcwMywxMCBAQCBzdGF0aWMgaW50IGRv
X3JlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogCQljb25zb2xl
X2xvY2soKTsKIAllbHNlCiAJCWF0b21pY19pbmMoJmlnbm9yZV9jb25zb2xlX2xvY2tfd2Fybmlu
Zyk7Ci0JaWYgKCFsb2NrX2ZiX2luZm8oZmJfaW5mbykpIHsKLQkJcmV0ID0gLUVOT0RFVjsKLQkJ
Z290byB1bmxvY2tfY29uc29sZTsKLQl9Ci0KKwlsb2NrX2ZiX2luZm8oZmJfaW5mbyk7CiAJcmV0
ID0gZmJjb25fZmJfcmVnaXN0ZXJlZChmYl9pbmZvKTsKIAl1bmxvY2tfZmJfaW5mbyhmYl9pbmZv
KTsKLXVubG9ja19jb25zb2xlOgorCiAJaWYgKCFsb2NrbGVzc19yZWdpc3Rlcl9mYikKIAkJY29u
c29sZV91bmxvY2soKTsKIAllbHNlCkBAIC0xNzU5LDExICsxNzI0LDcgQEAgc3RhdGljIGludCB1
bmJpbmRfY29uc29sZShzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKIAljb25zb2xlX2xvY2soKTsKLQlpZiAoIWxvY2tfZmJfaW5mbyhmYl9pbmZvKSkgewotCQlj
b25zb2xlX3VubG9jaygpOwotCQlyZXR1cm4gLUVOT0RFVjsKLQl9Ci0KKwlsb2NrX2ZiX2luZm8o
ZmJfaW5mbyk7CiAJZXZlbnQuaW5mbyA9IGZiX2luZm87CiAJcmV0ID0gZmJfbm90aWZpZXJfY2Fs
bF9jaGFpbihGQl9FVkVOVF9GQl9VTkJJTkQsICZldmVudCk7CiAJdW5sb2NrX2ZiX2luZm8oZmJf
aW5mbyk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2ZiLmggYi9pbmNsdWRlL2xpbnV4L2Zi
LmgKaW5kZXggMjg4MTc1ZmFmYWY2Li5hYThmMTgxNjMxNTEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
bGludXgvZmIuaAorKysgYi9pbmNsdWRlL2xpbnV4L2ZiLmgKQEAgLTY2Myw3ICs2NjMsMTAgQEAg
ZXh0ZXJuIHN0cnVjdCBjbGFzcyAqZmJfY2xhc3M7CiAJZm9yIChpID0gMDsgaSA8IEZCX01BWDsg
aSsrKQkJXAogCQlpZiAoIXJlZ2lzdGVyZWRfZmJbaV0pIHt9IGVsc2UKIAotZXh0ZXJuIGludCBs
b2NrX2ZiX2luZm8oc3RydWN0IGZiX2luZm8gKmluZm8pOworc3RhdGljIGlubGluZSB2b2lkIGxv
Y2tfZmJfaW5mbyhzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKK3sKKwltdXRleF9sb2NrKCZpbmZvLT5s
b2NrKTsKK30KIAogc3RhdGljIGlubGluZSB2b2lkIHVubG9ja19mYl9pbmZvKHN0cnVjdCBmYl9p
bmZvICppbmZvKQogewotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
