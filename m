Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6437CC01A9
	for <lists+dri-devel@lfdr.de>; Fri, 27 Sep 2019 11:03:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E02C86EEBA;
	Fri, 27 Sep 2019 09:03:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0CF1F6EEB9
 for <dri-devel@lists.freedesktop.org>; Fri, 27 Sep 2019 09:03:14 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 8F97CAFE3;
 Fri, 27 Sep 2019 09:03:12 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@linux.ie, daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v3 4/5] drm/ast: Move cursor offset swapping into
 ast_show_cursor()
Date: Fri, 27 Sep 2019 11:03:08 +0200
Message-Id: <20190927090309.10254-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190927090309.10254-1-tzimmermann@suse.de>
References: <20190927090309.10254-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2VsZWN0aW5nIHRoZSBjb3JyZWN0IG9mZnNldCBmb3IgdGhlIG5ldyBjdXJzb3IgaW1hZ2UgaXMg
bm90IHJlbGV2YW50Cm91dHNpZGUgb2YgYXN0X3Nob3dfY3Vyc29yKCkuIExldCB0aGUgZnVuY3Rp
b24gZG8gdGhlIHdvcmsuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1l
cm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tb2RlLmMgfCA1NyAr
KysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzEgaW5z
ZXJ0aW9ucygrKSwgMjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FzdC9hc3RfbW9kZS5jIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCmluZGV4IDEy
OTRmMDYxMmZkNS4uNmE1MTdmZmIxYzVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0
L2FzdF9tb2RlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCkBAIC0xMTUw
LDIzICsxMTUwLDM0IEBAIHN0YXRpYyB2b2lkIGFzdF9jdXJzb3Jfc2V0X2Jhc2Uoc3RydWN0IGFz
dF9wcml2YXRlICphc3QsIHU2NCBhZGRyZXNzKQogCWFzdF9zZXRfaW5kZXhfcmVnKGFzdCwgQVNU
X0lPX0NSVENfUE9SVCwgMHhjYSwgYWRkcjIpOwogfQogCi1zdGF0aWMgaW50IGFzdF9zaG93X2N1
cnNvcihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHZvaWQgKmRzdCwgdm9pZCAqc3JjLAotCQkJICAg
dW5zaWduZWQgaW50IHdpZHRoLCB1bnNpZ25lZCBpbnQgaGVpZ2h0LAotCQkJICAgdTY0IGRzdF9n
cHUpCitzdGF0aWMgaW50IGFzdF9zaG93X2N1cnNvcihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHZv
aWQgKnNyYywKKwkJCSAgIHVuc2lnbmVkIGludCB3aWR0aCwgdW5zaWduZWQgaW50IGhlaWdodCkK
IHsKIAlzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7CiAJ
c3RydWN0IGFzdF9jcnRjICphc3RfY3J0YyA9IHRvX2FzdF9jcnRjKGNydGMpOworCXN0cnVjdCBk
cm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CisJdTggKmRzdCwgKmRzdF9uZXh0OworCXM2NCBvZmY7
CiAJaW50IHJldDsKIAl1OCBqcmVnOwogCi0JZHN0ICs9IChBU1RfSFdDX1NJWkUgKyBBU1RfSFdD
X1NJR05BVFVSRV9TSVpFKSphc3QtPm5leHRfY3Vyc29yOworCWdibyA9IGRybV9nZW1fdnJhbV9v
Zl9nZW0oYXN0LT5jdXJzb3JfY2FjaGUpOworCWRzdCA9IGRybV9nZW1fdnJhbV92bWFwKGdibyk7
CisJaWYgKElTX0VSUihkc3QpKQorCQlyZXR1cm4gUFRSX0VSUihkc3QpOworCW9mZiA9IGRybV9n
ZW1fdnJhbV9vZmZzZXQoZ2JvKTsKKwlpZiAob2ZmIDwgMCkgeworCQlyZXQgPSAoaW50KW9mZjsK
KwkJZ290byBlcnJfZHJtX2dlbV92cmFtX3Z1bm1hcDsKKwl9CiAKLQlyZXQgPSBhc3RfY3Vyc29y
X3VwZGF0ZShkc3QsIHNyYywgd2lkdGgsIGhlaWdodCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJl
dDsKLQlhc3RfY3Vyc29yX3NldF9iYXNlKGFzdCwgZHN0X2dwdSk7CisJZHN0X25leHQgPSBkc3Qg
KyAoQVNUX0hXQ19TSVpFICsgQVNUX0hXQ19TSUdOQVRVUkVfU0laRSkgKgorCQkgICBhc3QtPm5l
eHRfY3Vyc29yOwogCi0JYXN0LT5uZXh0X2N1cnNvciA9IChhc3QtPm5leHRfY3Vyc29yICsgMSkg
JSBBU1RfREVGQVVMVF9IV0NfTlVNOworCXJldCA9IGFzdF9jdXJzb3JfdXBkYXRlKGRzdF9uZXh0
LCBzcmMsIHdpZHRoLCBoZWlnaHQpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2RybV9nZW1fdnJh
bV92dW5tYXA7CisJYXN0X2N1cnNvcl9zZXRfYmFzZShhc3QsIG9mZik7CiAKIAlhc3RfY3J0Yy0+
b2Zmc2V0X3ggPSBBU1RfTUFYX0hXQ19XSURUSCAtIHdpZHRoOwogCWFzdF9jcnRjLT5vZmZzZXRf
eSA9IEFTVF9NQVhfSFdDX1dJRFRIIC0gaGVpZ2h0OwpAQCAtMTE3Niw3ICsxMTg3LDE1IEBAIHN0
YXRpYyBpbnQgYXN0X3Nob3dfY3Vyc29yKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgdm9pZCAqZHN0
LCB2b2lkICpzcmMsCiAJanJlZyB8PSAxOwogCWFzdF9zZXRfaW5kZXhfcmVnX21hc2soYXN0LCBB
U1RfSU9fQ1JUQ19QT1JULCAweGNiLCAweGZjLCBqcmVnKTsKIAorCWFzdC0+bmV4dF9jdXJzb3Ig
PSAoYXN0LT5uZXh0X2N1cnNvciArIDEpICUgQVNUX0RFRkFVTFRfSFdDX05VTTsKKworCWRybV9n
ZW1fdnJhbV92dW5tYXAoZ2JvLCBkc3QpOworCiAJcmV0dXJuIDA7CisKK2Vycl9kcm1fZ2VtX3Zy
YW1fdnVubWFwOgorCWRybV9nZW1fdnJhbV92dW5tYXAoZ2JvLCBkc3QpOworCXJldHVybiByZXQ7
CiB9CiAKIHN0YXRpYyB2b2lkIGFzdF9oaWRlX2N1cnNvcihzdHJ1Y3QgZHJtX2NydGMgKmNydGMp
CkBAIC0xMTkyLDEyICsxMjExLDEwIEBAIHN0YXRpYyBpbnQgYXN0X2N1cnNvcl9zZXQoc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCQkJICB1aW50MzJfdCB3aWR0aCwKIAkJCSAgdWludDMyX3QgaGVp
Z2h0KQogewotCXN0cnVjdCBhc3RfcHJpdmF0ZSAqYXN0ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0
ZTsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgZHJtX2dlbV92cmFtX29i
amVjdCAqZ2JvOwotCXM2NCBkc3RfZ3B1OworCXU4ICpzcmM7CiAJaW50IHJldDsKLQl1OCAqc3Jj
LCAqZHN0OwogCiAJaWYgKCFoYW5kbGUpIHsKIAkJYXN0X2hpZGVfY3Vyc29yKGNydGMpOwpAQCAt
MTIxOSwyMSArMTIzNiw5IEBAIHN0YXRpYyBpbnQgYXN0X2N1cnNvcl9zZXQoc3RydWN0IGRybV9j
cnRjICpjcnRjLAogCQlnb3RvIGVycl9kcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQ7CiAJfQog
Ci0JZHN0ID0gZHJtX2dlbV92cmFtX2ttYXAoZHJtX2dlbV92cmFtX29mX2dlbShhc3QtPmN1cnNv
cl9jYWNoZSksCi0JCQkJZmFsc2UsIE5VTEwpOwotCWlmIChJU19FUlIoZHN0KSkgewotCQlyZXQg
PSBQVFJfRVJSKGRzdCk7Ci0JCWdvdG8gZXJyX2RybV9nZW1fdnJhbV92dW5tYXA7Ci0JfQotCWRz
dF9ncHUgPSBkcm1fZ2VtX3ZyYW1fb2Zmc2V0KGRybV9nZW1fdnJhbV9vZl9nZW0oYXN0LT5jdXJz
b3JfY2FjaGUpKTsKLQlpZiAoZHN0X2dwdSA8IDApIHsKLQkJcmV0ID0gKGludClkc3RfZ3B1Owot
CQlnb3RvIGVycl9kcm1fZ2VtX3ZyYW1fdnVubWFwOwotCX0KLQotCXJldCA9IGFzdF9zaG93X2N1
cnNvcihjcnRjLCBkc3QsIHNyYywgd2lkdGgsIGhlaWdodCwgZHN0X2dwdSk7CisJcmV0ID0gYXN0
X3Nob3dfY3Vyc29yKGNydGMsIHNyYywgd2lkdGgsIGhlaWdodCk7CiAJaWYgKHJldCkKLQkJZ290
byBlcnJfZHJtX2dlbV92cmFtX2t1bm1hcDsKKwkJZ290byBlcnJfZHJtX2dlbV92cmFtX3Z1bm1h
cDsKIAogCWRybV9nZW1fdnJhbV92dW5tYXAoZ2JvLCBzcmMpOwogCWRybV9nZW1fb2JqZWN0X3B1
dF91bmxvY2tlZChvYmopOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWw=
