Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9F1A85D16A
	for <lists+dri-devel@lfdr.de>; Tue,  2 Jul 2019 16:19:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3EB2289A56;
	Tue,  2 Jul 2019 14:19:19 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6C88489F6F
 for <dri-devel@lists.freedesktop.org>; Tue,  2 Jul 2019 14:19:15 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx06.intmail.prod.int.phx2.redhat.com
 [10.5.11.16])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 1A13C309265C;
 Tue,  2 Jul 2019 14:19:13 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-96.ams2.redhat.com
 [10.36.116.96])
 by smtp.corp.redhat.com (Postfix) with ESMTP id E63275C28D;
 Tue,  2 Jul 2019 14:19:08 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 7B0E21747C; Tue,  2 Jul 2019 16:19:04 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6 07/18] drm/virtio: add virtio_gpu_object_array & helpers
Date: Tue,  2 Jul 2019 16:18:52 +0200
Message-Id: <20190702141903.1131-8-kraxel@redhat.com>
In-Reply-To: <20190702141903.1131-1-kraxel@redhat.com>
References: <20190702141903.1131-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.16
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.43]); Tue, 02 Jul 2019 14:19:15 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Gerd Hoffmann <kraxel@redhat.com>, gurchetansingh@chromium.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U29tZSBoZWxwZXIgZnVuY3Rpb25zIHRvIG1hbmFnZSBhbiBhcnJheSBvZiBnZW0gb2JqZWN0cy4K
CnY2OgogLSBhZGQgdGlja2V0IHRvIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheS4KIC0g
YWRkIHZpcnRpb19ncHVfYXJyYXlfe2xvY2ssdW5sb2NrfV9yZXN2IGhlbHBlcnMuCiAtIGFkZCB2
aXJ0aW9fZ3B1X2FycmF5X2FkZF9mZW5jZSBoZWxwZXIuCnY1OiBzb21lIHNtYWxsIG9wdGltaXph
dGlvbnMgKENoaWEtSSBXdSkuCnY0OiBtYWtlIHRoZW0gdmlydGlvLXByaXZhdGUgaW5zdGVhZCBv
ZiBnZW5lcmljIGhlbHBlcnMuCgpTaWduZWQtb2ZmLWJ5OiBHZXJkIEhvZmZtYW5uIDxrcmF4ZWxA
cmVkaGF0LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmggfCAx
NyArKysrKysKIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyB8IDgzICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgMTAwIGluc2VydGlvbnMo
KykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmggYi9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKaW5kZXggMDdmNjAwMWVhOTFlLi5h
YmIwNzhhNWRlZGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9k
cnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKQEAgLTg0LDYg
Kzg0LDEyIEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCB7CiAjZGVmaW5lIGdlbV90b192aXJ0
aW9fZ3B1X29iaihnb2JqKSBcCiAJY29udGFpbmVyX29mKChnb2JqKSwgc3RydWN0IHZpcnRpb19n
cHVfb2JqZWN0LCBnZW1fYmFzZSkKIAorc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5IHsK
KwlzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggdGlja2V0OworCXUzMiBuZW50cywgdG90YWw7CisJc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmpzW107Cit9OworCiBzdHJ1Y3QgdmlydGlvX2dwdV92YnVm
ZmVyOwogc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlOwogCkBAIC0yNTEsNiArMjU3LDE3IEBAIGlu
dCB2aXJ0aW9fZ3B1X21vZGVfZHVtYl9tbWFwKHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAog
CQkJICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAgICAgIHVpbnQzMl90IGhhbmRs
ZSwgdWludDY0X3QgKm9mZnNldF9wKTsKIAorc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5
ICp2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKHUzMiBuZW50cyk7CitzdHJ1Y3QgdmlydGlvX2dwdV9v
YmplY3RfYXJyYXkqCit2aXJ0aW9fZ3B1X2FycmF5X2Zyb21faGFuZGxlcyhzdHJ1Y3QgZHJtX2Zp
bGUgKmRybV9maWxlLCB1MzIgKmhhbmRsZXMsIHUzMiBuZW50cyk7Cit2b2lkIHZpcnRpb19ncHVf
YXJyYXlfYWRkX29iaihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMsCisJCQkg
ICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CitpbnQgdmlydGlvX2dwdV9hcnJheV9s
b2NrX3Jlc3Yoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzKTsKK3ZvaWQgdmly
dGlvX2dwdV9hcnJheV91bmxvY2tfcmVzdihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkg
Km9ianMpOwordm9pZCB2aXJ0aW9fZ3B1X2FycmF5X2FkZF9mZW5jZShzdHJ1Y3QgdmlydGlvX2dw
dV9vYmplY3RfYXJyYXkgKm9ianMsCisJCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwordm9p
ZCB2aXJ0aW9fZ3B1X2FycmF5X3B1dF9mcmVlKHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJh
eSAqb2Jqcyk7CisKIC8qIHZpcnRpbyB2ZyAqLwogaW50IHZpcnRpb19ncHVfYWxsb2NfdmJ1ZnMo
c3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rldik7CiB2b2lkIHZpcnRpb19ncHVfZnJlZV92
YnVmcyhzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8v
dmlydGdwdV9nZW0uYwppbmRleCA5YzlhZDNiMTQwODAuLmU4OGRmNWUwNmQwNiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYwpAQCAtMTY5LDMgKzE2OSw4NiBAQCB2b2lkIHZpcnRp
b19ncHVfZ2VtX29iamVjdF9jbG9zZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKIAkJCQkJ
CXFvYmotPmh3X3Jlc19oYW5kbGUpOwogCXZpcnRpb19ncHVfb2JqZWN0X3VucmVzZXJ2ZShxb2Jq
KTsKIH0KKworc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICp2aXJ0aW9fZ3B1X2FycmF5
X2FsbG9jKHUzMiBuZW50cykKK3sKKwlzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9i
anM7CisJc2l6ZV90IHNpemUgPSBzaXplb2YoKm9ianMpICsgc2l6ZW9mKG9ianMtPm9ianNbMF0p
ICogbmVudHM7CisKKwlvYmpzID0ga21hbGxvYyhzaXplLCBHRlBfS0VSTkVMKTsKKwlpZiAoIW9i
anMpCisJCXJldHVybiBOVUxMOworCisJb2Jqcy0+bmVudHMgPSAwOworCW9ianMtPnRvdGFsID0g
bmVudHM7CisJcmV0dXJuIG9ianM7Cit9CisKK3N0YXRpYyB2b2lkIHZpcnRpb19ncHVfYXJyYXlf
ZnJlZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMpCit7CisJa2ZyZWUob2Jq
cyk7Cit9CisKK3N0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSoKK3ZpcnRpb19ncHVfYXJy
YXlfZnJvbV9oYW5kbGVzKHN0cnVjdCBkcm1fZmlsZSAqZHJtX2ZpbGUsIHUzMiAqaGFuZGxlcywg
dTMyIG5lbnRzKQoreworCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqczsKKwl1
MzIgaTsKKworCW9ianMgPSB2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKG5lbnRzKTsKKwlpZiAoIW9i
anMpCisJCXJldHVybiBOVUxMOworCisJZm9yIChpID0gMDsgaSA8IG5lbnRzOyBpKyspIHsKKwkJ
b2Jqcy0+bmVudHMgPSBpOworCQlvYmpzLT5vYmpzW2ldID0gZHJtX2dlbV9vYmplY3RfbG9va3Vw
KGRybV9maWxlLCBoYW5kbGVzW2ldKTsKKwkJaWYgKCFvYmpzLT5vYmpzW2ldKSB7CisJCQl2aXJ0
aW9fZ3B1X2FycmF5X3B1dF9mcmVlKG9ianMpOworCQkJcmV0dXJuIE5VTEw7CisJCX0KKwl9CisJ
b2Jqcy0+bmVudHMgPSBpOworCXJldHVybiBvYmpzOworfQorCit2b2lkIHZpcnRpb19ncHVfYXJy
YXlfYWRkX29iaihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMsCisJCQkgICAg
ICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKK3sKKwlpZiAoV0FSTl9PTl9PTkNFKG9ianMt
Pm5lbnRzID09IG9ianMtPnRvdGFsKSkKKwkJcmV0dXJuOworCisJZHJtX2dlbV9vYmplY3RfZ2V0
KG9iaik7CisJb2Jqcy0+b2Jqc1tvYmpzLT5uZW50c10gPSBvYmo7CisJb2Jqcy0+bmVudHMrKzsK
K30KKworaW50IHZpcnRpb19ncHVfYXJyYXlfbG9ja19yZXN2KHN0cnVjdCB2aXJ0aW9fZ3B1X29i
amVjdF9hcnJheSAqb2JqcykKK3sKKwlyZXR1cm4gZHJtX2dlbV9sb2NrX3Jlc2VydmF0aW9ucyhv
YmpzLT5vYmpzLCBvYmpzLT5uZW50cywKKwkJCQkJICZvYmpzLT50aWNrZXQpOworfQorCit2b2lk
IHZpcnRpb19ncHVfYXJyYXlfdW5sb2NrX3Jlc3Yoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2Fy
cmF5ICpvYmpzKQoreworCWRybV9nZW1fdW5sb2NrX3Jlc2VydmF0aW9ucyhvYmpzLT5vYmpzLCBv
YmpzLT5uZW50cywKKwkJCQkgICAgJm9ianMtPnRpY2tldCk7Cit9CisKK3ZvaWQgdmlydGlvX2dw
dV9hcnJheV9hZGRfZmVuY2Uoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzLAor
CQkJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCWludCBpOworCisJZm9yIChpID0gMDsg
aSA8IG9ianMtPm5lbnRzOyBpKyspCisJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5j
ZShvYmpzLT5vYmpzW2ldLT5yZXN2LAorCQkJCQkJICBmZW5jZSk7Cit9CisKK3ZvaWQgdmlydGlv
X2dwdV9hcnJheV9wdXRfZnJlZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMp
Cit7CisJdTMyIGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgb2Jqcy0+bmVudHM7IGkrKykKKwkJZHJt
X2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKG9ianMtPm9ianNbaV0pOworCXZpcnRpb19ncHVfYXJy
YXlfZnJlZShvYmpzKTsKK30KLS0gCjIuMTguMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
