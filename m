Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B2A86107B32
	for <lists+dri-devel@lfdr.de>; Sat, 23 Nov 2019 00:16:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B2BE66E147;
	Fri, 22 Nov 2019 23:16:42 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from us-smtp-1.mimecast.com (us-smtp-delivery-1.mimecast.com
 [205.139.110.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7449E6E147
 for <dri-devel@lists.freedesktop.org>; Fri, 22 Nov 2019 23:16:41 +0000 (UTC)
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-136-hXZSNByxP1C4M6HXbAiXLA-1; Fri, 22 Nov 2019 18:16:38 -0500
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id D2948DB60;
 Fri, 22 Nov 2019 23:16:36 +0000 (UTC)
Received: from malachite.bss.redhat.com (dhcp-10-20-1-34.bss.redhat.com
 [10.20.1.34])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 651C519C4F;
 Fri, 22 Nov 2019 23:16:35 +0000 (UTC)
From: Lyude Paul <lyude@redhat.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 1/5] drm/i915: Fix eDP DPCD aux max backlight calculations
Date: Fri, 22 Nov 2019 18:15:59 -0500
Message-Id: <20191122231616.2574-2-lyude@redhat.com>
In-Reply-To: <20191122231616.2574-1-lyude@redhat.com>
References: <20191122231616.2574-1-lyude@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-MC-Unique: hXZSNByxP1C4M6HXbAiXLA-1
X-Mimecast-Spam-Score: 0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=redhat.com; 
 s=mimecast20190719; t=1574464600;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=y7+pPq2W8n/QnP/QN4TfV1Jv02YEm+xZX8RYtdz5s+Y=;
 b=L6QFmdYZBOKh7BXk0y5tbcjy1gtCuuBd/s0tei/Xrs8vInRhesKTA13Jsu1bClgdVvlhft
 I6S8kDqP947pnuBr4Qium6dipI4Zrttm9iQSrT52CFFSB8Rgw6Wb8rOc0rCSnidPLqvaG+
 h1Ob6oCetrVesbzUyyGCkDq34Z5fnNE=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Furquan Shaikh <furquan@google.com>, David Airlie <airlied@linux.ie>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Rodrigo Vivi <rodrigo.vivi@intel.com>, Lee Shawn C <shawn.c.lee@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWF4IGJhY2tsaWdodCB2YWx1ZSBmb3IgdGhlIHBhbmVsIHdhcyBiZWluZyBjYWxjdWxhdGVkIHVz
aW5nIGJ5dGUKY291bnQgaS5lLiAweGZmZmYgaWYgMiBieXRlcyBhcmUgc3VwcG9ydGVkIGZvciBi
YWNrbGlnaHQgYnJpZ2h0bmVzcwphbmQgMHhmZiBpZiAxIGJ5dGUgaXMgc3VwcG9ydGVkLiBIb3dl
dmVyLCBFRFBfUFdNR0VOX0JJVF9DT1VOVApkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2YgYWN0aXZl
IGNvbnRyb2wgYml0cyB1c2VkIGZvciB0aGUgYnJpZ2h0bmVzcwpzZXR0aW5nLiBUaHVzLCBldmVu
IGlmIHRoZSBwYW5lbCB1c2VzIDIgYnl0ZSBzZXR0aW5nLCBpdCBtaWdodCBub3QgdXNlCmFsbCB0
aGUgY29udHJvbCBiaXRzLiBUaHVzLCBtYXggYmFja2xpZ2h0IHNob3VsZCBiZSBzZXQgYmFzZWQg
b24gdGhlCnZhbHVlIG9mIEVEUF9QV01HRU5fQklUX0NPVU5UIGluc3RlYWQgb2YgYXNzdW1pbmcg
NjU1MzUgb3IgMjU1LgoKQWRkaXRpb25hbGx5LCBFRFBfUFdNR0VOX0JJVF9DT1VOVCB3YXMgYmVp
bmcgdXBkYXRlZCBiYXNlZCBvbiB0aGUgVkJUCmZyZXF1ZW5jeSB3aGljaCByZXN1bHRzIGluIGEg
ZGlmZmVyZW50IG1heCBiYWNrbGlnaHQgdmFsdWUuIFRodXMsCnNldHRpbmcgb2YgRURQX1BXTUdF
Tl9CSVRfQ09VTlQgaXMgbW92ZWQgdG8gc2V0dXAgcGhhc2UgaW5zdGVhZCBvZgplbmFibGUgc28g
dGhhdCBtYXggYmFja2xpZ2h0IGNhbiBiZSBjYWxjdWxhdGVkIGNvcnJlY3RseS4gT25seSB0aGUK
ZnJlcXVlbmN5IGRpdmlkZXIgaXMgc2V0IGR1cmluZyB0aGUgZW5hYmxlIHBoYXNlIHVzaW5nIHRo
ZSB2YWx1ZSBvZgpFRFBfUFdNR0VOX0JJVF9DT1VOVC4KClRoaXMgaXMgYmFzZWQgb2ZmIHRoZSBv
cmlnaW5hbCBwYXRjaCBzZXJpZXMgZnJvbSBGdXJxdWFuIFNoYWlraAo8ZnVycXVhbkBnb29nbGUu
Y29tPjoKCmh0dHBzOi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9wYXRjaC8zMTcyNTUvP3Nl
cmllcz02MjMyNiZyZXY9MwoKQ2hhbmdlcyBzaW5jZSBvcmlnaW5hbCBwYXRjaDoKKiBSZW1vdmUg
dW51c2VkIGludGVsX2RwIHZhcmlhYmxlIGluIGludGVsX2RwX2F1eF9zZXR1cF9iYWNrbGlnaHQo
KQoqIEZpeCBjaGVja3BhdGNoIGlzc3VlcwoqIE1ha2Ugc3VyZSB0aGF0IHdlIHJld3JpdGUgdGhl
IHB3bWdlbiBiaXQgY291bnQgd2hlbmV2ZXIgd2UgYnJpbmcgdGhlCiAgcGFuZWwgb3V0IG9mIEQz
IG1vZGUKCkNjOiBGdXJxdWFuIFNoYWlraCA8ZnVycXVhbkBnb29nbGUuY29tPgpTaWduZWQtb2Zm
LWJ5OiBMeXVkZSBQYXVsIDxseXVkZUByZWRoYXQuY29tPgotLS0KIC4uLi9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAgMyArCiAuLi4vZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMgfCAxMzkgKysrKysrKysrKysrLS0tLS0tCiAyIGZp
bGVzIGNoYW5nZWQsIDk1IGluc2VydGlvbnMoKyksIDQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXgg
ODNlYTA0MTQ5Yjc3Li4yYThkOGNhZTYzOGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC0yMTQsNiArMjE0LDkgQEAgc3Ry
dWN0IGludGVsX3BhbmVsIHsKIAkJdTggY29udHJvbGxlcjsJCS8qIGJ4dCsgb25seSAqLwogCQlz
dHJ1Y3QgcHdtX2RldmljZSAqcHdtOwogCisJCS8qIERQQ0QgYmFja2xpZ2h0ICovCisJCXU4IHB3
bWdlbl9iaXRfY291bnQ7CisKIAkJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmRldmljZTsKIAog
CQkvKiBDb25uZWN0b3IgYW5kIHBsYXRmb3JtIHNwZWNpZmljIGJhY2tsaWdodCBmdW5jdGlvbnMg
Ki8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4
X2JhY2tsaWdodC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXhf
YmFja2xpZ2h0LmMKaW5kZXggMDIwNDIyZGEyYWUyLi5mYWQ0NzA1NTNjZjkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5j
CkBAIC0xMTEsNjEgKzExMSwyOCBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kcF9hdXhfc2V0X3B3bV9m
cmVxKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rvci0+ZW5j
b2Rlci0+YmFzZSk7Ci0JaW50IGZyZXEsIGZ4cCwgZnhwX21pbiwgZnhwX21heCwgZnhwX2FjdHVh
bCwgZiA9IDE7Ci0JdTggcG4sIHBuX21pbiwgcG5fbWF4OworCWNvbnN0IHU4IHBuID0gY29ubmVj
dG9yLT5wYW5lbC5iYWNrbGlnaHQucHdtZ2VuX2JpdF9jb3VudDsKKwlpbnQgZnJlcSwgZnhwLCBm
LCBmeHBfYWN0dWFsLCBmeHBfbWluLCBmeHBfbWF4OwogCi0JLyogRmluZCBkZXNpcmVkIHZhbHVl
IG9mIChGIHggUCkKLQkgKiBOb3RlIHRoYXQsIGlmIEYgeCBQIGlzIG91dCBvZiBzdXBwb3J0ZWQg
cmFuZ2UsIHRoZSBtYXhpbXVtIHZhbHVlIG9yCi0JICogbWluaW11bSB2YWx1ZSB3aWxsIGFwcGxp
ZWQgYXV0b21hdGljYWxseS4gU28gbm8gbmVlZCB0byBjaGVjayB0aGF0LgotCSAqLwogCWZyZXEg
PSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oejsKLQlEUk1fREVCVUdfS01TKCJW
QlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5ICV1IEh6XG4iLCBmcmVxKTsKIAlpZiAoIWZy
ZXEpIHsKIAkJRFJNX0RFQlVHX0tNUygiVXNlIHBhbmVsIGRlZmF1bHQgYmFja2xpZ2h0IGZyZXF1
ZW5jeVxuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKIAlmeHAgPSBESVZfUk9VTkRfQ0xPU0VT
VChLSHooRFBfRURQX0JBQ0tMSUdIVF9GUkVRX0JBU0VfS0haKSwgZnJlcSk7CisJZiA9IGNsYW1w
KERJVl9ST1VORF9DTE9TRVNUKGZ4cCwgMSA8PCBwbiksIDEsIDI1NSk7CisJZnhwX2FjdHVhbCA9
IGYgPDwgcG47CiAKLQkvKiBVc2UgaGlnaGVzdCBwb3NzaWJsZSB2YWx1ZSBvZiBQbiBmb3IgbW9y
ZSBncmFudWxhcml0eSBvZiBicmlnaHRuZXNzCi0JICogYWRqdXN0bWVudCB3aGlsZSBzYXRpZnlp
bmcgdGhlIGNvbmRpdGlvbnMgYmVsb3cuCi0JICogLSBQbiBpcyBpbiB0aGUgcmFuZ2Ugb2YgUG5f
bWluIGFuZCBQbl9tYXgKLQkgKiAtIEYgaXMgaW4gdGhlIHJhbmdlIG9mIDEgYW5kIDI1NQotCSAq
IC0gRnhQIGlzIHdpdGhpbiAyNSUgb2YgZGVzaXJlZCB2YWx1ZS4KLQkgKiAgIE5vdGU6IDI1JSBp
cyBhcmJpdHJhcnkgdmFsdWUgYW5kIG1heSBuZWVkIHNvbWUgdHdlYWsuCi0JICovCi0JaWYgKGRy
bV9kcF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LAotCQkJICAgICAgIERQX0VEUF9QV01HRU5f
QklUX0NPVU5UX0NBUF9NSU4sICZwbl9taW4pICE9IDEpIHsKLQkJRFJNX0RFQlVHX0tNUygiRmFp
bGVkIHRvIHJlYWQgcHdtZ2VuIGJpdCBjb3VudCBjYXAgbWluXG4iKTsKLQkJcmV0dXJuIGZhbHNl
OwotCX0KLQlpZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsCi0JCQkgICAgICAg
RFBfRURQX1BXTUdFTl9CSVRfQ09VTlRfQ0FQX01BWCwgJnBuX21heCkgIT0gMSkgewotCQlEUk1f
REVCVUdfS01TKCJGYWlsZWQgdG8gcmVhZCBwd21nZW4gYml0IGNvdW50IGNhcCBtYXhcbiIpOwot
CQlyZXR1cm4gZmFsc2U7Ci0JfQotCXBuX21pbiAmPSBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVF9N
QVNLOwotCXBuX21heCAmPSBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVF9NQVNLOwotCisJLyogRW5z
dXJlIGZyZXF1ZW5jeSBpcyB3aXRoaW4gMjUlIG9mIGRlc2lyZWQgdmFsdWUgKi8KIAlmeHBfbWlu
ID0gRElWX1JPVU5EX0NMT1NFU1QoZnhwICogMywgNCk7CiAJZnhwX21heCA9IERJVl9ST1VORF9D
TE9TRVNUKGZ4cCAqIDUsIDQpOwotCWlmIChmeHBfbWluIDwgKDEgPDwgcG5fbWluKSB8fCAoMjU1
IDw8IHBuX21heCkgPCBmeHBfbWF4KSB7Ci0JCURSTV9ERUJVR19LTVMoIlZCVCBkZWZpbmVkIGJh
Y2tsaWdodCBmcmVxdWVuY3kgb3V0IG9mIHJhbmdlXG4iKTsKLQkJcmV0dXJuIGZhbHNlOwotCX0K
LQotCWZvciAocG4gPSBwbl9tYXg7IHBuID49IHBuX21pbjsgcG4tLSkgewotCQlmID0gY2xhbXAo
RElWX1JPVU5EX0NMT1NFU1QoZnhwLCAxIDw8IHBuKSwgMSwgMjU1KTsKLQkJZnhwX2FjdHVhbCA9
IGYgPDwgcG47Ci0JCWlmIChmeHBfbWluIDw9IGZ4cF9hY3R1YWwgJiYgZnhwX2FjdHVhbCA8PSBm
eHBfbWF4KQotCQkJYnJlYWs7Ci0JfQogCi0JaWYgKGRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxf
ZHAtPmF1eCwKLQkJCSAgICAgICBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVCwgcG4pIDwgMCkgewot
CQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gd3JpdGUgYXV4IHB3bWdlbiBiaXQgY291bnRcbiIp
OworCWlmIChmeHBfbWluID4gZnhwX2FjdHVhbCB8fCBmeHBfYWN0dWFsID4gZnhwX21heCkgewor
CQlEUk1fREVCVUdfS01TKCJBY3R1YWwgZnJlcXVlbmN5IG91dCBvZiByYW5nZVxuIik7CiAJCXJl
dHVybiBmYWxzZTsKIAl9CisKIAlpZiAoZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4
LAogCQkJICAgICAgIERQX0VEUF9CQUNLTElHSFRfRlJFUV9TRVQsICh1OCkgZikgPCAwKSB7CiAJ
CURSTV9ERUJVR19LTVMoIkZhaWxlZCB0byB3cml0ZSBhdXggYmFja2xpZ2h0IGZyZXFcbiIpOwpA
QCAtMTc4LDYgKzE0NSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2F1eF9lbmFibGVfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0CiAJCQkJCSAgY29uc3Qg
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNv
bm5lY3Rvcik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVs
OwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmNvbm5lY3Rv
ci0+ZW5jb2Rlci0+YmFzZSk7CiAJdTggZHBjZF9idWYsIG5ld19kcGNkX2J1ZiwgZWRwX2JhY2ts
aWdodF9tb2RlOwogCkBAIC0xOTcsNiArMTY1LDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2F1
eF9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
CiAJY2FzZSBEUF9FRFBfQkFDS0xJR0hUX0NPTlRST0xfTU9ERV9QUk9EVUNUOgogCQluZXdfZHBj
ZF9idWYgJj0gfkRQX0VEUF9CQUNLTElHSFRfQ09OVFJPTF9NT0RFX01BU0s7CiAJCW5ld19kcGNk
X2J1ZiB8PSBEUF9FRFBfQkFDS0xJR0hUX0NPTlRST0xfTU9ERV9EUENEOworCisJCWlmIChkcm1f
ZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsCisJCQkJICAgICAgIERQX0VEUF9QV01HRU5f
QklUX0NPVU5ULAorCQkJCSAgICAgICBwYW5lbC0+YmFja2xpZ2h0LnB3bWdlbl9iaXRfY291bnQp
IDwgMCkKKwkJCURSTV9ERUJVR19LTVMoIkZhaWxlZCB0byB3cml0ZSBhdXggcHdtZ2VuIGJpdCBj
b3VudFxuIik7CisKIAkJYnJlYWs7CiAKIAkvKiBEbyBub3RoaW5nIHdoZW4gaXQgaXMgYWxyZWFk
eSBEUENEIG1vZGUgKi8KQEAgLTIyNSwyMCArMTk5LDkxIEBAIHN0YXRpYyB2b2lkIGludGVsX2Rw
X2F1eF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAq
b2xkCiAJc2V0X2F1eF9iYWNrbGlnaHRfZW5hYmxlKGVuY190b19pbnRlbF9kcChvbGRfY29ubl9z
dGF0ZS0+YmVzdF9lbmNvZGVyKSwgZmFsc2UpOwogfQogCitzdGF0aWMgdTMyIGludGVsX2RwX2F1
eF9jYWxjX21heF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9k
cCgmY29ubmVjdG9yLT5lbmNvZGVyLT5iYXNlKTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVs
ID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIG1heF9iYWNrbGlnaHQgPSAwOworCWludCBmcmVx
LCBmeHAsIGZ4cF9taW4sIGZ4cF9tYXgsIGZ4cF9hY3R1YWwsIGYgPSAxOworCXU4IHBuLCBwbl9t
aW4sIHBuX21heDsKKworCWlmIChkcm1fZHBfZHBjZF9yZWFkYigmaW50ZWxfZHAtPmF1eCwgRFBf
RURQX1BXTUdFTl9CSVRfQ09VTlQsICZwbikpIHsKKwkJcG4gJj0gRFBfRURQX1BXTUdFTl9CSVRf
Q09VTlRfTUFTSzsKKwkJbWF4X2JhY2tsaWdodCA9ICgxIDw8IHBuKSAtIDE7CisJfQorCisJLyog
RmluZCBkZXNpcmVkIHZhbHVlIG9mIChGIHggUCkKKwkgKiBOb3RlIHRoYXQsIGlmIEYgeCBQIGlz
IG91dCBvZiBzdXBwb3J0ZWQgcmFuZ2UsIHRoZSBtYXhpbXVtIHZhbHVlIG9yCisJICogbWluaW11
bSB2YWx1ZSB3aWxsIGFwcGxpZWQgYXV0b21hdGljYWxseS4gU28gbm8gbmVlZCB0byBjaGVjayB0
aGF0LgorCSAqLworCWZyZXEgPSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oejsK
KwlEUk1fREVCVUdfS01TKCJWQlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5ICV1IEh6XG4i
LCBmcmVxKTsKKwlpZiAoIWZyZXEpIHsKKwkJRFJNX0RFQlVHX0tNUygiVXNlIHBhbmVsIGRlZmF1
bHQgYmFja2xpZ2h0IGZyZXF1ZW5jeVxuIik7CisJCXJldHVybiBtYXhfYmFja2xpZ2h0OworCX0K
KworCWZ4cCA9IERJVl9ST1VORF9DTE9TRVNUKEtIeihEUF9FRFBfQkFDS0xJR0hUX0ZSRVFfQkFT
RV9LSFopLCBmcmVxKTsKKworCS8qIFVzZSBoaWdoZXN0IHBvc3NpYmxlIHZhbHVlIG9mIFBuIGZv
ciBtb3JlIGdyYW51bGFyaXR5IG9mIGJyaWdodG5lc3MKKwkgKiBhZGp1c3RtZW50IHdoaWxlIHNh
dGlmeWluZyB0aGUgY29uZGl0aW9ucyBiZWxvdy4KKwkgKiAtIFBuIGlzIGluIHRoZSByYW5nZSBv
ZiBQbl9taW4gYW5kIFBuX21heAorCSAqIC0gRiBpcyBpbiB0aGUgcmFuZ2Ugb2YgMSBhbmQgMjU1
CisJICogLSBGeFAgaXMgd2l0aGluIDI1JSBvZiBkZXNpcmVkIHZhbHVlLgorCSAqICAgTm90ZTog
MjUlIGlzIGFyYml0cmFyeSB2YWx1ZSBhbmQgbWF5IG5lZWQgc29tZSB0d2Vhay4KKwkgKi8KKwlp
ZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsCisJCQkgICAgICBEUF9FRFBfUFdN
R0VOX0JJVF9DT1VOVF9DQVBfTUlOLCAmcG5fbWluKSAhPSAxKSB7CisJCURSTV9ERUJVR19LTVMo
IkZhaWxlZCB0byByZWFkIHB3bWdlbiBiaXQgY291bnQgY2FwIG1pblxuIik7CisJCXJldHVybiBt
YXhfYmFja2xpZ2h0OworCX0KKwlpZiAoZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgs
CisJCQkgICAgICBEUF9FRFBfUFdNR0VOX0JJVF9DT1VOVF9DQVBfTUFYLCAmcG5fbWF4KSAhPSAx
KSB7CisJCURSTV9ERUJVR19LTVMoIkZhaWxlZCB0byByZWFkIHB3bWdlbiBiaXQgY291bnQgY2Fw
IG1heFxuIik7CisJCXJldHVybiBtYXhfYmFja2xpZ2h0OworCX0KKwlwbl9taW4gJj0gRFBfRURQ
X1BXTUdFTl9CSVRfQ09VTlRfTUFTSzsKKwlwbl9tYXggJj0gRFBfRURQX1BXTUdFTl9CSVRfQ09V
TlRfTUFTSzsKKworCWZ4cF9taW4gPSBESVZfUk9VTkRfQ0xPU0VTVChmeHAgKiAzLCA0KTsKKwlm
eHBfbWF4ID0gRElWX1JPVU5EX0NMT1NFU1QoZnhwICogNSwgNCk7CisJaWYgKGZ4cF9taW4gPCAo
MSA8PCBwbl9taW4pIHx8ICgyNTUgPDwgcG5fbWF4KSA8IGZ4cF9tYXgpIHsKKwkJRFJNX0RFQlVH
X0tNUygiVkJUIGRlZmluZWQgYmFja2xpZ2h0IGZyZXF1ZW5jeSBvdXQgb2YgcmFuZ2VcbiIpOwor
CQlyZXR1cm4gbWF4X2JhY2tsaWdodDsKKwl9CisKKwlmb3IgKHBuID0gcG5fbWF4OyBwbiA+PSBw
bl9taW47IHBuLS0pIHsKKwkJZiA9IGNsYW1wKERJVl9ST1VORF9DTE9TRVNUKGZ4cCwgMSA8PCBw
biksIDEsIDI1NSk7CisJCWZ4cF9hY3R1YWwgPSBmIDw8IHBuOworCQlpZiAoZnhwX21pbiA8PSBm
eHBfYWN0dWFsICYmIGZ4cF9hY3R1YWwgPD0gZnhwX21heCkKKwkJCWJyZWFrOworCX0KKworCURS
TV9ERUJVR19LTVMoIlVzaW5nIGVEUCBwd21nZW4gYml0IGNvdW50IG9mICVkXG4iLCBwbik7CisJ
aWYgKGRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1eCwKKwkJCSAgICAgICBEUF9FRFBf
UFdNR0VOX0JJVF9DT1VOVCwgcG4pIDwgMCkgeworCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8g
d3JpdGUgYXV4IHB3bWdlbiBiaXQgY291bnRcbiIpOworCQlyZXR1cm4gbWF4X2JhY2tsaWdodDsK
Kwl9CisJcGFuZWwtPmJhY2tsaWdodC5wd21nZW5fYml0X2NvdW50ID0gcG47CisKKwltYXhfYmFj
a2xpZ2h0ID0gKDEgPDwgcG4pIC0gMTsKKworCXJldHVybiBtYXhfYmFja2xpZ2h0OworfQorCiBz
dGF0aWMgaW50IGludGVsX2RwX2F1eF9zZXR1cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLAogCQkJCQllbnVtIHBpcGUgcGlwZSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZjb25uZWN0b3ItPmVuY29kZXItPmJhc2Up
OwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAotCWlm
IChpbnRlbF9kcC0+ZWRwX2RwY2RbMl0gJiBEUF9FRFBfQkFDS0xJR0hUX0JSSUdIVE5FU1NfQllU
RV9DT1VOVCkKLQkJcGFuZWwtPmJhY2tsaWdodC5tYXggPSAweEZGRkY7Ci0JZWxzZQotCQlwYW5l
bC0+YmFja2xpZ2h0Lm1heCA9IDB4RkY7CisJcGFuZWwtPmJhY2tsaWdodC5tYXggPSBpbnRlbF9k
cF9hdXhfY2FsY19tYXhfYmFja2xpZ2h0KGNvbm5lY3Rvcik7CisJaWYgKCFwYW5lbC0+YmFja2xp
Z2h0Lm1heCkKKwkJcmV0dXJuIC1FTk9ERVY7CiAKIAlwYW5lbC0+YmFja2xpZ2h0Lm1pbiA9IDA7
CiAJcGFuZWwtPmJhY2tsaWdodC5sZXZlbCA9IGludGVsX2RwX2F1eF9nZXRfYmFja2xpZ2h0KGNv
bm5lY3Rvcik7Ci0KIAlwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQgPSBwYW5lbC0+YmFja2xpZ2h0
LmxldmVsICE9IDA7CiAKIAlyZXR1cm4gMDsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
