Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5CFBDD157F
	for <lists+dri-devel@lfdr.de>; Wed,  9 Oct 2019 19:23:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 84DD96EA24;
	Wed,  9 Oct 2019 17:23:56 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F39436EA1F
 for <dri-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 17:23:53 +0000 (UTC)
Received: from sasha-vm.mshome.net (unknown [167.220.2.234])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id AE394218DE;
 Wed,  9 Oct 2019 17:23:53 +0000 (UTC)
From: Sasha Levin <sashal@kernel.org>
To: linux-kernel@vger.kernel.org,
	stable@vger.kernel.org
Subject: [PATCH AUTOSEL 5.3 02/68] drm: Free the writeback_job when it with an
 empty fb
Date: Wed,  9 Oct 2019 13:04:41 -0400
Message-Id: <20191009170547.32204-2-sashal@kernel.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191009170547.32204-1-sashal@kernel.org>
References: <20191009170547.32204-1-sashal@kernel.org>
MIME-Version: 1.0
X-stable: review
X-Patchwork-Hint: Ignore
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=kernel.org; s=default; t=1570641833;
 bh=K02rh1HsZkrO5DpDzfg0K9uNvLOc6lHlJ8tW9pFGt+0=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Cd6Q9R6iyZSwnf2sUjMSrLHYgtSpWVD5esuQnyhbfK7iEoIDHW2b8CjpKiva6XWhK
 cAUskU5vGFLgMo/ivHt9vquVSexuBFOqeax8W8deZNeNzHCwZd6awcxXDGSRK/vT2/
 3ba3Ijblb/bYtAXtLWlSYG3+W52FaJhApWpy8K6c=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sasha Levin <sashal@kernel.org>, linux-sh@vger.kernel.org,
 Liviu Dudau <liviu.dudau@arm.com>, dri-devel@lists.freedesktop.org,
 James Qian Wang <james.qian.wang@arm.com>, Lowry Li <lowry.li@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogIkxvd3J5IExpIChBcm0gVGVjaG5vbG9neSBDaGluYSkiIDxMb3dyeS5MaUBhcm0uY29t
PgoKWyBVcHN0cmVhbSBjb21taXQgODU4MWQ1MTA1NWEwOGNjNmViMDYxYzg4NTYwNjIyOTBlODU4
MmNlNCBdCgpBZGRzIHRoZSBjaGVjayBpZiB0aGUgd3JpdGViYWNrX2pvYiB3aXRoIGFuIGVtcHR5
IGZiLCB0aGVuIGl0IHNob3VsZApiZSBmcmVlZCBpbiBhdG9taWNfY2hlY2sgcGhhc2UuCgpXaXRo
IHRoaXMgY2hhbmdlLCB0aGUgZHJpdmVyIHVzZXJzIHdpbGwgbm90IGNoZWNrIGVtcHR5IGZiIGNh
c2UgYW55IG1vcmUuClNvIHJlZmluZWQgYWNjb3JkaW5nbHkuCgpTaWduZWQtb2ZmLWJ5OiBMb3dy
eSBMaSAoQXJtIFRlY2hub2xvZ3kgQ2hpbmEpIDxsb3dyeS5saUBhcm0uY29tPgpSZXZpZXdlZC1i
eTogTGl2aXUgRHVkYXUgPGxpdml1LmR1ZGF1QGFybS5jb20+ClJldmlld2VkLWJ5OiBKYW1lcyBR
aWFuIFdhbmcgKEFybSBUZWNobm9sb2d5IENoaW5hKSA8amFtZXMucWlhbi53YW5nQGFybS5jb20+
ClNpZ25lZC1vZmYtYnk6IGphbWVzIHFpYW4gd2FuZyAoQXJtIFRlY2hub2xvZ3kgQ2hpbmEpIDxq
YW1lcy5xaWFuLndhbmdAYXJtLmNvbT4KTGluazogaHR0cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0
b3Aub3JnL3BhdGNoL21zZ2lkLzE1NjQ1NzEwNDgtMTUwMjktMi1naXQtc2VuZC1lbWFpbC1sb3dy
eS5saUBhcm0uY29tClNpZ25lZC1vZmYtYnk6IFNhc2hhIExldmluIDxzYXNoYWxAa2VybmVsLm9y
Zz4KLS0tCiAuLi4vZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfd2JfY29ubmVjdG9yLmMg
ICAgfCAgMyArLS0KIGRyaXZlcnMvZ3B1L2RybS9hcm0vbWFsaWRwX213LmMgICAgICAgICAgICAg
ICAgICAgICB8ICA0ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMgICAgICAgICAg
ICAgICAgICAgICAgICB8IDEzICsrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfd3JpdGViYWNrLmMgICAgICAgICB8ICA0ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS92
YzQvdmM0X3R4cC5jICAgICAgICAgICAgICAgICAgICAgICB8ICA1ICsrLS0tCiA1IGZpbGVzIGNo
YW5nZWQsIDE2IGluc2VydGlvbnMoKyksIDEzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21lZGEva29tZWRhX3diX2Nvbm5lY3Rvci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfd2JfY29ubmVjdG9yLmMK
aW5kZXggMjg1MWNhYzk0ZDg2OS4uMjNmYmVlMjY4MTE5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfd2JfY29ubmVjdG9yLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfd2JfY29ubmVjdG9yLmMKQEAg
LTQzLDkgKzQzLDggQEAga29tZWRhX3diX2VuY29kZXJfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1f
ZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3Qga29tZWRhX2RhdGFfZmxvd19jZmcgZGZsb3c7CiAJ
aW50IGVycjsKIAotCWlmICghd3JpdGViYWNrX2pvYiB8fCAhd3JpdGViYWNrX2pvYi0+ZmIpIHsK
KwlpZiAoIXdyaXRlYmFja19qb2IpCiAJCXJldHVybiAwOwotCX0KIAogCWlmICghY3J0Y19zdC0+
YWN0aXZlKSB7CiAJCURSTV9ERUJVR19BVE9NSUMoIkNhbm5vdCB3cml0ZSB0aGUgY29tcG9zaXRp
b24gcmVzdWx0IG91dCBvbiBhIGluYWN0aXZlIENSVEMuXG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hcm0vbWFsaWRwX213LmMgYi9kcml2ZXJzL2dwdS9kcm0vYXJtL21hbGlkcF9t
dy5jCmluZGV4IDJlODEyNTI1MDI1ZGQuLmE1OTIyN2IyY2RiNTUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hcm0vbWFsaWRwX213LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FybS9tYWxp
ZHBfbXcuYwpAQCAtMTMwLDcgKzEzMCw3IEBAIG1hbGlkcF9td19lbmNvZGVyX2F0b21pY19jaGVj
ayhzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmI7CiAJaW50IGksIG5fcGxhbmVzOwogCi0JaWYgKCFjb25uX3N0YXRlLT53cml0ZWJhY2tfam9i
IHx8ICFjb25uX3N0YXRlLT53cml0ZWJhY2tfam9iLT5mYikKKwlpZiAoIWNvbm5fc3RhdGUtPndy
aXRlYmFja19qb2IpCiAJCXJldHVybiAwOwogCiAJZmIgPSBjb25uX3N0YXRlLT53cml0ZWJhY2tf
am9iLT5mYjsKQEAgLTI0Nyw3ICsyNDcsNyBAQCB2b2lkIG1hbGlkcF9td19hdG9taWNfY29tbWl0
KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sCiAKIAltd19zdGF0ZSA9IHRvX213X3N0YXRlKGNvbm5f
c3RhdGUpOwogCi0JaWYgKGNvbm5fc3RhdGUtPndyaXRlYmFja19qb2IgJiYgY29ubl9zdGF0ZS0+
d3JpdGViYWNrX2pvYi0+ZmIpIHsKKwlpZiAoY29ubl9zdGF0ZS0+d3JpdGViYWNrX2pvYikgewog
CQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IGNvbm5fc3RhdGUtPndyaXRlYmFja19qb2It
PmZiOwogCiAJCURSTV9ERVZfREVCVUdfRFJJVkVSKGRybS0+ZGV2LApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2RybV9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMK
aW5kZXggNDE5MzgxYWJiZGQxNi4uMTRhZWFmNzM2MzIxMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2RybV9hdG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCkBA
IC00MzAsMTAgKzQzMCwxNSBAQCBzdGF0aWMgaW50IGRybV9hdG9taWNfY29ubmVjdG9yX2NoZWNr
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCXJldHVybiAtRUlOVkFMOwogCX0K
IAotCWlmICh3cml0ZWJhY2tfam9iLT5vdXRfZmVuY2UgJiYgIXdyaXRlYmFja19qb2ItPmZiKSB7
Ci0JCURSTV9ERUJVR19BVE9NSUMoIltDT05ORUNUT1I6JWQ6JXNdIHJlcXVlc3Rpbmcgb3V0LWZl
bmNlIHdpdGhvdXQgZnJhbWVidWZmZXJcbiIsCi0JCQkJIGNvbm5lY3Rvci0+YmFzZS5pZCwgY29u
bmVjdG9yLT5uYW1lKTsKLQkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKCF3cml0ZWJhY2tfam9iLT5m
YikgeworCQlpZiAod3JpdGViYWNrX2pvYi0+b3V0X2ZlbmNlKSB7CisJCQlEUk1fREVCVUdfQVRP
TUlDKCJbQ09OTkVDVE9SOiVkOiVzXSByZXF1ZXN0aW5nIG91dC1mZW5jZSB3aXRob3V0IGZyYW1l
YnVmZmVyXG4iLAorCQkJCQkgY29ubmVjdG9yLT5iYXNlLmlkLCBjb25uZWN0b3ItPm5hbWUpOwor
CQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKworCQlkcm1fd3JpdGViYWNrX2NsZWFudXBfam9iKHdy
aXRlYmFja19qb2IpOworCQlzdGF0ZS0+d3JpdGViYWNrX2pvYiA9IE5VTEw7CiAJfQogCiAJcmV0
dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X3dyaXRl
YmFjay5jIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV93cml0ZWJhY2suYwppbmRl
eCBhZTA3MjkwYmJhNmE0Li4wNGVmYTc4ZDcwYjZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vcmNhci1kdS9yY2FyX2R1X3dyaXRlYmFjay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L3JjYXJfZHVfd3JpdGViYWNrLmMKQEAgLTE0Nyw3ICsxNDcsNyBAQCBzdGF0aWMgaW50IHJj
YXJfZHVfd2JfZW5jX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmRldjsKIAlzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYjsKIAotCWlmICghY29ubl9zdGF0ZS0+d3JpdGViYWNrX2pvYiB8fCAhY29ubl9z
dGF0ZS0+d3JpdGViYWNrX2pvYi0+ZmIpCisJaWYgKCFjb25uX3N0YXRlLT53cml0ZWJhY2tfam9i
KQogCQlyZXR1cm4gMDsKIAogCWZiID0gY29ubl9zdGF0ZS0+d3JpdGViYWNrX2pvYi0+ZmI7CkBA
IC0yMjEsNyArMjIxLDcgQEAgdm9pZCByY2FyX2R1X3dyaXRlYmFja19zZXR1cChzdHJ1Y3QgcmNh
cl9kdV9jcnRjICpyY3J0YywKIAl1bnNpZ25lZCBpbnQgaTsKIAogCXN0YXRlID0gcmNydGMtPndy
aXRlYmFjay5iYXNlLnN0YXRlOwotCWlmICghc3RhdGUgfHwgIXN0YXRlLT53cml0ZWJhY2tfam9i
IHx8ICFzdGF0ZS0+d3JpdGViYWNrX2pvYi0+ZmIpCisJaWYgKCFzdGF0ZSB8fCAhc3RhdGUtPndy
aXRlYmFja19qb2IpCiAJCXJldHVybjsKIAogCWZiID0gc3RhdGUtPndyaXRlYmFja19qb2ItPmZi
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZjNC92YzRfdHhwLmMgYi9kcml2ZXJzL2dw
dS9kcm0vdmM0L3ZjNF90eHAuYwppbmRleCA5NmY5MWMxYjRiNmU2Li5lOTJmYTEyNzUwMzQzIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF90eHAuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vdmM0L3ZjNF90eHAuYwpAQCAtMjI5LDcgKzIyOSw3IEBAIHN0YXRpYyBpbnQgdmM0X3R4
cF9jb25uZWN0b3JfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uLAogCWlu
dCBpOwogCiAJY29ubl9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X25ld19jb25uZWN0b3Jfc3RhdGUo
c3RhdGUsIGNvbm4pOwotCWlmICghY29ubl9zdGF0ZS0+d3JpdGViYWNrX2pvYiB8fCAhY29ubl9z
dGF0ZS0+d3JpdGViYWNrX2pvYi0+ZmIpCisJaWYgKCFjb25uX3N0YXRlLT53cml0ZWJhY2tfam9i
KQogCQlyZXR1cm4gMDsKIAogCWNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19z
dGF0ZShzdGF0ZSwgY29ubl9zdGF0ZS0+Y3J0Yyk7CkBAIC0yNjksOCArMjY5LDcgQEAgc3RhdGlj
IHZvaWQgdmM0X3R4cF9jb25uZWN0b3JfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubiwKIAl1MzIgY3RybDsKIAlpbnQgaTsKIAotCWlmIChXQVJOX09OKCFjb25uX3N0YXRl
LT53cml0ZWJhY2tfam9iIHx8Ci0JCSAgICAhY29ubl9zdGF0ZS0+d3JpdGViYWNrX2pvYi0+ZmIp
KQorCWlmIChXQVJOX09OKCFjb25uX3N0YXRlLT53cml0ZWJhY2tfam9iKSkKIAkJcmV0dXJuOwog
CiAJbW9kZSA9ICZjb25uX3N0YXRlLT5jcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZTsKLS0gCjIu
MjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
