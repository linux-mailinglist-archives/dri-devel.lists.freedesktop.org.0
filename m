Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A5D0031A93F
	for <lists+dri-devel@lfdr.de>; Sat, 13 Feb 2021 02:08:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0E22B6F3D8;
	Sat, 13 Feb 2021 01:08:45 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM12-MW2-obe.outbound.protection.outlook.com
 (mail-mw2nam12on2069.outbound.protection.outlook.com [40.107.244.69])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 780666F3D8;
 Sat, 13 Feb 2021 01:08:44 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=BJhJ1LEG/WqyrJgTvPg9OTFJDOjKR8OkigThRn2TzgTOghbb1l7GlnUr7sIQokFz577CfOOXVH5QCMrBmB1D0RJlvsllEctwDb97TpPWuZR6OaXrm8wVZ0yhZ+w1N+7+ozB717M8LWX126DGXcT4Wf/OVtqELxwlGxHEBdLGbRMLJRIqI507JMoCKBFIOWEAbYNGT+S8gzNpO+6YdsxHXIAvck1vOgK3SruLkpY1e2WUkVoLV7/fhowHw/b5kKG3wfJ3EeBfPpPc8KlFlzT0U28H/MxC+hRrwcFOP4GN4xM0K8UitlVFE0pO5gS3t2o43BC8kK4IrCyX/jGw+nS8Rg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=c3tZjyjmQ39RQk4y5n1Gw3w8lb1CYW518q7M1v7vo5Y=;
 b=Zs9+AzvVOPCCDHOIHHMjNbVSUIYsqFo9keQUiehM43QI/MGbiZFyvi/+14xFzJojG4WH8n849Iz+SUy4kkg5DndwWsxmp9RubBnT9++oT/IpnWL02AAYGSjhqTDvohW7CYh4zEZsI+XJQt3M7sgrB7cEfR1wGFgAg9duvrl5pwfN34EiPDFxkmUqFulseGFFoNc670O630tQXXcAM7V+AKyxgVDupl0U86Wv7Hhuh48m/cSys0Ylxiak4/EPVlJuMoQHIN6Dvmfd/l5/r10O6cLX7Pr8rdb6kNsD1rDOio63W3n/DlqR9o7WBcp7BtNh4hC7E3SRUYcL/frlh6Qr/w==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=softfail (sender ip
 is 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com; dmarc=fail (p=none sp=none pct=100) action=none
 header.from=amd.com; dkim=none (message not signed); arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=c3tZjyjmQ39RQk4y5n1Gw3w8lb1CYW518q7M1v7vo5Y=;
 b=rVFVOW/kriY50FflWLitvtd0AcNDQjlmD8vK7IMSO9BEGpw6Fnp2QEBjq3lWfaeWwZ6Mj5tHi2wD5Wtdm3QC09JBVFgKL8ocV3ycAKmXRYtBOV1uFdwEGcwI80LJmmSQHeLRRQEUOviSvq3pkCz8Gi59wGGdWG9R7ZREDOXRN2c=
Received: from DS7PR03CA0059.namprd03.prod.outlook.com (2603:10b6:5:3b5::34)
 by MWHPR12MB1791.namprd12.prod.outlook.com (2603:10b6:300:113::10) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3825.25; Sat, 13 Feb
 2021 01:08:42 +0000
Received: from DM6NAM11FT058.eop-nam11.prod.protection.outlook.com
 (2603:10b6:5:3b5:cafe::57) by DS7PR03CA0059.outlook.office365.com
 (2603:10b6:5:3b5::34) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3846.25 via Frontend
 Transport; Sat, 13 Feb 2021 01:08:42 +0000
X-MS-Exchange-Authentication-Results: spf=softfail (sender IP is
 165.204.84.17) smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none
 (message not signed) header.d=none;lists.freedesktop.org; dmarc=fail
 action=none header.from=amd.com;
Received-SPF: SoftFail (protection.outlook.com: domain of transitioning
 amd.com discourages use of 165.204.84.17 as permitted sender)
Received: from SATLEXMB01.amd.com (165.204.84.17) by
 DM6NAM11FT058.mail.protection.outlook.com (10.13.172.216) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.3846.25 via Frontend Transport; Sat, 13 Feb 2021 01:08:41 +0000
Received: from SATLEXMB05.amd.com (10.181.40.146) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Fri, 12 Feb
 2021 19:08:40 -0600
Received: from SATLEXMB02.amd.com (10.181.40.143) by SATLEXMB05.amd.com
 (10.181.40.146) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Fri, 12 Feb
 2021 19:08:40 -0600
Received: from elite-desk-aura.amd.com (10.180.168.240) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server id 15.1.1979.3 via
 Frontend Transport; Fri, 12 Feb 2021 19:08:39 -0600
From: Aurabindo Pillai <aurabindo.pillai@amd.com>
To: <amd-gfx@lists.freedesktop.org>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH v6 3/3] drm/amd/display: Skip modeset for front porch change
Date: Fri, 12 Feb 2021 20:08:27 -0500
Message-ID: <20210213010827.261272-4-aurabindo.pillai@amd.com>
X-Mailer: git-send-email 2.30.0
In-Reply-To: <20210213010827.261272-1-aurabindo.pillai@amd.com>
References: <20210213010827.261272-1-aurabindo.pillai@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 8c312501-5413-4fa6-b91b-08d8cfbbe6f3
X-MS-TrafficTypeDiagnostic: MWHPR12MB1791:
X-Microsoft-Antispam-PRVS: <MWHPR12MB17911A27EA5F7845A2FE73EE8B8A9@MWHPR12MB1791.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:556;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: h0g2/WUrIDtGRzta4xOjCcBEgq5+1hAx76XnDg5V0gNQj1bh9Ia3wJ4xeE50qd3LwsXt/OvS3kVWaKORNe3iUrSSKqSpAdxUoiv22J9LgUp4Hz8q/au+oMcGRiEqezoMh54ZNzDnRT9awt7a2OAQXOaIxMH50ETgo8mL0xORv5EX8+0mM/l1gcPC63H4Zcn0FWGhaOe1SBQIemdEfIUSxVJsNJceNL7zi2L7YYFG1lGXtIxY5T9bPJkbtN5FbdrpU4nyy1UHAbXmHTJi52tD3H1/O6GZ9DRzOMdd6hsc9YbgTzRTybf8M/biqEe+RilHPktwmIByba8r/iX7d8uGg7R8fUFCVyEWELzVBUJlOKQONH2TKt7Rl93FuRSW0BCZ/JptYUKxkJ0MeOtyB0PiWQhrNwcGiVq2JYSaathWJkrMpQCSj12YDy9tuTMocJA1QByeEXtRrTfC3PG35V2mEi7w87de5iRX06/Ivv9miZywkEu7WMj3IvjdwEVqXUNkVbT/zMQZjSp/5xsmGlW2T00KOG9o3Qhlf4OrKXTPFHEpGz/xdZFrF85TQe/RE037A2zD3TdviIS1zppxSHprlF3yMgf9xeelp09ZJ9RGhhDOFQMoKoEfNs4rU/QEsz/WmfQYvUcinppBWm9h6YsKUKvBFe2v/CW/9MGIK5WWOcY12733aF9oc+lFhItYx4F9
X-Forefront-Antispam-Report: CIP:165.204.84.17; CTRY:US; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:SATLEXMB01.amd.com; PTR:ErrorRetry; CAT:NONE;
 SFS:(4636009)(39860400002)(136003)(396003)(376002)(346002)(36840700001)(46966006)(1076003)(5660300002)(66574015)(8676002)(82310400003)(426003)(86362001)(30864003)(36756003)(36860700001)(450100002)(6666004)(81166007)(44832011)(2616005)(110136005)(356005)(82740400003)(336012)(70586007)(54906003)(7696005)(186003)(83380400001)(26005)(2906002)(478600001)(47076005)(70206006)(8936002)(316002)(4326008)(36900700001);
 DIR:OUT; SFP:1101; 
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 13 Feb 2021 01:08:41.2502 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 8c312501-5413-4fa6-b91b-08d8cfbbe6f3
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB01.amd.com]
X-MS-Exchange-CrossTenant-AuthSource: DM6NAM11FT058.eop-nam11.prod.protection.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Anonymous
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MWHPR12MB1791
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: stylon.wang@amd.com, shashank.sharma@amd.com,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 aurabindo.pillai@amd.com, wayne.lin@amd.com, alexander.deucher@amd.com,
 nicholas.kazlauskas@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

W1doeV0KQSBzZWFtbGVzcyB0cmFuc2l0aW9uIGJldHdlZW4gbW9kZXMgY2FuIGJlIHBlcmZvcm1l
ZCBpZiB0aGUgbmV3IGluY29taW5nCm1vZGUgaGFzIHRoZSBzYW1lIHRpbWluZyBwYXJhbWV0ZXJz
IGFzIHRoZSBvcHRpbWl6ZWQgbW9kZSBvbiBhIGRpc3BsYXkgd2l0aCBhCnZhcmlhYmxlIHZ0b3Rh
bCBtaW4vbWF4LgoKU21vb3RoIHZpZGVvIHBsYXliYWNrIHVzZWNhc2VzIGNhbiBiZSBlbmFibGVk
IHdpdGggdGhpcyBzZWFtbGVzcyB0cmFuc2l0aW9uIGJ5CnN3aXRjaGluZyB0byBhIG5ldyBtb2Rl
IHdoaWNoIGhhcyBhIHJlZnJlc2ggcmF0ZSBtYXRjaGluZyB0aGUgdmlkZW8uCgpbSG93XQpTa2lw
IGZ1bGwgbW9kZXNldCBpZiB1c2Vyc3BhY2UgcmVxdWVzdGVkIGEgY29tcGF0aWJsZSBmcmVlc3lu
YyBtb2RlIHdoaWNoIG9ubHkKZGlmZmVycyBpbiB0aGUgZnJvbnQgcG9yY2ggdGltaW5nIGZyb20g
dGhlIGN1cnJlbnQgbW9kZS4KClNpZ25lZC1vZmYtYnk6IEF1cmFiaW5kbyBQaWxsYWkgPGF1cmFi
aW5kby5waWxsYWlAYW1kLmNvbT4KQWNrZWQtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlh
bi5rb2VuaWdAYW1kLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0v
YW1kZ3B1X2RtLmMgfCAyMjAgKysrKysrKysrKysrKystLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTgw
IGluc2VydGlvbnMoKyksIDQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4IGM0NzI5MDVjN2Q3Mi4uNjI4
ZmVjODU1ZTE0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1
X2RtL2FtZGdwdV9kbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVf
ZG0vYW1kZ3B1X2RtLmMKQEAgLTIxMiw2ICsyMTIsOSBAQCBzdGF0aWMgYm9vbCBhbWRncHVfZG1f
cHNyX2Rpc2FibGVfYWxsKHN0cnVjdCBhbWRncHVfZGlzcGxheV9tYW5hZ2VyICpkbSk7CiBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqCiBhbWRfZ2V0X2Zvcm1hdF9pbmZvKGNv
bnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICpjbWQpOwogCitzdGF0aWMgYm9vbAoraXNfdGlt
aW5nX3VuY2hhbmdlZF9mb3JfZnJlZXN5bmMoc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSwKKwkJCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7CiAv
KgogICogZG1fdmJsYW5rX2dldF9jb3VudGVyCiAgKgpAQCAtMzM1LDYgKzMzOCwxNyBAQCBzdGF0
aWMgaW5saW5lIGJvb2wgYW1kZ3B1X2RtX3Zycl9hY3RpdmUoc3RydWN0IGRtX2NydGNfc3RhdGUg
KmRtX3N0YXRlKQogCSAgICAgICBkbV9zdGF0ZS0+ZnJlZXN5bmNfY29uZmlnLnN0YXRlID09IFZS
Ul9TVEFURV9BQ1RJVkVfRklYRUQ7CiB9CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBpc19kY190aW1p
bmdfYWRqdXN0X25lZWRlZChzdHJ1Y3QgZG1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlLAorCQkJCQkg
ICAgICBzdHJ1Y3QgZG1fY3J0Y19zdGF0ZSAqbmV3X3N0YXRlKQoreworCWlmIChuZXdfc3RhdGUt
PmZyZWVzeW5jX2NvbmZpZy5zdGF0ZSA9PSAgVlJSX1NUQVRFX0FDVElWRV9GSVhFRCkKKwkJcmV0
dXJuIHRydWU7CisJZWxzZSBpZiAoYW1kZ3B1X2RtX3Zycl9hY3RpdmUob2xkX3N0YXRlKSAhPSBh
bWRncHVfZG1fdnJyX2FjdGl2ZShuZXdfc3RhdGUpKQorCQlyZXR1cm4gdHJ1ZTsKKwllbHNlCisJ
CXJldHVybiBmYWxzZTsKK30KKwogLyoqCiAgKiBkbV9wZmxpcF9oaWdoX2lycSgpIC0gSGFuZGxl
IHBhZ2VmbGlwIGludGVycnVwdAogICogQGludGVycnVwdF9wYXJhbXM6IGlnbm9yZWQKQEAgLTUw
MDgsMTkgKzUwMjIsMTYgQEAgc3RhdGljIHZvaWQgZmlsbF9zdHJlYW1fcHJvcGVydGllc19mcm9t
X2RybV9kaXNwbGF5X21vZGUoCiAJCXRpbWluZ19vdXQtPmhkbWlfdmljID0gaHZfZnJhbWUudmlj
OwogCX0KIAotCXRpbWluZ19vdXQtPmhfYWRkcmVzc2FibGUgPSBtb2RlX2luLT5jcnRjX2hkaXNw
bGF5OwotCXRpbWluZ19vdXQtPmhfdG90YWwgPSBtb2RlX2luLT5jcnRjX2h0b3RhbDsKLQl0aW1p
bmdfb3V0LT5oX3N5bmNfd2lkdGggPQotCQltb2RlX2luLT5jcnRjX2hzeW5jX2VuZCAtIG1vZGVf
aW4tPmNydGNfaHN5bmNfc3RhcnQ7Ci0JdGltaW5nX291dC0+aF9mcm9udF9wb3JjaCA9Ci0JCW1v
ZGVfaW4tPmNydGNfaHN5bmNfc3RhcnQgLSBtb2RlX2luLT5jcnRjX2hkaXNwbGF5OwotCXRpbWlu
Z19vdXQtPnZfdG90YWwgPSBtb2RlX2luLT5jcnRjX3Z0b3RhbDsKLQl0aW1pbmdfb3V0LT52X2Fk
ZHJlc3NhYmxlID0gbW9kZV9pbi0+Y3J0Y192ZGlzcGxheTsKLQl0aW1pbmdfb3V0LT52X2Zyb250
X3BvcmNoID0KLQkJbW9kZV9pbi0+Y3J0Y192c3luY19zdGFydCAtIG1vZGVfaW4tPmNydGNfdmRp
c3BsYXk7Ci0JdGltaW5nX291dC0+dl9zeW5jX3dpZHRoID0KLQkJbW9kZV9pbi0+Y3J0Y192c3lu
Y19lbmQgLSBtb2RlX2luLT5jcnRjX3ZzeW5jX3N0YXJ0OwotCXRpbWluZ19vdXQtPnBpeF9jbGtf
MTAwaHogPSBtb2RlX2luLT5jcnRjX2Nsb2NrICogMTA7CisJdGltaW5nX291dC0+aF9hZGRyZXNz
YWJsZSA9IG1vZGVfaW4tPmhkaXNwbGF5OworCXRpbWluZ19vdXQtPmhfdG90YWwgPSBtb2RlX2lu
LT5odG90YWw7CisJdGltaW5nX291dC0+aF9zeW5jX3dpZHRoID0gbW9kZV9pbi0+aHN5bmNfZW5k
IC0gbW9kZV9pbi0+aHN5bmNfc3RhcnQ7CisJdGltaW5nX291dC0+aF9mcm9udF9wb3JjaCA9IG1v
ZGVfaW4tPmhzeW5jX3N0YXJ0IC0gbW9kZV9pbi0+aGRpc3BsYXk7CisJdGltaW5nX291dC0+dl90
b3RhbCA9IG1vZGVfaW4tPnZ0b3RhbDsKKwl0aW1pbmdfb3V0LT52X2FkZHJlc3NhYmxlID0gbW9k
ZV9pbi0+dmRpc3BsYXk7CisJdGltaW5nX291dC0+dl9mcm9udF9wb3JjaCA9IG1vZGVfaW4tPnZz
eW5jX3N0YXJ0IC0gbW9kZV9pbi0+dmRpc3BsYXk7CisJdGltaW5nX291dC0+dl9zeW5jX3dpZHRo
ID0gbW9kZV9pbi0+dnN5bmNfZW5kIC0gbW9kZV9pbi0+dnN5bmNfc3RhcnQ7CisJdGltaW5nX291
dC0+cGl4X2Nsa18xMDBoeiA9IG1vZGVfaW4tPmNsb2NrICogMTA7CisKIAl0aW1pbmdfb3V0LT5h
c3BlY3RfcmF0aW8gPSBnZXRfYXNwZWN0X3JhdGlvKG1vZGVfaW4pOwogCiAJc3RyZWFtLT5vdXRw
dXRfY29sb3Jfc3BhY2UgPSBnZXRfb3V0cHV0X2NvbG9yX3NwYWNlKHRpbWluZ19vdXQpOwpAQCAt
NTI0MCw2ICs1MjUxLDMzIEBAIGdldF9oaWdoZXN0X3JlZnJlc2hfcmF0ZV9tb2RlKHN0cnVjdCBh
bWRncHVfZG1fY29ubmVjdG9yICphY29ubmVjdG9yLAogCXJldHVybiBtX3ByZWY7CiB9CiAKK3N0
YXRpYyBib29sIGlzX2ZyZWVzeW5jX3ZpZGVvX21vZGUoc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsCisJCQkJICAgc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFjb25uZWN0b3IpCit7
CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmhpZ2hfbW9kZTsKKwlpbnQgdGltaW5nX2RpZmY7
CisKKwloaWdoX21vZGUgPSBnZXRfaGlnaGVzdF9yZWZyZXNoX3JhdGVfbW9kZShhY29ubmVjdG9y
LCBmYWxzZSk7CisJaWYgKCFoaWdoX21vZGUgfHwgIW1vZGUpCisJCXJldHVybiBmYWxzZTsKKwor
CXRpbWluZ19kaWZmID0gaGlnaF9tb2RlLT52dG90YWwgLSBtb2RlLT52dG90YWw7CisKKwlpZiAo
aGlnaF9tb2RlLT5jbG9jayA9PSAwIHx8IGhpZ2hfbW9kZS0+Y2xvY2sgIT0gbW9kZS0+Y2xvY2sg
fHwKKwkgICAgaGlnaF9tb2RlLT5oZGlzcGxheSAhPSBtb2RlLT5oZGlzcGxheSB8fAorCSAgICBo
aWdoX21vZGUtPnZkaXNwbGF5ICE9IG1vZGUtPnZkaXNwbGF5IHx8CisJICAgIGhpZ2hfbW9kZS0+
aHN5bmNfc3RhcnQgIT0gbW9kZS0+aHN5bmNfc3RhcnQgfHwKKwkgICAgaGlnaF9tb2RlLT5oc3lu
Y19lbmQgIT0gbW9kZS0+aHN5bmNfZW5kIHx8CisJICAgIGhpZ2hfbW9kZS0+aHRvdGFsICE9IG1v
ZGUtPmh0b3RhbCB8fAorCSAgICBoaWdoX21vZGUtPmhza2V3ICE9IG1vZGUtPmhza2V3IHx8CisJ
ICAgIGhpZ2hfbW9kZS0+dnNjYW4gIT0gbW9kZS0+dnNjYW4gfHwKKwkgICAgaGlnaF9tb2RlLT52
c3luY19zdGFydCAtIG1vZGUtPnZzeW5jX3N0YXJ0ICE9IHRpbWluZ19kaWZmIHx8CisJICAgIGhp
Z2hfbW9kZS0+dnN5bmNfZW5kIC0gbW9kZS0+dnN5bmNfZW5kICE9IHRpbWluZ19kaWZmKQorCQly
ZXR1cm4gZmFsc2U7CisJZWxzZQorCQlyZXR1cm4gdHJ1ZTsKK30KKwogc3RhdGljIHN0cnVjdCBk
Y19zdHJlYW1fc3RhdGUgKgogY3JlYXRlX3N0cmVhbV9mb3Jfc2luayhzdHJ1Y3QgYW1kZ3B1X2Rt
X2Nvbm5lY3RvciAqYWNvbm5lY3RvciwKIAkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICpkcm1fbW9kZSwKQEAgLTUyNTMsOCArNTI5MSwxMCBAQCBjcmVhdGVfc3RyZWFtX2Zv
cl9zaW5rKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICphY29ubmVjdG9yLAogCQlkbV9zdGF0
ZSA/ICZkbV9zdGF0ZS0+YmFzZSA6IE5VTEw7CiAJc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqc3Ry
ZWFtID0gTlVMTDsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSBtb2RlID0gKmRybV9tb2RlOwor
CXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIHNhdmVkX21vZGU7CisJc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKmZyZWVzeW5jX21vZGUgPSBOVUxMOwogCWJvb2wgbmF0aXZlX21vZGVfZm91bmQgPSBm
YWxzZTsKLQlib29sIHNjYWxlID0gZG1fc3RhdGUgPyAoZG1fc3RhdGUtPnNjYWxpbmcgIT0gUk1Y
X09GRikgOiBmYWxzZTsKKwlib29sIHRpbWluZ19jaGFuZ2VkID0gZG1fc3RhdGUgPyAoZG1fc3Rh
dGUtPnNjYWxpbmcgIT0gUk1YX09GRikgOiBmYWxzZTsKIAlpbnQgbW9kZV9yZWZyZXNoOwogCWlu
dCBwcmVmZXJyZWRfcmVmcmVzaCA9IDA7CiAjaWYgZGVmaW5lZChDT05GSUdfRFJNX0FNRF9EQ19E
Q04pCkBAIC01MjYyLDYgKzUzMDIsOSBAQCBjcmVhdGVfc3RyZWFtX2Zvcl9zaW5rKHN0cnVjdCBh
bWRncHVfZG1fY29ubmVjdG9yICphY29ubmVjdG9yLAogCXVpbnQzMl90IGxpbmtfYmFuZHdpZHRo
X2ticHM7CiAjZW5kaWYKIAlzdHJ1Y3QgZGNfc2luayAqc2luayA9IE5VTEw7CisKKwltZW1zZXQo
JnNhdmVkX21vZGUsIDAsIHNpemVvZihzYXZlZF9tb2RlKSk7CisKIAlpZiAoYWNvbm5lY3RvciA9
PSBOVUxMKSB7CiAJCURSTV9FUlJPUigiYWNvbm5lY3RvciBpcyBOVUxMIVxuIik7CiAJCXJldHVy
biBzdHJlYW07CkBAIC01MzE0LDI1ICs1MzU3LDM4IEBAIGNyZWF0ZV9zdHJlYW1fZm9yX3Npbmso
c3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFjb25uZWN0b3IsCiAJCSAqLwogCQlEUk1fREVC
VUdfRFJJVkVSKCJObyBwcmVmZXJyZWQgbW9kZSBmb3VuZFxuIik7CiAJfSBlbHNlIHsKLQkJZGVj
aWRlX2NydGNfdGltaW5nX2Zvcl9kcm1fZGlzcGxheV9tb2RlKAorCQl0aW1pbmdfY2hhbmdlZCB8
PSBhbWRncHVfZnJlZXN5bmNfdmlkX21vZGUgJiYKKwkJCQkgaXNfZnJlZXN5bmNfdmlkZW9fbW9k
ZSgmbW9kZSwgYWNvbm5lY3Rvcik7CisJCWlmICh0aW1pbmdfY2hhbmdlZCkgeworCQkJZnJlZXN5
bmNfbW9kZSA9IGdldF9oaWdoZXN0X3JlZnJlc2hfcmF0ZV9tb2RlKGFjb25uZWN0b3IsIGZhbHNl
KTsKKwkJCXNhdmVkX21vZGUgPSBtb2RlOworCQkJbW9kZSA9ICpmcmVlc3luY19tb2RlOworCQl9
IGVsc2UgeworCQkJZGVjaWRlX2NydGNfdGltaW5nX2Zvcl9kcm1fZGlzcGxheV9tb2RlKAogCQkJ
CSZtb2RlLCBwcmVmZXJyZWRfbW9kZSwKIAkJCQlkbV9zdGF0ZSA/IChkbV9zdGF0ZS0+c2NhbGlu
ZyAhPSBSTVhfT0ZGKSA6IGZhbHNlKTsKKwkJfQorCiAJCXByZWZlcnJlZF9yZWZyZXNoID0gZHJt
X21vZGVfdnJlZnJlc2gocHJlZmVycmVkX21vZGUpOwogCX0KIAotCWlmICghZG1fc3RhdGUpCisJ
aWYgKHRpbWluZ19jaGFuZ2VkKQorCQlkcm1fbW9kZV9zZXRfY3J0Y2luZm8oJnNhdmVkX21vZGUs
IDApOworCWVsc2UKIAkJZHJtX21vZGVfc2V0X2NydGNpbmZvKCZtb2RlLCAwKTsKIAotCS8qCisg
ICAgICAgLyoKIAkqIElmIHNjYWxpbmcgaXMgZW5hYmxlZCBhbmQgcmVmcmVzaCByYXRlIGRpZG4n
dCBjaGFuZ2UKIAkqIHdlIGNvcHkgdGhlIHZpYyBhbmQgcG9sYXJpdGllcyBvZiB0aGUgb2xkIHRp
bWluZ3MKIAkqLwotCWlmICghc2NhbGUgfHwgbW9kZV9yZWZyZXNoICE9IHByZWZlcnJlZF9yZWZy
ZXNoKQotCQlmaWxsX3N0cmVhbV9wcm9wZXJ0aWVzX2Zyb21fZHJtX2Rpc3BsYXlfbW9kZShzdHJl
YW0sCi0JCQkmbW9kZSwgJmFjb25uZWN0b3ItPmJhc2UsIGNvbl9zdGF0ZSwgTlVMTCwgcmVxdWVz
dGVkX2JwYyk7CisJaWYgKCF0aW1pbmdfY2hhbmdlZCB8fCBtb2RlX3JlZnJlc2ggIT0gcHJlZmVy
cmVkX3JlZnJlc2gpCisJCWZpbGxfc3RyZWFtX3Byb3BlcnRpZXNfZnJvbV9kcm1fZGlzcGxheV9t
b2RlKAorCQkJc3RyZWFtLCAmbW9kZSwgJmFjb25uZWN0b3ItPmJhc2UsIGNvbl9zdGF0ZSwgTlVM
TCwKKwkJCXJlcXVlc3RlZF9icGMpOwogCWVsc2UKLQkJZmlsbF9zdHJlYW1fcHJvcGVydGllc19m
cm9tX2RybV9kaXNwbGF5X21vZGUoc3RyZWFtLAotCQkJJm1vZGUsICZhY29ubmVjdG9yLT5iYXNl
LCBjb25fc3RhdGUsIG9sZF9zdHJlYW0sIHJlcXVlc3RlZF9icGMpOworCQlmaWxsX3N0cmVhbV9w
cm9wZXJ0aWVzX2Zyb21fZHJtX2Rpc3BsYXlfbW9kZSgKKwkJCXN0cmVhbSwgJm1vZGUsICZhY29u
bmVjdG9yLT5iYXNlLCBjb25fc3RhdGUsIG9sZF9zdHJlYW0sCisJCQlyZXF1ZXN0ZWRfYnBjKTsK
IAogCXN0cmVhbS0+dGltaW5nLmZsYWdzLkRTQyA9IDA7CiAKQEAgLTcxNDMsMTQgKzcxOTksMTAg
QEAgc3RhdGljIHVpbnQgYWRkX2ZzX21vZGVzKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICph
Y29ubmVjdG9yKQogc3RhdGljIHZvaWQgYW1kZ3B1X2RtX2Nvbm5lY3Rvcl9hZGRfZnJlZXN5bmNf
bW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCQkJCSAgIHN0cnVjdCBl
ZGlkICplZGlkKQogewotCXVpbnQ4X3QgaTsKLQlzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1p
bmc7Ci0Jc3RydWN0IGRldGFpbGVkX25vbl9waXhlbCAqZGF0YTsKLQlzdHJ1Y3QgZGV0YWlsZWRf
ZGF0YV9tb25pdG9yX3JhbmdlICpyYW5nZTsKIAlzdHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5lY3RvciAq
YW1kZ3B1X2RtX2Nvbm5lY3RvciA9CiAJCXRvX2FtZGdwdV9kbV9jb25uZWN0b3IoY29ubmVjdG9y
KTsKIAotCWlmICghKGFtZGdwdV9leHBfZnJlZXN5bmNfdmlkX21vZGUgJiYgZWRpZCkpCisJaWYg
KCEoYW1kZ3B1X2ZyZWVzeW5jX3ZpZF9tb2RlICYmIGVkaWQpKQogCQlyZXR1cm47CiAJCiAJaWYg
KGFtZGdwdV9kbV9jb25uZWN0b3ItPm1heF92ZnJlcSAtIGFtZGdwdV9kbV9jb25uZWN0b3ItPm1p
bl92ZnJlcSA+IDEwKQpAQCAtNzgzNyw5ICs3ODg5LDIyIEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9z
dHJlYW1faXJxX3BhcmFtZXRlcnMoCiAJaWYgKG5ld19jcnRjX3N0YXRlLT52cnJfc3VwcG9ydGVk
ICYmCiAJICAgIGNvbmZpZy5taW5fcmVmcmVzaF9pbl91aHogJiYKIAkgICAgY29uZmlnLm1heF9y
ZWZyZXNoX2luX3VoeikgewotCQljb25maWcuc3RhdGUgPSBuZXdfY3J0Y19zdGF0ZS0+YmFzZS52
cnJfZW5hYmxlZCA/Ci0JCQlWUlJfU1RBVEVfQUNUSVZFX1ZBUklBQkxFIDoKLQkJCVZSUl9TVEFU
RV9JTkFDVElWRTsKKwkJLyoKKwkJICogaWYgZnJlZXN5bmMgY29tcGF0aWJsZSBtb2RlIHdhcyBz
ZXQsIGNvbmZpZy5zdGF0ZSB3aWxsIGJlIHNldAorCQkgKiBpbiBhdG9taWMgY2hlY2sKKwkJICov
CisJCWlmIChjb25maWcuc3RhdGUgPT0gVlJSX1NUQVRFX0FDVElWRV9GSVhFRCAmJiBjb25maWcu
Zml4ZWRfcmVmcmVzaF9pbl91aHogJiYKKwkJICAgICghZHJtX2F0b21pY19jcnRjX25lZWRzX21v
ZGVzZXQoJm5ld19jcnRjX3N0YXRlLT5iYXNlKSB8fAorCQkgICAgIG5ld19jcnRjX3N0YXRlLT5m
cmVlc3luY19jb25maWcuc3RhdGUgPT0gVlJSX1NUQVRFX0FDVElWRV9GSVhFRCkpIHsKKwkJCXZy
cl9wYXJhbXMubWF4X3JlZnJlc2hfaW5fdWh6ID0gY29uZmlnLm1heF9yZWZyZXNoX2luX3VoejsK
KwkJCXZycl9wYXJhbXMubWluX3JlZnJlc2hfaW5fdWh6ID0gY29uZmlnLm1pbl9yZWZyZXNoX2lu
X3VoejsKKwkJCXZycl9wYXJhbXMuZml4ZWRfcmVmcmVzaF9pbl91aHogPSBjb25maWcuZml4ZWRf
cmVmcmVzaF9pbl91aHo7CisJCQl2cnJfcGFyYW1zLnN0YXRlID0gVlJSX1NUQVRFX0FDVElWRV9G
SVhFRDsKKwkJfSBlbHNlIHsKKwkJCWNvbmZpZy5zdGF0ZSA9IG5ld19jcnRjX3N0YXRlLT5iYXNl
LnZycl9lbmFibGVkID8KKwkJCQkJCSAgICAgVlJSX1NUQVRFX0FDVElWRV9WQVJJQUJMRSA6CisJ
CQkJCQkgICAgIFZSUl9TVEFURV9JTkFDVElWRTsKKwkJfQogCX0gZWxzZSB7CiAJCWNvbmZpZy5z
dGF0ZSA9IFZSUl9TVEFURV9VTlNVUFBPUlRFRDsKIAl9CkBAIC04MTYwLDggKzgyMjUsNyBAQCBz
dGF0aWMgdm9pZCBhbWRncHVfZG1fY29tbWl0X3BsYW5lcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCSAqIHJlLWFkanVzdCB0aGUgbWluL21heCBib3VuZHMgbm93IHRoYXQgREMg
ZG9lc24ndCBoYW5kbGUgdGhpcwogCQkgKiBhcyBwYXJ0IG9mIGNvbW1pdC4KIAkJICovCi0JCWlm
IChhbWRncHVfZG1fdnJyX2FjdGl2ZShkbV9vbGRfY3J0Y19zdGF0ZSkgIT0KLQkJICAgIGFtZGdw
dV9kbV92cnJfYWN0aXZlKGFjcnRjX3N0YXRlKSkgeworCQlpZiAoaXNfZGNfdGltaW5nX2FkanVz
dF9uZWVkZWQoZG1fb2xkX2NydGNfc3RhdGUsIGFjcnRjX3N0YXRlKSkgewogCQkJc3Bpbl9sb2Nr
X2lycXNhdmUoJnBjcnRjLT5kZXYtPmV2ZW50X2xvY2ssIGZsYWdzKTsKIAkJCWRjX3N0cmVhbV9h
ZGp1c3Rfdm1pbl92bWF4KAogCQkJCWRtLT5kYywgYWNydGNfc3RhdGUtPnN0cmVhbSwKQEAgLTg0
NDUsNiArODUwOSw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9kbV9hdG9taWNfY29tbWl0X3RhaWwo
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJLyogaS5lLiByZXNldCBtb2RlICov
CiAJCQlpZiAoZG1fb2xkX2NydGNfc3RhdGUtPnN0cmVhbSkKIAkJCQlyZW1vdmVfc3RyZWFtKGFk
ZXYsIGFjcnRjLCBkbV9vbGRfY3J0Y19zdGF0ZS0+c3RyZWFtKTsKKwogCQkJbW9kZV9zZXRfcmVz
ZXRfcmVxdWlyZWQgPSB0cnVlOwogCQl9CiAJfSAvKiBmb3JfZWFjaF9jcnRjX2luX3N0YXRlKCkg
Ki8KQEAgLTg4NDMsNiArODkwOCw3IEBAIHN0YXRpYyB2b2lkIGdldF9mcmVlc3luY19jb25maWdf
Zm9yX2NydGMoCiAJCQl0b19hbWRncHVfZG1fY29ubmVjdG9yKG5ld19jb25fc3RhdGUtPmJhc2Uu
Y29ubmVjdG9yKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZuZXdfY3J0Y19z
dGF0ZS0+YmFzZS5tb2RlOwogCWludCB2cmVmcmVzaCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUp
OworCWJvb2wgZnNfdmlkX21vZGUgPSBmYWxzZTsKIAogCW5ld19jcnRjX3N0YXRlLT52cnJfc3Vw
cG9ydGVkID0gbmV3X2Nvbl9zdGF0ZS0+ZnJlZXN5bmNfY2FwYWJsZSAmJgogCQkJCQl2cmVmcmVz
aCA+PSBhY29ubmVjdG9yLT5taW5fdmZyZXEgJiYKQEAgLTg4NTAsMTcgKzg5MTYsMjQgQEAgc3Rh
dGljIHZvaWQgZ2V0X2ZyZWVzeW5jX2NvbmZpZ19mb3JfY3J0YygKIAogCWlmIChuZXdfY3J0Y19z
dGF0ZS0+dnJyX3N1cHBvcnRlZCkgewogCQluZXdfY3J0Y19zdGF0ZS0+c3RyZWFtLT5pZ25vcmVf
bXNhX3RpbWluZ19wYXJhbSA9IHRydWU7Ci0JCWNvbmZpZy5zdGF0ZSA9IG5ld19jcnRjX3N0YXRl
LT5iYXNlLnZycl9lbmFibGVkID8KLQkJCQlWUlJfU1RBVEVfQUNUSVZFX1ZBUklBQkxFIDoKLQkJ
CQlWUlJfU1RBVEVfSU5BQ1RJVkU7Ci0JCWNvbmZpZy5taW5fcmVmcmVzaF9pbl91aHogPQotCQkJ
CWFjb25uZWN0b3ItPm1pbl92ZnJlcSAqIDEwMDAwMDA7Ci0JCWNvbmZpZy5tYXhfcmVmcmVzaF9p
bl91aHogPQotCQkJCWFjb25uZWN0b3ItPm1heF92ZnJlcSAqIDEwMDAwMDA7CisJCWZzX3ZpZF9t
b2RlID0gbmV3X2NydGNfc3RhdGUtPmZyZWVzeW5jX2NvbmZpZy5zdGF0ZSA9PSBWUlJfU1RBVEVf
QUNUSVZFX0ZJWEVEOworCisJCWNvbmZpZy5taW5fcmVmcmVzaF9pbl91aHogPSBhY29ubmVjdG9y
LT5taW5fdmZyZXEgKiAxMDAwMDAwOworCQljb25maWcubWF4X3JlZnJlc2hfaW5fdWh6ID0gYWNv
bm5lY3Rvci0+bWF4X3ZmcmVxICogMTAwMDAwMDsKIAkJY29uZmlnLnZzaWZfc3VwcG9ydGVkID0g
dHJ1ZTsKIAkJY29uZmlnLmJ0ciA9IHRydWU7Ci0JfQogCisJCWlmIChmc192aWRfbW9kZSkgewor
CQkJY29uZmlnLnN0YXRlID0gVlJSX1NUQVRFX0FDVElWRV9GSVhFRDsKKwkJCWNvbmZpZy5maXhl
ZF9yZWZyZXNoX2luX3VoeiA9IG5ld19jcnRjX3N0YXRlLT5mcmVlc3luY19jb25maWcuZml4ZWRf
cmVmcmVzaF9pbl91aHo7CisJCQlnb3RvIG91dDsKKwkJfSBlbHNlIGlmIChuZXdfY3J0Y19zdGF0
ZS0+YmFzZS52cnJfZW5hYmxlZCkgeworCQkJY29uZmlnLnN0YXRlID0gVlJSX1NUQVRFX0FDVElW
RV9WQVJJQUJMRTsKKwkJfSBlbHNlIHsKKwkJCWNvbmZpZy5zdGF0ZSA9IFZSUl9TVEFURV9JTkFD
VElWRTsKKwkJfQorCX0KK291dDoKIAluZXdfY3J0Y19zdGF0ZS0+ZnJlZXN5bmNfY29uZmlnID0g
Y29uZmlnOwogfQogCkBAIC04ODczLDYgKzg5NDYsNTAgQEAgc3RhdGljIHZvaWQgcmVzZXRfZnJl
ZXN5bmNfY29uZmlnX2Zvcl9jcnRjKAogCSAgICAgICBzaXplb2YobmV3X2NydGNfc3RhdGUtPnZy
cl9pbmZvcGFja2V0KSk7CiB9CiAKK3N0YXRpYyBib29sCitpc190aW1pbmdfdW5jaGFuZ2VkX2Zv
cl9mcmVlc3luYyhzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAorCQkJCSBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlIG9sZF9tb2RlLCBuZXdfbW9kZTsKKworCWlmICghb2xkX2NydGNfc3RhdGUgfHwg
IW5ld19jcnRjX3N0YXRlKQorCQlyZXR1cm4gZmFsc2U7CisKKwlvbGRfbW9kZSA9IG9sZF9jcnRj
X3N0YXRlLT5tb2RlOworCW5ld19tb2RlID0gbmV3X2NydGNfc3RhdGUtPm1vZGU7CisKKwlpZiAo
b2xkX21vZGUuY2xvY2sgICAgICAgPT0gbmV3X21vZGUuY2xvY2sgJiYKKwkgICAgb2xkX21vZGUu
aGRpc3BsYXkgICAgPT0gbmV3X21vZGUuaGRpc3BsYXkgJiYKKwkgICAgb2xkX21vZGUudmRpc3Bs
YXkgICAgPT0gbmV3X21vZGUudmRpc3BsYXkgJiYKKwkgICAgb2xkX21vZGUuaHRvdGFsICAgICAg
PT0gbmV3X21vZGUuaHRvdGFsICYmCisJICAgIG9sZF9tb2RlLnZ0b3RhbCAgICAgICE9IG5ld19t
b2RlLnZ0b3RhbCAmJgorCSAgICBvbGRfbW9kZS5oc3luY19zdGFydCA9PSBuZXdfbW9kZS5oc3lu
Y19zdGFydCAmJgorCSAgICBvbGRfbW9kZS52c3luY19zdGFydCAhPSBuZXdfbW9kZS52c3luY19z
dGFydCAmJgorCSAgICBvbGRfbW9kZS5oc3luY19lbmQgICA9PSBuZXdfbW9kZS5oc3luY19lbmQg
JiYKKwkgICAgb2xkX21vZGUudnN5bmNfZW5kICAgIT0gbmV3X21vZGUudnN5bmNfZW5kICYmCisJ
ICAgIG9sZF9tb2RlLmhza2V3ICAgICAgID09IG5ld19tb2RlLmhza2V3ICYmCisJICAgIG9sZF9t
b2RlLnZzY2FuICAgICAgID09IG5ld19tb2RlLnZzY2FuICYmCisJICAgIChvbGRfbW9kZS52c3lu
Y19lbmQgLSBvbGRfbW9kZS52c3luY19zdGFydCkgPT0KKwkgICAgKG5ld19tb2RlLnZzeW5jX2Vu
ZCAtIG5ld19tb2RlLnZzeW5jX3N0YXJ0KSkKKwkJcmV0dXJuIHRydWU7CisKKwlyZXR1cm4gZmFs
c2U7Cit9CisKK3N0YXRpYyB2b2lkIHNldF9mcmVlc3luY19maXhlZF9jb25maWcoc3RydWN0IGRt
X2NydGNfc3RhdGUgKmRtX25ld19jcnRjX3N0YXRlKSB7CisJdWludDY0X3QgbnVtLCBkZW4sIHJl
czsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlID0gJmRtX25ld19jcnRj
X3N0YXRlLT5iYXNlOworCisJZG1fbmV3X2NydGNfc3RhdGUtPmZyZWVzeW5jX2NvbmZpZy5zdGF0
ZSA9IFZSUl9TVEFURV9BQ1RJVkVfRklYRUQ7CisKKwludW0gPSAodW5zaWduZWQgbG9uZyBsb25n
KW5ld19jcnRjX3N0YXRlLT5tb2RlLmNsb2NrICogMTAwMCAqIDEwMDAwMDA7CisJZGVuID0gKHVu
c2lnbmVkIGxvbmcgbG9uZyluZXdfY3J0Y19zdGF0ZS0+bW9kZS5odG90YWwgKgorCSAgICAgICh1
bnNpZ25lZCBsb25nIGxvbmcpbmV3X2NydGNfc3RhdGUtPm1vZGUudnRvdGFsOworCisJcmVzID0g
ZGl2X3U2NChudW0sIGRlbik7CisJZG1fbmV3X2NydGNfc3RhdGUtPmZyZWVzeW5jX2NvbmZpZy5m
aXhlZF9yZWZyZXNoX2luX3VoeiA9IHJlczsKK30KKwogc3RhdGljIGludCBkbV91cGRhdGVfY3J0
Y19zdGF0ZShzdHJ1Y3QgYW1kZ3B1X2Rpc3BsYXlfbWFuYWdlciAqZG0sCiAJCQkJc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCXN0cnVjdCBkcm1fY3J0YyAqY3J0YywKQEAgLTg5
NjMsNiArOTA4MCwxMSBAQCBzdGF0aWMgaW50IGRtX3VwZGF0ZV9jcnRjX3N0YXRlKHN0cnVjdCBh
bWRncHVfZGlzcGxheV9tYW5hZ2VyICpkbSwKIAkJICogVE9ETzogUmVmYWN0b3IgdGhpcyBmdW5j
dGlvbiB0byBhbGxvdyB0aGlzIGNoZWNrIHRvIHdvcmsKIAkJICogaW4gYWxsIGNvbmRpdGlvbnMu
CiAJCSAqLworCQlpZiAoYW1kZ3B1X2ZyZWVzeW5jX3ZpZF9tb2RlICYmCisJCSAgICBkbV9uZXdf
Y3J0Y19zdGF0ZS0+c3RyZWFtICYmCisJCSAgICBpc190aW1pbmdfdW5jaGFuZ2VkX2Zvcl9mcmVl
c3luYyhuZXdfY3J0Y19zdGF0ZSwgb2xkX2NydGNfc3RhdGUpKQorCQkJZ290byBza2lwX21vZGVz
ZXQ7CisKIAkJaWYgKGRtX25ld19jcnRjX3N0YXRlLT5zdHJlYW0gJiYKIAkJICAgIGRjX2lzX3N0
cmVhbV91bmNoYW5nZWQobmV3X3N0cmVhbSwgZG1fb2xkX2NydGNfc3RhdGUtPnN0cmVhbSkgJiYK
IAkJICAgIGRjX2lzX3N0cmVhbV9zY2FsaW5nX3VuY2hhbmdlZChuZXdfc3RyZWFtLCBkbV9vbGRf
Y3J0Y19zdGF0ZS0+c3RyZWFtKSkgewpAQCAtODk5NCw2ICs5MTE2LDI0IEBAIHN0YXRpYyBpbnQg
ZG1fdXBkYXRlX2NydGNfc3RhdGUoc3RydWN0IGFtZGdwdV9kaXNwbGF5X21hbmFnZXIgKmRtLAog
CQlpZiAoIWRtX29sZF9jcnRjX3N0YXRlLT5zdHJlYW0pCiAJCQlnb3RvIHNraXBfbW9kZXNldDsK
IAorCQlpZiAoYW1kZ3B1X2ZyZWVzeW5jX3ZpZF9tb2RlICYmIGRtX25ld19jcnRjX3N0YXRlLT5z
dHJlYW0gJiYKKwkJICAgIGlzX3RpbWluZ191bmNoYW5nZWRfZm9yX2ZyZWVzeW5jKG5ld19jcnRj
X3N0YXRlLAorCQkJCQkJICAgICBvbGRfY3J0Y19zdGF0ZSkpIHsKKwkJCW5ld19jcnRjX3N0YXRl
LT5tb2RlX2NoYW5nZWQgPSBmYWxzZTsKKwkJCURSTV9ERUJVR19EUklWRVIoCisJCQkJIk1vZGUg
Y2hhbmdlIG5vdCByZXF1aXJlZCBmb3IgZnJvbnQgcG9yY2ggY2hhbmdlLCAiCisJCQkJInNldHRp
bmcgbW9kZV9jaGFuZ2VkIHRvICVkIiwKKwkJCQluZXdfY3J0Y19zdGF0ZS0+bW9kZV9jaGFuZ2Vk
KTsKKworCQkJc2V0X2ZyZWVzeW5jX2ZpeGVkX2NvbmZpZyhkbV9uZXdfY3J0Y19zdGF0ZSk7CisK
KwkJCWdvdG8gc2tpcF9tb2Rlc2V0OworCQl9IGVsc2UgaWYgKGFtZGdwdV9mcmVlc3luY192aWRf
bW9kZSAmJiBhY29ubmVjdG9yICYmCisJCQkgICBpc19mcmVlc3luY192aWRlb19tb2RlKCZuZXdf
Y3J0Y19zdGF0ZS0+bW9kZSwKKwkJCQkJCSAgYWNvbm5lY3RvcikpIHsKKwkJCXNldF9mcmVlc3lu
Y19maXhlZF9jb25maWcoZG1fbmV3X2NydGNfc3RhdGUpOworCQl9CisKIAkJcmV0ID0gZG1fYXRv
bWljX2dldF9zdGF0ZShzdGF0ZSwgJmRtX3N0YXRlKTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gZmFp
bDsKLS0gCjIuMzAuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRl
dmVsCg==
