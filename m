Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3C3E4E97CE
	for <lists+dri-devel@lfdr.de>; Wed, 30 Oct 2019 09:14:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 555AC6ECAB;
	Wed, 30 Oct 2019 08:14:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from verein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BAFC36E44C
 for <dri-devel@lists.freedesktop.org>; Tue, 29 Oct 2019 15:48:46 +0000 (UTC)
Received: by verein.lst.de (Postfix, from userid 2005)
 id 669CD68D07; Tue, 29 Oct 2019 16:39:50 +0100 (CET)
In-Reply-To: <20191029153815.C631668C4E@verein.lst.de>
References: <20191029153815.C631668C4E@verein.lst.de>
From: Torsten Duwe <duwe@lst.de>
Date: Tue, 29 Oct 2019 13:16:57 +0100
Subject: [PATCH v4 5/7] drm/bridge: Add Analogix anx6345 support
To: Maxime Ripard <maxime.ripard@bootlin.com>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Message-Id: <20191029153950.669CD68D07@verein.lst.de>
X-Mailman-Approved-At: Wed, 30 Oct 2019 08:14:00 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKVGhlIEFOWDYzNDUgaXMgYW4g
dWx0cmEtbG93IHBvd2VyIERpc3BsYXlQb3dlci9lRFAgdHJhbnNtaXR0ZXIgZGVzaWduZWQKZm9y
IHBvcnRhYmxlIGRldmljZXMuIFRoaXMgZHJpdmVyIGFkZHMgaW5pdGlhbCBzdXBwb3J0IGZvciBS
R0IgdG8gZURQCm1vZGUsIHdpdGhvdXQgSFBEIGFuZCBpbnRlcnJ1cHRzLgoKVGhpcyBpcyBhIGNv
bmZpZ3VyYXRpb24gdXN1YWxseSBzZWVuIGluIGVEUCBhcHBsaWNhdGlvbnMuCgpTaWduZWQtb2Zm
LWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2ls
eSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFpbC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4g
RHV3ZSA8ZHV3ZUBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgv
S2NvbmZpZyAgICAgICAgICAgIHwgIDEyICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9n
aXgvTWFrZWZpbGUgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvYW5hbG9naXgtYW54NjM0NS5jIHwgNzkzICsrKysrKysrKysrKysrKysrKysrKwogMyBm
aWxlcyBjaGFuZ2VkLCA4MDYgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54NjM0NS5jCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnIGIvZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnCmluZGV4IDI5YmExYjIxMDE5ZS4uMTQyNWE5NmEy
OGMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tjb25maWcK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnCkBAIC0xLDYgKzEs
MTggQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQorY29uZmlnIERS
TV9BTkFMT0dJWF9BTlg2MzQ1CisJdHJpc3RhdGUgIkFuYWxvZ2l4IEFOWDYzNDUgYnJpZGdlIgor
CXNlbGVjdCBEUk1fQU5BTE9HSVhfRFAKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwlzZWxlY3Qg
UkVHTUFQX0kyQworCWhlbHAKKwkgIEFOWDYzNDUgaXMgYW4gdWx0cmEtbG93IEZ1bGwtSEQgRGlz
cGxheVBvcnQvZURQCisJICB0cmFuc21pdHRlciBkZXNpZ25lZCBmb3IgcG9ydGFibGUgZGV2aWNl
cy4gVGhlCisJICBBTlg2MzQ1IHRyYW5zZm9ybXMgdGhlIExWVFRMIFJHQiBvdXRwdXQgb2YgYW4K
KwkgIGFwcGxpY2F0aW9uIHByb2Nlc3NvciB0byBlRFAgb3IgRGlzcGxheVBvcnQuCisKIGNvbmZp
ZyBEUk1fQU5BTE9HSVhfQU5YNzhYWAogCXRyaXN0YXRlICJBbmFsb2dpeCBBTlg3OFhYIGJyaWRn
ZSIKKwlzZWxlY3QgRFJNX0FOQUxPR0lYX0RQCiAJc2VsZWN0IERSTV9LTVNfSEVMUEVSCiAJc2Vs
ZWN0IFJFR01BUF9JMkMKIAloZWxwCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2FuYWxvZ2l4L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtl
ZmlsZQppbmRleCA3NjIzYjliODAxNjcuLjk3NjY5YjM3NDA5OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0v
YnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlCkBAIC0xLDQgKzEsNSBAQAogIyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CiBhbmFsb2dpeF9kcC1vYmpzIDo9IGFuYWxvZ2l4X2Rw
X2NvcmUubyBhbmFsb2dpeF9kcF9yZWcubyBhbmFsb2dpeC1pMmMtZHB0eC5vCitvYmotJChDT05G
SUdfRFJNX0FOQUxPR0lYX0FOWDYzNDUpICs9IGFuYWxvZ2l4LWFueDYzNDUubwogb2JqLSQoQ09O
RklHX0RSTV9BTkFMT0dJWF9BTlg3OFhYKSArPSBhbmFsb2dpeC1hbng3OHh4Lm8KIG9iai0kKENP
TkZJR19EUk1fQU5BTE9HSVhfRFApICs9IGFuYWxvZ2l4X2RwLm8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54NjM0NS5jIGIvZHJpdmVycy9n
cHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1hbng2MzQ1LmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hZjA5YTYxZWI0NzIKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDYzNDUuYwpAQCAt
MCwxICsxLDc5MyBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seSAq
LworLyoKKyAqIENvcHlyaWdodChjKSAyMDE2LCBBbmFsb2dpeCBTZW1pY29uZHVjdG9yLgorICog
Q29weXJpZ2h0KGMpIDIwMTcsIEljZW5vd3kgWmhlbmcgPGljZW5vd3lAYW9zYy5pbz4KKyAqCisg
KiBCYXNlZCBvbiBhbng3ODA4IGRyaXZlciBvYnRhaW5lZCBmcm9tIGNocm9tZW9zIHdpdGggY29w
eXJpZ2h0OgorICogQ29weXJpZ2h0KGMpIDIwMTMsIEdvb2dsZSBJbmMuCisgKi8KKyNpbmNsdWRl
IDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4
L2dwaW8vY29uc3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9pMmMuaD4KKyNpbmNsdWRlIDxsaW51
eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51
eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZl9wbGF0Zm9ybS5oPgorI2luY2x1ZGUgPGxp
bnV4L3JlZ21hcC5oPgorI2luY2x1ZGUgPGxpbnV4L3JlZ3VsYXRvci9jb25zdW1lci5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGNfaGVs
cGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcF9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X2VkaWQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX29mLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wYW5l
bC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2Jl
X2hlbHBlci5oPgorCisjaW5jbHVkZSAiYW5hbG9naXgtaTJjLWRwdHguaCIKKyNpbmNsdWRlICJh
bmFsb2dpeC1pMmMtdHhjb21tb24uaCIKKworI2RlZmluZSBQT0xMX0RFTEFZCQk1MDAwMCAvKiB1
cyAqLworI2RlZmluZSBQT0xMX1RJTUVPVVQJCTUwMDAwMDAgLyogdXMgKi8KKworI2RlZmluZSBJ
MkNfSURYX0RQVFgJCTAKKyNkZWZpbmUgSTJDX0lEWF9UWENPTQkJMQorCitzdGF0aWMgY29uc3Qg
dTggYW54NjM0NV9pMmNfYWRkcmVzc2VzW10gPSB7CisJW0kyQ19JRFhfRFBUWF0JPSBBTkFMT0dJ
WF9JMkNfRFBUWCwKKwlbSTJDX0lEWF9UWENPTV0JPSBBTkFMT0dJWF9JMkNfVFhDT01NT04sCit9
OworI2RlZmluZSBJMkNfTlVNX0FERFJFU1NFUwlBUlJBWV9TSVpFKGFueDYzNDVfaTJjX2FkZHJl
c3NlcykKKworc3RydWN0IGFueDYzNDUgeworCXN0cnVjdCBkcm1fZHBfYXV4IGF1eDsKKwlzdHJ1
Y3QgZHJtX2JyaWRnZSBicmlkZ2U7CisJc3RydWN0IGkyY19jbGllbnQgKmNsaWVudDsKKwlzdHJ1
Y3QgZWRpZCAqZWRpZDsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciBjb25uZWN0b3I7CisJc3RydWN0
IGRybV9kcF9saW5rIGxpbms7CisJc3RydWN0IGRybV9wYW5lbCAqcGFuZWw7CisJc3RydWN0IHJl
Z3VsYXRvciAqZHZkZDEyOworCXN0cnVjdCByZWd1bGF0b3IgKmR2ZGQyNTsKKwlzdHJ1Y3QgZ3Bp
b19kZXNjICpncGlvZF9yZXNldDsKKwlzdHJ1Y3QgbXV0ZXggbG9jazsJLyogcHJvdGVjdCBFRElE
IGFjY2VzcyAqLworCisJLyogSTJDIFNsYXZlIGFkZHJlc3NlcyBvZiBBTlg2MzQ1IGFyZSBtYXBw
ZWQgYXMgRFBUWCBhbmQgU1lTICovCisJc3RydWN0IGkyY19jbGllbnQgKmkyY19jbGllbnRzW0ky
Q19OVU1fQUREUkVTU0VTXTsKKwlzdHJ1Y3QgcmVnbWFwICptYXBbSTJDX05VTV9BRERSRVNTRVNd
OworCisJdTE2IGNoaXBpZDsKKwl1OCBkcGNkW0RQX1JFQ0VJVkVSX0NBUF9TSVpFXTsKKworCWJv
b2wgcG93ZXJlZDsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGFueDYzNDUgKmNvbm5lY3Rv
cl90b19hbng2MzQ1KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjKQoreworCXJldHVybiBjb250YWlu
ZXJfb2YoYywgc3RydWN0IGFueDYzNDUsIGNvbm5lY3Rvcik7Cit9CisKK3N0YXRpYyBpbmxpbmUg
c3RydWN0IGFueDYzNDUgKmJyaWRnZV90b19hbng2MzQ1KHN0cnVjdCBkcm1fYnJpZGdlICpicmlk
Z2UpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihicmlkZ2UsIHN0cnVjdCBhbng2MzQ1LCBicmlk
Z2UpOworfQorCitzdGF0aWMgaW50IGFueDYzNDVfc2V0X2JpdHMoc3RydWN0IHJlZ21hcCAqbWFw
LCB1OCByZWcsIHU4IG1hc2spCit7CisJcmV0dXJuIHJlZ21hcF91cGRhdGVfYml0cyhtYXAsIHJl
ZywgbWFzaywgbWFzayk7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9jbGVhcl9iaXRzKHN0cnVj
dCByZWdtYXAgKm1hcCwgdTggcmVnLCB1OCBtYXNrKQoreworCXJldHVybiByZWdtYXBfdXBkYXRl
X2JpdHMobWFwLCByZWcsIG1hc2ssIDApOworfQorCitzdGF0aWMgc3NpemVfdCBhbng2MzQ1X2F1
eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LAorCQkJCSAgICBzdHJ1Y3QgZHJtX2Rw
X2F1eF9tc2cgKm1zZykKK3sKKwlzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSA9IGNvbnRhaW5lcl9v
ZihhdXgsIHN0cnVjdCBhbng2MzQ1LCBhdXgpOworCisJcmV0dXJuIGFueF9kcF9hdXhfdHJhbnNm
ZXIoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sIG1zZyk7Cit9CisKK3N0YXRpYyBpbnQgYW54
NjM0NV9kcF9saW5rX3RyYWluaW5nKHN0cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCXVuc2ln
bmVkIGludCB2YWx1ZTsKKwl1OCBkcF9idzsKKwlpbnQgZXJyOworCisJZXJyID0gYW54NjM0NV9j
bGVhcl9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX1RYQ09NXSwKKwkJCQkgU1BfUE9XRVJET1dO
X0NUUkxfUkVHLAorCQkJCSBTUF9UT1RBTF9QRCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsK
KworCWVyciA9IGRybV9kcF9kcGNkX3JlYWRiKCZhbng2MzQ1LT5hdXgsIERQX01BWF9MSU5LX1JB
VEUsICZkcF9idyk7CisJaWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlzd2l0Y2ggKGRw
X2J3KSB7CisJY2FzZSBEUF9MSU5LX0JXXzFfNjI6CisJY2FzZSBEUF9MSU5LX0JXXzJfNzoKKwkJ
YnJlYWs7CisKKwlkZWZhdWx0OgorCQlEUk1fREVCVUdfS01TKCJEUCBiYW5kd2lkdGggKCUjMDJ4
KSBub3Qgc3VwcG9ydGVkXG4iLCBkcF9idyk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWVy
ciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9WSURf
Q1RSTDFfUkVHLAorCQkJICAgICAgIFNQX1ZJREVPX01VVEUpOworCWlmIChlcnIpCisJCXJldHVy
biBlcnI7CisKKwllcnIgPSBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhf
VFhDT01dLAorCQkJCSBTUF9WSURfQ1RSTDFfUkVHLCBTUF9WSURFT19FTik7CisJaWYgKGVycikK
KwkJcmV0dXJuIGVycjsKKworCS8qIEdldCBEUENEIGluZm8gKi8KKwllcnIgPSBkcm1fZHBfZHBj
ZF9yZWFkKCZhbng2MzQ1LT5hdXgsIERQX0RQQ0RfUkVWLAorCQkJICAgICAgICZhbng2MzQ1LT5k
cGNkLCBEUF9SRUNFSVZFUl9DQVBfU0laRSk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gcmVhZCBEUENEOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisK
KwkvKiBDbGVhciBjaGFubmVsIHggU0VSREVTIHBvd2VyIGRvd24gKi8KKwllcnIgPSBhbng2MzQ1
X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkJIFNQX0RQX0FOQUxP
R19QT1dFUl9ET1dOX1JFRywgU1BfQ0gwX1BEKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJLyogQ2hlY2sgbGluayBjYXBhYmlsaXRpZXMgKi8KKwllcnIgPSBkcm1fZHBfbGlua19wcm9i
ZSgmYW54NjM0NS0+YXV4LCAmYW54NjM0NS0+bGluayk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJN
X0VSUk9SKCJGYWlsZWQgdG8gcHJvYmUgbGluayBjYXBhYmlsaXRpZXM6ICVkXG4iLCBlcnIpOwor
CQlyZXR1cm4gZXJyOworCX0KKworCS8qIFBvd2VyIHVwIHRoZSBzaW5rICovCisJZXJyID0gZHJt
X2RwX2xpbmtfcG93ZXJfdXAoJmFueDYzNDUtPmF1eCwgJmFueDYzNDUtPmxpbmspOworCWlmIChl
cnIgPCAwKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIHBvd2VyIHVwIERpc3BsYXlQb3J0IGxp
bms6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFBvc3NpYmx5IGVuYWJs
ZSBkb3duc3ByZWFkIG9uIHRoZSBzaW5rICovCisJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUt
Pm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgU1BfRFBfRE9XTlNQUkVBRF9DVFJMMV9SRUcsIDAp
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoYW54NjM0NS0+ZHBjZFtEUF9NQVhf
RE9XTlNQUkVBRF0gJiBEUF9NQVhfRE9XTlNQUkVBRF8wXzUpIHsKKwkJRFJNX0RFQlVHKCJFbmFi
bGUgZG93bnNwcmVhZCBvbiB0aGUgc2lua1xuIik7CisJCS8qIDQwMDBQUE0gKi8KKwkJZXJyID0g
cmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJCSAgIFNQX0RQX0RP
V05TUFJFQURfQ1RSTDFfUkVHLCA4KTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJ
ZXJyID0gZHJtX2RwX2RwY2Rfd3JpdGViKCZhbng2MzQ1LT5hdXgsIERQX0RPV05TUFJFQURfQ1RS
TCwKKwkJCQkJIERQX1NQUkVBRF9BTVBfMF81KTsKKwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4g
ZXJyOworCX0gZWxzZSB7CisJCWVyciA9IGRybV9kcF9kcGNkX3dyaXRlYigmYW54NjM0NS0+YXV4
LCBEUF9ET1dOU1BSRUFEX0NUUkwsIDApOworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7
CisJfQorCisJLyogU2V0IHRoZSBsYW5lIGNvdW50IGFuZCB0aGUgbGluayByYXRlIG9uIHRoZSBz
aW5rICovCisJaWYgKGRybV9kcF9lbmhhbmNlZF9mcmFtZV9jYXAoYW54NjM0NS0+ZHBjZCkpCisJ
CWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkJ
ICAgICAgIFNQX0RQX1NZU1RFTV9DVFJMX0JBU0UgKyA0LAorCQkJCSAgICAgICBTUF9FTkhBTkNF
RF9NT0RFKTsKKwllbHNlCisJCWVyciA9IGFueDYzNDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBb
STJDX0lEWF9EUFRYXSwKKwkJCQkJIFNQX0RQX1NZU1RFTV9DVFJMX0JBU0UgKyA0LAorCQkJCQkg
U1BfRU5IQU5DRURfTU9ERSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXZhbHVlID0g
ZHJtX2RwX2xpbmtfcmF0ZV90b19id19jb2RlKGFueDYzNDUtPmxpbmsucmF0ZSk7CisJZXJyID0g
cmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgU1BfRFBfTUFJ
Tl9MSU5LX0JXX1NFVF9SRUcsIHZhbHVlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJ
ZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgU1Bf
RFBfTEFORV9DT1VOVF9TRVRfUkVHLCBhbng2MzQ1LT5saW5rLm51bV9sYW5lcyk7CisJaWYgKGVy
cikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGRybV9kcF9saW5rX2NvbmZpZ3VyZSgmYW54NjM0
NS0+YXV4LCAmYW54NjM0NS0+bGluayk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJG
YWlsZWQgdG8gY29uZmlndXJlIERpc3BsYXlQb3J0IGxpbms6ICVkXG4iLCBlcnIpOworCQlyZXR1
cm4gZXJyOworCX0KKworCS8qIFN0YXJ0IHRyYWluaW5nIG9uIHRoZSBzb3VyY2UgKi8KKwllcnIg
PSByZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sIFNQX0RQX0xUX0NUUkxf
UkVHLAorCQkJICAgU1BfTFRfRU4pOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlyZXR1
cm4gcmVnbWFwX3JlYWRfcG9sbF90aW1lb3V0KGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAor
CQkJCSAgICAgICBTUF9EUF9MVF9DVFJMX1JFRywKKwkJCQkgICAgICAgdmFsdWUsICEodmFsdWUg
JiBTUF9EUF9MVF9JTlBST0dSRVNTKSwKKwkJCQkgICAgICAgUE9MTF9ERUxBWSwgUE9MTF9USU1F
T1VUKTsKK30KKworc3RhdGljIGludCBhbng2MzQ1X3R4X2luaXRpYWxpemF0aW9uKHN0cnVjdCBh
bng2MzQ1ICphbng2MzQ1KQoreworCWludCBlcnIsIGk7CisKKwkvKiBGSVhNRTogY29sb3JkZXB0
aCBpcyBoYXJkY29kZWQgZm9yIG5vdyAqLworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5t
YXBbSTJDX0lEWF9UWENPTV0sIFNQX1ZJRF9DVFJMMl9SRUcsCisJCQkgICBTUF9JTl9CUENfNkJJ
VCA8PCBTUF9JTl9CUENfU0hJRlQpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIg
PSByZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sIFNQX0RQX1BMTF9DVFJM
X1JFRywgMCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0
ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sCisJCQkgICBTUF9BTkFMT0dfREVCVUcxX1JF
RywgMCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShh
bng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJCSAgIFNQX0RQX0xJTktfREVCVUdfQ1RSTF9S
RUcsCisJCQkgICBTUF9ORVdfUFJCUzcgfCBTUF9NX1ZJRF9ERUJVRyk7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9E
UFRYXSwKKwkJCSAgIFNQX0RQX0FOQUxPR19QT1dFUl9ET1dOX1JFRywgMCk7CisJaWYgKGVycikK
KwkJcmV0dXJuIGVycjsKKworCS8qIEZvcmNlIEhQRCAqLworCWVyciA9IGFueDYzNDVfc2V0X2Jp
dHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkgICAgICAgU1BfRFBfU1lTVEVNX0NU
UkxfQkFTRSArIDMsCisJCQkgICAgICAgU1BfSFBEX0ZPUkNFIHwgU1BfSFBEX0NUUkwpOworCWlm
IChlcnIpCisJCXJldHVybiBlcnI7CisKKwlmb3IgKGkgPSAwOyBpIDwgNDsgaSsrKSB7CisJCS8q
IDQgbGFuZXMgKi8KKwkJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQ
VFhdLAorCQkJCSAgIFNQX0RQX0xBTkUwX0xUX0NUUkxfUkVHICsgaSwgMCk7CisJCWlmIChlcnIp
CisJCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFJlc2V0IEFVWCAqLworCWVyciA9IGFueDYzNDVf
c2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLAorCQkJICAgICAgIFNQX1JFU0VU
X0NUUkwyX1JFRywgU1BfQVVYX1JTVCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJl
dHVybiBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLAorCQkJ
CSBTUF9SRVNFVF9DVFJMMl9SRUcsIFNQX0FVWF9SU1QpOworfQorCitzdGF0aWMgdm9pZCBhbng2
MzQ1X3Bvd2Vyb24oc3RydWN0IGFueDYzNDUgKmFueDYzNDUpCit7CisJaW50IGVycjsKKworCS8q
IEVuc3VyZSByZXNldCBpcyBhc3NlcnRlZCBiZWZvcmUgc3RhcnRpbmcgcG93ZXIgb24gc2VxdWVu
Y2UgKi8KKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAoYW54NjM0NS0+Z3Bpb2RfcmVzZXQsIDEp
OworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsKKworCWVyciA9IHJlZ3VsYXRvcl9lbmFibGUo
YW54NjM0NS0+ZHZkZDEyKTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGVu
YWJsZSBkdmRkMTIgcmVndWxhdG9yOiAlZFxuIiwKKwkJCSAgZXJyKTsKKwkJcmV0dXJuOworCX0K
KworCS8qIFQxIC0gZGVsYXkgYmV0d2VlbiBWREQxMiBhbmQgVkREMjUgc2hvdWxkIGJlIDAtMm1z
ICovCisJdXNsZWVwX3JhbmdlKDEwMDAsIDIwMDApOworCisJZXJyID0gcmVndWxhdG9yX2VuYWJs
ZShhbng2MzQ1LT5kdmRkMjUpOworCWlmIChlcnIpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8g
ZW5hYmxlIGR2ZGQyNSByZWd1bGF0b3I6ICVkXG4iLAorCQkJICBlcnIpOworCQlyZXR1cm47CisJ
fQorCisJLyogVDIgLSBkZWxheSBiZXR3ZWVuIFJFU0VUTiBhbmQgYWxsIHBvd2VyIHJhaWwgc3Rh
YmxlLAorCSAqIHNob3VsZCBiZSAyLTVtcworCSAqLworCXVzbGVlcF9yYW5nZSgyMDAwLCA1MDAw
KTsKKworCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVlcChhbng2MzQ1LT5ncGlvZF9yZXNldCwgMCk7
CisKKwkvKiBQb3dlciBvbiByZWdpc3RlcnMgbW9kdWxlICovCisJYW54NjM0NV9zZXRfYml0cyhh
bng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQX1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCSBT
UF9IRENQX1BEIHwgU1BfQVVESU9fUEQgfCBTUF9WSURFT19QRCB8IFNQX0xJTktfUEQpOworCWFu
eDYzNDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQX1BPV0VSRE9X
Tl9DVFJMX1JFRywKKwkJCSAgIFNQX1JFR0lTVEVSX1BEIHwgU1BfVE9UQUxfUEQpOworCisJaWYg
KGFueDYzNDUtPnBhbmVsKQorCQlkcm1fcGFuZWxfcHJlcGFyZShhbng2MzQ1LT5wYW5lbCk7CisK
Kwlhbng2MzQ1LT5wb3dlcmVkID0gdHJ1ZTsKK30KKworc3RhdGljIHZvaWQgYW54NjM0NV9wb3dl
cm9mZihzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkKK3sKKwlpbnQgZXJyOworCisJZ3Bpb2Rfc2V0
X3ZhbHVlX2NhbnNsZWVwKGFueDYzNDUtPmdwaW9kX3Jlc2V0LCAxKTsKKwl1c2xlZXBfcmFuZ2Uo
MTAwMCwgMjAwMCk7CisKKwlpZiAoYW54NjM0NS0+cGFuZWwpCisJCWRybV9wYW5lbF91bnByZXBh
cmUoYW54NjM0NS0+cGFuZWwpOworCisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUoYW54NjM0NS0+
ZHZkZDI1KTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUgZHZk
ZDI1IHJlZ3VsYXRvcjogJWRcbiIsCisJCQkgIGVycik7CisJCXJldHVybjsKKwl9CisKKwl1c2xl
ZXBfcmFuZ2UoNTAwMCwgMTAwMDApOworCisJZXJyID0gcmVndWxhdG9yX2Rpc2FibGUoYW54NjM0
NS0+ZHZkZDEyKTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUg
ZHZkZDEyIHJlZ3VsYXRvcjogJWRcbiIsCisJCQkgIGVycik7CisJCXJldHVybjsKKwl9CisKKwl1
c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisKKwlhbng2MzQ1LT5wb3dlcmVkID0gZmFsc2U7Cit9
CisKK3N0YXRpYyBpbnQgYW54NjM0NV9zdGFydChzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkKK3sK
KwlpbnQgZXJyOworCisJaWYgKCFhbng2MzQ1LT5wb3dlcmVkKQorCQlhbng2MzQ1X3Bvd2Vyb24o
YW54NjM0NSk7CisKKwkvKiBQb3dlciBvbiBuZWVkZWQgbW9kdWxlcyAqLworCWVyciA9IGFueDYz
NDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sCisJCQkJU1BfUE9XRVJE
T1dOX0NUUkxfUkVHLAorCQkJCVNQX1ZJREVPX1BEIHwgU1BfTElOS19QRCk7CisKKwllcnIgPSBh
bng2MzQ1X3R4X2luaXRpYWxpemF0aW9uKGFueDYzNDUpOworCWlmIChlcnIpIHsKKwkJRFJNX0VS
Uk9SKCJGYWlsZWQgZURQIHRyYW5zbWl0dGVyIGluaXRpYWxpemF0aW9uOiAlZFxuIiwgZXJyKTsK
KwkJYW54NjM0NV9wb3dlcm9mZihhbng2MzQ1KTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwllcnIg
PSBhbng2MzQ1X2RwX2xpbmtfdHJhaW5pbmcoYW54NjM0NSk7CisJaWYgKGVycikgeworCQlEUk1f
RVJST1IoIkZhaWxlZCBsaW5rIHRyYWluaW5nOiAlZFxuIiwgZXJyKTsKKwkJYW54NjM0NV9wb3dl
cm9mZihhbng2MzQ1KTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwkvKgorCSAqIFRoaXMgZGVsYXkg
c2VlbXMgdG8gaGVscCBrZWVwIHRoZSBoYXJkd2FyZSBpbiBhIGdvb2Qgc3RhdGUuIFdpdGhvdXQK
KwkgKiBpdCwgdGhlcmUgYXJlIHRpbWVzIHdoZXJlIGl0IGZhaWxzIHNpbGVudGx5LgorCSAqLwor
CXVzbGVlcF9yYW5nZSgxMDAwMCwgMTUwMDApOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgYW54NjM0NV9jb25maWdfZHBfb3V0cHV0KHN0cnVjdCBhbng2MzQ1ICphbng2MzQ1KQorewor
CWludCBlcnI7CisKKwllcnIgPSBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19J
RFhfVFhDT01dLCBTUF9WSURfQ1RSTDFfUkVHLAorCQkJCSBTUF9WSURFT19NVVRFKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogRW5hYmxlIERQIG91dHB1dCAqLworCWVyciA9IGFu
eDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9WSURfQ1RSTDFf
UkVHLAorCQkJICAgICAgIFNQX1ZJREVPX0VOKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJLyogRm9yY2Ugc3RyZWFtIHZhbGlkICovCisJcmV0dXJuIGFueDYzNDVfc2V0X2JpdHMoYW54
NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkgICAgICAgU1BfRFBfU1lTVEVNX0NUUkxfQkFT
RSArIDMsCisJCQkgICAgICAgU1BfU1RSTV9GT1JDRSB8IFNQX1NUUk1fQ1RSTCk7Cit9CisKK3N0
YXRpYyBpbnQgYW54NjM0NV9nZXRfZG93bnN0cmVhbV9pbmZvKHN0cnVjdCBhbng2MzQ1ICphbng2
MzQ1KQoreworCXU4IHZhbHVlOworCWludCBlcnI7CisKKwllcnIgPSBkcm1fZHBfZHBjZF9yZWFk
YigmYW54NjM0NS0+YXV4LCBEUF9TSU5LX0NPVU5ULCAmdmFsdWUpOworCWlmIChlcnIgPCAwKSB7
CisJCURSTV9FUlJPUigiR2V0IHNpbmsgY291bnQgZmFpbGVkICVkXG4iLCBlcnIpOworCQlyZXR1
cm4gZXJyOworCX0KKworCWlmICghRFBfR0VUX1NJTktfQ09VTlQodmFsdWUpKSB7CisJCURSTV9F
UlJPUigiRG93bnN0cmVhbSBkaXNjb25uZWN0ZWRcbiIpOworCQlyZXR1cm4gLUVJTzsKKwl9CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBhbng2MzQ1X2dldF9tb2RlcyhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gY29u
bmVjdG9yX3RvX2FueDYzNDUoY29ubmVjdG9yKTsKKwlpbnQgZXJyLCBudW1fbW9kZXMgPSAwOwor
CWJvb2wgcG93ZXJfb2ZmID0gZmFsc2U7CisKKwltdXRleF9sb2NrKCZhbng2MzQ1LT5sb2NrKTsK
KworCWlmICghYW54NjM0NS0+ZWRpZCkgeworCQlpZiAoIWFueDYzNDUtPnBvd2VyZWQpIHsKKwkJ
CWFueDYzNDVfcG93ZXJvbihhbng2MzQ1KTsKKwkJCXBvd2VyX29mZiA9IHRydWU7CisJCX0KKwor
CQllcnIgPSBhbng2MzQ1X2dldF9kb3duc3RyZWFtX2luZm8oYW54NjM0NSk7CisJCWlmIChlcnIp
IHsKKwkJCURSTV9FUlJPUigiRmFpbGVkIHRvIGdldCBkb3duc3RyZWFtIGluZm86ICVkXG4iLCBl
cnIpOworCQkJZ290byB1bmxvY2s7CisJCX0KKworCQlhbng2MzQ1LT5lZGlkID0gZHJtX2dldF9l
ZGlkKGNvbm5lY3RvciwgJmFueDYzNDUtPmF1eC5kZGMpOworCQlpZiAoIWFueDYzNDUtPmVkaWQp
CisJCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZWFkIEVESUQgZnJvbSBwYW5lbFxuIik7CisKKwkJ
ZXJyID0gZHJtX2Nvbm5lY3Rvcl91cGRhdGVfZWRpZF9wcm9wZXJ0eShjb25uZWN0b3IsCisJCQkJ
CQkJIGFueDYzNDUtPmVkaWQpOworCQlpZiAoZXJyKSB7CisJCQlEUk1fRVJST1IoIkZhaWxlZCB0
byB1cGRhdGUgRURJRCBwcm9wZXJ0eTogJWRcbiIsIGVycik7CisJCQlnb3RvIHVubG9jazsKKwkJ
fQorCX0KKworCW51bV9tb2RlcyArPSBkcm1fYWRkX2VkaWRfbW9kZXMoY29ubmVjdG9yLCBhbng2
MzQ1LT5lZGlkKTsKKwordW5sb2NrOgorCWlmIChwb3dlcl9vZmYpCisJCWFueDYzNDVfcG93ZXJv
ZmYoYW54NjM0NSk7CisKKwltdXRleF91bmxvY2soJmFueDYzNDUtPmxvY2spOworCisJaWYgKCFu
dW1fbW9kZXMgJiYgYW54NjM0NS0+cGFuZWwpCisJCW51bV9tb2RlcyArPSBkcm1fcGFuZWxfZ2V0
X21vZGVzKGFueDYzNDUtPnBhbmVsKTsKKworCXJldHVybiBudW1fbW9kZXM7Cit9CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MgYW54NjM0NV9jb25uZWN0
b3JfaGVscGVyX2Z1bmNzID0geworCS5nZXRfbW9kZXMgPSBhbng2MzQ1X2dldF9tb2RlcywKK307
CisKK3N0YXRpYyB2b2lkCithbng2MzQ1X2Nvbm5lY3Rvcl9kZXN0cm95KHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0IGFueDYzNDUgKmFueDYzNDUgPSBjb25uZWN0
b3JfdG9fYW54NjM0NShjb25uZWN0b3IpOworCisJaWYgKGFueDYzNDUtPnBhbmVsKQorCQlkcm1f
cGFuZWxfZGV0YWNoKGFueDYzNDUtPnBhbmVsKTsKKwlkcm1fY29ubmVjdG9yX2NsZWFudXAoY29u
bmVjdG9yKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2Z1bmNzIGFu
eDYzNDVfY29ubmVjdG9yX2Z1bmNzID0geworCS5maWxsX21vZGVzID0gZHJtX2hlbHBlcl9wcm9i
ZV9zaW5nbGVfY29ubmVjdG9yX21vZGVzLAorCS5kZXN0cm95ID0gYW54NjM0NV9jb25uZWN0b3Jf
ZGVzdHJveSwKKwkucmVzZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfcmVzZXQsCisJ
LmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZHVw
bGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVy
X2Nvbm5lY3Rvcl9kZXN0cm95X3N0YXRlLAorfTsKKworc3RhdGljIGludCBhbng2MzQ1X2JyaWRn
ZV9hdHRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgYW54NjM0NSAq
YW54NjM0NSA9IGJyaWRnZV90b19hbng2MzQ1KGJyaWRnZSk7CisJaW50IGVycjsKKworCWlmICgh
YnJpZGdlLT5lbmNvZGVyKSB7CisJCURSTV9FUlJPUigiUGFyZW50IGVuY29kZXIgb2JqZWN0IG5v
dCBmb3VuZCIpOworCQlyZXR1cm4gLUVOT0RFVjsKKwl9CisKKwkvKiBSZWdpc3RlciBhdXggY2hh
bm5lbCAqLworCWFueDYzNDUtPmF1eC5uYW1lID0gIkRQLUFVWCI7CisJYW54NjM0NS0+YXV4LmRl
diA9ICZhbng2MzQ1LT5jbGllbnQtPmRldjsKKwlhbng2MzQ1LT5hdXgudHJhbnNmZXIgPSBhbng2
MzQ1X2F1eF90cmFuc2ZlcjsKKworCWVyciA9IGRybV9kcF9hdXhfcmVnaXN0ZXIoJmFueDYzNDUt
PmF1eCk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVnaXN0ZXIg
YXV4IGNoYW5uZWw6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCWVyciA9IGRy
bV9jb25uZWN0b3JfaW5pdChicmlkZ2UtPmRldiwgJmFueDYzNDUtPmNvbm5lY3RvciwKKwkJCQkg
JmFueDYzNDVfY29ubmVjdG9yX2Z1bmNzLAorCQkJCSBEUk1fTU9ERV9DT05ORUNUT1JfZURQKTsK
KwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGluaXRpYWxpemUgY29ubmVjdG9y
OiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlkcm1fY29ubmVjdG9yX2hlbHBl
cl9hZGQoJmFueDYzNDUtPmNvbm5lY3RvciwKKwkJCQkgJmFueDYzNDVfY29ubmVjdG9yX2hlbHBl
cl9mdW5jcyk7CisKKwllcnIgPSBkcm1fY29ubmVjdG9yX3JlZ2lzdGVyKCZhbng2MzQ1LT5jb25u
ZWN0b3IpOworCWlmIChlcnIpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVnaXN0ZXIgY29u
bmVjdG9yOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlhbng2MzQ1LT5jb25u
ZWN0b3IucG9sbGVkID0gRFJNX0NPTk5FQ1RPUl9QT0xMX0hQRDsKKworCWVyciA9IGRybV9jb25u
ZWN0b3JfYXR0YWNoX2VuY29kZXIoJmFueDYzNDUtPmNvbm5lY3RvciwKKwkJCQkJICAgYnJpZGdl
LT5lbmNvZGVyKTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGxpbmsgdXAg
Y29ubmVjdG9yIHRvIGVuY29kZXI6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKwor
CWlmIChhbng2MzQ1LT5wYW5lbCkgeworCQllcnIgPSBkcm1fcGFuZWxfYXR0YWNoKGFueDYzNDUt
PnBhbmVsLCAmYW54NjM0NS0+Y29ubmVjdG9yKTsKKwkJaWYgKGVycikgeworCQkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gYXR0YWNoIHBhbmVsOiAlZFxuIiwgZXJyKTsKKwkJCXJldHVybiBlcnI7CisJ
CX0KKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGVudW0gZHJtX21vZGVfc3RhdHVzCith
bng2MzQ1X2JyaWRnZV9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkg
IGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlKQoreworCWlmIChtb2RlLT5mbGFn
cyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQorCQlyZXR1cm4gTU9ERV9OT19JTlRFUkxBQ0U7
CisKKwkvKiBNYXggMTIwMHAgYXQgNS40IEdoeiwgb25lIGxhbmUgKi8KKwlpZiAobW9kZS0+Y2xv
Y2sgPiAxNTQwMDApCisJCXJldHVybiBNT0RFX0NMT0NLX0hJR0g7CisKKwlyZXR1cm4gTU9ERV9P
SzsKK30KKworc3RhdGljIHZvaWQgYW54NjM0NV9icmlkZ2VfZGlzYWJsZShzdHJ1Y3QgZHJtX2Jy
aWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gYnJpZGdlX3RvX2Fu
eDYzNDUoYnJpZGdlKTsKKworCS8qIFBvd2VyIG9mZiBhbGwgbW9kdWxlcyBleGNlcHQgY29uZmln
dXJhdGlvbiByZWdpc3RlcnMgYWNjZXNzICovCisJYW54NjM0NV9zZXRfYml0cyhhbng2MzQ1LT5t
YXBbSTJDX0lEWF9UWENPTV0sIFNQX1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCSBTUF9IRENQX1BE
IHwgU1BfQVVESU9fUEQgfCBTUF9WSURFT19QRCB8IFNQX0xJTktfUEQpOworCWlmIChhbng2MzQ1
LT5wYW5lbCkKKwkJZHJtX3BhbmVsX2Rpc2FibGUoYW54NjM0NS0+cGFuZWwpOworCisJaWYgKGFu
eDYzNDUtPnBvd2VyZWQpCisJCWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7Cit9CisKK3N0YXRp
YyB2b2lkIGFueDYzNDVfYnJpZGdlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQor
eworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gYnJpZGdlX3RvX2FueDYzNDUoYnJpZGdlKTsK
KwlpbnQgZXJyOworCisJaWYgKGFueDYzNDUtPnBhbmVsKQorCQlkcm1fcGFuZWxfZW5hYmxlKGFu
eDYzNDUtPnBhbmVsKTsKKworCWVyciA9IGFueDYzNDVfc3RhcnQoYW54NjM0NSk7CisJaWYgKGVy
cikgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBpbml0aWFsaXplOiAlZFxuIiwgZXJyKTsKKwkJ
cmV0dXJuOworCX0KKworCWVyciA9IGFueDYzNDVfY29uZmlnX2RwX291dHB1dChhbng2MzQ1KTsK
KwlpZiAoZXJyKQorCQlEUk1fRVJST1IoIkZhaWxlZCB0byBlbmFibGUgRFAgb3V0cHV0OiAlZFxu
IiwgZXJyKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIGFueDYz
NDVfYnJpZGdlX2Z1bmNzID0geworCS5hdHRhY2ggPSBhbng2MzQ1X2JyaWRnZV9hdHRhY2gsCisJ
Lm1vZGVfdmFsaWQgPSBhbng2MzQ1X2JyaWRnZV9tb2RlX3ZhbGlkLAorCS5kaXNhYmxlID0gYW54
NjM0NV9icmlkZ2VfZGlzYWJsZSwKKwkuZW5hYmxlID0gYW54NjM0NV9icmlkZ2VfZW5hYmxlLAor
fTsKKworc3RhdGljIHZvaWQgdW5yZWdpc3Rlcl9pMmNfZHVtbXlfY2xpZW50cyhzdHJ1Y3QgYW54
NjM0NSAqYW54NjM0NSkKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9IDE7IGkgPCBB
UlJBWV9TSVpFKGFueDYzNDUtPmkyY19jbGllbnRzKTsgaSsrKQorCQlpZiAoYW54NjM0NS0+aTJj
X2NsaWVudHNbaV0gJiYKKwkJICAgIGFueDYzNDUtPmkyY19jbGllbnRzW2ldLT5hZGRyICE9IGFu
eDYzNDUtPmNsaWVudC0+YWRkcikKKwkJCWkyY191bnJlZ2lzdGVyX2RldmljZShhbng2MzQ1LT5p
MmNfY2xpZW50c1tpXSk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgcmVnbWFwX2NvbmZpZyBh
bng2MzQ1X3JlZ21hcF9jb25maWcgPSB7CisJLnJlZ19iaXRzID0gOCwKKwkudmFsX2JpdHMgPSA4
LAorCS5tYXhfcmVnaXN0ZXIgPSAweGZmLAorCS5jYWNoZV90eXBlID0gUkVHQ0FDSEVfTk9ORSwK
K307CisKK3N0YXRpYyBjb25zdCB1MTYgYW54NjM0NV9jaGlwaWRfbGlzdFtdID0geworCTB4NjM0
NSwKK307CisKK3N0YXRpYyBib29sIGFueDYzNDVfZ2V0X2NoaXBfaWQoc3RydWN0IGFueDYzNDUg
KmFueDYzNDUpCit7CisJdW5zaWduZWQgaW50IGksIGlkbCwgaWRoLCB2ZXJzaW9uOworCisJaWYg
KHJlZ21hcF9yZWFkKGFueDYzNDUtPm1hcFtJMkNfSURYX1RYQ09NXSwgU1BfREVWSUNFX0lETF9S
RUcsICZpZGwpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAocmVnbWFwX3JlYWQoYW54NjM0NS0+
bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9ERVZJQ0VfSURIX1JFRywgJmlkaCkpCisJCXJldHVybiBm
YWxzZTsKKworCWFueDYzNDUtPmNoaXBpZCA9ICh1OClpZGwgfCAoKHU4KWlkaCA8PCA4KTsKKwor
CWlmIChyZWdtYXBfcmVhZChhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQX0RFVklDRV9W
RVJTSU9OX1JFRywKKwkJCSZ2ZXJzaW9uKSkKKwkJcmV0dXJuIGZhbHNlOworCisJZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUoYW54NjM0NV9jaGlwaWRfbGlzdCk7IGkrKykgeworCQlpZiAoYW54
NjM0NS0+Y2hpcGlkID09IGFueDYzNDVfY2hpcGlkX2xpc3RbaV0pIHsKKwkJCURSTV9JTkZPKCJG
b3VuZCBBTlgleCAodmVyLiAlZCkgZURQIFRyYW5zbWl0dGVyXG4iLAorCQkJCSBhbng2MzQ1LT5j
aGlwaWQsIHZlcnNpb24pOworCQkJcmV0dXJuIHRydWU7CisJCX0KKwl9CisKKwlEUk1fRVJST1Io
IkFOWCV4ICh2ZXIuICVkKSBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgZHJpdmVyXG4iLAorCQkgIGFu
eDYzNDUtPmNoaXBpZCwgdmVyc2lvbik7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBp
bnQgYW54NjM0NV9pMmNfcHJvYmUoc3RydWN0IGkyY19jbGllbnQgKmNsaWVudCwKKwkJCSAgICAg
Y29uc3Qgc3RydWN0IGkyY19kZXZpY2VfaWQgKmlkKQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2
MzQ1OworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwlpbnQgaSwgZXJyOworCisJYW54NjM0NSA9IGRl
dm1fa3phbGxvYygmY2xpZW50LT5kZXYsIHNpemVvZigqYW54NjM0NSksIEdGUF9LRVJORUwpOwor
CWlmICghYW54NjM0NSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwltdXRleF9pbml0KCZhbng2MzQ1
LT5sb2NrKTsKKworCWFueDYzNDUtPmJyaWRnZS5vZl9ub2RlID0gY2xpZW50LT5kZXYub2Zfbm9k
ZTsKKworCWFueDYzNDUtPmNsaWVudCA9IGNsaWVudDsKKwlpMmNfc2V0X2NsaWVudGRhdGEoY2xp
ZW50LCBhbng2MzQ1KTsKKworCWRldiA9ICZhbng2MzQ1LT5jbGllbnQtPmRldjsKKworCWVyciA9
IGRybV9vZl9maW5kX3BhbmVsX29yX2JyaWRnZShjbGllbnQtPmRldi5vZl9ub2RlLCAxLCAwLAor
CQkJCQkgICZhbng2MzQ1LT5wYW5lbCwgTlVMTCk7CisJaWYgKGVyciA9PSAtRVBST0JFX0RFRkVS
KQorCQlyZXR1cm4gZXJyOworCisJaWYgKGVycikKKwkJRFJNX0RFQlVHKCJObyBwYW5lbCBmb3Vu
ZFxuIik7CisKKwkvKiAxLjJWIGRpZ2l0YWwgY29yZSBwb3dlciByZWd1bGF0b3IgICovCisJYW54
NjM0NS0+ZHZkZDEyID0gZGV2bV9yZWd1bGF0b3JfZ2V0KGRldiwgImR2ZGQxMi1zdXBwbHkiKTsK
KwlpZiAoSVNfRVJSKGFueDYzNDUtPmR2ZGQxMikpIHsKKwkJRFJNX0VSUk9SKCJkdmRkMTItc3Vw
cGx5IG5vdCBmb3VuZFxuIik7CisJCXJldHVybiBQVFJfRVJSKGFueDYzNDUtPmR2ZGQxMik7CisJ
fQorCisJLyogMi41ViBkaWdpdGFsIGNvcmUgcG93ZXIgcmVndWxhdG9yICAqLworCWFueDYzNDUt
PmR2ZGQyNSA9IGRldm1fcmVndWxhdG9yX2dldChkZXYsICJkdmRkMjUtc3VwcGx5Iik7CisJaWYg
KElTX0VSUihhbng2MzQ1LT5kdmRkMjUpKSB7CisJCURSTV9FUlJPUigiZHZkZDI1LXN1cHBseSBu
b3QgZm91bmRcbiIpOworCQlyZXR1cm4gUFRSX0VSUihhbng2MzQ1LT5kdmRkMjUpOworCX0KKwor
CS8qIEdQSU8gZm9yIGNoaXAgcmVzZXQgKi8KKwlhbng2MzQ1LT5ncGlvZF9yZXNldCA9IGRldm1f
Z3Bpb2RfZ2V0KGRldiwgInJlc2V0IiwgR1BJT0RfT1VUX0xPVyk7CisJaWYgKElTX0VSUihhbng2
MzQ1LT5ncGlvZF9yZXNldCkpIHsKKwkJRFJNX0VSUk9SKCJSZXNldCBncGlvIG5vdCBmb3VuZFxu
Iik7CisJCXJldHVybiBQVFJfRVJSKGFueDYzNDUtPmdwaW9kX3Jlc2V0KTsKKwl9CisKKwkvKiBN
YXAgc2xhdmUgYWRkcmVzc2VzIG9mIEFOWDYzNDUgKi8KKwlmb3IgKGkgPSAwOyBpIDwgSTJDX05V
TV9BRERSRVNTRVM7IGkrKykgeworCQlpZiAoYW54NjM0NV9pMmNfYWRkcmVzc2VzW2ldID4+IDEg
IT0gY2xpZW50LT5hZGRyKQorCQkJYW54NjM0NS0+aTJjX2NsaWVudHNbaV0gPSBpMmNfbmV3X2R1
bW15KGNsaWVudC0+YWRhcHRlciwKKwkJCQkJCWFueDYzNDVfaTJjX2FkZHJlc3Nlc1tpXSA+PiAx
KTsKKwkJZWxzZQorCQkJYW54NjM0NS0+aTJjX2NsaWVudHNbaV0gPSBjbGllbnQ7CisKKwkJaWYg
KCFhbng2MzQ1LT5pMmNfY2xpZW50c1tpXSkgeworCQkJZXJyID0gLUVOT01FTTsKKwkJCURSTV9F
UlJPUigiRmFpbGVkIHRvIHJlc2VydmUgSTJDIGJ1cyAlMDJ4XG4iLAorCQkJCSAgYW54NjM0NV9p
MmNfYWRkcmVzc2VzW2ldKTsKKwkJCWdvdG8gZXJyX3VucmVnaXN0ZXJfaTJjOworCQl9CisKKwkJ
YW54NjM0NS0+bWFwW2ldID0gZGV2bV9yZWdtYXBfaW5pdF9pMmMoYW54NjM0NS0+aTJjX2NsaWVu
dHNbaV0sCisJCQkJCQkgICAgICAgJmFueDYzNDVfcmVnbWFwX2NvbmZpZyk7CisJCWlmIChJU19F
UlIoYW54NjM0NS0+bWFwW2ldKSkgeworCQkJZXJyID0gUFRSX0VSUihhbng2MzQ1LT5tYXBbaV0p
OworCQkJRFJNX0VSUk9SKCJGYWlsZWQgcmVnbWFwIGluaXRpYWxpemF0aW9uICUwMnhcbiIsCisJ
CQkJICBhbng2MzQ1X2kyY19hZGRyZXNzZXNbaV0pOworCQkJZ290byBlcnJfdW5yZWdpc3Rlcl9p
MmM7CisJCX0KKwl9CisKKwkvKiBMb29rIGZvciBzdXBwb3J0ZWQgY2hpcCBJRCAqLworCWFueDYz
NDVfcG93ZXJvbihhbng2MzQ1KTsKKwlpZiAoYW54NjM0NV9nZXRfY2hpcF9pZChhbng2MzQ1KSkg
eworCQlhbng2MzQ1LT5icmlkZ2UuZnVuY3MgPSAmYW54NjM0NV9icmlkZ2VfZnVuY3M7CisJCWRy
bV9icmlkZ2VfYWRkKCZhbng2MzQ1LT5icmlkZ2UpOworCisJCXJldHVybiAwOworCX0gZWxzZSB7
CisJCWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7CisJCWVyciA9IC1FTk9ERVY7CisJfQorCitl
cnJfdW5yZWdpc3Rlcl9pMmM6CisJdW5yZWdpc3Rlcl9pMmNfZHVtbXlfY2xpZW50cyhhbng2MzQ1
KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGFueDYzNDVfaTJjX3JlbW92ZShzdHJ1
Y3QgaTJjX2NsaWVudCAqY2xpZW50KQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gaTJj
X2dldF9jbGllbnRkYXRhKGNsaWVudCk7CisKKwlkcm1fYnJpZGdlX3JlbW92ZSgmYW54NjM0NS0+
YnJpZGdlKTsKKworCXVucmVnaXN0ZXJfaTJjX2R1bW15X2NsaWVudHMoYW54NjM0NSk7CisKKwlr
ZnJlZShhbng2MzQ1LT5lZGlkKTsKKworCW11dGV4X2Rlc3Ryb3koJmFueDYzNDUtPmxvY2spOwor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaTJjX2RldmljZV9pZCBhbng2
MzQ1X2lkW10gPSB7CisJeyAiYW54NjM0NSIsIDAgfSwKKwl7IC8qIHNlbnRpbmVsICovIH0KK307
CitNT0RVTEVfREVWSUNFX1RBQkxFKGkyYywgYW54NjM0NV9pZCk7CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3Qgb2ZfZGV2aWNlX2lkIGFueDYzNDVfbWF0Y2hfdGFibGVbXSA9IHsKKwl7IC5jb21wYXRp
YmxlID0gImFuYWxvZ2l4LGFueDYzNDUiLCB9LAorCXsgLyogc2VudGluZWwgKi8gfSwKK307CitN
T0RVTEVfREVWSUNFX1RBQkxFKG9mLCBhbng2MzQ1X21hdGNoX3RhYmxlKTsKKworc3RhdGljIHN0
cnVjdCBpMmNfZHJpdmVyIGFueDYzNDVfZHJpdmVyID0geworCS5kcml2ZXIgPSB7CisJCSAgIC5u
YW1lID0gImFueDYzNDUiLAorCQkgICAub2ZfbWF0Y2hfdGFibGUgPSBvZl9tYXRjaF9wdHIoYW54
NjM0NV9tYXRjaF90YWJsZSksCisJCSAgfSwKKwkucHJvYmUgPSBhbng2MzQ1X2kyY19wcm9iZSwK
KwkucmVtb3ZlID0gYW54NjM0NV9pMmNfcmVtb3ZlLAorCS5pZF90YWJsZSA9IGFueDYzNDVfaWQs
Cit9OworbW9kdWxlX2kyY19kcml2ZXIoYW54NjM0NV9kcml2ZXIpOworCitNT0RVTEVfREVTQ1JJ
UFRJT04oIkFOWDYzNDUgZURQIFRyYW5zbWl0dGVyIGRyaXZlciIpOworTU9EVUxFX0FVVEhPUigi
SWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPiIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2
MiIpOwotLSAKMi4xNi40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
