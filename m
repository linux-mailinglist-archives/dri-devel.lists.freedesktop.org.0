Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 092B52756B4
	for <lists+dri-devel@lfdr.de>; Wed, 23 Sep 2020 12:57:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 373286E941;
	Wed, 23 Sep 2020 10:57:47 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x342.google.com (mail-wm1-x342.google.com
 [IPv6:2a00:1450:4864:20::342])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1C7AA6E939
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Sep 2020 10:57:46 +0000 (UTC)
Received: by mail-wm1-x342.google.com with SMTP id e17so6683439wme.0
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Sep 2020 03:57:46 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=jH21pZs5HmBz+4VEG5XyFZvmILO//Vy8yo2HNuGYWUw=;
 b=J09Es2y211HW75cKmq7GQLDvhZJHtwxgB4lHHf1cBaNdbWxsXyE/c3OgNC2qMVfSpi
 7Cq9g7dnfq7tZySaZA4D+8MEab3z1zdKoFMVQzU5sARnVmYq+Ujk3rwSkKUEdRliZn8q
 PaQ/KBWre8tyDX2xDNKqRIsFsm5ua7klHFEcQ=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=jH21pZs5HmBz+4VEG5XyFZvmILO//Vy8yo2HNuGYWUw=;
 b=EnRcgh4st8uJFzkrs6ANcPYn01wM1PBBhkT0nCkP3Myron1Jal44+qJlxyB9LfKDiZ
 zGJQtfU4CMsRD+wSBrFN11CkpLHHiGhvP8kzRwA8z+WVoXmluWQCxiNSzZpDjSCPe4lK
 j3R5zOOLrcCYsej5gkYt2zrW78+CtRSBAXpRWLwdmkcir27p0ENsfSRLpSyly1xsM+Zj
 Zgmcj6yIPNeXJ8SuvHZfX6uVRFqYf44Lq9FzMiX22FNze3EunCCBwxPawW2QsE7P8O1D
 0a7lddMv7W4ejdfehhb5G5qcIKseGe7epT83f8RGgu8q2LjoxkFu1iarPX6alWZOqfkx
 YwTw==
X-Gm-Message-State: AOAM531yb4trJ3YhFgmJ08mJYJJijN0WZ7XiOBhmWZ6mYIcAPyxm9yER
 gMbmo/Rq/UrrkLYIvi3A64brfEVwlYJkVzdK
X-Google-Smtp-Source: ABdhPJyAj0nK+95p+rvWiTDhGzaJsNgMG/8gzuv2M7xc+eVbmCp3dLXD/S3nXRZtSs/bQKCiUYxvfQ==
X-Received: by 2002:a1c:408a:: with SMTP id n132mr5626193wma.45.1600858664388; 
 Wed, 23 Sep 2020 03:57:44 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id i14sm5678758wro.96.2020.09.23.03.57.43
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 23 Sep 2020 03:57:43 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 1/2] drm/atomic: document and enforce rules around "spurious"
 EBUSY
Date: Wed, 23 Sep 2020 12:57:36 +0200
Message-Id: <20200923105737.2943649-1-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.28.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@intel.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 Pekka Paalanen <pekka.paalanen@collabora.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2hlbiBkb2luZyBhbiBhdG9taWMgbW9kZXNldCB3aXRoIEFMTE9XX01PREVTRVQgZHJpdmVycyBh
cmUgYWxsb3dlZCB0bwpwdWxsIGluIGFyYml0cmFyeSBvdGhlciByZXNvdXJjZXMsIGluY2x1ZGlu
ZyBDUlRDcyAoZS5nLiB3aGVuCnJlY29uZmlndXJpbmcgZ2xvYmFsIHJlc291cmNlcykuCgpCdXQg
aW4gbm9uYmxvY2tpbmcgbW9kZSB1c2Vyc3BhY2UgaGFzIHRoZW4gbm8gaWRlYSB0aGlzIGhhcHBl
bmVkLAp3aGljaCBjYW4gbGVhZCB0byBzcHVyaW91cyBFQlVTWSBjYWxscywgYm90aDoKLSB3aGVu
IHRoYXQgb3RoZXIgQ1JUQyBpcyBjdXJyZW50bHkgYnVzeSBkb2luZyBhIHBhZ2VfZmxpcCB0aGUK
ICBBTExPV19NT0RFU0VUIGNvbW1pdCBjYW4gZmFpbCB3aXRoIGFuIEVCVVNZCi0gb24gdGhlIG90
aGVyIENSVEMgYSBub3JtYWwgYXRvbWljIGZsaXAgY2FuIGZhaWwgd2l0aCBFQlVTWSBiZWNhdXNl
CiAgb2YgdGhlIGFkZGl0aW9uYWwgY29tbWl0IGluc2VydGVkIGJ5IHRoZSBrZXJuZWwgd2l0aG91
dCB1c2Vyc3BhY2UncwogIGtub3dsZWRnZQoKRm9yIGJsb2NraW5nIGNvbW1pdHMgdGhpcyBpc24n
dCBhIHByb2JsZW0sIGJlY2F1c2UgZXZlcnlvbmUgZWxzZSB3aWxsCmp1c3QgYmxvY2sgdW50aWwg
YWxsIHRoZSBDUlRDIGFyZSByZWNvbmZpZ3VyZWQuIE9ubHkgdGhpbmcgdXNlcnNwYWNlCmNhbiBu
b3RpY2UgaXMgdGhlIGRyb3BwZWQgZnJhbWVzIHdpdGhvdXQgYW55IHJlYXNvbiBmb3Igd2h5IGZy
YW1lcyBnb3QKZHJvcHBlZC4KCkNvbnNlbnN1cyBpcyB0aGF0IHdlIG5lZWQgbmV3IHVhcGkgdG8g
aGFuZGxlIHRoaXMgcHJvcGVybHksIGJ1dCBubyBvbmUKaGFzIGFueSBpZGVhIHdoYXQgZXhhY3Rs
eSB0aGUgbmV3IHVhcGkgc2hvdWxkIGxvb2sgbGlrZS4gU2luY2UgdGhpcwpoYXMgYmVlbiBzaGlw
cGluZyBmb3IgeWVhcnMgYWxyZWFkeSBjb21wb3NpdG9ycyBuZWVkIHRvIGRlYWwgbm8gbWF0dGVy
CndoYXQsIHNvIGFzIGEgZmlyc3Qgc3RlcCBqdXN0IHRyeSB0byBlbmZvcmNlIHRoaXMgYWNyb3Nz
IGRyaXZlcnMKYmV0dGVyIHdpdGggc29tZSBjaGVja3MuCgp2MjogQWRkIGNvbW1lbnRzIGFuZCBh
IFdBUk5fT04gdG8gZW5mb3JjZSB0aGlzIG9ubHkgd2hlbiBhbGxvd2VkIC0gd2UKZG9uJ3Qgd2Fu
dCB0byBzaWxlbnRseSBjb252ZXJ0IHBhZ2UgZmxpcHMgaW50byBibG9ja2luZyBwbGFuZSB1cGRh
dGVzCmp1c3QgYmVjYXVzZSB0aGUgZHJpdmVyIGlzIGJ1Z2d5LgoKdjM6IEZpeCBpbnZlcnRlZCBX
QVJOX09OIChQZWtrYSkuCgp2NDogRHJvcCB0aGUgdWFwaSBjaGFuZ2VzLCBvbmx5IGFkZCBhIFdB
Uk5fT04gZm9yIG5vdyB0byBlbmZvcmNlIHNvbWUKcnVsZXMgZm9yIGRyaXZlcnMuCgp2NTogTWFr
ZSB0aGUgV0FSTklORyBtb3JlIGluZm9ybWF0aXZlIChEYW5pZWwpCgpSZWZlcmVuY2VzOiBodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9hcmNoaXZlcy9kcmktZGV2ZWwvMjAxOC1KdWx5LzE4
MjI4MS5odG1sCkJ1Z3ppbGxhOiBodHRwczovL2dpdGxhYi5mcmVlZGVza3RvcC5vcmcvd2F5bGFu
ZC93ZXN0b24vaXNzdWVzLzI0I25vdGVfOTU2OApDYzogRGFuaWVsIFN0b25lIDxkYW5pZWxAZm9v
aXNoYmFyLm9yZz4KQ2M6IFBla2thIFBhYWxhbmVuIDxwZWtrYS5wYWFsYW5lbkBjb2xsYWJvcmEu
Y28udWs+CkNjOiBTaW1vbiBTZXIgPGNvbnRhY3RAZW1lcnNpb24uZnI+CkNjOiBWaWxsZSBTeXJq
w6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBEYW5p
ZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pYy5jIHwgMjcgKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAxIGZpbGUgY2hh
bmdlZCwgMjcgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
YXRvbWljLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCmluZGV4IDU4NTI3ZjE1MTk4
NC4uZTIyNjY5YjY0NTIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKQEAgLTI4MSw2ICsyODEsMTAgQEAg
RVhQT1JUX1NZTUJPTChfX2RybV9hdG9taWNfc3RhdGVfZnJlZSk7CiAgKiBuZWVkZWQuIEl0IHdp
bGwgYWxzbyBncmFiIHRoZSByZWxldmFudCBDUlRDIGxvY2sgdG8gbWFrZSBzdXJlIHRoYXQgdGhl
IHN0YXRlCiAgKiBpcyBjb25zaXN0ZW50LgogICoKKyAqIFdBUk5JTkc6IERyaXZlcnMgbWF5IG9u
bHkgYWRkIG5ldyBDUlRDIHN0YXRlcyB0byBhIEBzdGF0ZSBpZgorICogZHJtX2F0b21pY19zdGF0
ZS5hbGxvd19tb2Rlc2V0IGlzIHNldCwgb3IgaWYgaXQncyBhIGRyaXZlci1pbnRlcm5hbCBjb21t
aXQKKyAqIG5vdCBjcmVhdGVkIGJ5IHVzZXJzcGFjZSB0aHJvdWdoIGFuIElPQ1RMIGNhbGwuCisg
KgogICogUmV0dXJuczoKICAqCiAgKiBFaXRoZXIgdGhlIGFsbG9jYXRlZCBzdGF0ZSBvciB0aGUg
ZXJyb3IgY29kZSBlbmNvZGVkIGludG8gdGhlIHBvaW50ZXIuIFdoZW4KQEAgLTEyNjIsMTAgKzEy
NjYsMTUgQEAgaW50IGRybV9hdG9taWNfY2hlY2tfb25seShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29u
bl9zdGF0ZTsKKwl1bnNpZ25lZCByZXF1ZXN0ZWRfY3J0YyA9IDA7CisJdW5zaWduZWQgYWZmZWN0
ZWRfY3J0YyA9IDA7CiAJaW50IGksIHJldCA9IDA7CiAKIAlEUk1fREVCVUdfQVRPTUlDKCJjaGVj
a2luZyAlcFxuIiwgc3RhdGUpOwogCisJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsIG9sZF9jcnRjX3N0YXRlLCBpKQorCQlyZXF1ZXN0ZWRfY3J0YyB8PSBkcm1fY3J0Y19t
YXNrKGNydGMpOworCiAJZm9yX2VhY2hfb2xkbmV3X3BsYW5lX2luX3N0YXRlKHN0YXRlLCBwbGFu
ZSwgb2xkX3BsYW5lX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUsIGkpIHsKIAkJcmV0ID0gZHJtX2F0
b21pY19wbGFuZV9jaGVjayhvbGRfcGxhbmVfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CiAJCWlm
IChyZXQpIHsKQEAgLTEzMTMsNiArMTMyMiwyNCBAQCBpbnQgZHJtX2F0b21pY19jaGVja19vbmx5
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJfQogCX0KIAorCWZvcl9lYWNoX25l
d19jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgaSkKKwkJYWZmZWN0
ZWRfY3J0YyB8PSBkcm1fY3J0Y19tYXNrKGNydGMpOworCisJLyoKKwkgKiBGb3IgY29tbWl0cyB0
aGF0IGFsbG93IG1vZGVzZXRzIGRyaXZlcnMgY2FuIGFkZCBvdGhlciBDUlRDcyB0byB0aGUKKwkg
KiBhdG9taWMgY29tbWl0LCBlLmcuIHdoZW4gdGhleSBuZWVkIHRvIHJlYWxsb2NhdGUgZ2xvYmFs
IHJlc291cmNlcy4KKwkgKiBUaGlzIGNhbiBjYXVzZSBzcHVyaW91cyBFQlVTWSwgd2hpY2ggcm9i
cyBjb21wb3NpdG9ycyBvZiBhIHZlcnkKKwkgKiBlZmZlY3RpdmUgc2FuaXR5IGNoZWNrIGZvciB0
aGVpciBkcmF3aW5nIGxvb3AuIFRoZXJlZm9yIG9ubHkgYWxsb3cKKwkgKiBkcml2ZXJzIHRvIGFk
ZCB1bnJlbGF0ZWQgQ1JUQyBzdGF0ZXMgZm9yIG1vZGVzZXQgY29tbWl0cy4KKwkgKgorCSAqIEZJ
WE1FOiBTaG91bGQgYWRkIGFmZmVjdGVkX2NydGMgbWFzayB0byB0aGUgQVRPTUlDIElPQ1RMIGFz
IGFuIG91dHB1dAorCSAqIHNvIGNvbXBvc2l0b3JzIGtub3cgd2hhdCdzIGdvaW5nIG9uLgorCSAq
LworCWlmIChhZmZlY3RlZF9jcnRjICE9IHJlcXVlc3RlZF9jcnRjKSB7CisJCVdBUk4oIXN0YXRl
LT5hbGxvd19tb2Rlc2V0LCAiYWRkaW5nIENSVEMgbm90IGFsbG93ZWQgd2l0aG91dCBtb2Rlc2V0
czogcmVxdWVzdGVkIDB4JXgsIGFmZmVjdGVkIDB4JTB4XG4iLAorCQkgICAgIHJlcXVlc3RlZF9j
cnRjLCBhZmZlY3RlZF9jcnRjKTsKKwl9CisKIAlyZXR1cm4gMDsKIH0KIEVYUE9SVF9TWU1CT0wo
ZHJtX2F0b21pY19jaGVja19vbmx5KTsKLS0gCjIuMjguMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
