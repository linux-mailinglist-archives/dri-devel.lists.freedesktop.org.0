Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8C6435D16F
	for <lists+dri-devel@lfdr.de>; Tue,  2 Jul 2019 16:19:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8426089AC6;
	Tue,  2 Jul 2019 14:19:19 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 94BCF89F77
 for <dri-devel@lists.freedesktop.org>; Tue,  2 Jul 2019 14:19:15 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 17EF6882FD;
 Tue,  2 Jul 2019 14:19:13 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-96.ams2.redhat.com
 [10.36.116.96])
 by smtp.corp.redhat.com (Postfix) with ESMTP id F07CF5D6A9;
 Tue,  2 Jul 2019 14:19:08 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id A458A1750B; Tue,  2 Jul 2019 16:19:04 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6 08/18] drm/virtio: rework virtio_gpu_execbuffer_ioctl
 fencing
Date: Tue,  2 Jul 2019 16:18:53 +0200
Message-Id: <20190702141903.1131-9-kraxel@redhat.com>
In-Reply-To: <20190702141903.1131-1-kraxel@redhat.com>
References: <20190702141903.1131-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.28]); Tue, 02 Jul 2019 14:19:15 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Gerd Hoffmann <kraxel@redhat.com>, gurchetansingh@chromium.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV3b3JrIGZlbmNpbmcgd29ya2Zsb3csIHN0YXJ0aW5nIHdpdGggdmlydGlvX2dwdV9leGVjYnVm
ZmVyX2lvY3RsLgpTdG9wIHVzaW5nIHR0bSBoZWxwZXJzLCB1c2UgdGhlIHZpcnRpb19ncHVfYXJy
YXlfKiBoZWxwZXJzICh3aGljaCB3b3JrCm9uIHRoZSByZXNlcnZhdGlvbiBvYmplY3RzIGRpcmVj
dGx5KSBpbnN0ZWFkLgoKTmV3IHdvcmtmbG93OgoKICgxKSBBbGwgZ2VtIG9iamVjdHMgbmVlZGVk
IGJ5IGEgY29tbWFuZCBhcmUgYWRkZWQgdG8gYQogICAgIHZpcnRpb19ncHVfb2JqZWN0X2FycmF5
LgogKDIpIEFsbCByZXNlcnZhdGlvbiBvYmplY3RzIHdpbGwgYmUgbG9ja2VkICh2aXJ0aW9fZ3B1
X2FycmF5X2xvY2tfcmVzdikuCiAoMykgdmlydGlvX2dwdV9mZW5jZV9lbWl0KCkgY29tcGxldGVz
IGZlbmNlIGluaXRpYWxpemF0aW9uLgogKDQpIGZlbmNlIGdldHMgYWRkZWQgdG8gdGhlIG9iamVj
dHMsIHJlc2VydmF0aW9uIG9iamVjdHMgYXJlIHVubG9ja2VkCiAgICAgKHZpcnRpb19ncHVfYXJy
YXlfYWRkX2ZlbmNlLCB2aXJ0aW9fZ3B1X2FycmF5X3VubG9ja19yZXN2KS4KICg1KSB2aXJ0aW8g
Y29tbWFuZCBpcyBzdWJtaXR0ZWQgdG8gdGhlIGhvc3QuCiAoNikgVGhlIGNvbXBsZXRpb24gY2Fs
bGJhY2sgKHZpcnRpb19ncHVfZGVxdWV1ZV9jdHJsX2Z1bmMpCiAgICAgd2lsbCBkcm9wIG9iamVj
dCByZWZlcmVuY2VzIGFuZCBmcmVlIHZpcnRpb19ncHVfb2JqZWN0X2FycmF5LgoKdjY6IHJld3Jp
dGUgbW9zdCBvZiB0aGUgcGF0Y2guCgpTaWduZWQtb2ZmLWJ5OiBHZXJkIEhvZmZtYW5uIDxrcmF4
ZWxAcmVkaGF0LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2Lmgg
ICB8ICA2ICsrLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMgfCA1NiAr
KysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1
X3ZxLmMgICAgfCAyMSArKysrKysrLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDM4IGluc2VydGlvbnMo
KyksIDQ1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8v
dmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAppbmRl
eCBhYmIwNzhhNWRlZGYuLjk4NTExZDFkZmZmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9kcnYuaApAQCAtMTIxLDkgKzEyMSw5IEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X3ZidWZmZXIgewog
CiAJY2hhciAqcmVzcF9idWY7CiAJaW50IHJlc3Bfc2l6ZTsKLQogCXZpcnRpb19ncHVfcmVzcF9j
YiByZXNwX2NiOwogCisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzOwogCXN0
cnVjdCBsaXN0X2hlYWQgbGlzdDsKIH07CiAKQEAgLTMxOCw3ICszMTgsOSBAQCB2b2lkIHZpcnRp
b19ncHVfY21kX2NvbnRleHRfZGV0YWNoX3Jlc291cmNlKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rldmlj
ZSAqdmdkZXYsCiAJCQkJCSAgICB1aW50MzJfdCByZXNvdXJjZV9pZCk7CiB2b2lkIHZpcnRpb19n
cHVfY21kX3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJICAgdm9p
ZCAqZGF0YSwgdWludDMyX3QgZGF0YV9zaXplLAotCQkJICAgdWludDMyX3QgY3R4X2lkLCBzdHJ1
Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UpOworCQkJICAgdWludDMyX3QgY3R4X2lkLAorCQkJ
ICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzLAorCQkJICAgc3RydWN0IHZp
cnRpb19ncHVfZmVuY2UgKmZlbmNlKTsKIHZvaWQgdmlydGlvX2dwdV9jbWRfdHJhbnNmZXJfZnJv
bV9ob3N0XzNkKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJCQkJCSAgdWludDMy
X3QgcmVzb3VyY2VfaWQsIHVpbnQzMl90IGN0eF9pZCwKIAkJCQkJICB1aW50NjRfdCBvZmZzZXQs
IHVpbnQzMl90IGxldmVsLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X2lvY3RsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYwppbmRl
eCAwY2FmZjNmYTYyM2UuLjk3MzVkN2U1ODk5YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X2lvY3RsLmMKQEAgLTEwNSwxNiArMTA1LDExIEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV9l
eGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJc3Ry
dWN0IGRybV92aXJ0Z3B1X2V4ZWNidWZmZXIgKmV4YnVmID0gZGF0YTsKIAlzdHJ1Y3QgdmlydGlv
X2dwdV9kZXZpY2UgKnZnZGV2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3QgdmlydGlvX2dw
dV9mcHJpdiAqdmZwcml2ID0gZHJtX2ZpbGUtPmRyaXZlcl9wcml2OwotCXN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqZ29iajsKIAlzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqb3V0X2ZlbmNlOwotCXN0
cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqcW9iajsKIAlpbnQgcmV0OwogCXVpbnQzMl90ICpib19o
YW5kbGVzID0gTlVMTDsKIAl2b2lkIF9fdXNlciAqdXNlcl9ib19oYW5kbGVzID0gTlVMTDsKLQlz
dHJ1Y3QgbGlzdF9oZWFkIHZhbGlkYXRlX2xpc3Q7Ci0Jc3RydWN0IHR0bV92YWxpZGF0ZV9idWZm
ZXIgKmJ1Zmxpc3QgPSBOVUxMOwotCWludCBpOwotCXN0cnVjdCB3d19hY3F1aXJlX2N0eCB0aWNr
ZXQ7CisJc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpidWZsaXN0ID0gTlVMTDsKIAlz
dHJ1Y3Qgc3luY19maWxlICpzeW5jX2ZpbGU7CiAJaW50IGluX2ZlbmNlX2ZkID0gZXhidWYtPmZl
bmNlX2ZkOwogCWludCBvdXRfZmVuY2VfZmQgPSAtMTsKQEAgLTE1NSwxNSArMTUwLDEwIEBAIHN0
YXRpYyBpbnQgdmlydGlvX2dwdV9leGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJCQlyZXR1cm4gb3V0X2ZlbmNlX2ZkOwogCX0KIAotCUlOSVRfTElT
VF9IRUFEKCZ2YWxpZGF0ZV9saXN0KTsKIAlpZiAoZXhidWYtPm51bV9ib19oYW5kbGVzKSB7Ci0K
IAkJYm9faGFuZGxlcyA9IGt2bWFsbG9jX2FycmF5KGV4YnVmLT5udW1fYm9faGFuZGxlcywKLQkJ
CQkJICAgc2l6ZW9mKHVpbnQzMl90KSwgR0ZQX0tFUk5FTCk7Ci0JCWJ1Zmxpc3QgPSBrdm1hbGxv
Y19hcnJheShleGJ1Zi0+bnVtX2JvX2hhbmRsZXMsCi0JCQkJCSAgIHNpemVvZihzdHJ1Y3QgdHRt
X3ZhbGlkYXRlX2J1ZmZlciksCi0JCQkJCSAgIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKLQkJ
aWYgKCFib19oYW5kbGVzIHx8ICFidWZsaXN0KSB7CisJCQkJCSAgICBzaXplb2YodWludDMyX3Qp
LCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFib19oYW5kbGVzKSB7CiAJCQlyZXQgPSAtRU5PTUVNOwog
CQkJZ290byBvdXRfdW51c2VkX2ZkOwogCQl9CkBAIC0xNzUsMjUgKzE2NSwyMSBAQCBzdGF0aWMg
aW50IHZpcnRpb19ncHVfZXhlY2J1ZmZlcl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAogCQkJZ290byBvdXRfdW51c2VkX2ZkOwogCQl9CiAKLQkJZm9yIChpID0gMDsg
aSA8IGV4YnVmLT5udW1fYm9faGFuZGxlczsgaSsrKSB7Ci0JCQlnb2JqID0gZHJtX2dlbV9vYmpl
Y3RfbG9va3VwKGRybV9maWxlLCBib19oYW5kbGVzW2ldKTsKLQkJCWlmICghZ29iaikgewotCQkJ
CXJldCA9IC1FTk9FTlQ7Ci0JCQkJZ290byBvdXRfdW51c2VkX2ZkOwotCQkJfQotCi0JCQlxb2Jq
ID0gZ2VtX3RvX3ZpcnRpb19ncHVfb2JqKGdvYmopOwotCQkJYnVmbGlzdFtpXS5ibyA9ICZxb2Jq
LT50Ym87Ci0KLQkJCWxpc3RfYWRkKCZidWZsaXN0W2ldLmhlYWQsICZ2YWxpZGF0ZV9saXN0KTsK
KwkJYnVmbGlzdCA9IHZpcnRpb19ncHVfYXJyYXlfZnJvbV9oYW5kbGVzKGRybV9maWxlLCBib19o
YW5kbGVzLAorCQkJCQkJCWV4YnVmLT5udW1fYm9faGFuZGxlcyk7CisJCWlmICghYnVmbGlzdCkg
eworCQkJcmV0ID0gLUVOT0VOVDsKKwkJCWdvdG8gb3V0X3VudXNlZF9mZDsKIAkJfQogCQlrdmZy
ZWUoYm9faGFuZGxlcyk7CiAJCWJvX2hhbmRsZXMgPSBOVUxMOwogCX0KIAotCXJldCA9IHZpcnRp
b19ncHVfb2JqZWN0X2xpc3RfdmFsaWRhdGUoJnRpY2tldCwgJnZhbGlkYXRlX2xpc3QpOwotCWlm
IChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7CisJaWYgKGJ1Zmxpc3QpIHsKKwkJcmV0ID0gdmlydGlv
X2dwdV9hcnJheV9sb2NrX3Jlc3YoYnVmbGlzdCk7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dF91
bnVzZWRfZmQ7CisJfQogCiAJYnVmID0gbWVtZHVwX3VzZXIodTY0X3RvX3VzZXJfcHRyKGV4YnVm
LT5jb21tYW5kKSwgZXhidWYtPnNpemUpOwogCWlmIChJU19FUlIoYnVmKSkgewpAQCAtMjIwLDI0
ICsyMDYsMTggQEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1X2V4ZWNidWZmZXJfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAl9CiAKIAl2aXJ0aW9fZ3B1X2NtZF9zdWJt
aXQodmdkZXYsIGJ1ZiwgZXhidWYtPnNpemUsCi0JCQkgICAgICB2ZnByaXYtPmN0eF9pZCwgb3V0
X2ZlbmNlKTsKLQotCXR0bV9ldV9mZW5jZV9idWZmZXJfb2JqZWN0cygmdGlja2V0LCAmdmFsaWRh
dGVfbGlzdCwgJm91dF9mZW5jZS0+Zik7Ci0KLQkvKiBmZW5jZSB0aGUgY29tbWFuZCBibyAqLwot
CXZpcnRpb19ncHVfdW5yZWZfbGlzdCgmdmFsaWRhdGVfbGlzdCk7Ci0Ja3ZmcmVlKGJ1Zmxpc3Qp
OworCQkJICAgICAgdmZwcml2LT5jdHhfaWQsIGJ1Zmxpc3QsIG91dF9mZW5jZSk7CiAJcmV0dXJu
IDA7CiAKIG91dF9tZW1kdXA6CiAJa2ZyZWUoYnVmKTsKIG91dF91bnJlc3Y6Ci0JdHRtX2V1X2Jh
Y2tvZmZfcmVzZXJ2YXRpb24oJnRpY2tldCwgJnZhbGlkYXRlX2xpc3QpOwotb3V0X2ZyZWU6Ci0J
dmlydGlvX2dwdV91bnJlZl9saXN0KCZ2YWxpZGF0ZV9saXN0KTsKKwlpZiAoYnVmbGlzdCkKKwkJ
dmlydGlvX2dwdV9hcnJheV91bmxvY2tfcmVzdihidWZsaXN0KTsKIG91dF91bnVzZWRfZmQ6CiAJ
a3ZmcmVlKGJvX2hhbmRsZXMpOwotCWt2ZnJlZShidWZsaXN0KTsKKwlpZiAoYnVmbGlzdCkKKwkJ
dmlydGlvX2dwdV9hcnJheV9wdXRfZnJlZShidWZsaXN0KTsKIAogCWlmIChvdXRfZmVuY2VfZmQg
Pj0gMCkKIAkJcHV0X3VudXNlZF9mZChvdXRfZmVuY2VfZmQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3Zp
cnRncHVfdnEuYwppbmRleCA2YzFhOTA3MTc1MzUuLmRiZTMyOTgwMWU4NCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X3ZxLmMKQEAgLTE5MSw3ICsxOTEsNyBAQCB2b2lkIHZpcnRpb19ncHVf
ZGVxdWV1ZV9jdHJsX2Z1bmMoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCX0gd2hpbGUgKCF2
aXJ0cXVldWVfZW5hYmxlX2NiKHZnZGV2LT5jdHJscS52cSkpOwogCXNwaW5fdW5sb2NrKCZ2Z2Rl
di0+Y3RybHEucWxvY2spOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGVudHJ5LCB0bXAs
ICZyZWNsYWltX2xpc3QsIGxpc3QpIHsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGVudHJ5LCAmcmVj
bGFpbV9saXN0LCBsaXN0KSB7CiAJCXJlc3AgPSAoc3RydWN0IHZpcnRpb19ncHVfY3RybF9oZHIg
KillbnRyeS0+cmVzcF9idWY7CiAKIAkJdHJhY2VfdmlydGlvX2dwdV9jbWRfcmVzcG9uc2Uodmdk
ZXYtPmN0cmxxLnZxLCByZXNwKTsKQEAgLTIxOCwxNCArMjE4LDE4IEBAIHZvaWQgdmlydGlvX2dw
dV9kZXF1ZXVlX2N0cmxfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJCX0KIAkJaWYg
KGVudHJ5LT5yZXNwX2NiKQogCQkJZW50cnktPnJlc3BfY2IodmdkZXYsIGVudHJ5KTsKLQotCQls
aXN0X2RlbCgmZW50cnktPmxpc3QpOwotCQlmcmVlX3ZidWYodmdkZXYsIGVudHJ5KTsKIAl9CiAJ
d2FrZV91cCgmdmdkZXYtPmN0cmxxLmFja19xdWV1ZSk7CiAKIAlpZiAoZmVuY2VfaWQpCiAJCXZp
cnRpb19ncHVfZmVuY2VfZXZlbnRfcHJvY2Vzcyh2Z2RldiwgZmVuY2VfaWQpOworCisJbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKGVudHJ5LCB0bXAsICZyZWNsYWltX2xpc3QsIGxpc3QpIHsKKwkJ
aWYgKGVudHJ5LT5vYmpzKQorCQkJdmlydGlvX2dwdV9hcnJheV9wdXRfZnJlZShlbnRyeS0+b2Jq
cyk7CisJCWxpc3RfZGVsKCZlbnRyeS0+bGlzdCk7CisJCWZyZWVfdmJ1Zih2Z2RldiwgZW50cnkp
OworCX0KIH0KIAogdm9pZCB2aXJ0aW9fZ3B1X2RlcXVldWVfY3Vyc29yX2Z1bmMoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKQpAQCAtMzM3LDYgKzM0MSwxMCBAQCBzdGF0aWMgaW50IHZpcnRpb19n
cHVfcXVldWVfZmVuY2VkX2N0cmxfYnVmZmVyKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdk
ZXYsCiAKIAlpZiAoZmVuY2UpCiAJCXZpcnRpb19ncHVfZmVuY2VfZW1pdCh2Z2RldiwgaGRyLCBm
ZW5jZSk7CisJaWYgKHZidWYtPm9ianMpIHsKKwkJdmlydGlvX2dwdV9hcnJheV9hZGRfZmVuY2Uo
dmJ1Zi0+b2JqcywgJmZlbmNlLT5mKTsKKwkJdmlydGlvX2dwdV9hcnJheV91bmxvY2tfcmVzdih2
YnVmLT5vYmpzKTsKKwl9CiAJcmMgPSB2aXJ0aW9fZ3B1X3F1ZXVlX2N0cmxfYnVmZmVyX2xvY2tl
ZCh2Z2RldiwgdmJ1Zik7CiAJc3Bpbl91bmxvY2soJnZnZGV2LT5jdHJscS5xbG9jayk7CiAJcmV0
dXJuIHJjOwpAQCAtOTM5LDcgKzk0Nyw5IEBAIHZvaWQgdmlydGlvX2dwdV9jbWRfdHJhbnNmZXJf
ZnJvbV9ob3N0XzNkKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAKIHZvaWQgdmly
dGlvX2dwdV9jbWRfc3VibWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJCQkg
ICB2b2lkICpkYXRhLCB1aW50MzJfdCBkYXRhX3NpemUsCi0JCQkgICB1aW50MzJfdCBjdHhfaWQs
IHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSkKKwkJCSAgIHVpbnQzMl90IGN0eF9pZCwK
KwkJCSAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqcywKKwkJCSAgIHN0cnVj
dCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSkKIHsKIAlzdHJ1Y3QgdmlydGlvX2dwdV9jbWRfc3Vi
bWl0ICpjbWRfcDsKIAlzdHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVyICp2YnVmOwpAQCAtOTQ5LDYg
Kzk1OSw3IEBAIHZvaWQgdmlydGlvX2dwdV9jbWRfc3VibWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X2Rl
dmljZSAqdmdkZXYsCiAKIAl2YnVmLT5kYXRhX2J1ZiA9IGRhdGE7CiAJdmJ1Zi0+ZGF0YV9zaXpl
ID0gZGF0YV9zaXplOworCXZidWYtPm9ianMgPSBvYmpzOwogCiAJY21kX3AtPmhkci50eXBlID0g
Y3B1X3RvX2xlMzIoVklSVElPX0dQVV9DTURfU1VCTUlUXzNEKTsKIAljbWRfcC0+aGRyLmN0eF9p
ZCA9IGNwdV90b19sZTMyKGN0eF9pZCk7Ci0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
