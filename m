Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D4CBAAD3B0
	for <lists+dri-devel@lfdr.de>; Mon,  9 Sep 2019 09:23:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6A44B897EB;
	Mon,  9 Sep 2019 07:23:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay9-d.mail.gandi.net (relay9-d.mail.gandi.net
 [217.70.183.199])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5885E6E2A3
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Sep 2019 13:53:34 +0000 (UTC)
X-Originating-IP: 2.224.242.101
Received: from uno.lan (2-224-242-101.ip172.fastwebnet.it [2.224.242.101])
 (Authenticated sender: jacopo@jmondi.org)
 by relay9-d.mail.gandi.net (Postfix) with ESMTPSA id 56EDCFF80E;
 Fri,  6 Sep 2019 13:53:30 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli+renesas@fpond.eu,
 VenkataRajesh.Kalakodima@in.bosch.com
Subject: [PATCH v4 3/9] drm: rcar-du: Add support for CMM
Date: Fri,  6 Sep 2019 15:54:30 +0200
Message-Id: <20190906135436.10622-4-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190906135436.10622-1-jacopo+renesas@jmondi.org>
References: <20190906135436.10622-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 09 Sep 2019 07:23:02 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: muroya@ksk.co.jp, airlied@linux.ie, koji.matsuoka.xm@renesas.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-renesas-soc@vger.kernel.org, Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Harsha.ManjulaMallikarjun@in.bosch.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGEgZHJpdmVyIGZvciB0aGUgUi1DYXIgRGlzcGxheSBVbml0IENvbG9yIENvcnJlY3Rpb24g
TW9kdWxlLgoKSW4gbW9zdCBvZiBHZW4zIFNvQ3MsIGVhY2ggRFUgb3V0cHV0IGNoYW5uZWwgaXMg
cHJvdmlkZWQgd2l0aCBhIENNTSB1bml0CnRvIHBlcmZvcm0gaW1hZ2UgZW5oYW5jZW1lbnQgYW5k
IGNvbG9yIGNvcnJlY3Rpb24uCgpBZGQgc3VwcG9ydCBmb3IgQ01NIHRocm91Z2ggYSBkcml2ZXIg
dGhhdCBzdXBwb3J0cyBjb25maWd1cmF0aW9uIG9mCnRoZSAxLWRpbWVuc2lvbmFsIExVVCB0YWJs
ZS4gTW9yZSBhZHZhbmNlZCBDTU0gZmVhdHVyZSB3aWxsIGJlCmltcGxlbWVudGVkIG9uIHRvcCBv
ZiB0aGlzIGJhc2ljIG9uZS4KClNpZ25lZC1vZmYtYnk6IEphY29wbyBNb25kaSA8amFjb3BvK3Jl
bmVzYXNAam1vbmRpLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9LY29uZmlnICAg
IHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlICAgfCAgIDEgKwogZHJp
dmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYyB8IDI1MSArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaCB8ICA2MSArKysr
KysrCiA0IGZpbGVzIGNoYW5nZWQsIDMyMCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2
NDQgZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYwogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfY21tLmgKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vcmNhci1kdS9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvS2NvbmZp
ZwppbmRleCAxNTI5ODQ5ZTIxN2UuLjUzOWQyMzI3OTBkMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3JjYXItZHUvS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9LY29u
ZmlnCkBAIC0xMyw2ICsxMywxMyBAQCBjb25maWcgRFJNX1JDQVJfRFUKIAkgIENob29zZSB0aGlz
IG9wdGlvbiBpZiB5b3UgaGF2ZSBhbiBSLUNhciBjaGlwc2V0LgogCSAgSWYgTSBpcyBzZWxlY3Rl
ZCB0aGUgbW9kdWxlIHdpbGwgYmUgY2FsbGVkIHJjYXItZHUtZHJtLgogCitjb25maWcgRFJNX1JD
QVJfQ01NCisJYm9vbCAiUi1DYXIgRFUgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUgKENNTSkgU3Vw
cG9ydCIKKwlkZXBlbmRzIG9uIERSTSAmJiBPRgorCWRlcGVuZHMgb24gRFJNX1JDQVJfRFUKKwlo
ZWxwCisJICBFbmFibGUgc3VwcG9ydCBmb3IgUi1DYXIgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUg
KENNTSkuCisKIGNvbmZpZyBEUk1fUkNBUl9EV19IRE1JCiAJdHJpc3RhdGUgIlItQ2FyIERVIEdl
bjMgSERNSSBFbmNvZGVyIFN1cHBvcnQiCiAJZGVwZW5kcyBvbiBEUk0gJiYgT0YKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL3Jj
YXItZHUvTWFrZWZpbGUKaW5kZXggNmMyZWQ5YzQ2NDY3Li40ZDExODdjY2MzZTUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9yY2FyLWR1L01ha2VmaWxlCkBAIC0xNSw2ICsxNSw3IEBAIHJjYXItZHUtZHJtLSQoQ09ORklH
X0RSTV9SQ0FSX0xWRFMpCSs9IHJjYXJfZHVfb2YubyBcCiByY2FyLWR1LWRybS0kKENPTkZJR19E
Uk1fUkNBUl9WU1ApCSs9IHJjYXJfZHVfdnNwLm8KIHJjYXItZHUtZHJtLSQoQ09ORklHX0RSTV9S
Q0FSX1dSSVRFQkFDSykgKz0gcmNhcl9kdV93cml0ZWJhY2subwogCitvYmotJChDT05GSUdfRFJN
X1JDQVJfQ01NKQkJKz0gcmNhcl9jbW0ubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0RVKQkJKz0g
cmNhci1kdS1kcm0ubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0RXX0hETUkpCQkrPSByY2FyX2R3
X2hkbWkubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0xWRFMpCQkrPSByY2FyX2x2ZHMubwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfY21tLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi4zY2FjZGM0NDc0YzcKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
cmNhci1kdS9yY2FyX2NtbS5jCkBAIC0wLDAgKzEsMjUxIEBACisvLyBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogR1BMLTIuMCsKKy8qCisgKiByY2FyX2NtbS5jIC0tIFItQ2FyIERpc3BsYXkgVW5p
dCBDb2xvciBNYW5hZ2VtZW50IE1vZHVsZQorICoKKyAqIENvcHlyaWdodCAoQykgMjAxOSBKYWNv
cG8gTW9uZGkgPGphY29wbytyZW5lc2FzQGptb25kaS5vcmc+CisgKi8KKworI2luY2x1ZGUgPGxp
bnV4L2lvLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvb2Yu
aD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9w
bV9ydW50aW1lLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2NvbG9yX21nbXQuaD4KKworI2luY2x1
ZGUgInJjYXJfY21tLmgiCisKKyNkZWZpbmUgQ00yX0xVVF9DVFJMCQkweDAwMDAKKyNkZWZpbmUg
Q00yX0xVVF9DVFJMX0xVVF9FTglCSVQoMCkKKyNkZWZpbmUgQ00yX0xVVF9UQkxfQkFTRQkweDA2
MDAKKyNkZWZpbmUgQ00yX0xVVF9UQkwoX19pKQkoQ00yX0xVVF9UQkxfQkFTRSArIChfX2kpICog
NCkKKworc3RydWN0IHJjYXJfY21tIHsKKwl2b2lkIF9faW9tZW0gKmJhc2U7CisJYm9vbCBlbmFi
bGVkOworCisJLyoKKwkgKiBAbHV0OgkJMUQtTFVUIHN0YXR1cworCSAqIEBsdXQuZW5hYmxlZDoJ
MUQtTFVUIGVuYWJsZWQgZmxhZworCSAqIEBsdXQudGFibGU6CQlUYWJsZSBvZiAxRC1MVVQgZW50
cmllcyBzY2FsZWQgdG8gaGFyZHdhcmUKKwkgKgkJCXByZWNpc2lvbiAoOC1iaXRzIHBlciBjb2xv
ciBjb21wb25lbnQpCisJICovCisJc3RydWN0IHsKKwkJYm9vbCBlbmFibGVkOworCQl1MzIgdGFi
bGVbQ00yX0xVVF9TSVpFXTsKKwl9IGx1dDsKK307CisKK3N0YXRpYyBpbmxpbmUgaW50IHJjYXJf
Y21tX3JlYWQoc3RydWN0IHJjYXJfY21tICpyY21tLCB1MzIgcmVnKQoreworCXJldHVybiBpb3Jl
YWQzMihyY21tLT5iYXNlICsgcmVnKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHJjYXJfY21t
X3dyaXRlKHN0cnVjdCByY2FyX2NtbSAqcmNtbSwgdTMyIHJlZywgdTMyIGRhdGEpCit7CisJaW93
cml0ZTMyKGRhdGEsIHJjbW0tPmJhc2UgKyByZWcpOworfQorCisvKgorICogcmNhcl9jbW1fbHV0
X2V4dHJhY3QoKSAtIFNjYWxlIGRvd24gdG8gaGFyZHdhcmUgcHJlY2lzaW9uIHRoZSBEUk0gTFVU
IHRhYmxlCisgKgkJCSAgICBlbnRyaWVzIGFuZCBzdG9yZSB0aGVtLgorICogQHJjbW06IFBvaW50
ZXIgdG8gdGhlIENNTSBkZXZpY2UKKyAqIEBkcm1fbHV0OiBQb2ludGVyIHRvIHRoZSBEUk0gTFVU
IHRhYmxlCisgKi8KK3N0YXRpYyB2b2lkIHJjYXJfY21tX2x1dF9leHRyYWN0KHN0cnVjdCByY2Fy
X2NtbSAqcmNtbSwKKwkJCQkgY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmRybV9sdXQpCit7
CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQ00yX0xVVF9TSVpFOyArK2kp
IHsKKwkJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9ICZkcm1fbHV0W2ldOworCisJ
CXJjbW0tPmx1dC50YWJsZVtpXSA9IGRybV9jb2xvcl9sdXRfZXh0cmFjdChsdXQtPnJlZCwgOCkg
PDwgMTYKKwkJCQkgICB8IGRybV9jb2xvcl9sdXRfZXh0cmFjdChsdXQtPmdyZWVuLCA4KSA8PCA4
CisJCQkJICAgfCBkcm1fY29sb3JfbHV0X2V4dHJhY3QobHV0LT5ibHVlLCA4KTsKKwl9Cit9CisK
Ky8qCisgKiByY2FyX2NtbV9sdXRfd3JpdGUoKSAtIFdyaXRlIHRvIGhhcmR3YXJlIHRoZSBMVVQg
dGFibGUgZW50cmllcyBmcm9tIHRoZQorICoJCQkgIGxvY2FsIHRhYmxlLgorICogQHJjbW06IFBv
aW50ZXIgdG8gdGhlIENNTSBkZXZpY2UKKyAqLworc3RhdGljIHZvaWQgcmNhcl9jbW1fbHV0X3dy
aXRlKHN0cnVjdCByY2FyX2NtbSAqcmNtbSkKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAo
aSA9IDA7IGkgPCBDTTJfTFVUX1NJWkU7ICsraSkKKwkJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00y
X0xVVF9UQkwoaSksIHJjbW0tPmx1dC50YWJsZVtpXSk7Cit9CisKKy8qCisgKiByY2FyX2NtbV9z
ZXR1cCgpIC0gQ29uZmlndXJlIHRoZSBDTU0gdW5pdC4KKyAqIEBwZGV2OiBUaGUgcGxhdGZvcm0g
ZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgQ01NIGluc3RhbmNlCisgKiBAY29uZmlnOiBUaGUg
Q1JUQy1wcm92aWRlZCBjb25maWd1cmF0aW9uLgorICoKKyAqIENvbmZpZ3VyZSB0aGUgQ01NIHVu
aXQgd2l0aCB0aGUgQ1JUQy1wcm92aWRlZCBjb25maWd1cmF0aW9uLgorICogQ3VycmVudGx5IGVu
YWJsaW5nLCBkaXNhYmxpbmcgYW5kIHByb2dyYW1taW5nIG9mIHRoZSAxLUQgTFVUIHVuaXQgaXMK
KyAqIHN1cHBvcnRlZC4KKyAqLworaW50IHJjYXJfY21tX3NldHVwKHN0cnVjdCBwbGF0Zm9ybV9k
ZXZpY2UgKnBkZXYsCisJCSAgIGNvbnN0IHN0cnVjdCByY2FyX2NtbV9jb25maWcgKmNvbmZpZykK
K3sKKwlzdHJ1Y3QgcmNhcl9jbW0gKnJjbW0gPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsK
KworCS8qCisJICogQXMgcmNhcl9jbW1fc2V0dXAoKSBpcyBjYWxsZWQgYnkgYXRvbWljIGNvbW1p
dCB0YWlsIGhlbHBlciwgaXQgbWlnaHQKKwkgKiBiZSBjYWxsZWQgd2hlbiB0aGUgQ01NIGlzIGRp
c2FibGVkLiBBcyB3ZSBjYW4ndCBwcm9ncmFtIHRoZSBoYXJkd2FyZQorCSAqIGluIHRoYXQgY2Fz
ZSwgc3RvcmUgdGhlIGNvbmZpZ3VyYXRpb24gaW50ZXJuYWxseSBhbmQgYXBwbHkgaXQgd2hlbgor
CSAqIHRoZSBDTU0gd2lsbCBiZSBlbmFibGVkIGJ5IHRoZSBDUlRDIHRocm91Z2ggcmNhcl9jbW1f
ZW5hYmxlKCkuCisJICovCisJaWYgKCFyY21tLT5lbmFibGVkKSB7CisJCWlmICghY29uZmlnLT5s
dXQuZW5hYmxlKQorCQkJcmV0dXJuIDA7CisKKwkJcmNhcl9jbW1fbHV0X2V4dHJhY3QocmNtbSwg
Y29uZmlnLT5sdXQudGFibGUpOworCQlyY21tLT5sdXQuZW5hYmxlZCA9IHRydWU7CisKKwkJcmV0
dXJuIDA7CisJfQorCisJLyogU3RvcCBMVVQgb3BlcmF0aW9ucyBpZiByZXF1ZXN0ZWQuICovCisJ
aWYgKCFjb25maWctPmx1dC5lbmFibGUpIHsKKwkJaWYgKHJjbW0tPmx1dC5lbmFibGVkKSB7CisJ
CQlyY2FyX2NtbV93cml0ZShyY21tLCBDTTJfTFVUX0NUUkwsIDApOworCQkJcmNtbS0+bHV0LmVu
YWJsZWQgPSBmYWxzZTsKKwkJfQorCisJCXJldHVybiAwOworCX0KKworCS8qCisJICogRW5hYmxl
IExVVCBhbmQgcHJvZ3JhbSB0aGUgbmV3IGdhbW1hIHRhYmxlIHZhbHVlcy4KKwkgKgorCSAqIEZJ
WE1FOiBJbiBvcmRlciB0byBoYXZlIHN0YWJsZSBvcGVyYXRpb25zIGl0IGlzIHJlcXVpcmVkIHRv
IGZpcnN0CisJICogZW5hYmxlIHRoZSAxRC1MVVQgYW5kIHRoZW4gcHJvZ3JhbSBpdHMgdGFibGUg
ZW50cmllcy4gVGhpcyBzZWVtcyB0bworCSAqIGNvbnRyYWRpY3Qgd2hhdCB0aGUgY2hpcCBtYW51
YWwgcmVwb3J0cywgYW5kIHdpbGwgaGF2ZSB0byBiZQorCSAqIHJlY29uc2lkZXJlZCB3aGVuIGlt
cGxlbWVudGluZyBzdXBwb3J0IGZvciBkb3VibGUgYnVmZmVyaW5nLgorCSAqLworCWlmICghcmNt
bS0+bHV0LmVuYWJsZWQpIHsKKwkJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00yX0xVVF9DVFJMLCBD
TTJfTFVUX0NUUkxfTFVUX0VOKTsKKwkJcmNtbS0+bHV0LmVuYWJsZWQgPSB0cnVlOworCX0KKwor
CXJjYXJfY21tX2x1dF9leHRyYWN0KHJjbW0sIGNvbmZpZy0+bHV0LnRhYmxlKTsKKwlyY2FyX2Nt
bV9sdXRfd3JpdGUocmNtbSk7CisKKwlyZXR1cm4gMDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKHJj
YXJfY21tX3NldHVwKTsKKworLyoKKyAqIHJjYXJfY21tX2VuYWJsZSgpIC0gRW5hYmxlIHRoZSBD
TU0gdW5pdC4KKyAqIEBwZGV2OiBUaGUgcGxhdGZvcm0gZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0
aGUgQ01NIGluc3RhbmNlCisgKgorICogRW5hYmxlIHRoZSBDTU0gdW5pdCBieSBlbmFibGluZyB0
aGUgcGFyZW50IGNsb2NrIGFuZCBlbmFibGluZyB0aGUgQ01NCisgKiBjb21wb25lbnRzLCBzdWNo
IGFzIDEtRCBMVVQsIGlmIHJlcXVlc3RlZC4KKyAqLworaW50IHJjYXJfY21tX2VuYWJsZShzdHJ1
Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCByY2FyX2NtbSAqcmNtbSA9IHBs
YXRmb3JtX2dldF9kcnZkYXRhKHBkZXYpOworCWludCByZXQ7CisKKwlyZXQgPSBwbV9ydW50aW1l
X2dldF9zeW5jKCZwZGV2LT5kZXYpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJ
LyogQXBwbHkgdGhlIExVVCB0YWJsZSB2YWx1ZXMgc2F2ZWQgYXQgcmNhcl9jbW1fc2V0dXAoKSB0
aW1lLiAqLworCWlmIChyY21tLT5sdXQuZW5hYmxlZCkgeworCQlyY2FyX2NtbV93cml0ZShyY21t
LCBDTTJfTFVUX0NUUkwsIENNMl9MVVRfQ1RSTF9MVVRfRU4pOworCQlyY2FyX2NtbV9sdXRfd3Jp
dGUocmNtbSk7CisJfQorCisJcmNtbS0+ZW5hYmxlZCA9IHRydWU7CisKKwlyZXR1cm4gMDsKK30K
K0VYUE9SVF9TWU1CT0xfR1BMKHJjYXJfY21tX2VuYWJsZSk7CisKKy8qCisgKiByY2FyX2NtbV9k
aXNhYmxlKCkgLSBEaXNhYmxlIHRoZSBDTU0gdW5pdC4KKyAqIEBwZGV2OiBUaGUgcGxhdGZvcm0g
ZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgQ01NIGluc3RhbmNlCisgKgorICogRGlzYWJsZSB0
aGUgQ01NIHVuaXQgYnkgc3RvcHBpbmcgdGhlIHBhcmVudCBjbG9jay4KKyAqLwordm9pZCByY2Fy
X2NtbV9kaXNhYmxlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IHJj
YXJfY21tICpyY21tID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEocGRldik7CisKKwlyY2FyX2NtbV93
cml0ZShyY21tLCBDTTJfTFVUX0NUUkwsIDApOworCisJcG1fcnVudGltZV9wdXQoJnBkZXYtPmRl
dik7CisKKwlyY21tLT5sdXQuZW5hYmxlZCA9IGZhbHNlOworCXJjbW0tPmVuYWJsZWQgPSBmYWxz
ZTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKHJjYXJfY21tX2Rpc2FibGUpOworCisvKgorICogcmNh
cl9jbW1faW5pdCgpIC0gTWFrZSBzdXJlIHRoZSBDTU0gaGFzIHByb2JlZC4KKyAqIEBwZGV2OiBU
aGUgcGxhdGZvcm0gZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgQ01NIGluc3RhbmNlCisgKgor
ICogUmV0dXJuOiAwIGlmIHRoZSBDTU0gaGFzIHByb2JlZCwgLUVQUk9CRV9ERUZFUiBvdGhlcndp
c2UKKyAqLworaW50IHJjYXJfY21tX2luaXQoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikK
K3sKKwlzdHJ1Y3QgcmNhcl9jbW0gKnJjbW0gPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsK
KworCWlmICghcmNtbSkKKwkJcmV0dXJuIC1FUFJPQkVfREVGRVI7CisKKwlyZXR1cm4gMDsKK30K
K0VYUE9SVF9TWU1CT0xfR1BMKHJjYXJfY21tX2luaXQpOworCitzdGF0aWMgaW50IHJjYXJfY21t
X3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IHJjYXJfY21t
ICpyY21tOworCisJcmNtbSA9IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBzaXplb2YoKnJjbW0p
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJjbW0pCisJCXJldHVybiAtRU5PTUVNOworCXBsYXRmb3Jt
X3NldF9kcnZkYXRhKHBkZXYsIHJjbW0pOworCisJcmNtbS0+YmFzZSA9IGRldm1fcGxhdGZvcm1f
aW9yZW1hcF9yZXNvdXJjZShwZGV2LCAwKTsKKwlpZiAoSVNfRVJSKHJjbW0tPmJhc2UpKQorCQly
ZXR1cm4gUFRSX0VSUihyY21tLT5iYXNlKTsKKworCXBtX3J1bnRpbWVfZW5hYmxlKCZwZGV2LT5k
ZXYpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcmNhcl9jbW1fcmVtb3ZlKHN0cnVj
dCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJcG1fcnVudGltZV9kaXNhYmxlKCZwZGV2LT5k
ZXYpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lk
IHJjYXJfY21tX29mX3RhYmxlW10gPSB7CisJeyAuY29tcGF0aWJsZSA9ICJyZW5lc2FzLHJjYXIt
Z2VuMy1jbW0iLCB9LAorCXsgLmNvbXBhdGlibGUgPSAicmVuZXNhcyxyY2FyLWdlbjItY21tIiwg
fSwKKwl7IH0sCit9OworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgcmNhcl9jbW1fb2ZfdGFibGUp
OworCitzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2RyaXZlciByY2FyX2NtbV9wbGF0Zm9ybV9kcml2
ZXIgPSB7CisJLnByb2JlCQk9IHJjYXJfY21tX3Byb2JlLAorCS5yZW1vdmUJCT0gcmNhcl9jbW1f
cmVtb3ZlLAorCS5kcml2ZXIJCT0geworCQkubmFtZQk9ICJyY2FyLWNtbSIsCisJCS5vZl9tYXRj
aF90YWJsZSA9IHJjYXJfY21tX29mX3RhYmxlLAorCX0sCit9OworCittb2R1bGVfcGxhdGZvcm1f
ZHJpdmVyKHJjYXJfY21tX3BsYXRmb3JtX2RyaXZlcik7CisKK01PRFVMRV9BVVRIT1IoIkphY29w
byBNb25kaSA8amFjb3BvK3JlbmVzYXNAam1vbmRpLm9yZz4iKTsKK01PRFVMRV9ERVNDUklQVElP
TigiUmVuZXNhcyBSLUNhciBDTU0gRHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2NtbS5oIGIvZHJpdmVy
cy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjE1YTJjODc0YjZhNgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfY21tLmgKQEAgLTAsMCArMSw2MSBAQAorLyogU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjArICovCisvKgorICogcmNhcl9jbW0uaCAtLSBSLUNhciBEaXNw
bGF5IFVuaXQgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIw
MTkgSmFjb3BvIE1vbmRpIDxqYWNvcG8rcmVuZXNhc0BqbW9uZGkub3JnPgorICovCisKKyNpZm5k
ZWYgX19SQ0FSX0NNTV9IX18KKyNkZWZpbmUgX19SQ0FSX0NNTV9IX18KKworI2RlZmluZSBDTTJf
TFVUX1NJWkUJCTI1NgorCitzdHJ1Y3QgZHJtX2NvbG9yX2x1dDsKK3N0cnVjdCBwbGF0Zm9ybV9k
ZXZpY2U7CisKKy8qKgorICogc3RydWN0IHJjYXJfY21tX2NvbmZpZyAtIENNTSBjb25maWd1cmF0
aW9uCisgKgorICogQGx1dDoJMUQtTFVUIGNvbmZpZ3VyYXRpb24KKyAqIEBsdXQuZW5hYmxlOgkx
RC1MVVQgZW5hYmxlIGZsYWcKKyAqIEBsdXQudGFibGU6CTFELUxVVCB0YWJsZSBlbnRyaWVzLiBN
aWdodCBiZSBzZXQgdG8gTlVMTCB3aGVuIHRoZSBDTU0gaGFzIHRvCisgKgkJYmUgcmUtZW5hYmxl
ZCBidXQgbm90IHJlPXByb2dyYW1tZWQuCisgKi8KK3N0cnVjdCByY2FyX2NtbV9jb25maWcgewor
CXN0cnVjdCB7CisJCWJvb2wgZW5hYmxlOworCQlzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqdGFibGU7
CisJfSBsdXQ7Cit9OworCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX1JDQVJfQ01NKQoraW50
IHJjYXJfY21tX2luaXQoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CisKK2ludCByY2Fy
X2NtbV9lbmFibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7Cit2b2lkIHJjYXJfY21t
X2Rpc2FibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CisKK2ludCByY2FyX2NtbV9z
ZXR1cChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAorCQkgICBjb25zdCBzdHJ1Y3QgcmNh
cl9jbW1fY29uZmlnICpjb25maWcpOworI2Vsc2UKK3N0YXRpYyBpbmxpbmUgaW50IHJjYXJfY21t
X2luaXQoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGlubGluZSBpbnQgcmNhcl9jbW1fZW5hYmxlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2Ug
KnBkZXYpCit7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCByY2FyX2NtbV9k
aXNhYmxlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7Cit9CisKK3N0YXRpYyBpbnQg
cmNhcl9jbW1fc2V0dXAoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKKwkJCSAgY29uc3Qg
c3RydWN0IHJjYXJfY21tX2NvbmZpZyAqY29uZmlnKQoreworCXJldHVybiAwOworfQorI2VuZGlm
IC8qIElTX0VOQUJMRUQoQ09ORklHX0RSTV9SQ0FSX0NNTSkgKi8KKworI2VuZGlmIC8qIF9fUkNB
Ul9DTU1fSF9fICovCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
