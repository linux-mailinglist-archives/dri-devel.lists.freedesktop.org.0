Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7F1411079CD
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 22:09:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 593FA6F589;
	Fri, 22 Nov 2019 21:09:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2B1846F574;
 Fri, 22 Nov 2019 21:09:01 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Nov 2019 13:09:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,231,1571727600"; d="scan'208";a="205575844"
Received: from nvishwa1-desk.sc.intel.com ([10.3.160.185])
 by fmsmga007.fm.intel.com with ESMTP; 22 Nov 2019 13:08:59 -0800
From: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC 03/13] drm/i915/svm: Runtime (RT) allocator support
Date: Fri, 22 Nov 2019 12:57:24 -0800
Message-Id: <20191122205734.15925-4-niranjana.vishwanathapura@intel.com>
X-Mailer: git-send-email 2.21.0.rc0.32.g243a4c7e27
In-Reply-To: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
References: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sanjay.k.kumar@intel.com, sudeep.dutt@intel.com,
 dri-devel@lists.freedesktop.org, dave.hansen@intel.com, jglisse@redhat.com,
 jon.bloomfield@intel.com, daniel.vetter@intel.com, dan.j.williams@intel.com,
 ira.weiny@intel.com, jgg@mellanox.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2hhcmVkIFZpcnR1YWwgTWVtb3J5IChTVk0pIHJ1bnRpbWUgYWxsb2NhdG9yIHN1cHBvcnQgYWxs
b3dzCmJpbmRpbmcgYSBzaGFyZWQgdmlydHVhbCBhZGRyZXNzIHRvIGEgYnVmZmVyIG9iamVjdCAo
Qk8pIGluIHRoZQpkZXZpY2UgcGFnZSB0YWJsZSB0aHJvdWdoIGFuIGlvY3RsIGNhbGwuCgpDYzog
Sm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFodGluZW5AbGludXguaW50ZWwuY29tPgpDYzogSm9u
IEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KQ2M6IERhbmllbCBWZXR0ZXIg
PGRhbmllbC52ZXR0ZXJAaW50ZWwuY29tPgpDYzogU3VkZWVwIER1dHQgPHN1ZGVlcC5kdXR0QGlu
dGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTmlyYW5qYW5hIFZpc2h3YW5hdGhhcHVyYSA8bmlyYW5q
YW5hLnZpc2h3YW5hdGhhcHVyYUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
S2NvbmZpZyAgICAgICAgICAgICAgICAgIHwgMTEgKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
TWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgIDMgKwogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgNTggKysrKysrKysrKysrKysrLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N2bS5jICAgICAgIHwgNTEgKysrKysrKysrKysrKysr
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N2bS5oICAgICAgIHwgMjIgKysr
KysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgICAgICAgICAgIHwgMjIg
KysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwg
MjIgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAg
IHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggICAgICAgICAgIHwg
MTMgKysrKysKIDkgZmlsZXMgY2hhbmdlZCwgMTkyIGluc2VydGlvbnMoKyksIDExIGRlbGV0aW9u
cygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9zdm0uYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9zdm0uaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnCmluZGV4IGJhOTU5NTk2MGJiZS4uYzJlNDg3MTBl
ZWM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L0tjb25maWcKQEAgLTEzNyw2ICsxMzcsMTcgQEAgY29uZmlnIERSTV9J
OTE1X0dWVF9LVk1HVAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIGlmIHlvdSB3YW50IHRvIGVuYWJs
ZSBLVk1HVCBzdXBwb3J0IGZvcgogCSAgSW50ZWwgR1ZULWcuCiAKK2NvbmZpZyBEUk1fSTkxNV9T
Vk0KKwlib29sICJFbmFibGUgU2hhcmVkIFZpcnR1YWwgTWVtb3J5IHN1cHBvcnQgaW4gaTkxNSIK
KwlkZXBlbmRzIG9uIFNUQUdJTkcKKwlkZXBlbmRzIG9uIERSTV9JOTE1CisJZGVmYXVsdCBuCisJ
aGVscAorCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIGlmIHlvdSB3YW50IFNoYXJlZCBWaXJ0dWFsIE1l
bW9yeSAoU1ZNKQorCSAgc3VwcG9ydCBpbiBpOTE1LiBXaXRoIFNWTSBzdXBwb3J0LCBvbmUgY2Fu
IHNoYXJlIHRoZSB2aXJ0dWFsCisJICBhZGRyZXNzIHNwYWNlIGJldHdlZW4gYSBwcm9jZXNzIGFu
ZCB0aGUgR1BVLiBTVk0gaXMgc3VwcG9ydGVkCisJICBvbiBib3RoIGludGVncmF0ZWQgYW5kIGRp
c2NyZXRlIEludGVsIEdQVXMuCisKIG1lbnUgImRybS9pOTE1IERlYnVnZ2luZyIKIGRlcGVuZHMg
b24gRFJNX0k5MTUKIGRlcGVuZHMgb24gRVhQRVJUCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGUw
ZmQxMGMwY2ZiOC4uNzVmZTQ1NjMzNzc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtMTUzLDYg
KzE1Myw5IEBAIGk5MTUteSArPSBcCiAJICBpbnRlbF9yZWdpb25fbG1lbS5vIFwKIAkgIGludGVs
X3dvcGNtLm8KIAorIyBTVk0gY29kZQoraTkxNS0kKENPTkZJR19EUk1fSTkxNV9TVk0pICs9IGdl
bS9pOTE1X2dlbV9zdm0ubworCiAjIGdlbmVyYWwtcHVycG9zZSBtaWNyb2NvbnRyb2xsZXIgKEd1
Qykgc3VwcG9ydAogb2JqLXkgKz0gZ3QvdWMvCiBpOTE1LXkgKz0gZ3QvdWMvaW50ZWxfdWMubyBc
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZl
ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRl
eCA3YTg3ZTgyNzA0NjAuLjlkNDNhZTZkNjQzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0yODY0LDEwICsyODY0LDE0IEBAIGludAog
aTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAq
ZGF0YSwKIAkJCSAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2V4ZWNfb2JqZWN0MiAqZXhlYzJfbGlzdCwgKmV4ZWMyX2xpc3RfdXNlcjsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzID0gZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2V4ZWNfb2JqZWN0MiAqZXhlYzJfbGlzdDsKLQlzdHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5j
ZXMgPSBOVUxMOwogCWNvbnN0IHNpemVfdCBjb3VudCA9IGFyZ3MtPmJ1ZmZlcl9jb3VudDsKKwlz
dHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5jZXMgPSBOVUxMOworCXVuc2lnbmVkIGludCBpID0gMCwg
c3ZtX2NvdW50ID0gMDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKwlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X3N2bV9vYmogKnN2bV9vYmo7CiAJ
aW50IGVycjsKIAogCWlmICghY2hlY2tfYnVmZmVyX2NvdW50KGNvdW50KSkgewpAQCAtMjg3OCwx
NSArMjg4Miw0NiBAQCBpOTE1X2dlbV9leGVjYnVmZmVyMl9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmICghaTkxNV9nZW1fY2hlY2tfZXhlY2J1ZmZlcihhcmdz
KSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKKwljdHggPSBpOTE1X2dlbV9jb250ZXh0X2xvb2t1cChm
aWxlLT5kcml2ZXJfcHJpdiwgYXJncy0+cnN2ZDEpOworCWlmICghY3R4IHx8ICFyY3VfYWNjZXNz
X3BvaW50ZXIoY3R4LT52bSkpCisJCXJldHVybiAtRU5PRU5UOworCisJcmN1X3JlYWRfbG9jaygp
OworCXZtID0gaTkxNV92bV9nZXQoY3R4LT52bSk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKK2Fs
bG9jX2FnYWluOgorCXN2bV9jb3VudCA9IHZtLT5zdm1fY291bnQ7CiAJLyogQWxsb2NhdGUgYW4g
ZXh0cmEgc2xvdCBmb3IgdXNlIGJ5IHRoZSBjb21tYW5kIHBhcnNlciAqLwotCWV4ZWMyX2xpc3Qg
PSBrdm1hbGxvY19hcnJheShjb3VudCArIDEsIGViX2VsZW1lbnRfc2l6ZSgpLAorCWV4ZWMyX2xp
c3QgPSBrdm1hbGxvY19hcnJheShjb3VudCArIHN2bV9jb3VudCArIDEsIGViX2VsZW1lbnRfc2l6
ZSgpLAogCQkJCSAgICBfX0dGUF9OT1dBUk4gfCBHRlBfS0VSTkVMKTsKIAlpZiAoZXhlYzJfbGlz
dCA9PSBOVUxMKSB7CiAJCURSTV9ERUJVRygiRmFpbGVkIHRvIGFsbG9jYXRlIGV4ZWMgbGlzdCBm
b3IgJXpkIGJ1ZmZlcnNcbiIsCi0JCQkgIGNvdW50KTsKKwkJCSAgY291bnQgKyBzdm1fY291bnQp
OwogCQlyZXR1cm4gLUVOT01FTTsKIAl9Ci0JaWYgKGNvcHlfZnJvbV91c2VyKGV4ZWMyX2xpc3Qs
CisJbXV0ZXhfbG9jaygmdm0tPm11dGV4KTsKKwlpZiAoc3ZtX2NvdW50ICE9IHZtLT5zdm1fY291
bnQpIHsKKwkJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOworCQlrdmZyZWUoZXhlYzJfbGlzdCk7
CisJCWdvdG8gYWxsb2NfYWdhaW47CisJfQorCisJbGlzdF9mb3JfZWFjaF9lbnRyeShzdm1fb2Jq
LCAmdm0tPnN2bV9saXN0LCBsaW5rKSB7CisJCW1lbXNldCgmZXhlYzJfbGlzdFtpXSwgMCwgc2l6
ZW9mKCpleGVjMl9saXN0KSk7CisJCWV4ZWMyX2xpc3RbaV0uaGFuZGxlID0gc3ZtX29iai0+aGFu
ZGxlOworCQlleGVjMl9saXN0W2ldLm9mZnNldCA9IHN2bV9vYmotPm9mZnNldDsKKwkJZXhlYzJf
bGlzdFtpXS5mbGFncyA9IEVYRUNfT0JKRUNUX1BJTk5FRCB8CisJCQkJICAgICAgRVhFQ19PQkpF
Q1RfU1VQUE9SVFNfNDhCX0FERFJFU1M7CisJCWkrKzsKKwl9CisJZXhlYzJfbGlzdF91c2VyID0g
JmV4ZWMyX2xpc3RbaV07CisJYXJncy0+YnVmZmVyX2NvdW50ICs9IHN2bV9jb3VudDsKKwltdXRl
eF91bmxvY2soJnZtLT5tdXRleCk7CisJaTkxNV92bV9wdXQodm0pOworCWk5MTVfZ2VtX2NvbnRl
eHRfcHV0KGN0eCk7CisKKwlpZiAoY29weV9mcm9tX3VzZXIoZXhlYzJfbGlzdF91c2VyLAogCQkJ
ICAgdTY0X3RvX3VzZXJfcHRyKGFyZ3MtPmJ1ZmZlcnNfcHRyKSwKIAkJCSAgIHNpemVvZigqZXhl
YzJfbGlzdCkgKiBjb3VudCkpIHsKIAkJRFJNX0RFQlVHKCJjb3B5ICV6ZCBleGVjIGVudHJpZXMg
ZmFpbGVkXG4iLCBjb3VudCk7CkBAIC0yOTAzLDYgKzI5MzgsNyBAQCBpOTE1X2dlbV9leGVjYnVm
ZmVyMl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCX0KIAogCWVy
ciA9IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoZGV2LCBmaWxlLCBhcmdzLCBleGVjMl9saXN0LCBm
ZW5jZXMpOworCWFyZ3MtPmJ1ZmZlcl9jb3VudCAtPSBzdm1fY291bnQ7CiAKIAkvKgogCSAqIE5v
dyB0aGF0IHdlIGhhdmUgYmVndW4gZXhlY3V0aW9uIG9mIHRoZSBiYXRjaGJ1ZmZlciwgd2UgaWdu
b3JlCkBAIC0yOTEzLDcgKzI5NDksNiBAQCBpOTE1X2dlbV9leGVjYnVmZmVyMl9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmIChhcmdzLT5mbGFncyAmIF9fRVhF
Q19IQVNfUkVMT0MpIHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgX191c2Vy
ICp1c2VyX2V4ZWNfbGlzdCA9CiAJCQl1NjRfdG9fdXNlcl9wdHIoYXJncy0+YnVmZmVyc19wdHIp
OwotCQl1bnNpZ25lZCBpbnQgaTsKIAogCQkvKiBDb3B5IHRoZSBuZXcgYnVmZmVyIG9mZnNldHMg
YmFjayB0byB0aGUgdXNlcidzIGV4ZWMgbGlzdC4gKi8KIAkJLyoKQEAgLTI5MjcsMTMgKzI5NjIs
MTQgQEAgaTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKIAkJCWdvdG8gZW5kOwogCiAJCWZvciAoaSA9IDA7IGkgPCBhcmdzLT5idWZm
ZXJfY291bnQ7IGkrKykgewotCQkJaWYgKCEoZXhlYzJfbGlzdFtpXS5vZmZzZXQgJiBVUERBVEUp
KQorCQkJdTY0ICpvZmZzZXQgPSAmZXhlYzJfbGlzdF91c2VyW2ldLm9mZnNldDsKKworCQkJaWYg
KCEoKm9mZnNldCAmIFVQREFURSkpCiAJCQkJY29udGludWU7CiAKLQkJCWV4ZWMyX2xpc3RbaV0u
b2Zmc2V0ID0KLQkJCQlnZW44X2Nhbm9uaWNhbF9hZGRyKGV4ZWMyX2xpc3RbaV0ub2Zmc2V0ICYg
UElOX09GRlNFVF9NQVNLKTsKLQkJCXVuc2FmZV9wdXRfdXNlcihleGVjMl9saXN0W2ldLm9mZnNl
dCwKLQkJCQkJJnVzZXJfZXhlY19saXN0W2ldLm9mZnNldCwKKwkJCSpvZmZzZXQgPSBnZW44X2Nh
bm9uaWNhbF9hZGRyKCpvZmZzZXQgJgorCQkJCQkJICAgICAgUElOX09GRlNFVF9NQVNLKTsKKwkJ
CXVuc2FmZV9wdXRfdXNlcigqb2Zmc2V0LCAmdXNlcl9leGVjX2xpc3RbaV0ub2Zmc2V0LAogCQkJ
CQllbmRfdXNlcik7CiAJCX0KIGVuZF91c2VyOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3N2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3N2bS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOTczMDcw
MDU2NzI2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3N2bS5jCkBAIC0wLDAgKzEsNTEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBN
SVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNp
bmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgorCitpbnQgaTkx
NV9nZW1fc3ZtX2JpbmQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCisJCSAgICAgIHN0
cnVjdCBkcm1faTkxNV9iaW5kICphcmdzLAorCQkgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUp
Cit7CisJc3RydWN0IGk5MTVfc3ZtX29iaiAqc3ZtX29iaiwgKnRtcDsKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCWludCByZXQgPSAwOworCisJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2xvb2t1cChmaWxlLCBhcmdzLT5oYW5kbGUpOworCWlmICghb2JqKQorCQlyZXR1cm4gLUVO
T0VOVDsKKworCS8qIEZJWE1FOiBOZWVkIHRvIGhhbmRsZSBjYXNlIHdpdGggdW5lbmRpbmcgYmF0
Y2ggYnVmZmVycyAqLworCWlmICghKGFyZ3MtPmZsYWdzICYgSTkxNV9CSU5EX1VOQklORCkpIHsK
KwkJc3ZtX29iaiA9IGttYWxsb2Moc2l6ZW9mKCpzdm1fb2JqKSwgR0ZQX0tFUk5FTCk7CisJCWlm
ICghc3ZtX29iaikgeworCQkJcmV0ID0gLUVOT01FTTsKKwkJCWdvdG8gcHV0X29iajsKKwkJfQor
CQlzdm1fb2JqLT5oYW5kbGUgPSBhcmdzLT5oYW5kbGU7CisJCXN2bV9vYmotPm9mZnNldCA9IGFy
Z3MtPnN0YXJ0OworCX0KKworCW11dGV4X2xvY2soJnZtLT5tdXRleCk7CisJaWYgKCEoYXJncy0+
ZmxhZ3MgJiBJOTE1X0JJTkRfVU5CSU5EKSkgeworCQlsaXN0X2FkZCgmc3ZtX29iai0+bGluaywg
JnZtLT5zdm1fbGlzdCk7CisJCXZtLT5zdm1fY291bnQrKzsKKwl9IGVsc2UgeworCQlsaXN0X2Zv
cl9lYWNoX2VudHJ5X3NhZmUoc3ZtX29iaiwgdG1wLCAmdm0tPnN2bV9saXN0LCBsaW5rKSB7CisJ
CQlpZiAoc3ZtX29iai0+aGFuZGxlICE9IGFyZ3MtPmhhbmRsZSkKKwkJCQljb250aW51ZTsKKwor
CQkJbGlzdF9kZWxfaW5pdCgmc3ZtX29iai0+bGluayk7CisJCQl2bS0+c3ZtX2NvdW50LS07CisJ
CQlrZnJlZShzdm1fb2JqKTsKKwkJCWJyZWFrOworCQl9CisJfQorCW11dGV4X3VubG9jaygmdm0t
Pm11dGV4KTsKK3B1dF9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBy
ZXQ7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3Zt
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3ZtLmgKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5jMzk0NTQyZGJhNzUKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3ZtLmgKQEAgLTAsMCArMSwy
MiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdo
dCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBfX0k5MTVfR0VNX1NW
TV9ICisjZGVmaW5lIF9fSTkxNV9HRU1fU1ZNX0gKKworI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisK
KyNpZiBkZWZpbmVkKENPTkZJR19EUk1fSTkxNV9TVk0pCitpbnQgaTkxNV9nZW1fc3ZtX2JpbmQo
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCisJCSAgICAgIHN0cnVjdCBkcm1faTkxNV9i
aW5kICphcmdzLAorCQkgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOworI2Vsc2UKK3N0YXRp
YyBpbmxpbmUgaW50IGk5MTVfZ2VtX3N2bV9iaW5kKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLAorCQkJCSAgICBzdHJ1Y3QgZHJtX2k5MTVfYmluZCAqYXJncywKKwkJCQkgICAgc3RydWN0
IGRybV9maWxlICpmaWxlKQoreyByZXR1cm4gLUVOT1RTVVBQOyB9CisjZW5kaWYKKworI2VuZGlm
IC8qIF9fSTkxNV9HRU1fU1ZNX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDRkZWZh
ZGIyNmU3ZS4uOWM1MjVkM2Y2OTRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTYxLDYg
KzYxLDcgQEAKIAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAi
Z2VtL2k5MTVfZ2VtX2lvY3Rscy5oIgorI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9zdm0uaCIKICNp
bmNsdWRlICJndC9pbnRlbF9ndC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCiAjaW5j
bHVkZSAiZ3QvaW50ZWxfcmM2LmgiCkBAIC0yNjg3LDYgKzI2ODgsMjYgQEAgaTkxNV9nZW1fcmVq
ZWN0X3Bpbl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCXJldHVy
biAtRU5PREVWOwogfQogCitzdGF0aWMgaW50IGk5MTVfYmluZF9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkJICAgc3RydWN0IGRybV9maWxlICpmaWxlKQorewor
CXN0cnVjdCBkcm1faTkxNV9iaW5kICphcmdzID0gZGF0YTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bTsKKwlpbnQgcmV0ID0gLUVJTlZBTDsKKworCXZtID0gaTkxNV9nZW1fYWRkcmVz
c19zcGFjZV9sb29rdXAoZmlsZS0+ZHJpdmVyX3ByaXYsIGFyZ3MtPnZtX2lkKTsKKwlpZiAodW5s
aWtlbHkoIXZtKSkKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlzd2l0Y2ggKGFyZ3MtPnR5cGUpIHsK
KwljYXNlIEk5MTVfQklORF9TVk1fR0VNX09CSjoKKwkJcmV0ID0gaTkxNV9nZW1fc3ZtX2JpbmQo
dm0sIGFyZ3MsIGZpbGUpOworCX0KKworCWk5MTVfdm1fcHV0KHZtKTsKKwlyZXR1cm4gcmV0Owor
fQorCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pb2N0bF9kZXNjIGk5MTVfaW9jdGxzW10gPSB7
CiAJRFJNX0lPQ1RMX0RFRl9EUlYoSTkxNV9JTklULCBkcm1fbm9vcCwgRFJNX0FVVEh8RFJNX01B
U1RFUnxEUk1fUk9PVF9PTkxZKSwKIAlEUk1fSU9DVExfREVGX0RSVihJOTE1X0ZMVVNILCBkcm1f
bm9vcCwgRFJNX0FVVEgpLApAQCAtMjc0Niw2ICsyNzY3LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1faW9jdGxfZGVzYyBpOTE1X2lvY3Rsc1tdID0gewogCURSTV9JT0NUTF9ERUZfRFJWKEk5
MTVfUVVFUlksIGk5MTVfcXVlcnlfaW9jdGwsIERSTV9SRU5ERVJfQUxMT1cpLAogCURSTV9JT0NU
TF9ERUZfRFJWKEk5MTVfR0VNX1ZNX0NSRUFURSwgaTkxNV9nZW1fdm1fY3JlYXRlX2lvY3RsLCBE
Uk1fUkVOREVSX0FMTE9XKSwKIAlEUk1fSU9DVExfREVGX0RSVihJOTE1X0dFTV9WTV9ERVNUUk9Z
LCBpOTE1X2dlbV92bV9kZXN0cm95X2lvY3RsLCBEUk1fUkVOREVSX0FMTE9XKSwKKwlEUk1fSU9D
VExfREVGX0RSVihJOTE1X0JJTkQsIGk5MTVfYmluZF9pb2N0bCwgRFJNX1JFTkRFUl9BTExPVyks
CiB9OwogCiBzdGF0aWMgc3RydWN0IGRybV9kcml2ZXIgZHJpdmVyID0gewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmgKaW5kZXggYmJmNGRmZGZhOGJhLi5mNzA1MWU2ZGY2NTYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaApAQCAtMTkxMSw2ICsxOTExLDI4IEBAIGk5MTVfZ2VtX2NvbnRleHRfbG9va3Vw
KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwgdTMyIGlkKQogCXJldHVy
biBjdHg7CiB9CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCitf
X2k5MTVfZ2VtX2FkZHJlc3Nfc3BhY2VfbG9va3VwX3JjdShzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmaWxlX3ByaXYsCisJCQkJICAgIHUzMiBpZCkKK3sKKwlyZXR1cm4gaWRyX2ZpbmQo
JmZpbGVfcHJpdi0+dm1faWRyLCBpZCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqCitpOTE1X2dlbV9hZGRyZXNzX3NwYWNlX2xvb2t1cChzdHJ1Y3QgZHJt
X2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCisJCQkgICAgICB1MzIgaWQpCit7CisJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJdm0gPSBf
X2k5MTVfZ2VtX2FkZHJlc3Nfc3BhY2VfbG9va3VwX3JjdShmaWxlX3ByaXYsIGlkKTsKKwlpZiAo
dm0pCisJCXZtID0gaTkxNV92bV9nZXQodm0pOworCXJjdV9yZWFkX3VubG9jaygpOworCisJcmV0
dXJuIHZtOworfQorCiAvKiBpOTE1X2dlbV9ldmljdC5jICovCiBpbnQgX19tdXN0X2NoZWNrIGk5
MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJ
CQkJICB1NjQgbWluX3NpemUsIHU2NCBhbGlnbm1lbnQsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCmluZGV4IDYyMzlhOWFkYmYxNC4uNDRmZjQwNzRkYjEyIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYwpAQCAtNTc0LDYgKzU3NCw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfYWRk
cmVzc19zcGFjZV9pbml0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCBpbnQgc3ViY2xh
c3MpCiAJc3Rhc2hfaW5pdCgmdm0tPmZyZWVfcGFnZXMpOwogCiAJSU5JVF9MSVNUX0hFQUQoJnZt
LT5ib3VuZF9saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmdm0tPnN2bV9saXN0KTsKIH0KIAogc3Rh
dGljIGludCBfX3NldHVwX3BhZ2VfZG1hKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCA0MDIyODNjZTI4NjQuLmQ2MThhNTc4
N2M2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTI4NSw2ICsyODUsMTMg
QEAgc3RydWN0IHBhZ2VzdGFzaCB7CiAJc3RydWN0IHBhZ2V2ZWMgcHZlYzsKIH07CiAKK3N0cnVj
dCBpOTE1X3N2bV9vYmogeworCS8qKiBUaGlzIG9iaidzIHBsYWNlIGluIHRoZSBTVk0gb2JqZWN0
IGxpc3QgKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7CisJdTMyIGhhbmRsZTsKKwl1NjQgb2Zm
c2V0OworfTsKKwogc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSB7CiAJc3RydWN0IGtyZWYgcmVm
OwogCXN0cnVjdCByY3Vfd29yayByY3U7CkBAIC0zMjksNiArMzM2LDEyIEBAIHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgewogCSAqLwogCXN0cnVjdCBsaXN0X2hlYWQgYm91bmRfbGlzdDsKIAor
CS8qKgorCSAqIExpc3Qgb2YgU1ZNIGJpbmQgb2JqZWN0cy4KKwkgKi8KKwlzdHJ1Y3QgbGlzdF9o
ZWFkIHN2bV9saXN0OworCXVuc2lnbmVkIGludCBzdm1fY291bnQ7CisKIAlzdHJ1Y3QgcGFnZXN0
YXNoIGZyZWVfcGFnZXM7CiAKIAkvKiBHbG9iYWwgR1RUICovCi0tIAoyLjIxLjAucmMwLjMyLmcy
NDNhNGM3ZTI3CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
