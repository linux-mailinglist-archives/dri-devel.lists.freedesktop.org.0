Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A332136FCE9
	for <lists+dri-devel@lfdr.de>; Fri, 30 Apr 2021 16:54:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EF2C06F548;
	Fri, 30 Apr 2021 14:54:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qk1-x736.google.com (mail-qk1-x736.google.com
 [IPv6:2607:f8b0:4864:20::736])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2793B6F548
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 14:54:11 +0000 (UTC)
Received: by mail-qk1-x736.google.com with SMTP id 8so37162826qkv.8
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 07:54:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=nFlqlJeIefCj0kvpsi1XJKZZvP6Mkr+vMsYlK4d7on4=;
 b=gSICsA3t/f1QRgF0vuJUBwYAY7vFTRsotBLibRu9PkgLasmvMGDGGSTiQ7tsxTJDxK
 yxGVVqDpSdyrF4k1k5mn+q9ex4UEvxzcZIF5fqhTrkAAtw1t4qEKVDhHOAuytlSfqbuq
 qlY9RhkXx7PKKX3ZJB8D6J6+iCoE1lx/14IAtFn7AKlJkdUOKdUV3BFdTcHnO1S59j6H
 DIMaylBqrfIXH+PZEsgXp6cY+bwqAsEimUR4duDC5U/5FAejqEeo78YE6vBOrSCIyLTU
 rfviCD58pL+yVajw7IOiWUdW7tKyZwKn++v/udGcp1zynEoDrEJp9ovwJ3YA8vPuQQXE
 Yn5g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=nFlqlJeIefCj0kvpsi1XJKZZvP6Mkr+vMsYlK4d7on4=;
 b=IOfiQRJP6E1wfpqN6vPTZ1lsIDzR2oEUG2VtpyQWTbKrhDjV30fZsDalYhqx/+TivP
 wMa2CN+7PpF7ALl51K0fxQ4GZOJgWLp/Bbslq6KepHxD+1K3lUweUB2y4wVtmzyy4fjq
 sIB/KjXD1xoqP/Iaja/vsntBexY6kggzbfvLcoiKYTQIE0pxaqpkUdW8tpAA9Ko6PopY
 /vRbr2vyNNZcMWIRNgy+q3BLxy030bICdfvdi+kIStqNFG7eG72oZEetQitGmXkR9PDh
 Ye3ISwrVBL+c4rVMES424YHhWCi+zwDpgrsSc+p8wZ5KdYDdsl2jB8E17jBOv4KEs6J0
 GnOw==
X-Gm-Message-State: AOAM532k1GN1CtdQrqgDYU6poDfIYkhTEJm2cpqAr4AaS6O+a7cEUz4q
 U5c0thGMObnI4riFFxaXc+SaYmEX9Lu3IVPJaeE=
X-Google-Smtp-Source: ABdhPJxL87IH9eLFffSdSouOpTb4vW0OrcocLLm+wG776435i4D79ZsNPCzNWn6WpRd7yoYmcHnhcS7uacn91fwP4us=
X-Received: by 2002:a37:9903:: with SMTP id b3mr5809385qke.17.1619794450296;
 Fri, 30 Apr 2021 07:54:10 -0700 (PDT)
MIME-Version: 1.0
References: <20210430092508.60710-1-christian.koenig@amd.com>
 <20210430092508.60710-10-christian.koenig@amd.com>
In-Reply-To: <20210430092508.60710-10-christian.koenig@amd.com>
From: Matthew Auld <matthew.william.auld@gmail.com>
Date: Fri, 30 Apr 2021 15:53:43 +0100
Message-ID: <CAM0jSHNGHiELoGBEtVGqN=2acfLLfRJrnBRtKgNFPhAxUyvzmQ@mail.gmail.com>
Subject: Re: [PATCH 10/13] drm/amdgpu: switch the VRAM backend to self alloc
To: =?UTF-8?Q?Christian_K=C3=B6nig?= <ckoenig.leichtzumerken@gmail.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 ML dri-devel <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gRnJpLCAzMCBBcHIgMjAyMSBhdCAxMDoyNSwgQ2hyaXN0aWFuIEvDtm5pZwo8Y2tvZW5pZy5s
ZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+IHdyb3RlOgo+Cj4gU2ltaWxhciB0byB0aGUgVFRNIHJh
bmdlIG1hbmFnZXIuCj4KPiBTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3Rp
YW4ua29lbmlnQGFtZC5jb20+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV92cmFtX21nci5jIHwgNTEgKysrKysrKysrKysrLS0tLS0tLS0KPiAgMSBmaWxlIGNoYW5n
ZWQsIDMwIGluc2VydGlvbnMoKyksIDIxIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92cmFtX21nci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZyYW1fbWdyLmMKPiBpbmRleCBiYjAxZTBmYzYyMWMuLmQ1
OWVjMDdjNzdiYiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdnJhbV9tZ3IuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92
cmFtX21nci5jCj4gQEAgLTIzLDYgKzIzLDggQEAKPiAgICovCj4KPiAgI2luY2x1ZGUgPGxpbnV4
L2RtYS1tYXBwaW5nLmg+Cj4gKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9yYW5nZV9tYW5hZ2VyLmg+
Cj4gKwo+ICAjaW5jbHVkZSAiYW1kZ3B1LmgiCj4gICNpbmNsdWRlICJhbWRncHVfdm0uaCIKPiAg
I2luY2x1ZGUgImFtZGdwdV9yZXNfY3Vyc29yLmgiCj4gQEAgLTM2Nyw5ICszNjksOSBAQCBzdGF0
aWMgaW50IGFtZGdwdV92cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICpt
YW4sCj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X3ZyYW1fbWdyICptZ3IgPSB0b192cmFtX21nciht
YW4pOwo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSB0b19hbWRncHVfZGV2
aWNlKG1ncik7Cj4gICAgICAgICB1aW50NjRfdCB2aXNfdXNhZ2UgPSAwLCBtZW1fYnl0ZXMsIG1h
eF9ieXRlczsKPiArICAgICAgIHN0cnVjdCB0dG1fcmFuZ2VfbWdyX25vZGUgKm5vZGU7Cj4gICAg
ICAgICBzdHJ1Y3QgZHJtX21tICptbSA9ICZtZ3ItPm1tOwo+ICAgICAgICAgZW51bSBkcm1fbW1f
aW5zZXJ0X21vZGUgbW9kZTsKPiAtICAgICAgIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZXM7Cj4g
ICAgICAgICB1bnNpZ25lZCBpOwo+ICAgICAgICAgaW50IHI7Cj4KPiBAQCAtMzg0LDggKzM4Niw4
IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZyYW1fbWdyX25ldyhzdHJ1Y3QgdHRtX3Jlc291cmNlX21h
bmFnZXIgKm1hbiwKPiAgICAgICAgIC8qIGJhaWwgb3V0IHF1aWNrbHkgaWYgdGhlcmUncyBsaWtl
bHkgbm90IGVub3VnaCBWUkFNIGZvciB0aGlzIEJPICovCj4gICAgICAgICBtZW1fYnl0ZXMgPSAo
dTY0KW1lbS0+bnVtX3BhZ2VzIDw8IFBBR0VfU0hJRlQ7Cj4gICAgICAgICBpZiAoYXRvbWljNjRf
YWRkX3JldHVybihtZW1fYnl0ZXMsICZtZ3ItPnVzYWdlKSA+IG1heF9ieXRlcykgewo+IC0gICAg
ICAgICAgICAgICBhdG9taWM2NF9zdWIobWVtX2J5dGVzLCAmbWdyLT51c2FnZSk7Cj4gLSAgICAg
ICAgICAgICAgIHJldHVybiAtRU5PU1BDOwo+ICsgICAgICAgICAgICAgICByID0gLUVOT1NQQzsK
PiArICAgICAgICAgICAgICAgZ290byBlcnJvcl9zdWI7Cj4gICAgICAgICB9Cj4KPiAgICAgICAg
IGlmIChwbGFjZS0+ZmxhZ3MgJiBUVE1fUExfRkxBR19DT05USUdVT1VTKSB7Cj4gQEAgLTQwMywx
MyArNDA1LDE1IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3ZyYW1fbWdyX25ldyhzdHJ1Y3QgdHRtX3Jl
c291cmNlX21hbmFnZXIgKm1hbiwKPiAgICAgICAgICAgICAgICAgbnVtX25vZGVzID0gRElWX1JP
VU5EX1VQKG1lbS0+bnVtX3BhZ2VzLCBwYWdlc19wZXJfbm9kZSk7Cj4gICAgICAgICB9Cj4KPiAt
ICAgICAgIG5vZGVzID0ga3ZtYWxsb2NfYXJyYXkoKHVpbnQzMl90KW51bV9ub2Rlcywgc2l6ZW9m
KCpub2RlcyksCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdGUF9LRVJORUwgfCBf
X0dGUF9aRVJPKTsKPiAtICAgICAgIGlmICghbm9kZXMpIHsKPiAtICAgICAgICAgICAgICAgYXRv
bWljNjRfc3ViKG1lbV9ieXRlcywgJm1nci0+dXNhZ2UpOwo+IC0gICAgICAgICAgICAgICByZXR1
cm4gLUVOT01FTTsKPiArICAgICAgIG5vZGUgPSBrdm1hbGxvYyhzdHJ1Y3Rfc2l6ZShub2RlLCBt
bV9ub2RlcywgbnVtX25vZGVzKSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgIEdGUF9LRVJO
RUwgfCBfX0dGUF9aRVJPKTsKCkFsaWdubWVudC4KCj4gKyAgICAgICBpZiAoIW5vZGUpIHsKPiAr
ICAgICAgICAgICAgICAgciA9IC1FTk9NRU07Cj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyb3Jf
c3ViOwo+ICAgICAgICAgfQo+Cj4gKyAgICAgICB0dG1fcmVzb3VyY2VfaW5pdCh0Ym8sIHBsYWNl
LCAmbm9kZS0+YmFzZSk7Cj4gKwo+ICAgICAgICAgbW9kZSA9IERSTV9NTV9JTlNFUlRfQkVTVDsK
PiAgICAgICAgIGlmIChwbGFjZS0+ZmxhZ3MgJiBUVE1fUExfRkxBR19UT1BET1dOKQo+ICAgICAg
ICAgICAgICAgICBtb2RlID0gRFJNX01NX0lOU0VSVF9ISUdIOwo+IEBAIC00MjgsOCArNDMyLDkg
QEAgc3RhdGljIGludCBhbWRncHVfdnJhbV9tZ3JfbmV3KHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFu
YWdlciAqbWFuLAo+ICAgICAgICAgICAgICAgICBpZiAocGFnZXMgPj0gcGFnZXNfcGVyX25vZGUp
Cj4gICAgICAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50ID0gcGFnZXNfcGVyX25vZGU7Cj4K
PiAtICAgICAgICAgICAgICAgciA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZShtbSwgJm5v
ZGVzW2ldLCBwYWdlcywgYWxpZ25tZW50LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIDAsIHBsYWNlLT5mcGZuLCBscGZuLCBtb2RlKTsKPiArICAgICAg
ICAgICAgICAgciA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZShtbSwgJm5vZGUtPm1tX25v
ZGVzW2ldLCBwYWdlcywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBhbGlnbm1lbnQsIDAsIHBsYWNlLT5mcGZuLAo+ICsgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxwZm4sIG1vZGUpOwo+ICAgICAgICAgICAgICAg
ICBpZiAodW5saWtlbHkocikpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFnZXMg
PiBwYWdlc19wZXJfbm9kZSkgewo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg
KGlzX3Bvd2VyX29mXzIocGFnZXMpKQo+IEBAIC00MzgsMTEgKzQ0MywxMSBAQCBzdGF0aWMgaW50
IGFtZGdwdV92cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VzID0gcm91bmRkb3du
X3Bvd19vZl90d28ocGFnZXMpOwo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u
dGludWU7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgfQo+IC0gICAgICAgICAgICAgICAgICAg
ICAgIGdvdG8gZXJyb3I7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgZ290byBlcnJvcl9mcmVl
Owo+ICAgICAgICAgICAgICAgICB9Cj4KPiAtICAgICAgICAgICAgICAgdmlzX3VzYWdlICs9IGFt
ZGdwdV92cmFtX21ncl92aXNfc2l6ZShhZGV2LCAmbm9kZXNbaV0pOwo+IC0gICAgICAgICAgICAg
ICBhbWRncHVfdnJhbV9tZ3JfdmlydF9zdGFydChtZW0sICZub2Rlc1tpXSk7Cj4gKyAgICAgICAg
ICAgICAgIHZpc191c2FnZSArPSBhbWRncHVfdnJhbV9tZ3JfdmlzX3NpemUoYWRldiwgJm5vZGUt
Pm1tX25vZGVzW2ldKTsKPiArICAgICAgICAgICAgICAgYW1kZ3B1X3ZyYW1fbWdyX3ZpcnRfc3Rh
cnQobWVtLCAmbm9kZS0+bW1fbm9kZXNbaV0pOwo+ICAgICAgICAgICAgICAgICBwYWdlc19sZWZ0
IC09IHBhZ2VzOwo+ICAgICAgICAgICAgICAgICArK2k7Cj4KPiBAQCAtNDU1LDE2ICs0NjAsMTcg
QEAgc3RhdGljIGludCBhbWRncHVfdnJhbV9tZ3JfbmV3KHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFu
YWdlciAqbWFuLAo+ICAgICAgICAgICAgICAgICBtZW0tPnBsYWNlbWVudCB8PSBUVE1fUExfRkxB
R19DT05USUdVT1VTOwo+Cj4gICAgICAgICBhdG9taWM2NF9hZGQodmlzX3VzYWdlLCAmbWdyLT52
aXNfdXNhZ2UpOwo+IC0gICAgICAgbWVtLT5tbV9ub2RlID0gbm9kZXM7Cj4gKyAgICAgICBtZW0t
Pm1tX25vZGUgPSAmbm9kZS0+bW1fbm9kZXNbMF07Cj4gICAgICAgICByZXR1cm4gMDsKPgo+IC1l
cnJvcjoKPiArZXJyb3JfZnJlZToKPiAgICAgICAgIHdoaWxlIChpLS0pCj4gLSAgICAgICAgICAg
ICAgIGRybV9tbV9yZW1vdmVfbm9kZSgmbm9kZXNbaV0pOwo+ICsgICAgICAgICAgICAgICBkcm1f
bW1fcmVtb3ZlX25vZGUoJm5vZGUtPm1tX25vZGVzW2ldKTsKPiAgICAgICAgIHNwaW5fdW5sb2Nr
KCZtZ3ItPmxvY2spOwo+IC0gICAgICAgYXRvbWljNjRfc3ViKG1lbS0+bnVtX3BhZ2VzIDw8IFBB
R0VfU0hJRlQsICZtZ3ItPnVzYWdlKTsKPiArICAgICAgIGt2ZnJlZShub2RlKTsKPgo+IC0gICAg
ICAga3ZmcmVlKG5vZGVzKTsKPiArZXJyb3Jfc3ViOgo+ICsgICAgICAgYXRvbWljNjRfc3ViKG1l
bV9ieXRlcywgJm1nci0+dXNhZ2UpOwo+ICAgICAgICAgcmV0dXJuIHI7Cj4gIH0KPgo+IEBAIC00
ODEsMTMgKzQ4NywxNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdnJhbV9tZ3JfZGVsKHN0cnVjdCB0
dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuLAo+ICB7Cj4gICAgICAgICBzdHJ1Y3QgYW1kZ3B1X3Zy
YW1fbWdyICptZ3IgPSB0b192cmFtX21ncihtYW4pOwo+ICAgICAgICAgc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYgPSB0b19hbWRncHVfZGV2aWNlKG1ncik7Cj4gLSAgICAgICBzdHJ1Y3QgZHJt
X21tX25vZGUgKm5vZGVzID0gbWVtLT5tbV9ub2RlOwo+ICsgICAgICAgc3RydWN0IHR0bV9yYW5n
ZV9tZ3Jfbm9kZSAqbm9kZTsKPiAgICAgICAgIHVpbnQ2NF90IHVzYWdlID0gMCwgdmlzX3VzYWdl
ID0gMDsKPiAgICAgICAgIHVuc2lnbmVkIHBhZ2VzID0gbWVtLT5udW1fcGFnZXM7Cj4gKyAgICAg
ICBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGVzOwo+Cj4gICAgICAgICBpZiAoIW1lbS0+bW1fbm9k
ZSkKPiAgICAgICAgICAgICAgICAgcmV0dXJuOwo+Cj4gKyAgICAgICBub2RlID0gdG9fdHRtX3Jh
bmdlX21ncl9ub2RlKG1lbSk7Cj4gKyAgICAgICBub2RlcyA9ICZub2RlLT5tbV9ub2Rlc1swXTsK
PiArCj4gICAgICAgICBzcGluX2xvY2soJm1nci0+bG9jayk7Cj4gICAgICAgICB3aGlsZSAocGFn
ZXMpIHsKPiAgICAgICAgICAgICAgICAgcGFnZXMgLT0gbm9kZXMtPnNpemU7Cj4gQEAgLTUwMiw4
ICs1MTIsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdnJhbV9tZ3JfZGVsKHN0cnVjdCB0dG1fcmVz
b3VyY2VfbWFuYWdlciAqbWFuLAo+ICAgICAgICAgYXRvbWljNjRfc3ViKHVzYWdlLCAmbWdyLT51
c2FnZSk7Cj4gICAgICAgICBhdG9taWM2NF9zdWIodmlzX3VzYWdlLCAmbWdyLT52aXNfdXNhZ2Up
Owo+Cj4gLSAgICAgICBrdmZyZWUobWVtLT5tbV9ub2RlKTsKPiAtICAgICAgIG1lbS0+bW1fbm9k
ZSA9IE5VTEw7CgpOb3Qgd29ydGgga2VlcGluZyB0aGUgbW1fbm9kZSA9IE5VTEw/CgpSZXZpZXdl
ZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgoKCj4gKyAgICAgICBr
dmZyZWUobm9kZSk7Cj4gIH0KPgo+ICAvKioKPiAtLQo+IDIuMjUuMQo+Cl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
