Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5BD329C6CF
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 02:21:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DA59C6E165;
	Mon, 26 Aug 2019 00:20:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay6-d.mail.gandi.net (relay6-d.mail.gandi.net
 [217.70.183.198])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 745F86E0FE
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Aug 2019 13:51:03 +0000 (UTC)
X-Originating-IP: 87.18.63.98
Received: from uno.homenet.telecomitalia.it (unknown [87.18.63.98])
 (Authenticated sender: jacopo@jmondi.org)
 by relay6-d.mail.gandi.net (Postfix) with ESMTPSA id DEEF2C0005;
 Sun, 25 Aug 2019 13:50:58 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli@fpond.eu, airlied@linux.ie,
 daniel@ffwll.ch
Subject: [PATCH v3 08/14] drm: rcar-du: Add support for CMM
Date: Sun, 25 Aug 2019 15:51:48 +0200
Message-Id: <20190825135154.11488-9-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190825135154.11488-1-jacopo+renesas@jmondi.org>
References: <20190825135154.11488-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 26 Aug 2019 00:18:56 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: muroya@ksk.co.jp, koji.matsuoka.xm@renesas.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-renesas-soc@vger.kernel.org, VenkataRajesh.Kalakodima@in.bosch.com,
 Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Harsha.ManjulaMallikarjun@in.bosch.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGEgZHJpdmVyIGZvciB0aGUgUi1DYXIgRGlzcGxheSBVbml0IENvbG9yIENvcnJlY3Rpb24g
TW9kdWxlLgoKSW4gbW9zdCBvZiBHZW4zIFNvQ3MsIGVhY2ggRFUgb3V0cHV0IGNoYW5uZWwgaXMg
cHJvdmlkZWQgd2l0aCBhIENNTSB1bml0CnRvIHBlcmZvcm0gaW1hZ2UgZW5oYW5jZW1lbnQgYW5k
IGNvbG9yIGNvcnJlY3Rpb24uCgpBZGQgc3VwcG9ydCBmb3IgQ01NIHRocm91Z2ggYSBkcml2ZXIg
dGhhdCBzdXBwb3J0cyBjb25maWd1cmF0aW9uIG9mCnRoZSAxLWRpbWVuc2lvbmFsIExVVCB0YWJs
ZS4gTW9yZSBhZHZhbmNlZCBDTU0gZmVhdHVyZSB3aWxsIGJlCmltcGxlbWVudGVkIG9uIHRvcCBv
ZiB0aGlzIGJhc2ljIG9uZS4KClNpZ25lZC1vZmYtYnk6IEphY29wbyBNb25kaSA8amFjb3BvK3Jl
bmVzYXNAam1vbmRpLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9LY29uZmlnICAg
IHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlICAgfCAgIDEgKwogZHJp
dmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYyB8IDI2MiArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaCB8ICAzOCArKysr
KwogNCBmaWxlcyBjaGFuZ2VkLCAzMDggaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfY21tLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2NtbS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3JjYXItZHUvS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L0tjb25maWcK
aW5kZXggMTUyOTg0OWUyMTdlLi41MzlkMjMyNzkwZDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvS2NvbmZp
ZwpAQCAtMTMsNiArMTMsMTMgQEAgY29uZmlnIERSTV9SQ0FSX0RVCiAJICBDaG9vc2UgdGhpcyBv
cHRpb24gaWYgeW91IGhhdmUgYW4gUi1DYXIgY2hpcHNldC4KIAkgIElmIE0gaXMgc2VsZWN0ZWQg
dGhlIG1vZHVsZSB3aWxsIGJlIGNhbGxlZCByY2FyLWR1LWRybS4KCitjb25maWcgRFJNX1JDQVJf
Q01NCisJYm9vbCAiUi1DYXIgRFUgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUgKENNTSkgU3VwcG9y
dCIKKwlkZXBlbmRzIG9uIERSTSAmJiBPRgorCWRlcGVuZHMgb24gRFJNX1JDQVJfRFUKKwloZWxw
CisJICBFbmFibGUgc3VwcG9ydCBmb3IgUi1DYXIgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUgKENN
TSkuCisKIGNvbmZpZyBEUk1fUkNBUl9EV19IRE1JCiAJdHJpc3RhdGUgIlItQ2FyIERVIEdlbjMg
SERNSSBFbmNvZGVyIFN1cHBvcnQiCiAJZGVwZW5kcyBvbiBEUk0gJiYgT0YKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL3JjYXIt
ZHUvTWFrZWZpbGUKaW5kZXggNmMyZWQ5YzQ2NDY3Li40ZDExODdjY2MzZTUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9y
Y2FyLWR1L01ha2VmaWxlCkBAIC0xNSw2ICsxNSw3IEBAIHJjYXItZHUtZHJtLSQoQ09ORklHX0RS
TV9SQ0FSX0xWRFMpCSs9IHJjYXJfZHVfb2YubyBcCiByY2FyLWR1LWRybS0kKENPTkZJR19EUk1f
UkNBUl9WU1ApCSs9IHJjYXJfZHVfdnNwLm8KIHJjYXItZHUtZHJtLSQoQ09ORklHX0RSTV9SQ0FS
X1dSSVRFQkFDSykgKz0gcmNhcl9kdV93cml0ZWJhY2subwoKK29iai0kKENPTkZJR19EUk1fUkNB
Ul9DTU0pCQkrPSByY2FyX2NtbS5vCiBvYmotJChDT05GSUdfRFJNX1JDQVJfRFUpCQkrPSByY2Fy
LWR1LWRybS5vCiBvYmotJChDT05GSUdfRFJNX1JDQVJfRFdfSERNSSkJCSs9IHJjYXJfZHdfaGRt
aS5vCiBvYmotJChDT05GSUdfRFJNX1JDQVJfTFZEUykJCSs9IHJjYXJfbHZkcy5vCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2NtbS5jIGIvZHJpdmVycy9ncHUvZHJt
L3JjYXItZHUvcmNhcl9jbW0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLjU1MzYxZjU3MDFlOAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L3JjYXJfY21tLmMKQEAgLTAsMCArMSwyNjIgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBHUEwtMi4wKworLyoKKyAqIHJjYXJfY21tLmMgLS0gUi1DYXIgRGlzcGxheSBVbml0IENv
bG9yIE1hbmFnZW1lbnQgTW9kdWxlCisgKgorICogQ29weXJpZ2h0IChDKSAyMDE5IEphY29wbyBN
b25kaSA8amFjb3BvK3JlbmVzYXNAam1vbmRpLm9yZz4KKyAqLworCisjaW5jbHVkZSA8bGludXgv
aW8uaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgor
I2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3BtX3J1
bnRpbWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fY29sb3JfbWdtdC5oPgorCisjaW5jbHVkZSAi
cmNhcl9jbW0uaCIKKworI2RlZmluZSBDTTJfTFVUX0NUUkwJCTB4MDAwMAorI2RlZmluZSBDTTJf
TFVUX0NUUkxfTFVUX0VOCUJJVCgwKQorI2RlZmluZSBDTTJfTFVUX1RCTF9CQVNFCTB4MDYwMAor
I2RlZmluZSBDTTJfTFVUX1RCTChfX2kpCShDTTJfTFVUX1RCTF9CQVNFICsgKF9faSkgKiA0KQor
CitzdHJ1Y3QgcmNhcl9jbW0geworCXZvaWQgX19pb21lbSAqYmFzZTsKKwlib29sIGVuYWJsZWQ7
CisKKwkvKgorCSAqIEBsdXQ6CQkxRC1MVVQgc3RhdHVzCisJICogQGx1dC5lbmFibGVkOgkxRC1M
VVQgZW5hYmxlZCBmbGFnCisJICogQGx1dC5zaXplOgkJTnVtYmVyIG9mIGVudHJpZXMgaW4gdGhl
IExVVCB0YWJsZQorCSAqIEBsdXQudGFibGU6CQlUYWJsZSBvZiAxRC1MVVQgZW50cmllcyBzY2Fs
ZWQgdG8gSFcgc3VwcG9ydAorCSAqCQkJcHJlY2lzaW9uICg4LWJpdHMgcGVyIGNvbG9yIGNvbXBv
bmVudCkKKwkgKi8KKwlzdHJ1Y3QgeworCQlib29sIGVuYWJsZWQ7CisJCXVuc2lnbmVkIGludCBz
aXplOworCQl1MzIgdGFibGVbQ01NX0dBTU1BX0xVVF9TSVpFXTsKKwl9IGx1dDsKK307CisKK3N0
YXRpYyBpbmxpbmUgaW50IHJjYXJfY21tX3JlYWQoc3RydWN0IHJjYXJfY21tICpyY21tLCB1MzIg
cmVnKQoreworCXJldHVybiBpb3JlYWQzMihyY21tLT5iYXNlICsgcmVnKTsKK30KKworc3RhdGlj
IGlubGluZSB2b2lkIHJjYXJfY21tX3dyaXRlKHN0cnVjdCByY2FyX2NtbSAqcmNtbSwgdTMyIHJl
ZywgdTMyIGRhdGEpCit7CisJaW93cml0ZTMyKGRhdGEsIHJjbW0tPmJhc2UgKyByZWcpOworfQor
CisvKgorICogcmNhcl9jbW1fbHV0X2V4dHJhY3QoKSAtIFNjYWxlIGRvd24gdG8gaHcgcHJlY2lz
aW9uIHRoZSBEUk0gTFVUIHRhYmxlCisgKgkJCSAgICBlbnRyaWVzIGFuZCBzdG9yZSB0aGVtLgor
ICogQHJjbW06IFBvaW50ZXIgdG8gdGhlIENNTSBkZXZpY2UKKyAqIEBzaXplOiBOdW1iZXIgb2Yg
ZW50cmllcyBpbiB0aGUgdGFibGUKKyAqIEBkcm1fbHV0OiBEUk0gTFVUIHRhYmxlCisgKi8KK3N0
YXRpYyB2b2lkIHJjYXJfY21tX2x1dF9leHRyYWN0KHN0cnVjdCByY2FyX2NtbSAqcmNtbSwgc2l6
ZV90IHNpemUsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpkcm1fbHV0KQorewor
CXVuc2lnbmVkIGludCBpOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7ICsraSkgeworCQljb25z
dCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gJmRybV9sdXRbaV07CisKKwkJcmNtbS0+bHV0
LnRhYmxlW2ldID0gZHJtX2NvbG9yX2x1dF9leHRyYWN0KGx1dC0+cmVkLCA4KSA8PCAxNgorCQkJ
CSAgIHwgZHJtX2NvbG9yX2x1dF9leHRyYWN0KGx1dC0+Z3JlZW4sIDgpIDw8IDgKKwkJCQkgICB8
IGRybV9jb2xvcl9sdXRfZXh0cmFjdChsdXQtPmJsdWUsIDgpOworCX0KKworCXJjbW0tPmx1dC5z
aXplID0gc2l6ZTsKK30KKworLyoKKyAqIHJjYXJfY21tX2x1dF9sb2FkKCkgLSBXcml0ZSB0byBo
dyB0aGUgTFVUIHRhYmxlIGVudHJpZXMgZnJvbSB0aGUgbG9jYWwgdGFibGUuCisgKgorICogQHJj
bW06IFBvaW50ZXIgdG8gdGhlIENNTSBkZXZpY2UKKyAqLworc3RhdGljIHZvaWQgcmNhcl9jbW1f
bHV0X2xvYWQoc3RydWN0IHJjYXJfY21tICpyY21tKQoreworCXVuc2lnbmVkIGludCBpOworCisJ
Zm9yIChpID0gMDsgaSA8IHJjbW0tPmx1dC5zaXplOyArK2kpIHsKKwkJdTMyIGVudHJ5ID0gcmNt
bS0+bHV0LnRhYmxlW2ldOworCisJCXJjYXJfY21tX3dyaXRlKHJjbW0sIENNMl9MVVRfVEJMKGkp
LCBlbnRyeSk7CisJfQorfQorCisvKioKKyAqIHJjYXJfY21tX3NldHVwKCkgLSBjb25maWd1cmUg
dGhlIENNTSB1bml0CisgKgorICogQHBkZXY6IFRoZSBwbGF0Zm9ybSBkZXZpY2UgYXNzb2NpYXRl
ZCB3aXRoIHRoZSBDTU0gaW5zdGFuY2UKKyAqIEBjb25maWc6IFRoZSBDUlRDLXByb3ZpZGVkIGNv
bmZpZ3VyYXRpb24uCisgKgorICogQ29uZmlndXJlIHRoZSBDTU0gdW5pdCB3aXRoIHRoZSBDUlRD
LXByb3ZpZGVkIGNvbmZpZ3VyYXRpb24uCisgKiBDdXJyZW50bHkgZW5hYmxpbmcsIGRpc2FibGlu
ZyBhbmQgcHJvZ3JhbW1pbmcgb2YgdGhlIDEtRCBMVVQgdW5pdCBpcworICogc3VwcG9ydGVkLgor
ICovCitpbnQgcmNhcl9jbW1fc2V0dXAoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKKwkJ
ICAgY29uc3Qgc3RydWN0IHJjYXJfY21tX2NvbmZpZyAqY29uZmlnKQoreworCXN0cnVjdCByY2Fy
X2NtbSAqcmNtbSA9IHBsYXRmb3JtX2dldF9kcnZkYXRhKHBkZXYpOworCisJaWYgKGNvbmZpZy0+
bHV0LnNpemUgPiBDTU1fR0FNTUFfTFVUX1NJWkUpCisJCXJldHVybiAtRUlOVkFMOworCisJLyoK
KwkgKiBBcyByY2FyX2NtbV9zZXR1cCgpIGlzIGNhbGxlZCBieSBhdG9taWMgY29tbWl0IHRhaWwg
aGVscGVyLCBpdCBtaWdodAorCSAqIGJlIGNhbGxlZCB3aGVuIHRoZSBDTU0gaXMgZGlzYWJsZWQu
IEFzIHdlIGNhbid0IHByb2dyYW0gdGhlIGhhcmR3YXJlCisJICogaW4gdGhhdCBjYXNlLCBzdG9y
ZSB0aGUgY29uZmlndXJhdGlvbiBpbnRlcm5hbGx5IGFuZCBhcHBseSBpdCB3aGVuCisJICogdGhl
IENNTSB3aWxsIGJlIGVuYWJsZWQgYnkgdGhlIENSVEMgdGhyb3VnaCByY2FyX2NtbV9lbmFibGUo
KS4KKwkgKi8KKwlpZiAoIXJjbW0tPmVuYWJsZWQpIHsKKwkJaWYgKCFjb25maWctPmx1dC5lbmFi
bGUpCisJCQlyZXR1cm4gMDsKKworCQlyY2FyX2NtbV9sdXRfZXh0cmFjdChyY21tLCBjb25maWct
Pmx1dC5zaXplLCBjb25maWctPmx1dC50YWJsZSk7CisJCXJjbW0tPmx1dC5lbmFibGVkID0gdHJ1
ZTsKKworCQlyZXR1cm4gMDsKKwl9CisKKwkvKiBTdG9wIExVVCBvcGVyYXRpb25zIGlmIHJlcXVl
c3RlZC4gKi8KKwlpZiAoIWNvbmZpZy0+bHV0LmVuYWJsZSkgeworCQlpZiAocmNtbS0+bHV0LmVu
YWJsZWQpIHsKKwkJCXJjYXJfY21tX3dyaXRlKHJjbW0sIENNMl9MVVRfQ1RSTCwgMCk7CisJCQly
Y21tLT5sdXQuZW5hYmxlZCA9IGZhbHNlOworCQkJcmNtbS0+bHV0LnNpemUgPSAwOworCQl9CisK
KwkJcmV0dXJuIDA7CisJfQorCisJLyoKKwkgKiBFbmFibGUgTFVUIGFuZCBwcm9ncmFtIHRoZSBu
ZXcgZ2FtbWEgdGFibGUgdmFsdWVzLgorCSAqCisJICogRklYTUU6IEluIG9yZGVyIHRvIGhhdmUg
c3RhYmxlIG9wZXJhdGlvbnMgaXQgaXMgcmVxdWlyZWQgdG8gZmlyc3QKKwkgKiBlbmFibGUgdGhl
IDFELUxVVCBhbmQgdGhlbiBwcm9ncmFtIGl0cyB0YWJsZSBlbnRyaWVzLiBUaGlzIHNlZW1zIHRv
CisJICogY29udHJhZGljdCB3aGF0IHRoZSBjaGlwIG1hbnVhbCByZXBvcnRzLCBhbmQgd2lsbCBo
YXZlIHRvIGJlCisJICogcmVjb25zaWRlcmVkIHdoZW4gaW1wbGVtZW50aW5nIHN1cHBvcnQgZm9y
IGRvdWJsZSBidWZmZXJpbmcuCisJICovCisJaWYgKCFyY21tLT5sdXQuZW5hYmxlZCkgeworCQly
Y2FyX2NtbV93cml0ZShyY21tLCBDTTJfTFVUX0NUUkwsIENNMl9MVVRfQ1RSTF9MVVRfRU4pOwor
CQlyY21tLT5sdXQuZW5hYmxlZCA9IHRydWU7CisJfQorCisJcmNhcl9jbW1fbHV0X2V4dHJhY3Qo
cmNtbSwgY29uZmlnLT5sdXQuc2l6ZSwgY29uZmlnLT5sdXQudGFibGUpOworCXJjYXJfY21tX2x1
dF9sb2FkKHJjbW0pOworCisJcmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MX0dQTChyY2FyX2Nt
bV9zZXR1cCk7CisKKy8qKgorICogcmNhcl9jbW1fZW5hYmxlKCkgLSBlbmFibGUgdGhlIENNTSB1
bml0CisgKgorICogQHBkZXY6IFRoZSBwbGF0Zm9ybSBkZXZpY2UgYXNzb2NpYXRlZCB3aXRoIHRo
ZSBDTU0gaW5zdGFuY2UKKyAqCisgKiBFbmFibGUgdGhlIENNTSB1bml0IGJ5IGVuYWJsaW5nIHRo
ZSBwYXJlbnQgY2xvY2sgYW5kIGVuYWJsaW5nIHRoZSBDTU0KKyAqIGNvbXBvbmVudHMsIHN1Y2gg
YXMgMS1EIExVVCwgaWYgcmVxdWVzdGVkLgorICovCitpbnQgcmNhcl9jbW1fZW5hYmxlKHN0cnVj
dCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IHJjYXJfY21tICpyY21tID0gcGxh
dGZvcm1fZ2V0X2RydmRhdGEocGRldik7CisJaW50IHJldDsKKworCWlmICghcmNtbSkKKwkJcmV0
dXJuIC1FUFJPQkVfREVGRVI7CisKKwlyZXQgPSBwbV9ydW50aW1lX2dldF9zeW5jKCZwZGV2LT5k
ZXYpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJLyogQXBwbHkgdGhlIExVVCB0
YWJsZSB2YWx1ZXMgc2F2ZWQgYXQgcmNhcl9jbW1fc2V0dXAoKSB0aW1lLiAqLworCWlmIChyY21t
LT5sdXQuZW5hYmxlZCkgeworCQlyY2FyX2NtbV93cml0ZShyY21tLCBDTTJfTFVUX0NUUkwsIENN
Ml9MVVRfQ1RSTF9MVVRfRU4pOworCQlyY2FyX2NtbV9sdXRfbG9hZChyY21tKTsKKwl9CisKKwly
Y21tLT5lbmFibGVkID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTF9HUEwo
cmNhcl9jbW1fZW5hYmxlKTsKKworLyoqCisgKiByY2FyX2NtbV9kaXNhYmxlKCkgLSBkaXNhYmxl
IHRoZSBDTU0gdW5pdAorICoKKyAqIEBwZGV2OiBUaGUgcGxhdGZvcm0gZGV2aWNlIGFzc29jaWF0
ZWQgd2l0aCB0aGUgQ01NIGluc3RhbmNlCisgKgorICogRGlzYWJsZSB0aGUgQ01NIHVuaXQgYnkg
c3RvcHBpbmcgdGhlIHBhcmVudCBjbG9jay4KKyAqLwordm9pZCByY2FyX2NtbV9kaXNhYmxlKHN0
cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IHJjYXJfY21tICpyY21tID0g
cGxhdGZvcm1fZ2V0X2RydmRhdGEocGRldik7CisKKwlyY2FyX2NtbV93cml0ZShyY21tLCBDTTJf
TFVUX0NUUkwsIDApOworCisJcG1fcnVudGltZV9wdXQoJnBkZXYtPmRldik7CisKKwlyY21tLT5s
dXQuZW5hYmxlZCA9IGZhbHNlOworCXJjbW0tPmx1dC5zaXplID0gMDsKKworCXJjbW0tPmVuYWJs
ZWQgPSBmYWxzZTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKHJjYXJfY21tX2Rpc2FibGUpOworCitz
dGF0aWMgaW50IHJjYXJfY21tX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7
CisJc3RydWN0IHJjYXJfY21tICpyY21tOworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCisJcmNt
bSA9IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBzaXplb2YoKnJjbW0pLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIXJjbW0pCisJCXJldHVybiAtRU5PTUVNOworCisJcGxhdGZvcm1fc2V0X2RydmRhdGEo
cGRldiwgcmNtbSk7CisKKwlyZXMgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2UocGRldiwgSU9SRVNP
VVJDRV9NRU0sIDApOworCXJjbW0tPmJhc2UgPSBkZXZtX2lvcmVtYXBfcmVzb3VyY2UoJnBkZXYt
PmRldiwgcmVzKTsKKwlpZiAoSVNfRVJSKHJjbW0tPmJhc2UpKQorCQlyZXR1cm4gUFRSX0VSUihy
Y21tLT5iYXNlKTsKKworCXBtX3J1bnRpbWVfZW5hYmxlKCZwZGV2LT5kZXYpOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgcmNhcl9jbW1fcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZp
Y2UgKnBkZXYpCit7CisJcG1fcnVudGltZV9kaXNhYmxlKCZwZGV2LT5kZXYpOworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIHJjYXJfY21tX29mX3Rh
YmxlW10gPSB7CisJeyAuY29tcGF0aWJsZSA9ICJyZW5lc2FzLGNtbS1yOGE3Nzk1IiwgfSwKKwl7
IC5jb21wYXRpYmxlID0gInJlbmVzYXMsY21tLXI4YTc3OTYiLCB9LAorCXsgLmNvbXBhdGlibGUg
PSAicmVuZXNhcyxjbW0tcjhhNzc5NjUiLCB9LAorCXsgLmNvbXBhdGlibGUgPSAicmVuZXNhcyxj
bW0tcjhhNzc5OTAiLCB9LAorCXsgLmNvbXBhdGlibGUgPSAicmVuZXNhcyxjbW0tcjhhNzc5OTUi
LCB9LAorCXsgLmNvbXBhdGlibGUgPSAicmVuZXNhcyxyY2FyLWdlbjMtY21tIiwgfSwKKwl7IC5j
b21wYXRpYmxlID0gInJlbmVzYXMscmNhci1nZW4yLWNtbSIsIH0sCisJeyB9LAorfTsKK01PRFVM
RV9ERVZJQ0VfVEFCTEUob2YsIHJjYXJfY21tX29mX3RhYmxlKTsKKworc3RhdGljIHN0cnVjdCBw
bGF0Zm9ybV9kcml2ZXIgcmNhcl9jbW1fcGxhdGZvcm1fZHJpdmVyID0geworCS5wcm9iZQkJPSBy
Y2FyX2NtbV9wcm9iZSwKKwkucmVtb3ZlCQk9IHJjYXJfY21tX3JlbW92ZSwKKwkuZHJpdmVyCQk9
IHsKKwkJLm5hbWUJPSAicmNhci1jbW0iLAorCQkub2ZfbWF0Y2hfdGFibGUgPSByY2FyX2NtbV9v
Zl90YWJsZSwKKwl9LAorfTsKKworbW9kdWxlX3BsYXRmb3JtX2RyaXZlcihyY2FyX2NtbV9wbGF0
Zm9ybV9kcml2ZXIpOworCitNT0RVTEVfQVVUSE9SKCJKYWNvcG8gTW9uZGkgPGphY29wbytyZW5l
c2FzQGptb25kaS5vcmc+Iik7CitNT0RVTEVfREVTQ1JJUFRJT04oIlJlbmVzYXMgUi1DYXIgQ01N
IERyaXZlciIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaCBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3Jj
YXJfY21tLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iMGJiNzM0
OWViYWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2Nt
bS5oCkBAIC0wLDAgKzEsMzggQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4w
KyAqLworLyoKKyAqIHJjYXJfY21tLmggLS0gUi1DYXIgRGlzcGxheSBVbml0IENvbG9yIE1hbmFn
ZW1lbnQgTW9kdWxlCisgKgorICogQ29weXJpZ2h0IChDKSAyMDE5IEphY29wbyBNb25kaSA8amFj
b3BvK3JlbmVzYXNAam1vbmRpLm9yZz4KKyAqLworCisjaWZuZGVmIF9fUkNBUl9DTU1fSF9fCisj
ZGVmaW5lIF9fUkNBUl9DTU1fSF9fCisKKyNkZWZpbmUgQ01NX0dBTU1BX0xVVF9TSVpFCQkyNTYK
Kworc3RydWN0IGRybV9jb2xvcl9sdXQ7CitzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlOworCisvKioK
KyAqIHN0cnVjdCByY2FyX2NtbV9jb25maWcgLSBDTU0gY29uZmlndXJhdGlvbgorICoKKyAqIEBs
dXQ6CTFELUxVVCBjb25maWd1cmF0aW9uCisgKiBAbHV0LmVuYWJsZToJMUQtTFVUIGVuYWJsZSBm
bGFnCisgKiBAbHV0LnRhYmxlOgkxRC1MVVQgdGFibGUgZW50cmllcworICogQGx1dC5zaXplOglO
dW1iZXIgb2YgMUQtTFVUIChtYXggMjU2KQorICovCitzdHJ1Y3QgcmNhcl9jbW1fY29uZmlnIHsK
KwlzdHJ1Y3QgeworCQlib29sIGVuYWJsZTsKKwkJc3RydWN0IGRybV9jb2xvcl9sdXQgKnRhYmxl
OworCQl1bnNpZ25lZCBpbnQgc2l6ZTsKKwl9IGx1dDsKK307CisKK2ludCByY2FyX2NtbV9lbmFi
bGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7Cit2b2lkIHJjYXJfY21tX2Rpc2FibGUo
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CisKK2ludCByY2FyX2NtbV9zZXR1cChzdHJ1
Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAorCQkgICBjb25zdCBzdHJ1Y3QgcmNhcl9jbW1fY29u
ZmlnICpjb25maWcpOworCisjZW5kaWYgLyogX19SQ0FSX0NNTV9IX18gKi8KLS0KMi4yMi4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
