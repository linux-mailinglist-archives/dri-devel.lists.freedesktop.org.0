Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3499F2C6466
	for <lists+dri-devel@lfdr.de>; Fri, 27 Nov 2020 13:08:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3FD956EC2D;
	Fri, 27 Nov 2020 12:08:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9C9BD6EC1B;
 Fri, 27 Nov 2020 12:08:01 +0000 (UTC)
IronPort-SDR: do9D0M/cKlBuA9YFgzStqD3eoybnp7AFEafQDjtbz3t62kEW4lyaAMeYFGipon44PiCZGjN42a
 wtIBe4hig67g==
X-IronPort-AV: E=McAfee;i="6000,8403,9817"; a="168883396"
X-IronPort-AV: E=Sophos;i="5.78,374,1599548400"; d="scan'208";a="168883396"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by fmsmga102.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 27 Nov 2020 04:08:01 -0800
IronPort-SDR: DdjMpM+xhUktASwzQnxORwnOGJWV5A1tsxD8lwr+pQ5CZVbPN6HiU5MjBYaWj83t3UFklQuz3Q
 QGFxEONZJ6bw==
X-IronPort-AV: E=Sophos;i="5.78,374,1599548400"; d="scan'208";a="548028613"
Received: from mjgleeso-mobl.ger.corp.intel.com (HELO
 mwauld-desk1.ger.corp.intel.com) ([10.251.85.2])
 by orsmga005-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 27 Nov 2020 04:07:59 -0800
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC PATCH 019/162] drm/i915: make lockdep slightly happier about
 execbuf.
Date: Fri, 27 Nov 2020 12:04:55 +0000
Message-Id: <20201127120718.454037-20-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20201127120718.454037-1-matthew.auld@intel.com>
References: <20201127120718.454037-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org,
 =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNv
bT4KCkFzIHNvb24gYXMgd2UgaW5zdGFsbCBmZW5jZXMsIHdlIHNob3VsZCBzdG9wIGFsbG9jYXRp
bmcgbWVtb3J5CmluIG9yZGVyIHRvIHByZXZlbnQgYW55IHBvdGVudGlhbCBkZWFkbG9ja3MuCgpU
aGlzIGlzIHJlcXVpcmVkIGxhdGVyIG9uLCB3aGVuIHdlIHN0YXJ0IGFkZGluZyBzdXBwb3J0IGZv
cgpkbWEtZmVuY2UgYW5ub3RhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3Jz
dCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgpDYzogVGhvbWFzIEhlbGxzdHLD
tm0gPHRob21hcy5oZWxsc3Ryb21AbGludXguaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8IDI0ICsrKysrKysrKysrKysrLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDIwICsrKysr
KysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAgICAgICAg
ICB8ICA4ICsrKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggICAgICAgICAg
ICAgICB8ICAzICsrKwogNCBmaWxlcyBjaGFuZ2VkLCAzNiBpbnNlcnRpb25zKCspLCAxOSBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYwppbmRleCA1NjhjODMyMWRjM2QuLjMxZTQxMmU1YzY4YSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC00OSwxMSArNDksMTIgQEAg
ZW51bSB7CiAjZGVmaW5lIERCR19GT1JDRV9SRUxPQyAwIC8qIGNob29zZSBvbmUgb2YgdGhlIGFi
b3ZlISAqLwogfTsKIAotI2RlZmluZSBfX0VYRUNfT0JKRUNUX0hBU19QSU4JCUJJVCgzMSkKLSNk
ZWZpbmUgX19FWEVDX09CSkVDVF9IQVNfRkVOQ0UJCUJJVCgzMCkKLSNkZWZpbmUgX19FWEVDX09C
SkVDVF9ORUVEU19NQVAJCUJJVCgyOSkKLSNkZWZpbmUgX19FWEVDX09CSkVDVF9ORUVEU19CSUFT
CUJJVCgyOCkKLSNkZWZpbmUgX19FWEVDX09CSkVDVF9JTlRFUk5BTF9GTEFHUwkofjB1IDw8IDI4
KSAvKiBhbGwgb2YgdGhlIGFib3ZlICovCisvKiBfX0VYRUNfT0JKRUNUX05PX1JFU0VSVkUgaXMg
QklUKDMxKSwgZGVmaW5lZCBpbiBpOTE1X3ZtYS5oICovCisjZGVmaW5lIF9fRVhFQ19PQkpFQ1Rf
SEFTX1BJTgkJQklUKDMwKQorI2RlZmluZSBfX0VYRUNfT0JKRUNUX0hBU19GRU5DRQkJQklUKDI5
KQorI2RlZmluZSBfX0VYRUNfT0JKRUNUX05FRURTX01BUAkJQklUKDI4KQorI2RlZmluZSBfX0VY
RUNfT0JKRUNUX05FRURTX0JJQVMJQklUKDI3KQorI2RlZmluZSBfX0VYRUNfT0JKRUNUX0lOVEVS
TkFMX0ZMQUdTCSh+MHUgPDwgMjcpIC8qIGFsbCBvZiB0aGUgYWJvdmUgKyAqLwogI2RlZmluZSBf
X0VYRUNfT0JKRUNUX1JFU0VSVkVEIChfX0VYRUNfT0JKRUNUX0hBU19QSU4gfCBfX0VYRUNfT0JK
RUNUX0hBU19GRU5DRSkKIAogI2RlZmluZSBfX0VYRUNfSEFTX1JFTE9DCUJJVCgzMSkKQEAgLTky
OSw2ICs5MzAsMTIgQEAgc3RhdGljIGludCBlYl92YWxpZGF0ZV92bWFzKHN0cnVjdCBpOTE1X2V4
ZWNidWZmZXIgKmViKQogCQkJfQogCQl9CiAKKwkJaWYgKCEoZXYtPmZsYWdzICYgRVhFQ19PQkpF
Q1RfV1JJVEUpKSB7CisJCQllcnIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCh2bWEtPnJlc3Ys
IDEpOworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOworCQl9CisKIAkJR0VNX0JVR19PTihk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkgJiYKIAkJCSAgIGViX3ZtYV9taXNwbGFj
ZWQoJmViLT5leGVjW2ldLCB2bWEsIGV2LT5mbGFncykpOwogCX0KQEAgLTIxOTQsNyArMjIwMSw4
IEBAIHN0YXRpYyBpbnQgZWJfbW92ZV90b19ncHUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIp
CiAJCX0KIAogCQlpZiAoZXJyID09IDApCi0JCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2
ZSh2bWEsIGViLT5yZXF1ZXN0LCBmbGFncyk7CisJCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2Fj
dGl2ZSh2bWEsIGViLT5yZXF1ZXN0LAorCQkJCQkJICAgICAgZmxhZ3MgfCBfX0VYRUNfT0JKRUNU
X05PX1JFU0VSVkUpOwogCX0KIAogCWlmICh1bmxpa2VseShlcnIpKQpAQCAtMjQ0Niw2ICsyNDU0
LDEwIEBAIHN0YXRpYyBpbnQgZWJfcGFyc2VfcGlwZWxpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZl
ciAqZWIsCiAJaWYgKGVycikKIAkJZ290byBlcnJfY29tbWl0OwogCisJZXJyID0gZG1hX3Jlc3Zf
cmVzZXJ2ZV9zaGFyZWQoc2hhZG93LT5yZXN2LCAxKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9j
b21taXQ7CisKIAkvKiBXYWl0IGZvciBhbGwgd3JpdGVzIChhbmQgcmVsb2NzKSBpbnRvIHRoZSBi
YXRjaCB0byBjb21wbGV0ZSAqLwogCWVyciA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRp
b24oJnB3LT5iYXNlLmNoYWluLAogCQkJCQkgICAgICBwdy0+YmF0Y2gtPnJlc3YsIE5VTEwsIGZh
bHNlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKaW5kZXggMTBhODY1ZjNkYzA5Li42YmE0
Zjg3OGFiMGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwpAQCAtMjk2LDE4ICsyOTYs
MTMgQEAgc3RhdGljIHN0cnVjdCBhY3RpdmVfbm9kZSAqX19hY3RpdmVfbG9va3VwKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KQogc3RhdGljIHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5j
ZSAqCiBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCiB7
Ci0Jc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlLCAqcHJlYWxsb2M7CisJc3RydWN0IGFjdGl2ZV9u
b2RlICpub2RlOwogCXN0cnVjdCByYl9ub2RlICoqcCwgKnBhcmVudDsKIAogCW5vZGUgPSBfX2Fj
dGl2ZV9sb29rdXAocmVmLCBpZHgpOwogCWlmIChsaWtlbHkobm9kZSkpCiAJCXJldHVybiAmbm9k
ZS0+YmFzZTsKIAotCS8qIFByZWFsbG9jYXRlIGEgcmVwbGFjZW1lbnQsIGp1c3QgaW4gY2FzZSAq
LwotCXByZWFsbG9jID0ga21lbV9jYWNoZV9hbGxvYyhnbG9iYWwuc2xhYl9jYWNoZSwgR0ZQX0tF
Uk5FTCk7Ci0JaWYgKCFwcmVhbGxvYykKLQkJcmV0dXJuIE5VTEw7Ci0KIAlzcGluX2xvY2tfaXJx
KCZyZWYtPnRyZWVfbG9jayk7CiAJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikp
OwogCkBAIC0zMTcsMTAgKzMxMiw4IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiwgdTY0IGlkeCkKIAkJcGFyZW50ID0gKnA7CiAKIAkJbm9kZSA9IHJiX2VudHJ5KHBh
cmVudCwgc3RydWN0IGFjdGl2ZV9ub2RlLCBub2RlKTsKLQkJaWYgKG5vZGUtPnRpbWVsaW5lID09
IGlkeCkgewotCQkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBwcmVhbGxvYyk7
CisJCWlmIChub2RlLT50aW1lbGluZSA9PSBpZHgpCiAJCQlnb3RvIG91dDsKLQkJfQogCiAJCWlm
IChub2RlLT50aW1lbGluZSA8IGlkeCkKIAkJCXAgPSAmcGFyZW50LT5yYl9yaWdodDsKQEAgLTMy
OCw3ICszMjEsMTQgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1
NjQgaWR4KQogCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CiAJfQogCi0Jbm9kZSA9IHByZWFsbG9j
OworCS8qCisJICogWFhYOiBXZSBzaG91bGQgcHJlYWxsb2NhdGUgdGhpcyBiZWZvcmUgaTkxNV9h
Y3RpdmVfcmVmKCkgaXMgZXZlcgorCSAqICBjYWxsZWQsIGJ1dCB3ZSBjYW5ub3QgY2FsbCBpbnRv
IGZzX3JlY2xhaW0oKSBhbnl3YXksIHNvIHVzZSBHRlBfQVRPTUlDLgorCSAqLworCW5vZGUgPSBr
bWVtX2NhY2hlX2FsbG9jKGdsb2JhbC5zbGFiX2NhY2hlLCBHRlBfQVRPTUlDKTsKKwlpZiAoIW5v
ZGUpCisJCWdvdG8gb3V0OworCiAJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZub2RlLT5iYXNl
LCBOVUxMLCBub2RlX3JldGlyZSk7CiAJbm9kZS0+cmVmID0gcmVmOwogCW5vZGUtPnRpbWVsaW5l
ID0gaWR4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZTA3NjIxODI1ZGE5Li41YjFkNzhm
YTc0OGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTI4MSw5ICsxMjgxLDExIEBAIGlu
dCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJb2JqLT53
cml0ZV9kb21haW4gPSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOwogCQlvYmotPnJlYWRfZG9tYWlu
cyA9IDA7CiAJfSBlbHNlIHsKLQkJZXJyID0gZG1hX3Jlc3ZfcmVzZXJ2ZV9zaGFyZWQodm1hLT5y
ZXN2LCAxKTsKLQkJaWYgKHVubGlrZWx5KGVycikpCi0JCQlyZXR1cm4gZXJyOworCQlpZiAoIShm
bGFncyAmIF9fRVhFQ19PQkpFQ1RfTk9fUkVTRVJWRSkpIHsKKwkJCWVyciA9IGRtYV9yZXN2X3Jl
c2VydmVfc2hhcmVkKHZtYS0+cmVzdiwgMSk7CisJCQlpZiAodW5saWtlbHkoZXJyKSkKKwkJCQly
ZXR1cm4gZXJyOworCQl9CiAKIAkJZG1hX3Jlc3ZfYWRkX3NoYXJlZF9mZW5jZSh2bWEtPnJlc3Ys
ICZycS0+ZmVuY2UpOwogCQlvYmotPndyaXRlX2RvbWFpbiA9IDA7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuaAppbmRleCAyMjM4N2EzNjE5OTkuLmEyZTdiNThiNzBjYSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5oCkBAIC01Miw2ICs1Miw5IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3ZtYV9pc19h
Y3RpdmUoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJcmV0dXJuICFpOTE1X2FjdGl2ZV9p
c19pZGxlKCZ2bWEtPmFjdGl2ZSk7CiB9CiAKKy8qIGRvIG5vdCByZXNlcnZlIG1lbW9yeSB0byBw
cmV2ZW50IGRlYWRsb2NrcyAqLworI2RlZmluZSBfX0VYRUNfT0JKRUNUX05PX1JFU0VSVkUgQklU
KDMxKQorCiBpbnQgX19tdXN0X2NoZWNrIF9faTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0
IGk5MTVfdm1hICp2bWEsCiAJCQkJCSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKIGludCBf
X211c3RfY2hlY2sgaTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEs
Ci0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bAo=
