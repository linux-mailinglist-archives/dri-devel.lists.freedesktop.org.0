Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BB1414E77E
	for <lists+dri-devel@lfdr.de>; Fri, 21 Jun 2019 13:58:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 161486E881;
	Fri, 21 Jun 2019 11:58:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9BE706E881
 for <dri-devel@lists.freedesktop.org>; Fri, 21 Jun 2019 11:58:00 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com
 [10.5.11.12])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id C87B33082A8F;
 Fri, 21 Jun 2019 11:57:59 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-212.ams2.redhat.com
 [10.36.116.212])
 by smtp.corp.redhat.com (Postfix) with ESMTP id B01BB60CA3;
 Fri, 21 Jun 2019 11:57:56 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id EEA7817473; Fri, 21 Jun 2019 13:57:55 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 02/18] drm/vram: use embedded gem object
Date: Fri, 21 Jun 2019 13:57:39 +0200
Message-Id: <20190621115755.8481-3-kraxel@redhat.com>
In-Reply-To: <20190621115755.8481-1-kraxel@redhat.com>
References: <20190621115755.8481-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Fri, 21 Jun 2019 11:58:00 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hans de Goede <hdegoede@redhat.com>, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, open list <linux-kernel@vger.kernel.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>,
 Xinwei Kong <kong.kongxinwei@hisilicon.com>, Gerd Hoffmann <kraxel@redhat.com>,
 Chen Feng <puck.chen@hisilicon.com>, Rongrong Zou <zourongrong@gmail.com>,
 Dave Airlie <airlied@redhat.com>, Sean Paul <sean@poorly.run>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHJvcCBkcm1fZ2VtX29iamVjdCBmcm9tIGRybV9nZW1fdnJhbV9vYmplY3QsIHVzZSB0aGUKdHRt
X2J1ZmZlcl9vYmplY3QuYmFzZSBpbnN0ZWFkLgoKU2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFu
biA8a3JheGVsQHJlZGhhdC5jb20+Ci0tLQogaW5jbHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBl
ci5oICAgICAgICAgICB8ICAzICstLQogZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbWFpbi5jICAg
ICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5j
ICAgICAgIHwgMTYgKysrKysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9o
aWJtYy9oaWJtY190dG0uYyB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAw
X21haW4uYyAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tYWlu
LmMgICAgICAgfCAgMiArLQogNiBmaWxlcyBjaGFuZ2VkLCAxMyBpbnNlcnRpb25zKCspLCAxNCBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVy
LmggYi9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmgKaW5kZXggOTU4MWVhMGE0Zjdl
Li43YjlmNTBiYTNmY2UgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxw
ZXIuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmgKQEAgLTM2LDcgKzM2
LDYgQEAgc3RydWN0IHZtX2FyZWFfc3RydWN0OwogICogdmlkZW8gbWVtb3J5IGJlY29tZXMgc2Nh
cmNlLgogICovCiBzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCB7Ci0Jc3RydWN0IGRybV9nZW1f
b2JqZWN0IGdlbTsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgYm87CiAJc3RydWN0IHR0bV9i
b19rbWFwX29iaiBrbWFwOwogCkBAIC02OCw3ICs2Nyw3IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0
IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9vZl9ibygKIHN0YXRpYyBpbmxpbmUg
c3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9vZl9nZW0oCiAJc3RydWN0
IGRybV9nZW1fb2JqZWN0ICpnZW0pCiB7Ci0JcmV0dXJuIGNvbnRhaW5lcl9vZihnZW0sIHN0cnVj
dCBkcm1fZ2VtX3ZyYW1fb2JqZWN0LCBnZW0pOworCXJldHVybiBjb250YWluZXJfb2YoZ2VtLCBz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCwgYm8uYmFzZSk7CiB9CiAKIHN0cnVjdCBkcm1fZ2Vt
X3ZyYW1fb2JqZWN0ICpkcm1fZ2VtX3ZyYW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tYWluLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYXN0L2FzdF9tYWluLmMKaW5kZXggNGM3ZTMxY2I0NWZmLi43NGU2ZTQ3MWQyODMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21haW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYXN0L2FzdF9tYWluLmMKQEAgLTYwOSw2ICs2MDksNiBAQCBpbnQgYXN0X2dlbV9jcmVh
dGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGFsbG9j
YXRlIEdFTSBvYmplY3RcbiIpOwogCQlyZXR1cm4gcmV0OwogCX0KLQkqb2JqID0gJmdiby0+Z2Vt
OworCSpvYmogPSAmZ2JvLT5iby5iYXNlOwogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1f
Z2VtX3ZyYW1faGVscGVyLmMKaW5kZXggNGRlNzgyY2EyNmIyLi42MWQ5NTIwY2MxNWYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwpAQCAtMjQsNyArMjQsNyBAQCBzdGF0aWMg
dm9pZCBkcm1fZ2VtX3ZyYW1fY2xlYW51cChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2Jv
KQogCSAqIFRUTSBidWZmZXIgb2JqZWN0IGluICdibycgaGFzIGFscmVhZHkgYmVlbiBjbGVhbmVk
CiAJICogdXA7IG9ubHkgcmVsZWFzZSB0aGUgR0VNIG9iamVjdC4KIAkgKi8KLQlkcm1fZ2VtX29i
amVjdF9yZWxlYXNlKCZnYm8tPmdlbSk7CisJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgmZ2JvLT5i
by5iYXNlKTsKIH0KIAogc3RhdGljIHZvaWQgZHJtX2dlbV92cmFtX2Rlc3Ryb3koc3RydWN0IGRy
bV9nZW1fdnJhbV9vYmplY3QgKmdibykKQEAgLTgwLDcgKzgwLDcgQEAgc3RhdGljIGludCBkcm1f
Z2VtX3ZyYW1faW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWludCByZXQ7CiAJc2l6ZV90
IGFjY19zaXplOwogCi0JcmV0ID0gZHJtX2dlbV9vYmplY3RfaW5pdChkZXYsICZnYm8tPmdlbSwg
c2l6ZSk7CisJcmV0ID0gZHJtX2dlbV9vYmplY3RfaW5pdChkZXYsICZnYm8tPmJvLmJhc2UsIHNp
emUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTk4LDcgKzk4LDcgQEAgc3RhdGlj
IGludCBkcm1fZ2VtX3ZyYW1faW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXJldHVybiAw
OwogCiBlcnJfZHJtX2dlbV9vYmplY3RfcmVsZWFzZToKLQlkcm1fZ2VtX29iamVjdF9yZWxlYXNl
KCZnYm8tPmdlbSk7CisJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgmZ2JvLT5iby5iYXNlKTsKIAly
ZXR1cm4gcmV0OwogfQogCkBAIC0zNzgsMTEgKzM3OCwxMSBAQCBpbnQgZHJtX2dlbV92cmFtX2Zp
bGxfY3JlYXRlX2R1bWIoc3RydWN0IGRybV9maWxlICpmaWxlLAogCWlmIChJU19FUlIoZ2JvKSkK
IAkJcmV0dXJuIFBUUl9FUlIoZ2JvKTsKIAotCXJldCA9IGRybV9nZW1faGFuZGxlX2NyZWF0ZShm
aWxlLCAmZ2JvLT5nZW0sICZoYW5kbGUpOworCXJldCA9IGRybV9nZW1faGFuZGxlX2NyZWF0ZShm
aWxlLCAmZ2JvLT5iby5iYXNlLCAmaGFuZGxlKTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9kcm1f
Z2VtX29iamVjdF9wdXRfdW5sb2NrZWQ7CiAKLQlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQo
Jmdiby0+Z2VtKTsKKwlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoJmdiby0+Ym8uYmFzZSk7
CiAKIAlhcmdzLT5waXRjaCA9IHBpdGNoOwogCWFyZ3MtPnNpemUgPSBzaXplOwpAQCAtMzkxLDcg
KzM5MSw3IEBAIGludCBkcm1fZ2VtX3ZyYW1fZmlsbF9jcmVhdGVfZHVtYihzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUsCiAJcmV0dXJuIDA7CiAKIGVycl9kcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQ6
Ci0JZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZnYm8tPmdlbSk7CisJZHJtX2dlbV9vYmpl
Y3RfcHV0X3VubG9ja2VkKCZnYm8tPmJvLmJhc2UpOwogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRf
U1lNQk9MKGRybV9nZW1fdnJhbV9maWxsX2NyZWF0ZV9kdW1iKTsKQEAgLTQ0MSw3ICs0NDEsNyBA
QCBpbnQgZHJtX2dlbV92cmFtX2JvX2RyaXZlcl92ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sCiB7CiAJc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibyA9IGRy
bV9nZW1fdnJhbV9vZl9ibyhibyk7CiAKLQlyZXR1cm4gZHJtX3ZtYV9ub2RlX3ZlcmlmeV9hY2Nl
c3MoJmdiby0+Z2VtLnZtYV9ub2RlLAorCXJldHVybiBkcm1fdm1hX25vZGVfdmVyaWZ5X2FjY2Vz
cygmZ2JvLT5iby5iYXNlLnZtYV9ub2RlLAogCQkJCQkgIGZpbHAtPnByaXZhdGVfZGF0YSk7CiB9
CiBFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV9ib19kcml2ZXJfdmVyaWZ5X2FjY2Vzcyk7CkBA
IC02MzUsNyArNjM1LDcgQEAgaW50IGRybV9nZW1fdnJhbV9kcml2ZXJfZ2VtX3ByaW1lX21tYXAo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW0sCiB7CiAJc3RydWN0IGRybV9nZW1fdnJhbV9vYmpl
Y3QgKmdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZ2VtKTsKIAotCWdiby0+Z2VtLnZtYV9ub2Rl
LnZtX25vZGUuc3RhcnQgPSBnYm8tPmJvLnZtYV9ub2RlLnZtX25vZGUuc3RhcnQ7CisJZ2JvLT5i
by5iYXNlLnZtYV9ub2RlLnZtX25vZGUuc3RhcnQgPSBnYm8tPmJvLnZtYV9ub2RlLnZtX25vZGUu
c3RhcnQ7CiAJcmV0dXJuIGRybV9nZW1fcHJpbWVfbW1hcChnZW0sIHZtYSk7CiB9CiBFWFBPUlRf
U1lNQk9MKGRybV9nZW1fdnJhbV9kcml2ZXJfZ2VtX3ByaW1lX21tYXApOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMKaW5kZXggNTJmYmE4Y2I4ZGRkLi5mMmE2
M2I1ZjA0MjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGli
bWNfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0u
YwpAQCAtNjUsNyArNjUsNyBAQCBpbnQgaGlibWNfZ2VtX2NyZWF0ZShzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB1MzIgc2l6ZSwgYm9vbCBpc2tlcm5lbCwKIAkJCURSTV9FUlJPUigiZmFpbGVkIHRv
IGFsbG9jYXRlIEdFTSBvYmplY3Q6ICVkXG4iLCByZXQpOwogCQlyZXR1cm4gcmV0OwogCX0KLQkq
b2JqID0gJmdiby0+Z2VtOworCSpvYmogPSAmZ2JvLT5iby5iYXNlOwogCXJldHVybiAwOwogfQog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX21haW4uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfbWFpbi5jCmluZGV4IDBkN2ZjMDBlNWQ4YS4u
YzE3NDQwZDNlNmJjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAw
X21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX21haW4uYwpAQCAt
Mjg4LDYgKzI4OCw2IEBAIGludCBtZ2FnMjAwX2dlbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGFsbG9jYXRlIEdFTSBvYmplY3RcbiIpOwog
CQlyZXR1cm4gcmV0OwogCX0KLQkqb2JqID0gJmdiby0+Z2VtOworCSpvYmogPSAmZ2JvLT5iby5i
YXNlOwogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRl
by92Ym94X21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tYWluLmMKaW5k
ZXggMTg2OTNlMmJmNzJhLi4wMmZhODI3N2ZmMWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS92Ym94dmlkZW8vdmJveF9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRlby92
Ym94X21haW4uYwpAQCAtMjkyLDcgKzI5Miw3IEBAIGludCB2Ym94X2dlbV9jcmVhdGUoc3RydWN0
IHZib3hfcHJpdmF0ZSAqdmJveCwKIAkJcmV0dXJuIHJldDsKIAl9CiAKLQkqb2JqID0gJmdiby0+
Z2VtOworCSpvYmogPSAmZ2JvLT5iby5iYXNlOwogCiAJcmV0dXJuIDA7CiB9Ci0tIAoyLjE4LjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZl
bCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
