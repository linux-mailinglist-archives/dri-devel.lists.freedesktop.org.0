Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B369CFAB78
	for <lists+dri-devel@lfdr.de>; Wed, 13 Nov 2019 08:56:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 619126EA45;
	Wed, 13 Nov 2019 07:56:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1FEF96EBC8
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Nov 2019 20:22:52 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id d13so15696318qko.3
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Nov 2019 12:22:52 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=pTAE3C6UkPphbB8bkoC7OIstj7M49YCEG83oq3fCqt8=;
 b=FPJ4wI55Us9GCtCS2+F9AiW8Y5TwSZFxOXMQ63P074/g9qJ4S4r+C8MGonIcGbHTDS
 pcgcK0QzdbsHp0BDthZTu1cUHLkh7JJqcc8efzu+SHWojE5g/miejaU+M3drAC4WmbDR
 AuQ+bLqUvyDxtmM9XhoKpvOCMtomRd1kWpDvBPPTJ8YjVCb+PziiZkP4N0HrL0/YtJNB
 OxSvZgDgnu6JF2enVNblsrSnK8l44uIHTkKogx8cUwfQ/UzH+slX1oR3Y6QiAuyywA2+
 eG7PFwnnAUtdPlKBfY1OQtTecZwj+JrqdUoBGub9qvIANRYMKPtre2GRBSJpkP/PnEsk
 g2lQ==
X-Gm-Message-State: APjAAAXpjzqa4kJc+9GuNUtyjvb2OiRX18MtF9VfTkpN1sIcErVlnU5T
 FCOV1KFSrbeSN7uq1bQEwM1kwg==
X-Google-Smtp-Source: APXvYqzaFmdsuGMd+sc3S8UlqP5hfIuFeBKJzgQIPlueQUEvMNlEoPp1r+TNgyLS5EenfDQ/yuhiOA==
X-Received: by 2002:a37:9e89:: with SMTP id
 h131mr17485213qke.477.1573590171112; 
 Tue, 12 Nov 2019 12:22:51 -0800 (PST)
Received: from ziepe.ca
 (hlfxns017vw-142-162-113-180.dhcp-dynamic.fibreop.ns.bellaliant.net.
 [142.162.113.180])
 by smtp.gmail.com with ESMTPSA id h27sm11695982qtk.37.2019.11.12.12.22.47
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 12 Nov 2019 12:22:48 -0800 (PST)
Received: from jgg by mlx.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1iUcgZ-0003kG-Fs; Tue, 12 Nov 2019 16:22:47 -0400
From: Jason Gunthorpe <jgg@ziepe.ca>
To: linux-mm@kvack.org, Jerome Glisse <jglisse@redhat.com>,
 Ralph Campbell <rcampbell@nvidia.com>, John Hubbard <jhubbard@nvidia.com>,
 Felix.Kuehling@amd.com
Subject: [PATCH v3 08/14] nouveau: use mmu_notifier directly for
 invalidate_range_start
Date: Tue, 12 Nov 2019 16:22:25 -0400
Message-Id: <20191112202231.3856-9-jgg@ziepe.ca>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112202231.3856-1-jgg@ziepe.ca>
References: <20191112202231.3856-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 13 Nov 2019 07:55:45 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=pTAE3C6UkPphbB8bkoC7OIstj7M49YCEG83oq3fCqt8=;
 b=b6CK4yU3UoL1CgOKkjCuHrBDiEHENtFT8feX58DmCzY3bqiu4ZK/Od2V3upqZFZ5q7
 zm5H9MRQbRsh0K4H8EnHPsoAOVpkNGbeQTWESbKT7P1dzjMaa36fJQDItWwIT4VRKg3R
 Gas8YxYUJLlyuUQYpfr0WFPgm8oZMHWzG77Crk8koct7WiOYQzWm92xQWPw7pPLdfWH2
 NYRVu5/wK0lZF5PCsWAVQL7hRAsVZrhf1u7s5+qbe9Y9tLc5b1GA1xrg+xi8AQKDdxZe
 ibyjaFHn3hUIJ+4muJB7bymx2DOpJUqTbrvG73Ef8vCtg1rq/D41eg/PfUtqDhj5VWop
 W2PA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Mike Marciniszyn <mike.marciniszyn@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Oleksandr Andrushchenko <oleksandr_andrushchenko@epam.com>,
 linux-rdma@vger.kernel.org, nouveau@lists.freedesktop.org,
 Dennis Dalessandro <dennis.dalessandro@intel.com>,
 amd-gfx@lists.freedesktop.org, Christoph Hellwig <hch@infradead.org>,
 Jason Gunthorpe <jgg@mellanox.com>, dri-devel@lists.freedesktop.org,
 Alex Deucher <alexander.deucher@amd.com>, xen-devel@lists.xenproject.org,
 Boris Ostrovsky <boris.ostrovsky@oracle.com>, Petr Cvek <petrcvekcz@gmail.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhlcmUgaXMgbm8gcmVh
c29uIHRvIGdldCB0aGUgaW52YWxpZGF0ZV9yYW5nZV9zdGFydCgpIGNhbGxiYWNrIHZpYSBhbgpp
bmRpcmVjdGlvbiB0aHJvdWdoIGhtbV9taXJyb3IsIGp1c3QgcmVnaXN0ZXIgYSBub3JtYWwgbm90
aWZpZXIgZGlyZWN0bHkuCgpUZXN0ZWQtYnk6IFJhbHBoIENhbXBiZWxsIDxyY2FtcGJlbGxAbnZp
ZGlhLmNvbT4KU2lnbmVkLW9mZi1ieTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfc3ZtLmMgfCA5NSArKysrKysr
KysrKysrKysrKystLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA2MyBpbnNlcnRpb25zKCspLCAz
MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2
ZWF1X3N2bS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9zdm0uYwppbmRleCA2
NjhkNGJkMGMxMThmMS4uNTc3Zjg4MTE5MjVhNTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfc3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91
dmVhdV9zdm0uYwpAQCAtODgsNiArODgsNyBAQCBub3V2ZWF1X2l2bW1fZmluZChzdHJ1Y3Qgbm91
dmVhdV9zdm0gKnN2bSwgdTY0IGluc3QpCiB9CiAKIHN0cnVjdCBub3V2ZWF1X3N2bW0geworCXN0
cnVjdCBtbXVfbm90aWZpZXIgbm90aWZpZXI7CiAJc3RydWN0IG5vdXZlYXVfdm1tICp2bW07CiAJ
c3RydWN0IHsKIAkJdW5zaWduZWQgbG9uZyBzdGFydDsKQEAgLTk2LDcgKzk3LDYgQEAgc3RydWN0
IG5vdXZlYXVfc3ZtbSB7CiAKIAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7CiAKLQlzdHJ1Y3QgbW1fc3Ry
dWN0ICptbTsKIAlzdHJ1Y3QgaG1tX21pcnJvciBtaXJyb3I7CiB9OwogCkBAIC0yNTEsMTAgKzI1
MSwxMSBAQCBub3V2ZWF1X3N2bW1faW52YWxpZGF0ZShzdHJ1Y3Qgbm91dmVhdV9zdm1tICpzdm1t
LCB1NjQgc3RhcnQsIHU2NCBsaW1pdCkKIH0KIAogc3RhdGljIGludAotbm91dmVhdV9zdm1tX3N5
bmNfY3B1X2RldmljZV9wYWdldGFibGVzKHN0cnVjdCBobW1fbWlycm9yICptaXJyb3IsCi0JCQkJ
CWNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfcmFuZ2UgKnVwZGF0ZSkKK25vdXZlYXVfc3ZtbV9p
bnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uLAorCQkJCSAgICBj
b25zdCBzdHJ1Y3QgbW11X25vdGlmaWVyX3JhbmdlICp1cGRhdGUpCiB7Ci0Jc3RydWN0IG5vdXZl
YXVfc3ZtbSAqc3ZtbSA9IGNvbnRhaW5lcl9vZihtaXJyb3IsIHR5cGVvZigqc3ZtbSksIG1pcnJv
cik7CisJc3RydWN0IG5vdXZlYXVfc3ZtbSAqc3ZtbSA9CisJCWNvbnRhaW5lcl9vZihtbiwgc3Ry
dWN0IG5vdXZlYXVfc3ZtbSwgbm90aWZpZXIpOwogCXVuc2lnbmVkIGxvbmcgc3RhcnQgPSB1cGRh
dGUtPnN0YXJ0OwogCXVuc2lnbmVkIGxvbmcgbGltaXQgPSB1cGRhdGUtPmVuZDsKIApAQCAtMjY0
LDYgKzI2NSw5IEBAIG5vdXZlYXVfc3ZtbV9zeW5jX2NwdV9kZXZpY2VfcGFnZXRhYmxlcyhzdHJ1
Y3QgaG1tX21pcnJvciAqbWlycm9yLAogCVNWTU1fREJHKHN2bW0sICJpbnZhbGlkYXRlICUwMTZs
eC0lMDE2bHgiLCBzdGFydCwgbGltaXQpOwogCiAJbXV0ZXhfbG9jaygmc3ZtbS0+bXV0ZXgpOwor
CWlmICh1bmxpa2VseSghc3ZtbS0+dm1tKSkKKwkJZ290byBvdXQ7CisKIAlpZiAobGltaXQgPiBz
dm1tLT51bm1hbmFnZWQuc3RhcnQgJiYgc3RhcnQgPCBzdm1tLT51bm1hbmFnZWQubGltaXQpIHsK
IAkJaWYgKHN0YXJ0IDwgc3ZtbS0+dW5tYW5hZ2VkLnN0YXJ0KSB7CiAJCQlub3V2ZWF1X3N2bW1f
aW52YWxpZGF0ZShzdm1tLCBzdGFydCwKQEAgLTI3MywxOSArMjc3LDMxIEBAIG5vdXZlYXVfc3Zt
bV9zeW5jX2NwdV9kZXZpY2VfcGFnZXRhYmxlcyhzdHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yLAog
CX0KIAogCW5vdXZlYXVfc3ZtbV9pbnZhbGlkYXRlKHN2bW0sIHN0YXJ0LCBsaW1pdCk7CisKK291
dDoKIAltdXRleF91bmxvY2soJnN2bW0tPm11dGV4KTsKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGlj
IHZvaWQKLW5vdXZlYXVfc3ZtbV9yZWxlYXNlKHN0cnVjdCBobW1fbWlycm9yICptaXJyb3IpCitz
dGF0aWMgdm9pZCBub3V2ZWF1X3N2bW1fZnJlZV9ub3RpZmllcihzdHJ1Y3QgbW11X25vdGlmaWVy
ICptbikKK3sKKwlrZnJlZShjb250YWluZXJfb2YobW4sIHN0cnVjdCBub3V2ZWF1X3N2bW0sIG5v
dGlmaWVyKSk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgbW11X25vdGlmaWVyX29wcyBub3V2
ZWF1X21uX29wcyA9IHsKKwkuaW52YWxpZGF0ZV9yYW5nZV9zdGFydCA9IG5vdXZlYXVfc3ZtbV9p
bnZhbGlkYXRlX3JhbmdlX3N0YXJ0LAorCS5mcmVlX25vdGlmaWVyID0gbm91dmVhdV9zdm1tX2Zy
ZWVfbm90aWZpZXIsCit9OworCitzdGF0aWMgaW50Citub3V2ZWF1X3N2bW1fc3luY19jcHVfZGV2
aWNlX3BhZ2V0YWJsZXMoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwKKwkJCQkJY29uc3Qgc3Ry
dWN0IG1tdV9ub3RpZmllcl9yYW5nZSAqdXBkYXRlKQogeworCXJldHVybiAwOwogfQogCi1zdGF0
aWMgY29uc3Qgc3RydWN0IGhtbV9taXJyb3Jfb3BzCi1ub3V2ZWF1X3N2bW0gPSB7CitzdGF0aWMg
Y29uc3Qgc3RydWN0IGhtbV9taXJyb3Jfb3BzIG5vdXZlYXVfc3ZtbSA9IHsKIAkuc3luY19jcHVf
ZGV2aWNlX3BhZ2V0YWJsZXMgPSBub3V2ZWF1X3N2bW1fc3luY19jcHVfZGV2aWNlX3BhZ2V0YWJs
ZXMsCi0JLnJlbGVhc2UgPSBub3V2ZWF1X3N2bW1fcmVsZWFzZSwKIH07CiAKIHZvaWQKQEAgLTI5
NCw3ICszMTAsMTAgQEAgbm91dmVhdV9zdm1tX2Zpbmkoc3RydWN0IG5vdXZlYXVfc3ZtbSAqKnBz
dm1tKQogCXN0cnVjdCBub3V2ZWF1X3N2bW0gKnN2bW0gPSAqcHN2bW07CiAJaWYgKHN2bW0pIHsK
IAkJaG1tX21pcnJvcl91bnJlZ2lzdGVyKCZzdm1tLT5taXJyb3IpOwotCQlrZnJlZSgqcHN2bW0p
OworCQltdXRleF9sb2NrKCZzdm1tLT5tdXRleCk7CisJCXN2bW0tPnZtbSA9IE5VTEw7CisJCW11
dGV4X3VubG9jaygmc3ZtbS0+bXV0ZXgpOworCQltbXVfbm90aWZpZXJfcHV0KCZzdm1tLT5ub3Rp
Zmllcik7CiAJCSpwc3ZtbSA9IE5VTEw7CiAJfQogfQpAQCAtMzIwLDcgKzMzOSw3IEBAIG5vdXZl
YXVfc3ZtbV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJbXV0ZXhf
bG9jaygmY2xpLT5tdXRleCk7CiAJaWYgKGNsaS0+c3ZtLmNsaSkgewogCQlyZXQgPSAtRUJVU1k7
Ci0JCWdvdG8gZG9uZTsKKwkJZ290byBvdXRfZnJlZTsKIAl9CiAKIAkvKiBBbGxvY2F0ZSBhIG5l
dyBHUFUgVk1NIHRoYXQgY2FuIHN1cHBvcnQgU1ZNIChtYW5hZ2VkIGJ5IHRoZQpAQCAtMzM1LDI0
ICszNTQsMzMgQEAgbm91dmVhdV9zdm1tX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJCQkuZmF1bHRfcmVwbGF5ID0gdHJ1ZSwKIAkJCSAgICB9LCBzaXplb2Yoc3Ry
dWN0IGdwMTAwX3ZtbV92MCksICZjbGktPnN2bS52bW0pOwogCWlmIChyZXQpCi0JCWdvdG8gZG9u
ZTsKKwkJZ290byBvdXRfZnJlZTsKIAotCS8qIEVuYWJsZSBITU0gbWlycm9yaW5nIG9mIENQVSBh
ZGRyZXNzLXNwYWNlIHRvIFZNTS4gKi8KLQlzdm1tLT5tbSA9IGdldF90YXNrX21tKGN1cnJlbnQp
OwotCWRvd25fd3JpdGUoJnN2bW0tPm1tLT5tbWFwX3NlbSk7CisJZG93bl93cml0ZSgmY3VycmVu
dC0+bW0tPm1tYXBfc2VtKTsKIAlzdm1tLT5taXJyb3Iub3BzID0gJm5vdXZlYXVfc3ZtbTsKLQly
ZXQgPSBobW1fbWlycm9yX3JlZ2lzdGVyKCZzdm1tLT5taXJyb3IsIHN2bW0tPm1tKTsKLQlpZiAo
cmV0ID09IDApIHsKLQkJY2xpLT5zdm0uc3ZtbSA9IHN2bW07Ci0JCWNsaS0+c3ZtLmNsaSA9IGNs
aTsKLQl9Ci0JdXBfd3JpdGUoJnN2bW0tPm1tLT5tbWFwX3NlbSk7Ci0JbW1wdXQoc3ZtbS0+bW0p
OworCXJldCA9IGhtbV9taXJyb3JfcmVnaXN0ZXIoJnN2bW0tPm1pcnJvciwgY3VycmVudC0+bW0p
OworCWlmIChyZXQpCisJCWdvdG8gb3V0X21tX3VubG9jazsKIAotZG9uZToKKwlzdm1tLT5ub3Rp
Zmllci5vcHMgPSAmbm91dmVhdV9tbl9vcHM7CisJcmV0ID0gX19tbXVfbm90aWZpZXJfcmVnaXN0
ZXIoJnN2bW0tPm5vdGlmaWVyLCBjdXJyZW50LT5tbSk7CiAJaWYgKHJldCkKLQkJbm91dmVhdV9z
dm1tX2ZpbmkoJnN2bW0pOworCQlnb3RvIG91dF9obW1fdW5yZWdpc3RlcjsKKwkvKiBOb3RlLCBv
d25lcnNoaXAgb2Ygc3ZtbSB0cmFuc2ZlcnMgdG8gbW11X25vdGlmaWVyICovCisKKwljbGktPnN2
bS5zdm1tID0gc3ZtbTsKKwljbGktPnN2bS5jbGkgPSBjbGk7CisJdXBfd3JpdGUoJmN1cnJlbnQt
Pm1tLT5tbWFwX3NlbSk7CiAJbXV0ZXhfdW5sb2NrKCZjbGktPm11dGV4KTsKKwlyZXR1cm4gMDsK
Kworb3V0X2htbV91bnJlZ2lzdGVyOgorCWhtbV9taXJyb3JfdW5yZWdpc3Rlcigmc3ZtbS0+bWly
cm9yKTsKK291dF9tbV91bmxvY2s6CisJdXBfd3JpdGUoJmN1cnJlbnQtPm1tLT5tbWFwX3NlbSk7
CitvdXRfZnJlZToKKwltdXRleF91bmxvY2soJmNsaS0+bXV0ZXgpOworCWtmcmVlKHN2bW0pOwog
CXJldHVybiByZXQ7CiB9CiAKQEAgLTQ5NCwxMiArNTIyLDEyIEBAIG5vdXZlYXVfcmFuZ2VfZmF1
bHQoc3RydWN0IG5vdXZlYXVfc3ZtbSAqc3ZtbSwgc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2UpCiAK
IAlyZXQgPSBobW1fcmFuZ2VfcmVnaXN0ZXIocmFuZ2UsICZzdm1tLT5taXJyb3IpOwogCWlmIChy
ZXQpIHsKLQkJdXBfcmVhZCgmc3ZtbS0+bW0tPm1tYXBfc2VtKTsKKwkJdXBfcmVhZCgmc3ZtbS0+
bm90aWZpZXIubW0tPm1tYXBfc2VtKTsKIAkJcmV0dXJuIChpbnQpcmV0OwogCX0KIAogCWlmICgh
aG1tX3JhbmdlX3dhaXRfdW50aWxfdmFsaWQocmFuZ2UsIEhNTV9SQU5HRV9ERUZBVUxUX1RJTUVP
VVQpKSB7Ci0JCXVwX3JlYWQoJnN2bW0tPm1tLT5tbWFwX3NlbSk7CisJCXVwX3JlYWQoJnN2bW0t
Pm5vdGlmaWVyLm1tLT5tbWFwX3NlbSk7CiAJCXJldHVybiAtRUJVU1k7CiAJfQogCkBAIC01MDcs
NyArNTM1LDcgQEAgbm91dmVhdV9yYW5nZV9mYXVsdChzdHJ1Y3Qgbm91dmVhdV9zdm1tICpzdm1t
LCBzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkKIAlpZiAocmV0IDw9IDApIHsKIAkJaWYgKHJldCA9
PSAwKQogCQkJcmV0ID0gLUVCVVNZOwotCQl1cF9yZWFkKCZzdm1tLT5tbS0+bW1hcF9zZW0pOwor
CQl1cF9yZWFkKCZzdm1tLT5ub3RpZmllci5tbS0+bW1hcF9zZW0pOwogCQlobW1fcmFuZ2VfdW5y
ZWdpc3RlcihyYW5nZSk7CiAJCXJldHVybiByZXQ7CiAJfQpAQCAtNTg3LDEyICs2MTUsMTUgQEAg
bm91dmVhdV9zdm1fZmF1bHQoc3RydWN0IG52aWZfbm90aWZ5ICpub3RpZnkpCiAJYXJncy5pLnAu
dmVyc2lvbiA9IDA7CiAKIAlmb3IgKGZpID0gMDsgZm4gPSBmaSArIDEsIGZpIDwgYnVmZmVyLT5m
YXVsdF9ucjsgZmkgPSBmbikgeworCQlzdHJ1Y3QgbW1fc3RydWN0ICptbTsKKwogCQkvKiBDYW5j
ZWwgYW55IGZhdWx0cyBmcm9tIG5vbi1TVk0gY2hhbm5lbHMuICovCiAJCWlmICghKHN2bW0gPSBi
dWZmZXItPmZhdWx0W2ZpXS0+c3ZtbSkpIHsKIAkJCW5vdXZlYXVfc3ZtX2ZhdWx0X2NhbmNlbF9m
YXVsdChzdm0sIGJ1ZmZlci0+ZmF1bHRbZmldKTsKIAkJCWNvbnRpbnVlOwogCQl9CiAJCVNWTU1f
REJHKHN2bW0sICJhZGRyICUwMTZsbHgiLCBidWZmZXItPmZhdWx0W2ZpXS0+YWRkcik7CisJCW1t
ID0gc3ZtbS0+bm90aWZpZXIubW07CiAKIAkJLyogV2UgdHJ5IGFuZCBncm91cCBoYW5kbGluZyBv
ZiBmYXVsdHMgd2l0aGluIGEgc21hbGwKIAkJICogd2luZG93IGludG8gYSBzaW5nbGUgdXBkYXRl
LgpAQCAtNjA5LDExICs2NDAsMTEgQEAgbm91dmVhdV9zdm1fZmF1bHQoc3RydWN0IG52aWZfbm90
aWZ5ICpub3RpZnkpCiAJCS8qIEludGVyc2VjdCBmYXVsdCB3aW5kb3cgd2l0aCB0aGUgQ1BVIFZN
QSwgY2FuY2VsbGluZwogCQkgKiB0aGUgZmF1bHQgaWYgdGhlIGFkZHJlc3MgaXMgaW52YWxpZC4K
IAkJICovCi0JCWRvd25fcmVhZCgmc3ZtbS0+bW0tPm1tYXBfc2VtKTsKLQkJdm1hID0gZmluZF92
bWFfaW50ZXJzZWN0aW9uKHN2bW0tPm1tLCBzdGFydCwgbGltaXQpOworCQlkb3duX3JlYWQoJm1t
LT5tbWFwX3NlbSk7CisJCXZtYSA9IGZpbmRfdm1hX2ludGVyc2VjdGlvbihtbSwgc3RhcnQsIGxp
bWl0KTsKIAkJaWYgKCF2bWEpIHsKIAkJCVNWTU1fRVJSKHN2bW0sICJ3bmR3ICUwMTZsbHgtJTAx
NmxseCIsIHN0YXJ0LCBsaW1pdCk7Ci0JCQl1cF9yZWFkKCZzdm1tLT5tbS0+bW1hcF9zZW0pOwor
CQkJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsKIAkJCW5vdXZlYXVfc3ZtX2ZhdWx0X2NhbmNlbF9m
YXVsdChzdm0sIGJ1ZmZlci0+ZmF1bHRbZmldKTsKIAkJCWNvbnRpbnVlOwogCQl9CkBAIC02MjMs
NyArNjU0LDcgQEAgbm91dmVhdV9zdm1fZmF1bHQoc3RydWN0IG52aWZfbm90aWZ5ICpub3RpZnkp
CiAKIAkJaWYgKGJ1ZmZlci0+ZmF1bHRbZmldLT5hZGRyICE9IHN0YXJ0KSB7CiAJCQlTVk1NX0VS
Uihzdm1tLCAiYWRkciAlMDE2bGx4IiwgYnVmZmVyLT5mYXVsdFtmaV0tPmFkZHIpOwotCQkJdXBf
cmVhZCgmc3ZtbS0+bW0tPm1tYXBfc2VtKTsKKwkJCXVwX3JlYWQoJm1tLT5tbWFwX3NlbSk7CiAJ
CQlub3V2ZWF1X3N2bV9mYXVsdF9jYW5jZWxfZmF1bHQoc3ZtLCBidWZmZXItPmZhdWx0W2ZpXSk7
CiAJCQljb250aW51ZTsKIAkJfQpAQCAtNzA0LDcgKzczNSw3IEBAIG5vdXZlYXVfc3ZtX2ZhdWx0
KHN0cnVjdCBudmlmX25vdGlmeSAqbm90aWZ5KQogCQkJCQkJTlVMTCk7CiAJCQlzdm1tLT52bW0t
PnZtbS5vYmplY3QuY2xpZW50LT5zdXBlciA9IGZhbHNlOwogCQkJbXV0ZXhfdW5sb2NrKCZzdm1t
LT5tdXRleCk7Ci0JCQl1cF9yZWFkKCZzdm1tLT5tbS0+bW1hcF9zZW0pOworCQkJdXBfcmVhZCgm
bW0tPm1tYXBfc2VtKTsKIAkJfQogCiAJCS8qIENhbmNlbCBhbnkgZmF1bHRzIGluIHRoZSB3aW5k
b3cgd2hvc2UgcGFnZXMgZGlkbid0IG1hbmFnZQotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
