Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 676744E794
	for <lists+dri-devel@lfdr.de>; Fri, 21 Jun 2019 13:58:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E2E7C6E89A;
	Fri, 21 Jun 2019 11:58:10 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7D6066E88E;
 Fri, 21 Jun 2019 11:58:03 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 030ACC1EB1E7;
 Fri, 21 Jun 2019 11:58:03 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-212.ams2.redhat.com
 [10.36.116.212])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 322FE5D772;
 Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id BE8109DB5; Fri, 21 Jun 2019 13:57:59 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 14/18] drm/amdgpu: switch driver from bo->resv to
 bo->base.resv
Date: Fri, 21 Jun 2019 13:57:51 +0200
Message-Id: <20190621115755.8481-15-kraxel@redhat.com>
In-Reply-To: <20190621115755.8481-1-kraxel@redhat.com>
References: <20190621115755.8481-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Fri, 21 Jun 2019 11:58:03 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, ckoenig.leichtzumerken@gmail.com,
 open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Leo Li <sunpeng.li@amd.com>, Gerd Hoffmann <kraxel@redhat.com>,
 Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+Ci0tLQogLi4u
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgIDYgKystLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMgICAgICAgIHwgIDYgKystLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rpc3BsYXkuYyAgIHwgIDIgKy0KIGRyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgICB8ICA0ICstLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jICAgICAgIHwgIDYgKystLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jICAgICAgIHwgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCAyMCArKysrKystLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgICAgICAgfCAgNiArKy0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdXZkLmMgICAgICAgfCAgNCArLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jICAgICAgICB8IDMwICsrKysrKysr
Ky0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMg
ICB8ICAyICstCiAuLi4vZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMg
fCAgMiArLQogMTMgZmlsZXMgY2hhbmdlZCwgNDYgaW5zZXJ0aW9ucygrKSwgNDYgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtm
ZF9ncHV2bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2
bS5jCmluZGV4IGRmMjZiZjM0YjY3NS4uNmRjZTQzYmQ2MGYxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCkBAIC0yMTgsNyArMjE4LDcg
QEAgdm9pZCBhbWRncHVfYW1ka2ZkX3VucmVzZXJ2ZV9tZW1vcnlfbGltaXQoc3RydWN0IGFtZGdw
dV9ibyAqYm8pCiBzdGF0aWMgaW50IGFtZGdwdV9hbWRrZmRfcmVtb3ZlX2V2aWN0aW9uX2ZlbmNl
KHN0cnVjdCBhbWRncHVfYm8gKmJvLAogCQkJCQlzdHJ1Y3QgYW1kZ3B1X2FtZGtmZF9mZW5jZSAq
ZWYpCiB7Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8ucmVzdjsK
KwlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5iYXNlLnJlc3Y7CiAJ
c3RydWN0IHJlc2VydmF0aW9uX29iamVjdF9saXN0ICpvbGQsICpuZXc7CiAJdW5zaWduZWQgaW50
IGksIGosIGs7CiAKQEAgLTgxMiw3ICs4MTIsNyBAQCBzdGF0aWMgaW50IHByb2Nlc3Nfc3luY19w
ZHNfcmVzdihzdHJ1Y3QgYW1ka2ZkX3Byb2Nlc3NfaW5mbyAqcHJvY2Vzc19pbmZvLAogCQlzdHJ1
Y3QgYW1kZ3B1X2JvICpwZCA9IHBlZXJfdm0tPnJvb3QuYmFzZS5ibzsKIAogCQlyZXQgPSBhbWRn
cHVfc3luY19yZXN2KE5VTEwsCi0JCQkJCXN5bmMsIHBkLT50Ym8ucmVzdiwKKwkJCQkJc3luYywg
cGQtPnRiby5iYXNlLnJlc3YsCiAJCQkJCUFNREdQVV9GRU5DRV9PV05FUl9VTkRFRklORUQsIGZh
bHNlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CkBAIC04ODcsNyArODg3LDcgQEAgc3Rh
dGljIGludCBpbml0X2tmZF92bShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgdm9pZCAqKnByb2Nlc3Nf
aW5mbywKIAkJCQkgIEFNREdQVV9GRU5DRV9PV05FUl9LRkQsIGZhbHNlKTsKIAlpZiAocmV0KQog
CQlnb3RvIHdhaXRfcGRfZmFpbDsKLQlyZXQgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVzZXJ2ZV9z
aGFyZWQodm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YsIDEpOworCXJldCA9IHJlc2VydmF0aW9u
X29iamVjdF9yZXNlcnZlX3NoYXJlZCh2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2LCAx
KTsKIAlpZiAocmV0KQogCQlnb3RvIHJlc2VydmVfc2hhcmVkX2ZhaWw7CiAJYW1kZ3B1X2JvX2Zl
bmNlKHZtLT5yb290LmJhc2UuYm8sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5j
CmluZGV4IGRjNjM3MDdlNDI2Zi4uMTE4ZWM3NTE0Mjc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfY3MuYwpAQCAtNDAyLDcgKzQwMiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2Nz
X2JvX3ZhbGlkYXRlKHN0cnVjdCBhbWRncHVfY3NfcGFyc2VyICpwLAogCXN0cnVjdCB0dG1fb3Bl
cmF0aW9uX2N0eCBjdHggPSB7CiAJCS5pbnRlcnJ1cHRpYmxlID0gdHJ1ZSwKIAkJLm5vX3dhaXRf
Z3B1ID0gZmFsc2UsCi0JCS5yZXN2ID0gYm8tPnRiby5yZXN2LAorCQkucmVzdiA9IGJvLT50Ym8u
YmFzZS5yZXN2LAogCQkuZmxhZ3MgPSAwCiAJfTsKIAl1aW50MzJfdCBkb21haW47CkBAIC03MzQs
NyArNzM0LDcgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfc3luY19yaW5ncyhzdHJ1Y3QgYW1kZ3B1
X2NzX3BhcnNlciAqcCkKIAogCWxpc3RfZm9yX2VhY2hfZW50cnkoZSwgJnAtPnZhbGlkYXRlZCwg
dHYuaGVhZCkgewogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IHR0bV90b19hbWRncHVfYm8oZS0+
dHYuYm8pOwotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5yZXN2
OworCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5iYXNlLnJlc3Y7
CiAKIAkJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwgJnAtPmpvYi0+c3luYywgcmVzdiwg
cC0+ZmlscCwKIAkJCQkgICAgIGFtZGdwdV9ib19leHBsaWNpdF9zeW5jKGJvKSk7CkBAIC0xNzMy
LDcgKzE3MzIsNyBAQCBpbnQgYW1kZ3B1X2NzX2ZpbmRfbWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2Nz
X3BhcnNlciAqcGFyc2VyLAogCSptYXAgPSBtYXBwaW5nOwogCiAJLyogRG91YmxlIGNoZWNrIHRo
YXQgdGhlIEJPIGlzIHJlc2VydmVkIGJ5IHRoaXMgQ1MgKi8KLQlpZiAoUkVBRF9PTkNFKCgqYm8p
LT50Ym8ucmVzdi0+bG9jay5jdHgpICE9ICZwYXJzZXItPnRpY2tldCkKKwlpZiAoUkVBRF9PTkNF
KCgqYm8pLT50Ym8uYmFzZS5yZXN2LT5sb2NrLmN0eCkgIT0gJnBhcnNlci0+dGlja2V0KQogCQly
ZXR1cm4gLUVJTlZBTDsKIAogCWlmICghKCgqYm8pLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRF
X1ZSQU1fQ09OVElHVU9VUykpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZGlzcGxheS5jCmluZGV4IDUzNTY1MDk2N2IxYS4uYjVkMDIwZTE1YzM1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMKQEAgLTIwNCw3ICsyMDQsNyBAQCBp
bnQgYW1kZ3B1X2Rpc3BsYXlfY3J0Y19wYWdlX2ZsaXBfdGFyZ2V0KHN0cnVjdCBkcm1fY3J0YyAq
Y3J0YywKIAkJZ290byB1bnBpbjsKIAl9CiAKLQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9m
ZW5jZXNfcmN1KG5ld19hYm8tPnRiby5yZXN2LCAmd29yay0+ZXhjbCwKKwlyID0gcmVzZXJ2YXRp
b25fb2JqZWN0X2dldF9mZW5jZXNfcmN1KG5ld19hYm8tPnRiby5iYXNlLnJlc3YsICZ3b3JrLT5l
eGNsLAogCQkJCQkgICAgICAmd29yay0+c2hhcmVkX2NvdW50LAogCQkJCQkgICAgICAmd29yay0+
c2hhcmVkKTsKIAlpZiAodW5saWtlbHkociAhPSAwKSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
YW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKaW5kZXggYzU2ODE5YmNhZDhlLi5jZDRmZTlkZDg4NjMg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwpAQCAtMjE2
LDcgKzIxNiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RtYV9idWZfbWFwX2F0dGFjaChzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hX2J1ZiwKIAkJICogZmVuY2VzIG9uIHRoZSByZXNlcnZhdGlvbiBvYmplY3Qg
aW50byBhIHNpbmdsZSBleGNsdXNpdmUKIAkJICogZmVuY2UuCiAJCSAqLwotCQlyID0gX19yZXNl
cnZhdGlvbl9vYmplY3RfbWFrZV9leGNsdXNpdmUoYm8tPnRiby5yZXN2KTsKKwkJciA9IF9fcmVz
ZXJ2YXRpb25fb2JqZWN0X21ha2VfZXhjbHVzaXZlKGJvLT50Ym8uYmFzZS5yZXN2KTsKIAkJaWYg
KHIpCiAJCQlnb3RvIGVycm9yX3VucmVzZXJ2ZTsKIAl9CkBAIC0yNzgsNyArMjc4LDcgQEAgc3Ry
dWN0IHJlc2VydmF0aW9uX29iamVjdCAqYW1kZ3B1X2dlbV9wcmltZV9yZXNfb2JqKHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBhbWRncHVfYm8gKmJvID0gZ2VtX3RvX2Ft
ZGdwdV9ibyhvYmopOwogCi0JcmV0dXJuIGJvLT50Ym8ucmVzdjsKKwlyZXR1cm4gYm8tPnRiby5i
YXNlLnJlc3Y7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5j
CmluZGV4IDZkOTkxZThkZjM1Ny4uZDI2YmNhMWVmYjlkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9h
bWRncHUvYW1kZ3B1X2dlbS5jCkBAIC0xMzQsNyArMTM0LDcgQEAgaW50IGFtZGdwdV9nZW1fb2Jq
ZWN0X29wZW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCiAJCXJldHVybiAtRVBFUk07CiAK
IAlpZiAoYWJvLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRFX1ZNX0FMV0FZU19WQUxJRCAmJgot
CSAgICBhYm8tPnRiby5yZXN2ICE9IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KQorCSAgICBh
Ym8tPnRiby5iYXNlLnJlc3YgIT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikKIAkJ
cmV0dXJuIC1FUEVSTTsKIAogCXIgPSBhbWRncHVfYm9fcmVzZXJ2ZShhYm8sIGZhbHNlKTsKQEAg
LTI1Miw3ICsyNTIsNyBAQCBpbnQgYW1kZ3B1X2dlbV9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJaWYgKHIpCiAJCQlyZXR1cm4gcjsKIAotCQlyZXN2
ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3Y7CisJCXJlc3YgPSB2bS0+cm9vdC5iYXNlLmJv
LT50Ym8uYmFzZS5yZXN2OwogCX0KIAogCXIgPSBhbWRncHVfZ2VtX29iamVjdF9jcmVhdGUoYWRl
diwgc2l6ZSwgYXJncy0+aW4uYWxpZ25tZW50LApAQCAtNDM0LDcgKzQzNCw3IEBAIGludCBhbWRn
cHVfZ2VtX3dhaXRfaWRsZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQlyZXR1cm4gLUVOT0VOVDsKIAl9CiAJcm9iaiA9IGdlbV90b19hbWRncHVfYm8oZ29iaik7
Ci0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3Uocm9iai0+dGJvLnJl
c3YsIHRydWUsIHRydWUsCisJcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9y
Y3Uocm9iai0+dGJvLmJhc2UucmVzdiwgdHJ1ZSwgdHJ1ZSwKIAkJCQkJCSAgdGltZW91dCk7CiAK
IAkvKiByZXQgPT0gMCBtZWFucyBub3Qgc2lnbmFsZWQsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfa21zLmMKaW5kZXggYTcwZTVhMzI3NDlhLi41MTQyYWE2Mzc3YTMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfa21zLmMKQEAgLTEwODQsNyArMTA4NCw3IEBAIHZv
aWQgYW1kZ3B1X2RyaXZlcl9wb3N0Y2xvc2Vfa21zKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
YW1kZ3B1X3ZtX2ZpbmkoYWRldiwgJmZwcml2LT52bSk7CiAKIAlpZiAocGFzaWQpCi0JCWFtZGdw
dV9wYXNpZF9mcmVlX2RlbGF5ZWQocGQtPnRiby5yZXN2LCBwYXNpZCk7CisJCWFtZGdwdV9wYXNp
ZF9mcmVlX2RlbGF5ZWQocGQtPnRiby5iYXNlLnJlc3YsIHBhc2lkKTsKIAlhbWRncHVfYm9fdW5y
ZWYoJnBkKTsKIAogCWlkcl9mb3JfZWFjaF9lbnRyeSgmZnByaXYtPmJvX2xpc3RfaGFuZGxlcywg
bGlzdCwgaGFuZGxlKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X21uLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYwppbmRleCA0
ZmY0Y2Y1OTg4ZWEuLjljNzI1MzFjODQyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X21uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X21uLmMKQEAgLTIxNiw3ICsyMTYsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfbW5faW52YWxp
ZGF0ZV9ub2RlKHN0cnVjdCBhbWRncHVfbW5fbm9kZSAqbm9kZSwKIAkJaWYgKCFhbWRncHVfdHRt
X3R0X2FmZmVjdF91c2VycHRyKGJvLT50Ym8udHRtLCBzdGFydCwgZW5kKSkKIAkJCWNvbnRpbnVl
OwogCi0JCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLnJl
c3YsCisJCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLmJh
c2UucmVzdiwKIAkJCXRydWUsIGZhbHNlLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlmIChy
IDw9IDApCiAJCQlEUk1fRVJST1IoIiglbGQpIGZhaWxlZCB0byB3YWl0IGZvciB1c2VyIGJvXG4i
LCByKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmpl
Y3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwppbmRleCAw
MGIyODNmOTE0YTYuLmVjMGY2NDIwNzE4ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9vYmplY3QuYwpAQCAtNTE3LDcgKzUxNyw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2Jv
X2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkgICAgYm8tPnRiby5tZW0u
cGxhY2VtZW50ICYgVFRNX1BMX0ZMQUdfVlJBTSkgewogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZTsKIAotCQlyID0gYW1kZ3B1X2ZpbGxfYnVmZmVyKGJvLCAwLCBiby0+dGJvLnJlc3YsICZmZW5j
ZSk7CisJCXIgPSBhbWRncHVfZmlsbF9idWZmZXIoYm8sIDAsIGJvLT50Ym8uYmFzZS5yZXN2LCAm
ZmVuY2UpOwogCQlpZiAodW5saWtlbHkocikpCiAJCQlnb3RvIGZhaWxfdW5yZXNlcnZlOwogCkBA
IC01NDAsNyArNTQwLDcgQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2LAogCiBmYWlsX3VucmVzZXJ2ZToKIAlpZiAoIWJwLT5yZXN2KQot
CQl3d19tdXRleF91bmxvY2soJmJvLT50Ym8ucmVzdi0+bG9jayk7CisJCXd3X211dGV4X3VubG9j
aygmYm8tPnRiby5iYXNlLnJlc3YtPmxvY2spOwogCWFtZGdwdV9ib191bnJlZigmYm8pOwogCXJl
dHVybiByOwogfQpAQCAtNTYxLDcgKzU2MSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2JvX2NyZWF0
ZV9zaGFkb3coc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJYnAuZmxhZ3MgPSBBTURHUFVf
R0VNX0NSRUFURV9DUFVfR1RUX1VTV0MgfAogCQlBTURHUFVfR0VNX0NSRUFURV9TSEFET1c7CiAJ
YnAudHlwZSA9IHR0bV9ib190eXBlX2tlcm5lbDsKLQlicC5yZXN2ID0gYm8tPnRiby5yZXN2Owor
CWJwLnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKIAogCXIgPSBhbWRncHVfYm9fZG9fY3JlYXRl
KGFkZXYsICZicCwgJmJvLT5zaGFkb3cpOwogCWlmICghcikgewpAQCAtNjAyLDEzICs2MDIsMTMg
QEAgaW50IGFtZGdwdV9ib19jcmVhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIAlp
ZiAoKGZsYWdzICYgQU1ER1BVX0dFTV9DUkVBVEVfU0hBRE9XKSAmJiAhKGFkZXYtPmZsYWdzICYg
QU1EX0lTX0FQVSkpIHsKIAkJaWYgKCFicC0+cmVzdikKLQkJCVdBUk5fT04ocmVzZXJ2YXRpb25f
b2JqZWN0X2xvY2soKCpib19wdHIpLT50Ym8ucmVzdiwKKwkJCVdBUk5fT04ocmVzZXJ2YXRpb25f
b2JqZWN0X2xvY2soKCpib19wdHIpLT50Ym8uYmFzZS5yZXN2LAogCQkJCQkJCU5VTEwpKTsKIAog
CQlyID0gYW1kZ3B1X2JvX2NyZWF0ZV9zaGFkb3coYWRldiwgYnAtPnNpemUsICpib19wdHIpOwog
CiAJCWlmICghYnAtPnJlc3YpCi0JCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKCgqYm9fcHRy
KS0+dGJvLnJlc3YpOworCQkJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jaygoKmJvX3B0ciktPnRi
by5iYXNlLnJlc3YpOwogCiAJCWlmIChyKQogCQkJYW1kZ3B1X2JvX3VucmVmKGJvX3B0cik7CkBA
IC03MDUsNyArNzA1LDcgQEAgaW50IGFtZGdwdV9ib19rbWFwKHN0cnVjdCBhbWRncHVfYm8gKmJv
LCB2b2lkICoqcHRyKQogCQlyZXR1cm4gMDsKIAl9CiAKLQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0
X3dhaXRfdGltZW91dF9yY3UoYm8tPnRiby5yZXN2LCBmYWxzZSwgZmFsc2UsCisJciA9IHJlc2Vy
dmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8uYmFzZS5yZXN2LCBmYWxzZSwg
ZmFsc2UsCiAJCQkJCQlNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJaWYgKHIgPCAwKQogCQlyZXR1
cm4gcjsKQEAgLTEwODIsNyArMTA4Miw3IEBAIGludCBhbWRncHVfYm9fc2V0X3RpbGluZ19mbGFn
cyhzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTY0IHRpbGluZ19mbGFncykKICAqLwogdm9pZCBhbWRn
cHVfYm9fZ2V0X3RpbGluZ19mbGFncyhzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTY0ICp0aWxpbmdf
ZmxhZ3MpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5yZXN2LT5sb2NrLmJhc2Up
OworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmJvLT50Ym8uYmFzZS5yZXN2LT5sb2NrLmJhc2UpOwog
CiAJaWYgKHRpbGluZ19mbGFncykKIAkJKnRpbGluZ19mbGFncyA9IGJvLT50aWxpbmdfZmxhZ3M7
CkBAIC0xMjc4LDcgKzEyNzgsNyBAQCBpbnQgYW1kZ3B1X2JvX2ZhdWx0X3Jlc2VydmVfbm90aWZ5
KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCiB2b2lkIGFtZGdwdV9ib19mZW5jZShzdHJ1
Y3QgYW1kZ3B1X2JvICpibywgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCiAJCSAgICAgYm9vbCBz
aGFyZWQpCiB7Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8ucmVz
djsKKwlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5iYXNlLnJlc3Y7
CiAKIAlpZiAoc2hhcmVkKQogCQlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX3NoYXJlZF9mZW5jZShy
ZXN2LCBmZW5jZSk7CkBAIC0xMzAzLDcgKzEzMDMsNyBAQCBpbnQgYW1kZ3B1X2JvX3N5bmNfd2Fp
dChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdm9pZCAqb3duZXIsIGJvb2wgaW50cikKIAlpbnQgcjsK
IAogCWFtZGdwdV9zeW5jX2NyZWF0ZSgmc3luYyk7Ci0JYW1kZ3B1X3N5bmNfcmVzdihhZGV2LCAm
c3luYywgYm8tPnRiby5yZXN2LCBvd25lciwgZmFsc2UpOworCWFtZGdwdV9zeW5jX3Jlc3YoYWRl
diwgJnN5bmMsIGJvLT50Ym8uYmFzZS5yZXN2LCBvd25lciwgZmFsc2UpOwogCXIgPSBhbWRncHVf
c3luY193YWl0KCZzeW5jLCBpbnRyKTsKIAlhbWRncHVfc3luY19mcmVlKCZzeW5jKTsKIApAQCAt
MTMyMyw3ICsxMzIzLDcgQEAgaW50IGFtZGdwdV9ib19zeW5jX3dhaXQoc3RydWN0IGFtZGdwdV9i
byAqYm8sIHZvaWQgKm93bmVyLCBib29sIGludHIpCiB1NjQgYW1kZ3B1X2JvX2dwdV9vZmZzZXQo
c3RydWN0IGFtZGdwdV9ibyAqYm8pCiB7CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVtLm1lbV90
eXBlID09IFRUTV9QTF9TWVNURU0pOwotCVdBUk5fT05fT05DRSghd3dfbXV0ZXhfaXNfbG9ja2Vk
KCZiby0+dGJvLnJlc3YtPmxvY2spICYmCisJV0FSTl9PTl9PTkNFKCF3d19tdXRleF9pc19sb2Nr
ZWQoJmJvLT50Ym8uYmFzZS5yZXN2LT5sb2NrKSAmJgogCQkgICAgICFiby0+cGluX2NvdW50ICYm
IGJvLT50Ym8udHlwZSAhPSB0dG1fYm9fdHlwZV9rZXJuZWwpOwogCVdBUk5fT05fT05DRShiby0+
dGJvLm1lbS5zdGFydCA9PSBBTURHUFVfQk9fSU5WQUxJRF9PRkZTRVQpOwogCVdBUk5fT05fT05D
RShiby0+dGJvLm1lbS5tZW1fdHlwZSA9PSBUVE1fUExfVlJBTSAmJgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3R0bS5jCmluZGV4IGI4YWU5YTgzOGI2Yy4uYjkwM2EzODJiNmI2IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCkBAIC00MzgsNyArNDM4LDcg
QEAgc3RhdGljIGludCBhbWRncHVfbW92ZV9ibGl0KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sCiAKIAlyID0gYW1kZ3B1X3R0bV9jb3B5X21lbV90b19tZW0oYWRldiwgJnNyYywgJmRzdCwK
IAkJCQkgICAgICAgbmV3X21lbS0+bnVtX3BhZ2VzIDw8IFBBR0VfU0hJRlQsCi0JCQkJICAgICAg
IGJvLT5yZXN2LCAmZmVuY2UpOworCQkJCSAgICAgICBiby0+YmFzZS5yZXN2LCAmZmVuY2UpOwog
CWlmIChyKQogCQlnb3RvIGVycm9yOwogCkBAIC0xNDUwLDE0ICsxNDUwLDE0IEBAIHN0YXRpYyBi
b29sIGFtZGdwdV90dG1fYm9fZXZpY3Rpb25fdmFsdWFibGUoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywKIAkgKiBjbGVhbmx5IGhhbmRsZSBwYWdlIGZhdWx0cy4KIAkgKi8KIAlpZiAoYm8t
PnR5cGUgPT0gdHRtX2JvX3R5cGVfa2VybmVsICYmCi0JICAgICFyZXNlcnZhdGlvbl9vYmplY3Rf
dGVzdF9zaWduYWxlZF9yY3UoYm8tPnJlc3YsIHRydWUpKQorCSAgICAhcmVzZXJ2YXRpb25fb2Jq
ZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KGJvLT5iYXNlLnJlc3YsIHRydWUpKQogCQlyZXR1cm4gZmFs
c2U7CiAKIAkvKiBJZiBibyBpcyBhIEtGRCBCTywgY2hlY2sgaWYgdGhlIGJvIGJlbG9uZ3MgdG8g
dGhlIGN1cnJlbnQgcHJvY2Vzcy4KIAkgKiBJZiB0cnVlLCB0aGVuIHJldHVybiBmYWxzZSBhcyBh
bnkgS0ZEIHByb2Nlc3MgbmVlZHMgYWxsIGl0cyBCT3MgdG8KIAkgKiBiZSByZXNpZGVudCB0byBy
dW4gc3VjY2Vzc2Z1bGx5CiAJICovCi0JZmxpc3QgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2xp
c3QoYm8tPnJlc3YpOworCWZsaXN0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9saXN0KGJvLT5i
YXNlLnJlc3YpOwogCWlmIChmbGlzdCkgewogCQlmb3IgKGkgPSAwOyBpIDwgZmxpc3QtPnNoYXJl
ZF9jb3VudDsgKytpKSB7CiAJCQlmID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChmbGlzdC0+
c2hhcmVkW2ldLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3V2ZC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jCmluZGV4IDVi
MmZlYTNiNGEyYy4uZjg1ODYwN2IxN2E1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdXZkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3V2ZC5jCkBAIC0xMDczLDcgKzEwNzMsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV91dmRfc2Vu
ZF9tc2coc3RydWN0IGFtZGdwdV9yaW5nICpyaW5nLCBzdHJ1Y3QgYW1kZ3B1X2JvICpibywKIAlp
Yi0+bGVuZ3RoX2R3ID0gMTY7CiAKIAlpZiAoZGlyZWN0KSB7Ci0JCXIgPSByZXNlcnZhdGlvbl9v
YmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLnJlc3YsCisJCXIgPSByZXNlcnZhdGlvbl9v
YmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLmJhc2UucmVzdiwKIAkJCQkJCQl0cnVlLCBm
YWxzZSwKIAkJCQkJCQltc2Vjc190b19qaWZmaWVzKDEwKSk7CiAJCWlmIChyID09IDApCkBAIC0x
MDg1LDcgKzEwODUsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV91dmRfc2VuZF9tc2coc3RydWN0IGFt
ZGdwdV9yaW5nICpyaW5nLCBzdHJ1Y3QgYW1kZ3B1X2JvICpibywKIAkJaWYgKHIpCiAJCQlnb3Rv
IGVycl9mcmVlOwogCX0gZWxzZSB7Ci0JCXIgPSBhbWRncHVfc3luY19yZXN2KGFkZXYsICZqb2It
PnN5bmMsIGJvLT50Ym8ucmVzdiwKKwkJciA9IGFtZGdwdV9zeW5jX3Jlc3YoYWRldiwgJmpvYi0+
c3luYywgYm8tPnRiby5iYXNlLnJlc3YsCiAJCQkJICAgICBBTURHUFVfRkVOQ0VfT1dORVJfVU5E
RUZJTkVELCBmYWxzZSk7CiAJCWlmIChyKQogCQkJZ290byBlcnJfZnJlZTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKaW5kZXggZTQ0ZjlkZDIwMmU4Li40Yzg2YjljZDE1MzAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCkBAIC0zMDIsNyArMzAyLDcg
QEAgc3RhdGljIHZvaWQgYW1kZ3B1X3ZtX2JvX2Jhc2VfaW5pdChzdHJ1Y3QgYW1kZ3B1X3ZtX2Jv
X2Jhc2UgKmJhc2UsCiAJYmFzZS0+bmV4dCA9IGJvLT52bV9ibzsKIAliby0+dm1fYm8gPSBiYXNl
OwogCi0JaWYgKGJvLT50Ym8ucmVzdiAhPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikKKwlp
ZiAoYm8tPnRiby5iYXNlLnJlc3YgIT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikK
IAkJcmV0dXJuOwogCiAJdm0tPmJ1bGtfbW92ZWFibGUgPSBmYWxzZTsKQEAgLTU4Myw3ICs1ODMs
NyBAQCB2b2lkIGFtZGdwdV92bV9kZWxfZnJvbV9scnVfbm90aWZ5KHN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8pCiAJZm9yIChib19iYXNlID0gYWJvLT52bV9ibzsgYm9fYmFzZTsgYm9fYmFz
ZSA9IGJvX2Jhc2UtPm5leHQpIHsKIAkJc3RydWN0IGFtZGdwdV92bSAqdm0gPSBib19iYXNlLT52
bTsKIAotCQlpZiAoYWJvLT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikK
KwkJaWYgKGFiby0+dGJvLmJhc2UucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5y
ZXN2KQogCQkJdm0tPmJ1bGtfbW92ZWFibGUgPSBmYWxzZTsKIAl9CiAKQEAgLTgzNCw3ICs4MzQs
NyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdm1fYm9fcGFyYW0oc3RydWN0IGFtZGdwdV9kZXZpY2Ug
KmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCQlicC0+ZmxhZ3MgfD0gQU1ER1BVX0dFTV9D
UkVBVEVfU0hBRE9XOwogCWJwLT50eXBlID0gdHRtX2JvX3R5cGVfa2VybmVsOwogCWlmICh2bS0+
cm9vdC5iYXNlLmJvKQotCQlicC0+cmVzdiA9IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2Owor
CQlicC0+cmVzdiA9IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3Y7CiB9CiAKIC8qKgpA
QCAtMTY5Miw3ICsxNjkyLDcgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGUoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYsCiAJCQl0dG0gPSBjb250YWluZXJfb2YoYm8tPnRiby50dG0sIHN0cnVj
dCB0dG1fZG1hX3R0LCB0dG0pOwogCQkJcGFnZXNfYWRkciA9IHR0bS0+ZG1hX2FkZHJlc3M7CiAJ
CX0KLQkJZXhjbHVzaXZlID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsKGJvLT50Ym8ucmVz
dik7CisJCWV4Y2x1c2l2ZSA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfZXhjbChiby0+dGJvLmJh
c2UucmVzdik7CiAJfQogCiAJaWYgKGJvKSB7CkBAIC0xNzAyLDcgKzE3MDIsNyBAQCBpbnQgYW1k
Z3B1X3ZtX2JvX3VwZGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJZmxhZ3MgPSAw
eDA7CiAJfQogCi0JaWYgKGNsZWFyIHx8IChibyAmJiBiby0+dGJvLnJlc3YgPT0gdm0tPnJvb3Qu
YmFzZS5iby0+dGJvLnJlc3YpKQorCWlmIChjbGVhciB8fCAoYm8gJiYgYm8tPnRiby5iYXNlLnJl
c3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikpCiAJCWxhc3RfdXBkYXRlID0g
JnZtLT5sYXN0X3VwZGF0ZTsKIAllbHNlCiAJCWxhc3RfdXBkYXRlID0gJmJvX3ZhLT5sYXN0X3B0
X3VwZGF0ZTsKQEAgLTE3MzMsNyArMTczMyw3IEBAIGludCBhbWRncHVfdm1fYm9fdXBkYXRlKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCSAqIHRoZSBldmljdGVkIGxpc3Qgc28gdGhhdCBp
dCBnZXRzIHZhbGlkYXRlZCBhZ2FpbiBvbiB0aGUKIAkgKiBuZXh0IGNvbW1hbmQgc3VibWlzc2lv
bi4KIAkgKi8KLQlpZiAoYm8gJiYgYm8tPnRiby5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRi
by5yZXN2KSB7CisJaWYgKGJvICYmIGJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2Uu
Ym8tPnRiby5iYXNlLnJlc3YpIHsKIAkJdWludDMyX3QgbWVtX3R5cGUgPSBiby0+dGJvLm1lbS5t
ZW1fdHlwZTsKIAogCQlpZiAoIShiby0+cHJlZmVycmVkX2RvbWFpbnMgJiBhbWRncHVfbWVtX3R5
cGVfdG9fZG9tYWluKG1lbV90eXBlKSkpCkBAIC0xODY5LDcgKzE4NjksNyBAQCBzdGF0aWMgdm9p
ZCBhbWRncHVfdm1fZnJlZV9tYXBwaW5nKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogICov
CiBzdGF0aWMgdm9pZCBhbWRncHVfdm1fcHJ0X2Zpbmkoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFk
ZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtKQogewotCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3Qg
KnJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdjsKKwlzdHJ1Y3QgcmVzZXJ2YXRpb25f
b2JqZWN0ICpyZXN2ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdjsKIAlzdHJ1Y3Qg
ZG1hX2ZlbmNlICpleGNsLCAqKnNoYXJlZDsKIAl1bnNpZ25lZCBpLCBzaGFyZWRfY291bnQ7CiAJ
aW50IHI7CkBAIC0xOTgzLDcgKzE5ODMsNyBAQCBpbnQgYW1kZ3B1X3ZtX2hhbmRsZV9tb3ZlZChz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAl3aGlsZSAoIWxpc3RfZW1wdHkoJnZtLT5pbnZh
bGlkYXRlZCkpIHsKIAkJYm9fdmEgPSBsaXN0X2ZpcnN0X2VudHJ5KCZ2bS0+aW52YWxpZGF0ZWQs
IHN0cnVjdCBhbWRncHVfYm9fdmEsCiAJCQkJCSBiYXNlLnZtX3N0YXR1cyk7Ci0JCXJlc3YgPSBi
b192YS0+YmFzZS5iby0+dGJvLnJlc3Y7CisJCXJlc3YgPSBib192YS0+YmFzZS5iby0+dGJvLmJh
c2UucmVzdjsKIAkJc3Bpbl91bmxvY2soJnZtLT5pbnZhbGlkYXRlZF9sb2NrKTsKIAogCQkvKiBU
cnkgdG8gcmVzZXJ2ZSB0aGUgQk8gdG8gYXZvaWQgY2xlYXJpbmcgaXRzIHB0ZXMgKi8KQEAgLTIw
NzQsNyArMjA3NCw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV92bV9ib19pbnNlcnRfbWFwKHN0cnVj
dCBhbWRncHVfZGV2aWNlICphZGV2LAogCWlmIChtYXBwaW5nLT5mbGFncyAmIEFNREdQVV9QVEVf
UFJUKQogCQlhbWRncHVfdm1fcHJ0X2dldChhZGV2KTsKIAotCWlmIChibyAmJiBiby0+dGJvLnJl
c3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YgJiYKKwlpZiAoYm8gJiYgYm8tPnRiby5i
YXNlLnJlc3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdiAmJgogCSAgICAhYm9f
dmEtPmJhc2UubW92ZWQpIHsKIAkJbGlzdF9tb3ZlKCZib192YS0+YmFzZS52bV9zdGF0dXMsICZ2
bS0+bW92ZWQpOwogCX0KQEAgLTI0MDYsNyArMjQwNiw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2JvX3Ry
YWNlX2NzKHN0cnVjdCBhbWRncHVfdm0gKnZtLCBzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKnRpY2tl
dCkKIAkJCXN0cnVjdCBhbWRncHVfYm8gKmJvOwogCiAJCQlibyA9IG1hcHBpbmctPmJvX3ZhLT5i
YXNlLmJvOwotCQkJaWYgKFJFQURfT05DRShiby0+dGJvLnJlc3YtPmxvY2suY3R4KSAhPSB0aWNr
ZXQpCisJCQlpZiAoUkVBRF9PTkNFKGJvLT50Ym8uYmFzZS5yZXN2LT5sb2NrLmN0eCkgIT0gdGlj
a2V0KQogCQkJCWNvbnRpbnVlOwogCQl9CiAKQEAgLTI0MzMsNyArMjQzMyw3IEBAIHZvaWQgYW1k
Z3B1X3ZtX2JvX3JtdihzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlzdHJ1Y3QgYW1kZ3B1
X3ZtX2JvX2Jhc2UgKipiYXNlOwogCiAJaWYgKGJvKSB7Ci0JCWlmIChiby0+dGJvLnJlc3YgPT0g
dm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJCWlmIChiby0+dGJvLmJhc2UucmVzdiA9PSB2
bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQkJdm0tPmJ1bGtfbW92ZWFibGUgPSBm
YWxzZTsKIAogCQlmb3IgKGJhc2UgPSAmYm9fdmEtPmJhc2UuYm8tPnZtX2JvOyAqYmFzZTsKQEAg
LTI0OTcsNyArMjQ5Nyw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2JvX2ludmFsaWRhdGUoc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYsCiAJZm9yIChib19iYXNlID0gYm8tPnZtX2JvOyBib19iYXNlOyBi
b19iYXNlID0gYm9fYmFzZS0+bmV4dCkgewogCQlzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSA9IGJvX2Jh
c2UtPnZtOwogCi0JCWlmIChldmljdGVkICYmIGJvLT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNl
LmJvLT50Ym8ucmVzdikgeworCQlpZiAoZXZpY3RlZCAmJiBiby0+dGJvLmJhc2UucmVzdiA9PSB2
bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KSB7CiAJCQlhbWRncHVfdm1fYm9fZXZpY3Rl
ZChib19iYXNlKTsKIAkJCWNvbnRpbnVlOwogCQl9CkBAIC0yNTA4LDcgKzI1MDgsNyBAQCB2b2lk
IGFtZGdwdV92bV9ib19pbnZhbGlkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCiAJ
CWlmIChiby0+dGJvLnR5cGUgPT0gdHRtX2JvX3R5cGVfa2VybmVsKQogCQkJYW1kZ3B1X3ZtX2Jv
X3JlbG9jYXRlZChib19iYXNlKTsKLQkJZWxzZSBpZiAoYm8tPnRiby5yZXN2ID09IHZtLT5yb290
LmJhc2UuYm8tPnRiby5yZXN2KQorCQllbHNlIGlmIChiby0+dGJvLmJhc2UucmVzdiA9PSB2bS0+
cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQkJYW1kZ3B1X3ZtX2JvX21vdmVkKGJvX2Jh
c2UpOwogCQllbHNlCiAJCQlhbWRncHVfdm1fYm9faW52YWxpZGF0ZWQoYm9fYmFzZSk7CkBAIC0y
NjM4LDcgKzI2MzgsNyBAQCB2b2lkIGFtZGdwdV92bV9hZGp1c3Rfc2l6ZShzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwgdWludDMyX3QgbWluX3ZtX3NpemUsCiAgKi8KIGxvbmcgYW1kZ3B1X3Zt
X3dhaXRfaWRsZShzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgbG9uZyB0aW1lb3V0KQogewotCXJldHVy
biByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdSh2bS0+cm9vdC5iYXNlLmJvLT50
Ym8ucmVzdiwKKwlyZXR1cm4gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3Uodm0t
PnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdiwKIAkJCQkJCSAgIHRydWUsIHRydWUsIHRpbWVv
dXQpOwogfQogCkBAIC0yNzEzLDcgKzI3MTMsNyBAQCBpbnQgYW1kZ3B1X3ZtX2luaXQoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfdm0gKnZtLAogCWlmIChyKQogCQln
b3RvIGVycm9yX2ZyZWVfcm9vdDsKIAotCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVzZXJ2ZV9z
aGFyZWQocm9vdC0+dGJvLnJlc3YsIDEpOworCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVzZXJ2
ZV9zaGFyZWQocm9vdC0+dGJvLmJhc2UucmVzdiwgMSk7CiAJaWYgKHIpCiAJCWdvdG8gZXJyb3Jf
dW5yZXNlcnZlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdm1fc2RtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEu
YwppbmRleCBkZGQxODFmNWVkMzcuLjYxZmM1ODRjYmIxYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtX3NkbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCkBAIC03Miw3ICs3Miw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X3ZtX3NkbWFfcHJlcGFyZShzdHJ1Y3QgYW1kZ3B1X3ZtX3VwZGF0ZV9wYXJhbXMgKnAs
CiAJaWYgKHIpCiAJCXJldHVybiByOwogCi0JciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwg
JnAtPmpvYi0+c3luYywgcm9vdC0+dGJvLnJlc3YsCisJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+
YWRldiwgJnAtPmpvYi0+c3luYywgcm9vdC0+dGJvLmJhc2UucmVzdiwKIAkJCSAgICAgb3duZXIs
IGZhbHNlKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYwppbmRleCAxMTI5ZGQ5NjM3OTYuLjI1NGQ4
YjEzYjQyMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9k
bS9hbWRncHVfZG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2Rt
L2FtZGdwdV9kbS5jCkBAIC01NTEwLDcgKzU1MTAsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfZG1f
Y29tbWl0X3BsYW5lcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCSAqIGRlYWRs
b2NrIGR1cmluZyBHUFUgcmVzZXQgd2hlbiB0aGlzIGZlbmNlIHdpbGwgbm90IHNpZ25hbAogCQkg
KiBidXQgd2UgaG9sZCByZXNlcnZhdGlvbiBsb2NrIGZvciB0aGUgQk8uCiAJCSAqLwotCQlyID0g
cmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYWJvLT50Ym8ucmVzdiwgdHJ1ZSwK
KwkJciA9IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGFiby0+dGJvLmJhc2Uu
cmVzdiwgdHJ1ZSwKIAkJCQkJCQlmYWxzZSwKIAkJCQkJCQltc2Vjc190b19qaWZmaWVzKDUwMDAp
KTsKIAkJaWYgKHVubGlrZWx5KHIgPD0gMCkpCi0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
