Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1E92C10F8E
	for <lists+dri-devel@lfdr.de>; Thu,  2 May 2019 01:03:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 181C2892B9;
	Wed,  1 May 2019 23:03:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x849.google.com (mail-qt1-x849.google.com
 [IPv6:2607:f8b0:4864:20::849])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8046B892B9
 for <dri-devel@lists.freedesktop.org>; Wed,  1 May 2019 23:03:01 +0000 (UTC)
Received: by mail-qt1-x849.google.com with SMTP id w34so328843qtc.16
 for <dri-devel@lists.freedesktop.org>; Wed, 01 May 2019 16:03:01 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=WBzJ19nC8IuqkBcKxxV42TfRISABudjBoJLmYR5hSKo=;
 b=FLvIOXZmgTPkGtMAjfHEyRGR3+ZFA735RehoujgLBEAmx9vCgtOdzuiVCoGdCOro6p
 afpME97rxUsWIF6jGoPPitzRojy/PZkxz+a6RxfiZsMCyMbnXt49KOF5nVlE16imHrkG
 1GVVyKCx2mry+rzjVUO20LTwuU4tFFwgm18uXLBi4uVj5FrGS9TYB9i1QOc3/nVqpUIU
 +7rvVxmFDHjKju4mmXff759PpeMtgpAxTxzyLFahxxHTNJw55UEmvZicchk96d7IDc/g
 bfGdVnyhDg71CXYZWatgnsx1WqpbSrNJnYwRYo0kpxKBAao1u3uNzW0q8gW9h1Scdxfr
 YTgA==
X-Gm-Message-State: APjAAAU43w0mxMeTJnUCM253TomaL6HLsnwwzeY/PoMM5IXcPliIEb5B
 DoNIFp/HJ8EbDgsN0rVRcL5SVogSbNGwK6nOUUoPvQ==
X-Google-Smtp-Source: APXvYqwYxsnAxJym2b9e5x/7Qaxf348dkQ4h5lFxzEuYKroNsf/GILXwwBIlSIdJCXhACkbYLcwEi9jYbbIFVj8HtFw+Vw==
X-Received: by 2002:ac8:26e1:: with SMTP id 30mr559535qtp.305.1556751780638;
 Wed, 01 May 2019 16:03:00 -0700 (PDT)
Date: Wed,  1 May 2019 16:01:11 -0700
In-Reply-To: <20190501230126.229218-1-brendanhiggins@google.com>
Message-Id: <20190501230126.229218-3-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190501230126.229218-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.21.0.593.g511ec345e18-goog
Subject: [PATCH v2 02/17] kunit: test: add test resource management API
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, keescook@google.com, 
 kieran.bingham@ideasonboard.com, mcgrof@kernel.org, robh@kernel.org, 
 sboyd@kernel.org, shuah@kernel.org
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=WBzJ19nC8IuqkBcKxxV42TfRISABudjBoJLmYR5hSKo=;
 b=ilaIbocGv7xrPb0aAy+7Bg6GwWLHnZUp6L6/cNcZkqEinCfdGZ0etp24jSVtgAG2Sb
 6rIAt3IUgY//P5EioZajVMSt7mN3cYTiLSEuUVozB+uL0TBjCOi6Mt5F43FCZmvvPE7O
 h5K8qrSuPXRVkv8Jm4XJMjOmzMEx27gHboiyI44vk7ObllgE331cHf/Ru0GbHK4lXRwq
 7f3z9b0NyF3ZOgdTXzhgeaFJ6SVHyYLpP44s8SF0fx2GUqkHKCOmgB+xlIE80la5yxvr
 AG9U4wBIQ1P5AyHP6iBYGk7vcBp3mYFRV2q7rG0g9LGwQ0My+FCju1odtsjf0t/oq1iM
 7D0Q==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, dan.j.williams@intel.com,
 kunit-dev@googlegroups.com, richard@nod.at, linux-kernel@vger.kernel.org,
 mpe@ellerman.id.au, linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3JlYXRlIGEgY29tbW9uIEFQSSBmb3IgdGVzdCBtYW5hZ2VkIHJlc291cmNlcyBsaWtlIG1lbW9y
eSBhbmQgdGVzdApvYmplY3RzLiBBIGxvdCBvZiB0aW1lcyBhIHRlc3Qgd2lsbCB3YW50IHRvIHNl
dCB1cCBpbmZyYXN0cnVjdHVyZSB0byBiZQp1c2VkIGluIHRlc3QgY2FzZXM7IHRoaXMgY291bGQg
YmUgYW55dGhpbmcgZnJvbSBqdXN0IHdhbnRpbmcgdG8gYWxsb2NhdGUKc29tZSBtZW1vcnkgdG8g
c2V0dGluZyB1cCBhIGRyaXZlciBzdGFjazsgdGhpcyBkZWZpbmVzIGZhY2lsaXRpZXMgZm9yCmNy
ZWF0aW5nICJ0ZXN0IHJlc291cmNlcyIgd2hpY2ggYXJlIG1hbmFnZWQgYnkgdGhlIHRlc3QgaW5m
cmFzdHJ1Y3R1cmUKYW5kIGFyZSBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYXQgdGhlIGNvbmNs
dXNpb24gb2YgdGhlIHRlc3QuCgpTaWduZWQtb2ZmLWJ5OiBCcmVuZGFuIEhpZ2dpbnMgPGJyZW5k
YW5oaWdnaW5zQGdvb2dsZS5jb20+Ci0tLQogaW5jbHVkZS9rdW5pdC90ZXN0LmggfCAxMDkgKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwoga3VuaXQvdGVzdC5jICAg
ICAgICAgfCAgOTUgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMiBmaWxl
cyBjaGFuZ2VkLCAyMDQgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUva3VuaXQv
dGVzdC5oIGIvaW5jbHVkZS9rdW5pdC90ZXN0LmgKaW5kZXggMjNjMmViZWRkNmRkOS4uODE5ZWRk
OGRiNGU4MSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9rdW5pdC90ZXN0LmgKKysrIGIvaW5jbHVkZS9r
dW5pdC90ZXN0LmgKQEAgLTEyLDYgKzEyLDY5IEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4K
ICNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CiAKK3N0cnVjdCBrdW5pdF9yZXNvdXJjZTsKKwordHlw
ZWRlZiBpbnQgKCprdW5pdF9yZXNvdXJjZV9pbml0X3QpKHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAq
LCB2b2lkICopOwordHlwZWRlZiB2b2lkICgqa3VuaXRfcmVzb3VyY2VfZnJlZV90KShzdHJ1Y3Qg
a3VuaXRfcmVzb3VyY2UgKik7CisKKy8qKgorICogc3RydWN0IGt1bml0X3Jlc291cmNlIC0gcmVw
cmVzZW50cyBhICp0ZXN0IG1hbmFnZWQgcmVzb3VyY2UqCisgKiBAYWxsb2NhdGlvbjogZm9yIHRo
ZSB1c2VyIHRvIHN0b3JlIGFyYml0cmFyeSBkYXRhLgorICogQGZyZWU6IGEgdXNlciBzdXBwbGll
ZCBmdW5jdGlvbiB0byBmcmVlIHRoZSByZXNvdXJjZS4gUG9wdWxhdGVkIGJ5CisgKiBrdW5pdF9h
bGxvY19yZXNvdXJjZSgpLgorICoKKyAqIFJlcHJlc2VudHMgYSAqdGVzdCBtYW5hZ2VkIHJlc291
cmNlKiwgYSByZXNvdXJjZSB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHkgYmUKKyAqIGNsZWFuZWQg
dXAgYXQgdGhlIGVuZCBvZiBhIHRlc3QgY2FzZS4KKyAqCisgKiBFeGFtcGxlOgorICoKKyAqIC4u
IGNvZGUtYmxvY2s6OiBjCisgKgorICoJc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHsKKyAq
CQlzaXplX3Qgc2l6ZTsKKyAqCQlnZnBfdCBnZnA7CisgKgl9OworICoKKyAqCXN0YXRpYyBpbnQg
a3VuaXRfa21hbGxvY19pbml0KHN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzLCB2b2lkICpjb250
ZXh0KQorICoJeworICoJCXN0cnVjdCBrdW5pdF9rbWFsbG9jX3BhcmFtcyAqcGFyYW1zID0gY29u
dGV4dDsKKyAqCQlyZXMtPmFsbG9jYXRpb24gPSBrbWFsbG9jKHBhcmFtcy0+c2l6ZSwgcGFyYW1z
LT5nZnApOworICoKKyAqCQlpZiAoIXJlcy0+YWxsb2NhdGlvbikKKyAqCQkJcmV0dXJuIC1FTk9N
RU07CisgKgorICoJCXJldHVybiAwOworICoJfQorICoKKyAqCXN0YXRpYyB2b2lkIGt1bml0X2tt
YWxsb2NfZnJlZShzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcykKKyAqCXsKKyAqCQlrZnJlZShy
ZXMtPmFsbG9jYXRpb24pOworICoJfQorICoKKyAqCXZvaWQgKmt1bml0X2ttYWxsb2Moc3RydWN0
IGt1bml0ICp0ZXN0LCBzaXplX3Qgc2l6ZSwgZ2ZwX3QgZ2ZwKQorICoJeworICoJCXN0cnVjdCBr
dW5pdF9rbWFsbG9jX3BhcmFtcyBwYXJhbXM7CisgKgkJc3RydWN0IGt1bml0X3Jlc291cmNlICpy
ZXM7CisgKgorICoJCXBhcmFtcy5zaXplID0gc2l6ZTsKKyAqCQlwYXJhbXMuZ2ZwID0gZ2ZwOwor
ICoKKyAqCQlyZXMgPSBrdW5pdF9hbGxvY19yZXNvdXJjZSh0ZXN0LCBrdW5pdF9rbWFsbG9jX2lu
aXQsCisgKgkJCWt1bml0X2ttYWxsb2NfZnJlZSwgJnBhcmFtcyk7CisgKgkJaWYgKHJlcykKKyAq
CQkJcmV0dXJuIHJlcy0+YWxsb2NhdGlvbjsKKyAqCQllbHNlCisgKgkJCXJldHVybiBOVUxMOwor
ICoJfQorICovCitzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgeworCXZvaWQgKmFsbG9jYXRpb247CisJ
a3VuaXRfcmVzb3VyY2VfZnJlZV90IGZyZWU7CisKKwkvKiBwcml2YXRlOiBpbnRlcm5hbCB1c2Ug
b25seS4gKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIG5vZGU7Cit9OworCiBzdHJ1Y3Qga3VuaXQ7CiAK
IC8qKgpAQCAtMTA0LDYgKzE2Nyw3IEBAIHN0cnVjdCBrdW5pdCB7CiAJY29uc3QgY2hhciAqbmFt
ZTsgLyogUmVhZCBvbmx5IGFmdGVyIGluaXRpYWxpemF0aW9uISAqLwogCXNwaW5sb2NrX3QgbG9j
azsgLyogR2F1cmRzIGFsbCBtdXRhYmxlIHRlc3Qgc3RhdGUuICovCiAJYm9vbCBzdWNjZXNzOyAv
KiBQcm90ZWN0ZWQgYnkgbG9jay4gKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkIHJlc291cmNlczsgLyog
UHJvdGVjdGVkIGJ5IGxvY2suICovCiAJdm9pZCAoKnZwcmludGspKGNvbnN0IHN0cnVjdCBrdW5p
dCAqdGVzdCwKIAkJCWNvbnN0IGNoYXIgKmxldmVsLAogCQkJc3RydWN0IHZhX2Zvcm1hdCAqdmFm
KTsKQEAgLTEyNyw2ICsxOTEsNTEgQEAgaW50IGt1bml0X3J1bl90ZXN0cyhzdHJ1Y3Qga3VuaXRf
bW9kdWxlICptb2R1bGUpOwogCQl9IFwKIAkJbGF0ZV9pbml0Y2FsbChtb2R1bGVfa3VuaXRfaW5p
dCMjbW9kdWxlKQogCisvKioKKyAqIGt1bml0X2FsbG9jX3Jlc291cmNlKCkgLSBBbGxvY2F0ZXMg
YSAqdGVzdCBtYW5hZ2VkIHJlc291cmNlKi4KKyAqIEB0ZXN0OiBUaGUgdGVzdCBjb250ZXh0IG9i
amVjdC4KKyAqIEBpbml0OiBhIHVzZXIgc3VwcGxpZWQgZnVuY3Rpb24gdG8gaW5pdGlhbGl6ZSB0
aGUgcmVzb3VyY2UuCisgKiBAZnJlZTogYSB1c2VyIHN1cHBsaWVkIGZ1bmN0aW9uIHRvIGZyZWUg
dGhlIHJlc291cmNlLgorICogQGNvbnRleHQ6IGZvciB0aGUgdXNlciB0byBwYXNzIGluIGFyYml0
cmFyeSBkYXRhIHRvIHRoZSBpbml0IGZ1bmN0aW9uLgorICoKKyAqIEFsbG9jYXRlcyBhICp0ZXN0
IG1hbmFnZWQgcmVzb3VyY2UqLCBhIHJlc291cmNlIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBi
ZQorICogY2xlYW5lZCB1cCBhdCB0aGUgZW5kIG9mIGEgdGVzdCBjYXNlLiBTZWUgJnN0cnVjdCBr
dW5pdF9yZXNvdXJjZSBmb3IgYW4KKyAqIGV4YW1wbGUuCisgKi8KK3N0cnVjdCBrdW5pdF9yZXNv
dXJjZSAqa3VuaXRfYWxsb2NfcmVzb3VyY2Uoc3RydWN0IGt1bml0ICp0ZXN0LAorCQkJCQkgICAg
a3VuaXRfcmVzb3VyY2VfaW5pdF90IGluaXQsCisJCQkJCSAgICBrdW5pdF9yZXNvdXJjZV9mcmVl
X3QgZnJlZSwKKwkJCQkJICAgIHZvaWQgKmNvbnRleHQpOworCit2b2lkIGt1bml0X2ZyZWVfcmVz
b3VyY2Uoc3RydWN0IGt1bml0ICp0ZXN0LCBzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcyk7CisK
Ky8qKgorICoga3VuaXRfa21hbGxvYygpIC0gTGlrZSBrbWFsbG9jKCkgZXhjZXB0IHRoZSBhbGxv
Y2F0aW9uIGlzICp0ZXN0IG1hbmFnZWQqLgorICogQHRlc3Q6IFRoZSB0ZXN0IGNvbnRleHQgb2Jq
ZWN0LgorICogQHNpemU6IFRoZSBzaXplIGluIGJ5dGVzIG9mIHRoZSBkZXNpcmVkIG1lbW9yeS4K
KyAqIEBnZnA6IGZsYWdzIHBhc3NlZCB0byB1bmRlcmx5aW5nIGttYWxsb2MoKS4KKyAqCisgKiBK
dXN0IGxpa2UgYGttYWxsb2MoLi4uKWAsIGV4Y2VwdCB0aGUgYWxsb2NhdGlvbiBpcyBtYW5hZ2Vk
IGJ5IHRoZSB0ZXN0IGNhc2UKKyAqIGFuZCBpcyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYWZ0
ZXIgdGhlIHRlc3QgY2FzZSBjb25jbHVkZXMuIFNlZSAmc3RydWN0CisgKiBrdW5pdF9yZXNvdXJj
ZSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KKyAqLwordm9pZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qg
a3VuaXQgKnRlc3QsIHNpemVfdCBzaXplLCBnZnBfdCBnZnApOworCisvKioKKyAqIGt1bml0X2t6
YWxsb2MoKSAtIEp1c3QgbGlrZSBrdW5pdF9rbWFsbG9jKCksIGJ1dCB6ZXJvZXMgdGhlIGFsbG9j
YXRpb24uCisgKiBAdGVzdDogVGhlIHRlc3QgY29udGV4dCBvYmplY3QuCisgKiBAc2l6ZTogVGhl
IHNpemUgaW4gYnl0ZXMgb2YgdGhlIGRlc2lyZWQgbWVtb3J5LgorICogQGdmcDogZmxhZ3MgcGFz
c2VkIHRvIHVuZGVybHlpbmcga21hbGxvYygpLgorICoKKyAqIFNlZSBremFsbG9jKCkgYW5kIGt1
bml0X2ttYWxsb2MoKSBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KKyAqLworc3RhdGljIGlubGluZSB2
b2lkICprdW5pdF9remFsbG9jKHN0cnVjdCBrdW5pdCAqdGVzdCwgc2l6ZV90IHNpemUsIGdmcF90
IGdmcCkKK3sKKwlyZXR1cm4ga3VuaXRfa21hbGxvYyh0ZXN0LCBzaXplLCBnZnAgfCBfX0dGUF9a
RVJPKTsKK30KKwordm9pZCBrdW5pdF9jbGVhbnVwKHN0cnVjdCBrdW5pdCAqdGVzdCk7CisKIHZv
aWQgX19wcmludGYoMywgNCkga3VuaXRfcHJpbnRrKGNvbnN0IGNoYXIgKmxldmVsLAogCQkJCSBj
b25zdCBzdHJ1Y3Qga3VuaXQgKnRlc3QsCiAJCQkJIGNvbnN0IGNoYXIgKmZtdCwgLi4uKTsKZGlm
ZiAtLWdpdCBhL2t1bml0L3Rlc3QuYyBiL2t1bml0L3Rlc3QuYwppbmRleCA1YmY5N2UyOTM1NTc5
Li41NDFmOWFkYjE2MDhjIDEwMDY0NAotLS0gYS9rdW5pdC90ZXN0LmMKKysrIGIva3VuaXQvdGVz
dC5jCkBAIC02Niw2ICs2Niw3IEBAIHN0YXRpYyB2b2lkIGt1bml0X3ZwcmludGsoY29uc3Qgc3Ry
dWN0IGt1bml0ICp0ZXN0LAogaW50IGt1bml0X2luaXRfdGVzdChzdHJ1Y3Qga3VuaXQgKnRlc3Qs
IGNvbnN0IGNoYXIgKm5hbWUpCiB7CiAJc3Bpbl9sb2NrX2luaXQoJnRlc3QtPmxvY2spOworCUlO
SVRfTElTVF9IRUFEKCZ0ZXN0LT5yZXNvdXJjZXMpOwogCXRlc3QtPm5hbWUgPSBuYW1lOwogCXRl
c3QtPnZwcmludGsgPSBrdW5pdF92cHJpbnRrOwogCkBAIC05Myw2ICs5NCwxMSBAQCBzdGF0aWMg
dm9pZCBrdW5pdF9ydW5fY2FzZV9pbnRlcm5hbChzdHJ1Y3Qga3VuaXQgKnRlc3QsCiAJdGVzdF9j
YXNlLT5ydW5fY2FzZSh0ZXN0KTsKIH0KIAorc3RhdGljIHZvaWQga3VuaXRfY2FzZV9pbnRlcm5h
bF9jbGVhbnVwKHN0cnVjdCBrdW5pdCAqdGVzdCkKK3sKKwlrdW5pdF9jbGVhbnVwKHRlc3QpOwor
fQorCiAvKgogICogUGVyZm9ybXMgcG9zdCB2YWxpZGF0aW9ucyBhbmQgY2xlYW51cCBhZnRlciBh
IHRlc3QgY2FzZSB3YXMgcnVuLgogICogWFhYOiBTaG91bGQgT05MWSBCRSBDQUxMRUQgQUZURVIg
a3VuaXRfcnVuX2Nhc2VfaW50ZXJuYWwhCkBAIC0xMDMsNiArMTA5LDggQEAgc3RhdGljIHZvaWQg
a3VuaXRfcnVuX2Nhc2VfY2xlYW51cChzdHJ1Y3Qga3VuaXQgKnRlc3QsCiB7CiAJaWYgKG1vZHVs
ZS0+ZXhpdCkKIAkJbW9kdWxlLT5leGl0KHRlc3QpOworCisJa3VuaXRfY2FzZV9pbnRlcm5hbF9j
bGVhbnVwKHRlc3QpOwogfQogCiAvKgpAQCAtMTUwLDYgKzE1OCw5MyBAQCBpbnQga3VuaXRfcnVu
X3Rlc3RzKHN0cnVjdCBrdW5pdF9tb2R1bGUgKm1vZHVsZSkKIAlyZXR1cm4gMDsKIH0KIAorc3Ry
dWN0IGt1bml0X3Jlc291cmNlICprdW5pdF9hbGxvY19yZXNvdXJjZShzdHJ1Y3Qga3VuaXQgKnRl
c3QsCisJCQkJCSAgICBrdW5pdF9yZXNvdXJjZV9pbml0X3QgaW5pdCwKKwkJCQkJICAgIGt1bml0
X3Jlc291cmNlX2ZyZWVfdCBmcmVlLAorCQkJCQkgICAgdm9pZCAqY29udGV4dCkKK3sKKwlzdHJ1
Y3Qga3VuaXRfcmVzb3VyY2UgKnJlczsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCWludCByZXQ7
CisKKwlyZXMgPSBremFsbG9jKHNpemVvZigqcmVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFyZXMp
CisJCXJldHVybiBOVUxMOworCisJcmV0ID0gaW5pdChyZXMsIGNvbnRleHQpOworCWlmIChyZXQp
CisJCXJldHVybiBOVUxMOworCisJcmVzLT5mcmVlID0gZnJlZTsKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmdGVzdC0+bG9jaywgZmxhZ3MpOworCWxpc3RfYWRkX3RhaWwoJnJlcy0+bm9kZSwgJnRlc3Qt
PnJlc291cmNlcyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGVzdC0+bG9jaywgZmxhZ3Mp
OworCisJcmV0dXJuIHJlczsKK30KKwordm9pZCBrdW5pdF9mcmVlX3Jlc291cmNlKHN0cnVjdCBr
dW5pdCAqdGVzdCwgc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXMpCit7CisJcmVzLT5mcmVlKHJl
cyk7CisJbGlzdF9kZWwoJnJlcy0+bm9kZSk7CisJa2ZyZWUocmVzKTsKK30KKworc3RydWN0IGt1
bml0X2ttYWxsb2NfcGFyYW1zIHsKKwlzaXplX3Qgc2l6ZTsKKwlnZnBfdCBnZnA7Cit9OworCitz
dGF0aWMgaW50IGt1bml0X2ttYWxsb2NfaW5pdChzdHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcywg
dm9pZCAqY29udGV4dCkKK3sKKwlzdHJ1Y3Qga3VuaXRfa21hbGxvY19wYXJhbXMgKnBhcmFtcyA9
IGNvbnRleHQ7CisKKwlyZXMtPmFsbG9jYXRpb24gPSBrbWFsbG9jKHBhcmFtcy0+c2l6ZSwgcGFy
YW1zLT5nZnApOworCWlmICghcmVzLT5hbGxvY2F0aW9uKQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBrdW5pdF9rbWFsbG9jX2ZyZWUoc3RydWN0IGt1
bml0X3Jlc291cmNlICpyZXMpCit7CisJa2ZyZWUocmVzLT5hbGxvY2F0aW9uKTsKK30KKwordm9p
ZCAqa3VuaXRfa21hbGxvYyhzdHJ1Y3Qga3VuaXQgKnRlc3QsIHNpemVfdCBzaXplLCBnZnBfdCBn
ZnApCit7CisJc3RydWN0IGt1bml0X2ttYWxsb2NfcGFyYW1zIHBhcmFtczsKKwlzdHJ1Y3Qga3Vu
aXRfcmVzb3VyY2UgKnJlczsKKworCXBhcmFtcy5zaXplID0gc2l6ZTsKKwlwYXJhbXMuZ2ZwID0g
Z2ZwOworCisJcmVzID0ga3VuaXRfYWxsb2NfcmVzb3VyY2UodGVzdCwKKwkJCQkgICBrdW5pdF9r
bWFsbG9jX2luaXQsCisJCQkJICAga3VuaXRfa21hbGxvY19mcmVlLAorCQkJCSAgICZwYXJhbXMp
OworCisJaWYgKHJlcykKKwkJcmV0dXJuIHJlcy0+YWxsb2NhdGlvbjsKKwllbHNlCisJCXJldHVy
biBOVUxMOworfQorCit2b2lkIGt1bml0X2NsZWFudXAoc3RydWN0IGt1bml0ICp0ZXN0KQorewor
CXN0cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzb3VyY2UsICpyZXNvdXJjZV9zYWZlOworCXVuc2ln
bmVkIGxvbmcgZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGVzdC0+bG9jaywgZmxhZ3Mp
OworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShyZXNvdXJjZSwKKwkJCQkgcmVzb3VyY2Vfc2Fm
ZSwKKwkJCQkgJnRlc3QtPnJlc291cmNlcywKKwkJCQkgbm9kZSkgeworCQlrdW5pdF9mcmVlX3Jl
c291cmNlKHRlc3QsIHJlc291cmNlKTsKKwl9CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGVz
dC0+bG9jaywgZmxhZ3MpOworfQorCiB2b2lkIGt1bml0X3ByaW50ayhjb25zdCBjaGFyICpsZXZl
bCwKIAkJICBjb25zdCBzdHJ1Y3Qga3VuaXQgKnRlc3QsCiAJCSAgY29uc3QgY2hhciAqZm10LCAu
Li4pCi0tIAoyLjIxLjAuNTkzLmc1MTFlYzM0NWUxOC1nb29nCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
