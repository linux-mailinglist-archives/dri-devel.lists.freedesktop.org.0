Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2FB5728845A
	for <lists+dri-devel@lfdr.de>; Fri,  9 Oct 2020 10:00:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C08C96EC76;
	Fri,  9 Oct 2020 08:00:19 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D50996EC7A
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Oct 2020 08:00:13 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id j2so9240514wrx.7
 for <dri-devel@lists.freedesktop.org>; Fri, 09 Oct 2020 01:00:13 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=H+w/Nn7YNzQtL1R8HRvtzmLcceEG02qI4DQoPSHvskY=;
 b=SipLyVLu1maT+t1abz+yr4JywllfndSf6j6ENSrLq2AfSPXsjK05ajnSvbgqsompuC
 1UhyDtuQjFpLpdHPLuaPJ1Y5re9PD8a0kaqxKFb6bu6P7peJGTnfxqpJ9GUn/cQVjw0m
 wfneMt3tfvx7mL59KoMFPgFV7khypHJ1pv88Y=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=H+w/Nn7YNzQtL1R8HRvtzmLcceEG02qI4DQoPSHvskY=;
 b=Y+bHmhmVuMS0fqYAGo6OnZPI/Hq6ndtrn6E6FKbhTZygwx0zpAzwp19LfK+opOSo4x
 RS4GwQxEOrA5uPLtXGg9yXJblw0VWRYn39UIGkgox0Cxun8FMIRTjP7WV5YvpFaxfXtW
 Jua3ZwQe2RsYHFF3Zr0hmF0aOzQcTaga9WuwO4ALyM/MQ5y+CnupYhyoRoDSFmqBKrs4
 4wkPilwpBavEaZfkTnVJGPvrA3MroOjxOa4xC4kCp7QYIyWnhe6+Yef5whVY1E9EmM2u
 /6Io8iaMxG2UlZzQuSG5Zo9yK+z88s+3Q3E2JhIQcKC4NTJjHZPq0jThkAoQg4x/xQ3p
 AVZA==
X-Gm-Message-State: AOAM533VcHTp674SQF9NGzChNVI4plJPF7AlylFvIcIBy5W38pCFmzQJ
 04Z715XTR3jc6rhemvIwj9xWEVCTD8lZGRpM
X-Google-Smtp-Source: ABdhPJwb1srE61RQrgeCbJO2ZU0Hri/NPq8TLZEHtmQEdkQpUeTbudhLIlI6H1MTzcH4vFJipHM18Q==
X-Received: by 2002:adf:df91:: with SMTP id z17mr5138518wrl.379.1602230412191; 
 Fri, 09 Oct 2020 01:00:12 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id u17sm11634118wri.45.2020.10.09.01.00.10
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 09 Oct 2020 01:00:11 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH v2 14/17] resource: Move devmem revoke code to resource
 framework
Date: Fri,  9 Oct 2020 09:59:31 +0200
Message-Id: <20201009075934.3509076-15-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20201009075934.3509076-1-daniel.vetter@ffwll.ch>
References: <20201009075934.3509076-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-s390@vger.kernel.org, linux-samsung-soc@vger.kernel.org,
 Jan Kara <jack@suse.cz>, Kees Cook <keescook@chromium.org>,
 kvm@vger.kernel.org, Jason Gunthorpe <jgg@ziepe.ca>,
 Daniel Vetter <daniel.vetter@ffwll.ch>, David Hildenbrand <david@redhat.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 "Rafael J. Wysocki" <rafael.j.wysocki@intel.com>, linux-mm@kvack.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Arnd Bergmann <arnd@arndb.de>, John Hubbard <jhubbard@nvidia.com>,
 Daniel Vetter <daniel.vetter@intel.com>,
 Dan Williams <dan.j.williams@intel.com>,
 Andrew Morton <akpm@linux-foundation.org>,
 linux-arm-kernel@lists.infradead.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2Ugd2FudCBhbGwgaW9tZW0gbW1hcHMgdG8gY29uc2lzdGVudGx5IHJldm9rZSBwdGVzIHdoZW4g
dGhlIGtlcm5lbAp0YWtlcyBvdmVyIGFuZCBDT05GSUdfSU9fU1RSSUNUX0RFVk1FTSBpcyBlbmFi
bGVkLiBUaGlzIGluY2x1ZGVzIHRoZQpwY2kgYmFyIG1tYXBzIGF2YWlsYWJsZSB0aHJvdWdoIHBy
b2NmcyBhbmQgc3lzZnMsIHdoaWNoIGN1cnJlbnRseSBkbwpub3QgcmV2b2tlIG1hcHBpbmdzLgoK
VG8gcHJlcGFyZSBmb3IgdGhpcywgbW92ZSB0aGUgY29kZSBmcm9tIHRoZSAvZGV2L2ttZW0gZHJp
dmVyIHRvCmtlcm5lbC9yZXNvdXJjZS5jLgoKU2lnbmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8
ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBKYXNvbiBHdW50aG9ycGUgPGpnZ0B6aWVwZS5j
YT4KQ2M6IEtlZXMgQ29vayA8a2Vlc2Nvb2tAY2hyb21pdW0ub3JnPgpDYzogRGFuIFdpbGxpYW1z
IDxkYW4uai53aWxsaWFtc0BpbnRlbC5jb20+CkNjOiBBbmRyZXcgTW9ydG9uIDxha3BtQGxpbnV4
LWZvdW5kYXRpb24ub3JnPgpDYzogSm9obiBIdWJiYXJkIDxqaHViYmFyZEBudmlkaWEuY29tPgpD
YzogSsOpcsO0bWUgR2xpc3NlIDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiBKYW4gS2FyYSA8amFj
a0BzdXNlLmN6PgpDYzogRGFuIFdpbGxpYW1zIDxkYW4uai53aWxsaWFtc0BpbnRlbC5jb20+CkNj
OiBsaW51eC1tbUBrdmFjay5vcmcKQ2M6IGxpbnV4LWFybS1rZXJuZWxAbGlzdHMuaW5mcmFkZWFk
Lm9yZwpDYzogbGludXgtc2Ftc3VuZy1zb2NAdmdlci5rZXJuZWwub3JnCkNjOiBsaW51eC1tZWRp
YUB2Z2VyLmtlcm5lbC5vcmcKQ2M6IEFybmQgQmVyZ21hbm4gPGFybmRAYXJuZGIuZGU+CkNjOiBH
cmVnIEtyb2FoLUhhcnRtYW4gPGdyZWdraEBsaW51eGZvdW5kYXRpb24ub3JnPgpDYzogRGFuaWVs
IFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KQ2M6IERhdmlkIEhpbGRlbmJyYW5kIDxk
YXZpZEByZWRoYXQuY29tPgpDYzogIlJhZmFlbCBKLiBXeXNvY2tpIiA8cmFmYWVsLmoud3lzb2Nr
aUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9jaGFyL21lbS5jICAgICB8IDg1ICstLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvbGludXgvaW9wb3J0LmggfCAgNiAr
LS0KIGtlcm5lbC9yZXNvdXJjZS5jICAgICAgfCA5NSArKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKy0KIDMgZmlsZXMgY2hhbmdlZCwgOTYgaW5zZXJ0aW9ucygrKSwgOTAg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL21lbS5jIGIvZHJpdmVycy9j
aGFyL21lbS5jCmluZGV4IDU1MDJmNTZmMzY1NS4uNTMzMzhhYWQ4ZDI4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2NoYXIvbWVtLmMKKysrIGIvZHJpdmVycy9jaGFyL21lbS5jCkBAIC0zMSw5ICszMSw2
IEBACiAjaW5jbHVkZSA8bGludXgvdWlvLmg+CiAjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgog
I2luY2x1ZGUgPGxpbnV4L3NlY3VyaXR5Lmg+Ci0jaW5jbHVkZSA8bGludXgvcHNldWRvX2ZzLmg+
Ci0jaW5jbHVkZSA8dWFwaS9saW51eC9tYWdpYy5oPgotI2luY2x1ZGUgPGxpbnV4L21vdW50Lmg+
CiAKICNpZmRlZiBDT05GSUdfSUE2NAogIyBpbmNsdWRlIDxsaW51eC9lZmkuaD4KQEAgLTgwOSw0
MiArODA2LDYgQEAgc3RhdGljIGxvZmZfdCBtZW1vcnlfbHNlZWsoc3RydWN0IGZpbGUgKmZpbGUs
IGxvZmZfdCBvZmZzZXQsIGludCBvcmlnKQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBzdHJ1
Y3QgaW5vZGUgKmRldm1lbV9pbm9kZTsKLQotI2lmZGVmIENPTkZJR19JT19TVFJJQ1RfREVWTUVN
Ci12b2lkIHJldm9rZV9kZXZtZW0oc3RydWN0IHJlc291cmNlICpyZXMpCi17Ci0JLyogcGFpcnMg
d2l0aCBzbXBfc3RvcmVfcmVsZWFzZSgpIGluIGRldm1lbV9pbml0X2lub2RlKCkgKi8KLQlzdHJ1
Y3QgaW5vZGUgKmlub2RlID0gc21wX2xvYWRfYWNxdWlyZSgmZGV2bWVtX2lub2RlKTsKLQotCS8q
Ci0JICogQ2hlY2sgdGhhdCB0aGUgaW5pdGlhbGl6YXRpb24gaGFzIGNvbXBsZXRlZC4gTG9zaW5n
IHRoZSByYWNlCi0JICogaXMgb2sgYmVjYXVzZSBpdCBtZWFucyBkcml2ZXJzIGFyZSBjbGFpbWlu
ZyByZXNvdXJjZXMgYmVmb3JlCi0JICogdGhlIGZzX2luaXRjYWxsIGxldmVsIG9mIGluaXQgYW5k
IHByZXZlbnQgL2Rldi9tZW0gZnJvbQotCSAqIGVzdGFibGlzaGluZyBtYXBwaW5ncy4KLQkgKi8K
LQlpZiAoIWlub2RlKQotCQlyZXR1cm47Ci0KLQkvKgotCSAqIFRoZSBleHBlY3RhdGlvbiBpcyB0
aGF0IHRoZSBkcml2ZXIgaGFzIHN1Y2Nlc3NmdWxseSBtYXJrZWQKLQkgKiB0aGUgcmVzb3VyY2Ug
YnVzeSBieSB0aGlzIHBvaW50LCBzbyBkZXZtZW1faXNfYWxsb3dlZCgpCi0JICogc2hvdWxkIHN0
YXJ0IHJldHVybmluZyBmYWxzZSwgaG93ZXZlciBmb3IgcGVyZm9ybWFuY2UgdGhpcwotCSAqIGRv
ZXMgbm90IGl0ZXJhdGUgdGhlIGVudGlyZSByZXNvdXJjZSByYW5nZS4KLQkgKi8KLQlpZiAoZGV2
bWVtX2lzX2FsbG93ZWQoUEhZU19QRk4ocmVzLT5zdGFydCkpICYmCi0JICAgIGRldm1lbV9pc19h
bGxvd2VkKFBIWVNfUEZOKHJlcy0+ZW5kKSkpIHsKLQkJLyoKLQkJICogKmNyaW5nZSogaW9tZW09
cmVsYXhlZCBzYXlzICJnbyBhaGVhZCwgd2hhdCdzIHRoZQotCQkgKiB3b3JzdCB0aGF0IGNhbiBo
YXBwZW4/IgotCQkgKi8KLQkJcmV0dXJuOwotCX0KLQotCXVubWFwX21hcHBpbmdfcmFuZ2UoaW5v
ZGUtPmlfbWFwcGluZywgcmVzLT5zdGFydCwgcmVzb3VyY2Vfc2l6ZShyZXMpLCAxKTsKLX0KLSNl
bmRpZgotCiBzdGF0aWMgaW50IG9wZW5fcG9ydChzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3Qg
ZmlsZSAqZmlscCkKIHsKIAlpbnQgcmM7CkBAIC04NjQsNyArODI1LDcgQEAgc3RhdGljIGludCBv
cGVuX3BvcnQoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbHApCiAJICogcmV2
b2NhdGlvbnMgd2hlbiBkcml2ZXJzIHdhbnQgdG8gdGFrZSBvdmVyIGEgL2Rldi9tZW0gbWFwcGVk
CiAJICogcmFuZ2UuCiAJICovCi0JZmlscC0+Zl9tYXBwaW5nID0gaW5vZGUtPmlfbWFwcGluZzsK
KwlmaWxwLT5mX21hcHBpbmcgPSBpb21lbV9nZXRfbWFwcGluZygpOwogCiAJcmV0dXJuIDA7CiB9
CkBAIC05OTUsNDggKzk1Niw2IEBAIHN0YXRpYyBjaGFyICptZW1fZGV2bm9kZShzdHJ1Y3QgZGV2
aWNlICpkZXYsIHVtb2RlX3QgKm1vZGUpCiAKIHN0YXRpYyBzdHJ1Y3QgY2xhc3MgKm1lbV9jbGFz
czsKIAotc3RhdGljIGludCBkZXZtZW1fZnNfaW5pdF9mc19jb250ZXh0KHN0cnVjdCBmc19jb250
ZXh0ICpmYykKLXsKLQlyZXR1cm4gaW5pdF9wc2V1ZG8oZmMsIERFVk1FTV9NQUdJQykgPyAwIDog
LUVOT01FTTsKLX0KLQotc3RhdGljIHN0cnVjdCBmaWxlX3N5c3RlbV90eXBlIGRldm1lbV9mc190
eXBlID0gewotCS5uYW1lCQk9ICJkZXZtZW0iLAotCS5vd25lcgkJPSBUSElTX01PRFVMRSwKLQku
aW5pdF9mc19jb250ZXh0ID0gZGV2bWVtX2ZzX2luaXRfZnNfY29udGV4dCwKLQkua2lsbF9zYgk9
IGtpbGxfYW5vbl9zdXBlciwKLX07Ci0KLXN0YXRpYyBpbnQgZGV2bWVtX2luaXRfaW5vZGUodm9p
ZCkKLXsKLQlzdGF0aWMgc3RydWN0IHZmc21vdW50ICpkZXZtZW1fdmZzX21vdW50OwotCXN0YXRp
YyBpbnQgZGV2bWVtX2ZzX2NudDsKLQlzdHJ1Y3QgaW5vZGUgKmlub2RlOwotCWludCByYzsKLQot
CXJjID0gc2ltcGxlX3Bpbl9mcygmZGV2bWVtX2ZzX3R5cGUsICZkZXZtZW1fdmZzX21vdW50LCAm
ZGV2bWVtX2ZzX2NudCk7Ci0JaWYgKHJjIDwgMCkgewotCQlwcl9lcnIoIkNhbm5vdCBtb3VudCAv
ZGV2L21lbSBwc2V1ZG8gZmlsZXN5c3RlbTogJWRcbiIsIHJjKTsKLQkJcmV0dXJuIHJjOwotCX0K
LQotCWlub2RlID0gYWxsb2NfYW5vbl9pbm9kZShkZXZtZW1fdmZzX21vdW50LT5tbnRfc2IpOwot
CWlmIChJU19FUlIoaW5vZGUpKSB7Ci0JCXJjID0gUFRSX0VSUihpbm9kZSk7Ci0JCXByX2Vycigi
Q2Fubm90IGFsbG9jYXRlIGlub2RlIGZvciAvZGV2L21lbTogJWRcbiIsIHJjKTsKLQkJc2ltcGxl
X3JlbGVhc2VfZnMoJmRldm1lbV92ZnNfbW91bnQsICZkZXZtZW1fZnNfY250KTsKLQkJcmV0dXJu
IHJjOwotCX0KLQotCS8qCi0JICogUHVibGlzaCAvZGV2L21lbSBpbml0aWFsaXplZC4KLQkgKiBQ
YWlycyB3aXRoIHNtcF9sb2FkX2FjcXVpcmUoKSBpbiByZXZva2VfZGV2bWVtKCkuCi0JICovCi0J
c21wX3N0b3JlX3JlbGVhc2UoJmRldm1lbV9pbm9kZSwgaW5vZGUpOwotCi0JcmV0dXJuIDA7Ci19
Ci0KIHN0YXRpYyBpbnQgX19pbml0IGNocl9kZXZfaW5pdCh2b2lkKQogewogCWludCBtaW5vcjsK
QEAgLTEwNTgsOCArOTc3LDYgQEAgc3RhdGljIGludCBfX2luaXQgY2hyX2Rldl9pbml0KHZvaWQp
CiAJCSAqLwogCQlpZiAoKG1pbm9yID09IERFVlBPUlRfTUlOT1IpICYmICFhcmNoX2hhc19kZXZf
cG9ydCgpKQogCQkJY29udGludWU7Ci0JCWlmICgobWlub3IgPT0gREVWTUVNX01JTk9SKSAmJiBk
ZXZtZW1faW5pdF9pbm9kZSgpICE9IDApCi0JCQljb250aW51ZTsKIAogCQlkZXZpY2VfY3JlYXRl
KG1lbV9jbGFzcywgTlVMTCwgTUtERVYoTUVNX01BSk9SLCBtaW5vciksCiAJCQkgICAgICBOVUxM
LCBkZXZsaXN0W21pbm9yXS5uYW1lKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvaW9wb3J0
LmggYi9pbmNsdWRlL2xpbnV4L2lvcG9ydC5oCmluZGV4IDZjMmIwNmZlOGJlYi4uOGZmYjYxYjM2
NjA2IDEwMDY0NAotLS0gYS9pbmNsdWRlL2xpbnV4L2lvcG9ydC5oCisrKyBiL2luY2x1ZGUvbGlu
dXgvaW9wb3J0LmgKQEAgLTMwMiwxMSArMzAyLDcgQEAgc3RydWN0IHJlc291cmNlICpkZXZtX3Jl
cXVlc3RfZnJlZV9tZW1fcmVnaW9uKHN0cnVjdCBkZXZpY2UgKmRldiwKIHN0cnVjdCByZXNvdXJj
ZSAqcmVxdWVzdF9mcmVlX21lbV9yZWdpb24oc3RydWN0IHJlc291cmNlICpiYXNlLAogCQl1bnNp
Z25lZCBsb25nIHNpemUsIGNvbnN0IGNoYXIgKm5hbWUpOwogCi0jaWZkZWYgQ09ORklHX0lPX1NU
UklDVF9ERVZNRU0KLXZvaWQgcmV2b2tlX2Rldm1lbShzdHJ1Y3QgcmVzb3VyY2UgKnJlcyk7Ci0j
ZWxzZQotc3RhdGljIGlubGluZSB2b2lkIHJldm9rZV9kZXZtZW0oc3RydWN0IHJlc291cmNlICpy
ZXMpIHsgfTsKLSNlbmRpZgorZXh0ZXJuIHN0cnVjdCBhZGRyZXNzX3NwYWNlICppb21lbV9nZXRf
bWFwcGluZyh2b2lkKTsKIAogI2VuZGlmIC8qIF9fQVNTRU1CTFlfXyAqLwogI2VuZGlmCS8qIF9M
SU5VWF9JT1BPUlRfSCAqLwpkaWZmIC0tZ2l0IGEva2VybmVsL3Jlc291cmNlLmMgYi9rZXJuZWwv
cmVzb3VyY2UuYwppbmRleCA4NDE3MzdiYmRhOWUuLjIyMTUzZmRlYzRmNSAxMDA2NDQKLS0tIGEv
a2VybmVsL3Jlc291cmNlLmMKKysrIGIva2VybmVsL3Jlc291cmNlLmMKQEAgLTE4LDEyICsxOCwx
NSBAQAogI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8bGludXgvZnMuaD4K
ICNpbmNsdWRlIDxsaW51eC9wcm9jX2ZzLmg+CisjaW5jbHVkZSA8bGludXgvcHNldWRvX2ZzLmg+
CiAjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KICNpbmNsdWRlIDxsaW51eC9zZXFfZmlsZS5oPgog
I2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgogI2luY2x1ZGUgPGxpbnV4L3Bmbi5oPgogI2luY2x1
ZGUgPGxpbnV4L21tLmg+CisjaW5jbHVkZSA8bGludXgvbW91bnQuaD4KICNpbmNsdWRlIDxsaW51
eC9yZXNvdXJjZV9leHQuaD4KKyNpbmNsdWRlIDx1YXBpL2xpbnV4L21hZ2ljLmg+CiAjaW5jbHVk
ZSA8YXNtL2lvLmg+CiAKIApAQCAtMTExMiw2ICsxMTE1LDUyIEBAIHJlc291cmNlX3NpemVfdCBy
ZXNvdXJjZV9hbGlnbm1lbnQoc3RydWN0IHJlc291cmNlICpyZXMpCiAKIHN0YXRpYyBERUNMQVJF
X1dBSVRfUVVFVUVfSEVBRChtdXhlZF9yZXNvdXJjZV93YWl0KTsKIAorc3RhdGljIHN0cnVjdCBp
bm9kZSAqaW9tZW1faW5vZGU7CisKKyNpZmRlZiBDT05GSUdfSU9fU1RSSUNUX0RFVk1FTQorc3Rh
dGljIHZvaWQgcmV2b2tlX2lvbWVtKHN0cnVjdCByZXNvdXJjZSAqcmVzKQoreworCS8qIHBhaXJz
IHdpdGggc21wX3N0b3JlX3JlbGVhc2UoKSBpbiBpb21lbV9pbml0X2lub2RlKCkgKi8KKwlzdHJ1
Y3QgaW5vZGUgKmlub2RlID0gc21wX2xvYWRfYWNxdWlyZSgmaW9tZW1faW5vZGUpOworCisJLyoK
KwkgKiBDaGVjayB0aGF0IHRoZSBpbml0aWFsaXphdGlvbiBoYXMgY29tcGxldGVkLiBMb3Npbmcg
dGhlIHJhY2UKKwkgKiBpcyBvayBiZWNhdXNlIGl0IG1lYW5zIGRyaXZlcnMgYXJlIGNsYWltaW5n
IHJlc291cmNlcyBiZWZvcmUKKwkgKiB0aGUgZnNfaW5pdGNhbGwgbGV2ZWwgb2YgaW5pdCBhbmQg
cHJldmVudCAvZGV2L21lbSBmcm9tCisJICogZXN0YWJsaXNoaW5nIG1hcHBpbmdzLgorCSAqLwor
CWlmICghaW5vZGUpCisJCXJldHVybjsKKworCS8qCisJICogVGhlIGV4cGVjdGF0aW9uIGlzIHRo
YXQgdGhlIGRyaXZlciBoYXMgc3VjY2Vzc2Z1bGx5IG1hcmtlZAorCSAqIHRoZSByZXNvdXJjZSBi
dXN5IGJ5IHRoaXMgcG9pbnQsIHNvIGRldm1lbV9pc19hbGxvd2VkKCkKKwkgKiBzaG91bGQgc3Rh
cnQgcmV0dXJuaW5nIGZhbHNlLCBob3dldmVyIGZvciBwZXJmb3JtYW5jZSB0aGlzCisJICogZG9l
cyBub3QgaXRlcmF0ZSB0aGUgZW50aXJlIHJlc291cmNlIHJhbmdlLgorCSAqLworCWlmIChkZXZt
ZW1faXNfYWxsb3dlZChQSFlTX1BGTihyZXMtPnN0YXJ0KSkgJiYKKwkgICAgZGV2bWVtX2lzX2Fs
bG93ZWQoUEhZU19QRk4ocmVzLT5lbmQpKSkgeworCQkvKgorCQkgKiAqY3JpbmdlKiBpb21lbT1y
ZWxheGVkIHNheXMgImdvIGFoZWFkLCB3aGF0J3MgdGhlCisJCSAqIHdvcnN0IHRoYXQgY2FuIGhh
cHBlbj8iCisJCSAqLworCQlyZXR1cm47CisJfQorCisJdW5tYXBfbWFwcGluZ19yYW5nZShpbm9k
ZS0+aV9tYXBwaW5nLCByZXMtPnN0YXJ0LCByZXNvdXJjZV9zaXplKHJlcyksIDEpOworfQorc3Ry
dWN0IGFkZHJlc3Nfc3BhY2UgKmlvbWVtX2dldF9tYXBwaW5nKHZvaWQpCit7CisJcmV0dXJuIGlv
bWVtX2lub2RlLT5pX21hcHBpbmc7Cit9CisjZWxzZQorc3RhdGljIHZvaWQgcmV2b2tlX2lvbWVt
KHN0cnVjdCByZXNvdXJjZSAqcmVzKSB7fQorc3RydWN0IGFkZHJlc3Nfc3BhY2UgKmlvbWVtX2dl
dF9tYXBwaW5nKHZvaWQpCit7CisJcmV0dXJuIE5VTEw7Cit9CisjZW5kaWYKKwogLyoqCiAgKiBf
X3JlcXVlc3RfcmVnaW9uIC0gY3JlYXRlIGEgbmV3IGJ1c3kgcmVzb3VyY2UgcmVnaW9uCiAgKiBA
cGFyZW50OiBwYXJlbnQgcmVzb3VyY2UgZGVzY3JpcHRvcgpAQCAtMTE3OSw3ICsxMjI4LDcgQEAg
c3RydWN0IHJlc291cmNlICogX19yZXF1ZXN0X3JlZ2lvbihzdHJ1Y3QgcmVzb3VyY2UgKnBhcmVu
dCwKIAl3cml0ZV91bmxvY2soJnJlc291cmNlX2xvY2spOwogCiAJaWYgKHJlcyAmJiBvcmlnX3Bh
cmVudCA9PSAmaW9tZW1fcmVzb3VyY2UpCi0JCXJldm9rZV9kZXZtZW0ocmVzKTsKKwkJcmV2b2tl
X2lvbWVtKHJlcyk7CiAKIAlyZXR1cm4gcmVzOwogfQpAQCAtMTcxMyw0ICsxNzYyLDQ4IEBAIHN0
YXRpYyBpbnQgX19pbml0IHN0cmljdF9pb21lbShjaGFyICpzdHIpCiAJcmV0dXJuIDE7CiB9CiAK
K3N0YXRpYyBpbnQgaW9tZW1fZnNfaW5pdF9mc19jb250ZXh0KHN0cnVjdCBmc19jb250ZXh0ICpm
YykKK3sKKwlyZXR1cm4gaW5pdF9wc2V1ZG8oZmMsIERFVk1FTV9NQUdJQykgPyAwIDogLUVOT01F
TTsKK30KKworc3RhdGljIHN0cnVjdCBmaWxlX3N5c3RlbV90eXBlIGlvbWVtX2ZzX3R5cGUgPSB7
CisJLm5hbWUJCT0gImlvbWVtIiwKKwkub3duZXIJCT0gVEhJU19NT0RVTEUsCisJLmluaXRfZnNf
Y29udGV4dCA9IGlvbWVtX2ZzX2luaXRfZnNfY29udGV4dCwKKwkua2lsbF9zYgk9IGtpbGxfYW5v
bl9zdXBlciwKK307CisKK3N0YXRpYyBpbnQgX19pbml0IGlvbWVtX2luaXRfaW5vZGUodm9pZCkK
K3sKKwlzdGF0aWMgc3RydWN0IHZmc21vdW50ICppb21lbV92ZnNfbW91bnQ7CisJc3RhdGljIGlu
dCBpb21lbV9mc19jbnQ7CisJc3RydWN0IGlub2RlICppbm9kZTsKKwlpbnQgcmM7CisKKwlyYyA9
IHNpbXBsZV9waW5fZnMoJmlvbWVtX2ZzX3R5cGUsICZpb21lbV92ZnNfbW91bnQsICZpb21lbV9m
c19jbnQpOworCWlmIChyYyA8IDApIHsKKwkJcHJfZXJyKCJDYW5ub3QgbW91bnQgaW9tZW0gcHNl
dWRvIGZpbGVzeXN0ZW06ICVkXG4iLCByYyk7CisJCXJldHVybiByYzsKKwl9CisKKwlpbm9kZSA9
IGFsbG9jX2Fub25faW5vZGUoaW9tZW1fdmZzX21vdW50LT5tbnRfc2IpOworCWlmIChJU19FUlIo
aW5vZGUpKSB7CisJCXJjID0gUFRSX0VSUihpbm9kZSk7CisJCXByX2VycigiQ2Fubm90IGFsbG9j
YXRlIGlub2RlIGZvciBpb21lbTogJWRcbiIsIHJjKTsKKwkJc2ltcGxlX3JlbGVhc2VfZnMoJmlv
bWVtX3Zmc19tb3VudCwgJmlvbWVtX2ZzX2NudCk7CisJCXJldHVybiByYzsKKwl9CisKKwkvKgor
CSAqIFB1Ymxpc2ggL2Rldi9tZW0gaW5pdGlhbGl6ZWQuCisJICogUGFpcnMgd2l0aCBzbXBfbG9h
ZF9hY3F1aXJlKCkgaW4gcmV2b2tlX2lvbWVtKCkuCisJICovCisJc21wX3N0b3JlX3JlbGVhc2Uo
JmlvbWVtX2lub2RlLCBpbm9kZSk7CisKKwlyZXR1cm4gMDsKK30KKworZnNfaW5pdGNhbGwoaW9t
ZW1faW5pdF9pbm9kZSk7CisKIF9fc2V0dXAoImlvbWVtPSIsIHN0cmljdF9pb21lbSk7Ci0tIAoy
LjI4LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRy
aS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
