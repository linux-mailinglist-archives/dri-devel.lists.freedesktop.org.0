Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B47352C6991
	for <lists+dri-devel@lfdr.de>; Fri, 27 Nov 2020 17:42:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 33B136EE5C;
	Fri, 27 Nov 2020 16:42:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 91C106EE59
 for <dri-devel@lists.freedesktop.org>; Fri, 27 Nov 2020 16:42:12 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id u12so6231561wrt.0
 for <dri-devel@lists.freedesktop.org>; Fri, 27 Nov 2020 08:42:12 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=0DCehF4zZ3fhQRejLB/8aYMpRa95wWTeDCqZJ49ug5U=;
 b=cXE7uopdJpDCC9ukasYE1MZhOpMvCDOw8aBOn4lVUiCtBUjjkQL4YQNkQU2GdEP+/f
 jKBNeBqyAeQdG9N2dLlqXY4tEG589CDZGtcv2LVit7mRQ+I4Fqyl8yl5HVnX0YnuUkJI
 7vE4dDro3l523HNgaAbD76h80zfpoLzldEFFM=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=0DCehF4zZ3fhQRejLB/8aYMpRa95wWTeDCqZJ49ug5U=;
 b=SwZpYSHBrfFOCXdCrwVJ+wj7FcpjbJsAuKMFOJn7PKlKPd62lSC2yVOaJ99qRVB//M
 e/+ZG666ZSk2lDdJF9dOtt7dg+NsNsykwkbIC640LFVGrTclOQXocTQrTdHj646OA5kn
 T2LP/qisowR9yeikUmewv16J0DX7NKQqL62xEhK3EHwKYn20Q8srg8OcNIBekPVYI52v
 knmI2FJRJjQ7eWN6Ne0th+ZvvJaTRra74x4hYDOfTX2e3NCEABgDgOFn6+ZJ7kCe5LvH
 VwcMHENcLitFC6uKV3piZJzofC7eitQ62G20STNVcmhFpwuXN7h05fgABIg1W6o+2qZN
 P7Lg==
X-Gm-Message-State: AOAM532r+EaJfbwVYIqMsdG/LUJGOz65KNC922Ft3XVDdxELlJ96sdNU
 4QmD2+5Gw+uVhoaH6ZyOikVV4KDkQ10ycw==
X-Google-Smtp-Source: ABdhPJwA6BKMRNSm//OZD0UDzoMNQD9CPizJ1Nvwa3DXYtenMXckQ1xp0BcV//DS0aC8S+EGVtYc6Q==
X-Received: by 2002:adf:c147:: with SMTP id w7mr11889034wre.60.1606495330973; 
 Fri, 27 Nov 2020 08:42:10 -0800 (PST)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id q12sm14859078wrx.86.2020.11.27.08.42.09
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 27 Nov 2020 08:42:10 -0800 (PST)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH v7 10/17] resource: Move devmem revoke code to resource
 framework
Date: Fri, 27 Nov 2020 17:41:24 +0100
Message-Id: <20201127164131.2244124-11-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.29.2
In-Reply-To: <20201127164131.2244124-1-daniel.vetter@ffwll.ch>
References: <20201127164131.2244124-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-samsung-soc@vger.kernel.org, Jan Kara <jack@suse.cz>,
 Kees Cook <keescook@chromium.org>, kvm@vger.kernel.org,
 Jason Gunthorpe <jgg@ziepe.ca>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 David Hildenbrand <david@redhat.com>,
 "Rafael J. Wysocki" <rafael.j.wysocki@intel.com>, linux-mm@kvack.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Arnd Bergmann <arnd@arndb.de>, John Hubbard <jhubbard@nvidia.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Daniel Vetter <daniel.vetter@intel.com>,
 Dan Williams <dan.j.williams@intel.com>,
 Andrew Morton <akpm@linux-foundation.org>,
 linux-arm-kernel@lists.infradead.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2Ugd2FudCBhbGwgaW9tZW0gbW1hcHMgdG8gY29uc2lzdGVudGx5IHJldm9rZSBwdGVzIHdoZW4g
dGhlIGtlcm5lbAp0YWtlcyBvdmVyIGFuZCBDT05GSUdfSU9fU1RSSUNUX0RFVk1FTSBpcyBlbmFi
bGVkLiBUaGlzIGluY2x1ZGVzIHRoZQpwY2kgYmFyIG1tYXBzIGF2YWlsYWJsZSB0aHJvdWdoIHBy
b2NmcyBhbmQgc3lzZnMsIHdoaWNoIGN1cnJlbnRseSBkbwpub3QgcmV2b2tlIG1hcHBpbmdzLgoK
VG8gcHJlcGFyZSBmb3IgdGhpcywgbW92ZSB0aGUgY29kZSBmcm9tIHRoZSAvZGV2L2ttZW0gZHJp
dmVyIHRvCmtlcm5lbC9yZXNvdXJjZS5jLgoKRHVyaW5nIHJldmlldyBKYXNvbiBzcG90dGVkIHRo
YXQgYmFycmllcnMgYXJlIHVzZWQgc29tZXdoYXQKaW5jb25zaXN0ZW50bHkuIEZpeCB0aGF0IHVw
IHdoaWxlIHdlIHNodWZmbGUgdGhpcyBjb2RlLCBzaW5jZSBpdApkb2Vzbid0IGhhdmUgYW4gYWN0
dWFsIGltcGFjdCBhdCBydW50aW1lLiBPdGhlcndpc2Ugbm8gc2VtYW50aWMgYW5kCmJlaGF2aW91
cmFsIGNoYW5nZXMgaW50ZW5kZWQsIGp1c3QgY29kZSBleHRyYWN0aW9uIGFuZCBhZGp1c3RpbmcK
Y29tbWVudHMgYW5kIG5hbWVzLgoKUmV2aWV3ZWQtYnk6IEdyZWcgS3JvYWgtSGFydG1hbiA8Z3Jl
Z2toQGxpbnV4Zm91bmRhdGlvbi5vcmc+ClNpZ25lZC1vZmYtYnk6IERhbmllbCBWZXR0ZXIgPGRh
bmllbC52ZXR0ZXJAaW50ZWwuY29tPgpDYzogSmFzb24gR3VudGhvcnBlIDxqZ2dAemllcGUuY2E+
CkNjOiBLZWVzIENvb2sgPGtlZXNjb29rQGNocm9taXVtLm9yZz4KQ2M6IERhbiBXaWxsaWFtcyA8
ZGFuLmoud2lsbGlhbXNAaW50ZWwuY29tPgpDYzogQW5kcmV3IE1vcnRvbiA8YWtwbUBsaW51eC1m
b3VuZGF0aW9uLm9yZz4KQ2M6IEpvaG4gSHViYmFyZCA8amh1YmJhcmRAbnZpZGlhLmNvbT4KQ2M6
IErDqXLDtG1lIEdsaXNzZSA8amdsaXNzZUByZWRoYXQuY29tPgpDYzogSmFuIEthcmEgPGphY2tA
c3VzZS5jej4KQ2M6IERhbiBXaWxsaWFtcyA8ZGFuLmoud2lsbGlhbXNAaW50ZWwuY29tPgpDYzog
bGludXgtbW1Aa3ZhY2sub3JnCkNjOiBsaW51eC1hcm0ta2VybmVsQGxpc3RzLmluZnJhZGVhZC5v
cmcKQ2M6IGxpbnV4LXNhbXN1bmctc29jQHZnZXIua2VybmVsLm9yZwpDYzogbGludXgtbWVkaWFA
dmdlci5rZXJuZWwub3JnCkNjOiBBcm5kIEJlcmdtYW5uIDxhcm5kQGFybmRiLmRlPgpDYzogR3Jl
ZyBLcm9haC1IYXJ0bWFuIDxncmVna2hAbGludXhmb3VuZGF0aW9uLm9yZz4KQ2M6IERhbmllbCBW
ZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkNjOiBEYXZpZCBIaWxkZW5icmFuZCA8ZGF2
aWRAcmVkaGF0LmNvbT4KQ2M6ICJSYWZhZWwgSi4gV3lzb2NraSIgPHJhZmFlbC5qLnd5c29ja2lA
aW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZm
d2xsLmNoPgotLQp2MzoKLSBhZGQgYmFycmllciBmb3IgY29uc2lzdGVuY3kgYW5kIGRvY3VtZW50
IHdoeSB3ZSBkb24ndCBoYXZlIHRvIGNoZWNrCiAgZm9yIE5VTEwgKEphc29uKQp2NAotIEFkanVz
dCBjb21tZW50cyB0byByZWZsZWN0IHRoZSBnZW5lcmFsIG5hdHVyZSBvZiB0aGlzIGlvbWVtIHJl
dm9rZQogIGNvZGUgbm93IChEYW4pCnY2OgotIEFuIHVuaW50ZW50aW9uYWwgY2hhbmdlIHdoaWNo
IGNhdXNlZCBzaWRlLWVmZmVjdHMgb2YgdGhpcwogIHJlZmFjdG9yaW5nIGlzIHRoYXQgaW9tZW1f
Z2V0X21hcHBpbmcgcmV0dXJuZWQgTlVMTCBmb3IKICAhQ09ORklHX0lPX1NUUklDVF9ERVZNRU0u
IEJ1dCB0aGF0IG1ha2VzIGNvcmUgdmZzIGNvZGUgYmxvdyB1cCwKICB3aGljaCBhc3N1bWVzIGEg
bWFwcGluZyBhbHdheXMgZXhpc3RzLiBVbmRvIHRoYXQgYWNjaWRlbnRpb25hbAogIGNoYW5nZS4g
UmVwb3J0ZWQgYnkgSm9obi4KLSBBdWdtZW50IHRoZSBjb21taXQgbWVzc2FnZSB0byBleHBsYWlu
IHdoYXQgYWN0dWFsbHkgY2hhbmdlZCB3aXRoCiAgdGhpcyBleHRyYWN0aW9uIChhbHNvIEpvaG4p
LgotLS0KIGRyaXZlcnMvY2hhci9tZW0uYyAgICAgfCA4NSArLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvbGludXgvaW9wb3J0LmggfCAgNiArLS0KIGtlcm5lbC9y
ZXNvdXJjZS5jICAgICAgfCA5OCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKy0KIDMgZmlsZXMgY2hhbmdlZCwgOTkgaW5zZXJ0aW9ucygrKSwgOTAgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9jaGFyL21lbS5jIGIvZHJpdmVycy9jaGFyL21lbS5jCmlu
ZGV4IDdkY2Y5ZTRlYTc5ZC4uNDNjODcxZGM3NDc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2NoYXIv
bWVtLmMKKysrIGIvZHJpdmVycy9jaGFyL21lbS5jCkBAIC0zMSw5ICszMSw2IEBACiAjaW5jbHVk
ZSA8bGludXgvdWlvLmg+CiAjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgogI2luY2x1ZGUgPGxp
bnV4L3NlY3VyaXR5Lmg+Ci0jaW5jbHVkZSA8bGludXgvcHNldWRvX2ZzLmg+Ci0jaW5jbHVkZSA8
dWFwaS9saW51eC9tYWdpYy5oPgotI2luY2x1ZGUgPGxpbnV4L21vdW50Lmg+CiAKICNpZmRlZiBD
T05GSUdfSUE2NAogIyBpbmNsdWRlIDxsaW51eC9lZmkuaD4KQEAgLTgzNiw0MiArODMzLDYgQEAg
c3RhdGljIGxvZmZfdCBtZW1vcnlfbHNlZWsoc3RydWN0IGZpbGUgKmZpbGUsIGxvZmZfdCBvZmZz
ZXQsIGludCBvcmlnKQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgaW5vZGUgKmRl
dm1lbV9pbm9kZTsKLQotI2lmZGVmIENPTkZJR19JT19TVFJJQ1RfREVWTUVNCi12b2lkIHJldm9r
ZV9kZXZtZW0oc3RydWN0IHJlc291cmNlICpyZXMpCi17Ci0JLyogcGFpcnMgd2l0aCBzbXBfc3Rv
cmVfcmVsZWFzZSgpIGluIGRldm1lbV9pbml0X2lub2RlKCkgKi8KLQlzdHJ1Y3QgaW5vZGUgKmlu
b2RlID0gc21wX2xvYWRfYWNxdWlyZSgmZGV2bWVtX2lub2RlKTsKLQotCS8qCi0JICogQ2hlY2sg
dGhhdCB0aGUgaW5pdGlhbGl6YXRpb24gaGFzIGNvbXBsZXRlZC4gTG9zaW5nIHRoZSByYWNlCi0J
ICogaXMgb2sgYmVjYXVzZSBpdCBtZWFucyBkcml2ZXJzIGFyZSBjbGFpbWluZyByZXNvdXJjZXMg
YmVmb3JlCi0JICogdGhlIGZzX2luaXRjYWxsIGxldmVsIG9mIGluaXQgYW5kIHByZXZlbnQgL2Rl
di9tZW0gZnJvbQotCSAqIGVzdGFibGlzaGluZyBtYXBwaW5ncy4KLQkgKi8KLQlpZiAoIWlub2Rl
KQotCQlyZXR1cm47Ci0KLQkvKgotCSAqIFRoZSBleHBlY3RhdGlvbiBpcyB0aGF0IHRoZSBkcml2
ZXIgaGFzIHN1Y2Nlc3NmdWxseSBtYXJrZWQKLQkgKiB0aGUgcmVzb3VyY2UgYnVzeSBieSB0aGlz
IHBvaW50LCBzbyBkZXZtZW1faXNfYWxsb3dlZCgpCi0JICogc2hvdWxkIHN0YXJ0IHJldHVybmlu
ZyBmYWxzZSwgaG93ZXZlciBmb3IgcGVyZm9ybWFuY2UgdGhpcwotCSAqIGRvZXMgbm90IGl0ZXJh
dGUgdGhlIGVudGlyZSByZXNvdXJjZSByYW5nZS4KLQkgKi8KLQlpZiAoZGV2bWVtX2lzX2FsbG93
ZWQoUEhZU19QRk4ocmVzLT5zdGFydCkpICYmCi0JICAgIGRldm1lbV9pc19hbGxvd2VkKFBIWVNf
UEZOKHJlcy0+ZW5kKSkpIHsKLQkJLyoKLQkJICogKmNyaW5nZSogaW9tZW09cmVsYXhlZCBzYXlz
ICJnbyBhaGVhZCwgd2hhdCdzIHRoZQotCQkgKiB3b3JzdCB0aGF0IGNhbiBoYXBwZW4/IgotCQkg
Ki8KLQkJcmV0dXJuOwotCX0KLQotCXVubWFwX21hcHBpbmdfcmFuZ2UoaW5vZGUtPmlfbWFwcGlu
ZywgcmVzLT5zdGFydCwgcmVzb3VyY2Vfc2l6ZShyZXMpLCAxKTsKLX0KLSNlbmRpZgotCiBzdGF0
aWMgaW50IG9wZW5fcG9ydChzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlscCkK
IHsKIAlpbnQgcmM7CkBAIC04OTEsNyArODUyLDcgQEAgc3RhdGljIGludCBvcGVuX3BvcnQoc3Ry
dWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbHApCiAJICogcmV2b2NhdGlvbnMgd2hl
biBkcml2ZXJzIHdhbnQgdG8gdGFrZSBvdmVyIGEgL2Rldi9tZW0gbWFwcGVkCiAJICogcmFuZ2Uu
CiAJICovCi0JZmlscC0+Zl9tYXBwaW5nID0gaW5vZGUtPmlfbWFwcGluZzsKKwlmaWxwLT5mX21h
cHBpbmcgPSBpb21lbV9nZXRfbWFwcGluZygpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0xMDIzLDQ4
ICs5ODQsNiBAQCBzdGF0aWMgY2hhciAqbWVtX2Rldm5vZGUoc3RydWN0IGRldmljZSAqZGV2LCB1
bW9kZV90ICptb2RlKQogCiBzdGF0aWMgc3RydWN0IGNsYXNzICptZW1fY2xhc3M7CiAKLXN0YXRp
YyBpbnQgZGV2bWVtX2ZzX2luaXRfZnNfY29udGV4dChzdHJ1Y3QgZnNfY29udGV4dCAqZmMpCi17
Ci0JcmV0dXJuIGluaXRfcHNldWRvKGZjLCBERVZNRU1fTUFHSUMpID8gMCA6IC1FTk9NRU07Ci19
Ci0KLXN0YXRpYyBzdHJ1Y3QgZmlsZV9zeXN0ZW1fdHlwZSBkZXZtZW1fZnNfdHlwZSA9IHsKLQku
bmFtZQkJPSAiZGV2bWVtIiwKLQkub3duZXIJCT0gVEhJU19NT0RVTEUsCi0JLmluaXRfZnNfY29u
dGV4dCA9IGRldm1lbV9mc19pbml0X2ZzX2NvbnRleHQsCi0JLmtpbGxfc2IJPSBraWxsX2Fub25f
c3VwZXIsCi19OwotCi1zdGF0aWMgaW50IGRldm1lbV9pbml0X2lub2RlKHZvaWQpCi17Ci0Jc3Rh
dGljIHN0cnVjdCB2ZnNtb3VudCAqZGV2bWVtX3Zmc19tb3VudDsKLQlzdGF0aWMgaW50IGRldm1l
bV9mc19jbnQ7Ci0Jc3RydWN0IGlub2RlICppbm9kZTsKLQlpbnQgcmM7Ci0KLQlyYyA9IHNpbXBs
ZV9waW5fZnMoJmRldm1lbV9mc190eXBlLCAmZGV2bWVtX3Zmc19tb3VudCwgJmRldm1lbV9mc19j
bnQpOwotCWlmIChyYyA8IDApIHsKLQkJcHJfZXJyKCJDYW5ub3QgbW91bnQgL2Rldi9tZW0gcHNl
dWRvIGZpbGVzeXN0ZW06ICVkXG4iLCByYyk7Ci0JCXJldHVybiByYzsKLQl9Ci0KLQlpbm9kZSA9
IGFsbG9jX2Fub25faW5vZGUoZGV2bWVtX3Zmc19tb3VudC0+bW50X3NiKTsKLQlpZiAoSVNfRVJS
KGlub2RlKSkgewotCQlyYyA9IFBUUl9FUlIoaW5vZGUpOwotCQlwcl9lcnIoIkNhbm5vdCBhbGxv
Y2F0ZSBpbm9kZSBmb3IgL2Rldi9tZW06ICVkXG4iLCByYyk7Ci0JCXNpbXBsZV9yZWxlYXNlX2Zz
KCZkZXZtZW1fdmZzX21vdW50LCAmZGV2bWVtX2ZzX2NudCk7Ci0JCXJldHVybiByYzsKLQl9Ci0K
LQkvKgotCSAqIFB1Ymxpc2ggL2Rldi9tZW0gaW5pdGlhbGl6ZWQuCi0JICogUGFpcnMgd2l0aCBz
bXBfbG9hZF9hY3F1aXJlKCkgaW4gcmV2b2tlX2Rldm1lbSgpLgotCSAqLwotCXNtcF9zdG9yZV9y
ZWxlYXNlKCZkZXZtZW1faW5vZGUsIGlub2RlKTsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMg
aW50IF9faW5pdCBjaHJfZGV2X2luaXQodm9pZCkKIHsKIAlpbnQgbWlub3I7CkBAIC0xMDg2LDgg
KzEwMDUsNiBAQCBzdGF0aWMgaW50IF9faW5pdCBjaHJfZGV2X2luaXQodm9pZCkKIAkJICovCiAJ
CWlmICgobWlub3IgPT0gREVWUE9SVF9NSU5PUikgJiYgIWFyY2hfaGFzX2Rldl9wb3J0KCkpCiAJ
CQljb250aW51ZTsKLQkJaWYgKChtaW5vciA9PSBERVZNRU1fTUlOT1IpICYmIGRldm1lbV9pbml0
X2lub2RlKCkgIT0gMCkKLQkJCWNvbnRpbnVlOwogCiAJCWRldmljZV9jcmVhdGUobWVtX2NsYXNz
LCBOVUxMLCBNS0RFVihNRU1fTUFKT1IsIG1pbm9yKSwKIAkJCSAgICAgIE5VTEwsIGRldmxpc3Rb
bWlub3JdLm5hbWUpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9pb3BvcnQuaCBiL2luY2x1
ZGUvbGludXgvaW9wb3J0LmgKaW5kZXggNTEzNWQ0Yjg2Y2Q2Li4wMmE1NDY2MjQ1YzAgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvbGludXgvaW9wb3J0LmgKKysrIGIvaW5jbHVkZS9saW51eC9pb3BvcnQu
aApAQCAtMzA3LDExICszMDcsNyBAQCBzdHJ1Y3QgcmVzb3VyY2UgKmRldm1fcmVxdWVzdF9mcmVl
X21lbV9yZWdpb24oc3RydWN0IGRldmljZSAqZGV2LAogc3RydWN0IHJlc291cmNlICpyZXF1ZXN0
X2ZyZWVfbWVtX3JlZ2lvbihzdHJ1Y3QgcmVzb3VyY2UgKmJhc2UsCiAJCXVuc2lnbmVkIGxvbmcg
c2l6ZSwgY29uc3QgY2hhciAqbmFtZSk7CiAKLSNpZmRlZiBDT05GSUdfSU9fU1RSSUNUX0RFVk1F
TQotdm9pZCByZXZva2VfZGV2bWVtKHN0cnVjdCByZXNvdXJjZSAqcmVzKTsKLSNlbHNlCi1zdGF0
aWMgaW5saW5lIHZvaWQgcmV2b2tlX2Rldm1lbShzdHJ1Y3QgcmVzb3VyY2UgKnJlcykgeyB9Owot
I2VuZGlmCitleHRlcm4gc3RydWN0IGFkZHJlc3Nfc3BhY2UgKmlvbWVtX2dldF9tYXBwaW5nKHZv
aWQpOwogCiAjZW5kaWYgLyogX19BU1NFTUJMWV9fICovCiAjZW5kaWYJLyogX0xJTlVYX0lPUE9S
VF9IICovCmRpZmYgLS1naXQgYS9rZXJuZWwvcmVzb3VyY2UuYyBiL2tlcm5lbC9yZXNvdXJjZS5j
CmluZGV4IDNhZTJmNTZjYzc5ZC4uYzNkNzFkYjdhNDBlIDEwMDY0NAotLS0gYS9rZXJuZWwvcmVz
b3VyY2UuYworKysgYi9rZXJuZWwvcmVzb3VyY2UuYwpAQCAtMTgsMTIgKzE4LDE1IEBACiAjaW5j
bHVkZSA8bGludXgvc3BpbmxvY2suaD4KICNpbmNsdWRlIDxsaW51eC9mcy5oPgogI2luY2x1ZGUg
PGxpbnV4L3Byb2NfZnMuaD4KKyNpbmNsdWRlIDxsaW51eC9wc2V1ZG9fZnMuaD4KICNpbmNsdWRl
IDxsaW51eC9zY2hlZC5oPgogI2luY2x1ZGUgPGxpbnV4L3NlcV9maWxlLmg+CiAjaW5jbHVkZSA8
bGludXgvZGV2aWNlLmg+CiAjaW5jbHVkZSA8bGludXgvcGZuLmg+CiAjaW5jbHVkZSA8bGludXgv
bW0uaD4KKyNpbmNsdWRlIDxsaW51eC9tb3VudC5oPgogI2luY2x1ZGUgPGxpbnV4L3Jlc291cmNl
X2V4dC5oPgorI2luY2x1ZGUgPHVhcGkvbGludXgvbWFnaWMuaD4KICNpbmNsdWRlIDxhc20vaW8u
aD4KIAogCkBAIC0xMTE1LDYgKzExMTgsNTUgQEAgcmVzb3VyY2Vfc2l6ZV90IHJlc291cmNlX2Fs
aWdubWVudChzdHJ1Y3QgcmVzb3VyY2UgKnJlcykKIAogc3RhdGljIERFQ0xBUkVfV0FJVF9RVUVV
RV9IRUFEKG11eGVkX3Jlc291cmNlX3dhaXQpOwogCitzdGF0aWMgc3RydWN0IGlub2RlICppb21l
bV9pbm9kZTsKKworI2lmZGVmIENPTkZJR19JT19TVFJJQ1RfREVWTUVNCitzdGF0aWMgdm9pZCBy
ZXZva2VfaW9tZW0oc3RydWN0IHJlc291cmNlICpyZXMpCit7CisJLyogcGFpcnMgd2l0aCBzbXBf
c3RvcmVfcmVsZWFzZSgpIGluIGlvbWVtX2luaXRfaW5vZGUoKSAqLworCXN0cnVjdCBpbm9kZSAq
aW5vZGUgPSBzbXBfbG9hZF9hY3F1aXJlKCZpb21lbV9pbm9kZSk7CisKKwkvKgorCSAqIENoZWNr
IHRoYXQgdGhlIGluaXRpYWxpemF0aW9uIGhhcyBjb21wbGV0ZWQuIExvc2luZyB0aGUgcmFjZQor
CSAqIGlzIG9rIGJlY2F1c2UgaXQgbWVhbnMgZHJpdmVycyBhcmUgY2xhaW1pbmcgcmVzb3VyY2Vz
IGJlZm9yZQorCSAqIHRoZSBmc19pbml0Y2FsbCBsZXZlbCBvZiBpbml0IGFuZCBwcmV2ZW50IGlv
bWVtX2dldF9tYXBwaW5nIHVzZXJzCisJICogZnJvbSBlc3RhYmxpc2hpbmcgbWFwcGluZ3MuCisJ
ICovCisJaWYgKCFpbm9kZSkKKwkJcmV0dXJuOworCisJLyoKKwkgKiBUaGUgZXhwZWN0YXRpb24g
aXMgdGhhdCB0aGUgZHJpdmVyIGhhcyBzdWNjZXNzZnVsbHkgbWFya2VkCisJICogdGhlIHJlc291
cmNlIGJ1c3kgYnkgdGhpcyBwb2ludCwgc28gZGV2bWVtX2lzX2FsbG93ZWQoKQorCSAqIHNob3Vs
ZCBzdGFydCByZXR1cm5pbmcgZmFsc2UsIGhvd2V2ZXIgZm9yIHBlcmZvcm1hbmNlIHRoaXMKKwkg
KiBkb2VzIG5vdCBpdGVyYXRlIHRoZSBlbnRpcmUgcmVzb3VyY2UgcmFuZ2UuCisJICovCisJaWYg
KGRldm1lbV9pc19hbGxvd2VkKFBIWVNfUEZOKHJlcy0+c3RhcnQpKSAmJgorCSAgICBkZXZtZW1f
aXNfYWxsb3dlZChQSFlTX1BGTihyZXMtPmVuZCkpKSB7CisJCS8qCisJCSAqICpjcmluZ2UqIGlv
bWVtPXJlbGF4ZWQgc2F5cyAiZ28gYWhlYWQsIHdoYXQncyB0aGUKKwkJICogd29yc3QgdGhhdCBj
YW4gaGFwcGVuPyIKKwkJICovCisJCXJldHVybjsKKwl9CisKKwl1bm1hcF9tYXBwaW5nX3Jhbmdl
KGlub2RlLT5pX21hcHBpbmcsIHJlcy0+c3RhcnQsIHJlc291cmNlX3NpemUocmVzKSwgMSk7Cit9
CisjZWxzZQorc3RhdGljIHZvaWQgcmV2b2tlX2lvbWVtKHN0cnVjdCByZXNvdXJjZSAqcmVzKSB7
fQorI2VuZGlmCisKK3N0cnVjdCBhZGRyZXNzX3NwYWNlICppb21lbV9nZXRfbWFwcGluZyh2b2lk
KQoreworCS8qCisJICogVGhpcyBmdW5jdGlvbiBpcyBvbmx5IGNhbGxlZCBmcm9tIGZpbGUgb3Bl
biBwYXRocywgaGVuY2UgZ3VhcmFudGVlZAorCSAqIHRoYXQgZnNfaW5pdGNhbGxzIGhhdmUgY29t
cGxldGVkIGFuZCBubyBuZWVkIHRvIGNoZWNrIGZvciBOVUxMLiBCdXQKKwkgKiBzaW5jZSByZXZv
a2VfaW9tZW0gY2FuIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGluaXRjYWxsIHdlIHN0aWxsIG5lZWQK
KwkgKiB0aGUgYmFycmllciB0byBhcHBlYXNlIGNoZWNrZXJzLgorCSAqLworCXJldHVybiBzbXBf
bG9hZF9hY3F1aXJlKCZpb21lbV9pbm9kZSktPmlfbWFwcGluZzsKK30KKwogLyoqCiAgKiBfX3Jl
cXVlc3RfcmVnaW9uIC0gY3JlYXRlIGEgbmV3IGJ1c3kgcmVzb3VyY2UgcmVnaW9uCiAgKiBAcGFy
ZW50OiBwYXJlbnQgcmVzb3VyY2UgZGVzY3JpcHRvcgpAQCAtMTE4Miw3ICsxMjM0LDcgQEAgc3Ry
dWN0IHJlc291cmNlICogX19yZXF1ZXN0X3JlZ2lvbihzdHJ1Y3QgcmVzb3VyY2UgKnBhcmVudCwK
IAl3cml0ZV91bmxvY2soJnJlc291cmNlX2xvY2spOwogCiAJaWYgKHJlcyAmJiBvcmlnX3BhcmVu
dCA9PSAmaW9tZW1fcmVzb3VyY2UpCi0JCXJldm9rZV9kZXZtZW0ocmVzKTsKKwkJcmV2b2tlX2lv
bWVtKHJlcyk7CiAKIAlyZXR1cm4gcmVzOwogfQpAQCAtMTc4Miw0ICsxODM0LDQ4IEBAIHN0YXRp
YyBpbnQgX19pbml0IHN0cmljdF9pb21lbShjaGFyICpzdHIpCiAJcmV0dXJuIDE7CiB9CiAKK3N0
YXRpYyBpbnQgaW9tZW1fZnNfaW5pdF9mc19jb250ZXh0KHN0cnVjdCBmc19jb250ZXh0ICpmYykK
K3sKKwlyZXR1cm4gaW5pdF9wc2V1ZG8oZmMsIERFVk1FTV9NQUdJQykgPyAwIDogLUVOT01FTTsK
K30KKworc3RhdGljIHN0cnVjdCBmaWxlX3N5c3RlbV90eXBlIGlvbWVtX2ZzX3R5cGUgPSB7CisJ
Lm5hbWUJCT0gImlvbWVtIiwKKwkub3duZXIJCT0gVEhJU19NT0RVTEUsCisJLmluaXRfZnNfY29u
dGV4dCA9IGlvbWVtX2ZzX2luaXRfZnNfY29udGV4dCwKKwkua2lsbF9zYgk9IGtpbGxfYW5vbl9z
dXBlciwKK307CisKK3N0YXRpYyBpbnQgX19pbml0IGlvbWVtX2luaXRfaW5vZGUodm9pZCkKK3sK
KwlzdGF0aWMgc3RydWN0IHZmc21vdW50ICppb21lbV92ZnNfbW91bnQ7CisJc3RhdGljIGludCBp
b21lbV9mc19jbnQ7CisJc3RydWN0IGlub2RlICppbm9kZTsKKwlpbnQgcmM7CisKKwlyYyA9IHNp
bXBsZV9waW5fZnMoJmlvbWVtX2ZzX3R5cGUsICZpb21lbV92ZnNfbW91bnQsICZpb21lbV9mc19j
bnQpOworCWlmIChyYyA8IDApIHsKKwkJcHJfZXJyKCJDYW5ub3QgbW91bnQgaW9tZW0gcHNldWRv
IGZpbGVzeXN0ZW06ICVkXG4iLCByYyk7CisJCXJldHVybiByYzsKKwl9CisKKwlpbm9kZSA9IGFs
bG9jX2Fub25faW5vZGUoaW9tZW1fdmZzX21vdW50LT5tbnRfc2IpOworCWlmIChJU19FUlIoaW5v
ZGUpKSB7CisJCXJjID0gUFRSX0VSUihpbm9kZSk7CisJCXByX2VycigiQ2Fubm90IGFsbG9jYXRl
IGlub2RlIGZvciBpb21lbTogJWRcbiIsIHJjKTsKKwkJc2ltcGxlX3JlbGVhc2VfZnMoJmlvbWVt
X3Zmc19tb3VudCwgJmlvbWVtX2ZzX2NudCk7CisJCXJldHVybiByYzsKKwl9CisKKwkvKgorCSAq
IFB1Ymxpc2ggaW9tZW0gcmV2b2NhdGlvbiBpbm9kZSBpbml0aWFsaXplZC4KKwkgKiBQYWlycyB3
aXRoIHNtcF9sb2FkX2FjcXVpcmUoKSBpbiByZXZva2VfaW9tZW0oKS4KKwkgKi8KKwlzbXBfc3Rv
cmVfcmVsZWFzZSgmaW9tZW1faW5vZGUsIGlub2RlKTsKKworCXJldHVybiAwOworfQorCitmc19p
bml0Y2FsbChpb21lbV9pbml0X2lub2RlKTsKKwogX19zZXR1cCgiaW9tZW09Iiwgc3RyaWN0X2lv
bWVtKTsKLS0gCjIuMjkuMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVsCg==
