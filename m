Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 514D136B0DF
	for <lists+dri-devel@lfdr.de>; Mon, 26 Apr 2021 11:43:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B3F1B6E7DA;
	Mon, 26 Apr 2021 09:43:12 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7F7DE6E7FE;
 Mon, 26 Apr 2021 09:43:09 +0000 (UTC)
IronPort-SDR: fBp/mX0FcmtH5ANFfuI4AEcGVDhkdL8eabdXP1Gmfg/oFQss+oz3WWYxLVcdvCMqlTaaaZoYtE
 r5MqcNUyiwCg==
X-IronPort-AV: E=McAfee;i="6200,9189,9965"; a="195861038"
X-IronPort-AV: E=Sophos;i="5.82,252,1613462400"; d="scan'208";a="195861038"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Apr 2021 02:43:09 -0700
IronPort-SDR: VyywMMXX/0/W/T2Npj1KdAN6DY+0UnrjP4y0Pm32p9pMem6YBm/38x18i1fHuDx8pHk7T6Koae
 XZswbTN58Sgw==
X-IronPort-AV: E=Sophos;i="5.82,252,1613462400"; d="scan'208";a="429334181"
Received: from rgunnin1-mobl.ger.corp.intel.com (HELO
 mwauld-desk1.ger.corp.intel.com) ([10.252.12.201])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Apr 2021 02:43:06 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 7/9] drm/i915/lmem: support optional CPU clearing for special
 internal use
Date: Mon, 26 Apr 2021 10:38:59 +0100
Message-Id: <20210426093901.28937-7-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.3
In-Reply-To: <20210426093901.28937-1-matthew.auld@intel.com>
References: <20210426093901.28937-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Lionel Landwerlin <lionel.g.landwerlin@linux.intel.com>,
 =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 Jordan Justen <jordan.l.justen@intel.com>, dri-devel@lists.freedesktop.org,
 Kenneth Graunke <kenneth@whitecape.org>,
 Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>,
 Jon Bloomfield <jon.bloomfield@intel.com>,
 Jason Ekstrand <jason@jlekstrand.net>, mesa-dev@lists.freedesktop.org,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Rm9yIHNvbWUgaW50ZXJuYWwgZGV2aWNlIGxvY2FsLW1lbW9yeSBvYmplY3RzIGl0IHdvdWxkIGJl
IHVzZWZ1bCB0byBoYXZlCmFuIG9wdGlvbiB0byBDUFUgY2xlYXIgdGhlIHBhZ2VzIHVwb24gZ2F0
aGVyaW5nIHRoZSBiYWNraW5nIHN0b3JlLiBOb3RlCnRoYXQgdGhpcyBtaWdodCBiZSBiZWZvcmUg
dGhlIGJsaXR0ZXIgaXMgdXNlYWJsZSwgd2hpY2ggaXMgdGhlIGNhc2UgZm9yCnNvbWUgaW50ZXJu
YWwgR3VDIG9iamVjdHMuCgpTaWduZWQtb2ZmLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVs
ZEBpbnRlbC5jb20+CkNjOiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5p
bnRlbC5jb20+CkNjOiBUaG9tYXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJvbUBsaW51eC5p
bnRlbC5jb20+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVy
aW9AaW50ZWwuY29tPgpDYzogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5A
bGludXguaW50ZWwuY29tPgpDYzogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVs
LmNvbT4KQ2M6IEpvcmRhbiBKdXN0ZW4gPGpvcmRhbi5sLmp1c3RlbkBpbnRlbC5jb20+CkNjOiBE
YW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGludGVsLmNvbT4KQ2M6IEtlbm5ldGggR3JhdW5r
ZSA8a2VubmV0aEB3aGl0ZWNhcGUub3JnPgpDYzogSmFzb24gRWtzdHJhbmQgPGphc29uQGpsZWtz
dHJhbmQubmV0PgpDYzogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAZ21haWwuY29tPgpDYzogZHJpLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpDYzogbWVzYS1kZXZAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCi0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggIHwg
IDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYyAgICB8IDIy
ICsrKysrCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVsX21lbW9yeV9yZWdpb24uYyAgfCA4
NyArKysrKysrKysrKysrKysrKystCiAzIGZpbGVzIGNoYW5nZWQsIDExMyBpbnNlcnRpb25zKCsp
LCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3RfdHlwZXMuaAppbmRleCA2OWQ2ZTU0YmM1NjkuLjA3MjdkMGM3NmFhMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAt
MTcyLDExICsxNzIsMTMgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgewogI2RlZmluZSBJ
OTE1X0JPX0FMTE9DX0NPTlRJR1VPVVMgQklUKDApCiAjZGVmaW5lIEk5MTVfQk9fQUxMT0NfVk9M
QVRJTEUgICBCSVQoMSkKICNkZWZpbmUgSTkxNV9CT19BTExPQ19TVFJVQ1RfUEFHRSBCSVQoMikK
KyNkZWZpbmUgSTkxNV9CT19BTExPQ19DUFVfQ0xFQVIgIEJJVCgzKQogI2RlZmluZSBJOTE1X0JP
X0FMTE9DX0ZMQUdTIChJOTE1X0JPX0FMTE9DX0NPTlRJR1VPVVMgfCBcCiAJCQkgICAgIEk5MTVf
Qk9fQUxMT0NfVk9MQVRJTEUgfCBcCi0JCQkgICAgIEk5MTVfQk9fQUxMT0NfU1RSVUNUX1BBR0Up
Ci0jZGVmaW5lIEk5MTVfQk9fUkVBRE9OTFkgICAgICAgICBCSVQoMykKLSNkZWZpbmUgSTkxNV9U
SUxJTkdfUVVJUktfQklUICAgIDQgLyogdW5rbm93biBzd2l6emxpbmc7IGRvIG5vdCByZWxlYXNl
ISAqLworCQkJICAgICBJOTE1X0JPX0FMTE9DX1NUUlVDVF9QQUdFIHwgXAorCQkJICAgICBJOTE1
X0JPX0FMTE9DX0NQVV9DTEVBUikKKyNkZWZpbmUgSTkxNV9CT19SRUFET05MWSAgICAgICAgIEJJ
VCg0KQorI2RlZmluZSBJOTE1X1RJTElOR19RVUlSS19CSVQgICAgNSAvKiB1bmtub3duIHN3aXp6
bGluZzsgZG8gbm90IHJlbGVhc2UhICovCiAKIAkvKgogCSAqIElzIHRoZSBvYmplY3QgdG8gYmUg
bWFwcGVkIGFzIHJlYWQtb25seSB0byB0aGUgR1BVCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fcmVnaW9uLmMKaW5kZXggNmE4NGZiNmRkZTI0Li41ZDYwMzA5OGRhNTcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcmVnaW9uLmMKQEAgLTk1LDYgKzk1LDI4
IEBAIGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfYnVkZHkoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKIAlzZ19tYXJrX2VuZChzZyk7CiAJaTkxNV9zZ190cmltKHN0KTsKIAorCS8q
IEludGVuZGVkIGZvciBrZXJuZWwgaW50ZXJuYWwgdXNlIG9ubHkgKi8KKwlpZiAob2JqLT5mbGFn
cyAmIEk5MTVfQk9fQUxMT0NfQ1BVX0NMRUFSKSB7CisJCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7
CisJCXVuc2lnbmVkIGxvbmcgaTsKKworCQlmb3JfZWFjaF9zZyhzdC0+c2dsLCBzZywgc3QtPm5l
bnRzLCBpKSB7CisJCQl1bnNpZ25lZCBpbnQgbGVuZ3RoOworCQkJdm9pZCBfX2lvbWVtICp2YWRk
cjsKKwkJCWRtYV9hZGRyX3QgZGFkZHI7CisKKwkJCWRhZGRyID0gc2dfZG1hX2FkZHJlc3Moc2cp
OworCQkJZGFkZHIgLT0gbWVtLT5yZWdpb24uc3RhcnQ7CisJCQlsZW5ndGggPSBzZ19kbWFfbGVu
KHNnKTsKKworCQkJdmFkZHIgPSBpb19tYXBwaW5nX21hcF93YygmbWVtLT5pb21hcCwgZGFkZHIs
IGxlbmd0aCk7CisJCQltZW1zZXQ2NCh2YWRkciwgMCwgbGVuZ3RoIC8gc2l6ZW9mKHU2NCkpOwor
CQkJaW9fbWFwcGluZ191bm1hcCh2YWRkcik7CisJCX0KKworCQl3bWIoKTsKKwl9CisKIAlfX2k5
MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBzdCwgc2dfcGFnZV9zaXplcyk7CiAKIAlyZXR1
cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9t
ZW1vcnlfcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVt
b3J5X3JlZ2lvbi5jCmluZGV4IGE1ZmMwYmYzZmViOS4uMGZlNGM4MWY3NTg5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9tZW1vcnlfcmVnaW9uLmMK
QEAgLTUxMyw3ICs1MTMsNyBAQCBzdGF0aWMgaW50IGlndF9jcHVfY2hlY2soc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwgdTMyIGR3b3JkLCB1MzIgdmFsKQogCWlmIChlcnIpCiAJCXJl
dHVybiBlcnI7CiAKLQlwdHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcF91bmxvY2tlZChvYmos
IEk5MTVfTUFQX1dDKTsKKwlwdHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVf
TUFQX1dDKTsKIAlpZiAoSVNfRVJSKHB0cikpCiAJCXJldHVybiBQVFJfRVJSKHB0cik7CiAKQEAg
LTU5Myw3ICs1OTMsOSBAQCBzdGF0aWMgaW50IGlndF9ncHVfd3JpdGUoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCisJCWk5MTVfZ2VtX29iamVj
dF9sb2NrKG9iaiwgTlVMTCk7CiAJCWVyciA9IGlndF9jcHVfY2hlY2sob2JqLCBkd29yZCwgcm5n
KTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7
CiAJfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKTsKQEAgLTYyOSw2ICs2
MzEsODggQEAgc3RhdGljIGludCBpZ3RfbG1lbV9jcmVhdGUodm9pZCAqYXJnKQogCXJldHVybiBl
cnI7CiB9CiAKK3N0YXRpYyBpbnQgaWd0X2xtZW1fY3JlYXRlX2NsZWFyZWRfY3B1KHZvaWQgKmFy
ZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlJOTE1X1JORF9T
VEFURShwcm5nKTsKKwlJR1RfVElNRU9VVChlbmRfdGltZSk7CisJdTMyIHNpemUsIGk7CisJaW50
IGVycjsKKworCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CisKKwlzaXplID0g
bWF4X3QodTMyLCBQQUdFX1NJWkUsIGk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKFNaXzMyTSwg
JnBybmcpKTsKKwlzaXplID0gcm91bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKTsKKwlpID0gMDsKKwor
CWRvIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwkJdm9pZCBfX2lvbWVt
ICp2YWRkcjsKKwkJdW5zaWduZWQgaW50IGZsYWdzOworCQl1MzIgZHdvcmQsIHZhbDsKKworCQkv
KgorCQkgKiBBbHRlcm5hdGUgYmV0d2VlbiBjbGVhcmVkIGFuZCB1bmNsZWFyZWQgYWxsb2NhdGlv
bnMsIHdoaWxlCisJCSAqIGFsc28gZGlydHlpbmcgdGhlIHBhZ2VzIGVhY2ggdGltZSB0byBjaGVj
ayB0aGF0IHRoZSBwYWdlcyBhcmUKKwkJICogYWx3YXlzIGNsZWFyZWQgaWYgcmVxdWVzdGVkLCBz
aW5jZSB3ZSBzaG91bGQgZ2V0IHNvbWUgb3ZlcmxhcAorCQkgKiBvZiB0aGUgdW5kZXJseWluZyBw
YWdlcywgaWYgbm90IGFsbCwgc2luY2Ugd2UgYXJlIHRoZSBvbmx5CisJCSAqIHVzZXIuCisJCSAq
LworCisJCWZsYWdzID0gSTkxNV9CT19BTExPQ19DUFVfQ0xFQVI7CisJCWlmIChpICYgMSkKKwkJ
CWZsYWdzID0gMDsKKworCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2xtZW0oaTkxNSwg
c2l6ZSwgZmxhZ3MpOworCQlpZiAoSVNfRVJSKG9iaikpCisJCQlyZXR1cm4gUFRSX0VSUihvYmop
OworCisJCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaiwgTlVMTCk7CisJCWVyciA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fcGFnZXMob2JqKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0X3B1dDsKKwor
CQlkd29yZCA9IGk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKFBBR0VfU0laRSAvIHNpemVvZih1
MzIpLAorCQkJCQkJICAgJnBybmcpOworCisJCWlmIChmbGFncyAmIEk5MTVfQk9fQUxMT0NfQ1BV
X0NMRUFSKSB7CisJCQllcnIgPSBpZ3RfY3B1X2NoZWNrKG9iaiwgZHdvcmQsIDApOworCQkJaWYg
KGVycikgeworCQkJCXByX2VycigiJXMgZmFpbGVkIHdpdGggc2l6ZT0ldSwgZmxhZ3M9JXVcbiIs
CisJCQkJICAgICAgIF9fZnVuY19fLCBzaXplLCBmbGFncyk7CisJCQkJZ290byBvdXRfdW5waW47
CisJCQl9CisJCX0KKworCQl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkx
NV9NQVBfV0MpOworCQlpZiAoSVNfRVJSKHZhZGRyKSkgeworCQkJZXJyID0gUFRSX0VSUih2YWRk
cik7CisJCQlnb3RvIG91dF91bnBpbjsKKwkJfQorCisJCXZhbCA9IHByYW5kb21fdTMyX3N0YXRl
KCZwcm5nKTsKKworCQltZW1zZXQzMih2YWRkciwgdmFsLCBvYmotPmJhc2Uuc2l6ZSAvIHNpemVv
Zih1MzIpKTsKKworCQlpOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKG9iaik7CisJCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9tYXAob2JqKTsKK291dF91bnBpbjoKKwkJaTkxNV9nZW1fb2JqZWN0X3Vu
cGluX3BhZ2VzKG9iaik7CisJCV9faTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlcyhvYmopOworb3V0
X3B1dDoKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOworCQlpOTE1X2dlbV9vYmplY3Rf
cHV0KG9iaik7CisKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCQkrK2k7CisJfSB3aGlsZSAoIV9f
aWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKTsKKworCXByX2luZm8oIiVzIGNvbXBsZXRlZCAo
JXUpIGl0ZXJhdGlvbnNcbiIsIF9fZnVuY19fLCBpKTsKKworCXJldHVybiBlcnI7Cit9CisKIHN0
YXRpYyBpbnQgaWd0X2xtZW1fd3JpdGVfZ3B1KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKQEAgLTEwNDMsNiArMTEyNyw3IEBAIGludCBpbnRlbF9t
ZW1vcnlfcmVnaW9uX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CiAJCVNV
QlRFU1QoaWd0X2xtZW1fY3JlYXRlKSwKKwkJU1VCVEVTVChpZ3RfbG1lbV9jcmVhdGVfY2xlYXJl
ZF9jcHUpLAogCQlTVUJURVNUKGlndF9sbWVtX3dyaXRlX2NwdSksCiAJCVNVQlRFU1QoaWd0X2xt
ZW1fd3JpdGVfZ3B1KSwKIAl9OwotLSAKMi4yNi4zCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWwK
