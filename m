Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 74D28E38C2
	for <lists+dri-devel@lfdr.de>; Thu, 24 Oct 2019 18:46:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3626C6E523;
	Thu, 24 Oct 2019 16:46:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x341.google.com (mail-wm1-x341.google.com
 [IPv6:2a00:1450:4864:20::341])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7FB866E49A
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 16:46:45 +0000 (UTC)
Received: by mail-wm1-x341.google.com with SMTP id 11so128873wmk.0
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 09:46:45 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=JRd+EeKsrdPkPHAoa/K4vedud6vOnZI24UldnRJuL1o=;
 b=bmqZGrYEo5qWp1ufJrMZHa4aPObsHVevB9mGcX91D4pNIsUyCE9ASqIKXfeWhJlgk+
 6/h3FODxly4t5PikyM8Tg7mGT38GTBx7cVrsnWlNQzago+qdOLKm0ojwtDpSTcG96Js5
 x6AZamoOO4jdU1DXjSI9ui3v3OQKrjcbWIEe4QNkI4fxQPBFjuczG6KPfwuyRObUSY4U
 9mPLBN5K+yG8FbpINTzfBI9+1Jsd+NTsvhhAR4M0wYrW3wIEbK9hy31d7f71antgm2Eo
 vIputHNXG4lwHMT4z+bzHYm/Ul5HfgP9Xgsvn42XQSH0A+mlu0uNwXwowToziL3GTcKf
 3hIA==
X-Gm-Message-State: APjAAAXRvr3lZuxMqlKQz5a6pE0KKOFBbnYehUxT4Xr8JxOvysOCmBMI
 kc4CiczNQyRMAoVSRkwrTcZOwU45
X-Google-Smtp-Source: APXvYqxWyKKQZOh8WvkcRPW/UWPlWq4kPtg4dR10MQ56wdE3BdMsocjBWjzg/prv7qySAP192JCkBg==
X-Received: by 2002:a7b:c1d1:: with SMTP id a17mr5359295wmj.74.1571935602491; 
 Thu, 24 Oct 2019 09:46:42 -0700 (PDT)
Received: from localhost (p2E5BE2CE.dip0.t-ipconnect.de. [46.91.226.206])
 by smtp.gmail.com with ESMTPSA id d4sm33410024wrc.54.2019.10.24.09.46.41
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 24 Oct 2019 09:46:41 -0700 (PDT)
From: Thierry Reding <thierry.reding@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH 29/32] drm/tegra: sor: Unify eDP and DP support
Date: Thu, 24 Oct 2019 18:45:31 +0200
Message-Id: <20191024164534.132764-30-thierry.reding@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191024164534.132764-1-thierry.reding@gmail.com>
References: <20191024164534.132764-1-thierry.reding@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=JRd+EeKsrdPkPHAoa/K4vedud6vOnZI24UldnRJuL1o=;
 b=YMeLv7yawSgBBZoszFFBTVksesBuapiBWzHyCHSZhEu4WMy6aHBQ3Q99lujgQOTSFm
 V/Y6szr5WZ/SXYN3jfbEOfaustTjZrpRyJoB9FQJ1PLKMH6keA/p/BBF00xlHsKZjCxQ
 0Osy9DZDN0XfebYrPCNp8wcGV6vtJ2LrnoR0Km8/teYRQ8drJeg3NWUprZOZUGX4tKlF
 OmZotQGMGJGm8TXSjB/ceWl5+JtDlLgOxQGBIKSVpM0tzktrPWprq4mu/cbailDEJaBl
 0VW6Hs3/plvVHE02KBZ4S2y394P1jEYSTD6wXj8jvS9hhYMEW61mTySBTTZuGvlDfjlS
 mhAQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlhLmNvbT4KClRoZSBTT1IwIG9uIFRl
Z3JhMjEwIGRvZXMsIGNvbnRyYXJ5IHRvIHdoYXQgd2FzIHByZXZpb3VzbHkgYXNzdW1lZCwgaW4K
ZmFjdCBzdXBwb3J0IERpc3BsYXlQb3J0LiBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIFNPUjAgYW5k
IFNPUjEgaXMgdGhhdAp0aGUgbGF0dGVyIHN1cHBvcnRzIGF1ZGlvIGFuZCBIRENQIG92ZXIgRFAs
IHdoZXJlYXMgdGhlIGZvcm1lciBkb2Vzbid0LgoKVGhlIGNvZGUgZm9yIGVEUCBhbmQgRFAgaXMg
bm93IGFsbW9zdCBpZGVudGljYWwgYW5kIHRoZSBkaWZmZXJlbmNlcyBjYW4KZWFzaWx5IGJlIHBh
cmFtZXRlcml6ZWQgYmFzZWQgb24gdGhlIHByZXNlbmNlIG9mIGEgcGFuZWwuIFRoZXJlIGlzIG5v
Cm5lZWQgYW55IGxvbmdlciB0byBkdXBsaWNhdGUgdGhlIGNvZGUuCgpTaWduZWQtb2ZmLWJ5OiBU
aGllcnJ5IFJlZGluZyA8dHJlZGluZ0BudmlkaWEuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS90
ZWdyYS9zb3IuYyB8IDQyMSArKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCA3NCBpbnNlcnRpb25zKCspLCAzNDcgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3Nvci5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3Jh
L3Nvci5jCmluZGV4IGJmMmUzMTE5OTE2Ni4uNjM4MzFjMzdhZDM1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdGVncmEvc29yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3Nvci5j
CkBAIC0zNzEsMTAgKzM3MSwxMSBAQCBzdHJ1Y3QgdGVncmFfc29yX3JlZ3MgewogfTsKIAogc3Ry
dWN0IHRlZ3JhX3Nvcl9zb2MgewotCWJvb2wgc3VwcG9ydHNfZWRwOwogCWJvb2wgc3VwcG9ydHNf
bHZkczsKIAlib29sIHN1cHBvcnRzX2hkbWk7CiAJYm9vbCBzdXBwb3J0c19kcDsKKwlib29sIHN1
cHBvcnRzX2F1ZGlvOworCWJvb2wgc3VwcG9ydHNfaGRjcDsKIAogCWNvbnN0IHN0cnVjdCB0ZWdy
YV9zb3JfcmVncyAqcmVnczsKIAlib29sIGhhc19udmRpc3BsYXk7CkBAIC0xODA2LDMwNiArMTgw
Nyw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfZnVuY3MgdGVncmFfc29yX2Vu
Y29kZXJfZnVuY3MgPSB7CiAJLmRlc3Ryb3kgPSB0ZWdyYV9vdXRwdXRfZW5jb2Rlcl9kZXN0cm95
LAogfTsKIAotc3RhdGljIHZvaWQgdGVncmFfc29yX2VkcF9kaXNhYmxlKHN0cnVjdCBkcm1fZW5j
b2RlciAqZW5jb2RlcikKLXsKLQlzdHJ1Y3QgdGVncmFfb3V0cHV0ICpvdXRwdXQgPSBlbmNvZGVy
X3RvX291dHB1dChlbmNvZGVyKTsKLQlzdHJ1Y3QgdGVncmFfZGMgKmRjID0gdG9fdGVncmFfZGMo
ZW5jb2Rlci0+Y3J0Yyk7Ci0Jc3RydWN0IHRlZ3JhX3NvciAqc29yID0gdG9fc29yKG91dHB1dCk7
Ci0JdTMyIHZhbHVlOwotCWludCBlcnI7Ci0KLQlpZiAob3V0cHV0LT5wYW5lbCkKLQkJZHJtX3Bh
bmVsX2Rpc2FibGUob3V0cHV0LT5wYW5lbCk7Ci0KLQllcnIgPSB0ZWdyYV9zb3JfZGV0YWNoKHNv
cik7Ci0JaWYgKGVyciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gZGV0YWNo
IFNPUjogJWRcbiIsIGVycik7Ci0KLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgMCwgU09SX1NUQVRF
MSk7Ci0JdGVncmFfc29yX3VwZGF0ZShzb3IpOwotCi0JdmFsdWUgPSB0ZWdyYV9kY19yZWFkbChk
YywgRENfRElTUF9ESVNQX1dJTl9PUFRJT05TKTsKLQl2YWx1ZSAmPSB+U09SX0VOQUJMRSgwKTsK
LQl0ZWdyYV9kY193cml0ZWwoZGMsIHZhbHVlLCBEQ19ESVNQX0RJU1BfV0lOX09QVElPTlMpOwot
Ci0JdGVncmFfZGNfY29tbWl0KGRjKTsKLQotCWVyciA9IHRlZ3JhX3Nvcl9wb3dlcl9kb3duKHNv
cik7Ci0JaWYgKGVyciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gcG93ZXIg
ZG93biBTT1I6ICVkXG4iLCBlcnIpOwotCi0JaWYgKHNvci0+YXV4KSB7Ci0JCWVyciA9IGRybV9k
cF9hdXhfZGlzYWJsZShzb3ItPmF1eCk7Ci0JCWlmIChlcnIgPCAwKQotCQkJZGV2X2Vycihzb3It
PmRldiwgImZhaWxlZCB0byBkaXNhYmxlIERQOiAlZFxuIiwgZXJyKTsKLQl9Ci0KLQllcnIgPSB0
ZWdyYV9pb19wYWRfcG93ZXJfZGlzYWJsZShzb3ItPnBhZCk7Ci0JaWYgKGVyciA8IDApCi0JCWRl
dl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gcG93ZXIgb2ZmIEkvTyBwYWQ6ICVkXG4iLCBlcnIp
OwotCi0JaWYgKG91dHB1dC0+cGFuZWwpCi0JCWRybV9wYW5lbF91bnByZXBhcmUob3V0cHV0LT5w
YW5lbCk7Ci0KLQlwbV9ydW50aW1lX3B1dChzb3ItPmRldik7Ci19Ci0KLSNpZiAwCi1zdGF0aWMg
aW50IGNhbGNfaF9yZWZfdG9fc3luYyhjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9k
ZSwKLQkJCSAgICAgIHVuc2lnbmVkIGludCAqdmFsdWUpCi17Ci0JdW5zaWduZWQgaW50IGhmcCwg
aHN3LCBoYnAsIGEgPSAwLCBiOwotCi0JaGZwID0gbW9kZS0+aHN5bmNfc3RhcnQgLSBtb2RlLT5o
ZGlzcGxheTsKLQloc3cgPSBtb2RlLT5oc3luY19lbmQgLSBtb2RlLT5oc3luY19zdGFydDsKLQlo
YnAgPSBtb2RlLT5odG90YWwgLSBtb2RlLT5oc3luY19lbmQ7Ci0KLQlwcl9pbmZvKCJoZnA6ICV1
LCBoc3c6ICV1LCBoYnA6ICV1XG4iLCBoZnAsIGhzdywgaGJwKTsKLQotCWIgPSBoZnAgLSAxOwot
Ci0JcHJfaW5mbygiYTogJXUsIGI6ICV1XG4iLCBhLCBiKTsKLQlwcl9pbmZvKCJhICsgaHN3ICsg
aGJwID0gJXVcbiIsIGEgKyBoc3cgKyBoYnApOwotCi0JaWYgKGEgKyBoc3cgKyBoYnAgPD0gMTEp
IHsKLQkJYSA9IDEgKyAxMSAtIGhzdyAtIGhicDsKLQkJcHJfaW5mbygiYTogJXVcbiIsIGEpOwot
CX0KLQotCWlmIChhID4gYikKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQlpZiAoaHN3IDwgMSkKLQkJ
cmV0dXJuIC1FSU5WQUw7Ci0KLQlpZiAobW9kZS0+aGRpc3BsYXkgPCAxNikKLQkJcmV0dXJuIC1F
SU5WQUw7Ci0KLQlpZiAodmFsdWUpIHsKLQkJaWYgKGIgPiBhICYmIGEgJSAyKQotCQkJKnZhbHVl
ID0gYSArIDE7Ci0JCWVsc2UKLQkJCSp2YWx1ZSA9IGE7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0j
ZW5kaWYKLQotc3RhdGljIHZvaWQgdGVncmFfc29yX2VkcF9lbmFibGUoc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyKQotewotCXN0cnVjdCB0ZWdyYV9vdXRwdXQgKm91dHB1dCA9IGVuY29kZXJf
dG9fb3V0cHV0KGVuY29kZXIpOwotCXN0cnVjdCB0ZWdyYV9kYyAqZGMgPSB0b190ZWdyYV9kYyhl
bmNvZGVyLT5jcnRjKTsKLQlzdHJ1Y3QgdGVncmFfc29yICpzb3IgPSB0b19zb3Iob3V0cHV0KTsK
LQlzdHJ1Y3QgdGVncmFfc29yX2NvbmZpZyBjb25maWc7Ci0Jc3RydWN0IHRlZ3JhX3Nvcl9zdGF0
ZSAqc3RhdGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7Ci0Jc3RydWN0IGRybV9k
aXNwbGF5X2luZm8gKmluZm87Ci0JdW5zaWduZWQgaW50IGk7Ci0JdTMyIHZhbHVlOwotCWludCBl
cnI7Ci0KLQlzdGF0ZSA9IHRvX3Nvcl9zdGF0ZShvdXRwdXQtPmNvbm5lY3Rvci5zdGF0ZSk7Ci0J
bW9kZSA9ICZlbmNvZGVyLT5jcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZTsKLQlpbmZvID0gJm91
dHB1dC0+Y29ubmVjdG9yLmRpc3BsYXlfaW5mbzsKLQotCXBtX3J1bnRpbWVfZ2V0X3N5bmMoc29y
LT5kZXYpOwotCi0JLyogc3dpdGNoIHRvIHNhZmUgcGFyZW50IGNsb2NrICovCi0JZXJyID0gdGVn
cmFfc29yX3NldF9wYXJlbnRfY2xvY2soc29yLCBzb3ItPmNsa19zYWZlKTsKLQlpZiAoZXJyIDwg
MCkKLQkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBzZXQgc2FmZSBwYXJlbnQgY2xvY2s6
ICVkXG4iLCBlcnIpOwotCi0JZXJyID0gdGVncmFfaW9fcmFpbF9wb3dlcl9vbihURUdSQV9JT19S
QUlMX0xWRFMpOwotCWlmIChlcnIgPCAwKQotCQlkZXZfZXJyKHNvci0+ZGV2LCAiZmFpbGVkIHRv
IHBvd2VyIG9uIExWRFMgcmFpbDogJWRcbiIsIGVycik7Ci0KLQl1c2xlZXBfcmFuZ2UoMjAsIDEw
MCk7Ci0KLQllcnIgPSBkcm1fZHBfYXV4X2VuYWJsZShzb3ItPmF1eCk7Ci0JaWYgKGVyciA8IDAp
Ci0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gZW5hYmxlIERQQVVYOiAlZFxuIiwgZXJy
KTsKLQotCWVyciA9IGRybV9kcF9saW5rX3Byb2JlKHNvci0+YXV4LCAmc29yLT5saW5rKTsKLQlp
ZiAoZXJyIDwgMCkKLQkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBwcm9iZSBlRFAgbGlu
azogJWRcbiIsIGVycik7Ci0KLQl0ZWdyYV9zb3JfZmlsdGVyX3JhdGVzKHNvcik7Ci0KLQllcnIg
PSBkcm1fZHBfbGlua19jaG9vc2UoJnNvci0+bGluaywgbW9kZSwgaW5mbyk7Ci0JaWYgKGVyciA8
IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gY2hvb3NlIGxpbms6ICVkXG4iLCBl
cnIpOwotCi0JaWYgKG91dHB1dC0+cGFuZWwpCi0JCWRybV9wYW5lbF9wcmVwYXJlKG91dHB1dC0+
cGFuZWwpOwotCi0JdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBzb3ItPnNvYy0+cmVncy0+
cGxsMik7Ci0JdmFsdWUgJj0gflNPUl9QTEwyX0JBTkRHQVBfUE9XRVJET1dOOwotCXRlZ3JhX3Nv
cl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDIpOwotCi0JdXNsZWVwX3Jh
bmdlKDIwLCA0MCk7Ci0KLQl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIHNvci0+c29jLT5y
ZWdzLT5wbGwzKTsKLQl2YWx1ZSB8PSBTT1JfUExMM19QTExfVkREX01PREVfM1YzOwotCXRlZ3Jh
X3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDMpOwotCi0JdmFsdWUg
PSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBzb3ItPnNvYy0+cmVncy0+cGxsMCk7Ci0JdmFsdWUgJj0g
fihTT1JfUExMMF9WQ09QRCB8IFNPUl9QTEwwX1BXUik7Ci0JdGVncmFfc29yX3dyaXRlbChzb3Is
IHZhbHVlLCBzb3ItPnNvYy0+cmVncy0+cGxsMCk7Ci0KLQl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFk
bChzb3IsIHNvci0+c29jLT5yZWdzLT5wbGwyKTsKLQl2YWx1ZSAmPSB+U09SX1BMTDJfU0VRX1BM
TENBUFBEX0VORk9SQ0U7Ci0JdmFsdWUgfD0gU09SX1BMTDJfU0VRX1BMTENBUFBEOwotCXRlZ3Jh
X3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDIpOwotCi0JdXNsZWVw
X3JhbmdlKDIwMCwgNDAwKTsKLQotCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5z
b2MtPnJlZ3MtPnBsbDIpOwotCXZhbHVlICY9IH5TT1JfUExMMl9QT1dFUkRPV05fT1ZFUlJJREU7
Ci0JdmFsdWUgJj0gflNPUl9QTEwyX1BPUlRfUE9XRVJET1dOOwotCXRlZ3JhX3Nvcl93cml0ZWwo
c29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDIpOwotCi0JdmFsdWUgPSB0ZWdyYV9zb3Jf
cmVhZGwoc29yLCBTT1JfQ0xLX0NOVFJMKTsKLQl2YWx1ZSAmPSB+U09SX0NMS19DTlRSTF9EUF9D
TEtfU0VMX01BU0s7Ci0JdmFsdWUgfD0gU09SX0NMS19DTlRSTF9EUF9DTEtfU0VMX1NJTkdMRV9E
UENMSzsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9DTEtfQ05UUkwpOwotCi0J
dmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBTT1JfRFBfU1BBUkUwKTsKLQkvKiBYWFggbm90
IGluIFRSTSAqLwotCXZhbHVlIHw9IFNPUl9EUF9TUEFSRV9QQU5FTF9JTlRFUk5BTDsKLQl2YWx1
ZSB8PSBTT1JfRFBfU1BBUkVfU0VRX0VOQUJMRTsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFs
dWUsIFNPUl9EUF9TUEFSRTApOwotCi0JLyogWFhYIG5vdCBpbiBUUk0gKi8KLQl0ZWdyYV9zb3Jf
d3JpdGVsKHNvciwgMCwgU09SX0xWRFMpOwotCi0JdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29y
LCBzb3ItPnNvYy0+cmVncy0+cGxsMCk7Ci0JdmFsdWUgJj0gflNPUl9QTEwwX0lDSFBNUF9NQVNL
OwotCXZhbHVlICY9IH5TT1JfUExMMF9WQ09DQVBfTUFTSzsKLQl2YWx1ZSB8PSBTT1JfUExMMF9J
Q0hQTVAoMHgxKTsKLQl2YWx1ZSB8PSBTT1JfUExMMF9WQ09DQVAoMHgzKTsKLQl2YWx1ZSB8PSBT
T1JfUExMMF9SRVNJU1RPUl9FWFQ7Ci0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBzb3It
PnNvYy0+cmVncy0+cGxsMCk7Ci0KLQkvKiBYWFggbm90IGluIFRSTSAqLwotCWZvciAodmFsdWUg
PSAwLCBpID0gMDsgaSA8IDU7IGkrKykKLQkJdmFsdWUgfD0gU09SX1hCQVJfQ1RSTF9MSU5LMF9Y
U0VMKGksIHNvci0+eGJhcl9jZmdbaV0pIHwKLQkJCSBTT1JfWEJBUl9DVFJMX0xJTksxX1hTRUwo
aSwgaSk7Ci0KLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgMHgwMDAwMDAwMCwgU09SX1hCQVJfUE9M
KTsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9YQkFSX0NUUkwpOwotCi0JLyoK
LQkgKiBTd2l0Y2ggdGhlIHBhZCBjbG9jayB0byB0aGUgRFAgY2xvY2suIE5vdGUgdGhhdCB3ZSBj
YW5ub3QgYWN0dWFsbHkKLQkgKiBkbyB0aGlzIGJlY2F1c2UgVGVncmExODYgYW5kIGxhdGVyIGRv
bid0IHN1cHBvcnQgY2xrX3NldF9wYXJlbnQoKQotCSAqIG9uIHRoZSBzb3JYX3BhZF9jbGtvdXQg
Y2xvY2tzLiBXZSBhbHJlYWR5IGRvIHRoZSBlcXVpdmFsZW50IGFib3ZlCi0JICogdXNpbmcgdGhl
IERQX0NMS19TRUwgbXV4IG9mIHRoZSBTT1JfQ0xLX0NOVFJMIHJlZ2lzdGVyLgotCSAqLwotI2lm
IDAKLQllcnIgPSBjbGtfc2V0X3BhcmVudChzb3ItPmNsa19wYWQsIHNvci0+Y2xrX2RwKTsKLQlp
ZiAoZXJyIDwgMCkgewotCQlkZXZfZXJyKHNvci0+ZGV2LCAiZmFpbGVkIHRvIHNlbGVjdCBwYWQg
cGFyZW50IGNsb2NrOiAlZFxuIiwKLQkJCWVycik7Ci0JCXJldHVybjsKLQl9Ci0jZW5kaWYKLQot
CS8qIHN3aXRjaCB0aGUgU09SIGNsb2NrIHRvIHRoZSBwYWQgY2xvY2sgKi8KLQllcnIgPSB0ZWdy
YV9zb3Jfc2V0X3BhcmVudF9jbG9jayhzb3IsIHNvci0+Y2xrX3BhZCk7Ci0JaWYgKGVyciA8IDAp
IHsKLQkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBzZWxlY3QgU09SIHBhcmVudCBjbG9j
azogJWRcbiIsCi0JCQllcnIpOwotCQlyZXR1cm47Ci0JfQotCi0JLyogc3dpdGNoIHRoZSBvdXRw
dXQgY2xvY2sgdG8gdGhlIHBhcmVudCBwaXhlbCBjbG9jayAqLwotCWVyciA9IGNsa19zZXRfcGFy
ZW50KHNvci0+Y2xrLCBzb3ItPmNsa19wYXJlbnQpOwotCWlmIChlcnIgPCAwKSB7Ci0JCWRldl9l
cnIoc29yLT5kZXYsICJmYWlsZWQgdG8gc2VsZWN0IG91dHB1dCBwYXJlbnQgY2xvY2s6ICVkXG4i
LAotCQkJZXJyKTsKLQkJcmV0dXJuOwotCX0KLQotCS8qIHVzZSBEUC1BIHByb3RvY29sICovCi0J
dmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBTT1JfU1RBVEUxKTsKLQl2YWx1ZSAmPSB+U09S
X1NUQVRFX0FTWV9QUk9UT0NPTF9NQVNLOwotCXZhbHVlIHw9IFNPUl9TVEFURV9BU1lfUFJPVE9D
T0xfRFBfQTsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9TVEFURTEpOwotCi0J
LyogZW5hYmxlIHBvcnQgKi8KLQl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIFNPUl9EUF9M
SU5LQ1RMMCk7Ci0JdmFsdWUgfD0gU09SX0RQX0xJTktDVExfRU5BQkxFOwotCXRlZ3JhX3Nvcl93
cml0ZWwoc29yLCB2YWx1ZSwgU09SX0RQX0xJTktDVEwwKTsKLQotCXRlZ3JhX3Nvcl9kcF90ZXJt
X2NhbGlicmF0ZShzb3IpOwotCi0JZXJyID0gZHJtX2RwX2xpbmtfdHJhaW4oJnNvci0+bGluayk7
Ci0JaWYgKGVyciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJsaW5rIHRyYWluaW5nIGZhaWxl
ZDogJWRcbiIsIGVycik7Ci0JZWxzZQotCQlkZXZfZGJnKHNvci0+ZGV2LCAibGluayB0cmFpbmlu
ZyBzdWNjZWVkZWRcbiIpOwotCi0JZXJyID0gZHJtX2RwX2xpbmtfcG93ZXJfdXAoc29yLT5hdXgs
ICZzb3ItPmxpbmspOwotCWlmIChlcnIgPCAwKQotCQlkZXZfZXJyKHNvci0+ZGV2LCAiZmFpbGVk
IHRvIHBvd2VyIHVwIGVEUCBsaW5rOiAlZFxuIiwgZXJyKTsKLQotCS8qIGNvbXB1dGUgY29uZmln
dXJhdGlvbiAqLwotCW1lbXNldCgmY29uZmlnLCAwLCBzaXplb2YoY29uZmlnKSk7Ci0JY29uZmln
LmJpdHNfcGVyX3BpeGVsID0gc3RhdGUtPmJwYyAqIDM7Ci0KLQllcnIgPSB0ZWdyYV9zb3JfY29t
cHV0ZV9jb25maWcoc29yLCBtb2RlLCAmY29uZmlnLCAmc29yLT5saW5rKTsKLQlpZiAoZXJyIDwg
MCkKLQkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBjb21wdXRlIGNvbmZpZ3VyYXRpb246
ICVkXG4iLCBlcnIpOwotCi0JdGVncmFfc29yX2FwcGx5X2NvbmZpZyhzb3IsICZjb25maWcpOwot
Ci0JZXJyID0gdGVncmFfc29yX3Bvd2VyX3VwKHNvciwgMjUwKTsKLQlpZiAoZXJyIDwgMCkKLQkJ
ZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBwb3dlciB1cCBTT1I6ICVkXG4iLCBlcnIpOwot
Ci0JLyogQ1NUTSAoTFZEUywgbGluayBBL0IsIHVwcGVyKSAqLwotCXZhbHVlID0gU09SX0NTVE1f
TFZEUyB8IFNPUl9DU1RNX0xJTktfQUNUX0EgfCBTT1JfQ1NUTV9MSU5LX0FDVF9CIHwKLQkJU09S
X0NTVE1fVVBQRVI7Ci0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfQ1NUTSk7Ci0K
LQkvKiB1c2UgRFAtQSBwcm90b2NvbCAqLwotCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwg
U09SX1NUQVRFMSk7Ci0JdmFsdWUgJj0gflNPUl9TVEFURV9BU1lfUFJPVE9DT0xfTUFTSzsKLQl2
YWx1ZSB8PSBTT1JfU1RBVEVfQVNZX1BST1RPQ09MX0RQX0E7Ci0JdGVncmFfc29yX3dyaXRlbChz
b3IsIHZhbHVlLCBTT1JfU1RBVEUxKTsKLQotCXRlZ3JhX3Nvcl9tb2RlX3NldChzb3IsIG1vZGUs
IHN0YXRlKTsKLQotCS8qIFBXTSBzZXR1cCAqLwotCWVyciA9IHRlZ3JhX3Nvcl9zZXR1cF9wd20o
c29yLCAyNTApOwotCWlmIChlcnIgPCAwKQotCQlkZXZfZXJyKHNvci0+ZGV2LCAiZmFpbGVkIHRv
IHNldHVwIFBXTTogJWRcbiIsIGVycik7Ci0KLQl0ZWdyYV9zb3JfdXBkYXRlKHNvcik7Ci0KLQll
cnIgPSB0ZWdyYV9zb3JfcG93ZXJfdXAoc29yLCAyNTApOwotCWlmIChlcnIgPCAwKQotCQlkZXZf
ZXJyKHNvci0+ZGV2LCAiZmFpbGVkIHRvIHBvd2VyIHVwIFNPUjogJWRcbiIsIGVycik7Ci0KLQkv
KiBhdHRhY2ggYW5kIHdha2UgdXAgKi8KLQllcnIgPSB0ZWdyYV9zb3JfYXR0YWNoKHNvcik7Ci0J
aWYgKGVyciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gYXR0YWNoIFNPUjog
JWRcbiIsIGVycik7Ci0KLQl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRsKGRjLCBEQ19ESVNQX0RJU1Bf
V0lOX09QVElPTlMpOwotCXZhbHVlIHw9IFNPUl9FTkFCTEUoMCk7Ci0JdGVncmFfZGNfd3JpdGVs
KGRjLCB2YWx1ZSwgRENfRElTUF9ESVNQX1dJTl9PUFRJT05TKTsKLQotCXRlZ3JhX2RjX2NvbW1p
dChkYyk7Ci0KLQllcnIgPSB0ZWdyYV9zb3Jfd2FrZXVwKHNvcik7Ci0JaWYgKGVyciA8IDApCi0J
CWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gd2FrZXVwIFNPUjogJWRcbiIsIGVycik7Ci0K
LQlpZiAob3V0cHV0LT5wYW5lbCkKLQkJZHJtX3BhbmVsX2VuYWJsZShvdXRwdXQtPnBhbmVsKTsK
LX0KLQogc3RhdGljIGludAogdGVncmFfc29yX2VuY29kZXJfYXRvbWljX2NoZWNrKHN0cnVjdCBk
cm1fZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCkBAIC0yMTU1LDEyICsxODU2LDYgQEAgdGVncmFfc29yX2VuY29kZXJfYXRvbWlj
X2NoZWNrKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKIAlyZXR1cm4gMDsKIH0KIAotc3Rh
dGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MgdGVncmFfc29yX2VkcF9o
ZWxwZXJzID0gewotCS5kaXNhYmxlID0gdGVncmFfc29yX2VkcF9kaXNhYmxlLAotCS5lbmFibGUg
PSB0ZWdyYV9zb3JfZWRwX2VuYWJsZSwKLQkuYXRvbWljX2NoZWNrID0gdGVncmFfc29yX2VuY29k
ZXJfYXRvbWljX2NoZWNrLAotfTsKLQogc3RhdGljIGlubGluZSB1MzIgdGVncmFfc29yX2hkbWlf
c3VicGFjayhjb25zdCB1OCAqcHRyLCBzaXplX3Qgc2l6ZSkKIHsKIAl1MzIgdmFsdWUgPSAwOwpA
QCAtMjUzNSw5ICsyMjMwLDkgQEAgc3RhdGljIHZvaWQgdGVncmFfc29yX2hkbWlfZGlzYWJsZShz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJdmFsdWUgPSB0ZWdyYV9kY19yZWFkbChkYywg
RENfRElTUF9ESVNQX1dJTl9PUFRJT05TKTsKIAogCWlmICghc29yLT5zb2MtPmhhc19udmRpc3Bs
YXkpCi0JCXZhbHVlICY9IH4oU09SMV9USU1JTkdfQ1lBIHwgU09SX0VOQUJMRSgxKSk7Ci0JZWxz
ZQotCQl2YWx1ZSAmPSB+U09SX0VOQUJMRShzb3ItPmluZGV4KTsKKwkJdmFsdWUgJj0gflNPUjFf
VElNSU5HX0NZQTsKKworCXZhbHVlICY9IH5TT1JfRU5BQkxFKHNvci0+aW5kZXgpOwogCiAJdGVn
cmFfZGNfd3JpdGVsKGRjLCB2YWx1ZSwgRENfRElTUF9ESVNQX1dJTl9PUFRJT05TKTsKIApAQCAt
MjkyOCw5ICsyNjIzLDkgQEAgc3RhdGljIHZvaWQgdGVncmFfc29yX2hkbWlfZW5hYmxlKHN0cnVj
dCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRsKGRjLCBEQ19E
SVNQX0RJU1BfV0lOX09QVElPTlMpOwogCiAJaWYgKCFzb3ItPnNvYy0+aGFzX252ZGlzcGxheSkK
LQkJdmFsdWUgfD0gU09SX0VOQUJMRSgxKSB8IFNPUjFfVElNSU5HX0NZQTsKLQllbHNlCi0JCXZh
bHVlIHw9IFNPUl9FTkFCTEUoc29yLT5pbmRleCk7CisJCXZhbHVlIHw9IFNPUjFfVElNSU5HX0NZ
QTsKKworCXZhbHVlIHw9IFNPUl9FTkFCTEUoc29yLT5pbmRleCk7CiAKIAl0ZWdyYV9kY193cml0
ZWwoZGMsIHZhbHVlLCBEQ19ESVNQX0RJU1BfV0lOX09QVElPTlMpOwogCkBAIC0yOTY1LDYgKzI2
NjAsOSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZHBfZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIpCiAJdTMyIHZhbHVlOwogCWludCBlcnI7CiAKKwlpZiAob3V0cHV0LT5wYW5l
bCkKKwkJZHJtX3BhbmVsX2Rpc2FibGUob3V0cHV0LT5wYW5lbCk7CisKIAllcnIgPSBkcm1fZHBf
bGlua19wb3dlcl9kb3duKHNvci0+YXV4LCAmc29yLT5saW5rKTsKIAlpZiAoZXJyIDwgMCkKIAkJ
ZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBwb3dlciBkb3duIGxpbms6ICVkXG4iLCBlcnIp
OwpAQCAtMjk3NywxMiArMjY3NSw3IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9kcF9kaXNhYmxl
KHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAl0ZWdyYV9zb3JfdXBkYXRlKHNvcik7CiAK
IAl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRsKGRjLCBEQ19ESVNQX0RJU1BfV0lOX09QVElPTlMpOwot
Ci0JaWYgKCFzb3ItPnNvYy0+aGFzX252ZGlzcGxheSkKLQkJdmFsdWUgJj0gfihTT1IxX1RJTUlO
R19DWUEgfCBTT1JfRU5BQkxFKDEpKTsKLQllbHNlCi0JCXZhbHVlICY9IH5TT1JfRU5BQkxFKHNv
ci0+aW5kZXgpOwotCisJdmFsdWUgJj0gflNPUl9FTkFCTEUoc29yLT5pbmRleCk7CiAJdGVncmFf
ZGNfd3JpdGVsKGRjLCB2YWx1ZSwgRENfRElTUF9ESVNQX1dJTl9PUFRJT05TKTsKIAl0ZWdyYV9k
Y19jb21taXQoZGMpOwogCkBAIC0zMDEwLDYgKzI3MDMsOSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9z
b3JfZHBfZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJaWYgKGVyciA8IDAp
CiAJCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgZGlzYWJsZSBEUEFVWDogJWRcbiIsIGVycik7
CiAKKwlpZiAob3V0cHV0LT5wYW5lbCkKKwkJZHJtX3BhbmVsX3VucHJlcGFyZShvdXRwdXQtPnBh
bmVsKTsKKwogCXBtX3J1bnRpbWVfcHV0KHNvci0+ZGV2KTsKIH0KIApAQCAtMzA1MSwxMCArMjc0
NywxNSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZHBfZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2Rl
ciAqZW5jb2RlcikKIAlpZiAoZXJyIDwgMCkKIAkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0
byBwcm9iZSBEUCBsaW5rOiAlZFxuIiwgZXJyKTsKIAorCXRlZ3JhX3Nvcl9maWx0ZXJfcmF0ZXMo
c29yKTsKKwogCWVyciA9IGRybV9kcF9saW5rX2Nob29zZSgmc29yLT5saW5rLCBtb2RlLCBpbmZv
KTsKIAlpZiAoZXJyIDwgMCkKIAkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBjaG9vc2Ug
bGluazogJWRcbiIsIGVycik7CiAKKwlpZiAob3V0cHV0LT5wYW5lbCkKKwkJZHJtX3BhbmVsX3By
ZXBhcmUob3V0cHV0LT5wYW5lbCk7CisKIAl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIHNv
ci0+c29jLT5yZWdzLT5wbGwyKTsKIAl2YWx1ZSAmPSB+U09SX1BMTDJfQkFOREdBUF9QT1dFUkRP
V047CiAJdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBzb3ItPnNvYy0+cmVncy0+cGxsMik7
CkBAIC0zMDgzLDE0ICsyNzg0LDIzIEBAIHN0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9kcF9lbmFibGUo
c3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQogCiAJdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwo
c29yLCBTT1JfQ0xLX0NOVFJMKTsKIAl2YWx1ZSAmPSB+U09SX0NMS19DTlRSTF9EUF9DTEtfU0VM
X01BU0s7Ci0JdmFsdWUgfD0gU09SX0NMS19DTlRSTF9EUF9DTEtfU0VMX0RJRkZfRFBDTEs7CisK
KwlpZiAob3V0cHV0LT5wYW5lbCkKKwkJdmFsdWUgfD0gU09SX0NMS19DTlRSTF9EUF9DTEtfU0VM
X1NJTkdMRV9EUENMSzsKKwllbHNlCisJCXZhbHVlIHw9IFNPUl9DTEtfQ05UUkxfRFBfQ0xLX1NF
TF9ESUZGX0RQQ0xLOworCiAJdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfQ0xLX0NO
VFJMKTsKIAogCXVzbGVlcF9yYW5nZSgyMDAsIDQwMCk7CiAKIAl2YWx1ZSA9IHRlZ3JhX3Nvcl9y
ZWFkbChzb3IsIFNPUl9EUF9TUEFSRTApOwogCS8qIFhYWCBub3QgaW4gVFJNICovCi0JdmFsdWUg
Jj0gflNPUl9EUF9TUEFSRV9QQU5FTF9JTlRFUk5BTDsKKwlpZiAob3V0cHV0LT5wYW5lbCkKKwkJ
dmFsdWUgfD0gU09SX0RQX1NQQVJFX1BBTkVMX0lOVEVSTkFMOworCWVsc2UKKwkJdmFsdWUgJj0g
flNPUl9EUF9TUEFSRV9QQU5FTF9JTlRFUk5BTDsKKwogCXZhbHVlIHw9IFNPUl9EUF9TUEFSRV9T
RVFfRU5BQkxFOwogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgU09SX0RQX1NQQVJFMCk7
CiAKQEAgLTMxNzcsNiArMjg4NywxOSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZHBfZW5hYmxl
KHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAogCXRlZ3JhX3Nvcl9hcHBseV9jb25maWco
c29yLCAmY29uZmlnKTsKIAl0ZWdyYV9zb3JfbW9kZV9zZXQoc29yLCBtb2RlLCBzdGF0ZSk7CisK
KwlpZiAob3V0cHV0LT5wYW5lbCkgeworCQkvKiBDU1RNIChMVkRTLCBsaW5rIEEvQiwgdXBwZXIp
ICovCisJCXZhbHVlID0gU09SX0NTVE1fTFZEUyB8IFNPUl9DU1RNX0xJTktfQUNUX0EgfCBTT1Jf
Q1NUTV9MSU5LX0FDVF9CIHwKKwkJCVNPUl9DU1RNX1VQUEVSOworCQl0ZWdyYV9zb3Jfd3JpdGVs
KHNvciwgdmFsdWUsIFNPUl9DU1RNKTsKKworCQkvKiBQV00gc2V0dXAgKi8KKwkJZXJyID0gdGVn
cmFfc29yX3NldHVwX3B3bShzb3IsIDI1MCk7CisJCWlmIChlcnIgPCAwKQorCQkJZGV2X2Vycihz
b3ItPmRldiwgImZhaWxlZCB0byBzZXR1cCBQV006ICVkXG4iLCBlcnIpOworCX0KKwogCXRlZ3Jh
X3Nvcl91cGRhdGUoc29yKTsKIAogCWVyciA9IHRlZ3JhX3Nvcl9wb3dlcl91cChzb3IsIDI1MCk7
CkBAIC0zMTk3LDYgKzI5MjAsOSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZHBfZW5hYmxlKHN0
cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAllcnIgPSB0ZWdyYV9zb3Jfd2FrZXVwKHNvcik7
CiAJaWYgKGVyciA8IDApCiAJCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gd2FrZXVwIFNP
UjogJWRcbiIsIGVycik7CisKKwlpZiAob3V0cHV0LT5wYW5lbCkKKwkJZHJtX3BhbmVsX2VuYWJs
ZShvdXRwdXQtPnBhbmVsKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9o
ZWxwZXJfZnVuY3MgdGVncmFfc29yX2RwX2hlbHBlcnMgPSB7CkBAIC0zMjA1LDEwICsyOTMxLDYg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MgdGVncmFfc29y
X2RwX2hlbHBlcnMgPSB7CiAJLmF0b21pY19jaGVjayA9IHRlZ3JhX3Nvcl9lbmNvZGVyX2F0b21p
Y19jaGVjaywKIH07CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfc29yX29wcyB0ZWdyYV9z
b3JfZWRwX29wcyA9IHsKLQkubmFtZSA9ICJlRFAiLAotfTsKLQogc3RhdGljIGludCB0ZWdyYV9z
b3JfaGRtaV9wcm9iZShzdHJ1Y3QgdGVncmFfc29yICpzb3IpCiB7CiAJaW50IGVycjsKQEAgLTMz
MzAsMTAgKzMwNTIsMTAgQEAgc3RhdGljIGludCB0ZWdyYV9zb3JfaW5pdChzdHJ1Y3QgaG9zdDF4
X2NsaWVudCAqY2xpZW50KQogCQkJZW5jb2RlciA9IERSTV9NT0RFX0VOQ09ERVJfTFZEUzsKIAkJ
fQogCX0gZWxzZSB7Ci0JCWlmIChzb3ItPm9wcyA9PSAmdGVncmFfc29yX2VkcF9vcHMpIHsKKwkJ
aWYgKHNvci0+b3V0cHV0LnBhbmVsKSB7CiAJCQljb25uZWN0b3IgPSBEUk1fTU9ERV9DT05ORUNU
T1JfZURQOwogCQkJZW5jb2RlciA9IERSTV9NT0RFX0VOQ09ERVJfVE1EUzsKLQkJCWhlbHBlcnMg
PSAmdGVncmFfc29yX2VkcF9oZWxwZXJzOworCQkJaGVscGVycyA9ICZ0ZWdyYV9zb3JfZHBfaGVs
cGVyczsKIAkJfSBlbHNlIHsKIAkJCWNvbm5lY3RvciA9IERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNw
bGF5UG9ydDsKIAkJCWVuY29kZXIgPSBEUk1fTU9ERV9FTkNPREVSX1RNRFM7CkBAIC0zNTc1LDEw
ICszMjk3LDExIEBAIHN0YXRpYyBjb25zdCB1OCB0ZWdyYTEyNF9zb3JfdHhfcHVbNF1bNF1bNF0g
PSB7CiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9zb2MgdGVncmExMjRfc29y
ID0gewotCS5zdXBwb3J0c19lZHAgPSB0cnVlLAogCS5zdXBwb3J0c19sdmRzID0gdHJ1ZSwKIAku
c3VwcG9ydHNfaGRtaSA9IGZhbHNlLAotCS5zdXBwb3J0c19kcCA9IGZhbHNlLAorCS5zdXBwb3J0
c19kcCA9IHRydWUsCisJLnN1cHBvcnRzX2F1ZGlvID0gZmFsc2UsCisJLnN1cHBvcnRzX2hkY3Ag
PSBmYWxzZSwKIAkucmVncyA9ICZ0ZWdyYTEyNF9zb3JfcmVncywKIAkuaGFzX252ZGlzcGxheSA9
IGZhbHNlLAogCS54YmFyX2NmZyA9IHRlZ3JhMTI0X3Nvcl94YmFyX2NmZywKQEAgLTM2MTQsMTAg
KzMzMzcsMTEgQEAgc3RhdGljIGNvbnN0IHU4IHRlZ3JhMTMyX3Nvcl9wcmVfZW1waGFzaXNbNF1b
NF1bNF0gPSB7CiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9zb2MgdGVncmEx
MzJfc29yID0gewotCS5zdXBwb3J0c19lZHAgPSB0cnVlLAogCS5zdXBwb3J0c19sdmRzID0gdHJ1
ZSwKIAkuc3VwcG9ydHNfaGRtaSA9IGZhbHNlLAotCS5zdXBwb3J0c19kcCA9IGZhbHNlLAorCS5z
dXBwb3J0c19kcCA9IHRydWUsCisJLnN1cHBvcnRzX2F1ZGlvID0gZmFsc2UsCisJLnN1cHBvcnRz
X2hkY3AgPSBmYWxzZSwKIAkucmVncyA9ICZ0ZWdyYTEyNF9zb3JfcmVncywKIAkuaGFzX252ZGlz
cGxheSA9IGZhbHNlLAogCS54YmFyX2NmZyA9IHRlZ3JhMTI0X3Nvcl94YmFyX2NmZywKQEAgLTM2
NTIsMTAgKzMzNzYsMTEgQEAgc3RhdGljIGNvbnN0IHU4IHRlZ3JhMjEwX3Nvcl9sYW5lX21hcFs0
XSA9IHsKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfc29yX3NvYyB0ZWdyYTIxMF9z
b3IgPSB7Ci0JLnN1cHBvcnRzX2VkcCA9IHRydWUsCiAJLnN1cHBvcnRzX2x2ZHMgPSBmYWxzZSwK
IAkuc3VwcG9ydHNfaGRtaSA9IGZhbHNlLAotCS5zdXBwb3J0c19kcCA9IGZhbHNlLAorCS5zdXBw
b3J0c19kcCA9IHRydWUsCisJLnN1cHBvcnRzX2F1ZGlvID0gZmFsc2UsCisJLnN1cHBvcnRzX2hk
Y3AgPSBmYWxzZSwKIAogCS5yZWdzID0gJnRlZ3JhMjEwX3Nvcl9yZWdzLAogCS5oYXNfbnZkaXNw
bGF5ID0gZmFsc2UsCkBAIC0zNjY5LDEwICszMzk0LDExIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
dGVncmFfc29yX3NvYyB0ZWdyYTIxMF9zb3IgPSB7CiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0
IHRlZ3JhX3Nvcl9zb2MgdGVncmEyMTBfc29yMSA9IHsKLQkuc3VwcG9ydHNfZWRwID0gZmFsc2Us
CiAJLnN1cHBvcnRzX2x2ZHMgPSBmYWxzZSwKIAkuc3VwcG9ydHNfaGRtaSA9IHRydWUsCiAJLnN1
cHBvcnRzX2RwID0gdHJ1ZSwKKwkuc3VwcG9ydHNfYXVkaW8gPSB0cnVlLAorCS5zdXBwb3J0c19o
ZGNwID0gdHJ1ZSwKIAogCS5yZWdzID0gJnRlZ3JhMjEwX3Nvcl9yZWdzLAogCS5oYXNfbnZkaXNw
bGF5ID0gZmFsc2UsCkBAIC0zNzUxLDEwICszNDc3LDExIEBAIHN0YXRpYyBjb25zdCB1OCB0ZWdy
YTE4Nl9zb3JfcHJlX2VtcGhhc2lzWzRdWzRdWzRdID0gewogfTsKIAogc3RhdGljIGNvbnN0IHN0
cnVjdCB0ZWdyYV9zb3Jfc29jIHRlZ3JhMTg2X3NvciA9IHsKLQkuc3VwcG9ydHNfZWRwID0gZmFs
c2UsCiAJLnN1cHBvcnRzX2x2ZHMgPSBmYWxzZSwKIAkuc3VwcG9ydHNfaGRtaSA9IHRydWUsCiAJ
LnN1cHBvcnRzX2RwID0gdHJ1ZSwKKwkuc3VwcG9ydHNfYXVkaW8gPSB0cnVlLAorCS5zdXBwb3J0
c19oZGNwID0gdHJ1ZSwKIAogCS5yZWdzID0gJnRlZ3JhMTg2X3Nvcl9yZWdzLAogCS5oYXNfbnZk
aXNwbGF5ID0gdHJ1ZSwKQEAgLTM3ODUsMTAgKzM1MTIsMTEgQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCB0ZWdyYV9zb3JfcmVncyB0ZWdyYTE5NF9zb3JfcmVncyA9IHsKIH07CiAKIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgdGVncmFfc29yX3NvYyB0ZWdyYTE5NF9zb3IgPSB7Ci0JLnN1cHBvcnRzX2VkcCA9
IHRydWUsCiAJLnN1cHBvcnRzX2x2ZHMgPSBmYWxzZSwKIAkuc3VwcG9ydHNfaGRtaSA9IHRydWUs
CiAJLnN1cHBvcnRzX2RwID0gdHJ1ZSwKKwkuc3VwcG9ydHNfYXVkaW8gPSB0cnVlLAorCS5zdXBw
b3J0c19oZGNwID0gdHJ1ZSwKIAogCS5yZWdzID0gJnRlZ3JhMTk0X3Nvcl9yZWdzLAogCS5oYXNf
bnZkaXNwbGF5ID0gdHJ1ZSwKQEAgLTM4MzYsNyArMzU2NCw3IEBAIHN0YXRpYyBpbnQgdGVncmFf
c29yX3BhcnNlX2R0KHN0cnVjdCB0ZWdyYV9zb3IgKnNvcikKIAkJICovCiAJCXNvci0+cGFkID0g
VEVHUkFfSU9fUEFEX0hETUlfRFAwICsgc29yLT5pbmRleDsKIAl9IGVsc2UgewotCQlpZiAoc29y
LT5zb2MtPnN1cHBvcnRzX2VkcCkKKwkJaWYgKCFzb3ItPnNvYy0+c3VwcG9ydHNfYXVkaW8pCiAJ
CQlzb3ItPmluZGV4ID0gMDsKIAkJZWxzZQogCQkJc29yLT5pbmRleCA9IDE7CkBAIC0zOTI5LDE2
ICszNjU3LDE1IEBAIHN0YXRpYyBpbnQgdGVncmFfc29yX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9k
ZXZpY2UgKnBkZXYpCiAJCQlyZXR1cm4gLUVOT0RFVjsKIAkJfQogCX0gZWxzZSB7Ci0JCWlmIChz
b3ItPnNvYy0+c3VwcG9ydHNfZWRwKSB7Ci0JCQlzb3ItPm9wcyA9ICZ0ZWdyYV9zb3JfZWRwX29w
czsKLQkJCXNvci0+cGFkID0gVEVHUkFfSU9fUEFEX0xWRFM7Ci0JCX0gZWxzZSBpZiAoc29yLT5z
b2MtPnN1cHBvcnRzX2RwKSB7Ci0JCQlzb3ItPm9wcyA9ICZ0ZWdyYV9zb3JfZHBfb3BzOwotCQkJ
c29yLT5wYWQgPSBURUdSQV9JT19QQURfTFZEUzsKLQkJfSBlbHNlIHsKLQkJCWRldl9lcnIoJnBk
ZXYtPmRldiwgInVua25vd24gKERQKSBzdXBwb3J0XG4iKTsKLQkJCXJldHVybiAtRU5PREVWOwot
CQl9CisJCW5wID0gb2ZfcGFyc2VfcGhhbmRsZShwZGV2LT5kZXYub2Zfbm9kZSwgIm52aWRpYSxw
YW5lbCIsIDApOworCQkvKgorCQkgKiBObyBuZWVkIHRvIGtlZXAgdGhpcyBhcm91bmQgc2luY2Ug
d2Ugb25seSB1c2UgaXQgYXMgYSBjaGVjaworCQkgKiB0byBzZWUgaWYgYSBwYW5lbCBpcyBjb25u
ZWN0ZWQgKGVEUCkgb3Igbm90IChEUCkuCisJCSAqLworCQlvZl9ub2RlX3B1dChucCk7CisKKwkJ
c29yLT5vcHMgPSAmdGVncmFfc29yX2RwX29wczsKKwkJc29yLT5wYWQgPSBURUdSQV9JT19QQURf
TFZEUzsKIAl9CiAKIAllcnIgPSB0ZWdyYV9zb3JfcGFyc2VfZHQoc29yKTsKLS0gCjIuMjMuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
