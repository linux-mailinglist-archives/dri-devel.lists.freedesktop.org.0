Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D723919C33
	for <lists+dri-devel@lfdr.de>; Fri, 10 May 2019 13:09:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7899A89AB7;
	Fri, 10 May 2019 11:09:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay2-d.mail.gandi.net (relay2-d.mail.gandi.net
 [217.70.183.194])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8587789A76
 for <dri-devel@lists.freedesktop.org>; Fri, 10 May 2019 11:09:00 +0000 (UTC)
X-Originating-IP: 90.89.68.76
Received: from localhost (lfbn-1-10718-76.w90-89.abo.wanadoo.fr [90.89.68.76])
 (Authenticated sender: maxime.ripard@bootlin.com)
 by relay2-d.mail.gandi.net (Postfix) with ESMTPSA id 88FDA4000B;
 Fri, 10 May 2019 11:08:56 +0000 (UTC)
From: Maxime Ripard <maxime.ripard@bootlin.com>
To: Daniel Vetter <daniel.vetter@intel.com>, David Airlie <airlied@linux.ie>,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Sean Paul <seanpaul@chromium.org>,
 Maxime Ripard <maxime.ripard@bootlin.com>
Subject: [PATCH v2 2/6] drm: Remove users of drm_format_num_planes
Date: Fri, 10 May 2019 13:08:47 +0200
Message-Id: <5ffcec9d14a50ed538e37d565f546802452ee672.1557486447.git-series.maxime.ripard@bootlin.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <27b0041c7977402df4a087c78d2849ffe51c9f1c.1557486447.git-series.maxime.ripard@bootlin.com>
References: <27b0041c7977402df4a087c78d2849ffe51c9f1c.1557486447.git-series.maxime.ripard@bootlin.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Emil Velikov <emil.velikov@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

ZHJtX2Zvcm1hdF9udW1fcGxhbmVzKCkgaXMgYmFzaWNhbGx5IGEgbG9va3VwIGluIHRoZSBkcm1f
Zm9ybWF0X2luZm8gdGFibGUKcGx1cyBhbiBhY2Nlc3MgdG8gdGhlIG51bV9wbGFuZXMgZmllbGQg
b2YgdGhlIGFwcHJvcHJpYXRlIGVudHJ5LgoKTW9zdCBkcml2ZXJzIGFyZSB1c2luZyB0aGlzIGZ1
bmN0aW9uIHdoaWxlIGhhdmluZyBhY2Nlc3MgdG8gdGhlIGVudHJ5CmFscmVhZHksIHdoaWNoIG1l
YW5zIHRoYXQgd2Ugd2lsbCBwZXJmb3JtIGFuIHVubmVjZXNzYXJ5IGxvb2t1cC4gUmVtb3ZpbmcK
dGhlIGNhbGwgdG8gZHJtX2Zvcm1hdF9udW1fcGxhbmVzIGlzIHRoZXJlZm9yZSBtb3JlIGVmZmlj
aWVudC4KClNvbWUgZHJpdmVycyB3aWxsIG5vdCBoYXZlIGFjY2VzcyB0byB0aGF0IGVudHJ5IGlu
IHRoZSBmdW5jdGlvbiwgYnV0IGluCnRoaXMgY2FzZSB0aGUgb3ZlcmhlYWQgaXMgbWluaW1hbCAo
d2UganVzdCBoYXZlIHRvIGNhbGwgZHJtX2Zvcm1hdF9pbmZvKCkKdG8gcGVyZm9ybSB0aGUgbG9v
a3VwKSBhbmQgd2UgY2FuIGV2ZW4gYXZvaWQgbXVsdGlwbGUsIGluZWZmaWNpZW50IGxvb2t1cHMK
aW4gc29tZSBwbGFjZXMgdGhhdCBuZWVkIG11bHRpcGxlIGZpZWxkcyBmcm9tIHRoZSBkcm1fZm9y
bWF0X2luZm8Kc3RydWN0dXJlLgoKUmV2aWV3ZWQtYnk6IEVtaWwgVmVsaWtvdiA8ZW1pbC52ZWxp
a292QGNvbGxhYm9yYS5jb20+ClJldmlld2VkLWJ5OiBQYXVsIEtvY2lhbGtvd3NraSA8cGF1bC5r
b2NpYWxrb3dza2lAYm9vdGxpbi5jb20+ClNpZ25lZC1vZmYtYnk6IE1heGltZSBSaXBhcmQgPG1h
eGltZS5yaXBhcmRAYm9vdGxpbi5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FybS9tYWxpZHBf
bXcuYyAgICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYXJtYWRhL2FybWFkYV9m
Yi5jICAgICAgICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2ZvdXJjYy5jICAgICAg
ICAgICAgICAgIHwgMTYgLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVr
L210a19kcm1fZmIuYyAgICAgICB8ICA2ICsrKystLQogZHJpdmVycy9ncHUvZHJtL21lc29uL21l
c29uX292ZXJsYXkuYyAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1
MS9kcHVfZm9ybWF0cy5jIHwgIDkgKysrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3Av
bWRwNS9tZHA1X3NtcC5jICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9mYi5j
ICAgICAgICAgICAgICAgIHwgIDggKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL29t
YXBfZmIuYyAgICAgICAgICAgfCAgNCArKystCiBkcml2ZXJzL2dwdS9kcm0vcm9ja2NoaXAvcm9j
a2NoaXBfZHJtX2ZiLmMgIHwgIDYgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vdGVncmEvZmIuYyAg
ICAgICAgICAgICAgICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9wbGFuZS5j
ICAgICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS96dGUvenhfcGxhbmUuYyAgICAg
ICAgICAgICAgfCAgNCArLS0tCiBpbmNsdWRlL2RybS9kcm1fZm91cmNjLmggICAgICAgICAgICAg
ICAgICAgIHwgIDEgLQogMTQgZmlsZXMgY2hhbmdlZCwgMzIgaW5zZXJ0aW9ucygrKSwgMzcgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FybS9tYWxpZHBfbXcuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hcm0vbWFsaWRwX213LmMKaW5kZXggNWYxMDJiZGFmODQxLi4yZTgx
MjUyNTAyNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hcm0vbWFsaWRwX213LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2FybS9tYWxpZHBfbXcuYwpAQCAtMTU4LDcgKzE1OCw3IEBAIG1h
bGlkcF9td19lbmNvZGVyX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIs
CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCW5fcGxhbmVzID0gZHJtX2Zvcm1hdF9udW1fcGxh
bmVzKGZiLT5mb3JtYXQtPmZvcm1hdCk7CisJbl9wbGFuZXMgPSBmYi0+Zm9ybWF0LT5udW1fcGxh
bmVzOwogCWZvciAoaSA9IDA7IGkgPCBuX3BsYW5lczsgaSsrKSB7CiAJCXN0cnVjdCBkcm1fZ2Vt
X2NtYV9vYmplY3QgKm9iaiA9IGRybV9mYl9jbWFfZ2V0X2dlbV9vYmooZmIsIGkpOwogCQkvKiBt
ZW1vcnkgd3JpdGUgYnVmZmVycyBhcmUgbmV2ZXIgcm90YXRlZCAqLwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FybWFkYS9hcm1hZGFfZmIuYyBiL2RyaXZlcnMvZ3B1L2RybS9hcm1hZGEv
YXJtYWRhX2ZiLmMKaW5kZXggMDU4YWM3ZDk5MjBmLi5hMmY2NDcyZWI0ODIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hcm1hZGEvYXJtYWRhX2ZiLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2FybWFkYS9hcm1hZGFfZmIuYwpAQCAtODcsNiArODcsNyBAQCBzdHJ1Y3QgYXJtYWRhX2ZyYW1l
YnVmZmVyICphcm1hZGFfZnJhbWVidWZmZXJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICphcm1hZGFfZmJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsCiAJc3RydWN0IGRybV9maWxlICpkZmlsZSwgY29uc3Qgc3RydWN0IGRybV9tb2Rl
X2ZiX2NtZDIgKm1vZGUpCiB7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9
IGRybV9nZXRfZm9ybWF0X2luZm8oZGV2LCBtb2RlKTsKIAlzdHJ1Y3QgYXJtYWRhX2dlbV9vYmpl
Y3QgKm9iajsKIAlzdHJ1Y3QgYXJtYWRhX2ZyYW1lYnVmZmVyICpkZmI7CiAJaW50IHJldDsKQEAg
LTk3LDcgKzk4LDcgQEAgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqYXJtYWRhX2ZiX2NyZWF0ZShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQltb2RlLT5waXRjaGVzWzJdKTsKIAogCS8qIFdlIGNh
biBvbmx5IGhhbmRsZSBhIHNpbmdsZSBwbGFuZSBhdCB0aGUgbW9tZW50ICovCi0JaWYgKGRybV9m
b3JtYXRfbnVtX3BsYW5lcyhtb2RlLT5waXhlbF9mb3JtYXQpID4gMSAmJgorCWlmIChpbmZvLT5u
dW1fcGxhbmVzID4gMSAmJgogCSAgICAobW9kZS0+aGFuZGxlc1swXSAhPSBtb2RlLT5oYW5kbGVz
WzFdIHx8CiAJICAgICBtb2RlLT5oYW5kbGVzWzBdICE9IG1vZGUtPmhhbmRsZXNbMl0pKSB7CiAJ
CXJldCA9IC1FSU5WQUw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2ZvdXJjYy5j
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9mb3VyY2MuYwppbmRleCA2ZWE1NWZiNDUyNmQuLjg3M2Mw
MDAxZDhjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9mb3VyY2MuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2ZvdXJjYy5jCkBAIC0zMzMsMjIgKzMzMyw2IEBAIGRybV9nZXRf
Zm9ybWF0X2luZm8oc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIEVYUE9SVF9TWU1CT0woZHJtX2dl
dF9mb3JtYXRfaW5mbyk7CiAKIC8qKgotICogZHJtX2Zvcm1hdF9udW1fcGxhbmVzIC0gZ2V0IHRo
ZSBudW1iZXIgb2YgcGxhbmVzIGZvciBmb3JtYXQKLSAqIEBmb3JtYXQ6IHBpeGVsIGZvcm1hdCAo
RFJNX0ZPUk1BVF8qKQotICoKLSAqIFJldHVybnM6Ci0gKiBUaGUgbnVtYmVyIG9mIHBsYW5lcyB1
c2VkIGJ5IHRoZSBzcGVjaWZpZWQgcGl4ZWwgZm9ybWF0LgotICovCi1pbnQgZHJtX2Zvcm1hdF9u
dW1fcGxhbmVzKHVpbnQzMl90IGZvcm1hdCkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICppbmZvOwotCi0JaW5mbyA9IGRybV9mb3JtYXRfaW5mbyhmb3JtYXQpOwotCXJldHVybiBp
bmZvID8gaW5mby0+bnVtX3BsYW5lcyA6IDE7Ci19Ci1FWFBPUlRfU1lNQk9MKGRybV9mb3JtYXRf
bnVtX3BsYW5lcyk7Ci0KLS8qKgogICogZHJtX2Zvcm1hdF9wbGFuZV9jcHAgLSBkZXRlcm1pbmUg
dGhlIGJ5dGVzIHBlciBwaXhlbCB2YWx1ZQogICogQGZvcm1hdDogcGl4ZWwgZm9ybWF0IChEUk1f
Rk9STUFUXyopCiAgKiBAcGxhbmU6IHBsYW5lIGluZGV4CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kcm1fZmIuYwppbmRleCBlMjBmY2FlZjI4NTEuLjY4ZmRlZjhiMTJiZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fZmIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vbWVkaWF0ZWsvbXRrX2RybV9mYi5jCkBAIC0zMiwxMCArMzIsMTEgQEAgc3RhdGljIHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKm10a19kcm1fZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCQkJCQljb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqbW9kZSwKIAkJ
CQkJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiB7CisJY29uc3Qgc3RydWN0IGRybV9mb3Jt
YXRfaW5mbyAqaW5mbyA9IGRybV9nZXRfZm9ybWF0X2luZm8oZGV2LCBtb2RlKTsKIAlzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYjsKIAlpbnQgcmV0OwogCi0JaWYgKGRybV9mb3JtYXRfbnVtX3Bs
YW5lcyhtb2RlLT5waXhlbF9mb3JtYXQpICE9IDEpCisJaWYgKGluZm8tPm51bV9wbGFuZXMgIT0g
MSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKIAlmYiA9IGt6YWxsb2Moc2l6ZW9mKCpm
YiksIEdGUF9LRVJORUwpOwpAQCAtODgsNiArODksNyBAQCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICptdGtfZHJtX21vZGVfZmJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSAg
ICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCiAJCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJt
X21vZGVfZmJfY21kMiAqY21kKQogeworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmlu
Zm8gPSBkcm1fZ2V0X2Zvcm1hdF9pbmZvKGRldiwgY21kKTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYjsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbTsKIAl1bnNpZ25lZCBpbnQgd2lk
dGggPSBjbWQtPndpZHRoOwpAQCAtOTUsNyArOTcsNyBAQCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICptdGtfZHJtX21vZGVfZmJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJdW5zaWdu
ZWQgaW50IHNpemUsIGJwcDsKIAlpbnQgcmV0OwogCi0JaWYgKGRybV9mb3JtYXRfbnVtX3BsYW5l
cyhjbWQtPnBpeGVsX2Zvcm1hdCkgIT0gMSkKKwlpZiAoaW5mby0+bnVtX3BsYW5lcyAhPSAxKQog
CQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAogCWdlbSA9IGRybV9nZW1fb2JqZWN0X2xvb2t1
cChmaWxlLCBjbWQtPmhhbmRsZXNbMF0pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21l
c29uL21lc29uX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZXNvbi9tZXNvbl9vdmVybGF5
LmMKaW5kZXggYmRiZjkyNWZmM2U4Li5mYjg1MTViMjg2MGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9tZXNvbi9tZXNvbl9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21lc29u
L21lc29uX292ZXJsYXkuYwpAQCAtNDU4LDcgKzQ1OCw3IEBAIHN0YXRpYyB2b2lkIG1lc29uX292
ZXJsYXlfYXRvbWljX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAl9CiAKIAkvKiBV
cGRhdGUgQ2FudmFzIHdpdGggYnVmZmVyIGFkZHJlc3MgKi8KLQlwcml2LT52aXUudmQxX3BsYW5l
cyA9IGRybV9mb3JtYXRfbnVtX3BsYW5lcyhmYi0+Zm9ybWF0LT5mb3JtYXQpOworCXByaXYtPnZp
dS52ZDFfcGxhbmVzID0gZmItPmZvcm1hdC0+bnVtX3BsYW5lczsKIAogCXN3aXRjaCAocHJpdi0+
dml1LnZkMV9wbGFuZXMpIHsKIAljYXNlIDM6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
bXNtL2Rpc3AvZHB1MS9kcHVfZm9ybWF0cy5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2Rw
dTEvZHB1X2Zvcm1hdHMuYwppbmRleCBmNTlmZTFhOWY0YjkuLmMzZDQ5MWU4ZDQ0YiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2Zvcm1hdHMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfZm9ybWF0cy5jCkBAIC0xMDQwLDEwICsx
MDQwLDExIEBAIGludCBkcHVfZm9ybWF0X2NoZWNrX21vZGlmaWVkX2Zvcm1hdCgKIAkJY29uc3Qg
c3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKmNtZCwKIAkJc3RydWN0IGRybV9nZW1fb2JqZWN0ICoq
Ym9zKQogewotCWludCByZXQsIGksIG51bV9iYXNlX2ZtdF9wbGFuZXM7CisJY29uc3Qgc3RydWN0
IGRybV9mb3JtYXRfaW5mbyAqaW5mbzsKIAljb25zdCBzdHJ1Y3QgZHB1X2Zvcm1hdCAqZm10Owog
CXN0cnVjdCBkcHVfaHdfZm10X2xheW91dCBsYXlvdXQ7CiAJdWludDMyX3QgYm9zX3RvdGFsX3Np
emUgPSAwOworCWludCByZXQsIGk7CiAKIAlpZiAoIW1zbV9mbXQgfHwgIWNtZCB8fCAhYm9zKSB7
CiAJCURSTV9FUlJPUigiaW52YWxpZCBhcmd1bWVudHNcbiIpOwpAQCAtMTA1MSwxNCArMTA1Miwx
NiBAQCBpbnQgZHB1X2Zvcm1hdF9jaGVja19tb2RpZmllZF9mb3JtYXQoCiAJfQogCiAJZm10ID0g
dG9fZHB1X2Zvcm1hdChtc21fZm10KTsKLQludW1fYmFzZV9mbXRfcGxhbmVzID0gZHJtX2Zvcm1h
dF9udW1fcGxhbmVzKGZtdC0+YmFzZS5waXhlbF9mb3JtYXQpOworCWluZm8gPSBkcm1fZm9ybWF0
X2luZm8oZm10LT5iYXNlLnBpeGVsX2Zvcm1hdCk7CisJaWYgKCFpbmZvKQorCQlyZXR1cm4gLUVJ
TlZBTDsKIAogCXJldCA9IGRwdV9mb3JtYXRfZ2V0X3BsYW5lX3NpemVzKGZtdCwgY21kLT53aWR0
aCwgY21kLT5oZWlnaHQsCiAJCQkmbGF5b3V0LCBjbWQtPnBpdGNoZXMpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKLQlmb3IgKGkgPSAwOyBpIDwgbnVtX2Jhc2VfZm10X3BsYW5lczsgaSsr
KSB7CisJZm9yIChpID0gMDsgaSA8IGluZm8tPm51bV9wbGFuZXM7IGkrKykgewogCQlpZiAoIWJv
c1tpXSkgewogCQkJRFJNX0VSUk9SKCJpbnZhbGlkIGhhbmRsZSBmb3IgcGxhbmUgJWRcbiIsIGkp
OwogCQkJcmV0dXJuIC1FSU5WQUw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rp
c3AvbWRwNS9tZHA1X3NtcC5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9z
bXAuYwppbmRleCA2MTUzNTE0ZGIwNGMuLjcyYWI4ZDg5ZWZhNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9zbXAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
bXNtL2Rpc3AvbWRwNS9tZHA1X3NtcC5jCkBAIC0xMjcsMTMgKzEyNywxNCBAQCB1aW50MzJfdCBt
ZHA1X3NtcF9jYWxjdWxhdGUoc3RydWN0IG1kcDVfc21wICpzbXAsCiAJCWNvbnN0IHN0cnVjdCBt
ZHBfZm9ybWF0ICpmb3JtYXQsCiAJCXUzMiB3aWR0aCwgYm9vbCBoZGVjaW0pCiB7CisJY29uc3Qg
c3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9IGRybV9mb3JtYXRfaW5mbyhmb3JtYXQtPmJh
c2UucGl4ZWxfZm9ybWF0KTsKIAlzdHJ1Y3QgbWRwNV9rbXMgKm1kcDVfa21zID0gZ2V0X2ttcyhz
bXApOwogCWludCByZXYgPSBtZHA1X2NmZ19nZXRfaHdfcmV2KG1kcDVfa21zLT5jZmcpOwogCWlu
dCBpLCBoc3ViLCBucGxhbmVzLCBubGluZXM7CiAJdTMyIGZtdCA9IGZvcm1hdC0+YmFzZS5waXhl
bF9mb3JtYXQ7CiAJdWludDMyX3QgYmxrY2ZnID0gMDsKIAotCW5wbGFuZXMgPSBkcm1fZm9ybWF0
X251bV9wbGFuZXMoZm10KTsKKwlucGxhbmVzID0gaW5mby0+bnVtX3BsYW5lczsKIAloc3ViID0g
ZHJtX2Zvcm1hdF9ob3J6X2Nocm9tYV9zdWJzYW1wbGluZyhmbXQpOwogCiAJLyogZGlmZmVyZW50
IGlmIEJXQyAoY29tcHJlc3NlZCBmcmFtZWJ1ZmZlcj8pIGVuYWJsZWQ6ICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
ZmIuYwppbmRleCAxMzYwNTg5NzhlMGYuLjQzMmJlZGRhZmI5ZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9tc21fZmIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9mYi5j
CkBAIC0xMDYsOSArMTA2LDExIEBAIGNvbnN0IHN0cnVjdCBtc21fZm9ybWF0ICptc21fZnJhbWVi
dWZmZXJfZm9ybWF0KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQogc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqbXNtX2ZyYW1lYnVmZmVyX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICpt
b2RlX2NtZCkKIHsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICppbmZvID0gZHJtX2dl
dF9mb3JtYXRfaW5mbyhkZXYsCisJCQkJCQkJCSBtb2RlX2NtZCk7CiAJc3RydWN0IGRybV9nZW1f
b2JqZWN0ICpib3NbNF0gPSB7MH07CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7Ci0JaW50
IHJldCwgaSwgbiA9IGRybV9mb3JtYXRfbnVtX3BsYW5lcyhtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0
KTsKKwlpbnQgcmV0LCBpLCBuID0gaW5mby0+bnVtX3BsYW5lczsKIAogCWZvciAoaSA9IDA7IGkg
PCBuOyBpKyspIHsKIAkJYm9zW2ldID0gZHJtX2dlbV9vYmplY3RfbG9va3VwKGZpbGUsIG1vZGVf
Y21kLT5oYW5kbGVzW2ldKTsKQEAgLTEzNSw2ICsxMzcsOCBAQCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICptc21fZnJhbWVidWZmZXJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiBzdGF0
aWMgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqbXNtX2ZyYW1lYnVmZmVyX2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAkJY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21k
LCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipib3MpCiB7CisJY29uc3Qgc3RydWN0IGRybV9mb3Jt
YXRfaW5mbyAqaW5mbyA9IGRybV9nZXRfZm9ybWF0X2luZm8oZGV2LAorCQkJCQkJCQkgbW9kZV9j
bWQpOwogCXN0cnVjdCBtc21fZHJtX3ByaXZhdGUgKnByaXYgPSBkZXYtPmRldl9wcml2YXRlOwog
CXN0cnVjdCBtc21fa21zICprbXMgPSBwcml2LT5rbXM7CiAJc3RydWN0IG1zbV9mcmFtZWJ1ZmZl
ciAqbXNtX2ZiID0gTlVMTDsKQEAgLTE0Nyw3ICsxNTEsNyBAQCBzdGF0aWMgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqbXNtX2ZyYW1lYnVmZmVyX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
IAkJCWRldiwgbW9kZV9jbWQsIG1vZGVfY21kLT53aWR0aCwgbW9kZV9jbWQtPmhlaWdodCwKIAkJ
CShjaGFyICopJm1vZGVfY21kLT5waXhlbF9mb3JtYXQpOwogCi0JbiA9IGRybV9mb3JtYXRfbnVt
X3BsYW5lcyhtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0KTsKKwluID0gaW5mby0+bnVtX3BsYW5lczsK
IAloc3ViID0gZHJtX2Zvcm1hdF9ob3J6X2Nocm9tYV9zdWJzYW1wbGluZyhtb2RlX2NtZC0+cGl4
ZWxfZm9ybWF0KTsKIAl2c3ViID0gZHJtX2Zvcm1hdF92ZXJ0X2Nocm9tYV9zdWJzYW1wbGluZyht
b2RlX2NtZC0+cGl4ZWxfZm9ybWF0KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL29t
YXBkcm0vb21hcF9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vb21hcF9mYi5jCmluZGV4
IDRmOGViOWQwOGY5OS4uY2ZiNjQxMzYzYTMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
b21hcGRybS9vbWFwX2ZiLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vb21hcF9mYi5j
CkBAIC0yOTgsNyArMjk4LDkgQEAgdm9pZCBvbWFwX2ZyYW1lYnVmZmVyX2Rlc2NyaWJlKHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpvbWFwX2ZyYW1lYnVmZmVyX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQy
ICptb2RlX2NtZCkKIHsKLQl1bnNpZ25lZCBpbnQgbnVtX3BsYW5lcyA9IGRybV9mb3JtYXRfbnVt
X3BsYW5lcyhtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1h
dF9pbmZvICppbmZvID0gZHJtX2dldF9mb3JtYXRfaW5mbyhkZXYsCisJCQkJCQkJCSBtb2RlX2Nt
ZCk7CisJdW5zaWduZWQgaW50IG51bV9wbGFuZXMgPSBpbmZvLT5udW1fcGxhbmVzOwogCXN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqYm9zWzRdOwogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiOwog
CWludCBpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2Ry
bV9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV9mYi5jCmluZGV4
IDk3NDM4YmJiZTM4OS4uNjA2ZDE3NmQ1ZDk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
cm9ja2NoaXAvcm9ja2NoaXBfZHJtX2ZiLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JvY2tjaGlw
L3JvY2tjaGlwX2RybV9mYi5jCkBAIC03NCwxOSArNzQsMTkgQEAgc3RhdGljIHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKgogcm9ja2NoaXBfdXNlcl9mYl9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYsCiAJCQljb25zdCBzdHJ1Y3QgZHJtX21v
ZGVfZmJfY21kMiAqbW9kZV9jbWQpCiB7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAq
aW5mbyA9IGRybV9nZXRfZm9ybWF0X2luZm8oZGV2LAorCQkJCQkJCQkgbW9kZV9jbWQpOwogCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiOwogCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jqc1tS
T0NLQ0hJUF9NQVhfRkJfQlVGRkVSXTsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKIAl1
bnNpZ25lZCBpbnQgaHN1YjsKIAl1bnNpZ25lZCBpbnQgdnN1YjsKLQlpbnQgbnVtX3BsYW5lczsK
KwlpbnQgbnVtX3BsYW5lcyA9IG1pbl90KGludCwgaW5mby0+bnVtX3BsYW5lcywgUk9DS0NISVBf
TUFYX0ZCX0JVRkZFUik7CiAJaW50IHJldDsKIAlpbnQgaTsKIAogCWhzdWIgPSBkcm1fZm9ybWF0
X2hvcnpfY2hyb21hX3N1YnNhbXBsaW5nKG1vZGVfY21kLT5waXhlbF9mb3JtYXQpOwogCXZzdWIg
PSBkcm1fZm9ybWF0X3ZlcnRfY2hyb21hX3N1YnNhbXBsaW5nKG1vZGVfY21kLT5waXhlbF9mb3Jt
YXQpOwotCW51bV9wbGFuZXMgPSBtaW4oZHJtX2Zvcm1hdF9udW1fcGxhbmVzKG1vZGVfY21kLT5w
aXhlbF9mb3JtYXQpLAotCQkJIFJPQ0tDSElQX01BWF9GQl9CVUZGRVIpOwogCiAJZm9yIChpID0g
MDsgaSA8IG51bV9wbGFuZXM7IGkrKykgewogCQl1bnNpZ25lZCBpbnQgd2lkdGggPSBtb2RlX2Nt
ZC0+d2lkdGggLyAoaSA/IGhzdWIgOiAxKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90
ZWdyYS9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2ZiLmMKaW5kZXggMWRkODNhNzU3ZGJh
Li5kYTA3NDdlMzE3YjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9mYi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9mYi5jCkBAIC0xMzEsNiArMTMxLDcgQEAgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqdGVncmFfZmJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0s
CiAJCQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJCQkJY29uc3Qgc3RydWN0IGRybV9tb2Rl
X2ZiX2NtZDIgKmNtZCkKIHsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICppbmZvID0g
ZHJtX2dldF9mb3JtYXRfaW5mbyhkcm0sIGNtZCk7CiAJdW5zaWduZWQgaW50IGhzdWIsIHZzdWIs
IGk7CiAJc3RydWN0IHRlZ3JhX2JvICpwbGFuZXNbNF07CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpnZW07CkBAIC0xNDAsNyArMTQxLDcgQEAgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqdGVncmFf
ZmJfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sCiAJaHN1YiA9IGRybV9mb3JtYXRfaG9y
el9jaHJvbWFfc3Vic2FtcGxpbmcoY21kLT5waXhlbF9mb3JtYXQpOwogCXZzdWIgPSBkcm1fZm9y
bWF0X3ZlcnRfY2hyb21hX3N1YnNhbXBsaW5nKGNtZC0+cGl4ZWxfZm9ybWF0KTsKIAotCWZvciAo
aSA9IDA7IGkgPCBkcm1fZm9ybWF0X251bV9wbGFuZXMoY21kLT5waXhlbF9mb3JtYXQpOyBpKysp
IHsKKwlmb3IgKGkgPSAwOyBpIDwgaW5mby0+bnVtX3BsYW5lczsgaSsrKSB7CiAJCXVuc2lnbmVk
IGludCB3aWR0aCA9IGNtZC0+d2lkdGggLyAoaSA/IGhzdWIgOiAxKTsKIAkJdW5zaWduZWQgaW50
IGhlaWdodCA9IGNtZC0+aGVpZ2h0IC8gKGkgPyB2c3ViIDogMSk7CiAJCXVuc2lnbmVkIGludCBz
aXplLCBicHA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9wbGFuZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL3ZjNC92YzRfcGxhbmUuYwppbmRleCA0ZDkxOGQzZTQ4NTguLmUzYzBh
MzUwY2I3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZjNC92YzRfcGxhbmUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9wbGFuZS5jCkBAIC01OTIsNyArNTkyLDcgQEAgc3Rh
dGljIGludCB2YzRfcGxhbmVfbW9kZV9zZXQoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJdTMy
IGN0bDBfb2Zmc2V0ID0gdmM0X3N0YXRlLT5kbGlzdF9jb3VudDsKIAljb25zdCBzdHJ1Y3QgaHZz
X2Zvcm1hdCAqZm9ybWF0ID0gdmM0X2dldF9odnNfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7
CiAJdTY0IGJhc2VfZm9ybWF0X21vZCA9IGZvdXJjY19tb2RfYnJvYWRjb21fbW9kKGZiLT5tb2Rp
Zmllcik7Ci0JaW50IG51bV9wbGFuZXMgPSBkcm1fZm9ybWF0X251bV9wbGFuZXMoZm9ybWF0LT5k
cm0pOworCWludCBudW1fcGxhbmVzID0gZmItPmZvcm1hdC0+bnVtX3BsYW5lczsKIAl1MzIgaF9z
dWJzYW1wbGUsIHZfc3Vic2FtcGxlOwogCWJvb2wgbWl4X3BsYW5lX2FscGhhOwogCWJvb2wgY292
ZXJzX3NjcmVlbjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS96dGUvenhfcGxhbmUuYyBi
L2RyaXZlcnMvZ3B1L2RybS96dGUvenhfcGxhbmUuYwppbmRleCA4M2QyMzZmZDg5M2MuLmM2YThi
ZTQ0NDMwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3p0ZS96eF9wbGFuZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS96dGUvenhfcGxhbmUuYwpAQCAtMTk5LDcgKzE5OSw2IEBAIHN0YXRp
YyB2b2lkIHp4X3ZsX3BsYW5lX2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
CiAJdTMyIGRzdF94LCBkc3RfeSwgZHN0X3csIGRzdF9oOwogCXVpbnQzMl90IGZvcm1hdDsKIAlp
bnQgZm10OwotCWludCBudW1fcGxhbmVzOwogCWludCBpOwogCiAJaWYgKCFmYikKQEAgLTIxOCw5
ICsyMTcsOCBAQCBzdGF0aWMgdm9pZCB6eF92bF9wbGFuZV9hdG9taWNfdXBkYXRlKHN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lLAogCWRzdF9oID0gZHJtX3JlY3RfaGVpZ2h0KGRzdCk7CiAKIAkvKiBT
ZXQgdXAgZGF0YSBhZGRyZXNzIHJlZ2lzdGVycyBmb3IgWSwgQ2IgYW5kIENyIHBsYW5lcyAqLwot
CW51bV9wbGFuZXMgPSBkcm1fZm9ybWF0X251bV9wbGFuZXMoZm9ybWF0KTsKIAlwYWRkcl9yZWcg
PSBsYXllciArIFZMX1k7Ci0JZm9yIChpID0gMDsgaSA8IG51bV9wbGFuZXM7IGkrKykgeworCWZv
ciAoaSA9IDA7IGkgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpKyspIHsKIAkJY21hX29iaiA9
IGRybV9mYl9jbWFfZ2V0X2dlbV9vYmooZmIsIGkpOwogCQlwYWRkciA9IGNtYV9vYmotPnBhZGRy
ICsgZmItPm9mZnNldHNbaV07CiAJCXBhZGRyICs9IHNyY195ICogZmItPnBpdGNoZXNbaV07CmRp
ZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZm91cmNjLmggYi9pbmNsdWRlL2RybS9kcm1fZm91
cmNjLmgKaW5kZXggYjNkOWQ4OGFiMjkwLi40MTc3OWIzMjdkOTEgMTAwNjQ0Ci0tLSBhL2luY2x1
ZGUvZHJtL2RybV9mb3VyY2MuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZm91cmNjLmgKQEAgLTI2
OCw3ICsyNjgsNiBAQCBkcm1fZ2V0X2Zvcm1hdF9pbmZvKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiB1aW50MzJfdCBkcm1fbW9kZV9sZWdhY3lfZmJfZm9ybWF0KHVpbnQzMl90IGJwcCwgdWludDMy
X3QgZGVwdGgpOwogdWludDMyX3QgZHJtX2RyaXZlcl9sZWdhY3lfZmJfZm9ybWF0KHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsCiAJCQkJICAgICB1aW50MzJfdCBicHAsIHVpbnQzMl90IGRlcHRoKTsK
LWludCBkcm1fZm9ybWF0X251bV9wbGFuZXModWludDMyX3QgZm9ybWF0KTsKIGludCBkcm1fZm9y
bWF0X3BsYW5lX2NwcCh1aW50MzJfdCBmb3JtYXQsIGludCBwbGFuZSk7CiBpbnQgZHJtX2Zvcm1h
dF9ob3J6X2Nocm9tYV9zdWJzYW1wbGluZyh1aW50MzJfdCBmb3JtYXQpOwogaW50IGRybV9mb3Jt
YXRfdmVydF9jaHJvbWFfc3Vic2FtcGxpbmcodWludDMyX3QgZm9ybWF0KTsKLS0gCmdpdC1zZXJp
ZXMgMC45LjEKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
