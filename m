Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D53886555
	for <lists+dri-devel@lfdr.de>; Thu,  8 Aug 2019 17:12:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F2DC96E86C;
	Thu,  8 Aug 2019 15:12:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0345E6E865
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Aug 2019 15:12:07 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 1A1F828E114;
 Thu,  8 Aug 2019 16:12:06 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH RFC 12/19] drm/bridge: Add an ->atomic_check() hook
Date: Thu,  8 Aug 2019 17:11:43 +0200
Message-Id: <20190808151150.16336-13-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190808151150.16336-1-boris.brezillon@collabora.com>
References: <20190808151150.16336-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Jernej Skrabec <jernej.skrabec@siol.net>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Neil Armstrong <narmstrong@baylibre.com>, Jonas Karlman <jonas@kwiboo.se>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Thierry Reding <thierry.reding@gmail.com>, Chris Healy <Chris.Healy@zii.aero>,
 Boris Brezillon <boris.brezillon@collabora.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U28gdGhhdCBicmlkZ2UgZHJpdmVycyBoYXZlIGEgd2F5IHRvIGNoZWNrL3JlamVjdCBhbiBhdG9t
aWMgb3BlcmF0aW9uLgpUaGUgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2soKSAod2hpY2gg
aXMganVzdCBhIHdyYXBwZXIgYXJvdW5kCnRoZSAtPmF0b21pY19jaGVjaygpIGhvb2spIGlzIGNh
bGxlZCBpbiBwbGFjZSBvZgpkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoKSAod2hlbiAtPmF0
b21pY19jaGVjaygpIGlzIG5vdCBpbXBsZW1lbnRlZCwKdGhlIGNvcmUgZmFsbHMgYmFjayB0byAt
Pm1vZGVfZml4dXAoKSwgc28gdGhlIGJlaGF2aW9yIHNob3VsZCBzdGF5CnRoZSBzYW1lIGZvciBl
eGlzdGluZyBicmlkZ2UgZHJpdmVycykuCgpTaWduZWQtb2ZmLWJ5OiBCb3JpcyBCcmV6aWxsb24g
PGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1f
YXRvbWljX2hlbHBlci5jIHwgMTEgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5j
ICAgICAgICB8IDU5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2RybS9k
cm1fYnJpZGdlLmggICAgICAgICAgICB8IDIzICsrKysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQs
IDg3IGluc2VydGlvbnMoKyksIDYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19o
ZWxwZXIuYwppbmRleCBlNzZlYzk2NDhiNmYuLjNmYWRkZTM4ZWFkNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9hdG9taWNfaGVscGVyLmMKQEAgLTQ0NSwxMiArNDQ1LDExIEBAIG1vZGVfZml4dXAoc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQllbmNvZGVyID0gbmV3X2Nvbm5fc3RhdGUtPmJl
c3RfZW5jb2RlcjsKIAkJZnVuY3MgPSBlbmNvZGVyLT5oZWxwZXJfcHJpdmF0ZTsKIAotCQlyZXQg
PSBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoZW5jb2RlciwKLQkJCQkJJm5ld19jcnRjX3N0
YXRlLT5tb2RlLAotCQkJCQkmbmV3X2NydGNfc3RhdGUtPmFkanVzdGVkX21vZGUpOwotCQlpZiAo
IXJldCkgewotCQkJRFJNX0RFQlVHX0FUT01JQygiQnJpZGdlIGZpeHVwIGZhaWxlZFxuIik7Ci0J
CQlyZXR1cm4gLUVJTlZBTDsKKwkJcmV0ID0gZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2so
ZW5jb2RlciwgbmV3X2NydGNfc3RhdGUsCisJCQkJCQkgICAgbmV3X2Nvbm5fc3RhdGUpOworCQlp
ZiAocmV0KSB7CisJCQlEUk1fREVCVUdfQVRPTUlDKCJCcmlkZ2UgYXRvbWljIGNoZWNrIGZhaWxl
ZFxuIik7CisJCQlyZXR1cm4gcmV0OwogCQl9CiAKIAkJaWYgKGZ1bmNzICYmIGZ1bmNzLT5hdG9t
aWNfY2hlY2spIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCmluZGV4IDA1MjhjYTk0MTg1NS4uZGNhZDY2MWRh
YTc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMKQEAgLTU4Myw2ICs1ODMsNjUgQEAgdm9pZCBkcm1fYXRv
bWljX2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyLAogfQog
RVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9lbmFibGUpOwogCitzdGF0aWMg
aW50IGRybV9hdG9taWNfYnJpZGdlX2NoZWNrKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJ
CQkJICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgIHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQoreworCWlmIChicmlkZ2UtPmZ1bmNzLT5h
dG9taWNfY2hlY2spIHsKKwkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKmJyaWRnZV9zdGF0ZTsK
KwkJaW50IHJldDsKKworCQlicmlkZ2Vfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfYnJpZGdl
X3N0YXRlKGNydGNfc3RhdGUtPnN0YXRlLAorCQkJCQkJCSAgICAgICBicmlkZ2UpOworCQlpZiAo
V0FSTl9PTighYnJpZGdlX3N0YXRlKSkKKwkJCXJldHVybiAtRUlOVkFMOworCisJCXJldCA9IGJy
aWRnZS0+ZnVuY3MtPmF0b21pY19jaGVjayhicmlkZ2UsIGJyaWRnZV9zdGF0ZSwKKwkJCQkJCSAg
Y3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0g
ZWxzZSBpZiAoYnJpZGdlLT5mdW5jcy0+bW9kZV9maXh1cCkgeworCQlpZiAoIWJyaWRnZS0+ZnVu
Y3MtPm1vZGVfZml4dXAoYnJpZGdlLCAmY3J0Y19zdGF0ZS0+bW9kZSwKKwkJCQkJICAgICAgICZj
cnRjX3N0YXRlLT5hZGp1c3RlZF9tb2RlKSkKKwkJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJl
dHVybiAwOworfQorCisvKioKKyAqIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2NoZWNrKCkgLSBE
byBhbiBhdG9taWMgY2hlY2sgb24gdGhlIGJyaWRnZSBjaGFpbgorICogQGVuY29kZXI6IGVuY29k
ZXIgb2JqZWN0CisgKiBAY3J0Y19zdGF0ZTogbmV3IENSVEMgc3RhdGUKKyAqIEBjb25uX3N0YXRl
OiBuZXcgY29ubmVjdG9yIHN0YXRlCisgKgorICogQ2FsbHMgJmRybV9icmlkZ2VfZnVuY3MuYXRv
bWljX2NoZWNrKCkgKGZhbGxzIGJhY2sgb24KKyAqICZkcm1fYnJpZGdlX2Z1bmNzLm1vZGVfZml4
dXAoKSkgb3AgZm9yIGFsbCB0aGUgYnJpZGdlcyBpbiB0aGUgZW5jb2RlciBjaGFpbiwKKyAqIHN0
YXJ0aW5nIGZyb20gdGhlIGxhc3QgYnJpZGdlIHRvIHRoZSBmaXJzdC4gVGhlc2UgYXJlIGNhbGxl
ZCBiZWZvcmUgY2FsbGluZworICogJmRybV9lbmNvZGVyX2hlbHBlcl9mdW5jcy5hdG9taWNfY2hl
Y2soKQorICoKKyAqIFJFVFVSTlM6CisgKiAwIG9uIHN1Y2Nlc3MsIGEgbmVnYXRpdmUgZXJyb3Ig
Y29kZSBvbiBmYWlsdXJlCisgKi8KK2ludCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9jaGVjayhz
dHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCisJCQkJICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0
ZSkKK3sKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOworCisJbGlzdF9mb3JfZWFjaF9lbnRy
eV9yZXZlcnNlKGJyaWRnZSwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwKKwkJCQkgICAgY2hhaW5f
bm9kZSkgeworCQlpbnQgcmV0OworCisJCXJldCA9IGRybV9hdG9taWNfYnJpZGdlX2NoZWNrKGJy
aWRnZSwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0
OworCX0KKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9j
aGFpbl9jaGVjayk7CisKIC8qKgogICogZHJtX2F0b21pY19oZWxwZXJfaW5pdF9icmlkZ2Vfc3Rh
dGUoKSAtIEluaXRpYWxpemVzIGEgYnJpZGdlIHN0YXRlCiAgKiBAYnJpZGdlIHRoaXMgc3RhdGUg
aXMgcmVmZXJyaW5nIHRvCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggYi9p
bmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKaW5kZXggOTM4M2I0ZTRiODUzLi41ZDhmZTM3MDliZGUg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAorKysgYi9pbmNsdWRlL2RybS9k
cm1fYnJpZGdlLmgKQEAgLTM3OSw2ICszNzksMjYgQEAgc3RydWN0IGRybV9icmlkZ2VfZnVuY3Mg
ewogCSAqLwogCXZvaWQgKCphdG9taWNfZGVzdHJveV9zdGF0ZSkoc3RydWN0IGRybV9icmlkZ2Ug
KmJyaWRnZSwKIAkJCQkgICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSk7CisKKwkv
KioKKwkgKiBAYXRvbWljX2NoZWNrOgorCSAqCisJICogVGhpcyBtZXRob2QgaXMgcmVzcG9uc2li
bGUgZm9yIGNoZWNraW5nIGJyaWRnZSBzdGF0ZSBjb3JyZWN0bmVzcy4KKwkgKiBJdCBjYW4gYWxz
byBjaGVjayB0aGUgc3RhdGUgb2YgdGhlIHN1cnJvdW5kaW5nIGNvbXBvbmVudHMgaW4gY2hhaW4K
KwkgKiB0byBtYWtlIHN1cmUgdGhlIHdob2xlIHBpcGVsaW5lIGNhbiB3b3JrIHByb3Blcmx5Lgor
CSAqCisJICogJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2NoZWNrKCkgaG9va3MgYXJlIGNhbGxl
ZCBpbiByZXZlcnNlCisJICogb3JkZXIgKGZyb20gdGhlIGxhc3QgdG8gdGhlIGZpcnN0IGJyaWRn
ZSkuCisJICoKKwkgKiBUaGlzIG1ldGhvZCBpcyBvcHRpb25hbC4KKwkgKgorCSAqIFJFVFVSTlM6
CisJICogemVybyBpZiB0aGUgY2hlY2sgcGFzc2VkLCBhIG5lZ2F0aXZlIGVycm9yIGNvZGUgb3Ro
ZXJ3aXNlLgorCSAqLworCWludCAoKmF0b21pY19jaGVjaykoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSwKKwkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqYnJpZGdlX3N0YXRlLAorCQkJ
ICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7CiB9OwogCiAvKioKQEAgLTQ3OSw2ICs0OTks
OSBAQCB2b2lkIGRybV9icmlkZ2VfY2hhaW5fbW9kZV9zZXQoc3RydWN0IGRybV9lbmNvZGVyICpl
bmNvZGVyLAogdm9pZCBkcm1fYnJpZGdlX2NoYWluX3ByZV9lbmFibGUoc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyKTsKIHZvaWQgZHJtX2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9l
bmNvZGVyICplbmNvZGVyKTsKIAoraW50IGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2NoZWNrKHN0
cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKKwkJCQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
KTsKIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZGlzYWJsZShzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkJICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwog
dm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyLAotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
