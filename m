Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A95C36F7D6
	for <lists+dri-devel@lfdr.de>; Fri, 30 Apr 2021 11:25:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E8DC56F514;
	Fri, 30 Apr 2021 09:25:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x62f.google.com (mail-ej1-x62f.google.com
 [IPv6:2a00:1450:4864:20::62f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF0726F508
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 09:25:17 +0000 (UTC)
Received: by mail-ej1-x62f.google.com with SMTP id gx5so12148324ejb.11
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 02:25:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=MgNhTti4iINApNm2rNWtkAlbVBnLOTf2Z21QB1T3JAY=;
 b=ihC9PMYyumCYUR8DEyWz3PPntFn3efi0qv2lUXRbbTrvjQDfk7ddZcZRJ/Y8KyOMwr
 Gbe+MEpD0zPrmkoLqpWHerj2nX2PK3iFCCcuWvXZpke8xyzEOrc2cSnCcJj0jCORNWRa
 owd4WoheJqVSdE7YiPavzpFvBLbnD0XugT72uv5gHnU/JujqtZ987/LpSmjgINIh1w8b
 ZIaxKTv4pDcErJXAi7ztoGMifMIpiaKnQGax/js2o3AHc3PwnhV/v1JKEvM+pfqgAlHq
 7JFR/mJoJ1Ht505awUXFqKGv0vpRxRnfp8XpDiXP2Hli7aMJkD5Iy3iP6ln9D7Tc39pU
 Hq3w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=MgNhTti4iINApNm2rNWtkAlbVBnLOTf2Z21QB1T3JAY=;
 b=F7Mzk38qMUeXZL1SoN6y3xIBLpNBP2zysXXv8lMrpxSRxdEfk6a+HLYuOz6r+AZXnW
 W5N4WaXg5M/d1llFDEJGoBWH5yH4zcxAnZ/ZWaL32MPn+/kOvp+yD7hpNXCW/geYLk1M
 H+Y8MO5SBYX+VCA06kG5NUUvRa7AuEQtuJiqlTZQ3SwxGVaDBfsPowHUU2eiWBh7JpAd
 sz8FIor19Dxq6MpkZnS/ZA9jKl+pIdY+osxztHkiiO5//SwKHm73j5uAE85vSpXQ1CB4
 VDuSffXUaJGM+ciSRvJr3FLksJSWFE++Gz76UYsyA6QfSqMNMjlpI4YH0X7aFFXXp3FO
 228w==
X-Gm-Message-State: AOAM5328nfuDB8NDWD0DzbpM4tpq8S/gvozyVBMrcGmCrhi01Bb8pXhy
 hOLqb1ZpV49vk6Kgkv2N29bEGkeQB/k=
X-Google-Smtp-Source: ABdhPJxBxsAFW528cUDvGl0U/AkxkZipDMQsERCkBf/ZLpHOGx0urEzSmSla3AQM2kZJO+geonAZ8A==
X-Received: by 2002:a17:906:36da:: with SMTP id
 b26mr3379624ejc.8.1619774716492; 
 Fri, 30 Apr 2021 02:25:16 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:d08c:9633:b7a2:37e2])
 by smtp.gmail.com with ESMTPSA id h23sm1550959ejx.90.2021.04.30.02.25.15
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 30 Apr 2021 02:25:16 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 10/13] drm/amdgpu: switch the VRAM backend to self alloc
Date: Fri, 30 Apr 2021 11:25:05 +0200
Message-Id: <20210430092508.60710-10-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210430092508.60710-1-christian.koenig@amd.com>
References: <20210430092508.60710-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@ffwll.ch, matthew.william.auld@gmail.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2ltaWxhciB0byB0aGUgVFRNIHJhbmdlIG1hbmFnZXIuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3Rp
YW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X3ZyYW1fbWdyLmMgfCA1MSArKysrKysrKysrKystLS0tLS0tLQog
MSBmaWxlIGNoYW5nZWQsIDMwIGluc2VydGlvbnMoKyksIDIxIGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92cmFtX21nci5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZyYW1fbWdyLmMKaW5kZXggYmIwMWUwZmM2
MjFjLi5kNTllYzA3Yzc3YmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV92cmFtX21nci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV92cmFtX21nci5jCkBAIC0yMyw2ICsyMyw4IEBACiAgKi8KIAogI2luY2x1ZGUgPGxpbnV4L2Rt
YS1tYXBwaW5nLmg+CisjaW5jbHVkZSA8ZHJtL3R0bS90dG1fcmFuZ2VfbWFuYWdlci5oPgorCiAj
aW5jbHVkZSAiYW1kZ3B1LmgiCiAjaW5jbHVkZSAiYW1kZ3B1X3ZtLmgiCiAjaW5jbHVkZSAiYW1k
Z3B1X3Jlc19jdXJzb3IuaCIKQEAgLTM2Nyw5ICszNjksOSBAQCBzdGF0aWMgaW50IGFtZGdwdV92
cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCiAJc3RydWN0IGFt
ZGdwdV92cmFtX21nciAqbWdyID0gdG9fdnJhbV9tZ3IobWFuKTsKIAlzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldiA9IHRvX2FtZGdwdV9kZXZpY2UobWdyKTsKIAl1aW50NjRfdCB2aXNfdXNhZ2Ug
PSAwLCBtZW1fYnl0ZXMsIG1heF9ieXRlczsKKwlzdHJ1Y3QgdHRtX3JhbmdlX21ncl9ub2RlICpu
b2RlOwogCXN0cnVjdCBkcm1fbW0gKm1tID0gJm1nci0+bW07CiAJZW51bSBkcm1fbW1faW5zZXJ0
X21vZGUgbW9kZTsKLQlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGVzOwogCXVuc2lnbmVkIGk7CiAJ
aW50IHI7CiAKQEAgLTM4NCw4ICszODYsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV92cmFtX21ncl9u
ZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4sCiAJLyogYmFpbCBvdXQgcXVpY2ts
eSBpZiB0aGVyZSdzIGxpa2VseSBub3QgZW5vdWdoIFZSQU0gZm9yIHRoaXMgQk8gKi8KIAltZW1f
Ynl0ZXMgPSAodTY0KW1lbS0+bnVtX3BhZ2VzIDw8IFBBR0VfU0hJRlQ7CiAJaWYgKGF0b21pYzY0
X2FkZF9yZXR1cm4obWVtX2J5dGVzLCAmbWdyLT51c2FnZSkgPiBtYXhfYnl0ZXMpIHsKLQkJYXRv
bWljNjRfc3ViKG1lbV9ieXRlcywgJm1nci0+dXNhZ2UpOwotCQlyZXR1cm4gLUVOT1NQQzsKKwkJ
ciA9IC1FTk9TUEM7CisJCWdvdG8gZXJyb3Jfc3ViOwogCX0KIAogCWlmIChwbGFjZS0+ZmxhZ3Mg
JiBUVE1fUExfRkxBR19DT05USUdVT1VTKSB7CkBAIC00MDMsMTMgKzQwNSwxNSBAQCBzdGF0aWMg
aW50IGFtZGdwdV92cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW4s
CiAJCW51bV9ub2RlcyA9IERJVl9ST1VORF9VUChtZW0tPm51bV9wYWdlcywgcGFnZXNfcGVyX25v
ZGUpOwogCX0KIAotCW5vZGVzID0ga3ZtYWxsb2NfYXJyYXkoKHVpbnQzMl90KW51bV9ub2Rlcywg
c2l6ZW9mKCpub2RlcyksCi0JCQkgICAgICAgR0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8pOwotCWlm
ICghbm9kZXMpIHsKLQkJYXRvbWljNjRfc3ViKG1lbV9ieXRlcywgJm1nci0+dXNhZ2UpOwotCQly
ZXR1cm4gLUVOT01FTTsKKwlub2RlID0ga3ZtYWxsb2Moc3RydWN0X3NpemUobm9kZSwgbW1fbm9k
ZXMsIG51bV9ub2RlcyksCisJCQkgIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKKwlpZiAoIW5v
ZGUpIHsKKwkJciA9IC1FTk9NRU07CisJCWdvdG8gZXJyb3Jfc3ViOwogCX0KIAorCXR0bV9yZXNv
dXJjZV9pbml0KHRibywgcGxhY2UsICZub2RlLT5iYXNlKTsKKwogCW1vZGUgPSBEUk1fTU1fSU5T
RVJUX0JFU1Q7CiAJaWYgKHBsYWNlLT5mbGFncyAmIFRUTV9QTF9GTEFHX1RPUERPV04pCiAJCW1v
ZGUgPSBEUk1fTU1fSU5TRVJUX0hJR0g7CkBAIC00MjgsOCArNDMyLDkgQEAgc3RhdGljIGludCBh
bWRncHVfdnJhbV9tZ3JfbmV3KHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuLAogCQlp
ZiAocGFnZXMgPj0gcGFnZXNfcGVyX25vZGUpCiAJCQlhbGlnbm1lbnQgPSBwYWdlc19wZXJfbm9k
ZTsKIAotCQlyID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKG1tLCAmbm9kZXNbaV0sIHBh
Z2VzLCBhbGlnbm1lbnQsCi0JCQkJCQkwLCBwbGFjZS0+ZnBmbiwgbHBmbiwgbW9kZSk7CisJCXIg
PSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UobW0sICZub2RlLT5tbV9ub2Rlc1tpXSwgcGFn
ZXMsCisJCQkJCQlhbGlnbm1lbnQsIDAsIHBsYWNlLT5mcGZuLAorCQkJCQkJbHBmbiwgbW9kZSk7
CiAJCWlmICh1bmxpa2VseShyKSkgewogCQkJaWYgKHBhZ2VzID4gcGFnZXNfcGVyX25vZGUpIHsK
IAkJCQlpZiAoaXNfcG93ZXJfb2ZfMihwYWdlcykpCkBAIC00MzgsMTEgKzQ0MywxMSBAQCBzdGF0
aWMgaW50IGFtZGdwdV92cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICpt
YW4sCiAJCQkJCXBhZ2VzID0gcm91bmRkb3duX3Bvd19vZl90d28ocGFnZXMpOwogCQkJCWNvbnRp
bnVlOwogCQkJfQotCQkJZ290byBlcnJvcjsKKwkJCWdvdG8gZXJyb3JfZnJlZTsKIAkJfQogCi0J
CXZpc191c2FnZSArPSBhbWRncHVfdnJhbV9tZ3JfdmlzX3NpemUoYWRldiwgJm5vZGVzW2ldKTsK
LQkJYW1kZ3B1X3ZyYW1fbWdyX3ZpcnRfc3RhcnQobWVtLCAmbm9kZXNbaV0pOworCQl2aXNfdXNh
Z2UgKz0gYW1kZ3B1X3ZyYW1fbWdyX3Zpc19zaXplKGFkZXYsICZub2RlLT5tbV9ub2Rlc1tpXSk7
CisJCWFtZGdwdV92cmFtX21ncl92aXJ0X3N0YXJ0KG1lbSwgJm5vZGUtPm1tX25vZGVzW2ldKTsK
IAkJcGFnZXNfbGVmdCAtPSBwYWdlczsKIAkJKytpOwogCkBAIC00NTUsMTYgKzQ2MCwxNyBAQCBz
dGF0aWMgaW50IGFtZGdwdV92cmFtX21ncl9uZXcoc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2Vy
ICptYW4sCiAJCW1lbS0+cGxhY2VtZW50IHw9IFRUTV9QTF9GTEFHX0NPTlRJR1VPVVM7CiAKIAlh
dG9taWM2NF9hZGQodmlzX3VzYWdlLCAmbWdyLT52aXNfdXNhZ2UpOwotCW1lbS0+bW1fbm9kZSA9
IG5vZGVzOworCW1lbS0+bW1fbm9kZSA9ICZub2RlLT5tbV9ub2Rlc1swXTsKIAlyZXR1cm4gMDsK
IAotZXJyb3I6CitlcnJvcl9mcmVlOgogCXdoaWxlIChpLS0pCi0JCWRybV9tbV9yZW1vdmVfbm9k
ZSgmbm9kZXNbaV0pOworCQlkcm1fbW1fcmVtb3ZlX25vZGUoJm5vZGUtPm1tX25vZGVzW2ldKTsK
IAlzcGluX3VubG9jaygmbWdyLT5sb2NrKTsKLQlhdG9taWM2NF9zdWIobWVtLT5udW1fcGFnZXMg
PDwgUEFHRV9TSElGVCwgJm1nci0+dXNhZ2UpOworCWt2ZnJlZShub2RlKTsKIAotCWt2ZnJlZShu
b2Rlcyk7CitlcnJvcl9zdWI6CisJYXRvbWljNjRfc3ViKG1lbV9ieXRlcywgJm1nci0+dXNhZ2Up
OwogCXJldHVybiByOwogfQogCkBAIC00ODEsMTMgKzQ4NywxNyBAQCBzdGF0aWMgdm9pZCBhbWRn
cHVfdnJhbV9tZ3JfZGVsKHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuLAogewogCXN0
cnVjdCBhbWRncHVfdnJhbV9tZ3IgKm1nciA9IHRvX3ZyYW1fbWdyKG1hbik7CiAJc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSB0b19hbWRncHVfZGV2aWNlKG1ncik7Ci0Jc3RydWN0IGRybV9t
bV9ub2RlICpub2RlcyA9IG1lbS0+bW1fbm9kZTsKKwlzdHJ1Y3QgdHRtX3JhbmdlX21ncl9ub2Rl
ICpub2RlOwogCXVpbnQ2NF90IHVzYWdlID0gMCwgdmlzX3VzYWdlID0gMDsKIAl1bnNpZ25lZCBw
YWdlcyA9IG1lbS0+bnVtX3BhZ2VzOworCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZXM7CiAKIAlp
ZiAoIW1lbS0+bW1fbm9kZSkKIAkJcmV0dXJuOwogCisJbm9kZSA9IHRvX3R0bV9yYW5nZV9tZ3Jf
bm9kZShtZW0pOworCW5vZGVzID0gJm5vZGUtPm1tX25vZGVzWzBdOworCiAJc3Bpbl9sb2NrKCZt
Z3ItPmxvY2spOwogCXdoaWxlIChwYWdlcykgewogCQlwYWdlcyAtPSBub2Rlcy0+c2l6ZTsKQEAg
LTUwMiw4ICs1MTIsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdnJhbV9tZ3JfZGVsKHN0cnVjdCB0
dG1fcmVzb3VyY2VfbWFuYWdlciAqbWFuLAogCWF0b21pYzY0X3N1Yih1c2FnZSwgJm1nci0+dXNh
Z2UpOwogCWF0b21pYzY0X3N1Yih2aXNfdXNhZ2UsICZtZ3ItPnZpc191c2FnZSk7CiAKLQlrdmZy
ZWUobWVtLT5tbV9ub2RlKTsKLQltZW0tPm1tX25vZGUgPSBOVUxMOworCWt2ZnJlZShub2RlKTsK
IH0KIAogLyoqCi0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2RyaS1kZXZlbAo=
