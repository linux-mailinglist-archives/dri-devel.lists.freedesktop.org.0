Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D1F27615ED
	for <lists+dri-devel@lfdr.de>; Sun,  7 Jul 2019 20:29:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CA30C89B42;
	Sun,  7 Jul 2019 18:29:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 99C9E89B42
 for <dri-devel@lists.freedesktop.org>; Sun,  7 Jul 2019 18:29:01 +0000 (UTC)
Received: from pendragon.nordic-sky.finnair.com (unknown [38.98.37.142])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id B30D9CC;
 Sun,  7 Jul 2019 20:28:39 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 24/60] drm/panel: Add driver for the Toppology TD043MTEA1 panel
Date: Sun,  7 Jul 2019 21:19:01 +0300
Message-Id: <20190707181937.6250-21-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
References: <20190707180852.5512-1-laurent.pinchart@ideasonboard.com>
 <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1562524140;
 bh=bKEFMSR5vRHQTsCa85gn3XX/C8KRjeJYx+SaS3pdW1E=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=HQ4pHeR4EGwgyK2CsilFn1vzYjqVTWGVGllnMg8G2RULdSxo/AI4op75sAEDY9q5X
 VceeXhrz4EoBEiBLvGdGT7g268QHuMC5qa4gMx1BPx6Bt1E1D0ioyko8FzMOzE893u
 LCMXj+wivRfvS4TgK97EFKoj7UVvOLVOg6gLun8Q=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>, Sam Ravnborg <sam@ravnborg.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>,
 Thierry Reding <thierry.reding@gmail.com>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYW5lbCBpcyB1c2VkIG9uIHRoZSBPTUFQMyBQYW5kb3JhLgoKU2lnbmVkLW9mZi1ieTog
TGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnICAgICAgICAgICAgICAgIHwgICA3ICsKIGRy
aXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZSAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZl
cnMvZ3B1L2RybS9wYW5lbC9wYW5lbC10cG8tdGQwNDNtdGVhMS5jIHwgNTEwICsrKysrKysrKysr
KysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwgNTE4IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2Rl
IDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtdHBvLXRkMDQzbXRlYTEuYwoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJt
L3BhbmVsL0tjb25maWcKaW5kZXggYjcwOTlkMjExMDYxLi44ZjM2NjBjNzMwNDQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9w
YW5lbC9LY29uZmlnCkBAIC0zMTIsNiArMzEyLDEzIEBAIGNvbmZpZyBEUk1fUEFORUxfVFBPX1RE
MDI4VFRFQzEKIAkgIFNheSBZIGhlcmUgaWYgeW91IHdhbnQgdG8gZW5hYmxlIHN1cHBvcnQgZm9y
IFRQTyBURDAyOFRURUMxIDQ4MHg2NDAKIAkgIDIuOCIgcGFuZWwuCiAKK2NvbmZpZyBEUk1fUEFO
RUxfVFBPX1REMDQzTVRFQTEKKwl0cmlzdGF0ZSAiVFBPIFREMDQzTVRFQTEgcGFuZWwgZHJpdmVy
IgorCWRlcGVuZHMgb24gR1BJT0xJQiAmJiBPRiAmJiBSRUdVTEFUT1IgJiYgU1BJCisJaGVscAor
CSAgU2F5IFkgaGVyZSBpZiB5b3Ugd2FudCB0byBlbmFibGUgc3VwcG9ydCBmb3IgVFBPIFREMDQz
TVRFQTEgODAweDQ4MAorCSAgNC4zIiBwYW5lbC4KKwogY29uZmlnIERSTV9QQU5FTF9UUE9fVFBH
MTEwCiAJdHJpc3RhdGUgIlRQTyBUUEcgODAweDQwMCBwYW5lbCIKIAlkZXBlbmRzIG9uIE9GICYm
IFNQSSAmJiBHUElPTElCCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZp
bGUgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUKaW5kZXggYTFkNGRlNjRjMGIxLi5i
Zjc2ZmNlYTdkMjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZQor
KysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvTWFrZWZpbGUKQEAgLTMzLDUgKzMzLDYgQEAgb2Jq
LSQoQ09ORklHX0RSTV9QQU5FTF9TSVRST05JWF9TVDc3MDEpICs9IHBhbmVsLXNpdHJvbml4LXN0
NzcwMS5vCiBvYmotJChDT05GSUdfRFJNX1BBTkVMX1NJVFJPTklYX1NUNzc4OVYpICs9IHBhbmVs
LXNpdHJvbml4LXN0Nzc4OXYubwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9TT05ZX0FDWDU2NUFL
TSkgKz0gcGFuZWwtc29ueS1hY3g1NjVha20ubwogb2JqLSQoQ09ORklHX0RSTV9QQU5FTF9UUE9f
VEQwMjhUVEVDMSkgKz0gcGFuZWwtdHBvLXRkMDI4dHRlYzEubworb2JqLSQoQ09ORklHX0RSTV9Q
QU5FTF9UUE9fVEQwNDNNVEVBMSkgKz0gcGFuZWwtdHBvLXRkMDQzbXRlYTEubwogb2JqLSQoQ09O
RklHX0RSTV9QQU5FTF9UUE9fVFBHMTEwKSArPSBwYW5lbC10cG8tdHBnMTEwLm8KIG9iai0kKENP
TkZJR19EUk1fUEFORUxfVFJVTFlfTlQzNTU5N19XUVhHQSkgKz0gcGFuZWwtdHJ1bHktbnQzNTU5
Ny5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtdHBvLXRkMDQzbXRl
YTEuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC10cG8tdGQwNDNtdGVhMS5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNmIxN2U0NzU4MmI4Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL3BhbmVsLXRwby10ZDA0M210ZWExLmMK
QEAgLTAsMCArMSw1MTAgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wKwor
LyoKKyAqIFRvcHBvbG9neSBURDA0M01URUExIFBhbmVsIERyaXZlcgorICoKKyAqIENvcHlyaWdo
dCAoQykgMjAxOSBUZXhhcyBJbnN0cnVtZW50cyBJbmNvcnBvcmF0ZWQKKyAqCisgKiBCYXNlZCBv
biB0aGUgb21hcGRybS1zcGVjaWZpYyBwYW5lbC10cG8tdGQwNDNtdGVhMSBkcml2ZXIKKyAqCisg
KiBBdXRob3I6IEdyYcW+dnlkYXMgSWdub3RhcyA8bm90YXNhc0BnbWFpbC5jb20+CisgKi8KKwor
I2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5j
bHVkZSA8bGludXgvcmVndWxhdG9yL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvc3BpL3Nw
aS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X21vZGVzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wYW5lbC5oPgorCisjZGVmaW5lIFRQT19SMDJf
TU9ERSh4KQkJCSgoeCkgJiA3KQorI2RlZmluZSBUUE9fUjAyX01PREVfODAweDQ4MAkJNworI2Rl
ZmluZSBUUE9fUjAyX05DTEtfUklTSU5HCQlCSVQoMykKKyNkZWZpbmUgVFBPX1IwMl9IU1lOQ19I
SUdICQlCSVQoNCkKKyNkZWZpbmUgVFBPX1IwMl9WU1lOQ19ISUdICQlCSVQoNSkKKworI2RlZmlu
ZSBUUE9fUjAzX05TVEFOREJZCQlCSVQoMCkKKyNkZWZpbmUgVFBPX1IwM19FTl9DUF9DTEsJCUJJ
VCgxKQorI2RlZmluZSBUUE9fUjAzX0VOX1ZHTF9QVU1QCQlCSVQoMikKKyNkZWZpbmUgVFBPX1Iw
M19FTl9QV00JCQlCSVQoMykKKyNkZWZpbmUgVFBPX1IwM19EUklWSU5HX0NBUF8xMDAJCUJJVCg0
KQorI2RlZmluZSBUUE9fUjAzX0VOX1BSRV9DSEFSR0UJCUJJVCg2KQorI2RlZmluZSBUUE9fUjAz
X1NPRlRXQVJFX0NUTAkJQklUKDcpCisKKyNkZWZpbmUgVFBPX1IwNF9ORkxJUF9ICQkJQklUKDAp
CisjZGVmaW5lIFRQT19SMDRfTkZMSVBfVgkJCUJJVCgxKQorI2RlZmluZSBUUE9fUjA0X0NQX0NM
S19GUkVRXzFICQlCSVQoMikKKyNkZWZpbmUgVFBPX1IwNF9WR0xfRlJFUV8xSAkJQklUKDQpCisK
KyNkZWZpbmUgVFBPX1IwM19WQUxfTk9STUFMIFwKKwkoVFBPX1IwM19OU1RBTkRCWSB8IFRQT19S
MDNfRU5fQ1BfQ0xLIHwgVFBPX1IwM19FTl9WR0xfUFVNUCB8IFwKKwkgVFBPX1IwM19FTl9QV00g
fCBUUE9fUjAzX0RSSVZJTkdfQ0FQXzEwMCB8IFRQT19SMDNfRU5fUFJFX0NIQVJHRSB8IFwKKwkg
VFBPX1IwM19TT0ZUV0FSRV9DVEwpCisKKyNkZWZpbmUgVFBPX1IwM19WQUxfU1RBTkRCWSBcCisJ
KFRQT19SMDNfRFJJVklOR19DQVBfMTAwIHwgVFBPX1IwM19FTl9QUkVfQ0hBUkdFIHwgXAorCSBU
UE9fUjAzX1NPRlRXQVJFX0NUTCkKKworc3RhdGljIGNvbnN0IHUxNiB0ZDA0M210ZWExX2RlZl9n
YW1tYVsxMl0gPSB7CisJMTA1LCAzMTUsIDM4MSwgNDMxLCA0OTAsIDUzNywgNTc5LCA2ODYsIDc4
MCwgODM3LCA4ODAsIDEwMjMKK307CisKK3N0cnVjdCB0ZDA0M210ZWExX2RldmljZSB7CisJc3Ry
dWN0IGRybV9wYW5lbCBwYW5lbDsKKworCXN0cnVjdCBzcGlfZGV2aWNlICpzcGk7CisJc3RydWN0
IHJlZ3VsYXRvciAqdmNjX3JlZzsKKwlzdHJ1Y3QgZ3Bpb19kZXNjICpyZXNldF9ncGlvOworCisJ
dW5zaWduZWQgaW50IG1vZGU7CisJdTE2IGdhbW1hWzEyXTsKKwlib29sIHZtaXJyb3I7CisJYm9v
bCBwb3dlcmVkX29uOworCWJvb2wgc3BpX3N1c3BlbmRlZDsKKwlib29sIHBvd2VyX29uX3Jlc3Vt
ZTsKK307CisKKyNkZWZpbmUgdG9fdGQwNDNtdGVhMV9kZXZpY2UocCkgY29udGFpbmVyX29mKHAs
IHN0cnVjdCB0ZDA0M210ZWExX2RldmljZSwgcGFuZWwpCisKKy8qIC0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tCisgKiBIYXJkd2FyZSBBY2Nlc3MKKyAqLworCitzdGF0aWMgaW50IHRkMDQzbXRlYTFfd3Jp
dGUoc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2QsIHU4IGFkZHIsIHU4IHZhbHVlKQorewor
CXN0cnVjdCBzcGlfbWVzc2FnZSBtc2c7CisJc3RydWN0IHNwaV90cmFuc2ZlciB4ZmVyOworCXUx
NiBkYXRhOworCWludCByZXQ7CisKKwlzcGlfbWVzc2FnZV9pbml0KCZtc2cpOworCisJbWVtc2V0
KCZ4ZmVyLCAwLCBzaXplb2YoeGZlcikpOworCisJZGF0YSA9ICgodTE2KWFkZHIgPDwgMTApIHwg
KDEgPDwgOCkgfCB2YWx1ZTsKKwl4ZmVyLnR4X2J1ZiA9ICZkYXRhOworCXhmZXIuYml0c19wZXJf
d29yZCA9IDE2OworCXhmZXIubGVuID0gMjsKKwlzcGlfbWVzc2FnZV9hZGRfdGFpbCgmeGZlciwg
Jm1zZyk7CisKKwlyZXQgPSBzcGlfc3luYyhsY2QtPnNwaSwgJm1zZyk7CisJaWYgKHJldCA8IDAp
CisJCWRldl93YXJuKCZsY2QtPnNwaS0+ZGV2LCAiZmFpbGVkIHRvIHdyaXRlIHRvIExDRCByZWcg
KCVkKVxuIiwKKwkJCSByZXQpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgdGQw
NDNtdGVhMV93cml0ZV9nYW1tYShzdHJ1Y3QgdGQwNDNtdGVhMV9kZXZpY2UgKmxjZCkKK3sKKwlj
b25zdCB1MTYgKmdhbW1hID0gbGNkLT5nYW1tYTsKKwl1bnNpZ25lZCBpbnQgaTsKKwl1OCB2YWw7
CisKKwkvKiBnYW1tYSBiaXRzIFs5OjhdICovCisJZm9yICh2YWwgPSBpID0gMDsgaSA8IDQ7IGkr
KykKKwkJdmFsIHw9IChnYW1tYVtpXSAmIDB4MzAwKSA+PiAoKGkgKyAxKSAqIDIpOworCXRkMDQz
bXRlYTFfd3JpdGUobGNkLCAweDExLCB2YWwpOworCisJZm9yICh2YWwgPSBpID0gMDsgaSA8IDQ7
IGkrKykKKwkJdmFsIHw9IChnYW1tYVtpKzRdICYgMHgzMDApID4+ICgoaSArIDEpICogMik7CisJ
dGQwNDNtdGVhMV93cml0ZShsY2QsIDB4MTIsIHZhbCk7CisKKwlmb3IgKHZhbCA9IGkgPSAwOyBp
IDwgNDsgaSsrKQorCQl2YWwgfD0gKGdhbW1hW2krOF0gJiAweDMwMCkgPj4gKChpICsgMSkgKiAy
KTsKKwl0ZDA0M210ZWExX3dyaXRlKGxjZCwgMHgxMywgdmFsKTsKKworCS8qIGdhbW1hIGJpdHMg
Wzc6MF0gKi8KKwlmb3IgKHZhbCA9IGkgPSAwOyBpIDwgMTI7IGkrKykKKwkJdGQwNDNtdGVhMV93
cml0ZShsY2QsIDB4MTQgKyBpLCBnYW1tYVtpXSAmIDB4ZmYpOworfQorCitzdGF0aWMgaW50IHRk
MDQzbXRlYTFfd3JpdGVfbWlycm9yKHN0cnVjdCB0ZDA0M210ZWExX2RldmljZSAqbGNkKQorewor
CXU4IHJlZzQgPSBUUE9fUjA0X05GTElQX0ggfCBUUE9fUjA0X05GTElQX1YgfAorCQlUUE9fUjA0
X0NQX0NMS19GUkVRXzFIIHwgVFBPX1IwNF9WR0xfRlJFUV8xSDsKKwlpZiAobGNkLT52bWlycm9y
KQorCQlyZWc0ICY9IH5UUE9fUjA0X05GTElQX1Y7CisKKwlyZXR1cm4gdGQwNDNtdGVhMV93cml0
ZShsY2QsIDQsIHJlZzQpOworfQorCitzdGF0aWMgaW50IHRkMDQzbXRlYTFfcG93ZXJfb24oc3Ry
dWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2QpCit7CisJaW50IHJldDsKKworCWlmIChsY2QtPnBv
d2VyZWRfb24pCisJCXJldHVybiAwOworCisJcmV0ID0gcmVndWxhdG9yX2VuYWJsZShsY2QtPnZj
Y19yZWcpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJLyogV2FpdCBmb3IgdGhl
IHBhbmVsIHRvIHN0YWJpbGl6ZS4gKi8KKwltc2xlZXAoMTYwKTsKKworCWdwaW9kX3NldF92YWx1
ZShsY2QtPnJlc2V0X2dwaW8sIDApOworCisJdGQwNDNtdGVhMV93cml0ZShsY2QsIDIsIFRQT19S
MDJfTU9ERShsY2QtPm1vZGUpIHwgVFBPX1IwMl9OQ0xLX1JJU0lORyk7CisJdGQwNDNtdGVhMV93
cml0ZShsY2QsIDMsIFRQT19SMDNfVkFMX05PUk1BTCk7CisJdGQwNDNtdGVhMV93cml0ZShsY2Qs
IDB4MjAsIDB4ZjApOworCXRkMDQzbXRlYTFfd3JpdGUobGNkLCAweDIxLCAweGYwKTsKKwl0ZDA0
M210ZWExX3dyaXRlX21pcnJvcihsY2QpOworCXRkMDQzbXRlYTFfd3JpdGVfZ2FtbWEobGNkKTsK
KworCWxjZC0+cG93ZXJlZF9vbiA9IHRydWU7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZv
aWQgdGQwNDNtdGVhMV9wb3dlcl9vZmYoc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2QpCit7
CisJaWYgKCFsY2QtPnBvd2VyZWRfb24pCisJCXJldHVybjsKKworCXRkMDQzbXRlYTFfd3JpdGUo
bGNkLCAzLCBUUE9fUjAzX1ZBTF9TVEFOREJZIHwgVFBPX1IwM19FTl9QV00pOworCisJZ3Bpb2Rf
c2V0X3ZhbHVlKGxjZC0+cmVzZXRfZ3BpbywgMSk7CisKKwkvKiB3YWl0IGZvciBhdCBsZWFzdCAy
IHZzeW5jcyBiZWZvcmUgY3V0dGluZyBvZmYgcG93ZXIgKi8KKwltc2xlZXAoNTApOworCisJdGQw
NDNtdGVhMV93cml0ZShsY2QsIDMsIFRQT19SMDNfVkFMX1NUQU5EQlkpOworCisJcmVndWxhdG9y
X2Rpc2FibGUobGNkLT52Y2NfcmVnKTsKKworCWxjZC0+cG93ZXJlZF9vbiA9IGZhbHNlOworfQor
CisvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogc3lzZnMKKyAqLworCitzdGF0aWMgc3NpemVf
dCB2bWlycm9yX3Nob3coc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwKKwkJCSAgICBjaGFyICpidWYpCit7CisJc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNl
ICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCXJldHVybiBzbnByaW50ZihidWYsIFBB
R0VfU0laRSwgIiVkXG4iLCBsY2QtPnZtaXJyb3IpOworfQorCitzdGF0aWMgc3NpemVfdCB2bWly
cm9yX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0
dHIsCisJCQkgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQoreworCXN0cnVjdCB0
ZDA0M210ZWExX2RldmljZSAqbGNkID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50IHZhbDsK
KwlpbnQgcmV0OworCisJcmV0ID0ga3N0cnRvaW50KGJ1ZiwgMCwgJnZhbCk7CisJaWYgKHJldCA8
IDApCisJCXJldHVybiByZXQ7CisKKwlsY2QtPnZtaXJyb3IgPSAhIXZhbDsKKworCXJldCA9IHRk
MDQzbXRlYTFfd3JpdGVfbWlycm9yKGxjZCk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7
CisKKwlyZXR1cm4gY291bnQ7Cit9CisKK3N0YXRpYyBzc2l6ZV90IG1vZGVfc2hvdyhzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJIGNoYXIgKmJ1
ZikKK3sKKwlzdHJ1Y3QgdGQwNDNtdGVhMV9kZXZpY2UgKmxjZCA9IGRldl9nZXRfZHJ2ZGF0YShk
ZXYpOworCisJcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIGxjZC0+bW9k
ZSk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IG1vZGVfc3RvcmUoc3RydWN0IGRldmljZSAqZGV2LCBz
dHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCSAgY29uc3QgY2hhciAqYnVmLCBzaXpl
X3QgY291bnQpCit7CisJc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2QgPSBkZXZfZ2V0X2Ry
dmRhdGEoZGV2KTsKKwlsb25nIHZhbDsKKwlpbnQgcmV0OworCisJcmV0ID0ga3N0cnRvbChidWYs
IDAsICZ2YWwpOworCWlmIChyZXQgIT0gMCB8fCB2YWwgJiB+NykKKwkJcmV0dXJuIC1FSU5WQUw7
CisKKwlsY2QtPm1vZGUgPSB2YWw7CisKKwl2YWwgfD0gVFBPX1IwMl9OQ0xLX1JJU0lORzsKKwl0
ZDA0M210ZWExX3dyaXRlKGxjZCwgMiwgdmFsKTsKKworCXJldHVybiBjb3VudDsKK30KKworc3Rh
dGljIHNzaXplX3QgZ2FtbWFfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2Vf
YXR0cmlidXRlICphdHRyLAorCQkJICBjaGFyICpidWYpCit7CisJc3RydWN0IHRkMDQzbXRlYTFf
ZGV2aWNlICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzc2l6ZV90IGxlbiA9IDA7CisJ
dW5zaWduZWQgaW50IGk7CisJaW50IHJldDsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpF
KGxjZC0+Z2FtbWEpOyBpKyspIHsKKwkJcmV0ID0gc25wcmludGYoYnVmICsgbGVuLCBQQUdFX1NJ
WkUgLSBsZW4sICIldSAiLAorCQkJCWxjZC0+Z2FtbWFbaV0pOworCQlpZiAocmV0IDwgMCkKKwkJ
CXJldHVybiByZXQ7CisJCWxlbiArPSByZXQ7CisJfQorCWJ1ZltsZW4gLSAxXSA9ICdcbic7CisK
KwlyZXR1cm4gbGVuOworfQorCitzdGF0aWMgc3NpemVfdCBnYW1tYV9zdG9yZShzdHJ1Y3QgZGV2
aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLAorCQkJICAgY29uc3QgY2hh
ciAqYnVmLCBzaXplX3QgY291bnQpCit7CisJc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2Qg
PSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwl1bnNpZ25lZCBpbnQgZ1sxMl07CisJdW5zaWduZWQg
aW50IGk7CisJaW50IHJldDsKKworCXJldCA9IHNzY2FuZihidWYsICIldSAldSAldSAldSAldSAl
dSAldSAldSAldSAldSAldSAldSIsCisJCQkmZ1swXSwgJmdbMV0sICZnWzJdLCAmZ1szXSwgJmdb
NF0sICZnWzVdLAorCQkJJmdbNl0sICZnWzddLCAmZ1s4XSwgJmdbOV0sICZnWzEwXSwgJmdbMTFd
KTsKKwlpZiAocmV0ICE9IDEyKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWZvciAoaSA9IDA7IGkg
PCAxMjsgaSsrKQorCQlsY2QtPmdhbW1hW2ldID0gZ1tpXTsKKworCXRkMDQzbXRlYTFfd3JpdGVf
Z2FtbWEobGNkKTsKKworCXJldHVybiBjb3VudDsKK30KKworc3RhdGljIERFVklDRV9BVFRSX1JX
KHZtaXJyb3IpOworc3RhdGljIERFVklDRV9BVFRSX1JXKG1vZGUpOworc3RhdGljIERFVklDRV9B
VFRSX1JXKGdhbW1hKTsKKworc3RhdGljIHN0cnVjdCBhdHRyaWJ1dGUgKnRkMDQzbXRlYTFfYXR0
cnNbXSA9IHsKKwkmZGV2X2F0dHJfdm1pcnJvci5hdHRyLAorCSZkZXZfYXR0cl9tb2RlLmF0dHIs
CisJJmRldl9hdHRyX2dhbW1hLmF0dHIsCisJTlVMTCwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgYXR0cmlidXRlX2dyb3VwIHRkMDQzbXRlYTFfYXR0cl9ncm91cCA9IHsKKwkuYXR0cnMgPSB0
ZDA0M210ZWExX2F0dHJzLAorfTsKKworLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIEJyaWRn
ZSBPcGVyYXRpb25zCisgKi8KKworc3RhdGljIGludCB0ZDA0M210ZWExX2Rpc2FibGUoc3RydWN0
IGRybV9wYW5lbCAqcGFuZWwpCit7CisJc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICpsY2QgPSB0
b190ZDA0M210ZWExX2RldmljZShwYW5lbCk7CisKKwlpZiAoIWxjZC0+c3BpX3N1c3BlbmRlZCkK
KwkJdGQwNDNtdGVhMV9wb3dlcl9vZmYobGNkKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHRkMDQzbXRlYTFfZW5hYmxlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0cnVj
dCB0ZDA0M210ZWExX2RldmljZSAqbGNkID0gdG9fdGQwNDNtdGVhMV9kZXZpY2UocGFuZWwpOwor
CWludCByZXQ7CisKKwkvKgorCSAqIElmIHdlIGFyZSByZXN1bWluZyBmcm9tIHN5c3RlbSBzdXNw
ZW5kLCBTUEkgbWlnaHQgbm90IGJlIGVuYWJsZWQKKwkgKiB5ZXQsIHNvIHdlJ2xsIHByb2dyYW0g
dGhlIExDRCBmcm9tIFNQSSBQTSByZXN1bWUgY2FsbGJhY2suCisJICovCisJaWYgKGxjZC0+c3Bp
X3N1c3BlbmRlZCkKKwkJcmV0dXJuIDA7CisKKwlyZXQgPSB0ZDA0M210ZWExX3Bvd2VyX29uKGxj
ZCk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKCZsY2QtPnNwaS0+ZGV2LCAiJXM6IHBvd2VyIG9u
IGZhaWxlZCAoJWQpXG4iLAorCQkJX19mdW5jX18sIHJldCk7CisJCXJldHVybiByZXQ7CisJfQor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSB0
ZDA0M210ZWExX21vZGUgPSB7CisJLmNsb2NrID0gMzYwMDAsCisJLmhkaXNwbGF5ID0gODAwLAor
CS5oc3luY19zdGFydCA9IDgwMCArIDY4LAorCS5oc3luY19lbmQgPSA4MDAgKyA2OCArIDEsCisJ
Lmh0b3RhbCA9IDgwMCArIDY4ICsgMSArIDIxNCwKKwkudmRpc3BsYXkgPSA0ODAsCisJLnZzeW5j
X3N0YXJ0ID0gNDgwICsgMzksCisJLnZzeW5jX2VuZCA9IDQ4MCArIDM5ICsgMSwKKwkudnRvdGFs
ID0gNDgwICsgMzkgKyAxICsgMzQsCisJLnZyZWZyZXNoID0gNjAsCisJLnR5cGUgPSBEUk1fTU9E
RV9UWVBFX0RSSVZFUiB8IERSTV9NT0RFX1RZUEVfUFJFRkVSUkVELAorCS5mbGFncyA9IERSTV9N
T0RFX0ZMQUdfTkhTWU5DIHwgRFJNX01PREVfRkxBR19OVlNZTkMsCit9OworCitzdGF0aWMgaW50
IHRkMDQzbXRlYTFfZ2V0X21vZGVzKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBwYW5lbC0+Y29ubmVjdG9yOworCXN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICptb2RlOworCisJbW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0ZShwYW5l
bC0+ZHJtLCAmdGQwNDNtdGVhMV9tb2RlKTsKKwlpZiAoIW1vZGUpCisJCXJldHVybiAtRU5PTUVN
OworCisJZHJtX21vZGVfc2V0X25hbWUobW9kZSk7CisJZHJtX21vZGVfcHJvYmVkX2FkZChjb25u
ZWN0b3IsIG1vZGUpOworCisJY29ubmVjdG9yLT5kaXNwbGF5X2luZm8ud2lkdGhfbW0gPSA5NDsK
Kwljb25uZWN0b3ItPmRpc3BsYXlfaW5mby5oZWlnaHRfbW0gPSA1NjsKKwkvKgorCSAqIEZJWE1F
OiBBY2NvcmRpbmcgdG8gdGhlIGRhdGFzaGVldCBzeW5jIHNpZ25hbHMgYXJlIHNhbXBsZWQgb24g
dGhlCisJICogcmlzaW5nIGVkZ2Ugb2YgdGhlIGNsb2NrLCBidXQgdGhlIGNvZGUgcnVubmluZyBv
biB0aGUgT01BUDMgUGFuZG9yYQorCSAqIGluZGljYXRlcyBzYW1wbGluZyBvbiB0aGUgZmFsbGlu
ZyBlZGdlLiBUaGlzIHNob3VsZCBiZSB0ZXN0ZWQgb24gYQorCSAqIHJlYWwgZGV2aWNlLgorCSAq
LworCWNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmJ1c19mbGFncyA9IERSTV9CVVNfRkxBR19ERV9I
SUdICisJCQkJCSAgfCBEUk1fQlVTX0ZMQUdfU1lOQ19TQU1QTEVfTkVHRURHRQorCQkJCQkgIHwg
RFJNX0JVU19GTEFHX1BJWERBVEFfU0FNUExFX1BPU0VER0U7CisKKwlyZXR1cm4gMTsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGFuZWxfZnVuY3MgdGQwNDNtdGVhMV9mdW5jcyA9IHsK
KwkuZGlzYWJsZSA9IHRkMDQzbXRlYTFfZGlzYWJsZSwKKwkuZW5hYmxlID0gdGQwNDNtdGVhMV9l
bmFibGUsCisJLmdldF9tb2RlcyA9IHRkMDQzbXRlYTFfZ2V0X21vZGVzLAorfTsKKworLyogLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0KKyAqIFBvd2VyIE1hbmFnZW1lbnQsIFByb2JlIGFuZCBSZW1vdmUK
KyAqLworCisjaWZkZWYgQ09ORklHX1BNX1NMRUVQCitzdGF0aWMgaW50IHRkMDQzbXRlYTFfc3Vz
cGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJc3RydWN0IHRkMDQzbXRlYTFfZGV2aWNlICps
Y2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCWlmIChsY2QtPnBvd2VyZWRfb24pIHsKKwkJ
dGQwNDNtdGVhMV9wb3dlcl9vZmYobGNkKTsKKwkJbGNkLT5wb3dlcmVkX29uID0gdHJ1ZTsKKwl9
CisKKwlsY2QtPnNwaV9zdXNwZW5kZWQgPSB0cnVlOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyBpbnQgdGQwNDNtdGVhMV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCB0
ZDA0M210ZWExX2RldmljZSAqbGNkID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJaW50IHJldDsK
KworCWxjZC0+c3BpX3N1c3BlbmRlZCA9IGZhbHNlOworCisJaWYgKGxjZC0+cG93ZXJlZF9vbikg
eworCQlsY2QtPnBvd2VyZWRfb24gPSBmYWxzZTsKKwkJcmV0ID0gdGQwNDNtdGVhMV9wb3dlcl9v
bihsY2QpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIFNJTVBMRV9ERVZfUE1fT1BTKHRkMDQzbXRlYTFfcG1fb3BzLCB0ZDA0M210ZWEx
X3N1c3BlbmQsCisJCQkgdGQwNDNtdGVhMV9yZXN1bWUpOworI2VuZGlmCisKK3N0YXRpYyBpbnQg
dGQwNDNtdGVhMV9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQoreworCXN0cnVjdCB0ZDA0
M210ZWExX2RldmljZSAqbGNkOworCWludCByZXQ7CisKKwlsY2QgPSBkZXZtX2t6YWxsb2MoJnNw
aS0+ZGV2LCBzaXplb2YoKmxjZCksIEdGUF9LRVJORUwpOworCWlmIChsY2QgPT0gTlVMTCkKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlzcGlfc2V0X2RydmRhdGEoc3BpLCBsY2QpOworCWxjZC0+c3Bp
ID0gc3BpOworCWxjZC0+bW9kZSA9IFRQT19SMDJfTU9ERV84MDB4NDgwOworCW1lbWNweShsY2Qt
PmdhbW1hLCB0ZDA0M210ZWExX2RlZl9nYW1tYSwgc2l6ZW9mKGxjZC0+Z2FtbWEpKTsKKworCWxj
ZC0+dmNjX3JlZyA9IGRldm1fcmVndWxhdG9yX2dldCgmc3BpLT5kZXYsICJ2Y2MiKTsKKwlpZiAo
SVNfRVJSKGxjZC0+dmNjX3JlZykpIHsKKwkJZGV2X2Vycigmc3BpLT5kZXYsICJmYWlsZWQgdG8g
Z2V0IFZDQyByZWd1bGF0b3JcbiIpOworCQlyZXR1cm4gUFRSX0VSUihsY2QtPnZjY19yZWcpOwor
CX0KKworCWxjZC0+cmVzZXRfZ3BpbyA9IGRldm1fZ3Bpb2RfZ2V0KCZzcGktPmRldiwgInJlc2V0
IiwgR1BJT0RfT1VUX0hJR0gpOworCWlmIChJU19FUlIobGNkLT5yZXNldF9ncGlvKSkgeworCQlk
ZXZfZXJyKCZzcGktPmRldiwgImZhaWxlZCB0byBnZXQgcmVzZXQgR1BJT1xuIik7CisJCXJldHVy
biBQVFJfRVJSKGxjZC0+cmVzZXRfZ3Bpbyk7CisJfQorCisJc3BpLT5iaXRzX3Blcl93b3JkID0g
MTY7CisJc3BpLT5tb2RlID0gU1BJX01PREVfMDsKKworCXJldCA9IHNwaV9zZXR1cChzcGkpOwor
CWlmIChyZXQgPCAwKSB7CisJCWRldl9lcnIoJnNwaS0+ZGV2LCAiZmFpbGVkIHRvIHNldHVwIFNQ
STogJWRcbiIsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0ID0gc3lzZnNfY3JlYXRl
X2dyb3VwKCZzcGktPmRldi5rb2JqLCAmdGQwNDNtdGVhMV9hdHRyX2dyb3VwKTsKKwlpZiAocmV0
IDwgMCkgeworCQlkZXZfZXJyKCZzcGktPmRldiwgImZhaWxlZCB0byBjcmVhdGUgc3lzZnMgZmls
ZXNcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9wYW5lbF9pbml0KCZsY2QtPnBhbmVs
KTsKKwlsY2QtPnBhbmVsLmRldiA9ICZsY2QtPnNwaS0+ZGV2OworCWxjZC0+cGFuZWwuZnVuY3Mg
PSAmdGQwNDNtdGVhMV9mdW5jczsKKworCXJldCA9IGRybV9wYW5lbF9hZGQoJmxjZC0+cGFuZWwp
OworCWlmIChyZXQgPCAwKSB7CisJCXN5c2ZzX3JlbW92ZV9ncm91cCgmc3BpLT5kZXYua29iaiwg
JnRkMDQzbXRlYTFfYXR0cl9ncm91cCk7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyBpbnQgdGQwNDNtdGVhMV9yZW1vdmUoc3RydWN0IHNwaV9kZXZpY2UgKnNw
aSkKK3sKKwlzdHJ1Y3QgdGQwNDNtdGVhMV9kZXZpY2UgKmxjZCA9IHNwaV9nZXRfZHJ2ZGF0YShz
cGkpOworCisJZHJtX3BhbmVsX3JlbW92ZSgmbGNkLT5wYW5lbCk7CisJdGQwNDNtdGVhMV9kaXNh
YmxlKCZsY2QtPnBhbmVsKTsKKworCXN5c2ZzX3JlbW92ZV9ncm91cCgmc3BpLT5kZXYua29iaiwg
JnRkMDQzbXRlYTFfYXR0cl9ncm91cCk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0
IHN0cnVjdCBvZl9kZXZpY2VfaWQgdGQwNDNtdGVhMV9vZl9tYXRjaFtdID0geworCXsgLmNvbXBh
dGlibGUgPSAidHBvLHRkMDQzbXRlYTEiLCB9LAorCXt9LAorfTsKKworTU9EVUxFX0RFVklDRV9U
QUJMRShvZiwgdGQwNDNtdGVhMV9vZl9tYXRjaCk7CisKK3N0YXRpYyBzdHJ1Y3Qgc3BpX2RyaXZl
ciB0ZDA0M210ZWExX2RyaXZlciA9IHsKKwkucHJvYmUJCT0gdGQwNDNtdGVhMV9wcm9iZSwKKwku
cmVtb3ZlCQk9IHRkMDQzbXRlYTFfcmVtb3ZlLAorCS5kcml2ZXIJCT0geworCQkubmFtZQk9ICJw
YW5lbC10cG8tdGQwNDNtdGVhMSIsCisjaWZkZWYgQ09ORklHX1BNX1NMRUVQCisJCS5wbQk9ICZ0
ZDA0M210ZWExX3BtX29wcywKKyNlbmRpZgorCQkub2ZfbWF0Y2hfdGFibGUgPSB0ZDA0M210ZWEx
X29mX21hdGNoLAorCX0sCit9OworCittb2R1bGVfc3BpX2RyaXZlcih0ZDA0M210ZWExX2RyaXZl
cik7CisKK01PRFVMRV9BTElBUygic3BpOnRwbyx0ZDA0M210ZWExIik7CitNT0RVTEVfQVVUSE9S
KCJHcmHFvnZ5ZGFzIElnbm90YXMgPG5vdGFzYXNAZ21haWwuY29tPiIpOworTU9EVUxFX0RFU0NS
SVBUSU9OKCJUUE8gVEQwNDNNVEVBMSBQYW5lbCBEcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJH
UEwiKTsKLS0gClJlZ2FyZHMsCgpMYXVyZW50IFBpbmNoYXJ0CgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
