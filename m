Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8215A3CEB8
	for <lists+dri-devel@lfdr.de>; Tue, 11 Jun 2019 16:31:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43D4A891EF;
	Tue, 11 Jun 2019 14:31:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BC14D891EF
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 14:31:19 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 4FCFDAE91;
 Tue, 11 Jun 2019 14:31:18 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: noralf@tronnes.org,
	sam@ravnborg.org,
	daniel@ffwll.ch
Subject: [PATCH v2] drm: Reverse lock order in DRM display-panning helpers()
Date: Tue, 11 Jun 2019 16:31:14 +0200
Message-Id: <20190611143114.24003-1-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHVyaW5nIGRpc3BsYXkgcGFubmluZywgYWNxdWlyaW5nIGRybV9jbGllbnRfZGV2Lm1vZGVzZXRf
bXV0ZXggYWZ0ZXIgdGhlCmxvY2tzIGluIGRybV9mYl9oZWxwZXIuZGV2IGNyZWF0ZXMgYSBkZWFk
bG9jayB3aXRoIGRybV9zZXR1cF9jcnRjcygpIGFzCnNob3duIGJlbG93OgoKICBbICAgIDQuOTU5
MzE5XSBmYmNvbjogcmFkZW9uZHJtZmIgKGZiMCkgaXMgcHJpbWFyeSBkZXZpY2UKICBbICAgIDQu
OTkzOTUyXSBDb25zb2xlOiBzd2l0Y2hpbmcgdG8gY29sb3VyIGZyYW1lIGJ1ZmZlciBkZXZpY2Ug
MjQweDY3CiAgWyAgICA0Ljk5NDA0MF0KICBbICAgIDQuOTk0MDQxXSA9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBbICAgIDQuOTk0MDQxXSBX
QVJOSU5HOiBwb3NzaWJsZSBjaXJjdWxhciBsb2NraW5nIGRlcGVuZGVuY3kgZGV0ZWN0ZWQKICBb
ICAgIDQuOTk0MDQyXSA1LjIuMC1yYzQtMS1kZWZhdWx0KyAjMzkgVGFpbnRlZDogRyAgICAgICAg
ICAgIEUKICBbICAgIDQuOTk0MDQzXSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KICBbICAgIDQuOTk0MDQzXSBzeXN0ZW1kLXVkZXZkLzM2OSBp
cyB0cnlpbmcgdG8gYWNxdWlyZSBsb2NrOgogIFsgICAgNC45OTQwNDRdIDAwMDAwMDAwZmI2MjJh
Y2IgKCZjbGllbnQtPm1vZGVzZXRfbXV0ZXgpeysuKy59LCBhdDogZHJtX2ZiX2hlbHBlcl9wYW5f
ZGlzcGxheSsweDEwMy8weDFmMCBbZHJtX2ttc19oZWxwZXJdCiAgWyAgICA0Ljk5NDA1NV0KICBb
ICAgIDQuOTk0MDU1XSBidXQgdGFzayBpcyBhbHJlYWR5IGhvbGRpbmcgbG9jazoKICBbICAgIDQu
OTk0MDU1XSAwMDAwMDAwMDI4NzY3YWU0IChjcnRjX3d3X2NsYXNzX211dGV4KXsrLisufSwgYXQ6
IGRybV9tb2Rlc2V0X2xvY2srMHg0Mi8weGYwIFtkcm1dCiAgWyAgICA0Ljk5NDA3Ml0KICBbICAg
IDQuOTk0MDcyXSB3aGljaCBsb2NrIGFscmVhZHkgZGVwZW5kcyBvbiB0aGUgbmV3IGxvY2suCiAg
WyAgICA0Ljk5NDA3Ml0KICBbICAgIDQuOTk0MDcyXQogIFsgICAgNC45OTQwNzJdIHRoZSBleGlz
dGluZyBkZXBlbmRlbmN5IGNoYWluIChpbiByZXZlcnNlIG9yZGVyKSBpczoKICBbICAgIDQuOTk0
MDczXQogIFsgICAgNC45OTQwNzNdIC0+ICMzIChjcnRjX3d3X2NsYXNzX211dGV4KXsrLisufToK
ICBbICAgIDQuOTk0MDc2XSAgICAgICAgbG9ja19hY3F1aXJlKzB4OWUvMHgxNzAKICBbICAgIDQu
OTk0MDc5XSAgICAgICAgX193d19tdXRleF9sb2NrLmNvbnN0cHJvcC4xOCsweDk3LzB4ZjQwCiAg
WyAgICA0Ljk5NDA4MF0gICAgICAgIHd3X211dGV4X2xvY2srMHgzMC8weDkwCiAgWyAgICA0Ljk5
NDA5MV0gICAgICAgIGRybV9tb2Rlc2V0X2xvY2srMHg0Mi8weGYwIFtkcm1dCiAgWyAgICA0Ljk5
NDEwMl0gICAgICAgIGRybV9tb2Rlc2V0X2xvY2tfYWxsX2N0eCsweDFmLzB4ZTAgW2RybV0KICBb
ICAgIDQuOTk0MTEzXSAgICAgICAgZHJtX21vZGVzZXRfbG9ja19hbGwrMHg1ZS8weDFhMCBbZHJt
XQogIFsgICAgNC45OTQxNjNdICAgICAgICBpbnRlbF9tb2Rlc2V0X2luaXQrMHg2MGIvMHhkYTAg
W2k5MTVdCiAgLi4KICBbICAgIDQuOTk0MjUzXQogIFsgICAgNC45OTQyNTNdIC0+ICMyIChjcnRj
X3d3X2NsYXNzX2FjcXVpcmUpeysuKy59OgogIFsgICAgNC45OTQyNTVdICAgICAgICBsb2NrX2Fj
cXVpcmUrMHg5ZS8weDE3MAogIFsgICAgNC45OTQyNzBdICAgICAgICBkcm1fbW9kZXNldF9hY3F1
aXJlX2luaXQrMHhjYy8weDEwMCBbZHJtXQogIFsgICAgNC45OTQyODBdICAgICAgICBkcm1fbW9k
ZXNldF9sb2NrX2FsbCsweDQ0LzB4MWEwIFtkcm1dCiAgWyAgICA0Ljk5NDMyMF0gICAgICAgIGlu
dGVsX21vZGVzZXRfaW5pdCsweDYwYi8weGRhMCBbaTkxNV0KICAuLgogIFsgICAgNC45OTQ0MDNd
CiAgWyAgICA0Ljk5NDQwM10gLT4gIzEgKCZkZXYtPm1vZGVfY29uZmlnLm11dGV4KXsrLisufToK
ICBbICAgIDQuOTk0NDA1XSAgICAgICAgbG9ja19hY3F1aXJlKzB4OWUvMHgxNzAKICBbICAgIDQu
OTk0NDA4XSAgICAgICAgX19tdXRleF9sb2NrKzB4NjIvMHg4YzAKICBbICAgIDQuOTk0NDEzXSAg
ICAgICAgZHJtX3NldHVwX2NydGNzKzB4MTdjLzB4YzUwIFtkcm1fa21zX2hlbHBlcl0KICBbICAg
IDQuOTk0NDE4XSAgICAgICAgX19kcm1fZmJfaGVscGVyX2luaXRpYWxfY29uZmlnX2FuZF91bmxv
Y2srMHgzNC8weDUzMCBbZHJtX2ttc19oZWxwZXJdCiAgWyAgICA0Ljk5NDQ1MF0gICAgICAgIHJh
ZGVvbl9mYmRldl9pbml0KzB4MTEwLzB4MTMwIFtyYWRlb25dCiAgLi4KICBbICAgIDQuOTk0NTM1
XQogIFsgICAgNC45OTQ1MzVdIC0+ICMwICgmY2xpZW50LT5tb2Rlc2V0X211dGV4KXsrLisufToK
ICBbICAgIDQuOTk0NTM3XSAgICAgICAgX19sb2NrX2FjcXVpcmUrMHhhODUvMHhlOTAKICBbICAg
IDQuOTk0NTM4XSAgICAgICAgbG9ja19hY3F1aXJlKzB4OWUvMHgxNzAKICBbICAgIDQuOTk0NTQw
XSAgICAgICAgX19tdXRleF9sb2NrKzB4NjIvMHg4YzAKICBbICAgIDQuOTk0NTQ1XSAgICAgICAg
ZHJtX2ZiX2hlbHBlcl9wYW5fZGlzcGxheSsweDEwMy8weDFmMCBbZHJtX2ttc19oZWxwZXJdCiAg
WyAgICA0Ljk5NDU0N10gICAgICAgIGZiX3Bhbl9kaXNwbGF5KzB4OTIvMHgxMjAKICBbICAgIDQu
OTk0NTQ5XSAgICAgICAgYml0X3VwZGF0ZV9zdGFydCsweDFhLzB4NDAKICBbICAgIDQuOTk0NTUw
XSAgICAgICAgZmJjb25fc3dpdGNoKzB4MzkyLzB4NTgwCiAgWyAgICA0Ljk5NDU1Ml0gICAgICAg
IHJlZHJhd19zY3JlZW4rMHgxMmMvMHgyMjAKICBbICAgIDQuOTk0NTUzXSAgICAgICAgZG9fYmlu
ZF9jb25fZHJpdmVyLmNvbGQuMzArMHhlMS8weDEwZAogIFsgICAgNC45OTQ1NTRdICAgICAgICBk
b190YWtlX292ZXJfY29uc29sZSsweDExMy8weDE5MAogIFsgICAgNC45OTQ1NTVdICAgICAgICBk
b19mYmNvbl90YWtlb3ZlcisweDU4LzB4YjAKICBbICAgIDQuOTk0NTU3XSAgICAgICAgbm90aWZp
ZXJfY2FsbF9jaGFpbisweDQ3LzB4NzAKICBbICAgIDQuOTk0NTU4XSAgICAgICAgYmxvY2tpbmdf
bm90aWZpZXJfY2FsbF9jaGFpbisweDQ0LzB4NjAKICBbICAgIDQuOTk0NTU5XSAgICAgICAgcmVn
aXN0ZXJfZnJhbWVidWZmZXIrMHgyMzEvMHgzMTAKICBbICAgIDQuOTk0NTY0XSAgICAgICAgX19k
cm1fZmJfaGVscGVyX2luaXRpYWxfY29uZmlnX2FuZF91bmxvY2srMHgyZmQvMHg1MzAgW2RybV9r
bXNfaGVscGVyXQogIFsgICAgNC45OTQ1OTBdICAgICAgICByYWRlb25fZmJkZXZfaW5pdCsweDEx
MC8weDEzMCBbcmFkZW9uXQogIC4uCgpUaGlzIHByb2JsZW0gd2FzIGludHJvZHVjZWQgaW4KCiAg
ZDgxMjk0YWZlCWRybS9mYi1oZWxwZXI6IFJlbW92ZSBkcm1fZmJfaGVscGVyX2NydGMKClJldmVy
c2luZyB0aGUgbG9jayBvcmRlcmluZyBpbiB0aGUgZGlzcGxheS1wYW5uaW5nIGNvZGUgZml4ZXMg
dGhlIGlzc3VlLiBJbgphZGRpdGlvbiB0byB0aGUgZml4LCB0aGUgRFJNIGNsaWVudCBub3cgaW1w
bGVtZW50cyB0aGUgcGFubmluZy4gVGhlIGNhbGwgdG8KZHJtX2NsaWVudF9tb2Rlc2V0X3Bhbl9k
aXNwbGF5KCkgYWNxdWlyZXMgZHJtX2NsaWVudF9kZXYubW9kZXNldF9tdXRleCBvbmNlCmZvciB0
aGUgd2hvbGUgb3BlcmF0aW9uLgoKVGhlIGNoYW5nZSB3YXMgc3VnZ2VzdGVkIGJ5IERhbmllbCBW
ZXR0ZXIgYW5kIE5vcmFsZiBUcm9ubmVzLgoKdjI6CgkqIG1vdmUgZGlzcGxheSBwYW5uaW5nIHRv
IERSTSBjbGllbnQKCSogYWNxdWlyZSBtb2Rlc2V0X211dGV4IG9uY2UgaW4gZHJtX2NsaWVudF9t
b2Rlc2V0X3Bhbl9kaXNwbGF5KCkKClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0
emltbWVybWFubkBzdXNlLmRlPgpGaXhlczogZDgxMjk0YWZlZWNkYWNjOGQ4NDgwNGJhMGJjYjNk
MzllNjRkMGYyNwotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50X21vZGVzZXQuYyB8IDEx
MCArKysrKysrKysrKysrKysrKysrKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZmJfaGVs
cGVyLmMgICAgICB8ICA3OSArKy0tLS0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2RybS9kcm1fY2xp
ZW50LmggICAgICAgICAgICAgfCAgIDQgKwogMyBmaWxlcyBjaGFuZ2VkLCAxMTcgaW5zZXJ0aW9u
cygrKSwgNzYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9j
bGllbnRfbW9kZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnRfbW9kZXNldC5jCmlu
ZGV4IGIxOTg0ZjkwMWE2ZC4uMjBjOGZlOTQyNDllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vZHJtX2NsaWVudF9tb2Rlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnRf
bW9kZXNldC5jCkBAIC0yODgsNiArMjg4LDE5IEBAIHN0YXRpYyBpbnQgZHJtX2NsaWVudF9tb2Rl
c2V0X2NvbW1pdF9sZWdhY3koc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQpCiAJcmV0dXJu
IHJldDsKIH0KIAorc3RhdGljIGludCBfX2RybV9jbGllbnRfbW9kZXNldF9jb21taXRfZm9yY2Uo
c3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNsaWVudC0+ZGV2OworCWludCByZXQ7CisKKwlpZiAoZHJtX2Rydl91c2VzX2F0b21pY19t
b2Rlc2V0KGRldikpCisJCXJldCA9IGRybV9jbGllbnRfbW9kZXNldF9jb21taXRfYXRvbWljKGNs
aWVudCwgdHJ1ZSk7CisJZWxzZQorCQlyZXQgPSBkcm1fY2xpZW50X21vZGVzZXRfY29tbWl0X2xl
Z2FjeShjbGllbnQpOworCisJcmV0dXJuIHJldDsKK30KKwogLyoqCiAgKiBkcm1fY2xpZW50X21v
ZGVzZXRfY29tbWl0X2ZvcmNlKCkgLSBGb3JjZSBjb21taXQgQ1JUQyBjb25maWd1cmF0aW9uCiAg
KiBAY2xpZW50OiBEUk0gY2xpZW50CkBAIC0yOTksMTQgKzMxMiwxMCBAQCBzdGF0aWMgaW50IGRy
bV9jbGllbnRfbW9kZXNldF9jb21taXRfbGVnYWN5KHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xp
ZW50KQogICovCiBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9mb3JjZShzdHJ1Y3QgZHJt
X2NsaWVudF9kZXYgKmNsaWVudCkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY2xpZW50
LT5kZXY7CiAJaW50IHJldDsKIAogCW11dGV4X2xvY2soJmNsaWVudC0+bW9kZXNldF9tdXRleCk7
Ci0JaWYgKGRybV9kcnZfdXNlc19hdG9taWNfbW9kZXNldChkZXYpKQotCQlyZXQgPSBkcm1fY2xp
ZW50X21vZGVzZXRfY29tbWl0X2F0b21pYyhjbGllbnQsIHRydWUpOwotCWVsc2UKLQkJcmV0ID0g
ZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9sZWdhY3koY2xpZW50KTsKKwlyZXQgPSBfX2RybV9j
bGllbnRfbW9kZXNldF9jb21taXRfZm9yY2UoY2xpZW50KTsKIAltdXRleF91bmxvY2soJmNsaWVu
dC0+bW9kZXNldF9tdXRleCk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtMzkwLDMgKzM5OSw5NCBAQCBp
bnQgZHJtX2NsaWVudF9tb2Rlc2V0X2RwbXMoc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQs
IGludCBtb2RlKQogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9jbGllbnRfbW9k
ZXNldF9kcG1zKTsKKworc3RhdGljIHZvaWQgcGFuX3NldChzdHJ1Y3QgZHJtX2NsaWVudF9kZXYg
KmNsaWVudCwgdW5zaWduZWQgaW50IHgsCisJCSAgICB1bnNpZ25lZCBpbnQgeSkKK3sKKwlzdHJ1
Y3QgZHJtX21vZGVfc2V0ICptb2RlX3NldDsKKworCWRybV9jbGllbnRfZm9yX2VhY2hfbW9kZXNl
dChtb2RlX3NldCwgY2xpZW50KSB7CisJCW1vZGVfc2V0LT54ID0geDsKKwkJbW9kZV9zZXQtPnkg
PSB5OworCX0KK30KKworc3RhdGljIGludCBkcm1fY2xpZW50X21vZGVzZXRfcGFuX2Rpc3BsYXlf
YXRvbWljKHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50LAorCQkJCQkJIHVuc2lnbmVkIGlu
dCB4LAorCQkJCQkJIHVuc2lnbmVkIGludCB5LAorCQkJCQkJIHVuc2lnbmVkIGludCBkZWZhdWx0
X3gsCisJCQkJCQkgdW5zaWduZWQgaW50IGRlZmF1bHRfeSkKK3sKKwlpbnQgcmV0OworCisJcGFu
X3NldChjbGllbnQsIHgsIHkpOworCisJcmV0ID0gX19kcm1fY2xpZW50X21vZGVzZXRfY29tbWl0
X2ZvcmNlKGNsaWVudCk7CisJaWYgKHJldCkKKwkJcGFuX3NldChjbGllbnQsIGRlZmF1bHRfeCwg
ZGVmYXVsdF95KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZHJtX2NsaWVudF9t
b2Rlc2V0X3Bhbl9kaXNwbGF5X2xlZ2FjeShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCwK
KwkJCQkJCSB1bnNpZ25lZCBpbnQgeCwKKwkJCQkJCSB1bnNpZ25lZCBpbnQgeSkKK3sKKwlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY2xpZW50LT5kZXY7CisJc3RydWN0IGRybV9tb2RlX3NldCAq
bW9kZXNldDsKKwlpbnQgcmV0ID0gMDsKKworCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7CisJ
ZHJtX2NsaWVudF9mb3JfZWFjaF9tb2Rlc2V0KG1vZGVzZXQsIGNsaWVudCkgeworCQltb2Rlc2V0
LT54ID0geDsKKwkJbW9kZXNldC0+eSA9IHk7CisKKwkJaWYgKG1vZGVzZXQtPm51bV9jb25uZWN0
b3JzKQorCQkJcmV0ID0gZHJtX21vZGVfc2V0X2NvbmZpZ19pbnRlcm5hbChtb2Rlc2V0KTsKKwl9
CisJZHJtX21vZGVzZXRfdW5sb2NrX2FsbChkZXYpOworCisJcmV0dXJuIHJldDsKK30KKworLyoq
CisgKiBkcm1fY2xpZW50X21vZGVzZXRfZHBtcygpIC0gU2V0IGRpc3BsYXkgcGFubmluZworICog
QGNsaWVudDogRFJNIGNsaWVudAorICogQHg6IEhvcml6b250YWwgY29vcmRpbmF0ZQorICogQHk6
IFZlcnRpY2FsIGNvb3JkaW5hdGUKKyAqIEBkZWZhdWx0X3g6IEZhbGxiYWNrIGhvcml6b250YWwg
Y29vcmRpbmF0ZQorICogQGRlZmF1bHRfeTogRmFsbGJhY2sgdmVydGljYWwgY29vcmRpbmF0ZQor
ICoKKyAqIFRoaXMgZnVuY3Rpb24gc2V0cyB0aGUgZGlzcGxheSBwYW5uaW5nIGZvciBzY3JlZW5z
IHdpdGggYSB2aXJ0dWFsCisgKiByZXNvbHV0aW9uLiBUaGUgeCBhbmQgeSBjb29yZGluYXRlcyBy
ZWZlciB0byB0aGUgZGlzcGxheSdzIHVwcGVyCisgKiBsZWZ0IHBpeGVsLiBJZiB1cGRhdGluZyBm
YWlscywgdGhlIGZhbGxiYWNrIGNvb3JkaW5hdGVzIHByb3ZpZGUgYQorICogc2FmZSBkZWZhdWx0
IHZhbHVlLCBzdWNoIGFzICgwLDApLgorICoKKyAqIFJldHVybnM6CisgKiBaZXJvIG9uIHN1Y2Nl
c3Mgb3IgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBmYWlsdXJlLgorICovCitpbnQgZHJtX2NsaWVu
dF9tb2Rlc2V0X3Bhbl9kaXNwbGF5KHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50LAorCQkJ
CSAgIHVuc2lnbmVkIGludCB4LCB1bnNpZ25lZCBpbnQgeSwKKwkJCQkgICB1bnNpZ25lZCBpbnQg
ZGVmYXVsdF94LAorCQkJCSAgIHVuc2lnbmVkIGludCBkZWZhdWx0X3kpCit7CisJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGNsaWVudC0+ZGV2OworCWludCByZXQ7CisKKwlpZiAoIWRybV9tYXN0
ZXJfaW50ZXJuYWxfYWNxdWlyZShkZXYpKQorCQlyZXR1cm4gLUVCVVNZOworCisJbXV0ZXhfbG9j
aygmY2xpZW50LT5tb2Rlc2V0X211dGV4KTsKKwlpZiAoZHJtX2Rydl91c2VzX2F0b21pY19tb2Rl
c2V0KGRldikpCisJCXJldCA9IGRybV9jbGllbnRfbW9kZXNldF9wYW5fZGlzcGxheV9hdG9taWMo
Y2xpZW50LCB4LCB5LAorCQkJCQkJCSAgICBkZWZhdWx0X3gsCisJCQkJCQkJICAgIGRlZmF1bHRf
eSk7CisJZWxzZQorCQlyZXQgPSBkcm1fY2xpZW50X21vZGVzZXRfcGFuX2Rpc3BsYXlfbGVnYWN5
KGNsaWVudCwgeCwgeSk7CisJbXV0ZXhfdW5sb2NrKCZjbGllbnQtPm1vZGVzZXRfbXV0ZXgpOwor
CisJZHJtX21hc3Rlcl9pbnRlcm5hbF9yZWxlYXNlKGRldik7CisKKwlyZXR1cm4gcmV0OworfQor
RVhQT1JUX1NZTUJPTChkcm1fY2xpZW50X21vZGVzZXRfcGFuX2Rpc3BsYXkpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9mYl9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1f
ZmJfaGVscGVyLmMKaW5kZXggN2IzODg2NzRhNDU2Li40ODJlOTJjMTgyYzggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9kcm1fZmJfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9mYl9oZWxwZXIuYwpAQCAtMTU0OCw2NCArMTU0OCw2IEBAIGludCBkcm1fZmJfaGVscGVyX3Nl
dF9wYXIoc3RydWN0IGZiX2luZm8gKmluZm8pCiB9CiBFWFBPUlRfU1lNQk9MKGRybV9mYl9oZWxw
ZXJfc2V0X3Bhcik7CiAKLXN0YXRpYyB2b2lkIHBhbl9zZXQoc3RydWN0IGRybV9mYl9oZWxwZXIg
KmZiX2hlbHBlciwgaW50IHgsIGludCB5KQotewotCXN0cnVjdCBkcm1fbW9kZV9zZXQgKm1vZGVf
c2V0OwotCi0JbXV0ZXhfbG9jaygmZmJfaGVscGVyLT5jbGllbnQubW9kZXNldF9tdXRleCk7Ci0J
ZHJtX2NsaWVudF9mb3JfZWFjaF9tb2Rlc2V0KG1vZGVfc2V0LCAmZmJfaGVscGVyLT5jbGllbnQp
IHsKLQkJbW9kZV9zZXQtPnggPSB4OwotCQltb2RlX3NldC0+eSA9IHk7Ci0JfQotCW11dGV4X3Vu
bG9jaygmZmJfaGVscGVyLT5jbGllbnQubW9kZXNldF9tdXRleCk7Ci19Ci0KLXN0YXRpYyBpbnQg
cGFuX2Rpc3BsYXlfYXRvbWljKHN0cnVjdCBmYl92YXJfc2NyZWVuaW5mbyAqdmFyLAotCQkJICAg
ICAgc3RydWN0IGZiX2luZm8gKmluZm8pCi17Ci0Jc3RydWN0IGRybV9mYl9oZWxwZXIgKmZiX2hl
bHBlciA9IGluZm8tPnBhcjsKLQlpbnQgcmV0OwotCi0JcGFuX3NldChmYl9oZWxwZXIsIHZhci0+
eG9mZnNldCwgdmFyLT55b2Zmc2V0KTsKLQotCXJldCA9IGRybV9jbGllbnRfbW9kZXNldF9jb21t
aXRfZm9yY2UoJmZiX2hlbHBlci0+Y2xpZW50KTsKLQlpZiAoIXJldCkgewotCQlpbmZvLT52YXIu
eG9mZnNldCA9IHZhci0+eG9mZnNldDsKLQkJaW5mby0+dmFyLnlvZmZzZXQgPSB2YXItPnlvZmZz
ZXQ7Ci0JfSBlbHNlCi0JCXBhbl9zZXQoZmJfaGVscGVyLCBpbmZvLT52YXIueG9mZnNldCwgaW5m
by0+dmFyLnlvZmZzZXQpOwotCi0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIGludCBwYW5fZGlz
cGxheV9sZWdhY3koc3RydWN0IGZiX3Zhcl9zY3JlZW5pbmZvICp2YXIsCi0JCQkgICAgICBzdHJ1
Y3QgZmJfaW5mbyAqaW5mbykKLXsKLQlzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqZmJfaGVscGVyID0g
aW5mby0+cGFyOwotCXN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50ID0gJmZiX2hlbHBlci0+
Y2xpZW50OwotCXN0cnVjdCBkcm1fbW9kZV9zZXQgKm1vZGVzZXQ7Ci0JaW50IHJldCA9IDA7Ci0K
LQlkcm1fbW9kZXNldF9sb2NrX2FsbChmYl9oZWxwZXItPmRldik7Ci0JbXV0ZXhfbG9jaygmY2xp
ZW50LT5tb2Rlc2V0X211dGV4KTsKLQlkcm1fY2xpZW50X2Zvcl9lYWNoX21vZGVzZXQobW9kZXNl
dCwgY2xpZW50KSB7Ci0JCW1vZGVzZXQtPnggPSB2YXItPnhvZmZzZXQ7Ci0JCW1vZGVzZXQtPnkg
PSB2YXItPnlvZmZzZXQ7Ci0KLQkJaWYgKG1vZGVzZXQtPm51bV9jb25uZWN0b3JzKSB7Ci0JCQly
ZXQgPSBkcm1fbW9kZV9zZXRfY29uZmlnX2ludGVybmFsKG1vZGVzZXQpOwotCQkJaWYgKCFyZXQp
IHsKLQkJCQlpbmZvLT52YXIueG9mZnNldCA9IHZhci0+eG9mZnNldDsKLQkJCQlpbmZvLT52YXIu
eW9mZnNldCA9IHZhci0+eW9mZnNldDsKLQkJCX0KLQkJfQotCX0KLQltdXRleF91bmxvY2soJmNs
aWVudC0+bW9kZXNldF9tdXRleCk7Ci0JZHJtX21vZGVzZXRfdW5sb2NrX2FsbChmYl9oZWxwZXIt
PmRldik7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiAvKioKICAqIGRybV9mYl9oZWxwZXJfcGFuX2Rp
c3BsYXkgLSBpbXBsZW1lbnRhdGlvbiBmb3IgJmZiX29wcy5mYl9wYW5fZGlzcGxheQogICogQHZh
cjogdXBkYXRlZCBzY3JlZW4gaW5mb3JtYXRpb24KQEAgLTE2MTUsMjcgKzE1NTcsMjIgQEAgaW50
IGRybV9mYl9oZWxwZXJfcGFuX2Rpc3BsYXkoc3RydWN0IGZiX3Zhcl9zY3JlZW5pbmZvICp2YXIs
CiAJCQkgICAgICBzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKIHsKIAlzdHJ1Y3QgZHJtX2ZiX2hlbHBl
ciAqZmJfaGVscGVyID0gaW5mby0+cGFyOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBmYl9o
ZWxwZXItPmRldjsKIAlpbnQgcmV0OwogCiAJaWYgKG9vcHNfaW5fcHJvZ3Jlc3MpCiAJCXJldHVy
biAtRUJVU1k7CiAKIAltdXRleF9sb2NrKCZmYl9oZWxwZXItPmxvY2spOwotCWlmICghZHJtX21h
c3Rlcl9pbnRlcm5hbF9hY3F1aXJlKGRldikpIHsKLQkJcmV0ID0gLUVCVVNZOwotCQlnb3RvIHVu
bG9jazsKLQl9Ci0KLQlpZiAoZHJtX2Rydl91c2VzX2F0b21pY19tb2Rlc2V0KGRldikpCi0JCXJl
dCA9IHBhbl9kaXNwbGF5X2F0b21pYyh2YXIsIGluZm8pOwotCWVsc2UKLQkJcmV0ID0gcGFuX2Rp
c3BsYXlfbGVnYWN5KHZhciwgaW5mbyk7Ci0KLQlkcm1fbWFzdGVyX2ludGVybmFsX3JlbGVhc2Uo
ZGV2KTsKLXVubG9jazoKKwlyZXQgPSBkcm1fY2xpZW50X21vZGVzZXRfcGFuX2Rpc3BsYXkoJmZi
X2hlbHBlci0+Y2xpZW50LCB2YXItPnhvZmZzZXQsCisJCQkJCSAgICAgdmFyLT55b2Zmc2V0LCBp
bmZvLT52YXIueG9mZnNldCwKKwkJCQkJICAgICBpbmZvLT52YXIueW9mZnNldCk7CiAJbXV0ZXhf
dW5sb2NrKCZmYl9oZWxwZXItPmxvY2spOwogCisJaWYgKCFyZXQpIHsKKwkJaW5mby0+dmFyLnhv
ZmZzZXQgPSB2YXItPnhvZmZzZXQ7CisJCWluZm8tPnZhci55b2Zmc2V0ID0gdmFyLT55b2Zmc2V0
OworCX0KKwogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9mYl9oZWxwZXJfcGFu
X2Rpc3BsYXkpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2NsaWVudC5oIGIvaW5jbHVk
ZS9kcm0vZHJtX2NsaWVudC5oCmluZGV4IDZjZjQ4NDE5Zjc3Zi4uMzdiZjU1NjM0MjI3IDEwMDY0
NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2Ns
aWVudC5oCkBAIC0xNTksNiArMTU5LDEwIEBAIGJvb2wgZHJtX2NsaWVudF9wYW5lbF9yb3RhdGlv
bihzdHJ1Y3QgZHJtX21vZGVfc2V0ICptb2Rlc2V0LCB1bnNpZ25lZCBpbnQgKnJvdGF0CiBpbnQg
ZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdF9mb3JjZShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNs
aWVudCk7CiBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1pdChzdHJ1Y3QgZHJtX2NsaWVudF9k
ZXYgKmNsaWVudCk7CiBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2RwbXMoc3RydWN0IGRybV9jbGll
bnRfZGV2ICpjbGllbnQsIGludCBtb2RlKTsKK2ludCBkcm1fY2xpZW50X21vZGVzZXRfcGFuX2Rp
c3BsYXkoc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQsCisJCQkJICAgdW5zaWduZWQgaW50
IHgsIHVuc2lnbmVkIGludCB5LAorCQkJCSAgIHVuc2lnbmVkIGludCBkZWZhdWx0X3gsCisJCQkJ
ICAgdW5zaWduZWQgaW50IGRlZmF1bHRfeSk7CiAKIC8qKgogICogZHJtX2NsaWVudF9mb3JfZWFj
aF9tb2Rlc2V0KCkgLSBJdGVyYXRlIG92ZXIgY2xpZW50IG1vZGVzZXRzCi0tIAoyLjIxLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
