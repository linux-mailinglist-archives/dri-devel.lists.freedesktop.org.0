Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 854C5E1FDB
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:46:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 65C846EB2E;
	Wed, 23 Oct 2019 15:46:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 195F58959D
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:32 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 4E57E28F96E;
 Wed, 23 Oct 2019 16:45:30 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 15/21] drm/imx: pd: Use bus format/flags provided by the
 bridge when available
Date: Wed, 23 Oct 2019 17:45:06 +0200
Message-Id: <20191023154512.9762-16-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Tm93IHRoYXQgYnJpZGdlcyBjYW4gZXhwb3NlIHRoZSBidXMgZm9ybWF0L2ZsYWdzIHRoZXkgZXhw
ZWN0LCB3ZSBjYW4KdXNlIHRob3NlIGluc3RlYWQgb2YgdGhlIHJlbHlpbmcgb24gdGhlIGRpc3Bs
YXlfaW5mbyBwcm92aWRlZCBieSB0aGUKY29ubmVjdG9yICh3aGljaCBpcyBvbmx5IHZhbGlkIGlm
IHRoZSBlbmNvZGVyIGlzIGRpcmVjdGx5IGNvbm5lY3RlZAp0byBicmlkZ2UgZWxlbWVudCBkcml2
aW5nIHRoZSBwYW5lbC9kaXNwbGF5KS4KCldlIGFsc28gZXhwbGljaXRseSBleHBvc2UgdGhlIGJ1
cyBmb3JtYXRzIHN1cHBvcnRlZCBieSBvdXIgZW5jb2RlciBieQpmaWxsaW5nIGVuY29kZXItPm91
dHB1dF9idXNfY2FwcyB3aXRoIHByb3BlciBpbmZvLgoKU2lnbmVkLW9mZi1ieTogQm9yaXMgQnJl
emlsbG9uIDxib3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4KLS0tCkhpIFBoaWxpcHAsCgpJ
IHRoaW5rIEkgYWRkcmVzc2VkIGFsbCB5b3VyIGNvbW1lbnRzIGV4Y2VwdCB0aGUgYWRkaXRpb24g
b2YKU1lOQ19EUklWRV9QT1NFREdFL05FR0VER0UgZmxhZ3MsIHdoaWNoIHdvdWxkIHJlcXVpcmUg
Y2hhbmdpbmcKaXB1X2NydGNfbW9kZV9zZXRfbm9mYigpIHRvIHRha2UgdGhvc2UgZmxhZ3MgaW50
byBhY2NvdW50IG9yCnR1cm5pbmcgdGhvc2UgZmxhZ3MgaW50byB0aGVpciBQSVhEQVRBIGNvdW50
ZXJwYXJ0LiBJZiB5b3UgZG9uJ3QgbWluZCwKSSdkIGxpa2UgdG8gbGVhdmUgdGhhdCBmb3IgbGF0
ZXIuCgpSZWdhcmRzLAoKQm9yaXMKCkNoYW5nZXMgaW4gdjMgKGFsbCBzdWdnZXN0ZWQgYnkgUGhp
bGlwcCk6CiogQWRqdXN0IHRvIG1hdGNoIGNvcmUgY2hhbmdlcwoqIFByb3BhZ2F0ZSBvdXRwdXQg
Zm9ybWF0IHRvIGlucHV0IGZvcm1hdAoqIFBpY2sgYSBkZWZhdWx0IHZhbHVlIHdoZW4gb3V0cHV0
X2ZtdCA9IF9GSVhFRAoqIEFkZCBtaXNzaW5nIEJHUjg4OCBhbmQgR0JSODg4IGZtdHMgdG8gaW14
X3BkX2J1c19mbXRzW10KCkNoYW5nZXMgaW4gdjI6CiogQWRqdXN0IHRoaW5ncyB0byBtYXRjaCB0
aGUgbmV3IGJ1cy1mb3JtYXQgbmVnb3RpYXRpb24gaW5mcmEKLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aW14L3BhcmFsbGVsLWRpc3BsYXkuYyB8IDE3NCArKysrKysrKysrKysrKysrKysrKystLS0tCiAx
IGZpbGUgY2hhbmdlZCwgMTUwIGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvcGFyYWxsZWwtZGlzcGxheS5jIGIvZHJpdmVycy9n
cHUvZHJtL2lteC9wYXJhbGxlbC1kaXNwbGF5LmMKaW5kZXggMzU1MThlNWRlMzU2Li4yOGFlMDgz
ZGYzY2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvcGFyYWxsZWwtZGlzcGxheS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvcGFyYWxsZWwtZGlzcGxheS5jCkBAIC0yNCw2ICsy
NCw3IEBACiBzdHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkgewogCXN0cnVjdCBkcm1fY29ubmVj
dG9yIGNvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgZW5jb2RlcjsKKwlzdHJ1Y3QgZHJt
X2JyaWRnZSBicmlkZ2U7CiAJc3RydWN0IGRldmljZSAqZGV2OwogCXZvaWQgKmVkaWQ7CiAJaW50
IGVkaWRfbGVuOwpAQCAtMzEsNyArMzIsNyBAQCBzdHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkg
ewogCXUzMiBidXNfZmxhZ3M7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgbW9kZTsKIAlzdHJ1
Y3QgZHJtX3BhbmVsICpwYW5lbDsKLQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOworCXN0cnVj
dCBkcm1fYnJpZGdlICpuZXh0X2JyaWRnZTsKIH07CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGlt
eF9wYXJhbGxlbF9kaXNwbGF5ICpjb25fdG9faW14cGQoc3RydWN0IGRybV9jb25uZWN0b3IgKmMp
CkBAIC00NCw2ICs0NSwxMSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbXhfcGFyYWxsZWxfZGlz
cGxheSAqZW5jX3RvX2lteHBkKHN0cnVjdCBkcm1fZW5jb2RlciAqZSkKIAlyZXR1cm4gY29udGFp
bmVyX29mKGUsIHN0cnVjdCBpbXhfcGFyYWxsZWxfZGlzcGxheSwgZW5jb2Rlcik7CiB9CiAKK3N0
YXRpYyBpbmxpbmUgc3RydWN0IGlteF9wYXJhbGxlbF9kaXNwbGF5ICpicmlkZ2VfdG9faW14cGQo
c3RydWN0IGRybV9icmlkZ2UgKmIpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihiLCBzdHJ1Y3Qg
aW14X3BhcmFsbGVsX2Rpc3BsYXksIGJyaWRnZSk7Cit9CisKIHN0YXRpYyBpbnQgaW14X3BkX2Nv
bm5lY3Rvcl9nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlz
dHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkgKmlteHBkID0gY29uX3RvX2lteHBkKGNvbm5lY3Rv
cik7CkBAIC04OSwzNyArOTUsMTUxIEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2VuY29kZXIgKmlteF9w
ZF9jb25uZWN0b3JfYmVzdF9lbmNvZGVyKAogCXJldHVybiAmaW14cGQtPmVuY29kZXI7CiB9CiAK
LXN0YXRpYyB2b2lkIGlteF9wZF9lbmNvZGVyX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIpCitzdGF0aWMgdm9pZCBpbXhfcGRfYnJpZGdlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRn
ZSAqYnJpZGdlKQogewotCXN0cnVjdCBpbXhfcGFyYWxsZWxfZGlzcGxheSAqaW14cGQgPSBlbmNf
dG9faW14cGQoZW5jb2Rlcik7CisJc3RydWN0IGlteF9wYXJhbGxlbF9kaXNwbGF5ICppbXhwZCA9
IGJyaWRnZV90b19pbXhwZChicmlkZ2UpOwogCiAJZHJtX3BhbmVsX3ByZXBhcmUoaW14cGQtPnBh
bmVsKTsKIAlkcm1fcGFuZWxfZW5hYmxlKGlteHBkLT5wYW5lbCk7CiB9CiAKLXN0YXRpYyB2b2lk
IGlteF9wZF9lbmNvZGVyX2Rpc2FibGUoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQorc3Rh
dGljIHZvaWQgaW14X3BkX2JyaWRnZV9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
CiB7Ci0Jc3RydWN0IGlteF9wYXJhbGxlbF9kaXNwbGF5ICppbXhwZCA9IGVuY190b19pbXhwZChl
bmNvZGVyKTsKKwlzdHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkgKmlteHBkID0gYnJpZGdlX3Rv
X2lteHBkKGJyaWRnZSk7CiAKIAlkcm1fcGFuZWxfZGlzYWJsZShpbXhwZC0+cGFuZWwpOwogCWRy
bV9wYW5lbF91bnByZXBhcmUoaW14cGQtPnBhbmVsKTsKIH0KIAotc3RhdGljIGludCBpbXhfcGRf
ZW5jb2Rlcl9hdG9taWNfY2hlY2soc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyLAotCQkJCSAg
ICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJICAgICAgIHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQorc3RhdGljIGNvbnN0IHUzMiBpbXhf
cGRfYnVzX2ZtdHNbXSA9IHsKKwlNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDI0LAorCU1FRElBX0JV
U19GTVRfQkdSODg4XzFYMjQsCisJTUVESUFfQlVTX0ZNVF9HQlI4ODhfMVgyNCwKKwlNRURJQV9C
VVNfRk1UX1JHQjY2Nl8xWDE4LAorCU1FRElBX0JVU19GTVRfUkdCNjY2XzFYMjRfQ1BBREhJLAor
CU1FRElBX0JVU19GTVRfUkdCNTY1XzFYMTYsCit9OworCitzdGF0aWMgdTMyICoKK2lteF9wZF9i
cmlkZ2VfYXRvbWljX2dldF9vdXRwdXRfYnVzX2ZtdHMoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKKwkJCQkJIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGUsCisJCQkJCSBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCSBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwKKwkJCQkJIHVuc2lnbmVkIGludCAqbnVtX291dHB1dF9m
bXRzKQoreworCXN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICpkaSA9ICZjb25uX3N0YXRlLT5jb25u
ZWN0b3ItPmRpc3BsYXlfaW5mbzsKKwlzdHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkgKmlteHBk
ID0gYnJpZGdlX3RvX2lteHBkKGJyaWRnZSk7CisJdTMyICpvdXRwdXRfZm10czsKKworCWlmICgh
aW14cGQtPmJ1c19mb3JtYXQgJiYgIWRpLT5udW1fYnVzX2Zvcm1hdHMpCisJCSpudW1fb3V0cHV0
X2ZtdHMgPSBBUlJBWV9TSVpFKGlteF9wZF9idXNfZm10cyk7CisJZWxzZQorCQkqbnVtX291dHB1
dF9mbXRzID0gMTsKKworCW91dHB1dF9mbXRzID0ga2NhbGxvYygqbnVtX291dHB1dF9mbXRzLCBz
aXplb2YoKm91dHB1dF9mbXRzKSwKKwkJCSAgICAgIEdGUF9LRVJORUwpOworCWlmICghb3V0cHV0
X2ZtdHMpCisJCXJldHVybiBOVUxMOworCisJaWYgKCFpbXhwZC0+YnVzX2Zvcm1hdCAmJiBkaS0+
bnVtX2J1c19mb3JtYXRzKQorCQlvdXRwdXRfZm10c1swXSA9IGRpLT5idXNfZm9ybWF0c1swXTsK
KwllbHNlIGlmICghaW14cGQtPmJ1c19mb3JtYXQpCisJCW1lbWNweShvdXRwdXRfZm10cywgaW14
X3BkX2J1c19mbXRzLAorCQkgICAgICAgQVJSQVlfU0laRShpbXhfcGRfYnVzX2ZtdHMpKTsKKwll
bHNlCisJCW91dHB1dF9mbXRzWzBdID0gaW14cGQtPmJ1c19mb3JtYXQ7CisKKwlyZXR1cm4gb3V0
cHV0X2ZtdHM7Cit9CisKK3N0YXRpYyB1MzIgKgoraW14X3BkX2JyaWRnZV9hdG9taWNfZ2V0X2lu
cHV0X2J1c19mbXRzKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJCXN0cnVjdCBkcm1f
YnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGUsCisJCQkJCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKKwkJCQkJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUs
CisJCQkJCXUzMiBvdXRwdXRfZm10LAorCQkJCQl1bnNpZ25lZCBpbnQgKm51bV9pbnB1dF9mbXRz
KQoreworCXN0cnVjdCBpbXhfcGFyYWxsZWxfZGlzcGxheSAqaW14cGQgPSBicmlkZ2VfdG9faW14
cGQoYnJpZGdlKTsKKwl1MzIgKmlucHV0X2ZtdHM7CisKKwkqbnVtX2lucHV0X2ZtdHMgPSAwOwor
CWlmIChvdXRwdXRfZm10ID09IE1FRElBX0JVU19GTVRfRklYRUQpIHsKKwkJLyoKKwkJICogVGhl
IG5leHQgYnJpZGdlIGRvZXMgbm90IHN1cHBvcnQgYnVzIGZvcm1hdCBuZWdvdGlhdGlvbiwKKwkJ
ICogbGV0J3MgdXNlIHRoZSBkZWZhdWx0IFJHQjg4OCB2YWx1ZS4KKwkJICovCisJCSpudW1faW5w
dXRfZm10cyA9IDE7CisJCW91dHB1dF9mbXQgPSBNRURJQV9CVVNfRk1UX1JHQjg4OF8xWDI0Owor
CX0gZWxzZSBpZiAoIWlteHBkLT5idXNfZm9ybWF0KSB7CisJCXVuc2lnbmVkIGludCBpOworCisJ
CWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGlteF9wZF9idXNfZm10cyk7IGkrKykgeworCQkJ
aWYgKGlteF9wZF9idXNfZm10c1tpXSA9PSBvdXRwdXRfZm10KSB7CisJCQkJKm51bV9pbnB1dF9m
bXRzID0gMTsKKwkJCQlicmVhazsKKwkJCX0KKwkJfQorCX0gZWxzZSBpZiAoaW14cGQtPmJ1c19m
b3JtYXQgPT0gb3V0cHV0X2ZtdCkgeworCQkqbnVtX2lucHV0X2ZtdHMgPSAxOworCX0KKworCWlm
ICghKm51bV9pbnB1dF9mbXRzKQorCQlyZXR1cm4gTlVMTDsKKworCWlucHV0X2ZtdHMgPSBrY2Fs
bG9jKCpudW1faW5wdXRfZm10cywgc2l6ZW9mKCppbnB1dF9mbXRzKSwKKwkJCSAgICAgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFpbnB1dF9mbXRzKQorCQlyZXR1cm4gTlVMTDsKKworCWlucHV0X2ZtdHNb
MF0gPSBvdXRwdXRfZm10OworCXJldHVybiBpbnB1dF9mbXRzOworfQorCitzdGF0aWMgaW50IGlt
eF9wZF9icmlkZ2VfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJ
ICAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKmJyaWRnZV9zdGF0ZSwKKwkJCQkgICAgICBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICAgICAgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGlteF9jcnRjX3N0YXRlICpp
bXhfY3J0Y19zdGF0ZSA9IHRvX2lteF9jcnRjX3N0YXRlKGNydGNfc3RhdGUpOwogCXN0cnVjdCBk
cm1fZGlzcGxheV9pbmZvICpkaSA9ICZjb25uX3N0YXRlLT5jb25uZWN0b3ItPmRpc3BsYXlfaW5m
bzsKLQlzdHJ1Y3QgaW14X3BhcmFsbGVsX2Rpc3BsYXkgKmlteHBkID0gZW5jX3RvX2lteHBkKGVu
Y29kZXIpOworCXN0cnVjdCBpbXhfcGFyYWxsZWxfZGlzcGxheSAqaW14cGQgPSBicmlkZ2VfdG9f
aW14cGQoYnJpZGdlKTsKKwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqbmV4dF9icmlkZ2Vfc3Rh
dGUgPSBOVUxMOworCXN0cnVjdCBkcm1fYnJpZGdlICpuZXh0X2JyaWRnZTsKKwl1MzIgYnVzX2Zs
YWdzLCBidXNfZm10OworCXVuc2lnbmVkIGludCBpOwogCi0JaWYgKCFpbXhwZC0+YnVzX2Zvcm1h
dCAmJiBkaS0+bnVtX2J1c19mb3JtYXRzKSB7Ci0JCWlteF9jcnRjX3N0YXRlLT5idXNfZmxhZ3Mg
PSBkaS0+YnVzX2ZsYWdzOwotCQlpbXhfY3J0Y19zdGF0ZS0+YnVzX2Zvcm1hdCA9IGRpLT5idXNf
Zm9ybWF0c1swXTsKLQl9IGVsc2UgewotCQlpbXhfY3J0Y19zdGF0ZS0+YnVzX2ZsYWdzID0gaW14
cGQtPmJ1c19mbGFnczsKLQkJaW14X2NydGNfc3RhdGUtPmJ1c19mb3JtYXQgPSBpbXhwZC0+YnVz
X2Zvcm1hdDsKKwluZXh0X2JyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X25leHRfYnJpZGdl
KGJyaWRnZSk7CisJaWYgKG5leHRfYnJpZGdlKQorCQluZXh0X2JyaWRnZV9zdGF0ZSA9IGRybV9h
dG9taWNfZ2V0X25ld19icmlkZ2Vfc3RhdGUoY3J0Y19zdGF0ZS0+c3RhdGUsCisJCQkJCQkJCSAg
ICBuZXh0X2JyaWRnZSk7CisKKwlpZiAobmV4dF9icmlkZ2Vfc3RhdGUpCisJCWJ1c19mbGFncyA9
IG5leHRfYnJpZGdlX3N0YXRlLT5pbnB1dF9idXNfY2ZnLmZsYWdzOworCWVsc2UgaWYgKCFpbXhw
ZC0+YnVzX2Zvcm1hdCAmJiBkaS0+bnVtX2J1c19mb3JtYXRzKQorCQlidXNfZmxhZ3MgPSBkaS0+
YnVzX2ZsYWdzOworCWVsc2UKKwkJYnVzX2ZsYWdzID0gaW14cGQtPmJ1c19mbGFnczsKKworCWJ1
c19mbXQgPSBicmlkZ2Vfc3RhdGUtPmlucHV0X2J1c19jZmcuZm10OworCWZvciAoaSA9IDA7IGkg
PCBBUlJBWV9TSVpFKGlteF9wZF9idXNfZm10cyk7IGkrKykgeworCQlpZiAoaW14X3BkX2J1c19m
bXRzW2ldID09IGJ1c19mbXQpCisJCQlicmVhazsKIAl9CisKKwlpZiAoaSA9PSBBUlJBWV9TSVpF
KGlteF9wZF9idXNfZm10cykpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGJ1c19mbGFncyAm
CisJICAgIH4oRFJNX0JVU19GTEFHX0RFX0xPVyB8IERSTV9CVVNfRkxBR19ERV9ISUdIIHwKKwkg
ICAgICBEUk1fQlVTX0ZMQUdfUElYREFUQV9EUklWRV9QT1NFREdFIHwKKwkgICAgICBEUk1fQlVT
X0ZMQUdfUElYREFUQV9EUklWRV9ORUdFREdFKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlicmlk
Z2Vfc3RhdGUtPm91dHB1dF9idXNfY2ZnLmZsYWdzID0gYnVzX2ZsYWdzOworCWJyaWRnZV9zdGF0
ZS0+aW5wdXRfYnVzX2NmZy5mbGFncyA9IGJ1c19mbGFnczsKKwlpbXhfY3J0Y19zdGF0ZS0+YnVz
X2ZsYWdzID0gYnVzX2ZsYWdzOworCWlteF9jcnRjX3N0YXRlLT5idXNfZm9ybWF0ID0gYnJpZGdl
X3N0YXRlLT5pbnB1dF9idXNfY2ZnLmZtdDsKIAlpbXhfY3J0Y19zdGF0ZS0+ZGlfaHN5bmNfcGlu
ID0gMjsKIAlpbXhfY3J0Y19zdGF0ZS0+ZGlfdnN5bmNfcGluID0gMzsKIApAQCAtMTQzLDEwICsy
NjMsMTIgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9mdW5jcyBpbXhfcGRfZW5j
b2Rlcl9mdW5jcyA9IHsKIAkuZGVzdHJveSA9IGlteF9kcm1fZW5jb2Rlcl9kZXN0cm95LAogfTsK
IAotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MgaW14X3BkX2Vu
Y29kZXJfaGVscGVyX2Z1bmNzID0gewotCS5lbmFibGUgPSBpbXhfcGRfZW5jb2Rlcl9lbmFibGUs
Ci0JLmRpc2FibGUgPSBpbXhfcGRfZW5jb2Rlcl9kaXNhYmxlLAotCS5hdG9taWNfY2hlY2sgPSBp
bXhfcGRfZW5jb2Rlcl9hdG9taWNfY2hlY2ssCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9icmlk
Z2VfZnVuY3MgaW14X3BkX2JyaWRnZV9mdW5jcyA9IHsKKwkuZW5hYmxlID0gaW14X3BkX2JyaWRn
ZV9lbmFibGUsCisJLmRpc2FibGUgPSBpbXhfcGRfYnJpZGdlX2Rpc2FibGUsCisJLmF0b21pY19j
aGVjayA9IGlteF9wZF9icmlkZ2VfYXRvbWljX2NoZWNrLAorCS5hdG9taWNfZ2V0X2lucHV0X2J1
c19mbXRzID0gaW14X3BkX2JyaWRnZV9hdG9taWNfZ2V0X2lucHV0X2J1c19mbXRzLAorCS5hdG9t
aWNfZ2V0X291dHB1dF9idXNfZm10cyA9IGlteF9wZF9icmlkZ2VfYXRvbWljX2dldF9vdXRwdXRf
YnVzX2ZtdHMsCiB9OwogCiBzdGF0aWMgaW50IGlteF9wZF9yZWdpc3RlcihzdHJ1Y3QgZHJtX2Rl
dmljZSAqZHJtLApAQCAtMTY2LDExICsyODgsMTMgQEAgc3RhdGljIGludCBpbXhfcGRfcmVnaXN0
ZXIoc3RydWN0IGRybV9kZXZpY2UgKmRybSwKIAkgKi8KIAlpbXhwZC0+Y29ubmVjdG9yLmRwbXMg
PSBEUk1fTU9ERV9EUE1TX09GRjsKIAotCWRybV9lbmNvZGVyX2hlbHBlcl9hZGQoZW5jb2Rlciwg
JmlteF9wZF9lbmNvZGVyX2hlbHBlcl9mdW5jcyk7CiAJZHJtX2VuY29kZXJfaW5pdChkcm0sIGVu
Y29kZXIsICZpbXhfcGRfZW5jb2Rlcl9mdW5jcywKIAkJCSBEUk1fTU9ERV9FTkNPREVSX05PTkUs
IE5VTEwpOwogCi0JaWYgKCFpbXhwZC0+YnJpZGdlKSB7CisJaW14cGQtPmJyaWRnZS5mdW5jcyA9
ICZpbXhfcGRfYnJpZGdlX2Z1bmNzOworCWRybV9icmlkZ2VfYXR0YWNoKGVuY29kZXIsICZpbXhw
ZC0+YnJpZGdlLCBOVUxMKTsKKworCWlmICghaW14cGQtPm5leHRfYnJpZGdlKSB7CiAJCWRybV9j
b25uZWN0b3JfaGVscGVyX2FkZCgmaW14cGQtPmNvbm5lY3RvciwKIAkJCQkmaW14X3BkX2Nvbm5l
Y3Rvcl9oZWxwZXJfZnVuY3MpOwogCQlkcm1fY29ubmVjdG9yX2luaXQoZHJtLCAmaW14cGQtPmNv
bm5lY3RvciwKQEAgLTE4MSw4ICszMDUsOSBAQCBzdGF0aWMgaW50IGlteF9wZF9yZWdpc3Rlcihz
dHJ1Y3QgZHJtX2RldmljZSAqZHJtLAogCWlmIChpbXhwZC0+cGFuZWwpCiAJCWRybV9wYW5lbF9h
dHRhY2goaW14cGQtPnBhbmVsLCAmaW14cGQtPmNvbm5lY3Rvcik7CiAKLQlpZiAoaW14cGQtPmJy
aWRnZSkgewotCQlyZXQgPSBkcm1fYnJpZGdlX2F0dGFjaChlbmNvZGVyLCBpbXhwZC0+YnJpZGdl
LCBOVUxMKTsKKwlpZiAoaW14cGQtPm5leHRfYnJpZGdlKSB7CisJCXJldCA9IGRybV9icmlkZ2Vf
YXR0YWNoKGVuY29kZXIsIGlteHBkLT5uZXh0X2JyaWRnZSwKKwkJCQkJJmlteHBkLT5icmlkZ2Up
OwogCQlpZiAocmV0IDwgMCkgewogCQkJZGV2X2VycihpbXhwZC0+ZGV2LCAiZmFpbGVkIHRvIGF0
dGFjaCBicmlkZ2U6ICVkXG4iLAogCQkJCXJldCk7CkBAIC0yMjcsNyArMzUyLDggQEAgc3RhdGlj
IGludCBpbXhfcGRfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2UgKm1hc3Rl
ciwgdm9pZCAqZGF0YSkKIAlpbXhwZC0+YnVzX2Zvcm1hdCA9IGJ1c19mb3JtYXQ7CiAKIAkvKiBw
b3J0QDEgaXMgdGhlIG91dHB1dCBwb3J0ICovCi0JcmV0ID0gZHJtX29mX2ZpbmRfcGFuZWxfb3Jf
YnJpZGdlKG5wLCAxLCAwLCAmaW14cGQtPnBhbmVsLCAmaW14cGQtPmJyaWRnZSk7CisJcmV0ID0g
ZHJtX29mX2ZpbmRfcGFuZWxfb3JfYnJpZGdlKG5wLCAxLCAwLCAmaW14cGQtPnBhbmVsLAorCQkJ
CQkgICZpbXhwZC0+bmV4dF9icmlkZ2UpOwogCWlmIChyZXQgJiYgcmV0ICE9IC1FTk9ERVYpCiAJ
CXJldHVybiByZXQ7CiAKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
