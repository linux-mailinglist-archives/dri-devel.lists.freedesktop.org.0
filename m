Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B324061B18
	for <lists+dri-devel@lfdr.de>; Mon,  8 Jul 2019 09:13:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 80E7989B84;
	Mon,  8 Jul 2019 07:12:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay6-d.mail.gandi.net (relay6-d.mail.gandi.net
 [217.70.183.198])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CD4916E56E
 for <dri-devel@lists.freedesktop.org>; Sat,  6 Jul 2019 14:07:17 +0000 (UTC)
X-Originating-IP: 2.224.242.101
Received: from uno.localdomain (2-224-242-101.ip172.fastwebnet.it
 [2.224.242.101]) (Authenticated sender: jacopo@jmondi.org)
 by relay6-d.mail.gandi.net (Postfix) with ESMTPSA id 463EAC000A;
 Sat,  6 Jul 2019 14:07:14 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 airlied@linux.ie, daniel@ffwll.ch
Subject: [PATCH v2 14/19] drm: rcar-du: Add support for CMM
Date: Sat,  6 Jul 2019 16:07:41 +0200
Message-Id: <20190706140746.29132-15-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190706140746.29132-1-jacopo+renesas@jmondi.org>
References: <20190706140746.29132-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 08 Jul 2019 07:11:53 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: muroya@ksk.co.jp, koji.matsuoka.xm@renesas.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-renesas-soc@vger.kernel.org, VenkataRajesh.Kalakodima@in.bosch.com,
 Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Harsha.ManjulaMallikarjun@in.bosch.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGEgZHJpdmVyIGZvciB0aGUgUi1DYXIgRGlzcGxheSBVbml0IENvbG9yIENvcnJlY3Rpb24g
TW9kdWxlLgoKSW4gbW9zdCBvZiBHZW4zIFNvQ3MsIGVhY2ggRFUgb3V0cHV0IGNoYW5uZWwgaXMg
cHJvdmlkZWQgd2l0aCBhIENNTSB1bml0CnRvIHBlcmZvcm0gaW1hZ2UgZW5oYW5jZW1lbnQgYW5k
IGNvbG9yIGNvcnJlY3Rpb24uCgpBZGQgc3VwcG9ydCBmb3IgQ01NIHRocm91Z2ggYSBkcml2ZXIg
dGhhdCBzdXBwb3J0cyBjb25maWd1cmF0aW9uIG9mCnRoZSAxLWRpbWVuc2lvbmFsIExVVCB0YWJs
ZS4gTW9yZSBhZHZhbmNlZCBDTU0gZmVhdHVyZSB3aWxsIGJlCmltcGxlbWVudGVkIG9uIHRvcCBv
ZiB0aGlzIGJhc2ljIG9uZS4KClNpZ25lZC1vZmYtYnk6IEphY29wbyBNb25kaSA8amFjb3BvK3Jl
bmVzYXNAam1vbmRpLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9LY29uZmlnICAg
IHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlICAgfCAgIDEgKwogZHJp
dmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYyB8IDI5MiArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaCB8ICAzOCArKysr
CiA0IGZpbGVzIGNoYW5nZWQsIDMzOCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRy
aXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfY21tLmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vcmNhci1kdS9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvS2NvbmZpZwpp
bmRleCAxNTI5ODQ5ZTIxN2UuLjUzOWQyMzI3OTBkMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3JjYXItZHUvS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9LY29uZmln
CkBAIC0xMyw2ICsxMywxMyBAQCBjb25maWcgRFJNX1JDQVJfRFUKIAkgIENob29zZSB0aGlzIG9w
dGlvbiBpZiB5b3UgaGF2ZSBhbiBSLUNhciBjaGlwc2V0LgogCSAgSWYgTSBpcyBzZWxlY3RlZCB0
aGUgbW9kdWxlIHdpbGwgYmUgY2FsbGVkIHJjYXItZHUtZHJtLgogCitjb25maWcgRFJNX1JDQVJf
Q01NCisJYm9vbCAiUi1DYXIgRFUgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUgKENNTSkgU3VwcG9y
dCIKKwlkZXBlbmRzIG9uIERSTSAmJiBPRgorCWRlcGVuZHMgb24gRFJNX1JDQVJfRFUKKwloZWxw
CisJICBFbmFibGUgc3VwcG9ydCBmb3IgUi1DYXIgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUgKENN
TSkuCisKIGNvbmZpZyBEUk1fUkNBUl9EV19IRE1JCiAJdHJpc3RhdGUgIlItQ2FyIERVIEdlbjMg
SERNSSBFbmNvZGVyIFN1cHBvcnQiCiAJZGVwZW5kcyBvbiBEUk0gJiYgT0YKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL3JjYXIt
ZHUvTWFrZWZpbGUKaW5kZXggNmMyZWQ5YzQ2NDY3Li40ZDExODdjY2MzZTUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9y
Y2FyLWR1L01ha2VmaWxlCkBAIC0xNSw2ICsxNSw3IEBAIHJjYXItZHUtZHJtLSQoQ09ORklHX0RS
TV9SQ0FSX0xWRFMpCSs9IHJjYXJfZHVfb2YubyBcCiByY2FyLWR1LWRybS0kKENPTkZJR19EUk1f
UkNBUl9WU1ApCSs9IHJjYXJfZHVfdnNwLm8KIHJjYXItZHUtZHJtLSQoQ09ORklHX0RSTV9SQ0FS
X1dSSVRFQkFDSykgKz0gcmNhcl9kdV93cml0ZWJhY2subwogCitvYmotJChDT05GSUdfRFJNX1JD
QVJfQ01NKQkJKz0gcmNhcl9jbW0ubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0RVKQkJKz0gcmNh
ci1kdS1kcm0ubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0RXX0hETUkpCQkrPSByY2FyX2R3X2hk
bWkubwogb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0xWRFMpCQkrPSByY2FyX2x2ZHMubwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9yY2FyLWR1L3JjYXJfY21tLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi43NmVkM2ZjZTJiMzMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNh
ci1kdS9yY2FyX2NtbS5jCkBAIC0wLDAgKzEsMjkyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMCsKKy8qCisgKiByY2FyX2NtbS5jIC0tIFItQ2FyIERpc3BsYXkgVW5pdCBD
b2xvciBNYW5hZ2VtZW50IE1vZHVsZQorICoKKyAqIENvcHlyaWdodCAoQykgMjAxOSBKYWNvcG8g
TW9uZGkgPGphY29wbytyZW5lc2FzQGptb25kaS5vcmc+CisgKi8KKworI2luY2x1ZGUgPGxpbnV4
L2Nsay5oPgorI2luY2x1ZGUgPGxpbnV4L2lvLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+
CisjaW5jbHVkZSA8bGludXgvb2YuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9wbS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4K
KworI2luY2x1ZGUgInJjYXJfY21tLmgiCisKKyNkZWZpbmUgQ00yX0xVVF9DVFJMCQkweDAwMDAK
KyNkZWZpbmUgQ00yX0xVVF9DVFJMX0VOCQlCSVQoMCkKKyNkZWZpbmUgQ00yX0xVVF9UQkxBX0JB
U0UJMHgwNjAwCisjZGVmaW5lIENNMl9MVVRfVEJMQShfX2kpCShDTTJfTFVUX1RCTEFfQkFTRSAr
IChfX2kpICogNCkKKworc3RydWN0IHJjYXJfY21tIHsKKwlzdHJ1Y3QgY2xrICpjbGs7CisJdm9p
ZCBfX2lvbWVtICpiYXNlOworCWJvb2wgZW5hYmxlZDsKKworCS8qCisJICogcmVzdG9yZTogTFVU
IHJlc3RvcmUgZmxhZworCSAqIHJ1bm5pbmc6IExVVCBvcGVyYXRpbmcgZmxhZworCSAqIHNpemU6
IE51bWJlciBvZiBwcm9ncmFtbWVkIGVudHJpZXMgaW4gdGhlIExVVCB0YWJsZQorCSAqIHRhYmxl
OiBTY3JhdGNoIGJ1ZmZlciB3aGVyZSB0byBzdG9yZSB0aGUgTFVUIHRhYmxlIGVudHJpZXMgdG8g
YmUKKwkgKgkgIGxhdGVyIHJlc3RvcmVkLgorCSAqLworCXN0cnVjdCB7CisJCWJvb2wgcmVzdG9y
ZTsKKwkJYm9vbCBydW5uaW5nOworCQl1bnNpZ25lZCBpbnQgc2l6ZTsKKwkJc3RydWN0IGRybV9j
b2xvcl9sdXQgdGFibGVbQ01NX0dBTU1BX0xVVF9TSVpFXTsKKwl9IGx1dDsKK307CisKK3N0YXRp
YyBpbmxpbmUgaW50IHJjYXJfY21tX3JlYWQoc3RydWN0IHJjYXJfY21tICpyY21tLCB1MzIgcmVn
KQoreworCXJldHVybiBpb3JlYWQzMihyY21tLT5iYXNlICsgcmVnKTsKK30KKworc3RhdGljIGlu
bGluZSB2b2lkIHJjYXJfY21tX3dyaXRlKHN0cnVjdCByY2FyX2NtbSAqcmNtbSwgdTMyIHJlZywg
dTMyIGRhdGEpCit7CisJaW93cml0ZTMyKGRhdGEsIHJjbW0tPmJhc2UgKyByZWcpOworfQorCitz
dGF0aWMgdm9pZCByY2FyX2NtbV9sdXRfd3JpdGUoc3RydWN0IHJjYXJfY21tICpyY21tLCB1bnNp
Z25lZCBpbnQgc2l6ZSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0KQorewor
CXVuc2lnbmVkIGludCBpOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7ICsraSkgeworCQlzdHJ1
Y3QgZHJtX2NvbG9yX2x1dCAqZW50cnkgPSAmbHV0W2ldOworCisJCXUzMiB2YWwgPSAoZW50cnkt
PnJlZCAmIDB4ZmYpIDw8IDE2IHwKKwkJCSAgKGVudHJ5LT5ncmVlbiAmIDB4ZmYpIDw8IDggfAor
CQkJICAoZW50cnktPmJsdWUgJiAweGZmKTsKKwkJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00yX0xV
VF9UQkxBKGkpLCB2YWwpOworCX0KK30KKworLyoqCisgKiByY2FyX2NtbV9zZXR1cCgpIC0gY29u
ZmlndXJlIHRoZSBDTU0gdW5pdAorICoKKyAqIEBwZGV2OiBUaGUgcGxhdGZvcm0gZGV2aWNlIGFz
c29jaWF0ZWQgd2l0aCB0aGUgQ01NIGluc3RhbmNlCisgKiBAY29uZmlnOiBUaGUgQ1JUQyBwcm92
aWRlZCBjb25maWd1cmF0aW9uLgorICoKKyAqIENvbmZpZ3VyZSB0aGUgQ01NIHVuaXQgd2l0aCB0
aGUgQ1JUQyBwcm92aWRlZCBjb25maWd1cmF0aW9uLgorICogQ3VycmVudGx5IGVuYWJsaW5nLCBk
aXNhYmxpbmcgYW5kIHByb2dyYW1taW5nIG9mIHRoZSAxLUQgTFVUIHVuaXQgaXMKKyAqIHN1cHBv
cnRlZC4KKyAqLworaW50IHJjYXJfY21tX3NldHVwKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBk
ZXYsCisJCSAgIGNvbnN0IHN0cnVjdCByY2FyX2NtbV9jb25maWcgKmNvbmZpZykKK3sKKwlzdHJ1
Y3QgcmNhcl9jbW0gKnJjbW0gPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsKKwl1bnNpZ25l
ZCBpbnQgaTsKKworCWlmIChjb25maWctPmx1dC5zaXplID4gQ01NX0dBTU1BX0xVVF9TSVpFKQor
CQlyZXR1cm4gLUVJTlZBTDsKKworCS8qCisJICogQXMgY21tX3NldHVwIGlzIGNhbGxlZCBieSBh
dG9taWMgY29tbWl0IHRhaWwgaGVscGVyLCBpdCBtaWdodCBiZQorCSAqIGNhbGxlZCBiZWZvcmUg
ZW5hYmxpbmcgdGhlIENSVEMgKHdoaWNoIGNhbGxzIGNtbV9lbmFibGUoKSkuCisJICovCisJaWYg
KCFyY21tLT5lbmFibGVkKSB7CisJCWlmICghY29uZmlnLT5sdXQuZW5hYmxlKQorCQkJcmV0dXJu
IDA7CisKKwkJLyoKKwkJICogU3RvcmUgdGhlIExVVCB0YWJsZSBlbnRyaWVzIGluIHRoZSBzY3Jh
dGNoIGJ1ZmZlciB0byBiZSBsYXRlcgorCQkgKiBwcm9ncmFtbWVkIGF0IGVuYWJsZSB0aW1lLgor
CQkgKi8KKwkJZm9yIChpID0gMDsgaSA8IGNvbmZpZy0+bHV0LnNpemU7ICsraSkKKwkJCXJjbW0t
Pmx1dC50YWJsZVtpXSA9IGNvbmZpZy0+bHV0LnRhYmxlW2ldOworCisJCXJjbW0tPmx1dC5zaXpl
ID0gY29uZmlnLT5sdXQuc2l6ZTsKKwkJcmNtbS0+bHV0LnJlc3RvcmUgPSB0cnVlOworCisJCXJl
dHVybiAwOworCX0KKworCS8qIFN0b3AgTFVUIG9wZXJhdGlvbnMsIGlmIHJlcXVlc3RlZC4gKi8K
KwlpZiAocmNtbS0+bHV0LnJ1bm5pbmcgJiYgIWNvbmZpZy0+bHV0LmVuYWJsZSkgeworCQlyY2Fy
X2NtbV93cml0ZShyY21tLCBDTTJfTFVUX0NUUkwsIDApOworCQlyY21tLT5sdXQucnVubmluZyA9
IDA7CisJCXJjbW0tPmx1dC5zaXplID0gMDsKKworCQlyZXR1cm4gMDsKKwl9CisKKwkvKiBFbmFi
bGUgTFVUIGFuZCBwcm9ncmFtIHRoZSBuZXcgZ2FtbWEgdGFibGUgdmFsdWVzLiAqLworCWlmICgh
cmNtbS0+bHV0LnJ1bm5pbmcpIHsKKwkJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00yX0xVVF9DVFJM
LCBDTTJfTFVUX0NUUkxfRU4pOworCQlyY21tLT5sdXQucnVubmluZyA9IHRydWU7CisJfQorCisJ
cmNhcl9jbW1fbHV0X3dyaXRlKHJjbW0sIGNvbmZpZy0+bHV0LnNpemUsIGNvbmZpZy0+bHV0LnRh
YmxlKTsKKwlyY21tLT5sdXQuc2l6ZSA9IGNvbmZpZy0+bHV0LnNpemU7CisKKwlyZXR1cm4gMDsK
K30KK0VYUE9SVF9TWU1CT0xfR1BMKHJjYXJfY21tX3NldHVwKTsKKworLyoqCisgKiByY2FyX2Nt
bV9lbmFibGUgLSBlbmFibGUgdGhlIENNTSB1bml0CisgKgorICogQHBkZXY6IFRoZSBwbGF0Zm9y
bSBkZXZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBDTU0gaW5zdGFuY2UKKyAqCisgKiBFbmFibGUg
dGhlIENNTSB1bml0IGJ5IGVuYWJsaW5nIHRoZSBwYXJlbnQgY2xvY2sgYW5kIGVuYWJsaW5nIHRo
ZSBDTU0KKyAqIGNvbXBvbmVudHMsIHN1Y2ggYXMgMS1EIExVVCwgaWYgcmVxdWVzdGVkLgorICov
CitpbnQgcmNhcl9jbW1fZW5hYmxlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJ
c3RydWN0IHJjYXJfY21tICpyY21tID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEocGRldik7CisJaW50
IHJldDsKKworCWlmICghcmNtbSkKKwkJcmV0dXJuIC1FUFJPQkVfREVGRVI7CisKKwlyZXQgPSBj
bGtfcHJlcGFyZV9lbmFibGUocmNtbS0+Y2xrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJLyogQXBwbHkgdGhlIExVVCB0YWJsZSB2YWx1ZXMgc2F2ZWQgYXQgY21tX3NldHVwIHRpbWUu
ICovCisJaWYgKHJjbW0tPmx1dC5yZXN0b3JlKSB7CisJCXJjYXJfY21tX3dyaXRlKHJjbW0sIENN
Ml9MVVRfQ1RSTCwgQ00yX0xVVF9DVFJMX0VOKTsKKwkJcmNhcl9jbW1fbHV0X3dyaXRlKHJjbW0s
IHJjbW0tPmx1dC5zaXplLCByY21tLT5sdXQudGFibGUpOworCisJCXJjbW0tPmx1dC5yZXN0b3Jl
ID0gZmFsc2U7CisJCXJjbW0tPmx1dC5ydW5uaW5nID0gdHJ1ZTsKKwl9CisKKwlyY21tLT5lbmFi
bGVkID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTF9HUEwocmNhcl9jbW1f
ZW5hYmxlKTsKKworLyoqCisgKiByY2FyX2NtbV9kaXNhYmxlKCkgLSBkaXNhYmxlIHRoZSBDTU0g
dW5pdAorICoKKyAqIERpc2FibGUgdGhlIENNTSB1bml0IGJ5IHN0b3BwaW5nIHRoZSBwYXJlbnQg
Y2xvY2suCisgKgorICogQHBkZXY6IFRoZSBwbGF0Zm9ybSBkZXZpY2UgYXNzb2NpYXRlZCB3aXRo
IHRoZSBDTU0gaW5zdGFuY2UKKyAqLwordm9pZCByY2FyX2NtbV9kaXNhYmxlKHN0cnVjdCBwbGF0
Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IHJjYXJfY21tICpyY21tID0gcGxhdGZvcm1f
Z2V0X2RydmRhdGEocGRldik7CisKKwlyY2FyX2NtbV93cml0ZShyY21tLCBDTTJfTFVUX0NUUkws
IDApOworCisJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKHJjbW0tPmNsayk7CisKKwlyY21tLT5sdXQu
cmVzdG9yZSA9IGZhbHNlOworCXJjbW0tPmx1dC5ydW5uaW5nID0gZmFsc2U7CisJcmNtbS0+bHV0
LnNpemUgPSAwOworCisJcmNtbS0+ZW5hYmxlZCA9IGZhbHNlOworfQorRVhQT1JUX1NZTUJPTF9H
UEwocmNhcl9jbW1fZGlzYWJsZSk7CisKKyNpZmRlZiBDT05GSUdfUE1fU0xFRVAKK3N0YXRpYyBp
bnQgcmNhcl9jbW1fcG1fc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJc3RydWN0IHJj
YXJfY21tICpyY21tID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJdW5zaWduZWQgaW50IGk7CisK
KwlpZiAoIShyY21tLT5sdXQucnVubmluZyB8fCByY21tLT5sdXQucmVzdG9yZSkpCisJCXJldHVy
biAwOworCisJLyogU2F2ZSB0aGUgTFVUIHRhYmxlIGVudHJpZXMgaW4gdGhlIHNjcmF0Y2ggYnVm
ZmVyIHRhYmxlLiAqLworCWZvciAoaSA9IDA7IGkgPCByY21tLT5sdXQuc2l6ZTsgKytpKSB7CisJ
CWludCBlbnRyeSA9IHJjYXJfY21tX3JlYWQocmNtbSwgQ00yX0xVVF9UQkxBKGkpKTsKKwkJc3Ry
dWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9ICZyY21tLT5sdXQudGFibGVbaV07CisKKwkJbHV0LT5i
bHVlID0gZW50cnkgJiAweGZmOworCQlsdXQtPmdyZWVuID0gKGVudHJ5ID4+IDgpICYgMHhmZjsK
KwkJbHV0LT5yZWQgPSAoZW50cnkgPj4gMTYpICYgMHhmZjsKKwl9CisKKwlyY21tLT5sdXQucmVz
dG9yZSA9IHRydWU7CisJcmNtbS0+bHV0LnJ1bm5pbmcgPSBmYWxzZTsKKworCXJjYXJfY21tX3dy
aXRlKHJjbW0sIENNMl9MVVRfQ1RSTCwgMCk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCByY2FyX2NtbV9wbV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCByY2Fy
X2NtbSAqcmNtbSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJaWYgKCFyY21tLT5sdXQucmVz
dG9yZSkKKwkJcmV0dXJuIDA7CisKKwkvKiBQcm9ncmFtIHRoZSBMVVQgZW50cmllcyBzYXZlZCBh
dCBzdXNwZW5kIHRpbWUuICovCisJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00yX0xVVF9DVFJMLCBD
TTJfTFVUX0NUUkxfRU4pOworCXJjYXJfY21tX2x1dF93cml0ZShyY21tLCByY21tLT5sdXQuc2l6
ZSwgcmNtbS0+bHV0LnRhYmxlKTsKKwlyY21tLT5sdXQucnVubmluZyA9IHRydWU7CisJcmNtbS0+
bHV0LnJlc3RvcmUgPSBmYWxzZTsKKworCXJldHVybiAwOworfQorI2VuZGlmCisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZGV2X3BtX29wcyByY2FyX2NtbV9wbV9vcHMgPSB7CisJU0VUX1NZU1RFTV9T
TEVFUF9QTV9PUFMocmNhcl9jbW1fcG1fc3VzcGVuZCwgcmNhcl9jbW1fcG1fcmVzdW1lKQorfTsK
Kworc3RhdGljIGludCByY2FyX2NtbV9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2
KQoreworCXN0cnVjdCByY2FyX2NtbSAqcmNtbTsKKwlzdHJ1Y3QgcmVzb3VyY2UgKnJlczsKKwly
ZXNvdXJjZV9zaXplX3Qgc2l6ZTsKKworCXJjbW0gPSBkZXZtX2t6YWxsb2MoJnBkZXYtPmRldiwg
c2l6ZW9mKCpyY21tKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFyY21tKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCXBsYXRmb3JtX3NldF9kcnZkYXRhKHBkZXYsIHJjbW0pOworCisJcmVzID0gcGxhdGZv
cm1fZ2V0X3Jlc291cmNlKHBkZXYsIElPUkVTT1VSQ0VfTUVNLCAwKTsKKwlzaXplID0gcmVzb3Vy
Y2Vfc2l6ZShyZXMpOworCWlmICghZGV2bV9yZXF1ZXN0X21lbV9yZWdpb24oJnBkZXYtPmRldiwg
cmVzLT5zdGFydCwgc2l6ZSwKKwkJCQkgICAgIGRldl9uYW1lKCZwZGV2LT5kZXYpKSkgeworCQlk
ZXZfZXJyKCZwZGV2LT5kZXYsCisJCQkiY2FuJ3QgcmVxdWVzdCByZWdpb24gZm9yIHJlc291cmNl
ICVwUlxuIiwgcmVzKTsKKwkJcmV0dXJuIC1FQlVTWTsKKwl9CisKKwlyY21tLT5iYXNlID0gZGV2
bV9pb3JlbWFwX25vY2FjaGUoJnBkZXYtPmRldiwgcmVzLT5zdGFydCwgc2l6ZSk7CisJaWYgKElT
X0VSUihyY21tLT5iYXNlKSkKKwkJcmV0dXJuIFBUUl9FUlIocmNtbS0+YmFzZSk7CisKKwlyY21t
LT5jbGsgPSBkZXZtX2Nsa19nZXQoJnBkZXYtPmRldiwgTlVMTCk7CisJaWYgKElTX0VSUihyY21t
LT5jbGspKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwgIkZhaWxlZCB0byBnZXQgQ01NIGNsb2Nr
Iik7CisJCXJldHVybiBQVFJfRVJSKHJjbW0tPmNsayk7CisJfQorCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIHJjYXJfY21tX29mX3RhYmxlW10gPSB7
CisJeyAuY29tcGF0aWJsZSA9ICJyZW5lc2FzLHJjYXItZ2VuMy1jbW0iLCB9LAorCXsgLmNvbXBh
dGlibGUgPSAicmVuZXNhcyxyY2FyLWdlbjItY21tIiwgfSwKKwl7IH0sCit9OworCitNT0RVTEVf
REVWSUNFX1RBQkxFKG9mLCByY2FyX2NtbV9vZl90YWJsZSk7CisKK3N0YXRpYyBzdHJ1Y3QgcGxh
dGZvcm1fZHJpdmVyIHJjYXJfY21tX3BsYXRmb3JtX2RyaXZlciA9IHsKKwkucHJvYmUJCT0gcmNh
cl9jbW1fcHJvYmUsCisJLmRyaXZlcgkJPSB7CisJCS5uYW1lCT0gInJjYXItY21tIiwKKwkJLnBt
CT0gJnJjYXJfY21tX3BtX29wcywKKwkJLm9mX21hdGNoX3RhYmxlID0gcmNhcl9jbW1fb2ZfdGFi
bGUsCisJfSwKK307CisKK21vZHVsZV9wbGF0Zm9ybV9kcml2ZXIocmNhcl9jbW1fcGxhdGZvcm1f
ZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiSmFjb3BvIE1vbmRpIDxqYWNvcG8rcmVuZXNhc0Bq
bW9uZGkub3JnPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJSZW5lc2FzIFItQ2FyIENNTSBEcml2
ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwgdjIiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfY21tLmggYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2Nt
bS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uODc0NGU3MmYzMmNk
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uaApA
QCAtMCwwICsxLDM4IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCsgKi8K
Ky8qCisgKiByY2FyX2NtbS5oIC0tIFItQ2FyIERpc3BsYXkgVW5pdCBDb2xvciBNYW5hZ2VtZW50
IE1vZHVsZQorICoKKyAqIENvcHlyaWdodCAoQykgMjAxOSBKYWNvcG8gTW9uZGkgPGphY29wbyty
ZW5lc2FzQGptb25kaS5vcmc+CisgKi8KKworI2lmbmRlZiBfX1JDQVJfQ01NX0hfXworI2RlZmlu
ZSBfX1JDQVJfQ01NX0hfXworCisjZGVmaW5lIENNTV9HQU1NQV9MVVRfU0laRQkJMjU2CisKK3N0
cnVjdCBwbGF0Zm9ybV9kZXZpY2U7CitzdHJ1Y3QgZHJtX2NvbG9yX2x1dDsKKworLyoqCisgKiBz
dHJ1Y3QgcmNhcl9jbW1fY29uZmlnIC0gQ01NIGNvbmZpZ3VyYXRpb24KKyAqCisgKiBAbHV0Ogkx
RC1MVVQgY29uZmlndXJhdGlvbgorICogQGx1dC5lbmFibGU6CTFELUxVVCBlbmFibGUgZmxhZwor
ICogQGx1dC50YWJsZToJMUQtTFVUIHRhYmxlIGVudHJpZXMuCisgKiBAbHV0LnNpemUJMUQtTFVU
IG51bWJlciBvZiBlbnRyaWVzLiBNYXggaXMgMjU2LgorICovCitzdHJ1Y3QgcmNhcl9jbW1fY29u
ZmlnIHsKKwlzdHJ1Y3QgeworCQlib29sIGVuYWJsZTsKKwkJc3RydWN0IGRybV9jb2xvcl9sdXQg
KnRhYmxlOworCQl1bnNpZ25lZCBpbnQgc2l6ZTsKKwl9IGx1dDsKK307CisKK2ludCByY2FyX2Nt
bV9lbmFibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7Cit2b2lkIHJjYXJfY21tX2Rp
c2FibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CisKK2ludCByY2FyX2NtbV9zZXR1
cChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAorCQkgICBjb25zdCBzdHJ1Y3QgcmNhcl9j
bW1fY29uZmlnICpjb25maWcpOworCisjZW5kaWYgLyogX19SQ0FSX0NNTV9IX18gKi8KLS0gCjIu
MjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
