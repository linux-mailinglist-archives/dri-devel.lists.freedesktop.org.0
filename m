Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E9039FC135
	for <lists+dri-devel@lfdr.de>; Thu, 14 Nov 2019 09:09:15 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E63CF6E2DF;
	Thu, 14 Nov 2019 08:07:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay6-d.mail.gandi.net (relay6-d.mail.gandi.net
 [217.70.183.198])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F23C26ECBA
 for <dri-devel@lists.freedesktop.org>; Wed, 13 Nov 2019 10:04:20 +0000 (UTC)
X-Originating-IP: 93.34.114.233
Received: from uno.lan (93-34-114-233.ip49.fastwebnet.it [93.34.114.233])
 (Authenticated sender: jacopo@jmondi.org)
 by relay6-d.mail.gandi.net (Postfix) with ESMTPSA id 66BF8C0013;
 Wed, 13 Nov 2019 10:04:17 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli+renesas@fpond.eu
Subject: [PATCH v7 3/7] drm: rcar-du: Add support for CMM
Date: Wed, 13 Nov 2019 11:05:52 +0100
Message-Id: <20191113100556.15616-4-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191113100556.15616-1-jacopo+renesas@jmondi.org>
References: <20191113100556.15616-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Thu, 14 Nov 2019 08:07:50 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: airlied@linux.ie, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, linux-renesas-soc@vger.kernel.org,
 Jacopo Mondi <jacopo+renesas@jmondi.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGEgZHJpdmVyIGZvciB0aGUgUi1DYXIgRGlzcGxheSBVbml0IENvbG9yIENvcnJlY3Rpb24g
TW9kdWxlLgoKSW4gbW9zdCBvZiBHZW4zIFNvQ3MsIGVhY2ggRFUgb3V0cHV0IGNoYW5uZWwgaXMg
cHJvdmlkZWQgd2l0aCBhIENNTSB1bml0CnRvIHBlcmZvcm0gaW1hZ2UgZW5oYW5jZW1lbnQgYW5k
IGNvbG9yIGNvcnJlY3Rpb24uCgpBZGQgc3VwcG9ydCBmb3IgQ01NIHRocm91Z2ggYSBkcml2ZXIg
dGhhdCBzdXBwb3J0cyBjb25maWd1cmF0aW9uIG9mCnRoZSAxLWRpbWVuc2lvbmFsIExVVCB0YWJs
ZS4gTW9yZSBhZHZhbmNlZCBDTU0gZmVhdHVyZXMgd2lsbCBiZQppbXBsZW1lbnRlZCBvbiB0b3Ag
b2YgdGhpcyBpbml0aWFsIG9uZS4KClJldmlld2VkLWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVy
ZW50LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+ClJldmlld2VkLWJ5OiBLaWVyYW4gQmluZ2hh
bSA8a2llcmFuLmJpbmdoYW0rcmVuZXNhc0BpZGVhc29uYm9hcmQuY29tPgpTaWduZWQtb2ZmLWJ5
OiBKYWNvcG8gTW9uZGkgPGphY29wbytyZW5lc2FzQGptb25kaS5vcmc+CgotLS0KdjYgLT4gdjcK
LSBFeHBhbmQgcmNhcl9jbW1fc2V0dXAoKSBmdW5jdGlvbiBkb2N1bWVudGF0aW9uIHRvIGRldGFp
bCBpdHMgcmVsYXRpb25zaGlwCiAgd2l0aCByY2FyX2NtbV9lbmFibGUoKSBhbmQgdGhlaXIgY2Fs
bCBvcmRlciBwcmVjZWRlbmNlLgoKLSBLY29uZmlnIHVwZGF0ZTogTWFrZSBEUk1fUkNBUl9DTU0g
YSB0cmlzdGF0ZSBvcHRpb24gYW5kICdpbXBseScgaXQgZnJvbSB0aGUKICBSQ0FSX0RVIG9uZS4g
VGhpcyBndWFyYW50ZWVzIHRoYXQgaWYgRFUgaXMgYnVpbHQgYXMgYSBtb2R1bGUgQ01NIGNhbiBv
bmx5IGJlCiAgYnVpbHQgYXMgYSBtb2R1bGUgYXMgd2VsbC4gQXQgdGhlIHNhbWUgdGltZSwgaWYg
RFUgaXMgYnVpbHQtaW4sIENNTSBjYW4KICBiZSBidWlsdC1pbiBvbmx5LgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9yY2FyLWR1L0tjb25maWcgICAgfCAgIDggKysKIGRyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L01ha2VmaWxlICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0u
YyB8IDIxNyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL3Jj
YXItZHUvcmNhcl9jbW0uaCB8ICA1OCArKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCAyODQgaW5z
ZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3Jj
YXJfY21tLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2Fy
X2NtbS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvS2NvbmZpZyBiL2Ry
aXZlcnMvZ3B1L2RybS9yY2FyLWR1L0tjb25maWcKaW5kZXggMTUyOTg0OWUyMTdlLi42ZWQ3YTRm
M2M0NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L0tjb25maWcKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvS2NvbmZpZwpAQCAtNSw2ICs1LDcgQEAgY29uZmlnIERS
TV9SQ0FSX0RVCiAJZGVwZW5kcyBvbiBBUk0gfHwgQVJNNjQKIAlkZXBlbmRzIG9uIEFSQ0hfUkVO
RVNBUyB8fCBDT01QSUxFX1RFU1QKIAlpbXBseSBEUk1fUkNBUl9MVkRTCisJaW1wbHkgRFJNX1JD
QVJfQ01NCiAJc2VsZWN0IERSTV9LTVNfSEVMUEVSCiAJc2VsZWN0IERSTV9LTVNfQ01BX0hFTFBF
UgogCXNlbGVjdCBEUk1fR0VNX0NNQV9IRUxQRVIKQEAgLTEzLDYgKzE0LDEzIEBAIGNvbmZpZyBE
Uk1fUkNBUl9EVQogCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIGlmIHlvdSBoYXZlIGFuIFItQ2FyIGNo
aXBzZXQuCiAJICBJZiBNIGlzIHNlbGVjdGVkIHRoZSBtb2R1bGUgd2lsbCBiZSBjYWxsZWQgcmNh
ci1kdS1kcm0uCgorY29uZmlnIERSTV9SQ0FSX0NNTQorCXRyaXN0YXRlICJSLUNhciBEVSBDb2xv
ciBNYW5hZ2VtZW50IE1vZHVsZSAoQ01NKSBTdXBwb3J0IgorCWRlcGVuZHMgb24gRFJNICYmIE9G
CisJZGVwZW5kcyBvbiBEUk1fUkNBUl9EVQorCWhlbHAKKwkgIEVuYWJsZSBzdXBwb3J0IGZvciBS
LUNhciBDb2xvciBNYW5hZ2VtZW50IE1vZHVsZSAoQ01NKS4KKwogY29uZmlnIERSTV9SQ0FSX0RX
X0hETUkKIAl0cmlzdGF0ZSAiUi1DYXIgRFUgR2VuMyBIRE1JIEVuY29kZXIgU3VwcG9ydCIKIAlk
ZXBlbmRzIG9uIERSTSAmJiBPRgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUv
TWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9NYWtlZmlsZQppbmRleCA2YzJlZDlj
NDY0NjcuLjRkMTE4N2NjYzNlNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUv
TWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvTWFrZWZpbGUKQEAgLTE1LDYg
KzE1LDcgQEAgcmNhci1kdS1kcm0tJChDT05GSUdfRFJNX1JDQVJfTFZEUykJKz0gcmNhcl9kdV9v
Zi5vIFwKIHJjYXItZHUtZHJtLSQoQ09ORklHX0RSTV9SQ0FSX1ZTUCkJKz0gcmNhcl9kdV92c3Au
bwogcmNhci1kdS1kcm0tJChDT05GSUdfRFJNX1JDQVJfV1JJVEVCQUNLKSArPSByY2FyX2R1X3dy
aXRlYmFjay5vCgorb2JqLSQoQ09ORklHX0RSTV9SQ0FSX0NNTSkJCSs9IHJjYXJfY21tLm8KIG9i
ai0kKENPTkZJR19EUk1fUkNBUl9EVSkJCSs9IHJjYXItZHUtZHJtLm8KIG9iai0kKENPTkZJR19E
Uk1fUkNBUl9EV19IRE1JKQkJKz0gcmNhcl9kd19oZG1pLm8KIG9iai0kKENPTkZJR19EUk1fUkNB
Ul9MVkRTKQkJKz0gcmNhcl9sdmRzLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L3JjYXJfY21tLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2NtbS5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYzU3ODA5NWIwOWE1Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9jbW0uYwpAQCAtMCwwICsx
LDIxNyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjArCisvKgorICogcmNh
cl9jbW0uYyAtLSBSLUNhciBEaXNwbGF5IFVuaXQgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGUKKyAq
CisgKiBDb3B5cmlnaHQgKEMpIDIwMTkgSmFjb3BvIE1vbmRpIDxqYWNvcG8rcmVuZXNhc0BqbW9u
ZGkub3JnPgorICovCisKKyNpbmNsdWRlIDxsaW51eC9pby5oPgorI2luY2x1ZGUgPGxpbnV4L21v
ZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L29mLmg+CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1f
ZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgorCisjaW5jbHVkZSA8ZHJt
L2RybV9jb2xvcl9tZ210Lmg+CisKKyNpbmNsdWRlICJyY2FyX2NtbS5oIgorCisjZGVmaW5lIENN
Ml9MVVRfQ1RSTAkJMHgwMDAwCisjZGVmaW5lIENNMl9MVVRfQ1RSTF9MVVRfRU4JQklUKDApCisj
ZGVmaW5lIENNMl9MVVRfVEJMX0JBU0UJMHgwNjAwCisjZGVmaW5lIENNMl9MVVRfVEJMKF9faSkJ
KENNMl9MVVRfVEJMX0JBU0UgKyAoX19pKSAqIDQpCisKK3N0cnVjdCByY2FyX2NtbSB7CisJdm9p
ZCBfX2lvbWVtICpiYXNlOworCisJLyoKKwkgKiBAbHV0OgkJMUQtTFVUIHN0YXRlCisJICogQGx1
dC5lbmFibGVkOgkxRC1MVVQgZW5hYmxlZCBmbGFnCisJICovCisJc3RydWN0IHsKKwkJYm9vbCBl
bmFibGVkOworCX0gbHV0OworfTsKKworc3RhdGljIGlubGluZSBpbnQgcmNhcl9jbW1fcmVhZChz
dHJ1Y3QgcmNhcl9jbW0gKnJjbW0sIHUzMiByZWcpCit7CisJcmV0dXJuIGlvcmVhZDMyKHJjbW0t
PmJhc2UgKyByZWcpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgcmNhcl9jbW1fd3JpdGUoc3Ry
dWN0IHJjYXJfY21tICpyY21tLCB1MzIgcmVnLCB1MzIgZGF0YSkKK3sKKwlpb3dyaXRlMzIoZGF0
YSwgcmNtbS0+YmFzZSArIHJlZyk7Cit9CisKKy8qCisgKiByY2FyX2NtbV9sdXRfd3JpdGUoKSAt
IFNjYWxlIHRoZSBEUk0gTFVUIHRhYmxlIGVudHJpZXMgdG8gaGFyZHdhcmUgcHJlY2lzaW9uCisg
KgkJCSAgYW5kIHdyaXRlIHRvIHRoZSBDTU0gcmVnaXN0ZXJzCisgKiBAcmNtbTogUG9pbnRlciB0
byB0aGUgQ01NIGRldmljZQorICogQGRybV9sdXQ6IFBvaW50ZXIgdG8gdGhlIERSTSBMVVQgdGFi
bGUKKyAqLworc3RhdGljIHZvaWQgcmNhcl9jbW1fbHV0X3dyaXRlKHN0cnVjdCByY2FyX2NtbSAq
cmNtbSwKKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqZHJtX2x1dCkKK3sK
Kwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBDTTJfTFVUX1NJWkU7ICsraSkg
eworCQl1MzIgZW50cnkgPSBkcm1fY29sb3JfbHV0X2V4dHJhY3QoZHJtX2x1dFtpXS5yZWQsIDgp
IDw8IDE2CisJCQkgIHwgZHJtX2NvbG9yX2x1dF9leHRyYWN0KGRybV9sdXRbaV0uZ3JlZW4sIDgp
IDw8IDgKKwkJCSAgfCBkcm1fY29sb3JfbHV0X2V4dHJhY3QoZHJtX2x1dFtpXS5ibHVlLCA4KTsK
KworCQlyY2FyX2NtbV93cml0ZShyY21tLCBDTTJfTFVUX1RCTChpKSwgZW50cnkpOworCX0KK30K
KworLyoKKyAqIHJjYXJfY21tX3NldHVwKCkgLSBDb25maWd1cmUgdGhlIENNTSB1bml0CisgKiBA
cGRldjogVGhlIHBsYXRmb3JtIGRldmljZSBhc3NvY2lhdGVkIHdpdGggdGhlIENNTSBpbnN0YW5j
ZQorICogQGNvbmZpZzogVGhlIENNTSB1bml0IGNvbmZpZ3VyYXRpb24KKyAqCisgKiBDb25maWd1
cmUgdGhlIENNTSB1bml0IHdpdGggdGhlIGdpdmVuIGNvbmZpZ3VyYXRpb24uIEN1cnJlbnRseSBl
bmFibGluZywKKyAqIGRpc2FibGluZyBhbmQgcHJvZ3JhbW1pbmcgb2YgdGhlIDEtRCBMVVQgdW5p
dCBpcyBzdXBwb3J0ZWQuCisgKgorICogQXMgcmNhcl9jbW1fc2V0dXAoKSBhY2Nlc3NlcyB0aGUg
Q01NIHJlZ2lzdGVycyB0aGUgdW5pdCBzaG91bGQgYmUgcG93ZXJlZAorICogYW5kIGl0cyBmdW5j
dGlvbmFsIGNsb2NrIGVuYWJsZWQuIFRvIGd1YXJhbnRlZSB0aGlzLCBiZWZvcmUgYW55IGNhbGwg
dG8KKyAqIHRoaXMgZnVuY3Rpb24gaXMgbWFkZSwgdGhlIENNTSB1bml0IGhhcyB0byBiZSBlbmFi
bGVkIGJ5IGNhbGxpbmcKKyAqIHJjYXJfY21tX2VuYWJsZSgpIGZpcnN0LgorICoKKyAqIFRPRE86
IEFkZCBzdXBwb3J0IGZvciBMVVQgZG91YmxlIGJ1ZmZlciBvcGVyYXRpb25zIHRvIGF2b2lkIHVw
ZGF0aW5nIHRoZQorICogTFVUIHRhYmxlIGVudHJpZXMgd2hpbGUgYSBmcmFtZSBpcyBiZWluZyBk
aXNwbGF5ZWQuCisgKi8KK2ludCByY2FyX2NtbV9zZXR1cChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNl
ICpwZGV2LAorCQkgICBjb25zdCBzdHJ1Y3QgcmNhcl9jbW1fY29uZmlnICpjb25maWcpCit7CisJ
c3RydWN0IHJjYXJfY21tICpyY21tID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEocGRldik7CisKKwkv
KiBEaXNhYmxlIExVVCBpZiBubyB0YWJsZSBpcyBwcm92aWRlZC4gKi8KKwlpZiAoIWNvbmZpZy0+
bHV0LnRhYmxlKSB7CisJCWlmIChyY21tLT5sdXQuZW5hYmxlZCkgeworCQkJcmNhcl9jbW1fd3Jp
dGUocmNtbSwgQ00yX0xVVF9DVFJMLCAwKTsKKwkJCXJjbW0tPmx1dC5lbmFibGVkID0gZmFsc2U7
CisJCX0KKworCQlyZXR1cm4gMDsKKwl9CisKKwkvKiBFbmFibGUgTFVUIGFuZCBwcm9ncmFtIHRo
ZSBuZXcgZ2FtbWEgdGFibGUgdmFsdWVzLiAqLworCWlmICghcmNtbS0+bHV0LmVuYWJsZWQpIHsK
KwkJcmNhcl9jbW1fd3JpdGUocmNtbSwgQ00yX0xVVF9DVFJMLCBDTTJfTFVUX0NUUkxfTFVUX0VO
KTsKKwkJcmNtbS0+bHV0LmVuYWJsZWQgPSB0cnVlOworCX0KKworCXJjYXJfY21tX2x1dF93cml0
ZShyY21tLCBjb25maWctPmx1dC50YWJsZSk7CisKKwlyZXR1cm4gMDsKK30KK0VYUE9SVF9TWU1C
T0xfR1BMKHJjYXJfY21tX3NldHVwKTsKKworLyoKKyAqIHJjYXJfY21tX2VuYWJsZSgpIC0gRW5h
YmxlIHRoZSBDTU0gdW5pdAorICogQHBkZXY6IFRoZSBwbGF0Zm9ybSBkZXZpY2UgYXNzb2NpYXRl
ZCB3aXRoIHRoZSBDTU0gaW5zdGFuY2UKKyAqCisgKiBXaGVuIHRoZSBvdXRwdXQgb2YgdGhlIGNv
cnJlc3BvbmRpbmcgRFUgY2hhbm5lbCBpcyByb3V0ZWQgdG8gdGhlIENNTSB1bml0LAorICogdGhl
IHVuaXQgc2hhbGwgYmUgZW5hYmxlZCBiZWZvcmUgdGhlIERVIGNoYW5uZWwgaXMgc3RhcnRlZCwg
YW5kIHJlbWFpbgorICogZW5hYmxlZCB1bnRpbCB0aGUgY2hhbm5lbCBpcyBzdG9wcGVkLiBUaGUg
Q01NIHVuaXQgc2hhbGwgYmUgZGlzYWJsZWQgd2l0aAorICogcmNhcl9jbW1fZGlzYWJsZSgpLgor
ICoKKyAqIENhbGxzIHRvIHJjYXJfY21tX2VuYWJsZSgpIGFuZCByY2FyX2NtbV9kaXNhYmxlKCkg
YXJlIG5vdCByZWZlcmVuY2UtY291bnRlZC4KKyAqIEl0IGlzIGFuIGVycm9yIHRvIGF0dGVtcHQg
dG8gZW5hYmxlIGFuIGFscmVhZHkgZW5hYmxlZCBDTU0gdW5pdCwgb3IgdG8KKyAqIGF0dGVtcHQg
dG8gZGlzYWJsZSBhIGRpc2FibGVkIHVuaXQuCisgKi8KK2ludCByY2FyX2NtbV9lbmFibGUoc3Ry
dWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlpbnQgcmV0OworCisJcmV0ID0gcG1fcnVu
dGltZV9nZXRfc3luYygmcGRldi0+ZGV2KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsK
KworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTF9HUEwocmNhcl9jbW1fZW5hYmxlKTsKKwor
LyoKKyAqIHJjYXJfY21tX2Rpc2FibGUoKSAtIERpc2FibGUgdGhlIENNTSB1bml0CisgKiBAcGRl
djogVGhlIHBsYXRmb3JtIGRldmljZSBhc3NvY2lhdGVkIHdpdGggdGhlIENNTSBpbnN0YW5jZQor
ICoKKyAqIFNlZSByY2FyX2NtbV9lbmFibGUoKSBmb3IgdXNhZ2UgaW5mb3JtYXRpb24uCisgKgor
ICogRGlzYWJsaW5nIHRoZSBDTU0gdW5pdCBkaXNhYmxlIGFsbCB0aGUgaW50ZXJuYWwgcHJvY2Vz
c2luZyBibG9ja3MuIFRoZSBDTU0KKyAqIHN0YXRlIHNoYWxsIHRodXMgYmUgcmVzdG9yZWQgd2l0
aCByY2FyX2NtbV9zZXR1cCgpIHdoZW4gcmUtZW5hYmxpbmcgdGhlIENNTQorICogdW5pdCBhZnRl
ciB0aGUgbmV4dCByY2FyX2NtbV9lbmFibGUoKSBjYWxsLgorICovCit2b2lkIHJjYXJfY21tX2Rp
c2FibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgcmNhcl9jbW0g
KnJjbW0gPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsKKworCXJjYXJfY21tX3dyaXRlKHJj
bW0sIENNMl9MVVRfQ1RSTCwgMCk7CisJcmNtbS0+bHV0LmVuYWJsZWQgPSBmYWxzZTsKKworCXBt
X3J1bnRpbWVfcHV0KCZwZGV2LT5kZXYpOworfQorRVhQT1JUX1NZTUJPTF9HUEwocmNhcl9jbW1f
ZGlzYWJsZSk7CisKKy8qCisgKiByY2FyX2NtbV9pbml0KCkgLSBJbml0aWFsaXplIHRoZSBDTU0g
dW5pdAorICogQHBkZXY6IFRoZSBwbGF0Zm9ybSBkZXZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBD
TU0gaW5zdGFuY2UKKyAqCisgKiBSZXR1cm46IDAgb24gc3VjY2VzcywgLUVQUk9CRV9ERUZFUiBp
ZiB0aGUgQ01NIGlzIG5vdCBhdmFpbGFibGUgeWV0LAorICogICAgICAgICAtRU5PREVWIGlmIHRo
ZSBEUk1fUkNBUl9DTU0gY29uZmlnIG9wdGlvbiBpcyBkaXNhYmxlZAorICovCitpbnQgcmNhcl9j
bW1faW5pdChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCByY2FyX2Nt
bSAqcmNtbSA9IHBsYXRmb3JtX2dldF9kcnZkYXRhKHBkZXYpOworCisJaWYgKCFyY21tKQorCQly
ZXR1cm4gLUVQUk9CRV9ERUZFUjsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZTUJPTF9HUEwo
cmNhcl9jbW1faW5pdCk7CisKK3N0YXRpYyBpbnQgcmNhcl9jbW1fcHJvYmUoc3RydWN0IHBsYXRm
b3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgcmNhcl9jbW0gKnJjbW07CisKKwlyY21tID0g
ZGV2bV9remFsbG9jKCZwZGV2LT5kZXYsIHNpemVvZigqcmNtbSksIEdGUF9LRVJORUwpOworCWlm
ICghcmNtbSkKKwkJcmV0dXJuIC1FTk9NRU07CisJcGxhdGZvcm1fc2V0X2RydmRhdGEocGRldiwg
cmNtbSk7CisKKwlyY21tLT5iYXNlID0gZGV2bV9wbGF0Zm9ybV9pb3JlbWFwX3Jlc291cmNlKHBk
ZXYsIDApOworCWlmIChJU19FUlIocmNtbS0+YmFzZSkpCisJCXJldHVybiBQVFJfRVJSKHJjbW0t
PmJhc2UpOworCisJcG1fcnVudGltZV9lbmFibGUoJnBkZXYtPmRldik7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCByY2FyX2NtbV9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKK3sKKwlwbV9ydW50aW1lX2Rpc2FibGUoJnBkZXYtPmRldik7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgcmNhcl9jbW1fb2ZfdGFibGVb
XSA9IHsKKwl7IC5jb21wYXRpYmxlID0gInJlbmVzYXMscmNhci1nZW4zLWNtbSIsIH0sCisJeyAu
Y29tcGF0aWJsZSA9ICJyZW5lc2FzLHJjYXItZ2VuMi1jbW0iLCB9LAorCXsgfSwKK307CitNT0RV
TEVfREVWSUNFX1RBQkxFKG9mLCByY2FyX2NtbV9vZl90YWJsZSk7CisKK3N0YXRpYyBzdHJ1Y3Qg
cGxhdGZvcm1fZHJpdmVyIHJjYXJfY21tX3BsYXRmb3JtX2RyaXZlciA9IHsKKwkucHJvYmUJCT0g
cmNhcl9jbW1fcHJvYmUsCisJLnJlbW92ZQkJPSByY2FyX2NtbV9yZW1vdmUsCisJLmRyaXZlcgkJ
PSB7CisJCS5uYW1lCT0gInJjYXItY21tIiwKKwkJLm9mX21hdGNoX3RhYmxlID0gcmNhcl9jbW1f
b2ZfdGFibGUsCisJfSwKK307CisKK21vZHVsZV9wbGF0Zm9ybV9kcml2ZXIocmNhcl9jbW1fcGxh
dGZvcm1fZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiSmFjb3BvIE1vbmRpIDxqYWNvcG8rcmVu
ZXNhc0BqbW9uZGkub3JnPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJSZW5lc2FzIFItQ2FyIENN
TSBEcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwgdjIiKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfY21tLmggYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9y
Y2FyX2NtbS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYjVmN2Vj
NmRiMDRhCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9j
bW0uaApAQCAtMCwwICsxLDU4IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIu
MCsgKi8KKy8qCisgKiByY2FyX2NtbS5oIC0tIFItQ2FyIERpc3BsYXkgVW5pdCBDb2xvciBNYW5h
Z2VtZW50IE1vZHVsZQorICoKKyAqIENvcHlyaWdodCAoQykgMjAxOSBKYWNvcG8gTW9uZGkgPGph
Y29wbytyZW5lc2FzQGptb25kaS5vcmc+CisgKi8KKworI2lmbmRlZiBfX1JDQVJfQ01NX0hfXwor
I2RlZmluZSBfX1JDQVJfQ01NX0hfXworCisjZGVmaW5lIENNMl9MVVRfU0laRQkJMjU2CisKK3N0
cnVjdCBkcm1fY29sb3JfbHV0Oworc3RydWN0IHBsYXRmb3JtX2RldmljZTsKKworLyoqCisgKiBz
dHJ1Y3QgcmNhcl9jbW1fY29uZmlnIC0gQ01NIGNvbmZpZ3VyYXRpb24KKyAqCisgKiBAbHV0Ogkx
RC1MVVQgY29uZmlndXJhdGlvbgorICogQGx1dC50YWJsZToJMUQtTFVUIHRhYmxlIGVudHJpZXMu
IERpc2FibGUgTFVUIG9wZXJhdGlvbnMgd2hlbiBOVUxMCisgKi8KK3N0cnVjdCByY2FyX2NtbV9j
b25maWcgeworCXN0cnVjdCB7CisJCXN0cnVjdCBkcm1fY29sb3JfbHV0ICp0YWJsZTsKKwl9IGx1
dDsKK307CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fUkNBUl9DTU0pCitpbnQgcmNhcl9j
bW1faW5pdChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKKworaW50IHJjYXJfY21tX2Vu
YWJsZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKK3ZvaWQgcmNhcl9jbW1fZGlzYWJs
ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKKworaW50IHJjYXJfY21tX3NldHVwKHN0
cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCisJCSAgIGNvbnN0IHN0cnVjdCByY2FyX2NtbV9j
b25maWcgKmNvbmZpZyk7CisjZWxzZQorc3RhdGljIGlubGluZSBpbnQgcmNhcl9jbW1faW5pdChz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXJldHVybiAtRU5PREVWOworfQorCitz
dGF0aWMgaW5saW5lIGludCByY2FyX2NtbV9lbmFibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAq
cGRldikKK3sKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlubGluZSB2b2lkIHJjYXJfY21tX2Rp
c2FibGUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKK30KKworc3RhdGljIGlubGlu
ZSBpbnQgcmNhcl9jbW1fc2V0dXAoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKKwkJCQkg
Y29uc3Qgc3RydWN0IHJjYXJfY21tX2NvbmZpZyAqY29uZmlnKQoreworCXJldHVybiAwOworfQor
I2VuZGlmIC8qIElTX0VOQUJMRUQoQ09ORklHX0RSTV9SQ0FSX0NNTSkgKi8KKworI2VuZGlmIC8q
IF9fUkNBUl9DTU1fSF9fICovCi0tCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
