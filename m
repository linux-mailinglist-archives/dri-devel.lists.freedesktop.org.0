Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2C1BCB8C95
	for <lists+dri-devel@lfdr.de>; Fri, 20 Sep 2019 10:22:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 521DA6FB42;
	Fri, 20 Sep 2019 08:22:35 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2381A6E830;
 Fri, 20 Sep 2019 08:22:34 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 698A1309BDBC;
 Fri, 20 Sep 2019 08:22:33 +0000 (UTC)
Received: from jason-ThinkPad-X1-Carbon-6th.redhat.com
 (ovpn-12-88.pek2.redhat.com [10.72.12.88])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 227911018A13;
 Fri, 20 Sep 2019 08:22:11 +0000 (UTC)
From: Jason Wang <jasowang@redhat.com>
To: kvm@vger.kernel.org, linux-s390@vger.kernel.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 intel-gfx@lists.freedesktop.org, intel-gvt-dev@lists.freedesktop.org,
 kwankhede@nvidia.com, alex.williamson@redhat.com, mst@redhat.com,
 tiwei.bie@intel.com
Subject: [RFC PATCH V2 1/6] mdev: class id support
Date: Fri, 20 Sep 2019 16:20:45 +0800
Message-Id: <20190920082050.19352-2-jasowang@redhat.com>
In-Reply-To: <20190920082050.19352-1-jasowang@redhat.com>
References: <20190920082050.19352-1-jasowang@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Fri, 20 Sep 2019 08:22:33 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sebott@linux.ibm.com, airlied@linux.ie, Jason Wang <jasowang@redhat.com>,
 heiko.carstens@de.ibm.com, virtualization@lists.linux-foundation.org,
 rob.miller@broadcom.com, lulu@redhat.com, eperezma@redhat.com,
 pasic@linux.ibm.com, borntraeger@de.ibm.com, haotian.wang@sifive.com,
 zhi.a.wang@intel.com, farman@linux.ibm.com, idos@mellanox.com,
 gor@linux.ibm.com, cunming.liang@intel.com, rodrigo.vivi@intel.com,
 xiao.w.wang@intel.com, freude@linux.ibm.com, zhihong.wang@intel.com,
 akrowiak@linux.ibm.com, pmorel@linux.ibm.com, netdev@vger.kernel.org,
 cohuck@redhat.com, oberpar@linux.ibm.com, maxime.coquelin@redhat.com,
 lingshan.zhu@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWRldiBidXMgb25seSBzdXBwb3J0IHZmaW8gZHJpdmVyIHJpZ2h0IG5vdywgc28gaXQgZG9lc24n
dCBpbXBsZW1lbnQKbWF0Y2ggbWV0aG9kLiBCdXQgaW4gdGhlIGZ1dHVyZSwgd2UgbWF5IGFkZCBk
cml2ZXJzIG90aGVyIHRoYW4gdmZpbywKb25lIGV4YW1wbGUgaXMgdmlydGlvLW1kZXZbMV0gZHJp
dmVyLiBUaGlzIG1lYW5zIHdlIG5lZWQgdG8gYWRkIGRldmljZQpjbGFzcyBpZCBzdXBwb3J0IGlu
IGJ1cyBtYXRjaCBtZXRob2QgdG8gcGFpciB0aGUgbWRldiBkZXZpY2UgYW5kIG1kZXYKZHJpdmVy
IGNvcnJlY3RseS4KClNvIHRoaXMgcGF0Y2ggYWRkIGlkX3RhYmxlIHRvIG1kZXZfZHJpdmVyIGFu
ZCBpZCBmb3IgbWRldiBwYXJlbnQsIGFuZAppbXBsZW1lbnQgdGhlIG1hdGNoIG1ldGhvZCBmb3Ig
bWRldiBidXMuCgpTaWduZWQtb2ZmLWJ5OiBKYXNvbiBXYW5nIDxqYXNvd2FuZ0ByZWRoYXQuY29t
PgotLS0KIERvY3VtZW50YXRpb24vZHJpdmVyLWFwaS92ZmlvLW1lZGlhdGVkLWRldmljZS5yc3Qg
fCAgNyArKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYyAgICAgICAgICAg
ICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvczM5MC9jaW8vdmZpb19jY3dfb3BzLmMgICAgICAgICAg
ICAgICAgICAgfCAgMiArLQogZHJpdmVycy9zMzkwL2NyeXB0by92ZmlvX2FwX29wcy5jICAgICAg
ICAgICAgICAgICB8ICAzICsrLQogZHJpdmVycy92ZmlvL21kZXYvbWRldl9jb3JlLmMgICAgICAg
ICAgICAgICAgICAgICB8IDE0ICsrKysrKysrKysrKy0tCiBkcml2ZXJzL3ZmaW8vbWRldi9tZGV2
X2RyaXZlci5jICAgICAgICAgICAgICAgICAgIHwgMTQgKysrKysrKysrKysrKysKIGRyaXZlcnMv
dmZpby9tZGV2L21kZXZfcHJpdmF0ZS5oICAgICAgICAgICAgICAgICAgfCAgMSArCiBkcml2ZXJz
L3ZmaW8vbWRldi92ZmlvX21kZXYuYyAgICAgICAgICAgICAgICAgICAgIHwgIDYgKysrKysrCiBp
bmNsdWRlL2xpbnV4L21kZXYuaCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDYgKysr
KystCiBpbmNsdWRlL2xpbnV4L21vZF9kZXZpY2V0YWJsZS5oICAgICAgICAgICAgICAgICAgIHwg
IDggKysrKysrKysKIHNhbXBsZXMvdmZpby1tZGV2L21ib2Nocy5jICAgICAgICAgICAgICAgICAg
ICAgICAgfCAgMiArLQogc2FtcGxlcy92ZmlvLW1kZXYvbWRweS5jICAgICAgICAgICAgICAgICAg
ICAgICAgICB8ICAyICstCiBzYW1wbGVzL3ZmaW8tbWRldi9tdHR5LmMgICAgICAgICAgICAgICAg
ICAgICAgICAgIHwgIDIgKy0KIDEzIGZpbGVzIGNoYW5nZWQsIDU4IGluc2VydGlvbnMoKyksIDEx
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vZHJpdmVyLWFwaS92Zmlv
LW1lZGlhdGVkLWRldmljZS5yc3QgYi9Eb2N1bWVudGF0aW9uL2RyaXZlci1hcGkvdmZpby1tZWRp
YXRlZC1kZXZpY2UucnN0CmluZGV4IDI1ZWI3ZDViODM0Yi4uMGQ2ZTg1MTU1YjliIDEwMDY0NAot
LS0gYS9Eb2N1bWVudGF0aW9uL2RyaXZlci1hcGkvdmZpby1tZWRpYXRlZC1kZXZpY2UucnN0Cisr
KyBiL0RvY3VtZW50YXRpb24vZHJpdmVyLWFwaS92ZmlvLW1lZGlhdGVkLWRldmljZS5yc3QKQEAg
LTEwMiwxMiArMTAyLDE0IEBAIHN0cnVjdHVyZSB0byByZXByZXNlbnQgYSBtZWRpYXRlZCBkZXZp
Y2UncyBkcml2ZXI6OgogICAgICAgKiBAcHJvYmU6IGNhbGxlZCB3aGVuIG5ldyBkZXZpY2UgY3Jl
YXRlZAogICAgICAgKiBAcmVtb3ZlOiBjYWxsZWQgd2hlbiBkZXZpY2UgcmVtb3ZlZAogICAgICAg
KiBAZHJpdmVyOiBkZXZpY2UgZHJpdmVyIHN0cnVjdHVyZQorICAgICAgKiBAaWRfdGFibGU6IHRo
ZSBpZHMgc2VydmljZWQgYnkgdGhpcyBkcml2ZXIuCiAgICAgICAqLwogICAgICBzdHJ1Y3QgbWRl
dl9kcml2ZXIgewogCSAgICAgY29uc3QgY2hhciAqbmFtZTsKIAkgICAgIGludCAgKCpwcm9iZSkg
IChzdHJ1Y3QgZGV2aWNlICpkZXYpOwogCSAgICAgdm9pZCAoKnJlbW92ZSkgKHN0cnVjdCBkZXZp
Y2UgKmRldik7CiAJICAgICBzdHJ1Y3QgZGV2aWNlX2RyaXZlciAgICBkcml2ZXI7CisJICAgICBj
b25zdCBzdHJ1Y3QgbWRldl9jbGFzc19pZCAqaWRfdGFibGU7CiAgICAgIH07CiAKIEEgbWVkaWF0
ZWQgYnVzIGRyaXZlciBmb3IgbWRldiBzaG91bGQgdXNlIHRoaXMgc3RydWN0dXJlIGluIHRoZSBm
dW5jdGlvbiBjYWxscwpAQCAtMTE2LDcgKzExOCw3IEBAIHRvIHJlZ2lzdGVyIGFuZCB1bnJlZ2lz
dGVyIGl0c2VsZiB3aXRoIHRoZSBjb3JlIGRyaXZlcjoKICogUmVnaXN0ZXI6OgogCiAgICAgZXh0
ZXJuIGludCAgbWRldl9yZWdpc3Rlcl9kcml2ZXIoc3RydWN0IG1kZXZfZHJpdmVyICpkcnYsCi0J
CQkJICAgc3RydWN0IG1vZHVsZSAqb3duZXIpOworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBtb2R1bGUgKm93bmVyKTsKIAogKiBVbnJlZ2lzdGVyOjoKIApAQCAt
MTYzLDcgKzE2NSw4IEBAIEEgZHJpdmVyIHNob3VsZCB1c2UgdGhlIG1kZXZfcGFyZW50X29wcyBz
dHJ1Y3R1cmUgaW4gdGhlIGZ1bmN0aW9uIGNhbGwgdG8KIHJlZ2lzdGVyIGl0c2VsZiB3aXRoIHRo
ZSBtZGV2IGNvcmUgZHJpdmVyOjoKIAogCWV4dGVybiBpbnQgIG1kZXZfcmVnaXN0ZXJfZGV2aWNl
KHN0cnVjdCBkZXZpY2UgKmRldiwKLQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
b25zdCBzdHJ1Y3QgbWRldl9wYXJlbnRfb3BzICpvcHMpOworCSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IHN0cnVjdCBtZGV2X3BhcmVudF9vcHMgKm9wcywKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdTggY2xhc3NfaWQpOwogCiBIb3dldmVy
LCB0aGUgbWRldl9wYXJlbnRfb3BzIHN0cnVjdHVyZSBpcyBub3QgcmVxdWlyZWQgaW4gdGhlIGZ1
bmN0aW9uIGNhbGwKIHRoYXQgYSBkcml2ZXIgc2hvdWxkIHVzZSB0byB1bnJlZ2lzdGVyIGl0c2Vs
ZiB3aXRoIHRoZSBtZGV2IGNvcmUgZHJpdmVyOjoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9rdm1ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2t2bWd0LmMKaW5k
ZXggMjNhYTNlNTBjYmY4Li4xOWQ1MWEzNWYwMTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9rdm1ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9rdm1ndC5j
CkBAIC0xNjI1LDcgKzE2MjUsNyBAQCBzdGF0aWMgaW50IGt2bWd0X2hvc3RfaW5pdChzdHJ1Y3Qg
ZGV2aWNlICpkZXYsIHZvaWQgKmd2dCwgY29uc3Qgdm9pZCAqb3BzKQogCQlyZXR1cm4gLUVGQVVM
VDsKIAlpbnRlbF92Z3B1X29wcy5zdXBwb3J0ZWRfdHlwZV9ncm91cHMgPSBrdm1fdmdwdV90eXBl
X2dyb3VwczsKIAotCXJldHVybiBtZGV2X3JlZ2lzdGVyX2RldmljZShkZXYsICZpbnRlbF92Z3B1
X29wcyk7CisJcmV0dXJuIG1kZXZfcmVnaXN0ZXJfdmZpb19kZXZpY2UoZGV2LCAmaW50ZWxfdmdw
dV9vcHMpOwogfQogCiBzdGF0aWMgdm9pZCBrdm1ndF9ob3N0X2V4aXQoc3RydWN0IGRldmljZSAq
ZGV2KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zMzkwL2Npby92ZmlvX2Njd19vcHMuYyBiL2RyaXZl
cnMvczM5MC9jaW8vdmZpb19jY3dfb3BzLmMKaW5kZXggNWViNjExMTZjYTZmLi5mODdkOTQwOWUy
OTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvczM5MC9jaW8vdmZpb19jY3dfb3BzLmMKKysrIGIvZHJp
dmVycy9zMzkwL2Npby92ZmlvX2Njd19vcHMuYwpAQCAtNTc4LDcgKzU3OCw3IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgbWRldl9wYXJlbnRfb3BzIHZmaW9fY2N3X21kZXZfb3BzID0gewogCiBpbnQg
dmZpb19jY3dfbWRldl9yZWcoc3RydWN0IHN1YmNoYW5uZWwgKnNjaCkKIHsKLQlyZXR1cm4gbWRl
dl9yZWdpc3Rlcl9kZXZpY2UoJnNjaC0+ZGV2LCAmdmZpb19jY3dfbWRldl9vcHMpOworCXJldHVy
biBtZGV2X3JlZ2lzdGVyX3ZmaW9fZGV2aWNlKCZzY2gtPmRldiwgJnZmaW9fY2N3X21kZXZfb3Bz
KTsKIH0KIAogdm9pZCB2ZmlvX2Njd19tZGV2X3VucmVnKHN0cnVjdCBzdWJjaGFubmVsICpzY2gp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL3MzOTAvY3J5cHRvL3ZmaW9fYXBfb3BzLmMgYi9kcml2ZXJz
L3MzOTAvY3J5cHRvL3ZmaW9fYXBfb3BzLmMKaW5kZXggMDYwNGI0OWE0ZDMyLi5lYWNiZGUzYzdh
OTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvczM5MC9jcnlwdG8vdmZpb19hcF9vcHMuYworKysgYi9k
cml2ZXJzL3MzOTAvY3J5cHRvL3ZmaW9fYXBfb3BzLmMKQEAgLTEyOTUsNyArMTI5NSw4IEBAIGlu
dCB2ZmlvX2FwX21kZXZfcmVnaXN0ZXIodm9pZCkKIHsKIAlhdG9taWNfc2V0KCZtYXRyaXhfZGV2
LT5hdmFpbGFibGVfaW5zdGFuY2VzLCBNQVhfWkRFVl9FTlRSSUVTX0VYVCk7CiAKLQlyZXR1cm4g
bWRldl9yZWdpc3Rlcl9kZXZpY2UoJm1hdHJpeF9kZXYtPmRldmljZSwgJnZmaW9fYXBfbWF0cml4
X29wcyk7CisJcmV0dXJuIG1kZXZfcmVnaXN0ZXJfdmZpb19kZXZpY2UoJm1hdHJpeF9kZXYtPmRl
dmljZSwKKwkJCQkJICZ2ZmlvX2FwX21hdHJpeF9vcHMpOwogfQogCiB2b2lkIHZmaW9fYXBfbWRl
dl91bnJlZ2lzdGVyKHZvaWQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZmaW8vbWRldi9tZGV2X2Nv
cmUuYyBiL2RyaXZlcnMvdmZpby9tZGV2L21kZXZfY29yZS5jCmluZGV4IGI1NThkNGNmZDA4Mi4u
YTAyYzI1NmEzNTE0IDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZmaW8vbWRldi9tZGV2X2NvcmUuYwor
KysgYi9kcml2ZXJzL3ZmaW8vbWRldi9tZGV2X2NvcmUuYwpAQCAtMTM1LDExICsxMzUsMTQgQEAg
c3RhdGljIGludCBtZGV2X2RldmljZV9yZW1vdmVfY2Ioc3RydWN0IGRldmljZSAqZGV2LCB2b2lk
ICpkYXRhKQogICogbWRldl9yZWdpc3Rlcl9kZXZpY2UgOiBSZWdpc3RlciBhIGRldmljZQogICog
QGRldjogZGV2aWNlIHN0cnVjdHVyZSByZXByZXNlbnRpbmcgcGFyZW50IGRldmljZS4KICAqIEBv
cHM6IFBhcmVudCBkZXZpY2Ugb3BlcmF0aW9uIHN0cnVjdHVyZSB0byBiZSByZWdpc3RlcmVkLgor
ICogQGlkOiBkZXZpY2UgaWQuCiAgKgogICogQWRkIGRldmljZSB0byBsaXN0IG9mIHJlZ2lzdGVy
ZWQgcGFyZW50IGRldmljZXMuCiAgKiBSZXR1cm5zIGEgbmVnYXRpdmUgdmFsdWUgb24gZXJyb3Is
IG90aGVyd2lzZSAwLgogICovCi1pbnQgbWRldl9yZWdpc3Rlcl9kZXZpY2Uoc3RydWN0IGRldmlj
ZSAqZGV2LCBjb25zdCBzdHJ1Y3QgbWRldl9wYXJlbnRfb3BzICpvcHMpCitpbnQgbWRldl9yZWdp
c3Rlcl9kZXZpY2Uoc3RydWN0IGRldmljZSAqZGV2LAorCQkJIGNvbnN0IHN0cnVjdCBtZGV2X3Bh
cmVudF9vcHMgKm9wcywKKwkJCSB1OCBjbGFzc19pZCkKIHsKIAlpbnQgcmV0OwogCXN0cnVjdCBt
ZGV2X3BhcmVudCAqcGFyZW50OwpAQCAtMTc1LDYgKzE3OCw3IEBAIGludCBtZGV2X3JlZ2lzdGVy
X2RldmljZShzdHJ1Y3QgZGV2aWNlICpkZXYsIGNvbnN0IHN0cnVjdCBtZGV2X3BhcmVudF9vcHMg
Km9wcykKIAogCXBhcmVudC0+ZGV2ID0gZGV2OwogCXBhcmVudC0+b3BzID0gb3BzOworCXBhcmVu
dC0+Y2xhc3NfaWQgPSBjbGFzc19pZDsKIAogCWlmICghbWRldl9idXNfY29tcGF0X2NsYXNzKSB7
CiAJCW1kZXZfYnVzX2NvbXBhdF9jbGFzcyA9IGNsYXNzX2NvbXBhdF9yZWdpc3RlcigibWRldl9i
dXMiKTsKQEAgLTIwOCw3ICsyMTIsMTMgQEAgaW50IG1kZXZfcmVnaXN0ZXJfZGV2aWNlKHN0cnVj
dCBkZXZpY2UgKmRldiwgY29uc3Qgc3RydWN0IG1kZXZfcGFyZW50X29wcyAqb3BzKQogCQlwdXRf
ZGV2aWNlKGRldik7CiAJcmV0dXJuIHJldDsKIH0KLUVYUE9SVF9TWU1CT0wobWRldl9yZWdpc3Rl
cl9kZXZpY2UpOworCitpbnQgbWRldl9yZWdpc3Rlcl92ZmlvX2RldmljZShzdHJ1Y3QgZGV2aWNl
ICpkZXYsCisJCQkgICAgICBjb25zdCBzdHJ1Y3QgbWRldl9wYXJlbnRfb3BzICpvcHMpCit7CisJ
cmV0dXJuIG1kZXZfcmVnaXN0ZXJfZGV2aWNlKGRldiwgb3BzLCBNREVWX0lEX1ZGSU8pOworfQor
RVhQT1JUX1NZTUJPTChtZGV2X3JlZ2lzdGVyX3ZmaW9fZGV2aWNlKTsKIAogLyoKICAqIG1kZXZf
dW5yZWdpc3Rlcl9kZXZpY2UgOiBVbnJlZ2lzdGVyIGEgcGFyZW50IGRldmljZQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy92ZmlvL21kZXYvbWRldl9kcml2ZXIuYyBiL2RyaXZlcnMvdmZpby9tZGV2L21k
ZXZfZHJpdmVyLmMKaW5kZXggMGQzMjIzYWVlMjBiLi5iNzBiYmViYzlkZDMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvdmZpby9tZGV2L21kZXZfZHJpdmVyLmMKKysrIGIvZHJpdmVycy92ZmlvL21kZXYv
bWRldl9kcml2ZXIuYwpAQCAtNjksOCArNjksMjIgQEAgc3RhdGljIGludCBtZGV2X3JlbW92ZShz
dHJ1Y3QgZGV2aWNlICpkZXYpCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgbWRldl9tYXRj
aChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2VfZHJpdmVyICpkcnYpCit7CisJdW5z
aWduZWQgaW50IGk7CisJc3RydWN0IG1kZXZfZGV2aWNlICptZGV2ID0gdG9fbWRldl9kZXZpY2Uo
ZGV2KTsKKwlzdHJ1Y3QgbWRldl9kcml2ZXIgKm1kcnYgPSB0b19tZGV2X2RyaXZlcihkcnYpOwor
CWNvbnN0IHN0cnVjdCBtZGV2X2NsYXNzX2lkICppZHMgPSBtZHJ2LT5pZF90YWJsZTsKKworCWZv
ciAoaSA9IDA7IGlkc1tpXS5pZDsgaSsrKQorCQlpZiAoaWRzW2ldLmlkID09IG1kZXYtPnBhcmVu
dC0+Y2xhc3NfaWQpCisJCQlyZXR1cm4gMTsKKwlyZXR1cm4gMDsKK30KKwogc3RydWN0IGJ1c190
eXBlIG1kZXZfYnVzX3R5cGUgPSB7CiAJLm5hbWUJCT0gIm1kZXYiLAorCS5tYXRjaAkJPSBtZGV2
X21hdGNoLAogCS5wcm9iZQkJPSBtZGV2X3Byb2JlLAogCS5yZW1vdmUJCT0gbWRldl9yZW1vdmUs
CiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy92ZmlvL21kZXYvbWRldl9wcml2YXRlLmggYi9kcml2
ZXJzL3ZmaW8vbWRldi9tZGV2X3ByaXZhdGUuaAppbmRleCA3ZDkyMjk1MGNhYWYuLmU1OGIwN2M4
NjZiMSAxMDA2NDQKLS0tIGEvZHJpdmVycy92ZmlvL21kZXYvbWRldl9wcml2YXRlLmgKKysrIGIv
ZHJpdmVycy92ZmlvL21kZXYvbWRldl9wcml2YXRlLmgKQEAgLTIyLDYgKzIyLDcgQEAgc3RydWN0
IG1kZXZfcGFyZW50IHsKIAlzdHJ1Y3QgbGlzdF9oZWFkIHR5cGVfbGlzdDsKIAkvKiBTeW5jaHJv
bml6ZSBkZXZpY2UgY3JlYXRpb24vcmVtb3ZhbCB3aXRoIHBhcmVudCB1bnJlZ2lzdHJhdGlvbiAq
LwogCXN0cnVjdCByd19zZW1hcGhvcmUgdW5yZWdfc2VtOworCXU4IGNsYXNzX2lkOwogfTsKIAog
c3RydWN0IG1kZXZfZGV2aWNlIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmZpby9tZGV2L3ZmaW9f
bWRldi5jIGIvZHJpdmVycy92ZmlvL21kZXYvdmZpb19tZGV2LmMKaW5kZXggMzA5NjRhNGUwYTI4
Li5mZDJhNGQ5YTNmMjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmZpby9tZGV2L3ZmaW9fbWRldi5j
CisrKyBiL2RyaXZlcnMvdmZpby9tZGV2L3ZmaW9fbWRldi5jCkBAIC0xMjAsMTAgKzEyMCwxNiBA
QCBzdGF0aWMgdm9pZCB2ZmlvX21kZXZfcmVtb3ZlKHN0cnVjdCBkZXZpY2UgKmRldikKIAl2Zmlv
X2RlbF9ncm91cF9kZXYoZGV2KTsKIH0KIAorc3RhdGljIHN0cnVjdCBtZGV2X2NsYXNzX2lkIGlk
X3RhYmxlW10gPSB7CisJeyBNREVWX0lEX1ZGSU8gfSwKKwl7IDAgfSwKK307CisKIHN0YXRpYyBz
dHJ1Y3QgbWRldl9kcml2ZXIgdmZpb19tZGV2X2RyaXZlciA9IHsKIAkubmFtZQk9ICJ2ZmlvX21k
ZXYiLAogCS5wcm9iZQk9IHZmaW9fbWRldl9wcm9iZSwKIAkucmVtb3ZlCT0gdmZpb19tZGV2X3Jl
bW92ZSwKKwkuaWRfdGFibGUgPSBpZF90YWJsZSwKIH07CiAKIHN0YXRpYyBpbnQgX19pbml0IHZm
aW9fbWRldl9pbml0KHZvaWQpCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21kZXYuaCBiL2lu
Y2x1ZGUvbGludXgvbWRldi5oCmluZGV4IDBjZTMwY2E3OGRiMC4uYmIwYTc0M2U1YTAzIDEwMDY0
NAotLS0gYS9pbmNsdWRlL2xpbnV4L21kZXYuaAorKysgYi9pbmNsdWRlL2xpbnV4L21kZXYuaApA
QCAtMTE4LDYgKzExOCw3IEBAIHN0cnVjdCBtZGV2X3R5cGVfYXR0cmlidXRlIG1kZXZfdHlwZV9h
dHRyXyMjX25hbWUgPQkJXAogICogQHByb2JlOiBjYWxsZWQgd2hlbiBuZXcgZGV2aWNlIGNyZWF0
ZWQKICAqIEByZW1vdmU6IGNhbGxlZCB3aGVuIGRldmljZSByZW1vdmVkCiAgKiBAZHJpdmVyOiBk
ZXZpY2UgZHJpdmVyIHN0cnVjdHVyZQorICogQGlkX3RhYmxlOiB0aGUgaWRzIHNlcnZpY2VkIGJ5
IHRoaXMgZHJpdmVyLgogICoKICAqKi8KIHN0cnVjdCBtZGV2X2RyaXZlciB7CkBAIC0xMjUsNiAr
MTI2LDcgQEAgc3RydWN0IG1kZXZfZHJpdmVyIHsKIAlpbnQgICgqcHJvYmUpKHN0cnVjdCBkZXZp
Y2UgKmRldik7CiAJdm9pZCAoKnJlbW92ZSkoc3RydWN0IGRldmljZSAqZGV2KTsKIAlzdHJ1Y3Qg
ZGV2aWNlX2RyaXZlciBkcml2ZXI7CisJY29uc3Qgc3RydWN0IG1kZXZfY2xhc3NfaWQgKmlkX3Rh
YmxlOwogfTsKIAogI2RlZmluZSB0b19tZGV2X2RyaXZlcihkcnYpCWNvbnRhaW5lcl9vZihkcnYs
IHN0cnVjdCBtZGV2X2RyaXZlciwgZHJpdmVyKQpAQCAtMTM1LDcgKzEzNyw3IEBAIGNvbnN0IGd1
aWRfdCAqbWRldl91dWlkKHN0cnVjdCBtZGV2X2RldmljZSAqbWRldik7CiAKIGV4dGVybiBzdHJ1
Y3QgYnVzX3R5cGUgbWRldl9idXNfdHlwZTsKIAotaW50IG1kZXZfcmVnaXN0ZXJfZGV2aWNlKHN0
cnVjdCBkZXZpY2UgKmRldiwgY29uc3Qgc3RydWN0IG1kZXZfcGFyZW50X29wcyAqb3BzKTsKK2lu
dCBtZGV2X3JlZ2lzdGVyX3ZmaW9fZGV2aWNlKHN0cnVjdCBkZXZpY2UgKmRldiwgY29uc3Qgc3Ry
dWN0IG1kZXZfcGFyZW50X29wcyAqb3BzKTsKIHZvaWQgbWRldl91bnJlZ2lzdGVyX2RldmljZShz
dHJ1Y3QgZGV2aWNlICpkZXYpOwogCiBpbnQgbWRldl9yZWdpc3Rlcl9kcml2ZXIoc3RydWN0IG1k
ZXZfZHJpdmVyICpkcnYsIHN0cnVjdCBtb2R1bGUgKm93bmVyKTsKQEAgLTE0NSw0ICsxNDcsNiBA
QCBzdHJ1Y3QgZGV2aWNlICptZGV2X3BhcmVudF9kZXYoc3RydWN0IG1kZXZfZGV2aWNlICptZGV2
KTsKIHN0cnVjdCBkZXZpY2UgKm1kZXZfZGV2KHN0cnVjdCBtZGV2X2RldmljZSAqbWRldik7CiBz
dHJ1Y3QgbWRldl9kZXZpY2UgKm1kZXZfZnJvbV9kZXYoc3RydWN0IGRldmljZSAqZGV2KTsKIAor
I2RlZmluZSBNREVWX0lEX1ZGSU8gMSAvKiBWRklPIGRldmljZSAqLworCiAjZW5kaWYgLyogTURF
Vl9IICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L21vZF9kZXZpY2V0YWJsZS5oIGIvaW5j
bHVkZS9saW51eC9tb2RfZGV2aWNldGFibGUuaAppbmRleCA1NzE0ZmQzNWE4M2MuLjQ2MWQzMzY1
ZDhkMyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9tb2RfZGV2aWNldGFibGUuaAorKysgYi9p
bmNsdWRlL2xpbnV4L21vZF9kZXZpY2V0YWJsZS5oCkBAIC04MjEsNCArODIxLDEyIEBAIHN0cnVj
dCB3bWlfZGV2aWNlX2lkIHsKIAljb25zdCB2b2lkICpjb250ZXh0OwogfTsKIAorLyoqCisgKiBz
dHJ1Y3QgbWRldl9jbGFzc19pZCAtIE1ERVYgZGV2aWNlIGNsYXNzIGlkZW50aWZpZXIKKyAqIEBp
ZDogVXNlZCB0byBpZGVudGlmeSBhIHNwZWNpZmljIGNsYXNzIG9mIGRldmljZSwgZS5nIHZmaW8t
bWRldiBkZXZpY2UuCisgKi8KK3N0cnVjdCBtZGV2X2NsYXNzX2lkIHsKKwlfX3U4IGlkOworfTsK
KwogI2VuZGlmIC8qIExJTlVYX01PRF9ERVZJQ0VUQUJMRV9IICovCmRpZmYgLS1naXQgYS9zYW1w
bGVzL3ZmaW8tbWRldi9tYm9jaHMuYyBiL3NhbXBsZXMvdmZpby1tZGV2L21ib2Nocy5jCmluZGV4
IGFjNWM4YzE3YjFmZi4uNzFhNDQ2OWJlODVkIDEwMDY0NAotLS0gYS9zYW1wbGVzL3ZmaW8tbWRl
di9tYm9jaHMuYworKysgYi9zYW1wbGVzL3ZmaW8tbWRldi9tYm9jaHMuYwpAQCAtMTQ2OCw3ICsx
NDY4LDcgQEAgc3RhdGljIGludCBfX2luaXQgbWJvY2hzX2Rldl9pbml0KHZvaWQpCiAJaWYgKHJl
dCkKIAkJZ290byBmYWlsZWQyOwogCi0JcmV0ID0gbWRldl9yZWdpc3Rlcl9kZXZpY2UoJm1ib2No
c19kZXYsICZtZGV2X2ZvcHMpOworCXJldCA9IG1kZXZfcmVnaXN0ZXJfdmZpb19kZXZpY2UoJm1i
b2Noc19kZXYsICZtZGV2X2ZvcHMpOwogCWlmIChyZXQpCiAJCWdvdG8gZmFpbGVkMzsKIApkaWZm
IC0tZ2l0IGEvc2FtcGxlcy92ZmlvLW1kZXYvbWRweS5jIGIvc2FtcGxlcy92ZmlvLW1kZXYvbWRw
eS5jCmluZGV4IGNjODZiZjY1NjZlNC4uZDMwMjlkZDI3ZDkxIDEwMDY0NAotLS0gYS9zYW1wbGVz
L3ZmaW8tbWRldi9tZHB5LmMKKysrIGIvc2FtcGxlcy92ZmlvLW1kZXYvbWRweS5jCkBAIC03NzUs
NyArNzc1LDcgQEAgc3RhdGljIGludCBfX2luaXQgbWRweV9kZXZfaW5pdCh2b2lkKQogCWlmIChy
ZXQpCiAJCWdvdG8gZmFpbGVkMjsKIAotCXJldCA9IG1kZXZfcmVnaXN0ZXJfZGV2aWNlKCZtZHB5
X2RldiwgJm1kZXZfZm9wcyk7CisJcmV0ID0gbWRldl9yZWdpc3Rlcl92ZmlvX2RldmljZSgmbWRw
eV9kZXYsICZtZGV2X2ZvcHMpOwogCWlmIChyZXQpCiAJCWdvdG8gZmFpbGVkMzsKIApkaWZmIC0t
Z2l0IGEvc2FtcGxlcy92ZmlvLW1kZXYvbXR0eS5jIGIvc2FtcGxlcy92ZmlvLW1kZXYvbXR0eS5j
CmluZGV4IDkyZTc3MGEwNmVhMi4uNzQ0Yzg4YTZiMjJjIDEwMDY0NAotLS0gYS9zYW1wbGVzL3Zm
aW8tbWRldi9tdHR5LmMKKysrIGIvc2FtcGxlcy92ZmlvLW1kZXYvbXR0eS5jCkBAIC0xNDY4LDcg
KzE0NjgsNyBAQCBzdGF0aWMgaW50IF9faW5pdCBtdHR5X2Rldl9pbml0KHZvaWQpCiAJaWYgKHJl
dCkKIAkJZ290byBmYWlsZWQyOwogCi0JcmV0ID0gbWRldl9yZWdpc3Rlcl9kZXZpY2UoJm10dHlf
ZGV2LmRldiwgJm1kZXZfZm9wcyk7CisJcmV0ID0gbWRldl9yZWdpc3Rlcl92ZmlvX2RldmljZSgm
bXR0eV9kZXYuZGV2LCAmbWRldl9mb3BzKTsKIAlpZiAocmV0KQogCQlnb3RvIGZhaWxlZDM7CiAK
LS0gCjIuMTkuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
