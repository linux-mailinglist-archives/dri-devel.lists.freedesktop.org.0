Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2849819C7A9
	for <lists+dri-devel@lfdr.de>; Thu,  2 Apr 2020 19:09:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C2E666EACB;
	Thu,  2 Apr 2020 17:09:47 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 04E8D6EA85
 for <dri-devel@lists.freedesktop.org>; Thu,  2 Apr 2020 17:09:46 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: bbeckett) with ESMTPSA id B26FC297E46
From: Robert Beckett <bob.beckett@collabora.com>
To: Lucas Stach <l.stach@pengutronix.de>,
 Russell King <linux+etnaviv@armlinux.org.uk>,
 Christian Gmeiner <christian.gmeiner@gmail.com>,
 David Airlie <airlied@linux.ie>
Subject: [PATCH v4.19.y] drm/etnaviv: replace MMU flush marker with flush
 sequence
Date: Thu,  2 Apr 2020 18:07:58 +0100
Message-Id: <20200402170758.8315-3-bob.beckett@collabora.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200402170758.8315-1-bob.beckett@collabora.com>
References: <20200402170758.8315-1-bob.beckett@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: bob.beckett@collabora.com
Cc: Robert Beckett <bob.beckett@collabora.com>,
 =?UTF-8?q?Guido=20G=C3=BCnther?= <agx@sigxcpu.org>,
 linux-kernel@vger.kernel.org, stable@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTHVjYXMgU3RhY2ggPGwuc3RhY2hAcGVuZ3V0cm9uaXguZGU+Cgpjb21taXQgNDkwMGRk
YTkwYWYyY2IxM2JjMWQ0YzEyY2U5NGI5OGFjYzhmZTY0ZSB1cHN0cmVhbQoKSWYgYSBNTVUgaXMg
c2hhcmVkIGJldHdlZW4gbXVsdGlwbGUgR1BVcywgYWxsIG9mIHRoZW0gbmVlZCB0byBmbHVzaCB0
aGVpcgpUTEJzLCBzbyBhIHNpbmdsZSBtYXJrZXIgdGhhdCBnZXRzIHJlc2V0IG9uIHRoZSBmaXJz
dCBmbHVzaCB3b24ndCBkby4KUmVwbGFjZSB0aGUgZmx1c2ggbWFya2VyIHdpdGggYSBzZXF1ZW5j
ZSBudW1iZXIsIHNvIHRoYXQgaXQncyBwb3NzaWJsZSB0bwpjaGVjayBpZiB0aGUgVExCIGlzIGlu
IHN5bmMgd2l0aCB0aGUgY3VycmVudCBwYWdlIHRhYmxlIHN0YXRlIGZvciBlYWNoIEdQVS4KClNp
Z25lZC1vZmYtYnk6IEx1Y2FzIFN0YWNoIDxsLnN0YWNoQHBlbmd1dHJvbml4LmRlPgpSZXZpZXdl
ZC1ieTogUGhpbGlwcCBaYWJlbCA8cC56YWJlbEBwZW5ndXRyb25peC5kZT4KUmV2aWV3ZWQtYnk6
IEd1aWRvIEfDvG50aGVyIDxhZ3hAc2lneGNwdS5vcmc+ClNpZ25lZC1vZmYtYnk6IFJvYmVydCBC
ZWNrZXR0IDxib2IuYmVja2V0dEBjb2xsYWJvcmEuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfYnVmZmVyLmMgfCAxMCArKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X2dwdS5oICAgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYv
ZXRuYXZpdl9tbXUuYyAgICB8ICA2ICsrKy0tLQogZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRu
YXZpdl9tbXUuaCAgICB8ICAyICstCiA0IGZpbGVzIGNoYW5nZWQsIDExIGluc2VydGlvbnMoKyks
IDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRu
YXZpdl9idWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfYnVmZmVyLmMK
aW5kZXggN2ZlYTc0ODYxYTg3Li5jODM2NTViMDA4YjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9ldG5hdml2L2V0bmF2aXZfYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2
aXYvZXRuYXZpdl9idWZmZXIuYwpAQCAtMzExLDYgKzMxMSw4IEBAIHZvaWQgZXRuYXZpdl9idWZm
ZXJfcXVldWUoc3RydWN0IGV0bmF2aXZfZ3B1ICpncHUsIHUzMiBleGVjX3N0YXRlLAogCXUzMiBy
ZXR1cm5fdGFyZ2V0LCByZXR1cm5fZHdvcmRzOwogCXUzMiBsaW5rX3RhcmdldCwgbGlua19kd29y
ZHM7CiAJYm9vbCBzd2l0Y2hfY29udGV4dCA9IGdwdS0+ZXhlY19zdGF0ZSAhPSBleGVjX3N0YXRl
OworCXVuc2lnbmVkIGludCBuZXdfZmx1c2hfc2VxID0gUkVBRF9PTkNFKGdwdS0+bW11LT5mbHVz
aF9zZXEpOworCWJvb2wgbmVlZF9mbHVzaCA9IGdwdS0+Zmx1c2hfc2VxICE9IG5ld19mbHVzaF9z
ZXE7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZncHUtPmxvY2spOwogCkBAIC0zMjUsMTQgKzMy
NywxNCBAQCB2b2lkIGV0bmF2aXZfYnVmZmVyX3F1ZXVlKHN0cnVjdCBldG5hdml2X2dwdSAqZ3B1
LCB1MzIgZXhlY19zdGF0ZSwKIAkgKiBuZWVkIHRvIGFwcGVuZCBhIG1tdSBmbHVzaCBsb2FkIHN0
YXRlLCBmb2xsb3dlZCBieSBhIG5ldwogCSAqIGxpbmsgdG8gdGhpcyBidWZmZXIgLSBhIHRvdGFs
IG9mIGZvdXIgYWRkaXRpb25hbCB3b3Jkcy4KIAkgKi8KLQlpZiAoZ3B1LT5tbXUtPm5lZWRfZmx1
c2ggfHwgc3dpdGNoX2NvbnRleHQpIHsKKwlpZiAobmVlZF9mbHVzaCB8fCBzd2l0Y2hfY29udGV4
dCkgewogCQl1MzIgdGFyZ2V0LCBleHRyYV9kd29yZHM7CiAKIAkJLyogbGluayBjb21tYW5kICov
CiAJCWV4dHJhX2R3b3JkcyA9IDE7CiAKIAkJLyogZmx1c2ggY29tbWFuZCAqLwotCQlpZiAoZ3B1
LT5tbXUtPm5lZWRfZmx1c2gpIHsKKwkJaWYgKG5lZWRfZmx1c2gpIHsKIAkJCWlmIChncHUtPm1t
dS0+dmVyc2lvbiA9PSBFVE5BVklWX0lPTU1VX1YxKQogCQkJCWV4dHJhX2R3b3JkcyArPSAxOwog
CQkJZWxzZQpAQCAtMzQ1LDcgKzM0Nyw3IEBAIHZvaWQgZXRuYXZpdl9idWZmZXJfcXVldWUoc3Ry
dWN0IGV0bmF2aXZfZ3B1ICpncHUsIHUzMiBleGVjX3N0YXRlLAogCiAJCXRhcmdldCA9IGV0bmF2
aXZfYnVmZmVyX3Jlc2VydmUoZ3B1LCBidWZmZXIsIGV4dHJhX2R3b3Jkcyk7CiAKLQkJaWYgKGdw
dS0+bW11LT5uZWVkX2ZsdXNoKSB7CisJCWlmIChuZWVkX2ZsdXNoKSB7CiAJCQkvKiBBZGQgdGhl
IE1NVSBmbHVzaCAqLwogCQkJaWYgKGdwdS0+bW11LT52ZXJzaW9uID09IEVUTkFWSVZfSU9NTVVf
VjEpIHsKIAkJCQlDTURfTE9BRF9TVEFURShidWZmZXIsIFZJVlNfR0xfRkxVU0hfTU1VLApAQCAt
MzY1LDcgKzM2Nyw3IEBAIHZvaWQgZXRuYXZpdl9idWZmZXJfcXVldWUoc3RydWN0IGV0bmF2aXZf
Z3B1ICpncHUsIHUzMiBleGVjX3N0YXRlLAogCQkJCQlTWU5DX1JFQ0lQSUVOVF9QRSk7CiAJCQl9
CiAKLQkJCWdwdS0+bW11LT5uZWVkX2ZsdXNoID0gZmFsc2U7CisJCQlncHUtPmZsdXNoX3NlcSA9
IG5ld19mbHVzaF9zZXE7CiAJCX0KIAogCQlpZiAoc3dpdGNoX2NvbnRleHQpIHsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1LmggYi9kcml2ZXJzL2dwdS9k
cm0vZXRuYXZpdi9ldG5hdml2X2dwdS5oCmluZGV4IDkwZjE3ZmY3ODg4ZS4uNGVmYzQ1MzA0ZGNl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1LmgKQEAgLTEzOSw2ICsxMzksNyBA
QCBzdHJ1Y3QgZXRuYXZpdl9ncHUgewogCiAJc3RydWN0IGV0bmF2aXZfaW9tbXUgKm1tdTsKIAlz
dHJ1Y3QgZXRuYXZpdl9jbWRidWZfc3ViYWxsb2MgKmNtZGJ1Zl9zdWJhbGxvYzsKKwl1bnNpZ25l
ZCBpbnQgZmx1c2hfc2VxOwogCiAJLyogUG93ZXIgQ29udHJvbDogKi8KIAlzdHJ1Y3QgY2xrICpj
bGtfYnVzOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9tbXUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfbW11LmMKaW5kZXggODA2OWY5ZjM2
YTJlLi5lMTMyZGNjZWRmODggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0
bmF2aXZfbW11LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9tbXUuYwpA
QCAtMjYxLDcgKzI2MSw3IEBAIGludCBldG5hdml2X2lvbW11X21hcF9nZW0oc3RydWN0IGV0bmF2
aXZfaW9tbXUgKm1tdSwKIAl9CiAKIAlsaXN0X2FkZF90YWlsKCZtYXBwaW5nLT5tbXVfbm9kZSwg
Jm1tdS0+bWFwcGluZ3MpOwotCW1tdS0+bmVlZF9mbHVzaCA9IHRydWU7CisJbW11LT5mbHVzaF9z
ZXErKzsKIHVubG9jazoKIAltdXRleF91bmxvY2soJm1tdS0+bG9jayk7CiAKQEAgLTI4MCw3ICsy
ODAsNyBAQCB2b2lkIGV0bmF2aXZfaW9tbXVfdW5tYXBfZ2VtKHN0cnVjdCBldG5hdml2X2lvbW11
ICptbXUsCiAJCWV0bmF2aXZfaW9tbXVfcmVtb3ZlX21hcHBpbmcobW11LCBtYXBwaW5nKTsKIAog
CWxpc3RfZGVsKCZtYXBwaW5nLT5tbXVfbm9kZSk7Ci0JbW11LT5uZWVkX2ZsdXNoID0gdHJ1ZTsK
KwltbXUtPmZsdXNoX3NlcSsrOwogCW11dGV4X3VubG9jaygmbW11LT5sb2NrKTsKIH0KIApAQCAt
MzU3LDcgKzM1Nyw3IEBAIGludCBldG5hdml2X2lvbW11X2dldF9zdWJhbGxvY192YShzdHJ1Y3Qg
ZXRuYXZpdl9ncHUgKmdwdSwgZG1hX2FkZHJfdCBwYWRkciwKIAkJCW11dGV4X3VubG9jaygmbW11
LT5sb2NrKTsKIAkJCXJldHVybiByZXQ7CiAJCX0KLQkJZ3B1LT5tbXUtPm5lZWRfZmx1c2ggPSB0
cnVlOworCQltbXUtPmZsdXNoX3NlcSsrOwogCQltdXRleF91bmxvY2soJm1tdS0+bG9jayk7CiAK
IAkJKmlvdmEgPSAodTMyKXZyYW1fbm9kZS0+c3RhcnQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vZXRuYXZpdi9ldG5hdml2X21tdS5oIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRu
YXZpdl9tbXUuaAppbmRleCBhMGRiMTdmZmI2ODYuLjM0OGE5NGQ5Njk1YiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9tbXUuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vZXRuYXZpdi9ldG5hdml2X21tdS5oCkBAIC00OCw3ICs0OCw3IEBAIHN0cnVjdCBldG5hdml2
X2lvbW11IHsKIAlzdHJ1Y3QgbXV0ZXggbG9jazsKIAlzdHJ1Y3QgbGlzdF9oZWFkIG1hcHBpbmdz
OwogCXN0cnVjdCBkcm1fbW0gbW07Ci0JYm9vbCBuZWVkX2ZsdXNoOworCXVuc2lnbmVkIGludCBm
bHVzaF9zZXE7CiB9OwogCiBzdHJ1Y3QgZXRuYXZpdl9nZW1fb2JqZWN0OwotLSAKMi4yMC4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
