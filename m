Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 61500D903D
	for <lists+dri-devel@lfdr.de>; Wed, 16 Oct 2019 13:59:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6B1B76E958;
	Wed, 16 Oct 2019 11:59:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 82B4F6E958
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Oct 2019 11:59:35 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id o18so27673962wrv.13
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Oct 2019 04:59:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=kVkr12Iu2+4HR1jUPEdlO1s6WuDU7ymBLcZKRk/pgz4=;
 b=AEcu8XJ9GMyUVilYc5AAdjv0OVzMi9huWNneKnxW6w3cOSf6ZvO77rWGBUEhC3UayJ
 WaPS+Hp4+7XCqAd/j7RYPMOo3O8P6nGHQms3wmIDVyaB57ZN+mUUVeupOYS4PUclChkJ
 ucYqjUjwTxvVsoN3mGHUuNkvh0zkaKanT8iD1GIpWpM8PY3PeI7yCKuDzKr4fwebUSUF
 iID+zMhHyubQohr6ZBlSMSinVNCktu0kJ5ChrnmHVdhvZ9Y4hWJAyk9cgj8GpwnwM9rX
 glSgp6WkDcDhMw6KYT8QtZHKyHDB+5VeDh0EbVqDAkeX1Mqx3kneh0Zsv7kM7vQ8YvSH
 ptsQ==
X-Gm-Message-State: APjAAAXPisYX4tBt3BPFW2hYchqC7EBImCqvV4ZKYJJjC+K973KKCCJn
 7FUJI9uevVyj73JJH4U7tj0=
X-Google-Smtp-Source: APXvYqyBFn3mgtlzZaAIPD98gDJqh42kWj5iMTnm1Rw/q0LvIegCwJmB6W2/MsVikMnIFpxXO0I/iw==
X-Received: by 2002:a5d:4a87:: with SMTP id o7mr2499176wrq.374.1571227173853; 
 Wed, 16 Oct 2019 04:59:33 -0700 (PDT)
Received: from localhost (p2E5BE2CE.dip0.t-ipconnect.de. [46.91.226.206])
 by smtp.gmail.com with ESMTPSA id a192sm2592264wma.1.2019.10.16.04.59.32
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 16 Oct 2019 04:59:32 -0700 (PDT)
From: Thierry Reding <thierry.reding@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH 8/8] drm/tegra: Optionally attach clients to the IOMMU
Date: Wed, 16 Oct 2019 13:59:16 +0200
Message-Id: <20191016115916.1769133-8-thierry.reding@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191016115916.1769133-1-thierry.reding@gmail.com>
References: <20191016115916.1769133-1-thierry.reding@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=kVkr12Iu2+4HR1jUPEdlO1s6WuDU7ymBLcZKRk/pgz4=;
 b=kGVvDey63eygtoV9TJkCe7bt9HyHEwZa7Eotj9VAgdJD3u8KDU/3SXqZKS8O4HOpLs
 PZAAMEWraxW/ddbypXqUu1bfhDWQ763gOfU64vF0uqYUfwSVYykALQ7SSRsOoCzLf4V2
 JSLuj9ojtATP7fkicQOq02cdcumy1z5dmMMLw70nre8nmShqhgiFfAhckX1fK5SONbrE
 XEf5uFBe8NIxn7CnElg/L1Q8z1P3gYsU2swcGLFN8toHbMGKfobvX7hlXD0Bo4NrTeTd
 8IRMzkSWjayNOnFNqkme5m3hYStbYB6MbrReC/dCEiOfDGEdgOQFTf5cHSht8QLzsrw3
 MNag==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlhLmNvbT4KCklmIGEgY2xpZW50IGlz
IGFscmVhZHkgYXR0YWNoZWQgdG8gYW4gSU9NTVUgZG9tYWluIHRoYXQgaXMgbm90IHRoZQpzaGFy
ZWQgZG9tYWluLCBkb24ndCB0cnkgdG8gYXR0YWNoIGl0IGFnYWluLiBUaGlzIGFsbG93cyB1c2lu
ZyB0aGUKSU9NTVUtYmFja2VkIERNQSBBUEkuCgpTaW5jZSB0aGUgSU9NTVUtYmFja2VkIERNQSBB
UEkgaXMgbm93IHN1cHBvcnRlZCBhbmQgdGhlcmUncyBubyB3YXkKdG8gZGV0YWNoIGZyb20gaXQg
b24gNjQtYml0IEFSTSwgZG9uJ3QgYm90aGVyIHRvIGRldGFjaCBmcm9tIGl0IG9uCjMyLWJpdCBB
Uk0gZWl0aGVyLgoKU2lnbmVkLW9mZi1ieTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlh
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMgfCA1NSArKysrKysrKysrKysr
KysrKysrKysrKysrKystLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygr
KSwgMTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2Ry
bS5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5jCmluZGV4IDk1OTA4NjY0NGI1Mi4uMzAx
MmYxM2JhYjk3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5jCkBAIC0yMCwxMCArMjAsNiBAQAogI2luY2x1ZGUg
PGRybS9kcm1fcHJpbWUuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgogCi0jaWYgSVNf
RU5BQkxFRChDT05GSUdfQVJNX0RNQV9VU0VfSU9NTVUpCi0jaW5jbHVkZSA8YXNtL2RtYS1pb21t
dS5oPgotI2VuZGlmCi0KICNpbmNsdWRlICJkcm0uaCIKICNpbmNsdWRlICJnZW0uaCIKIApAQCAt
ODksNiArODUsNyBAQCB0ZWdyYV9kcm1fbW9kZV9jb25maWdfaGVscGVycyA9IHsKIHN0YXRpYyBp
bnQgdGVncmFfZHJtX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwgdW5zaWduZWQgbG9uZyBm
bGFncykKIHsKIAlzdHJ1Y3QgaG9zdDF4X2RldmljZSAqZGV2aWNlID0gdG9faG9zdDF4X2Rldmlj
ZShkcm0tPmRldik7CisJc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluOwogCXN0cnVjdCB0ZWdy
YV9kcm0gKnRlZ3JhOwogCWludCBlcnI7CiAKQEAgLTk2LDcgKzkzLDM2IEBAIHN0YXRpYyBpbnQg
dGVncmFfZHJtX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwgdW5zaWduZWQgbG9uZyBmbGFn
cykKIAlpZiAoIXRlZ3JhKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmIChpb21tdV9wcmVzZW50
KCZwbGF0Zm9ybV9idXNfdHlwZSkpIHsKKwkvKgorCSAqIElmIHRoZSBUZWdyYSBEUk0gY2xpZW50
cyBhcmUgYmFja2VkIGJ5IGFuIElPTU1VLCBwdXNoIGJ1ZmZlcnMgYXJlCisJICogbGlrZWx5IHRv
IGJlIGFsbG9jYXRlZCBiZXlvbmQgdGhlIDMyLWJpdCBib3VuZGFyeSBpZiBzdWZmaWNpZW50CisJ
ICogc3lzdGVtIG1lbW9yeSBpcyBhdmFpbGFibGUuIFRoaXMgaXMgcHJvYmxlbWF0aWMgb24gZWFy
bGllciBUZWdyYQorCSAqIGdlbmVyYXRpb25zIHdoZXJlIGhvc3QxeCBzdXBwb3J0cyBhIG1heGlt
dW0gb2YgMzIgYWRkcmVzcyBiaXRzIGluCisJICogdGhlIEdBVEhFUiBvcGNvZGUuIEluIHRoaXMg
Y2FzZSwgdW5sZXNzIGhvc3QxeCBpcyBiZWhpbmQgYW4gSU9NTVUKKwkgKiBhcyB3ZWxsIGl0IHdv
bid0IGJlIGFibGUgdG8gcHJvY2VzcyBidWZmZXJzIGFsbG9jYXRlZCBiZXlvbmQgdGhlCisJICog
MzItYml0IGJvdW5kYXJ5LgorCSAqCisJICogVGhlIERNQSBBUEkgd2lsbCB1c2UgYm91bmNlIGJ1
ZmZlcnMgaW4gdGhpcyBjYXNlLCBzbyB0aGF0IGNvdWxkCisJICogcGVyaGFwcyBzdGlsbCBiZSBt
YWRlIHRvIHdvcmssIGV2ZW4gaWYgbGVzcyBlZmZpY2llbnQsIGJ1dCB0aGVyZQorCSAqIGlzIGFu
b3RoZXIgY2F0Y2g6IGluIG9yZGVyIHRvIHBlcmZvcm0gY2FjaGUgbWFpbnRlbmFuY2Ugb24gcGFn
ZXMKKwkgKiBhbGxvY2F0ZWQgZm9yIGRpc2NvbnRpZ3VvdXMgYnVmZmVycyB3ZSBuZWVkIHRvIG1h
cCBhbmQgdW5tYXAgdGhlCisJICogU0cgdGFibGUgcmVwcmVzZW50aW5nIHRoZXNlIGJ1ZmZlcnMu
IFRoaXMgaXMgZmluZSBmb3Igc29tZXRoaW5nCisJICogc21hbGwgbGlrZSBhIHB1c2ggYnVmZmVy
LCBidXQgaXQgZXhoYXVzdHMgdGhlIGJvdW5jZSBidWZmZXIgcG9vbAorCSAqICh0eXBpY2FsbHkg
b24gdGhlIG9yZGVyIG9mIGEgZmV3IE1pQikgZm9yIGZyYW1lYnVmZmVycyAobWFueSBNaUIKKwkg
KiBmb3IgYW55IG1vZGVybiByZXNvbHV0aW9uKS4KKwkgKgorCSAqIFdvcmsgYXJvdW5kIHRoaXMg
YnkgbWFraW5nIHN1cmUgdGhhdCBUZWdyYSBEUk0gY2xpZW50cyBvbmx5IHVzZQorCSAqIGFuIElP
TU1VIGlmIHRoZSBwYXJlbnQgaG9zdDF4IGFsc28gdXNlcyBhbiBJT01NVS4KKwkgKgorCSAqIE5v
dGUgdGhhdCB0aGVyZSdzIHN0aWxsIGEgc21hbGwgZ2FwIGhlcmUgdGhhdCB3ZSBkb24ndCBjb3Zl
cjogaWYKKwkgKiB0aGUgRE1BIEFQSSBpcyBiYWNrZWQgYnkgYW4gSU9NTVUgdGhlcmUncyBubyB3
YXkgdG8gY29udHJvbCB3aGljaAorCSAqIGRldmljZSBpcyBhdHRhY2hlZCB0byBhbiBJT01NVSBh
bmQgd2hpY2ggaXNuJ3QsIGV4Y2VwdCB2aWEgd2lyaW5nCisJICogdXAgdGhlIGRldmljZSB0cmVl
IGFwcHJvcHJpYXRlbHkuIFRoaXMgaXMgY29uc2lkZXJlZCBhbiBwcm9ibGVtCisJICogb2YgaW50
ZWdyYXRpb24sIHNvIGNhcmUgbXVzdCBiZSB0YWtlbiBmb3IgdGhlIERUIHRvIGJlIGNvbnNpc3Rl
bnQuCisJICovCisJZG9tYWluID0gaW9tbXVfZ2V0X2RvbWFpbl9mb3JfZGV2KGRybS0+ZGV2LT5w
YXJlbnQpOworCisJaWYgKGRvbWFpbiAmJiBpb21tdV9wcmVzZW50KCZwbGF0Zm9ybV9idXNfdHlw
ZSkpIHsKIAkJdGVncmEtPmRvbWFpbiA9IGlvbW11X2RvbWFpbl9hbGxvYygmcGxhdGZvcm1fYnVz
X3R5cGUpOwogCQlpZiAoIXRlZ3JhLT5kb21haW4pIHsKIAkJCWVyciA9IC1FTk9NRU07CkBAIC0x
MzksNyArMTY1LDcgQEAgc3RhdGljIGludCB0ZWdyYV9kcm1fbG9hZChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZHJtLCB1bnNpZ25lZCBsb25nIGZsYWdzKQogCWlmIChlcnIgPCAwKQogCQlnb3RvIGZiZGV2
OwogCi0JaWYgKHRlZ3JhLT5kb21haW4pIHsKKwlpZiAodGVncmEtPmdyb3VwKSB7CiAJCXU2NCBj
YXJ2ZW91dF9zdGFydCwgY2FydmVvdXRfZW5kLCBnZW1fc3RhcnQsIGdlbV9lbmQ7CiAJCXU2NCBk
bWFfbWFzayA9IGRtYV9nZXRfbWFzaygmZGV2aWNlLT5kZXYpOwogCQlkbWFfYWRkcl90IHN0YXJ0
LCBlbmQ7CkBAIC0xNjcsNiArMTkzLDEwIEBAIHN0YXRpYyBpbnQgdGVncmFfZHJtX2xvYWQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRybSwgdW5zaWduZWQgbG9uZyBmbGFncykKIAkJRFJNX0RFQlVHX0RS
SVZFUigiICBHRU06ICUjbGx4LSUjbGx4XG4iLCBnZW1fc3RhcnQsIGdlbV9lbmQpOwogCQlEUk1f
REVCVUdfRFJJVkVSKCIgIENhcnZlb3V0OiAlI2xseC0lI2xseFxuIiwgY2FydmVvdXRfc3RhcnQs
CiAJCQkJIGNhcnZlb3V0X2VuZCk7CisJfSBlbHNlIGlmICh0ZWdyYS0+ZG9tYWluKSB7CisJCWlv
bW11X2RvbWFpbl9mcmVlKHRlZ3JhLT5kb21haW4pOworCQl0ZWdyYS0+ZG9tYWluID0gTlVMTDsK
KwkJaW92YV9jYWNoZV9wdXQoKTsKIAl9CiAKIAlpZiAodGVncmEtPmh1YikgewpAQCAtMTA3Miwx
MSArMTEwMiwxNSBAQCBpbnQgdGVncmFfZHJtX3VucmVnaXN0ZXJfY2xpZW50KHN0cnVjdCB0ZWdy
YV9kcm0gKnRlZ3JhLAogCiBpbnQgaG9zdDF4X2NsaWVudF9pb21tdV9hdHRhY2goc3RydWN0IGhv
c3QxeF9jbGllbnQgKmNsaWVudCwgYm9vbCBzaGFyZWQpCiB7CisJc3RydWN0IGlvbW11X2RvbWFp
biAqZG9tYWluID0gaW9tbXVfZ2V0X2RvbWFpbl9mb3JfZGV2KGNsaWVudC0+ZGV2KTsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZHJtID0gZGV2X2dldF9kcnZkYXRhKGNsaWVudC0+cGFyZW50KTsKIAlz
dHJ1Y3QgdGVncmFfZHJtICp0ZWdyYSA9IGRybS0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGlvbW11
X2dyb3VwICpncm91cCA9IE5VTEw7CiAJaW50IGVycjsKIAorCWlmIChkb21haW4gJiYgZG9tYWlu
ICE9IHRlZ3JhLT5kb21haW4pCisJCXJldHVybiAwOworCiAJaWYgKHRlZ3JhLT5kb21haW4pIHsK
IAkJZ3JvdXAgPSBpb21tdV9ncm91cF9nZXQoY2xpZW50LT5kZXYpOwogCQlpZiAoIWdyb3VwKSB7
CkBAIC0xMDg1LDE0ICsxMTE5LDYgQEAgaW50IGhvc3QxeF9jbGllbnRfaW9tbXVfYXR0YWNoKHN0
cnVjdCBob3N0MXhfY2xpZW50ICpjbGllbnQsIGJvb2wgc2hhcmVkKQogCQl9CiAKIAkJaWYgKCFz
aGFyZWQgfHwgKHNoYXJlZCAmJiAoZ3JvdXAgIT0gdGVncmEtPmdyb3VwKSkpIHsKLSNpZiBJU19F
TkFCTEVEKENPTkZJR19BUk1fRE1BX1VTRV9JT01NVSkKLQkJCWlmIChjbGllbnQtPmRldi0+YXJj
aGRhdGEubWFwcGluZykgewotCQkJCXN0cnVjdCBkbWFfaW9tbXVfbWFwcGluZyAqbWFwcGluZyA9
Ci0JCQkJCXRvX2RtYV9pb21tdV9tYXBwaW5nKGNsaWVudC0+ZGV2KTsKLQkJCQlhcm1faW9tbXVf
ZGV0YWNoX2RldmljZShjbGllbnQtPmRldik7Ci0JCQkJYXJtX2lvbW11X3JlbGVhc2VfbWFwcGlu
ZyhtYXBwaW5nKTsKLQkJCX0KLSNlbmRpZgogCQkJZXJyID0gaW9tbXVfYXR0YWNoX2dyb3VwKHRl
Z3JhLT5kb21haW4sIGdyb3VwKTsKIAkJCWlmIChlcnIgPCAwKSB7CiAJCQkJaW9tbXVfZ3JvdXBf
cHV0KGdyb3VwKTsKQEAgLTExMjEsNiArMTE0Nyw3IEBAIHZvaWQgaG9zdDF4X2NsaWVudF9pb21t
dV9kZXRhY2goc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCkKIAkJfQogCiAJCWlvbW11X2dy
b3VwX3B1dChjbGllbnQtPmdyb3VwKTsKKwkJY2xpZW50LT5ncm91cCA9IE5VTEw7CiAJfQogfQog
Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
