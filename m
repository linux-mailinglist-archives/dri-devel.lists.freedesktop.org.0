Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C7738293C9
	for <lists+dri-devel@lfdr.de>; Fri, 24 May 2019 10:56:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D38F6E0F7;
	Fri, 24 May 2019 08:54:53 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 88C366E0E5
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 08:54:40 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id w33so9959908edb.10
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 01:54:40 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=gCf5Rgx3D70Kd2HtBB6qbJz/DSCv1md2CdZdgEtyLXg=;
 b=s3NZk92bad0X512nKqH4c11eupYYLMIsKpHVr2Zn/gaYH03vqDjzWJ/MzDNTPlI4JK
 Pq5fSh6HAl7YNW9XMfHohk2o2o5CRqxTjZun6R7hguLmnj/C6lgjYdZpDTYchWsmlEbe
 5NnrYlDQwJ/ouZPfrK4ZXUhEzJXblLAREzuK7OzHOoLcSG6IAM0iVgzC1sUkPk1czuBD
 S6rrgNDZKzdiIjqcj6jftLNzZpBPgjopO6i+We3v1s85GUdVXCGmZJ1O6vQr1Py7kJ7K
 1E8QxuJsUqYpCcJi53pjvmq7I0OvVGXSv8CpZND38hmgpxczl2Di1Y1Hff//3WAjFpNm
 ksZQ==
X-Gm-Message-State: APjAAAWpuyLjNvWDQBkQPvFFhPOMTMbOGqpHhpXgIclb9PYMF6LBPqRG
 OyADygM/z7ovtRCj3ooFAW9dUQ==
X-Google-Smtp-Source: APXvYqzyPNuIzdNMoEW4sq1/8xjOYEmjw8xi22YZoTjllIH3zi//9suSNZONQSkg5qYF7IHu4ZEvXg==
X-Received: by 2002:aa7:d04e:: with SMTP id n14mr73467369edo.205.1558688077326; 
 Fri, 24 May 2019 01:54:37 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id 96sm567082edq.68.2019.05.24.01.54.36
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Fri, 24 May 2019 01:54:36 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH 27/33] fb: Flatten control flow in fb_set_var
Date: Fri, 24 May 2019 10:53:48 +0200
Message-Id: <20190524085354.27411-28-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190524085354.27411-1-daniel.vetter@ffwll.ch>
References: <20190524085354.27411-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=gCf5Rgx3D70Kd2HtBB6qbJz/DSCv1md2CdZdgEtyLXg=;
 b=WFVQ26EU4e9g0t3Pm481bYAhTDj6tXbB5c5J+KUiu0aJlzh1dBe7L6KahUEgUKiyA8
 vHeWnvZRbe+/XU2JckZJQrEVWt8QgZmQ8wJpVfxgeI435T0ImU3QUKZjGDkUjC3Wjfii
 6gH5XIGzOsA0Do2IE3GYfzQxjB4Se7rpIwfsQ=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 DRI Development <dri-devel@lists.freedesktop.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Hans de Goede <hdegoede@redhat.com>, Mikulas Patocka <mpatocka@redhat.com>,
 Daniel Vetter <daniel.vetter@intel.com>, Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiB3aXJpbmcgYWxtb3N0IGV2ZXJ5dGhpbmcgZG93biB0byB0aGUgdmVyeSBsYXN0
IGxpbmUgdXNpbmcKZ290byBzb3VwIChidXQgbm90IGNvbnNpc3RlbnRseSwgd2hlcmUgd291bGQg
dGhlIGZ1biBiZSBvdGhlcndpc2UpCmRyb3Agb3V0IGVhcmx5IHdoZW4gY2hlY2tzIGZhaWwuIFRo
aXMgYWxsb3dzIHVzIHRvIGZsYXR0ZW4gdGhlIGh1Z2UKaW5kZW50IGxldmVscyB0byBqdXN0IDEu
CgpBc2lkZTogSWYgYSBkcml2ZXIgZG9lc24ndCBzZXQgLT5mYl9jaGVja192YXIsIHRoZW4gRkJf
QUNUSVZBVEVfTk9XCmRvZXMgbm90aGluZy4gVGhpcyBidWcgZXhpc3RzIGV2ZXIgc2luY2UgdGhp
cyBjb2RlIHdhcyBleHRyYWN0ZWQgYXMgYQpjb21tb24gaGVscGVyIGluIDIwMDIsIGhlbmNlIEkg
ZGVjaWRlZCBhZ2FpbnN0IGZpeGluZyBpdC4gRXZlcnlvbmUKanVzdCBiZXR0ZXIgaGF2ZSBhIGZi
X2NoZWNrX3ZhciB0byBtYWtlIHN1cmUgdGhpbmdzIHdvcmsgY29ycmVjdGx5LgoKU2lnbmVkLW9m
Zi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBEYW5pZWwg
VmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgpDYzogQmFydGxvbWllaiBab2xuaWVya2ll
d2ljeiA8Yi56b2xuaWVya2llQHNhbXN1bmcuY29tPgpDYzogIk1pY2hhxYIgTWlyb3PFgmF3IiA8
bWlycS1saW51eEByZXJlLnFtcW0ucGw+CkNjOiBQZXRlciBSb3NpbiA8cGVkYUBheGVudGlhLnNl
PgpDYzogSGFucyBkZSBHb2VkZSA8aGRlZ29lZGVAcmVkaGF0LmNvbT4KQ2M6IE1pa3VsYXMgUGF0
b2NrYSA8bXBhdG9ja2FAcmVkaGF0LmNvbT4KLS0tCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUv
ZmJtZW0uYyB8IDEyNiArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hh
bmdlZCwgNjMgaW5zZXJ0aW9ucygrKSwgNjMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUv
ZmJtZW0uYwppbmRleCAyNWFlNDY2YmE1OTMuLjk2ODA1ZmU4NTMzMiAxMDA2NDQKLS0tIGEvZHJp
dmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9j
b3JlL2ZibWVtLmMKQEAgLTk1NCw2ICs5NTQsOSBAQCBmYl9zZXRfdmFyKHN0cnVjdCBmYl9pbmZv
ICppbmZvLCBzdHJ1Y3QgZmJfdmFyX3NjcmVlbmluZm8gKnZhcikKIHsKIAlpbnQgZmxhZ3MgPSBp
bmZvLT5mbGFnczsKIAlpbnQgcmV0ID0gMDsKKwl1MzIgYWN0aXZhdGU7CisJc3RydWN0IGZiX3Zh
cl9zY3JlZW5pbmZvIG9sZF92YXI7CisJc3RydWN0IGZiX3ZpZGVvbW9kZSBtb2RlOwogCiAJaWYg
KHZhci0+YWN0aXZhdGUgJiBGQl9BQ1RJVkFURV9JTlZfTU9ERSkgewogCQlzdHJ1Y3QgZmJfdmlk
ZW9tb2RlIG1vZGUxLCBtb2RlMjsKQEAgLTk3MCw4NyArOTczLDg0IEBAIGZiX3NldF92YXIoc3Ry
dWN0IGZiX2luZm8gKmluZm8sIHN0cnVjdCBmYl92YXJfc2NyZWVuaW5mbyAqdmFyKQogCQkJZmJf
ZGVsZXRlX3ZpZGVvbW9kZSgmbW9kZTEsICZpbmZvLT5tb2RlbGlzdCk7CiAKIAotCQlyZXQgPSAo
cmV0KSA/IC1FSU5WQUwgOiAwOwotCQlnb3RvIGRvbmU7CisJCXJldHVybiByZXQgPyAtRUlOVkFM
IDogMDsKIAl9CiAKLQlpZiAoKHZhci0+YWN0aXZhdGUgJiBGQl9BQ1RJVkFURV9GT1JDRSkgfHwK
LQkgICAgbWVtY21wKCZpbmZvLT52YXIsIHZhciwgc2l6ZW9mKHN0cnVjdCBmYl92YXJfc2NyZWVu
aW5mbykpKSB7Ci0JCXUzMiBhY3RpdmF0ZSA9IHZhci0+YWN0aXZhdGU7CisJaWYgKCEodmFyLT5h
Y3RpdmF0ZSAmIEZCX0FDVElWQVRFX0ZPUkNFKSAmJgorCSAgICAhbWVtY21wKCZpbmZvLT52YXIs
IHZhciwgc2l6ZW9mKHN0cnVjdCBmYl92YXJfc2NyZWVuaW5mbykpKQorCQlyZXR1cm4gMDsKIAot
CQkvKiBXaGVuIHVzaW5nIEZPVVJDQyBtb2RlLCBtYWtlIHN1cmUgdGhlIHJlZCwgZ3JlZW4sIGJs
dWUgYW5kCi0JCSAqIHRyYW5zcCBmaWVsZHMgYXJlIHNldCB0byAwLgotCQkgKi8KLQkJaWYgKChp
bmZvLT5maXguY2FwYWJpbGl0aWVzICYgRkJfQ0FQX0ZPVVJDQykgJiYKLQkJICAgIHZhci0+Z3Jh
eXNjYWxlID4gMSkgewotCQkJaWYgKHZhci0+cmVkLm9mZnNldCAgICAgfHwgdmFyLT5ncmVlbi5v
ZmZzZXQgICAgfHwKLQkJCSAgICB2YXItPmJsdWUub2Zmc2V0ICAgIHx8IHZhci0+dHJhbnNwLm9m
ZnNldCAgIHx8Ci0JCQkgICAgdmFyLT5yZWQubGVuZ3RoICAgICB8fCB2YXItPmdyZWVuLmxlbmd0
aCAgICB8fAotCQkJICAgIHZhci0+Ymx1ZS5sZW5ndGggICAgfHwgdmFyLT50cmFuc3AubGVuZ3Ro
ICAgfHwKLQkJCSAgICB2YXItPnJlZC5tc2JfcmlnaHQgIHx8IHZhci0+Z3JlZW4ubXNiX3JpZ2h0
IHx8Ci0JCQkgICAgdmFyLT5ibHVlLm1zYl9yaWdodCB8fCB2YXItPnRyYW5zcC5tc2JfcmlnaHQp
Ci0JCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCX0KKwlhY3RpdmF0ZSA9IHZhci0+YWN0aXZhdGU7CiAK
LQkJaWYgKCFpbmZvLT5mYm9wcy0+ZmJfY2hlY2tfdmFyKSB7Ci0JCQkqdmFyID0gaW5mby0+dmFy
OwotCQkJZ290byBkb25lOwotCQl9CisJLyogV2hlbiB1c2luZyBGT1VSQ0MgbW9kZSwgbWFrZSBz
dXJlIHRoZSByZWQsIGdyZWVuLCBibHVlIGFuZAorCSAqIHRyYW5zcCBmaWVsZHMgYXJlIHNldCB0
byAwLgorCSAqLworCWlmICgoaW5mby0+Zml4LmNhcGFiaWxpdGllcyAmIEZCX0NBUF9GT1VSQ0Mp
ICYmCisJICAgIHZhci0+Z3JheXNjYWxlID4gMSkgeworCQlpZiAodmFyLT5yZWQub2Zmc2V0ICAg
ICB8fCB2YXItPmdyZWVuLm9mZnNldCAgICB8fAorCQkgICAgdmFyLT5ibHVlLm9mZnNldCAgICB8
fCB2YXItPnRyYW5zcC5vZmZzZXQgICB8fAorCQkgICAgdmFyLT5yZWQubGVuZ3RoICAgICB8fCB2
YXItPmdyZWVuLmxlbmd0aCAgICB8fAorCQkgICAgdmFyLT5ibHVlLmxlbmd0aCAgICB8fCB2YXIt
PnRyYW5zcC5sZW5ndGggICB8fAorCQkgICAgdmFyLT5yZWQubXNiX3JpZ2h0ICB8fCB2YXItPmdy
ZWVuLm1zYl9yaWdodCB8fAorCQkgICAgdmFyLT5ibHVlLm1zYl9yaWdodCB8fCB2YXItPnRyYW5z
cC5tc2JfcmlnaHQpCisJCQlyZXR1cm4gLUVJTlZBTDsKKwl9CiAKLQkJcmV0ID0gaW5mby0+ZmJv
cHMtPmZiX2NoZWNrX3Zhcih2YXIsIGluZm8pOworCWlmICghaW5mby0+ZmJvcHMtPmZiX2NoZWNr
X3ZhcikgeworCQkqdmFyID0gaW5mby0+dmFyOworCQlyZXR1cm4gMDsKKwl9CiAKLQkJaWYgKHJl
dCkKLQkJCWdvdG8gZG9uZTsKKwlyZXQgPSBpbmZvLT5mYm9wcy0+ZmJfY2hlY2tfdmFyKHZhciwg
aW5mbyk7CiAKLQkJaWYgKCh2YXItPmFjdGl2YXRlICYgRkJfQUNUSVZBVEVfTUFTSykgPT0gRkJf
QUNUSVZBVEVfTk9XKSB7Ci0JCQlzdHJ1Y3QgZmJfdmFyX3NjcmVlbmluZm8gb2xkX3ZhcjsKLQkJ
CXN0cnVjdCBmYl92aWRlb21vZGUgbW9kZTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0J
CQlpZiAoaW5mby0+ZmJvcHMtPmZiX2dldF9jYXBzKSB7Ci0JCQkJcmV0ID0gZmJfY2hlY2tfY2Fw
cyhpbmZvLCB2YXIsIGFjdGl2YXRlKTsKKwlpZiAoKHZhci0+YWN0aXZhdGUgJiBGQl9BQ1RJVkFU
RV9NQVNLKSAhPSBGQl9BQ1RJVkFURV9OT1cpCisJCXJldHVybiAwOwogCi0JCQkJaWYgKHJldCkK
LQkJCQkJZ290byBkb25lOwotCQkJfQorCWlmIChpbmZvLT5mYm9wcy0+ZmJfZ2V0X2NhcHMpIHsK
KwkJcmV0ID0gZmJfY2hlY2tfY2FwcyhpbmZvLCB2YXIsIGFjdGl2YXRlKTsKIAotCQkJb2xkX3Zh
ciA9IGluZm8tPnZhcjsKLQkJCWluZm8tPnZhciA9ICp2YXI7CisJCWlmIChyZXQpCisJCQlyZXR1
cm4gcmV0OworCX0KIAotCQkJaWYgKGluZm8tPmZib3BzLT5mYl9zZXRfcGFyKSB7Ci0JCQkJcmV0
ID0gaW5mby0+ZmJvcHMtPmZiX3NldF9wYXIoaW5mbyk7CisJb2xkX3ZhciA9IGluZm8tPnZhcjsK
KwlpbmZvLT52YXIgPSAqdmFyOwogCi0JCQkJaWYgKHJldCkgewotCQkJCQlpbmZvLT52YXIgPSBv
bGRfdmFyOwotCQkJCQlwcmludGsoS0VSTl9XQVJOSU5HICJkZXRlY3RlZCAiCi0JCQkJCQkiZmJf
c2V0X3BhciBlcnJvciwgIgotCQkJCQkJImVycm9yIGNvZGU6ICVkXG4iLCByZXQpOwotCQkJCQln
b3RvIGRvbmU7Ci0JCQkJfQotCQkJfQorCWlmIChpbmZvLT5mYm9wcy0+ZmJfc2V0X3Bhcikgewor
CQlyZXQgPSBpbmZvLT5mYm9wcy0+ZmJfc2V0X3BhcihpbmZvKTsKKworCQlpZiAocmV0KSB7CisJ
CQlpbmZvLT52YXIgPSBvbGRfdmFyOworCQkJcHJpbnRrKEtFUk5fV0FSTklORyAiZGV0ZWN0ZWQg
IgorCQkJCSJmYl9zZXRfcGFyIGVycm9yLCAiCisJCQkJImVycm9yIGNvZGU6ICVkXG4iLCByZXQp
OworCQkJcmV0dXJuIHJldDsKKwkJfQorCX0KIAotCQkJZmJfcGFuX2Rpc3BsYXkoaW5mbywgJmlu
Zm8tPnZhcik7Ci0JCQlmYl9zZXRfY21hcCgmaW5mby0+Y21hcCwgaW5mbyk7Ci0JCQlmYl92YXJf
dG9fdmlkZW9tb2RlKCZtb2RlLCAmaW5mby0+dmFyKTsKKwlmYl9wYW5fZGlzcGxheShpbmZvLCAm
aW5mby0+dmFyKTsKKwlmYl9zZXRfY21hcCgmaW5mby0+Y21hcCwgaW5mbyk7CisJZmJfdmFyX3Rv
X3ZpZGVvbW9kZSgmbW9kZSwgJmluZm8tPnZhcik7CiAKLQkJCWlmIChpbmZvLT5tb2RlbGlzdC5w
cmV2ICYmIGluZm8tPm1vZGVsaXN0Lm5leHQgJiYKLQkJCSAgICAhbGlzdF9lbXB0eSgmaW5mby0+
bW9kZWxpc3QpKQotCQkJCXJldCA9IGZiX2FkZF92aWRlb21vZGUoJm1vZGUsICZpbmZvLT5tb2Rl
bGlzdCk7CisJaWYgKGluZm8tPm1vZGVsaXN0LnByZXYgJiYgaW5mby0+bW9kZWxpc3QubmV4dCAm
JgorCSAgICAhbGlzdF9lbXB0eSgmaW5mby0+bW9kZWxpc3QpKQorCQlyZXQgPSBmYl9hZGRfdmlk
ZW9tb2RlKCZtb2RlLCAmaW5mby0+bW9kZWxpc3QpOwogCi0JCQlpZiAoIXJldCAmJiAoZmxhZ3Mg
JiBGQklORk9fTUlTQ19VU0VSRVZFTlQpKSB7Ci0JCQkJc3RydWN0IGZiX2V2ZW50IGV2ZW50Owot
CQkJCWludCBldm50ID0gKGFjdGl2YXRlICYgRkJfQUNUSVZBVEVfQUxMKSA/Ci0JCQkJCUZCX0VW
RU5UX01PREVfQ0hBTkdFX0FMTCA6Ci0JCQkJCUZCX0VWRU5UX01PREVfQ0hBTkdFOworCWlmICgh
cmV0ICYmIChmbGFncyAmIEZCSU5GT19NSVNDX1VTRVJFVkVOVCkpIHsKKwkJc3RydWN0IGZiX2V2
ZW50IGV2ZW50OworCQlpbnQgZXZudCA9IChhY3RpdmF0ZSAmIEZCX0FDVElWQVRFX0FMTCkgPwor
CQkJRkJfRVZFTlRfTU9ERV9DSEFOR0VfQUxMIDoKKwkJCUZCX0VWRU5UX01PREVfQ0hBTkdFOwog
Ci0JCQkJaW5mby0+ZmxhZ3MgJj0gfkZCSU5GT19NSVNDX1VTRVJFVkVOVDsKLQkJCQlldmVudC5p
bmZvID0gaW5mbzsKLQkJCQlldmVudC5kYXRhID0gJm1vZGU7Ci0JCQkJZmJfbm90aWZpZXJfY2Fs
bF9jaGFpbihldm50LCAmZXZlbnQpOwotCQkJfQotCQl9CisJCWluZm8tPmZsYWdzICY9IH5GQklO
Rk9fTUlTQ19VU0VSRVZFTlQ7CisJCWV2ZW50LmluZm8gPSBpbmZvOworCQlldmVudC5kYXRhID0g
Jm1vZGU7CisJCWZiX25vdGlmaWVyX2NhbGxfY2hhaW4oZXZudCwgJmV2ZW50KTsKIAl9CiAKLSBk
b25lOgogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRfU1lNQk9MKGZiX3NldF92YXIpOwotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
