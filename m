Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7B5C35DFD5
	for <lists+dri-devel@lfdr.de>; Wed,  3 Jul 2019 10:33:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B70506E0FB;
	Wed,  3 Jul 2019 08:33:13 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E07236E0F6
 for <dri-devel@lists.freedesktop.org>; Wed,  3 Jul 2019 08:33:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 18914AF5D;
 Wed,  3 Jul 2019 08:33:09 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, noralf@tronnes.org, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH 1/5] drm/client: Support unmapping of DRM client buffers
Date: Wed,  3 Jul 2019 10:32:58 +0200
Message-Id: <20190703083302.2609-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190703083302.2609-1-tzimmermann@suse.de>
References: <20190703083302.2609-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFJNIGNsaWVudHMsIHN1Y2ggYXMgdGhlIGZiZGV2IGVtdWxhdGlvbiwgaGF2ZSB0aGVpciBidWZm
ZXIgb2JqZWN0cwptYXBwZWQgYnkgZGVmYXVsdC4gTWFwcGluZyBhIGJ1ZmZlciBpbXBsaWNpdGx5
IHByZXZlbnRzIGl0cyByZWxvY2F0aW9uLgpIZW5jZSwgdGhlIGJ1ZmZlciBtYXkgcGVybWFuZW50
bHkgY29uc3VtZSB2aWRlbyBtZW1vcnkgd2hpbGUgaXQncwphbGxvY2F0ZWQuIFRoaXMgaXMgYSBw
cm9ibGVtIGZvciBkcml2ZXJzIG9mIGxvdy1tZW1vcnkgZGV2aWNlcywgc3VjaCBhcwphc3QsIG1n
YWcyMDAgb3Igb2xkZXIgZnJhbWVidWZmZXIgaGFyZHdhcmUsIHdoaWNoIHdpbGwgdGhlbiBub3Qg
aGF2ZQplbm91Z2ggbWVtb3J5IHRvIGRpc3BsYXkgb3RoZXIgY29udGVudCAoZS5nLiwgWDExKS4K
ClRoaXMgcGF0Y2ggaW50cm9kdWNlcyBkcm1fY2xpZW50X2J1ZmZlcl92bWFwKCkgYW5kIF92dW5t
YXAoKS4gSW50ZXJuYWwKRFJNIGNsaWVudHMgY2FuIHVzZSB0aGVzZSBmdW5jdGlvbnMgdG8gdW5t
YXAgYW5kIHJlbWFwIGJ1ZmZlciBvYmplY3RzCmFzIG5lZWRlZC4KClRoZXJlJ3Mgbm8gcmVmZXJl
bmNlIGNvdW50aW5nIGZvciB2bWFwIG9wZXJhdGlvbnMuIENhbGxlcnMgYXJlIGV4cGVjdGVkCnRv
IGVpdGhlciBrZWVwIGJ1ZmZlcnMgbWFwcGVkIChhcyBpdCBpcyBub3cpLCBvciBjYWxsIHZtYXAg
YW5kIHZ1bm1hcAppbiBwYWlycyBhcm91bmQgY29kZSB0aGF0IGFjY2Vzc2VzIHRoZSBtYXBwZWQg
bWVtb3J5LgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1
c2UuZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnQuYyB8IDcxICsrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKystLS0tLQogaW5jbHVkZS9kcm0vZHJtX2NsaWVudC5oICAgICB8
ICAzICsrCiAyIGZpbGVzIGNoYW5nZWQsIDY0IGluc2VydGlvbnMoKyksIDEwIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50LmMgYi9kcml2ZXJzL2dw
dS9kcm0vZHJtX2NsaWVudC5jCmluZGV4IDQxMDU3MmYxNDI1Ny4uZDA0NjYwYzQ0NzBhIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fY2xpZW50LmMKQEAgLTIzNSw3ICsyMzUsOCBAQCBzdGF0aWMgdm9pZCBkcm1fY2xpZW50
X2J1ZmZlcl9kZWxldGUoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIpCiB7CiAJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IGJ1ZmZlci0+Y2xpZW50LT5kZXY7CiAKLQlkcm1fZ2VtX3Z1
bm1hcChidWZmZXItPmdlbSwgYnVmZmVyLT52YWRkcik7CisJaWYgKGJ1ZmZlci0+dmFkZHIpCisJ
CWRybV9nZW1fdnVubWFwKGJ1ZmZlci0+Z2VtLCBidWZmZXItPnZhZGRyKTsKIAogCWlmIChidWZm
ZXItPmdlbSkKIAkJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKGJ1ZmZlci0+Z2VtKTsKQEAg
LTI4MSw2ICsyODIsNDMgQEAgZHJtX2NsaWVudF9idWZmZXJfY3JlYXRlKHN0cnVjdCBkcm1fY2xp
ZW50X2RldiAqY2xpZW50LCB1MzIgd2lkdGgsIHUzMiBoZWlnaHQsIHUKIAogCWJ1ZmZlci0+Z2Vt
ID0gb2JqOwogCisJdmFkZHIgPSBkcm1fY2xpZW50X2J1ZmZlcl92bWFwKGJ1ZmZlcik7CisJaWYg
KElTX0VSUih2YWRkcikpIHsKKwkJcmV0ID0gUFRSX0VSUih2YWRkcik7CisJCWdvdG8gZXJyX2Rl
bGV0ZTsKKwl9CisKKwlyZXR1cm4gYnVmZmVyOworCitlcnJfZGVsZXRlOgorCWRybV9jbGllbnRf
YnVmZmVyX2RlbGV0ZShidWZmZXIpOworCisJcmV0dXJuIEVSUl9QVFIocmV0KTsKK30KKworLyoq
CisgKiBkcm1fY2xpZW50X2J1ZmZlcl92bWFwIC0gTWFwIERSTSBjbGllbnQgYnVmZmVyIGludG8g
YWRkcmVzcyBzcGFjZQorICogQGJ1ZmZlcjogRFJNIGNsaWVudCBidWZmZXIKKyAqCisgKiBUaGlz
IGZ1bmN0aW9uIG1hcHMgYSBjbGllbnQgYnVmZmVyIGludG8ga2VybmVsIGFkZHJlc3Mgc3BhY2Uu
IElmIHRoZQorICogYnVmZmVyIGlzIGFscmVhZHkgbWFwcGVkLCBpdCByZXR1cm5zIHRoZSBtYXBw
aW5nJ3MgYWRkcmVzcy4KKyAqCisgKiBDbGllbnQgYnVmZmVyIG1hcHBpbmdzIGFyZSBub3QgcmVm
J2NvdW50ZWQuIEVhY2ggY2FsbCB0bworICogZHJtX2NsaWVudF9idWZmZXJfdm1hcCgpIHNob3Vs
ZCBiZSBmb2xsb3dlZCBieSBhIGNhbGwgdG8KKyAqIGRybV9jbGllbnRfYnVmZmVyX3Z1bm1hcCgp
OyBvciB0aGUgY2xpZW50IGJ1ZmZlciBzaG91bGQgYmUgbWFwcGVkCisgKiB0aHJvdWdob3V0IGl0
cyBsaWZldGltZS4gVGhlIGxhdHRlciBpcyB0aGUgZGVmYXVsdC4KKyAqCisgKiBSZXR1cm5zOgor
ICoJVGhlIG1hcHBlZCBtZW1vcnkncyBhZGRyZXNzCisgKi8KK3ZvaWQgKgorZHJtX2NsaWVudF9i
dWZmZXJfdm1hcChzdHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgKmJ1ZmZlcikKK3sKKwl2b2lkICp2
YWRkcjsKKworCWlmIChidWZmZXItPnZhZGRyKQorCQlyZXR1cm4gYnVmZmVyLT52YWRkcjsKKwog
CS8qCiAJICogRklYTUU6IFRoZSBkZXBlbmRlbmN5IG9uIEdFTSBoZXJlIGlzbid0IHJlcXVpcmVk
LCB3ZSBjb3VsZAogCSAqIGNvbnZlcnQgdGhlIGRyaXZlciBoYW5kbGUgdG8gYSBkbWEtYnVmIGlu
c3RlYWQgYW5kIHVzZSB0aGUKQEAgLTI4OSwyMSArMzI3LDM0IEBAIGRybV9jbGllbnRfYnVmZmVy
X2NyZWF0ZShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCwgdTMyIHdpZHRoLCB1MzIgaGVp
Z2h0LCB1CiAJICogZmRfaW5zdGFsbCBzdGVwIG91dCBvZiB0aGUgZHJpdmVyIGJhY2tlbmQgaG9v
a3MsIHRvIG1ha2UgdGhhdAogCSAqIGZpbmFsIHN0ZXAgb3B0aW9uYWwgZm9yIGludGVybmFsIHVz
ZXJzLgogCSAqLwotCXZhZGRyID0gZHJtX2dlbV92bWFwKG9iaik7Ci0JaWYgKElTX0VSUih2YWRk
cikpIHsKLQkJcmV0ID0gUFRSX0VSUih2YWRkcik7Ci0JCWdvdG8gZXJyX2RlbGV0ZTsKLQl9CisJ
dmFkZHIgPSBkcm1fZ2VtX3ZtYXAoYnVmZmVyLT5nZW0pOworCWlmIChJU19FUlIodmFkZHIpKQor
CQlyZXR1cm4gdmFkZHI7CiAKIAlidWZmZXItPnZhZGRyID0gdmFkZHI7CiAKLQlyZXR1cm4gYnVm
ZmVyOworCXJldHVybiB2YWRkcjsKK30KK0VYUE9SVF9TWU1CT0woZHJtX2NsaWVudF9idWZmZXJf
dm1hcCk7CiAKLWVycl9kZWxldGU6Ci0JZHJtX2NsaWVudF9idWZmZXJfZGVsZXRlKGJ1ZmZlcik7
CisvKioKKyAqIGRybV9jbGllbnRfYnVmZmVyX3Z1bm1hcCAtIFVubWFwIERSTSBjbGllbnQgYnVm
ZmVyCisgKiBAYnVmZmVyOiBEUk0gY2xpZW50IGJ1ZmZlcgorICoKKyAqIFRoaXMgZnVuY3Rpb24g
cmVtb3ZlcyBhIGNsaWVudCBidWZmZXIncyBtZW1vcnkgbW1hcHBpbmcuIFRoaXMKKyAqIGZ1bmN0
aW9uIGlzIG9ubHkgcmVxdWlyZWQgYnkgY2xpZW50cyB0aGF0IG1hbmFnZSB0aGVpciBidWZmZXJz
CisgKiBieSB0aGVtc2VsdmVzLiBCeSBkZWZhdWx0LCBEUk0gY2xpZW50IGJ1ZmZlcnMgYXJlIG1h
cHBlZCB0aHJvdWdob3V0CisgKiB0aGVpciBlbnRpcmUgbGlmZXRpbWUuCisgKi8KK3ZvaWQgZHJt
X2NsaWVudF9idWZmZXJfdnVubWFwKHN0cnVjdCBkcm1fY2xpZW50X2J1ZmZlciAqYnVmZmVyKQor
eworCWlmICghYnVmZmVyLT52YWRkcikKKwkJcmV0dXJuOwogCi0JcmV0dXJuIEVSUl9QVFIocmV0
KTsKKwlkcm1fZ2VtX3Z1bm1hcChidWZmZXItPmdlbSwgYnVmZmVyLT52YWRkcik7CisJYnVmZmVy
LT52YWRkciA9IE5VTEw7CiB9CitFWFBPUlRfU1lNQk9MKGRybV9jbGllbnRfYnVmZmVyX3Z1bm1h
cCk7CiAKIHN0YXRpYyB2b2lkIGRybV9jbGllbnRfYnVmZmVyX3JtZmIoc3RydWN0IGRybV9jbGll
bnRfYnVmZmVyICpidWZmZXIpCiB7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fY2xpZW50
LmggYi9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmgKaW5kZXggNzJkNTFkMWU5ZGQ5Li5lMWRiMWQ5
ZGEwYmYgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9jbGllbnQuaAorKysgYi9pbmNsdWRl
L2RybS9kcm1fY2xpZW50LmgKQEAgLTE0OSw2ICsxNDksOSBAQCBzdHJ1Y3QgZHJtX2NsaWVudF9i
dWZmZXIgewogc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICoKIGRybV9jbGllbnRfZnJhbWVidWZm
ZXJfY3JlYXRlKHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50LCB1MzIgd2lkdGgsIHUzMiBo
ZWlnaHQsIHUzMiBmb3JtYXQpOwogdm9pZCBkcm1fY2xpZW50X2ZyYW1lYnVmZmVyX2RlbGV0ZShz
dHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgKmJ1ZmZlcik7Cit2b2lkICoKK2RybV9jbGllbnRfYnVm
ZmVyX3ZtYXAoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIpOwordm9pZCBkcm1fY2xp
ZW50X2J1ZmZlcl92dW5tYXAoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIpOwogCiBp
bnQgZHJtX2NsaWVudF9tb2Rlc2V0X2NyZWF0ZShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVu
dCk7CiB2b2lkIGRybV9jbGllbnRfbW9kZXNldF9mcmVlKHN0cnVjdCBkcm1fY2xpZW50X2RldiAq
Y2xpZW50KTsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
