Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5DCEB7EBF5
	for <lists+dri-devel@lfdr.de>; Fri,  2 Aug 2019 07:23:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 812BC6E8B4;
	Fri,  2 Aug 2019 05:22:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C14996E8AD;
 Fri,  2 Aug 2019 05:22:55 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 34B6446671;
 Fri,  2 Aug 2019 05:22:55 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-81.ams2.redhat.com
 [10.36.116.81])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 82920608C2;
 Fri,  2 Aug 2019 05:22:53 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 7F3959D1D; Fri,  2 Aug 2019 07:22:51 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 13/17] drm/amdgpu: switch driver from bo->resv to
 bo->base.resv
Date: Fri,  2 Aug 2019 07:22:43 +0200
Message-Id: <20190802052247.18427-14-kraxel@redhat.com>
In-Reply-To: <20190802052247.18427-1-kraxel@redhat.com>
References: <20190802052247.18427-1-kraxel@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.30]); Fri, 02 Aug 2019 05:22:55 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: thomas@shipmail.org, tzimmermann@suse.de, David Airlie <airlied@linux.ie>,
 ckoenig.leichtzumerken@gmail.com, open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Leo Li <sunpeng.li@amd.com>, Gerd Hoffmann <kraxel@redhat.com>,
 Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 bskeggs@redhat.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+ClJldmlld2Vk
LWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Ci0tLQogLi4u
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgIDggKystLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgICB8ICA2ICsrLS0KIGRy
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMgICB8ICAyICstCiBkcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jICAgfCAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dlbS5jICAgICAgIHwgIDYgKystLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ttcy5jICAgICAgIHwgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCAyMiArKysrKysrLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jICAgICAgIHwgIDYgKystLQog
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3V2ZC5jICAgICAgIHwgIDQgKy0tCiBk
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYyAgICAgICAgfCAzMCArKysrKysr
KystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5j
ICAgfCAgMiArLQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5j
IHwgIDIgKy0KIDEzIGZpbGVzIGNoYW5nZWQsIDQ2IGluc2VydGlvbnMoKyksIDQ4IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRr
ZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1
dm0uYwppbmRleCAxZDNlZTljNDJmN2UuLmZlMDYyYjc2ZWM5MSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwpAQCAtMjE4LDcgKzIxOCw3
IEBAIHZvaWQgYW1kZ3B1X2FtZGtmZF91bnJlc2VydmVfbWVtb3J5X2xpbWl0KHN0cnVjdCBhbWRn
cHVfYm8gKmJvKQogc3RhdGljIGludCBhbWRncHVfYW1ka2ZkX3JlbW92ZV9ldmljdGlvbl9mZW5j
ZShzdHJ1Y3QgYW1kZ3B1X2JvICpibywKIAkJCQkJc3RydWN0IGFtZGdwdV9hbWRrZmRfZmVuY2Ug
KmVmKQogewotCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBiby0+dGJvLnJlc3Y7
CisJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2Owog
CXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3RfbGlzdCAqb2xkLCAqbmV3OwogCXVuc2lnbmVkIGlu
dCBpLCBqLCBrOwogCkBAIC04MTIsNyArODEyLDcgQEAgc3RhdGljIGludCBwcm9jZXNzX3N5bmNf
cGRzX3Jlc3Yoc3RydWN0IGFtZGtmZF9wcm9jZXNzX2luZm8gKnByb2Nlc3NfaW5mbywKIAkJc3Ry
dWN0IGFtZGdwdV9ibyAqcGQgPSBwZWVyX3ZtLT5yb290LmJhc2UuYm87CiAKIAkJcmV0ID0gYW1k
Z3B1X3N5bmNfcmVzdihOVUxMLAotCQkJCQlzeW5jLCBwZC0+dGJvLnJlc3YsCisJCQkJCXN5bmMs
IHBkLT50Ym8uYmFzZS5yZXN2LAogCQkJCQlBTURHUFVfRkVOQ0VfT1dORVJfS0ZELCBmYWxzZSk7
CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAtODg3LDcgKzg4Nyw3IEBAIHN0YXRpYyBp
bnQgaW5pdF9rZmRfdm0oc3RydWN0IGFtZGdwdV92bSAqdm0sIHZvaWQgKipwcm9jZXNzX2luZm8s
CiAJCQkJICBBTURHUFVfRkVOQ0VfT1dORVJfS0ZELCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJZ290
byB3YWl0X3BkX2ZhaWw7Ci0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hhcmVk
KHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2LCAxKTsKKwlyZXQgPSByZXNlcnZhdGlvbl9vYmpl
Y3RfcmVzZXJ2ZV9zaGFyZWQodm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdiwgMSk7CiAJ
aWYgKHJldCkKIAkJZ290byByZXNlcnZlX3NoYXJlZF9mYWlsOwogCWFtZGdwdV9ib19mZW5jZSh2
bS0+cm9vdC5iYXNlLmJvLApAQCAtMjEzMiw3ICsyMTMyLDcgQEAgaW50IGFtZGdwdV9hbWRrZmRf
YWRkX2d3c190b19wcm9jZXNzKHZvaWQgKmluZm8sIHZvaWQgKmd3cywgc3RydWN0IGtnZF9tZW0g
KiptZW0KIAkgKiBBZGQgcHJvY2VzcyBldmljdGlvbiBmZW5jZSB0byBibyBzbyB0aGV5IGNhbgog
CSAqIGV2aWN0IGVhY2ggb3RoZXIuCiAJICovCi0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jl
c2VydmVfc2hhcmVkKGd3c19iby0+dGJvLnJlc3YsIDEpOworCXJldCA9IHJlc2VydmF0aW9uX29i
amVjdF9yZXNlcnZlX3NoYXJlZChnd3NfYm8tPnRiby5iYXNlLnJlc3YsIDEpOwogCWlmIChyZXQp
CiAJCWdvdG8gcmVzZXJ2ZV9zaGFyZWRfZmFpbDsKIAlhbWRncHVfYm9fZmVuY2UoZ3dzX2JvLCAm
cHJvY2Vzc19pbmZvLT5ldmljdGlvbl9mZW5jZS0+YmFzZSwgdHJ1ZSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV9jcy5jCmluZGV4IGUwNjlkZThiNTRlNi4uMmE5NzJkMTA0ZmVjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfY3MuYwpAQCAtNDAyLDcgKzQwMiw3IEBA
IHN0YXRpYyBpbnQgYW1kZ3B1X2NzX2JvX3ZhbGlkYXRlKHN0cnVjdCBhbWRncHVfY3NfcGFyc2Vy
ICpwLAogCXN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCBjdHggPSB7CiAJCS5pbnRlcnJ1cHRpYmxl
ID0gdHJ1ZSwKIAkJLm5vX3dhaXRfZ3B1ID0gZmFsc2UsCi0JCS5yZXN2ID0gYm8tPnRiby5yZXN2
LAorCQkucmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2LAogCQkuZmxhZ3MgPSAwCiAJfTsKIAl1aW50
MzJfdCBkb21haW47CkBAIC03MzAsNyArNzMwLDcgQEAgc3RhdGljIGludCBhbWRncHVfY3Nfc3lu
Y19yaW5ncyhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcCkKIAogCWxpc3RfZm9yX2VhY2hfZW50
cnkoZSwgJnAtPnZhbGlkYXRlZCwgdHYuaGVhZCkgewogCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9
IHR0bV90b19hbWRncHVfYm8oZS0+dHYuYm8pOwotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0
ICpyZXN2ID0gYm8tPnRiby5yZXN2OworCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2
ID0gYm8tPnRiby5iYXNlLnJlc3Y7CiAKIAkJciA9IGFtZGdwdV9zeW5jX3Jlc3YocC0+YWRldiwg
JnAtPmpvYi0+c3luYywgcmVzdiwgcC0+ZmlscCwKIAkJCQkgICAgIGFtZGdwdV9ib19leHBsaWNp
dF9zeW5jKGJvKSk7CkBAIC0xNzI5LDcgKzE3MjksNyBAQCBpbnQgYW1kZ3B1X2NzX2ZpbmRfbWFw
cGluZyhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcGFyc2VyLAogCSptYXAgPSBtYXBwaW5nOwog
CiAJLyogRG91YmxlIGNoZWNrIHRoYXQgdGhlIEJPIGlzIHJlc2VydmVkIGJ5IHRoaXMgQ1MgKi8K
LQlpZiAoUkVBRF9PTkNFKCgqYm8pLT50Ym8ucmVzdi0+bG9jay5jdHgpICE9ICZwYXJzZXItPnRp
Y2tldCkKKwlpZiAoUkVBRF9PTkNFKCgqYm8pLT50Ym8uYmFzZS5yZXN2LT5sb2NrLmN0eCkgIT0g
JnBhcnNlci0+dGlja2V0KQogCQlyZXR1cm4gLUVJTlZBTDsKIAogCWlmICghKCgqYm8pLT5mbGFn
cyAmIEFNREdQVV9HRU1fQ1JFQVRFX1ZSQU1fQ09OVElHVU9VUykpIHsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZGlzcGxheS5jCmluZGV4IDUzNTY1MDk2N2IxYS4uYjVkMDIw
ZTE1YzM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGlz
cGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kaXNwbGF5LmMK
QEAgLTIwNCw3ICsyMDQsNyBAQCBpbnQgYW1kZ3B1X2Rpc3BsYXlfY3J0Y19wYWdlX2ZsaXBfdGFy
Z2V0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJZ290byB1bnBpbjsKIAl9CiAKLQlyID0gcmVz
ZXJ2YXRpb25fb2JqZWN0X2dldF9mZW5jZXNfcmN1KG5ld19hYm8tPnRiby5yZXN2LCAmd29yay0+
ZXhjbCwKKwlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9mZW5jZXNfcmN1KG5ld19hYm8tPnRi
by5iYXNlLnJlc3YsICZ3b3JrLT5leGNsLAogCQkJCQkgICAgICAmd29yay0+c2hhcmVkX2NvdW50
LAogCQkJCQkgICAgICAmd29yay0+c2hhcmVkKTsKIAlpZiAodW5saWtlbHkociAhPSAwKSkgewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKaW5kZXggNGVlNDUy
ZmUwNTI2Li41ZTNhMDgzMjUwMTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9kbWFfYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2RtYV9idWYuYwpAQCAtMjE2LDcgKzIxNiw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RtYV9i
dWZfbWFwX2F0dGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiwKIAkJICogZmVuY2VzIG9uIHRo
ZSByZXNlcnZhdGlvbiBvYmplY3QgaW50byBhIHNpbmdsZSBleGNsdXNpdmUKIAkJICogZmVuY2Uu
CiAJCSAqLwotCQlyID0gX19yZXNlcnZhdGlvbl9vYmplY3RfbWFrZV9leGNsdXNpdmUoYm8tPnRi
by5yZXN2KTsKKwkJciA9IF9fcmVzZXJ2YXRpb25fb2JqZWN0X21ha2VfZXhjbHVzaXZlKGJvLT50
Ym8uYmFzZS5yZXN2KTsKIAkJaWYgKHIpCiAJCQlnb3RvIGVycm9yX3VucmVzZXJ2ZTsKIAl9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKaW5kZXggOWZmMDUwMWNmMWUwLi5i
ZmY5MTczYTFhOTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZ2VtLmMKQEAg
LTEzNCw3ICsxMzQsNyBAQCBpbnQgYW1kZ3B1X2dlbV9vYmplY3Rfb3BlbihzdHJ1Y3QgZHJtX2dl
bV9vYmplY3QgKm9iaiwKIAkJcmV0dXJuIC1FUEVSTTsKIAogCWlmIChhYm8tPmZsYWdzICYgQU1E
R1BVX0dFTV9DUkVBVEVfVk1fQUxXQVlTX1ZBTElEICYmCi0JICAgIGFiby0+dGJvLnJlc3YgIT0g
dm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJICAgIGFiby0+dGJvLmJhc2UucmVzdiAhPSB2
bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KQogCQlyZXR1cm4gLUVQRVJNOwogCiAJciA9
IGFtZGdwdV9ib19yZXNlcnZlKGFibywgZmFsc2UpOwpAQCAtMjUyLDcgKzI1Miw3IEBAIGludCBh
bWRncHVfZ2VtX2NyZWF0ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQlpZiAocikKIAkJCXJldHVybiByOwogCi0JCXJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50
Ym8ucmVzdjsKKwkJcmVzdiA9IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3Y7CiAJfQog
CiAJciA9IGFtZGdwdV9nZW1fb2JqZWN0X2NyZWF0ZShhZGV2LCBzaXplLCBhcmdzLT5pbi5hbGln
bm1lbnQsCkBAIC00MzMsNyArNDMzLDcgQEAgaW50IGFtZGdwdV9nZW1fd2FpdF9pZGxlX2lvY3Rs
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJldHVybiAtRU5PRU5UOwog
CX0KIAlyb2JqID0gZ2VtX3RvX2FtZGdwdV9ibyhnb2JqKTsKLQlyZXQgPSByZXNlcnZhdGlvbl9v
YmplY3Rfd2FpdF90aW1lb3V0X3JjdShyb2JqLT50Ym8ucmVzdiwgdHJ1ZSwgdHJ1ZSwKKwlyZXQg
PSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShyb2JqLT50Ym8uYmFzZS5yZXN2
LCB0cnVlLCB0cnVlLAogCQkJCQkJICB0aW1lb3V0KTsKIAogCS8qIHJldCA9PSAwIG1lYW5zIG5v
dCBzaWduYWxlZCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9rbXMuYwppbmRleCAw
Y2Y3ZTg2MDZmZDMuLjI1MmY3MWU5MDk1MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9rbXMuYwpAQCAtMTA4OCw3ICsxMDg4LDcgQEAgdm9pZCBhbWRncHVfZHJpdmVyX3Bvc3Rj
bG9zZV9rbXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlhbWRncHVfdm1fZmluaShhZGV2LCAm
ZnByaXYtPnZtKTsKIAogCWlmIChwYXNpZCkKLQkJYW1kZ3B1X3Bhc2lkX2ZyZWVfZGVsYXllZChw
ZC0+dGJvLnJlc3YsIHBhc2lkKTsKKwkJYW1kZ3B1X3Bhc2lkX2ZyZWVfZGVsYXllZChwZC0+dGJv
LmJhc2UucmVzdiwgcGFzaWQpOwogCWFtZGdwdV9ib191bnJlZigmcGQpOwogCiAJaWRyX2Zvcl9l
YWNoX2VudHJ5KCZmcHJpdi0+Ym9fbGlzdF9oYW5kbGVzLCBsaXN0LCBoYW5kbGUpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9tbi5jCmluZGV4IDM5NzFjMjAxZjMyMC4uNTAwMjJhY2M4
YTgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfbW4uYwpAQCAtMTc5LDcgKzE3
OSw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV9tbl9pbnZhbGlkYXRlX25vZGUoc3RydWN0IGFtZGdw
dV9tbl9ub2RlICpub2RlLAogCQlpZiAoIWFtZGdwdV90dG1fdHRfYWZmZWN0X3VzZXJwdHIoYm8t
PnRiby50dG0sIHN0YXJ0LCBlbmQpKQogCQkJY29udGludWU7CiAKLQkJciA9IHJlc2VydmF0aW9u
X29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8ucmVzdiwKKwkJciA9IHJlc2VydmF0aW9u
X29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8uYmFzZS5yZXN2LAogCQkJdHJ1ZSwgZmFs
c2UsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYgKHIgPD0gMCkKIAkJCURSTV9FUlJPUigi
KCVsZCkgZmFpbGVkIHRvIHdhaXQgZm9yIHVzZXIgYm9cbiIsIHIpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCmluZGV4IDhkNjQ5ZDhhNzMwMi4uZTU1MGI3ZGU4
Mzk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCkBAIC01
MDksOCArNTA5LDYgQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2LAogCWlmICh1bmxpa2VseShyICE9IDApKQogCQlyZXR1cm4gcjsKIAot
CWJvLT50Ym8uYmFzZS5yZXN2ID0gYm8tPnRiby5yZXN2OwotCiAJaWYgKCFhbWRncHVfZ21jX3Zy
YW1fZnVsbF92aXNpYmxlKCZhZGV2LT5nbWMpICYmCiAJICAgIGJvLT50Ym8ubWVtLm1lbV90eXBl
ID09IFRUTV9QTF9WUkFNICYmCiAJICAgIGJvLT50Ym8ubWVtLnN0YXJ0IDwgYWRldi0+Z21jLnZp
c2libGVfdnJhbV9zaXplID4+IFBBR0VfU0hJRlQpCkBAIC01MjMsNyArNTIxLDcgQEAgc3RhdGlj
IGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCSAg
ICBiby0+dGJvLm1lbS5wbGFjZW1lbnQgJiBUVE1fUExfRkxBR19WUkFNKSB7CiAJCXN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlOwogCi0JCXIgPSBhbWRncHVfZmlsbF9idWZmZXIoYm8sIDAsIGJvLT50
Ym8ucmVzdiwgJmZlbmNlKTsKKwkJciA9IGFtZGdwdV9maWxsX2J1ZmZlcihibywgMCwgYm8tPnRi
by5iYXNlLnJlc3YsICZmZW5jZSk7CiAJCWlmICh1bmxpa2VseShyKSkKIAkJCWdvdG8gZmFpbF91
bnJlc2VydmU7CiAKQEAgLTU0Niw3ICs1NDQsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19j
cmVhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAKIGZhaWxfdW5yZXNlcnZlOgogCWlm
ICghYnAtPnJlc3YpCi0JCXd3X211dGV4X3VubG9jaygmYm8tPnRiby5yZXN2LT5sb2NrKTsKKwkJ
d3dfbXV0ZXhfdW5sb2NrKCZiby0+dGJvLmJhc2UucmVzdi0+bG9jayk7CiAJYW1kZ3B1X2JvX3Vu
cmVmKCZibyk7CiAJcmV0dXJuIHI7CiB9CkBAIC01NjcsNyArNTY1LDcgQEAgc3RhdGljIGludCBh
bWRncHVfYm9fY3JlYXRlX3NoYWRvdyhzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlicC5m
bGFncyA9IEFNREdQVV9HRU1fQ1JFQVRFX0NQVV9HVFRfVVNXQyB8CiAJCUFNREdQVV9HRU1fQ1JF
QVRFX1NIQURPVzsKIAlicC50eXBlID0gdHRtX2JvX3R5cGVfa2VybmVsOwotCWJwLnJlc3YgPSBi
by0+dGJvLnJlc3Y7CisJYnAucmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2OwogCiAJciA9IGFtZGdw
dV9ib19kb19jcmVhdGUoYWRldiwgJmJwLCAmYm8tPnNoYWRvdyk7CiAJaWYgKCFyKSB7CkBAIC02
MDgsMTMgKzYwNiwxMyBAQCBpbnQgYW1kZ3B1X2JvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKIAogCWlmICgoZmxhZ3MgJiBBTURHUFVfR0VNX0NSRUFURV9TSEFET1cpICYmICEo
YWRldi0+ZmxhZ3MgJiBBTURfSVNfQVBVKSkgewogCQlpZiAoIWJwLT5yZXN2KQotCQkJV0FSTl9P
TihyZXNlcnZhdGlvbl9vYmplY3RfbG9jaygoKmJvX3B0ciktPnRiby5yZXN2LAorCQkJV0FSTl9P
TihyZXNlcnZhdGlvbl9vYmplY3RfbG9jaygoKmJvX3B0ciktPnRiby5iYXNlLnJlc3YsCiAJCQkJ
CQkJTlVMTCkpOwogCiAJCXIgPSBhbWRncHVfYm9fY3JlYXRlX3NoYWRvdyhhZGV2LCBicC0+c2l6
ZSwgKmJvX3B0cik7CiAKIAkJaWYgKCFicC0+cmVzdikKLQkJCXJlc2VydmF0aW9uX29iamVjdF91
bmxvY2soKCpib19wdHIpLT50Ym8ucmVzdik7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2Nr
KCgqYm9fcHRyKS0+dGJvLmJhc2UucmVzdik7CiAKIAkJaWYgKHIpCiAJCQlhbWRncHVfYm9fdW5y
ZWYoYm9fcHRyKTsKQEAgLTcxMSw3ICs3MDksNyBAQCBpbnQgYW1kZ3B1X2JvX2ttYXAoc3RydWN0
IGFtZGdwdV9ibyAqYm8sIHZvaWQgKipwdHIpCiAJCXJldHVybiAwOwogCX0KIAotCXIgPSByZXNl
cnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLnJlc3YsIGZhbHNlLCBmYWxz
ZSwKKwlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYm8tPnRiby5iYXNl
LnJlc3YsIGZhbHNlLCBmYWxzZSwKIAkJCQkJCU1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAo
ciA8IDApCiAJCXJldHVybiByOwpAQCAtMTA4OSw3ICsxMDg3LDcgQEAgaW50IGFtZGdwdV9ib19z
ZXRfdGlsaW5nX2ZsYWdzKHN0cnVjdCBhbWRncHVfYm8gKmJvLCB1NjQgdGlsaW5nX2ZsYWdzKQog
ICovCiB2b2lkIGFtZGdwdV9ib19nZXRfdGlsaW5nX2ZsYWdzKHN0cnVjdCBhbWRncHVfYm8gKmJv
LCB1NjQgKnRpbGluZ19mbGFncykKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLnJl
c3YtPmxvY2suYmFzZSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5iYXNlLnJlc3Yt
PmxvY2suYmFzZSk7CiAKIAlpZiAodGlsaW5nX2ZsYWdzKQogCQkqdGlsaW5nX2ZsYWdzID0gYm8t
PnRpbGluZ19mbGFnczsKQEAgLTEyODUsNyArMTI4Myw3IEBAIGludCBhbWRncHVfYm9fZmF1bHRf
cmVzZXJ2ZV9ub3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIHZvaWQgYW1kZ3B1
X2JvX2ZlbmNlKHN0cnVjdCBhbWRncHVfYm8gKmJvLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwK
IAkJICAgICBib29sIHNoYXJlZCkKIHsKLQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2
ID0gYm8tPnRiby5yZXN2OworCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBiby0+
dGJvLmJhc2UucmVzdjsKIAogCWlmIChzaGFyZWQpCiAJCXJlc2VydmF0aW9uX29iamVjdF9hZGRf
c2hhcmVkX2ZlbmNlKHJlc3YsIGZlbmNlKTsKQEAgLTEzMTAsNyArMTMwOCw3IEBAIGludCBhbWRn
cHVfYm9fc3luY193YWl0KHN0cnVjdCBhbWRncHVfYm8gKmJvLCB2b2lkICpvd25lciwgYm9vbCBp
bnRyKQogCWludCByOwogCiAJYW1kZ3B1X3N5bmNfY3JlYXRlKCZzeW5jKTsKLQlhbWRncHVfc3lu
Y19yZXN2KGFkZXYsICZzeW5jLCBiby0+dGJvLnJlc3YsIG93bmVyLCBmYWxzZSk7CisJYW1kZ3B1
X3N5bmNfcmVzdihhZGV2LCAmc3luYywgYm8tPnRiby5iYXNlLnJlc3YsIG93bmVyLCBmYWxzZSk7
CiAJciA9IGFtZGdwdV9zeW5jX3dhaXQoJnN5bmMsIGludHIpOwogCWFtZGdwdV9zeW5jX2ZyZWUo
JnN5bmMpOwogCkBAIC0xMzMwLDcgKzEzMjgsNyBAQCBpbnQgYW1kZ3B1X2JvX3N5bmNfd2FpdChz
dHJ1Y3QgYW1kZ3B1X2JvICpibywgdm9pZCAqb3duZXIsIGJvb2wgaW50cikKIHU2NCBhbWRncHVf
Ym9fZ3B1X29mZnNldChzdHJ1Y3QgYW1kZ3B1X2JvICpibykKIHsKIAlXQVJOX09OX09OQ0UoYm8t
PnRiby5tZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1NZU1RFTSk7Ci0JV0FSTl9PTl9PTkNFKCF3d19t
dXRleF9pc19sb2NrZWQoJmJvLT50Ym8ucmVzdi0+bG9jaykgJiYKKwlXQVJOX09OX09OQ0UoIXd3
X211dGV4X2lzX2xvY2tlZCgmYm8tPnRiby5iYXNlLnJlc3YtPmxvY2spICYmCiAJCSAgICAgIWJv
LT5waW5fY291bnQgJiYgYm8tPnRiby50eXBlICE9IHR0bV9ib190eXBlX2tlcm5lbCk7CiAJV0FS
Tl9PTl9PTkNFKGJvLT50Ym8ubWVtLnN0YXJ0ID09IEFNREdQVV9CT19JTlZBTElEX09GRlNFVCk7
CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVtLm1lbV90eXBlID09IFRUTV9QTF9WUkFNICYmCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggYjM5YjUwMTc1OGRkLi5l
OGE1MWU4ZDk0ZjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAg
LTQ0MCw3ICs0NDAsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9tb3ZlX2JsaXQoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibywKIAogCXIgPSBhbWRncHVfdHRtX2NvcHlfbWVtX3RvX21lbShhZGV2
LCAmc3JjLCAmZHN0LAogCQkJCSAgICAgICBuZXdfbWVtLT5udW1fcGFnZXMgPDwgUEFHRV9TSElG
VCwKLQkJCQkgICAgICAgYm8tPnJlc3YsICZmZW5jZSk7CisJCQkJICAgICAgIGJvLT5iYXNlLnJl
c3YsICZmZW5jZSk7CiAJaWYgKHIpCiAJCWdvdG8gZXJyb3I7CiAKQEAgLTE0NzgsMTQgKzE0Nzgs
MTQgQEAgc3RhdGljIGJvb2wgYW1kZ3B1X3R0bV9ib19ldmljdGlvbl92YWx1YWJsZShzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCSAqIGNsZWFubHkgaGFuZGxlIHBhZ2UgZmF1bHRzLgog
CSAqLwogCWlmIChiby0+dHlwZSA9PSB0dG1fYm9fdHlwZV9rZXJuZWwgJiYKLQkgICAgIXJlc2Vy
dmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVkX3JjdShiby0+cmVzdiwgdHJ1ZSkpCisJICAgICFy
ZXNlcnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3UoYm8tPmJhc2UucmVzdiwgdHJ1ZSkp
CiAJCXJldHVybiBmYWxzZTsKIAogCS8qIElmIGJvIGlzIGEgS0ZEIEJPLCBjaGVjayBpZiB0aGUg
Ym8gYmVsb25ncyB0byB0aGUgY3VycmVudCBwcm9jZXNzLgogCSAqIElmIHRydWUsIHRoZW4gcmV0
dXJuIGZhbHNlIGFzIGFueSBLRkQgcHJvY2VzcyBuZWVkcyBhbGwgaXRzIEJPcyB0bwogCSAqIGJl
IHJlc2lkZW50IHRvIHJ1biBzdWNjZXNzZnVsbHkKIAkgKi8KLQlmbGlzdCA9IHJlc2VydmF0aW9u
X29iamVjdF9nZXRfbGlzdChiby0+cmVzdik7CisJZmxpc3QgPSByZXNlcnZhdGlvbl9vYmplY3Rf
Z2V0X2xpc3QoYm8tPmJhc2UucmVzdik7CiAJaWYgKGZsaXN0KSB7CiAJCWZvciAoaSA9IDA7IGkg
PCBmbGlzdC0+c2hhcmVkX2NvdW50OyArK2kpIHsKIAkJCWYgPSByY3VfZGVyZWZlcmVuY2VfcHJv
dGVjdGVkKGZsaXN0LT5zaGFyZWRbaV0sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfdXZkLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
dXZkLmMKaW5kZXggNWIyZmVhM2I0YTJjLi5mODU4NjA3YjE3YTUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV91dmQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdXZkLmMKQEAgLTEwNzMsNyArMTA3Myw3IEBAIHN0YXRpYyBpbnQg
YW1kZ3B1X3V2ZF9zZW5kX21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHN0cnVjdCBhbWRn
cHVfYm8gKmJvLAogCWliLT5sZW5ndGhfZHcgPSAxNjsKIAogCWlmIChkaXJlY3QpIHsKLQkJciA9
IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8ucmVzdiwKKwkJciA9
IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KGJvLT50Ym8uYmFzZS5yZXN2LAog
CQkJCQkJCXRydWUsIGZhbHNlLAogCQkJCQkJCW1zZWNzX3RvX2ppZmZpZXMoMTApKTsKIAkJaWYg
KHIgPT0gMCkKQEAgLTEwODUsNyArMTA4NSw3IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3V2ZF9zZW5k
X21zZyhzdHJ1Y3QgYW1kZ3B1X3JpbmcgKnJpbmcsIHN0cnVjdCBhbWRncHVfYm8gKmJvLAogCQlp
ZiAocikKIAkJCWdvdG8gZXJyX2ZyZWU7CiAJfSBlbHNlIHsKLQkJciA9IGFtZGdwdV9zeW5jX3Jl
c3YoYWRldiwgJmpvYi0+c3luYywgYm8tPnRiby5yZXN2LAorCQlyID0gYW1kZ3B1X3N5bmNfcmVz
dihhZGV2LCAmam9iLT5zeW5jLCBiby0+dGJvLmJhc2UucmVzdiwKIAkJCQkgICAgIEFNREdQVV9G
RU5DRV9PV05FUl9VTkRFRklORUQsIGZhbHNlKTsKIAkJaWYgKHIpCiAJCQlnb3RvIGVycl9mcmVl
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm0uYwppbmRleCAyNGMzYzA1ZTJmYjcu
LmVkNjg1NzhiNjRkYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKQEAg
LTMwMiw3ICszMDIsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdm1fYm9fYmFzZV9pbml0KHN0cnVj
dCBhbWRncHVfdm1fYm9fYmFzZSAqYmFzZSwKIAliYXNlLT5uZXh0ID0gYm8tPnZtX2JvOwogCWJv
LT52bV9ibyA9IGJhc2U7CiAKLQlpZiAoYm8tPnRiby5yZXN2ICE9IHZtLT5yb290LmJhc2UuYm8t
PnRiby5yZXN2KQorCWlmIChiby0+dGJvLmJhc2UucmVzdiAhPSB2bS0+cm9vdC5iYXNlLmJvLT50
Ym8uYmFzZS5yZXN2KQogCQlyZXR1cm47CiAKIAl2bS0+YnVsa19tb3ZlYWJsZSA9IGZhbHNlOwpA
QCAtNTgzLDcgKzU4Myw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2RlbF9mcm9tX2xydV9ub3RpZnkoc3Ry
dWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAlmb3IgKGJvX2Jhc2UgPSBhYm8tPnZtX2JvOyBi
b19iYXNlOyBib19iYXNlID0gYm9fYmFzZS0+bmV4dCkgewogCQlzdHJ1Y3QgYW1kZ3B1X3ZtICp2
bSA9IGJvX2Jhc2UtPnZtOwogCi0JCWlmIChhYm8tPnRiby5yZXN2ID09IHZtLT5yb290LmJhc2Uu
Ym8tPnRiby5yZXN2KQorCQlpZiAoYWJvLT50Ym8uYmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2Uu
Ym8tPnRiby5iYXNlLnJlc3YpCiAJCQl2bS0+YnVsa19tb3ZlYWJsZSA9IGZhbHNlOwogCX0KIApA
QCAtODM0LDcgKzgzNCw3IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV92bV9ib19wYXJhbShzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAqdm0sCiAJCWJwLT5mbGFncyB8
PSBBTURHUFVfR0VNX0NSRUFURV9TSEFET1c7CiAJYnAtPnR5cGUgPSB0dG1fYm9fdHlwZV9rZXJu
ZWw7CiAJaWYgKHZtLT5yb290LmJhc2UuYm8pCi0JCWJwLT5yZXN2ID0gdm0tPnJvb3QuYmFzZS5i
by0+dGJvLnJlc3Y7CisJCWJwLT5yZXN2ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVz
djsKIH0KIAogLyoqCkBAIC0xNzAyLDcgKzE3MDIsNyBAQCBpbnQgYW1kZ3B1X3ZtX2JvX3VwZGF0
ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJCXR0bSA9IGNvbnRhaW5lcl9vZihiby0+
dGJvLnR0bSwgc3RydWN0IHR0bV9kbWFfdHQsIHR0bSk7CiAJCQlwYWdlc19hZGRyID0gdHRtLT5k
bWFfYWRkcmVzczsKIAkJfQotCQlleGNsdXNpdmUgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4
Y2woYm8tPnRiby5yZXN2KTsKKwkJZXhjbHVzaXZlID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9l
eGNsKGJvLT50Ym8uYmFzZS5yZXN2KTsKIAl9CiAKIAlpZiAoYm8pIHsKQEAgLTE3MTIsNyArMTcx
Miw3IEBAIGludCBhbWRncHVfdm1fYm9fdXBkYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
LAogCQlmbGFncyA9IDB4MDsKIAl9CiAKLQlpZiAoY2xlYXIgfHwgKGJvICYmIGJvLT50Ym8ucmVz
diA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikpCisJaWYgKGNsZWFyIHx8IChibyAmJiBi
by0+dGJvLmJhc2UucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2KSkKIAkJ
bGFzdF91cGRhdGUgPSAmdm0tPmxhc3RfdXBkYXRlOwogCWVsc2UKIAkJbGFzdF91cGRhdGUgPSAm
Ym9fdmEtPmxhc3RfcHRfdXBkYXRlOwpAQCAtMTc0Myw3ICsxNzQzLDcgQEAgaW50IGFtZGdwdV92
bV9ib191cGRhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJICogdGhlIGV2aWN0ZWQg
bGlzdCBzbyB0aGF0IGl0IGdldHMgdmFsaWRhdGVkIGFnYWluIG9uIHRoZQogCSAqIG5leHQgY29t
bWFuZCBzdWJtaXNzaW9uLgogCSAqLwotCWlmIChibyAmJiBiby0+dGJvLnJlc3YgPT0gdm0tPnJv
b3QuYmFzZS5iby0+dGJvLnJlc3YpIHsKKwlpZiAoYm8gJiYgYm8tPnRiby5iYXNlLnJlc3YgPT0g
dm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdikgewogCQl1aW50MzJfdCBtZW1fdHlwZSA9
IGJvLT50Ym8ubWVtLm1lbV90eXBlOwogCiAJCWlmICghKGJvLT5wcmVmZXJyZWRfZG9tYWlucyAm
IGFtZGdwdV9tZW1fdHlwZV90b19kb21haW4obWVtX3R5cGUpKSkKQEAgLTE4NzksNyArMTg3OSw3
IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV92bV9mcmVlX21hcHBpbmcoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCiAgKi8KIHN0YXRpYyB2b2lkIGFtZGdwdV92bV9wcnRfZmluaShzdHJ1Y3QgYW1k
Z3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAqdm0pCiB7Ci0Jc3RydWN0IHJlc2Vy
dmF0aW9uX29iamVjdCAqcmVzdiA9IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2OworCXN0cnVj
dCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5y
ZXN2OwogCXN0cnVjdCBkbWFfZmVuY2UgKmV4Y2wsICoqc2hhcmVkOwogCXVuc2lnbmVkIGksIHNo
YXJlZF9jb3VudDsKIAlpbnQgcjsKQEAgLTE5OTMsNyArMTk5Myw3IEBAIGludCBhbWRncHVfdm1f
aGFuZGxlX21vdmVkKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCXdoaWxlICghbGlzdF9l
bXB0eSgmdm0tPmludmFsaWRhdGVkKSkgewogCQlib192YSA9IGxpc3RfZmlyc3RfZW50cnkoJnZt
LT5pbnZhbGlkYXRlZCwgc3RydWN0IGFtZGdwdV9ib192YSwKIAkJCQkJIGJhc2Uudm1fc3RhdHVz
KTsKLQkJcmVzdiA9IGJvX3ZhLT5iYXNlLmJvLT50Ym8ucmVzdjsKKwkJcmVzdiA9IGJvX3ZhLT5i
YXNlLmJvLT50Ym8uYmFzZS5yZXN2OwogCQlzcGluX3VubG9jaygmdm0tPmludmFsaWRhdGVkX2xv
Y2spOwogCiAJCS8qIFRyeSB0byByZXNlcnZlIHRoZSBCTyB0byBhdm9pZCBjbGVhcmluZyBpdHMg
cHRlcyAqLwpAQCAtMjA4NCw3ICsyMDg0LDcgQEAgc3RhdGljIHZvaWQgYW1kZ3B1X3ZtX2JvX2lu
c2VydF9tYXAoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJaWYgKG1hcHBpbmctPmZsYWdz
ICYgQU1ER1BVX1BURV9QUlQpCiAJCWFtZGdwdV92bV9wcnRfZ2V0KGFkZXYpOwogCi0JaWYgKGJv
ICYmIGJvLT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdiAmJgorCWlmIChi
byAmJiBiby0+dGJvLmJhc2UucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2
ICYmCiAJICAgICFib192YS0+YmFzZS5tb3ZlZCkgewogCQlsaXN0X21vdmUoJmJvX3ZhLT5iYXNl
LnZtX3N0YXR1cywgJnZtLT5tb3ZlZCk7CiAJfQpAQCAtMjQxNiw3ICsyNDE2LDcgQEAgdm9pZCBh
bWRncHVfdm1fYm9fdHJhY2VfY3Moc3RydWN0IGFtZGdwdV92bSAqdm0sIHN0cnVjdCB3d19hY3F1
aXJlX2N0eCAqdGlja2V0KQogCQkJc3RydWN0IGFtZGdwdV9ibyAqYm87CiAKIAkJCWJvID0gbWFw
cGluZy0+Ym9fdmEtPmJhc2UuYm87Ci0JCQlpZiAoUkVBRF9PTkNFKGJvLT50Ym8ucmVzdi0+bG9j
ay5jdHgpICE9IHRpY2tldCkKKwkJCWlmIChSRUFEX09OQ0UoYm8tPnRiby5iYXNlLnJlc3YtPmxv
Y2suY3R4KSAhPSB0aWNrZXQpCiAJCQkJY29udGludWU7CiAJCX0KIApAQCAtMjQ0Myw3ICsyNDQz
LDcgQEAgdm9pZCBhbWRncHVfdm1fYm9fcm12KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAog
CXN0cnVjdCBhbWRncHVfdm1fYm9fYmFzZSAqKmJhc2U7CiAKIAlpZiAoYm8pIHsKLQkJaWYgKGJv
LT50Ym8ucmVzdiA9PSB2bS0+cm9vdC5iYXNlLmJvLT50Ym8ucmVzdikKKwkJaWYgKGJvLT50Ym8u
YmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJCQl2bS0+YnVs
a19tb3ZlYWJsZSA9IGZhbHNlOwogCiAJCWZvciAoYmFzZSA9ICZib192YS0+YmFzZS5iby0+dm1f
Ym87ICpiYXNlOwpAQCAtMjUwNyw3ICsyNTA3LDcgQEAgdm9pZCBhbWRncHVfdm1fYm9faW52YWxp
ZGF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAlmb3IgKGJvX2Jhc2UgPSBiby0+dm1f
Ym87IGJvX2Jhc2U7IGJvX2Jhc2UgPSBib19iYXNlLT5uZXh0KSB7CiAJCXN0cnVjdCBhbWRncHVf
dm0gKnZtID0gYm9fYmFzZS0+dm07CiAKLQkJaWYgKGV2aWN0ZWQgJiYgYm8tPnRiby5yZXN2ID09
IHZtLT5yb290LmJhc2UuYm8tPnRiby5yZXN2KSB7CisJCWlmIChldmljdGVkICYmIGJvLT50Ym8u
YmFzZS5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpIHsKIAkJCWFtZGdw
dV92bV9ib19ldmljdGVkKGJvX2Jhc2UpOwogCQkJY29udGludWU7CiAJCX0KQEAgLTI1MTgsNyAr
MjUxOCw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2JvX2ludmFsaWRhdGUoc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYsCiAKIAkJaWYgKGJvLT50Ym8udHlwZSA9PSB0dG1fYm9fdHlwZV9rZXJuZWwpCiAJ
CQlhbWRncHVfdm1fYm9fcmVsb2NhdGVkKGJvX2Jhc2UpOwotCQllbHNlIGlmIChiby0+dGJvLnJl
c3YgPT0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLnJlc3YpCisJCWVsc2UgaWYgKGJvLT50Ym8uYmFz
ZS5yZXN2ID09IHZtLT5yb290LmJhc2UuYm8tPnRiby5iYXNlLnJlc3YpCiAJCQlhbWRncHVfdm1f
Ym9fbW92ZWQoYm9fYmFzZSk7CiAJCWVsc2UKIAkJCWFtZGdwdV92bV9ib19pbnZhbGlkYXRlZChi
b19iYXNlKTsKQEAgLTI2NDgsNyArMjY0OCw3IEBAIHZvaWQgYW1kZ3B1X3ZtX2FkanVzdF9zaXpl
KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCBtaW5fdm1fc2l6ZSwKICAqLwog
bG9uZyBhbWRncHVfdm1fd2FpdF9pZGxlKHN0cnVjdCBhbWRncHVfdm0gKnZtLCBsb25nIHRpbWVv
dXQpCiB7Ci0JcmV0dXJuIHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KHZtLT5y
b290LmJhc2UuYm8tPnRiby5yZXN2LAorCXJldHVybiByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90
aW1lb3V0X3JjdSh2bS0+cm9vdC5iYXNlLmJvLT50Ym8uYmFzZS5yZXN2LAogCQkJCQkJICAgdHJ1
ZSwgdHJ1ZSwgdGltZW91dCk7CiB9CiAKQEAgLTI3MjMsNyArMjcyMyw3IEBAIGludCBhbWRncHVf
dm1faW5pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwgc3RydWN0IGFtZGdwdV92bSAqdm0s
CiAJaWYgKHIpCiAJCWdvdG8gZXJyb3JfZnJlZV9yb290OwogCi0JciA9IHJlc2VydmF0aW9uX29i
amVjdF9yZXNlcnZlX3NoYXJlZChyb290LT50Ym8ucmVzdiwgMSk7CisJciA9IHJlc2VydmF0aW9u
X29iamVjdF9yZXNlcnZlX3NoYXJlZChyb290LT50Ym8uYmFzZS5yZXN2LCAxKTsKIAlpZiAocikK
IAkJZ290byBlcnJvcl91bnJlc2VydmU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdm1fc2RtYS5jCmluZGV4IGRkZDE4MWY1ZWQzNy4uNjFmYzU4NGNiYjFhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdm1fc2RtYS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bV9zZG1hLmMKQEAgLTcyLDcgKzcyLDcg
QEAgc3RhdGljIGludCBhbWRncHVfdm1fc2RtYV9wcmVwYXJlKHN0cnVjdCBhbWRncHVfdm1fdXBk
YXRlX3BhcmFtcyAqcCwKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlyID0gYW1kZ3B1X3N5bmNf
cmVzdihwLT5hZGV2LCAmcC0+am9iLT5zeW5jLCByb290LT50Ym8ucmVzdiwKKwlyID0gYW1kZ3B1
X3N5bmNfcmVzdihwLT5hZGV2LCAmcC0+am9iLT5zeW5jLCByb290LT50Ym8uYmFzZS5yZXN2LAog
CQkJICAgICBvd25lciwgZmFsc2UpOwogCWlmIChyKQogCQlyZXR1cm4gcjsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCmluZGV4IDRhMjlm
NzIzMzRkMC4uMzgxYTUzNDVmMTk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rp
c3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlz
cGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmMKQEAgLTU2OTMsNyArNTY5Myw3IEBAIHN0YXRpYyB2
b2lkIGFtZGdwdV9kbV9jb21taXRfcGxhbmVzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZSwKIAkJICogZGVhZGxvY2sgZHVyaW5nIEdQVSByZXNldCB3aGVuIHRoaXMgZmVuY2Ugd2lsbCBu
b3Qgc2lnbmFsCiAJCSAqIGJ1dCB3ZSBob2xkIHJlc2VydmF0aW9uIGxvY2sgZm9yIHRoZSBCTy4K
IAkJICovCi0JCXIgPSByZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShhYm8tPnRi
by5yZXN2LCB0cnVlLAorCQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3Uo
YWJvLT50Ym8uYmFzZS5yZXN2LCB0cnVlLAogCQkJCQkJCWZhbHNlLAogCQkJCQkJCW1zZWNzX3Rv
X2ppZmZpZXMoNTAwMCkpOwogCQlpZiAodW5saWtlbHkociA8PSAwKSkKLS0gCjIuMTguMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
