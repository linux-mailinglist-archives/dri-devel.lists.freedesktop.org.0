Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 58DE2EE8B9
	for <lists+dri-devel@lfdr.de>; Mon,  4 Nov 2019 20:35:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B0E186E837;
	Mon,  4 Nov 2019 19:35:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from verein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8C17C6E2CD
 for <dri-devel@lists.freedesktop.org>; Mon,  4 Nov 2019 11:06:10 +0000 (UTC)
Received: by verein.lst.de (Postfix, from userid 2005)
 id C05F068C4E; Mon,  4 Nov 2019 12:06:07 +0100 (CET)
In-Reply-To: <20191104110400.F319F68BE1@verein.lst.de>
References: <20191104110400.F319F68BE1@verein.lst.de>
From: Torsten Duwe <duwe@lst.de>
Date: Tue, 29 Oct 2019 13:16:57 +0100
Subject: [PATCH v5 3/7] drm/bridge: extract some Analogix I2C DP common code
To: Maxime Ripard <mripard@kernel.org>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Message-Id: <20191104110607.C05F068C4E@verein.lst.de>
X-Mailman-Approved-At: Mon, 04 Nov 2019 19:35:10 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKU29tZSBjb2RlIGNhbiBiZSBz
aGFyZWQgd2l0aGluIGRpZmZlcmVudCBEUCBicmlkZ2VzIGJ5IEFuYWxvZ2l4LgpFeHRyYWN0IHRo
ZW0gdG8gYW5hbG9naXhfZHAuCgpTaWduZWQtb2ZmLWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5
QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2lseSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFp
bC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4gRHV3ZSA8ZHV3ZUBzdXNlLmRlPgpSZXZpZXdl
ZC1ieTogQW5kcnplaiBIYWpkYSA8YS5oYWpkYUBzYW1zdW5nLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vYnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlICAgICAgICAgICB8ICAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1hbng3OHh4LmMgfCAxNDYgKy0tLS0t
LS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtaTJjLWRw
dHguYyAgICB8IDE2NSArKysrKysrKysrKysrKysrKysrKysKIC4uLi9ncHUvZHJtL2JyaWRnZS9h
bmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oICAgIHwgICAzICsKIDQgZmlsZXMgY2hhbmdlZCwg
MTcwIGluc2VydGlvbnMoKyksIDE0NiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZQppbmRleCA2ZmNiZmQzZWU1NjAuLjc2
MjNiOWI4MDE2NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9N
YWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlCkBA
IC0xLDQgKzEsNCBAQAogIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5Ci1h
bmFsb2dpeF9kcC1vYmpzIDo9IGFuYWxvZ2l4X2RwX2NvcmUubyBhbmFsb2dpeF9kcF9yZWcubwor
YW5hbG9naXhfZHAtb2JqcyA6PSBhbmFsb2dpeF9kcF9jb3JlLm8gYW5hbG9naXhfZHBfcmVnLm8g
YW5hbG9naXgtaTJjLWRwdHgubwogb2JqLSQoQ09ORklHX0RSTV9BTkFMT0dJWF9BTlg3OFhYKSAr
PSBhbmFsb2dpeC1hbng3OHh4Lm8KIG9iai0kKENPTkZJR19EUk1fQU5BTE9HSVhfRFApICs9IGFu
YWxvZ2l4X2RwLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgv
YW5hbG9naXgtYW54Nzh4eC5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFs
b2dpeC1hbng3OHh4LmMKaW5kZXggM2M3Y2M1YWY3MzVjLi5jMzZlMmM5NDQ1YTMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54Nzh4eC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54Nzh4eC5jCkBA
IC0zNSw4ICszNSw2IEBACiAjZGVmaW5lIEkyQ19JRFhfUlhfUDEJCTQKIAogI2RlZmluZSBYVEFM
X0NMSwkJMjcwIC8qIDI3TSAqLwotI2RlZmluZSBBVVhfQ0hfQlVGRkVSX1NJWkUJMTYKLSNkZWZp
bmUgQVVYX1dBSVRfVElNRU9VVF9NUwkxNQogCiBzdGF0aWMgY29uc3QgdTggYW54Nzh4eF9pMmNf
YWRkcmVzc2VzW10gPSB7CiAJW0kyQ19JRFhfVFhfUDBdID0gVFhfUDAsCkBAIC05OSwxNTMgKzk3
LDExIEBAIHN0YXRpYyBpbnQgYW54Nzh4eF9jbGVhcl9iaXRzKHN0cnVjdCByZWdtYXAgKm1hcCwg
dTggcmVnLCB1OCBtYXNrKQogCXJldHVybiByZWdtYXBfdXBkYXRlX2JpdHMobWFwLCByZWcsIG1h
c2ssIDApOwogfQogCi1zdGF0aWMgYm9vbCBhbng3OHh4X2F1eF9vcF9maW5pc2hlZChzdHJ1Y3Qg
YW54Nzh4eCAqYW54Nzh4eCkKLXsKLQl1bnNpZ25lZCBpbnQgdmFsdWU7Ci0JaW50IGVycjsKLQot
CWVyciA9IHJlZ21hcF9yZWFkKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfRFBfQVVY
X0NIX0NUUkwyX1JFRywKLQkJCSAgJnZhbHVlKTsKLQlpZiAoZXJyIDwgMCkKLQkJcmV0dXJuIGZh
bHNlOwotCi0JcmV0dXJuICh2YWx1ZSAmIFNQX0FVWF9FTikgPT0gMDsKLX0KLQotc3RhdGljIGlu
dCBhbng3OHh4X2F1eF93YWl0KHN0cnVjdCBhbng3OHh4ICphbng3OHh4KQotewotCXVuc2lnbmVk
IGxvbmcgdGltZW91dDsKLQl1bnNpZ25lZCBpbnQgc3RhdHVzOwotCWludCBlcnI7Ci0KLQl0aW1l
b3V0ID0gamlmZmllcyArIG1zZWNzX3RvX2ppZmZpZXMoQVVYX1dBSVRfVElNRU9VVF9NUykgKyAx
OwotCi0Jd2hpbGUgKCFhbng3OHh4X2F1eF9vcF9maW5pc2hlZChhbng3OHh4KSkgewotCQlpZiAo
dGltZV9hZnRlcihqaWZmaWVzLCB0aW1lb3V0KSkgewotCQkJaWYgKCFhbng3OHh4X2F1eF9vcF9m
aW5pc2hlZChhbng3OHh4KSkgewotCQkJCURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgQVVY
IHRvIGZpbmlzaFxuIik7Ci0JCQkJcmV0dXJuIC1FVElNRURPVVQ7Ci0JCQl9Ci0KLQkJCWJyZWFr
OwotCQl9Ci0KLQkJdXNsZWVwX3JhbmdlKDEwMDAsIDIwMDApOwotCX0KLQotCS8qIFJlYWQgdGhl
IEFVWCBjaGFubmVsIGFjY2VzcyBzdGF0dXMgKi8KLQllcnIgPSByZWdtYXBfcmVhZChhbng3OHh4
LT5tYXBbSTJDX0lEWF9UWF9QMF0sIFNQX0FVWF9DSF9TVEFUVVNfUkVHLAotCQkJICAmc3RhdHVz
KTsKLQlpZiAoZXJyIDwgMCkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZWFkIGZyb20gQVVY
IGNoYW5uZWw6ICVkXG4iLCBlcnIpOwotCQlyZXR1cm4gZXJyOwotCX0KLQotCWlmIChzdGF0dXMg
JiBTUF9BVVhfU1RBVFVTKSB7Ci0JCURSTV9FUlJPUigiRmFpbGVkIHRvIHdhaXQgZm9yIEFVWCBj
aGFubmVsIChzdGF0dXM6ICUwMngpXG4iLAotCQkJICBzdGF0dXMpOwotCQlyZXR1cm4gLUVUSU1F
RE9VVDsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBhbng3OHh4X2F1eF9hZGRy
ZXNzKHN0cnVjdCBhbng3OHh4ICphbng3OHh4LCB1bnNpZ25lZCBpbnQgYWRkcikKLXsKLQlpbnQg
ZXJyOwotCi0JZXJyID0gcmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwg
U1BfQVVYX0FERFJfN18wX1JFRywKLQkJCSAgIGFkZHIgJiAweGZmKTsKLQlpZiAoZXJyKQotCQly
ZXR1cm4gZXJyOwotCi0JZXJyID0gcmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURYX1RY
X1AwXSwgU1BfQVVYX0FERFJfMTVfOF9SRUcsCi0JCQkgICAoYWRkciAmIDB4ZmYwMCkgPj4gOCk7
Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8qCi0JICogRFAgQVVYIENIIEFkZHJlc3Mg
UmVnaXN0ZXIgIzIsIG9ubHkgdXBkYXRlIGJpdHNbMzowXQotCSAqIFs3OjRdIFJFU0VSVkVECi0J
ICogWzM6MF0gQVVYX0FERFJbMTk6MTZdLCBSZWdpc3RlciBjb250cm9sIEFVWCBDSCBhZGRyZXNz
LgotCSAqLwotCWVyciA9IHJlZ21hcF91cGRhdGVfYml0cyhhbng3OHh4LT5tYXBbSTJDX0lEWF9U
WF9QMF0sCi0JCQkJIFNQX0FVWF9BRERSXzE5XzE2X1JFRywKLQkJCQkgU1BfQVVYX0FERFJfMTlf
MTZfTUFTSywKLQkJCQkgKGFkZHIgJiAweGYwMDAwKSA+PiAxNik7Ci0KLQlpZiAoZXJyKQotCQly
ZXR1cm4gZXJyOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBzc2l6ZV90IGFueDc4eHhfYXV4
X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCiAJCQkJICAgIHN0cnVjdCBkcm1fZHBf
YXV4X21zZyAqbXNnKQogewogCXN0cnVjdCBhbng3OHh4ICphbng3OHh4ID0gY29udGFpbmVyX29m
KGF1eCwgc3RydWN0IGFueDc4eHgsIGF1eCk7Ci0JdTggY3RybDEgPSBtc2ctPnJlcXVlc3Q7Ci0J
dTggY3RybDIgPSBTUF9BVVhfRU47Ci0JdTggKmJ1ZmZlciA9IG1zZy0+YnVmZmVyOwotCWludCBl
cnI7Ci0KLQkvKiBUaGUgRFAgQVVYIHRyYW5zbWl0IGFuZCByZWNlaXZlIGJ1ZmZlciBoYXMgMTYg
Ynl0ZXMuICovCi0JaWYgKFdBUk5fT04obXNnLT5zaXplID4gQVVYX0NIX0JVRkZFUl9TSVpFKSkK
LQkJcmV0dXJuIC1FMkJJRzsKLQotCS8qIFplcm8tc2l6ZWQgbWVzc2FnZXMgc3BlY2lmeSBhZGRy
ZXNzLW9ubHkgdHJhbnNhY3Rpb25zLiAqLwotCWlmIChtc2ctPnNpemUgPCAxKQotCQljdHJsMiB8
PSBTUF9BRERSX09OTFk7Ci0JZWxzZQkvKiBGb3Igbm9uLXplcm8tc2l6ZWQgc2V0IHRoZSBsZW5n
dGggZmllbGQuICovCi0JCWN0cmwxIHw9IChtc2ctPnNpemUgLSAxKSA8PCBTUF9BVVhfTEVOR1RI
X1NISUZUOwotCi0JaWYgKChtc2ctPnJlcXVlc3QgJiBEUF9BVVhfSTJDX1JFQUQpID09IDApIHsK
LQkJLyogV2hlbiBXUklURSB8IE1PVCB3cml0ZSB2YWx1ZXMgdG8gZGF0YSBidWZmZXIgKi8KLQkJ
ZXJyID0gcmVnbWFwX2J1bGtfd3JpdGUoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJ
CQlTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIsCi0JCQkJCW1zZy0+c2l6ZSk7Ci0JCWlmIChl
cnIpCi0JCQlyZXR1cm4gZXJyOwotCX0KLQotCS8qIFdyaXRlIGFkZHJlc3MgYW5kIHJlcXVlc3Qg
Ki8KLQllcnIgPSBhbng3OHh4X2F1eF9hZGRyZXNzKGFueDc4eHgsIG1zZy0+YWRkcmVzcyk7Ci0J
aWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWVyciA9IHJlZ21hcF93cml0ZShhbng3OHh4LT5t
YXBbSTJDX0lEWF9UWF9QMF0sIFNQX0RQX0FVWF9DSF9DVFJMMV9SRUcsCi0JCQkgICBjdHJsMSk7
Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCS8qIFN0YXJ0IHRyYW5zYWN0aW9uICovCi0J
ZXJyID0gcmVnbWFwX3VwZGF0ZV9iaXRzKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwKLQkJ
CQkgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgU1BfQUREUl9PTkxZIHwKLQkJCQkgU1BfQVVYX0VO
LCBjdHJsMik7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCWVyciA9IGFueDc4eHhfYXV4
X3dhaXQoYW54Nzh4eCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCW1zZy0+cmVwbHkg
PSBEUF9BVVhfSTJDX1JFUExZX0FDSzsKLQotCWlmICgobXNnLT5zaXplID4gMCkgJiYgKG1zZy0+
cmVxdWVzdCAmIERQX0FVWF9JMkNfUkVBRCkpIHsKLQkJLyogUmVhZCB2YWx1ZXMgZnJvbSBkYXRh
IGJ1ZmZlciAqLwotCQllcnIgPSByZWdtYXBfYnVsa19yZWFkKGFueDc4eHgtPm1hcFtJMkNfSURY
X1RYX1AwXSwKLQkJCQkgICAgICAgU1BfRFBfQlVGX0RBVEEwX1JFRywgYnVmZmVyLAotCQkJCSAg
ICAgICBtc2ctPnNpemUpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQl9Ci0KLQllcnIg
PSBhbng3OHh4X2NsZWFyX2JpdHMoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJCSBT
UF9EUF9BVVhfQ0hfQ1RSTDJfUkVHLCBTUF9BRERSX09OTFkpOwotCWlmIChlcnIpCi0JCXJldHVy
biBlcnI7Ci0KLQlyZXR1cm4gbXNnLT5zaXplOworCXJldHVybiBhbnhfZHBfYXV4X3RyYW5zZmVy
KGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgbXNnKTsKIH0KIAogc3RhdGljIGludCBhbng3
OHh4X3NldF9ocGQoc3RydWN0IGFueDc4eHggKmFueDc4eHgpCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMgYi9kcml2ZXJzL2dw
dS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi42MDcwN2JiNWFmZTcKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKQEAg
LTAsMCArMSwxNjUgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkg
Ki8KKy8qCisgKiBDb3B5cmlnaHQoYykgMjAxNiwgQW5hbG9naXggU2VtaWNvbmR1Y3Rvci4KKyAq
CisgKiBCYXNlZCBvbiBhbng3ODA4IGRyaXZlciBvYnRhaW5lZCBmcm9tIGNocm9tZW9zIHdpdGgg
Y29weXJpZ2h0OgorICogQ29weXJpZ2h0KGMpIDIwMTMsIEdvb2dsZSBJbmMuCisgKi8KKyNpbmNs
dWRlIDxsaW51eC9yZWdtYXAuaD4KKworI2luY2x1ZGUgPGRybS9kcm0uaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX2RwX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKworI2luY2x1
ZGUgImFuYWxvZ2l4LWkyYy1kcHR4LmgiCisKKyNkZWZpbmUgQVVYX1dBSVRfVElNRU9VVF9NUwkx
NQorI2RlZmluZSBBVVhfQ0hfQlVGRkVSX1NJWkUJMTYKKworc3RhdGljIGludCBhbnhfaTJjX2Rw
X2NsZWFyX2JpdHMoc3RydWN0IHJlZ21hcCAqbWFwLCB1OCByZWcsIHU4IG1hc2spCit7CisJcmV0
dXJuIHJlZ21hcF91cGRhdGVfYml0cyhtYXAsIHJlZywgbWFzaywgMCk7Cit9CisKK3N0YXRpYyBi
b29sIGFueF9kcF9hdXhfb3BfZmluaXNoZWQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJ
dW5zaWduZWQgaW50IHZhbHVlOworCWludCBlcnI7CisKKwllcnIgPSByZWdtYXBfcmVhZChtYXBf
ZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgJnZhbHVlKTsKKwlpZiAoZXJyIDwgMCkKKwkJ
cmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIFNQX0FVWF9FTikgPT0gMDsKK30KKwor
c3RhdGljIGludCBhbnhfZHBfYXV4X3dhaXQoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgpCit7CisJ
dW5zaWduZWQgbG9uZyB0aW1lb3V0OworCXVuc2lnbmVkIGludCBzdGF0dXM7CisJaW50IGVycjsK
KworCXRpbWVvdXQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlmZmllcyhBVVhfV0FJVF9USU1FT1VU
X01TKSArIDE7CisKKwl3aGlsZSAoIWFueF9kcF9hdXhfb3BfZmluaXNoZWQobWFwX2RwdHgpKSB7
CisJCWlmICh0aW1lX2FmdGVyKGppZmZpZXMsIHRpbWVvdXQpKSB7CisJCQlpZiAoIWFueF9kcF9h
dXhfb3BfZmluaXNoZWQobWFwX2RwdHgpKSB7CisJCQkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2Fp
dGluZyBBVVggdG8gZmluaXNoXG4iKTsKKwkJCQlyZXR1cm4gLUVUSU1FRE9VVDsKKwkJCX0KKwor
CQkJYnJlYWs7CisJCX0KKworCQl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisJfQorCisJLyog
UmVhZCB0aGUgQVVYIGNoYW5uZWwgYWNjZXNzIHN0YXR1cyAqLworCWVyciA9IHJlZ21hcF9yZWFk
KG1hcF9kcHR4LCBTUF9BVVhfQ0hfU1RBVFVTX1JFRywgJnN0YXR1cyk7CisJaWYgKGVyciA8IDAp
IHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVhZCBmcm9tIEFVWCBjaGFubmVsOiAlZFxuIiwg
ZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlpZiAoc3RhdHVzICYgU1BfQVVYX1NUQVRVUykg
eworCQlEUk1fRVJST1IoIkZhaWxlZCB0byB3YWl0IGZvciBBVVggY2hhbm5lbCAoc3RhdHVzOiAl
MDJ4KVxuIiwKKwkJCSAgc3RhdHVzKTsKKwkJcmV0dXJuIC1FVElNRURPVVQ7CisJfQorCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYW54X2RwX2F1eF9hZGRyZXNzKHN0cnVjdCByZWdtYXAg
Km1hcF9kcHR4LCB1bnNpZ25lZCBpbnQgYWRkcikKK3sKKwlpbnQgZXJyOworCisJZXJyID0gcmVn
bWFwX3dyaXRlKG1hcF9kcHR4LCBTUF9BVVhfQUREUl83XzBfUkVHLCBhZGRyICYgMHhmZik7CisJ
aWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShtYXBfZHB0eCwg
U1BfQVVYX0FERFJfMTVfOF9SRUcsCisJCQkgICAoYWRkciAmIDB4ZmYwMCkgPj4gOCk7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qCisJICogRFAgQVVYIENIIEFkZHJlc3MgUmVnaXN0
ZXIgIzIsIG9ubHkgdXBkYXRlIGJpdHNbMzowXQorCSAqIFs3OjRdIFJFU0VSVkVECisJICogWzM6
MF0gQVVYX0FERFJbMTk6MTZdLCBSZWdpc3RlciBjb250cm9sIEFVWCBDSCBhZGRyZXNzLgorCSAq
LworCWVyciA9IHJlZ21hcF91cGRhdGVfYml0cyhtYXBfZHB0eCwgU1BfQVVYX0FERFJfMTlfMTZf
UkVHLAorCQkJCSBTUF9BVVhfQUREUl8xOV8xNl9NQVNLLAorCQkJCSAoYWRkciAmIDB4ZjAwMDAp
ID4+IDE2KTsKKworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gMDsKK30KKwor
c3NpemVfdCBhbnhfZHBfYXV4X3RyYW5zZmVyKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LAorCQkJ
CXN0cnVjdCBkcm1fZHBfYXV4X21zZyAqbXNnKQoreworCXU4IGN0cmwxID0gbXNnLT5yZXF1ZXN0
OworCXU4IGN0cmwyID0gU1BfQVVYX0VOOworCXU4ICpidWZmZXIgPSBtc2ctPmJ1ZmZlcjsKKwlp
bnQgZXJyOworCisJLyogVGhlIERQIEFVWCB0cmFuc21pdCBhbmQgcmVjZWl2ZSBidWZmZXIgaGFz
IDE2IGJ5dGVzLiAqLworCWlmIChXQVJOX09OKG1zZy0+c2l6ZSA+IEFVWF9DSF9CVUZGRVJfU0la
RSkpCisJCXJldHVybiAtRTJCSUc7CisKKwkvKiBaZXJvLXNpemVkIG1lc3NhZ2VzIHNwZWNpZnkg
YWRkcmVzcy1vbmx5IHRyYW5zYWN0aW9ucy4gKi8KKwlpZiAobXNnLT5zaXplIDwgMSkKKwkJY3Ry
bDIgfD0gU1BfQUREUl9PTkxZOworCWVsc2UJLyogRm9yIG5vbi16ZXJvLXNpemVkIHNldCB0aGUg
bGVuZ3RoIGZpZWxkLiAqLworCQljdHJsMSB8PSAobXNnLT5zaXplIC0gMSkgPDwgU1BfQVVYX0xF
TkdUSF9TSElGVDsKKworCWlmICgobXNnLT5yZXF1ZXN0ICYgRFBfQVVYX0kyQ19SRUFEKSA9PSAw
KSB7CisJCS8qIFdoZW4gV1JJVEUgfCBNT1Qgd3JpdGUgdmFsdWVzIHRvIGRhdGEgYnVmZmVyICov
CisJCWVyciA9IHJlZ21hcF9idWxrX3dyaXRlKG1hcF9kcHR4LAorCQkJCQlTUF9EUF9CVUZfREFU
QTBfUkVHLCBidWZmZXIsCisJCQkJCW1zZy0+c2l6ZSk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4g
ZXJyOworCX0KKworCS8qIFdyaXRlIGFkZHJlc3MgYW5kIHJlcXVlc3QgKi8KKwllcnIgPSBhbnhf
ZHBfYXV4X2FkZHJlc3MobWFwX2RwdHgsIG1zZy0+YWRkcmVzcyk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NU
UkwxX1JFRywgY3RybDEpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBTdGFydCB0
cmFuc2FjdGlvbiAqLworCWVyciA9IHJlZ21hcF91cGRhdGVfYml0cyhtYXBfZHB0eCwgU1BfRFBf
QVVYX0NIX0NUUkwyX1JFRywKKwkJCQkgU1BfQUREUl9PTkxZIHwgU1BfQVVYX0VOLCBjdHJsMik7
CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGFueF9kcF9hdXhfd2FpdChtYXBf
ZHB0eCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCW1zZy0+cmVwbHkgPSBEUF9BVVhf
STJDX1JFUExZX0FDSzsKKworCWlmICgobXNnLT5zaXplID4gMCkgJiYgKG1zZy0+cmVxdWVzdCAm
IERQX0FVWF9JMkNfUkVBRCkpIHsKKwkJLyogUmVhZCB2YWx1ZXMgZnJvbSBkYXRhIGJ1ZmZlciAq
LworCQllcnIgPSByZWdtYXBfYnVsa19yZWFkKG1hcF9kcHR4LAorCQkJCSAgICAgICBTUF9EUF9C
VUZfREFUQTBfUkVHLCBidWZmZXIsCisJCQkJICAgICAgIG1zZy0+c2l6ZSk7CisJCWlmIChlcnIp
CisJCQlyZXR1cm4gZXJyOworCX0KKworCWVyciA9IGFueF9pMmNfZHBfY2xlYXJfYml0cyhtYXBf
ZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKKwkJCQkgICAgU1BfQUREUl9PTkxZKTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIG1zZy0+c2l6ZTsKK30KK0VYUE9SVF9T
WU1CT0xfR1BMKGFueF9kcF9hdXhfdHJhbnNmZXIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oIGIvZHJpdmVycy9ncHUvZHJt
L2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oCmluZGV4IDYyOTViZTY2OGNhZS4u
NDMwYTAzOWMxMGNkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4
L2FuYWxvZ2l4LWkyYy1kcHR4LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dp
eC9hbmFsb2dpeC1pMmMtZHB0eC5oCkBAIC0yNDQsNCArMjQ0LDcgQEAKIC8qIERQIEFVWCBCdWZm
ZXIgRGF0YSBSZWdpc3RlcnMgKi8KICNkZWZpbmUgU1BfRFBfQlVGX0RBVEEwX1JFRwkJMHhmMAog
Citzc2l6ZV90IGFueF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgsCisJ
CQkJc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpOworCiAjZW5kaWYKLS0gCjIuMTYuNAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
