Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 32DBD10C27E
	for <lists+dri-devel@lfdr.de>; Thu, 28 Nov 2019 03:42:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3C6446E5EC;
	Thu, 28 Nov 2019 02:42:50 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [210.61.82.184])
 by gabe.freedesktop.org (Postfix) with ESMTP id 565336E5EA
 for <dri-devel@lists.freedesktop.org>; Thu, 28 Nov 2019 02:42:47 +0000 (UTC)
X-UUID: 5ac5727df79d448b907539d12212f8cc-20191128
X-UUID: 5ac5727df79d448b907539d12212f8cc-20191128
Received: from mtkcas06.mediatek.inc [(172.21.101.30)] by mailgw02.mediatek.com
 (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 1728962461; Thu, 28 Nov 2019 10:42:42 +0800
Received: from mtkcas07.mediatek.inc (172.21.101.84) by
 mtkmbs05n1.mediatek.inc (172.21.101.15) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Thu, 28 Nov 2019 10:42:31 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas07.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Thu, 28 Nov 2019 10:42:46 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH v1 6/6] drm/mediatek: apply CMDQ control flow
Date: Thu, 28 Nov 2019 10:42:38 +0800
Message-ID: <20191128024238.9399-7-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191128024238.9399-1-bibby.hsieh@mediatek.com>
References: <20191128024238.9399-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=mediatek.com; s=dk; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From;
 bh=k6VM4/UsnlA89IWtcgp+bIwlUMlgMEZvRSQW+Rdw4ko=; 
 b=nVszY4uDZnluYvvDcZLfNlBl+nlhsPRnbBa8BU+zUd0Wx1ktzL6yTrZCKxcQUDwvzrFTO09LH90COcZxaHW7+3qxhjgaLXbWP1A5wPvMYjK5XwjCfeob7vJ5UkAveBSdA8NMaxXRig8+G5QKAD7Dlfk34Bu4pM10vAksbnN7mVY=;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, srv_heupstream@mediatek.com,
 Yongqiang Niu <yongqiang.niu@mediatek.com>, linux-kernel@vger.kernel.org,
 tfiga@chromium.org, Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VW5saWtlIG90aGVyIFNvQ3MsIE1UODE4MyBkb2VzIG5vdCBoYXZlICJzaGFkb3ciDQpyZWdpc3Rl
cnMgZm9yIHBlcmZvcm1haW5nIGFuIGF0b21pYyB2aWRlbyBtb2RlDQpzZXQgb3IgcGFnZSBmbGlw
IGF0IHZibGFuay92c3luYy4NCg0KVGhlIENNRFEgKENvbW1lbmQgUXVldWUpIGluIE1UODE4MyBp
cyB1c2VkIHRvIGhlbHANCnVwZGF0ZSBhbGwgcmVsZXZhbnQgZGlzcGxheSBjb250cm9sbGVyIHJl
Z2lzdGVycw0Kd2l0aCBjcml0aWNhbCB0aW1lIGxpbWF0aW9uLg0KDQpTaWduZWQtb2ZmLWJ5OiBZ
VCBTaGVuIDx5dC5zaGVuQG1lZGlhdGVrLmNvbT4NClNpZ25lZC1vZmYtYnk6IENLIEh1IDxjay5o
dUBtZWRpYXRlay5jb20+DQpTaWduZWQtb2ZmLWJ5OiBQaGlsaXBwIFphYmVsIDxwLnphYmVsQHBl
bmd1dHJvbml4LmRlPg0KU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWggPGJpYmJ5LmhzaWVoQG1l
ZGlhdGVrLmNvbT4NClNpZ25lZC1vZmYtYnk6IFlvbmdxaWFuZyBOaXUgPHlvbmdxaWFuZy5uaXVA
bWVkaWF0ZWsuY29tPg0KLS0tDQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0
Yy5jICAgICB8IDg2ICsrKysrKysrKysrKysrKysrKysrLQ0KIGRyaXZlcnMvZ3B1L2RybS9tZWRp
YXRlay9tdGtfZHJtX2RkcF9jb21wLmMgfCAzMSArKysrKysrKw0KIDIgZmlsZXMgY2hhbmdlZCwg
MTEzIGluc2VydGlvbnMoKyksIDQgZGVsZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0
ZWsvbXRrX2RybV9jcnRjLmMNCmluZGV4IGZjZjRlNzU1ZTBiZC4uMWI0ZTUzN2FjM2MxIDEwMDY0
NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5jDQorKysgYi9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMNCkBAIC0xMiw2ICsxMiw4IEBA
DQogI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+DQogI2luY2x1ZGUgPGRybS9kcm1f
cHJvYmVfaGVscGVyLmg+DQogI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+DQorI2luY2x1ZGUg
PGxpbnV4L29mX2FkZHJlc3MuaD4NCisjaW5jbHVkZSA8bGludXgvc29jL21lZGlhdGVrL210ay1j
bWRxLmg+DQogDQogI2luY2x1ZGUgIm10a19kcm1fZHJ2LmgiDQogI2luY2x1ZGUgIm10a19kcm1f
Y3J0Yy5oIg0KQEAgLTQyLDYgKzQ0LDkgQEAgc3RydWN0IG10a19kcm1fY3J0YyB7DQogCXVuc2ln
bmVkIGludAkJCWxheWVyX25yOw0KIAlib29sCQkJCXBlbmRpbmdfcGxhbmVzOw0KIA0KKwlzdHJ1
Y3QgY21kcV9jbGllbnQJCSpjbWRxX2NsaWVudDsNCisJdTMyCQkJCWNtZHFfZXZlbnQ7DQorDQog
CXZvaWQgX19pb21lbQkJCSpjb25maWdfcmVnczsNCiAJY29uc3Qgc3RydWN0IG10a19tbXN5c19y
ZWdfZGF0YSAqbW1zeXNfcmVnX2RhdGE7DQogCXN0cnVjdCBtdGtfZGlzcF9tdXRleAkJKm11dGV4
Ow0KQEAgLTU2LDYgKzYxLDExIEBAIHN0cnVjdCBtdGtfY3J0Y19zdGF0ZSB7DQogCXVuc2lnbmVk
IGludAkJCXBlbmRpbmdfd2lkdGg7DQogCXVuc2lnbmVkIGludAkJCXBlbmRpbmdfaGVpZ2h0Ow0K
IAl1bnNpZ25lZCBpbnQJCQlwZW5kaW5nX3ZyZWZyZXNoOw0KKwlzdHJ1Y3QgY21kcV9wa3QJCQkq
Y21kcV9oYW5kbGU7DQorfTsNCisNCitzdHJ1Y3QgbXRrX2NtZHFfY2JfZGF0YSB7DQorCXN0cnVj
dCBjbWRxX3BrdAkJCSpjbWRxX2hhbmRsZTsNCiB9Ow0KIA0KIHN0YXRpYyBpbmxpbmUgc3RydWN0
IG10a19kcm1fY3J0YyAqdG9fbXRrX2NydGMoc3RydWN0IGRybV9jcnRjICpjKQ0KQEAgLTIyOSw2
ICsyMzksNDYgQEAgc3RydWN0IG10a19kZHBfY29tcCAqbXRrX2RybV9kZHBfY29tcF9mb3JfcGxh
bmUoc3RydWN0IGRybV9jcnRjICpjcnRjLA0KIAlyZXR1cm4gTlVMTDsNCiB9DQogDQorI2lmZGVm
IENPTkZJR19NVEtfQ01EUQ0KK3N0YXRpYyB2b2lkIGRkcF9jbWRxX2NiKHN0cnVjdCBjbWRxX2Ni
X2RhdGEgZGF0YSkNCit7DQorCXN0cnVjdCBtdGtfY21kcV9jYl9kYXRhICpjYl9kYXRhID0gZGF0
YS5kYXRhOw0KKw0KKwljbWRxX3BrdF9kZXN0cm95KGNiX2RhdGEtPmNtZHFfaGFuZGxlKTsNCisJ
a2ZyZWUoY2JfZGF0YSk7DQorfQ0KKw0KK3N0YXRpYyB2b2lkIG10a19jbWRxX2FjcXVpcmUoc3Ry
dWN0IGRybV9jcnRjICpjcnRjKQ0KK3sNCisJc3RydWN0IG10a19jcnRjX3N0YXRlICptdGtfY3J0
Y19zdGF0ZSA9DQorCQkJdG9fbXRrX2NydGNfc3RhdGUoY3J0Yy0+c3RhdGUpOw0KKwlzdHJ1Y3Qg
bXRrX2RybV9jcnRjICptdGtfY3J0YyA9IHRvX210a19jcnRjKGNydGMpOw0KKw0KKwltdGtfY3J0
Y19zdGF0ZS0+Y21kcV9oYW5kbGUgPQ0KKwkJCWNtZHFfcGt0X2NyZWF0ZShtdGtfY3J0Yy0+Y21k
cV9jbGllbnQsDQorCQkJCQlQQUdFX1NJWkUpOw0KKwljbWRxX3BrdF9jbGVhcl9ldmVudChtdGtf
Y3J0Y19zdGF0ZS0+Y21kcV9oYW5kbGUsDQorCQkJICAgICBtdGtfY3J0Yy0+Y21kcV9ldmVudCk7
DQorCWNtZHFfcGt0X3dmZShtdGtfY3J0Y19zdGF0ZS0+Y21kcV9oYW5kbGUsIG10a19jcnRjLT5j
bWRxX2V2ZW50KTsNCit9DQorDQorc3RhdGljIHZvaWQgbXRrX2NtZHFfcmVsZWFzZShzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMpDQorew0KKwlzdHJ1Y3QgbXRrX2NydGNfc3RhdGUgKm10a19jcnRjX3N0
YXRlID0NCisJCQl0b19tdGtfY3J0Y19zdGF0ZShjcnRjLT5zdGF0ZSk7DQorCXN0cnVjdCBtdGtf
Y21kcV9jYl9kYXRhICpjYl9kYXRhOw0KKw0KKwljYl9kYXRhID0ga21hbGxvYyhzaXplb2YoKmNi
X2RhdGEpLCBHRlBfS0VSTkVMKTsNCisJaWYgKCFjYl9kYXRhKSB7DQorCQlEUk1fREVWX0VSUk9S
KGNydGMtPmRldi0+ZGV2LCAiRmFpbGVkIHRvIGFsbG9jIGNiX2RhdGFcbiIpOw0KKwkJcmV0dXJu
Ow0KKwl9DQorDQorCWNiX2RhdGEtPmNtZHFfaGFuZGxlID0gbXRrX2NydGNfc3RhdGUtPmNtZHFf
aGFuZGxlOw0KKwljbWRxX3BrdF9mbHVzaF9hc3luYyhtdGtfY3J0Y19zdGF0ZS0+Y21kcV9oYW5k
bGUsDQorCQkJICAgICBkZHBfY21kcV9jYiwgY2JfZGF0YSk7DQorfQ0KKyNlbmRpZg0KIHN0YXRp
YyBpbnQgbXRrX2NydGNfZGRwX2h3X2luaXQoc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGMp
DQogew0KIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAmbXRrX2NydGMtPmJhc2U7DQpAQCAtMzgz
LDcgKzQzMyw4IEBAIHN0YXRpYyB2b2lkIG10a19jcnRjX2RkcF9jb25maWcoc3RydWN0IGRybV9j
cnRjICpjcnRjKQ0KIAlpZiAoc3RhdGUtPnBlbmRpbmdfY29uZmlnKSB7DQogCQltdGtfZGRwX2Nv
bXBfY29uZmlnKGNvbXAsIHN0YXRlLT5wZW5kaW5nX3dpZHRoLA0KIAkJCQkgICAgc3RhdGUtPnBl
bmRpbmdfaGVpZ2h0LA0KLQkJCQkgICAgc3RhdGUtPnBlbmRpbmdfdnJlZnJlc2gsIDAsIE5VTEwp
Ow0KKwkJCQkgICAgc3RhdGUtPnBlbmRpbmdfdnJlZnJlc2gsIDAsDQorCQkJCSAgICBzdGF0ZS0+
Y21kcV9oYW5kbGUpOw0KIA0KIAkJc3RhdGUtPnBlbmRpbmdfY29uZmlnID0gZmFsc2U7DQogCX0N
CkBAIC00MDMsNyArNDU0LDggQEAgc3RhdGljIHZvaWQgbXRrX2NydGNfZGRwX2NvbmZpZyhzdHJ1
Y3QgZHJtX2NydGMgKmNydGMpDQogDQogCQkJaWYgKGNvbXApDQogCQkJCW10a19kZHBfY29tcF9s
YXllcl9jb25maWcoY29tcCwgbG9jYWxfbGF5ZXIsDQotCQkJCQkJCSAgcGxhbmVfc3RhdGUsIE5V
TEwpOw0KKwkJCQkJCQkgIHBsYW5lX3N0YXRlLA0KKwkJCQkJCQkgIHN0YXRlLT5jbWRxX2hhbmRs
ZSk7DQogCQkJcGxhbmVfc3RhdGUtPnBlbmRpbmcuY29uZmlnID0gZmFsc2U7DQogCQl9DQogCQlt
dGtfY3J0Yy0+cGVuZGluZ19wbGFuZXMgPSBmYWxzZTsNCkBAIC00NTQsNiArNTA2LDEzIEBAIHZv
aWQgbXRrX2RybV9jcnRjX2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwNCiAJCW10a19jcnRjX2RkcF9jb25maWcoY3J0Yyk7DQogCQlt
dGtfZGlzcF9tdXRleF9yZWxlYXNlKG10a19jcnRjLT5tdXRleCk7DQogCX0NCisjaWZkZWYgQ09O
RklHX01US19DTURRDQorCWlmIChtdGtfY3J0Yy0+Y21kcV9jbGllbnQpIHsNCisJCW10a19jbWRx
X2FjcXVpcmUoY3J0Yyk7DQorCQltdGtfY3J0Y19kZHBfY29uZmlnKGNydGMpOw0KKwkJbXRrX2Nt
ZHFfcmVsZWFzZShjcnRjKTsNCisJfQ0KKyNlbmRpZg0KIAltdXRleF91bmxvY2soJnByaXYtPmh3
X2xvY2spOw0KIH0NCiANCkBAIC01NzAsNiArNjI5LDEzIEBAIHN0YXRpYyB2b2lkIG10a19kcm1f
Y3J0Y19hdG9taWNfZmx1c2goc3RydWN0IGRybV9jcnRjICpjcnRjLA0KIAkJbXRrX2NydGNfZGRw
X2NvbmZpZyhjcnRjKTsNCiAJCW10a19kaXNwX211dGV4X3JlbGVhc2UobXRrX2NydGMtPm11dGV4
KTsNCiAJfQ0KKyNpZmRlZiBDT05GSUdfTVRLX0NNRFENCisJaWYgKG10a19jcnRjLT5jbWRxX2Ns
aWVudCkgew0KKwkJbXRrX2NtZHFfYWNxdWlyZShjcnRjKTsNCisJCW10a19jcnRjX2RkcF9jb25m
aWcoY3J0Yyk7DQorCQltdGtfY21kcV9yZWxlYXNlKGNydGMpOw0KKwl9DQorI2VuZGlmDQogfQ0K
IA0KIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3MgbXRrX2NydGNfZnVuY3MgPSB7
DQpAQCAtNjE5LDcgKzY4NSw3IEBAIHZvaWQgbXRrX2NydGNfZGRwX2lycShzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMsIHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApDQogCXN0cnVjdCBtdGtfZHJtX2Ny
dGMgKm10a19jcnRjID0gdG9fbXRrX2NydGMoY3J0Yyk7DQogCXN0cnVjdCBtdGtfZHJtX3ByaXZh
dGUgKnByaXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOw0KIA0KLQlpZiAoIXByaXYtPmRhdGEt
PnNoYWRvd19yZWdpc3RlcikNCisJaWYgKCFwcml2LT5kYXRhLT5zaGFkb3dfcmVnaXN0ZXIgJiYg
IW10a19jcnRjLT5jbWRxX2NsaWVudCkNCiAJCW10a19jcnRjX2RkcF9jb25maWcoY3J0Yyk7DQog
DQogCW10a19kcm1fZmluaXNoX3BhZ2VfZmxpcChtdGtfY3J0Yyk7DQpAQCAtNzYxLDYgKzgyNywx
OCBAQCBpbnQgbXRrX2RybV9jcnRjX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiwN
CiAJZHJtX21vZGVfY3J0Y19zZXRfZ2FtbWFfc2l6ZSgmbXRrX2NydGMtPmJhc2UsIE1US19MVVRf
U0laRSk7DQogCWRybV9jcnRjX2VuYWJsZV9jb2xvcl9tZ210KCZtdGtfY3J0Yy0+YmFzZSwgMCwg
ZmFsc2UsIE1US19MVVRfU0laRSk7DQogCXByaXYtPm51bV9waXBlcysrOw0KLQ0KKyNpZmRlZiBD
T05GSUdfTVRLX0NNRFENCisJbXRrX2NydGMtPmNtZHFfY2xpZW50ID0NCisJCQljbWRxX21ib3hf
Y3JlYXRlKGRldiwgZHJtX2NydGNfaW5kZXgoJm10a19jcnRjLT5iYXNlKSwNCisJCQkJCSAyMDAw
KTsNCisJb2ZfcHJvcGVydHlfcmVhZF91MzJfaW5kZXgoZGV2LT5vZl9ub2RlLCAibWVkaWF0ZWss
Z2NlLWV2ZW50cyIsDQorCQkJCSAgIGRybV9jcnRjX2luZGV4KCZtdGtfY3J0Yy0+YmFzZSksDQor
CQkJCSAgICZtdGtfY3J0Yy0+Y21kcV9ldmVudCk7DQorCWlmIChJU19FUlIobXRrX2NydGMtPmNt
ZHFfY2xpZW50KSkgew0KKwkJZGV2X2RiZyhkZXYsICJtdGtfY3J0YyAlZCBmYWlsZWQgdG8gY3Jl
YXRlIG1haWxib3ggY2xpZW50LCB3cml0aW5nIHJlZ2lzdGVyIGJ5IENQVSBub3dcbiIsDQorCQkJ
ZHJtX2NydGNfaW5kZXgoJm10a19jcnRjLT5iYXNlKSk7DQorCQltdGtfY3J0Yy0+Y21kcV9jbGll
bnQgPSBOVUxMOw0KKwl9DQorI2VuZGlmDQogCXJldHVybiAwOw0KIH0NCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5jIGIvZHJpdmVycy9ncHUv
ZHJtL21lZGlhdGVrL210a19kcm1fZGRwX2NvbXAuYw0KaW5kZXggNmQwZjM0OWRkZjgyLi45Y2Mx
MmFmMmJjMDYgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9k
ZHBfY29tcC5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29t
cC5jDQpAQCAtMzcwLDYgKzM3MCw5IEBAIGludCBtdGtfZGRwX2NvbXBfaW5pdChzdHJ1Y3QgZGV2
aWNlICpkZXYsIHN0cnVjdCBkZXZpY2Vfbm9kZSAqbm9kZSwNCiAJCSAgICAgIGNvbnN0IHN0cnVj
dCBtdGtfZGRwX2NvbXBfZnVuY3MgKmZ1bmNzKQ0KIHsNCiAJc3RydWN0IHBsYXRmb3JtX2Rldmlj
ZSAqY29tcF9wZGV2Ow0KKwlzdHJ1Y3QgcmVzb3VyY2UgcmVzOw0KKwlzdHJ1Y3QgY21kcV9jbGll
bnRfcmVnICpjbWRxX3JlZzsNCisJaW50IHJldCA9IDA7DQogDQogCWlmIChjb21wX2lkIDwgMCB8
fCBjb21wX2lkID49IEREUF9DT01QT05FTlRfSURfTUFYKQ0KIAkJcmV0dXJuIC1FSU5WQUw7DQpA
QCAtNDA0LDYgKzQwNywzNCBAQCBpbnQgbXRrX2RkcF9jb21wX2luaXQoc3RydWN0IGRldmljZSAq
ZGV2LCBzdHJ1Y3QgZGV2aWNlX25vZGUgKm5vZGUsDQogCX0NCiAJY29tcC0+ZGV2ID0gJmNvbXBf
cGRldi0+ZGV2Ow0KIA0KKyNpZmRlZiBDT05GSUdfTVRLX0NNRFENCisJaWYgKG9mX2FkZHJlc3Nf
dG9fcmVzb3VyY2Uobm9kZSwgMCwgJnJlcykgIT0gMCkgew0KKwkJZGV2X2VycihkZXYsICJNaXNz
aW5nIHJlZyBpbiAlcyBub2RlXG4iLA0KKwkJCW5vZGUtPmZ1bGxfbmFtZSk7DQorCQlyZXR1cm4g
LUVJTlZBTDsNCisJfQ0KKwljb21wLT5yZWdzX3BhID0gcmVzLnN0YXJ0Ow0KKw0KKwljb21wX3Bk
ZXYgPSBvZl9maW5kX2RldmljZV9ieV9ub2RlKG5vZGUpOw0KKwlpZiAoIWNvbXBfcGRldikgew0K
KwkJZGV2X3dhcm4oZGV2LCAiV2FpdGluZyBmb3IgY29tcG9uZW50IGRldmljZSAlc1xuIiwNCisJ
CQkgbm9kZS0+ZnVsbF9uYW1lKTsNCisJCXJldHVybiAtRVBST0JFX0RFRkVSOw0KKwl9DQorDQor
CWNtZHFfcmVnID0ga3phbGxvYyhzaXplb2YoKmNtZHFfcmVnKSwgR0ZQX0tFUk5FTCk7DQorCWlm
ICghY21kcV9yZWcpDQorCQlyZXR1cm4gLUVJTlZBTDsNCisNCisJcmV0ID0gY21kcV9kZXZfZ2V0
X2NsaWVudF9yZWcoJmNvbXBfcGRldi0+ZGV2LCBjbWRxX3JlZywgMCk7DQorCWlmIChyZXQgIT0g
MCkNCisJCWRldl9kYmcoJmNvbXBfcGRldi0+ZGV2LA0KKwkJCSJnZXQgbWVkaWF0ZWssZ2NlLWNs
aWVudC1yZWcgZmFpbCFcbiIpOw0KKwllbHNlDQorCQljb21wLT5zdWJzeXMgPSBjbWRxX3JlZy0+
c3Vic3lzOw0KKw0KKwlrZnJlZShjbWRxX3JlZyk7DQorI2VuZGlmDQogCXJldHVybiAwOw0KIH0N
CiANCi0tIA0KMi4xOC4wDQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
