Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 56C898BA55
	for <lists+dri-devel@lfdr.de>; Tue, 13 Aug 2019 15:33:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7613A6E138;
	Tue, 13 Aug 2019 13:33:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [IPv6:2001:4b98:dc2:55:216:3eff:fef7:d647])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9454C6E136
 for <dri-devel@lists.freedesktop.org>; Tue, 13 Aug 2019 13:33:25 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id C4DBDE56;
 Tue, 13 Aug 2019 15:33:21 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 7/9] drm/panel: Add driver for the Sony ACX565AKM panel
Date: Tue, 13 Aug 2019 16:33:09 +0300
Message-Id: <20190813133311.26441-8-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190813133311.26441-1-laurent.pinchart@ideasonboard.com>
References: <20190813133311.26441-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1565703202;
 bh=mhvUT4QEwSsSdP+Eij1YQL69BCaOTYdDB8wdyGYParw=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Dp9YB7VGu8hyQAeSI3hyJA7v/J1V/kwOA+7h37i9zGYW2h1c3zJIFabcynavsZfAE
 CkLtb1ccFMdBNNiRA3eUBa5zJ9nPVbGb5iDooNAqN50Z4LX9jk1Lbfw5CoKgqLhD+D
 6fvDrB7MBYupx4p61etp8whHP42LsO4L/JQDeVKw=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thierry Reding <thierry.reding@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYW5lbCBpcyB1c2VkIG9uIHRoZSBOb2tpYSBOOTAwLgoKVGhlIGNvZGUgaXMgYmFzZWQg
b24gdGhlIG9tYXBkcm0tc3BlY2lmaWMgcGFuZWwtc29ueS1hY3g1NjVha20gZHJpdmVyLgoKU2ln
bmVkLW9mZi1ieTogTGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9h
cmQuY29tPgotLS0KQ2hhbmdlcyBzaW5jZSB2MjoKCi0gQ2FsbCBkcm1fcGFuZWxfdW5wcmVwYXJl
KCkgaW4gLnJlbW92ZSgpIGhhbmRsZXIKCkNoYW5nZXMgc2luY2UgdjE6CgotIE1lbnRpb24gYm9h
cmRzIHVzaW5nIHRoZSBwYW5lbCBpbiBLY29uZmlnCi0gUmVuYW1lZCBhY3g1NjVha21fZGV2aWNl
IHRvIGFjeDU2NWFrbV9wYW5lbAotIENvbW1lbnRzIHVwZGF0ZXMKLSBTdG9yZSB3aWR0aF9tbSBh
bmQgaGVpZ2h0X21tIGluIGRybV9kaXNwbGF5X21vZGUKLSBVc2UgZHJtX3BhbmVsX2Rpc2FibGUo
KSBpbiAucmVtb3ZlKCkgaGFuZGxlcgotLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmln
ICAgICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZSAg
ICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFj
eDU2NWFrbS5jIHwgNjk0ICsrKysrKysrKysrKysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwgNzAz
IGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vcGFuZWwv
cGFuZWwtc29ueS1hY3g1NjVha20uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5l
bC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL0tjb25maWcKaW5kZXggOGQ5YThjZGI3
MDRlLi5iMDU2NDliMzExOGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29u
ZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnCkBAIC0zMTYsNiArMzE2LDE0
IEBAIGNvbmZpZyBEUk1fUEFORUxfU0lUUk9OSVhfU1Q3Nzg5VgogCSAgU2F5IFkgaGVyZSBpZiB5
b3Ugd2FudCB0byBlbmFibGUgc3VwcG9ydCBmb3IgdGhlIFNpdHJvbml4CiAJICBTVDc3ODlWIGNv
bnRyb2xsZXIgZm9yIDI0MHgzMjAgTENEIHBhbmVscwogCitjb25maWcgRFJNX1BBTkVMX1NPTllf
QUNYNTY1QUtNCisJdHJpc3RhdGUgIlNvbnkgQUNYNTY1QUtNIHBhbmVsIgorCWRlcGVuZHMgb24g
R1BJT0xJQiAmJiBPRiAmJiBTUEkKKwlkZXBlbmRzIG9uIEJBQ0tMSUdIVF9DTEFTU19ERVZJQ0UK
KwloZWxwCisJICBTYXkgWSBoZXJlIGlmIHlvdSB3YW50IHRvIGVuYWJsZSBzdXBwb3J0IGZvciB0
aGUgU29ueSBBQ1g1NjVBS00KKwkgIDgwMHg2MDAgMy41IiBwYW5lbCAoZm91bmQgb24gdGhlIE5v
a2lhIE45MDApLgorCiBjb25maWcgRFJNX1BBTkVMX1RQT19UUEcxMTAKIAl0cmlzdGF0ZSAiVFBP
IFRQRyA4MDB4NDAwIHBhbmVsIgogCWRlcGVuZHMgb24gT0YgJiYgU1BJICYmIEdQSU9MSUIKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5lbC9NYWtlZmlsZQppbmRleCAxNGQxYzQ5ZWYzYWIuLjI4Y2YyMzMyZmQwNiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmVsL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5lbC9NYWtlZmlsZQpAQCAtMzMsNSArMzMsNiBAQCBvYmotJChDT05GSUdfRFJNX1BBTkVM
X1NIQVJQX0xTMDM3VjdEVzAxKSArPSBwYW5lbC1zaGFycC1sczAzN3Y3ZHcwMS5vCiBvYmotJChD
T05GSUdfRFJNX1BBTkVMX1NIQVJQX0xTMDQzVDFMRTAxKSArPSBwYW5lbC1zaGFycC1sczA0M3Qx
bGUwMS5vCiBvYmotJChDT05GSUdfRFJNX1BBTkVMX1NJVFJPTklYX1NUNzcwMSkgKz0gcGFuZWwt
c2l0cm9uaXgtc3Q3NzAxLm8KIG9iai0kKENPTkZJR19EUk1fUEFORUxfU0lUUk9OSVhfU1Q3Nzg5
VikgKz0gcGFuZWwtc2l0cm9uaXgtc3Q3Nzg5di5vCitvYmotJChDT05GSUdfRFJNX1BBTkVMX1NP
TllfQUNYNTY1QUtNKSArPSBwYW5lbC1zb255LWFjeDU2NWFrbS5vCiBvYmotJChDT05GSUdfRFJN
X1BBTkVMX1RQT19UUEcxMTApICs9IHBhbmVsLXRwby10cGcxMTAubwogb2JqLSQoQ09ORklHX0RS
TV9QQU5FTF9UUlVMWV9OVDM1NTk3X1dRWEdBKSArPSBwYW5lbC10cnVseS1udDM1NTk3Lm8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFjeDU2NWFrbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL3BhbmVsL3BhbmVsLXNvbnktYWN4NTY1YWttLmMKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5jOGM4MjE2M2UyNGQKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtc29ueS1hY3g1NjVha20uYwpAQCAtMCww
ICsxLDY5NCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBT
b255IEFDWDU2NUFLTSBMQ0QgUGFuZWwgZHJpdmVyCisgKgorICogQ29weXJpZ2h0IChDKSAyMDE5
IFRleGFzIEluc3RydW1lbnRzIEluY29ycG9yYXRlZAorICoKKyAqIEJhc2VkIG9uIHRoZSBvbWFw
ZHJtLXNwZWNpZmljIHBhbmVsLXNvbnktYWN4NTY1YWttIGRyaXZlcgorICoKKyAqIENvcHlyaWdo
dCAoQykgMjAxMCBOb2tpYSBDb3Jwb3JhdGlvbgorICogQXV0aG9yOiBJbXJlIERlYWsgPGltcmUu
ZGVha0Bub2tpYS5jb20+CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2JhY2tsaWdodC5oPgorI2lu
Y2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGludXgvZ3Bpby9jb25zdW1lci5oPgor
I2luY2x1ZGUgPGxpbnV4L2ppZmZpZXMuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNp
bmNsdWRlIDxsaW51eC9tdXRleC5oPgorI2luY2x1ZGUgPGxpbnV4L3NjaGVkLmg+CisjaW5jbHVk
ZSA8bGludXgvc3BpL3NwaS5oPgorI2luY2x1ZGUgPHZpZGVvL21pcGlfZGlzcGxheS5oPgorCisj
aW5jbHVkZSA8ZHJtL2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9wYW5lbC5oPgorCisjZGVmaW5lIENUUkxfRElTUF9CUklHSFRO
RVNTX0NUUkxfT04JCSgxIDw8IDUpCisjZGVmaW5lIENUUkxfRElTUF9BTUJJRU5UX0xJR0hUX0NU
UkxfT04JCSgxIDw8IDQpCisjZGVmaW5lIENUUkxfRElTUF9CQUNLTElHSFRfT04JCQkoMSA8PCAy
KQorI2RlZmluZSBDVFJMX0RJU1BfQVVUT19CUklHSFRORVNTX09OCQkoMSA8PCAxKQorCisjZGVm
aW5lIE1JUElEX0NNRF9XUklURV9DQUJDCQkweDU1CisjZGVmaW5lIE1JUElEX0NNRF9SRUFEX0NB
QkMJCTB4NTYKKworI2RlZmluZSBNSVBJRF9WRVJfTFBIODkyMwkJMworI2RlZmluZSBNSVBJRF9W
RVJfTFMwNDFZMwkJNAorI2RlZmluZSBNSVBJRF9WRVJfTDRGMDAzMTEJCTgKKyNkZWZpbmUgTUlQ
SURfVkVSX0FDWDU2NUFLTQkJOQorCitzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsIHsKKwlzdHJ1Y3Qg
ZHJtX3BhbmVsIHBhbmVsOworCisJc3RydWN0IHNwaV9kZXZpY2UgKnNwaTsKKwlzdHJ1Y3QgZ3Bp
b19kZXNjICpyZXNldF9ncGlvOworCXN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiYWNrbGlnaHQ7
CisKKwlzdHJ1Y3QgbXV0ZXggbXV0ZXg7CisKKwljb25zdCBjaGFyICpuYW1lOworCXU4IGRpc3Bs
YXlfaWRbM107CisJaW50IG1vZGVsOworCWludCByZXZpc2lvbjsKKwlib29sIGhhc19iYzsKKwli
b29sIGhhc19jYWJjOworCisJYm9vbCBlbmFibGVkOworCXVuc2lnbmVkIGludCBjYWJjX21vZGU7
CisJLyoKKwkgKiBOZXh0IHZhbHVlIG9mIGppZmZpZXMgd2hlbiB3ZSBjYW4gaXNzdWUgdGhlIG5l
eHQgc2xlZXAgaW4vb3V0CisJICogY29tbWFuZC4KKwkgKi8KKwl1bnNpZ25lZCBsb25nIGh3X2d1
YXJkX2VuZDsKKwl1bnNpZ25lZCBsb25nIGh3X2d1YXJkX3dhaXQ7CQkvKiBtYXggZ3VhcmQgdGlt
ZSBpbiBqaWZmaWVzICovCit9OworCisjZGVmaW5lIHRvX2FjeDU2NWFrbV9kZXZpY2UocCkgY29u
dGFpbmVyX29mKHAsIHN0cnVjdCBhY3g1NjVha21fcGFuZWwsIHBhbmVsKQorCitzdGF0aWMgdm9p
ZCBhY3g1NjVha21fdHJhbnNmZXIoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkLCBpbnQgY21k
LAorCQkJICAgICAgY29uc3QgdTggKndidWYsIGludCB3bGVuLCB1OCAqcmJ1ZiwgaW50IHJsZW4p
Cit7CisJc3RydWN0IHNwaV9tZXNzYWdlCW07CisJc3RydWN0IHNwaV90cmFuc2ZlcgkqeCwgeGZl
cls1XTsKKwlpbnQJCQlyZXQ7CisKKwlzcGlfbWVzc2FnZV9pbml0KCZtKTsKKworCW1lbXNldCh4
ZmVyLCAwLCBzaXplb2YoeGZlcikpOworCXggPSAmeGZlclswXTsKKworCWNtZCAmPSAgMHhmZjsK
Kwl4LT50eF9idWYgPSAmY21kOworCXgtPmJpdHNfcGVyX3dvcmQgPSA5OworCXgtPmxlbiA9IDI7
CisKKwlpZiAocmxlbiA+IDEgJiYgd2xlbiA9PSAwKSB7CisJCS8qCisJCSAqIEJldHdlZW4gdGhl
IGNvbW1hbmQgYW5kIHRoZSByZXNwb25zZSBkYXRhIHRoZXJlIGlzIGEKKwkJICogZHVtbXkgY2xv
Y2sgY3ljbGUuIEFkZCBhbiBleHRyYSBiaXQgYWZ0ZXIgdGhlIGNvbW1hbmQKKwkJICogd29yZCB0
byBhY2NvdW50IGZvciB0aGlzLgorCQkgKi8KKwkJeC0+Yml0c19wZXJfd29yZCA9IDEwOworCQlj
bWQgPDw9IDE7CisJfQorCXNwaV9tZXNzYWdlX2FkZF90YWlsKHgsICZtKTsKKworCWlmICh3bGVu
KSB7CisJCXgrKzsKKwkJeC0+dHhfYnVmID0gd2J1ZjsKKwkJeC0+bGVuID0gd2xlbjsKKwkJeC0+
Yml0c19wZXJfd29yZCA9IDk7CisJCXNwaV9tZXNzYWdlX2FkZF90YWlsKHgsICZtKTsKKwl9CisK
KwlpZiAocmxlbikgeworCQl4Kys7CisJCXgtPnJ4X2J1Zgk9IHJidWY7CisJCXgtPmxlbgkJPSBy
bGVuOworCQlzcGlfbWVzc2FnZV9hZGRfdGFpbCh4LCAmbSk7CisJfQorCisJcmV0ID0gc3BpX3N5
bmMobGNkLT5zcGksICZtKTsKKwlpZiAocmV0IDwgMCkKKwkJZGV2X2RiZygmbGNkLT5zcGktPmRl
diwgInNwaV9zeW5jICVkXG4iLCByZXQpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgYWN4NTY1
YWttX2NtZChzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QsIGludCBjbWQpCit7CisJYWN4NTY1
YWttX3RyYW5zZmVyKGxjZCwgY21kLCBOVUxMLCAwLCBOVUxMLCAwKTsKK30KKworc3RhdGljIGlu
bGluZSB2b2lkIGFjeDU2NWFrbV93cml0ZShzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QsCisJ
CQkgICAgICAgaW50IHJlZywgY29uc3QgdTggKmJ1ZiwgaW50IGxlbikKK3sKKwlhY3g1NjVha21f
dHJhbnNmZXIobGNkLCByZWcsIGJ1ZiwgbGVuLCBOVUxMLCAwKTsKK30KKworc3RhdGljIGlubGlu
ZSB2b2lkIGFjeDU2NWFrbV9yZWFkKHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCwKKwkJCSAg
ICAgIGludCByZWcsIHU4ICpidWYsIGludCBsZW4pCit7CisJYWN4NTY1YWttX3RyYW5zZmVyKGxj
ZCwgcmVnLCBOVUxMLCAwLCBidWYsIGxlbik7Cit9CisKKy8qIC0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
CisgKiBBdXRvIEJyaWdodG5lc3MgQ29udHJvbCBWaWEgc3lzZnMKKyAqLworCitzdGF0aWMgdW5z
aWduZWQgaW50IGFjeDU2NWFrbV9nZXRfY2FiY19tb2RlKHN0cnVjdCBhY3g1NjVha21fcGFuZWwg
KmxjZCkKK3sKKwlyZXR1cm4gbGNkLT5jYWJjX21vZGU7Cit9CisKK3N0YXRpYyB2b2lkIGFjeDU2
NWFrbV9zZXRfY2FiY19tb2RlKHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCwKKwkJCQkgICAg
dW5zaWduZWQgaW50IG1vZGUpCit7CisJdTE2IGNhYmNfY3RybDsKKworCWxjZC0+Y2FiY19tb2Rl
ID0gbW9kZTsKKwlpZiAoIWxjZC0+ZW5hYmxlZCkKKwkJcmV0dXJuOworCWNhYmNfY3RybCA9IDA7
CisJYWN4NTY1YWttX3JlYWQobGNkLCBNSVBJRF9DTURfUkVBRF9DQUJDLCAodTggKikmY2FiY19j
dHJsLCAxKTsKKwljYWJjX2N0cmwgJj0gfjM7CisJY2FiY19jdHJsIHw9ICgxIDw8IDgpIHwgKG1v
ZGUgJiAzKTsKKwlhY3g1NjVha21fd3JpdGUobGNkLCBNSVBJRF9DTURfV1JJVEVfQ0FCQywgKHU4
ICopJmNhYmNfY3RybCwgMik7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgYWN4NTY1YWttX2dl
dF9od19jYWJjX21vZGUoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkKQoreworCXU4IGNhYmNf
Y3RybDsKKworCWFjeDU2NWFrbV9yZWFkKGxjZCwgTUlQSURfQ01EX1JFQURfQ0FCQywgJmNhYmNf
Y3RybCwgMSk7CisJcmV0dXJuIGNhYmNfY3RybCAmIDM7Cit9CisKK3N0YXRpYyBjb25zdCBjaGFy
ICogY29uc3QgYWN4NTY1YWttX2NhYmNfbW9kZXNbXSA9IHsKKwkib2ZmIiwJCS8qIGFsd2F5cyB1
c2VkIHdoZW4gQ0FCQyBpcyBub3Qgc3VwcG9ydGVkICovCisJInVpIiwKKwkic3RpbGwtaW1hZ2Ui
LAorCSJtb3ZpbmctaW1hZ2UiLAorfTsKKworc3RhdGljIHNzaXplX3QgY2FiY19tb2RlX3Nob3co
c3RydWN0IGRldmljZSAqZGV2LAorCQkJICAgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0
dHIsCisJCQkgICAgICBjaGFyICpidWYpCit7CisJc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNk
ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJY29uc3QgY2hhciAqbW9kZV9zdHI7CisJaW50IG1v
ZGU7CisKKwlpZiAoIWxjZC0+aGFzX2NhYmMpCisJCW1vZGUgPSAwOworCWVsc2UKKwkJbW9kZSA9
IGFjeDU2NWFrbV9nZXRfY2FiY19tb2RlKGxjZCk7CisKKwltb2RlX3N0ciA9ICJ1bmtub3duIjsK
KwlpZiAobW9kZSA+PSAwICYmIG1vZGUgPCBBUlJBWV9TSVpFKGFjeDU2NWFrbV9jYWJjX21vZGVz
KSkKKwkJbW9kZV9zdHIgPSBhY3g1NjVha21fY2FiY19tb2Rlc1ttb2RlXTsKKworCXJldHVybiBz
cHJpbnRmKGJ1ZiwgIiVzXG4iLCBtb2RlX3N0cik7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGNhYmNf
bW9kZV9zdG9yZShzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkgICAgICAgc3RydWN0IGRldmljZV9h
dHRyaWJ1dGUgKmF0dHIsCisJCQkgICAgICAgY29uc3QgY2hhciAqYnVmLCBzaXplX3QgY291bnQp
Cit7CisJc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkID0gZGV2X2dldF9kcnZkYXRhKGRldik7
CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShhY3g1NjVh
a21fY2FiY19tb2Rlcyk7IGkrKykgeworCQljb25zdCBjaGFyICptb2RlX3N0ciA9IGFjeDU2NWFr
bV9jYWJjX21vZGVzW2ldOworCQlpbnQgY21wX2xlbiA9IHN0cmxlbihtb2RlX3N0cik7CisKKwkJ
aWYgKGNvdW50ID4gMCAmJiBidWZbY291bnQgLSAxXSA9PSAnXG4nKQorCQkJY291bnQtLTsKKwkJ
aWYgKGNvdW50ICE9IGNtcF9sZW4pCisJCQljb250aW51ZTsKKworCQlpZiAoc3RybmNtcChidWYs
IG1vZGVfc3RyLCBjbXBfbGVuKSA9PSAwKQorCQkJYnJlYWs7CisJfQorCisJaWYgKGkgPT0gQVJS
QVlfU0laRShhY3g1NjVha21fY2FiY19tb2RlcykpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYg
KCFsY2QtPmhhc19jYWJjICYmIGkgIT0gMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwltdXRleF9s
b2NrKCZsY2QtPm11dGV4KTsKKwlhY3g1NjVha21fc2V0X2NhYmNfbW9kZShsY2QsIGkpOworCW11
dGV4X3VubG9jaygmbGNkLT5tdXRleCk7CisKKwlyZXR1cm4gY291bnQ7Cit9CisKK3N0YXRpYyBz
c2l6ZV90IGNhYmNfYXZhaWxhYmxlX21vZGVzX3Nob3coc3RydWN0IGRldmljZSAqZGV2LAorCQkJ
CQkgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIsCisJCQkJCSBjaGFyICpidWYpCit7CisJ
c3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJdW5z
aWduZWQgaW50IGk7CisJc2l6ZV90IGxlbiA9IDA7CisKKwlpZiAoIWxjZC0+aGFzX2NhYmMpCisJ
CXJldHVybiBzcHJpbnRmKGJ1ZiwgIiVzXG4iLCBhY3g1NjVha21fY2FiY19tb2Rlc1swXSk7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShhY3g1NjVha21fY2FiY19tb2Rlcyk7IGkrKykK
KwkJbGVuICs9IHNwcmludGYoJmJ1ZltsZW5dLCAiJXMlcyIsIGkgPyAiICIgOiAiIiwKKwkJCSAg
ICAgICBhY3g1NjVha21fY2FiY19tb2Rlc1tpXSk7CisKKwlidWZbbGVuKytdID0gJ1xuJzsKKwor
CXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBERVZJQ0VfQVRUUl9SVyhjYWJjX21vZGUpOworc3Rh
dGljIERFVklDRV9BVFRSX1JPKGNhYmNfYXZhaWxhYmxlX21vZGVzKTsKKworc3RhdGljIHN0cnVj
dCBhdHRyaWJ1dGUgKmFjeDU2NWFrbV9jYWJjX2F0dHJzW10gPSB7CisJJmRldl9hdHRyX2NhYmNf
bW9kZS5hdHRyLAorCSZkZXZfYXR0cl9jYWJjX2F2YWlsYWJsZV9tb2Rlcy5hdHRyLAorCU5VTEws
Cit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGF0dHJpYnV0ZV9ncm91cCBhY3g1NjVha21fY2Fi
Y19hdHRyX2dyb3VwID0geworCS5hdHRycyA9IGFjeDU2NWFrbV9jYWJjX2F0dHJzLAorfTsKKwor
LyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIEJhY2tsaWdodCBEZXZpY2UKKyAqLworCitzdGF0
aWMgaW50IGFjeDU2NWFrbV9nZXRfYWN0dWFsX2JyaWdodG5lc3Moc3RydWN0IGFjeDU2NWFrbV9w
YW5lbCAqbGNkKQoreworCXU4IGJ2OworCisJYWN4NTY1YWttX3JlYWQobGNkLCBNSVBJX0RDU19H
RVRfRElTUExBWV9CUklHSFRORVNTLCAmYnYsIDEpOworCisJcmV0dXJuIGJ2OworfQorCitzdGF0
aWMgdm9pZCBhY3g1NjVha21fc2V0X2JyaWdodG5lc3Moc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAq
bGNkLCBpbnQgbGV2ZWwpCit7CisJdTE2IGN0cmw7CisJaW50IGJ2OworCisJYnYgPSBsZXZlbCB8
ICgxIDw8IDgpOworCWFjeDU2NWFrbV93cml0ZShsY2QsIE1JUElfRENTX1NFVF9ESVNQTEFZX0JS
SUdIVE5FU1MsICh1OCAqKSZidiwgMik7CisKKwlhY3g1NjVha21fcmVhZChsY2QsIE1JUElfRENT
X0dFVF9DT05UUk9MX0RJU1BMQVksICh1OCAqKSZjdHJsLCAxKTsKKwlpZiAobGV2ZWwpCisJCWN0
cmwgfD0gQ1RSTF9ESVNQX0JSSUdIVE5FU1NfQ1RSTF9PTiB8CisJCQlDVFJMX0RJU1BfQkFDS0xJ
R0hUX09OOworCWVsc2UKKwkJY3RybCAmPSB+KENUUkxfRElTUF9CUklHSFRORVNTX0NUUkxfT04g
fAorCQkJICBDVFJMX0RJU1BfQkFDS0xJR0hUX09OKTsKKworCWN0cmwgfD0gMSA8PCA4OworCWFj
eDU2NWFrbV93cml0ZShsY2QsIE1JUElfRENTX1dSSVRFX0NPTlRST0xfRElTUExBWSwgKHU4ICop
JmN0cmwsIDIpOworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9ibF91cGRhdGVfc3RhdHVzX2xv
Y2tlZChzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqZGV2KQoreworCXN0cnVjdCBhY3g1NjVha21f
cGFuZWwgKmxjZCA9IGRldl9nZXRfZHJ2ZGF0YSgmZGV2LT5kZXYpOworCWludCBsZXZlbDsKKwor
CWlmIChkZXYtPnByb3BzLmZiX2JsYW5rID09IEZCX0JMQU5LX1VOQkxBTksgJiYKKwkgICAgZGV2
LT5wcm9wcy5wb3dlciA9PSBGQl9CTEFOS19VTkJMQU5LKQorCQlsZXZlbCA9IGRldi0+cHJvcHMu
YnJpZ2h0bmVzczsKKwllbHNlCisJCWxldmVsID0gMDsKKworCWFjeDU2NWFrbV9zZXRfYnJpZ2h0
bmVzcyhsY2QsIGxldmVsKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFjeDU2NWFr
bV9ibF91cGRhdGVfc3RhdHVzKHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpkZXYpCit7CisJc3Ry
dWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkID0gZGV2X2dldF9kcnZkYXRhKCZkZXYtPmRldik7CisJ
aW50IHJldDsKKworCW11dGV4X2xvY2soJmxjZC0+bXV0ZXgpOworCXJldCA9IGFjeDU2NWFrbV9i
bF91cGRhdGVfc3RhdHVzX2xvY2tlZChkZXYpOworCW11dGV4X3VubG9jaygmbGNkLT5tdXRleCk7
CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9ibF9nZXRfaW50ZW5z
aXR5KHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGFjeDU2NWFrbV9w
YW5lbCAqbGNkID0gZGV2X2dldF9kcnZkYXRhKCZkZXYtPmRldik7CisJdW5zaWduZWQgaW50IGlu
dGVuc2l0eTsKKworCW11dGV4X2xvY2soJmxjZC0+bXV0ZXgpOworCisJaWYgKGRldi0+cHJvcHMu
ZmJfYmxhbmsgPT0gRkJfQkxBTktfVU5CTEFOSyAmJgorCSAgICBkZXYtPnByb3BzLnBvd2VyID09
IEZCX0JMQU5LX1VOQkxBTkspCisJCWludGVuc2l0eSA9IGFjeDU2NWFrbV9nZXRfYWN0dWFsX2Jy
aWdodG5lc3MobGNkKTsKKwllbHNlCisJCWludGVuc2l0eSA9IDA7CisKKwltdXRleF91bmxvY2so
JmxjZC0+bXV0ZXgpOworCisJcmV0dXJuIGludGVuc2l0eTsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBiYWNrbGlnaHRfb3BzIGFjeDU2NWFrbV9ibF9vcHMgPSB7CisJLmdldF9icmlnaHRuZXNz
ID0gYWN4NTY1YWttX2JsX2dldF9pbnRlbnNpdHksCisJLnVwZGF0ZV9zdGF0dXMgID0gYWN4NTY1
YWttX2JsX3VwZGF0ZV9zdGF0dXMsCit9OworCitzdGF0aWMgaW50IGFjeDU2NWFrbV9iYWNrbGln
aHRfaW5pdChzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QpCit7CisJc3RydWN0IGJhY2tsaWdo
dF9wcm9wZXJ0aWVzIHByb3BzID0geworCQkuZmJfYmxhbmsgPSBGQl9CTEFOS19VTkJMQU5LLAor
CQkucG93ZXIgPSBGQl9CTEFOS19VTkJMQU5LLAorCQkudHlwZSA9IEJBQ0tMSUdIVF9SQVcsCisJ
fTsKKwlpbnQgcmV0OworCisJbGNkLT5iYWNrbGlnaHQgPSBiYWNrbGlnaHRfZGV2aWNlX3JlZ2lz
dGVyKGxjZC0+bmFtZSwgJmxjZC0+c3BpLT5kZXYsCisJCQkJCQkgICBsY2QsICZhY3g1NjVha21f
Ymxfb3BzLAorCQkJCQkJICAgJnByb3BzKTsKKwlpZiAoSVNfRVJSKGxjZC0+YmFja2xpZ2h0KSkg
eworCQlyZXQgPSBQVFJfRVJSKGxjZC0+YmFja2xpZ2h0KTsKKwkJbGNkLT5iYWNrbGlnaHQgPSBO
VUxMOworCQlyZXR1cm4gcmV0OworCX0KKworCWlmIChsY2QtPmhhc19jYWJjKSB7CisJCXJldCA9
IHN5c2ZzX2NyZWF0ZV9ncm91cCgmbGNkLT5iYWNrbGlnaHQtPmRldi5rb2JqLAorCQkJCQkgJmFj
eDU2NWFrbV9jYWJjX2F0dHJfZ3JvdXApOworCQlpZiAocmV0IDwgMCkgeworCQkJZGV2X2Vycigm
bGNkLT5zcGktPmRldiwKKwkJCQkiJXMgZmFpbGVkIHRvIGNyZWF0ZSBzeXNmcyBmaWxlc1xuIiwg
X19mdW5jX18pOworCQkJYmFja2xpZ2h0X2RldmljZV91bnJlZ2lzdGVyKGxjZC0+YmFja2xpZ2h0
KTsKKwkJCXJldHVybiByZXQ7CisJCX0KKworCQlsY2QtPmNhYmNfbW9kZSA9IGFjeDU2NWFrbV9n
ZXRfaHdfY2FiY19tb2RlKGxjZCk7CisJfQorCisJbGNkLT5iYWNrbGlnaHQtPnByb3BzLm1heF9i
cmlnaHRuZXNzID0gMjU1OworCWxjZC0+YmFja2xpZ2h0LT5wcm9wcy5icmlnaHRuZXNzID0gYWN4
NTY1YWttX2dldF9hY3R1YWxfYnJpZ2h0bmVzcyhsY2QpOworCisJYWN4NTY1YWttX2JsX3VwZGF0
ZV9zdGF0dXNfbG9ja2VkKGxjZC0+YmFja2xpZ2h0KTsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgdm9pZCBhY3g1NjVha21fYmFja2xpZ2h0X2NsZWFudXAoc3RydWN0IGFjeDU2NWFrbV9wYW5l
bCAqbGNkKQoreworCWlmIChsY2QtPmhhc19jYWJjKQorCQlzeXNmc19yZW1vdmVfZ3JvdXAoJmxj
ZC0+YmFja2xpZ2h0LT5kZXYua29iaiwKKwkJCQkgICAmYWN4NTY1YWttX2NhYmNfYXR0cl9ncm91
cCk7CisKKwliYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIobGNkLT5iYWNrbGlnaHQpOworfQor
CisvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogRFJNIEJyaWRnZSBPcGVyYXRpb25zCisgKi8K
Kworc3RhdGljIHZvaWQgYWN4NTY1YWttX3NldF9zbGVlcF9tb2RlKHN0cnVjdCBhY3g1NjVha21f
cGFuZWwgKmxjZCwgaW50IG9uKQoreworCWludCBjbWQgPSBvbiA/IE1JUElfRENTX0VOVEVSX1NM
RUVQX01PREUgOiBNSVBJX0RDU19FWElUX1NMRUVQX01PREU7CisJdW5zaWduZWQgbG9uZyB3YWl0
OworCisJLyoKKwkgKiBXZSBoYXZlIHRvIGtlZXAgMTIwbXNlYyBiZXR3ZWVuIHNsZWVwIGluL291
dCBjb21tYW5kcy4KKwkgKiAoOC4yLjE1LCA4LjIuMTYpLgorCSAqLworCXdhaXQgPSBsY2QtPmh3
X2d1YXJkX2VuZCAtIGppZmZpZXM7CisJaWYgKChsb25nKXdhaXQgPiAwICYmIHdhaXQgPD0gbGNk
LT5od19ndWFyZF93YWl0KSB7CisJCXNldF9jdXJyZW50X3N0YXRlKFRBU0tfVU5JTlRFUlJVUFRJ
QkxFKTsKKwkJc2NoZWR1bGVfdGltZW91dCh3YWl0KTsKKwl9CisKKwlhY3g1NjVha21fY21kKGxj
ZCwgY21kKTsKKworCWxjZC0+aHdfZ3VhcmRfd2FpdCA9IG1zZWNzX3RvX2ppZmZpZXMoMTIwKTsK
KwlsY2QtPmh3X2d1YXJkX2VuZCA9IGppZmZpZXMgKyBsY2QtPmh3X2d1YXJkX3dhaXQ7Cit9CisK
K3N0YXRpYyB2b2lkIGFjeDU2NWFrbV9zZXRfZGlzcGxheV9zdGF0ZShzdHJ1Y3QgYWN4NTY1YWtt
X3BhbmVsICpsY2QsCisJCQkJCWludCBlbmFibGVkKQoreworCWludCBjbWQgPSBlbmFibGVkID8g
TUlQSV9EQ1NfU0VUX0RJU1BMQVlfT04gOiBNSVBJX0RDU19TRVRfRElTUExBWV9PRkY7CisKKwlh
Y3g1NjVha21fY21kKGxjZCwgY21kKTsKK30KKworc3RhdGljIGludCBhY3g1NjVha21fcG93ZXJf
b24oc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkKQoreworCS8qRklYTUUgdHdlYWsgbWUgKi8K
Kwltc2xlZXAoNTApOworCisJZ3Bpb2Rfc2V0X3ZhbHVlKGxjZC0+cmVzZXRfZ3BpbywgMSk7CisK
KwlpZiAobGNkLT5lbmFibGVkKSB7CisJCWRldl9kYmcoJmxjZC0+c3BpLT5kZXYsICJwYW5lbCBh
bHJlYWR5IGVuYWJsZWRcbiIpOworCQlyZXR1cm4gMDsKKwl9CisKKwkvKgorCSAqIFdlIGhhdmUg
dG8gbWVldCBhbGwgdGhlIGZvbGxvd2luZyBkZWxheSByZXF1aXJlbWVudHM6CisJICogMS4gdFJX
OiByZXNldCBwdWxzZSB3aWR0aCAxMHVzZWMgKDcuMTIuMSkKKwkgKiAyLiB0UlQ6IHJlc2V0IGNh
bmNlbCB0aW1lIDVtc2VjICg3LjEyLjEpCisJICogMy4gUHJvdmlkaW5nIFBDTEssSFMsVlMgc2ln
bmFscyBmb3IgMiBmcmFtZXMgPSB+NTBtc2VjIHdvcnN0CisJICogICAgY2FzZSAoNy42LjIpCisJ
ICogNC4gMTIwbXNlYyBiZWZvcmUgdGhlIHNsZWVwIG91dCBjb21tYW5kICg3LjEyLjEpCisJICov
CisJbXNsZWVwKDEyMCk7CisKKwlhY3g1NjVha21fc2V0X3NsZWVwX21vZGUobGNkLCAwKTsKKwls
Y2QtPmVuYWJsZWQgPSB0cnVlOworCisJLyogNW1zZWMgYmV0d2VlbiBzbGVlcCBvdXQgYW5kIHRo
ZSBuZXh0IGNvbW1hbmQuICg4LjIuMTYpICovCisJdXNsZWVwX3JhbmdlKDUwMDAsIDEwMDAwKTsK
KwlhY3g1NjVha21fc2V0X2Rpc3BsYXlfc3RhdGUobGNkLCAxKTsKKwlhY3g1NjVha21fc2V0X2Nh
YmNfbW9kZShsY2QsIGxjZC0+Y2FiY19tb2RlKTsKKworCXJldHVybiBhY3g1NjVha21fYmxfdXBk
YXRlX3N0YXR1c19sb2NrZWQobGNkLT5iYWNrbGlnaHQpOworfQorCitzdGF0aWMgdm9pZCBhY3g1
NjVha21fcG93ZXJfb2ZmKHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCkKK3sKKwlpZiAoIWxj
ZC0+ZW5hYmxlZCkKKwkJcmV0dXJuOworCisJYWN4NTY1YWttX3NldF9kaXNwbGF5X3N0YXRlKGxj
ZCwgMCk7CisJYWN4NTY1YWttX3NldF9zbGVlcF9tb2RlKGxjZCwgMSk7CisJbGNkLT5lbmFibGVk
ID0gZmFsc2U7CisJLyoKKwkgKiBXZSBoYXZlIHRvIHByb3ZpZGUgUENMSyxIUyxWUyBzaWduYWxz
IGZvciAyIGZyYW1lcyAod29yc3QgY2FzZQorCSAqIH41MG1zZWMpIGFmdGVyIHNlbmRpbmcgdGhl
IHNsZWVwIGluIGNvbW1hbmQgYW5kIGFzc2VydGluZyB0aGUKKwkgKiByZXNldCBzaWduYWwuIFdl
IHByb2JhYmx5IGNvdWxkIGFzc2VydCB0aGUgcmVzZXQgdy9vIHRoZSBkZWxheQorCSAqIGJ1dCB3
ZSBzdGlsbCBkZWxheSB0byBhdm9pZCBwb3NzaWJsZSBhcnRpZmFjdHMuICg3LjYuMSkKKwkgKi8K
Kwltc2xlZXAoNTApOworCisJZ3Bpb2Rfc2V0X3ZhbHVlKGxjZC0+cmVzZXRfZ3BpbywgMCk7CisK
KwkvKiBGSVhNRSBuZWVkIHRvIHR3ZWFrIHRoaXMgZGVsYXkgKi8KKwltc2xlZXAoMTAwKTsKK30K
Kworc3RhdGljIGludCBhY3g1NjVha21fZGlzYWJsZShzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbCkK
K3sKKwlzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QgPSB0b19hY3g1NjVha21fZGV2aWNlKHBh
bmVsKTsKKworCW11dGV4X2xvY2soJmxjZC0+bXV0ZXgpOworCWFjeDU2NWFrbV9wb3dlcl9vZmYo
bGNkKTsKKwltdXRleF91bmxvY2soJmxjZC0+bXV0ZXgpOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQgYWN4NTY1YWttX2VuYWJsZShzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbCkKK3sKKwlz
dHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QgPSB0b19hY3g1NjVha21fZGV2aWNlKHBhbmVsKTsK
KworCW11dGV4X2xvY2soJmxjZC0+bXV0ZXgpOworCWFjeDU2NWFrbV9wb3dlcl9vbihsY2QpOwor
CW11dGV4X3VubG9jaygmbGNkLT5tdXRleCk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIGFjeDU2NWFrbV9tb2RlID0geworCS5jbG9jayA9
IDI0MDAwLAorCS5oZGlzcGxheSA9IDgwMCwKKwkuaHN5bmNfc3RhcnQgPSA4MDAgKyAyOCwKKwku
aHN5bmNfZW5kID0gODAwICsgMjggKyA0LAorCS5odG90YWwgPSA4MDAgKyAyOCArIDQgKyAyNCwK
KwkudmRpc3BsYXkgPSA0ODAsCisJLnZzeW5jX3N0YXJ0ID0gNDgwICsgMywKKwkudnN5bmNfZW5k
ID0gNDgwICsgMyArIDMsCisJLnZ0b3RhbCA9IDQ4MCArIDMgKyAzICsgNCwKKwkudnJlZnJlc2gg
PSA1NywKKwkudHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVSIHwgRFJNX01PREVfVFlQRV9QUkVG
RVJSRUQsCisJLmZsYWdzID0gRFJNX01PREVfRkxBR19OSFNZTkMgfCBEUk1fTU9ERV9GTEFHX05W
U1lOQywKKwkud2lkdGhfbW0gPSA3NywKKwkuaGVpZ2h0X21tID0gNDYsCit9OworCitzdGF0aWMg
aW50IGFjeDU2NWFrbV9nZXRfbW9kZXMoc3RydWN0IGRybV9wYW5lbCAqcGFuZWwpCit7CisJc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHBhbmVsLT5jb25uZWN0b3I7CisJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7CisKKwltb2RlID0gZHJtX21vZGVfZHVwbGljYXRlKHBh
bmVsLT5kcm0sICZhY3g1NjVha21fbW9kZSk7CisJaWYgKCFtb2RlKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCWRybV9tb2RlX3NldF9uYW1lKG1vZGUpOworCWRybV9tb2RlX3Byb2JlZF9hZGQoY29u
bmVjdG9yLCBtb2RlKTsKKworCWNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLndpZHRoX21tID0gYWN4
NTY1YWttX21vZGUud2lkdGhfbW07CisJY29ubmVjdG9yLT5kaXNwbGF5X2luZm8uaGVpZ2h0X21t
ID0gYWN4NTY1YWttX21vZGUuaGVpZ2h0X21tOworCWNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmJ1
c19mbGFncyA9IERSTV9CVVNfRkxBR19ERV9ISUdICisJCQkJCSAgfCBEUk1fQlVTX0ZMQUdfU1lO
Q19TQU1QTEVfUE9TRURHRQorCQkJCQkgIHwgRFJNX0JVU19GTEFHX1BJWERBVEFfU0FNUExFX05F
R0VER0U7CisKKwlyZXR1cm4gMTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGFuZWxf
ZnVuY3MgYWN4NTY1YWttX2Z1bmNzID0geworCS5kaXNhYmxlID0gYWN4NTY1YWttX2Rpc2FibGUs
CisJLmVuYWJsZSA9IGFjeDU2NWFrbV9lbmFibGUsCisJLmdldF9tb2RlcyA9IGFjeDU2NWFrbV9n
ZXRfbW9kZXMsCit9OworCisvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogUHJvYmUsIERldGVj
dCBhbmQgUmVtb3ZlCisgKi8KKworc3RhdGljIGludCBhY3g1NjVha21fZGV0ZWN0KHN0cnVjdCBh
Y3g1NjVha21fcGFuZWwgKmxjZCkKK3sKKwlfX2JlMzIgdmFsdWU7CisJdTMyIHN0YXR1czsKKwlp
bnQgcmV0ID0gMDsKKworCS8qCisJICogQWZ0ZXIgYmVpbmcgdGFrZW4gb3V0IG9mIHJlc2V0IHRo
ZSBwYW5lbCBuZWVkcyA1bXMgYmVmb3JlIHRoZSBmaXJzdAorCSAqIGNvbW1hbmQgY2FuIGJlIHNl
bnQuCisJICovCisJZ3Bpb2Rfc2V0X3ZhbHVlKGxjZC0+cmVzZXRfZ3BpbywgMSk7CisJdXNsZWVw
X3JhbmdlKDUwMDAsIDEwMDAwKTsKKworCWFjeDU2NWFrbV9yZWFkKGxjZCwgTUlQSV9EQ1NfR0VU
X0RJU1BMQVlfU1RBVFVTLCAodTggKikmdmFsdWUsIDQpOworCXN0YXR1cyA9IF9fYmUzMl90b19j
cHUodmFsdWUpOworCWxjZC0+ZW5hYmxlZCA9IChzdGF0dXMgJiAoMSA8PCAxNykpICYmIChzdGF0
dXMgJiAoMSA8PCAxMCkpOworCisJZGV2X2RiZygmbGNkLT5zcGktPmRldiwKKwkJIkxDRCBwYW5l
bCAlcyBieSBib290bG9hZGVyIChzdGF0dXMgMHglMDR4KVxuIiwKKwkJbGNkLT5lbmFibGVkID8g
ImVuYWJsZWQiIDogImRpc2FibGVkICIsIHN0YXR1cyk7CisKKwlhY3g1NjVha21fcmVhZChsY2Qs
IE1JUElfRENTX0dFVF9ESVNQTEFZX0lELCBsY2QtPmRpc3BsYXlfaWQsIDMpOworCWRldl9kYmco
JmxjZC0+c3BpLT5kZXYsICJNSVBJIGRpc3BsYXkgSUQ6ICUwMnglMDJ4JTAyeFxuIiwKKwkJbGNk
LT5kaXNwbGF5X2lkWzBdLCBsY2QtPmRpc3BsYXlfaWRbMV0sIGxjZC0+ZGlzcGxheV9pZFsyXSk7
CisKKwlzd2l0Y2ggKGxjZC0+ZGlzcGxheV9pZFswXSkgeworCWNhc2UgMHgxMDoKKwkJbGNkLT5t
b2RlbCA9IE1JUElEX1ZFUl9BQ1g1NjVBS007CisJCWxjZC0+bmFtZSA9ICJhY3g1NjVha20iOwor
CQlsY2QtPmhhc19iYyA9IDE7CisJCWxjZC0+aGFzX2NhYmMgPSAxOworCQlicmVhazsKKwljYXNl
IDB4Mjk6CisJCWxjZC0+bW9kZWwgPSBNSVBJRF9WRVJfTDRGMDAzMTE7CisJCWxjZC0+bmFtZSA9
ICJsNGYwMDMxMSI7CisJCWJyZWFrOworCWNhc2UgMHg0NToKKwkJbGNkLT5tb2RlbCA9IE1JUElE
X1ZFUl9MUEg4OTIzOworCQlsY2QtPm5hbWUgPSAibHBoODkyMyI7CisJCWJyZWFrOworCWNhc2Ug
MHg4MzoKKwkJbGNkLT5tb2RlbCA9IE1JUElEX1ZFUl9MUzA0MVkzOworCQlsY2QtPm5hbWUgPSAi
bHMwNDF5MyI7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWxjZC0+bmFtZSA9ICJ1bmtub3duIjsK
KwkJZGV2X2VycigmbGNkLT5zcGktPmRldiwgInVua25vd24gZGlzcGxheSBJRFxuIik7CisJCXJl
dCA9IC1FTk9ERVY7CisJCWdvdG8gZG9uZTsKKwl9CisKKwlsY2QtPnJldmlzaW9uID0gbGNkLT5k
aXNwbGF5X2lkWzFdOworCisJZGV2X2luZm8oJmxjZC0+c3BpLT5kZXYsICIlcyByZXYgJTAyeCBw
YW5lbCBkZXRlY3RlZFxuIiwKKwkJIGxjZC0+bmFtZSwgbGNkLT5yZXZpc2lvbik7CisKK2RvbmU6
CisJaWYgKCFsY2QtPmVuYWJsZWQpCisJCWdwaW9kX3NldF92YWx1ZShsY2QtPnJlc2V0X2dwaW8s
IDApOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBhY3g1NjVha21fcHJvYmUoc3Ry
dWN0IHNwaV9kZXZpY2UgKnNwaSkKK3sKKwlzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2Q7CisJ
aW50IHJldDsKKworCWxjZCA9IGRldm1fa3phbGxvYygmc3BpLT5kZXYsIHNpemVvZigqbGNkKSwg
R0ZQX0tFUk5FTCk7CisJaWYgKGxjZCA9PSBOVUxMKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXNw
aV9zZXRfZHJ2ZGF0YShzcGksIGxjZCk7CisJc3BpLT5tb2RlID0gU1BJX01PREVfMzsKKworCWxj
ZC0+c3BpID0gc3BpOworCW11dGV4X2luaXQoJmxjZC0+bXV0ZXgpOworCisJbGNkLT5yZXNldF9n
cGlvID0gZGV2bV9ncGlvZF9nZXQoJnNwaS0+ZGV2LCAicmVzZXQiLCBHUElPRF9PVVRfTE9XKTsK
KwlpZiAoSVNfRVJSKGxjZC0+cmVzZXRfZ3BpbykpIHsKKwkJZGV2X2Vycigmc3BpLT5kZXYsICJm
YWlsZWQgdG8gZ2V0IHJlc2V0IEdQSU9cbiIpOworCQlyZXR1cm4gUFRSX0VSUihsY2QtPnJlc2V0
X2dwaW8pOworCX0KKworCXJldCA9IGFjeDU2NWFrbV9kZXRlY3QobGNkKTsKKwlpZiAocmV0IDwg
MCkgeworCQlkZXZfZXJyKCZzcGktPmRldiwgInBhbmVsIGRldGVjdGlvbiBmYWlsZWRcbiIpOwor
CQlyZXR1cm4gcmV0OworCX0KKworCWlmIChsY2QtPmhhc19iYykgeworCQlyZXQgPSBhY3g1NjVh
a21fYmFja2xpZ2h0X2luaXQobGNkKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0Owor
CX0KKworCWRybV9wYW5lbF9pbml0KCZsY2QtPnBhbmVsKTsKKwlsY2QtPnBhbmVsLmRldiA9ICZs
Y2QtPnNwaS0+ZGV2OworCWxjZC0+cGFuZWwuZnVuY3MgPSAmYWN4NTY1YWttX2Z1bmNzOworCisJ
cmV0ID0gZHJtX3BhbmVsX2FkZCgmbGNkLT5wYW5lbCk7CisJaWYgKHJldCA8IDApIHsKKwkJaWYg
KGxjZC0+aGFzX2JjKQorCQkJYWN4NTY1YWttX2JhY2tsaWdodF9jbGVhbnVwKGxjZCk7CisJCXJl
dHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1YWttX3Jl
bW92ZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQoreworCXN0cnVjdCBhY3g1NjVha21fcGFuZWwg
KmxjZCA9IHNwaV9nZXRfZHJ2ZGF0YShzcGkpOworCisJZHJtX3BhbmVsX3JlbW92ZSgmbGNkLT5w
YW5lbCk7CisKKwlpZiAobGNkLT5oYXNfYmMpCisJCWFjeDU2NWFrbV9iYWNrbGlnaHRfY2xlYW51
cChsY2QpOworCisJZHJtX3BhbmVsX2Rpc2FibGUoJmxjZC0+cGFuZWwpOworCWRybV9wYW5lbF91
bnByZXBhcmUoJmxjZC0+cGFuZWwpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3Qgb2ZfZGV2aWNlX2lkIGFjeDU2NWFrbV9vZl9tYXRjaFtdID0geworCXsgLmNvbXBhdGli
bGUgPSAic29ueSxhY3g1NjVha20iLCB9LAorCXsgLyogc2VudGluZWwgKi8gfSwKK307CisKK01P
RFVMRV9ERVZJQ0VfVEFCTEUob2YsIGFjeDU2NWFrbV9vZl9tYXRjaCk7CisKK3N0YXRpYyBzdHJ1
Y3Qgc3BpX2RyaXZlciBhY3g1NjVha21fZHJpdmVyID0geworCS5wcm9iZQkJPSBhY3g1NjVha21f
cHJvYmUsCisJLnJlbW92ZQkJPSBhY3g1NjVha21fcmVtb3ZlLAorCS5kcml2ZXIJCT0geworCQku
bmFtZQk9ICJwYW5lbC1zb255LWFjeDU2NWFrbSIsCisJCS5vZl9tYXRjaF90YWJsZSA9IGFjeDU2
NWFrbV9vZl9tYXRjaCwKKwl9LAorfTsKKworbW9kdWxlX3NwaV9kcml2ZXIoYWN4NTY1YWttX2Ry
aXZlcik7CisKK01PRFVMRV9BTElBUygic3BpOnNvbnksYWN4NTY1YWttIik7CitNT0RVTEVfQVVU
SE9SKCJOb2tpYSBDb3Jwb3JhdGlvbiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJTb255IEFDWDU2
NUFLTSBMQ0QgUGFuZWwgRHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIik7Ci0tIApSZWdh
cmRzLAoKTGF1cmVudCBQaW5jaGFydAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVs
