Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5243111509C
	for <lists+dri-devel@lfdr.de>; Fri,  6 Dec 2019 13:47:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 16B266F9FF;
	Fri,  6 Dec 2019 12:47:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 240936F9F9
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Dec 2019 12:47:20 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id A0B49B1E8;
 Fri,  6 Dec 2019 12:47:18 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, sam@ravnborg.org, kraxel@redhat.com,
 emil.velikov@collabora.com, noralf@tronnes.org, zboszor@pr.hu
Subject: [PATCH v2 8/9] drm/udl: Move udl_handle_damage() into udl_modeset.c
Date: Fri,  6 Dec 2019 13:47:12 +0100
Message-Id: <20191206124713.5748-9-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191206124713.5748-1-tzimmermann@suse.de>
References: <20191206124713.5748-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 Emil Velikov <emil.l.velikov@gmail.com>,
 Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIG9ubHkgY2FsbGVyIG9mIHVkbF9oYW5kbGVfZGFtYWdlKCkgaW4gdGhlIHBsYW5lLXVwZGF0
ZSBmdW5jdGlvbgppbiB1ZGxfbW9kZXNldC5jLiBNb3ZlIHVkbF9oYW5kbGVfZGFtYWdlKCkgdGhl
cmUuCgp2MjoKCSogcmVtb3ZlIHVkbF9mYi5jIGluIGEgc2VwYXJhdGUgcGF0Y2gKClNpZ25lZC1v
ZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgpSZXZpZXdlZC1i
eTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KUmV2aWV3ZWQtYnk6IEVt
aWwgVmVsaWtvdiA8ZW1pbC5sLnZlbGlrb3ZAZ21haWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS91ZGwvdWRsX2Rydi5oICAgICB8ICAgMyAtCiBkcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9mYi5j
ICAgICAgfCAxMTEgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9k
cm0vdWRsL3VkbF9tb2Rlc2V0LmMgfCAxMTEgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
CiAzIGZpbGVzIGNoYW5nZWQsIDExMSBpbnNlcnRpb25zKCspLCAxMTQgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfZHJ2LmggYi9kcml2ZXJzL2dwdS9k
cm0vdWRsL3VkbF9kcnYuaAppbmRleCBhNzYzOTc4MzFjZWUuLjY3YWI5NWNmNjRiMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3VkbC91ZGxfZHJ2LmgKQEAgLTg3LDkgKzg3LDYgQEAgaW50IHVkbF9yZW5kZXJfaGxpbmUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGxvZ19icHAsIHN0cnVjdCB1cmIgKip1cmJfcHRyLAog
c3RydWN0IGRybV9nZW1fb2JqZWN0ICp1ZGxfZHJpdmVyX2dlbV9jcmVhdGVfb2JqZWN0KHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCQkgICAgc2l6ZV90IHNpemUpOwogCi1pbnQgdWRsX2hh
bmRsZV9kYW1hZ2Uoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCB4LCBpbnQgeSwKLQkJ
ICAgICAgaW50IHdpZHRoLCBpbnQgaGVpZ2h0KTsKLQogaW50IHVkbF9kcm9wX3VzYihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KTsKIAogI2RlZmluZSBDTURfV1JJVEVfUkFXOCAgICJceEFGXHg2MCIg
LyoqPCA4IGJpdCByYXcgd3JpdGUgY29tbWFuZC4gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS91ZGwvdWRsX2ZiLmMgYi9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9mYi5jCmluZGV4IDM5
N2M2MjE0Mjk3OC4uODRjZmY5ZDllZGJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRs
L3VkbF9mYi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2ZiLmMKQEAgLTksMTAgKzks
NiBAQAogICovCiAKICNpbmNsdWRlIDxsaW51eC9tb2R1bGVwYXJhbS5oPgotI2luY2x1ZGUgPGxp
bnV4L2RtYS1idWYuaD4KLQotI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+Ci0jaW5jbHVkZSA8
ZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmg+CiAKICNpbmNsdWRlICJ1ZGxfZHJ2LmgiCiAKQEAg
LTUzLDExMCArNDksMyBAQCBzdGF0aWMgdWludDE2X3QgcmdiMTYodWludDMyX3QgY29sKQogCXJl
dHVybiAoRExPX1JHMTYocmVkLCBncm4pIDw8IDgpICsgRExPX0dCMTYoZ3JuLCBibHUpOwogfQog
I2VuZGlmCi0KLXN0YXRpYyBsb25nIHVkbF9sb2dfY3BwKHVuc2lnbmVkIGludCBjcHApCi17Ci0J
aWYgKFdBUk5fT04oIWlzX3Bvd2VyX29mXzIoY3BwKSkpCi0JCXJldHVybiAtRUlOVkFMOwotCXJl
dHVybiBfX2ZmcyhjcHApOwotfQotCi1zdGF0aWMgaW50IHVkbF9hbGlnbmVkX2RhbWFnZV9jbGlw
KHN0cnVjdCBkcm1fcmVjdCAqY2xpcCwgaW50IHgsIGludCB5LAotCQkJCSAgIGludCB3aWR0aCwg
aW50IGhlaWdodCkKLXsKLQlpbnQgeDEsIHgyOwotCi0JaWYgKFdBUk5fT05fT05DRSh4IDwgMCkg
fHwKLQkgICAgV0FSTl9PTl9PTkNFKHkgPCAwKSB8fAotCSAgICBXQVJOX09OX09OQ0Uod2lkdGgg
PCAwKSB8fAotCSAgICBXQVJOX09OX09OQ0UoaGVpZ2h0IDwgMCkpCi0JCXJldHVybiAtRUlOVkFM
OwotCi0JeDEgPSBBTElHTl9ET1dOKHgsIHNpemVvZih1bnNpZ25lZCBsb25nKSk7Ci0JeDIgPSBB
TElHTih3aWR0aCArICh4IC0geDEpLCBzaXplb2YodW5zaWduZWQgbG9uZykpICsgeDE7Ci0KLQlj
bGlwLT54MSA9IHgxOwotCWNsaXAtPnkxID0geTsKLQljbGlwLT54MiA9IHgyOwotCWNsaXAtPnky
ID0geSArIGhlaWdodDsKLQotCXJldHVybiAwOwotfQotCi1pbnQgdWRsX2hhbmRsZV9kYW1hZ2Uo
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCB4LCBpbnQgeSwKLQkJICAgICAgaW50IHdp
ZHRoLCBpbnQgaGVpZ2h0KQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBmYi0+ZGV2Owot
CXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmltcG9ydF9hdHRhY2ggPSBmYi0+b2JqWzBdLT5p
bXBvcnRfYXR0YWNoOwotCWludCBpLCByZXQsIHRtcF9yZXQ7Ci0JY2hhciAqY21kOwotCXN0cnVj
dCB1cmIgKnVyYjsKLQlzdHJ1Y3QgZHJtX3JlY3QgY2xpcDsKLQlpbnQgbG9nX2JwcDsKLQl2b2lk
ICp2YWRkcjsKLQotCXJldCA9IHVkbF9sb2dfY3BwKGZiLT5mb3JtYXQtPmNwcFswXSk7Ci0JaWYg
KHJldCA8IDApCi0JCXJldHVybiByZXQ7Ci0JbG9nX2JwcCA9IHJldDsKLQotCXJldCA9IHVkbF9h
bGlnbmVkX2RhbWFnZV9jbGlwKCZjbGlwLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCWVsc2UgaWYgKChjbGlwLngyID4gZmItPndpZHRoKSB8fCAoY2xp
cC55MiA+IGZiLT5oZWlnaHQpKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChpbXBvcnRfYXR0
YWNoKSB7Ci0JCXJldCA9IGRtYV9idWZfYmVnaW5fY3B1X2FjY2VzcyhpbXBvcnRfYXR0YWNoLT5k
bWFidWYsCi0JCQkJCSAgICAgICBETUFfRlJPTV9ERVZJQ0UpOwotCQlpZiAocmV0KQotCQkJcmV0
dXJuIHJldDsKLQl9Ci0KLQl2YWRkciA9IGRybV9nZW1fc2htZW1fdm1hcChmYi0+b2JqWzBdKTsK
LQlpZiAoSVNfRVJSKHZhZGRyKSkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byB2bWFwIGZiXG4i
KTsKLQkJZ290byBvdXRfZG1hX2J1Zl9lbmRfY3B1X2FjY2VzczsKLQl9Ci0KLQl1cmIgPSB1ZGxf
Z2V0X3VyYihkZXYpOwotCWlmICghdXJiKQotCQlnb3RvIG91dF9kcm1fZ2VtX3NobWVtX3Z1bm1h
cDsKLQljbWQgPSB1cmItPnRyYW5zZmVyX2J1ZmZlcjsKLQotCWZvciAoaSA9IGNsaXAueTE7IGkg
PCBjbGlwLnkyOyBpKyspIHsKLQkJY29uc3QgaW50IGxpbmVfb2Zmc2V0ID0gZmItPnBpdGNoZXNb
MF0gKiBpOwotCQljb25zdCBpbnQgYnl0ZV9vZmZzZXQgPSBsaW5lX29mZnNldCArIChjbGlwLngx
IDw8IGxvZ19icHApOwotCQljb25zdCBpbnQgZGV2X2J5dGVfb2Zmc2V0ID0gKGZiLT53aWR0aCAq
IGkgKyBjbGlwLngxKSA8PCBsb2dfYnBwOwotCQljb25zdCBpbnQgYnl0ZV93aWR0aCA9IChjbGlw
LngyIC0gY2xpcC54MSkgPDwgbG9nX2JwcDsKLQkJcmV0ID0gdWRsX3JlbmRlcl9obGluZShkZXYs
IGxvZ19icHAsICZ1cmIsIChjaGFyICopdmFkZHIsCi0JCQkJICAgICAgICZjbWQsIGJ5dGVfb2Zm
c2V0LCBkZXZfYnl0ZV9vZmZzZXQsCi0JCQkJICAgICAgIGJ5dGVfd2lkdGgpOwotCQlpZiAocmV0
KQotCQkJZ290byBvdXRfZHJtX2dlbV9zaG1lbV92dW5tYXA7Ci0JfQotCi0JaWYgKGNtZCA+IChj
aGFyICopIHVyYi0+dHJhbnNmZXJfYnVmZmVyKSB7Ci0JCS8qIFNlbmQgcGFydGlhbCBidWZmZXIg
cmVtYWluaW5nIGJlZm9yZSBleGl0aW5nICovCi0JCWludCBsZW47Ci0JCWlmIChjbWQgPCAoY2hh
ciAqKSB1cmItPnRyYW5zZmVyX2J1ZmZlciArIHVyYi0+dHJhbnNmZXJfYnVmZmVyX2xlbmd0aCkK
LQkJCSpjbWQrKyA9IDB4QUY7Ci0JCWxlbiA9IGNtZCAtIChjaGFyICopIHVyYi0+dHJhbnNmZXJf
YnVmZmVyOwotCQlyZXQgPSB1ZGxfc3VibWl0X3VyYihkZXYsIHVyYiwgbGVuKTsKLQl9IGVsc2UK
LQkJdWRsX3VyYl9jb21wbGV0aW9uKHVyYik7Ci0KLQlyZXQgPSAwOwotCi1vdXRfZHJtX2dlbV9z
aG1lbV92dW5tYXA6Ci0JZHJtX2dlbV9zaG1lbV92dW5tYXAoZmItPm9ialswXSwgdmFkZHIpOwot
b3V0X2RtYV9idWZfZW5kX2NwdV9hY2Nlc3M6Ci0JaWYgKGltcG9ydF9hdHRhY2gpIHsKLQkJdG1w
X3JldCA9IGRtYV9idWZfZW5kX2NwdV9hY2Nlc3MoaW1wb3J0X2F0dGFjaC0+ZG1hYnVmLAotCQkJ
CQkJIERNQV9GUk9NX0RFVklDRSk7Ci0JCWlmICh0bXBfcmV0ICYmICFyZXQpCi0JCQlyZXQgPSB0
bXBfcmV0OyAvKiBvbmx5IHVwZGF0ZSByZXQgaWYgbm90IHNldCB5ZXQgKi8KLQl9Ci0KLQlyZXR1
cm4gcmV0OwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfbW9kZXNldC5j
IGIvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfbW9kZXNldC5jCmluZGV4IDIxYzBiOTUyMTRjYS4u
YzVkYTliN2NkZGQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9tb2Rlc2V0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfbW9kZXNldC5jCkBAIC05LDEwICs5LDE0
IEBACiAKICAqLwogCisjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgorCiAjaW5jbHVkZSA8ZHJt
L2RybV9hdG9taWNfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRjX2hlbHBlci5oPgog
I2luY2x1ZGUgPGRybS9kcm1fZGFtYWdlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91
cmNjLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9tb2Rl
c2V0X2hlbHBlcl92dGFibGVzLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KIApAQCAt
MjM5LDYgKzI0MywxMTMgQEAgc3RhdGljIGludCB1ZGxfY3J0Y193cml0ZV9tb2RlX3RvX2h3KHN0
cnVjdCBkcm1fY3J0YyAqY3J0YykKIAlyZXR1cm4gcmV0dmFsOwogfQogCitzdGF0aWMgbG9uZyB1
ZGxfbG9nX2NwcCh1bnNpZ25lZCBpbnQgY3BwKQoreworCWlmIChXQVJOX09OKCFpc19wb3dlcl9v
Zl8yKGNwcCkpKQorCQlyZXR1cm4gLUVJTlZBTDsKKwlyZXR1cm4gX19mZnMoY3BwKTsKK30KKwor
c3RhdGljIGludCB1ZGxfYWxpZ25lZF9kYW1hZ2VfY2xpcChzdHJ1Y3QgZHJtX3JlY3QgKmNsaXAs
IGludCB4LCBpbnQgeSwKKwkJCQkgICBpbnQgd2lkdGgsIGludCBoZWlnaHQpCit7CisJaW50IHgx
LCB4MjsKKworCWlmIChXQVJOX09OX09OQ0UoeCA8IDApIHx8CisJICAgIFdBUk5fT05fT05DRSh5
IDwgMCkgfHwKKwkgICAgV0FSTl9PTl9PTkNFKHdpZHRoIDwgMCkgfHwKKwkgICAgV0FSTl9PTl9P
TkNFKGhlaWdodCA8IDApKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXgxID0gQUxJR05fRE9XTih4
LCBzaXplb2YodW5zaWduZWQgbG9uZykpOworCXgyID0gQUxJR04od2lkdGggKyAoeCAtIHgxKSwg
c2l6ZW9mKHVuc2lnbmVkIGxvbmcpKSArIHgxOworCisJY2xpcC0+eDEgPSB4MTsKKwljbGlwLT55
MSA9IHk7CisJY2xpcC0+eDIgPSB4MjsKKwljbGlwLT55MiA9IHkgKyBoZWlnaHQ7CisKKwlyZXR1
cm4gMDsKK30KKworaW50IHVkbF9oYW5kbGVfZGFtYWdlKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLCBpbnQgeCwgaW50IHksCisJCSAgICAgIGludCB3aWR0aCwgaW50IGhlaWdodCkKK3sKKwlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZmItPmRldjsKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2ht
ZW50ICppbXBvcnRfYXR0YWNoID0gZmItPm9ialswXS0+aW1wb3J0X2F0dGFjaDsKKwlpbnQgaSwg
cmV0LCB0bXBfcmV0OworCWNoYXIgKmNtZDsKKwlzdHJ1Y3QgdXJiICp1cmI7CisJc3RydWN0IGRy
bV9yZWN0IGNsaXA7CisJaW50IGxvZ19icHA7CisJdm9pZCAqdmFkZHI7CisKKwlyZXQgPSB1ZGxf
bG9nX2NwcChmYi0+Zm9ybWF0LT5jcHBbMF0pOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0
OworCWxvZ19icHAgPSByZXQ7CisKKwlyZXQgPSB1ZGxfYWxpZ25lZF9kYW1hZ2VfY2xpcCgmY2xp
cCwgeCwgeSwgd2lkdGgsIGhlaWdodCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwllbHNl
IGlmICgoY2xpcC54MiA+IGZiLT53aWR0aCkgfHwgKGNsaXAueTIgPiBmYi0+aGVpZ2h0KSkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoaW1wb3J0X2F0dGFjaCkgeworCQlyZXQgPSBkbWFfYnVm
X2JlZ2luX2NwdV9hY2Nlc3MoaW1wb3J0X2F0dGFjaC0+ZG1hYnVmLAorCQkJCQkgICAgICAgRE1B
X0ZST01fREVWSUNFKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCisJdmFkZHIg
PSBkcm1fZ2VtX3NobWVtX3ZtYXAoZmItPm9ialswXSk7CisJaWYgKElTX0VSUih2YWRkcikpIHsK
KwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gdm1hcCBmYlxuIik7CisJCWdvdG8gb3V0X2RtYV9idWZf
ZW5kX2NwdV9hY2Nlc3M7CisJfQorCisJdXJiID0gdWRsX2dldF91cmIoZGV2KTsKKwlpZiAoIXVy
YikKKwkJZ290byBvdXRfZHJtX2dlbV9zaG1lbV92dW5tYXA7CisJY21kID0gdXJiLT50cmFuc2Zl
cl9idWZmZXI7CisKKwlmb3IgKGkgPSBjbGlwLnkxOyBpIDwgY2xpcC55MjsgaSsrKSB7CisJCWNv
bnN0IGludCBsaW5lX29mZnNldCA9IGZiLT5waXRjaGVzWzBdICogaTsKKwkJY29uc3QgaW50IGJ5
dGVfb2Zmc2V0ID0gbGluZV9vZmZzZXQgKyAoY2xpcC54MSA8PCBsb2dfYnBwKTsKKwkJY29uc3Qg
aW50IGRldl9ieXRlX29mZnNldCA9IChmYi0+d2lkdGggKiBpICsgY2xpcC54MSkgPDwgbG9nX2Jw
cDsKKwkJY29uc3QgaW50IGJ5dGVfd2lkdGggPSAoY2xpcC54MiAtIGNsaXAueDEpIDw8IGxvZ19i
cHA7CisJCXJldCA9IHVkbF9yZW5kZXJfaGxpbmUoZGV2LCBsb2dfYnBwLCAmdXJiLCAoY2hhciAq
KXZhZGRyLAorCQkJCSAgICAgICAmY21kLCBieXRlX29mZnNldCwgZGV2X2J5dGVfb2Zmc2V0LAor
CQkJCSAgICAgICBieXRlX3dpZHRoKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0X2RybV9nZW1f
c2htZW1fdnVubWFwOworCX0KKworCWlmIChjbWQgPiAoY2hhciAqKSB1cmItPnRyYW5zZmVyX2J1
ZmZlcikgeworCQkvKiBTZW5kIHBhcnRpYWwgYnVmZmVyIHJlbWFpbmluZyBiZWZvcmUgZXhpdGlu
ZyAqLworCQlpbnQgbGVuOworCQlpZiAoY21kIDwgKGNoYXIgKikgdXJiLT50cmFuc2Zlcl9idWZm
ZXIgKyB1cmItPnRyYW5zZmVyX2J1ZmZlcl9sZW5ndGgpCisJCQkqY21kKysgPSAweEFGOworCQls
ZW4gPSBjbWQgLSAoY2hhciAqKSB1cmItPnRyYW5zZmVyX2J1ZmZlcjsKKwkJcmV0ID0gdWRsX3N1
Ym1pdF91cmIoZGV2LCB1cmIsIGxlbik7CisJfSBlbHNlCisJCXVkbF91cmJfY29tcGxldGlvbih1
cmIpOworCisJcmV0ID0gMDsKKworb3V0X2RybV9nZW1fc2htZW1fdnVubWFwOgorCWRybV9nZW1f
c2htZW1fdnVubWFwKGZiLT5vYmpbMF0sIHZhZGRyKTsKK291dF9kbWFfYnVmX2VuZF9jcHVfYWNj
ZXNzOgorCWlmIChpbXBvcnRfYXR0YWNoKSB7CisJCXRtcF9yZXQgPSBkbWFfYnVmX2VuZF9jcHVf
YWNjZXNzKGltcG9ydF9hdHRhY2gtPmRtYWJ1ZiwKKwkJCQkJCSBETUFfRlJPTV9ERVZJQ0UpOwor
CQlpZiAodG1wX3JldCAmJiAhcmV0KQorCQkJcmV0ID0gdG1wX3JldDsgLyogb25seSB1cGRhdGUg
cmV0IGlmIG5vdCBzZXQgeWV0ICovCisJfQorCisJcmV0dXJuIHJldDsKK30KKwogLyoKICAqIFNp
bXBsZSBkaXNwbGF5IHBpcGVsaW5lCiAgKi8KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
