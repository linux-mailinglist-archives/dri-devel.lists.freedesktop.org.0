Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 52321F3086
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 14:52:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E9956F6A1;
	Thu,  7 Nov 2019 13:52:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from verein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 03CDB6F69E
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 13:52:16 +0000 (UTC)
Received: by verein.lst.de (Postfix, from userid 2005)
 id 966BD68BFE; Thu,  7 Nov 2019 14:52:14 +0100 (CET)
In-Reply-To: <20191107135018.0A04068BE1@verein.lst.de>
References: <20191107135018.0A04068BE1@verein.lst.de>
From: Torsten Duwe <duwe@lst.de>
Date: Tue, 29 Oct 2019 13:16:57 +0100
Subject: [PATCH v5 3/7] drm/bridge: extract some Analogix I2C DP common code
To: Maxime Ripard <mripard@kernel.org>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Message-Id: <20191107135214.966BD68BFE@verein.lst.de>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKU29tZSBjb2RlIGNhbiBiZSBz
aGFyZWQgd2l0aGluIGRpZmZlcmVudCBEUCBicmlkZ2VzIGJ5IEFuYWxvZ2l4LgpFeHRyYWN0IHRo
ZW0gdG8gYW5hbG9naXhfZHAuCgpTaWduZWQtb2ZmLWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5
QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2lseSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFp
bC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4gRHV3ZSA8ZHV3ZUBzdXNlLmRlPgpSZXZpZXdl
ZC1ieTogQW5kcnplaiBIYWpkYSA8YS5oYWpkYUBzYW1zdW5nLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vYnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlICAgICAgICAgICB8ICAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1hbng3OHh4LmMgfCAxNDYgKy0tLS0t
LS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtaTJjLWRw
dHguYyAgICB8IDE2NSArKysrKysrKysrKysrKysrKysrKysKIC4uLi9ncHUvZHJtL2JyaWRnZS9h
bmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oICAgIHwgICAzICsKIDQgZmlsZXMgY2hhbmdlZCwg
MTcwIGluc2VydGlvbnMoKyksIDE0NiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmMKCi0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZQpAQCAtMSw0ICsxLDQgQEAKICMgU1BEWC1M
aWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQotYW5hbG9naXhfZHAtb2JqcyA6PSBhbmFs
b2dpeF9kcF9jb3JlLm8gYW5hbG9naXhfZHBfcmVnLm8KK2FuYWxvZ2l4X2RwLW9ianMgOj0gYW5h
bG9naXhfZHBfY29yZS5vIGFuYWxvZ2l4X2RwX3JlZy5vIGFuYWxvZ2l4LWkyYy1kcHR4Lm8KIG9i
ai0kKENPTkZJR19EUk1fQU5BTE9HSVhfQU5YNzhYWCkgKz0gYW5hbG9naXgtYW54Nzh4eC5vCiBv
YmotJChDT05GSUdfRFJNX0FOQUxPR0lYX0RQKSArPSBhbmFsb2dpeF9kcC5vCi0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54Nzh4eC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54Nzh4eC5jCkBAIC0zNiw4ICsz
Niw2IEBACiAjZGVmaW5lIEkyQ19JRFhfUlhfUDEJCTQKIAogI2RlZmluZSBYVEFMX0NMSwkJMjcw
IC8qIDI3TSAqLwotI2RlZmluZSBBVVhfQ0hfQlVGRkVSX1NJWkUJMTYKLSNkZWZpbmUgQVVYX1dB
SVRfVElNRU9VVF9NUwkxNQogCiBzdGF0aWMgY29uc3QgdTggYW54NzgwOF9pMmNfYWRkcmVzc2Vz
W10gPSB7CiAJW0kyQ19JRFhfVFhfUDBdID0gMHg3OCwKQEAgLTEwNywxNTMgKzEwNSwxMSBAQCBz
dGF0aWMgaW50IGFueDc4eHhfY2xlYXJfYml0cyhzdHJ1Y3QgcmVnCiAJcmV0dXJuIHJlZ21hcF91
cGRhdGVfYml0cyhtYXAsIHJlZywgbWFzaywgMCk7CiB9CiAKLXN0YXRpYyBib29sIGFueDc4eHhf
YXV4X29wX2ZpbmlzaGVkKHN0cnVjdCBhbng3OHh4ICphbng3OHh4KQotewotCXVuc2lnbmVkIGlu
dCB2YWx1ZTsKLQlpbnQgZXJyOwotCi0JZXJyID0gcmVnbWFwX3JlYWQoYW54Nzh4eC0+bWFwW0ky
Q19JRFhfVFhfUDBdLCBTUF9EUF9BVVhfQ0hfQ1RSTDJfUkVHLAotCQkJICAmdmFsdWUpOwotCWlm
IChlcnIgPCAwKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gKHZhbHVlICYgU1BfQVVYX0VO
KSA9PSAwOwotfQotCi1zdGF0aWMgaW50IGFueDc4eHhfYXV4X3dhaXQoc3RydWN0IGFueDc4eHgg
KmFueDc4eHgpCi17Ci0JdW5zaWduZWQgbG9uZyB0aW1lb3V0OwotCXVuc2lnbmVkIGludCBzdGF0
dXM7Ci0JaW50IGVycjsKLQotCXRpbWVvdXQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlmZmllcyhB
VVhfV0FJVF9USU1FT1VUX01TKSArIDE7Ci0KLQl3aGlsZSAoIWFueDc4eHhfYXV4X29wX2Zpbmlz
aGVkKGFueDc4eHgpKSB7Ci0JCWlmICh0aW1lX2FmdGVyKGppZmZpZXMsIHRpbWVvdXQpKSB7Ci0J
CQlpZiAoIWFueDc4eHhfYXV4X29wX2ZpbmlzaGVkKGFueDc4eHgpKSB7Ci0JCQkJRFJNX0VSUk9S
KCJUaW1lZCBvdXQgd2FpdGluZyBBVVggdG8gZmluaXNoXG4iKTsKLQkJCQlyZXR1cm4gLUVUSU1F
RE9VVDsKLQkJCX0KLQotCQkJYnJlYWs7Ci0JCX0KLQotCQl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAw
MCk7Ci0JfQotCi0JLyogUmVhZCB0aGUgQVVYIGNoYW5uZWwgYWNjZXNzIHN0YXR1cyAqLwotCWVy
ciA9IHJlZ21hcF9yZWFkKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfQVVYX0NIX1NU
QVRVU19SRUcsCi0JCQkgICZzdGF0dXMpOwotCWlmIChlcnIgPCAwKSB7Ci0JCURSTV9FUlJPUigi
RmFpbGVkIHRvIHJlYWQgZnJvbSBBVVggY2hhbm5lbDogJWRcbiIsIGVycik7Ci0JCXJldHVybiBl
cnI7Ci0JfQotCi0JaWYgKHN0YXR1cyAmIFNQX0FVWF9TVEFUVVMpIHsKLQkJRFJNX0VSUk9SKCJG
YWlsZWQgdG8gd2FpdCBmb3IgQVVYIGNoYW5uZWwgKHN0YXR1czogJTAyeClcbiIsCi0JCQkgIHN0
YXR1cyk7Ci0JCXJldHVybiAtRVRJTUVET1VUOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgaW50IGFueDc4eHhfYXV4X2FkZHJlc3Moc3RydWN0IGFueDc4eHggKmFueDc4eHgsIHVuc2ln
bmVkIGludCBhZGRyKQotewotCWludCBlcnI7Ci0KLQllcnIgPSByZWdtYXBfd3JpdGUoYW54Nzh4
eC0+bWFwW0kyQ19JRFhfVFhfUDBdLCBTUF9BVVhfQUREUl83XzBfUkVHLAotCQkJICAgYWRkciAm
IDB4ZmYpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQllcnIgPSByZWdtYXBfd3JpdGUo
YW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLCBTUF9BVVhfQUREUl8xNV84X1JFRywKLQkJCSAg
IChhZGRyICYgMHhmZjAwKSA+PiA4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JLyoK
LQkgKiBEUCBBVVggQ0ggQWRkcmVzcyBSZWdpc3RlciAjMiwgb25seSB1cGRhdGUgYml0c1szOjBd
Ci0JICogWzc6NF0gUkVTRVJWRUQKLQkgKiBbMzowXSBBVVhfQUREUlsxOToxNl0sIFJlZ2lzdGVy
IGNvbnRyb2wgQVVYIENIIGFkZHJlc3MuCi0JICovCi0JZXJyID0gcmVnbWFwX3VwZGF0ZV9iaXRz
KGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwKLQkJCQkgU1BfQVVYX0FERFJfMTlfMTZfUkVH
LAotCQkJCSBTUF9BVVhfQUREUl8xOV8xNl9NQVNLLAotCQkJCSAoYWRkciAmIDB4ZjAwMDApID4+
IDE2KTsKLQotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3Rh
dGljIHNzaXplX3QgYW54Nzh4eF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwK
IAkJCQkgICAgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCiB7CiAJc3RydWN0IGFueDc4eHgg
KmFueDc4eHggPSBjb250YWluZXJfb2YoYXV4LCBzdHJ1Y3QgYW54Nzh4eCwgYXV4KTsKLQl1OCBj
dHJsMSA9IG1zZy0+cmVxdWVzdDsKLQl1OCBjdHJsMiA9IFNQX0FVWF9FTjsKLQl1OCAqYnVmZmVy
ID0gbXNnLT5idWZmZXI7Ci0JaW50IGVycjsKLQotCS8qIFRoZSBEUCBBVVggdHJhbnNtaXQgYW5k
IHJlY2VpdmUgYnVmZmVyIGhhcyAxNiBieXRlcy4gKi8KLQlpZiAoV0FSTl9PTihtc2ctPnNpemUg
PiBBVVhfQ0hfQlVGRkVSX1NJWkUpKQotCQlyZXR1cm4gLUUyQklHOwotCi0JLyogWmVyby1zaXpl
ZCBtZXNzYWdlcyBzcGVjaWZ5IGFkZHJlc3Mtb25seSB0cmFuc2FjdGlvbnMuICovCi0JaWYgKG1z
Zy0+c2l6ZSA8IDEpCi0JCWN0cmwyIHw9IFNQX0FERFJfT05MWTsKLQllbHNlCS8qIEZvciBub24t
emVyby1zaXplZCBzZXQgdGhlIGxlbmd0aCBmaWVsZC4gKi8KLQkJY3RybDEgfD0gKG1zZy0+c2l6
ZSAtIDEpIDw8IFNQX0FVWF9MRU5HVEhfU0hJRlQ7Ci0KLQlpZiAoKG1zZy0+cmVxdWVzdCAmIERQ
X0FVWF9JMkNfUkVBRCkgPT0gMCkgewotCQkvKiBXaGVuIFdSSVRFIHwgTU9UIHdyaXRlIHZhbHVl
cyB0byBkYXRhIGJ1ZmZlciAqLwotCQllcnIgPSByZWdtYXBfYnVsa193cml0ZShhbng3OHh4LT5t
YXBbSTJDX0lEWF9UWF9QMF0sCi0JCQkJCVNQX0RQX0JVRl9EQVRBMF9SRUcsIGJ1ZmZlciwKLQkJ
CQkJbXNnLT5zaXplKTsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7Ci0JfQotCi0JLyogV3Jp
dGUgYWRkcmVzcyBhbmQgcmVxdWVzdCAqLwotCWVyciA9IGFueDc4eHhfYXV4X2FkZHJlc3MoYW54
Nzh4eCwgbXNnLT5hZGRyZXNzKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JZXJyID0g
cmVnbWFwX3dyaXRlKGFueDc4eHgtPm1hcFtJMkNfSURYX1RYX1AwXSwgU1BfRFBfQVVYX0NIX0NU
UkwxX1JFRywKLQkJCSAgIGN0cmwxKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JLyog
U3RhcnQgdHJhbnNhY3Rpb24gKi8KLQllcnIgPSByZWdtYXBfdXBkYXRlX2JpdHMoYW54Nzh4eC0+
bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJCSBTUF9EUF9BVVhfQ0hfQ1RSTDJfUkVHLCBTUF9BRERS
X09OTFkgfAotCQkJCSBTUF9BVVhfRU4sIGN0cmwyKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJy
OwotCi0JZXJyID0gYW54Nzh4eF9hdXhfd2FpdChhbng3OHh4KTsKLQlpZiAoZXJyKQotCQlyZXR1
cm4gZXJyOwotCi0JbXNnLT5yZXBseSA9IERQX0FVWF9JMkNfUkVQTFlfQUNLOwotCi0JaWYgKCht
c2ctPnNpemUgPiAwKSAmJiAobXNnLT5yZXF1ZXN0ICYgRFBfQVVYX0kyQ19SRUFEKSkgewotCQkv
KiBSZWFkIHZhbHVlcyBmcm9tIGRhdGEgYnVmZmVyICovCi0JCWVyciA9IHJlZ21hcF9idWxrX3Jl
YWQoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLAotCQkJCSAgICAgICBTUF9EUF9CVUZfREFU
QTBfUkVHLCBidWZmZXIsCi0JCQkJICAgICAgIG1zZy0+c2l6ZSk7Ci0JCWlmIChlcnIpCi0JCQly
ZXR1cm4gZXJyOwotCX0KLQotCWVyciA9IGFueDc4eHhfY2xlYXJfYml0cyhhbng3OHh4LT5tYXBb
STJDX0lEWF9UWF9QMF0sCi0JCQkJIFNQX0RQX0FVWF9DSF9DVFJMMl9SRUcsIFNQX0FERFJfT05M
WSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCXJldHVybiBtc2ctPnNpemU7CisJcmV0
dXJuIGFueF9kcF9hdXhfdHJhbnNmZXIoYW54Nzh4eC0+bWFwW0kyQ19JRFhfVFhfUDBdLCBtc2cp
OwogfQogCiBzdGF0aWMgaW50IGFueDc4eHhfc2V0X2hwZChzdHJ1Y3QgYW54Nzh4eCAqYW54Nzh4
eCkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2Fu
YWxvZ2l4LWkyYy1kcHR4LmMKQEAgLTAsMCArMSwxNjUgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wLW9ubHkgKi8KKy8qCisgKiBDb3B5cmlnaHQoYykgMjAxNiwgQW5hbG9n
aXggU2VtaWNvbmR1Y3Rvci4KKyAqCisgKiBCYXNlZCBvbiBhbng3ODA4IGRyaXZlciBvYnRhaW5l
ZCBmcm9tIGNocm9tZW9zIHdpdGggY29weXJpZ2h0OgorICogQ29weXJpZ2h0KGMpIDIwMTMsIEdv
b2dsZSBJbmMuCisgKi8KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKworI2luY2x1ZGUgPGRy
bS9kcm0uaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RwX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9k
cm1fcHJpbnQuaD4KKworI2luY2x1ZGUgImFuYWxvZ2l4LWkyYy1kcHR4LmgiCisKKyNkZWZpbmUg
QVVYX1dBSVRfVElNRU9VVF9NUwkxNQorI2RlZmluZSBBVVhfQ0hfQlVGRkVSX1NJWkUJMTYKKwor
c3RhdGljIGludCBhbnhfaTJjX2RwX2NsZWFyX2JpdHMoc3RydWN0IHJlZ21hcCAqbWFwLCB1OCBy
ZWcsIHU4IG1hc2spCit7CisJcmV0dXJuIHJlZ21hcF91cGRhdGVfYml0cyhtYXAsIHJlZywgbWFz
aywgMCk7Cit9CisKK3N0YXRpYyBib29sIGFueF9kcF9hdXhfb3BfZmluaXNoZWQoc3RydWN0IHJl
Z21hcCAqbWFwX2RwdHgpCit7CisJdW5zaWduZWQgaW50IHZhbHVlOworCWludCBlcnI7CisKKwll
cnIgPSByZWdtYXBfcmVhZChtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywgJnZhbHVl
KTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuICh2YWx1ZSAmIFNQ
X0FVWF9FTikgPT0gMDsKK30KKworc3RhdGljIGludCBhbnhfZHBfYXV4X3dhaXQoc3RydWN0IHJl
Z21hcCAqbWFwX2RwdHgpCit7CisJdW5zaWduZWQgbG9uZyB0aW1lb3V0OworCXVuc2lnbmVkIGlu
dCBzdGF0dXM7CisJaW50IGVycjsKKworCXRpbWVvdXQgPSBqaWZmaWVzICsgbXNlY3NfdG9famlm
ZmllcyhBVVhfV0FJVF9USU1FT1VUX01TKSArIDE7CisKKwl3aGlsZSAoIWFueF9kcF9hdXhfb3Bf
ZmluaXNoZWQobWFwX2RwdHgpKSB7CisJCWlmICh0aW1lX2FmdGVyKGppZmZpZXMsIHRpbWVvdXQp
KSB7CisJCQlpZiAoIWFueF9kcF9hdXhfb3BfZmluaXNoZWQobWFwX2RwdHgpKSB7CisJCQkJRFJN
X0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBBVVggdG8gZmluaXNoXG4iKTsKKwkJCQlyZXR1cm4g
LUVUSU1FRE9VVDsKKwkJCX0KKworCQkJYnJlYWs7CisJCX0KKworCQl1c2xlZXBfcmFuZ2UoMTAw
MCwgMjAwMCk7CisJfQorCisJLyogUmVhZCB0aGUgQVVYIGNoYW5uZWwgYWNjZXNzIHN0YXR1cyAq
LworCWVyciA9IHJlZ21hcF9yZWFkKG1hcF9kcHR4LCBTUF9BVVhfQ0hfU1RBVFVTX1JFRywgJnN0
YXR1cyk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVhZCBmcm9t
IEFVWCBjaGFubmVsOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlpZiAoc3Rh
dHVzICYgU1BfQVVYX1NUQVRVUykgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byB3YWl0IGZvciBB
VVggY2hhbm5lbCAoc3RhdHVzOiAlMDJ4KVxuIiwKKwkJCSAgc3RhdHVzKTsKKwkJcmV0dXJuIC1F
VElNRURPVVQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYW54X2RwX2F1eF9h
ZGRyZXNzKHN0cnVjdCByZWdtYXAgKm1hcF9kcHR4LCB1bnNpZ25lZCBpbnQgYWRkcikKK3sKKwlp
bnQgZXJyOworCisJZXJyID0gcmVnbWFwX3dyaXRlKG1hcF9kcHR4LCBTUF9BVVhfQUREUl83XzBf
UkVHLCBhZGRyICYgMHhmZik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJl
Z21hcF93cml0ZShtYXBfZHB0eCwgU1BfQVVYX0FERFJfMTVfOF9SRUcsCisJCQkgICAoYWRkciAm
IDB4ZmYwMCkgPj4gOCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qCisJICogRFAg
QVVYIENIIEFkZHJlc3MgUmVnaXN0ZXIgIzIsIG9ubHkgdXBkYXRlIGJpdHNbMzowXQorCSAqIFs3
OjRdIFJFU0VSVkVECisJICogWzM6MF0gQVVYX0FERFJbMTk6MTZdLCBSZWdpc3RlciBjb250cm9s
IEFVWCBDSCBhZGRyZXNzLgorCSAqLworCWVyciA9IHJlZ21hcF91cGRhdGVfYml0cyhtYXBfZHB0
eCwgU1BfQVVYX0FERFJfMTlfMTZfUkVHLAorCQkJCSBTUF9BVVhfQUREUl8xOV8xNl9NQVNLLAor
CQkJCSAoYWRkciAmIDB4ZjAwMDApID4+IDE2KTsKKworCWlmIChlcnIpCisJCXJldHVybiBlcnI7
CisKKwlyZXR1cm4gMDsKK30KKworc3NpemVfdCBhbnhfZHBfYXV4X3RyYW5zZmVyKHN0cnVjdCBy
ZWdtYXAgKm1hcF9kcHR4LAorCQkJCXN0cnVjdCBkcm1fZHBfYXV4X21zZyAqbXNnKQoreworCXU4
IGN0cmwxID0gbXNnLT5yZXF1ZXN0OworCXU4IGN0cmwyID0gU1BfQVVYX0VOOworCXU4ICpidWZm
ZXIgPSBtc2ctPmJ1ZmZlcjsKKwlpbnQgZXJyOworCisJLyogVGhlIERQIEFVWCB0cmFuc21pdCBh
bmQgcmVjZWl2ZSBidWZmZXIgaGFzIDE2IGJ5dGVzLiAqLworCWlmIChXQVJOX09OKG1zZy0+c2l6
ZSA+IEFVWF9DSF9CVUZGRVJfU0laRSkpCisJCXJldHVybiAtRTJCSUc7CisKKwkvKiBaZXJvLXNp
emVkIG1lc3NhZ2VzIHNwZWNpZnkgYWRkcmVzcy1vbmx5IHRyYW5zYWN0aW9ucy4gKi8KKwlpZiAo
bXNnLT5zaXplIDwgMSkKKwkJY3RybDIgfD0gU1BfQUREUl9PTkxZOworCWVsc2UJLyogRm9yIG5v
bi16ZXJvLXNpemVkIHNldCB0aGUgbGVuZ3RoIGZpZWxkLiAqLworCQljdHJsMSB8PSAobXNnLT5z
aXplIC0gMSkgPDwgU1BfQVVYX0xFTkdUSF9TSElGVDsKKworCWlmICgobXNnLT5yZXF1ZXN0ICYg
RFBfQVVYX0kyQ19SRUFEKSA9PSAwKSB7CisJCS8qIFdoZW4gV1JJVEUgfCBNT1Qgd3JpdGUgdmFs
dWVzIHRvIGRhdGEgYnVmZmVyICovCisJCWVyciA9IHJlZ21hcF9idWxrX3dyaXRlKG1hcF9kcHR4
LAorCQkJCQlTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIsCisJCQkJCW1zZy0+c2l6ZSk7CisJ
CWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFdyaXRlIGFkZHJlc3MgYW5kIHJl
cXVlc3QgKi8KKwllcnIgPSBhbnhfZHBfYXV4X2FkZHJlc3MobWFwX2RwdHgsIG1zZy0+YWRkcmVz
cyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShtYXBf
ZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwxX1JFRywgY3RybDEpOworCWlmIChlcnIpCisJCXJldHVy
biBlcnI7CisKKwkvKiBTdGFydCB0cmFuc2FjdGlvbiAqLworCWVyciA9IHJlZ21hcF91cGRhdGVf
Yml0cyhtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKKwkJCQkgU1BfQUREUl9PTkxZ
IHwgU1BfQVVYX0VOLCBjdHJsMik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9
IGFueF9kcF9hdXhfd2FpdChtYXBfZHB0eCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwor
CW1zZy0+cmVwbHkgPSBEUF9BVVhfSTJDX1JFUExZX0FDSzsKKworCWlmICgobXNnLT5zaXplID4g
MCkgJiYgKG1zZy0+cmVxdWVzdCAmIERQX0FVWF9JMkNfUkVBRCkpIHsKKwkJLyogUmVhZCB2YWx1
ZXMgZnJvbSBkYXRhIGJ1ZmZlciAqLworCQllcnIgPSByZWdtYXBfYnVsa19yZWFkKG1hcF9kcHR4
LAorCQkJCSAgICAgICBTUF9EUF9CVUZfREFUQTBfUkVHLCBidWZmZXIsCisJCQkJICAgICAgIG1z
Zy0+c2l6ZSk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKworCWVyciA9IGFueF9p
MmNfZHBfY2xlYXJfYml0cyhtYXBfZHB0eCwgU1BfRFBfQVVYX0NIX0NUUkwyX1JFRywKKwkJCQkg
ICAgU1BfQUREUl9PTkxZKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIG1z
Zy0+c2l6ZTsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKGFueF9kcF9hdXhfdHJhbnNmZXIpOwotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWkyYy1kcHR4LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1pMmMtZHB0eC5oCkBA
IC0yNDIsNCArMjQyLDcgQEAKIC8qIERQIEFVWCBCdWZmZXIgRGF0YSBSZWdpc3RlcnMgKi8KICNk
ZWZpbmUgU1BfRFBfQlVGX0RBVEEwX1JFRwkJMHhmMAogCitzc2l6ZV90IGFueF9kcF9hdXhfdHJh
bnNmZXIoc3RydWN0IHJlZ21hcCAqbWFwX2RwdHgsCisJCQkJc3RydWN0IGRybV9kcF9hdXhfbXNn
ICptc2cpOworCiAjZW5kaWYKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
