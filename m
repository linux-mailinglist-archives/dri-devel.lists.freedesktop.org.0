Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 835B4D1319
	for <lists+dri-devel@lfdr.de>; Wed,  9 Oct 2019 17:39:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A711E6E9F5;
	Wed,  9 Oct 2019 15:39:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x544.google.com (mail-ed1-x544.google.com
 [IPv6:2a00:1450:4864:20::544])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 83F996E9F6
 for <dri-devel@lists.freedesktop.org>; Wed,  9 Oct 2019 15:39:39 +0000 (UTC)
Received: by mail-ed1-x544.google.com with SMTP id r9so2430123edl.10
 for <dri-devel@lists.freedesktop.org>; Wed, 09 Oct 2019 08:39:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:date:from:to:cc:subject:message-id
 :references:mime-version:content-disposition
 :content-transfer-encoding:in-reply-to:user-agent;
 bh=5Uv++q0FZyD/8+fxLR6kQmiZ5NGAxJ3pMNXp+rCMU7E=;
 b=BAJKQtufOFIrHCqOfT8sNkQkgM87YTR2Pikte6OurHPRkWWhnGyR6fPB3+ZFlyZoOX
 +k0SJPorlLPz23W/wql18G8bDfjUBWjgrI3qq2z244FD7nsUBDVVvv+g1wHAjQvWyorn
 +rWGqpoL4JIHtxrJHLuyRq5tdW+EEADrFkWl9sr8yL6YYrswUUQ3lVDVrQ0748dn9Bk+
 rnPD7L2X+E7UsGfrhCym6+JkHj7t1T9aiYSe6Ehke9QVC6LWNP7t8IzpnO+jtvdda+d/
 XW/Mq10il6froTYWcg4pxi+iCfyHp6QXCsL6jDHEi6nGdTQID6wFhYxnLmEI6vQScVap
 4JcA==
X-Gm-Message-State: APjAAAWs4rfP8ffKTcE24NI/7ZLiBt8eQtwEof0U7zw9K/oPrr7rwslH
 vqr9br9RRxfbsv1elZV3HQGbyw==
X-Google-Smtp-Source: APXvYqxuceIhQd0A3VWJuND7DloWAeLf4PFZ9jTyYEz3zXZUoCvlGB6yY8rjQz8tBct9LUUyHwavyQ==
X-Received: by 2002:a17:906:2cca:: with SMTP id
 r10mr3517875ejr.108.1570635577843; 
 Wed, 09 Oct 2019 08:39:37 -0700 (PDT)
Received: from phenom.ffwll.local (212-51-149-96.fiber7.init7.net.
 [212.51.149.96])
 by smtp.gmail.com with ESMTPSA id m14sm406878edc.61.2019.10.09.08.39.36
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 09 Oct 2019 08:39:37 -0700 (PDT)
Date: Wed, 9 Oct 2019 17:39:35 +0200
From: Daniel Vetter <daniel@ffwll.ch>
To: Christian =?iso-8859-1?Q?K=F6nig?= <ckoenig.leichtzumerken@gmail.com>
Subject: Re: [PATCH 1/2] drm/nouveau: move io_reserve_lru handling into the
 driver
Message-ID: <20191009153934.GJ16989@phenom.ffwll.local>
References: <20190930131254.31071-1-christian.koenig@amd.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190930131254.31071-1-christian.koenig@amd.com>
X-Operating-System: Linux phenom 5.2.0-2-amd64 
User-Agent: Mutt/1.10.1 (2018-07-13)
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=sender:date:from:to:cc:subject:message-id:references:mime-version
 :content-disposition:content-transfer-encoding:in-reply-to
 :user-agent;
 bh=5Uv++q0FZyD/8+fxLR6kQmiZ5NGAxJ3pMNXp+rCMU7E=;
 b=EkgcpwGD+F4v7LenCm457AyvhORxtLU8AqfUC4PVrbJQ27gKdNV9EnvmOMG/Ma5U43
 1Axr64gbWPVaQiRQsiO4khFDf61YXeQwZRugqzNW8pXonRH+lXWW0n6y7n2ZAvAXx/Lm
 wwLvVxXi22BpBGXXeIMvqwqfx2+hmr2ll780A=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: airlied@linux.ie, nouveau@lists.freedesktop.org,
 dri-devel@lists.freedesktop.org, bskeggs@redhat.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gTW9uLCBTZXAgMzAsIDIwMTkgYXQgMDM6MTI6NTNQTSArMDIwMCwgQ2hyaXN0aWFuIEvDtm5p
ZyB3cm90ZToKPiBXaGlsZSB3b3JraW5nIG9uIFRUTSBjbGVhbnVwcyBJJ3ZlIGZvdW5kIHRoYXQg
dGhlIGlvX3Jlc2VydmVfbHJ1IHVzZWQgYnkKPiBOb3V2ZWF1IGlzIGFjdHVhbGx5IG5vdCB3b3Jr
aW5nIGF0IGFsbC4KPiAKPiBJbiBnZW5lcmFsIHdlIHNob3VsZCByZW1vdmUgZHJpdmVyIHNwZWNp
ZmljIGhhbmRsaW5nIGZyb20gdGhlIG1lbW9yeQo+IG1hbmFnZW1lbnQsIHNvIHRoaXMgcGF0Y2gg
bW92ZXMgdGhlIGlvX3Jlc2VydmVfbHJ1IGhhbmRsaW5nIGludG8gTm91dmVhdQo+IGluc3RlYWQu
Cj4gCj4gVGhlIHBhdGNoIHNob3VsZCBiZSBmdW5jdGlvbmFsIGNvcnJlY3QsIGJ1dCBpcyBvbmx5
IGNvbXBpbGUgdGVzdGVkIQo+IAo+IFNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KCj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfYm8uYyAgfCAxMDYgKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQo+
ICBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmggIHwgICAzICsKPiAgZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCB8ICAgMiArCj4gIGRyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfdHRtLmMgfCAgNDMgKysrKysrKysrKysrKy0KPiAgNCBmaWxlcyBj
aGFuZ2VkLCAxMzAgaW5zZXJ0aW9ucygrKSwgMjQgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfYm8uYwo+IGluZGV4IGU5MThiNDM3YWYxNy4uOTUzMmFkMWJkNDc0
IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYwo+IEBAIC0xMzksNiArMTM5
LDcgQEAgbm91dmVhdV9ib19kZWxfdHRtKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCj4g
IAlpZiAodW5saWtlbHkobnZiby0+Ym8uYmFzZS5maWxwKSkKPiAgCQlEUk1fRVJST1IoImJvICVw
IHN0aWxsIGF0dGFjaGVkIHRvIEdFTSBvYmplY3RcbiIsIGJvKTsKPiAgCVdBUk5fT04obnZiby0+
cGluX3JlZmNudCA+IDApOwo+ICsJbm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2ZV9scnUoYm8pOwo+
ICAJbnYxMF9ib19wdXRfdGlsZV9yZWdpb24oZGV2LCBudmJvLT50aWxlLCBOVUxMKTsKPiAgCWtm
cmVlKG52Ym8pOwo+ICB9Cj4gQEAgLTI5Nyw2ICsyOTgsNyBAQCBub3V2ZWF1X2JvX2luaXQoc3Ry
dWN0IG5vdXZlYXVfYm8gKm52Ym8sIHU2NCBzaXplLCBpbnQgYWxpZ24sIHUzMiBmbGFncywKPiAg
CW5vdXZlYXVfYm9fZml4dXBfYWxpZ24obnZibywgZmxhZ3MsICZhbGlnbiwgJnNpemUpOwo+ICAJ
bnZiby0+Ym8ubWVtLm51bV9wYWdlcyA9IHNpemUgPj4gUEFHRV9TSElGVDsKPiAgCW5vdXZlYXVf
Ym9fcGxhY2VtZW50X3NldChudmJvLCBmbGFncywgMCk7Cj4gKwlJTklUX0xJU1RfSEVBRCgmbnZi
by0+aW9fcmVzZXJ2ZV9scnUpOwo+ICAKPiAgCXJldCA9IHR0bV9ib19pbml0KG52Ym8tPmJvLmJk
ZXYsICZudmJvLT5ibywgc2l6ZSwgdHlwZSwKPiAgCQkJICAmbnZiby0+cGxhY2VtZW50LCBhbGln
biA+PiBQQUdFX1NISUZULCBmYWxzZSwKPiBAQCAtNTY2LDYgKzU2OCwyNiBAQCBub3V2ZWF1X2Jv
X3N5bmNfZm9yX2NwdShzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibykKPiAgCQkJCQlQQUdFX1NJWkUs
IERNQV9GUk9NX0RFVklDRSk7Cj4gIH0KPiAgCj4gK3ZvaWQgbm91dmVhdV9ib19hZGRfaW9fcmVz
ZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKPiArewo+ICsJc3RydWN0IG5v
dXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYpOwo+ICsJc3RydWN0IG5vdXZl
YXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiArCj4gKwltdXRleF9sb2NrKCZkcm0tPnR0
bS5pb19yZXNlcnZlX211dGV4KTsKPiArCWxpc3RfbW92ZV90YWlsKCZudmJvLT5pb19yZXNlcnZl
X2xydSwgJmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1KTsKPiArCW11dGV4X3VubG9jaygmZHJtLT50
dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gK30KPiArCj4gK3ZvaWQgbm91dmVhdV9ib19kZWxfaW9f
cmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKPiArewo+ICsJc3RydWN0
IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYpOwo+ICsJc3RydWN0IG5v
dXZlYXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiArCj4gKwltdXRleF9sb2NrKCZkcm0t
PnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiArCWxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2Vy
dmVfbHJ1KTsKPiArCW11dGV4X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4g
K30KPiArCj4gIGludAo+ICBub3V2ZWF1X2JvX3ZhbGlkYXRlKHN0cnVjdCBub3V2ZWF1X2JvICpu
dmJvLCBib29sIGludGVycnVwdGlibGUsCj4gIAkJICAgIGJvb2wgbm9fd2FpdF9ncHUpCj4gQEAg
LTY3NCw4ICs2OTYsNiBAQCBub3V2ZWF1X2JvX2luaXRfbWVtX3R5cGUoc3RydWN0IHR0bV9ib19k
ZXZpY2UgKmJkZXYsIHVpbnQzMl90IHR5cGUsCj4gIAkJCX0KPiAgCj4gIAkJCW1hbi0+ZnVuYyA9
ICZub3V2ZWF1X3ZyYW1fbWFuYWdlcjsKPiAtCQkJbWFuLT5pb19yZXNlcnZlX2Zhc3RwYXRoID0g
ZmFsc2U7Cj4gLQkJCW1hbi0+dXNlX2lvX3Jlc2VydmVfbHJ1ID0gdHJ1ZTsKPiAgCQl9IGVsc2Ug
ewo+ICAJCQltYW4tPmZ1bmMgPSAmdHRtX2JvX21hbmFnZXJfZnVuYzsKPiAgCQl9Cj4gQEAgLTEz
MDQsNiArMTMyNCw4IEBAIG5vdXZlYXVfYm9fbW92ZV9udGZ5KHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sIGJvb2wgZXZpY3QsCj4gIAlpZiAoYm8tPmRlc3Ryb3kgIT0gbm91dmVhdV9ib19k
ZWxfdHRtKQo+ICAJCXJldHVybjsKPiAgCj4gKwlub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xy
dShibyk7Cj4gKwo+ICAJaWYgKG1lbSAmJiBuZXdfcmVnLT5tZW1fdHlwZSAhPSBUVE1fUExfU1lT
VEVNICYmCj4gIAkgICAgbWVtLT5tZW0ucGFnZSA9PSBudmJvLT5wYWdlKSB7Cj4gIAkJbGlzdF9m
b3JfZWFjaF9lbnRyeSh2bWEsICZudmJvLT52bWFfbGlzdCwgaGVhZCkgewo+IEBAIC0xNDI2LDYg
KzE0NDgsMzAgQEAgbm91dmVhdV9ib192ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sIHN0cnVjdCBmaWxlICpmaWxwKQo+ICAJCQkJCSAgZmlscC0+cHJpdmF0ZV9kYXRh
KTsKPiAgfQo+ICAKPiArc3RhdGljIHZvaWQKPiArbm91dmVhdV90dG1faW9fbWVtX2ZyZWVfbG9j
a2VkKHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtLCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiAr
ewo+ICsJc3RydWN0IG5vdXZlYXVfbWVtICptZW0gPSBub3V2ZWF1X21lbShyZWcpOwo+ICsKPiAr
CWlmICghcmVnLT5idXMuYmFzZSkKPiArCQlyZXR1cm47IC8qIGFscmVhZHkgZnJlZWQgKi8KPiAr
Cj4gKwlpZiAoZHJtLT5jbGllbnQubWVtLT5vY2xhc3MgPj0gTlZJRl9DTEFTU19NRU1fTlY1MCkg
ewo+ICsJCXN3aXRjaCAocmVnLT5tZW1fdHlwZSkgewo+ICsJCWNhc2UgVFRNX1BMX1RUOgo+ICsJ
CQlpZiAobWVtLT5raW5kKQo+ICsJCQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxlKCZtZW0tPm1l
bS5vYmplY3QpOwo+ICsJCQlicmVhazsKPiArCQljYXNlIFRUTV9QTF9WUkFNOgo+ICsJCQludmlm
X29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7Cj4gKwkJCWJyZWFrOwo+ICsJ
CWRlZmF1bHQ6Cj4gKwkJCWJyZWFrOwo+ICsJCX0KPiArCX0KPiArCXJlZy0+YnVzLmJhc2UgPSAw
Owo+ICt9Cj4gKwo+ICBzdGF0aWMgaW50Cj4gIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0
cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiAgewo+
IEBAIC0xNDMzLDE4ICsxNDc5LDI2IEBAIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVj
dCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiAgCXN0cnVj
dCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2KGJkZXYpOwo+ICAJc3RydWN0IG52a21f
ZGV2aWNlICpkZXZpY2UgPSBudnh4X2RldmljZSgmZHJtLT5jbGllbnQuZGV2aWNlKTsKPiAgCXN0
cnVjdCBub3V2ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKPiArCXN0cnVjdCBub3V2
ZWF1X2JvICpudmJvOwo+ICsJaW50IHJldDsKPiArCj4gKwlpZiAocmVnLT5idXMuYmFzZSkKPiAr
CQlyZXR1cm4gMDsgLyogYWxyZWFkeSBtYXBwZWQgKi8KPiAgCj4gIAlyZWctPmJ1cy5hZGRyID0g
TlVMTDsKPiAgCXJlZy0+YnVzLm9mZnNldCA9IDA7Cj4gIAlyZWctPmJ1cy5zaXplID0gcmVnLT5u
dW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKPiAtCXJlZy0+YnVzLmJhc2UgPSAwOwo+ICAJcmVnLT5i
dXMuaXNfaW9tZW0gPSBmYWxzZTsKPiAgCWlmICghKG1hbi0+ZmxhZ3MgJiBUVE1fTUVNVFlQRV9G
TEFHX01BUFBBQkxFKSkKPiAgCQlyZXR1cm4gLUVJTlZBTDsKPiArCj4gKwltdXRleF9sb2NrKCZk
cm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiArcmV0cnk6Cj4gIAlzd2l0Y2ggKHJlZy0+bWVt
X3R5cGUpIHsKPiAgCWNhc2UgVFRNX1BMX1NZU1RFTToKPiAgCQkvKiBTeXN0ZW0gbWVtb3J5ICov
Cj4gLQkJcmV0dXJuIDA7Cj4gKwkJcmV0ID0gMDsKPiArCQlnb3RvIG91dDsKPiAgCWNhc2UgVFRN
X1BMX1RUOgo+ICAjaWYgSVNfRU5BQkxFRChDT05GSUdfQUdQKQo+ICAJCWlmIChkcm0tPmFncC5i
cmlkZ2UpIHsKPiBAQCAtMTQ2OCw3ICsxNTIyLDYgQEAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2Vy
dmUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQo+
ICAJCQl9IGFyZ3M7Cj4gIAkJCXU2NCBoYW5kbGUsIGxlbmd0aDsKPiAgCQkJdTMyIGFyZ2MgPSAw
Owo+IC0JCQlpbnQgcmV0Owo+ICAKPiAgCQkJc3dpdGNoIChtZW0tPm1lbS5vYmplY3Qub2NsYXNz
KSB7Cj4gIAkJCWNhc2UgTlZJRl9DTEFTU19NRU1fTlY1MDoKPiBAQCAtMTQ5MiwzOCArMTU0NSw0
NSBAQCBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRl
diwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCj4gIAkJCXJldCA9IG52aWZfb2JqZWN0X21hcF9o
YW5kbGUoJm1lbS0+bWVtLm9iamVjdCwKPiAgCQkJCQkJICAgICAmYXJncywgYXJnYywKPiAgCQkJ
CQkJICAgICAmaGFuZGxlLCAmbGVuZ3RoKTsKPiAtCQkJaWYgKHJldCAhPSAxKQo+IC0JCQkJcmV0
dXJuIHJldCA/IHJldCA6IC1FSU5WQUw7Cj4gKwkJCWlmIChyZXQgIT0gMSkgewo+ICsJCQkJcmV0
ID0gcmV0ID8gcmV0IDogLUVJTlZBTDsKPiArCQkJCWdvdG8gb3V0Owo+ICsJCQl9Cj4gKwkJCXJl
dCA9IDA7Cj4gIAo+ICAJCQlyZWctPmJ1cy5iYXNlID0gMDsKPiAgCQkJcmVnLT5idXMub2Zmc2V0
ID0gaGFuZGxlOwo+ICAJCX0KPiAgCQlicmVhazsKPiAgCWRlZmF1bHQ6Cj4gLQkJcmV0dXJuIC1F
SU5WQUw7Cj4gKwkJcmV0ID0gLUVJTlZBTDsKPiAgCX0KPiAtCXJldHVybiAwOwo+ICsKPiArb3V0
Ogo+ICsJaWYgKHJldCA9PSAtRUFHQUlOKSB7Cj4gKwkJbnZibyA9IGxpc3RfZmlyc3RfZW50cnlf
b3JfbnVsbCgmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUsCj4gKwkJCQkJCXR5cGVvZigqbnZibyks
Cj4gKwkJCQkJCWlvX3Jlc2VydmVfbHJ1KTsKPiArCQlpZiAobnZibykgewo+ICsJCQlsaXN0X2Rl
bF9pbml0KCZudmJvLT5pb19yZXNlcnZlX2xydSk7Cj4gKwkJCXR0bV9ib191bm1hcF92aXJ0dWFs
KCZudmJvLT5ibyk7Cj4gKwkJCW5vdXZlYXVfdHRtX2lvX21lbV9mcmVlX2xvY2tlZChkcm0sICZu
dmJvLT5iby5tZW0pOwo+ICsJCQlnb3RvIHJldHJ5Owo+ICsJCX0KPiArCj4gKwl9Cj4gKwltdXRl
eF91bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwo+ICsJcmV0dXJuIHJldDsKPiAg
fQo+ICAKPiAgc3RhdGljIHZvaWQKPiAgbm91dmVhdV90dG1faW9fbWVtX2ZyZWUoc3RydWN0IHR0
bV9ib19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQo+ICB7Cj4gIAlzdHJ1
Y3Qgbm91dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfYmRldihiZGV2KTsKPiAtCXN0cnVjdCBub3V2
ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKPiAgCj4gLQlpZiAoZHJtLT5jbGllbnQu
bWVtLT5vY2xhc3MgPj0gTlZJRl9DTEFTU19NRU1fTlY1MCkgewo+IC0JCXN3aXRjaCAocmVnLT5t
ZW1fdHlwZSkgewo+IC0JCWNhc2UgVFRNX1BMX1RUOgo+IC0JCQlpZiAobWVtLT5raW5kKQo+IC0J
CQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QpOwo+IC0JCQlicmVh
azsKPiAtCQljYXNlIFRUTV9QTF9WUkFNOgo+IC0JCQludmlmX29iamVjdF91bm1hcF9oYW5kbGUo
Jm1lbS0+bWVtLm9iamVjdCk7Cj4gLQkJCWJyZWFrOwo+IC0JCWRlZmF1bHQ6Cj4gLQkJCWJyZWFr
Owo+IC0JCX0KPiAtCX0KPiArCW11dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgp
Owo+ICsJbm91dmVhdV90dG1faW9fbWVtX2ZyZWVfbG9ja2VkKGRybSwgcmVnKTsKPiArCW11dGV4
X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gIH0KPiAgCj4gIHN0YXRpYyBp
bnQKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oIGIv
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oCj4gaW5kZXggNjI5MzBkODM0ZmJh
Li5iOGExN2JjMTlkN2IgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91
dmVhdV9iby5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oCj4g
QEAgLTE3LDYgKzE3LDcgQEAgc3RydWN0IG5vdXZlYXVfYm8gewo+ICAJYm9vbCBmb3JjZV9jb2hl
cmVudDsKPiAgCXN0cnVjdCB0dG1fYm9fa21hcF9vYmoga21hcDsKPiAgCXN0cnVjdCBsaXN0X2hl
YWQgaGVhZDsKPiArCXN0cnVjdCBsaXN0X2hlYWQgaW9fcmVzZXJ2ZV9scnU7Cj4gIAo+ICAJLyog
cHJvdGVjdGVkIGJ5IHR0bV9ib19yZXNlcnZlKCkgKi8KPiAgCXN0cnVjdCBkcm1fZmlsZSAqcmVz
ZXJ2ZWRfYnk7Cj4gQEAgLTkyLDYgKzkzLDggQEAgaW50ICBub3V2ZWF1X2JvX3ZhbGlkYXRlKHN0
cnVjdCBub3V2ZWF1X2JvICosIGJvb2wgaW50ZXJydXB0aWJsZSwKPiAgCQkJIGJvb2wgbm9fd2Fp
dF9ncHUpOwo+ICB2b2lkIG5vdXZlYXVfYm9fc3luY19mb3JfZGV2aWNlKHN0cnVjdCBub3V2ZWF1
X2JvICpudmJvKTsKPiAgdm9pZCBub3V2ZWF1X2JvX3N5bmNfZm9yX2NwdShzdHJ1Y3Qgbm91dmVh
dV9ibyAqbnZibyk7Cj4gK3ZvaWQgbm91dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibyk7Cj4gK3ZvaWQgbm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2
ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyk7Cj4gIAo+ICAvKiBUT0RPOiBzdWJt
aXQgZXF1aXZhbGVudCB0byBUVE0gZ2VuZXJpYyBBUEkgdXBzdHJlYW0/ICovCj4gIHN0YXRpYyBp
bmxpbmUgdm9pZCBfX2lvbWVtICoKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZl
YXUvbm91dmVhdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgK
PiBpbmRleCA3MGYzNGNhY2M1NTIuLjA2MGUyYWIxZmQ5NSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV9kcnYuaAo+IEBAIC0xNTgsNiArMTU4LDggQEAgc3RydWN0IG5vdXZlYXVf
ZHJtIHsKPiAgCQlpbnQgdHlwZV92cmFtOwo+ICAJCWludCB0eXBlX2hvc3RbMl07Cj4gIAkJaW50
IHR5cGVfbmNvaFsyXTsKPiArCQlzdHJ1Y3QgbXV0ZXggaW9fcmVzZXJ2ZV9tdXRleDsKPiArCQlz
dHJ1Y3QgbGlzdF9oZWFkIGlvX3Jlc2VydmVfbHJ1Owo+ICAJfSB0dG07Cj4gIAo+ICAJLyogR0VN
IGludGVyZmFjZSBzdXBwb3J0ICovCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5j
Cj4gaW5kZXggZjBkYWY5NThlMDNhLi43Zjg0OTUwNjZlOGIgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV90dG0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9u
b3V2ZWF1L25vdXZlYXVfdHRtLmMKPiBAQCAtMTYyLDEzICsxNjIsNTEgQEAgY29uc3Qgc3RydWN0
IHR0bV9tZW1fdHlwZV9tYW5hZ2VyX2Z1bmMgbnYwNF9nYXJ0X21hbmFnZXIgPSB7Cj4gIAkuZGVi
dWcgPSBub3V2ZWF1X21hbmFnZXJfZGVidWcKPiAgfTsKPiAgCj4gK3N0YXRpYyB2bV9mYXVsdF90
IG5vdXZlYXVfdHRtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQo+ICt7Cj4gKwlzdHJ1Y3Qg
dm1fYXJlYV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOwo+ICsJc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibyA9IHZtYS0+dm1fcHJpdmF0ZV9kYXRhOwo+ICsJcGdwcm90X3QgcHJvdDsKPiArCXZt
X2ZhdWx0X3QgcmV0Owo+ICsKPiArCXJldCA9IHR0bV9ib192bV9yZXNlcnZlKGJvLCB2bWYpOwo+
ICsJaWYgKHJldCkKPiArCQlyZXR1cm4gcmV0Owo+ICsKPiArCW5vdXZlYXVfYm9fZGVsX2lvX3Jl
c2VydmVfbHJ1KGJvKTsKCklzbid0IHRoaXMgb3BlbmluZyB1cCBhIGNhbiBvZiB3b3JtcyAoaW4g
dGhlb3J5KSB3aGVyZSBhIGxvdCBvZiBjb25jdXJyZW50CmZhdWx0cyB3aWxsIGFsbCBmYWlsIGJl
Y2F1c2UgdGhleSdyZSBhbGwgcmVtb3ZlZCB0aGVtc2VsdmVzIGZyb20gdGhlIGxydSwKc28gY2Fu
J3Qgc2VlIGFueW9uZSBlbHNlIHRvIHRocm93IG91dD8KClNhbWUgcHJvYmxlbSByZWFsbHkgdGhh
dCB0dG0gaGFkICh3ZWxsIHN0aWxsIGhhcyBJIHRoaW5rIGZvciAhYW1kZ3B1KSB3aXRoCml0cyBv
dGhlciBscnUgLi4uCgpPciBhbSBJIGdldHRpbmcgdG90YWxseSBsb3N0IGFnYWluIGhlcmU/Ci1E
YW5pZWwKCj4gKwo+ICsJcHJvdCA9IHZtX2dldF9wYWdlX3Byb3Qodm1hLT52bV9mbGFncyk7Cj4g
KwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1mLCBwcm90LCBUVE1fQk9fVk1fTlVN
X1BSRUZBVUxUKTsKPiArCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYtPmZsYWdz
ICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQo+ICsJCXJldHVybiByZXQ7Cj4gKwo+ICsJbm91
dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUoYm8pOwo+ICsKPiArCWRtYV9yZXN2X3VubG9jayhi
by0+YmFzZS5yZXN2KTsKPiArCj4gKwlyZXR1cm4gcmV0Owo+ICt9Cj4gKwo+ICtzdGF0aWMgc3Ry
dWN0IHZtX29wZXJhdGlvbnNfc3RydWN0IG5vdXZlYXVfdHRtX3ZtX29wcyA9IHsKPiArCS5mYXVs
dCA9IG5vdXZlYXVfdHRtX2ZhdWx0LAo+ICsJLm9wZW4gPSB0dG1fYm9fdm1fb3BlbiwKPiArCS5j
bG9zZSA9IHR0bV9ib192bV9jbG9zZSwKPiArCS5hY2Nlc3MgPSB0dG1fYm9fdm1fYWNjZXNzCj4g
K307Cj4gKwo+ICBpbnQKPiAgbm91dmVhdV90dG1fbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3Ry
dWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCj4gIHsKPiAgCXN0cnVjdCBkcm1fZmlsZSAqZmlsZV9w
cml2ID0gZmlscC0+cHJpdmF0ZV9kYXRhOwo+ICAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBu
b3V2ZWF1X2RybShmaWxlX3ByaXYtPm1pbm9yLT5kZXYpOwo+ICsJaW50IHJldDsKPiAgCj4gLQly
ZXR1cm4gdHRtX2JvX21tYXAoZmlscCwgdm1hLCAmZHJtLT50dG0uYmRldik7Cj4gKwlyZXQgPSB0
dG1fYm9fbW1hcChmaWxwLCB2bWEsICZkcm0tPnR0bS5iZGV2KTsKPiArCWlmIChyZXQpCj4gKwkJ
cmV0dXJuIHJldDsKPiArCj4gKwl2bWEtPnZtX29wcyA9ICZub3V2ZWF1X3R0bV92bV9vcHM7Cj4g
KwlyZXR1cm4gMDsKPiAgfQo+ICAKPiAgc3RhdGljIGludAo+IEBAIC0yNzIsNiArMzEwLDkgQEAg
bm91dmVhdV90dG1faW5pdChzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSkKPiAgCQlyZXR1cm4gcmV0
Owo+ICAJfQo+ICAKPiArCW11dGV4X2luaXQoJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwo+
ICsJSU5JVF9MSVNUX0hFQUQoJmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1KTsKPiArCj4gIAlOVl9J
TkZPKGRybSwgIlZSQU06ICVkIE1pQlxuIiwgKHUzMikoZHJtLT5nZW0udnJhbV9hdmFpbGFibGUg
Pj4gMjApKTsKPiAgCU5WX0lORk8oZHJtLCAiR0FSVDogJWQgTWlCXG4iLCAodTMyKShkcm0tPmdl
bS5nYXJ0X2F2YWlsYWJsZSA+PiAyMCkpOwo+ICAJcmV0dXJuIDA7Cj4gLS0gCj4gMi4xNC4xCj4g
CgotLSAKRGFuaWVsIFZldHRlcgpTb2Z0d2FyZSBFbmdpbmVlciwgSW50ZWwgQ29ycG9yYXRpb24K
aHR0cDovL2Jsb2cuZmZ3bGwuY2gKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
