Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9EFFE60AE7
	for <lists+dri-devel@lfdr.de>; Fri,  5 Jul 2019 19:17:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EAC906E523;
	Fri,  5 Jul 2019 17:17:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from metis.ext.pengutronix.de (metis.ext.pengutronix.de
 [IPv6:2001:67c:670:201:290:27ff:fe1d:cc33])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C65866E51B
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 17:17:31 +0000 (UTC)
Received: from dude02.hi.pengutronix.de ([2001:67c:670:100:1d::28]
 helo=dude02.pengutronix.de.)
 by metis.ext.pengutronix.de with esmtp (Exim 4.92)
 (envelope-from <l.stach@pengutronix.de>)
 id 1hjRpv-0007A3-W0; Fri, 05 Jul 2019 19:17:28 +0200
From: Lucas Stach <l.stach@pengutronix.de>
To: etnaviv@lists.freedesktop.org
Subject: [PATCH v2 1/8] drm/etnaviv: simplify unbind checks
Date: Fri,  5 Jul 2019 19:17:20 +0200
Message-Id: <20190705171727.27501-1-l.stach@pengutronix.de>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::28
X-SA-Exim-Mail-From: l.stach@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de);
 SAEximRunCond expanded to false
X-PTX-Original-Recipient: dri-devel@lists.freedesktop.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: patchwork-lst@pengutronix.de, kernel@pengutronix.de,
 dri-devel@lists.freedesktop.org, Russell King <linux+etnaviv@armlinux.org.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVtZW1iZXIgaWYgdGhlIEdQVSBoYXMgYmVlbiBzdWNlc3NmdWxseSBpbml0aWFsaXplZC4gT25s
eSBpbiB0aGF0IGNhc2UKZG8gd2UgbmVlZCB0byBjbGVhbiB1cCB2YXJpb3VzIHN0cnVjdHVyZXMg
aW4gdGhlIHVuYmluZCBwYXRoLiBJZiB0aGUKR1BVIGhhc24ndCBiZWVuIHN1Y2Vzc2Z1bGx5IGlu
aXRpYWxpemVkIGFsbCB0aGUgY2xlYW51cHMgc2hvdWxkIGhhcHBlbgppbiB0aGUgZmFpbHVyZSBw
YXRocyBvZiB0aGUgaW5pdCBmdW5jdGlvbi4KClNpZ25lZC1vZmYtYnk6IEx1Y2FzIFN0YWNoIDxs
LnN0YWNoQHBlbmd1dHJvbml4LmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2
aXZfZ3B1LmMgfCAyMCArKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2V0bmF2
aXYvZXRuYXZpdl9ncHUuaCB8ICAxICsKIDIgZmlsZXMgY2hhbmdlZCwgOCBpbnNlcnRpb25zKCsp
LCAxMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9l
dG5hdml2X2dwdS5jIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9ncHUuYwppbmRl
eCA0ODIyNTQ5NTAwZWUuLmU4NGEwZWQ5MDRhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2V0bmF2aXYvZXRuYXZpdl9ncHUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5h
dml2X2dwdS5jCkBAIC03OTksMTcgKzc5OSwxNiBAQCBpbnQgZXRuYXZpdl9ncHVfaW5pdChzdHJ1
Y3QgZXRuYXZpdl9ncHUgKmdwdSkKIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGdwdS0+ZGV2
KTsKIAlwbV9ydW50aW1lX3B1dF9hdXRvc3VzcGVuZChncHUtPmRldik7CiAKKwlncHUtPmluaXRp
YWxpemVkID0gdHJ1ZTsKKwogCXJldHVybiAwOwogCiBmcmVlX2J1ZmZlcjoKIAlldG5hdml2X2Nt
ZGJ1Zl9mcmVlKCZncHUtPmJ1ZmZlcik7Ci0JZ3B1LT5idWZmZXIuc3ViYWxsb2MgPSBOVUxMOwog
ZGVzdHJveV9zdWJhbGxvYzoKIAlldG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19kZXN0cm95KGdwdS0+
Y21kYnVmX3N1YmFsbG9jKTsKLQlncHUtPmNtZGJ1Zl9zdWJhbGxvYyA9IE5VTEw7CiBkZXN0cm95
X2lvbW11OgogCWV0bmF2aXZfaW9tbXVfZGVzdHJveShncHUtPm1tdSk7Ci0JZ3B1LT5tbXUgPSBO
VUxMOwogZmFpbDoKIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KGdwdS0+ZGV2KTsKIAlwbV9y
dW50aW1lX3B1dF9hdXRvc3VzcGVuZChncHUtPmRldik7CkBAIC0xNTIxLDcgKzE1MjAsNyBAQCBp
bnQgZXRuYXZpdl9ncHVfd2FpdF9pZGxlKHN0cnVjdCBldG5hdml2X2dwdSAqZ3B1LCB1bnNpZ25l
ZCBpbnQgdGltZW91dF9tcykKIAogc3RhdGljIGludCBldG5hdml2X2dwdV9od19zdXNwZW5kKHN0
cnVjdCBldG5hdml2X2dwdSAqZ3B1KQogewotCWlmIChncHUtPmJ1ZmZlci5zdWJhbGxvYykgewor
CWlmIChncHUtPmluaXRpYWxpemVkKSB7CiAJCS8qIFJlcGxhY2UgdGhlIGxhc3QgV0FJVCB3aXRo
IEVORCAqLwogCQltdXRleF9sb2NrKCZncHUtPmxvY2spOwogCQlldG5hdml2X2J1ZmZlcl9lbmQo
Z3B1KTsKQEAgLTE2ODAsMTkgKzE2NzksMTQgQEAgc3RhdGljIHZvaWQgZXRuYXZpdl9ncHVfdW5i
aW5kKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZSAqbWFzdGVyLAogCWV0bmF2aXZf
Z3B1X2h3X3N1c3BlbmQoZ3B1KTsKICNlbmRpZgogCi0JaWYgKGdwdS0+YnVmZmVyLnN1YmFsbG9j
KQorCWlmIChncHUtPmluaXRpYWxpemVkKSB7CiAJCWV0bmF2aXZfY21kYnVmX2ZyZWUoJmdwdS0+
YnVmZmVyKTsKLQotCWlmIChncHUtPmNtZGJ1Zl9zdWJhbGxvYykgewogCQlldG5hdml2X2NtZGJ1
Zl9zdWJhbGxvY19kZXN0cm95KGdwdS0+Y21kYnVmX3N1YmFsbG9jKTsKLQkJZ3B1LT5jbWRidWZf
c3ViYWxsb2MgPSBOVUxMOwotCX0KLQotCWlmIChncHUtPm1tdSkgewogCQlldG5hdml2X2lvbW11
X2Rlc3Ryb3koZ3B1LT5tbXUpOwotCQlncHUtPm1tdSA9IE5VTEw7CisJCWdwdS0+aW5pdGlhbGl6
ZWQgPSBmYWxzZTsKIAl9CiAKKwogCWdwdS0+ZHJtID0gTlVMTDsKIAlpZHJfZGVzdHJveSgmZ3B1
LT5mZW5jZV9pZHIpOwogCkBAIC0xODI3LDcgKzE4MjEsNyBAQCBzdGF0aWMgaW50IGV0bmF2aXZf
Z3B1X3JwbV9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KQogCQlyZXR1cm4gcmV0OwogCiAJLyog
UmUtaW5pdGlhbGlzZSB0aGUgYmFzaWMgaGFyZHdhcmUgc3RhdGUgKi8KLQlpZiAoZ3B1LT5kcm0g
JiYgZ3B1LT5idWZmZXIuc3ViYWxsb2MpIHsKKwlpZiAoZ3B1LT5kcm0gJiYgZ3B1LT5pbml0aWFs
aXplZCkgewogCQlyZXQgPSBldG5hdml2X2dwdV9od19yZXN1bWUoZ3B1KTsKIAkJaWYgKHJldCkg
ewogCQkJZXRuYXZpdl9ncHVfY2xrX2Rpc2FibGUoZ3B1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9l
dG5hdml2X2dwdS5oCmluZGV4IDliY2YxNTFmNzA2Yi4uYjA2YzdjOThkNTIyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1LmgKQEAgLTk5LDYgKzk5LDcgQEAgc3RydWN0IGV0bmF2
aXZfZ3B1IHsKIAllbnVtIGV0bmF2aXZfc2VjX21vZGUgc2VjX21vZGU7CiAJc3RydWN0IHdvcmtx
dWV1ZV9zdHJ1Y3QgKndxOwogCXN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciBzY2hlZDsKKwlib29s
IGluaXRpYWxpemVkOwogCiAJLyogJ3JpbmcnLWJ1ZmZlcjogKi8KIAlzdHJ1Y3QgZXRuYXZpdl9j
bWRidWYgYnVmZmVyOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
