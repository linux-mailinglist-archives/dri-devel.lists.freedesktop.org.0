Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 20AE7E2BD5
	for <lists+dri-devel@lfdr.de>; Thu, 24 Oct 2019 10:14:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 363116E171;
	Thu, 24 Oct 2019 08:14:28 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5CA126E17A
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 08:14:23 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 9F14FB5F6;
 Thu, 24 Oct 2019 08:14:21 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: kraxel@redhat.com, airlied@linux.ie, daniel@ffwll.ch,
 z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com,
 hdegoede@redhat.com, sam@ravnborg.org
Subject: [PATCH v2 1/4] drm/vram-helpers: Add helpers for prepare_fb() and
 cleanup_fb()
Date: Thu, 24 Oct 2019 10:14:01 +0200
Message-Id: <20191024081404.6978-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191024081404.6978-1-tzimmermann@suse.de>
References: <20191024081404.6978-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIG5ldyBoZWxwZXJzIHBpbiBhbmQgdW5waW4gYSBmcmFtZWJ1ZmZlcidzIEdFTSBWUkFNIG9i
amVjdHMgZHVyaW5nCnBsYW5lIHVwZGF0ZXMuIFRoaXMgc2hvdWxkIGJlIHN1ZmZpY2llbnQgZm9y
IG1vc3QgZHJpdmVycycgaW1wbGVtZW50YXRpb24Kb2YgcHJlcGFyZV9mYigpIGFuZCBjbGVhbnVw
X2ZiKCkuCgp2MjoKCSogcHJvdmlkZSBoZWxwZXJzIGZvciBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNw
bGF5X3BpcGVfZnVuY3MKCSogcmVuYW1lIHBsYW5lLWhlbHBlciBmdW5jcwoKU2lnbmVkLW9mZi1i
eTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1c2UuZGU+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYyB8IDEyNiArKysrKysrKysrKysrKysrKysrKysr
KysrKwogaW5jbHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oICAgICB8ICAyNSArKysrKwog
MiBmaWxlcyBjaGFuZ2VkLCAxNTEgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92
cmFtX2hlbHBlci5jCmluZGV4IGI4NmZlMGZhOWQwNS4uN2ZlOTNjZDM4ZWVhIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKQEAgLTMsMTAgKzMsMTMgQEAKICNpbmNsdWRlIDxk
cm0vZHJtX2RlYnVnZnMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgogI2luY2x1ZGUg
PGRybS9kcm1fZmlsZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fZnJhbWVidWZmZXIuaD4KICNpbmNs
dWRlIDxkcm0vZHJtX2dlbV90dG1faGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJh
bV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX21vZGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X3BsYW5lLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcmltZS5oPgorI2luY2x1ZGUgPGRybS9kcm1f
c2ltcGxlX2ttc19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmg+
CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3RfZnVuY3MgZHJtX2dlbV92cmFt
X29iamVjdF9mdW5jczsKQEAgLTY0Niw2ICs2NDksMTI5IEBAIGludCBkcm1fZ2VtX3ZyYW1fZHJp
dmVyX2R1bWJfbW1hcF9vZmZzZXQoc3RydWN0IGRybV9maWxlICpmaWxlLAogfQogRVhQT1JUX1NZ
TUJPTChkcm1fZ2VtX3ZyYW1fZHJpdmVyX2R1bWJfbW1hcF9vZmZzZXQpOwogCisvKgorICogSGVs
cGVycyBmb3Igc3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MKKyAqLworCisvKioKKyAqIGRy
bV9nZW1fdnJhbV9wbGFuZV9oZWxwZXJfcHJlcGFyZV9mYigpIC0gXAorICoJSW1wbGVtZW50cyAm
c3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MucHJlcGFyZV9mYgorICogQHBsYW5lOglhIERS
TSBwbGFuZQorICogQG5ld19zdGF0ZToJdGhlIHBsYW5lJ3MgbmV3IHN0YXRlCisgKgorICogRHVy
aW5nIHBsYW5lIHVwZGF0ZXMsIHRoaXMgZnVuY3Rpb24gcGlucyB0aGUgR0VNIFZSQU0KKyAqIG9i
amVjdHMgb2YgdGhlIHBsYW5lJ3MgbmV3IGZyYW1lYnVmZmVyIHRvIFZSQU0uIENhbGwKKyAqIGRy
bV9nZW1fdnJhbV9wbGFuZV9oZWxwZXJfY2xlYW51cF9mYigpIHRvIHVucGluIHRoZW0uCisgKgor
ICogUmV0dXJuczoKKyAqCTAgb24gc3VjY2Vzcywgb3IKKyAqCWEgbmVnYXRpdmUgZXJybm8gY29k
ZSBvdGhlcndpc2UuCisgKi8KK2ludAorZHJtX2dlbV92cmFtX3BsYW5lX2hlbHBlcl9wcmVwYXJl
X2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgICAgc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqbmV3X3N0YXRlKQoreworCXNpemVfdCBpOworCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2Jq
ZWN0ICpnYm87CisJaW50IHJldDsKKworCWlmICghbmV3X3N0YXRlLT5mYikKKwkJcmV0dXJuIDA7
CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShuZXdfc3RhdGUtPmZiLT5vYmopOyArK2kp
IHsKKwkJaWYgKCFuZXdfc3RhdGUtPmZiLT5vYmpbaV0pCisJCQljb250aW51ZTsKKwkJZ2JvID0g
ZHJtX2dlbV92cmFtX29mX2dlbShuZXdfc3RhdGUtPmZiLT5vYmpbaV0pOworCQlyZXQgPSBkcm1f
Z2VtX3ZyYW1fcGluKGdibywgRFJNX0dFTV9WUkFNX1BMX0ZMQUdfVlJBTSk7CisJCWlmIChyZXQp
CisJCQlnb3RvIGVycl9kcm1fZ2VtX3ZyYW1fdW5waW47CisJfQorCisJcmV0dXJuIDA7CisKK2Vy
cl9kcm1fZ2VtX3ZyYW1fdW5waW46CisJd2hpbGUgKGkpIHsKKwkJLS1pOworCQlnYm8gPSBkcm1f
Z2VtX3ZyYW1fb2ZfZ2VtKG5ld19zdGF0ZS0+ZmItPm9ialtpXSk7CisJCWRybV9nZW1fdnJhbV91
bnBpbihnYm8pOworCX0KKwlyZXR1cm4gcmV0OworfQorRVhQT1JUX1NZTUJPTChkcm1fZ2VtX3Zy
YW1fcGxhbmVfaGVscGVyX3ByZXBhcmVfZmIpOworCisvKioKKyAqIGRybV9nZW1fdnJhbV9wbGFu
ZV9oZWxwZXJfY2xlYW51cF9mYigpIC0gXAorICoJSW1wbGVtZW50cyAmc3RydWN0IGRybV9wbGFu
ZV9oZWxwZXJfZnVuY3MuY2xlYW51cF9mYgorICogQHBsYW5lOglhIERSTSBwbGFuZQorICogQG9s
ZF9zdGF0ZToJdGhlIHBsYW5lJ3Mgb2xkIHN0YXRlCisgKgorICogRHVyaW5nIHBsYW5lIHVwZGF0
ZXMsIHRoaXMgZnVuY3Rpb24gdW5waW5zIHRoZSBHRU0gVlJBTQorICogb2JqZWN0cyBvZiB0aGUg
cGxhbmUncyBvbGQgZnJhbWVidWZmZXIgZnJvbSBWUkFNLiBDb21wbGVtZW50cworICogZHJtX2dl
bV92cmFtX3BsYW5lX2hlbHBlcl9wcmVwYXJlX2ZiKCkuCisgKi8KK3ZvaWQKK2RybV9nZW1fdnJh
bV9wbGFuZV9oZWxwZXJfY2xlYW51cF9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkg
ICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzaXplX3QgaTsKKwlz
dHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvOworCisJaWYgKCFvbGRfc3RhdGUtPmZiKQor
CQlyZXR1cm47CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShvbGRfc3RhdGUtPmZiLT5v
YmopOyArK2kpIHsKKwkJaWYgKCFvbGRfc3RhdGUtPmZiLT5vYmpbaV0pCisJCQljb250aW51ZTsK
KwkJZ2JvID0gZHJtX2dlbV92cmFtX29mX2dlbShvbGRfc3RhdGUtPmZiLT5vYmpbaV0pOworCQlk
cm1fZ2VtX3ZyYW1fdW5waW4oZ2JvKTsKKwl9Cit9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJh
bV9wbGFuZV9oZWxwZXJfY2xlYW51cF9mYik7CisKKy8qCisgKiBIZWxwZXJzIGZvciBzdHJ1Y3Qg
ZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MKKyAqLworCisvKioKKyAqIGRybV9nZW1fdnJh
bV9zaW1wbGVfZGlzcGxheV9waXBlX3ByZXBhcmVfZmIoKSAtIFwKKyAqCUltcGxlbWVudHMgJnN0
cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5jcy5wcmVwYXJlX2ZiCisgKiBAcGlwZToJ
YSBzaW1wbGUgZGlzcGxheSBwaXBlCisgKiBAbmV3X3N0YXRlOgl0aGUgcGxhbmUncyBuZXcgc3Rh
dGUKKyAqCisgKiBEdXJpbmcgcGxhbmUgdXBkYXRlcywgdGhpcyBmdW5jdGlvbiBwaW5zIHRoZSBH
RU0gVlJBTQorICogb2JqZWN0cyBvZiB0aGUgcGxhbmUncyBuZXcgZnJhbWVidWZmZXIgdG8gVlJB
TS4gQ2FsbAorICogZHJtX2dlbV92cmFtX3NpbXBsZV9kaXNwbGF5X3BpcGVfY2xlYW51cF9mYigp
IHRvIHVucGluIHRoZW0uCisgKgorICogUmV0dXJuczoKKyAqCTAgb24gc3VjY2Vzcywgb3IKKyAq
CWEgbmVnYXRpdmUgZXJybm8gY29kZSBvdGhlcndpc2UuCisgKi8KK2ludCBkcm1fZ2VtX3ZyYW1f
c2ltcGxlX2Rpc3BsYXlfcGlwZV9wcmVwYXJlX2ZiKAorCXN0cnVjdCBkcm1fc2ltcGxlX2Rpc3Bs
YXlfcGlwZSAqcGlwZSwKKwlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpuZXdfc3RhdGUpCit7CisJ
cmV0dXJuIGRybV9nZW1fdnJhbV9wbGFuZV9oZWxwZXJfcHJlcGFyZV9mYigmcGlwZS0+cGxhbmUs
IG5ld19zdGF0ZSk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV9zaW1wbGVfZGlzcGxh
eV9waXBlX3ByZXBhcmVfZmIpOworCisvKioKKyAqIGRybV9nZW1fdnJhbV9zaW1wbGVfZGlzcGxh
eV9waXBlX2NsZWFudXBfZmIoKSAtIFwKKyAqCUltcGxlbWVudHMgJnN0cnVjdCBkcm1fc2ltcGxl
X2Rpc3BsYXlfcGlwZV9mdW5jcy5jbGVhbnVwX2ZiCisgKiBAcGlwZToJYSBzaW1wbGUgZGlzcGxh
eSBwaXBlCisgKiBAb2xkX3N0YXRlOgl0aGUgcGxhbmUncyBvbGQgc3RhdGUKKyAqCisgKiBEdXJp
bmcgcGxhbmUgdXBkYXRlcywgdGhpcyBmdW5jdGlvbiB1bnBpbnMgdGhlIEdFTSBWUkFNCisgKiBv
YmplY3RzIG9mIHRoZSBwbGFuZSdzIG9sZCBmcmFtZWJ1ZmZlciBmcm9tIFZSQU0uIENvbXBsZW1l
bnRzCisgKiBkcm1fZ2VtX3ZyYW1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9wcmVwYXJlX2ZiKCkuCisg
Ki8KK3ZvaWQgZHJtX2dlbV92cmFtX3NpbXBsZV9kaXNwbGF5X3BpcGVfY2xlYW51cF9mYigKKwlz
dHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCisJc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqb2xkX3N0YXRlKQoreworCWRybV9nZW1fdnJhbV9wbGFuZV9oZWxwZXJfY2xlYW51cF9m
YigmcGlwZS0+cGxhbmUsIG9sZF9zdGF0ZSk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJh
bV9zaW1wbGVfZGlzcGxheV9waXBlX2NsZWFudXBfZmIpOworCiAvKgogICogUFJJTUUgaGVscGVy
cwogICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmggYi9p
bmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmgKaW5kZXggYjhhZDQ1MzFlYmI0Li5lMDQw
NTQxYTEwNWYgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaAor
KysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmgKQEAgLTEzLDYgKzEzLDkgQEAK
ICNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4gLyogZm9yIGNvbnRhaW5lcl9vZigpICovCiAKIHN0
cnVjdCBkcm1fbW9kZV9jcmVhdGVfZHVtYjsKK3N0cnVjdCBkcm1fcGxhbmU7CitzdHJ1Y3QgZHJt
X3BsYW5lX3N0YXRlOworc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlOwogc3RydWN0IGRy
bV92cmFtX21tX2Z1bmNzOwogc3RydWN0IGZpbHA7CiBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Q7CkBA
IC0xMjQsNiArMTI3LDI4IEBAIGludCBkcm1fZ2VtX3ZyYW1fZHJpdmVyX2R1bWJfbW1hcF9vZmZz
ZXQoc3RydWN0IGRybV9maWxlICpmaWxlLAogCQkJCQkgc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
IAkJCQkJIHVpbnQzMl90IGhhbmRsZSwgdWludDY0X3QgKm9mZnNldCk7CiAKKy8qCisgKiBIZWxw
ZXJzIGZvciBzdHJ1Y3QgZHJtX3BsYW5lX2hlbHBlcl9mdW5jcworICovCitpbnQKK2RybV9nZW1f
dnJhbV9wbGFuZV9oZWxwZXJfcHJlcGFyZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJ
CQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19zdGF0ZSk7Cit2b2lkCitkcm1fZ2Vt
X3ZyYW1fcGxhbmVfaGVscGVyX2NsZWFudXBfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJ
CQkJICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpOworCisvKgorICogSGVs
cGVycyBmb3Igc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlX2Z1bmNzCisgKi8KKworaW50
IGRybV9nZW1fdnJhbV9zaW1wbGVfZGlzcGxheV9waXBlX3ByZXBhcmVfZmIoCisJc3RydWN0IGRy
bV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAorCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5l
d19zdGF0ZSk7CisKK3ZvaWQgZHJtX2dlbV92cmFtX3NpbXBsZV9kaXNwbGF5X3BpcGVfY2xlYW51
cF9mYigKKwlzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCisJc3RydWN0IGRy
bV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKTsKKwogLyoqCiAgKiBkZWZpbmUgRFJNX0dFTV9WUkFN
X0RSSVZFUiAtIGRlZmF1bHQgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBcCiAJJnN0cnVjdCBkcm1f
ZHJpdmVyCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
