Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AC563306D90
	for <lists+dri-devel@lfdr.de>; Thu, 28 Jan 2021 07:22:01 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0C9946E8DD;
	Thu, 28 Jan 2021 06:21:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pj1-x102a.google.com (mail-pj1-x102a.google.com
 [IPv6:2607:f8b0:4864:20::102a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 097C76E8DE
 for <dri-devel@lists.freedesktop.org>; Thu, 28 Jan 2021 06:21:54 +0000 (UTC)
Received: by mail-pj1-x102a.google.com with SMTP id s24so3262019pjp.5
 for <dri-devel@lists.freedesktop.org>; Wed, 27 Jan 2021 22:21:54 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=u7Mc2AcSMkO8KsWlbyrx1biPcgp0/MBcOs2WeW9V+WI=;
 b=gEMQWtO2dMpl7gYxozGAZLrFzHWF4dmRszffEzdmwgkIyrfc937HPeF7qNBPMxaIk7
 yGnhV9WJxLWgOp9h4a+5QiESo0Gjo+GwQPRHQAd0UO5DtJJsX+2tCJUFx4IJfvNiDr1+
 MgrHQhn24HuI6BaRviK4FQID/KvC5u6DAHS7U3/20eqpf004dIHNhm6hQpYX3Dw6gSxX
 W+RorPYi4ZxAmVEbHVOeOXtNSM+UtH6AlPs0zaM1A3dSMbEwcEk8o77Xh5a7Bz9B8fU4
 17daeParsqPHAwWAuWbWqe7nOS7N7ucXL71BHcT72BvWDnpaS9p7Cac5JmlfkiS52kx4
 lMeA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=u7Mc2AcSMkO8KsWlbyrx1biPcgp0/MBcOs2WeW9V+WI=;
 b=kAXE/x0Crg2kGn6vMyRhaggayYXGEtXXtCoteXOV8vjEQG/gjXC7Q58kToVbZfDMzv
 HUJevaMtDZArhRqYPL9kNJbf3NoYOTPUAMPFb8vkFlTBZBRcvhrCzTt8sU7uY3LFrXzN
 9plSwJ4uAxXXOX2vFcgLdo8sJk0W/LYpBNzE79A6hZl8UXiuoWcunl6X/bNNuMNoNaMJ
 4irtbtYwUdmI3reuA0cwCkDSUUApPbs117E6bhosNC/2dv7AaHn1rXO5bF+j+1SpCRO1
 MCRiClE1HgnUcNTXwUohHluJZqHrK7hSmRtXJgM/JfeHiwDrNbO0Od9jqw1rRpSfJqIH
 w31A==
X-Gm-Message-State: AOAM532rFNwBUhvD4xPgvVYsnE0134qE7GSLEU3svjqhf2hMuQ0SKrnu
 /cQFFM3pEullQxc0sCd0yaouSQ==
X-Google-Smtp-Source: ABdhPJyCUOJAMg0cEsgY53LWI9S3uPsfdsmQkdDNmdLOsw+6mmQcGedVMCVf4Bhod4gGNEamUm2EmQ==
X-Received: by 2002:a17:90b:4c8c:: with SMTP id
 my12mr9412112pjb.29.1611814914648; 
 Wed, 27 Jan 2021 22:21:54 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 s9sm4477765pfd.38.2021.01.27.22.21.53
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 27 Jan 2021 22:21:53 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v3 2/3] dma-buf: system_heap: Add pagepool support to system
 heap
Date: Thu, 28 Jan 2021 06:21:46 +0000
Message-Id: <20210128062147.438413-2-john.stultz@linaro.org>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210128062147.438413-1-john.stultz@linaro.org>
References: <20210128062147.438413-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, Sandeep Patil <sspatil@google.com>,
 Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV1c2UvYWJ1c2UgdGhlIHBhZ2Vwb29sIGNvZGUgZnJvbSB0aGUgbmV0d29yayBjb2RlIHRvIHNw
ZWVkCnVwIGFsbG9jYXRpb24gcGVyZm9ybWFuY2UuCgpUaGlzIGlzIHNpbWlsYXIgdG8gdGhlIElP
TiBwYWdlcG9vbCB1c2FnZSwgYnV0IHRyaWVzIHRvCnV0aWxpemUgZ2VuZXJpYyBjb2RlIGluc3Rl
YWQgb2YgYSBjdXN0b20gaW1wbGVtZW50YXRpb24uCgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVs
QGZmd2xsLmNoPgpDYzogU3VtaXQgU2Vtd2FsIDxzdW1pdC5zZW13YWxAbGluYXJvLm9yZz4KQ2M6
IExpYW0gTWFyayA8bG1hcmtAY29kZWF1cm9yYS5vcmc+CkNjOiBDaHJpcyBHb2xkc3dvcnRoeSA8
Y2dvbGRzd29AY29kZWF1cm9yYS5vcmc+CkNjOiBMYXVyYSBBYmJvdHQgPGxhYmJvdHRAa2VybmVs
Lm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJrZXlAYXJtLmNvbT4KQ2M6IEhyaWR5
YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzogU3VyZW4gQmFnaGRhc2FyeWFuIDxz
dXJlbmJAZ29vZ2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwgPHNzcGF0aWxAZ29vZ2xlLmNvbT4K
Q2M6IERhbmllbCBNZW50eiA8ZGFuaWVsbWVudHpAZ29vZ2xlLmNvbT4KQ2M6IMOYcmphbiBFaWRl
IDxvcmphbi5laWRlQGFybS5jb20+CkNjOiBSb2JpbiBNdXJwaHkgPHJvYmluLm11cnBoeUBhcm0u
Y29tPgpDYzogRXplcXVpZWwgR2FyY2lhIDxlemVxdWllbEBjb2xsYWJvcmEuY29tPgpDYzogU2lt
b24gU2VyIDxjb250YWN0QGVtZXJzaW9uLmZyPgpDYzogSmFtZXMgSm9uZXMgPGpham9uZXNAbnZp
ZGlhLmNvbT4KQ2M6IGxpbnV4LW1lZGlhQHZnZXIua2VybmVsLm9yZwpDYzogZHJpLWRldmVsQGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVs
dHpAbGluYXJvLm9yZz4KLS0tCnYyOgoqIEZpeCBidWlsZCBpc3N1ZSBjYXVzZWQgYnkgc2VsZWN0
aW5nIFBBR0VfUE9PTCB3L28gTkVUCiAgYXMgUmVwb3J0ZWQtYnk6IGtlcm5lbCB0ZXN0IHJvYm90
IDxsa3BAaW50ZWwuY29tPgp2MzoKKiBTaW1wbGlmeSB0aGUgcGFnZSB6ZXJvaW5nIGxvZ2ljIGEg
Yml0IGJ5IHVzaW5nIGttYXBfYXRvbWljCiAgaW5zdGVhZCBvZiB2bWFwIGFzIHN1Z2dlc3RlZCBi
eSBEYW5pZWwgTWVudHoKLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyAgICAgICB8
ICAyICsrCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hlYXAuYyB8IDUyICsrKysrKysr
KysrKysrKysrKysrKysrKysrLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDUwIGluc2VydGlvbnMoKyks
IDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25m
aWcgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwppbmRleCBmN2FlZjhiYzcxMTkuLjQ1
YzdkMjc3NDQ4YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKKysr
IGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKQEAgLTQsNiArNCw4IEBAIGNvbmZpZyBE
TUFCVUZfSEVBUFNfREVGRVJSRURfRlJFRQogY29uZmlnIERNQUJVRl9IRUFQU19TWVNURU0KIAli
b29sICJETUEtQlVGIFN5c3RlbSBIZWFwIgogCWRlcGVuZHMgb24gRE1BQlVGX0hFQVBTCisJc2Vs
ZWN0IE5FVAorCXNlbGVjdCBQQUdFX1BPT0wKIAloZWxwCiAJICBDaG9vc2UgdGhpcyBvcHRpb24g
dG8gZW5hYmxlIHRoZSBzeXN0ZW0gZG1hYnVmIGhlYXAuIFRoZSBzeXN0ZW0gaGVhcAogCSAgaXMg
YmFja2VkIGJ5IHBhZ2VzIGZyb20gdGhlIGJ1ZGR5IGFsbG9jYXRvci4gSWYgaW4gZG91YnQsIHNh
eSBZLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMgYi9k
cml2ZXJzL2RtYS1idWYvaGVhcHMvc3lzdGVtX2hlYXAuYwppbmRleCAxN2UwZTlhNjhiYWYuLjJh
ZGRiNmQ4MzJlMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFw
LmMKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKQEAgLTIwLDYgKzIw
LDcgQEAKICNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L3Ns
YWIuaD4KICNpbmNsdWRlIDxsaW51eC92bWFsbG9jLmg+CisjaW5jbHVkZSA8bmV0L3BhZ2VfcG9v
bC5oPgogCiBzdGF0aWMgc3RydWN0IGRtYV9oZWFwICpzeXNfaGVhcDsKIApAQCAtNTMsNiArNTQs
NyBAQCBzdGF0aWMgZ2ZwX3Qgb3JkZXJfZmxhZ3NbXSA9IHtISUdIX09SREVSX0dGUCwgTE9XX09S
REVSX0dGUCwgTE9XX09SREVSX0dGUH07CiAgKi8KIHN0YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQg
b3JkZXJzW10gPSB7OCwgNCwgMH07CiAjZGVmaW5lIE5VTV9PUkRFUlMgQVJSQVlfU0laRShvcmRl
cnMpCitzdHJ1Y3QgcGFnZV9wb29sICpwb29sc1tOVU1fT1JERVJTXTsKIAogc3RhdGljIHN0cnVj
dCBzZ190YWJsZSAqZHVwX3NnX3RhYmxlKHN0cnVjdCBzZ190YWJsZSAqdGFibGUpCiB7CkBAIC0y
ODEsMTggKzI4Myw0MyBAQCBzdGF0aWMgdm9pZCBzeXN0ZW1faGVhcF92dW5tYXAoc3RydWN0IGRt
YV9idWYgKmRtYWJ1Ziwgc3RydWN0IGRtYV9idWZfbWFwICptYXApCiAJZG1hX2J1Zl9tYXBfY2xl
YXIobWFwKTsKIH0KIAorc3RhdGljIGludCBzeXN0ZW1faGVhcF96ZXJvX2J1ZmZlcihzdHJ1Y3Qg
c3lzdGVtX2hlYXBfYnVmZmVyICpidWZmZXIpCit7CisJc3RydWN0IHNnX3RhYmxlICpzZ3QgPSAm
YnVmZmVyLT5zZ190YWJsZTsKKwlzdHJ1Y3Qgc2dfcGFnZV9pdGVyIHBpdGVyOworCXN0cnVjdCBw
YWdlICpwOworCXZvaWQgKnZhZGRyOworCWludCByZXQgPSAwOworCisJZm9yX2VhY2hfc2d0YWJs
ZV9wYWdlKHNndCwgJnBpdGVyLCAwKSB7CisJCXAgPSBzZ19wYWdlX2l0ZXJfcGFnZSgmcGl0ZXIp
OworCQl2YWRkciA9IGttYXBfYXRvbWljKHApOworCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0la
RSk7CisJCWt1bm1hcF9hdG9taWModmFkZHIpOworCX0KKworCXJldHVybiByZXQ7Cit9CisKIHN0
YXRpYyB2b2lkIHN5c3RlbV9oZWFwX2RtYV9idWZfcmVsZWFzZShzdHJ1Y3QgZG1hX2J1ZiAqZG1h
YnVmKQogewogCXN0cnVjdCBzeXN0ZW1faGVhcF9idWZmZXIgKmJ1ZmZlciA9IGRtYWJ1Zi0+cHJp
djsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOwogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Ci0J
aW50IGk7CisJaW50IGksIGo7CisKKwkvKiBaZXJvIHRoZSBidWZmZXIgcGFnZXMgYmVmb3JlIGFk
ZGluZyBiYWNrIHRvIHRoZSBwb29sICovCisJc3lzdGVtX2hlYXBfemVyb19idWZmZXIoYnVmZmVy
KTsKIAogCXRhYmxlID0gJmJ1ZmZlci0+c2dfdGFibGU7CiAJZm9yX2VhY2hfc2codGFibGUtPnNn
bCwgc2csIHRhYmxlLT5uZW50cywgaSkgewogCQlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHNnX3BhZ2Uo
c2cpOwogCi0JCV9fZnJlZV9wYWdlcyhwYWdlLCBjb21wb3VuZF9vcmRlcihwYWdlKSk7CisJCWZv
ciAoaiA9IDA7IGogPCBOVU1fT1JERVJTOyBqKyspIHsKKwkJCWlmIChjb21wb3VuZF9vcmRlcihw
YWdlKSA9PSBvcmRlcnNbal0pCisJCQkJYnJlYWs7CisJCX0KKwkJcGFnZV9wb29sX3B1dF9mdWxs
X3BhZ2UocG9vbHNbal0sIHBhZ2UsIGZhbHNlKTsKIAl9CiAJc2dfZnJlZV90YWJsZSh0YWJsZSk7
CiAJa2ZyZWUoYnVmZmVyKTsKQEAgLTMyMiw4ICszNDksNyBAQCBzdGF0aWMgc3RydWN0IHBhZ2Ug
KmFsbG9jX2xhcmdlc3RfYXZhaWxhYmxlKHVuc2lnbmVkIGxvbmcgc2l6ZSwKIAkJCWNvbnRpbnVl
OwogCQlpZiAobWF4X29yZGVyIDwgb3JkZXJzW2ldKQogCQkJY29udGludWU7Ci0KLQkJcGFnZSA9
IGFsbG9jX3BhZ2VzKG9yZGVyX2ZsYWdzW2ldLCBvcmRlcnNbaV0pOworCQlwYWdlID0gcGFnZV9w
b29sX2FsbG9jX3BhZ2VzKHBvb2xzW2ldLCBvcmRlcl9mbGFnc1tpXSk7CiAJCWlmICghcGFnZSkK
IAkJCWNvbnRpbnVlOwogCQlyZXR1cm4gcGFnZTsKQEAgLTQyOCw2ICs0NTQsMjQgQEAgc3RhdGlj
IGNvbnN0IHN0cnVjdCBkbWFfaGVhcF9vcHMgc3lzdGVtX2hlYXBfb3BzID0gewogc3RhdGljIGlu
dCBzeXN0ZW1faGVhcF9jcmVhdGUodm9pZCkKIHsKIAlzdHJ1Y3QgZG1hX2hlYXBfZXhwb3J0X2lu
Zm8gZXhwX2luZm87CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgTlVNX09SREVSUzsgaSsr
KSB7CisJCXN0cnVjdCBwYWdlX3Bvb2xfcGFyYW1zIHBwOworCisJCW1lbXNldCgmcHAsIDAsIHNp
emVvZihwcCkpOworCQlwcC5vcmRlciA9IG9yZGVyc1tpXTsKKwkJcG9vbHNbaV0gPSBwYWdlX3Bv
b2xfY3JlYXRlKCZwcCk7CisKKwkJaWYgKElTX0VSUihwb29sc1tpXSkpIHsKKwkJCWludCBqOwor
CisJCQlwcl9lcnIoIiVzOiBwYWdlIHBvb2wgY3JlYXRpb24gZmFpbGVkIVxuIiwgX19mdW5jX18p
OworCQkJZm9yIChqID0gMDsgaiA8IGk7IGorKykKKwkJCQlwYWdlX3Bvb2xfZGVzdHJveShwb29s
c1tqXSk7CisJCQlyZXR1cm4gUFRSX0VSUihwb29sc1tpXSk7CisJCX0KKwl9CiAKIAlleHBfaW5m
by5uYW1lID0gInN5c3RlbSI7CiAJZXhwX2luZm8ub3BzID0gJnN5c3RlbV9oZWFwX29wczsKLS0g
CjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
