Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 85228FF90E
	for <lists+dri-devel@lfdr.de>; Sun, 17 Nov 2019 12:45:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E71A86E2A3;
	Sun, 17 Nov 2019 11:44:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 202856E1F7
 for <dri-devel@lists.freedesktop.org>; Sun, 17 Nov 2019 02:41:50 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1]) (Authenticated sender: sre)
 with ESMTPSA id A07AD28F766
Received: by earth.universe (Postfix, from userid 1000)
 id B4A7B3C0C81; Sun, 17 Nov 2019 03:41:39 +0100 (CET)
From: Sebastian Reichel <sebastian.reichel@collabora.com>
To: Sebastian Reichel <sre@kernel.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>
Subject: [RFCv1 09/42] drm/omap: dsi: simplify read functions
Date: Sun, 17 Nov 2019 03:39:55 +0100
Message-Id: <20191117024028.2233-10-sebastian.reichel@collabora.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191117024028.2233-1-sebastian.reichel@collabora.com>
References: <20191117024028.2233-1-sebastian.reichel@collabora.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 17 Nov 2019 11:44:18 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com, Tony Lindgren <tony@atomide.com>,
 "H. Nikolaus Schaller" <hns@goldelico.com>, Merlijn Wajer <merlijn@wizzup.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 dri-devel@lists.freedesktop.org, linux-omap@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2ltcGxpZnkgdGhlIHJlYWQgcmVsYXRlZCBtZXNzYWdlIGhhbmRsaW5nIGJ5IHVzaW5nIHRoZSBm
dW5jdGlvbmFsaXR5CnByb3ZpZGVkIGJ5IENPTkZJR19EUk1fTUlQSV9EU0kuCgpTaWduZWQtb2Zm
LWJ5OiBTZWJhc3RpYW4gUmVpY2hlbCA8c2ViYXN0aWFuLnJlaWNoZWxAY29sbGFib3JhLmNvbT4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3MvZHNpLmMgfCAxMDkgKysrKysrKysrLS0t
LS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzMgaW5zZXJ0aW9ucygrKSwgNzYg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2Rz
aS5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5jCmluZGV4IDY5NjcyNzY3M2M2
YS4uYzIyZDQzOGFlMmI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vb21hcGRybS9kc3Mv
ZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL2RzaS5jCkBAIC0yNzQxLDYw
ICsyNzQxLDYgQEAgc3RhdGljIGludCBkc2lfdmNfd3JpdGVfY29tbW9uKHN0cnVjdCBvbWFwX2Rz
c19kZXZpY2UgKmRzc2RldiwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBkc2lfdmNfZGNz
X3NlbmRfcmVhZF9yZXF1ZXN0KHN0cnVjdCBkc2lfZGF0YSAqZHNpLCBpbnQgY2hhbm5lbCwKLQkJ
CQkJdTggZGNzX2NtZCkKLXsKLQlpbnQgcjsKLQotCWlmIChkc2ktPmRlYnVnX3JlYWQpCi0JCURT
U0RCRygiZHNpX3ZjX2Rjc19zZW5kX3JlYWRfcmVxdWVzdChjaCVkLCBkY3NfY21kICV4KVxuIiwK
LQkJCWNoYW5uZWwsIGRjc19jbWQpOwotCi0JciA9IGRzaV92Y19zZW5kX3Nob3J0KGRzaSwgY2hh
bm5lbCwgTUlQSV9EU0lfRENTX1JFQUQsIGRjc19jbWQsIDApOwotCWlmIChyKSB7Ci0JCURTU0VS
UigiZHNpX3ZjX2Rjc19zZW5kX3JlYWRfcmVxdWVzdChjaCAlZCwgY21kIDB4JTAyeCkiCi0JCQki
IGZhaWxlZFxuIiwgY2hhbm5lbCwgZGNzX2NtZCk7Ci0JCXJldHVybiByOwotCX0KLQotCXJldHVy
biAwOwotfQotCi1zdGF0aWMgaW50IGRzaV92Y19nZW5lcmljX3NlbmRfcmVhZF9yZXF1ZXN0KHN0
cnVjdCBkc2lfZGF0YSAqZHNpLCBpbnQgY2hhbm5lbCwKLQkJCQkJICAgIGNvbnN0IHU4ICpyZXFk
YXRhLCBpbnQgcmVxbGVuKQotewotCXUxNiBkYXRhOwotCXU4IGRhdGFfdHlwZTsKLQlpbnQgcjsK
LQotCWlmIChkc2ktPmRlYnVnX3JlYWQpCi0JCURTU0RCRygiZHNpX3ZjX2dlbmVyaWNfc2VuZF9y
ZWFkX3JlcXVlc3QoY2ggJWQsIHJlcWxlbiAlZClcbiIsCi0JCQljaGFubmVsLCByZXFsZW4pOwot
Ci0JaWYgKHJlcWxlbiA9PSAwKSB7Ci0JCWRhdGFfdHlwZSA9IE1JUElfRFNJX0dFTkVSSUNfUkVB
RF9SRVFVRVNUXzBfUEFSQU07Ci0JCWRhdGEgPSAwOwotCX0gZWxzZSBpZiAocmVxbGVuID09IDEp
IHsKLQkJZGF0YV90eXBlID0gTUlQSV9EU0lfR0VORVJJQ19SRUFEX1JFUVVFU1RfMV9QQVJBTTsK
LQkJZGF0YSA9IHJlcWRhdGFbMF07Ci0JfSBlbHNlIGlmIChyZXFsZW4gPT0gMikgewotCQlkYXRh
X3R5cGUgPSBNSVBJX0RTSV9HRU5FUklDX1JFQURfUkVRVUVTVF8yX1BBUkFNOwotCQlkYXRhID0g
cmVxZGF0YVswXSB8IChyZXFkYXRhWzFdIDw8IDgpOwotCX0gZWxzZSB7Ci0JCUJVRygpOwotCQly
ZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlyID0gZHNpX3ZjX3NlbmRfc2hvcnQoZHNpLCBjaGFubmVs
LCBkYXRhX3R5cGUsIGRhdGEsIDApOwotCWlmIChyKSB7Ci0JCURTU0VSUigiZHNpX3ZjX2dlbmVy
aWNfc2VuZF9yZWFkX3JlcXVlc3QoY2ggJWQsIHJlcWxlbiAlZCkiCi0JCQkiIGZhaWxlZFxuIiwg
Y2hhbm5lbCwgcmVxbGVuKTsKLQkJcmV0dXJuIHI7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0
YXRpYyBpbnQgZHNpX3ZjX3JlYWRfcnhfZmlmbyhzdHJ1Y3QgZHNpX2RhdGEgKmRzaSwgaW50IGNo
YW5uZWwsIHU4ICpidWYsCiAJCQkgICAgICAgaW50IGJ1ZmxlbiwgZW51bSBkc3NfZHNpX2NvbnRl
bnRfdHlwZSB0eXBlKQogewpAQCAtMjkwMyw2MSArMjg0OSw3NSBAQCBzdGF0aWMgaW50IGRzaV92
Y19yZWFkX3J4X2ZpZm8oc3RydWN0IGRzaV9kYXRhICpkc2ksIGludCBjaGFubmVsLCB1OCAqYnVm
LAogCXJldHVybiByOwogfQogCi1zdGF0aWMgaW50IGRzaV92Y19kY3NfcmVhZChzdHJ1Y3Qgb21h
cF9kc3NfZGV2aWNlICpkc3NkZXYsIGludCBjaGFubmVsLCB1OCBkY3NfY21kLAotCQl1OCAqYnVm
LCBpbnQgYnVmbGVuKQorc3RhdGljIGludCBkc2lfdmNfZGNzX3JlYWQoc3RydWN0IG9tYXBfZHNz
X2RldmljZSAqZHNzZGV2LAorCQkJICAgY29uc3Qgc3RydWN0IG1pcGlfZHNpX21zZyAqbXNnKQog
ewogCXN0cnVjdCBkc2lfZGF0YSAqZHNpID0gdG9fZHNpX2RhdGEoZHNzZGV2KTsKIAlpbnQgcjsK
Kwl1OCBkY3NfY21kID0gKCh1OCopIG1zZy0+dHhfYnVmKVswXTsKIAotCXIgPSBkc2lfdmNfZGNz
X3NlbmRfcmVhZF9yZXF1ZXN0KGRzaSwgY2hhbm5lbCwgZGNzX2NtZCk7CisJciA9IGRzaV92Y19z
ZW5kX3Nob3J0KGRzaSwgbXNnLT5jaGFubmVsLCBNSVBJX0RTSV9EQ1NfUkVBRCwgZGNzX2NtZCwg
MCk7CiAJaWYgKHIpCiAJCWdvdG8gZXJyOwogCi0JciA9IGRzaV92Y19zZW5kX2J0YV9zeW5jKGRz
c2RldiwgY2hhbm5lbCk7CisJciA9IGRzaV92Y19zZW5kX2J0YV9zeW5jKGRzc2RldiwgbXNnLT5j
aGFubmVsKTsKIAlpZiAocikKIAkJZ290byBlcnI7CiAKLQlyID0gZHNpX3ZjX3JlYWRfcnhfZmlm
byhkc2ksIGNoYW5uZWwsIGJ1ZiwgYnVmbGVuLAorCXIgPSBkc2lfdmNfcmVhZF9yeF9maWZvKGRz
aSwgbXNnLT5jaGFubmVsLCBtc2ctPnJ4X2J1ZiwgbXNnLT5yeF9sZW4sCiAJCURTU19EU0lfQ09O
VEVOVF9EQ1MpOwogCWlmIChyIDwgMCkKIAkJZ290byBlcnI7CiAKLQlpZiAociAhPSBidWZsZW4p
IHsKKwlpZiAociAhPSBtc2ctPnJ4X2xlbikgewogCQlyID0gLUVJTzsKIAkJZ290byBlcnI7CiAJ
fQogCiAJcmV0dXJuIDA7CiBlcnI6Ci0JRFNTRVJSKCJkc2lfdmNfZGNzX3JlYWQoY2ggJWQsIGNt
ZCAweCUwMngpIGZhaWxlZFxuIiwgY2hhbm5lbCwgZGNzX2NtZCk7CisJRFNTRVJSKCJkc2lfdmNf
ZGNzX3JlYWQoY2ggJWQsIGNtZCAweCUwMngpIGZhaWxlZFxuIiwKKwkJbXNnLT5jaGFubmVsLCBk
Y3NfY21kKTsKIAlyZXR1cm4gcjsKIH0KIAotc3RhdGljIGludCBkc2lfdmNfZ2VuZXJpY19yZWFk
KHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwgaW50IGNoYW5uZWwsCi0JCWNvbnN0IHU4
ICpyZXFkYXRhLCBpbnQgcmVxbGVuLCB1OCAqYnVmLCBpbnQgYnVmbGVuKQorc3RhdGljIGludCBk
c2lfdmNfZ2VuZXJpY19yZWFkKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwKKwkJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgbWlwaV9kc2lfbXNnICptc2cpCiB7CiAJc3RydWN0IGRzaV9kYXRh
ICpkc2kgPSB0b19kc2lfZGF0YShkc3NkZXYpOworCXN0cnVjdCBtaXBpX2RzaV9wYWNrZXQgcGFj
a2V0OworCXUxNiBkYXRhOwogCWludCByOwogCi0JciA9IGRzaV92Y19nZW5lcmljX3NlbmRfcmVh
ZF9yZXF1ZXN0KGRzaSwgY2hhbm5lbCwgcmVxZGF0YSwgcmVxbGVuKTsKKwlyID0gbWlwaV9kc2lf
Y3JlYXRlX3BhY2tldCgmcGFja2V0LCBtc2cpOworCWlmIChyIDwgMCkKKwkJZ290byBlcnI7CisK
KwlkYXRhID0gcGFja2V0LmhlYWRlclsxXSB8IChwYWNrZXQuaGVhZGVyWzJdIDw8IDgpOworCisJ
ciA9IGRzaV92Y19zZW5kX3Nob3J0KGRzaSwgbXNnLT5jaGFubmVsLCBtc2ctPnR5cGUsIGRhdGEs
IDApOwogCWlmIChyKQotCQlyZXR1cm4gcjsKKwkJZ290byBlcnI7CiAKLQlyID0gZHNpX3ZjX3Nl
bmRfYnRhX3N5bmMoZHNzZGV2LCBjaGFubmVsKTsKKwlyID0gZHNpX3ZjX3NlbmRfYnRhX3N5bmMo
ZHNzZGV2LCBtc2ctPmNoYW5uZWwpOwogCWlmIChyKQotCQlyZXR1cm4gcjsKKwkJZ290byBlcnI7
CiAKLQlyID0gZHNpX3ZjX3JlYWRfcnhfZmlmbyhkc2ksIGNoYW5uZWwsIGJ1ZiwgYnVmbGVuLAor
CXIgPSBkc2lfdmNfcmVhZF9yeF9maWZvKGRzaSwgbXNnLT5jaGFubmVsLCBtc2ctPnJ4X2J1Ziwg
bXNnLT5yeF9sZW4sCiAJCURTU19EU0lfQ09OVEVOVF9HRU5FUklDKTsKIAlpZiAociA8IDApCi0J
CXJldHVybiByOworCQlnb3RvIGVycjsKIAotCWlmIChyICE9IGJ1ZmxlbikgeworCWlmIChyICE9
IG1zZy0+cnhfbGVuKSB7CiAJCXIgPSAtRUlPOwotCQlyZXR1cm4gcjsKKwkJZ290byBlcnI7CiAJ
fQogCiAJcmV0dXJuIDA7CitlcnI6CisJRFNTRVJSKCJkc2lfdmNfZ2VuZXJpY19yZWFkKGNoICVk
LCByZXFsZW4gJWQpIGZhaWxlZFxuIiwKKwkJbXNnLT5jaGFubmVsLCBtc2ctPnR4X2xlbik7CisJ
cmV0dXJuIHI7CiB9CiAKIHN0YXRpYyBpbnQgZHNpX2VudGVyX3VscHMoc3RydWN0IGRzaV9kYXRh
ICpkc2kpCkBAIC00NzY4LDEyICs0NzI4LDkgQEAgc3RhdGljIHNzaXplX3Qgb21hcF9kc2lfdHJh
bnNmZXIoc3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LAogCWNhc2UgTUlQSV9EU0lfR0VO
RVJJQ19SRUFEX1JFUVVFU1RfMF9QQVJBTToKIAljYXNlIE1JUElfRFNJX0dFTkVSSUNfUkVBRF9S
RVFVRVNUXzFfUEFSQU06CiAJY2FzZSBNSVBJX0RTSV9HRU5FUklDX1JFQURfUkVRVUVTVF8yX1BB
UkFNOgotCQlyZXR1cm4gZHNpX3ZjX2dlbmVyaWNfcmVhZChkc3NkZXYsIG1zZy0+Y2hhbm5lbCwg
bXNnLT50eF9idWYsCi0JCQkJbXNnLT50eF9sZW4sIG1zZy0+cnhfYnVmLCBtc2ctPnJ4X2xlbik7
CisJCXJldHVybiBkc2lfdmNfZ2VuZXJpY19yZWFkKGRzc2RldiwgbXNnKTsKIAljYXNlIE1JUElf
RFNJX0RDU19SRUFEOgotCQlyZXR1cm4gZHNpX3ZjX2Rjc19yZWFkKGRzc2RldiwgbXNnLT5jaGFu
bmVsLAotCQkJCSgodTgqKSBtc2ctPnR4X2J1ZilbMF0sCi0JCQkJbXNnLT5yeF9idWYsIG1zZy0+
cnhfbGVuKTsKKwkJcmV0dXJuIGRzaV92Y19kY3NfcmVhZChkc3NkZXYsIG1zZyk7CiAJfQogCiAJ
cmV0dXJuIC1FSU5WQUw7Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
