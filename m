Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 50DDFA316F
	for <lists+dri-devel@lfdr.de>; Fri, 30 Aug 2019 09:46:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4FDAD6E287;
	Fri, 30 Aug 2019 07:46:13 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [210.61.82.184])
 by gabe.freedesktop.org (Postfix) with ESMTP id B5A696E287
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Aug 2019 07:46:11 +0000 (UTC)
X-UUID: 21f0927d4e7e4a10ac54f70ce0c2cff1-20190830
X-UUID: 21f0927d4e7e4a10ac54f70ce0c2cff1-20190830
Received: from mtkcas09.mediatek.inc [(172.21.101.178)] by
 mailgw02.mediatek.com (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 1380859373; Fri, 30 Aug 2019 15:41:06 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs05n1.mediatek.inc (172.21.101.15) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Fri, 30 Aug 2019 15:41:10 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Fri, 30 Aug 2019 15:41:10 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH 1/2] drm/mediatek: Support CMDQ interface in ddp component
Date: Fri, 30 Aug 2019 15:41:02 +0800
Message-ID: <20190830074103.16671-2-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20190830074103.16671-1-bibby.hsieh@mediatek.com>
References: <20190830074103.16671-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, Yongqiang Niu <yongqiang.niu@mediatek.com>,
 linux-kernel@vger.kernel.org, tfiga@chromium.org,
 Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIENNRFEgKENvbW1hbmQgUXVldWUpIGluIE1UODE4MyBpcyB1c2VkIHRvIGhlbHAKdXBkYXRl
IGFsbCByZWxldmFudCBkaXNwbGF5IGNvbnRyb2xsZXIgcmVnaXN0ZXJzCndpdGggY3JpdGljYWwg
dGltZSBsaW1hdGlvbi4KVGhpcyBwYXRjaCBhZGQgY21kcSBpbnRlcmZhY2UgaW4gZGRwX2NvbXAg
aW50ZXJmYWNlLApsZXQgYWxsIGRkcF9jb21wIGludGVyZmFjZSBjYW4gc3VwcG9ydCBjcHUvY21k
cSBmdW5jdGlvbgphdCB0aGUgc2FtZSB0aW1lLgoKU2lnbmVkLW9mZi1ieTogWVQgU2hlbiA8eXQu
c2hlbkBtZWRpYXRlay5jb20+ClNpZ25lZC1vZmYtYnk6IENLIEh1IDxjay5odUBtZWRpYXRlay5j
b20+ClNpZ25lZC1vZmYtYnk6IFBoaWxpcHAgWmFiZWwgPHAuemFiZWxAcGVuZ3V0cm9uaXguZGU+
ClNpZ25lZC1vZmYtYnk6IEJpYmJ5IEhzaWVoIDxiaWJieS5oc2llaEBtZWRpYXRlay5jb20+ClNp
Z25lZC1vZmYtYnk6IFlvbmdxaWFuZyBOaXUgPHlvbmdxaWFuZy5uaXVAbWVkaWF0ZWsuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9jb2xvci5jICAgfCAgIDcgKy0K
IGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9vdmwuYyAgICAgfCAgNzggKysrKysr
Ky0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9yZG1hLmMgICAgfCAg
NjYgKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29t
cC5jIHwgMTEwICsrKysrKysrKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsv
bXRrX2RybV9kZHBfY29tcC5oIHwgIDUzICsrKysrKy0tLS0KIDUgZmlsZXMgY2hhbmdlZCwgMTg3
IGluc2VydGlvbnMoKyksIDEyNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3BfY29sb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRl
ay9tdGtfZGlzcF9jb2xvci5jCmluZGV4IGYzM2Q5OGIzNTZkNi4uYzVkM2UzY2Y4YWQ1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3BfY29sb3IuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3BfY29sb3IuYwpAQCAtOSw2ICs5LDcgQEAK
ICNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2UuaD4KICNpbmNsdWRlIDxsaW51eC9vZl9pcnEuaD4K
ICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9zb2Mv
bWVkaWF0ZWsvbXRrLWNtZHEuaD4KIAogI2luY2x1ZGUgIm10a19kcm1fY3J0Yy5oIgogI2luY2x1
ZGUgIm10a19kcm1fZGRwX2NvbXAuaCIKQEAgLTQ1LDEyICs0NiwxMiBAQCBzdGF0aWMgaW5saW5l
IHN0cnVjdCBtdGtfZGlzcF9jb2xvciAqY29tcF90b19jb2xvcihzdHJ1Y3QgbXRrX2RkcF9jb21w
ICpjb21wKQogCiBzdGF0aWMgdm9pZCBtdGtfY29sb3JfY29uZmlnKHN0cnVjdCBtdGtfZGRwX2Nv
bXAgKmNvbXAsIHVuc2lnbmVkIGludCB3LAogCQkJICAgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWdu
ZWQgaW50IHZyZWZyZXNoLAotCQkJICAgICB1bnNpZ25lZCBpbnQgYnBjKQorCQkJICAgICB1bnNp
Z25lZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCXN0cnVjdCBtdGtf
ZGlzcF9jb2xvciAqY29sb3IgPSBjb21wX3RvX2NvbG9yKGNvbXApOwogCi0Jd3JpdGVsKHcsIGNv
bXAtPnJlZ3MgKyBESVNQX0NPTE9SX1dJRFRIKGNvbG9yKSk7Ci0Jd3JpdGVsKGgsIGNvbXAtPnJl
Z3MgKyBESVNQX0NPTE9SX0hFSUdIVChjb2xvcikpOworCW10a19kZHBfd3JpdGUoY21kcV9wa3Qs
IHcsIGNvbXAsIERJU1BfQ09MT1JfV0lEVEgoY29sb3IpKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFf
cGt0LCBoLCBjb21wLCBESVNQX0NPTE9SX0hFSUdIVChjb2xvcikpOwogfQogCiBzdGF0aWMgdm9p
ZCBtdGtfY29sb3Jfc3RhcnQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9vdmwuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9tZWRpYXRlay9tdGtfZGlzcF9vdmwuYwppbmRleCA5NGM4MGMyMTVjNmUuLmYxMWM3ODUxOTlk
MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNwX292bC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9vdmwuYwpAQCAtOSw2ICs5LDcg
QEAKICNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2UuaD4KICNpbmNsdWRlIDxsaW51eC9vZl9pcnEu
aD4KICNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9z
b2MvbWVkaWF0ZWsvbXRrLWNtZHEuaD4KIAogI2luY2x1ZGUgIm10a19kcm1fY3J0Yy5oIgogI2lu
Y2x1ZGUgIm10a19kcm1fZGRwX2NvbXAuaCIKQEAgLTEyMCwxNCArMTIxLDE1IEBAIHN0YXRpYyB2
b2lkIG10a19vdmxfc3RvcChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQogCiBzdGF0aWMgdm9p
ZCBtdGtfb3ZsX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQg
dywKIAkJCSAgIHVuc2lnbmVkIGludCBoLCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCi0JCQkgICB1
bnNpZ25lZCBpbnQgYnBjKQorCQkJICAgdW5zaWduZWQgaW50IGJwYywgc3RydWN0IGNtZHFfcGt0
ICpjbWRxX3BrdCkKIHsKIAlpZiAodyAhPSAwICYmIGggIT0gMCkKLQkJd3JpdGVsX3JlbGF4ZWQo
aCA8PCAxNiB8IHcsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfUk9JX1NJWkUpOwotCXdyaXRl
bF9yZWxheGVkKDB4MCwgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9ST0lfQkdDTFIpOworCQlt
dGtfZGRwX3dyaXRlX3JlbGF4ZWQoY21kcV9wa3QsIGggPDwgMTYgfCB3LCBjb21wLAorCQlESVNQ
X1JFR19PVkxfUk9JX1NJWkUpOworCW10a19kZHBfd3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgMHgw
LCBjb21wLCBESVNQX1JFR19PVkxfUk9JX0JHQ0xSKTsKIAotCXdyaXRlbCgweDEsIGNvbXAtPnJl
Z3MgKyBESVNQX1JFR19PVkxfUlNUKTsKLQl3cml0ZWwoMHgwLCBjb21wLT5yZWdzICsgRElTUF9S
RUdfT1ZMX1JTVCk7CisJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgMHgxLCBjb21wLCBESVNQX1JF
R19PVkxfUlNUKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCAweDAsIGNvbXAsIERJU1BfUkVH
X09WTF9SU1QpOwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50IG10a19vdmxfbGF5ZXJfbnIoc3Ry
dWN0IG10a19kZHBfY29tcCAqY29tcCkKQEAgLTEzNyw3ICsxMzksOCBAQCBzdGF0aWMgdW5zaWdu
ZWQgaW50IG10a19vdmxfbGF5ZXJfbnIoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIAlyZXR1
cm4gb3ZsLT5kYXRhLT5sYXllcl9ucjsKIH0KIAotc3RhdGljIHZvaWQgbXRrX292bF9sYXllcl9v
bihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4KQorc3RhdGljIHZv
aWQgbXRrX292bF9sYXllcl9vbihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBp
bnQgaWR4LAorCQkJICAgICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCXVuc2lnbmVk
IGludCByZWc7CiAJdW5zaWduZWQgaW50IGdtY190aHJzaGRfbDsKQEAgLTE0NSw4ICsxNDgsOCBA
QCBzdGF0aWMgdm9pZCBtdGtfb3ZsX2xheWVyX29uKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAs
IHVuc2lnbmVkIGludCBpZHgpCiAJdW5zaWduZWQgaW50IGdtY192YWx1ZTsKIAlzdHJ1Y3QgbXRr
X2Rpc3Bfb3ZsICpvdmwgPSBjb21wX3RvX292bChjb21wKTsKIAotCXdyaXRlbCgweDEsIGNvbXAt
PnJlZ3MgKyBESVNQX1JFR19PVkxfUkRNQV9DVFJMKGlkeCkpOwotCisJbXRrX2RkcF93cml0ZShj
bWRxX3BrdCwgMHgxLCBjb21wLAorCQkgICAgICBESVNQX1JFR19PVkxfUkRNQV9DVFJMKGlkeCkp
OwogCWdtY190aHJzaGRfbCA9IEdNQ19USFJFU0hPTERfTE9XID4+CiAJCSAgICAgIChHTUNfVEhS
RVNIT0xEX0JJVFMgLSBvdmwtPmRhdGEtPmdtY19iaXRzKTsKIAlnbWNfdGhyc2hkX2ggPSBHTUNf
VEhSRVNIT0xEX0hJR0ggPj4KQEAgLTE1NiwyMiArMTU5LDE5IEBAIHN0YXRpYyB2b2lkIG10a19v
dmxfbGF5ZXJfb24oc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCkK
IAllbHNlCiAJCWdtY192YWx1ZSA9IGdtY190aHJzaGRfbCB8IGdtY190aHJzaGRfbCA8PCA4IHwK
IAkJCSAgICBnbWNfdGhyc2hkX2ggPDwgMTYgfCBnbWNfdGhyc2hkX2ggPDwgMjQ7Ci0Jd3JpdGVs
KGdtY192YWx1ZSwgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9SRE1BX0dNQyhpZHgpKTsKLQot
CXJlZyA9IHJlYWRsKGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfU1JDX0NPTik7Ci0JcmVnID0g
cmVnIHwgQklUKGlkeCk7Ci0Jd3JpdGVsKHJlZywgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9T
UkNfQ09OKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBnbWNfdmFsdWUsCisJCSAgICAgIGNv
bXAsIERJU1BfUkVHX09WTF9SRE1BX0dNQyhpZHgpKTsKKwltdGtfZGRwX3dyaXRlX21hc2soY21k
cV9wa3QsIEJJVChpZHgpLCBjb21wLAorCQkJICAgIERJU1BfUkVHX09WTF9TUkNfQ09OLCBCSVQo
aWR4KSk7CiB9CiAKLXN0YXRpYyB2b2lkIG10a19vdmxfbGF5ZXJfb2ZmKHN0cnVjdCBtdGtfZGRw
X2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBpZHgpCitzdGF0aWMgdm9pZCBtdGtfb3ZsX2xheWVy
X29mZihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAorCQkJICAg
ICAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKLQl1bnNpZ25lZCBpbnQgcmVnOwotCi0J
cmVnID0gcmVhZGwoY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9TUkNfQ09OKTsKLQlyZWcgPSBy
ZWcgJiB+QklUKGlkeCk7Ci0Jd3JpdGVsKHJlZywgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9T
UkNfQ09OKTsKLQotCXdyaXRlbCgweDAsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfUkRNQV9D
VFJMKGlkeCkpOworCW10a19kZHBfd3JpdGVfbWFzayhjbWRxX3BrdCwgMCwgY29tcCwKKwkJCSAg
ICBESVNQX1JFR19PVkxfU1JDX0NPTiwgQklUKGlkeCkpOworCW10a19kZHBfd3JpdGUoY21kcV9w
a3QsIDAsIGNvbXAsCisJCSAgICAgICBESVNQX1JFR19PVkxfUkRNQV9DVFJMKGlkeCkpOwogfQog
CiBzdGF0aWMgdW5zaWduZWQgaW50IG92bF9mbXRfY29udmVydChzdHJ1Y3QgbXRrX2Rpc3Bfb3Zs
ICpvdmwsIHVuc2lnbmVkIGludCBmbXQpCkBAIC0yMTEsNyArMjExLDggQEAgc3RhdGljIHVuc2ln
bmVkIGludCBvdmxfZm10X2NvbnZlcnQoc3RydWN0IG10a19kaXNwX292bCAqb3ZsLCB1bnNpZ25l
ZCBpbnQgZm10KQogfQogCiBzdGF0aWMgdm9pZCBtdGtfb3ZsX2xheWVyX2NvbmZpZyhzdHJ1Y3Qg
bXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAotCQkJCSBzdHJ1Y3QgbXRrX3Bs
YW5lX3N0YXRlICpzdGF0ZSkKKwkJCQkgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUsCisJ
CQkJIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7CiAJc3RydWN0IG10a19kaXNwX292bCAq
b3ZsID0gY29tcF90b19vdmwoY29tcCk7CiAJc3RydWN0IG10a19wbGFuZV9wZW5kaW5nX3N0YXRl
ICpwZW5kaW5nID0gJnN0YXRlLT5wZW5kaW5nOwpAQCAtMjIzLDM4ICsyMjQsMzcgQEAgc3RhdGlj
IHZvaWQgbXRrX292bF9sYXllcl9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5z
aWduZWQgaW50IGlkeCwKIAl1bnNpZ25lZCBpbnQgY29uOwogCiAJaWYgKCFwZW5kaW5nLT5lbmFi
bGUpCi0JCW10a19vdmxfbGF5ZXJfb2ZmKGNvbXAsIGlkeCk7CisJCW10a19vdmxfbGF5ZXJfb2Zm
KGNvbXAsIGlkeCwgY21kcV9wa3QpOwogCiAJY29uID0gb3ZsX2ZtdF9jb252ZXJ0KG92bCwgZm10
KTsKIAlpZiAoaWR4ICE9IDApCiAJCWNvbiB8PSBPVkxfQ09OX0FFTiB8IE9WTF9DT05fQUxQSEE7
CiAKLQl3cml0ZWxfcmVsYXhlZChjb24sIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfQ09OKGlk
eCkpOwotCXdyaXRlbF9yZWxheGVkKHBpdGNoLCBjb21wLT5yZWdzICsgRElTUF9SRUdfT1ZMX1BJ
VENIKGlkeCkpOwotCXdyaXRlbF9yZWxheGVkKHNyY19zaXplLCBjb21wLT5yZWdzICsgRElTUF9S
RUdfT1ZMX1NSQ19TSVpFKGlkeCkpOwotCXdyaXRlbF9yZWxheGVkKG9mZnNldCwgY29tcC0+cmVn
cyArIERJU1BfUkVHX09WTF9PRkZTRVQoaWR4KSk7Ci0Jd3JpdGVsX3JlbGF4ZWQoYWRkciwgY29t
cC0+cmVncyArIERJU1BfUkVHX09WTF9BRERSKG92bCwgaWR4KSk7CisJbXRrX2RkcF93cml0ZV9y
ZWxheGVkKGNtZHFfcGt0LCBjb24sIGNvbXAsCisJCQkgICAgICBESVNQX1JFR19PVkxfQ09OKGlk
eCkpOworCW10a19kZHBfd3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgcGl0Y2gsIGNvbXAsCisJCQkg
ICAgICBESVNQX1JFR19PVkxfUElUQ0goaWR4KSk7CisJbXRrX2RkcF93cml0ZV9yZWxheGVkKGNt
ZHFfcGt0LCBzcmNfc2l6ZSwgY29tcCwKKwkJCSAgICAgIERJU1BfUkVHX09WTF9TUkNfU0laRShp
ZHgpKTsKKwltdGtfZGRwX3dyaXRlX3JlbGF4ZWQoY21kcV9wa3QsIG9mZnNldCwgY29tcCwKKwkJ
CSAgICAgIERJU1BfUkVHX09WTF9PRkZTRVQoaWR4KSk7CisJbXRrX2RkcF93cml0ZV9yZWxheGVk
KGNtZHFfcGt0LCBhZGRyLCBjb21wLAorCQkJICAgICAgRElTUF9SRUdfT1ZMX0FERFIob3ZsLCBp
ZHgpKTsKIAogCWlmIChwZW5kaW5nLT5lbmFibGUpCi0JCW10a19vdmxfbGF5ZXJfb24oY29tcCwg
aWR4KTsKKwkJbXRrX292bF9sYXllcl9vbihjb21wLCBpZHgsIGNtZHFfcGt0KTsKIH0KIAogc3Rh
dGljIHZvaWQgbXRrX292bF9iZ2Nscl9pbl9vbihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQog
ewotCXVuc2lnbmVkIGludCByZWc7Ci0KLQlyZWcgPSByZWFkbChjb21wLT5yZWdzICsgRElTUF9S
RUdfT1ZMX0RBVEFQQVRIX0NPTik7Ci0JcmVnID0gcmVnIHwgT1ZMX0JHQ0xSX1NFTF9JTjsKLQl3
cml0ZWwocmVnLCBjb21wLT5yZWdzICsgRElTUF9SRUdfT1ZMX0RBVEFQQVRIX0NPTik7CisJbXRr
X2RkcF93cml0ZV9tYXNrKE5VTEwsIE9WTF9CR0NMUl9TRUxfSU4sIGNvbXAsCisJCQkgICBESVNQ
X1JFR19PVkxfREFUQVBBVEhfQ09OLCBPVkxfQkdDTFJfU0VMX0lOKTsKIH0KIAogc3RhdGljIHZv
aWQgbXRrX292bF9iZ2Nscl9pbl9vZmYoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIHsKLQl1
bnNpZ25lZCBpbnQgcmVnOwotCi0JcmVnID0gcmVhZGwoY29tcC0+cmVncyArIERJU1BfUkVHX09W
TF9EQVRBUEFUSF9DT04pOwotCXJlZyA9IHJlZyAmIH5PVkxfQkdDTFJfU0VMX0lOOwotCXdyaXRl
bChyZWcsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfREFUQVBBVEhfQ09OKTsKKwltdGtfZGRw
X3dyaXRlX21hc2soTlVMTCwgMCwgY29tcCwKKwkJCSAgIERJU1BfUkVHX09WTF9EQVRBUEFUSF9D
T04sIE9WTF9CR0NMUl9TRUxfSU4pOwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IG10a19kZHBf
Y29tcF9mdW5jcyBtdGtfZGlzcF9vdmxfZnVuY3MgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3BfcmRtYS5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVr
L210a19kaXNwX3JkbWEuYwppbmRleCAyNDk0NWZlYzAwYjEuLjZkZjM3MmRhYzNlMyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNwX3JkbWEuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3BfcmRtYS5jCkBAIC05LDYgKzksNyBAQAogI2lu
Y2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgogI2luY2x1ZGUgPGxpbnV4L29mX2lycS5oPgogI2lu
Y2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3NvYy9tZWRp
YXRlay9tdGstY21kcS5oPgogCiAjaW5jbHVkZSAibXRrX2RybV9jcnRjLmgiCiAjaW5jbHVkZSAi
bXRrX2RybV9kZHBfY29tcC5oIgpAQCAtODYsMjMgKzg3LDE0IEBAIHN0YXRpYyBpcnFyZXR1cm5f
dCBtdGtfZGlzcF9yZG1hX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmRldl9pZCkKIAlyZXR1
cm4gSVJRX0hBTkRMRUQ7CiB9CiAKLXN0YXRpYyB2b2lkIHJkbWFfdXBkYXRlX2JpdHMoc3RydWN0
IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHJlZywKLQkJCSAgICAgdW5zaWduZWQg
aW50IG1hc2ssIHVuc2lnbmVkIGludCB2YWwpCi17Ci0JdW5zaWduZWQgaW50IHRtcCA9IHJlYWRs
KGNvbXAtPnJlZ3MgKyByZWcpOwotCi0JdG1wID0gKHRtcCAmIH5tYXNrKSB8ICh2YWwgJiBtYXNr
KTsKLQl3cml0ZWwodG1wLCBjb21wLT5yZWdzICsgcmVnKTsKLX0KLQogc3RhdGljIHZvaWQgbXRr
X3JkbWFfZW5hYmxlX3ZibGFuayhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAogCQkJCSAgIHN0
cnVjdCBkcm1fY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgbXRrX2Rpc3BfcmRtYSAqcmRtYSA9IGNv
bXBfdG9fcmRtYShjb21wKTsKIAogCXJkbWEtPmNydGMgPSBjcnRjOwotCXJkbWFfdXBkYXRlX2Jp
dHMoY29tcCwgRElTUF9SRUdfUkRNQV9JTlRfRU5BQkxFLCBSRE1BX0ZSQU1FX0VORF9JTlQsCi0J
CQkgUkRNQV9GUkFNRV9FTkRfSU5UKTsKKwltdGtfZGRwX3dyaXRlX21hc2soTlVMTCwgUkRNQV9G
UkFNRV9FTkRfSU5ULCBjb21wLAorCQkJICAgRElTUF9SRUdfUkRNQV9JTlRfRU5BQkxFLCBSRE1B
X0ZSQU1FX0VORF9JTlQpOwogfQogCiBzdGF0aWMgdm9pZCBtdGtfcmRtYV9kaXNhYmxlX3ZibGFu
ayhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQpAQCAtMTEwLDMxICsxMDIsMzUgQEAgc3RhdGlj
IHZvaWQgbXRrX3JkbWFfZGlzYWJsZV92Ymxhbmsoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkK
IAlzdHJ1Y3QgbXRrX2Rpc3BfcmRtYSAqcmRtYSA9IGNvbXBfdG9fcmRtYShjb21wKTsKIAogCXJk
bWEtPmNydGMgPSBOVUxMOwotCXJkbWFfdXBkYXRlX2JpdHMoY29tcCwgRElTUF9SRUdfUkRNQV9J
TlRfRU5BQkxFLCBSRE1BX0ZSQU1FX0VORF9JTlQsIDApOworCW10a19kZHBfd3JpdGVfbWFzayhO
VUxMLCAwLCBjb21wLAorCQkJICAgRElTUF9SRUdfUkRNQV9JTlRfRU5BQkxFLCBSRE1BX0ZSQU1F
X0VORF9JTlQpOwogfQogCiBzdGF0aWMgdm9pZCBtdGtfcmRtYV9zdGFydChzdHJ1Y3QgbXRrX2Rk
cF9jb21wICpjb21wKQogewotCXJkbWFfdXBkYXRlX2JpdHMoY29tcCwgRElTUF9SRUdfUkRNQV9H
TE9CQUxfQ09OLCBSRE1BX0VOR0lORV9FTiwKLQkJCSBSRE1BX0VOR0lORV9FTik7CisJbXRrX2Rk
cF93cml0ZV9tYXNrKE5VTEwsIFJETUFfRU5HSU5FX0VOLCBjb21wLAorCQkJICAgRElTUF9SRUdf
UkRNQV9HTE9CQUxfQ09OLCBSRE1BX0VOR0lORV9FTik7CiB9CiAKIHN0YXRpYyB2b2lkIG10a19y
ZG1hX3N0b3Aoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIHsKLQlyZG1hX3VwZGF0ZV9iaXRz
KGNvbXAsIERJU1BfUkVHX1JETUFfR0xPQkFMX0NPTiwgUkRNQV9FTkdJTkVfRU4sIDApOworCW10
a19kZHBfd3JpdGVfbWFzayhOVUxMLCAwLCBjb21wLAorCQkJICAgRElTUF9SRUdfUkRNQV9HTE9C
QUxfQ09OLCBSRE1BX0VOR0lORV9FTik7CiB9CiAKIHN0YXRpYyB2b2lkIG10a19yZG1hX2NvbmZp
ZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgd2lkdGgsCiAJCQkgICAg
dW5zaWduZWQgaW50IGhlaWdodCwgdW5zaWduZWQgaW50IHZyZWZyZXNoLAotCQkJICAgIHVuc2ln
bmVkIGludCBicGMpCisJCQkgICAgdW5zaWduZWQgaW50IGJwYywgc3RydWN0IGNtZHFfcGt0ICpj
bWRxX3BrdCkKIHsKIAl1bnNpZ25lZCBpbnQgdGhyZXNob2xkOwogCXVuc2lnbmVkIGludCByZWc7
CiAJc3RydWN0IG10a19kaXNwX3JkbWEgKnJkbWEgPSBjb21wX3RvX3JkbWEoY29tcCk7CiAJdTMy
IHJkbWFfZmlmb19zaXplOwogCi0JcmRtYV91cGRhdGVfYml0cyhjb21wLCBESVNQX1JFR19SRE1B
X1NJWkVfQ09OXzAsIDB4ZmZmLCB3aWR0aCk7Ci0JcmRtYV91cGRhdGVfYml0cyhjb21wLCBESVNQ
X1JFR19SRE1BX1NJWkVfQ09OXzEsIDB4ZmZmZmYsIGhlaWdodCk7CisJbXRrX2RkcF93cml0ZV9t
YXNrKGNtZHFfcGt0LCB3aWR0aCwgY29tcCwKKwkJCSAgICBESVNQX1JFR19SRE1BX1NJWkVfQ09O
XzAsIDB4ZmZmKTsKKwltdGtfZGRwX3dyaXRlX21hc2soY21kcV9wa3QsIGhlaWdodCwgY29tcCwK
KwkJCSAgICBESVNQX1JFR19SRE1BX1NJWkVfQ09OXzEsIDB4ZmZmZmYpOwogCiAJaWYgKHJkbWEt
PmZpZm9fc2l6ZSkKIAkJcmRtYV9maWZvX3NpemUgPSByZG1hLT5maWZvX3NpemU7CkBAIC0xNTEs
NyArMTQ3LDcgQEAgc3RhdGljIHZvaWQgbXRrX3JkbWFfY29uZmlnKHN0cnVjdCBtdGtfZGRwX2Nv
bXAgKmNvbXAsIHVuc2lnbmVkIGludCB3aWR0aCwKIAlyZWcgPSBSRE1BX0ZJRk9fVU5ERVJGTE9X
X0VOIHwKIAkgICAgICBSRE1BX0ZJRk9fUFNFVURPX1NJWkUocmRtYV9maWZvX3NpemUpIHwKIAkg
ICAgICBSRE1BX09VVFBVVF9WQUxJRF9GSUZPX1RIUkVTSE9MRCh0aHJlc2hvbGQpOwotCXdyaXRl
bChyZWcsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19SRE1BX0ZJRk9fQ09OKTsKKwltdGtfZGRwX3dy
aXRlKGNtZHFfcGt0LCByZWcsIGNvbXAsIERJU1BfUkVHX1JETUFfRklGT19DT04pOwogfQogCiBz
dGF0aWMgdW5zaWduZWQgaW50IHJkbWFfZm10X2NvbnZlcnQoc3RydWN0IG10a19kaXNwX3JkbWEg
KnJkbWEsCkBAIC0xOTcsNyArMTkzLDggQEAgc3RhdGljIHVuc2lnbmVkIGludCBtdGtfcmRtYV9s
YXllcl9ucihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQogfQogCiBzdGF0aWMgdm9pZCBtdGtf
cmRtYV9sYXllcl9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50
IGlkeCwKLQkJCQkgIHN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRlKQorCQkJCSAgc3RydWN0
IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUsCisJCQkJICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0
KQogewogCXN0cnVjdCBtdGtfZGlzcF9yZG1hICpyZG1hID0gY29tcF90b19yZG1hKGNvbXApOwog
CXN0cnVjdCBtdGtfcGxhbmVfcGVuZGluZ19zdGF0ZSAqcGVuZGluZyA9ICZzdGF0ZS0+cGVuZGlu
ZzsKQEAgLTIwNywyNCArMjA0LDI3IEBAIHN0YXRpYyB2b2lkIG10a19yZG1hX2xheWVyX2NvbmZp
ZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAogCXVuc2lnbmVk
IGludCBjb247CiAKIAljb24gPSByZG1hX2ZtdF9jb252ZXJ0KHJkbWEsIGZtdCk7Ci0Jd3JpdGVs
X3JlbGF4ZWQoY29uLCBjb21wLT5yZWdzICsgRElTUF9SRE1BX01FTV9DT04pOworCW10a19kZHBf
d3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgY29uLCBjb21wLCBESVNQX1JETUFfTUVNX0NPTik7CiAK
IAlpZiAoZm10ID09IERSTV9GT1JNQVRfVVlWWSB8fCBmbXQgPT0gRFJNX0ZPUk1BVF9ZVVlWKSB7
Ci0JCXJkbWFfdXBkYXRlX2JpdHMoY29tcCwgRElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJ
CSBSRE1BX01BVFJJWF9FTkFCTEUsIFJETUFfTUFUUklYX0VOQUJMRSk7Ci0JCXJkbWFfdXBkYXRl
X2JpdHMoY29tcCwgRElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJCSBSRE1BX01BVFJJWF9J
TlRfTVRYX1NFTCwKLQkJCQkgUkRNQV9NQVRSSVhfSU5UX01UWF9CVDYwMV90b19SR0IpOworCQlt
dGtfZGRwX3dyaXRlX21hc2soY21kcV9wa3QsIFJETUFfTUFUUklYX0VOQUJMRSwgY29tcCwKKwkJ
CQkgICBESVNQX1JFR19SRE1BX1NJWkVfQ09OXzAsCisJCQkJICAgUkRNQV9NQVRSSVhfRU5BQkxF
KTsKKwkJbXRrX2RkcF93cml0ZV9tYXNrKGNtZHFfcGt0LCBSRE1BX01BVFJJWF9JTlRfTVRYX0JU
NjAxX3RvX1JHQiwKKwkJCQkgICBjb21wLCBESVNQX1JFR19SRE1BX1NJWkVfQ09OXzAsCisJCQkJ
ICAgUkRNQV9NQVRSSVhfSU5UX01UWF9TRUwpOwogCX0gZWxzZSB7Ci0JCXJkbWFfdXBkYXRlX2Jp
dHMoY29tcCwgRElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJCSBSRE1BX01BVFJJWF9FTkFC
TEUsIDApOworCQltdGtfZGRwX3dyaXRlX21hc2soY21kcV9wa3QsIDAsIGNvbXAsCisJCQkJICAg
RElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAorCQkJCSAgIFJETUFfTUFUUklYX0VOQUJMRSk7CiAJ
fQorCW10a19kZHBfd3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgYWRkciwgY29tcCwgRElTUF9SRE1B
X01FTV9TVEFSVF9BRERSKTsKKwltdGtfZGRwX3dyaXRlX3JlbGF4ZWQoY21kcV9wa3QsIHBpdGNo
LCBjb21wLCBESVNQX1JETUFfTUVNX1NSQ19QSVRDSCk7CisJbXRrX2RkcF93cml0ZShjbWRxX3Br
dCwgUkRNQV9NRU1fR01DLCBjb21wLAorCQkgICAgICBESVNQX1JETUFfTUVNX0dNQ19TRVRUSU5H
XzApOworCW10a19kZHBfd3JpdGVfbWFzayhjbWRxX3BrdCwgUkRNQV9NT0RFX01FTU9SWSwgY29t
cCwKKwkJCSAgIERJU1BfUkVHX1JETUFfR0xPQkFMX0NPTiwgUkRNQV9NT0RFX01FTU9SWSk7CiAK
LQl3cml0ZWxfcmVsYXhlZChhZGRyLCBjb21wLT5yZWdzICsgRElTUF9SRE1BX01FTV9TVEFSVF9B
RERSKTsKLQl3cml0ZWxfcmVsYXhlZChwaXRjaCwgY29tcC0+cmVncyArIERJU1BfUkRNQV9NRU1f
U1JDX1BJVENIKTsKLQl3cml0ZWwoUkRNQV9NRU1fR01DLCBjb21wLT5yZWdzICsgRElTUF9SRE1B
X01FTV9HTUNfU0VUVElOR18wKTsKLQlyZG1hX3VwZGF0ZV9iaXRzKGNvbXAsIERJU1BfUkVHX1JE
TUFfR0xPQkFMX0NPTiwKLQkJCSBSRE1BX01PREVfTUVNT1JZLCBSRE1BX01PREVfTUVNT1JZKTsK
IH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBtdGtfZGRwX2NvbXBfZnVuY3MgbXRrX2Rpc3BfcmRt
YV9mdW5jcyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJt
X2RkcF9jb21wLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5j
CmluZGV4IDhmZWE5ODU3OGJjOC4uNzY0MTZjMWNiYjI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9t
ZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmMKQEAgLTEzLDYgKzEzLDcgQEAKICNpbmNsdWRlIDxs
aW51eC9vZl9wbGF0Zm9ybS5oPgogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgog
I2luY2x1ZGUgPGRybS9kcm1QLmg+CisjaW5jbHVkZSA8bGludXgvc29jL21lZGlhdGVrL210ay1j
bWRxLmg+CiAjaW5jbHVkZSAibXRrX2RybV9kcnYuaCIKICNpbmNsdWRlICJtdGtfZHJtX3BsYW5l
LmgiCiAjaW5jbHVkZSAibXRrX2RybV9kZHBfY29tcC5oIgpAQCAtNzYsMzYgKzc3LDc2IEBACiAj
ZGVmaW5lIERJVEhFUl9BRERfTFNISUZUX0coeCkJCQkoKCh4KSAmIDB4NykgPDwgNCkKICNkZWZp
bmUgRElUSEVSX0FERF9SU0hJRlRfRyh4KQkJCSgoKHgpICYgMHg3KSA8PCAwKQogCit2b2lkIG10
a19kZHBfd3JpdGUoc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCwgdW5zaWduZWQgaW50IHZhbHVl
LAorCQkgICBzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgb2Zmc2V0KQor
eworCWlmIChJU19FTkFCTEVEKENPTkZJR19NVEtfQ01EUSkgJiYgY21kcV9wa3QpCisJCWNtZHFf
cGt0X3dyaXRlKGNtZHFfcGt0LCBjb21wLT5zdWJzeXMsCisJCQkgICAgICAgY29tcC0+cmVnc19w
YSArIG9mZnNldCwgdmFsdWUpOworCWVsc2UKKwkJd3JpdGVsKHZhbHVlLCBjb21wLT5yZWdzICsg
b2Zmc2V0KTsKK30KKwordm9pZCBtdGtfZGRwX3dyaXRlX3JlbGF4ZWQoc3RydWN0IGNtZHFfcGt0
ICpjbWRxX3BrdCwgdW5zaWduZWQgaW50IHZhbHVlLAorCQkJICAgc3RydWN0IG10a19kZHBfY29t
cCAqY29tcCwKKwkJCSAgIHVuc2lnbmVkIGludCBvZmZzZXQpCit7CisJaWYgKElTX0VOQUJMRUQo
Q09ORklHX01US19DTURRKSAmJiBjbWRxX3BrdCkKKwkJY21kcV9wa3Rfd3JpdGUoY21kcV9wa3Qs
IGNvbXAtPnN1YnN5cywKKwkJCSAgICAgICBjb21wLT5yZWdzX3BhICsgb2Zmc2V0LCB2YWx1ZSk7
CisJZWxzZQorCQl3cml0ZWxfcmVsYXhlZCh2YWx1ZSwgY29tcC0+cmVncyArIG9mZnNldCk7Cit9
CisKK3ZvaWQgbXRrX2RkcF93cml0ZV9tYXNrKHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QsCisJ
CQl1bnNpZ25lZCBpbnQgdmFsdWUsCisJCQlzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAorCQkJ
dW5zaWduZWQgaW50IG9mZnNldCwKKwkJCXVuc2lnbmVkIGludCBtYXNrKQoreworCWlmIChJU19F
TkFCTEVEKENPTkZJR19NVEtfQ01EUSkgJiYgY21kcV9wa3QpIHsKKwkJY21kcV9wa3Rfd3JpdGVf
bWFzayhjbWRxX3BrdCwgY29tcC0+c3Vic3lzLAorCQkJCSAgICBjb21wLT5yZWdzX3BhICsgb2Zm
c2V0LCB2YWx1ZSwgbWFzayk7CisJfSBlbHNlIHsKKwkJdTMyIHRtcCA9IHJlYWRsKGNvbXAtPnJl
Z3MgKyBvZmZzZXQpOworCisJCXRtcCA9ICh0bXAgJiB+bWFzaykgfCAodmFsdWUgJiBtYXNrKTsK
KwkJd3JpdGVsKHRtcCwgY29tcC0+cmVncyArIG9mZnNldCk7CisJfQorfQorCiB2b2lkIG10a19k
aXRoZXJfc2V0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBicGMsCi0J
CSAgICB1bnNpZ25lZCBpbnQgQ0ZHKQorCQkgICAgdW5zaWduZWQgaW50IENGRywgc3RydWN0IGNt
ZHFfcGt0ICpjbWRxX3BrdCkKIHsKIAkvKiBJZiBicGMgZXF1YWwgdG8gMCwgdGhlIGRpdGhlcmlu
ZyBmdW5jdGlvbiBkaWRuJ3QgYmUgZW5hYmxlZCAqLwogCWlmIChicGMgPT0gMCkKIAkJcmV0dXJu
OwogCiAJaWYgKGJwYyA+PSBNVEtfTUlOX0JQQykgewotCQl3cml0ZWwoMCwgY29tcC0+cmVncyAr
IERJU1BfRElUSEVSXzUpOwotCQl3cml0ZWwoMCwgY29tcC0+cmVncyArIERJU1BfRElUSEVSXzcp
OwotCQl3cml0ZWwoRElUSEVSX0xTQl9FUlJfU0hJRlRfUihNVEtfTUFYX0JQQyAtIGJwYykgfAot
CQkgICAgICAgRElUSEVSX0FERF9MU0hJRlRfUihNVEtfTUFYX0JQQyAtIGJwYykgfAotCQkgICAg
ICAgRElUSEVSX05FV19CSVRfTU9ERSwKLQkJICAgICAgIGNvbXAtPnJlZ3MgKyBESVNQX0RJVEhF
Ul8xNSk7Ci0JCXdyaXRlbChESVRIRVJfTFNCX0VSUl9TSElGVF9CKE1US19NQVhfQlBDIC0gYnBj
KSB8Ci0JCSAgICAgICBESVRIRVJfQUREX0xTSElGVF9CKE1US19NQVhfQlBDIC0gYnBjKSB8Ci0J
CSAgICAgICBESVRIRVJfTFNCX0VSUl9TSElGVF9HKE1US19NQVhfQlBDIC0gYnBjKSB8Ci0JCSAg
ICAgICBESVRIRVJfQUREX0xTSElGVF9HKE1US19NQVhfQlBDIC0gYnBjKSwKLQkJICAgICAgIGNv
bXAtPnJlZ3MgKyBESVNQX0RJVEhFUl8xNik7Ci0JCXdyaXRlbChESVNQX0RJVEhFUklORywgY29t
cC0+cmVncyArIENGRyk7CisJCW10a19kZHBfd3JpdGUoY21kcV9wa3QsIDAsIGNvbXAsIERJU1Bf
RElUSEVSXzUpOworCQltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCAwLCBjb21wLCBESVNQX0RJVEhF
Ul83KTsKKwkJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwKKwkJCSAgICAgIERJVEhFUl9MU0JfRVJS
X1NISUZUX1IoTVRLX01BWF9CUEMgLSBicGMpIHwKKwkJCSAgICAgIERJVEhFUl9BRERfTFNISUZU
X1IoTVRLX01BWF9CUEMgLSBicGMpIHwKKwkJCSAgICAgIERJVEhFUl9ORVdfQklUX01PREUsCisJ
CQkgICAgICBjb21wLCBESVNQX0RJVEhFUl8xNSk7CisJCW10a19kZHBfd3JpdGUoY21kcV9wa3Qs
CisJCQkgICAgICBESVRIRVJfTFNCX0VSUl9TSElGVF9CKE1US19NQVhfQlBDIC0gYnBjKSB8CisJ
CQkgICAgICBESVRIRVJfQUREX0xTSElGVF9CKE1US19NQVhfQlBDIC0gYnBjKSB8CisJCQkgICAg
ICBESVRIRVJfTFNCX0VSUl9TSElGVF9HKE1US19NQVhfQlBDIC0gYnBjKSB8CisJCQkgICAgICBE
SVRIRVJfQUREX0xTSElGVF9HKE1US19NQVhfQlBDIC0gYnBjKSwKKwkJCSAgICAgIGNvbXAsIERJ
U1BfRElUSEVSXzE2KTsKKwkJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgRElTUF9ESVRIRVJJTkcs
IGNvbXAsIENGRyk7CiAJfQogfQogCiBzdGF0aWMgdm9pZCBtdGtfb2RfY29uZmlnKHN0cnVjdCBt
dGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCB3LAogCQkJICB1bnNpZ25lZCBpbnQgaCwg
dW5zaWduZWQgaW50IHZyZWZyZXNoLAotCQkJICB1bnNpZ25lZCBpbnQgYnBjKQorCQkJICB1bnNp
Z25lZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewotCXdyaXRlbCh3IDw8
IDE2IHwgaCwgY29tcC0+cmVncyArIERJU1BfT0RfU0laRSk7Ci0Jd3JpdGVsKE9EX1JFTEFZTU9E
RSwgY29tcC0+cmVncyArIERJU1BfT0RfQ0ZHKTsKLQltdGtfZGl0aGVyX3NldChjb21wLCBicGMs
IERJU1BfT0RfQ0ZHKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCB3IDw8IDE2IHwgaCwgY29t
cCwgRElTUF9PRF9TSVpFKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBPRF9SRUxBWU1PREUs
IGNvbXAsIERJU1BfT0RfQ0ZHKTsKKwltdGtfZGl0aGVyX3NldChjb21wLCBicGMsIERJU1BfT0Rf
Q0ZHLCBjbWRxX3BrdCk7CiB9CiAKIHN0YXRpYyB2b2lkIG10a19vZF9zdGFydChzdHJ1Y3QgbXRr
X2RkcF9jb21wICpjb21wKQpAQCAtMTIwLDkgKzE2MSw5IEBAIHN0YXRpYyB2b2lkIG10a191Zm9l
X3N0YXJ0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCiAKIHN0YXRpYyB2b2lkIG10a19hYWxf
Y29uZmlnKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCB3LAogCQkJICAg
dW5zaWduZWQgaW50IGgsIHVuc2lnbmVkIGludCB2cmVmcmVzaCwKLQkJCSAgIHVuc2lnbmVkIGlu
dCBicGMpCisJCQkgICB1bnNpZ25lZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0
KQogewotCXdyaXRlbChoIDw8IDE2IHwgdywgY29tcC0+cmVncyArIERJU1BfQUFMX1NJWkUpOwor
CW10a19kZHBfd3JpdGUoY21kcV9wa3QsIGggPDwgMTYgfCB3LCBjb21wLCBESVNQX0FBTF9TSVpF
KTsKIH0KIAogc3RhdGljIHZvaWQgbXRrX2FhbF9zdGFydChzdHJ1Y3QgbXRrX2RkcF9jb21wICpj
b21wKQpAQCAtMTM3LDEwICsxNzgsMTAgQEAgc3RhdGljIHZvaWQgbXRrX2FhbF9zdG9wKHN0cnVj
dCBtdGtfZGRwX2NvbXAgKmNvbXApCiAKIHN0YXRpYyB2b2lkIG10a19jY29ycl9jb25maWcoc3Ry
dWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHcsCiAJCQkgICAgIHVuc2lnbmVk
IGludCBoLCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCi0JCQkgICAgIHVuc2lnbmVkIGludCBicGMp
CisJCQkgICAgIHVuc2lnbmVkIGludCBicGMsIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7
Ci0Jd3JpdGVsKGggPDwgMTYgfCB3LCBjb21wLT5yZWdzICsgRElTUF9DQ09SUl9TSVpFKTsKLQl3
cml0ZWwoQ0NPUlJfUkVMQVlfTU9ERSwgY29tcC0+cmVncyArIERJU1BfQ0NPUlJfQ0ZHKTsKKwlt
dGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBoIDw8IDE2IHwgdywgY29tcCwgRElTUF9DQ09SUl9TSVpF
KTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBDQ09SUl9SRUxBWV9NT0RFLCBjb21wLCBESVNQ
X0NDT1JSX0NGRyk7CiB9CiAKIHN0YXRpYyB2b2lkIG10a19jY29ycl9zdGFydChzdHJ1Y3QgbXRr
X2RkcF9jb21wICpjb21wKQpAQCAtMTU1LDEwICsxOTYsMTAgQEAgc3RhdGljIHZvaWQgbXRrX2Nj
b3JyX3N0b3Aoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIAogc3RhdGljIHZvaWQgbXRrX2Rp
dGhlcl9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHcsCiAJ
CQkgICAgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQgaW50IHZyZWZyZXNoLAotCQkJICAgICAg
dW5zaWduZWQgaW50IGJwYykKKwkJCSAgICAgIHVuc2lnbmVkIGludCBicGMsIHN0cnVjdCBjbWRx
X3BrdCAqY21kcV9wa3QpCiB7Ci0Jd3JpdGVsKGggPDwgMTYgfCB3LCBjb21wLT5yZWdzICsgRElT
UF9ESVRIRVJfU0laRSk7Ci0Jd3JpdGVsKERJVEhFUl9SRUxBWV9NT0RFLCBjb21wLT5yZWdzICsg
RElTUF9ESVRIRVJfQ0ZHKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBoIDw8IDE2IHwgdywg
Y29tcCwgRElTUF9ESVRIRVJfU0laRSk7CisJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgRElUSEVS
X1JFTEFZX01PREUsIGNvbXAsIERJU1BfRElUSEVSX0NGRyk7CiB9CiAKIHN0YXRpYyB2b2lkIG10
a19kaXRoZXJfc3RhcnQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKQEAgLTE3MywxMCArMjE0
LDEwIEBAIHN0YXRpYyB2b2lkIG10a19kaXRoZXJfc3RvcChzdHJ1Y3QgbXRrX2RkcF9jb21wICpj
b21wKQogCiBzdGF0aWMgdm9pZCBtdGtfZ2FtbWFfY29uZmlnKHN0cnVjdCBtdGtfZGRwX2NvbXAg
KmNvbXAsIHVuc2lnbmVkIGludCB3LAogCQkJICAgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQg
aW50IHZyZWZyZXNoLAotCQkJICAgICB1bnNpZ25lZCBpbnQgYnBjKQorCQkJICAgICB1bnNpZ25l
ZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewotCXdyaXRlbChoIDw8IDE2
IHwgdywgY29tcC0+cmVncyArIERJU1BfR0FNTUFfU0laRSk7Ci0JbXRrX2RpdGhlcl9zZXQoY29t
cCwgYnBjLCBESVNQX0dBTU1BX0NGRyk7CisJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgaCA8PCAx
NiB8IHcsIGNvbXAsIERJU1BfR0FNTUFfU0laRSk7CisJbXRrX2RpdGhlcl9zZXQoY29tcCwgYnBj
LCBESVNQX0dBTU1BX0NGRywgY21kcV9wa3QpOwogfQogCiBzdGF0aWMgdm9pZCBtdGtfZ2FtbWFf
c3RhcnQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKQEAgLTE5MCwyNCArMjMxLDI1IEBAIHN0
YXRpYyB2b2lkIG10a19nYW1tYV9zdG9wKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCiB9CiAK
IHN0YXRpYyB2b2lkIG10a19nYW1tYV9zZXQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwKLQkJ
CSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKKwkJCSAgc3RydWN0IGRybV9jcnRjX3N0
YXRlICpzdGF0ZSwKKwkJCSAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKLQl1bnNpZ25l
ZCBpbnQgaSwgcmVnOworCXVuc2lnbmVkIGludCBpOwogCXN0cnVjdCBkcm1fY29sb3JfbHV0ICps
dXQ7CiAJdm9pZCBfX2lvbWVtICpsdXRfYmFzZTsKIAl1MzIgd29yZDsKIAogCWlmIChzdGF0ZS0+
Z2FtbWFfbHV0KSB7Ci0JCXJlZyA9IHJlYWRsKGNvbXAtPnJlZ3MgKyBESVNQX0dBTU1BX0NGRyk7
Ci0JCXJlZyA9IHJlZyB8IEdBTU1BX0xVVF9FTjsKLQkJd3JpdGVsKHJlZywgY29tcC0+cmVncyAr
IERJU1BfR0FNTUFfQ0ZHKTsKKwkJbXRrX2RkcF93cml0ZV9tYXNrKGNtZHFfcGt0LCBHQU1NQV9M
VVRfRU4sIGNvbXAsCisJCQkJICAgRElTUF9HQU1NQV9DRkcsIEdBTU1BX0xVVF9FTik7CiAJCWx1
dF9iYXNlID0gY29tcC0+cmVncyArIERJU1BfR0FNTUFfTFVUOwogCQlsdXQgPSAoc3RydWN0IGRy
bV9jb2xvcl9sdXQgKilzdGF0ZS0+Z2FtbWFfbHV0LT5kYXRhOwogCQlmb3IgKGkgPSAwOyBpIDwg
TVRLX0xVVF9TSVpFOyBpKyspIHsKIAkJCXdvcmQgPSAoKChsdXRbaV0ucmVkID4+IDYpICYgTFVU
XzEwQklUX01BU0spIDw8IDIwKSArCiAJCQkJKCgobHV0W2ldLmdyZWVuID4+IDYpICYgTFVUXzEw
QklUX01BU0spIDw8IDEwKSArCiAJCQkJKChsdXRbaV0uYmx1ZSA+PiA2KSAmIExVVF8xMEJJVF9N
QVNLKTsKLQkJCXdyaXRlbCh3b3JkLCAobHV0X2Jhc2UgKyBpICogNCkpOworCQkJbXRrX2RkcF93
cml0ZShjbWRxX3BrdCwgd29yZCwgY29tcCwKKwkJCQkgICAgICAodW5zaWduZWQgaW50KShsdXRf
YmFzZSArIGkgKiA0KSk7CiAJCX0KIAl9CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
bWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5oIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kcm1fZGRwX2NvbXAuaAppbmRleCAyNjhkNDE2MDgxZGEuLjZiYmMzNWY5MjgxNSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fZGRwX2NvbXAuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5oCkBAIC02OSwyMSArNjks
MjYgQEAgZW51bSBtdGtfZGRwX2NvbXBfaWQgewogfTsKIAogc3RydWN0IG10a19kZHBfY29tcDsK
LQorc3RydWN0IGNtZHFfcGt0Owogc3RydWN0IG10a19kZHBfY29tcF9mdW5jcyB7CiAJdm9pZCAo
KmNvbmZpZykoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHcsCi0JCSAg
ICAgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQgaW50IHZyZWZyZXNoLCB1bnNpZ25lZCBpbnQg
YnBjKTsKKwkJICAgICAgIHVuc2lnbmVkIGludCBoLCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCisJ
CSAgICAgICB1bnNpZ25lZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KTsKIAl2
b2lkICgqc3RhcnQpKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApOwogCXZvaWQgKCpzdG9wKShz
dHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKIAl2b2lkICgqZW5hYmxlX3ZibGFuaykoc3RydWN0
IG10a19kZHBfY29tcCAqY29tcCwgc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIAl2b2lkICgqZGlz
YWJsZV92YmxhbmspKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApOwogCXVuc2lnbmVkIGludCAo
KmxheWVyX25yKShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKLQl2b2lkICgqbGF5ZXJfb24p
KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBpZHgpOwotCXZvaWQgKCps
YXllcl9vZmYpKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBpZHgpOwor
CXZvaWQgKCpsYXllcl9vbikoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50
IGlkeCwKKwkJCSBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KTsKKwl2b2lkICgqbGF5ZXJfb2Zm
KShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAorCQkJICBzdHJ1
Y3QgY21kcV9wa3QgKmNtZHFfcGt0KTsKIAl2b2lkICgqbGF5ZXJfY29uZmlnKShzdHJ1Y3QgbXRr
X2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAotCQkJICAgICBzdHJ1Y3QgbXRrX3Bs
YW5lX3N0YXRlICpzdGF0ZSk7CisJCQkgICAgIHN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRl
LAorCQkJICAgICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KTsKIAl2b2lkICgqZ2FtbWFfc2V0
KShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAotCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUg
KnN0YXRlKTsKKwkJCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSwKKwkJCSAgc3RydWN0
IGNtZHFfcGt0ICpjbWRxX3BrdCk7CiAJdm9pZCAoKmJnY2xyX2luX29uKShzdHJ1Y3QgbXRrX2Rk
cF9jb21wICpjb21wKTsKIAl2b2lkICgqYmdjbHJfaW5fb2ZmKShzdHJ1Y3QgbXRrX2RkcF9jb21w
ICpjb21wKTsKIH07CkBAIC05OCwxMCArMTAzLDExIEBAIHN0cnVjdCBtdGtfZGRwX2NvbXAgewog
CiBzdGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9jb21wX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9j
b21wICpjb21wLAogCQkJCSAgICAgICB1bnNpZ25lZCBpbnQgdywgdW5zaWduZWQgaW50IGgsCi0J
CQkJICAgICAgIHVuc2lnbmVkIGludCB2cmVmcmVzaCwgdW5zaWduZWQgaW50IGJwYykKKwkJCQkg
ICAgICAgdW5zaWduZWQgaW50IHZyZWZyZXNoLCB1bnNpZ25lZCBpbnQgYnBjLAorCQkJCSAgICAg
ICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCWlmIChjb21wLT5mdW5jcyAmJiBjb21w
LT5mdW5jcy0+Y29uZmlnKQotCQljb21wLT5mdW5jcy0+Y29uZmlnKGNvbXAsIHcsIGgsIHZyZWZy
ZXNoLCBicGMpOworCQljb21wLT5mdW5jcy0+Y29uZmlnKGNvbXAsIHcsIGgsIHZyZWZyZXNoLCBi
cGMsIGNtZHFfcGt0KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIG10a19kZHBfY29tcF9zdGFy
dChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQpAQCAtMTM4LDMyICsxNDQsMzYgQEAgc3RhdGlj
IGlubGluZSB1bnNpZ25lZCBpbnQgbXRrX2RkcF9jb21wX2xheWVyX25yKHN0cnVjdCBtdGtfZGRw
X2NvbXAgKmNvbXApCiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBtdGtfZGRwX2NvbXBfbGF5ZXJf
b24oc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwKLQkJCQkJIHVuc2lnbmVkIGludCBpZHgpCisJ
CQkJCSB1bnNpZ25lZCBpbnQgaWR4LAorCQkJCQkgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkK
IHsKIAlpZiAoY29tcC0+ZnVuY3MgJiYgY29tcC0+ZnVuY3MtPmxheWVyX29uKQotCQljb21wLT5m
dW5jcy0+bGF5ZXJfb24oY29tcCwgaWR4KTsKKwkJY29tcC0+ZnVuY3MtPmxheWVyX29uKGNvbXAs
IGlkeCwgY21kcV9wa3QpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9jb21wX2xh
eWVyX29mZihzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAotCQkJCQkgIHVuc2lnbmVkIGludCBp
ZHgpCisJCQkJCSAgdW5zaWduZWQgaW50IGlkeCwKKwkJCQkJICBzdHJ1Y3QgY21kcV9wa3QgKmNt
ZHFfcGt0KQogewogCWlmIChjb21wLT5mdW5jcyAmJiBjb21wLT5mdW5jcy0+bGF5ZXJfb2ZmKQot
CQljb21wLT5mdW5jcy0+bGF5ZXJfb2ZmKGNvbXAsIGlkeCk7CisJCWNvbXAtPmZ1bmNzLT5sYXll
cl9vZmYoY29tcCwgaWR4LCBjbWRxX3BrdCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBtdGtf
ZGRwX2NvbXBfbGF5ZXJfY29uZmlnKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsCiAJCQkJCSAg
ICAgdW5zaWduZWQgaW50IGlkeCwKLQkJCQkJICAgICBzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpz
dGF0ZSkKKwkJCQkJICAgICBzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpzdGF0ZSwKKwkJCQkJICAg
ICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCWlmIChjb21wLT5mdW5jcyAmJiBjb21w
LT5mdW5jcy0+bGF5ZXJfY29uZmlnKQotCQljb21wLT5mdW5jcy0+bGF5ZXJfY29uZmlnKGNvbXAs
IGlkeCwgc3RhdGUpOworCQljb21wLT5mdW5jcy0+bGF5ZXJfY29uZmlnKGNvbXAsIGlkeCwgc3Rh
dGUsIGNtZHFfcGt0KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIG10a19kZHBfZ2FtbWFfc2V0
KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsCi0JCQkJICAgICBzdHJ1Y3QgZHJtX2NydGNfc3Rh
dGUgKnN0YXRlKQorCQkJCSAgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSwKKwkJCQkg
ICAgIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7CiAJaWYgKGNvbXAtPmZ1bmNzICYmIGNv
bXAtPmZ1bmNzLT5nYW1tYV9zZXQpCi0JCWNvbXAtPmZ1bmNzLT5nYW1tYV9zZXQoY29tcCwgc3Rh
dGUpOworCQljb21wLT5mdW5jcy0+Z2FtbWFfc2V0KGNvbXAsIHN0YXRlLCBjbWRxX3BrdCk7CiB9
CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBtdGtfZGRwX2NvbXBfYmdjbHJfaW5fb24oc3RydWN0IG10
a19kZHBfY29tcCAqY29tcCkKQEAgLTE4Niw2ICsxOTYsMTMgQEAgaW50IG10a19kZHBfY29tcF9p
bml0KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGRldmljZV9ub2RlICpjb21wX25vZGUsCiBp
bnQgbXRrX2RkcF9jb21wX3JlZ2lzdGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sIHN0cnVjdCBt
dGtfZGRwX2NvbXAgKmNvbXApOwogdm9pZCBtdGtfZGRwX2NvbXBfdW5yZWdpc3RlcihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZHJtLCBzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKIHZvaWQgbXRrX2Rp
dGhlcl9zZXQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGJwYywKLQkJ
ICAgIHVuc2lnbmVkIGludCBDRkcpOwotCisJCSAgICB1bnNpZ25lZCBpbnQgQ0ZHLCBzdHJ1Y3Qg
Y21kcV9wa3QgKmNtZHFfcGt0KTsKK2VudW0gbXRrX2RkcF9jb21wX3R5cGUgbXRrX2RkcF9jb21w
X2dldF90eXBlKGVudW0gbXRrX2RkcF9jb21wX2lkIGNvbXBfaWQpOwordm9pZCBtdGtfZGRwX3dy
aXRlKHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QsIHVuc2lnbmVkIGludCB2YWx1ZSwKKwkJICAg
c3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IG9mZnNldCk7Cit2b2lkIG10
a19kZHBfd3JpdGVfcmVsYXhlZChzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0LCB1bnNpZ25lZCBp
bnQgdmFsdWUsCisJCQkgICBzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQg
b2Zmc2V0KTsKK3ZvaWQgbXRrX2RkcF93cml0ZV9tYXNrKHN0cnVjdCBjbWRxX3BrdCAqY21kcV9w
a3QsIHVuc2lnbmVkIGludCB2YWx1ZSwKKwkJCXN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVu
c2lnbmVkIGludCBvZmZzZXQsCisJCQl1bnNpZ25lZCBpbnQgbWFzayk7CiAjZW5kaWYgLyogTVRL
X0RSTV9ERFBfQ09NUF9IICovCi0tIAoyLjE4LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2RyaS1kZXZlbA==
