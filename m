Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2268914D5DC
	for <lists+dri-devel@lfdr.de>; Thu, 30 Jan 2020 05:48:43 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2B6AA6F8E8;
	Thu, 30 Jan 2020 04:48:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 568 seconds by postgrey-1.36 at gabe;
 Thu, 30 Jan 2020 04:48:38 UTC
Received: from elaine.keithp.com (home.keithp.com [63.227.221.253])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4DA3D6F8E8;
 Thu, 30 Jan 2020 04:48:38 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by elaine.keithp.com (Postfix) with ESMTP id 8E1C03F2A8FD;
 Wed, 29 Jan 2020 20:39:09 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=keithp.com; s=mail;
 t=1580359149; bh=nrcpn1UdssIdc/Xz3UfykbQPnMRoU4nI2rOww/buYkY=;
 h=From:To:Cc:Subject:Date:From;
 b=i6lu0w6jC/DB117YQZ9v7QgBgZ4X/sncItXVNfeBY1ujZPEPJJlmj6+zSBWTYe7my
 VDFUmUvYFfEfJBJfh54ljjaNCguJcmGQQKtJUC61GIJvzg/JpN9WxucsCFu3ESwd03
 KNBqJI3v1oOzeiubgfWp2cmtBgZueC4CVClIFrQDYwEvm0QBGNZSOqR0Uhbou/zlmt
 YXnG+VkujYjO4cw6FcOeWmCUxbWgfQLFXHp6+Fdvsr3Y/F1V7nn3LOLMMWd6XcdYTF
 1AQGM8n4HmQLswDhJ0wwhoBTbN06o0hTWRvTtU9yMTW+mOGpQF9vwawksCJPYJs8Fl
 OTAKJ+dcwjshg==
X-Virus-Scanned: Debian amavisd-new at keithp.com
Received: from elaine.keithp.com ([127.0.0.1])
 by localhost (elaine.keithp.com [127.0.0.1]) (amavisd-new, port 10024)
 with LMTP id Yco-bxCB-pPu; Wed, 29 Jan 2020 20:39:07 -0800 (PST)
Received: from keithp.com (koto.keithp.com [10.0.0.2])
 by elaine.keithp.com (Postfix) with ESMTPSA id 831773F2A8FB;
 Wed, 29 Jan 2020 20:39:07 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=keithp.com; s=mail;
 t=1580359147; bh=nrcpn1UdssIdc/Xz3UfykbQPnMRoU4nI2rOww/buYkY=;
 h=From:To:Cc:Subject:Date:From;
 b=JR3TmZRpPFzqVFqCZE1l6ip5cd/emLOyC03IfibBFHSUIDSVJTFcWv1Db0WlzZtLD
 t9UlYFf7N0E7b/zjO3hX98WtLkw0k1+Bp9h0X8k7YU6b4aaOz1fDtmOb8NbfwRNBY8
 thSAeTcxTSKujndG0vcQmHWx9gyo1V6yX3VmZvasM+RC8Q5rBuVVza2/mCR1ZxJEIB
 LyQpevLWCdZXP7ZyNfNRI4EAjKSHq5CvCh+aruDhF7ZElyMnhlY3mrsIQlvVncB9VM
 0y4qArPSYl8d+5kdzSN9z9JCOP0GSOwCaxXLus4bOD/CYz94cF9LPwGCdXJQaeih45
 tzPjKYhRlW8GQ==
Received: by keithp.com (Postfix, from userid 1000)
 id 2312F1582162; Wed, 29 Jan 2020 20:39:07 -0800 (PST)
From: Keith Packard <keithp@keithp.com>
To: mesa-dev@lists.freedesktop.org
Subject: [PATCH] vulkan: Add VK_GOOGLE_display_timing extension (x11+display,
 anv+radv) [v8]
Date: Wed, 29 Jan 2020 20:39:01 -0800
Message-Id: <20200130043901.571143-1-keithp@keithp.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Keith Packard <keithp@keithp.com>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIHN1cHBvcnQgZm9yIHRoZSBWS19HT09HTEVfZGlzcGxheSB0aW1pbmcgZXh0ZW5z
aW9uLCB3aGljaApwcm92aWRlcyB0d28gdGhpbmdzOgoKIDEpIERldGFpbGVkIGluZm9ybWF0aW9u
IGFib3V0IHdoZW4gZnJhbWVzIGFyZSBkaXNwbGF5ZWQsIGluY2x1ZGluZwogICAgc2xhY2sgdGlt
ZSBiZXR3ZWVuIEdQVSBleGVjdXRpb24gYW5kIGRpc3BsYXkgZnJhbWUuCgogMikgQWJzb2x1dGUg
dGltZSBjb250cm9sIG92ZXIgc3dhcGNoYWluIHF1ZXVlIHByb2Nlc3NpbmcuIFRoaXMgYWxsb3dz
CiAgICB0aGUgYXBwbGljYXRpb24gdG8gcmVxdWVzdCBmcmFtZXMgYmUgZGlzcGxheWVkIGF0IHNw
ZWNpZmljCiAgICBhYnNvbHV0ZSB0aW1lcywgdXNpbmcgdGhlIHNhbWUgdGltZWJhc2UgYXMgdGhh
dCBwcm92aWRlZCBpbiB2YmxhbmsKICAgIGV2ZW50cy4KClN1cHBvcnQgZm9yIHRoaXMgZXh0ZW5z
aW9uIGhhcyBiZWVuIGltcGxlbWVudGVkIGZvciB0aGUgeDExIGFuZApkaXNwbGF5IGJhY2tlbmRz
OyBhZGRpbmcgc3VwcG9ydCB0byBvdGhlciBiYWNrZW5kcyBzaG91bGQgYmUKcmVhc29uYWJsZSBz
dHJhaWdodGZvcndhcmQgZm9yIG9uZSBmYW1pbGlhciB3aXRoIHRob3NlIHN5c3RlbXMgYW5kCnNo
b3VsZCBub3QgcmVxdWlyZSBhbnkgYWRkaXRpb25hbCBkZXZpY2Utc3BlY2lmaWMgY29kZS4KCnYy
OgoJQWRqdXN0IEdPT0dMRV9kaXNwbGF5X3RpbWluZyBlYXJsaWVzdCB2YWx1ZS4gIFRoZQoJZWFy
bGllc3RQcmVzZW50VGltZSBmb3IgYW4gaW1hZ2UgY2Fubm90IGJlIGJlZm9yZSB0aGUgcHJldmlv
dXMKCWltYWdlIHdhcyBkaXNwbGF5ZWQsIG9yIGV2ZW4gYSBmcmFtZSBsYXRlciAoaW4gRklGTyBt
b2RlKS4KCglNYWtlIEdPT0dMRV9kaXNwbGF5X3RpbWluZyB1c2UgcmVuZGVyIGNvbXBsZXRlZCB0
aW1lLiAgU3dpdGNoCglmcm9tIFZLX1BJUEVMSU5FX1RPUF9PRl9QSVBFX0JJVCB0bwoJVktfUElQ
RUxJTkVfU1RBR0VfQUxMX0NPTU1BTkRTX0JJVCBzbyB0aGF0IHRoZSB0aW1lIHJlcG9ydGVkCgl0
byBhcHBsaWNhdGlvbnMgYXMgdGhlIGVuZCBvZiByZW5kZXJpbmcgcmVmbGVjdHMgdGhlIGxhdGVz
dAoJcG9zc2libGUgdmFsdWUgdG8gZW5zdXJlIHRoYXQgYXBwbGljYXRpb25zIGRvbid0IHVuZGVy
ZXN0aW1hdGUKCXRoZSBhbW91bnQgb2Ygd29yayBkb25lIGluIHRoZSBmcmFtZS4KCnYzOgoJQWRv
cHQgSmFzb24gRWtzdHJhbmQncyBjb2RpbmcgY29udmVudGlvbnMuICBEZWNsYXJlIHZhcmlhYmxl
cwoJYXQgZmlyc3QgdXNlLCBlbGltaW5hdGUgZXh0cmEgd2hpdGVzcGFjZSBiZXR3ZWVuIHR5cGVz
IGFuZAoJbmFtZXMuIFdyYXAgbGluZXMgdG8gODAgY29sdW1ucy4KCiAgICAgICAgU3VnZ2VzdGVk
LWJ5OiBKYXNvbiBFa3N0cmFuZCA8amFzb24uZWtzdHJhbmRAaW50ZWwuY29tPgoKdjQ6CglBZGFw
dCB0byBjaGFuZ2VzIGluIE1FU0FfcXVlcnlfdGltZXN0YW1wIGV4dGVuc2lvbgoKdjU6CglTcXVh
c2ggY29yZSBiaXRzIGFuZCBhbnYvcmFkdiB3cmFwcGVycyBpbnRvIGEgc2luZ2xlIHBhdGNoCgog
ICAgICAgIFN1Z2dlc3RlZC1ieTogSmFzb24gRWtzdHJhbmQgPGphc29uLmVrc3RyYW5kQGludGVs
LmNvbT4KCnY2OgoJU3dpdGNoIGZyb20gTUVTQV9xdWVyeV90aW1lc3RhbXAgdG8gRVhUX2NhbGli
cmF0ZWRfdGltZXN0YW1wcwoKdjc6CglFbnN1cmUgd2UgdGFyZ2V0IGZyYW1lIG5vIGVhcmxpZXIg
dGhhbiBkZXNpcmVkLiBUaGlzIG1lYW5zCglyb3VuZGluZyB0aGUgdGFyZ2V0IGZyYW1lIHVwLCBy
YXRoZXIgdGhhbiBzZWxlY3RpbmcgdGhlCgluZWFyZXN0IG9uZS4KCglTdWdnZXN0ZWQtYnk6IE1p
Y2hlbCBEw6RuemVyIDxtaWNoZWxAZGFlbnplci5uZXQ+Cgp2ODoKCVJlLW9yZGVyIGRpc3BsYXlf
dGltaW5nIGluIGFudl9leHRlbnNpb25zLnB5LiBUaGF0IGNvZGUKCW5vdyByZXF1aXJlcyBleHRl
bnNpb25zIGluIGFscGhhYmV0aWNhbCBvcmRlci4KCglSZW5hbWUgd3NpX21hcmtfdGltZSB0byB3
c2lfcHJlc2VudF9jb21wbGV0ZSB0byBtYWtlCgl0aGUgZnVuY3Rpb25hbGl0eSBjbGVhcmVyLgoK
U2lnbmVkLW9mZi1ieTogS2VpdGggUGFja2FyZCA8a2VpdGhwQGtlaXRocC5jb20+Ci0tLQogc3Jj
L2FtZC92dWxrYW4vcmFkdl9leHRlbnNpb25zLnB5ICAgfCAgIDEgKwogc3JjL2FtZC92dWxrYW4v
cmFkdl93c2kuYyAgICAgICAgICAgfCAgMzMgKysrCiBzcmMvaW50ZWwvdnVsa2FuL2Fudl9leHRl
bnNpb25zLnB5ICB8ICAgMSArCiBzcmMvaW50ZWwvdnVsa2FuL2Fudl93c2kuYyAgICAgICAgICB8
ICAzMSArKysKIHNyYy92dWxrYW4vd3NpL3dzaV9jb21tb24uYyAgICAgICAgIHwgMzAxICsrKysr
KysrKysrKysrKysrKysrKysrKysrKy0KIHNyYy92dWxrYW4vd3NpL3dzaV9jb21tb24uaCAgICAg
ICAgIHwgIDMyICsrKwogc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbl9kaXNwbGF5LmMgfCAxNjMg
KysrKysrKysrKysrKystCiBzcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uX3ByaXZhdGUuaCB8ICAz
NSArKysrCiBzcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uX3gxMS5jICAgICB8ICA3MSArKysrKyst
CiA5IGZpbGVzIGNoYW5nZWQsIDY1NiBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9zcmMvYW1kL3Z1bGthbi9yYWR2X2V4dGVuc2lvbnMucHkgYi9zcmMvYW1kL3Z1
bGthbi9yYWR2X2V4dGVuc2lvbnMucHkKaW5kZXggNTdhYTY3YmU2MTYuLmMyNTViNDk0MzdhIDEw
MDY0NAotLS0gYS9zcmMvYW1kL3Z1bGthbi9yYWR2X2V4dGVuc2lvbnMucHkKKysrIGIvc3JjL2Ft
ZC92dWxrYW4vcmFkdl9leHRlbnNpb25zLnB5CkBAIC0xNjYsNiArMTY2LDcgQEAgRVhURU5TSU9O
UyA9IFsKICAgICBFeHRlbnNpb24oJ1ZLX0FNRF9zaGFkZXJfdHJpbmFyeV9taW5tYXgnLCAgICAg
ICAgICAgICAxLCBUcnVlKSwKICAgICBFeHRlbnNpb24oJ1ZLX0dPT0dMRV9kZWNvcmF0ZV9zdHJp
bmcnLCAgICAgICAgICAgICAgICAxLCBUcnVlKSwKICAgICBFeHRlbnNpb24oJ1ZLX0dPT0dMRV9o
bHNsX2Z1bmN0aW9uYWxpdHkxJywgICAgICAgICAgICAxLCBUcnVlKSwKKyAgICBFeHRlbnNpb24o
J1ZLX0dPT0dMRV9kaXNwbGF5X3RpbWluZycsICAgICAgICAgICAgICAgICAxLCBUcnVlKSwKICAg
ICBFeHRlbnNpb24oJ1ZLX05WX2NvbXB1dGVfc2hhZGVyX2Rlcml2YXRpdmVzJywgICAgICAgICAx
LCAnZGV2aWNlLT5yYWRfaW5mby5jaGlwX2NsYXNzID49IEdGWDgnKSwKIF0KIApkaWZmIC0tZ2l0
IGEvc3JjL2FtZC92dWxrYW4vcmFkdl93c2kuYyBiL3NyYy9hbWQvdnVsa2FuL3JhZHZfd3NpLmMK
aW5kZXggYTJiMGFmYTQ4YzMuLmI3MjJlMjNmZjUzIDEwMDY0NAotLS0gYS9zcmMvYW1kL3Z1bGth
bi9yYWR2X3dzaS5jCisrKyBiL3NyYy9hbWQvdnVsa2FuL3JhZHZfd3NpLmMKQEAgLTMxNiwzICsz
MTYsMzYgQEAgVmtSZXN1bHQgcmFkdl9HZXRQaHlzaWNhbERldmljZVByZXNlbnRSZWN0YW5nbGVz
S0hSKAogCQkJCQkJIHN1cmZhY2UsCiAJCQkJCQkgcFJlY3RDb3VudCwgcFJlY3RzKTsKIH0KKwor
LyogVktfR09PR0xFX2Rpc3BsYXlfdGltaW5nICovCitWa1Jlc3VsdAorcmFkdl9HZXRSZWZyZXNo
Q3ljbGVEdXJhdGlvbkdPT0dMRSgKKwlWa0RldmljZSBfZGV2aWNlLAorCVZrU3dhcGNoYWluS0hS
IHN3YXBjaGFpbiwKKwlWa1JlZnJlc2hDeWNsZUR1cmF0aW9uR09PR0xFICpwRGlzcGxheVRpbWlu
Z1Byb3BlcnRpZXMpCit7CisJUkFEVl9GUk9NX0hBTkRMRShyYWR2X2RldmljZSwgZGV2aWNlLCBf
ZGV2aWNlKTsKKwlzdHJ1Y3QgcmFkdl9waHlzaWNhbF9kZXZpY2UgKnBkZXZpY2UgPSBkZXZpY2Ut
PnBoeXNpY2FsX2RldmljZTsKKworCXJldHVybiB3c2lfY29tbW9uX2dldF9yZWZyZXNoX2N5Y2xl
X2R1cmF0aW9uKCZwZGV2aWNlLT53c2lfZGV2aWNlLAorCQkJCQkJICAgICBfZGV2aWNlLAorCQkJ
CQkJICAgICBzd2FwY2hhaW4sCisJCQkJCQkgICAgIHBEaXNwbGF5VGltaW5nUHJvcGVydGllcyk7
Cit9CisKK1ZrUmVzdWx0CityYWR2X0dldFBhc3RQcmVzZW50YXRpb25UaW1pbmdHT09HTEUoVmtE
ZXZpY2UgX2RldmljZSwKKwkJCQkgICAgIFZrU3dhcGNoYWluS0hSIHN3YXBjaGFpbiwKKwkJCQkg
ICAgIHVpbnQzMl90ICpwUHJlc2VudGF0aW9uVGltaW5nQ291bnQsCisJCQkJICAgICBWa1Bhc3RQ
cmVzZW50YXRpb25UaW1pbmdHT09HTEUKKwkJCQkgICAgICpwUHJlc2VudGF0aW9uVGltaW5ncykK
K3sKKwlSQURWX0ZST01fSEFORExFKHJhZHZfZGV2aWNlLCBkZXZpY2UsIF9kZXZpY2UpOworCXN0
cnVjdCByYWR2X3BoeXNpY2FsX2RldmljZSAqcGRldmljZSA9IGRldmljZS0+cGh5c2ljYWxfZGV2
aWNlOworCisJcmV0dXJuIHdzaV9jb21tb25fZ2V0X3Bhc3RfcHJlc2VudGF0aW9uX3RpbWluZygm
cGRldmljZS0+d3NpX2RldmljZSwKKwkJCQkJCSAgICAgICBfZGV2aWNlLAorCQkJCQkJICAgICAg
IHN3YXBjaGFpbiwKKwkJCQkJCSAgICAgICBwUHJlc2VudGF0aW9uVGltaW5nQ291bnQsCisJCQkJ
CQkgICAgICAgcFByZXNlbnRhdGlvblRpbWluZ3MpOworfQpkaWZmIC0tZ2l0IGEvc3JjL2ludGVs
L3Z1bGthbi9hbnZfZXh0ZW5zaW9ucy5weSBiL3NyYy9pbnRlbC92dWxrYW4vYW52X2V4dGVuc2lv
bnMucHkKaW5kZXggMDM5MmIwZDI0NzQuLjI1NjgxNGE4NTg0IDEwMDY0NAotLS0gYS9zcmMvaW50
ZWwvdnVsa2FuL2Fudl9leHRlbnNpb25zLnB5CisrKyBiL3NyYy9pbnRlbC92dWxrYW4vYW52X2V4
dGVuc2lvbnMucHkKQEAgLTE3MCw2ICsxNzAsNyBAQCBFWFRFTlNJT05TID0gWwogICAgIEV4dGVu
c2lvbignVktfQU5EUk9JRF9leHRlcm5hbF9tZW1vcnlfYW5kcm9pZF9oYXJkd2FyZV9idWZmZXIn
LCAzLCAnQU5EUk9JRCcpLAogICAgIEV4dGVuc2lvbignVktfQU5EUk9JRF9uYXRpdmVfYnVmZmVy
JywgICAgICAgICAgICAgICAgIDcsICdBTkRST0lEJyksCiAgICAgRXh0ZW5zaW9uKCdWS19HT09H
TEVfZGVjb3JhdGVfc3RyaW5nJywgICAgICAgICAgICAgICAgMSwgVHJ1ZSksCisgICAgRXh0ZW5z
aW9uKCdWS19HT09HTEVfZGlzcGxheV90aW1pbmcnLCAgICAgICAgICAgICAgICAgMSwgVHJ1ZSks
CiAgICAgRXh0ZW5zaW9uKCdWS19HT09HTEVfaGxzbF9mdW5jdGlvbmFsaXR5MScsICAgICAgICAg
ICAgMSwgVHJ1ZSksCiAgICAgRXh0ZW5zaW9uKCdWS19JTlRFTF9wZXJmb3JtYW5jZV9xdWVyeScs
ICAgICAgICAgICAgICAgMSwgJ2RldmljZS0+cGVyZicpLAogICAgIEV4dGVuc2lvbignVktfSU5U
RUxfc2hhZGVyX2ludGVnZXJfZnVuY3Rpb25zMicsICAgICAgIDEsICdkZXZpY2UtPmluZm8uZ2Vu
ID49IDgnKSwKZGlmZiAtLWdpdCBhL3NyYy9pbnRlbC92dWxrYW4vYW52X3dzaS5jIGIvc3JjL2lu
dGVsL3Z1bGthbi9hbnZfd3NpLmMKaW5kZXggZGJiOGQ1MTJjYmQuLmM5MzQ0NTdmNjE5IDEwMDY0
NAotLS0gYS9zcmMvaW50ZWwvdnVsa2FuL2Fudl93c2kuYworKysgYi9zcmMvaW50ZWwvdnVsa2Fu
L2Fudl93c2kuYwpAQCAtMzI5LDMgKzMyOSwzNCBAQCBWa1Jlc3VsdCBhbnZfR2V0UGh5c2ljYWxE
ZXZpY2VQcmVzZW50UmVjdGFuZ2xlc0tIUigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgc3VyZmFjZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcFJlY3RDb3VudCwgcFJlY3RzKTsKIH0KKworLyogVktfR09PR0xFX2Rpc3Bs
YXlfdGltaW5nICovCitWa1Jlc3VsdAorYW52X0dldFJlZnJlc2hDeWNsZUR1cmF0aW9uR09PR0xF
KFZrRGV2aWNlIF9kZXZpY2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtT
d2FwY2hhaW5LSFIgc3dhcGNoYWluLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IFZrUmVmcmVzaEN5Y2xlRHVyYXRpb25HT09HTEUKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAqcERpc3BsYXlUaW1pbmdQcm9wZXJ0aWVzKQoreworICAgQU5WX0ZST01fSEFORExF
KGFudl9kZXZpY2UsIGRldmljZSwgX2RldmljZSk7CisKKyAgIHJldHVybiB3c2lfY29tbW9uX2dl
dF9yZWZyZXNoX2N5Y2xlX2R1cmF0aW9uKCZkZXZpY2UtPnBoeXNpY2FsLT53c2lfZGV2aWNlLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RldmljZSwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YXBjaGFp
biwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBEaXNw
bGF5VGltaW5nUHJvcGVydGllcyk7Cit9CisKK1ZrUmVzdWx0CithbnZfR2V0UGFzdFByZXNlbnRh
dGlvblRpbWluZ0dPT0dMRShWa0RldmljZSBfZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVmtTd2FwY2hhaW5LSFIgc3dhcGNoYWluLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgKnBQcmVzZW50YXRpb25UaW1pbmdDb3VudCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZrUGFzdFByZXNlbnRhdGlvblRp
bWluZ0dPT0dMRQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKnBQcmVzZW50
YXRpb25UaW1pbmdzKQoreworICAgQU5WX0ZST01fSEFORExFKGFudl9kZXZpY2UsIGRldmljZSwg
X2RldmljZSk7CisKKyAgIHJldHVybiB3c2lfY29tbW9uX2dldF9wYXN0X3ByZXNlbnRhdGlvbl90
aW1pbmcoJmRldmljZS0+cGh5c2ljYWwtPndzaV9kZXZpY2UsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9kZXZpY2UsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3YXBjaGFpbiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcFByZXNlbnRhdGlvblRpbWlu
Z0NvdW50LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBwUHJlc2VudGF0aW9uVGltaW5ncyk7Cit9CmRpZmYgLS1naXQgYS9zcmMvdnVsa2FuL3dzaS93
c2lfY29tbW9uLmMgYi9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uLmMKaW5kZXggMGFkZjU0ZWFi
OGYuLmY0NmJmZTExZWMyIDEwMDY0NAotLS0gYS9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uLmMK
KysrIGIvc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbi5jCkBAIC0zMiw2ICszMiw3IEBACiAjaW5j
bHVkZSA8eGY4NmRybS5oPgogI2luY2x1ZGUgPHN0ZGxpYi5oPgogI2luY2x1ZGUgPHN0ZGlvLmg+
CisjaW5jbHVkZSA8bWF0aC5oPgogCiBWa1Jlc3VsdAogd3NpX2RldmljZV9pbml0KHN0cnVjdCB3
c2lfZGV2aWNlICp3c2ksCkBAIC01NCw2ICs1NSw3IEBAIHdzaV9kZXZpY2VfaW5pdChzdHJ1Y3Qg
d3NpX2RldmljZSAqd3NpLAogICAgV1NJX0dFVF9DQihHZXRQaHlzaWNhbERldmljZVByb3BlcnRp
ZXMyKTsKICAgIFdTSV9HRVRfQ0IoR2V0UGh5c2ljYWxEZXZpY2VNZW1vcnlQcm9wZXJ0aWVzKTsK
ICAgIFdTSV9HRVRfQ0IoR2V0UGh5c2ljYWxEZXZpY2VRdWV1ZUZhbWlseVByb3BlcnRpZXMpOwor
ICAgV1NJX0dFVF9DQihHZXRQaHlzaWNhbERldmljZVByb3BlcnRpZXMpOwogI3VuZGVmIFdTSV9H
RVRfQ0IKIAogICAgd3NpLT5wY2lfYnVzX2luZm8uc1R5cGUgPQpAQCAtNzAsNiArNzIsMTAgQEAg
d3NpX2RldmljZV9pbml0KHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCiAgICBHZXRQaHlzaWNhbERl
dmljZU1lbW9yeVByb3BlcnRpZXMocGRldmljZSwgJndzaS0+bWVtb3J5X3Byb3BzKTsKICAgIEdl
dFBoeXNpY2FsRGV2aWNlUXVldWVGYW1pbHlQcm9wZXJ0aWVzKHBkZXZpY2UsICZ3c2ktPnF1ZXVl
X2ZhbWlseV9jb3VudCwgTlVMTCk7CiAKKyAgIFZrUGh5c2ljYWxEZXZpY2VQcm9wZXJ0aWVzIHBy
b3BlcnRpZXM7CisgICBHZXRQaHlzaWNhbERldmljZVByb3BlcnRpZXMocGRldmljZSwgJnByb3Bl
cnRpZXMpOworICAgd3NpLT50aW1lc3RhbXBfcGVyaW9kID0gcHJvcGVydGllcy5saW1pdHMudGlt
ZXN0YW1wUGVyaW9kOworCiAjZGVmaW5lIFdTSV9HRVRfQ0IoZnVuYykgXAogICAgd3NpLT5mdW5j
ID0gKFBGTl92ayMjZnVuYylwcm9jX2FkZHIocGRldmljZSwgInZrIiAjZnVuYykKICAgIFdTSV9H
RVRfQ0IoQWxsb2NhdGVNZW1vcnkpOwpAQCAtNzgsMTQgKzg0LDE4IEBAIHdzaV9kZXZpY2VfaW5p
dChzdHJ1Y3Qgd3NpX2RldmljZSAqd3NpLAogICAgV1NJX0dFVF9DQihCaW5kSW1hZ2VNZW1vcnkp
OwogICAgV1NJX0dFVF9DQihCZWdpbkNvbW1hbmRCdWZmZXIpOwogICAgV1NJX0dFVF9DQihDbWRD
b3B5SW1hZ2VUb0J1ZmZlcik7CisgICBXU0lfR0VUX0NCKENtZFJlc2V0UXVlcnlQb29sKTsKKyAg
IFdTSV9HRVRfQ0IoQ21kV3JpdGVUaW1lc3RhbXApOwogICAgV1NJX0dFVF9DQihDcmVhdGVCdWZm
ZXIpOwogICAgV1NJX0dFVF9DQihDcmVhdGVDb21tYW5kUG9vbCk7CiAgICBXU0lfR0VUX0NCKENy
ZWF0ZUZlbmNlKTsKICAgIFdTSV9HRVRfQ0IoQ3JlYXRlSW1hZ2UpOworICAgV1NJX0dFVF9DQihD
cmVhdGVRdWVyeVBvb2wpOwogICAgV1NJX0dFVF9DQihEZXN0cm95QnVmZmVyKTsKICAgIFdTSV9H
RVRfQ0IoRGVzdHJveUNvbW1hbmRQb29sKTsKICAgIFdTSV9HRVRfQ0IoRGVzdHJveUZlbmNlKTsK
ICAgIFdTSV9HRVRfQ0IoRGVzdHJveUltYWdlKTsKKyAgIFdTSV9HRVRfQ0IoRGVzdHJveVF1ZXJ5
UG9vbCk7CiAgICBXU0lfR0VUX0NCKEVuZENvbW1hbmRCdWZmZXIpOwogICAgV1NJX0dFVF9DQihG
cmVlTWVtb3J5KTsKICAgIFdTSV9HRVRfQ0IoRnJlZUNvbW1hbmRCdWZmZXJzKTsKQEAgLTk0LDEx
ICsxMDQsMTUgQEAgd3NpX2RldmljZV9pbml0KHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCiAgICBX
U0lfR0VUX0NCKEdldEltYWdlTWVtb3J5UmVxdWlyZW1lbnRzKTsKICAgIFdTSV9HRVRfQ0IoR2V0
SW1hZ2VTdWJyZXNvdXJjZUxheW91dCk7CiAgICBXU0lfR0VUX0NCKEdldE1lbW9yeUZkS0hSKTsK
KyAgIFdTSV9HRVRfQ0IoR2V0UGh5c2ljYWxEZXZpY2VQcm9wZXJ0aWVzKTsKICAgIFdTSV9HRVRf
Q0IoR2V0UGh5c2ljYWxEZXZpY2VGb3JtYXRQcm9wZXJ0aWVzKTsKICAgIFdTSV9HRVRfQ0IoR2V0
UGh5c2ljYWxEZXZpY2VGb3JtYXRQcm9wZXJ0aWVzMktIUik7CiAgICBXU0lfR0VUX0NCKEdldFBo
eXNpY2FsRGV2aWNlSW1hZ2VGb3JtYXRQcm9wZXJ0aWVzMik7CisgICBXU0lfR0VUX0NCKEdldFBo
eXNpY2FsRGV2aWNlUXVldWVGYW1pbHlQcm9wZXJ0aWVzKTsKKyAgIFdTSV9HRVRfQ0IoR2V0UXVl
cnlQb29sUmVzdWx0cyk7CiAgICBXU0lfR0VUX0NCKFJlc2V0RmVuY2VzKTsKICAgIFdTSV9HRVRf
Q0IoUXVldWVTdWJtaXQpOworICAgV1NJX0dFVF9DQihHZXRDYWxpYnJhdGVkVGltZXN0YW1wc0VY
VCk7CiAgICBXU0lfR0VUX0NCKFdhaXRGb3JGZW5jZXMpOwogI3VuZGVmIFdTSV9HRVRfQ0IKIApA
QCAtMjEwLDYgKzIyNCw4IEBAIHdzaV9zd2FwY2hhaW5faW5pdChjb25zdCBzdHJ1Y3Qgd3NpX2Rl
dmljZSAqd3NpLAogICAgY2hhaW4tPmRldmljZSA9IGRldmljZTsKICAgIGNoYWluLT5hbGxvYyA9
ICpwQWxsb2NhdG9yOwogICAgY2hhaW4tPnVzZV9wcmltZV9ibGl0ID0gZmFsc2U7CisgICBjaGFp
bi0+dGltaW5nX2luc2VydCA9IDA7CisgICBjaGFpbi0+dGltaW5nX2NvdW50ID0gMDsKIAogICAg
Y2hhaW4tPmNtZF9wb29scyA9CiAgICAgICB2a196YWxsb2MocEFsbG9jYXRvciwgc2l6ZW9mKFZr
Q29tbWFuZFBvb2wpICogd3NpLT5xdWV1ZV9mYW1pbHlfY291bnQsIDgsCkBAIC0zNDAsNiArMzU2
LDYzIEBAIGFsaWduX3UzMih1aW50MzJfdCB2LCB1aW50MzJfdCBhKQogICAgcmV0dXJuICh2ICsg
YSAtIDEpICYgfihhIC0gMSk7CiB9CiAKK3N0YXRpYyBWa1Jlc3VsdAord3NpX2ltYWdlX2luaXRf
dGltZXN0YW1wKGNvbnN0IHN0cnVjdCB3c2lfc3dhcGNoYWluICpjaGFpbiwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3Qgd3NpX2ltYWdlICppbWFnZSkKK3sKKyAgIGNvbnN0IHN0cnVj
dCB3c2lfZGV2aWNlICp3c2kgPSBjaGFpbi0+d3NpOworICAgVmtSZXN1bHQgcmVzdWx0OworICAg
LyogU2V0IHVwIGNvbW1hbmQgYnVmZmVyIHRvIGdldCB0aW1lc3RhbXAgaW5mbyAqLworCisgICBy
ZXN1bHQgPSB3c2ktPkNyZWF0ZVF1ZXJ5UG9vbCgKKyAgICAgIGNoYWluLT5kZXZpY2UsCisgICAg
ICAmKGNvbnN0IFZrUXVlcnlQb29sQ3JlYXRlSW5mbykgeworICAgICAgICAgLnNUeXBlID0gVktf
U1RSVUNUVVJFX1RZUEVfUVVFUllfUE9PTF9DUkVBVEVfSU5GTywKKyAgICAgICAgICAgIC5xdWVy
eVR5cGUgPSBWS19RVUVSWV9UWVBFX1RJTUVTVEFNUCwKKyAgICAgICAgICAgIC5xdWVyeUNvdW50
ID0gMSwKKyAgICAgICAgICAgIH0sCisgICAgICBOVUxMLAorICAgICAgJmltYWdlLT5xdWVyeV9w
b29sKTsKKworICAgaWYgKHJlc3VsdCAhPSBWS19TVUNDRVNTKQorICAgICAgZ290byBmYWlsOwor
CisgICByZXN1bHQgPSB3c2ktPkFsbG9jYXRlQ29tbWFuZEJ1ZmZlcnMoCisgICAgICBjaGFpbi0+
ZGV2aWNlLAorICAgICAgJihjb25zdCBWa0NvbW1hbmRCdWZmZXJBbGxvY2F0ZUluZm8pIHsKKyAg
ICAgICAgIC5zVHlwZSA9IFZLX1NUUlVDVFVSRV9UWVBFX0NPTU1BTkRfQlVGRkVSX0FMTE9DQVRF
X0lORk8sCisgICAgICAgICAgICAucE5leHQgPSBOVUxMLAorICAgICAgICAgICAgLmNvbW1hbmRQ
b29sID0gY2hhaW4tPmNtZF9wb29sc1swXSwKKyAgICAgICAgICAgIC5sZXZlbCA9IFZLX0NPTU1B
TkRfQlVGRkVSX0xFVkVMX1BSSU1BUlksCisgICAgICAgICAgICAuY29tbWFuZEJ1ZmZlckNvdW50
ID0gMSwKKyAgICAgICAgICAgIH0sCisgICAgICAmaW1hZ2UtPnRpbWVzdGFtcF9idWZmZXIpOwor
ICAgaWYgKHJlc3VsdCAhPSBWS19TVUNDRVNTKQorICAgICAgZ290byBmYWlsOworCisgICB3c2kt
PkJlZ2luQ29tbWFuZEJ1ZmZlcigKKyAgICAgIGltYWdlLT50aW1lc3RhbXBfYnVmZmVyLAorICAg
ICAgJihWa0NvbW1hbmRCdWZmZXJCZWdpbkluZm8pIHsKKyAgICAgICAgIC5zVHlwZSA9IFZLX1NU
UlVDVFVSRV9UWVBFX0NPTU1BTkRfQlVGRkVSX0JFR0lOX0lORk8sCisgICAgICAgICAgICAuZmxh
Z3MgPSAwCisgICAgICAgICAgICB9KTsKKworICAgd3NpLT5DbWRSZXNldFF1ZXJ5UG9vbChpbWFn
ZS0+dGltZXN0YW1wX2J1ZmZlciwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2UtPnF1
ZXJ5X3Bvb2wsCisgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDEpOworCisgICB3c2ktPkNt
ZFdyaXRlVGltZXN0YW1wKGltYWdlLT50aW1lc3RhbXBfYnVmZmVyLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICBWS19QSVBFTElORV9TVEFHRV9BTExfQ09NTUFORFNfQklULAorICAgICAgICAg
ICAgICAgICAgICAgICAgICBpbWFnZS0+cXVlcnlfcG9vbCwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgMCk7CisKKyAgIHdzaS0+RW5kQ29tbWFuZEJ1ZmZlcihpbWFnZS0+dGltZXN0YW1wX2J1
ZmZlcik7CisKKyAgIHJldHVybiBWS19TVUNDRVNTOworZmFpbDoKKyAgIHJldHVybiByZXN1bHQ7
Cit9CisKIFZrUmVzdWx0CiB3c2lfY3JlYXRlX25hdGl2ZV9pbWFnZShjb25zdCBzdHJ1Y3Qgd3Np
X3N3YXBjaGFpbiAqY2hhaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBWa1N3YXBj
aGFpbkNyZWF0ZUluZm9LSFIgKnBDcmVhdGVJbmZvLApAQCAtNTgxLDYgKzY1NCwxMCBAQCB3c2lf
Y3JlYXRlX25hdGl2ZV9pbWFnZShjb25zdCBzdHJ1Y3Qgd3NpX3N3YXBjaGFpbiAqY2hhaW4sCiAg
ICBpZiAocmVzdWx0ICE9IFZLX1NVQ0NFU1MpCiAgICAgICBnb3RvIGZhaWw7CiAKKyAgIHJlc3Vs
dCA9IHdzaV9pbWFnZV9pbml0X3RpbWVzdGFtcChjaGFpbiwgaW1hZ2UpOworICAgaWYgKHJlc3Vs
dCAhPSBWS19TVUNDRVNTKQorICAgICAgZ290byBmYWlsOworCiAgICBpZiAobnVtX21vZGlmaWVy
X2xpc3RzID4gMCkgewogICAgICAgVmtJbWFnZURybUZvcm1hdE1vZGlmaWVyUHJvcGVydGllc0VY
VCBpbWFnZV9tb2RfcHJvcHMgPSB7CiAgICAgICAgICAuc1R5cGUgPSBWS19TVFJVQ1RVUkVfVFlQ
RV9JTUFHRV9EUk1fRk9STUFUX01PRElGSUVSX1BST1BFUlRJRVNfRVhULApAQCAtODM0LDYgKzkx
MSwxMCBAQCB3c2lfY3JlYXRlX3ByaW1lX2ltYWdlKGNvbnN0IHN0cnVjdCB3c2lfc3dhcGNoYWlu
ICpjaGFpbiwKICAgICAgICAgIGdvdG8gZmFpbDsKICAgIH0KIAorICAgcmVzdWx0ID0gd3NpX2lt
YWdlX2luaXRfdGltZXN0YW1wKGNoYWluLCBpbWFnZSk7CisgICBpZiAocmVzdWx0ICE9IFZLX1NV
Q0NFU1MpCisgICAgICBnb3RvIGZhaWw7CisKICAgIGNvbnN0IFZrTWVtb3J5R2V0RmRJbmZvS0hS
IGxpbmVhcl9tZW1vcnlfZ2V0X2ZkX2luZm8gPSB7CiAgICAgICAuc1R5cGUgPSBWS19TVFJVQ1RV
UkVfVFlQRV9NRU1PUllfR0VUX0ZEX0lORk9fS0hSLAogICAgICAgLnBOZXh0ID0gTlVMTCwKQEAg
LTExMTQsNiArMTE5NSwxMjggQEAgd3NpX2NvbW1vbl9hY3F1aXJlX25leHRfaW1hZ2UyKGNvbnN0
IHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCiAgICByZXR1cm4gVktfU1VDQ0VTUzsKIH0KIAorc3Rh
dGljIHN0cnVjdCB3c2lfdGltaW5nICoKK3dzaV9nZXRfdGltaW5nKHN0cnVjdCB3c2lfc3dhcGNo
YWluICpjaGFpbiwgdWludDMyX3QgaSkKK3sKKyAgIHVpbnQzMl90IGogPSBXU0lfVElNSU5HX0hJ
U1RPUlkgKyBjaGFpbi0+dGltaW5nX2luc2VydCAtCisgICAgICBjaGFpbi0+dGltaW5nX2NvdW50
ICsgaTsKKworICAgaWYgKGogPj0gV1NJX1RJTUlOR19ISVNUT1JZKQorICAgICAgaiAtPSBXU0lf
VElNSU5HX0hJU1RPUlk7CisgICByZXR1cm4gJmNoYWluLT50aW1pbmdbal07Cit9CisKK3N0YXRp
YyBzdHJ1Y3Qgd3NpX3RpbWluZyAqCit3c2lfbmV4dF90aW1pbmcoc3RydWN0IHdzaV9zd2FwY2hh
aW4gKmNoYWluLCBpbnQgaW1hZ2VfaW5kZXgpCit7CisgICB1aW50MzJfdCBqID0gY2hhaW4tPnRp
bWluZ19pbnNlcnQ7CisgICArK2NoYWluLT50aW1pbmdfaW5zZXJ0OworICAgaWYgKGNoYWluLT50
aW1pbmdfaW5zZXJ0ID49IFdTSV9USU1JTkdfSElTVE9SWSkKKyAgICAgIGNoYWluLT50aW1pbmdf
aW5zZXJ0ID0gMDsKKyAgIGlmIChjaGFpbi0+dGltaW5nX2NvdW50IDwgV1NJX1RJTUlOR19ISVNU
T1JZKQorICAgICAgKytjaGFpbi0+dGltaW5nX2NvdW50OworICAgc3RydWN0IHdzaV90aW1pbmcg
KnRpbWluZyA9ICZjaGFpbi0+dGltaW5nW2pdOworICAgbWVtc2V0KHRpbWluZywgJ1wwJywgc2l6
ZW9mICgqdGltaW5nKSk7CisgICByZXR1cm4gdGltaW5nOworfQorCit2b2lkCit3c2lfcHJlc2Vu
dF9jb21wbGV0ZShzdHJ1Y3Qgd3NpX3N3YXBjaGFpbiAqc3dhcGNoYWluLAorICAgICAgICAgICAg
ICAgICAgICAgc3RydWN0IHdzaV9pbWFnZSAqaW1hZ2UsCisgICAgICAgICAgICAgICAgICAgICB1
aW50NjRfdCB1c3QsCisgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBtc2MpCit7CisgICBj
b25zdCBzdHJ1Y3Qgd3NpX2RldmljZSAqd3NpID0gc3dhcGNoYWluLT53c2k7CisgICBzdHJ1Y3Qg
d3NpX3RpbWluZyAqdGltaW5nID0gaW1hZ2UtPnRpbWluZzsKKworICAgaWYgKCF0aW1pbmcpCisg
ICAgICByZXR1cm47CisKKyAgIHVpbnQ2NF90IHJlbmRlcl90aW1lc3RhbXA7CisKKyAgIFZrUmVz
dWx0IHJlc3VsdCA9IHdzaS0+R2V0UXVlcnlQb29sUmVzdWx0cygKKyAgICAgIHN3YXBjaGFpbi0+
ZGV2aWNlLCBpbWFnZS0+cXVlcnlfcG9vbCwKKyAgICAgIDAsIDEsIHNpemVvZihyZW5kZXJfdGlt
ZXN0YW1wKSwgJnJlbmRlcl90aW1lc3RhbXAsCisgICAgICBzaXplb2YgKHVpbnQ2NF90KSwKKyAg
ICAgIFZLX1FVRVJZX1JFU1VMVF82NF9CSVR8VktfUVVFUllfUkVTVUxUX1dBSVRfQklUKTsKKyAg
IGlmIChyZXN1bHQgIT0gVktfU1VDQ0VTUykKKyAgICAgIHJldHVybjsKKworICAgc3RhdGljIGNv
bnN0IFZrQ2FsaWJyYXRlZFRpbWVzdGFtcEluZm9FWFQgICAgdGltZXN0YW1wSW5mb1syXSA9IHsK
KyAgICAgIHsKKyAgICAgICAgIC5zVHlwZSA9IFZLX1NUUlVDVFVSRV9UWVBFX0NBTElCUkFURURf
VElNRVNUQU1QX0lORk9fRVhULAorICAgICAgICAgLnBOZXh0ID0gTlVMTCwKKyAgICAgICAgIC50
aW1lRG9tYWluID0gVktfVElNRV9ET01BSU5fREVWSUNFX0VYVCwKKyAgICAgIH0sCisgICAgICB7
CisgICAgICAgICAuc1R5cGUgPSBWS19TVFJVQ1RVUkVfVFlQRV9DQUxJQlJBVEVEX1RJTUVTVEFN
UF9JTkZPX0VYVCwKKyAgICAgICAgIC5wTmV4dCA9IE5VTEwsCisgICAgICAgICAudGltZURvbWFp
biA9IFZLX1RJTUVfRE9NQUlOX0NMT0NLX01PTk9UT05JQ19FWFQsCisgICAgICB9LAorICAgfTsK
KworICAgdWludDY0X3QgICAgIHRpbWVzdGFtcHNbMl07CisgICB1aW50NjRfdCAgICAgbWF4RGV2
aWF0aW9uOworCisgICByZXN1bHQgPSB3c2ktPkdldENhbGlicmF0ZWRUaW1lc3RhbXBzRVhUKHN3
YXBjaGFpbi0+ZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAyLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1l
c3RhbXBJbmZvLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0
aW1lc3RhbXBzLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAm
bWF4RGV2aWF0aW9uKTsKKyAgIGlmIChyZXN1bHQgIT0gVktfU1VDQ0VTUykKKyAgICAgIHJldHVy
bjsKKworICAgdWludDY0X3QgY3VycmVudF9ncHVfdGltZXN0YW1wID0gdGltZXN0YW1wc1swXTsK
KyAgIHVpbnQ2NF90IGN1cnJlbnRfdGltZSA9IHRpbWVzdGFtcHNbMV07CisKKyAgIFZrUmVmcmVz
aEN5Y2xlRHVyYXRpb25HT09HTEUgZGlzcGxheV90aW1pbmdzOworICAgc3dhcGNoYWluLT5nZXRf
cmVmcmVzaF9jeWNsZV9kdXJhdGlvbihzd2FwY2hhaW4sICZkaXNwbGF5X3RpbWluZ3MpOworCisg
ICB1aW50NjRfdCByZWZyZXNoX2R1cmF0aW9uID0gZGlzcGxheV90aW1pbmdzLnJlZnJlc2hEdXJh
dGlvbjsKKworICAgLyogV2hlbiBkaWQgZHJhd2luZyBjb21wbGV0ZSAoaW4gbnNlYykgKi8KKwor
ICAgaW50NjRfdCBzaW5jZV9yZW5kZXIgPSAoaW50NjRfdCkgZmxvb3IgKChkb3VibGUpIChjdXJy
ZW50X2dwdV90aW1lc3RhbXAgLSByZW5kZXJfdGltZXN0YW1wKSAqCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRvdWJsZSkgd3NpLT50aW1lc3RhbXBfcGVyaW9k
ICsgMC41KTsKKyAgIHVpbnQ2NF90IHJlbmRlcl90aW1lID0gY3VycmVudF90aW1lIC0gc2luY2Vf
cmVuZGVyOworCisgICBpZiAocmVuZGVyX3RpbWUgPiB1c3QpCisgICAgICByZW5kZXJfdGltZSA9
IHVzdDsKKworICAgdWludDY0X3QgcmVuZGVyX2ZyYW1lcyA9ICh1c3QgLSByZW5kZXJfdGltZSkg
LyByZWZyZXNoX2R1cmF0aW9uOworCisgICB1aW50NjRfdCBlYXJsaWVzdF90aW1lID0gdXN0IC0g
cmVuZGVyX2ZyYW1lcyAqIHJlZnJlc2hfZHVyYXRpb247CisKKyAgIC8qIFVzZSB0aGUgcHJlc2Vu
dGF0aW9uIG1vZGUgdG8gZmlndXJlIG91dCB3aGVuIHRoZSBpbWFnZSBjb3VsZCBoYXZlIGJlZW4K
KyAgICAqIGRpc3BsYXllZC4gSXQgY291bGRuJ3QgaGF2ZSBiZWVuIGRpc3BsYXllZCBiZWZvcmUg
dGhlIHByZXZpb3VzIGltYWdlLCBzbworICAgICogdXNlIHRoYXQgYXMgYSBsb3dlciBib3VuZC4g
SWYgd2UncmUgaW4gRklGTyBtb2RlLCB0aGVuIGl0IGNvdWxkbid0IGhhdmUKKyAgICAqIGJlZW4g
ZGlzcGxheWVkIGJlZm9yZSBvbmUgZnJhbWUgKmFmdGVyKiB0aGUgcHJldmlvdXMgaW1hZ2UKKyAg
ICAqLworICAgdWludDY0X3QgcG9zc2libGVfZnJhbWUgPSBzd2FwY2hhaW4tPmZyYW1lX3VzdDsK
KworICAgc3dpdGNoIChzd2FwY2hhaW4tPnByZXNlbnRfbW9kZSkgeworICAgY2FzZSBWS19QUkVT
RU5UX01PREVfRklGT19LSFI6CisgICBjYXNlIFZLX1BSRVNFTlRfTU9ERV9GSUZPX1JFTEFYRURf
S0hSOgorICAgICAgcG9zc2libGVfZnJhbWUgKz0gcmVmcmVzaF9kdXJhdGlvbjsKKyAgICAgIGJy
ZWFrOworICAgZGVmYXVsdDoKKyAgICAgIGJyZWFrOworICAgfQorICAgaWYgKGVhcmxpZXN0X3Rp
bWUgPCBwb3NzaWJsZV9mcmFtZSkKKyAgICAgIGVhcmxpZXN0X3RpbWUgPSBwb3NzaWJsZV9mcmFt
ZTsKKworICAgaWYgKGVhcmxpZXN0X3RpbWUgPiB1c3QpCisgICAgICBlYXJsaWVzdF90aW1lID0g
dXN0OworCisgICB0aW1pbmctPnRpbWluZy5hY3R1YWxQcmVzZW50VGltZSA9IHVzdDsKKyAgIHRp
bWluZy0+dGltaW5nLmVhcmxpZXN0UHJlc2VudFRpbWUgPSBlYXJsaWVzdF90aW1lOworICAgdGlt
aW5nLT50aW1pbmcucHJlc2VudE1hcmdpbiA9IGVhcmxpZXN0X3RpbWUgLSByZW5kZXJfdGltZTsK
KyAgIHRpbWluZy0+Y29tcGxldGUgPSB0cnVlOworCisgICBzd2FwY2hhaW4tPmZyYW1lX21zYyA9
IG1zYzsKKyAgIHN3YXBjaGFpbi0+ZnJhbWVfdXN0ID0gdXN0OworfQorCiBWa1Jlc3VsdAogd3Np
X2NvbW1vbl9xdWV1ZV9wcmVzZW50KGNvbnN0IHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgVmtEZXZpY2UgZGV2aWNlLApAQCAtMTEyNSwxMSArMTMyOCwx
NCBAQCB3c2lfY29tbW9uX3F1ZXVlX3ByZXNlbnQoY29uc3Qgc3RydWN0IHdzaV9kZXZpY2UgKndz
aSwKIAogICAgY29uc3QgVmtQcmVzZW50UmVnaW9uc0tIUiAqcmVnaW9ucyA9CiAgICAgICB2a19m
aW5kX3N0cnVjdF9jb25zdChwUHJlc2VudEluZm8tPnBOZXh0LCBQUkVTRU5UX1JFR0lPTlNfS0hS
KTsKKyAgIGNvbnN0IFZrUHJlc2VudFRpbWVzSW5mb0dPT0dMRSAqcHJlc2VudF90aW1lc19pbmZv
ID0KKyAgICAgIHZrX2ZpbmRfc3RydWN0X2NvbnN0KHBQcmVzZW50SW5mby0+cE5leHQsIFBSRVNF
TlRfVElNRVNfSU5GT19HT09HTEUpOwogCiAgICBmb3IgKHVpbnQzMl90IGkgPSAwOyBpIDwgcFBy
ZXNlbnRJbmZvLT5zd2FwY2hhaW5Db3VudDsgaSsrKSB7CiAgICAgICBXU0lfRlJPTV9IQU5ETEUo
d3NpX3N3YXBjaGFpbiwgc3dhcGNoYWluLCBwUHJlc2VudEluZm8tPnBTd2FwY2hhaW5zW2ldKTsK
ICAgICAgIHVpbnQzMl90IGltYWdlX2luZGV4ID0gcFByZXNlbnRJbmZvLT5wSW1hZ2VJbmRpY2Vz
W2ldOwogICAgICAgVmtSZXN1bHQgcmVzdWx0OworICAgICAgc3RydWN0IHdzaV90aW1pbmcgKnRp
bWluZyA9IE5VTEw7CiAKICAgICAgIGlmIChzd2FwY2hhaW4tPmZlbmNlc1tpbWFnZV9pbmRleF0g
PT0gVktfTlVMTF9IQU5ETEUpIHsKICAgICAgICAgIGNvbnN0IFZrRmVuY2VDcmVhdGVJbmZvIGZl
bmNlX2luZm8gPSB7CkBAIC0xMTY0LDkgKzEzNzAsMTIgQEAgd3NpX2NvbW1vbl9xdWV1ZV9wcmVz
ZW50KGNvbnN0IHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCiAgICAgICAgICAubWVtb3J5ID0gaW1h
Z2UtPm1lbW9yeSwKICAgICAgIH07CiAKKyAgICAgIFZrQ29tbWFuZEJ1ZmZlciBzdWJtaXRfYnVm
ZmVyc1syXTsKICAgICAgIFZrU3VibWl0SW5mbyBzdWJtaXRfaW5mbyA9IHsKICAgICAgICAgIC5z
VHlwZSA9IFZLX1NUUlVDVFVSRV9UWVBFX1NVQk1JVF9JTkZPLAogICAgICAgICAgLnBOZXh0ID0g
Jm1lbV9zaWduYWwsCisgICAgICAgICAucENvbW1hbmRCdWZmZXJzID0gc3VibWl0X2J1ZmZlcnMs
CisgICAgICAgICAuY29tbWFuZEJ1ZmZlckNvdW50ID0gMAogICAgICAgfTsKIAogICAgICAgVmtQ
aXBlbGluZVN0YWdlRmxhZ3MgKnN0YWdlX2ZsYWdzID0gTlVMTDsKQEAgLTExOTcsMTAgKzE0MDYs
NDcgQEAgd3NpX2NvbW1vbl9xdWV1ZV9wcmVzZW50KGNvbnN0IHN0cnVjdCB3c2lfZGV2aWNlICp3
c2ksCiAgICAgICAgICAvKiBJZiB3ZSBhcmUgdXNpbmcgcHJpbWUgYmxpdHMsIHdlIG5lZWQgdG8g
cGVyZm9ybSB0aGUgYmxpdCBub3cuICBUaGUKICAgICAgICAgICAqIGNvbW1hbmQgYnVmZmVyIGlz
IGF0dGFjaGVkIHRvIHRoZSBpbWFnZS4KICAgICAgICAgICAqLwotICAgICAgICAgc3VibWl0X2lu
Zm8uY29tbWFuZEJ1ZmZlckNvdW50ID0gMTsKLSAgICAgICAgIHN1Ym1pdF9pbmZvLnBDb21tYW5k
QnVmZmVycyA9Ci0gICAgICAgICAgICAmaW1hZ2UtPnByaW1lLmJsaXRfY21kX2J1ZmZlcnNbcXVl
dWVfZmFtaWx5X2luZGV4XTsKICAgICAgICAgIG1lbV9zaWduYWwubWVtb3J5ID0gaW1hZ2UtPnBy
aW1lLm1lbW9yeTsKKyAgICAgICAgIHN1Ym1pdF9idWZmZXJzW3N1Ym1pdF9pbmZvLmNvbW1hbmRC
dWZmZXJDb3VudCsrXSA9CisgICAgICAgICAgICBpbWFnZS0+cHJpbWUuYmxpdF9jbWRfYnVmZmVy
c1txdWV1ZV9mYW1pbHlfaW5kZXhdOworICAgICAgfQorCisgICAgICAvKiBTZXQgdXAgR09PR0xF
X2Rpc3BsYXlfdGltaW5nIGJpdHMgKi8KKyAgICAgIGlmIChwcmVzZW50X3RpbWVzX2luZm8gJiYK
KyAgICAgICAgICBwcmVzZW50X3RpbWVzX2luZm8tPnBUaW1lcyAhPSBOVUxMICYmCisgICAgICAg
ICAgaSA8IHByZXNlbnRfdGltZXNfaW5mby0+c3dhcGNoYWluQ291bnQpCisgICAgICB7CisgICAg
ICAgICBjb25zdCBWa1ByZXNlbnRUaW1lR09PR0xFICpwcmVzZW50X3RpbWUgPQorICAgICAgICAg
ICAgJnByZXNlbnRfdGltZXNfaW5mby0+cFRpbWVzW2ldOworCisgICAgICAgICB0aW1pbmcgPSB3
c2lfbmV4dF90aW1pbmcoc3dhcGNoYWluLCBwUHJlc2VudEluZm8tPnBJbWFnZUluZGljZXNbaV0p
OworICAgICAgICAgdGltaW5nLT50aW1pbmcucHJlc2VudElEID0gcHJlc2VudF90aW1lLT5wcmVz
ZW50SUQ7CisgICAgICAgICB0aW1pbmctPnRpbWluZy5kZXNpcmVkUHJlc2VudFRpbWUgPSBwcmVz
ZW50X3RpbWUtPmRlc2lyZWRQcmVzZW50VGltZTsKKyAgICAgICAgIHRpbWluZy0+dGFyZ2V0X21z
YyA9IDA7CisgICAgICAgICBpbWFnZS0+dGltaW5nID0gdGltaW5nOworCisgICAgICAgICBpZiAo
cHJlc2VudF90aW1lLT5kZXNpcmVkUHJlc2VudFRpbWUgIT0gMCkKKyAgICAgICAgIHsKKyAgICAg
ICAgICAgIGludDY0X3QgZGVsdGFfbnNlYyA9IChpbnQ2NF90KSAocHJlc2VudF90aW1lLT5kZXNp
cmVkUHJlc2VudFRpbWUgLQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBzd2FwY2hhaW4tPmZyYW1lX3VzdCk7CisKKyAgICAgICAgICAgIC8qIFNldCB0aGUgdGFy
Z2V0IG1zYyBvbmx5IGlmIGl0J3Mgbm8gbW9yZSB0aGFuIHR3byBzZWNvbmRzIGZyb20KKyAgICAg
ICAgICAgICAqIG5vdywgYW5kIG5vdCBzdGFsZQorICAgICAgICAgICAgICovCisgICAgICAgICAg
ICBpZiAoMCA8PSBkZWx0YV9uc2VjICYmIGRlbHRhX25zZWMgPD0gMjAwMDAwMDAwMHVsKSB7Cisg
ICAgICAgICAgICAgICBWa1JlZnJlc2hDeWNsZUR1cmF0aW9uR09PR0xFIHJlZnJlc2hfdGltaW5n
OworCisgICAgICAgICAgICAgICBzd2FwY2hhaW4tPmdldF9yZWZyZXNoX2N5Y2xlX2R1cmF0aW9u
KHN3YXBjaGFpbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgJnJlZnJlc2hfdGltaW5nKTsKKworICAgICAgICAgICAgICAgaW50NjRfdCByZWZy
ZXNoID0gKGludDY0X3QpIHJlZnJlc2hfdGltaW5nLnJlZnJlc2hEdXJhdGlvbjsKKyAgICAgICAg
ICAgICAgIGludDY0X3QgZnJhbWVzID0gKGRlbHRhX25zZWMgKyByZWZyZXNoIC0gMSkgLyByZWZy
ZXNoOworICAgICAgICAgICAgICAgdGltaW5nLT50YXJnZXRfbXNjID0gc3dhcGNoYWluLT5mcmFt
ZV9tc2MgKyBmcmFtZXM7CisgICAgICAgICAgICB9CisgICAgICAgICB9CisKKyAgICAgICAgIHN1
Ym1pdF9idWZmZXJzW3N1Ym1pdF9pbmZvLmNvbW1hbmRCdWZmZXJDb3VudCsrXSA9CisgICAgICAg
ICAgICBpbWFnZS0+dGltZXN0YW1wX2J1ZmZlcjsKICAgICAgIH0KIAogICAgICAgcmVzdWx0ID0g
d3NpLT5RdWV1ZVN1Ym1pdChxdWV1ZSwgMSwgJnN1Ym1pdF9pbmZvLCBzd2FwY2hhaW4tPmZlbmNl
c1tpbWFnZV9pbmRleF0pOwpAQCAtMTIzNSwzICsxNDgxLDUyIEBAIHdzaV9jb21tb25fZ2V0X2N1
cnJlbnRfdGltZSh2b2lkKQogICAgY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZjdXJy
ZW50KTsKICAgIHJldHVybiBjdXJyZW50LnR2X25zZWMgKyBjdXJyZW50LnR2X3NlYyAqIDEwMDAw
MDAwMDB1bGw7CiB9CisKK1ZrUmVzdWx0Cit3c2lfY29tbW9uX2dldF9yZWZyZXNoX2N5Y2xlX2R1
cmF0aW9uKAorICAgY29uc3Qgc3RydWN0IHdzaV9kZXZpY2UgKndzaSwKKyAgIFZrRGV2aWNlIGRl
dmljZV9oLAorICAgVmtTd2FwY2hhaW5LSFIgX3N3YXBjaGFpbiwKKyAgIFZrUmVmcmVzaEN5Y2xl
RHVyYXRpb25HT09HTEUgKnBEaXNwbGF5VGltaW5nUHJvcGVydGllcykKK3sKKyAgIFdTSV9GUk9N
X0hBTkRMRSh3c2lfc3dhcGNoYWluLCBzd2FwY2hhaW4sIF9zd2FwY2hhaW4pOworCisgICBpZiAo
IXN3YXBjaGFpbi0+Z2V0X3JlZnJlc2hfY3ljbGVfZHVyYXRpb24pCisgICAgICByZXR1cm4gVktf
RVJST1JfRVhURU5TSU9OX05PVF9QUkVTRU5UOworICAgcmV0dXJuIHN3YXBjaGFpbi0+Z2V0X3Jl
ZnJlc2hfY3ljbGVfZHVyYXRpb24oc3dhcGNoYWluLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgcERpc3BsYXlUaW1pbmdQcm9wZXJ0aWVzKTsKK30KKwor
CitWa1Jlc3VsdAord3NpX2NvbW1vbl9nZXRfcGFzdF9wcmVzZW50YXRpb25fdGltaW5nKAorICAg
Y29uc3Qgc3RydWN0IHdzaV9kZXZpY2UgKndzaSwKKyAgIFZrRGV2aWNlIGRldmljZV9oLAorICAg
VmtTd2FwY2hhaW5LSFIgX3N3YXBjaGFpbiwKKyAgIHVpbnQzMl90ICpjb3VudCwKKyAgIFZrUGFz
dFByZXNlbnRhdGlvblRpbWluZ0dPT0dMRSAqdGltaW5ncykKK3sKKyAgIFdTSV9GUk9NX0hBTkRM
RSh3c2lfc3dhcGNoYWluLCBzd2FwY2hhaW4sIF9zd2FwY2hhaW4pOworICAgdWludDMyX3QgdGlt
aW5nX2NvdW50X3JlcXVlc3RlZCA9ICpjb3VudDsKKyAgIHVpbnQzMl90IHRpbWluZ19jb3VudF9h
dmFpbGFibGUgPSAwOworCisgICAvKiBDb3VudCB0aGUgbnVtYmVyIG9mIGNvbXBsZXRlZCBlbnRy
aWVzLCBjb3B5ICovCisgICBmb3IgKHVpbnQzMl90IHQgPSAwOyB0IDwgc3dhcGNoYWluLT50aW1p
bmdfY291bnQ7IHQrKykgeworICAgICAgc3RydWN0IHdzaV90aW1pbmcgKnRpbWluZyA9IHdzaV9n
ZXRfdGltaW5nKHN3YXBjaGFpbiwgdCk7CisKKyAgICAgIGlmICh0aW1pbmctPmNvbXBsZXRlICYm
ICF0aW1pbmctPmNvbnN1bWVkKSB7CisgICAgICAgICBpZiAodGltaW5ncyAmJiB0aW1pbmdfY291
bnRfYXZhaWxhYmxlIDwgdGltaW5nX2NvdW50X3JlcXVlc3RlZCkgeworICAgICAgICAgICAgdGlt
aW5nc1t0aW1pbmdfY291bnRfYXZhaWxhYmxlXSA9IHRpbWluZy0+dGltaW5nOworICAgICAgICAg
ICAgdGltaW5nLT5jb25zdW1lZCA9IHRydWU7CisgICAgICAgICB9CisgICAgICAgICB0aW1pbmdf
Y291bnRfYXZhaWxhYmxlKys7CisgICAgICB9CisgICB9CisKKyAgICpjb3VudCA9IHRpbWluZ19j
b3VudF9hdmFpbGFibGU7CisKKyAgIGlmICh0aW1pbmdfY291bnRfYXZhaWxhYmxlID4gdGltaW5n
X2NvdW50X3JlcXVlc3RlZCAmJiB0aW1pbmdzICE9IE5VTEwpCisgICAgICByZXR1cm4gVktfSU5D
T01QTEVURTsKKworICAgcmV0dXJuIFZLX1NVQ0NFU1M7Cit9CmRpZmYgLS1naXQgYS9zcmMvdnVs
a2FuL3dzaS93c2lfY29tbW9uLmggYi9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uLmgKaW5kZXgg
OTIxMjFiZThiZGEuLjAzOGE1NmYzZmQ4IDEwMDY0NAotLS0gYS9zcmMvdnVsa2FuL3dzaS93c2lf
Y29tbW9uLmgKKysrIGIvc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbi5oCkBAIC04OCw2ICs4OCw3
IEBAIHN0cnVjdCB3c2lfZGV2aWNlIHsKICAgIFZrUGh5c2ljYWxEZXZpY2UgcGRldmljZTsKICAg
IFZrUGh5c2ljYWxEZXZpY2VNZW1vcnlQcm9wZXJ0aWVzIG1lbW9yeV9wcm9wczsKICAgIHVpbnQz
Ml90IHF1ZXVlX2ZhbWlseV9jb3VudDsKKyAgIGZsb2F0IHRpbWVzdGFtcF9wZXJpb2Q7CiAKICAg
IFZrUGh5c2ljYWxEZXZpY2VQQ0lCdXNJbmZvUHJvcGVydGllc0VYVCBwY2lfYnVzX2luZm87CiAK
QEAgLTEzNCwxNCArMTM1LDE4IEBAIHN0cnVjdCB3c2lfZGV2aWNlIHsKICAgIFdTSV9DQihCaW5k
SW1hZ2VNZW1vcnkpOwogICAgV1NJX0NCKEJlZ2luQ29tbWFuZEJ1ZmZlcik7CiAgICBXU0lfQ0Io
Q21kQ29weUltYWdlVG9CdWZmZXIpOworICAgV1NJX0NCKENtZFJlc2V0UXVlcnlQb29sKTsKKyAg
IFdTSV9DQihDbWRXcml0ZVRpbWVzdGFtcCk7CiAgICBXU0lfQ0IoQ3JlYXRlQnVmZmVyKTsKICAg
IFdTSV9DQihDcmVhdGVDb21tYW5kUG9vbCk7CiAgICBXU0lfQ0IoQ3JlYXRlRmVuY2UpOwogICAg
V1NJX0NCKENyZWF0ZUltYWdlKTsKKyAgIFdTSV9DQihDcmVhdGVRdWVyeVBvb2wpOwogICAgV1NJ
X0NCKERlc3Ryb3lCdWZmZXIpOwogICAgV1NJX0NCKERlc3Ryb3lDb21tYW5kUG9vbCk7CiAgICBX
U0lfQ0IoRGVzdHJveUZlbmNlKTsKICAgIFdTSV9DQihEZXN0cm95SW1hZ2UpOworICAgV1NJX0NC
KERlc3Ryb3lRdWVyeVBvb2wpOwogICAgV1NJX0NCKEVuZENvbW1hbmRCdWZmZXIpOwogICAgV1NJ
X0NCKEZyZWVNZW1vcnkpOwogICAgV1NJX0NCKEZyZWVDb21tYW5kQnVmZmVycyk7CkBAIC0xNTAs
MTEgKzE1NSwxNSBAQCBzdHJ1Y3Qgd3NpX2RldmljZSB7CiAgICBXU0lfQ0IoR2V0SW1hZ2VNZW1v
cnlSZXF1aXJlbWVudHMpOwogICAgV1NJX0NCKEdldEltYWdlU3VicmVzb3VyY2VMYXlvdXQpOwog
ICAgV1NJX0NCKEdldE1lbW9yeUZkS0hSKTsKKyAgIFdTSV9DQihHZXRQaHlzaWNhbERldmljZVBy
b3BlcnRpZXMpOwogICAgV1NJX0NCKEdldFBoeXNpY2FsRGV2aWNlRm9ybWF0UHJvcGVydGllcyk7
CiAgICBXU0lfQ0IoR2V0UGh5c2ljYWxEZXZpY2VGb3JtYXRQcm9wZXJ0aWVzMktIUik7CiAgICBX
U0lfQ0IoR2V0UGh5c2ljYWxEZXZpY2VJbWFnZUZvcm1hdFByb3BlcnRpZXMyKTsKKyAgIFdTSV9D
QihHZXRQaHlzaWNhbERldmljZVF1ZXVlRmFtaWx5UHJvcGVydGllcyk7CisgICBXU0lfQ0IoR2V0
UXVlcnlQb29sUmVzdWx0cyk7CiAgICBXU0lfQ0IoUmVzZXRGZW5jZXMpOwogICAgV1NJX0NCKFF1
ZXVlU3VibWl0KTsKKyAgIFdTSV9DQihHZXRDYWxpYnJhdGVkVGltZXN0YW1wc0VYVCk7CiAgICBX
U0lfQ0IoV2FpdEZvckZlbmNlcyk7CiAjdW5kZWYgV1NJX0NCCiAKQEAgLTI3Miw0ICsyODEsMjcg
QEAgd3NpX2NvbW1vbl9xdWV1ZV9wcmVzZW50KGNvbnN0IHN0cnVjdCB3c2lfZGV2aWNlICp3c2ks
CiB1aW50NjRfdAogd3NpX2NvbW1vbl9nZXRfY3VycmVudF90aW1lKHZvaWQpOwogCitWa1Jlc3Vs
dAord3NpX2NvbW1vbl9jb252ZXJ0X3RpbWVzdGFtcChjb25zdCBzdHJ1Y3Qgd3NpX2RldmljZSAq
d3NpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWa0RldmljZSBkZXZpY2VfaCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtTdXJmYWNlS0hSIHN1cmZhY2VfaCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgbW9ub3RvbmljX3RpbWVzdGFtcCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgKnN1cmZhY2VfdGltZXN0YW1wKTsK
KworLyogVktfR09PR0xFX2Rpc3BsYXlfdGltaW5nICovCitWa1Jlc3VsdAord3NpX2NvbW1vbl9n
ZXRfcmVmcmVzaF9jeWNsZV9kdXJhdGlvbihjb25zdCBzdHJ1Y3Qgd3NpX2RldmljZSAqd3NpLAor
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWa0RldmljZSBkZXZpY2VfaCwK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtTd2FwY2hhaW5LSFIgc3dh
cGNoYWluLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWa1JlZnJlc2hD
eWNsZUR1cmF0aW9uR09PR0xFCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICpwRGlzcGxheVRpbWluZ1Byb3BlcnRpZXMpOworCitWa1Jlc3VsdAord3NpX2NvbW1vbl9nZXRf
cGFzdF9wcmVzZW50YXRpb25fdGltaW5nKGNvbnN0IHN0cnVjdCB3c2lfZGV2aWNlICp3c2ksCisg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtEZXZpY2UgZGV2aWNlX2gs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtTd2FwY2hhaW5LSFIg
c3dhcGNoYWluLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQz
Ml90ICpwUHJlc2VudGF0aW9uVGltaW5nQ291bnQsCisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgVmtQYXN0UHJlc2VudGF0aW9uVGltaW5nR09PR0xFCisgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKnBQcmVzZW50YXRpb25UaW1pbmdzKTsKKwog
I2VuZGlmCmRpZmYgLS1naXQgYS9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uX2Rpc3BsYXkuYyBi
L3NyYy92dWxrYW4vd3NpL3dzaV9jb21tb25fZGlzcGxheS5jCmluZGV4IDBmOWExZmZlOGQzLi4z
YjJlZmU1N2NlMSAxMDA2NDQKLS0tIGEvc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbl9kaXNwbGF5
LmMKKysrIGIvc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbl9kaXNwbGF5LmMKQEAgLTc2LDYgKzc2
LDggQEAgdHlwZWRlZiBzdHJ1Y3Qgd3NpX2Rpc3BsYXlfY29ubmVjdG9yIHsKICAgIGNoYXIgICAg
ICAgICAgICAgICAgICAgICAgICAgKm5hbWU7CiAgICBib29sICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbm5lY3RlZDsKICAgIGJvb2wgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlOwor
ICAgdWludDY0X3QgICAgICAgICAgICAgICAgICAgICBsYXN0X2ZyYW1lOworICAgdWludDY0X3Qg
ICAgICAgICAgICAgICAgICAgICBsYXN0X25zZWM7CiAgICBzdHJ1Y3QgbGlzdF9oZWFkICAgICAg
ICAgICAgIGRpc3BsYXlfbW9kZXM7CiAgICB3c2lfZGlzcGxheV9tb2RlICAgICAgICAgICAgICpj
dXJyZW50X21vZGU7CiAgICBkcm1Nb2RlTW9kZUluZm8gICAgICAgICAgICAgIGN1cnJlbnRfZHJt
X21vZGU7CkBAIC0xMTAsNiArMTEyLDcgQEAgc3RydWN0IHdzaV9kaXNwbGF5IHsKIGVudW0gd3Np
X2ltYWdlX3N0YXRlIHsKICAgIFdTSV9JTUFHRV9JRExFLAogICAgV1NJX0lNQUdFX0RSQVdJTkcs
CisgICBXU0lfSU1BR0VfV0FJVElORywKICAgIFdTSV9JTUFHRV9RVUVVRUQsCiAgICBXU0lfSU1B
R0VfRkxJUFBJTkcsCiAgICBXU0lfSU1BR0VfRElTUExBWUlORwpAQCAtMTE5LDYgKzEyMiw3IEBA
IHN0cnVjdCB3c2lfZGlzcGxheV9pbWFnZSB7CiAgICBzdHJ1Y3Qgd3NpX2ltYWdlICAgICAgICAg
ICAgIGJhc2U7CiAgICBzdHJ1Y3Qgd3NpX2Rpc3BsYXlfc3dhcGNoYWluICpjaGFpbjsKICAgIGVu
dW0gd3NpX2ltYWdlX3N0YXRlICAgICAgICAgc3RhdGU7CisgICBzdHJ1Y3Qgd3NpX2Rpc3BsYXlf
ZmVuY2UgICAgICpmZW5jZTsKICAgIHVpbnQzMl90ICAgICAgICAgICAgICAgICAgICAgZmJfaWQ7
CiAgICB1aW50MzJfdCAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcls0XTsKICAgIHVpbnQ2NF90
ICAgICAgICAgICAgICAgICAgICAgZmxpcF9zZXF1ZW5jZTsKQEAgLTEzOCw2ICsxNDIsNyBAQCBz
dHJ1Y3Qgd3NpX2Rpc3BsYXlfZmVuY2UgewogICAgYm9vbCAgICAgICAgICAgICAgICAgICAgICAg
ICBldmVudF9yZWNlaXZlZDsKICAgIGJvb2wgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJv
eWVkOwogICAgdWludDY0X3QgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZTsKKyAgIHN0cnVj
dCB3c2lfZGlzcGxheV9pbWFnZSAgICAgKmltYWdlOwogfTsKIAogc3RhdGljIHVpbnQ2NF90IGZl
bmNlX3NlcXVlbmNlOwpAQCAtMTA0NCw2ICsxMDQ5LDcgQEAgd3NpX2Rpc3BsYXlfaW1hZ2VfaW5p
dChWa0RldmljZSBkZXZpY2VfaCwKIAogICAgaW1hZ2UtPmNoYWluID0gY2hhaW47CiAgICBpbWFn
ZS0+c3RhdGUgPSBXU0lfSU1BR0VfSURMRTsKKyAgIGltYWdlLT5mZW5jZSA9IE5VTEw7CiAgICBp
bWFnZS0+ZmJfaWQgPSAwOwogCiAgICBpbnQgcmV0ID0gZHJtTW9kZUFkZEZCMih3c2ktPmZkLApA
QCAtMTEzNSw2ICsxMTQxLDExIEBAIHdzaV9kaXNwbGF5X2lkbGVfb2xkX2Rpc3BsYXlpbmcoc3Ry
dWN0IHdzaV9kaXNwbGF5X2ltYWdlICphY3RpdmVfaW1hZ2UpCiBzdGF0aWMgVmtSZXN1bHQKIF93
c2lfZGlzcGxheV9xdWV1ZV9uZXh0KHN0cnVjdCB3c2lfc3dhcGNoYWluICpkcnZfY2hhaW4pOwog
CitzdGF0aWMgdWludDY0X3Qgd2lkZW5fMzJfdG9fNjQodWludDMyX3QgbmFycm93LCB1aW50NjRf
dCBuZWFyKQoreworCXJldHVybiBuZWFyICsgKGludDMyX3QpIChuYXJyb3cgLSBuZWFyKTsKK30K
Kwogc3RhdGljIHZvaWQKIHdzaV9kaXNwbGF5X3BhZ2VfZmxpcF9oYW5kbGVyMihpbnQgZmQsCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5zaWduZWQgaW50IGZyYW1lLApAQCAtMTE0
NSwxNyArMTE1NiwzOCBAQCB3c2lfZGlzcGxheV9wYWdlX2ZsaXBfaGFuZGxlcjIoaW50IGZkLAog
ewogICAgc3RydWN0IHdzaV9kaXNwbGF5X2ltYWdlICppbWFnZSA9IGRhdGE7CiAgICBzdHJ1Y3Qg
d3NpX2Rpc3BsYXlfc3dhcGNoYWluICpjaGFpbiA9IGltYWdlLT5jaGFpbjsKKyAgIFZrSWNkU3Vy
ZmFjZURpc3BsYXkgKnN1cmZhY2UgPSBjaGFpbi0+c3VyZmFjZTsKKyAgIHdzaV9kaXNwbGF5X21v
ZGUgKmRpc3BsYXlfbW9kZSA9CisgICAgICB3c2lfZGlzcGxheV9tb2RlX2Zyb21faGFuZGxlKHN1
cmZhY2UtPmRpc3BsYXlNb2RlKTsKKyAgIHdzaV9kaXNwbGF5X2Nvbm5lY3RvciAqY29ubmVjdG9y
ID0gZGlzcGxheV9tb2RlLT5jb25uZWN0b3I7CisgICB1aW50NjRfdCBuc2VjID0gKHVpbnQ2NF90
KSBzZWMgKiAxMDAwMDAwMDAwdWxsICsgKHVpbnQ2NF90KSB1c2VjICogMTAwMDsKIAogICAgd3Np
X2Rpc3BsYXlfZGVidWcoImltYWdlICVsZCBkaXNwbGF5ZWQgYXQgJWRcbiIsCiAgICAgICAgICAg
ICAgICAgICAgICBpbWFnZSAtICYoaW1hZ2UtPmNoYWluLT5pbWFnZXNbMF0pLCBmcmFtZSk7CisK
KyAgIC8qIERvbid0IGxldCB0aW1lIGdvIGJhY2t3YXJkcyBiZWNhdXNlIHRoaXMgZnVuY3Rpb24g
aGFzIGxvd2VyIHJlc29sdXRpb24KKyAgICAqIHRoYW4ga3RpbWUgKi8KKworICAgaWYgKG5zZWMg
PCBjb25uZWN0b3ItPmxhc3RfbnNlYykKKyAgICAgIG5zZWMgPSBjb25uZWN0b3ItPmxhc3RfbnNl
YzsKKwogICAgaW1hZ2UtPnN0YXRlID0gV1NJX0lNQUdFX0RJU1BMQVlJTkc7CisKKyAgIHVpbnQ2
NF90IGZyYW1lNjQgPSB3aWRlbl8zMl90b182NChmcmFtZSwgY29ubmVjdG9yLT5sYXN0X2ZyYW1l
KTsKKworICAgY29ubmVjdG9yLT5sYXN0X2ZyYW1lID0gZnJhbWU2NDsKKyAgIGNvbm5lY3Rvci0+
bGFzdF9uc2VjID0gbnNlYzsKKyAgIHdzaV9wcmVzZW50X2NvbXBsZXRlKCZpbWFnZS0+Y2hhaW4t
PmJhc2UsICZpbWFnZS0+YmFzZSwKKyAgICAgICAgICAgICAgICAgICAgICAgIG5zZWMsIGZyYW1l
NjQpOwogICAgd3NpX2Rpc3BsYXlfaWRsZV9vbGRfZGlzcGxheWluZyhpbWFnZSk7CiAgICBWa1Jl
c3VsdCByZXN1bHQgPSBfd3NpX2Rpc3BsYXlfcXVldWVfbmV4dCgmKGNoYWluLT5iYXNlKSk7CiAg
ICBpZiAocmVzdWx0ICE9IFZLX1NVQ0NFU1MpCiAgICAgICBjaGFpbi0+c3RhdHVzID0gcmVzdWx0
OwogfQogCi1zdGF0aWMgdm9pZCB3c2lfZGlzcGxheV9mZW5jZV9ldmVudF9oYW5kbGVyKHN0cnVj
dCB3c2lfZGlzcGxheV9mZW5jZSAqZmVuY2UpOworc3RhdGljIHZvaWQgd3NpX2Rpc3BsYXlfZmVu
Y2VfZXZlbnRfaGFuZGxlcihzdHJ1Y3Qgd3NpX2Rpc3BsYXlfZmVuY2UgKmZlbmNlLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBuc2VjLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50NjRfdCBmcmFtZSk7
CiAKIHN0YXRpYyB2b2lkIHdzaV9kaXNwbGF5X3BhZ2VfZmxpcF9oYW5kbGVyKGludCBmZCwKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCBmcmFt
ZSwKQEAgLTExNzEsOCArMTIwMywxNyBAQCBzdGF0aWMgdm9pZCB3c2lfZGlzcGxheV92Ymxhbmtf
aGFuZGxlcihpbnQgZmQsIHVuc2lnbmVkIGludCBmcmFtZSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHZvaWQgKmRhdGEpCiB7CiAgICBzdHJ1Y3Qgd3NpX2Rpc3BsYXlf
ZmVuY2UgKmZlbmNlID0gZGF0YTsKKyAgIHN0cnVjdCB3c2lfZGlzcGxheV9jb25uZWN0b3IgKmNv
bm5lY3RvciA9CisgICAgICB3c2lfZGlzcGxheV9jb25uZWN0b3JfZnJvbV9oYW5kbGUoZmVuY2Ut
PmJhc2UuZGlzcGxheSk7CisgICB1aW50NjRfdCBmcmFtZTY0ID0gd2lkZW5fMzJfdG9fNjQoZnJh
bWUsIGNvbm5lY3Rvci0+bGFzdF9mcmFtZSk7CisgICB1aW50NjRfdCBuc2VjID0gKHVpbnQ2NF90
KSBzZWMgKiAxMDAwMDAwMDAwICsgKHVpbnQ2NF90KSB1c2VjICogMTAwMDsKIAotICAgd3NpX2Rp
c3BsYXlfZmVuY2VfZXZlbnRfaGFuZGxlcihmZW5jZSk7CisgICAvKiBEb24ndCBsZXQgdGltZSBn
byBiYWNrd2FyZHMgYmVjYXVzZSB0aGlzIGZ1bmN0aW9uIGhhcyBsb3dlciByZXNvbHV0aW9uCisg
ICAgKiB0aGFuIGt0aW1lICovCisgICBpZiAobnNlYyA8IGNvbm5lY3Rvci0+bGFzdF9uc2VjKQor
ICAgICAgbnNlYyA9IGNvbm5lY3Rvci0+bGFzdF9uc2VjOworCisgICB3c2lfZGlzcGxheV9mZW5j
ZV9ldmVudF9oYW5kbGVyKGZlbmNlLCBuc2VjLCBmcmFtZTY0KTsKIH0KIAogc3RhdGljIHZvaWQg
d3NpX2Rpc3BsYXlfc2VxdWVuY2VfaGFuZGxlcihpbnQgZmQsIHVpbnQ2NF90IGZyYW1lLApAQCAt
MTE4MSw3ICsxMjIyLDcgQEAgc3RhdGljIHZvaWQgd3NpX2Rpc3BsYXlfc2VxdWVuY2VfaGFuZGxl
cihpbnQgZmQsIHVpbnQ2NF90IGZyYW1lLAogICAgc3RydWN0IHdzaV9kaXNwbGF5X2ZlbmNlICpm
ZW5jZSA9CiAgICAgICAoc3RydWN0IHdzaV9kaXNwbGF5X2ZlbmNlICopICh1aW50cHRyX3QpIHVz
ZXJfZGF0YTsKIAotICAgd3NpX2Rpc3BsYXlfZmVuY2VfZXZlbnRfaGFuZGxlcihmZW5jZSk7Cisg
ICB3c2lfZGlzcGxheV9mZW5jZV9ldmVudF9oYW5kbGVyKGZlbmNlLCBuc2VjLCBmcmFtZSk7CiB9
CiAKIHN0YXRpYyBkcm1FdmVudENvbnRleHQgZXZlbnRfY29udGV4dCA9IHsKQEAgLTE1MTMsMTIg
KzE1NTQsMzEgQEAgd3NpX2Rpc3BsYXlfZmVuY2VfY2hlY2tfZnJlZShzdHJ1Y3Qgd3NpX2Rpc3Bs
YXlfZmVuY2UgKmZlbmNlKQogICAgICAgdmtfZnJlZShmZW5jZS0+YmFzZS5hbGxvYywgZmVuY2Up
OwogfQogCi1zdGF0aWMgdm9pZCB3c2lfZGlzcGxheV9mZW5jZV9ldmVudF9oYW5kbGVyKHN0cnVj
dCB3c2lfZGlzcGxheV9mZW5jZSAqZmVuY2UpCitzdGF0aWMgdm9pZCB3c2lfZGlzcGxheV9mZW5j
ZV9ldmVudF9oYW5kbGVyKHN0cnVjdCB3c2lfZGlzcGxheV9mZW5jZSAqZmVuY2UsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IG5zZWMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IGZyYW1lKQog
eworICAgc3RydWN0IHdzaV9kaXNwbGF5X2Nvbm5lY3RvciAqY29ubmVjdG9yID0KKyAgICAgIHdz
aV9kaXNwbGF5X2Nvbm5lY3Rvcl9mcm9tX2hhbmRsZShmZW5jZS0+YmFzZS5kaXNwbGF5KTsKKyAg
IHN0cnVjdCB3c2lfZGlzcGxheV9pbWFnZSAqaW1hZ2UgPSBmZW5jZS0+aW1hZ2U7CisKKyAgIHdz
aV9kaXNwbGF5X2RlYnVnKCIlOWx1IGZlbmNlICVsdSByZWNlaXZlZCAlbHUgbnNlYyAlbHVcbiIs
CisgICAgICAgICAgICAgICAgICAgICBwdGhyZWFkX3NlbGYoKSwgZmVuY2UtPnNlcXVlbmNlLCBm
cmFtZSwgbnNlYyk7CisKKyAgIGNvbm5lY3Rvci0+bGFzdF9uc2VjID0gbnNlYzsKKyAgIGNvbm5l
Y3Rvci0+bGFzdF9mcmFtZSA9IGZyYW1lOwogICAgZmVuY2UtPmV2ZW50X3JlY2VpdmVkID0gdHJ1
ZTsKICAgIHdzaV9kaXNwbGF5X2ZlbmNlX2NoZWNrX2ZyZWUoZmVuY2UpOworICAgaWYgKGltYWdl
KSB7CisgICAgICBpbWFnZS0+ZmxpcF9zZXF1ZW5jZSA9ICsraW1hZ2UtPmNoYWluLT5mbGlwX3Nl
cXVlbmNlOworICAgICAgaW1hZ2UtPnN0YXRlID0gV1NJX0lNQUdFX1FVRVVFRDsKKyAgICAgIFZr
UmVzdWx0IHJlc3VsdCA9IF93c2lfZGlzcGxheV9xdWV1ZV9uZXh0KCZpbWFnZS0+Y2hhaW4tPmJh
c2UpOworICAgICAgaWYgKHJlc3VsdCAhPSBWS19TVUNDRVNTKQorICAgICAgICAgaW1hZ2UtPmNo
YWluLT5zdGF0dXMgPSByZXN1bHQ7CisgICB9CiB9CiAKKwogc3RhdGljIHZvaWQKIHdzaV9kaXNw
bGF5X2ZlbmNlX2Rlc3Ryb3koc3RydWN0IHdzaV9mZW5jZSAqZmVuY2Vfd3NpKQogewpAQCAtMTU1
Myw2ICsxNjEzLDcgQEAgd3NpX2Rpc3BsYXlfZmVuY2VfYWxsb2MoVmtEZXZpY2UgZGV2aWNlLAog
ICAgZmVuY2UtPmV2ZW50X3JlY2VpdmVkID0gZmFsc2U7CiAgICBmZW5jZS0+ZGVzdHJveWVkID0g
ZmFsc2U7CiAgICBmZW5jZS0+c2VxdWVuY2UgPSArK2ZlbmNlX3NlcXVlbmNlOworICAgZmVuY2Ut
PmltYWdlID0gTlVMTDsKICAgIHJldHVybiBmZW5jZTsKIH0KIApAQCAtMTY2MCw3ICsxNzIxLDE0
IEBAIF93c2lfZGlzcGxheV9xdWV1ZV9uZXh0KHN0cnVjdCB3c2lfc3dhcGNoYWluICpkcnZfY2hh
aW4pCiAgICAgICBpZiAoIWltYWdlKQogICAgICAgICAgcmV0dXJuIFZLX1NVQ0NFU1M7CiAKKyAg
ICAgIGlmIChpbWFnZS0+ZmVuY2UpIHsKKyAgICAgICAgIGltYWdlLT5mZW5jZS0+aW1hZ2UgPSBO
VUxMOworICAgICAgICAgd3NpX2Rpc3BsYXlfZmVuY2VfZGVzdHJveSgmaW1hZ2UtPmZlbmNlLT5i
YXNlKTsKKyAgICAgICAgIGltYWdlLT5mZW5jZSA9IE5VTEw7CisgICAgICB9CisKICAgICAgIGlu
dCByZXQ7CisKICAgICAgIGlmIChjb25uZWN0b3ItPmFjdGl2ZSkgewogICAgICAgICAgcmV0ID0g
ZHJtTW9kZVBhZ2VGbGlwKHdzaS0+ZmQsIGNvbm5lY3Rvci0+Y3J0Y19pZCwgaW1hZ2UtPmZiX2lk
LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEUk1fTU9ERV9QQUdFX0ZMSVBf
RVZFTlQsIGltYWdlKTsKQEAgLTE3NDAsNiArMTgwOCw2NiBAQCB3c2lfZGlzcGxheV9xdWV1ZV9w
cmVzZW50KHN0cnVjdCB3c2lfc3dhcGNoYWluICpkcnZfY2hhaW4sCiAKICAgIHB0aHJlYWRfbXV0
ZXhfbG9jaygmd3NpLT53YWl0X211dGV4KTsKIAorICAgaWYgKGltYWdlLT5iYXNlLnRpbWluZyAm
JiBpbWFnZS0+YmFzZS50aW1pbmctPnRhcmdldF9tc2MgIT0gMCkgeworICAgICAgVmtJY2RTdXJm
YWNlRGlzcGxheSAqc3VyZmFjZSA9IGNoYWluLT5zdXJmYWNlOworICAgICAgd3NpX2Rpc3BsYXlf
bW9kZSAqZGlzcGxheV9tb2RlID0KKyAgICAgICAgIHdzaV9kaXNwbGF5X21vZGVfZnJvbV9oYW5k
bGUoc3VyZmFjZS0+ZGlzcGxheU1vZGUpOworICAgICAgd3NpX2Rpc3BsYXlfY29ubmVjdG9yICpj
b25uZWN0b3IgPSBkaXNwbGF5X21vZGUtPmNvbm5lY3RvcjsKKworICAgICAgd3NpX2Rpc3BsYXlf
ZGVidWcoImRlbHRhIGZyYW1lICVsZFxuIiwKKyAgICAgICAgICAgICAgICAgICAgICAgIGltYWdl
LT5iYXNlLnRpbWluZy0+dGFyZ2V0X21zYyAtIGNvbm5lY3Rvci0+bGFzdF9mcmFtZSk7CisgICAg
ICBpZiAoaW1hZ2UtPmJhc2UudGltaW5nLT50YXJnZXRfbXNjID4gY29ubmVjdG9yLT5sYXN0X2Zy
YW1lKSB7CisgICAgICAgICB1aW50NjRfdCBmcmFtZV9xdWV1ZWQ7CisgICAgICAgICBWa0Rpc3Bs
YXlLSFIgZGlzcGxheSA9IHdzaV9kaXNwbGF5X2Nvbm5lY3Rvcl90b19oYW5kbGUoY29ubmVjdG9y
KTsKKworICAgICAgICAgd3NpX2Rpc3BsYXlfZGVidWdfY29kZSh1aW50NjRfdCBjdXJyZW50X2Zy
YW1lLCBjdXJyZW50X25zZWM7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRybUNy
dGNHZXRTZXF1ZW5jZSh3c2ktPmZkLCBjb25uZWN0b3ItPmNydGNfaWQsCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmY3VycmVudF9mcmFtZSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZjdXJyZW50
X25zZWMpOworICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3c2lfZGlzcGxheV9kZWJ1
ZygiZnJvbSBjdXJyZW50OiAlbGRcbiIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGltYWdlLT5iYXNlLnRpbWluZy0+dGFyZ2V0X21zYworICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGN1cnJlbnRfZnJh
bWUpKTsKKworICAgICAgICAgaW1hZ2UtPmZlbmNlID0gd3NpX2Rpc3BsYXlfZmVuY2VfYWxsb2Mo
Y2hhaW4tPmJhc2UuZGV2aWNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY2hhaW4tPmJhc2Uud3NpLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgZGlzcGxheSwgJmNoYWluLT5iYXNlLmFsbG9jKTsKKworICAg
ICAgICAgaWYgKCFpbWFnZS0+ZmVuY2UpIHsKKyAgICAgICAgICAgIHJlc3VsdCA9IFZLX0VSUk9S
X09VVF9PRl9IT1NUX01FTU9SWTsKKyAgICAgICAgICAgIGdvdG8gYmFpbF91bmxvY2s7CisgICAg
ICAgICB9CisKKyAgICAgICAgIHJlc3VsdCA9IHdzaV9yZWdpc3Rlcl92YmxhbmtfZXZlbnQoaW1h
Z2UtPmZlbmNlLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj
aGFpbi0+YmFzZS53c2ksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGRpc3BsYXksCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IDAsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLT5i
YXNlLnRpbWluZy0+dGFyZ2V0X21zYyAtIDEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICZmcmFtZV9xdWV1ZWQpOworCisgICAgICAgICBpZiAocmVzdWx0ICE9
IFZLX1NVQ0NFU1MpCisgICAgICAgICAgICBnb3RvIGJhaWxfdW5sb2NrOworCisgICAgICAgICAv
KiBDaGVjayBhbmQgbWFrZSBzdXJlIHdlIGFyZSBxdWV1ZWQgZm9yIHRoZSByaWdodCBmcmFtZSwg
b3RoZXJ3aXNlCisgICAgICAgICAgKiBqdXN0IGdvIHF1ZXVlIGFuIGltYWdlCisgICAgICAgICAg
Ki8KKyAgICAgICAgIGlmIChmcmFtZV9xdWV1ZWQgPD0gaW1hZ2UtPmJhc2UudGltaW5nLT50YXJn
ZXRfbXNjIC0gMSkgeworICAgICAgICAgICAgaW1hZ2UtPnN0YXRlID0gV1NJX0lNQUdFX1dBSVRJ
Tkc7CisKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBEb24ndCBzZXQgdGhlIGltYWdl
IG1lbWJlciB1bnRpbCB3ZSdyZSBnb2luZyB0byB3YWl0IGZvciB0aGUKKyAgICAgICAgICAgICAq
IGV2ZW50IHRvIGFycml2ZSBiZWZvcmUgZmxpcHBpbmcgdG8gdGhlIGltYWdlLiBUaGF0IHdheSwg
aWYgdGhlCisgICAgICAgICAgICAgKiByZWdpc3Rlcl92YmxhbmtfZXZlbnQgY2FsbCBoYXBwZW5z
IHRvIHByb2Nlc3MgdGhlIGV2ZW50LCBpdAorICAgICAgICAgICAgICogd29uJ3QgYWN0dWFsbHkg
ZG8gYW55dGhpbmcKKyAgICAgICAgICAgICAqLworICAgICAgICAgICAgaW1hZ2UtPmZlbmNlLT5p
bWFnZSA9IGltYWdlOworICAgICAgICAgICAgd3NpX2Rpc3BsYXlfc3RhcnRfd2FpdF90aHJlYWQo
d3NpKTsKKyAgICAgICAgICAgIHJlc3VsdCA9IFZLX1NVQ0NFU1M7CisgICAgICAgICAgICBnb3Rv
IGJhaWxfdW5sb2NrOworICAgICAgICAgfQorCisgICAgICB9CisgICB9CisKICAgIGltYWdlLT5m
bGlwX3NlcXVlbmNlID0gKytjaGFpbi0+ZmxpcF9zZXF1ZW5jZTsKICAgIGltYWdlLT5zdGF0ZSA9
IFdTSV9JTUFHRV9RVUVVRUQ7CiAKQEAgLTE3NDcsNiArMTg3NSw3IEBAIHdzaV9kaXNwbGF5X3F1
ZXVlX3ByZXNlbnQoc3RydWN0IHdzaV9zd2FwY2hhaW4gKmRydl9jaGFpbiwKICAgIGlmIChyZXN1
bHQgIT0gVktfU1VDQ0VTUykKICAgICAgIGNoYWluLT5zdGF0dXMgPSByZXN1bHQ7CiAKK2JhaWxf
dW5sb2NrOgogICAgcHRocmVhZF9tdXRleF91bmxvY2soJndzaS0+d2FpdF9tdXRleCk7CiAKICAg
IGlmIChyZXN1bHQgIT0gVktfU1VDQ0VTUykKQEAgLTE3NTUsNiArMTg4NCwyMSBAQCB3c2lfZGlz
cGxheV9xdWV1ZV9wcmVzZW50KHN0cnVjdCB3c2lfc3dhcGNoYWluICpkcnZfY2hhaW4sCiAgICBy
ZXR1cm4gY2hhaW4tPnN0YXR1czsKIH0KIAorc3RhdGljIFZrUmVzdWx0Cit3c2lfZGlzcGxheV9n
ZXRfcmVmcmVzaF9jeWNsZV9kdXJhdGlvbihzdHJ1Y3Qgd3NpX3N3YXBjaGFpbiAqZHJ2X2NoYWlu
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmtSZWZyZXNoQ3ljbGVE
dXJhdGlvbkdPT0dMRSAqZHVyYXRpb24pCit7CisgICBzdHJ1Y3Qgd3NpX2Rpc3BsYXlfc3dhcGNo
YWluICpjaGFpbiA9CisgICAgICAoc3RydWN0IHdzaV9kaXNwbGF5X3N3YXBjaGFpbiAqKSBkcnZf
Y2hhaW47CisgICBWa0ljZFN1cmZhY2VEaXNwbGF5ICpzdXJmYWNlID0gY2hhaW4tPnN1cmZhY2U7
CisgICB3c2lfZGlzcGxheV9tb2RlICpkaXNwbGF5X21vZGUgPQorICAgICAgd3NpX2Rpc3BsYXlf
bW9kZV9mcm9tX2hhbmRsZShzdXJmYWNlLT5kaXNwbGF5TW9kZSk7CisgICBkb3VibGUgcmVmcmVz
aCA9IHdzaV9kaXNwbGF5X21vZGVfcmVmcmVzaChkaXNwbGF5X21vZGUpOworCisgICBkdXJhdGlv
bi0+cmVmcmVzaER1cmF0aW9uID0gKHVpbnQ2NF90KSAoZmxvb3IgKDEuMC9yZWZyZXNoICogMWU5
ICsgMC41KSk7CisgICByZXR1cm4gVktfU1VDQ0VTUzsKK30KKwogc3RhdGljIFZrUmVzdWx0CiB3
c2lfZGlzcGxheV9zdXJmYWNlX2NyZWF0ZV9zd2FwY2hhaW4oCiAgICBWa0ljZFN1cmZhY2VCYXNl
ICppY2Rfc3VyZmFjZSwKQEAgLTE3OTAsNiArMTkzNCw4IEBAIHdzaV9kaXNwbGF5X3N1cmZhY2Vf
Y3JlYXRlX3N3YXBjaGFpbigKICAgIGNoYWluLT5iYXNlLmFjcXVpcmVfbmV4dF9pbWFnZSA9IHdz
aV9kaXNwbGF5X2FjcXVpcmVfbmV4dF9pbWFnZTsKICAgIGNoYWluLT5iYXNlLnF1ZXVlX3ByZXNl
bnQgPSB3c2lfZGlzcGxheV9xdWV1ZV9wcmVzZW50OwogICAgY2hhaW4tPmJhc2UucHJlc2VudF9t
b2RlID0gd3NpX3N3YXBjaGFpbl9nZXRfcHJlc2VudF9tb2RlKHdzaV9kZXZpY2UsIGNyZWF0ZV9p
bmZvKTsKKyAgIGNoYWluLT5iYXNlLmdldF9yZWZyZXNoX2N5Y2xlX2R1cmF0aW9uID0KKyAgICAg
IHdzaV9kaXNwbGF5X2dldF9yZWZyZXNoX2N5Y2xlX2R1cmF0aW9uOwogICAgY2hhaW4tPmJhc2Uu
aW1hZ2VfY291bnQgPSBudW1faW1hZ2VzOwogCiAgICBjaGFpbi0+d3NpID0gd3NpOwpAQCAtMjU1
NSw5ICsyNzAxLDE0IEBAIHdzaV9nZXRfc3dhcGNoYWluX2NvdW50ZXIoVmtEZXZpY2UgZGV2aWNl
LAogICAgICAgcmV0dXJuIFZLX1NVQ0NFU1M7CiAgICB9CiAKLSAgIGludCByZXQgPSBkcm1DcnRj
R2V0U2VxdWVuY2Uod3NpLT5mZCwgY29ubmVjdG9yLT5jcnRjX2lkLCB2YWx1ZSwgTlVMTCk7Ci0g
ICBpZiAocmV0KQorICAgdWludDY0X3QgbnNlYzsKKyAgIGludCByZXQgPSBkcm1DcnRjR2V0U2Vx
dWVuY2Uod3NpLT5mZCwgY29ubmVjdG9yLT5jcnRjX2lkLCB2YWx1ZSwgJm5zZWMpOworICAgaWYg
KHJldCkgewogICAgICAgKnZhbHVlID0gMDsKKyAgIH0gZWxzZSB7CisgICAgICBjb25uZWN0b3It
Pmxhc3RfZnJhbWUgPSAqdmFsdWU7CisgICAgICBjb25uZWN0b3ItPmxhc3RfbnNlYyA9IG5zZWM7
CisgICB9CiAKICAgIHJldHVybiBWS19TVUNDRVNTOwogfQpkaWZmIC0tZ2l0IGEvc3JjL3Z1bGth
bi93c2kvd3NpX2NvbW1vbl9wcml2YXRlLmggYi9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uX3By
aXZhdGUuaAppbmRleCA4OGMzNjBhMjQwOS4uODBiMjdmYzc2YTYgMTAwNjQ0Ci0tLSBhL3NyYy92
dWxrYW4vd3NpL3dzaV9jb21tb25fcHJpdmF0ZS5oCisrKyBiL3NyYy92dWxrYW4vd3NpL3dzaV9j
b21tb25fcHJpdmF0ZS5oCkBAIC0yNSw2ICsyNSwxMyBAQAogCiAjaW5jbHVkZSAid3NpX2NvbW1v
bi5oIgogCitzdHJ1Y3Qgd3NpX3RpbWluZyB7CisgICBib29sIGNvbXBsZXRlOworICAgYm9vbCBj
b25zdW1lZDsKKyAgIHVpbnQ2NF90IHRhcmdldF9tc2M7CisgICBWa1Bhc3RQcmVzZW50YXRpb25U
aW1pbmdHT09HTEUgdGltaW5nOworfTsKKwogc3RydWN0IHdzaV9pbWFnZSB7CiAgICBWa0ltYWdl
IGltYWdlOwogICAgVmtEZXZpY2VNZW1vcnkgbWVtb3J5OwpAQCAtNDEsOCArNDgsMTYgQEAgc3Ry
dWN0IHdzaV9pbWFnZSB7CiAgICB1aW50MzJfdCBvZmZzZXRzWzRdOwogICAgdWludDMyX3Qgcm93
X3BpdGNoZXNbNF07CiAgICBpbnQgZmRzWzRdOworCisgICBWa1F1ZXJ5UG9vbCBxdWVyeV9wb29s
OworCisgICBWa0NvbW1hbmRCdWZmZXIgdGltZXN0YW1wX2J1ZmZlcjsKKworICAgc3RydWN0IHdz
aV90aW1pbmcgKnRpbWluZzsKIH07CiAKKyNkZWZpbmUgV1NJX1RJTUlOR19ISVNUT1JZICAgICAg
MTYKKwogc3RydWN0IHdzaV9zd2FwY2hhaW4gewogICAgY29uc3Qgc3RydWN0IHdzaV9kZXZpY2Ug
KndzaTsKIApAQCAtNTQsNiArNjksMTYgQEAgc3RydWN0IHdzaV9zd2FwY2hhaW4gewogCiAgICBi
b29sIHVzZV9wcmltZV9ibGl0OwogCisgICB1aW50MzJfdCB0aW1pbmdfaW5zZXJ0OworICAgdWlu
dDMyX3QgdGltaW5nX2NvdW50OworCisgICBzdHJ1Y3Qgd3NpX3RpbWluZyB0aW1pbmdbV1NJX1RJ
TUlOR19ISVNUT1JZXTsKKworICAgdWludDY0X3QgZnJhbWVfbXNjOworICAgdWludDY0X3QgZnJh
bWVfdXN0OworCisgICBmbG9hdCB0aW1lc3RhbXBfcGVyaW9kOworCiAgICAvKiBDb21tYW5kIHBv
b2xzLCBvbmUgcGVyIHF1ZXVlIGZhbWlseSAqLwogICAgVmtDb21tYW5kUG9vbCAqY21kX3Bvb2xz
OwogCkBAIC02Nyw2ICs5MiwxMCBAQCBzdHJ1Y3Qgd3NpX3N3YXBjaGFpbiB7CiAgICBWa1Jlc3Vs
dCAoKnF1ZXVlX3ByZXNlbnQpKHN0cnVjdCB3c2lfc3dhcGNoYWluICpzd2FwX2NoYWluLAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBpbWFnZV9pbmRleCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgY29uc3QgVmtQcmVzZW50UmVnaW9uS0hSICpkYW1hZ2UpOwor
ICAgVmtSZXN1bHQgKCpnZXRfcmVmcmVzaF9jeWNsZV9kdXJhdGlvbikoc3RydWN0IHdzaV9zd2Fw
Y2hhaW4gKnN3YXBfY2hhaW4sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICBWa1JlZnJlc2hDeWNsZUR1cmF0aW9uR09PR0xFCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAqcERpc3BsYXlUaW1pbmdQcm9wZXJ0aWVzKTsKKwogfTsKIAog
Ym9vbApAQCAtMTA0LDYgKzEzMywxMiBAQCB3c2lfZGVzdHJveV9pbWFnZShjb25zdCBzdHJ1Y3Qg
d3NpX3N3YXBjaGFpbiAqY2hhaW4sCiAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qgd3NpX2ltYWdl
ICppbWFnZSk7CiAKIAordm9pZAord3NpX3ByZXNlbnRfY29tcGxldGUoc3RydWN0IHdzaV9zd2Fw
Y2hhaW4gKnN3YXBjaGFpbiwKKyAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB3c2lfaW1hZ2Ug
KmltYWdlLAorICAgICAgICAgICAgICAgICAgICAgdWludDY0X3QgdXN0LAorICAgICAgICAgICAg
ICAgICAgICAgdWludDY0X3QgbXNjKTsKKwogc3RydWN0IHdzaV9pbnRlcmZhY2UgewogICAgVmtS
ZXN1bHQgKCpnZXRfc3VwcG9ydCkoVmtJY2RTdXJmYWNlQmFzZSAqc3VyZmFjZSwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCB3c2lfZGV2aWNlICp3c2lfZGV2aWNlLApkaWZmIC0t
Z2l0IGEvc3JjL3Z1bGthbi93c2kvd3NpX2NvbW1vbl94MTEuYyBiL3NyYy92dWxrYW4vd3NpL3dz
aV9jb21tb25feDExLmMKaW5kZXggOTUxMDZhZjViNmUuLjBhMTczOGNlN2NjIDEwMDY0NAotLS0g
YS9zcmMvdnVsa2FuL3dzaS93c2lfY29tbW9uX3gxMS5jCisrKyBiL3NyYy92dWxrYW4vd3NpL3dz
aV9jb21tb25feDExLmMKQEAgLTc0OCw2ICs3NDgsNyBAQCBzdHJ1Y3QgeDExX2ltYWdlIHsKICAg
IGJvb2wgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1c3k7CiAgICBzdHJ1
Y3QgeHNobWZlbmNlICogICAgICAgICAgICAgICAgICAgICAgICBzaG1fZmVuY2U7CiAgICB1aW50
MzJfdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jX2ZlbmNlOworICAgdWlu
dDMyX3QgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsOwogfTsKIAogc3Ry
dWN0IHgxMV9zd2FwY2hhaW4gewpAQCAtNzY2LDYgKzc2Nyw4IEBAIHN0cnVjdCB4MTFfc3dhcGNo
YWluIHsKICAgIHVpbnQ2NF90ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNl
bmRfc2JjOwogICAgdWludDY0X3QgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
bGFzdF9wcmVzZW50X21zYzsKICAgIHVpbnQzMl90ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHN0YW1wOworICAgdWludDY0X3QgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGFzdF9wcmVzZW50X25zZWM7CisgICB1aW50NjRfdCAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICByZWZyZXNoX3BlcmlvZDsKIAogICAgYm9vbCAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3ByZXNlbnRfcXVldWU7CiAgICBib29s
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfYWNxdWlyZV9xdWV1
ZTsKQEAgLTg1OSw4ICs4NjIsMzkgQEAgeDExX2hhbmRsZV9kcmkzX3ByZXNlbnRfZXZlbnQoc3Ry
dWN0IHgxMV9zd2FwY2hhaW4gKmNoYWluLAogCiAgICBjYXNlIFhDQl9QUkVTRU5UX0VWRU5UX0NP
TVBMRVRFX05PVElGWTogewogICAgICAgeGNiX3ByZXNlbnRfY29tcGxldGVfbm90aWZ5X2V2ZW50
X3QgKmNvbXBsZXRlID0gKHZvaWQgKikgZXZlbnQ7Ci0gICAgICBpZiAoY29tcGxldGUtPmtpbmQg
PT0gWENCX1BSRVNFTlRfQ09NUExFVEVfS0lORF9QSVhNQVApCisgICAgICBpZiAoY29tcGxldGUt
PmtpbmQgPT0gWENCX1BSRVNFTlRfQ09NUExFVEVfS0lORF9QSVhNQVApIHsKKyAgICAgICAgIHVp
bnQ2NF90IGZyYW1lcyA9IGNvbXBsZXRlLT5tc2MgLSBjaGFpbi0+bGFzdF9wcmVzZW50X21zYzsK
KyAgICAgICAgIHVpbnQ2NF90IHByZXNlbnRfbnNlYyA9IGNvbXBsZXRlLT51c3QgKiAxMDAwOwor
CisgICAgICAgICAvKgorICAgICAgICAgICogV2VsbCwgdGhpcyBpcyBhYm91dCBhcyBnb29kIGFz
IHdlIGNhbiBkbyAtLSBtZWFzdXJlIHRoZSByZWZyZXNoCisgICAgICAgICAgKiBpbnN0ZWFkIG9m
IGFza2luZyBmb3IgdGhlIGN1cnJlbnQgbW9kZSBhbmQgdXNpbmcgdGhhdC4gVHVybnMgb3V0LAor
ICAgICAgICAgICogZm9yIGVEUCBwYW5lbHMsIHRoaXMgd29ya3MgYmV0dGVyIGFueXdheXMgYXMg
dGhleSB1c2UgdGhlIGJ1aWx0aW4KKyAgICAgICAgICAqIGZpeGVkIG1vZGUgZm9yIGV2ZXJ5dGhp
bmcKKyAgICAgICAgICAqLworICAgICAgICAgaWYgKDAgPCBmcmFtZXMgJiYgZnJhbWVzIDwgMTAg
JiYKKyAgICAgICAgICAgICBwcmVzZW50X25zZWMgPiBjaGFpbi0+bGFzdF9wcmVzZW50X25zZWMp
CisgICAgICAgICB7CisgICAgICAgICAgICB1aW50NjRfdCByZWZyZXNoX3BlcmlvZCA9CisgICAg
ICAgICAgICAgICAocHJlc2VudF9uc2VjIC0gY2hhaW4tPmxhc3RfcHJlc2VudF9uc2VjICsgZnJh
bWVzIC8gMikgLyBmcmFtZXM7CisKKyAgICAgICAgICAgIGlmIChjaGFpbi0+cmVmcmVzaF9wZXJp
b2QpCisgICAgICAgICAgICAgICByZWZyZXNoX3BlcmlvZCA9CisgICAgICAgICAgICAgICAgICAo
MyAqIGNoYWluLT5yZWZyZXNoX3BlcmlvZCArIHJlZnJlc2hfcGVyaW9kKSA+PiAyOworCisgICAg
ICAgICAgICBjaGFpbi0+cmVmcmVzaF9wZXJpb2QgPSByZWZyZXNoX3BlcmlvZDsKKyAgICAgICAg
IH0KKwogICAgICAgICAgY2hhaW4tPmxhc3RfcHJlc2VudF9tc2MgPSBjb21wbGV0ZS0+bXNjOwor
ICAgICAgICAgY2hhaW4tPmxhc3RfcHJlc2VudF9uc2VjID0gcHJlc2VudF9uc2VjOworICAgICAg
ICAgZm9yICh1bnNpZ25lZCBpID0gMDsgaSA8IGNoYWluLT5iYXNlLmltYWdlX2NvdW50OyBpKysp
IHsKKyAgICAgICAgICAgIGlmIChjaGFpbi0+aW1hZ2VzW2ldLnNlcmlhbCA9PSBjb21wbGV0ZS0+
c2VyaWFsKSB7CisgICAgICAgICAgICAgICB3c2lfcHJlc2VudF9jb21wbGV0ZSgmY2hhaW4tPmJh
c2UsICZjaGFpbi0+aW1hZ2VzW2ldLmJhc2UsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwcmVzZW50X25zZWMsIGNvbXBsZXRlLT5tc2MpOworICAgICAgICAgICAgICAgYnJl
YWs7CisgICAgICAgICAgICB9CisgICAgICAgICB9CisgICAgICB9CiAKICAgICAgIFZrUmVzdWx0
IHJlc3VsdCA9IFZLX1NVQ0NFU1M7CiAKQEAgLTk5NCw3ICsxMDI4LDcgQEAgeDExX2FjcXVpcmVf
bmV4dF9pbWFnZV9mcm9tX3F1ZXVlKHN0cnVjdCB4MTFfc3dhcGNoYWluICpjaGFpbiwKIAogc3Rh
dGljIFZrUmVzdWx0CiB4MTFfcHJlc2VudF90b194MTEoc3RydWN0IHgxMV9zd2FwY2hhaW4gKmNo
YWluLCB1aW50MzJfdCBpbWFnZV9pbmRleCwKLSAgICAgICAgICAgICAgICAgICB1aW50MzJfdCB0
YXJnZXRfbXNjKQorICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90IHRhcmdldF9tc2MpCiB7CiAg
ICBzdHJ1Y3QgeDExX2ltYWdlICppbWFnZSA9ICZjaGFpbi0+aW1hZ2VzW2ltYWdlX2luZGV4XTsK
IApAQCAtMTAyOSwxMSArMTA2MywxMiBAQCB4MTFfcHJlc2VudF90b194MTEoc3RydWN0IHgxMV9z
d2FwY2hhaW4gKmNoYWluLCB1aW50MzJfdCBpbWFnZV9pbmRleCwKICAgIHhzaG1mZW5jZV9yZXNl
dChpbWFnZS0+c2htX2ZlbmNlKTsKIAogICAgKytjaGFpbi0+c2VuZF9zYmM7CisgICBpbWFnZS0+
c2VyaWFsID0gKHVpbnQzMl90KSBjaGFpbi0+c2VuZF9zYmM7CiAgICB4Y2Jfdm9pZF9jb29raWVf
dCBjb29raWUgPQogICAgICAgeGNiX3ByZXNlbnRfcGl4bWFwKGNoYWluLT5jb25uLAogICAgICAg
ICAgICAgICAgICAgICAgICAgIGNoYWluLT53aW5kb3csCiAgICAgICAgICAgICAgICAgICAgICAg
ICAgaW1hZ2UtPnBpeG1hcCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAodWludDMyX3QpIGNo
YWluLT5zZW5kX3NiYywKKyAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZS0+c2VyaWFsLAog
ICAgICAgICAgICAgICAgICAgICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgLyogdmFsaWQgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHVwZGF0ZSAqLwogICAgICAgICAgICAgICAgICAg
ICAgICAgIDAsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogeF9vZmYgKi8K
QEAgLTEwOTEsNiArMTEyNiwyNiBAQCB4MTFfcXVldWVfcHJlc2VudChzdHJ1Y3Qgd3NpX3N3YXBj
aGFpbiAqYW52X2NoYWluLAogICAgfQogfQogCitzdGF0aWMgdWludDY0X3QKK3gxMV9yZWZyZXNo
X2R1cmF0aW9uKHN0cnVjdCB4MTFfc3dhcGNoYWluICpjaGFpbikKK3sKKyAgIC8qIFBpY2sgNjBI
eiBpZiB3ZSBkb24ndCBrbm93IHdoYXQgaXQgYWN0dWFsbHkgaXMgeWV0ICovCisgICBpZiAoIWNo
YWluLT5yZWZyZXNoX3BlcmlvZCkKKyAgICAgIHJldHVybiAodWludDY0X3QpICgxZTkgLyA1OS45
OCArIDAuNSk7CisKKyAgIHJldHVybiBjaGFpbi0+cmVmcmVzaF9wZXJpb2Q7Cit9CisKK3N0YXRp
YyBWa1Jlc3VsdAoreDExX2dldF9yZWZyZXNoKHN0cnVjdCB3c2lfc3dhcGNoYWluICp3c2lfY2hh
aW4sCisgICAgICAgICAgICAgICAgVmtSZWZyZXNoQ3ljbGVEdXJhdGlvbkdPT0dMRSAqdGltaW5n
cykKK3sKKyAgIHN0cnVjdCB4MTFfc3dhcGNoYWluICpjaGFpbiA9IChzdHJ1Y3QgeDExX3N3YXBj
aGFpbiAqKXdzaV9jaGFpbjsKKworICAgdGltaW5ncy0+cmVmcmVzaER1cmF0aW9uID0geDExX3Jl
ZnJlc2hfZHVyYXRpb24oY2hhaW4pOworICAgcmV0dXJuIFZLX1NVQ0NFU1M7Cit9CisKIHN0YXRp
YyB2b2lkICoKIHgxMV9tYW5hZ2VfZmlmb19xdWV1ZXModm9pZCAqc3RhdGUpCiB7CkBAIC0xMTA2
LDYgKzExNjEsNyBAQCB4MTFfbWFuYWdlX2ZpZm9fcXVldWVzKHZvaWQgKnN0YXRlKQogICAgICAg
ICogb3RoZXIgdGhhbiB0aGUgY3VycmVudGx5IHByZXNlbnRlZCBvbmUuCiAgICAgICAgKi8KICAg
ICAgIHVpbnQzMl90IGltYWdlX2luZGV4ID0gMDsKKyAgICAgIHN0cnVjdCB4MTFfaW1hZ2UgKmlt
YWdlOwogICAgICAgcmVzdWx0ID0gd3NpX3F1ZXVlX3B1bGwoJmNoYWluLT5wcmVzZW50X3F1ZXVl
LCAmaW1hZ2VfaW5kZXgsIElOVDY0X01BWCk7CiAgICAgICBhc3NlcnQocmVzdWx0ICE9IFZLX1RJ
TUVPVVQpOwogICAgICAgaWYgKHJlc3VsdCA8IDApIHsKQEAgLTExMzEsNiArMTE4NywxMiBAQCB4
MTFfbWFuYWdlX2ZpZm9fcXVldWVzKHZvaWQgKnN0YXRlKQogICAgICAgaWYgKGNoYWluLT5oYXNf
YWNxdWlyZV9xdWV1ZSkKICAgICAgICAgIHRhcmdldF9tc2MgPSBjaGFpbi0+bGFzdF9wcmVzZW50
X21zYyArIDE7CiAKKyAgICAgIGltYWdlID0gJmNoYWluLT5pbWFnZXNbaW1hZ2VfaW5kZXhdOwor
CisgICAgICBzdHJ1Y3Qgd3NpX3RpbWluZyAqdGltaW5nID0gaW1hZ2UtPmJhc2UudGltaW5nOwor
ICAgICAgaWYgKHRpbWluZyAmJiB0aW1pbmctPnRhcmdldF9tc2MgIT0gMCAmJiB0aW1pbmctPnRh
cmdldF9tc2MgPiB0YXJnZXRfbXNjKQorICAgICAgICAgdGFyZ2V0X21zYyA9IHRpbWluZy0+dGFy
Z2V0X21zYzsKKwogICAgICAgcmVzdWx0ID0geDExX3ByZXNlbnRfdG9feDExKGNoYWluLCBpbWFn
ZV9pbmRleCwgdGFyZ2V0X21zYyk7CiAgICAgICBpZiAocmVzdWx0IDwgMCkKICAgICAgICAgIGdv
dG8gZmFpbDsKQEAgLTE0NzEsNiArMTUzMyw3IEBAIHgxMV9zdXJmYWNlX2NyZWF0ZV9zd2FwY2hh
aW4oVmtJY2RTdXJmYWNlQmFzZSAqaWNkX3N1cmZhY2UsCiAgICBjaGFpbi0+YmFzZS5hY3F1aXJl
X25leHRfaW1hZ2UgPSB4MTFfYWNxdWlyZV9uZXh0X2ltYWdlOwogICAgY2hhaW4tPmJhc2UucXVl
dWVfcHJlc2VudCA9IHgxMV9xdWV1ZV9wcmVzZW50OwogICAgY2hhaW4tPmJhc2UucHJlc2VudF9t
b2RlID0gcHJlc2VudF9tb2RlOworICAgY2hhaW4tPmJhc2UuZ2V0X3JlZnJlc2hfY3ljbGVfZHVy
YXRpb24gPSB4MTFfZ2V0X3JlZnJlc2g7CiAgICBjaGFpbi0+YmFzZS5pbWFnZV9jb3VudCA9IG51
bV9pbWFnZXM7CiAgICBjaGFpbi0+Y29ubiA9IGNvbm47CiAgICBjaGFpbi0+d2luZG93ID0gd2lu
ZG93OwpAQCAtMTQ4MCw2ICsxNTQzLDggQEAgeDExX3N1cmZhY2VfY3JlYXRlX3N3YXBjaGFpbihW
a0ljZFN1cmZhY2VCYXNlICppY2Rfc3VyZmFjZSwKICAgIGNoYWluLT5sYXN0X3ByZXNlbnRfbXNj
ID0gMDsKICAgIGNoYWluLT5oYXNfYWNxdWlyZV9xdWV1ZSA9IGZhbHNlOwogICAgY2hhaW4tPmhh
c19wcmVzZW50X3F1ZXVlID0gZmFsc2U7CisgICBjaGFpbi0+bGFzdF9wcmVzZW50X25zZWMgPSAw
OworICAgY2hhaW4tPnRocmVhZGVkID0gZmFsc2U7CiAgICBjaGFpbi0+c3RhdHVzID0gVktfU1VD
Q0VTUzsKICAgIGNoYWluLT5oYXNfZHJpM19tb2RpZmllcnMgPSB3c2lfY29ubi0+aGFzX2RyaTNf
bW9kaWZpZXJzOwogCi0tIAoyLjI1LjAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWwK
