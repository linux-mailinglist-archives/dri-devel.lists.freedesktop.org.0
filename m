Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D0A05F2935
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 09:34:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFAF96EEF3;
	Thu,  7 Nov 2019 08:34:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 56C936EEEF
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 08:34:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 77B19B20E;
 Thu,  7 Nov 2019 08:34:08 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v2 8/9] drm/ast: Add cursor plane
Date: Thu,  7 Nov 2019 09:34:03 +0100
Message-Id: <20191107083404.6852-9-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191107083404.6852-1-tzimmermann@suse.de>
References: <20191107083404.6852-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGN1cnNvciBwbGFuZSB1c2VzIGFuIGludGVybmFsIGZvcm1hdCBvZiBBUkdCNDQ0NC4gVG8g
dXNlcnNwYWNlLCB3ZQphbm5vdW5jZSBBUkdCODg4OCBhbmQgZG8gdGhlIHRyYW5zZm9ybWF0aW9u
IGludGVybmFsbHkuCgp2MjoKCSogZG9uJ3Qgc2V0IHBsYW5lIGNhbGwtYmFjayBmdW5jdGlvbnMg
dG8gTlVMTCBleHBsaWNpdGx5CgkqIGRlZmluZSBwbGFuZSBmb3JtYXQgYXJyYXkgaW4gZ2xvYmFs
IHNjb3BlCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3Vz
ZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaCAgfCAgIDEgKwogZHJpdmVy
cy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jIHwgMTU1ICsrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrLQogMiBmaWxlcyBjaGFuZ2VkLCAxNTUgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Rydi5oIGIvZHJpdmVycy9n
cHUvZHJtL2FzdC9hc3RfZHJ2LmgKaW5kZXggMTM1NjA2MjJmMjJhLi40OTU1N2E3MzM5MGYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hc3QvYXN0X2Rydi5oCkBAIC0xMjIsNiArMTIyLDcgQEAgc3RydWN0IGFzdF9wcml2YXRl
IHsKIAl9IGN1cnNvcjsKIAogCXN0cnVjdCBkcm1fcGxhbmUgcHJpbWFyeV9wbGFuZTsKKwlzdHJ1
Y3QgZHJtX3BsYW5lIGN1cnNvcl9wbGFuZTsKIAogCWJvb2wgc3VwcG9ydF93aWRlX3NjcmVlbjsK
IAllbnVtIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwppbmRleCA2NWVlODIxNWY3MzAuLjNkNjE5Y2E2
ZTMyZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwpAQCAtNTQsNiArNTQsMTYgQEAgc3RhdGljIGlu
dCBhc3RfY3Vyc29yX21vdmUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJICAgaW50IHgsIGlu
dCB5KTsKIAogCitzdGF0aWMgdTMyIGNvcHlfY3Vyc29yX2ltYWdlKHU4ICpzcmMsIHU4ICpkc3Qs
IGludCB3aWR0aCwgaW50IGhlaWdodCk7CitzdGF0aWMgaW50IGFzdF9jdXJzb3JfdXBkYXRlKHZv
aWQgKmRzdCwgdm9pZCAqc3JjLCB1bnNpZ25lZCBpbnQgd2lkdGgsCisJCQkgICAgIHVuc2lnbmVk
IGludCBoZWlnaHQpOworc3RhdGljIHZvaWQgYXN0X2N1cnNvcl9zZXRfYmFzZShzdHJ1Y3QgYXN0
X3ByaXZhdGUgKmFzdCwgdTY0IGFkZHJlc3MpOworc3RhdGljIGludCBhc3Rfc2hvd19jdXJzb3Io
c3RydWN0IGRybV9jcnRjICpjcnRjLCB2b2lkICpzcmMsCisJCQkgICB1bnNpZ25lZCBpbnQgd2lk
dGgsIHVuc2lnbmVkIGludCBoZWlnaHQpOworc3RhdGljIHZvaWQgYXN0X2hpZGVfY3Vyc29yKHN0
cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CitzdGF0aWMgaW50IGFzdF9jdXJzb3JfbW92ZShzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMsCisJCQkgICBpbnQgeCwgaW50IHkpOworCiBzdGF0aWMgaW5saW5lIHZv
aWQgYXN0X2xvYWRfcGFsZXR0ZV9pbmRleChzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCwKIAkJCQkg
ICAgIHU4IGluZGV4LCB1OCByZWQsIHU4IGdyZWVuLAogCQkJCSAgICAgdTggYmx1ZSkKQEAgLTU5
Myw2ICs2MDMsMTM2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIGFzdF9w
cmltYXJ5X3BsYW5lX2Z1bmNzID0gewogCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9t
aWNfaGVscGVyX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCiB9OwogCisvKgorICogQ3Vyc29yIHBsYW5l
CisgKi8KKworc3RhdGljIGNvbnN0IHVpbnQzMl90IGFzdF9jdXJzb3JfcGxhbmVfZm9ybWF0c1td
ID0geworCURSTV9GT1JNQVRfQVJHQjg4ODgsCit9OworCitzdGF0aWMgaW50Cithc3RfY3Vyc29y
X3BsYW5lX2hlbHBlcl9wcmVwYXJlX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IG5ld19zdGF0ZS0+ZmI7CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gbmV3
X3N0YXRlLT5jcnRjOworCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CisJc3RydWN0
IGFzdF9wcml2YXRlICphc3Q7CisJaW50IHJldDsKKwl2b2lkICpzcmMsICpkc3Q7CisKKwlpZiAo
IWNydGMgfHwgIWZiKQorCQlyZXR1cm4gMDsKKworCWlmIChmYi0+d2lkdGggPiBBU1RfTUFYX0hX
Q19XSURUSCB8fCBmYi0+aGVpZ2h0ID4gQVNUX01BWF9IV0NfSEVJR0hUKQorCQlyZXR1cm4gLUVJ
TlZBTDsKKworCWFzdCA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7CisKKwlnYm8gPSBkcm1fZ2Vt
X3ZyYW1fb2ZfZ2VtKGZiLT5vYmpbMF0pOworCXNyYyA9IGRybV9nZW1fdnJhbV92bWFwKGdibyk7
CisJaWYgKElTX0VSUihzcmMpKSB7CisJCXJldCA9IFBUUl9FUlIoc3JjKTsKKwkJZ290byBlcnJf
ZHJtX2dlbV92cmFtX3VucGluOworCX0KKworCWRzdCA9IGRybV9nZW1fdnJhbV92bWFwKGFzdC0+
Y3Vyc29yLmdib1thc3QtPmN1cnNvci5uZXh0X2luZGV4XSk7CisJaWYgKElTX0VSUihkc3QpKSB7
CisJCXJldCA9IFBUUl9FUlIoZHN0KTsKKwkJZ290byBlcnJfZHJtX2dlbV92cmFtX3Z1bm1hcF9z
cmM7CisJfQorCisJcmV0ID0gYXN0X2N1cnNvcl91cGRhdGUoZHN0LCBzcmMsIGZiLT53aWR0aCwg
ZmItPmhlaWdodCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZHJtX2dlbV92cmFtX3Z1bm1hcF9k
c3Q7CisKKwkvKiBBbHdheXMgdW5tYXAgYnVmZmVycyBoZXJlLiBEZXN0aW5hdGlvbiBidWZmZXJz
IGFyZQorCSAqIHBlcm1hLXBpbm5lZCB3aGlsZSB0aGUgZHJpdmVyIGlzIGFjdGl2ZS4gV2UncmUg
b25seQorCSAqIGNoYW5naW5nIHJlZi1jb3VudGVycyBoZXJlLgorCSAqLworCWRybV9nZW1fdnJh
bV92dW5tYXAoYXN0LT5jdXJzb3IuZ2JvW2FzdC0+Y3Vyc29yLm5leHRfaW5kZXhdLCBkc3QpOwor
CWRybV9nZW1fdnJhbV92dW5tYXAoZ2JvLCBzcmMpOworCisJcmV0dXJuIDA7CisKK2Vycl9kcm1f
Z2VtX3ZyYW1fdnVubWFwX2RzdDoKKwlkcm1fZ2VtX3ZyYW1fdnVubWFwKGFzdC0+Y3Vyc29yLmdi
b1thc3QtPmN1cnNvci5uZXh0X2luZGV4XSwgZHN0KTsKK2Vycl9kcm1fZ2VtX3ZyYW1fdnVubWFw
X3NyYzoKKwlkcm1fZ2VtX3ZyYW1fdnVubWFwKGdibywgc3JjKTsKK2Vycl9kcm1fZ2VtX3ZyYW1f
dW5waW46CisJZHJtX2dlbV92cmFtX3VucGluKGdibyk7CisJcmV0dXJuIHJldDsKK30KKworc3Rh
dGljIGludCBhc3RfY3Vyc29yX3BsYW5lX2hlbHBlcl9hdG9taWNfY2hlY2soc3RydWN0IGRybV9w
bGFuZSAqcGxhbmUsCisJCQkJCQlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQKK2FzdF9jdXJzb3JfcGxhbmVfaGVscGVyX2F0b21p
Y191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJCQkJICAgICAgc3RydWN0IGRybV9w
bGFuZV9zdGF0ZSAqb2xkX3N0YXRlKQoreworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRl
ID0gcGxhbmUtPnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHN0YXRlLT5jcnRjOwor
CXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmZiOworCXN0cnVjdCBhc3RfcHJp
dmF0ZSAqYXN0ID0gcGxhbmUtPmRldi0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGFzdF9jcnRjICph
c3RfY3J0YyA9IHRvX2FzdF9jcnRjKGNydGMpOworCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0
ICpnYm87CisJczY0IG9mZjsKKwl1OCBqcmVnOworCisJYXN0X2NydGMtPm9mZnNldF94ID0gQVNU
X01BWF9IV0NfV0lEVEggLSBmYi0+d2lkdGg7CisJYXN0X2NydGMtPm9mZnNldF95ID0gQVNUX01B
WF9IV0NfV0lEVEggLSBmYi0+aGVpZ2h0OworCisJaWYgKHN0YXRlLT5mYiAhPSBvbGRfc3RhdGUt
PmZiKSB7CisJCS8qIEEgbmV3IGN1cnNvciBpbWFnZSB3YXMgaW5zdGFsbGVkLiAqLworCQlnYm8g
PSBhc3QtPmN1cnNvci5nYm9bYXN0LT5jdXJzb3IubmV4dF9pbmRleF07CisJCW9mZiA9IGRybV9n
ZW1fdnJhbV9vZmZzZXQoZ2JvKTsKKwkJaWYgKFdBUk5fT05fT05DRShvZmYgPCAwKSkKKwkJCXJl
dHVybjsgLyogQnVnOiB3ZSBkaWRuJ3QgcGluIGN1cnNvciBIVyBCTyB0byBWUkFNLiAqLworCQlh
c3RfY3Vyc29yX3NldF9iYXNlKGFzdCwgb2ZmKTsKKworCQkrK2FzdC0+Y3Vyc29yLm5leHRfaW5k
ZXg7CisJCWFzdC0+Y3Vyc29yLm5leHRfaW5kZXggJT0gQVJSQVlfU0laRShhc3QtPmN1cnNvci5n
Ym8pOworCX0KKworCWFzdF9jdXJzb3JfbW92ZShjcnRjLCBzdGF0ZS0+Y3J0Y194LCBzdGF0ZS0+
Y3J0Y195KTsKKworCWpyZWcgPSAweDI7CisJLyogZW5hYmxlIEFSR0IgY3Vyc29yICovCisJanJl
ZyB8PSAxOworCWFzdF9zZXRfaW5kZXhfcmVnX21hc2soYXN0LCBBU1RfSU9fQ1JUQ19QT1JULCAw
eGNiLCAweGZjLCBqcmVnKTsKK30KKworc3RhdGljIHZvaWQKK2FzdF9jdXJzb3JfcGxhbmVfaGVs
cGVyX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgICAgICBz
dHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3RydWN0IGFzdF9wcml2YXRl
ICphc3QgPSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKKworCWFzdF9zZXRfaW5kZXhfcmVnX21h
c2soYXN0LCBBU1RfSU9fQ1JUQ19QT1JULCAweGNiLCAweGZjLCAweDAwKTsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzIGFzdF9jdXJzb3JfcGxhbmVfaGVs
cGVyX2Z1bmNzID0geworCS5wcmVwYXJlX2ZiID0gYXN0X2N1cnNvcl9wbGFuZV9oZWxwZXJfcHJl
cGFyZV9mYiwKKwkuY2xlYW51cF9mYiA9IE5VTEwsIC8qIG5vdCByZXF1aXJlZCBmb3IgY3Vyc29y
IHBsYW5lICovCisJLmF0b21pY19jaGVjayA9IGFzdF9jdXJzb3JfcGxhbmVfaGVscGVyX2F0b21p
Y19jaGVjaywKKwkuYXRvbWljX3VwZGF0ZSA9IGFzdF9jdXJzb3JfcGxhbmVfaGVscGVyX2F0b21p
Y191cGRhdGUsCisJLmF0b21pY19kaXNhYmxlID0gYXN0X2N1cnNvcl9wbGFuZV9oZWxwZXJfYXRv
bWljX2Rpc2FibGUsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBh
c3RfY3Vyc29yX3BsYW5lX2Z1bmNzID0geworCS51cGRhdGVfcGxhbmUgPSBkcm1fYXRvbWljX2hl
bHBlcl91cGRhdGVfcGxhbmUsCisJLmRpc2FibGVfcGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl9k
aXNhYmxlX3BsYW5lLAorCS5kZXN0cm95ID0gZHJtX3BsYW5lX2NsZWFudXAsCisJLnJlc2V0ID0g
ZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfcmVzZXQsCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUg
PSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0
cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVzdHJveV9zdGF0ZSwKK307CisK
IC8qCiAgKiBDUlRDCiAgKi8KQEAgLTg4Miw3ICsxMDIyLDggQEAgc3RhdGljIGludCBhc3RfY3J0
Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJcmV0
ID0gZHJtX2NydGNfaW5pdF93aXRoX3BsYW5lcyhkZXYsICZjcnRjLT5iYXNlLCAmYXN0LT5wcmlt
YXJ5X3BsYW5lLAotCQkJCQlOVUxMLCAmYXN0X2NydGNfZnVuY3MsIE5VTEwpOworCQkJCQkmYXN0
LT5jdXJzb3JfcGxhbmUsICZhc3RfY3J0Y19mdW5jcywKKwkJCQkJTlVMTCk7CiAJaWYgKHJldCkK
IAkJZ290byBlcnJfa2ZyZWU7CiAKQEAgLTExNjMsNiArMTMwNCwxOCBAQCBpbnQgYXN0X21vZGVf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWRybV9wbGFuZV9oZWxwZXJfYWRkKCZhc3Qt
PnByaW1hcnlfcGxhbmUsCiAJCQkgICAgICZhc3RfcHJpbWFyeV9wbGFuZV9oZWxwZXJfZnVuY3Mp
OwogCisJcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KGRldiwgJmFzdC0+Y3Vyc29yX3Bs
YW5lLCAweDAxLAorCQkJCSAgICAgICAmYXN0X2N1cnNvcl9wbGFuZV9mdW5jcywKKwkJCQkgICAg
ICAgYXN0X2N1cnNvcl9wbGFuZV9mb3JtYXRzLAorCQkJCSAgICAgICBBUlJBWV9TSVpFKGFzdF9j
dXJzb3JfcGxhbmVfZm9ybWF0cyksCisJCQkJICAgICAgIE5VTEwsIERSTV9QTEFORV9UWVBFX0NV
UlNPUiwgTlVMTCk7CisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoImRybV91bml2ZXJzYWxfcGxh
bmVfZmFpbGVkKCk6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKwlkcm1fcGxhbmVf
aGVscGVyX2FkZCgmYXN0LT5jdXJzb3JfcGxhbmUsCisJCQkgICAgICZhc3RfY3Vyc29yX3BsYW5l
X2hlbHBlcl9mdW5jcyk7CisKIAlhc3RfY3Vyc29yX2luaXQoZGV2KTsKIAlhc3RfY3J0Y19pbml0
KGRldik7CiAJYXN0X2VuY29kZXJfaW5pdChkZXYpOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
