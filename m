Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7D34234641A
	for <lists+dri-devel@lfdr.de>; Tue, 23 Mar 2021 16:59:15 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3CE026EC42;
	Tue, 23 Mar 2021 15:58:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 390 seconds by postgrey-1.36 at gabe;
 Tue, 23 Mar 2021 15:57:41 UTC
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 183246EB3D
 for <dri-devel@lists.freedesktop.org>; Tue, 23 Mar 2021 15:57:41 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v9 13/70] drm/i915: Reject more ioctls for userptr, v2.
Date: Tue, 23 Mar 2021 16:50:02 +0100
Message-Id: <20210323155059.628690-14-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.31.0
In-Reply-To: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
References: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 Jason Ekstrand <jason@jlekstrand.net>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUgYXJlIGEgY291cGxlIG9mIGlvY3RsJ3MgcmVsYXRlZCB0byB0aWxpbmcgYW5kIGNhY2hl
IHBsYWNlbWVudCwKdGhhdCBtYWtlIG5vIHNlbnNlIGZvciB1c2VycHRyLCByZWplY3QgdGhvc2U6
Ci0gaTkxNV9nZW1fc2V0X3RpbGluZ19pb2N0bCgpCiAgICBUaWxpbmcgc2hvdWxkIGFsd2F5cyBi
ZSBsaW5lYXIgZm9yIHVzZXJwdHIuIENoYW5naW5nIHBsYWNlbWVudCB3aWxsCiAgICBmYWlsIHdp
dGggLUVOWElPLgotIGk5MTVfZ2VtX3NldF9jYWNoaW5nX2lvY3RsKCkKICAgIFVzZXJwdHIgbWVt
b3J5IHNob3VsZCBhbHdheXMgYmUgY2FjaGVkLiBDaGFuZ2luZyBjYWNoaW5nIG1vZGUgd2lsbAog
ICAgZmFpbCB3aXRoIC1FTlhJTy4KLSBpOTE1X2dlbV9zZXRfZG9tYWluX2lvY3RsKCkKICAgIFN0
aWxsIHRlbXBvcmFyaWx5IGFsbG93ZWQgdG8gd29yayBhcyBpbnRlbmRlZCwgaXQncyB1c2VkIHRv
IGNoZWNrCiAgICB1c2VycHRyIHZhbGlkaXR5LiBXaXRoIHRoZSByZXdvcmtlZCB1c2VycHRyIGNv
ZGUsIGl0IHdpbGwga2VlcAogICAgd29ya2luZyBmb3IgdGhpcyB1c2VjYXNlLgoKVGhpcyBwbHVz
IHRoZSBwcmV2aW91cyBjaGFuZ2VzIGhhdmUgYmVlbiB0ZXN0ZWQgYWdhaW5zdCBiZWlnbmV0CmJ5
IHVzaW5nIGl0cyBvd24gdW5pdCB0ZXN0cywgYW5kIGludGVsLXZpZGVvLWNvbXB1dGUgYnkgdXNp
bmcKcGlnbGl0J3Mgb3BlbmNsIHRlc3RzLgoKQ2hhbmdlcyBzaW5jZSB2MToKLSBzZXRfZG9tYWlu
IHdhcyBhcHBhcmVudGx5IHVzZWQgaW4gaXJpcyBmb3IgY2hlY2tpbmcgdXNlcnB0ciB2YWxpZGl0
eSwKICBrZWVwIGl0IHdvcmtpbmcgYXMgaW50ZW5kZWQuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVu
IExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgpSZXZpZXdlZC1i
eTogVGhvbWFzIEhlbGxzdHLDtm0gPHRob21hcy5oZWxsc3Ryb21AbGludXguaW50ZWwuY29tPgpB
Y2tlZC1ieTogSmFzb24gRWtzdHJhbmQgPGphc29uQGpsZWtzdHJhbmQubmV0PgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgIHwgMTIgKysrKysrKysrKy0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICB8ICA2ICsrKysrKwog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgfCAgMyArKy0KIDQg
ZmlsZXMgY2hhbmdlZCwgMTkgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDdiMzhiOWEzOGI4
NS4uMzVmMmZjNzcwZjVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwpAQCAtMTE5MDQsNyArMTE5MDQsNyBAQCBzdGF0aWMgaW50IGludGVsX3VzZXJf
ZnJhbWVidWZmZXJfY3JlYXRlX2hhbmRsZShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAKLQlp
ZiAob2JqLT51c2VycHRyLm1tKSB7CisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc191c2VycHRyKG9i
aikpIHsKIAkJZHJtX2RiZygmaTkxNS0+ZHJtLAogCQkJImF0dGVtcHRpbmcgdG8gdXNlIGEgdXNl
cnB0ciBmb3IgYSBmcmFtZWJ1ZmZlciwgZGVuaWVkXG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggMDQ3OGIwNjlj
MjAyLi4yZjQ5ODBiZjc0MmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZG9tYWluLmMKQEAgLTI4Nyw3ICsyODcsMTQgQEAgaW50IGk5MTVfZ2VtX3NldF9jYWNoaW5nX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJICogbm90IGFsbG93ZWQg
dG8gYmUgY2hhbmdlZCBieSB1c2Vyc3BhY2UuCiAJICovCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9p
c19wcm94eShvYmopKSB7Ci0JCXJldCA9IC1FTlhJTzsKKwkJLyoKKwkJICogU2lsZW50bHkgYWxs
b3cgY2FjaGVkIGZvciB1c2VycHRyOyB0aGUgdnVsa2FuIGRyaXZlcgorCQkgKiBzZXRzIGFsbCBv
YmplY3RzIHRvIGNhY2hlZAorCQkgKi8KKwkJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfdXNlcnB0
cihvYmopIHx8CisJCSAgICBhcmdzLT5jYWNoaW5nICE9IEk5MTVfQ0FDSElOR19DQUNIRUQpCisJ
CQlyZXQgPSAtRU5YSU87CisKIAkJZ290byBvdXQ7CiAJfQogCkBAIC00NjcsNyArNDc0LDggQEAg
aTkxNV9nZW1fc2V0X2RvbWFpbl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAogCSAqIHRyYWNraW5nIGZvciB0aGF0IGJhY2tpbmcgc3RvcmFnZS4gVGhlIHByb3h5IG9i
amVjdCBpcyBhbHdheXMKIAkgKiBjb25zaWRlcmVkIHRvIGJlIG91dHNpZGUgb2YgYW55IGNhY2hl
IGRvbWFpbi4KIAkgKi8KLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Byb3h5KG9iaikpIHsKKwlp
ZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Byb3h5KG9iaikgJiYKKwkgICAgIWk5MTVfZ2VtX29iamVj
dF9pc191c2VycHRyKG9iaikpIHsKIAkJZXJyID0gLUVOWElPOwogCQlnb3RvIG91dDsKIAl9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggYzhlYjBkZjkw
NGY3Li4xMDA4YzZjNDc4MDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmgKQEAgLTU3Myw2ICs1NzMsMTIgQEAgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVz
aF9mcm9udGJ1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogdm9pZCBfX2k5
MTVfZ2VtX29iamVjdF9pbnZhbGlkYXRlX2Zyb250YnVmZmVyKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJCQkJCSAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7CiAKK3N0
YXRpYyBpbmxpbmUgYm9vbAoraTkxNV9nZW1fb2JqZWN0X2lzX3VzZXJwdHIoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlyZXR1cm4gb2JqLT51c2VycHRyLm1tOworfQorCiBz
dGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9mbHVzaF9mcm9udGJ1ZmZlcihzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCSAgZW51bSBmYl9vcF9vcmlnaW4gb3Jp
Z2luKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJw
dHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXgg
MGMzMGNhNTJkZWUzLi5jODljZjkxMWZiMjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtNzIxLDcgKzcyMSw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1fdXNlcnB0cl9vcHMgPSB7CiAJLm5h
bWUgPSAiaTkxNV9nZW1fb2JqZWN0X3VzZXJwdHIiLAogCS5mbGFncyA9IEk5MTVfR0VNX09CSkVD
VF9JU19TSFJJTktBQkxFIHwKIAkJIEk5MTVfR0VNX09CSkVDVF9OT19NTUFQIHwKLQkJIEk5MTVf
R0VNX09CSkVDVF9BU1lOQ19DQU5DRUwsCisJCSBJOTE1X0dFTV9PQkpFQ1RfQVNZTkNfQ0FOQ0VM
IHwKKwkJIEk5MTVfR0VNX09CSkVDVF9JU19QUk9YWSwKIAkuZ2V0X3BhZ2VzID0gaTkxNV9nZW1f
dXNlcnB0cl9nZXRfcGFnZXMsCiAJLnB1dF9wYWdlcyA9IGk5MTVfZ2VtX3VzZXJwdHJfcHV0X3Bh
Z2VzLAogCS5kbWFidWZfZXhwb3J0ID0gaTkxNV9nZW1fdXNlcnB0cl9kbWFidWZfZXhwb3J0LAot
LSAKMi4zMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
