Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CDE931BD46
	for <lists+dri-devel@lfdr.de>; Mon, 13 May 2019 20:37:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 472E0891DA;
	Mon, 13 May 2019 18:37:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x643.google.com (mail-pl1-x643.google.com
 [IPv6:2607:f8b0:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7C9A0891DA
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 18:37:39 +0000 (UTC)
Received: by mail-pl1-x643.google.com with SMTP id d21so6914953plr.3
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 11:37:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=6HKdEGPhjL3LKGTrqARdaACbZVZ9nG73tzvT2bLZmCY=;
 b=OZJjMZC2O0ltUGF5cxLzwk+HBF29isR/6AWobayZ+yLyejD7hYor8gOT4lZxmc/UHY
 XDelnWJYOacF0zBWNtfGPbvq08ZNe+R1QLNM0JhG76BvbBvVcEyyevCUP4f+tg7x5sP/
 jP9op3l3k5aGcEmJFvq1TLwT2N8lwy1dkAR4e4LTUD0Cw7i4Rzah3Tqs8elBmbJ4bnk8
 4ubLEoqGn0U5cKVrCXDoGb7Gz2pY9kidlQe/sBbIJjtKGgZ0AskHezSPcNbkbqMfj5jF
 WMEBTcCAeSnA5YHI77EYytXGPfJI5H/OlZEnsLkr96pZIBvkhDMrdXJU46t0WepCflEb
 1wOg==
X-Gm-Message-State: APjAAAUsd9dbtGv/ohCjRc7Ag405vGiEYIjejGpF77fpIsItHvchkuV8
 G25g4d1ahRkA+G3LsefmU5xRFA==
X-Google-Smtp-Source: APXvYqwmxwenPIwcgXEd4kZd8GVUd1KeoDGWzLsMgtamJA+aECCJlMrbI+u/Q7az84ZvrnY0qZfRGQ==
X-Received: by 2002:a17:902:e583:: with SMTP id
 cl3mr33045659plb.35.1557772658890; 
 Mon, 13 May 2019 11:37:38 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:4e72:b9ff:fe99:466a])
 by smtp.gmail.com with ESMTPSA id
 u11sm17334881pfh.130.2019.05.13.11.37.37
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 13 May 2019 11:37:37 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH 4/5 v4] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Mon, 13 May 2019 11:37:26 -0700
Message-Id: <20190513183727.15755-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190513183727.15755-1-john.stultz@linaro.org>
References: <20190513183727.15755-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=6HKdEGPhjL3LKGTrqARdaACbZVZ9nG73tzvT2bLZmCY=;
 b=pJWuzImKSsn/QxKGPRxLUm/uPl0ErkVW1iAGmP26xnpY/Jzxkuz7cLUba5eyIGxpn8
 kpFtCgAriYWyex6PUCo/+9W+d/AWdSFe4/V4zgURbuzmb/m+rTDB2HZZNg3LQZE0nqRp
 blMleeHJ5o2fcvvunejlXa3aN3GqXJaCamaG0i0TmSMr15qQdxZRgPGHDFzQ15p6Ws6x
 2sVxTN28C2FhxJBRTf1KCKrClQVyaGCXbuwmADmG8/Z8/DjFl8chAkJHSC961u7We6Sr
 jV7ULCCz6qxlBf/fDSa+/CrR/mH/2E+7f4PhFjpG6oIpj9U+v29MbxTPFjr/aw7RrjTn
 k0Tg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Yudongbin <yudongbin@hisilicon.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Xu YiPing <xuyiping@hisilicon.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>,
 "Chenfeng \(puck\)" <puck.chen@hisilicon.com>, dri-devel@lists.freedesktop.org,
 Chenbo Feng <fengc@google.com>, Alistair Strachan <astrachan@google.com>,
 Liam Mark <lmark@codeaurora.org>, Christoph Hellwig <hch@infradead.org>,
 "Xiaqing \(A\)" <saberlily.xia@hisilicon.com>, "Andrew F . Davis" <afd@ti.com>,
 Pratik Patel <pratikp@codeaurora.org>, butao <butao@hisilicon.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKQ2M6IExhdXJhIEFiYm90
dCA8bGFiYm90dEByZWRoYXQuY29tPgpDYzogQmVuamFtaW4gR2FpZ25hcmQgPGJlbmphbWluLmdh
aWduYXJkQGxpbmFyby5vcmc+CkNjOiBTdW1pdCBTZW13YWwgPHN1bWl0LnNlbXdhbEBsaW5hcm8u
b3JnPgpDYzogTGlhbSBNYXJrIDxsbWFya0Bjb2RlYXVyb3JhLm9yZz4KQ2M6IFByYXRpayBQYXRl
bCA8cHJhdGlrcEBjb2RlYXVyb3JhLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IFZpbmNlbnQgRG9ubmVmb3J0IDxWaW5jZW50LkRvbm5lZm9ydEBhcm0u
Y29tPgpDYzogU3VkaXB0byBQYXVsIDxTdWRpcHRvLlBhdWxAYXJtLmNvbT4KQ2M6IEFuZHJldyBG
LiBEYXZpcyA8YWZkQHRpLmNvbT4KQ2M6IFh1IFlpUGluZyA8eHV5aXBpbmdAaGlzaWxpY29uLmNv
bT4KQ2M6ICJDaGVuZmVuZyAocHVjaykiIDxwdWNrLmNoZW5AaGlzaWxpY29uLmNvbT4KQ2M6IGJ1
dGFvIDxidXRhb0BoaXNpbGljb24uY29tPgpDYzogIlhpYXFpbmcgKEEpIiA8c2FiZXJsaWx5Lnhp
YUBoaXNpbGljb24uY29tPgpDYzogWXVkb25nYmluIDx5dWRvbmdiaW5AaGlzaWxpY29uLmNvbT4K
Q2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFkZWFkLm9yZz4KQ2M6IENoZW5ibyBGZW5n
IDxmZW5nY0Bnb29nbGUuY29tPgpDYzogQWxpc3RhaXIgU3RyYWNoYW4gPGFzdHJhY2hhbkBnb29n
bGUuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpTaWduZWQtb2ZmLWJ5
OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9yZz4KLS0tCnYyOgoqIFN3aXRjaCBh
bGxvY2F0ZSB0byByZXR1cm4gZG1hYnVmIGZkCiogU2ltcGxpZnkgaW5pdCBjb2RlCiogQ2hlY2tw
YXRjaCBmaXh1cHMKdjM6CiogU3dpdGNoIHRvIGlubGluZSBmdW5jdGlvbiBmb3IgdG9fY21hX2hl
YXAoKQoqIE1pbm9yIGNsZWFudXBzIHN1Z2dlc3RlZCBieSBCcmlhbgoqIEZvbGQgaW4gbmV3IHJl
Z2lzdHJhdGlvbiBzdHlsZSBmcm9tIEFuZHJldwoqIEZvbGRlZCBpbiBjaGFuZ2VzIGZyb20gQW5k
cmV3IHRvIHVzZSBzaW1wbGlmaWVkIHBhZ2UgbGlzdAogIGZyb20gdGhlIGhlYXAgaGVscGVycwoq
IFVzZSB0aGUgZmRfZmxhZ3Mgd2hlbiBjcmVhdGluZyBkbWFidWYgZmQgKFN1Z2dlc3RlZCBieQog
IEJlbmphbWluKQoqIFVzZSBwcmVjYWxjdWxhdGVkIHBhZ2Vjb3VudCAoU3VnZ2VzdGVkIGJ5IEFu
ZHJldykKLS0tCiBkcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyAgICB8ICAgOCArKwogZHJp
dmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVmL2hl
YXBzL2NtYV9oZWFwLmMgfCAxNjkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMyBm
aWxlcyBjaGFuZ2VkLCAxNzggaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVm
L2hlYXBzL0tjb25maWcgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwppbmRleCAyMDUw
NTI3NDQxNjkuLmE1ZWVmMDZjNDIyNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBz
L0tjb25maWcKKysrIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKQEAgLTQsMyArNCwx
MSBAQCBjb25maWcgRE1BQlVGX0hFQVBTX1NZU1RFTQogCWhlbHAKIAkgIENob29zZSB0aGlzIG9w
dGlvbiB0byBlbmFibGUgdGhlIHN5c3RlbSBkbWFidWYgaGVhcC4gVGhlIHN5c3RlbSBoZWFwCiAJ
ICBpcyBiYWNrZWQgYnkgcGFnZXMgZnJvbSB0aGUgYnVkZHkgYWxsb2NhdG9yLiBJZiBpbiBkb3Vi
dCwgc2F5IFkuCisKK2NvbmZpZyBETUFCVUZfSEVBUFNfQ01BCisJYm9vbCAiRE1BLUJVRiBDTUEg
SGVhcCIKKwlkZXBlbmRzIG9uIERNQUJVRl9IRUFQUyAmJiBETUFfQ01BCisJaGVscAorCSAgQ2hv
b3NlIHRoaXMgb3B0aW9uIHRvIGVuYWJsZSBkbWEtYnVmIENNQSBoZWFwLiBUaGlzIGhlYXAgaXMg
YmFja2VkCisJICBieSB0aGUgQ29udGlndW91cyBNZW1vcnkgQWxsb2NhdG9yIChDTUEpLiBJZiB5
b3VyIHN5c3RlbSBoYXMgdGhlc2UKKwkgIHJlZ2lvbnMsIHlvdSBzaG91bGQgc2F5IFkgaGVyZS4K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSBiL2RyaXZlcnMvZG1h
LWJ1Zi9oZWFwcy9NYWtlZmlsZQppbmRleCBkMTgwOGVjYTI1ODEuLjZlNTRjZGVjM2RhMCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1h
LWJ1Zi9oZWFwcy9NYWtlZmlsZQpAQCAtMSwzICsxLDQgQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAKIG9iai15CQkJCQkrPSBoZWFwLWhlbHBlcnMubwogb2JqLSQoQ09ORklH
X0RNQUJVRl9IRUFQU19TWVNURU0pCSs9IHN5c3RlbV9oZWFwLm8KK29iai0kKENPTkZJR19ETUFC
VUZfSEVBUFNfQ01BKQkJKz0gY21hX2hlYXAubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVm
L2hlYXBzL2NtYV9oZWFwLmMgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjNkMGZmYmJkMGEzNAotLS0gL2Rl
di9udWxsCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCkBAIC0wLDAgKzEs
MTY5IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIERNQUJV
RiBDTUEgaGVhcCBleHBvcnRlcgorICoKKyAqIENvcHlyaWdodCAoQykgMjAxMiwgMjAxOSBMaW5h
cm8gTHRkLgorICogQXV0aG9yOiA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4gZm9yIFNU
LUVyaWNzc29uLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxs
aW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWhlYXAuaD4KKyNpbmNsdWRlIDxs
aW51eC9zbGFiLmg+CisjaW5jbHVkZSA8bGludXgvZXJybm8uaD4KKyNpbmNsdWRlIDxsaW51eC9l
cnIuaD4KKyNpbmNsdWRlIDxsaW51eC9jbWEuaD4KKyNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlz
dC5oPgorI2luY2x1ZGUgPGxpbnV4L2hpZ2htZW0uaD4KKworI2luY2x1ZGUgImhlYXAtaGVscGVy
cy5oIgorCitzdHJ1Y3QgY21hX2hlYXAgeworCXN0cnVjdCBkbWFfaGVhcCAqaGVhcDsKKwlzdHJ1
Y3QgY21hICpjbWE7Cit9OworCitzdGF0aWMgdm9pZCBjbWFfaGVhcF9mcmVlKHN0cnVjdCBoZWFw
X2hlbHBlcl9idWZmZXIgKmJ1ZmZlcikKK3sKKwlzdHJ1Y3QgY21hX2hlYXAgKmNtYV9oZWFwID0g
ZG1hX2hlYXBfZ2V0X2RhdGEoYnVmZmVyLT5oZWFwX2J1ZmZlci5oZWFwKTsKKwl1bnNpZ25lZCBs
b25nIG5yX3BhZ2VzID0gYnVmZmVyLT5wYWdlY291bnQ7CisJc3RydWN0IHBhZ2UgKnBhZ2VzID0g
YnVmZmVyLT5wcml2X3ZpcnQ7CisKKwkvKiBmcmVlIHBhZ2UgbGlzdCAqLworCWtmcmVlKGJ1ZmZl
ci0+cGFnZXMpOworCS8qIHJlbGVhc2UgbWVtb3J5ICovCisJY21hX3JlbGVhc2UoY21hX2hlYXAt
PmNtYSwgcGFnZXMsIG5yX3BhZ2VzKTsKKwlrZnJlZShidWZmZXIpOworfQorCisvKiBkbWFidWYg
aGVhcCBDTUEgb3BlcmF0aW9ucyBmdW5jdGlvbnMgKi8KK3N0YXRpYyBpbnQgY21hX2hlYXBfYWxs
b2NhdGUoc3RydWN0IGRtYV9oZWFwICpoZWFwLAorCQkJCXVuc2lnbmVkIGxvbmcgbGVuLAorCQkJ
CXVuc2lnbmVkIGxvbmcgZmRfZmxhZ3MsCisJCQkJdW5zaWduZWQgbG9uZyBoZWFwX2ZsYWdzKQor
eworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hlYXAgPSBkbWFfaGVhcF9nZXRfZGF0YShoZWFwKTsK
KwlzdHJ1Y3QgaGVhcF9oZWxwZXJfYnVmZmVyICpoZWxwZXJfYnVmZmVyOworCXN0cnVjdCBwYWdl
ICpwYWdlczsKKwlzaXplX3Qgc2l6ZSA9IFBBR0VfQUxJR04obGVuKTsKKwl1bnNpZ25lZCBsb25n
IG5yX3BhZ2VzID0gc2l6ZSA+PiBQQUdFX1NISUZUOworCXVuc2lnbmVkIGxvbmcgYWxpZ24gPSBn
ZXRfb3JkZXIoc2l6ZSk7CisJREVGSU5FX0RNQV9CVUZfRVhQT1JUX0lORk8oZXhwX2luZm8pOwor
CXN0cnVjdCBkbWFfYnVmICpkbWFidWY7CisJaW50IHJldCA9IC1FTk9NRU07CisJcGdvZmZfdCBw
ZzsKKworCWlmIChhbGlnbiA+IENPTkZJR19DTUFfQUxJR05NRU5UKQorCQlhbGlnbiA9IENPTkZJ
R19DTUFfQUxJR05NRU5UOworCisJaGVscGVyX2J1ZmZlciA9IGt6YWxsb2Moc2l6ZW9mKCpoZWxw
ZXJfYnVmZmVyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFoZWxwZXJfYnVmZmVyKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCUlOSVRfSEVBUF9IRUxQRVJfQlVGRkVSKGhlbHBlcl9idWZmZXIsIGNtYV9o
ZWFwX2ZyZWUpOworCWhlbHBlcl9idWZmZXItPmhlYXBfYnVmZmVyLmZsYWdzID0gaGVhcF9mbGFn
czsKKwloZWxwZXJfYnVmZmVyLT5oZWFwX2J1ZmZlci5oZWFwID0gaGVhcDsKKwloZWxwZXJfYnVm
ZmVyLT5oZWFwX2J1ZmZlci5zaXplID0gbGVuOworCisJcGFnZXMgPSBjbWFfYWxsb2MoY21hX2hl
YXAtPmNtYSwgbnJfcGFnZXMsIGFsaWduLCBmYWxzZSk7CisJaWYgKCFwYWdlcykKKwkJZ290byBm
cmVlX2J1ZjsKKworCWlmIChQYWdlSGlnaE1lbShwYWdlcykpIHsKKwkJdW5zaWduZWQgbG9uZyBu
cl9jbGVhcl9wYWdlcyA9IG5yX3BhZ2VzOworCQlzdHJ1Y3QgcGFnZSAqcGFnZSA9IHBhZ2VzOwor
CisJCXdoaWxlIChucl9jbGVhcl9wYWdlcyA+IDApIHsKKwkJCXZvaWQgKnZhZGRyID0ga21hcF9h
dG9taWMocGFnZSk7CisKKwkJCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpFKTsKKwkJCWt1bm1h
cF9hdG9taWModmFkZHIpOworCQkJcGFnZSsrOworCQkJbnJfY2xlYXJfcGFnZXMtLTsKKwkJfQor
CX0gZWxzZSB7CisJCW1lbXNldChwYWdlX2FkZHJlc3MocGFnZXMpLCAwLCBzaXplKTsKKwl9CisK
KwloZWxwZXJfYnVmZmVyLT5wYWdlY291bnQgPSBucl9wYWdlczsKKwloZWxwZXJfYnVmZmVyLT5w
YWdlcyA9IGttYWxsb2NfYXJyYXkoaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50LAorCQkJCQkgICAg
IHNpemVvZigqaGVscGVyX2J1ZmZlci0+cGFnZXMpLAorCQkJCQkgICAgIEdGUF9LRVJORUwpOwor
CWlmICghaGVscGVyX2J1ZmZlci0+cGFnZXMpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBm
cmVlX2NtYTsKKwl9CisKKwlmb3IgKHBnID0gMDsgcGcgPCBoZWxwZXJfYnVmZmVyLT5wYWdlY291
bnQ7IHBnKyspIHsKKwkJaGVscGVyX2J1ZmZlci0+cGFnZXNbcGddID0gJnBhZ2VzW3BnXTsKKwkJ
aWYgKCFoZWxwZXJfYnVmZmVyLT5wYWdlc1twZ10pCisJCQlnb3RvIGZyZWVfcGFnZXM7CisJfQor
CisJLyogY3JlYXRlIHRoZSBkbWFidWYgKi8KKwlleHBfaW5mby5vcHMgPSAmaGVhcF9oZWxwZXJf
b3BzOworCWV4cF9pbmZvLnNpemUgPSBsZW47CisJZXhwX2luZm8uZmxhZ3MgPSBmZF9mbGFnczsK
KwlleHBfaW5mby5wcml2ID0gJmhlbHBlcl9idWZmZXItPmhlYXBfYnVmZmVyOworCWRtYWJ1ZiA9
IGRtYV9idWZfZXhwb3J0KCZleHBfaW5mbyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJl
dCA9IFBUUl9FUlIoZG1hYnVmKTsKKwkJZ290byBmcmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9i
dWZmZXItPmhlYXBfYnVmZmVyLmRtYWJ1ZiA9IGRtYWJ1ZjsKKwloZWxwZXJfYnVmZmVyLT5wcml2
X3ZpcnQgPSBwYWdlczsKKworCXJldCA9IGRtYV9idWZfZmQoZG1hYnVmLCBmZF9mbGFncyk7CisJ
aWYgKHJldCA8IDApIHsKKwkJZG1hX2J1Zl9wdXQoZG1hYnVmKTsKKwkJLyoganVzdCByZXR1cm4s
IGFzIHB1dCB3aWxsIGNhbGwgcmVsZWFzZSBhbmQgdGhhdCB3aWxsIGZyZWUgKi8KKwkJcmV0dXJu
IHJldDsKKwl9CisKKwlyZXR1cm4gcmV0OworCitmcmVlX3BhZ2VzOgorCWtmcmVlKGhlbHBlcl9i
dWZmZXItPnBhZ2VzKTsKK2ZyZWVfY21hOgorCWNtYV9yZWxlYXNlKGNtYV9oZWFwLT5jbWEsIHBh
Z2VzLCBucl9wYWdlcyk7CitmcmVlX2J1ZjoKKwlrZnJlZShoZWxwZXJfYnVmZmVyKTsKKwlyZXR1
cm4gcmV0OworfQorCitzdGF0aWMgc3RydWN0IGRtYV9oZWFwX29wcyBjbWFfaGVhcF9vcHMgPSB7
CisJLmFsbG9jYXRlID0gY21hX2hlYXBfYWxsb2NhdGUsCit9OworCitzdGF0aWMgaW50IF9fYWRk
X2NtYV9oZWFwKHN0cnVjdCBjbWEgKmNtYSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgY21hX2hl
YXAgKmNtYV9oZWFwOworCXN0cnVjdCBkbWFfaGVhcF9leHBvcnRfaW5mbyBleHBfaW5mbzsKKwor
CWNtYV9oZWFwID0ga3phbGxvYyhzaXplb2YoKmNtYV9oZWFwKSwgR0ZQX0tFUk5FTCk7CisJaWYg
KCFjbWFfaGVhcCkKKwkJcmV0dXJuIC1FTk9NRU07CisJY21hX2hlYXAtPmNtYSA9IGNtYTsKKwor
CWV4cF9pbmZvLm5hbWUgPSBjbWFfZ2V0X25hbWUoY21hKTsKKwlleHBfaW5mby5vcHMgPSAmY21h
X2hlYXBfb3BzOworCWV4cF9pbmZvLnByaXYgPSBjbWFfaGVhcDsKKworCWNtYV9oZWFwLT5oZWFw
ID0gZG1hX2hlYXBfYWRkKCZleHBfaW5mbyk7CisJaWYgKElTX0VSUihjbWFfaGVhcC0+aGVhcCkp
IHsKKwkJaW50IHJldCA9IFBUUl9FUlIoY21hX2hlYXAtPmhlYXApOworCisJCWtmcmVlKGNtYV9o
ZWFwKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBh
ZGRfY21hX2hlYXBzKHZvaWQpCit7CisJY21hX2Zvcl9lYWNoX2FyZWEoX19hZGRfY21hX2hlYXAs
IE5VTEwpOworCXJldHVybiAwOworfQorZGV2aWNlX2luaXRjYWxsKGFkZF9jbWFfaGVhcHMpOwot
LSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
