Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9A6AAB3D79
	for <lists+dri-devel@lfdr.de>; Mon, 16 Sep 2019 17:18:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 25BE26E9D8;
	Mon, 16 Sep 2019 15:18:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x442.google.com (mail-wr1-x442.google.com
 [IPv6:2a00:1450:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AE44F6E9D8;
 Mon, 16 Sep 2019 15:18:09 +0000 (UTC)
Received: by mail-wr1-x442.google.com with SMTP id i1so38748968wro.4;
 Mon, 16 Sep 2019 08:18:09 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=mXqvvUiDy4nkBsBPvOtVmJhDyx9Y9lgvNHXyYsa9pBU=;
 b=SklHWYRYp98NUc7NBLd8ABMkr9RaVdLzRao2asFWjm7JJIF38sZZa8fB2S4RhvVC6K
 vuRovGULabwOL1aM3X4+z2+4E41MdMzOvOQELkCzaLmEQmPjjcrYDIdNkqYRbC6jmUor
 h3G931FH5RAKP+Ibwrs6Y7cN0CWnVwu+D32tIiBYE3aIdPvmrdehljpjY5E3DbwhEgIH
 1yR0GwmBECLYKpRN061dK0eTGr2ndcDCMhiSsfx625AXSa/Q/uk0wd3PLhUxDnDacD81
 uDdwKUl9DLRO22rgZRXNHDukKUyDkMnMO7lwvUOCj/93OT4y2uHkeXIaU3lBfu/JMU9w
 HmQw==
X-Gm-Message-State: APjAAAUb4QKP9xYXyAKMWuAytBYd/6YnwcxA6lEIcLA6TJRq7JTL+JNw
 Uv1v6sGsdOb8j3QX1rrnDA0=
X-Google-Smtp-Source: APXvYqzse5JF2dn9sGp5w4AyajKzUep08SYL95LF56ZcDBbwK0J4nThHIslY5yPpfP//F0OwvTZTlw==
X-Received: by 2002:adf:f4cd:: with SMTP id h13mr304472wrp.42.1568647088070;
 Mon, 16 Sep 2019 08:18:08 -0700 (PDT)
Received: from localhost (p2E5BE2CE.dip0.t-ipconnect.de. [46.91.226.206])
 by smtp.gmail.com with ESMTPSA id u10sm17205045wrg.55.2019.09.16.08.18.06
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 16 Sep 2019 08:18:07 -0700 (PDT)
From: Thierry Reding <thierry.reding@gmail.com>
To: Ben Skeggs <bskeggs@redhat.com>
Subject: [PATCH 4/6] drm/nouveau: Implement nvkm_memory_aperture()
Date: Mon, 16 Sep 2019 17:17:55 +0200
Message-Id: <20190916151757.10953-5-thierry.reding@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190916151757.10953-1-thierry.reding@gmail.com>
References: <20190916151757.10953-1-thierry.reding@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=mXqvvUiDy4nkBsBPvOtVmJhDyx9Y9lgvNHXyYsa9pBU=;
 b=uh7WHpRGSa2xBxRHXdni/qXfj+SXOg23ZYUMZZ3d++ibAyZLd+NXxapRFrlQzSswUg
 vhZHbJu5laOJz5Y6phFezs0OUsEVra0vc0slksfKvd8ljn8Y/kN9nETe31hm/hpCyeiC
 b2QbFdBv8aSlY+YG4vLrrcgK9gVWrb5OLySZV1zMqAJ7MjmY/6+gdav0C+zhc7VkKvYg
 cM9Ud2x7AwHjnREzooxfBmnxNdNGkchV+QZV4r2+C8/KsSERfGPHOF0fQiZEcKuOQMEU
 /sCv7HQntgNw20vJjyj2wOcy1I+kZv2YHu2uc4yP3Fbi7Tr9+/5sFQ/u31cwOvBmizA1
 TDeA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: nouveau@lists.freedesktop.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlhLmNvbT4KClRoZSBhcGVydHVyZSBv
ZiBhIGJ1ZmZlciBpcyBhbHdheXMgc3BlY2lmaWMgdG8gd2hlcmUgaXRzIG1lbW9yeSB3YXMKYWxs
b2NhdGVkIGZyb20uIEZ1cnRoZXJtb3JlLCB0aGUgZW5jb2Rpbmcgb2YgdGhlIGFwZXJ0dXJlIGlz
IGFsd2F5cwp0aGUgc2FtZSwgcmVnYXJkbGVzcyBvZiBHUFUgZ2VuZXJhdGlvbi4KCkltcGxlbWVu
dCB0aGUgbWVtb3J5IHRhcmdldCB0byBhcGVydHVyZSBjb252ZXJzaW9uIGluIG9uZSBjZW50cmFs
CnBsYWNlIGFuZCBtYWtlIHRoZSBhcGVydHVyZSBpbmRlcGVuZGVudCBvZiB0aGUgVk1NLgoKTm90
ZSB0aGF0IHdlIG5vIGxvbmdlciByZXR1cm4gYSBuZWdhdGl2ZSBlcnJvciBjb2RlIGZvciB1bnN1
cHBvcnRlZAphcGVydHVyZXMuIEZpcnN0LCB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW4gdG8gYmVn
aW4gd2l0aCBhbmQgaXMgYQpwcm9ncmFtbWluZyBlcnJvciwgd2hpY2ggaXMgd2h5IHdlIGhhdmUg
YSBXQVJOIGFscmVhZHkuIFNlY29uZCwgdGhlCnN0YW5kYXJkIGFwZXJ0dXJlICgwLCBWUkFNKSBz
aG91bGQgYmUgY29ycmVjdCBmb3IgdGhlIHZhc3QgbWFqb3JpdHkKb2YgbWVtb3J5IG9iamVjdHMu
IExhc3RseSwgdGhlIGFwZXJ0dXJlIGFsc28gbmVlZHMgdG8gYmUgcHJvZ3JhbW1lZAppbnRvIG1h
bnkgcmVnaXN0ZXJzIGFuZCBpbnN0YW5jZSBibG9ja3MuIEhhdmluZyB0byBjaGVjayBmb3IgZXJy
b3IKY29kZXMgYXQgZXZlcnkgc3RlcCBvZiB0aGUgd2F5IHdvdWxkIG1ha2UgdGhpcyB2ZXJ5IHVu
d2llbGR5LiBJZiBpbgphbnkgY2FzZSB0aGVyZSBpcyBldmVyIGEgcHJvYmxlbSB3aXRoIHRoZSBh
cGVydHVyZSBiZWluZyB3cm9uZywgbGV0CnVzIHJlbHkgb24gdGhlIFdBUk4gdG8gdGVsbCB1cyBh
Ym91dCBpdC4KClNpZ25lZC1vZmYtYnk6IFRoaWVycnkgUmVkaW5nIDx0cmVkaW5nQG52aWRpYS5j
b20+Ci0tLQogLi4uL2RybS9ub3V2ZWF1L2luY2x1ZGUvbnZrbS9jb3JlL21lbW9yeS5oICAgIHwg
MjggKysrKysrKysrKysrKysrKysrKwogLi4uL2RybS9ub3V2ZWF1L252a20vc3ViZGV2L21tdS92
bW1nZjEwMC5jICAgIHwgIDcgKystLS0KIC4uLi9kcm0vbm91dmVhdS9udmttL3N1YmRldi9tbXUv
dm1tZ3AxMDAuYyAgICB8ICA3ICsrLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDM0IGluc2VydGlvbnMo
KyksIDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUv
aW5jbHVkZS9udmttL2NvcmUvbWVtb3J5LmggYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9pbmNs
dWRlL252a20vY29yZS9tZW1vcnkuaAppbmRleCBiMjNiZjYxMDlmMmQuLjI5YzYwZmJlZDE2NyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvaW5jbHVkZS9udmttL2NvcmUvbWVt
b3J5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvaW5jbHVkZS9udmttL2NvcmUvbWVt
b3J5LmgKQEAgLTY0LDYgKzY0LDM0IEBAIHZvaWQgbnZrbV9tZW1vcnlfdGFnc19wdXQoc3RydWN0
IG52a21fbWVtb3J5ICosIHN0cnVjdCBudmttX2RldmljZSAqLAogI2RlZmluZSBudmttX21lbW9y
eV9tYXAocCxvLHZtLHZhLGF2LGFjKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFwKIAkocCktPmZ1bmMtPm1hcCgocCksKG8pLCh2bSksKHZhKSwoYXYpLChhYykpCiAKK3N0
YXRpYyBpbmxpbmUgdTMyCitudmttX21lbW9yeV9hcGVydHVyZShzdHJ1Y3QgbnZrbV9tZW1vcnkg
Km1lbSkKK3sKKwllbnVtIG52a21fbWVtb3J5X3RhcmdldCB0YXJnZXQgPSBudmttX21lbW9yeV90
YXJnZXQobWVtKTsKKworCXN3aXRjaCAodGFyZ2V0KSB7CisJY2FzZSBOVktNX01FTV9UQVJHRVRf
VlJBTToKKwkJcmV0dXJuIDA7CisKKwljYXNlIE5WS01fTUVNX1RBUkdFVF9IT1NUOgorCQlyZXR1
cm4gMjsKKworCWNhc2UgTlZLTV9NRU1fVEFSR0VUX05DT0g6CisJCXJldHVybiAzOworCisJZGVm
YXVsdDoKKwkJYnJlYWs7CisJfQorCisJLyoKKwkgKiBUaGlzIGlzIGludmFsaWQsIHNvIHdhcm4g
YWJvdXQgdGhpcyBsb3VkbHkuIEhvd2V2ZXIsIHJldHVybiAwIHRvCisJICogYXZvaWQgd3JpdGlu
ZyBnYXJiYWdlIGludG8gcmVnaXN0ZXJzLiAwIGlzIHRoZSBWUkFNIGFwZXJ0dXJlIGFuZAorCSAq
IG1pZ2h0IHN0aWxsIHdvcmsgaW4gbW9zdCBjYXNlcy4KKwkgKi8KKwlXQVJOKDEsICJpbnZhbGlk
IG1lbW9yeSB0YXJnZXQ6ICVkXG4iLCB0YXJnZXQpOworCXJldHVybiAwOworfQorCiAvKiBhY2Nl
c3NvciBtYWNyb3MgLSBrbWFwKCkvZG9uZSgpIG11c3QgYnJhY2tldCB1c2Ugb2YgdGhlIG90aGVy
IGFjY2Vzc29yCiAgKiBtYWNyb3MgdG8gZ3VhcmFudGVlIGNvcnJlY3QgYmVoYXZpb3VyIGFjcm9z
cyBhbGwgY2hpcHNldHMKICAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUv
bnZrbS9zdWJkZXYvbW11L3ZtbWdmMTAwLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udmtt
L3N1YmRldi9tbXUvdm1tZ2YxMDAuYwppbmRleCBhYjY0MjRmYWY4NGMuLmZmYTY0YzBkM2VkYSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvbW11L3ZtbWdm
MTAwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnZrbS9zdWJkZXYvbW11L3ZtbWdm
MTAwLmMKQEAgLTI0OCw4ICsyNDgsOSBAQCBnZjEwMF92bW1fdmFsaWQoc3RydWN0IG52a21fdm1t
ICp2bW0sIHZvaWQgKmFyZ3YsIHUzMiBhcmdjLAogCXN0cnVjdCBudmttX2RldmljZSAqZGV2aWNl
ID0gdm1tLT5tbXUtPnN1YmRldi5kZXZpY2U7CiAJc3RydWN0IG52a21fbWVtb3J5ICptZW1vcnkg
PSBtYXAtPm1lbW9yeTsKIAl1OCAga2luZCwgcHJpdiwgcm8sIHZvbDsKLQlpbnQga2luZG4sIGFw
ZXIsIHJldCA9IC1FTk9TWVM7CisJaW50IGtpbmRuLCByZXQgPSAtRU5PU1lTOwogCWNvbnN0IHU4
ICpraW5kbTsKKwl1MzIgYXBlcjsKIAogCW1hcC0+bmV4dCA9ICgxIDw8IHBhZ2UtPnNoaWZ0KSA+
PiA4OwogCW1hcC0+dHlwZSA9IG1hcC0+Y3RhZyA9IDA7CkBAIC0yNzAsOSArMjcxLDcgQEAgZ2Yx
MDBfdm1tX3ZhbGlkKHN0cnVjdCBudmttX3ZtbSAqdm1tLCB2b2lkICphcmd2LCB1MzIgYXJnYywK
IAkJcmV0dXJuIHJldDsKIAl9CiAKLQlhcGVyID0gdm1tLT5mdW5jLT5hcGVyKHRhcmdldCk7Ci0J
aWYgKFdBUk5fT04oYXBlciA8IDApKQotCQlyZXR1cm4gYXBlcjsKKwlhcGVyID0gbnZrbV9tZW1v
cnlfYXBlcnR1cmUobWFwLT5tZW1vcnkpOwogCiAJa2luZG0gPSB2bW0tPm1tdS0+ZnVuYy0+a2lu
ZCh2bW0tPm1tdSwgJmtpbmRuKTsKIAlpZiAoa2luZCA+PSBraW5kbiB8fCBraW5kbVtraW5kXSA9
PSAweGZmKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udmttL3N1YmRl
di9tbXUvdm1tZ3AxMDAuYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L252a20vc3ViZGV2L21t
dS92bW1ncDEwMC5jCmluZGV4IGI0ZjUxOTc2OGQ1ZS4uNGExYTY1ODMyOGU1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udmttL3N1YmRldi9tbXUvdm1tZ3AxMDAuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udmttL3N1YmRldi9tbXUvdm1tZ3AxMDAuYwpAQCAt
MzIxLDggKzMyMSw5IEBAIGdwMTAwX3ZtbV92YWxpZChzdHJ1Y3QgbnZrbV92bW0gKnZtbSwgdm9p
ZCAqYXJndiwgdTMyIGFyZ2MsCiAJc3RydWN0IG52a21fZGV2aWNlICpkZXZpY2UgPSB2bW0tPm1t
dS0+c3ViZGV2LmRldmljZTsKIAlzdHJ1Y3QgbnZrbV9tZW1vcnkgKm1lbW9yeSA9IG1hcC0+bWVt
b3J5OwogCXU4ICBraW5kLCBwcml2LCBybywgdm9sOwotCWludCBraW5kbiwgYXBlciwgcmV0ID0g
LUVOT1NZUzsKKwlpbnQga2luZG4sIHJldCA9IC1FTk9TWVM7CiAJY29uc3QgdTggKmtpbmRtOwor
CXUzMiBhcGVyOwogCiAJbWFwLT5uZXh0ID0gKDFVTEwgPDwgcGFnZS0+c2hpZnQpID4+IDQ7CiAJ
bWFwLT50eXBlID0gMDsKQEAgLTM0Myw5ICszNDQsNyBAQCBncDEwMF92bW1fdmFsaWQoc3RydWN0
IG52a21fdm1tICp2bW0sIHZvaWQgKmFyZ3YsIHUzMiBhcmdjLAogCQlyZXR1cm4gcmV0OwogCX0K
IAotCWFwZXIgPSB2bW0tPmZ1bmMtPmFwZXIodGFyZ2V0KTsKLQlpZiAoV0FSTl9PTihhcGVyIDwg
MCkpCi0JCXJldHVybiBhcGVyOworCWFwZXIgPSBudmttX21lbW9yeV9hcGVydHVyZShtYXAtPm1l
bW9yeSk7CiAKIAlraW5kbSA9IHZtbS0+bW11LT5mdW5jLT5raW5kKHZtbS0+bW11LCAma2luZG4p
OwogCWlmIChraW5kID49IGtpbmRuIHx8IGtpbmRtW2tpbmRdID09IDB4ZmYpIHsKLS0gCjIuMjMu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
