Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E2230E42FF
	for <lists+dri-devel@lfdr.de>; Fri, 25 Oct 2019 07:43:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 88649890A8;
	Fri, 25 Oct 2019 05:43:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [210.61.82.184])
 by gabe.freedesktop.org (Postfix) with ESMTP id DB89989D42
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Oct 2019 05:43:50 +0000 (UTC)
X-UUID: c358acae51034d11a46978edf8d07e86-20191025
X-UUID: c358acae51034d11a46978edf8d07e86-20191025
Received: from mtkexhb01.mediatek.inc [(172.21.101.102)] by
 mailgw02.mediatek.com (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 881382751; Fri, 25 Oct 2019 13:38:46 +0800
Received: from mtkcas07.mediatek.inc (172.21.101.84) by
 mtkmbs01n1.mediatek.inc (172.21.101.68) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Fri, 25 Oct 2019 13:38:42 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas07.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Fri, 25 Oct 2019 13:38:43 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH v2] drm/mediatek: support CMDQ interface in ddp component
Date: Fri, 25 Oct 2019 13:38:43 +0800
Message-ID: <20191025053843.16808-3-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191025053843.16808-1-bibby.hsieh@mediatek.com>
References: <20191025053843.16808-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, srv_heupstream@mediatek.com,
 Yongqiang Niu <yongqiang.niu@mediatek.com>, linux-kernel@vger.kernel.org,
 tfiga@chromium.org, Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIENNRFEgKENvbW1hbmQgUXVldWUpIGluIE1UODE4MyBpcyB1c2VkIHRvIGhlbHAKdXBkYXRl
IGFsbCByZWxldmFudCBkaXNwbGF5IGNvbnRyb2xsZXIgcmVnaXN0ZXJzCndpdGggY3JpdGljYWwg
dGltZSBsaW1hdGlvbi4KVGhpcyBwYXRjaCBhZGQgY21kcSBpbnRlcmZhY2UgaW4gZGRwX2NvbXAg
aW50ZXJmYWNlLApsZXQgYWxsIGRkcF9jb21wIGludGVyZmFjZSBjYW4gc3VwcG9ydCBjcHUvY21k
cSBmdW5jdGlvbgphdCB0aGUgc2FtZSB0aW1lLgoKVGhpcyBwYXRjaCBkZXBlbmRzIG9uIHB0YWNo
OgphZGQgZHJtIHN1cHBvcnQgZm9yIE1UODE4MwooaHR0cHM6Ly9wYXRjaHdvcmsua2VybmVsLm9y
Zy9jb3Zlci8xMTEyMTUxOS8pCnN1cHBvcnQgZ2NlIG9uIG10ODE4MyBwbGF0Zm9ybQooaHR0cHM6
Ly9wYXRjaHdvcmsua2VybmVsLm9yZy9jb3Zlci8xMTIwODMxNS8pCgpDaGFuZ2VzIHNpbmNlIHYx
OgogLSByZW1vdmUgdW5uZWNlc3NhcnkgY2hhbmdlCiAtIGZpeHVwIGluZGVudAoKU2lnbmVkLW9m
Zi1ieTogWVQgU2hlbiA8eXQuc2hlbkBtZWRpYXRlay5jb20+ClNpZ25lZC1vZmYtYnk6IENLIEh1
IDxjay5odUBtZWRpYXRlay5jb20+ClNpZ25lZC1vZmYtYnk6IFBoaWxpcHAgWmFiZWwgPHAuemFi
ZWxAcGVuZ3V0cm9uaXguZGU+ClNpZ25lZC1vZmYtYnk6IEJpYmJ5IEhzaWVoIDxiaWJieS5oc2ll
aEBtZWRpYXRlay5jb20+ClNpZ25lZC1vZmYtYnk6IFlvbmdxaWFuZyBOaXUgPHlvbmdxaWFuZy5u
aXVAbWVkaWF0ZWsuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9j
b2xvci5jICAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9vdmwu
YyAgICAgfCAgNjUgKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlz
cF9yZG1hLmMgICAgfCAgNDMgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX2RkcF9jb21wLmMgfCAxMTQgKysrKysrKysrKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9tZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmggfCAgNTMgKysrKystLS0tCiA1IGZpbGVzIGNo
YW5nZWQsIDE3NiBpbnNlcnRpb25zKCspLCAxMDYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNwX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vbWVkaWF0ZWsvbXRrX2Rpc3BfY29sb3IuYwppbmRleCA1OWRlMmE0NmFhNDkuLjZmYjBkNjk4
M2E0YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNwX2NvbG9y
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNwX2NvbG9yLmMKQEAgLTks
NiArOSw3IEBACiAjaW5jbHVkZSA8bGludXgvb2ZfZGV2aWNlLmg+CiAjaW5jbHVkZSA8bGludXgv
b2ZfaXJxLmg+CiAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8
bGludXgvc29jL21lZGlhdGVrL210ay1jbWRxLmg+CiAKICNpbmNsdWRlICJtdGtfZHJtX2NydGMu
aCIKICNpbmNsdWRlICJtdGtfZHJtX2RkcF9jb21wLmgiCkBAIC00NSwxMiArNDYsMTIgQEAgc3Rh
dGljIGlubGluZSBzdHJ1Y3QgbXRrX2Rpc3BfY29sb3IgKmNvbXBfdG9fY29sb3Ioc3RydWN0IG10
a19kZHBfY29tcCAqY29tcCkKIAogc3RhdGljIHZvaWQgbXRrX2NvbG9yX2NvbmZpZyhzdHJ1Y3Qg
bXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgdywKIAkJCSAgICAgdW5zaWduZWQgaW50
IGgsIHVuc2lnbmVkIGludCB2cmVmcmVzaCwKLQkJCSAgICAgdW5zaWduZWQgaW50IGJwYykKKwkJ
CSAgICAgdW5zaWduZWQgaW50IGJwYywgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKIAlz
dHJ1Y3QgbXRrX2Rpc3BfY29sb3IgKmNvbG9yID0gY29tcF90b19jb2xvcihjb21wKTsKIAotCXdy
aXRlbCh3LCBjb21wLT5yZWdzICsgRElTUF9DT0xPUl9XSURUSChjb2xvcikpOwotCXdyaXRlbCho
LCBjb21wLT5yZWdzICsgRElTUF9DT0xPUl9IRUlHSFQoY29sb3IpKTsKKwltdGtfZGRwX3dyaXRl
KGNtZHFfcGt0LCB3LCBjb21wLCBESVNQX0NPTE9SX1dJRFRIKGNvbG9yKSk7CisJbXRrX2RkcF93
cml0ZShjbWRxX3BrdCwgaCwgY29tcCwgRElTUF9DT0xPUl9IRUlHSFQoY29sb3IpKTsKIH0KIAog
c3RhdGljIHZvaWQgbXRrX2NvbG9yX3N0YXJ0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3Bfb3ZsLmMgYi9kcml2
ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3Bfb3ZsLmMKaW5kZXggZDExYzIwZjIxMmU1Li4x
YTFiNTBmNGU5YWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlz
cF9vdmwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Rpc3Bfb3ZsLmMKQEAg
LTEwLDYgKzEwLDcgQEAKICNpbmNsdWRlIDxsaW51eC9vZl9pcnEuaD4KICNpbmNsdWRlIDxsaW51
eC9wbGF0Zm9ybV9kZXZpY2UuaD4KICNpbmNsdWRlIDxsaW51eC9wbV9ydW50aW1lLmg+CisjaW5j
bHVkZSA8bGludXgvc29jL21lZGlhdGVrL210ay1jbWRxLmg+CiAKICNpbmNsdWRlICJtdGtfZHJt
X2NydGMuaCIKICNpbmNsdWRlICJtdGtfZHJtX2RkcF9jb21wLmgiCkBAIC0xMjEsMTQgKzEyMiwx
NSBAQCBzdGF0aWMgdm9pZCBtdGtfb3ZsX3N0b3Aoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkK
IAogc3RhdGljIHZvaWQgbXRrX292bF9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwg
dW5zaWduZWQgaW50IHcsCiAJCQkgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQgaW50IHZyZWZy
ZXNoLAotCQkJICAgdW5zaWduZWQgaW50IGJwYykKKwkJCSAgIHVuc2lnbmVkIGludCBicGMsIHN0
cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7CiAJaWYgKHcgIT0gMCAmJiBoICE9IDApCi0JCXdy
aXRlbF9yZWxheGVkKGggPDwgMTYgfCB3LCBjb21wLT5yZWdzICsgRElTUF9SRUdfT1ZMX1JPSV9T
SVpFKTsKLQl3cml0ZWxfcmVsYXhlZCgweDAsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfUk9J
X0JHQ0xSKTsKKwkJbXRrX2RkcF93cml0ZV9yZWxheGVkKGNtZHFfcGt0LCBoIDw8IDE2IHwgdywg
Y29tcCwKKwkJCQkgICAgICBESVNQX1JFR19PVkxfUk9JX1NJWkUpOworCW10a19kZHBfd3JpdGVf
cmVsYXhlZChjbWRxX3BrdCwgMHgwLCBjb21wLCBESVNQX1JFR19PVkxfUk9JX0JHQ0xSKTsKIAot
CXdyaXRlbCgweDEsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfUlNUKTsKLQl3cml0ZWwoMHgw
LCBjb21wLT5yZWdzICsgRElTUF9SRUdfT1ZMX1JTVCk7CisJbXRrX2RkcF93cml0ZShjbWRxX3Br
dCwgMHgxLCBjb21wLCBESVNQX1JFR19PVkxfUlNUKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0
LCAweDAsIGNvbXAsIERJU1BfUkVHX09WTF9SU1QpOwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50
IG10a19vdmxfbGF5ZXJfbnIoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKQEAgLTEzOCwxNiAr
MTQwLDE2IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgbXRrX292bF9sYXllcl9ucihzdHJ1Y3QgbXRr
X2RkcF9jb21wICpjb21wKQogCXJldHVybiBvdmwtPmRhdGEtPmxheWVyX25yOwogfQogCi1zdGF0
aWMgdm9pZCBtdGtfb3ZsX2xheWVyX29uKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2ln
bmVkIGludCBpZHgpCitzdGF0aWMgdm9pZCBtdGtfb3ZsX2xheWVyX29uKHN0cnVjdCBtdGtfZGRw
X2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBpZHgsCisJCQkgICAgIHN0cnVjdCBjbWRxX3BrdCAq
Y21kcV9wa3QpCiB7Ci0JdW5zaWduZWQgaW50IHJlZzsKIAl1bnNpZ25lZCBpbnQgZ21jX3RocnNo
ZF9sOwogCXVuc2lnbmVkIGludCBnbWNfdGhyc2hkX2g7CiAJdW5zaWduZWQgaW50IGdtY192YWx1
ZTsKIAlzdHJ1Y3QgbXRrX2Rpc3Bfb3ZsICpvdmwgPSBjb21wX3RvX292bChjb21wKTsKIAotCXdy
aXRlbCgweDEsIGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfUkRNQV9DVFJMKGlkeCkpOwotCisJ
bXRrX2RkcF93cml0ZShjbWRxX3BrdCwgMHgxLCBjb21wLAorCQkgICAgICBESVNQX1JFR19PVkxf
UkRNQV9DVFJMKGlkeCkpOwogCWdtY190aHJzaGRfbCA9IEdNQ19USFJFU0hPTERfTE9XID4+CiAJ
CSAgICAgIChHTUNfVEhSRVNIT0xEX0JJVFMgLSBvdmwtPmRhdGEtPmdtY19iaXRzKTsKIAlnbWNf
dGhyc2hkX2ggPSBHTUNfVEhSRVNIT0xEX0hJR0ggPj4KQEAgLTE1NywyMiArMTU5LDE5IEBAIHN0
YXRpYyB2b2lkIG10a19vdmxfbGF5ZXJfb24oc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5z
aWduZWQgaW50IGlkeCkKIAllbHNlCiAJCWdtY192YWx1ZSA9IGdtY190aHJzaGRfbCB8IGdtY190
aHJzaGRfbCA8PCA4IHwKIAkJCSAgICBnbWNfdGhyc2hkX2ggPDwgMTYgfCBnbWNfdGhyc2hkX2gg
PDwgMjQ7Ci0Jd3JpdGVsKGdtY192YWx1ZSwgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9SRE1B
X0dNQyhpZHgpKTsKLQotCXJlZyA9IHJlYWRsKGNvbXAtPnJlZ3MgKyBESVNQX1JFR19PVkxfU1JD
X0NPTik7Ci0JcmVnID0gcmVnIHwgQklUKGlkeCk7Ci0Jd3JpdGVsKHJlZywgY29tcC0+cmVncyAr
IERJU1BfUkVHX09WTF9TUkNfQ09OKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCBnbWNfdmFs
dWUsCisJCSAgICAgIGNvbXAsIERJU1BfUkVHX09WTF9SRE1BX0dNQyhpZHgpKTsKKwltdGtfZGRw
X3dyaXRlX21hc2soY21kcV9wa3QsIEJJVChpZHgpLCBjb21wLAorCQkJICAgRElTUF9SRUdfT1ZM
X1NSQ19DT04sIEJJVChpZHgpKTsKIH0KIAotc3RhdGljIHZvaWQgbXRrX292bF9sYXllcl9vZmYo
c3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCkKK3N0YXRpYyB2b2lk
IG10a19vdmxfbGF5ZXJfb2ZmKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGlu
dCBpZHgsCisJCQkgICAgICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewotCXVuc2lnbmVk
IGludCByZWc7Ci0KLQlyZWcgPSByZWFkbChjb21wLT5yZWdzICsgRElTUF9SRUdfT1ZMX1NSQ19D
T04pOwotCXJlZyA9IHJlZyAmIH5CSVQoaWR4KTsKLQl3cml0ZWwocmVnLCBjb21wLT5yZWdzICsg
RElTUF9SRUdfT1ZMX1NSQ19DT04pOwotCi0Jd3JpdGVsKDB4MCwgY29tcC0+cmVncyArIERJU1Bf
UkVHX09WTF9SRE1BX0NUUkwoaWR4KSk7CisJbXRrX2RkcF93cml0ZV9tYXNrKGNtZHFfcGt0LCAw
LCBjb21wLAorCQkJICAgRElTUF9SRUdfT1ZMX1NSQ19DT04sIEJJVChpZHgpKTsKKwltdGtfZGRw
X3dyaXRlKGNtZHFfcGt0LCAwLCBjb21wLAorCQkgICAgICBESVNQX1JFR19PVkxfUkRNQV9DVFJM
KGlkeCkpOwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50IG92bF9mbXRfY29udmVydChzdHJ1Y3Qg
bXRrX2Rpc3Bfb3ZsICpvdmwsIHVuc2lnbmVkIGludCBmbXQpCkBAIC0yMTIsNyArMjExLDggQEAg
c3RhdGljIHVuc2lnbmVkIGludCBvdmxfZm10X2NvbnZlcnQoc3RydWN0IG10a19kaXNwX292bCAq
b3ZsLCB1bnNpZ25lZCBpbnQgZm10KQogfQogCiBzdGF0aWMgdm9pZCBtdGtfb3ZsX2xheWVyX2Nv
bmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAotCQkJCSBz
dHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpzdGF0ZSkKKwkJCQkgc3RydWN0IG10a19wbGFuZV9zdGF0
ZSAqc3RhdGUsCisJCQkJIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7CiAJc3RydWN0IG10
a19kaXNwX292bCAqb3ZsID0gY29tcF90b19vdmwoY29tcCk7CiAJc3RydWN0IG10a19wbGFuZV9w
ZW5kaW5nX3N0YXRlICpwZW5kaW5nID0gJnN0YXRlLT5wZW5kaW5nOwpAQCAtMjI0LDIwICsyMjQs
MjUgQEAgc3RhdGljIHZvaWQgbXRrX292bF9sYXllcl9jb25maWcoc3RydWN0IG10a19kZHBfY29t
cCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCwKIAl1bnNpZ25lZCBpbnQgY29uOwogCiAJaWYgKCFw
ZW5kaW5nLT5lbmFibGUpCi0JCW10a19vdmxfbGF5ZXJfb2ZmKGNvbXAsIGlkeCk7CisJCW10a19v
dmxfbGF5ZXJfb2ZmKGNvbXAsIGlkeCwgY21kcV9wa3QpOwogCiAJY29uID0gb3ZsX2ZtdF9jb252
ZXJ0KG92bCwgZm10KTsKIAlpZiAoaWR4ICE9IDApCiAJCWNvbiB8PSBPVkxfQ09OX0FFTiB8IE9W
TF9DT05fQUxQSEE7CiAKLQl3cml0ZWxfcmVsYXhlZChjb24sIGNvbXAtPnJlZ3MgKyBESVNQX1JF
R19PVkxfQ09OKGlkeCkpOwotCXdyaXRlbF9yZWxheGVkKHBpdGNoLCBjb21wLT5yZWdzICsgRElT
UF9SRUdfT1ZMX1BJVENIKGlkeCkpOwotCXdyaXRlbF9yZWxheGVkKHNyY19zaXplLCBjb21wLT5y
ZWdzICsgRElTUF9SRUdfT1ZMX1NSQ19TSVpFKGlkeCkpOwotCXdyaXRlbF9yZWxheGVkKG9mZnNl
dCwgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9PRkZTRVQoaWR4KSk7Ci0Jd3JpdGVsX3JlbGF4
ZWQoYWRkciwgY29tcC0+cmVncyArIERJU1BfUkVHX09WTF9BRERSKG92bCwgaWR4KSk7CisJbXRr
X2RkcF93cml0ZV9yZWxheGVkKGNtZHFfcGt0LCBjb24sIGNvbXAsCisJCQkgICAgICBESVNQX1JF
R19PVkxfQ09OKGlkeCkpOworCW10a19kZHBfd3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgcGl0Y2gs
IGNvbXAsCisJCQkgICAgICBESVNQX1JFR19PVkxfUElUQ0goaWR4KSk7CisJbXRrX2RkcF93cml0
ZV9yZWxheGVkKGNtZHFfcGt0LCBzcmNfc2l6ZSwgY29tcCwKKwkJCSAgICAgIERJU1BfUkVHX09W
TF9TUkNfU0laRShpZHgpKTsKKwltdGtfZGRwX3dyaXRlX3JlbGF4ZWQoY21kcV9wa3QsIG9mZnNl
dCwgY29tcCwKKwkJCSAgICAgIERJU1BfUkVHX09WTF9PRkZTRVQoaWR4KSk7CisJbXRrX2RkcF93
cml0ZV9yZWxheGVkKGNtZHFfcGt0LCBhZGRyLCBjb21wLAorCQkJICAgICAgRElTUF9SRUdfT1ZM
X0FERFIob3ZsLCBpZHgpKTsKIAogCWlmIChwZW5kaW5nLT5lbmFibGUpCi0JCW10a19vdmxfbGF5
ZXJfb24oY29tcCwgaWR4KTsKKwkJbXRrX292bF9sYXllcl9vbihjb21wLCBpZHgsIGNtZHFfcGt0
KTsKIH0KIAogc3RhdGljIHZvaWQgbXRrX292bF9iZ2Nscl9pbl9vbihzdHJ1Y3QgbXRrX2RkcF9j
b21wICpjb21wKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kaXNw
X3JkbWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZGlzcF9yZG1hLmMKaW5kZXgg
MTVjYzRhZTg0YWVlLi5jMWFiZGUzNzQzYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9t
ZWRpYXRlay9tdGtfZGlzcF9yZG1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kaXNwX3JkbWEuYwpAQCAtMTAsNiArMTAsNyBAQAogI2luY2x1ZGUgPGxpbnV4L29mX2lycS5o
PgogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgogI2luY2x1ZGUgPGxpbnV4L3Bt
X3J1bnRpbWUuaD4KKyNpbmNsdWRlIDxsaW51eC9zb2MvbWVkaWF0ZWsvbXRrLWNtZHEuaD4KIAog
I2luY2x1ZGUgIm10a19kcm1fY3J0Yy5oIgogI2luY2x1ZGUgIm10a19kcm1fZGRwX2NvbXAuaCIK
QEAgLTEyNywxNSArMTI4LDE3IEBAIHN0YXRpYyB2b2lkIG10a19yZG1hX3N0b3Aoc3RydWN0IG10
a19kZHBfY29tcCAqY29tcCkKIAogc3RhdGljIHZvaWQgbXRrX3JkbWFfY29uZmlnKHN0cnVjdCBt
dGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCB3aWR0aCwKIAkJCSAgICB1bnNpZ25lZCBp
bnQgaGVpZ2h0LCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCi0JCQkgICAgdW5zaWduZWQgaW50IGJw
YykKKwkJCSAgICB1bnNpZ25lZCBpbnQgYnBjLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQog
ewogCXVuc2lnbmVkIGludCB0aHJlc2hvbGQ7CiAJdW5zaWduZWQgaW50IHJlZzsKIAlzdHJ1Y3Qg
bXRrX2Rpc3BfcmRtYSAqcmRtYSA9IGNvbXBfdG9fcmRtYShjb21wKTsKIAl1MzIgcmRtYV9maWZv
X3NpemU7CiAKLQlyZG1hX3VwZGF0ZV9iaXRzKGNvbXAsIERJU1BfUkVHX1JETUFfU0laRV9DT05f
MCwgMHhmZmYsIHdpZHRoKTsKLQlyZG1hX3VwZGF0ZV9iaXRzKGNvbXAsIERJU1BfUkVHX1JETUFf
U0laRV9DT05fMSwgMHhmZmZmZiwgaGVpZ2h0KTsKKwltdGtfZGRwX3dyaXRlX21hc2soY21kcV9w
a3QsIHdpZHRoLCBjb21wLAorCQkJICAgRElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLCAweGZmZik7
CisJbXRrX2RkcF93cml0ZV9tYXNrKGNtZHFfcGt0LCBoZWlnaHQsIGNvbXAsCisJCQkgICBESVNQ
X1JFR19SRE1BX1NJWkVfQ09OXzEsIDB4ZmZmZmYpOwogCiAJaWYgKHJkbWEtPmZpZm9fc2l6ZSkK
IAkJcmRtYV9maWZvX3NpemUgPSByZG1hLT5maWZvX3NpemU7CkBAIC0xNTIsNyArMTU1LDcgQEAg
c3RhdGljIHZvaWQgbXRrX3JkbWFfY29uZmlnKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVu
c2lnbmVkIGludCB3aWR0aCwKIAlyZWcgPSBSRE1BX0ZJRk9fVU5ERVJGTE9XX0VOIHwKIAkgICAg
ICBSRE1BX0ZJRk9fUFNFVURPX1NJWkUocmRtYV9maWZvX3NpemUpIHwKIAkgICAgICBSRE1BX09V
VFBVVF9WQUxJRF9GSUZPX1RIUkVTSE9MRCh0aHJlc2hvbGQpOwotCXdyaXRlbChyZWcsIGNvbXAt
PnJlZ3MgKyBESVNQX1JFR19SRE1BX0ZJRk9fQ09OKTsKKwltdGtfZGRwX3dyaXRlKGNtZHFfcGt0
LCByZWcsIGNvbXAsIERJU1BfUkVHX1JETUFfRklGT19DT04pOwogfQogCiBzdGF0aWMgdW5zaWdu
ZWQgaW50IHJkbWFfZm10X2NvbnZlcnQoc3RydWN0IG10a19kaXNwX3JkbWEgKnJkbWEsCkBAIC0x
OTgsNyArMjAxLDggQEAgc3RhdGljIHVuc2lnbmVkIGludCBtdGtfcmRtYV9sYXllcl9ucihzdHJ1
Y3QgbXRrX2RkcF9jb21wICpjb21wKQogfQogCiBzdGF0aWMgdm9pZCBtdGtfcmRtYV9sYXllcl9j
b25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCwKLQkJCQkg
IHN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRlKQorCQkJCSAgc3RydWN0IG10a19wbGFuZV9z
dGF0ZSAqc3RhdGUsCisJCQkJICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCXN0cnVj
dCBtdGtfZGlzcF9yZG1hICpyZG1hID0gY29tcF90b19yZG1hKGNvbXApOwogCXN0cnVjdCBtdGtf
cGxhbmVfcGVuZGluZ19zdGF0ZSAqcGVuZGluZyA9ICZzdGF0ZS0+cGVuZGluZzsKQEAgLTIwOCwy
NCArMjEyLDI3IEBAIHN0YXRpYyB2b2lkIG10a19yZG1hX2xheWVyX2NvbmZpZyhzdHJ1Y3QgbXRr
X2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4LAogCXVuc2lnbmVkIGludCBjb247CiAK
IAljb24gPSByZG1hX2ZtdF9jb252ZXJ0KHJkbWEsIGZtdCk7Ci0Jd3JpdGVsX3JlbGF4ZWQoY29u
LCBjb21wLT5yZWdzICsgRElTUF9SRE1BX01FTV9DT04pOworCW10a19kZHBfd3JpdGVfcmVsYXhl
ZChjbWRxX3BrdCwgY29uLCBjb21wLCBESVNQX1JETUFfTUVNX0NPTik7CiAKIAlpZiAoZm10ID09
IERSTV9GT1JNQVRfVVlWWSB8fCBmbXQgPT0gRFJNX0ZPUk1BVF9ZVVlWKSB7Ci0JCXJkbWFfdXBk
YXRlX2JpdHMoY29tcCwgRElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJCSBSRE1BX01BVFJJ
WF9FTkFCTEUsIFJETUFfTUFUUklYX0VOQUJMRSk7Ci0JCXJkbWFfdXBkYXRlX2JpdHMoY29tcCwg
RElTUF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJCSBSRE1BX01BVFJJWF9JTlRfTVRYX1NFTCwK
LQkJCQkgUkRNQV9NQVRSSVhfSU5UX01UWF9CVDYwMV90b19SR0IpOworCQltdGtfZGRwX3dyaXRl
X21hc2soY21kcV9wa3QsIFJETUFfTUFUUklYX0VOQUJMRSwgY29tcCwKKwkJCQkgICBESVNQX1JF
R19SRE1BX1NJWkVfQ09OXzAsCisJCQkJICAgUkRNQV9NQVRSSVhfRU5BQkxFKTsKKwkJbXRrX2Rk
cF93cml0ZV9tYXNrKGNtZHFfcGt0LCBSRE1BX01BVFJJWF9JTlRfTVRYX0JUNjAxX3RvX1JHQiwK
KwkJCQkgICBjb21wLCBESVNQX1JFR19SRE1BX1NJWkVfQ09OXzAsCisJCQkJICAgUkRNQV9NQVRS
SVhfSU5UX01UWF9TRUwpOwogCX0gZWxzZSB7Ci0JCXJkbWFfdXBkYXRlX2JpdHMoY29tcCwgRElT
UF9SRUdfUkRNQV9TSVpFX0NPTl8wLAotCQkJCSBSRE1BX01BVFJJWF9FTkFCTEUsIDApOworCQlt
dGtfZGRwX3dyaXRlX21hc2soY21kcV9wa3QsIDAsIGNvbXAsCisJCQkJICAgRElTUF9SRUdfUkRN
QV9TSVpFX0NPTl8wLAorCQkJCSAgIFJETUFfTUFUUklYX0VOQUJMRSk7CiAJfQorCW10a19kZHBf
d3JpdGVfcmVsYXhlZChjbWRxX3BrdCwgYWRkciwgY29tcCwgRElTUF9SRE1BX01FTV9TVEFSVF9B
RERSKTsKKwltdGtfZGRwX3dyaXRlX3JlbGF4ZWQoY21kcV9wa3QsIHBpdGNoLCBjb21wLCBESVNQ
X1JETUFfTUVNX1NSQ19QSVRDSCk7CisJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgUkRNQV9NRU1f
R01DLCBjb21wLAorCQkgICAgICBESVNQX1JETUFfTUVNX0dNQ19TRVRUSU5HXzApOworCW10a19k
ZHBfd3JpdGVfbWFzayhjbWRxX3BrdCwgUkRNQV9NT0RFX01FTU9SWSwgY29tcCwKKwkJCSAgIERJ
U1BfUkVHX1JETUFfR0xPQkFMX0NPTiwgUkRNQV9NT0RFX01FTU9SWSk7CiAKLQl3cml0ZWxfcmVs
YXhlZChhZGRyLCBjb21wLT5yZWdzICsgRElTUF9SRE1BX01FTV9TVEFSVF9BRERSKTsKLQl3cml0
ZWxfcmVsYXhlZChwaXRjaCwgY29tcC0+cmVncyArIERJU1BfUkRNQV9NRU1fU1JDX1BJVENIKTsK
LQl3cml0ZWwoUkRNQV9NRU1fR01DLCBjb21wLT5yZWdzICsgRElTUF9SRE1BX01FTV9HTUNfU0VU
VElOR18wKTsKLQlyZG1hX3VwZGF0ZV9iaXRzKGNvbXAsIERJU1BfUkVHX1JETUFfR0xPQkFMX0NP
TiwKLQkJCSBSRE1BX01PREVfTUVNT1JZLCBSRE1BX01PREVfTUVNT1JZKTsKIH0KIAogc3RhdGlj
IGNvbnN0IHN0cnVjdCBtdGtfZGRwX2NvbXBfZnVuY3MgbXRrX2Rpc3BfcmRtYV9mdW5jcyA9IHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kZHBfY29tcC5jCmluZGV4IDM0MDdk
MzhhZmY4Zi4uMGFiZTQ3MjQ2NDgzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0
ZWsvbXRrX2RybV9kZHBfY29tcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX2RkcF9jb21wLmMKQEAgLTEyLDcgKzEyLDggQEAKICNpbmNsdWRlIDxsaW51eC9vZl9pcnEu
aD4KICNpbmNsdWRlIDxsaW51eC9vZl9wbGF0Zm9ybS5oPgogI2luY2x1ZGUgPGxpbnV4L3BsYXRm
b3JtX2RldmljZS5oPgotCisjaW5jbHVkZSA8ZHJtL2RybVAuaD4KKyNpbmNsdWRlIDxsaW51eC9z
b2MvbWVkaWF0ZWsvbXRrLWNtZHEuaD4KICNpbmNsdWRlICJtdGtfZHJtX2Rydi5oIgogI2luY2x1
ZGUgIm10a19kcm1fcGxhbmUuaCIKICNpbmNsdWRlICJtdGtfZHJtX2RkcF9jb21wLmgiCkBAIC03
NiwzNiArNzcsNzYgQEAKICNkZWZpbmUgRElUSEVSX0FERF9MU0hJRlRfRyh4KQkJCSgoKHgpICYg
MHg3KSA8PCA0KQogI2RlZmluZSBESVRIRVJfQUREX1JTSElGVF9HKHgpCQkJKCgoeCkgJiAweDcp
IDw8IDApCiAKK3ZvaWQgbXRrX2RkcF93cml0ZShzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0LCB1
bnNpZ25lZCBpbnQgdmFsdWUsCisJCSAgIHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2ln
bmVkIGludCBvZmZzZXQpCit7CisJaWYgKElTX0VOQUJMRUQoQ09ORklHX01US19DTURRKSAmJiBj
bWRxX3BrdCkKKwkJY21kcV9wa3Rfd3JpdGUoY21kcV9wa3QsIGNvbXAtPnN1YnN5cywKKwkJCSAg
ICAgICBjb21wLT5yZWdzX3BhICsgb2Zmc2V0LCB2YWx1ZSk7CisJZWxzZQorCQl3cml0ZWwodmFs
dWUsIGNvbXAtPnJlZ3MgKyBvZmZzZXQpOworfQorCit2b2lkIG10a19kZHBfd3JpdGVfcmVsYXhl
ZChzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0LCB1bnNpZ25lZCBpbnQgdmFsdWUsCisJCQkgICBz
dHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAorCQkJICAgdW5zaWduZWQgaW50IG9mZnNldCkKK3sK
KwlpZiAoSVNfRU5BQkxFRChDT05GSUdfTVRLX0NNRFEpICYmIGNtZHFfcGt0KQorCQljbWRxX3Br
dF93cml0ZShjbWRxX3BrdCwgY29tcC0+c3Vic3lzLAorCQkJICAgICAgIGNvbXAtPnJlZ3NfcGEg
KyBvZmZzZXQsIHZhbHVlKTsKKwllbHNlCisJCXdyaXRlbF9yZWxheGVkKHZhbHVlLCBjb21wLT5y
ZWdzICsgb2Zmc2V0KTsKK30KKwordm9pZCBtdGtfZGRwX3dyaXRlX21hc2soc3RydWN0IGNtZHFf
cGt0ICpjbWRxX3BrdCwKKwkJCXVuc2lnbmVkIGludCB2YWx1ZSwKKwkJCXN0cnVjdCBtdGtfZGRw
X2NvbXAgKmNvbXAsCisJCQl1bnNpZ25lZCBpbnQgb2Zmc2V0LAorCQkJdW5zaWduZWQgaW50IG1h
c2spCit7CisJaWYgKElTX0VOQUJMRUQoQ09ORklHX01US19DTURRKSAmJiBjbWRxX3BrdCkgewor
CQljbWRxX3BrdF93cml0ZV9tYXNrKGNtZHFfcGt0LCBjb21wLT5zdWJzeXMsCisJCQkJICAgIGNv
bXAtPnJlZ3NfcGEgKyBvZmZzZXQsIHZhbHVlLCBtYXNrKTsKKwl9IGVsc2UgeworCQl1MzIgdG1w
ID0gcmVhZGwoY29tcC0+cmVncyArIG9mZnNldCk7CisKKwkJdG1wID0gKHRtcCAmIH5tYXNrKSB8
ICh2YWx1ZSAmIG1hc2spOworCQl3cml0ZWwodG1wLCBjb21wLT5yZWdzICsgb2Zmc2V0KTsKKwl9
Cit9CisKIHZvaWQgbXRrX2RpdGhlcl9zZXQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5z
aWduZWQgaW50IGJwYywKLQkJICAgIHVuc2lnbmVkIGludCBDRkcpCisJCSAgICB1bnNpZ25lZCBp
bnQgQ0ZHLCBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCS8qIElmIGJwYyBlcXVhbCB0
byAwLCB0aGUgZGl0aGVyaW5nIGZ1bmN0aW9uIGRpZG4ndCBiZSBlbmFibGVkICovCiAJaWYgKGJw
YyA9PSAwKQogCQlyZXR1cm47CiAKIAlpZiAoYnBjID49IE1US19NSU5fQlBDKSB7Ci0JCXdyaXRl
bCgwLCBjb21wLT5yZWdzICsgRElTUF9ESVRIRVJfNSk7Ci0JCXdyaXRlbCgwLCBjb21wLT5yZWdz
ICsgRElTUF9ESVRIRVJfNyk7Ci0JCXdyaXRlbChESVRIRVJfTFNCX0VSUl9TSElGVF9SKE1US19N
QVhfQlBDIC0gYnBjKSB8Ci0JCSAgICAgICBESVRIRVJfQUREX0xTSElGVF9SKE1US19NQVhfQlBD
IC0gYnBjKSB8Ci0JCSAgICAgICBESVRIRVJfTkVXX0JJVF9NT0RFLAotCQkgICAgICAgY29tcC0+
cmVncyArIERJU1BfRElUSEVSXzE1KTsKLQkJd3JpdGVsKERJVEhFUl9MU0JfRVJSX1NISUZUX0Io
TVRLX01BWF9CUEMgLSBicGMpIHwKLQkJICAgICAgIERJVEhFUl9BRERfTFNISUZUX0IoTVRLX01B
WF9CUEMgLSBicGMpIHwKLQkJICAgICAgIERJVEhFUl9MU0JfRVJSX1NISUZUX0coTVRLX01BWF9C
UEMgLSBicGMpIHwKLQkJICAgICAgIERJVEhFUl9BRERfTFNISUZUX0coTVRLX01BWF9CUEMgLSBi
cGMpLAotCQkgICAgICAgY29tcC0+cmVncyArIERJU1BfRElUSEVSXzE2KTsKLQkJd3JpdGVsKERJ
U1BfRElUSEVSSU5HLCBjb21wLT5yZWdzICsgQ0ZHKTsKKwkJbXRrX2RkcF93cml0ZShjbWRxX3Br
dCwgMCwgY29tcCwgRElTUF9ESVRIRVJfNSk7CisJCW10a19kZHBfd3JpdGUoY21kcV9wa3QsIDAs
IGNvbXAsIERJU1BfRElUSEVSXzcpOworCQltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LAorCQkJICAg
ICAgRElUSEVSX0xTQl9FUlJfU0hJRlRfUihNVEtfTUFYX0JQQyAtIGJwYykgfAorCQkJICAgICAg
RElUSEVSX0FERF9MU0hJRlRfUihNVEtfTUFYX0JQQyAtIGJwYykgfAorCQkJICAgICAgRElUSEVS
X05FV19CSVRfTU9ERSwKKwkJCSAgICAgIGNvbXAsIERJU1BfRElUSEVSXzE1KTsKKwkJbXRrX2Rk
cF93cml0ZShjbWRxX3BrdCwKKwkJCSAgICAgIERJVEhFUl9MU0JfRVJSX1NISUZUX0IoTVRLX01B
WF9CUEMgLSBicGMpIHwKKwkJCSAgICAgIERJVEhFUl9BRERfTFNISUZUX0IoTVRLX01BWF9CUEMg
LSBicGMpIHwKKwkJCSAgICAgIERJVEhFUl9MU0JfRVJSX1NISUZUX0coTVRLX01BWF9CUEMgLSBi
cGMpIHwKKwkJCSAgICAgIERJVEhFUl9BRERfTFNISUZUX0coTVRLX01BWF9CUEMgLSBicGMpLAor
CQkJICAgICAgY29tcCwgRElTUF9ESVRIRVJfMTYpOworCQltdGtfZGRwX3dyaXRlKGNtZHFfcGt0
LCBESVNQX0RJVEhFUklORywgY29tcCwgQ0ZHKTsKIAl9CiB9CiAKIHN0YXRpYyB2b2lkIG10a19v
ZF9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHcsCiAJCQkg
IHVuc2lnbmVkIGludCBoLCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCi0JCQkgIHVuc2lnbmVkIGlu
dCBicGMpCisJCQkgIHVuc2lnbmVkIGludCBicGMsIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3Qp
CiB7Ci0Jd3JpdGVsKHcgPDwgMTYgfCBoLCBjb21wLT5yZWdzICsgRElTUF9PRF9TSVpFKTsKLQl3
cml0ZWwoT0RfUkVMQVlNT0RFLCBjb21wLT5yZWdzICsgRElTUF9PRF9DRkcpOwotCW10a19kaXRo
ZXJfc2V0KGNvbXAsIGJwYywgRElTUF9PRF9DRkcpOworCW10a19kZHBfd3JpdGUoY21kcV9wa3Qs
IHcgPDwgMTYgfCBoLCBjb21wLCBESVNQX09EX1NJWkUpOworCW10a19kZHBfd3JpdGUoY21kcV9w
a3QsIE9EX1JFTEFZTU9ERSwgY29tcCwgRElTUF9PRF9DRkcpOworCW10a19kaXRoZXJfc2V0KGNv
bXAsIGJwYywgRElTUF9PRF9DRkcsIGNtZHFfcGt0KTsKIH0KIAogc3RhdGljIHZvaWQgbXRrX29k
X3N0YXJ0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCkBAIC0xMjAsOSArMTYxLDkgQEAgc3Rh
dGljIHZvaWQgbXRrX3Vmb2Vfc3RhcnQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIAogc3Rh
dGljIHZvaWQgbXRrX2FhbF9jb25maWcoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWdu
ZWQgaW50IHcsCiAJCQkgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQgaW50IHZyZWZyZXNoLAot
CQkJICAgdW5zaWduZWQgaW50IGJwYykKKwkJCSAgIHVuc2lnbmVkIGludCBicGMsIHN0cnVjdCBj
bWRxX3BrdCAqY21kcV9wa3QpCiB7Ci0Jd3JpdGVsKGggPDwgMTYgfCB3LCBjb21wLT5yZWdzICsg
RElTUF9BQUxfU0laRSk7CisJbXRrX2RkcF93cml0ZShjbWRxX3BrdCwgaCA8PCAxNiB8IHcsIGNv
bXAsIERJU1BfQUFMX1NJWkUpOwogfQogCiBzdGF0aWMgdm9pZCBtdGtfYWFsX3N0YXJ0KHN0cnVj
dCBtdGtfZGRwX2NvbXAgKmNvbXApCkBAIC0xMzcsMTAgKzE3OCwxMCBAQCBzdGF0aWMgdm9pZCBt
dGtfYWFsX3N0b3Aoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKIAogc3RhdGljIHZvaWQgbXRr
X2Njb3JyX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgdywK
IAkJCSAgICAgdW5zaWduZWQgaW50IGgsIHVuc2lnbmVkIGludCB2cmVmcmVzaCwKLQkJCSAgICAg
dW5zaWduZWQgaW50IGJwYykKKwkJCSAgICAgdW5zaWduZWQgaW50IGJwYywgc3RydWN0IGNtZHFf
cGt0ICpjbWRxX3BrdCkKIHsKLQl3cml0ZWwoaCA8PCAxNiB8IHcsIGNvbXAtPnJlZ3MgKyBESVNQ
X0NDT1JSX1NJWkUpOwotCXdyaXRlbChDQ09SUl9SRUxBWV9NT0RFLCBjb21wLT5yZWdzICsgRElT
UF9DQ09SUl9DRkcpOworCW10a19kZHBfd3JpdGUoY21kcV9wa3QsIGggPDwgMTYgfCB3LCBjb21w
LCBESVNQX0NDT1JSX1NJWkUpOworCW10a19kZHBfd3JpdGUoY21kcV9wa3QsIENDT1JSX1JFTEFZ
X01PREUsIGNvbXAsIERJU1BfQ0NPUlJfQ0ZHKTsKIH0KIAogc3RhdGljIHZvaWQgbXRrX2Njb3Jy
X3N0YXJ0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCkBAIC0xNTUsMTAgKzE5NiwxMCBAQCBz
dGF0aWMgdm9pZCBtdGtfY2NvcnJfc3RvcChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQogCiBz
dGF0aWMgdm9pZCBtdGtfZGl0aGVyX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1
bnNpZ25lZCBpbnQgdywKIAkJCSAgICAgIHVuc2lnbmVkIGludCBoLCB1bnNpZ25lZCBpbnQgdnJl
ZnJlc2gsCi0JCQkgICAgICB1bnNpZ25lZCBpbnQgYnBjKQorCQkJICAgICAgdW5zaWduZWQgaW50
IGJwYywgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKLQl3cml0ZWwoaCA8PCAxNiB8IHcs
IGNvbXAtPnJlZ3MgKyBESVNQX0RJVEhFUl9TSVpFKTsKLQl3cml0ZWwoRElUSEVSX1JFTEFZX01P
REUsIGNvbXAtPnJlZ3MgKyBESVNQX0RJVEhFUl9DRkcpOworCW10a19kZHBfd3JpdGUoY21kcV9w
a3QsIGggPDwgMTYgfCB3LCBjb21wLCBESVNQX0RJVEhFUl9TSVpFKTsKKwltdGtfZGRwX3dyaXRl
KGNtZHFfcGt0LCBESVRIRVJfUkVMQVlfTU9ERSwgY29tcCwgRElTUF9ESVRIRVJfQ0ZHKTsKIH0K
IAogc3RhdGljIHZvaWQgbXRrX2RpdGhlcl9zdGFydChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21w
KQpAQCAtMTczLDEwICsyMTQsMTAgQEAgc3RhdGljIHZvaWQgbXRrX2RpdGhlcl9zdG9wKHN0cnVj
dCBtdGtfZGRwX2NvbXAgKmNvbXApCiAKIHN0YXRpYyB2b2lkIG10a19nYW1tYV9jb25maWcoc3Ry
dWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IHcsCiAJCQkgICAgIHVuc2lnbmVk
IGludCBoLCB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsCi0JCQkgICAgIHVuc2lnbmVkIGludCBicGMp
CisJCQkgICAgIHVuc2lnbmVkIGludCBicGMsIHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpCiB7
Ci0Jd3JpdGVsKGggPDwgMTYgfCB3LCBjb21wLT5yZWdzICsgRElTUF9HQU1NQV9TSVpFKTsKLQlt
dGtfZGl0aGVyX3NldChjb21wLCBicGMsIERJU1BfR0FNTUFfQ0ZHKTsKKwltdGtfZGRwX3dyaXRl
KGNtZHFfcGt0LCBoIDw8IDE2IHwgdywgY29tcCwgRElTUF9HQU1NQV9TSVpFKTsKKwltdGtfZGl0
aGVyX3NldChjb21wLCBicGMsIERJU1BfR0FNTUFfQ0ZHLCBjbWRxX3BrdCk7CiB9CiAKIHN0YXRp
YyB2b2lkIG10a19nYW1tYV9zdGFydChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKQpAQCAtMTkw
LDI0ICsyMzEsMjMgQEAgc3RhdGljIHZvaWQgbXRrX2dhbW1hX3N0b3Aoc3RydWN0IG10a19kZHBf
Y29tcCAqY29tcCkKIH0KIAogc3RhdGljIHZvaWQgbXRrX2dhbW1hX3NldChzdHJ1Y3QgbXRrX2Rk
cF9jb21wICpjb21wLAotCQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQorCQkJICBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlLAorCQkJICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFf
cGt0KQogewotCXVuc2lnbmVkIGludCBpLCByZWc7CisJdW5zaWduZWQgaW50IGk7CiAJc3RydWN0
IGRybV9jb2xvcl9sdXQgKmx1dDsKLQl2b2lkIF9faW9tZW0gKmx1dF9iYXNlOwogCXUzMiB3b3Jk
OwogCiAJaWYgKHN0YXRlLT5nYW1tYV9sdXQpIHsKLQkJcmVnID0gcmVhZGwoY29tcC0+cmVncyAr
IERJU1BfR0FNTUFfQ0ZHKTsKLQkJcmVnID0gcmVnIHwgR0FNTUFfTFVUX0VOOwotCQl3cml0ZWwo
cmVnLCBjb21wLT5yZWdzICsgRElTUF9HQU1NQV9DRkcpOwotCQlsdXRfYmFzZSA9IGNvbXAtPnJl
Z3MgKyBESVNQX0dBTU1BX0xVVDsKKwkJbXRrX2RkcF93cml0ZV9tYXNrKGNtZHFfcGt0LCBHQU1N
QV9MVVRfRU4sIGNvbXAsCisJCQkJICAgRElTUF9HQU1NQV9DRkcsIEdBTU1BX0xVVF9FTik7CiAJ
CWx1dCA9IChzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqKXN0YXRlLT5nYW1tYV9sdXQtPmRhdGE7CiAJ
CWZvciAoaSA9IDA7IGkgPCBNVEtfTFVUX1NJWkU7IGkrKykgewogCQkJd29yZCA9ICgoKGx1dFtp
XS5yZWQgPj4gNikgJiBMVVRfMTBCSVRfTUFTSykgPDwgMjApICsKIAkJCQkoKChsdXRbaV0uZ3Jl
ZW4gPj4gNikgJiBMVVRfMTBCSVRfTUFTSykgPDwgMTApICsKIAkJCQkoKGx1dFtpXS5ibHVlID4+
IDYpICYgTFVUXzEwQklUX01BU0spOwotCQkJd3JpdGVsKHdvcmQsIChsdXRfYmFzZSArIGkgKiA0
KSk7CisJCQltdGtfZGRwX3dyaXRlKGNtZHFfcGt0LCB3b3JkLCBjb21wLAorCQkJCSAgICAgIERJ
U1BfR0FNTUFfTFVUICsgaSAqIDQpOwogCQl9CiAJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fZGRwX2NvbXAuaCBiL2RyaXZlcnMvZ3B1L2RybS9tZWRp
YXRlay9tdGtfZHJtX2RkcF9jb21wLmgKaW5kZXggNTJmNWFhOGYyMWNhLi4yMzdkZDQzZDYwM2Mg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2RkcF9jb21wLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fZGRwX2NvbXAuaApAQCAtNjks
MjEgKzY5LDI2IEBAIGVudW0gbXRrX2RkcF9jb21wX2lkIHsKIH07CiAKIHN0cnVjdCBtdGtfZGRw
X2NvbXA7Ci0KK3N0cnVjdCBjbWRxX3BrdDsKIHN0cnVjdCBtdGtfZGRwX2NvbXBfZnVuY3Mgewog
CXZvaWQgKCpjb25maWcpKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCB3
LAotCQkgICAgICAgdW5zaWduZWQgaW50IGgsIHVuc2lnbmVkIGludCB2cmVmcmVzaCwgdW5zaWdu
ZWQgaW50IGJwYyk7CisJCSAgICAgICB1bnNpZ25lZCBpbnQgaCwgdW5zaWduZWQgaW50IHZyZWZy
ZXNoLAorCQkgICAgICAgdW5zaWduZWQgaW50IGJwYywgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3Br
dCk7CiAJdm9pZCAoKnN0YXJ0KShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKIAl2b2lkICgq
c3RvcCkoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCk7CiAJdm9pZCAoKmVuYWJsZV92Ymxhbmsp
KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiAJdm9p
ZCAoKmRpc2FibGVfdmJsYW5rKShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKIAl1bnNpZ25l
ZCBpbnQgKCpsYXllcl9ucikoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCk7Ci0Jdm9pZCAoKmxh
eWVyX29uKShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQgaWR4KTsKLQl2
b2lkICgqbGF5ZXJfb2ZmKShzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLCB1bnNpZ25lZCBpbnQg
aWR4KTsKKwl2b2lkICgqbGF5ZXJfb24pKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2ln
bmVkIGludCBpZHgsCisJCQkgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCk7CisJdm9pZCAoKmxh
eWVyX29mZikoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCwKKwkJ
CSAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCk7CiAJdm9pZCAoKmxheWVyX2NvbmZpZykoc3Ry
dWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWduZWQgaW50IGlkeCwKLQkJCSAgICAgc3RydWN0
IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUpOworCQkJICAgICBzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRl
ICpzdGF0ZSwKKwkJCSAgICAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCk7CiAJdm9pZCAoKmdh
bW1hX3NldCkoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwKLQkJCSAgc3RydWN0IGRybV9jcnRj
X3N0YXRlICpzdGF0ZSk7CisJCQkgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUsCisJCQkg
IHN0cnVjdCBjbWRxX3BrdCAqY21kcV9wa3QpOwogCXZvaWQgKCpiZ2Nscl9pbl9vbikoc3RydWN0
IG10a19kZHBfY29tcCAqY29tcCk7CiAJdm9pZCAoKmJnY2xyX2luX29mZikoc3RydWN0IG10a19k
ZHBfY29tcCAqY29tcCk7CiB9OwpAQCAtOTksMTAgKzEwNCwxMSBAQCBzdHJ1Y3QgbXRrX2RkcF9j
b21wIHsKIAogc3RhdGljIGlubGluZSB2b2lkIG10a19kZHBfY29tcF9jb25maWcoc3RydWN0IG10
a19kZHBfY29tcCAqY29tcCwKIAkJCQkgICAgICAgdW5zaWduZWQgaW50IHcsIHVuc2lnbmVkIGlu
dCBoLAotCQkJCSAgICAgICB1bnNpZ25lZCBpbnQgdnJlZnJlc2gsIHVuc2lnbmVkIGludCBicGMp
CisJCQkJICAgICAgIHVuc2lnbmVkIGludCB2cmVmcmVzaCwgdW5zaWduZWQgaW50IGJwYywKKwkJ
CQkgICAgICAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKIAlpZiAoY29tcC0+ZnVuY3Mg
JiYgY29tcC0+ZnVuY3MtPmNvbmZpZykKLQkJY29tcC0+ZnVuY3MtPmNvbmZpZyhjb21wLCB3LCBo
LCB2cmVmcmVzaCwgYnBjKTsKKwkJY29tcC0+ZnVuY3MtPmNvbmZpZyhjb21wLCB3LCBoLCB2cmVm
cmVzaCwgYnBjLCBjbWRxX3BrdCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBtdGtfZGRwX2Nv
bXBfc3RhcnQoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCkKQEAgLTEzOSwzMiArMTQ1LDM2IEBA
IHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IG10a19kZHBfY29tcF9sYXllcl9ucihzdHJ1Y3Qg
bXRrX2RkcF9jb21wICpjb21wKQogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9jb21w
X2xheWVyX29uKHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsCi0JCQkJCSB1bnNpZ25lZCBpbnQg
aWR4KQorCQkJCQkgdW5zaWduZWQgaW50IGlkeCwKKwkJCQkJIHN0cnVjdCBjbWRxX3BrdCAqY21k
cV9wa3QpCiB7CiAJaWYgKGNvbXAtPmZ1bmNzICYmIGNvbXAtPmZ1bmNzLT5sYXllcl9vbikKLQkJ
Y29tcC0+ZnVuY3MtPmxheWVyX29uKGNvbXAsIGlkeCk7CisJCWNvbXAtPmZ1bmNzLT5sYXllcl9v
bihjb21wLCBpZHgsIGNtZHFfcGt0KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIG10a19kZHBf
Y29tcF9sYXllcl9vZmYoc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwKLQkJCQkJICB1bnNpZ25l
ZCBpbnQgaWR4KQorCQkJCQkgIHVuc2lnbmVkIGludCBpZHgsCisJCQkJCSAgc3RydWN0IGNtZHFf
cGt0ICpjbWRxX3BrdCkKIHsKIAlpZiAoY29tcC0+ZnVuY3MgJiYgY29tcC0+ZnVuY3MtPmxheWVy
X29mZikKLQkJY29tcC0+ZnVuY3MtPmxheWVyX29mZihjb21wLCBpZHgpOworCQljb21wLT5mdW5j
cy0+bGF5ZXJfb2ZmKGNvbXAsIGlkeCwgY21kcV9wa3QpOwogfQogCiBzdGF0aWMgaW5saW5lIHZv
aWQgbXRrX2RkcF9jb21wX2xheWVyX2NvbmZpZyhzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAog
CQkJCQkgICAgIHVuc2lnbmVkIGludCBpZHgsCi0JCQkJCSAgICAgc3RydWN0IG10a19wbGFuZV9z
dGF0ZSAqc3RhdGUpCisJCQkJCSAgICAgc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUsCisJ
CQkJCSAgICAgc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCkKIHsKIAlpZiAoY29tcC0+ZnVuY3Mg
JiYgY29tcC0+ZnVuY3MtPmxheWVyX2NvbmZpZykKLQkJY29tcC0+ZnVuY3MtPmxheWVyX2NvbmZp
Zyhjb21wLCBpZHgsIHN0YXRlKTsKKwkJY29tcC0+ZnVuY3MtPmxheWVyX2NvbmZpZyhjb21wLCBp
ZHgsIHN0YXRlLCBjbWRxX3BrdCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBtdGtfZGRwX2dh
bW1hX3NldChzdHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wLAotCQkJCSAgICAgc3RydWN0IGRybV9j
cnRjX3N0YXRlICpzdGF0ZSkKKwkJCQkgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUs
CisJCQkJICAgICBzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0KQogewogCWlmIChjb21wLT5mdW5j
cyAmJiBjb21wLT5mdW5jcy0+Z2FtbWFfc2V0KQotCQljb21wLT5mdW5jcy0+Z2FtbWFfc2V0KGNv
bXAsIHN0YXRlKTsKKwkJY29tcC0+ZnVuY3MtPmdhbW1hX3NldChjb21wLCBzdGF0ZSwgY21kcV9w
a3QpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgbXRrX2RkcF9jb21wX2JnY2xyX2luX29uKHN0
cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXApCkBAIC0xODcsNiArMTk3LDEzIEBAIGludCBtdGtfZGRw
X2NvbXBfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZpY2Vfbm9kZSAqY29tcF9u
b2RlLAogaW50IG10a19kZHBfY29tcF9yZWdpc3RlcihzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLCBz
dHJ1Y3QgbXRrX2RkcF9jb21wICpjb21wKTsKIHZvaWQgbXRrX2RkcF9jb21wX3VucmVnaXN0ZXIo
c3RydWN0IGRybV9kZXZpY2UgKmRybSwgc3RydWN0IG10a19kZHBfY29tcCAqY29tcCk7CiB2b2lk
IG10a19kaXRoZXJfc2V0KHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBi
cGMsCi0JCSAgICB1bnNpZ25lZCBpbnQgQ0ZHKTsKLQorCQkgICAgdW5zaWduZWQgaW50IENGRywg
c3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCk7CitlbnVtIG10a19kZHBfY29tcF90eXBlIG10a19k
ZHBfY29tcF9nZXRfdHlwZShlbnVtIG10a19kZHBfY29tcF9pZCBjb21wX2lkKTsKK3ZvaWQgbXRr
X2RkcF93cml0ZShzdHJ1Y3QgY21kcV9wa3QgKmNtZHFfcGt0LCB1bnNpZ25lZCBpbnQgdmFsdWUs
CisJCSAgIHN0cnVjdCBtdGtfZGRwX2NvbXAgKmNvbXAsIHVuc2lnbmVkIGludCBvZmZzZXQpOwor
dm9pZCBtdGtfZGRwX3dyaXRlX3JlbGF4ZWQoc3RydWN0IGNtZHFfcGt0ICpjbWRxX3BrdCwgdW5z
aWduZWQgaW50IHZhbHVlLAorCQkJICAgc3RydWN0IG10a19kZHBfY29tcCAqY29tcCwgdW5zaWdu
ZWQgaW50IG9mZnNldCk7Cit2b2lkIG10a19kZHBfd3JpdGVfbWFzayhzdHJ1Y3QgY21kcV9wa3Qg
KmNtZHFfcGt0LCB1bnNpZ25lZCBpbnQgdmFsdWUsCisJCQlzdHJ1Y3QgbXRrX2RkcF9jb21wICpj
b21wLCB1bnNpZ25lZCBpbnQgb2Zmc2V0LAorCQkJdW5zaWduZWQgaW50IG1hc2spOwogI2VuZGlm
IC8qIE1US19EUk1fRERQX0NPTVBfSCAqLwotLSAKMi4xOC4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
