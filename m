Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9170F81341
	for <lists+dri-devel@lfdr.de>; Mon,  5 Aug 2019 09:35:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 06CCD89B7D;
	Mon,  5 Aug 2019 07:34:47 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from onstation.org (onstation.org [52.200.56.107])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1DD326E52C;
 Sat,  3 Aug 2019 14:20:45 +0000 (UTC)
Received: from localhost.localdomain (c-98-239-145-235.hsd1.wv.comcast.net
 [98.239.145.235])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: masneyb)
 by onstation.org (Postfix) with ESMTPSA id 1A5243E911;
 Sat,  3 Aug 2019 14:20:44 +0000 (UTC)
From: Brian Masney <masneyb@onstation.org>
To: agross@kernel.org, robdclark@gmail.com, sean@poorly.run,
 robh+dt@kernel.org, bjorn.andersson@linaro.org
Subject: [PATCH v4 5/6] soc: qcom: add OCMEM driver
Date: Sat,  3 Aug 2019 10:20:25 -0400
Message-Id: <20190803142026.9647-6-masneyb@onstation.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190803142026.9647-1-masneyb@onstation.org>
References: <20190803142026.9647-1-masneyb@onstation.org>
X-Mailman-Approved-At: Mon, 05 Aug 2019 07:34:45 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=onstation.org; s=default; t=1564842044;
 bh=LAzKZzdUOu2bWrLtOVckWFhD2Pk7YRRNklb0TwEujrQ=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=AwUVjeYebGsTh+fGaPOHRfvmpH3KW2FbMQK7Rlx2kJBNlsjWDhSUGG1ZOmhalvoR0
 s5850/QO1Nm0EAaX+VZ/4xqjNZY3G7NNdPTZSlz+H0XuBfsXHm8Jxr0iZ/z8s9x5op
 AuSbtGzBowqQQVbhJsJ5KsUqxuESmDnMMQi8Fy+8=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: mark.rutland@arm.com, devicetree@vger.kernel.org, jonathan@marek.ca,
 airlied@linux.ie, linux-arm-msm@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, freedreno@lists.freedesktop.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIE9DTUVNIGRyaXZlciBoYW5kbGVzIGFsbG9jYXRpb24gYW5kIGNvbmZpZ3VyYXRpb24gb2Yg
dGhlIE9uIENoaXAKTUVNb3J5IHRoYXQgaXMgcHJlc2VudCBvbiBzb21lIFNuYXBkcmFnb24gU29D
cy4gRGV2aWNlcyB3aGljaCBoYXZlCk9DTUVNIGRvIG5vdCBoYXZlIEdNRU0gaW5zaWRlIHRoZSBH
UFUgY29yZSwgc28gdGhlIEdQVSBtdXN0IGluc3RlYWQKdXNlIE9DTUVNIHRvIGJlIGZ1bmN0aW9u
YWwuIFNpbmNlIHRoZSBHUFUgaXMgY3VycmVudGx5IHRoZSBvbmx5IE9DTUVNCnVzZXIgd2l0aCBh
biB1cHN0cmVhbSBkcml2ZXIsIHRoaXMgaXMganVzdCBhIG1pbmltYWwgaW1wbGVtZW50YXRpb24K
c3VmZmljaWVudCBmb3Igc3RhdGljYWxseSBhbGxvY2F0aW5nIHRvIHRoZSBHUFUgaXQncyBjaHVu
ayBvZiBPQ01FTS4KClRoaXMgZHJpdmVyIGN1cnJlbnRseSBkb2VzIG5vdCByZWFkIHRoZSBnbXUt
c3JhbSBub2RlIHRoYXQgaXMgZGVzY3JpYmVkCmluIHRoZSBkZXZpY2UgdHJlZSBiaW5kaW5ncy4g
VGhlIHN0YXJ0aW5nIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBHUFUncwpyZXNlcnZlZCBtZW1vcnkg
cmVnaW9uIGlzIGhhcmRjb2RlZCB0byB6ZXJvIHRvIG1hdGNoIHdoYXQgdGhlIGhhcmR3YXJlCmV4
cGVjdHMuIFRoZSBkcml2ZXIgY2FuIGJlIHVwZGF0ZWQgdG8gcmVhZCB0aGUgcmVzZXJ2ZWQgbWVt
b3J5IHJlZ2lvbnMKZnJvbSBkZXZpY2UgdHJlZSBvbmNlIG90aGVyIHVzZXJzIG9mIE9DTUVNIGFy
ZSBhZGRlZCB1cHN0cmVhbS4KClNpZ25lZC1vZmYtYnk6IEJyaWFuIE1hc25leSA8bWFzbmV5YkBv
bnN0YXRpb24ub3JnPgpDby1kZXZlbG9wZWQtYnk6IFJvYiBDbGFyayA8cm9iZGNsYXJrQGdtYWls
LmNvbT4KU2lnbmVkLW9mZi1ieTogUm9iIENsYXJrIDxyb2JkY2xhcmtAZ21haWwuY29tPgotLS0K
Q2hhbmdlcyBzaW5jZSB2MzoKLSBOb25lCgpDaGFuZ2VzIHNpbmNlIHYyCi0gQ2hhbmdlZCBzdGF0
aWMgaW5saW5lIHN0dWJzIHJldHVybiAtRU5PREVWIHdoZW4gT0NNRU0gaXMgbm90CiAgY29uZmln
dXJlZCBpbnRvIHRoZSBrZXJuZWwuCgpDaGFuZ2VzIHNpbmNlIHYxOgotIG9jbWVtX2FsbG9jYXRl
KCk6IGNoZWNrIGZvciBhbGlnbm1lbnQgYW5kIG1pbmltdW0gYWxsb2NhdGlvbiBzaXplLgogIFRo
ZSA2NEsgdmFsdWVzIGNhbWUgZnJvbSB0aGUgZG93bnN0cmVhbSBNU00ga2VybmVsIHNvdXJjZXMu
Ci0gYWRkIGxvY2tpbmcgdG8gbWVtb3J5IGFsbG9jYXRpb25zIGJhc2VkIG9uIHRoZSBjbGllbnQK
LSB1c2UgY2xrX2J1bGtfKigpIGZ1bmN0aW9ucwotIHJlbmFtZSBxY29tLG9jbWVtLW1zbTg5NzQg
dG8gcWNvbSxtc204OTc0LW9jbWVtCi0gcmVuYW1lIHJlZy1uYW1lcyB0byBjdHJsIGFuZCBtZW0K
LSByZW1vdmUgb2NtZW0ueG1sLmggZmlsZTsgdXNlIEZJRUxEX1BSRVAoKSBpbnN0ZWFkIGZvciBz
b21lIG5pY2UgY2xlYW51cHMKLSBhZGQgc3RhdGljIGlubGluZSBub29wIHZlcnNpb25zIG9mIHB1
YmxpYy1mYWNpbmcgZnVuY3Rpb25zIHdoZW4gb2NtZW0KICBpcyBkaXNhYmxlZCB0byByZW1vdmUg
I2lmZGVmcyBpbiBhZHJlbnVfZ3B1LmMKLSB1c2UgdW5zaWduZWQgbG9uZyBmb3IgbWVtb3J5IGFk
ZHJlc3NlcwotIG1vdmUgb2NtZW1fZGV2X3JlbW92ZSgpIGJlbG93IF9wcm9iZSgpIGZ1bmN0aW9u
Ci0gcmVtb3ZlIGVycm9yIGNoZWNrIGZyb20gcGxhdGZvcm1fZ2V0X3Jlc291cmNlX2J5bmFtZSBm
b3IgY3RybCByZXNvdXJjZQotIGFkZCBNT0RVTEVfREVTQ1JJUFRJT04oKSBhbmQgTU9EVUxFX0xJ
Q0VOU0UoKQotIGFkZCBkZXNjcmlwdGlvbiB0byB0b3Agb2Ygb2NtZW0uW2NoXQotIGNvcnJlY3Qg
dGhpbiBtb2RlIGJpdCBpbiB1cGRhdGVfb2NtZW0oKQotIGFkZCAnV0FSTl9PTihjbGllbnQgIT0g
T0NNRU1fR1JBUEhJQ1MpJyB0byBkZXZpY2VfYWRkcmVzcygpCi0gbWFrZSBvZl9nZXRfb2NtZW0g
cmV0dXJuIGVycm9yIGNvZGVzIHZpYSBFUlJfUFRSIGluc3RlYWQgb2YgTlVMTAotIG9jbWVtX3th
bGxvY2F0ZSxmcmVlfSAtIFdBUk5fT04oKSBpZiBjbGllbnQgIT0gT0NNRU1fR1JBUEhJQ1MuCiAg
U2ltcGxpZnkgaWYgc3RhdGVtZW50cy4KLSBhbGxvdyBOVUxMIHRvIGJlIHBhc3NlZCBpbnRvIG9j
bWVtX2ZyZWUKLSByZW1vdmUgdW5uZWNlc3NhcnkgaW5pdGlhbGl6YXRpb24gb2YgaSBpbiB1cGRh
dGVfb2NtZW0oKQotIGFkZCBkZXZfZGJnIHRvIG9jbWVtX2FsbG9jYXRlCgpDaGFuZ2VzIHNpbmNl
IFJvYidzIGxhc3QgdmVyc2lvbiBvZiB0aGlzIHBhdGNoIGZyb20gMjAxNToKaHR0cHM6Ly9wYXRj
aHdvcmsua2VybmVsLm9yZy9wYXRjaC83Mzc5ODAxLwotIHJlZm9ybWF0dGVkIGRyaXZlciB0byBh
bGxvdyBtdWx0aXBsZSBpbnN0YW5jZXMKLSB1cGRhdGVkIGxvZ2dpbmcgb2YgZXJyb3IgcGF0aHMg
ZHVyaW5nIGRldmljZSBwcm9iaW5nCi0gcmVtb3ZlIHVudXNlZCBwc2dzY19jdHJsCi0gcmVtb3Zl
IF9jbGsgZnJvbSBjbG9jayBuYW1lcwotIHByb3BhZ2F0ZSBlcnJvciBjb2RlIGZyb20gZGV2bV9p
b3JlbWFwX3Jlc291cmNlKCkKLSB1c2UgZGV2aWNlX2dldF9tYXRjaF9kYXRhKCkKLSBTUERYIGxp
Y2Vuc2UgdGFncwotIHJlbW92ZSBRQ09NX1NNRCBpbiBLY29uZmlnCi0gc2VsZWN0IEFSQ0hfUUNP
TSBpbiBLY29uZmlnCi0gc2VsZWN0IEFSQ0hfUUNPTSBpbiBLY29uZmlnCi0gc2VsZWN0IFFDT01f
U0NNIGluIEtjb25maWcKLSBsb25nZXIgZGVzY3JpcHRpb24gaW4gS2NvbmZpZwoKIGRyaXZlcnMv
c29jL3Fjb20vS2NvbmZpZyAgfCAgMTAgKwogZHJpdmVycy9zb2MvcWNvbS9NYWtlZmlsZSB8ICAg
MSArCiBkcml2ZXJzL3NvYy9xY29tL29jbWVtLmMgIHwgNDMzICsrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL3NvYy9xY29tL29jbWVtLmggIHwgIDYyICsrKysr
KwogNCBmaWxlcyBjaGFuZ2VkLCA1MDYgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvc29jL3Fjb20vb2NtZW0uYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvc29j
L3Fjb20vb2NtZW0uaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc29jL3Fjb20vS2NvbmZpZyBiL2Ry
aXZlcnMvc29jL3Fjb20vS2NvbmZpZwppbmRleCBhNmQxYmZiMTcyNzkuLmQxOGViODNiMTBkYSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9zb2MvcWNvbS9LY29uZmlnCisrKyBiL2RyaXZlcnMvc29jL3Fj
b20vS2NvbmZpZwpAQCAtNzQsNiArNzQsMTYgQEAgY29uZmlnIFFDT01fTURUX0xPQURFUgogCXRy
aXN0YXRlCiAJc2VsZWN0IFFDT01fU0NNCiAKK2NvbmZpZyBRQ09NX09DTUVNCisJdHJpc3RhdGUg
IlF1YWxjb21tIE9uIENoaXAgTWVtb3J5IChPQ01FTSkgZHJpdmVyIgorCWRlcGVuZHMgb24gQVJD
SF9RQ09NCisJc2VsZWN0IFFDT01fU0NNCisJaGVscAorICAgICAgICAgIFRoZSBPbiBDaGlwIE1l
bW9yeSAoT0NNRU0pIGFsbG9jYXRvciBhbGxvd3MgdmFyaW91cyBjbGllbnRzIHRvCisgICAgICAg
ICAgYWxsb2NhdGUgbWVtb3J5IGZyb20gT0NNRU0gYmFzZWQgb24gcGVyZm9ybWFuY2UsIGxhdGVu
Y3kgYW5kIHBvd2VyCisgICAgICAgICAgcmVxdWlyZW1lbnRzLiBUaGlzIGlzIHR5cGljYWxseSB1
c2VkIGJ5IHRoZSBHUFUsIGNhbWVyYS92aWRlbywgYW5kCisgICAgICAgICAgYXVkaW8gY29tcG9u
ZW50cyBvbiBzb21lIFNuYXBkcmFnb24gU29Dcy4KKwogY29uZmlnIFFDT01fUE0KIAlib29sICJR
dWFsY29tbSBQb3dlciBNYW5hZ2VtZW50IgogCWRlcGVuZHMgb24gQVJDSF9RQ09NICYmICFBUk02
NApkaWZmIC0tZ2l0IGEvZHJpdmVycy9zb2MvcWNvbS9NYWtlZmlsZSBiL2RyaXZlcnMvc29jL3Fj
b20vTWFrZWZpbGUKaW5kZXggZWViMDg4YmViMTVmLi5kZmMzNzgwMTRhMzMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvc29jL3Fjb20vTWFrZWZpbGUKKysrIGIvZHJpdmVycy9zb2MvcWNvbS9NYWtlZmls
ZQpAQCAtNiw2ICs2LDcgQEAgb2JqLSQoQ09ORklHX1FDT01fQ09NTUFORF9EQikgKz0gY21kLWRi
Lm8KIG9iai0kKENPTkZJR19RQ09NX0dMSU5LX1NTUikgKz0JZ2xpbmtfc3NyLm8KIG9iai0kKENP
TkZJR19RQ09NX0dTQkkpCSs9CXFjb21fZ3NiaS5vCiBvYmotJChDT05GSUdfUUNPTV9NRFRfTE9B
REVSKQkrPSBtZHRfbG9hZGVyLm8KK29iai0kKENPTkZJR19RQ09NX09DTUVNKQkrPSBvY21lbS5v
CiBvYmotJChDT05GSUdfUUNPTV9QTSkJKz0Jc3BtLm8KIG9iai0kKENPTkZJR19RQ09NX1FNSV9I
RUxQRVJTKQkrPSBxbWlfaGVscGVycy5vCiBxbWlfaGVscGVycy15CSs9IHFtaV9lbmNkZWMubyBx
bWlfaW50ZXJmYWNlLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvc29jL3Fjb20vb2NtZW0uYyBiL2Ry
aXZlcnMvc29jL3Fjb20vb2NtZW0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwMDAuLjdjMjhhZDMxMDhhNgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvc29jL3Fjb20v
b2NtZW0uYwpAQCAtMCwwICsxLDQzMyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQ
TC0yLjAtb25seQorLyoKKyAqIFRoZSBPbiBDaGlwIE1lbW9yeSAoT0NNRU0pIGFsbG9jYXRvciBh
bGxvd3MgdmFyaW91cyBjbGllbnRzIHRvIGFsbG9jYXRlCisgKiBtZW1vcnkgZnJvbSBPQ01FTSBi
YXNlZCBvbiBwZXJmb3JtYW5jZSwgbGF0ZW5jeSBhbmQgcG93ZXIgcmVxdWlyZW1lbnRzLgorICog
VGhpcyBpcyB0eXBpY2FsbHkgdXNlZCBieSB0aGUgR1BVLCBjYW1lcmEvdmlkZW8sIGFuZCBhdWRp
byBjb21wb25lbnRzIG9uCisgKiBzb21lIFNuYXBkcmFnb24gU29Dcy4KKyAqCisgKiBDb3B5cmln
aHQgKEMpIDIwMTkgQnJpYW4gTWFzbmV5IDxtYXNuZXliQG9uc3RhdGlvbi5vcmc+CisgKiBDb3B5
cmlnaHQgKEMpIDIwMTUgUmVkIEhhdC4gQXV0aG9yOiBSb2IgQ2xhcmsgPHJvYmRjbGFya0BnbWFp
bC5jb20+CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2JpdGZpZWxkLmg+CisjaW5jbHVkZSA8bGlu
dXgvY2xrLmg+CisjaW5jbHVkZSA8bGludXgvaW8uaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwu
aD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9x
Y29tX3NjbS5oPgorI2luY2x1ZGUgPGxpbnV4L3NpemVzLmg+CisjaW5jbHVkZSA8bGludXgvc2xh
Yi5oPgorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisjaW5jbHVkZSA8c29jL3Fjb20vb2NtZW0u
aD4KKworZW51bSByZWdpb25fbW9kZSB7CisJV0lERV9NT0RFID0gMHgwLAorCVRISU5fTU9ERSwK
KwlNT0RFX0RFRkFVTFQgPSBXSURFX01PREUsCit9OworCitlbnVtIG9jbWVtX21hY3JvX3N0YXRl
IHsKKwlQQVNTVEhST1VHSCA9IDAsCisJUEVSSV9PTiA9IDEsCisJQ09SRV9PTiA9IDIsCisJQ0xL
X09GRiA9IDQsCit9OworCitzdHJ1Y3Qgb2NtZW1fcmVnaW9uIHsKKwlib29sIGludGVybGVhdmVk
OworCWVudW0gcmVnaW9uX21vZGUgbW9kZTsKKwl1bnNpZ25lZCBpbnQgbnVtX21hY3JvczsKKwll
bnVtIG9jbWVtX21hY3JvX3N0YXRlIG1hY3JvX3N0YXRlWzRdOworCXVuc2lnbmVkIGxvbmcgbWFj
cm9fc2l6ZTsKKwl1bnNpZ25lZCBsb25nIHJlZ2lvbl9zaXplOworfTsKKworc3RydWN0IG9jbWVt
X2NvbmZpZyB7CisJdWludDhfdCBudW1fcmVnaW9uczsKKwl1bnNpZ25lZCBsb25nIG1hY3JvX3Np
emU7Cit9OworCitzdHJ1Y3Qgb2NtZW0geworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwljb25zdCBz
dHJ1Y3Qgb2NtZW1fY29uZmlnICpjb25maWc7CisJc3RydWN0IHJlc291cmNlICptZW1vcnk7CisJ
dm9pZCBfX2lvbWVtICptbWlvOworCXVuc2lnbmVkIGludCBudW1fcG9ydHM7CisJdW5zaWduZWQg
aW50IG51bV9tYWNyb3M7CisJYm9vbCBpbnRlcmxlYXZlZDsKKwlzdHJ1Y3Qgb2NtZW1fcmVnaW9u
ICpyZWdpb25zOworCXVuc2lnbmVkIGxvbmcgYWN0aXZlX2FsbG9jYXRpb25zOworfTsKKworI2Rl
ZmluZSBPQ01FTV9NSU5fQUxJR04JCQkJU1pfNjRLCisjZGVmaW5lIE9DTUVNX01JTl9BTExPQwkJ
CQlTWl82NEsKKworI2RlZmluZSBPQ01FTV9SRUdfSFdfVkVSU0lPTgkJCTB4MDAwMDAwMDAKKyNk
ZWZpbmUgT0NNRU1fUkVHX0hXX1BST0ZJTEUJCQkweDAwMDAwMDA0CisKKyNkZWZpbmUgT0NNRU1f
UkVHX1JFR0lPTl9NT0RFX0NUTAkJMHgwMDAwMTAwMAorI2RlZmluZSBPQ01FTV9SRUdJT05fTU9E
RV9DVExfUkVHMF9USElOCQkweDAwMDAwMDAxCisjZGVmaW5lIE9DTUVNX1JFR0lPTl9NT0RFX0NU
TF9SRUcxX1RISU4JCTB4MDAwMDAwMDIKKyNkZWZpbmUgT0NNRU1fUkVHSU9OX01PREVfQ1RMX1JF
RzJfVEhJTgkJMHgwMDAwMDAwNAorI2RlZmluZSBPQ01FTV9SRUdJT05fTU9ERV9DVExfUkVHM19U
SElOCQkweDAwMDAwMDA4CisKKyNkZWZpbmUgT0NNRU1fUkVHX0dGWF9NUFVfU1RBUlQJCQkweDAw
MDAxMDA0CisjZGVmaW5lIE9DTUVNX1JFR19HRlhfTVBVX0VORAkJCTB4MDAwMDEwMDgKKworI2Rl
ZmluZSBPQ01FTV9IV19QUk9GSUxFX05VTV9QT1JUUyh2YWwpCQlGSUVMRF9QUkVQKDB4MDAwMDAw
MGYsICh2YWwpKQorI2RlZmluZSBPQ01FTV9IV19QUk9GSUxFX05VTV9NQUNST1ModmFsKQlGSUVM
RF9QUkVQKDB4MDAwMDNmMDAsICh2YWwpKQorCisjZGVmaW5lIE9DTUVNX0hXX1BST0ZJTEVfTEFT
VF9SRUdOX0hBTEZTSVpFCTB4MDAwMTAwMDAKKyNkZWZpbmUgT0NNRU1fSFdfUFJPRklMRV9JTlRF
UkxFQVZJTkcJCTB4MDAwMjAwMDAKKyNkZWZpbmUgT0NNRU1fUkVHX0dFTl9TVEFUVVMJCQkweDAw
MDAwMDBjCisKKyNkZWZpbmUgT0NNRU1fUkVHX1BTR1NDX1NUQVRVUwkJCTB4MDAwMDAwMzgKKyNk
ZWZpbmUgT0NNRU1fUkVHX1BTR1NDX0NUTChpMCkJCQkoMHgwMDAwMDAzYyArIDB4MSooaTApKQor
CisjZGVmaW5lIE9DTUVNX1BTR1NDX0NUTF9NQUNSTzBfTU9ERSh2YWwpCUZJRUxEX1BSRVAoMHgw
MDAwMDAwNywgKHZhbCkpCisjZGVmaW5lIE9DTUVNX1BTR1NDX0NUTF9NQUNSTzFfTU9ERSh2YWwp
CUZJRUxEX1BSRVAoMHgwMDAwMDA3MCwgKHZhbCkpCisjZGVmaW5lIE9DTUVNX1BTR1NDX0NUTF9N
QUNSTzJfTU9ERSh2YWwpCUZJRUxEX1BSRVAoMHgwMDAwMDcwMCwgKHZhbCkpCisjZGVmaW5lIE9D
TUVNX1BTR1NDX0NUTF9NQUNSTzNfTU9ERSh2YWwpCUZJRUxEX1BSRVAoMHgwMDAwNzAwMCwgKHZh
bCkpCisKKyNkZWZpbmUgT0NNRU1fQ0xLX0NPUkVfSURYCQkJMAorc3RhdGljIHN0cnVjdCBjbGtf
YnVsa19kYXRhIG9jbWVtX2Nsa3NbXSA9IHsKKwl7CisJCS5pZCA9ICJjb3JlIiwKKwl9LAorCXsK
KwkJLmlkID0gImlmYWNlIiwKKwl9LAorfTsKKworc3RhdGljIGlubGluZSB2b2lkIG9jbWVtX3dy
aXRlKHN0cnVjdCBvY21lbSAqb2NtZW0sIHUzMiByZWcsIHUzMiBkYXRhKQoreworCXdyaXRlbChk
YXRhLCBvY21lbS0+bW1pbyArIHJlZyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdTMyIG9jbWVtX3Jl
YWQoc3RydWN0IG9jbWVtICpvY21lbSwgdTMyIHJlZykKK3sKKwlyZXR1cm4gcmVhZGwob2NtZW0t
Pm1taW8gKyByZWcpOworfQorCitzdGF0aWMgdm9pZCB1cGRhdGVfb2NtZW0oc3RydWN0IG9jbWVt
ICpvY21lbSkKK3sKKwl1aW50MzJfdCByZWdpb25fbW9kZV9jdHJsID0gMHgwOworCWludCBpOwor
CisJaWYgKCFxY29tX3NjbV9vY21lbV9sb2NrX2F2YWlsYWJsZSgpKSB7CisJCWZvciAoaSA9IDA7
IGkgPCBvY21lbS0+Y29uZmlnLT5udW1fcmVnaW9uczsgaSsrKSB7CisJCQlzdHJ1Y3Qgb2NtZW1f
cmVnaW9uICpyZWdpb24gPSAmb2NtZW0tPnJlZ2lvbnNbaV07CisKKwkJCWlmIChyZWdpb24tPm1v
ZGUgPT0gVEhJTl9NT0RFKQorCQkJCXJlZ2lvbl9tb2RlX2N0cmwgfD0gQklUKGkpOworCQl9CisK
KwkJZGV2X2RiZyhvY21lbS0+ZGV2LCAib2NtZW1fcmVnaW9uX21vZGVfY29udHJvbCAleFxuIiwK
KwkJCXJlZ2lvbl9tb2RlX2N0cmwpOworCQlvY21lbV93cml0ZShvY21lbSwgT0NNRU1fUkVHX1JF
R0lPTl9NT0RFX0NUTCwgcmVnaW9uX21vZGVfY3RybCk7CisJfQorCisJZm9yIChpID0gMDsgaSA8
IG9jbWVtLT5jb25maWctPm51bV9yZWdpb25zOyBpKyspIHsKKwkJc3RydWN0IG9jbWVtX3JlZ2lv
biAqcmVnaW9uID0gJm9jbWVtLT5yZWdpb25zW2ldOworCQl1MzIgZGF0YTsKKworCQlkYXRhID0g
T0NNRU1fUFNHU0NfQ1RMX01BQ1JPMF9NT0RFKHJlZ2lvbi0+bWFjcm9fc3RhdGVbMF0pIHwKKwkJ
CU9DTUVNX1BTR1NDX0NUTF9NQUNSTzFfTU9ERShyZWdpb24tPm1hY3JvX3N0YXRlWzFdKSB8CisJ
CQlPQ01FTV9QU0dTQ19DVExfTUFDUk8yX01PREUocmVnaW9uLT5tYWNyb19zdGF0ZVsyXSkgfAor
CQkJT0NNRU1fUFNHU0NfQ1RMX01BQ1JPM19NT0RFKHJlZ2lvbi0+bWFjcm9fc3RhdGVbM10pOwor
CisJCW9jbWVtX3dyaXRlKG9jbWVtLCBPQ01FTV9SRUdfUFNHU0NfQ1RMKGkpLCBkYXRhKTsKKwl9
Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nIHBoeXNfdG9fb2Zmc2V0KHN0cnVjdCBvY21lbSAq
b2NtZW0sCisJCQkJICAgIHVuc2lnbmVkIGxvbmcgYWRkcikKK3sKKwlpZiAoYWRkciA8IG9jbWVt
LT5tZW1vcnktPnN0YXJ0IHx8IGFkZHIgPj0gb2NtZW0tPm1lbW9yeS0+ZW5kKQorCQlyZXR1cm4g
MDsKKworCXJldHVybiBhZGRyIC0gb2NtZW0tPm1lbW9yeS0+c3RhcnQ7Cit9CisKK3N0YXRpYyB1
bnNpZ25lZCBsb25nIGRldmljZV9hZGRyZXNzKHN0cnVjdCBvY21lbSAqb2NtZW0sCisJCQkJICAg
IGVudW0gb2NtZW1fY2xpZW50IGNsaWVudCwKKwkJCQkgICAgdW5zaWduZWQgbG9uZyBhZGRyKQor
eworCVdBUk5fT04oY2xpZW50ICE9IE9DTUVNX0dSQVBISUNTKTsKKworCS8qIFRPRE86IGdwdSB1
c2VzIHBoeXNfdG9fb2Zmc2V0LCBidXQgb3RoZXJzIGRvIG5vdC4uICovCisJcmV0dXJuIHBoeXNf
dG9fb2Zmc2V0KG9jbWVtLCBhZGRyKTsKK30KKworc3RhdGljIHZvaWQgdXBkYXRlX3JhbmdlKHN0
cnVjdCBvY21lbSAqb2NtZW0sIHN0cnVjdCBvY21lbV9idWYgKmJ1ZiwKKwkJCSBlbnVtIG9jbWVt
X21hY3JvX3N0YXRlIG1zdGF0ZSwgZW51bSByZWdpb25fbW9kZSBybW9kZSkKK3sKKwl1bnNpZ25l
ZCBsb25nIG9mZnNldCA9IDA7CisJaW50IGksIGo7CisKKwlmb3IgKGkgPSAwOyBpIDwgb2NtZW0t
PmNvbmZpZy0+bnVtX3JlZ2lvbnM7IGkrKykgeworCQlzdHJ1Y3Qgb2NtZW1fcmVnaW9uICpyZWdp
b24gPSAmb2NtZW0tPnJlZ2lvbnNbaV07CisKKwkJaWYgKGJ1Zi0+b2Zmc2V0IDw9IG9mZnNldCAm
JiBvZmZzZXQgPCBidWYtPm9mZnNldCArIGJ1Zi0+bGVuKQorCQkJcmVnaW9uLT5tb2RlID0gcm1v
ZGU7CisKKwkJZm9yIChqID0gMDsgaiA8IHJlZ2lvbi0+bnVtX21hY3JvczsgaisrKSB7CisJCQlp
ZiAoYnVmLT5vZmZzZXQgPD0gb2Zmc2V0ICYmCisJCQkgICAgb2Zmc2V0IDwgYnVmLT5vZmZzZXQg
KyBidWYtPmxlbikKKwkJCQlyZWdpb24tPm1hY3JvX3N0YXRlW2pdID0gbXN0YXRlOworCisJCQlv
ZmZzZXQgKz0gcmVnaW9uLT5tYWNyb19zaXplOworCQl9CisJfQorCisJdXBkYXRlX29jbWVtKG9j
bWVtKTsKK30KKworc3RydWN0IG9jbWVtICpvZl9nZXRfb2NtZW0oc3RydWN0IGRldmljZSAqZGV2
KQoreworCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXY7CisJc3RydWN0IGRldmljZV9ub2Rl
ICpkZXZub2RlOworCisJZGV2bm9kZSA9IG9mX3BhcnNlX3BoYW5kbGUoZGV2LT5vZl9ub2RlLCAi
b2NtZW0iLCAwKTsKKwlpZiAoIWRldm5vZGUpIHsKKwkJZGV2X2VycihkZXYsICJDYW5ub3QgbG9v
ayB1cCBvY21lbSBwaGFuZGxlXG4iKTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT0RFVik7CisJfQor
CisJcGRldiA9IG9mX2ZpbmRfZGV2aWNlX2J5X25vZGUoZGV2bm9kZSk7CisJaWYgKCFwZGV2KSB7
CisJCWRldl9lcnIoZGV2LCAiQ2Fubm90IGZpbmQgZGV2aWNlIG5vZGUgJXNcbiIsIGRldm5vZGUt
Pm5hbWUpOworCQlyZXR1cm4gRVJSX1BUUigtRVBST0JFX0RFRkVSKTsKKwl9CisKKwlyZXR1cm4g
cGxhdGZvcm1fZ2V0X2RydmRhdGEocGRldik7Cit9CitFWFBPUlRfU1lNQk9MKG9mX2dldF9vY21l
bSk7CisKK3N0cnVjdCBvY21lbV9idWYgKm9jbWVtX2FsbG9jYXRlKHN0cnVjdCBvY21lbSAqb2Nt
ZW0sIGVudW0gb2NtZW1fY2xpZW50IGNsaWVudCwKKwkJCQkgdW5zaWduZWQgbG9uZyBzaXplKQor
eworCXN0cnVjdCBvY21lbV9idWYgKmJ1ZjsKKwlpbnQgcmV0OworCisJLyogVE9ETzogYWRkIHN1
cHBvcnQgZm9yIG90aGVyIGNsaWVudHMuLi4gKi8KKwlpZiAoV0FSTl9PTihjbGllbnQgIT0gT0NN
RU1fR1JBUEhJQ1MpKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PREVWKTsKKworCWlmIChzaXplIDwg
T0NNRU1fTUlOX0FMTE9DIHx8ICFJU19BTElHTkVEKHNpemUsIE9DTUVNX01JTl9BTElHTikpCisJ
CXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCisJaWYgKHRlc3RfYW5kX3NldF9iaXRfbG9jayhC
SVQoY2xpZW50KSwgJm9jbWVtLT5hY3RpdmVfYWxsb2NhdGlvbnMpKQorCQlyZXR1cm4gRVJSX1BU
UigtRUJVU1kpOworCisJYnVmID0ga3phbGxvYyhzaXplb2YoKmJ1ZiksIEdGUF9LRVJORUwpOwor
CWlmICghYnVmKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisK
KwlidWYtPm9mZnNldCA9IDA7CisJYnVmLT5hZGRyID0gZGV2aWNlX2FkZHJlc3Mob2NtZW0sIGNs
aWVudCwgYnVmLT5vZmZzZXQpOworCWJ1Zi0+bGVuID0gc2l6ZTsKKworCXVwZGF0ZV9yYW5nZShv
Y21lbSwgYnVmLCBDT1JFX09OLCBXSURFX01PREUpOworCisJaWYgKHFjb21fc2NtX29jbWVtX2xv
Y2tfYXZhaWxhYmxlKCkpIHsKKwkJcmV0ID0gcWNvbV9zY21fb2NtZW1fbG9jayhRQ09NX1NDTV9P
Q01FTV9HUkFQSElDU19JRCwKKwkJCQkJICBidWYtPm9mZnNldCwgYnVmLT5sZW4sIFdJREVfTU9E
RSk7CisJCWlmIChyZXQpIHsKKwkJCWRldl9lcnIob2NtZW0tPmRldiwgImNvdWxkIG5vdCBsb2Nr
OiAlZFxuIiwgcmV0KTsKKwkJCXJldCA9IC1FSU5WQUw7CisJCQlnb3RvIGVycl9rZnJlZTsKKwkJ
fQorCX0gZWxzZSB7CisJCW9jbWVtX3dyaXRlKG9jbWVtLCBPQ01FTV9SRUdfR0ZYX01QVV9TVEFS
VCwgYnVmLT5vZmZzZXQpOworCQlvY21lbV93cml0ZShvY21lbSwgT0NNRU1fUkVHX0dGWF9NUFVf
RU5ELAorCQkJICAgIGJ1Zi0+b2Zmc2V0ICsgYnVmLT5sZW4pOworCX0KKworCWRldl9kYmcob2Nt
ZW0tPmRldiwgInVzaW5nICVsZEsgb2YgT0NNRU0gYXQgMHglMDhseCBmb3IgY2xpZW50ICVkXG4i
LAorCQlzaXplIC8gMTAyNCwgYnVmLT5hZGRyLCBjbGllbnQpOworCisJcmV0dXJuIGJ1ZjsKKwor
ZXJyX2tmcmVlOgorCWtmcmVlKGJ1Zik7CitlcnJfdW5sb2NrOgorCWNsZWFyX2JpdF91bmxvY2so
QklUKGNsaWVudCksICZvY21lbS0+YWN0aXZlX2FsbG9jYXRpb25zKTsKKworCXJldHVybiBFUlJf
UFRSKHJldCk7Cit9CitFWFBPUlRfU1lNQk9MKG9jbWVtX2FsbG9jYXRlKTsKKwordm9pZCBvY21l
bV9mcmVlKHN0cnVjdCBvY21lbSAqb2NtZW0sIGVudW0gb2NtZW1fY2xpZW50IGNsaWVudCwKKwkJ
c3RydWN0IG9jbWVtX2J1ZiAqYnVmKQoreworCS8qIFRPRE86IGFkZCBzdXBwb3J0IGZvciBvdGhl
ciBjbGllbnRzLi4uICovCisJaWYgKFdBUk5fT04oY2xpZW50ICE9IE9DTUVNX0dSQVBISUNTKSkK
KwkJcmV0dXJuOworCisJdXBkYXRlX3JhbmdlKG9jbWVtLCBidWYsIENMS19PRkYsIE1PREVfREVG
QVVMVCk7CisKKwlpZiAocWNvbV9zY21fb2NtZW1fbG9ja19hdmFpbGFibGUoKSkgeworCQlpbnQg
cmV0OworCisJCXJldCA9IHFjb21fc2NtX29jbWVtX3VubG9jayhRQ09NX1NDTV9PQ01FTV9HUkFQ
SElDU19JRCwKKwkJCQkJICAgIGJ1Zi0+b2Zmc2V0LCBidWYtPmxlbik7CisJCWlmIChyZXQpCisJ
CQlkZXZfZXJyKG9jbWVtLT5kZXYsICJjb3VsZCBub3QgdW5sb2NrOiAlZFxuIiwgcmV0KTsKKwl9
IGVsc2UgeworCQlvY21lbV93cml0ZShvY21lbSwgT0NNRU1fUkVHX0dGWF9NUFVfU1RBUlQsIDB4
MCk7CisJCW9jbWVtX3dyaXRlKG9jbWVtLCBPQ01FTV9SRUdfR0ZYX01QVV9FTkQsIDB4MCk7CisJ
fQorCisJa2ZyZWUoYnVmKTsKKworCWNsZWFyX2JpdF91bmxvY2soQklUKGNsaWVudCksICZvY21l
bS0+YWN0aXZlX2FsbG9jYXRpb25zKTsKK30KK0VYUE9SVF9TWU1CT0wob2NtZW1fZnJlZSk7CisK
K3N0YXRpYyBpbnQgb2NtZW1fZGV2X3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYp
Cit7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJnBkZXYtPmRldjsKKwl1bnNpZ25lZCBsb25nIHJl
ZywgcmVnaW9uX3NpemU7CisJaW50IGksIGosIHJldCwgbnVtX2JhbmtzOworCXN0cnVjdCByZXNv
dXJjZSAqcmVzOworCXN0cnVjdCBvY21lbSAqb2NtZW07CisKKwlpZiAoIXFjb21fc2NtX2lzX2F2
YWlsYWJsZSgpKQorCQlyZXR1cm4gLUVQUk9CRV9ERUZFUjsKKworCW9jbWVtID0gZGV2bV9remFs
bG9jKGRldiwgc2l6ZW9mKCpvY21lbSksIEdGUF9LRVJORUwpOworCWlmICghb2NtZW0pCisJCXJl
dHVybiAtRU5PTUVNOworCisJb2NtZW0tPmRldiA9IGRldjsKKwlvY21lbS0+Y29uZmlnID0gZGV2
aWNlX2dldF9tYXRjaF9kYXRhKGRldik7CisKKwlyZXQgPSBkZXZtX2Nsa19idWxrX2dldChkZXYs
IEFSUkFZX1NJWkUob2NtZW1fY2xrcyksIG9jbWVtX2Nsa3MpOworCWlmIChyZXQpIHsKKwkJaWYg
KHJldCAhPSAtRVBST0JFX0RFRkVSKQorCQkJZGV2X2VycihkZXYsICJVbmFibGUgdG8gZ2V0IGNs
b2Nrc1xuIik7CisKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXMgPSBwbGF0Zm9ybV9nZXRfcmVz
b3VyY2VfYnluYW1lKHBkZXYsIElPUkVTT1VSQ0VfTUVNLCAiY3RybCIpOworCW9jbWVtLT5tbWlv
ID0gZGV2bV9pb3JlbWFwX3Jlc291cmNlKCZwZGV2LT5kZXYsIHJlcyk7CisJaWYgKElTX0VSUihv
Y21lbS0+bW1pbykpIHsKKwkJZGV2X2VycigmcGRldi0+ZGV2LCAiRmFpbGVkIHRvIGlvcmVtYXAg
b2NtZW1fY3RybCByZXNvdXJjZVxuIik7CisJCXJldHVybiBQVFJfRVJSKG9jbWVtLT5tbWlvKTsK
Kwl9CisKKwlvY21lbS0+bWVtb3J5ID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlX2J5bmFtZShwZGV2
LCBJT1JFU09VUkNFX01FTSwKKwkJCQkJCSAgICAgIm1lbSIpOworCWlmICghb2NtZW0tPm1lbW9y
eSkgeworCQlkZXZfZXJyKGRldiwgIkNvdWxkIG5vdCBnZXQgbWVtIHJlZ2lvblxuIik7CisJCXJl
dHVybiAtRU5YSU87CisJfQorCisJLyogVGhlIGNvcmUgY2xvY2sgaXMgc3luY2hyb25vdXMgd2l0
aCBncmFwaGljcyAqLworCVdBUk5fT04oY2xrX3NldF9yYXRlKG9jbWVtX2Nsa3NbT0NNRU1fQ0xL
X0NPUkVfSURYXS5jbGssIDEwMDApIDwgMCk7CisKKwlyZXQgPSBjbGtfYnVsa19wcmVwYXJlX2Vu
YWJsZShBUlJBWV9TSVpFKG9jbWVtX2Nsa3MpLCBvY21lbV9jbGtzKTsKKwlpZiAocmV0KSB7CisJ
CWRldl9pbmZvKG9jbWVtLT5kZXYsICJGYWlsZWQgdG8gZW5hYmxlIGNsb2Nrc1xuIik7CisJCXJl
dHVybiByZXQ7CisJfQorCisJaWYgKHFjb21fc2NtX3Jlc3RvcmVfc2VjX2NmZ19hdmFpbGFibGUo
KSkgeworCQlkZXZfZGJnKGRldiwgImNvbmZpZ3VyaW5nIHNjbVxuIik7CisJCXJldCA9IHFjb21f
c2NtX3Jlc3RvcmVfc2VjX2NmZyhRQ09NX1NDTV9PQ01FTV9ERVZfSUQsIDApOworCQlpZiAocmV0
KSB7CisJCQlkZXZfZXJyKGRldiwgIkNvdWxkIG5vdCBlbmFibGUgc2VjdXJlIGNvbmZpZ3VyYXRp
b25cbiIpOworCQkJZ290byBlcnJfY2xrX2Rpc2FibGU7CisJCX0KKwl9CisKKwlyZWcgPSBvY21l
bV9yZWFkKG9jbWVtLCBPQ01FTV9SRUdfSFdfUFJPRklMRSk7CisJb2NtZW0tPm51bV9wb3J0cyA9
IE9DTUVNX0hXX1BST0ZJTEVfTlVNX1BPUlRTKHJlZyk7CisJb2NtZW0tPm51bV9tYWNyb3MgPSBP
Q01FTV9IV19QUk9GSUxFX05VTV9NQUNST1MocmVnKTsKKwlvY21lbS0+aW50ZXJsZWF2ZWQgPSAh
IShyZWcgJiBPQ01FTV9IV19QUk9GSUxFX0lOVEVSTEVBVklORyk7CisKKwludW1fYmFua3MgPSBv
Y21lbS0+bnVtX3BvcnRzIC8gMjsKKwlyZWdpb25fc2l6ZSA9IG9jbWVtLT5jb25maWctPm1hY3Jv
X3NpemUgKiBudW1fYmFua3M7CisKKwlkZXZfaW5mbyhkZXYsICIldSBwb3J0cywgJXUgcmVnaW9u
cywgJXUgbWFjcm9zLCAlc2ludGVybGVhdmVkXG4iLAorCQkgb2NtZW0tPm51bV9wb3J0cywgb2Nt
ZW0tPmNvbmZpZy0+bnVtX3JlZ2lvbnMsCisJCSBvY21lbS0+bnVtX21hY3Jvcywgb2NtZW0tPmlu
dGVybGVhdmVkID8gIiIgOiAibm90ICIpOworCisJb2NtZW0tPnJlZ2lvbnMgPSBkZXZtX2tjYWxs
b2MoZGV2LCBvY21lbS0+Y29uZmlnLT5udW1fcmVnaW9ucywKKwkJCQkgICAgICBzaXplb2Yoc3Ry
dWN0IG9jbWVtX3JlZ2lvbiksIEdGUF9LRVJORUwpOworCWlmICghb2NtZW0tPnJlZ2lvbnMpIHsK
KwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBlcnJfY2xrX2Rpc2FibGU7CisJfQorCisJZm9yIChp
ID0gMDsgaSA8IG9jbWVtLT5jb25maWctPm51bV9yZWdpb25zOyBpKyspIHsKKwkJc3RydWN0IG9j
bWVtX3JlZ2lvbiAqcmVnaW9uID0gJm9jbWVtLT5yZWdpb25zW2ldOworCisJCWlmIChXQVJOX09O
KG51bV9iYW5rcyA+IEFSUkFZX1NJWkUocmVnaW9uLT5tYWNyb19zdGF0ZSkpKSB7CisJCQlyZXQg
PSAtRUlOVkFMOworCQkJZ290byBlcnJfY2xrX2Rpc2FibGU7CisJCX0KKworCQlyZWdpb24tPm1v
ZGUgPSBNT0RFX0RFRkFVTFQ7CisJCXJlZ2lvbi0+bnVtX21hY3JvcyA9IG51bV9iYW5rczsKKwor
CQlpZiAoaSA9PSAob2NtZW0tPmNvbmZpZy0+bnVtX3JlZ2lvbnMgLSAxKSAmJgorCQkgICAgcmVn
ICYgT0NNRU1fSFdfUFJPRklMRV9MQVNUX1JFR05fSEFMRlNJWkUpIHsKKwkJCXJlZ2lvbi0+bWFj
cm9fc2l6ZSA9IG9jbWVtLT5jb25maWctPm1hY3JvX3NpemUgLyAyOworCQkJcmVnaW9uLT5yZWdp
b25fc2l6ZSA9IHJlZ2lvbl9zaXplIC8gMjsKKwkJfSBlbHNlIHsKKwkJCXJlZ2lvbi0+bWFjcm9f
c2l6ZSA9IG9jbWVtLT5jb25maWctPm1hY3JvX3NpemU7CisJCQlyZWdpb24tPnJlZ2lvbl9zaXpl
ID0gcmVnaW9uX3NpemU7CisJCX0KKworCQlmb3IgKGogPSAwOyBqIDwgQVJSQVlfU0laRShyZWdp
b24tPm1hY3JvX3N0YXRlKTsgaisrKQorCQkJcmVnaW9uLT5tYWNyb19zdGF0ZVtqXSA9IENMS19P
RkY7CisJfQorCisJcGxhdGZvcm1fc2V0X2RydmRhdGEocGRldiwgb2NtZW0pOworCisJcmV0dXJu
IDA7CisKK2Vycl9jbGtfZGlzYWJsZToKKwljbGtfYnVsa19kaXNhYmxlX3VucHJlcGFyZShBUlJB
WV9TSVpFKG9jbWVtX2Nsa3MpLCBvY21lbV9jbGtzKTsKKwlyZXR1cm4gcmV0OworfQorCitzdGF0
aWMgaW50IG9jbWVtX2Rldl9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sK
KwljbGtfYnVsa19kaXNhYmxlX3VucHJlcGFyZShBUlJBWV9TSVpFKG9jbWVtX2Nsa3MpLCBvY21l
bV9jbGtzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IG9jbWVtX2Nv
bmZpZyBvY21lbV84OTc0X2NvbmZpZyA9IHsKKwkubnVtX3JlZ2lvbnMgPSAzLAorCS5tYWNyb19z
aXplID0gU1pfMTI4SywKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIG9j
bWVtX29mX21hdGNoW10gPSB7CisJeyAuY29tcGF0aWJsZSA9ICJxY29tLG1zbTg5NzQtb2NtZW0i
LCAuZGF0YSA9ICZvY21lbV84OTc0X2NvbmZpZyB9LAorCXsgfQorfTsKKworTU9EVUxFX0RFVklD
RV9UQUJMRShvZiwgb2NtZW1fb2ZfbWF0Y2gpOworCitzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2Ry
aXZlciBvY21lbV9kcml2ZXIgPSB7CisJLnByb2JlID0gb2NtZW1fZGV2X3Byb2JlLAorCS5yZW1v
dmUgPSBvY21lbV9kZXZfcmVtb3ZlLAorCS5kcml2ZXIgPSB7CisJCS5uYW1lID0gIm9jbWVtIiwK
KwkJLm9mX21hdGNoX3RhYmxlID0gb2NtZW1fb2ZfbWF0Y2gsCisJfSwKK307CisKK21vZHVsZV9w
bGF0Zm9ybV9kcml2ZXIob2NtZW1fZHJpdmVyKTsKKworTU9EVUxFX0RFU0NSSVBUSU9OKCJPbiBD
aGlwIE1lbW9yeSAoT0NNRU0pIGFsbG9jYXRvciBmb3Igc29tZSBTbmFwZHJhZ29uIFNvQ3MiKTsK
K01PRFVMRV9MSUNFTlNFKCJHUEwiKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvc29jL3Fjb20vb2Nt
ZW0uaCBiL2luY2x1ZGUvc29jL3Fjb20vb2NtZW0uaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLmEwYWUzMzZiYTc4YgotLS0gL2Rldi9udWxsCisrKyBiL2luY2x1ZGUv
c29jL3Fjb20vb2NtZW0uaApAQCAtMCwwICsxLDYyIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMC1vbmx5ICovCisvKgorICogVGhlIE9uIENoaXAgTWVtb3J5IChPQ01FTSkg
YWxsb2NhdG9yIGFsbG93cyB2YXJpb3VzIGNsaWVudHMgdG8gYWxsb2NhdGUKKyAqIG1lbW9yeSBm
cm9tIE9DTUVNIGJhc2VkIG9uIHBlcmZvcm1hbmNlLCBsYXRlbmN5IGFuZCBwb3dlciByZXF1aXJl
bWVudHMuCisgKiBUaGlzIGlzIHR5cGljYWxseSB1c2VkIGJ5IHRoZSBHUFUsIGNhbWVyYS92aWRl
bywgYW5kIGF1ZGlvIGNvbXBvbmVudHMgb24KKyAqIHNvbWUgU25hcGRyYWdvbiBTb0NzLgorICoK
KyAqIENvcHlyaWdodCAoQykgMjAxOSBCcmlhbiBNYXNuZXkgPG1hc25leWJAb25zdGF0aW9uLm9y
Zz4KKyAqIENvcHlyaWdodCAoQykgMjAxNSBSZWQgSGF0LiBBdXRob3I6IFJvYiBDbGFyayA8cm9i
ZGNsYXJrQGdtYWlsLmNvbT4KKyAqLworCisjaWZuZGVmIF9fT0NNRU1fSF9fCisjZGVmaW5lIF9f
T0NNRU1fSF9fCisKK2VudW0gb2NtZW1fY2xpZW50IHsKKwkvKiBHTUVNIGNsaWVudHMgKi8KKwlP
Q01FTV9HUkFQSElDUyA9IDB4MCwKKwkvKgorCSAqIFRPRE8gYWRkIG1vcmUgb25jZSBvY21lbV9h
bGxvY2F0ZSgpIGlzIGNsZXZlciBlbm91Z2ggdG8KKwkgKiBkZWFsIHdpdGggbXVsdGlwbGUgY2xp
ZW50cy4KKwkgKi8KKwlPQ01FTV9DTElFTlRfTUFYLAorfTsKKworc3RydWN0IG9jbWVtOworCitz
dHJ1Y3Qgb2NtZW1fYnVmIHsKKwl1bnNpZ25lZCBsb25nIG9mZnNldDsKKwl1bnNpZ25lZCBsb25n
IGFkZHI7CisJdW5zaWduZWQgbG9uZyBsZW47Cit9OworCisjaWYgSVNfRU5BQkxFRChDT05GSUdf
UUNPTV9PQ01FTSkKKworc3RydWN0IG9jbWVtICpvZl9nZXRfb2NtZW0oc3RydWN0IGRldmljZSAq
ZGV2KTsKK3N0cnVjdCBvY21lbV9idWYgKm9jbWVtX2FsbG9jYXRlKHN0cnVjdCBvY21lbSAqb2Nt
ZW0sIGVudW0gb2NtZW1fY2xpZW50IGNsaWVudCwKKwkJCQkgdW5zaWduZWQgbG9uZyBzaXplKTsK
K3ZvaWQgb2NtZW1fZnJlZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLCBlbnVtIG9jbWVtX2NsaWVudCBj
bGllbnQsCisJCXN0cnVjdCBvY21lbV9idWYgKmJ1Zik7CisKKyNlbHNlIC8qIElTX0VOQUJMRUQo
Q09ORklHX1FDT01fT0NNRU0pICovCisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IG9jbWVtICpvZl9n
ZXRfb2NtZW0oc3RydWN0IGRldmljZSAqZGV2KQoreworCXJldHVybiBFUlJfUFRSKC1FTk9ERVYp
OworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBvY21lbV9idWYgKm9jbWVtX2FsbG9jYXRlKHN0
cnVjdCBvY21lbSAqb2NtZW0sCisJCQkJCSAgICAgICBlbnVtIG9jbWVtX2NsaWVudCBjbGllbnQs
CisJCQkJCSAgICAgICB1bnNpZ25lZCBsb25nIHNpemUpCit7CisJcmV0dXJuIEVSUl9QVFIoLUVO
T0RFVik7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBvY21lbV9mcmVlKHN0cnVjdCBvY21lbSAq
b2NtZW0sIGVudW0gb2NtZW1fY2xpZW50IGNsaWVudCwKKwkJCSAgICAgIHN0cnVjdCBvY21lbV9i
dWYgKmJ1ZikKK3sKK30KKworI2VuZGlmIC8qIElTX0VOQUJMRUQoQ09ORklHX1FDT01fT0NNRU0p
ICovCisKKyNlbmRpZiAvKiBfX09DTUVNX0hfXyAqLwotLSAKMi4yMS4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
