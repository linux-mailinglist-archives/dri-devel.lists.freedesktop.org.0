Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2F75F60AE9
	for <lists+dri-devel@lfdr.de>; Fri,  5 Jul 2019 19:17:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6215F6E526;
	Fri,  5 Jul 2019 17:17:33 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from metis.ext.pengutronix.de (metis.ext.pengutronix.de
 [IPv6:2001:67c:670:201:290:27ff:fe1d:cc33])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 282376E51B
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 17:17:32 +0000 (UTC)
Received: from dude02.hi.pengutronix.de ([2001:67c:670:100:1d::28]
 helo=dude02.pengutronix.de.)
 by metis.ext.pengutronix.de with esmtp (Exim 4.92)
 (envelope-from <l.stach@pengutronix.de>)
 id 1hjRpw-0007A3-8X; Fri, 05 Jul 2019 19:17:28 +0200
From: Lucas Stach <l.stach@pengutronix.de>
To: etnaviv@lists.freedesktop.org
Subject: [PATCH v2 7/8] drm/etnaviv: provide MMU context to
 etnaviv_gem_mapping_get
Date: Fri,  5 Jul 2019 19:17:26 +0200
Message-Id: <20190705171727.27501-7-l.stach@pengutronix.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190705171727.27501-1-l.stach@pengutronix.de>
References: <20190705171727.27501-1-l.stach@pengutronix.de>
MIME-Version: 1.0
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::28
X-SA-Exim-Mail-From: l.stach@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de);
 SAEximRunCond expanded to false
X-PTX-Original-Recipient: dri-devel@lists.freedesktop.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: patchwork-lst@pengutronix.de, kernel@pengutronix.de,
 dri-devel@lists.freedesktop.org, Russell King <linux+etnaviv@armlinux.org.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW4gcHJlcGFyYXRpb24gdG8gaGF2aW5nIGEgY29udGV4dCBwZXIgcHJvY2VzcywgZXRuYXZpdl9n
ZW1fbWFwcGluZ19nZXQKc2hvdWxkIG5vdCB1c2UgdGhlIGN1cnJlbnQgR1BVIGNvbnRleHQsIGJ1
dCBuZWVkcyB0byBiZSB0b2xkIHdoaWNoCmNvbnRleHQgdG8gdXNlLgoKU2lnbmVkLW9mZi1ieTog
THVjYXMgU3RhY2ggPGwuc3RhY2hAcGVuZ3V0cm9uaXguZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2V0bmF2aXYvZXRuYXZpdl9nZW0uYyAgICAgICAgfCAyMCArKysrKysrKysrKystLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uaCAgICAgICAgfCAgMyArKy0KIGRy
aXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtX3N1Ym1pdC5jIHwgIDIgKy0KIDMgZmls
ZXMgY2hhbmdlZCwgMTUgaW5zZXJ0aW9ucygrKSwgMTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9ldG5hdml2L2V0bmF2aXZfZ2VtLmMKaW5kZXggZTE4MTUwNThkNWZjLi41ZmVlMGJiMTQ1Yzgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uYwpAQCAtMjQ4LDcgKzI0OCw4IEBA
IHZvaWQgZXRuYXZpdl9nZW1fbWFwcGluZ191bnJlZmVyZW5jZShzdHJ1Y3QgZXRuYXZpdl92cmFt
X21hcHBpbmcgKm1hcHBpbmcpCiB9CiAKIHN0cnVjdCBldG5hdml2X3ZyYW1fbWFwcGluZyAqZXRu
YXZpdl9nZW1fbWFwcGluZ19nZXQoCi0Jc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVj
dCBldG5hdml2X2dwdSAqZ3B1KQorCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3Qg
ZXRuYXZpdl9ncHUgKmdwdSwKKwlzdHJ1Y3QgZXRuYXZpdl9pb21tdV9jb250ZXh0ICptbXUpCiB7
CiAJc3RydWN0IGV0bmF2aXZfZ2VtX29iamVjdCAqZXRuYXZpdl9vYmogPSB0b19ldG5hdml2X2Jv
KG9iaik7CiAJc3RydWN0IGV0bmF2aXZfdnJhbV9tYXBwaW5nICptYXBwaW5nOwpAQCAtMjU2LDcg
KzI1Nyw3IEBAIHN0cnVjdCBldG5hdml2X3ZyYW1fbWFwcGluZyAqZXRuYXZpdl9nZW1fbWFwcGlu
Z19nZXQoCiAJaW50IHJldCA9IDA7CiAKIAltdXRleF9sb2NrKCZldG5hdml2X29iai0+bG9jayk7
Ci0JbWFwcGluZyA9IGV0bmF2aXZfZ2VtX2dldF92cmFtX21hcHBpbmcoZXRuYXZpdl9vYmosIGdw
dS0+bW11KTsKKwltYXBwaW5nID0gZXRuYXZpdl9nZW1fZ2V0X3ZyYW1fbWFwcGluZyhldG5hdml2
X29iaiwgbW11KTsKIAlpZiAobWFwcGluZykgewogCQkvKgogCQkgKiBIb2xkaW5nIHRoZSBvYmpl
Y3QgbG9jayBwcmV2ZW50cyB0aGUgdXNlIGNvdW50IGNoYW5naW5nCkBAIC0yNjUsMTIgKzI2Niwx
MiBAQCBzdHJ1Y3QgZXRuYXZpdl92cmFtX21hcHBpbmcgKmV0bmF2aXZfZ2VtX21hcHBpbmdfZ2V0
KAogCQkgKiB0aGUgTU1VIG93bnMgdGhpcyBtYXBwaW5nIHRvIGNsb3NlIHRoaXMgcmFjZS4KIAkJ
ICovCiAJCWlmIChtYXBwaW5nLT51c2UgPT0gMCkgewotCQkJbXV0ZXhfbG9jaygmZ3B1LT5tbXUt
PmxvY2spOwotCQkJaWYgKG1hcHBpbmctPmNvbnRleHQgPT0gZ3B1LT5tbXUpCisJCQltdXRleF9s
b2NrKCZtbXUtPmxvY2spOworCQkJaWYgKG1hcHBpbmctPmNvbnRleHQgPT0gbW11KQogCQkJCW1h
cHBpbmctPnVzZSArPSAxOwogCQkJZWxzZQogCQkJCW1hcHBpbmcgPSBOVUxMOwotCQkJbXV0ZXhf
dW5sb2NrKCZncHUtPm1tdS0+bG9jayk7CisJCQltdXRleF91bmxvY2soJm1tdS0+bG9jayk7CiAJ
CQlpZiAobWFwcGluZykKIAkJCQlnb3RvIG91dDsKIAkJfSBlbHNlIHsKQEAgLTMwMywxMCArMzA0
LDExIEBAIHN0cnVjdCBldG5hdml2X3ZyYW1fbWFwcGluZyAqZXRuYXZpdl9nZW1fbWFwcGluZ19n
ZXQoCiAJCWxpc3RfZGVsKCZtYXBwaW5nLT5vYmpfbm9kZSk7CiAJfQogCi0JbWFwcGluZy0+Y29u
dGV4dCA9IGdwdS0+bW11OworCWV0bmF2aXZfaW9tbXVfY29udGV4dF9nZXQobW11KTsKKwltYXBw
aW5nLT5jb250ZXh0ID0gbW11OwogCW1hcHBpbmctPnVzZSA9IDE7CiAKLQlyZXQgPSBldG5hdml2
X2lvbW11X21hcF9nZW0oZ3B1LT5tbXUsIGV0bmF2aXZfb2JqLCBncHUtPm1lbW9yeV9iYXNlLAor
CXJldCA9IGV0bmF2aXZfaW9tbXVfbWFwX2dlbShtbXUsIGV0bmF2aXZfb2JqLCBncHUtPm1lbW9y
eV9iYXNlLAogCQkJCSAgICBtYXBwaW5nKTsKIAlpZiAocmV0IDwgMCkKIAkJa2ZyZWUobWFwcGlu
Zyk7CkBAIC01MjksOCArNTMxLDEwIEBAIHZvaWQgZXRuYXZpdl9nZW1fZnJlZV9vYmplY3Qoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiAKIAkJV0FSTl9PTihtYXBwaW5nLT51c2UpOwogCi0J
CWlmIChjb250ZXh0KQorCQlpZiAoY29udGV4dCkgewogCQkJZXRuYXZpdl9pb21tdV91bm1hcF9n
ZW0oY29udGV4dCwgbWFwcGluZyk7CisJCQlldG5hdml2X2lvbW11X2NvbnRleHRfcHV0KGNvbnRl
eHQpOworCQl9CiAKIAkJbGlzdF9kZWwoJm1hcHBpbmctPm9ial9ub2RlKTsKIAkJa2ZyZWUobWFw
cGluZyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbS5o
IGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW0uaAppbmRleCA1YTAwNGQ1ZTRl
YWEuLjM2NDg2MjU0YTNkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRu
YXZpdl9nZW0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dlbS5oCkBA
IC0xMTksNyArMTE5LDggQEAgc3RydWN0IHBhZ2UgKipldG5hdml2X2dlbV9nZXRfcGFnZXMoc3Ry
dWN0IGV0bmF2aXZfZ2VtX29iamVjdCAqb2JqKTsKIHZvaWQgZXRuYXZpdl9nZW1fcHV0X3BhZ2Vz
KHN0cnVjdCBldG5hdml2X2dlbV9vYmplY3QgKm9iaik7CiAKIHN0cnVjdCBldG5hdml2X3ZyYW1f
bWFwcGluZyAqZXRuYXZpdl9nZW1fbWFwcGluZ19nZXQoCi0Jc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmosIHN0cnVjdCBldG5hdml2X2dwdSAqZ3B1KTsKKwlzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
Km9iaiwgc3RydWN0IGV0bmF2aXZfZ3B1ICpncHUsCisJc3RydWN0IGV0bmF2aXZfaW9tbXVfY29u
dGV4dCAqbW11KTsKIHZvaWQgZXRuYXZpdl9nZW1fbWFwcGluZ191bnJlZmVyZW5jZShzdHJ1Y3Qg
ZXRuYXZpdl92cmFtX21hcHBpbmcgKm1hcHBpbmcpOwogCiAjZW5kaWYgLyogX19FVE5BVklWX0dF
TV9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ2Vt
X3N1Ym1pdC5jIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMK
aW5kZXggM2Y0ZjZhYjM4OGRlLi4yNjdmZjU4NjNlNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9ldG5hdml2L2V0bmF2aXZfZ2VtX3N1Ym1pdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfZ2VtX3N1Ym1pdC5jCkBAIC0yMjQsNyArMjI0LDcgQEAgc3RhdGljIGlu
dCBzdWJtaXRfcGluX29iamVjdHMoc3RydWN0IGV0bmF2aXZfZ2VtX3N1Ym1pdCAqc3VibWl0KQog
CQlzdHJ1Y3QgZXRuYXZpdl92cmFtX21hcHBpbmcgKm1hcHBpbmc7CiAKIAkJbWFwcGluZyA9IGV0
bmF2aXZfZ2VtX21hcHBpbmdfZ2V0KCZldG5hdml2X29iai0+YmFzZSwKLQkJCQkJCSAgc3VibWl0
LT5ncHUpOworCQkJCQkJICBzdWJtaXQtPmdwdSwgc3VibWl0LT5ncHUtPm1tdSk7CiAJCWlmIChJ
U19FUlIobWFwcGluZykpIHsKIAkJCXJldCA9IFBUUl9FUlIobWFwcGluZyk7CiAJCQlicmVhazsK
LS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
