Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 05996FF924
	for <lists+dri-devel@lfdr.de>; Sun, 17 Nov 2019 12:46:28 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2FF786E39C;
	Sun, 17 Nov 2019 11:45:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 13D646E16B
 for <dri-devel@lists.freedesktop.org>; Sun, 17 Nov 2019 02:41:50 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1]) (Authenticated sender: sre)
 with ESMTPSA id 90BD328F760
Received: by earth.universe (Postfix, from userid 1000)
 id 9ED6F3C0C7D; Sun, 17 Nov 2019 03:41:39 +0100 (CET)
From: Sebastian Reichel <sebastian.reichel@collabora.com>
To: Sebastian Reichel <sre@kernel.org>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>
Subject: [RFCv1 05/42] drm/omap: panel-dsi-cm: convert to transfer API
Date: Sun, 17 Nov 2019 03:39:51 +0100
Message-Id: <20191117024028.2233-6-sebastian.reichel@collabora.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191117024028.2233-1-sebastian.reichel@collabora.com>
References: <20191117024028.2233-1-sebastian.reichel@collabora.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 17 Nov 2019 11:44:18 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com, Tony Lindgren <tony@atomide.com>,
 "H. Nikolaus Schaller" <hns@goldelico.com>, Merlijn Wajer <merlijn@wizzup.org>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 dri-devel@lists.freedesktop.org, linux-omap@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBjb252ZXJ0cyB0aGUgcGFuZWwtZHNpLWNtIGRyaXZlciB0byB1c2UgdGhlIHRyYW5zZmVy
CkFQSSBpbnN0ZWFkIG9mIHNwZWNpZmljIGZ1bmN0aW9ucywgc28gdGhhdCB0aGUgc3BlY2lmaWMK
ZnVuY3Rpb25zIGNhbiBiZSB1bmV4cG9ydGVkIGFuZCBzcXVhc2hlZCBpbnRvIHRoZSBnZW5lcmlj
CnRyYW5zZmVyIGZ1bmN0aW9uLgoKU2lnbmVkLW9mZi1ieTogU2ViYXN0aWFuIFJlaWNoZWwgPHNl
YmFzdGlhbi5yZWljaGVsQGNvbGxhYm9yYS5jb20+Ci0tLQogLi4uL2dwdS9kcm0vb21hcGRybS9k
aXNwbGF5cy9wYW5lbC1kc2ktY20uYyAgIHwgMTMzICsrKysrKysrKysrKystLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDk2IGluc2VydGlvbnMoKyksIDM3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rpc3BsYXlzL3BhbmVsLWRzaS1jbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL29tYXBkcm0vZGlzcGxheXMvcGFuZWwtZHNpLWNtLmMKaW5kZXggOTIxNGQ2NmNm
ZGM3Li4wNTk3NDA1OWYyMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rp
c3BsYXlzL3BhbmVsLWRzaS1jbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rpc3Bs
YXlzL3BhbmVsLWRzaS1jbS5jCkBAIC0xNDAsNDUgKzE0MCw2MSBAQCBzdGF0aWMgdm9pZCBod19n
dWFyZF93YWl0KHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEpCiBzdGF0aWMgaW50IGRzaWNt
X2Rjc19yZWFkXzEoc3RydWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSwgdTggZGNzX2NtZCwgdTgg
KmRhdGEpCiB7CiAJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKLQlp
bnQgcjsKLQl1OCBidWZbMV07Ci0KLQlyID0gc3JjLT5vcHMtPmRzaS5kY3NfcmVhZChzcmMsIGRk
YXRhLT5jaGFubmVsLCBkY3NfY21kLCBidWYsIDEpOwotCi0JaWYgKHIgPCAwKQotCQlyZXR1cm4g
cjsKLQotCSpkYXRhID0gYnVmWzBdOworCWNvbnN0IHN0cnVjdCBtaXBpX2RzaV9tc2cgbXNnID0g
eworCQkuY2hhbm5lbCA9IGRkYXRhLT5jaGFubmVsLAorCQkudHlwZSA9IE1JUElfRFNJX0RDU19S
RUFELAorCQkudHhfbGVuID0gMSwKKwkJLnR4X2J1ZiA9ICZkY3NfY21kLAorCQkucnhfbGVuID0g
MSwKKwkJLnJ4X2J1ZiA9IGRhdGEKKwl9OwogCi0JcmV0dXJuIDA7CisJcmV0dXJuIHNyYy0+b3Bz
LT5kc2kudHJhbnNmZXIoc3JjLCAmbXNnKTsKIH0KIAogc3RhdGljIGludCBkc2ljbV9kY3Nfd3Jp
dGVfMChzdHJ1Y3QgcGFuZWxfZHJ2X2RhdGEgKmRkYXRhLCB1OCBkY3NfY21kKQogewogCXN0cnVj
dCBvbWFwX2Rzc19kZXZpY2UgKnNyYyA9IGRkYXRhLT5zcmM7CisJY29uc3Qgc3RydWN0IG1pcGlf
ZHNpX21zZyBtc2cgPSB7CisJCS5jaGFubmVsID0gZGRhdGEtPmNoYW5uZWwsCisJCS50eXBlID0g
TUlQSV9EU0lfRENTX1NIT1JUX1dSSVRFLAorCQkudHhfYnVmID0gJmRjc19jbWQsCisJCS50eF9s
ZW4gPSAxLAorCX07CiAKLQlyZXR1cm4gc3JjLT5vcHMtPmRzaS5kY3Nfd3JpdGUoc3JjLCBkZGF0
YS0+Y2hhbm5lbCwgJmRjc19jbWQsIDEpOworCXJldHVybiBzcmMtPm9wcy0+ZHNpLnRyYW5zZmVy
KHNyYywgJm1zZyk7CiB9CiAKIHN0YXRpYyBpbnQgZHNpY21fZGNzX3dyaXRlXzEoc3RydWN0IHBh
bmVsX2Rydl9kYXRhICpkZGF0YSwgdTggZGNzX2NtZCwgdTggcGFyYW0pCiB7CiAJc3RydWN0IG9t
YXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKLQl1OCBidWZbMl0gPSB7IGRjc19jbWQs
IHBhcmFtIH07CisJY29uc3QgdTggYnVmW10gPSB7IGRjc19jbWQsIHBhcmFtIH07CisJY29uc3Qg
c3RydWN0IG1pcGlfZHNpX21zZyBtc2cgPSB7CisJCS5jaGFubmVsID0gZGRhdGEtPmNoYW5uZWws
CisJCS50eXBlID0gTUlQSV9EU0lfRENTX1NIT1JUX1dSSVRFX1BBUkFNLAorCQkudHhfYnVmID0g
JmJ1ZiwKKwkJLnR4X2xlbiA9IDIsCisJfTsKIAotCXJldHVybiBzcmMtPm9wcy0+ZHNpLmRjc193
cml0ZShzcmMsIGRkYXRhLT5jaGFubmVsLCBidWYsIDIpOworCXJldHVybiBzcmMtPm9wcy0+ZHNp
LnRyYW5zZmVyKHNyYywgJm1zZyk7CiB9CiAKIHN0YXRpYyBpbnQgZHNpY21fc2xlZXBfaW4oc3Ry
dWN0IHBhbmVsX2Rydl9kYXRhICpkZGF0YSkKIAogewogCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2Ug
KnNyYyA9IGRkYXRhLT5zcmM7Ci0JdTggY21kOwogCWludCByOworCWNvbnN0IHU4IGNtZCA9IE1J
UElfRENTX0VOVEVSX1NMRUVQX01PREU7CisJY29uc3Qgc3RydWN0IG1pcGlfZHNpX21zZyBtc2cg
PSB7CisJCS5jaGFubmVsID0gZGRhdGEtPmNoYW5uZWwsCisJCS50eXBlID0gTUlQSV9EU0lfRENT
X1NIT1JUX1dSSVRFLAorCQkudHhfYnVmID0gJmNtZCwKKwkJLnR4X2xlbiA9IDEsCisJfTsKIAog
CWh3X2d1YXJkX3dhaXQoZGRhdGEpOwogCi0JY21kID0gTUlQSV9EQ1NfRU5URVJfU0xFRVBfTU9E
RTsKLQlyID0gc3JjLT5vcHMtPmRzaS5kY3Nfd3JpdGVfbm9zeW5jKHNyYywgZGRhdGEtPmNoYW5u
ZWwsICZjbWQsIDEpOworCXIgPSBzcmMtPm9wcy0+ZHNpLnRyYW5zZmVyKHNyYywgJm1zZyk7CiAJ
aWYgKHIpCiAJCXJldHVybiByOwogCkBAIC0yMzMsMjggKzI0OSw0NCBAQCBzdGF0aWMgaW50IGRz
aWNtX3NldF91cGRhdGVfd2luZG93KHN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEsCiAJdTE2
IHkxID0geTsKIAl1MTYgeTIgPSB5ICsgaCAtIDE7CiAKLQl1OCBidWZbNV07Ci0JYnVmWzBdID0g
TUlQSV9EQ1NfU0VUX0NPTFVNTl9BRERSRVNTOwotCWJ1ZlsxXSA9ICh4MSA+PiA4KSAmIDB4ZmY7
Ci0JYnVmWzJdID0gKHgxID4+IDApICYgMHhmZjsKLQlidWZbM10gPSAoeDIgPj4gOCkgJiAweGZm
OwotCWJ1Zls0XSA9ICh4MiA+PiAwKSAmIDB4ZmY7CisJY29uc3QgdTggcGFyYW1YW10gPSB7CisJ
CU1JUElfRENTX1NFVF9DT0xVTU5fQUREUkVTUywKKwkJKHgxID4+IDgpICYgMHhmZiwKKwkJKHgx
ID4+IDApICYgMHhmZiwKKwkJKHgyID4+IDgpICYgMHhmZiwKKwkJKHgyID4+IDApICYgMHhmZiwK
Kwl9OwogCi0JciA9IHNyYy0+b3BzLT5kc2kuZGNzX3dyaXRlX25vc3luYyhzcmMsIGRkYXRhLT5j
aGFubmVsLCBidWYsIHNpemVvZihidWYpKTsKLQlpZiAocikKLQkJcmV0dXJuIHI7CisJY29uc3Qg
c3RydWN0IG1pcGlfZHNpX21zZyBtc2dYID0geworCQkuY2hhbm5lbCA9IGRkYXRhLT5jaGFubmVs
LAorCQkudHlwZSA9IE1JUElfRFNJX0dFTkVSSUNfTE9OR19XUklURSwKKwkJLnR4X2J1ZiA9IHBh
cmFtWCwKKwkJLnR4X2xlbiA9IDUsCisJfTsKIAotCWJ1ZlswXSA9IE1JUElfRENTX1NFVF9QQUdF
X0FERFJFU1M7Ci0JYnVmWzFdID0gKHkxID4+IDgpICYgMHhmZjsKLQlidWZbMl0gPSAoeTEgPj4g
MCkgJiAweGZmOwotCWJ1ZlszXSA9ICh5MiA+PiA4KSAmIDB4ZmY7Ci0JYnVmWzRdID0gKHkyID4+
IDApICYgMHhmZjsKKwljb25zdCB1OCBwYXJhbVlbXSA9IHsKKwkJTUlQSV9EQ1NfU0VUX1BBR0Vf
QUREUkVTUywKKwkJKHkxID4+IDgpICYgMHhmZiwKKwkJKHkxID4+IDApICYgMHhmZiwKKwkJKHky
ID4+IDgpICYgMHhmZiwKKwkJKHkyID4+IDApICYgMHhmZiwKKwl9OwogCi0JciA9IHNyYy0+b3Bz
LT5kc2kuZGNzX3dyaXRlX25vc3luYyhzcmMsIGRkYXRhLT5jaGFubmVsLCBidWYsIHNpemVvZihi
dWYpKTsKKwljb25zdCBzdHJ1Y3QgbWlwaV9kc2lfbXNnIG1zZ1kgPSB7CisJCS5jaGFubmVsID0g
ZGRhdGEtPmNoYW5uZWwsCisJCS50eXBlID0gTUlQSV9EU0lfR0VORVJJQ19MT05HX1dSSVRFLAor
CQkudHhfYnVmID0gcGFyYW1ZLAorCQkudHhfbGVuID0gNSwKKwl9OworCisKKwlyID0gc3JjLT5v
cHMtPmRzaS50cmFuc2ZlcihzcmMsICZtc2dYKTsKIAlpZiAocikKIAkJcmV0dXJuIHI7CiAKLQlz
cmMtPm9wcy0+ZHNpLmJ0YV9zeW5jKHNyYywgZGRhdGEtPmNoYW5uZWwpOworCXIgPSBzcmMtPm9w
cy0+ZHNpLnRyYW5zZmVyKHNyYywgJm1zZ1kpOworCWlmIChyKQorCQlyZXR1cm4gcjsKIAogCXJl
dHVybiByOwogfQpAQCAtOTkxLDYgKzEwMjMsMjcgQEAgc3RhdGljIGludCBkc2ljbV9nZXRfdGUo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQogCXJldHVybiByOwogfQogCitzdGF0aWMg
aW50IGRzaWNtX3NldF9tYXhfcnhfcGFja2V0X3NpemUoc3RydWN0IG9tYXBfZHNzX2RldmljZSAq
ZHNzZGV2LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHUxNiBzaXpl
KQoreworCXN0cnVjdCBwYW5lbF9kcnZfZGF0YSAqZGRhdGEgPSB0b19wYW5lbF9kYXRhKGRzc2Rl
dik7CisJc3RydWN0IG9tYXBfZHNzX2RldmljZSAqc3JjID0gZGRhdGEtPnNyYzsKKworCWNvbnN0
IHU4IGJ1ZltdID0geworCQlzaXplICYgMHhmZiwKKwkJc2l6ZSA+PiA4ICYgMHhmZiwKKwl9Owor
CisJY29uc3Qgc3RydWN0IG1pcGlfZHNpX21zZyBtc2cgPSB7CisJCS5jaGFubmVsID0gZGRhdGEt
PmNoYW5uZWwsCisJCS50eXBlID0gTUlQSV9EU0lfU0VUX01BWElNVU1fUkVUVVJOX1BBQ0tFVF9T
SVpFLAorCQkudHhfYnVmID0gYnVmLAorCQkudHhfbGVuID0gMiwKKwl9OworCisJcmV0dXJuIHNy
Yy0+b3BzLT5kc2kudHJhbnNmZXIoc3JjLCAmbXNnKTsKK30KKwogc3RhdGljIGludCBkc2ljbV9t
ZW1vcnlfcmVhZChzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCiAJCXZvaWQgKmJ1Ziwg
c2l6ZV90IHNpemUsCiAJCXUxNiB4LCB1MTYgeSwgdTE2IHcsIHUxNiBoKQpAQCAtMTAzMSwxNyAr
MTA4NCwyMyBAQCBzdGF0aWMgaW50IGRzaWNtX21lbW9yeV9yZWFkKHN0cnVjdCBvbWFwX2Rzc19k
ZXZpY2UgKmRzc2RldiwKIAogCWRzaWNtX3NldF91cGRhdGVfd2luZG93KGRkYXRhLCB4LCB5LCB3
LCBoKTsKIAotCXIgPSBzcmMtPm9wcy0+ZHNpLnNldF9tYXhfcnhfcGFja2V0X3NpemUoc3JjLCBk
ZGF0YS0+Y2hhbm5lbCwgcGxlbik7CisJciA9IGRzaWNtX3NldF9tYXhfcnhfcGFja2V0X3NpemUo
ZHNzZGV2LCBwbGVuKTsKIAlpZiAocikKIAkJZ290byBlcnIyOwogCiAJd2hpbGUgKGJ1Zl91c2Vk
IDwgc2l6ZSkgewogCQl1OCBkY3NfY21kID0gZmlyc3QgPyAweDJlIDogMHgzZTsKKwkJY29uc3Qg
c3RydWN0IG1pcGlfZHNpX21zZyBtc2cgPSB7CisJCQkuY2hhbm5lbCA9IGRkYXRhLT5jaGFubmVs
LAorCQkJLnR5cGUgPSBNSVBJX0RTSV9EQ1NfUkVBRCwKKwkJCS50eF9idWYgPSAmZGNzX2NtZCwK
KwkJCS50eF9sZW4gPSAxLAorCQkJLnJ4X2J1ZiA9IGJ1ZiArIGJ1Zl91c2VkLAorCQkJLnJ4X2xl
biA9IHNpemUgLSBidWZfdXNlZCwKKwkJfTsKIAkJZmlyc3QgPSAwOwogCi0JCXIgPSBzcmMtPm9w
cy0+ZHNpLmRjc19yZWFkKHNyYywgZGRhdGEtPmNoYW5uZWwsIGRjc19jbWQsCi0JCQkJYnVmICsg
YnVmX3VzZWQsIHNpemUgLSBidWZfdXNlZCk7Ci0KKwkJciA9IHNyYy0+b3BzLT5kc2kudHJhbnNm
ZXIoc3JjLCAmbXNnKTsKIAkJaWYgKHIgPCAwKSB7CiAJCQlkZXZfZXJyKGRzc2Rldi0+ZGV2LCAi
cmVhZCBlcnJvclxuIik7CiAJCQlnb3RvIGVycjM7CkBAIC0xMDY1LDcgKzExMjQsNyBAQCBzdGF0
aWMgaW50IGRzaWNtX21lbW9yeV9yZWFkKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRzc2RldiwK
IAlyID0gYnVmX3VzZWQ7CiAKIGVycjM6Ci0Jc3JjLT5vcHMtPmRzaS5zZXRfbWF4X3J4X3BhY2tl
dF9zaXplKHNyYywgZGRhdGEtPmNoYW5uZWwsIDEpOworCWRzaWNtX3NldF9tYXhfcnhfcGFja2V0
X3NpemUoZHNzZGV2LCAxKTsKIGVycjI6CiAJc3JjLT5vcHMtPmRzaS5idXNfdW5sb2NrKHNyYyk7
CiBlcnIxOgotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWw=
