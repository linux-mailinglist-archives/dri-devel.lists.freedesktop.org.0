Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BF37F95339
	for <lists+dri-devel@lfdr.de>; Tue, 20 Aug 2019 03:19:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6F78E6E580;
	Tue, 20 Aug 2019 01:18:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [IPv6:2001:4b98:dc2:55:216:3eff:fef7:d647])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F5A16E504
 for <dri-devel@lists.freedesktop.org>; Tue, 20 Aug 2019 01:17:43 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id 521BEAF9;
 Tue, 20 Aug 2019 03:17:39 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 11/50] drm/bridge: Add bridge driver for display connectors
Date: Tue, 20 Aug 2019 04:16:42 +0300
Message-Id: <20190820011721.30136-12-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
References: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1566263859;
 bh=gnoWEntgulpY0OBZBYbZgK4/Bh762bGc0d1/EBC9P9E=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Yret0rk5eUDijeZ/cQ9avxWJOl+I2dxn1BiXeMqbRBtmBvNwoFy6vP/JfmELSnz4J
 mohGc2JTggnzLC8YleqTvm70/I3up77lMlAdMk+UYrjbtpiemyBtqJmuojgRfLMl4n
 1LnDEbSVKGTr53CxW/oJSBJFeLS3yD9tUVJL5WiY=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>,
 Sebastian Reichel <sebastian.reichel@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RGlzcGxheSBjb25uZWN0b3JzIGFyZSBtb2RlbGxlZCBpbiBEVCBhcyBhIGRldmljZSBub2RlLCBi
dXQgaGF2ZSBzbyBmYXIKYmVlbiBoYW5kbGVkIG1hbnVhbGx5IGluIHNldmVyYWwgYnJpZGdlIGRy
aXZlcnMuIFRoaXMgcmVzdWx0ZWQgaW4KZHVwbGljYXRlIGNvZGUgaW4gc2V2ZXJhbCBicmlkZ2Ug
ZHJpdmVycywgd2l0aCBzbGlnaHRseSBkaWZmZXJlbnQgKGFuZAp0aHVzIGNvbmZ1c2luZykgbG9n
aWNzLgoKSW4gb3JkZXIgdG8gZml4IHRoaXMsIGltcGxlbWVudCBhIGJyaWRnZSBkcml2ZXIgZm9y
IGRpc3BsYXkgY29ubmVjdG9ycy4KVGhlIGRyaXZlciBjZW50cmFsaXNlcyBsb2dpYyBmb3IgdGhl
IERWSSwgSERNSSwgVkdBbiBjb21wb3NpdGUgYW5kClMtdmlkZW8gY29ubmVjdG9ycyBhbmQgZXhw
b3NlcyBjb3JyZXNwb25kaW5nIGJyaWRnZSBvcGVyYXRpb25zLgoKVGhpcyBkcml2ZXIgaW4gaXRz
ZWxmIGRvZXNuJ3Qgc29sdmUgdGhlIGlzc3VlIGNvbXBsZXRlbHksIGNoYW5nZXMgaW4KYnJpZGdl
IGFuZCBkaXNwbGF5IGNvbnRyb2xsZXIgZHJpdmVycyBhcmUgbmVlZGVkIHRvIG1ha2UgdXNlIG9m
IHRoZSBuZXcKY29ubmVjdG9yIGRyaXZlci4KClNpZ25lZC1vZmYtYnk6IExhdXJlbnQgUGluY2hh
cnQgPGxhdXJlbnQucGluY2hhcnRAaWRlYXNvbmJvYXJkLmNvbT4KLS0tCkNoYW5nZXMgc2luY2Ug
djE6CgotIFVzZSBkcm1fZ2V0X2Nvbm5lY3Rvcl90eXBlX25hbWUoKSBpbnN0ZWFkIG9mIG9wZW4t
Y29kaW5nCiAgZGlzcGxheV9jb25uZWN0b3JfdHlwZV9uYW1lKCkKLSBSZW1vdmUgZW1wdHkgLmhw
ZF9lbmFibGUoKSBhbmQgLmhwZF9kaXNhYmxlKCkgb3BlcmF0aW9ucwotIFNldCBicmlkZ2UuZGRj
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnICAgICAgICAgICAgIHwgIDExICsK
IGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvTWFrZWZpbGUgICAgICAgICAgICB8ICAgMSArCiBkcml2
ZXJzL2dwdS9kcm0vYnJpZGdlL2Rpc3BsYXktY29ubmVjdG9yLmMgfCAyOTIgKysrKysrKysrKysr
KysrKysrKysrCiAzIGZpbGVzIGNoYW5nZWQsIDMwNCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9k
ZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9kaXNwbGF5LWNvbm5lY3Rvci5jCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJt
L2JyaWRnZS9LY29uZmlnCmluZGV4IGQwMTQ2NDM4YjBmNS4uZjc3NmQ1MjJjNWFhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2JyaWRnZS9LY29uZmlnCkBAIC0zNyw2ICszNywxNyBAQCBjb25maWcgRFJNX0NETlNfRFNJCiAJ
ICBTdXBwb3J0IENhZGVuY2UgRFBJIHRvIERTSSBicmlkZ2UuIFRoaXMgaXMgYW4gaW50ZXJuYWwK
IAkgIGJyaWRnZSBhbmQgaXMgbWVhbnQgdG8gYmUgZGlyZWN0bHkgZW1iZWRkZWQgaW4gYSBTb0Mu
CiAKK2NvbmZpZyBEUk1fRElTUExBWV9DT05ORUNUT1IKKwl0cmlzdGF0ZSAiRGlzcGxheSBjb25u
ZWN0b3Igc3VwcG9ydCIKKwlkZXBlbmRzIG9uIE9GCisJaGVscAorCSAgRHJpdmVyIGZvciBkaXNw
bGF5IGNvbm5lY3RvcnMgd2l0aCBzdXBwb3J0IGZvciBEREMgYW5kIGhvdC1wbHVnCisJICBkZXRl
Y3Rpb24uIE1vc3QgZGlzcGxheSBjb250cm9sbGVyIGhhbmRsZSBkaXNwbGF5IGNvbm5lY3RvcnMK
KwkgIGludGVybmFsbHkgYW5kIGRvbid0IG5lZWQgdGhpcyBkcml2ZXIsIGJ1dCB0aGUgRFJNIHN1
YnN5c3RlbSBpcworCSAgbW92aW5nIHRvd2FyZHMgc2VwYXJhdGluZyBjb25uZWN0b3IgaGFuZGxp
bmcgZnJvbSBkaXNwbGF5IGNvbnRyb2xsZXJzCisJICBvbiBBUk0tYmFzZWQgcGxhdGZvcm1zLiBT
YXlpbmcgWSBoZXJlIHdoZW4gdGhpcyBkcml2ZXIgaXMgbm90IG5lZWRlZAorCSAgd2lsbCBub3Qg
Y2F1c2UgYW55IGlzc3VlLgorCiBjb25maWcgRFJNX0xWRFNfRU5DT0RFUgogCXRyaXN0YXRlICJU
cmFuc3BhcmVudCBwYXJhbGxlbCB0byBMVkRTIGVuY29kZXIgc3VwcG9ydCIKIAlkZXBlbmRzIG9u
IE9GCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQppbmRleCA2ZmY3ZjJhZGJiMGUuLmU1OTg3YjNhYWY2
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlCkBAIC0xLDYgKzEsNyBAQAogIyBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogR1BMLTIuMAogb2JqLSQoQ09ORklHX0RSTV9BTkFMT0dJWF9BTlg3OFhY
KSArPSBhbmFsb2dpeC1hbng3OHh4Lm8KIG9iai0kKENPTkZJR19EUk1fQ0ROU19EU0kpICs9IGNk
bnMtZHNpLm8KK29iai0kKENPTkZJR19EUk1fRElTUExBWV9DT05ORUNUT1IpICs9IGRpc3BsYXkt
Y29ubmVjdG9yLm8KIG9iai0kKENPTkZJR19EUk1fTFZEU19FTkNPREVSKSArPSBsdmRzLWVuY29k
ZXIubwogb2JqLSQoQ09ORklHX0RSTV9NRUdBQ0hJUFNfU1REUFhYWFhfR0VfQjg1MFYzX0ZXKSAr
PSBtZWdhY2hpcHMtc3RkcHh4eHgtZ2UtYjg1MHYzLWZ3Lm8KIG9iai0kKENPTkZJR19EUk1fTlhQ
X1BUTjM0NjApICs9IG54cC1wdG4zNDYwLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9i
cmlkZ2UvZGlzcGxheS1jb25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvZGlzcGxh
eS1jb25uZWN0b3IuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjk4
ODYyNmI5MTAzNgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvZGlz
cGxheS1jb25uZWN0b3IuYwpAQCAtMCwwICsxLDI5MiBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgKEMpIDIwMTkgTGF1cmVudCBQaW5jaGFy
dCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgorICovCisKKyNpbmNsdWRlIDxs
aW51eC9ncGlvL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvaTJjLmg+CisjaW5jbHVkZSA8
bGludXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8
bGludXgvbXV0ZXguaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2luY2x1ZGUgPGxpbnV4L29m
X2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorCisjaW5jbHVk
ZSA8ZHJtL2RybV9icmlkZ2UuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2VkaWQuaD4KKworc3RydWN0
IGRpc3BsYXlfY29ubmVjdG9yIHsKKwlzdHJ1Y3QgZHJtX2JyaWRnZQlicmlkZ2U7CisKKwljb25z
dCBjaGFyCQkqbGFiZWw7CisJc3RydWN0IGdwaW9fZGVzYwkqaHBkX2dwaW87CisJaW50CQkJaHBk
X2lycTsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRpc3BsYXlfY29ubmVjdG9yICoKK3Rv
X2Rpc3BsYXlfY29ubmVjdG9yKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJcmV0dXJu
IGNvbnRhaW5lcl9vZihicmlkZ2UsIHN0cnVjdCBkaXNwbGF5X2Nvbm5lY3RvciwgYnJpZGdlKTsK
K30KKworc3RhdGljIGludCBkaXNwbGF5X2Nvbm5lY3Rvcl9hdHRhY2goc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSwKKwkJCQkgICAgZW51bSBkcm1fYnJpZGdlX2F0dGFjaF9mbGFncyBmbGFncykK
K3sKKwlyZXR1cm4gZmxhZ3MgJiBEUk1fQlJJREdFX0FUVEFDSF9OT19DT05ORUNUT1IgPyAwIDog
LUVJTlZBTDsKK30KKworc3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMKK2Rpc3BsYXlf
Y29ubmVjdG9yX2RldGVjdChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBk
aXNwbGF5X2Nvbm5lY3RvciAqY29ubiA9IHRvX2Rpc3BsYXlfY29ubmVjdG9yKGJyaWRnZSk7CisK
KwlpZiAoY29ubi0+aHBkX2dwaW8pIHsKKwkJaWYgKGdwaW9kX2dldF92YWx1ZV9jYW5zbGVlcChj
b25uLT5ocGRfZ3BpbykpCisJCQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQ7CisJ
CWVsc2UKKwkJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKKwl9CisKKwlp
ZiAoY29ubi0+YnJpZGdlLmRkYyAmJiBkcm1fcHJvYmVfZGRjKGNvbm4tPmJyaWRnZS5kZGMpKQor
CQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQ7CisKKwlzd2l0Y2ggKGNvbm4tPmJy
aWRnZS50eXBlKSB7CisJY2FzZSBEUk1fTU9ERV9DT05ORUNUT1JfRFZJQToKKwljYXNlIERSTV9N
T0RFX0NPTk5FQ1RPUl9EVklEOgorCWNhc2UgRFJNX01PREVfQ09OTkVDVE9SX0RWSUk6CisJY2Fz
ZSBEUk1fTU9ERV9DT05ORUNUT1JfSERNSUE6CisJY2FzZSBEUk1fTU9ERV9DT05ORUNUT1JfSERN
SUI6CisJCS8qCisJCSAqIEZvciBEVkkgYW5kIEhETUkgY29ubmVjdG9ycyBhIEREQyBwcm9iZSBm
YWlsdXJlIGluZGljYXRlcworCQkgKiB0aGF0IG5vIGNhYmxlIGlzIGNvbm5lY3RlZC4KKwkJICov
CisJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKKworCWNhc2UgRFJNX01P
REVfQ09OTkVDVE9SX0NvbXBvc2l0ZToKKwljYXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9TVklERU86
CisJY2FzZSBEUk1fTU9ERV9DT05ORUNUT1JfVkdBOgorCWRlZmF1bHQ6CisJCS8qCisJCSAqIENv
bXBvc2l0ZSBhbmQgUy1WaWRlbyBjb25uZWN0b3JzIGhhdmUgbm8gb3RoZXIgZGV0ZWN0aW9uCisJ
CSAqIG1lYW4gdGhhbiB0aGUgSFBEIEdQSU8uIEZvciBWR0EgY29ubmVjdG9ycywgZXZlbiBpZiB3
ZSBoYXZlCisJCSAqIGFuIEkyQyBidXMsIHdlIGNhbid0IGFzc3VtZSB0aGF0IHRoZSBjYWJsZSBp
cyBkaXNjb25uZWN0ZWQKKwkJICogaWYgZHJtX3Byb2JlX2RkYyBmYWlscywgYXMgc29tZSBjYWJs
ZXMgZG9uJ3Qgd2lyZSB0aGUgRERDCisJCSAqIHBpbnMuCisJCSAqLworCQlyZXR1cm4gY29ubmVj
dG9yX3N0YXR1c191bmtub3duOworCX0KK30KKworc3RhdGljIHN0cnVjdCBlZGlkICpkaXNwbGF5
X2Nvbm5lY3Rvcl9nZXRfZWRpZChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkgICAg
ICAgc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZGlzcGxheV9j
b25uZWN0b3IgKmNvbm4gPSB0b19kaXNwbGF5X2Nvbm5lY3RvcihicmlkZ2UpOworCisJcmV0dXJu
IGRybV9nZXRfZWRpZChjb25uZWN0b3IsIGNvbm4tPmJyaWRnZS5kZGMpOworfQorCitzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9icmlkZ2VfZnVuY3MgZGlzcGxheV9jb25uZWN0b3JfYnJpZGdlX2Z1
bmNzID0geworCS5hdHRhY2ggPSBkaXNwbGF5X2Nvbm5lY3Rvcl9hdHRhY2gsCisJLmRldGVjdCA9
IGRpc3BsYXlfY29ubmVjdG9yX2RldGVjdCwKKwkuZ2V0X2VkaWQgPSBkaXNwbGF5X2Nvbm5lY3Rv
cl9nZXRfZWRpZCwKK307CisKK3N0YXRpYyBpcnFyZXR1cm5fdCBkaXNwbGF5X2Nvbm5lY3Rvcl9o
cGRfaXJxKGludCBpcnEsIHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZGlzcGxheV9jb25uZWN0b3Ig
KmNvbm4gPSBhcmc7CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSA9ICZjb25uLT5icmlkZ2U7
CisKKwlkcm1fYnJpZGdlX2hwZF9ub3RpZnkoYnJpZGdlLCBkaXNwbGF5X2Nvbm5lY3Rvcl9kZXRl
Y3QoYnJpZGdlKSk7CisKKwlyZXR1cm4gSVJRX0hBTkRMRUQ7Cit9CisKK3N0YXRpYyBpbnQgZGlz
cGxheV9jb25uZWN0b3JfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlz
dHJ1Y3QgZGlzcGxheV9jb25uZWN0b3IgKmNvbm47CisJdW5zaWduZWQgaW50IHR5cGU7CisJaW50
IHJldDsKKworCWNvbm4gPSBkZXZtX2t6YWxsb2MoJnBkZXYtPmRldiwgc2l6ZW9mKCpjb25uKSwg
R0ZQX0tFUk5FTCk7CisJaWYgKCFjb25uKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXBsYXRmb3Jt
X3NldF9kcnZkYXRhKHBkZXYsIGNvbm4pOworCisJdHlwZSA9ICh1aW50cHRyX3Qpb2ZfZGV2aWNl
X2dldF9tYXRjaF9kYXRhKCZwZGV2LT5kZXYpOworCisJLyogR2V0IHRoZSBleGFjdCBjb25uZWN0
b3IgdHlwZS4gKi8KKwlzd2l0Y2ggKHR5cGUpIHsKKwljYXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9E
VklJOiB7CisJCWJvb2wgYW5hbG9nLCBkaWdpdGFsOworCisJCWFuYWxvZyA9IG9mX3Byb3BlcnR5
X3JlYWRfYm9vbChwZGV2LT5kZXYub2Zfbm9kZSwgImFuYWxvZyIpOworCQlkaWdpdGFsID0gb2Zf
cHJvcGVydHlfcmVhZF9ib29sKHBkZXYtPmRldi5vZl9ub2RlLCAiZGlnaXRhbCIpOworCQlpZiAo
YW5hbG9nICYmICFkaWdpdGFsKSB7CisJCQljb25uLT5icmlkZ2UudHlwZSA9IERSTV9NT0RFX0NP
Tk5FQ1RPUl9EVklBOworCQl9IGVsc2UgaWYgKCFhbmFsb2cgJiYgZGlnaXRhbCkgeworCQkJY29u
bi0+YnJpZGdlLnR5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1JfRFZJRDsKKwkJfSBlbHNlIGlmIChh
bmFsb2cgJiYgZGlnaXRhbCkgeworCQkJY29ubi0+YnJpZGdlLnR5cGUgPSBEUk1fTU9ERV9DT05O
RUNUT1JfRFZJSTsKKwkJfSBlbHNlIHsKKwkJCWRldl9lcnIoJnBkZXYtPmRldiwgIkRWSSBjb25u
ZWN0b3Igd2l0aCBubyB0eXBlXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCWJyZWFr
OworCX0KKworCWNhc2UgRFJNX01PREVfQ09OTkVDVE9SX0hETUlBOiB7CisJCWNvbnN0IGNoYXIg
KmhkbWlfdHlwZTsKKworCQlyZXQgPSBvZl9wcm9wZXJ0eV9yZWFkX3N0cmluZyhwZGV2LT5kZXYu
b2Zfbm9kZSwgInR5cGUiLAorCQkJCQkgICAgICAmaGRtaV90eXBlKTsKKwkJaWYgKHJldCA8IDAp
IHsKKwkJCWRldl9lcnIoJnBkZXYtPmRldiwgIkhETUkgY29ubmVjdG9yIHdpdGggbm8gdHlwZVxu
Iik7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCisJCWlmICghc3RyY21wKGhkbWlfdHlwZSwg
ImEiKSB8fCAhc3RyY21wKGhkbWlfdHlwZSwgImMiKSB8fAorCQkgICAgIXN0cmNtcChoZG1pX3R5
cGUsICJkIikgfHwgIXN0cmNtcChoZG1pX3R5cGUsICJlIikpIHsKKwkJCWNvbm4tPmJyaWRnZS50
eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0hETUlBOworCQl9IGVsc2UgaWYgKCFzdHJjbXAoaGRt
aV90eXBlLCAiYiIpKSB7CisJCQljb25uLT5icmlkZ2UudHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RP
Ul9IRE1JQjsKKwkJfSBlbHNlIHsKKwkJCWRldl9lcnIoJnBkZXYtPmRldiwKKwkJCQkiVW5zdXBw
b3J0ZWQgSERNSSBjb25uZWN0b3IgdHlwZSAnJXMnXG4iLAorCQkJCWhkbWlfdHlwZSk7CisJCQly
ZXR1cm4gLUVJTlZBTDsKKwkJfQorCisJCWJyZWFrOworCX0KKworCWRlZmF1bHQ6CisJCWNvbm4t
PmJyaWRnZS50eXBlID0gdHlwZTsKKwkJYnJlYWs7CisJfQorCisJLyogR2V0IHRoZSBvcHRpb25h
bCBjb25uZWN0b3IgbGFiZWwuICovCisJb2ZfcHJvcGVydHlfcmVhZF9zdHJpbmcocGRldi0+ZGV2
Lm9mX25vZGUsICJsYWJlbCIsICZjb25uLT5sYWJlbCk7CisKKwkvKgorCSAqIEdldCB0aGUgSFBE
IEdQSU8gZm9yIERWSSBhbmQgSERNSSBjb25uZWN0b3JzLiBJZiB0aGUgR1BJTyBjYW4gcHJvdmlk
ZQorCSAqIGludGVycnVwdHMsIHJlZ2lzdGVyIGFuIGludGVycnVwdCBoYW5kbGVyLgorCSAqLwor
CWlmICh0eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9EVklJIHx8CisJICAgIHR5cGUgPT0gRFJN
X01PREVfQ09OTkVDVE9SX0hETUlBKSB7CisJCWNvbm4tPmhwZF9ncGlvID0gZGV2bV9ncGlvZF9n
ZXRfb3B0aW9uYWwoJnBkZXYtPmRldiwgImhwZCIsCisJCQkJCQkJIEdQSU9EX0lOKTsKKwkJaWYg
KElTX0VSUihjb25uLT5ocGRfZ3BpbykpIHsKKwkJCWlmIChQVFJfRVJSKGNvbm4tPmhwZF9ncGlv
KSAhPSAtRVBST0JFX0RFRkVSKQorCQkJCWRldl9lcnIoJnBkZXYtPmRldiwKKwkJCQkJIlVuYWJs
ZSB0byByZXRyaWV2ZSBIUEQgR1BJT1xuIik7CisJCQlyZXR1cm4gUFRSX0VSUihjb25uLT5ocGRf
Z3Bpbyk7CisJCX0KKworCQljb25uLT5ocGRfaXJxID0gZ3Bpb2RfdG9faXJxKGNvbm4tPmhwZF9n
cGlvKTsKKwl9IGVsc2UgeworCQljb25uLT5ocGRfaXJxID0gLUVJTlZBTDsKKwl9CisKKwlpZiAo
Y29ubi0+aHBkX2lycSA+PSAwKSB7CisJCXJldCA9IGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEo
JnBkZXYtPmRldiwgY29ubi0+aHBkX2lycSwKKwkJCQkJCU5VTEwsIGRpc3BsYXlfY29ubmVjdG9y
X2hwZF9pcnEsCisJCQkJCQlJUlFGX1RSSUdHRVJfUklTSU5HIHwKKwkJCQkJCUlSUUZfVFJJR0dF
Ul9GQUxMSU5HIHwKKwkJCQkJCUlSUUZfT05FU0hPVCwKKwkJCQkJCSJIUEQiLCBjb25uKTsKKwkJ
aWYgKHJldCkgeworCQkJZGV2X2VycigmcGRldi0+ZGV2LAorCQkJCSJGYWlsZWQgdG8gcmVxdWVz
dCBIUEQgaW50ZXJydXB0XG4iKTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwkvKiBSZXRy
aWV2ZSB0aGUgRERDIEkyQyBhZGFwdGVyIGZvciBEVkksIEhETUkgYW5kIFZHQSBjb25uZWN0b3Jz
LiAqLworCWlmICh0eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9EVklJIHx8CisJICAgIHR5cGUg
PT0gRFJNX01PREVfQ09OTkVDVE9SX0hETUlBIHx8CisJICAgIHR5cGUgPT0gRFJNX01PREVfQ09O
TkVDVE9SX1ZHQSkgeworCQlzdHJ1Y3QgZGV2aWNlX25vZGUgKnBoYW5kbGU7CisKKwkJcGhhbmRs
ZSA9IG9mX3BhcnNlX3BoYW5kbGUocGRldi0+ZGV2Lm9mX25vZGUsICJkZGMtaTJjLWJ1cyIsIDAp
OworCQlpZiAocGhhbmRsZSkgeworCQkJY29ubi0+YnJpZGdlLmRkYyA9IG9mX2dldF9pMmNfYWRh
cHRlcl9ieV9ub2RlKHBoYW5kbGUpOworCQkJb2Zfbm9kZV9wdXQocGhhbmRsZSk7CisJCQlpZiAo
IWNvbm4tPmJyaWRnZS5kZGMpCisJCQkJcmV0dXJuIC1FUFJPQkVfREVGRVI7CisJCX0gZWxzZSB7
CisJCQlkZXZfZGJnKCZwZGV2LT5kZXYsCisJCQkJIk5vIEkyQyBidXMgc3BlY2lmaWVkLCBkaXNh
YmxpbmcgRURJRCByZWFkb3V0XG4iKTsKKwkJfQorCX0KKworCWNvbm4tPmJyaWRnZS5mdW5jcyA9
ICZkaXNwbGF5X2Nvbm5lY3Rvcl9icmlkZ2VfZnVuY3M7CisJY29ubi0+YnJpZGdlLm9mX25vZGUg
PSBwZGV2LT5kZXYub2Zfbm9kZTsKKworCWlmIChjb25uLT5icmlkZ2UuZGRjKQorCQljb25uLT5i
cmlkZ2Uub3BzIHw9IERSTV9CUklER0VfT1BfRURJRAorCQkJCSB8ICBEUk1fQlJJREdFX09QX0RF
VEVDVDsKKwlpZiAoY29ubi0+aHBkX2dwaW8pCisJCWNvbm4tPmJyaWRnZS5vcHMgfD0gRFJNX0JS
SURHRV9PUF9ERVRFQ1Q7CisJaWYgKGNvbm4tPmhwZF9pcnEgPj0gMCkKKwkJY29ubi0+YnJpZGdl
Lm9wcyB8PSBEUk1fQlJJREdFX09QX0hQRDsKKworCWRldl9pbmZvKCZwZGV2LT5kZXYsCisJCSAi
Rm91bmQgJXMgZGlzcGxheSBjb25uZWN0b3IgJyVzJyAlcyBEREMgYnVzIGFuZCAlcyBIUEQgR1BJ
TyAob3BzIDB4JXgpXG4iLAorCQkgZHJtX2dldF9jb25uZWN0b3JfdHlwZV9uYW1lKGNvbm4tPmJy
aWRnZS50eXBlKSwKKwkJIGNvbm4tPmxhYmVsID8gY29ubi0+bGFiZWwgOiAiPHVubGFiZWxsZWQ+
IiwKKwkJIGNvbm4tPmJyaWRnZS5kZGMgPyAid2l0aCIgOiAid2l0aG91dCIsCisJCSBjb25uLT5o
cGRfZ3BpbyA/ICJ3aXRoIiA6ICJ3aXRob3V0IiwKKwkJIGNvbm4tPmJyaWRnZS5vcHMpOworCisJ
ZHJtX2JyaWRnZV9hZGQoJmNvbm4tPmJyaWRnZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBkaXNwbGF5X2Nvbm5lY3Rvcl9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRl
dikKK3sKKwlzdHJ1Y3QgZGlzcGxheV9jb25uZWN0b3IgKmNvbm4gPSBwbGF0Zm9ybV9nZXRfZHJ2
ZGF0YShwZGV2KTsKKworCWRybV9icmlkZ2VfcmVtb3ZlKCZjb25uLT5icmlkZ2UpOworCisJaWYg
KCFJU19FUlIoY29ubi0+YnJpZGdlLmRkYykpCisJCWkyY19wdXRfYWRhcHRlcihjb25uLT5icmlk
Z2UuZGRjKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2Rldmlj
ZV9pZCBkaXNwbGF5X2Nvbm5lY3Rvcl9tYXRjaFtdID0geworCXsKKwkJLmNvbXBhdGlibGUgPSAi
Y29tcG9zaXRlLXZpZGVvLWNvbm5lY3RvciIsCisJCS5kYXRhID0gKHZvaWQgKilEUk1fTU9ERV9D
T05ORUNUT1JfQ29tcG9zaXRlLAorCX0sIHsKKwkJLmNvbXBhdGlibGUgPSAiZHZpLWNvbm5lY3Rv
ciIsCisJCS5kYXRhID0gKHZvaWQgKilEUk1fTU9ERV9DT05ORUNUT1JfRFZJSSwKKwl9LCB7CisJ
CS5jb21wYXRpYmxlID0gImhkbWktY29ubmVjdG9yIiwKKwkJLmRhdGEgPSAodm9pZCAqKURSTV9N
T0RFX0NPTk5FQ1RPUl9IRE1JQSwKKwl9LCB7CisJCS5jb21wYXRpYmxlID0gInN2aWRlby1jb25u
ZWN0b3IiLAorCQkuZGF0YSA9ICh2b2lkICopRFJNX01PREVfQ09OTkVDVE9SX1NWSURFTywKKwl9
LCB7CisJCS5jb21wYXRpYmxlID0gInZnYS1jb25uZWN0b3IiLAorCQkuZGF0YSA9ICh2b2lkICop
RFJNX01PREVfQ09OTkVDVE9SX1ZHQSwKKwl9LAorCXt9LAorfTsKK01PRFVMRV9ERVZJQ0VfVEFC
TEUob2YsIGRpc3BsYXlfY29ubmVjdG9yX21hdGNoKTsKKworc3RhdGljIHN0cnVjdCBwbGF0Zm9y
bV9kcml2ZXIgZGlzcGxheV9jb25uZWN0b3JfZHJpdmVyID0geworCS5wcm9iZQk9IGRpc3BsYXlf
Y29ubmVjdG9yX3Byb2JlLAorCS5yZW1vdmUJPSBkaXNwbGF5X2Nvbm5lY3Rvcl9yZW1vdmUsCisJ
LmRyaXZlcgkJPSB7CisJCS5uYW1lCQk9ICJkaXNwbGF5LWNvbm5lY3RvciIsCisJCS5vZl9tYXRj
aF90YWJsZQk9IGRpc3BsYXlfY29ubmVjdG9yX21hdGNoLAorCX0sCit9OworbW9kdWxlX3BsYXRm
b3JtX2RyaXZlcihkaXNwbGF5X2Nvbm5lY3Rvcl9kcml2ZXIpOworCitNT0RVTEVfQVVUSE9SKCJM
YXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+Iik7CitN
T0RVTEVfREVTQ1JJUFRJT04oIkRpc3BsYXkgY29ubmVjdG9yIGRyaXZlciIpOworTU9EVUxFX0xJ
Q0VOU0UoIkdQTCIpOwotLSAKUmVnYXJkcywKCkxhdXJlbnQgUGluY2hhcnQKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
