Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 91F512DC1CA
	for <lists+dri-devel@lfdr.de>; Wed, 16 Dec 2020 15:04:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 626116E1B3;
	Wed, 16 Dec 2020 14:04:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x62f.google.com (mail-ej1-x62f.google.com
 [IPv6:2a00:1450:4864:20::62f])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BE0696E1B4
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Dec 2020 14:04:33 +0000 (UTC)
Received: by mail-ej1-x62f.google.com with SMTP id ga15so32851056ejb.4
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Dec 2020 06:04:33 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=MSmu8dVLmrjTl1vf8jYCAWUsAYBLMfbTdkvO9l3flwA=;
 b=F2Y4lS4FCn0y4qmisrIwt8oxNRXaL74eCa1hopVYOji8IX5C3AceWfgq+piH79auZE
 lEO/yFX31mv8YcIXK6Z7Czb8oZFy2kyfwsMDJEsMhOpjaHbsIn8y6zObbBlpHpM9jYaQ
 sDICXNLNpWi0uttjJfT5ZdgX0uC6EZn8mcQRQSglBCsD2RbYnIAuMnWzRcLGDoE5Tijm
 TzNj7oywxOcIpClzlqf54JPWKcD+14CP8RMFl5yxdiQRB0PRL4WOen5eEYid0IuGjjbA
 ezWQ6jzULw7jAg95V7Z7Vf3A5oXrglO3zrdjiCOCjtkZ+yzVwgqELvGr9WUbLYpMhMhJ
 TIbA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=MSmu8dVLmrjTl1vf8jYCAWUsAYBLMfbTdkvO9l3flwA=;
 b=UpuXvKs6h5GPGKWwc4hZER6vRL+2tmIT3nZoo02cm18h7iXzUPfkN8YR1Ok3y4q4l/
 2FPW9VC1luELVijRdzFd7RbJAQFGlWWS05zJPl/DV8E35GbxfAphgCqLxCfHQhdSZkuK
 wFQghhNF+8g/v2nZgWXB1+CVwhqaTDKrCUuMI9DEk+tP+mXGJbbrwPuNQMHwIPxQnWO6
 WjeieGlh8Xvc1cJDlXXME3m3gJy/0qv7Kc0N1OKeJ8fSkL11eXheOGl3cf/4Y+W+5OhJ
 2eQlyR8wG4ZDR3oCqqI+5hHkNMnNhHfRD8jw2sgABrgZy/xMXdkTQZcx4FNDdaZuGl1k
 /WeA==
X-Gm-Message-State: AOAM530ElCAiXaVfuMxuM/ZNvflLXDTINfmDFGm+pAjdZrvsWHqGB2j3
 88CsgdGjTthl8VIH+aGE8wqdNW0bZLw=
X-Google-Smtp-Source: ABdhPJzUNG2H6M7tfvsOUarf4/tOQcPVqcGbOUuDVyeGBQ1GUp41tw7BGI3ZOZqyMqgIYEJlcktk7Q==
X-Received: by 2002:a17:906:94d4:: with SMTP id
 d20mr10871948ejy.475.1608127471521; 
 Wed, 16 Dec 2020 06:04:31 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:236a:b682:bfd3:f5cf])
 by smtp.gmail.com with ESMTPSA id r7sm14177833edh.86.2020.12.16.06.04.29
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 16 Dec 2020 06:04:30 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org,
	linux-graphics-maintainer@vmware.com
Subject: [PATCH 2/2] drm/ttm: move memory accounting into vmwgfx
Date: Wed, 16 Dec 2020 15:04:27 +0100
Message-Id: <20201216140427.1253-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20201216140427.1253-1-christian.koenig@amd.com>
References: <20201216140427.1253-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: airlied@linux.ie, ray.huang@amd.com, sroland@vmware.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBqdXN0IGFub3RoZXIgZmVhdHVyZSB3aGljaCBpcyBvbmx5IHVzZWQgYnkgVk1XR0ZY
LCBzbyBtb3ZlCml0IGludG8gdGhlIGRyaXZlciBpbnN0ZWFkLgoKSSd2ZSB0cmllZCB0byBhZGQg
dGhlIGFjY291bnRpbmcgc3lzZnMgZmlsZSB0byB0aGUga29iamVjdCBvZiB0aGUgZHJtCm1pbm9y
LCBidXQgSSdtIG5vdCAxMDAlIHN1cmUgaWYgdGhpcyB3b3JrcyBhcyBleHBlY3RlZC4KClNpZ25l
ZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0t
CiAuLi4vZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyAgfCAxNiArKysr
LS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyAgICB8ICA4ICst
LQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYyAgICAgICAgIHwgIDYgKy0t
CiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMgICAgICAgICAgfCAgNyArLS0K
IGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmggICAgICAgICB8ICAxIC0KIGRy
aXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jICAgICAgICAgICAgICB8ICA0ICstCiBkcml2
ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyAgICAgICAgfCAgOCArLS0KIGRyaXZl
cnMvZ3B1L2RybS90dG0vTWFrZWZpbGUgICAgICAgICAgICAgICAgICB8ICA2ICstLQogZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fYm8uYyAgICAgICAgICAgICAgICAgIHwgNTIgKysrKysrLS0tLS0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jICAgICAgICAgICAgIHwg
IDEgLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jICAgICAgICAgICAgICAgIHwgMTMg
Ky0tLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvTWFrZWZpbGUgICAgICAgICAgICAgICB8ICAy
ICstCiBkcml2ZXJzL2dwdS9kcm0ve3R0bSA9PiB2bXdnZnh9L3R0bV9tZW1vcnkuYyAgfCAxOSAr
KystLS0tCiAuLi4vZ3B1L2RybS92bXdnZnh9L3R0bV9tZW1vcnkuaCAgICAgICAgICAgICAgfCAg
NSArLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmggICAgICAgICAgIHwgIDMg
Ky0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMgICAgICAgICAgICB8IDIyICsr
KysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuYyAgICAgICAgICAgfCAg
NSArKwogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5jICAgIHwgMjgg
KysrKysrKysrLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaCAgICAgICAgICAgICAgICAg
IHwgMTMgKy0tLS0KIGluY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggICAgICAgICAgICAg
ICB8ICAxIC0KIGluY2x1ZGUvZHJtL3R0bS90dG1fdHQuaCAgICAgICAgICAgICAgICAgICAgICB8
ICAxICsKIDIxIGZpbGVzIGNoYW5nZWQsIDEwNyBpbnNlcnRpb25zKCspLCAxMTQgZGVsZXRpb25z
KC0pCiByZW5hbWUgZHJpdmVycy9ncHUvZHJtL3t0dG0gPT4gdm13Z2Z4fS90dG1fbWVtb3J5LmMg
KDk3JSkKIHJlbmFtZSB7aW5jbHVkZS9kcm0vdHRtID0+IGRyaXZlcnMvZ3B1L2RybS92bXdnZnh9
L3R0bV9tZW1vcnkuaCAoOTclKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9hbWRrZmRfZ3B1dm0uYwppbmRleCBhOTY0N2U3Zjk4YTguLjVlZDFjODhiODc0OCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwpA
QCAtMTE4LDYgKzExOCwxNiBAQCB2b2lkIGFtZGdwdV9hbWRrZmRfZ3B1dm1faW5pdF9tZW1fbGlt
aXRzKHZvaWQpCiAgKi8KICNkZWZpbmUgRVNUSU1BVEVfUFRfU0laRShtZW1fc2l6ZSkgKChtZW1f
c2l6ZSkgPj4gMTQpCiAKK3N0YXRpYyBzaXplX3QgYW1kZ3B1X2FtZGtmZF9hY2Nfc2l6ZSh1aW50
NjRfdCBzaXplKQoreworCXNpemUgPj49IFBBR0VfU0hJRlQ7CisJc2l6ZSAqPSBzaXplb2YoZG1h
X2FkZHJfdCkgKyBzaXplb2Yodm9pZCAqKTsKKworCXJldHVybiBfX3JvdW5kdXBfcG93X29mX3R3
byhzaXplb2Yoc3RydWN0IGFtZGdwdV9ibykpICsKKwkJX19yb3VudHVwX3Bvd19vZl90d28oc2l6
ZW9mKHN0cnVjdCB0dG1fdHQpKSArCisJCVBBR0VfQUxJR04oc2l6ZSk7Cit9CisKIHN0YXRpYyBp
bnQgYW1kZ3B1X2FtZGtmZF9yZXNlcnZlX21lbV9saW1pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiwKIAkJdWludDY0X3Qgc2l6ZSwgdTMyIGRvbWFpbiwgYm9vbCBzZykKIHsKQEAgLTEyNiw4
ICsxMzYsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9hbWRrZmRfcmVzZXJ2ZV9tZW1fbGltaXQoc3Ry
dWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJc2l6ZV90IGFjY19zaXplLCBzeXN0ZW1fbWVtX25l
ZWRlZCwgdHRtX21lbV9uZWVkZWQsIHZyYW1fbmVlZGVkOwogCWludCByZXQgPSAwOwogCi0JYWNj
X3NpemUgPSB0dG1fYm9fZG1hX2FjY19zaXplKCZhZGV2LT5tbWFuLmJkZXYsIHNpemUsCi0JCQkJ
ICAgICAgIHNpemVvZihzdHJ1Y3QgYW1kZ3B1X2JvKSk7CisJYWNjX3NpemUgPSBhbWRncHVfYW1k
a2ZkX2FjY19zaXplKHNpemUpOwogCiAJdnJhbV9uZWVkZWQgPSAwOwogCWlmIChkb21haW4gPT0g
QU1ER1BVX0dFTV9ET01BSU5fR1RUKSB7CkBAIC0xNzQsOCArMTgzLDcgQEAgc3RhdGljIHZvaWQg
dW5yZXNlcnZlX21lbV9saW1pdChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIHsKIAlzaXpl
X3QgYWNjX3NpemU7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUoJmFkZXYtPm1t
YW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCBhbWRncHVfYm8pKTsKKwlh
Y2Nfc2l6ZSA9IGFtZGdwdV9hbWRrZmRfYWNjX3NpemUoc2l6ZSk7CiAKIAlzcGluX2xvY2soJmtm
ZF9tZW1fbGltaXQubWVtX2xpbWl0X2xvY2spOwogCWlmIChkb21haW4gPT0gQU1ER1BVX0dFTV9E
T01BSU5fR1RUKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMK
aW5kZXggNmNjOTkxOWIxMmNjLi41OTljOWExMzJlYjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKQEAgLTUyMyw3ICs1MjMsNiBAQCBzdGF0aWMgaW50IGFt
ZGdwdV9ib19kb19jcmVhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJfTsKIAlzdHJ1
Y3QgYW1kZ3B1X2JvICpibzsKIAl1bnNpZ25lZCBsb25nIHBhZ2VfYWxpZ24sIHNpemUgPSBicC0+
c2l6ZTsKLQlzaXplX3QgYWNjX3NpemU7CiAJaW50IHI7CiAKIAkvKiBOb3RlIHRoYXQgR0RTL0dX
Uy9PQSBhbGxvY2F0ZXMgMSBwYWdlIHBlciBieXRlL3Jlc291cmNlLiAqLwpAQCAtNTQ2LDkgKzU0
NSw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2JvX2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKIAogCSpib19wdHIgPSBOVUxMOwogCi0JYWNjX3NpemUgPSB0dG1fYm9fZG1hX2Fj
Y19zaXplKCZhZGV2LT5tbWFuLmJkZXYsIHNpemUsCi0JCQkJICAgICAgIHNpemVvZihzdHJ1Y3Qg
YW1kZ3B1X2JvKSk7Ci0KIAlibyA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVjdCBhbWRncHVfYm8pLCBH
RlBfS0VSTkVMKTsKIAlpZiAoYm8gPT0gTlVMTCkKIAkJcmV0dXJuIC1FTk9NRU07CkBAIC01Nzcs
OCArNTczLDggQEAgc3RhdGljIGludCBhbWRncHVfYm9fZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2LAogCQliby0+dGJvLnByaW9yaXR5ID0gMTsKIAogCXIgPSB0dG1fYm9faW5p
dF9yZXNlcnZlZCgmYWRldi0+bW1hbi5iZGV2LCAmYm8tPnRibywgc2l6ZSwgYnAtPnR5cGUsCi0J
CQkJICZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAmY3R4LCBhY2Nfc2l6ZSwKLQkJCQkgTlVM
TCwgYnAtPnJlc3YsICZhbWRncHVfYm9fZGVzdHJveSk7CisJCQkJICZiby0+cGxhY2VtZW50LCBw
YWdlX2FsaWduLCAmY3R4LCAgTlVMTCwKKwkJCQkgYnAtPnJlc3YsICZhbWRncHVfYm9fZGVzdHJv
eSk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkpCiAJCXJldHVybiByOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9nZW1fdnJhbV9oZWxwZXIuYwppbmRleCAwMmNhMjJlOTAyOTAuLjVjZjc3OTcwNDhlMSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC0xODksNyArMTg5LDYgQEAgc3Ry
dWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1fdnJhbV9jcmVhdGUoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAlzdHJ1Y3QgZHJtX3ZyYW1fbW0gKnZtbSA9IGRldi0+dnJhbV9tbTsKIAlz
dHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldjsKIAlpbnQgcmV0OwotCXNpemVfdCBhY2Nfc2l6ZTsK
IAogCWlmIChXQVJOX09OQ0UoIXZtbSwgIlZSQU0gTU0gbm90IGluaXRpYWxpemVkIikpCiAJCXJl
dHVybiBFUlJfUFRSKC1FSU5WQUwpOwpAQCAtMjE2LDcgKzIxNSw2IEBAIHN0cnVjdCBkcm1fZ2Vt
X3ZyYW1fb2JqZWN0ICpkcm1fZ2VtX3ZyYW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJfQogCiAJYmRldiA9ICZ2bW0tPmJkZXY7Ci0JYWNjX3NpemUgPSB0dG1fYm9fZG1hX2FjY19z
aXplKGJkZXYsIHNpemUsIHNpemVvZigqZ2JvKSk7CiAKIAlnYm8tPmJvLmJkZXYgPSBiZGV2Owog
CWRybV9nZW1fdnJhbV9wbGFjZW1lbnQoZ2JvLCBEUk1fR0VNX1ZSQU1fUExfRkxBR19TWVNURU0p
OwpAQCAtMjI2LDggKzIyNCw4IEBAIHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpkcm1fZ2Vt
X3ZyYW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJICogdG8gcmVsZWFzZSBnYm8t
PmJvLmJhc2UgYW5kIGtmcmVlIGdiby4KIAkgKi8KIAlyZXQgPSB0dG1fYm9faW5pdChiZGV2LCAm
Z2JvLT5ibywgc2l6ZSwgdHRtX2JvX3R5cGVfZGV2aWNlLAotCQkJICAmZ2JvLT5wbGFjZW1lbnQs
IHBnX2FsaWduLCBmYWxzZSwgYWNjX3NpemUsCi0JCQkgIE5VTEwsIE5VTEwsIHR0bV9idWZmZXJf
b2JqZWN0X2Rlc3Ryb3kpOworCQkJICAmZ2JvLT5wbGFjZW1lbnQsIHBnX2FsaWduLCBmYWxzZSwg
TlVMTCwgTlVMTCwKKwkJCSAgdHRtX2J1ZmZlcl9vYmplY3RfZGVzdHJveSk7CiAJaWYgKHJldCkK
IAkJcmV0dXJuIEVSUl9QVFIocmV0KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5j
CmluZGV4IDAyZDg2ZjgzMTFhOS4uNjRjYjFlZDBmNmVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUv
bm91dmVhdV9iby5jCkBAIC0zMDAsMTggKzMwMCwxNSBAQCBub3V2ZWF1X2JvX2luaXQoc3RydWN0
IG5vdXZlYXVfYm8gKm52Ym8sIHU2NCBzaXplLCBpbnQgYWxpZ24sIHUzMiBkb21haW4sCiAJCXN0
cnVjdCBzZ190YWJsZSAqc2csIHN0cnVjdCBkbWFfcmVzdiAqcm9iaikKIHsKIAlpbnQgdHlwZSA9
IHNnID8gdHRtX2JvX3R5cGVfc2cgOiB0dG1fYm9fdHlwZV9kZXZpY2U7Ci0Jc2l6ZV90IGFjY19z
aXplOwogCWludCByZXQ7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUobnZiby0+
Ym8uYmRldiwgc2l6ZSwgc2l6ZW9mKCpudmJvKSk7Ci0KIAludmJvLT5iby5tZW0ubnVtX3BhZ2Vz
ID0gc2l6ZSA+PiBQQUdFX1NISUZUOwogCW5vdXZlYXVfYm9fcGxhY2VtZW50X3NldChudmJvLCBk
b21haW4sIDApOwogCUlOSVRfTElTVF9IRUFEKCZudmJvLT5pb19yZXNlcnZlX2xydSk7CiAKIAly
ZXQgPSB0dG1fYm9faW5pdChudmJvLT5iby5iZGV2LCAmbnZiby0+Ym8sIHNpemUsIHR5cGUsCi0J
CQkgICZudmJvLT5wbGFjZW1lbnQsIGFsaWduID4+IFBBR0VfU0hJRlQsIGZhbHNlLAotCQkJICBh
Y2Nfc2l6ZSwgc2csIHJvYmosIG5vdXZlYXVfYm9fZGVsX3R0bSk7CisJCQkgICZudmJvLT5wbGFj
ZW1lbnQsIGFsaWduID4+IFBBR0VfU0hJRlQsIGZhbHNlLCBzZywKKwkJCSAgcm9iaiwgbm91dmVh
dV9ib19kZWxfdHRtKTsKIAlpZiAocmV0KSB7CiAJCS8qIHR0bSB3aWxsIGNhbGwgbm91dmVhdV9i
b19kZWxfdHRtIGlmIGl0IGZhaWxzLi4gKi8KIAkJcmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2Rydi5oCmluZGV4IGM4MDJkM2QxYmEzOS4uNzAwZmEwOTc5ZDE0IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKQEAgLTU0LDcgKzU0LDYgQEAKICNpbmNs
dWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19kcml2
ZXIuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wbGFjZW1lbnQuaD4KLSNpbmNsdWRlIDxkcm0v
dHRtL3R0bV9tZW1vcnkuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1fYXVkaW9fY29tcG9uZW50Lmg+
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKaW5kZXggY2VlYmM1ODgxZjY4Li43MDViNTE1MzU0
OTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jCkBAIC0xMzgsOCArMTM4LDggQEAgaW50IHF4
bF9ib19jcmVhdGUoc3RydWN0IHF4bF9kZXZpY2UgKnFkZXYsCiAJcXhsX3R0bV9wbGFjZW1lbnRf
ZnJvbV9kb21haW4oYm8sIGRvbWFpbik7CiAKIAlyID0gdHRtX2JvX2luaXRfcmVzZXJ2ZWQoJnFk
ZXYtPm1tYW4uYmRldiwgJmJvLT50Ym8sIHNpemUsIHR5cGUsCi0JCQkJICZiby0+cGxhY2VtZW50
LCAwLCAmY3R4LCBzaXplLAotCQkJCSBOVUxMLCBOVUxMLCAmcXhsX3R0bV9ib19kZXN0cm95KTsK
KwkJCQkgJmJvLT5wbGFjZW1lbnQsIDAsICZjdHgsIE5VTEwsIE5VTEwsCisJCQkJICZxeGxfdHRt
X2JvX2Rlc3Ryb3kpOwogCWlmICh1bmxpa2VseShyICE9IDApKSB7CiAJCWlmIChyICE9IC1FUkVT
VEFSVFNZUykKIAkJCWRldl9lcnIocWRldi0+ZGRldi5kZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX29iamVjdC5jCmluZGV4IDliODE3ODY3ODJkZS4uNWNkNDRmMmE3N2NkIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYwpAQCAtMTU5LDcgKzE1OSw2IEBAIGludCBy
YWRlb25fYm9fY3JlYXRlKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2LAogCXN0cnVjdCByYWRl
b25fYm8gKmJvOwogCWVudW0gdHRtX2JvX3R5cGUgdHlwZTsKIAl1bnNpZ25lZCBsb25nIHBhZ2Vf
YWxpZ24gPSByb3VuZHVwKGJ5dGVfYWxpZ24sIFBBR0VfU0laRSkgPj4gUEFHRV9TSElGVDsKLQlz
aXplX3QgYWNjX3NpemU7CiAJaW50IHI7CiAKIAlzaXplID0gQUxJR04oc2l6ZSwgUEFHRV9TSVpF
KTsKQEAgLTE3Myw5ICsxNzIsNiBAQCBpbnQgcmFkZW9uX2JvX2NyZWF0ZShzdHJ1Y3QgcmFkZW9u
X2RldmljZSAqcmRldiwKIAl9CiAJKmJvX3B0ciA9IE5VTEw7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9i
b19kbWFfYWNjX3NpemUoJnJkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9m
KHN0cnVjdCByYWRlb25fYm8pKTsKLQogCWJvID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHJhZGVv
bl9ibyksIEdGUF9LRVJORUwpOwogCWlmIChibyA9PSBOVUxMKQogCQlyZXR1cm4gLUVOT01FTTsK
QEAgLTIzMCw4ICsyMjYsOCBAQCBpbnQgcmFkZW9uX2JvX2NyZWF0ZShzdHJ1Y3QgcmFkZW9uX2Rl
dmljZSAqcmRldiwKIAkvKiBLZXJuZWwgYWxsb2NhdGlvbiBhcmUgdW5pbnRlcnJ1cHRpYmxlICov
CiAJZG93bl9yZWFkKCZyZGV2LT5wbS5tY2xrX2xvY2spOwogCXIgPSB0dG1fYm9faW5pdCgmcmRl
di0+bW1hbi5iZGV2LCAmYm8tPnRibywgc2l6ZSwgdHlwZSwKLQkJCSZiby0+cGxhY2VtZW50LCBw
YWdlX2FsaWduLCAha2VybmVsLCBhY2Nfc2l6ZSwKLQkJCXNnLCByZXN2LCAmcmFkZW9uX3R0bV9i
b19kZXN0cm95KTsKKwkJCSZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAha2VybmVsLCBzZywg
cmVzdiwKKwkJCSZyYWRlb25fdHRtX2JvX2Rlc3Ryb3kpOwogCXVwX3JlYWQoJnJkZXYtPnBtLm1j
bGtfbG9jayk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkpIHsKIAkJcmV0dXJuIHI7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL3R0bS9N
YWtlZmlsZQppbmRleCBiNmY1Zjg3YjI3MGYuLjdlOGRjODVjYWFjMyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL01ha2Vm
aWxlCkBAIC0yLDEwICsyLDggQEAKICMKICMgTWFrZWZpbGUgZm9yIHRoZSBkcm0gZGV2aWNlIGRy
aXZlci4gIFRoaXMgZHJpdmVyIHByb3ZpZGVzIHN1cHBvcnQgZm9yIHRoZQogCi10dG0teSA6PSB0
dG1fbWVtb3J5Lm8gdHRtX3R0Lm8gdHRtX2JvLm8gXAotCXR0bV9ib191dGlsLm8gdHRtX2JvX3Zt
Lm8gdHRtX21vZHVsZS5vIFwKLQl0dG1fZXhlY2J1Zl91dGlsLm8gdHRtX3JhbmdlX21hbmFnZXIu
byBcCi0JdHRtX3Jlc291cmNlLm8gdHRtX3Bvb2wubwordHRtLXkgOj0gdHRtX3R0Lm8gdHRtX2Jv
Lm8gdHRtX2JvX3V0aWwubyB0dG1fYm9fdm0ubyB0dG1fbW9kdWxlLm8gXAorCXR0bV9leGVjYnVm
X3V0aWwubyB0dG1fcmFuZ2VfbWFuYWdlci5vIHR0bV9yZXNvdXJjZS5vIHR0bV9wb29sLm8KIHR0
bS0kKENPTkZJR19BR1ApICs9IHR0bV9hZ3BfYmFja2VuZC5vCiAKIG9iai0kKENPTkZJR19EUk1f
VFRNKSArPSB0dG0ubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyBi
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKaW5kZXggZjFmM2ZkMDg1NDY1Li5jYmI0ZDY3
YzkyODggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYwpAQCAtNDc0LDcgKzQ3NCw2IEBAIHN0YXRpYyB2b2lk
IHR0bV9ib19yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQogCXN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8gPQogCSAgICBjb250YWluZXJfb2Yoa3JlZiwgc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0LCBrcmVmKTsKIAlzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiA9IGJvLT5iZGV2OwotCXNp
emVfdCBhY2Nfc2l6ZSA9IGJvLT5hY2Nfc2l6ZTsKIAlpbnQgcmV0OwogCiAJaWYgKCFiby0+ZGVs
ZXRlZCkgewpAQCAtNTM0LDcgKzUzMyw2IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19yZWxlYXNlKHN0
cnVjdCBrcmVmICprcmVmKQogCWlmICghdHRtX2JvX3VzZXNfZW1iZWRkZWRfZ2VtX29iamVjdChi
bykpCiAJCWRtYV9yZXN2X2ZpbmkoJmJvLT5iYXNlLl9yZXN2KTsKIAliby0+ZGVzdHJveShibyk7
Ci0JdHRtX21lbV9nbG9iYWxfZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSk7CiB9CiAKIHZv
aWQgdHRtX2JvX3B1dChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQpAQCAtMTA5NSwyNSAr
MTA5MywxMyBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9ib19kZXZpY2Ug
KmJkZXYsCiAJCQkgc3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCwKIAkJCSB1aW50MzJf
dCBwYWdlX2FsaWdubWVudCwKIAkJCSBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwKLQkJ
CSBzaXplX3QgYWNjX3NpemUsCiAJCQkgc3RydWN0IHNnX3RhYmxlICpzZywKIAkJCSBzdHJ1Y3Qg
ZG1hX3Jlc3YgKnJlc3YsCiAJCQkgdm9pZCAoKmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKikpCiB7Ci0Jc3RydWN0IHR0bV9tZW1fZ2xvYmFsICptZW1fZ2xvYiA9ICZ0dG1fbWVt
X2dsb2I7CiAJYm9vbCBsb2NrZWQ7CiAJaW50IHJldCA9IDA7CiAKLQlyZXQgPSB0dG1fbWVtX2ds
b2JhbF9hbGxvYyhtZW1fZ2xvYiwgYWNjX3NpemUsIGN0eCk7Ci0JaWYgKHJldCkgewotCQlwcl9l
cnIoIk91dCBvZiBrZXJuZWwgbWVtb3J5XG4iKTsKLQkJaWYgKGRlc3Ryb3kpCi0JCQkoKmRlc3Ry
b3kpKGJvKTsKLQkJZWxzZQotCQkJa2ZyZWUoYm8pOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9Ci0K
IAliby0+ZGVzdHJveSA9IGRlc3Ryb3kgPyBkZXN0cm95IDogdHRtX2JvX2RlZmF1bHRfZGVzdHJv
eTsKIAogCWtyZWZfaW5pdCgmYm8tPmtyZWYpOwpAQCAtMTEzMCw3ICsxMTE2LDYgQEAgaW50IHR0
bV9ib19pbml0X3Jlc2VydmVkKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCWJvLT5tZW0u
YnVzLmFkZHIgPSBOVUxMOwogCWJvLT5tb3ZpbmcgPSBOVUxMOwogCWJvLT5tZW0ucGxhY2VtZW50
ID0gMDsKLQliby0+YWNjX3NpemUgPSBhY2Nfc2l6ZTsKIAliby0+cGluX2NvdW50ID0gMDsKIAli
by0+c2cgPSBzZzsKIAlpZiAocmVzdikgewpAQCAtMTE5MSw3ICsxMTc2LDYgQEAgaW50IHR0bV9i
b19pbml0KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCQlzdHJ1Y3QgdHRtX3BsYWNlbWVu
dCAqcGxhY2VtZW50LAogCQl1aW50MzJfdCBwYWdlX2FsaWdubWVudCwKIAkJYm9vbCBpbnRlcnJ1
cHRpYmxlLAotCQlzaXplX3QgYWNjX3NpemUsCiAJCXN0cnVjdCBzZ190YWJsZSAqc2csCiAJCXN0
cnVjdCBkbWFfcmVzdiAqcmVzdiwKIAkJdm9pZCAoKmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QgKikpCkBAIC0xMjAwLDggKzExODQsNyBAQCBpbnQgdHRtX2JvX2luaXQoc3RydWN0
IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJaW50IHJldDsKIAogCXJldCA9IHR0bV9ib19pbml0X3Jl
c2VydmVkKGJkZXYsIGJvLCBzaXplLCB0eXBlLCBwbGFjZW1lbnQsCi0JCQkJICAgcGFnZV9hbGln
bm1lbnQsICZjdHgsIGFjY19zaXplLAotCQkJCSAgIHNnLCByZXN2LCBkZXN0cm95KTsKKwkJCQkg
ICBwYWdlX2FsaWdubWVudCwgJmN0eCwgc2csIHJlc3YsIGRlc3Ryb3kpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKQEAgLTEyMTIsMjAgKzExOTUsNiBAQCBpbnQgdHRtX2JvX2luaXQoc3Ry
dWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib19pbml0KTsK
IAotc2l6ZV90IHR0bV9ib19kbWFfYWNjX3NpemUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
Ci0JCQkgICB1bnNpZ25lZCBsb25nIGJvX3NpemUsCi0JCQkgICB1bnNpZ25lZCBzdHJ1Y3Rfc2l6
ZSkKLXsKLQl1bnNpZ25lZCBucGFnZXMgPSAoUEFHRV9BTElHTihib19zaXplKSkgPj4gUEFHRV9T
SElGVDsKLQlzaXplX3Qgc2l6ZSA9IDA7Ci0KLQlzaXplICs9IHR0bV9yb3VuZF9wb3Qoc3RydWN0
X3NpemUpOwotCXNpemUgKz0gdHRtX3JvdW5kX3BvdChucGFnZXMgKiAoMipzaXplb2Yodm9pZCAq
KSArIHNpemVvZihkbWFfYWRkcl90KSkpOwotCXNpemUgKz0gdHRtX3JvdW5kX3BvdChzaXplb2Yo
c3RydWN0IHR0bV90dCkpOwotCXJldHVybiBzaXplOwotfQotRVhQT1JUX1NZTUJPTCh0dG1fYm9f
ZG1hX2FjY19zaXplKTsKLQogc3RhdGljIHZvaWQgdHRtX2JvX2dsb2JhbF9rb2JqX3JlbGVhc2Uo
c3RydWN0IGtvYmplY3QgKmtvYmopCiB7CiAJc3RydWN0IHR0bV9ib19nbG9iYWwgKmdsb2IgPQpA
QCAtMTI0Miw5ICsxMjExLDExIEBAIHN0YXRpYyB2b2lkIHR0bV9ib19nbG9iYWxfcmVsZWFzZSh2
b2lkKQogCWlmICgtLXR0bV9ib19nbG9iX3VzZV9jb3VudCA+IDApCiAJCWdvdG8gb3V0OwogCisJ
dHRtX3R0X21ncl9maW5pKCk7CisJdHRtX3Bvb2xfbWdyX2ZpbmkoKTsKKwogCWtvYmplY3RfZGVs
KCZnbG9iLT5rb2JqKTsKIAlrb2JqZWN0X3B1dCgmZ2xvYi0+a29iaik7Ci0JdHRtX21lbV9nbG9i
YWxfcmVsZWFzZSgmdHRtX21lbV9nbG9iKTsKIAltZW1zZXQoZ2xvYiwgMCwgc2l6ZW9mKCpnbG9i
KSk7CiBvdXQ6CiAJbXV0ZXhfdW5sb2NrKCZ0dG1fZ2xvYmFsX211dGV4KTsKQEAgLTEyNTMsNiAr
MTIyNCw4IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19nbG9iYWxfcmVsZWFzZSh2b2lkKQogc3RhdGlj
IGludCB0dG1fYm9fZ2xvYmFsX2luaXQodm9pZCkKIHsKIAlzdHJ1Y3QgdHRtX2JvX2dsb2JhbCAq
Z2xvYiA9ICZ0dG1fYm9fZ2xvYjsKKwl1aW50NjRfdCBudW1fcGFnZXM7CisJc3RydWN0IHN5c2lu
Zm8gc2k7CiAJaW50IHJldCA9IDA7CiAJdW5zaWduZWQgaTsKIApAQCAtMTI2MCw5ICsxMjMzLDE2
IEBAIHN0YXRpYyBpbnQgdHRtX2JvX2dsb2JhbF9pbml0KHZvaWQpCiAJaWYgKCsrdHRtX2JvX2ds
b2JfdXNlX2NvdW50ID4gMSkKIAkJZ290byBvdXQ7CiAKLQlyZXQgPSB0dG1fbWVtX2dsb2JhbF9p
bml0KCZ0dG1fbWVtX2dsb2IpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OworCXNpX21lbWluZm8o
JnNpKTsKKworCS8qIExpbWl0IHRoZSBudW1iZXIgb2YgcGFnZXMgaW4gdGhlIHBvb2wgdG8gYWJv
dXQgNTAlIG9mIHRoZSB0b3RhbAorCSAqIHN5c3RlbSBtZW1vcnkuCisJICovCisJbnVtX3BhZ2Vz
ID0gKHU2NClzaS50b3RhbHJhbSAqIHNpLm1lbV91bml0OworCW51bV9wYWdlcyA9IChudW1fcGFn
ZXMgKiA1MCAvIDEwMCkgPj4gUEFHRV9TSElGVDsKKworCXR0bV9wb29sX21ncl9pbml0KG51bV9w
YWdlcyk7CisJdHRtX3R0X21ncl9pbml0KCk7CiAKIAlzcGluX2xvY2tfaW5pdCgmZ2xvYi0+bHJ1
X2xvY2spOwogCWdsb2ItPmR1bW15X3JlYWRfcGFnZSA9IGFsbG9jX3BhZ2UoX19HRlBfWkVSTyB8
IEdGUF9ETUEzMik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGls
LmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKaW5kZXggMzk4ZDUwMTNmYzM5
Li4wM2U5ZjZmNmE2MTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0
aWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKQEAgLTMwOSw3ICsz
MDksNiBAQCBzdGF0aWMgaW50IHR0bV9idWZmZXJfb2JqZWN0X3RyYW5zZmVyKHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8sCiAKIAlrcmVmX2luaXQoJmZiby0+YmFzZS5rcmVmKTsKIAlmYm8t
PmJhc2UuZGVzdHJveSA9ICZ0dG1fdHJhbnNmZXJlZF9kZXN0cm95OwotCWZiby0+YmFzZS5hY2Nf
c2l6ZSA9IDA7CiAJZmJvLT5iYXNlLnBpbl9jb3VudCA9IDA7CiAJaWYgKGJvLT50eXBlICE9IHR0
bV9ib190eXBlX3NnKQogCQlmYm8tPmJhc2UuYmFzZS5yZXN2ID0gJmZiby0+YmFzZS5iYXNlLl9y
ZXN2OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jIGIvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCmluZGV4IDU0NTViMjA0NDc1OS4uMjRhZTdjMjNjZmQw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCkBAIC00MTYsMTYgKzQxNiwxMCBAQCBpbnQgdHRtX3Bv
b2xfYWxsb2Moc3RydWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3QgdHRtX3R0ICp0dCwKIAkJCWNh
Y2hpbmcgPSBwYWdlcyArICgxIDw8IG9yZGVyKTsKIAkJfQogCi0JCXIgPSB0dG1fbWVtX2dsb2Jh
bF9hbGxvY19wYWdlKCZ0dG1fbWVtX2dsb2IsIHAsCi0JCQkJCSAgICAgICgxIDw8IG9yZGVyKSAq
IFBBR0VfU0laRSwKLQkJCQkJICAgICAgY3R4KTsKLQkJaWYgKHIpCi0JCQlnb3RvIGVycm9yX2Zy
ZWVfcGFnZTsKLQogCQlpZiAoZG1hX2FkZHIpIHsKIAkJCXIgPSB0dG1fcG9vbF9tYXAocG9vbCwg
b3JkZXIsIHAsICZkbWFfYWRkcik7CiAJCQlpZiAocikKLQkJCQlnb3RvIGVycm9yX2dsb2JhbF9m
cmVlOworCQkJCWdvdG8gZXJyb3JfZnJlZV9wYWdlOwogCQl9CiAKIAkJbnVtX3BhZ2VzIC09IDEg
PDwgb3JkZXI7CkBAIC00MzksOSArNDMzLDYgQEAgaW50IHR0bV9wb29sX2FsbG9jKHN0cnVjdCB0
dG1fcG9vbCAqcG9vbCwgc3RydWN0IHR0bV90dCAqdHQsCiAKIAlyZXR1cm4gMDsKIAotZXJyb3Jf
Z2xvYmFsX2ZyZWU6Ci0JdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2IsIHAs
ICgxIDw8IG9yZGVyKSAqIFBBR0VfU0laRSk7Ci0KIGVycm9yX2ZyZWVfcGFnZToKIAl0dG1fcG9v
bF9mcmVlX3BhZ2UocG9vbCwgdHQtPmNhY2hpbmcsIG9yZGVyLCBwKTsKIApAQCAtNDc2LDggKzQ2
Nyw2IEBAIHZvaWQgdHRtX3Bvb2xfZnJlZShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCB0
dG1fdHQgKnR0KQogCiAJCW9yZGVyID0gdHRtX3Bvb2xfcGFnZV9vcmRlcihwb29sLCBwKTsKIAkJ
bnVtX3BhZ2VzID0gMVVMTCA8PCBvcmRlcjsKLQkJdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0
dG1fbWVtX2dsb2IsIHAsCi0JCQkJCSBudW1fcGFnZXMgKiBQQUdFX1NJWkUpOwogCQlpZiAodHQt
PmRtYV9hZGRyZXNzKQogCQkJdHRtX3Bvb2xfdW5tYXAocG9vbCwgdHQtPmRtYV9hZGRyZXNzW2ld
LCBudW1fcGFnZXMpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2Vm
aWxlIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC9NYWtlZmlsZQppbmRleCAzMWY4NWYwOWYxZmMu
Ljg2YWY1ZDdiMDI0MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC9NYWtlZmls
ZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2VmaWxlCkBAIC05LDcgKzksNyBAQCB2
bXdnZngteSA6PSB2bXdnZnhfZXhlY2J1Zi5vIHZtd2dmeF9nbXIubyB2bXdnZnhfa21zLm8gdm13
Z2Z4X2Rydi5vIFwKIAkgICAgdm13Z2Z4X2NvdGFibGUubyB2bXdnZnhfc28ubyB2bXdnZnhfYmlu
ZGluZy5vIHZtd2dmeF9tc2cubyBcCiAJICAgIHZtd2dmeF9zaW1wbGVfcmVzb3VyY2UubyB2bXdn
ZnhfdmEubyB2bXdnZnhfYmxpdC5vIFwKIAkgICAgdm13Z2Z4X3ZhbGlkYXRpb24ubyB2bXdnZnhf
cGFnZV9kaXJ0eS5vIHZtd2dmeF9zdHJlYW1vdXRwdXQubyBcCi0JICAgIHR0bV9vYmplY3QubyB0
dG1fbG9jay5vCisJICAgIHR0bV9vYmplY3QubyB0dG1fbG9jay5vIHR0bV9tZW1vcnkubwogCiB2
bXdnZngtJChDT05GSUdfVFJBTlNQQVJFTlRfSFVHRVBBR0UpICs9IHZtd2dmeF90aHAubwogb2Jq
LSQoQ09ORklHX0RSTV9WTVdHRlgpIDo9IHZtd2dmeC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdHRtL3R0bV9tZW1vcnkuYyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9y
eS5jCnNpbWlsYXJpdHkgaW5kZXggOTclCnJlbmFtZSBmcm9tIGRyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX21lbW9yeS5jCnJlbmFtZSB0byBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0bV9tZW1vcnku
YwppbmRleCAzZDI0NzlkMGNlMmMuLmJmZWMxZTg0NTM0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3R0bS90dG1fbWVtb3J5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1f
bWVtb3J5LmMKQEAgLTI4LDcgKzI4LDYgQEAKIAogI2RlZmluZSBwcl9mbXQoZm10KSAiW1RUTV0g
IiBmbXQKIAotI2luY2x1ZGUgPGRybS90dG0vdHRtX21lbW9yeS5oPgogI2luY2x1ZGUgPGxpbnV4
L3NwaW5sb2NrLmg+CiAjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KICNpbmNsdWRlIDxsaW51eC93
YWl0Lmg+CkBAIC0zNiwxMCArMzUsMTEgQEAKICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNp
bmNsdWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvc3dhcC5oPgotI2luY2x1ZGUg
PGRybS90dG0vdHRtX3Bvb2wuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV90dC5oPgogCi0jaW5j
bHVkZSAidHRtX21vZHVsZS5oIgorI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9maWxlLmg+CisKKyNpbmNsdWRlICJ0dG1fbWVtb3J5LmgiCiAKICNkZWZpbmUg
VFRNX01FTU9SWV9BTExPQ19SRVRSSUVTIDQKIApAQCAtNDE0LDcgKzQxNCw3IEBAIHN0YXRpYyBp
bnQgdHRtX21lbV9pbml0X2RtYTMyX3pvbmUoc3RydWN0IHR0bV9tZW1fZ2xvYmFsICpnbG9iLAog
fQogI2VuZGlmCiAKLWludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVjdCB0dG1fbWVtX2dsb2Jh
bCAqZ2xvYikKK2ludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAq
Z2xvYiwgc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKIAlzdHJ1Y3Qgc3lzaW5mbyBzaTsKIAlp
bnQgcmV0OwpAQCAtNDI1LDcgKzQyNSw4IEBAIGludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVj
dCB0dG1fbWVtX2dsb2JhbCAqZ2xvYikKIAlnbG9iLT5zd2FwX3F1ZXVlID0gY3JlYXRlX3Npbmds
ZXRocmVhZF93b3JrcXVldWUoInR0bV9zd2FwIik7CiAJSU5JVF9XT1JLKCZnbG9iLT53b3JrLCB0
dG1fc2hyaW5rX3dvcmspOwogCXJldCA9IGtvYmplY3RfaW5pdF9hbmRfYWRkKAotCQkmZ2xvYi0+
a29iaiwgJnR0bV9tZW1fZ2xvYl9rb2JqX3R5cGUsIHR0bV9nZXRfa29iaigpLCAibWVtb3J5X2Fj
Y291bnRpbmciKTsKKwkJJmdsb2ItPmtvYmosICZ0dG1fbWVtX2dsb2Jfa29ial90eXBlLCAmZGV2
LT5wcmltYXJ5LT5rZGV2LT5rb2JqLAorCQkibWVtb3J5X2FjY291bnRpbmciKTsKIAlpZiAodW5s
aWtlbHkocmV0ICE9IDApKSB7CiAJCWtvYmplY3RfcHV0KCZnbG9iLT5rb2JqKTsKIAkJcmV0dXJu
IHJldDsKQEAgLTQ1Myw4ICs0NTQsNiBAQCBpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3Qg
dHRtX21lbV9nbG9iYWwgKmdsb2IpCiAJCXByX2luZm8oIlpvbmUgJTdzOiBBdmFpbGFibGUgZ3Jh
cGhpY3MgbWVtb3J5OiAlbGx1IEtpQlxuIiwKIAkJCXpvbmUtPm5hbWUsICh1bnNpZ25lZCBsb25n
IGxvbmcpem9uZS0+bWF4X21lbSA+PiAxMCk7CiAJfQotCXR0bV9wb29sX21ncl9pbml0KGdsb2It
PnpvbmVfa2VybmVsLT5tYXhfbWVtLygyKlBBR0VfU0laRSkpOwotCXR0bV90dF9tZ3JfaW5pdCgp
OwogCXJldHVybiAwOwogb3V0X25vX3pvbmU6CiAJdHRtX21lbV9nbG9iYWxfcmVsZWFzZShnbG9i
KTsKQEAgLTQ2NiwxMCArNDY1LDYgQEAgdm9pZCB0dG1fbWVtX2dsb2JhbF9yZWxlYXNlKHN0cnVj
dCB0dG1fbWVtX2dsb2JhbCAqZ2xvYikKIAlzdHJ1Y3QgdHRtX21lbV96b25lICp6b25lOwogCXVu
c2lnbmVkIGludCBpOwogCi0JLyogbGV0IHRoZSBwYWdlIGFsbG9jYXRvciBmaXJzdCBzdG9wIHRo
ZSBzaHJpbmsgd29yay4gKi8KLQl0dG1fcG9vbF9tZ3JfZmluaSgpOwotCXR0bV90dF9tZ3JfZmlu
aSgpOwotCiAJZmx1c2hfd29ya3F1ZXVlKGdsb2ItPnN3YXBfcXVldWUpOwogCWRlc3Ryb3lfd29y
a3F1ZXVlKGdsb2ItPnN3YXBfcXVldWUpOwogCWdsb2ItPnN3YXBfcXVldWUgPSBOVUxMOwpkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9tZW1vcnkuaCBiL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdHRtX21lbW9yeS5oCnNpbWlsYXJpdHkgaW5kZXggOTclCnJlbmFtZSBmcm9tIGluY2x1
ZGUvZHJtL3R0bS90dG1fbWVtb3J5LmgKcmVuYW1lIHRvIGRyaXZlcnMvZ3B1L2RybS92bXdnZngv
dHRtX21lbW9yeS5oCmluZGV4IGMxZjE2Nzg4MWUzMy4uODUwZWU2Yzg2N2RhIDEwMDY0NAotLS0g
YS9pbmNsdWRlL2RybS90dG0vdHRtX21lbW9yeS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdn
ZngvdHRtX21lbW9yeS5oCkBAIC0zNSw3ICszNSw4IEBACiAjaW5jbHVkZSA8bGludXgvZXJybm8u
aD4KICNpbmNsdWRlIDxsaW51eC9rb2JqZWN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbW0uaD4KLSNp
bmNsdWRlICJ0dG1fYm9fYXBpLmgiCisKKyNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4K
IAogLyoqCiAgKiBzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgLSBHbG9iYWwgbWVtb3J5IGFjY291bnRp
bmcgc3RydWN0dXJlLgpAQCAtNzksNyArODAsNyBAQCBleHRlcm4gc3RydWN0IHR0bV9tZW1fZ2xv
YmFsIHsKICNlbmRpZgogfSB0dG1fbWVtX2dsb2I7CiAKLWludCB0dG1fbWVtX2dsb2JhbF9pbml0
KHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYik7CitpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChz
dHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IsIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogdm9p
ZCB0dG1fbWVtX2dsb2JhbF9yZWxlYXNlKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYik7CiBp
bnQgdHRtX21lbV9nbG9iYWxfYWxsb2Moc3RydWN0IHR0bV9tZW1fZ2xvYmFsICpnbG9iLCB1aW50
NjRfdCBtZW1vcnksCiAJCQkgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3R0bV9vYmplY3QuaAppbmRleCBlZGUyNmRmODdjOTMuLjQ5YjA2NGYwY2IxOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmgKQEAgLTQzLDcgKzQzLDggQEAKICNpbmNs
dWRlIDxsaW51eC9yY3VwZGF0ZS5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9oYXNodGFiLmg+Ci0j
aW5jbHVkZSA8ZHJtL3R0bS90dG1fbWVtb3J5Lmg+CisKKyNpbmNsdWRlICJ0dG1fbWVtb3J5Lmgi
CiAKIC8qKgogICogZW51bSB0dG1fcmVmX3R5cGUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS92bXdnZngvdm13Z2Z4X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5j
CmluZGV4IDYzZGJjNDRlZWJlMC4uZjdhYmUyOTkyMTc4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13
Z2Z4X2JvLmMKQEAgLTUwOCwxMSArNTA4LDE2IEBAIGludCB2bXdfYm9fY3JlYXRlX2tlcm5lbChz
dHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBsb25nIHNpemUsCiAJYWNjX3Np
emUgPSB0dG1fcm91bmRfcG90KHNpemVvZigqYm8pKTsKIAlhY2Nfc2l6ZSArPSB0dG1fcm91bmRf
cG90KG5wYWdlcyAqIHNpemVvZih2b2lkICopKTsKIAlhY2Nfc2l6ZSArPSB0dG1fcm91bmRfcG90
KHNpemVvZihzdHJ1Y3QgdHRtX3R0KSk7CisKKwlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvYygm
dHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSwgJmN0eCk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCWdv
dG8gZXJyb3JfZnJlZTsKKwogCXJldCA9IHR0bV9ib19pbml0X3Jlc2VydmVkKCZkZXZfcHJpdi0+
YmRldiwgYm8sIHNpemUsCiAJCQkJICAgdHRtX2JvX3R5cGVfZGV2aWNlLCBwbGFjZW1lbnQsIDAs
Ci0JCQkJICAgJmN0eCwgYWNjX3NpemUsIE5VTEwsIE5VTEwsIE5VTEwpOworCQkJCSAgICZjdHgs
IE5VTEwsIE5VTEwsIE5VTEwpOwogCWlmICh1bmxpa2VseShyZXQpKQotCQlnb3RvIGVycm9yX2Zy
ZWU7CisJCWdvdG8gZXJyb3JfYWNjb3VudDsKIAogCXR0bV9ib19waW4oYm8pOwogCXR0bV9ib191
bnJlc2VydmUoYm8pOwpAQCAtNTIwLDYgKzUyNSw5IEBAIGludCB2bXdfYm9fY3JlYXRlX2tlcm5l
bChzdHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBsb25nIHNpemUsCiAKIAly
ZXR1cm4gMDsKIAorZXJyb3JfYWNjb3VudDoKKwl0dG1fbWVtX2dsb2JhbF9mcmVlKCZ0dG1fbWVt
X2dsb2IsIGFjY19zaXplKTsKKwogZXJyb3JfZnJlZToKIAlrZnJlZShibyk7CiAJcmV0dXJuIHJl
dDsKQEAgLTU1OSwxMSArNTY3LDE3IEBAIGludCB2bXdfYm9faW5pdChzdHJ1Y3Qgdm13X3ByaXZh
dGUgKmRldl9wcml2LAogCXZtd19iby0+YmFzZS5wcmlvcml0eSA9IDM7CiAJdm13X2JvLT5yZXNf
dHJlZSA9IFJCX1JPT1Q7CiAKKwlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvYygmdHRtX21lbV9n
bG9iLCBhY2Nfc2l6ZSwgJmN0eCk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCXJldHVybiByZXQ7
CisKIAlyZXQgPSB0dG1fYm9faW5pdF9yZXNlcnZlZChiZGV2LCAmdm13X2JvLT5iYXNlLCBzaXpl
LAogCQkJCSAgIHR0bV9ib190eXBlX2RldmljZSwgcGxhY2VtZW50LAotCQkJCSAgIDAsICZjdHgs
IGFjY19zaXplLCBOVUxMLCBOVUxMLCBib19mcmVlKTsKLQlpZiAodW5saWtlbHkocmV0KSkKKwkJ
CQkgICAwLCAmY3R4LCBOVUxMLCBOVUxMLCBib19mcmVlKTsKKwlpZiAodW5saWtlbHkocmV0KSkg
eworCQl0dG1fbWVtX2dsb2JhbF9mcmVlKCZ0dG1fbWVtX2dsb2IsIGFjY19zaXplKTsKIAkJcmV0
dXJuIHJldDsKKwl9CiAKIAlpZiAocGluKQogCQl0dG1fYm9fcGluKCZ2bXdfYm8tPmJhc2UpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuYwppbmRleCBlMTQxZmE5ZjYxNmQuLmNhNjZlYWEy
ZTM3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmMKQEAgLTEyNzIsNiArMTI3Miw3
IEBAIHN0YXRpYyB2b2lkIHZtd19yZW1vdmUoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiB7CiAJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKIAorCXR0bV9tZW1f
Z2xvYmFsX3JlbGVhc2UoJnR0bV9tZW1fZ2xvYik7CiAJZHJtX2Rldl91bnJlZ2lzdGVyKGRldik7
CiAJdm13X2RyaXZlcl91bmxvYWQoZGV2KTsKIAlkcm1fZGV2X3B1dChkZXYpOwpAQCAtMTUxOSw2
ICsxNTIwLDEwIEBAIHN0YXRpYyBpbnQgdm13X3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBj
b25zdCBzdHJ1Y3QgcGNpX2RldmljZV9pZCAqZW50KQogCQlnb3RvIGVycl9wY2lfZGlzYWJsZV9k
ZXZpY2U7CiAJfQogCisJcmV0ID0gdHRtX21lbV9nbG9iYWxfaW5pdCgmdHRtX21lbV9nbG9iLCBk
ZXYpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKIAlkZXYtPnBkZXYgPSBwZGV2OwogCXBj
aV9zZXRfZHJ2ZGF0YShwZGV2LCBkZXYpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dm
eF90dG1fYnVmZmVyLmMKaW5kZXggMWM3NWY3MzUzOGMwLi5lZmI1NjdkYTc0OWQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMKQEAgLTU3NSwxMSArNTc1LDMx
IEBAIHN0YXRpYyB2b2lkIHZtd190dG1fZGVzdHJveShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRl
diwgc3RydWN0IHR0bV90dCAqdHRtKQogc3RhdGljIGludCB2bXdfdHRtX3BvcHVsYXRlKHN0cnVj
dCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCQkJICAgIHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0
IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpCiB7CisJdW5zaWduZWQgaW50IGk7CisJaW50IHJldDsK
KwogCS8qIFRPRE86IG1heWJlIGNvbXBsZXRlbHkgZHJvcCB0aGlzID8gKi8KIAlpZiAodHRtX3R0
X2lzX3BvcHVsYXRlZCh0dG0pKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiB0dG1fcG9vbF9hbGxv
YygmYmRldi0+cG9vbCwgdHRtLCBjdHgpOworCXJldCA9IHR0bV9wb29sX2FsbG9jKCZiZGV2LT5w
b29sLCB0dG0sIGN0eCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWZvciAoaSA9IDA7
IGkgPCB0dG0tPm51bV9wYWdlczsgKytpKSB7CisJCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9j
X3BhZ2UoJnR0bV9tZW1fZ2xvYiwgdHRtLT5wYWdlc1tpXSwKKwkJCQkJCVBBR0VfU0laRSwgY3R4
KTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gZXJyb3I7CisJfQorCXJldHVybiAwOworCitlcnJvcjoK
Kwl3aGlsZSAoaS0tKQorCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1fZ2xvYiwg
dHRtLT5wYWdlc1tpXSwKKwkJCQkJIFBBR0VfU0laRSk7CisJdHRtX3Bvb2xfZnJlZSgmYmRldi0+
cG9vbCwgdHRtKTsKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCB2bXdfdHRtX3VucG9w
dWxhdGUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCkBAIC01ODcsNiArNjA3LDcgQEAgc3Rh
dGljIHZvaWQgdm13X3R0bV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAog
ewogCXN0cnVjdCB2bXdfdHRtX3R0ICp2bXdfdHQgPSBjb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qg
dm13X3R0bV90dCwKIAkJCQkJCSBkbWFfdHRtKTsKKwl1bnNpZ25lZCBpbnQgaTsKIAogCWlmICh2
bXdfdHQtPm1vYikgewogCQl2bXdfbW9iX2Rlc3Ryb3kodm13X3R0LT5tb2IpOwpAQCAtNTk0LDYg
KzYxNSwxMSBAQCBzdGF0aWMgdm9pZCB2bXdfdHRtX3VucG9wdWxhdGUoc3RydWN0IHR0bV9ib19k
ZXZpY2UgKmJkZXYsCiAJfQogCiAJdm13X3R0bV91bm1hcF9kbWEodm13X3R0KTsKKworCWZvciAo
aSA9IDA7IGkgPCB0dG0tPm51bV9wYWdlczsgKytpKQorCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3Bh
Z2UoJnR0bV9tZW1fZ2xvYiwgdHRtLT5wYWdlc1tpXSwKKwkJCQkJIFBBR0VfU0laRSk7CisKIAl0
dG1fcG9vbF9mcmVlKCZiZGV2LT5wb29sLCB0dG0pOwogfQogCmRpZmYgLS1naXQgYS9pbmNsdWRl
L2RybS90dG0vdHRtX2JvX2FwaS5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAppbmRl
eCA3Yzc1MzlkNzZlMWQuLjMwMjU0ZDg2OWRiNiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRt
L3R0bV9ib19hcGkuaAorKysgYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCkBAIC04OCw3
ICs4OCw2IEBAIHN0cnVjdCB0dG1fdHQ7CiAgKiBAdHlwZTogVGhlIGJvIHR5cGUuCiAgKiBAZGVz
dHJveTogRGVzdHJ1Y3Rpb24gZnVuY3Rpb24uIElmIE5VTEwsIGtmcmVlIGlzIHVzZWQuCiAgKiBA
bnVtX3BhZ2VzOiBBY3R1YWwgbnVtYmVyIG9mIHBhZ2VzLgotICogQGFjY19zaXplOiBBY2NvdW50
ZWQgc2l6ZSBmb3IgdGhpcyBvYmplY3QuCiAgKiBAa3JlZjogUmVmZXJlbmNlIGNvdW50IG9mIHRo
aXMgYnVmZmVyIG9iamVjdC4gV2hlbiB0aGlzIHJlZmNvdW50IHJlYWNoZXMKICAqIHplcm8sIHRo
ZSBvYmplY3QgaXMgZGVzdHJveWVkIG9yIHB1dCBvbiB0aGUgZGVsYXllZCBkZWxldGUgbGlzdC4K
ICAqIEBtZW06IHN0cnVjdHVyZSBkZXNjcmliaW5nIGN1cnJlbnQgcGxhY2VtZW50LgpAQCAtMTI1
LDcgKzEyNCw2IEBAIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCB7CiAJc3RydWN0IHR0bV9ib19k
ZXZpY2UgKmJkZXY7CiAJZW51bSB0dG1fYm9fdHlwZSB0eXBlOwogCXZvaWQgKCpkZXN0cm95KSAo
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopOwotCXNpemVfdCBhY2Nfc2l6ZTsKIAogCS8qKgog
CSogTWVtYmVycyBub3QgbmVlZGluZyBwcm90ZWN0aW9uLgpAQCAtMzU3LDEwICszNTUsNiBAQCB2
b2lkIHR0bV9ib191bmxvY2tfZGVsYXllZF93b3JrcXVldWUoc3RydWN0IHR0bV9ib19kZXZpY2Ug
KmJkZXYsIGludCByZXNjaGVkKTsKIGJvb2wgdHRtX2JvX2V2aWN0aW9uX3ZhbHVhYmxlKHN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgdHRtX3BsYWNl
ICpwbGFjZSk7CiAKLXNpemVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1fYm9fZGV2
aWNlICpiZGV2LAotCQkJICAgdW5zaWduZWQgbG9uZyBib19zaXplLAotCQkJICAgdW5zaWduZWQg
c3RydWN0X3NpemUpOwotCiAvKioKICAqIHR0bV9ib19pbml0X3Jlc2VydmVkCiAgKgpAQCAtMzcx
LDcgKzM2NSw2IEBAIHNpemVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1fYm9fZGV2
aWNlICpiZGV2LAogICogQGZsYWdzOiBJbml0aWFsIHBsYWNlbWVudCBmbGFncy4KICAqIEBwYWdl
X2FsaWdubWVudDogRGF0YSBhbGlnbm1lbnQgaW4gcGFnZXMuCiAgKiBAY3R4OiBUVE0gb3BlcmF0
aW9uIGNvbnRleHQgZm9yIG1lbW9yeSBhbGxvY2F0aW9uLgotICogQGFjY19zaXplOiBBY2NvdW50
ZWQgc2l6ZSBmb3IgdGhpcyBvYmplY3QuCiAgKiBAcmVzdjogUG9pbnRlciB0byBhIGRtYV9yZXN2
LCBvciBOVUxMIHRvIGxldCB0dG0gYWxsb2NhdGUgb25lLgogICogQGRlc3Ryb3k6IERlc3Ryb3kg
ZnVuY3Rpb24uIFVzZSBOVUxMIGZvciBrZnJlZSgpLgogICoKQEAgLTQwMiw4ICszOTUsNyBAQCBp
bnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJCQkg
c3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCwKIAkJCSB1aW50MzJfdCBwYWdlX2FsaWdu
bWVudCwKIAkJCSBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwKLQkJCSBzaXplX3QgYWNj
X3NpemUsIHN0cnVjdCBzZ190YWJsZSAqc2csCi0JCQkgc3RydWN0IGRtYV9yZXN2ICpyZXN2LAor
CQkJIHN0cnVjdCBzZ190YWJsZSAqc2csIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKIAkJCSB2b2lk
ICgqZGVzdHJveSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSk7CiAKIC8qKgpAQCAtNDIx
LDcgKzQxMyw2IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiwKICAqIGhvbGRzIGEgcG9pbnRlciB0byBhIHBlcnNpc3RlbnQgc2htZW0gb2JqZWN0
LiBUeXBpY2FsbHksIHRoaXMgd291bGQKICAqIHBvaW50IHRvIHRoZSBzaG1lbSBvYmplY3QgYmFj
a2luZyBhIEdFTSBvYmplY3QgaWYgVFRNIGlzIHVzZWQgdG8gYmFjayBhCiAgKiBHRU0gdXNlciBp
bnRlcmZhY2UuCi0gKiBAYWNjX3NpemU6IEFjY291bnRlZCBzaXplIGZvciB0aGlzIG9iamVjdC4K
ICAqIEByZXN2OiBQb2ludGVyIHRvIGEgZG1hX3Jlc3YsIG9yIE5VTEwgdG8gbGV0IHR0bSBhbGxv
Y2F0ZSBvbmUuCiAgKiBAZGVzdHJveTogRGVzdHJveSBmdW5jdGlvbi4gVXNlIE5VTEwgZm9yIGtm
cmVlKCkuCiAgKgpAQCAtNDQ2LDcgKzQzNyw3IEBAIGludCB0dG1fYm9faW5pdF9yZXNlcnZlZChz
dHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIGludCB0dG1fYm9faW5pdChzdHJ1Y3QgdHRtX2Jv
X2RldmljZSAqYmRldiwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJc2l6ZV90IHNp
emUsIGVudW0gdHRtX2JvX3R5cGUgdHlwZSwKIAkJc3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNl
bWVudCwKLQkJdWludDMyX3QgcGFnZV9hbGlnbm1lbnQsIGJvb2wgaW50ZXJydWJ0aWJsZSwgc2l6
ZV90IGFjY19zaXplLAorCQl1aW50MzJfdCBwYWdlX2FsaWdubWVudCwgYm9vbCBpbnRlcnJ1YnRp
YmxlLAogCQlzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YsCiAJCXZv
aWQgKCpkZXN0cm95KSAoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICopKTsKIApkaWZmIC0tZ2l0
IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCBiL2luY2x1ZGUvZHJtL3R0bS90dG1f
Ym9fZHJpdmVyLmgKaW5kZXggNDIzMzQ4NDE0YzU5Li41NDc4NTc2OTc3NzYgMTAwNjQ0Ci0tLSBh
L2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0
bV9ib19kcml2ZXIuaApAQCAtMzgsNyArMzgsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2RtYS1yZXN2
Lmg+CiAKICNpbmNsdWRlICJ0dG1fYm9fYXBpLmgiCi0jaW5jbHVkZSAidHRtX21lbW9yeS5oIgog
I2luY2x1ZGUgInR0bV9wbGFjZW1lbnQuaCIKICNpbmNsdWRlICJ0dG1fdHQuaCIKICNpbmNsdWRl
ICJ0dG1fcG9vbC5oIgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oIGIvaW5j
bHVkZS9kcm0vdHRtL3R0bV90dC5oCmluZGV4IDRiYzNhMDg2NDRmYy4uNDk5MzM4NjgwNjYwIDEw
MDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKKysrIGIvaW5jbHVkZS9kcm0vdHRt
L3R0bV90dC5oCkBAIC0zMCw2ICszMCw3IEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KICNp
bmNsdWRlIDxkcm0vdHRtL3R0bV9jYWNoaW5nLmg+CiAKK3N0cnVjdCB0dG1fYm9fZGV2aWNlOwog
c3RydWN0IHR0bV90dDsKIHN0cnVjdCB0dG1fcmVzb3VyY2U7CiBzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3Q7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbAo=
