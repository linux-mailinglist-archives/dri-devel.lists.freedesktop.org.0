Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D4991E4B7
	for <lists+dri-devel@lfdr.de>; Wed, 15 May 2019 00:19:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 769CD89341;
	Tue, 14 May 2019 22:19:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-vk1-xa4a.google.com (mail-vk1-xa4a.google.com
 [IPv6:2607:f8b0:4864:20::a4a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C5A0589341
 for <dri-devel@lists.freedesktop.org>; Tue, 14 May 2019 22:19:21 +0000 (UTC)
Received: by mail-vk1-xa4a.google.com with SMTP id k78so292377vkk.17
 for <dri-devel@lists.freedesktop.org>; Tue, 14 May 2019 15:19:21 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=AF/X8kcACMWJnbuDnmgRNv7b9D+v3mQnlvpAU165Bwk=;
 b=XhUzUrAu9YDKfj0HvQ9dS1CgKkrTchjhKWju9aPzOlDQHwxu/2CubXslAMo0zWJbas
 xoGln/X6IkEH8lmXA8pdc6vZaNywHfhGLoRFQ+emL6UATLYyIwshd9EQEfcWrt6nGLfx
 l0oiEFgn5PKLterFNeJtTTbzaUwnxxvqBq4c8XmGEuA+Av3SJVSLR8OM3iWduDi/kpAL
 MwpejcT1Rf+A3WjI0xvFVt79Nu83Y37nwFD2C6K1Kws/U8uQMmFRISlxwTY/ze9gnuQt
 vTZfRKp2V0NZhZbBn8ulNOqOvFlzA+ze8BYlQlUrr9Gj3J+XbQ9iDLtVoRHSz3KJa2q1
 Ecbw==
X-Gm-Message-State: APjAAAW08icaI8Y3MK6s0b8h0O0gZnGsqiSBSAuaejVazMMxU0VY0005
 PhLzXfhyKx6YEA+VVylxMXw1Z/Yj77c2xgvefzesww==
X-Google-Smtp-Source: APXvYqwzDzsNPOfRnQOJWWw03pWCA5Fjhb1qGAZ4OtAQmohRvasBoIqNe/10w5aP2fIkCU3ca5rLrh+9ahCG9LjIfitkeg==
X-Received: by 2002:a67:c508:: with SMTP id e8mr3376906vsk.18.1557872360849;
 Tue, 14 May 2019 15:19:20 -0700 (PDT)
Date: Tue, 14 May 2019 15:17:05 -0700
In-Reply-To: <20190514221711.248228-1-brendanhiggins@google.com>
Message-Id: <20190514221711.248228-13-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190514221711.248228-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.21.0.1020.gf2820cf01a-goog
Subject: [PATCH v4 12/18] kunit: test: add tests for KUnit managed resources
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, jpoimboe@redhat.com, 
 keescook@google.com, kieran.bingham@ideasonboard.com, mcgrof@kernel.org, 
 peterz@infradead.org, robh@kernel.org, sboyd@kernel.org, shuah@kernel.org, 
 tytso@mit.edu, yamada.masahiro@socionext.com
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=AF/X8kcACMWJnbuDnmgRNv7b9D+v3mQnlvpAU165Bwk=;
 b=r21t6aRT31vNmpHaVPznC01sm7g+B5zt/jTVYWwmuo0cnbatwvGtXsLMEJPXX6zEoP
 FG3OW9ubxqr6YCydWl32PTlnIP7SYUwByExlaXM73wCCQ3+2tkORRsltrNpqpbXQAKQg
 ku0N9dvnOgGjgRfcIXdfuvX2dM54j/nmqegoGcJfCjZDaf+BMlJLXI3iiPCpya8XU7JY
 LFx44FuKPcAW8WiTPQ77zyWJaQZ0s7aW4VktCc8mNlE+0W32KYe3nQSnwjK1QUMtqM++
 KyJhT61S+DwD9fzuSDjvEkFIs3xDUSokTOYs4rKLJCr+FihvewVZ18EwM5Kjq9T6C4GP
 S+fw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com,
 Avinash Kondareddy <akndr41@gmail.com>, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, kunit-dev@googlegroups.com,
 richard@nod.at, rdunlap@infradead.org, linux-kernel@vger.kernel.org,
 mpe@ellerman.id.au, linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQXZpbmFzaCBLb25kYXJlZGR5IDxha25kcjQxQGdtYWlsLmNvbT4KCkFkZCB1bml0IHRl
c3RzIGZvciBLVW5pdCBtYW5hZ2VkIHJlc291cmNlcy4gS1VuaXQgbWFuYWdlZCByZXNvdXJjZXMK
KHN0cnVjdCBrdW5pdF9yZXNvdXJjZSkgYXJlIHJlc291cmNlcyB0aGF0IGFyZSBhdXRvbWF0aWNh
bGx5IGNsZWFuZWQgdXAKYXQgdGhlIGVuZCBvZiBhIEtVbml0IHRlc3QsIHNpbWlsYXIgdG8gdGhl
IGNvbmNlcHQgb2YgZGV2bV8qIG1hbmFnZWQKcmVzb3VyY2VzLgoKU2lnbmVkLW9mZi1ieTogQXZp
bmFzaCBLb25kYXJlZGR5IDxha25kcjQxQGdtYWlsLmNvbT4KU2lnbmVkLW9mZi1ieTogQnJlbmRh
biBIaWdnaW5zIDxicmVuZGFuaGlnZ2luc0Bnb29nbGUuY29tPgpSZXZpZXdlZC1ieTogR3JlZyBL
cm9haC1IYXJ0bWFuIDxncmVna2hAbGludXhmb3VuZGF0aW9uLm9yZz4KUmV2aWV3ZWQtYnk6IExv
Z2FuIEd1bnRob3JwZSA8bG9nYW5nQGRlbHRhdGVlLmNvbT4KLS0tCiBrdW5pdC90ZXN0LXRlc3Qu
YyB8IDEyMyArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAx
IGZpbGUgY2hhbmdlZCwgMTIzIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9rdW5pdC90ZXN0
LXRlc3QuYyBiL2t1bml0L3Rlc3QtdGVzdC5jCmluZGV4IDdhZmM5YmI1MmY3YmUuLmVlOTI2Zjc5
OGIyNjYgMTAwNjQ0Ci0tLSBhL2t1bml0L3Rlc3QtdGVzdC5jCisrKyBiL2t1bml0L3Rlc3QtdGVz
dC5jCkBAIC0xMDEsMyArMTAxLDEyNiBAQCBzdGF0aWMgc3RydWN0IGt1bml0X21vZHVsZSBrdW5p
dF90cnlfY2F0Y2hfdGVzdF9tb2R1bGUgPSB7CiAJLnRlc3RfY2FzZXMgPSBrdW5pdF90cnlfY2F0
Y2hfdGVzdF9jYXNlcywKIH07CiBtb2R1bGVfdGVzdChrdW5pdF90cnlfY2F0Y2hfdGVzdF9tb2R1
bGUpOworCisvKgorICogQ29udGV4dCBmb3IgdGVzdGluZyB0ZXN0IG1hbmFnZWQgcmVzb3VyY2Vz
CisgKiBpc19yZXNvdXJjZV9pbml0aWFsaXplZCBpcyB1c2VkIHRvIHRlc3QgYXJiaXRyYXJ5IHJl
c291cmNlcworICovCitzdHJ1Y3Qga3VuaXRfdGVzdF9yZXNvdXJjZV9jb250ZXh0IHsKKwlzdHJ1
Y3Qga3VuaXQgdGVzdDsKKwlib29sIGlzX3Jlc291cmNlX2luaXRpYWxpemVkOworfTsKKworc3Rh
dGljIGludCBmYWtlX3Jlc291cmNlX2luaXQoc3RydWN0IGt1bml0X3Jlc291cmNlICpyZXMsIHZv
aWQgKmNvbnRleHQpCit7CisJc3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAqY3R4
ID0gY29udGV4dDsKKworCXJlcy0+YWxsb2NhdGlvbiA9ICZjdHgtPmlzX3Jlc291cmNlX2luaXRp
YWxpemVkOworCWN0eC0+aXNfcmVzb3VyY2VfaW5pdGlhbGl6ZWQgPSB0cnVlOworCXJldHVybiAw
OworfQorCitzdGF0aWMgdm9pZCBmYWtlX3Jlc291cmNlX2ZyZWUoc3RydWN0IGt1bml0X3Jlc291
cmNlICpyZXMpCit7CisJYm9vbCAqaXNfcmVzb3VyY2VfaW5pdGlhbGl6ZWQgPSByZXMtPmFsbG9j
YXRpb247CisKKwkqaXNfcmVzb3VyY2VfaW5pdGlhbGl6ZWQgPSBmYWxzZTsKK30KKworc3RhdGlj
IHZvaWQga3VuaXRfcmVzb3VyY2VfdGVzdF9pbml0X3Jlc291cmNlcyhzdHJ1Y3Qga3VuaXQgKnRl
c3QpCit7CisJc3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAqY3R4ID0gdGVzdC0+
cHJpdjsKKworCWt1bml0X2luaXRfdGVzdCgmY3R4LT50ZXN0LCAidGVzdGluZ190ZXN0X2luaXRf
dGVzdCIpOworCisJS1VOSVRfRVhQRUNUX1RSVUUodGVzdCwgbGlzdF9lbXB0eSgmY3R4LT50ZXN0
LnJlc291cmNlcykpOworfQorCitzdGF0aWMgdm9pZCBrdW5pdF9yZXNvdXJjZV90ZXN0X2FsbG9j
X3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVzdCkKK3sKKwlzdHJ1Y3Qga3VuaXRfdGVzdF9yZXNv
dXJjZV9jb250ZXh0ICpjdHggPSB0ZXN0LT5wcml2OworCXN0cnVjdCBrdW5pdF9yZXNvdXJjZSAq
cmVzOworCWt1bml0X3Jlc291cmNlX2ZyZWVfdCBmcmVlID0gZmFrZV9yZXNvdXJjZV9mcmVlOwor
CisJcmVzID0ga3VuaXRfYWxsb2NfcmVzb3VyY2UoJmN0eC0+dGVzdCwKKwkJCQkgICBmYWtlX3Jl
c291cmNlX2luaXQsCisJCQkJICAgZmFrZV9yZXNvdXJjZV9mcmVlLAorCQkJCSAgIGN0eCk7CisK
KwlLVU5JVF9BU1NFUlRfTk9UX0VSUl9PUl9OVUxMKHRlc3QsIHJlcyk7CisJS1VOSVRfRVhQRUNU
X1BUUl9FUSh0ZXN0LAorCQkJICAgICZjdHgtPmlzX3Jlc291cmNlX2luaXRpYWxpemVkLCByZXMt
PmFsbG9jYXRpb24pOworCUtVTklUX0VYUEVDVF9UUlVFKHRlc3QsIGxpc3RfaXNfbGFzdCgmcmVz
LT5ub2RlLCAmY3R4LT50ZXN0LnJlc291cmNlcykpOworCUtVTklUX0VYUEVDVF9QVFJfRVEodGVz
dCwgZnJlZSwgcmVzLT5mcmVlKTsKK30KKworc3RhdGljIHZvaWQga3VuaXRfcmVzb3VyY2VfdGVz
dF9mcmVlX3Jlc291cmNlKHN0cnVjdCBrdW5pdCAqdGVzdCkKK3sKKwlzdHJ1Y3Qga3VuaXRfdGVz
dF9yZXNvdXJjZV9jb250ZXh0ICpjdHggPSB0ZXN0LT5wcml2OworCXN0cnVjdCBrdW5pdF9yZXNv
dXJjZSAqcmVzID0ga3VuaXRfYWxsb2NfcmVzb3VyY2UoJmN0eC0+dGVzdCwKKwkJCQkJCQkgIGZh
a2VfcmVzb3VyY2VfaW5pdCwKKwkJCQkJCQkgIGZha2VfcmVzb3VyY2VfZnJlZSwKKwkJCQkJCQkg
IGN0eCk7CisKKwlrdW5pdF9mcmVlX3Jlc291cmNlKCZjdHgtPnRlc3QsIHJlcyk7CisKKwlLVU5J
VF9FWFBFQ1RfRVEodGVzdCwgZmFsc2UsIGN0eC0+aXNfcmVzb3VyY2VfaW5pdGlhbGl6ZWQpOwor
CUtVTklUX0VYUEVDVF9UUlVFKHRlc3QsIGxpc3RfZW1wdHkoJmN0eC0+dGVzdC5yZXNvdXJjZXMp
KTsKK30KKworc3RhdGljIHZvaWQga3VuaXRfcmVzb3VyY2VfdGVzdF9jbGVhbnVwX3Jlc291cmNl
cyhzdHJ1Y3Qga3VuaXQgKnRlc3QpCit7CisJaW50IGk7CisJc3RydWN0IGt1bml0X3Rlc3RfcmVz
b3VyY2VfY29udGV4dCAqY3R4ID0gdGVzdC0+cHJpdjsKKwlzdHJ1Y3Qga3VuaXRfcmVzb3VyY2Ug
KnJlc291cmNlc1s1XTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHJlc291cmNlcyk7
IGkrKykgeworCQlyZXNvdXJjZXNbaV0gPSBrdW5pdF9hbGxvY19yZXNvdXJjZSgmY3R4LT50ZXN0
LAorCQkJCQkJICAgIGZha2VfcmVzb3VyY2VfaW5pdCwKKwkJCQkJCSAgICBmYWtlX3Jlc291cmNl
X2ZyZWUsCisJCQkJCQkgICAgY3R4KTsKKwl9CisKKwlrdW5pdF9jbGVhbnVwKCZjdHgtPnRlc3Qp
OworCisJS1VOSVRfRVhQRUNUX1RSVUUodGVzdCwgbGlzdF9lbXB0eSgmY3R4LT50ZXN0LnJlc291
cmNlcykpOworfQorCitzdGF0aWMgaW50IGt1bml0X3Jlc291cmNlX3Rlc3RfaW5pdChzdHJ1Y3Qg
a3VuaXQgKnRlc3QpCit7CisJc3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAqY3R4
ID0KKwkJCWt6YWxsb2Moc2l6ZW9mKCpjdHgpLCBHRlBfS0VSTkVMKTsKKworCWlmICghY3R4KQor
CQlyZXR1cm4gLUVOT01FTTsKKworCXRlc3QtPnByaXYgPSBjdHg7CisKKwlrdW5pdF9pbml0X3Rl
c3QoJmN0eC0+dGVzdCwgInRlc3RfdGVzdF9jb250ZXh0Iik7CisKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIHZvaWQga3VuaXRfcmVzb3VyY2VfdGVzdF9leGl0KHN0cnVjdCBrdW5pdCAqdGVzdCkK
K3sKKwlzdHJ1Y3Qga3VuaXRfdGVzdF9yZXNvdXJjZV9jb250ZXh0ICpjdHggPSB0ZXN0LT5wcml2
OworCisJa3VuaXRfY2xlYW51cCgmY3R4LT50ZXN0KTsKKwlrZnJlZShjdHgpOworfQorCitzdGF0
aWMgc3RydWN0IGt1bml0X2Nhc2Uga3VuaXRfcmVzb3VyY2VfdGVzdF9jYXNlc1tdID0geworCUtV
TklUX0NBU0Uoa3VuaXRfcmVzb3VyY2VfdGVzdF9pbml0X3Jlc291cmNlcyksCisJS1VOSVRfQ0FT
RShrdW5pdF9yZXNvdXJjZV90ZXN0X2FsbG9jX3Jlc291cmNlKSwKKwlLVU5JVF9DQVNFKGt1bml0
X3Jlc291cmNlX3Rlc3RfZnJlZV9yZXNvdXJjZSksCisJS1VOSVRfQ0FTRShrdW5pdF9yZXNvdXJj
ZV90ZXN0X2NsZWFudXBfcmVzb3VyY2VzKSwKKwl7fSwKK307CisKK3N0YXRpYyBzdHJ1Y3Qga3Vu
aXRfbW9kdWxlIGt1bml0X3Jlc291cmNlX3Rlc3RfbW9kdWxlID0geworCS5uYW1lID0gImt1bml0
LXJlc291cmNlLXRlc3QiLAorCS5pbml0ID0ga3VuaXRfcmVzb3VyY2VfdGVzdF9pbml0LAorCS5l
eGl0ID0ga3VuaXRfcmVzb3VyY2VfdGVzdF9leGl0LAorCS50ZXN0X2Nhc2VzID0ga3VuaXRfcmVz
b3VyY2VfdGVzdF9jYXNlcywKK307Cittb2R1bGVfdGVzdChrdW5pdF9yZXNvdXJjZV90ZXN0X21v
ZHVsZSk7Ci0tIAoyLjIxLjAuMTAyMC5nZjI4MjBjZjAxYS1nb29nCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
