Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BF0039CC22
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 11:05:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C17C289A94;
	Mon, 26 Aug 2019 09:04:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 831138982E
 for <dri-devel@lists.freedesktop.org>; Mon, 26 Aug 2019 09:04:55 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Aug 2019 02:04:55 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,431,1559545200"; d="scan'208";a="204510208"
Received: from jbroders-mobl1.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.252.38.38])
 by fmsmga004.fm.intel.com with ESMTP; 26 Aug 2019 02:04:53 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/3] drm/syncobj: protect timeline syncobjs
Date: Mon, 26 Aug 2019 12:04:46 +0300
Message-Id: <20190826090448.12819-2-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826090448.12819-1-lionel.g.landwerlin@intel.com>
References: <20190826090448.12819-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Christian.Koenig@amd.com, jason@jlekstrand.net
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QmluYXJ5L2xlZ2FjeSBzaWduYWwgb3BlcmF0aW9ucyBvbiBhIHN5bmNvYmogd29yayBieSByZXBs
YWNpbmcgdGhlCmRtYV9mZW5jZSBoZWxkIHdpdGhpbiB0aGUgc3luY29iai4gV2hlIGRlYWxpbmcg
d2l0aCB0aW1lbGluZQpzZW1hcGhvcmVzIHdlIHdvdWxkIGxpa2UgdG8gYXZvaWQgdGhpcyBhcyB0
aGlzIHdvdWxkIGVmZmVjdGl2ZWxseSBsZWFkCnRvIGxvb3NlciBzeW5jaHJvbml6YXRpb24gKGJ5
IGRpc2NhcmRpbmcgdGhlIGRtYV9mZW5jZV9jaGFpbiBtZWNoYW5pc20Kd2FpdGluZyBvbiBhbGwg
cHJldmlvdXMgZG1hX2ZlbmNlIHRvIHNpZ25hbCBiZWZvcmUgc2lnbmFsIGl0c2VsZikuCgpUaGlz
IGNoYW5nZSBhZGRzIGEgZmxhZ3MgdGhhdCBjYW4gYmUgdXNlZCBhdCBjcmVhdGlvbiBvZiB0aGUg
c3luY29iagp0byBtZWFuIHRoYXQgdGhlIHN5bmNvYmogd2lsbCBob2xkIGEgdGltZWxpbmUgb2Yg
ZG1hX2ZlbmNlICh1c2luZwpkbWFfZmVuY2VfY2hhaW4pLiBXaGVuIGZsYWdnZWQgYXMgc3VjaCwg
dGhlIGRtYV9mZW5jZSBoZWxkIGJ5IHRoZQpzeW5jb2JqIHNob3VsZCBub3QgYmUgcmVwbGFjZWQg
YnV0IGluc3RlYWQgd2Ugc2hvdWxkIGFsd2F5cyBhZGRpbmcgdG8KdGhlIHRpbWVsaW5lLgoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fc3luY29iai5jIHwgMzAgKysrKysrKysrKysr
KysrKysrKysrKysrKysrKystCiBpbmNsdWRlL2RybS9kcm1fc3luY29iai5oICAgICB8ICA4ICsr
KysrKysrCiBpbmNsdWRlL3VhcGkvZHJtL2RybS5oICAgICAgICB8ICAxICsKIDMgZmlsZXMgY2hh
bmdlZCwgMzggaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9kcm1fc3luY29iai5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9zeW5jb2JqLmMK
aW5kZXggNzJkMDgzYWNkMzg4Li42OWQ0M2M3OTFhNDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9kcm1fc3luY29iai5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fc3luY29iai5jCkBA
IC00NzYsNiArNDc2LDggQEAgaW50IGRybV9zeW5jb2JqX2NyZWF0ZShzdHJ1Y3QgZHJtX3N5bmNv
YmogKipvdXRfc3luY29iaiwgdWludDMyX3QgZmxhZ3MsCiAKIAlpZiAoZmxhZ3MgJiBEUk1fU1lO
Q09CSl9DUkVBVEVfU0lHTkFMRUQpCiAJCWRybV9zeW5jb2JqX2Fzc2lnbl9udWxsX2hhbmRsZShz
eW5jb2JqKTsKKwlpZiAoZmxhZ3MgJiBEUk1fU1lOQ09CSl9DUkVBVEVfVElNRUxJTkUpCisJCXN5
bmNvYmotPmlzX3RpbWVsaW5lID0gdHJ1ZTsKIAogCWlmIChmZW5jZSkKIAkJZHJtX3N5bmNvYmpf
cmVwbGFjZV9mZW5jZShzeW5jb2JqLCBmZW5jZSk7CkBAIC02NjEsNiArNjYzLDEwIEBAIHN0YXRp
YyBpbnQgZHJtX3N5bmNvYmpfaW1wb3J0X3N5bmNfZmlsZV9mZW5jZShzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGVfcHJpdmF0ZSwKIAkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCXJldHVybiAtRU5PRU5U
OwogCX0KKwlpZiAoc3luY29iai0+aXNfdGltZWxpbmUpIHsKKwkJZG1hX2ZlbmNlX3B1dChmZW5j
ZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KIAogCWRybV9zeW5jb2JqX3JlcGxhY2VfZmVuY2Uo
c3luY29iaiwgZmVuY2UpOwogCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwpAQCAtNzQ5LDcgKzc1NSwx
MyBAQCBkcm1fc3luY29ial9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJcmV0dXJuIC1FT1BOT1RTVVBQOwogCiAJLyogbm8gdmFsaWQgZmxhZ3MgeWV0
ICovCi0JaWYgKGFyZ3MtPmZsYWdzICYgfkRSTV9TWU5DT0JKX0NSRUFURV9TSUdOQUxFRCkKKwlp
ZiAoYXJncy0+ZmxhZ3MgJiB+KERSTV9TWU5DT0JKX0NSRUFURV9TSUdOQUxFRCB8CisJCQkgICAg
RFJNX1NZTkNPQkpfQ1JFQVRFX1RJTUVMSU5FKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwkvKiBD
cmVhdGluZyBhIHNpZ25hbGVkIHRpbWVsaW5lIG1ha2VzIG5vIHNlbnNlLiAqLworCWlmICgoYXJn
cy0+ZmxhZ3MgJiBEUk1fU1lOQ09CSl9DUkVBVEVfU0lHTkFMRUQpICYmCisJICAgIChhcmdzLT5m
bGFncyAmIERSTV9TWU5DT0JKX0NSRUFURV9USU1FTElORSkpCiAJCXJldHVybiAtRUlOVkFMOwog
CiAJcmV0dXJuIGRybV9zeW5jb2JqX2NyZWF0ZV9hc19oYW5kbGUoZmlsZV9wcml2YXRlLApAQCAt
ODYyLDYgKzg3NCwxMCBAQCBkcm1fc3luY29ial90cmFuc2Zlcl90b19iaW5hcnkoc3RydWN0IGRy
bV9maWxlICpmaWxlX3ByaXZhdGUsCiAJYmluYXJ5X3N5bmNvYmogPSBkcm1fc3luY29ial9maW5k
KGZpbGVfcHJpdmF0ZSwgYXJncy0+ZHN0X2hhbmRsZSk7CiAJaWYgKCFiaW5hcnlfc3luY29iaikK
IAkJcmV0dXJuIC1FTk9FTlQ7CisJaWYgKGJpbmFyeV9zeW5jb2JqLT5pc190aW1lbGluZSkgewor
CQlyZXQgPSAtRUlOVkFMOworCQlnb3RvIGVycjsKKwl9CiAJcmV0ID0gZHJtX3N5bmNvYmpfZmlu
ZF9mZW5jZShmaWxlX3ByaXZhdGUsIGFyZ3MtPnNyY19oYW5kbGUsCiAJCQkJICAgICBhcmdzLT5z
cmNfcG9pbnQsIGFyZ3MtPmZsYWdzLCAmZmVuY2UpOwogCWlmIChyZXQpCkBAIC0xMTM3LDYgKzEx
NTMsNyBAQCBzdGF0aWMgaW50IGRybV9zeW5jb2JqX2FycmF5X3dhaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIHN0YXRpYyBpbnQgZHJtX3N5bmNvYmpfYXJyYXlfZmluZChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdmF0ZSwKIAkJCQkgIHZvaWQgX191c2VyICp1c2VyX2hhbmRsZXMsCiAJCQkJ
ICB1aW50MzJfdCBjb3VudF9oYW5kbGVzLAorCQkJCSAgYm9vbCBub190aW1lbGluZSwKIAkJCQkg
IHN0cnVjdCBkcm1fc3luY29iaiAqKipzeW5jb2Jqc19vdXQpCiB7CiAJdWludDMyX3QgaSwgKmhh
bmRsZXM7CkBAIC0xMTY1LDYgKzExODIsMTAgQEAgc3RhdGljIGludCBkcm1fc3luY29ial9hcnJh
eV9maW5kKHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2YXRlLAogCQkJcmV0ID0gLUVOT0VOVDsK
IAkJCWdvdG8gZXJyX3B1dF9zeW5jb2JqczsKIAkJfQorCQlpZiAobm9fdGltZWxpbmUgJiYgc3lu
Y29ianNbaV0tPmlzX3RpbWVsaW5lKSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byBlcnJf
cHV0X3N5bmNvYmpzOworCQl9CiAJfQogCiAJa2ZyZWUoaGFuZGxlcyk7CkBAIC0xMjExLDYgKzEy
MzIsNyBAQCBkcm1fc3luY29ial93YWl0X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJcmV0ID0gZHJtX3N5bmNvYmpfYXJyYXlfZmluZChmaWxlX3ByaXZhdGUsCiAJ
CQkJICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+aGFuZGxlcyksCiAJCQkJICAgICBhcmdzLT5j
b3VudF9oYW5kbGVzLAorCQkJCSAgICAgZmFsc2UsCiAJCQkJICAgICAmc3luY29ianMpOwogCWlm
IChyZXQgPCAwKQogCQlyZXR1cm4gcmV0OwpAQCAtMTI0NSw2ICsxMjY3LDcgQEAgZHJtX3N5bmNv
YmpfdGltZWxpbmVfd2FpdF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCXJldCA9IGRybV9zeW5jb2JqX2FycmF5X2ZpbmQoZmlsZV9wcml2YXRlLAogCQkJCSAgICAg
dTY0X3RvX3VzZXJfcHRyKGFyZ3MtPmhhbmRsZXMpLAogCQkJCSAgICAgYXJncy0+Y291bnRfaGFu
ZGxlcywKKwkJCQkgICAgIGZhbHNlLAogCQkJCSAgICAgJnN5bmNvYmpzKTsKIAlpZiAocmV0IDwg
MCkKIAkJcmV0dXJuIHJldDsKQEAgLTEyNzksNiArMTMwMiw3IEBAIGRybV9zeW5jb2JqX3Jlc2V0
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJcmV0ID0gZHJtX3N5
bmNvYmpfYXJyYXlfZmluZChmaWxlX3ByaXZhdGUsCiAJCQkJICAgICB1NjRfdG9fdXNlcl9wdHIo
YXJncy0+aGFuZGxlcyksCiAJCQkJICAgICBhcmdzLT5jb3VudF9oYW5kbGVzLAorCQkJCSAgICAg
ZmFsc2UsCiAJCQkJICAgICAmc3luY29ianMpOwogCWlmIChyZXQgPCAwKQogCQlyZXR1cm4gcmV0
OwpAQCAtMTMxNCw2ICsxMzM4LDcgQEAgZHJtX3N5bmNvYmpfc2lnbmFsX2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJcmV0ID0gZHJtX3N5bmNvYmpfYXJyYXlfZmlu
ZChmaWxlX3ByaXZhdGUsCiAJCQkJICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+aGFuZGxlcyks
CiAJCQkJICAgICBhcmdzLT5jb3VudF9oYW5kbGVzLAorCQkJCSAgICAgdHJ1ZSwKIAkJCQkgICAg
ICZzeW5jb2Jqcyk7CiAJaWYgKHJldCA8IDApCiAJCXJldHVybiByZXQ7CkBAIC0xMzQ5LDYgKzEz
NzQsNyBAQCBkcm1fc3luY29ial90aW1lbGluZV9zaWduYWxfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKIAlyZXQgPSBkcm1fc3luY29ial9hcnJheV9maW5kKGZpbGVf
cHJpdmF0ZSwKIAkJCQkgICAgIHU2NF90b191c2VyX3B0cihhcmdzLT5oYW5kbGVzKSwKIAkJCQkg
ICAgIGFyZ3MtPmNvdW50X2hhbmRsZXMsCisJCQkJICAgICBmYWxzZSwKIAkJCQkgICAgICZzeW5j
b2Jqcyk7CiAJaWYgKHJldCA8IDApCiAJCXJldHVybiByZXQ7CkBAIC0xNDIwLDYgKzE0NDYsNyBA
QCBpbnQgZHJtX3N5bmNvYmpfcXVlcnlfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAlyZXQgPSBkcm1fc3luY29ial9hcnJheV9maW5kKGZpbGVfcHJpdmF0ZSwKIAkJ
CQkgICAgIHU2NF90b191c2VyX3B0cihhcmdzLT5oYW5kbGVzKSwKIAkJCQkgICAgIGFyZ3MtPmNv
dW50X2hhbmRsZXMsCisJCQkJICAgICBmYWxzZSwKIAkJCQkgICAgICZzeW5jb2Jqcyk7CiAJaWYg
KHJldCA8IDApCiAJCXJldHVybiByZXQ7CkBAIC0xNDg0LDYgKzE1MTEsNyBAQCBpbnQgZHJtX3N5
bmNvYmpfYmluYXJ5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJ
cmV0ID0gZHJtX3N5bmNvYmpfYXJyYXlfZmluZChmaWxlX3ByaXZhdGUsCiAJCQkJICAgICB1NjRf
dG9fdXNlcl9wdHIoYXJncy0+aGFuZGxlcyksCiAJCQkJICAgICBhcmdzLT5jb3VudF9oYW5kbGVz
LAorCQkJCSAgICAgZmFsc2UsCiAJCQkJICAgICAmc3luY29ianMpOwogCWlmIChyZXQgPCAwKQog
CQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX3N5bmNvYmouaCBiL2lu
Y2x1ZGUvZHJtL2RybV9zeW5jb2JqLmgKaW5kZXggYWE3NmNiM2Y5MTA3Li5mOTZhOTVmYmUwMjUg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9zeW5jb2JqLmgKKysrIGIvaW5jbHVkZS9kcm0v
ZHJtX3N5bmNvYmouaApAQCAtNzAsNiArNzAsMTQgQEAgc3RydWN0IGRybV9zeW5jb2JqIHsKIAkg
KiBzZXFubyB3aWxsIGJlIHB1dCBpbnRvIHRoZSBzeW5jb2JqLgogCSAqLwogCWF0b21pYzY0X3Qg
YmluYXJ5X3BheWxvYWQ7CisJLyoqCisJICogQGlzX3RpbWVsaW5lOiBXaGV0aGVyIHRoZSBzeW5j
b2JqIGhvbGRzIGEgdGltZWxpbmUuCisJICoKKwkgKiBIb2xkaW5nIGEgdGltZWxpbmUgYWRkcyBz
b21lIHJlc3RyaWN0aW9uIHRvIHByZXZlbnQgdXNlcnNwYWNlIGZyb20KKwkgKiBhY2NpZGVudGFs
bHkgImxvc2luZyIgdGhlIHRpbWVsaW5lLiBUaGlzIGNvdWxkIGhhcHBlbiBmb3IgZXhhbXBsZQor
CSAqIGJ5IHJlcGxhY2luZyAmZmVuY2UuCisJICovCisJYm9vbCBpc190aW1lbGluZTsKIH07CiAK
IHZvaWQgZHJtX3N5bmNvYmpfZnJlZShzdHJ1Y3Qga3JlZiAqa3JlZik7CmRpZmYgLS1naXQgYS9p
bmNsdWRlL3VhcGkvZHJtL2RybS5oIGIvaW5jbHVkZS91YXBpL2RybS9kcm0uaAppbmRleCA3OGEw
YTQxM2I3ODguLmIzYzQ2YjI5OTNiZSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2RybS9kcm0u
aAorKysgYi9pbmNsdWRlL3VhcGkvZHJtL2RybS5oCkBAIC03MTksNiArNzE5LDcgQEAgc3RydWN0
IGRybV9wcmltZV9oYW5kbGUgewogc3RydWN0IGRybV9zeW5jb2JqX2NyZWF0ZSB7CiAJX191MzIg
aGFuZGxlOwogI2RlZmluZSBEUk1fU1lOQ09CSl9DUkVBVEVfU0lHTkFMRUQgKDEgPDwgMCkKKyNk
ZWZpbmUgRFJNX1NZTkNPQkpfQ1JFQVRFX1RJTUVMSU5FICgxIDw8IDEpCiAJX191MzIgZmxhZ3M7
CiB9OwogCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
