Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8608860314
	for <lists+dri-devel@lfdr.de>; Fri,  5 Jul 2019 11:26:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6A9BE6E45E;
	Fri,  5 Jul 2019 09:26:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 89B046E029
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 09:26:19 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 22018AF2D;
 Fri,  5 Jul 2019 09:26:18 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, noralf@tronnes.org, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v2 4/6] drm/ast: Replace struct ast_fbdev with generic
 framebuffer emulation
Date: Fri,  5 Jul 2019 11:26:11 +0200
Message-Id: <20190705092613.7621-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190705092613.7621-1-tzimmermann@suse.de>
References: <20190705092613.7621-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCByZXBsYWNlcyBhc3QncyBmcmFtZWJ1ZmZlciBjb25zb2xlIHdpdGggRFJNJ3Mg
Z2VuZXJpYwppbXBsZW1lbXRhdGlvbi4gQWxsIHJlc3BlY3RpdmUgY29kZSBpcyBiZWluZyByZW1v
dmVkIGZyb20gdGhlIGRyaXZlci4KClRoZSBjb25zb2xlIGlzIHNldCB1cCB3aXRoIGEgc2hhZG93
IGJ1ZmZlci4gVGhlIGFjdHVhbCBidWZmZXIgb2JqZWN0IGlzCm5vdCBwZXJtYW5lbnRseSBwaW5u
ZWQgaW4gdmlkZW8gcmFtLCBidXQganVzdCBhbm90aGVyIGJ1ZmZlciBvYmplY3QgdGhhdAp0aGUg
ZHJpdmVyIG1vdmVzIGluIGFuZCBvdXQgb2YgdnJhbSBhcyBuZWNlc3NhcnkuIFRoZSBkcml2ZXIn
cyBmdW5jdGlvbgphc3RfY3J0Y19kb19zZXRfYmFzZSgpIHVzZWQgdG8gY29udGFpbiBzcGVjaWFs
IGhhbmRsaW5nIGZvciB0aGUgZnJhbWVidWZmZXIKY29uc29sZS4gV2l0aCB0aGUgbmV3IGdlbmVy
aWMgZnJhbWVidWZmZXIsIHRoZSBkcml2ZXIgZG9lcyBub3QgbmVlZCB0aGlzCmNvZGUgYW4gbG9u
Z2VyLgoKdjI6CgkqIHVzZSBkcm1fZmJfaGVscGVyX3NldF9zdXNwZW5kX3VubG9ja2VkKCkgaW4g
YXN0X2RybV97dGhhdyxmcmVlemV9KCkKCSogZGlydHkgZnVuY3Rpb24gbm8gbG9uZ2VyIHJlcXVp
cmVkCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5k
ZT4KQWNrZWQtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9hc3QvTWFrZWZpbGUgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2Fz
dC9hc3RfZHJ2LmMgIHwgIDEzICstCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaCAgfCAg
MTcgLS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2ZiLmMgICB8IDM0MSAtLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21haW4uYyB8ICAg
MyArLQogZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jIHwgIDIxIC0tCiA2IGZpbGVzIGNo
YW5nZWQsIDUgaW5zZXJ0aW9ucygrKSwgMzkyIGRlbGV0aW9ucygtKQogZGVsZXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2ZiLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vYXN0L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9NYWtlZmlsZQppbmRleCBi
MDg2ZGFlMTcwMTMuLjU2MWY3YzQxOTllNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Fz
dC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L01ha2VmaWxlCkBAIC0zLDYgKzMs
NiBAQAogIyBNYWtlZmlsZSBmb3IgdGhlIGRybSBkZXZpY2UgZHJpdmVyLiAgVGhpcyBkcml2ZXIg
cHJvdmlkZXMgc3VwcG9ydCBmb3IgdGhlCiAjIERpcmVjdCBSZW5kZXJpbmcgSW5mcmFzdHJ1Y3R1
cmUgKERSSSkgaW4gWEZyZWU4NiA0LjEuMCBhbmQgaGlnaGVyLgogCi1hc3QteSA6PSBhc3RfZHJ2
Lm8gYXN0X21haW4ubyBhc3RfbW9kZS5vIGFzdF9mYi5vIGFzdF90dG0ubyBhc3RfcG9zdC5vIGFz
dF9kcDUwMS5vCithc3QteSA6PSBhc3RfZHJ2Lm8gYXN0X21haW4ubyBhc3RfbW9kZS5vIGFzdF90
dG0ubyBhc3RfcG9zdC5vIGFzdF9kcDUwMS5vCiAKIG9iai0kKENPTkZJR19EUk1fQVNUKSA6PSBh
c3QubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vYXN0L2FzdF9kcnYuYwppbmRleCAzODExOTk3ZTc4YzQuLjJjOTc3ZDBhYzhmZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZHJ2LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FzdC9hc3RfZHJ2LmMKQEAgLTEwMCwyOCArMTAwLDIxIEBAIGFzdF9wY2lfcmVtb3Zl
KHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogc3RhdGljIGludCBhc3RfZHJtX2ZyZWV6ZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KQogewogCWRybV9rbXNfaGVscGVyX3BvbGxfZGlzYWJsZShkZXYpOwot
CiAJcGNpX3NhdmVfc3RhdGUoZGV2LT5wZGV2KTsKKwlkcm1fZmJfaGVscGVyX3NldF9zdXNwZW5k
X3VubG9ja2VkKGRldi0+ZmJfaGVscGVyLCB0cnVlKTsKIAotCWNvbnNvbGVfbG9jaygpOwotCWFz
dF9mYmRldl9zZXRfc3VzcGVuZChkZXYsIDEpOwotCWNvbnNvbGVfdW5sb2NrKCk7CiAJcmV0dXJu
IDA7CiB9CiAKIHN0YXRpYyBpbnQgYXN0X2RybV90aGF3KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYp
CiB7Ci0JaW50IGVycm9yID0gMDsKLQogCWFzdF9wb3N0X2dwdShkZXYpOwogCiAJZHJtX21vZGVf
Y29uZmlnX3Jlc2V0KGRldik7CiAJZHJtX2hlbHBlcl9yZXN1bWVfZm9yY2VfbW9kZShkZXYpOwor
CWRybV9mYl9oZWxwZXJfc2V0X3N1c3BlbmRfdW5sb2NrZWQoZGV2LT5mYl9oZWxwZXIsIGZhbHNl
KTsKIAotCWNvbnNvbGVfbG9jaygpOwotCWFzdF9mYmRldl9zZXRfc3VzcGVuZChkZXYsIDApOwot
CWNvbnNvbGVfdW5sb2NrKCk7Ci0JcmV0dXJuIGVycm9yOworCXJldHVybiAwOwogfQogCiBzdGF0
aWMgaW50IGFzdF9kcm1fcmVzdW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0
X2Rydi5oCmluZGV4IGNhNzk0YTNmY2Y4Zi4uOTA3ZDc0ODBiN2JhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9k
cnYuaApAQCAtODEsOCArODEsNiBAQCBlbnVtIGFzdF90eF9jaGlwIHsKICNkZWZpbmUgQVNUX0RS
QU1fNEd4MTYgICA3CiAjZGVmaW5lIEFTVF9EUkFNXzhHeDE2ICAgOAogCi1zdHJ1Y3QgYXN0X2Zi
ZGV2OwotCiBzdHJ1Y3QgYXN0X3ByaXZhdGUgewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXY7CiAK
QEAgLTk2LDggKzk0LDYgQEAgc3RydWN0IGFzdF9wcml2YXRlIHsKIAl1aW50MzJfdCBtY2xrOwog
CXVpbnQzMl90IHZyYW1fc2l6ZTsKIAotCXN0cnVjdCBhc3RfZmJkZXYgKmZiZGV2OwotCiAJaW50
IGZiX210cnI7CiAKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmN1cnNvcl9jYWNoZTsKQEAgLTIz
OSwxNCArMjM1LDYgQEAgc3RydWN0IGFzdF9lbmNvZGVyIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIg
YmFzZTsKIH07CiAKLXN0cnVjdCBhc3RfZmJkZXYgewotCXN0cnVjdCBkcm1fZmJfaGVscGVyIGhl
bHBlcjsgLyogbXVzdCBiZSBmaXJzdCAqLwotCXZvaWQgKnN5c3JhbTsKLQlpbnQgc2l6ZTsKLQlp
bnQgeDEsIHkxLCB4MiwgeTI7IC8qIGRpcnR5IHJlY3QgKi8KLQlzcGlubG9ja190IGRpcnR5X2xv
Y2s7Ci19OwotCiAjZGVmaW5lIHRvX2FzdF9jcnRjKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3Qg
YXN0X2NydGMsIGJhc2UpCiAjZGVmaW5lIHRvX2FzdF9jb25uZWN0b3IoeCkgY29udGFpbmVyX29m
KHgsIHN0cnVjdCBhc3RfY29ubmVjdG9yLCBiYXNlKQogI2RlZmluZSB0b19hc3RfZW5jb2Rlcih4
KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGFzdF9lbmNvZGVyLCBiYXNlKQpAQCAtMjg5LDExICsy
NzcsNiBAQCBzdHJ1Y3QgYXN0X3ZiaW9zX21vZGVfaW5mbyB7CiBleHRlcm4gaW50IGFzdF9tb2Rl
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiBleHRlcm4gdm9pZCBhc3RfbW9kZV9maW5p
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogCi1pbnQgYXN0X2ZiZGV2X2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldik7Ci12b2lkIGFzdF9mYmRldl9maW5pKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpOwotdm9pZCBhc3RfZmJkZXZfc2V0X3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
aW50IHN0YXRlKTsKLXZvaWQgYXN0X2ZiZGV2X3NldF9iYXNlKHN0cnVjdCBhc3RfcHJpdmF0ZSAq
YXN0LCB1bnNpZ25lZCBsb25nIGdwdV9hZGRyKTsKLQogI2RlZmluZSBBU1RfTU1fQUxJR05fU0hJ
RlQgNAogI2RlZmluZSBBU1RfTU1fQUxJR05fTUFTSyAoKDEgPDwgQVNUX01NX0FMSUdOX1NISUZU
KSAtIDEpCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2ZiLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYXN0L2FzdF9mYi5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBh
ODQ5ZTU4YjQwYmMuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9m
Yi5jCisrKyAvZGV2L251bGwKQEAgLTEsMzQxICswLDAgQEAKLS8qCi0gKiBDb3B5cmlnaHQgMjAx
MiBSZWQgSGF0IEluYy4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVl
IG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICogY29weSBvZiB0aGlzIHNv
ZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQotICogIlNvZnR3
YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1
ZGluZwotICogd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2Rp
ZnksIG1lcmdlLCBwdWJsaXNoLAotICogZGlzdHJpYnV0ZSwgc3ViIGxpY2Vuc2UsIGFuZC9vciBz
ZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bwotICogcGVybWl0IHBlcnNvbnMgdG8g
d2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCi0gKiB0
aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVE
ICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElN
UExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVS
Q0hBTlRBQklMSVRZLAotICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5P
Ti1JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMCi0gKiBUSEUgQ09QWVJJR0hUIEhPTERF
UlMsIEFVVEhPUlMgQU5EL09SIElUUyBTVVBQTElFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0s
Ci0gKiBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0Yg
Q09OVFJBQ1QsIFRPUlQgT1IKLSAqIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1Ig
SU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUKLSAqIFVTRSBPUiBPVEhFUiBE
RUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCi0gKgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3Rp
Y2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUKLSAqIG5leHQgcGFy
YWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBv
cnRpb25zCi0gKiBvZiB0aGUgU29mdHdhcmUuCi0gKgotICovCi0vKgotICogQXV0aG9yczogRGF2
ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KLSAqLwotI2luY2x1ZGUgPGxpbnV4L21vZHVs
ZS5oPgotI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgotI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+
Ci0jaW5jbHVkZSA8bGludXgvc3RyaW5nLmg+Ci0jaW5jbHVkZSA8bGludXgvbW0uaD4KLSNpbmNs
dWRlIDxsaW51eC90dHkuaD4KLSNpbmNsdWRlIDxsaW51eC9zeXNycS5oPgotI2luY2x1ZGUgPGxp
bnV4L2RlbGF5Lmg+Ci0jaW5jbHVkZSA8bGludXgvaW5pdC5oPgotCi0KLSNpbmNsdWRlIDxkcm0v
ZHJtUC5oPgotI2luY2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgotI2luY2x1ZGUgPGRybS9kcm1fY3J0
Y19oZWxwZXIuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgotI2luY2x1ZGUgPGRy
bS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fdXRpbC5o
PgotCi0jaW5jbHVkZSAiYXN0X2Rydi5oIgotCi1zdGF0aWMgdm9pZCBhc3RfZGlydHlfdXBkYXRl
KHN0cnVjdCBhc3RfZmJkZXYgKmFmYmRldiwKLQkJCSAgICAgaW50IHgsIGludCB5LCBpbnQgd2lk
dGgsIGludCBoZWlnaHQpCi17Ci0JaW50IGk7Ci0Jc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3Qg
KmdibzsKLQlpbnQgc3JjX29mZnNldCwgZHN0X29mZnNldDsKLQlpbnQgcmV0OwotCXU4ICpkc3Q7
Ci0JYm9vbCB1bm1hcCA9IGZhbHNlOwotCWJvb2wgc3RvcmVfZm9yX2xhdGVyID0gZmFsc2U7Ci0J
aW50IHgyLCB5MjsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gYWZiZGV2LT5oZWxwZXIuZmI7Ci0JaW50IGJwcCA9IGZiLT5mb3JtYXQtPmNwcFsw
XTsKLQotCWdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9ialswXSk7Ci0KLQlpZiAoZHJt
X2Nhbl9zbGVlcCgpKSB7Ci0JCS8qIFdlIHBpbiB0aGUgQk8gc28gaXQgd29uJ3QgYmUgbW92ZWQg
ZHVyaW5nIHRoZQotCQkgKiB1cGRhdGUuIFRoZSBhY3R1YWwgbG9jYXRpb24sIHZpZGVvIFJBTSBv
ciBzeXN0ZW0KLQkJICogbWVtb3J5LCBpcyBub3QgaW1wb3J0YW50LgotCQkgKi8KLQkJcmV0ID0g
ZHJtX2dlbV92cmFtX3BpbihnYm8sIDApOwotCQlpZiAocmV0KSB7Ci0JCQlpZiAocmV0ICE9IC1F
QlVTWSkKLQkJCQlyZXR1cm47Ci0JCQlzdG9yZV9mb3JfbGF0ZXIgPSB0cnVlOwotCQl9Ci0JfSBl
bHNlIHsKLQkJc3RvcmVfZm9yX2xhdGVyID0gdHJ1ZTsKLQl9Ci0KLQl4MiA9IHggKyB3aWR0aCAt
IDE7Ci0JeTIgPSB5ICsgaGVpZ2h0IC0gMTsKLQlzcGluX2xvY2tfaXJxc2F2ZSgmYWZiZGV2LT5k
aXJ0eV9sb2NrLCBmbGFncyk7Ci0KLQlpZiAoYWZiZGV2LT55MSA8IHkpCi0JCXkgPSBhZmJkZXYt
PnkxOwotCWlmIChhZmJkZXYtPnkyID4geTIpCi0JCXkyID0gYWZiZGV2LT55MjsKLQlpZiAoYWZi
ZGV2LT54MSA8IHgpCi0JCXggPSBhZmJkZXYtPngxOwotCWlmIChhZmJkZXYtPngyID4geDIpCi0J
CXgyID0gYWZiZGV2LT54MjsKLQotCWlmIChzdG9yZV9mb3JfbGF0ZXIpIHsKLQkJYWZiZGV2LT54
MSA9IHg7Ci0JCWFmYmRldi0+eDIgPSB4MjsKLQkJYWZiZGV2LT55MSA9IHk7Ci0JCWFmYmRldi0+
eTIgPSB5MjsKLQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWZiZGV2LT5kaXJ0eV9sb2NrLCBm
bGFncyk7Ci0JCXJldHVybjsKLQl9Ci0KLQlhZmJkZXYtPngxID0gYWZiZGV2LT55MSA9IElOVF9N
QVg7Ci0JYWZiZGV2LT54MiA9IGFmYmRldi0+eTIgPSAwOwotCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJmFmYmRldi0+ZGlydHlfbG9jaywgZmxhZ3MpOwotCi0JZHN0ID0gZHJtX2dlbV92cmFtX2tt
YXAoZ2JvLCBmYWxzZSwgTlVMTCk7Ci0JaWYgKElTX0VSUihkc3QpKSB7Ci0JCURSTV9FUlJPUigi
ZmFpbGVkIHRvIGttYXAgZmIgdXBkYXRlc1xuIik7Ci0JCWdvdG8gb3V0OwotCX0gZWxzZSBpZiAo
IWRzdCkgewotCQlkc3QgPSBkcm1fZ2VtX3ZyYW1fa21hcChnYm8sIHRydWUsIE5VTEwpOwotCQlp
ZiAoSVNfRVJSKGRzdCkpIHsKLQkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGttYXAgZmIgdXBkYXRl
c1xuIik7Ci0JCQlnb3RvIG91dDsKLQkJfQotCQl1bm1hcCA9IHRydWU7Ci0JfQotCi0JZm9yIChp
ID0geTsgaSA8PSB5MjsgaSsrKSB7Ci0JCS8qIGFzc3VtZSBlcXVhbCBzdHJpZGUgZm9yIG5vdyAq
LwotCQlzcmNfb2Zmc2V0ID0gZHN0X29mZnNldCA9IGkgKiBmYi0+cGl0Y2hlc1swXSArICh4ICog
YnBwKTsKLQkJbWVtY3B5X3RvaW8oZHN0ICsgZHN0X29mZnNldCwgYWZiZGV2LT5zeXNyYW0gKyBz
cmNfb2Zmc2V0LAotCQkJICAgICh4MiAtIHggKyAxKSAqIGJwcCk7Ci0JfQotCi0JaWYgKHVubWFw
KQotCQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7Ci0KLW91dDoKLQlkcm1fZ2VtX3ZyYW1fdW5w
aW4oZ2JvKTsKLX0KLQotc3RhdGljIHZvaWQgYXN0X2ZpbGxyZWN0KHN0cnVjdCBmYl9pbmZvICpp
bmZvLAotCQkJIGNvbnN0IHN0cnVjdCBmYl9maWxscmVjdCAqcmVjdCkKLXsKLQlzdHJ1Y3QgYXN0
X2ZiZGV2ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0JZHJtX2ZiX2hlbHBlcl9zeXNfZmlsbHJlY3Qo
aW5mbywgcmVjdCk7Ci0JYXN0X2RpcnR5X3VwZGF0ZShhZmJkZXYsIHJlY3QtPmR4LCByZWN0LT5k
eSwgcmVjdC0+d2lkdGgsCi0JCQkgcmVjdC0+aGVpZ2h0KTsKLX0KLQotc3RhdGljIHZvaWQgYXN0
X2NvcHlhcmVhKHN0cnVjdCBmYl9pbmZvICppbmZvLAotCQkJIGNvbnN0IHN0cnVjdCBmYl9jb3B5
YXJlYSAqYXJlYSkKLXsKLQlzdHJ1Y3QgYXN0X2ZiZGV2ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0J
ZHJtX2ZiX2hlbHBlcl9zeXNfY29weWFyZWEoaW5mbywgYXJlYSk7Ci0JYXN0X2RpcnR5X3VwZGF0
ZShhZmJkZXYsIGFyZWEtPmR4LCBhcmVhLT5keSwgYXJlYS0+d2lkdGgsCi0JCQkgYXJlYS0+aGVp
Z2h0KTsKLX0KLQotc3RhdGljIHZvaWQgYXN0X2ltYWdlYmxpdChzdHJ1Y3QgZmJfaW5mbyAqaW5m
bywKLQkJCSAgY29uc3Qgc3RydWN0IGZiX2ltYWdlICppbWFnZSkKLXsKLQlzdHJ1Y3QgYXN0X2Zi
ZGV2ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0JZHJtX2ZiX2hlbHBlcl9zeXNfaW1hZ2VibGl0KGlu
Zm8sIGltYWdlKTsKLQlhc3RfZGlydHlfdXBkYXRlKGFmYmRldiwgaW1hZ2UtPmR4LCBpbWFnZS0+
ZHksIGltYWdlLT53aWR0aCwKLQkJCSBpbWFnZS0+aGVpZ2h0KTsKLX0KLQotc3RhdGljIHN0cnVj
dCBmYl9vcHMgYXN0ZmJfb3BzID0gewotCS5vd25lciA9IFRISVNfTU9EVUxFLAotCS5mYl9jaGVj
a192YXIgPSBkcm1fZmJfaGVscGVyX2NoZWNrX3ZhciwKLQkuZmJfc2V0X3BhciA9IGRybV9mYl9o
ZWxwZXJfc2V0X3BhciwKLQkuZmJfZmlsbHJlY3QgPSBhc3RfZmlsbHJlY3QsCi0JLmZiX2NvcHlh
cmVhID0gYXN0X2NvcHlhcmVhLAotCS5mYl9pbWFnZWJsaXQgPSBhc3RfaW1hZ2VibGl0LAotCS5m
Yl9wYW5fZGlzcGxheSA9IGRybV9mYl9oZWxwZXJfcGFuX2Rpc3BsYXksCi0JLmZiX2JsYW5rID0g
ZHJtX2ZiX2hlbHBlcl9ibGFuaywKLQkuZmJfc2V0Y21hcCA9IGRybV9mYl9oZWxwZXJfc2V0Y21h
cCwKLX07Ci0KLXN0YXRpYyBpbnQgYXN0ZmJfY3JlYXRlX29iamVjdChzdHJ1Y3QgYXN0X2ZiZGV2
ICphZmJkZXYsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVf
Y21kLAotCQkJICAgICAgIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmdvYmpfcCkKLXsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gYWZiZGV2LT5oZWxwZXIuZGV2OwotCXUzMiBzaXplOwotCXN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqZ29iajsKLQlpbnQgcmV0ID0gMDsKLQotCXNpemUgPSBtb2Rl
X2NtZC0+cGl0Y2hlc1swXSAqIG1vZGVfY21kLT5oZWlnaHQ7Ci0JcmV0ID0gYXN0X2dlbV9jcmVh
dGUoZGV2LCBzaXplLCB0cnVlLCAmZ29iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQot
CSpnb2JqX3AgPSBnb2JqOwotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyBpbnQgYXN0ZmJfY3Jl
YXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCi0JCQlzdHJ1Y3QgZHJtX2ZiX2hlbHBl
cl9zdXJmYWNlX3NpemUgKnNpemVzKQotewotCXN0cnVjdCBhc3RfZmJkZXYgKmFmYmRldiA9Ci0J
CWNvbnRhaW5lcl9vZihoZWxwZXIsIHN0cnVjdCBhc3RfZmJkZXYsIGhlbHBlcik7Ci0Jc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGFmYmRldi0+aGVscGVyLmRldjsKLQlzdHJ1Y3QgZHJtX21vZGVf
ZmJfY21kMiBtb2RlX2NtZDsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKLQlzdHJ1Y3Qg
ZmJfaW5mbyAqaW5mbzsKLQlpbnQgc2l6ZSwgcmV0OwotCXZvaWQgKnN5c3JhbTsKLQlzdHJ1Y3Qg
ZHJtX2dlbV9vYmplY3QgKmdvYmogPSBOVUxMOwotCW1vZGVfY21kLndpZHRoID0gc2l6ZXMtPnN1
cmZhY2Vfd2lkdGg7Ci0JbW9kZV9jbWQuaGVpZ2h0ID0gc2l6ZXMtPnN1cmZhY2VfaGVpZ2h0Owot
CW1vZGVfY21kLnBpdGNoZXNbMF0gPSBtb2RlX2NtZC53aWR0aCAqICgoc2l6ZXMtPnN1cmZhY2Vf
YnBwICsgNykvOCk7Ci0KLQltb2RlX2NtZC5waXhlbF9mb3JtYXQgPSBkcm1fbW9kZV9sZWdhY3lf
ZmJfZm9ybWF0KHNpemVzLT5zdXJmYWNlX2JwcCwKLQkJCQkJCQkgIHNpemVzLT5zdXJmYWNlX2Rl
cHRoKTsKLQotCXNpemUgPSBtb2RlX2NtZC5waXRjaGVzWzBdICogbW9kZV9jbWQuaGVpZ2h0Owot
Ci0JcmV0ID0gYXN0ZmJfY3JlYXRlX29iamVjdChhZmJkZXYsICZtb2RlX2NtZCwgJmdvYmopOwot
CWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gY3JlYXRlIGZiY29uIGJhY2tpbmcg
b2JqZWN0ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCXN5c3JhbSA9IHZtYWxs
b2Moc2l6ZSk7Ci0JaWYgKCFzeXNyYW0pCi0JCXJldHVybiAtRU5PTUVNOwotCi0JaW5mbyA9IGRy
bV9mYl9oZWxwZXJfYWxsb2NfZmJpKGhlbHBlcik7Ci0JaWYgKElTX0VSUihpbmZvKSkgewotCQly
ZXQgPSBQVFJfRVJSKGluZm8pOwotCQlnb3RvIG91dDsKLQl9Ci0JZmIgPSBkcm1fZ2VtX2ZiZGV2
X2ZiX2NyZWF0ZShkZXYsIHNpemVzLCAwLCBnb2JqLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGZiKSkg
ewotCQlyZXQgPSBQVFJfRVJSKGZiKTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JYWZiZGV2LT5zeXNy
YW0gPSBzeXNyYW07Ci0JYWZiZGV2LT5zaXplID0gc2l6ZTsKLQotCWFmYmRldi0+aGVscGVyLmZi
ID0gZmI7Ci0KLQlpbmZvLT5mYm9wcyA9ICZhc3RmYl9vcHM7Ci0KLQlpbmZvLT5hcGVydHVyZXMt
PnJhbmdlc1swXS5iYXNlID0gcGNpX3Jlc291cmNlX3N0YXJ0KGRldi0+cGRldiwgMCk7Ci0JaW5m
by0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHBjaV9yZXNvdXJjZV9sZW4oZGV2LT5wZGV2
LCAwKTsKLQotCWRybV9mYl9oZWxwZXJfZmlsbF9pbmZvKGluZm8sICZhZmJkZXYtPmhlbHBlciwg
c2l6ZXMpOwotCi0JaW5mby0+c2NyZWVuX2Jhc2UgPSBzeXNyYW07Ci0JaW5mby0+c2NyZWVuX3Np
emUgPSBzaXplOwotCi0JaW5mby0+cGl4bWFwLmZsYWdzID0gRkJfUElYTUFQX1NZU1RFTTsKLQot
CURSTV9ERUJVR19LTVMoImFsbG9jYXRlZCAlZHglZFxuIiwKLQkJICAgICAgZmItPndpZHRoLCBm
Yi0+aGVpZ2h0KTsKLQotCXJldHVybiAwOwotCi1vdXQ6Ci0JdmZyZWUoc3lzcmFtKTsKLQlyZXR1
cm4gcmV0OwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mYl9oZWxwZXJfZnVuY3MgYXN0
X2ZiX2hlbHBlcl9mdW5jcyA9IHsKLQkuZmJfcHJvYmUgPSBhc3RmYl9jcmVhdGUsCi19OwotCi1z
dGF0aWMgdm9pZCBhc3RfZmJkZXZfZGVzdHJveShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJ
ICAgICAgc3RydWN0IGFzdF9mYmRldiAqYWZiZGV2KQotewotCWRybV9oZWxwZXJfZm9yY2VfZGlz
YWJsZV9hbGwoZGV2KTsKLQlkcm1fZmJfaGVscGVyX3VucmVnaXN0ZXJfZmJpKCZhZmJkZXYtPmhl
bHBlcik7Ci0KLQlkcm1fZmJfaGVscGVyX2ZpbmkoJmFmYmRldi0+aGVscGVyKTsKLQlkcm1fZnJh
bWVidWZmZXJfcHV0KGFmYmRldi0+aGVscGVyLmZiKTsKLQotCXZmcmVlKGFmYmRldi0+c3lzcmFt
KTsKLX0KLQotaW50IGFzdF9mYmRldl9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi17Ci0J
c3RydWN0IGFzdF9wcml2YXRlICphc3QgPSBkZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBhc3Rf
ZmJkZXYgKmFmYmRldjsKLQlpbnQgcmV0OwotCi0JYWZiZGV2ID0ga3phbGxvYyhzaXplb2Yoc3Ry
dWN0IGFzdF9mYmRldiksIEdGUF9LRVJORUwpOwotCWlmICghYWZiZGV2KQotCQlyZXR1cm4gLUVO
T01FTTsKLQotCWFzdC0+ZmJkZXYgPSBhZmJkZXY7Ci0Jc3Bpbl9sb2NrX2luaXQoJmFmYmRldi0+
ZGlydHlfbG9jayk7Ci0KLQlkcm1fZmJfaGVscGVyX3ByZXBhcmUoZGV2LCAmYWZiZGV2LT5oZWxw
ZXIsICZhc3RfZmJfaGVscGVyX2Z1bmNzKTsKLQotCXJldCA9IGRybV9mYl9oZWxwZXJfaW5pdChk
ZXYsICZhZmJkZXYtPmhlbHBlciwgMSk7Ci0JaWYgKHJldCkKLQkJZ290byBmcmVlOwotCi0JcmV0
ID0gZHJtX2ZiX2hlbHBlcl9zaW5nbGVfYWRkX2FsbF9jb25uZWN0b3JzKCZhZmJkZXYtPmhlbHBl
cik7Ci0JaWYgKHJldCkKLQkJZ290byBmaW5pOwotCi0JLyogZGlzYWJsZSBhbGwgdGhlIHBvc3Np
YmxlIG91dHB1dHMvY3J0Y3MgYmVmb3JlIGVudGVyaW5nIEtNUyBtb2RlICovCi0JZHJtX2hlbHBl
cl9kaXNhYmxlX3VudXNlZF9mdW5jdGlvbnMoZGV2KTsKLQotCXJldCA9IGRybV9mYl9oZWxwZXJf
aW5pdGlhbF9jb25maWcoJmFmYmRldi0+aGVscGVyLCAzMik7Ci0JaWYgKHJldCkKLQkJZ290byBm
aW5pOwotCi0JcmV0dXJuIDA7Ci0KLWZpbmk6Ci0JZHJtX2ZiX2hlbHBlcl9maW5pKCZhZmJkZXYt
PmhlbHBlcik7Ci1mcmVlOgotCWtmcmVlKGFmYmRldik7Ci0JcmV0dXJuIHJldDsKLX0KLQotdm9p
ZCBhc3RfZmJkZXZfZmluaShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQotewotCXN0cnVjdCBhc3Rf
cHJpdmF0ZSAqYXN0ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlmICghYXN0LT5mYmRldikKLQkJ
cmV0dXJuOwotCi0JYXN0X2ZiZGV2X2Rlc3Ryb3koZGV2LCBhc3QtPmZiZGV2KTsKLQlrZnJlZShh
c3QtPmZiZGV2KTsKLQlhc3QtPmZiZGV2ID0gTlVMTDsKLX0KLQotdm9pZCBhc3RfZmJkZXZfc2V0
X3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IHN0YXRlKQotewotCXN0cnVjdCBh
c3RfcHJpdmF0ZSAqYXN0ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlmICghYXN0LT5mYmRldikK
LQkJcmV0dXJuOwotCi0JZHJtX2ZiX2hlbHBlcl9zZXRfc3VzcGVuZCgmYXN0LT5mYmRldi0+aGVs
cGVyLCBzdGF0ZSk7Ci19Ci0KLXZvaWQgYXN0X2ZiZGV2X3NldF9iYXNlKHN0cnVjdCBhc3RfcHJp
dmF0ZSAqYXN0LCB1bnNpZ25lZCBsb25nIGdwdV9hZGRyKQotewotCWFzdC0+ZmJkZXYtPmhlbHBl
ci5mYmRldi0+Zml4LnNtZW1fc3RhcnQgPQotCQlhc3QtPmZiZGV2LT5oZWxwZXIuZmJkZXYtPmFw
ZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgKyBncHVfYWRkcjsKLQlhc3QtPmZiZGV2LT5oZWxwZXIu
ZmJkZXYtPmZpeC5zbWVtX2xlbiA9IGFzdC0+dnJhbV9zaXplIC0gZ3B1X2FkZHI7Ci19CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YXN0L2FzdF9tYWluLmMKaW5kZXggMWJkNjE2OTZlNTA5Li44ZGZmNzY3MjU2MGMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YXN0L2FzdF9tYWluLmMKQEAgLTUwMiw3ICs1MDIsNyBAQCBpbnQgYXN0X2RyaXZlcl9sb2FkKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCiAJaWYgKHJldCkKIAkJ
Z290byBvdXRfZnJlZTsKIAotCXJldCA9IGFzdF9mYmRldl9pbml0KGRldik7CisJcmV0ID0gZHJt
X2ZiZGV2X2dlbmVyaWNfc2V0dXAoZGV2LCAzMik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJl
ZTsKIApAQCAtNTIwLDcgKzUyMCw2IEBAIHZvaWQgYXN0X2RyaXZlcl91bmxvYWQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKIAlhc3RfcmVsZWFzZV9maXJtd2FyZShkZXYpOwogCWtmcmVlKGFzdC0+
ZHA1MDFfZndfYWRkcik7CiAJYXN0X21vZGVfZmluaShkZXYpOwotCWFzdF9mYmRldl9maW5pKGRl
dik7CiAJZHJtX21vZGVfY29uZmlnX2NsZWFudXAoZGV2KTsKIAogCWFzdF9tbV9maW5pKGFzdCk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tb2RlLmMgYi9kcml2ZXJzL2dw
dS9kcm0vYXN0L2FzdF9tb2RlLmMKaW5kZXggYzQ4MjQ5ZGY3NThlLi4zYzA3MTY4OTFiMjkgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vYXN0L2FzdF9tb2RlLmMKQEAgLTUyNSwxOCArNTI1LDEyIEBAIHN0YXRpYyBpbnQgYXN0
X2NydGNfZG9fc2V0X2Jhc2Uoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJCXN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAogCQkJCWludCB4LCBpbnQgeSwgaW50IGF0b21pYykKIHsKLQlzdHJ1
Y3QgYXN0X3ByaXZhdGUgKmFzdCA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGRy
bV9nZW1fdnJhbV9vYmplY3QgKmdibzsKIAlpbnQgcmV0OwogCXM2NCBncHVfYWRkcjsKLQl2b2lk
ICpiYXNlOwogCiAJaWYgKCFhdG9taWMgJiYgZmIpIHsKIAkJZ2JvID0gZHJtX2dlbV92cmFtX29m
X2dlbShmYi0+b2JqWzBdKTsKLQotCQkvKiB1bm1hcCBpZiBjb25zb2xlICovCi0JCWlmIChhc3Qt
PmZiZGV2LT5oZWxwZXIuZmIgPT0gZmIpCi0JCQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7CiAJ
CWRybV9nZW1fdnJhbV91bnBpbihnYm8pOwogCX0KIApAQCAtNTUxLDE3ICs1NDUsNiBAQCBzdGF0
aWMgaW50IGFzdF9jcnRjX2RvX3NldF9iYXNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJZ290
byBlcnJfZHJtX2dlbV92cmFtX3VucGluOwogCX0KIAotCWlmIChhc3QtPmZiZGV2LT5oZWxwZXIu
ZmIgPT0gY3J0Yy0+cHJpbWFyeS0+ZmIpIHsKLQkJLyogaWYgcHVzaGluZyBjb25zb2xlIGluIGtt
YXAgaXQgKi8KLQkJYmFzZSA9IGRybV9nZW1fdnJhbV9rbWFwKGdibywgdHJ1ZSwgTlVMTCk7Ci0J
CWlmIChJU19FUlIoYmFzZSkpIHsKLQkJCXJldCA9IFBUUl9FUlIoYmFzZSk7Ci0JCQlEUk1fRVJS
T1IoImZhaWxlZCB0byBrbWFwIGZiY29uXG4iKTsKLQkJfSBlbHNlIHsKLQkJCWFzdF9mYmRldl9z
ZXRfYmFzZShhc3QsIGdwdV9hZGRyKTsKLQkJfQotCX0KLQogCWFzdF9zZXRfb2Zmc2V0X3JlZyhj
cnRjKTsKIAlhc3Rfc2V0X3N0YXJ0X2FkZHJlc3NfY3J0MShjcnRjLCAodTMyKWdwdV9hZGRyKTsK
IApAQCAtNjE4LDE0ICs2MDEsMTAgQEAgc3RhdGljIHZvaWQgYXN0X2NydGNfZGlzYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMpCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAlhc3RfY3J0Y19kcG1z
KGNydGMsIERSTV9NT0RFX0RQTVNfT0ZGKTsKIAlpZiAoY3J0Yy0+cHJpbWFyeS0+ZmIpIHsKLQkJ
c3RydWN0IGFzdF9wcml2YXRlICphc3QgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwogCQlzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IGNydGMtPnByaW1hcnktPmZiOwogCQlzdHJ1Y3QgZHJt
X2dlbV92cmFtX29iamVjdCAqZ2JvID0KIAkJCWRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9ialsw
XSk7CiAKLQkJLyogdW5tYXAgaWYgY29uc29sZSAqLwotCQlpZiAoYXN0LT5mYmRldi0+aGVscGVy
LmZiID09IGZiKQotCQkJZHJtX2dlbV92cmFtX2t1bm1hcChnYm8pOwogCQlkcm1fZ2VtX3ZyYW1f
dW5waW4oZ2JvKTsKIAl9CiAJY3J0Yy0+cHJpbWFyeS0+ZmIgPSBOVUxMOwotLSAKMi4yMS4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
