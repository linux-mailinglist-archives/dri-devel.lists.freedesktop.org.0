Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CEA4B5DFD9
	for <lists+dri-devel@lfdr.de>; Wed,  3 Jul 2019 10:33:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0BF076E0F6;
	Wed,  3 Jul 2019 08:33:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 791F96E0F9
 for <dri-devel@lists.freedesktop.org>; Wed,  3 Jul 2019 08:33:12 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 10B21AF8D;
 Wed,  3 Jul 2019 08:33:10 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, noralf@tronnes.org, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH 5/5] drm/mgag200: Replace struct mga_fbdev with generic
 framebuffer emulation
Date: Wed,  3 Jul 2019 10:33:02 +0200
Message-Id: <20190703083302.2609-6-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190703083302.2609-1-tzimmermann@suse.de>
References: <20190703083302.2609-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCByZXBsYWNlcyBtZ2FnMjAwJ3MgZnJhbWVidWZmZXIgY29uc29sZSB3aXRoIERS
TSdzIGdlbmVyaWMKaW1wbGVtZW10YXRpb24uIEFsbCByZXNwZWN0aXZlIGNvZGUgaXMgYmVpbmcg
cmVtb3ZlZCBmcm9tIHRoZSBkcml2ZXIuCgpUaGUgY29uc29sZSBpcyBzZXQgdXAgd2l0aCBhIHNo
YWRvdyBidWZmZXIuIFRoZSBhY3R1YWwgYnVmZmVyIG9iamVjdCBpcwpub3QgcGVybWFuZW50bHkg
cGlubmVkIGluIHZpZGVvIHJhbSwgYnV0IGp1c3QgYW5vdGhlciBidWZmZXIgb2JqZWN0IHRoYXQK
dGhlIGRyaXZlciBtb3ZlcyBpbiBhbmQgb3V0IG9mIHZyYW0gYXMgbmVjZXNzYXJ5LiBUaGUgZHJp
dmVyJ3MgZnVuY3Rpb24KbWdhX2NydGNfZG9fc2V0X2Jhc2UoKSB1c2VkIHRvIGNvbnRhaW4gc3Bl
Y2lhbCBoYW5kbGluZyBmb3IgdGhlIGZyYW1lYnVmZmVyCmNvbnNvbGUuIFdpdGggdGhlIG5ldyBn
ZW5lcmljIGZyYW1lYnVmZmVyLCB0aGUgZHJpdmVyIGRvZXMgbm90IG5lZWQgdGhpcwpjb2RlIGFu
IGxvbmdlci4KClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBz
dXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL01ha2VmaWxlICAgICAgIHwgICAy
ICstCiBkcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oICB8ICAxOSAtLQogZHJp
dmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9mYi5jICAgfCAzMDkgLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tYWluLmMgfCAgNjEg
KystLS0KIGRyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfbW9kZS5jIHwgIDI3IC0tLQog
NSBmaWxlcyBjaGFuZ2VkLCAzNSBpbnNlcnRpb25zKCspLCAzODMgZGVsZXRpb25zKC0pCiBkZWxl
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9mYi5jCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9k
cm0vbWdhZzIwMC9NYWtlZmlsZQppbmRleCA5OGQyMDQ0MDhiZDAuLjA0YjI4MWJjZjY1NSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9n
cHUvZHJtL21nYWcyMDAvTWFrZWZpbGUKQEAgLTEsNSArMSw1IEBACiAjIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKIG1nYWcyMDAteSAgIDo9IG1nYWcyMDBfbWFpbi5vIG1n
YWcyMDBfbW9kZS5vIG1nYWcyMDBfY3Vyc29yLm8gXAotCW1nYWcyMDBfZHJ2Lm8gbWdhZzIwMF9m
Yi5vIG1nYWcyMDBfaTJjLm8gbWdhZzIwMF90dG0ubworCW1nYWcyMDBfZHJ2Lm8gbWdhZzIwMF9p
MmMubyBtZ2FnMjAwX3R0bS5vCiAKIG9iai0kKENPTkZJR19EUk1fTUdBRzIwMCkgKz0gbWdhZzIw
MC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oIGIv
ZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9kcnYuaAppbmRleCAzYWIyN2YxMDUzYzEu
LjFjOTNmOGRjMDhjNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIw
MF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oCkBAIC05
OSwxNCArOTksNiBAQAogI2RlZmluZSB0b19tZ2FfZW5jb2Rlcih4KSBjb250YWluZXJfb2YoeCwg
c3RydWN0IG1nYV9lbmNvZGVyLCBiYXNlKQogI2RlZmluZSB0b19tZ2FfY29ubmVjdG9yKHgpIGNv
bnRhaW5lcl9vZih4LCBzdHJ1Y3QgbWdhX2Nvbm5lY3RvciwgYmFzZSkKIAotc3RydWN0IG1nYV9m
YmRldiB7Ci0Jc3RydWN0IGRybV9mYl9oZWxwZXIgaGVscGVyOyAvKiBtdXN0IGJlIGZpcnN0ICov
Ci0Jdm9pZCAqc3lzcmFtOwotCWludCBzaXplOwotCWludCB4MSwgeTEsIHgyLCB5MjsgLyogZGly
dHkgcmVjdCAqLwotCXNwaW5sb2NrX3QgZGlydHlfbG9jazsKLX07Ci0KIHN0cnVjdCBtZ2FfY3J0
YyB7CiAJc3RydWN0IGRybV9jcnRjIGJhc2U7CiAJdTggbHV0X3JbMjU2XSwgbHV0X2dbMjU2XSwg
bHV0X2JbMjU2XTsKQEAgLTE4MCw3ICsxNzIsNiBAQCBzdHJ1Y3QgbWdhX2RldmljZSB7CiAJc3Ry
dWN0IG1nYV9tYwkJCW1jOwogCXN0cnVjdCBtZ2FfbW9kZV9pbmZvCQltb2RlX2luZm87CiAKLQlz
dHJ1Y3QgbWdhX2ZiZGV2ICptZmJkZXY7CiAJc3RydWN0IG1nYV9jdXJzb3IgY3Vyc29yOwogCiAJ
Ym9vbAkJCQlzdXNwZW5kZWQ7CkBAIC0yMDEsMTkgKzE5Miw5IEBAIHN0cnVjdCBtZ2FfZGV2aWNl
IHsKIGludCBtZ2FnMjAwX21vZGVzZXRfaW5pdChzdHJ1Y3QgbWdhX2RldmljZSAqbWRldik7CiB2
b2lkIG1nYWcyMDBfbW9kZXNldF9maW5pKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2KTsKIAotCQkJ
CS8qIG1nYWcyMDBfZmIuYyAqLwotaW50IG1nYWcyMDBfZmJkZXZfaW5pdChzdHJ1Y3QgbWdhX2Rl
dmljZSAqbWRldik7Ci12b2lkIG1nYWcyMDBfZmJkZXZfZmluaShzdHJ1Y3QgbWdhX2RldmljZSAq
bWRldik7Ci0KIAkJCQkvKiBtZ2FnMjAwX21haW4uYyAqLwogaW50IG1nYWcyMDBfZHJpdmVyX2xv
YWQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyBmbGFncyk7CiB2b2lkIG1n
YWcyMDBfZHJpdmVyX3VubG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKLWludCBtZ2FnMjAw
X2dlbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgdTMyIHNpemUsIGJvb2wg
aXNrZXJuZWwsCi0JCSAgICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipvYmopOwotaW50IG1n
YWcyMDBfZHVtYl9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAotCQkJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKLQkJCXN0cnVjdCBkcm1fbW9kZV9jcmVhdGVfZHVtYiAqYXJncyk7CiAKIAkJ
CQkvKiBtZ2FnMjAwX2kyYy5jICovCiBzdHJ1Y3QgbWdhX2kyY19jaGFuICptZ2FnMjAwX2kyY19j
cmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vbWdhZzIwMC9tZ2FnMjAwX2ZiLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAw
X2ZiLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IGM3N2NmMWIzNGM5OC4uMDAwMDAw
MDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfZmIuYworKysgL2Rl
di9udWxsCkBAIC0xLDMwOSArMCwwIEBACi0vLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BM
LTIuMC1vbmx5Ci0vKgotICogQ29weXJpZ2h0IDIwMTAgTWF0dCBUdXJuZXIuCi0gKiBDb3B5cmln
aHQgMjAxMiBSZWQgSGF0Ci0gKgotICogQXV0aG9yczogTWF0dGhldyBHYXJyZXR0Ci0gKiAgICAg
ICAgICBNYXR0IFR1cm5lcgotICogICAgICAgICAgRGF2ZSBBaXJsaWUKLSAqLwotCi0jaW5jbHVk
ZSA8bGludXgvbW9kdWxlLmg+Ci0jaW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgotCi0jaW5jbHVk
ZSA8ZHJtL2RybV9jcnRjX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fZmJfaGVscGVyLmg+
Ci0jaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFt
ZWJ1ZmZlcl9oZWxwZXIuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3V0aWwuaD4KLQotI2luY2x1ZGUg
Im1nYWcyMDBfZHJ2LmgiCi0KLXN0YXRpYyB2b2lkIG1nYV9kaXJ0eV91cGRhdGUoc3RydWN0IG1n
YV9mYmRldiAqbWZiZGV2LAotCQkJICAgICBpbnQgeCwgaW50IHksIGludCB3aWR0aCwgaW50IGhl
aWdodCkKLXsKLQlpbnQgaTsKLQlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvOwotCWlu
dCBzcmNfb2Zmc2V0LCBkc3Rfb2Zmc2V0OwotCWludCByZXQ7Ci0JdTggKmRzdDsKLQlib29sIHVu
bWFwID0gZmFsc2U7Ci0JYm9vbCBzdG9yZV9mb3JfbGF0ZXIgPSBmYWxzZTsKLQlpbnQgeDIsIHky
OwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0Jc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBt
ZmJkZXYtPmhlbHBlci5mYjsKLQlpbnQgYnBwID0gZmItPmZvcm1hdC0+Y3BwWzBdOwotCi0JZ2Jv
ID0gZHJtX2dlbV92cmFtX29mX2dlbShmYi0+b2JqWzBdKTsKLQotCWlmIChkcm1fY2FuX3NsZWVw
KCkpIHsKLQkJLyogV2UgcGluIHRoZSBCTyBzbyBpdCB3b24ndCBiZSBtb3ZlZCBkdXJpbmcgdGhl
Ci0JCSAqIHVwZGF0ZS4gVGhlIGFjdHVhbCBsb2NhdGlvbiwgdmlkZW8gUkFNIG9yIHN5c3RlbQot
CQkgKiBtZW1vcnksIGlzIG5vdCBpbXBvcnRhbnQuCi0JCSAqLwotCQlyZXQgPSBkcm1fZ2VtX3Zy
YW1fcGluKGdibywgMCk7Ci0JCWlmIChyZXQpIHsKLQkJCWlmIChyZXQgIT0gLUVCVVNZKQotCQkJ
CXJldHVybjsKLQkJCXN0b3JlX2Zvcl9sYXRlciA9IHRydWU7Ci0JCX0KLQl9IGVsc2UgewotCQlz
dG9yZV9mb3JfbGF0ZXIgPSB0cnVlOwotCX0KLQotCXgyID0geCArIHdpZHRoIC0gMTsKLQl5MiA9
IHkgKyBoZWlnaHQgLSAxOwotCXNwaW5fbG9ja19pcnFzYXZlKCZtZmJkZXYtPmRpcnR5X2xvY2ss
IGZsYWdzKTsKLQotCWlmIChtZmJkZXYtPnkxIDwgeSkKLQkJeSA9IG1mYmRldi0+eTE7Ci0JaWYg
KG1mYmRldi0+eTIgPiB5MikKLQkJeTIgPSBtZmJkZXYtPnkyOwotCWlmIChtZmJkZXYtPngxIDwg
eCkKLQkJeCA9IG1mYmRldi0+eDE7Ci0JaWYgKG1mYmRldi0+eDIgPiB4MikKLQkJeDIgPSBtZmJk
ZXYtPngyOwotCi0JaWYgKHN0b3JlX2Zvcl9sYXRlcikgewotCQltZmJkZXYtPngxID0geDsKLQkJ
bWZiZGV2LT54MiA9IHgyOwotCQltZmJkZXYtPnkxID0geTsKLQkJbWZiZGV2LT55MiA9IHkyOwot
CQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZtZmJkZXYtPmRpcnR5X2xvY2ssIGZsYWdzKTsKLQkJ
cmV0dXJuOwotCX0KLQotCW1mYmRldi0+eDEgPSBtZmJkZXYtPnkxID0gSU5UX01BWDsKLQltZmJk
ZXYtPngyID0gbWZiZGV2LT55MiA9IDA7Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmbWZiZGV2
LT5kaXJ0eV9sb2NrLCBmbGFncyk7Ci0KLQlkc3QgPSBkcm1fZ2VtX3ZyYW1fa21hcChnYm8sIGZh
bHNlLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGRzdCkpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8g
a21hcCBmYiB1cGRhdGVzXG4iKTsKLQkJZ290byBvdXQ7Ci0JfSBlbHNlIGlmICghZHN0KSB7Ci0J
CWRzdCA9IGRybV9nZW1fdnJhbV9rbWFwKGdibywgdHJ1ZSwgTlVMTCk7Ci0JCWlmIChJU19FUlIo
ZHN0KSkgewotCQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8ga21hcCBmYiB1cGRhdGVzXG4iKTsKLQkJ
CWdvdG8gb3V0OwotCQl9Ci0JCXVubWFwID0gdHJ1ZTsKLQl9Ci0KLQlmb3IgKGkgPSB5OyBpIDw9
IHkyOyBpKyspIHsKLQkJLyogYXNzdW1lIGVxdWFsIHN0cmlkZSBmb3Igbm93ICovCi0JCXNyY19v
ZmZzZXQgPSBkc3Rfb2Zmc2V0ID0gaSAqIGZiLT5waXRjaGVzWzBdICsgKHggKiBicHApOwotCQlt
ZW1jcHlfdG9pbyhkc3QgKyBkc3Rfb2Zmc2V0LCBtZmJkZXYtPnN5c3JhbSArIHNyY19vZmZzZXQs
Ci0JCQkgICAgKHgyIC0geCArIDEpICogYnBwKTsKLQl9Ci0KLQlpZiAodW5tYXApCi0JCWRybV9n
ZW1fdnJhbV9rdW5tYXAoZ2JvKTsKLQotb3V0OgotCWRybV9nZW1fdnJhbV91bnBpbihnYm8pOwot
fQotCi1zdGF0aWMgdm9pZCBtZ2FfZmlsbHJlY3Qoc3RydWN0IGZiX2luZm8gKmluZm8sCi0JCQkg
Y29uc3Qgc3RydWN0IGZiX2ZpbGxyZWN0ICpyZWN0KQotewotCXN0cnVjdCBtZ2FfZmJkZXYgKm1m
YmRldiA9IGluZm8tPnBhcjsKLQlkcm1fZmJfaGVscGVyX3N5c19maWxscmVjdChpbmZvLCByZWN0
KTsKLQltZ2FfZGlydHlfdXBkYXRlKG1mYmRldiwgcmVjdC0+ZHgsIHJlY3QtPmR5LCByZWN0LT53
aWR0aCwKLQkJCSByZWN0LT5oZWlnaHQpOwotfQotCi1zdGF0aWMgdm9pZCBtZ2FfY29weWFyZWEo
c3RydWN0IGZiX2luZm8gKmluZm8sCi0JCQkgY29uc3Qgc3RydWN0IGZiX2NvcHlhcmVhICphcmVh
KQotewotCXN0cnVjdCBtZ2FfZmJkZXYgKm1mYmRldiA9IGluZm8tPnBhcjsKLQlkcm1fZmJfaGVs
cGVyX3N5c19jb3B5YXJlYShpbmZvLCBhcmVhKTsKLQltZ2FfZGlydHlfdXBkYXRlKG1mYmRldiwg
YXJlYS0+ZHgsIGFyZWEtPmR5LCBhcmVhLT53aWR0aCwKLQkJCSBhcmVhLT5oZWlnaHQpOwotfQot
Ci1zdGF0aWMgdm9pZCBtZ2FfaW1hZ2VibGl0KHN0cnVjdCBmYl9pbmZvICppbmZvLAotCQkJICBj
b25zdCBzdHJ1Y3QgZmJfaW1hZ2UgKmltYWdlKQotewotCXN0cnVjdCBtZ2FfZmJkZXYgKm1mYmRl
diA9IGluZm8tPnBhcjsKLQlkcm1fZmJfaGVscGVyX3N5c19pbWFnZWJsaXQoaW5mbywgaW1hZ2Up
OwotCW1nYV9kaXJ0eV91cGRhdGUobWZiZGV2LCBpbWFnZS0+ZHgsIGltYWdlLT5keSwgaW1hZ2Ut
PndpZHRoLAotCQkJIGltYWdlLT5oZWlnaHQpOwotfQotCi0KLXN0YXRpYyBzdHJ1Y3QgZmJfb3Bz
IG1nYWcyMDBmYl9vcHMgPSB7Ci0JLm93bmVyID0gVEhJU19NT0RVTEUsCi0JLmZiX2NoZWNrX3Zh
ciA9IGRybV9mYl9oZWxwZXJfY2hlY2tfdmFyLAotCS5mYl9zZXRfcGFyID0gZHJtX2ZiX2hlbHBl
cl9zZXRfcGFyLAotCS5mYl9maWxscmVjdCA9IG1nYV9maWxscmVjdCwKLQkuZmJfY29weWFyZWEg
PSBtZ2FfY29weWFyZWEsCi0JLmZiX2ltYWdlYmxpdCA9IG1nYV9pbWFnZWJsaXQsCi0JLmZiX3Bh
bl9kaXNwbGF5ID0gZHJtX2ZiX2hlbHBlcl9wYW5fZGlzcGxheSwKLQkuZmJfYmxhbmsgPSBkcm1f
ZmJfaGVscGVyX2JsYW5rLAotCS5mYl9zZXRjbWFwID0gZHJtX2ZiX2hlbHBlcl9zZXRjbWFwLAot
fTsKLQotc3RhdGljIGludCBtZ2FnMjAwZmJfY3JlYXRlX29iamVjdChzdHJ1Y3QgbWdhX2ZiZGV2
ICphZmJkZXYsCi0JCQkJICAgY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21k
LAotCQkJCSAgIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmdvYmpfcCkKLXsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gYWZiZGV2LT5oZWxwZXIuZGV2OwotCXUzMiBzaXplOwotCXN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqZ29iajsKLQlpbnQgcmV0ID0gMDsKLQotCXNpemUgPSBtb2RlX2NtZC0+
cGl0Y2hlc1swXSAqIG1vZGVfY21kLT5oZWlnaHQ7Ci0JcmV0ID0gbWdhZzIwMF9nZW1fY3JlYXRl
KGRldiwgc2l6ZSwgdHJ1ZSwgJmdvYmopOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQkq
Z29ial9wID0gZ29iajsKLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgaW50IG1nYWcyMDBmYl9j
cmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKLQkJCSAgIHN0cnVjdCBkcm1fZmJf
aGVscGVyX3N1cmZhY2Vfc2l6ZSAqc2l6ZXMpCi17Ci0Jc3RydWN0IG1nYV9mYmRldiAqbWZiZGV2
ID0KLQkJY29udGFpbmVyX29mKGhlbHBlciwgc3RydWN0IG1nYV9mYmRldiwgaGVscGVyKTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gbWZiZGV2LT5oZWxwZXIuZGV2OwotCXN0cnVjdCBkcm1f
bW9kZV9mYl9jbWQyIG1vZGVfY21kOwotCXN0cnVjdCBtZ2FfZGV2aWNlICptZGV2ID0gZGV2LT5k
ZXZfcHJpdmF0ZTsKLQlzdHJ1Y3QgZmJfaW5mbyAqaW5mbzsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYjsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmogPSBOVUxMOwotCWludCByZXQ7
Ci0Jdm9pZCAqc3lzcmFtOwotCWludCBzaXplOwotCi0JbW9kZV9jbWQud2lkdGggPSBzaXplcy0+
c3VyZmFjZV93aWR0aDsKLQltb2RlX2NtZC5oZWlnaHQgPSBzaXplcy0+c3VyZmFjZV9oZWlnaHQ7
Ci0JbW9kZV9jbWQucGl0Y2hlc1swXSA9IG1vZGVfY21kLndpZHRoICogKChzaXplcy0+c3VyZmFj
ZV9icHAgKyA3KSAvIDgpOwotCi0JbW9kZV9jbWQucGl4ZWxfZm9ybWF0ID0gZHJtX21vZGVfbGVn
YWN5X2ZiX2Zvcm1hdChzaXplcy0+c3VyZmFjZV9icHAsCi0JCQkJCQkJICBzaXplcy0+c3VyZmFj
ZV9kZXB0aCk7Ci0Jc2l6ZSA9IG1vZGVfY21kLnBpdGNoZXNbMF0gKiBtb2RlX2NtZC5oZWlnaHQ7
Ci0KLQlyZXQgPSBtZ2FnMjAwZmJfY3JlYXRlX29iamVjdChtZmJkZXYsICZtb2RlX2NtZCwgJmdv
YmopOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gY3JlYXRlIGZiY29uIGJh
Y2tpbmcgb2JqZWN0ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCXN5c3JhbSA9
IHZtYWxsb2Moc2l6ZSk7Ci0JaWYgKCFzeXNyYW0pIHsKLQkJcmV0ID0gLUVOT01FTTsKLQkJZ290
byBlcnJfZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkOwotCX0KLQotCWluZm8gPSBkcm1fZmJf
aGVscGVyX2FsbG9jX2ZiaShoZWxwZXIpOwotCWlmIChJU19FUlIoaW5mbykpIHsKLQkJcmV0ID0g
UFRSX0VSUihpbmZvKTsKLQkJZ290byBlcnJfdmZyZWU7Ci0JfQotCi0JZmIgPSBkcm1fZ2VtX2Zi
ZGV2X2ZiX2NyZWF0ZShkZXYsIHNpemVzLCAwLCBnb2JqLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGZi
KSkgewotCQlyZXQgPSBQVFJfRVJSKGZiKTsKLQkJZ290byBlcnJfdmZyZWU7Ci0JfQotCi0JbWZi
ZGV2LT5zeXNyYW0gPSBzeXNyYW07Ci0JbWZiZGV2LT5zaXplID0gc2l6ZTsKLQotCS8qIHNldHVw
IGhlbHBlciAqLwotCW1mYmRldi0+aGVscGVyLmZiID0gZmI7Ci0KLQlpbmZvLT5mYm9wcyA9ICZt
Z2FnMjAwZmJfb3BzOwotCi0JLyogc2V0dXAgYXBlcnR1cmUgYmFzZS9zaXplIGZvciB2ZXNhZmIg
dGFrZW92ZXIgKi8KLQlpbmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5iYXNlID0gbWRldi0+ZGV2
LT5tb2RlX2NvbmZpZy5mYl9iYXNlOwotCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLnNpemUg
PSBtZGV2LT5tYy52cmFtX3NpemU7Ci0KLQlkcm1fZmJfaGVscGVyX2ZpbGxfaW5mbyhpbmZvLCAm
bWZiZGV2LT5oZWxwZXIsIHNpemVzKTsKLQotCWluZm8tPnNjcmVlbl9iYXNlID0gc3lzcmFtOwot
CWluZm8tPnNjcmVlbl9zaXplID0gc2l6ZTsKLQlpbmZvLT5waXhtYXAuZmxhZ3MgPSBGQl9QSVhN
QVBfU1lTVEVNOwotCi0JRFJNX0RFQlVHX0tNUygiYWxsb2NhdGVkICVkeCVkXG4iLAotCQkgICAg
ICBmYi0+d2lkdGgsIGZiLT5oZWlnaHQpOwotCi0JcmV0dXJuIDA7Ci0KLWVycl92ZnJlZToKLQl2
ZnJlZShzeXNyYW0pOwotZXJyX2RybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZDoKLQlkcm1fZ2Vt
X29iamVjdF9wdXRfdW5sb2NrZWQoZ29iaik7Ci0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIGlu
dCBtZ2FfZmJkZXZfZGVzdHJveShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJCXN0cnVjdCBt
Z2FfZmJkZXYgKm1mYmRldikKLXsKLQlkcm1fZmJfaGVscGVyX3VucmVnaXN0ZXJfZmJpKCZtZmJk
ZXYtPmhlbHBlcik7Ci0JZHJtX2ZiX2hlbHBlcl9maW5pKCZtZmJkZXYtPmhlbHBlcik7Ci0JZHJt
X2ZyYW1lYnVmZmVyX3B1dChtZmJkZXYtPmhlbHBlci5mYik7Ci0KLQl2ZnJlZShtZmJkZXYtPnN5
c3JhbSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZmJfaGVs
cGVyX2Z1bmNzIG1nYV9mYl9oZWxwZXJfZnVuY3MgPSB7Ci0JLmZiX3Byb2JlID0gbWdhZzIwMGZi
X2NyZWF0ZSwKLX07Ci0KLWludCBtZ2FnMjAwX2ZiZGV2X2luaXQoc3RydWN0IG1nYV9kZXZpY2Ug
Km1kZXYpCi17Ci0Jc3RydWN0IG1nYV9mYmRldiAqbWZiZGV2OwotCWludCByZXQ7Ci0JaW50IGJw
cF9zZWwgPSAzMjsKLQotCS8qIHByZWZlciAxNmJwcCBvbiBsb3cgZW5kIGdwdXMgd2l0aCBsaW1p
dGVkIFZSQU0gKi8KLQlpZiAoSVNfRzIwMF9TRShtZGV2KSAmJiBtZGV2LT5tYy52cmFtX3NpemUg
PCAoMjA0OCoxMDI0KSkKLQkJYnBwX3NlbCA9IDE2OwotCi0JbWZiZGV2ID0gZGV2bV9remFsbG9j
KG1kZXYtPmRldi0+ZGV2LCBzaXplb2Yoc3RydWN0IG1nYV9mYmRldiksIEdGUF9LRVJORUwpOwot
CWlmICghbWZiZGV2KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCW1kZXYtPm1mYmRldiA9IG1mYmRl
djsKLQlzcGluX2xvY2tfaW5pdCgmbWZiZGV2LT5kaXJ0eV9sb2NrKTsKLQotCWRybV9mYl9oZWxw
ZXJfcHJlcGFyZShtZGV2LT5kZXYsICZtZmJkZXYtPmhlbHBlciwgJm1nYV9mYl9oZWxwZXJfZnVu
Y3MpOwotCi0JcmV0ID0gZHJtX2ZiX2hlbHBlcl9pbml0KG1kZXYtPmRldiwgJm1mYmRldi0+aGVs
cGVyLAotCQkJCSBNR0FHMjAwRkJfQ09OTl9MSU1JVCk7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJf
ZmJfaGVscGVyOwotCi0JcmV0ID0gZHJtX2ZiX2hlbHBlcl9zaW5nbGVfYWRkX2FsbF9jb25uZWN0
b3JzKCZtZmJkZXYtPmhlbHBlcik7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfZmJfc2V0dXA7Ci0K
LQkvKiBkaXNhYmxlIGFsbCB0aGUgcG9zc2libGUgb3V0cHV0cy9jcnRjcyBiZWZvcmUgZW50ZXJp
bmcgS01TIG1vZGUgKi8KLQlkcm1faGVscGVyX2Rpc2FibGVfdW51c2VkX2Z1bmN0aW9ucyhtZGV2
LT5kZXYpOwotCi0JcmV0ID0gZHJtX2ZiX2hlbHBlcl9pbml0aWFsX2NvbmZpZygmbWZiZGV2LT5o
ZWxwZXIsIGJwcF9zZWwpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX2ZiX3NldHVwOwotCi0JcmV0
dXJuIDA7Ci0KLWVycl9mYl9zZXR1cDoKLQlkcm1fZmJfaGVscGVyX2ZpbmkoJm1mYmRldi0+aGVs
cGVyKTsKLWVycl9mYl9oZWxwZXI6Ci0JbWRldi0+bWZiZGV2ID0gTlVMTDsKLQotCXJldHVybiBy
ZXQ7Ci19Ci0KLXZvaWQgbWdhZzIwMF9mYmRldl9maW5pKHN0cnVjdCBtZ2FfZGV2aWNlICptZGV2
KQotewotCWlmICghbWRldi0+bWZiZGV2KQotCQlyZXR1cm47Ci0KLQltZ2FfZmJkZXZfZGVzdHJv
eShtZGV2LT5kZXYsIG1kZXYtPm1mYmRldik7Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vbWdhZzIwMC9tZ2FnMjAwX21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcy
MDBfbWFpbi5jCmluZGV4IGIxMGY3MjY1YjVjNC4uNmQ5NDNhMDA4NzUyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX21haW4uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vbWdhZzIwMC9tZ2FnMjAwX21haW4uYwpAQCAtMTQsOCArMTQsMzMgQEAKIAogI2luY2x1ZGUg
Im1nYWcyMDBfZHJ2LmgiCiAKK3N0YXRpYyBpbnQgbWdhX2ZyYW1lYnVmZmVyX2RpcnR5ZmIoc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJICAgc3RydWN0IGRybV9maWxlICpmaWxlX3By
aXYsCisJCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLAorCQkJCSAgIHVuc2lnbmVkIGludCBjb2xv
ciwKKwkJCQkgICBzdHJ1Y3QgZHJtX2NsaXBfcmVjdCAqY2xpcHMsCisJCQkJICAgdW5zaWduZWQg
aW50IG51bV9jbGlwcykKK3sKKwkvKiBlbXB0eSBwbGFjZWhvbGRlciBmdW5jdGlvbiB0byBlbmFi
bGUgZmJjb24gc2hhZG93IGJ1ZmZlciAqLworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlcl9mdW5jcyBtZ2FfZnJhbWVidWZmZXJfZnVuY3MgPSB7CisJ
LmRlc3Ryb3kJPSBkcm1fZ2VtX2ZiX2Rlc3Ryb3ksCisJLmNyZWF0ZV9oYW5kbGUJPSBkcm1fZ2Vt
X2ZiX2NyZWF0ZV9oYW5kbGUsCisJLmRpcnR5CQk9IG1nYV9mcmFtZWJ1ZmZlcl9kaXJ0eWZiLAor
fTsKKworc3RhdGljIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKgorbWdhX21vZGVfY29uZmlnX2Z1
bmNzX2ZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUsCisJCQkJY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21kKQoreworCXJl
dHVybiBkcm1fZ2VtX2ZiX2NyZWF0ZV93aXRoX2Z1bmNzKGRldiwgZmlsZSwgbW9kZV9jbWQsCisJ
CQkJCSAgICAmbWdhX2ZyYW1lYnVmZmVyX2Z1bmNzKTsKK30KKwogc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fbW9kZV9jb25maWdfZnVuY3MgbWdhX21vZGVfZnVuY3MgPSB7Ci0JLmZiX2NyZWF0ZSA9
IGRybV9nZW1fZmJfY3JlYXRlCisJLmZiX2NyZWF0ZSA9IG1nYV9tb2RlX2NvbmZpZ19mdW5jc19m
Yl9jcmVhdGUKIH07CiAKIHN0YXRpYyBpbnQgbWdhX3Byb2JlX3ZyYW0oc3RydWN0IG1nYV9kZXZp
Y2UgKm1kZXYsIHZvaWQgX19pb21lbSAqbWVtKQpAQCAtMTYyLDcgKzE4Nyw3IEBAIGludCBtZ2Fn
MjAwX2RyaXZlcl9sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGxvbmcgZmxh
Z3MpCiAJaWYgKElTX0cyMDBfU0UobWRldikgJiYgbWRldi0+bWMudnJhbV9zaXplIDwgKDIwNDgq
MTAyNCkpCiAJCWRldi0+bW9kZV9jb25maWcucHJlZmVycmVkX2RlcHRoID0gMTY7CiAJZWxzZQot
CQlkZXYtPm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDI0OworCQlkZXYtPm1vZGVfY29u
ZmlnLnByZWZlcnJlZF9kZXB0aCA9IDMyOwogCWRldi0+bW9kZV9jb25maWcucHJlZmVyX3NoYWRv
dyA9IDE7CiAKIAlyID0gbWdhZzIwMF9tb2Rlc2V0X2luaXQobWRldik7CkBAIC0xODYsNiArMjEx
LDEzIEBAIGludCBtZ2FnMjAwX2RyaXZlcl9sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVu
c2lnbmVkIGxvbmcgZmxhZ3MpCiAJfQogCW1kZXYtPmN1cnNvci5waXhlbHNfY3VycmVudCA9IE5V
TEw7CiAKKwlyID0gZHJtX2ZiZGV2X2dlbmVyaWNfc2V0dXAobWRldi0+ZGV2LCAwKTsKKwlpZiAo
cikgeworCQlkZXZfZXJyKCZkZXYtPnBkZXYtPmRldiwKKwkJCSJkcm1fZmJkZXZfZ2VuZXJpY19z
ZXR1cCBmYWlsZWQ6ICVkXG4iLCByKTsKKwkJZ290byBlcnJfbW9kZXNldDsKKwl9CisKIAlyZXR1
cm4gMDsKIAogZXJyX21vZGVzZXQ6CkBAIC0yMDQsMzIgKzIzNiw3IEBAIHZvaWQgbWdhZzIwMF9k
cml2ZXJfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJaWYgKG1kZXYgPT0gTlVMTCkK
IAkJcmV0dXJuOwogCW1nYWcyMDBfbW9kZXNldF9maW5pKG1kZXYpOwotCW1nYWcyMDBfZmJkZXZf
ZmluaShtZGV2KTsKIAlkcm1fbW9kZV9jb25maWdfY2xlYW51cChkZXYpOwogCW1nYWcyMDBfbW1f
ZmluaShtZGV2KTsKIAlkZXYtPmRldl9wcml2YXRlID0gTlVMTDsKIH0KLQotaW50IG1nYWcyMDBf
Z2VtX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkgICB1MzIgc2l6ZSwgYm9vbCBp
c2tlcm5lbCwKLQkJICAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqKQotewotCXN0cnVjdCBk
cm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87Ci0JaW50IHJldDsKLQotCSpvYmogPSBOVUxMOwotCi0J
c2l6ZSA9IHJvdW5kdXAoc2l6ZSwgUEFHRV9TSVpFKTsKLQlpZiAoc2l6ZSA9PSAwKQotCQlyZXR1
cm4gLUVJTlZBTDsKLQotCWdibyA9IGRybV9nZW1fdnJhbV9jcmVhdGUoZGV2LCAmZGV2LT52cmFt
X21tLT5iZGV2LCBzaXplLCAwLCBmYWxzZSk7Ci0JaWYgKElTX0VSUihnYm8pKSB7Ci0JCXJldCA9
IFBUUl9FUlIoZ2JvKTsKLQkJaWYgKHJldCAhPSAtRVJFU1RBUlRTWVMpCi0JCQlEUk1fRVJST1Io
ImZhaWxlZCB0byBhbGxvY2F0ZSBHRU0gb2JqZWN0XG4iKTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0J
Km9iaiA9ICZnYm8tPmdlbTsKLQlyZXR1cm4gMDsKLX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9tZ2FnMjAwL21nYWcyMDBfbW9kZS5jIGIvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdh
ZzIwMF9tb2RlLmMKaW5kZXggYTdjZWY3OGQ0MjZmLi44MjJmMmExMzc0OGYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfbW9kZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9tZ2FnMjAwL21nYWcyMDBfbW9kZS5jCkBAIC04NjAsMTggKzg2MCwxMiBAQCBzdGF0aWMg
aW50IG1nYV9jcnRjX2RvX3NldF9iYXNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQlzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkJCQlpbnQgeCwgaW50IHksIGludCBhdG9taWMpCiB7
Ci0Jc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwogCXN0
cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CiAJaW50IHJldDsKIAlzNjQgZ3B1X2FkZHI7
Ci0Jdm9pZCAqYmFzZTsKIAogCWlmICghYXRvbWljICYmIGZiKSB7CiAJCWdibyA9IGRybV9nZW1f
dnJhbV9vZl9nZW0oZmItPm9ialswXSk7Ci0KLQkJLyogdW5tYXAgaWYgY29uc29sZSAqLwotCQlp
ZiAobWRldi0+bWZiZGV2LT5oZWxwZXIuZmIgPT0gZmIpCi0JCQlkcm1fZ2VtX3ZyYW1fa3VubWFw
KGdibyk7CiAJCWRybV9nZW1fdnJhbV91bnBpbihnYm8pOwogCX0KIApAQCAtODg2LDE1ICs4ODAs
NiBAQCBzdGF0aWMgaW50IG1nYV9jcnRjX2RvX3NldF9iYXNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0
YywKIAkJZ290byBlcnJfZHJtX2dlbV92cmFtX3VucGluOwogCX0KIAotCWlmIChtZGV2LT5tZmJk
ZXYtPmhlbHBlci5mYiA9PSBjcnRjLT5wcmltYXJ5LT5mYikgewotCQkvKiBpZiBwdXNoaW5nIGNv
bnNvbGUgaW4ga21hcCBpdCAqLwotCQliYXNlID0gZHJtX2dlbV92cmFtX2ttYXAoZ2JvLCB0cnVl
LCBOVUxMKTsKLQkJaWYgKElTX0VSUihiYXNlKSkgewotCQkJcmV0ID0gUFRSX0VSUihiYXNlKTsK
LQkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGttYXAgZmJjb25cbiIpOwotCQl9Ci0JfQotCiAJbWdh
X3NldF9zdGFydF9hZGRyZXNzKGNydGMsICh1MzIpZ3B1X2FkZHIpOwogCiAJcmV0dXJuIDA7CkBA
IC0xNDE4LDE0ICsxNDAzLDkgQEAgc3RhdGljIHZvaWQgbWdhX2NydGNfZGlzYWJsZShzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMpCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAltZ2FfY3J0Y19kcG1zKGNy
dGMsIERSTV9NT0RFX0RQTVNfT0ZGKTsKIAlpZiAoY3J0Yy0+cHJpbWFyeS0+ZmIpIHsKLQkJc3Ry
dWN0IG1nYV9kZXZpY2UgKm1kZXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwogCQlzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IGNydGMtPnByaW1hcnktPmZiOwogCQlzdHJ1Y3QgZHJtX2dl
bV92cmFtX29iamVjdCAqZ2JvID0KIAkJCWRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9ialswXSk7
Ci0KLQkJLyogdW5tYXAgaWYgY29uc29sZSAqLwotCQlpZiAobWRldi0+bWZiZGV2LT5oZWxwZXIu
ZmIgPT0gZmIpCi0JCQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7CiAJCWRybV9nZW1fdnJhbV91
bnBpbihnYm8pOwogCX0KIAljcnRjLT5wcmltYXJ5LT5mYiA9IE5VTEw7CkBAIC0xNzE4LDcgKzE2
OTgsNiBAQCBpbnQgbWdhZzIwMF9tb2Rlc2V0X2luaXQoc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYp
CiB7CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3I7Ci0JaW50IHJldDsKIAogCW1kZXYtPm1vZGVfaW5mby5tb2RlX2NvbmZpZ19p
bml0aWFsaXplZCA9IHRydWU7CiAKQEAgLTE3NDMsMTIgKzE3MjIsNiBAQCBpbnQgbWdhZzIwMF9t
b2Rlc2V0X2luaXQoc3RydWN0IG1nYV9kZXZpY2UgKm1kZXYpCiAKIAlkcm1fY29ubmVjdG9yX2F0
dGFjaF9lbmNvZGVyKGNvbm5lY3RvciwgZW5jb2Rlcik7CiAKLQlyZXQgPSBtZ2FnMjAwX2ZiZGV2
X2luaXQobWRldik7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoIm1nYV9mYmRldl9pbml0IGZh
aWxlZFxuIik7Ci0JCXJldHVybiByZXQ7Ci0JfQotCiAJcmV0dXJuIDA7CiB9CiAKLS0gCjIuMjEu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
