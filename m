Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 537F5346438
	for <lists+dri-devel@lfdr.de>; Tue, 23 Mar 2021 16:59:43 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ABB856EC28;
	Tue, 23 Mar 2021 15:58:42 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0FC766EC12
 for <dri-devel@lists.freedesktop.org>; Tue, 23 Mar 2021 15:57:44 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v9 02/70] drm/i915: Pin timeline map after first timeline pin,
 v4.
Date: Tue, 23 Mar 2021 16:49:51 +0100
Message-Id: <20210323155059.628690-3-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.31.0
In-Reply-To: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
References: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 kernel test robot <lkp@intel.com>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2UncmUgc3RhcnRpbmcgdG8gcmVxdWlyZSB0aGUgcmVzZXJ2YXRpb24gbG9jayBmb3IgcGlubmlu
ZywKc28gd2FpdCB1bnRpbCB3ZSBoYXZlIHRoYXQuCgpVcGRhdGUgdGhlIHNlbGZ0ZXN0cyB0byBo
YW5kbGUgdGhpcyBjb3JyZWN0bHksIGFuZCBlbnN1cmUgcGluIGlzCmNhbGxlZCBpbiBsaXZlX2h3
c3Bfcm9sbG92ZXJfdXNlcigpIGFuZCBtb2NrX2h3c3BfZnJlZWxpc3QoKS4KCkNoYW5nZXMgc2lu
Y2UgdjE6Ci0gRml4IE5VTEwgKyBYWCBhcml0aG1hdGljLCB1c2UgY2FzdHMuIChrYnVpbGQpCkNo
YW5nZXMgc2luY2UgdjI6Ci0gQ2xlYXIgZW50aXJlIGNhY2hlbGluZSB3aGVuIHBpbm5pbmcuCkNo
YW5nZXMgc2luY2UgdjM6Ci0gQ0FDSEVMSU5FX0JZVEVTIC0+IFRJTUVMSU5FX1NFUU5PX0JZVEVT
LiAoamVrc3RyYW5kKQoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4u
bGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KUmVwb3J0ZWQtYnk6IGtlcm5lbCB0ZXN0IHJvYm90
IDxsa3BAaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogVGhvbWFzIEhlbGxzdHLDtm0gPHRob21hcy5o
ZWxsc3Ryb21AbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3RpbWVsaW5lLmMgICAgfCA0MCArKysrKysrKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfdGltZWxpbmUuaCAgICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L21vY2tfZW5naW5lLmMgICAgICAgfCAyMiArKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfdGltZWxpbmUuYyB8IDYxICsrKysrKysrKysrLS0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zZWxmdGVzdC5oICAgICAgICB8ICAyICsKIDUgZmlsZXMgY2hh
bmdlZCwgODMgaW5zZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKaW5kZXggZWZlMjAzMGNmZTVlLi5mMTljZjZkMmZhODUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYwpAQCAtNTIsMTQgKzUy
LDI5IEBAIHN0YXRpYyBpbnQgX190aW1lbGluZV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICph
Y3RpdmUpCiAJcmV0dXJuIDA7CiB9CiAKK0k5MTVfU0VMRlRFU1RfRVhQT1JUIGludAoraW50ZWxf
dGltZWxpbmVfcGluX21hcChzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lKQoreworCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0aW1lbGluZS0+aHdzcF9nZ3R0LT5vYmo7
CisJdTMyIG9mcyA9IG9mZnNldF9pbl9wYWdlKHRpbWVsaW5lLT5od3NwX29mZnNldCk7CisJdm9p
ZCAqdmFkZHI7CisKKwl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9N
QVBfV0IpOworCWlmIChJU19FUlIodmFkZHIpKQorCQlyZXR1cm4gUFRSX0VSUih2YWRkcik7CisK
Kwl0aW1lbGluZS0+aHdzcF9tYXAgPSB2YWRkcjsKKwl0aW1lbGluZS0+aHdzcF9zZXFubyA9IG1l
bXNldCh2YWRkciArIG9mcywgMCwgVElNRUxJTkVfU0VRTk9fQllURVMpOworCWNsZmx1c2godmFk
ZHIgKyBvZnMpOworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgaW50ZWxfdGltZWxpbmVf
aW5pdChzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lLAogCQkJICAgICAgIHN0cnVjdCBp
bnRlbF9ndCAqZ3QsCiAJCQkgICAgICAgc3RydWN0IGk5MTVfdm1hICpod3NwLAogCQkJICAgICAg
IHVuc2lnbmVkIGludCBvZmZzZXQpCiB7Ci0Jdm9pZCAqdmFkZHI7Ci0JdTMyICpzZXFubzsKLQog
CWtyZWZfaW5pdCgmdGltZWxpbmUtPmtyZWYpOwogCWF0b21pY19zZXQoJnRpbWVsaW5lLT5waW5f
Y291bnQsIDApOwogCkBAIC03NiwxNCArOTEsOCBAQCBzdGF0aWMgaW50IGludGVsX3RpbWVsaW5l
X2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKIAkJdGltZWxpbmUtPmh3c3Bf
Z2d0dCA9IGh3c3A7CiAJfQogCi0JdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChod3Nw
LT5vYmosIEk5MTVfTUFQX1dCKTsKLQlpZiAoSVNfRVJSKHZhZGRyKSkKLQkJcmV0dXJuIFBUUl9F
UlIodmFkZHIpOwotCi0JdGltZWxpbmUtPmh3c3BfbWFwID0gdmFkZHI7Ci0Jc2Vxbm8gPSB2YWRk
ciArIHRpbWVsaW5lLT5od3NwX29mZnNldDsKLQlXUklURV9PTkNFKCpzZXFubywgMCk7Ci0JdGlt
ZWxpbmUtPmh3c3Bfc2Vxbm8gPSBzZXFubzsKKwl0aW1lbGluZS0+aHdzcF9tYXAgPSBOVUxMOwor
CXRpbWVsaW5lLT5od3NwX3NlcW5vID0gKHZvaWQgKikobG9uZyl0aW1lbGluZS0+aHdzcF9vZmZz
ZXQ7CiAKIAlHRU1fQlVHX09OKHRpbWVsaW5lLT5od3NwX29mZnNldCA+PSBod3NwLT5zaXplKTsK
IApAQCAtMTEzLDcgKzEyMiw4IEBAIHN0YXRpYyB2b2lkIGludGVsX3RpbWVsaW5lX2Zpbmkoc3Ry
dWN0IHJjdV9oZWFkICpyY3UpCiAJc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSA9CiAJ
CWNvbnRhaW5lcl9vZihyY3UsIHN0cnVjdCBpbnRlbF90aW1lbGluZSwgcmN1KTsKIAotCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9tYXAodGltZWxpbmUtPmh3c3BfZ2d0dC0+b2JqKTsKKwlpZiAodGlt
ZWxpbmUtPmh3c3BfbWFwKQorCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHRpbWVsaW5lLT5o
d3NwX2dndHQtPm9iaik7CiAKIAlpOTE1X3ZtYV9wdXQodGltZWxpbmUtPmh3c3BfZ2d0dCk7CiAJ
aTkxNV9hY3RpdmVfZmluaSgmdGltZWxpbmUtPmFjdGl2ZSk7CkBAIC0xNzMsNiArMTgzLDEyIEBA
IGludCBpbnRlbF90aW1lbGluZV9waW4oc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwgc3RydWN0
IGk5MTVfZ2VtX3d3X2N0eCAqd3cpCiAJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ0bC0+cGluX2Nv
dW50LCAxLCAwKSkKIAkJcmV0dXJuIDA7CiAKKwlpZiAoIXRsLT5od3NwX21hcCkgeworCQllcnIg
PSBpbnRlbF90aW1lbGluZV9waW5fbWFwKHRsKTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7
CisJfQorCiAJZXJyID0gaTkxNV9nZ3R0X3Bpbih0bC0+aHdzcF9nZ3R0LCB3dywgMCwgUElOX0hJ
R0gpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfdGltZWxpbmUuaAppbmRleCBiMWY4MWQ5NDdmOGQuLjU3MzA4YzRkNjY0YSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5oCkBAIC05OCw0ICs5OCw2IEBAIGludGVs
X3RpbWVsaW5lX2lzX2xhc3QoY29uc3Qgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwKIAlyZXR1
cm4gbGlzdF9pc19sYXN0X3JjdSgmcnEtPmxpbmssICZ0bC0+cmVxdWVzdHMpOwogfQogCitJOTE1
X1NFTEZURVNUX0RFQ0xBUkUoaW50IGludGVsX3RpbWVsaW5lX3Bpbl9tYXAoc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bCkpOworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L21vY2tfZW5naW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2lu
ZS5jCmluZGV4IDU2NjJmN2MyZjcxOS4uNDJmZDg2NjU4ZWU3IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L21vY2tfZW5naW5lLmMKQEAgLTEzLDkgKzEzLDIwIEBACiAjaW5jbHVkZSAibW9ja19lbmdp
bmUuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmgiCiAKLXN0YXRpYyB2b2lk
IG1vY2tfdGltZWxpbmVfcGluKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCitzdGF0aWMgaW50
IG1vY2tfdGltZWxpbmVfcGluKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiB7CisJaW50IGVy
cjsKKworCWlmIChXQVJOX09OKCFpOTE1X2dlbV9vYmplY3RfdHJ5bG9jayh0bC0+aHdzcF9nZ3R0
LT5vYmopKSkKKwkJcmV0dXJuIC1FQlVTWTsKKworCWVyciA9IGludGVsX3RpbWVsaW5lX3Bpbl9t
YXAodGwpOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2sodGwtPmh3c3BfZ2d0dC0+b2JqKTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCiAJYXRvbWljX2luYygmdGwtPnBpbl9jb3VudCk7CisJ
cmV0dXJuIDA7CiB9CiAKIHN0YXRpYyB2b2lkIG1vY2tfdGltZWxpbmVfdW5waW4oc3RydWN0IGlu
dGVsX3RpbWVsaW5lICp0bCkKQEAgLTEzMyw2ICsxNDQsOCBAQCBzdGF0aWMgdm9pZCBtb2NrX2Nv
bnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqcmVmKQogCiBzdGF0aWMgaW50IG1vY2tfY29udGV4
dF9hbGxvYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CisJaW50IGVycjsKKwogCWNlLT5y
aW5nID0gbW9ja19yaW5nKGNlLT5lbmdpbmUpOwogCWlmICghY2UtPnJpbmcpCiAJCXJldHVybiAt
RU5PTUVNOwpAQCAtMTQzLDcgKzE1NiwxMiBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9hbGxv
YyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCXJldHVybiBQVFJfRVJSKGNlLT50aW1lbGlu
ZSk7CiAJfQogCi0JbW9ja190aW1lbGluZV9waW4oY2UtPnRpbWVsaW5lKTsKKwllcnIgPSBtb2Nr
X3RpbWVsaW5lX3BpbihjZS0+dGltZWxpbmUpOworCWlmIChlcnIpIHsKKwkJaW50ZWxfdGltZWxp
bmVfcHV0KGNlLT50aW1lbGluZSk7CisJCWNlLT50aW1lbGluZSA9IE5VTEw7CisJCXJldHVybiBl
cnI7CisJfQogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfdGltZWxpbmUuYwppbmRleCBiZTQ2NDY1YTU3YzkuLmZhNGI5NjVlZDVlZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCkBAIC01OSw2ICs1OSw3IEBA
IHN0YXRpYyB2b2lkIF9fbW9ja19od3NwX3JlY29yZChzdHJ1Y3QgbW9ja19od3NwX2ZyZWVsaXN0
ICpzdGF0ZSwKIAl0bCA9IHhjaGcoJnN0YXRlLT5oaXN0b3J5W2lkeF0sIHRsKTsKIAlpZiAodGwp
IHsKIAkJcmFkaXhfdHJlZV9kZWxldGUoJnN0YXRlLT5jYWNoZWxpbmVzLCBod3NwX2NhY2hlbGlu
ZSh0bCkpOworCQlpbnRlbF90aW1lbGluZV91bnBpbih0bCk7CiAJCWludGVsX3RpbWVsaW5lX3B1
dCh0bCk7CiAJfQogfQpAQCAtNzgsNiArNzksMTIgQEAgc3RhdGljIGludCBfX21vY2tfaHdzcF90
aW1lbGluZShzdHJ1Y3QgbW9ja19od3NwX2ZyZWVsaXN0ICpzdGF0ZSwKIAkJaWYgKElTX0VSUih0
bCkpCiAJCQlyZXR1cm4gUFRSX0VSUih0bCk7CiAKKwkJZXJyID0gaW50ZWxfdGltZWxpbmVfcGlu
KHRsLCBOVUxMKTsKKwkJaWYgKGVycikgeworCQkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKKwkJ
CXJldHVybiBlcnI7CisJCX0KKwogCQljYWNoZWxpbmUgPSBod3NwX2NhY2hlbGluZSh0bCk7CiAJ
CWVyciA9IHJhZGl4X3RyZWVfaW5zZXJ0KCZzdGF0ZS0+Y2FjaGVsaW5lcywgY2FjaGVsaW5lLCB0
bCk7CiAJCWlmIChlcnIpIHsKQEAgLTg1LDYgKzkyLDcgQEAgc3RhdGljIGludCBfX21vY2tfaHdz
cF90aW1lbGluZShzdHJ1Y3QgbW9ja19od3NwX2ZyZWVsaXN0ICpzdGF0ZSwKIAkJCQlwcl9lcnIo
IkhXU1AgY2FjaGVsaW5lICVsdSBhbHJlYWR5IHVzZWQ7IGR1cGxpY2F0ZSBhbGxvY2F0aW9uIVxu
IiwKIAkJCQkgICAgICAgY2FjaGVsaW5lKTsKIAkJCX0KKwkJCWludGVsX3RpbWVsaW5lX3VucGlu
KHRsKTsKIAkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQlyZXR1cm4gZXJyOwogCQl9CkBA
IC00NTIsNyArNDYwLDcgQEAgc3RhdGljIGludCBlbWl0X2dndHRfc3RvcmVfZHcoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsIHUzMiBhZGRyLCB1MzIgdmFsdWUpCiB9CiAKIHN0YXRpYyBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICoKLXRsX3dyaXRlKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyIHZhbHVlKQorY2hlY2tlZF90bF93cml0ZShz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
IHUzMiB2YWx1ZSkKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlpbnQgZXJyOwpAQCAt
NDYzLDYgKzQ3MSwxMyBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAkJZ290byBvdXQ7CiAJfQog
CisJaWYgKFJFQURfT05DRSgqdGwtPmh3c3Bfc2Vxbm8pICE9IHRsLT5zZXFubykgeworCQlwcl9l
cnIoIlRpbWVsaW5lIGNyZWF0ZWQgd2l0aCBpbmNvcnJlY3QgYnJlYWRjcnVtYiwgZm91bmQgJXgs
IGV4cGVjdGVkICV4XG4iLAorCQkgICAgICAgKnRsLT5od3NwX3NlcW5vLCB0bC0+c2Vxbm8pOwor
CQlpbnRlbF90aW1lbGluZV91bnBpbih0bCk7CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwor
CX0KKwogCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwog
CWlmIChJU19FUlIocnEpKQogCQlnb3RvIG91dF91bnBpbjsKQEAgLTQ4NCwyNSArNDk5LDYgQEAg
dGxfd3JpdGUoc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwgc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLCB1MzIgdmFsdWUpCiAJcmV0dXJuIHJxOwogfQogCi1zdGF0aWMgc3RydWN0IGlu
dGVsX3RpbWVsaW5lICoKLWNoZWNrZWRfaW50ZWxfdGltZWxpbmVfY3JlYXRlKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bDsKLQotCXRsID0gaW50ZWxf
dGltZWxpbmVfY3JlYXRlKGd0KTsKLQlpZiAoSVNfRVJSKHRsKSkKLQkJcmV0dXJuIHRsOwotCi0J
aWYgKFJFQURfT05DRSgqdGwtPmh3c3Bfc2Vxbm8pICE9IHRsLT5zZXFubykgewotCQlwcl9lcnIo
IlRpbWVsaW5lIGNyZWF0ZWQgd2l0aCBpbmNvcnJlY3QgYnJlYWRjcnVtYiwgZm91bmQgJXgsIGV4
cGVjdGVkICV4XG4iLAotCQkgICAgICAgKnRsLT5od3NwX3NlcW5vLCB0bC0+c2Vxbm8pOwotCQlp
bnRlbF90aW1lbGluZV9wdXQodGwpOwotCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKLQl9Ci0K
LQlyZXR1cm4gdGw7Ci19Ci0KIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2VuZ2luZSh2b2lkICphcmcp
CiB7CiAjZGVmaW5lIE5VTV9USU1FTElORVMgNDA5NgpAQCAtNTM1LDEzICs1MzEsMTMgQEAgc3Rh
dGljIGludCBsaXZlX2h3c3BfZW5naW5lKHZvaWQgKmFyZykKIAkJCXN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGw7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCQkJdGwgPSBjaGVja2Vk
X2ludGVsX3RpbWVsaW5lX2NyZWF0ZShndCk7CisJCQl0bCA9IGludGVsX3RpbWVsaW5lX2NyZWF0
ZShndCk7CiAJCQlpZiAoSVNfRVJSKHRsKSkgewogCQkJCWVyciA9IFBUUl9FUlIodGwpOwogCQkJ
CWJyZWFrOwogCQkJfQogCi0JCQlycSA9IHRsX3dyaXRlKHRsLCBlbmdpbmUsIGNvdW50KTsKKwkJ
CXJxID0gY2hlY2tlZF90bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CiAJCQlpZiAoSVNfRVJS
KHJxKSkgewogCQkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gUFRSX0VSUihy
cSk7CkBAIC02MDgsMTQgKzYwNCwxNCBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUo
dm9pZCAqYXJnKQogCQkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkp
CiAJCQkJY29udGludWU7CiAKLQkJCXRsID0gY2hlY2tlZF9pbnRlbF90aW1lbGluZV9jcmVhdGUo
Z3QpOworCQkJdGwgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUoZ3QpOwogCQkJaWYgKElTX0VSUih0
bCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRsKTsKIAkJCQlnb3RvIG91dDsKIAkJCX0KIAogCQkJ
aW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwotCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5l
LCBjb3VudCk7CisJCQlycSA9IGNoZWNrZWRfdGxfd3JpdGUodGwsIGVuZ2luZSwgY291bnQpOwog
CQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJaWYgKElTX0VSUihycSkpIHsKIAkJ
CQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwpAQCAtMTI1OCw2ICsxMjU0LDEwIEBAIHN0YXRpYyBp
bnQgbGl2ZV9od3NwX3JvbGxvdmVyX3VzZXIodm9pZCAqYXJnKQogCQlpZiAoIXRsLT5oYXNfaW5p
dGlhbF9icmVhZGNydW1iKQogCQkJZ290byBvdXQ7CiAKKwkJZXJyID0gaW50ZWxfY29udGV4dF9w
aW4oY2UpOworCQlpZiAoZXJyKQorCQkJZ290byBvdXQ7CisKIAkJdGwtPnNlcW5vID0gLTR1Owog
CQlXUklURV9PTkNFKCoodTMyICopdGwtPmh3c3Bfc2Vxbm8sIHRsLT5zZXFubyk7CiAKQEAgLTEy
NjcsNyArMTI2Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JvbGxvdmVyX3VzZXIodm9pZCAq
YXJnKQogCQkJdGhpcyA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwogCQkJaWYg
KElTX0VSUih0aGlzKSkgewogCQkJCWVyciA9IFBUUl9FUlIodGhpcyk7Ci0JCQkJZ290byBvdXQ7
CisJCQkJZ290byBvdXRfdW5waW47CiAJCQl9CiAKIAkJCXByX2RlYnVnKCIlczogY3JlYXRlIGZl
bmNlLnNlcW5wOiVkXG4iLApAQCAtMTI4NiwxNyArMTI4NiwxOCBAQCBzdGF0aWMgaW50IGxpdmVf
aHdzcF9yb2xsb3Zlcl91c2VyKHZvaWQgKmFyZykKIAkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJx
WzJdLCAwLCBIWiAvIDUpIDwgMCkgewogCQkJcHJfZXJyKCJXYWl0IGZvciB0aW1lbGluZSB3cmFw
IHRpbWVkIG91dCFcbiIpOwogCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gb3V0OworCQkJZ290byBv
dXRfdW5waW47CiAJCX0KIAogCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShycSk7IGkrKykg
ewogCQkJaWYgKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxW2ldKSkgewogCQkJCXByX2Vycigi
UHJlLXdyYXAgcmVxdWVzdCBub3QgY29tcGxldGVkIVxuIik7CiAJCQkJZXJyID0gLUVJTlZBTDsK
LQkJCQlnb3RvIG91dDsKKwkJCQlnb3RvIG91dF91bnBpbjsKIAkJCX0KIAkJfQotCitvdXRfdW5w
aW46CisJCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwogb3V0OgogCQlmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShycSk7IGkrKykKIAkJCWk5MTVfcmVxdWVzdF9wdXQocnFbaV0pOwpAQCAtMTMz
OCwxMyArMTMzOSwxMyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykK
IAkJCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKIAotCQkJdGwgPSBjaGVja2VkX2ludGVsX3RpbWVsaW5lX2NyZWF0ZShndCk7CisJCQl0bCA9
IGludGVsX3RpbWVsaW5lX2NyZWF0ZShndCk7CiAJCQlpZiAoSVNfRVJSKHRsKSkgewogCQkJCWVy
ciA9IFBUUl9FUlIodGwpOwogCQkJCWJyZWFrOwogCQkJfQogCi0JCQlycSA9IHRsX3dyaXRlKHRs
LCBlbmdpbmUsIGNvdW50KTsKKwkJCXJxID0gY2hlY2tlZF90bF93cml0ZSh0bCwgZW5naW5lLCBj
b3VudCk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7
CiAJCQkJZXJyID0gUFRSX0VSUihycSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3NlbGZ0ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgK
aW5kZXggZDUzZDIwN2FiNmViLi5mNTRkZTA0OTliZTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NlbGZ0ZXN0LmgKQEAgLTEwNyw2ICsxMDcsNyBAQCBpbnQgX19pOTE1X3N1YnRlc3RzKGNvbnN0
IGNoYXIgKmNhbGxlciwKIAogI2RlZmluZSBJOTE1X1NFTEZURVNUX0RFQ0xBUkUoeCkgeAogI2Rl
ZmluZSBJOTE1X1NFTEZURVNUX09OTFkoeCkgdW5saWtlbHkoeCkKKyNkZWZpbmUgSTkxNV9TRUxG
VEVTVF9FWFBPUlQKIAogI2Vsc2UgLyogIUlTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZU
RVNUKSAqLwogCkBAIC0xMTYsNiArMTE3LDcgQEAgc3RhdGljIGlubGluZSBpbnQgaTkxNV9wZXJm
X3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikgeyByZXR1cm4gMDsgfQogCiAjZGVmaW5l
IEk5MTVfU0VMRlRFU1RfREVDTEFSRSh4KQogI2RlZmluZSBJOTE1X1NFTEZURVNUX09OTFkoeCkg
MAorI2RlZmluZSBJOTE1X1NFTEZURVNUX0VYUE9SVCBzdGF0aWMKIAogI2VuZGlmCiAKLS0gCjIu
MzEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
