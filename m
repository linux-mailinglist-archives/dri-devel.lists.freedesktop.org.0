Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4F1013809B
	for <lists+dri-devel@lfdr.de>; Fri,  7 Jun 2019 00:28:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 878FB899DC;
	Thu,  6 Jun 2019 22:28:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3C48B899DC
 for <dri-devel@lists.freedesktop.org>; Thu,  6 Jun 2019 22:28:03 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id c26so5581347edt.1
 for <dri-devel@lists.freedesktop.org>; Thu, 06 Jun 2019 15:28:03 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=vQ7V/P5FFnDJXfv1tJb5nKMK43wXWwa030NP+k5b/b8=;
 b=mYXtL0J4zyKsAUqRkqpSMrF80er550Xt0w1mlDEiCAoH8Gs32B+ZOyF1FdH5u5U/ut
 ilGB7I2gckLztJgm4SVAhoYJXEhZeV5x9tfudv9t1PWEaq9smn9ipI4pUUPoJg46J3zf
 1nQsf8eYXJeQXttac3lmDocfAj537/ErWsbY+spwQid7nP/eHrPJpTdG31WO+i5CwLe/
 uJxCk82sZCm9rymxNU23JTFLj7aVItNM8iZk+zXM3JMALBOq9DvI1aWCGu71WwMvcDp4
 N3qqU6AH1LjeBsy/Sscr6jw2UfMZ/sEjF03NTlHbZHpBlgBymr3u0u/LhwaX4k7A09MJ
 cbdQ==
X-Gm-Message-State: APjAAAVhm2Egmfl4QfpDvGfIJLUEWTj5vuz8ZbKBY7dhVFDqeJL7YwME
 yHgg27WVLyEt63DywECbkZ/DtZTIRns=
X-Google-Smtp-Source: APXvYqyrD16GZsSdZ/NZMC/tvezZJs7kY1WmL2Z9cu87PdvgMXKLb0wBZZXxLIAoDOQ/It5zaRZpFg==
X-Received: by 2002:a50:90fa:: with SMTP id d55mr5690118eda.210.1559860081664; 
 Thu, 06 Jun 2019 15:28:01 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id z10sm54228edl.35.2019.06.06.15.28.00
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Thu, 06 Jun 2019 15:28:00 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 01/10] drm/vkms: Fix crc worker races
Date: Fri,  7 Jun 2019 00:27:42 +0200
Message-Id: <20190606222751.32567-2-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190606222751.32567-1-daniel.vetter@ffwll.ch>
References: <20190606222751.32567-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=vQ7V/P5FFnDJXfv1tJb5nKMK43wXWwa030NP+k5b/b8=;
 b=eUqULvArI92+oduO5cgeszXWdEb1c30IwlIwJButpacKENrO21kWq2YSJscOLcEJoY
 ILMX1wDq0YcX3P833JYdpPjWrv8ZZUC9UKvDhH/w8+By9U5Ivt3PElmDJLSGecRdCyI4
 yZ/TSqrhGJ7N+kGVfYzwWhelWAVMuU23rXJQQ=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Haneen Mohammed <hamohammed.sa@gmail.com>,
 Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Shayenne Moura <shayenneluzmoura@gmail.com>,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGlzc3VlIHdlIGhhdmUgaXMgdGhhdCB0aGUgY3JjIHdvcmtlciBtaWdodCBmYWxsIGJlaGlu
ZC4gV2UndmUKdHJpZWQgdG8gaGFuZGxlIHRoaXMgYnkgdHJhY2tpbmcgYm90aCB0aGUgZWFybGll
c3QgZnJhbWUgZm9yIHdoaWNoIGl0CnN0aWxsIG5lZWRzIHRvIGNvbXB1dGUgYSBjcmMsIGFuZCB0
aGUgbGFzdCBvbmUuIFBsdXMgd2hlbiB0aGUKY3J0Y19zdGF0ZSBjaGFuZ2VzLCB3ZSBoYXZlIGEg
bmV3IHdvcmsgaXRlbSwgd2hpY2ggYXJlIGFsbCBydW4gaW4Kb3JkZXIgZHVlIHRvIHRoZSBvcmRl
cmVkIHdvcmtxdWV1ZSB3ZSBhbGxvY2F0ZSBmb3IgZWFjaCB2a21zIGNydGMuCgpUcm91YmxlIGlz
IHRoZXJlJ3MgYmVlbiBhIGZldyBzbWFsbCBpc3N1ZXMgaW4gdGhlIGN1cnJlbnQgY29kZToKLSB3
ZSBuZWVkIHRvIGNhcHR1cmUgZnJhbWVfZW5kIGluIHRoZSB2YmxhbmsgaHJ0aW1lciwgbm90IGlu
IHRoZQogIHdvcmtlci4gVGhlIHdvcmtlciBtaWdodCBydW4gbXVjaCBsYXRlciwgYW5kIHRoZW4g
d2UgZ2VuZXJhdGUgYSBsb3QKICBvZiBjcmMgZm9yIHdoaWNoIHRoZXJlJ3MgYWxyZWFkeSBhIGRp
ZmZlcmVudCB3b3JrZXIgcXVldWVkIHVwLgotIGZyYW1lIG51bWJlciBtaWdodCBiZSAwLCBzbyBj
cmVhdGUgYSBuZXcgY3JjX3BlbmRpbmcgYm9vbGVhbiB0bwogIHRyYWNrIHRoaXMgd2l0aG91dCBj
b25mdXNpb24uCi0gd2UgbmVlZCB0byBhdG9taWNhbGx5IGdyYWIgZnJhbWVfc3RhcnQvZW5kIGFu
ZCBjbGVhciBpdCwgc28gZG8gdGhhdAogIGFsbCBpbiBvbmUgZ28uIFRoaXMgaXMgbm90IGdvaW5n
IHRvIGNyZWF0ZSBhIG5ldyByYWNlLCBiZWNhdXNlIGlmIHdlCiAgcmFjZSB3aXRoIHRoZSBocnRp
bWVyIHRoZW4gb3VyIHdvcmsgd2lsbCBiZSByZS1ydW4uCi0gb25seSByYWNlIHRoYXQgY2FuIGhh
cHBlbiBpcyB0aGUgZm9sbG93aW5nOgogIDEuIHdvcmtlciBzdGFydHMKICAyLiBocnRpbWVyIHJ1
bnMgYW5kIHVwZGF0ZXMgZnJhbWVfZW5kCiAgMy4gd29ya2VyIGdyYWJzIGZyYW1lX3N0YXJ0L2Vu
ZCwgYWxyZWFkeSByZWFkaW5nIHRoZSBuZXcgZnJhbWVfZW5kLAogIGFuZCBjbGVhcnMgY3JjX3Bl
bmRpbmcKICA0LiBocnRpbWVyIGNhbGxzIHF1ZXVlX3dvcmsoKQogIDUuIHdvcmtlciBjb21wbGV0
ZXMKICA2LiB3b3JrZXIgZ2V0cyAgcmUtcnVuLCBjcmNfcGVuZGluZyBpcyBmYWxzZQogIEV4cGxh
aW4gdGhpcyBjYXNlIGEgYml0IGJldHRlciBieSByZXdvcmRpbmcgdGhlIGNvbW1lbnQuCgp2Mjog
RGVtb3RlIHdhcm5pbmcgbGV2ZWwgb3V0cHV0IHRvIGRlYnVnIHdoZW4gd2UgZmFpbCB0byByZXF1
ZXVlLCB0aGlzCmlzIGV4cGVjdGVkIHVuZGVyIGhpZ2ggbG9hZCB3aGVuIHRoZSBjcmMgd29ya2Vy
IGNhbid0IHF1aXRlIGtlZXAgdXAuCgpDYzogU2hheWVubmUgTW91cmEgPHNoYXllbm5lbHV6bW91
cmFAZ21haWwuY29tPgpDYzogUm9kcmlnbyBTaXF1ZWlyYSA8cm9kcmlnb3NpcXVlaXJhbWVsb0Bn
bWFpbC5jb20+ClNpZ25lZC1vZmYtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAaW50
ZWwuY29tPgpDYzogSGFuZWVuIE1vaGFtbWVkIDxoYW1vaGFtbWVkLnNhQGdtYWlsLmNvbT4KQ2M6
IERhbmllbCBWZXR0ZXIgPGRhbmllbEBmZndsbC5jaD4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmtt
cy92a21zX2NyYy5jICB8IDI3ICsrKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL3ZrbXMvdmttc19jcnRjLmMgfCAgOSArKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS92
a21zL3ZrbXNfZHJ2LmggIHwgIDIgKysKIDMgZmlsZXMgY2hhbmdlZCwgMjIgaW5zZXJ0aW9ucygr
KSwgMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmtt
c19jcmMuYyBiL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3JjLmMKaW5kZXggZDdiNDA5YTNj
MGY4Li42NjYwM2RhNjM0ZmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNf
Y3JjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcmMuYwpAQCAtMTY2LDE2ICsx
NjYsMjQgQEAgdm9pZCB2a21zX2NyY193b3JrX2hhbmRsZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndv
cmspCiAJc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7CiAJdTMyIGNyYzMyID0gMDsKIAl1NjQgZnJh
bWVfc3RhcnQsIGZyYW1lX2VuZDsKKwlib29sIGNyY19wZW5kaW5nOwogCXVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmb3V0LT5zdGF0ZV9sb2NrLCBmbGFncyk7CiAJ
ZnJhbWVfc3RhcnQgPSBjcnRjX3N0YXRlLT5mcmFtZV9zdGFydDsKIAlmcmFtZV9lbmQgPSBjcnRj
X3N0YXRlLT5mcmFtZV9lbmQ7CisJY3JjX3BlbmRpbmcgPSBjcnRjX3N0YXRlLT5jcmNfcGVuZGlu
ZzsKKwljcnRjX3N0YXRlLT5mcmFtZV9zdGFydCA9IDA7CisJY3J0Y19zdGF0ZS0+ZnJhbWVfZW5k
ID0gMDsKKwljcnRjX3N0YXRlLT5jcmNfcGVuZGluZyA9IGZhbHNlOwogCXNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJm91dC0+c3RhdGVfbG9jaywgZmxhZ3MpOwogCi0JLyogX3ZibGFua19oYW5kbGUo
KSBoYXNuJ3QgdXBkYXRlZCBmcmFtZV9zdGFydCB5ZXQgKi8KLQlpZiAoIWZyYW1lX3N0YXJ0IHx8
IGZyYW1lX3N0YXJ0ID09IGZyYW1lX2VuZCkKLQkJZ290byBvdXQ7CisJLyoKKwkgKiBXZSByYWNl
ZCB3aXRoIHRoZSB2YmxhbmsgaHJ0aW1lciBhbmQgcHJldmlvdXMgd29yayBhbHJlYWR5IGNvbXB1
dGVkCisJICogdGhlIGNyYywgbm90aGluZyB0byBkby4KKwkgKi8KKwlpZiAoIWNyY19wZW5kaW5n
KQorCQlyZXR1cm47CiAKIAlkcm1fZm9yX2VhY2hfcGxhbmUocGxhbmUsICZ2ZGV2LT5kcm0pIHsK
IAkJc3RydWN0IHZrbXNfcGxhbmVfc3RhdGUgKnZwbGFuZV9zdGF0ZTsKQEAgLTE5NiwyMCArMjA0
LDExIEBAIHZvaWQgdmttc19jcmNfd29ya19oYW5kbGUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCWlmIChwcmltYXJ5X2NyYykKIAkJY3JjMzIgPSBfdmttc19nZXRfY3JjKHByaW1hcnlfY3Jj
LCBjdXJzb3JfY3JjKTsKIAotCWZyYW1lX2VuZCA9IGRybV9jcnRjX2FjY3VyYXRlX3ZibGFua19j
b3VudChjcnRjKTsKLQotCS8qIHF1ZXVlX3dvcmsgY2FuIGZhaWwgdG8gc2NoZWR1bGUgY3JjX3dv
cms7IGFkZCBjcmMgZm9yCi0JICogbWlzc2luZyBmcmFtZXMKKwkvKgorCSAqIFRoZSB3b3JrZXIg
Y2FuIGZhbGwgYmVoaW5kIHRoZSB2YmxhbmsgaHJ0aW1lciwgbWFrZSBzdXJlIHdlIGNhdGNoIHVw
LgogCSAqLwogCXdoaWxlIChmcmFtZV9zdGFydCA8PSBmcmFtZV9lbmQpCiAJCWRybV9jcnRjX2Fk
ZF9jcmNfZW50cnkoY3J0YywgdHJ1ZSwgZnJhbWVfc3RhcnQrKywgJmNyYzMyKTsKLQotb3V0Ogot
CS8qIHRvIGF2b2lkIHVzaW5nIHRoZSBzYW1lIHZhbHVlIGZvciBmcmFtZSBudW1iZXIgYWdhaW4g
Ki8KLQlzcGluX2xvY2tfaXJxc2F2ZSgmb3V0LT5zdGF0ZV9sb2NrLCBmbGFncyk7Ci0JY3J0Y19z
dGF0ZS0+ZnJhbWVfZW5kID0gZnJhbWVfZW5kOwotCWNydGNfc3RhdGUtPmZyYW1lX3N0YXJ0ID0g
MDsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZvdXQtPnN0YXRlX2xvY2ssIGZsYWdzKTsKIH0K
IAogc3RhdGljIGludCB2a21zX2NyY19wYXJzZV9zb3VyY2UoY29uc3QgY2hhciAqc3JjX25hbWUs
IGJvb2wgKmVuYWJsZWQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Ny
dGMuYyBiL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jCmluZGV4IDFiYmUwOTliN2Ri
OC4uYzcyN2Q4NDg2ZTk3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2Ny
dGMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdmttcy92a21zX2NydGMuYwpAQCAtMzAsMTMgKzMw
LDE4IEBAIHN0YXRpYyBlbnVtIGhydGltZXJfcmVzdGFydCB2a21zX3ZibGFua19zaW11bGF0ZShz
dHJ1Y3QgaHJ0aW1lciAqdGltZXIpCiAJCSAqIGhhcyByZWFkIHRoZSBkYXRhCiAJCSAqLwogCQlz
cGluX2xvY2soJm91dHB1dC0+c3RhdGVfbG9jayk7Ci0JCWlmICghc3RhdGUtPmZyYW1lX3N0YXJ0
KQorCQlpZiAoIXN0YXRlLT5jcmNfcGVuZGluZykKIAkJCXN0YXRlLT5mcmFtZV9zdGFydCA9IGZy
YW1lOworCQllbHNlCisJCQlEUk1fREVCVUdfRFJJVkVSKCJjcmMgd29ya2VyIGZhbGxpbmcgYmVo
aW5kLCBmcmFtZV9zdGFydDogJWxsdSwgZnJhbWVfZW5kOiAlbGx1XG4iLAorCQkJCQkgc3RhdGUt
PmZyYW1lX3N0YXJ0LCBmcmFtZSk7CisJCXN0YXRlLT5mcmFtZV9lbmQgPSBmcmFtZTsKKwkJc3Rh
dGUtPmNyY19wZW5kaW5nID0gdHJ1ZTsKIAkJc3Bpbl91bmxvY2soJm91dHB1dC0+c3RhdGVfbG9j
ayk7CiAKIAkJcmV0ID0gcXVldWVfd29yayhvdXRwdXQtPmNyY193b3JrcSwgJnN0YXRlLT5jcmNf
d29yayk7CiAJCWlmICghcmV0KQotCQkJRFJNX1dBUk4oImZhaWxlZCB0byBxdWV1ZSB2a21zX2Ny
Y193b3JrX2hhbmRsZSIpOworCQkJRFJNX0RFQlVHX0RSSVZFUigidmttc19jcmNfd29ya19oYW5k
bGUgYWxyZWFkeSBxdWV1ZWRcbiIpOwogCX0KIAogCXNwaW5fdW5sb2NrKCZvdXRwdXQtPmxvY2sp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaCBiL2RyaXZlcnMv
Z3B1L2RybS92a21zL3ZrbXNfZHJ2LmgKaW5kZXggODFmMWNmYmViOTM2Li4zYzdlMDZiMTllZmQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfZHJ2LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3ZrbXMvdmttc19kcnYuaApAQCAtNTYsNiArNTYsOCBAQCBzdHJ1Y3Qgdmttc19w
bGFuZV9zdGF0ZSB7CiBzdHJ1Y3Qgdmttc19jcnRjX3N0YXRlIHsKIAlzdHJ1Y3QgZHJtX2NydGNf
c3RhdGUgYmFzZTsKIAlzdHJ1Y3Qgd29ya19zdHJ1Y3QgY3JjX3dvcms7CisKKwlib29sIGNyY19w
ZW5kaW5nOwogCXU2NCBmcmFtZV9zdGFydDsKIAl1NjQgZnJhbWVfZW5kOwogfTsKLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
