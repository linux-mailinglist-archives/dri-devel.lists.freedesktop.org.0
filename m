Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 18EB9D9003
	for <lists+dri-devel@lfdr.de>; Wed, 16 Oct 2019 13:52:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3CE326E948;
	Wed, 16 Oct 2019 11:52:12 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFF6E6E944
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Oct 2019 11:52:08 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 743E2C05FF87;
 Wed, 16 Oct 2019 11:52:08 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-43.ams2.redhat.com
 [10.36.116.43])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 0F5CD5D6A9;
 Wed, 16 Oct 2019 11:52:04 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 396BE31E47; Wed, 16 Oct 2019 13:52:04 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 02/11] drm/shmem: switch shmem helper to
 &drm_gem_object_funcs.mmap
Date: Wed, 16 Oct 2019 13:51:54 +0200
Message-Id: <20191016115203.20095-3-kraxel@redhat.com>
In-Reply-To: <20191016115203.20095-1-kraxel@redhat.com>
References: <20191016115203.20095-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.31]); Wed, 16 Oct 2019 11:52:08 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 open list <linux-kernel@vger.kernel.org>, Steven Price <steven.price@arm.com>,
 Gerd Hoffmann <kraxel@redhat.com>, Thomas Zimmermann <tzimmermann@suse.de>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Sean Paul <sean@poorly.run>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3dpdGNoIGdlbSBzaG1lbSBoZWxwZXIgdG8gdGhlIG5ldyBtbWFwKCkgd29ya2Zsb3csCmZyb20g
JmdlbV9kcml2ZXIuZm9wcy5tbWFwIHRvICZkcm1fZ2VtX29iamVjdF9mdW5jcy5tbWFwLgoKdjI6
IEZpeCB2bV9mbGFncyBhbmQgdm1fcGFnZV9wcm90IGhhbmRsaW5nLgoKU2lnbmVkLW9mZi1ieTog
R2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+ClJldmlld2VkLWJ5OiBTdGV2ZW4gUHJp
Y2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgotLS0KIGluY2x1ZGUvZHJtL2RybV9nZW1fc2htZW1f
aGVscGVyLmggICAgICB8ICA2ICsrLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fc2htZW1f
aGVscGVyLmMgIHwgMjggKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5jIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS92M2QvdjNk
X2JvLmMgICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
b2JqZWN0LmMgfCAgMiArLQogNSBmaWxlcyBjaGFuZ2VkLCAxNSBpbnNlcnRpb25zKCspLCAyNSBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtX3NobWVtX2hlbHBl
ci5oIGIvaW5jbHVkZS9kcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIuaAppbmRleCAwMWY1MTQ1MjE2
ODcuLmQ4OWYyMTE2YzhhYiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2dlbV9zaG1lbV9o
ZWxwZXIuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtX3NobWVtX2hlbHBlci5oCkBAIC0xMTEs
NyArMTExLDcgQEAgc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0IHsKIAkJLnBvbGwJCT0gZHJt
X3BvbGwsXAogCQkucmVhZAkJPSBkcm1fcmVhZCxcCiAJCS5sbHNlZWsJCT0gbm9vcF9sbHNlZWss
XAotCQkubW1hcAkJPSBkcm1fZ2VtX3NobWVtX21tYXAsIFwKKwkJLm1tYXAJCT0gZHJtX2dlbV9t
bWFwLCBcCiAJfQogCiBzdHJ1Y3QgZHJtX2dlbV9zaG1lbV9vYmplY3QgKmRybV9nZW1fc2htZW1f
Y3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHNpemVfdCBzaXplKTsKQEAgLTE0Myw5ICsx
NDMsNyBAQCBkcm1fZ2VtX3NobWVtX2NyZWF0ZV93aXRoX2hhbmRsZShzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGVfcHJpdiwKIGludCBkcm1fZ2VtX3NobWVtX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmls
ZSAqZmlsZSwgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAgICAgIHN0cnVjdCBkcm1fbW9k
ZV9jcmVhdGVfZHVtYiAqYXJncyk7CiAKLWludCBkcm1fZ2VtX3NobWVtX21tYXAoc3RydWN0IGZp
bGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKTsKLQotZXh0ZXJuIGNvbnN0IHN0
cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBkcm1fZ2VtX3NobWVtX3ZtX29wczsKK2ludCBkcm1f
Z2VtX3NobWVtX21tYXAoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVjdCB2bV9hcmVh
X3N0cnVjdCAqdm1hKTsKIAogdm9pZCBkcm1fZ2VtX3NobWVtX3ByaW50X2luZm8oc3RydWN0IGRy
bV9wcmludGVyICpwLCB1bnNpZ25lZCBpbnQgaW5kZW50LAogCQkJICAgICAgY29uc3Qgc3RydWN0
IGRybV9nZW1fb2JqZWN0ICpvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9n
ZW1fc2htZW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9zaG1lbV9oZWxwZXIu
YwppbmRleCBmNTkxODcwNzY3MmYuLmE5YTU4NjYzMDUxNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9n
ZW1fc2htZW1faGVscGVyLmMKQEAgLTMyLDcgKzMyLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBk
cm1fZ2VtX29iamVjdF9mdW5jcyBkcm1fZ2VtX3NobWVtX2Z1bmNzID0gewogCS5nZXRfc2dfdGFi
bGUgPSBkcm1fZ2VtX3NobWVtX2dldF9zZ190YWJsZSwKIAkudm1hcCA9IGRybV9nZW1fc2htZW1f
dm1hcCwKIAkudnVubWFwID0gZHJtX2dlbV9zaG1lbV92dW5tYXAsCi0JLnZtX29wcyA9ICZkcm1f
Z2VtX3NobWVtX3ZtX29wcywKKwkubW1hcCA9IGRybV9nZW1fc2htZW1fbW1hcCwKIH07CiAKIC8q
KgpAQCAtNTA1LDM5ICs1MDUsMzAgQEAgc3RhdGljIHZvaWQgZHJtX2dlbV9zaG1lbV92bV9jbG9z
ZShzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKIAlkcm1fZ2VtX3ZtX2Nsb3NlKHZtYSk7CiB9
CiAKLWNvbnN0IHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBkcm1fZ2VtX3NobWVtX3ZtX29w
cyA9IHsKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgdm1fb3BlcmF0aW9uc19zdHJ1Y3QgZHJtX2dlbV9z
aG1lbV92bV9vcHMgPSB7CiAJLmZhdWx0ID0gZHJtX2dlbV9zaG1lbV9mYXVsdCwKIAkub3BlbiA9
IGRybV9nZW1fc2htZW1fdm1fb3BlbiwKIAkuY2xvc2UgPSBkcm1fZ2VtX3NobWVtX3ZtX2Nsb3Nl
LAogfTsKLUVYUE9SVF9TWU1CT0xfR1BMKGRybV9nZW1fc2htZW1fdm1fb3BzKTsKIAogLyoqCiAg
KiBkcm1fZ2VtX3NobWVtX21tYXAgLSBNZW1vcnktbWFwIGEgc2htZW0gR0VNIG9iamVjdAotICog
QGZpbHA6IEZpbGUgb2JqZWN0CisgKiBAb2JqOiBnZW0gb2JqZWN0CiAgKiBAdm1hOiBWTUEgZm9y
IHRoZSBhcmVhIHRvIGJlIG1hcHBlZAogICoKICAqIFRoaXMgZnVuY3Rpb24gaW1wbGVtZW50cyBh
biBhdWdtZW50ZWQgdmVyc2lvbiBvZiB0aGUgR0VNIERSTSBmaWxlIG1tYXAKICAqIG9wZXJhdGlv
biBmb3Igc2htZW0gb2JqZWN0cy4gRHJpdmVycyB3aGljaCBlbXBsb3kgdGhlIHNobWVtIGhlbHBl
cnMgc2hvdWxkCi0gKiB1c2UgdGhpcyBmdW5jdGlvbiBhcyB0aGVpciAmZmlsZV9vcGVyYXRpb25z
Lm1tYXAgaGFuZGxlciBpbiB0aGUgRFJNIGRldmljZSBmaWxlJ3MKLSAqIGZpbGVfb3BlcmF0aW9u
cyBzdHJ1Y3R1cmUuCi0gKgotICogSW5zdGVhZCBvZiBkaXJlY3RseSByZWZlcmVuY2luZyB0aGlz
IGZ1bmN0aW9uLCBkcml2ZXJzIHNob3VsZCB1c2UgdGhlCi0gKiBERUZJTkVfRFJNX0dFTV9TSE1F
TV9GT1BTKCkgbWFjcm8uCisgKiB1c2UgdGhpcyBmdW5jdGlvbiBhcyB0aGVpciAmZHJtX2dlbV9v
YmplY3RfZnVuY3MubW1hcCBoYW5kbGVyLgogICoKICAqIFJldHVybnM6CiAgKiAwIG9uIHN1Y2Nl
c3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KLWludCBkcm1fZ2Vt
X3NobWVtX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1h
KQoraW50IGRybV9nZW1fc2htZW1fbW1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgc3Ry
dWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCiB7CiAJc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0
ICpzaG1lbTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gZHJtX2dlbV9tbWFwKGZpbHAsIHZtYSk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXNobWVtID0gdG9fZHJtX2dlbV9zaG1lbV9vYmoo
dm1hLT52bV9wcml2YXRlX2RhdGEpOworCXNobWVtID0gdG9fZHJtX2dlbV9zaG1lbV9vYmoob2Jq
KTsKIAogCXJldCA9IGRybV9nZW1fc2htZW1fZ2V0X3BhZ2VzKHNobWVtKTsKIAlpZiAocmV0KSB7
CkBAIC01NDUsOSArNTM2LDEwIEBAIGludCBkcm1fZ2VtX3NobWVtX21tYXAoc3RydWN0IGZpbGUg
KmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogCQlyZXR1cm4gcmV0OwogCX0KIAot
CS8qIFZNX1BGTk1BUCB3YXMgc2V0IGJ5IGRybV9nZW1fbW1hcCgpICovCi0Jdm1hLT52bV9mbGFn
cyAmPSB+Vk1fUEZOTUFQOwotCXZtYS0+dm1fZmxhZ3MgfD0gVk1fTUlYRURNQVA7CisJdm1hLT52
bV9mbGFncyB8PSBWTV9JTyB8IFZNX01JWEVETUFQIHwgVk1fRE9OVEVYUEFORCB8IFZNX0RPTlRE
VU1QOworCXZtYS0+dm1fcGFnZV9wcm90ID0gcGdwcm90X3dyaXRlY29tYmluZSh2bV9nZXRfcGFn
ZV9wcm90KHZtYS0+dm1fZmxhZ3MpKTsKKwl2bWEtPnZtX3BhZ2VfcHJvdCA9IHBncHJvdF9kZWNy
eXB0ZWQodm1hLT52bV9wYWdlX3Byb3QpOworCXZtYS0+dm1fb3BzID0gJmRybV9nZW1fc2htZW1f
dm1fb3BzOwogCiAJLyogUmVtb3ZlIHRoZSBmYWtlIG9mZnNldCAqLwogCXZtYS0+dm1fcGdvZmYg
LT0gZHJtX3ZtYV9ub2RlX3N0YXJ0KCZzaG1lbS0+YmFzZS52bWFfbm9kZSk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMKaW5kZXggYWNiMDdmZTA2NTgwLi5kZWNhMGMzMGJi
ZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMKQEAgLTExMiw3ICsx
MTIsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9nZW1fb2JqZWN0X2Z1bmNzIHBhbmZyb3N0
X2dlbV9mdW5jcyA9IHsKIAkuZ2V0X3NnX3RhYmxlID0gZHJtX2dlbV9zaG1lbV9nZXRfc2dfdGFi
bGUsCiAJLnZtYXAgPSBkcm1fZ2VtX3NobWVtX3ZtYXAsCiAJLnZ1bm1hcCA9IGRybV9nZW1fc2ht
ZW1fdnVubWFwLAotCS52bV9vcHMgPSAmZHJtX2dlbV9zaG1lbV92bV9vcHMsCisJLm1tYXAgPSBk
cm1fZ2VtX3NobWVtX21tYXAsCiB9OwogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS92M2QvdjNkX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdjNkL3YzZF9iby5jCmluZGV4IGEyMmI3
NWEzYTUzMy4uZWRkMjk5YWI1M2Q4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdjNkL3Yz
ZF9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92M2QvdjNkX2JvLmMKQEAgLTU4LDcgKzU4LDcg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZ2VtX29iamVjdF9mdW5jcyB2M2RfZ2VtX2Z1bmNz
ID0gewogCS5nZXRfc2dfdGFibGUgPSBkcm1fZ2VtX3NobWVtX2dldF9zZ190YWJsZSwKIAkudm1h
cCA9IGRybV9nZW1fc2htZW1fdm1hcCwKIAkudnVubWFwID0gZHJtX2dlbV9zaG1lbV92dW5tYXAs
Ci0JLnZtX29wcyA9ICZkcm1fZ2VtX3NobWVtX3ZtX29wcywKKwkubW1hcCA9IGRybV9nZW1fc2ht
ZW1fbW1hcCwKIH07CiAKIC8qIGdlbV9jcmVhdGVfb2JqZWN0IGZ1bmN0aW9uIGZvciBhbGxvY2F0
aW5nIGEgQk8gc3RydWN0IGFuZCBkb2luZwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Zp
cnRpby92aXJ0Z3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X29i
amVjdC5jCmluZGV4IDY5YTNkMzEwZmY3MC4uMDE3YTllMGZjM2JiIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X29iamVjdC5jCkBAIC04Niw3ICs4Niw3IEBAIHN0YXRpYyBjb25zdCBz
dHJ1Y3QgZHJtX2dlbV9vYmplY3RfZnVuY3MgdmlydGlvX2dwdV9nZW1fZnVuY3MgPSB7CiAJLmdl
dF9zZ190YWJsZSA9IGRybV9nZW1fc2htZW1fZ2V0X3NnX3RhYmxlLAogCS52bWFwID0gZHJtX2dl
bV9zaG1lbV92bWFwLAogCS52dW5tYXAgPSBkcm1fZ2VtX3NobWVtX3Z1bm1hcCwKLQkudm1fb3Bz
ID0gJmRybV9nZW1fc2htZW1fdm1fb3BzLAorCS5tbWFwID0gJmRybV9nZW1fc2htZW1fbW1hcCwK
IH07CiAKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqdmlydGlvX2dwdV9jcmVhdGVfb2JqZWN0KHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
