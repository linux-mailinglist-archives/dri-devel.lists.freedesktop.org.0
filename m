Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 878862FBB9E
	for <lists+dri-devel@lfdr.de>; Tue, 19 Jan 2021 16:50:58 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E43C06E878;
	Tue, 19 Jan 2021 15:50:53 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM12-DM6-obe.outbound.protection.outlook.com
 (mail-dm6nam12on2083.outbound.protection.outlook.com [40.107.243.83])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F8636E413;
 Tue, 19 Jan 2021 15:50:49 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=E7+LiQg6ARuL6qIkZtx7nBW1WTpjJp0RVtODHA1YvCe/f30ftZwP+4PthQMizjXwiM6lOMM2lfkQw38xJX+4nHbrJGaeeu7dU2Qjo5lllyJf9u8Fxlq1PqSSWBKD5dWqLZUcQHHBYRviKiMwN4Ys1aVDj+J8RfPuqmY3CIIjaeZnWkettaMpuDbqmMI0MFLVSCxPAlWsfYb8kgl4hftOooETwG7nHa5i+BiDifMwb6zX4cepyXlXo0I6XHJ5cWL3xW5HTT6bJWruhGaXTBYlb+Eb+0Oaw9msXz8bngg3SD3DkyGWuv6di7ihUJyYgiiU/hSiZPaEx+AiWevxAh+8AA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2XZNCZOWi71hl9yYHmUih6bY5BX1F+csTw+Xk0D5hdM=;
 b=YWDhms6LvuYJVdAg9TsQXmjR0EjtLfxc4dskbHSMl2ptswrHvzAgC5GE9x+0DA91PfSw4GJbkMKTOe2qycUdxpE2LsyEyFoW45LMt5Y1c21odKmfx6RRIhrQ+2NlWiQc8+wdpqLGcLS0AU356olUq6rJ02UMOXTH5bilBWy4JZ8NyO6JG9WPMz+kluBH7lV6Px8mLRE7mg1PTa8UAe9LDYFYagFSPq9ba87dhyYASlSAh1D2OEuMOWdemLR8BENBouR3AZdwJGUml7kbLwkzDQhH+zN4CRP38TDtb+SNoFCpY2PKETqZCSKiMOhdguE+b2FZWSO+gLduxZ44ALbmsw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=softfail (sender ip
 is 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com; dmarc=fail (p=none sp=none pct=100) action=none
 header.from=amd.com; dkim=none (message not signed); arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=2XZNCZOWi71hl9yYHmUih6bY5BX1F+csTw+Xk0D5hdM=;
 b=bK1wY3gl7rztSnh4G4KE076FkME1ilvdTJi385jI68V/JWqTCM8DHkpoip76cW7ziCfkFFdGWBFwlPzondKtQXKn0xaqJUnHZPPcARJdpmYtvoorIHre/yjHjkLr5HyANoIqol/tz7FnmJywJvRsOihJyQ1Kx4wfIBoo8iXrzoA=
Received: from DM3PR12CA0110.namprd12.prod.outlook.com (2603:10b6:0:55::30) by
 MWHPR12MB1789.namprd12.prod.outlook.com (2603:10b6:300:112::14) with
 Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3763.10; Tue, 19 Jan
 2021 15:50:46 +0000
Received: from DM6NAM11FT038.eop-nam11.prod.protection.outlook.com
 (2603:10b6:0:55:cafe::b1) by DM3PR12CA0110.outlook.office365.com
 (2603:10b6:0:55::30) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3763.9 via Frontend
 Transport; Tue, 19 Jan 2021 15:50:46 +0000
X-MS-Exchange-Authentication-Results: spf=softfail (sender IP is
 165.204.84.17) smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none
 (message not signed) header.d=none;lists.freedesktop.org; dmarc=fail
 action=none header.from=amd.com;
Received-SPF: SoftFail (protection.outlook.com: domain of transitioning
 amd.com discourages use of 165.204.84.17 as permitted sender)
Received: from SATLEXMB01.amd.com (165.204.84.17) by
 DM6NAM11FT038.mail.protection.outlook.com (10.13.173.137) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.3763.12 via Frontend Transport; Tue, 19 Jan 2021 15:50:44 +0000
Received: from SATLEXMB02.amd.com (10.181.40.143) by SATLEXMB01.amd.com
 (10.181.40.142) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Tue, 19 Jan
 2021 09:50:38 -0600
Received: from elite-desk-aura.amd.com (10.180.168.240) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server id 15.1.1979.3 via
 Frontend Transport; Tue, 19 Jan 2021 09:50:36 -0600
From: Aurabindo Pillai <aurabindo.pillai@amd.com>
To: <amd-gfx@lists.freedesktop.org>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH 2/3] drm/amd/display: Add freesync video modes based on
 preferred modes
Date: Tue, 19 Jan 2021 10:50:28 -0500
Message-ID: <20210119155029.18943-3-aurabindo.pillai@amd.com>
X-Mailer: git-send-email 2.30.0
In-Reply-To: <20210119155029.18943-1-aurabindo.pillai@amd.com>
References: <20210119155029.18943-1-aurabindo.pillai@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 0d3bede9-53c3-4f8e-36f1-08d8bc91fb65
X-MS-TrafficTypeDiagnostic: MWHPR12MB1789:
X-Microsoft-Antispam-PRVS: <MWHPR12MB17899ED702BCC84B8B45AEC98BA30@MWHPR12MB1789.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:4502;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: QUmBuXnw3AHTWLccGHtBVOGbl1ejjkzaYKJBcSReSz41LtRTaOo/vKiV2mrqZkUp0F2gI51qrvWtCh3gUyIHJnJPEVQmfCRWunvNxc+ygVqxFbsntMgcx/JVkrFZrCeRxGinGywIEZiv4zCwXgHzyHAv2tyWF1LYpdaiu38G7t8Hl08PkS1yvjja9S7Pi2E27kc2XBrgJ1U46DG783HCkEvhCAgnKHkfq0TV8a1S/RWII1NHxvF+rEPpLwfsDDkSWZVX+VUVGcWpkfaY2MxUYv2Ad8ghCCWUCEC39ePjf2lbPyl2uTDUcth4xBXpgJa8EC4bTl9oC1psIF7c9oxnWm1RnWPhMerCzhuMUV/jOAa0MJ8zLMXqUlyNSlOV+WZv2w1B3LikBBW6IXSHsYPoLLKN1lYcrPfSbvFh5127X8rmtzU5FcTLfTYJ4fPXMPS/QgIIdikHQtgGcxIuv2ahBA==
X-Forefront-Antispam-Report: CIP:165.204.84.17; CTRY:US; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:SATLEXMB01.amd.com; PTR:ErrorRetry; CAT:NONE;
 SFS:(4636009)(136003)(396003)(346002)(376002)(39860400002)(46966006)(70586007)(1076003)(82310400003)(5660300002)(8936002)(186003)(70206006)(54906003)(47076005)(316002)(478600001)(83380400001)(4326008)(6666004)(44832011)(110136005)(7696005)(81166007)(2906002)(86362001)(356005)(2616005)(426003)(36756003)(26005)(336012)(82740400003)(8676002);
 DIR:OUT; SFP:1101; 
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 19 Jan 2021 15:50:44.5939 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 0d3bede9-53c3-4f8e-36f1-08d8bc91fb65
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB01.amd.com]
X-MS-Exchange-CrossTenant-AuthSource: DM6NAM11FT038.eop-nam11.prod.protection.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Anonymous
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: MWHPR12MB1789
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: stylon.wang@amd.com, shashank.sharma@amd.com, thong.thai@amd.com,
 christian.koenig@amd.com, aurabindo.pillai@amd.com, wayne.lin@amd.com,
 alexander.deucher@amd.com, nicholas.kazlauskas@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

W1doeV0KV2hpbGUgcG9zc2libGUgZm9yIHVzZXJzcGFjZSB0byBjcmVhdGUgYW5kIGFkZCBjdXN0
b20gbW9kZSBiYXNlZCBvZmYgdGhlCm9wdGltaXplZCBtb2RlIGZvciB0aGUgY29ubmVjdGVkIGRp
c3BsYXkgd2hpY2ggZGlmZmVycyBvbmx5IGluIGZyb250IHBvcmNoCnRpbWluZywgdGhpcyBwYXRj
aCBzZXQgYWRkcyBhIGxpc3Qgb2YgY29tbW9uIHZpZGVvIG1vZGVzIGluIGFkdmFuY2UuCgpUaGUg
bGlzdCBvZiBjb21tb24gdmlkZW8gcmVmcmVzaCByYXRlcyBpcyBzbWFsbCwgd2VsbCBrbm93biBh
bmQgdGhlIG9wdGltaXplZAptb2RlIGhhcyBzcGVjaWZpYyByZXF1aXJlbWVudHMgdG8gYmUgYWJs
ZSB0byBlbmFibGUgSFcgZnJhbWUgZG91YmxpbmcgYW5kCnRyaXBsaW5nIHNvIGl0IG1ha2VzIG1v
c3Qgc2Vuc2UgdG8gY3JlYXRlIHRoZSBtb2RlcyB0aGF0IHZpZGVvIHBsYXllcnMgd2lsbCBuZWVk
CmluIGFkdmFuY2UuIFRoZSBvcHRpbWl6ZWQgbW9kZSBtYXRjaGVzIHRoZSBwcmVmZXJyZWQgbW9k
ZSByZXNvbHV0aW9uIGJ1dCBoYXMgdGhlCmhpZ2hlc3QgcmVmcmVzaCByYXRlIGF2YWlsYWJsZSB0
byBlbmFibGUgdGhlIGxhcmdlc3QgZnJvbnQgcG9yY2ggZXh0ZW5zaW9uLgoKW0hvd10KRmluZCB0
aGUgb3B0aW1pemVkIG1vZGUgYW5kIHN0b3JlIGl0IG9uIHRoZSBjb25uZWN0b3Igc28gd2UgY2Fu
IGNoZWNrIGl0CmxhdGVyIGR1cmluZyBvdXIgb3B0aW1pemVkIG1vZGVzZXQuCgpQcmVwb3B1bGF0
ZSB0aGUgbW9kZSBsaXN0IHdpdGggYSBsaXN0IG9mIGNvbW1vbiB2aWRlbyBtYWRlcyBiYXNlZCBv
biB0aGUKb3B0aW1pemVkIG1vZGUgKGJ1dCB3aXRoIGEgbG9uZ2VyIGZyb250IHBvcmNoKSBpZiB0
aGUgcGFuZWwgZG9lc24ndCBzdXBwb3J0IGEKdmFyaWFudCBvZiB0aGUgbW9kZSBuYXRpdmVseS4K
ClNpZ25lZC1vZmYtYnk6IEF1cmFiaW5kbyBQaWxsYWkgPGF1cmFiaW5kby5waWxsYWlAYW1kLmNv
bT4KQWNrZWQtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
UmV2aWV3ZWQtYnk6IFNoYXNoYW5rIFNoYXJtYSA8c2hhc2hhbmsuc2hhcm1hQGFtZC5jb20+Ci0t
LQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jIHwgMTcwICsr
KysrKysrKysrKysrKysrKwogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdw
dV9kbS5oIHwgICAyICsKIDIgZmlsZXMgY2hhbmdlZCwgMTcyIGluc2VydGlvbnMoKykKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYwppbmRl
eCAyNDViZDEyODRlNWYuLmFhZWYyZmI1MjhmZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCkBAIC01MTc0LDYgKzUxNzQsNTkgQEAg
c3RhdGljIHZvaWQgZG1fZW5hYmxlX3Blcl9mcmFtZV9jcnRjX21hc3Rlcl9zeW5jKHN0cnVjdCBk
Y19zdGF0ZSAqY29udGV4dCkKIAlzZXRfbWFzdGVyX3N0cmVhbShjb250ZXh0LT5zdHJlYW1zLCBj
b250ZXh0LT5zdHJlYW1fY291bnQpOwogfQogCitzdGF0aWMgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKgorZ2V0X2hpZ2hlc3RfcmVmcmVzaF9yYXRlX21vZGUoc3RydWN0IGFtZGdwdV9kbV9jb25u
ZWN0b3IgKmFjb25uZWN0b3IsCisJCQkgIGJvb2wgdXNlX3Byb2JlZF9tb2RlcykKK3sKKwlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbSwgKm1fcHJlZiA9IE5VTEw7CisJdTE2IGN1cnJlbnRfcmVm
cmVzaCwgaGlnaGVzdF9yZWZyZXNoOworCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3RfaGVhZCA9IHVz
ZV9wcm9iZWRfbW9kZXMgPworCQkJCQkJICAgICZhY29ubmVjdG9yLT5iYXNlLnByb2JlZF9tb2Rl
cyA6CisJCQkJCQkgICAgJmFjb25uZWN0b3ItPmJhc2UubW9kZXM7CisKKwlpZiAoYWNvbm5lY3Rv
ci0+ZnJlZXN5bmNfdmlkX2Jhc2UuY2xvY2sgIT0gMCkKKwkJcmV0dXJuICZhY29ubmVjdG9yLT5m
cmVlc3luY192aWRfYmFzZTsKKworCS8qIEZpbmQgdGhlIHByZWZlcnJlZCBtb2RlICovCisJbGlz
dF9mb3JfZWFjaF9lbnRyeSAobSwgbGlzdF9oZWFkLCBoZWFkKSB7CisJCWlmIChtLT50eXBlICYg
RFJNX01PREVfVFlQRV9QUkVGRVJSRUQpIHsKKwkJCW1fcHJlZiA9IG07CisJCQlicmVhazsKKwkJ
fQorCX0KKworCWlmICghbV9wcmVmKSB7CisJCS8qIFByb2JhYmx5IGFuIEVESUQgd2l0aCBubyBw
cmVmZXJyZWQgbW9kZS4gRmFsbGJhY2sgdG8gZmlyc3QgZW50cnkgKi8KKwkJbV9wcmVmID0gbGlz
dF9maXJzdF9lbnRyeV9vcl9udWxsKAorCQkJJmFjb25uZWN0b3ItPmJhc2UubW9kZXMsIHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlLCBoZWFkKTsKKwkJaWYgKCFtX3ByZWYpIHsKKwkJCURSTV9ERUJV
R19EUklWRVIoIk5vIHByZWZlcnJlZCBtb2RlIGZvdW5kIGluIEVESURcbiIpOworCQkJcmV0dXJu
IE5VTEw7CisJCX0KKwl9CisKKwloaWdoZXN0X3JlZnJlc2ggPSBkcm1fbW9kZV92cmVmcmVzaCht
X3ByZWYpOworCisJLyoKKwkgKiBGaW5kIHRoZSBtb2RlIHdpdGggaGlnaGVzdCByZWZyZXNoIHJh
dGUgd2l0aCBzYW1lIHJlc29sdXRpb24uCisJICogRm9yIHNvbWUgbW9uaXRvcnMsIHByZWZlcnJl
ZCBtb2RlIGlzIG5vdCB0aGUgbW9kZSB3aXRoIGhpZ2hlc3QKKwkgKiBzdXBwb3J0ZWQgcmVmcmVz
aCByYXRlLgorCSAqLworCWxpc3RfZm9yX2VhY2hfZW50cnkgKG0sIGxpc3RfaGVhZCwgaGVhZCkg
eworCQljdXJyZW50X3JlZnJlc2ggID0gZHJtX21vZGVfdnJlZnJlc2gobSk7CisKKwkJaWYgKG0t
PmhkaXNwbGF5ID09IG1fcHJlZi0+aGRpc3BsYXkgJiYKKwkJICAgIG0tPnZkaXNwbGF5ID09IG1f
cHJlZi0+dmRpc3BsYXkgJiYKKwkJICAgIGhpZ2hlc3RfcmVmcmVzaCA8IGN1cnJlbnRfcmVmcmVz
aCkgeworCQkJaGlnaGVzdF9yZWZyZXNoID0gY3VycmVudF9yZWZyZXNoOworCQkJbV9wcmVmID0g
bTsKKwkJfQorCX0KKworCWFjb25uZWN0b3ItPmZyZWVzeW5jX3ZpZF9iYXNlID0gKm1fcHJlZjsK
KwlyZXR1cm4gbV9wcmVmOworfQorCiBzdGF0aWMgc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqCiBj
cmVhdGVfc3RyZWFtX2Zvcl9zaW5rKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICphY29ubmVj
dG9yLAogCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRybV9tb2RlLApA
QCAtNjk5OSw2ICs3MDUyLDEyMiBAQCBzdGF0aWMgdm9pZCBhbWRncHVfZG1fY29ubmVjdG9yX2Rk
Y19nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAl9CiB9CiAKK3N0
YXRpYyBib29sIGlzX2R1cGxpY2F0ZV9tb2RlKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICph
Y29ubmVjdG9yLAorCQkJICAgICAgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCit7CisJ
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm07CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5IChtLCAm
YWNvbm5lY3Rvci0+YmFzZS5wcm9iZWRfbW9kZXMsIGhlYWQpIHsKKwkJaWYgKGRybV9tb2RlX2Vx
dWFsKG0sIG1vZGUpKQorCQkJcmV0dXJuIHRydWU7CisJfQorCisJcmV0dXJuIGZhbHNlOworfQor
CitzdGF0aWMgdWludCBhZGRfZnNfbW9kZXMoc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFj
b25uZWN0b3IsCisJCQkgc3RydWN0IGRldGFpbGVkX2RhdGFfbW9uaXRvcl9yYW5nZSAqcmFuZ2Up
Cit7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm07CisJc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKm5ld19tb2RlOworCXVpbnQgaTsKKwl1aW50MzJfdCBuZXdfbW9kZXNfY291bnQg
PSAwOworCisJLyogU3RhbmRhcmQgRlBTIHZhbHVlcworCSAqCisJICogMjMuOTc2ICAgLSBUVi9O
VFNDCisJICogMjQgCSAgICAtIENpbmVtYQorCSAqIDI1IAkgICAgLSBUVi9QQUwKKwkgKiAyOS45
NyAgICAtIFRWL05UU0MKKwkgKiAzMCAJICAgIC0gVFYvTlRTQworCSAqIDQ4IAkgICAgLSBDaW5l
bWEgSEZSCisJICogNTAgCSAgICAtIFRWL1BBTAorCSAqIDYwIAkgICAgLSBDb21tb25seSB1c2Vk
CisJICogNDgsNzIsOTYgLSBNdWx0aXBsZXMgb2YgMjQKKwkgKi8KKwljb25zdCB1aW50MzJfdCBj
b21tb25fcmF0ZXNbXSA9IHsgMjM5NzYsIDI0MDAwLCAyNTAwMCwgMjk5NzAsIDMwMDAwLAorCQkJ
CQkgNDgwMDAsIDUwMDAwLCA2MDAwMCwgNzIwMDAsIDk2MDAwIH07CisKKwkvKgorCSAqIEZpbmQg
bW9kZSB3aXRoIGhpZ2hlc3QgcmVmcmVzaCByYXRlIHdpdGggdGhlIHNhbWUgcmVzb2x1dGlvbgor
CSAqIGFzIHRoZSBwcmVmZXJyZWQgbW9kZS4gU29tZSBtb25pdG9ycyByZXBvcnQgYSBwcmVmZXJy
ZWQgbW9kZQorCSAqIHdpdGggbG93ZXIgcmVzb2x1dGlvbiB0aGFuIHRoZSBoaWdoZXN0IHJlZnJl
c2ggcmF0ZSBzdXBwb3J0ZWQuCisJICovCisKKwltID0gZ2V0X2hpZ2hlc3RfcmVmcmVzaF9yYXRl
X21vZGUoYWNvbm5lY3RvciwgdHJ1ZSk7CisJaWYgKCFtKQorCQlyZXR1cm4gMDsKKworCWZvciAo
aSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNvbW1vbl9yYXRlcyk7IGkrKykgeworCQl1aW50NjRfdCB0
YXJnZXRfdnRvdGFsLCB0YXJnZXRfdnRvdGFsX2RpZmY7CisJCXVpbnQ2NF90IG51bSwgZGVuOwor
CisJCWlmIChkcm1fbW9kZV92cmVmcmVzaChtKSAqIDEwMDAgPCBjb21tb25fcmF0ZXNbaV0pCisJ
CQljb250aW51ZTsKKworCQlpZiAoY29tbW9uX3JhdGVzW2ldIDwgcmFuZ2UtPm1pbl92ZnJlcSAq
IDEwMDApCisJCQljb250aW51ZTsKKworCQludW0gPSAodW5zaWduZWQgbG9uZyBsb25nKW0tPmNs
b2NrICogMTAwMCAqIDEwMDA7CisJCWRlbiA9IGNvbW1vbl9yYXRlc1tpXSAqICh1bnNpZ25lZCBs
b25nIGxvbmcpbS0+aHRvdGFsOworCQl0YXJnZXRfdnRvdGFsID0gZGl2X3U2NChudW0sIGRlbik7
CisJCXRhcmdldF92dG90YWxfZGlmZiA9IHRhcmdldF92dG90YWwgLSBtLT52dG90YWw7CisKKwkJ
LyogQ2hlY2sgZm9yIGlsbGVnYWwgbW9kZXMgKi8KKwkJaWYgKG0tPnZzeW5jX3N0YXJ0ICsgdGFy
Z2V0X3Z0b3RhbF9kaWZmIDwgbS0+dmRpc3BsYXkgfHwKKwkJICAgIG0tPnZzeW5jX2VuZCArIHRh
cmdldF92dG90YWxfZGlmZiA8IG0tPnZzeW5jX3N0YXJ0IHx8CisJCSAgICBtLT52dG90YWwgKyB0
YXJnZXRfdnRvdGFsX2RpZmYgPCBtLT52c3luY19lbmQpCisJCQljb250aW51ZTsKKworCQluZXdf
bW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0ZShhY29ubmVjdG9yLT5iYXNlLmRldiwgbSk7CisJCWlm
ICghbmV3X21vZGUpCisJCQlnb3RvIG91dDsKKworCQluZXdfbW9kZS0+dnRvdGFsICs9ICh1MTYp
dGFyZ2V0X3Z0b3RhbF9kaWZmOworCQluZXdfbW9kZS0+dnN5bmNfc3RhcnQgKz0gKHUxNil0YXJn
ZXRfdnRvdGFsX2RpZmY7CisJCW5ld19tb2RlLT52c3luY19lbmQgKz0gKHUxNil0YXJnZXRfdnRv
dGFsX2RpZmY7CisJCW5ld19tb2RlLT50eXBlICY9IH5EUk1fTU9ERV9UWVBFX1BSRUZFUlJFRDsK
KwkJbmV3X21vZGUtPnR5cGUgfD0gRFJNX01PREVfVFlQRV9EUklWRVI7CisKKwkJaWYgKCFpc19k
dXBsaWNhdGVfbW9kZShhY29ubmVjdG9yLCBuZXdfbW9kZSkpIHsKKwkJCWRybV9tb2RlX3Byb2Jl
ZF9hZGQoJmFjb25uZWN0b3ItPmJhc2UsIG5ld19tb2RlKTsKKwkJCW5ld19tb2Rlc19jb3VudCAr
PSAxOworCQl9IGVsc2UKKwkJCWRybV9tb2RlX2Rlc3Ryb3koYWNvbm5lY3Rvci0+YmFzZS5kZXYs
IG5ld19tb2RlKTsKKwl9Cisgb3V0OgorCXJldHVybiBuZXdfbW9kZXNfY291bnQ7Cit9CisKK3N0
YXRpYyB2b2lkIGFtZGdwdV9kbV9jb25uZWN0b3JfYWRkX2ZyZWVzeW5jX21vZGVzKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCQkgICBzdHJ1Y3QgZWRpZCAqZWRpZCkKK3sK
Kwl1aW50OF90IGk7CisJc3RydWN0IGRldGFpbGVkX3RpbWluZyAqdGltaW5nOworCXN0cnVjdCBk
ZXRhaWxlZF9ub25fcGl4ZWwgKmRhdGE7CisJc3RydWN0IGRldGFpbGVkX2RhdGFfbW9uaXRvcl9y
YW5nZSAqcmFuZ2U7CisJc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFtZGdwdV9kbV9jb25u
ZWN0b3IgPQorCQl0b19hbWRncHVfZG1fY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwlpZiAoIShh
bWRncHVfZXhwX2ZyZWVzeW5jX3ZpZF9tb2RlICYmIGVkaWQpKQorCQlyZXR1cm47CisKKwlpZiAo
ZWRpZC0+dmVyc2lvbiA9PSAxICYmIGVkaWQtPnJldmlzaW9uID4gMSkgeworCQlmb3IgKGkgPSAw
OyBpIDwgNDsgaSsrKSB7CisJCQl0aW1pbmcgPSAmZWRpZC0+ZGV0YWlsZWRfdGltaW5nc1tpXTsK
KwkJCWRhdGEgPSAmdGltaW5nLT5kYXRhLm90aGVyX2RhdGE7CisJCQlyYW5nZSA9ICZkYXRhLT5k
YXRhLnJhbmdlOworCisJCQkvKiBDaGVjayBpZiBtb25pdG9yIGhhcyBjb250aW51b3VzIGZyZXF1
ZW5jeSBtb2RlICovCisJCQlpZiAoZGF0YS0+dHlwZSA9PSBFRElEX0RFVEFJTF9NT05JVE9SX1JB
TkdFICYmCisJCQkgICAgcmFuZ2UtPm1heF92ZnJlcSAtIHJhbmdlLT5taW5fdmZyZXEgPiAxMCkg
eworCQkJCWFtZGdwdV9kbV9jb25uZWN0b3ItPm51bV9tb2RlcyArPSBhZGRfZnNfbW9kZXMoYW1k
Z3B1X2RtX2Nvbm5lY3RvciwgcmFuZ2UpOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJfQorfQor
CiBzdGF0aWMgaW50IGFtZGdwdV9kbV9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFtZGdw
dV9kbV9jb25uZWN0b3IgPQpAQCAtNzAxNCw2ICs3MTgzLDcgQEAgc3RhdGljIGludCBhbWRncHVf
ZG1fY29ubmVjdG9yX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQog
CX0gZWxzZSB7CiAJCWFtZGdwdV9kbV9jb25uZWN0b3JfZGRjX2dldF9tb2Rlcyhjb25uZWN0b3Is
IGVkaWQpOwogCQlhbWRncHVfZG1fY29ubmVjdG9yX2FkZF9jb21tb25fbW9kZXMoZW5jb2Rlciwg
Y29ubmVjdG9yKTsKKwkJYW1kZ3B1X2RtX2Nvbm5lY3Rvcl9hZGRfZnJlZXN5bmNfbW9kZXMoY29u
bmVjdG9yLCBlZGlkKTsKIAl9CiAJYW1kZ3B1X2RtX2ZiY19pbml0KGNvbm5lY3Rvcik7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2Rt
LmggYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5oCmlu
ZGV4IGM5ZDgyYjllNGQ3ZS4uM2VhODViZTljNTQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmgKQEAgLTQzMiw2ICs0MzIsOCBAQCBz
dHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5lY3RvciB7CiAjZW5kaWYKIAlib29sIGZvcmNlX3l1djQyMF9v
dXRwdXQ7CiAJc3RydWN0IGRzY19wcmVmZXJyZWRfc2V0dGluZ3MgZHNjX3NldHRpbmdzOworCS8q
IENhY2hlZCBkaXNwbGF5IG1vZGVzICovCisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgZnJlZXN5
bmNfdmlkX2Jhc2U7CiB9OwogCiAjZGVmaW5lIHRvX2FtZGdwdV9kbV9jb25uZWN0b3IoeCkgY29u
dGFpbmVyX29mKHgsIHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yLCBiYXNlKQotLSAKMi4zMC4w
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2
ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
