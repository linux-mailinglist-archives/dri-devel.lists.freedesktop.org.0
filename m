Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6CD2D71297
	for <lists+dri-devel@lfdr.de>; Tue, 23 Jul 2019 09:16:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5E1126E046;
	Tue, 23 Jul 2019 07:15:45 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from verein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D104689C99
 for <dri-devel@lists.freedesktop.org>; Mon, 22 Jul 2019 15:11:55 +0000 (UTC)
Received: by verein.lst.de (Postfix, from userid 2005)
 id 8344568BFE; Mon, 22 Jul 2019 17:11:54 +0200 (CEST)
From: Torsten Duwe <duwe@lst.de>
To: Maxime Ripard <maxime.ripard@bootlin.com>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
References: <<20190722150414.9F97668B20@verein.lst.de>>
Subject: [PATCH v3 5/7] drm/bridge: Add Analogix anx6345 support
Message-Id: <20190722151154.8344568BFE@verein.lst.de>
Date: Mon, 22 Jul 2019 17:11:54 +0200 (CEST)
X-Mailman-Approved-At: Tue, 23 Jul 2019 07:14:10 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKVGhlIEFOWDYzNDUgaXMgYW4g
dWx0cmEtbG93IHBvd2VyIERpc3BsYXlQb3dlci9lRFAgdHJhbnNtaXR0ZXIgZGVzaWduZWQKZm9y
IHBvcnRhYmxlIGRldmljZXMuIFRoaXMgZHJpdmVyIGFkZHMgaW5pdGlhbCBzdXBwb3J0IGZvciBS
R0IgdG8gZURQCm1vZGUsIHdpdGhvdXQgSFBEIGFuZCBpbnRlcnJ1cHRzLgoKVGhpcyBpcyBhIGNv
bmZpZ3VyYXRpb24gdXN1YWxseSBzZWVuIGluIGVEUCBhcHBsaWNhdGlvbnMuCgpTaWduZWQtb2Zm
LWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2ls
eSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFpbC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4g
RHV3ZSA8ZHV3ZUBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgv
S2NvbmZpZyAgICAgICAgICAgIHwgIDEyICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9n
aXgvTWFrZWZpbGUgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvYW5hbG9naXgtYW54NjM0NS5jIHwgNzk3ICsrKysrKysrKysrKysrKysrKysrKwogMyBm
aWxlcyBjaGFuZ2VkLCA4MTAgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54NjM0NS5jCgotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnCkBAIC0xLDYgKzEsMTggQEAKICMgU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQorY29uZmlnIERSTV9BTkFMT0dJWF9BTlg2MzQ1CisJ
dHJpc3RhdGUgIkFuYWxvZ2l4IEFOWDYzNDUgYnJpZGdlIgorCXNlbGVjdCBEUk1fQU5BTE9HSVhf
RFAKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwlzZWxlY3QgUkVHTUFQX0kyQworCWhlbHAKKwkg
IEFOWDYzNDUgaXMgYW4gdWx0cmEtbG93IEZ1bGwtSEQgRGlzcGxheVBvcnQvZURQCisJICB0cmFu
c21pdHRlciBkZXNpZ25lZCBmb3IgcG9ydGFibGUgZGV2aWNlcy4gVGhlCisJICBBTlg2MzQ1IHRy
YW5zZm9ybXMgdGhlIExWVFRMIFJHQiBvdXRwdXQgb2YgYW4KKwkgIGFwcGxpY2F0aW9uIHByb2Nl
c3NvciB0byBlRFAgb3IgRGlzcGxheVBvcnQuCisKIGNvbmZpZyBEUk1fQU5BTE9HSVhfQU5YNzhY
WAogCXRyaXN0YXRlICJBbmFsb2dpeCBBTlg3OFhYIGJyaWRnZSIKKwlzZWxlY3QgRFJNX0FOQUxP
R0lYX0RQCiAJc2VsZWN0IERSTV9LTVNfSEVMUEVSCiAJc2VsZWN0IFJFR01BUF9JMkMKIAloZWxw
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvTWFrZWZpbGUKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZQpAQCAtMSw0ICsxLDUgQEAKICMg
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQogYW5hbG9naXhfZHAtb2JqcyA6
PSBhbmFsb2dpeF9kcF9jb3JlLm8gYW5hbG9naXhfZHBfcmVnLm8gYW5hbG9naXgtaTJjLWRwdHgu
bworb2JqLSQoQ09ORklHX0RSTV9BTkFMT0dJWF9BTlg2MzQ1KSArPSBhbmFsb2dpeC1hbng2MzQ1
Lm8KIG9iai0kKENPTkZJR19EUk1fQU5BTE9HSVhfQU5YNzhYWCkgKz0gYW5hbG9naXgtYW54Nzh4
eC5vCiBvYmotJChDT05GSUdfRFJNX0FOQUxPR0lYX0RQKSArPSBhbmFsb2dpeF9kcC5vCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1h
bng2MzQ1LmMKQEAgLTAsMCArMSw3OTMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wLW9ubHkgKi8KKy8qCisgKiBDb3B5cmlnaHQoYykgMjAxNiwgQW5hbG9naXggU2VtaWNv
bmR1Y3Rvci4KKyAqIENvcHlyaWdodChjKSAyMDE3LCBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5QGFv
c2MuaW8+CisgKgorICogQmFzZWQgb24gYW54NzgwOCBkcml2ZXIgb2J0YWluZWQgZnJvbSBjaHJv
bWVvcyB3aXRoIGNvcHlyaWdodDoKKyAqIENvcHlyaWdodChjKSAyMDEzLCBHb29nbGUgSW5jLgor
ICovCisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxsaW51eC9lcnIuaD4KKyNp
bmNsdWRlIDxsaW51eC9ncGlvL2NvbnN1bWVyLmg+CisjaW5jbHVkZSA8bGludXgvaTJjLmg+Cisj
aW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+Cisj
aW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvb2ZfcGxhdGZvcm0uaD4K
KyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9yZWd1bGF0b3IvY29u
c3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9h
dG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jcnRjLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9jcnRjX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHBfaGVscGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9lZGlkLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9vZi5oPgorI2luY2x1ZGUg
PGRybS9kcm1fcGFuZWwuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4KKworI2luY2x1ZGUgImFuYWxvZ2l4LWkyYy1kcHR4Lmgi
CisjaW5jbHVkZSAiYW5hbG9naXgtaTJjLXR4Y29tbW9uLmgiCisKKyNkZWZpbmUgUE9MTF9ERUxB
WQkJNTAwMDAgLyogdXMgKi8KKyNkZWZpbmUgUE9MTF9USU1FT1VUCQk1MDAwMDAwIC8qIHVzICov
CisKKyNkZWZpbmUgSTJDX0lEWF9EUFRYCQkwCisjZGVmaW5lIEkyQ19JRFhfVFhDT00JCTEKKwor
c3RhdGljIGNvbnN0IHU4IGFueDYzNDVfaTJjX2FkZHJlc3Nlc1tdID0geworCVtJMkNfSURYX0RQ
VFhdCT0gQU5BTE9HSVhfSTJDX0RQVFgsCisJW0kyQ19JRFhfVFhDT01dCT0gQU5BTE9HSVhfSTJD
X1RYQ09NTU9OLAorfTsKKyNkZWZpbmUgSTJDX05VTV9BRERSRVNTRVMJQVJSQVlfU0laRShhbng2
MzQ1X2kyY19hZGRyZXNzZXMpCisKK3N0cnVjdCBhbng2MzQ1IHsKKwlzdHJ1Y3QgZHJtX2RwX2F1
eCBhdXg7CisJc3RydWN0IGRybV9icmlkZ2UgYnJpZGdlOworCXN0cnVjdCBpMmNfY2xpZW50ICpj
bGllbnQ7CisJc3RydWN0IGVkaWQgKmVkaWQ7CisJc3RydWN0IGRybV9jb25uZWN0b3IgY29ubmVj
dG9yOworCXN0cnVjdCBkcm1fZHBfbGluayBsaW5rOworCXN0cnVjdCBkcm1fcGFuZWwgKnBhbmVs
OworCXN0cnVjdCByZWd1bGF0b3IgKmR2ZGQxMjsKKwlzdHJ1Y3QgcmVndWxhdG9yICpkdmRkMjU7
CisJc3RydWN0IGdwaW9fZGVzYyAqZ3Bpb2RfcmVzZXQ7CisJc3RydWN0IG11dGV4IGxvY2s7CS8q
IHByb3RlY3QgRURJRCBhY2Nlc3MgKi8KKworCS8qIEkyQyBTbGF2ZSBhZGRyZXNzZXMgb2YgQU5Y
NjM0NSBhcmUgbWFwcGVkIGFzIERQVFggYW5kIFNZUyAqLworCXN0cnVjdCBpMmNfY2xpZW50ICpp
MmNfY2xpZW50c1tJMkNfTlVNX0FERFJFU1NFU107CisJc3RydWN0IHJlZ21hcCAqbWFwW0kyQ19O
VU1fQUREUkVTU0VTXTsKKworCXUxNiBjaGlwaWQ7CisJdTggZHBjZFtEUF9SRUNFSVZFUl9DQVBf
U0laRV07CisKKwlib29sIHBvd2VyZWQ7Cit9OworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBhbng2
MzQ1ICpjb25uZWN0b3JfdG9fYW54NjM0NShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqYykKK3sKKwly
ZXR1cm4gY29udGFpbmVyX29mKGMsIHN0cnVjdCBhbng2MzQ1LCBjb25uZWN0b3IpOworfQorCitz
dGF0aWMgaW5saW5lIHN0cnVjdCBhbng2MzQ1ICpicmlkZ2VfdG9fYW54NjM0NShzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlKQoreworCXJldHVybiBjb250YWluZXJfb2YoYnJpZGdlLCBzdHJ1Y3Qg
YW54NjM0NSwgYnJpZGdlKTsKK30KKworc3RhdGljIGludCBhbng2MzQ1X3NldF9iaXRzKHN0cnVj
dCByZWdtYXAgKm1hcCwgdTggcmVnLCB1OCBtYXNrKQoreworCXJldHVybiByZWdtYXBfdXBkYXRl
X2JpdHMobWFwLCByZWcsIG1hc2ssIG1hc2spOworfQorCitzdGF0aWMgaW50IGFueDYzNDVfY2xl
YXJfYml0cyhzdHJ1Y3QgcmVnbWFwICptYXAsIHU4IHJlZywgdTggbWFzaykKK3sKKwlyZXR1cm4g
cmVnbWFwX3VwZGF0ZV9iaXRzKG1hcCwgcmVnLCBtYXNrLCAwKTsKK30KKworc3RhdGljIHNzaXpl
X3QgYW54NjM0NV9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwKKwkJCQkgICAg
c3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCit7CisJc3RydWN0IGFueDYzNDUgKmFueDYzNDUg
PSBjb250YWluZXJfb2YoYXV4LCBzdHJ1Y3QgYW54NjM0NSwgYXV4KTsKKworCXJldHVybiBhbnhf
ZHBfYXV4X3RyYW5zZmVyKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLCBtc2cpOworfQorCitz
dGF0aWMgaW50IGFueDYzNDVfZHBfbGlua190cmFpbmluZyhzdHJ1Y3QgYW54NjM0NSAqYW54NjM0
NSkKK3sKKwl1bnNpZ25lZCBpbnQgdmFsdWU7CisJdTggZHBfYnc7CisJaW50IGVycjsKKworCWVy
ciA9IGFueDYzNDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sCisJCQkJ
IFNQX1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCQkgU1BfVE9UQUxfUEQpOworCWlmIChlcnIpCisJ
CXJldHVybiBlcnI7CisKKwllcnIgPSBkcm1fZHBfZHBjZF9yZWFkYigmYW54NjM0NS0+YXV4LCBE
UF9NQVhfTElOS19SQVRFLCAmZHBfYncpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOwor
CisJc3dpdGNoIChkcF9idykgeworCWNhc2UgRFBfTElOS19CV18xXzYyOgorCWNhc2UgRFBfTElO
S19CV18yXzc6CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJRFJNX0RFQlVHX0tNUygiRFAgYmFu
ZHdpZHRoICglIzAyeCkgbm90IHN1cHBvcnRlZFxuIiwgZHBfYncpOworCQlyZXR1cm4gLUVJTlZB
TDsKKwl9CisKKwllcnIgPSBhbng2MzQ1X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX1RY
Q09NXSwgU1BfVklEX0NUUkwxX1JFRywKKwkJCSAgICAgICBTUF9WSURFT19NVVRFKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gYW54NjM0NV9jbGVhcl9iaXRzKGFueDYzNDUt
Pm1hcFtJMkNfSURYX1RYQ09NXSwKKwkJCQkgU1BfVklEX0NUUkwxX1JFRywgU1BfVklERU9fRU4p
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBHZXQgRFBDRCBpbmZvICovCisJZXJy
ID0gZHJtX2RwX2RwY2RfcmVhZCgmYW54NjM0NS0+YXV4LCBEUF9EUENEX1JFViwKKwkJCSAgICAg
ICAmYW54NjM0NS0+ZHBjZCwgRFBfUkVDRUlWRVJfQ0FQX1NJWkUpOworCWlmIChlcnIgPCAwKSB7
CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIHJlYWQgRFBDRDogJWRcbiIsIGVycik7CisJCXJldHVy
biBlcnI7CisJfQorCisJLyogQ2xlYXIgY2hhbm5lbCB4IFNFUkRFUyBwb3dlciBkb3duICovCisJ
ZXJyID0gYW54NjM0NV9jbGVhcl9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJ
CSBTUF9EUF9BTkFMT0dfUE9XRVJfRE9XTl9SRUcsIFNQX0NIMF9QRCk7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCS8qIENoZWNrIGxpbmsgY2FwYWJpbGl0aWVzICovCisJZXJyID0gZHJt
X2RwX2xpbmtfcHJvYmUoJmFueDYzNDUtPmF1eCwgJmFueDYzNDUtPmxpbmspOworCWlmIChlcnIg
PCAwKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIHByb2JlIGxpbmsgY2FwYWJpbGl0aWVzOiAl
ZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBQb3dlciB1cCB0aGUgc2luayAq
LworCWVyciA9IGRybV9kcF9saW5rX3Bvd2VyX3VwKCZhbng2MzQ1LT5hdXgsICZhbng2MzQ1LT5s
aW5rKTsKKwlpZiAoZXJyIDwgMCkgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBwb3dlciB1cCBE
aXNwbGF5UG9ydCBsaW5rOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBQ
b3NzaWJseSBlbmFibGUgZG93bnNwcmVhZCBvbiB0aGUgc2luayAqLworCWVyciA9IHJlZ21hcF93
cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJCSAgIFNQX0RQX0RPV05TUFJFQURf
Q1RSTDFfUkVHLCAwKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJaWYgKGFueDYzNDUt
PmRwY2RbRFBfTUFYX0RPV05TUFJFQURdICYgRFBfTUFYX0RPV05TUFJFQURfMF81KSB7CisJCURS
TV9ERUJVRygiRW5hYmxlIGRvd25zcHJlYWQgb24gdGhlIHNpbmtcbiIpOworCQkvKiA0MDAwUFBN
ICovCisJCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJ
CQkgICBTUF9EUF9ET1dOU1BSRUFEX0NUUkwxX1JFRywgOCk7CisJCWlmIChlcnIpCisJCQlyZXR1
cm4gZXJyOworCisJCWVyciA9IGRybV9kcF9kcGNkX3dyaXRlYigmYW54NjM0NS0+YXV4LCBEUF9E
T1dOU1BSRUFEX0NUUkwsCisJCQkJCSBEUF9TUFJFQURfQU1QXzBfNSk7CisJCWlmIChlcnIgPCAw
KQorCQkJcmV0dXJuIGVycjsKKwl9IGVsc2UgeworCQllcnIgPSBkcm1fZHBfZHBjZF93cml0ZWIo
JmFueDYzNDUtPmF1eCwgRFBfRE9XTlNQUkVBRF9DVFJMLCAwKTsKKwkJaWYgKGVyciA8IDApCisJ
CQlyZXR1cm4gZXJyOworCX0KKworCS8qIFNldCB0aGUgbGFuZSBjb3VudCBhbmQgdGhlIGxpbmsg
cmF0ZSBvbiB0aGUgc2luayAqLworCWlmIChkcm1fZHBfZW5oYW5jZWRfZnJhbWVfY2FwKGFueDYz
NDUtPmRwY2QpKQorCQllcnIgPSBhbng2MzQ1X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURY
X0RQVFhdLAorCQkJCSAgICAgICBTUF9EUF9TWVNURU1fQ1RSTF9CQVNFICsgNCwKKwkJCQkgICAg
ICAgU1BfRU5IQU5DRURfTU9ERSk7CisJZWxzZQorCQllcnIgPSBhbng2MzQ1X2NsZWFyX2JpdHMo
YW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkJCSBTUF9EUF9TWVNURU1fQ1RSTF9CQVNF
ICsgNCwKKwkJCQkJIFNQX0VOSEFOQ0VEX01PREUpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7
CisKKwl2YWx1ZSA9IGRybV9kcF9saW5rX3JhdGVfdG9fYndfY29kZShhbng2MzQ1LT5saW5rLnJh
dGUpOworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJ
CSAgIFNQX0RQX01BSU5fTElOS19CV19TRVRfUkVHLCB2YWx1ZSk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRY
XSwKKwkJCSAgIFNQX0RQX0xBTkVfQ09VTlRfU0VUX1JFRywgYW54NjM0NS0+bGluay5udW1fbGFu
ZXMpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBkcm1fZHBfbGlua19jb25m
aWd1cmUoJmFueDYzNDUtPmF1eCwgJmFueDYzNDUtPmxpbmspOworCWlmIChlcnIgPCAwKSB7CisJ
CURSTV9FUlJPUigiRmFpbGVkIHRvIGNvbmZpZ3VyZSBEaXNwbGF5UG9ydCBsaW5rOiAlZFxuIiwg
ZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBTdGFydCB0cmFpbmluZyBvbiB0aGUgc291
cmNlICovCisJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLCBT
UF9EUF9MVF9DVFJMX1JFRywKKwkJCSAgIFNQX0xUX0VOKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4g
ZXJyOworCisJcmV0dXJuIHJlZ21hcF9yZWFkX3BvbGxfdGltZW91dChhbng2MzQ1LT5tYXBbSTJD
X0lEWF9EUFRYXSwKKwkJCQkgICAgICAgU1BfRFBfTFRfQ1RSTF9SRUcsCisJCQkJICAgICAgIHZh
bHVlLCAhKHZhbHVlICYgU1BfRFBfTFRfSU5QUk9HUkVTUyksCisJCQkJICAgICAgIFBPTExfREVM
QVksIFBPTExfVElNRU9VVCk7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV90eF9pbml0aWFsaXph
dGlvbihzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkKK3sKKwlpbnQgZXJyLCBpOworCisJLyogRklY
TUU6IGNvbG9yZGVwdGggaXMgaGFyZGNvZGVkIGZvciBub3cgKi8KKwllcnIgPSByZWdtYXBfd3Jp
dGUoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9WSURfQ1RSTDJfUkVHLAorCQkJICAg
U1BfSU5fQlBDXzZCSVQgPDwgU1BfSU5fQlBDX1NISUZUKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4g
ZXJyOworCisJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLCBT
UF9EUF9QTExfQ1RSTF9SRUcsIDApOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIg
PSByZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLAorCQkJICAgU1BfQU5B
TE9HX0RFQlVHMV9SRUcsIDApOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBy
ZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkgICBTUF9EUF9MSU5L
X0RFQlVHX0NUUkxfUkVHLAorCQkJICAgU1BfTkVXX1BSQlM3IHwgU1BfTV9WSURfREVCVUcpOwor
CWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSByZWdtYXBfd3JpdGUoYW54NjM0NS0+
bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkgICBTUF9EUF9BTkFMT0dfUE9XRVJfRE9XTl9SRUcsIDAp
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBGb3JjZSBIUEQgKi8KKwllcnIgPSBh
bng2MzQ1X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgICAgIFNQ
X0RQX1NZU1RFTV9DVFJMX0JBU0UgKyAzLAorCQkJICAgICAgIFNQX0hQRF9GT1JDRSB8IFNQX0hQ
RF9DVFJMKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9yIChpID0gMDsgaSA8IDQ7
IGkrKykgeworCQkvKiA0IGxhbmVzICovCisJCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5t
YXBbSTJDX0lEWF9EUFRYXSwKKwkJCQkgICBTUF9EUF9MQU5FMF9MVF9DVFJMX1JFRyArIGksIDAp
OworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBSZXNldCBBVVggKi8KKwll
cnIgPSBhbng2MzQ1X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX1RYQ09NXSwKKwkJCSAg
ICAgICBTUF9SRVNFVF9DVFJMMl9SRUcsIFNQX0FVWF9SU1QpOworCWlmIChlcnIpCisJCXJldHVy
biBlcnI7CisKKwlyZXR1cm4gYW54NjM0NV9jbGVhcl9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURY
X1RYQ09NXSwKKwkJCQkgU1BfUkVTRVRfQ1RSTDJfUkVHLCBTUF9BVVhfUlNUKTsKK30KKworc3Rh
dGljIHZvaWQgYW54NjM0NV9wb3dlcm9uKHN0cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCWlu
dCBlcnI7CisKKwkvKiBFbnN1cmUgcmVzZXQgaXMgYXNzZXJ0ZWQgYmVmb3JlIHN0YXJ0aW5nIHBv
d2VyIG9uIHNlcXVlbmNlICovCisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKGFueDYzNDUtPmdw
aW9kX3Jlc2V0LCAxKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisKKwllcnIgPSByZWd1
bGF0b3JfZW5hYmxlKGFueDYzNDUtPmR2ZGQxMik7CisJaWYgKGVycikgeworCQlEUk1fRVJST1Io
IkZhaWxlZCB0byBlbmFibGUgZHZkZDEyIHJlZ3VsYXRvcjogJWRcbiIsCisJCQkgIGVycik7CisJ
CXJldHVybjsKKwl9CisKKwkvKiBUMSAtIGRlbGF5IGJldHdlZW4gVkREMTIgYW5kIFZERDI1IHNo
b3VsZCBiZSAwLTJtcyAqLworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsKKworCWVyciA9IHJl
Z3VsYXRvcl9lbmFibGUoYW54NjM0NS0+ZHZkZDI1KTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJP
UigiRmFpbGVkIHRvIGVuYWJsZSBkdmRkMjUgcmVndWxhdG9yOiAlZFxuIiwKKwkJCSAgZXJyKTsK
KwkJcmV0dXJuOworCX0KKworCS8qIFQyIC0gZGVsYXkgYmV0d2VlbiBSRVNFVE4gYW5kIGFsbCBw
b3dlciByYWlsIHN0YWJsZSwKKwkgKiBzaG91bGQgYmUgMi01bXMKKwkgKi8KKwl1c2xlZXBfcmFu
Z2UoMjAwMCwgNTAwMCk7CisKKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xlZXAoYW54NjM0NS0+Z3Bp
b2RfcmVzZXQsIDApOworCisJLyogUG93ZXIgb24gcmVnaXN0ZXJzIG1vZHVsZSAqLworCWFueDYz
NDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9QT1dFUkRPV05fQ1RS
TF9SRUcsCisJCQkgU1BfSERDUF9QRCB8IFNQX0FVRElPX1BEIHwgU1BfVklERU9fUEQgfCBTUF9M
SU5LX1BEKTsKKwlhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01d
LCBTUF9QT1dFUkRPV05fQ1RSTF9SRUcsCisJCQkgICBTUF9SRUdJU1RFUl9QRCB8IFNQX1RPVEFM
X1BEKTsKKworCWlmIChhbng2MzQ1LT5wYW5lbCkKKwkJZHJtX3BhbmVsX3ByZXBhcmUoYW54NjM0
NS0+cGFuZWwpOworCisJYW54NjM0NS0+cG93ZXJlZCA9IHRydWU7Cit9CisKK3N0YXRpYyB2b2lk
IGFueDYzNDVfcG93ZXJvZmYoc3RydWN0IGFueDYzNDUgKmFueDYzNDUpCit7CisJaW50IGVycjsK
KworCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVlcChhbng2MzQ1LT5ncGlvZF9yZXNldCwgMSk7CisJ
dXNsZWVwX3JhbmdlKDEwMDAsIDIwMDApOworCisJaWYgKGFueDYzNDUtPnBhbmVsKQorCQlkcm1f
cGFuZWxfdW5wcmVwYXJlKGFueDYzNDUtPnBhbmVsKTsKKworCWVyciA9IHJlZ3VsYXRvcl9kaXNh
YmxlKGFueDYzNDUtPmR2ZGQyNSk7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0
byBkaXNhYmxlIGR2ZGQyNSByZWd1bGF0b3I6ICVkXG4iLAorCQkJICBlcnIpOworCQlyZXR1cm47
CisJfQorCisJdXNsZWVwX3JhbmdlKDUwMDAsIDEwMDAwKTsKKworCWVyciA9IHJlZ3VsYXRvcl9k
aXNhYmxlKGFueDYzNDUtPmR2ZGQxMik7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byBkaXNhYmxlIGR2ZGQxMiByZWd1bGF0b3I6ICVkXG4iLAorCQkJICBlcnIpOworCQlyZXR1
cm47CisJfQorCisJdXNsZWVwX3JhbmdlKDEwMDAsIDIwMDApOworCisJYW54NjM0NS0+cG93ZXJl
ZCA9IGZhbHNlOworfQorCitzdGF0aWMgaW50IGFueDYzNDVfc3RhcnQoc3RydWN0IGFueDYzNDUg
KmFueDYzNDUpCit7CisJaW50IGVycjsKKworCWlmICghYW54NjM0NS0+cG93ZXJlZCkKKwkJYW54
NjM0NV9wb3dlcm9uKGFueDYzNDUpOworCisJLyogUG93ZXIgb24gbmVlZGVkIG1vZHVsZXMgKi8K
KwllcnIgPSBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLAor
CQkJCVNQX1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCQlTUF9WSURFT19QRCB8IFNQX0xJTktfUEQp
OworCisJZXJyID0gYW54NjM0NV90eF9pbml0aWFsaXphdGlvbihhbng2MzQ1KTsKKwlpZiAoZXJy
KSB7CisJCURSTV9FUlJPUigiRmFpbGVkIGVEUCB0cmFuc21pdHRlciBpbml0aWFsaXphdGlvbjog
JWRcbiIsIGVycik7CisJCWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7CisJCXJldHVybiBlcnI7
CisJfQorCisJZXJyID0gYW54NjM0NV9kcF9saW5rX3RyYWluaW5nKGFueDYzNDUpOworCWlmIChl
cnIpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgbGluayB0cmFpbmluZzogJWRcbiIsIGVycik7CisJ
CWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7CisJCXJldHVybiBlcnI7CisJfQorCisJLyoKKwkg
KiBUaGlzIGRlbGF5IHNlZW1zIHRvIGhlbHAga2VlcCB0aGUgaGFyZHdhcmUgaW4gYSBnb29kIHN0
YXRlLiBXaXRob3V0CisJICogaXQsIHRoZXJlIGFyZSB0aW1lcyB3aGVyZSBpdCBmYWlscyBzaWxl
bnRseS4KKwkgKi8KKwl1c2xlZXBfcmFuZ2UoMTAwMDAsIDE1MDAwKTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGFueDYzNDVfY29uZmlnX2RwX291dHB1dChzdHJ1Y3QgYW54NjM0NSAq
YW54NjM0NSkKK3sKKwlpbnQgZXJyOworCisJZXJyID0gYW54NjM0NV9jbGVhcl9iaXRzKGFueDYz
NDUtPm1hcFtJMkNfSURYX1RYQ09NXSwgU1BfVklEX0NUUkwxX1JFRywKKwkJCQkgU1BfVklERU9f
TVVURSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qIEVuYWJsZSBEUCBvdXRwdXQg
Ki8KKwllcnIgPSBhbng2MzQ1X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX1RYQ09NXSwg
U1BfVklEX0NUUkwxX1JFRywKKwkJCSAgICAgICBTUF9WSURFT19FTik7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCS8qIEZvcmNlIHN0cmVhbSB2YWxpZCAqLworCXJldHVybiBhbng2MzQ1
X3NldF9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgICAgIFNQX0RQX1NZ
U1RFTV9DVFJMX0JBU0UgKyAzLAorCQkJICAgICAgIFNQX1NUUk1fRk9SQ0UgfCBTUF9TVFJNX0NU
UkwpOworfQorCitzdGF0aWMgaW50IGFueDYzNDVfZ2V0X2Rvd25zdHJlYW1faW5mbyhzdHJ1Y3Qg
YW54NjM0NSAqYW54NjM0NSkKK3sKKwl1OCB2YWx1ZTsKKwlpbnQgZXJyOworCisJZXJyID0gZHJt
X2RwX2RwY2RfcmVhZGIoJmFueDYzNDUtPmF1eCwgRFBfU0lOS19DT1VOVCwgJnZhbHVlKTsKKwlp
ZiAoZXJyIDwgMCkgeworCQlEUk1fRVJST1IoIkdldCBzaW5rIGNvdW50IGZhaWxlZCAlZFxuIiwg
ZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlpZiAoIURQX0dFVF9TSU5LX0NPVU5UKHZhbHVl
KSkgeworCQlEUk1fRVJST1IoIkRvd25zdHJlYW0gZGlzY29ubmVjdGVkXG4iKTsKKwkJcmV0dXJu
IC1FSU87CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9nZXRfbW9k
ZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgYW54NjM0NSAq
YW54NjM0NSA9IGNvbm5lY3Rvcl90b19hbng2MzQ1KGNvbm5lY3Rvcik7CisJaW50IGVyciwgbnVt
X21vZGVzID0gMDsKKwlib29sIHBvd2VyX29mZiA9IGZhbHNlOworCisJbXV0ZXhfbG9jaygmYW54
NjM0NS0+bG9jayk7CisKKwlpZiAoIWFueDYzNDUtPmVkaWQpIHsKKwkJaWYgKCFhbng2MzQ1LT5w
b3dlcmVkKSB7CisJCQlhbng2MzQ1X3Bvd2Vyb24oYW54NjM0NSk7CisJCQlwb3dlcl9vZmYgPSB0
cnVlOworCQl9CisKKwkJZXJyID0gYW54NjM0NV9nZXRfZG93bnN0cmVhbV9pbmZvKGFueDYzNDUp
OworCQlpZiAoZXJyKSB7CisJCQlEUk1fRVJST1IoIkZhaWxlZCB0byBnZXQgZG93bnN0cmVhbSBp
bmZvOiAlZFxuIiwgZXJyKTsKKwkJCWdvdG8gdW5sb2NrOworCQl9CisKKwkJYW54NjM0NS0+ZWRp
ZCA9IGRybV9nZXRfZWRpZChjb25uZWN0b3IsICZhbng2MzQ1LT5hdXguZGRjKTsKKwkJaWYgKCFh
bng2MzQ1LT5lZGlkKQorCQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVhZCBFRElEIGZyb20gcGFu
ZWxcbiIpOworCisJCWVyciA9IGRybV9jb25uZWN0b3JfdXBkYXRlX2VkaWRfcHJvcGVydHkoY29u
bmVjdG9yLAorCQkJCQkJCSBhbng2MzQ1LT5lZGlkKTsKKwkJaWYgKGVycikgeworCQkJRFJNX0VS
Uk9SKCJGYWlsZWQgdG8gdXBkYXRlIEVESUQgcHJvcGVydHk6ICVkXG4iLCBlcnIpOworCQkJZ290
byB1bmxvY2s7CisJCX0KKwl9CisKKwludW1fbW9kZXMgKz0gZHJtX2FkZF9lZGlkX21vZGVzKGNv
bm5lY3RvciwgYW54NjM0NS0+ZWRpZCk7CisKK3VubG9jazoKKwlpZiAocG93ZXJfb2ZmKQorCQlh
bng2MzQ1X3Bvd2Vyb2ZmKGFueDYzNDUpOworCisJbXV0ZXhfdW5sb2NrKCZhbng2MzQ1LT5sb2Nr
KTsKKworCWlmICghbnVtX21vZGVzICYmIGFueDYzNDUtPnBhbmVsKQorCQludW1fbW9kZXMgKz0g
ZHJtX3BhbmVsX2dldF9tb2Rlcyhhbng2MzQ1LT5wYW5lbCk7CisKKwlyZXR1cm4gbnVtX21vZGVz
OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzIGFu
eDYzNDVfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyA9IHsKKwkuZ2V0X21vZGVzID0gYW54NjM0NV9n
ZXRfbW9kZXMsCit9OworCitzdGF0aWMgdm9pZAorYW54NjM0NV9jb25uZWN0b3JfZGVzdHJveShz
dHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2
MzQ1ID0gY29ubmVjdG9yX3RvX2FueDYzNDUoY29ubmVjdG9yKTsKKworCWlmIChhbng2MzQ1LT5w
YW5lbCkKKwkJZHJtX3BhbmVsX2RldGFjaChhbng2MzQ1LT5wYW5lbCk7CisJZHJtX2Nvbm5lY3Rv
cl9jbGVhbnVwKGNvbm5lY3Rvcik7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9mdW5jcyBhbng2MzQ1X2Nvbm5lY3Rvcl9mdW5jcyA9IHsKKwkuZmlsbF9tb2RlcyA9IGRy
bV9oZWxwZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcywKKwkuZGVzdHJveSA9IGFueDYz
NDVfY29ubmVjdG9yX2Rlc3Ryb3ksCisJLnJlc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVj
dG9yX3Jlc2V0LAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJf
Y29ubmVjdG9yX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1f
YXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZGVzdHJveV9zdGF0ZSwKK307CisKK3N0YXRpYyBpbnQg
YW54NjM0NV9icmlkZ2VfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3Ry
dWN0IGFueDYzNDUgKmFueDYzNDUgPSBicmlkZ2VfdG9fYW54NjM0NShicmlkZ2UpOworCWludCBl
cnI7CisKKwlpZiAoIWJyaWRnZS0+ZW5jb2RlcikgeworCQlEUk1fRVJST1IoIlBhcmVudCBlbmNv
ZGVyIG9iamVjdCBub3QgZm91bmQiKTsKKwkJcmV0dXJuIC1FTk9ERVY7CisJfQorCisJLyogUmVn
aXN0ZXIgYXV4IGNoYW5uZWwgKi8KKwlhbng2MzQ1LT5hdXgubmFtZSA9ICJEUC1BVVgiOworCWFu
eDYzNDUtPmF1eC5kZXYgPSAmYW54NjM0NS0+Y2xpZW50LT5kZXY7CisJYW54NjM0NS0+YXV4LnRy
YW5zZmVyID0gYW54NjM0NV9hdXhfdHJhbnNmZXI7CisKKwllcnIgPSBkcm1fZHBfYXV4X3JlZ2lz
dGVyKCZhbng2MzQ1LT5hdXgpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9FUlJPUigiRmFpbGVk
IHRvIHJlZ2lzdGVyIGF1eCBjaGFubmVsOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9
CisKKwllcnIgPSBkcm1fY29ubmVjdG9yX2luaXQoYnJpZGdlLT5kZXYsICZhbng2MzQ1LT5jb25u
ZWN0b3IsCisJCQkJICZhbng2MzQ1X2Nvbm5lY3Rvcl9mdW5jcywKKwkJCQkgRFJNX01PREVfQ09O
TkVDVE9SX2VEUCk7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBpbml0aWFs
aXplIGNvbm5lY3RvcjogJWRcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJZHJtX2Nv
bm5lY3Rvcl9oZWxwZXJfYWRkKCZhbng2MzQ1LT5jb25uZWN0b3IsCisJCQkJICZhbng2MzQ1X2Nv
bm5lY3Rvcl9oZWxwZXJfZnVuY3MpOworCisJZXJyID0gZHJtX2Nvbm5lY3Rvcl9yZWdpc3Rlcigm
YW54NjM0NS0+Y29ubmVjdG9yKTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRv
IHJlZ2lzdGVyIGNvbm5lY3RvcjogJWRcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCisJ
YW54NjM0NS0+Y29ubmVjdG9yLnBvbGxlZCA9IERSTV9DT05ORUNUT1JfUE9MTF9IUEQ7CisKKwll
cnIgPSBkcm1fY29ubmVjdG9yX2F0dGFjaF9lbmNvZGVyKCZhbng2MzQ1LT5jb25uZWN0b3IsCisJ
CQkJCSAgIGJyaWRnZS0+ZW5jb2Rlcik7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byBsaW5rIHVwIGNvbm5lY3RvciB0byBlbmNvZGVyOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJu
IGVycjsKKwl9CisKKwlpZiAoYW54NjM0NS0+cGFuZWwpIHsKKwkJZXJyID0gZHJtX3BhbmVsX2F0
dGFjaChhbng2MzQ1LT5wYW5lbCwgJmFueDYzNDUtPmNvbm5lY3Rvcik7CisJCWlmIChlcnIpIHsK
KwkJCURSTV9FUlJPUigiRmFpbGVkIHRvIGF0dGFjaCBwYW5lbDogJWRcbiIsIGVycik7CisJCQly
ZXR1cm4gZXJyOworCQl9CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBlbnVtIGRybV9t
b2RlX3N0YXR1cworYW54NjM0NV9icmlkZ2VfbW9kZV92YWxpZChzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlLAorCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKK3sKKwlp
ZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwkJcmV0dXJuIE1PREVf
Tk9fSU5URVJMQUNFOworCisJLyogTWF4IDEyMDBwIGF0IDUuNCBHaHosIG9uZSBsYW5lICovCisJ
aWYgKG1vZGUtPmNsb2NrID4gMTU0MDAwKQorCQlyZXR1cm4gTU9ERV9DTE9DS19ISUdIOworCisJ
cmV0dXJuIE1PREVfT0s7Cit9CisKK3N0YXRpYyB2b2lkIGFueDYzNDVfYnJpZGdlX2Rpc2FibGUo
c3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSA9
IGJyaWRnZV90b19hbng2MzQ1KGJyaWRnZSk7CisKKwkvKiBQb3dlciBvZmYgYWxsIG1vZHVsZXMg
ZXhjZXB0IGNvbmZpZ3VyYXRpb24gcmVnaXN0ZXJzIGFjY2VzcyAqLworCWFueDYzNDVfc2V0X2Jp
dHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9QT1dFUkRPV05fQ1RSTF9SRUcsCisJ
CQkgU1BfSERDUF9QRCB8IFNQX0FVRElPX1BEIHwgU1BfVklERU9fUEQgfCBTUF9MSU5LX1BEKTsK
KwlpZiAoYW54NjM0NS0+cGFuZWwpCisJCWRybV9wYW5lbF9kaXNhYmxlKGFueDYzNDUtPnBhbmVs
KTsKKworCWlmIChhbng2MzQ1LT5wb3dlcmVkKQorCQlhbng2MzQ1X3Bvd2Vyb2ZmKGFueDYzNDUp
OworfQorCitzdGF0aWMgdm9pZCBhbng2MzQ1X2JyaWRnZV9lbmFibGUoc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSA9IGJyaWRnZV90b19hbng2
MzQ1KGJyaWRnZSk7CisJaW50IGVycjsKKworCWlmIChhbng2MzQ1LT5wYW5lbCkKKwkJZHJtX3Bh
bmVsX2VuYWJsZShhbng2MzQ1LT5wYW5lbCk7CisKKwllcnIgPSBhbng2MzQ1X3N0YXJ0KGFueDYz
NDUpOworCWlmIChlcnIpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gaW5pdGlhbGl6ZTogJWRc
biIsIGVycik7CisJCXJldHVybjsKKwl9CisKKwllcnIgPSBhbng2MzQ1X2NvbmZpZ19kcF9vdXRw
dXQoYW54NjM0NSk7CisJaWYgKGVycikKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gZW5hYmxlIERQ
IG91dHB1dDogJWRcbiIsIGVycik7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2JyaWRn
ZV9mdW5jcyBhbng2MzQ1X2JyaWRnZV9mdW5jcyA9IHsKKwkuYXR0YWNoID0gYW54NjM0NV9icmlk
Z2VfYXR0YWNoLAorCS5tb2RlX3ZhbGlkID0gYW54NjM0NV9icmlkZ2VfbW9kZV92YWxpZCwKKwku
ZGlzYWJsZSA9IGFueDYzNDVfYnJpZGdlX2Rpc2FibGUsCisJLmVuYWJsZSA9IGFueDYzNDVfYnJp
ZGdlX2VuYWJsZSwKK307CisKK3N0YXRpYyB2b2lkIHVucmVnaXN0ZXJfaTJjX2R1bW15X2NsaWVu
dHMoc3RydWN0IGFueDYzNDUgKmFueDYzNDUpCit7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3Ig
KGkgPSAxOyBpIDwgQVJSQVlfU0laRShhbng2MzQ1LT5pMmNfY2xpZW50cyk7IGkrKykKKwkJaWYg
KGFueDYzNDUtPmkyY19jbGllbnRzW2ldICYmCisJCSAgICBhbng2MzQ1LT5pMmNfY2xpZW50c1tp
XS0+YWRkciAhPSBhbng2MzQ1LT5jbGllbnQtPmFkZHIpCisJCQlpMmNfdW5yZWdpc3Rlcl9kZXZp
Y2UoYW54NjM0NS0+aTJjX2NsaWVudHNbaV0pOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IHJl
Z21hcF9jb25maWcgYW54NjM0NV9yZWdtYXBfY29uZmlnID0geworCS5yZWdfYml0cyA9IDgsCisJ
LnZhbF9iaXRzID0gOCwKKwkubWF4X3JlZ2lzdGVyID0gMHhmZiwKKwkuY2FjaGVfdHlwZSA9IFJF
R0NBQ0hFX05PTkUsCit9OworCitzdGF0aWMgY29uc3QgdTE2IGFueDYzNDVfY2hpcGlkX2xpc3Rb
XSA9IHsKKwkweDYzNDUsCit9OworCitzdGF0aWMgYm9vbCBhbng2MzQ1X2dldF9jaGlwX2lkKHN0
cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCXVuc2lnbmVkIGludCBpLCBpZGwsIGlkaCwgdmVy
c2lvbjsKKworCWlmIChyZWdtYXBfcmVhZChhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQ
X0RFVklDRV9JRExfUkVHLCAmaWRsKSkKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKHJlZ21hcF9y
ZWFkKGFueDYzNDUtPm1hcFtJMkNfSURYX1RYQ09NXSwgU1BfREVWSUNFX0lESF9SRUcsICZpZGgp
KQorCQlyZXR1cm4gZmFsc2U7CisKKwlhbng2MzQ1LT5jaGlwaWQgPSAodTgpaWRsIHwgKCh1OClp
ZGggPDwgOCk7CisKKwlpZiAocmVnbWFwX3JlYWQoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01d
LCBTUF9ERVZJQ0VfVkVSU0lPTl9SRUcsCisJCQkmdmVyc2lvbikpCisJCXJldHVybiBmYWxzZTsK
KworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGFueDYzNDVfY2hpcGlkX2xpc3QpOyBpKysp
IHsKKwkJaWYgKGFueDYzNDUtPmNoaXBpZCA9PSBhbng2MzQ1X2NoaXBpZF9saXN0W2ldKSB7CisJ
CQlEUk1fSU5GTygiRm91bmQgQU5YJXggKHZlci4gJWQpIGVEUCBUcmFuc21pdHRlclxuIiwKKwkJ
CQkgYW54NjM0NS0+Y2hpcGlkLCB2ZXJzaW9uKTsKKwkJCXJldHVybiB0cnVlOworCQl9CisJfQor
CisJRFJNX0VSUk9SKCJBTlgleCAodmVyLiAlZCkgbm90IHN1cHBvcnRlZCBieSB0aGlzIGRyaXZl
clxuIiwKKwkJICBhbng2MzQ1LT5jaGlwaWQsIHZlcnNpb24pOworCisJcmV0dXJuIGZhbHNlOwor
fQorCitzdGF0aWMgaW50IGFueDYzNDVfaTJjX3Byb2JlKHN0cnVjdCBpMmNfY2xpZW50ICpjbGll
bnQsCisJCQkgICAgIGNvbnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkICppZCkKK3sKKwlzdHJ1Y3Qg
YW54NjM0NSAqYW54NjM0NTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJaW50IGksIGVycjsKKwor
CWFueDYzNDUgPSBkZXZtX2t6YWxsb2MoJmNsaWVudC0+ZGV2LCBzaXplb2YoKmFueDYzNDUpLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIWFueDYzNDUpCisJCXJldHVybiAtRU5PTUVNOworCisJbXV0ZXhf
aW5pdCgmYW54NjM0NS0+bG9jayk7CisKKwlhbng2MzQ1LT5icmlkZ2Uub2Zfbm9kZSA9IGNsaWVu
dC0+ZGV2Lm9mX25vZGU7CisKKwlhbng2MzQ1LT5jbGllbnQgPSBjbGllbnQ7CisJaTJjX3NldF9j
bGllbnRkYXRhKGNsaWVudCwgYW54NjM0NSk7CisKKwlkZXYgPSAmYW54NjM0NS0+Y2xpZW50LT5k
ZXY7CisKKwllcnIgPSBkcm1fb2ZfZmluZF9wYW5lbF9vcl9icmlkZ2UoY2xpZW50LT5kZXYub2Zf
bm9kZSwgMSwgMCwKKwkJCQkJICAmYW54NjM0NS0+cGFuZWwsIE5VTEwpOworCWlmIChlcnIgPT0g
LUVQUk9CRV9ERUZFUikKKwkJcmV0dXJuIGVycjsKKworCWlmIChlcnIpCisJCURSTV9ERUJVRygi
Tm8gcGFuZWwgZm91bmRcbiIpOworCisJLyogMS4yViBkaWdpdGFsIGNvcmUgcG93ZXIgcmVndWxh
dG9yICAqLworCWFueDYzNDUtPmR2ZGQxMiA9IGRldm1fcmVndWxhdG9yX2dldChkZXYsICJkdmRk
MTItc3VwcGx5Iik7CisJaWYgKElTX0VSUihhbng2MzQ1LT5kdmRkMTIpKSB7CisJCURSTV9FUlJP
UigiZHZkZDEyLXN1cHBseSBub3QgZm91bmRcbiIpOworCQlyZXR1cm4gUFRSX0VSUihhbng2MzQ1
LT5kdmRkMTIpOworCX0KKworCS8qIDIuNVYgZGlnaXRhbCBjb3JlIHBvd2VyIHJlZ3VsYXRvciAg
Ki8KKwlhbng2MzQ1LT5kdmRkMjUgPSBkZXZtX3JlZ3VsYXRvcl9nZXQoZGV2LCAiZHZkZDI1LXN1
cHBseSIpOworCWlmIChJU19FUlIoYW54NjM0NS0+ZHZkZDI1KSkgeworCQlEUk1fRVJST1IoImR2
ZGQyNS1zdXBwbHkgbm90IGZvdW5kXG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIoYW54NjM0NS0+ZHZk
ZDI1KTsKKwl9CisKKwkvKiBHUElPIGZvciBjaGlwIHJlc2V0ICovCisJYW54NjM0NS0+Z3Bpb2Rf
cmVzZXQgPSBkZXZtX2dwaW9kX2dldChkZXYsICJyZXNldCIsIEdQSU9EX09VVF9MT1cpOworCWlm
IChJU19FUlIoYW54NjM0NS0+Z3Bpb2RfcmVzZXQpKSB7CisJCURSTV9FUlJPUigiUmVzZXQgZ3Bp
byBub3QgZm91bmRcbiIpOworCQlyZXR1cm4gUFRSX0VSUihhbng2MzQ1LT5ncGlvZF9yZXNldCk7
CisJfQorCisJLyogTWFwIHNsYXZlIGFkZHJlc3NlcyBvZiBBTlg2MzQ1ICovCisJZm9yIChpID0g
MDsgaSA8IEkyQ19OVU1fQUREUkVTU0VTOyBpKyspIHsKKwkJaWYgKGFueDYzNDVfaTJjX2FkZHJl
c3Nlc1tpXSA+PiAxICE9IGNsaWVudC0+YWRkcikKKwkJCWFueDYzNDUtPmkyY19jbGllbnRzW2ld
ID0gaTJjX25ld19kdW1teShjbGllbnQtPmFkYXB0ZXIsCisJCQkJCQlhbng2MzQ1X2kyY19hZGRy
ZXNzZXNbaV0gPj4gMSk7CisJCWVsc2UKKwkJCWFueDYzNDUtPmkyY19jbGllbnRzW2ldID0gY2xp
ZW50OworCisJCWlmICghYW54NjM0NS0+aTJjX2NsaWVudHNbaV0pIHsKKwkJCWVyciA9IC1FTk9N
RU07CisJCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZXNlcnZlIEkyQyBidXMgJTAyeFxuIiwKKwkJ
CQkgIGFueDYzNDVfaTJjX2FkZHJlc3Nlc1tpXSk7CisJCQlnb3RvIGVycl91bnJlZ2lzdGVyX2ky
YzsKKwkJfQorCisJCWFueDYzNDUtPm1hcFtpXSA9IGRldm1fcmVnbWFwX2luaXRfaTJjKGFueDYz
NDUtPmkyY19jbGllbnRzW2ldLAorCQkJCQkJICAgICAgICZhbng2MzQ1X3JlZ21hcF9jb25maWcp
OworCQlpZiAoSVNfRVJSKGFueDYzNDUtPm1hcFtpXSkpIHsKKwkJCWVyciA9IFBUUl9FUlIoYW54
NjM0NS0+bWFwW2ldKTsKKwkJCURSTV9FUlJPUigiRmFpbGVkIHJlZ21hcCBpbml0aWFsaXphdGlv
biAlMDJ4XG4iLAorCQkJCSAgYW54NjM0NV9pMmNfYWRkcmVzc2VzW2ldKTsKKwkJCWdvdG8gZXJy
X3VucmVnaXN0ZXJfaTJjOworCQl9CisJfQorCisJLyogTG9vayBmb3Igc3VwcG9ydGVkIGNoaXAg
SUQgKi8KKwlhbng2MzQ1X3Bvd2Vyb24oYW54NjM0NSk7CisJaWYgKGFueDYzNDVfZ2V0X2NoaXBf
aWQoYW54NjM0NSkpIHsKKwkJYW54NjM0NS0+YnJpZGdlLmZ1bmNzID0gJmFueDYzNDVfYnJpZGdl
X2Z1bmNzOworCQlkcm1fYnJpZGdlX2FkZCgmYW54NjM0NS0+YnJpZGdlKTsKKworCQlyZXR1cm4g
MDsKKwl9IGVsc2UgeworCQlhbng2MzQ1X3Bvd2Vyb2ZmKGFueDYzNDUpOworCQllcnIgPSAtRU5P
REVWOworCX0KKworZXJyX3VucmVnaXN0ZXJfaTJjOgorCXVucmVnaXN0ZXJfaTJjX2R1bW15X2Ns
aWVudHMoYW54NjM0NSk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBhbng2MzQ1X2ky
Y19yZW1vdmUoc3RydWN0IGkyY19jbGllbnQgKmNsaWVudCkKK3sKKwlzdHJ1Y3QgYW54NjM0NSAq
YW54NjM0NSA9IGkyY19nZXRfY2xpZW50ZGF0YShjbGllbnQpOworCisJZHJtX2JyaWRnZV9yZW1v
dmUoJmFueDYzNDUtPmJyaWRnZSk7CisKKwl1bnJlZ2lzdGVyX2kyY19kdW1teV9jbGllbnRzKGFu
eDYzNDUpOworCisJa2ZyZWUoYW54NjM0NS0+ZWRpZCk7CisKKwltdXRleF9kZXN0cm95KCZhbng2
MzQ1LT5sb2NrKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGkyY19k
ZXZpY2VfaWQgYW54NjM0NV9pZFtdID0geworCXsgImFueDYzNDUiLCAwIH0sCisJeyAvKiBzZW50
aW5lbCAqLyB9Cit9OworTU9EVUxFX0RFVklDRV9UQUJMRShpMmMsIGFueDYzNDVfaWQpOworCitz
dGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBhbng2MzQ1X21hdGNoX3RhYmxlW10gPSB7
CisJeyAuY29tcGF0aWJsZSA9ICJhbmFsb2dpeCxhbng2MzQ1IiwgfSwKKwl7IC8qIHNlbnRpbmVs
ICovIH0sCit9OworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgYW54NjM0NV9tYXRjaF90YWJsZSk7
CisKK3N0YXRpYyBzdHJ1Y3QgaTJjX2RyaXZlciBhbng2MzQ1X2RyaXZlciA9IHsKKwkuZHJpdmVy
ID0geworCQkgICAubmFtZSA9ICJhbng2MzQ1IiwKKwkJICAgLm9mX21hdGNoX3RhYmxlID0gb2Zf
bWF0Y2hfcHRyKGFueDYzNDVfbWF0Y2hfdGFibGUpLAorCQkgIH0sCisJLnByb2JlID0gYW54NjM0
NV9pMmNfcHJvYmUsCisJLnJlbW92ZSA9IGFueDYzNDVfaTJjX3JlbW92ZSwKKwkuaWRfdGFibGUg
PSBhbng2MzQ1X2lkLAorfTsKK21vZHVsZV9pMmNfZHJpdmVyKGFueDYzNDVfZHJpdmVyKTsKKwor
TU9EVUxFX0RFU0NSSVBUSU9OKCJBTlg2MzQ1IGVEUCBUcmFuc21pdHRlciBkcml2ZXIiKTsKK01P
RFVMRV9BVVRIT1IoIkVucmljIEJhbGxldGJvIGkgU2VycmEgPGVucmljLmJhbGxldGJvQGNvbGxh
Ym9yYS5jb20+Iik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7Cl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
