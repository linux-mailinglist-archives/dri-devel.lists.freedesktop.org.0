Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 70F442C249
	for <lists+dri-devel@lfdr.de>; Tue, 28 May 2019 11:04:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B53866E0B4;
	Tue, 28 May 2019 09:03:50 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 370A889E9E
 for <dri-devel@lists.freedesktop.org>; Tue, 28 May 2019 09:03:39 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id s19so2499635edq.7
 for <dri-devel@lists.freedesktop.org>; Tue, 28 May 2019 02:03:39 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=eHI5IVXk6rbiogxAf4+pmXRYOJ0Nr3KoY/dH7aae4Ec=;
 b=Ok/zgFwRutFV6GSPopKOW/wk9yMRBJI1EdBFbJIUUZdLraVxvp01130rrUZgFFMNFr
 IPmKdjFTm3OUDP65RvpGi1ifOemyPWTPniaPp54mkVyMWqHRM025/YXHolIVSu1hqYYd
 6M/NRl6tKVDfoZlXlDnAasMtzBQdmb2o4ObKcRJHsjhQRKGqWxqteXqF56TF+7I8O/tD
 yWAx1N5PWrFTLwqEqpeGM+0vTzpEjorqOW9E+ZFefT965kSyBEcpPmfcpxUWJS3QVYiO
 AvRV0uFSX9lu72u/SNk80c1ZkMCGBdhbD3xO+Zi+3w8GWWPyGc/vudjkmqnOVTf8xQJz
 4gUA==
X-Gm-Message-State: APjAAAXSwpVQAGH+qXo/NT5ZeMkGSqOmdse/9aNg3/65x3eC9eb+JBjg
 6KzMQsMmoG+wxBs0xd4jylYS4g==
X-Google-Smtp-Source: APXvYqxugSDC57A7rPd1r24SAQm6AVxtazuuZ58on72+1pvHZZEIZnYLrALq7Zz4fkvM/USoATjllw==
X-Received: by 2002:aa7:d6d3:: with SMTP id x19mr127434171edr.67.1559034217704; 
 Tue, 28 May 2019 02:03:37 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id x49sm4072656edm.25.2019.05.28.02.03.36
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Tue, 28 May 2019 02:03:37 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH 18/33] fbdev: make unregister/unlink functions not fail
Date: Tue, 28 May 2019 11:02:49 +0200
Message-Id: <20190528090304.9388-19-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528090304.9388-1-daniel.vetter@ffwll.ch>
References: <20190528090304.9388-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=eHI5IVXk6rbiogxAf4+pmXRYOJ0Nr3KoY/dH7aae4Ec=;
 b=Ibl6oEES5fVamIiSNWf16iUWxfJctOaeOQ5rpCQdNoJugNugOKwDZ1MekFe5TE2l8z
 XhRPIQH4qsuRcK75/K3tWSWDApqhZxftrVa6ChZqf+TY0Yzecg3SvB+F5l2KyJ+dHG2S
 HAOJPMxwQWK9Kp7/OsiRluCDPlH0dhRu2M4XM=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Thompson <daniel.thompson@linaro.org>,
 Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 linux-fbdev@vger.kernel.org, DRI Development <dri-devel@lists.freedesktop.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Hans de Goede <hdegoede@redhat.com>, Mikulas Patocka <mpatocka@redhat.com>,
 Daniel Vetter <daniel.vetter@intel.com>, Sam Ravnborg <sam@ravnborg.org>,
 Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXhjZXB0IGZvciBkcml2ZXIgYnVncyAod2hpY2ggd2UnbGwgY2F0Y2ggd2l0aCBhIFdBUk5fT04p
IHRoaXMgaXMgb25seQp0byByZXBvcnQgZmFpbHVyZXMgb2YgdGhlIG5ldyBkcml2ZXIgdGFraW5n
IG92ZXIgdGhlIGNvbnNvbGUuIFRoZXJlJ3MKbm90aGluZyB0aGUgb3V0Z29pbmcgZHJpdmVyIGNh
biBkbyBhYm91dCB0aGF0LCBhbmQgbm8gb25lIGV2ZXIKYm90aGVyZWQgdG8gYWN0dWFsbHkgbG9v
ayBhdCB0aGVzZSByZXR1cm4gdmFsdWVzLiBTbyByZW1vdmUgdGhlbSBhbGwuCgp2MjogZml4dXAg
dW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlciBpbiBzYXZhZ2VmYiwgZmJ0ZnQsIGl2dHZmYiwgYW5kIG5l
b2ZiCmRyaXZlcnMsIHJlcG9ydGVkIGJ5IGtidWlsZC4KClNpZ25lZC1vZmYtYnk6IERhbmllbCBW
ZXR0ZXIgPGRhbmllbC52ZXR0ZXJAaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogU2FtIFJhdm5ib3Jn
IDxzYW1AcmF2bmJvcmcub3JnPgpSZXZpZXdlZC1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0
ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KQ2M6IEJhcnRsb21pZWogWm9sbmllcmtpZXdp
Y3ogPGIuem9sbmllcmtpZUBzYW1zdW5nLmNvbT4KQ2M6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52
ZXR0ZXJAZmZ3bGwuY2g+CkNjOiAiTWljaGHFgiBNaXJvc8WCYXciIDxtaXJxLWxpbnV4QHJlcmUu
cW1xbS5wbD4KQ2M6IFBldGVyIFJvc2luIDxwZWRhQGF4ZW50aWEuc2U+CkNjOiBIYW5zIGRlIEdv
ZWRlIDxoZGVnb2VkZUByZWRoYXQuY29tPgpDYzogTWlrdWxhcyBQYXRvY2thIDxtcGF0b2NrYUBy
ZWRoYXQuY29tPgpDYzogbGludXgtZmJkZXZAdmdlci5rZXJuZWwub3JnCi0tLQogZHJpdmVycy9t
ZWRpYS9wY2kvaXZ0di9pdnR2ZmIuYyAgICAgICAgICAgICAgfCAgNiArLQogZHJpdmVycy9zdGFn
aW5nL2ZidGZ0L2ZidGZ0LWNvcmUuYyAgICAgICAgICAgfCAgNCArLQogZHJpdmVycy92aWRlby9m
YmRldi9jb3JlL2ZibWVtLmMgICAgICAgICAgICAgfCA3MyArKysrKystLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy92aWRlby9mYmRldi9uZW9mYi5jICAgICAgICAgICAgICAgICAgfCAgOSArLS0KIGRy
aXZlcnMvdmlkZW8vZmJkZXYvc2F2YWdlL3NhdmFnZWZiX2RyaXZlci5jIHwgIDkgKy0tCiBpbmNs
dWRlL2xpbnV4L2ZiLmggICAgICAgICAgICAgICAgICAgICAgICAgICB8ICA0ICstCiA2IGZpbGVz
IGNoYW5nZWQsIDMxIGluc2VydGlvbnMoKyksIDc0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvbWVkaWEvcGNpL2l2dHYvaXZ0dmZiLmMgYi9kcml2ZXJzL21lZGlhL3BjaS9pdnR2
L2l2dHZmYi5jCmluZGV4IGNmZDIxMDQwZDBlMy4uNjQzNWM3MmZmNThlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL21lZGlhL3BjaS9pdnR2L2l2dHZmYi5jCisrKyBiL2RyaXZlcnMvbWVkaWEvcGNpL2l2
dHYvaXZ0dmZiLmMKQEAgLTEyNTgsMTEgKzEyNTgsNyBAQCBzdGF0aWMgaW50IGl2dHZmYl9jYWxs
YmFja19jbGVhbnVwKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqcCkKIAlzdHJ1Y3Qgb3NkX2lu
Zm8gKm9pID0gaXR2LT5vc2RfaW5mbzsKIAogCWlmIChpdHYtPnY0bDJfY2FwICYgVjRMMl9DQVBf
VklERU9fT1VUUFVUKSB7Ci0JCWlmICh1bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKCZpdHYtPm9zZF9p
bmZvLT5pdnR2ZmJfaW5mbykpIHsKLQkJCUlWVFZGQl9XQVJOKCJGcmFtZWJ1ZmZlciAlZCBpcyBp
biB1c2UsIGNhbm5vdCB1bmxvYWRcbiIsCi0JCQkJICAgICAgIGl0di0+aW5zdGFuY2UpOwotCQkJ
cmV0dXJuIDA7Ci0JCX0KKwkJdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcigmaXR2LT5vc2RfaW5mby0+
aXZ0dmZiX2luZm8pOwogCQlJVlRWRkJfSU5GTygiVW5yZWdpc3RlciBmcmFtZWJ1ZmZlciAlZFxu
IiwgaXR2LT5pbnN0YW5jZSk7CiAJCWl0di0+aXZ0dmZiX3Jlc3RvcmUgPSBOVUxMOwogCQlpdnR2
ZmJfYmxhbmsoRkJfQkxBTktfVlNZTkNfU1VTUEVORCwgJm9pLT5pdnR2ZmJfaW5mbyk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL3N0YWdpbmcvZmJ0ZnQvZmJ0ZnQtY29yZS5jIGIvZHJpdmVycy9zdGFn
aW5nL2ZidGZ0L2ZidGZ0LWNvcmUuYwppbmRleCA5YjA3YmFkZjRjNmMuLjdjYmMxYmRkMmQ4YSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL2ZidGZ0L2ZidGZ0LWNvcmUuYworKysgYi9kcml2
ZXJzL3N0YWdpbmcvZmJ0ZnQvZmJ0ZnQtY29yZS5jCkBAIC04OTEsNyArODkxLDkgQEAgaW50IGZi
dGZ0X3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pCiAJaWYg
KHBhci0+ZmJ0ZnRvcHMudW5yZWdpc3Rlcl9iYWNrbGlnaHQpCiAJCXBhci0+ZmJ0ZnRvcHMudW5y
ZWdpc3Rlcl9iYWNrbGlnaHQocGFyKTsKIAlmYnRmdF9zeXNmc19leGl0KHBhcik7Ci0JcmV0dXJu
IHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoZmJfaW5mbyk7CisJdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZl
cihmYl9pbmZvKTsKKworCXJldHVybiAwOwogfQogRVhQT1JUX1NZTUJPTChmYnRmdF91bnJlZ2lz
dGVyX2ZyYW1lYnVmZmVyKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9jb3Jl
L2ZibWVtLmMgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJtZW0uYwppbmRleCBmM2ZjMmU1
YjE5M2MuLmYzYmNhZDMwZDNiYSAxMDA2NDQKLS0tIGEvZHJpdmVycy92aWRlby9mYmRldi9jb3Jl
L2ZibWVtLmMKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKQEAgLTE1OTAs
MTMgKzE1OTAsMTMgQEAgc3RhdGljIGJvb2wgZmJfZG9fYXBlcnR1cmVzX292ZXJsYXAoc3RydWN0
IGFwZXJ0dXJlc19zdHJ1Y3QgKmdlbmEsCiAJcmV0dXJuIGZhbHNlOwogfQogCi1zdGF0aWMgaW50
IGRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pOworc3Rh
dGljIHZvaWQgZG9fdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5m
byk7CiAKICNkZWZpbmUgVkdBX0ZCX1BIWVMgMHhBMDAwMAotc3RhdGljIGludCBkb19yZW1vdmVf
Y29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKHN0cnVjdCBhcGVydHVyZXNfc3RydWN0ICphLAotCQkJ
CQkgICAgICBjb25zdCBjaGFyICpuYW1lLCBib29sIHByaW1hcnkpCitzdGF0aWMgdm9pZCBkb19y
ZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKHN0cnVjdCBhcGVydHVyZXNfc3RydWN0ICph
LAorCQkJCQkgICAgICAgY29uc3QgY2hhciAqbmFtZSwgYm9vbCBwcmltYXJ5KQogewotCWludCBp
LCByZXQ7CisJaW50IGk7CiAKIAkvKiBjaGVjayBhbGwgZmlybXdhcmUgZmJzIGFuZCBraWNrIG9m
ZiBpZiB0aGUgYmFzZSBhZGRyIG92ZXJsYXBzICovCiAJZm9yX2VhY2hfcmVnaXN0ZXJlZF9mYihp
KSB7CkBAIC0xNjEyLDEzICsxNjEyLDkgQEAgc3RhdGljIGludCBkb19yZW1vdmVfY29uZmxpY3Rp
bmdfZnJhbWVidWZmZXJzKHN0cnVjdCBhcGVydHVyZXNfc3RydWN0ICphLAogCiAJCQlwcmludGso
S0VSTl9JTkZPICJmYiVkOiBzd2l0Y2hpbmcgdG8gJXMgZnJvbSAlc1xuIiwKIAkJCSAgICAgICBp
LCBuYW1lLCByZWdpc3RlcmVkX2ZiW2ldLT5maXguaWQpOwotCQkJcmV0ID0gZG9fdW5yZWdpc3Rl
cl9mcmFtZWJ1ZmZlcihyZWdpc3RlcmVkX2ZiW2ldKTsKLQkJCWlmIChyZXQpCi0JCQkJcmV0dXJu
IHJldDsKKwkJCWRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIocmVnaXN0ZXJlZF9mYltpXSk7CiAJ
CX0KIAl9Ci0KLQlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGJvb2wgbG9ja2xlc3NfcmVnaXN0ZXJf
ZmI7CkBAIC0xNjM0LDExICsxNjMwLDkgQEAgc3RhdGljIGludCBkb19yZWdpc3Rlcl9mcmFtZWJ1
ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIAlpZiAoZmJfY2hlY2tfZm9yZWlnbm5lc3Mo
ZmJfaW5mbykpCiAJCXJldHVybiAtRU5PU1lTOwogCi0JcmV0ID0gZG9fcmVtb3ZlX2NvbmZsaWN0
aW5nX2ZyYW1lYnVmZmVycyhmYl9pbmZvLT5hcGVydHVyZXMsCi0JCQkJCQkgZmJfaW5mby0+Zml4
LmlkLAotCQkJCQkJIGZiX2lzX3ByaW1hcnlfZGV2aWNlKGZiX2luZm8pKTsKLQlpZiAocmV0KQot
CQlyZXR1cm4gcmV0OworCWRvX3JlbW92ZV9jb25mbGljdGluZ19mcmFtZWJ1ZmZlcnMoZmJfaW5m
by0+YXBlcnR1cmVzLAorCQkJCQkgICBmYl9pbmZvLT5maXguaWQsCisJCQkJCSAgIGZiX2lzX3By
aW1hcnlfZGV2aWNlKGZiX2luZm8pKTsKIAogCWlmIChudW1fcmVnaXN0ZXJlZF9mYiA9PSBGQl9N
QVgpCiAJCXJldHVybiAtRU5YSU87CkBAIC0xNzE0LDMyICsxNzA4LDI1IEBAIHN0YXRpYyBpbnQg
ZG9fcmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pCiAJcmV0dXJu
IHJldDsKIH0KIAotc3RhdGljIGludCB1bmJpbmRfY29uc29sZShzdHJ1Y3QgZmJfaW5mbyAqZmJf
aW5mbykKK3N0YXRpYyB2b2lkIHVuYmluZF9jb25zb2xlKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZv
KQogewogCWludCBpID0gZmJfaW5mby0+bm9kZTsKIAotCWlmIChpIDwgMCB8fCBpID49IEZCX01B
WCB8fCByZWdpc3RlcmVkX2ZiW2ldICE9IGZiX2luZm8pCi0JCXJldHVybiAtRUlOVkFMOworCWlm
IChXQVJOX09OKGkgPCAwIHx8IGkgPj0gRkJfTUFYIHx8IHJlZ2lzdGVyZWRfZmJbaV0gIT0gZmJf
aW5mbykpCisJCXJldHVybjsKIAogCWNvbnNvbGVfbG9jaygpOwogCWxvY2tfZmJfaW5mbyhmYl9p
bmZvKTsKIAlmYmNvbl9mYl91bmJpbmQoZmJfaW5mbyk7CiAJdW5sb2NrX2ZiX2luZm8oZmJfaW5m
byk7CiAJY29uc29sZV91bmxvY2soKTsKLQotCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IF9f
dW5saW5rX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKTsKK3N0YXRpYyB2b2lk
IF9fdW5saW5rX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKTsKIAotc3RhdGlj
IGludCBkb191bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQor
c3RhdGljIHZvaWQgZG9fdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJf
aW5mbykKIHsKLQlpbnQgcmV0OwotCi0JcmV0ID0gdW5iaW5kX2NvbnNvbGUoZmJfaW5mbyk7Ci0K
LQlpZiAocmV0KQotCQlyZXR1cm4gLUVJTlZBTDsKKwl1bmJpbmRfY29uc29sZShmYl9pbmZvKTsK
IAogCXBtX3Z0X3N3aXRjaF91bnJlZ2lzdGVyKGZiX2luZm8tPmRldik7CiAKQEAgLTE3NjQsMzYg
KzE3NTEsMjcgQEAgc3RhdGljIGludCBkb191bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBm
Yl9pbmZvICpmYl9pbmZvKQogCiAJLyogdGhpcyBtYXkgZnJlZSBmYiBpbmZvICovCiAJcHV0X2Zi
X2luZm8oZmJfaW5mbyk7Ci0JcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgX191bmxpbmtfZnJh
bWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pCitzdGF0aWMgdm9pZCBfX3VubGlua19m
cmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIHsKIAlpbnQgaTsKIAogCWkgPSBm
Yl9pbmZvLT5ub2RlOwotCWlmIChpIDwgMCB8fCBpID49IEZCX01BWCB8fCByZWdpc3RlcmVkX2Zi
W2ldICE9IGZiX2luZm8pCi0JCXJldHVybiAtRUlOVkFMOworCWlmIChXQVJOX09OKGkgPCAwIHx8
IGkgPj0gRkJfTUFYIHx8IHJlZ2lzdGVyZWRfZmJbaV0gIT0gZmJfaW5mbykpCisJCXJldHVybjsK
IAogCWlmIChmYl9pbmZvLT5kZXYpIHsKIAkJZGV2aWNlX2Rlc3Ryb3koZmJfY2xhc3MsIE1LREVW
KEZCX01BSk9SLCBpKSk7CiAJCWZiX2luZm8tPmRldiA9IE5VTEw7CiAJfQotCi0JcmV0dXJuIDA7
CiB9CiAKLWludCB1bmxpbmtfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pCit2
b2lkIHVubGlua19mcmFtZWJ1ZmZlcihzdHJ1Y3QgZmJfaW5mbyAqZmJfaW5mbykKIHsKLQlpbnQg
cmV0OwotCi0JcmV0ID0gX191bmxpbmtfZnJhbWVidWZmZXIoZmJfaW5mbyk7Ci0JaWYgKHJldCkK
LQkJcmV0dXJuIHJldDsKKwlfX3VubGlua19mcmFtZWJ1ZmZlcihmYl9pbmZvKTsKIAogCXVuYmlu
ZF9jb25zb2xlKGZiX2luZm8pOwotCi0JcmV0dXJuIDA7CiB9CiBFWFBPUlRfU1lNQk9MKHVubGlu
a19mcmFtZWJ1ZmZlcik7CiAKQEAgLTE4MTAsNyArMTc4OCw2IEBAIEVYUE9SVF9TWU1CT0wodW5s
aW5rX2ZyYW1lYnVmZmVyKTsKIGludCByZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKHN0
cnVjdCBhcGVydHVyZXNfc3RydWN0ICphLAogCQkJCSAgICBjb25zdCBjaGFyICpuYW1lLCBib29s
IHByaW1hcnkpCiB7Ci0JaW50IHJldDsKIAlib29sIGRvX2ZyZWUgPSBmYWxzZTsKIAogCWlmICgh
YSkgewpAQCAtMTgyNCwxMyArMTgwMSwxMyBAQCBpbnQgcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1l
YnVmZmVycyhzdHJ1Y3QgYXBlcnR1cmVzX3N0cnVjdCAqYSwKIAl9CiAKIAltdXRleF9sb2NrKCZy
ZWdpc3RyYXRpb25fbG9jayk7Ci0JcmV0ID0gZG9fcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1lYnVm
ZmVycyhhLCBuYW1lLCBwcmltYXJ5KTsKKwlkb19yZW1vdmVfY29uZmxpY3RpbmdfZnJhbWVidWZm
ZXJzKGEsIG5hbWUsIHByaW1hcnkpOwogCW11dGV4X3VubG9jaygmcmVnaXN0cmF0aW9uX2xvY2sp
OwogCiAJaWYgKGRvX2ZyZWUpCiAJCWtmcmVlKGEpOwogCi0JcmV0dXJuIHJldDsKKwlyZXR1cm4g
MDsKIH0KIEVYUE9SVF9TWU1CT0wocmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1lYnVmZmVycyk7CiAK
QEAgLTE5MjcsMTYgKzE5MDQsMTIgQEAgRVhQT1JUX1NZTUJPTChyZWdpc3Rlcl9mcmFtZWJ1ZmZl
cik7CiAgKiAgICAgIHRoYXQgdGhlIGRyaXZlciBpbXBsZW1lbnRzIGZiX29wZW4oKSBhbmQgZmJf
cmVsZWFzZSgpIHRvCiAgKiAgICAgIGNoZWNrIHRoYXQgbm8gcHJvY2Vzc2VzIGFyZSB1c2luZyB0
aGUgZGV2aWNlLgogICovCi1pbnQKK3ZvaWQKIHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0
IGZiX2luZm8gKmZiX2luZm8pCiB7Ci0JaW50IHJldDsKLQogCW11dGV4X2xvY2soJnJlZ2lzdHJh
dGlvbl9sb2NrKTsKLQlyZXQgPSBkb191bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKGZiX2luZm8pOwor
CWRvX3VucmVnaXN0ZXJfZnJhbWVidWZmZXIoZmJfaW5mbyk7CiAJbXV0ZXhfdW5sb2NrKCZyZWdp
c3RyYXRpb25fbG9jayk7Ci0KLQlyZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTCh1bnJlZ2lz
dGVyX2ZyYW1lYnVmZmVyKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9uZW9m
Yi5jIGIvZHJpdmVycy92aWRlby9mYmRldi9uZW9mYi5jCmluZGV4IDVkM2E0NDQwODNmNy4uYjc3
MDk0NmEwOTIwIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L25lb2ZiLmMKKysrIGIv
ZHJpdmVycy92aWRlby9mYmRldi9uZW9mYi5jCkBAIC0yMTIyLDE0ICsyMTIyLDcgQEAgc3RhdGlj
IHZvaWQgbmVvZmJfcmVtb3ZlKHN0cnVjdCBwY2lfZGV2ICpkZXYpCiAJREJHKCJuZW9mYl9yZW1v
dmUiKTsKIAogCWlmIChpbmZvKSB7Ci0JCS8qCi0JCSAqIElmIHVucmVnaXN0ZXJfZnJhbWVidWZm
ZXIgZmFpbHMsIHRoZW4KLQkJICogd2Ugd2lsbCBiZSBsZWF2aW5nIGhvb2tzIHRoYXQgY291bGQg
Y2F1c2UKLQkJICogb29wc2VuIGxheWluZyBhcm91bmQuCi0JCSAqLwotCQlpZiAodW5yZWdpc3Rl
cl9mcmFtZWJ1ZmZlcihpbmZvKSkKLQkJCXByaW50ayhLRVJOX1dBUk5JTkcKLQkJCSAgICAgICAi
bmVvZmI6IGRhbmdlciBkYW5nZXIhICBPb3BzZW4gaW1taW5lbnQhXG4iKTsKKwkJdW5yZWdpc3Rl
cl9mcmFtZWJ1ZmZlcihpbmZvKTsKIAogCQluZW9fdW5tYXBfdmlkZW8oaW5mbyk7CiAJCWZiX2Rl
c3Ryb3lfbW9kZWRiKGluZm8tPm1vbnNwZWNzLm1vZGVkYik7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L3ZpZGVvL2ZiZGV2L3NhdmFnZS9zYXZhZ2VmYl9kcml2ZXIuYyBiL2RyaXZlcnMvdmlkZW8vZmJk
ZXYvc2F2YWdlL3NhdmFnZWZiX2RyaXZlci5jCmluZGV4IDQ3Yjc4ZjAxMzhjMy4uNTEyNzg5ZjVm
ODg0IDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L3NhdmFnZS9zYXZhZ2VmYl9kcml2
ZXIuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L3NhdmFnZS9zYXZhZ2VmYl9kcml2ZXIuYwpA
QCAtMjMzMywxNCArMjMzMyw3IEBAIHN0YXRpYyB2b2lkIHNhdmFnZWZiX3JlbW92ZShzdHJ1Y3Qg
cGNpX2RldiAqZGV2KQogCURCRygic2F2YWdlZmJfcmVtb3ZlIik7CiAKIAlpZiAoaW5mbykgewot
CQkvKgotCQkgKiBJZiB1bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyIGZhaWxzLCB0aGVuCi0JCSAqIHdl
IHdpbGwgYmUgbGVhdmluZyBob29rcyB0aGF0IGNvdWxkIGNhdXNlCi0JCSAqIG9vcHNlbiBsYXlp
bmcgYXJvdW5kLgotCQkgKi8KLQkJaWYgKHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoaW5mbykpCi0J
CQlwcmludGsoS0VSTl9XQVJOSU5HICJzYXZhZ2VmYjogZGFuZ2VyIGRhbmdlciEgIgotCQkJICAg
ICAgICJPb3BzZW4gaW1taW5lbnQhXG4iKTsKKwkJdW5yZWdpc3Rlcl9mcmFtZWJ1ZmZlcihpbmZv
KTsKIAogI2lmZGVmIENPTkZJR19GQl9TQVZBR0VfSTJDCiAJCXNhdmFnZWZiX2RlbGV0ZV9pMmNf
YnVzc2VzKGluZm8pOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9mYi5oIGIvaW5jbHVkZS9s
aW51eC9mYi5oCmluZGV4IGI2Y2UwNDFkOWUxMy4uYjkwY2Y3ZDU2YmQ4IDEwMDY0NAotLS0gYS9p
bmNsdWRlL2xpbnV4L2ZiLmgKKysrIGIvaW5jbHVkZS9saW51eC9mYi5oCkBAIC02MzQsOCArNjM0
LDggQEAgZXh0ZXJuIHNzaXplX3QgZmJfc3lzX3dyaXRlKHN0cnVjdCBmYl9pbmZvICppbmZvLCBj
b25zdCBjaGFyIF9fdXNlciAqYnVmLAogCiAvKiBkcml2ZXJzL3ZpZGVvL2ZibWVtLmMgKi8KIGV4
dGVybiBpbnQgcmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pOwot
ZXh0ZXJuIGludCB1bnJlZ2lzdGVyX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZv
KTsKLWV4dGVybiBpbnQgdW5saW5rX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZv
KTsKK2V4dGVybiB2b2lkIHVucmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZi
X2luZm8pOworZXh0ZXJuIHZvaWQgdW5saW5rX2ZyYW1lYnVmZmVyKHN0cnVjdCBmYl9pbmZvICpm
Yl9pbmZvKTsKIGV4dGVybiBpbnQgcmVtb3ZlX2NvbmZsaWN0aW5nX3BjaV9mcmFtZWJ1ZmZlcnMo
c3RydWN0IHBjaV9kZXYgKnBkZXYsIGludCByZXNfaWQsCiAJCQkJCSAgICAgICBjb25zdCBjaGFy
ICpuYW1lKTsKIGV4dGVybiBpbnQgcmVtb3ZlX2NvbmZsaWN0aW5nX2ZyYW1lYnVmZmVycyhzdHJ1
Y3QgYXBlcnR1cmVzX3N0cnVjdCAqYSwKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
