Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 90BBFE4893
	for <lists+dri-devel@lfdr.de>; Fri, 25 Oct 2019 12:27:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C1A466E975;
	Fri, 25 Oct 2019 10:27:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (unknown [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 76B7A6E92A
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Oct 2019 10:27:06 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 243FA1FB;
 Fri, 25 Oct 2019 03:26:56 -0700 (PDT)
Received: from [10.1.194.43] (e112269-lin.cambridge.arm.com [10.1.194.43])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id D430F3F6C4;
 Fri, 25 Oct 2019 03:26:54 -0700 (PDT)
Subject: Re: [RESEND PATCH v4] drm: Don't free jobs in
 wait_event_interruptible()
To: "Koenig, Christian" <Christian.Koenig@amd.com>,
 Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>
References: <20191024162424.38548-1-steven.price@arm.com>
 <02be6c7e-eda9-2a5b-f553-8d82fcd84b47@amd.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <fdaebd89-ddc5-83da-687e-acf295007f31@arm.com>
Date: Fri, 25 Oct 2019 11:26:53 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <02be6c7e-eda9-2a5b-f553-8d82fcd84b47@amd.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sharat Masetty <smasetty@codeaurora.org>,
 "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
 "dri-devel@lists.freedesktop.org" <dri-devel@lists.freedesktop.org>, "Deucher,
 Alexander" <Alexander.Deucher@amd.com>, Sam Ravnborg <sam@ravnborg.org>,
 Erico Nunes <nunes.erico@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjUvMTAvMjAxOSAxMDo0OSwgS29lbmlnLCBDaHJpc3RpYW4gd3JvdGU6Cj4gQW0gMjQuMTAu
MTkgdW0gMTg6MjQgc2NocmllYiBTdGV2ZW4gUHJpY2U6Cj4+IGRybV9zY2hlZF9jbGVhbnVwX2pv
YnMoKSBhdHRlbXB0cyB0byBmcmVlIGZpbmlzaGVkIGpvYnMsIGhvd2V2ZXIgYmVjYXVzZQo+PiBp
dCBpcyBjYWxsZWQgYXMgdGhlIGNvbmRpdGlvbiBvZiB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUo
KSBpdCBtdXN0IG5vdAo+PiBzbGVlcC4gVW5mb3J0dWFudGx5IHNvbWUgZnJlZSBjYWxsYmFja3Mg
KG5vdGlibHkgZm9yIFBhbmZyb3N0KSBkbyBzbGVlcC4KPj4KPj4gSW5zdGVhZCBsZXQncyByZW5h
bWUgZHJtX3NjaGVkX2NsZWFudXBfam9icygpIHRvCj4+IGRybV9zY2hlZF9nZXRfY2xlYW51cF9q
b2IoKSBhbmQgc2ltcGx5IHJldHVybiBhIGpvYiBmb3IgcHJvY2Vzc2luZyBpZgo+PiB0aGVyZSBp
cyBvbmUuIFRoZSBjYWxsZXIgY2FuIHRoZW4gY2FsbCB0aGUgZnJlZV9qb2IoKSBjYWxsYmFjayBv
dXRzaWRlCj4+IHRoZSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoKSB3aGVyZSBzbGVlcGluZyBp
cyBwb3NzaWJsZSBiZWZvcmUKPj4gcmUtY2hlY2tpbmcgYW5kIHJldHVybmluZyB0byBzbGVlcCBp
ZiBuZWNlc3NhcnkuCj4+Cj4+IFNpZ25lZC1vZmYtYnk6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnBy
aWNlQGFybS5jb20+Cj4+IC0tLQo+PiBQcmV2aW91cyBwb3N0aW5nOiBodHRwczovL2xvcmUua2Vy
bmVsLm9yZy9sa21sLzIwMTkwOTI2MTQxNjMwLjE0MjU4LTEtc3RldmVuLnByaWNlQGFybS5jb20v
Cj4+Cj4+ICAgZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9tYWluLmMgfCA0NSArKysr
KysrKysrKysrKystLS0tLS0tLS0tLQo+PiAgIDEgZmlsZSBjaGFuZ2VkLCAyNiBpbnNlcnRpb25z
KCspLCAxOSBkZWxldGlvbnMoLSkKPj4KPj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9z
Y2hlZHVsZXIvc2NoZWRfbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL3NjaGVkdWxlci9zY2hlZF9t
YWluLmMKPj4gaW5kZXggOWEwZWU3NGQ4MmRjLi4xNDg0Njg0NDdiYTkgMTAwNjQ0Cj4+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jCj4+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jCj4+IEBAIC02MjIsNDMgKzYyMiw0MSBAQCBz
dGF0aWMgdm9pZCBkcm1fc2NoZWRfcHJvY2Vzc19qb2Ioc3RydWN0IGRtYV9mZW5jZSAqZiwgc3Ry
dWN0IGRtYV9mZW5jZV9jYiAqY2IpCj4+ICAgfQo+PiAgIAo+PiAgIC8qKgo+PiAtICogZHJtX3Nj
aGVkX2NsZWFudXBfam9icyAtIGRlc3Ryb3kgZmluaXNoZWQgam9icwo+PiArICogZHJtX3NjaGVk
X2dldF9jbGVhbnVwX2pvYiAtIGZldGNoIHRoZSBuZXh0IGZpbmlzaGVkIGpvYiB0byBiZSBkZXN0
cm95ZWQKPj4gICAgKgo+PiAgICAqIEBzY2hlZDogc2NoZWR1bGVyIGluc3RhbmNlCj4+ICAgICoK
Pj4gLSAqIFJlbW92ZSBhbGwgZmluaXNoZWQgam9icyBmcm9tIHRoZSBtaXJyb3IgbGlzdCBhbmQg
ZGVzdHJveSB0aGVtLgo+PiArICogUmV0dXJucyB0aGUgbmV4dCBmaW5pc2hlZCBqb2IgZnJvbSB0
aGUgbWlycm9yIGxpc3QgKGlmIHRoZXJlIGlzIG9uZSkKPj4gKyAqIHJlYWR5IGZvciBpdCB0byBi
ZSBkZXN0cm95ZWQuCj4+ICAgICovCj4+IC1zdGF0aWMgdm9pZCBkcm1fc2NoZWRfY2xlYW51cF9q
b2JzKHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAqc2NoZWQpCj4+ICtzdGF0aWMgc3RydWN0IGRy
bV9zY2hlZF9qb2IgKgo+PiArZHJtX3NjaGVkX2dldF9jbGVhbnVwX2pvYihzdHJ1Y3QgZHJtX2dw
dV9zY2hlZHVsZXIgKnNjaGVkKQo+PiAgIHsKPj4gKwlzdHJ1Y3QgZHJtX3NjaGVkX2pvYiAqam9i
ID0gTlVMTDsKPiAKPiBQbGVhc2UgZG9uJ3QgaW5pdGlhbGl6ZSBqb2IgaGVyZS4KCkdvb2Qgc3Bv
dCwgd2lsbCBmaXguCgo+PiAgIAl1bnNpZ25lZCBsb25nIGZsYWdzOwo+PiAgIAo+PiAgIAkvKiBE
b24ndCBkZXN0cm95IGpvYnMgd2hpbGUgdGhlIHRpbWVvdXQgd29ya2VyIGlzIHJ1bm5pbmcgKi8K
Pj4gICAJaWYgKHNjaGVkLT50aW1lb3V0ICE9IE1BWF9TQ0hFRFVMRV9USU1FT1VUICYmCj4+ICAg
CSAgICAhY2FuY2VsX2RlbGF5ZWRfd29yaygmc2NoZWQtPndvcmtfdGRyKSkKPj4gLQkJcmV0dXJu
Owo+PiAtCj4+ICsJCXJldHVybiBOVUxMOwo+PiAgIAo+PiAtCXdoaWxlICghbGlzdF9lbXB0eSgm
c2NoZWQtPnJpbmdfbWlycm9yX2xpc3QpKSB7Cj4+IC0JCXN0cnVjdCBkcm1fc2NoZWRfam9iICpq
b2I7Cj4+ICsJc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7
Cj4+ICAgCj4+IC0JCWpvYiA9IGxpc3RfZmlyc3RfZW50cnkoJnNjaGVkLT5yaW5nX21pcnJvcl9s
aXN0LAo+PiArCWpvYiA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmc2NoZWQtPnJpbmdfbWly
cm9yX2xpc3QsCj4+ICAgCQkJCSAgICAgICBzdHJ1Y3QgZHJtX3NjaGVkX2pvYiwgbm9kZSk7Cj4+
IC0JCWlmICghZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKCZqb2ItPnNfZmVuY2UtPmZpbmlzaGVkKSkK
Pj4gLQkJCWJyZWFrOwo+PiAgIAo+PiAtCQlzcGluX2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpvYl9s
aXN0X2xvY2ssIGZsYWdzKTsKPj4gKwlpZiAoam9iICYmIGRtYV9mZW5jZV9pc19zaWduYWxlZCgm
am9iLT5zX2ZlbmNlLT5maW5pc2hlZCkpIHsKPj4gICAJCS8qIHJlbW92ZSBqb2IgZnJvbSByaW5n
X21pcnJvcl9saXN0ICovCj4+ICAgCQlsaXN0X2RlbF9pbml0KCZqb2ItPm5vZGUpOwo+PiAtCQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+am9iX2xpc3RfbG9jaywgZmxhZ3MpOwo+PiAt
Cj4+IC0JCXNjaGVkLT5vcHMtPmZyZWVfam9iKGpvYik7Cj4+ICsJfSBlbHNlIHsKPj4gKwkJam9i
ID0gTlVMTDsKPj4gKwkJLyogcXVldWUgdGltZW91dCBmb3IgbmV4dCBqb2IgKi8KPj4gKwkJZHJt
X3NjaGVkX3N0YXJ0X3RpbWVvdXQoc2NoZWQpOwo+PiAgIAl9Cj4+ICAgCj4+IC0JLyogcXVldWUg
dGltZW91dCBmb3IgbmV4dCBqb2IgKi8KPj4gLQlzcGluX2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpv
Yl9saXN0X2xvY2ssIGZsYWdzKTsKPj4gLQlkcm1fc2NoZWRfc3RhcnRfdGltZW91dChzY2hlZCk7
Cj4+ICAgCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFn
cyk7Cj4+ICAgCj4+ICsJcmV0dXJuIGpvYjsKPj4gICB9Cj4+ICAgCj4+ICAgLyoqCj4+IEBAIC02
OTgsMTIgKzY5NiwyMSBAQCBzdGF0aWMgaW50IGRybV9zY2hlZF9tYWluKHZvaWQgKnBhcmFtKQo+
PiAgIAkJc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZTsKPj4gICAJCXN0cnVjdCBkcm1f
c2NoZWRfam9iICpzY2hlZF9qb2I7Cj4+ICAgCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKPj4g
KwkJc3RydWN0IGRybV9zY2hlZF9qb2IgKmNsZWFudXBfam9iID0gTlVMTDsKPj4gICAKPj4gICAJ
CXdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZShzY2hlZC0+d2FrZV91cF93b3JrZXIsCj4+IC0JCQkJ
CSAoZHJtX3NjaGVkX2NsZWFudXBfam9icyhzY2hlZCksCj4+ICsJCQkJCSAoY2xlYW51cF9qb2Ig
PSBkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iKHNjaGVkKSkgfHwKPj4gICAJCQkJCSAoIWRybV9z
Y2hlZF9ibG9ja2VkKHNjaGVkKSAmJgo+PiAgIAkJCQkJICAoZW50aXR5ID0gZHJtX3NjaGVkX3Nl
bGVjdF9lbnRpdHkoc2NoZWQpKSkgfHwKPj4gLQkJCQkJIGt0aHJlYWRfc2hvdWxkX3N0b3AoKSkp
Owo+PiArCQkJCQkga3RocmVhZF9zaG91bGRfc3RvcCgpKTsKPj4gKwo+PiArCQl3aGlsZSAoY2xl
YW51cF9qb2IpIHsKPiAKPiBCZXR0ZXIgbWFrZSB0aGlzIGp1c3QgImlmIChjbGVhbnVwX2pvYiki
Li4uIHRvIG1ha2Ugc3VyZSB0aGF0IHdlIHN0b3AgCj4gaW1tZWRpYXRlbHkgd2hlbiB0aGUgdGhy
ZWFkIHNob3VsZCBzdG9wLgoKT2ssIG5vIHByb2JsZW0uIE5vdGUgdGhhdCB0aGlzIGlzIGEgY2hh
bmdlIGluIGJlaGF2aW91ciAocHJldmlvdXNseQpkcm1fc2NoZWRfY2xlYW51cF9qb2JzKCkgd2Fz
IGNhbGxlZCAqYmVmb3JlKiBjaGVja2luZwprdGhyZWFkX3Nob3VsZF9zdG9wKCkpLiBCdXQgSSBj
YW4ndCBzZWUgdGhlIGhhcm0uCgpTdGV2ZQoKPiBBcGFydCBmcm9tIHRoYXQgbG9va3MgZ29vZCB0
byBtZSBub3csCj4gQ2hyaXN0aWFuLgo+IAo+PiArCQkJc2NoZWQtPm9wcy0+ZnJlZV9qb2IoY2xl
YW51cF9qb2IpOwo+PiArCQkJLyogcXVldWUgdGltZW91dCBmb3IgbmV4dCBqb2IgKi8KPj4gKwkJ
CWRybV9zY2hlZF9zdGFydF90aW1lb3V0KHNjaGVkKTsKPj4gKwo+PiArCQkJY2xlYW51cF9qb2Ig
PSBkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iKHNjaGVkKTsKPj4gKwkJfQo+PiAgIAo+PiAgIAkJ
aWYgKCFlbnRpdHkpCj4+ICAgCQkJY29udGludWU7Cj4gCj4gX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KPiBkcmktZGV2ZWwgbWFpbGluZyBsaXN0Cj4gZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwo+IGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCj4gCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZl
bEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
