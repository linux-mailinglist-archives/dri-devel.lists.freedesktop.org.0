Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8B3C136B0D8
	for <lists+dri-devel@lfdr.de>; Mon, 26 Apr 2021 11:43:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3B15E6E42F;
	Mon, 26 Apr 2021 09:43:01 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1AE2B6E42F;
 Mon, 26 Apr 2021 09:43:00 +0000 (UTC)
IronPort-SDR: McDyNUXVQqRxrtiUz25Bd/ROgF7dZW/Km+jetMMSxeLpH8tfTbN1deIMgSleOeIq37X/Cxm1uw
 77OckkSLqG7w==
X-IronPort-AV: E=McAfee;i="6200,9189,9965"; a="195861024"
X-IronPort-AV: E=Sophos;i="5.82,252,1613462400"; d="scan'208";a="195861024"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Apr 2021 02:42:59 -0700
IronPort-SDR: fQPxb+HmgzDvp5CoAgAGY9qCaHczj80rmBBYhWBoX/Lar1c7I/FB3+rbdFaFxQQ4V3tx6lOtNQ
 9OHDiyH9hoCA==
X-IronPort-AV: E=Sophos;i="5.82,252,1613462400"; d="scan'208";a="429334140"
Received: from rgunnin1-mobl.ger.corp.intel.com (HELO
 mwauld-desk1.ger.corp.intel.com) ([10.252.12.201])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 Apr 2021 02:42:56 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 4/9] drm/i915: rework gem_create flow for upcoming extensions
Date: Mon, 26 Apr 2021 10:38:56 +0100
Message-Id: <20210426093901.28937-4-matthew.auld@intel.com>
X-Mailer: git-send-email 2.26.3
In-Reply-To: <20210426093901.28937-1-matthew.auld@intel.com>
References: <20210426093901.28937-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Lionel Landwerlin <lionel.g.landwerlin@linux.intel.com>,
 =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 Jordan Justen <jordan.l.justen@intel.com>, dri-devel@lists.freedesktop.org,
 Kenneth Graunke <kenneth@whitecape.org>,
 Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>,
 Jon Bloomfield <jon.bloomfield@intel.com>,
 Jason Ekstrand <jason@jlekstrand.net>, mesa-dev@lists.freedesktop.org,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2l0aCB0aGUgdXBjb21pbmcgZ2VtX2NyZWF0ZV9leHQgd2Ugd2FudCB0byBiZSBhYmxlIGNyZWF0
ZSBhICJ2YW5pbGxhIgpvYmplY3QgdXBmcm9udCBhbmQgcGFzcyB0aGF0IGRpcmVjdGx5IHRvIHRo
ZSBleHRlbnNpb25zLCBiZWZvcmUgYWN0dWFsbHkKaW5pdGlhbGlzaW5nIHRoZSBvYmplY3QuIEZ1
bmN0aW9uYWxseSB0aGlzIHNob3VsZCBiZSB0aGUgc2FtZSBleHBlY3Qgd2UKbm93IGZlZWQgdGhl
IG9iamVjdCBpbnRvIHRoZSBsb3dlci1sZXZlbCByZWdpb24gc3BlY2lmaWMgaW5pdF9vYmplY3Qu
CgpTaWduZWQtb2ZmLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+CkNj
OiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBU
aG9tYXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJvbUBsaW51eC5pbnRlbC5jb20+CkNjOiBE
YW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpD
YzogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AbGludXguaW50ZWwuY29t
PgpDYzogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KQ2M6IEpvcmRh
biBKdXN0ZW4gPGpvcmRhbi5sLmp1c3RlbkBpbnRlbC5jb20+CkNjOiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWwudmV0dGVyQGludGVsLmNvbT4KQ2M6IEtlbm5ldGggR3JhdW5rZSA8a2VubmV0aEB3aGl0
ZWNhcGUub3JnPgpDYzogSmFzb24gRWtzdHJhbmQgPGphc29uQGpsZWtzdHJhbmQubmV0PgpDYzog
RGF2ZSBBaXJsaWUgPGFpcmxpZWRAZ21haWwuY29tPgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpDYzogbWVzYS1kZXZAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCi0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NyZWF0ZS5jIHwgOTIgKysrKysrKysrKysrKysr
LS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDY1IGluc2VydGlvbnMoKyksIDI3IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jcmVhdGUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jcmVhdGUuYwppbmRleCA0NWQ2
MGUzZDk4ZTMuLjczZjI5MjI0ZjVmZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NyZWF0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jcmVhdGUuYwpAQCAtNyw0MSArNyw1MSBAQAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9y
ZWdpb24uaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV90cmFjZS5o
IgorCitzdGF0aWMgaW50IGk5MTVfZ2VtX3B1Ymxpc2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKKwkJCSAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCisJCQkgICAgdTY0ICpzaXpl
X3AsCisJCQkgICAgdTMyICpoYW5kbGVfcCkKK3sKKwl1NjQgc2l6ZSA9IG9iai0+YmFzZS5zaXpl
OworCWludCByZXQ7CisKKwlyZXQgPSBkcm1fZ2VtX2hhbmRsZV9jcmVhdGUoZmlsZSwgJm9iai0+
YmFzZSwgaGFuZGxlX3ApOworCS8qIGRyb3AgcmVmZXJlbmNlIGZyb20gYWxsb2NhdGUgLSBoYW5k
bGUgaG9sZHMgaXQgbm93ICovCisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwkqc2l6ZV9wID0gc2l6ZTsKKwlyZXR1cm4gMDsKK30KIAogc3Rh
dGljIGludAotaTkxNV9nZW1fY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKLQkJc3RydWN0
IGludGVsX21lbW9yeV9yZWdpb24gKm1yLAotCQl1NjQgKnNpemVfcCwKLQkJdTMyICpoYW5kbGVf
cCkKK2k5MTVfZ2VtX3NldHVwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJICAg
ICAgIHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptciwKKwkgICAgICAgdTY0IHNpemUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQl1MzIgaGFuZGxlOwotCXU2NCBz
aXplOwogCWludCByZXQ7CiAKIAlHRU1fQlVHX09OKCFpc19wb3dlcl9vZl8yKG1yLT5taW5fcGFn
ZV9zaXplKSk7Ci0Jc2l6ZSA9IHJvdW5kX3VwKCpzaXplX3AsIG1yLT5taW5fcGFnZV9zaXplKTsK
KwlzaXplID0gcm91bmRfdXAoc2l6ZSwgbXItPm1pbl9wYWdlX3NpemUpOwogCWlmIChzaXplID09
IDApCiAJCXJldHVybiAtRUlOVkFMOwogCiAJLyogRm9yIG1vc3Qgb2YgdGhlIEFCSSAoZS5nLiBt
bWFwKSB3ZSB0aGluayBpbiBzeXN0ZW0gcGFnZXMgKi8KIAlHRU1fQlVHX09OKCFJU19BTElHTkVE
KHNpemUsIFBBR0VfU0laRSkpOwogCi0JLyogQWxsb2NhdGUgdGhlIG5ldyBvYmplY3QgKi8KLQlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3JlZ2lvbihtciwgc2l6ZSwgMCk7Ci0JaWYgKElT
X0VSUihvYmopKQotCQlyZXR1cm4gUFRSX0VSUihvYmopOwotCi0JR0VNX0JVR19PTihzaXplICE9
IG9iai0+YmFzZS5zaXplKTsKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X3NpemVfMmJpZyhzaXplKSkK
KwkJcmV0dXJuIC1FMkJJRzsKIAotCXJldCA9IGRybV9nZW1faGFuZGxlX2NyZWF0ZShmaWxlLCAm
b2JqLT5iYXNlLCAmaGFuZGxlKTsKLQkvKiBkcm9wIHJlZmVyZW5jZSBmcm9tIGFsbG9jYXRlIC0g
aGFuZGxlIGhvbGRzIGl0IG5vdyAqLwotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXQg
PSBtci0+b3BzLT5pbml0X29iamVjdChtciwgb2JqLCBzaXplLCAwKTsKIAlpZiAocmV0KQogCQly
ZXR1cm4gcmV0OwogCi0JKmhhbmRsZV9wID0gaGFuZGxlOwotCSpzaXplX3AgPSBzaXplOworCUdF
TV9CVUdfT04oc2l6ZSAhPSBvYmotPmJhc2Uuc2l6ZSk7CisKKwl0cmFjZV9pOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlKG9iaik7CiAJcmV0dXJuIDA7CiB9CiAKQEAgLTUwLDkgKzYwLDExIEBAIGk5MTVf
Z2VtX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJICAgICBzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAogCQkgICAgIHN0cnVjdCBkcm1fbW9kZV9jcmVhdGVfZHVtYiAqYXJncykK
IHsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCWVudW0gaW50ZWxfbWVtb3J5
X3R5cGUgbWVtX3R5cGU7CiAJaW50IGNwcCA9IERJVl9ST1VORF9VUChhcmdzLT5icHAsIDgpOwog
CXUzMiBmb3JtYXQ7CisJaW50IHJldDsKIAogCXN3aXRjaCAoY3BwKSB7CiAJY2FzZSAxOgpAQCAt
ODUsMTAgKzk3LDIyIEBAIGk5MTVfZ2VtX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmls
ZSwKIAlpZiAoSEFTX0xNRU0odG9faTkxNShkZXYpKSkKIAkJbWVtX3R5cGUgPSBJTlRFTF9NRU1P
UllfTE9DQUw7CiAKLQlyZXR1cm4gaTkxNV9nZW1fY3JlYXRlKGZpbGUsCi0JCQkgICAgICAgaW50
ZWxfbWVtb3J5X3JlZ2lvbl9ieV90eXBlKHRvX2k5MTUoZGV2KSwKLQkJCQkJCQkgICBtZW1fdHlw
ZSksCi0JCQkgICAgICAgJmFyZ3MtPnNpemUsICZhcmdzLT5oYW5kbGUpOworCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9hbGxvYygpOworCWlmICghb2JqKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJl
dCA9IGk5MTVfZ2VtX3NldHVwKG9iaiwKKwkJCSAgICAgaW50ZWxfbWVtb3J5X3JlZ2lvbl9ieV90
eXBlKHRvX2k5MTUoZGV2KSwKKwkJCQkJCQkgICAgICBtZW1fdHlwZSksCisJCQkgICAgIGFyZ3Mt
PnNpemUpOworCWlmIChyZXQpCisJCWdvdG8gb2JqZWN0X2ZyZWU7CisKKwlyZXR1cm4gaTkxNV9n
ZW1fcHVibGlzaChvYmosIGZpbGUsICZhcmdzLT5zaXplLCAmYXJncy0+aGFuZGxlKTsKKworb2Jq
ZWN0X2ZyZWU6CisJaTkxNV9nZW1fb2JqZWN0X2ZyZWUob2JqKTsKKwlyZXR1cm4gcmV0OwogfQog
CiAvKioKQEAgLTEwMywxMSArMTI3LDI1IEBAIGk5MTVfZ2VtX2NyZWF0ZV9pb2N0bChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fY3JlYXRlICphcmdz
ID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCWludCByZXQ7CiAK
IAlpOTE1X2dlbV9mbHVzaF9mcmVlX29iamVjdHMoaTkxNSk7CiAKLQlyZXR1cm4gaTkxNV9nZW1f
Y3JlYXRlKGZpbGUsCi0JCQkgICAgICAgaW50ZWxfbWVtb3J5X3JlZ2lvbl9ieV90eXBlKGk5MTUs
Ci0JCQkJCQkJICAgSU5URUxfTUVNT1JZX1NZU1RFTSksCi0JCQkgICAgICAgJmFyZ3MtPnNpemUs
ICZhcmdzLT5oYW5kbGUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9hbGxvYygpOworCWlmICgh
b2JqKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXJldCA9IGk5MTVfZ2VtX3NldHVwKG9iaiwKKwkJ
CSAgICAgaW50ZWxfbWVtb3J5X3JlZ2lvbl9ieV90eXBlKGk5MTUsCisJCQkJCQkJIElOVEVMX01F
TU9SWV9TWVNURU0pLAorCQkJICAgICBhcmdzLT5zaXplKTsKKwlpZiAocmV0KQorCQlnb3RvIG9i
amVjdF9mcmVlOworCisJcmV0dXJuIGk5MTVfZ2VtX3B1Ymxpc2gob2JqLCBmaWxlLCAmYXJncy0+
c2l6ZSwgJmFyZ3MtPmhhbmRsZSk7CisKK29iamVjdF9mcmVlOgorCWk5MTVfZ2VtX29iamVjdF9m
cmVlKG9iaik7CisJcmV0dXJuIHJldDsKIH0KLS0gCjIuMjYuMwoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
