Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CCA19A3161
	for <lists+dri-devel@lfdr.de>; Fri, 30 Aug 2019 09:43:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D0A2B6E282;
	Fri, 30 Aug 2019 07:43:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw01.mediatek.com (unknown [210.61.82.183])
 by gabe.freedesktop.org (Postfix) with ESMTP id 68F636E0F1
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Aug 2019 07:43:31 +0000 (UTC)
X-UUID: 4eee89582a4a4165bd72f1b0dae05ddf-20190830
X-UUID: 4eee89582a4a4165bd72f1b0dae05ddf-20190830
Received: from mtkcas07.mediatek.inc [(172.21.101.84)] by mailgw01.mediatek.com
 (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 2088797645; Fri, 30 Aug 2019 15:38:24 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs05n1.mediatek.inc (172.21.101.15) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Fri, 30 Aug 2019 15:38:28 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Fri, 30 Aug 2019 15:38:28 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH 2/2] drm/mediatek: Bypass atomic helpers for cursor updates
Date: Fri, 30 Aug 2019 15:38:19 +0800
Message-ID: <20190830073819.16566-3-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20190830073819.16566-1-bibby.hsieh@mediatek.com>
References: <20190830073819.16566-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, linux-kernel@vger.kernel.org, tfiga@chromium.org,
 Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TW92aW5nIHRoZSBkcml2ZXIgdG8gYXRvbWljIGhlbHBlcnMgcmVncmVzc2VkIGN1cnNvciByZXNw
b25zaXZlbmVzcywKYmVjYXVzZSBjdXJzb3IgdXBkYXRlcyBuZWVkIHRoZWlyIG93biBhdG9taWMg
Y29tbWl0cywgd2hpY2ggaGF2ZSB0byBiZQpzZXJpYWxpemVkIHdpdGggb3RoZXIgY29tbWl0cywg
dGhhdCBtaWdodCBpbmNsdWRlIGZlbmNlIHdhaXRzLiBUbyBhdm9pZAp0aGlzLCBpbiBjZXJ0YWlu
IGNvbmRpdGlvbnMsIHdlIGNhbiBieXBhc3MgdGhlIGF0b21pYyBoZWxwZXJzIGZvciBsZWdhY3kK
Y3Vyc29yIHVwZGF0ZSBJT0NUTHMuIEN1cnJlbnRseSB0aGUgY29uZGl0aW9ucyBhcmU6CiAtIG5v
IGFzeW5jaHJvbm91cyBtb2RlIHNldHRpbmcgY29tbWl0IHBlbmRpbmcsCiAtIG5vIGFzeW5jaHJv
bm91cyBjb21taXQgdGhhdCB1cGRhdGVzIHRoZSBjdXJzb3IgcGxhbmUgaXMgcGVuZGluZy4KV2l0
aCB0aGUgYWJvdmUgdHdvIGNvbmRpdGlvbnMgbWV0LCB3ZSBrbm93IHRoYXQgdGhlIG1hbnVhbCBj
dXJzb3Igc3RhdGUKdXBkYXRlIHdpbGwgbm90IGNvbmZsaWN0IHdpdGggYW55IHNjaGVkdWxlZCB1
cGRhdGUuCgpGaXhlczogMTE5ZjUxNzM2MjhhICgiZHJtL21lZGlhdGVrOiBBZGQgRFJNIERyaXZl
ciBmb3IgTWVkaWF0ZWsgU29DIE1UODE3My4iKQoKU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWgg
PGJpYmJ5LmhzaWVoQG1lZGlhdGVrLmNvbT4KU2lnbmVkLW9mZi1ieTogRGFuaWVsIEt1cnR6IDxk
amt1cnR6QGNocm9taXVtLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2Ry
bV9jcnRjLmMgIHwgNDEgKysrKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210
a19kcm1fY3J0Yy5oICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Ry
di5jICAgfCAzNCArKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1f
ZHJ2LmggICB8ICAzICsKIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmMg
fCA3MyArKysrKysrKysrKysrKysrKysrKysrKy0KIDUgZmlsZXMgY2hhbmdlZCwgMTQ4IGluc2Vy
dGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21l
ZGlhdGVrL210a19kcm1fY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1f
Y3J0Yy5jCmluZGV4IDc2OTdiNDBiYWFjMC4uMDkyZTUwMmVkMjdiIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L21lZGlhdGVrL210a19kcm1fY3J0Yy5jCkBAIC00MCw3ICs0MCw3IEBAIHN0cnVjdCBtdGtfZHJt
X2NydGMgewogCXN0cnVjdCBkcm1fcGxhbmUJCSpwbGFuZXM7CiAJdW5zaWduZWQgaW50CQkJbGF5
ZXJfbnI7CiAJYm9vbAkJCQlwZW5kaW5nX3BsYW5lczsKLQorCWJvb2wgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgY3Vyc29yX3VwZGF0ZTsKIAl2b2lkIF9faW9tZW0JCQkqY29uZmlnX3JlZ3M7
CiAJY29uc3Qgc3RydWN0IG10a19tbXN5c19yZWdfZGF0YSAqbW1zeXNfcmVnX2RhdGE7CiAJc3Ry
dWN0IG10a19kaXNwX211dGV4CQkqbXV0ZXg7CkBAIC0zODYsOCArMzg2LDQ1IEBAIHN0YXRpYyB2
b2lkIG10a19jcnRjX2RkcF9jb25maWcoc3RydWN0IGRybV9jcnRjICpjcnRjKQogCQkJfQogCQl9
CiAJCW10a19jcnRjLT5wZW5kaW5nX3BsYW5lcyA9IGZhbHNlOwotCQltdGtfYXRvbWljX3N0YXRl
X3B1dF9xdWV1ZShhdG9taWNfc3RhdGUpOworCQlpZiAoIW10a19jcnRjLT5jdXJzb3JfdXBkYXRl
KQorCQkJbXRrX2F0b21pY19zdGF0ZV9wdXRfcXVldWUoYXRvbWljX3N0YXRlKTsKKwkJbXRrX2Ny
dGMtPmN1cnNvcl91cGRhdGUgPSBmYWxzZTsKKwl9Cit9CisKK3ZvaWQgbXRrX2RybV9jcnRjX2N1
cnNvcl91cGRhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX3BsYW5lICpwbGFu
ZSwKKwkJCQlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3Qg
bXRrX2RybV9wcml2YXRlICpwcml2ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3Qg
bXRrX2RybV9jcnRjICptdGtfY3J0YyA9IHRvX210a19jcnRjKGNydGMpOworCWNvbnN0IHN0cnVj
dCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzICpwbGFuZV9oZWxwZXJfZnVuY3MgPQorCQkJcGxhbmUt
PmhlbHBlcl9wcml2YXRlOworCWludCBpOworCisJaWYgKCFtdGtfY3J0Yy0+ZW5hYmxlZCkKKwkJ
cmV0dXJuOworCisJbXV0ZXhfbG9jaygmcHJpdi0+aHdfbG9jayk7CisJcGxhbmVfaGVscGVyX2Z1
bmNzLT5hdG9taWNfdXBkYXRlKHBsYW5lLCBwbGFuZV9zdGF0ZSk7CisJZm9yIChpID0gMDsgaSA8
IG10a19jcnRjLT5sYXllcl9ucjsgaSsrKSB7CisJCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lID0g
Jm10a19jcnRjLT5wbGFuZXNbaV07CisJCXN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlOworCisJCXBsYW5lX3N0YXRlID0gdG9fbXRrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0ZSk7
CisJCWlmIChwbGFuZV9zdGF0ZS0+cGVuZGluZy5kaXJ0eSkgeworCQkJcGxhbmVfc3RhdGUtPnBl
bmRpbmcuY29uZmlnID0gdHJ1ZTsKKwkJCXBsYW5lX3N0YXRlLT5wZW5kaW5nLmRpcnR5ID0gZmFs
c2U7CisJCX0KKwl9CisJbXRrX2NydGMtPnBlbmRpbmdfcGxhbmVzID0gdHJ1ZTsKKwltdGtfY3J0
Yy0+Y3Vyc29yX3VwZGF0ZSA9IHRydWU7CisKKwlpZiAocHJpdi0+ZGF0YS0+c2hhZG93X3JlZ2lz
dGVyKSB7CisJCW10a19kaXNwX211dGV4X2FjcXVpcmUobXRrX2NydGMtPm11dGV4KTsKKwkJbXRr
X2NydGNfZGRwX2NvbmZpZyhjcnRjKTsKKwkJbXRrX2Rpc3BfbXV0ZXhfcmVsZWFzZShtdGtfY3J0
Yy0+bXV0ZXgpOwogCX0KKwltdXRleF91bmxvY2soJnByaXYtPmh3X2xvY2spOwogfQogCiBzdGF0
aWMgdm9pZCBtdGtfZHJtX2NydGNfYXRvbWljX2VuYWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmggYi9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgKaW5kZXggZmNjMTM0ZWIwMGM5
Li40NmU5MDNiZTY4ZWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX2NydGMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgK
QEAgLTE5LDUgKzE5LDcgQEAgdm9pZCBtdGtfY3J0Y19kZHBfaXJxKHN0cnVjdCBkcm1fY3J0YyAq
Y3J0Yywgc3RydWN0IG10a19kZHBfY29tcCAqY29tcCk7CiBpbnQgbXRrX2RybV9jcnRjX2NyZWF0
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiwKIAkJCWNvbnN0IGVudW0gbXRrX2RkcF9jb21w
X2lkICpwYXRoLAogCQkJdW5zaWduZWQgaW50IHBhdGhfbGVuKTsKK3ZvaWQgbXRrX2RybV9jcnRj
X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZSwKKwkJCQlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiAKICNlbmRp
ZiAvKiBNVEtfRFJNX0NSVENfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21lZGlh
dGVrL210a19kcm1fZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9kcnYu
YwppbmRleCBiMDMwOGEzYTc0ODMuLmNhNzU0Yjk1NGM3YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlh
dGVrL210a19kcm1fZHJ2LmMKQEAgLTgwLDExICs4MCwzNiBAQCBzdGF0aWMgaW50IG10a19hdG9t
aWNfZ2V0X2NydGNzKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sCiAJCQkJc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgKnByaXZhdGUgPSBk
cm0tPmRldl9wcml2YXRlOwotCXVpbnQzMl90IGNydGNfbWFzazsKKwl1aW50MzJfdCBjcnRjX21h
c2ssIG5lZWRzX21vZGVzZXQsIGhhc19jdXJzb3JfcGxhbmU7CisJc3RydWN0IGRybV9wbGFuZSAq
cGxhbmU7CisJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CisJc3RydWN0IGRy
bV9jcnRjICpjcnRjOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlpbnQg
aTsKIAlpbnQgcmV0OwogCiAJY3J0Y19tYXNrID0gbXRrX2F0b21pY19jcnRjX21hc2soZHJtLCBz
dGF0ZSk7CiAKKwkvKgorCSAqIEFsbG93IGN1cnNvciB1cGRhdGVzIHVubGVzcyB0aGVyZSBpcyBh
IHBlbmRpbmcgbW9kZXNldCBvciBjdXJzb3IKKwkgKiBwbGFuZSB1cGRhdGUuCisJICovCisJbmVl
ZHNfbW9kZXNldCA9IDA7CisJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMs
IGNydGNfc3RhdGUsIGkpIHsKKwkJaWYgKGNydGMgJiYgZHJtX2F0b21pY19jcnRjX25lZWRzX21v
ZGVzZXQoY3J0Y19zdGF0ZSkpIHsKKwkJCW5lZWRzX21vZGVzZXQgfD0gKDEgPDwgZHJtX2NydGNf
aW5kZXgoY3J0YykpOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwloYXNfY3Vyc29yX3BsYW5lID0g
MDsKKwlmb3JfZWFjaF9uZXdfcGxhbmVfaW5fc3RhdGUoc3RhdGUsIHBsYW5lLCBwbGFuZV9zdGF0
ZSwgaSkgeworCQlpZiAoY3J0YyAmJiBwbGFuZS0+Y3J0YyAmJiBwbGFuZSA9PSBwbGFuZS0+Y3J0
Yy0+Y3Vyc29yKSB7CisJCQloYXNfY3Vyc29yX3BsYW5lIHw9ICgxIDw8IGRybV9jcnRjX2luZGV4
KGNydGMpKTsKKwkJCWJyZWFrOworCQl9CisJfQorCiAJLyoKIAkgKiBXYWl0IGZvciBhbGwgcGVu
ZGluZyB1cGRhdGVzIHRvIGNvbXBsZXRlIGZvciB0aGUgc2V0IG9mIGNydGNzIGJlaW5nCiAJICog
Y2hhbmdlZCBpbiB0aGlzIGF0b21pYyBjb21taXQKQEAgLTk0LDYgKzExOSw4IEBAIHN0YXRpYyBp
bnQgbXRrX2F0b21pY19nZXRfY3J0Y3Moc3RydWN0IGRybV9kZXZpY2UgKmRybSwKIAkJCSEocHJp
dmF0ZS0+Y29tbWl0LmNydGNzICYgY3J0Y19tYXNrKSk7CiAJaWYgKHJldCA9PSAwKQogCQlwcml2
YXRlLT5jb21taXQuY3J0Y3MgfD0gY3J0Y19tYXNrOworCisJcHJpdmF0ZS0+Y29tbWl0LmZsdXNo
X2Zvcl9jdXJzb3IgfD0gbmVlZHNfbW9kZXNldCB8IGhhc19jdXJzb3JfcGxhbmU7CiAJc3Bpbl91
bmxvY2soJnByaXZhdGUtPmNvbW1pdC5jcnRjc19ldmVudC5sb2NrKTsKIAogCXJldHVybiByZXQ7
CkBAIC0xMTIsNiArMTM5LDcgQEAgc3RhdGljIHZvaWQgbXRrX2F0b21pY19wdXRfY3J0Y3Moc3Ry
dWN0IGRybV9kZXZpY2UgKmRybSwKIAogCXNwaW5fbG9jaygmcHJpdmF0ZS0+Y29tbWl0LmNydGNz
X2V2ZW50LmxvY2spOwogCXByaXZhdGUtPmNvbW1pdC5jcnRjcyAmPSB+Y3J0Y19tYXNrOworCXBy
aXZhdGUtPmNvbW1pdC5mbHVzaF9mb3JfY3Vyc29yICY9IH5jcnRjX21hc2s7CiAJd2FrZV91cF9h
bGxfbG9ja2VkKCZwcml2YXRlLT5jb21taXQuY3J0Y3NfZXZlbnQpOwogCXNwaW5fdW5sb2NrKCZw
cml2YXRlLT5jb21taXQuY3J0Y3NfZXZlbnQubG9jayk7CiB9CkBAIC0xNjAsNiArMTg4LDcgQEAg
c3RhdGljIHZvaWQgbXRrX2F0b21pY193YWl0X2Zvcl9mZW5jZXMoc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQogc3RhdGljIHZvaWQgbXRrX2F0b21pY19jb21wbGV0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZHJtLAogCQkJCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKKwlz
dHJ1Y3QgbXRrX2RybV9wcml2YXRlICpwcml2YXRlID0gZHJtLT5kZXZfcHJpdmF0ZTsKIAltdGtf
YXRvbWljX3dhaXRfZm9yX2ZlbmNlcyhzdGF0ZSk7CiAJLyoKIAkgKiBNZWRpYXRlayBkcm0gc3Vw
cG9ydHMgcnVudGltZSBQTSwgc28gcGxhbmUgcmVnaXN0ZXJzIGNhbm5vdCBiZQpAQCAtMTc1LDEw
ICsyMDQsMTIgQEAgc3RhdGljIHZvaWQgbXRrX2F0b21pY19jb21wbGV0ZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZHJtLAogCSAqCiAJICogU2VlIHRoZSBrZXJuZWxkb2MgZW50cmllcyBmb3IgdGhlc2Ug
dGhyZWUgZnVuY3Rpb25zIGZvciBtb3JlIGRldGFpbHMuCiAJICovCisJbXV0ZXhfbG9jaygmcHJp
dmF0ZS0+aHdfbG9jayk7CiAJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X21vZGVzZXRfZGlzYWJs
ZXMoZHJtLCBzdGF0ZSk7CiAJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X21vZGVzZXRfZW5hYmxl
cyhkcm0sIHN0YXRlKTsKIAlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfcGxhbmVzKGRybSwgc3Rh
dGUsCiAJCQkJCURSTV9QTEFORV9DT01NSVRfQUNUSVZFX09OTFkpOworCW11dGV4X3VubG9jaygm
cHJpdmF0ZS0+aHdfbG9jayk7CiAKIAlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl92Ymxhbmtz
KGRybSwgc3RhdGUpOwogCkBAIC00NjIsNiArNDkzLDcgQEAgc3RhdGljIGludCBtdGtfZHJtX2tt
c19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCiAJSU5JVF9MSVNUX0hFQUQoJnByaXZhdGUt
PnVucmVmZXJlbmNlLmxpc3QpOwogCXNwaW5fbG9ja19pbml0KCZwcml2YXRlLT51bnJlZmVyZW5j
ZS5sb2NrKTsKIAlpbml0X3dhaXRxdWV1ZV9oZWFkKCZwcml2YXRlLT5jb21taXQuY3J0Y3NfZXZl
bnQpOworCW11dGV4X2luaXQoJnByaXZhdGUtPmh3X2xvY2spOwogCiAJcmV0dXJuIDA7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Rydi5oIGIvZHJpdmVy
cy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fZHJ2LmgKaW5kZXggMDkzNGY4M2I4NjBkLi40YTRj
OTg5ODAzZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Ry
di5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Rydi5oCkBAIC01MCw2
ICs1MCw3IEBAIHN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgewogCXN0cnVjdCB7CiAJCXVpbnQzMl90
IGNydGNzOwogCQl3YWl0X3F1ZXVlX2hlYWRfdCBjcnRjc19ldmVudDsKKwkJdWludDMyX3QgZmx1
c2hfZm9yX2N1cnNvcjsKIAl9IGNvbW1pdDsKIAogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
dXNwZW5kX3N0YXRlOwpAQCAtNTgsNiArNTksOCBAQCBzdHJ1Y3QgbXRrX2RybV9wcml2YXRlIHsK
IAkJc3RydWN0IGxpc3RfaGVhZAlsaXN0OwogCQlzcGlubG9ja190CQlsb2NrOwogCX0gdW5yZWZl
cmVuY2U7CisKKwlzdHJ1Y3QgbXV0ZXggaHdfbG9jazsKIH07CiAKIGV4dGVybiBzdHJ1Y3QgcGxh
dGZvcm1fZHJpdmVyIG10a19kZHBfZHJpdmVyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L21lZGlhdGVrL210a19kcm1fcGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX3BsYW5lLmMKaW5kZXggZjJlZjgzYWVkNmY5Li41OWRiZGFmMDc0MjUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuYwpAQCAtNyw2ICs3LDcgQEAKICNpbmNsdWRl
IDxkcm0vZHJtUC5oPgogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CiAjaW5jbHVkZSA8ZHJt
L2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfdWFwaS5oPgog
I2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CiAKICNpbmNsdWRlICJtdGtfZHJtX2Ny
dGMuaCIKQEAgLTY5LDggKzcwLDcxIEBAIHN0YXRpYyB2b2lkIG10a19kcm1fcGxhbmVfZGVzdHJv
eV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlrZnJlZSh0b19tdGtfcGxhbmVfc3Rh
dGUoc3RhdGUpKTsKIH0KIAorc3RhdGljIGludCBtdGtfcGxhbmVfY3Vyc29yX3VwZGF0ZShzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkgICBzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJ
ICAgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJICAgaW50IGNydGNfeCwgaW50IGNy
dGNfeSwKKwkJCQkgICB1bnNpZ25lZCBpbnQgY3J0Y193LCB1bnNpZ25lZCBpbnQgY3J0Y19oLAor
CQkJCSAgIHVpbnQzMl90IHNyY194LCB1aW50MzJfdCBzcmNfeSwKKwkJCQkgICB1aW50MzJfdCBz
cmNfdywgdWludDMyX3Qgc3JjX2gpCit7CisJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGU7CisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MgKnBsYW5lX2hlbHBl
cl9mdW5jcyA9CisJCQlwbGFuZS0+aGVscGVyX3ByaXZhdGU7CisJaW50IHJldDsKKworCXBsYW5l
X3N0YXRlID0gcGxhbmUtPmZ1bmNzLT5hdG9taWNfZHVwbGljYXRlX3N0YXRlKHBsYW5lKTsKKwor
CXBsYW5lX3N0YXRlLT5jcnRjX3ggPSBjcnRjX3g7CisJcGxhbmVfc3RhdGUtPmNydGNfeSA9IGNy
dGNfeTsKKwlwbGFuZV9zdGF0ZS0+Y3J0Y19oID0gY3J0Y19oOworCXBsYW5lX3N0YXRlLT5jcnRj
X3cgPSBjcnRjX3c7CisJcGxhbmVfc3RhdGUtPnNyY194ID0gc3JjX3g7CisJcGxhbmVfc3RhdGUt
PnNyY195ID0gc3JjX3k7CisJcGxhbmVfc3RhdGUtPnNyY19oID0gc3JjX2g7CisJcGxhbmVfc3Rh
dGUtPnNyY193ID0gc3JjX3c7CisKKwlkcm1fYXRvbWljX3NldF9mYl9mb3JfcGxhbmUocGxhbmVf
c3RhdGUsIGZiKTsKKworCXJldCA9IHBsYW5lX2hlbHBlcl9mdW5jcy0+YXRvbWljX2NoZWNrKHBs
YW5lLCBwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZGVzdHJveTsKKworCXN3
YXAocGxhbmVfc3RhdGUsIHBsYW5lLT5zdGF0ZSk7CisKKwltdGtfZHJtX2NydGNfY3Vyc29yX3Vw
ZGF0ZShjcnRjLCBwbGFuZSwgcGxhbmVfc3RhdGUpOworCitlcnJfZGVzdHJveToKKwlwbGFuZS0+
ZnVuY3MtPmF0b21pY19kZXN0cm95X3N0YXRlKHBsYW5lLCBwbGFuZV9zdGF0ZSk7CisJcmV0dXJu
IHJldDsKK30KKworc3RhdGljIGludCBtdGtfcGxhbmVfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLAorCQkJICAgIHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCSAgICBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICBpbnQgY3J0Y194LCBpbnQgY3J0Y195LAorCQkJICAg
IHVuc2lnbmVkIGludCBjcnRjX3csIHVuc2lnbmVkIGludCBjcnRjX2gsCisJCQkgICAgdWludDMy
X3Qgc3JjX3gsIHVpbnQzMl90IHNyY195LAorCQkJICAgIHVpbnQzMl90IHNyY193LCB1aW50MzJf
dCBzcmNfaCwKKwkJCSAgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCkKK3sK
KwlzdHJ1Y3QgbXRrX2RybV9wcml2YXRlICpwcml2YXRlID0gcGxhbmUtPmRldi0+ZGV2X3ByaXZh
dGU7CisJdWludDMyX3QgY3J0Y19tYXNrID0gKDEgPDwgZHJtX2NydGNfaW5kZXgoY3J0YykpOwor
CisJaWYgKGNydGMgJiYgcGxhbmUgPT0gY3J0Yy0+Y3Vyc29yICYmCisJICAgIHBsYW5lLT5zdGF0
ZS0+Y3J0YyA9PSBjcnRjICYmCisJICAgICEocHJpdmF0ZS0+Y29tbWl0LmZsdXNoX2Zvcl9jdXJz
b3IgJiBjcnRjX21hc2spKQorCQlyZXR1cm4gbXRrX3BsYW5lX2N1cnNvcl91cGRhdGUocGxhbmUs
IGNydGMsIGZiLAorCQkJCWNydGNfeCwgY3J0Y195LCBjcnRjX3csIGNydGNfaCwKKwkJCQlzcmNf
eCwgc3JjX3ksIHNyY193LCBzcmNfaCk7CisKKwlyZXR1cm4gZHJtX2F0b21pY19oZWxwZXJfdXBk
YXRlX3BsYW5lKHBsYW5lLCBjcnRjLCBmYiwKKwkJCQkJICAgICAgY3J0Y194LCBjcnRjX3ksIGNy
dGNfdywgY3J0Y19oLAorCQkJCQkgICAgICBzcmNfeCwgc3JjX3ksIHNyY193LCBzcmNfaCwgY3R4
KTsKK30KKwogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgbXRrX3BsYW5lX2Z1
bmNzID0gewotCS51cGRhdGVfcGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfcGxhbmUs
CisJLnVwZGF0ZV9wbGFuZSA9IG10a19wbGFuZV91cGRhdGUsCiAJLmRpc2FibGVfcGxhbmUgPSBk
cm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLAogCS5kZXN0cm95ID0gZHJtX3BsYW5lX2Ns
ZWFudXAsCiAJLnJlc2V0ID0gbXRrX3BsYW5lX3Jlc2V0LApAQCAtOTAsNyArMTU0LDEyIEBAIHN0
YXRpYyBpbnQgbXRrX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAlpZiAoIXN0YXRlLT5jcnRjKQogCQlyZXR1cm4gMDsKIAotCWNydGNfc3RhdGUgPSBkcm1fYXRv
bWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwgc3RhdGUtPmNydGMpOworCWlmIChzdGF0
ZS0+c3RhdGUpCisJCWNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9leGlzdGluZ19jcnRjX3N0
YXRlKHN0YXRlLT5zdGF0ZSwKKwkJCQkJCQkJc3RhdGUtPmNydGMpOworCWVsc2UgLyogU3BlY2lh
bCBjYXNlIGZvciBhc3luY2hyb25vdXMgY3Vyc29yIHVwZGF0ZXMuICovCisJCWNydGNfc3RhdGUg
PSBzdGF0ZS0+Y3J0Yy0+c3RhdGU7CisKIAlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKQogCQlyZXR1
cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsKIAotLSAKMi4xOC4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
