Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5D08BF12DE
	for <lists+dri-devel@lfdr.de>; Wed,  6 Nov 2019 10:51:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 244DB6EC8C;
	Wed,  6 Nov 2019 09:51:28 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mslow2.mail.gandi.net (mslow2.mail.gandi.net [217.70.178.242])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 29DC96EC8C
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 09:51:25 +0000 (UTC)
Received: from relay10.mail.gandi.net (unknown [217.70.178.230])
 by mslow2.mail.gandi.net (Postfix) with ESMTP id 98C9F3B569B
 for <dri-devel@lists.freedesktop.org>; Wed,  6 Nov 2019 09:44:32 +0000 (UTC)
Received: from localhost.localdomain (lfbn-1-17395-211.w86-250.abo.wanadoo.fr
 [86.250.200.211])
 (Authenticated sender: paul.kocialkowski@bootlin.com)
 by relay10.mail.gandi.net (Postfix) with ESMTPSA id 1FFB8240018;
 Wed,  6 Nov 2019 09:44:10 +0000 (UTC)
From: Paul Kocialkowski <paul.kocialkowski@bootlin.com>
To: dri-devel@lists.freedesktop.org,
	linux-kernel@vger.kernel.org
Subject: [PATCH 2/2] drm/gma500: Add page flip support on psb/cdv
Date: Wed,  6 Nov 2019 10:44:00 +0100
Message-Id: <20191106094400.445834-3-paul.kocialkowski@bootlin.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191106094400.445834-1-paul.kocialkowski@bootlin.com>
References: <20191106094400.445834-1-paul.kocialkowski@bootlin.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>,
 Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
 James Hilliard <james.hilliard1@gmail.com>,
 Thomas Petazzoni <thomas.petazzoni@bootlin.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TGVnYWN5IChub24tYXRvbWljKSBwYWdlIGZsaXAgc3VwcG9ydCBpcyBhZGRlZCB0byB0aGUgZHJp
dmVyIGJ5IHVzaW5nIHRoZQptb2RlX3NldF9iYXNlIENSVEMgZnVuY3Rpb24sIHRoYXQgYWxsb3dz
IGNvbmZpZ3VyaW5nIGEgbmV3IGZyYW1lYnVmZmVyIGZvcgpkaXNwbGF5LiBTaW5jZSB0aGUgZnVu
Y3Rpb24gcmVxdWlyZXMgdGhlIHByaW1hcnkgcGxhbmUncyBmYiB0byBiZSBzZXQKYWxyZWFkeSwg
dGhpcyBpcyBkb25lIHByaW9yIHRvIGNhbGxpbmcgdGhlIGZ1bmN0aW9uIGluIHRoZSBwYWdlIGZs
aXAgaGVscGVyCmFuZCByZXZlcnRlZCBpZiB0aGUgZmxpcCBmYWlscy4KClRoZSB2YmxhbmsgaW50
ZXJydXB0IGhhbmRsZXIgaXMgYWxzbyByZWZhY3RvcmVkIHRvIHN1cHBvcnQgcGFzc2luZyBhbiBl
dmVudC4KVGhlIFBJUEVfVEVfU1RBVFVTIGJpdCBpcyBhbHNvIGNvbnNpZGVyZWQgdG8gaW5kaWNh
dGUgdmJsYW5rIG9uIG1lZGZpZWxkCm9ubHksIGFzIGV4cGxhaW5lZCBpbiBwc2JfZW5hYmxlX3Zi
bGFuay4KCkl0IHdhcyB0ZXN0ZWQgYnkgcnVubmluZyB3ZXN0b24gb24gYm90aCBwb3Vsc2JvIGFu
ZCBjZWRhcnRyYWlsLgoKU2lnbmVkLW9mZi1ieTogUGF1bCBLb2NpYWxrb3dza2kgPHBhdWwua29j
aWFsa293c2tpQGJvb3RsaW4uY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9nbWE1MDAvY2R2X2lu
dGVsX2Rpc3BsYXkuYyB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9nbWE1MDAvZ21hX2Rpc3BsYXku
YyAgICAgICB8IDQ2ICsrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9nbWE1
MDAvZ21hX2Rpc3BsYXkuaCAgICAgICB8ICA2ICsrKwogZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9w
c2JfaW50ZWxfZGlzcGxheS5jIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9wc2JfaW50
ZWxfZHJ2LmggICAgIHwgIDMgKysKIGRyaXZlcnMvZ3B1L2RybS9nbWE1MDAvcHNiX2lycS5jICAg
ICAgICAgICB8IDE4ICsrKysrKystLQogNiBmaWxlcyBjaGFuZ2VkLCA3MiBpbnNlcnRpb25zKCsp
LCAzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9nbWE1MDAvY2R2
X2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9nbWE1MDAvY2R2X2ludGVsX2Rpc3Bs
YXkuYwppbmRleCA4Yjc4NDk0N2VkM2IuLjcxMDlkM2QxOWJlMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2dtYTUwMC9jZHZfaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9nbWE1MDAvY2R2X2ludGVsX2Rpc3BsYXkuYwpAQCAtOTc5LDYgKzk3OSw3IEBAIGNvbnN0IHN0
cnVjdCBkcm1fY3J0Y19mdW5jcyBjZHZfaW50ZWxfY3J0Y19mdW5jcyA9IHsKIAkuZ2FtbWFfc2V0
ID0gZ21hX2NydGNfZ2FtbWFfc2V0LAogCS5zZXRfY29uZmlnID0gZ21hX2NydGNfc2V0X2NvbmZp
ZywKIAkuZGVzdHJveSA9IGdtYV9jcnRjX2Rlc3Ryb3ksCisJLnBhZ2VfZmxpcCA9IGdtYV9jcnRj
X3BhZ2VfZmxpcCwKIH07CiAKIGNvbnN0IHN0cnVjdCBnbWFfY2xvY2tfZnVuY3MgY2R2X2Nsb2Nr
X2Z1bmNzID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxh
eS5jIGIvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxheS5jCmluZGV4IGJjMDdhZTJh
OWExZC4uMTdmMTM2OTg1ZDIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZ21hNTAwL2dt
YV9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxheS5jCkBA
IC01MDMsNiArNTAzLDUyIEBAIHZvaWQgZ21hX2NydGNfZGVzdHJveShzdHJ1Y3QgZHJtX2NydGMg
KmNydGMpCiAJa2ZyZWUoZ21hX2NydGMpOwogfQogCitpbnQgZ21hX2NydGNfcGFnZV9mbGlwKHN0
cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJICAgICAgIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LAorCQkgICAgICAgc3RydWN0IGRybV9wZW5kaW5nX3ZibGFua19ldmVudCAqZXZlbnQsCisJCSAg
ICAgICB1aW50MzJfdCBwYWdlX2ZsaXBfZmxhZ3MsCisJCSAgICAgICBzdHJ1Y3QgZHJtX21vZGVz
ZXRfYWNxdWlyZV9jdHggKmN0eCkKK3sKKwlzdHJ1Y3QgZ21hX2NydGMgKmdtYV9jcnRjID0gdG9f
Z21hX2NydGMoY3J0Yyk7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqY3VycmVudF9mYiA9IGNy
dGMtPnByaW1hcnktPmZiOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKm9sZF9mYiA9IGNydGMt
PnByaW1hcnktPm9sZF9mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2NydGNfaGVscGVyX2Z1bmNzICpj
cnRjX2Z1bmNzID0gY3J0Yy0+aGVscGVyX3ByaXZhdGU7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGMtPmRldjsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCWludCByZXQ7CisKKwlpZiAo
IWNydGNfZnVuY3MtPm1vZGVfc2V0X2Jhc2UpCisJCXJldHVybiAtRUlOVkFMOworCisJLyogVXNp
bmcgbW9kZV9zZXRfYmFzZSByZXF1aXJlcyB0aGUgbmV3IGZiIHRvIGJlIHNldCBhbHJlYWR5LiAq
LworCWNydGMtPnByaW1hcnktPmZiID0gZmI7CisKKwlpZiAoZXZlbnQpIHsKKwkJc3Bpbl9sb2Nr
X2lycXNhdmUoJmRldi0+ZXZlbnRfbG9jaywgZmxhZ3MpOworCisJCVdBUk5fT04oZHJtX2NydGNf
dmJsYW5rX2dldChjcnRjKSAhPSAwKTsKKworCQlnbWFfY3J0Yy0+cGFnZV9mbGlwX2V2ZW50ID0g
ZXZlbnQ7CisKKwkJLyogQ2FsbCB0aGlzIGxvY2tlZCBpZiB3ZSB3YW50IGFuIGV2ZW50IGF0IHZi
bGFuayBpbnRlcnJ1cHQuICovCisJCXJldCA9IGNydGNfZnVuY3MtPm1vZGVfc2V0X2Jhc2UoY3J0
YywgY3J0Yy0+eCwgY3J0Yy0+eSwgb2xkX2ZiKTsKKwkJaWYgKHJldCkgeworCQkJZ21hX2NydGMt
PnBhZ2VfZmxpcF9ldmVudCA9IE5VTEw7CisJCQlkcm1fY3J0Y192YmxhbmtfcHV0KGNydGMpOwor
CQl9CisKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2LT5ldmVudF9sb2NrLCBmbGFncyk7
CisJfSBlbHNlIHsKKwkJcmV0ID0gY3J0Y19mdW5jcy0+bW9kZV9zZXRfYmFzZShjcnRjLCBjcnRj
LT54LCBjcnRjLT55LCBvbGRfZmIpOworCX0KKworCS8qIFJlc3RvcmUgcHJldmlvdXMgZmIgaW4g
Y2FzZSBvZiBmYWlsdXJlLiAqLworCWlmIChyZXQpCisJCWNydGMtPnByaW1hcnktPmZiID0gY3Vy
cmVudF9mYjsKKworCXJldHVybiByZXQ7Cit9CisKIGludCBnbWFfY3J0Y19zZXRfY29uZmlnKHN0
cnVjdCBkcm1fbW9kZV9zZXQgKnNldCwKIAkJCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0
eCAqY3R4KQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxh
eS5oIGIvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxheS5oCmluZGV4IGZkYmQ3ZWNh
YTU5Yy4uN2JkNmMxZWU4YjIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZ21hNTAwL2dt
YV9kaXNwbGF5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9nbWFfZGlzcGxheS5oCkBA
IC0xMSw2ICsxMSw3IEBACiAjZGVmaW5lIF9HTUFfRElTUExBWV9IXwogCiAjaW5jbHVkZSA8bGlu
dXgvcG1fcnVudGltZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CiAKIHN0cnVjdCBk
cm1fZW5jb2RlcjsKIHN0cnVjdCBkcm1fbW9kZV9zZXQ7CkBAIC03MSw2ICs3MiwxMSBAQCBleHRl
cm4gdm9pZCBnbWFfY3J0Y19wcmVwYXJlKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiBleHRlcm4g
dm9pZCBnbWFfY3J0Y19jb21taXQoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIGV4dGVybiB2b2lk
IGdtYV9jcnRjX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIGV4dGVybiB2b2lkIGdt
YV9jcnRjX2Rlc3Ryb3koc3RydWN0IGRybV9jcnRjICpjcnRjKTsKK2V4dGVybiBpbnQgZ21hX2Ny
dGNfcGFnZV9mbGlwKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCSAgICAgIHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgc3RydWN0IGRybV9wZW5kaW5nX3ZibGFua19ldmVu
dCAqZXZlbnQsCisJCQkgICAgICB1aW50MzJfdCBwYWdlX2ZsaXBfZmxhZ3MsCisJCQkgICAgICBz
dHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7CiBleHRlcm4gaW50IGdtYV9jcnRj
X3NldF9jb25maWcoc3RydWN0IGRybV9tb2RlX3NldCAqc2V0LAogCQkJICAgICAgIHN0cnVjdCBk
cm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2dtYTUwMC9wc2JfaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9w
c2JfaW50ZWxfZGlzcGxheS5jCmluZGV4IDQyNTY0MTA1MzVmMC4uZmVkM2I1NjNlNjJlIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZ21hNTAwL3BzYl9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2dtYTUwMC9wc2JfaW50ZWxfZGlzcGxheS5jCkBAIC00MzIsNiArNDMy
LDcgQEAgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIHBzYl9pbnRlbF9jcnRjX2Z1bmNzID0g
ewogCS5nYW1tYV9zZXQgPSBnbWFfY3J0Y19nYW1tYV9zZXQsCiAJLnNldF9jb25maWcgPSBnbWFf
Y3J0Y19zZXRfY29uZmlnLAogCS5kZXN0cm95ID0gZ21hX2NydGNfZGVzdHJveSwKKwkucGFnZV9m
bGlwID0gZ21hX2NydGNfcGFnZV9mbGlwLAogfTsKIAogY29uc3Qgc3RydWN0IGdtYV9jbG9ja19m
dW5jcyBwc2JfY2xvY2tfZnVuY3MgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ21h
NTAwL3BzYl9pbnRlbF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9nbWE1MDAvcHNiX2ludGVsX2Ry
di5oCmluZGV4IGNkZjEwMzMzZDFjMi4uMTZjNjEzNmY3NzhiIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vZ21hNTAwL3BzYl9pbnRlbF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ21h
NTAwL3BzYl9pbnRlbF9kcnYuaApAQCAtMTIsNiArMTIsNyBAQAogI2luY2x1ZGUgPGRybS9kcm1f
Y3J0Y19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4KICNpbmNsdWRlIDxk
cm0vZHJtX3Byb2JlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CiAjaW5j
bHVkZSA8bGludXgvZ3Bpby5oPgogI2luY2x1ZGUgImdtYV9kaXNwbGF5LmgiCiAKQEAgLTE4Miw2
ICsxODMsOCBAQCBzdHJ1Y3QgZ21hX2NydGMgewogCXN0cnVjdCBwc2JfaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZTsKIAogCWNvbnN0IHN0cnVjdCBnbWFfY2xvY2tfZnVuY3MgKmNsb2NrX2Z1
bmNzOworCisJc3RydWN0IGRybV9wZW5kaW5nX3ZibGFua19ldmVudCAqcGFnZV9mbGlwX2V2ZW50
OwogfTsKIAogI2RlZmluZSB0b19nbWFfY3J0Yyh4KQlcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vZ21hNTAwL3BzYl9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9nbWE1MDAvcHNiX2lycS5j
CmluZGV4IGU2MjY1ZmI4NTYyNi4uZjc4N2E1MWY2MzM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZ21hNTAwL3BzYl9pcnEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZ21hNTAwL3BzYl9p
cnEuYwpAQCAtMTY1LDExICsxNjUsMjMgQEAgc3RhdGljIHZvaWQgbWlkX3BpcGVfZXZlbnRfaGFu
ZGxlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgcGlwZSkKIAkJIiVzLCBjYW4ndCBjbGVh
ciBzdGF0dXMgYml0cyBmb3IgcGlwZSAlZCwgaXRzIHZhbHVlID0gMHgleC5cbiIsCiAJCV9fZnVu
Y19fLCBwaXBlLCBQU0JfUlZEQzMyKHBpcGVfc3RhdF9yZWcpKTsKIAotCWlmIChwaXBlX3N0YXRf
dmFsICYgUElQRV9WQkxBTktfU1RBVFVTKQotCQlkcm1faGFuZGxlX3ZibGFuayhkZXYsIHBpcGUp
OworCWlmIChwaXBlX3N0YXRfdmFsICYgUElQRV9WQkxBTktfU1RBVFVTIHx8CisJICAgIChJU19N
RkxEKGRldikgJiYgcGlwZV9zdGF0X3ZhbCAmIFBJUEVfVEVfU1RBVFVTKSkgeworCQlzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMgPSBkcm1fY3J0Y19mcm9tX2luZGV4KGRldiwgcGlwZSk7CisJCXN0cnVj
dCBnbWFfY3J0YyAqZ21hX2NydGMgPSB0b19nbWFfY3J0YyhjcnRjKTsKKwkJdW5zaWduZWQgbG9u
ZyBmbGFnczsKIAotCWlmIChwaXBlX3N0YXRfdmFsICYgUElQRV9URV9TVEFUVVMpCiAJCWRybV9o
YW5kbGVfdmJsYW5rKGRldiwgcGlwZSk7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmRldi0+ZXZl
bnRfbG9jaywgZmxhZ3MpOworCQlpZiAoZ21hX2NydGMtPnBhZ2VfZmxpcF9ldmVudCkgeworCQkJ
ZHJtX2NydGNfc2VuZF92YmxhbmtfZXZlbnQoY3J0YywKKwkJCQkJCSAgIGdtYV9jcnRjLT5wYWdl
X2ZsaXBfZXZlbnQpOworCQkJZ21hX2NydGMtPnBhZ2VfZmxpcF9ldmVudCA9IE5VTEw7CisJCQlk
cm1fY3J0Y192YmxhbmtfcHV0KGNydGMpOworCQl9CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JmRldi0+ZXZlbnRfbG9jaywgZmxhZ3MpOworCX0KIH0KIAogLyoKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
