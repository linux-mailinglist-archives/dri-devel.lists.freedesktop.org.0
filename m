Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 41CC112DA7
	for <lists+dri-devel@lfdr.de>; Fri,  3 May 2019 14:31:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3EE0C89F4A;
	Fri,  3 May 2019 12:31:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from lelv0143.ext.ti.com (lelv0143.ext.ti.com [198.47.23.248])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7C32B89E69
 for <dri-devel@lists.freedesktop.org>; Fri,  3 May 2019 12:31:37 +0000 (UTC)
Received: from fllv0035.itg.ti.com ([10.64.41.0])
 by lelv0143.ext.ti.com (8.15.2/8.15.2) with ESMTP id x43CVY40095288;
 Fri, 3 May 2019 07:31:34 -0500
Received: from DLEE103.ent.ti.com (dlee103.ent.ti.com [157.170.170.33])
 by fllv0035.itg.ti.com (8.15.2/8.15.2) with ESMTPS id x43CVYNQ129310
 (version=TLSv1.2 cipher=AES256-GCM-SHA384 bits=256 verify=FAIL);
 Fri, 3 May 2019 07:31:34 -0500
Received: from DLEE105.ent.ti.com (157.170.170.35) by DLEE103.ent.ti.com
 (157.170.170.33) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5; Fri, 3 May
 2019 07:31:33 -0500
Received: from fllv0039.itg.ti.com (10.64.41.19) by DLEE105.ent.ti.com
 (157.170.170.35) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5 via
 Frontend Transport; Fri, 3 May 2019 07:31:33 -0500
Received: from deskari.lan (ileax41-snat.itg.ti.com [10.172.224.153])
 by fllv0039.itg.ti.com (8.15.2/8.15.2) with ESMTP id x43CUYu6002029;
 Fri, 3 May 2019 07:31:31 -0500
From: Tomi Valkeinen <tomi.valkeinen@ti.com>
To: Andrzej Hajda <a.hajda@samsung.com>, Laurent Pinchart
 <Laurent.pinchart@ideasonboard.com>, Lucas Stach <l.stach@pengutronix.de>,
 Andrey Gusakov <andrey.gusakov@cogentembedded.com>, Philipp Zabel
 <p.zabel@pengutronix.de>, Andrey Smirnov <andrew.smirnov@gmail.com>, Peter
 Ujfalusi <peter.ujfalusi@ti.com>, Jyri Sarha <jsarha@ti.com>, Benoit Parrot
 <bparrot@ti.com>, <dri-devel@lists.freedesktop.org>
Subject: [PATCHv3 22/23] drm/bridge: tc358767: add IRQ and HPD support
Date: Fri, 3 May 2019 15:29:48 +0300
Message-ID: <20190503122949.12266-23-tomi.valkeinen@ti.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190503122949.12266-1-tomi.valkeinen@ti.com>
References: <20190503122949.12266-1-tomi.valkeinen@ti.com>
MIME-Version: 1.0
X-EXCLAIMER-MD-CONFIG: e1e8a2fd-e40a-4ac6-ac9b-f7e9cc9ee180
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ti.com; s=ti-com-17Q1; t=1556886694;
 bh=HtiTijCtRCdvsvy98YZqIh78PpHQLN3kKq0VvM5tUGg=;
 h=From:To:CC:Subject:Date:In-Reply-To:References;
 b=oWiCTq8AYxdbbY9BKe/BOGEtFAUNN9choB5VuAS/MrFsNw7RXYi38FDc2M46jktgM
 Rh5qC2am1yex2Q/u/NvAx52PVs2DoFg+8m9kxE4nkxyVl/AjGTwTd1ZI3FwTZ3fLfC
 Cs967wmOx3MugRLb2MoeFT1CW0l9+NG5VX0uEGjU=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomi Valkeinen <tomi.valkeinen@ti.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIHN1cHBvcnQgZm9yIGludGVycnVwdCBhbmQgaG90cGx1ZyBoYW5kbGluZy4gQm90aCBhcmUg
b3B0aW9uYWwuCgpTaWduZWQtb2ZmLWJ5OiBUb21pIFZhbGtlaW5lbiA8dG9taS52YWxrZWluZW5A
dGkuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvdGMzNTg3NjcuYyB8IDE2NiArKysr
KysrKysrKysrKysrKysrKysrKysrKy0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNDggaW5zZXJ0aW9u
cygrKSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRn
ZS90YzM1ODc2Ny5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90YzM1ODc2Ny5jCmluZGV4IDdj
Mjc1YjhiYmFiYy4uYjhjZmViMjMzNWNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJp
ZGdlL3RjMzU4NzY3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90YzM1ODc2Ny5jCkBA
IC03MSw2ICs3MSw3IEBACiAKIC8qIFN5c3RlbSAqLwogI2RlZmluZSBUQ19JRFJFRwkJMHgwNTAw
CisjZGVmaW5lIFNZU1NUQVQJCQkweDA1MDgKICNkZWZpbmUgU1lTQ1RSTAkJCTB4MDUxMAogI2Rl
ZmluZSBEUDBfQVVEU1JDX05PX0lOUFVUCQkoMCA8PCAzKQogI2RlZmluZSBEUDBfQVVEU1JDX0ky
U19SWAkJKDEgPDwgMykKQEAgLTc5LDkgKzgwLDE2IEBACiAjZGVmaW5lIERQMF9WSURTUkNfRFBJ
X1JYCQkoMiA8PCAwKQogI2RlZmluZSBEUDBfVklEU1JDX0NPTE9SX0JBUgkJKDMgPDwgMCkKICNk
ZWZpbmUgR1BJT00JCQkweDA1NDAKKyNkZWZpbmUgR1BJT0MJCQkweDA1NDQKKyNkZWZpbmUgR1BJ
T08JCQkweDA1NDgKICNkZWZpbmUgR1BJT0kJCQkweDA1NGMKICNkZWZpbmUgSU5UQ1RMX0cJCTB4
MDU2MAogI2RlZmluZSBJTlRTVFNfRwkJMHgwNTY0CisKKyNkZWZpbmUgSU5UX1NZU0VSUgkJQklU
KDE2KQorI2RlZmluZSBJTlRfR1BJT19IKHgpCQkoMSA8PCAoeCA9PSAwID8gMiA6IDEwKSkKKyNk
ZWZpbmUgSU5UX0dQSU9fTEMoeCkJCSgxIDw8ICh4ID09IDAgPyAzIDogMTEpKQorCiAjZGVmaW5l
IElOVF9HUDBfTENOVAkJMHgwNTg0CiAjZGVmaW5lIElOVF9HUDFfTENOVAkJMHgwNTg4CiAKQEAg
LTIxOSw2ICsyMjcsMTIgQEAgc3RydWN0IHRjX2RhdGEgewogCXN0cnVjdCBncGlvX2Rlc2MJKnNk
X2dwaW87CiAJc3RydWN0IGdwaW9fZGVzYwkqcmVzZXRfZ3BpbzsKIAlzdHJ1Y3QgY2xrCQkqcmVm
Y2xrOworCisJLyogZG8gd2UgaGF2ZSBJUlEgKi8KKwlib29sCQkJaGF2ZV9pcnE7CisKKwkvKiBI
UEQgcGluIG51bWJlciAoMCBvciAxKSBvciAtRU5PREVWICovCisJaW50CQkJaHBkX3BpbjsKIH07
CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IHRjX2RhdGEgKmF1eF90b190YyhzdHJ1Y3QgZHJtX2Rw
X2F1eCAqYSkKQEAgLTExMDksNiArMTEyMywxMiBAQCBzdGF0aWMgdm9pZCB0Y19icmlkZ2VfZW5h
YmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJc3RydWN0IHRjX2RhdGEgKnRjID0gYnJp
ZGdlX3RvX3RjKGJyaWRnZSk7CiAJaW50IHJldDsKIAorCXJldCA9IHRjX2dldF9kaXNwbGF5X3By
b3BzKHRjKTsKKwlpZiAocmV0IDwgMCkgeworCQlkZXZfZXJyKHRjLT5kZXYsICJmYWlsZWQgdG8g
cmVhZCBkaXNwbGF5IHByb3BzOiAlZFxuIiwgcmV0KTsKKwkJcmV0dXJuOworCX0KKwogCXJldCA9
IHRjX21haW5fbGlua19lbmFibGUodGMpOwogCWlmIChyZXQgPCAwKSB7CiAJCWRldl9lcnIodGMt
PmRldiwgIm1haW4gbGluayBlbmFibGUgZXJyb3I6ICVkXG4iLCByZXQpOwpAQCAtMTIxNCwxOSAr
MTIzNCw0MyBAQCBzdGF0aWMgaW50IHRjX2Nvbm5lY3Rvcl9nZXRfbW9kZXMoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvcikKIAlyZXR1cm4gY291bnQ7CiB9CiAKLXN0YXRpYyB2b2lkIHRj
X2Nvbm5lY3Rvcl9zZXRfcG9sbGluZyhzdHJ1Y3QgdGNfZGF0YSAqdGMsCi0JCQkJICAgICBzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQotewotCS8qIFRPRE86IGFkZCBzdXBwb3J0IGZv
ciBIUEQgKi8KLQljb25uZWN0b3ItPnBvbGxlZCA9IERSTV9DT05ORUNUT1JfUE9MTF9DT05ORUNU
IHwKLQkJCSAgICBEUk1fQ09OTkVDVE9SX1BPTExfRElTQ09OTkVDVDsKLX0KLQogc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2hlbHBlcl9mdW5jcyB0Y19jb25uZWN0b3JfaGVscGVy
X2Z1bmNzID0gewogCS5nZXRfbW9kZXMgPSB0Y19jb25uZWN0b3JfZ2V0X21vZGVzLAogfTsKIAor
c3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMgdGNfY29ubmVjdG9yX2RldGVjdChzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCQkJICAgICBib29sIGZvcmNlKQorewor
CXN0cnVjdCB0Y19kYXRhICp0YyA9IGNvbm5lY3Rvcl90b190Yyhjb25uZWN0b3IpOworCWJvb2wg
Y29ubjsKKwl1MzIgdmFsOworCWludCByZXQ7CisKKwlpZiAodGMtPmhwZF9waW4gPCAwKSB7CisJ
CWlmICghdGMtPnBhbmVsKQorCQkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfdW5rbm93bjsKKwor
CQljb25uID0gdHJ1ZTsKKwl9IGVsc2UgeworCQl0Y19yZWFkKEdQSU9JLCAmdmFsKTsKKworCQlj
b25uID0gdmFsICYgQklUKHRjLT5ocGRfcGluKTsKKwl9CisKKwlpZiAoZm9yY2UgJiYgY29ubikK
KwkJdGNfZ2V0X2Rpc3BsYXlfcHJvcHModGMpOworCisJaWYgKGNvbm4pCisJCXJldHVybiBjb25u
ZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZDsKKwllbHNlCisJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVz
X2Rpc2Nvbm5lY3RlZDsKKworZXJyOgorCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX3Vua25vd247
Cit9CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9mdW5jcyB0Y19jb25uZWN0
b3JfZnVuY3MgPSB7CisJLmRldGVjdCA9IHRjX2Nvbm5lY3Rvcl9kZXRlY3QsCiAJLmZpbGxfbW9k
ZXMgPSBkcm1faGVscGVyX3Byb2JlX3NpbmdsZV9jb25uZWN0b3JfbW9kZXMsCiAJLmRlc3Ryb3kg
PSBkcm1fY29ubmVjdG9yX2NsZWFudXAsCiAJLnJlc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfY29u
bmVjdG9yX3Jlc2V0LApAQCAtMTI0MSw3ICsxMjg1LDcgQEAgc3RhdGljIGludCB0Y19icmlkZ2Vf
YXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJc3RydWN0IGRybV9kZXZpY2UgKmRy
bSA9IGJyaWRnZS0+ZGV2OwogCWludCByZXQ7CiAKLQkvKiBDcmVhdGUgZURQIGNvbm5lY3RvciAq
LworCS8qIENyZWF0ZSBEUC9lRFAgY29ubmVjdG9yICovCiAJZHJtX2Nvbm5lY3Rvcl9oZWxwZXJf
YWRkKCZ0Yy0+Y29ubmVjdG9yLCAmdGNfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyk7CiAJcmV0ID0g
ZHJtX2Nvbm5lY3Rvcl9pbml0KGRybSwgJnRjLT5jb25uZWN0b3IsICZ0Y19jb25uZWN0b3JfZnVu
Y3MsCiAJCQkJIHRjLT5wYW5lbCA/IERSTV9NT0RFX0NPTk5FQ1RPUl9lRFAgOgpAQCAtMTI0OSw2
ICsxMjkzLDE1IEBAIHN0YXRpYyBpbnQgdGNfYnJpZGdlX2F0dGFjaChzdHJ1Y3QgZHJtX2JyaWRn
ZSAqYnJpZGdlKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwkvKiBEb24ndCBwb2xsIGlm
IGRvbid0IGhhdmUgSFBEIGNvbm5lY3RlZCAqLworCWlmICh0Yy0+aHBkX3BpbiA+PSAwKSB7CisJ
CWlmICh0Yy0+aGF2ZV9pcnEpCisJCQl0Yy0+Y29ubmVjdG9yLnBvbGxlZCA9IERSTV9DT05ORUNU
T1JfUE9MTF9IUEQ7CisJCWVsc2UKKwkJCXRjLT5jb25uZWN0b3IucG9sbGVkID0gRFJNX0NPTk5F
Q1RPUl9QT0xMX0NPTk5FQ1QgfAorCQkJCQkgICAgICAgRFJNX0NPTk5FQ1RPUl9QT0xMX0RJU0NP
Tk5FQ1Q7CisJfQorCiAJaWYgKHRjLT5wYW5lbCkKIAkJZHJtX3BhbmVsX2F0dGFjaCh0Yy0+cGFu
ZWwsICZ0Yy0+Y29ubmVjdG9yKTsKIApAQCAtMTMxNSw2ICsxMzY4LDQ5IEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgcmVnbWFwX2NvbmZpZyB0Y19yZWdtYXBfY29uZmlnID0gewogCS52YWxfZm9ybWF0
X2VuZGlhbiA9IFJFR01BUF9FTkRJQU5fTElUVExFLAogfTsKIAorc3RhdGljIGlycXJldHVybl90
IHRjX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgdGNfZGF0YSAq
dGMgPSBhcmc7CisJdTMyIHZhbDsKKwlpbnQgcjsKKworCXIgPSByZWdtYXBfcmVhZCh0Yy0+cmVn
bWFwLCBJTlRTVFNfRywgJnZhbCk7CisJaWYgKHIpCisJCXJldHVybiBJUlFfTk9ORTsKKworCWlm
ICghdmFsKQorCQlyZXR1cm4gSVJRX05PTkU7CisKKwlpZiAodmFsICYgSU5UX1NZU0VSUikgewor
CQl1MzIgc3RhdCA9IDA7CisKKwkJcmVnbWFwX3JlYWQodGMtPnJlZ21hcCwgU1lTU1RBVCwgJnN0
YXQpOworCisJCWRldl9lcnIodGMtPmRldiwgInN5c2VyciAleFxuIiwgc3RhdCk7CisJfQorCisJ
aWYgKHRjLT5ocGRfcGluID49IDAgJiYgdGMtPmJyaWRnZS5kZXYpIHsKKwkJLyoKKwkJICogSCBp
cyB0cmlnZ2VyZWQgd2hlbiB0aGUgR1BJTyBnb2VzIGhpZ2guCisJCSAqCisJCSAqIExDIGlzIHRy
aWdnZXJlZCB3aGVuIHRoZSBHUElPIGdvZXMgbG93IGFuZCBzdGF5cyBsb3cgZm9yCisJCSAqIHRo
ZSBkdXJhdGlvbiBvZiBMQ05UCisJCSAqLworCQlib29sIGggPSB2YWwgJiBJTlRfR1BJT19IKHRj
LT5ocGRfcGluKTsKKwkJYm9vbCBsYyA9IHZhbCAmIElOVF9HUElPX0xDKHRjLT5ocGRfcGluKTsK
KworCQlkZXZfZGJnKHRjLT5kZXYsICJHUElPJWQ6ICVzICVzXG4iLCB0Yy0+aHBkX3BpbiwKKwkJ
CWggPyAiSCIgOiAiIiwgbGMgPyAiTEMiIDogIiIpOworCisJCWlmIChoIHx8IGxjKQorCQkJZHJt
X2ttc19oZWxwZXJfaG90cGx1Z19ldmVudCh0Yy0+YnJpZGdlLmRldik7CisJfQorCisJcmVnbWFw
X3dyaXRlKHRjLT5yZWdtYXAsIElOVFNUU19HLCB2YWwpOworCisJcmV0dXJuIElSUV9IQU5ETEVE
OworfQorCiBzdGF0aWMgaW50IHRjX3Byb2JlKHN0cnVjdCBpMmNfY2xpZW50ICpjbGllbnQsIGNv
bnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkICppZCkKIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAm
Y2xpZW50LT5kZXY7CkBAIC0xMzY2LDYgKzE0NjIsMzMgQEAgc3RhdGljIGludCB0Y19wcm9iZShz
dHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50LCBjb25zdCBzdHJ1Y3QgaTJjX2RldmljZV9pZCAqaWQp
CiAJCXJldHVybiByZXQ7CiAJfQogCisJcmV0ID0gb2ZfcHJvcGVydHlfcmVhZF91MzIoZGV2LT5v
Zl9ub2RlLCAidG9zaGliYSxocGQtcGluIiwKKwkJCQkgICAmdGMtPmhwZF9waW4pOworCWlmIChy
ZXQpIHsKKwkJdGMtPmhwZF9waW4gPSAtRU5PREVWOworCX0gZWxzZSB7CisJCWlmICh0Yy0+aHBk
X3BpbiA8IDAgfHwgdGMtPmhwZF9waW4gPiAxKSB7CisJCQlkZXZfZXJyKGRldiwgImZhaWxlZCB0
byBwYXJzZSBIUEQgbnVtYmVyXG4iKTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwlpZiAo
Y2xpZW50LT5pcnEgPiAwKSB7CisJCS8qIGVuYWJsZSBTeXNFcnIgKi8KKwkJcmVnbWFwX3dyaXRl
KHRjLT5yZWdtYXAsIElOVENUTF9HLCBJTlRfU1lTRVJSKTsKKworCQlyZXQgPSBkZXZtX3JlcXVl
c3RfdGhyZWFkZWRfaXJxKGRldiwgY2xpZW50LT5pcnEsCisJCQkJCQlOVUxMLCB0Y19pcnFfaGFu
ZGxlciwKKwkJCQkJCUlSUUZfT05FU0hPVCwKKwkJCQkJCSJ0YzM1ODc2Ny1pcnEiLCB0Yyk7CisJ
CWlmIChyZXQpIHsKKwkJCWRldl9lcnIoZGV2LCAiZmFpbGVkIHRvIHJlZ2lzdGVyIGRwIGludGVy
cnVwdFxuIik7CisJCQlyZXR1cm4gcmV0OworCQl9CisKKwkJdGMtPmhhdmVfaXJxID0gdHJ1ZTsK
Kwl9CisKIAlyZXQgPSByZWdtYXBfcmVhZCh0Yy0+cmVnbWFwLCBUQ19JRFJFRywgJnRjLT5yZXYp
OwogCWlmIChyZXQpIHsKIAkJZGV2X2Vycih0Yy0+ZGV2LCAiY2FuIG5vdCByZWFkIGRldmljZSBJ
RDogJWRcbiIsIHJldCk7CkBAIC0xMzc5LDYgKzE1MDIsMjIgQEAgc3RhdGljIGludCB0Y19wcm9i
ZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50LCBjb25zdCBzdHJ1Y3QgaTJjX2RldmljZV9pZCAq
aWQpCiAKIAl0Yy0+YXNzciA9ICh0Yy0+cmV2ID09IDB4NjYwMSk7IC8qIEVuYWJsZSBBU1NSIGZv
ciBlRFAgcGFuZWxzICovCiAKKwlpZiAodGMtPmhwZF9waW4gPj0gMCkgeworCQl1MzIgbGNudF9y
ZWcgPSB0Yy0+aHBkX3BpbiA9PSAwID8gSU5UX0dQMF9MQ05UIDogSU5UX0dQMV9MQ05UOworCQl1
MzIgaF9sYyA9IElOVF9HUElPX0godGMtPmhwZF9waW4pIHwgSU5UX0dQSU9fTEModGMtPmhwZF9w
aW4pOworCisJCS8qIFNldCBMQ05UIHRvIDJtcyAqLworCQlyZWdtYXBfd3JpdGUodGMtPnJlZ21h
cCwgbGNudF9yZWcsCisJCQkgICAgIGNsa19nZXRfcmF0ZSh0Yy0+cmVmY2xrKSAqIDIgLyAxMDAw
KTsKKwkJLyogV2UgbmVlZCB0aGUgImFsdGVybmF0ZSIgbW9kZSBmb3IgSFBEICovCisJCXJlZ21h
cF93cml0ZSh0Yy0+cmVnbWFwLCBHUElPTSwgQklUKHRjLT5ocGRfcGluKSk7CisKKwkJaWYgKHRj
LT5oYXZlX2lycSkgeworCQkJLyogZW5hYmxlIEggJiBMQyAqLworCQkJcmVnbWFwX3VwZGF0ZV9i
aXRzKHRjLT5yZWdtYXAsIElOVENUTF9HLCBoX2xjLCBoX2xjKTsKKwkJfQorCX0KKwogCXJldCA9
IHRjX2F1eF9saW5rX3NldHVwKHRjKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtMTM5
MSwxMiArMTUzMCw2IEBAIHN0YXRpYyBpbnQgdGNfcHJvYmUoc3RydWN0IGkyY19jbGllbnQgKmNs
aWVudCwgY29uc3Qgc3RydWN0IGkyY19kZXZpY2VfaWQgKmlkKQogCWlmIChyZXQpCiAJCXJldHVy
biByZXQ7CiAKLQlyZXQgPSB0Y19nZXRfZGlzcGxheV9wcm9wcyh0Yyk7Ci0JaWYgKHJldCkKLQkJ
Z290byBlcnJfdW5yZWdpc3Rlcl9hdXg7Ci0KLQl0Y19jb25uZWN0b3Jfc2V0X3BvbGxpbmcodGMs
ICZ0Yy0+Y29ubmVjdG9yKTsKLQogCXRjLT5icmlkZ2UuZnVuY3MgPSAmdGNfYnJpZGdlX2Z1bmNz
OwogCXRjLT5icmlkZ2Uub2Zfbm9kZSA9IGRldi0+b2Zfbm9kZTsKIAlkcm1fYnJpZGdlX2FkZCgm
dGMtPmJyaWRnZSk7CkBAIC0xNDA0LDkgKzE1MzcsNiBAQCBzdGF0aWMgaW50IHRjX3Byb2JlKHN0
cnVjdCBpMmNfY2xpZW50ICpjbGllbnQsIGNvbnN0IHN0cnVjdCBpMmNfZGV2aWNlX2lkICppZCkK
IAlpMmNfc2V0X2NsaWVudGRhdGEoY2xpZW50LCB0Yyk7CiAKIAlyZXR1cm4gMDsKLWVycl91bnJl
Z2lzdGVyX2F1eDoKLQlkcm1fZHBfYXV4X3VucmVnaXN0ZXIoJnRjLT5hdXgpOwotCXJldHVybiBy
ZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdGNfcmVtb3ZlKHN0cnVjdCBpMmNfY2xpZW50ICpjbGllbnQp
Ci0tIApUZXhhcyBJbnN0cnVtZW50cyBGaW5sYW5kIE95LCBQb3Jra2FsYW5rYXR1IDIyLCAwMDE4
MCBIZWxzaW5raS4KWS10dW5udXMvQnVzaW5lc3MgSUQ6IDA2MTU1MjEtNC4gS290aXBhaWtrYS9E
b21pY2lsZTogSGVsc2lua2kKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2Ry
aS1kZXZlbA==
