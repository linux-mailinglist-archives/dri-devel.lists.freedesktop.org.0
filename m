Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 16B111BDCD7
	for <lists+dri-devel@lfdr.de>; Wed, 29 Apr 2020 14:58:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 67BD46EE1E;
	Wed, 29 Apr 2020 12:57:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 543 seconds by postgrey-1.36 at gabe;
 Wed, 29 Apr 2020 12:57:55 UTC
Received: from asav21.altibox.net (asav21.altibox.net [109.247.116.8])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8A6BA6E44D
 for <dri-devel@lists.freedesktop.org>; Wed, 29 Apr 2020 12:57:55 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav21.altibox.net (Postfix) with ESMTPSA id 461E78018E;
 Wed, 29 Apr 2020 14:48:52 +0200 (CEST)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org,
	linux-usb@vger.kernel.org
Subject: [PATCH 10/10] usb: gadget: function: Add Generic USB Display support
Date: Wed, 29 Apr 2020 14:48:30 +0200
Message-Id: <20200429124830.27475-11-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20200429124830.27475-1-noralf@tronnes.org>
References: <20200429124830.27475-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=AvXAIt1P c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=VwQbUJbxAAAA:8 a=SJz97ENfAAAA:8
 a=gAmX6pxEAAAA:20 a=e5mUnYsNAAAA:8 a=tKJ212r5Ezfkos4TZsYA:9
 a=CESHjfLgwwsqH_hn:21 a=acWXEmGTS3xcP_Zb:21 a=QEXdDO2ut3YA:10
 a=AjGcO6oz07-iQ99wixmX:22 a=vFet0B0WnEQeilDPIY6i:22
 a=Vxmtnl_E_bksehYqCbjh:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Felipe Balbi <balbi@kernel.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIHRoZSBnYWRnZXQgc2lkZSBzdXBwb3J0IGZvciB0aGUgR2VuZXJpYyBVU0IgRGlz
cGxheS4gSXQgcHJlc2VudHMKYSBEUk0gZGlzcGxheSBkZXZpY2UgYXMgYSBVU0IgRGlzcGxheSBj
b25maWd1cmVkIHRocm91Z2ggY29uZmlnZnMuCgpUaGUgZGlzcGxheSBpcyBpbXBsZW1lbnRlZCBh
cyBhIHZlbmRvciB0eXBlIFVTQiBpbnRlcmZhY2Ugd2l0aCBvbmUgYnVsawpvdXQgZW5kcG9pbnQu
IFRoZSBwcm90b2NvbCBpcyBpbXBsZW1lbnRlZCB1c2luZyBjb250cm9sIHJlcXVlc3RzLgpsejQg
Y29tcHJlc3NlZCBmcmFtZWJ1ZmZlciBkYXRhL3BpeGVscyBhcmUgc2VudCBvdmVyIHRoZSBidWxr
IGVuZHBvaW50LgoKVGhlIERSTSBwYXJ0IG9mIHRoZSBnYWRnZXQgaXMgcGxhY2VkIGluIHRoZSBE
Uk0gc3Vic3lzdGVtIHNpbmNlIGl0IHJlYWNoZXMKaW50byB0aGUgRFJNIGludGVybmFscy4KCkNj
OiBGZWxpcGUgQmFsYmkgPGJhbGJpQGtlcm5lbC5vcmc+ClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBU
csO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIC4uLi9BQkkvdGVzdGluZy9jb25maWdm
cy11c2ItZ2FkZ2V0LWd1ZF9kcm0gICB8ICAxMCArCiBNQUlOVEFJTkVSUyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy91c2IvZ2FkZ2V0L0tjb25maWcg
ICAgICAgICAgICAgICAgICAgIHwgIDEyICsKIGRyaXZlcnMvdXNiL2dhZGdldC9mdW5jdGlvbi9N
YWtlZmlsZSAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL3VzYi9nYWRnZXQvZnVuY3Rpb24vZl9n
dWRfZHJtLmMgICAgICAgfCA2NzggKysrKysrKysrKysrKysrKysrCiA1IGZpbGVzIGNoYW5nZWQs
IDcwNCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgRG9jdW1lbnRhdGlvbi9BQkkv
dGVzdGluZy9jb25maWdmcy11c2ItZ2FkZ2V0LWd1ZF9kcm0KIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL3VzYi9nYWRnZXQvZnVuY3Rpb24vZl9ndWRfZHJtLmMKCmRpZmYgLS1naXQgYS9Eb2N1
bWVudGF0aW9uL0FCSS90ZXN0aW5nL2NvbmZpZ2ZzLXVzYi1nYWRnZXQtZ3VkX2RybSBiL0RvY3Vt
ZW50YXRpb24vQUJJL3Rlc3RpbmcvY29uZmlnZnMtdXNiLWdhZGdldC1ndWRfZHJtCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZDZkODAyYzE2ZWViCi0tLSAvZGV2L251
bGwKKysrIGIvRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9jb25maWdmcy11c2ItZ2FkZ2V0LWd1
ZF9kcm0KQEAgLTAsMCArMSwxMCBAQAorV2hhdDoJCS9jb25maWcvdXNiLWdhZGdldC9nYWRnZXQv
ZnVuY3Rpb25zL2d1ZF9kcm0ubmFtZQorRGF0ZToJCUFwciAyMDIwCitLZXJuZWxWZXJzaW9uOgk1
LjgKK0Rlc2NyaXB0aW9uOgorCQlUaGUgYXR0cmlidXRlczoKKworCQlkcm1fZGV2IC0gRFJNIGRl
dmljZSBudW1iZXIKKwkJYmFja2xpZ2h0X2RldiAtIEJhY2tsaWdodCBkZXZpY2UgbmFtZSAob3B0
aW9uYWwpCisJCQkJVGhlIGJhY2tsaWdodCBicmlnaHRuZXNzIHNjYWxlIHNob3VsZCBiZQorCQkJ
CXBlcmNlcHR1YWwgbm90IGxpbmVhci4KZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIvTUFJTlRB
SU5FUlMKaW5kZXggYmI0NjA5OTg0ZTlhLi5mZTU2YzY4YmViMTEgMTAwNjQ0Ci0tLSBhL01BSU5U
QUlORVJTCisrKyBiL01BSU5UQUlORVJTCkBAIC01Mjg3LDcgKzUyODcsOSBAQCBNOglOb3JhbGYg
VHLDuG5uZXMgPG5vcmFsZkB0cm9ubmVzLm9yZz4KIFM6CU1haW50YWluZWQKIFc6CWh0dHBzOi8v
Z2l0aHViLmNvbS9ub3Ryby9ndWQvd2lraQogVDoJZ2l0IGdpdDovL2Fub25naXQuZnJlZWRlc2t0
b3Aub3JnL2RybS9kcm0tbWlzYworRjoJRG9jdW1lbnRhdGlvbi9BQkkvdGVzdGluZy9jb25maWdm
cy11c2ItZ2FkZ2V0LWd1ZF9kcm0KIEY6CWRyaXZlcnMvZ3B1L2RybS9ndWQvCitGOglkcml2ZXJz
L3VzYi9nYWRnZXQvZnVuY3Rpb24vZl9ndWRfZHJtLmMKIEY6CWluY2x1ZGUvZHJtL2d1ZF9kcm0u
aAogCiBEUk0gRFJJVkVSIEZPUiBHUkFJTiBNRURJQSBHTTEyVTMyMCBQUk9KRUNUT1JTCmRpZmYg
LS1naXQgYS9kcml2ZXJzL3VzYi9nYWRnZXQvS2NvbmZpZyBiL2RyaXZlcnMvdXNiL2dhZGdldC9L
Y29uZmlnCmluZGV4IGM2ZGIwYTBhMzQwYy4uOGQ5MGFkZDQ5NWI2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL3VzYi9nYWRnZXQvS2NvbmZpZworKysgYi9kcml2ZXJzL3VzYi9nYWRnZXQvS2NvbmZpZwpA
QCAtMjE2LDYgKzIxNiw5IEBAIGNvbmZpZyBVU0JfRl9QUklOVEVSCiBjb25maWcgVVNCX0ZfVENN
CiAJdHJpc3RhdGUKIAorY29uZmlnIFVTQl9GX0dVRF9EUk0KKwl0cmlzdGF0ZQorCiAjIHRoaXMg
Zmlyc3Qgc2V0IG9mIGRyaXZlcnMgYWxsIGRlcGVuZCBvbiBidWxrLWNhcGFibGUgaGFyZHdhcmUu
CiAKIGNvbmZpZyBVU0JfQ09ORklHRlMKQEAgLTQ4Myw2ICs0ODYsMTUgQEAgY29uZmlnIFVTQl9D
T05GSUdGU19GX1RDTQogCSAgQm90aCBwcm90b2NvbHMgY2FuIHdvcmsgb24gVVNCMi4wIGFuZCBV
U0IzLjAuCiAJICBVQVMgdXRpbGl6ZXMgdGhlIFVTQiAzLjAgZmVhdHVyZSBjYWxsZWQgc3RyZWFt
cyBzdXBwb3J0LgogCitjb25maWcgVVNCX0NPTkZJR0ZTX0ZfR1VEX0RSTQorCWJvb2wgIkdlbmVy
aWMgVVNCIERpc3BsYXkgR2FkZ2V0IGZ1bmN0aW9uIgorCWRlcGVuZHMgb24gVVNCX0NPTkZJR0ZT
CisJZGVwZW5kcyBvbiBEUk0KKwlzZWxlY3QgRFJNX0dVRF9HQURHRVQKKwlzZWxlY3QgVVNCX0Zf
R1VEX0RSTQorCWhlbHAKKwkgIFRoaXMgcHJlc2VudHMgYSBEUk0gZGlzcGxheSBkZXZpY2UgYXMg
YSBHZW5lcmljIFVTQiBEaXNwbGF5LgorCiBzb3VyY2UgImRyaXZlcnMvdXNiL2dhZGdldC9sZWdh
Y3kvS2NvbmZpZyIKIAogZW5kaWYgIyBVU0JfR0FER0VUCmRpZmYgLS1naXQgYS9kcml2ZXJzL3Vz
Yi9nYWRnZXQvZnVuY3Rpb24vTWFrZWZpbGUgYi9kcml2ZXJzL3VzYi9nYWRnZXQvZnVuY3Rpb24v
TWFrZWZpbGUKaW5kZXggNWQzYTZjZjAyMjE4Li5jZDcxY2FhMmEzNGMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvdXNiL2dhZGdldC9mdW5jdGlvbi9NYWtlZmlsZQorKysgYi9kcml2ZXJzL3VzYi9nYWRn
ZXQvZnVuY3Rpb24vTWFrZWZpbGUKQEAgLTUwLDMgKzUwLDUgQEAgdXNiX2ZfcHJpbnRlci15CQkJ
Oj0gZl9wcmludGVyLm8KIG9iai0kKENPTkZJR19VU0JfRl9QUklOVEVSKQkrPSB1c2JfZl9wcmlu
dGVyLm8KIHVzYl9mX3RjbS15CQkJOj0gZl90Y20ubwogb2JqLSQoQ09ORklHX1VTQl9GX1RDTSkJ
CSs9IHVzYl9mX3RjbS5vCit1c2JfZl9ndWRfZHJtLXkJCQk6PSBmX2d1ZF9kcm0ubworb2JqLSQo
Q09ORklHX1VTQl9GX0dVRF9EUk0pCSs9IHVzYl9mX2d1ZF9kcm0ubwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy91c2IvZ2FkZ2V0L2Z1bmN0aW9uL2ZfZ3VkX2RybS5jIGIvZHJpdmVycy91c2IvZ2FkZ2V0
L2Z1bmN0aW9uL2ZfZ3VkX2RybS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uOWEyZDZiYjk3MzlmCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy91c2IvZ2FkZ2V0
L2Z1bmN0aW9uL2ZfZ3VkX2RybS5jCkBAIC0wLDAgKzEsNjc4IEBACisvLyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAoQykgMjAyMCBOb3JhbGYgVHLD
uG5uZXMKKyAqLworCisjaW5jbHVkZSA8bGludXgvY29uZmlnZnMuaD4KKyNpbmNsdWRlIDxsaW51
eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9s
aXN0Lmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvbXV0ZXgu
aD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisjaW5jbHVkZSA8bGludXgvc3BpbmxvY2suaD4K
KyNpbmNsdWRlIDxsaW51eC91c2IvY29tcG9zaXRlLmg+CisjaW5jbHVkZSA8bGludXgvdXNiL2dh
ZGdldC5oPgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSA8ZHJtL2d1
ZF9kcm0uaD4KKworc3RydWN0IGZfZ3VkX2RybSB7CisJc3RydWN0IHVzYl9mdW5jdGlvbiBmdW5j
OworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrZXI7CisJc2l6ZV90IG1heF9idWZmZXJfc2l6ZTsK
Kwl2b2lkICpjdHJsX3JlcV9idWY7CisKKwl1OCBpbnRlcmZhY2VfaWQ7CisJc3RydWN0IHVzYl9y
ZXF1ZXN0ICpjdHJsX3JlcTsKKworCXN0cnVjdCB1c2JfZXAgKmJ1bGtfZXA7CisJc3RydWN0IHVz
Yl9yZXF1ZXN0ICpidWxrX3JlcTsKKworCXN0cnVjdCBndWRfZHJtX2dhZGdldCAqZ2RnOworCisJ
c3BpbmxvY2tfdCBsb2NrOyAvKiBQcm90ZWN0cyB0aGUgZm9sbG93aW5nIG1lbWJlcnM6ICovCisJ
Ym9vbCBjdHJsX3BlbmRpbmc7CisJYm9vbCBzdGF0dXNfcGVuZGluZzsKKwlib29sIGJ1bGtfcGVu
ZGluZzsKKwlib29sIGRpc2FibGVfcGVuZGluZzsKKwl1OCBlcnJubzsKKwl1MTYgcmVxdWVzdDsK
Kwl1MTYgdmFsdWU7Cit9OworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBmX2d1ZF9kcm0gKmZ1bmNf
dG9fZl9ndWRfZHJtKHN0cnVjdCB1c2JfZnVuY3Rpb24gKmYpCit7CisJcmV0dXJuIGNvbnRhaW5l
cl9vZihmLCBzdHJ1Y3QgZl9ndWRfZHJtLCBmdW5jKTsKK30KKworc3RydWN0IGZfZ3VkX2RybV9v
cHRzIHsKKwlzdHJ1Y3QgdXNiX2Z1bmN0aW9uX2luc3RhbmNlIGZ1bmNfaW5zdDsKKwlzdHJ1Y3Qg
bXV0ZXggbG9jazsKKwlpbnQgcmVmY250OworCisJdW5zaWduZWQgaW50IGRybV9kZXY7CisJY29u
c3QgY2hhciAqYmFja2xpZ2h0X2RldjsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGZfZ3Vk
X2RybV9vcHRzICpmaV90b19mX2d1ZF9kcm1fb3B0cyhjb25zdCBzdHJ1Y3QgdXNiX2Z1bmN0aW9u
X2luc3RhbmNlICpmaSkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGZpLCBzdHJ1Y3QgZl9ndWRf
ZHJtX29wdHMsIGZ1bmNfaW5zdCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGZfZ3VkX2Ry
bV9vcHRzICpjaV90b19mX2d1ZF9kcm1fb3B0cyhzdHJ1Y3QgY29uZmlnX2l0ZW0gKml0ZW0pCit7
CisJcmV0dXJuIGNvbnRhaW5lcl9vZih0b19jb25maWdfZ3JvdXAoaXRlbSksIHN0cnVjdCBmX2d1
ZF9kcm1fb3B0cywKKwkJCSAgICBmdW5jX2luc3QuZ3JvdXApOworfQorCisjZGVmaW5lIEZfTVVE
X0RFRklORV9CVUxLX0VORFBPSU5UX0RFU0NSSVBUT1IobmFtZSwgYWRkciwgc2l6ZSkJXAorCXN0
YXRpYyBzdHJ1Y3QgdXNiX2VuZHBvaW50X2Rlc2NyaXB0b3IgbmFtZSA9IHsJCVwKKwkJLmJMZW5n
dGggPQkJVVNCX0RUX0VORFBPSU5UX1NJWkUsCVwKKwkJLmJEZXNjcmlwdG9yVHlwZSA9CVVTQl9E
VF9FTkRQT0lOVCwJXAorCQkuYkVuZHBvaW50QWRkcmVzcyA9CWFkZHIsCQkJXAorCQkuYm1BdHRy
aWJ1dGVzID0JCVVTQl9FTkRQT0lOVF9YRkVSX0JVTEssCVwKKwkJLndNYXhQYWNrZXRTaXplID0J
Y3B1X3RvX2xlMTYoc2l6ZSksCVwKKwl9CisKK3N0YXRpYyBzdHJ1Y3QgdXNiX2ludGVyZmFjZV9k
ZXNjcmlwdG9yIGZfZ3VkX2RybV9pbnRmID0geworCS5iTGVuZ3RoID0JCVVTQl9EVF9JTlRFUkZB
Q0VfU0laRSwKKwkuYkRlc2NyaXB0b3JUeXBlID0JVVNCX0RUX0lOVEVSRkFDRSwKKwkuYk51bUVu
ZHBvaW50cyA9CTEsCisJLmJJbnRlcmZhY2VDbGFzcyA9CVVTQl9DTEFTU19WRU5ET1JfU1BFQywK
K307CisKK0ZfTVVEX0RFRklORV9CVUxLX0VORFBPSU5UX0RFU0NSSVBUT1IoZl9ndWRfZHJtX2Zz
X291dF9kZXNjLCBVU0JfRElSX09VVCwgMCk7CisKK3N0YXRpYyBzdHJ1Y3QgdXNiX2Rlc2NyaXB0
b3JfaGVhZGVyICpmX2d1ZF9kcm1fZnNfZnVuY3Rpb25bXSA9IHsKKwkoc3RydWN0IHVzYl9kZXNj
cmlwdG9yX2hlYWRlciAqKSZmX2d1ZF9kcm1faW50ZiwKKwkoc3RydWN0IHVzYl9kZXNjcmlwdG9y
X2hlYWRlciAqKSZmX2d1ZF9kcm1fZnNfb3V0X2Rlc2MsCisJTlVMTCwKK307CisKK0ZfTVVEX0RF
RklORV9CVUxLX0VORFBPSU5UX0RFU0NSSVBUT1IoZl9ndWRfZHJtX2hzX291dF9kZXNjLCBVU0Jf
RElSX09VVCwgNTEyKTsKKworc3RhdGljIHN0cnVjdCB1c2JfZGVzY3JpcHRvcl9oZWFkZXIgKmZf
Z3VkX2RybV9oc19mdW5jdGlvbltdID0geworCShzdHJ1Y3QgdXNiX2Rlc2NyaXB0b3JfaGVhZGVy
ICopJmZfZ3VkX2RybV9pbnRmLAorCShzdHJ1Y3QgdXNiX2Rlc2NyaXB0b3JfaGVhZGVyICopJmZf
Z3VkX2RybV9oc19vdXRfZGVzYywKKwlOVUxMLAorfTsKKworRl9NVURfREVGSU5FX0JVTEtfRU5E
UE9JTlRfREVTQ1JJUFRPUihmX2d1ZF9kcm1fc3Nfb3V0X2Rlc2MsIFVTQl9ESVJfT1VULCAxMDI0
KTsKKworc3RhdGljIHN0cnVjdCB1c2Jfc3NfZXBfY29tcF9kZXNjcmlwdG9yIGZfZ3VkX2RybV9z
c19idWxrX2NvbXBfZGVzYyA9IHsKKwkuYkxlbmd0aCA9CQlVU0JfRFRfU1NfRVBfQ09NUF9TSVpF
LAorCS5iRGVzY3JpcHRvclR5cGUgPQlVU0JfRFRfU1NfRU5EUE9JTlRfQ09NUCwKK307CisKK3N0
YXRpYyBzdHJ1Y3QgdXNiX2Rlc2NyaXB0b3JfaGVhZGVyICpmX2d1ZF9kcm1fc3NfZnVuY3Rpb25b
XSA9IHsKKwkoc3RydWN0IHVzYl9kZXNjcmlwdG9yX2hlYWRlciAqKSZmX2d1ZF9kcm1faW50ZiwK
Kwkoc3RydWN0IHVzYl9kZXNjcmlwdG9yX2hlYWRlciAqKSZmX2d1ZF9kcm1fc3Nfb3V0X2Rlc2Ms
CisJKHN0cnVjdCB1c2JfZGVzY3JpcHRvcl9oZWFkZXIgKikmZl9ndWRfZHJtX3NzX2J1bGtfY29t
cF9kZXNjLAorCU5VTEwsCit9OworCitzdGF0aWMgc3RydWN0IHVzYl9zdHJpbmcgZl9ndWRfZHJt
X3N0cmluZ19kZWZzW10gPSB7CisJWzBdLnMgPSAiR2VuZXJpYyBVU0IgRGlzcGxheSIsCisJeyAg
fSAvKiBlbmQgb2YgbGlzdCAqLworfTsKKworc3RhdGljIHN0cnVjdCB1c2JfZ2FkZ2V0X3N0cmlu
Z3MgZl9ndWRfZHJtX3N0cmluZ190YWJsZSA9IHsKKwkubGFuZ3VhZ2UgPQkweDA0MDksCS8qIGVu
LXVzICovCisJLnN0cmluZ3MgPQlmX2d1ZF9kcm1fc3RyaW5nX2RlZnMsCit9OworCitzdGF0aWMg
c3RydWN0IHVzYl9nYWRnZXRfc3RyaW5ncyAqZl9ndWRfZHJtX3N0cmluZ3NbXSA9IHsKKwkmZl9n
dWRfZHJtX3N0cmluZ190YWJsZSwKKwlOVUxMLAorfTsKKworc3RhdGljIHZvaWQgZl9ndWRfZHJt
X2J1bGtfY29tcGxldGUoc3RydWN0IHVzYl9lcCAqZXAsIHN0cnVjdCB1c2JfcmVxdWVzdCAqcmVx
KQoreworCXN0cnVjdCBmX2d1ZF9kcm0gKmZnZCA9IHJlcS0+Y29udGV4dDsKKwl1bnNpZ25lZCBs
b25nIGZsYWdzOworCisJaWYgKHJlcS0+c3RhdHVzIHx8IHJlcS0+YWN0dWFsICE9IHJlcS0+bGVu
Z3RoKQorCQlyZXR1cm47CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZmdkLT5sb2NrLCBmbGFncyk7
CisJZmdkLT5idWxrX3BlbmRpbmcgPSB0cnVlOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmZn
ZC0+bG9jaywgZmxhZ3MpOworCisJcXVldWVfd29yayhzeXN0ZW1fbG9uZ193cSwgJmZnZC0+d29y
a2VyKTsKK30KKworc3RhdGljIGludCBmX2d1ZF9kcm1fY3RybF9yZXFfc2V0X2J1ZmZlcihzdHJ1
Y3QgZl9ndWRfZHJtICpmZ2QsIHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwlpbnQgcmV0Owor
CisJaWYgKGxlbiAhPSBzaXplb2Yoc3RydWN0IGd1ZF9kcm1fcmVxX3NldF9idWZmZXIpKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCXJldCA9IGd1ZF9kcm1fZ2FkZ2V0X3NldF9idWZmZXIoZmdkLT5n
ZGcsIGJ1Zik7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlpZiAocmV0ID4gZmdk
LT5tYXhfYnVmZmVyX3NpemUpCisJCXJldHVybiAtRU9WRVJGTE9XOworCisJZmdkLT5idWxrX3Jl
cS0+bGVuZ3RoID0gcmV0OworCisJcmV0dXJuIHVzYl9lcF9xdWV1ZShmZ2QtPmJ1bGtfZXAsIGZn
ZC0+YnVsa19yZXEsIEdGUF9LRVJORUwpOworfQorCitzdGF0aWMgdm9pZCBmX2d1ZF9kcm1fd29y
a2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtICpmZ2Qg
PSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IGZfZ3VkX2RybSwgd29ya2VyKTsKKwlib29sIGN0
cmxfcGVuZGluZywgYnVsa19wZW5kaW5nLCBkaXNhYmxlX3BlbmRpbmc7CisJc3RydWN0IGd1ZF9k
cm1fZ2FkZ2V0ICpnZGcgPSBmZ2QtPmdkZzsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCXUxNiBy
ZXF1ZXN0LCB2YWx1ZTsKKwlpbnQgcmV0OworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmZnZC0+bG9j
aywgZmxhZ3MpOworCXJlcXVlc3QgPSBmZ2QtPnJlcXVlc3Q7CisJdmFsdWUgPSBmZ2QtPnZhbHVl
OworCWN0cmxfcGVuZGluZyA9IGZnZC0+Y3RybF9wZW5kaW5nOworCWJ1bGtfcGVuZGluZyA9IGZn
ZC0+YnVsa19wZW5kaW5nOworCWRpc2FibGVfcGVuZGluZyA9IGZnZC0+ZGlzYWJsZV9wZW5kaW5n
OworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmZnZC0+bG9jaywgZmxhZ3MpOworCisJcHJfZGVi
dWcoIiVzOiBidWxrX3BlbmRpbmc9JXUgY3RybF9wZW5kaW5nPSV1IGRpc2FibGVfcGVuZGluZz0l
dVxuIiwKKwkJIF9fZnVuY19fLCBidWxrX3BlbmRpbmcsIGN0cmxfcGVuZGluZywgZGlzYWJsZV9w
ZW5kaW5nKTsKKworCWlmIChkaXNhYmxlX3BlbmRpbmcpIHsKKwkJZ3VkX2RybV9nYWRnZXRfZGlz
YWJsZV9waXBlKGdkZyk7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmZnZC0+bG9jaywgZmxhZ3Mp
OworCQlmZ2QtPmRpc2FibGVfcGVuZGluZyA9IGZhbHNlOworCQlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwkJcmV0dXJuOworCX0KKworCWlmIChidWxrX3BlbmRp
bmcpIHsKKwkJc3RydWN0IHVzYl9yZXF1ZXN0ICpyZXEgPSBmZ2QtPmJ1bGtfcmVxOworCisJCXJl
dCA9IGd1ZF9kcm1fZ2FkZ2V0X3dyaXRlX2J1ZmZlcihnZGcsIHJlcS0+YnVmLCByZXEtPmFjdHVh
bCk7CisJCWlmIChyZXQpCisJCQlwcl9lcnIoIiVzOiBGYWlsZWQgdG8gd3JpdGUgYnVmZmVyLCBl
cnJvcj0lZFxuIiwgX19mdW5jX18sIHJldCk7CisKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmZnZC0+
bG9jaywgZmxhZ3MpOworCQlmZ2QtPmJ1bGtfcGVuZGluZyA9IGZhbHNlOworCQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwl9CisKKwlpZiAoY3RybF9wZW5kaW5n
KSB7CisJCXVuc2lnbmVkIGludCBsZW5ndGggPSBmZ2QtPmN0cmxfcmVxLT5sZW5ndGg7CisJCXZv
aWQgKmJ1ZiA9IGZnZC0+Y3RybF9yZXEtPmJ1ZjsKKworCQlpZiAocmVxdWVzdCA9PSBHVURfRFJN
X1VTQl9SRVFfU0VUX0JVRkZFUikKKwkJCXJldCA9IGZfZ3VkX2RybV9jdHJsX3JlcV9zZXRfYnVm
ZmVyKGZnZCwgYnVmLCBsZW5ndGgpOworCQllbHNlCisJCQlyZXQgPSBndWRfZHJtX2dhZGdldF9j
dHJsX3NldChnZGcsIHJlcXVlc3QsIHZhbHVlLCBidWYsIGxlbmd0aCk7CisKKwkJc3Bpbl9sb2Nr
X2lycXNhdmUoJmZnZC0+bG9jaywgZmxhZ3MpOworCQlpZiAoIWZnZC0+ZXJybm8pIC8qIERvbid0
IHNjcmliYmxlIG92ZXIgYW4gRUJVU1kgb3IgRVNIVVRET1dOICovCisJCQlmZ2QtPmVycm5vID0g
LXJldDsKKwkJZmdkLT5jdHJsX3BlbmRpbmcgPSBmYWxzZTsKKwkJZmdkLT5zdGF0dXNfcGVuZGlu
ZyA9IGZhbHNlOworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsK
Kwl9Cit9CisKK3N0YXRpYyB2b2lkIGZfZ3VkX2RybV9jdHJsX3JlcV9jb21wbGV0ZShzdHJ1Y3Qg
dXNiX2VwICplcCwgc3RydWN0IHVzYl9yZXF1ZXN0ICpyZXEpCit7CisJc3RydWN0IGZfZ3VkX2Ry
bSAqZmdkID0gcmVxLT5jb250ZXh0OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJaW50IHJldCA9
IDA7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZmdkLT5sb2NrLCBmbGFncyk7CisKKwlpZiAocmVx
LT5zdGF0dXMpCisJCXJldCA9IHJlcS0+c3RhdHVzOworCWVsc2UgaWYgKHJlcS0+YWN0dWFsICE9
IHJlcS0+bGVuZ3RoKQorCQlyZXQgPSAtRVJFTU9URUlPOworCWlmIChyZXQpIHsKKwkJZmdkLT5l
cnJubyA9IC1yZXQ7CisJCWZnZC0+c3RhdHVzX3BlbmRpbmcgPSBmYWxzZTsKKwl9IGVsc2Ugewor
CQlmZ2QtPmN0cmxfcGVuZGluZyA9IHRydWU7CisJfQorCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmZmdkLT5sb2NrLCBmbGFncyk7CisKKwlpZiAoIXJldCkKKwkJcXVldWVfd29yayhzeXN0ZW1f
bG9uZ193cSwgJmZnZC0+d29ya2VyKTsKK30KKworc3RhdGljIGludCBmX2d1ZF9kcm1fc2V0dXAo
c3RydWN0IHVzYl9mdW5jdGlvbiAqZiwgY29uc3Qgc3RydWN0IHVzYl9jdHJscmVxdWVzdCAqY3Ry
bCkKK3sKKwlzdHJ1Y3QgdXNiX2NvbXBvc2l0ZV9kZXYgKmNkZXYgPSBmLT5jb25maWctPmNkZXY7
CisJc3RydWN0IGZfZ3VkX2RybSAqZmdkID0gZnVuY190b19mX2d1ZF9kcm0oZik7CisJYm9vbCBp
biA9IGN0cmwtPmJSZXF1ZXN0VHlwZSAmIFVTQl9ESVJfSU47CisJdTE2IGxlbmd0aCA9IGxlMTZf
dG9fY3B1KGN0cmwtPndMZW5ndGgpOworCXUxNiB2YWx1ZSA9IGxlMTZfdG9fY3B1KGN0cmwtPndW
YWx1ZSk7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlpbnQgcmV0OworCisJaWYgKGN0cmwtPmJS
ZXF1ZXN0ID09IFVTQl9SRVFfR0VUX1NUQVRVUykgeworCQlzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0
X3N0YXR1cyAqc3RhdHVzID0gY2Rldi0+cmVxLT5idWY7CisKKwkJaWYgKCFpbiB8fCBsZW5ndGgg
IT0gc2l6ZW9mKCpzdGF0dXMpKQorCQkJcmV0dXJuIC1FSU5WQUw7CisKKwkJc3Bpbl9sb2NrX2ly
cXNhdmUoJmZnZC0+bG9jaywgZmxhZ3MpOworCQlzdGF0dXMtPmZsYWdzID0gMDsKKwkJaWYgKGZn
ZC0+c3RhdHVzX3BlbmRpbmcpCisJCQlzdGF0dXMtPmZsYWdzIHw9IEdVRF9EUk1fU1RBVFVTX1BF
TkRJTkc7CisJCXN0YXR1cy0+ZXJybm8gPSBmZ2QtPmVycm5vOworCQlzcGluX3VubG9ja19pcnFy
ZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwl9IGVsc2UgaWYgKGluKSB7CisJCWlmIChsZW5n
dGggPiBVU0JfQ09NUF9FUDBfQlVGU0laKSAvKiA0ayAqLworCQkJcmV0dXJuIC1FT1ZFUkZMT1c7
CisKKwkJcmV0ID0gZ3VkX2RybV9nYWRnZXRfY3RybF9nZXQoZmdkLT5nZGcsIGN0cmwtPmJSZXF1
ZXN0LCB2YWx1ZSwKKwkJCQkJICAgICAgY2Rldi0+cmVxLT5idWYsIGxlbmd0aCk7CisJCXNwaW5f
bG9ja19pcnFzYXZlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwkJZmdkLT5zdGF0dXNfcGVuZGluZyA9
IGZhbHNlOworCQlmZ2QtPmVycm5vID0gcmV0IDwgMCA/IC1yZXQgOiAwOworCQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1
cm4gcmV0OworCisJCWxlbmd0aCA9IHJldDsKKwl9IGVsc2UgeworCQlpZiAobGVuZ3RoID4gR1VE
X0RSTV9NQVhfVFJBTlNGRVJfU0laRSkKKwkJCXJldHVybiAtRU9WRVJGTE9XOworCisJCXNwaW5f
bG9ja19pcnFzYXZlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwkJaWYgKGZnZC0+Y3RybF9wZW5kaW5n
KSB7CisJCQkvKiBJZiB3ZSBnZXQgaGVyZSB0aGUgaG9zdCBoYXMgdGltZWQgb3V0IG9uIHRoZSBw
cmV2aW91cyByZXF1ZXN0ICovCisJCQlyZXQgPSAtRUJVU1k7CisJCQlmZ2QtPnN0YXR1c19wZW5k
aW5nID0gZmFsc2U7CisJCQlmZ2QtPmVycm5vID0gLXJldDsKKwkJfSBlbHNlIHsKKwkJCXJldCA9
IDA7CisJCQlmZ2QtPmVycm5vID0gMDsKKwkJCWZnZC0+cmVxdWVzdCA9IGN0cmwtPmJSZXF1ZXN0
OworCQkJZmdkLT52YWx1ZSA9IHZhbHVlOworCQkJZmdkLT5zdGF0dXNfcGVuZGluZyA9IHRydWU7
CisJCX0KKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZmdkLT5sb2NrLCBmbGFncyk7CisKKwkJ
aWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJZmdkLT5jdHJsX3JlcS0+bGVuZ3RoID0gbGVu
Z3RoOworCisJCXJldHVybiB1c2JfZXBfcXVldWUoY2Rldi0+Z2FkZ2V0LT5lcDAsIGZnZC0+Y3Ry
bF9yZXEsIEdGUF9BVE9NSUMpOworCX0KKworCWNkZXYtPnJlcS0+bGVuZ3RoID0gbGVuZ3RoOwor
CisJcmV0dXJuIHVzYl9lcF9xdWV1ZShjZGV2LT5nYWRnZXQtPmVwMCwgY2Rldi0+cmVxLCBHRlBf
QVRPTUlDKTsKK30KKworc3RhdGljIGJvb2wgZl9ndWRfZHJtX3JlcV9tYXRjaChzdHJ1Y3QgdXNi
X2Z1bmN0aW9uICpmLCBjb25zdCBzdHJ1Y3QgdXNiX2N0cmxyZXF1ZXN0ICpjdHJsLAorCQkJCWJv
b2wgY29uZmlnMCkKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtICpmZ2QgPSBmdW5jX3RvX2ZfZ3VkX2Ry
bShmKTsKKworCWlmIChjb25maWcwKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAoKGN0cmwtPmJS
ZXF1ZXN0VHlwZSAmIFVTQl9UWVBFX01BU0spICE9IFVTQl9UWVBFX1ZFTkRPUikKKwkJcmV0dXJu
IGZhbHNlOworCisJaWYgKChjdHJsLT5iUmVxdWVzdFR5cGUgJiBVU0JfUkVDSVBfTUFTSykgIT0g
VVNCX1JFQ0lQX0lOVEVSRkFDRSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIGZnZC0+aW50
ZXJmYWNlX2lkID09IGxlMTZfdG9fY3B1KGN0cmwtPndJbmRleCk7Cit9CisKK3N0YXRpYyBpbnQg
Zl9ndWRfZHJtX3NldF9hbHQoc3RydWN0IHVzYl9mdW5jdGlvbiAqZiwgdW5zaWduZWQgaW50IGlu
dGYsIHVuc2lnbmVkIGludCBhbHQpCit7CisJc3RydWN0IHVzYl9jb21wb3NpdGVfZGV2ICpjZGV2
ID0gZi0+Y29uZmlnLT5jZGV2OworCXN0cnVjdCBmX2d1ZF9kcm0gKmZnZCA9IGZ1bmNfdG9fZl9n
dWRfZHJtKGYpOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlpZiAoYWx0IHx8IGludGYgIT0g
ZmdkLT5pbnRlcmZhY2VfaWQpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKCFmZ2QtPmJ1bGtf
ZXAtPmRlc2MpIHsKKwkJcHJfZGVidWcoIiVzOiBpbml0XG4iLCBfX2Z1bmNfXyk7CisJCWlmIChj
b25maWdfZXBfYnlfc3BlZWQoY2Rldi0+Z2FkZ2V0LCBmLCBmZ2QtPmJ1bGtfZXApKSB7CisJCQlm
Z2QtPmJ1bGtfZXAtPmRlc2MgPSBOVUxMOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwl9CisK
Kwlwcl9kZWJ1ZygiJXM6IHJlc2V0XG4iLCBfX2Z1bmNfXyk7CisKKwl1c2JfZXBfZGlzYWJsZShm
Z2QtPmJ1bGtfZXApOworCXVzYl9lcF9lbmFibGUoZmdkLT5idWxrX2VwKTsKKworCXNwaW5fbG9j
a19pcnFzYXZlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKwlmZ2QtPmN0cmxfcGVuZGluZyA9IGZhbHNl
OworCWZnZC0+YnVsa19wZW5kaW5nID0gZmFsc2U7CisJZmdkLT5kaXNhYmxlX3BlbmRpbmcgPSBm
YWxzZTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgdm9pZCBmX2d1ZF9kcm1fZGlzYWJsZShzdHJ1Y3QgdXNiX2Z1
bmN0aW9uICpmKQoreworCXN0cnVjdCBmX2d1ZF9kcm0gKmZnZCA9IGZ1bmNfdG9fZl9ndWRfZHJt
KGYpOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlwcl9kZWJ1ZygiJXNcbiIsIF9fZnVuY19f
KTsKKworCXVzYl9lcF9kaXNhYmxlKGZnZC0+YnVsa19lcCk7CisKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmZmdkLT5sb2NrLCBmbGFncyk7CisJZmdkLT5jdHJsX3BlbmRpbmcgPSBmYWxzZTsKKwlmZ2Qt
PmJ1bGtfcGVuZGluZyA9IGZhbHNlOworCWZnZC0+c3RhdHVzX3BlbmRpbmcgPSBmYWxzZTsKKwlm
Z2QtPmRpc2FibGVfcGVuZGluZyA9IHRydWU7CisJZmdkLT5lcnJubyA9IEVTSFVURE9XTjsKKwlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZmZ2QtPmxvY2ssIGZsYWdzKTsKKworCXF1ZXVlX3dvcmso
c3lzdGVtX2xvbmdfd3EsICZmZ2QtPndvcmtlcik7Cit9CisKK3N0YXRpYyB2b2lkIGZfZ3VkX2Ry
bV91bmJpbmQoc3RydWN0IHVzYl9jb25maWd1cmF0aW9uICpjLCBzdHJ1Y3QgdXNiX2Z1bmN0aW9u
ICpmKQoreworCXN0cnVjdCBmX2d1ZF9kcm0gKmZnZCA9IGZ1bmNfdG9fZl9ndWRfZHJtKGYpOwor
CXN0cnVjdCB1c2JfY29tcG9zaXRlX2RldiAqY2RldiA9IGZnZC0+ZnVuYy5jb25maWctPmNkZXY7
CisKKwlmbHVzaF93b3JrKCZmZ2QtPndvcmtlcik7CisKKwlndWRfZHJtX2dhZGdldF9maW5pKGZn
ZC0+Z2RnKTsKKwlmZ2QtPmdkZyA9IE5VTEw7CisKKwlrZnJlZShmZ2QtPmJ1bGtfcmVxLT5idWYp
OworCXVzYl9lcF9mcmVlX3JlcXVlc3QoZmdkLT5idWxrX2VwLCBmZ2QtPmJ1bGtfcmVxKTsKKwl1
c2JfZXBfZnJlZV9yZXF1ZXN0KGNkZXYtPmdhZGdldC0+ZXAwLCBmZ2QtPmN0cmxfcmVxKTsKKwlm
Z2QtPmN0cmxfcmVxID0gTlVMTDsKKwlmZ2QtPmJ1bGtfcmVxID0gTlVMTDsKKwlmZ2QtPmJ1bGtf
ZXAgPSBOVUxMOworCisJdXNiX2ZyZWVfYWxsX2Rlc2NyaXB0b3JzKGYpOworfQorCitzdGF0aWMg
aW50IGZfZ3VkX2RybV9iaW5kKHN0cnVjdCB1c2JfY29uZmlndXJhdGlvbiAqYywgc3RydWN0IHVz
Yl9mdW5jdGlvbiAqZikKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtX29wdHMgKm9wdHMgPSBmaV90b19m
X2d1ZF9kcm1fb3B0cyhmLT5maSk7CisJc3RydWN0IHVzYl9jb21wb3NpdGVfZGV2ICpjZGV2ID0g
Yy0+Y2RldjsKKwlzdHJ1Y3QgZl9ndWRfZHJtICpmZ2QgPSBmdW5jX3RvX2ZfZ3VkX2RybShmKTsK
KwlzdHJ1Y3QgdXNiX3JlcXVlc3QgKmN0cmxfcmVxLCAqYnVsa19yZXE7CisJc3RydWN0IGd1ZF9k
cm1fZ2FkZ2V0ICpnZGc7CisJc3RydWN0IHVzYl9zdHJpbmcgKnVzOworCXZvaWQgKmJ1ZjsKKwlp
bnQgcmV0OworCisJdXMgPSB1c2JfZ3N0cmluZ3NfYXR0YWNoKGNkZXYsIGZfZ3VkX2RybV9zdHJp
bmdzLAorCQkJCSBBUlJBWV9TSVpFKGZfZ3VkX2RybV9zdHJpbmdfZGVmcykpOworCWlmIChJU19F
UlIodXMpKQorCQlyZXR1cm4gUFRSX0VSUih1cyk7CisKKwlmX2d1ZF9kcm1faW50Zi5pSW50ZXJm
YWNlID0gdXNbMF0uaWQ7CisKKwlyZXQgPSB1c2JfaW50ZXJmYWNlX2lkKGMsIGYpOworCWlmIChy
ZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJZmdkLT5pbnRlcmZhY2VfaWQgPSByZXQ7CisJZl9n
dWRfZHJtX2ludGYuYkludGVyZmFjZU51bWJlciA9IGZnZC0+aW50ZXJmYWNlX2lkOworCisJZmdk
LT5idWxrX2VwID0gdXNiX2VwX2F1dG9jb25maWcoY2Rldi0+Z2FkZ2V0LCAmZl9ndWRfZHJtX2Zz
X291dF9kZXNjKTsKKwlpZiAoIWZnZC0+YnVsa19lcCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlm
X2d1ZF9kcm1faHNfb3V0X2Rlc2MuYkVuZHBvaW50QWRkcmVzcyA9IGZfZ3VkX2RybV9mc19vdXRf
ZGVzYy5iRW5kcG9pbnRBZGRyZXNzOworCisJZl9ndWRfZHJtX3NzX291dF9kZXNjLmJFbmRwb2lu
dEFkZHJlc3MgPSBmX2d1ZF9kcm1fZnNfb3V0X2Rlc2MuYkVuZHBvaW50QWRkcmVzczsKKworCXJl
dCA9IHVzYl9hc3NpZ25fZGVzY3JpcHRvcnMoZiwgZl9ndWRfZHJtX2ZzX2Z1bmN0aW9uLCBmX2d1
ZF9kcm1faHNfZnVuY3Rpb24sCisJCQkJICAgICBmX2d1ZF9kcm1fc3NfZnVuY3Rpb24sIE5VTEwp
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwljdHJsX3JlcSA9IHVzYl9lcF9hbGxvY19y
ZXF1ZXN0KGNkZXYtPmdhZGdldC0+ZXAwLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWN0cmxfcmVxKSB7
CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZmFpbF9mcmVlX2Rlc2NzOworCX0KKworCWN0cmxf
cmVxLT5idWYgPSBmZ2QtPmN0cmxfcmVxX2J1ZjsKKwljdHJsX3JlcS0+Y29tcGxldGUgPSBmX2d1
ZF9kcm1fY3RybF9yZXFfY29tcGxldGU7CisJY3RybF9yZXEtPmNvbnRleHQgPSBmZ2Q7CisKKwln
ZGcgPSBndWRfZHJtX2dhZGdldF9pbml0KG9wdHMtPmRybV9kZXYsIG9wdHMtPmJhY2tsaWdodF9k
ZXYsICZmZ2QtPm1heF9idWZmZXJfc2l6ZSk7CisJaWYgKElTX0VSUihnZGcpKSB7CisJCXJldCA9
IFBUUl9FUlIoZ2RnKTsKKwkJZ290byBmYWlsX2ZyZWVfY3RybF9yZXE7CisJfQorCisJYnVsa19y
ZXEgPSB1c2JfZXBfYWxsb2NfcmVxdWVzdChmZ2QtPmJ1bGtfZXAsIEdGUF9LRVJORUwpOworCWlm
ICghYnVsa19yZXEpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBmYWlsX2ZyZWVfY3RybF9y
ZXE7CisJfQorCisJYnVmID0ga21hbGxvYyhmZ2QtPm1heF9idWZmZXJfc2l6ZSwgR0ZQX0tFUk5F
TCk7CisJaWYgKCFidWYpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBmYWlsX2ZyZWVfYnVs
a19yZXE7CisJfQorCisJYnVsa19yZXEtPmNvbXBsZXRlID0gZl9ndWRfZHJtX2J1bGtfY29tcGxl
dGU7CisJYnVsa19yZXEtPmNvbnRleHQgPSBmZ2Q7CisJYnVsa19yZXEtPmJ1ZiA9IGJ1ZjsKKwor
CWZnZC0+Y3RybF9yZXEgPSBjdHJsX3JlcTsKKwlmZ2QtPmJ1bGtfcmVxID0gYnVsa19yZXE7CisJ
ZmdkLT5nZGcgPSBnZGc7CisKKwlyZXR1cm4gMDsKKworZmFpbF9mcmVlX2J1bGtfcmVxOgorCXVz
Yl9lcF9mcmVlX3JlcXVlc3QoZmdkLT5idWxrX2VwLCBidWxrX3JlcSk7CitmYWlsX2ZyZWVfY3Ry
bF9yZXE6CisJdXNiX2VwX2ZyZWVfcmVxdWVzdChjZGV2LT5nYWRnZXQtPmVwMCwgY3RybF9yZXEp
OworZmFpbF9mcmVlX2Rlc2NzOgorCXVzYl9mcmVlX2FsbF9kZXNjcmlwdG9ycyhmKTsKKworCXJl
dHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGZfZ3VkX2RybV9mcmVlX2Z1bmMoc3RydWN0IHVz
Yl9mdW5jdGlvbiAqZikKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtX29wdHMgKm9wdHMgPSBjb250YWlu
ZXJfb2YoZi0+ZmksIHN0cnVjdCBmX2d1ZF9kcm1fb3B0cywgZnVuY19pbnN0KTsKKwlzdHJ1Y3Qg
Zl9ndWRfZHJtICpmZ2QgPSBmdW5jX3RvX2ZfZ3VkX2RybShmKTsKKworCW11dGV4X2xvY2soJm9w
dHMtPmxvY2spOworCW9wdHMtPnJlZmNudC0tOworCW11dGV4X3VubG9jaygmb3B0cy0+bG9jayk7
CisKKwlrZnJlZShmZ2QtPmN0cmxfcmVxX2J1Zik7CisJa2ZyZWUoZmdkKTsKK30KKworc3RhdGlj
IHN0cnVjdCB1c2JfZnVuY3Rpb24gKmZfZ3VkX2RybV9hbGxvY19mdW5jKHN0cnVjdCB1c2JfZnVu
Y3Rpb25faW5zdGFuY2UgKmZpKQoreworCXN0cnVjdCBmX2d1ZF9kcm1fb3B0cyAqb3B0cyA9IGZp
X3RvX2ZfZ3VkX2RybV9vcHRzKGZpKTsKKwlzdHJ1Y3QgdXNiX2Z1bmN0aW9uICpmdW5jOworCXN0
cnVjdCBmX2d1ZF9kcm0gKmZnZDsKKworCWZnZCA9IGt6YWxsb2Moc2l6ZW9mKCpmZ2QpLCBHRlBf
S0VSTkVMKTsKKwlpZiAoIWZnZCkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlmZ2Qt
PmN0cmxfcmVxX2J1ZiA9IGttYWxsb2MoR1VEX0RSTV9NQVhfVFJBTlNGRVJfU0laRSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFmZ2QtPmN0cmxfcmVxX2J1ZikKKwkJZ290byBlcnJvcjsKKworCXNwaW5f
bG9ja19pbml0KCZmZ2QtPmxvY2spOworCUlOSVRfV09SSygmZmdkLT53b3JrZXIsIGZfZ3VkX2Ry
bV93b3JrZXIpOworCisJbXV0ZXhfbG9jaygmb3B0cy0+bG9jayk7CisJb3B0cy0+cmVmY250Kys7
CisJbXV0ZXhfdW5sb2NrKCZvcHRzLT5sb2NrKTsKKworCWZ1bmMgPSAmZmdkLT5mdW5jOworCWZ1
bmMtPm5hbWUgPSAiZ3VkX2RybSI7CisJZnVuYy0+YmluZCA9IGZfZ3VkX2RybV9iaW5kOworCWZ1
bmMtPnVuYmluZCA9IGZfZ3VkX2RybV91bmJpbmQ7CisJZnVuYy0+c2V0X2FsdCA9IGZfZ3VkX2Ry
bV9zZXRfYWx0OworCWZ1bmMtPnJlcV9tYXRjaCA9IGZfZ3VkX2RybV9yZXFfbWF0Y2g7CisJZnVu
Yy0+c2V0dXAgPSBmX2d1ZF9kcm1fc2V0dXA7CisJZnVuYy0+ZGlzYWJsZSA9IGZfZ3VkX2RybV9k
aXNhYmxlOworCWZ1bmMtPmZyZWVfZnVuYyA9IGZfZ3VkX2RybV9mcmVlX2Z1bmM7CisKKwlyZXR1
cm4gZnVuYzsKKworZXJyb3I6CisJa2ZyZWUoZmdkKTsKKworCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOworfQorCitzdGF0aWMgc3NpemVfdCBmX2d1ZF9kcm1fb3B0c19kcm1fZGV2X3Nob3coc3Ry
dWN0IGNvbmZpZ19pdGVtICppdGVtLCBjaGFyICpwYWdlKQoreworCXN0cnVjdCBmX2d1ZF9kcm1f
b3B0cyAqb3B0cyA9IGNpX3RvX2ZfZ3VkX2RybV9vcHRzKGl0ZW0pOworCWludCByZXN1bHQ7CisK
KwltdXRleF9sb2NrKCZvcHRzLT5sb2NrKTsKKwlyZXN1bHQgPSBzcHJpbnRmKHBhZ2UsICIldVxu
Iiwgb3B0cy0+ZHJtX2Rldik7CisJbXV0ZXhfdW5sb2NrKCZvcHRzLT5sb2NrKTsKKworCXJldHVy
biByZXN1bHQ7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGZfZ3VkX2RybV9vcHRzX2RybV9kZXZfc3Rv
cmUoc3RydWN0IGNvbmZpZ19pdGVtICppdGVtLAorCQkJCQkgICAgY29uc3QgY2hhciAqcGFnZSwg
c2l6ZV90IGxlbikKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtX29wdHMgKm9wdHMgPSBjaV90b19mX2d1
ZF9kcm1fb3B0cyhpdGVtKTsKKwl1bnNpZ25lZCBpbnQgbnVtOworCWludCByZXQ7CisKKwltdXRl
eF9sb2NrKCZvcHRzLT5sb2NrKTsKKwlpZiAob3B0cy0+cmVmY250KSB7CisJCXJldCA9IC1FQlVT
WTsKKwkJZ290byB1bmxvY2s7CisJfQorCisJcmV0ID0ga3N0cnRvdWludChwYWdlLCAwLCAmbnVt
KTsKKwlpZiAocmV0KQorCQlnb3RvIHVubG9jazsKKworCW9wdHMtPmRybV9kZXYgPSBudW07CisJ
cmV0ID0gbGVuOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmb3B0cy0+bG9jayk7CisKKwlyZXR1
cm4gcmV0OworfQorCitDT05GSUdGU19BVFRSKGZfZ3VkX2RybV9vcHRzXywgZHJtX2Rldik7CisK
K3N0YXRpYyBzc2l6ZV90IGZfZ3VkX2RybV9vcHRzX2JhY2tsaWdodF9kZXZfc2hvdyhzdHJ1Y3Qg
Y29uZmlnX2l0ZW0gKml0ZW0sIGNoYXIgKnBhZ2UpCit7CisJc3RydWN0IGZfZ3VkX2RybV9vcHRz
ICpvcHRzID0gY2lfdG9fZl9ndWRfZHJtX29wdHMoaXRlbSk7CisJc3NpemVfdCByZXQgPSAwOwor
CisJbXV0ZXhfbG9jaygmb3B0cy0+bG9jayk7CisJaWYgKG9wdHMtPmJhY2tsaWdodF9kZXYpCisJ
CXJldCA9IHN0cnNjcHkocGFnZSwgb3B0cy0+YmFja2xpZ2h0X2RldiwgUEFHRV9TSVpFKTsKKwll
bHNlCisJCXBhZ2VbMF0gPSAnXDAnOworCW11dGV4X3VubG9jaygmb3B0cy0+bG9jayk7CisKKwly
ZXR1cm4gcmV0OworfQorCitzdGF0aWMgc3NpemVfdCBmX2d1ZF9kcm1fb3B0c19iYWNrbGlnaHRf
ZGV2X3N0b3JlKHN0cnVjdCBjb25maWdfaXRlbSAqaXRlbSwKKwkJCQkJCSAgY29uc3QgY2hhciAq
cGFnZSwgc2l6ZV90IGxlbikKK3sKKwlzdHJ1Y3QgZl9ndWRfZHJtX29wdHMgKm9wdHMgPSBjaV90
b19mX2d1ZF9kcm1fb3B0cyhpdGVtKTsKKwlzc2l6ZV90IHJldDsKKwljaGFyICpuYW1lOworCisJ
bXV0ZXhfbG9jaygmb3B0cy0+bG9jayk7CisJaWYgKG9wdHMtPnJlZmNudCkgeworCQlyZXQgPSAt
RUJVU1k7CisJCWdvdG8gdW5sb2NrOworCX0KKworCW5hbWUgPSBrc3RybmR1cChwYWdlLCBsZW4s
IEdGUF9LRVJORUwpOworCWlmICghbmFtZSkgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIHVu
bG9jazsKKwl9CisKKwlrZnJlZShvcHRzLT5iYWNrbGlnaHRfZGV2KTsKKwlvcHRzLT5iYWNrbGln
aHRfZGV2ID0gbmFtZTsKKwlyZXQgPSBsZW47Cit1bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZvcHRz
LT5sb2NrKTsKKworCXJldHVybiByZXQ7Cit9CisKK0NPTkZJR0ZTX0FUVFIoZl9ndWRfZHJtX29w
dHNfLCBiYWNrbGlnaHRfZGV2KTsKKworc3RhdGljIHN0cnVjdCBjb25maWdmc19hdHRyaWJ1dGUg
KmZfZ3VkX2RybV9hdHRyc1tdID0geworCSZmX2d1ZF9kcm1fb3B0c19hdHRyX2RybV9kZXYsCisJ
JmZfZ3VkX2RybV9vcHRzX2F0dHJfYmFja2xpZ2h0X2RldiwKKwlOVUxMLAorfTsKKworc3RhdGlj
IHZvaWQgZl9ndWRfZHJtX2F0dHJfcmVsZWFzZShzdHJ1Y3QgY29uZmlnX2l0ZW0gKml0ZW0pCit7
CisJc3RydWN0IGZfZ3VkX2RybV9vcHRzICpvcHRzID0gY2lfdG9fZl9ndWRfZHJtX29wdHMoaXRl
bSk7CisKKwl1c2JfcHV0X2Z1bmN0aW9uX2luc3RhbmNlKCZvcHRzLT5mdW5jX2luc3QpOworfQor
CitzdGF0aWMgc3RydWN0IGNvbmZpZ2ZzX2l0ZW1fb3BlcmF0aW9ucyBmX2d1ZF9kcm1faXRlbV9v
cHMgPSB7CisJLnJlbGVhc2UJPSBmX2d1ZF9kcm1fYXR0cl9yZWxlYXNlLAorfTsKKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBjb25maWdfaXRlbV90eXBlIGZfZ3VkX2RybV9mdW5jX3R5cGUgPSB7CisJ
LmN0X2l0ZW1fb3BzCT0gJmZfZ3VkX2RybV9pdGVtX29wcywKKwkuY3RfYXR0cnMJPSBmX2d1ZF9k
cm1fYXR0cnMsCisJLmN0X293bmVyCT0gVEhJU19NT0RVTEUsCit9OworCitzdGF0aWMgdm9pZCBm
X2d1ZF9kcm1fZnJlZV9mdW5jX2luc3Qoc3RydWN0IHVzYl9mdW5jdGlvbl9pbnN0YW5jZSAqZmkp
Cit7CisJc3RydWN0IGZfZ3VkX2RybV9vcHRzICpvcHRzID0gZmlfdG9fZl9ndWRfZHJtX29wdHMo
ZmkpOworCisJbXV0ZXhfZGVzdHJveSgmb3B0cy0+bG9jayk7CisJa2ZyZWUob3B0cy0+YmFja2xp
Z2h0X2Rldik7CisJa2ZyZWUob3B0cyk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgdXNiX2Z1bmN0aW9u
X2luc3RhbmNlICpmX2d1ZF9kcm1fYWxsb2NfZnVuY19pbnN0KHZvaWQpCit7CisJc3RydWN0IGZf
Z3VkX2RybV9vcHRzICpvcHRzOworCisJb3B0cyA9IGt6YWxsb2Moc2l6ZW9mKCpvcHRzKSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFvcHRzKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKworCW11
dGV4X2luaXQoJm9wdHMtPmxvY2spOworCW9wdHMtPmZ1bmNfaW5zdC5mcmVlX2Z1bmNfaW5zdCA9
IGZfZ3VkX2RybV9mcmVlX2Z1bmNfaW5zdDsKKworCWNvbmZpZ19ncm91cF9pbml0X3R5cGVfbmFt
ZSgmb3B0cy0+ZnVuY19pbnN0Lmdyb3VwLCAiIiwgJmZfZ3VkX2RybV9mdW5jX3R5cGUpOworCisJ
cmV0dXJuICZvcHRzLT5mdW5jX2luc3Q7Cit9CisKK0RFQ0xBUkVfVVNCX0ZVTkNUSU9OX0lOSVQo
Z3VkX2RybSwgZl9ndWRfZHJtX2FsbG9jX2Z1bmNfaW5zdCwgZl9ndWRfZHJtX2FsbG9jX2Z1bmMp
OworCitNT0RVTEVfREVTQ1JJUFRJT04oIkdlbmVyaWMgVVNCIERpc3BsYXkgR2FkZ2V0Iik7CitN
T0RVTEVfQVVUSE9SKCJOb3JhbGYgVHLDuG5uZXMiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsK
LS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
Cg==
