Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C5FC2E38B1
	for <lists+dri-devel@lfdr.de>; Thu, 24 Oct 2019 18:46:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9DFFC6E4D4;
	Thu, 24 Oct 2019 16:46:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B219C6E4C5
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 16:46:17 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id s1so18096431wro.0
 for <dri-devel@lists.freedesktop.org>; Thu, 24 Oct 2019 09:46:17 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=FwEnjHtFTF7OfFXzKxcCarHlZ61ccQuW3KuS1NZQB7o=;
 b=luifqFklkbpChJZbDGCOcV0aOHj7SgwCTxHbdQi5G8c6DkAxyD+GsafKm864vnFF/1
 TFI+DZd9SjN3eQDHMsG62bwTh25FHiI/CRz8A+6yObiM1+bcep2dFUa+uKOhrS6v5S8S
 8cxipgiSe3Hrt7+X0bHgOTbDbHv/q7ezK1/lH/JxXhzgL+TlTnrGLN+MIiTniVB+ZLiG
 3XIxi8jkzvPjxb8kzzMqxPK3T+6mS9/YcMpLj+cZy3OpX3P5N35hjMfp1kdLjkmS3k+S
 4dRhzQ12y7YPtcLvCNxq89m64BwFoYMXqfGSC9+6uTyMxt2aAzPrG5fU09fVOM1Dg6Si
 e5lg==
X-Gm-Message-State: APjAAAXRbwIxxnzq/7F6Y3NqY5PoJBPHUyBOfZmpYaCILvgElIyqznux
 L61UPlxtQbpIF15Hiej2l9uEQxTM
X-Google-Smtp-Source: APXvYqyOuCZoBjskl22RukB62w3+EHcKgDKE67MZ7FesatSL6fwml5CzeFJ8AE6ZT0TsbYfonvWtQQ==
X-Received: by 2002:adf:c641:: with SMTP id u1mr4772049wrg.361.1571935575780; 
 Thu, 24 Oct 2019 09:46:15 -0700 (PDT)
Received: from localhost (p2E5BE2CE.dip0.t-ipconnect.de. [46.91.226.206])
 by smtp.gmail.com with ESMTPSA id b7sm11010352wrn.53.2019.10.24.09.46.14
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 24 Oct 2019 09:46:14 -0700 (PDT)
From: Thierry Reding <thierry.reding@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH 17/32] drm/tegra: sor: Use DP link training helpers
Date: Thu, 24 Oct 2019 18:45:19 +0200
Message-Id: <20191024164534.132764-18-thierry.reding@gmail.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191024164534.132764-1-thierry.reding@gmail.com>
References: <20191024164534.132764-1-thierry.reding@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=FwEnjHtFTF7OfFXzKxcCarHlZ61ccQuW3KuS1NZQB7o=;
 b=g+bw5X7qGub6UzajTmDJyZL1qqTbzRA0r6jrKGWPWSBoyN8AGZ90rmDfkDdkkIvIs2
 R7AbTE6y3P7kEm7wEb3XfJok4+n8VFW+KjPFbxeWvW0FTcRrOrO64PfvVJVMjJrorR4f
 PJrZVpCM1YtghuthN7C1v9JCgl+baRS4Ge1n0apNeMXswK6PRGzazXijj4utZlnTybtv
 yHceM1oT30n8+vlMc6LBQFXMQvgrx5Hg4OKqcHsMMLd7bMQ2uAfmNMu0ELvxSdneW9Z8
 fuoyCaNyRRvEHuRzeDE9ndvNYWQiMxPvS9FlXVuOxny9F+yybh9vFK43losmGXId87HQ
 n0jg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhpZXJyeSBSZWRpbmcgPHRyZWRpbmdAbnZpZGlhLmNvbT4KCk1ha2UgdXNlIG9mIHRo
ZSBEUCBsaW5rIHRyYWluaW5nIGhlbHBlcnMgdG8gaW1wbGVtZW50IGZ1bGwgYW5kIGZhc3QgbGlu
awp0cmFpbmluZy4gV2hpbGUgYXQgaXQsIHJlZmFjdG9yIHNvbWUgb2YgdGhlIGNvZGUgYW5kIHJl
bW92ZSB2YXJpb3VzIGNvZGUKc2VxdWVuY2VzIHRoYXQgYXJlIG5vdCBuZWNlc3NhcnkuCgpTaWdu
ZWQtb2ZmLWJ5OiBUaGllcnJ5IFJlZGluZyA8dHJlZGluZ0BudmlkaWEuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5jIHwgIDY5IC0tLS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdy
YS9kcm0uaCAgIHwgICA1IC0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9zb3IuYyAgIHwgNjg0ICsr
KysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9z
b3IuaCAgIHwgICAyICsKIDQgZmlsZXMgY2hhbmdlZCwgNDcwIGluc2VydGlvbnMoKyksIDI5MCBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHBhdXguYyBi
L2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcGF1eC5jCmluZGV4IGJkMzM2MWNlYTQ5Yi4uNjIyY2Rm
MWFkMjQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHBhdXguYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdGVncmEvZHBhdXguYwpAQCAtODIxLDcyICs4MjEsMyBAQCBpbnQgZHJt
X2RwX2F1eF9kaXNhYmxlKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgpCiAKIAlyZXR1cm4gMDsKIH0K
LQotaW50IGRybV9kcF9hdXhfcHJlcGFyZShzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LCB1OCBlbmNv
ZGluZykKLXsKLQlpbnQgZXJyOwotCi0JZXJyID0gZHJtX2RwX2RwY2Rfd3JpdGViKGF1eCwgRFBf
TUFJTl9MSU5LX0NIQU5ORUxfQ09ESU5HX1NFVCwKLQkJCQkgZW5jb2RpbmcpOwotCWlmIChlcnIg
PCAwKQotCQlyZXR1cm4gZXJyOwotCi0JcmV0dXJuIDA7Ci19Ci0KLWludCBkcm1fZHBfYXV4X3Ry
YWluKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsIHN0cnVjdCBkcm1fZHBfbGluayAqbGluaywKLQkJ
ICAgICB1OCBwYXR0ZXJuKQotewotCXU4IHRwID0gcGF0dGVybiAmIERQX1RSQUlOSU5HX1BBVFRF
Uk5fTUFTSzsKLQl1OCBzdGF0dXNbRFBfTElOS19TVEFUVVNfU0laRV0sIHZhbHVlc1s0XTsKLQl1
bnNpZ25lZCBpbnQgaTsKLQlpbnQgZXJyOwotCi0JZXJyID0gZHJtX2RwX2RwY2Rfd3JpdGViKGF1
eCwgRFBfVFJBSU5JTkdfUEFUVEVSTl9TRVQsIHBhdHRlcm4pOwotCWlmIChlcnIgPCAwKQotCQly
ZXR1cm4gZXJyOwotCi0JaWYgKHRwID09IERQX1RSQUlOSU5HX1BBVFRFUk5fRElTQUJMRSkKLQkJ
cmV0dXJuIDA7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgbGluay0+bGFuZXM7IGkrKykKLQkJdmFsdWVz
W2ldID0gRFBfVFJBSU5fTUFYX1BSRV9FTVBIQVNJU19SRUFDSEVEIHwKLQkJCSAgICBEUF9UUkFJ
Tl9QUkVfRU1QSF9MRVZFTF8wIHwKLQkJCSAgICBEUF9UUkFJTl9NQVhfU1dJTkdfUkVBQ0hFRCB8
Ci0JCQkgICAgRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8wOwotCi0JZXJyID0gZHJtX2Rw
X2RwY2Rfd3JpdGUoYXV4LCBEUF9UUkFJTklOR19MQU5FMF9TRVQsIHZhbHVlcywKLQkJCQlsaW5r
LT5sYW5lcyk7Ci0JaWYgKGVyciA8IDApCi0JCXJldHVybiBlcnI7Ci0KLQl1c2xlZXBfcmFuZ2Uo
NTAwLCAxMDAwKTsKLQotCWVyciA9IGRybV9kcF9kcGNkX3JlYWRfbGlua19zdGF0dXMoYXV4LCBz
dGF0dXMpOwotCWlmIChlcnIgPCAwKQotCQlyZXR1cm4gZXJyOwotCi0Jc3dpdGNoICh0cCkgewot
CWNhc2UgRFBfVFJBSU5JTkdfUEFUVEVSTl8xOgotCQlpZiAoIWRybV9kcF9jbG9ja19yZWNvdmVy
eV9vayhzdGF0dXMsIGxpbmstPmxhbmVzKSkKLQkJCXJldHVybiAtRUFHQUlOOwotCi0JCWJyZWFr
OwotCi0JY2FzZSBEUF9UUkFJTklOR19QQVRURVJOXzI6Ci0JCWlmICghZHJtX2RwX2NoYW5uZWxf
ZXFfb2soc3RhdHVzLCBsaW5rLT5sYW5lcykpCi0JCQlyZXR1cm4gLUVBR0FJTjsKLQotCQlicmVh
azsKLQotCWRlZmF1bHQ6Ci0JCWRldl9lcnIoYXV4LT5kZXYsICJ1bnN1cHBvcnRlZCB0cmFpbmlu
ZyBwYXR0ZXJuICV1XG4iLCB0cCk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWVyciA9IGRy
bV9kcF9kcGNkX3dyaXRlYihhdXgsIERQX0VEUF9DT05GSUdVUkFUSU9OX1NFVCwgMCk7Ci0JaWYg
KGVyciA8IDApCi0JCXJldHVybiBlcnI7Ci0KLQlyZXR1cm4gMDsKLX0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS90ZWdyYS9kcm0uaCBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcm0uaApp
bmRleCA2YTA2ZDYzNmU5MzAuLjhiODEyYmI1MmU1YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3RlZ3JhL2RybS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcm0uaApAQCAtMTUz
LDE3ICsxNTMsMTIgQEAgdm9pZCB0ZWdyYV9vdXRwdXRfY29ubmVjdG9yX2Rlc3Ryb3koc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvcik7CiB2b2lkIHRlZ3JhX291dHB1dF9lbmNvZGVyX2Rl
c3Ryb3koc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKTsKIAogLyogZnJvbSBkcGF1eC5jICov
Ci1zdHJ1Y3QgZHJtX2RwX2xpbms7Ci0KIHN0cnVjdCBkcm1fZHBfYXV4ICpkcm1fZHBfYXV4X2Zp
bmRfYnlfb2Zfbm9kZShzdHJ1Y3QgZGV2aWNlX25vZGUgKm5wKTsKIGVudW0gZHJtX2Nvbm5lY3Rv
cl9zdGF0dXMgZHJtX2RwX2F1eF9kZXRlY3Qoc3RydWN0IGRybV9kcF9hdXggKmF1eCk7CiBpbnQg
ZHJtX2RwX2F1eF9hdHRhY2goc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IHRlZ3JhX291
dHB1dCAqb3V0cHV0KTsKIGludCBkcm1fZHBfYXV4X2RldGFjaChzdHJ1Y3QgZHJtX2RwX2F1eCAq
YXV4KTsKIGludCBkcm1fZHBfYXV4X2VuYWJsZShzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4KTsKIGlu
dCBkcm1fZHBfYXV4X2Rpc2FibGUoc3RydWN0IGRybV9kcF9hdXggKmF1eCk7Ci1pbnQgZHJtX2Rw
X2F1eF9wcmVwYXJlKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsIHU4IGVuY29kaW5nKTsKLWludCBk
cm1fZHBfYXV4X3RyYWluKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsIHN0cnVjdCBkcm1fZHBfbGlu
ayAqbGluaywKLQkJICAgICB1OCBwYXR0ZXJuKTsKIAogLyogZnJvbSBmYi5jICovCiBzdHJ1Y3Qg
dGVncmFfYm8gKnRlZ3JhX2ZiX2dldF9wbGFuZShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmcmFt
ZWJ1ZmZlciwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9zb3IuYyBiL2RyaXZl
cnMvZ3B1L2RybS90ZWdyYS9zb3IuYwppbmRleCBkZDExODM2NjQ1NWIuLjYzNjgwN2UwNDdmMCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3Nvci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS90ZWdyYS9zb3IuYwpAQCAtMzgzLDYgKzM4MywxMiBAQCBzdHJ1Y3QgdGVncmFfc29yX3Nv
YyB7CiAJdW5zaWduZWQgaW50IG51bV9zZXR0aW5nczsKIAogCWNvbnN0IHU4ICp4YmFyX2NmZzsK
Kwljb25zdCB1OCAqbGFuZV9tYXA7CisKKwljb25zdCB1OCAoKnZvbHRhZ2Vfc3dpbmcpWzRdWzRd
OworCWNvbnN0IHU4ICgqcHJlX2VtcGhhc2lzKVs0XVs0XTsKKwljb25zdCB1OCAoKnBvc3RfY3Vy
c29yKVs0XVs0XTsKKwljb25zdCB1OCAoKnR4X3B1KVs0XVs0XTsKIH07CiAKIHN0cnVjdCB0ZWdy
YV9zb3I7CkBAIC00MTMsNiArNDE5LDcgQEAgc3RydWN0IHRlZ3JhX3NvciB7CiAKIAl1OCB4YmFy
X2NmZ1s1XTsKIAorCXN0cnVjdCBkcm1fZHBfbGluayBsaW5rOwogCXN0cnVjdCBkcm1fZHBfYXV4
ICphdXg7CiAKIAlzdHJ1Y3QgZHJtX2luZm9fbGlzdCAqZGVidWdmc19maWxlczsKQEAgLTU5OCwx
MTIgKzYwNSwzMTYgQEAgc3RhdGljIHN0cnVjdCBjbGsgKnRlZ3JhX2Nsa19zb3JfcGFkX3JlZ2lz
dGVyKHN0cnVjdCB0ZWdyYV9zb3IgKnNvciwKIAlyZXR1cm4gY2xrOwogfQogCi1zdGF0aWMgaW50
IHRlZ3JhX3Nvcl9kcF90cmFpbl9mYXN0KHN0cnVjdCB0ZWdyYV9zb3IgKnNvciwKLQkJCQkgICBz
dHJ1Y3QgZHJtX2RwX2xpbmsgKmxpbmspCitzdGF0aWMgaW50IHRlZ3JhX3Nvcl9wb3dlcl91cF9s
YW5lcyhzdHJ1Y3QgdGVncmFfc29yICpzb3IsIHVuc2lnbmVkIGludCBsYW5lcykKIHsKLQl1bnNp
Z25lZCBpbnQgaTsKLQl1OCBwYXR0ZXJuOworCXVuc2lnbmVkIGxvbmcgdGltZW91dDsKIAl1MzIg
dmFsdWU7Ci0JaW50IGVycjsKIAotCS8qIHNldHVwIGxhbmUgcGFyYW1ldGVycyAqLwotCXZhbHVl
ID0gU09SX0xBTkVfRFJJVkVfQ1VSUkVOVF9MQU5FMygweDQwKSB8Ci0JCVNPUl9MQU5FX0RSSVZF
X0NVUlJFTlRfTEFORTIoMHg0MCkgfAotCQlTT1JfTEFORV9EUklWRV9DVVJSRU5UX0xBTkUxKDB4
NDApIHwKLQkJU09SX0xBTkVfRFJJVkVfQ1VSUkVOVF9MQU5FMCgweDQwKTsKLQl0ZWdyYV9zb3Jf
d3JpdGVsKHNvciwgdmFsdWUsIFNPUl9MQU5FX0RSSVZFX0NVUlJFTlQwKTsKKwkvKgorCSAqIENs
ZWFyIG9yIHNldCB0aGUgUERfVFhEIGJpdCBjb3JyZXNwb25kaW5nIHRvIGVhY2ggbGFuZSwgZGVw
ZW5kaW5nCisJICogb24gd2hldGhlciBpdCBpcyB1c2VkIG9yIG5vdC4KKwkgKi8KKwl2YWx1ZSA9
IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKIAotCXZh
bHVlID0gU09SX0xBTkVfUFJFRU1QSEFTSVNfTEFORTMoMHgwZikgfAotCQlTT1JfTEFORV9QUkVF
TVBIQVNJU19MQU5FMigweDBmKSB8Ci0JCVNPUl9MQU5FX1BSRUVNUEhBU0lTX0xBTkUxKDB4MGYp
IHwKLQkJU09SX0xBTkVfUFJFRU1QSEFTSVNfTEFORTAoMHgwZik7Ci0JdGVncmFfc29yX3dyaXRl
bChzb3IsIHZhbHVlLCBTT1JfTEFORV9QUkVFTVBIQVNJUzApOworCWlmIChsYW5lcyA8PSAyKQor
CQl2YWx1ZSAmPSB+KFNPUl9EUF9QQURDVExfUERfVFhEKHNvci0+c29jLT5sYW5lX21hcFszXSkg
fAorCQkJICAgU09SX0RQX1BBRENUTF9QRF9UWEQoc29yLT5zb2MtPmxhbmVfbWFwWzJdKSk7CisJ
ZWxzZQorCQl2YWx1ZSB8PSBTT1JfRFBfUEFEQ1RMX1BEX1RYRChzb3ItPnNvYy0+bGFuZV9tYXBb
M10pIHwKKwkJCSBTT1JfRFBfUEFEQ1RMX1BEX1RYRChzb3ItPnNvYy0+bGFuZV9tYXBbMl0pOwor
CisJaWYgKGxhbmVzIDw9IDEpCisJCXZhbHVlICY9IH5TT1JfRFBfUEFEQ1RMX1BEX1RYRChzb3It
PnNvYy0+bGFuZV9tYXBbMV0pOworCWVsc2UKKwkJdmFsdWUgfD0gU09SX0RQX1BBRENUTF9QRF9U
WEQoc29yLT5zb2MtPmxhbmVfbWFwWzFdKTsKKworCWlmIChsYW5lcyA9PSAwKQorCQl2YWx1ZSAm
PSB+U09SX0RQX1BBRENUTF9QRF9UWEQoc29yLT5zb2MtPmxhbmVfbWFwWzBdKTsKKwllbHNlCisJ
CXZhbHVlIHw9IFNPUl9EUF9QQURDVExfUERfVFhEKHNvci0+c29jLT5sYW5lX21hcFswXSk7CisK
Kwl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGww
KTsKKworCS8qIHN0YXJ0IGxhbmUgc2VxdWVuY2VyICovCisJdmFsdWUgPSBTT1JfTEFORV9TRVFf
Q1RMX1RSSUdHRVIgfCBTT1JfTEFORV9TRVFfQ1RMX1NFUVVFTkNFX0RPV04gfAorCQlTT1JfTEFO
RV9TRVFfQ1RMX1BPV0VSX1NUQVRFX1VQOworCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwg
U09SX0xBTkVfU0VRX0NUTCk7CisKKwl0aW1lb3V0ID0gamlmZmllcyArIG1zZWNzX3RvX2ppZmZp
ZXMoMjUwKTsKKworCXdoaWxlICh0aW1lX2JlZm9yZShqaWZmaWVzLCB0aW1lb3V0KSkgeworCQl2
YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIFNPUl9MQU5FX1NFUV9DVEwpOworCQlpZiAoKHZh
bHVlICYgU09SX0xBTkVfU0VRX0NUTF9UUklHR0VSKSA9PSAwKQorCQkJYnJlYWs7CisKKwkJdXNs
ZWVwX3JhbmdlKDI1MCwgMTAwMCk7CisJfQorCisJaWYgKCh2YWx1ZSAmIFNPUl9MQU5FX1NFUV9D
VExfVFJJR0dFUikgIT0gMCkKKwkJcmV0dXJuIC1FVElNRURPVVQ7CiAKLQl2YWx1ZSA9IFNPUl9M
QU5FX1BPU1RDVVJTT1JfTEFORTMoMHgwMCkgfAotCQlTT1JfTEFORV9QT1NUQ1VSU09SX0xBTkUy
KDB4MDApIHwKLQkJU09SX0xBTkVfUE9TVENVUlNPUl9MQU5FMSgweDAwKSB8Ci0JCVNPUl9MQU5F
X1BPU1RDVVJTT1JfTEFORTAoMHgwMCk7Ci0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBT
T1JfTEFORV9QT1NUQ1VSU09SMCk7CisJcmV0dXJuIDA7Cit9CiAKLQkvKiBkaXNhYmxlIExWRFMg
bW9kZSAqLwotCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCAwLCBTT1JfTFZEUyk7CitzdGF0aWMgaW50
IHRlZ3JhX3Nvcl9wb3dlcl9kb3duX2xhbmVzKHN0cnVjdCB0ZWdyYV9zb3IgKnNvcikKK3sKKwl1
bnNpZ25lZCBsb25nIHRpbWVvdXQ7CisJdTMyIHZhbHVlOwogCisJLyogcG93ZXIgZG93biBhbGwg
bGFuZXMgKi8KIAl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIHNvci0+c29jLT5yZWdzLT5k
cF9wYWRjdGwwKTsKLQl2YWx1ZSB8PSBTT1JfRFBfUEFEQ1RMX1RYX1BVX0VOQUJMRTsKLQl2YWx1
ZSAmPSB+U09SX0RQX1BBRENUTF9UWF9QVV9NQVNLOwotCXZhbHVlIHw9IFNPUl9EUF9QQURDVExf
VFhfUFUoMik7IC8qIFhYWDogZG9uJ3QgaGFyZGNvZGU/ICovCisJdmFsdWUgJj0gfihTT1JfRFBf
UEFEQ1RMX1BEX1RYRF8zIHwgU09SX0RQX1BBRENUTF9QRF9UWERfMCB8CisJCSAgIFNPUl9EUF9Q
QURDVExfUERfVFhEXzEgfCBTT1JfRFBfUEFEQ1RMX1BEX1RYRF8yKTsKIAl0ZWdyYV9zb3Jfd3Jp
dGVsKHNvciwgdmFsdWUsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKIAorCS8qIHN0YXJ0
IGxhbmUgc2VxdWVuY2VyICovCisJdmFsdWUgPSBTT1JfTEFORV9TRVFfQ1RMX1RSSUdHRVIgfCBT
T1JfTEFORV9TRVFfQ1RMX1NFUVVFTkNFX1VQIHwKKwkJU09SX0xBTkVfU0VRX0NUTF9QT1dFUl9T
VEFURV9ET1dOOworCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgU09SX0xBTkVfU0VRX0NU
TCk7CisKKwl0aW1lb3V0ID0gamlmZmllcyArIG1zZWNzX3RvX2ppZmZpZXMoMjUwKTsKKworCXdo
aWxlICh0aW1lX2JlZm9yZShqaWZmaWVzLCB0aW1lb3V0KSkgeworCQl2YWx1ZSA9IHRlZ3JhX3Nv
cl9yZWFkbChzb3IsIFNPUl9MQU5FX1NFUV9DVEwpOworCQlpZiAoKHZhbHVlICYgU09SX0xBTkVf
U0VRX0NUTF9UUklHR0VSKSA9PSAwKQorCQkJYnJlYWs7CisKKwkJdXNsZWVwX3JhbmdlKDI1LCAx
MDApOworCX0KKworCWlmICgodmFsdWUgJiBTT1JfTEFORV9TRVFfQ1RMX1RSSUdHRVIpICE9IDAp
CisJCXJldHVybiAtRVRJTUVET1VUOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHRl
Z3JhX3Nvcl9kcF9wcmVjaGFyZ2Uoc3RydWN0IHRlZ3JhX3NvciAqc29yLCB1bnNpZ25lZCBpbnQg
bGFuZXMpCit7CisJdTMyIHZhbHVlOworCisJLyogcHJlLWNoYXJnZSBhbGwgdXNlZCBsYW5lcyAq
LwogCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0
bDApOwotCXZhbHVlIHw9IFNPUl9EUF9QQURDVExfQ01fVFhEXzMgfCBTT1JfRFBfUEFEQ1RMX0NN
X1RYRF8yIHwKLQkJIFNPUl9EUF9QQURDVExfQ01fVFhEXzEgfCBTT1JfRFBfUEFEQ1RMX0NNX1RY
RF8wOworCisJaWYgKGxhbmVzIDw9IDIpCisJCXZhbHVlICY9IH4oU09SX0RQX1BBRENUTF9DTV9U
WEQoc29yLT5zb2MtPmxhbmVfbWFwWzNdKSB8CisJCQkgICBTT1JfRFBfUEFEQ1RMX0NNX1RYRChz
b3ItPnNvYy0+bGFuZV9tYXBbMl0pKTsKKwllbHNlCisJCXZhbHVlIHw9IFNPUl9EUF9QQURDVExf
Q01fVFhEKHNvci0+c29jLT5sYW5lX21hcFszXSkgfAorCQkJIFNPUl9EUF9QQURDVExfQ01fVFhE
KHNvci0+c29jLT5sYW5lX21hcFsyXSk7CisKKwlpZiAobGFuZXMgPD0gMSkKKwkJdmFsdWUgJj0g
flNPUl9EUF9QQURDVExfQ01fVFhEKHNvci0+c29jLT5sYW5lX21hcFsxXSk7CisJZWxzZQorCQl2
YWx1ZSB8PSBTT1JfRFBfUEFEQ1RMX0NNX1RYRChzb3ItPnNvYy0+bGFuZV9tYXBbMV0pOworCisJ
aWYgKGxhbmVzID09IDApCisJCXZhbHVlICY9IH5TT1JfRFBfUEFEQ1RMX0NNX1RYRChzb3ItPnNv
Yy0+bGFuZV9tYXBbMF0pOworCWVsc2UKKwkJdmFsdWUgfD0gU09SX0RQX1BBRENUTF9DTV9UWEQo
c29yLT5zb2MtPmxhbmVfbWFwWzBdKTsKKwogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwg
c29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwogCi0JdXNsZWVwX3JhbmdlKDEwLCAxMDApOwor
CXVzbGVlcF9yYW5nZSgxNSwgMTAwKTsKIAogCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwg
c29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwogCXZhbHVlICY9IH4oU09SX0RQX1BBRENUTF9D
TV9UWERfMyB8IFNPUl9EUF9QQURDVExfQ01fVFhEXzIgfAogCQkgICBTT1JfRFBfUEFEQ1RMX0NN
X1RYRF8xIHwgU09SX0RQX1BBRENUTF9DTV9UWERfMCk7CiAJdGVncmFfc29yX3dyaXRlbChzb3Is
IHZhbHVlLCBzb3ItPnNvYy0+cmVncy0+ZHBfcGFkY3RsMCk7Cit9CiAKLQllcnIgPSBkcm1fZHBf
YXV4X3ByZXBhcmUoc29yLT5hdXgsIERQX1NFVF9BTlNJXzhCMTBCKTsKLQlpZiAoZXJyIDwgMCkK
LQkJcmV0dXJuIGVycjsKK3N0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9kcF90ZXJtX2NhbGlicmF0ZShz
dHJ1Y3QgdGVncmFfc29yICpzb3IpCit7CisJdTMyIG1hc2sgPSAweDA4LCBhZGogPSAwLCB2YWx1
ZTsKKworCS8qIGVuYWJsZSBwYWQgY2FsaWJyYXRpb24gbG9naWMgKi8KKwl2YWx1ZSA9IHRlZ3Jh
X3Nvcl9yZWFkbChzb3IsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKKwl2YWx1ZSAmPSB+
U09SX0RQX1BBRENUTF9QQURfQ0FMX1BEOworCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwg
c29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOworCisJdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwo
c29yLCBzb3ItPnNvYy0+cmVncy0+cGxsMSk7CisJdmFsdWUgfD0gU09SX1BMTDFfVE1EU19URVJN
OworCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDEpOwor
CisJd2hpbGUgKG1hc2spIHsKKwkJYWRqIHw9IG1hc2s7CisKKwkJdmFsdWUgPSB0ZWdyYV9zb3Jf
cmVhZGwoc29yLCBzb3ItPnNvYy0+cmVncy0+cGxsMSk7CisJCXZhbHVlICY9IH5TT1JfUExMMV9U
TURTX1RFUk1BREpfTUFTSzsKKwkJdmFsdWUgfD0gU09SX1BMTDFfVE1EU19URVJNQURKKGFkaik7
CisJCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDEpOwog
Ci0JZm9yIChpID0gMCwgdmFsdWUgPSAwOyBpIDwgbGluay0+bGFuZXM7IGkrKykgewotCQl1bnNp
Z25lZCBsb25nIGxhbmUgPSBTT1JfRFBfVFBHX0NIQU5ORUxfQ09ESU5HIHwKLQkJCQkgICAgIFNP
Ul9EUF9UUEdfU0NSQU1CTEVSX05PTkUgfAotCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJOX1RS
QUlOMTsKLQkJdmFsdWUgPSAodmFsdWUgPDwgOCkgfCBsYW5lOworCQl1c2xlZXBfcmFuZ2UoMTAw
LCAyMDApOworCisJCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3Mt
PnBsbDEpOworCQlpZiAodmFsdWUgJiBTT1JfUExMMV9URVJNX0NPTVBPVVQpCisJCQlhZGogJj0g
fm1hc2s7CisKKwkJbWFzayA+Pj0gMTsKIAl9CiAKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFs
dWUsIFNPUl9EUF9UUEcpOworCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2Mt
PnJlZ3MtPnBsbDEpOworCXZhbHVlICY9IH5TT1JfUExMMV9UTURTX1RFUk1BREpfTUFTSzsKKwl2
YWx1ZSB8PSBTT1JfUExMMV9UTURTX1RFUk1BREooYWRqKTsKKwl0ZWdyYV9zb3Jfd3JpdGVsKHNv
ciwgdmFsdWUsIHNvci0+c29jLT5yZWdzLT5wbGwxKTsKIAotCXBhdHRlcm4gPSBEUF9UUkFJTklO
R19QQVRURVJOXzE7CisJLyogZGlzYWJsZSBwYWQgY2FsaWJyYXRpb24gbG9naWMgKi8KKwl2YWx1
ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKKwl2
YWx1ZSB8PSBTT1JfRFBfUEFEQ1RMX1BBRF9DQUxfUEQ7CisJdGVncmFfc29yX3dyaXRlbChzb3Is
IHZhbHVlLCBzb3ItPnNvYy0+cmVncy0+ZHBfcGFkY3RsMCk7Cit9CiAKLQllcnIgPSBkcm1fZHBf
YXV4X3RyYWluKHNvci0+YXV4LCBsaW5rLCBwYXR0ZXJuKTsKLQlpZiAoZXJyIDwgMCkKLQkJcmV0
dXJuIGVycjsKK3N0YXRpYyBpbnQgdGVncmFfc29yX2RwX2xpbmtfYXBwbHlfdHJhaW5pbmcoc3Ry
dWN0IGRybV9kcF9saW5rICpsaW5rKQoreworCXN0cnVjdCB0ZWdyYV9zb3IgKnNvciA9IGNvbnRh
aW5lcl9vZihsaW5rLCBzdHJ1Y3QgdGVncmFfc29yLCBsaW5rKTsKKwl1MzIgdm9sdGFnZV9zd2lu
ZyA9IDAsIHByZV9lbXBoYXNpcyA9IDAsIHBvc3RfY3Vyc29yID0gMDsKKwljb25zdCBzdHJ1Y3Qg
dGVncmFfc29yX3NvYyAqc29jID0gc29yLT5zb2M7CisJdTMyIHBhdHRlcm4gPSAwLCB0eF9wdSA9
IDAsIHZhbHVlOworCXVuc2lnbmVkIGludCBpOwogCi0JdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwo
c29yLCBTT1JfRFBfU1BBUkUwKTsKLQl2YWx1ZSB8PSBTT1JfRFBfU1BBUkVfU0VRX0VOQUJMRTsK
LQl2YWx1ZSAmPSB+U09SX0RQX1NQQVJFX1BBTkVMX0lOVEVSTkFMOwotCXZhbHVlIHw9IFNPUl9E
UF9TUEFSRV9NQUNST19TT1JfQ0xLOwotCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgU09S
X0RQX1NQQVJFMCk7CisJZm9yICh2YWx1ZSA9IDAsIGkgPSAwOyBpIDwgbGluay0+bGFuZXM7IGkr
KykgeworCQl1OCB2cyA9IGxpbmstPnRyYWluLnJlcXVlc3Qudm9sdGFnZV9zd2luZ1tpXTsKKwkJ
dTggcGUgPSBsaW5rLT50cmFpbi5yZXF1ZXN0LnByZV9lbXBoYXNpc1tpXTsKKwkJdTggcGMgPSBs
aW5rLT50cmFpbi5yZXF1ZXN0LnBvc3RfY3Vyc29yW2ldOworCQl1OCBzaGlmdCA9IHNvci0+c29j
LT5sYW5lX21hcFtpXSA8PCAzOworCisJCXZvbHRhZ2Vfc3dpbmcgfD0gc29jLT52b2x0YWdlX3N3
aW5nW3BjXVt2c11bcGVdIDw8IHNoaWZ0OworCQlwcmVfZW1waGFzaXMgfD0gc29jLT5wcmVfZW1w
aGFzaXNbcGNdW3ZzXVtwZV0gPDwgc2hpZnQ7CisJCXBvc3RfY3Vyc29yIHw9IHNvYy0+cG9zdF9j
dXJzb3JbcGNdW3ZzXVtwZV0gPDwgc2hpZnQ7CisKKwkJaWYgKHNvci0+c29jLT50eF9wdVtwY11b
dnNdW3BlXSA+IHR4X3B1KQorCQkJdHhfcHUgPSBzb3ItPnNvYy0+dHhfcHVbcGNdW3ZzXVtwZV07
CisKKwkJc3dpdGNoIChsaW5rLT50cmFpbi5wYXR0ZXJuKSB7CisJCWNhc2UgRFBfVFJBSU5JTkdf
UEFUVEVSTl9ESVNBQkxFOgorCQkJdmFsdWUgPSBTT1JfRFBfVFBHX1NDUkFNQkxFUl9HQUxJT1Mg
fAorCQkJCVNPUl9EUF9UUEdfUEFUVEVSTl9OT05FOworCQkJYnJlYWs7CisKKwkJY2FzZSBEUF9U
UkFJTklOR19QQVRURVJOXzE6CisJCQl2YWx1ZSA9IFNPUl9EUF9UUEdfU0NSQU1CTEVSX05PTkUg
fAorCQkJCVNPUl9EUF9UUEdfUEFUVEVSTl9UUkFJTjE7CisJCQlicmVhazsKKworCQljYXNlIERQ
X1RSQUlOSU5HX1BBVFRFUk5fMjoKKwkJCXZhbHVlID0gU09SX0RQX1RQR19TQ1JBTUJMRVJfTk9O
RSB8CisJCQkJU09SX0RQX1RQR19QQVRURVJOX1RSQUlOMjsKKwkJCWJyZWFrOwogCi0JZm9yIChp
ID0gMCwgdmFsdWUgPSAwOyBpIDwgbGluay0+bGFuZXM7IGkrKykgewotCQl1bnNpZ25lZCBsb25n
IGxhbmUgPSBTT1JfRFBfVFBHX0NIQU5ORUxfQ09ESU5HIHwKLQkJCQkgICAgIFNPUl9EUF9UUEdf
U0NSQU1CTEVSX05PTkUgfAotCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJOX1RSQUlOMjsKLQkJ
dmFsdWUgPSAodmFsdWUgPDwgOCkgfCBsYW5lOworCQljYXNlIERQX1RSQUlOSU5HX1BBVFRFUk5f
MzoKKwkJCXZhbHVlID0gU09SX0RQX1RQR19TQ1JBTUJMRVJfTk9ORSB8CisJCQkJU09SX0RQX1RQ
R19QQVRURVJOX1RSQUlOMzsKKwkJCWJyZWFrOworCisJCWRlZmF1bHQ6CisJCQlyZXR1cm4gLUVJ
TlZBTDsKKwkJfQorCisJCWlmIChsaW5rLT5jYXBzLmNoYW5uZWxfY29kaW5nKQorCQkJdmFsdWUg
fD0gU09SX0RQX1RQR19DSEFOTkVMX0NPRElORzsKKworCQlwYXR0ZXJuID0gcGF0dGVybiA8PCA4
IHwgdmFsdWU7CiAJfQogCi0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfRFBfVFBH
KTsKKwl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdm9sdGFnZV9zd2luZywgU09SX0xBTkVfRFJJVkVf
Q1VSUkVOVDApOworCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCBwcmVfZW1waGFzaXMsIFNPUl9MQU5F
X1BSRUVNUEhBU0lTMCk7CiAKLQlwYXR0ZXJuID0gRFBfTElOS19TQ1JBTUJMSU5HX0RJU0FCTEUg
fCBEUF9UUkFJTklOR19QQVRURVJOXzI7CisJaWYgKGxpbmstPmNhcHMudHBzM19zdXBwb3J0ZWQp
CisJCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCBwb3N0X2N1cnNvciwgU09SX0xBTkVfUE9TVENVUlNP
UjApOwogCi0JZXJyID0gZHJtX2RwX2F1eF90cmFpbihzb3ItPmF1eCwgbGluaywgcGF0dGVybik7
Ci0JaWYgKGVyciA8IDApCi0JCXJldHVybiBlcnI7CisJdGVncmFfc29yX3dyaXRlbChzb3IsIHBh
dHRlcm4sIFNPUl9EUF9UUEcpOworCisJdmFsdWUgPSB0ZWdyYV9zb3JfcmVhZGwoc29yLCBzb3It
PnNvYy0+cmVncy0+ZHBfcGFkY3RsMCk7CisJdmFsdWUgJj0gflNPUl9EUF9QQURDVExfVFhfUFVf
TUFTSzsKKwl2YWx1ZSB8PSBTT1JfRFBfUEFEQ1RMX1RYX1BVX0VOQUJMRTsKKwl2YWx1ZSB8PSBT
T1JfRFBfUEFEQ1RMX1RYX1BVKHR4X3B1KTsKKwl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUs
IHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKKworCXVzbGVlcF9yYW5nZSgyMCwgMTAwKTsK
IAotCWZvciAoaSA9IDAsIHZhbHVlID0gMDsgaSA8IGxpbmstPmxhbmVzOyBpKyspIHsKLQkJdW5z
aWduZWQgbG9uZyBsYW5lID0gU09SX0RQX1RQR19DSEFOTkVMX0NPRElORyB8Ci0JCQkJICAgICBT
T1JfRFBfVFBHX1NDUkFNQkxFUl9HQUxJT1MgfAotCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJO
X05PTkU7Ci0JCXZhbHVlID0gKHZhbHVlIDw8IDgpIHwgbGFuZTsKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGludCB0ZWdyYV9zb3JfZHBfbGlua19jb25maWd1cmUoc3RydWN0IGRybV9kcF9saW5r
ICpsaW5rKQoreworCXN0cnVjdCB0ZWdyYV9zb3IgKnNvciA9IGNvbnRhaW5lcl9vZihsaW5rLCBz
dHJ1Y3QgdGVncmFfc29yLCBsaW5rKTsKKwl1bnNpZ25lZCBpbnQgcmF0ZSwgbGFuZXM7CisJdTMy
IHZhbHVlOworCWludCBlcnI7CisKKwlyYXRlID0gZHJtX2RwX2xpbmtfcmF0ZV90b19id19jb2Rl
KGxpbmstPnJhdGUpOworCWxhbmVzID0gbGluay0+bGFuZXM7CisKKwkvKiBjb25maWd1cmUgbGlu
ayBzcGVlZCBhbmQgbGFuZSBjb3VudCAqLworCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwg
U09SX0NMS19DTlRSTCk7CisJdmFsdWUgJj0gflNPUl9DTEtfQ05UUkxfRFBfTElOS19TUEVFRF9N
QVNLOworCXZhbHVlIHw9IFNPUl9DTEtfQ05UUkxfRFBfTElOS19TUEVFRChyYXRlKTsKKwl0ZWdy
YV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9DTEtfQ05UUkwpOworCisJdmFsdWUgPSB0ZWdy
YV9zb3JfcmVhZGwoc29yLCBTT1JfRFBfTElOS0NUTDApOworCXZhbHVlICY9IH5TT1JfRFBfTElO
S0NUTF9MQU5FX0NPVU5UX01BU0s7CisJdmFsdWUgfD0gU09SX0RQX0xJTktDVExfTEFORV9DT1VO
VChsYW5lcyk7CisKKwlpZiAobGluay0+Y2Fwcy5lbmhhbmNlZF9mcmFtaW5nKQorCQl2YWx1ZSB8
PSBTT1JfRFBfTElOS0NUTF9FTkhBTkNFRF9GUkFNRTsKKworCXRlZ3JhX3Nvcl93cml0ZWwoc29y
LCB2YWx1ZSwgU09SX0RQX0xJTktDVEwwKTsKKworCXVzbGVlcF9yYW5nZSg0MDAsIDEwMDApOwor
CisJLyogY29uZmlndXJlIGxvYWQgcHVsc2UgcG9zaXRpb24gYWRqdXN0bWVudCAqLworCXZhbHVl
ID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3MtPnBsbDEpOworCXZhbHVlICY9
IH5TT1JfUExMMV9MT0FEQURKX01BU0s7CisKKwlzd2l0Y2ggKHJhdGUpIHsKKwljYXNlIERQX0xJ
TktfQldfMV82MjoKKwkJdmFsdWUgfD0gU09SX1BMTDFfTE9BREFESigweDMpOworCQlicmVhazsK
KworCWNhc2UgRFBfTElOS19CV18yXzc6CisJCXZhbHVlIHw9IFNPUl9QTEwxX0xPQURBREooMHg0
KTsKKwkJYnJlYWs7CisKKwljYXNlIERQX0xJTktfQldfNV80OgorCQl2YWx1ZSB8PSBTT1JfUExM
MV9MT0FEQURKKDB4Nik7CisJCWJyZWFrOwogCX0KIAotCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2
YWx1ZSwgU09SX0RQX1RQRyk7CisJdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBzb3ItPnNv
Yy0+cmVncy0+cGxsMSk7CiAKLQlwYXR0ZXJuID0gRFBfVFJBSU5JTkdfUEFUVEVSTl9ESVNBQkxF
OworCS8qIHVzZSBhbHRlcm5hdGUgc2NyYW1ibGVyIHJlc2V0IGZvciBlRFAgKi8KKwl2YWx1ZSA9
IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIFNPUl9EUF9TUEFSRTApOwogCi0JZXJyID0gZHJtX2RwX2F1
eF90cmFpbihzb3ItPmF1eCwgbGluaywgcGF0dGVybik7Ci0JaWYgKGVyciA8IDApCisJaWYgKGxp
bmstPmVkcCA9PSAwKQorCQl2YWx1ZSAmPSB+U09SX0RQX1NQQVJFX1BBTkVMX0lOVEVSTkFMOwor
CWVsc2UKKwkJdmFsdWUgfD0gU09SX0RQX1NQQVJFX1BBTkVMX0lOVEVSTkFMOworCisJdGVncmFf
c29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfRFBfU1BBUkUwKTsKKworCWVyciA9IHRlZ3JhX3Nv
cl9wb3dlcl9kb3duX2xhbmVzKHNvcik7CisJaWYgKGVyciA8IDApIHsKKwkJZGV2X2Vycihzb3It
PmRldiwgImZhaWxlZCB0byBwb3dlciBkb3duIGxhbmVzOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJu
IGVycjsKKwl9CisKKwkvKiBwb3dlciB1cCBhbmQgcHJlLWNoYXJnZSBsYW5lcyAqLworCWVyciA9
IHRlZ3JhX3Nvcl9wb3dlcl91cF9sYW5lcyhzb3IsIGxhbmVzKTsKKwlpZiAoZXJyIDwgMCkgewor
CQlkZXZfZXJyKHNvci0+ZGV2LCAiZmFpbGVkIHRvIHBvd2VyIHVwICV1IGxhbmUlczogJWRcbiIs
CisJCQlsYW5lcywgKGxhbmVzICE9IDEpID8gInMiIDogIiIsIGVycik7CiAJCXJldHVybiBlcnI7
CisJfQorCisJdGVncmFfc29yX2RwX3ByZWNoYXJnZShzb3IsIGxhbmVzKTsKIAogCXJldHVybiAw
OwogfQogCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9kcF9saW5rX29wcyB0ZWdyYV9zb3JfZHBf
bGlua19vcHMgPSB7CisJLmFwcGx5X3RyYWluaW5nID0gdGVncmFfc29yX2RwX2xpbmtfYXBwbHlf
dHJhaW5pbmcsCisJLmNvbmZpZ3VyZSA9IHRlZ3JhX3Nvcl9kcF9saW5rX2NvbmZpZ3VyZSwKK307
CisKIHN0YXRpYyB2b2lkIHRlZ3JhX3Nvcl9zdXBlcl91cGRhdGUoc3RydWN0IHRlZ3JhX3NvciAq
c29yKQogewogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCAwLCBTT1JfU1VQRVJfU1RBVEUwKTsKQEAg
LTEyMDEsMjkgKzE0MTIsNiBAQCBzdGF0aWMgaW50IHRlZ3JhX3Nvcl9wb3dlcl9kb3duKHN0cnVj
dCB0ZWdyYV9zb3IgKnNvcikKIAkJcmV0dXJuIGVycjsKIAl9CiAKLQl2YWx1ZSA9IHRlZ3JhX3Nv
cl9yZWFkbChzb3IsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKLQl2YWx1ZSAmPSB+KFNP
Ul9EUF9QQURDVExfUERfVFhEXzMgfCBTT1JfRFBfUEFEQ1RMX1BEX1RYRF8wIHwKLQkJICAgU09S
X0RQX1BBRENUTF9QRF9UWERfMSB8IFNPUl9EUF9QQURDVExfUERfVFhEXzIpOwotCXRlZ3JhX3Nv
cl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwotCi0JLyog
c3RvcCBsYW5lIHNlcXVlbmNlciAqLwotCXZhbHVlID0gU09SX0xBTkVfU0VRX0NUTF9UUklHR0VS
IHwgU09SX0xBTkVfU0VRX0NUTF9TRVFVRU5DRV9VUCB8Ci0JCVNPUl9MQU5FX1NFUV9DVExfUE9X
RVJfU1RBVEVfRE9XTjsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9MQU5FX1NF
UV9DVEwpOwotCi0JdGltZW91dCA9IGppZmZpZXMgKyBtc2Vjc190b19qaWZmaWVzKDI1MCk7Ci0K
LQl3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgdGltZW91dCkpIHsKLQkJdmFsdWUgPSB0ZWdy
YV9zb3JfcmVhZGwoc29yLCBTT1JfTEFORV9TRVFfQ1RMKTsKLQkJaWYgKCh2YWx1ZSAmIFNPUl9M
QU5FX1NFUV9DVExfVFJJR0dFUikgPT0gMCkKLQkJCWJyZWFrOwotCi0JCXVzbGVlcF9yYW5nZSgy
NSwgMTAwKTsKLQl9Ci0KLQlpZiAoKHZhbHVlICYgU09SX0xBTkVfU0VRX0NUTF9UUklHR0VSKSAh
PSAwKQotCQlyZXR1cm4gLUVUSU1FRE9VVDsKLQogCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNv
ciwgc29yLT5zb2MtPnJlZ3MtPnBsbDIpOwogCXZhbHVlIHw9IFNPUl9QTEwyX1BPUlRfUE9XRVJE
T1dOOwogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPnBsbDIp
OwpAQCAtMTYwMywxNyArMTc5MSwxMSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZWRwX2Rpc2Fi
bGUoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCAw
LCBTT1JfU1RBVEUxKTsKIAl0ZWdyYV9zb3JfdXBkYXRlKHNvcik7CiAKLQkvKgotCSAqIFRoZSBm
b2xsb3dpbmcgYWNjZXNzZXMgcmVnaXN0ZXJzIG9mIHRoZSBkaXNwbGF5IGNvbnRyb2xsZXIsIHNv
IG1ha2UKLQkgKiBzdXJlIGl0J3Mgb25seSBleGVjdXRlZCB3aGVuIHRoZSBvdXRwdXQgaXMgYXR0
YWNoZWQgdG8gb25lLgotCSAqLwotCWlmIChkYykgewotCQl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRs
KGRjLCBEQ19ESVNQX0RJU1BfV0lOX09QVElPTlMpOwotCQl2YWx1ZSAmPSB+U09SX0VOQUJMRSgw
KTsKLQkJdGVncmFfZGNfd3JpdGVsKGRjLCB2YWx1ZSwgRENfRElTUF9ESVNQX1dJTl9PUFRJT05T
KTsKKwl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRsKGRjLCBEQ19ESVNQX0RJU1BfV0lOX09QVElPTlMp
OworCXZhbHVlICY9IH5TT1JfRU5BQkxFKDApOworCXRlZ3JhX2RjX3dyaXRlbChkYywgdmFsdWUs
IERDX0RJU1BfRElTUF9XSU5fT1BUSU9OUyk7CiAKLQkJdGVncmFfZGNfY29tbWl0KGRjKTsKLQl9
CisJdGVncmFfZGNfY29tbWl0KGRjKTsKIAogCWVyciA9IHRlZ3JhX3Nvcl9wb3dlcl9kb3duKHNv
cik7CiAJaWYgKGVyciA8IDApCkBAIC0xNjc5LDE5ICsxODYxLDIwIEBAIHN0YXRpYyBpbnQgY2Fs
Y19oX3JlZl90b19zeW5jKGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAogCiBz
dGF0aWMgdm9pZCB0ZWdyYV9zb3JfZWRwX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29k
ZXIpCiB7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmZW5jb2Rlci0+Y3J0Yy0+
c3RhdGUtPmFkanVzdGVkX21vZGU7CiAJc3RydWN0IHRlZ3JhX291dHB1dCAqb3V0cHV0ID0gZW5j
b2Rlcl90b19vdXRwdXQoZW5jb2Rlcik7CiAJc3RydWN0IHRlZ3JhX2RjICpkYyA9IHRvX3RlZ3Jh
X2RjKGVuY29kZXItPmNydGMpOwogCXN0cnVjdCB0ZWdyYV9zb3IgKnNvciA9IHRvX3NvcihvdXRw
dXQpOwogCXN0cnVjdCB0ZWdyYV9zb3JfY29uZmlnIGNvbmZpZzsKIAlzdHJ1Y3QgdGVncmFfc29y
X3N0YXRlICpzdGF0ZTsKLQlzdHJ1Y3QgZHJtX2RwX2xpbmsgbGluazsKLQl1OCByYXRlLCBsYW5l
czsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
aW5mbyAqaW5mbzsKIAl1bnNpZ25lZCBpbnQgaTsKLQlpbnQgZXJyID0gMDsKIAl1MzIgdmFsdWU7
CisJaW50IGVycjsKIAogCXN0YXRlID0gdG9fc29yX3N0YXRlKG91dHB1dC0+Y29ubmVjdG9yLnN0
YXRlKTsKKwltb2RlID0gJmVuY29kZXItPmNydGMtPnN0YXRlLT5hZGp1c3RlZF9tb2RlOworCWlu
Zm8gPSAmb3V0cHV0LT5jb25uZWN0b3IuZGlzcGxheV9pbmZvOwogCiAJcG1fcnVudGltZV9nZXRf
c3luYyhzb3ItPmRldik7CiAKQEAgLTE3MDIsNyArMTg4NSw3IEBAIHN0YXRpYyB2b2lkIHRlZ3Jh
X3Nvcl9lZHBfZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAlpZiAoZXJyIDwg
MCkKIAkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBlbmFibGUgRFA6ICVkXG4iLCBlcnIp
OwogCi0JZXJyID0gZHJtX2RwX2xpbmtfcHJvYmUoc29yLT5hdXgsICZsaW5rKTsKKwllcnIgPSBk
cm1fZHBfbGlua19wcm9iZShzb3ItPmF1eCwgJnNvci0+bGluayk7CiAJaWYgKGVyciA8IDApIHsK
IAkJZGV2X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBwcm9iZSBlRFAgbGluazogJWRcbiIsIGVy
cik7CiAJCXJldHVybjsKQEAgLTE3MTMsMTMgKzE4OTYsNiBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9z
b3JfZWRwX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJaWYgKGVyciA8IDAp
CiAJCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gc2V0IHNhZmUgcGFyZW50IGNsb2NrOiAl
ZFxuIiwgZXJyKTsKIAotCW1lbXNldCgmY29uZmlnLCAwLCBzaXplb2YoY29uZmlnKSk7Ci0JY29u
ZmlnLmJpdHNfcGVyX3BpeGVsID0gc3RhdGUtPmJwYyAqIDM7Ci0KLQllcnIgPSB0ZWdyYV9zb3Jf
Y29tcHV0ZV9jb25maWcoc29yLCBtb2RlLCAmY29uZmlnLCAmbGluayk7Ci0JaWYgKGVyciA8IDAp
Ci0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8gY29tcHV0ZSBjb25maWd1cmF0aW9uOiAl
ZFxuIiwgZXJyKTsKLQogCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgU09SX0NMS19DTlRS
TCk7CiAJdmFsdWUgJj0gflNPUl9DTEtfQ05UUkxfRFBfQ0xLX1NFTF9NQVNLOwogCXZhbHVlIHw9
IFNPUl9DTEtfQ05UUkxfRFBfQ0xLX1NFTF9TSU5HTEVfRFBDTEs7CkBAIC0xODI4LDExNyArMjAw
NCw0NCBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9zb3JfZWRwX2VuYWJsZShzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIpCiAJaWYgKGVyciA8IDApCiAJCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQg
dG8gc2V0IHBhcmVudCBjbG9jazogJWRcbiIsIGVycik7CiAKLQkvKiBwb3dlciBEUCBsYW5lcyAq
LwotCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0
bDApOwotCi0JaWYgKGxpbmsubGFuZXMgPD0gMikKLQkJdmFsdWUgJj0gfihTT1JfRFBfUEFEQ1RM
X1BEX1RYRF8zIHwgU09SX0RQX1BBRENUTF9QRF9UWERfMik7Ci0JZWxzZQotCQl2YWx1ZSB8PSBT
T1JfRFBfUEFEQ1RMX1BEX1RYRF8zIHwgU09SX0RQX1BBRENUTF9QRF9UWERfMjsKLQotCWlmIChs
aW5rLmxhbmVzIDw9IDEpCi0JCXZhbHVlICY9IH5TT1JfRFBfUEFEQ1RMX1BEX1RYRF8xOwotCWVs
c2UKLQkJdmFsdWUgfD0gU09SX0RQX1BBRENUTF9QRF9UWERfMTsKLQotCWlmIChsaW5rLmxhbmVz
ID09IDApCi0JCXZhbHVlICY9IH5TT1JfRFBfUEFEQ1RMX1BEX1RYRF8wOwotCWVsc2UKLQkJdmFs
dWUgfD0gU09SX0RQX1BBRENUTF9QRF9UWERfMDsKLQotCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2
YWx1ZSwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwotCi0JdmFsdWUgPSB0ZWdyYV9zb3Jf
cmVhZGwoc29yLCBTT1JfRFBfTElOS0NUTDApOwotCXZhbHVlICY9IH5TT1JfRFBfTElOS0NUTF9M
QU5FX0NPVU5UX01BU0s7Ci0JdmFsdWUgfD0gU09SX0RQX0xJTktDVExfTEFORV9DT1VOVChsaW5r
LmxhbmVzKTsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNPUl9EUF9MSU5LQ1RMMCk7
Ci0KLQkvKiBzdGFydCBsYW5lIHNlcXVlbmNlciAqLwotCXZhbHVlID0gU09SX0xBTkVfU0VRX0NU
TF9UUklHR0VSIHwgU09SX0xBTkVfU0VRX0NUTF9TRVFVRU5DRV9ET1dOIHwKLQkJU09SX0xBTkVf
U0VRX0NUTF9QT1dFUl9TVEFURV9VUDsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNvciwgdmFsdWUsIFNP
Ul9MQU5FX1NFUV9DVEwpOwotCi0Jd2hpbGUgKHRydWUpIHsKLQkJdmFsdWUgPSB0ZWdyYV9zb3Jf
cmVhZGwoc29yLCBTT1JfTEFORV9TRVFfQ1RMKTsKLQkJaWYgKCh2YWx1ZSAmIFNPUl9MQU5FX1NF
UV9DVExfVFJJR0dFUikgPT0gMCkKLQkJCWJyZWFrOwotCi0JCXVzbGVlcF9yYW5nZSgyNTAsIDEw
MDApOwotCX0KLQotCS8qIHNldCBsaW5rIGJhbmR3aWR0aCAqLwotCXZhbHVlID0gdGVncmFfc29y
X3JlYWRsKHNvciwgU09SX0NMS19DTlRSTCk7Ci0JdmFsdWUgJj0gflNPUl9DTEtfQ05UUkxfRFBf
TElOS19TUEVFRF9NQVNLOwotCXZhbHVlIHw9IGRybV9kcF9saW5rX3JhdGVfdG9fYndfY29kZShs
aW5rLnJhdGUpIDw8IDI7Ci0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfQ0xLX0NO
VFJMKTsKLQotCXRlZ3JhX3Nvcl9hcHBseV9jb25maWcoc29yLCAmY29uZmlnKTsKKwkvKiB1c2Ug
RFAtQSBwcm90b2NvbCAqLworCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgU09SX1NUQVRF
MSk7CisJdmFsdWUgJj0gflNPUl9TVEFURV9BU1lfUFJPVE9DT0xfTUFTSzsKKwl2YWx1ZSB8PSBT
T1JfU1RBVEVfQVNZX1BST1RPQ09MX0RQX0E7CisJdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVl
LCBTT1JfU1RBVEUxKTsKIAotCS8qIGVuYWJsZSBsaW5rICovCisJLyogZW5hYmxlIHBvcnQgKi8K
IAl2YWx1ZSA9IHRlZ3JhX3Nvcl9yZWFkbChzb3IsIFNPUl9EUF9MSU5LQ1RMMCk7CiAJdmFsdWUg
fD0gU09SX0RQX0xJTktDVExfRU5BQkxFOwotCXZhbHVlIHw9IFNPUl9EUF9MSU5LQ1RMX0VOSEFO
Q0VEX0ZSQU1FOwogCXRlZ3JhX3Nvcl93cml0ZWwoc29yLCB2YWx1ZSwgU09SX0RQX0xJTktDVEww
KTsKIAotCWZvciAoaSA9IDAsIHZhbHVlID0gMDsgaSA8IDQ7IGkrKykgewotCQl1bnNpZ25lZCBs
b25nIGxhbmUgPSBTT1JfRFBfVFBHX0NIQU5ORUxfQ09ESU5HIHwKLQkJCQkgICAgIFNPUl9EUF9U
UEdfU0NSQU1CTEVSX0dBTElPUyB8Ci0JCQkJICAgICBTT1JfRFBfVFBHX1BBVFRFUk5fTk9ORTsK
LQkJdmFsdWUgPSAodmFsdWUgPDwgOCkgfCBsYW5lOwotCX0KLQotCXRlZ3JhX3Nvcl93cml0ZWwo
c29yLCB2YWx1ZSwgU09SX0RQX1RQRyk7CisJLyogY2FsaWJyYXRlIHRlcm1pbmF0aW9uIHJlc2lz
dGFuY2UgKFhYWCBkbyB0aGlzIG9ubHkgb24gSFBEKSAqLworCXRlZ3JhX3Nvcl9kcF90ZXJtX2Nh
bGlicmF0ZShzb3IpOwogCi0JLyogZW5hYmxlIHBhZCBjYWxpYnJhdGlvbiBsb2dpYyAqLwotCXZh
bHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgc29yLT5zb2MtPnJlZ3MtPmRwX3BhZGN0bDApOwot
CXZhbHVlIHw9IFNPUl9EUF9QQURDVExfUEFEX0NBTF9QRDsKLQl0ZWdyYV9zb3Jfd3JpdGVsKHNv
ciwgdmFsdWUsIHNvci0+c29jLT5yZWdzLT5kcF9wYWRjdGwwKTsKLQotCWVyciA9IGRybV9kcF9s
aW5rX3Byb2JlKHNvci0+YXV4LCAmbGluayk7CisJZXJyID0gZHJtX2RwX2xpbmtfdHJhaW4oJnNv
ci0+bGluayk7CiAJaWYgKGVyciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJmYWlsZWQgdG8g
cHJvYmUgZURQIGxpbms6ICVkXG4iLCBlcnIpOwotCi0JZXJyID0gZHJtX2RwX2xpbmtfcG93ZXJf
dXAoc29yLT5hdXgsICZsaW5rKTsKLQlpZiAoZXJyIDwgMCkKLQkJZGV2X2Vycihzb3ItPmRldiwg
ImZhaWxlZCB0byBwb3dlciB1cCBlRFAgbGluazogJWRcbiIsIGVycik7Ci0KLQllcnIgPSBkcm1f
ZHBfbGlua19jb25maWd1cmUoc29yLT5hdXgsICZsaW5rKTsKLQlpZiAoZXJyIDwgMCkKLQkJZGV2
X2Vycihzb3ItPmRldiwgImZhaWxlZCB0byBjb25maWd1cmUgZURQIGxpbms6ICVkXG4iLCBlcnIp
OwotCi0JcmF0ZSA9IGRybV9kcF9saW5rX3JhdGVfdG9fYndfY29kZShsaW5rLnJhdGUpOwotCWxh
bmVzID0gbGluay5sYW5lczsKLQotCXZhbHVlID0gdGVncmFfc29yX3JlYWRsKHNvciwgU09SX0NM
S19DTlRSTCk7Ci0JdmFsdWUgJj0gflNPUl9DTEtfQ05UUkxfRFBfTElOS19TUEVFRF9NQVNLOwot
CXZhbHVlIHw9IFNPUl9DTEtfQ05UUkxfRFBfTElOS19TUEVFRChyYXRlKTsKLQl0ZWdyYV9zb3Jf
d3JpdGVsKHNvciwgdmFsdWUsIFNPUl9DTEtfQ05UUkwpOwotCi0JdmFsdWUgPSB0ZWdyYV9zb3Jf
cmVhZGwoc29yLCBTT1JfRFBfTElOS0NUTDApOwotCXZhbHVlICY9IH5TT1JfRFBfTElOS0NUTF9M
QU5FX0NPVU5UX01BU0s7Ci0JdmFsdWUgfD0gU09SX0RQX0xJTktDVExfTEFORV9DT1VOVChsYW5l
cyk7Ci0KLQlpZiAobGluay5jYXBzLmVuaGFuY2VkX2ZyYW1pbmcpCi0JCXZhbHVlIHw9IFNPUl9E
UF9MSU5LQ1RMX0VOSEFOQ0VEX0ZSQU1FOwotCi0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVl
LCBTT1JfRFBfTElOS0NUTDApOwotCi0JLyogZGlzYWJsZSB0cmFpbmluZyBwYXR0ZXJuIGdlbmVy
YXRvciAqLworCQlkZXZfZXJyKHNvci0+ZGV2LCAibGluayB0cmFpbmluZyBmYWlsZWQ6ICVkXG4i
LCBlcnIpOworCWVsc2UKKwkJZGV2X2RiZyhzb3ItPmRldiwgImxpbmsgdHJhaW5pbmcgc3VjY2Vl
ZGVkXG4iKTsKIAotCWZvciAoaSA9IDA7IGkgPCBsaW5rLmxhbmVzOyBpKyspIHsKLQkJdW5zaWdu
ZWQgbG9uZyBsYW5lID0gU09SX0RQX1RQR19DSEFOTkVMX0NPRElORyB8Ci0JCQkJICAgICBTT1Jf
RFBfVFBHX1NDUkFNQkxFUl9HQUxJT1MgfAotCQkJCSAgICAgU09SX0RQX1RQR19QQVRURVJOX05P
TkU7Ci0JCXZhbHVlID0gKHZhbHVlIDw8IDgpIHwgbGFuZTsKKwllcnIgPSBkcm1fZHBfbGlua19w
b3dlcl91cChzb3ItPmF1eCwgJnNvci0+bGluayk7CisJaWYgKGVyciA8IDApIHsKKwkJZGV2X2Vy
cihzb3ItPmRldiwgImZhaWxlZCB0byBwb3dlciB1cCBlRFAgbGluazogJWRcbiIsCisJCQllcnIp
OworCQlyZXR1cm47CiAJfQogCi0JdGVncmFfc29yX3dyaXRlbChzb3IsIHZhbHVlLCBTT1JfRFBf
VFBHKTsKKwkvKiBjb21wdXRlIGNvbmZpZ3VyYXRpb24gKi8KKwltZW1zZXQoJmNvbmZpZywgMCwg
c2l6ZW9mKGNvbmZpZykpOworCWNvbmZpZy5iaXRzX3Blcl9waXhlbCA9IHN0YXRlLT5icGMgKiAz
OwogCi0JZXJyID0gdGVncmFfc29yX2RwX3RyYWluX2Zhc3Qoc29yLCAmbGluayk7Ci0JaWYgKGVy
ciA8IDApCi0JCWRldl9lcnIoc29yLT5kZXYsICJEUCBmYXN0IGxpbmsgdHJhaW5pbmcgZmFpbGVk
OiAlZFxuIiwgZXJyKTsKKwllcnIgPSB0ZWdyYV9zb3JfY29tcHV0ZV9jb25maWcoc29yLCBtb2Rl
LCAmY29uZmlnLCAmc29yLT5saW5rKTsKKwlpZiAoZXJyIDwgMCkgeworCQlkZXZfZXJyKHNvci0+
ZGV2LCAiZmFpbGVkIHRvIGNvbXB1dGUgY29uZmlndXJhdGlvbjogJWRcbiIsIGVycik7CisJCXJl
dHVybjsKKwl9CiAKLQlkZXZfZGJnKHNvci0+ZGV2LCAiZmFzdCBsaW5rIHRyYWluaW5nIHN1Y2Nl
ZWRlZFxuIik7CisJdGVncmFfc29yX2FwcGx5X2NvbmZpZyhzb3IsICZjb25maWcpOwogCiAJZXJy
ID0gdGVncmFfc29yX3Bvd2VyX3VwKHNvciwgMjUwKTsKIAlpZiAoZXJyIDwgMCkKQEAgLTI4NDIs
NiArMjk0NSw5IEBAIHN0YXRpYyBpbnQgdGVncmFfc29yX2luaXQoc3RydWN0IGhvc3QxeF9jbGll
bnQgKmNsaWVudCkKIAkJCWNvbm5lY3RvciA9IERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNwbGF5UG9y
dDsKIAkJCWVuY29kZXIgPSBEUk1fTU9ERV9FTkNPREVSX1RNRFM7CiAJCX0KKworCQlzb3ItPmxp
bmsub3BzID0gJnRlZ3JhX3Nvcl9kcF9saW5rX29wczsKKwkJc29yLT5saW5rLmF1eCA9IHNvci0+
YXV4OwogCX0KIAogCXNvci0+b3V0cHV0LmRldiA9IHNvci0+ZGV2OwpAQCAtMzA0Miw2ICszMTQ4
LDEwNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9yZWdzIHRlZ3JhMTI0X3Nvcl9y
ZWdzID0gewogCS5kcF9wYWRjdGwyID0gMHg3MywKIH07CiAKKy8qIFRlZ3JhMTI0IGFuZCBUZWdy
YTEzMiBoYXZlIGxhbmVzIDAgYW5kIDIgc3dhcHBlZC4gKi8KK3N0YXRpYyBjb25zdCB1OCB0ZWdy
YTEyNF9zb3JfbGFuZV9tYXBbNF0gPSB7CisJMiwgMSwgMCwgMywKK307CisKK3N0YXRpYyBjb25z
dCB1OCB0ZWdyYTEyNF9zb3Jfdm9sdGFnZV9zd2luZ1s0XVs0XVs0XSA9IHsKKwl7CisJCXsgMHgx
MywgMHgxOSwgMHgxZSwgMHgyOCB9LAorCQl7IDB4MWUsIDB4MjUsIDB4MmQsIH0sCisJCXsgMHgy
OCwgMHgzMiwgfSwKKwkJeyAweDNjLCB9LAorCX0sIHsKKwkJeyAweDEyLCAweDE3LCAweDFiLCAw
eDI1IH0sCisJCXsgMHgxYywgMHgyMywgMHgyYSwgfSwKKwkJeyAweDI1LCAweDJmLCB9LAorCQl7
IDB4MzksIH0KKwl9LCB7CisJCXsgMHgxMiwgMHgxNiwgMHgxYSwgMHgyMiB9LAorCQl7IDB4MWIs
IDB4MjAsIDB4MjcsIH0sCisJCXsgMHgyNCwgMHgyZCwgfSwKKwkJeyAweDM2LCB9LAorCX0sIHsK
KwkJeyAweDExLCAweDE0LCAweDE3LCAweDFmIH0sCisJCXsgMHgxOSwgMHgxZSwgMHgyNCwgfSwK
KwkJeyAweDIyLCAweDJhLCB9LAorCQl7IDB4MzIsIH0sCisJfSwKK307CisKK3N0YXRpYyBjb25z
dCB1OCB0ZWdyYTEyNF9zb3JfcHJlX2VtcGhhc2lzWzRdWzRdWzRdID0geworCXsKKwkJeyAweDAw
LCAweDA5LCAweDEzLCAweDI1IH0sCisJCXsgMHgwMCwgMHgwZiwgMHgxZSwgfSwKKwkJeyAweDAw
LCAweDE0LCB9LAorCQl7IDB4MDAsIH0sCisJfSwgeworCQl7IDB4MDAsIDB4MGEsIDB4MTQsIDB4
MjggfSwKKwkJeyAweDAwLCAweDBmLCAweDFlLCB9LAorCQl7IDB4MDAsIDB4MTQsIH0sCisJCXsg
MHgwMCB9LAorCX0sIHsKKwkJeyAweDAwLCAweDBhLCAweDE0LCAweDI4IH0sCisJCXsgMHgwMCwg
MHgwZiwgMHgxZSwgfSwKKwkJeyAweDAwLCAweDE0LCB9LAorCQl7IDB4MDAsIH0sCisJfSwgewor
CQl7IDB4MDAsIDB4MGEsIDB4MTQsIDB4MjggfSwKKwkJeyAweDAwLCAweDBmLCAweDFlLCB9LAor
CQl7IDB4MDAsIDB4MTQsIH0sCisJCXsgMHgwMCwgfSwKKwl9LAorfTsKKworc3RhdGljIGNvbnN0
IHU4IHRlZ3JhMTI0X3Nvcl9wb3N0X2N1cnNvcls0XVs0XVs0XSA9IHsKKwl7CisJCXsgMHgwMCwg
MHgwMCwgMHgwMCwgMHgwMCB9LAorCQl7IDB4MDAsIDB4MDAsIDB4MDAsIH0sCisJCXsgMHgwMCwg
MHgwMCwgfSwKKwkJeyAweDAwLCB9LAorCX0sIHsKKwkJeyAweDAyLCAweDAyLCAweDA0LCAweDA1
IH0sCisJCXsgMHgwMiwgMHgwNCwgMHgwNSwgfSwKKwkJeyAweDA0LCAweDA1LCB9LAorCQl7IDB4
MDUsIH0sCisJfSwgeworCQl7IDB4MDQsIDB4MDUsIDB4MDgsIDB4MGIgfSwKKwkJeyAweDA1LCAw
eDA5LCAweDBiLCB9LAorCQl7IDB4MDgsIDB4MGEsIH0sCisJCXsgMHgwYiwgfSwKKwl9LCB7CisJ
CXsgMHgwNSwgMHgwOSwgMHgwYiwgMHgxMiB9LAorCQl7IDB4MDksIDB4MGQsIDB4MTIsIH0sCisJ
CXsgMHgwYiwgMHgwZiwgfSwKKwkJeyAweDEyLCB9LAorCX0sCit9OworCitzdGF0aWMgY29uc3Qg
dTggdGVncmExMjRfc29yX3R4X3B1WzRdWzRdWzRdID0geworCXsKKwkJeyAweDIwLCAweDMwLCAw
eDQwLCAweDYwIH0sCisJCXsgMHgzMCwgMHg0MCwgMHg2MCwgfSwKKwkJeyAweDQwLCAweDYwLCB9
LAorCQl7IDB4NjAsIH0sCisJfSwgeworCQl7IDB4MjAsIDB4MjAsIDB4MzAsIDB4NTAgfSwKKwkJ
eyAweDMwLCAweDQwLCAweDUwLCB9LAorCQl7IDB4NDAsIDB4NTAsIH0sCisJCXsgMHg2MCwgfSwK
Kwl9LCB7CisJCXsgMHgyMCwgMHgyMCwgMHgzMCwgMHg0MCwgfSwKKwkJeyAweDMwLCAweDMwLCAw
eDQwLCB9LAorCQl7IDB4NDAsIDB4NTAsIH0sCisJCXsgMHg2MCwgfSwKKwl9LCB7CisJCXsgMHgy
MCwgMHgyMCwgMHgyMCwgMHg0MCwgfSwKKwkJeyAweDMwLCAweDMwLCAweDQwLCB9LAorCQl7IDB4
NDAsIDB4NDAsIH0sCisJCXsgMHg2MCwgfSwKKwl9LAorfTsKKwogc3RhdGljIGNvbnN0IHN0cnVj
dCB0ZWdyYV9zb3Jfc29jIHRlZ3JhMTI0X3NvciA9IHsKIAkuc3VwcG9ydHNfZWRwID0gdHJ1ZSwK
IAkuc3VwcG9ydHNfbHZkcyA9IHRydWUsCkBAIC0zMDUwLDYgKzMyNTcsNTAgQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCB0ZWdyYV9zb3Jfc29jIHRlZ3JhMTI0X3NvciA9IHsKIAkucmVncyA9ICZ0ZWdy
YTEyNF9zb3JfcmVncywKIAkuaGFzX252ZGlzcGxheSA9IGZhbHNlLAogCS54YmFyX2NmZyA9IHRl
Z3JhMTI0X3Nvcl94YmFyX2NmZywKKwkubGFuZV9tYXAgPSB0ZWdyYTEyNF9zb3JfbGFuZV9tYXAs
CisJLnZvbHRhZ2Vfc3dpbmcgPSB0ZWdyYTEyNF9zb3Jfdm9sdGFnZV9zd2luZywKKwkucHJlX2Vt
cGhhc2lzID0gdGVncmExMjRfc29yX3ByZV9lbXBoYXNpcywKKwkucG9zdF9jdXJzb3IgPSB0ZWdy
YTEyNF9zb3JfcG9zdF9jdXJzb3IsCisJLnR4X3B1ID0gdGVncmExMjRfc29yX3R4X3B1LAorfTsK
Kworc3RhdGljIGNvbnN0IHU4IHRlZ3JhMTMyX3Nvcl9wcmVfZW1waGFzaXNbNF1bNF1bNF0gPSB7
CisJeworCQl7IDB4MDAsIDB4MDgsIDB4MTIsIDB4MjQgfSwKKwkJeyAweDAxLCAweDBlLCAweDFk
LCB9LAorCQl7IDB4MDEsIDB4MTMsIH0sCisJCXsgMHgwMCwgfSwKKwl9LCB7CisJCXsgMHgwMCwg
MHgwOCwgMHgxMiwgMHgyNCB9LAorCQl7IDB4MDAsIDB4MGUsIDB4MWQsIH0sCisJCXsgMHgwMCwg
MHgxMywgfSwKKwkJeyAweDAwIH0sCisJfSwgeworCQl7IDB4MDAsIDB4MDgsIDB4MTIsIDB4MjQg
fSwKKwkJeyAweDAwLCAweDBlLCAweDFkLCB9LAorCQl7IDB4MDAsIDB4MTMsIH0sCisJCXsgMHgw
MCwgfSwKKwl9LCB7CisJCXsgMHgwMCwgMHgwOCwgMHgxMiwgMHgyNCB9LAorCQl7IDB4MDAsIDB4
MGUsIDB4MWQsIH0sCisJCXsgMHgwMCwgMHgxMywgfSwKKwkJeyAweDAwLCB9LAorCX0sCit9Owor
CitzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9zb2MgdGVncmExMzJfc29yID0geworCS5z
dXBwb3J0c19lZHAgPSB0cnVlLAorCS5zdXBwb3J0c19sdmRzID0gdHJ1ZSwKKwkuc3VwcG9ydHNf
aGRtaSA9IGZhbHNlLAorCS5zdXBwb3J0c19kcCA9IGZhbHNlLAorCS5yZWdzID0gJnRlZ3JhMTI0
X3Nvcl9yZWdzLAorCS5oYXNfbnZkaXNwbGF5ID0gZmFsc2UsCisJLnhiYXJfY2ZnID0gdGVncmEx
MjRfc29yX3hiYXJfY2ZnLAorCS5sYW5lX21hcCA9IHRlZ3JhMTI0X3Nvcl9sYW5lX21hcCwKKwku
dm9sdGFnZV9zd2luZyA9IHRlZ3JhMTI0X3Nvcl92b2x0YWdlX3N3aW5nLAorCS5wcmVfZW1waGFz
aXMgPSB0ZWdyYTEzMl9zb3JfcHJlX2VtcGhhc2lzLAorCS5wb3N0X2N1cnNvciA9IHRlZ3JhMTI0
X3Nvcl9wb3N0X2N1cnNvciwKKwkudHhfcHUgPSB0ZWdyYTEyNF9zb3JfdHhfcHUsCiB9OwogCiBz
dGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9yZWdzIHRlZ3JhMjEwX3Nvcl9yZWdzID0gewpA
QCAtMzA2NywxOCArMzMxOCwyMCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3Nvcl9yZWdz
IHRlZ3JhMjEwX3Nvcl9yZWdzID0gewogCS5kcF9wYWRjdGwyID0gMHg3MywKIH07CiAKK3N0YXRp
YyBjb25zdCB1OCB0ZWdyYTIxMF9zb3JfeGJhcl9jZmdbNV0gPSB7CisJMiwgMSwgMCwgMywgNAor
fTsKKwogc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdyYV9zb3Jfc29jIHRlZ3JhMjEwX3NvciA9IHsK
IAkuc3VwcG9ydHNfZWRwID0gdHJ1ZSwKIAkuc3VwcG9ydHNfbHZkcyA9IGZhbHNlLAogCS5zdXBw
b3J0c19oZG1pID0gZmFsc2UsCiAJLnN1cHBvcnRzX2RwID0gZmFsc2UsCisKIAkucmVncyA9ICZ0
ZWdyYTIxMF9zb3JfcmVncywKIAkuaGFzX252ZGlzcGxheSA9IGZhbHNlLAotCS54YmFyX2NmZyA9
IHRlZ3JhMTI0X3Nvcl94YmFyX2NmZywKLX07CiAKLXN0YXRpYyBjb25zdCB1OCB0ZWdyYTIxMF9z
b3JfeGJhcl9jZmdbNV0gPSB7Ci0JMiwgMSwgMCwgMywgNAorCS54YmFyX2NmZyA9IHRlZ3JhMjEw
X3Nvcl94YmFyX2NmZywKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfc29yX3NvYyB0
ZWdyYTIxMF9zb3IxID0gewpAQCAtMzA5Miw3ICszMzQ1LDYgQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCB0ZWdyYV9zb3Jfc29jIHRlZ3JhMjEwX3NvcjEgPSB7CiAKIAkubnVtX3NldHRpbmdzID0gQVJS
QVlfU0laRSh0ZWdyYTIxMF9zb3JfaGRtaV9kZWZhdWx0cyksCiAJLnNldHRpbmdzID0gdGVncmEy
MTBfc29yX2hkbWlfZGVmYXVsdHMsCi0KIAkueGJhcl9jZmcgPSB0ZWdyYTIxMF9zb3JfeGJhcl9j
ZmcsCiB9OwogCkBAIC0zMTM0LDcgKzMzODYsNiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3Jh
X3Nvcl9zb2MgdGVncmExODZfc29yMSA9IHsKIAogCS5udW1fc2V0dGluZ3MgPSBBUlJBWV9TSVpF
KHRlZ3JhMTg2X3Nvcl9oZG1pX2RlZmF1bHRzKSwKIAkuc2V0dGluZ3MgPSB0ZWdyYTE4Nl9zb3Jf
aGRtaV9kZWZhdWx0cywKLQogCS54YmFyX2NmZyA9IHRlZ3JhMTI0X3Nvcl94YmFyX2NmZywKIH07
CiAKQEAgLTMxNzQsNiArMzQyNSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lk
IHRlZ3JhX3Nvcl9vZl9tYXRjaFtdID0gewogCXsgLmNvbXBhdGlibGUgPSAibnZpZGlhLHRlZ3Jh
MTg2LXNvciIsIC5kYXRhID0gJnRlZ3JhMTg2X3NvciB9LAogCXsgLmNvbXBhdGlibGUgPSAibnZp
ZGlhLHRlZ3JhMjEwLXNvcjEiLCAuZGF0YSA9ICZ0ZWdyYTIxMF9zb3IxIH0sCiAJeyAuY29tcGF0
aWJsZSA9ICJudmlkaWEsdGVncmEyMTAtc29yIiwgLmRhdGEgPSAmdGVncmEyMTBfc29yIH0sCisJ
eyAuY29tcGF0aWJsZSA9ICJudmlkaWEsdGVncmExMzItc29yIiwgLmRhdGEgPSAmdGVncmExMzJf
c29yIH0sCiAJeyAuY29tcGF0aWJsZSA9ICJudmlkaWEsdGVncmExMjQtc29yIiwgLmRhdGEgPSAm
dGVncmExMjRfc29yIH0sCiAJeyB9LAogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90
ZWdyYS9zb3IuaCBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9zb3IuaAppbmRleCBmOGVmZDhiZTRi
N2MuLjUzMzM0MDZjMDQwMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3Nvci5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9zb3IuaApAQCAtMjgzLDEwICsyODMsMTIgQEAK
ICNkZWZpbmUgIFNPUl9EUF9QQURDVExfQ01fVFhEXzIJCSgxIDw8IDYpCiAjZGVmaW5lICBTT1Jf
RFBfUEFEQ1RMX0NNX1RYRF8xCQkoMSA8PCA1KQogI2RlZmluZSAgU09SX0RQX1BBRENUTF9DTV9U
WERfMAkJKDEgPDwgNCkKKyNkZWZpbmUgIFNPUl9EUF9QQURDVExfQ01fVFhEKHgpCSgxIDw8ICg0
ICsgKHgpKSkKICNkZWZpbmUgIFNPUl9EUF9QQURDVExfUERfVFhEXzMJCSgxIDw8IDMpCiAjZGVm
aW5lICBTT1JfRFBfUEFEQ1RMX1BEX1RYRF8wCQkoMSA8PCAyKQogI2RlZmluZSAgU09SX0RQX1BB
RENUTF9QRF9UWERfMQkJKDEgPDwgMSkKICNkZWZpbmUgIFNPUl9EUF9QQURDVExfUERfVFhEXzIJ
CSgxIDw8IDApCisjZGVmaW5lICBTT1JfRFBfUEFEQ1RMX1BEX1RYRCh4KQkoMSA8PCAoMCArICh4
KSkpCiAKICNkZWZpbmUgU09SX0RQX1BBRENUTDEgMHg1ZAogCi0tIAoyLjIzLjAKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
