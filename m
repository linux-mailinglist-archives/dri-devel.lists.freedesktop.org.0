Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D2EE1079CA
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 22:09:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8DD4A6F583;
	Fri, 22 Nov 2019 21:09:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B85B06F575;
 Fri, 22 Nov 2019 21:09:01 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Nov 2019 13:09:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,231,1571727600"; d="scan'208";a="205575856"
Received: from nvishwa1-desk.sc.intel.com ([10.3.160.185])
 by fmsmga007.fm.intel.com with ESMTP; 22 Nov 2019 13:08:59 -0800
From: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC 06/13] drm/i915/svm: Page table mirroring support
Date: Fri, 22 Nov 2019 12:57:27 -0800
Message-Id: <20191122205734.15925-7-niranjana.vishwanathapura@intel.com>
X-Mailer: git-send-email 2.21.0.rc0.32.g243a4c7e27
In-Reply-To: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
References: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sanjay.k.kumar@intel.com, sudeep.dutt@intel.com,
 dri-devel@lists.freedesktop.org, dave.hansen@intel.com, jglisse@redhat.com,
 jon.bloomfield@intel.com, daniel.vetter@intel.com, dan.j.williams@intel.com,
 ira.weiny@intel.com, jgg@mellanox.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXNlIEhNTSBwYWdlIHRhYmxlIG1pcnJvcmluZyBzdXBwb3J0IHRvIGJ1aWxkIGRldmljZSBwYWdl
IHRhYmxlLgpJbXBsZW1lbnQgdGhlIGJpbmQgaW9jdGwgYW5kIGJpbmQgdGhlIHByb2Nlc3MgYWRk
cmVzcyByYW5nZSBpbiB0aGUKc3BlY2lmaWVkIGNvbnRleHQncyBwcGd0dC4KSGFuZGxlIGludmFs
aWRhdGlvbiBub3RpZmljYXRpb25zIGJ5IHVuYmluZGluZyB0aGUgYWRkcmVzcyByYW5nZS4KCkNj
OiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBK
b24gQmxvb21maWVsZCA8am9uLmJsb29tZmllbGRAaW50ZWwuY29tPgpDYzogRGFuaWVsIFZldHRl
ciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBTdWRlZXAgRHV0dCA8c3VkZWVwLmR1dHRA
aW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBOaXJhbmphbmEgVmlzaHdhbmF0aGFwdXJhIDxuaXJh
bmphbmEudmlzaHdhbmF0aGFwdXJhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9LY29uZmlnICAgICAgICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAg
ICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgfCAgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgfCAgIDUgKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggfCAgIDQgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zdm0uYyAgICAgfCAyOTYgKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zdm0uaCAgICAgfCAgNTAgKysrKysKIDcgZmlsZXMgY2hhbmdl
ZCwgMzYzIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N2bS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zdm0uaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L0tjb25maWcgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnCmluZGV4IGMyZTQ4NzEw
ZWVjOC4uNjg5ZTU3ZmUzOTczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29u
ZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcKQEAgLTE0MSw2ICsxNDEsOSBA
QCBjb25maWcgRFJNX0k5MTVfU1ZNCiAJYm9vbCAiRW5hYmxlIFNoYXJlZCBWaXJ0dWFsIE1lbW9y
eSBzdXBwb3J0IGluIGk5MTUiCiAJZGVwZW5kcyBvbiBTVEFHSU5HCiAJZGVwZW5kcyBvbiBEUk1f
STkxNQorCWRlcGVuZHMgb24gTU1VCisJc2VsZWN0IEhNTV9NSVJST1IKKwlzZWxlY3QgTU1VX05P
VElGSUVSCiAJZGVmYXVsdCBuCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMgb3B0aW9uIGlmIHlvdSB3
YW50IFNoYXJlZCBWaXJ0dWFsIE1lbW9yeSAoU1ZNKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA3
NWZlNDU2MzM3NzkuLjdkNGNkOWVlZmQxMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTE1NCw3
ICsxNTQsOCBAQCBpOTE1LXkgKz0gXAogCSAgaW50ZWxfd29wY20ubwogCiAjIFNWTSBjb2RlCi1p
OTE1LSQoQ09ORklHX0RSTV9JOTE1X1NWTSkgKz0gZ2VtL2k5MTVfZ2VtX3N2bS5vCitpOTE1LSQo
Q09ORklHX0RSTV9JOTE1X1NWTSkgKz0gZ2VtL2k5MTVfZ2VtX3N2bS5vIFwKKwkJCSAgICAgICBp
OTE1X3N2bS5vCiAKICMgZ2VuZXJhbC1wdXJwb3NlIG1pY3JvY29udHJvbGxlciAoR3VDKSBzdXBw
b3J0CiBvYmoteSArPSBndC91Yy8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDljNTI1ZDNm
Njk0Yy4uYzE5MGRmNjE0YzQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTczLDYgKzcz
LDcgQEAKICNpbmNsdWRlICJpOTE1X3BlcmYuaCIKICNpbmNsdWRlICJpOTE1X3F1ZXJ5LmgiCiAj
aW5jbHVkZSAiaTkxNV9zdXNwZW5kLmgiCisjaW5jbHVkZSAiaTkxNV9zdm0uaCIKICNpbmNsdWRl
ICJpOTE1X3N3aXRjaGVyb28uaCIKICNpbmNsdWRlICJpOTE1X3N5c2ZzLmgiCiAjaW5jbHVkZSAi
aTkxNV90cmFjZS5oIgpAQCAtMjcwMCw2ICsyNzAxLDggQEAgc3RhdGljIGludCBpOTE1X2JpbmRf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1FTk9F
TlQ7CiAKIAlzd2l0Y2ggKGFyZ3MtPnR5cGUpIHsKKwljYXNlIEk5MTVfQklORF9TVk1fQlVGRkVS
OgorCQlyZXR1cm4gaTkxNV9zdm1fYmluZCh2bSwgYXJncyk7CiAJY2FzZSBJOTE1X0JJTkRfU1ZN
X0dFTV9PQko6CiAJCXJldCA9IGk5MTVfZ2VtX3N2bV9iaW5kKHZtLCBhcmdzLCBmaWxlKTsKIAl9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IGQ5ZTk1MjI5YmExZC4uMDhjYmJi
NGQ5MWNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtNDIsNiArNDIsNyBA
QAogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X3NjYXR0ZXJsaXN0Lmgi
CisjaW5jbHVkZSAiaTkxNV9zdm0uaCIKICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVk
ZSAiaTkxNV92Z3B1LmgiCiAKQEAgLTU1MCw2ICs1NTEsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X2Fk
ZHJlc3Nfc3BhY2VfZmluaShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlkcm1fbW1f
dGFrZWRvd24oJnZtLT5tbSk7CiAKIAltdXRleF9kZXN0cm95KCZ2bS0+bXV0ZXgpOworCW11dGV4
X2Rlc3Ryb3koJnZtLT5zdm1fbXV0ZXgpOwogfQogCiB2b2lkIF9faTkxNV92bV9jbG9zZShzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKQEAgLTU5Myw2ICs1OTUsNyBAQCB2b2lkIGk5MTVf
dm1fcmVsZWFzZShzdHJ1Y3Qga3JlZiAqa3JlZikKIAlHRU1fQlVHX09OKGk5MTVfaXNfZ2d0dCh2
bSkpOwogCXRyYWNlX2k5MTVfcHBndHRfcmVsZWFzZSh2bSk7CiAKKwlpOTE1X3N2bV91bmJpbmRf
bW0odm0pOwogCXF1ZXVlX3JjdV93b3JrKHZtLT5pOTE1LT53cSwgJnZtLT5yY3UpOwogfQogCkBA
IC02MDgsNiArNjExLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIGludCBzdWJjbGFzcykKIAkgKiBhdHRlbXB0IGhv
bGRpbmcgdGhlIGxvY2sgaXMgaW1tZWRpYXRlbHkgcmVwb3J0ZWQgYnkgbG9ja2RlcC4KIAkgKi8K
IAltdXRleF9pbml0KCZ2bS0+bXV0ZXgpOworCW11dGV4X2luaXQoJnZtLT5zdm1fbXV0ZXgpOwog
CWxvY2tkZXBfc2V0X3N1YmNsYXNzKCZ2bS0+bXV0ZXgsIHN1YmNsYXNzKTsKIAlpOTE1X2dlbV9z
aHJpbmtlcl90YWludHNfbXV0ZXgodm0tPmk5MTUsICZ2bS0+bXV0ZXgpOwogCkBAIC02MTksNiAr
NjIzLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0sIGludCBzdWJjbGFzcykKIAogCUlOSVRfTElTVF9IRUFEKCZ2bS0+
Ym91bmRfbGlzdCk7CiAJSU5JVF9MSVNUX0hFQUQoJnZtLT5zdm1fbGlzdCk7CisJUkNVX0lOSVRf
UE9JTlRFUih2bS0+c3ZtLCBOVUxMKTsKIH0KIAogc3RhdGljIGludCBfX3NldHVwX3BhZ2VfZG1h
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuaAppbmRleCA2YThkNTU0OTBlMzkuLjcyMmIxZTdjZTI5MSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmgKQEAgLTI5Myw2ICsyOTMsOCBAQCBzdHJ1Y3QgaTkxNV9zdm1fb2JqIHsK
IAl1NjQgb2Zmc2V0OwogfTsKIAorc3RydWN0IGk5MTVfc3ZtOworCiBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlIHsKIAlzdHJ1Y3Qga3JlZiByZWY7CiAJc3RydWN0IHJjdV93b3JrIHJjdTsKQEAg
LTM0Miw2ICszNDQsOCBAQCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIHsKIAkgKi8KIAlzdHJ1
Y3QgbGlzdF9oZWFkIHN2bV9saXN0OwogCXVuc2lnbmVkIGludCBzdm1fY291bnQ7CisJc3RydWN0
IGk5MTVfc3ZtICpzdm07CisJc3RydWN0IG11dGV4IHN2bV9tdXRleDsgLyogcHJvdGVjdHMgc3Zt
IGVuYWJsaW5nICovCiAKIAlzdHJ1Y3QgcGFnZXN0YXNoIGZyZWVfcGFnZXM7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3N2bS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNGU0
MTRmMjU3MTIxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9z
dm0uYwpAQCAtMCwwICsxLDI5NiBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAor
LyoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1
ZGUgPGxpbnV4L21tX3R5cGVzLmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQvbW0uaD4KKworI2lu
Y2x1ZGUgImk5MTVfc3ZtLmgiCisjaW5jbHVkZSAiaW50ZWxfbWVtb3J5X3JlZ2lvbi5oIgorI2lu
Y2x1ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCisKK3N0YXRpYyBjb25zdCB1NjQgaTkxNV9y
YW5nZV9mbGFnc1tITU1fUEZOX0ZMQUdfTUFYXSA9IHsKKwlbSE1NX1BGTl9WQUxJRF0gICAgICAg
ICAgPSAoMSA8PCAwKSwgLyogSE1NX1BGTl9WQUxJRCAqLworCVtITU1fUEZOX1dSSVRFXSAgICAg
ICAgICA9ICgxIDw8IDEpLCAvKiBITU1fUEZOX1dSSVRFICovCisJW0hNTV9QRk5fREVWSUNFX1BS
SVZBVEVdID0gKDEgPDwgMikgLyogSE1NX1BGTl9ERVZJQ0VfUFJJVkFURSAqLworfTsKKworc3Rh
dGljIGNvbnN0IHU2NCBpOTE1X3JhbmdlX3ZhbHVlc1tITU1fUEZOX1ZBTFVFX01BWF0gPSB7CisJ
W0hNTV9QRk5fRVJST1JdICAgPSAweGZmZmZmZmZmZmZmZmZmZmVVTCwgLyogSE1NX1BGTl9FUlJP
UiAqLworCVtITU1fUEZOX05PTkVdICAgID0gMCwgLyogSE1NX1BGTl9OT05FICovCisJW0hNTV9Q
Rk5fU1BFQ0lBTF0gPSAweGZmZmZmZmZmZmZmZmZmZmNVTCAvKiBITU1fUEZOX1NQRUNJQUwgKi8K
K307CisKK3N0YXRpYyBpbmxpbmUgYm9vbAoraTkxNV9yYW5nZV9kb25lKHN0cnVjdCBobW1fcmFu
Z2UgKnJhbmdlKQoreworCWJvb2wgcmV0ID0gaG1tX3JhbmdlX3ZhbGlkKHJhbmdlKTsKKworCWht
bV9yYW5nZV91bnJlZ2lzdGVyKHJhbmdlKTsKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50
CitpOTE1X3JhbmdlX2ZhdWx0KHN0cnVjdCBpOTE1X3N2bSAqc3ZtLCBzdHJ1Y3QgaG1tX3Jhbmdl
ICpyYW5nZSkKK3sKKwlsb25nIHJldDsKKworCXJhbmdlLT5kZWZhdWx0X2ZsYWdzID0gMDsKKwly
YW5nZS0+cGZuX2ZsYWdzX21hc2sgPSAtMVVMOworCisJcmV0ID0gaG1tX3JhbmdlX3JlZ2lzdGVy
KHJhbmdlLCAmc3ZtLT5taXJyb3IpOworCWlmIChyZXQpIHsKKwkJdXBfcmVhZCgmc3ZtLT5tbS0+
bW1hcF9zZW0pOworCQlyZXR1cm4gKGludClyZXQ7CisJfQorCisJaWYgKCFobW1fcmFuZ2Vfd2Fp
dF91bnRpbF92YWxpZChyYW5nZSwgSE1NX1JBTkdFX0RFRkFVTFRfVElNRU9VVCkpIHsKKwkJdXBf
cmVhZCgmc3ZtLT5tbS0+bW1hcF9zZW0pOworCQlyZXR1cm4gLUVCVVNZOworCX0KKworCXJldCA9
IGhtbV9yYW5nZV9mYXVsdChyYW5nZSwgMCk7CisJaWYgKHJldCA8PSAwKSB7CisJCWlmIChyZXQg
PT0gMCkKKwkJCXJldCA9IC1FQlVTWTsKKwkJdXBfcmVhZCgmc3ZtLT5tbS0+bW1hcF9zZW0pOwor
CQlobW1fcmFuZ2VfdW5yZWdpc3RlcihyYW5nZSk7CisJCXJldHVybiByZXQ7CisJfQorCXJldHVy
biAwOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfc3ZtICp2bV9nZXRfc3ZtKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCXN0cnVjdCBpOTE1X3N2bSAqc3ZtID0gdm0tPnN2bTsK
KworCW11dGV4X2xvY2soJnZtLT5zdm1fbXV0ZXgpOworCWlmIChzdm0gJiYgIWtyZWZfZ2V0X3Vu
bGVzc196ZXJvKCZzdm0tPnJlZikpCisJCXN2bSA9IE5VTEw7CisKKwltdXRleF91bmxvY2soJnZt
LT5zdm1fbXV0ZXgpOworCXJldHVybiBzdm07Cit9CisKK3N0YXRpYyB2b2lkIHJlbGVhc2Vfc3Zt
KHN0cnVjdCBrcmVmICpyZWYpCit7CisJc3RydWN0IGk5MTVfc3ZtICpzdm0gPSBjb250YWluZXJf
b2YocmVmLCB0eXBlb2YoKnN2bSksIHJlZik7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0gPSBzdm0tPnZtOworCisJaG1tX21pcnJvcl91bnJlZ2lzdGVyKCZzdm0tPm1pcnJvcik7CisJ
bXV0ZXhfZGVzdHJveSgmc3ZtLT5tdXRleCk7CisJdm0tPnN2bSA9IE5VTEw7CisJa2ZyZWUoc3Zt
KTsKK30KKworc3RhdGljIHZvaWQgdm1fcHV0X3N2bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSkKK3sKKwltdXRleF9sb2NrKCZ2bS0+c3ZtX211dGV4KTsKKwlpZiAodm0tPnN2bSkKKwkJ
a3JlZl9wdXQoJnZtLT5zdm0tPnJlZiwgcmVsZWFzZV9zdm0pOworCW11dGV4X3VubG9jaygmdm0t
PnN2bV9tdXRleCk7Cit9CisKK3N0YXRpYyB1MzIgaTkxNV9zdm1fYnVpbGRfc2coc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCisJCQkgICAgIHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLAor
CQkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnN0KQoreworCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7
CisJdTMyIHNnX3BhZ2Vfc2l6ZXMgPSAwOworCXU2NCBpLCBucGFnZXM7CisKKwlzZyA9IE5VTEw7
CisJc3QtPm5lbnRzID0gMDsKKwlucGFnZXMgPSAocmFuZ2UtPmVuZCAtIHJhbmdlLT5zdGFydCkg
LyBQQUdFX1NJWkU7CisKKwkvKgorCSAqIE5vIG5lZWRkIHRvIGRtYSBtYXAgdGhlIGhvc3QgcGFn
ZXMgYW5kIGxhdGVyIHVubWFwIGl0LCBhcworCSAqIEdQVSBpcyBub3QgYWxsb3dlZCB0byBhY2Nl
c3MgaXQgd2l0aCBTVk0uIEhlbmNlLCBubyBuZWVkCisJICogb2YgYW55IGludGVybWVkaWF0ZSBk
YXRhIHN0cnVjdXRyZSB0byBob2xkIHRoZSBtYXBwaW5ncy4KKwkgKi8KKwlmb3IgKGkgPSAwOyBp
IDwgbnBhZ2VzOyBpKyspIHsKKwkJdTY0IGFkZHIgPSByYW5nZS0+cGZuc1tpXSAmIH4oKDFVTCA8
PCByYW5nZS0+cGZuX3NoaWZ0KSAtIDEpOworCisJCWlmIChzZyAmJiAoYWRkciA9PSAoc2dfZG1h
X2FkZHJlc3Moc2cpICsgc2ctPmxlbmd0aCkpKSB7CisJCQlzZy0+bGVuZ3RoICs9IFBBR0VfU0la
RTsKKwkJCXNnX2RtYV9sZW4oc2cpICs9IFBBR0VfU0laRTsKKwkJCWNvbnRpbnVlOworCQl9CisK
KwkJaWYgKHNnKQorCQkJc2dfcGFnZV9zaXplcyB8PSBzZy0+bGVuZ3RoOworCisJCXNnID0gIHNn
ID8gX19zZ19uZXh0KHNnKSA6IHN0LT5zZ2w7CisJCXNnX2RtYV9hZGRyZXNzKHNnKSA9IGFkZHI7
CisJCXNnX2RtYV9sZW4oc2cpID0gUEFHRV9TSVpFOworCQlzZy0+bGVuZ3RoID0gUEFHRV9TSVpF
OworCQlzdC0+bmVudHMrKzsKKwl9CisKKwlzZ19wYWdlX3NpemVzIHw9IHNnLT5sZW5ndGg7CisJ
c2dfbWFya19lbmQoc2cpOworCXJldHVybiBzZ19wYWdlX3NpemVzOworfQorCitzdGF0aWMgdm9p
ZCBpOTE1X3N2bV91bmJpbmRfYWRkcihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKKwkJ
CQkgdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQoreworCXN0cnVjdCBpOTE1X3N2bSAqc3ZtID0gdm0t
PnN2bTsKKworCW11dGV4X2xvY2soJnN2bS0+bXV0ZXgpOworCS8qIEZJWE1FOiBOZWVkIHRvIGZs
dXNoIHRoZSBUTEIgKi8KKwlzdm1fdW5iaW5kX2FkZHIodm0sIHN0YXJ0LCBsZW5ndGgpOworCW11
dGV4X3VubG9jaygmc3ZtLT5tdXRleCk7Cit9CisKK2ludCBpOTE1X3N2bV9iaW5kKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCBzdHJ1Y3QgZHJtX2k5MTVfYmluZCAqYXJncykKK3sKKwlz
dHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYTsKKwlzdHJ1Y3QgaG1tX3JhbmdlIHJhbmdlOworCXN0
cnVjdCBpOTE1X3N2bSAqc3ZtOworCXU2NCBpLCBmbGFncywgbnBhZ2VzOworCXN0cnVjdCBzZ190
YWJsZSBzdDsKKwl1MzIgc2dfcGFnZV9zaXplczsKKwlpbnQgcmV0ID0gMDsKKworCXN2bSA9IHZt
X2dldF9zdm0odm0pOworCWlmICghc3ZtKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWFyZ3MtPmxl
bmd0aCArPSAoYXJncy0+c3RhcnQgJiB+UEFHRV9NQVNLKTsKKwlhcmdzLT5zdGFydCAmPSBQQUdF
X01BU0s7CisJRFJNX0RFQlVHX0RSSVZFUigiJXNpbmcgc3RhcnQgMHglbGx4IGxlbmd0aCAweCVs
bHggdm1faWQgMHgleFxuIiwKKwkJCSAoYXJncy0+ZmxhZ3MgJiBJOTE1X0JJTkRfVU5CSU5EKSA/
ICJVbmJpbmQiIDogIkJpbmQiLAorCQkJIGFyZ3MtPnN0YXJ0LCBhcmdzLT5sZW5ndGgsIGFyZ3Mt
PnZtX2lkKTsKKwlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X0JJTkRfVU5CSU5EKSB7CisJCWk5MTVf
c3ZtX3VuYmluZF9hZGRyKHZtLCBhcmdzLT5zdGFydCwgYXJncy0+bGVuZ3RoKTsKKwkJZ290byBi
aW5kX2RvbmU7CisJfQorCisJbnBhZ2VzID0gYXJncy0+bGVuZ3RoIC8gUEFHRV9TSVpFOworCWlm
ICh1bmxpa2VseShzZ19hbGxvY190YWJsZSgmc3QsIG5wYWdlcywgR0ZQX0tFUk5FTCkpKSB7CisJ
CXJldCA9IC1FTk9NRU07CisJCWdvdG8gYmluZF9kb25lOworCX0KKworCXJhbmdlLnBmbnMgPSBr
dm1hbGxvY19hcnJheShucGFnZXMsIHNpemVvZih1aW50NjRfdCksIEdGUF9LRVJORUwpOworCWlm
ICh1bmxpa2VseSghcmFuZ2UucGZucykpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byByYW5n
ZV9kb25lOworCX0KKworCXJldCA9IHN2bV9iaW5kX2FkZHJfcHJlcGFyZSh2bSwgYXJncy0+c3Rh
cnQsIGFyZ3MtPmxlbmd0aCk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCWdvdG8gcHJlcGFyZV9k
b25lOworCisJcmFuZ2UucGZuX3NoaWZ0ID0gUEFHRV9TSElGVDsKKwlyYW5nZS5zdGFydCA9IGFy
Z3MtPnN0YXJ0OworCXJhbmdlLmZsYWdzID0gaTkxNV9yYW5nZV9mbGFnczsKKwlyYW5nZS52YWx1
ZXMgPSBpOTE1X3JhbmdlX3ZhbHVlczsKKwlyYW5nZS5lbmQgPSByYW5nZS5zdGFydCArIGFyZ3Mt
Pmxlbmd0aDsKKwlmb3IgKGkgPSAwOyBpIDwgbnBhZ2VzOyArK2kpIHsKKwkJcmFuZ2UucGZuc1tp
XSA9IHJhbmdlLmZsYWdzW0hNTV9QRk5fVkFMSURdOworCQlpZiAoIShhcmdzLT5mbGFncyAmIEk5
MTVfQklORF9SRUFET05MWSkpCisJCQlyYW5nZS5wZm5zW2ldIHw9IHJhbmdlLmZsYWdzW0hNTV9Q
Rk5fV1JJVEVdOworCX0KKworCWRvd25fcmVhZCgmc3ZtLT5tbS0+bW1hcF9zZW0pOworCXZtYSA9
IGZpbmRfdm1hKHN2bS0+bW0sIHJhbmdlLnN0YXJ0KTsKKwlpZiAodW5saWtlbHkoIXZtYSB8fCB2
bWEtPnZtX2VuZCA8IHJhbmdlLmVuZCkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byB2bWFf
ZG9uZTsKKwl9CithZ2FpbjoKKwlyZXQgPSBpOTE1X3JhbmdlX2ZhdWx0KHN2bSwgJnJhbmdlKTsK
KwlpZiAodW5saWtlbHkocmV0KSkKKwkJZ290byB2bWFfZG9uZTsKKworCXNnX3BhZ2Vfc2l6ZXMg
PSBpOTE1X3N2bV9idWlsZF9zZyh2bSwgJnJhbmdlLCAmc3QpOworCisJbXV0ZXhfbG9jaygmc3Zt
LT5tdXRleCk7CisJaWYgKCFpOTE1X3JhbmdlX2RvbmUoJnJhbmdlKSkgeworCQltdXRleF91bmxv
Y2soJnN2bS0+bXV0ZXgpOworCQlnb3RvIGFnYWluOworCX0KKworCWZsYWdzID0gKGFyZ3MtPmZs
YWdzICYgSTkxNV9CSU5EX1JFQURPTkxZKSA/IEk5MTVfR1RUX1NWTV9SRUFET05MWSA6IDA7CisJ
cmV0ID0gc3ZtX2JpbmRfYWRkcl9jb21taXQodm0sIGFyZ3MtPnN0YXJ0LCBhcmdzLT5sZW5ndGgs
CisJCQkJICAgZmxhZ3MsICZzdCwgc2dfcGFnZV9zaXplcyk7CisJbXV0ZXhfdW5sb2NrKCZzdm0t
Pm11dGV4KTsKK3ZtYV9kb25lOgorCXVwX3JlYWQoJnN2bS0+bW0tPm1tYXBfc2VtKTsKKwlpZiAo
dW5saWtlbHkocmV0KSkKKwkJaTkxNV9zdm1fdW5iaW5kX2FkZHIodm0sIGFyZ3MtPnN0YXJ0LCBh
cmdzLT5sZW5ndGgpOworcHJlcGFyZV9kb25lOgorCWt2ZnJlZShyYW5nZS5wZm5zKTsKK3Jhbmdl
X2RvbmU6CisJc2dfZnJlZV90YWJsZSgmc3QpOworYmluZF9kb25lOgorCXZtX3B1dF9zdm0odm0p
OworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQKK2k5MTVfc3luY19jcHVfZGV2aWNlX3Bh
Z2V0YWJsZXMoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwKKwkJCQljb25zdCBzdHJ1Y3QgbW11
X25vdGlmaWVyX3JhbmdlICp1cGRhdGUpCit7CisJc3RydWN0IGk5MTVfc3ZtICpzdm0gPSBjb250
YWluZXJfb2YobWlycm9yLCB0eXBlb2YoKnN2bSksIG1pcnJvcik7CisJdW5zaWduZWQgbG9uZyBs
ZW5ndGggPSB1cGRhdGUtPmVuZCAtIHVwZGF0ZS0+c3RhcnQ7CisKKwlEUk1fREVCVUdfRFJJVkVS
KCJzdGFydCAweCVseCBsZW5ndGggMHglbHhcbiIsIHVwZGF0ZS0+c3RhcnQsIGxlbmd0aCk7CisJ
aWYgKCFtbXVfbm90aWZpZXJfcmFuZ2VfYmxvY2thYmxlKHVwZGF0ZSkpCisJCXJldHVybiAtRUFH
QUlOOworCisJaTkxNV9zdm1fdW5iaW5kX2FkZHIoc3ZtLT52bSwgdXBkYXRlLT5zdGFydCwgbGVu
Z3RoKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgaTkxNV9taXJyb3JfcmVsZWFzZShz
dHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yKQoreworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGht
bV9taXJyb3Jfb3BzIGk5MTVfbWlycm9yX29wcyA9IHsKKwkuc3luY19jcHVfZGV2aWNlX3BhZ2V0
YWJsZXMgPSAmaTkxNV9zeW5jX2NwdV9kZXZpY2VfcGFnZXRhYmxlcywKKwkucmVsZWFzZSA9ICZp
OTE1X21pcnJvcl9yZWxlYXNlLAorfTsKKwordm9pZCBpOTE1X3N2bV91bmJpbmRfbW0oc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJdm1fcHV0X3N2bSh2bSk7Cit9CisKK2ludCBp
OTE1X3N2bV9iaW5kX21tKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCXN0cnVj
dCBpOTE1X3N2bSAqc3ZtOworCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tOworCWludCByZXQgPSAwOwor
CisJbW0gPSBnZXRfdGFza19tbShjdXJyZW50KTsKKwlkb3duX3dyaXRlKCZtbS0+bW1hcF9zZW0p
OworCW11dGV4X2xvY2soJnZtLT5zdm1fbXV0ZXgpOworCWlmICh2bS0+c3ZtKQorCQlnb3RvIGJp
bmRfb3V0OworCisJc3ZtID0ga3phbGxvYyhzaXplb2YoKnN2bSksIEdGUF9LRVJORUwpOworCWlm
ICghc3ZtKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gYmluZF9vdXQ7CisJfQorCXN2bS0+
bWlycm9yLm9wcyA9ICZpOTE1X21pcnJvcl9vcHM7CisJbXV0ZXhfaW5pdCgmc3ZtLT5tdXRleCk7
CisJa3JlZl9pbml0KCZzdm0tPnJlZik7CisJc3ZtLT5tbSA9IG1tOworCXN2bS0+dm0gPSB2bTsK
KworCXJldCA9IGhtbV9taXJyb3JfcmVnaXN0ZXIoJnN2bS0+bWlycm9yLCBtbSk7CisJaWYgKHJl
dCkKKwkJZ290byBiaW5kX291dDsKKworCXZtLT5zdm0gPSBzdm07CitiaW5kX291dDoKKwltdXRl
eF91bmxvY2soJnZtLT5zdm1fbXV0ZXgpOworCXVwX3dyaXRlKCZtbS0+bW1hcF9zZW0pOworCW1t
cHV0KG1tKTsKKwlyZXR1cm4gcmV0OworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9zdm0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtLmgKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5mMTc2ZjFkYzQ5M2YKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N2bS5oCkBAIC0wLDAgKzEsNTAgQEAK
Ky8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkg
MjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgX19JOTE1X1NWTV9ICisjZGVm
aW5lIF9fSTkxNV9TVk1fSAorCisjaW5jbHVkZSA8bGludXgvaG1tLmg+CisKKyNpbmNsdWRlICJp
OTE1X2Rydi5oIgorCisjaWYgZGVmaW5lZChDT05GSUdfRFJNX0k5MTVfU1ZNKQorc3RydWN0IGk5
MTVfc3ZtIHsKKwkvKiBpOTE1IGFkZHJlc3Mgc3BhY2UgKi8KKwlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bTsKKworCS8qIEFzc29jaWF0ZWQgcHJvY2VzcyBtbSAqLworCXN0cnVjdCBtbV9z
dHJ1Y3QgKm1tOworCisJLyogaG1tX21pcnJvciB0byB0cmFjayBtZW1vcnkgaW52YWxpZGF0aW9u
cyBmb3IgYSBwcm9jZXNzICovCisJc3RydWN0IGhtbV9taXJyb3IgbWlycm9yOworCisJc3RydWN0
IG11dGV4IG11dGV4OyAvKiBwcm90ZWN0cyBzdm0gb3BlcmF0aW9ucyAqLworCXN0cnVjdCBrcmVm
IHJlZjsKK307CisKK2ludCBpOTE1X3N2bV9iaW5kKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLCBzdHJ1Y3QgZHJtX2k5MTVfYmluZCAqYXJncyk7Cit2b2lkIGk5MTVfc3ZtX3VuYmluZF9t
bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSk7CitpbnQgaTkxNV9zdm1fYmluZF9tbShz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSk7CitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV92
bV9pc19zdm1fZW5hYmxlZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlyZXR1
cm4gdm0tPnN2bTsKK30KKworI2Vsc2UKKworc3RydWN0IGk5MTVfc3ZtIHsgfTsKK3N0YXRpYyBp
bmxpbmUgaW50IGk5MTVfc3ZtX2JpbmQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCisJ
CQkJc3RydWN0IGRybV9pOTE1X2JpbmQgKmFyZ3MpCit7IHJldHVybiAtRU5PVFNVUFA7IH0KK3N0
YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3N2bV91bmJpbmRfbW0oc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0pIHsgfQorc3RhdGljIGlubGluZSBpbnQgaTkxNV9zdm1fYmluZF9tbShzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sgcmV0dXJuIC1FTk9UU1VQUDsgfQorc3RhdGljIGlu
bGluZSBib29sIGk5MTVfdm1faXNfc3ZtX2VuYWJsZWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0pCit7IHJldHVybiBmYWxzZTsgfQorCisjZW5kaWYKKworI2VuZGlmIC8qIF9fSTkxNV9T
Vk1fSCAqLwotLSAKMi4yMS4wLnJjMC4zMi5nMjQzYTRjN2UyNwoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
