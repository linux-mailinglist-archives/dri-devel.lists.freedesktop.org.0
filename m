Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B591CA1187
	for <lists+dri-devel@lfdr.de>; Thu, 29 Aug 2019 08:06:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 87CAC6E030;
	Thu, 29 Aug 2019 06:06:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM04-CO1-obe.outbound.protection.outlook.com
 (mail-co1nam04on0615.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:fe4d::615])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7CFA589FD3;
 Thu, 29 Aug 2019 06:06:02 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=GcJrligq6rLBD9DhQb607bxS8BZ+WpVnfcu/aSsV/8JSlnd65l+wWwqhC5hHDxnHAFMfAhwBwa+8qyY/6yCIdzIrRd90bvFPDaESe7ycAITDjfBFi0Nr+xNYFRYwOmgABGS3i35/An/uV9WPLEokwiuL9qjz9pXaI72PDPWwGaGqiZ8pFku+s9DYXRhpo3Q35XQmvgZjuNBgZlsK79pg1tulPkNWmMBFv+e2GwZNPax3HiVmWMo3XKC/KIbJF4Nn16JYqHNmfJIlyjiZvKsiR1xORcmwf1PHoGR5XKxDF9mILBr/e64X1ie6krCZhvC0Jynm7OEJckNgQ/4326h0ew==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=IO2xv2gzU6vk63jLoZO3k7qrATQypyFZjz78wXseTdE=;
 b=KwB//Y+MSz3TDttwTca87m7OVSlsBcXYVHa1xERo8ipW7rBZss8WEHPHvB1EfjIrLbUVD8KCoMx1x/W5Xqcw0gMp49SAVh6Ekeiwh4yfDaSyYTYxBhchG98eJT0EzxKyP/HqlmMVaJehJK2cdPCuNm4vd1NknRCKptiNp8ZbmZ7S1gQUajrEgN72c71Tzq2UpazigA9QUUDzzP+6NmVmP35A6heheFIyJQi9TeTYkKIXszsiEI07doCAmZm0ckRk6WwxgZgNJU91I+6Rtvip1uOjOQ+PHRZtZWLw+mrnD4GT1tj1xiOvNTDazSpuyBCUGLiWw0BRc0WFQQkZrBrIOw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=none (sender ip is
 165.204.84.17) smtp.rcpttodomain=cray.com smtp.mailfrom=amd.com;
 dmarc=permerror action=none header.from=amd.com; dkim=none (message not
 signed); arc=none
Received: from CH2PR12CA0011.namprd12.prod.outlook.com (2603:10b6:610:57::21)
 by BYAPR12MB2712.namprd12.prod.outlook.com (2603:10b6:a03:68::13)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2199.21; Thu, 29 Aug
 2019 06:06:00 +0000
Received: from CO1NAM03FT045.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e48::208) by CH2PR12CA0011.outlook.office365.com
 (2603:10b6:610:57::21) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2220.18 via Frontend
 Transport; Thu, 29 Aug 2019 06:05:59 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV01.amd.com (165.204.84.17) by
 CO1NAM03FT045.mail.protection.outlook.com (10.152.81.214) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2220.16 via Frontend Transport; Thu, 29 Aug 2019 06:05:59 +0000
Received: from kho-5039A.amd.com (10.180.168.240) by SATLEXCHOV01.amd.com
 (10.181.40.71) with Microsoft SMTP Server id 14.3.389.1; Thu, 29 Aug 2019
 01:05:51 -0500
From: Kenny Ho <Kenny.Ho@amd.com>
To: <y2kenny@gmail.com>, <cgroups@vger.kernel.org>,
 <dri-devel@lists.freedesktop.org>, <amd-gfx@lists.freedesktop.org>,
 <tj@kernel.org>, <alexander.deucher@amd.com>, <christian.koenig@amd.com>,
 <felix.kuehling@amd.com>, <joseph.greathouse@amd.com>, <jsparks@cray.com>,
 <lkaplan@cray.com>, <daniel@ffwll.ch>
Subject: [PATCH RFC v4 13/16] drm, cgroup: Allow more aggressive memory reclaim
Date: Thu, 29 Aug 2019 02:05:30 -0400
Message-ID: <20190829060533.32315-14-Kenny.Ho@amd.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190829060533.32315-1-Kenny.Ho@amd.com>
References: <20190829060533.32315-1-Kenny.Ho@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(376002)(136003)(396003)(346002)(39860400002)(2980300002)(428003)(189003)(199004)(126002)(2906002)(476003)(446003)(11346002)(2616005)(486006)(478600001)(305945005)(426003)(50466002)(336012)(8936002)(48376002)(70206006)(2870700001)(50226002)(81166006)(81156014)(186003)(26005)(8676002)(14444005)(53936002)(70586007)(2201001)(316002)(110136005)(4326008)(1076003)(86362001)(47776003)(76176011)(5660300002)(7696005)(51416003)(6666004)(356004)(53416004)(36756003)(921003)(1121003)(83996005)(2101003);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BYAPR12MB2712; H:SATLEXCHOV01.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; MX:1; A:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 95fa5cc6-0246-4803-3b6c-08d72c46f6ca
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600166)(711020)(4605104)(1401327)(4618075)(2017052603328);
 SRVR:BYAPR12MB2712; 
X-MS-TrafficTypeDiagnostic: BYAPR12MB2712:
X-Microsoft-Antispam-PRVS: <BYAPR12MB2712B6D6D7894FCA0BB9049883A20@BYAPR12MB2712.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:4941;
X-Forefront-PRVS: 0144B30E41
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: /WRCUPaJn2Euda3fBQ5PWoBQHYjdmfZilm2hwrout1B6ENedVwUZpKNt5PkY/30ZecbD+jJ+qFf/pmll9OfH/UfCAcW4K5psWizKs91tX+Hrn55iWa8ROoyqcMS8aqlw2nH+XizWpkVgfizwZ8HZ3CoxDZXxvlzl7z97sJeAbdzJcnHBkcKsxGlBotWSwxyfrvX4o3r3IceJHHCY3QvvMt5h0ZKW7Au5Qq1ltVN7awyqNB/HwNI+uAFmJaGPX9XYtCWNWINPK0nEcYWXARFTx/ahmH5aIxCXs6ZGm23GtfWbCHKwg1gJBmAUQLN/JjwSrRHZzKOrSQ/JvvifpR+Hf4tY37b/aGIV7ReOLpIjOgdprQEHhq9OszSSlvkkaYzq4M29rikBh+pD0C6s4XMNSkJf7vG5+ernlLvJOOIZm1w=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 29 Aug 2019 06:05:59.1572 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 95fa5cc6-0246-4803-3b6c-08d72c46f6ca
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV01.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BYAPR12MB2712
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector2-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=IO2xv2gzU6vk63jLoZO3k7qrATQypyFZjz78wXseTdE=;
 b=Ns2AhLarkMuARJWOnQKmvok/CxPEYyqYr078vD7aoK0qCyVG0N00VKwxkaYAYgkxhO8/Huu1/R1hROC4fKZYWLGJ3+IuZ1UckC4lb1jXDKyO24y5HIX/PORk6WYYWAd1bBd8X9MPTJlOsv/CRc7aDNkfTGOQfjBhPGisXii6New=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; cray.com; dkim=none (message not signed)
 header.d=none;cray.com; dmarc=permerror action=none header.from=amd.com;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Kenny Ho <Kenny.Ho@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWxsb3cgRFJNIFRUTSBtZW1vcnkgbWFuYWdlciB0byByZWdpc3RlciBhIHdvcmtfc3RydWN0LCBz
dWNoIHRoYXQsIHdoZW4KYSBkcm1jZ3JwIGlzIHVuZGVyIG1lbW9yeSBwcmVzc3VyZSwgbWVtb3J5
IHJlY2xhaW1pbmcgY2FuIGJlIHRyaWdnZXJlZAppbW1lZGlhdGVseS4KCkNoYW5nZS1JZDogSTI1
YWMwNGUyZGI5YzE5ZmYxMjY1MmI4OGViZmYxOGI0NGIyNzA2ZDgKU2lnbmVkLW9mZi1ieTogS2Vu
bnkgSG8gPEtlbm55LkhvQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8u
YyAgICB8IDQ5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogaW5jbHVkZS9kcm0v
ZHJtX2Nncm91cC5oICAgICAgICB8IDE2ICsrKysrKysrKysrCiBpbmNsdWRlL2RybS90dG0vdHRt
X2JvX2RyaXZlci5oIHwgIDIgKysKIGtlcm5lbC9jZ3JvdXAvZHJtLmMgICAgICAgICAgICAgfCAz
MCArKysrKysrKysrKysrKysrKysrKwogNCBmaWxlcyBjaGFuZ2VkLCA5NyBpbnNlcnRpb25zKCsp
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyBiL2RyaXZlcnMvZ3B1
L2RybS90dG0vdHRtX2JvLmMKaW5kZXggZDdlM2QzMTI4ZWJiLi43MmVmYWU2OTRiN2UgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fYm8uYwpAQCAtMTU5MCw2ICsxNTkwLDQ2IEBAIGludCB0dG1fYm9fZXZpY3RfbW0o
c3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHVuc2lnbmVkIG1lbV90eXBlKQogfQogRVhQT1JU
X1NZTUJPTCh0dG1fYm9fZXZpY3RfbW0pOwogCitzdGF0aWMgdm9pZCB0dG1fYm9fcmVjbGFpbV93
cShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
IGN0eCA9IHsKKwkJLmludGVycnVwdGlibGUgPSBmYWxzZSwKKwkJLm5vX3dhaXRfZ3B1ID0gZmFs
c2UsCisJCS5mbGFncyA9IFRUTV9PUFRfRkxBR19GT1JDRV9BTExPQworCX07CisJc3RydWN0IHR0
bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPQorCSAgICBjb250YWluZXJfb2Yod29yaywgc3RydWN0
IHR0bV9tZW1fdHlwZV9tYW5hZ2VyLCByZWNsYWltX3dxKTsKKwlzdHJ1Y3QgdHRtX2JvX2Rldmlj
ZSAqYmRldiA9IG1hbi0+YmRldjsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKwlpbnQgbWVt
X3R5cGU7CisJaW50IHJldDsKKworCWZvciAobWVtX3R5cGUgPSAwOyBtZW1fdHlwZSA8IFRUTV9O
VU1fTUVNX1RZUEVTOyBtZW1fdHlwZSsrKQorCQlpZiAoJmJkZXYtPm1hblttZW1fdHlwZV0gPT0g
bWFuKQorCQkJYnJlYWs7CisKKwlXQVJOX09OKG1lbV90eXBlID49IFRUTV9OVU1fTUVNX1RZUEVT
KTsKKwlpZiAobWVtX3R5cGUgPj0gVFRNX05VTV9NRU1fVFlQRVMpCisJCXJldHVybjsKKworCWlm
ICghZHJtY2dfbWVtX3ByZXNzdXJlX3NjYW4oYmRldiwgbWVtX3R5cGUpKQorCQlyZXR1cm47CisK
KwlyZXQgPSB0dG1fbWVtX2V2aWN0X2ZpcnN0KGJkZXYsIG1lbV90eXBlLCBOVUxMLCAmY3R4LCBO
VUxMKTsKKwlpZiAocmV0KQorCQlyZXR1cm47CisKKwlzcGluX2xvY2soJm1hbi0+bW92ZV9sb2Nr
KTsKKwlmZW5jZSA9IGRtYV9mZW5jZV9nZXQobWFuLT5tb3ZlKTsKKwlzcGluX3VubG9jaygmbWFu
LT5tb3ZlX2xvY2spOworCisJaWYgKGZlbmNlKSB7CisJCXJldCA9IGRtYV9mZW5jZV93YWl0KGZl
bmNlLCBmYWxzZSk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCX0KKworfQorCiBpbnQgdHRt
X2JvX2luaXRfbW0oc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHVuc2lnbmVkIHR5cGUsCiAJ
CQl1bnNpZ25lZCBsb25nIHBfc2l6ZSkKIHsKQEAgLTE2MjQsNiArMTY2NCwxMyBAQCBpbnQgdHRt
X2JvX2luaXRfbW0oc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHVuc2lnbmVkIHR5cGUsCiAJ
CUlOSVRfTElTVF9IRUFEKCZtYW4tPmxydVtpXSk7CiAJbWFuLT5tb3ZlID0gTlVMTDsKIAorCXBy
X2VycigiZHJtY2cgJXAgdHlwZSAlZFxuIiwgYmRldi0+ZGRldiwgdHlwZSk7CisKKwlpZiAodHlw
ZSA8PSBUVE1fUExfVlJBTSkgeworCQlJTklUX1dPUksoJm1hbi0+cmVjbGFpbV93cSwgdHRtX2Jv
X3JlY2xhaW1fd3EpOworCQlkcm1jZ19yZWdpc3Rlcl9kZXZpY2VfbW0oYmRldi0+ZGRldiwgdHlw
ZSwgJm1hbi0+cmVjbGFpbV93cSk7CisJfQorCiAJcmV0dXJuIDA7CiB9CiBFWFBPUlRfU1lNQk9M
KHR0bV9ib19pbml0X21tKTsKQEAgLTE3MDEsNiArMTc0OCw4IEBAIGludCB0dG1fYm9fZGV2aWNl
X3JlbGVhc2Uoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYpCiAJCW1hbiA9ICZiZGV2LT5tYW5b
aV07CiAJCWlmIChtYW4tPmhhc190eXBlKSB7CiAJCQltYW4tPnVzZV90eXBlID0gZmFsc2U7CisJ
CQlkcm1jZ191bnJlZ2lzdGVyX2RldmljZV9tbShiZGV2LT5kZGV2LCBpKTsKKwkJCWNhbmNlbF93
b3JrX3N5bmMoJm1hbi0+cmVjbGFpbV93cSk7CiAJCQlpZiAoKGkgIT0gVFRNX1BMX1NZU1RFTSkg
JiYgdHRtX2JvX2NsZWFuX21tKGJkZXYsIGkpKSB7CiAJCQkJcmV0ID0gLUVCVVNZOwogCQkJCXBy
X2VycigiRFJNIG1lbW9yeSBtYW5hZ2VyIHR5cGUgJWQgaXMgbm90IGNsZWFuXG4iLApkaWZmIC0t
Z2l0IGEvaW5jbHVkZS9kcm0vZHJtX2Nncm91cC5oIGIvaW5jbHVkZS9kcm0vZHJtX2Nncm91cC5o
CmluZGV4IGMxMWRmMzg4ZmRmMi4uNmQ5NzA3ZTFlYjcyIDEwMDY0NAotLS0gYS9pbmNsdWRlL2Ry
bS9kcm1fY2dyb3VwLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2Nncm91cC5oCkBAIC01LDYgKzUs
NyBAQAogI2RlZmluZSBfX0RSTV9DR1JPVVBfSF9fCiAKICNpbmNsdWRlIDxsaW51eC9jZ3JvdXBf
ZHJtLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90
dG1fYm9fYXBpLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmg+CiAKQEAgLTI1
LDEyICsyNiwxNyBAQCBzdHJ1Y3QgZHJtY2dfcHJvcHMgewogCXM2NAkJCW1lbV9id19hdmdfYnl0
ZXNfcGVyX3VzX2RlZmF1bHQ7CiAKIAlzNjQJCQltZW1faGlnaHNfZGVmYXVsdFtUVE1fUExfUFJJ
VisxXTsKKworCXN0cnVjdCB3b3JrX3N0cnVjdAkqbWVtX3JlY2xhaW1fd3FbVFRNX1BMX1BSSVZd
OwogfTsKIAogI2lmZGVmIENPTkZJR19DR1JPVVBfRFJNCiAKIHZvaWQgZHJtY2dfZGV2aWNlX3Vw
ZGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2aWNlKTsKIHZvaWQgZHJtY2dfZGV2aWNlX2Vhcmx5
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldmljZSk7Cit2b2lkIGRybWNnX3JlZ2lzdGVyX2Rl
dmljZV9tbShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgdHlwZSwKKwkJc3Ry
dWN0IHdvcmtfc3RydWN0ICp3cSk7Cit2b2lkIGRybWNnX3VucmVnaXN0ZXJfZGV2aWNlX21tKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCB0eXBlKTsKIGJvb2wgZHJtY2dfdHJ5
X2NoZ19ib19hbGxvYyhzdHJ1Y3QgZHJtY2cgKmRybWNnLCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCQlzaXplX3Qgc2l6ZSk7CiB2b2lkIGRybWNnX3VuY2hnX2JvX2FsbG9jKHN0cnVjdCBkcm1j
ZyAqZHJtY2csIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCkBAIC01Myw2ICs1OSwxNiBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgZHJtY2dfZGV2aWNlX2Vhcmx5X2luaXQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldmljZSkKIHsKIH0KIAorc3RhdGljIGlubGluZSB2b2lkIGRybWNnX3JlZ2lzdGVyX2Rldmlj
ZV9tbShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQl1bnNpZ25lZCBpbnQgdHlwZSwgc3RydWN0
IHdvcmtfc3RydWN0ICp3cSkKK3sKK30KKworc3RhdGljIGlubGluZSB2b2lkIGRybWNnX3VucmVn
aXN0ZXJfZGV2aWNlX21tKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCXVuc2lnbmVkIGludCB0
eXBlKQoreworfQorCiBzdGF0aWMgaW5saW5lIHZvaWQgZHJtY2dfdHJ5X2NoZ19ib19hbGxvYyhz
dHJ1Y3QgZHJtY2cgKmRybWNnLAogCQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAlzaXplX3Qgc2l6
ZSkKIHsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggYi9pbmNs
dWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCmluZGV4IGUxYTgwNWQ2NWI4My4uNTI5Y2VmOTJi
Y2Y2IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCisrKyBiL2lu
Y2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKQEAgLTIwNSw2ICsyMDUsOCBAQCBzdHJ1Y3Qg
dHRtX21lbV90eXBlX21hbmFnZXIgewogCSAqIFByb3RlY3RlZCBieSBAbW92ZV9sb2NrLgogCSAq
LwogCXN0cnVjdCBkbWFfZmVuY2UgKm1vdmU7CisKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3QgcmVjbGFp
bV93cTsKIH07CiAKIC8qKgpkaWZmIC0tZ2l0IGEva2VybmVsL2Nncm91cC9kcm0uYyBiL2tlcm5l
bC9jZ3JvdXAvZHJtLmMKaW5kZXggMDRmYjlhMzk4NzQwLi4wZWE3ZjA2MTllMjUgMTAwNjQ0Ci0t
LSBhL2tlcm5lbC9jZ3JvdXAvZHJtLmMKKysrIGIva2VybmVsL2Nncm91cC9kcm0uYwpAQCAtODA0
LDYgKzgwNCwyOSBAQCB2b2lkIGRybWNnX2RldmljZV9lYXJseV9pbml0KHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCiB9CiBFWFBPUlRfU1lNQk9MKGRybWNnX2RldmljZV9lYXJseV9pbml0KTsKIAor
dm9pZCBkcm1jZ19yZWdpc3Rlcl9kZXZpY2VfbW0oc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5z
aWduZWQgaW50IHR5cGUsCisJCXN0cnVjdCB3b3JrX3N0cnVjdCAqd3EpCit7CisJaWYgKGRldiA9
PSBOVUxMIHx8IHR5cGUgPj0gVFRNX1BMX1BSSVYpCisJCXJldHVybjsKKworCW11dGV4X2xvY2so
JmRybWNnX211dGV4KTsKKwlkZXYtPmRybWNnX3Byb3BzLm1lbV9yZWNsYWltX3dxW3R5cGVdID0g
d3E7CisJbXV0ZXhfdW5sb2NrKCZkcm1jZ19tdXRleCk7Cit9CitFWFBPUlRfU1lNQk9MKGRybWNn
X3JlZ2lzdGVyX2RldmljZV9tbSk7CisKK3ZvaWQgZHJtY2dfdW5yZWdpc3Rlcl9kZXZpY2VfbW0o
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHR5cGUpCit7CisJaWYgKGRldiA9
PSBOVUxMIHx8IHR5cGUgPj0gVFRNX1BMX1BSSVYpCisJCXJldHVybjsKKworCW11dGV4X2xvY2so
JmRybWNnX211dGV4KTsKKwlkZXYtPmRybWNnX3Byb3BzLm1lbV9yZWNsYWltX3dxW3R5cGVdID0g
TlVMTDsKKwltdXRleF91bmxvY2soJmRybWNnX211dGV4KTsKK30KK0VYUE9SVF9TWU1CT0woZHJt
Y2dfdW5yZWdpc3Rlcl9kZXZpY2VfbW0pOworCiAvKioKICAqIGRybWNnX3RyeV9jaGdfYm9fYWxs
b2MgLSBjaGFyZ2UgR0VNIGJ1ZmZlciB1c2FnZSBmb3IgYSBkZXZpY2UgYW5kIGNncm91cAogICog
QGRybWNnOiB0aGUgRFJNIGNncm91cCB0byBiZSBjaGFyZ2VkIHRvCkBAIC0xMDEzLDYgKzEwMzYs
MTMgQEAgdm9pZCBkcm1jZ19tZW1fdHJhY2tfbW92ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
Km9sZF9ibywgYm9vbCBldmljdCwKIAogCQlkZHItPm1lbV9id19zdGF0c1tEUk1DR19NRU1fQldf
QVRUUl9CWVRFX0NSRURJVF0KIAkJCS09IG1vdmVfaW5fYnl0ZXM7CisKKwkJaWYgKGRldi0+ZHJt
Y2dfcHJvcHMubWVtX3JlY2xhaW1fd3FbbmV3X21lbV90eXBlXQorCQkJIT0gTlVMTCAmJgorCQkJ
ZGRyLT5tZW1fc3RhdHNbbmV3X21lbV90eXBlXSA+CisJCQkJZGRyLT5tZW1faGlnaHNbbmV3X21l
bV90eXBlXSkKKwkJCXNjaGVkdWxlX3dvcmsoZGV2LT4KKwkJCQlkcm1jZ19wcm9wcy5tZW1fcmVj
bGFpbV93cVtuZXdfbWVtX3R5cGVdKTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZkZXYtPmRybWNnX211
dGV4KTsKIH0KLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
