Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D99188BA2
	for <lists+dri-devel@lfdr.de>; Sat, 10 Aug 2019 15:55:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 692B16E409;
	Sat, 10 Aug 2019 13:55:13 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 649B36ED42
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Aug 2019 10:31:25 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 125E71596;
 Fri,  9 Aug 2019 03:31:25 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id C7F483F575;
 Fri,  9 Aug 2019 03:31:23 -0700 (PDT)
Subject: Re: [PATCH v4 8/9] drm/panfrost: Add support for GPU heap allocations
To: Rob Herring <robh@kernel.org>, dri-devel@lists.freedesktop.org
References: <20190808222200.13176-1-robh@kernel.org>
 <20190808222200.13176-9-robh@kernel.org>
From: Steven Price <steven.price@arm.com>
Message-ID: <0a7ac3e5-99a9-58a8-fc45-f3e21a9002ff@arm.com>
Date: Fri, 9 Aug 2019 11:31:22 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190808222200.13176-9-robh@kernel.org>
Content-Language: en-GB
X-Mailman-Approved-At: Sat, 10 Aug 2019 13:55:11 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>,
 David Airlie <airlied@linux.ie>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Robin Murphy <robin.murphy@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMDgvMDgvMjAxOSAyMzoyMSwgUm9iIEhlcnJpbmcgd3JvdGU6Cj4gVGhlIG1pZGdhcmQvYmlm
cm9zdCBHUFVzIG5lZWQgdG8gYWxsb2NhdGUgR1BVIGhlYXAgbWVtb3J5IHdoaWNoIGlzCj4gYWxs
b2NhdGVkIG9uIEdQVSBwYWdlIGZhdWx0cyBhbmQgbm90IHBpbm5lZCBpbiBtZW1vcnkuIFRoZSB2
ZW5kb3IgZHJpdmVyCj4gY2FsbHMgdGhpcyBmdW5jdGlvbmFsaXR5IEdST1dfT05fR1BGLgo+IAo+
IFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGF0IEJPcyBhbGxvY2F0ZWQgd2l0aCB0aGUK
PiBQQU5GUk9TVF9CT19OT0VYRUMgZmxhZyBhcmUgbmV2ZXIgbW1hcHBlZCBvciBleHBvcnRlZC4g
Qm90aCBvZiB0aG9zZSBtYXkKPiBhY3R1YWxseSB3b3JrLCBidXQgSSdtIHVuc3VyZSBpZiB0aGVy
ZSdzIHNvbWUgaW50ZXJhY3Rpb24gdGhlcmUuIEl0Cj4gd291bGQgY2F1c2UgdGhlIHdob2xlIG9i
amVjdCB0byBiZSBwaW5uZWQgaW4gbWVtb3J5IHdoaWNoIHdvdWxkIGRlZmVhdAo+IHRoZSBwb2lu
dCBvZiB0aGlzLgo+IAo+IE9uIGZhdWx0cywgd2UgbWFwIGluIDJNQiBhdCBhIHRpbWUgaW4gb3Jk
ZXIgdG8gdXRpbGl6ZSBodWdlIHBhZ2VzIChpZgo+IGVuYWJsZWQpLiBDdXJyZW50bHksIG9uY2Ug
d2UndmUgbWFwcGVkIHBhZ2VzIGluLCB0aGV5IGFyZSBvbmx5IHVubWFwcGVkCj4gaWYgdGhlIEJP
IGlzIGZyZWVkLiBPbmNlIHdlIGFkZCBzaHJpbmtlciBzdXBwb3J0LCB3ZSBjYW4gdW5tYXAgcGFn
ZXMKPiB3aXRoIHRoZSBzaHJpbmtlci4KPiAKPiBDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpv
c29AY29sbGFib3JhLmNvbT4KPiBDYzogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25A
Y29sbGFib3JhLmNvbT4KPiBDYzogUm9iaW4gTXVycGh5IDxyb2Jpbi5tdXJwaHlAYXJtLmNvbT4K
PiBDYzogU3RldmVuIFByaWNlIDxzdGV2ZW4ucHJpY2VAYXJtLmNvbT4KPiBBY2tlZC1ieTogQWx5
c3NhIFJvc2VuendlaWcgPGFseXNzYS5yb3Nlbnp3ZWlnQGNvbGxhYm9yYS5jb20+Cj4gU2lnbmVk
LW9mZi1ieTogUm9iIEhlcnJpbmcgPHJvYmhAa2VybmVsLm9yZz4KClJldmlld2VkLWJ5OiBTdGV2
ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0uY29tPgoKQWx0aG91Z2ggYSBjb3VwbGUgb2YgY29t
bWVudHMgYmVsb3cuLi4KCj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9UT0RPICAg
ICAgICAgICB8ICAgMiAtCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYu
YyB8ICAxMSArLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMgfCAg
NDMgKysrKysrKy0KPiAgZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5oIHwg
ICA4ICsrCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYyB8IDEyOSAr
KysrKysrKysrKysrKysrKysrKysrLS0KPiAgaW5jbHVkZS91YXBpL2RybS9wYW5mcm9zdF9kcm0u
aCAgICAgICAgIHwgICAxICsKPiAgNiBmaWxlcyBjaGFuZ2VkLCAxNzcgaW5zZXJ0aW9ucygrKSwg
MTcgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9UT0RPIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L1RPRE8KPiBpbmRleCBkNGM3ZmI3ZTdk
MTMuLmU3NzI3YjI5MjM1NSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
VE9ETwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9UT0RPCj4gQEAgLTEwLDggKzEw
LDYgQEAKPiAgICBUaGUgaGFyZCBwYXJ0IGlzIGhhbmRsaW5nIHdoZW4gbW9yZSBhZGRyZXNzIHNw
YWNlcyBhcmUgbmVlZGVkIHRoYW4gd2hhdAo+ICAgIHRoZSBoL3cgcHJvdmlkZXMuCj4gIAo+IC0t
IFN1cHBvcnQgcGlubmluZyBwYWdlcyBvbiBkZW1hbmQgKEdQVSBwYWdlIGZhdWx0cykuCj4gLQo+
ICAtIFN1cHBvcnQgdXNlcnNwYWNlIGNvbnRyb2xsZWQgR1BVIHZpcnR1YWwgYWRkcmVzc2VzLiBO
ZWVkZWQgZm9yIFZ1bGthbi4gKFRvbWV1KQo+ICAKPiAgLSBDb21wdXRlIGpvYiBzdXBwb3J0LiBT
byBjYWxsZWQgJ2NvbXB1dGUgb25seScgam9icyBuZWVkIHRvIGJlIHBsdW1iZWQgdXAgdG8KPiBk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jIGIvZHJp
dmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4gaW5kZXggZjA3MGYyZGQ5Zjg0
Li45OTRkYmMzN2U0ZDAgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2Rydi5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Ry
di5jCj4gQEAgLTgyLDcgKzgyLDEyIEBAIHN0YXRpYyBpbnQgcGFuZnJvc3RfaW9jdGxfY3JlYXRl
X2JvKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4gIAlzdHJ1Y3QgZHJtX3Bh
bmZyb3N0X2NyZWF0ZV9ibyAqYXJncyA9IGRhdGE7Cj4gIAo+ICAJaWYgKCFhcmdzLT5zaXplIHx8
IGFyZ3MtPnBhZCB8fAo+IC0JICAgIChhcmdzLT5mbGFncyAmIH5QQU5GUk9TVF9CT19OT0VYRUMp
KQo+ICsJICAgIChhcmdzLT5mbGFncyAmIH4oUEFORlJPU1RfQk9fTk9FWEVDIHwgUEFORlJPU1Rf
Qk9fSEVBUCkpKQo+ICsJCXJldHVybiAtRUlOVkFMOwo+ICsKPiArCS8qIEhlYXBzIHNob3VsZCBu
ZXZlciBiZSBleGVjdXRhYmxlICovCj4gKwlpZiAoKGFyZ3MtPmZsYWdzICYgUEFORlJPU1RfQk9f
SEVBUCkgJiYKPiArCSAgICAhKGFyZ3MtPmZsYWdzICYgUEFORlJPU1RfQk9fTk9FWEVDKSkKPiAg
CQlyZXR1cm4gLUVJTlZBTDsKPiAgCj4gIAlibyA9IHBhbmZyb3N0X2dlbV9jcmVhdGVfd2l0aF9o
YW5kbGUoZmlsZSwgZGV2LCBhcmdzLT5zaXplLCBhcmdzLT5mbGFncywKPiBAQCAtMjk3LDYgKzMw
MiwxMCBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X2lvY3RsX21tYXBfYm8oc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKPiAgCQlyZXR1cm4gLUVOT0VOVDsKPiAgCX0KPiAgCj4gKwkv
KiBEb24ndCBhbGxvdyBtbWFwcGluZyBvZiBoZWFwIG9iamVjdHMgYXMgcGFnZXMgYXJlIG5vdCBw
aW5uZWQuICovCj4gKwlpZiAodG9fcGFuZnJvc3RfYm8oZ2VtX29iaiktPmlzX2hlYXApCj4gKwkJ
cmV0dXJuIC1FSU5WQUw7Cj4gKwo+ICAJcmV0ID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQo
Z2VtX29iaik7Cj4gIAlpZiAocmV0ID09IDApCj4gIAkJYXJncy0+b2Zmc2V0ID0gZHJtX3ZtYV9u
b2RlX29mZnNldF9hZGRyKCZnZW1fb2JqLT52bWFfbm9kZSk7Cj4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9nZW0uYwo+IGluZGV4IGYzOTgxMDliOGUwYy4uMzdhM2E2ZWQ0NjE3IDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+IEBAIC0xNiw2ICsx
NiwyMyBAQAo+ICAgKi8KPiAgc3RhdGljIHZvaWQgcGFuZnJvc3RfZ2VtX2ZyZWVfb2JqZWN0KHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQo+ICB7Cj4gKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29i
amVjdCAqYm8gPSB0b19wYW5mcm9zdF9ibyhvYmopOwo+ICsJc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYgPSBvYmotPmRldi0+ZGV2X3ByaXZhdGU7CgpUaGlzIGlzIHdoZXJlIHRoaW5ncyBz
dGFydCBidWlsZGluZyBhZ2FpbiAtIHRoZXNlIG5lZWQgbW92aW5nIHRvIHBhdGNoIDMuCgo+ICsK
PiArCWlmIChiby0+c2d0cykgewo+ICsJCWludCBpOwo+ICsJCWludCBuX3NndCA9IGJvLT5iYXNl
LmJhc2Uuc2l6ZSAvIFNaXzJNOwo+ICsKPiArCQlmb3IgKGkgPSAwOyBpIDwgbl9zZ3Q7IGkrKykg
ewo+ICsJCQlpZiAoYm8tPnNndHNbaV0uc2dsKSB7Cj4gKwkJCQlkbWFfdW5tYXBfc2cocGZkZXYt
PmRldiwgYm8tPnNndHNbaV0uc2dsLAo+ICsJCQkJCSAgICAgYm8tPnNndHNbaV0ubmVudHMsIERN
QV9CSURJUkVDVElPTkFMKTsKPiArCQkJCXNnX2ZyZWVfdGFibGUoJmJvLT5zZ3RzW2ldKTsKPiAr
CQkJfQo+ICsJCX0KPiArCQlrZnJlZShiby0+c2d0cyk7Cj4gKwl9Cj4gKwo+ICAJbXV0ZXhfbG9j
aygmcGZkZXYtPnNocmlua2VyX2xvY2spOwo+ICAJaWYgKCFsaXN0X2VtcHR5KCZiby0+YmFzZS5t
YWR2X2xpc3QpKQo+ICAJCWxpc3RfZGVsKCZiby0+YmFzZS5tYWR2X2xpc3QpOwo+IEBAIC01MCwx
MCArNjcsMTEgQEAgc3RhdGljIGludCBwYW5mcm9zdF9nZW1fb3BlbihzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKm9iaiwgc3RydWN0IGRybV9maWxlICpmaWxlX3AKPiAgCWlmIChyZXQpCj4gIAkJZ290
byBvdXQ7Cj4gIAo+IC0JcmV0ID0gcGFuZnJvc3RfbW11X21hcChibyk7Cj4gLQlpZiAocmV0KQo+
IC0JCWRybV9tbV9yZW1vdmVfbm9kZSgmYm8tPm5vZGUpOwo+IC0KPiArCWlmICghYm8tPmlzX2hl
YXApIHsKPiArCQlyZXQgPSBwYW5mcm9zdF9tbXVfbWFwKGJvKTsKPiArCQlpZiAocmV0KQo+ICsJ
CQlkcm1fbW1fcmVtb3ZlX25vZGUoJmJvLT5ub2RlKTsKPiArCX0KPiAgb3V0Ogo+ICAJc3Bpbl91
bmxvY2soJnBmZGV2LT5tbV9sb2NrKTsKPiAgCXJldHVybiByZXQ7Cj4gQEAgLTczLDEyICs5MSwy
MCBAQCBzdGF0aWMgdm9pZCBwYW5mcm9zdF9nZW1fY2xvc2Uoc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmosIHN0cnVjdCBkcm1fZmlsZSAqZmlsZQo+ICAJc3Bpbl91bmxvY2soJnBmZGV2LT5tbV9s
b2NrKTsKPiAgfQo+ICAKPiArc3RhdGljIGludCBwYW5mcm9zdF9nZW1fcGluKHN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqb2JqKQo+ICt7Cj4gKwlpZiAodG9fcGFuZnJvc3RfYm8ob2JqKS0+aXNfaGVh
cCkKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiArCj4gKwlyZXR1cm4gZHJtX2dlbV9zaG1lbV9waW4o
b2JqKTsKPiArfQo+ICsKPiAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZ2VtX29iamVjdF9mdW5j
cyBwYW5mcm9zdF9nZW1fZnVuY3MgPSB7Cj4gIAkuZnJlZSA9IHBhbmZyb3N0X2dlbV9mcmVlX29i
amVjdCwKPiAgCS5vcGVuID0gcGFuZnJvc3RfZ2VtX29wZW4sCj4gIAkuY2xvc2UgPSBwYW5mcm9z
dF9nZW1fY2xvc2UsCj4gIAkucHJpbnRfaW5mbyA9IGRybV9nZW1fc2htZW1fcHJpbnRfaW5mbywK
PiAtCS5waW4gPSBkcm1fZ2VtX3NobWVtX3BpbiwKPiArCS5waW4gPSBwYW5mcm9zdF9nZW1fcGlu
LAo+ICAJLnVucGluID0gZHJtX2dlbV9zaG1lbV91bnBpbiwKPiAgCS5nZXRfc2dfdGFibGUgPSBk
cm1fZ2VtX3NobWVtX2dldF9zZ190YWJsZSwKPiAgCS52bWFwID0gZHJtX2dlbV9zaG1lbV92bWFw
LAo+IEBAIC0xMTcsMTIgKzE0MywxOSBAQCBwYW5mcm9zdF9nZW1fY3JlYXRlX3dpdGhfaGFuZGxl
KHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAo+ICAJc3RydWN0IGRybV9nZW1fc2htZW1fb2Jq
ZWN0ICpzaG1lbTsKPiAgCXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibzsKPiAgCj4gKwkv
KiBSb3VuZCB1cCBoZWFwIGFsbG9jYXRpb25zIHRvIDJNQiB0byBrZWVwIGZhdWx0IGhhbmRsaW5n
IHNpbXBsZSAqLwo+ICsJaWYgKGZsYWdzICYgUEFORlJPU1RfQk9fSEVBUCkKPiArCQlzaXplID0g
cm91bmR1cChzaXplLCBTWl8yTSk7Cj4gKwllbHNlCj4gKwkJc2l6ZSA9IHJvdW5kdXAoc2l6ZSwg
UEFHRV9TSVpFKTsKCklmIEkgdW5kZXJzdGFuZCBjb3JyZWN0bHkgdGhpcyByb3VuZHVwIHRvIFBB
R0VfU0laRSBpcyBub3cgcmVkdW5kYW50CihhbHRob3VnaCBub3QgaGFybWZ1bCkuCgpTdGV2ZQoK
PiArCj4gIAlzaG1lbSA9IGRybV9nZW1fc2htZW1fY3JlYXRlKGRldiwgc2l6ZSk7Cj4gIAlpZiAo
SVNfRVJSKHNobWVtKSkKPiAgCQlyZXR1cm4gRVJSX0NBU1Qoc2htZW0pOwo+ICAKPiAgCWJvID0g
dG9fcGFuZnJvc3RfYm8oJnNobWVtLT5iYXNlKTsKPiAgCWJvLT5ub2V4ZWMgPSAhIShmbGFncyAm
IFBBTkZST1NUX0JPX05PRVhFQyk7Cj4gKwliby0+aXNfaGVhcCA9ICEhKGZsYWdzICYgUEFORlJP
U1RfQk9fSEVBUCk7Cj4gIAo+ICAJLyoKPiAgCSAqIEFsbG9jYXRlIGFuIGlkIG9mIGlkciB0YWJs
ZSB3aGVyZSB0aGUgb2JqIGlzIHJlZ2lzdGVyZWQKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5oIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2dlbS5oCj4gaW5kZXggZDRjN2FhMTc5MGE3Li5lMTBmNTgzMTY5MTUgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5oCj4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5oCj4gQEAgLTksMTAgKzksMTIgQEAK
PiAgCj4gIHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0IHsKPiAgCXN0cnVjdCBkcm1fZ2VtX3No
bWVtX29iamVjdCBiYXNlOwo+ICsJc3RydWN0IHNnX3RhYmxlICpzZ3RzOwo+ICAKPiAgCXN0cnVj
dCBkcm1fbW1fbm9kZSBub2RlOwo+ICAJYm9vbCBpc19tYXBwZWQJCToxOwo+ICAJYm9vbCBub2V4
ZWMJCToxOwo+ICsJYm9vbCBpc19oZWFwCQk6MTsKPiAgfTsKPiAgCj4gIHN0YXRpYyBpbmxpbmUK
PiBAQCAtMjEsNiArMjMsMTIgQEAgc3RydWN0ICBwYW5mcm9zdF9nZW1fb2JqZWN0ICp0b19wYW5m
cm9zdF9ibyhzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaikKPiAgCXJldHVybiBjb250YWluZXJf
b2YodG9fZHJtX2dlbV9zaG1lbV9vYmoob2JqKSwgc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3Qs
IGJhc2UpOwo+ICB9Cj4gIAo+ICtzdGF0aWMgaW5saW5lCj4gK3N0cnVjdCAgcGFuZnJvc3RfZ2Vt
X29iamVjdCAqZHJtX21tX25vZGVfdG9fcGFuZnJvc3RfYm8oc3RydWN0IGRybV9tbV9ub2RlICpu
b2RlKQo+ICt7Cj4gKwlyZXR1cm4gY29udGFpbmVyX29mKG5vZGUsIHN0cnVjdCBwYW5mcm9zdF9n
ZW1fb2JqZWN0LCBub2RlKTsKPiArfQo+ICsKPiAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpwYW5m
cm9zdF9nZW1fY3JlYXRlX29iamVjdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzaXplX3Qgc2l6
ZSk7Cj4gIAo+ICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvcGFuZnJvc3RfbW11LmMKPiBpbmRleCBiNjA5ZWU1NWE4NzIuLjJlZDQxMWYwOWQ4MCAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiArKysg
Yi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfbW11LmMKPiBAQCAtMiw2ICsyLDcg
QEAKPiAgLyogQ29weXJpZ2h0IDIwMTkgTGluYXJvLCBMdGQsIFJvYiBIZXJyaW5nIDxyb2JoQGtl
cm5lbC5vcmc+ICovCj4gICNpbmNsdWRlIDxsaW51eC9iaXRmaWVsZC5oPgo+ICAjaW5jbHVkZSA8
bGludXgvZGVsYXkuaD4KPiArI2luY2x1ZGUgPGxpbnV4L2RtYS1tYXBwaW5nLmg+Cj4gICNpbmNs
dWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KPiAgI2luY2x1ZGUgPGxpbnV4L2lvLmg+Cj4gICNpbmNs
dWRlIDxsaW51eC9pb3BvbGwuaD4KPiBAQCAtOSw2ICsxMCw3IEBACj4gICNpbmNsdWRlIDxsaW51
eC9pb21tdS5oPgo+ICAjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+Cj4gICNpbmNs
dWRlIDxsaW51eC9wbV9ydW50aW1lLmg+Cj4gKyNpbmNsdWRlIDxsaW51eC9zaG1lbV9mcy5oPgo+
ICAjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4KPiAgCj4gICNpbmNsdWRlICJwYW5mcm9zdF9kZXZp
Y2UuaCIKPiBAQCAtMjQwLDEyICsyNDIsMTIgQEAgdm9pZCBwYW5mcm9zdF9tbXVfdW5tYXAoc3Ry
dWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJvKQo+ICAJCXNpemVfdCB1bm1hcHBlZF9wYWdlOwo+
ICAJCXNpemVfdCBwZ3NpemUgPSBnZXRfcGdzaXplKGlvdmEsIGxlbiAtIHVubWFwcGVkX2xlbik7
Cj4gIAo+IC0JCXVubWFwcGVkX3BhZ2UgPSBvcHMtPnVubWFwKG9wcywgaW92YSwgcGdzaXplKTsK
PiAtCQlpZiAoIXVubWFwcGVkX3BhZ2UpCj4gLQkJCWJyZWFrOwo+IC0KPiAtCQlpb3ZhICs9IHVu
bWFwcGVkX3BhZ2U7Cj4gLQkJdW5tYXBwZWRfbGVuICs9IHVubWFwcGVkX3BhZ2U7Cj4gKwkJaWYg
KG9wcy0+aW92YV90b19waHlzKG9wcywgaW92YSkpIHsKPiArCQkJdW5tYXBwZWRfcGFnZSA9IG9w
cy0+dW5tYXAob3BzLCBpb3ZhLCBwZ3NpemUpOwo+ICsJCQlXQVJOX09OKHVubWFwcGVkX3BhZ2Ug
IT0gcGdzaXplKTsKPiArCQl9Cj4gKwkJaW92YSArPSBwZ3NpemU7Cj4gKwkJdW5tYXBwZWRfbGVu
ICs9IHBnc2l6ZTsKPiAgCX0KPiAgCj4gIAltbXVfaHdfZG9fb3BlcmF0aW9uKHBmZGV2LCAwLCBi
by0+bm9kZS5zdGFydCA8PCBQQUdFX1NISUZULAo+IEBAIC0yODEsNiArMjgzLDEwNSBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGlvbW11X2dhdGhlcl9vcHMgbW11X3RsYl9vcHMgPSB7Cj4gIAkudGxi
X3N5bmMJPSBtbXVfdGxiX3N5bmNfY29udGV4dCwKPiAgfTsKPiAgCj4gK3N0YXRpYyBzdHJ1Y3Qg
ZHJtX21tX25vZGUgKmFkZHJfdG9fZHJtX21tX25vZGUoc3RydWN0IHBhbmZyb3N0X2RldmljZSAq
cGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiArCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9k
ZTsKPiArCXU2NCBvZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7Cj4gKwo+ICsJZHJtX21tX2Zv
cl9lYWNoX25vZGUobm9kZSwgJnBmZGV2LT5tbSkgewo+ICsJCWlmIChvZmZzZXQgPj0gbm9kZS0+
c3RhcnQgJiYgb2Zmc2V0IDwgKG5vZGUtPnN0YXJ0ICsgbm9kZS0+c2l6ZSkpCj4gKwkJCXJldHVy
biBub2RlOwo+ICsJfQo+ICsJcmV0dXJuIE5VTEw7Cj4gK30KPiArCj4gKyNkZWZpbmUgTlVNX0ZB
VUxUX1BBR0VTIChTWl8yTSAvIFBBR0VfU0laRSkKPiArCj4gK2ludCBwYW5mcm9zdF9tbXVfbWFw
X2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFk
ZHIpCj4gK3sKPiArCWludCByZXQsIGk7Cj4gKwlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGU7Cj4g
KwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm87Cj4gKwlzdHJ1Y3QgYWRkcmVzc19zcGFj
ZSAqbWFwcGluZzsKPiArCXBnb2ZmX3QgcGFnZV9vZmZzZXQ7Cj4gKwlzdHJ1Y3Qgc2dfdGFibGUg
KnNndDsKPiArCXN0cnVjdCBwYWdlICoqcGFnZXM7Cj4gKwo+ICsJbm9kZSA9IGFkZHJfdG9fZHJt
X21tX25vZGUocGZkZXYsIGFzLCBhZGRyKTsKPiArCWlmICghbm9kZSkKPiArCQlyZXR1cm4gLUVO
T0VOVDsKPiArCj4gKwlibyA9IGRybV9tbV9ub2RlX3RvX3BhbmZyb3N0X2JvKG5vZGUpOwo+ICsJ
aWYgKCFiby0+aXNfaGVhcCkgewo+ICsJCWRldl9XQVJOKHBmZGV2LT5kZXYsICJtYXRjaGluZyBC
TyBpcyBub3QgaGVhcCB0eXBlIChHUFUgVkEgPSAlbGx4KSIsCj4gKwkJCSBub2RlLT5zdGFydCA8
PCBQQUdFX1NISUZUKTsKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiArCX0KPiArCS8qIEFzc3VtZSAy
TUIgYWxpZ25tZW50IGFuZCBzaXplIG11bHRpcGxlICovCj4gKwlhZGRyICY9IH4oKHU2NClTWl8y
TSAtIDEpOwo+ICsJcGFnZV9vZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7Cj4gKwlwYWdlX29m
ZnNldCAtPSBub2RlLT5zdGFydDsKPiArCj4gKwltdXRleF9sb2NrKCZiby0+YmFzZS5wYWdlc19s
b2NrKTsKPiArCj4gKwlpZiAoIWJvLT5iYXNlLnBhZ2VzKSB7Cj4gKwkJYm8tPnNndHMgPSBrdm1h
bGxvY19hcnJheShiby0+YmFzZS5iYXNlLnNpemUgLyBTWl8yTSwKPiArCQkJCSAgICAgc2l6ZW9m
KHN0cnVjdCBzZ190YWJsZSksIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKPiArCQlpZiAoIWJv
LT5zZ3RzKQo+ICsJCQlyZXR1cm4gLUVOT01FTTsKPiArCj4gKwkJcGFnZXMgPSBrdm1hbGxvY19h
cnJheShiby0+YmFzZS5iYXNlLnNpemUgPj4gUEFHRV9TSElGVCwKPiArCQkJCSAgICAgICBzaXpl
b2Yoc3RydWN0IHBhZ2UgKiksIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKPiArCQlpZiAoIXBh
Z2VzKSB7Cj4gKwkJCWtmcmVlKGJvLT5zZ3RzKTsKPiArCQkJYm8tPnNndHMgPSBOVUxMOwo+ICsJ
CQlyZXR1cm4gLUVOT01FTTsKPiArCQl9Cj4gKwkJYm8tPmJhc2UucGFnZXMgPSBwYWdlczsKPiAr
CQliby0+YmFzZS5wYWdlc191c2VfY291bnQgPSAxOwo+ICsJfSBlbHNlCj4gKwkJcGFnZXMgPSBi
by0+YmFzZS5wYWdlczsKPiArCj4gKwltYXBwaW5nID0gYm8tPmJhc2UuYmFzZS5maWxwLT5mX21h
cHBpbmc7Cj4gKwltYXBwaW5nX3NldF91bmV2aWN0YWJsZShtYXBwaW5nKTsKPiArCj4gKwlmb3Ig
KGkgPSBwYWdlX29mZnNldDsgaSA8IHBhZ2Vfb2Zmc2V0ICsgTlVNX0ZBVUxUX1BBR0VTOyBpKysp
IHsKPiArCQlwYWdlc1tpXSA9IHNobWVtX3JlYWRfbWFwcGluZ19wYWdlKG1hcHBpbmcsIGkpOwo+
ICsJCWlmIChJU19FUlIocGFnZXNbaV0pKSB7Cj4gKwkJCW11dGV4X3VubG9jaygmYm8tPmJhc2Uu
cGFnZXNfbG9jayk7Cj4gKwkJCXJldCA9IFBUUl9FUlIocGFnZXNbaV0pOwo+ICsJCQlnb3RvIGVy
cl9wYWdlczsKPiArCQl9Cj4gKwl9Cj4gKwo+ICsJbXV0ZXhfdW5sb2NrKCZiby0+YmFzZS5wYWdl
c19sb2NrKTsKPiArCj4gKwlzZ3QgPSAmYm8tPnNndHNbcGFnZV9vZmZzZXQgLyAoU1pfMk0gLyBQ
QUdFX1NJWkUpXTsKPiArCXJldCA9IHNnX2FsbG9jX3RhYmxlX2Zyb21fcGFnZXMoc2d0LCBwYWdl
cyArIHBhZ2Vfb2Zmc2V0LAo+ICsJCQkJCU5VTV9GQVVMVF9QQUdFUywgMCwgU1pfMk0sIEdGUF9L
RVJORUwpOwo+ICsJaWYgKHJldCkKPiArCQlnb3RvIGVycl9wYWdlczsKPiArCj4gKwlpZiAoIWRt
YV9tYXBfc2cocGZkZXYtPmRldiwgc2d0LT5zZ2wsIHNndC0+bmVudHMsIERNQV9CSURJUkVDVElP
TkFMKSkgewo+ICsJCXJldCA9IC1FSU5WQUw7Cj4gKwkJZ290byBlcnJfbWFwOwo+ICsJfQo+ICsK
PiArCW1tdV9tYXBfc2cocGZkZXYsIGFkZHIsIElPTU1VX1dSSVRFIHwgSU9NTVVfUkVBRCB8IElP
TU1VX05PRVhFQywgc2d0KTsKPiArCj4gKwliby0+aXNfbWFwcGVkID0gdHJ1ZTsKPiArCj4gKwlk
ZXZfZGJnKHBmZGV2LT5kZXYsICJtYXBwZWQgcGFnZSBmYXVsdCBAICVsbHgiLCBhZGRyKTsKPiAr
Cj4gKwlyZXR1cm4gMDsKPiArCj4gK2Vycl9tYXA6Cj4gKwlzZ19mcmVlX3RhYmxlKHNndCk7Cj4g
K2Vycl9wYWdlczoKPiArCWRybV9nZW1fc2htZW1fcHV0X3BhZ2VzKCZiby0+YmFzZSk7Cj4gKwly
ZXR1cm4gcmV0Owo+ICt9Cj4gKwo+ICBzdGF0aWMgY29uc3QgY2hhciAqYWNjZXNzX3R5cGVfbmFt
ZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwKPiAgCQl1MzIgZmF1bHRfc3RhdHVzKQo+
ICB7Cj4gQEAgLTMxNyw5ICs0MTgsNyBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgcGFuZnJvc3RfbW11
X2lycV9oYW5kbGVyX3RocmVhZChpbnQgaXJxLCB2b2lkICpkYXRhKQo+ICB7Cj4gIAlzdHJ1Y3Qg
cGFuZnJvc3RfZGV2aWNlICpwZmRldiA9IGRhdGE7Cj4gIAl1MzIgc3RhdHVzID0gbW11X3JlYWQo
cGZkZXYsIE1NVV9JTlRfUkFXU1RBVCk7Cj4gLQlpbnQgaTsKPiAtCj4gLQlkZXZfZXJyKHBmZGV2
LT5kZXYsICJtbXUgaXJxIHN0YXR1cz0leFxuIiwgc3RhdHVzKTsKPiArCWludCBpLCByZXQ7Cj4g
IAo+ICAJZm9yIChpID0gMDsgc3RhdHVzOyBpKyspIHsKPiAgCQl1MzIgbWFzayA9IEJJVChpKSB8
IEJJVChpICsgMTYpOwo+IEBAIC0zNDEsNiArNDQwLDE4IEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBw
YW5mcm9zdF9tbXVfaXJxX2hhbmRsZXJfdGhyZWFkKGludCBpcnEsIHZvaWQgKmRhdGEpCj4gIAkJ
YWNjZXNzX3R5cGUgPSAoZmF1bHRfc3RhdHVzID4+IDgpICYgMHgzOwo+ICAJCXNvdXJjZV9pZCA9
IChmYXVsdF9zdGF0dXMgPj4gMTYpOwo+ICAKPiArCQkvKiBQYWdlIGZhdWx0IG9ubHkgKi8KPiAr
CQlpZiAoKHN0YXR1cyAmIG1hc2spID09IEJJVChpKSkgewo+ICsJCQlXQVJOX09OKGV4Y2VwdGlv
bl90eXBlIDwgMHhDMSB8fCBleGNlcHRpb25fdHlwZSA+IDB4QzQpOwo+ICsKPiArCQkJcmV0ID0g
cGFuZnJvc3RfbW11X21hcF9mYXVsdF9hZGRyKHBmZGV2LCBpLCBhZGRyKTsKPiArCQkJaWYgKCFy
ZXQpIHsKPiArCQkJCW1tdV93cml0ZShwZmRldiwgTU1VX0lOVF9DTEVBUiwgQklUKGkpKTsKPiAr
CQkJCXN0YXR1cyAmPSB+bWFzazsKPiArCQkJCWNvbnRpbnVlOwo+ICsJCQl9Cj4gKwkJfQo+ICsK
PiAgCQkvKiB0ZXJtaW5hbCBmYXVsdCwgcHJpbnQgaW5mbyBhYm91dCB0aGUgZmF1bHQgKi8KPiAg
CQlkZXZfZXJyKHBmZGV2LT5kZXYsCj4gIAkJCSJVbmhhbmRsZWQgUGFnZSBmYXVsdCBpbiBBUyVk
IGF0IFZBIDB4JTAxNmxsWFxuIgo+IGRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL3BhbmZy
b3N0X2RybS5oIGIvaW5jbHVkZS91YXBpL2RybS9wYW5mcm9zdF9kcm0uaAo+IGluZGV4IGI4MGMy
MGQxN2RlYy4uZWMxOWRiMWVlYWQ4IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vcGFu
ZnJvc3RfZHJtLmgKPiArKysgYi9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCj4gQEAg
LTg1LDYgKzg1LDcgQEAgc3RydWN0IGRybV9wYW5mcm9zdF93YWl0X2JvIHsKPiAgfTsKPiAgCj4g
ICNkZWZpbmUgUEFORlJPU1RfQk9fTk9FWEVDCTEKPiArI2RlZmluZSBQQU5GUk9TVF9CT19IRUFQ
CTIKPiAgCj4gIC8qKgo+ICAgKiBzdHJ1Y3QgZHJtX3BhbmZyb3N0X2NyZWF0ZV9ibyAtIGlvY3Rs
IGFyZ3VtZW50IGZvciBjcmVhdGluZyBQYW5mcm9zdCBCT3MuCj4gCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
