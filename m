Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EA4E64B489
	for <lists+dri-devel@lfdr.de>; Wed, 19 Jun 2019 11:04:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 801996E332;
	Wed, 19 Jun 2019 09:04:38 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A1C066E326
 for <dri-devel@lists.freedesktop.org>; Wed, 19 Jun 2019 09:04:29 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 38269307D871;
 Wed, 19 Jun 2019 09:04:29 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-86.ams2.redhat.com
 [10.36.116.86])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 496F418C54;
 Wed, 19 Jun 2019 09:04:25 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id E35C117511; Wed, 19 Jun 2019 11:04:21 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 08/12] drm/virtio: rework virtio_gpu_execbuffer_ioctl
 fencing
Date: Wed, 19 Jun 2019 11:04:16 +0200
Message-Id: <20190619090420.6667-9-kraxel@redhat.com>
In-Reply-To: <20190619090420.6667-1-kraxel@redhat.com>
References: <20190619090420.6667-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.48]); Wed, 19 Jun 2019 09:04:29 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 open list <linux-kernel@vger.kernel.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 David Airlie <airlied@linux.ie>, Gerd Hoffmann <kraxel@redhat.com>,
 Sean Paul <sean@poorly.run>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXNlIGdlbSByZXNlcnZhdGlvbiBoZWxwZXJzIGFuZCBkaXJlY3QgcmVzZXJ2YXRpb25fb2JqZWN0
XyogY2FsbHMKaW5zdGVhZCBvZiB0dG0uCgp2MzogQWxzbyBhdHRhY2ggdGhlIGFycmF5IG9mIGdl
bSBvYmplY3RzIHRvIHRoZSB2aXJ0aW8gY29tbWFuZCBidWZmZXIsCnNvIHdlIGNhbiBkcm9wIHRo
ZSBvYmplY3QgcmVmZXJlbmNlcyBpbiB0aGUgY29tcGxldGlvbiBjYWxsYmFjay4gIE5lZWRlZApi
ZWNhdXNlIHR0bSBmZW5jZSBoZWxwZXJzIGdyYWIgYSByZWZlcmVuY2UgZm9yIHVzLCBidXQgZ2Vt
IGhlbHBlcnMKZG9uJ3QuCgpTaWduZWQtb2ZmLWJ5OiBHZXJkIEhvZmZtYW5uIDxrcmF4ZWxAcmVk
aGF0LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmggICB8ICA2
ICsrLQogZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fYXJyYXlfaGVscGVyLmMgfCAgMiArCiBkcml2
ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYyB8IDYyICsrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYyAgICB8IDE2ICsr
KystLS0KIDQgZmlsZXMgY2hhbmdlZCwgNDMgaW5zZXJ0aW9ucygrKSwgNDMgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oIGIvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCmluZGV4IDc3YWM2OWE4ZTZjYy4uNTcz
MTczYzM1YzQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCkBAIC0zMyw2ICsz
Myw3IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtUC5oPgogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fYXJyYXlfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2Ry
bV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2ZiX2hlbHBlci5oPgpAQCAtMTE1LDkgKzExNiw5IEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X3Zi
dWZmZXIgewogCiAJY2hhciAqcmVzcF9idWY7CiAJaW50IHJlc3Bfc2l6ZTsKLQogCXZpcnRpb19n
cHVfcmVzcF9jYiByZXNwX2NiOwogCisJc3RydWN0IGRybV9nZW1fb2JqZWN0X2FycmF5ICpvYmpz
OwogCXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKIH07CiAKQEAgLTMwMSw3ICszMDIsOCBAQCB2b2lk
IHZpcnRpb19ncHVfY21kX2NvbnRleHRfZGV0YWNoX3Jlc291cmNlKHN0cnVjdCB2aXJ0aW9fZ3B1
X2RldmljZSAqdmdkZXYsCiAJCQkJCSAgICB1aW50MzJfdCByZXNvdXJjZV9pZCk7CiB2b2lkIHZp
cnRpb19ncHVfY21kX3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJ
ICAgdm9pZCAqZGF0YSwgdWludDMyX3QgZGF0YV9zaXplLAotCQkJICAgdWludDMyX3QgY3R4X2lk
LCBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UpOworCQkJICAgdWludDMyX3QgY3R4X2lk
LCBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UsCisJCQkgICBzdHJ1Y3QgZHJtX2dlbV9v
YmplY3RfYXJyYXkgKm9ianMpOwogdm9pZCB2aXJ0aW9fZ3B1X2NtZF90cmFuc2Zlcl9mcm9tX2hv
c3RfM2Qoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKIAkJCQkJICB1aW50MzJfdCBy
ZXNvdXJjZV9pZCwgdWludDMyX3QgY3R4X2lkLAogCQkJCQkgIHVpbnQ2NF90IG9mZnNldCwgdWlu
dDMyX3QgbGV2ZWwsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9hcnJheV9o
ZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX2FycmF5X2hlbHBlci5jCmluZGV4IGQz
NWM3N2M0YTAyZC4uZmRlNmMyZTYzMjUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJt
X2dlbV9hcnJheV9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV9hcnJheV9o
ZWxwZXIuYwpAQCAtNTcsNiArNTcsNyBAQCBkcm1fZ2VtX2FycmF5X2Zyb21faGFuZGxlcyhzdHJ1
Y3QgZHJtX2ZpbGUgKmRybV9maWxlLCB1MzIgKmhhbmRsZXMsIHUzMiBuZW50cykKIAl9CiAJcmV0
dXJuIG9ianM7CiB9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fYXJyYXlfZnJvbV9oYW5kbGVzKTsK
IAogLyoqCiAgKiBkcm1fZ2VtX2FycmF5X3B1dF9mcmVlIC0tIHB1dCBnZW0gb2JqZWN0cyBhbmQg
ZnJlZSBhcnJheS4KQEAgLTc0LDMgKzc1LDQgQEAgdm9pZCBkcm1fZ2VtX2FycmF5X3B1dF9mcmVl
KHN0cnVjdCBkcm1fZ2VtX29iamVjdF9hcnJheSAqb2JqcykKIAl9CiAJZHJtX2dlbV9hcnJheV9m
cmVlKG9ianMpOwogfQorRVhQT1JUX1NZTUJPTChkcm1fZ2VtX2FycmF5X3B1dF9mcmVlKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0bC5jIGIvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKaW5kZXggNWNmZmQyZTU0YzA0Li4yMWVi
ZjVjZGI4YmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0
bC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0bC5jCkBAIC0xMDUs
MTQgKzEwNSwxMSBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfZXhlY2J1ZmZlcl9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCXN0cnVjdCBkcm1fdmlydGdwdV9leGVj
YnVmZmVyICpleGJ1ZiA9IGRhdGE7CiAJc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiA9
IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IHZpcnRpb19ncHVfZnByaXYgKnZmcHJpdiA9IGRy
bV9maWxlLT5kcml2ZXJfcHJpdjsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmo7CiAJc3Ry
dWN0IHZpcnRpb19ncHVfZmVuY2UgKm91dF9mZW5jZTsKLQlzdHJ1Y3QgdmlydGlvX2dwdV9vYmpl
Y3QgKnFvYmo7CiAJaW50IHJldDsKIAl1aW50MzJfdCAqYm9faGFuZGxlcyA9IE5VTEw7CiAJdm9p
ZCBfX3VzZXIgKnVzZXJfYm9faGFuZGxlcyA9IE5VTEw7Ci0Jc3RydWN0IGxpc3RfaGVhZCB2YWxp
ZGF0ZV9saXN0OwotCXN0cnVjdCB0dG1fdmFsaWRhdGVfYnVmZmVyICpidWZsaXN0ID0gTlVMTDsK
KwlzdHJ1Y3QgZHJtX2dlbV9vYmplY3RfYXJyYXkgKmJ1Zmxpc3QgPSBOVUxMOwogCWludCBpOwog
CXN0cnVjdCB3d19hY3F1aXJlX2N0eCB0aWNrZXQ7CiAJc3RydWN0IHN5bmNfZmlsZSAqc3luY19m
aWxlOwpAQCAtMTU1LDE1ICsxNTIsMTAgQEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1X2V4ZWNidWZm
ZXJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJCXJldHVybiBv
dXRfZmVuY2VfZmQ7CiAJfQogCi0JSU5JVF9MSVNUX0hFQUQoJnZhbGlkYXRlX2xpc3QpOwogCWlm
IChleGJ1Zi0+bnVtX2JvX2hhbmRsZXMpIHsKLQogCQlib19oYW5kbGVzID0ga3ZtYWxsb2NfYXJy
YXkoZXhidWYtPm51bV9ib19oYW5kbGVzLAotCQkJCQkgICBzaXplb2YodWludDMyX3QpLCBHRlBf
S0VSTkVMKTsKLQkJYnVmbGlzdCA9IGt2bWFsbG9jX2FycmF5KGV4YnVmLT5udW1fYm9faGFuZGxl
cywKLQkJCQkJICAgc2l6ZW9mKHN0cnVjdCB0dG1fdmFsaWRhdGVfYnVmZmVyKSwKLQkJCQkJICAg
R0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8pOwotCQlpZiAoIWJvX2hhbmRsZXMgfHwgIWJ1Zmxpc3Qp
IHsKKwkJCQkJICAgIHNpemVvZih1aW50MzJfdCksIEdGUF9LRVJORUwpOworCQlpZiAoIWJvX2hh
bmRsZXMpIHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF91bnVzZWRfZmQ7CiAJCX0K
QEAgLTE3NSwyNSArMTY3LDIyIEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV9leGVjYnVmZmVyX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQlnb3RvIG91dF91bnVz
ZWRfZmQ7CiAJCX0KIAotCQlmb3IgKGkgPSAwOyBpIDwgZXhidWYtPm51bV9ib19oYW5kbGVzOyBp
KyspIHsKLQkJCWdvYmogPSBkcm1fZ2VtX29iamVjdF9sb29rdXAoZHJtX2ZpbGUsIGJvX2hhbmRs
ZXNbaV0pOwotCQkJaWYgKCFnb2JqKSB7Ci0JCQkJcmV0ID0gLUVOT0VOVDsKLQkJCQlnb3RvIG91
dF91bnVzZWRfZmQ7Ci0JCQl9Ci0KLQkJCXFvYmogPSBnZW1fdG9fdmlydGlvX2dwdV9vYmooZ29i
aik7Ci0JCQlidWZsaXN0W2ldLmJvID0gJnFvYmotPnRibzsKLQotCQkJbGlzdF9hZGQoJmJ1Zmxp
c3RbaV0uaGVhZCwgJnZhbGlkYXRlX2xpc3QpOworCQlidWZsaXN0ID0gZHJtX2dlbV9hcnJheV9m
cm9tX2hhbmRsZXMoZHJtX2ZpbGUsIGJvX2hhbmRsZXMsCisJCQkJCQkgICAgIGV4YnVmLT5udW1f
Ym9faGFuZGxlcyk7CisJCWlmICghYnVmbGlzdCkgeworCQkJcmV0ID0gLUVOT0VOVDsKKwkJCWdv
dG8gb3V0X3VudXNlZF9mZDsKIAkJfQogCQlrdmZyZWUoYm9faGFuZGxlcyk7CiAJCWJvX2hhbmRs
ZXMgPSBOVUxMOwogCX0KIAotCXJldCA9IHZpcnRpb19ncHVfb2JqZWN0X2xpc3RfdmFsaWRhdGUo
JnRpY2tldCwgJnZhbGlkYXRlX2xpc3QpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7CisJ
aWYgKGJ1Zmxpc3QpIHsKKwkJcmV0ID0gZHJtX2dlbV9sb2NrX3Jlc2VydmF0aW9ucyhidWZsaXN0
LT5vYmpzLCBidWZsaXN0LT5uZW50cywKKwkJCQkJCSZ0aWNrZXQpOworCQlpZiAocmV0KQorCQkJ
Z290byBvdXRfdW51c2VkX2ZkOworCX0KIAogCWJ1ZiA9IG1lbWR1cF91c2VyKHU2NF90b191c2Vy
X3B0cihleGJ1Zi0+Y29tbWFuZCksIGV4YnVmLT5zaXplKTsKIAlpZiAoSVNfRVJSKGJ1ZikpIHsK
QEAgLTIxOSwyNSArMjA4LDI2IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV9leGVjYnVmZmVyX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCWZkX2luc3RhbGwob3V0
X2ZlbmNlX2ZkLCBzeW5jX2ZpbGUtPmZpbGUpOwogCX0KIAorCWlmIChidWZsaXN0KSB7CisJCWZv
ciAoaSA9IDA7IGkgPCBleGJ1Zi0+bnVtX2JvX2hhbmRsZXM7IGkrKykKKwkJCXJlc2VydmF0aW9u
X29iamVjdF9hZGRfZXhjbF9mZW5jZShidWZsaXN0LT5vYmpzW2ldLT5yZXN2LAorCQkJCQkJCSAg
Jm91dF9mZW5jZS0+Zik7CisJCWRybV9nZW1fdW5sb2NrX3Jlc2VydmF0aW9ucyhidWZsaXN0LT5v
YmpzLCBidWZsaXN0LT5uZW50cywKKwkJCQkJICAgICZ0aWNrZXQpOworCX0KKwogCXZpcnRpb19n
cHVfY21kX3N1Ym1pdCh2Z2RldiwgYnVmLCBleGJ1Zi0+c2l6ZSwKLQkJCSAgICAgIHZmcHJpdi0+
Y3R4X2lkLCBvdXRfZmVuY2UpOwotCi0JdHRtX2V1X2ZlbmNlX2J1ZmZlcl9vYmplY3RzKCZ0aWNr
ZXQsICZ2YWxpZGF0ZV9saXN0LCAmb3V0X2ZlbmNlLT5mKTsKLQotCS8qIGZlbmNlIHRoZSBjb21t
YW5kIGJvICovCi0JdmlydGlvX2dwdV91bnJlZl9saXN0KCZ2YWxpZGF0ZV9saXN0KTsKLQlrdmZy
ZWUoYnVmbGlzdCk7CisJCQkgICAgICB2ZnByaXYtPmN0eF9pZCwgb3V0X2ZlbmNlLCBidWZsaXN0
KTsKIAlyZXR1cm4gMDsKIAogb3V0X21lbWR1cDoKIAlrZnJlZShidWYpOwogb3V0X3VucmVzdjoK
LQl0dG1fZXVfYmFja29mZl9yZXNlcnZhdGlvbigmdGlja2V0LCAmdmFsaWRhdGVfbGlzdCk7Ci1v
dXRfZnJlZToKLQl2aXJ0aW9fZ3B1X3VucmVmX2xpc3QoJnZhbGlkYXRlX2xpc3QpOworCWRybV9n
ZW1fdW5sb2NrX3Jlc2VydmF0aW9ucyhidWZsaXN0LT5vYmpzLCBidWZsaXN0LT5uZW50cywgJnRp
Y2tldCk7CiBvdXRfdW51c2VkX2ZkOgogCWt2ZnJlZShib19oYW5kbGVzKTsKLQlrdmZyZWUoYnVm
bGlzdCk7CisJaWYgKGJ1Zmxpc3QpCisJCWRybV9nZW1fYXJyYXlfcHV0X2ZyZWUoYnVmbGlzdCk7
CiAKIAlpZiAob3V0X2ZlbmNlX2ZkID49IDApCiAJCXB1dF91bnVzZWRfZmQob3V0X2ZlbmNlX2Zk
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jIGIvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKaW5kZXggNmMxYTkwNzE3NTM1Li42ZWZl
YTRmY2EwMTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCkBAIC0xOTEsNyArMTkx
LDcgQEAgdm9pZCB2aXJ0aW9fZ3B1X2RlcXVldWVfY3RybF9mdW5jKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKIAl9IHdoaWxlICghdmlydHF1ZXVlX2VuYWJsZV9jYih2Z2Rldi0+Y3RybHEudnEp
KTsKIAlzcGluX3VubG9jaygmdmdkZXYtPmN0cmxxLnFsb2NrKTsKIAotCWxpc3RfZm9yX2VhY2hf
ZW50cnlfc2FmZShlbnRyeSwgdG1wLCAmcmVjbGFpbV9saXN0LCBsaXN0KSB7CisJbGlzdF9mb3Jf
ZWFjaF9lbnRyeShlbnRyeSwgJnJlY2xhaW1fbGlzdCwgbGlzdCkgewogCQlyZXNwID0gKHN0cnVj
dCB2aXJ0aW9fZ3B1X2N0cmxfaGRyICopZW50cnktPnJlc3BfYnVmOwogCiAJCXRyYWNlX3ZpcnRp
b19ncHVfY21kX3Jlc3BvbnNlKHZnZGV2LT5jdHJscS52cSwgcmVzcCk7CkBAIC0yMTgsMTQgKzIx
OCwxOCBAQCB2b2lkIHZpcnRpb19ncHVfZGVxdWV1ZV9jdHJsX2Z1bmMoc3RydWN0IHdvcmtfc3Ry
dWN0ICp3b3JrKQogCQl9CiAJCWlmIChlbnRyeS0+cmVzcF9jYikKIAkJCWVudHJ5LT5yZXNwX2Ni
KHZnZGV2LCBlbnRyeSk7Ci0KLQkJbGlzdF9kZWwoJmVudHJ5LT5saXN0KTsKLQkJZnJlZV92YnVm
KHZnZGV2LCBlbnRyeSk7CiAJfQogCXdha2VfdXAoJnZnZGV2LT5jdHJscS5hY2tfcXVldWUpOwog
CiAJaWYgKGZlbmNlX2lkKQogCQl2aXJ0aW9fZ3B1X2ZlbmNlX2V2ZW50X3Byb2Nlc3ModmdkZXYs
IGZlbmNlX2lkKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShlbnRyeSwgdG1wLCAmcmVj
bGFpbV9saXN0LCBsaXN0KSB7CisJCWlmIChlbnRyeS0+b2JqcykKKwkJCWRybV9nZW1fYXJyYXlf
cHV0X2ZyZWUoZW50cnktPm9ianMpOworCQlsaXN0X2RlbCgmZW50cnktPmxpc3QpOworCQlmcmVl
X3ZidWYodmdkZXYsIGVudHJ5KTsKKwl9CiB9CiAKIHZvaWQgdmlydGlvX2dwdV9kZXF1ZXVlX2N1
cnNvcl9mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKQEAgLTkzOSw3ICs5NDMsOCBAQCB2
b2lkIHZpcnRpb19ncHVfY21kX3RyYW5zZmVyX2Zyb21faG9zdF8zZChzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAogCiB2b2lkIHZpcnRpb19ncHVfY21kX3N1Ym1pdChzdHJ1Y3Qgdmly
dGlvX2dwdV9kZXZpY2UgKnZnZGV2LAogCQkJICAgdm9pZCAqZGF0YSwgdWludDMyX3QgZGF0YV9z
aXplLAotCQkJICAgdWludDMyX3QgY3R4X2lkLCBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVu
Y2UpCisJCQkgICB1aW50MzJfdCBjdHhfaWQsIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5j
ZSwKKwkJCSAgIHN0cnVjdCBkcm1fZ2VtX29iamVjdF9hcnJheSAqb2JqcykKIHsKIAlzdHJ1Y3Qg
dmlydGlvX2dwdV9jbWRfc3VibWl0ICpjbWRfcDsKIAlzdHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVy
ICp2YnVmOwpAQCAtOTQ5LDYgKzk1NCw3IEBAIHZvaWQgdmlydGlvX2dwdV9jbWRfc3VibWl0KHN0
cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAKIAl2YnVmLT5kYXRhX2J1ZiA9IGRhdGE7
CiAJdmJ1Zi0+ZGF0YV9zaXplID0gZGF0YV9zaXplOworCXZidWYtPm9ianMgPSBvYmpzOwogCiAJ
Y21kX3AtPmhkci50eXBlID0gY3B1X3RvX2xlMzIoVklSVElPX0dQVV9DTURfU1VCTUlUXzNEKTsK
IAljbWRfcC0+aGRyLmN0eF9pZCA9IGNwdV90b19sZTMyKGN0eF9pZCk7Ci0tIAoyLjE4LjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
