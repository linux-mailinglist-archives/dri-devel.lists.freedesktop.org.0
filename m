Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 490399F532
	for <lists+dri-devel@lfdr.de>; Tue, 27 Aug 2019 23:39:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 62E3D896AF;
	Tue, 27 Aug 2019 21:39:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x441.google.com (mail-pf1-x441.google.com
 [IPv6:2607:f8b0:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AB485892B5;
 Tue, 27 Aug 2019 21:39:03 +0000 (UTC)
Received: by mail-pf1-x441.google.com with SMTP id 196so233487pfz.8;
 Tue, 27 Aug 2019 14:39:03 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=SQ4jwqBG8EsW432GvBdLsYEJC4NIC/EX2i8l181zzqI=;
 b=C/OKY3SzAgbB8aYs+9VCIhaet2nzmcHpExyVtF4bRn3HWpNIK7k7HqjGcgLGlc46AM
 HGxrBejv3m5YzNDN8lUxxCZc/mcDM+YGmMTSC1fOIWc+fWx3dYiAeRGUR4aQl/N0UZoo
 im9wFqrpvVhTlaiCjzjsV6UCwRdG/uvlOe0wT0VypKzqCf/MMiLu2n+/CKF5MF2MK4Dk
 lns8/aDCLjvH1lmED9w/YESG9E4hH+DzT8G8RtfyAk1xpKdgyGkpAka1tUD8E8tapDFZ
 YmFVv2+JBzY+gshGCPCpxzQi9pR/Z9AjHbhsX2uuder1mki6F0sZM+fDM6ngQ3amDyn7
 GkJQ==
X-Gm-Message-State: APjAAAWD2aaSmfBgAM4ZuQNamNdJhFG0bFCQukpESpp7vmbbXiizME1c
 Pxs9nar7gsJr2cfyB3/8SZktL+WBNm4=
X-Google-Smtp-Source: APXvYqwydFQYfo/fbLncH7Mq5b3qyULdN8E5231knw2rVs31XiwIWzfs7kV8RtBpzhs5KIe9B5hHDA==
X-Received: by 2002:a63:2807:: with SMTP id o7mr501997pgo.131.1566941942817;
 Tue, 27 Aug 2019 14:39:02 -0700 (PDT)
Received: from localhost ([100.118.89.196])
 by smtp.gmail.com with ESMTPSA id h20sm262646pfq.156.2019.08.27.14.39.01
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 27 Aug 2019 14:39:02 -0700 (PDT)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/9] drm/msm/dpu: unwind async commit handling
Date: Tue, 27 Aug 2019 14:33:31 -0700
Message-Id: <20190827213421.21917-2-robdclark@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190827213421.21917-1-robdclark@gmail.com>
References: <20190827213421.21917-1-robdclark@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=SQ4jwqBG8EsW432GvBdLsYEJC4NIC/EX2i8l181zzqI=;
 b=dgzpdEO5dTkMRYWaawNcZ39lE6kArsjkbmqgdDhn51AmtsLQxm83szxiZElja3WrLD
 UoD2q17YWBfHOslpnXDkQ24WlFYLalV90iu5tZGo5cjEHzivXhUO2cQOzDvsjGh7UusI
 coJtoDQvK3D0+nXi1024xg+KXtb1bdYHBKgOmUFKHYFMI5aN7G6epzqvINSGu3bl6A5X
 KBptfOy752t4nUruov9zo8VGEySJCgiHP04GGoNuFY5EeuIbttZMSVDhj5zaNA5s14B+
 Qk+OKI89qTRPQIHsY6Rmt8Nz9JHTNnYHV6TQCUC3QHgoWfzD+aq2rQfA6PYfKIl2UCSm
 nnTw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Rob Clark <robdclark@chromium.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU"
 <freedreno@lists.freedesktop.org>, Fritz Koenig <frkoenig@google.com>,
 David Airlie <airlied@linux.ie>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Abhinav Kumar <abhinavk@codeaurora.org>,
 open list <linux-kernel@vger.kernel.org>, Bruce Wang <bzwang@chromium.org>,
 Alexios Zavras <alexios.zavras@intel.com>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <linux-arm-msm@vger.kernel.org>,
 Sean Paul <sean@poorly.run>, Thomas Gleixner <tglx@linutronix.de>,
 Sravanthi Kollukuduru <skolluku@codeaurora.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKSXQgYXR0ZW1wdGVkIHRv
IGF2b2lkIGZwcyBkcm9wcyBpbiB0aGUgcHJlc2VuY2Ugb2YgY3Vyc29yIHVwZGF0ZXMuICBCdXQK
aXQgaXMgcmFjaW5nLCBhbmQgY2FuIHJlc3VsdCBpbiBodyB1cGRhdGVzIGFmdGVyIGZsdXNoIGJl
Zm9yZSB2YmxhbmssCndoaWNoIGxlYWRzIHRvIHVuZGVycnVucy4KClNpZ25lZC1vZmYtYnk6IFJv
YiBDbGFyayA8cm9iZGNsYXJrQGNocm9taXVtLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvZHB1MS9kcHVfY3J0Yy5jICAgIHwgNDEgKysrKysrKysrKy0tLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfY3J0Yy5oICAgIHwgIDMgKy0KIGRyaXZlcnMv
Z3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9lbmNvZGVyLmMgfCAzOSArKysrKysrLS0tLS0tLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXIuaCB8ICAzICst
CiBkcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMgICAgIHwgIDUgKy0tCiBk
cml2ZXJzL2dwdS9kcm0vbXNtL21zbV9hdG9taWMuYyAgICAgICAgICAgIHwgIDMgKy0KIDYgZmls
ZXMgY2hhbmdlZCwgMzcgaW5zZXJ0aW9ucygrKSwgNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2NydGMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9tc20vZGlzcC9kcHUxL2RwdV9jcnRjLmMKaW5kZXggYTUyNDM5ZTAyOWM5Li5jM2Y3MTU0
MDE3YzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9jcnRj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2NydGMuYwpAQCAtNjEw
LDcgKzYxMCw3IEBAIHN0YXRpYyBpbnQgX2RwdV9jcnRjX3dhaXRfZm9yX2ZyYW1lX2RvbmUoc3Ry
dWN0IGRybV9jcnRjICpjcnRjKQogCXJldHVybiByYzsKIH0KIAotdm9pZCBkcHVfY3J0Y19jb21t
aXRfa2lja29mZihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIGJvb2wgYXN5bmMpCit2b2lkIGRwdV9j
cnRjX2NvbW1pdF9raWNrb2ZmKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgZHJt
X2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0IGRwdV9jcnRjICpkcHVfY3J0YyA9IHRvX2RwdV9j
cnRjKGNydGMpOwpAQCAtNjM2LDM1ICs2MzYsMzIgQEAgdm9pZCBkcHVfY3J0Y19jb21taXRfa2lj
a29mZihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIGJvb2wgYXN5bmMpCiAJCQkJICBjcnRjLT5zdGF0
ZS0+ZW5jb2Rlcl9tYXNrKQogCQlkcHVfZW5jb2Rlcl9wcmVwYXJlX2Zvcl9raWNrb2ZmKGVuY29k
ZXIpOwogCi0JaWYgKCFhc3luYykgewotCQkvKiB3YWl0IGZvciBwcmV2aW91cyBmcmFtZV9ldmVu
dF9kb25lIGNvbXBsZXRpb24gKi8KLQkJRFBVX0FUUkFDRV9CRUdJTigid2FpdF9mb3JfZnJhbWVf
ZG9uZV9ldmVudCIpOwotCQlyZXQgPSBfZHB1X2NydGNfd2FpdF9mb3JfZnJhbWVfZG9uZShjcnRj
KTsKLQkJRFBVX0FUUkFDRV9FTkQoIndhaXRfZm9yX2ZyYW1lX2RvbmVfZXZlbnQiKTsKLQkJaWYg
KHJldCkgewotCQkJRFBVX0VSUk9SKCJjcnRjJWQgd2FpdCBmb3IgZnJhbWUgZG9uZSBmYWlsZWQ7
ZnJhbWVfcGVuZGluZyVkXG4iLAotCQkJCQljcnRjLT5iYXNlLmlkLAotCQkJCQlhdG9taWNfcmVh
ZCgmZHB1X2NydGMtPmZyYW1lX3BlbmRpbmcpKTsKLQkJCWdvdG8gZW5kOwotCQl9CisJLyogd2Fp
dCBmb3IgcHJldmlvdXMgZnJhbWVfZXZlbnRfZG9uZSBjb21wbGV0aW9uICovCisJRFBVX0FUUkFD
RV9CRUdJTigid2FpdF9mb3JfZnJhbWVfZG9uZV9ldmVudCIpOworCXJldCA9IF9kcHVfY3J0Y193
YWl0X2Zvcl9mcmFtZV9kb25lKGNydGMpOworCURQVV9BVFJBQ0VfRU5EKCJ3YWl0X2Zvcl9mcmFt
ZV9kb25lX2V2ZW50Iik7CisJaWYgKHJldCkgeworCQlEUFVfRVJST1IoImNydGMlZCB3YWl0IGZv
ciBmcmFtZSBkb25lIGZhaWxlZDtmcmFtZV9wZW5kaW5nJWRcbiIsCisJCQkJY3J0Yy0+YmFzZS5p
ZCwKKwkJCQlhdG9taWNfcmVhZCgmZHB1X2NydGMtPmZyYW1lX3BlbmRpbmcpKTsKKwkJZ290byBl
bmQ7CisJfQogCi0JCWlmIChhdG9taWNfaW5jX3JldHVybigmZHB1X2NydGMtPmZyYW1lX3BlbmRp
bmcpID09IDEpIHsKLQkJCS8qIGFjcXVpcmUgYmFuZHdpZHRoIGFuZCBvdGhlciByZXNvdXJjZXMg
Ki8KLQkJCURQVV9ERUJVRygiY3J0YyVkIGZpcnN0IGNvbW1pdFxuIiwgY3J0Yy0+YmFzZS5pZCk7
Ci0JCX0gZWxzZQotCQkJRFBVX0RFQlVHKCJjcnRjJWQgY29tbWl0XG4iLCBjcnRjLT5iYXNlLmlk
KTsKKwlpZiAoYXRvbWljX2luY19yZXR1cm4oJmRwdV9jcnRjLT5mcmFtZV9wZW5kaW5nKSA9PSAx
KSB7CisJCS8qIGFjcXVpcmUgYmFuZHdpZHRoIGFuZCBvdGhlciByZXNvdXJjZXMgKi8KKwkJRFBV
X0RFQlVHKCJjcnRjJWQgZmlyc3QgY29tbWl0XG4iLCBjcnRjLT5iYXNlLmlkKTsKKwl9IGVsc2UK
KwkJRFBVX0RFQlVHKCJjcnRjJWQgY29tbWl0XG4iLCBjcnRjLT5iYXNlLmlkKTsKIAotCQlkcHVf
Y3J0Yy0+cGxheV9jb3VudCsrOwotCX0KKwlkcHVfY3J0Yy0+cGxheV9jb3VudCsrOwogCiAJZHB1
X3ZiaWZfY2xlYXJfZXJyb3JzKGRwdV9rbXMpOwogCiAJZHJtX2Zvcl9lYWNoX2VuY29kZXJfbWFz
ayhlbmNvZGVyLCBjcnRjLT5kZXYsIGNydGMtPnN0YXRlLT5lbmNvZGVyX21hc2spCi0JCWRwdV9l
bmNvZGVyX2tpY2tvZmYoZW5jb2RlciwgYXN5bmMpOworCQlkcHVfZW5jb2Rlcl9raWNrb2ZmKGVu
Y29kZXIpOwogCiBlbmQ6Ci0JaWYgKCFhc3luYykKLQkJcmVpbml0X2NvbXBsZXRpb24oJmRwdV9j
cnRjLT5mcmFtZV9kb25lX2NvbXApOworCXJlaW5pdF9jb21wbGV0aW9uKCZkcHVfY3J0Yy0+ZnJh
bWVfZG9uZV9jb21wKTsKIAlEUFVfQVRSQUNFX0VORCgiY3J0Y19jb21taXQiKTsKIH0KIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2NydGMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9jcnRjLmgKaW5kZXggNTE4MWYwNzlhNmExLi4x
MGY3ODQ1OWY2YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2Rw
dV9jcnRjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2NydGMuaApA
QCAtMjM4LDkgKzIzOCw4IEBAIHZvaWQgZHB1X2NydGNfdmJsYW5rX2NhbGxiYWNrKHN0cnVjdCBk
cm1fY3J0YyAqY3J0Yyk7CiAvKioKICAqIGRwdV9jcnRjX2NvbW1pdF9raWNrb2ZmIC0gdHJpZ2dl
ciBraWNrb2ZmIG9mIHRoZSBjb21taXQgZm9yIHRoaXMgY3J0YwogICogQGNydGM6IFBvaW50ZXIg
dG8gZHJtIGNydGMgb2JqZWN0Ci0gKiBAYXN5bmM6IHRydWUgaWYgdGhlIGNvbW1pdCBpcyBhc3lu
Y2hyb25vdXMsIGZhbHNlIG90aGVyd2lzZQogICovCi12b2lkIGRwdV9jcnRjX2NvbW1pdF9raWNr
b2ZmKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgYm9vbCBhc3luYyk7Cit2b2lkIGRwdV9jcnRjX2Nv
bW1pdF9raWNrb2ZmKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiAKIC8qKgogICogZHB1X2NydGNf
Y29tcGxldGVfY29tbWl0IC0gY2FsbGJhY2sgc2lnbmFsbGluZyBjb21wbGV0aW9uIG9mIGN1cnJl
bnQgY29tbWl0CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVf
ZW5jb2Rlci5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXIuYwpp
bmRleCA2MjdjNTc1OTQyMjEuLmFjMmQ1MzRiZjU5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvZHB1MS9kcHVfZW5jb2Rlci5jCkBAIC0xNDIxLDggKzE0MjEsNyBAQCBzdGF0aWMgdm9p
ZCBkcHVfZW5jb2Rlcl9vZmZfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAgKiBleHRy
YV9mbHVzaF9iaXRzOiBBZGRpdGlvbmFsIGJpdCBtYXNrIHRvIGluY2x1ZGUgaW4gZmx1c2ggdHJp
Z2dlcgogICovCiBzdGF0aWMgdm9pZCBfZHB1X2VuY29kZXJfdHJpZ2dlcl9mbHVzaChzdHJ1Y3Qg
ZHJtX2VuY29kZXIgKmRybV9lbmMsCi0JCXN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzLCB1
aW50MzJfdCBleHRyYV9mbHVzaF9iaXRzLAotCQlib29sIGFzeW5jKQorCQlzdHJ1Y3QgZHB1X2Vu
Y29kZXJfcGh5cyAqcGh5cywgdWludDMyX3QgZXh0cmFfZmx1c2hfYml0cykKIHsKIAlzdHJ1Y3Qg
ZHB1X2h3X2N0bCAqY3RsOwogCWludCBwZW5kaW5nX2tpY2tvZmZfY250OwpAQCAtMTQzOSwxMCAr
MTQzOCw3IEBAIHN0YXRpYyB2b2lkIF9kcHVfZW5jb2Rlcl90cmlnZ2VyX2ZsdXNoKHN0cnVjdCBk
cm1fZW5jb2RlciAqZHJtX2VuYywKIAkJcmV0dXJuOwogCX0KIAotCWlmICghYXN5bmMpCi0JCXBl
bmRpbmdfa2lja29mZl9jbnQgPSBkcHVfZW5jb2Rlcl9waHlzX2luY19wZW5kaW5nKHBoeXMpOwot
CWVsc2UKLQkJcGVuZGluZ19raWNrb2ZmX2NudCA9IGF0b21pY19yZWFkKCZwaHlzLT5wZW5kaW5n
X2tpY2tvZmZfY250KTsKKwlwZW5kaW5nX2tpY2tvZmZfY250ID0gZHB1X2VuY29kZXJfcGh5c19p
bmNfcGVuZGluZyhwaHlzKTsKIAogCWlmIChleHRyYV9mbHVzaF9iaXRzICYmIGN0bC0+b3BzLnVw
ZGF0ZV9wZW5kaW5nX2ZsdXNoKQogCQljdGwtPm9wcy51cGRhdGVfcGVuZGluZ19mbHVzaChjdGws
IGV4dHJhX2ZsdXNoX2JpdHMpOwpAQCAtMTU1Myw4ICsxNTQ5LDcgQEAgc3RhdGljIHZvaWQgZHB1
X2VuY29kZXJfaGVscGVyX2h3X3Jlc2V0KHN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2Vu
YykKICAqCWEgdGltZS4KICAqIGRwdV9lbmM6IFBvaW50ZXIgdG8gdmlydHVhbCBlbmNvZGVyIHN0
cnVjdHVyZQogICovCi1zdGF0aWMgdm9pZCBfZHB1X2VuY29kZXJfa2lja29mZl9waHlzKHN0cnVj
dCBkcHVfZW5jb2Rlcl92aXJ0ICpkcHVfZW5jLAotCQkJCSAgICAgIGJvb2wgYXN5bmMpCitzdGF0
aWMgdm9pZCBfZHB1X2VuY29kZXJfa2lja29mZl9waHlzKHN0cnVjdCBkcHVfZW5jb2Rlcl92aXJ0
ICpkcHVfZW5jKQogewogCXN0cnVjdCBkcHVfaHdfY3RsICpjdGw7CiAJdWludDMyX3QgaSwgcGVu
ZGluZ19mbHVzaDsKQEAgLTE1ODEsMTMgKzE1NzYsMTIgQEAgc3RhdGljIHZvaWQgX2RwdV9lbmNv
ZGVyX2tpY2tvZmZfcGh5cyhzdHJ1Y3QgZHB1X2VuY29kZXJfdmlydCAqZHB1X2VuYywKIAkJICog
Zm9yIGFzeW5jIGNvbW1pdHMuIFNvIGRvbid0IHNldCB0aGlzIGZvciBhc3luYywgc2luY2UgaXQn
bGwKIAkJICogcm9sbCBvdmVyIHRvIHRoZSBuZXh0IGNvbW1pdC4KIAkJICovCi0JCWlmICghYXN5
bmMgJiYgcGh5cy0+c3BsaXRfcm9sZSAhPSBFTkNfUk9MRV9TTEFWRSkKKwkJaWYgKHBoeXMtPnNw
bGl0X3JvbGUgIT0gRU5DX1JPTEVfU0xBVkUpCiAJCQlzZXRfYml0KGksIGRwdV9lbmMtPmZyYW1l
X2J1c3lfbWFzayk7CiAKIAkJaWYgKCFwaHlzLT5vcHMubmVlZHNfc2luZ2xlX2ZsdXNoIHx8CiAJ
CQkJIXBoeXMtPm9wcy5uZWVkc19zaW5nbGVfZmx1c2gocGh5cykpCi0JCQlfZHB1X2VuY29kZXJf
dHJpZ2dlcl9mbHVzaCgmZHB1X2VuYy0+YmFzZSwgcGh5cywgMHgwLAotCQkJCQkJICAgYXN5bmMp
OworCQkJX2RwdV9lbmNvZGVyX3RyaWdnZXJfZmx1c2goJmRwdV9lbmMtPmJhc2UsIHBoeXMsIDB4
MCk7CiAJCWVsc2UgaWYgKGN0bC0+b3BzLmdldF9wZW5kaW5nX2ZsdXNoKQogCQkJcGVuZGluZ19m
bHVzaCB8PSBjdGwtPm9wcy5nZXRfcGVuZGluZ19mbHVzaChjdGwpOwogCX0KQEAgLTE1OTcsNyAr
MTU5MSw3IEBAIHN0YXRpYyB2b2lkIF9kcHVfZW5jb2Rlcl9raWNrb2ZmX3BoeXMoc3RydWN0IGRw
dV9lbmNvZGVyX3ZpcnQgKmRwdV9lbmMsCiAJCV9kcHVfZW5jb2Rlcl90cmlnZ2VyX2ZsdXNoKAog
CQkJCSZkcHVfZW5jLT5iYXNlLAogCQkJCWRwdV9lbmMtPmN1cl9tYXN0ZXIsCi0JCQkJcGVuZGlu
Z19mbHVzaCwgYXN5bmMpOworCQkJCXBlbmRpbmdfZmx1c2gpOwogCX0KIAogCV9kcHVfZW5jb2Rl
cl90cmlnZ2VyX3N0YXJ0KGRwdV9lbmMtPmN1cl9tYXN0ZXIpOwpAQCAtMTgxNSwxMSArMTgwOSwx
MiBAQCB2b2lkIGRwdV9lbmNvZGVyX3ByZXBhcmVfZm9yX2tpY2tvZmYoc3RydWN0IGRybV9lbmNv
ZGVyICpkcm1fZW5jKQogCX0KIH0KIAotdm9pZCBkcHVfZW5jb2Rlcl9raWNrb2ZmKHN0cnVjdCBk
cm1fZW5jb2RlciAqZHJtX2VuYywgYm9vbCBhc3luYykKK3ZvaWQgZHB1X2VuY29kZXJfa2lja29m
ZihzdHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMpCiB7CiAJc3RydWN0IGRwdV9lbmNvZGVyX3Zp
cnQgKmRwdV9lbmM7CiAJc3RydWN0IGRwdV9lbmNvZGVyX3BoeXMgKnBoeXM7CiAJa3RpbWVfdCB3
YWtldXBfdGltZTsKKwl1bnNpZ25lZCBsb25nIHRpbWVvdXRfbXM7CiAJdW5zaWduZWQgaW50IGk7
CiAKIAlEUFVfQVRSQUNFX0JFR0lOKCJlbmNvZGVyX2tpY2tvZmYiKTsKQEAgLTE4MjcsMjMgKzE4
MjIsMTUgQEAgdm9pZCBkcHVfZW5jb2Rlcl9raWNrb2ZmKHN0cnVjdCBkcm1fZW5jb2RlciAqZHJt
X2VuYywgYm9vbCBhc3luYykKIAogCXRyYWNlX2RwdV9lbmNfa2lja29mZihEUk1JRChkcm1fZW5j
KSk7CiAKLQkvKgotCSAqIEFzeW5jaHJvbm91cyBmcmFtZXMgZG9uJ3QgaGFuZGxlIEZSQU1FX0RP
TkUgZXZlbnRzLiBBcyBzdWNoLCB0aGV5Ci0JICogc2hvdWxkbid0IGVuYWJsZSB0aGUgZnJhbWVf
ZG9uZSB3YXRjaGRvZyBzaW5jZSBpdCB3aWxsIGFsd2F5cyB0aW1lCi0JICogb3V0LgotCSAqLwot
CWlmICghYXN5bmMpIHsKLQkJdW5zaWduZWQgbG9uZyB0aW1lb3V0X21zOwotCQl0aW1lb3V0X21z
ID0gRFBVX0VOQ09ERVJfRlJBTUVfRE9ORV9USU1FT1VUX0ZSQU1FUyAqIDEwMDAgLworCXRpbWVv
dXRfbXMgPSBEUFVfRU5DT0RFUl9GUkFNRV9ET05FX1RJTUVPVVRfRlJBTUVTICogMTAwMCAvCiAJ
CQlkcm1fbW9kZV92cmVmcmVzaCgmZHJtX2VuYy0+Y3J0Yy0+c3RhdGUtPmFkanVzdGVkX21vZGUp
OwogCi0JCWF0b21pY19zZXQoJmRwdV9lbmMtPmZyYW1lX2RvbmVfdGltZW91dF9tcywgdGltZW91
dF9tcyk7Ci0JCW1vZF90aW1lcigmZHB1X2VuYy0+ZnJhbWVfZG9uZV90aW1lciwKLQkJCSAgamlm
ZmllcyArIG1zZWNzX3RvX2ppZmZpZXModGltZW91dF9tcykpOwotCX0KKwlhdG9taWNfc2V0KCZk
cHVfZW5jLT5mcmFtZV9kb25lX3RpbWVvdXRfbXMsIHRpbWVvdXRfbXMpOworCW1vZF90aW1lcigm
ZHB1X2VuYy0+ZnJhbWVfZG9uZV90aW1lciwKKwkJCWppZmZpZXMgKyBtc2Vjc190b19qaWZmaWVz
KHRpbWVvdXRfbXMpKTsKIAogCS8qIEFsbCBwaHlzIGVuY3MgYXJlIHJlYWR5IHRvIGdvLCB0cmln
Z2VyIHRoZSBraWNrb2ZmICovCi0JX2RwdV9lbmNvZGVyX2tpY2tvZmZfcGh5cyhkcHVfZW5jLCBh
c3luYyk7CisJX2RwdV9lbmNvZGVyX2tpY2tvZmZfcGh5cyhkcHVfZW5jKTsKIAogCS8qIGFsbG93
IHBoeXMgZW5jcyB0byBoYW5kbGUgYW55IHBvc3Qta2lja29mZiBidXNpbmVzcyAqLwogCWZvciAo
aSA9IDA7IGkgPCBkcHVfZW5jLT5udW1fcGh5c19lbmNzOyBpKyspIHsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9lbmNvZGVyLmggYi9kcml2ZXJzL2dwdS9k
cm0vbXNtL2Rpc3AvZHB1MS9kcHVfZW5jb2Rlci5oCmluZGV4IDk5N2QxMzFjMjQ0MC4uODQ2NWIz
N2FkZjNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfZW5j
b2Rlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9lbmNvZGVyLmgK
QEAgLTgyLDkgKzgyLDggQEAgdm9pZCBkcHVfZW5jb2Rlcl90cmlnZ2VyX2tpY2tvZmZfcGVuZGlu
ZyhzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpOwogICogZHB1X2VuY29kZXJfa2lja29mZiAt
IHRyaWdnZXIgYSBkb3VibGUgYnVmZmVyIGZsaXAgb2YgdGhlIGN0bCBwYXRoCiAgKgkoaS5lLiBj
dGwgZmx1c2ggYW5kIHN0YXJ0KSBpbW1lZGlhdGVseS4KICAqIEBlbmNvZGVyOgllbmNvZGVyIHBv
aW50ZXIKLSAqIEBhc3luYzoJdHJ1ZSBpZiB0aGlzIGlzIGFuIGFzeW5jaHJvbm91cyBjb21taXQK
ICAqLwotdm9pZCBkcHVfZW5jb2Rlcl9raWNrb2ZmKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rl
ciwgYm9vbCBhc3luYyk7Cit2b2lkIGRwdV9lbmNvZGVyX2tpY2tvZmYoc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyKTsKIAogLyoqCiAgKiBkcHVfZW5jb2Rlcl93YWl0X2Zvcl9ldmVudCAtIFdh
aXRzIGZvciBlbmNvZGVyIGV2ZW50cwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9k
aXNwL2RwdTEvZHB1X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2tt
cy5jCmluZGV4IGI4ZDI2NGJkMTVkZi4uMzE0NTRjYzVkOGM1IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21z
bS9kaXNwL2RwdTEvZHB1X2ttcy5jCkBAIC0yOTgsNyArMjk4LDcgQEAgdm9pZCBkcHVfa21zX2Vu
Y29kZXJfZW5hYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIAkJCWNvbnRpbnVlOwog
CiAJCXRyYWNlX2RwdV9rbXNfZW5jX2VuYWJsZShEUk1JRChjcnRjKSk7Ci0JCWRwdV9jcnRjX2Nv
bW1pdF9raWNrb2ZmKGNydGMsIGZhbHNlKTsKKwkJZHB1X2NydGNfY29tbWl0X2tpY2tvZmYoY3J0
Yyk7CiAJfQogfQogCkBAIC0zMTUsOCArMzE1LDcgQEAgc3RhdGljIHZvaWQgZHB1X2ttc19jb21t
aXQoc3RydWN0IG1zbV9rbXMgKmttcywgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CiAJCWlmIChjcnRjLT5zdGF0ZS0+YWN0aXZlKSB7CiAJCQl0cmFjZV9kcHVfa21zX2NvbW1pdChE
Uk1JRChjcnRjKSk7Ci0JCQlkcHVfY3J0Y19jb21taXRfa2lja29mZihjcnRjLAotCQkJCQkJc3Rh
dGUtPmxlZ2FjeV9jdXJzb3JfdXBkYXRlKTsKKwkJCWRwdV9jcnRjX2NvbW1pdF9raWNrb2ZmKGNy
dGMpOwogCQl9CiAJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fYXRv
bWljLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9hdG9taWMuYwppbmRleCBkZDE2YmFiZGQ4
YzAuLmU1YWFlMTY0NTkzMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fYXRv
bWljLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fYXRvbWljLmMKQEAgLTcwLDggKzcw
LDcgQEAgdm9pZCBtc21fYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJa21zLT5mdW5jcy0+Y29tbWl0KGttcywgc3RhdGUpOwogCX0KIAotCWlmICgh
c3RhdGUtPmxlZ2FjeV9jdXJzb3JfdXBkYXRlKQotCQltc21fYXRvbWljX3dhaXRfZm9yX2NvbW1p
dF9kb25lKGRldiwgc3RhdGUpOworCW1zbV9hdG9taWNfd2FpdF9mb3JfY29tbWl0X2RvbmUoZGV2
LCBzdGF0ZSk7CiAKIAlrbXMtPmZ1bmNzLT5jb21wbGV0ZV9jb21taXQoa21zLCBzdGF0ZSk7CiAK
LS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
