Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E695EF2997
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 09:46:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4D6306EF1A;
	Thu,  7 Nov 2019 08:46:38 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
X-Greylist: delayed 302 seconds by postgrey-1.36 at gabe;
 Thu, 07 Nov 2019 08:46:35 UTC
Received: from ste-pvt-msa1.bahnhof.se (ste-pvt-msa1.bahnhof.se
 [213.80.101.70])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EDB046EF19
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 08:46:35 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTP id A6A0D3F683
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:32 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Received: from ste-pvt-msa1.bahnhof.se ([127.0.0.1])
 by localhost (ste-pvt-msa1.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 0wSi22muP099 for <dri-devel@lists.freedesktop.org>;
 Thu,  7 Nov 2019 09:41:26 +0100 (CET)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa1.bahnhof.se (Postfix) with ESMTPA id A99633F474
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:25 +0100 (CET)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id B496B360343
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:24 +0100 (CET)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 6/8] drm/vmwgfx: Use an RBtree instead of linked list for
 MOB resources
Date: Thu,  7 Nov 2019 09:41:14 +0100
Message-Id: <20191107084116.33032-7-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191107084116.33032-1-thomas_os@shipmail.org>
References: <20191107084116.33032-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1573116084; bh=QmtKMmH+RlrYv28XHL4Q//KGAnfjUAfUdkNyRIo7BVI=;
 h=From:To:Subject:Date:In-Reply-To:References:From;
 b=AQcLpw/pa4auLy/a5O3+5r8UxIhUoPbXbaYrb7G2NgjN+vjgoZgz2hcfWPWDx7u3e
 14dRrYgyiLGS0F9fxzH3MBiy71NoB+ZZNsq/69GKiTPzI9Di+4okd/anV9xv/qHCn8
 FzYB8x7esYjxxN8XtmSg0KctSoO3XCpt4YlKiKbg=
X-Mailman-Original-Authentication-Results: ste-pvt-msa1.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=AQcLpw/p; 
 dkim-atps=neutral
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKV2l0aCBlbXVs
YXRlZCBjb2hlcmVudCBtZW1vcnkgd2UgbmVlZCB0byBiZSBhYmxlIHRvIHF1aWNrbHkgbG9vayB1
cAphIHJlc291cmNlIGZyb20gdGhlIE1PQiBvZmZzZXQuIEluc3RlYWQgb2YgdHJhdmVyc2luZyBh
IGxpbmtlZCBsaXN0IHdpdGgKTyhuKSB3b3JzdCBjYXNlLCB1c2UgYW4gUkJ0cmVlIHdpdGggTyhs
b2cgbikgd29yc3QgY2FzZSBjb21wbGV4aXR5LgoKQ2M6IEFuZHJldyBNb3J0b24gPGFrcG1AbGlu
dXgtZm91bmRhdGlvbi5vcmc+CkNjOiBNYXR0aGV3IFdpbGNveCA8d2lsbHlAaW5mcmFkZWFkLm9y
Zz4KQ2M6IFdpbGwgRGVhY29uIDx3aWxsLmRlYWNvbkBhcm0uY29tPgpDYzogUGV0ZXIgWmlqbHN0
cmEgPHBldGVyekBpbmZyYWRlYWQub3JnPgpDYzogUmlrIHZhbiBSaWVsIDxyaWVsQHN1cnJpZWwu
Y29tPgpDYzogTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9yZz4KQ2M6IE1pY2hhbCBIb2Nr
byA8bWhvY2tvQHN1c2UuY29tPgpDYzogSHVhbmcgWWluZyA8eWluZy5odWFuZ0BpbnRlbC5jb20+
CkNjOiBKw6lyw7RtZSBHbGlzc2UgPGpnbGlzc2VAcmVkaGF0LmNvbT4KQ2M6IEtpcmlsbCBBLiBT
aHV0ZW1vdiA8a2lyaWxsQHNodXRlbW92Lm5hbWU+ClNpZ25lZC1vZmYtYnk6IFRob21hcyBIZWxs
c3Ryb20gPHRoZWxsc3Ryb21Adm13YXJlLmNvbT4KUmV2aWV3ZWQtYnk6IERlZXBhayBSYXdhdCA8
ZHJhd2F0QHZtd2FyZS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8u
YyAgICAgICB8ICA1ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5oICAg
ICAgfCAxMCArKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5j
IHwgMzMgKysrKysrKysrKysrKysrKystLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDMyIGluc2Vy
dGlvbnMoKyksIDE2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdm13Z2Z4X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCmlu
ZGV4IDRmNmE3NWQ0MmQ3Zi4uOGI3MWJmNmI1OGVmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3Ztd2dmeF9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4
X2JvLmMKQEAgLTQ2Myw2ICs0NjMsNyBAQCB2b2lkIHZtd19ib19ib19mcmVlKHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8pCiAJc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICp2bXdfYm8gPSB2
bXdfYnVmZmVyX29iamVjdChibyk7CiAKIAlXQVJOX09OKHZtd19iby0+ZGlydHkpOworCVdBUk5f
T04oIVJCX0VNUFRZX1JPT1QoJnZtd19iby0+cmVzX3RyZWUpKTsKIAl2bXdfYm9fdW5tYXAodm13
X2JvKTsKIAlrZnJlZSh2bXdfYm8pOwogfQpAQCAtNDc5LDYgKzQ4MCw3IEBAIHN0YXRpYyB2b2lk
IHZtd191c2VyX2JvX2Rlc3Ryb3koc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAlzdHJ1
Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibyA9ICZ2bXdfdXNlcl9iby0+dmJvOwogCiAJV0FSTl9P
Tih2Ym8tPmRpcnR5KTsKKwlXQVJOX09OKCFSQl9FTVBUWV9ST09UKCZ2Ym8tPnJlc190cmVlKSk7
CiAJdm13X2JvX3VubWFwKHZibyk7CiAJdHRtX3ByaW1lX29iamVjdF9rZnJlZSh2bXdfdXNlcl9i
bywgcHJpbWUpOwogfQpAQCAtNTE0LDggKzUxNiw3IEBAIGludCB2bXdfYm9faW5pdChzdHJ1Y3Qg
dm13X3ByaXZhdGUgKmRldl9wcml2LAogCW1lbXNldCh2bXdfYm8sIDAsIHNpemVvZigqdm13X2Jv
KSk7CiAJQlVJTERfQlVHX09OKFRUTV9NQVhfQk9fUFJJT1JJVFkgPD0gMyk7CiAJdm13X2JvLT5i
YXNlLnByaW9yaXR5ID0gMzsKLQotCUlOSVRfTElTVF9IRUFEKCZ2bXdfYm8tPnJlc19saXN0KTsK
Kwl2bXdfYm8tPnJlc190cmVlID0gUkJfUk9PVDsKIAogCXJldCA9IHR0bV9ib19pbml0KGJkZXYs
ICZ2bXdfYm8tPmJhc2UsIHNpemUsCiAJCQkgIHR0bV9ib190eXBlX2RldmljZSwgcGxhY2VtZW50
LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmggYi9kcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuaAppbmRleCA3ZjJjY2UwMTY2ODcuLmQ1ZmE5
YjcyYzhmZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmgKQEAgLTEwMCw3ICsxMDAs
NyBAQCBzdHJ1Y3Qgdm13X2Zwcml2IHsKIC8qKgogICogc3RydWN0IHZtd19idWZmZXJfb2JqZWN0
IC0gVFRNIGJ1ZmZlciBvYmplY3Qgd2l0aCB2bXdnZnggYWRkaXRpb25zCiAgKiBAYmFzZTogVGhl
IFRUTSBidWZmZXIgb2JqZWN0Ci0gKiBAcmVzX2xpc3Q6IExpc3Qgb2YgcmVzb3VyY2VzIHVzaW5n
IHRoaXMgYnVmZmVyIG9iamVjdCBhcyBhIGJhY2tpbmcgTU9CCisgKiBAcmVzX3RyZWU6IFJCIHRy
ZWUgb2YgcmVzb3VyY2VzIHVzaW5nIHRoaXMgYnVmZmVyIG9iamVjdCBhcyBhIGJhY2tpbmcgTU9C
CiAgKiBAcGluX2NvdW50OiBwaW4gZGVwdGgKICAqIEBjcHVfd3JpdGVyczogTnVtYmVyIG9mIHN5
bmNjcHUgd3JpdGUgZ3JhYnMuIFByb3RlY3RlZCBieSByZXNlcnZhdGlvbiB3aGVuCiAgKiBpbmNy
ZWFzZWQuIE1heSBiZSBkZWNyZWFzZWQgd2l0aG91dCByZXNlcnZhdGlvbi4KQEAgLTExMSw3ICsx
MTEsNyBAQCBzdHJ1Y3Qgdm13X2Zwcml2IHsKICAqLwogc3RydWN0IHZtd19idWZmZXJfb2JqZWN0
IHsKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgYmFzZTsKLQlzdHJ1Y3QgbGlzdF9oZWFkIHJl
c19saXN0OworCXN0cnVjdCByYl9yb290IHJlc190cmVlOwogCXMzMiBwaW5fY291bnQ7CiAJYXRv
bWljX3QgY3B1X3dyaXRlcnM7CiAJLyogTm90IHJlZi1jb3VudGVkLiAgUHJvdGVjdGVkIGJ5IGJp
bmRpbmdfbXV0ZXggKi8KQEAgLTE2MCw4ICsxNjAsOCBAQCBzdHJ1Y3Qgdm13X3Jlc19mdW5jOwog
ICogcGluLWNvdW50IGdyZWF0ZXIgdGhhbiB6ZXJvLiBJdCBpcyBub3Qgb24gdGhlIHJlc291cmNl
IExSVSBsaXN0cyBhbmQgaXRzCiAgKiBiYWNrdXAgYnVmZmVyIGlzIHBpbm5lZC4gSGVuY2UgaXQg
Y2FuJ3QgYmUgZXZpY3RlZC4KICAqIEBmdW5jOiBNZXRob2QgdnRhYmxlIGZvciB0aGlzIHJlc291
cmNlLiBJbW11dGFibGUuCisgKiBAbW9iX25vZGU7IE5vZGUgZm9yIHRoZSBNT0IgYmFja3VwIHJi
dHJlZS4gUHJvdGVjdGVkIGJ5IEBiYWNrdXAgcmVzZXJ2ZWQuCiAgKiBAbHJ1X2hlYWQ6IExpc3Qg
aGVhZCBmb3IgdGhlIExSVSBsaXN0LiBQcm90ZWN0ZWQgYnkgQGRldl9wcml2OjpyZXNvdXJjZV9s
b2NrLgotICogQG1vYl9oZWFkOiBMaXN0IGhlYWQgZm9yIHRoZSBNT0IgYmFja3VwIGxpc3QuIFBy
b3RlY3RlZCBieSBAYmFja3VwIHJlc2VydmVkLgogICogQGJpbmRpbmdfaGVhZDogTGlzdCBoZWFk
IGZvciB0aGUgY29udGV4dCBiaW5kaW5nIGxpc3QuIFByb3RlY3RlZCBieQogICogdGhlIEBkZXZf
cHJpdjo6YmluZGluZ19tdXRleAogICogQHJlc19mcmVlOiBUaGUgcmVzb3VyY2UgZGVzdHJ1Y3Rv
ci4KQEAgLTE4Miw4ICsxODIsOCBAQCBzdHJ1Y3Qgdm13X3Jlc291cmNlIHsKIAl1bnNpZ25lZCBs
b25nIGJhY2t1cF9vZmZzZXQ7CiAJdW5zaWduZWQgbG9uZyBwaW5fY291bnQ7CiAJY29uc3Qgc3Ry
dWN0IHZtd19yZXNfZnVuYyAqZnVuYzsKKwlzdHJ1Y3QgcmJfbm9kZSBtb2Jfbm9kZTsKIAlzdHJ1
Y3QgbGlzdF9oZWFkIGxydV9oZWFkOwotCXN0cnVjdCBsaXN0X2hlYWQgbW9iX2hlYWQ7CiAJc3Ry
dWN0IGxpc3RfaGVhZCBiaW5kaW5nX2hlYWQ7CiAJc3RydWN0IHZtd19yZXNvdXJjZV9kaXJ0eSAq
ZGlydHk7CiAJdm9pZCAoKnJlc19mcmVlKSAoc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKTsKQEAg
LTczNyw3ICs3MzcsNyBAQCB2b2lkIHZtd19yZXNvdXJjZV9kaXJ0eV91cGRhdGUoc3RydWN0IHZt
d19yZXNvdXJjZSAqcmVzLCBwZ29mZl90IHN0YXJ0LAogICovCiBzdGF0aWMgaW5saW5lIGJvb2wg
dm13X3Jlc291cmNlX21vYl9hdHRhY2hlZChjb25zdCBzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMp
CiB7Ci0JcmV0dXJuICFsaXN0X2VtcHR5KCZyZXMtPm1vYl9oZWFkKTsKKwlyZXR1cm4gIVJCX0VN
UFRZX05PREUoJnJlcy0+bW9iX25vZGUpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdm13Z2Z4X3Jlc291cmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4
L3Ztd2dmeF9yZXNvdXJjZS5jCmluZGV4IGI1NGQ2MGJkODQ1ZC4uYTE4ODMxZTFkMzUzIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3Jlc291cmNlLmMKQEAgLTQwLDExICs0MCwyNCBA
QAogdm9pZCB2bXdfcmVzb3VyY2VfbW9iX2F0dGFjaChzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMp
CiB7CiAJc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICpiYWNrdXAgPSByZXMtPmJhY2t1cDsKKwlz
dHJ1Y3QgcmJfbm9kZSAqKm5ldyA9ICZiYWNrdXAtPnJlc190cmVlLnJiX25vZGUsICpwYXJlbnQg
PSBOVUxMOwogCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQocmVzLT5iYWNrdXAtPmJhc2UuYmFzZS5y
ZXN2KTsKIAlyZXMtPnVzZWRfcHJpbyA9IChyZXMtPnJlc19kaXJ0eSkgPyByZXMtPmZ1bmMtPmRp
cnR5X3ByaW8gOgogCQlyZXMtPmZ1bmMtPnByaW87Ci0JbGlzdF9hZGRfdGFpbCgmcmVzLT5tb2Jf
aGVhZCwgJmJhY2t1cC0+cmVzX2xpc3QpOworCisJd2hpbGUgKCpuZXcpIHsKKwkJc3RydWN0IHZt
d19yZXNvdXJjZSAqdGhpcyA9CisJCQljb250YWluZXJfb2YoKm5ldywgc3RydWN0IHZtd19yZXNv
dXJjZSwgbW9iX25vZGUpOworCisJCXBhcmVudCA9ICpuZXc7CisJCW5ldyA9IChyZXMtPmJhY2t1
cF9vZmZzZXQgPCB0aGlzLT5iYWNrdXBfb2Zmc2V0KSA/CisJCQkmKCgqbmV3KS0+cmJfbGVmdCkg
OiAmKCgqbmV3KS0+cmJfcmlnaHQpOworCX0KKworCXJiX2xpbmtfbm9kZSgmcmVzLT5tb2Jfbm9k
ZSwgcGFyZW50LCBuZXcpOworCXJiX2luc2VydF9jb2xvcigmcmVzLT5tb2Jfbm9kZSwgJmJhY2t1
cC0+cmVzX3RyZWUpOworCiAJdm13X2JvX3ByaW9fYWRkKGJhY2t1cCwgcmVzLT51c2VkX3ByaW8p
OwogfQogCkBAIC01OCw3ICs3MSw4IEBAIHZvaWQgdm13X3Jlc291cmNlX21vYl9kZXRhY2goc3Ry
dWN0IHZtd19yZXNvdXJjZSAqcmVzKQogCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQoYmFja3VwLT5i
YXNlLmJhc2UucmVzdik7CiAJaWYgKHZtd19yZXNvdXJjZV9tb2JfYXR0YWNoZWQocmVzKSkgewot
CQlsaXN0X2RlbF9pbml0KCZyZXMtPm1vYl9oZWFkKTsKKwkJcmJfZXJhc2UoJnJlcy0+bW9iX25v
ZGUsICZiYWNrdXAtPnJlc190cmVlKTsKKwkJUkJfQ0xFQVJfTk9ERSgmcmVzLT5tb2Jfbm9kZSk7
CiAJCXZtd19ib19wcmlvX2RlbChiYWNrdXAsIHJlcy0+dXNlZF9wcmlvKTsKIAl9CiB9CkBAIC0y
MDQsOCArMjE4LDggQEAgaW50IHZtd19yZXNvdXJjZV9pbml0KHN0cnVjdCB2bXdfcHJpdmF0ZSAq
ZGV2X3ByaXYsIHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcywKIAlyZXMtPnJlc19mcmVlID0gcmVz
X2ZyZWU7CiAJcmVzLT5kZXZfcHJpdiA9IGRldl9wcml2OwogCXJlcy0+ZnVuYyA9IGZ1bmM7CisJ
UkJfQ0xFQVJfTk9ERSgmcmVzLT5tb2Jfbm9kZSk7CiAJSU5JVF9MSVNUX0hFQUQoJnJlcy0+bHJ1
X2hlYWQpOwotCUlOSVRfTElTVF9IRUFEKCZyZXMtPm1vYl9oZWFkKTsKIAlJTklUX0xJU1RfSEVB
RCgmcmVzLT5iaW5kaW5nX2hlYWQpOwogCXJlcy0+aWQgPSAtMTsKIAlyZXMtPmJhY2t1cCA9IE5V
TEw7CkBAIC03NTMsMTkgKzc2NywyMCBAQCBpbnQgdm13X3Jlc291cmNlX3ZhbGlkYXRlKHN0cnVj
dCB2bXdfcmVzb3VyY2UgKnJlcywgYm9vbCBpbnRyKQogICovCiB2b2lkIHZtd19yZXNvdXJjZV91
bmJpbmRfbGlzdChzdHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibykKIHsKLQotCXN0cnVjdCB2
bXdfcmVzb3VyY2UgKnJlcywgKm5leHQ7CiAJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgdmFs
X2J1ZiA9IHsKIAkJLmJvID0gJnZiby0+YmFzZSwKIAkJLm51bV9zaGFyZWQgPSAwCiAJfTsKIAog
CWRtYV9yZXN2X2Fzc2VydF9oZWxkKHZiby0+YmFzZS5iYXNlLnJlc3YpOwotCWxpc3RfZm9yX2Vh
Y2hfZW50cnlfc2FmZShyZXMsIG5leHQsICZ2Ym8tPnJlc19saXN0LCBtb2JfaGVhZCkgewotCQlp
ZiAoIXJlcy0+ZnVuYy0+dW5iaW5kKQotCQkJY29udGludWU7CisJd2hpbGUgKCFSQl9FTVBUWV9S
T09UKCZ2Ym8tPnJlc190cmVlKSkgeworCQlzdHJ1Y3QgcmJfbm9kZSAqbm9kZSA9IHZiby0+cmVz
X3RyZWUucmJfbm9kZTsKKwkJc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzID0KKwkJCWNvbnRhaW5l
cl9vZihub2RlLCBzdHJ1Y3Qgdm13X3Jlc291cmNlLCBtb2Jfbm9kZSk7CisKKwkJaWYgKCFXQVJO
X09OX09OQ0UoIXJlcy0+ZnVuYy0+dW5iaW5kKSkKKwkJCSh2b2lkKSByZXMtPmZ1bmMtPnVuYmlu
ZChyZXMsIHJlcy0+cmVzX2RpcnR5LCAmdmFsX2J1Zik7CiAKLQkJKHZvaWQpIHJlcy0+ZnVuYy0+
dW5iaW5kKHJlcywgcmVzLT5yZXNfZGlydHksICZ2YWxfYnVmKTsKIAkJcmVzLT5iYWNrdXBfZGly
dHkgPSB0cnVlOwogCQlyZXMtPnJlc19kaXJ0eSA9IGZhbHNlOwogCQl2bXdfcmVzb3VyY2VfbW9i
X2RldGFjaChyZXMpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
