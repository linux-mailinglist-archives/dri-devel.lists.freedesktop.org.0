Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 99F6524C21E
	for <lists+dri-devel@lfdr.de>; Thu, 20 Aug 2020 17:24:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1A5D16E970;
	Thu, 20 Aug 2020 15:24:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DE7296E96A;
 Thu, 20 Aug 2020 15:24:10 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id f1so2422699wro.2;
 Thu, 20 Aug 2020 08:24:10 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=TmQ8AKwqPYD7BQs/jlMPmVRYmlMpVVT2qoft/nFA6Jg=;
 b=heTqOOcsYk0TFr6Q33gO0PWBybdXRsGlf1FaWlfcrO7XaW8mrAxergeH86N1CA4qd7
 Ft1QG+NdJE37NBP+DEv56oVXKbK2CF4l5d6EwirQadIgyMxTKLgwy0NwjOY+06hli7ES
 TuIEEVAUHbihIP8+AH+sUVV8DkSOB8RMz3MMZRKMhx/SjD/EgFpLSL89TL/EDM14h8Ls
 kbJ46qzGbdZLGtJlPKelk/iNbfNB0hiF0kt7fuq9+JKP14IG451EPNNjuBd4guh/XKr2
 R0O0mUMJ31uspX2lbQ9FWzw5OijNpJHabVAJB7uWa7lRF1bOhnjtml/zCilvb5tZ8Pjj
 0KOg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=TmQ8AKwqPYD7BQs/jlMPmVRYmlMpVVT2qoft/nFA6Jg=;
 b=gRSYrzNPXqfdLRQofxGNNWXgJBadIbH2LX0NEvqCQ9u3zNkqVr9zOqjvMQ/2bqfkR6
 YW/d1F3zpu4AU/Ni4RLvF6O9dro7y1ecIGpF58mcHhV0H+iLdJBwTzfrLJ17VrJNJq0Y
 ALiBrJbTY3ogDSzPK6ix6E9knfl38eEcO7Px2wlNyXhwEFOe9Q4aI5TjmnaLxfaP9m+5
 e+KTFl+/tcvyeBVZx7ZeMz53U0XxBNB+EVJjYraRW2os1luwqsap4+ltFRyDXJ0gdTbX
 vIrcrUN1bEpqvZB0aOx1num4Tz5lKOv167xAhFA+oMbXbHQjxnX5taXZoPHboEV8Th1Z
 s5KQ==
X-Gm-Message-State: AOAM531go6WYN9etj5RwlsVqgw9N6UmR/hKwp+ooVyJIIZO7qCop3UTs
 SQ7Tnpvrz7lctMP3+GfnnBk=
X-Google-Smtp-Source: ABdhPJxXfH7Kzddh7QcQtOXec6XYlesVdExkui5ibB5AXnmLfBWwG2TC0xQLBalXtf+RlYzDnDARcw==
X-Received: by 2002:adf:82f6:: with SMTP id 109mr4051309wrc.25.1597937048539; 
 Thu, 20 Aug 2020 08:24:08 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:6f64:e393:bd4a:2d65])
 by smtp.gmail.com with ESMTPSA id t189sm5320708wmf.47.2020.08.20.08.24.07
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 20 Aug 2020 08:24:07 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: airlied@gmail.com, skeggsb@gmail.com, dri-devel@lists.freedesktop.org,
 Nouveau@lists.freedesktop.org
Subject: [PATCH 2/2] drm/nouveau: move io_reserve_lru handling into the driver
 v3
Date: Thu, 20 Aug 2020 17:24:04 +0200
Message-Id: <20200820152404.22774-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200820152404.22774-1-christian.koenig@amd.com>
References: <20200820152404.22774-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2tvZW5pZy5sZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+
CgpXaGlsZSB3b3JraW5nIG9uIFRUTSBjbGVhbnVwcyBJJ3ZlIGZvdW5kIHRoYXQgdGhlIGlvX3Jl
c2VydmVfbHJ1IHVzZWQgYnkKTm91dmVhdSBpcyBhY3R1YWxseSBub3Qgd29ya2luZyBhdCBhbGwu
CgpJbiBnZW5lcmFsIHdlIHNob3VsZCByZW1vdmUgZHJpdmVyIHNwZWNpZmljIGhhbmRsaW5nIGZy
b20gdGhlIG1lbW9yeQptYW5hZ2VtZW50LCBzbyB0aGlzIHBhdGNoIG1vdmVzIHRoZSBpb19yZXNl
cnZlX2xydSBoYW5kbGluZyBpbnRvIE5vdXZlYXUKaW5zdGVhZC4KClRoZSBwYXRjaCBzaG91bGQg
YmUgZnVuY3Rpb25hbCBjb3JyZWN0LCBidXQgaXMgb25seSBjb21waWxlIHRlc3RlZCEKCnYyOiBk
b24ndCBjYWxsIHR0bV9ib191bm1hcF92aXJ0dWFsIGluIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNl
cnZlCnYzOiByZWJhc2VkIGFuZCB1c2UgYm90aCBiYXNlIGFuZCBvZmZzZXQgaW4gdGhlIGNoZWNr
CgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5j
b20+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYyAgfCAxMDAgKysrKysrKysrKysr
KysrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uaCAgfCAg
IDMgKwogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCB8ICAgMiArCiBkcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jIHwgIDQ0ICsrKysrKysrKysrLQogNCBm
aWxlcyBjaGFuZ2VkLCAxMjggaW5zZXJ0aW9ucygrKSwgMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jIGIvZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IDUzOTJlNWZlYTVkNC4uYWE5ZmNlYWE3OWVi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCkBAIC0xMzcsNiArMTM3LDcgQEAg
bm91dmVhdV9ib19kZWxfdHRtKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCiAJc3RydWN0
IG5vdXZlYXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKIAogCVdBUk5fT04obnZiby0+cGlu
X3JlZmNudCA+IDApOworCW5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KGJvKTsKIAludjEw
X2JvX3B1dF90aWxlX3JlZ2lvbihkZXYsIG52Ym8tPnRpbGUsIE5VTEwpOwogCiAJLyoKQEAgLTMw
NCw2ICszMDUsNyBAQCBub3V2ZWF1X2JvX2luaXQoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8sIHU2
NCBzaXplLCBpbnQgYWxpZ24sIHUzMiBmbGFncywKIAogCW52Ym8tPmJvLm1lbS5udW1fcGFnZXMg
PSBzaXplID4+IFBBR0VfU0hJRlQ7CiAJbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIGZs
YWdzLCAwKTsKKwlJTklUX0xJU1RfSEVBRCgmbnZiby0+aW9fcmVzZXJ2ZV9scnUpOwogCiAJcmV0
ID0gdHRtX2JvX2luaXQobnZiby0+Ym8uYmRldiwgJm52Ym8tPmJvLCBzaXplLCB0eXBlLAogCQkJ
ICAmbnZiby0+cGxhY2VtZW50LCBhbGlnbiA+PiBQQUdFX1NISUZULCBmYWxzZSwKQEAgLTU3NCw2
ICs1NzYsMjYgQEAgbm91dmVhdV9ib19zeW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVfYm8gKm52
Ym8pCiAJCQkJCVBBR0VfU0laRSwgRE1BX0ZST01fREVWSUNFKTsKIH0KIAordm9pZCBub3V2ZWF1
X2JvX2FkZF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQorewor
CXN0cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2KGJvLT5iZGV2KTsKKwlzdHJ1
Y3Qgbm91dmVhdV9ibyAqbnZibyA9IG5vdXZlYXVfYm8oYm8pOworCisJbXV0ZXhfbG9jaygmZHJt
LT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7CisJbGlzdF9tb3ZlX3RhaWwoJm52Ym8tPmlvX3Jlc2Vy
dmVfbHJ1LCAmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUpOworCW11dGV4X3VubG9jaygmZHJtLT50
dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cit9CisKK3ZvaWQgbm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2
ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKK3sKKwlzdHJ1Y3Qgbm91dmVhdV9k
cm0gKmRybSA9IG5vdXZlYXVfYmRldihiby0+YmRldik7CisJc3RydWN0IG5vdXZlYXVfYm8gKm52
Ym8gPSBub3V2ZWF1X2JvKGJvKTsKKworCW11dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVf
bXV0ZXgpOworCWxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKKwltdXRleF91
bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworfQorCiBpbnQKIG5vdXZlYXVfYm9f
dmFsaWRhdGUoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8sIGJvb2wgaW50ZXJydXB0aWJsZSwKIAkJ
ICAgIGJvb2wgbm9fd2FpdF9ncHUpCkBAIC04ODgsNiArOTEwLDggQEAgbm91dmVhdV9ib19tb3Zl
X250Znkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywgYm9vbCBldmljdCwKIAlpZiAoYm8t
PmRlc3Ryb3kgIT0gbm91dmVhdV9ib19kZWxfdHRtKQogCQlyZXR1cm47CiAKKwlub3V2ZWF1X2Jv
X2RlbF9pb19yZXNlcnZlX2xydShibyk7CisKIAlpZiAobWVtICYmIG5ld19yZWctPm1lbV90eXBl
ICE9IFRUTV9QTF9TWVNURU0gJiYKIAkgICAgbWVtLT5tZW0ucGFnZSA9PSBudmJvLT5wYWdlKSB7
CiAJCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmbnZiby0+dm1hX2xpc3QsIGhlYWQpIHsKQEAg
LTEwMTgsMTIgKzEwNDIsNDMgQEAgbm91dmVhdV9ib192ZXJpZnlfYWNjZXNzKHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8sIHN0cnVjdCBmaWxlICpmaWxwKQogCQkJCQkgIGZpbHAtPnByaXZh
dGVfZGF0YSk7CiB9CiAKK3N0YXRpYyB2b2lkCitub3V2ZWF1X3R0bV9pb19tZW1fZnJlZV9sb2Nr
ZWQoc3RydWN0IG5vdXZlYXVfZHJtICpkcm0sCisJCQkgICAgICAgc3RydWN0IHR0bV9yZXNvdXJj
ZSAqcmVnKQoreworCXN0cnVjdCBub3V2ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsK
KworCWlmICghcmVnLT5idXMuYmFzZSAmJiAhcmVnLT5idXMub2Zmc2V0KQorCQlyZXR1cm47IC8q
IGFscmVhZHkgZnJlZWQgKi8KKworCWlmIChkcm0tPmNsaWVudC5tZW0tPm9jbGFzcyA+PSBOVklG
X0NMQVNTX01FTV9OVjUwKSB7CisJCXN3aXRjaCAocmVnLT5tZW1fdHlwZSkgeworCQljYXNlIFRU
TV9QTF9UVDoKKwkJCWlmIChtZW0tPmtpbmQpCisJCQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxl
KCZtZW0tPm1lbS5vYmplY3QpOworCQkJYnJlYWs7CisJCWNhc2UgVFRNX1BMX1ZSQU06CisJCQlu
dmlmX29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7CisJCQlicmVhazsKKwkJ
ZGVmYXVsdDoKKwkJCWJyZWFrOworCQl9CisJfQorCXJlZy0+YnVzLmJhc2UgPSAwOworCXJlZy0+
YnVzLm9mZnNldCA9IDA7Cit9CisKIHN0YXRpYyBpbnQKIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNl
cnZlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX3Jlc291cmNlICpyZWcp
CiB7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYoYmRldik7CiAJc3Ry
dWN0IG52a21fZGV2aWNlICpkZXZpY2UgPSBudnh4X2RldmljZSgmZHJtLT5jbGllbnQuZGV2aWNl
KTsKIAlzdHJ1Y3Qgbm91dmVhdV9tZW0gKm1lbSA9IG5vdXZlYXVfbWVtKHJlZyk7CisJc3RydWN0
IG5vdXZlYXVfYm8gKm52Ym87CisJaW50IHJldDsKKworCWlmIChyZWctPmJ1cy5iYXNlIHx8IHJl
Zy0+YnVzLm9mZnNldCkKKwkJcmV0dXJuIDA7IC8qIGFscmVhZHkgbWFwcGVkICovCiAKIAlyZWct
PmJ1cy5hZGRyID0gTlVMTDsKIAlyZWctPmJ1cy5vZmZzZXQgPSAwOwpAQCAtMTAzMSwxMCArMTA4
NiwxMyBAQCBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwgc3RydWN0IHR0bV9yZXNvdXJjZSAqcmVnKQogCXJlZy0+YnVzLmJhc2UgPSAwOwogCXJl
Zy0+YnVzLmlzX2lvbWVtID0gZmFsc2U7CiAKKwltdXRleF9sb2NrKCZkcm0tPnR0bS5pb19yZXNl
cnZlX211dGV4KTsKK3JldHJ5OgogCXN3aXRjaCAocmVnLT5tZW1fdHlwZSkgewogCWNhc2UgVFRN
X1BMX1NZU1RFTToKIAkJLyogU3lzdGVtIG1lbW9yeSAqLwotCQlyZXR1cm4gMDsKKwkJcmV0ID0g
MDsKKwkJZ290byBvdXQ7CiAJY2FzZSBUVE1fUExfVFQ6CiAjaWYgSVNfRU5BQkxFRChDT05GSUdf
QUdQKQogCQlpZiAoZHJtLT5hZ3AuYnJpZGdlKSB7CkBAIC0xMDU4LDcgKzExMTYsNiBAQCBub3V2
ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwgc3RydWN0
IHR0bV9yZXNvdXJjZSAqcmVnKQogCQkJfSBhcmdzOwogCQkJdTY0IGhhbmRsZSwgbGVuZ3RoOwog
CQkJdTMyIGFyZ2MgPSAwOwotCQkJaW50IHJldDsKIAogCQkJc3dpdGNoIChtZW0tPm1lbS5vYmpl
Y3Qub2NsYXNzKSB7CiAJCQljYXNlIE5WSUZfQ0xBU1NfTUVNX05WNTA6CkBAIC0xMDg1LDcgKzEx
NDIsNyBAQCBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwgc3RydWN0IHR0bV9yZXNvdXJjZSAqcmVnKQogCQkJaWYgKHJldCAhPSAxKSB7CiAJCQkJ
aWYgKFdBUk5fT04ocmV0ID09IDApKQogCQkJCQlyZXR1cm4gLUVJTlZBTDsKLQkJCQlyZXR1cm4g
cmV0OworCQkJCWdvdG8gb3V0OwogCQkJfQogCiAJCQlyZWctPmJ1cy5iYXNlID0gMDsKQEAgLTEw
OTMsMzAgKzExNTAsMzUgQEAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9i
b19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fcmVzb3VyY2UgKnJlZykKIAkJfQogCQlicmVhazsK
IAlkZWZhdWx0OgotCQlyZXR1cm4gLUVJTlZBTDsKKwkJcmV0ID0gLUVJTlZBTDsKIAl9Ci0JcmV0
dXJuIDA7CisKK291dDoKKwlpZiAocmV0ID09IC1FTk9TUEMpIHsKKwkJbnZibyA9IGxpc3RfZmly
c3RfZW50cnlfb3JfbnVsbCgmZHJtLT50dG0uaW9fcmVzZXJ2ZV9scnUsCisJCQkJCQl0eXBlb2Yo
Km52Ym8pLAorCQkJCQkJaW9fcmVzZXJ2ZV9scnUpOworCQlpZiAobnZibykgeworCQkJbGlzdF9k
ZWxfaW5pdCgmbnZiby0+aW9fcmVzZXJ2ZV9scnUpOworCQkJZHJtX3ZtYV9ub2RlX3VubWFwKCZu
dmJvLT5iby5iYXNlLnZtYV9ub2RlLAorCQkJCQkgICBiZGV2LT5kZXZfbWFwcGluZyk7CisJCQlu
b3V2ZWF1X3R0bV9pb19tZW1fZnJlZV9sb2NrZWQoZHJtLCAmbnZiby0+Ym8ubWVtKTsKKwkJCWdv
dG8gcmV0cnk7CisJCX0KKworCX0KKwltdXRleF91bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVf
bXV0ZXgpOworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lkCiBub3V2ZWF1X3R0bV9pb19t
ZW1fZnJlZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV9yZXNvdXJjZSAq
cmVnKQogewogCXN0cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2KGJkZXYpOwot
CXN0cnVjdCBub3V2ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKIAotCWlmIChkcm0t
PmNsaWVudC5tZW0tPm9jbGFzcyA+PSBOVklGX0NMQVNTX01FTV9OVjUwKSB7Ci0JCXN3aXRjaCAo
cmVnLT5tZW1fdHlwZSkgewotCQljYXNlIFRUTV9QTF9UVDoKLQkJCWlmIChtZW0tPmtpbmQpCi0J
CQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QpOwotCQkJYnJlYWs7
Ci0JCWNhc2UgVFRNX1BMX1ZSQU06Ci0JCQludmlmX29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+
bWVtLm9iamVjdCk7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCWJyZWFrOwotCQl9Ci0JfQor
CW11dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworCW5vdXZlYXVfdHRtX2lv
X21lbV9mcmVlX2xvY2tlZChkcm0sIHJlZyk7CisJbXV0ZXhfdW5sb2NrKCZkcm0tPnR0bS5pb19y
ZXNlcnZlX211dGV4KTsKIH0KIAogc3RhdGljIGludApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9iby5oIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVh
dV9iby5oCmluZGV4IGFlY2I3NDgxZGYwZC4uYWU5MGFjYTMzZmVmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV9iby5oCkBAIC0xOCw2ICsxOCw3IEBAIHN0cnVjdCBub3V2ZWF1X2JvIHsK
IAlib29sIGZvcmNlX2NvaGVyZW50OwogCXN0cnVjdCB0dG1fYm9fa21hcF9vYmoga21hcDsKIAlz
dHJ1Y3QgbGlzdF9oZWFkIGhlYWQ7CisJc3RydWN0IGxpc3RfaGVhZCBpb19yZXNlcnZlX2xydTsK
IAogCS8qIHByb3RlY3RlZCBieSB0dG1fYm9fcmVzZXJ2ZSgpICovCiAJc3RydWN0IGRybV9maWxl
ICpyZXNlcnZlZF9ieTsKQEAgLTk2LDYgKzk3LDggQEAgaW50ICBub3V2ZWF1X2JvX3ZhbGlkYXRl
KHN0cnVjdCBub3V2ZWF1X2JvICosIGJvb2wgaW50ZXJydXB0aWJsZSwKIAkJCSBib29sIG5vX3dh
aXRfZ3B1KTsKIHZvaWQgbm91dmVhdV9ib19zeW5jX2Zvcl9kZXZpY2Uoc3RydWN0IG5vdXZlYXVf
Ym8gKm52Ym8pOwogdm9pZCBub3V2ZWF1X2JvX3N5bmNfZm9yX2NwdShzdHJ1Y3Qgbm91dmVhdV9i
byAqbnZibyk7Cit2b2lkIG5vdXZlYXVfYm9fYWRkX2lvX3Jlc2VydmVfbHJ1KHN0cnVjdCB0dG1f
YnVmZmVyX29iamVjdCAqYm8pOwordm9pZCBub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xydShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKTsKIAogLyogVE9ETzogc3VibWl0IGVxdWl2YWxl
bnQgdG8gVFRNIGdlbmVyaWMgQVBJIHVwc3RyZWFtPyAqLwogc3RhdGljIGlubGluZSB2b2lkIF9f
aW9tZW0gKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYu
aCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKaW5kZXggZjYzYWM3MmFh
NTU2Li4yNmEyYzEwOTAwNDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25v
dXZlYXVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaApA
QCAtMTY0LDYgKzE2NCw4IEBAIHN0cnVjdCBub3V2ZWF1X2RybSB7CiAJCWludCB0eXBlX3ZyYW07
CiAJCWludCB0eXBlX2hvc3RbMl07CiAJCWludCB0eXBlX25jb2hbMl07CisJCXN0cnVjdCBtdXRl
eCBpb19yZXNlcnZlX211dGV4OworCQlzdHJ1Y3QgbGlzdF9oZWFkIGlvX3Jlc2VydmVfbHJ1Owog
CX0gdHRtOwogCiAJLyogR0VNIGludGVyZmFjZSBzdXBwb3J0ICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZl
YXUvbm91dmVhdV90dG0uYwppbmRleCA1M2M2Zjg4MjczMjIuLmE2MmYzN2IxMTMxYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV90dG0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jCkBAIC0xMjMsMTMgKzEyMyw1MSBAQCBjb25z
dCBzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXJfZnVuYyBudjA0X2dhcnRfbWFuYWdlciA9IHsK
IAkuZnJlZSA9IG5vdXZlYXVfbWFuYWdlcl9kZWwsCiB9OwogCitzdGF0aWMgdm1fZmF1bHRfdCBu
b3V2ZWF1X3R0bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKK3sKKwlzdHJ1Y3Qgdm1fYXJl
YV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOworCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8g
PSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKKwlwZ3Byb3RfdCBwcm90OworCXZtX2ZhdWx0X3QgcmV0
OworCisJcmV0ID0gdHRtX2JvX3ZtX3Jlc2VydmUoYm8sIHZtZik7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKworCW5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KGJvKTsKKworCXByb3Qg
PSB2bV9nZXRfcGFnZV9wcm90KHZtYS0+dm1fZmxhZ3MpOworCXJldCA9IHR0bV9ib192bV9mYXVs
dF9yZXNlcnZlZCh2bWYsIHByb3QsIFRUTV9CT19WTV9OVU1fUFJFRkFVTFQsIDEpOworCWlmIChy
ZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9O
T1dBSVQpKQorCQlyZXR1cm4gcmV0OworCisJbm91dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUo
Ym8pOworCisJZG1hX3Jlc3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOworCisJcmV0dXJuIHJldDsK
K30KKworc3RhdGljIHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVjdCBub3V2ZWF1X3R0bV92bV9v
cHMgPSB7CisJLmZhdWx0ID0gbm91dmVhdV90dG1fZmF1bHQsCisJLm9wZW4gPSB0dG1fYm9fdm1f
b3BlbiwKKwkuY2xvc2UgPSB0dG1fYm9fdm1fY2xvc2UsCisJLmFjY2VzcyA9IHR0bV9ib192bV9h
Y2Nlc3MKK307CisKIGludAogbm91dmVhdV90dG1fbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3Ry
dWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCiB7CiAJc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYg
PSBmaWxwLT5wcml2YXRlX2RhdGE7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1
X2RybShmaWxlX3ByaXYtPm1pbm9yLT5kZXYpOworCWludCByZXQ7CiAKLQlyZXR1cm4gdHRtX2Jv
X21tYXAoZmlscCwgdm1hLCAmZHJtLT50dG0uYmRldik7CisJcmV0ID0gdHRtX2JvX21tYXAoZmls
cCwgdm1hLCAmZHJtLT50dG0uYmRldik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXZt
YS0+dm1fb3BzID0gJm5vdXZlYXVfdHRtX3ZtX29wczsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGlj
IGludApAQCAtMTczLDcgKzIxMSw2IEBAIG5vdXZlYXVfdHRtX2luaXRfdnJhbShzdHJ1Y3Qgbm91
dmVhdV9kcm0gKmRybSkKIAkJfQogCiAJCW1hbi0+ZnVuYyA9ICZub3V2ZWF1X3ZyYW1fbWFuYWdl
cjsKLQkJbWFuLT51c2VfaW9fcmVzZXJ2ZV9scnUgPSB0cnVlOwogCiAJCXR0bV9yZXNvdXJjZV9t
YW5hZ2VyX2luaXQobWFuLAogCQkJCQkgIGRybS0+Z2VtLnZyYW1fYXZhaWxhYmxlID4+IFBBR0Vf
U0hJRlQpOwpAQCAtMzM5LDYgKzM3Niw5IEBAIG5vdXZlYXVfdHRtX2luaXQoc3RydWN0IG5vdXZl
YXVfZHJtICpkcm0pCiAJCXJldHVybiByZXQ7CiAJfQogCisJbXV0ZXhfaW5pdCgmZHJtLT50dG0u
aW9fcmVzZXJ2ZV9tdXRleCk7CisJSU5JVF9MSVNUX0hFQUQoJmRybS0+dHRtLmlvX3Jlc2VydmVf
bHJ1KTsKKwogCU5WX0lORk8oZHJtLCAiVlJBTTogJWQgTWlCXG4iLCAodTMyKShkcm0tPmdlbS52
cmFtX2F2YWlsYWJsZSA+PiAyMCkpOwogCU5WX0lORk8oZHJtLCAiR0FSVDogJWQgTWlCXG4iLCAo
dTMyKShkcm0tPmdlbS5nYXJ0X2F2YWlsYWJsZSA+PiAyMCkpOwogCXJldHVybiAwOwotLSAKMi4x
Ny4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
