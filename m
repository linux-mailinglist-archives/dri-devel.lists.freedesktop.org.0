Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DBC6E10FE00
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 13:48:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5CF536E4D0;
	Tue,  3 Dec 2019 12:48:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx0a-0014ca01.pphosted.com (mx0a-0014ca01.pphosted.com
 [208.84.65.235])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E86836E03F
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 10:40:41 +0000 (UTC)
Received: from pps.filterd (m0042385.ppops.net [127.0.0.1])
 by mx0a-0014ca01.pphosted.com (8.16.0.42/8.16.0.42) with SMTP id
 xB3ACEa4020558; Tue, 3 Dec 2019 02:16:52 -0800
Received: from nam05-co1-obe.outbound.protection.outlook.com
 (mail-co1nam05lp2051.outbound.protection.outlook.com [104.47.48.51])
 by mx0a-0014ca01.pphosted.com with ESMTP id 2wknv0ukg8-1
 (version=TLSv1.2 cipher=ECDHE-RSA-AES256-GCM-SHA384 bits=256 verify=NOT);
 Tue, 03 Dec 2019 02:16:52 -0800
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=JQ44PcHKOhSR7E9876iMJ/mpgJ1juU7uL+uImAaQlsOI4xzN4Xsq3favRP6Wzyaxi627l1KBUoS6n1n0yKM4pOcz5N6bpv2h8QqWjU9UqGkBwtMVn9bxw7KhrhMRa7jHhnEBdNzzKKbY0c/y1aWFQ7r1edEjtLkar2TG4zj/ax7+hWGCKC1clTY6bHVXoOAOmMH3BmRx66Y1K1Cj78QrcgIwWVAHq6EMZ+jtawkz8K2ubfxjrAu6kZ3AZLxGylUkmEJzTvplOZQwoc0iEXX7Y2Piv/ZuJP0lhxG7oRuY13TDjew07CifckhkEhGqu0mkZtr1f2ALEBWkpcTZKMghOQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=7OMRVP48SlgOqJVFypVHk7vscgdMexA1dnyCw35Kc2E=;
 b=PW3FJvCdGq+8QC74rOiWYNUzIKpLhBvEsINME2POdkfrxrfvQzEEmQ6BgLm/TZvGLtNvSesblzw/DCKp37tj+Z85bZNEyGsSyu9EDP+drDchW3dTqpzxQ4M+FpxfN3RE7xVAMZpTb2FifoPDLqMUB4RN3gAZrkXjtMy66QlSLLH7+40xSTLZ03ETKg/uQCOT6erkyURTDiFyVKl3XLHl/Y+odYcYkcnYaCF2srIlhLVAPmwFCypRl7ZyFNyjrn50c+UdDbRerNLdauVqTlwUUimc45w5M7X4//Hl0b6dv4Qb7QNdDLPmMGhGRBP19xwcF4Rv/DmUabIXWm5bq+hb+A==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=softfail (sender ip
 is 199.43.4.28) smtp.rcpttodomain=ti.com smtp.mailfrom=cadence.com;
 dmarc=fail (p=none sp=none pct=100) action=none header.from=cadence.com;
 dkim=none (message not signed); arc=none
Received: from SN4PR0701CA0021.namprd07.prod.outlook.com
 (2603:10b6:803:28::31) by BL0PR07MB5636.namprd07.prod.outlook.com
 (2603:10b6:208:8c::28) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2495.22; Tue, 3 Dec
 2019 10:16:49 +0000
Received: from MW2NAM12FT065.eop-nam12.prod.protection.outlook.com
 (2a01:111:f400:fe5a::209) by SN4PR0701CA0021.outlook.office365.com
 (2603:10b6:803:28::31) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2495.18 via Frontend
 Transport; Tue, 3 Dec 2019 10:16:49 +0000
Received-SPF: SoftFail (protection.outlook.com: domain of transitioning
 cadence.com discourages use of 199.43.4.28 as permitted sender)
Received: from rmmaillnx1.cadence.com (199.43.4.28) by
 MW2NAM12FT065.mail.protection.outlook.com (10.13.180.181) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2495.18 via Frontend Transport; Tue, 3 Dec 2019 10:16:48 +0000
Received: from maileu3.global.cadence.com (maileu3.cadence.com [10.160.88.99])
 by rmmaillnx1.cadence.com (8.14.4/8.14.4) with ESMTP id
 xB3AGg8j006738
 (version=TLSv1/SSLv3 cipher=AES256-SHA bits=256 verify=OK);
 Tue, 3 Dec 2019 05:16:46 -0500
X-CrossPremisesHeadersFilteredBySendConnector: maileu3.global.cadence.com
Received: from maileu3.global.cadence.com (10.160.88.99) by
 maileu3.global.cadence.com (10.160.88.99) with Microsoft SMTP Server (TLS) id
 15.0.1367.3; Tue, 3 Dec 2019 11:16:42 +0100
Received: from vleu-orange.cadence.com (10.160.88.83) by
 maileu3.global.cadence.com (10.160.88.99) with Microsoft SMTP Server (TLS) id
 15.0.1367.3 via Frontend Transport; Tue, 3 Dec 2019 11:16:42 +0100
Received: from vleu-orange.cadence.com (localhost.localdomain [127.0.0.1])
 by vleu-orange.cadence.com (8.14.4/8.14.4) with ESMTP id xB3AGg73001540;
 Tue, 3 Dec 2019 11:16:42 +0100
Received: (from yamonkar@localhost)
 by vleu-orange.cadence.com (8.14.4/8.14.4/Submit) id xB3AGgQS001534;
 Tue, 3 Dec 2019 11:16:42 +0100
From: Yuti Amonkar <yamonkar@cadence.com>
To: <dri-devel@lists.freedesktop.org>
Subject: [PATCH v1 2/3] drm: bridge: Add support for Cadence MHDP DPI/DP bridge
Date: Tue, 3 Dec 2019 11:16:05 +0100
Message-ID: <1575368166-861-3-git-send-email-yamonkar@cadence.com>
X-Mailer: git-send-email 2.4.5
In-Reply-To: <1575368166-861-1-git-send-email-yamonkar@cadence.com>
References: <1575368166-861-1-git-send-email-yamonkar@cadence.com>
MIME-Version: 1.0
X-OrganizationHeadersPreserved: maileu3.global.cadence.com
X-EOPAttributedMessage: 0
X-Forefront-Antispam-Report: CIP:199.43.4.28; IPV:CAL; SCL:-1; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(346002)(376002)(39860400002)(396003)(136003)(36092001)(199004)(189003)(316002)(51416003)(50466002)(6666004)(70586007)(305945005)(70206006)(8676002)(81156014)(6916009)(5024004)(50226002)(14444005)(76130400001)(30864003)(2906002)(5660300002)(107886003)(356004)(36756003)(42186006)(87636003)(16586007)(48376002)(86362001)(76176011)(81166006)(8936002)(4326008)(26826003)(478600001)(446003)(426003)(11346002)(336012)(2351001)(186003)(54906003)(2616005)(26005)(21314003)(579004)(569006);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BL0PR07MB5636; H:rmmaillnx1.cadence.com; FPR:;
 SPF:SoftFail; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 066a568b-2505-4400-b179-08d777d9e868
X-MS-TrafficTypeDiagnostic: BL0PR07MB5636:
X-Microsoft-Antispam-PRVS: <BL0PR07MB563607757C7DB57CFE8EBA12D2420@BL0PR07MB5636.namprd07.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:972;
X-Forefront-PRVS: 02408926C4
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: uweTXV5FCR2reMrndVRuXqN/NB8+E7GFEBzLrh77GKC0j+eJV+eeBZWH+w9hJ/QX1TY/8agTQLr8gSTE3u9TElIWRL3Lr6+dLErBaayp8YZqM1Bu9Ng+JKqfR7FvnmulCWRTwlo3SziIGP6cGtWDnaLBIeUYz2laRfe/+1XPaX+GFzvbkuWJXO3Vc+1V3h9ZV+kf/hYMy8QOrFG5BVHXd5OqtHsrnkv68kQPlcLx7DD28tR8z6DkQT0TUqhOq6vcHyX2J93hQueJP7Da4OMdUXokur5sgKXnzN5BECTNbPBcgL3IPw2GZZYqVofob7MMZ+6q+ggCw3waSBtZfsbYqU5hg2O1lp2ZGL/7Ma0Q3BrLFMRGB8W76R6zPQQFNtJAy93HTVM5F3evmcVn0Xe9C8ycWuCgtuZTOcQ+5bynGmFS2RXF6zLINJ9oc9KkDXdL
X-OriginatorOrg: cadence.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 03 Dec 2019 10:16:48.5559 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 066a568b-2505-4400-b179-08d777d9e868
X-MS-Exchange-CrossTenant-Id: d36035c5-6ce6-4662-a3dc-e762e61ae4c9
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=d36035c5-6ce6-4662-a3dc-e762e61ae4c9; Ip=[199.43.4.28];
 Helo=[rmmaillnx1.cadence.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BL0PR07MB5636
X-Proofpoint-Virus-Version: vendor=fsecure engine=2.50.10434:6.0.95,18.0.572
 definitions=2019-12-03_02:2019-11-29,2019-12-03 signatures=0
X-Proofpoint-Spam-Details: rule=outbound_check_notspam policy=outbound_check
 score=0 adultscore=0
 spamscore=0 suspectscore=4 clxscore=1015 mlxlogscore=999 phishscore=0
 impostorscore=0 malwarescore=0 bulkscore=0 lowpriorityscore=0
 priorityscore=1501 mlxscore=0 classifier=spam adjust=0 reason=mlx
 scancount=1 engine=8.12.0-1910280000 definitions=main-1912030082
X-Mailman-Approved-At: Tue, 03 Dec 2019 12:48:27 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=cadence.com; h=from : to : cc :
 subject : date : message-id : in-reply-to : references : mime-version :
 content-type; s=proofpoint;
 bh=7OMRVP48SlgOqJVFypVHk7vscgdMexA1dnyCw35Kc2E=;
 b=KbZ5EBKergCguSMUD3F9hvDjOZx3TKYaSzspMcTWTlwcd4lt1270ttaGPhAAeVr6ZSCT
 AS0uWqctMr+dP2IyuqHG7XUGGOF6mHyePARX3uRqCqox/ou8EKiKzI+byL+nOOSycmPE
 G3XR4OkS7fYd04aL00nSMfjr4hbJqVqj+dYNypzy21ihNh1bZIKWhSpGRgHpKUZV+RgC
 2oRIcka6Nv121CDT9Jp9XHxo4zYr/DrboUJwDd2oYTH9w6XFI9xpIegc1AdwhMdm9RvI
 s49XSY1kpsGuVye3KBhVdZu4qCBhGwKUtGerH1ji8BOffgrE2H/ANRVJZcvnPa8ASe96 PQ== 
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=cadence.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=7OMRVP48SlgOqJVFypVHk7vscgdMexA1dnyCw35Kc2E=;
 b=lRkqUHOBbNXIVRmdm3D1J7kP4KG2Jvnjx5HwKveqAJ1w7hFRRoEGHUJYeU48siUeF5JD48VQisG9mbBH1YPtU4qbxFd+hW7XsjwrQkdsMWxjDLqKpc4JppTFkU/CyaMEwbm+XaeURHoesK5G2fQ+bAcYlWu+LmuXAxQhAHgViFg=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: mparab@cadence.com, yamonkar@cadence.com, praneeth@ti.com,
 dkangude@cadence.com, jsarha@ti.com, tomi.valkeinen@ti.com,
 sjakhade@cadence.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBhZGRzIG5ldyBEUk0gZHJpdmVyIGZvciBDYWRlbmNlIE1IRFAgRFBUWCBJUCB1
c2VkIG9uIEo3MjFlIFNvQy4KTUhEUCBEUFRYIElQIGlzIHRoZSBjb21wb25lbnQgdGhhdCBjb21w
bGllcyB3aXRoIFZFU0EgRGlzcGxheVBvcnQgKERQKSBhbmQKZW1iZWRkZWQgRGlzcGxheSBQb3J0
IChlRFApIHN0YW5kYXJkcy5JdCBpbnRlZ3JhdGVzIENQUCAodUNQVSkgcnVubmluZyB0aGUKZW1i
ZWRkZWQgRmlybXdhcmUoRlcpIGludGVyZmFjZWQgb3ZlciBBUEIgaW50ZXJmYWNlLgpCYXNpY2Fs
bHksIGl0IHRha2VzIGEgRFBJIHN0cmVhbSBhcyBpbnB1dCBhbmQgb3V0cHV0IGl0IGVuY29kZWQg
aW4gRFAKZm9ybWF0LiBDdXJyZW50bHksIGl0IHN1cHBvcnRzIG9ubHkgU1NUIG1vZGUuCgpTaWdu
ZWQtb2ZmLWJ5OiBZdXRpIEFtb25rYXIgPHlhbW9ua2FyQGNhZGVuY2UuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvS2NvbmZpZyAgICAgfCAgIDExICsKIGRyaXZlcnMvZ3B1L2RybS9i
cmlkZ2UvTWFrZWZpbGUgICAgfCAgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvY2Rucy1t
aGRwLmMgfCAyMjMxICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9jZG5zLW1oZHAuaCB8ICAzODAgKysrKysrCiA0IGZpbGVzIGNoYW5n
ZWQsIDI2MjUgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9icmlkZ2UvY2Rucy1taGRwLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0v
YnJpZGdlL2NkbnMtbWhkcC5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9L
Y29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9LY29uZmlnCmluZGV4IDM0MzYyOTcuLjYx
NmMwNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvS2NvbmZpZworKysgYi9k
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL0tjb25maWcKQEAgLTM3LDYgKzM3LDE3IEBAIGNvbmZpZyBE
Uk1fQ0ROU19EU0kKIAkgIFN1cHBvcnQgQ2FkZW5jZSBEUEkgdG8gRFNJIGJyaWRnZS4gVGhpcyBp
cyBhbiBpbnRlcm5hbAogCSAgYnJpZGdlIGFuZCBpcyBtZWFudCB0byBiZSBkaXJlY3RseSBlbWJl
ZGRlZCBpbiBhIFNvQy4KIAorY29uZmlnIERSTV9DRE5TX01IRFAKKwl0cmlzdGF0ZSAiQ2FkZW5j
ZSBEUEkvRFAgYnJpZGdlIgorCXNlbGVjdCBEUk1fS01TX0hFTFBFUgorCXNlbGVjdCBEUk1fUEFO
RUxfQlJJREdFCisJZGVwZW5kcyBvbiBPRgorCWhlbHAKKwkgIFN1cHBvcnQgQ2FkZW5jZSBEUEkg
dG8gRFAgYnJpZGdlLiBUaGlzIGlzIGFuIGludGVybmFsCisJICBicmlkZ2UgYW5kIGlzIG1lYW50
IHRvIGJlIGRpcmVjdGx5IGVtYmVkZGVkIGluIGEgU29DLgorCSAgSXQgdGFrZXMgYSBEUEkgc3Ry
ZWFtIGFzIGlucHV0IGFuZCBvdXRwdXQgaXQgZW5jb2RlZAorCSAgaW4gRFAgZm9ybWF0LgorCiBj
b25maWcgRFJNX0RVTUJfVkdBX0RBQwogCXRyaXN0YXRlICJEdW1iIFZHQSBEQUMgQnJpZGdlIHN1
cHBvcnQiCiAJZGVwZW5kcyBvbiBPRgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRn
ZS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvTWFrZWZpbGUKaW5kZXggNDkzNGZj
Zi4uYzFhMGRhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9NYWtlZmlsZQor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL01ha2VmaWxlCkBAIC0xNiw0ICsxNiw3IEBAIG9i
ai0kKENPTkZJR19EUk1fQU5BTE9HSVhfRFApICs9IGFuYWxvZ2l4Lwogb2JqLSQoQ09ORklHX0RS
TV9JMkNfQURWNzUxMSkgKz0gYWR2NzUxMS8KIG9iai0kKENPTkZJR19EUk1fVElfU042NURTSTg2
KSArPSB0aS1zbjY1ZHNpODYubwogb2JqLSQoQ09ORklHX0RSTV9USV9URlA0MTApICs9IHRpLXRm
cDQxMC5vCitvYmotJChDT05GSUdfRFJNX0NETlNfTUhEUCkgKz0gbWhkcDg1NDYubwogb2JqLXkg
Kz0gc3lub3BzeXMvCisKK21oZHA4NTQ2LW9ianMgOj0gY2Rucy1taGRwLm8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvY2Rucy1taGRwLmMgYi9kcml2ZXJzL2dwdS9kcm0vYnJp
ZGdlL2NkbnMtbWhkcC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjQyNDY4
ZTEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2NkbnMtbWhkcC5j
CkBAIC0wLDAgKzEsMjIzMSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAK
Ky8qCisgKiBDYWRlbmNlIE1IRFAgRFAgYnJpZGdlIGRyaXZlci4KKyAqCisgKiBDb3B5cmlnaHQ6
IDIwMTkgQ2FkZW5jZSBEZXNpZ24gU3lzdGVtcywgSW5jLgorICoKKyAqIEF1dGhvcjogUXVlbnRp
biBTY2h1bHogPHF1ZW50aW4uc2NodWx6QGZyZWUtZWxlY3Ryb25zLmNvbT4KKyAqLworCisjaW5j
bHVkZSA8bGludXgvY2xrLmg+CisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxs
aW51eC9lcnIuaD4KKyNpbmNsdWRlIDxsaW51eC9maXJtd2FyZS5oPgorI2luY2x1ZGUgPGxpbnV4
L2lvLmg+CisjaW5jbHVkZSA8bGludXgvaW9wb2xsLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxl
Lmg+CisjaW5jbHVkZSA8bGludXgvb2YuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZp
Y2UuaD4KKyNpbmNsdWRlIDxsaW51eC9waHkvcGh5Lmg+CisjaW5jbHVkZSA8bGludXgvcGh5L3Bo
eS1kcC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRv
bWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fYnJpZGdlLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGNfaGVscGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9kcF9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzZXRfaGVs
cGVyX3Z0YWJsZXMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9wcm9iZV9oZWxwZXIuaD4KKworI2luY2x1ZGUgPGxpbnV4L2lycS5oPgorI2luY2x1ZGUg
PGxpbnV4L29mX2lycS5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgorCisjaW5jbHVk
ZSA8YXNtL3VuYWxpZ25lZC5oPgorCisjaW5jbHVkZSAiY2Rucy1taGRwLmgiCisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIG1oZHBfaWRzW10gPSB7CisJeyAuY29tcGF0aWJsZSA9
ICJjZG5zLG1oZHA4NTQ2IiwgfSwKKwl7IC8qIHNlbnRpbmVsICovIH0KK307CitNT0RVTEVfREVW
SUNFX1RBQkxFKG9mLCBtaGRwX2lkcyk7CisKK3N0YXRpYyBpbmxpbmUgdTMyIGdldF91bmFsaWdu
ZWRfYmUyNChjb25zdCB2b2lkICpwKQoreworCWNvbnN0IHU4ICpfcCA9IHA7CisKKwlyZXR1cm4g
X3BbMF0gPDwgMTYgfCBfcFsxXSA8PCA4IHwgX3BbMl07Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9p
ZCBwdXRfdW5hbGlnbmVkX2JlMjQodTMyIHZhbCwgdm9pZCAqcCkKK3sKKwl1OCAqX3AgPSBwOwor
CisJX3BbMF0gPSB2YWwgPj4gMTY7CisJX3BbMV0gPSB2YWwgPj4gODsKKwlfcFsyXSA9IHZhbDsK
K30KKworc3RhdGljIGludCBjZG5zX21oZHBfbWFpbGJveF9yZWFkKHN0cnVjdCBjZG5zX21oZHBf
ZGV2aWNlICptaGRwKQoreworCWludCB2YWwsIHJldDsKKworCVdBUk5fT04oIW11dGV4X2lzX2xv
Y2tlZCgmbWhkcC0+bWJveF9tdXRleCkpOworCisJcmV0ID0gcmVhZHhfcG9sbF90aW1lb3V0KHJl
YWRsLCBtaGRwLT5yZWdzICsgQ0ROU19NQUlMQk9YX0VNUFRZLAorCQkJCSB2YWwsICF2YWwsIE1B
SUxCT1hfUkVUUllfVVMsCisJCQkJIE1BSUxCT1hfVElNRU9VVF9VUyk7CisJaWYgKHJldCA8IDAp
CisJCXJldHVybiByZXQ7CisKKwlyZXR1cm4gcmVhZGwobWhkcC0+cmVncyArIENETlNfTUFJTEJP
WF9SWF9EQVRBKSAmIDB4ZmY7Cit9CisKK3N0YXRpYyBpbnQgY2Ruc19kcF9tYWlsYm94X3dyaXRl
KHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwLCB1OCB2YWwpCit7CisJaW50IHJldCwgZnVs
bDsKKworCVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmbWhkcC0+bWJveF9tdXRleCkpOworCisJ
cmV0ID0gcmVhZHhfcG9sbF90aW1lb3V0KHJlYWRsLCBtaGRwLT5yZWdzICsgQ0ROU19NQUlMQk9Y
X0ZVTEwsCisJCQkJIGZ1bGwsICFmdWxsLCBNQUlMQk9YX1JFVFJZX1VTLAorCQkJCSBNQUlMQk9Y
X1RJTUVPVVRfVVMpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJd3JpdGVsKHZh
bCwgbWhkcC0+cmVncyArIENETlNfTUFJTEJPWF9UWF9EQVRBKTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IGNkbnNfbWhkcF9tYWlsYm94X3ZhbGlkYXRlX3JlY2VpdmUoc3RydWN0IGNk
bnNfbWhkcF9kZXZpY2UgKm1oZHAsCisJCQkJCSAgICAgIHU4IG1vZHVsZV9pZCwgdTggb3Bjb2Rl
LAorCQkJCQkgICAgICB1MTYgcmVxX3NpemUpCit7CisJdTMyIG1ib3hfc2l6ZSwgaTsKKwl1OCBo
ZWFkZXJbNF07CisJaW50IHJldDsKKworCS8qIHJlYWQgdGhlIGhlYWRlciBvZiB0aGUgbWVzc2Fn
ZSAqLworCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspIHsKKwkJcmV0ID0gY2Ruc19taGRwX21haWxi
b3hfcmVhZChtaGRwKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0OworCisJCWhlYWRl
cltpXSA9IHJldDsKKwl9CisKKwltYm94X3NpemUgPSBnZXRfdW5hbGlnbmVkX2JlMTYoaGVhZGVy
ICsgMik7CisKKwlpZiAob3Bjb2RlICE9IGhlYWRlclswXSB8fCBtb2R1bGVfaWQgIT0gaGVhZGVy
WzFdIHx8CisJICAgIHJlcV9zaXplICE9IG1ib3hfc2l6ZSkgeworCQkvKgorCQkgKiBJZiB0aGUg
bWVzc2FnZSBpbiBtYWlsYm94IGlzIG5vdCB3aGF0IHdlIHdhbnQsIHdlIG5lZWQgdG8KKwkJICog
Y2xlYXIgdGhlIG1haWxib3ggYnkgcmVhZGluZyBpdHMgY29udGVudHMuCisJCSAqLworCQlmb3Ig
KGkgPSAwOyBpIDwgbWJveF9zaXplOyBpKyspCisJCQlpZiAoY2Ruc19taGRwX21haWxib3hfcmVh
ZChtaGRwKSA8IDApCisJCQkJYnJlYWs7CisKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY2Ruc19taGRwX21haWxib3hfcmVhZF9yZWNlaXZlKHN0
cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwLAorCQkJCQkgIHU4ICpidWZmLCB1MTYgYnVmZl9z
aXplKQoreworCXUzMiBpOworCWludCByZXQ7CisKKwlmb3IgKGkgPSAwOyBpIDwgYnVmZl9zaXpl
OyBpKyspIHsKKwkJcmV0ID0gY2Ruc19taGRwX21haWxib3hfcmVhZChtaGRwKTsKKwkJaWYgKHJl
dCA8IDApCisJCQlyZXR1cm4gcmV0OworCisJCWJ1ZmZbaV0gPSByZXQ7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgY2Ruc19taGRwX21haWxib3hfc2VuZChzdHJ1Y3QgY2Ruc19t
aGRwX2RldmljZSAqbWhkcCwgdTggbW9kdWxlX2lkLAorCQkJCSAgdTggb3Bjb2RlLCB1MTYgc2l6
ZSwgdTggKm1lc3NhZ2UpCit7CisJdTggaGVhZGVyWzRdOworCWludCByZXQsIGk7CisKKwloZWFk
ZXJbMF0gPSBvcGNvZGU7CisJaGVhZGVyWzFdID0gbW9kdWxlX2lkOworCXB1dF91bmFsaWduZWRf
YmUxNihzaXplLCBoZWFkZXIgKyAyKTsKKworCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspIHsKKwkJ
cmV0ID0gY2Ruc19kcF9tYWlsYm94X3dyaXRlKG1oZHAsIGhlYWRlcltpXSk7CisJCWlmIChyZXQp
CisJCQlyZXR1cm4gcmV0OworCX0KKworCWZvciAoaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKKwkJ
cmV0ID0gY2Ruc19kcF9tYWlsYm94X3dyaXRlKG1oZHAsIG1lc3NhZ2VbaV0pOworCQlpZiAocmV0
KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljCitpbnQgY2Ru
c19taGRwX3JlZ19yZWFkKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwLCB1MzIgYWRkciwg
dTMyICp2YWx1ZSkKK3sKKwl1OCBtc2dbNF0sIHJlc3BbOF07CisJaW50IHJldDsKKworCWlmIChh
ZGRyID09IDApIHsKKwkJcmV0ID0gLUVJTlZBTDsKKwkJZ290byBlcnJfcmVnX3JlYWQ7CisJfQor
CisJcHV0X3VuYWxpZ25lZF9iZTMyKGFkZHIsIG1zZyk7CisKKwltdXRleF9sb2NrKCZtaGRwLT5t
Ym94X211dGV4KTsKKworCXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3NlbmQobWhkcCwgTUJfTU9E
VUxFX0lEX0dFTkVSQUwsCisJCQkJICAgICBHRU5FUkFMX1JFR0lTVEVSX1JFQUQsCisJCQkJICAg
ICBzaXplb2YobXNnKSwgbXNnKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9yZWdfcmVhZDsKKwor
CXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3ZhbGlkYXRlX3JlY2VpdmUobWhkcCwgTUJfTU9EVUxF
X0lEX0dFTkVSQUwsCisJCQkJCQkgR0VORVJBTF9SRUdJU1RFUl9SRUFELAorCQkJCQkJIHNpemVv
ZihyZXNwKSk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfcmVnX3JlYWQ7CisKKwlyZXQgPSBjZG5z
X21oZHBfbWFpbGJveF9yZWFkX3JlY2VpdmUobWhkcCwgcmVzcCwgc2l6ZW9mKHJlc3ApKTsKKwlp
ZiAocmV0KQorCQlnb3RvIGVycl9yZWdfcmVhZDsKKworCS8qIFJldHVybmVkIGFkZHJlc3MgdmFs
dWUgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHJlcXVlc3RlZCAqLworCWlmIChtZW1jbXAobXNnLCBy
ZXNwLCBzaXplb2YobXNnKSkpIHsKKwkJcmV0ID0gLUVJTlZBTDsKKwkJZ290byBlcnJfcmVnX3Jl
YWQ7CisJfQorCisJKnZhbHVlID0gZ2V0X3VuYWxpZ25lZF9iZTMyKHJlc3AgKyA0KTsKKworZXJy
X3JlZ19yZWFkOgorCW11dGV4X3VubG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisJaWYgKHJldCkg
eworCQlEUk1fREVWX0VSUk9SKG1oZHAtPmRldiwgIkZhaWxlZCB0byByZWFkIHJlZ2lzdGVyLlxu
Iik7CisJCSp2YWx1ZSA9IDA7CisJfQorCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljCitpbnQg
Y2Ruc19taGRwX3JlZ193cml0ZShzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCwgdTE2IGFk
ZHIsIHUzMiB2YWwpCit7CisJdTggbXNnWzZdOworCWludCByZXQ7CisKKwlwdXRfdW5hbGlnbmVk
X2JlMTYoYWRkciwgbXNnKTsKKwlwdXRfdW5hbGlnbmVkX2JlMzIodmFsLCBtc2cgKyAyKTsKKwor
CW11dGV4X2xvY2soJm1oZHAtPm1ib3hfbXV0ZXgpOworCisJcmV0ID0gY2Ruc19taGRwX21haWxi
b3hfc2VuZChtaGRwLCBNQl9NT0RVTEVfSURfRFBfVFgsCisJCQkJICAgICBEUFRYX1dSSVRFX1JF
R0lTVEVSLCBzaXplb2YobXNnKSwgbXNnKTsKKworCW11dGV4X3VubG9jaygmbWhkcC0+bWJveF9t
dXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMKK2ludCBjZG5zX21oZHBfcmVnX3dy
aXRlX2JpdChzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCwgdTE2IGFkZHIsCisJCQkgICAg
dTggc3RhcnRfYml0LCB1OCBiaXRzX25vLCB1MzIgdmFsKQoreworCXU4IGZpZWxkWzhdOworCWlu
dCByZXQ7CisKKwlwdXRfdW5hbGlnbmVkX2JlMTYoYWRkciwgZmllbGQpOworCWZpZWxkWzJdID0g
c3RhcnRfYml0OworCWZpZWxkWzNdID0gYml0c19ubzsKKwlwdXRfdW5hbGlnbmVkX2JlMzIodmFs
LCBmaWVsZCArIDQpOworCisJbXV0ZXhfbG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlyZXQg
PSBjZG5zX21oZHBfbWFpbGJveF9zZW5kKG1oZHAsIE1CX01PRFVMRV9JRF9EUF9UWCwKKwkJCQkg
ICAgIERQVFhfV1JJVEVfRklFTEQsIHNpemVvZihmaWVsZCksIGZpZWxkKTsKKworCW11dGV4X3Vu
bG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMKK2lu
dCBjZG5zX21oZHBfZHBjZF9yZWFkKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwLAorCQkJ
dTMyIGFkZHIsIHU4ICpkYXRhLCB1MTYgbGVuKQoreworCXU4IG1zZ1s1XSwgcmVnWzVdOworCWlu
dCByZXQ7CisKKwlwdXRfdW5hbGlnbmVkX2JlMTYobGVuLCBtc2cpOworCXB1dF91bmFsaWduZWRf
YmUyNChhZGRyLCBtc2cgKyAyKTsKKworCW11dGV4X2xvY2soJm1oZHAtPm1ib3hfbXV0ZXgpOwor
CisJcmV0ID0gY2Ruc19taGRwX21haWxib3hfc2VuZChtaGRwLCBNQl9NT0RVTEVfSURfRFBfVFgs
CisJCQkJICAgICBEUFRYX1JFQURfRFBDRCwgc2l6ZW9mKG1zZyksIG1zZyk7CisJaWYgKHJldCkK
KwkJZ290byBlcnJfZHBjZF9yZWFkOworCisJcmV0ID0gY2Ruc19taGRwX21haWxib3hfdmFsaWRh
dGVfcmVjZWl2ZShtaGRwLCBNQl9NT0RVTEVfSURfRFBfVFgsCisJCQkJCQkgRFBUWF9SRUFEX0RQ
Q0QsCisJCQkJCQkgc2l6ZW9mKHJlZykgKyBsZW4pOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2Rw
Y2RfcmVhZDsKKworCXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3JlYWRfcmVjZWl2ZShtaGRwLCBy
ZWcsIHNpemVvZihyZWcpKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9kcGNkX3JlYWQ7CisKKwly
ZXQgPSBjZG5zX21oZHBfbWFpbGJveF9yZWFkX3JlY2VpdmUobWhkcCwgZGF0YSwgbGVuKTsKKwor
ZXJyX2RwY2RfcmVhZDoKKwltdXRleF91bmxvY2soJm1oZHAtPm1ib3hfbXV0ZXgpOworCisJcmV0
dXJuIHJldDsKK30KKworc3RhdGljCitpbnQgY2Ruc19taGRwX2RwY2Rfd3JpdGUoc3RydWN0IGNk
bnNfbWhkcF9kZXZpY2UgKm1oZHAsIHUzMiBhZGRyLCB1OCB2YWx1ZSkKK3sKKwl1OCBtc2dbNl0s
IHJlZ1s1XTsKKwlpbnQgcmV0OworCisJcHV0X3VuYWxpZ25lZF9iZTE2KDEsIG1zZyk7CisJcHV0
X3VuYWxpZ25lZF9iZTI0KGFkZHIsIG1zZyArIDIpOworCW1zZ1s1XSA9IHZhbHVlOworCisJbXV0
ZXhfbG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlyZXQgPSBjZG5zX21oZHBfbWFpbGJveF9z
ZW5kKG1oZHAsIE1CX01PRFVMRV9JRF9EUF9UWCwKKwkJCQkgICAgIERQVFhfV1JJVEVfRFBDRCwg
c2l6ZW9mKG1zZyksIG1zZyk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZHBjZF93cml0ZTsKKwor
CXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3ZhbGlkYXRlX3JlY2VpdmUobWhkcCwgTUJfTU9EVUxF
X0lEX0RQX1RYLAorCQkJCQkJIERQVFhfV1JJVEVfRFBDRCwgc2l6ZW9mKHJlZykpOworCWlmIChy
ZXQpCisJCWdvdG8gZXJyX2RwY2Rfd3JpdGU7CisKKwlyZXQgPSBjZG5zX21oZHBfbWFpbGJveF9y
ZWFkX3JlY2VpdmUobWhkcCwgcmVnLCBzaXplb2YocmVnKSk7CisJaWYgKHJldCkKKwkJZ290byBl
cnJfZHBjZF93cml0ZTsKKworCWlmIChhZGRyICE9IGdldF91bmFsaWduZWRfYmUyNChyZWcgKyAy
KSkKKwkJcmV0ID0gLUVJTlZBTDsKKworZXJyX2RwY2Rfd3JpdGU6CisJbXV0ZXhfdW5sb2NrKCZt
aGRwLT5tYm94X211dGV4KTsKKworCWlmIChyZXQpCisJCURSTV9ERVZfRVJST1IobWhkcC0+ZGV2
LCAiZHBjZCB3cml0ZSBmYWlsZWQ6ICVkXG4iLCByZXQpOworCXJldHVybiByZXQ7Cit9CisKK3N0
YXRpYworaW50IGNkbnNfbWhkcF9zZXRfZmlybXdhcmVfYWN0aXZlKHN0cnVjdCBjZG5zX21oZHBf
ZGV2aWNlICptaGRwLCBib29sIGVuYWJsZSkKK3sKKwl1OCBtc2dbNV07CisJaW50IHJldCwgaTsK
KworCW1zZ1swXSA9IEdFTkVSQUxfTUFJTl9DT05UUk9MOworCW1zZ1sxXSA9IE1CX01PRFVMRV9J
RF9HRU5FUkFMOworCW1zZ1syXSA9IDA7CisJbXNnWzNdID0gMTsKKwltc2dbNF0gPSBlbmFibGUg
PyBGV19BQ1RJVkUgOiBGV19TVEFOREJZOworCisJbXV0ZXhfbG9jaygmbWhkcC0+bWJveF9tdXRl
eCk7CisKKwlmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKG1zZyk7IGkrKykgeworCQlyZXQgPSBjZG5z
X2RwX21haWxib3hfd3JpdGUobWhkcCwgbXNnW2ldKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gZXJy
X3NldF9maXJtd2FyZV9hY3RpdmU7CisJfQorCisJLyogcmVhZCB0aGUgZmlybXdhcmUgc3RhdGUg
Ki8KKwlmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKG1zZyk7IGkrKykgIHsKKwkJcmV0ID0gY2Ruc19t
aGRwX21haWxib3hfcmVhZChtaGRwKTsKKwkJaWYgKHJldCA8IDApCisJCQlnb3RvIGVycl9zZXRf
ZmlybXdhcmVfYWN0aXZlOworCisJCW1zZ1tpXSA9IHJldDsKKwl9CisKKwlyZXQgPSAwOworCitl
cnJfc2V0X2Zpcm13YXJlX2FjdGl2ZToKKwltdXRleF91bmxvY2soJm1oZHAtPm1ib3hfbXV0ZXgp
OworCisJaWYgKHJldCA8IDApCisJCURSTV9ERVZfRVJST1IobWhkcC0+ZGV2LCAic2V0IGZpcm13
YXJlIGFjdGl2ZSBmYWlsZWRcbiIpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYworaW50IGNk
bnNfbWhkcF9nZXRfaHBkX3N0YXR1cyhzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCkKK3sK
Kwl1OCBzdGF0dXM7CisJaW50IHJldDsKKworCW11dGV4X2xvY2soJm1oZHAtPm1ib3hfbXV0ZXgp
OworCisJcmV0ID0gY2Ruc19taGRwX21haWxib3hfc2VuZChtaGRwLCBNQl9NT0RVTEVfSURfRFBf
VFgsCisJCQkJICAgICBEUFRYX0hQRF9TVEFURSwgMCwgTlVMTCk7CisJaWYgKHJldCkKKwkJZ290
byBlcnJfZ2V0X2hwZDsKKworCXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3ZhbGlkYXRlX3JlY2Vp
dmUobWhkcCwgTUJfTU9EVUxFX0lEX0RQX1RYLAorCQkJCQkJIERQVFhfSFBEX1NUQVRFLAorCQkJ
CQkJIHNpemVvZihzdGF0dXMpKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9nZXRfaHBkOworCisJ
cmV0ID0gY2Ruc19taGRwX21haWxib3hfcmVhZF9yZWNlaXZlKG1oZHAsICZzdGF0dXMsIHNpemVv
ZihzdGF0dXMpKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9nZXRfaHBkOworCisJbXV0ZXhfdW5s
b2NrKCZtaGRwLT5tYm94X211dGV4KTsKKworCXJldHVybiBzdGF0dXM7CisKK2Vycl9nZXRfaHBk
OgorCW11dGV4X3VubG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlEUk1fREVWX0VSUk9SKG1o
ZHAtPmRldiwgImdldCBocGQgc3RhdHVzIGZhaWxlZDogJWRcbiIsIHJldCk7CisJcmV0dXJuIHJl
dDsKK30KKworc3RhdGljCitpbnQgY2Ruc19taGRwX2dldF9lZGlkX2Jsb2NrKHZvaWQgKmRhdGEs
IHU4ICplZGlkLAorCQkJICAgICB1bnNpZ25lZCBpbnQgYmxvY2ssIHNpemVfdCBsZW5ndGgpCit7
CisJc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAgPSBkYXRhOworCXU4IG1zZ1syXSwgcmVn
WzJdLCBpOworCWludCByZXQ7CisKKwltdXRleF9sb2NrKCZtaGRwLT5tYm94X211dGV4KTsKKwor
CWZvciAoaSA9IDA7IGkgPCA0OyBpKyspIHsKKwkJbXNnWzBdID0gYmxvY2sgLyAyOworCQltc2db
MV0gPSBibG9jayAlIDI7CisKKwkJcmV0ID0gY2Ruc19taGRwX21haWxib3hfc2VuZChtaGRwLCBN
Ql9NT0RVTEVfSURfRFBfVFgsCisJCQkJCSAgICAgRFBUWF9HRVRfRURJRCwgc2l6ZW9mKG1zZyks
IG1zZyk7CisJCWlmIChyZXQpCisJCQljb250aW51ZTsKKworCQlyZXQgPSBjZG5zX21oZHBfbWFp
bGJveF92YWxpZGF0ZV9yZWNlaXZlKG1oZHAsCisJCQkJCQkJIE1CX01PRFVMRV9JRF9EUF9UWCwK
KwkJCQkJCQkgRFBUWF9HRVRfRURJRCwKKwkJCQkJCQkgc2l6ZW9mKHJlZykgKyBsZW5ndGgpOwor
CQlpZiAocmV0KQorCQkJY29udGludWU7CisKKwkJcmV0ID0gY2Ruc19taGRwX21haWxib3hfcmVh
ZF9yZWNlaXZlKG1oZHAsIHJlZywgc2l6ZW9mKHJlZykpOworCQlpZiAocmV0KQorCQkJY29udGlu
dWU7CisKKwkJcmV0ID0gY2Ruc19taGRwX21haWxib3hfcmVhZF9yZWNlaXZlKG1oZHAsIGVkaWQs
IGxlbmd0aCk7CisJCWlmIChyZXQpCisJCQljb250aW51ZTsKKworCQlpZiAocmVnWzBdID09IGxl
bmd0aCAmJiByZWdbMV0gPT0gYmxvY2sgLyAyKQorCQkJYnJlYWs7CisJfQorCisJbXV0ZXhfdW5s
b2NrKCZtaGRwLT5tYm94X211dGV4KTsKKworCWlmIChyZXQpCisJCURSTV9ERVZfRVJST1IobWhk
cC0+ZGV2LCAiZ2V0IGJsb2NrWyVkXSBlZGlkIGZhaWxlZDogJWRcbiIsCisJCQkgICAgICBibG9j
aywgcmV0KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYworaW50IGNkbnNfbWhkcF9yZWFk
X2V2ZW50KHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwKQoreworCXU4IGV2ZW50ID0gMDsK
KwlpbnQgcmV0OworCisJbXV0ZXhfbG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlyZXQgPSBj
ZG5zX21oZHBfbWFpbGJveF9zZW5kKG1oZHAsIE1CX01PRFVMRV9JRF9EUF9UWCwKKwkJCQkgICAg
IERQVFhfUkVBRF9FVkVOVCwgMCwgTlVMTCk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwly
ZXQgPSBjZG5zX21oZHBfbWFpbGJveF92YWxpZGF0ZV9yZWNlaXZlKG1oZHAsCisJCQkJCQkgTUJf
TU9EVUxFX0lEX0RQX1RYLAorCQkJCQkJIERQVFhfUkVBRF9FVkVOVCwKKwkJCQkJCSBzaXplb2Yo
ZXZlbnQpKTsKKwlpZiAocmV0IDwgMCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjZG5zX21oZHBf
bWFpbGJveF9yZWFkX3JlY2VpdmUobWhkcCwgJmV2ZW50LAorCQkJCQkgICAgIHNpemVvZihldmVu
dCkpOworb3V0OgorCW11dGV4X3VubG9jaygmbWhkcC0+bWJveF9tdXRleCk7CisKKwlpZiAocmV0
IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiBldmVudDsKK30KKworc3RhdGljCitpbnQg
Y2Ruc19taGRwX2FkanVzdF9sdChzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCwKKwkJCXU4
IG5sYW5lcywgdTE2IHVkZWxheSwgdTggKmxhbmVzX2RhdGEsIHU4ICpsaW5rX3N0YXR1cykKK3sK
Kwl1OCBwYXlsb2FkWzddOworCXU4IGhkcls1XTsgLyogRm9yIERQQ0QgcmVhZCByZXNwb25zZSBo
ZWFkZXIgKi8KKwl1MzIgYWRkcjsKKwl1OCBjb25zdCBucmVncyA9IDY7IC8qIFJlZ2lzdGVycyAw
eDIwMi0weDIwNyAqLworCWludCByZXQ7CisKKwlpZiAobmxhbmVzICE9IDQgJiYgbmxhbmVzICE9
IDIgJiYgbmxhbmVzICE9IDEpIHsKKwkJRFJNX0RFVl9FUlJPUihtaGRwLT5kZXYsICJpbnZhbGlk
IG51bWJlciBvZiBsYW5lczogJWRcbiIsCisJCQkgICAgICBubGFuZXMpOworCQlyZXQgPSAtRUlO
VkFMOworCQlnb3RvIGVycl9hZGp1c3RfbHQ7CisJfQorCisJcGF5bG9hZFswXSA9IG5sYW5lczsK
KwlwdXRfdW5hbGlnbmVkX2JlMTYodWRlbGF5LCBwYXlsb2FkICsgMSk7CisJbWVtY3B5KHBheWxv
YWQgKyAzLCBsYW5lc19kYXRhLCBubGFuZXMpOworCisJbXV0ZXhfbG9jaygmbWhkcC0+bWJveF9t
dXRleCk7CisKKwlyZXQgPSBjZG5zX21oZHBfbWFpbGJveF9zZW5kKG1oZHAsIE1CX01PRFVMRV9J
RF9EUF9UWCwKKwkJCQkgICAgIERQVFhfQURKVVNUX0xULAorCQkJCSAgICAgc2l6ZW9mKHBheWxv
YWQpLCBwYXlsb2FkKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9hZGp1c3RfbHQ7CisKKwkvKiBZ
ZXMsIHJlYWQgdGhlIERQQ0QgcmVhZCBjb21tYW5kIHJlc3BvbnNlICovCisJcmV0ID0gY2Ruc19t
aGRwX21haWxib3hfdmFsaWRhdGVfcmVjZWl2ZShtaGRwLCBNQl9NT0RVTEVfSURfRFBfVFgsCisJ
CQkJCQkgRFBUWF9SRUFEX0RQQ0QsCisJCQkJCQkgc2l6ZW9mKGhkcikgKyBucmVncyk7CisJaWYg
KHJldCkKKwkJZ290byBlcnJfYWRqdXN0X2x0OworCisJcmV0ID0gY2Ruc19taGRwX21haWxib3hf
cmVhZF9yZWNlaXZlKG1oZHAsIGhkciwgc2l6ZW9mKGhkcikpOworCWlmIChyZXQpCisJCWdvdG8g
ZXJyX2FkanVzdF9sdDsKKworCWFkZHIgPSBnZXRfdW5hbGlnbmVkX2JlMjQoaGRyICsgMik7CisJ
aWYgKGFkZHIgIT0gRFBfTEFORTBfMV9TVEFUVVMpCisJCWdvdG8gZXJyX2FkanVzdF9sdDsKKwor
CXJldCA9IGNkbnNfbWhkcF9tYWlsYm94X3JlYWRfcmVjZWl2ZShtaGRwLCBsaW5rX3N0YXR1cywg
bnJlZ3MpOworCitlcnJfYWRqdXN0X2x0OgorCW11dGV4X3VubG9jaygmbWhkcC0+bWJveF9tdXRl
eCk7CisKKwlpZiAocmV0KQorCQlEUk1fREVWX0VSUk9SKG1oZHAtPmRldiwgIkZhaWxlZCB0byBh
ZGp1c3QgTGluayBUcmFpbmluZy5cbiIpOworCisJcmV0dXJuIHJldDsKK30KKworLyoqCisgKiBj
ZG5zX21oZHBfbGlua19wcm9iZSgpIC0gcHJvYmUgYSBEaXNwbGF5UG9ydCBsaW5rIGZvciBjYXBh
YmlsaXRpZXMKKyAqIEBhdXg6IERpc3BsYXlQb3J0IEFVWCBjaGFubmVsCisgKiBAbGluazogcG9p
bnRlciB0byBzdHJ1Y3R1cmUgaW4gd2hpY2ggdG8gcmV0dXJuIGxpbmsgY2FwYWJpbGl0aWVzCisg
KgorICogVGhlIHN0cnVjdHVyZSBmaWxsZWQgaW4gYnkgdGhpcyBmdW5jdGlvbiBjYW4gdXN1YWxs
eSBiZSBwYXNzZWQgZGlyZWN0bHkKKyAqIGludG8gY2Ruc19taGRwX2xpbmtfcG93ZXJfdXAoKSBh
bmQgY2Ruc19taGRwX2xpbmtfY29uZmlndXJlKCkgdG8gcG93ZXIgdXAgYW5kCisgKiBjb25maWd1
cmUgdGhlIGxpbmsgYmFzZWQgb24gdGhlIGxpbmsncyBjYXBhYmlsaXRpZXMuCisgKgorICogUmV0
dXJucyAwIG9uIHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisg
Ki8KK3N0YXRpYworaW50IGNkbnNfbWhkcF9saW5rX3Byb2JlKHN0cnVjdCBkcm1fZHBfYXV4ICph
dXgsIHN0cnVjdCBjZG5zX21oZHBfbGluayAqbGluaykKK3sKKwl1OCB2YWx1ZXNbM107CisJaW50
IGVycjsKKworCW1lbXNldChsaW5rLCAwLCBzaXplb2YoKmxpbmspKTsKKworCWVyciA9IGRybV9k
cF9kcGNkX3JlYWQoYXV4LCBEUF9EUENEX1JFViwgdmFsdWVzLCBzaXplb2YodmFsdWVzKSk7CisJ
aWYgKGVyciA8IDApCisJCXJldHVybiBlcnI7CisKKwlsaW5rLT5yZXZpc2lvbiA9IHZhbHVlc1sw
XTsKKwlsaW5rLT5yYXRlID0gZHJtX2RwX2J3X2NvZGVfdG9fbGlua19yYXRlKHZhbHVlc1sxXSk7
CisJbGluay0+bnVtX2xhbmVzID0gdmFsdWVzWzJdICYgRFBfTUFYX0xBTkVfQ09VTlRfTUFTSzsK
KworCWlmICh2YWx1ZXNbMl0gJiBEUF9FTkhBTkNFRF9GUkFNRV9DQVApCisJCWxpbmstPmNhcGFi
aWxpdGllcyB8PSBEUF9MSU5LX0NBUF9FTkhBTkNFRF9GUkFNSU5HOworCisJcmV0dXJuIDA7Cit9
CisKKy8qKgorICogY2Ruc19taGRwX2xpbmtfcG93ZXJfdXAoKSAtIHBvd2VyIHVwIGEgRGlzcGxh
eVBvcnQgbGluaworICogQGF1eDogRGlzcGxheVBvcnQgQVVYIGNoYW5uZWwKKyAqIEBsaW5rOiBw
b2ludGVyIHRvIGEgc3RydWN0dXJlIGNvbnRhaW5pbmcgdGhlIGxpbmsgY29uZmlndXJhdGlvbgor
ICoKKyAqIFJldHVybnMgMCBvbiBzdWNjZXNzIG9yIGEgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBm
YWlsdXJlLgorICovCitzdGF0aWMKK2ludCBjZG5zX21oZHBfbGlua19wb3dlcl91cChzdHJ1Y3Qg
ZHJtX2RwX2F1eCAqYXV4LCBzdHJ1Y3QgY2Ruc19taGRwX2xpbmsgKmxpbmspCit7CisJdTggdmFs
dWU7CisJaW50IGVycjsKKworCS8qIERQX1NFVF9QT1dFUiByZWdpc3RlciBpcyBvbmx5IGF2YWls
YWJsZSBvbiBEUENEIHYxLjEgYW5kIGxhdGVyICovCisJaWYgKGxpbmstPnJldmlzaW9uIDwgMHgx
MSkKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBkcm1fZHBfZHBjZF9yZWFkYihhdXgsIERQX1NFVF9Q
T1dFUiwgJnZhbHVlKTsKKwlpZiAoZXJyIDwgMCkKKwkJcmV0dXJuIGVycjsKKworCXZhbHVlICY9
IH5EUF9TRVRfUE9XRVJfTUFTSzsKKwl2YWx1ZSB8PSBEUF9TRVRfUE9XRVJfRDA7CisKKwllcnIg
PSBkcm1fZHBfZHBjZF93cml0ZWIoYXV4LCBEUF9TRVRfUE9XRVIsIHZhbHVlKTsKKwlpZiAoZXJy
IDwgMCkKKwkJcmV0dXJuIGVycjsKKworCS8qCisJICogQWNjb3JkaW5nIHRvIHRoZSBEUCAxLjEg
c3BlY2lmaWNhdGlvbiwgYSAiU2luayBEZXZpY2UgbXVzdCBleGl0IHRoZQorCSAqIHBvd2VyIHNh
dmluZyBzdGF0ZSB3aXRoaW4gMSBtcyIgKFNlY3Rpb24gMi41LjMuMSwgVGFibGUgNS01MiwgIlNp
bmsKKwkgKiBDb250cm9sIEZpZWxkIiAocmVnaXN0ZXIgMHg2MDApLgorCSAqLworCXVzbGVlcF9y
YW5nZSgxMDAwLCAyMDAwKTsKKworCXJldHVybiAwOworfQorCisvKioKKyAqIGNkbnNfbWhkcF9s
aW5rX3Bvd2VyX2Rvd24oKSAtIHBvd2VyIGRvd24gYSBEaXNwbGF5UG9ydCBsaW5rCisgKiBAYXV4
OiBEaXNwbGF5UG9ydCBBVVggY2hhbm5lbAorICogQGxpbms6IHBvaW50ZXIgdG8gYSBzdHJ1Y3R1
cmUgY29udGFpbmluZyB0aGUgbGluayBjb25maWd1cmF0aW9uCisgKgorICogUmV0dXJucyAwIG9u
IHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisgKi8KK3N0YXRp
YworaW50IGNkbnNfbWhkcF9saW5rX3Bvd2VyX2Rvd24oc3RydWN0IGRybV9kcF9hdXggKmF1eCwK
KwkJCSAgICAgIHN0cnVjdCBjZG5zX21oZHBfbGluayAqbGluaykKK3sKKwl1OCB2YWx1ZTsKKwlp
bnQgZXJyOworCisJLyogRFBfU0VUX1BPV0VSIHJlZ2lzdGVyIGlzIG9ubHkgYXZhaWxhYmxlIG9u
IERQQ0QgdjEuMSBhbmQgbGF0ZXIgKi8KKwlpZiAobGluay0+cmV2aXNpb24gPCAweDExKQorCQly
ZXR1cm4gMDsKKworCWVyciA9IGRybV9kcF9kcGNkX3JlYWRiKGF1eCwgRFBfU0VUX1BPV0VSLCAm
dmFsdWUpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJdmFsdWUgJj0gfkRQX1NF
VF9QT1dFUl9NQVNLOworCXZhbHVlIHw9IERQX1NFVF9QT1dFUl9EMzsKKworCWVyciA9IGRybV9k
cF9kcGNkX3dyaXRlYihhdXgsIERQX1NFVF9QT1dFUiwgdmFsdWUpOworCWlmIChlcnIgPCAwKQor
CQlyZXR1cm4gZXJyOworCisJcmV0dXJuIDA7Cit9CisKKy8qKgorICogY2Ruc19taGRwX2xpbmtf
Y29uZmlndXJlKCkgLSBjb25maWd1cmUgYSBEaXNwbGF5UG9ydCBsaW5rCisgKiBAYXV4OiBEaXNw
bGF5UG9ydCBBVVggY2hhbm5lbAorICogQGxpbms6IHBvaW50ZXIgdG8gYSBzdHJ1Y3R1cmUgY29u
dGFpbmluZyB0aGUgbGluayBjb25maWd1cmF0aW9uCisgKgorICogUmV0dXJucyAwIG9uIHN1Y2Nl
c3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCisgKi8KK3N0YXRpYworaW50
IGNkbnNfbWhkcF9saW5rX2NvbmZpZ3VyZShzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LAorCQkJICAg
ICBzdHJ1Y3QgY2Ruc19taGRwX2xpbmsgKmxpbmspCit7CisJdTggdmFsdWVzWzJdOworCWludCBl
cnI7CisKKwl2YWx1ZXNbMF0gPSBkcm1fZHBfbGlua19yYXRlX3RvX2J3X2NvZGUobGluay0+cmF0
ZSk7CisJdmFsdWVzWzFdID0gbGluay0+bnVtX2xhbmVzOworCisJaWYgKGxpbmstPmNhcGFiaWxp
dGllcyAmIERQX0xJTktfQ0FQX0VOSEFOQ0VEX0ZSQU1JTkcpCisJCXZhbHVlc1sxXSB8PSBEUF9M
QU5FX0NPVU5UX0VOSEFOQ0VEX0ZSQU1FX0VOOworCisJZXJyID0gZHJtX2RwX2RwY2Rfd3JpdGUo
YXV4LCBEUF9MSU5LX0JXX1NFVCwgdmFsdWVzLCBzaXplb2YodmFsdWVzKSk7CisJaWYgKGVyciA8
IDApCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHVuc2lnbmVkIGlu
dCBtaGRwX21heF9saW5rX3JhdGUoc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHApCit7CisJ
cmV0dXJuIG1pbihtaGRwLT5ob3N0LmxpbmtfcmF0ZSwgbWhkcC0+c2luay5saW5rX3JhdGUpOwor
fQorCitzdGF0aWMgdTggbWhkcF9tYXhfbnVtX2xhbmVzKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNl
ICptaGRwKQoreworCXJldHVybiBtaW5fdCh1OCwgbWhkcC0+c2luay5sYW5lc19jbnQsIG1oZHAt
Pmhvc3QubGFuZXNfY250KTsKK30KKworc3RhdGljIHU4IG1oZHBfZXFfdHJhaW5pbmdfcGF0dGVy
bl9zdXBwb3J0ZWQoc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHApCit7CisJcmV0dXJuIGZs
cyhtaGRwLT5ob3N0LnBhdHRlcm5fc3VwcCAmIG1oZHAtPnNpbmsucGF0dGVybl9zdXBwKTsKK30K
Kworc3RhdGljIGJvb2wgbWhkcF9nZXRfc3NjX3N1cHBvcnRlZChzdHJ1Y3QgY2Ruc19taGRwX2Rl
dmljZSAqbWhkcCkKK3sKKwkvKiBDaGVjayBpZiBTU0MgaXMgc3VwcG9ydGVkIGJ5IGJvdGggc2lk
ZXMgKi8KKwlyZXR1cm4gKG1oZHAtPmhvc3Quc3NjKSAmJiAobWhkcC0+c2luay5zc2MpOworfQor
CitzdGF0aWMgaW50IG1oZHBfZndfYWN0aXZhdGUoY29uc3Qgc3RydWN0IGZpcm13YXJlICpmdywK
KwkJCSAgICBzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCkKK3sKKwl1bnNpZ25lZCBpbnQg
cmVnOworCWludCByZXQgPSAwOworCisJZGV2X2RiZyhtaGRwLT5kZXYsICIlc1xuIiwgX19mdW5j
X18pOworCisJaWYgKCFmdyB8fCAhZnctPmRhdGEpIHsKKwkJZGV2X2VycihtaGRwLT5kZXYsICIl
czogTm8gZmlybXdhcmUuXG4iLCBfX2Z1bmNfXyk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwor
CXNwaW5fbG9jaygmbWhkcC0+c3RhcnRfbG9jayk7CisJaWYgKG1oZHAtPmh3X3N0YXRlICE9IE1I
RFBfSFdfSU5BQ1RJVkUpIHsKKwkJc3Bpbl91bmxvY2soJm1oZHAtPnN0YXJ0X2xvY2spOworCQlp
ZiAobWhkcC0+aHdfc3RhdGUgIT0gTUhEUF9IV19TVE9QUEVEKQorCQkJZGV2X2VycihtaGRwLT5k
ZXYsICIlczogQmFkIEhXIHN0YXRlOiAlZFxuIiwKKwkJCQlfX2Z1bmNfXywgbWhkcC0+aHdfc3Rh
dGUpOworCQlyZXR1cm4gLUVCVVNZOworCX0KKwltaGRwLT5od19zdGF0ZSA9IE1IRFBfSFdfTE9B
RElORzsKKwlzcGluX3VubG9jaygmbWhkcC0+c3RhcnRfbG9jayk7CisKKwkvKiBSZWxlYXNlIHVD
UFUgcmVzZXQgYW5kIHN0YWxsIGl0LiAqLworCXdyaXRlbChDRE5TX0NQVV9TVEFMTCwgbWhkcC0+
cmVncyArIENETlNfQVBCX0NUUkwpOworCisJbWVtY3B5X3RvaW8obWhkcC0+cmVncyArIENETlNf
TUhEUF9JTUVNLCBmdy0+ZGF0YSwgZnctPnNpemUpOworCisJLyogTGVhdmUgZGVidWcgbW9kZSwg
cmVsZWFzZSBzdGFsbCAqLworCXdyaXRlbCgwLCBtaGRwLT5yZWdzICsgQ0ROU19BUEJfQ1RSTCk7
CisKKwkvKgorCSAqIFdhaXQgZm9yIHRoZSBLRUVQX0FMSVZFICJtZXNzYWdlIiBvbiB0aGUgZmly
c3QgOCBiaXRzLgorCSAqIFVwZGF0ZWQgZWFjaCBzY2hlZCAidGljayIgKH4ybXMpCisJICovCisJ
cmV0ID0gcmVhZGxfcG9sbF90aW1lb3V0KG1oZHAtPnJlZ3MgKyBDRE5TX0tFRVBfQUxJVkUsIHJl
ZywKKwkJCQkgcmVnICYgQ0ROU19LRUVQX0FMSVZFX01BU0ssIDUwMCwKKwkJCQkgQ0ROU19LRUVQ
X0FMSVZFX1RJTUVPVVQpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihtaGRwLT5kZXYsCisJCQki
ZGV2aWNlIGRpZG4ndCBnaXZlIGFueSBsaWZlIHNpZ246IHJlZyAlZFxuIiwgcmVnKTsKKwkJZ290
byBlcnJvcjsKKwl9CisKKwkvKiBJbml0IGV2ZW50cyB0byAwIGFzIGl0J3Mgbm90IGNsZWFyZWQg
YnkgRlcgYXQgYm9vdCBidXQgb24gcmVhZCAqLworCXJlYWRsKG1oZHAtPnJlZ3MgKyBDRE5TX1NX
X0VWRU5UMCk7CisJcmVhZGwobWhkcC0+cmVncyArIENETlNfU1dfRVZFTlQxKTsKKwlyZWFkbCht
aGRwLT5yZWdzICsgQ0ROU19TV19FVkVOVDIpOworCXJlYWRsKG1oZHAtPnJlZ3MgKyBDRE5TX1NX
X0VWRU5UMyk7CisKKwkvKiBBY3RpdmF0ZSB1Q1BVICovCisJcmV0ID0gY2Ruc19taGRwX3NldF9m
aXJtd2FyZV9hY3RpdmUobWhkcCwgdHJ1ZSk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKG1oZHAt
PmRldiwgIiVzOiBGYWlsZWQgdG8gYWN0aXZhdGUgRlc6ICVkXG4iLAorCQkJX19mdW5jX18sIHJl
dCk7CisJCWdvdG8gZXJyb3I7CisJfQorCisJc3Bpbl9sb2NrKCZtaGRwLT5zdGFydF9sb2NrKTsK
KworCW1oZHAtPmh3X3N0YXRlID0gTUhEUF9IV19SRUFEWTsKKworCS8qCisJICogSGVyZSB3ZSBt
dXN0IGtlZXAgdGhlIGxvY2sgd2hpbGUgZW5hYmxpbmcgdGhlIGludGVycnVwdHMKKwkgKiBzaW5j
ZSBpdCB3b3VsZCBvdGhlcndpc2UgYmUgcG9zc2libGUgdGhhdCBpbnRlcnJ1cHQgZW5hYmxlCisJ
ICogY29kZSBpcyBleGVjdXRlZCBhZnRlciB0aGUgYnJpZGdlIGlzIGRldGFjaGVkLiBUaGUgc2lt
aWxhcgorCSAqIHNpdHVhdGlvbiBpcyBub3QgcG9zc2libGUgaW4gYXR0YWNoKCkvZGV0YWNoKCkg
Y2FsbGJhY2tzCisJICogc2luY2UgdGhlIGh3X3N0YXRlIGNoYW5nZXMgZnJvbSBNSERQX0hXX1JF
QURZIHRvCisJICogTUhEUF9IV19TVE9QUEVEIGhhcHBlbnMgb25seSBkdWUgdG8gZHJpdmVyIHJl
bW92YWwgd2hlbgorCSAqIGJyaWRnZSBzaG91bGQgYWxyZWFkeSBiZSBkZXRhY2hlZC4KKwkgKi8K
KwlpZiAobWhkcC0+YnJpZGdlX2F0dGFjaGVkKSB7CisJCS8qIGVuYWJsZSBpbnRlcnJ1cHRzICov
CisJCXdyaXRlbCgwLCBtaGRwLT5yZWdzICsgQ0ROU19BUEJfSU5UX01BU0spOworCQl3cml0ZWwo
MCwgbWhkcC0+cmVncyArIENETlNfTUJfSU5UX01BU0spOworCX0KKworCXNwaW5fdW5sb2NrKCZt
aGRwLT5zdGFydF9sb2NrKTsKKworCWRldl9kYmcobWhkcC0+ZGV2LCAiRFAgRlcgYWN0aXZhdGVk
XG4iKTsKKworCXJldHVybiAwOworZXJyb3I6CisJc3Bpbl9sb2NrKCZtaGRwLT5zdGFydF9sb2Nr
KTsKKwltaGRwLT5od19zdGF0ZSA9IE1IRFBfSFdfSU5BQ1RJVkU7CisJc3Bpbl91bmxvY2soJm1o
ZHAtPnN0YXJ0X2xvY2spOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgbWhkcF9m
d19jYihjb25zdCBzdHJ1Y3QgZmlybXdhcmUgKmZ3LCB2b2lkICpjb250ZXh0KQoreworCXN0cnVj
dCBjZG5zX21oZHBfZGV2aWNlICptaGRwID0gY29udGV4dDsKKwlib29sIGJyaWRnZV9hdHRhY2hl
ZDsKKwlpbnQgcmV0OworCisJZGV2X2RiZyhtaGRwLT5kZXYsICJmaXJtd2FyZSBjYWxsYmFja1xu
Iik7CisKKwlyZXQgPSBtaGRwX2Z3X2FjdGl2YXRlKGZ3LCBtaGRwKTsKKworCXJlbGVhc2VfZmly
bXdhcmUoZncpOworCisJaWYgKHJldCkKKwkJcmV0dXJuOworCisJLyoKKwkgKiAgWFhYIGhvdyB0
byBtYWtlIHN1cmUgdGhlIGJyaWRnZSBpcyBzdGlsbCBhdHRhY2hlZCB3aGVuCisJICogICAgICBj
YWxsaW5nIGRybV9rbXNfaGVscGVyX2hvdHBsdWdfZXZlbnQoKSBhZnRlciByZWxlYXNpbmcKKwkg
KiAgICAgIHRoZSBsb2NrPyBXZSBzaG91bGQgbm90IGhvbGQgdGhlIHNwaW4gbG9jayB3aGVuCisJ
ICogICAgICBjYWxsaW5nIGRybV9rbXNfaGVscGVyX2hvdHBsdWdfZXZlbnQoKSBzaW5jZSBpdCBt
YXkKKwkgKiAgICAgIGNhdXNlIGEgZGVhZCBsb2NrLiBGQi1kZXYgY29uc29sZSBjYWxscyBkZXRl
Y3QgZnJvbSB0aGUKKwkgKiAgICAgIHNhbWUgdGhyZWFkIGp1c3QgZG93biB0aGUgY2FsbCBzdGFj
ayBzdGFydGVkIGhlcmUuCisJICovCisJc3Bpbl9sb2NrKCZtaGRwLT5zdGFydF9sb2NrKTsKKwli
cmlkZ2VfYXR0YWNoZWQgPSBtaGRwLT5icmlkZ2VfYXR0YWNoZWQ7CisJc3Bpbl91bmxvY2soJm1o
ZHAtPnN0YXJ0X2xvY2spOworCWlmIChicmlkZ2VfYXR0YWNoZWQpCisJCWRybV9rbXNfaGVscGVy
X2hvdHBsdWdfZXZlbnQobWhkcC0+YnJpZGdlLmRldik7Cit9CisKK3N0YXRpYyBpbnQgbG9hZF9m
aXJtd2FyZShzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCkKK3sKKwlpbnQgcmV0OworCisJ
cmV0ID0gcmVxdWVzdF9maXJtd2FyZV9ub3dhaXQoVEhJU19NT0RVTEUsIHRydWUsIEZXX05BTUUs
IG1oZHAtPmRldiwKKwkJCQkgICAgICBHRlBfS0VSTkVMLCBtaGRwLCBtaGRwX2Z3X2NiKTsKKwlp
ZiAocmV0KSB7CisJCWRldl9lcnIobWhkcC0+ZGV2LCAiZmFpbGVkIHRvIGxvYWQgZmlybXdhcmUg
KCVzKSwgcmV0OiAlZFxuIiwKKwkJCUZXX05BTUUsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIG1oZHBfY2hlY2tfbGluayhzdHJ1Y3QgY2Ru
c19taGRwX2RldmljZSAqbWhkcCkKK3sKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubiA9ICZt
aGRwLT5jb25uZWN0b3I7CisJdTggc3RhdHVzW0RQX0xJTktfU1RBVFVTX1NJWkVdOworCWJvb2wg
aHBkX3N0YXRlOworCWludCBocGRfZXZlbnQ7CisJaW50IHJldDsKKworCS8qIE5vdGhpbmcgdG8g
Y2hlY2sgaWYgdGhlcmUgaXMgbm8gbGluayAqLworCWlmICghbWhkcC0+bGlua191cCkKKwkJcmV0
dXJuOworCisJaHBkX2V2ZW50ID0gY2Ruc19taGRwX3JlYWRfZXZlbnQobWhkcCk7CisKKwkvKiBH
ZXRpbmcgZXZlbnQgYml0cyBmYWlsZWQsIGJhaWwgb3V0ICovCisJaWYgKGhwZF9ldmVudCA8IDAp
IHsKKwkJZGV2X3dhcm4obWhkcC0+ZGV2LCAiJXM6IHJlYWQgZXZlbnQgZmFpbGVkOiAlZFxuIiwK
KwkJCSBfX2Z1bmNfXywgaHBkX2V2ZW50KTsKKwkJcmV0dXJuOworCX0KKworCWhwZF9zdGF0ZSA9
ICEhKGhwZF9ldmVudCAmIERQVFhfUkVBRF9FVkVOVF9IUERfU1RBVEUpOworCisJLyogTm8gcG9p
bnQgdGhlIGNoZWNrIHRoZSBsaW5rIGlmIEhQRCBpcyBkb3duIChjYWJsZSBpcyB1bnBsdWdnZWQp
ICovCisJaWYgKCFocGRfc3RhdGUpCisJCXJldHVybjsKKworCS8qCisJICogUHJldmVudCBkaXNw
bGF5IHJlY29uZmlndXJhdGlvbiBiZXR3ZWVuIGxpbmsgY2hlY2sgYW5kIGxpbmsKKwkgKiBzdGF0
dXMgcHJvcGVydHkgc2V0dGluZy4gV2UgbXVzdCB1c2UgdGhlIGxlZ2FjeSBnaWFudC1sb2NrCisJ
ICogc2luY2UgZHJtX2Nvbm5lY3Rvcl9zZXRfbGlua19zdGF0dXNfcHJvcGVydHkoKSdzIGZpbmUK
KwkgKiBncmFpbmVkIERSTSBsb2NraW5nIGltcGxlbWVudGF0aW9uIGlzIGJyb2tlbi4KKwkgKi8K
KwltdXRleF9sb2NrKCZjb25uLT5kZXYtPm1vZGVfY29uZmlnLm11dGV4KTsKKworCS8qIENoZWNr
IGlmIHRoZSBsaW5rIGlzIHN0aWxsIHVwICovCisJcmV0ID0gZHJtX2RwX2RwY2RfcmVhZF9saW5r
X3N0YXR1cygmbWhkcC0+YXV4LCBzdGF0dXMpOworCisJaWYgKHJldCA8IDAgfHwgLyogSWYgZHBj
ZCByZWFkIGZhaWxzLCBhc3N1bWUgdGhlIGxpbmsgaXMgZG93biB0b28gKi8KKwkgICAgIWRybV9k
cF9jaGFubmVsX2VxX29rKHN0YXR1cywgbWhkcC0+bGluay5udW1fbGFuZXMpIHx8CisJICAgICFk
cm1fZHBfY2xvY2tfcmVjb3Zlcnlfb2soc3RhdHVzLCBtaGRwLT5saW5rLm51bV9sYW5lcykpCisJ
CS8qIExpbmsgaXMgYnJva2VuLCBpbmRpY2F0ZSBpdCB3aXRoIHRoZSBsaW5rIHN0YXR1cyBwcm9w
ZXJ0eSAqLworCQlkcm1fY29ubmVjdG9yX3NldF9saW5rX3N0YXR1c19wcm9wZXJ0eShjb25uLAor
CQkJCQkJICAgICAgIERSTV9NT0RFX0xJTktfU1RBVFVTX0JBRCk7CisKKwltdXRleF91bmxvY2so
JmNvbm4tPmRldi0+bW9kZV9jb25maWcubXV0ZXgpOworfQorCitzdGF0aWMgaXJxcmV0dXJuX3Qg
bWhkcF9pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBjZG5zX21o
ZHBfZGV2aWNlICptaGRwID0gKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICopZGF0YTsKKwl1MzIg
bWJveF9zdGF0LCBhcGJfc3RhdCwgc3dfZXYwLCBzd19ldjEsIHN3X2V2Miwgc3dfZXYzOworCWJv
b2wgYnJpZGdlX2F0dGFjaGVkOworCisJYXBiX3N0YXQgPSByZWFkbChtaGRwLT5yZWdzICsgQ0RO
U19BUEJfSU5UX1NUQVRVUyk7CisJbWJveF9zdGF0ID0gcmVhZGwobWhkcC0+cmVncyArIENETlNf
TUJfSU5UX1NUQVRVUyk7CisJc3dfZXYwID0gcmVhZGwobWhkcC0+cmVncyArIENETlNfU1dfRVZF
TlQwKTsKKwlzd19ldjEgPSByZWFkbChtaGRwLT5yZWdzICsgQ0ROU19TV19FVkVOVDEpOworCXN3
X2V2MiA9IHJlYWRsKG1oZHAtPnJlZ3MgKyBDRE5TX1NXX0VWRU5UMik7CisJc3dfZXYzID0gcmVh
ZGwobWhkcC0+cmVncyArIENETlNfU1dfRVZFTlQzKTsKKworCS8qCisJICogIENhbGxpbmcgZHJt
X2ttc19oZWxwZXJfaG90cGx1Z19ldmVudCgpIHdoZW4gbm90IGF0dGFjaGVkCisJICogIHRvIGRy
bSBkZXZpY2UgY2F1c2VzIGFuIG9vcHMgYmVjYXVzZSB0aGUgZHJtX2JyaWRnZS0+ZGV2CisJICog
IGlzIE5VTEwuIFNlZSBtaGRwX2Z3X2NiKCkgY29tbWVudHMgZm9yIGRldGFpbHMgYWJvdXQgdGhl
CisJICogIHByb2JsZW1zIHJlbGF0ZWQgZHJtX2ttc19oZWxwZXJfaG90cGx1Z19ldmVudCgpIGNh
bGwuCisJICovCisJc3Bpbl9sb2NrKCZtaGRwLT5zdGFydF9sb2NrKTsKKwlicmlkZ2VfYXR0YWNo
ZWQgPSBtaGRwLT5icmlkZ2VfYXR0YWNoZWQ7CisJc3Bpbl91bmxvY2soJm1oZHAtPnN0YXJ0X2xv
Y2spOworCisJaWYgKGJyaWRnZV9hdHRhY2hlZCAmJiAoc3dfZXYwICYgQ0ROU19EUFRYX0hQRCkp
IHsKKwkJbWhkcF9jaGVja19saW5rKG1oZHApOworCisJCWRybV9rbXNfaGVscGVyX2hvdHBsdWdf
ZXZlbnQobWhkcC0+YnJpZGdlLmRldik7CisJfQorCisJcmV0dXJuIElSUV9IQU5ETEVEOworfQor
CitzdGF0aWMgc3NpemVfdCBtaGRwX3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCisJ
CQkgICAgIHN0cnVjdCBkcm1fZHBfYXV4X21zZyAqbXNnKQoreworCXN0cnVjdCBjZG5zX21oZHBf
ZGV2aWNlICptaGRwID0gZGV2X2dldF9kcnZkYXRhKGF1eC0+ZGV2KTsKKwlpbnQgcmV0OworCisJ
aWYgKG1zZy0+cmVxdWVzdCAhPSBEUF9BVVhfTkFUSVZFX1dSSVRFICYmCisJICAgIG1zZy0+cmVx
dWVzdCAhPSBEUF9BVVhfTkFUSVZFX1JFQUQpCisJCXJldHVybiAtRU5PVFNVUFA7CisKKwlpZiAo
bXNnLT5yZXF1ZXN0ID09IERQX0FVWF9OQVRJVkVfV1JJVEUpIHsKKwkJY29uc3QgdTggKmJ1ZiA9
IG1zZy0+YnVmZmVyOworCQlpbnQgaTsKKworCQlmb3IgKGkgPSAwOyBpIDwgbXNnLT5zaXplOyAr
K2kpIHsKKwkJCXJldCA9IGNkbnNfbWhkcF9kcGNkX3dyaXRlKG1oZHAsCisJCQkJCQkgICBtc2ct
PmFkZHJlc3MgKyBpLCBidWZbaV0pOworCQkJaWYgKCFyZXQpCisJCQkJY29udGludWU7CisKKwkJ
CURSTV9ERVZfRVJST1IobWhkcC0+ZGV2LCAiRmFpbGVkIHRvIHdyaXRlIERQQ0RcbiIpOworCisJ
CQlyZXR1cm4gcmV0OworCQl9CisJfSBlbHNlIHsKKwkJcmV0ID0gY2Ruc19taGRwX2RwY2RfcmVh
ZChtaGRwLCBtc2ctPmFkZHJlc3MsCisJCQkJCSAgbXNnLT5idWZmZXIsIG1zZy0+c2l6ZSk7CisJ
CWlmIChyZXQpIHsKKwkJCURSTV9ERVZfRVJST1IobWhkcC0+ZGV2LCAiRmFpbGVkIHRvIHJlYWQg
RFBDRFxuIik7CisKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKKwlyZXR1cm4gbXNnLT5zaXpl
OworfQorCitzdGF0aWMgaW50IGNkbnNfbWhkcF9nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCA9IGNvbm5l
Y3Rvcl90b19taGRwKGNvbm5lY3Rvcik7CisJc3RydWN0IGVkaWQgKmVkaWQ7CisJaW50IG51bV9t
b2RlczsKKworCWVkaWQgPSBkcm1fZG9fZ2V0X2VkaWQoY29ubmVjdG9yLCBjZG5zX21oZHBfZ2V0
X2VkaWRfYmxvY2ssIG1oZHApOworCWlmICghZWRpZCkgeworCQlEUk1fREVWX0VSUk9SKG1oZHAt
PmRldiwgIkZhaWxlZCB0byByZWFkIEVESURcbiIpOworCisJCXJldHVybiAwOworCX0KKworCWRy
bV9jb25uZWN0b3JfdXBkYXRlX2VkaWRfcHJvcGVydHkoY29ubmVjdG9yLCBlZGlkKTsKKwludW1f
bW9kZXMgPSBkcm1fYWRkX2VkaWRfbW9kZXMoY29ubmVjdG9yLCBlZGlkKTsKKwlrZnJlZShlZGlk
KTsKKworCS8qCisJICogSEFDSzogV2FybiBhYm91dCB1bnN1cHBvcnRlZCBkaXNwbGF5IGZvcm1h
dHMgdW50aWwgd2UgZGVhbAorCSAqICAgICAgIHdpdGggdGhlbSBjb3JyZWN0bHkuCisJICovCisJ
aWYgKGNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmNvbG9yX2Zvcm1hdHMgJiYKKwkgICAgIShjb25u
ZWN0b3ItPmRpc3BsYXlfaW5mby5jb2xvcl9mb3JtYXRzICYKKwkgICAgICBtaGRwLT5kaXNwbGF5
X2ZtdC5jb2xvcl9mb3JtYXQpKQorCQlkZXZfd2FybihtaGRwLT5kZXYsCisJCQkgIiVzOiBObyBz
dXBwb3J0ZWQgY29sb3JfZm9ybWF0IGZvdW5kICgweCUwOHgpXG4iLAorCQkJX19mdW5jX18sIGNv
bm5lY3Rvci0+ZGlzcGxheV9pbmZvLmNvbG9yX2Zvcm1hdHMpOworCisJaWYgKGNvbm5lY3Rvci0+
ZGlzcGxheV9pbmZvLmJwYyAmJgorCSAgICBjb25uZWN0b3ItPmRpc3BsYXlfaW5mby5icGMgPCBt
aGRwLT5kaXNwbGF5X2ZtdC5icGMpCisJCWRldl93YXJuKG1oZHAtPmRldiwgIiVzOiBEaXNwbGF5
IGJwYyBvbmx5ICVkIDwgJWRcbiIsCisJCQkgX19mdW5jX18sIGNvbm5lY3Rvci0+ZGlzcGxheV9p
bmZvLmJwYywKKwkJCSBtaGRwLT5kaXNwbGF5X2ZtdC5icGMpOworCisJcmV0dXJuIG51bV9tb2Rl
czsKK30KKworc3RhdGljIGludCBjZG5zX21oZHBfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uLAorCQkJICAgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4LAorCQkJ
ICAgIGJvb2wgZm9yY2UpCit7CisJc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAgPSBjb25u
ZWN0b3JfdG9fbWhkcChjb25uKTsKKwlib29sIGh3X3JlYWR5OworCWludCByZXQ7CisKKwlkZXZf
ZGJnKG1oZHAtPmRldiwgIiVzXG4iLCBfX2Z1bmNfXyk7CisKKwlzcGluX2xvY2soJm1oZHAtPnN0
YXJ0X2xvY2spOworCisJaHdfcmVhZHkgPSBtaGRwLT5od19zdGF0ZSA9PSBNSERQX0hXX1JFQURZ
OworCisJc3Bpbl91bmxvY2soJm1oZHAtPnN0YXJ0X2xvY2spOworCisJaWYgKCFod19yZWFkeSB8
fCBXQVJOX09OKCFtaGRwLT5icmlkZ2VfYXR0YWNoZWQpKQorCQlyZXR1cm4gY29ubmVjdG9yX3N0
YXR1c19kaXNjb25uZWN0ZWQ7CisKKwlyZXQgPSBjZG5zX21oZHBfZ2V0X2hwZF9zdGF0dXMobWhk
cCk7CisJaWYgKHJldCA+IDApIHsKKwkJbWhkcC0+cGx1Z2dlZCA9IHRydWU7CisJCXJldHVybiBj
b25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZDsKKwl9CisJaWYgKHJldCA8IDApCisJCWRldl9lcnIo
bWhkcC0+ZGV2LCAiRmFpbGVkIHRvIG9idGFpbiBIUEQgc3RhdGVcbiIpOworCisJbWhkcC0+cGx1
Z2dlZCA9IGZhbHNlOworCisJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVjdGVkOwor
fQorCitzdGF0aWMKK2Jvb2wgY2Ruc19taGRwX2JhbmR3aWR0aF9vayhzdHJ1Y3QgY2Ruc19taGRw
X2RldmljZSAqbWhkcCwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9k
ZSwKKwkJCSAgICBpbnQgbGFuZXMsIGludCByYXRlKQoreworCXUzMiBtYXhfYncsIHJlcV9idywg
YnBwOworCisJYnBwID0gY2Ruc19taGRwX2dldF9icHAoJm1oZHAtPmRpc3BsYXlfZm10KTsKKwly
ZXFfYncgPSBtb2RlLT5jbG9jayAqIGJwcCAvIDg7CisKKwltYXhfYncgPSBsYW5lcyAqIHJhdGU7
CisKKwlpZiAocmVxX2J3ID4gbWF4X2J3KSB7CisJCWRldl9kYmcobWhkcC0+ZGV2LCAiJXM6ICVz
ICgldSAqICV1LzggPSkgJXUgPiAldSAoPSAldSAqICV1KVxuIiwKKwkJCV9fZnVuY19fLCBtb2Rl
LT5uYW1lLCBtb2RlLT5jbG9jaywgYnBwLCByZXFfYncsCisJCQltYXhfYncsIGxhbmVzLCByYXRl
KTsKKworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRpYwor
ZW51bSBkcm1fbW9kZV9zdGF0dXMgY2Ruc19taGRwX21vZGVfdmFsaWQoc3RydWN0IGRybV9jb25u
ZWN0b3IgKmNvbm4sCisJCQkJCSAgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCit7CisJ
c3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAgPSBjb25uZWN0b3JfdG9fbWhkcChjb25uKTsK
KworCWlmICghY2Ruc19taGRwX2JhbmR3aWR0aF9vayhtaGRwLCBtb2RlLCBtaGRwLT5ob3N0Lmxh
bmVzX2NudCwKKwkJCQkgICAgbWhkcC0+aG9zdC5saW5rX3JhdGUpKQorCQlyZXR1cm4gTU9ERV9D
TE9DS19ISUdIOworCisJcmV0dXJuIE1PREVfT0s7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MgY2Ruc19taGRwX2Nvbm5faGVscGVyX2Z1bmNzID0g
eworCS5kZXRlY3RfY3R4ID0gY2Ruc19taGRwX2RldGVjdCwKKwkuZ2V0X21vZGVzID0gY2Ruc19t
aGRwX2dldF9tb2RlcywKKwkubW9kZV92YWxpZCA9IGNkbnNfbWhkcF9tb2RlX3ZhbGlkLAorfTsK
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX2Z1bmNzIGNkbnNfbWhkcF9jb25u
X2Z1bmNzID0geworCS5maWxsX21vZGVzID0gZHJtX2hlbHBlcl9wcm9iZV9zaW5nbGVfY29ubmVj
dG9yX21vZGVzLAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJf
Y29ubmVjdG9yX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1f
YXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZGVzdHJveV9zdGF0ZSwKKwkucmVzZXQgPSBkcm1fYXRv
bWljX2hlbHBlcl9jb25uZWN0b3JfcmVzZXQsCisJLmRlc3Ryb3kgPSBkcm1fY29ubmVjdG9yX2Ns
ZWFudXAsCit9OworCitzdGF0aWMgaW50IGNkbnNfbWhkcF9hdHRhY2goc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSkKK3sKKwlzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCA9IGJyaWRnZV90
b19taGRwKGJyaWRnZSk7CisJdTMyIGJ1c19mb3JtYXQgPSBNRURJQV9CVVNfRk1UX1JHQjEyMTIx
Ml8xWDM2OworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uID0gJm1oZHAtPmNvbm5lY3RvcjsK
Kwlib29sIGh3X3JlYWR5OworCWludCByZXQ7CisKKwlkZXZfZGJnKG1oZHAtPmRldiwgIiVzXG4i
LCBfX2Z1bmNfXyk7CisKKwlpZiAoJm1oZHAtPmJyaWRnZSAhPSBicmlkZ2UpCisJCXJldHVybiAt
RU5PREVWOworCisJY29ubi0+cG9sbGVkID0gRFJNX0NPTk5FQ1RPUl9QT0xMX0hQRDsKKworCXJl
dCA9IGRybV9jb25uZWN0b3JfaW5pdChicmlkZ2UtPmRldiwgY29ubiwgJmNkbnNfbWhkcF9jb25u
X2Z1bmNzLAorCQkJCSBEUk1fTU9ERV9DT05ORUNUT1JfRGlzcGxheVBvcnQpOworCWlmIChyZXQp
IHsKKwkJZGV2X2VycihtaGRwLT5kZXYsICJmYWlsZWQgdG8gaW5pdCBjb25uZWN0b3JcbiIpOwor
CQlyZXR1cm4gcmV0OworCX0KKworCWRybV9jb25uZWN0b3JfaGVscGVyX2FkZChjb25uLCAmY2Ru
c19taGRwX2Nvbm5faGVscGVyX2Z1bmNzKTsKKworCXJldCA9IGRybV9kaXNwbGF5X2luZm9fc2V0
X2J1c19mb3JtYXRzKCZjb25uLT5kaXNwbGF5X2luZm8sCisJCQkJCSAgICAgICAmYnVzX2Zvcm1h
dCwgMSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWNvbm4tPmRpc3BsYXlfaW5mby5i
dXNfZmxhZ3MgPSBtaGRwLT5jb25uX2J1c19mbGFnc19kZWZhdWx0czsKKworCWlmICghKHN0cmNt
cChtaGRwX2lkcy0+Y29tcGF0aWJsZSwgInRpLGo3MjFlLW1oZHA4NTQ2IikpKQorCS8qCisJICog
RFAgaXMgaW50ZXJuYWwgdG8gSjcgU29DIGFuZCB3ZSBuZWVkIHRvIHVzZSBEUklWRV9QT1NFREdF
CisJICogaW4gdGhlIGRpc3BsYXkgY29udHJvbGxlci4gVGhpcyBpcyBhY2hpZXZlZCBmb3IgdGhl
IHRpbWUgYmVpbmcKKwkgKiBieSBkZWZpbmluZyBTQU1QTEVfTkVHRURHRSBoZXJlLgorCSAqLwor
CQljb25uLT5kaXNwbGF5X2luZm8uYnVzX2ZsYWdzIHw9CisJCQkJCURSTV9CVVNfRkxBR19QSVhE
QVRBX1NBTVBMRV9ORUdFREdFIHwKKwkJCQkJRFJNX0JVU19GTEFHX1NZTkNfU0FNUExFX05FR0VE
R0U7CisKKwlyZXQgPSBkcm1fY29ubmVjdG9yX2F0dGFjaF9lbmNvZGVyKGNvbm4sIGJyaWRnZS0+
ZW5jb2Rlcik7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKG1oZHAtPmRldiwgImZhaWxlZCB0byBh
dHRhY2ggY29ubmVjdG9yIHRvIGVuY29kZXJcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCXNw
aW5fbG9jaygmbWhkcC0+c3RhcnRfbG9jayk7CisKKwltaGRwLT5icmlkZ2VfYXR0YWNoZWQgPSB0
cnVlOworCWh3X3JlYWR5ID0gbWhkcC0+aHdfc3RhdGUgPT0gTUhEUF9IV19SRUFEWTsKKworCXNw
aW5fdW5sb2NrKCZtaGRwLT5zdGFydF9sb2NrKTsKKworCWlmIChod19yZWFkeSkgeworCQkvKiBl
bmFibGUgaW50ZXJydXB0cyAqLworCQl3cml0ZWwoMCwgbWhkcC0+cmVncyArIENETlNfQVBCX0lO
VF9NQVNLKTsKKwkJd3JpdGVsKDAsIG1oZHAtPnJlZ3MgKyBDRE5TX01CX0lOVF9NQVNLKTsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBtaGRwX2xpbmtfdHJhaW5pbmdfaW5pdChz
dHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCkKK3sKKwl1MzIgcmVnMzI7CisJdTggaTsKKwl1
bmlvbiBwaHlfY29uZmlndXJlX29wdHMgcGh5X2NmZzsKKwlpbnQgcmV0OworCisJZHJtX2RwX2Rw
Y2Rfd3JpdGViKCZtaGRwLT5hdXgsIERQX1RSQUlOSU5HX1BBVFRFUk5fU0VULAorCQkJICAgRFBf
VFJBSU5JTkdfUEFUVEVSTl9ESVNBQkxFKTsKKworCS8qIFJlc2V0IFBIWSBjb25maWd1cmF0aW9u
ICovCisJcmVnMzIgPSBDRE5TX1BIWV9DT01NT05fQ09ORklHIHwgQ0ROU19QSFlfVFJBSU5JTkdf
VFlQRSgxKTsKKwlpZiAoIW1oZHAtPmhvc3Quc2NyYW1ibGVyKQorCQlyZWczMiB8PSBDRE5TX1BI
WV9TQ1JBTUJMRVJfQllQQVNTOworCisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5TX0RQ
VFhfUEhZX0NPTkZJRywgcmVnMzIpOworCisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5T
X0RQX0VOSE5DRCwKKwkJCSAgICBtaGRwLT5zaW5rLmVuaGFuY2VkICYgbWhkcC0+aG9zdC5lbmhh
bmNlZCk7CisKKwljZG5zX21oZHBfcmVnX3dyaXRlKG1oZHAsIENETlNfRFBfTEFORV9FTiwKKwkJ
CSAgICBDRE5TX0RQX0xBTkVfRU5fTEFORVMobWhkcC0+bGluay5udW1fbGFuZXMpKTsKKworCWNk
bnNfbWhkcF9saW5rX2NvbmZpZ3VyZSgmbWhkcC0+YXV4LCAmbWhkcC0+bGluayk7CisJcGh5X2Nm
Zy5kcC5saW5rX3JhdGUgPSAobWhkcC0+bGluay5yYXRlIC8gMTAwKTsKKwlwaHlfY2ZnLmRwLmxh
bmVzID0gKG1oZHAtPmxpbmsubnVtX2xhbmVzKTsKKwlmb3IgKGkgPSAwOyBpIDwgNDsgaSsrKSB7
CisJCXBoeV9jZmcuZHAudm9sdGFnZVtpXSA9IDA7CisJCXBoeV9jZmcuZHAucHJlW2ldID0gMDsK
Kwl9CisJcGh5X2NmZy5kcC5zc2MgPSBtaGRwX2dldF9zc2Nfc3VwcG9ydGVkKG1oZHApOworCXBo
eV9jZmcuZHAuc2V0X2xhbmVzID0gdHJ1ZTsKKwlwaHlfY2ZnLmRwLnNldF9yYXRlID0gdHJ1ZTsK
KwlwaHlfY2ZnLmRwLnNldF92b2x0YWdlcyA9IHRydWU7CisJcmV0ID0gcGh5X2NvbmZpZ3VyZSht
aGRwLT5waHksICAmcGh5X2NmZyk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKG1oZHAtPmRldiwg
IiVzOiBwaHlfY29uZmlndXJlKCkgZmFpbGVkOiAlZFxuIiwKKwkJCV9fZnVuY19fLCByZXQpOwor
CQlyZXR1cm4gcmV0OworCX0KKworCWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUFRY
X1BIWV9DT05GSUcsCisJCQkgICAgQ0ROU19QSFlfQ09NTU9OX0NPTkZJRyB8CisJCQkgICAgQ0RO
U19QSFlfVFJBSU5JTkdfRU4gfAorCQkJICAgIENETlNfUEhZX1RSQUlOSU5HX1RZUEUoMSkgfAor
CQkJICAgIENETlNfUEhZX1NDUkFNQkxFUl9CWVBBU1MpOworCisJZHJtX2RwX2RwY2Rfd3JpdGVi
KCZtaGRwLT5hdXgsIERQX1RSQUlOSU5HX1BBVFRFUk5fU0VULAorCQkJICAgRFBfVFJBSU5JTkdf
UEFUVEVSTl8xIHwgRFBfTElOS19TQ1JBTUJMSU5HX0RJU0FCTEUpOworCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyB2b2lkIG1oZHBfZ2V0X2FkanVzdF90cmFpbihzdHJ1Y3QgY2Ruc19taGRwX2Rl
dmljZSAqbWhkcCwKKwkJCQkgIHU4IGxpbmtfc3RhdHVzW0RQX0xJTktfU1RBVFVTX1NJWkVdLAor
CQkJCSAgdTggbGFuZXNfZGF0YVtDRE5TX0RQX01BWF9OVU1fTEFORVNdLAorCQkJCSAgdW5pb24g
cGh5X2NvbmZpZ3VyZV9vcHRzICpwaHlfY2ZnKQoreworCXVuc2lnbmVkIGludCBpOworCXU4IGFk
anVzdCwgbWF4X3ByZV9lbXBoLCBtYXhfdm9sdF9zd2luZzsKKwl1OCBzZXRfdm9sdCwgc2V0X3By
ZTsKKworCW1heF9wcmVfZW1waCA9IENETlNfUFJFX0VNUEhBU0lTKG1oZHAtPmhvc3QucHJlX2Vt
cGhhc2lzKQorCQkJICAgPDwgRFBfVFJBSU5fUFJFX0VNUEhBU0lTX1NISUZUOworCW1heF92b2x0
X3N3aW5nID0gQ0ROU19WT0xUX1NXSU5HKG1oZHAtPmhvc3Qudm9sdF9zd2luZyk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgbWhkcC0+bGluay5udW1fbGFuZXM7IGkrKykgeworCQkvKiBDaGVjayBpZiBW
b2x0YWdlIHN3aW5nIGFuZCBwcmUtZW1waGFzaXMgYXJlIHdpdGhpbiBsaW1pdHMgKi8KKwkJYWRq
dXN0ID0gZHJtX2RwX2dldF9hZGp1c3RfcmVxdWVzdF92b2x0YWdlKGxpbmtfc3RhdHVzLCBpKTsK
KwkJc2V0X3ZvbHQgPSBtaW5fdCh1OCwgYWRqdXN0LCBtYXhfdm9sdF9zd2luZyk7CisKKwkJYWRq
dXN0ID0gZHJtX2RwX2dldF9hZGp1c3RfcmVxdWVzdF9wcmVfZW1waGFzaXMobGlua19zdGF0dXMs
IGkpOworCQlzZXRfcHJlID0gbWluX3QodTgsIGFkanVzdCwgbWF4X3ByZV9lbXBoKQorCQkJICA+
PiBEUF9UUkFJTl9QUkVfRU1QSEFTSVNfU0hJRlQ7CisKKwkJLyogVm9sdGFnZSBzd2luZyBsZXZl
bCBhbmQgcHJlLWVtcGhhc2lzIGxldmVsIGNvbWJpbmF0aW9uIGlzCisJCSAqIG5vdCBhbGxvd2Vk
OiBsZWF2aW5nIHByZS1lbXBoYXNpcyBhcy1pcywgYW5kIGFkanVzdGluZworCQkgKiB2b2x0YWdl
IHN3aW5nLgorCQkgKi8KKwkJaWYgKHNldF92b2x0ICsgc2V0X3ByZSA+IDMpCisJCQlzZXRfdm9s
dCA9IDMgLSBzZXRfcHJlOworCisJCXBoeV9jZmctPmRwLnZvbHRhZ2VbaV0gPSBzZXRfdm9sdDsK
KwkJbGFuZXNfZGF0YVtpXSA9IHNldF92b2x0OworCisJCWlmIChzZXRfdm9sdCA9PSBtYXhfdm9s
dF9zd2luZykKKwkJCWxhbmVzX2RhdGFbaV0gfD0gRFBfVFJBSU5fTUFYX1NXSU5HX1JFQUNIRUQ7
CisKKwkJcGh5X2NmZy0+ZHAucHJlW2ldID0gc2V0X3ByZTsKKwkJbGFuZXNfZGF0YVtpXSB8PSAo
c2V0X3ByZSA8PCBEUF9UUkFJTl9QUkVfRU1QSEFTSVNfU0hJRlQpOworCisJCWlmIChzZXRfcHJl
ID09IChtYXhfcHJlX2VtcGggPj4gRFBfVFJBSU5fUFJFX0VNUEhBU0lTX1NISUZUKSkKKwkJCWxh
bmVzX2RhdGFbaV0gfD0gRFBfVFJBSU5fTUFYX1BSRV9FTVBIQVNJU19SRUFDSEVEOworCX0KK30K
Kworc3RhdGljCit2b2lkIG1oZHBfc2V0X2FkanVzdF9yZXF1ZXN0X3ZvbHRhZ2UodTggbGlua19z
dGF0dXNbRFBfTElOS19TVEFUVVNfU0laRV0sCisJCQkJICAgICBpbnQgbGFuZSwgdTggdm9sdCkK
K3sKKwlpbnQgaSA9IERQX0FESlVTVF9SRVFVRVNUX0xBTkUwXzEgKyAobGFuZSA+PiAxKTsKKwlp
bnQgcyA9ICgobGFuZSAmIDEpID8KKwkJIERQX0FESlVTVF9WT0xUQUdFX1NXSU5HX0xBTkUxX1NI
SUZUIDoKKwkJIERQX0FESlVTVF9WT0xUQUdFX1NXSU5HX0xBTkUwX1NISUZUKTsKKwlpbnQgaWR4
ID0gaSAtIERQX0xBTkUwXzFfU1RBVFVTOworCisJbGlua19zdGF0dXNbaWR4XSAmPSB+KERQX0FE
SlVTVF9WT0xUQUdFX1NXSU5HX0xBTkUwX01BU0sgPDwgcyk7CisJbGlua19zdGF0dXNbaWR4XSB8
PSB2b2x0IDw8IHM7Cit9CisKK3N0YXRpYwordm9pZCBtaGRwX3NldF9hZGp1c3RfcmVxdWVzdF9w
cmVfZW1waGFzaXModTggbGlua19zdGF0dXNbRFBfTElOS19TVEFUVVNfU0laRV0sCisJCQkJCSAg
aW50IGxhbmUsIHU4IHByZV9lbXBoYXNpcykKK3sKKwlpbnQgaSA9IERQX0FESlVTVF9SRVFVRVNU
X0xBTkUwXzEgKyAobGFuZSA+PiAxKTsKKwlpbnQgcyA9ICgobGFuZSAmIDEpID8KKwkJIERQX0FE
SlVTVF9QUkVfRU1QSEFTSVNfTEFORTFfU0hJRlQgOgorCQkgRFBfQURKVVNUX1BSRV9FTVBIQVNJ
U19MQU5FMF9TSElGVCk7CisJaW50IGlkeCA9IGkgLSBEUF9MQU5FMF8xX1NUQVRVUzsKKworCWxp
bmtfc3RhdHVzW2lkeF0gJj0gfihEUF9BREpVU1RfUFJFX0VNUEhBU0lTX0xBTkUwX01BU0sgPDwg
cyk7CisJbGlua19zdGF0dXNbaWR4XSB8PSBwcmVfZW1waGFzaXMgPDwgczsKK30KKworc3RhdGlj
IHZvaWQgbWhkcF9hZGp1c3RfcmVxdWVzdGVkX2VxKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICpt
aGRwLAorCQkJCSAgICAgdTggbGlua19zdGF0dXNbRFBfTElOS19TVEFUVVNfU0laRV0pCit7CisJ
dW5zaWduZWQgaW50IGk7CisJdTggdm9sdCwgcHJlLCBtYXhfdm9sdCA9IENETlNfVk9MVF9TV0lO
RyhtaGRwLT5ob3N0LnZvbHRfc3dpbmcpLAorCQkgICAgICBtYXhfcHJlID0gQ0ROU19QUkVfRU1Q
SEFTSVMobWhkcC0+aG9zdC5wcmVfZW1waGFzaXMpOworCisJZm9yIChpID0gMDsgaSA8IG1oZHAt
PmxpbmsubnVtX2xhbmVzOyBpKyspIHsKKwkJdm9sdCA9IGRybV9kcF9nZXRfYWRqdXN0X3JlcXVl
c3Rfdm9sdGFnZShsaW5rX3N0YXR1cywgaSk7CisJCXByZSA9IGRybV9kcF9nZXRfYWRqdXN0X3Jl
cXVlc3RfcHJlX2VtcGhhc2lzKGxpbmtfc3RhdHVzLCBpKTsKKwkJaWYgKHZvbHQgKyBwcmUgPiAz
KQorCQkJbWhkcF9zZXRfYWRqdXN0X3JlcXVlc3Rfdm9sdGFnZShsaW5rX3N0YXR1cywgaSwKKwkJ
CQkJCQkzIC0gcHJlKTsKKwkJaWYgKG1oZHAtPmhvc3Qudm9sdF9zd2luZyAmIENETlNfRk9SQ0Vf
Vk9MVF9TV0lORykKKwkJCW1oZHBfc2V0X2FkanVzdF9yZXF1ZXN0X3ZvbHRhZ2UobGlua19zdGF0
dXMsIGksCisJCQkJCQkJbWF4X3ZvbHQpOworCQlpZiAobWhkcC0+aG9zdC5wcmVfZW1waGFzaXMg
JiBDRE5TX0ZPUkNFX1BSRV9FTVBIQVNJUykKKwkJCW1oZHBfc2V0X2FkanVzdF9yZXF1ZXN0X3By
ZV9lbXBoYXNpcyhsaW5rX3N0YXR1cywgaSwKKwkJCQkJCQkgICAgIG1heF9wcmUpOworCX0KK30K
Kworc3RhdGljIGJvb2wgbWhkcF9saW5rX3RyYWluaW5nX2NoYW5uZWxfZXEoc3RydWN0IGNkbnNf
bWhkcF9kZXZpY2UgKm1oZHAsCisJCQkJCSAgdTggZXFfdHBzLAorCQkJCQkgIHVuc2lnbmVkIGlu
dCB0cmFpbmluZ19pbnRlcnZhbCkKK3sKKwl1OCBsYW5lc19kYXRhW0NETlNfRFBfTUFYX05VTV9M
QU5FU10sIGZhaWxfY291bnRlcl9zaG9ydCA9IDA7CisJdTggbGlua19zdGF0dXNbRFBfTElOS19T
VEFUVVNfU0laRV07CisJdTMyIHJlZzMyOworCXVuaW9uIHBoeV9jb25maWd1cmVfb3B0cyBwaHlf
Y2ZnOworCWludCByZXQ7CisJYm9vbCByOworCisJZGV2X2RiZyhtaGRwLT5kZXYsICJTdGFydGlu
ZyBFUSBwaGFzZVxuIik7CisKKwkvKiBFbmFibGUgbGluayB0cmFpbmluZyBUUFNbZXFfdHBzXSBp
biBQSFkgKi8KKwlyZWczMiA9IENETlNfUEhZX0NPTU1PTl9DT05GSUcgfCBDRE5TX1BIWV9UUkFJ
TklOR19FTiB8CisJCUNETlNfUEhZX1RSQUlOSU5HX1RZUEUoZXFfdHBzKTsKKwlpZiAoZXFfdHBz
ICE9IDQpCisJCXJlZzMyIHw9IENETlNfUEhZX1NDUkFNQkxFUl9CWVBBU1M7CisJY2Ruc19taGRw
X3JlZ193cml0ZShtaGRwLCBDRE5TX0RQVFhfUEhZX0NPTkZJRywgcmVnMzIpOworCisJZHJtX2Rw
X2RwY2Rfd3JpdGViKCZtaGRwLT5hdXgsIERQX1RSQUlOSU5HX1BBVFRFUk5fU0VULAorCQkJICAg
KGVxX3RwcyAhPSA0KSA/IGVxX3RwcyB8IERQX0xJTktfU0NSQU1CTElOR19ESVNBQkxFIDoKKwkJ
CSAgIENETlNfRFBfVFJBSU5JTkdfUEFUVEVSTl80KTsKKworCWRybV9kcF9kcGNkX3JlYWRfbGlu
a19zdGF0dXMoJm1oZHAtPmF1eCwgbGlua19zdGF0dXMpOworCisJZG8geworCQltaGRwX2dldF9h
ZGp1c3RfdHJhaW4obWhkcCwgbGlua19zdGF0dXMsIGxhbmVzX2RhdGEsICZwaHlfY2ZnKTsKKwkJ
cGh5X2NmZy5kcC5sYW5lcyA9IChtaGRwLT5saW5rLm51bV9sYW5lcyk7CisJCXBoeV9jZmcuZHAu
c3NjID0gbWhkcF9nZXRfc3NjX3N1cHBvcnRlZChtaGRwKTsKKwkJcGh5X2NmZy5kcC5zZXRfbGFu
ZXMgPSBmYWxzZTsKKwkJcGh5X2NmZy5kcC5zZXRfcmF0ZSA9IGZhbHNlOworCQlwaHlfY2ZnLmRw
LnNldF92b2x0YWdlcyA9IHRydWU7CisJCXJldCA9IHBoeV9jb25maWd1cmUobWhkcC0+cGh5LCAg
JnBoeV9jZmcpOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKG1oZHAtPmRldiwgIiVzOiBwaHlf
Y29uZmlndXJlKCkgZmFpbGVkOiAlZFxuIiwKKwkJCQlfX2Z1bmNfXywgcmV0KTsKKwkJCWdvdG8g
ZXJyOworCQl9CisKKwkJY2Ruc19taGRwX2FkanVzdF9sdChtaGRwLCBtaGRwLT5saW5rLm51bV9s
YW5lcywKKwkJCQkgICAgdHJhaW5pbmdfaW50ZXJ2YWwsIGxhbmVzX2RhdGEsIGxpbmtfc3RhdHVz
KTsKKworCQlyID0gZHJtX2RwX2Nsb2NrX3JlY292ZXJ5X29rKGxpbmtfc3RhdHVzLCBtaGRwLT5s
aW5rLm51bV9sYW5lcyk7CisJCWlmICghcikKKwkJCWdvdG8gZXJyOworCisJCWlmIChkcm1fZHBf
Y2hhbm5lbF9lcV9vayhsaW5rX3N0YXR1cywgbWhkcC0+bGluay5udW1fbGFuZXMpKSB7CisJCQlk
ZXZfZGJnKG1oZHAtPmRldiwgIkVRIHBoYXNlIHN1Y2NlZWRlZFxuIik7CisJCQlyZXR1cm4gdHJ1
ZTsKKwkJfQorCisJCWZhaWxfY291bnRlcl9zaG9ydCsrOworCisJCW1oZHBfYWRqdXN0X3JlcXVl
c3RlZF9lcShtaGRwLCBsaW5rX3N0YXR1cyk7CisJfSB3aGlsZSAoZmFpbF9jb3VudGVyX3Nob3J0
IDwgNSk7CisKK2VycjoKKwlkZXZfZGJnKG1oZHAtPmRldiwgIkVRIHBoYXNlIGZhaWxlZCBmb3Ig
JWQgbGFuZXMgYW5kICVkIHJhdGVcbiIsCisJCW1oZHAtPmxpbmsubnVtX2xhbmVzLCBtaGRwLT5s
aW5rLnJhdGUpOworCisJcmV0dXJuIGZhbHNlOworfQorCitzdGF0aWMgdm9pZCBtaGRwX2FkanVz
dF9yZXF1ZXN0ZWRfY3Ioc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAsCisJCQkJICAgICB1
OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVU19TSVpFXSwKKwkJCQkgICAgIHU4ICpyZXFfdm9s
dCwgdTggKnJlcV9wcmUpCit7CisJY29uc3QgdTMyIG1heF92b2x0ID0gQ0ROU19WT0xUX1NXSU5H
KG1oZHAtPmhvc3Qudm9sdF9zd2luZyksCisJCSAgbWF4X3ByZSA9IENETlNfUFJFX0VNUEhBU0lT
KG1oZHAtPmhvc3QucHJlX2VtcGhhc2lzKTsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9
IDA7IGkgPCBtaGRwLT5saW5rLm51bV9sYW5lczsgaSsrKSB7CisJCXVuc2lnbmVkIGludCB2YWw7
CisKKwkJdmFsID0gbWhkcC0+aG9zdC52b2x0X3N3aW5nICYgQ0ROU19GT1JDRV9WT0xUX1NXSU5H
ID8KKwkJICAgICAgbWF4X3ZvbHQgOiByZXFfdm9sdFtpXTsKKwkJbWhkcF9zZXRfYWRqdXN0X3Jl
cXVlc3Rfdm9sdGFnZShsaW5rX3N0YXR1cywgaSwgdmFsKTsKKworCQl2YWwgPSBtaGRwLT5ob3N0
LnByZV9lbXBoYXNpcyAmIENETlNfRk9SQ0VfUFJFX0VNUEhBU0lTID8KKwkJICAgICAgbWF4X3By
ZSA6IHJlcV9wcmVbaV07CisJCW1oZHBfc2V0X2FkanVzdF9yZXF1ZXN0X3ByZV9lbXBoYXNpcyhs
aW5rX3N0YXR1cywgaSwgdmFsKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIG1oZHBfdmFsaWRhdGVf
Y3Ioc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAsIGJvb2wgKmNyX2RvbmUsCisJCQkgICAg
IGJvb2wgKnNhbWVfYmVmb3JlX2FkanVzdCwgYm9vbCAqbWF4X3N3aW5nX3JlYWNoZWQsCisJCQkg
ICAgIHU4IGJlZm9yZV9jcltEUF9MSU5LX1NUQVRVU19TSVpFXSwKKwkJCSAgICAgdTggYWZ0ZXJf
Y3JbRFBfTElOS19TVEFUVVNfU0laRV0sIHU4ICpyZXFfdm9sdCwKKwkJCSAgICAgdTggKnJlcV9w
cmUpCit7CisJY29uc3QgdTggbWF4X3ZvbHQgPSBDRE5TX1ZPTFRfU1dJTkcobWhkcC0+aG9zdC52
b2x0X3N3aW5nKSwKKwkJIG1heF9wcmUgPSBDRE5TX1BSRV9FTVBIQVNJUyhtaGRwLT5ob3N0LnBy
ZV9lbXBoYXNpcyk7CisJYm9vbCBzYW1lX3ByZSwgc2FtZV92b2x0OworCXVuc2lnbmVkIGludCBp
OworCisJKnNhbWVfYmVmb3JlX2FkanVzdCA9IGZhbHNlOworCSptYXhfc3dpbmdfcmVhY2hlZCA9
IGZhbHNlOworCSpjcl9kb25lID0gZHJtX2RwX2Nsb2NrX3JlY292ZXJ5X29rKGFmdGVyX2NyLCBt
aGRwLT5saW5rLm51bV9sYW5lcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgbWhkcC0+bGluay5udW1f
bGFuZXM7IGkrKykgeworCQl1OCB0bXA7CisKKwkJdG1wID0gZHJtX2RwX2dldF9hZGp1c3RfcmVx
dWVzdF92b2x0YWdlKGFmdGVyX2NyLCBpKTsKKwkJcmVxX3ZvbHRbaV0gPSBtaW5fdCh1OCwgdG1w
LCBtYXhfdm9sdCk7CisKKwkJdG1wID0gZHJtX2RwX2dldF9hZGp1c3RfcmVxdWVzdF9wcmVfZW1w
aGFzaXMoYWZ0ZXJfY3IsIGkpID4+CisJCSAgICAgIERQX1RSQUlOX1BSRV9FTVBIQVNJU19TSElG
VDsKKwkJcmVxX3ByZVtpXSA9IG1pbl90KHU4LCB0bXAsIG1heF9wcmUpOworCisJCXNhbWVfcHJl
ID0gKGJlZm9yZV9jcltpXSAmIERQX1RSQUlOX1BSRV9FTVBIQVNJU19NQVNLKSA9PQorCQkJICAg
cmVxX3ByZVtpXSA8PCBEUF9UUkFJTl9QUkVfRU1QSEFTSVNfU0hJRlQ7CisJCXNhbWVfdm9sdCA9
IChiZWZvcmVfY3JbaV0gJiBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX01BU0spID09CisJCQkgICAg
cmVxX3ZvbHRbaV07CisJCWlmIChzYW1lX3ByZSAmJiBzYW1lX3ZvbHQpCisJCQkqc2FtZV9iZWZv
cmVfYWRqdXN0ID0gdHJ1ZTsKKworCQkvKiAzLjEuNS4yIGluIERQIFN0YW5kYXJkIHYxLjQuIFRh
YmxlIDMtMSAqLworCQlpZiAoISpjcl9kb25lICYmIHJlcV92b2x0W2ldICsgcmVxX3ByZVtpXSA+
PSAzKSB7CisJCQkqbWF4X3N3aW5nX3JlYWNoZWQgPSB0cnVlOworCQkJcmV0dXJuOworCQl9CisJ
fQorfQorCitzdGF0aWMgYm9vbCBtaGRwX2xpbmtfdHJhaW5pbmdfY3Ioc3RydWN0IGNkbnNfbWhk
cF9kZXZpY2UgKm1oZHApCit7CisJdTggbGFuZXNfZGF0YVtDRE5TX0RQX01BWF9OVU1fTEFORVNd
LAorCWZhaWxfY291bnRlcl9zaG9ydCA9IDAsIGZhaWxfY291bnRlcl9jcl9sb25nID0gMDsKKwl1
OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVU19TSVpFXTsKKwlib29sIGNyX2RvbmU7CisJdW5p
b24gcGh5X2NvbmZpZ3VyZV9vcHRzIHBoeV9jZmc7CisJaW50IHJldDsKKworCWRldl9kYmcobWhk
cC0+ZGV2LCAiU3RhcnRpbmcgQ1IgcGhhc2VcbiIpOworCisJcmV0ID0gbWhkcF9saW5rX3RyYWlu
aW5nX2luaXQobWhkcCk7CisJaWYgKHJldCkKKwkJZ290byBlcnI7CisKKwlkcm1fZHBfZHBjZF9y
ZWFkX2xpbmtfc3RhdHVzKCZtaGRwLT5hdXgsIGxpbmtfc3RhdHVzKTsKKworCWRvIHsKKwkJdTgg
cmVxdWVzdGVkX2FkanVzdF92b2x0X3N3aW5nW0NETlNfRFBfTUFYX05VTV9MQU5FU10gPSB7fTsK
KwkJdTggcmVxdWVzdGVkX2FkanVzdF9wcmVfZW1waGFzaXNbQ0ROU19EUF9NQVhfTlVNX0xBTkVT
XSA9IHt9OworCQlib29sIHNhbWVfYmVmb3JlX2FkanVzdCwgbWF4X3N3aW5nX3JlYWNoZWQ7CisK
KwkJbWhkcF9nZXRfYWRqdXN0X3RyYWluKG1oZHAsIGxpbmtfc3RhdHVzLCBsYW5lc19kYXRhLCAm
cGh5X2NmZyk7CisJCXBoeV9jZmcuZHAubGFuZXMgPSAobWhkcC0+bGluay5udW1fbGFuZXMpOwor
CQlwaHlfY2ZnLmRwLnNzYyA9IG1oZHBfZ2V0X3NzY19zdXBwb3J0ZWQobWhkcCk7CisJCXBoeV9j
ZmcuZHAuc2V0X2xhbmVzID0gZmFsc2U7CisJCXBoeV9jZmcuZHAuc2V0X3JhdGUgPSBmYWxzZTsK
KwkJcGh5X2NmZy5kcC5zZXRfdm9sdGFnZXMgPSB0cnVlOworCQlyZXQgPSBwaHlfY29uZmlndXJl
KG1oZHAtPnBoeSwgICZwaHlfY2ZnKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2VycihtaGRwLT5k
ZXYsICIlczogcGh5X2NvbmZpZ3VyZSgpIGZhaWxlZDogJWRcbiIsCisJCQkJX19mdW5jX18sIHJl
dCk7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWNkbnNfbWhkcF9hZGp1c3RfbHQobWhkcCwgbWhk
cC0+bGluay5udW1fbGFuZXMsIDEwMCwKKwkJCQkgICAgbGFuZXNfZGF0YSwgbGlua19zdGF0dXMp
OworCisJCW1oZHBfdmFsaWRhdGVfY3IobWhkcCwgJmNyX2RvbmUsICZzYW1lX2JlZm9yZV9hZGp1
c3QsCisJCQkJICZtYXhfc3dpbmdfcmVhY2hlZCwgbGFuZXNfZGF0YSwgbGlua19zdGF0dXMsCisJ
CQkJIHJlcXVlc3RlZF9hZGp1c3Rfdm9sdF9zd2luZywKKwkJCQkgcmVxdWVzdGVkX2FkanVzdF9w
cmVfZW1waGFzaXMpOworCisJCWlmIChtYXhfc3dpbmdfcmVhY2hlZCkgeworCQkJZGV2X2Vyciht
aGRwLT5kZXYsICJDUjogbWF4IHN3aW5nIHJlYWNoZWRcbiIpOworCQkJZ290byBlcnI7CisJCX0K
KworCQlpZiAoY3JfZG9uZSkgeworCQkJZGV2X2RiZyhtaGRwLT5kZXYsICJDUiBwaGFzZSBzdWNj
ZWVkZWRcbiIpOworCQkJcmV0dXJuIHRydWU7CisJCX0KKworCQkvKiBOb3QgYWxsIENSX0RPTkUg
Yml0cyBzZXQgKi8KKwkJZmFpbF9jb3VudGVyX2NyX2xvbmcrKzsKKworCQlpZiAoc2FtZV9iZWZv
cmVfYWRqdXN0KSB7CisJCQlmYWlsX2NvdW50ZXJfc2hvcnQrKzsKKwkJCWNvbnRpbnVlOworCQl9
CisKKwkJZmFpbF9jb3VudGVyX3Nob3J0ID0gMDsKKwkJLyoKKwkJICogVm9sdGFnZSBzd2luZy9w
cmUtZW1waGFzaXMgYWRqdXN0IHJlcXVlc3RlZAorCQkgKiBkdXJpbmcgQ1IgcGhhc2UKKwkJICov
CisJCW1oZHBfYWRqdXN0X3JlcXVlc3RlZF9jcihtaGRwLCBsaW5rX3N0YXR1cywKKwkJCQkJIHJl
cXVlc3RlZF9hZGp1c3Rfdm9sdF9zd2luZywKKwkJCQkJIHJlcXVlc3RlZF9hZGp1c3RfcHJlX2Vt
cGhhc2lzKTsKKwl9IHdoaWxlIChmYWlsX2NvdW50ZXJfc2hvcnQgPCA1ICYmIGZhaWxfY291bnRl
cl9jcl9sb25nIDwgMTApOworCitlcnI6CisJZGV2X2RiZyhtaGRwLT5kZXYsICJDUiBwaGFzZSBm
YWlsZWQgZm9yICVkIGxhbmVzIGFuZCAlZCByYXRlXG4iLAorCQltaGRwLT5saW5rLm51bV9sYW5l
cywgbWhkcC0+bGluay5yYXRlKTsKKworCXJldHVybiBmYWxzZTsKK30KKworc3RhdGljIHZvaWQg
bG93ZXJfbGlua19yYXRlKHN0cnVjdCBjZG5zX21oZHBfbGluayAqbGluaykKK3sKKwlzd2l0Y2gg
KGRybV9kcF9saW5rX3JhdGVfdG9fYndfY29kZShsaW5rLT5yYXRlKSkgeworCWNhc2UgRFBfTElO
S19CV18yXzc6CisJCWxpbmstPnJhdGUgPSBkcm1fZHBfYndfY29kZV90b19saW5rX3JhdGUoRFBf
TElOS19CV18xXzYyKTsKKwkJYnJlYWs7CisJY2FzZSBEUF9MSU5LX0JXXzVfNDoKKwkJbGluay0+
cmF0ZSA9IGRybV9kcF9id19jb2RlX3RvX2xpbmtfcmF0ZShEUF9MSU5LX0JXXzJfNyk7CisJCWJy
ZWFrOworCWNhc2UgRFBfTElOS19CV184XzE6CisJCWxpbmstPnJhdGUgPSBkcm1fZHBfYndfY29k
ZV90b19saW5rX3JhdGUoRFBfTElOS19CV181XzQpOworCQlicmVhazsKKwl9Cit9CisKK3N0YXRp
YyBpbnQgbWhkcF9saW5rX3RyYWluaW5nKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwLAor
CQkJICAgICAgdW5zaWduZWQgaW50IHRyYWluaW5nX2ludGVydmFsKQoreworCXUzMiByZWczMjsK
Kwljb25zdCB1OCBlcV90cHMgPSBtaGRwX2VxX3RyYWluaW5nX3BhdHRlcm5fc3VwcG9ydGVkKG1o
ZHApOworCisJd2hpbGUgKDEpIHsKKwkJaWYgKCFtaGRwX2xpbmtfdHJhaW5pbmdfY3IobWhkcCkp
IHsKKwkJCWlmIChkcm1fZHBfbGlua19yYXRlX3RvX2J3X2NvZGUobWhkcC0+bGluay5yYXRlKSAh
PQorCQkJICAgIERQX0xJTktfQldfMV82MikgeworCQkJCWRldl9kYmcobWhkcC0+ZGV2LAorCQkJ
CQkiUmVkdWNpbmcgbGluayByYXRlIGR1cmluZyBDUiBwaGFzZVxuIik7CisJCQkJbG93ZXJfbGlu
a19yYXRlKCZtaGRwLT5saW5rKTsKKworCQkJCWNvbnRpbnVlOworCQkJfSBlbHNlIGlmIChtaGRw
LT5saW5rLm51bV9sYW5lcyA+IDEpIHsKKwkJCQlkZXZfZGJnKG1oZHAtPmRldiwKKwkJCQkJIlJl
ZHVjaW5nIGxhbmVzIG51bWJlciBkdXJpbmcgQ1IgcGhhc2VcbiIpOworCQkJCW1oZHAtPmxpbmsu
bnVtX2xhbmVzID4+PSAxOworCQkJCW1oZHAtPmxpbmsucmF0ZSA9IG1oZHBfbWF4X2xpbmtfcmF0
ZShtaGRwKTsKKworCQkJCWNvbnRpbnVlOworCQkJfQorCisJCQlkZXZfZGJnKG1oZHAtPmRldiwK
KwkJCQkiTGluayB0cmFpbmluZyBmYWlsZWQgZHVyaW5nIENSIHBoYXNlXG4iKTsKKwkJCWdvdG8g
ZXJyOworCQl9CisKKwkJaWYgKG1oZHBfbGlua190cmFpbmluZ19jaGFubmVsX2VxKG1oZHAsIGVx
X3RwcywKKwkJCQkJCSAgdHJhaW5pbmdfaW50ZXJ2YWwpKQorCQkJYnJlYWs7CisKKwkJaWYgKG1o
ZHAtPmxpbmsubnVtX2xhbmVzID4gMSkgeworCQkJZGV2X2RiZyhtaGRwLT5kZXYsCisJCQkJIlJl
ZHVjaW5nIGxhbmVzIG51bWJlciBkdXJpbmcgRVEgcGhhc2VcbiIpOworCQkJbWhkcC0+bGluay5u
dW1fbGFuZXMgPj49IDE7CisKKwkJCWNvbnRpbnVlOworCQl9IGVsc2UgaWYgKGRybV9kcF9saW5r
X3JhdGVfdG9fYndfY29kZShtaGRwLT5saW5rLnJhdGUpICE9CisJCQkgICBEUF9MSU5LX0JXXzFf
NjIpIHsKKwkJCWRldl9kYmcobWhkcC0+ZGV2LAorCQkJCSJSZWR1Y2luZyBsaW5rIHJhdGUgZHVy
aW5nIEVRIHBoYXNlXG4iKTsKKwkJCWxvd2VyX2xpbmtfcmF0ZSgmbWhkcC0+bGluayk7CisJCQlt
aGRwLT5saW5rLm51bV9sYW5lcyA9IG1oZHBfbWF4X251bV9sYW5lcyhtaGRwKTsKKworCQkJY29u
dGludWU7CisJCX0KKworCQlkZXZfZGJnKG1oZHAtPmRldiwgIkxpbmsgdHJhaW5pbmcgZmFpbGVk
IGR1cmluZyBFUSBwaGFzZVxuIik7CisJCWdvdG8gZXJyOworCX0KKworCWRldl9kYmcobWhkcC0+
ZGV2LCAiTGluayB0cmFpbmluZyBzdWNjZXNzZnVsXG4iKTsKKworCWRybV9kcF9kcGNkX3dyaXRl
YigmbWhkcC0+YXV4LCBEUF9UUkFJTklOR19QQVRURVJOX1NFVCwKKwkJCSAgIG1oZHAtPmhvc3Qu
c2NyYW1ibGVyID8gMCA6CisJCQkgICBEUF9MSU5LX1NDUkFNQkxJTkdfRElTQUJMRSk7CisKKwlj
ZG5zX21oZHBfcmVnX3JlYWQobWhkcCwgQ0ROU19EUF9GUkFNRVJfR0xPQkFMX0NPTkZJRywgJnJl
ZzMyKTsKKwlyZWczMiAmPSB+R0VOTUFTSygxLCAwKTsKKwlyZWczMiB8PSBDRE5TX0RQX05VTV9M
QU5FUyhtaGRwLT5saW5rLm51bV9sYW5lcyk7CisJcmVnMzIgfD0gQ0ROU19EUF9XUl9GQUlMSU5H
X0VER0VfVlNZTkM7CisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5TX0RQX0ZSQU1FUl9H
TE9CQUxfQ09ORklHLCByZWczMik7CisKKwkvKiBSZXNldCBQSFkgY29uZmlnICovCisJcmVnMzIg
PSBDRE5TX1BIWV9DT01NT05fQ09ORklHIHwgQ0ROU19QSFlfVFJBSU5JTkdfVFlQRSgxKTsKKwlp
ZiAoIW1oZHAtPmhvc3Quc2NyYW1ibGVyKQorCQlyZWczMiB8PSBDRE5TX1BIWV9TQ1JBTUJMRVJf
QllQQVNTOworCWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUFRYX1BIWV9DT05GSUcs
IHJlZzMyKTsKKworCXJldHVybiAwOworZXJyOgorCS8qIFJlc2V0IFBIWSBjb25maWcgKi8KKwly
ZWczMiA9IENETlNfUEhZX0NPTU1PTl9DT05GSUcgfCBDRE5TX1BIWV9UUkFJTklOR19UWVBFKDEp
OworCWlmICghbWhkcC0+aG9zdC5zY3JhbWJsZXIpCisJCXJlZzMyIHw9IENETlNfUEhZX1NDUkFN
QkxFUl9CWVBBU1M7CisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5TX0RQVFhfUEhZX0NP
TkZJRywgcmVnMzIpOworCisJZHJtX2RwX2RwY2Rfd3JpdGViKCZtaGRwLT5hdXgsIERQX1RSQUlO
SU5HX1BBVFRFUk5fU0VULAorCQkJICAgRFBfVFJBSU5JTkdfUEFUVEVSTl9ESVNBQkxFKTsKKwor
CXJldHVybiAtRUlPOworfQorCitzdGF0aWMgdm9pZCBjZG5zX21oZHBfZGlzYWJsZShzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwID0g
YnJpZGdlX3RvX21oZHAoYnJpZGdlKTsKKwl1MzIgcmVzcDsKKworCWRldl9kYmcobWhkcC0+ZGV2
LCAiJXNcbiIsIF9fZnVuY19fKTsKKworCWNkbnNfbWhkcF9yZWdfcmVhZChtaGRwLCBDRE5TX0RQ
X0ZSQU1FUl9HTE9CQUxfQ09ORklHLCAmcmVzcCk7CisJcmVzcCAmPSB+Q0ROU19EUF9GUkFNRVJf
RU47CisJcmVzcCB8PSBDRE5TX0RQX05PX1ZJREVPX01PREU7CisJY2Ruc19taGRwX3JlZ193cml0
ZShtaGRwLCBDRE5TX0RQX0ZSQU1FUl9HTE9CQUxfQ09ORklHLCByZXNwKTsKKworCW1oZHAtPmxp
bmtfdXAgPSBmYWxzZTsKKworCWlmIChtaGRwLT5wbHVnZ2VkKQorCQljZG5zX21oZHBfbGlua19w
b3dlcl9kb3duKCZtaGRwLT5hdXgsICZtaGRwLT5saW5rKTsKKworCS8qIERpc2FibGUgVklGIGNs
b2NrIGZvciBzdHJlYW0gMCAqLworCWNkbnNfbWhkcF9yZWdfcmVhZChtaGRwLCBDRE5TX0RQVFhf
Q0FSLCAmcmVzcCk7CisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5TX0RQVFhfQ0FSLAor
CQkJICAgIHJlc3AgJiB+KENETlNfVklGX0NMS19FTiB8IENETlNfVklGX0NMS19SU1ROKSk7CisK
KwlpZiAobWhkcC0+b3BzICYmIG1oZHAtPm9wcy0+ZGlzYWJsZSkKKwkJbWhkcC0+b3BzLT5kaXNh
YmxlKG1oZHApOworfQorCitzdGF0aWMgdTMyIGdldF90cmFpbmluZ19pbnRlcnZhbF91cyhzdHJ1
Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCwKKwkJCQkgICAgdTMyIGludGVydmFsKQoreworCWlm
IChpbnRlcnZhbCA9PSAwKQorCQlyZXR1cm4gNDAwOworCWlmIChpbnRlcnZhbCA8IDUpCisJCXJl
dHVybiA0MDAwIDw8IChpbnRlcnZhbCAtIDEpOworCWRldl9lcnIobWhkcC0+ZGV2LAorCQkid3Jv
bmcgdHJhaW5pbmcgaW50ZXJ2YWwgcmV0dXJuZWQgYnkgRFBDRDogJWRcbiIsIGludGVydmFsKTsK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgbWhkcF9maWxsX3NpbmtfY2FwcyhzdHJ1Y3Qg
Y2Ruc19taGRwX2RldmljZSAqbWhkcCwKKwkJCQl1OCBkcGNkW0RQX1JFQ0VJVkVSX0NBUF9TSVpF
XSkKK3sKKwltaGRwLT5zaW5rLmxpbmtfcmF0ZSA9IG1oZHAtPmxpbmsucmF0ZTsKKwltaGRwLT5z
aW5rLmxhbmVzX2NudCA9IG1oZHAtPmxpbmsubnVtX2xhbmVzOworCW1oZHAtPnNpbmsuZW5oYW5j
ZWQgPSAhIShtaGRwLT5saW5rLmNhcGFiaWxpdGllcyAmCisJCQkJIERQX0xJTktfQ0FQX0VOSEFO
Q0VEX0ZSQU1JTkcpOworCisJLyogU2V0IFNTQyBzdXBwb3J0ICovCisJbWhkcC0+c2luay5zc2Mg
PSAhIShkcGNkW0RQX01BWF9ET1dOU1BSRUFEXSAmCisJCQkJICBEUF9NQVhfRE9XTlNQUkVBRF8w
XzUpOworCisJLyogU2V0IFRQUyBzdXBwb3J0ICovCisJbWhkcC0+c2luay5wYXR0ZXJuX3N1cHAg
PSBDRE5TX1NVUFBPUlRfVFBTKDEpIHwgQ0ROU19TVVBQT1JUX1RQUygyKTsKKwlpZiAoZHJtX2Rw
X3RwczNfc3VwcG9ydGVkKGRwY2QpKQorCQltaGRwLT5zaW5rLnBhdHRlcm5fc3VwcCB8PSBDRE5T
X1NVUFBPUlRfVFBTKDMpOworCWlmIChkcm1fZHBfdHBzNF9zdXBwb3J0ZWQoZHBjZCkpCisJCW1o
ZHAtPnNpbmsucGF0dGVybl9zdXBwIHw9IENETlNfU1VQUE9SVF9UUFMoNCk7CisKKwkvKiBTZXQg
ZmFzdCBsaW5rIHN1cHBvcnQgKi8KKwltaGRwLT5zaW5rLmZhc3RfbGluayA9ICEhKGRwY2RbRFBf
TUFYX0RPV05TUFJFQURdICYKKwkJCQkgIERQX05PX0FVWF9IQU5EU0hBS0VfTElOS19UUkFJTklO
Ryk7Cit9CisKK3N0YXRpYyBpbnQgY2Ruc19taGRwX2xpbmtfdXAoc3RydWN0IGNkbnNfbWhkcF9k
ZXZpY2UgKm1oZHApCit7CisJdTMyIHJlc3A7CisJdTggcmVnMFtEUF9SRUNFSVZFUl9DQVBfU0la
RV0sIGFtcFsyXTsKKwl1OCBleHRfY2FwX2NoayA9IDA7CisJdW5zaWduZWQgaW50IGFkZHI7CisJ
aW50IGVycjsKKworCWNkbnNfbWhkcF9saW5rX3Byb2JlKCZtaGRwLT5hdXgsICZtaGRwLT5saW5r
KTsKKworCWRldl9kYmcobWhkcC0+ZGV2LCAiU2V0IHNpbmsgZGV2aWNlIHBvd2VyIHN0YXRlIHZp
YSBEUENEXG4iKTsKKwljZG5zX21oZHBfbGlua19wb3dlcl91cCgmbWhkcC0+YXV4LCAmbWhkcC0+
bGluayk7CisJLyogRklYTUUgKENETlMpOiBkbyB3ZSBoYXZlIHRvIHdhaXQgZm9yIDEwMG1zIGJl
Zm9yZSBnb2luZyBvbj8gKi8KKwltZGVsYXkoMTAwKTsKKworCWRybV9kcF9kcGNkX3JlYWRiKCZt
aGRwLT5hdXgsIERQX1RSQUlOSU5HX0FVWF9SRF9JTlRFUlZBTCwKKwkJCSAgJmV4dF9jYXBfY2hr
KTsKKworCWlmIChleHRfY2FwX2NoayAmIERQX0VYVEVOREVEX1JFQ0VJVkVSX0NBUF9GSUVMRF9Q
UkVTRU5UKQorCQlhZGRyID0gRFBfRFAxM19EUENEX1JFVjsKKwllbHNlCisJCWFkZHIgPSBEUF9E
UENEX1JFVjsKKworCWVyciA9IGRybV9kcF9kcGNkX3JlYWQoJm1oZHAtPmF1eCwgYWRkciwgcmVn
MCwgRFBfUkVDRUlWRVJfQ0FQX1NJWkUpOworCWlmIChlcnIgPCAwKSB7CisJCWRldl9lcnIobWhk
cC0+ZGV2LCAiRmFpbGVkIHRvIHJlYWQgcmVjZWl2ZXIgY2FwYWJpbGl0aWVzXG4iKTsKKwkJcmV0
dXJuIGVycjsKKwl9CisKKwltaGRwX2ZpbGxfc2lua19jYXBzKG1oZHAsIHJlZzApOworCisJbWhk
cC0+bGluay5yYXRlID0gbWhkcF9tYXhfbGlua19yYXRlKG1oZHApOworCW1oZHAtPmxpbmsubnVt
X2xhbmVzID0gbWhkcF9tYXhfbnVtX2xhbmVzKG1oZHApOworCisJLyogRGlzYWJsZSBmcmFtZXIg
Zm9yIGxpbmsgdHJhaW5pbmcgKi8KKwljZG5zX21oZHBfcmVnX3JlYWQobWhkcCwgQ0ROU19EUF9G
UkFNRVJfR0xPQkFMX0NPTkZJRywgJnJlc3ApOworCXJlc3AgJj0gfkNETlNfRFBfRlJBTUVSX0VO
OworCWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9GUkFNRVJfR0xPQkFMX0NPTkZJ
RywgcmVzcCk7CisKKwkvKiBTcHJlYWQgQU1QIGlmIHJlcXVpcmVkLCBlbmFibGUgOGIvMTBiIGNv
ZGluZyAqLworCWFtcFswXSA9IG1oZHBfZ2V0X3NzY19zdXBwb3J0ZWQobWhkcCkgPyBEUF9TUFJF
QURfQU1QXzBfNSA6IDA7CisJYW1wWzFdID0gRFBfU0VUX0FOU0lfOEIxMEI7CisJZHJtX2RwX2Rw
Y2Rfd3JpdGUoJm1oZHAtPmF1eCwgRFBfRE9XTlNQUkVBRF9DVFJMLCBhbXAsIDIpOworCisJaWYg
KG1oZHAtPmhvc3QuZmFzdF9saW5rICYgbWhkcC0+c2luay5mYXN0X2xpbmspIHsKKwkJLyogRklY
TUU6IGltcGxlbWVudCBmYXN0bGluayAqLworCQlkZXZfZXJyKG1oZHAtPmRldiwgImZhc3RsaW5r
IG5vdCBzdXBwb3J0ZWRcbiIpOworCQlyZXR1cm4gLUVOT1RTVVBQOworCX0gZWxzZSB7CisJCWNv
bnN0IHUzMiBpbnRlcnZhbCA9IHJlZzBbRFBfVFJBSU5JTkdfQVVYX1JEX0lOVEVSVkFMXSAmCisJ
CQkJICAgICBEUF9UUkFJTklOR19BVVhfUkRfTUFTSzsKKwkJY29uc3QgdTMyIGludGVydmFsX3Vz
ID0gZ2V0X3RyYWluaW5nX2ludGVydmFsX3VzKG1oZHAsCisJCQkJCQkJCSBpbnRlcnZhbCk7CisJ
CWlmICghaW50ZXJ2YWxfdXMgfHwKKwkJICAgIG1oZHBfbGlua190cmFpbmluZyhtaGRwLCBpbnRl
cnZhbF91cykpIHsKKwkJCWRldl9lcnIobWhkcC0+ZGV2LCAiTGluayB0cmFpbmluZyBmYWlsZWQu
IEV4aXRpbmcuXG4iKTsKKwkJCXJldHVybiAtRUlPOworCQl9CisJfQorCisJbWhkcC0+bGlua191
cCA9IHRydWU7CisKKwlyZXR1cm4gMDsKK30KKwordTMyIGNkbnNfbWhkcF9nZXRfYnBwKHN0cnVj
dCBjZG5zX21oZHBfZGlzcGxheV9mbXQgKmZtdCkKK3sKKwl1MzIgYnBwOworCisJaWYgKGZtdC0+
eV9vbmx5KQorCQlyZXR1cm4gZm10LT5icGM7CisKKwlzd2l0Y2ggKGZtdC0+Y29sb3JfZm9ybWF0
KSB7CisJY2FzZSBEUk1fQ09MT1JfRk9STUFUX1JHQjQ0NDoKKwljYXNlIERSTV9DT0xPUl9GT1JN
QVRfWUNSQ0I0NDQ6CisJCWJwcCA9IGZtdC0+YnBjICogMzsKKwkJYnJlYWs7CisJY2FzZSBEUk1f
Q09MT1JfRk9STUFUX1lDUkNCNDIyOgorCQlicHAgPSBmbXQtPmJwYyAqIDI7CisJCWJyZWFrOwor
CWNhc2UgRFJNX0NPTE9SX0ZPUk1BVF9ZQ1JDQjQyMDoKKwkJYnBwID0gZm10LT5icGMgKiAzIC8g
MjsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJYnBwID0gZm10LT5icGMgKiAzOworCQlXQVJOX09O
KDEpOworCX0KKwlyZXR1cm4gYnBwOworfQorCitzdGF0aWMgaW50IGNkbnNfbWhkcF9zc3RfZW5h
YmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3RydWN0IGNkbnNfbWhkcF9kZXZp
Y2UgKm1oZHAgPSBicmlkZ2VfdG9fbWhkcChicmlkZ2UpOworCXUzMiByYXRlLCB2cywgdnNfZiwg
cmVxdWlyZWRfYmFuZHdpZHRoLCBhdmFpbGFibGVfYmFuZHdpZHRoOworCXUzMiB0dV9zaXplID0g
MzAsIGxpbmVfdGhyZXNoMSwgbGluZV90aHJlc2gyLCBsaW5lX3RocmVzaCA9IDA7CisJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7CisJaW50IHB4bGNsb2NrOworCXUzMiBicHAsIGJwYywg
cHhsZm10OworCisJcHhsZm10ID0gbWhkcC0+ZGlzcGxheV9mbXQuY29sb3JfZm9ybWF0OworCWJw
YyA9IG1oZHAtPmRpc3BsYXlfZm10LmJwYzsKKworCW1vZGUgPSAmYnJpZGdlLT5lbmNvZGVyLT5j
cnRjLT5zdGF0ZS0+bW9kZTsKKwlweGxjbG9jayA9IG1vZGUtPmNydGNfY2xvY2s7CisKKwltaGRw
LT5zdHJlYW1faWQgPSAwOworCisJcmF0ZSA9IG1oZHAtPmxpbmsucmF0ZSAvIDEwMDA7CisKKwli
cHAgPSBjZG5zX21oZHBfZ2V0X2JwcCgmbWhkcC0+ZGlzcGxheV9mbXQpOworCisJaWYgKCFjZG5z
X21oZHBfYmFuZHdpZHRoX29rKG1oZHAsIG1vZGUsIG1oZHAtPmxpbmsubnVtX2xhbmVzLAorCQkJ
CSAgICBtaGRwLT5saW5rLnJhdGUpKSB7CisJCWRldl9lcnIobWhkcC0+ZGV2LCAiJXM6IE5vdCBl
bm91Z2ggQlcgZm9yICVzICgldSBsYW5lcyBhdCAldSBNYnBzKVxuIiwKKwkJCV9fZnVuY19fLCBt
b2RlLT5uYW1lLCBtaGRwLT5saW5rLm51bV9sYW5lcywKKwkJCW1oZHAtPmxpbmsucmF0ZSAvIDEw
MCk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCS8qIGZpbmQgb3B0aW1hbCB0dV9zaXplICov
CisJcmVxdWlyZWRfYmFuZHdpZHRoID0gcHhsY2xvY2sgKiBicHAgLyA4OworCWF2YWlsYWJsZV9i
YW5kd2lkdGggPSBtaGRwLT5saW5rLm51bV9sYW5lcyAqIHJhdGU7CisJZG8geworCQl0dV9zaXpl
ICs9IDI7CisKKwkJdnNfZiA9IHR1X3NpemUgKiByZXF1aXJlZF9iYW5kd2lkdGggLyBhdmFpbGFi
bGVfYmFuZHdpZHRoOworCQl2cyA9IHZzX2YgLyAxMDAwOworCQl2c19mID0gdnNfZiAlIDEwMDA7
CisJCS8qCisJCSAqIEZJWE1FIChDRE5TKTogZG93bnNwcmVhZGluZz8KKwkJICogSXQncyB1bnVz
ZWQgaXMgd2hhdCBJJ3ZlIGJlZW4gdG9sZC4KKwkJICovCisJfSB3aGlsZSAoKHZzID09IDEgfHwg
KCh2c19mID4gODUwIHx8IHZzX2YgPCAxMDApICYmIHZzX2YgIT0gMCkgfHwKKwkJICB0dV9zaXpl
IC0gdnMgPCAyKSAmJiB0dV9zaXplIDwgNjQpOworCisJaWYgKHZzID4gNjQpIHsKKwkJZGV2X2Vy
cihtaGRwLT5kZXYsCisJCQkiJXM6IE5vIHNwYWNlIGZvciBmcmFtaW5nICVzICgldSBsYW5lcyBh
dCAldSBNYnBzKVxuIiwKKwkJCV9fZnVuY19fLCBtb2RlLT5uYW1lLCBtaGRwLT5saW5rLm51bV9s
YW5lcywKKwkJCW1oZHAtPmxpbmsucmF0ZSAvIDEwMCk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9GUkFNRVJfVFUsCisJCQkgICAg
Q0ROU19EUF9GUkFNRVJfVFVfVlModnMpIHwKKwkJCSAgICBDRE5TX0RQX0ZSQU1FUl9UVV9TSVpF
KHR1X3NpemUpIHwKKwkJCSAgICBDRE5TX0RQX0ZSQU1FUl9UVV9DTlRfUlNUX0VOKTsKKworCWxp
bmVfdGhyZXNoMSA9ICgodnMgKyAxKSA8PCA1KSAqIDggLyBicHA7CisJbGluZV90aHJlc2gyID0g
KHB4bGNsb2NrIDw8IDUpIC8gMTAwMCAvIHJhdGUgKiAodnMgKyAxKSAtICgxIDw8IDUpOworCWxp
bmVfdGhyZXNoID0gbGluZV90aHJlc2gxIC0gbGluZV90aHJlc2gyIC8gbWhkcC0+bGluay5udW1f
bGFuZXM7CisJbGluZV90aHJlc2ggPSAobGluZV90aHJlc2ggPj4gNSkgKyAyOworCWNkbnNfbWhk
cF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9MSU5FX1RIUkVTSCgwKSwKKwkJCSAgICBsaW5lX3Ro
cmVzaCAmIEdFTk1BU0soNSwgMCkpOworCisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5T
X0RQX1NUUkVBTV9DT05GSUdfMigwKSwKKwkJCSAgICBDRE5TX0RQX1NDMl9UVV9WU19ESUZGKCh0
dV9zaXplIC0gdnMgPiAzKSA/CisJCQkJCQkgICAwIDogdHVfc2l6ZSAtIHZzKSk7CisKKwljZG5z
X21oZHBfY29uZmlndXJlX3ZpZGVvKGJyaWRnZSk7CisKKwlyZXR1cm4gMDsKK30KKwordm9pZCBj
ZG5zX21oZHBfY29uZmlndXJlX3ZpZGVvKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJ
c3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAgPSBicmlkZ2VfdG9fbWhkcChicmlkZ2UpOwor
CXVuc2lnbmVkIGludCBkcF9mcmFtZXJfc3AgPSAwLCBtc2FfaG9yaXpvbnRhbF8xLAorCQltc2Ff
dmVydGljYWxfMSwgYm5kX2hzeW5jMnZzeW5jLCBoc3luYzJ2c3luY19wb2xfY3RybCwKKwkJbWlz
YzAgPSAwLCBtaXNjMSA9IDAsIHB4bF9yZXByLAorCQlmcm9udF9wb3JjaCwgYmFja19wb3JjaCwg
bXNhX2gwLCBtc2FfdjAsIGhzeW5jLCB2c3luYywKKwkJZHBfdmVydGljYWxfMTsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKKwl1MzIgYnBwLCBicGMsIHB4bGZtdDsKKwl1MzIgdG1w
OworCXU4IHN0cmVhbV9pZCA9IG1oZHAtPnN0cmVhbV9pZDsKKworCW1vZGUgPSAmYnJpZGdlLT5l
bmNvZGVyLT5jcnRjLT5zdGF0ZS0+bW9kZTsKKworCXB4bGZtdCA9IG1oZHAtPmRpc3BsYXlfZm10
LmNvbG9yX2Zvcm1hdDsKKwlicGMgPSBtaGRwLT5kaXNwbGF5X2ZtdC5icGM7CisKKwkvKiBpZiBZ
Q0JDUiBzdXBwb3J0ZWQgYW5kIHN0cmVhbSBub3QgU0QsIHVzZSBJVFU3MDkgKi8KKwkvKiBGSVhN
RTogaGFuZGxlIElUVSB2ZXJzaW9uIHdpdGggWUNCQ1I0MjAgd2hlbiBzdXBwb3J0ZWQgKi8KKwlp
ZiAoKHB4bGZtdCA9PSBEUk1fQ09MT1JfRk9STUFUX1lDUkNCNDQ0IHx8CisJICAgICBweGxmbXQg
PT0gRFJNX0NPTE9SX0ZPUk1BVF9ZQ1JDQjQyMikgJiYgbW9kZS0+Y3J0Y192ZGlzcGxheSA+PSA3
MjApCisJCW1pc2MwID0gRFBfWUNCQ1JfQ09FRkZJQ0lFTlRTX0lUVTcwOTsKKworCWJwcCA9IGNk
bnNfbWhkcF9nZXRfYnBwKCZtaGRwLT5kaXNwbGF5X2ZtdCk7CisKKwlzd2l0Y2ggKHB4bGZtdCkg
eworCWNhc2UgRFJNX0NPTE9SX0ZPUk1BVF9SR0I0NDQ6CisJCXB4bF9yZXByID0gQ0ROU19EUF9G
UkFNRVJfUkdCIDw8IENETlNfRFBfRlJBTUVSX1BYTF9GT1JNQVQ7CisJCW1pc2MwIHw9IERQX0NP
TE9SX0ZPUk1BVF9SR0I7CisJCWJyZWFrOworCWNhc2UgRFJNX0NPTE9SX0ZPUk1BVF9ZQ1JDQjQ0
NDoKKwkJcHhsX3JlcHIgPSBDRE5TX0RQX0ZSQU1FUl9ZQ0JDUjQ0NCA8PCBDRE5TX0RQX0ZSQU1F
Ul9QWExfRk9STUFUOworCQltaXNjMCB8PSBEUF9DT0xPUl9GT1JNQVRfWUNiQ3I0NDQgfCBEUF9U
RVNUX0RZTkFNSUNfUkFOR0VfQ0VBOworCQlicmVhazsKKwljYXNlIERSTV9DT0xPUl9GT1JNQVRf
WUNSQ0I0MjI6CisJCXB4bF9yZXByID0gQ0ROU19EUF9GUkFNRVJfWUNCQ1I0MjIgPDwgQ0ROU19E
UF9GUkFNRVJfUFhMX0ZPUk1BVDsKKwkJbWlzYzAgfD0gRFBfQ09MT1JfRk9STUFUX1lDYkNyNDIy
IHwgRFBfVEVTVF9EWU5BTUlDX1JBTkdFX0NFQTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fQ09MT1Jf
Rk9STUFUX1lDUkNCNDIwOgorCQlweGxfcmVwciA9IENETlNfRFBfRlJBTUVSX1lDQkNSNDIwIDw8
IENETlNfRFBfRlJBTUVSX1BYTF9GT1JNQVQ7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXB4bF9y
ZXByID0gQ0ROU19EUF9GUkFNRVJfWV9PTkxZIDw8IENETlNfRFBfRlJBTUVSX1BYTF9GT1JNQVQ7
CisJfQorCisJc3dpdGNoIChicGMpIHsKKwljYXNlIDY6CisJCW1pc2MwIHw9IERQX1RFU1RfQklU
X0RFUFRIXzY7CisJCXB4bF9yZXByIHw9IENETlNfRFBfRlJBTUVSXzZfQlBDOworCQlicmVhazsK
KwljYXNlIDg6CisJCW1pc2MwIHw9IERQX1RFU1RfQklUX0RFUFRIXzg7CisJCXB4bF9yZXByIHw9
IENETlNfRFBfRlJBTUVSXzhfQlBDOworCQlicmVhazsKKwljYXNlIDEwOgorCQltaXNjMCB8PSBE
UF9URVNUX0JJVF9ERVBUSF8xMDsKKwkJcHhsX3JlcHIgfD0gQ0ROU19EUF9GUkFNRVJfMTBfQlBD
OworCQlicmVhazsKKwljYXNlIDEyOgorCQltaXNjMCB8PSBEUF9URVNUX0JJVF9ERVBUSF8xMjsK
KwkJcHhsX3JlcHIgfD0gQ0ROU19EUF9GUkFNRVJfMTJfQlBDOworCQlicmVhazsKKwljYXNlIDE2
OgorCQltaXNjMCB8PSBEUF9URVNUX0JJVF9ERVBUSF8xNjsKKwkJcHhsX3JlcHIgfD0gQ0ROU19E
UF9GUkFNRVJfMTZfQlBDOworCQlicmVhazsKKwl9CisKKwlibmRfaHN5bmMydnN5bmMgPSBDRE5T
X0lQX0JZUEFTU19WX0lOVEVSRkFDRTsKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFH
X0lOVEVSTEFDRSkKKwkJYm5kX2hzeW5jMnZzeW5jIHw9IENETlNfSVBfREVUX0lOVEVSTEFDRV9G
T1JNQVQ7CisKKwljZG5zX21oZHBfcmVnX3dyaXRlKG1oZHAsIENETlNfQk5EX0hTWU5DMlZTWU5D
KHN0cmVhbV9pZCksCisJCQkgICAgYm5kX2hzeW5jMnZzeW5jKTsKKworCWhzeW5jMnZzeW5jX3Bv
bF9jdHJsID0gMDsKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX05IU1lOQykKKwkJ
aHN5bmMydnN5bmNfcG9sX2N0cmwgfD0gQ0ROU19IMlZfSFNZTkNfUE9MX0FDVElWRV9MT1c7CisJ
aWYgKG1vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19OVlNZTkMpCisJCWhzeW5jMnZzeW5jX3Bv
bF9jdHJsIHw9IENETlNfSDJWX1ZTWU5DX1BPTF9BQ1RJVkVfTE9XOworCWNkbnNfbWhkcF9yZWdf
d3JpdGUobWhkcCwgQ0ROU19IU1lOQzJWU1lOQ19QT0xfQ1RSTChzdHJlYW1faWQpLAorCQkJICAg
IGhzeW5jMnZzeW5jX3BvbF9jdHJsKTsKKworCWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0RO
U19EUF9GUkFNRVJfUFhMX1JFUFIoc3RyZWFtX2lkKSwgcHhsX3JlcHIpOworCisJaWYgKG1vZGUt
PmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpCisJCWRwX2ZyYW1lcl9zcCB8PSBDRE5T
X0RQX0ZSQU1FUl9JTlRFUkxBQ0U7CisJaWYgKG1vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19O
SFNZTkMpCisJCWRwX2ZyYW1lcl9zcCB8PSBDRE5TX0RQX0ZSQU1FUl9IU1lOQ19QT0xfTE9XOwor
CWlmIChtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfTlZTWU5DKQorCQlkcF9mcmFtZXJfc3Ag
fD0gQ0ROU19EUF9GUkFNRVJfVlNZTkNfUE9MX0xPVzsKKwljZG5zX21oZHBfcmVnX3dyaXRlKG1o
ZHAsIENETlNfRFBfRlJBTUVSX1NQKHN0cmVhbV9pZCksIGRwX2ZyYW1lcl9zcCk7CisKKwlmcm9u
dF9wb3JjaCA9IG1vZGUtPmNydGNfaHN5bmNfc3RhcnQgLSBtb2RlLT5jcnRjX2hkaXNwbGF5Owor
CWJhY2tfcG9yY2ggPSBtb2RlLT5jcnRjX2h0b3RhbCAtIG1vZGUtPmNydGNfaHN5bmNfZW5kOwor
CWNkbnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9GUk9OVF9CQUNLX1BPUkNIKHN0cmVh
bV9pZCksCisJCQkgICAgQ0ROU19EUF9GUk9OVF9QT1JDSChmcm9udF9wb3JjaCkgfAorCQkJICAg
IENETlNfRFBfQkFDS19QT1JDSChiYWNrX3BvcmNoKSk7CisKKwljZG5zX21oZHBfcmVnX3dyaXRl
KG1oZHAsIENETlNfRFBfQllURV9DT1VOVChzdHJlYW1faWQpLAorCQkJICAgIG1vZGUtPmNydGNf
aGRpc3BsYXkgKiBicHAgLyA4KTsKKworCW1zYV9oMCA9IG1vZGUtPmNydGNfaHRvdGFsIC0gbW9k
ZS0+Y3J0Y19oc3luY19zdGFydDsKKwljZG5zX21oZHBfcmVnX3dyaXRlKG1oZHAsIENETlNfRFBf
TVNBX0hPUklaT05UQUxfMChzdHJlYW1faWQpLAorCQkJICAgIENETlNfRFBfTVNBSDBfSF9UT1RB
TChtb2RlLT5jcnRjX2h0b3RhbCkgfAorCQkJICAgIENETlNfRFBfTVNBSDBfSFNZTkNfU1RBUlQo
bXNhX2gwKSk7CisKKwloc3luYyA9IG1vZGUtPmNydGNfaHN5bmNfZW5kIC0gbW9kZS0+Y3J0Y19o
c3luY19zdGFydDsKKwltc2FfaG9yaXpvbnRhbF8xID0gQ0ROU19EUF9NU0FIMV9IU1lOQ19XSURU
SChoc3luYykgfAorCQkJICAgQ0ROU19EUF9NU0FIMV9IRElTUF9XSURUSChtb2RlLT5jcnRjX2hk
aXNwbGF5KTsKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX05IU1lOQykKKwkJbXNh
X2hvcml6b250YWxfMSB8PSBDRE5TX0RQX01TQUgxX0hTWU5DX1BPTF9MT1c7CisJY2Ruc19taGRw
X3JlZ193cml0ZShtaGRwLCBDRE5TX0RQX01TQV9IT1JJWk9OVEFMXzEoc3RyZWFtX2lkKSwKKwkJ
CSAgICBtc2FfaG9yaXpvbnRhbF8xKTsKKworCW1zYV92MCA9IG1vZGUtPmNydGNfdnRvdGFsIC0g
bW9kZS0+Y3J0Y192c3luY19zdGFydDsKKwljZG5zX21oZHBfcmVnX3dyaXRlKG1oZHAsIENETlNf
RFBfTVNBX1ZFUlRJQ0FMXzAoc3RyZWFtX2lkKSwKKwkJCSAgICBDRE5TX0RQX01TQVYwX1ZfVE9U
QUwobW9kZS0+Y3J0Y192dG90YWwpIHwKKwkJCSAgICBDRE5TX0RQX01TQVYwX1ZTWU5DX1NUQVJU
KG1zYV92MCkpOworCisJdnN5bmMgPSBtb2RlLT5jcnRjX3ZzeW5jX2VuZCAtIG1vZGUtPmNydGNf
dnN5bmNfc3RhcnQ7CisJbXNhX3ZlcnRpY2FsXzEgPSBDRE5TX0RQX01TQVYxX1ZTWU5DX1dJRFRI
KHZzeW5jKSB8CisJCQkgQ0ROU19EUF9NU0FWMV9WRElTUF9XSURUSChtb2RlLT5jcnRjX3ZkaXNw
bGF5KTsKKwlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX05WU1lOQykKKwkJbXNhX3Zl
cnRpY2FsXzEgfD0gQ0ROU19EUF9NU0FWMV9WU1lOQ19QT0xfTE9XOworCWNkbnNfbWhkcF9yZWdf
d3JpdGUobWhkcCwgQ0ROU19EUF9NU0FfVkVSVElDQUxfMShzdHJlYW1faWQpLAorCQkJICAgIG1z
YV92ZXJ0aWNhbF8xKTsKKworCWlmICgobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVS
TEFDRSkgJiYKKwkgICAgbW9kZS0+Y3J0Y192dG90YWwgJSAyID09IDApCisJCW1pc2MxID0gRFBf
VEVTVF9JTlRFUkxBQ0VEOworCWlmIChtaGRwLT5kaXNwbGF5X2ZtdC55X29ubHkpCisJCW1pc2Mx
IHw9IENETlNfRFBfVEVTVF9DT0xPUl9GT1JNQVRfUkFXX1lfT05MWTsKKwkvKiBGSVhNRTogdXNl
IFZTQyBTRFAgZm9yIFk0MjAgKi8KKwkvKiBGSVhNRTogKENETlMpIG5vIGNvZGUgZm9yIFk0MjAg
aW4gYmFyZSBtZXRhbCB0ZXN0ICovCisJaWYgKHB4bGZtdCA9PSBEUk1fQ09MT1JfRk9STUFUX1lD
UkNCNDIwKQorCQltaXNjMSA9IENETlNfRFBfVEVTVF9WU0NfU0RQOworCisJY2Ruc19taGRwX3Jl
Z193cml0ZShtaGRwLCBDRE5TX0RQX01TQV9NSVNDKHN0cmVhbV9pZCksCisJCQkgICAgbWlzYzAg
fCAobWlzYzEgPDwgOCkpOworCisJY2Ruc19taGRwX3JlZ193cml0ZShtaGRwLCBDRE5TX0RQX0hP
UklaT05UQUwoc3RyZWFtX2lkKSwKKwkJCSAgICBDRE5TX0RQX0hfSFNZTkNfV0lEVEgoaHN5bmMp
IHwKKwkJCSAgICBDRE5TX0RQX0hfSF9UT1RBTChtb2RlLT5jcnRjX2hkaXNwbGF5KSk7CisKKwlj
ZG5zX21oZHBfcmVnX3dyaXRlKG1oZHAsIENETlNfRFBfVkVSVElDQUxfMChzdHJlYW1faWQpLAor
CQkJICAgIENETlNfRFBfVjBfVkhFSUdIVChtb2RlLT5jcnRjX3ZkaXNwbGF5KSB8CisJCQkgICAg
Q0ROU19EUF9WMF9WU1RBUlQobXNhX3YwKSk7CisKKwlkcF92ZXJ0aWNhbF8xID0gQ0ROU19EUF9W
MV9WVE9UQUwobW9kZS0+Y3J0Y192dG90YWwpOworCWlmICgobW9kZS0+ZmxhZ3MgJiBEUk1fTU9E
RV9GTEFHX0lOVEVSTEFDRSkgJiYKKwkgICAgbW9kZS0+Y3J0Y192dG90YWwgJSAyID09IDApCisJ
CWRwX3ZlcnRpY2FsXzEgfD0gQ0ROU19EUF9WMV9WVE9UQUxfRVZFTjsKKworCWNkbnNfbWhkcF9y
ZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9WRVJUSUNBTF8xKHN0cmVhbV9pZCksIGRwX3ZlcnRpY2Fs
XzEpOworCisJY2Ruc19taGRwX3JlZ193cml0ZV9iaXQobWhkcCwgQ0ROU19EUF9WQl9JRChzdHJl
YW1faWQpLCAyLCAxLAorCQkJCShtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNF
KSA/CisJCQkJQ0ROU19EUF9WQl9JRF9JTlRFUkxBQ0VEIDogMCk7CisKKwljZG5zX21oZHBfcmVn
X3JlYWQobWhkcCwgQ0ROU19EUF9GUkFNRVJfR0xPQkFMX0NPTkZJRywgJnRtcCk7CisJdG1wIHw9
IENETlNfRFBfRlJBTUVSX0VOOworCXRtcCAmPSB+Q0ROU19EUF9OT19WSURFT19NT0RFOworCWNk
bnNfbWhkcF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUF9GUkFNRVJfR0xPQkFMX0NPTkZJRywgdG1w
KTsKK30KKwordm9pZCBjZG5zX21oZHBfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
Cit7CisJc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHAgPSBicmlkZ2VfdG9fbWhkcChicmlk
Z2UpOworCXUzMiByZXNwOworCisJZGV2X2RiZyhtaGRwLT5kZXYsICJicmlkZ2UgZW5hYmxlXG4i
KTsKKworCWlmIChtaGRwLT5vcHMgJiYgbWhkcC0+b3BzLT5lbmFibGUpCisJCW1oZHAtPm9wcy0+
ZW5hYmxlKG1oZHApOworCisJLyogRW5hYmxlIFZJRiBjbG9jayBmb3Igc3RyZWFtIDAgKi8KKwlj
ZG5zX21oZHBfcmVnX3JlYWQobWhkcCwgQ0ROU19EUFRYX0NBUiwgJnJlc3ApOworCWNkbnNfbWhk
cF9yZWdfd3JpdGUobWhkcCwgQ0ROU19EUFRYX0NBUiwKKwkJCSAgICByZXNwIHwgQ0ROU19WSUZf
Q0xLX0VOIHwgQ0ROU19WSUZfQ0xLX1JTVE4pOworCisJaWYgKCFtaGRwLT5saW5rX3VwKQorCQlj
ZG5zX21oZHBfbGlua191cChtaGRwKTsKKworCWNkbnNfbWhkcF9zc3RfZW5hYmxlKGJyaWRnZSk7
Cit9CisKK3N0YXRpYyB2b2lkIGNkbnNfbWhkcF9kZXRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSkKK3sKKwlzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSAqbWhkcCA9IGJyaWRnZV90b19taGRw
KGJyaWRnZSk7CisKKwlkZXZfZGJnKG1oZHAtPmRldiwgIiVzXG4iLCBfX2Z1bmNfXyk7CisKKwlz
cGluX2xvY2soJm1oZHAtPnN0YXJ0X2xvY2spOworCisJbWhkcC0+YnJpZGdlX2F0dGFjaGVkID0g
ZmFsc2U7CisKKwlzcGluX3VubG9jaygmbWhkcC0+c3RhcnRfbG9jayk7CisKKwl3cml0ZWwofjAs
IG1oZHAtPnJlZ3MgKyBDRE5TX0FQQl9JTlRfTUFTSyk7CisJd3JpdGVsKH4wLCBtaGRwLT5yZWdz
ICsgQ0ROU19NQl9JTlRfTUFTSyk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2JyaWRn
ZV9mdW5jcyBjZG5zX21oZHBfYnJpZGdlX2Z1bmNzID0geworCS5lbmFibGUgPSBjZG5zX21oZHBf
ZW5hYmxlLAorCS5kaXNhYmxlID0gY2Ruc19taGRwX2Rpc2FibGUsCisJLmF0dGFjaCA9IGNkbnNf
bWhkcF9hdHRhY2gsCisJLmRldGFjaCA9IGNkbnNfbWhkcF9kZXRhY2gsCit9OworCitzdGF0aWMg
aW50IG1oZHBfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwljb25zdCBz
dHJ1Y3Qgb2ZfZGV2aWNlX2lkICptYXRjaDsKKwlzdHJ1Y3QgcmVzb3VyY2UgKnJlZ3M7CisJc3Ry
dWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHA7CisJc3RydWN0IGNsayAqY2xrOworCWludCByZXQ7
CisJdW5zaWduZWQgbG9uZyByYXRlOworCWludCBpcnE7CisJdTMyIGxhbmVzX3Byb3A7CisJdW5z
aWduZWQgaW50IGxpbmtfcmF0ZTsKKworCW1oZHAgPSBkZXZtX2t6YWxsb2MoJnBkZXYtPmRldiwg
c2l6ZW9mKHN0cnVjdCBjZG5zX21oZHBfZGV2aWNlKSwKKwkJCSAgICBHRlBfS0VSTkVMKTsKKwlp
ZiAoIW1oZHApCisJCXJldHVybiAtRU5PTUVNOworCisJY2xrID0gZGV2bV9jbGtfZ2V0KCZwZGV2
LT5kZXYsIE5VTEwpOworCWlmIChJU19FUlIoY2xrKSkgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYs
ICJjb3VsZG4ndCBnZXQgY2xrOiAlbGRcbiIsIFBUUl9FUlIoY2xrKSk7CisJCXJldHVybiBQVFJf
RVJSKGNsayk7CisJfQorCisJbWhkcC0+Y2xrID0gY2xrOworCW1oZHAtPmRldiA9ICZwZGV2LT5k
ZXY7CisJbWhkcC0+Y29ubl9idXNfZmxhZ3NfZGVmYXVsdHMgPSBEUk1fQlVTX0ZMQUdfREVfSElH
SDsKKwltdXRleF9pbml0KCZtaGRwLT5tYm94X211dGV4KTsKKwlzcGluX2xvY2tfaW5pdCgmbWhk
cC0+c3RhcnRfbG9jayk7CisJZGV2X3NldF9kcnZkYXRhKCZwZGV2LT5kZXYsIG1oZHApOworCisJ
ZHJtX2RwX2F1eF9pbml0KCZtaGRwLT5hdXgpOworCW1oZHAtPmF1eC5kZXYgPSAmcGRldi0+ZGV2
OworCW1oZHAtPmF1eC50cmFuc2ZlciA9IG1oZHBfdHJhbnNmZXI7CisKKwlyZWdzID0gcGxhdGZv
cm1fZ2V0X3Jlc291cmNlKHBkZXYsIElPUkVTT1VSQ0VfTUVNLCAwKTsKKwltaGRwLT5yZWdzID0g
ZGV2bV9pb3JlbWFwX3Jlc291cmNlKCZwZGV2LT5kZXYsIHJlZ3MpOworCWlmIChJU19FUlIobWhk
cC0+cmVncykpCisJCXJldHVybiBQVFJfRVJSKG1oZHAtPnJlZ3MpOworCisJbWhkcC0+cGh5ID0g
ZGV2bV9waHlfZ2V0KCZwZGV2LT5kZXYsICJkcHBoeSIpOworCWlmIChJU19FUlIobWhkcC0+cGh5
KSkgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJubyBQSFkgY29uZmlndXJlZFxuIik7CisJCXJl
dHVybiBQVFJfRVJSKG1oZHAtPnBoeSk7CisJfQorCisJcGxhdGZvcm1fc2V0X2RydmRhdGEocGRl
diwgbWhkcCk7CisKKwljbGtfcHJlcGFyZV9lbmFibGUoY2xrKTsKKworCW1hdGNoID0gb2ZfbWF0
Y2hfZGV2aWNlKG1oZHBfaWRzLCAmcGRldi0+ZGV2KTsKKwlpZiAoIW1hdGNoKQorCQlyZXR1cm4g
LUVOT0RFVjsKKwltaGRwLT5vcHMgPSAoc3RydWN0IG1oZHBfcGxhdGZvcm1fb3BzICopbWF0Y2gt
PmRhdGE7CisKKwlwbV9ydW50aW1lX2VuYWJsZSgmcGRldi0+ZGV2KTsKKwlyZXQgPSBwbV9ydW50
aW1lX2dldF9zeW5jKCZwZGV2LT5kZXYpOworCWlmIChyZXQgPCAwKSB7CisJCWRldl9lcnIoJnBk
ZXYtPmRldiwgInBtX3J1bnRpbWVfZ2V0X3N5bmMgZmFpbGVkXG4iKTsKKwkJcG1fcnVudGltZV9k
aXNhYmxlKCZwZGV2LT5kZXYpOworCQlnb3RvIGNsa19kaXNhYmxlOworCX0KKworCWlmIChtaGRw
LT5vcHMgJiYgbWhkcC0+b3BzLT5pbml0KSB7CisJCXJldCA9IG1oZHAtPm9wcy0+aW5pdChtaGRw
KTsKKwkJaWYgKHJldCAhPSAwKSB7CisJCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJNSERQIHBsYXRm
b3JtIGluaXRpYWxpemF0aW9uIGZhaWxlZDogJWRcbiIsCisJCQkJcmV0KTsKKwkJCWdvdG8gcnVu
dGltZV9wdXQ7CisJCX0KKwl9CisKKwlyYXRlID0gY2xrX2dldF9yYXRlKGNsayk7CisJd3JpdGVs
KHJhdGUgJSAxMDAwMDAwLCBtaGRwLT5yZWdzICsgQ0ROU19TV19DTEtfTCk7CisJd3JpdGVsKHJh
dGUgLyAxMDAwMDAwLCBtaGRwLT5yZWdzICsgQ0ROU19TV19DTEtfSCk7CisKKwlkZXZfZGJnKCZw
ZGV2LT5kZXYsICJmdW5jIGNsayByYXRlICVsdSBIelxuIiwgcmF0ZSk7CisKKwl3cml0ZWwofjAs
IG1oZHAtPnJlZ3MgKyBDRE5TX01CX0lOVF9NQVNLKTsKKwl3cml0ZWwofjAsIG1oZHAtPnJlZ3Mg
KyBDRE5TX0FQQl9JTlRfTUFTSyk7CisKKwlpcnEgPSBwbGF0Zm9ybV9nZXRfaXJxKHBkZXYsIDAp
OworCXJldCA9IGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEobWhkcC0+ZGV2LCBpcnEsIE5VTEws
IG1oZHBfaXJxX2hhbmRsZXIsCisJCQkJCUlSUUZfT05FU0hPVCwgIm1oZHA4NTQ2IiwgbWhkcCk7
CisJaWYgKHJldCkgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJjYW5ub3QgaW5zdGFsbCBJUlEg
JWRcbiIsIGlycSk7CisJCXJldCA9IC1FSU87CisJCWdvdG8gcGxhdF9maW5pOworCX0KKworCS8q
IFJlYWQgc291cmNlIGNhcGFiaWxpdGllcywgYmFzZWQgb24gUEhZJ3MgZGV2aWNlIHRyZWUgcHJv
cGVydGllcy4gKi8KKwlyZXQgPSBkZXZpY2VfcHJvcGVydHlfcmVhZF91MzIoJm1oZHAtPnBoeS0+
ZGV2LCAibnVtX2xhbmVzIiwKKwkJCQkgICAgICAgJihsYW5lc19wcm9wKSk7CisJaWYgKHJldCkK
KwkJbWhkcC0+aG9zdC5sYW5lc19jbnQgPSBDRE5TX0xBTkVfNDsKKwllbHNlCisJCW1oZHAtPmhv
c3QubGFuZXNfY250ID0gbGFuZXNfcHJvcDsKKworCXJldCA9IGRldmljZV9wcm9wZXJ0eV9yZWFk
X3UzMigmbWhkcC0+cGh5LT5kZXYsICJtYXhfYml0X3JhdGUiLAorCQkJCSAgICAgICAmKGxpbmtf
cmF0ZSkpOworCWlmIChyZXQpCisJCWxpbmtfcmF0ZSA9IGRybV9kcF9id19jb2RlX3RvX2xpbmtf
cmF0ZShEUF9MSU5LX0JXXzhfMSk7CisJZWxzZQorCQkvKiBQSFkgdXNlcyBNYi9zLCBEUk0gdXNl
cyB0ZW5zIG9mIGtiL3MuICovCisJCWxpbmtfcmF0ZSAqPSAxMDA7CisKKwltaGRwLT5ob3N0Lmxp
bmtfcmF0ZSA9IGxpbmtfcmF0ZTsKKwltaGRwLT5ob3N0LnZvbHRfc3dpbmcgPSBDRE5TX1ZPTFRf
U1dJTkcoMyk7CisJbWhkcC0+aG9zdC5wcmVfZW1waGFzaXMgPSBDRE5TX1BSRV9FTVBIQVNJUygz
KTsKKwltaGRwLT5ob3N0LnBhdHRlcm5fc3VwcCA9IENETlNfU1VQUE9SVF9UUFMoMSkgfAorCQkJ
CSAgQ0ROU19TVVBQT1JUX1RQUygyKSB8IENETlNfU1VQUE9SVF9UUFMoMykgfAorCQkJCSAgQ0RO
U19TVVBQT1JUX1RQUyg0KTsKKwltaGRwLT5ob3N0LmxhbmVfbWFwcGluZyA9IENETlNfTEFORV9N
QVBQSU5HX05PUk1BTDsKKwltaGRwLT5ob3N0LmZhc3RfbGluayA9IGZhbHNlOworCW1oZHAtPmhv
c3QuZW5oYW5jZWQgPSB0cnVlOworCW1oZHAtPmhvc3Quc2NyYW1ibGVyID0gdHJ1ZTsKKwltaGRw
LT5ob3N0LnNzYyA9IGZhbHNlOworCisJLyogVGhlIG9ubHkgY3VycmVudGx5IHN1cHBvcnRlZCBm
b3JtYXQgKi8KKwltaGRwLT5kaXNwbGF5X2ZtdC55X29ubHkgPSBmYWxzZTsKKwltaGRwLT5kaXNw
bGF5X2ZtdC5jb2xvcl9mb3JtYXQgPSBEUk1fQ09MT1JfRk9STUFUX1JHQjQ0NDsKKwltaGRwLT5k
aXNwbGF5X2ZtdC5icGMgPSA4OworCisJbWhkcC0+YnJpZGdlLm9mX25vZGUgPSBwZGV2LT5kZXYu
b2Zfbm9kZTsKKwltaGRwLT5icmlkZ2UuZnVuY3MgPSAmY2Ruc19taGRwX2JyaWRnZV9mdW5jczsK
KworCXJldCA9IHBoeV9pbml0KG1oZHAtPnBoeSk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKG1o
ZHAtPmRldiwgIkZhaWxlZCB0byBpbml0aWFsaXplIFBIWTogJWRcbiIsIHJldCk7CisJCWdvdG8g
cnVudGltZV9wdXQ7CisJfQorCisJZHJtX2JyaWRnZV9hZGQoJm1oZHAtPmJyaWRnZSk7CisKKwly
ZXQgPSBsb2FkX2Zpcm13YXJlKG1oZHApOworCWlmIChyZXQpCisJCWdvdG8gcGh5X2V4aXQ7CisK
KwlyZXR1cm4gMDsKKworcGh5X2V4aXQ6CisJcGh5X2V4aXQobWhkcC0+cGh5KTsKK3BsYXRfZmlu
aToKKwlpZiAobWhkcC0+b3BzICYmIG1oZHAtPm9wcy0+ZXhpdCkKKwkJbWhkcC0+b3BzLT5leGl0
KG1oZHApOworcnVudGltZV9wdXQ6CisJcG1fcnVudGltZV9wdXRfc3luYygmcGRldi0+ZGV2KTsK
KwlwbV9ydW50aW1lX2Rpc2FibGUoJnBkZXYtPmRldik7CitjbGtfZGlzYWJsZToKKwljbGtfZGlz
YWJsZV91bnByZXBhcmUobWhkcC0+Y2xrKTsKKworCXJldHVybiByZXQ7Cit9CisKK01PRFVMRV9G
SVJNV0FSRShGV19OQU1FKTsKKworc3RhdGljIGludCBtaGRwX3JlbW92ZShzdHJ1Y3QgcGxhdGZv
cm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCBjZG5zX21oZHBfZGV2aWNlICptaGRwID0gZGV2
X2dldF9kcnZkYXRhKCZwZGV2LT5kZXYpOworCXVuc2lnbmVkIGludCB0aW1lb3V0ID0gMTA7CisJ
Ym9vbCBzdG9wX2Z3ID0gZmFsc2U7CisJaW50IHJldCA9IDA7CisKKwlpZiAobWhkcC0+b3BzICYm
IG1oZHAtPm9wcy0+ZXhpdCkKKwkJbWhkcC0+b3BzLT5leGl0KG1oZHApOworCisJZHJtX2JyaWRn
ZV9yZW1vdmUoJm1oZHAtPmJyaWRnZSk7CisKK3dhaXRfbG9hZGluZzoKKwlzcGluX2xvY2soJm1o
ZHAtPnN0YXJ0X2xvY2spOworCWlmIChtaGRwLT5od19zdGF0ZSA9PSBNSERQX0hXX0xPQURJTkcg
JiYgdGltZW91dC0tID4gMCkgeworCQlzcGluX3VubG9jaygmbWhkcC0+c3RhcnRfbG9jayk7CisJ
CW1zbGVlcCgxMDApOworCQlnb3RvIHdhaXRfbG9hZGluZzsKKwl9IGVsc2UgaWYgKG1oZHAtPmh3
X3N0YXRlID09IE1IRFBfSFdfUkVBRFkpIHsKKwkJc3RvcF9mdyA9IHRydWU7CisJCXRpbWVvdXQg
PSAxOyAvKiBXZSB3ZXJlIHN1Y2Nlc3NmdWwgZXZlbiBpZiBjb3VudGVyIHJlYWNoZWQgMCAqLwor
CX0KKwltaGRwLT5od19zdGF0ZSA9IE1IRFBfSFdfU1RPUFBFRDsKKwlzcGluX3VubG9jaygmbWhk
cC0+c3RhcnRfbG9jayk7CisKKwlpZiAodGltZW91dCA9PSAwKQorCQlkZXZfZXJyKG1oZHAtPmRl
diwgIiVzOiBUaW1lb3V0IHdhaXRpbmcgZm9yIGZ3IGxvYWRpbmdcbiIsCisJCQlfX2Z1bmNfXyk7
CisKKwlpZiAoc3RvcF9mdykgeworCQlyZXQgPSBjZG5zX21oZHBfc2V0X2Zpcm13YXJlX2FjdGl2
ZShtaGRwLCBmYWxzZSk7CisJCWlmIChyZXQpCisJCQlkZXZfZXJyKG1oZHAtPmRldiwgIiVzOiBE
ZS1hY3RpdmF0ZSBGVyBmYWlsZWQ6ICVkXG4iLAorCQkJCV9fZnVuY19fLCByZXQpOworCX0KKwor
CXBoeV9leGl0KG1oZHAtPnBoeSk7CisKKwlwbV9ydW50aW1lX3B1dF9zeW5jKCZwZGV2LT5kZXYp
OworCXBtX3J1bnRpbWVfZGlzYWJsZSgmcGRldi0+ZGV2KTsKKworCWNsa19kaXNhYmxlX3VucHJl
cGFyZShtaGRwLT5jbGspOworCisJLyogRklYTUU6IGNoZWNrIGZvciBtaXNzaW5nIGZ1bmN0aW9u
cyAqLworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHN0cnVjdCBwbGF0Zm9ybV9kcml2ZXIg
bWhkcF9kcml2ZXIgPSB7CisJLmRyaXZlcgk9IHsKKwkJLm5hbWUJCT0gImNkbnMtbWhkcCIsCisJ
CS5vZl9tYXRjaF90YWJsZQk9IG9mX21hdGNoX3B0cihtaGRwX2lkcyksCisJfSwKKwkucHJvYmUJ
PSBtaGRwX3Byb2JlLAorCS5yZW1vdmUJPSBtaGRwX3JlbW92ZSwKK307Cittb2R1bGVfcGxhdGZv
cm1fZHJpdmVyKG1oZHBfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigiUXVlbnRpbiBTY2h1bHog
PHF1ZW50aW4uc2NodWx6QGZyZWUtZWxlY3Ryb25zLmNvbT4iKTsKK01PRFVMRV9BVVRIT1IoIlBy
emVteXNsYXcgR2FqIDxwZ2FqQGNhZGVuY2UuY29tPiIpOworTU9EVUxFX0FVVEhPUigiRGFtaWFu
IEtvcyA8ZGtvc0BjYWRlbmNlLmNvbT4iKTsKK01PRFVMRV9BVVRIT1IoIlBpb3RyIFNyb2thIDxw
aW90cnNAY2FkZW5jZS5jb20+Iik7CitNT0RVTEVfQVVUSE9SKCJTd2FwbmlsIEpha2hhZGUgPHNq
YWtoYWRlQGNhZGVuY2UuY29tPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJDYWRlbmNlIE1IRFAg
RFAgYnJpZGdlIGRyaXZlciIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOworTU9EVUxFX0FMSUFT
KCJwbGF0Zm9ybTpjZG5zLW1oZHAiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9icmlk
Z2UvY2Rucy1taGRwLmggYi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2NkbnMtbWhkcC5oCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjlhY2I4OWQKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2NkbnMtbWhkcC5oCkBAIC0wLDAgKzEsMzgwIEBACisv
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLworLyoKKyAqIENhZGVuY2UgTUhE
UCBEUCBicmlkZ2UgZHJpdmVyLgorICoKKyAqIENvcHlyaWdodDogMjAxOSBDYWRlbmNlIERlc2ln
biBTeXN0ZW1zLCBJbmMuCisgKgorICogQXV0aG9yOiBRdWVudGluIFNjaHVseiA8cXVlbnRpbi5z
Y2h1bHpAZnJlZS1lbGVjdHJvbnMuY29tPgorICogICAgICAgICBTd2FwbmlsIEpha2hhZGUgPHNq
YWtoYWRlQGNhZGVuY2UuY29tPgorICovCisKKyNpZm5kZWYgQ0ROU19NSERQX0gKKyNkZWZpbmUg
Q0ROU19NSERQX0gKKworI2luY2x1ZGUgPGRybS9kcm1fYnJpZGdlLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RwX2hlbHBlci5oPgorCisvKiBS
ZWdpc3RlciBvZmZzZXRzICovCisjZGVmaW5lIENETlNfQVBCX0NGRwkJCQkweDAwMDAwCisjZGVm
aW5lIENETlNfQVBCX0NUUkwJCQkJKENETlNfQVBCX0NGRyArIDB4MDApCisjZGVmaW5lIENETlNf
Q1BVX1NUQUxMCQkJCUJJVCgzKQorCisjZGVmaW5lIENETlNfTUFJTEJPWF9GVUxMCQkJKENETlNf
QVBCX0NGRyArIDB4MDgpCisjZGVmaW5lIENETlNfTUFJTEJPWF9FTVBUWQkJCShDRE5TX0FQQl9D
RkcgKyAweDBjKQorI2RlZmluZSBDRE5TX01BSUxCT1hfVFhfREFUQQkJCShDRE5TX0FQQl9DRkcg
KyAweDEwKQorI2RlZmluZSBDRE5TX01BSUxCT1hfUlhfREFUQQkJCShDRE5TX0FQQl9DRkcgKyAw
eDE0KQorI2RlZmluZSBDRE5TX0tFRVBfQUxJVkUJCQkJKENETlNfQVBCX0NGRyArIDB4MTgpCisj
ZGVmaW5lIENETlNfS0VFUF9BTElWRV9NQVNLCQkJR0VOTUFTSyg3LCAwKQorCisjZGVmaW5lIENE
TlNfTUJfSU5UX01BU0sJCQkoQ0ROU19BUEJfQ0ZHICsgMHgzNCkKKyNkZWZpbmUgQ0ROU19NQl9J
TlRfU1RBVFVTCQkJKENETlNfQVBCX0NGRyArIDB4MzgpCisKKyNkZWZpbmUgQ0ROU19TV19DTEtf
TAkJCQkoQ0ROU19BUEJfQ0ZHICsgMHgzYykKKyNkZWZpbmUgQ0ROU19TV19DTEtfSAkJCQkoQ0RO
U19BUEJfQ0ZHICsgMHg0MCkKKyNkZWZpbmUgQ0ROU19TV19FVkVOVDAJCQkJKENETlNfQVBCX0NG
RyArIDB4NDQpCisjZGVmaW5lIENETlNfRFBUWF9IUEQJCQkJQklUKDApCisKKyNkZWZpbmUgQ0RO
U19TV19FVkVOVDEJCQkJKENETlNfQVBCX0NGRyArIDB4NDgpCisjZGVmaW5lIENETlNfU1dfRVZF
TlQyCQkJCShDRE5TX0FQQl9DRkcgKyAweDRjKQorI2RlZmluZSBDRE5TX1NXX0VWRU5UMwkJCQko
Q0ROU19BUEJfQ0ZHICsgMHg1MCkKKworI2RlZmluZSBDRE5TX0FQQl9JTlRfTUFTSwkJCShDRE5T
X0FQQl9DRkcgKyAweDZDKQorI2RlZmluZSBDRE5TX0FQQl9JTlRfTUFTS19NQUlMQk9YX0lOVAkJ
QklUKDApCisjZGVmaW5lIENETlNfQVBCX0lOVF9NQVNLX1NXX0VWRU5UX0lOVAkJQklUKDEpCisj
ZGVmaW5lIENETlNfQVBCX0lOVF9TVEFUVVMJCQkoQ0ROU19BUEJfQ0ZHICsgMHg3MCkKKworI2Rl
ZmluZSBDRE5TX0RQVFhfQ0FSCQkJCShDRE5TX0FQQl9DRkcgKyAweDkwNCkKKyNkZWZpbmUgQ0RO
U19WSUZfQ0xLX0VOCQkJCUJJVCgwKQorI2RlZmluZSBDRE5TX1ZJRl9DTEtfUlNUTgkJCUJJVCgx
KQorCisjZGVmaW5lIENETlNfU09VUkNFX1ZJREVPX0lGKHMpCQkJKDB4MDBiMDAgKyAoKHMpICog
MHgyMCkpCisjZGVmaW5lIENETlNfQk5EX0hTWU5DMlZTWU5DKHMpCQkJKENETlNfU09VUkNFX1ZJ
REVPX0lGKHMpICsgXAorCQkJCQkJIDB4MDApCisjZGVmaW5lIENETlNfSVBfRFRDVF9XSU4JCQlH
RU5NQVNLKDExLCAwKQorI2RlZmluZSBDRE5TX0lQX0RFVF9JTlRFUkxBQ0VfRk9STUFUCQlCSVQo
MTIpCisjZGVmaW5lIENETlNfSVBfQllQQVNTX1ZfSU5URVJGQUNFCQlCSVQoMTMpCisKKyNkZWZp
bmUgQ0ROU19IU1lOQzJWU1lOQ19QT0xfQ1RSTChzKQkJKENETlNfU09VUkNFX1ZJREVPX0lGKHMp
ICsgXAorCQkJCQkJIDB4MTApCisjZGVmaW5lIENETlNfSDJWX0hTWU5DX1BPTF9BQ1RJVkVfTE9X
CQlCSVQoMSkKKyNkZWZpbmUgQ0ROU19IMlZfVlNZTkNfUE9MX0FDVElWRV9MT1cJCUJJVCgyKQor
CisjZGVmaW5lIENETlNfRFBUWF9QSFlfQ09ORklHCQkJMHgwMjAwMAorI2RlZmluZSBDRE5TX1BI
WV9UUkFJTklOR19FTgkJCUJJVCgwKQorI2RlZmluZSBDRE5TX1BIWV9UUkFJTklOR19UWVBFKHgp
CQkoKCh4KSAmIEdFTk1BU0soMywgMCkpIDw8IDEpCisjZGVmaW5lIENETlNfUEhZX1NDUkFNQkxF
Ul9CWVBBU1MJCUJJVCg1KQorI2RlZmluZSBDRE5TX1BIWV9FTkNPREVSX0JZUEFTUwkJCUJJVCg2
KQorI2RlZmluZSBDRE5TX1BIWV9TS0VXX0JZUEFTUwkJCUJJVCg3KQorI2RlZmluZSBDRE5TX1BI
WV9UUkFJTklOR19BVVRPCQkJQklUKDgpCisjZGVmaW5lIENETlNfUEhZX0xBTkUwX1NLRVcoeCkJ
CQkoKCh4KSAmIEdFTk1BU0soMiwgMCkpIDw8IDkpCisjZGVmaW5lIENETlNfUEhZX0xBTkUxX1NL
RVcoeCkJCQkoKCh4KSAmIEdFTk1BU0soMiwgMCkpIDw8IDEyKQorI2RlZmluZSBDRE5TX1BIWV9M
QU5FMl9TS0VXKHgpCQkJKCgoeCkgJiBHRU5NQVNLKDIsIDApKSA8PCAxNSkKKyNkZWZpbmUgQ0RO
U19QSFlfTEFORTNfU0tFVyh4KQkJCSgoKHgpICYgR0VOTUFTSygyLCAwKSkgPDwgMTgpCisjZGVm
aW5lIENETlNfUEhZX0NPTU1PTl9DT05GSUcJCQkoQ0ROU19QSFlfTEFORTFfU0tFVygxKSB8IFwK
KwkJCQkJCUNETlNfUEhZX0xBTkUyX1NLRVcoMikgfCAgXAorCQkJCQkJQ0ROU19QSFlfTEFORTNf
U0tFVygzKSkKKyNkZWZpbmUgQ0ROU19QSFlfMTBCSVRfRU4JCQlCSVQoMjEpCisKKyNkZWZpbmUg
Q0ROU19EUFRYX0ZSQU1FUgkJCTB4MDIyMDAKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJfR0xPQkFM
X0NPTkZJRwkJKENETlNfRFBUWF9GUkFNRVIgKyAweDAwKQorI2RlZmluZSBDRE5TX0RQX05VTV9M
QU5FUyh4KQkJCSgoeCkgLSAxKQorI2RlZmluZSBDRE5TX0RQX01TVF9FTgkJCQlCSVQoMikKKyNk
ZWZpbmUgQ0ROU19EUF9GUkFNRVJfRU4JCQlCSVQoMykKKyNkZWZpbmUgQ0ROU19EUF9SQVRFX0dP
VkVSTk9SX0VOCQlCSVQoNCkKKyNkZWZpbmUgQ0ROU19EUF9OT19WSURFT19NT0RFCQkJQklUKDUp
CisjZGVmaW5lIENETlNfRFBfRElTQUJMRV9QSFlfUlNUCQkJQklUKDYpCisjZGVmaW5lIENETlNf
RFBfV1JfRkFJTElOR19FREdFX1ZTWU5DCQlCSVQoNykKKworI2RlZmluZSBDRE5TX0RQX0ZSQU1F
Ul9UVQkJCShDRE5TX0RQVFhfRlJBTUVSICsgMHgwOCkKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJf
VFVfU0laRSh4KQkJKCgoeCkgJiBHRU5NQVNLKDYsIDApKSA8PCA4KQorI2RlZmluZSBDRE5TX0RQ
X0ZSQU1FUl9UVV9WUyh4KQkJCSgoeCkgJiBHRU5NQVNLKDUsIDApKQorI2RlZmluZSBDRE5TX0RQ
X0ZSQU1FUl9UVV9DTlRfUlNUX0VOCQlCSVQoMTUpCisKKyNkZWZpbmUgQ0ROU19EUFRYX1NUUkVB
TShzKQkJCSgweDAzMDAwICsgKHMpICogMHg4MCkKKyNkZWZpbmUgQ0ROU19EUF9NU0FfSE9SSVpP
TlRBTF8wKHMpCQkoQ0ROU19EUFRYX1NUUkVBTShzKSArIDB4MDApCisjZGVmaW5lIENETlNfRFBf
TVNBSDBfSF9UT1RBTCh4KQkJKHgpCisjZGVmaW5lIENETlNfRFBfTVNBSDBfSFNZTkNfU1RBUlQo
eCkJCSgoeCkgPDwgMTYpCisKKyNkZWZpbmUgQ0ROU19EUF9NU0FfSE9SSVpPTlRBTF8xKHMpCQko
Q0ROU19EUFRYX1NUUkVBTShzKSArIDB4MDQpCisjZGVmaW5lIENETlNfRFBfTVNBSDFfSFNZTkNf
V0lEVEgoeCkJCSh4KQorI2RlZmluZSBDRE5TX0RQX01TQUgxX0hTWU5DX1BPTF9MT1cJCUJJVCgx
NSkKKyNkZWZpbmUgQ0ROU19EUF9NU0FIMV9IRElTUF9XSURUSCh4KQkJKCh4KSA8PCAxNikKKwor
I2RlZmluZSBDRE5TX0RQX01TQV9WRVJUSUNBTF8wKHMpCQkoQ0ROU19EUFRYX1NUUkVBTShzKSAr
IDB4MDgpCisjZGVmaW5lIENETlNfRFBfTVNBVjBfVl9UT1RBTCh4KQkJKHgpCisjZGVmaW5lIENE
TlNfRFBfTVNBVjBfVlNZTkNfU1RBUlQoeCkJCSgoeCkgPDwgMTYpCisKKyNkZWZpbmUgQ0ROU19E
UF9NU0FfVkVSVElDQUxfMShzKQkJKENETlNfRFBUWF9TVFJFQU0ocykgKyAweDBjKQorI2RlZmlu
ZSBDRE5TX0RQX01TQVYxX1ZTWU5DX1dJRFRIKHgpCQkoeCkKKyNkZWZpbmUgQ0ROU19EUF9NU0FW
MV9WU1lOQ19QT0xfTE9XCQlCSVQoMTUpCisjZGVmaW5lIENETlNfRFBfTVNBVjFfVkRJU1BfV0lE
VEgoeCkJCSgoeCkgPDwgMTYpCisKKyNkZWZpbmUgQ0ROU19EUF9NU0FfTUlTQyhzKQkJCShDRE5T
X0RQVFhfU1RSRUFNKHMpICsgMHgxMCkKKyNkZWZpbmUgQ0ROU19EUF9TVFJFQU1fQ09ORklHKHMp
CQkoQ0ROU19EUFRYX1NUUkVBTShzKSArIDB4MTQpCisjZGVmaW5lIENETlNfRFBfU1RSRUFNX0NP
TkZJR18yKHMpCQkoQ0ROU19EUFRYX1NUUkVBTShzKSArIDB4MmMpCisjZGVmaW5lIENETlNfRFBf
U0MyX1RVX1ZTX0RJRkYoeCkJCSgoeCkgPDwgOCkKKworI2RlZmluZSBDRE5TX0RQX0hPUklaT05U
QUwocykJCQkoQ0ROU19EUFRYX1NUUkVBTShzKSArIDB4MzApCisjZGVmaW5lIENETlNfRFBfSF9I
U1lOQ19XSURUSCh4KQkJKHgpCisjZGVmaW5lIENETlNfRFBfSF9IX1RPVEFMKHgpCQkJKCh4KSA8
PCAxNikKKworI2RlZmluZSBDRE5TX0RQX1ZFUlRJQ0FMXzAocykJCQkoQ0ROU19EUFRYX1NUUkVB
TShzKSArIDB4MzQpCisjZGVmaW5lIENETlNfRFBfVjBfVkhFSUdIVCh4KQkJCSh4KQorI2RlZmlu
ZSBDRE5TX0RQX1YwX1ZTVEFSVCh4KQkJCSgoeCkgPDwgMTYpCisKKyNkZWZpbmUgQ0ROU19EUF9W
RVJUSUNBTF8xKHMpCQkJKENETlNfRFBUWF9TVFJFQU0ocykgKyAweDM4KQorI2RlZmluZSBDRE5T
X0RQX1YxX1ZUT1RBTCh4KQkJCSh4KQorI2RlZmluZSBDRE5TX0RQX1YxX1ZUT1RBTF9FVkVOCQkJ
QklUKDE2KQorCisjZGVmaW5lIENETlNfRFBfRlJBTUVSX1BYTF9SRVBSKHMpCQkoQ0ROU19EUFRY
X1NUUkVBTShzKSArIDB4NGMpCisjZGVmaW5lIENETlNfRFBfRlJBTUVSXzZfQlBDCQkJQklUKDAp
CisjZGVmaW5lIENETlNfRFBfRlJBTUVSXzhfQlBDCQkJQklUKDEpCisjZGVmaW5lIENETlNfRFBf
RlJBTUVSXzEwX0JQQwkJCUJJVCgyKQorI2RlZmluZSBDRE5TX0RQX0ZSQU1FUl8xMl9CUEMJCQlC
SVQoMykKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJfMTZfQlBDCQkJQklUKDQpCisjZGVmaW5lIENE
TlNfRFBfRlJBTUVSX1BYTF9GT1JNQVQJCTB4OAorI2RlZmluZSBDRE5TX0RQX0ZSQU1FUl9SR0IJ
CQlCSVQoMCkKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJfWUNCQ1I0NDQJCQlCSVQoMSkKKyNkZWZp
bmUgQ0ROU19EUF9GUkFNRVJfWUNCQ1I0MjIJCQlCSVQoMikKKyNkZWZpbmUgQ0ROU19EUF9GUkFN
RVJfWUNCQ1I0MjAJCQlCSVQoMykKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJfWV9PTkxZCQkJQklU
KDQpCisKKyNkZWZpbmUgQ0ROU19EUF9GUkFNRVJfU1AocykJCQkoQ0ROU19EUFRYX1NUUkVBTShz
KSArIDB4NTApCisjZGVmaW5lIENETlNfRFBfRlJBTUVSX1ZTWU5DX1BPTF9MT1cJCUJJVCgwKQor
I2RlZmluZSBDRE5TX0RQX0ZSQU1FUl9IU1lOQ19QT0xfTE9XCQlCSVQoMSkKKyNkZWZpbmUgQ0RO
U19EUF9GUkFNRVJfSU5URVJMQUNFCQlCSVQoMikKKworI2RlZmluZSBDRE5TX0RQX0xJTkVfVEhS
RVNIKHMpCQkJKENETlNfRFBUWF9TVFJFQU0ocykgKyAweDY0KQorI2RlZmluZSBDRE5TX0RQX0FD
VElWRV9MSU5FX1RIUkVTSCh4KQkJKHgpCisKKyNkZWZpbmUgQ0ROU19EUF9WQl9JRChzKQkJCShD
RE5TX0RQVFhfU1RSRUFNKHMpICsgMHg2OCkKKyNkZWZpbmUgQ0ROU19EUF9WQl9JRF9JTlRFUkxB
Q0VECQlCSVQoMikKKyNkZWZpbmUgQ0ROU19EUF9WQl9JRF9DT01QUkVTU0VECQlCSVQoNikKKwor
I2RlZmluZSBDRE5TX0RQX0ZST05UX0JBQ0tfUE9SQ0gocykJCShDRE5TX0RQVFhfU1RSRUFNKHMp
ICsgMHg3OCkKKyNkZWZpbmUgQ0ROU19EUF9CQUNLX1BPUkNIKHgpCQkJKHgpCisjZGVmaW5lIENE
TlNfRFBfRlJPTlRfUE9SQ0goeCkJCQkoKHgpIDw8IDE2KQorCisjZGVmaW5lIENETlNfRFBfQllU
RV9DT1VOVChzKQkJCShDRE5TX0RQVFhfU1RSRUFNKHMpICsgMHg3YykKKyNkZWZpbmUgQ0ROU19E
UF9CWVRFX0NPVU5UX0JZVEVTX0lOX0NIVU5LX1NISUZUCTE2CisKKyNkZWZpbmUgQ0ROU19EUF9N
U1RfU1RSRUFNX0NPTkZJRyhzKQkJKENETlNfRFBUWF9TVFJFQU0ocykgKyAweDE0KQorI2RlZmlu
ZSBDRE5TX0RQX01TVF9TVFJNX0NGR19TVFJFQU1fRU4JCUJJVCgwKQorI2RlZmluZSBDRE5TX0RQ
X01TVF9TVFJNX0NGR19OT19WSURFTwkJQklUKDEpCisKKyNkZWZpbmUgQ0ROU19EUF9NU1RfU0xP
VF9BTExPQ0FURShzKQkJKENETlNfRFBUWF9TVFJFQU0ocykgKyAweDQ0KQorI2RlZmluZSBDRE5T
X0RQX1NfQUxMT0NfU1RBUlRfU0xPVCh4KQkJKHgpCisjZGVmaW5lIENETlNfRFBfU19BTExPQ19F
TkRfU0xPVCh4KQkJKCh4KSA8PCA4KQorCisjZGVmaW5lIENETlNfRFBfUkFURV9HT1ZFUk5JTkco
cykJCShDRE5TX0RQVFhfU1RSRUFNKHMpICsgMHg0OCkKKyNkZWZpbmUgQ0ROU19EUF9SR19UQVJH
X0FWX1NMT1RTX1koeCkJCSh4KQorI2RlZmluZSBDRE5TX0RQX1JHX1RBUkdfQVZfU0xPVFNfWCh4
KQkJKCh4KSA8PCA0KQorI2RlZmluZSBDRE5TX0RQX1JHX0VOQUJMRQkJCUJJVCgxMCkKKworI2Rl
ZmluZSBDRE5TX0RQX01UUEhfQ09OVFJPTAkJCTB4MjI2NAorI2RlZmluZSBDRE5TX0RQX01UUEhf
RUNGX0VOCQkJQklUKDApCisjZGVmaW5lIENETlNfRFBfTVRQSF9BQ1RfRU4JCQlCSVQoMSkKKyNk
ZWZpbmUgQ0ROU19EUF9NVFBIX0xWUF9FTgkJCUJJVCgyKQorCisjZGVmaW5lIENETlNfRFBfTVRQ
SF9TVEFUVVMJCQkweDIyNkMKKyNkZWZpbmUgQ0ROU19EUF9NVFBIX0FDVF9TVEFUVVMJCQlCSVQo
MCkKKworI2RlZmluZSBDRE5TX0RQVFhfR0xPQkFMCQkJMHgwMjMwMAorI2RlZmluZSBDRE5TX0RQ
X0xBTkVfRU4JCQkJKENETlNfRFBUWF9HTE9CQUwgKyAweDAwKQorI2RlZmluZSBDRE5TX0RQX0xB
TkVfRU5fTEFORVMoeCkJCUdFTk1BU0soKHgpIC0gMSwgMCkKKyNkZWZpbmUgQ0ROU19EUF9FTkhO
Q0QJCQkJKENETlNfRFBUWF9HTE9CQUwgKyAweDA0KQorCisvKiBtYWlsYm94ICovCisjZGVmaW5l
IE1BSUxCT1hfUkVUUllfVVMJCQkxMDAwCisjZGVmaW5lIE1BSUxCT1hfVElNRU9VVF9VUwkJCTUw
MDAwMDAKKworI2RlZmluZSBNQl9PUENPREVfSUQJCQkJMAorI2RlZmluZSBNQl9NT0RVTEVfSUQJ
CQkJMQorI2RlZmluZSBNQl9TSVpFX01TQl9JRAkJCQkyCisjZGVmaW5lIE1CX1NJWkVfTFNCX0lE
CQkJCTMKKyNkZWZpbmUgTUJfREFUQV9JRAkJCQk0CisKKyNkZWZpbmUgTUJfTU9EVUxFX0lEX0RQ
X1RYCQkJMHgwMQorI2RlZmluZSBNQl9NT0RVTEVfSURfSERDUF9UWAkJCTB4MDcKKyNkZWZpbmUg
TUJfTU9EVUxFX0lEX0hEQ1BfUlgJCQkweDA4CisjZGVmaW5lIE1CX01PRFVMRV9JRF9IRENQX0dF
TkVSQUwJCTB4MDkKKyNkZWZpbmUgTUJfTU9EVUxFX0lEX0dFTkVSQUwJCQkweDBhCisKKy8qIGZp
cm13YXJlIGFuZCBvcGNvZGVzICovCisjZGVmaW5lIEZXX05BTUUJCQkJCSJjYWRlbmNlL21oZHA4
NTQ2LmJpbiIKKyNkZWZpbmUgQ0ROU19NSERQX0lNRU0JCQkJMHgxMDAwMAorCisjZGVmaW5lIEdF
TkVSQUxfTUFJTl9DT05UUk9MCQkJMHgwMQorI2RlZmluZSBHRU5FUkFMX1RFU1RfRUNITwkJCTB4
MDIKKyNkZWZpbmUgR0VORVJBTF9CVVNfU0VUVElOR1MJCQkweDAzCisjZGVmaW5lIEdFTkVSQUxf
VEVTVF9BQ0NFU1MJCQkweDA0CisjZGVmaW5lIEdFTkVSQUxfUkVHSVNURVJfUkVBRAkJCTB4MDcK
KworI2RlZmluZSBEUFRYX1NFVF9QT1dFUl9NTkcJCQkweDAwCisjZGVmaW5lIERQVFhfU0VUX0hP
U1RfQ0FQQUJJTElUSUVTCQkweDAxCisjZGVmaW5lIERQVFhfR0VUX0VESUQJCQkJMHgwMgorI2Rl
ZmluZSBEUFRYX1JFQURfRFBDRAkJCQkweDAzCisjZGVmaW5lIERQVFhfV1JJVEVfRFBDRAkJCQkw
eDA0CisjZGVmaW5lIERQVFhfRU5BQkxFX0VWRU5UCQkJMHgwNQorI2RlZmluZSBEUFRYX1dSSVRF
X1JFR0lTVEVSCQkJMHgwNgorI2RlZmluZSBEUFRYX1JFQURfUkVHSVNURVIJCQkweDA3CisjZGVm
aW5lIERQVFhfV1JJVEVfRklFTEQJCQkweDA4CisjZGVmaW5lIERQVFhfVFJBSU5JTkdfQ09OVFJP
TAkJCTB4MDkKKyNkZWZpbmUgRFBUWF9SRUFEX0VWRU5UCQkJCTB4MGEKKyNkZWZpbmUgRFBUWF9S
RUFEX0xJTktfU1RBVAkJCTB4MGIKKyNkZWZpbmUgRFBUWF9TRVRfVklERU8JCQkJMHgwYworI2Rl
ZmluZSBEUFRYX1NFVF9BVURJTwkJCQkweDBkCisjZGVmaW5lIERQVFhfR0VUX0xBU1RfQVVYX1NU
QVVTCQkJMHgwZQorI2RlZmluZSBEUFRYX1NFVF9MSU5LX0JSRUFLX1BPSU5UCQkweDBmCisjZGVm
aW5lIERQVFhfRk9SQ0VfTEFORVMJCQkweDEwCisjZGVmaW5lIERQVFhfSFBEX1NUQVRFCQkJCTB4
MTEKKyNkZWZpbmUgRFBUWF9BREpVU1RfTFQJCQkJMHgxMgorCisjZGVmaW5lIEZXX1NUQU5EQlkJ
CQkJMAorI2RlZmluZSBGV19BQ1RJVkUJCQkJMQorCisvKiBIUEQgKi8KKyNkZWZpbmUgRFBUWF9S
RUFEX0VWRU5UX0hQRF9UT19ISUdIICAgICAgICAgICAgIEJJVCgwKQorI2RlZmluZSBEUFRYX1JF
QURfRVZFTlRfSFBEX1RPX0xPVyAgICAgICAgICAgICAgQklUKDEpCisjZGVmaW5lIERQVFhfUkVB
RF9FVkVOVF9IUERfUFVMU0UgICAgICAgICAgICAgICBCSVQoMikKKyNkZWZpbmUgRFBUWF9SRUFE
X0VWRU5UX0hQRF9TVEFURSAgICAgICAgICAgICAgIEJJVCgzKQorCisvKiBnZW5lcmFsICovCisj
ZGVmaW5lIENETlNfRFBfVFJBSU5JTkdfUEFUVEVSTl80CQkweDcKKworI2RlZmluZSBDRE5TX0tF
RVBfQUxJVkVfVElNRU9VVAkJCTIwMDAKKworI2RlZmluZSBDRE5TX0xBTkVfMQkJCQkxCisjZGVm
aW5lIENETlNfTEFORV8yCQkJCTIKKyNkZWZpbmUgQ0ROU19MQU5FXzQJCQkJNAorCisjZGVmaW5l
IENETlNfVk9MVF9TV0lORyh4KQkJCSgoeCkgJiBHRU5NQVNLKDEsIDApKQorI2RlZmluZSBDRE5T
X0ZPUkNFX1ZPTFRfU1dJTkcJCQlCSVQoMikKKworI2RlZmluZSBDRE5TX1BSRV9FTVBIQVNJUyh4
KQkJCSgoeCkgJiBHRU5NQVNLKDEsIDApKQorI2RlZmluZSBDRE5TX0ZPUkNFX1BSRV9FTVBIQVNJ
UwkJCUJJVCgyKQorCisjZGVmaW5lIENETlNfU1VQUE9SVF9UUFMoeCkJCQlCSVQoKHgpIC0gMSkK
KworI2RlZmluZSBDRE5TX0ZBU1RfTElOS19UUkFJTklORwkJCUJJVCgwKQorCisjZGVmaW5lIENE
TlNfTEFORV9NQVBQSU5HX1RZUEVfQ19MQU5FXzAoeCkJKCh4KSAmIEdFTk1BU0soMSwgMCkpCisj
ZGVmaW5lIENETlNfTEFORV9NQVBQSU5HX1RZUEVfQ19MQU5FXzEoeCkJKCh4KSAmIEdFTk1BU0so
MywgMikpCisjZGVmaW5lIENETlNfTEFORV9NQVBQSU5HX1RZUEVfQ19MQU5FXzIoeCkJKCh4KSAm
IEdFTk1BU0soNSwgNCkpCisjZGVmaW5lIENETlNfTEFORV9NQVBQSU5HX1RZUEVfQ19MQU5FXzMo
eCkJKCh4KSAmIEdFTk1BU0soNywgNikpCisjZGVmaW5lIENETlNfTEFORV9NQVBQSU5HX05PUk1B
TAkJMHhlNAorI2RlZmluZSBDRE5TX0xBTkVfTUFQUElOR19GTElQUEVECQkweDFiCisKKyNkZWZp
bmUgQ0ROU19EUF9NQVhfTlVNX0xBTkVTCQkJNAorI2RlZmluZSBDRE5TX0RQX1RFU1RfVlNDX1NE
UAkJCUJJVCg2KSAvKiAxLjMrICovCisjZGVmaW5lIENETlNfRFBfVEVTVF9DT0xPUl9GT1JNQVRf
UkFXX1lfT05MWQlCSVQoNykKKworI2RlZmluZSBDRE5TX01IRFBfTUFYX1NUUkVBTVMgICA0CisK
KyNkZWZpbmUgY29ubmVjdG9yX3RvX21oZHAoeCkgY29udGFpbmVyX29mKHgsIHN0cnVjdCBjZG5z
X21oZHBfZGV2aWNlLCBjb25uZWN0b3IpCisjZGVmaW5lIGJyaWRnZV90b19taGRwKHgpIGNvbnRh
aW5lcl9vZih4LCBzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSwgYnJpZGdlKQorCisjZGVmaW5lIERQ
X0xJTktfQ0FQX0VOSEFOQ0VEX0ZSQU1JTkcgQklUKDApCisKK3N0cnVjdCBjZG5zX21oZHBfbGlu
ayB7CisJdW5zaWduZWQgY2hhciByZXZpc2lvbjsKKwl1bnNpZ25lZCBpbnQgcmF0ZTsKKwl1bnNp
Z25lZCBpbnQgbnVtX2xhbmVzOworCXVuc2lnbmVkIGxvbmcgY2FwYWJpbGl0aWVzOworfTsKKwor
c3RydWN0IGNkbnNfbWhkcF9ob3N0IHsKKwl1bnNpZ25lZCBpbnQgbGlua19yYXRlOworCXU4IGxh
bmVzX2NudDsKKwl1OCB2b2x0X3N3aW5nOworCXU4IHByZV9lbXBoYXNpczsKKwl1OCBwYXR0ZXJu
X3N1cHA7CisJdTggbGFuZV9tYXBwaW5nOworCXU4IGZhc3RfbGluayA6IDE7CisJdTggZW5oYW5j
ZWQgOiAxOworCXU4IHNjcmFtYmxlciA6IDE7CisJdTggc3NjIDogMTsKK307CisKK3N0cnVjdCBj
ZG5zX21oZHBfc2luayB7CisJdW5zaWduZWQgaW50IGxpbmtfcmF0ZTsKKwl1OCBsYW5lc19jbnQ7
CisJdTggcGF0dGVybl9zdXBwOworCXU4IGZhc3RfbGluayA6IDE7CisJdTggZW5oYW5jZWQgOiAx
OworCXU4IHNzYyA6IDE7Cit9OworCitzdHJ1Y3QgY2Ruc19taGRwX2Rpc3BsYXlfZm10IHsKKwl1
MzIgY29sb3JfZm9ybWF0OworCXUzMiBicGM7CisJdTggeV9vbmx5IDogMTsKK307CisKKy8qCisg
KiBUaGVzZSBlbnVtcyBwcmVzZW50IE1IRFAgaHcgaW5pdGlhbGl6YXRpb24gc3RhdGUKKyAqIExl
Z2FsIHN0YXRlIHRyYW5zaXRpb25zIGFyZToKKyAqIE1IRFBfSFdfSU5BQ1RJVkUgPC0+IE1IRFBf
SFdfTE9BRElORyAtPiBNSERQX0hXX1JFQURZCisgKiAgICAgICAgfCAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICB8CisgKiAgICAgICAgJy0tLS0tLS0tLS0+IE1IRFBfSFdfU1RP
UFBFRCA8LS0tLS0tLS0nCisgKi8KK2VudW0gbWhkcF9od19zdGF0ZSB7IE1IRFBfSFdfSU5BQ1RJ
VkUgPSAwLCAvKiBIVyBub3QgaW5pdGlhbGl6ZWQgKi8KKwkJICAgICBNSERQX0hXX0xPQURJTkcs
CSAgIC8qIEhXIGluaXRpYWxpemF0aW9uIGluIHByb2dyZXNzICovCisJCSAgICAgTUhEUF9IV19S
RUFEWSwJICAgLyogSFcgcmVhZHksIEZXIGFjdGl2ZSovCisJCSAgICAgTUhEUF9IV19TVE9QUEVE
IH07CSAgIC8qIERyaXZlciByZW1vdmFsIEZXIHRvIGJlIHN0b3BwZWQgKi8KKworc3RydWN0IGNk
bnNfbWhkcF9kZXZpY2U7CisKK3N0cnVjdCBtaGRwX3BsYXRmb3JtX29wcyB7CisJaW50ICgqaW5p
dCkoc3RydWN0IGNkbnNfbWhkcF9kZXZpY2UgKm1oZHApOworCXZvaWQgKCpleGl0KShzdHJ1Y3Qg
Y2Ruc19taGRwX2RldmljZSAqbWhkcCk7CisJdm9pZCAoKmVuYWJsZSkoc3RydWN0IGNkbnNfbWhk
cF9kZXZpY2UgKm1oZHApOworCXZvaWQgKCpkaXNhYmxlKShzdHJ1Y3QgY2Ruc19taGRwX2Rldmlj
ZSAqbWhkcCk7Cit9OworCitzdHJ1Y3QgY2Ruc19taGRwX2RldmljZSB7CisJdm9pZCBfX2lvbWVt
ICpyZWdzOworCisJc3RydWN0IGRldmljZSAqZGV2OworCXN0cnVjdCBjbGsgKmNsazsKKwlzdHJ1
Y3QgcGh5ICpwaHk7CisKKwljb25zdCBzdHJ1Y3QgbWhkcF9wbGF0Zm9ybV9vcHMgKm9wczsKKwor
CS8qIFRoaXMgaXMgdG8gcHJvdGVjdCBtYWlsYm94IGNvbW11bmljYXRpb25zIHdpdGggdGhlIGZp
cm13YXJlICovCisJc3RydWN0IG11dGV4IG1ib3hfbXV0ZXg7CisKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciBjb25uZWN0b3I7CisJc3RydWN0IGRybV9icmlkZ2UgYnJpZGdlOworCisJc3RydWN0IGNk
bnNfbWhkcF9saW5rIGxpbms7CisJc3RydWN0IGRybV9kcF9hdXggYXV4OworCisJc3RydWN0IGNk
bnNfbWhkcF9ob3N0IGhvc3Q7CisJc3RydWN0IGNkbnNfbWhkcF9zaW5rIHNpbms7CisJc3RydWN0
IGNkbnNfbWhkcF9kaXNwbGF5X2ZtdCBkaXNwbGF5X2ZtdDsKKwlzOCBzdHJlYW1faWQ7CisKKwl1
OCBsaW5rX3VwIDogMTsKKwl1OCBwbHVnZ2VkIDogMTsKKworCS8qCisJICogInN0YXJ0X2xvY2si
IHByb3RlY3RzIHRoZSBhY2Nlc3MgdG8gYnJpZGdlX2F0dGFjaGVkIGFuZAorCSAqIGh3X3N0YXRl
IGRhdGEgbWVtYmVycyB0aGF0IGNvbnRyb2wgdGhlIGRlbGF5ZWQgZmlybXdhcmUKKwkgKiBsb2Fk
aW5nIGFuZCBhdHRhY2hpbmcgdGhlIGJyaWRnZS4gVGhleSBhcmUgYWNjZXNzZWQgZnJvbQorCSAq
IGJvdGggdGhlIERSTSBjb3JlIGFuZCBtaGRwX2Z3X2NiKCkuIEluIG1vc3QgY2FzZXMganVzdAor
CSAqIHByb3RlY3RpbmcgdGhlIGRhdGEgbWVtYmVycyBpcyBlbm91Z2gsIGJ1dCB0aGUgaXJxIG1h
c2sKKwkgKiBzZXR0aW5nIG5lZWRzIHRvIGJlIHByb3RlY3RlZCB3aGVuIGVuYWJsaW5nIHRoZSBG
Vy4KKwkgKi8KKwlzcGlubG9ja190IHN0YXJ0X2xvY2s7CisJdTggYnJpZGdlX2F0dGFjaGVkIDog
MTsKKwllbnVtIG1oZHBfaHdfc3RhdGUgaHdfc3RhdGU7CisJZW51bSBkcm1fYnVzX2ZsYWdzIGNv
bm5fYnVzX2ZsYWdzX2RlZmF1bHRzOworfTsKKwordTMyIGNkbnNfbWhkcF9nZXRfYnBwKHN0cnVj
dCBjZG5zX21oZHBfZGlzcGxheV9mbXQgKmZtdCk7Cit2b2lkIGNkbnNfbWhkcF9jb25maWd1cmVf
dmlkZW8oc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSk7Cit2b2lkIGNkbnNfbWhkcF9lbmFibGUo
c3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSk7CisKKyNlbmRpZgotLSAKMi43LjQKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
