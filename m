Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BF80F88614
	for <lists+dri-devel@lfdr.de>; Sat, 10 Aug 2019 00:28:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DDBC76EF32;
	Fri,  9 Aug 2019 22:27:47 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9005E6EF2C;
 Fri,  9 Aug 2019 22:27:38 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Aug 2019 15:27:38 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,366,1559545200"; d="scan'208";a="176927141"
Received: from jmath3-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.5.86])
 by fmsmga007.fm.intel.com with ESMTP; 09 Aug 2019 15:27:37 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v3 37/37] HAX drm/i915: add the fake lmem region
Date: Fri,  9 Aug 2019 23:26:43 +0100
Message-Id: <20190809222643.23142-38-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190809222643.23142-1-matthew.auld@intel.com>
References: <20190809222643.23142-1-matthew.auld@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW50ZW5kZWQgZm9yIHVwc3RyZWFtIHRlc3Rpbmcgc28gdGhhdCB3ZSBjYW4gc3RpbGwgZXhlcmNp
c2UgdGhlIExNRU0KcGx1bWJpbmcgYW5kICFIQVNfTUFQUEFCTEVfQVBFUlRVUkUgcGF0aHMuIFNt
b2tlIHRlc3RlZCBvbiBTa3VsbCBDYW55b24KZGV2aWNlLiBUaGlzIHdvcmtzIGJ5IGFsbG9jYXRp
bmcgYW4gaW50ZWxfbWVtb3J5X3JlZ2lvbiBmb3IgYSByZXNlcnZlZApwb3J0aW9uIG9mIHN5c3Rl
bSBtZW1vcnksIHdoaWNoIHdlIHRyZWF0IGxpa2UgTE1FTS4gRm9yIHRoZSBMTUVNQkFSIHdlCnN0
ZWFsIHRoZSBhcGVydHVyZSBhbmQgMToxIGl0IG1hcCB0byB0aGUgc3RvbGVuIHJlZ2lvbi4KClRv
IGVuYWJsZSBzaW1wbHkgc2V0IGk5MTVfZmFrZV9sbWVtX3N0YXJ0PSBvbiB0aGUga2VybmVsIGNt
ZGxpbmUgd2l0aCB0aGUKc3RhcnQgb2YgcmVzZXJ2ZWQgcmVnaW9uKHNlZSBtZW1tYXA9KS4gVGhl
IHNpemUgb2YgdGhlIHJlZ2lvbiB3ZSBjYW4KdXNlIGlzIGRldGVybWluZWQgYnkgdGhlIHNpemUg
b2YgdGhlIG1hcHBhYmxlIGFwZXJ0dXJlLCBzbyB0aGUgc2l6ZSBvZgpyZXNlcnZlZCByZWdpb24g
c2hvdWxkIGJlID49IG1hcHBhYmxlX2VuZC4KCmVnLiBtZW1tYXA9MkckMTZHIGk5MTVfZmFrZV9s
bWVtX3N0YXJ0PTB4NDAwMDAwMDAwCgpTaWduZWQtb2ZmLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRo
ZXcuYXVsZEBpbnRlbC5jb20+CkNjOiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBs
aW51eC5pbnRlbC5jb20+CkNjOiBBYmRpZWwgSmFudWxndWUgPGFiZGllbC5qYW51bGd1ZUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogYXJjaC94ODYva2VybmVsL2Vhcmx5LXF1aXJrcy5jICAgICAgICAg
ICAgIHwgMjYgKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9sbWVt
LmMgICB8ICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICB8
ICA4ICsrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgIHwgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbWVtb3J5X3JlZ2lvbi5oIHwgIDQgKysKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3JlZ2lvbl9sbWVtLmMgICB8IDY5ICsrKysrKysrKysr
KysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3JlZ2lvbl9sbWVtLmggICB8
ICA1ICsrCiBpbmNsdWRlL2RybS9pOTE1X2RybS5oICAgICAgICAgICAgICAgICAgICAgfCAgMyAr
CiA4IGZpbGVzIGNoYW5nZWQsIDEyMSBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvYXJjaC94
ODYva2VybmVsL2Vhcmx5LXF1aXJrcy5jIGIvYXJjaC94ODYva2VybmVsL2Vhcmx5LXF1aXJrcy5j
CmluZGV4IDZmNmIxZDA0ZGFkZi4uOWIwNDY1NWUzOTI2IDEwMDY0NAotLS0gYS9hcmNoL3g4Ni9r
ZXJuZWwvZWFybHktcXVpcmtzLmMKKysrIGIvYXJjaC94ODYva2VybmVsL2Vhcmx5LXF1aXJrcy5j
CkBAIC02MDMsNiArNjAzLDMyIEBAIHN0YXRpYyB2b2lkIF9faW5pdCBpbnRlbF9ncmFwaGljc19x
dWlya3MoaW50IG51bSwgaW50IHNsb3QsIGludCBmdW5jKQogCX0KIH0KIAorc3RydWN0IHJlc291
cmNlIGludGVsX2dyYXBoaWNzX2Zha2VfbG1lbV9yZXMgX19yb19hZnRlcl9pbml0ID0gREVGSU5F
X1JFU19NRU0oMCwgMCk7CitFWFBPUlRfU1lNQk9MKGludGVsX2dyYXBoaWNzX2Zha2VfbG1lbV9y
ZXMpOworCitzdGF0aWMgaW50IF9faW5pdCBlYXJseV9pOTE1X2Zha2VfbG1lbV9pbml0KGNoYXIg
KnMpCit7CisJdTY0IHN0YXJ0OworCWludCByZXQ7CisKKwlpZiAoKnMgPT0gJz0nKQorCQlzKys7
CisKKwlyZXQgPSBrc3RydG91bGwocywgMTYsICZzdGFydCk7CisJaWYgKHJldCkKKwkJcmV0dXJu
IHJldDsKKworCWludGVsX2dyYXBoaWNzX2Zha2VfbG1lbV9yZXMuc3RhcnQgPSBzdGFydDsKKwlp
bnRlbF9ncmFwaGljc19mYWtlX2xtZW1fcmVzLmVuZCA9IFNaXzJHOyAvKiBQbGFjZWhvbGRlcjsg
ZGVwZW5kcyBvbiBhcGVydHVyZSBzaXplICovCisKKwlwcmludGsoS0VSTl9JTkZPICJJbnRlbCBn
cmFwaGljcyBmYWtlIExNRU0gc3RhcnRzIGF0ICVwYVxuIiwKKwkgICAgICAgJmludGVsX2dyYXBo
aWNzX2Zha2VfbG1lbV9yZXMuc3RhcnQpOworCisJcmV0dXJuIDA7Cit9CisKK2Vhcmx5X3BhcmFt
KCJpOTE1X2Zha2VfbG1lbV9zdGFydCIsIGVhcmx5X2k5MTVfZmFrZV9sbWVtX2luaXQpOworCiBz
dGF0aWMgdm9pZCBfX2luaXQgZm9yY2VfZGlzYWJsZV9ocGV0KGludCBudW0sIGludCBzbG90LCBp
bnQgZnVuYykKIHsKICNpZmRlZiBDT05GSUdfSFBFVF9USU1FUgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2xtZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9sbWVtLmMKaW5kZXggMjE5NGUyYzNiZGNkLi5iY2RjN2ZkMDk5YWYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9sbWVtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2xtZW0uYwpAQCAtMjUyLDYgKzI1Miw3
IEBAIHZvaWQgX19pb21lbSAqaTkxNV9nZW1fb2JqZWN0X2xtZW1faW9fbWFwX3BhZ2Uoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlyZXNvdXJjZV9zaXplX3Qgb2Zmc2V0OwogCiAJ
b2Zmc2V0ID0gaTkxNV9nZW1fb2JqZWN0X2dldF9kbWFfYWRkcmVzcyhvYmosIG4pOworCW9mZnNl
dCAtPSBpbnRlbF9ncmFwaGljc19mYWtlX2xtZW1fcmVzLnN0YXJ0OwogCiAJcmV0dXJuIGlvX21h
cHBpbmdfbWFwX3djKCZvYmotPm1tLnJlZ2lvbi0+aW9tYXAsIG9mZnNldCwgUEFHRV9TSVpFKTsK
IH0KQEAgLTI2Miw2ICsyNjMsNyBAQCB2b2lkIF9faW9tZW0gKmk5MTVfZ2VtX29iamVjdF9sbWVt
X2lvX21hcF9wYWdlX2F0b21pYyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdAogCXJlc291cmNl
X3NpemVfdCBvZmZzZXQ7CiAKIAlvZmZzZXQgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRy
ZXNzKG9iaiwgbik7CisJb2Zmc2V0IC09IGludGVsX2dyYXBoaWNzX2Zha2VfbG1lbV9yZXMuc3Rh
cnQ7CiAKIAlyZXR1cm4gaW9fbWFwcGluZ19tYXBfYXRvbWljX3djKCZvYmotPm1tLnJlZ2lvbi0+
aW9tYXAsIG9mZnNldCk7CiB9CkBAIC0yNzUsNiArMjc3LDcgQEAgdm9pZCBfX2lvbWVtICppOTE1
X2dlbV9vYmplY3RfbG1lbV9pb19tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAlHRU1fQlVHX09OKCEob2JqLT5mbGFncyAmIEk5MTVfQk9fQUxMT0NfQ09OVElHVU9VUykpOwog
CiAJb2Zmc2V0ID0gaTkxNV9nZW1fb2JqZWN0X2dldF9kbWFfYWRkcmVzcyhvYmosIG4pOworCW9m
ZnNldCAtPSBpbnRlbF9ncmFwaGljc19mYWtlX2xtZW1fcmVzLnN0YXJ0OwogCiAJcmV0dXJuIGlv
X21hcHBpbmdfbWFwX3djKCZvYmotPm1tLnJlZ2lvbi0+aW9tYXAsIG9mZnNldCwgc2l6ZSk7CiB9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA4NDVlODBjMmFjYzAuLmY3MTY4NWE2ZDQ5YiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0xNDc0LDYgKzE0NzQsMTQgQEAgaW50IGk5MTVf
ZHJpdmVyX3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgcGNpX2Rldmlj
ZV9pZCAqZW50KQogCWlmICghaTkxNV9tb2RwYXJhbXMubnVjbGVhcl9wYWdlZmxpcCAmJiBtYXRj
aF9pbmZvLT5nZW4gPCA1KQogCQlkZXZfcHJpdi0+ZHJtLmRyaXZlcl9mZWF0dXJlcyAmPSB+RFJJ
VkVSX0FUT01JQzsKIAorCS8qIENoZWNrIGlmIHdlIHN1cHBvcnQgZmFrZSBMTUVNIC0tIGVuYWJs
ZSBmb3IgbGl2ZSBzZWxmdGVzdHMgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYm
IGk5MTVfc2VsZnRlc3QubGl2ZSAmJgorCSAgICBpbnRlbF9ncmFwaGljc19mYWtlX2xtZW1fcmVz
LnN0YXJ0KSB7CisJCW1rd3JpdGVfZGV2aWNlX2luZm8oZGV2X3ByaXYpLT5tZW1vcnlfcmVnaW9u
cyA9CisJCQlSRUdJT05fU01FTSB8IFJFR0lPTl9MTUVNOworCQlHRU1fQlVHX09OKCFIQVNfTE1F
TShkZXZfcHJpdikpOworCX0KKwogCXJldCA9IHBjaV9lbmFibGVfZGV2aWNlKHBkZXYpOwogCWlm
IChyZXQpCiAJCWdvdG8gb3V0X2Zpbmk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmlu
ZGV4IDA4MTlhYzk4MzdkYy4uMzU1MjY4ZDg1Mzc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYwpAQCAtMjc0Nyw2ICsyNzQ3LDkgQEAgaW50IGk5MTVfZ2VtX2luaXRfbWVtb3J5X3Jl
Z2lvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCWNhc2UgSU5URUxfU1RPTEVO
OgogCQkJbWVtID0gaTkxNV9nZW1fc3RvbGVuX3NldHVwKGk5MTUpOwogCQkJYnJlYWs7CisJCWNh
c2UgSU5URUxfTE1FTToKKwkJCW1lbSA9IGludGVsX3NldHVwX2Zha2VfbG1lbShpOTE1KTsKKwkJ
CWJyZWFrOwogCQl9CiAKIAkJaWYgKElTX0VSUihtZW0pKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9tZW1vcnlfcmVnaW9uLmgKaW5kZXggMzQwNDExZGNmODZiLi4xM2IzZGFlYzQxMjcg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmgKQEAgLTksNiAr
OSw3IEBACiAjaW5jbHVkZSA8bGludXgvaW9wb3J0Lmg+CiAjaW5jbHVkZSA8bGludXgvbXV0ZXgu
aD4KICNpbmNsdWRlIDxsaW51eC9pby1tYXBwaW5nLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tbS5o
PgogCiAjaW5jbHVkZSAiaTkxNV9idWRkeS5oIgogCkBAIC02OSw2ICs3MCw5IEBAIHN0cnVjdCBp
bnRlbF9tZW1vcnlfcmVnaW9uIHsKIAlzdHJ1Y3QgaW9fbWFwcGluZyBpb21hcDsKIAlzdHJ1Y3Qg
cmVzb3VyY2UgcmVnaW9uOwogCisJLyogRm9yIGZha2luZyBmb3IgbG1lbSAqLworCXN0cnVjdCBk
cm1fbW1fbm9kZSBmYWtlX21hcHBhYmxlOworCiAJc3RydWN0IGk5MTVfYnVkZHlfbW0gbW07CiAJ
c3RydWN0IG11dGV4IG1tX2xvY2s7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3JlZ2lvbl9sbWVtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25f
bG1lbS5jCmluZGV4IDdmMTU0M2UyNzU5Yy4uYjhmNjcxNjM0OTE5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3JlZ2lvbl9sbWVtLmMKQEAgLTQxLDkgKzQxLDQxIEBAIGxtZW1fY3JlYXRl
X29iamVjdChzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAogCXJldHVybiBvYmo7CiB9
CiAKK3N0YXRpYyBpbnQgaW5pdF9mYWtlX2xtZW1fYmFyKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVn
aW9uICptZW0pCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtZW0tPmk5MTU7
CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0OworCXVuc2lnbmVkIGxvbmcg
bjsKKwlpbnQgcmV0OworCisJbWVtLT5mYWtlX21hcHBhYmxlLnN0YXJ0ID0gMDsKKwltZW0tPmZh
a2VfbWFwcGFibGUuc2l6ZSA9IHJlc291cmNlX3NpemUoJm1lbS0+cmVnaW9uKTsKKwltZW0tPmZh
a2VfbWFwcGFibGUuY29sb3IgPSBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFOworCisJcmV0ID0gZHJt
X21tX3Jlc2VydmVfbm9kZSgmZ2d0dC0+dm0ubW0sICZtZW0tPmZha2VfbWFwcGFibGUpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKiAxOjEgbWFwIHRoZSBtYXBwYWJsZSBhcGVydHVy
ZSB0byBvdXIgcmVzZXJ2ZWQgcmVnaW9uICovCisJZm9yIChuID0gMDsgbiA8IG1lbS0+ZmFrZV9t
YXBwYWJsZS5zaXplID4+IFBBR0VfU0hJRlQ7ICsrbikgeworCQlnZ3R0LT52bS5pbnNlcnRfcGFn
ZSgmZ2d0dC0+dm0sCisJCQkJICAgICBtZW0tPnJlZ2lvbi5zdGFydCArIChuIDw8IFBBR0VfU0hJ
RlQpLAorCQkJCSAgICAgbiA8PCBQQUdFX1NISUZULCBJOTE1X0NBQ0hFX05PTkUsIDApOworCX0K
KworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCByZWxlYXNlX2Zha2VfbG1lbV9iYXIoc3Ry
dWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSkKK3sKKwlpZiAoZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZtZW0tPmZha2VfbWFwcGFibGUpKQorCQlkcm1fbW1fcmVtb3ZlX25vZGUoJm1lbS0+ZmFr
ZV9tYXBwYWJsZSk7Cit9CisKIHN0YXRpYyB2b2lkCiByZWdpb25fbG1lbV9yZWxlYXNlKHN0cnVj
dCBpbnRlbF9tZW1vcnlfcmVnaW9uICptZW0pCiB7CisJcmVsZWFzZV9mYWtlX2xtZW1fYmFyKG1l
bSk7CiAJaW9fbWFwcGluZ19maW5pKCZtZW0tPmlvbWFwKTsKIAlpbnRlbF9tZW1vcnlfcmVnaW9u
X3JlbGVhc2VfYnVkZHkobWVtKTsKIH0KQEAgLTUzLDYgKzg1LDExIEBAIHJlZ2lvbl9sbWVtX2lu
aXQoc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSkKIHsKIAlpbnQgcmV0OwogCisJaWYg
KGludGVsX2dyYXBoaWNzX2Zha2VfbG1lbV9yZXMuc3RhcnQpIHsKKwkJcmV0ID0gaW5pdF9mYWtl
X2xtZW1fYmFyKG1lbSk7CisJCUdFTV9CVUdfT04ocmV0KTsKKwl9CisKIAlpZiAoIWlvX21hcHBp
bmdfaW5pdF93YygmbWVtLT5pb21hcCwKIAkJCQltZW0tPmlvX3N0YXJ0LAogCQkJCXJlc291cmNl
X3NpemUoJm1lbS0+cmVnaW9uKSkpCkBAIC03MCwzICsxMDcsMzUgQEAgY29uc3Qgc3RydWN0IGlu
dGVsX21lbW9yeV9yZWdpb25fb3BzIGludGVsX3JlZ2lvbl9sbWVtX29wcyA9IHsKIAkucmVsZWFz
ZSA9IHJlZ2lvbl9sbWVtX3JlbGVhc2UsCiAJLmNyZWF0ZV9vYmplY3QgPSBsbWVtX2NyZWF0ZV9v
YmplY3QsCiB9OworCitzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqCitpbnRlbF9zZXR1cF9m
YWtlX2xtZW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RydWN0IHBjaV9k
ZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKKwlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAq
bWVtOworCXJlc291cmNlX3NpemVfdCBtYXBwYWJsZV9lbmQ7CisJcmVzb3VyY2Vfc2l6ZV90IGlv
X3N0YXJ0OworCXJlc291cmNlX3NpemVfdCBzdGFydDsKKworCUdFTV9CVUdfT04oSEFTX01BUFBB
QkxFX0FQRVJUVVJFKGk5MTUpKTsKKwlHRU1fQlVHX09OKCFpbnRlbF9ncmFwaGljc19mYWtlX2xt
ZW1fcmVzLnN0YXJ0KTsKKworCS8qIFlvdXIgbWFwcGFibGUgYXBlcnR1cmUgYmVsb25ncyB0byBt
ZSBub3chICovCisJbWFwcGFibGVfZW5kID0gcGNpX3Jlc291cmNlX2xlbihwZGV2LCAyKTsKKwlp
b19zdGFydCA9IHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAyKSwKKwlzdGFydCA9IGludGVsX2dy
YXBoaWNzX2Zha2VfbG1lbV9yZXMuc3RhcnQ7CisKKwltZW0gPSBpbnRlbF9tZW1vcnlfcmVnaW9u
X2NyZWF0ZShpOTE1LAorCQkJCQkgc3RhcnQsCisJCQkJCSBtYXBwYWJsZV9lbmQsCisJCQkJCSBJ
OTE1X0dUVF9QQUdFX1NJWkVfNEssCisJCQkJCSBpb19zdGFydCwKKwkJCQkJICZpbnRlbF9yZWdp
b25fbG1lbV9vcHMpOworCWlmICghSVNfRVJSKG1lbSkpIHsKKwkJRFJNX0lORk8oIkludGVsIGdy
YXBoaWNzIGZha2UgTE1FTTogJXBSXG4iLCAmbWVtLT5yZWdpb24pOworCQlEUk1fSU5GTygiSW50
ZWwgZ3JhcGhpY3MgZmFrZSBMTUVNIElPIHN0YXJ0OiAlbGx4XG4iLAorCQkJICh1NjQpbWVtLT5p
b19zdGFydCk7CisJfQorCisJcmV0dXJuIG1lbTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3JlZ2lvbl9sbWVtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9yZWdpb25fbG1lbS5oCmluZGV4IGVkMmEzYmFiNjQ0My4uMjEzZGVmN2M3YjhhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3JlZ2lvbl9sbWVtLmgKQEAgLTYsNiArNiwxMSBAQAogI2lm
bmRlZiBfX0lOVEVMX1JFR0lPTl9MTUVNX0gKICNkZWZpbmUgX19JTlRFTF9SRUdJT05fTE1FTV9I
CiAKK3N0cnVjdCBkcm1faTkxNV9wcml2YXRlOworCiBleHRlcm4gY29uc3Qgc3RydWN0IGludGVs
X21lbW9yeV9yZWdpb25fb3BzIGludGVsX3JlZ2lvbl9sbWVtX29wczsKIAorc3RydWN0IGludGVs
X21lbW9yeV9yZWdpb24gKgoraW50ZWxfc2V0dXBfZmFrZV9sbWVtKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKKwogI2VuZGlmIC8qICFfX0lOVEVMX1JFR0lPTl9MTUVNX0ggKi8KZGlm
ZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL2RybS9pOTE1X2RybS5o
CmluZGV4IDIzMjc0Y2Y5MjcxMi4uNGQ5ZGQ1NDg5NjNiIDEwMDY0NAotLS0gYS9pbmNsdWRlL2Ry
bS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvZHJtL2k5MTVfZHJtLmgKQEAgLTM5LDYgKzM5LDkg
QEAgYm9vbCBpOTE1X2dwdV90dXJib19kaXNhYmxlKHZvaWQpOwogLyogRXhwb3J0ZWQgZnJvbSBh
cmNoL3g4Ni9rZXJuZWwvZWFybHktcXVpcmtzLmMgKi8KIGV4dGVybiBzdHJ1Y3QgcmVzb3VyY2Ug
aW50ZWxfZ3JhcGhpY3Nfc3RvbGVuX3JlczsKIAorLyogRXhwb3J0ZWQgZnJvbSBhcmNoL3g4Ni9r
ZXJuZWwvZWFybHktcHJpbnRrLmMgKi8KK2V4dGVybiBzdHJ1Y3QgcmVzb3VyY2UgaW50ZWxfZ3Jh
cGhpY3NfZmFrZV9sbWVtX3JlczsKKwogLyoKICAqIFRoZSBCcmlkZ2UgZGV2aWNlJ3MgUENJIGNv
bmZpZyBzcGFjZSBoYXMgaW5mb3JtYXRpb24gYWJvdXQgdGhlCiAgKiBmYiBhcGVydHVyZSBzaXpl
IGFuZCB0aGUgYW1vdW50IG9mIHByZS1yZXNlcnZlZCBtZW1vcnkuCi0tIAoyLjIwLjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWls
aW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
