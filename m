Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 25BF9C1BD3
	for <lists+dri-devel@lfdr.de>; Mon, 30 Sep 2019 08:57:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A19BA6E373;
	Mon, 30 Sep 2019 06:57:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.codeaurora.org (smtp.codeaurora.org [198.145.29.96])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 564336E373
 for <dri-devel@lists.freedesktop.org>; Mon, 30 Sep 2019 06:40:52 +0000 (UTC)
Received: by smtp.codeaurora.org (Postfix, from userid 1000)
 id EAFA5611CE; Mon, 30 Sep 2019 06:40:49 +0000 (UTC)
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
 pdx-caf-mail.web.codeaurora.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.7 required=2.0 tests=ALL_TRUSTED,BAYES_00,
 DKIM_INVALID,DKIM_SIGNED,SPF_NONE autolearn=no autolearn_force=no
 version=3.4.0
Received: from kgunda-linux.qualcomm.com
 (blr-c-bdr-fw-01_globalnat_allzones-outside.qualcomm.com [103.229.19.19])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: kgunda@smtp.codeaurora.org)
 by smtp.codeaurora.org (Postfix) with ESMTPSA id 326B06155E;
 Mon, 30 Sep 2019 06:40:39 +0000 (UTC)
DMARC-Filter: OpenDMARC Filter v1.3.2 smtp.codeaurora.org 326B06155E
From: Kiran Gunda <kgunda@codeaurora.org>
To: bjorn.andersson@linaro.org, jingoohan1@gmail.com, lee.jones@linaro.org,
 b.zolnierkie@samsung.com, dri-devel@lists.freedesktop.org,
 daniel.thompson@linaro.org, jacek.anaszewski@gmail.com, pavel@ucw.cz,
 robh+dt@kernel.org, mark.rutland@arm.com, linux-leds@vger.kernel.org,
 devicetree@vger.kernel.org, linux-kernel@vger.kernel.org,
 Andy Gross <agross@kernel.org>, linux-arm-msm@vger.kernel.org,
 linux-fbdev@vger.kernel.org
Subject: [PATCH V6 5/8] backlight: qcom-wled: Restructure the driver for WLED3
Date: Mon, 30 Sep 2019 12:09:10 +0530
Message-Id: <1569825553-26039-6-git-send-email-kgunda@codeaurora.org>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1569825553-26039-1-git-send-email-kgunda@codeaurora.org>
References: <1569825553-26039-1-git-send-email-kgunda@codeaurora.org>
X-Mailman-Approved-At: Mon, 30 Sep 2019 06:57:28 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=codeaurora.org; s=default; t=1569825652;
 bh=/Q4dHNN1hpZ41tKR8QSUCGjtyLlnkeviuzrbHV7SYrI=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=COB6Y0gF8JkZaSsHjSShYBACETf5Xp9YO4Jm/p2i11Vnfh/IoePv2N3S1kOPK3I89
 A1L/6wEPW8m5pArGOKndoZimkDUULc9xpK0F4zVH6rMGwZAC15KpBv9kFvpeWUazgv
 FAHlPfeMMmHJp3dWGu6QkdK3+Dr4eIn1HZ8pBz/A=
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=codeaurora.org; s=default; t=1569825646;
 bh=/Q4dHNN1hpZ41tKR8QSUCGjtyLlnkeviuzrbHV7SYrI=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=R2YIP2OQtz3H7p01PDnE918OiWDZHhipaWQrBIK2MvgPlwnQ2SowfOFbx3UcqAuTU
 VAbPfJYJ4jR2SfUrxH5W9pOvXtZx9ivu9uVD+K4JITdQSRiI2laKj6PzSQrcSp9TPL
 IcwdIR415xEmhzjrbs8grYbT26E6tSy0hAj0kaQE=
X-Mailman-Original-Authentication-Results: pdx-caf-mail.web.codeaurora.org;
 dmarc=none (p=none dis=none)
 header.from=codeaurora.org
X-Mailman-Original-Authentication-Results: pdx-caf-mail.web.codeaurora.org;
 spf=none
 smtp.mailfrom=kgunda@codeaurora.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Kiran Gunda <kgunda@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmVzdHJ1Y3R1cmUgdGhlIGRyaXZlciB0byBhZGQgdGhlIHN1cHBvcnQgZm9yIG5ldyBXTEVECnBl
cmlwaGVyYWxzLgoKU2lnbmVkLW9mZi1ieTogS2lyYW4gR3VuZGEgPGtndW5kYUBjb2RlYXVyb3Jh
Lm9yZz4KQWNrZWQtYnk6IERhbmllbCBUaG9tcHNvbiA8ZGFuaWVsLnRob21wc29uQGxpbmFyby5v
cmc+Ci0tLQogZHJpdmVycy92aWRlby9iYWNrbGlnaHQvcWNvbS13bGVkLmMgfCAzOTUgKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMjQ1IGluc2Vy
dGlvbnMoKyksIDE1MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2Jh
Y2tsaWdodC9xY29tLXdsZWQuYyBiL2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0L3Fjb20td2xlZC5j
CmluZGV4IGYxOTEyNDIuLjc0MGYxYjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vYmFja2xp
Z2h0L3Fjb20td2xlZC5jCisrKyBiL2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0L3Fjb20td2xlZC5j
CkBAIC03LDU5ICs3LDcxIEBACiAjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8
bGludXgvb2YuaD4KICNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51
eC9vZl9hZGRyZXNzLmg+CiAjaW5jbHVkZSA8bGludXgvcmVnbWFwLmg+CiAKIC8qIEZyb20gRFQg
YmluZGluZyAqLworI2RlZmluZSBXTEVEX01BWF9TVFJJTkdTCQkJCTQKKwogI2RlZmluZSBXTEVE
X0RFRkFVTFRfQlJJR0hUTkVTUwkJCQkyMDQ4CiAKLSNkZWZpbmUgV0xFRDNfU0lOS19SRUdfQlJJ
R0hUX01BWAkJCTB4RkZGCi0jZGVmaW5lIFdMRUQzX0NUUkxfUkVHX1ZBTF9CQVNFCQkJCTB4NDAK
KyNkZWZpbmUgV0xFRF9TSU5LX1JFR19CUklHSFRfTUFYCQkJMHhGRkYKIAotLyogV0xFRDMgY29u
dHJvbCByZWdpc3RlcnMgKi8KLSNkZWZpbmUgV0xFRDNfQ1RSTF9SRUdfTU9EX0VOCQkJCTB4NDYK
LSNkZWZpbmUgIFdMRUQzX0NUUkxfUkVHX01PRF9FTl9CSVQJCQlCSVQoNykKLSNkZWZpbmUgIFdM
RUQzX0NUUkxfUkVHX01PRF9FTl9NQVNLCQkJQklUKDcpCisvKiBXTEVEIGNvbnRyb2wgcmVnaXN0
ZXJzICovCisjZGVmaW5lIFdMRURfQ1RSTF9SRUdfTU9EX0VOCQkJCTB4NDYKKyNkZWZpbmUgIFdM
RURfQ1RSTF9SRUdfTU9EX0VOX01BU0sJCQlCSVQoNykKKyNkZWZpbmUgIFdMRURfQ1RSTF9SRUdf
TU9EX0VOX1NISUZUCQkJNwogCi0jZGVmaW5lIFdMRUQzX0NUUkxfUkVHX0ZSRVEJCQkJMHg0Ywot
I2RlZmluZSAgV0xFRDNfQ1RSTF9SRUdfRlJFUV9NQVNLCQkJMHgwZgorI2RlZmluZSBXTEVEX0NU
UkxfUkVHX0ZSRVEJCQkJMHg0YworI2RlZmluZSAgV0xFRF9DVFJMX1JFR19GUkVRX01BU0sJCQlH
RU5NQVNLKDMsIDApCiAKLSNkZWZpbmUgV0xFRDNfQ1RSTF9SRUdfT1ZQCQkJCTB4NGQKLSNkZWZp
bmUgIFdMRUQzX0NUUkxfUkVHX09WUF9NQVNLCQkJMHgwMworI2RlZmluZSBXTEVEX0NUUkxfUkVH
X09WUAkJCQkweDRkCisjZGVmaW5lICBXTEVEX0NUUkxfUkVHX09WUF9NQVNLCQkJCUdFTk1BU0so
MSwgMCkKIAotI2RlZmluZSBXTEVEM19DVFJMX1JFR19JTElNSVQJCQkJMHg0ZQotI2RlZmluZSAg
V0xFRDNfQ1RSTF9SRUdfSUxJTUlUX01BU0sJCQkweDA3CisjZGVmaW5lIFdMRURfQ1RSTF9SRUdf
SUxJTUlUCQkJCTB4NGUKKyNkZWZpbmUgIFdMRURfQ1RSTF9SRUdfSUxJTUlUX01BU0sJCQlHRU5N
QVNLKDIsIDApCiAKLS8qIFdMRUQzIHNpbmsgcmVnaXN0ZXJzICovCi0jZGVmaW5lIFdMRUQzX1NJ
TktfUkVHX1NZTkMJCQkJMHg0NwotI2RlZmluZSAgV0xFRDNfU0lOS19SRUdfU1lOQ19NQVNLCQkJ
MHgwNwotI2RlZmluZSAgV0xFRDNfU0lOS19SRUdfU1lOQ19MRUQxCQkJQklUKDApCi0jZGVmaW5l
ICBXTEVEM19TSU5LX1JFR19TWU5DX0xFRDIJCQlCSVQoMSkKLSNkZWZpbmUgIFdMRUQzX1NJTktf
UkVHX1NZTkNfTEVEMwkJCUJJVCgyKQotI2RlZmluZSAgV0xFRDNfU0lOS19SRUdfU1lOQ19BTEwJ
CQkweDA3Ci0jZGVmaW5lICBXTEVEM19TSU5LX1JFR19TWU5DX0NMRUFSCQkJMHgwMAorLyogV0xF
RCBzaW5rIHJlZ2lzdGVycyAqLworI2RlZmluZSBXTEVEX1NJTktfUkVHX1NZTkMJCQkJMHg0Nwor
I2RlZmluZSAgV0xFRF9TSU5LX1JFR19TWU5DX0NMRUFSCQkJMHgwMAogCiAjZGVmaW5lIFdMRUQz
X1NJTktfUkVHX0NVUlJfU0lOSwkJCTB4NGYKLSNkZWZpbmUgIFdMRUQzX1NJTktfUkVHX0NVUlJf
U0lOS19NQVNLCQkJMHhlMAotI2RlZmluZSAgV0xFRDNfU0lOS19SRUdfQ1VSUl9TSU5LX1NIRlQJ
CQkweDA1CisjZGVmaW5lICBXTEVEM19TSU5LX1JFR19DVVJSX1NJTktfTUFTSwkJCUdFTk1BU0so
NywgNSkKKyNkZWZpbmUgIFdMRUQzX1NJTktfUkVHX0NVUlJfU0lOS19TSEZUCQkJNQogCi0vKiBX
TEVEMyBwZXItJ3N0cmluZycgcmVnaXN0ZXJzIGJlbG93ICovCi0jZGVmaW5lIFdMRUQzX1NJTktf
UkVHX1NUUl9PRkZTRVQJCQkweDEwCisvKiBXTEVEMyBzcGVjaWZpYyBwZXItJ3N0cmluZycgcmVn
aXN0ZXJzIGJlbG93ICovCisjZGVmaW5lIFdMRUQzX1NJTktfUkVHX0JSSUdIVChuKQkJCSgweDQw
ICsgbikKIAotI2RlZmluZSBXTEVEM19TSU5LX1JFR19TVFJfTU9EX0VOX0JBU0UJCQkweDYwCisj
ZGVmaW5lIFdMRUQzX1NJTktfUkVHX1NUUl9NT0RfRU4obikJCQkoMHg2MCArIChuICogMHgxMCkp
CiAjZGVmaW5lICBXTEVEM19TSU5LX1JFR19TVFJfTU9EX01BU0sJCQlCSVQoNykKLSNkZWZpbmUg
IFdMRUQzX1NJTktfUkVHX1NUUl9NT0RfRU4JCQlCSVQoNykKIAotI2RlZmluZSBXTEVEM19TSU5L
X1JFR19TVFJfRlVMTF9TQ0FMRV9DVVJSCQkweDYyCi0jZGVmaW5lICBXTEVEM19TSU5LX1JFR19T
VFJfRlVMTF9TQ0FMRV9DVVJSX01BU0sJMHgxZgorI2RlZmluZSBXTEVEM19TSU5LX1JFR19TVFJf
RlVMTF9TQ0FMRV9DVVJSKG4pCQkoMHg2MiArIChuICogMHgxMCkpCisjZGVmaW5lICBXTEVEM19T
SU5LX1JFR19TVFJfRlVMTF9TQ0FMRV9DVVJSX01BU0sJR0VOTUFTSyg0LCAwKQogCi0jZGVmaW5l
IFdMRUQzX1NJTktfUkVHX1NUUl9NT0RfU1JDX0JBU0UJCQkweDYzCi0jZGVmaW5lICBXTEVEM19T
SU5LX1JFR19TVFJfTU9EX1NSQ19NQVNLCQkweDAxCisjZGVmaW5lIFdMRUQzX1NJTktfUkVHX1NU
Ul9NT0RfU1JDKG4pCQkJKDB4NjMgKyAobiAqIDB4MTApKQorI2RlZmluZSAgV0xFRDNfU0lOS19S
RUdfU1RSX01PRF9TUkNfTUFTSwkJQklUKDApCiAjZGVmaW5lICBXTEVEM19TSU5LX1JFR19TVFJf
TU9EX1NSQ19JTlQJCQkweDAwCiAjZGVmaW5lICBXTEVEM19TSU5LX1JFR19TVFJfTU9EX1NSQ19F
WFQJCQkweDAxCiAKLSNkZWZpbmUgV0xFRDNfU0lOS19SRUdfU1RSX0NBQkNfQkFTRQkJCTB4NjYK
KyNkZWZpbmUgV0xFRDNfU0lOS19SRUdfU1RSX0NBQkMobikJCQkoMHg2NiArIChuICogMHgxMCkp
CiAjZGVmaW5lICBXTEVEM19TSU5LX1JFR19TVFJfQ0FCQ19NQVNLCQkJQklUKDcpCi0jZGVmaW5l
ICBXTEVEM19TSU5LX1JFR19TVFJfQ0FCQ19FTgkJCUJJVCg3KQorCitzdHJ1Y3Qgd2xlZF92YXJf
Y2ZnIHsKKwljb25zdCB1MzIgKnZhbHVlczsKKwl1MzIgKCpmbikodTMyKTsKKwlpbnQgc2l6ZTsK
K307CisKK3N0cnVjdCB3bGVkX3UzMl9vcHRzIHsKKwljb25zdCBjaGFyICpuYW1lOworCXUzMiAq
dmFsX3B0cjsKKwljb25zdCBzdHJ1Y3Qgd2xlZF92YXJfY2ZnICpjZmc7Cit9OworCitzdHJ1Y3Qg
d2xlZF9ib29sX29wdHMgeworCWNvbnN0IGNoYXIgKm5hbWU7CisJYm9vbCAqdmFsX3B0cjsKK307
CiAKIHN0cnVjdCB3bGVkX2NvbmZpZyB7CiAJdTMyIGJvb3N0X2lfbGltaXQ7CkBAIC02NywxMzIg
Kzc5LDE3OSBAQCBzdHJ1Y3Qgd2xlZF9jb25maWcgewogCXUzMiBzd2l0Y2hfZnJlcTsKIAl1MzIg
bnVtX3N0cmluZ3M7CiAJdTMyIHN0cmluZ19pX2xpbWl0OworCXUzMiBlbmFibGVkX3N0cmluZ3Nb
V0xFRF9NQVhfU1RSSU5HU107CiAJYm9vbCBjc19vdXRfZW47CiAJYm9vbCBleHRfZ2VuOwotCWJv
b2wgY2FiY19lbjsKKwlib29sIGNhYmM7CiB9OwogCiBzdHJ1Y3Qgd2xlZCB7CiAJY29uc3QgY2hh
ciAqbmFtZTsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CiAJc3RydWN0IHJlZ21hcCAqcmVnbWFwOwot
CXUxNiBhZGRyOworCXUxNiBjdHJsX2FkZHI7CisJdTE2IG1heF9zdHJpbmdfY291bnQ7CisJdTMy
IGJyaWdodG5lc3M7CisJdTMyIG1heF9icmlnaHRuZXNzOwogCiAJc3RydWN0IHdsZWRfY29uZmln
IGNmZzsKKwlpbnQgKCp3bGVkX3NldF9icmlnaHRuZXNzKShzdHJ1Y3Qgd2xlZCAqd2xlZCwgdTE2
IGJyaWdodG5lc3MpOwogfTsKIAorc3RhdGljIGludCB3bGVkM19zZXRfYnJpZ2h0bmVzcyhzdHJ1
Y3Qgd2xlZCAqd2xlZCwgdTE2IGJyaWdodG5lc3MpCit7CisJaW50IHJjLCBpOworCXU4IHZbMl07
CisKKwl2WzBdID0gYnJpZ2h0bmVzcyAmIDB4ZmY7CisJdlsxXSA9IChicmlnaHRuZXNzID4+IDgp
ICYgMHhmOworCisJZm9yIChpID0gMDsgIGkgPCB3bGVkLT5jZmcubnVtX3N0cmluZ3M7ICsraSkg
eworCQlyYyA9IHJlZ21hcF9idWxrX3dyaXRlKHdsZWQtPnJlZ21hcCwgd2xlZC0+Y3RybF9hZGRy
ICsKKwkJCQkgICAgICAgV0xFRDNfU0lOS19SRUdfQlJJR0hUKGkpLCB2LCAyKTsKKwkJaWYgKHJj
IDwgMCkKKwkJCXJldHVybiByYzsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCB3
bGVkX21vZHVsZV9lbmFibGUoc3RydWN0IHdsZWQgKndsZWQsIGludCB2YWwpCit7CisJaW50IHJj
OworCisJcmMgPSByZWdtYXBfdXBkYXRlX2JpdHMod2xlZC0+cmVnbWFwLCB3bGVkLT5jdHJsX2Fk
ZHIgKworCQkJCVdMRURfQ1RSTF9SRUdfTU9EX0VOLAorCQkJCVdMRURfQ1RSTF9SRUdfTU9EX0VO
X01BU0ssCisJCQkJdmFsIDw8IFdMRURfQ1RSTF9SRUdfTU9EX0VOX1NISUZUKTsKKwlyZXR1cm4g
cmM7Cit9CisKK3N0YXRpYyBpbnQgd2xlZF9zeW5jX3RvZ2dsZShzdHJ1Y3Qgd2xlZCAqd2xlZCkK
K3sKKwlpbnQgcmM7CisJdW5zaWduZWQgaW50IG1hc2sgPSBHRU5NQVNLKHdsZWQtPm1heF9zdHJp
bmdfY291bnQgLSAxLCAwKTsKKworCXJjID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHdsZWQtPnJlZ21h
cCwKKwkJCQl3bGVkLT5jdHJsX2FkZHIgKyBXTEVEX1NJTktfUkVHX1NZTkMsCisJCQkJbWFzaywg
bWFzayk7CisJaWYgKHJjIDwgMCkKKwkJcmV0dXJuIHJjOworCisJcmMgPSByZWdtYXBfdXBkYXRl
X2JpdHMod2xlZC0+cmVnbWFwLAorCQkJCXdsZWQtPmN0cmxfYWRkciArIFdMRURfU0lOS19SRUdf
U1lOQywKKwkJCQltYXNrLCBXTEVEX1NJTktfUkVHX1NZTkNfQ0xFQVIpOworCisJcmV0dXJuIHJj
OworfQorCiBzdGF0aWMgaW50IHdsZWRfdXBkYXRlX3N0YXR1cyhzdHJ1Y3QgYmFja2xpZ2h0X2Rl
dmljZSAqYmwpCiB7CiAJc3RydWN0IHdsZWQgKndsZWQgPSBibF9nZXRfZGF0YShibCk7Ci0JdTE2
IHZhbCA9IGJsLT5wcm9wcy5icmlnaHRuZXNzOwotCXU4IGN0cmwgPSAwOwotCWludCByYzsKLQlp
bnQgaTsKKwl1MTYgYnJpZ2h0bmVzcyA9IGJsLT5wcm9wcy5icmlnaHRuZXNzOworCWludCByYyA9
IDA7CiAKIAlpZiAoYmwtPnByb3BzLnBvd2VyICE9IEZCX0JMQU5LX1VOQkxBTksgfHwKIAkgICAg
YmwtPnByb3BzLmZiX2JsYW5rICE9IEZCX0JMQU5LX1VOQkxBTksgfHwKIAkgICAgYmwtPnByb3Bz
LnN0YXRlICYgQkxfQ09SRV9GQkJMQU5LKQotCQl2YWwgPSAwOwotCi0JaWYgKHZhbCAhPSAwKQot
CQljdHJsID0gV0xFRDNfQ1RSTF9SRUdfTU9EX0VOX0JJVDsKKwkJYnJpZ2h0bmVzcyA9IDA7CiAK
LQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5yZWdtYXAsCi0JCQl3bGVkLT5hZGRyICsg
V0xFRDNfQ1RSTF9SRUdfTU9EX0VOLAotCQkJV0xFRDNfQ1RSTF9SRUdfTU9EX0VOX01BU0ssIGN0
cmwpOwotCWlmIChyYykKLQkJcmV0dXJuIHJjOworCWlmIChicmlnaHRuZXNzKSB7CisJCXJjID0g
d2xlZC0+d2xlZF9zZXRfYnJpZ2h0bmVzcyh3bGVkLCBicmlnaHRuZXNzKTsKKwkJaWYgKHJjIDwg
MCkgeworCQkJZGV2X2Vycih3bGVkLT5kZXYsICJ3bGVkIGZhaWxlZCB0byBzZXQgYnJpZ2h0bmVz
cyByYzolZFxuIiwKKwkJCQlyYyk7CisJCQlyZXR1cm4gcmM7CisJCX0KIAotCWZvciAoaSA9IDA7
IGkgPCB3bGVkLT5jZmcubnVtX3N0cmluZ3M7ICsraSkgewotCQl1OCB2WzJdID0geyB2YWwgJiAw
eGZmLCAodmFsID4+IDgpICYgMHhmIH07CisJCXJjID0gd2xlZF9zeW5jX3RvZ2dsZSh3bGVkKTsK
KwkJaWYgKHJjIDwgMCkgeworCQkJZGV2X2Vycih3bGVkLT5kZXYsICJ3bGVkIHN5bmMgZmFpbGVk
IHJjOiVkXG4iLCByYyk7CisJCQlyZXR1cm4gcmM7CisJCX0KKwl9CiAKLQkJcmMgPSByZWdtYXBf
YnVsa193cml0ZSh3bGVkLT5yZWdtYXAsCi0JCQkJd2xlZC0+YWRkciArIFdMRUQzX0NUUkxfUkVH
X1ZBTF9CQVNFICsgMiAqIGksCi0JCQkJdiwgMik7Ci0JCWlmIChyYykKKwlpZiAoISFicmlnaHRu
ZXNzICE9ICEhd2xlZC0+YnJpZ2h0bmVzcykgeworCQlyYyA9IHdsZWRfbW9kdWxlX2VuYWJsZSh3
bGVkLCAhIWJyaWdodG5lc3MpOworCQlpZiAocmMgPCAwKSB7CisJCQlkZXZfZXJyKHdsZWQtPmRl
diwgIndsZWQgZW5hYmxlIGZhaWxlZCByYzolZFxuIiwgcmMpOwogCQkJcmV0dXJuIHJjOworCQl9
CiAJfQogCi0JcmMgPSByZWdtYXBfdXBkYXRlX2JpdHMod2xlZC0+cmVnbWFwLAotCQkJd2xlZC0+
YWRkciArIFdMRUQzX1NJTktfUkVHX1NZTkMsCi0JCQlXTEVEM19TSU5LX1JFR19TWU5DX01BU0ss
IFdMRUQzX1NJTktfUkVHX1NZTkNfQUxMKTsKLQlpZiAocmMpCi0JCXJldHVybiByYzsKKwl3bGVk
LT5icmlnaHRuZXNzID0gYnJpZ2h0bmVzczsKIAotCXJjID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHds
ZWQtPnJlZ21hcCwKLQkJCXdsZWQtPmFkZHIgKyBXTEVEM19TSU5LX1JFR19TWU5DLAotCQkJV0xF
RDNfU0lOS19SRUdfU1lOQ19NQVNLLCBXTEVEM19TSU5LX1JFR19TWU5DX0NMRUFSKTsKIAlyZXR1
cm4gcmM7CiB9CiAKLXN0YXRpYyBpbnQgd2xlZF9zZXR1cChzdHJ1Y3Qgd2xlZCAqd2xlZCkKK3N0
YXRpYyBpbnQgd2xlZDNfc2V0dXAoc3RydWN0IHdsZWQgKndsZWQpCiB7Ci0JaW50IHJjOwotCWlu
dCBpOworCXUxNiBhZGRyOworCXU4IHNpbmtfZW4gPSAwOworCWludCByYywgaSwgajsKIAogCXJj
ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHdsZWQtPnJlZ21hcCwKLQkJCXdsZWQtPmFkZHIgKyBXTEVE
M19DVFJMX1JFR19PVlAsCi0JCQlXTEVEM19DVFJMX1JFR19PVlBfTUFTSywgd2xlZC0+Y2ZnLm92
cCk7CisJCQkJd2xlZC0+Y3RybF9hZGRyICsgV0xFRF9DVFJMX1JFR19PVlAsCisJCQkJV0xFRF9D
VFJMX1JFR19PVlBfTUFTSywgd2xlZC0+Y2ZnLm92cCk7CiAJaWYgKHJjKQogCQlyZXR1cm4gcmM7
CiAKIAlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5yZWdtYXAsCi0JCQl3bGVkLT5hZGRy
ICsgV0xFRDNfQ1RSTF9SRUdfSUxJTUlULAotCQkJV0xFRDNfQ1RSTF9SRUdfSUxJTUlUX01BU0ss
IHdsZWQtPmNmZy5ib29zdF9pX2xpbWl0KTsKKwkJCQl3bGVkLT5jdHJsX2FkZHIgKyBXTEVEX0NU
UkxfUkVHX0lMSU1JVCwKKwkJCQlXTEVEX0NUUkxfUkVHX0lMSU1JVF9NQVNLLAorCQkJCXdsZWQt
PmNmZy5ib29zdF9pX2xpbWl0KTsKIAlpZiAocmMpCiAJCXJldHVybiByYzsKIAogCXJjID0gcmVn
bWFwX3VwZGF0ZV9iaXRzKHdsZWQtPnJlZ21hcCwKLQkJCXdsZWQtPmFkZHIgKyBXTEVEM19DVFJM
X1JFR19GUkVRLAotCQkJV0xFRDNfQ1RSTF9SRUdfRlJFUV9NQVNLLCB3bGVkLT5jZmcuc3dpdGNo
X2ZyZXEpOworCQkJCXdsZWQtPmN0cmxfYWRkciArIFdMRURfQ1RSTF9SRUdfRlJFUSwKKwkJCQlX
TEVEX0NUUkxfUkVHX0ZSRVFfTUFTSywKKwkJCQl3bGVkLT5jZmcuc3dpdGNoX2ZyZXEpOwogCWlm
IChyYykKIAkJcmV0dXJuIHJjOwogCi0JaWYgKHdsZWQtPmNmZy5jc19vdXRfZW4pIHsKLQkJdTgg
YWxsID0gKEJJVCh3bGVkLT5jZmcubnVtX3N0cmluZ3MpIC0gMSkKLQkJCQk8PCBXTEVEM19TSU5L
X1JFR19DVVJSX1NJTktfU0hGVDsKLQotCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5y
ZWdtYXAsCi0JCQkJd2xlZC0+YWRkciArIFdMRUQzX1NJTktfUkVHX0NVUlJfU0lOSywKLQkJCQlX
TEVEM19TSU5LX1JFR19DVVJSX1NJTktfTUFTSywgYWxsKTsKLQkJaWYgKHJjKQotCQkJcmV0dXJu
IHJjOwotCX0KLQogCWZvciAoaSA9IDA7IGkgPCB3bGVkLT5jZmcubnVtX3N0cmluZ3M7ICsraSkg
ewotCQl1MTYgYWRkciA9IHdsZWQtPmFkZHIgKyBXTEVEM19TSU5LX1JFR19TVFJfT0ZGU0VUICog
aTsKLQotCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5yZWdtYXAsCi0JCQkJYWRkciAr
IFdMRUQzX1NJTktfUkVHX1NUUl9NT0RfRU5fQkFTRSwKLQkJCQlXTEVEM19TSU5LX1JFR19TVFJf
TU9EX01BU0ssCi0JCQkJV0xFRDNfU0lOS19SRUdfU1RSX01PRF9FTik7CisJCWogPSB3bGVkLT5j
ZmcuZW5hYmxlZF9zdHJpbmdzW2ldOworCQlhZGRyID0gd2xlZC0+Y3RybF9hZGRyICsgV0xFRDNf
U0lOS19SRUdfU1RSX01PRF9FTihqKTsKKwkJcmMgPSByZWdtYXBfdXBkYXRlX2JpdHMod2xlZC0+
cmVnbWFwLCBhZGRyLAorCQkJCQlXTEVEM19TSU5LX1JFR19TVFJfTU9EX01BU0ssCisJCQkJCVdM
RUQzX1NJTktfUkVHX1NUUl9NT0RfTUFTSyk7CiAJCWlmIChyYykKIAkJCXJldHVybiByYzsKIAog
CQlpZiAod2xlZC0+Y2ZnLmV4dF9nZW4pIHsKLQkJCXJjID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHds
ZWQtPnJlZ21hcCwKLQkJCQkJYWRkciArIFdMRUQzX1NJTktfUkVHX1NUUl9NT0RfU1JDX0JBU0Us
Ci0JCQkJCVdMRUQzX1NJTktfUkVHX1NUUl9NT0RfU1JDX01BU0ssCi0JCQkJCVdMRUQzX1NJTktf
UkVHX1NUUl9NT0RfU1JDX0VYVCk7CisJCQlhZGRyID0gd2xlZC0+Y3RybF9hZGRyICsgV0xFRDNf
U0lOS19SRUdfU1RSX01PRF9TUkMoaik7CisJCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVk
LT5yZWdtYXAsIGFkZHIsCisJCQkJCQlXTEVEM19TSU5LX1JFR19TVFJfTU9EX1NSQ19NQVNLLAor
CQkJCQkJV0xFRDNfU0lOS19SRUdfU1RSX01PRF9TUkNfRVhUKTsKIAkJCWlmIChyYykKIAkJCQly
ZXR1cm4gcmM7CiAJCX0KIAotCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5yZWdtYXAs
Ci0JCQkJYWRkciArIFdMRUQzX1NJTktfUkVHX1NUUl9GVUxMX1NDQUxFX0NVUlIsCi0JCQkJV0xF
RDNfU0lOS19SRUdfU1RSX0ZVTExfU0NBTEVfQ1VSUl9NQVNLLAotCQkJCXdsZWQtPmNmZy5zdHJp
bmdfaV9saW1pdCk7CisJCWFkZHIgPSB3bGVkLT5jdHJsX2FkZHIgKyBXTEVEM19TSU5LX1JFR19T
VFJfRlVMTF9TQ0FMRV9DVVJSKGopOworCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5y
ZWdtYXAsIGFkZHIsCisJCQkJCVdMRUQzX1NJTktfUkVHX1NUUl9GVUxMX1NDQUxFX0NVUlJfTUFT
SywKKwkJCQkJd2xlZC0+Y2ZnLnN0cmluZ19pX2xpbWl0KTsKIAkJaWYgKHJjKQogCQkJcmV0dXJu
IHJjOwogCi0JCXJjID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHdsZWQtPnJlZ21hcCwKLQkJCQlhZGRy
ICsgV0xFRDNfU0lOS19SRUdfU1RSX0NBQkNfQkFTRSwKLQkJCQlXTEVEM19TSU5LX1JFR19TVFJf
Q0FCQ19NQVNLLAotCQkJCXdsZWQtPmNmZy5jYWJjX2VuID8KLQkJCQkJV0xFRDNfU0lOS19SRUdf
U1RSX0NBQkNfRU4gOiAwKTsKKwkJYWRkciA9IHdsZWQtPmN0cmxfYWRkciArIFdMRUQzX1NJTktf
UkVHX1NUUl9DQUJDKGopOworCQlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5yZWdtYXAs
IGFkZHIsCisJCQkJCVdMRUQzX1NJTktfUkVHX1NUUl9DQUJDX01BU0ssCisJCQkJCXdsZWQtPmNm
Zy5jYWJjID8KKwkJCQkJV0xFRDNfU0lOS19SRUdfU1RSX0NBQkNfTUFTSyA6IDApOwogCQlpZiAo
cmMpCiAJCQlyZXR1cm4gcmM7CisKKwkJc2lua19lbiB8PSBCSVQoaiArIFdMRUQzX1NJTktfUkVH
X0NVUlJfU0lOS19TSEZUKTsKIAl9CiAKKwlyYyA9IHJlZ21hcF91cGRhdGVfYml0cyh3bGVkLT5y
ZWdtYXAsCisJCQkJd2xlZC0+Y3RybF9hZGRyICsgV0xFRDNfU0lOS19SRUdfQ1VSUl9TSU5LLAor
CQkJCVdMRUQzX1NJTktfUkVHX0NVUlJfU0lOS19NQVNLLCBzaW5rX2VuKTsKKwlpZiAocmMpCisJ
CXJldHVybiByYzsKKwogCXJldHVybiAwOwogfQogCkBAIC0yMDAsMTcgKzI1OSwxMiBAQCBzdGF0
aWMgaW50IHdsZWRfc2V0dXAoc3RydWN0IHdsZWQgKndsZWQpCiAJLmJvb3N0X2lfbGltaXQgPSAz
LAogCS5zdHJpbmdfaV9saW1pdCA9IDIwLAogCS5vdnAgPSAyLAorCS5udW1fc3RyaW5ncyA9IDMs
CiAJLnN3aXRjaF9mcmVxID0gNSwKLQkubnVtX3N0cmluZ3MgPSAwLAogCS5jc19vdXRfZW4gPSBm
YWxzZSwKIAkuZXh0X2dlbiA9IGZhbHNlLAotCS5jYWJjX2VuID0gZmFsc2UsCi19OwotCi1zdHJ1
Y3Qgd2xlZF92YXJfY2ZnIHsKLQljb25zdCB1MzIgKnZhbHVlczsKLQl1MzIgKCpmbikodTMyKTsK
LQlpbnQgc2l6ZTsKKwkuY2FiYyA9IGZhbHNlLAorCS5lbmFibGVkX3N0cmluZ3MgPSB7MCwgMSwg
MiwgM30sCiB9OwogCiBzdGF0aWMgY29uc3QgdTMyIHdsZWQzX2Jvb3N0X2lfbGltaXRfdmFsdWVz
W10gPSB7CkBAIC0yNTUsNyArMzA5LDExIEBAIHN0YXRpYyB1MzIgd2xlZDNfc3dpdGNoX2ZyZXFf
dmFsdWVzX2ZuKHUzMiBpZHgpCiAJLnNpemUgPSAyNiwKIH07CiAKLXN0YXRpYyB1MzIgd2xlZDNf
dmFsdWVzKGNvbnN0IHN0cnVjdCB3bGVkX3Zhcl9jZmcgKmNmZywgdTMyIGlkeCkKK3N0YXRpYyBj
b25zdCBzdHJ1Y3Qgd2xlZF92YXJfY2ZnIHdsZWQzX3N0cmluZ19jZmcgPSB7CisJLnNpemUgPSA4
LAorfTsKKworc3RhdGljIHUzMiB3bGVkX3ZhbHVlcyhjb25zdCBzdHJ1Y3Qgd2xlZF92YXJfY2Zn
ICpjZmcsIHUzMiBpZHgpCiB7CiAJaWYgKGlkeCA+PSBjZmctPnNpemUpCiAJCXJldHVybiBVSU5U
X01BWDsKQEAgLTI2Niw2OCArMzI0LDc1IEBAIHN0YXRpYyB1MzIgd2xlZDNfdmFsdWVzKGNvbnN0
IHN0cnVjdCB3bGVkX3Zhcl9jZmcgKmNmZywgdTMyIGlkeCkKIAlyZXR1cm4gaWR4OwogfQogCi1z
dGF0aWMgaW50IHdsZWRfY29uZmlndXJlKHN0cnVjdCB3bGVkICp3bGVkLCBzdHJ1Y3QgZGV2aWNl
ICpkZXYpCitzdGF0aWMgaW50IHdsZWRfY29uZmlndXJlKHN0cnVjdCB3bGVkICp3bGVkLCBpbnQg
dmVyc2lvbikKIHsKIAlzdHJ1Y3Qgd2xlZF9jb25maWcgKmNmZyA9ICZ3bGVkLT5jZmc7Ci0JdTMy
IHZhbDsKLQlpbnQgcmM7Ci0JdTMyIGM7Ci0JaW50IGk7Ci0JaW50IGo7Ci0KLQljb25zdCBzdHJ1
Y3QgewotCQljb25zdCBjaGFyICpuYW1lOwotCQl1MzIgKnZhbF9wdHI7Ci0JCWNvbnN0IHN0cnVj
dCB3bGVkX3Zhcl9jZmcgKmNmZzsKLQl9IHUzMl9vcHRzW10gPSB7CisJc3RydWN0IGRldmljZSAq
ZGV2ID0gd2xlZC0+ZGV2OworCWNvbnN0IF9fYmUzMiAqcHJvcF9hZGRyOworCXUzMiBzaXplLCB2
YWwsIGMsIHN0cmluZ19sZW47CisJaW50IHJjLCBpLCBqOworCisJY29uc3Qgc3RydWN0IHdsZWRf
dTMyX29wdHMgKnUzMl9vcHRzID0gTlVMTDsKKwljb25zdCBzdHJ1Y3Qgd2xlZF91MzJfb3B0cyB3
bGVkM19vcHRzW10gPSB7CiAJCXsKLQkJCSJxY29tLGN1cnJlbnQtYm9vc3QtbGltaXQiLAotCQkJ
JmNmZy0+Ym9vc3RfaV9saW1pdCwKKwkJCS5uYW1lID0gInFjb20sY3VycmVudC1ib29zdC1saW1p
dCIsCisJCQkudmFsX3B0ciA9ICZjZmctPmJvb3N0X2lfbGltaXQsCiAJCQkuY2ZnID0gJndsZWQz
X2Jvb3N0X2lfbGltaXRfY2ZnLAogCQl9LAogCQl7Ci0JCQkicWNvbSxjdXJyZW50LWxpbWl0IiwK
LQkJCSZjZmctPnN0cmluZ19pX2xpbWl0LAorCQkJLm5hbWUgPSAicWNvbSxjdXJyZW50LWxpbWl0
IiwKKwkJCS52YWxfcHRyID0gJmNmZy0+c3RyaW5nX2lfbGltaXQsCiAJCQkuY2ZnID0gJndsZWQz
X3N0cmluZ19pX2xpbWl0X2NmZywKIAkJfSwKIAkJewotCQkJInFjb20sb3ZwIiwKLQkJCSZjZmct
Pm92cCwKKwkJCS5uYW1lID0gInFjb20sb3ZwIiwKKwkJCS52YWxfcHRyID0gJmNmZy0+b3ZwLAog
CQkJLmNmZyA9ICZ3bGVkM19vdnBfY2ZnLAogCQl9LAogCQl7Ci0JCQkicWNvbSxzd2l0Y2hpbmct
ZnJlcSIsCi0JCQkmY2ZnLT5zd2l0Y2hfZnJlcSwKKwkJCS5uYW1lID0gInFjb20sc3dpdGNoaW5n
LWZyZXEiLAorCQkJLnZhbF9wdHIgPSAmY2ZnLT5zd2l0Y2hfZnJlcSwKIAkJCS5jZmcgPSAmd2xl
ZDNfc3dpdGNoX2ZyZXFfY2ZnLAogCQl9LAogCQl7Ci0JCQkicWNvbSxudW0tc3RyaW5ncyIsCi0J
CQkmY2ZnLT5udW1fc3RyaW5ncywKKwkJCS5uYW1lID0gInFjb20sbnVtLXN0cmluZ3MiLAorCQkJ
LnZhbF9wdHIgPSAmY2ZnLT5udW1fc3RyaW5ncywKIAkJCS5jZmcgPSAmd2xlZDNfbnVtX3N0cmlu
Z3NfY2ZnLAogCQl9LAogCX07Ci0JY29uc3Qgc3RydWN0IHsKLQkJY29uc3QgY2hhciAqbmFtZTsK
LQkJYm9vbCAqdmFsX3B0cjsKLQl9IGJvb2xfb3B0c1tdID0geworCisJY29uc3Qgc3RydWN0IHds
ZWRfYm9vbF9vcHRzIGJvb2xfb3B0c1tdID0gewogCQl7ICJxY29tLGNzLW91dCIsICZjZmctPmNz
X291dF9lbiwgfSwKIAkJeyAicWNvbSxleHQtZ2VuIiwgJmNmZy0+ZXh0X2dlbiwgfSwKLQkJeyAi
cWNvbSxjYWJjIiwgJmNmZy0+Y2FiY19lbiwgfSwKKwkJeyAicWNvbSxjYWJjIiwgJmNmZy0+Y2Fi
YywgfSwKIAl9OwogCi0JcmMgPSBvZl9wcm9wZXJ0eV9yZWFkX3UzMihkZXYtPm9mX25vZGUsICJy
ZWciLCAmdmFsKTsKLQlpZiAocmMgfHwgdmFsID4gMHhmZmZmKSB7Ci0JCWRldl9lcnIoZGV2LCAi
aW52YWxpZCBJTyByZXNvdXJjZXNcbiIpOwotCQlyZXR1cm4gcmMgPyByYyA6IC1FSU5WQUw7CisJ
cHJvcF9hZGRyID0gb2ZfZ2V0X2FkZHJlc3MoZGV2LT5vZl9ub2RlLCAwLCBOVUxMLCBOVUxMKTsK
KwlpZiAoIXByb3BfYWRkcikgeworCQlkZXZfZXJyKHdsZWQtPmRldiwgImludmFsaWQgSU8gcmVz
b3VyY2VzXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CiAJfQotCXdsZWQtPmFkZHIgPSB2YWw7CisJ
d2xlZC0+Y3RybF9hZGRyID0gYmUzMl90b19jcHUoKnByb3BfYWRkcik7CiAKIAlyYyA9IG9mX3By
b3BlcnR5X3JlYWRfc3RyaW5nKGRldi0+b2Zfbm9kZSwgImxhYmVsIiwgJndsZWQtPm5hbWUpOwog
CWlmIChyYykKIAkJd2xlZC0+bmFtZSA9IGRldm1fa2FzcHJpbnRmKGRldiwgR0ZQX0tFUk5FTCwg
IiVwT0ZuIiwgZGV2LT5vZl9ub2RlKTsKIAotCSpjZmcgPSB3bGVkM19jb25maWdfZGVmYXVsdHM7
Ci0JZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUodTMyX29wdHMpOyArK2kpIHsKKwlzd2l0Y2gg
KHZlcnNpb24pIHsKKwljYXNlIDM6CisJCXUzMl9vcHRzID0gd2xlZDNfb3B0czsKKwkJc2l6ZSA9
IEFSUkFZX1NJWkUod2xlZDNfb3B0cyk7CisJCSpjZmcgPSB3bGVkM19jb25maWdfZGVmYXVsdHM7
CisJCXdsZWQtPndsZWRfc2V0X2JyaWdodG5lc3MgPSB3bGVkM19zZXRfYnJpZ2h0bmVzczsKKwkJ
d2xlZC0+bWF4X3N0cmluZ19jb3VudCA9IDM7CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJZGV2
X2Vycih3bGVkLT5kZXYsICJJbnZhbGlkIFdMRUQgdmVyc2lvblxuIik7CisJCWJyZWFrOworCX0K
KworCWZvciAoaSA9IDA7IGkgPCBzaXplOyArK2kpIHsKIAkJcmMgPSBvZl9wcm9wZXJ0eV9yZWFk
X3UzMihkZXYtPm9mX25vZGUsIHUzMl9vcHRzW2ldLm5hbWUsICZ2YWwpOwogCQlpZiAocmMgPT0g
LUVJTlZBTCkgewogCQkJY29udGludWU7CkBAIC0zMzgsMTIgKzQwMywxNSBAQCBzdGF0aWMgaW50
IHdsZWRfY29uZmlndXJlKHN0cnVjdCB3bGVkICp3bGVkLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiAK
IAkJYyA9IFVJTlRfTUFYOwogCQlmb3IgKGogPSAwOyBjICE9IHZhbDsgaisrKSB7Ci0JCQljID0g
d2xlZDNfdmFsdWVzKHUzMl9vcHRzW2ldLmNmZywgaik7CisJCQljID0gd2xlZF92YWx1ZXModTMy
X29wdHNbaV0uY2ZnLCBqKTsKIAkJCWlmIChjID09IFVJTlRfTUFYKSB7CiAJCQkJZGV2X2Vycihk
ZXYsICJpbnZhbGlkIHZhbHVlIGZvciAnJXMnXG4iLAogCQkJCQl1MzJfb3B0c1tpXS5uYW1lKTsK
IAkJCQlyZXR1cm4gLUVJTlZBTDsKIAkJCX0KKworCQkJaWYgKGMgPT0gdmFsKQorCQkJCWJyZWFr
OwogCQl9CiAKIAkJZGV2X2RiZyhkZXYsICInJXMnID0gJXVcbiIsIHUzMl9vcHRzW2ldLm5hbWUs
IGMpOwpAQCAtMzU3LDYgKzQyNSwxNSBAQCBzdGF0aWMgaW50IHdsZWRfY29uZmlndXJlKHN0cnVj
dCB3bGVkICp3bGVkLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiAKIAljZmctPm51bV9zdHJpbmdzID0g
Y2ZnLT5udW1fc3RyaW5ncyArIDE7CiAKKwlzdHJpbmdfbGVuID0gb2ZfcHJvcGVydHlfY291bnRf
ZWxlbXNfb2Zfc2l6ZShkZXYtPm9mX25vZGUsCisJCQkJCQkgICAgICJxY29tLGVuYWJsZWQtc3Ry
aW5ncyIsCisJCQkJCQkgICAgIHNpemVvZih1MzIpKTsKKwlpZiAoc3RyaW5nX2xlbiA+IDApCisJ
CXJjID0gb2ZfcHJvcGVydHlfcmVhZF91MzJfYXJyYXkoZGV2LT5vZl9ub2RlLAorCQkJCQkJInFj
b20sZW5hYmxlZC1zdHJpbmdzIiwKKwkJCQkJCXdsZWQtPmNmZy5lbmFibGVkX3N0cmluZ3MsCisJ
CQkJCQlzaXplb2YodTMyKSk7CisKIAlyZXR1cm4gMDsKIH0KIApAQCAtMzcwLDYgKzQ0Nyw3IEBA
IHN0YXRpYyBpbnQgd2xlZF9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQogCXN0
cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpibDsKIAlzdHJ1Y3Qgd2xlZCAqd2xlZDsKIAlzdHJ1Y3Qg
cmVnbWFwICpyZWdtYXA7CisJaW50IHZlcnNpb247CiAJdTMyIHZhbDsKIAlpbnQgcmM7CiAKQEAg
LTM4NCwyMiArNDYyLDM5IEBAIHN0YXRpYyBpbnQgd2xlZF9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1f
ZGV2aWNlICpwZGV2KQogCQlyZXR1cm4gLUVOT01FTTsKIAogCXdsZWQtPnJlZ21hcCA9IHJlZ21h
cDsKKwl3bGVkLT5kZXYgPSAmcGRldi0+ZGV2OwogCi0JcmMgPSB3bGVkX2NvbmZpZ3VyZSh3bGVk
LCAmcGRldi0+ZGV2KTsKLQlpZiAocmMpCi0JCXJldHVybiByYzsKKwl2ZXJzaW9uID0gKHVpbnRw
dHJfdClvZl9kZXZpY2VfZ2V0X21hdGNoX2RhdGEoJnBkZXYtPmRldik7CisJaWYgKCF2ZXJzaW9u
KSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwgIlVua25vd24gZGV2aWNlIHZlcnNpb25cbiIpOwor
CQlyZXR1cm4gLUVOT0RFVjsKKwl9CiAKLQlyYyA9IHdsZWRfc2V0dXAod2xlZCk7CisJcmMgPSB3
bGVkX2NvbmZpZ3VyZSh3bGVkLCB2ZXJzaW9uKTsKIAlpZiAocmMpCiAJCXJldHVybiByYzsKIAor
CXN3aXRjaCAodmVyc2lvbikgeworCWNhc2UgMzoKKwkJcmMgPSB3bGVkM19zZXR1cCh3bGVkKTsK
KwkJaWYgKHJjKSB7CisJCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJ3bGVkM19zZXR1cCBmYWlsZWRc
biIpOworCQkJcmV0dXJuIHJjOworCQl9CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJZGV2X2Vy
cih3bGVkLT5kZXYsICJJbnZhbGlkIFdMRUQgdmVyc2lvblxuIik7CisJCWJyZWFrOworCX0KKwog
CXZhbCA9IFdMRURfREVGQVVMVF9CUklHSFRORVNTOwogCW9mX3Byb3BlcnR5X3JlYWRfdTMyKHBk
ZXYtPmRldi5vZl9ub2RlLCAiZGVmYXVsdC1icmlnaHRuZXNzIiwgJnZhbCk7CiAKIAltZW1zZXQo
JnByb3BzLCAwLCBzaXplb2Yoc3RydWN0IGJhY2tsaWdodF9wcm9wZXJ0aWVzKSk7CiAJcHJvcHMu
dHlwZSA9IEJBQ0tMSUdIVF9SQVc7CiAJcHJvcHMuYnJpZ2h0bmVzcyA9IHZhbDsKLQlwcm9wcy5t
YXhfYnJpZ2h0bmVzcyA9IFdMRUQzX1NJTktfUkVHX0JSSUdIVF9NQVg7CisJcHJvcHMubWF4X2Jy
aWdodG5lc3MgPSBXTEVEX1NJTktfUkVHX0JSSUdIVF9NQVg7CiAJYmwgPSBkZXZtX2JhY2tsaWdo
dF9kZXZpY2VfcmVnaXN0ZXIoJnBkZXYtPmRldiwgd2xlZC0+bmFtZSwKIAkJCQkJICAgICZwZGV2
LT5kZXYsIHdsZWQsCiAJCQkJCSAgICAmd2xlZF9vcHMsICZwcm9wcyk7CkBAIC00MDcsNyArNTAy
LDcgQEAgc3RhdGljIGludCB3bGVkX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYp
CiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCB3bGVkX21hdGNoX3RhYmxl
W10gPSB7Ci0JeyAuY29tcGF0aWJsZSA9ICJxY29tLHBtODk0MS13bGVkIiB9LAorCXsgLmNvbXBh
dGlibGUgPSAicWNvbSxwbTg5NDEtd2xlZCIsIC5kYXRhID0gKHZvaWQgKikzIH0sCiAJe30KIH07
CiBNT0RVTEVfREVWSUNFX1RBQkxFKG9mLCB3bGVkX21hdGNoX3RhYmxlKTsKLS0gClRoZSBRdWFs
Y29tbSBJbm5vdmF0aW9uIENlbnRlciwgSW5jLiBpcyBhIG1lbWJlciBvZiB0aGUgQ29kZSBBdXJv
cmEgRm9ydW0sCiBhIExpbnV4IEZvdW5kYXRpb24gQ29sbGFib3JhdGl2ZSBQcm9qZWN0CgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
