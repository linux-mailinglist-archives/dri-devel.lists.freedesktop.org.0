Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 28B279FCF5
	for <lists+dri-devel@lfdr.de>; Wed, 28 Aug 2019 10:28:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3A25289933;
	Wed, 28 Aug 2019 08:28:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM05-DM3-obe.outbound.protection.outlook.com
 (mail-eopbgr730105.outbound.protection.outlook.com [40.107.73.105])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6B1548975F
 for <dri-devel@lists.freedesktop.org>; Tue, 27 Aug 2019 11:25:03 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=OcEL+T3nBNQyIsdQ7uE5AS3KnlibtULAYjEBmpe3iZNi3BpA8MZpqSem6XRw9i+iVT2Tmd+Z+fR3qIB1eTXrGMFvuu7SobfGwUMka3MTsIyyuazaECeogPK9Z3hSL7E4zhqztmnbeHOMGXI2FHMohzGf4apg2nrdMWBcPOfw60rarENIlnFtWC4YwIyf70x+1Q4C0aMQh5DQ+cLf0xIBBquYzP6yrfOwd47zngVtrTPAt06q3734SreH28cScVnE+nDP3sn/DxbqqJB30dR5jqKkrttbwwryCiJ+2r6xARb4m5l+9bCSRVql/AveoQZKTGu+IplLGoRn3zFYTqxlyA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=1BvuuvLppL4Of5rXa5hNbglNbANoZuTpBB3zMYyQNrc=;
 b=L3zC/Q+hFhILSDhHxI4DCLBiDKBvlTv72hiahGGLV7HBXhQA7psxv881NUK7Sd/4KfvORPadqCpihWu0dw6/OuuMSN66RyG4A6J3dVfImzeqwwjx4dHqYIYKtcUwKDNZsKeUD6U7nNaUr6+l2fJrlzmajGeMyz6xqbag1D8I6MAfSJy5+LXCPyE2rV0v9HcSqBrBe2GhL1yQAyVPzhK0cp6DYtQq386qQoApZKKn2ydl3uge/oBNkAM6LDOKWfA/FgfXwg+MtUEmVOjM1DrCCnGYLoyejaPspwlKlFtprhTStEKJ0g3YuhMz+Fot7AuMZ+KkdP6bkVspmwHFz3EuJA==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from DM6PR21MB1401.namprd21.prod.outlook.com (10.255.109.88) by
 DM6PR21MB1148.namprd21.prod.outlook.com (20.179.50.141) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2241.3; Tue, 27 Aug 2019 11:25:01 +0000
Received: from DM6PR21MB1401.namprd21.prod.outlook.com
 ([fe80::bd0e:e64e:a357:3759]) by DM6PR21MB1401.namprd21.prod.outlook.com
 ([fe80::bd0e:e64e:a357:3759%5]) with mapi id 15.20.2241.000; Tue, 27 Aug 2019
 11:25:01 +0000
From: Wei Hu <weh@microsoft.com>
To: "rdunlap@infradead.org" <rdunlap@infradead.org>, "shc_work@mail.ru"
 <shc_work@mail.ru>, "gregkh@linuxfoundation.org"
 <gregkh@linuxfoundation.org>, "lee.jones@linaro.org" <lee.jones@linaro.org>,
 "alexandre.belloni@bootlin.com" <alexandre.belloni@bootlin.com>,
 "baijiaju1990@gmail.com" <baijiaju1990@gmail.com>,
 "fthain@telegraphics.com.au" <fthain@telegraphics.com.au>, "info@metux.net"
 <info@metux.net>, "linux-hyperv@vger.kernel.org"
 <linux-hyperv@vger.kernel.org>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "linux-fbdev@vger.kernel.org"
 <linux-fbdev@vger.kernel.org>, "linux-kernel@vger.kernel.org"
 <linux-kernel@vger.kernel.org>, "sashal@kernel.org" <sashal@kernel.org>,
 Stephen Hemminger <sthemmin@microsoft.com>, Haiyang Zhang
 <haiyangz@microsoft.com>, KY Srinivasan <kys@microsoft.com>, Dexuan Cui
 <decui@microsoft.com>, Michael Kelley <mikelley@microsoft.com>
Subject: [PATHC v2] video: hyperv: hyperv_fb: Support deferred IO for Hyper-V
 frame buffer driver
Thread-Topic: [PATHC v2] video: hyperv: hyperv_fb: Support deferred IO for
 Hyper-V frame buffer driver
Thread-Index: AQHVXMoQkghsJmF5GU+6GBoMEWqB8A==
Date: Tue, 27 Aug 2019 11:25:01 +0000
Message-ID: <20190827112421.2770-1-weh@microsoft.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-clientproxiedby: SG2PR06CA0201.apcprd06.prod.outlook.com (2603:1096:4:1::33)
 To DM6PR21MB1401.namprd21.prod.outlook.com
 (2603:10b6:5:22d::24)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.20.1
x-originating-ip: [167.220.255.49]
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: fc77221d-da26-4101-b07d-08d72ae1330f
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(5600166)(711020)(4605104)(1401327)(4618075)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(2017052603328)(7193020);
 SRVR:DM6PR21MB1148; 
x-ms-traffictypediagnostic: DM6PR21MB1148:|DM6PR21MB1148:
x-ms-exchange-transport-forked: True
x-microsoft-antispam-prvs: <DM6PR21MB11488C2B330A7B7B7B8F0144BBA00@DM6PR21MB1148.namprd21.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:8273;
x-forefront-prvs: 0142F22657
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10019020)(979002)(4636009)(39860400002)(396003)(136003)(366004)(346002)(376002)(189003)(199004)(14454004)(4326008)(66946007)(64756008)(66556008)(66476007)(8676002)(81156014)(81166006)(66446008)(53936002)(3846002)(256004)(6116002)(14444005)(71200400001)(10290500003)(66066001)(7736002)(99286004)(36756003)(7416002)(86362001)(3450700001)(478600001)(26005)(2501003)(186003)(1250700005)(102836004)(25786009)(6436002)(6486002)(10090500001)(305945005)(43066004)(386003)(6506007)(107886003)(486006)(5660300002)(50226002)(22452003)(6636002)(8936002)(1511001)(2616005)(6512007)(2201001)(316002)(1076003)(52116002)(71190400001)(110136005)(476003)(30864003)(2906002)(921003)(1121003)(969003)(989001)(999001)(1009001)(1019001);
 DIR:OUT; SFP:1102; SCL:1; SRVR:DM6PR21MB1148;
 H:DM6PR21MB1401.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: I34dHt8bDZMeDWKWsjcuvLvZArFqkbmFpVSHBCoHEpxjbvYC0dammoI3+hZ0O0lXNHy/DVcJr+7xXplnnzW65fdqtsQoOZ/cxNSrRJXJl6uFoqkqbM+jojcE2AJ+EoDAHYkgZLVnQKDQ8u1u2sjN8LCQV7TmAh4WXoqLZwbdEdmbNMuCfYUsT2Gdk6g5u7xeNcEtXe/a2kbwRryzA6nXW/ZL+Gl3YSAmVOW9XmQYVp+2uZAxACE8HrRQYYB8LEJQOiDwshJuuijuyQGWeMz2B9YAnGeDQlCRonEPsIGbBJVir8dyFUsV8/6IvwJevp2GA20BAp6qabKLwDBgYBckPFB25N2FGxoHX8aR0mwVojCOSwTXv95eMuNoaxgD3len+0fiFpcY7V671hzFDDvVSUQ47Ik+H7NyE5Wth8/vSoA=
MIME-Version: 1.0
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: fc77221d-da26-4101-b07d-08d72ae1330f
X-MS-Exchange-CrossTenant-originalarrivaltime: 27 Aug 2019 11:25:01.1801 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: IAUTBw2HSrz6ms+yB+ZwNxLbuoxciXT9gCqvxbAQl6huALCGWjMI7eljb0UUC7dAbcAUhIp433Fl0D1glN8Itw==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM6PR21MB1148
X-Mailman-Approved-At: Wed, 28 Aug 2019 08:28:09 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector1;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=1BvuuvLppL4Of5rXa5hNbglNbANoZuTpBB3zMYyQNrc=;
 b=Ixl/LqAWsvQ9gaYPY+HznftkqYEmhIuSLt6VYfhAgI19l6WIsZoljuIL2wLEfowK5nuHVDGXMaQBuKzUv/0DvJWS59kvRy2GKdR/S4AGqFJ7VIVtZn27ZGH+xAh0mv+DqU/ZOwY25WRZzjkEREsNPudTjbqa4kXUQnLzbXGzwR0=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: Wei Hu <weh@microsoft.com>
Cc: Wei Hu <weh@microsoft.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2l0aG91dCBkZWZlcnJlZCBJTyBzdXBwb3J0LCBoeXBlcnZfZmIgZHJpdmVyIGluZm9ybXMgdGhl
IGhvc3QgdG8gcmVmcmVzaAp0aGUgZW50aXJlIGd1ZXN0IGZyYW1lIGJ1ZmZlciBhdCBmaXhlZCBy
YXRlLCBlLmcuIGF0IDIwSHosIG5vIG1hdHRlciB0aGVyZQppcyBzY3JlZW4gdXBkYXRlIG9yIG5v
dC4gVGhpcyBwYXRjaCBzdXBwb3J0cyBkZWZlcnJlZCBJTyBmb3Igc2NyZWVucyBpbgpncmFwaGlj
cyBtb2RlIGFuZCBhbHNvIGVuYWJsZXMgdGhlIGZyYW1lIGJ1ZmZlciBvbi1kZW1hbmQgcmVmcmVz
aC4gVGhlCmhpZ2hlc3QgcmVmcmVzaCByYXRlIGlzIHN0aWxsIHNldCBhdCAyMEh6LgoKQ3VycmVu
dGx5IEh5cGVyLVYgb25seSB0YWtlcyBhIHBoeXNpY2FsIGFkZHJlc3MgZnJvbSBndWVzdCBhcyB0
aGUgc3RhcnRpbmcKYWRkcmVzcyBvZiBmcmFtZSBidWZmZXIuIFRoaXMgaW1wbGllcyB0aGUgZ3Vl
c3QgbXVzdCBhbGxvY2F0ZSBjb250aWd1b3VzCnBoeXNpY2FsIG1lbW9yeSBmb3IgZnJhbWUgYnVm
ZmVyLiBJbiBhZGRpdGlvbiwgSHlwZXItViBHZW4gMiBWTXMgb25seQphY2NlcHQgYWRkcmVzcyBm
cm9tIE1NSU8gcmVnaW9uIGFzIGZyYW1lIGJ1ZmZlciBhZGRyZXNzLiBEdWUgdG8gdGhlc2UKbGlt
aXRhdGlvbnMgb24gSHlwZXItViBob3N0LCB3ZSBrZWVwIGEgc2hhZG93IGNvcHkgb2YgZnJhbWUg
YnVmZmVyCmluIHRoZSBndWVzdC4gVGhpcyBtZWFucyBvbmUgbW9yZSBjb3B5IG9mIHRoZSBkaXJ0
eSByZWN0YW5nbGUgaW5zaWRlCmd1ZXN0IHdoZW4gZG9pbmcgdGhlIG9uLWRlbWFuZCByZWZyZXNo
LiBUaGlzIGNhbiBiZSBvcHRpbWl6ZWQgaW4gdGhlCmZ1dHVyZSB3aXRoIGhlbHAgZnJvbSBob3N0
LiBGb3Igbm93IHRoZSBob3N0IHBlcmZvcm1hbmNlIGdhaW4gZnJvbSBkZWZlcnJlZApJTyBvdXR3
ZWlnaHMgdGhlIHNoYWRvdyBjb3B5IGltcGFjdCBpbiB0aGUgZ3Vlc3QuCgp2MjogSW5jb3Jwb3Jh
dGVkIHJldmlldyBjb21tZW50cyBmcm9tIE1pY2hhZWwgS2VsbGV5Ci0gSW5jcmVhc2VkIGRpcnR5
IHJlY3RhbmdsZSBieSBvbmUgcm93IGluIGRlZmVycmVkIElPIGNhc2Ugd2hlbiBzZW5kaW5nCnRv
IEh5cGVyLVYuCi0gQ29ycmVjdGVkIHRoZSBkaXJ0eSByZWN0YW5nbGUgc2l6ZSBpbiB0aGUgdGV4
dCBtb2RlLgotIEFkZGVkIG1vcmUgY29tbWVudHMuCi0gT3RoZXIgbWlub3IgY29kZSBjbGVhbnVw
cy4KClNpZ25lZC1vZmYtYnk6IFdlaSBIdSA8d2VoQG1pY3Jvc29mdC5jb20+Ci0tLQogZHJpdmVy
cy92aWRlby9mYmRldi9LY29uZmlnICAgICB8ICAgMSArCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5
cGVydl9mYi5jIHwgMjIxICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0tCiAyIGZpbGVz
IGNoYW5nZWQsIDIwMiBpbnNlcnRpb25zKCspLCAyMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25m
aWcKaW5kZXggMWIyZjVmMzFmYjZmLi5lNzgxZjg5YTE4MjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
dmlkZW8vZmJkZXYvS2NvbmZpZworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcKQEAg
LTIyNDEsNiArMjI0MSw3IEBAIGNvbmZpZyBGQl9IWVBFUlYKIAlzZWxlY3QgRkJfQ0ZCX0ZJTExS
RUNUCiAJc2VsZWN0IEZCX0NGQl9DT1BZQVJFQQogCXNlbGVjdCBGQl9DRkJfSU1BR0VCTElUCisJ
c2VsZWN0IEZCX0RFRkVSUkVEX0lPCiAJaGVscAogCSAgVGhpcyBmcmFtZWJ1ZmZlciBkcml2ZXIg
c3VwcG9ydHMgTWljcm9zb2Z0IEh5cGVyLVYgU3ludGhldGljIFZpZGVvLgogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jIGIvZHJpdmVycy92aWRlby9mYmRldi9o
eXBlcnZfZmIuYwppbmRleCAyY2E0MDBjMGQ2MjEuLjI3OWEyMTY0YTU3YyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2
L2h5cGVydl9mYi5jCkBAIC0yMzQsNiArMjM0LDcgQEAgc3RydWN0IHN5bnRodmlkX21zZyB7CiAj
ZGVmaW5lIFJJTkdfQlVGU0laRSAoMjU2ICogMTAyNCkKICNkZWZpbmUgVlNQX1RJTUVPVVQgKDEw
ICogSFopCiAjZGVmaW5lIEhWRkJfVVBEQVRFX0RFTEFZIChIWiAvIDIwKQorI2RlZmluZSBIVkZC
X09OREVNQU5EX1RIUk9UVExFIChIWiAvIDIwKQogCiBzdHJ1Y3QgaHZmYl9wYXIgewogCXN0cnVj
dCBmYl9pbmZvICppbmZvOwpAQCAtMjUzLDYgKzI1NCwxNyBAQCBzdHJ1Y3QgaHZmYl9wYXIgewog
CWJvb2wgc3luY2hyb25vdXNfZmI7CiAKIAlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgaHZmYl9wYW5p
Y19uYjsKKworCS8qIE1lbW9yeSBmb3IgZGVmZXJyZWQgSU8gYW5kIGZyYW1lIGJ1ZmZlciBpdHNl
bGYgKi8KKwl1bnNpZ25lZCBjaGFyICpkaW9fdnA7CisJdW5zaWduZWQgY2hhciAqbW1pb192cDsK
Kwl1bnNpZ25lZCBsb25nIG1taW9fcHA7CisJc3BpbmxvY2tfdCBkb2NvcHlfbG9jazsgLyogTG9j
ayB0byBwcm90ZWN0IG1lbW9yeSBjb3B5ICovCisKKwkvKiBEaXJ0eSByZWN0YW5nbGUsIHByb3Rl
Y3RlZCBieSBkZWxheWVkX3JlZnJlc2hfbG9jayAqLworCWludCB4MSwgeTEsIHgyLCB5MjsKKwli
b29sIGRlbGF5ZWRfcmVmcmVzaDsKKwlzcGlubG9ja190IGRlbGF5ZWRfcmVmcmVzaF9sb2NrOwog
fTsKIAogc3RhdGljIHVpbnQgc2NyZWVuX3dpZHRoID0gSFZGQl9XSURUSDsKQEAgLTI2MSw2ICsy
NzMsNyBAQCBzdGF0aWMgdWludCBzY3JlZW5fd2lkdGhfbWF4ID0gSFZGQl9XSURUSDsKIHN0YXRp
YyB1aW50IHNjcmVlbl9oZWlnaHRfbWF4ID0gSFZGQl9IRUlHSFQ7CiBzdGF0aWMgdWludCBzY3Jl
ZW5fZGVwdGg7CiBzdGF0aWMgdWludCBzY3JlZW5fZmJfc2l6ZTsKK3N0YXRpYyB1aW50IGRpb19m
Yl9zaXplOyAvKiBGQiBzaXplIGZvciBkZWZlcnJlZCBJTyAqLwogCiAvKiBTZW5kIG1lc3NhZ2Ug
dG8gSHlwZXItViBob3N0ICovCiBzdGF0aWMgaW5saW5lIGludCBzeW50aHZpZF9zZW5kKHN0cnVj
dCBodl9kZXZpY2UgKmhkZXYsCkBAIC0zNDcsMjggKzM2MCw5NCBAQCBzdGF0aWMgaW50IHN5bnRo
dmlkX3NlbmRfcHRyKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYpCiB9CiAKIC8qIFNlbmQgdXBkYXRl
ZCBzY3JlZW4gYXJlYSAoZGlydHkgcmVjdGFuZ2xlKSBsb2NhdGlvbiB0byBob3N0ICovCi1zdGF0
aWMgaW50IHN5bnRodmlkX3VwZGF0ZShzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKK3N0YXRpYyBpbnQK
K3N5bnRodmlkX3VwZGF0ZShzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgaW50IHgxLCBpbnQgeTEsIGlu
dCB4MiwgaW50IHkyKQogewogCXN0cnVjdCBodl9kZXZpY2UgKmhkZXYgPSBkZXZpY2VfdG9faHZf
ZGV2aWNlKGluZm8tPmRldmljZSk7CiAJc3RydWN0IHN5bnRodmlkX21zZyBtc2c7CiAKIAltZW1z
ZXQoJm1zZywgMCwgc2l6ZW9mKHN0cnVjdCBzeW50aHZpZF9tc2cpKTsKKwlpZiAoeDIgPT0gSU5U
X01BWCkKKwkJeDIgPSBpbmZvLT52YXIueHJlczsKKwlpZiAoeTIgPT0gSU5UX01BWCkKKwkJeTIg
PSBpbmZvLT52YXIueXJlczsKIAogCW1zZy52aWRfaGRyLnR5cGUgPSBTWU5USFZJRF9ESVJUOwog
CW1zZy52aWRfaGRyLnNpemUgPSBzaXplb2Yoc3RydWN0IHN5bnRodmlkX21zZ19oZHIpICsKIAkJ
c2l6ZW9mKHN0cnVjdCBzeW50aHZpZF9kaXJ0KTsKIAltc2cuZGlydC52aWRlb19vdXRwdXQgPSAw
OwogCW1zZy5kaXJ0LmRpcnRfY291bnQgPSAxOwotCW1zZy5kaXJ0LnJlY3RbMF0ueDEgPSAwOwot
CW1zZy5kaXJ0LnJlY3RbMF0ueTEgPSAwOwotCW1zZy5kaXJ0LnJlY3RbMF0ueDIgPSBpbmZvLT52
YXIueHJlczsKLQltc2cuZGlydC5yZWN0WzBdLnkyID0gaW5mby0+dmFyLnlyZXM7CisJbXNnLmRp
cnQucmVjdFswXS54MSA9ICh4MSA+IHgyKSA/IDAgOiB4MTsKKwltc2cuZGlydC5yZWN0WzBdLnkx
ID0gKHkxID4geTIpID8gMCA6IHkxOworCW1zZy5kaXJ0LnJlY3RbMF0ueDIgPQorCQkoeDIgPCB4
MSB8fCB4MiA+IGluZm8tPnZhci54cmVzKSA/IGluZm8tPnZhci54cmVzIDogeDI7CisJbXNnLmRp
cnQucmVjdFswXS55MiA9CisJCSh5MiA8IHkxIHx8IHkyID4gaW5mby0+dmFyLnlyZXMpID8gaW5m
by0+dmFyLnlyZXMgOiB5MjsKIAogCXN5bnRodmlkX3NlbmQoaGRldiwgJm1zZyk7CiAKIAlyZXR1
cm4gMDsKIH0KIAorc3RhdGljIHZvaWQgaHZmYl9kb2NvcHkoc3RydWN0IGh2ZmJfcGFyICpwYXIs
CisJCQl1bnNpZ25lZCBsb25nIG9mZnNldCwKKwkJCXVuc2lnbmVkIGxvbmcgc2l6ZSkKK3sKKwlp
ZiAoIXBhciB8fCAhcGFyLT5tbWlvX3ZwIHx8ICFwYXItPmRpb192cCB8fCAhcGFyLT5mYl9yZWFk
eSB8fAorCSAgICBzaXplID09IDAgfHwgb2Zmc2V0ID49IGRpb19mYl9zaXplKQorCQlyZXR1cm47
CisKKwlpZiAob2Zmc2V0ICsgc2l6ZSA+IGRpb19mYl9zaXplKQorCQlzaXplID0gZGlvX2ZiX3Np
emUgLSBvZmZzZXQ7CisKKwltZW1jcHkocGFyLT5tbWlvX3ZwICsgb2Zmc2V0LCBwYXItPmRpb192
cCArIG9mZnNldCwgc2l6ZSk7Cit9CisKKy8qIERlZmVycmVkIElPIGNhbGxiYWNrICovCitzdGF0
aWMgdm9pZCBzeW50aHZpZF9kZWZlcnJlZF9pbyhzdHJ1Y3QgZmJfaW5mbyAqcCwKKwkJCQkgc3Ry
dWN0IGxpc3RfaGVhZCAqcGFnZWxpc3QpCit7CisJc3RydWN0IGh2ZmJfcGFyICpwYXIgPSBwLT5w
YXI7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJdW5zaWduZWQgbG9uZyBzdGFydCwgZW5kOworCWlu
dCB5MSwgeTIsIG1pbnksIG1heHk7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCW1pbnkgPSBJ
TlRfTUFYOworCW1heHkgPSAwOworCisJLyoKKwkgKiBNZXJnZSBkaXJ0eSBwYWdlcy4gSXQgaXMg
cG9zc2libGUgdGhhdCBsYXN0IHBhZ2UgY3Jvc3MKKwkgKiBvdmVyIHRoZSBlbmQgb2YgZnJhbWUg
YnVmZmVyIHJvdyB5cmVzLiBUaGlzIGlzIHRha2VuIGNhcmUgb2YKKwkgKiBpbiBzeW50aHZpZF91
cGRhdGUgZnVuY3Rpb24gYnkgY2xhbXBpbmcgdGhlIHkyCisJICogdmFsdWUgdG8geXJlcy4KKwkg
Ki8KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHBhZ2UsIHBhZ2VsaXN0LCBscnUpIHsKKwkJc3RhcnQg
PSBwYWdlLT5pbmRleCA8PCBQQUdFX1NISUZUOworCQllbmQgPSBzdGFydCArIFBBR0VfU0laRSAt
IDE7CisJCXkxID0gc3RhcnQgLyBwLT5maXgubGluZV9sZW5ndGg7CisJCXkyID0gZW5kIC8gcC0+
Zml4LmxpbmVfbGVuZ3RoOworCQlpZiAoeTIgPiBwLT52YXIueXJlcykKKwkJCXkyID0gcC0+dmFy
LnlyZXM7CisJCW1pbnkgPSBtaW5fdChpbnQsIG1pbnksIHkxKTsKKwkJbWF4eSA9IG1heF90KGlu
dCwgbWF4eSwgeTIpOworCisJCS8qIENvcHkgZnJvbSBkaW8gc3BhY2UgdG8gbW1pbyBhZGRyZXNz
ICovCisJCWlmIChwYXItPmZiX3JlYWR5KSB7CisJCQlzcGluX2xvY2tfaXJxc2F2ZSgmcGFyLT5k
b2NvcHlfbG9jaywgZmxhZ3MpOworCQkJaHZmYl9kb2NvcHkocGFyLCBzdGFydCwgUEFHRV9TSVpF
KTsKKwkJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBhci0+ZG9jb3B5X2xvY2ssIGZsYWdzKTsK
KwkJfQorCX0KKworCWlmIChwYXItPmZiX3JlYWR5KQorCQlzeW50aHZpZF91cGRhdGUocCwgMCwg
bWlueSwgcC0+dmFyLnhyZXMsIG1heHkgKyAxKTsKK30KKworc3RhdGljIHN0cnVjdCBmYl9kZWZl
cnJlZF9pbyBzeW50aHZpZF9kZWZpbyA9IHsKKwkuZGVsYXkJCT0gSFogLyAyMCwKKwkuZGVmZXJy
ZWRfaW8JPSBzeW50aHZpZF9kZWZlcnJlZF9pbywKK307CiAKIC8qCiAgKiBBY3Rpb25zIG9uIHJl
Y2VpdmVkIG1lc3NhZ2VzIGZyb20gaG9zdDoKQEAgLTYwNCw3ICs2ODMsNyBAQCBzdGF0aWMgaW50
IHN5bnRodmlkX3NlbmRfY29uZmlnKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYpCiAJbXNnLT52aWRf
aGRyLnR5cGUgPSBTWU5USFZJRF9WUkFNX0xPQ0FUSU9OOwogCW1zZy0+dmlkX2hkci5zaXplID0g
c2l6ZW9mKHN0cnVjdCBzeW50aHZpZF9tc2dfaGRyKSArCiAJCXNpemVvZihzdHJ1Y3Qgc3ludGh2
aWRfdnJhbV9sb2NhdGlvbik7Ci0JbXNnLT52cmFtLnVzZXJfY3R4ID0gbXNnLT52cmFtLnZyYW1f
Z3BhID0gaW5mby0+Zml4LnNtZW1fc3RhcnQ7CisJbXNnLT52cmFtLnVzZXJfY3R4ID0gbXNnLT52
cmFtLnZyYW1fZ3BhID0gcGFyLT5tbWlvX3BwOwogCW1zZy0+dnJhbS5pc192cmFtX2dwYV9zcGVj
aWZpZWQgPSAxOwogCXN5bnRodmlkX3NlbmQoaGRldiwgbXNnKTsKIApAQCAtNjE0LDcgKzY5Myw3
IEBAIHN0YXRpYyBpbnQgc3ludGh2aWRfc2VuZF9jb25maWcoc3RydWN0IGh2X2RldmljZSAqaGRl
dikKIAkJcmV0ID0gLUVUSU1FRE9VVDsKIAkJZ290byBvdXQ7CiAJfQotCWlmIChtc2ctPnZyYW1f
YWNrLnVzZXJfY3R4ICE9IGluZm8tPmZpeC5zbWVtX3N0YXJ0KSB7CisJaWYgKG1zZy0+dnJhbV9h
Y2sudXNlcl9jdHggIT0gcGFyLT5tbWlvX3BwKSB7CiAJCXByX2VycigiVW5hYmxlIHRvIHNldCBW
UkFNIGxvY2F0aW9uXG4iKTsKIAkJcmV0ID0gLUVOT0RFVjsKIAkJZ290byBvdXQ7CkBAIC02MzEs
MTkgKzcxMCw4MiBAQCBzdGF0aWMgaW50IHN5bnRodmlkX3NlbmRfY29uZmlnKHN0cnVjdCBodl9k
ZXZpY2UgKmhkZXYpCiAKIC8qCiAgKiBEZWxheWVkIHdvcmsgY2FsbGJhY2s6Ci0gKiBJdCBpcyBj
YWxsZWQgYXQgSFZGQl9VUERBVEVfREVMQVkgb3IgbG9uZ2VyIHRpbWUgaW50ZXJ2YWwgdG8gcHJv
Y2VzcwotICogc2NyZWVuIHVwZGF0ZXMuIEl0IGlzIHJlLXNjaGVkdWxlZCBpZiBmdXJ0aGVyIHVw
ZGF0ZSBpcyBuZWNlc3NhcnkuCisgKiBJdCBpcyBzY2hlZHVsZWQgdG8gY2FsbCB3aGVuZXZlciB1
cGRhdGUgcmVxdWVzdCBpcyByZWNlaXZlZCBhbmQgaXQgaGFzCisgKiBub3QgYmVlbiBjYWxsZWQg
aW4gbGFzdCBIVkZCX09OREVNQU5EX1RIUk9UVExFIHRpbWUgaW50ZXJ2YWwuCiAgKi8KIHN0YXRp
YyB2b2lkIGh2ZmJfdXBkYXRlX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3KQogewogCXN0cnVj
dCBodmZiX3BhciAqcGFyID0gY29udGFpbmVyX29mKHcsIHN0cnVjdCBodmZiX3BhciwgZHdvcmsu
d29yayk7CiAJc3RydWN0IGZiX2luZm8gKmluZm8gPSBwYXItPmluZm87CisJdW5zaWduZWQgbG9u
ZyBmbGFnczsKKwlpbnQgeDEsIHgyLCB5MSwgeTI7CisJaW50IGo7CisKKwlzcGluX2xvY2tfaXJx
c2F2ZSgmcGFyLT5kZWxheWVkX3JlZnJlc2hfbG9jaywgZmxhZ3MpOworCS8qIFJlc2V0IHRoZSBy
ZXF1ZXN0IGZsYWcgKi8KKwlwYXItPmRlbGF5ZWRfcmVmcmVzaCA9IGZhbHNlOworCisJLyogU3Rv
cmUgdGhlIGRpcnR5IHJlY3RhbmdsZSB0byBsb2NhbCB2YXJpYWJsZXMgKi8KKwl4MSA9IHBhci0+
eDE7CisJeDIgPSBwYXItPngyOworCXkxID0gcGFyLT55MTsKKwl5MiA9IHBhci0+eTI7CisKKwkv
KiBDbGVhciBkaXJ0eSByZWN0YW5nbGUgKi8KKwlwYXItPngxID0gcGFyLT55MSA9IElOVF9NQVg7
CisJcGFyLT54MiA9IHBhci0+eTIgPSAwOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmcGFy
LT5kZWxheWVkX3JlZnJlc2hfbG9jaywgZmxhZ3MpOwogCisJaWYgKHgxIDwgMCB8fCB4MSA+IGlu
Zm8tPnZhci54cmVzIHx8IHgyIDwgMCB8fAorCSAgICB4MiA+IGluZm8tPnZhci54cmVzIHx8IHkx
IDwgMCB8fCB5MSA+IGluZm8tPnZhci55cmVzIHx8CisJICAgIHkyIDwgMCB8fCB5MiA+IGluZm8t
PnZhci55cmVzIHx8IHgyIDw9IHgxKQorCQlyZXR1cm47CisKKwkvKiBDb3B5IHRoZSBkaXJ0eSBy
ZWN0YW5nbGUgdG8gZnJhbWUgYnVmZmVyIG1lbW9yeSAqLworCXNwaW5fbG9ja19pcnFzYXZlKCZw
YXItPmRvY29weV9sb2NrLCBmbGFncyk7CisJZm9yIChqID0geTE7IGogPCB5MjsgaisrKSB7CisJ
CWlmIChqID09IGluZm8tPnZhci55cmVzKQorCQkJYnJlYWs7CisJCWh2ZmJfZG9jb3B5KHBhciwK
KwkJCSAgICBqICogaW5mby0+Zml4LmxpbmVfbGVuZ3RoICsKKwkJCSAgICAoeDEgKiBzY3JlZW5f
ZGVwdGggLyA4KSwKKwkJCSAgICAoeDIgLSB4MSkgKiBzY3JlZW5fZGVwdGggLyA4KTsKKwl9CisJ
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmcGFyLT5kb2NvcHlfbG9jaywgZmxhZ3MpOworCisJLyog
UmVmcmVzaCAqLwogCWlmIChwYXItPmZiX3JlYWR5KQotCQlzeW50aHZpZF91cGRhdGUoaW5mbyk7
CisJCXN5bnRodmlkX3VwZGF0ZShpbmZvLCB4MSwgeTEsIHgyLCB5Mik7Cit9CisKKy8qCisgKiBD
b250cm9sIHRoZSBvbi1kZW1hbmQgcmVmcmVzaCBmcmVxdWVuY3kuIEl0IHNjaGVkdWxlcyBhIGRl
bGF5ZWQKKyAqIHNjcmVlbiB1cGRhdGUgaWYgaXQgaGFzIG5vdCB5ZXQuCisgKi8KK3N0YXRpYyB2
b2lkIGh2ZmJfb25kZW1hbmRfcmVmcmVzaF90aHJvdHRsZShzdHJ1Y3QgaHZmYl9wYXIgKnBhciwK
KwkJCQkJICAgaW50IHgxLCBpbnQgeTEsIGludCB3LCBpbnQgaCkKK3sKKwl1bnNpZ25lZCBsb25n
IGZsYWdzOworCWludCB4MiA9IHgxICsgdzsKKwlpbnQgeTIgPSB5MSArIGg7CisKKwlzcGluX2xv
Y2tfaXJxc2F2ZSgmcGFyLT5kZWxheWVkX3JlZnJlc2hfbG9jaywgZmxhZ3MpOworCisJLyogTWVy
Z2UgZGlydHkgcmVjdGFuZ2xlICovCisJcGFyLT54MSA9IG1pbl90KGludCwgcGFyLT54MSwgeDEp
OworCXBhci0+eTEgPSBtaW5fdChpbnQsIHBhci0+eTEsIHkxKTsKKwlwYXItPngyID0gbWF4X3Qo
aW50LCBwYXItPngyLCB4Mik7CisJcGFyLT55MiA9IG1heF90KGludCwgcGFyLT55MiwgeTIpOwor
CisJLyogU2NoZWR1bGUgYSBkZWxheWVkIHNjcmVlbiB1cGRhdGUgaWYgbm90IHlldCAqLworCWlm
IChwYXItPmRlbGF5ZWRfcmVmcmVzaCA9PSBmYWxzZSkgeworCQlzY2hlZHVsZV9kZWxheWVkX3dv
cmsoJnBhci0+ZHdvcmssCisJCQkJICAgICAgSFZGQl9PTkRFTUFORF9USFJPVFRMRSk7CisJCXBh
ci0+ZGVsYXllZF9yZWZyZXNoID0gdHJ1ZTsKKwl9CiAKLQlpZiAocGFyLT51cGRhdGUpCi0JCXNj
aGVkdWxlX2RlbGF5ZWRfd29yaygmcGFyLT5kd29yaywgSFZGQl9VUERBVEVfREVMQVkpOworCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJnBhci0+ZGVsYXllZF9yZWZyZXNoX2xvY2ssIGZsYWdzKTsK
IH0KIAogc3RhdGljIGludCBodmZiX29uX3BhbmljKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIs
CkBAIC02NTUsNyArNzk3LDggQEAgc3RhdGljIGludCBodmZiX29uX3BhbmljKHN0cnVjdCBub3Rp
Zmllcl9ibG9jayAqbmIsCiAJcGFyID0gY29udGFpbmVyX29mKG5iLCBzdHJ1Y3QgaHZmYl9wYXIs
IGh2ZmJfcGFuaWNfbmIpOwogCXBhci0+c3luY2hyb25vdXNfZmIgPSB0cnVlOwogCWluZm8gPSBw
YXItPmluZm87Ci0Jc3ludGh2aWRfdXBkYXRlKGluZm8pOworCWh2ZmJfZG9jb3B5KHBhciwgMCwg
ZGlvX2ZiX3NpemUpOworCXN5bnRodmlkX3VwZGF0ZShpbmZvLCAwLCAwLCBJTlRfTUFYLCBJTlRf
TUFYKTsKIAogCXJldHVybiBOT1RJRllfRE9ORTsKIH0KQEAgLTcxNiw3ICs4NTksMTAgQEAgc3Rh
dGljIHZvaWQgaHZmYl9jZmJfZmlsbHJlY3Qoc3RydWN0IGZiX2luZm8gKnAsCiAKIAljZmJfZmls
bHJlY3QocCwgcmVjdCk7CiAJaWYgKHBhci0+c3luY2hyb25vdXNfZmIpCi0JCXN5bnRodmlkX3Vw
ZGF0ZShwKTsKKwkJc3ludGh2aWRfdXBkYXRlKHAsIDAsIDAsIElOVF9NQVgsIElOVF9NQVgpOwor
CWVsc2UKKwkJaHZmYl9vbmRlbWFuZF9yZWZyZXNoX3Rocm90dGxlKHBhciwgcmVjdC0+ZHgsIHJl
Y3QtPmR5LAorCQkJCQkgICAgICAgcmVjdC0+d2lkdGgsIHJlY3QtPmhlaWdodCk7CiB9CiAKIHN0
YXRpYyB2b2lkIGh2ZmJfY2ZiX2NvcHlhcmVhKHN0cnVjdCBmYl9pbmZvICpwLApAQCAtNzI2LDcg
Kzg3MiwxMCBAQCBzdGF0aWMgdm9pZCBodmZiX2NmYl9jb3B5YXJlYShzdHJ1Y3QgZmJfaW5mbyAq
cCwKIAogCWNmYl9jb3B5YXJlYShwLCBhcmVhKTsKIAlpZiAocGFyLT5zeW5jaHJvbm91c19mYikK
LQkJc3ludGh2aWRfdXBkYXRlKHApOworCQlzeW50aHZpZF91cGRhdGUocCwgMCwgMCwgSU5UX01B
WCwgSU5UX01BWCk7CisJZWxzZQorCQlodmZiX29uZGVtYW5kX3JlZnJlc2hfdGhyb3R0bGUocGFy
LCBhcmVhLT5keCwgYXJlYS0+ZHksCisJCQkJCSAgICAgICBhcmVhLT53aWR0aCwgYXJlYS0+aGVp
Z2h0KTsKIH0KIAogc3RhdGljIHZvaWQgaHZmYl9jZmJfaW1hZ2VibGl0KHN0cnVjdCBmYl9pbmZv
ICpwLApAQCAtNzM2LDcgKzg4NSwxMCBAQCBzdGF0aWMgdm9pZCBodmZiX2NmYl9pbWFnZWJsaXQo
c3RydWN0IGZiX2luZm8gKnAsCiAKIAljZmJfaW1hZ2VibGl0KHAsIGltYWdlKTsKIAlpZiAocGFy
LT5zeW5jaHJvbm91c19mYikKLQkJc3ludGh2aWRfdXBkYXRlKHApOworCQlzeW50aHZpZF91cGRh
dGUocCwgMCwgMCwgSU5UX01BWCwgSU5UX01BWCk7CisJZWxzZQorCQlodmZiX29uZGVtYW5kX3Jl
ZnJlc2hfdGhyb3R0bGUocGFyLCBpbWFnZS0+ZHgsIGltYWdlLT5keSwKKwkJCQkJICAgICAgIGlt
YWdlLT53aWR0aCwgaW1hZ2UtPmhlaWdodCk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZmJfb3BzIGh2
ZmJfb3BzID0gewpAQCAtNzk1LDYgKzk0Nyw5IEBAIHN0YXRpYyBpbnQgaHZmYl9nZXRtZW0oc3Ry
dWN0IGh2X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8pCiAJcmVzb3VyY2Vfc2l6
ZV90IHBvdF9zdGFydCwgcG90X2VuZDsKIAlpbnQgcmV0OwogCisJZGlvX2ZiX3NpemUgPQorCQlz
Y3JlZW5fd2lkdGggKiBzY3JlZW5faGVpZ2h0ICogc2NyZWVuX2RlcHRoIC8gODsKKwogCWlmIChn
ZW4ydm0pIHsKIAkJcG90X3N0YXJ0ID0gMDsKIAkJcG90X2VuZCA9IC0xOwpAQCAtODI5LDkgKzk4
NCwxNCBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0
cnVjdCBmYl9pbmZvICppbmZvKQogCWlmICghZmJfdmlydCkKIAkJZ290byBlcnIyOwogCisJLyog
QWxsb2NhdGUgbWVtb3J5IGZvciBkZWZlcnJlZCBJTyAqLworCXBhci0+ZGlvX3ZwID0gdnphbGxv
Yyhyb3VuZF91cChkaW9fZmJfc2l6ZSwgUEFHRV9TSVpFKSk7CisJaWYgKHBhci0+ZGlvX3ZwID09
IE5VTEwpCisJCWdvdG8gZXJyMzsKKwogCWluZm8tPmFwZXJ0dXJlcyA9IGFsbG9jX2FwZXJ0dXJl
cygxKTsKIAlpZiAoIWluZm8tPmFwZXJ0dXJlcykKLQkJZ290byBlcnIzOworCQlnb3RvIGVycjQ7
CiAKIAlpZiAoZ2VuMnZtKSB7CiAJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBz
Y3JlZW5faW5mby5sZmJfYmFzZTsKQEAgLTg0MywxNiArMTAwMywyMyBAQCBzdGF0aWMgaW50IGh2
ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBmYl9pbmZvICppbmZvKQog
CQlpbmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5zaXplID0gcGNpX3Jlc291cmNlX2xlbihwZGV2
LCAwKTsKIAl9CiAKKwkvKiBQaHlzaWNhbCBhZGRyZXNzIG9mIEZCIGRldmljZSAqLworCXBhci0+
bW1pb19wcCA9IHBhci0+bWVtLT5zdGFydDsKKwkvKiBWaXJ0dWFsIGFkZHJlc3Mgb2YgRkIgZGV2
aWNlICovCisJcGFyLT5tbWlvX3ZwID0gKHVuc2lnbmVkIGNoYXIgKikgZmJfdmlydDsKKwogCWlu
Zm8tPmZpeC5zbWVtX3N0YXJ0ID0gcGFyLT5tZW0tPnN0YXJ0OwotCWluZm8tPmZpeC5zbWVtX2xl
biA9IHNjcmVlbl9mYl9zaXplOwotCWluZm8tPnNjcmVlbl9iYXNlID0gZmJfdmlydDsKLQlpbmZv
LT5zY3JlZW5fc2l6ZSA9IHNjcmVlbl9mYl9zaXplOworCWluZm8tPmZpeC5zbWVtX2xlbiA9IGRp
b19mYl9zaXplOworCWluZm8tPnNjcmVlbl9iYXNlID0gcGFyLT5kaW9fdnA7CisJaW5mby0+c2Ny
ZWVuX3NpemUgPSBkaW9fZmJfc2l6ZTsKIAogCWlmICghZ2VuMnZtKQogCQlwY2lfZGV2X3B1dChw
ZGV2KTsKIAogCXJldHVybiAwOwogCitlcnI0OgorCXZmcmVlKHBhci0+ZGlvX3ZwKTsKIGVycjM6
CiAJaW91bm1hcChmYl92aXJ0KTsKIGVycjI6CkBAIC04NzAsNiArMTAzNyw3IEBAIHN0YXRpYyB2
b2lkIGh2ZmJfcHV0bWVtKHN0cnVjdCBmYl9pbmZvICppbmZvKQogewogCXN0cnVjdCBodmZiX3Bh
ciAqcGFyID0gaW5mby0+cGFyOwogCisJdmZyZWUocGFyLT5kaW9fdnApOwogCWlvdW5tYXAoaW5m
by0+c2NyZWVuX2Jhc2UpOwogCXZtYnVzX2ZyZWVfbW1pbyhwYXItPm1lbS0+c3RhcnQsIHNjcmVl
bl9mYl9zaXplKTsKIAlwYXItPm1lbSA9IE5VTEw7CkBAIC04OTUsNiArMTA2MywxMiBAQCBzdGF0
aWMgaW50IGh2ZmJfcHJvYmUoc3RydWN0IGh2X2RldmljZSAqaGRldiwKIAlpbml0X2NvbXBsZXRp
b24oJnBhci0+d2FpdCk7CiAJSU5JVF9ERUxBWUVEX1dPUksoJnBhci0+ZHdvcmssIGh2ZmJfdXBk
YXRlX3dvcmspOwogCisJcGFyLT5kZWxheWVkX3JlZnJlc2ggPSBmYWxzZTsKKwlzcGluX2xvY2tf
aW5pdCgmcGFyLT5kZWxheWVkX3JlZnJlc2hfbG9jayk7CisJc3Bpbl9sb2NrX2luaXQoJnBhci0+
ZG9jb3B5X2xvY2spOworCXBhci0+eDEgPSBwYXItPnkxID0gSU5UX01BWDsKKwlwYXItPngyID0g
cGFyLT55MiA9IDA7CisKIAkvKiBDb25uZWN0IHRvIFZTUCAqLwogCWh2X3NldF9kcnZkYXRhKGhk
ZXYsIGluZm8pOwogCXJldCA9IHN5bnRodmlkX2Nvbm5lY3RfdnNwKGhkZXYpOwpAQCAtOTQ2LDYg
KzExMjAsMTAgQEAgc3RhdGljIGludCBodmZiX3Byb2JlKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYs
CiAJaW5mby0+ZmJvcHMgPSAmaHZmYl9vcHM7CiAJaW5mby0+cHNldWRvX3BhbGV0dGUgPSBwYXIt
PnBzZXVkb19wYWxldHRlOwogCisJLyogSW5pdGlhbGl6ZSBkZWZlcnJlZCBJTyAqLworCWluZm8t
PmZiZGVmaW8gPSAmc3ludGh2aWRfZGVmaW87CisJZmJfZGVmZXJyZWRfaW9faW5pdChpbmZvKTsK
KwogCS8qIFNlbmQgY29uZmlnIHRvIGhvc3QgKi8KIAlyZXQgPSBzeW50aHZpZF9zZW5kX2NvbmZp
ZyhoZGV2KTsKIAlpZiAocmV0KQpAQCAtOTY3LDYgKzExNDUsNyBAQCBzdGF0aWMgaW50IGh2ZmJf
cHJvYmUoc3RydWN0IGh2X2RldmljZSAqaGRldiwKIAlyZXR1cm4gMDsKIAogZXJyb3I6CisJZmJf
ZGVmZXJyZWRfaW9fY2xlYW51cChpbmZvKTsKIAlodmZiX3B1dG1lbShpbmZvKTsKIGVycm9yMjoK
IAl2bWJ1c19jbG9zZShoZGV2LT5jaGFubmVsKTsKQEAgLTk4OSw2ICsxMTY4LDggQEAgc3RhdGlj
IGludCBodmZiX3JlbW92ZShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2KQogCXBhci0+dXBkYXRlID0g
ZmFsc2U7CiAJcGFyLT5mYl9yZWFkeSA9IGZhbHNlOwogCisJZmJfZGVmZXJyZWRfaW9fY2xlYW51
cChpbmZvKTsKKwogCXVucmVnaXN0ZXJfZnJhbWVidWZmZXIoaW5mbyk7CiAJY2FuY2VsX2RlbGF5
ZWRfd29ya19zeW5jKCZwYXItPmR3b3JrKTsKIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
