Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 440A8615E0
	for <lists+dri-devel@lfdr.de>; Sun,  7 Jul 2019 20:24:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4B354899C4;
	Sun,  7 Jul 2019 18:24:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [IPv6:2001:4b98:dc2:55:216:3eff:fef7:d647])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6B0EA899C4
 for <dri-devel@lists.freedesktop.org>; Sun,  7 Jul 2019 18:24:33 +0000 (UTC)
Received: from pendragon.nordic-sky.finnair.com (unknown [38.98.37.142])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id B0812CC;
 Sun,  7 Jul 2019 20:24:10 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 14/60] drm/bridge: tfp410: Replace manual connector handling
 with bridge
Date: Sun,  7 Jul 2019 21:18:51 +0300
Message-Id: <20190707181937.6250-11-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
References: <20190707180852.5512-1-laurent.pinchart@ideasonboard.com>
 <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1562523872;
 bh=icX+a8dSxYpBRqzN1fXVIU221XpHCi/OEok7XY38gFw=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=KbZYvvccT0+3+O4rvcpJcEhDygb23fT6ECjg4rzLTd5h0Qw3C7LXX0B/sGoSl5Qd0
 M3fWw/+utBgES/KXuv9XBdpAVityyWY7rRwdeLm/XTiCeoxeNdgmNYRuZ6PW2zAPMd
 m/awoD6QWYBYuk7q/y4L7UCJRl5B3sRmrRqBez9g=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Tm93IHRoYXQgYSBkcml2ZXIgaXMgYXZhaWxhYmxlIGZvciBkaXNwbGF5IGNvbm5lY3RvcnMsIHJl
cGxhY2UgdGhlCm1hbnVhbCBjb25uZWN0b3IgaGFuZGxpbmcgY29kZSB3aXRoIHVzYWdlIG9mIHRo
ZSBEUk0gYnJpZGdlIEFQSS4gVGhlCnRmcDQxMCBkcml2ZXIgZG9lc24ndCBkZWFsIHdpdGggdGhl
IGRpc3BsYXkgY29ubmVjdG9yIGRpcmVjdGx5IGFueW1vcmUsCmJ1dCBzdGlsbCBkZWxlZ2F0ZXMg
ZHJtX2Nvbm5lY3RvciBvcGVyYXRpb25zIHRvIHRoZSBuZXh0IGJyaWRnZS4gVGhpcwpicmluZ3Mg
dXMgb25lIHN0ZXAgY2xvc2VyIHRvIGhhdmluZyB0aGUgdGZwNDEwIGRyaXZlciBoYW5kbGluZyB0
aGUKVEZQNDEwIG9ubHkuCgpTaWduZWQtb2ZmLWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50
LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90
aS10ZnA0MTAuYyB8IDE5MyArKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNo
YW5nZWQsIDY3IGluc2VydGlvbnMoKyksIDEyNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL3RpLXRmcDQxMC5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRn
ZS90aS10ZnA0MTAuYwppbmRleCBhMWNhZDc3N2IwNTcuLmU5NGM0OTU2NzMxZCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90aS10ZnA0MTAuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL3RpLXRmcDQxMC5jCkBAIC04LDE0ICs4LDEyIEBACiAgKgogICovCiAKLSNpbmNs
dWRlIDxsaW51eC9kZWxheS5oPgotI2luY2x1ZGUgPGxpbnV4L2Z3bm9kZS5oPgogI2luY2x1ZGUg
PGxpbnV4L2dwaW8vY29uc3VtZXIuaD4KICNpbmNsdWRlIDxsaW51eC9pMmMuaD4KLSNpbmNsdWRl
IDxsaW51eC9pcnEuaD4KICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KICNpbmNsdWRlIDxsaW51
eC9vZl9ncmFwaC5oPgogI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1
ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVy
Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9icmlkZ2UuaD4KQEAgLTI4LDE2ICsyNiwxMyBAQAogc3Ry
dWN0IHRmcDQxMCB7CiAJc3RydWN0IGRybV9icmlkZ2UJYnJpZGdlOwogCXN0cnVjdCBkcm1fY29u
bmVjdG9yCWNvbm5lY3RvcjsKLQl1bnNpZ25lZCBpbnQJCWNvbm5lY3Rvcl90eXBlOwogCiAJdTMy
CQkJYnVzX2Zvcm1hdDsKLQlzdHJ1Y3QgaTJjX2FkYXB0ZXIJKmRkYzsKLQlzdHJ1Y3QgZ3Bpb19k
ZXNjCSpocGQ7Ci0JaW50CQkJaHBkX2lycTsKIAlzdHJ1Y3QgZGVsYXllZF93b3JrCWhwZF93b3Jr
OwogCXN0cnVjdCBncGlvX2Rlc2MJKnBvd2VyZG93bjsKIAogCXN0cnVjdCBkcm1fYnJpZGdlX3Rp
bWluZ3MgdGltaW5nczsKKwlzdHJ1Y3QgZHJtX2JyaWRnZQkqbmV4dF9icmlkZ2U7CiAKIAlzdHJ1
Y3QgZGV2aWNlICpkZXY7CiB9OwpAQCAtNjAsMTAgKzU1LDEwIEBAIHN0YXRpYyBpbnQgdGZwNDEw
X2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCXN0cnVjdCBlZGlk
ICplZGlkOwogCWludCByZXQ7CiAKLQlpZiAoIWR2aS0+ZGRjKQorCWlmICghKGR2aS0+bmV4dF9i
cmlkZ2UtPm9wcyAmIERSTV9CUklER0VfT1BfRURJRCkpCiAJCWdvdG8gZmFsbGJhY2s7CiAKLQll
ZGlkID0gZHJtX2dldF9lZGlkKGNvbm5lY3RvciwgZHZpLT5kZGMpOworCWVkaWQgPSBkdmktPm5l
eHRfYnJpZGdlLT5mdW5jcy0+Z2V0X2VkaWQoZHZpLT5uZXh0X2JyaWRnZSwgY29ubmVjdG9yKTsK
IAlpZiAoIWVkaWQpIHsKIAkJZGV2X2luZm8oZHZpLT5kZXYsCiAJCQkgIkVESUQgcmVhZCBmYWls
ZWQuIEZhbGxiYWNrIHRvIHN0YW5kYXJkIG1vZGVzXG4iKTsKQEAgLTk3LDIxICs5MiwxMCBAQCB0
ZnA0MTBfY29ubmVjdG9yX2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBi
b29sIGZvcmNlKQogewogCXN0cnVjdCB0ZnA0MTAgKmR2aSA9IGRybV9jb25uZWN0b3JfdG9fdGZw
NDEwKGNvbm5lY3Rvcik7CiAKLQlpZiAoZHZpLT5ocGQpIHsKLQkJaWYgKGdwaW9kX2dldF92YWx1
ZV9jYW5zbGVlcChkdmktPmhwZCkpCi0JCQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0
ZWQ7Ci0JCWVsc2UKLQkJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKLQl9
CisJaWYgKCEoZHZpLT5uZXh0X2JyaWRnZS0+b3BzICYgRFJNX0JSSURHRV9PUF9ERVRFQ1QpKQor
CQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c191bmtub3duOwogCi0JaWYgKGR2aS0+ZGRjKSB7Ci0J
CWlmIChkcm1fcHJvYmVfZGRjKGR2aS0+ZGRjKSkKLQkJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVz
X2Nvbm5lY3RlZDsKLQkJZWxzZQotCQkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVj
dGVkOwotCX0KLQotCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX3Vua25vd247CisJcmV0dXJuIGR2
aS0+bmV4dF9icmlkZ2UtPmZ1bmNzLT5kZXRlY3QoZHZpLT5uZXh0X2JyaWRnZSk7CiB9CiAKIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9mdW5jcyB0ZnA0MTBfY29uX2Z1bmNzID0g
ewpAQCAtMTIzLDExICsxMDcsMzQgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X2Z1bmNzIHRmcDQxMF9jb25fZnVuY3MgPSB7CiAJLmF0b21pY19kZXN0cm95X3N0YXRlCT0gZHJt
X2F0b21pY19oZWxwZXJfY29ubmVjdG9yX2Rlc3Ryb3lfc3RhdGUsCiB9OwogCitzdGF0aWMgdm9p
ZCB0ZnA0MTBfaHBkX3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3Ry
dWN0IHRmcDQxMCAqZHZpOworCisJZHZpID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCB0ZnA0
MTAsIGhwZF93b3JrLndvcmspOworCisJaWYgKGR2aS0+YnJpZGdlLmRldikKKwkJZHJtX2hlbHBl
cl9ocGRfaXJxX2V2ZW50KGR2aS0+YnJpZGdlLmRldik7Cit9CisKK3N0YXRpYyB2b2lkIHRmcDQx
MF9ocGRfY2FsbGJhY2sodm9pZCAqYXJnLCBlbnVtIGRybV9jb25uZWN0b3Jfc3RhdHVzIHN0YXR1
cykKK3sKKwlzdHJ1Y3QgdGZwNDEwICpkdmkgPSBhcmc7CisKKwltb2RfZGVsYXllZF93b3JrKHN5
c3RlbV93cSwgJmR2aS0+aHBkX3dvcmssCisJCQkgbXNlY3NfdG9famlmZmllcyhIT1RQTFVHX0RF
Qk9VTkNFX01TKSk7Cit9CisKIHN0YXRpYyBpbnQgdGZwNDEwX2F0dGFjaChzdHJ1Y3QgZHJtX2Jy
aWRnZSAqYnJpZGdlLCBib29sIGNyZWF0ZV9jb25uZWN0b3IpCiB7CiAJc3RydWN0IHRmcDQxMCAq
ZHZpID0gZHJtX2JyaWRnZV90b190ZnA0MTAoYnJpZGdlKTsKIAlpbnQgcmV0OwogCisJcmV0ID0g
ZHJtX2JyaWRnZV9hdHRhY2goYnJpZGdlLT5lbmNvZGVyLCBkdmktPm5leHRfYnJpZGdlLCBicmlk
Z2UsCisJCQkJZmFsc2UpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCiAJaWYgKCFj
cmVhdGVfY29ubmVjdG9yKQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtMTM2LDE1ICsxNDMsMjEg
QEAgc3RhdGljIGludCB0ZnA0MTBfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsIGJv
b2wgY3JlYXRlX2Nvbm5lY3RvcikKIAkJcmV0dXJuIC1FTk9ERVY7CiAJfQogCi0JaWYgKGR2aS0+
aHBkX2lycSA+PSAwKQorCWlmIChkdmktPm5leHRfYnJpZGdlLT5vcHMgJiBEUk1fQlJJREdFX09Q
X0RFVEVDVCkKIAkJZHZpLT5jb25uZWN0b3IucG9sbGVkID0gRFJNX0NPTk5FQ1RPUl9QT0xMX0hQ
RDsKIAllbHNlCiAJCWR2aS0+Y29ubmVjdG9yLnBvbGxlZCA9IERSTV9DT05ORUNUT1JfUE9MTF9D
T05ORUNUIHwgRFJNX0NPTk5FQ1RPUl9QT0xMX0RJU0NPTk5FQ1Q7CiAKKwlpZiAoZHZpLT5uZXh0
X2JyaWRnZS0+b3BzICYgRFJNX0JSSURHRV9PUF9IUEQpIHsKKwkJSU5JVF9ERUxBWUVEX1dPUkso
JmR2aS0+aHBkX3dvcmssIHRmcDQxMF9ocGRfd29ya19mdW5jKTsKKwkJZHJtX2JyaWRnZV9ocGRf
ZW5hYmxlKGR2aS0+bmV4dF9icmlkZ2UsIHRmcDQxMF9ocGRfY2FsbGJhY2ssCisJCQkJICAgICAg
ZHZpKTsKKwl9CisKIAlkcm1fY29ubmVjdG9yX2hlbHBlcl9hZGQoJmR2aS0+Y29ubmVjdG9yLAog
CQkJCSAmdGZwNDEwX2Nvbl9oZWxwZXJfZnVuY3MpOwogCXJldCA9IGRybV9jb25uZWN0b3JfaW5p
dChicmlkZ2UtPmRldiwgJmR2aS0+Y29ubmVjdG9yLAotCQkJCSAmdGZwNDEwX2Nvbl9mdW5jcywg
ZHZpLT5jb25uZWN0b3JfdHlwZSk7CisJCQkJICZ0ZnA0MTBfY29uX2Z1bmNzLCBkdmktPm5leHRf
YnJpZGdlLT50eXBlKTsKIAlpZiAocmV0KSB7CiAJCWRldl9lcnIoZHZpLT5kZXYsICJkcm1fY29u
bmVjdG9yX2luaXQoKSBmYWlsZWQ6ICVkXG4iLCByZXQpOwogCQlyZXR1cm4gcmV0OwpAQCAtMTUz
LDEyICsxNjYsMjEgQEAgc3RhdGljIGludCB0ZnA0MTBfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsIGJvb2wgY3JlYXRlX2Nvbm5lY3RvcikKIAlkcm1fZGlzcGxheV9pbmZvX3NldF9i
dXNfZm9ybWF0cygmZHZpLT5jb25uZWN0b3IuZGlzcGxheV9pbmZvLAogCQkJCQkgJmR2aS0+YnVz
X2Zvcm1hdCwgMSk7CiAKLQlkcm1fY29ubmVjdG9yX2F0dGFjaF9lbmNvZGVyKCZkdmktPmNvbm5l
Y3RvciwKLQkJCQkJICBicmlkZ2UtPmVuY29kZXIpOworCWRybV9jb25uZWN0b3JfYXR0YWNoX2Vu
Y29kZXIoJmR2aS0+Y29ubmVjdG9yLCBicmlkZ2UtPmVuY29kZXIpOwogCiAJcmV0dXJuIDA7CiB9
CiAKK3N0YXRpYyB2b2lkIHRmcDQxMF9kZXRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkK
K3sKKwlzdHJ1Y3QgdGZwNDEwICpkdmkgPSBkcm1fYnJpZGdlX3RvX3RmcDQxMChicmlkZ2UpOwor
CisJaWYgKGR2aS0+Y29ubmVjdG9yLmRldiAmJiBkdmktPm5leHRfYnJpZGdlLT5vcHMgJiBEUk1f
QlJJREdFX09QX0hQRCkgeworCQlkcm1fYnJpZGdlX2hwZF9kaXNhYmxlKGR2aS0+bmV4dF9icmlk
Z2UpOworCQljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmR2aS0+aHBkX3dvcmspOworCX0KK30K
Kwogc3RhdGljIHZvaWQgdGZwNDEwX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQog
ewogCXN0cnVjdCB0ZnA0MTAgKmR2aSA9IGRybV9icmlkZ2VfdG9fdGZwNDEwKGJyaWRnZSk7CkBA
IC0xNzUsMzAgKzE5NywxMSBAQCBzdGF0aWMgdm9pZCB0ZnA0MTBfZGlzYWJsZShzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlKQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9icmlkZ2VfZnVuY3Mg
dGZwNDEwX2JyaWRnZV9mdW5jcyA9IHsKIAkuYXR0YWNoCQk9IHRmcDQxMF9hdHRhY2gsCisJLmRl
dGFjaAkJPSB0ZnA0MTBfZGV0YWNoLAogCS5lbmFibGUJCT0gdGZwNDEwX2VuYWJsZSwKIAkuZGlz
YWJsZQk9IHRmcDQxMF9kaXNhYmxlLAogfTsKIAotc3RhdGljIHZvaWQgdGZwNDEwX2hwZF93b3Jr
X2Z1bmMoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQotewotCXN0cnVjdCB0ZnA0MTAgKmR2aTsK
LQotCWR2aSA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgdGZwNDEwLCBocGRfd29yay53b3Jr
KTsKLQotCWlmIChkdmktPmJyaWRnZS5kZXYpCi0JCWRybV9oZWxwZXJfaHBkX2lycV9ldmVudChk
dmktPmJyaWRnZS5kZXYpOwotfQotCi1zdGF0aWMgaXJxcmV0dXJuX3QgdGZwNDEwX2hwZF9pcnFf
dGhyZWFkKGludCBpcnEsIHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgdGZwNDEwICpkdmkgPSBhcmc7
Ci0KLQltb2RfZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJmR2aS0+aHBkX3dvcmssCi0JCQltc2Vj
c190b19qaWZmaWVzKEhPVFBMVUdfREVCT1VOQ0VfTVMpKTsKLQotCXJldHVybiBJUlFfSEFORExF
RDsKLX0KLQogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fYnJpZGdlX3RpbWluZ3MgdGZwNDEwX2Rl
ZmF1bHRfdGltaW5ncyA9IHsKIAkuaW5wdXRfYnVzX2ZsYWdzID0gRFJNX0JVU19GTEFHX1BJWERB
VEFfU0FNUExFX1BPU0VER0UKIAkJCSB8IERSTV9CVVNfRkxBR19ERV9ISUdILApAQCAtMjc2LDUx
ICsyNzksOSBAQCBzdGF0aWMgaW50IHRmcDQxMF9wYXJzZV90aW1pbmdzKHN0cnVjdCB0ZnA0MTAg
KmR2aSwgYm9vbCBpMmMpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgdGZwNDEwX2dldF9j
b25uZWN0b3JfcHJvcGVydGllcyhzdHJ1Y3QgdGZwNDEwICpkdmkpCi17Ci0Jc3RydWN0IGRldmlj
ZV9ub2RlICpjb25uZWN0b3Jfbm9kZSwgKmRkY19waGFuZGxlOwotCWludCByZXQgPSAwOwotCi0J
LyogcG9ydEAxIGlzIHRoZSBjb25uZWN0b3Igbm9kZSAqLwotCWNvbm5lY3Rvcl9ub2RlID0gb2Zf
Z3JhcGhfZ2V0X3JlbW90ZV9ub2RlKGR2aS0+ZGV2LT5vZl9ub2RlLCAxLCAtMSk7Ci0JaWYgKCFj
b25uZWN0b3Jfbm9kZSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlpZiAob2ZfZGV2aWNlX2lzX2Nv
bXBhdGlibGUoY29ubmVjdG9yX25vZGUsICJoZG1pLWNvbm5lY3RvciIpKQotCQlkdmktPmNvbm5l
Y3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0hETUlBOwotCWVsc2UKLQkJZHZpLT5jb25u
ZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9EVklEOwotCi0JZHZpLT5ocGQgPSBmd25v
ZGVfZ2V0X25hbWVkX2dwaW9kKCZjb25uZWN0b3Jfbm9kZS0+Zndub2RlLAotCQkJCQkiaHBkLWdw
aW9zIiwgMCwgR1BJT0RfSU4sICJocGQiKTsKLQlpZiAoSVNfRVJSKGR2aS0+aHBkKSkgewotCQly
ZXQgPSBQVFJfRVJSKGR2aS0+aHBkKTsKLQkJZHZpLT5ocGQgPSBOVUxMOwotCQlpZiAocmV0ID09
IC1FTk9FTlQpCi0JCQlyZXQgPSAwOwotCQllbHNlCi0JCQlnb3RvIGZhaWw7Ci0JfQotCi0JZGRj
X3BoYW5kbGUgPSBvZl9wYXJzZV9waGFuZGxlKGNvbm5lY3Rvcl9ub2RlLCAiZGRjLWkyYy1idXMi
LCAwKTsKLQlpZiAoIWRkY19waGFuZGxlKQotCQlnb3RvIGZhaWw7Ci0KLQlkdmktPmRkYyA9IG9m
X2dldF9pMmNfYWRhcHRlcl9ieV9ub2RlKGRkY19waGFuZGxlKTsKLQlpZiAoZHZpLT5kZGMpCi0J
CWRldl9pbmZvKGR2aS0+ZGV2LCAiQ29ubmVjdG9yJ3MgZGRjIGkyYyBidXMgZm91bmRcbiIpOwot
CWVsc2UKLQkJcmV0ID0gLUVQUk9CRV9ERUZFUjsKLQotCW9mX25vZGVfcHV0KGRkY19waGFuZGxl
KTsKLQotZmFpbDoKLQlvZl9ub2RlX3B1dChjb25uZWN0b3Jfbm9kZSk7Ci0JcmV0dXJuIHJldDsK
LX0KLQogc3RhdGljIGludCB0ZnA0MTBfaW5pdChzdHJ1Y3QgZGV2aWNlICpkZXYsIGJvb2wgaTJj
KQogeworCXN0cnVjdCBkZXZpY2Vfbm9kZSAqbm9kZTsKIAlzdHJ1Y3QgdGZwNDEwICpkdmk7CiAJ
aW50IHJldDsKIApAQCAtMzMyLDIxICsyOTMsMzEgQEAgc3RhdGljIGludCB0ZnA0MTBfaW5pdChz
dHJ1Y3QgZGV2aWNlICpkZXYsIGJvb2wgaTJjKQogCWR2aSA9IGRldm1fa3phbGxvYyhkZXYsIHNp
emVvZigqZHZpKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFkdmkpCiAJCXJldHVybiAtRU5PTUVNOwor
CisJZHZpLT5kZXYgPSBkZXY7CiAJZGV2X3NldF9kcnZkYXRhKGRldiwgZHZpKTsKIAogCWR2aS0+
YnJpZGdlLmZ1bmNzID0gJnRmcDQxMF9icmlkZ2VfZnVuY3M7CiAJZHZpLT5icmlkZ2Uub2Zfbm9k
ZSA9IGRldi0+b2Zfbm9kZTsKIAlkdmktPmJyaWRnZS50aW1pbmdzID0gJmR2aS0+dGltaW5nczsK
LQlkdmktPmRldiA9IGRldjsKKwlkdmktPmJyaWRnZS50eXBlID0gRFJNX01PREVfQ09OTkVDVE9S
X0RWSUQ7CiAKIAlyZXQgPSB0ZnA0MTBfcGFyc2VfdGltaW5ncyhkdmksIGkyYyk7CiAJaWYgKHJl
dCkKLQkJZ290byBmYWlsOworCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gdGZwNDEwX2dldF9jb25u
ZWN0b3JfcHJvcGVydGllcyhkdmkpOwotCWlmIChyZXQpCi0JCWdvdG8gZmFpbDsKKwkvKiBHZXQg
dGhlIG5leHQgYnJpZGdlLCBjb25uZWN0ZWQgdG8gcG9ydEAxLiAqLworCW5vZGUgPSBvZl9ncmFw
aF9nZXRfcmVtb3RlX25vZGUoZGV2LT5vZl9ub2RlLCAxLCAtMSk7CisJaWYgKCFub2RlKQorCQly
ZXR1cm4gLUVOT0RFVjsKIAorCWR2aS0+bmV4dF9icmlkZ2UgPSBvZl9kcm1fZmluZF9icmlkZ2Uo
bm9kZSk7CisJb2Zfbm9kZV9wdXQobm9kZSk7CisKKwlpZiAoIWR2aS0+bmV4dF9icmlkZ2UpCisJ
CXJldHVybiAtRVBST0JFX0RFRkVSOworCisJLyogR2V0IHRoZSBwb3dlcmRvd24gR1BJTy4gKi8K
IAlkdmktPnBvd2VyZG93biA9IGRldm1fZ3Bpb2RfZ2V0X29wdGlvbmFsKGRldiwgInBvd2VyZG93
biIsCiAJCQkJCQkgR1BJT0RfT1VUX0hJR0gpOwogCWlmIChJU19FUlIoZHZpLT5wb3dlcmRvd24p
KSB7CkBAIC0zNTQsNDggKzMyNSwxOCBAQCBzdGF0aWMgaW50IHRmcDQxMF9pbml0KHN0cnVjdCBk
ZXZpY2UgKmRldiwgYm9vbCBpMmMpCiAJCXJldHVybiBQVFJfRVJSKGR2aS0+cG93ZXJkb3duKTsK
IAl9CiAKLQlpZiAoZHZpLT5ocGQpCi0JCWR2aS0+aHBkX2lycSA9IGdwaW9kX3RvX2lycShkdmkt
PmhwZCk7Ci0JZWxzZQotCQlkdmktPmhwZF9pcnEgPSAtRU5YSU87Ci0KLQlpZiAoZHZpLT5ocGRf
aXJxID49IDApIHsKLQkJSU5JVF9ERUxBWUVEX1dPUksoJmR2aS0+aHBkX3dvcmssIHRmcDQxMF9o
cGRfd29ya19mdW5jKTsKLQotCQlyZXQgPSBkZXZtX3JlcXVlc3RfdGhyZWFkZWRfaXJxKGRldiwg
ZHZpLT5ocGRfaXJxLAotCQkJTlVMTCwgdGZwNDEwX2hwZF9pcnFfdGhyZWFkLCBJUlFGX1RSSUdH
RVJfUklTSU5HIHwKLQkJCUlSUUZfVFJJR0dFUl9GQUxMSU5HIHwgSVJRRl9PTkVTSE9ULAotCQkJ
ImhkbWktaHBkIiwgZHZpKTsKLQkJaWYgKHJldCkgewotCQkJZGV2X2VycihkZXYsICJmYWlsZWQg
dG8gcmVnaXN0ZXIgaHBkIGludGVycnVwdFxuIik7Ci0JCQlnb3RvIGZhaWw7Ci0JCX0KLQl9Ci0K
KwkvKiAgUmVnaXN0ZXIgdGhlIERSTSBicmlkZ2UuICovCiAJZHJtX2JyaWRnZV9hZGQoJmR2aS0+
YnJpZGdlKTsKIAogCXJldHVybiAwOwotZmFpbDoKLQlpMmNfcHV0X2FkYXB0ZXIoZHZpLT5kZGMp
OwotCWlmIChkdmktPmhwZCkKLQkJZ3Bpb2RfcHV0KGR2aS0+aHBkKTsKLQlyZXR1cm4gcmV0Owog
fQogCiBzdGF0aWMgaW50IHRmcDQxMF9maW5pKHN0cnVjdCBkZXZpY2UgKmRldikKIHsKIAlzdHJ1
Y3QgdGZwNDEwICpkdmkgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKIAotCWlmIChkdmktPmhwZF9p
cnEgPj0gMCkKLQkJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZkdmktPmhwZF93b3JrKTsKLQog
CWRybV9icmlkZ2VfcmVtb3ZlKCZkdmktPmJyaWRnZSk7CiAKLQlpZiAoZHZpLT5kZGMpCi0JCWky
Y19wdXRfYWRhcHRlcihkdmktPmRkYyk7Ci0JaWYgKGR2aS0+aHBkKQotCQlncGlvZF9wdXQoZHZp
LT5ocGQpOwotCiAJcmV0dXJuIDA7CiB9CiAKLS0gClJlZ2FyZHMsCgpMYXVyZW50IFBpbmNoYXJ0
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2
ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
