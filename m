Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0F39950D04
	for <lists+dri-devel@lfdr.de>; Mon, 24 Jun 2019 15:58:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B12EF89BA3;
	Mon, 24 Jun 2019 13:58:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x442.google.com (mail-wr1-x442.google.com
 [IPv6:2a00:1450:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9DCCD89B8F;
 Mon, 24 Jun 2019 13:58:46 +0000 (UTC)
Received: by mail-wr1-x442.google.com with SMTP id x4so14028710wrt.6;
 Mon, 24 Jun 2019 06:58:46 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=ssLRWpJ8tV4GuQkzAc2igRu8B4GB9ToAaf0T+AXfubY=;
 b=DADIHcjR8uOD4td5xYsvW3WjyKiwdH6nzJgwiwHsOZWjI/5IWHhBDbcJYtL7zuJ6Mm
 VCTC5/tT8kri8q3pZfa7WVUrS/06az0XiBeMkN1p3PU86ubsT6NvwpDX6CRYTSYR8muj
 NGlLoVyde4qtezeNYL/PjX4y6wOBDvhw3x3J9KRoH2TApdsWNteT8VkLvwWd1GpudOP6
 Pggfo51OeykLXeKMKWlQPO9Qm34u1ITIAHwch6fOkjngjwPgh9I71PKanpw05S4VOOIV
 x5JSoVq1SKaqkcsqX6kpoTLG+NPLROJKaTyFsZ5b872XqEKkuJ+E6jwBGvdDv4h3e7ps
 l0Fg==
X-Gm-Message-State: APjAAAXS4tQ3Ch6yKmJwTlBwv2B0U2b8pe7luXaFLMjUgSk3VCTlFcFi
 xyEJ37ExD00/9I+1L3O6Ef7Suk/f
X-Google-Smtp-Source: APXvYqx8cLjKLCiLqC8+XyCiI3kQldGsj1Rk2Tb3lL4IcpmqHrsewmRQItx9+rM2gMTfH2Mwui0JGg==
X-Received: by 2002:a5d:4647:: with SMTP id j7mr874084wrs.334.1561384724594;
 Mon, 24 Jun 2019 06:58:44 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c026:1db1:e413:81a2])
 by smtp.gmail.com with ESMTPSA id y19sm14848623wmc.21.2019.06.24.06.58.43
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 24 Jun 2019 06:58:44 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: intel-gfx@lists.freedesktop.org, dri-devel@lists.freedesktop.org,
 amd-gfx@lists.freedesktop.org
Subject: [PATCH 6/6] drm/amdgpu: add independent DMA-buf import v7
Date: Mon, 24 Jun 2019 15:58:39 +0200
Message-Id: <20190624135839.1661-6-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190624135839.1661-1-christian.koenig@amd.com>
References: <20190624135839.1661-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=ssLRWpJ8tV4GuQkzAc2igRu8B4GB9ToAaf0T+AXfubY=;
 b=OguoQruQEGTM3xXeGEKRNVBO2ZSOEHNeB/QmNFBx4yYKZ+6n18RmIw6A0+WBmPDzpR
 tlb9v/AEIJpBwm+HvRrnychR/ImzzP9+KNjzdeOX09A66j5rLV3TprBdjNip0OFlyqUI
 QPz/Xqs7QSjqfkD9z73C3qskoJMI1f2xAW3DNfbyycMtysDGRWsFGGcJy5ko+s6CmG1s
 zD8vuQzKQR6vN/li/DXCtDo81vJj2BCYSZK4uF4o9V6B1GeXsL5v8SfYntcd5hLWfCCn
 vQRZf5Wysx2psRFH/J9zWdFlfyWamutfaRVsGaEcVBU5c7Ymo1+yyZSsQroWdxTxlclY
 Or5g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBEUk0gZnVuY3Rpb25zIGp1c3QgaW1wbGVtZW50IG91
ciBvd24gaW1wb3J0CmZ1bmN0aW9ucy4gVGhpcyBwcmVwYXJlcyBzdXBwb3J0IGZvciB0YWtpbmcg
Y2FyZSBvZiB1bnBpbm5lZCBETUEtYnVmLgoKdjI6IGVuYWJsZSBmb3IgYWxsIGV4cG9ydGVycywg
bm90IGp1c3QgYW1kZ3B1LCBmaXggaW52YWxpZGF0aW9uCiAgICBoYW5kbGluZywgbG9jayByZXNl
cnZhdGlvbiBvYmplY3Qgd2hpbGUgc2V0dGluZyBjYWxsYmFjawp2MzogY2hhbmdlIHRvIG5ldyBk
bWFfYnVmIGF0dGFjaCBpbnRlcmZhY2UKdjQ6IHNwbGl0IG91dCBmcm9tIHVucGlubmVkIERNQS1i
dWYgd29yawp2NTogcmViYXNlZCBhbmQgY2xlYW51cCBvbiBuZXcgRE1BLWJ1ZiBpbnRlcmZhY2UK
djY6IHNxdWFzaCB3aXRoIGludmFsaWRhdGlvbiBjYWxsYmFjayBjaGFuZ2UsCiAgICBzdG9wIHVz
aW5nIF8obWFwfHVubWFwKV9sb2NrZWQKdjc6IGRyb3AgaW52YWxpZGF0aW9ucyB3aGVuIHRoZSBC
TyBpcyBhbHJlYWR5IGluIHN5c3RlbSBkb21haW4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBL
w7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jIHwgNjggKysrKysrKysrKysrKysrKy0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oIHwgIDQgLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYyAgICAgfCAgMSAtCiBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgIHwgIDYgKysKIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICAgfCAzMiArKysrKysrKy0tCiA1IGZpbGVzIGNoYW5n
ZWQsIDg2IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCmluZGV4IDU3OWUzM2IzMWYyZC4uYjU5NzJlMDYz
MWY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1
Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKQEAg
LTQyNCwzMSArNDI0LDI4IEBAIHN0cnVjdCBkbWFfYnVmICphbWRncHVfZ2VtX3ByaW1lX2V4cG9y
dChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogfQogCiAvKioKLSAqIGFtZGdwdV9nZW1fcHJpbWVf
aW1wb3J0X3NnX3RhYmxlIC0gJmRybV9kcml2ZXIuZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZQot
ICogaW1wbGVtZW50YXRpb24KKyAqIGFtZGdwdV9kbWFfYnVmX2NyZWF0ZV9vYmogLSBjcmVhdGUg
Qk8gZm9yIERNQS1idWYgaW1wb3J0CisgKgogICogQGRldjogRFJNIGRldmljZQotICogQGF0dGFj
aDogRE1BLWJ1ZiBhdHRhY2htZW50Ci0gKiBAc2c6IFNjYXR0ZXIvZ2F0aGVyIHRhYmxlCisgKiBA
ZG1hX2J1ZjogRE1BLWJ1ZgogICoKLSAqIEltcG9ydHMgc2hhcmVkIERNQSBidWZmZXIgbWVtb3J5
IGV4cG9ydGVkIGJ5IGFub3RoZXIgZGV2aWNlLgorICogQ3JlYXRlcyBhbiBlbXB0eSBTRyBCTyBm
b3IgRE1BLWJ1ZiBpbXBvcnQuCiAgKgogICogUmV0dXJuczoKICAqIEEgbmV3IEdFTSBCTyBvZiB0
aGUgZ2l2ZW4gRFJNIGRldmljZSwgcmVwcmVzZW50aW5nIHRoZSBtZW1vcnkKICAqIGRlc2NyaWJl
ZCBieSB0aGUgZ2l2ZW4gRE1BLWJ1ZiBhdHRhY2htZW50IGFuZCBzY2F0dGVyL2dhdGhlciB0YWJs
ZS4KICAqLwotc3RydWN0IGRybV9nZW1fb2JqZWN0ICoKLWFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0
X3NnX3RhYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJIHN0cnVjdCBkbWFfYnVmX2F0
dGFjaG1lbnQgKmF0dGFjaCwKLQkJCQkgc3RydWN0IHNnX3RhYmxlICpzZykKK3N0YXRpYyBzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKgorYW1kZ3B1X2RtYV9idWZfY3JlYXRlX29iaihzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCBzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZikKIHsKLQlzdHJ1Y3QgcmVzZXJ2
YXRpb25fb2JqZWN0ICpyZXN2ID0gYXR0YWNoLT5kbWFidWYtPnJlc3Y7CisJc3RydWN0IHJlc2Vy
dmF0aW9uX29iamVjdCAqcmVzdiA9IGRtYV9idWYtPnJlc3Y7CiAJc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYgPSBkZXYtPmRldl9wcml2YXRlOwogCXN0cnVjdCBhbWRncHVfYm8gKmJvOwogCXN0
cnVjdCBhbWRncHVfYm9fcGFyYW0gYnA7CiAJaW50IHJldDsKIAogCW1lbXNldCgmYnAsIDAsIHNp
emVvZihicCkpOwotCWJwLnNpemUgPSBhdHRhY2gtPmRtYWJ1Zi0+c2l6ZTsKKwlicC5zaXplID0g
ZG1hX2J1Zi0+c2l6ZTsKIAlicC5ieXRlX2FsaWduID0gUEFHRV9TSVpFOwogCWJwLmRvbWFpbiA9
IEFNREdQVV9HRU1fRE9NQUlOX0NQVTsKIAlicC5mbGFncyA9IDA7CkBAIC00NTksMTEgKzQ1Niw5
IEBAIGFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJaWYgKHJldCkKIAkJZ290byBlcnJvcjsKIAotCWJvLT50Ym8uc2cgPSBzZzsKLQliby0+
dGJvLnR0bS0+c2cgPSBzZzsKIAliby0+YWxsb3dlZF9kb21haW5zID0gQU1ER1BVX0dFTV9ET01B
SU5fR1RUOwogCWJvLT5wcmVmZXJyZWRfZG9tYWlucyA9IEFNREdQVV9HRU1fRE9NQUlOX0dUVDsK
LQlpZiAoYXR0YWNoLT5kbWFidWYtPm9wcyAhPSAmYW1kZ3B1X2RtYWJ1Zl9vcHMpCisJaWYgKGRt
YV9idWYtPm9wcyAhPSAmYW1kZ3B1X2RtYWJ1Zl9vcHMpCiAJCWJvLT5wcmltZV9zaGFyZWRfY291
bnQgPSAxOwogCiAJd3dfbXV0ZXhfdW5sb2NrKCZyZXN2LT5sb2NrKTsKQEAgLTQ3NCw2ICs0Njks
MzUgQEAgYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAlyZXR1cm4gRVJSX1BUUihyZXQpOwogfQogCisvKioKKyAqIGFtZGdwdV9nZW1fcHJp
bWVfaW52YWxpZGF0ZV9tYXBwaW5ncyAtICZhdHRhY2guaW52YWxpZGF0ZSBpbXBsZW1lbnRhdGlv
bgorICoKKyAqIEBhdHRhY2g6IHRoZSBETUEtYnVmIGF0dGFjaG1lbnQKKyAqCisgKiBJbnZhbGlk
YXRlIHRoZSBETUEtYnVmIGF0dGFjaG1lbnQsIG1ha2luZyBzdXJlIHRoYXQgdGhlIHdlIHJlLWNy
ZWF0ZSB0aGUKKyAqIG1hcHBpbmcgYmVmb3JlIHRoZSBuZXh0IHVzZS4KKyAqLworc3RhdGljIHZv
aWQKK2FtZGdwdV9nZW1fcHJpbWVfaW52YWxpZGF0ZV9tYXBwaW5ncyhzdHJ1Y3QgZG1hX2J1Zl9h
dHRhY2htZW50ICphdHRhY2gpCit7CisJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0eCA9IHsg
ZmFsc2UsIGZhbHNlIH07CisJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBhdHRhY2gtPmlt
cG9ydGVyX3ByaXY7CisJc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBnZW1fdG9fYW1kZ3B1X2JvKG9i
aik7CisJc3RydWN0IHR0bV9wbGFjZW1lbnQgcGxhY2VtZW50ID0ge307CisJaW50IHI7CisKKwlp
ZiAoYm8tPnRiby5tZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1NZU1RFTSkKKwkJcmV0dXJuOworCisJ
ciA9IHR0bV9ib192YWxpZGF0ZSgmYm8tPnRibywgJnBsYWNlbWVudCwgJmN0eCk7CisJaWYgKHIp
CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGludmFsaWRhdGUgRE1BLWJ1ZiBpbXBvcnQgKCVkKSlc
biIsIHIpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9idWZfYXR0YWNoX29wcyBhbWRn
cHVfZG1hX2J1Zl9hdHRhY2hfb3BzID0geworCS5pbnZhbGlkYXRlID0gYW1kZ3B1X2dlbV9wcmlt
ZV9pbnZhbGlkYXRlX21hcHBpbmdzCit9OworCiAvKioKICAqIGFtZGdwdV9nZW1fcHJpbWVfaW1w
b3J0IC0gJmRybV9kcml2ZXIuZ2VtX3ByaW1lX2ltcG9ydCBpbXBsZW1lbnRhdGlvbgogICogQGRl
djogRFJNIGRldmljZQpAQCAtNDg4LDYgKzUxMiw3IEBAIGFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0
X3NnX3RhYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiBzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
KmFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSAg
ICBzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZikKIHsKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50
ICphdHRhY2g7CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7CiAKIAlpZiAoZG1hX2J1Zi0+
b3BzID09ICZhbWRncHVfZG1hYnVmX29wcykgewpAQCAtNTAyLDUgKzUyNywxOCBAQCBzdHJ1Y3Qg
ZHJtX2dlbV9vYmplY3QgKmFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsCiAJCX0KIAl9CiAKLQlyZXR1cm4gZHJtX2dlbV9wcmltZV9pbXBvcnQoZGV2LCBkbWFf
YnVmKTsKKwlvYmogPSBhbWRncHVfZG1hX2J1Zl9jcmVhdGVfb2JqKGRldiwgZG1hX2J1Zik7CisJ
aWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gb2JqOworCisJYXR0YWNoID0gZG1hX2J1Zl9keW5h
bWljX2F0dGFjaChkbWFfYnVmLCBkZXYtPmRldiwKKwkJCQkJJmFtZGdwdV9kbWFfYnVmX2F0dGFj
aF9vcHMsIG9iaik7CisJaWYgKElTX0VSUihhdHRhY2gpKSB7CisJCWRybV9nZW1fb2JqZWN0X3B1
dChvYmopOworCQlyZXR1cm4gRVJSX0NBU1QoYXR0YWNoKTsKKwl9CisKKwlnZXRfZG1hX2J1Zihk
bWFfYnVmKTsKKwlvYmotPmltcG9ydF9hdHRhY2ggPSBhdHRhY2g7CisJcmV0dXJuIG9iajsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oCmluZGV4IGYxNTIy
MjkyODE0Yy4uMjc2NTQxMzc3MGI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfZG1hX2J1Zi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9kbWFfYnVmLmgKQEAgLTI1LDEwICsyNSw2IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtX2dl
bS5oPgogCi1zdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgotYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRf
c2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQkgc3RydWN0IGRtYV9idWZfYXR0
YWNobWVudCAqYXR0YWNoLAotCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnNnKTsKIHN0cnVjdCBkbWFf
YnVmICphbWRncHVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJ
CQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmosCiAJCQkJCWludCBmbGFncyk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMgYi9kcml2ZXJzL2dw
dS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKaW5kZXggNWYzYjdjYWI4MzkwLi43NmQ0NDU5
MTZjOWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKQEAgLTEzMzQs
NyArMTMzNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZlciBrbXNfZHJpdmVyID0gewogCS5n
ZW1fcHJpbWVfZXhwb3J0ID0gYW1kZ3B1X2dlbV9wcmltZV9leHBvcnQsCiAJLmdlbV9wcmltZV9p
bXBvcnQgPSBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydCwKIAkuZ2VtX3ByaW1lX3Jlc19vYmogPSBh
bWRncHVfZ2VtX3ByaW1lX3Jlc19vYmosCi0JLmdlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUgPSBh
bWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSwKIAkuZ2VtX3ByaW1lX3ZtYXAgPSBhbWRn
cHVfZ2VtX3ByaW1lX3ZtYXAsCiAJLmdlbV9wcmltZV92dW5tYXAgPSBhbWRncHVfZ2VtX3ByaW1l
X3Z1bm1hcCwKIAkuZ2VtX3ByaW1lX21tYXAgPSBhbWRncHVfZ2VtX3ByaW1lX21tYXAsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggNzg0M2IzYzZjYTU0
Li45OWJjZjZlNzEwYTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2Jq
ZWN0LmMKQEAgLTg1MCw2ICs4NTAsOSBAQCBpbnQgYW1kZ3B1X2JvX3Bpbl9yZXN0cmljdGVkKHN0
cnVjdCBhbWRncHVfYm8gKmJvLCB1MzIgZG9tYWluLAogCQlyZXR1cm4gMDsKIAl9CiAKKwlpZiAo
Ym8tPmdlbV9iYXNlLmltcG9ydF9hdHRhY2gpCisJCWRtYV9idWZfcGluKGJvLT5nZW1fYmFzZS5p
bXBvcnRfYXR0YWNoKTsKKwogCWJvLT5mbGFncyB8PSBBTURHUFVfR0VNX0NSRUFURV9WUkFNX0NP
TlRJR1VPVVM7CiAJLyogZm9yY2UgdG8gcGluIGludG8gdmlzaWJsZSB2aWRlbyByYW0gKi8KIAlp
ZiAoIShiby0+ZmxhZ3MgJiBBTURHUFVfR0VNX0NSRUFURV9OT19DUFVfQUNDRVNTKSkKQEAgLTkz
Myw2ICs5MzYsOSBAQCBpbnQgYW1kZ3B1X2JvX3VucGluKHN0cnVjdCBhbWRncHVfYm8gKmJvKQog
CiAJYW1kZ3B1X2JvX3N1YnRyYWN0X3Bpbl9zaXplKGJvKTsKIAorCWlmIChiby0+Z2VtX2Jhc2Uu
aW1wb3J0X2F0dGFjaCkKKwkJZG1hX2J1Zl91bnBpbihiby0+Z2VtX2Jhc2UuaW1wb3J0X2F0dGFj
aCk7CisKIAlmb3IgKGkgPSAwOyBpIDwgYm8tPnBsYWNlbWVudC5udW1fcGxhY2VtZW50OyBpKysp
IHsKIAkJYm8tPnBsYWNlbWVudHNbaV0ubHBmbiA9IDA7CiAJCWJvLT5wbGFjZW1lbnRzW2ldLmZs
YWdzICY9IH5UVE1fUExfRkxBR19OT19FVklDVDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV90dG0uYwppbmRleCBkODFiZWJmNzYzMTAuLmM4OWZhNThhNzkxNCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpAQCAtMzksNiArMzksNyBAQAogI2luY2x1ZGUg
PGxpbnV4L3NsYWIuaD4KICNpbmNsdWRlIDxsaW51eC9zd2FwLmg+CiAjaW5jbHVkZSA8bGludXgv
c3dpb3RsYi5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KIAogI2luY2x1ZGUgPGRybS90
dG0vdHRtX2JvX2FwaS5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2RyaXZlci5oPgpAQCAt
NzExLDYgKzcxMiw3IEBAIHN0YXRpYyB1bnNpZ25lZCBsb25nIGFtZGdwdV90dG1faW9fbWVtX3Bm
bihzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogICovCiBzdHJ1Y3QgYW1kZ3B1X3R0bV90
dCB7CiAJc3RydWN0IHR0bV9kbWFfdHQJdHRtOworCXN0cnVjdCBkcm1fZ2VtX29iamVjdAkqZ29i
ajsKIAl1NjQJCQlvZmZzZXQ7CiAJdWludDY0X3QJCXVzZXJwdHI7CiAJc3RydWN0IHRhc2tfc3Ry
dWN0CSp1c2VydGFzazsKQEAgLTExOTgsNiArMTIwMCw3IEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0
ICphbWRncHVfdHRtX3R0X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQly
ZXR1cm4gTlVMTDsKIAl9CiAJZ3R0LT50dG0udHRtLmZ1bmMgPSAmYW1kZ3B1X2JhY2tlbmRfZnVu
YzsKKwlndHQtPmdvYmogPSAmdHRtX3RvX2FtZGdwdV9ibyhibyktPmdlbV9iYXNlOwogCiAJLyog
YWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB1bmluaXRpYWxpemVkIHBhZ2UgZW50cmllcyAqLwogCWlm
ICh0dG1fc2dfdHRfaW5pdCgmZ3R0LT50dG0sIGJvLCBwYWdlX2ZsYWdzKSkgewpAQCAtMTIxOCw3
ICsxMjIxLDYgQEAgc3RhdGljIGludCBhbWRncHVfdHRtX3R0X3BvcHVsYXRlKHN0cnVjdCB0dG1f
dHQgKnR0bSwKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGFtZGdwdV90dG1fYWRl
dih0dG0tPmJkZXYpOwogCXN0cnVjdCBhbWRncHVfdHRtX3R0ICpndHQgPSAodm9pZCAqKXR0bTsK
LQlib29sIHNsYXZlID0gISEodHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRyk7CiAK
IAkvKiB1c2VyIHBhZ2VzIGFyZSBib3VuZCBieSBhbWRncHVfdHRtX3R0X3Bpbl91c2VycHRyKCkg
Ki8KIAlpZiAoZ3R0ICYmIGd0dC0+dXNlcnB0cikgewpAQCAtMTIzMSw3ICsxMjMzLDE5IEBAIHN0
YXRpYyBpbnQgYW1kZ3B1X3R0bV90dF9wb3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0sCiAJCXJl
dHVybiAwOwogCX0KIAotCWlmIChzbGF2ZSAmJiB0dG0tPnNnKSB7CisJaWYgKHR0bS0+cGFnZV9m
bGFncyAmIFRUTV9QQUdFX0ZMQUdfU0cpIHsKKwkJaWYgKCF0dG0tPnNnKSB7CisJCQlzdHJ1Y3Qg
ZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2g7CisJCQlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKKwor
CQkJYXR0YWNoID0gZ3R0LT5nb2JqLT5pbXBvcnRfYXR0YWNoOworCQkJc2d0ID0gZG1hX2J1Zl9t
YXBfYXR0YWNobWVudChhdHRhY2gsIERNQV9CSURJUkVDVElPTkFMKTsKKwkJCWlmIChJU19FUlIo
c2d0KSkKKwkJCQlyZXR1cm4gUFRSX0VSUihzZ3QpOworCisJCQl0dG0tPnNnID0gc2d0OworCQl9
CisKIAkJZHJtX3ByaW1lX3NnX3RvX3BhZ2VfYWRkcl9hcnJheXModHRtLT5zZywgdHRtLT5wYWdl
cywKIAkJCQkJCSBndHQtPnR0bS5kbWFfYWRkcmVzcywKIAkJCQkJCSB0dG0tPm51bV9wYWdlcyk7
CkBAIC0xMjU4LDkgKzEyNzIsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV90dG1fdHRfcG9wdWxhdGUo
c3RydWN0IHR0bV90dCAqdHRtLAogICovCiBzdGF0aWMgdm9pZCBhbWRncHVfdHRtX3R0X3VucG9w
dWxhdGUoc3RydWN0IHR0bV90dCAqdHRtKQogewotCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2
OwogCXN0cnVjdCBhbWRncHVfdHRtX3R0ICpndHQgPSAodm9pZCAqKXR0bTsKLQlib29sIHNsYXZl
ID0gISEodHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRyk7CisJc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXY7CiAKIAlpZiAoZ3R0ICYmIGd0dC0+dXNlcnB0cikgewogCQlhbWRncHVf
dHRtX3R0X3NldF91c2VyX3BhZ2VzKHR0bSwgTlVMTCk7CkBAIC0xMjY5LDcgKzEyODIsMTYgQEAg
c3RhdGljIHZvaWQgYW1kZ3B1X3R0bV90dF91bnBvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSkK
IAkJcmV0dXJuOwogCX0KIAotCWlmIChzbGF2ZSkKKwlpZiAodHRtLT5zZyAmJiBndHQtPmdvYmot
PmltcG9ydF9hdHRhY2gpIHsKKwkJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOwor
CisJCWF0dGFjaCA9IGd0dC0+Z29iai0+aW1wb3J0X2F0dGFjaDsKKwkJZG1hX2J1Zl91bm1hcF9h
dHRhY2htZW50KGF0dGFjaCwgdHRtLT5zZywgRE1BX0JJRElSRUNUSU9OQUwpOworCQl0dG0tPnNn
ID0gTlVMTDsKKwkJcmV0dXJuOworCX0KKworCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFH
RV9GTEFHX1NHKQogCQlyZXR1cm47CiAKIAlhZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KHR0bS0+YmRl
dik7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbA==
