Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A96BF110369
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 18:26:59 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8821B6EA24;
	Tue,  3 Dec 2019 17:26:54 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pj1-x1043.google.com (mail-pj1-x1043.google.com
 [IPv6:2607:f8b0:4864:20::1043])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F7E26EA27
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 17:26:51 +0000 (UTC)
Received: by mail-pj1-x1043.google.com with SMTP id v93so1781467pjb.6
 for <dri-devel@lists.freedesktop.org>; Tue, 03 Dec 2019 09:26:51 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=DaFZ5uYZhl4fxFpyOFfrIQeYGNfjAMWIYqeXJnCftOA=;
 b=bHfSHKZBozuTtfiUAZrUkAuLkQjwFjUsXO1yLyFNTxjL7RX2ExZxp21HLjYuA9Gswo
 HeOdS242eGWDPcW/b/AGMB8331kMsMyhCUbxppvCrO6o7lPhCAO52vXANDBbM2ELtwMU
 qNSsunJgHV8257FrBaCu8LoLM3T426YDUor50jwRW/T679dpqOgkglDxJd0R6WUq1mBV
 DH2OCZ+g5heRWdrzofGT39GJWNLjYlCmSZMOk7h5R6Ocbf++6f01QwXL+ThCU1NLaRyv
 4f8GUf2ivaImvdXMFByM2Is6V0tYEXbBaa7IN9KPkahc6OXYV2CwTPtsn54kpSh38kc9
 OT0g==
X-Gm-Message-State: APjAAAWl+LBiCAYfNeeQs6Yk+9HJ8fHI5giAu17302fLQUs4Ob815JPH
 42bSSDvsYA6nbq/YsI+4aBNTLw==
X-Google-Smtp-Source: APXvYqwxYMp+k3Askq5Qqbg8BCkPrsdZrRFJOzqfdSJDIi9fHg66/qEC5ehhco+UDbJGjB2+OhmU8A==
X-Received: by 2002:a17:902:8bc4:: with SMTP id
 r4mr6137102plo.82.1575394010801; 
 Tue, 03 Dec 2019 09:26:50 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 l9sm4066177pgh.34.2019.12.03.09.26.49
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 03 Dec 2019 09:26:50 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RESEND][PATCH v16 5/5] kselftests: Add dma-heap test
Date: Tue,  3 Dec 2019 17:26:41 +0000
Message-Id: <20191203172641.66642-6-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191203172641.66642-1-john.stultz@linaro.org>
References: <20191203172641.66642-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=DaFZ5uYZhl4fxFpyOFfrIQeYGNfjAMWIYqeXJnCftOA=;
 b=xJK3Fzk/SM8qCI6Vdhh+vjeERo74/h2zYao/L0sYq6If8CW3+dN3+5AHJdwnk4p5Ni
 kkT0KejGEEBaq+l7hJEGUjbNdahEMpm9jd1mBfqkWoLPThRrqoWVQ8hzk43kXOOrrHyg
 NyMpqlyjqkL7OqjIezAGwsA+/uRYjjT9jtAE08kc6Z23FJr6AbYNlbxkZ45r91P0K/G7
 rTq2LuQIVILui8m4hgkeLdSNHcfnkX3MLxB0zx7DGpxjPa7Ka5EMX+5WgSbn23OvZm14
 o72kCnh0Bg8FbciARCSsZq7hR/ejqP+EfYZkwo+X8ZcJsib/KS8WTe9aMhGya4KZzaEB
 Qi5g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sandeep Patil <sspatil@google.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Sudipto Paul <Sudipto.Paul@arm.com>, Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIHZlcnkgdHJpdmlhbCBhbGxvY2F0aW9uIGFuZCBpbXBvcnQgdGVzdCBmb3IgZG1hLWhlYXBz
LAp1dGlsaXppbmcgdGhlIHZnZW0gZHJpdmVyIGFzIGEgdGVzdCBpbXBvcnRlci4KCkEgZ29vZCBj
aHVuayBvZiB0aGlzIGNvZGUgdGFrZW4gZnJvbToKICB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9h
bmRyb2lkL2lvbi9pb25tYXBfdGVzdC5jCiAgT3JpZ2luYWxseSBieSBMYXVyYSBBYmJvdHQgPGxh
YmJvdHRAcmVkaGF0LmNvbT4KCkNjOiBCZW5qYW1pbiBHYWlnbmFyZCA8YmVuamFtaW4uZ2FpZ25h
cmRAbGluYXJvLm9yZz4KQ2M6IFN1bWl0IFNlbXdhbCA8c3VtaXQuc2Vtd2FsQGxpbmFyby5vcmc+
CkNjOiBMaWFtIE1hcmsgPGxtYXJrQGNvZGVhdXJvcmEub3JnPgpDYzogUHJhdGlrIFBhdGVsIDxw
cmF0aWtwQGNvZGVhdXJvcmEub3JnPgpDYzogQnJpYW4gU3RhcmtleSA8QnJpYW4uU3RhcmtleUBh
cm0uY29tPgpDYzogVmluY2VudCBEb25uZWZvcnQgPFZpbmNlbnQuRG9ubmVmb3J0QGFybS5jb20+
CkNjOiBTdWRpcHRvIFBhdWwgPFN1ZGlwdG8uUGF1bEBhcm0uY29tPgpDYzogQW5kcmV3IEYuIERh
dmlzIDxhZmRAdGkuY29tPgpDYzogQ2hyaXN0b3BoIEhlbGx3aWcgPGhjaEBpbmZyYWRlYWQub3Jn
PgpDYzogQ2hlbmJvIEZlbmcgPGZlbmdjQGdvb2dsZS5jb20+CkNjOiBBbGlzdGFpciBTdHJhY2hh
biA8YXN0cmFjaGFuQGdvb2dsZS5jb20+CkNjOiBIcmlkeWEgVmFsc2FyYWp1IDxocmlkeWFAZ29v
Z2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwgPHNzcGF0aWxAZ29vZ2xlLmNvbT4KQ2M6IEhpbGxm
IERhbnRvbiA8aGRhbnRvbkBzaW5hLmNvbT4KQ2M6IERhdmUgQWlybGllIDxhaXJsaWVkQGdtYWls
LmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKUmV2aWV3ZWQtYnk6IEJl
bmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpSZXZpZXdlZC1i
eTogQnJpYW4gU3RhcmtleSA8YnJpYW4uc3RhcmtleUBhcm0uY29tPgpBY2tlZC1ieTogU2FuZGVl
cCBQYXRpbCA8c3NwYXRpbEBhbmRyb2lkLmNvbT4KQWNrZWQtYnk6IExhdXJhIEFiYm90dCA8bGFi
Ym90dEByZWRoYXQuY29tPgpUZXN0ZWQtYnk6IEF5YW4gS3VtYXIgSGFsZGVyIDxheWFuLmhhbGRl
ckBhcm0uY29tPgpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJv
Lm9yZz4KLS0tCnYyOgoqIFN3aXRjaGVkIHRvIHVzZSByZXdvcmtlZCBkbWEtaGVhcCBhcGlzCnYz
OgoqIEFkZCBzaW1wbGUgbW1hcAoqIFV0aWxpemUgZG1hLWJ1ZiB0ZXN0ZGV2IHRvIHRlc3QgaW1w
b3J0aW5nCnY0OgoqIFJld29yayB0byB1c2UgdmdlbQoqIFBhc3MgaW4gZmRfZmxhZ3MgdG8gbWF0
Y2ggaW50ZXJmYWNlIGNoYW5nZXMKKiBTa2lwIC4gYW5kIC4uIGRpcnMKdjY6CiogTnVtYmVyIG9m
IHN0eWxlL2NsZWFudXBzIHN1Z2dlc3RlZCBieSBCcmlhbgp2NzoKKiBXaGl0ZXNwYWNlIGZpeHVw
IGZvciBjaGVja3BhdGNoCnY4OgoqIE1vcmUgY2hlY2twYXRjaCB3aGl0ZXNwYWNlIGZpeHVwcwp2
OToKKiBCZXR0ZXIgaGFuZGxpbmcgZXJyb3IgcmV0dXJucyBvdXQgdG8gbWFpbiwgc3VnZ2VzdGVk
CiAgYnkgQnJpYW4gU3RhcmtleQoqIFN3aXRjaCB0byB1c2luZyBzbnByaW50Ziwgc3VnZ2VzdGVk
IGJ5IEJyaWFuCnYxNDoKKiBGaXggYSBtaXNzaW5nIHJldHVybiB2YWx1ZQoqIEFkZCBjYWxscyB0
byB0ZXN0IHRoZSBHRVRfRkVBVFVSRVMgaW9jdGwKKiBCdWlsZCBmaXggcmVwb3J0ZWQgYnkga2Vy
bmVsIHRlc3Qgcm9ib3QgPGxrcEBpbnRlbC5jb20+CiAgYW5kIGZpeGVkIGJ5IFhpYW8gWWFuZyA8
aWNlX3lhbmd4aWFvQDE2My5jb20+CiogTWlub3IgTWFrZWZpbGUgY2xlYW51cHMKdjE1OgoqIFJl
bW92ZSB1c2FnZSBvZiBkcm9wcGVkIGdldF9mZWF0dXJlcyBpb2N0bAp2MTY6CiogQWRkIGV4dHJh
IGlvY3RsIGNvbXBhdGliaWxpdHkgdGVzdGluZyBzdWdnZXN0ZWQgYnkKICBEYW5pZWwgVmV0dGVy
Ci0tLQogdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvZG1hYnVmLWhlYXBzL01ha2VmaWxlIHwgICA2
ICsKIC4uLi9zZWxmdGVzdHMvZG1hYnVmLWhlYXBzL2RtYWJ1Zi1oZWFwLmMgICAgICB8IDM5NiAr
KysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNDAyIGluc2VydGlvbnMoKykKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9kbWFidWYtaGVhcHMvTWFr
ZWZpbGUKIGNyZWF0ZSBtb2RlIDEwMDY0NCB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy9kbWFidWYt
aGVhcHMvZG1hYnVmLWhlYXAuYwoKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3Rz
L2RtYWJ1Zi1oZWFwcy9NYWtlZmlsZSBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2RtYWJ1Zi1o
ZWFwcy9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjYw
N2MyYWNkMjA4MgotLS0gL2Rldi9udWxsCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL2Rt
YWJ1Zi1oZWFwcy9NYWtlZmlsZQpAQCAtMCwwICsxLDYgQEAKKyMgU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAKK0NGTEFHUyArPSAtc3RhdGljIC1PMyAtV2wsLW5vLWFzLW5lZWRlZCAt
V2FsbCAtSS4uLy4uLy4uLy4uL3Vzci9pbmNsdWRlCisKK1RFU1RfR0VOX1BST0dTID0gZG1hYnVm
LWhlYXAKKworaW5jbHVkZSAuLi9saWIubWsKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL2RtYWJ1Zi1oZWFwcy9kbWFidWYtaGVhcC5jIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVz
dHMvZG1hYnVmLWhlYXBzL2RtYWJ1Zi1oZWFwLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi4zZTUzYWQzMzFiZGMKLS0tIC9kZXYvbnVsbAorKysgYi90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy9kbWFidWYtaGVhcHMvZG1hYnVmLWhlYXAuYwpAQCAtMCwwICsxLDM5NiBA
QAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKworI2luY2x1ZGUgPGRpcmVu
dC5oPgorI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8ZmNudGwuaD4KKyNpbmNsdWRlIDxz
dGRpby5oPgorI2luY2x1ZGUgPHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN0ZGludC5oPgorI2luY2x1
ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUgPHVuaXN0ZC5oPgorI2luY2x1ZGUgPHN5cy9pb2N0bC5o
PgorI2luY2x1ZGUgPHN5cy9tbWFuLmg+CisjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CisKKyNpbmNs
dWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8ZHJtL2RybS5oPgorCisjaW5jbHVkZSAi
Li4vLi4vLi4vLi4vaW5jbHVkZS91YXBpL2xpbnV4L2RtYS1oZWFwLmgiCisKKyNkZWZpbmUgREVW
UEFUSCAiL2Rldi9kbWFfaGVhcCIKKworc3RhdGljIGludCBjaGVja192Z2VtKGludCBmZCkKK3sK
Kwlkcm1fdmVyc2lvbl90IHZlcnNpb24gPSB7IDAgfTsKKwljaGFyIG5hbWVbNV07CisJaW50IHJl
dDsKKworCXZlcnNpb24ubmFtZV9sZW4gPSA0OworCXZlcnNpb24ubmFtZSA9IG5hbWU7CisKKwly
ZXQgPSBpb2N0bChmZCwgRFJNX0lPQ1RMX1ZFUlNJT04sICZ2ZXJzaW9uKTsKKwlpZiAocmV0KQor
CQlyZXR1cm4gMDsKKworCXJldHVybiAhc3RyY21wKG5hbWUsICJ2Z2VtIik7Cit9CisKK3N0YXRp
YyBpbnQgb3Blbl92Z2VtKHZvaWQpCit7CisJaW50IGksIGZkOworCWNvbnN0IGNoYXIgKmRybXN0
ciA9ICIvZGV2L2RyaS9jYXJkIjsKKworCWZkID0gLTE7CisJZm9yIChpID0gMDsgaSA8IDE2OyBp
KyspIHsKKwkJY2hhciBuYW1lWzgwXTsKKworCQlzbnByaW50ZihuYW1lLCA4MCwgIiVzJXUiLCBk
cm1zdHIsIGkpOworCisJCWZkID0gb3BlbihuYW1lLCBPX1JEV1IpOworCQlpZiAoZmQgPCAwKQor
CQkJY29udGludWU7CisKKwkJaWYgKCFjaGVja192Z2VtKGZkKSkgeworCQkJY2xvc2UoZmQpOwor
CQkJZmQgPSAtMTsKKwkJCWNvbnRpbnVlOworCQl9IGVsc2UgeworCQkJYnJlYWs7CisJCX0KKwl9
CisJcmV0dXJuIGZkOworfQorCitzdGF0aWMgaW50IGltcG9ydF92Z2VtX2ZkKGludCB2Z2VtX2Zk
LCBpbnQgZG1hX2J1Zl9mZCwgdWludDMyX3QgKmhhbmRsZSkKK3sKKwlzdHJ1Y3QgZHJtX3ByaW1l
X2hhbmRsZSBpbXBvcnRfaGFuZGxlID0geworCQkuZmQgPSBkbWFfYnVmX2ZkLAorCQkuZmxhZ3Mg
PSAwLAorCQkuaGFuZGxlID0gMCwKKwkgfTsKKwlpbnQgcmV0OworCisJcmV0ID0gaW9jdGwodmdl
bV9mZCwgRFJNX0lPQ1RMX1BSSU1FX0ZEX1RPX0hBTkRMRSwgJmltcG9ydF9oYW5kbGUpOworCWlm
IChyZXQgPT0gMCkKKwkJKmhhbmRsZSA9IGltcG9ydF9oYW5kbGUuaGFuZGxlOworCXJldHVybiBy
ZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGNsb3NlX2hhbmRsZShpbnQgdmdlbV9mZCwgdWludDMyX3Qg
aGFuZGxlKQoreworCXN0cnVjdCBkcm1fZ2VtX2Nsb3NlIGNsb3NlID0geworCQkuaGFuZGxlID0g
aGFuZGxlLAorCX07CisKKwlpb2N0bCh2Z2VtX2ZkLCBEUk1fSU9DVExfR0VNX0NMT1NFLCAmY2xv
c2UpOworfQorCitzdGF0aWMgaW50IGRtYWJ1Zl9oZWFwX29wZW4oY2hhciAqbmFtZSkKK3sKKwlp
bnQgcmV0LCBmZDsKKwljaGFyIGJ1ZlsyNTZdOworCisJcmV0ID0gc25wcmludGYoYnVmLCAyNTYs
ICIlcy8lcyIsIERFVlBBVEgsIG5hbWUpOworCWlmIChyZXQgPCAwKSB7CisJCXByaW50Zigic25w
cmludGYgZmFpbGVkIVxuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJZmQgPSBvcGVuKGJ1Ziwg
T19SRFdSKTsKKwlpZiAoZmQgPCAwKQorCQlwcmludGYoIm9wZW4gJXMgZmFpbGVkIVxuIiwgYnVm
KTsKKwlyZXR1cm4gZmQ7Cit9CisKK3N0YXRpYyBpbnQgZG1hYnVmX2hlYXBfYWxsb2NfZmRmbGFn
cyhpbnQgZmQsIHNpemVfdCBsZW4sIHVuc2lnbmVkIGludCBmZF9mbGFncywKKwkJCQkgICAgIHVu
c2lnbmVkIGludCBoZWFwX2ZsYWdzLCBpbnQgKmRtYWJ1Zl9mZCkKK3sKKwlzdHJ1Y3QgZG1hX2hl
YXBfYWxsb2NhdGlvbl9kYXRhIGRhdGEgPSB7CisJCS5sZW4gPSBsZW4sCisJCS5mZCA9IDAsCisJ
CS5mZF9mbGFncyA9IGZkX2ZsYWdzLAorCQkuaGVhcF9mbGFncyA9IGhlYXBfZmxhZ3MsCisJfTsK
KwlpbnQgcmV0OworCisJaWYgKCFkbWFidWZfZmQpCisJCXJldHVybiAtRUlOVkFMOworCisJcmV0
ID0gaW9jdGwoZmQsIERNQV9IRUFQX0lPQ19BTExPQywgJmRhdGEpOworCWlmIChyZXQgPCAwKQor
CQlyZXR1cm4gcmV0OworCSpkbWFidWZfZmQgPSAoaW50KWRhdGEuZmQ7CisJcmV0dXJuIHJldDsK
K30KKworc3RhdGljIGludCBkbWFidWZfaGVhcF9hbGxvYyhpbnQgZmQsIHNpemVfdCBsZW4sIHVu
c2lnbmVkIGludCBmbGFncywKKwkJCSAgICAgaW50ICpkbWFidWZfZmQpCit7CisJcmV0dXJuIGRt
YWJ1Zl9oZWFwX2FsbG9jX2ZkZmxhZ3MoZmQsIGxlbiwgT19SRFdSIHwgT19DTE9FWEVDLCBmbGFn
cywKKwkJCQkJIGRtYWJ1Zl9mZCk7Cit9CisKK3N0YXRpYyB2b2lkIGRtYWJ1Zl9zeW5jKGludCBm
ZCwgaW50IHN0YXJ0X3N0b3ApCit7CisJc3RydWN0IGRtYV9idWZfc3luYyBzeW5jID0geworCQku
ZmxhZ3MgPSBzdGFydF9zdG9wIHwgRE1BX0JVRl9TWU5DX1JXLAorCX07CisJaW50IHJldDsKKwor
CXJldCA9IGlvY3RsKGZkLCBETUFfQlVGX0lPQ1RMX1NZTkMsICZzeW5jKTsKKwlpZiAocmV0KQor
CQlwcmludGYoInN5bmMgZmFpbGVkICVkXG4iLCBlcnJubyk7Cit9CisKKyNkZWZpbmUgT05FX01F
RyAoMTAyNCAqIDEwMjQpCisKK3N0YXRpYyBpbnQgdGVzdF9hbGxvY19hbmRfaW1wb3J0KGNoYXIg
KmhlYXBfbmFtZSkKK3sKKwlpbnQgaGVhcF9mZCA9IC0xLCBkbWFidWZfZmQgPSAtMSwgaW1wb3J0
ZXJfZmQgPSAtMTsKKwl1aW50MzJfdCBoYW5kbGUgPSAwOworCXZvaWQgKnAgPSBOVUxMOworCWlu
dCByZXQ7CisKKwlwcmludGYoIlRlc3RpbmcgaGVhcDogJXNcbiIsIGhlYXBfbmFtZSk7CisKKwlo
ZWFwX2ZkID0gZG1hYnVmX2hlYXBfb3BlbihoZWFwX25hbWUpOworCWlmIChoZWFwX2ZkIDwgMCkK
KwkJcmV0dXJuIC0xOworCisJcHJpbnRmKCJBbGxvY2F0aW5nIDEgTUVHXG4iKTsKKwlyZXQgPSBk
bWFidWZfaGVhcF9hbGxvYyhoZWFwX2ZkLCBPTkVfTUVHLCAwLCAmZG1hYnVmX2ZkKTsKKwlpZiAo
cmV0KSB7CisJCXByaW50ZigiQWxsb2NhdGlvbiBGYWlsZWQhXG4iKTsKKwkJcmV0ID0gLTE7CisJ
CWdvdG8gb3V0OworCX0KKwkvKiBtbWFwIGFuZCB3cml0ZSBhIHNpbXBsZSBwYXR0ZXJuICovCisJ
cCA9IG1tYXAoTlVMTCwKKwkJIE9ORV9NRUcsCisJCSBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAor
CQkgTUFQX1NIQVJFRCwKKwkJIGRtYWJ1Zl9mZCwKKwkJIDApOworCWlmIChwID09IE1BUF9GQUlM
RUQpIHsKKwkJcHJpbnRmKCJtbWFwKCkgZmFpbGVkOiAlbVxuIik7CisJCXJldCA9IC0xOworCQln
b3RvIG91dDsKKwl9CisJcHJpbnRmKCJtbWFwIHBhc3NlZFxuIik7CisKKwlkbWFidWZfc3luYyhk
bWFidWZfZmQsIERNQV9CVUZfU1lOQ19TVEFSVCk7CisJbWVtc2V0KHAsIDEsIE9ORV9NRUcgLyAy
KTsKKwltZW1zZXQoKGNoYXIgKilwICsgT05FX01FRyAvIDIsIDAsIE9ORV9NRUcgLyAyKTsKKwlk
bWFidWZfc3luYyhkbWFidWZfZmQsIERNQV9CVUZfU1lOQ19FTkQpOworCisJaW1wb3J0ZXJfZmQg
PSBvcGVuX3ZnZW0oKTsKKwlpZiAoaW1wb3J0ZXJfZmQgPCAwKSB7CisJCXJldCA9IGltcG9ydGVy
X2ZkOworCQlwcmludGYoIkZhaWxlZCB0byBvcGVuIHZnZW1cbiIpOworCQlnb3RvIG91dDsKKwl9
CisKKwlyZXQgPSBpbXBvcnRfdmdlbV9mZChpbXBvcnRlcl9mZCwgZG1hYnVmX2ZkLCAmaGFuZGxl
KTsKKwlpZiAocmV0IDwgMCkgeworCQlwcmludGYoIkZhaWxlZCB0byBpbXBvcnQgYnVmZmVyXG4i
KTsKKwkJZ290byBvdXQ7CisJfQorCXByaW50ZigiaW1wb3J0IHBhc3NlZFxuIik7CisKKwlkbWFi
dWZfc3luYyhkbWFidWZfZmQsIERNQV9CVUZfU1lOQ19TVEFSVCk7CisJbWVtc2V0KHAsIDB4ZmYs
IE9ORV9NRUcpOworCWRtYWJ1Zl9zeW5jKGRtYWJ1Zl9mZCwgRE1BX0JVRl9TWU5DX0VORCk7CisJ
cHJpbnRmKCJzeW5jcyBwYXNzZWRcbiIpOworCisJY2xvc2VfaGFuZGxlKGltcG9ydGVyX2ZkLCBo
YW5kbGUpOworCXJldCA9IDA7CisKK291dDoKKwlpZiAocCkKKwkJbXVubWFwKHAsIE9ORV9NRUcp
OworCWlmIChpbXBvcnRlcl9mZCA+PSAwKQorCQljbG9zZShpbXBvcnRlcl9mZCk7CisJaWYgKGRt
YWJ1Zl9mZCA+PSAwKQorCQljbG9zZShkbWFidWZfZmQpOworCWlmIChoZWFwX2ZkID49IDApCisJ
CWNsb3NlKGhlYXBfZmQpOworCisJcmV0dXJuIHJldDsKK30KKworLyogVGVzdCB0aGUgaW9jdGwg
dmVyc2lvbiBjb21wYXRpYmlsaXR5IHcvIGEgc21hbGxlciBzdHJ1Y3R1cmUgdGhlbiBleHBlY3Rl
ZCAqLworc3RhdGljIGludCBkbWFidWZfaGVhcF9hbGxvY19vbGRlcihpbnQgZmQsIHNpemVfdCBs
ZW4sIHVuc2lnbmVkIGludCBmbGFncywKKwkJCQkgICBpbnQgKmRtYWJ1Zl9mZCkKK3sKKwlpbnQg
cmV0OworCXVuc2lnbmVkIGludCBvbGRlcl9hbGxvY19pb2N0bDsKKwlzdHJ1Y3QgZG1hX2hlYXBf
YWxsb2NhdGlvbl9kYXRhX3NtYWxsZXIgeworCQlfX3U2NCBsZW47CisJCV9fdTMyIGZkOworCQlf
X3UzMiBmZF9mbGFnczsKKwl9IGRhdGEgPSB7CisJCS5sZW4gPSBsZW4sCisJCS5mZCA9IDAsCisJ
CS5mZF9mbGFncyA9IE9fUkRXUiB8IE9fQ0xPRVhFQywKKwl9OworCisJb2xkZXJfYWxsb2NfaW9j
dGwgPSBfSU9XUihETUFfSEVBUF9JT0NfTUFHSUMsIDB4MCwKKwkJCQkgIHN0cnVjdCBkbWFfaGVh
cF9hbGxvY2F0aW9uX2RhdGFfc21hbGxlcik7CisJaWYgKCFkbWFidWZfZmQpCisJCXJldHVybiAt
RUlOVkFMOworCisJcmV0ID0gaW9jdGwoZmQsIG9sZGVyX2FsbG9jX2lvY3RsLCAmZGF0YSk7CisJ
aWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisJKmRtYWJ1Zl9mZCA9IChpbnQpZGF0YS5mZDsK
KwlyZXR1cm4gcmV0OworfQorCisvKiBUZXN0IHRoZSBpb2N0bCB2ZXJzaW9uIGNvbXBhdGliaWxp
dHkgdy8gYSBsYXJnZXIgc3RydWN0dXJlIHRoZW4gZXhwZWN0ZWQgKi8KK3N0YXRpYyBpbnQgZG1h
YnVmX2hlYXBfYWxsb2NfbmV3ZXIoaW50IGZkLCBzaXplX3QgbGVuLCB1bnNpZ25lZCBpbnQgZmxh
Z3MsCisJCQkJICAgaW50ICpkbWFidWZfZmQpCit7CisJaW50IHJldDsKKwl1bnNpZ25lZCBpbnQg
bmV3ZXJfYWxsb2NfaW9jdGw7CisJc3RydWN0IGRtYV9oZWFwX2FsbG9jYXRpb25fZGF0YV9iaWdn
ZXIgeworCQlfX3U2NCBsZW47CisJCV9fdTMyIGZkOworCQlfX3UzMiBmZF9mbGFnczsKKwkJX191
NjQgaGVhcF9mbGFnczsKKwkJX191NjQgZ2FyYmFnZTE7CisJCV9fdTY0IGdhcmJhZ2UyOworCQlf
X3U2NCBnYXJiYWdlMzsKKwl9IGRhdGEgPSB7CisJCS5sZW4gPSBsZW4sCisJCS5mZCA9IDAsCisJ
CS5mZF9mbGFncyA9IE9fUkRXUiB8IE9fQ0xPRVhFQywKKwkJLmhlYXBfZmxhZ3MgPSBmbGFncywK
KwkJLmdhcmJhZ2UxID0gMHhmZmZmZmZmZiwKKwkJLmdhcmJhZ2UyID0gMHg4ODg4ODg4OCwKKwkJ
LmdhcmJhZ2UzID0gMHgxMTExMTExMSwKKwl9OworCisJbmV3ZXJfYWxsb2NfaW9jdGwgPSBfSU9X
UihETUFfSEVBUF9JT0NfTUFHSUMsIDB4MCwKKwkJCQkgIHN0cnVjdCBkbWFfaGVhcF9hbGxvY2F0
aW9uX2RhdGFfYmlnZ2VyKTsKKwlpZiAoIWRtYWJ1Zl9mZCkKKwkJcmV0dXJuIC1FSU5WQUw7CisK
KwlyZXQgPSBpb2N0bChmZCwgbmV3ZXJfYWxsb2NfaW9jdGwsICZkYXRhKTsKKwlpZiAocmV0IDwg
MCkKKwkJcmV0dXJuIHJldDsKKworCSpkbWFidWZfZmQgPSAoaW50KWRhdGEuZmQ7CisJcmV0dXJu
IHJldDsKK30KKworc3RhdGljIGludCB0ZXN0X2FsbG9jX2NvbXBhdChjaGFyICpoZWFwX25hbWUp
Cit7CisJaW50IGhlYXBfZmQgPSAtMSwgZG1hYnVmX2ZkID0gLTE7CisJaW50IHJldDsKKworCWhl
YXBfZmQgPSBkbWFidWZfaGVhcF9vcGVuKGhlYXBfbmFtZSk7CisJaWYgKGhlYXBfZmQgPCAwKQor
CQlyZXR1cm4gLTE7CisKKwlwcmludGYoIlRlc3RpbmcgKHRoZW9yZXRpY2FsKW9sZGVyIGFsbG9j
IGNvbXBhdFxuIik7CisJcmV0ID0gZG1hYnVmX2hlYXBfYWxsb2Nfb2xkZXIoaGVhcF9mZCwgT05F
X01FRywgMCwgJmRtYWJ1Zl9mZCk7CisJaWYgKHJldCkgeworCQlwcmludGYoIk9sZGVyIGNvbXBh
dCBhbGxvY2F0aW9uIGZhaWxlZCFcbiIpOworCQlyZXQgPSAtMTsKKwkJZ290byBvdXQ7CisJfQor
CWNsb3NlKGRtYWJ1Zl9mZCk7CisKKwlwcmludGYoIlRlc3RpbmcgKHRoZW9yZXRpY2FsKW5ld2Vy
IGFsbG9jIGNvbXBhdFxuIik7CisJcmV0ID0gZG1hYnVmX2hlYXBfYWxsb2NfbmV3ZXIoaGVhcF9m
ZCwgT05FX01FRywgMCwgJmRtYWJ1Zl9mZCk7CisJaWYgKHJldCkgeworCQlwcmludGYoIk5ld2Vy
IGNvbXBhdCBhbGxvY2F0aW9uIGZhaWxlZCFcbiIpOworCQlyZXQgPSAtMTsKKwkJZ290byBvdXQ7
CisJfQorCXByaW50ZigiSW9jdGwgY29tcGF0aWJpbGl0eSB0ZXN0cyBwYXNzZWRcbiIpOworb3V0
OgorCWlmIChkbWFidWZfZmQgPj0gMCkKKwkJY2xvc2UoZG1hYnVmX2ZkKTsKKwlpZiAoaGVhcF9m
ZCA+PSAwKQorCQljbG9zZShoZWFwX2ZkKTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBp
bnQgdGVzdF9hbGxvY19lcnJvcnMoY2hhciAqaGVhcF9uYW1lKQoreworCWludCBoZWFwX2ZkID0g
LTEsIGRtYWJ1Zl9mZCA9IC0xOworCWludCByZXQ7CisKKwloZWFwX2ZkID0gZG1hYnVmX2hlYXBf
b3BlbihoZWFwX25hbWUpOworCWlmIChoZWFwX2ZkIDwgMCkKKwkJcmV0dXJuIC0xOworCisJcHJp
bnRmKCJUZXN0aW5nIGV4cGVjdGVkIGVycm9yIGNhc2VzXG4iKTsKKwlyZXQgPSBkbWFidWZfaGVh
cF9hbGxvYygwLCBPTkVfTUVHLCAweDExMTExMSwgJmRtYWJ1Zl9mZCk7CisJaWYgKCFyZXQpIHsK
KwkJcHJpbnRmKCJEaWQgbm90IHNlZSBleHBlY3RlZCBlcnJvciAoaW52YWxpZCBmZCkhXG4iKTsK
KwkJcmV0ID0gLTE7CisJCWdvdG8gb3V0OworCX0KKworCXJldCA9IGRtYWJ1Zl9oZWFwX2FsbG9j
KGhlYXBfZmQsIE9ORV9NRUcsIDB4MTExMTExLCAmZG1hYnVmX2ZkKTsKKwlpZiAoIXJldCkgewor
CQlwcmludGYoIkRpZCBub3Qgc2VlIGV4cGVjdGVkIGVycm9yIChpbnZhbGlkIGhlYXAgZmxhZ3Mp
IVxuIik7CisJCXJldCA9IC0xOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSBkbWFidWZfaGVh
cF9hbGxvY19mZGZsYWdzKGhlYXBfZmQsIE9ORV9NRUcsCisJCQkJCX4oT19SRFdSIHwgT19DTE9F
WEVDKSwgMCwgJmRtYWJ1Zl9mZCk7CisJaWYgKCFyZXQpIHsKKwkJcHJpbnRmKCJEaWQgbm90IHNl
ZSBleHBlY3RlZCBlcnJvciAoaW52YWxpZCBmZCBmbGFncykhXG4iKTsKKwkJcmV0ID0gLTE7CisJ
CWdvdG8gb3V0OworCX0KKworCXByaW50ZigiRXhwZWN0ZWQgZXJyb3IgY2hlY2tpbmcgcGFzc2Vk
XG4iKTsKK291dDoKKwlpZiAoZG1hYnVmX2ZkID49IDApCisJCWNsb3NlKGRtYWJ1Zl9mZCk7CisJ
aWYgKGhlYXBfZmQgPj0gMCkKKwkJY2xvc2UoaGVhcF9mZCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitpbnQgbWFpbih2b2lkKQoreworCURJUiAqZDsKKwlzdHJ1Y3QgZGlyZW50ICpkaXI7CisJaW50
IHJldCA9IC0xOworCisJZCA9IG9wZW5kaXIoREVWUEFUSCk7CisJaWYgKCFkKSB7CisJCXByaW50
ZigiTm8gJXMgZGlyZWN0b3J5P1xuIiwgREVWUEFUSCk7CisJCXJldHVybiAtMTsKKwl9CisKKwl3
aGlsZSAoKGRpciA9IHJlYWRkaXIoZCkpICE9IE5VTEwpIHsKKwkJaWYgKCFzdHJuY21wKGRpci0+
ZF9uYW1lLCAiLiIsIDIpKQorCQkJY29udGludWU7CisJCWlmICghc3RybmNtcChkaXItPmRfbmFt
ZSwgIi4uIiwgMykpCisJCQljb250aW51ZTsKKworCQlyZXQgPSB0ZXN0X2FsbG9jX2FuZF9pbXBv
cnQoZGlyLT5kX25hbWUpOworCQlpZiAocmV0KQorCQkJYnJlYWs7CisKKwkJcmV0ID0gdGVzdF9h
bGxvY19jb21wYXQoZGlyLT5kX25hbWUpOworCQlpZiAocmV0KQorCQkJYnJlYWs7CisKKwkJcmV0
ID0gdGVzdF9hbGxvY19lcnJvcnMoZGlyLT5kX25hbWUpOworCQlpZiAocmV0KQorCQkJYnJlYWs7
CisJfQorCWNsb3NlZGlyKGQpOworCisJcmV0dXJuIHJldDsKK30KLS0gCjIuMTcuMQoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
