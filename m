Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 79A711053D4
	for <lists+dri-devel@lfdr.de>; Thu, 21 Nov 2019 15:02:48 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C2BC38910D;
	Thu, 21 Nov 2019 14:02:42 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BE5CA6F373;
 Thu, 21 Nov 2019 14:02:34 +0000 (UTC)
Received: from localhost (173-25-83-245.client.mchsi.com [173.25.83.245])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 676412070B;
 Thu, 21 Nov 2019 14:02:34 +0000 (UTC)
From: Bjorn Helgaas <helgaas@kernel.org>
To: linux-pci@vger.kernel.org
Subject: [PATCH 4/7] drm/amdgpu: Prefer pcie_capability_read_word()
Date: Thu, 21 Nov 2019 08:02:17 -0600
Message-Id: <20191121140220.38030-5-helgaas@kernel.org>
X-Mailer: git-send-email 2.24.0.432.g9d3f5f5b63-goog
In-Reply-To: <20191121140220.38030-1-helgaas@kernel.org>
References: <20191121140220.38030-1-helgaas@kernel.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=kernel.org; s=default; t=1574344954;
 bh=TP+FQMSqKA0fGNgps9ogIDNXTdLZ+sJxF9h9fPbPHMs=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=V/5sTl7TvqaU01yg9EJyBt+H+ToQFyavjv2XRYUXMt5IP7atodfKRIT2nfvmIGxRn
 YFbXbG7xHo4WI8EuFn5xmcSM3aUJenECkhPuaXW0JGIG8SguRJHm3qtFrbMSR7R7s1
 tKWbC/c3hG77qCnKXl2YvXl20j9mzOl486hZL9gw=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Frederick Lawler <fred@fredlawl.com>, Dave Airlie <airlied@linux.ie>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Bjorn Helgaas <bhelgaas@google.com>, amd-gfx@lists.freedesktop.org,
 Christian Koenig <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRnJlZGVyaWNrIExhd2xlciA8ZnJlZEBmcmVkbGF3bC5jb20+CgpDb21taXQgOGMwZDNh
MDJjMTMwICgiUENJOiBBZGQgYWNjZXNzb3JzIGZvciBQQ0kgRXhwcmVzcyBDYXBhYmlsaXR5IikK
YWRkZWQgYWNjZXNzb3JzIGZvciB0aGUgUENJIEV4cHJlc3MgQ2FwYWJpbGl0eSBzbyB0aGF0IGRy
aXZlcnMgZGlkbid0Cm5lZWQgdG8gYmUgYXdhcmUgb2YgZGlmZmVyZW5jZXMgYmV0d2VlbiB2MSBh
bmQgdjIgb2YgdGhlIFBDSQpFeHByZXNzIENhcGFiaWxpdHkuCgpSZXBsYWNlIHBjaV9yZWFkX2Nv
bmZpZ193b3JkKCkgYW5kIHBjaV93cml0ZV9jb25maWdfd29yZCgpIGNhbGxzIHdpdGgKcGNpZV9j
YXBhYmlsaXR5X3JlYWRfd29yZCgpIGFuZCBwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZCgpLgoK
W2JoZWxnYWFzOiBmaXggYSBjb3VwbGUgcmVtYWluaW5nIGluc3RhbmNlcyBpbiBjaWsuY10KTGlu
azogaHR0cHM6Ly9sb3JlLmtlcm5lbC5vcmcvci8yMDE5MTExODAwMzUxMy4xMDg1Mi0xLWZyZWRA
ZnJlZGxhd2wuY29tClNpZ25lZC1vZmYtYnk6IEZyZWRlcmljayBMYXdsZXIgPGZyZWRAZnJlZGxh
d2wuY29tPgpTaWduZWQtb2ZmLWJ5OiBCam9ybiBIZWxnYWFzIDxiaGVsZ2Fhc0Bnb29nbGUuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Npay5jIHwgNzEgKysrKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L3NpLmMgIHwg
NzEgKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgOTAg
aW5zZXJ0aW9ucygrKSwgNTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvY2lrLmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9jaWsuYwpp
bmRleCAzMDY3YmI4NzQwMzIuLjM4YjA2YWU2MzU3YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvY2lrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvY2lr
LmMKQEAgLTEzODQsNyArMTM4NCw2IEBAIHN0YXRpYyBpbnQgY2lrX3NldF92Y2VfY2xvY2tzKHN0
cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1MzIgZXZjbGssIHUzMiBlY2NsaykKIHN0YXRpYyB2
b2lkIGNpa19wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogewog
CXN0cnVjdCBwY2lfZGV2ICpyb290ID0gYWRldi0+cGRldi0+YnVzLT5zZWxmOwotCWludCBicmlk
Z2VfcG9zLCBncHVfcG9zOwogCXUzMiBzcGVlZF9jbnRsLCBjdXJyZW50X2RhdGFfcmF0ZTsKIAlp
bnQgaTsKIAl1MTYgdG1wMTY7CkBAIC0xNDE5LDEyICsxNDE4LDcgQEAgc3RhdGljIHZvaWQgY2lr
X3BjaWVfZ2VuM19lbmFibGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYpCiAJCURSTV9JTkZP
KCJlbmFibGluZyBQQ0lFIGdlbiAyIGxpbmsgc3BlZWRzLCBkaXNhYmxlIHdpdGggYW1kZ3B1LnBj
aWVfZ2VuMj0wXG4iKTsKIAl9CiAKLQlicmlkZ2VfcG9zID0gcGNpX3BjaWVfY2FwKHJvb3QpOwot
CWlmICghYnJpZGdlX3BvcykKLQkJcmV0dXJuOwotCi0JZ3B1X3BvcyA9IHBjaV9wY2llX2NhcChh
ZGV2LT5wZGV2KTsKLQlpZiAoIWdwdV9wb3MpCisJaWYgKCFwY2lfaXNfcGNpZShyb290KSB8fCAh
cGNpX2lzX3BjaWUoYWRldi0+cGRldikpCiAJCXJldHVybjsKIAogCWlmIChhZGV2LT5wbS5wY2ll
X2dlbl9tYXNrICYgQ0FJTF9QQ0lFX0xJTktfU1BFRURfU1VQUE9SVF9HRU4zKSB7CkBAIC0xNDM0
LDE0ICsxNDI4LDE3IEBAIHN0YXRpYyB2b2lkIGNpa19wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCBh
bWRncHVfZGV2aWNlICphZGV2KQogCQkJdTE2IGJyaWRnZV9jZmcyLCBncHVfY2ZnMjsKIAkJCXUz
MiBtYXhfbHcsIGN1cnJlbnRfbHcsIHRtcDsKIAotCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQocm9v
dCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAmYnJpZGdlX2NmZyk7Ci0JCQlwY2lfcmVh
ZF9jb25maWdfd29yZChhZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwsICZncHVf
Y2ZnKTsKKwkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocm9vdCwgUENJX0VYUF9MTktDVEws
CisJCQkJCQkgICZicmlkZ2VfY2ZnKTsKKwkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQoYWRl
di0+cGRldiwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkgICZncHVfY2ZnKTsKIAogCQkJdG1wMTYg
PSBicmlkZ2VfY2ZnIHwgUENJX0VYUF9MTktDVExfSEFXRDsKLQkJCXBjaV93cml0ZV9jb25maWdf
d29yZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktDVEwsIHRtcDE2KTsKKwkJCXBjaWVf
Y2FwYWJpbGl0eV93cml0ZV93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CiAKIAkJ
CXRtcDE2ID0gZ3B1X2NmZyB8IFBDSV9FWFBfTE5LQ1RMX0hBV0Q7Ci0JCQlwY2lfd3JpdGVfY29u
ZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CisJ
CQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChhZGV2LT5wZGV2LCBQQ0lfRVhQX0xOS0NUTCwK
KwkJCQkJCSAgIHRtcDE2KTsKIAogCQkJdG1wID0gUlJFRzMyX1BDSUUoaXhQQ0lFX0xDX1NUQVRV
UzEpOwogCQkJbWF4X2x3ID0gKHRtcCAmIFBDSUVfTENfU1RBVFVTMV9fTENfREVURUNURURfTElO
S19XSURUSF9NQVNLKSA+PgpAQCAtMTQ2NSwxNSArMTQ2MiwyMyBAQCBzdGF0aWMgdm9pZCBjaWtf
cGNpZV9nZW4zX2VuYWJsZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAogCQkJZm9yIChp
ID0gMDsgaSA8IDEwOyBpKyspIHsKIAkJCQkvKiBjaGVjayBzdGF0dXMgKi8KLQkJCQlwY2lfcmVh
ZF9jb25maWdfd29yZChhZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9ERVZTVEEsICZ0bXAx
Nik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChhZGV2LT5wZGV2LAorCQkJCQkJCSAg
UENJX0VYUF9ERVZTVEEsCisJCQkJCQkJICAmdG1wMTYpOwogCQkJCWlmICh0bXAxNiAmIFBDSV9F
WFBfREVWU1RBX1RSUE5EKQogCQkJCQlicmVhazsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3Jk
KHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgJmJyaWRnZV9jZmcpOwotCQkJCXBj
aV9yZWFkX2NvbmZpZ193b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwg
JmdwdV9jZmcpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocm9vdCwgUENJX0VYUF9M
TktDVEwsCisJCQkJCQkJICAmYnJpZGdlX2NmZyk7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRf
d29yZChhZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEwsCisJCQkJCQkJICAmZ3B1
X2NmZyk7CiAKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsgUENJ
X0VYUF9MTktDVEwyLCAmYnJpZGdlX2NmZzIpOwotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKGFk
ZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZncHVfY2ZnMik7CisJCQkJcGNp
ZV9jYXBhYmlsaXR5X3JlYWRfd29yZChyb290LCBQQ0lfRVhQX0xOS0NUTDIsCisJCQkJCQkJICAm
YnJpZGdlX2NmZzIpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQoYWRldi0+cGRldiwK
KwkJCQkJCQkgIFBDSV9FWFBfTE5LQ1RMMiwKKwkJCQkJCQkgICZncHVfY2ZnMik7CiAKIAkJCQl0
bXAgPSBSUkVHMzJfUENJRShpeFBDSUVfTENfQ05UTDQpOwogCQkJCXRtcCB8PSBQQ0lFX0xDX0NO
VEw0X19MQ19TRVRfUVVJRVNDRV9NQVNLOwpAQCAtMTQ4NiwzMiArMTQ5MSw0NSBAQCBzdGF0aWMg
dm9pZCBjaWtfcGNpZV9nZW4zX2VuYWJsZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJ
CQltc2xlZXAoMTAwKTsKIAogCQkJCS8qIGxpbmtjdGwgKi8KLQkJCQlwY2lfcmVhZF9jb25maWdf
d29yZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktDVEwsICZ0bXAxNik7CisJCQkJcGNp
ZV9jYXBhYmlsaXR5X3JlYWRfd29yZChyb290LCBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCQkgICZ0
bXAxNik7CiAJCQkJdG1wMTYgJj0gflBDSV9FWFBfTE5LQ1RMX0hBV0Q7CiAJCQkJdG1wMTYgfD0g
KGJyaWRnZV9jZmcgJiBQQ0lfRVhQX0xOS0NUTF9IQVdEKTsKLQkJCQlwY2lfd3JpdGVfY29uZmln
X3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CisJCQkJcGNp
ZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQocm9vdCwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkJICAg
dG1wMTYpOwogCi0JCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyAr
IFBDSV9FWFBfTE5LQ1RMLCAmdG1wMTYpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQo
YWRldi0+cGRldiwKKwkJCQkJCQkgIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgJnRtcDE2KTsK
IAkJCQl0bXAxNiAmPSB+UENJX0VYUF9MTktDVExfSEFXRDsKIAkJCQl0bXAxNiB8PSAoZ3B1X2Nm
ZyAmIFBDSV9FWFBfTE5LQ1RMX0hBV0QpOwotCQkJCXBjaV93cml0ZV9jb25maWdfd29yZChhZGV2
LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwsIHRtcDE2KTsKKwkJCQlwY2llX2NhcGFi
aWxpdHlfd3JpdGVfd29yZChhZGV2LT5wZGV2LAorCQkJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMLAor
CQkJCQkJCSAgIHRtcDE2KTsKIAogCQkJCS8qIGxpbmtjdGwyICovCi0JCQkJcGNpX3JlYWRfY29u
ZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgJnRtcDE2KTsKKwkJ
CQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RMMiwKKwkJCQkJ
CQkgICZ0bXAxNik7CiAJCQkJdG1wMTYgJj0gfihQQ0lfRVhQX0xOS0NUTDJfRU5URVJfQ09NUCB8
CiAJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMMl9UWF9NQVJHSU4pOwogCQkJCXRtcDE2IHw9IChicmlk
Z2VfY2ZnMiAmCiAJCQkJCSAgKFBDSV9FWFBfTE5LQ1RMMl9FTlRFUl9DT01QIHwKIAkJCQkJICAg
UENJX0VYUF9MTktDVEwyX1RYX01BUkdJTikpOwotCQkJCXBjaV93cml0ZV9jb25maWdfd29yZChy
b290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktDVEwyLCB0bXAxNik7CisJCQkJcGNpZV9jYXBh
YmlsaXR5X3dyaXRlX3dvcmQocm9vdCwKKwkJCQkJCQkgICBQQ0lfRVhQX0xOS0NUTDIsCisJCQkJ
CQkJICAgdG1wMTYpOwogCi0JCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1
X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgJnRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVh
ZF93b3JkKGFkZXYtPnBkZXYsCisJCQkJCQkJICBQQ0lfRVhQX0xOS0NUTDIsCisJCQkJCQkJICAm
dG1wMTYpOwogCQkJCXRtcDE2ICY9IH4oUENJX0VYUF9MTktDVEwyX0VOVEVSX0NPTVAgfAogCQkJ
CQkgICBQQ0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKTsKIAkJCQl0bXAxNiB8PSAoZ3B1X2NmZzIg
JgogCQkJCQkgIChQQ0lfRVhQX0xOS0NUTDJfRU5URVJfQ09NUCB8CiAJCQkJCSAgIFBDSV9FWFBf
TE5LQ1RMMl9UWF9NQVJHSU4pKTsKLQkJCQlwY2lfd3JpdGVfY29uZmlnX3dvcmQoYWRldi0+cGRl
diwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgdG1wMTYpOworCQkJCXBjaWVfY2FwYWJpbGl0
eV93cml0ZV93b3JkKGFkZXYtPnBkZXYsCisJCQkJCQkJICAgUENJX0VYUF9MTktDVEwyLAorCQkJ
CQkJCSAgIHRtcDE2KTsKIAogCQkJCXRtcCA9IFJSRUczMl9QQ0lFKGl4UENJRV9MQ19DTlRMNCk7
CiAJCQkJdG1wICY9IH5QQ0lFX0xDX0NOVEw0X19MQ19TRVRfUVVJRVNDRV9NQVNLOwpAQCAtMTUy
NiwxNSArMTU0NCwxNiBAQCBzdGF0aWMgdm9pZCBjaWtfcGNpZV9nZW4zX2VuYWJsZShzdHJ1Y3Qg
YW1kZ3B1X2RldmljZSAqYWRldikKIAlzcGVlZF9jbnRsICY9IH5QQ0lFX0xDX1NQRUVEX0NOVExf
X0xDX0ZPUkNFX0RJU19TV19TUEVFRF9DSEFOR0VfTUFTSzsKIAlXUkVHMzJfUENJRShpeFBDSUVf
TENfU1BFRURfQ05UTCwgc3BlZWRfY250bCk7CiAKLQlwY2lfcmVhZF9jb25maWdfd29yZChhZGV2
LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwyLCAmdG1wMTYpOworCXBjaWVfY2FwYWJp
bGl0eV9yZWFkX3dvcmQoYWRldi0+cGRldiwgUENJX0VYUF9MTktDVEwyLCAmdG1wMTYpOwogCXRt
cDE2ICY9IH5QQ0lfRVhQX0xOS0NUTDJfVExTOworCiAJaWYgKGFkZXYtPnBtLnBjaWVfZ2VuX21h
c2sgJiBDQUlMX1BDSUVfTElOS19TUEVFRF9TVVBQT1JUX0dFTjMpCiAJCXRtcDE2IHw9IFBDSV9F
WFBfTE5LQ1RMMl9UTFNfOF8wR1Q7IC8qIGdlbjMgKi8KIAllbHNlIGlmIChhZGV2LT5wbS5wY2ll
X2dlbl9tYXNrICYgQ0FJTF9QQ0lFX0xJTktfU1BFRURfU1VQUE9SVF9HRU4yKQogCQl0bXAxNiB8
PSBQQ0lfRVhQX0xOS0NUTDJfVExTXzVfMEdUOyAvKiBnZW4yICovCiAJZWxzZQogCQl0bXAxNiB8
PSBQQ0lfRVhQX0xOS0NUTDJfVExTXzJfNUdUOyAvKiBnZW4xICovCi0JcGNpX3dyaXRlX2NvbmZp
Z193b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsIHRtcDE2KTsKKwlw
Y2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChhZGV2LT5wZGV2LCBQQ0lfRVhQX0xOS0NUTDIsIHRt
cDE2KTsKIAogCXNwZWVkX2NudGwgPSBSUkVHMzJfUENJRShpeFBDSUVfTENfU1BFRURfQ05UTCk7
CiAJc3BlZWRfY250bCB8PSBQQ0lFX0xDX1NQRUVEX0NOVExfX0xDX0lOSVRJQVRFX0xJTktfU1BF
RURfQ0hBTkdFX01BU0s7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9z
aS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2kuYwppbmRleCBhN2RjYjBkMGYwMzku
LjlmODJiZTg3OTIyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvc2ku
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9zaS5jCkBAIC0xNjMzLDcgKzE2MzMs
NiBAQCBzdGF0aWMgdm9pZCBzaV9pbml0X2dvbGRlbl9yZWdpc3RlcnMoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYpCiBzdGF0aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQogewogCXN0cnVjdCBwY2lfZGV2ICpyb290ID0gYWRldi0+cGRldi0+
YnVzLT5zZWxmOwotCWludCBicmlkZ2VfcG9zLCBncHVfcG9zOwogCXUzMiBzcGVlZF9jbnRsLCBj
dXJyZW50X2RhdGFfcmF0ZTsKIAlpbnQgaTsKIAl1MTYgdG1wMTY7CkBAIC0xNjY4LDEyICsxNjY3
LDcgQEAgc3RhdGljIHZvaWQgc2lfcGNpZV9nZW4zX2VuYWJsZShzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldikKIAkJRFJNX0lORk8oImVuYWJsaW5nIFBDSUUgZ2VuIDIgbGluayBzcGVlZHMsIGRp
c2FibGUgd2l0aCBhbWRncHUucGNpZV9nZW4yPTBcbiIpOwogCX0KIAotCWJyaWRnZV9wb3MgPSBw
Y2lfcGNpZV9jYXAocm9vdCk7Ci0JaWYgKCFicmlkZ2VfcG9zKQotCQlyZXR1cm47Ci0KLQlncHVf
cG9zID0gcGNpX3BjaWVfY2FwKGFkZXYtPnBkZXYpOwotCWlmICghZ3B1X3BvcykKKwlpZiAoIXBj
aV9pc19wY2llKHJvb3QpIHx8ICFwY2lfaXNfcGNpZShhZGV2LT5wZGV2KSkKIAkJcmV0dXJuOwog
CiAJaWYgKGFkZXYtPnBtLnBjaWVfZ2VuX21hc2sgJiBDQUlMX1BDSUVfTElOS19TUEVFRF9TVVBQ
T1JUX0dFTjMpIHsKQEAgLTE2ODIsMTQgKzE2NzYsMTcgQEAgc3RhdGljIHZvaWQgc2lfcGNpZV9n
ZW4zX2VuYWJsZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldikKIAkJCXUxNiBicmlkZ2VfY2Zn
MiwgZ3B1X2NmZzI7CiAJCQl1MzIgbWF4X2x3LCBjdXJyZW50X2x3LCB0bXA7CiAKLQkJCXBjaV9y
ZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgJmJyaWRn
ZV9jZmcpOwotCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyArIFBD
SV9FWFBfTE5LQ1RMLCAmZ3B1X2NmZyk7CisJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJv
b3QsIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJICAmYnJpZGdlX2NmZyk7CisJCQlwY2llX2NhcGFi
aWxpdHlfcmVhZF93b3JkKGFkZXYtPnBkZXYsIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJICAmZ3B1
X2NmZyk7CiAKIAkJCXRtcDE2ID0gYnJpZGdlX2NmZyB8IFBDSV9FWFBfTE5LQ1RMX0hBV0Q7Ci0J
CQlwY2lfd3JpdGVfY29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RM
LCB0bXAxNik7CisJCQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChyb290LCBQQ0lfRVhQX0xO
S0NUTCwgdG1wMTYpOwogCiAJCQl0bXAxNiA9IGdwdV9jZmcgfCBQQ0lfRVhQX0xOS0NUTF9IQVdE
OwotCQkJcGNpX3dyaXRlX2NvbmZpZ193b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQ
X0xOS0NUTCwgdG1wMTYpOworCQkJcGNpZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQoYWRldi0+cGRl
diwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkgICB0bXAxNik7CiAKIAkJCXRtcCA9IFJSRUczMl9Q
Q0lFKFBDSUVfTENfU1RBVFVTMSk7CiAJCQltYXhfbHcgPSAodG1wICYgTENfREVURUNURURfTElO
S19XSURUSF9NQVNLKSA+PiBMQ19ERVRFQ1RFRF9MSU5LX1dJRFRIX1NISUZUOwpAQCAtMTcwNiwx
NSArMTcwMywyMyBAQCBzdGF0aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQogCQkJfQogCiAJCQlmb3IgKGkgPSAwOyBpIDwgMTA7IGkrKykgewot
CQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0RF
VlNUQSwgJnRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKGFkZXYtPnBkZXYs
CisJCQkJCQkJICBQQ0lfRVhQX0RFVlNUQSwKKwkJCQkJCQkgICZ0bXAxNik7CiAJCQkJaWYgKHRt
cDE2ICYgUENJX0VYUF9ERVZTVEFfVFJQTkQpCiAJCQkJCWJyZWFrOwogCi0JCQkJcGNpX3JlYWRf
Y29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAmYnJpZGdlX2Nm
Zyk7Ci0JCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9F
WFBfTE5LQ1RMLCAmZ3B1X2NmZyk7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChyb290
LCBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCQkgICZicmlkZ2VfY2ZnKTsKKwkJCQlwY2llX2NhcGFi
aWxpdHlfcmVhZF93b3JkKGFkZXYtPnBkZXYsCisJCQkJCQkJICBQQ0lfRVhQX0xOS0NUTCwKKwkJ
CQkJCQkgICZncHVfY2ZnKTsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRn
ZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZicmlkZ2VfY2ZnMik7Ci0JCQkJcGNpX3JlYWRfY29u
ZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgJmdwdV9jZmcy
KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RMMiwK
KwkJCQkJCQkgICZicmlkZ2VfY2ZnMik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChh
ZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEwyLAorCQkJCQkJCSAgJmdwdV9jZmcy
KTsKIAogCQkJCXRtcCA9IFJSRUczMl9QQ0lFX1BPUlQoUENJRV9MQ19DTlRMNCk7CiAJCQkJdG1w
IHw9IExDX1NFVF9RVUlFU0NFOwpAQCAtMTcyNiwzMSArMTczMSw0NCBAQCBzdGF0aWMgdm9pZCBz
aV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2KQogCiAJCQkJbWRl
bGF5KDEwMCk7CiAKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsg
UENJX0VYUF9MTktDVEwsICZ0bXAxNik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChy
b290LCBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCQkgICZ0bXAxNik7CiAJCQkJdG1wMTYgJj0gflBD
SV9FWFBfTE5LQ1RMX0hBV0Q7CiAJCQkJdG1wMTYgfD0gKGJyaWRnZV9jZmcgJiBQQ0lfRVhQX0xO
S0NUTF9IQVdEKTsKLQkJCQlwY2lfd3JpdGVfY29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyAr
IFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQo
cm9vdCwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkJICAgdG1wMTYpOwogCi0JCQkJcGNpX3JlYWRf
Y29uZmlnX3dvcmQoYWRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAmdG1wMTYp
OworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQoYWRldi0+cGRldiwKKwkJCQkJCQkgIFBD
SV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgJnRtcDE2KTsKIAkJCQl0bXAxNiAmPSB+UENJX0VYUF9M
TktDVExfSEFXRDsKIAkJCQl0bXAxNiB8PSAoZ3B1X2NmZyAmIFBDSV9FWFBfTE5LQ1RMX0hBV0Qp
OwotCQkJCXBjaV93cml0ZV9jb25maWdfd29yZChhZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VY
UF9MTktDVEwsIHRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChhZGV2LT5w
ZGV2LAorCQkJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgIHRtcDE2KTsKIAotCQkJ
CXBjaV9yZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIs
ICZ0bXAxNik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChyb290LCBQQ0lfRVhQX0xO
S0NUTDIsCisJCQkJCQkJICAmdG1wMTYpOwogCQkJCXRtcDE2ICY9IH4oUENJX0VYUF9MTktDVEwy
X0VOVEVSX0NPTVAgfAogCQkJCQkgICBQQ0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKTsKIAkJCQl0
bXAxNiB8PSAoYnJpZGdlX2NmZzIgJgogCQkJCQkgIChQQ0lfRVhQX0xOS0NUTDJfRU5URVJfQ09N
UCB8CiAJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMMl9UWF9NQVJHSU4pKTsKLQkJCQlwY2lfd3JpdGVf
Y29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgdG1wMTYpOwor
CQkJCXBjaWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJvb3QsCisJCQkJCQkJICAgUENJX0VYUF9M
TktDVEwyLAorCQkJCQkJCSAgIHRtcDE2KTsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKGFk
ZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZ0bXAxNik7CisJCQkJcGNpZV9j
YXBhYmlsaXR5X3JlYWRfd29yZChhZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEwy
LAorCQkJCQkJCSAgJnRtcDE2KTsKIAkJCQl0bXAxNiAmPSB+KFBDSV9FWFBfTE5LQ1RMMl9FTlRF
Ul9DT01QIHwKIAkJCQkJICAgUENJX0VYUF9MTktDVEwyX1RYX01BUkdJTik7CiAJCQkJdG1wMTYg
fD0gKGdwdV9jZmcyICYKIAkJCQkJICAoUENJX0VYUF9MTktDVEwyX0VOVEVSX0NPTVAgfAogCQkJ
CQkgICBQQ0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKSk7Ci0JCQkJcGNpX3dyaXRlX2NvbmZpZ193
b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsIHRtcDE2KTsKKwkJCQlw
Y2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChhZGV2LT5wZGV2LAorCQkJCQkJCSAgIFBDSV9FWFBf
TE5LQ1RMMiwKKwkJCQkJCQkgICB0bXAxNik7CiAKIAkJCQl0bXAgPSBSUkVHMzJfUENJRV9QT1JU
KFBDSUVfTENfQ05UTDQpOwogCQkJCXRtcCAmPSB+TENfU0VUX1FVSUVTQ0U7CkBAIC0xNzYzLDE1
ICsxNzgxLDE2IEBAIHN0YXRpYyB2b2lkIHNpX3BjaWVfZ2VuM19lbmFibGUoc3RydWN0IGFtZGdw
dV9kZXZpY2UgKmFkZXYpCiAJc3BlZWRfY250bCAmPSB+TENfRk9SQ0VfRElTX1NXX1NQRUVEX0NI
QU5HRTsKIAlXUkVHMzJfUENJRV9QT1JUKFBDSUVfTENfU1BFRURfQ05UTCwgc3BlZWRfY250bCk7
CiAKLQlwY2lfcmVhZF9jb25maWdfd29yZChhZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9M
TktDVEwyLCAmdG1wMTYpOworCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQoYWRldi0+cGRldiwg
UENJX0VYUF9MTktDVEwyLCAmdG1wMTYpOwogCXRtcDE2ICY9IH5QQ0lfRVhQX0xOS0NUTDJfVExT
OworCiAJaWYgKGFkZXYtPnBtLnBjaWVfZ2VuX21hc2sgJiBDQUlMX1BDSUVfTElOS19TUEVFRF9T
VVBQT1JUX0dFTjMpCiAJCXRtcDE2IHw9IFBDSV9FWFBfTE5LQ1RMMl9UTFNfOF8wR1Q7IC8qIGdl
bjMgKi8KIAllbHNlIGlmIChhZGV2LT5wbS5wY2llX2dlbl9tYXNrICYgQ0FJTF9QQ0lFX0xJTktf
U1BFRURfU1VQUE9SVF9HRU4yKQogCQl0bXAxNiB8PSBQQ0lfRVhQX0xOS0NUTDJfVExTXzVfMEdU
OyAvKiBnZW4yICovCiAJZWxzZQogCQl0bXAxNiB8PSBQQ0lfRVhQX0xOS0NUTDJfVExTXzJfNUdU
OyAvKiBnZW4xICovCi0JcGNpX3dyaXRlX2NvbmZpZ193b3JkKGFkZXYtPnBkZXYsIGdwdV9wb3Mg
KyBQQ0lfRVhQX0xOS0NUTDIsIHRtcDE2KTsKKwlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChh
ZGV2LT5wZGV2LCBQQ0lfRVhQX0xOS0NUTDIsIHRtcDE2KTsKIAogCXNwZWVkX2NudGwgPSBSUkVH
MzJfUENJRV9QT1JUKFBDSUVfTENfU1BFRURfQ05UTCk7CiAJc3BlZWRfY250bCB8PSBMQ19JTklU
SUFURV9MSU5LX1NQRUVEX0NIQU5HRTsKLS0gCjIuMjQuMC40MzIuZzlkM2Y1ZjViNjMtZ29vZwoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
