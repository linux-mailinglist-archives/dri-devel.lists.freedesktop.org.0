Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E3880115997
	for <lists+dri-devel@lfdr.de>; Sat,  7 Dec 2019 00:15:07 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0F1C66FAAC;
	Fri,  6 Dec 2019 23:15:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-il1-x144.google.com (mail-il1-x144.google.com
 [IPv6:2607:f8b0:4864:20::144])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E55276FAA9
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Dec 2019 23:14:58 +0000 (UTC)
Received: by mail-il1-x144.google.com with SMTP id a7so7696154ild.6
 for <dri-devel@lists.freedesktop.org>; Fri, 06 Dec 2019 15:14:58 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=1nbRHvdkP0hLRgTfexh8/WK4VLoG7LzO+ZWO18GgBGY=;
 b=pZ8NqiWPJvtRe7uUjMV0b5P/GCFeUF4oxPnhX8d7wM0Uw7ASxFa7hzPKzldH9fNeMF
 uR/fNFUQxwreTII+rlmzihFqyFPsuyFE5ldwHegjgQx8sMR7QIoQmtruVAliW29N/lil
 8LMCBi+L1g0VXQF+p3kVNZX86MSloc0mlByTprDw2H85ELsjrT/RtwbC+I5xDF1e9Ixz
 1qd2oI5lZdgrELWDHStWXtV4cwRWKNiPVvaecEU35y4GfGQM/l/HesqJx++HuttbJubp
 D83Pya7+Y5AuibXCh+IUQqL4ZrAV61ALd34RVhvmOxm+vhVAQ5hli+Fl9LqOMLV2H/yg
 g/Ug==
X-Gm-Message-State: APjAAAUTqWgISPGR/5nEG4l00IiJXLfu+cblEzgiSVMAqaTBfsWAzkL7
 RPhkUazZFeY+VA33dzp3Lxi/ObpxDk8=
X-Google-Smtp-Source: APXvYqyDf/uqUpunrIdThbIZ4cH4pyFIFN3uzZeKRVVjjgeaa0B/Fvs16WgmKVIpv6TQIIpIckuNjw==
X-Received: by 2002:a92:c851:: with SMTP id b17mr15412044ilq.160.1575674097972; 
 Fri, 06 Dec 2019 15:14:57 -0800 (PST)
Received: from ddavenport4.bld.corp.google.com
 ([2620:15c:183:0:92f:a80a:519d:f777])
 by smtp.gmail.com with ESMTPSA id b15sm4317946ilo.37.2019.12.06.15.14.57
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
 Fri, 06 Dec 2019 15:14:57 -0800 (PST)
From: Drew Davenport <ddavenport@chromium.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 4/6] drm/msm/dpu: Remove unnecessary NULL check
Date: Fri,  6 Dec 2019 16:13:46 -0700
Message-Id: <20191206161137.4.Ia99f646171bd2099e8710c4dc2f3825850d38737@changeid>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191206161137.1.Ibb7612c1ebcebe3f560b3269150c0e0363f01e44@changeid>
References: <20191206161137.1.Ibb7612c1ebcebe3f560b3269150c0e0363f01e44@changeid>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=chromium.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=1nbRHvdkP0hLRgTfexh8/WK4VLoG7LzO+ZWO18GgBGY=;
 b=JIy+azGNeXNIeGZcbTheNvvLUgrGldNjpNaGaM3ALED7rlJRkUN2qhFOvmNdMlsQTL
 lpvjcHM4QxiM6FHMBfEm5CyLXT1NK/GEAYuxqLv3Z9uuQOjzdTGwRc6Y/BVFuIjYXOvX
 vQpbQPLtmbLp9bNGtDTuz77/akfCiEUHyZlSY=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Fritz Koenig <frkoenig@google.com>, David Airlie <airlied@linux.ie>,
 linux-arm-msm@vger.kernel.org, linux-kernel@vger.kernel.org,
 Drew Davenport <ddavenport@chromium.org>, freedreno@lists.freedesktop.org,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

ZHB1X2VuY29kZXJfdmlydC5waHlzX2VuY3NbMDpudW1fcGh5c19lbmNzLTFdIHdpbGwgbm90IGJl
IE5VTEwgc28gZG9uJ3QKY2hlY2suCgpBbHNvIGZpeCBtdWx0aWxpbmUgc3RyaW5ncyB0aGF0IGNh
dXNlZCBjaGVja3BhdGNoIHdhcm5pbmcuCgpTaWduZWQtb2ZmLWJ5OiBEcmV3IERhdmVucG9ydCA8
ZGRhdmVucG9ydEBjaHJvbWl1bS5vcmc+Ci0tLQoKIGRyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9k
cHUxL2RwdV9lbmNvZGVyLmMgfCAxNjIgKysrKysrKystLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFu
Z2VkLCA2MSBpbnNlcnRpb25zKCspLCAxMDEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXIuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9tc20vZGlzcC9kcHUxL2RwdV9lbmNvZGVyLmMKaW5kZXggNDVhODc3NTdlNzY2Li5lOWY4ZmU2
NmFmN2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUxL2RwdV9lbmNv
ZGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL2RwdTEvZHB1X2VuY29kZXIuYwpA
QCAtMjMzLDcgKzIzMyw3IEBAIGludCBkcHVfZW5jb2Rlcl9oZWxwZXJfd2FpdF9mb3JfaXJxKHN0
cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2VuYywKIAl1MzIgaXJxX3N0YXR1czsKIAlpbnQg
cmV0OwogCi0JaWYgKCFwaHlzX2VuYyB8fCAhd2FpdF9pbmZvIHx8IGludHJfaWR4ID49IElOVFJf
SURYX01BWCkgeworCWlmICghd2FpdF9pbmZvIHx8IGludHJfaWR4ID49IElOVFJfSURYX01BWCkg
ewogCQlEUFVfRVJST1IoImludmFsaWQgcGFyYW1zXG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJ
fQpAQCAtMzA4LDcgKzMwOCw3IEBAIGludCBkcHVfZW5jb2Rlcl9oZWxwZXJfcmVnaXN0ZXJfaXJx
KHN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2VuYywKIAlzdHJ1Y3QgZHB1X2VuY29kZXJf
aXJxICppcnE7CiAJaW50IHJldCA9IDA7CiAKLQlpZiAoIXBoeXNfZW5jIHx8IGludHJfaWR4ID49
IElOVFJfSURYX01BWCkgeworCWlmIChpbnRyX2lkeCA+PSBJTlRSX0lEWF9NQVgpIHsKIAkJRFBV
X0VSUk9SKCJpbnZhbGlkIHBhcmFtc1xuIik7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KQEAgLTM2
MywxMCArMzYzLDYgQEAgaW50IGRwdV9lbmNvZGVyX2hlbHBlcl91bnJlZ2lzdGVyX2lycShzdHJ1
Y3QgZHB1X2VuY29kZXJfcGh5cyAqcGh5c19lbmMsCiAJc3RydWN0IGRwdV9lbmNvZGVyX2lycSAq
aXJxOwogCWludCByZXQ7CiAKLQlpZiAoIXBoeXNfZW5jKSB7Ci0JCURQVV9FUlJPUigiaW52YWxp
ZCBlbmNvZGVyXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQogCWlycSA9ICZwaHlzX2VuYy0+
aXJxW2ludHJfaWR4XTsKIAogCS8qIHNpbGVudGx5IHNraXAgaXJxcyB0aGF0IHdlcmVuJ3QgcmVn
aXN0ZXJlZCAqLwpAQCAtNDE1LDcgKzQxMSw3IEBAIHZvaWQgZHB1X2VuY29kZXJfZ2V0X2h3X3Jl
c291cmNlcyhzdHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMsCiAJZm9yIChpID0gMDsgaSA8IGRw
dV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlzdHJ1Y3QgZHB1X2VuY29kZXJfcGh5cyAq
cGh5cyA9IGRwdV9lbmMtPnBoeXNfZW5jc1tpXTsKIAotCQlpZiAocGh5cyAmJiBwaHlzLT5vcHMu
Z2V0X2h3X3Jlc291cmNlcykKKwkJaWYgKHBoeXMtPm9wcy5nZXRfaHdfcmVzb3VyY2VzKQogCQkJ
cGh5cy0+b3BzLmdldF9od19yZXNvdXJjZXMocGh5cywgaHdfcmVzKTsKIAl9CiB9CkBAIC00Mzgs
NyArNDM0LDcgQEAgc3RhdGljIHZvaWQgZHB1X2VuY29kZXJfZGVzdHJveShzdHJ1Y3QgZHJtX2Vu
Y29kZXIgKmRybV9lbmMpCiAJZm9yIChpID0gMDsgaSA8IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7
IGkrKykgewogCQlzdHJ1Y3QgZHB1X2VuY29kZXJfcGh5cyAqcGh5cyA9IGRwdV9lbmMtPnBoeXNf
ZW5jc1tpXTsKIAotCQlpZiAocGh5cyAmJiBwaHlzLT5vcHMuZGVzdHJveSkgeworCQlpZiAocGh5
cy0+b3BzLmRlc3Ryb3kpIHsKIAkJCXBoeXMtPm9wcy5kZXN0cm95KHBoeXMpOwogCQkJLS1kcHVf
ZW5jLT5udW1fcGh5c19lbmNzOwogCQkJZHB1X2VuYy0+cGh5c19lbmNzW2ldID0gTlVMTDsKQEAg
LTQ2NCw3ICs0NjAsNyBAQCB2b2lkIGRwdV9lbmNvZGVyX2hlbHBlcl9zcGxpdF9jb25maWcoCiAJ
c3RydWN0IGRwdV9od19tZHAgKmh3X21kcHRvcDsKIAlzdHJ1Y3QgbXNtX2Rpc3BsYXlfaW5mbyAq
ZGlzcF9pbmZvOwogCi0JaWYgKCFwaHlzX2VuYyB8fCAhcGh5c19lbmMtPmh3X21kcHRvcCB8fCAh
cGh5c19lbmMtPnBhcmVudCkgeworCWlmICghcGh5c19lbmMtPmh3X21kcHRvcCB8fCAhcGh5c19l
bmMtPnBhcmVudCkgewogCQlEUFVfRVJST1IoImludmFsaWQgYXJnKHMpLCBlbmNvZGVyICVkXG4i
LCBwaHlzX2VuYyAhPSAwKTsKIAkJcmV0dXJuOwogCX0KQEAgLTUyOCwxNiArNTI0LDExIEBAIHN0
YXRpYyBzdHJ1Y3QgbXNtX2Rpc3BsYXlfdG9wb2xvZ3kgZHB1X2VuY29kZXJfZ2V0X3RvcG9sb2d5
KAogCQkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCiB7CiAJc3RydWN0IG1zbV9kaXNw
bGF5X3RvcG9sb2d5IHRvcG9sb2d5OwotCWludCBpLCBpbnRmX2NvdW50ID0gMDsKLQotCWZvciAo
aSA9IDA7IGkgPCBNQVhfUEhZU19FTkNPREVSU19QRVJfVklSVFVBTDsgaSsrKQotCQlpZiAoZHB1
X2VuYy0+cGh5c19lbmNzW2ldKQotCQkJaW50Zl9jb3VudCsrOwogCiAJLyogVXNlciBzcGxpdCB0
b3BvbG9neSBmb3Igd2lkdGggPiAxMDgwICovCiAJdG9wb2xvZ3kubnVtX2xtID0gKG1vZGUtPnZk
aXNwbGF5ID4gTUFYX1ZESVNQTEFZX1NQTElUKSA/IDIgOiAxOwogCXRvcG9sb2d5Lm51bV9lbmMg
PSAwOwotCXRvcG9sb2d5Lm51bV9pbnRmID0gaW50Zl9jb3VudDsKKwl0b3BvbG9neS5udW1faW50
ZiA9IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7CiAKIAlyZXR1cm4gdG9wb2xvZ3k7CiB9CkBAIC01
ODMsMTAgKzU3NCwxMCBAQCBzdGF0aWMgaW50IGRwdV9lbmNvZGVyX3ZpcnRfYXRvbWljX2NoZWNr
KAogCWZvciAoaSA9IDA7IGkgPCBkcHVfZW5jLT5udW1fcGh5c19lbmNzOyBpKyspIHsKIAkJc3Ry
dWN0IGRwdV9lbmNvZGVyX3BoeXMgKnBoeXMgPSBkcHVfZW5jLT5waHlzX2VuY3NbaV07CiAKLQkJ
aWYgKHBoeXMgJiYgcGh5cy0+b3BzLmF0b21pY19jaGVjaykKKwkJaWYgKHBoeXMtPm9wcy5hdG9t
aWNfY2hlY2spCiAJCQlyZXQgPSBwaHlzLT5vcHMuYXRvbWljX2NoZWNrKHBoeXMsIGNydGNfc3Rh
dGUsCiAJCQkJCWNvbm5fc3RhdGUpOwotCQllbHNlIGlmIChwaHlzICYmIHBoeXMtPm9wcy5tb2Rl
X2ZpeHVwKQorCQllbHNlIGlmIChwaHlzLT5vcHMubW9kZV9maXh1cCkKIAkJCWlmICghcGh5cy0+
b3BzLm1vZGVfZml4dXAocGh5cywgbW9kZSwgYWRqX21vZGUpKQogCQkJCXJldCA9IC1FSU5WQUw7
CiAKQEAgLTY4Miw3ICs2NzMsNyBAQCBzdGF0aWMgdm9pZCBfZHB1X2VuY29kZXJfaXJxX2NvbnRy
b2woc3RydWN0IGRybV9lbmNvZGVyICpkcm1fZW5jLCBib29sIGVuYWJsZSkKIAlmb3IgKGkgPSAw
OyBpIDwgZHB1X2VuYy0+bnVtX3BoeXNfZW5jczsgaSsrKSB7CiAJCXN0cnVjdCBkcHVfZW5jb2Rl
cl9waHlzICpwaHlzID0gZHB1X2VuYy0+cGh5c19lbmNzW2ldOwogCi0JCWlmIChwaHlzICYmIHBo
eXMtPm9wcy5pcnFfY29udHJvbCkKKwkJaWYgKHBoeXMtPm9wcy5pcnFfY29udHJvbCkKIAkJCXBo
eXMtPm9wcy5pcnFfY29udHJvbChwaHlzLCBlbmFibGUpOwogCX0KIApAQCAtMTAzMiw0NiArMTAy
Myw0MyBAQCBzdGF0aWMgdm9pZCBkcHVfZW5jb2Rlcl92aXJ0X21vZGVfc2V0KHN0cnVjdCBkcm1f
ZW5jb2RlciAqZHJtX2VuYywKIAlmb3IgKGkgPSAwOyBpIDwgZHB1X2VuYy0+bnVtX3BoeXNfZW5j
czsgaSsrKSB7CiAJCXN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzID0gZHB1X2VuYy0+cGh5
c19lbmNzW2ldOwogCi0JCWlmIChwaHlzKSB7Ci0JCQlpZiAoIWRwdV9lbmMtPmh3X3BwW2ldKSB7
Ci0JCQkJRFBVX0VSUk9SX0VOQyhkcHVfZW5jLCAibm8gcHAgYmxvY2sgYXNzaWduZWQiCi0JCQkJ
CSAgICAgImF0IGlkeDogJWRcbiIsIGkpOwotCQkJCWdvdG8gZXJyb3I7Ci0JCQl9CisJCWlmICgh
ZHB1X2VuYy0+aHdfcHBbaV0pIHsKKwkJCURQVV9FUlJPUl9FTkMoZHB1X2VuYywKKwkJCQkibm8g
cHAgYmxvY2sgYXNzaWduZWQgYXQgaWR4OiAlZFxuIiwgaSk7CisJCQlnb3RvIGVycm9yOworCQl9
CiAKLQkJCWlmICghaHdfY3RsW2ldKSB7Ci0JCQkJRFBVX0VSUk9SX0VOQyhkcHVfZW5jLCAibm8g
Y3RsIGJsb2NrIGFzc2lnbmVkIgotCQkJCQkgICAgICJhdCBpZHg6ICVkXG4iLCBpKTsKLQkJCQln
b3RvIGVycm9yOwotCQkJfQorCQlpZiAoIWh3X2N0bFtpXSkgeworCQkJRFBVX0VSUk9SX0VOQyhk
cHVfZW5jLAorCQkJCSJubyBjdGwgYmxvY2sgYXNzaWduZWQgYXQgaWR4OiAlZFxuIiwgaSk7CisJ
CQlnb3RvIGVycm9yOworCQl9CiAKLQkJCXBoeXMtPmh3X3BwID0gZHB1X2VuYy0+aHdfcHBbaV07
Ci0JCQlwaHlzLT5od19jdGwgPSBod19jdGxbaV07CisJCXBoeXMtPmh3X3BwID0gZHB1X2VuYy0+
aHdfcHBbaV07CisJCXBoeXMtPmh3X2N0bCA9IGh3X2N0bFtpXTsKIAotCQkJZHB1X3JtX2luaXRf
aHdfaXRlcigmaHdfaXRlciwgZHJtX2VuYy0+YmFzZS5pZCwKLQkJCQkJICAgIERQVV9IV19CTEtf
SU5URik7Ci0JCQlmb3IgKGogPSAwOyBqIDwgTUFYX0NIQU5ORUxTX1BFUl9FTkM7IGorKykgewot
CQkJCXN0cnVjdCBkcHVfaHdfaW50ZiAqaHdfaW50ZjsKKwkJZHB1X3JtX2luaXRfaHdfaXRlcigm
aHdfaXRlciwgZHJtX2VuYy0+YmFzZS5pZCwKKwkJCQkgICAgRFBVX0hXX0JMS19JTlRGKTsKKwkJ
Zm9yIChqID0gMDsgaiA8IE1BWF9DSEFOTkVMU19QRVJfRU5DOyBqKyspIHsKKwkJCXN0cnVjdCBk
cHVfaHdfaW50ZiAqaHdfaW50ZjsKIAotCQkJCWlmICghZHB1X3JtX2dldF9odygmZHB1X2ttcy0+
cm0sICZod19pdGVyKSkKLQkJCQkJYnJlYWs7CisJCQlpZiAoIWRwdV9ybV9nZXRfaHcoJmRwdV9r
bXMtPnJtLCAmaHdfaXRlcikpCisJCQkJYnJlYWs7CiAKLQkJCQlod19pbnRmID0gKHN0cnVjdCBk
cHVfaHdfaW50ZiAqKWh3X2l0ZXIuaHc7Ci0JCQkJaWYgKGh3X2ludGYtPmlkeCA9PSBwaHlzLT5p
bnRmX2lkeCkKLQkJCQkJcGh5cy0+aHdfaW50ZiA9IGh3X2ludGY7Ci0JCQl9CisJCQlod19pbnRm
ID0gKHN0cnVjdCBkcHVfaHdfaW50ZiAqKWh3X2l0ZXIuaHc7CisJCQlpZiAoaHdfaW50Zi0+aWR4
ID09IHBoeXMtPmludGZfaWR4KQorCQkJCXBoeXMtPmh3X2ludGYgPSBod19pbnRmOworCQl9CiAK
LQkJCWlmICghcGh5cy0+aHdfaW50ZikgewotCQkJCURQVV9FUlJPUl9FTkMoZHB1X2VuYywKLQkJ
CQkJICAgICAgIm5vIGludGYgYmxvY2sgYXNzaWduZWQgYXQgaWR4OiAlZFxuIiwKLQkJCQkJICAg
ICAgaSk7CisJCWlmICghcGh5cy0+aHdfaW50ZikgeworCQkJRFBVX0VSUk9SX0VOQyhkcHVfZW5j
LAorCQkJCSAgICAgICJubyBpbnRmIGJsb2NrIGFzc2lnbmVkIGF0IGlkeDogJWRcbiIsIGkpOwog
CQkJCWdvdG8gZXJyb3I7Ci0JCQl9Ci0KLQkJCXBoeXMtPmNvbm5lY3RvciA9IGNvbm4tPnN0YXRl
LT5jb25uZWN0b3I7Ci0JCQlpZiAocGh5cy0+b3BzLm1vZGVfc2V0KQotCQkJCXBoeXMtPm9wcy5t
b2RlX3NldChwaHlzLCBtb2RlLCBhZGpfbW9kZSk7CiAJCX0KKworCQlwaHlzLT5jb25uZWN0b3Ig
PSBjb25uLT5zdGF0ZS0+Y29ubmVjdG9yOworCQlpZiAocGh5cy0+b3BzLm1vZGVfc2V0KQorCQkJ
cGh5cy0+b3BzLm1vZGVfc2V0KHBoeXMsIG1vZGUsIGFkal9tb2RlKTsKIAl9CiAKIAlkcHVfZW5j
LT5tb2RlX3NldF9jb21wbGV0ZSA9IHRydWU7CkBAIC0xMjAzLDcgKzExOTEsNyBAQCBzdGF0aWMg
dm9pZCBkcHVfZW5jb2Rlcl92aXJ0X2Rpc2FibGUoc3RydWN0IGRybV9lbmNvZGVyICpkcm1fZW5j
KQogCWZvciAoaSA9IDA7IGkgPCBkcHVfZW5jLT5udW1fcGh5c19lbmNzOyBpKyspIHsKIAkJc3Ry
dWN0IGRwdV9lbmNvZGVyX3BoeXMgKnBoeXMgPSBkcHVfZW5jLT5waHlzX2VuY3NbaV07CiAKLQkJ
aWYgKHBoeXMgJiYgcGh5cy0+b3BzLmRpc2FibGUpCisJCWlmIChwaHlzLT5vcHMuZGlzYWJsZSkK
IAkJCXBoeXMtPm9wcy5kaXNhYmxlKHBoeXMpOwogCX0KIApAQCAtMTIxNiw4ICsxMjA0LDcgQEAg
c3RhdGljIHZvaWQgZHB1X2VuY29kZXJfdmlydF9kaXNhYmxlKHN0cnVjdCBkcm1fZW5jb2RlciAq
ZHJtX2VuYykKIAlkcHVfZW5jb2Rlcl9yZXNvdXJjZV9jb250cm9sKGRybV9lbmMsIERQVV9FTkNf
UkNfRVZFTlRfU1RPUCk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgZHB1X2VuYy0+bnVtX3BoeXNfZW5j
czsgaSsrKSB7Ci0JCWlmIChkcHVfZW5jLT5waHlzX2VuY3NbaV0pCi0JCQlkcHVfZW5jLT5waHlz
X2VuY3NbaV0tPmNvbm5lY3RvciA9IE5VTEw7CisJCWRwdV9lbmMtPnBoeXNfZW5jc1tpXS0+Y29u
bmVjdG9yID0gTlVMTDsKIAl9CiAKIAlEUFVfREVCVUdfRU5DKGRwdV9lbmMsICJlbmNvZGVyIGRp
c2FibGVkXG4iKTsKQEAgLTEzMDcsNyArMTI5NCw3IEBAIHZvaWQgZHB1X2VuY29kZXJfdG9nZ2xl
X3ZibGFua19mb3JfY3J0YyhzdHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMsCiAJZm9yIChpID0g
MDsgaSA8IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlzdHJ1Y3QgZHB1X2VuY29k
ZXJfcGh5cyAqcGh5cyA9IGRwdV9lbmMtPnBoeXNfZW5jc1tpXTsKIAotCQlpZiAocGh5cyAmJiBw
aHlzLT5vcHMuY29udHJvbF92YmxhbmtfaXJxKQorCQlpZiAocGh5cy0+b3BzLmNvbnRyb2xfdmJs
YW5rX2lycSkKIAkJCXBoeXMtPm9wcy5jb250cm9sX3ZibGFua19pcnEocGh5cywgZW5hYmxlKTsK
IAl9CiB9CkBAIC0xNDYzLDExICsxNDUwLDYgQEAgdm9pZCBkcHVfZW5jb2Rlcl9oZWxwZXJfdHJp
Z2dlcl9zdGFydChzdHJ1Y3QgZHB1X2VuY29kZXJfcGh5cyAqcGh5c19lbmMpCiB7CiAJc3RydWN0
IGRwdV9od19jdGwgKmN0bDsKIAotCWlmICghcGh5c19lbmMpIHsKLQkJRFBVX0VSUk9SKCJpbnZh
bGlkIGVuY29kZXJcbiIpOwotCQlyZXR1cm47Ci0JfQotCiAJY3RsID0gcGh5c19lbmMtPmh3X2N0
bDsKIAlpZiAoY3RsLT5vcHMudHJpZ2dlcl9zdGFydCkgewogCQljdGwtPm9wcy50cmlnZ2VyX3N0
YXJ0KGN0bCk7CkBAIC0xNTA2LDEwICsxNDg4LDYgQEAgc3RhdGljIHZvaWQgZHB1X2VuY29kZXJf
aGVscGVyX2h3X3Jlc2V0KHN0cnVjdCBkcHVfZW5jb2Rlcl9waHlzICpwaHlzX2VuYykKIAlzdHJ1
Y3QgZHB1X2h3X2N0bCAqY3RsOwogCWludCByYzsKIAotCWlmICghcGh5c19lbmMpIHsKLQkJRFBV
X0VSUk9SKCJpbnZhbGlkIGVuY29kZXJcbiIpOwotCQlyZXR1cm47Ci0JfQogCWRwdV9lbmMgPSB0
b19kcHVfZW5jb2Rlcl92aXJ0KHBoeXNfZW5jLT5wYXJlbnQpOwogCWN0bCA9IHBoeXNfZW5jLT5o
d19jdGw7CiAKQEAgLTE1NTAsNyArMTUyOCw3IEBAIHN0YXRpYyB2b2lkIF9kcHVfZW5jb2Rlcl9r
aWNrb2ZmX3BoeXMoc3RydWN0IGRwdV9lbmNvZGVyX3ZpcnQgKmRwdV9lbmMpCiAJZm9yIChpID0g
MDsgaSA8IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlzdHJ1Y3QgZHB1X2VuY29k
ZXJfcGh5cyAqcGh5cyA9IGRwdV9lbmMtPnBoeXNfZW5jc1tpXTsKIAotCQlpZiAoIXBoeXMgfHwg
cGh5cy0+ZW5hYmxlX3N0YXRlID09IERQVV9FTkNfRElTQUJMRUQpCisJCWlmIChwaHlzLT5lbmFi
bGVfc3RhdGUgPT0gRFBVX0VOQ19ESVNBQkxFRCkKIAkJCWNvbnRpbnVlOwogCiAJCWN0bCA9IHBo
eXMtPmh3X2N0bDsKQEAgLTE2MDEsMTcgKzE1NzksMTUgQEAgdm9pZCBkcHVfZW5jb2Rlcl90cmln
Z2VyX2tpY2tvZmZfcGVuZGluZyhzdHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMpCiAJZm9yIChp
ID0gMDsgaSA8IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlwaHlzID0gZHB1X2Vu
Yy0+cGh5c19lbmNzW2ldOwogCi0JCWlmIChwaHlzKSB7Ci0JCQljdGwgPSBwaHlzLT5od19jdGw7
Ci0JCQlpZiAoY3RsLT5vcHMuY2xlYXJfcGVuZGluZ19mbHVzaCkKLQkJCQljdGwtPm9wcy5jbGVh
cl9wZW5kaW5nX2ZsdXNoKGN0bCk7CisJCWN0bCA9IHBoeXMtPmh3X2N0bDsKKwkJaWYgKGN0bC0+
b3BzLmNsZWFyX3BlbmRpbmdfZmx1c2gpCisJCQljdGwtPm9wcy5jbGVhcl9wZW5kaW5nX2ZsdXNo
KGN0bCk7CiAKLQkJCS8qIHVwZGF0ZSBvbmx5IGZvciBjb21tYW5kIG1vZGUgcHJpbWFyeSBjdGwg
Ki8KLQkJCWlmICgocGh5cyA9PSBkcHVfZW5jLT5jdXJfbWFzdGVyKSAmJgotCQkJICAgKGRpc3Bf
aW5mby0+Y2FwYWJpbGl0aWVzICYgTVNNX0RJU1BMQVlfQ0FQX0NNRF9NT0RFKQotCQkJICAgICYm
IGN0bC0+b3BzLnRyaWdnZXJfcGVuZGluZykKLQkJCQljdGwtPm9wcy50cmlnZ2VyX3BlbmRpbmco
Y3RsKTsKLQkJfQorCQkvKiB1cGRhdGUgb25seSBmb3IgY29tbWFuZCBtb2RlIHByaW1hcnkgY3Rs
ICovCisJCWlmICgocGh5cyA9PSBkcHVfZW5jLT5jdXJfbWFzdGVyKSAmJgorCQkgICAoZGlzcF9p
bmZvLT5jYXBhYmlsaXRpZXMgJiBNU01fRElTUExBWV9DQVBfQ01EX01PREUpCisJCSAgICAmJiBj
dGwtPm9wcy50cmlnZ2VyX3BlbmRpbmcpCisJCQljdGwtPm9wcy50cmlnZ2VyX3BlbmRpbmcoY3Rs
KTsKIAl9CiB9CiAKQEAgLTE3NzEsMTIgKzE3NDcsMTAgQEAgdm9pZCBkcHVfZW5jb2Rlcl9wcmVw
YXJlX2Zvcl9raWNrb2ZmKHN0cnVjdCBkcm1fZW5jb2RlciAqZHJtX2VuYykKIAlEUFVfQVRSQUNF
X0JFR0lOKCJlbmNfcHJlcGFyZV9mb3Jfa2lja29mZiIpOwogCWZvciAoaSA9IDA7IGkgPCBkcHVf
ZW5jLT5udW1fcGh5c19lbmNzOyBpKyspIHsKIAkJcGh5cyA9IGRwdV9lbmMtPnBoeXNfZW5jc1tp
XTsKLQkJaWYgKHBoeXMpIHsKLQkJCWlmIChwaHlzLT5vcHMucHJlcGFyZV9mb3Jfa2lja29mZikK
LQkJCQlwaHlzLT5vcHMucHJlcGFyZV9mb3Jfa2lja29mZihwaHlzKTsKLQkJCWlmIChwaHlzLT5l
bmFibGVfc3RhdGUgPT0gRFBVX0VOQ19FUlJfTkVFRFNfSFdfUkVTRVQpCi0JCQkJbmVlZHNfaHdf
cmVzZXQgPSB0cnVlOwotCQl9CisJCWlmIChwaHlzLT5vcHMucHJlcGFyZV9mb3Jfa2lja29mZikK
KwkJCXBoeXMtPm9wcy5wcmVwYXJlX2Zvcl9raWNrb2ZmKHBoeXMpOworCQlpZiAocGh5cy0+ZW5h
YmxlX3N0YXRlID09IERQVV9FTkNfRVJSX05FRURTX0hXX1JFU0VUKQorCQkJbmVlZHNfaHdfcmVz
ZXQgPSB0cnVlOwogCX0KIAlEUFVfQVRSQUNFX0VORCgiZW5jX3ByZXBhcmVfZm9yX2tpY2tvZmYi
KTsKIApAQCAtMTgxNyw3ICsxNzkxLDcgQEAgdm9pZCBkcHVfZW5jb2Rlcl9raWNrb2ZmKHN0cnVj
dCBkcm1fZW5jb2RlciAqZHJtX2VuYykKIAkvKiBhbGxvdyBwaHlzIGVuY3MgdG8gaGFuZGxlIGFu
eSBwb3N0LWtpY2tvZmYgYnVzaW5lc3MgKi8KIAlmb3IgKGkgPSAwOyBpIDwgZHB1X2VuYy0+bnVt
X3BoeXNfZW5jczsgaSsrKSB7CiAJCXBoeXMgPSBkcHVfZW5jLT5waHlzX2VuY3NbaV07Ci0JCWlm
IChwaHlzICYmIHBoeXMtPm9wcy5oYW5kbGVfcG9zdF9raWNrb2ZmKQorCQlpZiAocGh5cy0+b3Bz
LmhhbmRsZV9wb3N0X2tpY2tvZmYpCiAJCQlwaHlzLT5vcHMuaGFuZGxlX3Bvc3Rfa2lja29mZihw
aHlzKTsKIAl9CiAKQEAgLTE4NDYsNyArMTgyMCw3IEBAIHZvaWQgZHB1X2VuY29kZXJfcHJlcGFy
ZV9jb21taXQoc3RydWN0IGRybV9lbmNvZGVyICpkcm1fZW5jKQogCiAJZm9yIChpID0gMDsgaSA8
IGRwdV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlwaHlzID0gZHB1X2VuYy0+cGh5c19l
bmNzW2ldOwotCQlpZiAocGh5cyAmJiBwaHlzLT5vcHMucHJlcGFyZV9jb21taXQpCisJCWlmIChw
aHlzLT5vcHMucHJlcGFyZV9jb21taXQpCiAJCQlwaHlzLT5vcHMucHJlcGFyZV9jb21taXQocGh5
cyk7CiAJfQogfQpAQCAtMTg2MSw5ICsxODM1LDYgQEAgc3RhdGljIGludCBfZHB1X2VuY29kZXJf
c3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxlICpzLCB2b2lkICpkYXRhKQogCWZvciAoaSA9IDA7
IGkgPCBkcHVfZW5jLT5udW1fcGh5c19lbmNzOyBpKyspIHsKIAkJc3RydWN0IGRwdV9lbmNvZGVy
X3BoeXMgKnBoeXMgPSBkcHVfZW5jLT5waHlzX2VuY3NbaV07CiAKLQkJaWYgKCFwaHlzKQotCQkJ
Y29udGludWU7Ci0KIAkJc2VxX3ByaW50ZihzLCAiaW50ZjolZCAgICB2c3luYzolOGQgICAgIHVu
ZGVycnVuOiU4ZCAgICAiLAogCQkJCXBoeXMtPmludGZfaWR4IC0gSU5URl8wLAogCQkJCWF0b21p
Y19yZWFkKCZwaHlzLT52c3luY19jbnQpLApAQCAtMTkyMiw4ICsxODkzLDcgQEAgc3RhdGljIGlu
dCBfZHB1X2VuY29kZXJfaW5pdF9kZWJ1Z2ZzKHN0cnVjdCBkcm1fZW5jb2RlciAqZHJtX2VuYykK
IAkJZHB1X2VuYy0+ZGVidWdmc19yb290LCBkcHVfZW5jLCAmZGVidWdmc19zdGF0dXNfZm9wcyk7
CiAKIAlmb3IgKGkgPSAwOyBpIDwgZHB1X2VuYy0+bnVtX3BoeXNfZW5jczsgaSsrKQotCQlpZiAo
ZHB1X2VuYy0+cGh5c19lbmNzW2ldICYmCi0JCQkJZHB1X2VuYy0+cGh5c19lbmNzW2ldLT5vcHMu
bGF0ZV9yZWdpc3RlcikKKwkJaWYgKGRwdV9lbmMtPnBoeXNfZW5jc1tpXS0+b3BzLmxhdGVfcmVn
aXN0ZXIpCiAJCQlkcHVfZW5jLT5waHlzX2VuY3NbaV0tPm9wcy5sYXRlX3JlZ2lzdGVyKAogCQkJ
CQlkcHVfZW5jLT5waHlzX2VuY3NbaV0sCiAJCQkJCWRwdV9lbmMtPmRlYnVnZnNfcm9vdCk7CkBA
IC0yMDkyLDExICsyMDYyLDggQEAgc3RhdGljIGludCBkcHVfZW5jb2Rlcl9zZXR1cF9kaXNwbGF5
KHN0cnVjdCBkcHVfZW5jb2Rlcl92aXJ0ICpkcHVfZW5jLAogCiAJZm9yIChpID0gMDsgaSA8IGRw
dV9lbmMtPm51bV9waHlzX2VuY3M7IGkrKykgewogCQlzdHJ1Y3QgZHB1X2VuY29kZXJfcGh5cyAq
cGh5cyA9IGRwdV9lbmMtPnBoeXNfZW5jc1tpXTsKLQotCQlpZiAocGh5cykgewotCQkJYXRvbWlj
X3NldCgmcGh5cy0+dnN5bmNfY250LCAwKTsKLQkJCWF0b21pY19zZXQoJnBoeXMtPnVuZGVycnVu
X2NudCwgMCk7Ci0JCX0KKwkJYXRvbWljX3NldCgmcGh5cy0+dnN5bmNfY250LCAwKTsKKwkJYXRv
bWljX3NldCgmcGh5cy0+dW5kZXJydW5fY250LCAwKTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZkcHVf
ZW5jLT5lbmNfbG9jayk7CiAKQEAgLTIyMzgsOCArMjIwNSw2IEBAIGludCBkcHVfZW5jb2Rlcl93
YWl0X2Zvcl9ldmVudChzdHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMsCiAKIAlmb3IgKGkgPSAw
OyBpIDwgZHB1X2VuYy0+bnVtX3BoeXNfZW5jczsgaSsrKSB7CiAJCXN0cnVjdCBkcHVfZW5jb2Rl
cl9waHlzICpwaHlzID0gZHB1X2VuYy0+cGh5c19lbmNzW2ldOwotCQlpZiAoIXBoeXMpCi0JCQlj
b250aW51ZTsKIAogCQlzd2l0Y2ggKGV2ZW50KSB7CiAJCWNhc2UgTVNNX0VOQ19DT01NSVRfRE9O
RToKQEAgLTIyNzIsNyArMjIzNyw2IEBAIGludCBkcHVfZW5jb2Rlcl93YWl0X2Zvcl9ldmVudChz
dHJ1Y3QgZHJtX2VuY29kZXIgKmRybV9lbmMsCiBlbnVtIGRwdV9pbnRmX21vZGUgZHB1X2VuY29k
ZXJfZ2V0X2ludGZfbW9kZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiB7CiAJc3RydWN0
IGRwdV9lbmNvZGVyX3ZpcnQgKmRwdV9lbmMgPSBOVUxMOwotCWludCBpOwogCiAJaWYgKCFlbmNv
ZGVyKSB7CiAJCURQVV9FUlJPUigiaW52YWxpZCBlbmNvZGVyXG4iKTsKQEAgLTIyODMsMTIgKzIy
NDcsOCBAQCBlbnVtIGRwdV9pbnRmX21vZGUgZHB1X2VuY29kZXJfZ2V0X2ludGZfbW9kZShzdHJ1
Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJaWYgKGRwdV9lbmMtPmN1cl9tYXN0ZXIpCiAJCXJl
dHVybiBkcHVfZW5jLT5jdXJfbWFzdGVyLT5pbnRmX21vZGU7CiAKLQlmb3IgKGkgPSAwOyBpIDwg
ZHB1X2VuYy0+bnVtX3BoeXNfZW5jczsgaSsrKSB7Ci0JCXN0cnVjdCBkcHVfZW5jb2Rlcl9waHlz
ICpwaHlzID0gZHB1X2VuYy0+cGh5c19lbmNzW2ldOwotCi0JCWlmIChwaHlzKQotCQkJcmV0dXJu
IHBoeXMtPmludGZfbW9kZTsKLQl9CisJaWYgKGRwdV9lbmMtPm51bV9waHlzX2VuY3MpCisJCXJl
dHVybiBkcHVfZW5jLT5waHlzX2VuY3NbMF0tPmludGZfbW9kZTsKIAogCXJldHVybiBJTlRGX01P
REVfTk9ORTsKIH0KLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vZHJpLWRldmVs
