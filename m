Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8FB58F2933
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 09:34:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 647E96EEEE;
	Thu,  7 Nov 2019 08:34:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 56BEF6EEEE
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 08:34:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id ED5EFB17E;
 Thu,  7 Nov 2019 08:34:07 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v2 6/9] drm/ast: Add primary plane
Date: Thu,  7 Nov 2019 09:34:01 +0100
Message-Id: <20191107083404.6852-7-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191107083404.6852-1-tzimmermann@suse.de>
References: <20191107083404.6852-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TGlrZSB0aGUgb3JpZ2luYWwgbW9kZS1zZXR0aW5nIGNvZGUsIHRoZSBwcmltYXJ5IHBsYW5lIHN1
cHBvcnRzIFhSR0I4ODgsClJHQjU2NSBhbmQgQzguIFRoZSBwbGFuZSBpdHNlbGYgb25seSBwaW5z
IEJPcyBhbmQgc2V0cyB0aGUgYmFzZSBhZGRyZXNzCmFuZCBzY2FubGluZSBvZmZzZXQuIFRoZSBt
b2RlLXNldHRpbmcgY29kZSB3aWxsIGJlIGxvY2F0ZWQgaW4gdGhlIENSVEMncwphdG9taWMgaGVs
cGVycy4KCnYyOgoJKiBkb24ndCBzZXQgcGxhbmUgY2FsbC1iYWNrIGZ1bmN0aW9ucyB0byBOVUxM
IGV4cGxpY2l0bHkKCSogZGVmaW5lIHBsYW5lIGZvcm1hdCBhcnJheSBpbiBnbG9iYWwgc2NvcGUK
ClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Rydi5oICB8ICAyICsKIGRyaXZlcnMvZ3B1L2Ry
bS9hc3QvYXN0X21vZGUuYyB8IDg5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0K
IDIgZmlsZXMgY2hhbmdlZCwgODkgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9h
c3QvYXN0X2Rydi5oCmluZGV4IGY0NDE1MGZmNTQ4My4uMTM1NjA2MjJmMjJhIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0
L2FzdF9kcnYuaApAQCAtMTIxLDYgKzEyMSw4IEBAIHN0cnVjdCBhc3RfcHJpdmF0ZSB7CiAJCXVu
c2lnbmVkIGludCBuZXh0X2luZGV4OwogCX0gY3Vyc29yOwogCisJc3RydWN0IGRybV9wbGFuZSBw
cmltYXJ5X3BsYW5lOworCiAJYm9vbCBzdXBwb3J0X3dpZGVfc2NyZWVuOwogCWVudW0gewogCQlh
c3RfdXNlX3AyYSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyBi
L2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwppbmRleCBjNGM5ZmNhMGYwMGMuLmRjZDYz
NTExNTI5NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwpAQCAtMzEsNiArMzEsOCBAQAogI2luY2x1
ZGUgPGxpbnV4L2V4cG9ydC5oPgogI2luY2x1ZGUgPGxpbnV4L3BjaS5oPgogCisjaW5jbHVkZSA8
ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfc3RhdGVf
aGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRjLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9j
cnRjX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CkBAIC01MSw2ICs1Myw3
IEBAIHN0YXRpYyBpbnQgYXN0X2N1cnNvcl9zZXQoc3RydWN0IGRybV9jcnRjICpjcnRjLAogc3Rh
dGljIGludCBhc3RfY3Vyc29yX21vdmUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJICAgaW50
IHgsIGludCB5KTsKIAorCiBzdGF0aWMgaW5saW5lIHZvaWQgYXN0X2xvYWRfcGFsZXR0ZV9pbmRl
eChzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCwKIAkJCQkgICAgIHU4IGluZGV4LCB1OCByZWQsIHU4
IGdyZWVuLAogCQkJCSAgICAgdTggYmx1ZSkKQEAgLTUzOCw2ICs1NDEsNjIgQEAgc3RhdGljIHZv
aWQgYXN0X3NldF9zdGFydF9hZGRyZXNzX2NydDEoc3RydWN0IGRybV9jcnRjICpjcnRjLCB1bnNp
Z25lZCBvZmZzZXQpCiAKIH0KIAorLyoKKyAqIFByaW1hcnkgcGxhbmUKKyAqLworCitzdGF0aWMg
Y29uc3QgdWludDMyX3QgYXN0X3ByaW1hcnlfcGxhbmVfZm9ybWF0c1tdID0geworCURSTV9GT1JN
QVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1BVF9DOCwKK307CisK
K2ludCBhc3RfcHJpbWFyeV9wbGFuZV9oZWxwZXJfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAorCQkJCQkgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQoreworCXJl
dHVybiAwOworfQorCit2b2lkIGFzdF9wcmltYXJ5X3BsYW5lX2hlbHBlcl9hdG9taWNfdXBkYXRl
KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCQkgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0
ZSAqb2xkX3N0YXRlKQoreworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlID0gcGxhbmUt
PnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHN0YXRlLT5jcnRjOworCXN0cnVjdCBk
cm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm87CisJczY0IGdwdV9hZGRyOworCisJaWYgKCFjcnRjIHx8
ICFzdGF0ZS0+ZmIpCisJCXJldHVybjsKKworCWdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oc3Rh
dGUtPmZiLT5vYmpbMF0pOworCWdwdV9hZGRyID0gZHJtX2dlbV92cmFtX29mZnNldChnYm8pOwor
CWlmIChXQVJOX09OX09OQ0UoZ3B1X2FkZHIgPCAwKSkKKwkJcmV0dXJuOyAvKiBCdWc6IHdlIGRp
ZG4ndCBwaW4gdGhlIEJPIHRvIFZSQU0gaW4gcHJlcGFyZV9mYi4gKi8KKworCWFzdF9zZXRfb2Zm
c2V0X3JlZyhjcnRjKTsKKwlhc3Rfc2V0X3N0YXJ0X2FkZHJlc3NfY3J0MShjcnRjLCAodTMyKWdw
dV9hZGRyKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNz
IGFzdF9wcmltYXJ5X3BsYW5lX2hlbHBlcl9mdW5jcyA9IHsKKwkucHJlcGFyZV9mYiA9IGRybV9n
ZW1fdnJhbV9wbGFuZV9oZWxwZXJfcHJlcGFyZV9mYiwKKwkuY2xlYW51cF9mYiA9IGRybV9nZW1f
dnJhbV9wbGFuZV9oZWxwZXJfY2xlYW51cF9mYiwKKwkuYXRvbWljX2NoZWNrID0gYXN0X3ByaW1h
cnlfcGxhbmVfaGVscGVyX2F0b21pY19jaGVjaywKKwkuYXRvbWljX3VwZGF0ZSA9IGFzdF9wcmlt
YXJ5X3BsYW5lX2hlbHBlcl9hdG9taWNfdXBkYXRlLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fcGxhbmVfZnVuY3MgYXN0X3ByaW1hcnlfcGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9w
bGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKKwkuZGlzYWJsZV9wbGFuZSA9
IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCisJLmRlc3Ryb3kgPSBkcm1fcGxhbmVf
Y2xlYW51cCwKKwkucmVzZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9yZXNldCwKKwkuYXRv
bWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX3BsYW5lX2R1cGxpY2F0ZV9z
dGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9k
ZXN0cm95X3N0YXRlLAorfTsKKworLyoKKyAqIENSVEMKKyAqLworCiBzdGF0aWMgdm9pZCBhc3Rf
Y3J0Y19kcG1zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgaW50IG1vZGUpCiB7CiAJc3RydWN0IGFz
dF9wcml2YXRlICphc3QgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwpAQCAtNzExLDE2ICs3NzAs
MjYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBhc3RfY3J0Y19mdW5jcyA9
IHsKIAogc3RhdGljIGludCBhc3RfY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7
CisJc3RydWN0IGFzdF9wcml2YXRlICphc3QgPSBkZXYtPmRldl9wcml2YXRlOwogCXN0cnVjdCBh
c3RfY3J0YyAqY3J0YzsKKwlpbnQgcmV0OwogCiAJY3J0YyA9IGt6YWxsb2Moc2l6ZW9mKHN0cnVj
dCBhc3RfY3J0YyksIEdGUF9LRVJORUwpOwogCWlmICghY3J0YykKIAkJcmV0dXJuIC1FTk9NRU07
CiAKLQlkcm1fY3J0Y19pbml0KGRldiwgJmNydGMtPmJhc2UsICZhc3RfY3J0Y19mdW5jcyk7CisJ
cmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3BsYW5lcyhkZXYsICZjcnRjLT5iYXNlLCAmYXN0LT5w
cmltYXJ5X3BsYW5lLAorCQkJCQlOVUxMLCAmYXN0X2NydGNfZnVuY3MsIE5VTEwpOworCWlmIChy
ZXQpCisJCWdvdG8gZXJyX2tmcmVlOworCiAJZHJtX21vZGVfY3J0Y19zZXRfZ2FtbWFfc2l6ZSgm
Y3J0Yy0+YmFzZSwgMjU2KTsKIAlkcm1fY3J0Y19oZWxwZXJfYWRkKCZjcnRjLT5iYXNlLCAmYXN0
X2NydGNfaGVscGVyX2Z1bmNzKTsKIAlyZXR1cm4gMDsKKworZXJyX2tmcmVlOgorCWtmcmVlKGNy
dGMpOworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lkIGFzdF9lbmNvZGVyX2Rlc3Ryb3ko
c3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQpAQCAtNzU0LDcgKzgyMyw2IEBAIHN0YXRpYyB2
b2lkIGFzdF9lbmNvZGVyX2NvbW1pdChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAKIH0K
IAotCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2hlbHBlcl9mdW5jcyBhc3RfZW5j
X2hlbHBlcl9mdW5jcyA9IHsKIAkuZHBtcyA9IGFzdF9lbmNvZGVyX2RwbXMsCiAJLnByZXBhcmUg
PSBhc3RfZW5jb2Rlcl9wcmVwYXJlLApAQCAtOTc2LDEwICsxMDQ0LDI3IEBAIHN0YXRpYyB2b2lk
IGFzdF9jdXJzb3JfZmluaShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiBpbnQgYXN0X21vZGVf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogeworCXN0cnVjdCBhc3RfcHJpdmF0ZSAqYXN0
ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwlpbnQgcmV0OworCisJbWVtc2V0KCZhc3QtPnByaW1hcnlf
cGxhbmUsIDAsIHNpemVvZihhc3QtPnByaW1hcnlfcGxhbmUpKTsKKwlyZXQgPSBkcm1fdW5pdmVy
c2FsX3BsYW5lX2luaXQoZGV2LCAmYXN0LT5wcmltYXJ5X3BsYW5lLCAweDAxLAorCQkJCSAgICAg
ICAmYXN0X3ByaW1hcnlfcGxhbmVfZnVuY3MsCisJCQkJICAgICAgIGFzdF9wcmltYXJ5X3BsYW5l
X2Zvcm1hdHMsCisJCQkJICAgICAgIEFSUkFZX1NJWkUoYXN0X3ByaW1hcnlfcGxhbmVfZm9ybWF0
cyksCisJCQkJICAgICAgIE5VTEwsIERSTV9QTEFORV9UWVBFX1BSSU1BUlksIE5VTEwpOworCWlm
IChyZXQpIHsKKwkJRFJNX0VSUk9SKCJhc3Q6IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCgpIGZh
aWxlZDogJWRcbiIsIHJldCk7CisJCXJldHVybiByZXQ7CisJfQorCWRybV9wbGFuZV9oZWxwZXJf
YWRkKCZhc3QtPnByaW1hcnlfcGxhbmUsCisJCQkgICAgICZhc3RfcHJpbWFyeV9wbGFuZV9oZWxw
ZXJfZnVuY3MpOworCiAJYXN0X2N1cnNvcl9pbml0KGRldik7CiAJYXN0X2NydGNfaW5pdChkZXYp
OwogCWFzdF9lbmNvZGVyX2luaXQoZGV2KTsKIAlhc3RfY29ubmVjdG9yX2luaXQoZGV2KTsKKwog
CXJldHVybiAwOwogfQogCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
