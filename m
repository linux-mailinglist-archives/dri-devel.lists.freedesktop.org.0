Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9DD81325BB
	for <lists+dri-devel@lfdr.de>; Mon,  3 Jun 2019 02:40:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4A81489182;
	Mon,  3 Jun 2019 00:40:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x842.google.com (mail-qt1-x842.google.com
 [IPv6:2607:f8b0:4864:20::842])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6A65897D4
 for <dri-devel@lists.freedesktop.org>; Mon,  3 Jun 2019 00:40:30 +0000 (UTC)
Received: by mail-qt1-x842.google.com with SMTP id z24so375433qtj.10
 for <dri-devel@lists.freedesktop.org>; Sun, 02 Jun 2019 17:40:30 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:from:to:cc:subject:date:message-id
 :in-reply-to:references:mime-version:content-transfer-encoding;
 bh=YzAv3mAvLxprkb9QX0h51MolPj18jWcuQkJBtxJRZnQ=;
 b=tu8Xe0pT7u3PVVug85Avzqfx8FbG7a8dK7eEKJEXEFGs8qFGCm/gfS6Fia4lUXrTd0
 MXV/I3WFV8Z0BtSJhzI5rufHRoec6i8I32gih/tOmPEa5kCC4aUzKJ8gOmb4Mnch54xk
 u/hXFh4m8vRcA5R/Ish3xPPw6M73UqvgdpvRRBgxxopPhF+u42RdO0uI8hhd/j2UMt9F
 7+i1/3GDvmJ3O/SuXTq6c0YREeieP6Qs34tZM70o4i0udGMsNpjt4lpsEHLuw9MLccxx
 Ip0fZ8x/uvZum44suMu3vQ22PMIhGcVeJlA6I4tvbSDDtYVtDtZUW4Gyf7dpcksQErX4
 GJwg==
X-Gm-Message-State: APjAAAWmvJbP+gemffG5e5/SaQVT5bYaeJnVoptZMta6obyech7OL+fv
 sKQ7WUkDKolUHs63RW9YOa7n5ov/oK4=
X-Google-Smtp-Source: APXvYqyeWm4Gpbuo44KEHTJvexaqU9256bfTuIHEHcJpDmaEN4aGZMqfItHaOzCQzG/yGFHe16z4Yw==
X-Received: by 2002:ac8:5315:: with SMTP id t21mr10833470qtn.229.1559522429547; 
 Sun, 02 Jun 2019 17:40:29 -0700 (PDT)
Received: from athos.fios-router.home
 (pool-173-68-20-215.nycmny.fios.verizon.net. [173.68.20.215])
 by smtp.gmail.com with ESMTPSA id t8sm1432609qtc.80.2019.06.02.17.40.28
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Sun, 02 Jun 2019 17:40:28 -0700 (PDT)
From: Ilia Mirkin <imirkin@alum.mit.edu>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH libdrm 04/10] util: add fp16 format support
Date: Sun,  2 Jun 2019 20:40:12 -0400
Message-Id: <20190603004017.7114-5-imirkin@alum.mit.edu>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190603004017.7114-1-imirkin@alum.mit.edu>
References: <20190603004017.7114-1-imirkin@alum.mit.edu>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=sender:from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=YzAv3mAvLxprkb9QX0h51MolPj18jWcuQkJBtxJRZnQ=;
 b=GVkE/fs41IFOjtCNxmfxz7s+LySQZ7q33WVQGRav66h63/m8MREtQzfTr1AMZKf3AX
 uMHmOCR19wsKKTZgc5Gmn45kLhtyJDLoLUCn5gbTUaai90aP6MPjo232f94Wxp1/4f7s
 W81PaBIkVydUPs7os2PKR8MQG2A85xfadFvS7EfORC5nIRL/BE+eAph4ctemA22noXDB
 rYZvbicnPnz1/8njb1TmRevhxZNgidSCCOUhiglD7iAewLkdS+uZJIm5nqYfEuQKcZSE
 1FTwNSEpUsC5mR70KSuFXT537bKlu7RJ4n+cYgpOqMWxHOFd8xYRJXZ9I6d7DcMJnc+i
 NYDA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBjaGFuZ2UgYWRkcyBzdXBwb3J0IGZvciBhbGwgY3VycmVudCBwYXR0ZXJucy4KClNpZ25l
ZC1vZmYtYnk6IElsaWEgTWlya2luIDxpbWlya2luQGFsdW0ubWl0LmVkdT4KLS0tCiB0ZXN0cy91
dGlsL2Zvcm1hdC5jICB8ICAgNSArKwogdGVzdHMvdXRpbC9wYXR0ZXJuLmMgfCAyMDcgKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrLQogMiBmaWxlcyBjaGFuZ2VkLCAy
MDkgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90ZXN0cy91dGls
L2Zvcm1hdC5jIGIvdGVzdHMvdXRpbC9mb3JtYXQuYwppbmRleCBlNTIyMTNiYi4uMWNhMWI4MmMg
MTAwNjQ0Ci0tLSBhL3Rlc3RzL3V0aWwvZm9ybWF0LmMKKysrIGIvdGVzdHMvdXRpbC9mb3JtYXQu
YwpAQCAtOTMsNiArOTMsMTEgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB1dGlsX2Zvcm1hdF9pbmZv
IGZvcm1hdF9pbmZvW10gPSB7CiAJeyBEUk1fRk9STUFUX1JHQlgxMDEwMTAyLCAiUlgzMCIsIE1B
S0VfUkdCX0lORk8oMTAsIDIyLCAxMCwgMTIsIDEwLCAyLCAwLCAwKSB9LAogCXsgRFJNX0ZPUk1B
VF9CR1JBMTAxMDEwMiwgIkJBMzAiLCBNQUtFX1JHQl9JTkZPKDEwLCAyLCAxMCwgMTIsIDEwLCAy
MiwgMiwgMCkgfSwKIAl7IERSTV9GT1JNQVRfQkdSWDEwMTAxMDIsICJCWDMwIiwgTUFLRV9SR0Jf
SU5GTygxMCwgMiwgMTAsIDEyLCAxMCwgMjIsIDAsIDApIH0sCisJeyBEUk1fRk9STUFUX1hSR0Ix
NjE2MTYxNkYsICJYUjRIIiwgTUFLRV9SR0JfSU5GTygxNiwgMzIsIDE2LCAxNiwgMTYsIDAsIDAs
IDApIH0sCisJeyBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsICJYQjRIIiwgTUFLRV9SR0JfSU5G
TygxNiwgMCwgMTYsIDE2LCAxNiwgMzIsIDAsIDApIH0sCisJeyBEUk1fRk9STUFUX0FSR0IxNjE2
MTYxNkYsICJBUjRIIiwgTUFLRV9SR0JfSU5GTygxNiwgMzIsIDE2LCAxNiwgMTYsIDAsIDE2LCA0
OCkgfSwKKwl7IERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RiwgIkFCNEgiLCBNQUtFX1JHQl9JTkZP
KDE2LCAwLCAxNiwgMTYsIDE2LCAzMiwgMTYsIDQ4KSB9LAorCiB9OwogCiB1aW50MzJfdCB1dGls
X2Zvcm1hdF9mb3VyY2MoY29uc3QgY2hhciAqbmFtZSkKZGlmZiAtLWdpdCBhL3Rlc3RzL3V0aWwv
cGF0dGVybi5jIGIvdGVzdHMvdXRpbC9wYXR0ZXJuLmMKaW5kZXggZmYxMTBmZDcuLjM3Nzk2ZGJm
IDEwMDY0NAotLS0gYS90ZXN0cy91dGlsL3BhdHRlcm4uYworKysgYi90ZXN0cy91dGlsL3BhdHRl
cm4uYwpAQCAtODYsNiArODYsMTcgQEAgc3RhdGljIGlubGluZSB1aW50MzJfdCBzaGlmdGNvbG9y
MTAoY29uc3Qgc3RydWN0IHV0aWxfY29sb3JfY29tcG9uZW50ICpjb21wLAogCXJldHVybiB2YWx1
ZSA8PCBjb21wLT5vZmZzZXQ7CiB9CiAKKy8qIFRoaXMgZnVuY3Rpb24gdGFrZXMgMTYtYml0IGNv
bG9yIHZhbHVlcyAqLworc3RhdGljIGlubGluZSB1aW50NjRfdCBzaGlmdGNvbG9yMTYoY29uc3Qg
c3RydWN0IHV0aWxfY29sb3JfY29tcG9uZW50ICpjb21wLAorCQkJCSAgICB1aW50NjRfdCB2YWx1
ZSkKK3sKKwl2YWx1ZSAmPSAweGZmZmY7CisJLyogU2hpZnQgZG93biB0byByZW1vdmUgdW53YW50
ZWQgbG93IGJpdHMgKi8KKwl2YWx1ZSA9IHZhbHVlID4+ICgxNiAtIGNvbXAtPmxlbmd0aCk7CisJ
LyogU2hpZnQgYmFjayB1cCB0byB3aGVyZSB0aGUgdmFsdWUgc2hvdWxkIGJlICovCisJcmV0dXJu
IHZhbHVlIDw8IGNvbXAtPm9mZnNldDsKK30KKwogI2RlZmluZSBNQUtFX1JHQkExMChyZ2IsIHIs
IGcsIGIsIGEpIFwKIAkoc2hpZnRjb2xvcjEwKCYocmdiKS0+cmVkLCAocikpIHwgXAogCSBzaGlm
dGNvbG9yMTAoJihyZ2IpLT5ncmVlbiwgKGcpKSB8IFwKQEAgLTEwMSw2ICsxMTIsNDkgQEAgc3Rh
dGljIGlubGluZSB1aW50MzJfdCBzaGlmdGNvbG9yMTAoY29uc3Qgc3RydWN0IHV0aWxfY29sb3Jf
Y29tcG9uZW50ICpjb21wLAogI2RlZmluZSBNQUtFX1JHQjI0KHJnYiwgciwgZywgYikgXAogCXsg
LnZhbHVlID0gTUFLRV9SR0JBKHJnYiwgciwgZywgYiwgMCkgfQogCisKKy8qKgorICAqIFRha2Vz
IGEgdWludDE2X3QsIGRpdmlkZXMgYnkgNjU1MzYsIGNvbnZlcnRzIHRoZSBpbmZpbml0ZS1wcmVj
aXNpb24KKyAgKiByZXN1bHQgdG8gZnAxNiB3aXRoIHJvdW5kLXRvLXplcm8uCisgICoKKyAgKiBD
b3BpZWQgZnJvbSBtZXNhOnNyYy91dGlsL2hhbGZfZmxvYXQuYworICAqLworc3RhdGljIHVpbnQx
Nl90IHVpbnQxNl9kaXZfNjRrX3RvX2hhbGYodWludDE2X3QgdikKK3sKKwkvKiBaZXJvIG9yIHN1
Ym5vcm1hbC4gU2V0IHRoZSBtYW50aXNzYSB0byAodiA8PCA4KSBhbmQgcmV0dXJuLiAqLworCWlm
ICh2IDwgNCkKKwkJcmV0dXJuIHYgPDwgODsKKworCS8qIENvdW50IHRoZSBsZWFkaW5nIDBzIGlu
IHRoZSB1aW50MTZfdCAqLworCWludCBuID0gX19idWlsdGluX2Nseih2KSAtIDE2OworCisJLyog
U2hpZnQgdGhlIG1hbnRpc3NhIHVwIHNvIGJpdCAxNiBpcyB0aGUgaGlkZGVuIDEgYml0LAorCSAq
IG1hc2sgaXQgb2ZmLCB0aGVuIHNoaWZ0IGJhY2sgZG93biB0byAxMCBiaXRzCisJICovCisJaW50
IG0gPSAoICgodWludDMyX3QpdiA8PCAobiArIDEpKSAmIDB4ZmZmZiApID4+IDY7CisKKwkvKiAg
KDB7bn0gMSBYezE1LW59KSAqIDJeLTE2CisJICogPSAxLlggKiAyXigxNS1uLTE2KQorCSAqID0g
MS5YICogMl4oMTQtbiAtIDE1KQorCSAqIHdoaWNoIGlzIHRoZSBGUDE2IGZvcm0gd2l0aCBlID0g
MTQgLSBuCisJICovCisJaW50IGUgPSAxNCAtIG47CisKKwlyZXR1cm4gKGUgPDwgMTApIHwgbTsK
K30KKworI2RlZmluZSBNQUtFX1JHQkE4RlAxNihyZ2IsIHIsIGcsIGIsIGEpIFwKKwkoc2hpZnRj
b2xvcjE2KCYocmdiKS0+cmVkLCB1aW50MTZfZGl2XzY0a190b19oYWxmKChyKSA8PCA4KSkgfCBc
CisJIHNoaWZ0Y29sb3IxNigmKHJnYiktPmdyZWVuLCB1aW50MTZfZGl2XzY0a190b19oYWxmKChn
KSA8PCA4KSkgfCBcCisJIHNoaWZ0Y29sb3IxNigmKHJnYiktPmJsdWUsIHVpbnQxNl9kaXZfNjRr
X3RvX2hhbGYoKGIpIDw8IDgpKSB8IFwKKwkgc2hpZnRjb2xvcjE2KCYocmdiKS0+YWxwaGEsIHVp
bnQxNl9kaXZfNjRrX3RvX2hhbGYoKGEpIDw8IDgpKSkKKworI2RlZmluZSBNQUtFX1JHQkExMEZQ
MTYocmdiLCByLCBnLCBiLCBhKSBcCisJKHNoaWZ0Y29sb3IxNigmKHJnYiktPnJlZCwgdWludDE2
X2Rpdl82NGtfdG9faGFsZigocikgPDwgNikpIHwgXAorCSBzaGlmdGNvbG9yMTYoJihyZ2IpLT5n
cmVlbiwgdWludDE2X2Rpdl82NGtfdG9faGFsZigoZykgPDwgNikpIHwgXAorCSBzaGlmdGNvbG9y
MTYoJihyZ2IpLT5ibHVlLCB1aW50MTZfZGl2XzY0a190b19oYWxmKChiKSA8PCA2KSkgfCBcCisJ
IHNoaWZ0Y29sb3IxNigmKHJnYiktPmFscGhhLCB1aW50MTZfZGl2XzY0a190b19oYWxmKChhKSA8
PCA2KSkpCisKIHN0YXRpYyB2b2lkIGZpbGxfc21wdGVfeXV2X3BsYW5hcihjb25zdCBzdHJ1Y3Qg
dXRpbF95dXZfaW5mbyAqeXV2LAogCQkJCSAgdW5zaWduZWQgY2hhciAqeV9tZW0sIHVuc2lnbmVk
IGNoYXIgKnVfbWVtLAogCQkJCSAgdW5zaWduZWQgY2hhciAqdl9tZW0sIHVuc2lnbmVkIGludCB3
aWR0aCwKQEAgLTQ4OSw2ICs1NDMsNjcgQEAgc3RhdGljIHZvaWQgZmlsbF9zbXB0ZV9yZ2IzMihj
b25zdCBzdHJ1Y3QgdXRpbF9yZ2JfaW5mbyAqcmdiLCB2b2lkICptZW0sCiAJfQogfQogCitzdGF0
aWMgdm9pZCBmaWxsX3NtcHRlX3JnYjE2ZnAoY29uc3Qgc3RydWN0IHV0aWxfcmdiX2luZm8gKnJn
Yiwgdm9pZCAqbWVtLAorCQkJICAgICAgIHVuc2lnbmVkIGludCB3aWR0aCwgdW5zaWduZWQgaW50
IGhlaWdodCwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgc3RyaWRlKQoreworCWNvbnN0IHVpbnQ2
NF90IGNvbG9yc190b3BbXSA9IHsKKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAxOTIsIDE5MiwgMTky
LCAyNTUpLC8qIGdyZXkgKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAxOTIsIDE5MiwgMCwgMjU1
KSwJLyogeWVsbG93ICovCisJCU1BS0VfUkdCQThGUDE2KHJnYiwgMCwgMTkyLCAxOTIsIDI1NSks
CS8qIGN5YW4gKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAwLCAxOTIsIDAsIDI1NSksCS8qIGdy
ZWVuICovCisJCU1BS0VfUkdCQThGUDE2KHJnYiwgMTkyLCAwLCAxOTIsIDI1NSksCS8qIG1hZ2Vu
dGEgKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAxOTIsIDAsIDAsIDI1NSksCS8qIHJlZCAqLwor
CQlNQUtFX1JHQkE4RlAxNihyZ2IsIDAsIDAsIDE5MiwgMjU1KSwJLyogYmx1ZSAqLworCX07CisJ
Y29uc3QgdWludDY0X3QgY29sb3JzX21pZGRsZVtdID0geworCQlNQUtFX1JHQkE4RlAxNihyZ2Is
IDAsIDAsIDE5MiwgMTI3KSwJLyogYmx1ZSAqLworCQlNQUtFX1JHQkE4RlAxNihyZ2IsIDE5LCAx
OSwgMTksIDEyNyksCS8qIGJsYWNrICovCisJCU1BS0VfUkdCQThGUDE2KHJnYiwgMTkyLCAwLCAx
OTIsIDEyNyksCS8qIG1hZ2VudGEgKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAxOSwgMTksIDE5
LCAxMjcpLAkvKiBibGFjayAqLworCQlNQUtFX1JHQkE4RlAxNihyZ2IsIDAsIDE5MiwgMTkyLCAx
MjcpLAkvKiBjeWFuICovCisJCU1BS0VfUkdCQThGUDE2KHJnYiwgMTksIDE5LCAxOSwgMTI3KSwJ
LyogYmxhY2sgKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAxOTIsIDE5MiwgMTkyLCAxMjcpLC8q
IGdyZXkgKi8KKwl9OworCWNvbnN0IHVpbnQ2NF90IGNvbG9yc19ib3R0b21bXSA9IHsKKwkJTUFL
RV9SR0JBOEZQMTYocmdiLCAwLCAzMywgNzYsIDI1NSksCS8qIGluLXBoYXNlICovCisJCU1BS0Vf
UkdCQThGUDE2KHJnYiwgMjU1LCAyNTUsIDI1NSwgMjU1KSwvKiBzdXBlciB3aGl0ZSAqLworCQlN
QUtFX1JHQkE4RlAxNihyZ2IsIDUwLCAwLCAxMDYsIDI1NSksCS8qIHF1YWRyYXR1cmUgKi8KKwkJ
TUFLRV9SR0JBOEZQMTYocmdiLCAxOSwgMTksIDE5LCAyNTUpLAkvKiBibGFjayAqLworCQlNQUtF
X1JHQkE4RlAxNihyZ2IsIDksIDksIDksIDI1NSksCS8qIDMuNSUgKi8KKwkJTUFLRV9SR0JBOEZQ
MTYocmdiLCAxOSwgMTksIDE5LCAyNTUpLAkvKiA3LjUlICovCisJCU1BS0VfUkdCQThGUDE2KHJn
YiwgMjksIDI5LCAyOSwgMjU1KSwJLyogMTEuNSUgKi8KKwkJTUFLRV9SR0JBOEZQMTYocmdiLCAx
OSwgMTksIDE5LCAyNTUpLAkvKiBibGFjayAqLworCX07CisJdW5zaWduZWQgaW50IHg7CisJdW5z
aWduZWQgaW50IHk7CisKKwlmb3IgKHkgPSAwOyB5IDwgaGVpZ2h0ICogNiAvIDk7ICsreSkgewor
CQlmb3IgKHggPSAwOyB4IDwgd2lkdGg7ICsreCkKKwkJCSgodWludDY0X3QgKiltZW0pW3hdID0g
Y29sb3JzX3RvcFt4ICogNyAvIHdpZHRoXTsKKwkJbWVtICs9IHN0cmlkZTsKKwl9CisKKwlmb3Ig
KDsgeSA8IGhlaWdodCAqIDcgLyA5OyArK3kpIHsKKwkJZm9yICh4ID0gMDsgeCA8IHdpZHRoOyAr
K3gpCisJCQkoKHVpbnQ2NF90ICopbWVtKVt4XSA9IGNvbG9yc19taWRkbGVbeCAqIDcgLyB3aWR0
aF07CisJCW1lbSArPSBzdHJpZGU7CisJfQorCisJZm9yICg7IHkgPCBoZWlnaHQ7ICsreSkgewor
CQlmb3IgKHggPSAwOyB4IDwgd2lkdGggKiA1IC8gNzsgKyt4KQorCQkJKCh1aW50NjRfdCAqKW1l
bSlbeF0gPQorCQkJCWNvbG9yc19ib3R0b21beCAqIDQgLyAod2lkdGggKiA1IC8gNyldOworCQlm
b3IgKDsgeCA8IHdpZHRoICogNiAvIDc7ICsreCkKKwkJCSgodWludDY0X3QgKiltZW0pW3hdID0K
KwkJCQljb2xvcnNfYm90dG9tWyh4IC0gd2lkdGggKiA1IC8gNykgKiAzCisJCQkJCSAgICAgIC8g
KHdpZHRoIC8gNykgKyA0XTsKKwkJZm9yICg7IHggPCB3aWR0aDsgKyt4KQorCQkJKCh1aW50NjRf
dCAqKW1lbSlbeF0gPSBjb2xvcnNfYm90dG9tWzddOworCQltZW0gKz0gc3RyaWRlOworCX0KK30K
Kwogc3RhdGljIHZvaWQgZmlsbF9zbXB0ZV9jOCh2b2lkICptZW0sIHVuc2lnbmVkIGludCB3aWR0
aCwgdW5zaWduZWQgaW50IGhlaWdodCwKIAkJCSAgdW5zaWduZWQgaW50IHN0cmlkZSkKIHsKQEAg
LTYzOCw2ICs3NTMsMTMgQEAgc3RhdGljIHZvaWQgZmlsbF9zbXB0ZShjb25zdCBzdHJ1Y3QgdXRp
bF9mb3JtYXRfaW5mbyAqaW5mbywgdm9pZCAqcGxhbmVzWzNdLAogCWNhc2UgRFJNX0ZPUk1BVF9C
R1JYMTAxMDEwMjoKIAkJcmV0dXJuIGZpbGxfc21wdGVfcmdiMzIoJmluZm8tPnJnYiwgcGxhbmVz
WzBdLAogCQkJCQl3aWR0aCwgaGVpZ2h0LCBzdHJpZGUpOworCisJY2FzZSBEUk1fRk9STUFUX1hS
R0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1f
Rk9STUFUX0FSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJ
CXJldHVybiBmaWxsX3NtcHRlX3JnYjE2ZnAoJmluZm8tPnJnYiwgcGxhbmVzWzBdLAorCQkJCQkg
IHdpZHRoLCBoZWlnaHQsIHN0cmlkZSk7CiAJfQogfQogCkBAIC04NDksNiArOTcxLDMyIEBAIHN0
YXRpYyB2b2lkIGZpbGxfdGlsZXNfcmdiMzIoY29uc3Qgc3RydWN0IHV0aWxfZm9ybWF0X2luZm8g
KmluZm8sIHZvaWQgKm1lbSwKIAltYWtlX3B3ZXR0eShtZW1fYmFzZSwgd2lkdGgsIGhlaWdodCwg
c3RyaWRlLCBpbmZvLT5mb3JtYXQpOwogfQogCitzdGF0aWMgdm9pZCBmaWxsX3RpbGVzX3JnYjE2
ZnAoY29uc3Qgc3RydWN0IHV0aWxfZm9ybWF0X2luZm8gKmluZm8sIHZvaWQgKm1lbSwKKwkJCSAg
ICAgICB1bnNpZ25lZCBpbnQgd2lkdGgsIHVuc2lnbmVkIGludCBoZWlnaHQsCisJCQkgICAgICAg
dW5zaWduZWQgaW50IHN0cmlkZSkKK3sKKwljb25zdCBzdHJ1Y3QgdXRpbF9yZ2JfaW5mbyAqcmdi
ID0gJmluZm8tPnJnYjsKKwl2b2lkICptZW1fYmFzZSA9IG1lbTsKKwl1bnNpZ25lZCBpbnQgeCwg
eTsKKworCS8qIFRPRE86IEdpdmUgdGhpcyBhY3R1YWwgZnAxNiBwcmVjaXNpb24gKi8KKwlmb3Ig
KHkgPSAwOyB5IDwgaGVpZ2h0OyArK3kpIHsKKwkJZm9yICh4ID0gMDsgeCA8IHdpZHRoOyArK3gp
IHsKKwkJCWRpdl90IGQgPSBkaXYoeCt5LCB3aWR0aCk7CisJCQl1aW50MzJfdCByZ2IzMiA9IDB4
MDAxMzA1MDIgKiAoZC5xdW90ID4+IDYpCisJCQkJICAgICAgICsgMHgwMDBhMTEyMCAqIChkLnJl
bSA+PiA2KTsKKwkJCXVpbnQzMl90IGFscGhhID0gKCh5IDwgaGVpZ2h0LzIpICYmICh4IDwgd2lk
dGgvMikpID8gMTI3IDogMjU1OworCQkJdWludDY0X3QgY29sb3IgPQorCQkJCU1BS0VfUkdCQThG
UDE2KHJnYiwgKHJnYjMyID4+IDE2KSAmIDB4ZmYsCisJCQkJCSAgICAgICAocmdiMzIgPj4gOCkg
JiAweGZmLCByZ2IzMiAmIDB4ZmYsCisJCQkJCSAgICAgICBhbHBoYSk7CisKKwkJCSgodWludDY0
X3QgKiltZW0pW3hdID0gY29sb3I7CisJCX0KKwkJbWVtICs9IHN0cmlkZTsKKwl9Cit9CisKIHN0
YXRpYyB2b2lkIGZpbGxfdGlsZXMoY29uc3Qgc3RydWN0IHV0aWxfZm9ybWF0X2luZm8gKmluZm8s
IHZvaWQgKnBsYW5lc1szXSwKIAkJICAgICAgIHVuc2lnbmVkIGludCB3aWR0aCwgdW5zaWduZWQg
aW50IGhlaWdodCwKIAkJICAgICAgIHVuc2lnbmVkIGludCBzdHJpZGUpCkBAIC05MjMsMTQgKzEw
NzEsMzIgQEAgc3RhdGljIHZvaWQgZmlsbF90aWxlcyhjb25zdCBzdHJ1Y3QgdXRpbF9mb3JtYXRf
aW5mbyAqaW5mbywgdm9pZCAqcGxhbmVzWzNdLAogCWNhc2UgRFJNX0ZPUk1BVF9CR1JYMTAxMDEw
MjoKIAkJcmV0dXJuIGZpbGxfdGlsZXNfcmdiMzIoaW5mbywgcGxhbmVzWzBdLAogCQkJCQl3aWR0
aCwgaGVpZ2h0LCBzdHJpZGUpOworCisJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6CisJ
Y2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2
MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJCXJldHVybiBmaWxsX3Rp
bGVzX3JnYjE2ZnAoaW5mbywgcGxhbmVzWzBdLAorCQkJCQkgIHdpZHRoLCBoZWlnaHQsIHN0cmlk
ZSk7CiAJfQogfQogCi1zdGF0aWMgdm9pZCBmaWxsX3BsYWluKHZvaWQgKnBsYW5lc1szXSwKK3N0
YXRpYyB2b2lkIGZpbGxfcGxhaW4oY29uc3Qgc3RydWN0IHV0aWxfZm9ybWF0X2luZm8gKmluZm8s
IHZvaWQgKnBsYW5lc1szXSwKIAkJICAgICAgIHVuc2lnbmVkIGludCBoZWlnaHQsCiAJCSAgICAg
ICB1bnNpZ25lZCBpbnQgc3RyaWRlKQogewotCW1lbXNldChwbGFuZXNbMF0sIDB4NzcsIHN0cmlk
ZSAqIGhlaWdodCk7CisJc3dpdGNoIChpbmZvLT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRf
WFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERS
TV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoK
KwkJLyogMHgzODM4ID0gMC41MjczICovCisJCW1lbXNldChwbGFuZXNbMF0sIDB4MzgsIHN0cmlk
ZSAqIGhlaWdodCk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCW1lbXNldChwbGFuZXNbMF0sIDB4
NzcsIHN0cmlkZSAqIGhlaWdodCk7CisJCWJyZWFrOworCX0KIH0KIAogc3RhdGljIHZvaWQgZmls
bF9ncmFkaWVudF9yZ2IzMihjb25zdCBzdHJ1Y3QgdXRpbF9yZ2JfaW5mbyAqcmdiLApAQCAtOTYx
LDYgKzExMjcsMzQgQEAgc3RhdGljIHZvaWQgZmlsbF9ncmFkaWVudF9yZ2IzMihjb25zdCBzdHJ1
Y3QgdXRpbF9yZ2JfaW5mbyAqcmdiLAogCX0KIH0KIAorc3RhdGljIHZvaWQgZmlsbF9ncmFkaWVu
dF9yZ2IxNmZwKGNvbnN0IHN0cnVjdCB1dGlsX3JnYl9pbmZvICpyZ2IsCisJCQkJICB2b2lkICpt
ZW0sCisJCQkJICB1bnNpZ25lZCBpbnQgd2lkdGgsIHVuc2lnbmVkIGludCBoZWlnaHQsCisJCQkJ
ICB1bnNpZ25lZCBpbnQgc3RyaWRlKQoreworCWludCBpLCBqOworCisJZm9yIChpID0gMDsgaSA8
IGhlaWdodCAvIDI7IGkrKykgeworCQl1aW50NjRfdCAqcm93ID0gbWVtOworCisJCWZvciAoaiA9
IDA7IGogPCB3aWR0aCAvIDI7IGorKykgeworCQkJdWludDY0X3QgdmFsdWUgPSBNQUtFX1JHQkEx
MEZQMTYocmdiLCBqICYgMHgzZmYsIGogJiAweDNmZiwgaiAmIDB4M2ZmLCAwKTsKKwkJCXJvd1sy
KmpdID0gcm93WzIqaisxXSA9IHZhbHVlOworCQl9CisJCW1lbSArPSBzdHJpZGU7CisJfQorCisJ
Zm9yICg7IGkgPCBoZWlnaHQ7IGkrKykgeworCQl1aW50NjRfdCAqcm93ID0gbWVtOworCisJCWZv
ciAoaiA9IDA7IGogPCB3aWR0aCAvIDI7IGorKykgeworCQkJdWludDY0X3QgdmFsdWUgPSBNQUtF
X1JHQkExMEZQMTYocmdiLCBqICYgMHgzZmMsIGogJiAweDNmYywgaiAmIDB4M2ZjLCAwKTsKKwkJ
CXJvd1syKmpdID0gcm93WzIqaisxXSA9IHZhbHVlOworCQl9CisJCW1lbSArPSBzdHJpZGU7CisJ
fQorfQorCiAvKiBUaGUgZ3JhZGllbnQgcGF0dGVybiBjcmVhdGVzIHR3byBob3Jpem9udGFsIGdy
YXkgZ3JhZGllbnRzLCBzcGxpdAogICogaW50byB0d28gaGFsdmVzLiBUaGUgdG9wIGhhbGYgaGFz
IDEwYnBjIHByZWNpc2lvbiwgdGhlIGJvdHRvbSBoYWxmCiAgKiBoYXMgOGJwYyBwcmVjaXNpb24u
IFdoZW4gdXNpbmcgd2l0aCBhIDEwYnBjIGZiIGZvcm1hdCwgdGhlcmUgYXJlIDMKQEAgLTEwMDks
NiArMTIwMywxMyBAQCBzdGF0aWMgdm9pZCBmaWxsX2dyYWRpZW50KGNvbnN0IHN0cnVjdCB1dGls
X2Zvcm1hdF9pbmZvICppbmZvLCB2b2lkICpwbGFuZXNbM10sCiAJY2FzZSBEUk1fRk9STUFUX0JH
UlgxMDEwMTAyOgogCQlyZXR1cm4gZmlsbF9ncmFkaWVudF9yZ2IzMigmaW5mby0+cmdiLCBwbGFu
ZXNbMF0sCiAJCQkJCSAgIHdpZHRoLCBoZWlnaHQsIHN0cmlkZSk7CisKKwljYXNlIERSTV9GT1JN
QVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNl
IERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2
RjoKKwkJcmV0dXJuIGZpbGxfZ3JhZGllbnRfcmdiMTZmcCgmaW5mby0+cmdiLCBwbGFuZXNbMF0s
CisJCQkJCSAgICAgd2lkdGgsIGhlaWdodCwgc3RyaWRlKTsKIAl9CiB9CiAKQEAgLTEwNDIsNyAr
MTI0Myw3IEBAIHZvaWQgdXRpbF9maWxsX3BhdHRlcm4odWludDMyX3QgZm9ybWF0LCBlbnVtIHV0
aWxfZmlsbF9wYXR0ZXJuIHBhdHRlcm4sCiAJCXJldHVybiBmaWxsX3NtcHRlKGluZm8sIHBsYW5l
cywgd2lkdGgsIGhlaWdodCwgc3RyaWRlKTsKIAogCWNhc2UgVVRJTF9QQVRURVJOX1BMQUlOOgot
CQlyZXR1cm4gZmlsbF9wbGFpbihwbGFuZXMsIGhlaWdodCwgc3RyaWRlKTsKKwkJcmV0dXJuIGZp
bGxfcGxhaW4oaW5mbywgcGxhbmVzLCBoZWlnaHQsIHN0cmlkZSk7CiAKIAljYXNlIFVUSUxfUEFU
VEVSTl9HUkFESUVOVDoKIAkJcmV0dXJuIGZpbGxfZ3JhZGllbnQoaW5mbywgcGxhbmVzLCB3aWR0
aCwgaGVpZ2h0LCBzdHJpZGUpOwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
