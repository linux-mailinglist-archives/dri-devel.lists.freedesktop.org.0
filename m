Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 54B933A06C
	for <lists+dri-devel@lfdr.de>; Sat,  8 Jun 2019 17:27:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E7698925C;
	Sat,  8 Jun 2019 15:27:12 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 672A989144;
 Sat,  8 Jun 2019 15:27:06 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:54332
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hZdFI-0000t2-L0; Sat, 08 Jun 2019 17:27:04 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v8 4/5] drm/client: Hack: Add bootsplash example
Date: Sat,  8 Jun 2019 17:26:56 +0200
Message-Id: <20190608152657.36613-5-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190608152657.36613-1-noralf@tronnes.org>
References: <20190608152657.36613-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=GmJY1mZQJ7FC/iP3ZfZ3SqJGbz0NIefHAU6smanRMnE=; 
 b=cnwT/+2D9ofqG9unWApvEWLvNYJ8tnWIvwgNaHoGAaM2iiP7zFfJvDFA9aKUrIXwgAZQZo3+XKWbNP+ur86k5LoCVGz83d9S6evg5wdiESH1B6byBcVZyVphJif0jotELGZhF4eR6yuVBh6o4w/aRXUtoAGApfQXvUg+Os4ZAm58hxHww4wNUkdMiGVQhbArWn+Kx7YMBxGk5W81E/W424TedS8WUOvUf4C0ylydts8E79Q3UkW8tw1SOxfgn4cipOWSV4YoXqOrNQw5RnjbVkPQ9WIf8GR7YlxFw3F2lJemj6tNtbopcvL0gteKYhE/t2NKzC6zPerDwhdQ3Fko2w==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org, sam@ravnborg.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QW4gZXhhbXBsZSB0byBzaG93Y2FzZSB0aGUgY2xpZW50IEFQSS4KClRPRE86Ci0gQSBib290c3Bs
YXNoIGNsaWVudCBuZWVkcyBhIHdheSB0byB0ZWxsIGRybV9mYl9oZWxwZXIgdG8gc3RheSBhd2F5
LAogIG90aGVyd2lzZSBpdCB3aWxsIGNoaW1lIGluIG9uIHNldHVwIGFuZCBob3RwbHVnLgogIE1v
c3QgRFJNIGRyaXZlcnMgcmVnaXN0ZXIgZmJkZXYgYmVmb3JlIGNhbGxpbmcgZHJtX2Rldl9yZWdp
c3RlcigpICh0aGUKICBnZW5lcmljIGVtdWxhdGlvbiBpcyBhbiBleGNlcHRpb24pLiBUaGlzIGhh
dmUgdG8gYmUgcmV2ZXJzZWQgZm9yCiAgYm9vdHNwbGFzaCB0byBmZW5kIG9mZiBmYmRldi4KLSBQ
cm9iYWJseSBuZWVkIHNvbWUgd2F5IHRvIGRldGVybWluZSB3aGljaCBpcyB0aGUgcHJpbWFyeSBk
aXNwbGF5L2RldmljZQogIG9uIG11bHRpIERSTSBkZXZpY2Ugc3lzdGVtcy4KLSBNYXliZSBkbyBo
YW5kb3ZlciBmcm9tIGVhcmx5L3NpbXBsZSBEUk0gZHJpdmVyCgpTaWduZWQtb2ZmLWJ5OiBOb3Jh
bGYgVHLDuG5uZXMgPG5vcmFsZkB0cm9ubmVzLm9yZz4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vS2Nv
bmZpZyAgICAgICAgICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUgICAgICAgICB8
ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2Jvb3RzcGxhc2guYyB8IDM1OCArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jICAgICB8
ICAgNyArCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2Rydi5jICAgICAgICB8ICAgNCArCiBpbmNsdWRl
L2RybS9kcm1fY2xpZW50LmggICAgICAgICB8ICAgMyArCiA2IGZpbGVzIGNoYW5nZWQsIDM3OCBp
bnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2RybV9ib290
c3BsYXNoLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMv
Z3B1L2RybS9LY29uZmlnCmluZGV4IDZiMzQ5NDk0MTZiMS4uZDc3YTY3Y2YzYTg5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZp
ZwpAQCAtNjYsNiArNjYsMTEgQEAgY29uZmlnIERSTV9ERUJVR19TRUxGVEVTVAogCiAJICBJZiBp
biBkb3VidCwgc2F5ICJOIi4KIAorY29uZmlnIERSTV9DTElFTlRfQk9PVFNQTEFTSAorCWJvb2wg
IkRSTSBCb290c3BsYXNoIgorCWhlbHAKKwkgIERSTSBCb290c3BsYXNoCisKIGNvbmZpZyBEUk1f
S01TX0hFTFBFUgogCXRyaXN0YXRlCiAJZGVwZW5kcyBvbiBEUk0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQppbmRleCBkMzZm
ZWI0YTYyMzMuLjg2YTJjZWI5NTgzOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01ha2Vm
aWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtMzEsNiArMzEsNyBAQCBkcm0t
JChDT05GSUdfT0YpICs9IGRybV9vZi5vCiBkcm0tJChDT05GSUdfQUdQKSArPSBkcm1fYWdwc3Vw
cG9ydC5vCiBkcm0tJChDT05GSUdfREVCVUdfRlMpICs9IGRybV9kZWJ1Z2ZzLm8gZHJtX2RlYnVn
ZnNfY3JjLm8KIGRybS0kKENPTkZJR19EUk1fTE9BRF9FRElEX0ZJUk1XQVJFKSArPSBkcm1fZWRp
ZF9sb2FkLm8KK2RybS0kKENPTkZJR19EUk1fQ0xJRU5UX0JPT1RTUExBU0gpICs9IGRybV9ib290
c3BsYXNoLm8KIAogZHJtX3ZyYW1faGVscGVyLXkgOj0gZHJtX2dlbV92cmFtX2hlbHBlci5vIFwK
IAkJICAgICBkcm1fdnJhbV9oZWxwZXJfY29tbW9uLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2RybV9ib290c3BsYXNoLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2Jvb3RzcGxhc2gu
YwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmY1OGVlMTllMjY4Zgot
LS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYm9vdHNwbGFzaC5jCkBAIC0w
LDAgKzEsMzU4IEBACisvKiBEUk0gaW50ZXJuYWwgY2xpZW50IGV4YW1wbGUgKi8KKworI2luY2x1
ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGludXgva2VybmVsLmg+CisjaW5jbHVkZSA8
bGludXgva2V5Ym9hcmQuaD4KKyNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxs
aW51eC9tdXRleC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRlIDxsaW51eC93
b3JrcXVldWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fY2xpZW50Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9kcnYuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fZm91cmNjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tb2Rlcy5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fcHJpbnQuaD4KKworLy8gZHJtX2xhc3RjbG9zZSgpCisjaW5jbHVkZSAiZHJtX2ludGVy
bmFsLmgiCisKK3N0YXRpYyBib29sIGRybV9ib290c3BsYXNoX2VuYWJsZWQgPSB0cnVlOworbW9k
dWxlX3BhcmFtX25hbWVkKGJvb3RzcGxhc2hfZW5hYmxlZCwgZHJtX2Jvb3RzcGxhc2hfZW5hYmxl
ZCwgYm9vbCwgMDYwMCk7CitNT0RVTEVfUEFSTV9ERVNDKGJvb3RzcGxhc2hfZW5hYmxlZCwgIkVu
YWJsZSBib290c3BsYXNoIGNsaWVudCBbZGVmYXVsdD10cnVlXSIpOworCitzdHJ1Y3QgZHJtX2Jv
b3RzcGxhc2ggeworCXN0cnVjdCBkcm1fY2xpZW50X2RldiBjbGllbnQ7CisJc3RydWN0IG11dGV4
IGxvY2s7CisJc3RydWN0IHdvcmtfc3RydWN0IHdvcmtlcjsKKwlzdHJ1Y3QgZHJtX2NsaWVudF9i
dWZmZXIgKmJ1ZmZlcnNbMl07CisJYm9vbCBzdGFydGVkOworCWJvb2wgc3RvcDsKK307CisKK3N0
YXRpYyBib29sIGRybV9ib290c3BsYXNoX2tleV9wcmVzc2VkOworCitzdGF0aWMgaW50IGRybV9i
b290c3BsYXNoX2tleWJvYXJkX25vdGlmaWVyX2NhbGwoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpi
bGssCisJCQkJCQkgdW5zaWduZWQgbG9uZyBjb2RlLCB2b2lkICpfcGFyYW0pCit7CisJLyogQW55
IGtleSBpcyBnb29kICovCisJZHJtX2Jvb3RzcGxhc2hfa2V5X3ByZXNzZWQgPSB0cnVlOworCisJ
cmV0dXJuIE5PVElGWV9PSzsKK30KKworc3RhdGljIHN0cnVjdCBub3RpZmllcl9ibG9jayBkcm1f
Ym9vdHNwbGFzaF9rZXlib2FyZF9ub3RpZmllcl9ibG9jayA9IHsKKwkubm90aWZpZXJfY2FsbCA9
IGRybV9ib290c3BsYXNoX2tleWJvYXJkX25vdGlmaWVyX2NhbGwsCit9OworCitzdGF0aWMgdm9p
ZCBkcm1fYm9vdHNwbGFzaF9idWZmZXJfZGVsZXRlKHN0cnVjdCBkcm1fYm9vdHNwbGFzaCAqc3Bs
YXNoKQoreworCXVuc2lnbmVkIGludCBpOworCisJZm9yIChpID0gMDsgaSA8IDI7IGkrKykgewor
CQlpZiAoIUlTX0VSUl9PUl9OVUxMKHNwbGFzaC0+YnVmZmVyc1tpXSkpCisJCQlkcm1fY2xpZW50
X2ZyYW1lYnVmZmVyX2RlbGV0ZShzcGxhc2gtPmJ1ZmZlcnNbaV0pOworCQlzcGxhc2gtPmJ1ZmZl
cnNbaV0gPSBOVUxMOworCX0KK30KKworc3RhdGljIGludCBkcm1fYm9vdHNwbGFzaF9idWZmZXJf
Y3JlYXRlKHN0cnVjdCBkcm1fYm9vdHNwbGFzaCAqc3BsYXNoLCB1MzIgd2lkdGgsIHUzMiBoZWln
aHQpCit7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CisJ
CXNwbGFzaC0+YnVmZmVyc1tpXSA9IGRybV9jbGllbnRfZnJhbWVidWZmZXJfY3JlYXRlKCZzcGxh
c2gtPmNsaWVudCwgd2lkdGgsIGhlaWdodCwgRFJNX0ZPUk1BVF9YUkdCODg4OCk7CisJCWlmIChJ
U19FUlIoc3BsYXNoLT5idWZmZXJzW2ldKSkgeworCQkJZHJtX2Jvb3RzcGxhc2hfYnVmZmVyX2Rl
bGV0ZShzcGxhc2gpOworCQkJcmV0dXJuIFBUUl9FUlIoc3BsYXNoLT5idWZmZXJzW2ldKTsKKwkJ
fQorCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGRybV9ib290c3BsYXNoX2Rpc3Bs
YXlfcHJvYmUoc3RydWN0IGRybV9ib290c3BsYXNoICpzcGxhc2gpCit7CisJc3RydWN0IGRybV9j
bGllbnRfZGV2ICpjbGllbnQgPSAmc3BsYXNoLT5jbGllbnQ7CisJdW5zaWduZWQgaW50IHdpZHRo
ID0gMCwgaGVpZ2h0ID0gMDsKKwl1bnNpZ25lZCBpbnQgbnVtX25vbl90aWxlZCA9IDAsIGk7CisJ
dW5zaWduZWQgaW50IG1vZGVzZXRfbWFzayA9IDA7CisJc3RydWN0IGRybV9tb2RlX3NldCAqbW9k
ZXNldDsKKwlib29sIHRpbGVkID0gZmFsc2U7CisJaW50IHJldDsKKworCXJldCA9IGRybV9jbGll
bnRfbW9kZXNldF9wcm9iZShjbGllbnQsIDAsIDApOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CisKKwltdXRleF9sb2NrKCZjbGllbnQtPm1vZGVzZXRfbXV0ZXgpOworCisJZHJtX2NsaWVudF9m
b3JfZWFjaF9tb2Rlc2V0KG1vZGVzZXQsIGNsaWVudCkgeworCQlpZiAoIW1vZGVzZXQtPm1vZGUp
CisJCQljb250aW51ZTsKKworCQlpZiAobW9kZXNldC0+Y29ubmVjdG9yc1swXS0+aGFzX3RpbGUp
CisJCQl0aWxlZCA9IHRydWU7CisJCWVsc2UKKwkJCW51bV9ub25fdGlsZWQrKzsKKwl9CisKKwlp
ZiAoIXRpbGVkICYmICFudW1fbm9uX3RpbGVkKSB7CisJCWRybV9ib290c3BsYXNoX2J1ZmZlcl9k
ZWxldGUoc3BsYXNoKTsKKwkJcmV0ID0gLUVOT0VOVDsKKwkJZ290byBvdXQ7CisJfQorCisJLyog
QXNzdW1lIG9ubHkgb25lIHRpbGVkIG1vbml0b3IgaXMgcG9zc2libGUgKi8KKwlpZiAodGlsZWQp
IHsKKwkJaW50IGhkaXNwbGF5ID0gMCwgdmRpc3BsYXkgPSAwOworCisJCWkgPSAwOworCQlkcm1f
Y2xpZW50X2Zvcl9lYWNoX21vZGVzZXQobW9kZXNldCwgY2xpZW50KSB7CisJCQlpKys7CisJCQlp
ZiAoIW1vZGVzZXQtPmNvbm5lY3RvcnNbMF0tPmhhc190aWxlKQorCQkJCWNvbnRpbnVlOworCisJ
CQlpZiAoIW1vZGVzZXQtPnkpCisJCQkJaGRpc3BsYXkgKz0gbW9kZXNldC0+bW9kZS0+aGRpc3Bs
YXk7CisJCQlpZiAoIW1vZGVzZXQtPngpCisJCQkJdmRpc3BsYXkgKz0gbW9kZXNldC0+bW9kZS0+
dmRpc3BsYXk7CisJCQltb2Rlc2V0X21hc2sgfD0gQklUKGkgLSAxKTsKKwkJfQorCisJCXdpZHRo
ID0gaGRpc3BsYXk7CisJCWhlaWdodCA9IHZkaXNwbGF5OworCisJCWdvdG8gdHJpbTsKKwl9CisK
KwkvKiBUaGUgcmVzdCBoYXZlIG9uZSBkaXNwbGF5IChtYXliZSBjbG9uZWQpIHBlciBtb2Rlc2V0
LCBwaWNrIHRoZSBsYXJnZXN0ICovCisJaSA9IDA7CisJZHJtX2NsaWVudF9mb3JfZWFjaF9tb2Rl
c2V0KG1vZGVzZXQsIGNsaWVudCkgeworCQlpKys7CisJCWlmICghbW9kZXNldC0+bW9kZSB8fCBt
b2Rlc2V0LT5jb25uZWN0b3JzWzBdLT5oYXNfdGlsZSkKKwkJCWNvbnRpbnVlOworCisJCWlmICht
b2Rlc2V0LT5tb2RlLT5oZGlzcGxheSAqIG1vZGVzZXQtPm1vZGUtPnZkaXNwbGF5ID4gd2lkdGgg
KiBoZWlnaHQpIHsKKwkJCXdpZHRoID0gbW9kZXNldC0+bW9kZS0+aGRpc3BsYXk7CisJCQloZWln
aHQgPSBtb2Rlc2V0LT5tb2RlLT52ZGlzcGxheTsKKwkJCW1vZGVzZXRfbWFzayA9IEJJVChpIC0g
MSk7CisJCX0KKwl9CisKK3RyaW06CisJLyogUmVtb3ZlIHVudXNlZCBtb2Rlc2V0cyAod2Fybmlu
ZyBpbiBfX2RybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcoKSkgKi8KKwlpID0gMDsKKwlkcm1f
Y2xpZW50X2Zvcl9lYWNoX21vZGVzZXQobW9kZXNldCwgY2xpZW50KSB7CisJCXVuc2lnbmVkIGlu
dCBqOworCisJCWlmIChtb2Rlc2V0X21hc2sgJiBCSVQoaSsrKSkKKwkJCWNvbnRpbnVlOworCQlk
cm1fbW9kZV9kZXN0cm95KGNsaWVudC0+ZGV2LCBtb2Rlc2V0LT5tb2RlKTsKKwkJbW9kZXNldC0+
bW9kZSA9IE5VTEw7CisKKwkJZm9yIChqID0gMDsgaiA8IG1vZGVzZXQtPm51bV9jb25uZWN0b3Jz
OyBqKyspIHsKKwkJCWRybV9jb25uZWN0b3JfcHV0KG1vZGVzZXQtPmNvbm5lY3RvcnNbal0pOwor
CQkJbW9kZXNldC0+Y29ubmVjdG9yc1tqXSA9IE5VTEw7CisJCX0KKwkJbW9kZXNldC0+bnVtX2Nv
bm5lY3RvcnMgPSAwOworCX0KKworCWlmICghc3BsYXNoLT5idWZmZXJzWzBdIHx8CisJICAgIHNw
bGFzaC0+YnVmZmVyc1swXS0+ZmItPndpZHRoICE9IHdpZHRoIHx8CisJICAgIHNwbGFzaC0+YnVm
ZmVyc1swXS0+ZmItPmhlaWdodCAhPSBoZWlnaHQpIHsKKwkJZHJtX2Jvb3RzcGxhc2hfYnVmZmVy
X2RlbGV0ZShzcGxhc2gpOworCQlyZXQgPSBkcm1fYm9vdHNwbGFzaF9idWZmZXJfY3JlYXRlKHNw
bGFzaCwgd2lkdGgsIGhlaWdodCk7CisJfQorCitvdXQ6CisJbXV0ZXhfdW5sb2NrKCZjbGllbnQt
Pm1vZGVzZXRfbXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBkcm1fYm9v
dHNwbGFzaF9kaXNwbGF5X2NvbW1pdF9idWZmZXIoc3RydWN0IGRybV9ib290c3BsYXNoICpzcGxh
c2gsIHVuc2lnbmVkIGludCBudW0pCit7CisJc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQg
PSAmc3BsYXNoLT5jbGllbnQ7CisJc3RydWN0IGRybV9tb2RlX3NldCAqbW9kZXNldDsKKworCW11
dGV4X2xvY2soJmNsaWVudC0+bW9kZXNldF9tdXRleCk7CisJZHJtX2NsaWVudF9mb3JfZWFjaF9t
b2Rlc2V0KG1vZGVzZXQsIGNsaWVudCkgeworCQlpZiAobW9kZXNldC0+bW9kZSkKKwkJCW1vZGVz
ZXQtPmZiID0gc3BsYXNoLT5idWZmZXJzW251bV0tPmZiOworCX0KKwltdXRleF91bmxvY2soJmNs
aWVudC0+bW9kZXNldF9tdXRleCk7CisKKwlyZXR1cm4gZHJtX2NsaWVudF9tb2Rlc2V0X2NvbW1p
dChjbGllbnQpOworfQorCitzdGF0aWMgdTMyIGRybV9ib290c3BsYXNoX2NvbG9yX3RhYmxlWzNd
ID0geworCTB4MDBmZjAwMDAsIDB4MDAwMGZmMDAsIDB4MDAwMDAwZmYsCit9OworCisvKiBEcmF3
IGEgYm94IHdpdGggY2hhbmdpbmcgY29sb3JzICovCitzdGF0aWMgdm9pZCBkcm1fYm9vdHNwbGFz
aF9kcmF3X2JveChzdHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgKmJ1ZmZlciwgdW5zaWduZWQgaW50
IHNlcXVlbmNlKQoreworCXVuc2lnbmVkIGludCB3aWR0aCA9IGJ1ZmZlci0+ZmItPndpZHRoOwor
CXVuc2lnbmVkIGludCBoZWlnaHQgPSBidWZmZXItPmZiLT5oZWlnaHQ7CisJdW5zaWduZWQgaW50
IHgsIHk7CisJdTMyICpwaXg7CisKKwlwaXggPSBidWZmZXItPnZhZGRyOworCXBpeCArPSAoKGhl
aWdodCAvIDIpIC0gNTApICogd2lkdGg7CisJcGl4ICs9ICh3aWR0aCAvIDIpIC0gNTA7CisKKwlm
b3IgKHkgPSAwOyB5IDwgMTAwOyB5KyspIHsKKwkJZm9yICh4ID0gMDsgeCA8IDEwMDsgeCsrKQor
CQkJKnBpeCsrID0gZHJtX2Jvb3RzcGxhc2hfY29sb3JfdGFibGVbc2VxdWVuY2VdOworCQlwaXgg
Kz0gd2lkdGggLSAxMDA7CisJfQorfQorCitzdGF0aWMgaW50IGRybV9ib290c3BsYXNoX2RyYXco
c3RydWN0IGRybV9ib290c3BsYXNoICpzcGxhc2gsIHVuc2lnbmVkIGludCBzZXF1ZW5jZSwgdW5z
aWduZWQgaW50IGJ1ZmZlcl9udW0pCit7CisJaWYgKCFzcGxhc2gtPmJ1ZmZlcnNbYnVmZmVyX251
bV0pCisJCXJldHVybiAtRU5PRU5UOworCisJRFJNX0RFQlVHX0tNUygiZHJhdzogYnVmZmVyX251
bT0ldSwgc2VxdWVuY2U9JXVcbiIsIGJ1ZmZlcl9udW0sIHNlcXVlbmNlKTsKKworCWRybV9ib290
c3BsYXNoX2RyYXdfYm94KHNwbGFzaC0+YnVmZmVyc1tidWZmZXJfbnVtXSwgc2VxdWVuY2UpOwor
CisJcmV0dXJuIGRybV9ib290c3BsYXNoX2Rpc3BsYXlfY29tbWl0X2J1ZmZlcihzcGxhc2gsIGJ1
ZmZlcl9udW0pOworfQorCitzdGF0aWMgdm9pZCBkcm1fYm9vdHNwbGFzaF93b3JrZXIoc3RydWN0
IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBkcm1fYm9vdHNwbGFzaCAqc3BsYXNoID0g
Y29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkcm1fYm9vdHNwbGFzaCwgd29ya2VyKTsKKwlzdHJ1
Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCA9ICZzcGxhc2gtPmNsaWVudDsKKwlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY2xpZW50LT5kZXY7CisJdW5zaWduZWQgaW50IGJ1ZmZlcl9udW0gPSAw
LCBzZXF1ZW5jZSA9IDA7CisJYm9vbCBzdG9wID0gZmFsc2U7CisJaW50IHJldCA9IDA7CisKKwl3
aGlsZSAoIWRybV9ib290c3BsYXNoX2tleV9wcmVzc2VkKSB7CisJCW11dGV4X2xvY2soJnNwbGFz
aC0+bG9jayk7CisKKwkJc3RvcCA9IHNwbGFzaC0+c3RvcDsKKworCQlidWZmZXJfbnVtID0gIWJ1
ZmZlcl9udW07CisKKwkJcmV0ID0gZHJtX2Jvb3RzcGxhc2hfZHJhdyhzcGxhc2gsIHNlcXVlbmNl
LCBidWZmZXJfbnVtKTsKKworCQltdXRleF91bmxvY2soJnNwbGFzaC0+bG9jayk7CisKKwkJaWYg
KHN0b3AgfHwgcmV0ID09IC1FTk9FTlQgfHwgcmV0ID09IC1FQlVTWSkKKwkJCWJyZWFrOworCisJ
CWlmICgrK3NlcXVlbmNlID09IDMpCisJCQlzZXF1ZW5jZSA9IDA7CisKKwkJbXNsZWVwKDUwMCk7
CisJfQorCisJLyogUmVzdG9yZSBmYmRldiAob3Igb3RoZXIpIG9uIGtleSBwcmVzcy4gKi8KKwkv
KiBUT0RPOiBDaGVjayBpZiBpdCdzIE9LIHRvIGNhbGwgZHJtX2xhc3RjbG9zZSBoZXJlLiAqLwor
CWlmIChkcm1fYm9vdHNwbGFzaF9rZXlfcHJlc3NlZCAmJiAhc3BsYXNoLT5zdG9wKQorCQlkcm1f
bGFzdGNsb3NlKGRldik7CisKKwlkcm1fYm9vdHNwbGFzaF9idWZmZXJfZGVsZXRlKHNwbGFzaCk7
CisKKwlEUk1fREVWX0RFQlVHX0tNUyhkZXYtPmRldiwgIkJvb3RzcGxhc2ggaGFzIHN0b3BwZWQg
KGtleT0ldSBzdG9wPSV1LCByZXQ9JWQpLlxuIiwKKwkJCSAgZHJtX2Jvb3RzcGxhc2hfa2V5X3By
ZXNzZWQsIHNwbGFzaC0+c3RvcCwgcmV0KTsKK30KKworc3RhdGljIGludCBkcm1fYm9vdHNwbGFz
aF9jbGllbnRfaG90cGx1ZyhzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCkKK3sKKwlzdHJ1
Y3QgZHJtX2Jvb3RzcGxhc2ggKnNwbGFzaCA9IGNvbnRhaW5lcl9vZihjbGllbnQsIHN0cnVjdCBk
cm1fYm9vdHNwbGFzaCwgY2xpZW50KTsKKwlpbnQgcmV0ID0gMDsKKworCWlmIChkcm1fYm9vdHNw
bGFzaF9rZXlfcHJlc3NlZCkKKwkJcmV0dXJuIDA7CisKKwltdXRleF9sb2NrKCZzcGxhc2gtPmxv
Y2spOworCisJaWYgKHNwbGFzaC0+c3RvcCkKKwkJZ290byBvdXRfdW5sb2NrOworCisJcmV0ID0g
ZHJtX2Jvb3RzcGxhc2hfZGlzcGxheV9wcm9iZShzcGxhc2gpOworCWlmIChyZXQgPCAwKSB7CisJ
CWlmIChzcGxhc2gtPnN0YXJ0ZWQgJiYgcmV0ID09IC1FTk9FTlQpCisJCQlzcGxhc2gtPnN0b3Ag
PSB0cnVlOworCQlnb3RvIG91dF91bmxvY2s7CisJfQorCisJLyoKKwkgKiBUT0RPOiBEZWFsIHdp
dGggcm90YXRlZCBwYW5lbHMsIG1pZ2h0IGhhdmUgdG8gc3cgcm90YXRlCisJaWYgKGRybV9jbGll
bnRfcGFuZWxfcm90YXRpb24oLi4uKSkKKwkgKi8KKworCWlmICghc3BsYXNoLT5zdGFydGVkKSB7
CisJCXNwbGFzaC0+c3RhcnRlZCA9IHRydWU7CisJCXNjaGVkdWxlX3dvcmsoJnNwbGFzaC0+d29y
a2VyKTsKKwl9CisKK291dF91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZzcGxhc2gtPmxvY2spOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgZHJtX2Jvb3RzcGxhc2hfY2xpZW50X3Vu
cmVnaXN0ZXIoc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQpCit7CisJc3RydWN0IGRybV9i
b290c3BsYXNoICpzcGxhc2ggPSBjb250YWluZXJfb2YoY2xpZW50LCBzdHJ1Y3QgZHJtX2Jvb3Rz
cGxhc2gsIGNsaWVudCk7CisKKwlEUk1fREVCVUdfS01TKCIlczogSU5cbiIsIF9fZnVuY19fKTsK
KworCW11dGV4X2xvY2soJnNwbGFzaC0+bG9jayk7CisJc3BsYXNoLT5zdG9wID0gdHJ1ZTsKKwlt
dXRleF91bmxvY2soJnNwbGFzaC0+bG9jayk7CisKKwlmbHVzaF93b3JrKCZzcGxhc2gtPndvcmtl
cik7CisKKwlkcm1fY2xpZW50X3JlbGVhc2UoY2xpZW50KTsKKwlrZnJlZShzcGxhc2gpOworCisJ
dW5yZWdpc3Rlcl9rZXlib2FyZF9ub3RpZmllcigmZHJtX2Jvb3RzcGxhc2hfa2V5Ym9hcmRfbm90
aWZpZXJfYmxvY2spOworCisJRFJNX0RFQlVHX0tNUygiJXM6IE9VVFxuIiwgX19mdW5jX18pOwor
fQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jbGllbnRfZnVuY3MgZHJtX2Jvb3RzcGxhc2hf
Y2xpZW50X2Z1bmNzID0geworCS5vd25lcgkJPSBUSElTX01PRFVMRSwKKwkudW5yZWdpc3Rlcgk9
IGRybV9ib290c3BsYXNoX2NsaWVudF91bnJlZ2lzdGVyLAorCS5ob3RwbHVnCT0gZHJtX2Jvb3Rz
cGxhc2hfY2xpZW50X2hvdHBsdWcsCit9OworCit2b2lkIGRybV9ib290c3BsYXNoX2NsaWVudF9y
ZWdpc3RlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCXN0cnVjdCBkcm1fYm9vdHNwbGFz
aCAqc3BsYXNoOworCWludCByZXQ7CisKKwlpZiAoIWRybV9ib290c3BsYXNoX2VuYWJsZWQpCisJ
CXJldHVybjsKKworCXNwbGFzaCA9IGt6YWxsb2Moc2l6ZW9mKCpzcGxhc2gpLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIXNwbGFzaCkKKwkJcmV0dXJuOworCisJcmV0ID0gZHJtX2NsaWVudF9pbml0KGRl
diwgJnNwbGFzaC0+Y2xpZW50LCAiYm9vdHNwbGFzaCIsICZkcm1fYm9vdHNwbGFzaF9jbGllbnRf
ZnVuY3MpOworCWlmIChyZXQpIHsKKwkJRFJNX0RFVl9FUlJPUihkZXYtPmRldiwgIkZhaWxlZCB0
byBjcmVhdGUgY2xpZW50LCByZXQ9JWRcbiIsIHJldCk7CisJCWtmcmVlKHNwbGFzaCk7CisJCXJl
dHVybjsKKwl9CisKKwkvKiBGb3IgdGhpcyBzaW1wbGUgZXhhbXBsZSBvbmx5IGFsbG93IHRoZSBm
aXJzdCAqLworCWRybV9ib290c3BsYXNoX2VuYWJsZWQgPSBmYWxzZTsKKworCW11dGV4X2luaXQo
JnNwbGFzaC0+bG9jayk7CisKKwlJTklUX1dPUksoJnNwbGFzaC0+d29ya2VyLCBkcm1fYm9vdHNw
bGFzaF93b3JrZXIpOworCisJcmVnaXN0ZXJfa2V5Ym9hcmRfbm90aWZpZXIoJmRybV9ib290c3Bs
YXNoX2tleWJvYXJkX25vdGlmaWVyX2Jsb2NrKTsKKworCWRybV9ib290c3BsYXNoX2NsaWVudF9o
b3RwbHVnKCZzcGxhc2gtPmNsaWVudCk7CisKKwlkcm1fY2xpZW50X3JlZ2lzdGVyKCZzcGxhc2gt
PmNsaWVudCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnQuYwppbmRleCA0MTA1NzJmMTQyNTcuLjI4MTNiMGNi
ZGYzOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jCkBAIC0xNjEsNiArMTYxLDEzIEBAIHZvaWQgZHJtX2Ns
aWVudF9yZWxlYXNlKHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50KQogfQogRVhQT1JUX1NZ
TUJPTChkcm1fY2xpZW50X3JlbGVhc2UpOwogCit2b2lkIGRybV9jbGllbnRfZGV2X3JlZ2lzdGVy
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCit7CisjaWYgQ09ORklHX0RSTV9DTElFTlRfQk9PVFNQ
TEFTSAorCWRybV9ib290c3BsYXNoX2NsaWVudF9yZWdpc3RlcihkZXYpOworI2VuZGlmCit9CisK
IHZvaWQgZHJtX2NsaWVudF9kZXZfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQog
ewogCXN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50LCAqdG1wOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2RybV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHJ2LmMKaW5kZXgg
OTVhNTVkOThlMTUyLi43NTRlMzRhZWQ5MmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9k
cm1fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9kcnYuYwpAQCAtMTAxNyw2ICsxMDE3
LDEwIEBAIGludCBkcm1fZGV2X3JlZ2lzdGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2ln
bmVkIGxvbmcgZmxhZ3MpCiAJZHJtX21pbm9yX3VucmVnaXN0ZXIoZGV2LCBEUk1fTUlOT1JfUkVO
REVSKTsKIG91dF91bmxvY2s6CiAJbXV0ZXhfdW5sb2NrKCZkcm1fZ2xvYmFsX211dGV4KTsKKwor
CWlmICghcmV0KQorCQlkcm1fY2xpZW50X2Rldl9yZWdpc3RlcihkZXYpOworCiAJcmV0dXJuIHJl
dDsKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2Rldl9yZWdpc3Rlcik7CmRpZmYgLS1naXQgYS9pbmNs
dWRlL2RybS9kcm1fY2xpZW50LmggYi9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmgKaW5kZXggZjJk
NWVkNzQ1NzMzLi5lOWViNzcwMDkzZmIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9jbGll
bnQuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmgKQEAgLTEwNyw2ICsxMDcsNyBAQCBp
bnQgZHJtX2NsaWVudF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fY2xp
ZW50X2RldiAqY2xpZW50LAogdm9pZCBkcm1fY2xpZW50X3JlbGVhc2Uoc3RydWN0IGRybV9jbGll
bnRfZGV2ICpjbGllbnQpOwogdm9pZCBkcm1fY2xpZW50X3JlZ2lzdGVyKHN0cnVjdCBkcm1fY2xp
ZW50X2RldiAqY2xpZW50KTsKIAordm9pZCBkcm1fY2xpZW50X2Rldl9yZWdpc3RlcihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KTsKIHZvaWQgZHJtX2NsaWVudF9kZXZfdW5yZWdpc3RlcihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KTsKIHZvaWQgZHJtX2NsaWVudF9kZXZfaG90cGx1ZyhzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KTsKIHZvaWQgZHJtX2NsaWVudF9kZXZfcmVzdG9yZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KTsKQEAgLTE4Myw0ICsxODQsNiBAQCBpbnQgZHJtX2NsaWVudF9tb2Rlc2V0X2Rw
bXMoc3RydWN0IGRybV9jbGllbnRfZGV2ICpjbGllbnQsIGludCBtb2RlKTsKIAogaW50IGRybV9j
bGllbnRfZGVidWdmc19pbml0KHN0cnVjdCBkcm1fbWlub3IgKm1pbm9yKTsKIAordm9pZCBkcm1f
Ym9vdHNwbGFzaF9jbGllbnRfcmVnaXN0ZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CisKICNl
bmRpZgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
