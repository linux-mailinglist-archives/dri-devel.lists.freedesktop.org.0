Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C2B7030F7E
	for <lists+dri-devel@lfdr.de>; Fri, 31 May 2019 16:02:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F1AE0894DE;
	Fri, 31 May 2019 14:01:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D1C43893D5;
 Fri, 31 May 2019 14:01:58 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:52318
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hWi6W-0002XY-Sh; Fri, 31 May 2019 16:01:56 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 1/8] drm/atomic: Move
 __drm_atomic_helper_disable_plane/set_config()
Date: Fri, 31 May 2019 16:01:10 +0200
Message-Id: <20190531140117.37751-2-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190531140117.37751-1-noralf@tronnes.org>
References: <20190531140117.37751-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=F3aPRxr2XVcmZ7eg8F6C4CdHQniq6HDEm0ETkWEFNrY=; 
 b=DBPVNHO3IGqq8VSVTvCAzrgJ/oYlMw/kyR0mDyLBx4jrSFjhZFfZWjr+wOKA0rntmpaFUzdD87ODzNqEU1ZHlaqUwZG5PwexP7SSdtcJDXDCQ9h8Zm+6LzwjWTsJcv3G6+qSmeDgdfefVzPR9euls5dWTLiYqLosOY1GHYrMbUE65NIOiUQ/ZmpOi9P659OX4d5JsV6/32L/ADeJsUVBb6khIm191ktHxNUiDehy6lV/FPkyqwPpeg+SbJ+vXW5t8Dg5EXWDCwZ3acrZbEQMNi/nLCVsYJG9B9kuD0eWHY36ECtYaD/5n9Dggv7b22eelbHGPPhuYi+DwbX2umJdEg==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>, intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UHJlcGFyZSBmb3IgbW92aW5nIGRybV9mYl9oZWxwZXIgbW9kZXNldHRpbmcgY29kZSB0byBkcm1f
Y2xpZW50Lgpkcm1fY2xpZW50IHdpbGwgYmUgbGlua2VkIHRvIGRybS5rbywgc28gbW92ZQpfX2Ry
bV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUoKSBhbmQgX19kcm1fYXRvbWljX2hlbHBlcl9z
ZXRfY29uZmlnKCkKb3V0IG9mIGRybV9rbXNfaGVscGVyLmtvLgoKV2hpbGUgYXQgaXQsIGZpeCB0
d28gY2hlY2twYXRjaCBjb21wbGFpbnRzOgotIFdBUk5JTkc6IEJsb2NrIGNvbW1lbnRzIHVzZSBh
IHRyYWlsaW5nICovIG9uIGEgc2VwYXJhdGUgbGluZQotIENIRUNLOiBBbGlnbm1lbnQgc2hvdWxk
IG1hdGNoIG9wZW4gcGFyZW50aGVzaXMKCnY3OiBEZWNsYXJlIGRybV9tb2RlX3NldCBhbmQgZHJt
X3BsYW5lX3N0YXRlCgpTaWduZWQtb2ZmLWJ5OiBOb3JhbGYgVHLDuG5uZXMgPG5vcmFsZkB0cm9u
bmVzLm9yZz4KUmV2aWV3ZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwu
Y2g+ClJldmlld2VkLWJ5OiBNYXhpbWUgUmlwYXJkIDxtYXhpbWUucmlwYXJkQGJvb3RsaW4uY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMgICAgICAgIHwgMTY4ICsrKysrKysr
KysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5j
IHwgMTY0IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9j
cnRjX2ludGVybmFsLmggfCAgIDcgKysKIGluY2x1ZGUvZHJtL2RybV9hdG9taWNfaGVscGVyLmgg
ICAgIHwgICA0IC0KIDQgZmlsZXMgY2hhbmdlZCwgMTc1IGluc2VydGlvbnMoKyksIDE2OCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jIGIvZHJp
dmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwppbmRleCBiNjQwZTc3MTg0ZTUuLjE2OWYwNmQ3YzVj
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2F0b21pYy5jCkBAIC0xMTc5LDYgKzExNzksMTc0IEBAIGludCBkcm1fYXRv
bWljX25vbmJsb2NraW5nX2NvbW1pdChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB9
CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfbm9uYmxvY2tpbmdfY29tbWl0KTsKIAorLyoganVz
dCB1c2VkIGZyb20gZHJtLWNsaWVudCBhbmQgYXRvbWljLWhlbHBlcjogKi8KK2ludCBfX2RybV9h
dG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJCQkJ
ICAgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJaW50IHJldDsK
KworCXJldCA9IGRybV9hdG9taWNfc2V0X2NydGNfZm9yX3BsYW5lKHBsYW5lX3N0YXRlLCBOVUxM
KTsKKwlpZiAocmV0ICE9IDApCisJCXJldHVybiByZXQ7CisKKwlkcm1fYXRvbWljX3NldF9mYl9m
b3JfcGxhbmUocGxhbmVfc3RhdGUsIE5VTEwpOworCXBsYW5lX3N0YXRlLT5jcnRjX3ggPSAwOwor
CXBsYW5lX3N0YXRlLT5jcnRjX3kgPSAwOworCXBsYW5lX3N0YXRlLT5jcnRjX3cgPSAwOworCXBs
YW5lX3N0YXRlLT5jcnRjX2ggPSAwOworCXBsYW5lX3N0YXRlLT5zcmNfeCA9IDA7CisJcGxhbmVf
c3RhdGUtPnNyY195ID0gMDsKKwlwbGFuZV9zdGF0ZS0+c3JjX3cgPSAwOworCXBsYW5lX3N0YXRl
LT5zcmNfaCA9IDA7CisKKwlyZXR1cm4gMDsKK30KK0VYUE9SVF9TWU1CT0woX19kcm1fYXRvbWlj
X2hlbHBlcl9kaXNhYmxlX3BsYW5lKTsKKworc3RhdGljIGludCB1cGRhdGVfb3V0cHV0X3N0YXRl
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX21v
ZGVfc2V0ICpzZXQpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHNldC0+Y3J0Yy0+ZGV2
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19j
cnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJc3RydWN0IGRy
bV9jb25uZWN0b3Jfc3RhdGUgKm5ld19jb25uX3N0YXRlOworCWludCByZXQsIGk7CisKKwlyZXQg
PSBkcm1fbW9kZXNldF9sb2NrKCZkZXYtPm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgsCisJ
CQkgICAgICAgc3RhdGUtPmFjcXVpcmVfY3R4KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJLyogRmlyc3QgZGlzYWJsZSBhbGwgY29ubmVjdG9ycyBvbiB0aGUgdGFyZ2V0IGNydGMuICov
CisJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfY29ubmVjdG9ycyhzdGF0ZSwgc2V0LT5j
cnRjKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rv
cl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBuZXdfY29ubl9zdGF0ZSwgaSkgeworCQlpZiAo
bmV3X2Nvbm5fc3RhdGUtPmNydGMgPT0gc2V0LT5jcnRjKSB7CisJCQlyZXQgPSBkcm1fYXRvbWlj
X3NldF9jcnRjX2Zvcl9jb25uZWN0b3IobmV3X2Nvbm5fc3RhdGUsCisJCQkJCQkJCU5VTEwpOwor
CQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCisJCQkvKiBNYWtlIHN1cmUgbGVnYWN5IHNl
dENydGMgYWx3YXlzIHJlLXRyYWlucyAqLworCQkJbmV3X2Nvbm5fc3RhdGUtPmxpbmtfc3RhdHVz
ID0gRFJNX0xJTktfU1RBVFVTX0dPT0Q7CisJCX0KKwl9CisKKwkvKiBUaGVuIHNldCBhbGwgY29u
bmVjdG9ycyBmcm9tIHNldC0+Y29ubmVjdG9ycyBvbiB0aGUgdGFyZ2V0IGNydGMgKi8KKwlmb3Ig
KGkgPSAwOyBpIDwgc2V0LT5udW1fY29ubmVjdG9yczsgaSsrKSB7CisJCW5ld19jb25uX3N0YXRl
ID0gZHJtX2F0b21pY19nZXRfY29ubmVjdG9yX3N0YXRlKHN0YXRlLAorCQkJCQkJCQlzZXQtPmNv
bm5lY3RvcnNbaV0pOworCQlpZiAoSVNfRVJSKG5ld19jb25uX3N0YXRlKSkKKwkJCXJldHVybiBQ
VFJfRVJSKG5ld19jb25uX3N0YXRlKTsKKworCQlyZXQgPSBkcm1fYXRvbWljX3NldF9jcnRjX2Zv
cl9jb25uZWN0b3IobmV3X2Nvbm5fc3RhdGUsCisJCQkJCQkJc2V0LT5jcnRjKTsKKwkJaWYgKHJl
dCkKKwkJCXJldHVybiByZXQ7CisJfQorCisJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3Rh
dGUsIGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCS8qCisJCSAqIERvbid0IHVwZGF0ZSAt
PmVuYWJsZSBmb3IgdGhlIENSVEMgaW4gdGhlIHNldF9jb25maWcgcmVxdWVzdCwKKwkJICogc2lu
Y2UgYSBtaXNtYXRjaCB3b3VsZCBpbmRpY2F0ZSBhIGJ1ZyBpbiB0aGUgdXBwZXIgbGF5ZXJzLgor
CQkgKiBUaGUgYWN0dWFsIG1vZGVzZXQgY29kZSBsYXRlciBvbiB3aWxsIGNhdGNoIGFueQorCQkg
KiBpbmNvbnNpc3RlbmNpZXMgaGVyZS4KKwkJICovCisJCWlmIChjcnRjID09IHNldC0+Y3J0YykK
KwkJCWNvbnRpbnVlOworCisJCWlmICghbmV3X2NydGNfc3RhdGUtPmNvbm5lY3Rvcl9tYXNrKSB7
CisJCQlyZXQgPSBkcm1fYXRvbWljX3NldF9tb2RlX3Byb3BfZm9yX2NydGMobmV3X2NydGNfc3Rh
dGUsCisJCQkJCQkJCU5VTEwpOworCQkJaWYgKHJldCA8IDApCisJCQkJcmV0dXJuIHJldDsKKwor
CQkJbmV3X2NydGNfc3RhdGUtPmFjdGl2ZSA9IGZhbHNlOworCQl9CisJfQorCisJcmV0dXJuIDA7
Cit9CisKKy8qIGp1c3QgdXNlZCBmcm9tIGRybS1jbGllbnQgYW5kIGF0b21pYy1oZWxwZXI6ICov
CitpbnQgX19kcm1fYXRvbWljX2hlbHBlcl9zZXRfY29uZmlnKHN0cnVjdCBkcm1fbW9kZV9zZXQg
KnNldCwKKwkJCQkgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBy
aW1hcnlfc3RhdGU7CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gc2V0LT5jcnRjOworCWludCBo
ZGlzcGxheSwgdmRpc3BsYXk7CisJaW50IHJldDsKKworCWNydGNfc3RhdGUgPSBkcm1fYXRvbWlj
X2dldF9jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKQor
CQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsKKworCXByaW1hcnlfc3RhdGUgPSBkcm1fYXRv
bWljX2dldF9wbGFuZV9zdGF0ZShzdGF0ZSwgY3J0Yy0+cHJpbWFyeSk7CisJaWYgKElTX0VSUihw
cmltYXJ5X3N0YXRlKSkKKwkJcmV0dXJuIFBUUl9FUlIocHJpbWFyeV9zdGF0ZSk7CisKKwlpZiAo
IXNldC0+bW9kZSkgeworCQlXQVJOX09OKHNldC0+ZmIpOworCQlXQVJOX09OKHNldC0+bnVtX2Nv
bm5lY3RvcnMpOworCisJCXJldCA9IGRybV9hdG9taWNfc2V0X21vZGVfZm9yX2NydGMoY3J0Y19z
dGF0ZSwgTlVMTCk7CisJCWlmIChyZXQgIT0gMCkKKwkJCXJldHVybiByZXQ7CisKKwkJY3J0Y19z
dGF0ZS0+YWN0aXZlID0gZmFsc2U7CisKKwkJcmV0ID0gZHJtX2F0b21pY19zZXRfY3J0Y19mb3Jf
cGxhbmUocHJpbWFyeV9zdGF0ZSwgTlVMTCk7CisJCWlmIChyZXQgIT0gMCkKKwkJCXJldHVybiBy
ZXQ7CisKKwkJZHJtX2F0b21pY19zZXRfZmJfZm9yX3BsYW5lKHByaW1hcnlfc3RhdGUsIE5VTEwp
OworCisJCWdvdG8gY29tbWl0OworCX0KKworCVdBUk5fT04oIXNldC0+ZmIpOworCVdBUk5fT04o
IXNldC0+bnVtX2Nvbm5lY3RvcnMpOworCisJcmV0ID0gZHJtX2F0b21pY19zZXRfbW9kZV9mb3Jf
Y3J0YyhjcnRjX3N0YXRlLCBzZXQtPm1vZGUpOworCWlmIChyZXQgIT0gMCkKKwkJcmV0dXJuIHJl
dDsKKworCWNydGNfc3RhdGUtPmFjdGl2ZSA9IHRydWU7CisKKwlyZXQgPSBkcm1fYXRvbWljX3Nl
dF9jcnRjX2Zvcl9wbGFuZShwcmltYXJ5X3N0YXRlLCBjcnRjKTsKKwlpZiAocmV0ICE9IDApCisJ
CXJldHVybiByZXQ7CisKKwlkcm1fbW9kZV9nZXRfaHZfdGltaW5nKHNldC0+bW9kZSwgJmhkaXNw
bGF5LCAmdmRpc3BsYXkpOworCisJZHJtX2F0b21pY19zZXRfZmJfZm9yX3BsYW5lKHByaW1hcnlf
c3RhdGUsIHNldC0+ZmIpOworCXByaW1hcnlfc3RhdGUtPmNydGNfeCA9IDA7CisJcHJpbWFyeV9z
dGF0ZS0+Y3J0Y195ID0gMDsKKwlwcmltYXJ5X3N0YXRlLT5jcnRjX3cgPSBoZGlzcGxheTsKKwlw
cmltYXJ5X3N0YXRlLT5jcnRjX2ggPSB2ZGlzcGxheTsKKwlwcmltYXJ5X3N0YXRlLT5zcmNfeCA9
IHNldC0+eCA8PCAxNjsKKwlwcmltYXJ5X3N0YXRlLT5zcmNfeSA9IHNldC0+eSA8PCAxNjsKKwlp
ZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwcmltYXJ5X3N0YXRlLT5yb3RhdGlvbikpIHsKKwkJ
cHJpbWFyeV9zdGF0ZS0+c3JjX3cgPSB2ZGlzcGxheSA8PCAxNjsKKwkJcHJpbWFyeV9zdGF0ZS0+
c3JjX2ggPSBoZGlzcGxheSA8PCAxNjsKKwl9IGVsc2UgeworCQlwcmltYXJ5X3N0YXRlLT5zcmNf
dyA9IGhkaXNwbGF5IDw8IDE2OworCQlwcmltYXJ5X3N0YXRlLT5zcmNfaCA9IHZkaXNwbGF5IDw8
IDE2OworCX0KKworY29tbWl0OgorCXJldCA9IHVwZGF0ZV9vdXRwdXRfc3RhdGUoc3RhdGUsIHNl
dCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZ
TUJPTChfX2RybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcpOworCiB2b2lkIGRybV9hdG9taWNf
cHJpbnRfc3RhdGUoY29uc3Qgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogewogCXN0
cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2luZm9fcHJpbnRlcihzdGF0ZS0+ZGV2LT5kZXYpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwppbmRleCBhY2Y5OTNjYjhlNTIuLjBmYzYzZDY4
MjI0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTI4NDQsOTUgKzI4NDQs
NiBAQCBpbnQgZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZShzdHJ1Y3QgZHJtX3BsYW5l
ICpwbGFuZSwKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFu
ZSk7CiAKLS8qIGp1c3QgdXNlZCBmcm9tIGZiLWhlbHBlciBhbmQgYXRvbWljLWhlbHBlcjogKi8K
LWludCBfX2RybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUoc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCi0JCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWludCBy
ZXQ7Ci0KLQlyZXQgPSBkcm1fYXRvbWljX3NldF9jcnRjX2Zvcl9wbGFuZShwbGFuZV9zdGF0ZSwg
TlVMTCk7Ci0JaWYgKHJldCAhPSAwKQotCQlyZXR1cm4gcmV0OwotCi0JZHJtX2F0b21pY19zZXRf
ZmJfZm9yX3BsYW5lKHBsYW5lX3N0YXRlLCBOVUxMKTsKLQlwbGFuZV9zdGF0ZS0+Y3J0Y194ID0g
MDsKLQlwbGFuZV9zdGF0ZS0+Y3J0Y195ID0gMDsKLQlwbGFuZV9zdGF0ZS0+Y3J0Y193ID0gMDsK
LQlwbGFuZV9zdGF0ZS0+Y3J0Y19oID0gMDsKLQlwbGFuZV9zdGF0ZS0+c3JjX3ggPSAwOwotCXBs
YW5lX3N0YXRlLT5zcmNfeSA9IDA7Ci0JcGxhbmVfc3RhdGUtPnNyY193ID0gMDsKLQlwbGFuZV9z
dGF0ZS0+c3JjX2ggPSAwOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgdXBkYXRlX291
dHB1dF9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0JCQkgICAgICAgc3Ry
dWN0IGRybV9tb2RlX3NldCAqc2V0KQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzZXQt
PmNydGMtPmRldjsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7Ci0Jc3RydWN0IGRybV9jcnRjX3N0
YXRlICpuZXdfY3J0Y19zdGF0ZTsKLQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwot
CXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpuZXdfY29ubl9zdGF0ZTsKLQlpbnQgcmV0LCBp
OwotCi0JcmV0ID0gZHJtX21vZGVzZXRfbG9jaygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9u
X211dGV4LAotCQkJICAgICAgIHN0YXRlLT5hY3F1aXJlX2N0eCk7Ci0JaWYgKHJldCkKLQkJcmV0
dXJuIHJldDsKLQotCS8qIEZpcnN0IGRpc2FibGUgYWxsIGNvbm5lY3RvcnMgb24gdGhlIHRhcmdl
dCBjcnRjLiAqLwotCXJldCA9IGRybV9hdG9taWNfYWRkX2FmZmVjdGVkX2Nvbm5lY3RvcnMoc3Rh
dGUsIHNldC0+Y3J0Yyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWZvcl9lYWNoX25l
d19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgbmV3X2Nvbm5fc3RhdGUsIGkp
IHsKLQkJaWYgKG5ld19jb25uX3N0YXRlLT5jcnRjID09IHNldC0+Y3J0YykgewotCQkJcmV0ID0g
ZHJtX2F0b21pY19zZXRfY3J0Y19mb3JfY29ubmVjdG9yKG5ld19jb25uX3N0YXRlLAotCQkJCQkJ
CQlOVUxMKTsKLQkJCWlmIChyZXQpCi0JCQkJcmV0dXJuIHJldDsKLQotCQkJLyogTWFrZSBzdXJl
IGxlZ2FjeSBzZXRDcnRjIGFsd2F5cyByZS10cmFpbnMgKi8KLQkJCW5ld19jb25uX3N0YXRlLT5s
aW5rX3N0YXR1cyA9IERSTV9MSU5LX1NUQVRVU19HT09EOwotCQl9Ci0JfQotCi0JLyogVGhlbiBz
ZXQgYWxsIGNvbm5lY3RvcnMgZnJvbSBzZXQtPmNvbm5lY3RvcnMgb24gdGhlIHRhcmdldCBjcnRj
ICovCi0JZm9yIChpID0gMDsgaSA8IHNldC0+bnVtX2Nvbm5lY3RvcnM7IGkrKykgewotCQluZXdf
Y29ubl9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSwKLQkJCQkJ
CQkgICAgc2V0LT5jb25uZWN0b3JzW2ldKTsKLQkJaWYgKElTX0VSUihuZXdfY29ubl9zdGF0ZSkp
Ci0JCQlyZXR1cm4gUFRSX0VSUihuZXdfY29ubl9zdGF0ZSk7Ci0KLQkJcmV0ID0gZHJtX2F0b21p
Y19zZXRfY3J0Y19mb3JfY29ubmVjdG9yKG5ld19jb25uX3N0YXRlLAotCQkJCQkJCXNldC0+Y3J0
Yyk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCWZvcl9lYWNoX25ld19jcnRj
X2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkgewotCQkvKiBEb24ndCB1
cGRhdGUgLT5lbmFibGUgZm9yIHRoZSBDUlRDIGluIHRoZSBzZXRfY29uZmlnIHJlcXVlc3QsCi0J
CSAqIHNpbmNlIGEgbWlzbWF0Y2ggd291bGQgaW5kaWNhdGUgYSBidWcgaW4gdGhlIHVwcGVyIGxh
eWVycy4KLQkJICogVGhlIGFjdHVhbCBtb2Rlc2V0IGNvZGUgbGF0ZXIgb24gd2lsbCBjYXRjaCBh
bnkKLQkJICogaW5jb25zaXN0ZW5jaWVzIGhlcmUuICovCi0JCWlmIChjcnRjID09IHNldC0+Y3J0
YykKLQkJCWNvbnRpbnVlOwotCi0JCWlmICghbmV3X2NydGNfc3RhdGUtPmNvbm5lY3Rvcl9tYXNr
KSB7Ci0JCQlyZXQgPSBkcm1fYXRvbWljX3NldF9tb2RlX3Byb3BfZm9yX2NydGMobmV3X2NydGNf
c3RhdGUsCi0JCQkJCQkJCU5VTEwpOwotCQkJaWYgKHJldCA8IDApCi0JCQkJcmV0dXJuIHJldDsK
LQotCQkJbmV3X2NydGNfc3RhdGUtPmFjdGl2ZSA9IGZhbHNlOwotCQl9Ci0JfQotCi0JcmV0dXJu
IDA7Ci19Ci0KIC8qKgogICogZHJtX2F0b21pY19oZWxwZXJfc2V0X2NvbmZpZyAtIHNldCBhIG5l
dyBjb25maWcgZnJvbSB1c2Vyc3BhY2UKICAqIEBzZXQ6IG1vZGUgc2V0IGNvbmZpZ3VyYXRpb24K
QEAgLTI5NzcsODEgKzI4ODgsNiBAQCBpbnQgZHJtX2F0b21pY19oZWxwZXJfc2V0X2NvbmZpZyhz
dHJ1Y3QgZHJtX21vZGVfc2V0ICpzZXQsCiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVs
cGVyX3NldF9jb25maWcpOwogCi0vKiBqdXN0IHVzZWQgZnJvbSBmYi1oZWxwZXIgYW5kIGF0b21p
Yy1oZWxwZXI6ICovCi1pbnQgX19kcm1fYXRvbWljX2hlbHBlcl9zZXRfY29uZmlnKHN0cnVjdCBk
cm1fbW9kZV9zZXQgKnNldCwKLQkJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQotewot
CXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQlzdHJ1Y3QgZHJtX3BsYW5lX3N0
YXRlICpwcmltYXJ5X3N0YXRlOwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHNldC0+Y3J0YzsK
LQlpbnQgaGRpc3BsYXksIHZkaXNwbGF5OwotCWludCByZXQ7Ci0KLQljcnRjX3N0YXRlID0gZHJt
X2F0b21pY19nZXRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7Ci0JaWYgKElTX0VSUihjcnRjX3N0
YXRlKSkKLQkJcmV0dXJuIFBUUl9FUlIoY3J0Y19zdGF0ZSk7Ci0KLQlwcmltYXJ5X3N0YXRlID0g
ZHJtX2F0b21pY19nZXRfcGxhbmVfc3RhdGUoc3RhdGUsIGNydGMtPnByaW1hcnkpOwotCWlmIChJ
U19FUlIocHJpbWFyeV9zdGF0ZSkpCi0JCXJldHVybiBQVFJfRVJSKHByaW1hcnlfc3RhdGUpOwot
Ci0JaWYgKCFzZXQtPm1vZGUpIHsKLQkJV0FSTl9PTihzZXQtPmZiKTsKLQkJV0FSTl9PTihzZXQt
Pm51bV9jb25uZWN0b3JzKTsKLQotCQlyZXQgPSBkcm1fYXRvbWljX3NldF9tb2RlX2Zvcl9jcnRj
KGNydGNfc3RhdGUsIE5VTEwpOwotCQlpZiAocmV0ICE9IDApCi0JCQlyZXR1cm4gcmV0OwotCi0J
CWNydGNfc3RhdGUtPmFjdGl2ZSA9IGZhbHNlOwotCi0JCXJldCA9IGRybV9hdG9taWNfc2V0X2Ny
dGNfZm9yX3BsYW5lKHByaW1hcnlfc3RhdGUsIE5VTEwpOwotCQlpZiAocmV0ICE9IDApCi0JCQly
ZXR1cm4gcmV0OwotCi0JCWRybV9hdG9taWNfc2V0X2ZiX2Zvcl9wbGFuZShwcmltYXJ5X3N0YXRl
LCBOVUxMKTsKLQotCQlnb3RvIGNvbW1pdDsKLQl9Ci0KLQlXQVJOX09OKCFzZXQtPmZiKTsKLQlX
QVJOX09OKCFzZXQtPm51bV9jb25uZWN0b3JzKTsKLQotCXJldCA9IGRybV9hdG9taWNfc2V0X21v
ZGVfZm9yX2NydGMoY3J0Y19zdGF0ZSwgc2V0LT5tb2RlKTsKLQlpZiAocmV0ICE9IDApCi0JCXJl
dHVybiByZXQ7Ci0KLQljcnRjX3N0YXRlLT5hY3RpdmUgPSB0cnVlOwotCi0JcmV0ID0gZHJtX2F0
b21pY19zZXRfY3J0Y19mb3JfcGxhbmUocHJpbWFyeV9zdGF0ZSwgY3J0Yyk7Ci0JaWYgKHJldCAh
PSAwKQotCQlyZXR1cm4gcmV0OwotCi0JZHJtX21vZGVfZ2V0X2h2X3RpbWluZyhzZXQtPm1vZGUs
ICZoZGlzcGxheSwgJnZkaXNwbGF5KTsKLQotCWRybV9hdG9taWNfc2V0X2ZiX2Zvcl9wbGFuZShw
cmltYXJ5X3N0YXRlLCBzZXQtPmZiKTsKLQlwcmltYXJ5X3N0YXRlLT5jcnRjX3ggPSAwOwotCXBy
aW1hcnlfc3RhdGUtPmNydGNfeSA9IDA7Ci0JcHJpbWFyeV9zdGF0ZS0+Y3J0Y193ID0gaGRpc3Bs
YXk7Ci0JcHJpbWFyeV9zdGF0ZS0+Y3J0Y19oID0gdmRpc3BsYXk7Ci0JcHJpbWFyeV9zdGF0ZS0+
c3JjX3ggPSBzZXQtPnggPDwgMTY7Ci0JcHJpbWFyeV9zdGF0ZS0+c3JjX3kgPSBzZXQtPnkgPDwg
MTY7Ci0JaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocHJpbWFyeV9zdGF0ZS0+cm90YXRpb24p
KSB7Ci0JCXByaW1hcnlfc3RhdGUtPnNyY193ID0gdmRpc3BsYXkgPDwgMTY7Ci0JCXByaW1hcnlf
c3RhdGUtPnNyY19oID0gaGRpc3BsYXkgPDwgMTY7Ci0JfSBlbHNlIHsKLQkJcHJpbWFyeV9zdGF0
ZS0+c3JjX3cgPSBoZGlzcGxheSA8PCAxNjsKLQkJcHJpbWFyeV9zdGF0ZS0+c3JjX2ggPSB2ZGlz
cGxheSA8PCAxNjsKLQl9Ci0KLWNvbW1pdDoKLQlyZXQgPSB1cGRhdGVfb3V0cHV0X3N0YXRlKHN0
YXRlLCBzZXQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXR1cm4gMDsKLX0KLQog
LyoqCiAgKiBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX2FsbCAtIGRpc2FibGUgYWxsIGN1cnJl
bnRseSBhY3RpdmUgb3V0cHV0cwogICogQGRldjogRFJNIGRldmljZQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2RybV9jcnRjX2ludGVybmFsLmggYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2Ny
dGNfaW50ZXJuYWwuaAppbmRleCBjNzhhNDRmYWQxM2QuLmM3ZDVlNGMyMTQyMyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9jcnRjX2ludGVybmFsLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2RybV9jcnRjX2ludGVybmFsLmgKQEAgLTUwLDcgKzUwLDkgQEAgc3RydWN0IGRybV9tb2Rl
X2NyZWF0ZV9kdW1iOwogc3RydWN0IGRybV9tb2RlX2ZiX2NtZDI7CiBzdHJ1Y3QgZHJtX21vZGVf
ZmJfY21kOwogc3RydWN0IGRybV9tb2RlX29iamVjdDsKK3N0cnVjdCBkcm1fbW9kZV9zZXQ7CiBz
dHJ1Y3QgZHJtX3BsYW5lOworc3RydWN0IGRybV9wbGFuZV9zdGF0ZTsKIHN0cnVjdCBkcm1fcHJv
cGVydHk7CiBzdHJ1Y3QgZWRpZDsKIHN0cnVjdCBrcmVmOwpAQCAtMjIzLDYgKzIyNSwxMSBAQCBz
dHJ1Y3QgZHJtX21pbm9yOwogaW50IGRybV9hdG9taWNfZGVidWdmc19pbml0KHN0cnVjdCBkcm1f
bWlub3IgKm1pbm9yKTsKICNlbmRpZgogCitpbnQgX19kcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxl
X3BsYW5lKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgICAgIHN0cnVjdCBkcm1fcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKK2ludCBfX2RybV9hdG9taWNfaGVscGVyX3NldF9jb25m
aWcoc3RydWN0IGRybV9tb2RlX3NldCAqc2V0LAorCQkJCSAgIHN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSk7CisKIHZvaWQgZHJtX2F0b21pY19wcmludF9zdGF0ZShjb25zdCBzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCiAvKiBkcm1fYXRvbWljX3VhcGkuYyAqLwpkaWZm
IC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2F0b21pY19oZWxwZXIuaCBiL2luY2x1ZGUvZHJtL2Ry
bV9hdG9taWNfaGVscGVyLmgKaW5kZXggNTgyMTRiZTNiZjNkLi5iZjRlMDcxNDFkODEgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9hdG9taWNfaGVscGVyLmgKKysrIGIvaW5jbHVkZS9kcm0v
ZHJtX2F0b21pY19oZWxwZXIuaApAQCAtMTE3LDEyICsxMTcsOCBAQCBpbnQgZHJtX2F0b21pY19o
ZWxwZXJfdXBkYXRlX3BsYW5lKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJCSAgIHN0cnVj
dCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KTsKIGludCBkcm1fYXRvbWljX2hlbHBlcl9k
aXNhYmxlX3BsYW5lKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJCSAgICBzdHJ1Y3QgZHJt
X21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7Ci1pbnQgX19kcm1fYXRvbWljX2hlbHBlcl9kaXNh
YmxlX3BsYW5lKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAotCQlzdHJ1Y3QgZHJtX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSk7CiBpbnQgZHJtX2F0b21pY19oZWxwZXJfc2V0X2NvbmZpZyhzdHJ1
Y3QgZHJtX21vZGVfc2V0ICpzZXQsCiAJCQkJIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0
eCAqY3R4KTsKLWludCBfX2RybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcoc3RydWN0IGRybV9t
b2RlX3NldCAqc2V0LAotCQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCiBpbnQg
ZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9hbGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJ
CQkgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KTsKLS0gCjIuMjAuMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
