Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9823C5ED28
	for <lists+dri-devel@lfdr.de>; Wed,  3 Jul 2019 22:05:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 22C216E1D2;
	Wed,  3 Jul 2019 20:05:26 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-io1-xd42.google.com (mail-io1-xd42.google.com
 [IPv6:2607:f8b0:4864:20::d42])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3B7626E1D2
 for <dri-devel@lists.freedesktop.org>; Wed,  3 Jul 2019 20:05:24 +0000 (UTC)
Received: by mail-io1-xd42.google.com with SMTP id w25so7810762ioc.8
 for <dri-devel@lists.freedesktop.org>; Wed, 03 Jul 2019 13:05:24 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=kqEnitbCuQNTiyOagSmB9O1Jt27cbSKjL3VEQXY7Em8=;
 b=OBK5nN+6q7ZtJmR0Zj4ReGwegCc26y+OyhCottHT2fDRaTu8C/LkV2unKDKjpqWxF6
 z5LU1fVwlMkaEa0ux4eQHnAAIez14vWZvUs7ZK8oJetu61AjiSU88XuW+R/7e12p9hSc
 hXHpgBWqHGoiND/l+0aDYXo7o+MseaV47I1J1YiG3J6uAKE+gltDLXd4ild2O92wJluc
 qFTlg7tbvPpSZaZSwMYr5+px5uXXVEAqQLKLeaSA1Zu3b/vKQ18KTEJJIY3fJKtrEiWz
 onujQ+XQP3QXTT0QBoLK7GLB5/dhnAyDwYQxtMqB8koND/gGOHjdd9zm9Arb7rBg166K
 jXGw==
X-Gm-Message-State: APjAAAWsBNMf0r7r8V9ghoBaiONzA5SSuu/JKsG4GneN0paa/w1wHzmN
 LLAzthe5ACXKD8mdnBHlSJKALFP+wdLKHKPk6OY=
X-Google-Smtp-Source: APXvYqxZ8HyHPX99/aoYvXgZb5VoZYVpGb5ESIdKjpl7055Rt2uCynd+OKBIpuA3clOgTMdVSDtSydrkWbQtwPPegI8=
X-Received: by 2002:a5d:97d8:: with SMTP id k24mr38615847ios.84.1562184323404; 
 Wed, 03 Jul 2019 13:05:23 -0700 (PDT)
MIME-Version: 1.0
References: <20190702141903.1131-1-kraxel@redhat.com>
 <20190702141903.1131-15-kraxel@redhat.com>
In-Reply-To: <20190702141903.1131-15-kraxel@redhat.com>
From: Chia-I Wu <olvaffe@gmail.com>
Date: Wed, 3 Jul 2019 13:05:12 -0700
Message-ID: <CAPaKu7T3GvYVMueYgJFhADFSFEVbHEdaupw8=mq_+i150a1mLA@mail.gmail.com>
Subject: Re: [PATCH v6 14/18] drm/virtio: rework
 virtio_gpu_transfer_from_host_ioctl fencing
To: Gerd Hoffmann <kraxel@redhat.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=kqEnitbCuQNTiyOagSmB9O1Jt27cbSKjL3VEQXY7Em8=;
 b=b+r2lBpF+vS1wp+p/taK6B6XjLdafrEjhJohY0axqo+JqrJWWugdMGX5Mxpmi2D2lQ
 +HpYL5SPDqvtGHfFOfXObcb8kwKPGBUvbHT4QGzY0pBCsfjp+pz9HQvoZU3AhHIX+Z0d
 UHau+sGaO1Ld8XauJEqNY8+5U05seFc0x/YF2UAzA3dJQeYFJ0T2nvjsEYH1q1WqU/bp
 4DEu9CT1dGozBWGGAyCoqDpWiv9TZLtRvnx1s24n41L9mvzHPX8AKuN7f+NtPU+zGgV6
 AX6xe5bEJKb3uwvHsRxrYckvkI7fR5/fjPzoY+CYuG32v25NhEKOHV5hluPRS47HG8eR
 J3LQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 ML dri-devel <dri-devel@lists.freedesktop.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Gurchetan Singh <gurchetansingh@chromium.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVHVlLCBKdWwgMiwgMjAxOSBhdCA3OjE5IEFNIEdlcmQgSG9mZm1hbm4gPGtyYXhlbEByZWRo
YXQuY29tPiB3cm90ZToKPgo+IFN3aXRjaCB0byB0aGUgdmlydGlvX2dwdV9hcnJheV8qIGhlbHBl
ciB3b3JrZmxvdy4KKGp1c3QgcmVwZWF0aW5nIG15IHF1ZXN0aW9uIG9uIHBhdGNoIDYpCgpEb2Vz
IHRoaXMgZml4IHRoZSBvYmogcmVmY291bnQgaXNzdWU/ICBXaGVuIHdhcyB0aGUgaXNzdWUgaW50
cm9kdWNlZD8KCj4KPiBTaWduZWQtb2ZmLWJ5OiBHZXJkIEhvZmZtYW5uIDxrcmF4ZWxAcmVkaGF0
LmNvbT4KPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oICAgfCAg
MyArKy0KPiAgZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMgfCAzNSArKysr
KysrKysrKy0tLS0tLS0tLS0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
dnEuYyAgICB8ICA4ICsrKystLQo+ICAzIGZpbGVzIGNoYW5nZWQsIDIzIGluc2VydGlvbnMoKyks
IDIzIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8v
dmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAo+IGlu
ZGV4IDc4ZGM1YTE5YTM1OC4uNGRmNzYwYmEwMThlIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8v
dmlydGdwdV9kcnYuaAo+IEBAIC0zMDIsOSArMzAyLDEwIEBAIHZvaWQgdmlydGlvX2dwdV9jbWRf
c3VibWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzLAo+ICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSk7Cj4g
IHZvaWQgdmlydGlvX2dwdV9jbWRfdHJhbnNmZXJfZnJvbV9ob3N0XzNkKHN0cnVjdCB2aXJ0aW9f
Z3B1X2RldmljZSAqdmdkZXYsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgcmVzb3VyY2VfaWQsIHVpbnQzMl90IGN0eF9pZCwKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCBjdHhfaWQsCj4gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDY0X3Qgb2Zmc2V0LCB1aW50
MzJfdCBsZXZlbCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBz
dHJ1Y3QgdmlydGlvX2dwdV9ib3ggKmJveCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMsCj4gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVf
ZmVuY2UgKmZlbmNlKTsKPiAgdm9pZCB2aXJ0aW9fZ3B1X2NtZF90cmFuc2Zlcl90b19ob3N0XzNk
KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCj4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8sCj4gZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0bC5jIGIvZHJpdmVycy9n
cHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKPiBpbmRleCAwZDBhY2YwYjg1ZWQuLjU2MTgy
YWJkYmYzNiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9j
dGwuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9pb2N0bC5jCj4gQEAg
LTI5OCw4ICsyOTgsNyBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfdHJhbnNmZXJfZnJvbV9ob3N0
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCj4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKPiAgICAgICAgIHN0cnVjdCB2aXJ0
aW9fZ3B1X2Zwcml2ICp2ZnByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKPiAgICAgICAgIHN0cnVj
dCBkcm1fdmlydGdwdV8zZF90cmFuc2Zlcl9mcm9tX2hvc3QgKmFyZ3MgPSBkYXRhOwo+IC0gICAg
ICAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnb2JqID0gTlVMTDsKPiAtICAgICAgIHN0cnVjdCB2
aXJ0aW9fZ3B1X29iamVjdCAqcW9iaiA9IE5VTEw7Cj4gKyAgICAgICBzdHJ1Y3QgdmlydGlvX2dw
dV9vYmplY3RfYXJyYXkgKm9ianM7Cj4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAq
ZmVuY2U7Cj4gICAgICAgICBpbnQgcmV0Owo+ICAgICAgICAgdTMyIG9mZnNldCA9IGFyZ3MtPm9m
ZnNldDsKPiBAQCAtMzA4LDM1ICszMDcsMzEgQEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1X3RyYW5z
ZmVyX2Zyb21faG9zdF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAo+ICAgICAgICAgaWYg
KHZnZGV2LT5oYXNfdmlyZ2xfM2QgPT0gZmFsc2UpCj4gICAgICAgICAgICAgICAgIHJldHVybiAt
RU5PU1lTOwo+Cj4gLSAgICAgICBnb2JqID0gZHJtX2dlbV9vYmplY3RfbG9va3VwKGZpbGUsIGFy
Z3MtPmJvX2hhbmRsZSk7Cj4gLSAgICAgICBpZiAoZ29iaiA9PSBOVUxMKQo+ICsgICAgICAgb2Jq
cyA9IHZpcnRpb19ncHVfYXJyYXlfZnJvbV9oYW5kbGVzKGZpbGUsICZhcmdzLT5ib19oYW5kbGUs
IDEpOwo+ICsgICAgICAgaWYgKG9ianMgPT0gTlVMTCkKPiAgICAgICAgICAgICAgICAgcmV0dXJu
IC1FTk9FTlQ7Cj4KPiAtICAgICAgIHFvYmogPSBnZW1fdG9fdmlydGlvX2dwdV9vYmooZ29iaik7
Cj4gLQo+IC0gICAgICAgcmV0ID0gdmlydGlvX2dwdV9vYmplY3RfcmVzZXJ2ZShxb2JqKTsKPiAt
ICAgICAgIGlmIChyZXQpCj4gLSAgICAgICAgICAgICAgIGdvdG8gb3V0Owo+ICsgICAgICAgcmV0
ID0gdmlydGlvX2dwdV9hcnJheV9sb2NrX3Jlc3Yob2Jqcyk7Cj4gKyAgICAgICBpZiAocmV0ICE9
IDApCj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyX3B1dF9mcmVlOwo+Cj4gICAgICAgICBjb252
ZXJ0X3RvX2h3X2JveCgmYm94LCAmYXJncy0+Ym94KTsKPgo+ICAgICAgICAgZmVuY2UgPSB2aXJ0
aW9fZ3B1X2ZlbmNlX2FsbG9jKHZnZGV2KTsKPiAgICAgICAgIGlmICghZmVuY2UpIHsKPiAgICAg
ICAgICAgICAgICAgcmV0ID0gLUVOT01FTTsKPiAtICAgICAgICAgICAgICAgZ290byBvdXRfdW5y
ZXM7Cj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyX3VubG9jazsKPiAgICAgICAgIH0KPiAgICAg
ICAgIHZpcnRpb19ncHVfY21kX3RyYW5zZmVyX2Zyb21faG9zdF8zZAo+IC0gICAgICAgICAgICAg
ICAodmdkZXYsIHFvYmotPmh3X3Jlc19oYW5kbGUsCj4gLSAgICAgICAgICAgICAgICB2ZnByaXYt
PmN0eF9pZCwgb2Zmc2V0LCBhcmdzLT5sZXZlbCwKPiAtICAgICAgICAgICAgICAgICZib3gsIGZl
bmNlKTsKPiAtICAgICAgIHJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5jZShxb2JqLT5i
YXNlLmJhc2UucmVzdiwKPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAmZmVuY2UtPmYpOwo+IC0KPiArICAgICAgICAgICAgICAgKHZnZGV2LCB2ZnByaXYtPmN0eF9p
ZCwgb2Zmc2V0LCBhcmdzLT5sZXZlbCwKPiArICAgICAgICAgICAgICAgICZib3gsIG9ianMsIGZl
bmNlKTsKPiAgICAgICAgIGRtYV9mZW5jZV9wdXQoJmZlbmNlLT5mKTsKPiAtb3V0X3VucmVzOgo+
IC0gICAgICAgdmlydGlvX2dwdV9vYmplY3RfdW5yZXNlcnZlKHFvYmopOwo+IC1vdXQ6Cj4gLSAg
ICAgICBkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoZ29iaik7Cj4gKyAgICAgICByZXR1cm4g
MDsKPiArCj4gK2Vycl91bmxvY2s6Cj4gKyAgICAgICB2aXJ0aW9fZ3B1X2FycmF5X3VubG9ja19y
ZXN2KG9ianMpOwo+ICtlcnJfcHV0X2ZyZWU6Cj4gKyAgICAgICB2aXJ0aW9fZ3B1X2FycmF5X3B1
dF9mcmVlKG9ianMpOwo+ICAgICAgICAgcmV0dXJuIHJldDsKPiAgfQo+Cj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jIGIvZHJpdmVycy9ncHUvZHJtL3Zp
cnRpby92aXJ0Z3B1X3ZxLmMKPiBpbmRleCBmYzkwOGQ1Y2IyMTcuLmJlZjcwMzZmNDUwOCAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfdnEuYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCj4gQEAgLTkyOCwyMCArOTI4LDI0IEBA
IHZvaWQgdmlydGlvX2dwdV9jbWRfdHJhbnNmZXJfdG9faG9zdF8zZChzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAo+ICB9Cj4KPiAgdm9pZCB2aXJ0aW9fZ3B1X2NtZF90cmFuc2Zlcl9m
cm9tX2hvc3RfM2Qoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2RldiwKPiAtICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aW50MzJfdCByZXNvdXJjZV9pZCwgdWlu
dDMyX3QgY3R4X2lkLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IGN0eF9pZCwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICB1aW50NjRfdCBvZmZzZXQsIHVpbnQzMl90IGxldmVsLAo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2JveCAqYm94LAo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1
X29iamVjdF9hcnJheSAqb2JqcywKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UpCj4gIHsKPiArICAgICAgIHN0
cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCAqYm8gPSBnZW1fdG9fdmlydGlvX2dwdV9vYmoob2Jqcy0+
b2Jqc1swXSk7Cj4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV90cmFuc2Zlcl9ob3N0XzNkICpj
bWRfcDsKPiAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X3ZidWZmZXIgKnZidWY7Cj4KPiAgICAg
ICAgIGNtZF9wID0gdmlydGlvX2dwdV9hbGxvY19jbWQodmdkZXYsICZ2YnVmLCBzaXplb2YoKmNt
ZF9wKSk7Cj4gICAgICAgICBtZW1zZXQoY21kX3AsIDAsIHNpemVvZigqY21kX3ApKTsKPgo+ICsg
ICAgICAgdmJ1Zi0+b2JqcyA9IG9ianM7Cj4gKwo+ICAgICAgICAgY21kX3AtPmhkci50eXBlID0g
Y3B1X3RvX2xlMzIoVklSVElPX0dQVV9DTURfVFJBTlNGRVJfRlJPTV9IT1NUXzNEKTsKPiAgICAg
ICAgIGNtZF9wLT5oZHIuY3R4X2lkID0gY3B1X3RvX2xlMzIoY3R4X2lkKTsKPiAtICAgICAgIGNt
ZF9wLT5yZXNvdXJjZV9pZCA9IGNwdV90b19sZTMyKHJlc291cmNlX2lkKTsKPiArICAgICAgIGNt
ZF9wLT5yZXNvdXJjZV9pZCA9IGNwdV90b19sZTMyKGJvLT5od19yZXNfaGFuZGxlKTsKPiAgICAg
ICAgIGNtZF9wLT5ib3ggPSAqYm94Owo+ICAgICAgICAgY21kX3AtPm9mZnNldCA9IGNwdV90b19s
ZTY0KG9mZnNldCk7Cj4gICAgICAgICBjbWRfcC0+bGV2ZWwgPSBjcHVfdG9fbGUzMihsZXZlbCk7
Cj4gLS0KPiAyLjE4LjEKPgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
