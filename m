Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 276339C6A4
	for <lists+dri-devel@lfdr.de>; Mon, 26 Aug 2019 02:19:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4AE806E144;
	Mon, 26 Aug 2019 00:18:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from onstation.org (onstation.org [52.200.56.107])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 25E956EC80;
 Fri, 23 Aug 2019 12:16:59 +0000 (UTC)
Received: from localhost.localdomain (wsip-184-191-162-253.sd.sd.cox.net
 [184.191.162.253])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: masneyb)
 by onstation.org (Postfix) with ESMTPSA id 2C7E14BB64;
 Fri, 23 Aug 2019 12:16:57 +0000 (UTC)
From: Brian Masney <masneyb@onstation.org>
To: agross@kernel.org, robdclark@gmail.com, sean@poorly.run,
 robh+dt@kernel.org, bjorn.andersson@linaro.org
Subject: [PATCH v7 5/7] soc: qcom: add OCMEM driver
Date: Fri, 23 Aug 2019 05:16:35 -0700
Message-Id: <20190823121637.5861-6-masneyb@onstation.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190823121637.5861-1-masneyb@onstation.org>
References: <20190823121637.5861-1-masneyb@onstation.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 26 Aug 2019 00:18:56 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=onstation.org; s=default; t=1566562618;
 bh=c6o9u9SQ/Q24+o0f4dJQKErcQ3Q3gVWi0KPmZuvO8Lo=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=SKQw7j/eu7mXOdIZDj0RUu1yeZexJ2GpjvYp3XMLvK3JtGVpdSsUUUz3lrJ4qn6aO
 VCU4ZJgenx4imcrPKPMZ5E6XFSPq6gKaRz1BBHwZj8bECoRUOjrKj9TLadBS7xlnsi
 pwTncyD3w+xbPHTVlsPyQKf4sR6p/sqUDLVdi8/Y=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: mark.rutland@arm.com, devicetree@vger.kernel.org, jonathan@marek.ca,
 airlied@linux.ie, linux-arm-msm@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, freedreno@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIE9DTUVNIGRyaXZlciBoYW5kbGVzIGFsbG9jYXRpb24gYW5kIGNvbmZpZ3VyYXRpb24gb2Yg
dGhlIE9uIENoaXAKTUVNb3J5IHRoYXQgaXMgcHJlc2VudCBvbiBzb21lIFNuYXBkcmFnb24gU29D
cy4gRGV2aWNlcyB3aGljaCBoYXZlCk9DTUVNIGRvIG5vdCBoYXZlIEdNRU0gaW5zaWRlIHRoZSBH
UFUgY29yZSwgc28gdGhlIEdQVSBtdXN0IGluc3RlYWQKdXNlIE9DTUVNIHRvIGJlIGZ1bmN0aW9u
YWwuIFNpbmNlIHRoZSBHUFUgaXMgY3VycmVudGx5IHRoZSBvbmx5IE9DTUVNCnVzZXIgd2l0aCBh
biB1cHN0cmVhbSBkcml2ZXIsIHRoaXMgaXMganVzdCBhIG1pbmltYWwgaW1wbGVtZW50YXRpb24K
c3VmZmljaWVudCBmb3Igc3RhdGljYWxseSBhbGxvY2F0aW5nIHRvIHRoZSBHUFUgaXQncyBjaHVu
ayBvZiBPQ01FTS4KClRoaXMgZHJpdmVyIGN1cnJlbnRseSBkb2VzIG5vdCByZWFkIHRoZSBnbXUt
c3JhbSBub2RlIHRoYXQgaXMgZGVzY3JpYmVkCmluIHRoZSBkZXZpY2UgdHJlZSBiaW5kaW5ncy4g
VGhlIHN0YXJ0aW5nIG1lbW9yeSBhZGRyZXNzIG9mIHRoZSBHUFUncwpyZXNlcnZlZCBtZW1vcnkg
cmVnaW9uIGlzIGhhcmRjb2RlZCB0byB6ZXJvIHRvIG1hdGNoIHdoYXQgdGhlIGhhcmR3YXJlCmV4
cGVjdHMuIFRoZSBkcml2ZXIgY2FuIGJlIHVwZGF0ZWQgdG8gcmVhZCB0aGUgcmVzZXJ2ZWQgbWVt
b3J5IHJlZ2lvbnMKZnJvbSBkZXZpY2UgdHJlZSBvbmNlIG90aGVyIHVzZXJzIG9mIE9DTUVNIGFy
ZSBhZGRlZCB1cHN0cmVhbS4KClNpZ25lZC1vZmYtYnk6IEJyaWFuIE1hc25leSA8bWFzbmV5YkBv
bnN0YXRpb24ub3JnPgpDby1kZXZlbG9wZWQtYnk6IFJvYiBDbGFyayA8cm9iZGNsYXJrQGdtYWls
LmNvbT4KU2lnbmVkLW9mZi1ieTogUm9iIENsYXJrIDxyb2JkY2xhcmtAZ21haWwuY29tPgpSZXZp
ZXdlZC1ieTogQmpvcm4gQW5kZXJzc29uIDxiam9ybi5hbmRlcnNzb25AbGluYXJvLm9yZz4KLS0t
CkNoYW5nZXMgc2luY2UgdjY6Ci0gTG9vayB1cCBwYXJlbnQgZGV2aWNlIG5vZGUKCkNoYW5nZXMg
c2luY2UgdjU6Ci0gcmVuYW1lIG9jbWVtIHByb3BlcnR5IHRvIHNyYW0KCkNoYW5nZXMgc2luY2Ug
djQ6Ci0gQ2hhbmdlICdHUEwnIHRvICdHUEwgdjInIGluIE1PRFVMRV9MSUNFTlNFCgpDaGFuZ2Vz
IHNpbmNlIHYzOgotIE5vbmUKCkNoYW5nZXMgc2luY2UgdjIKLSBDaGFuZ2VkIHN0YXRpYyBpbmxp
bmUgc3R1YnMgcmV0dXJuIC1FTk9ERVYgd2hlbiBPQ01FTSBpcyBub3QKICBjb25maWd1cmVkIGlu
dG8gdGhlIGtlcm5lbC4KCkNoYW5nZXMgc2luY2UgdjE6Ci0gb2NtZW1fYWxsb2NhdGUoKTogY2hl
Y2sgZm9yIGFsaWdubWVudCBhbmQgbWluaW11bSBhbGxvY2F0aW9uIHNpemUuCiAgVGhlIDY0SyB2
YWx1ZXMgY2FtZSBmcm9tIHRoZSBkb3duc3RyZWFtIE1TTSBrZXJuZWwgc291cmNlcy4KLSBhZGQg
bG9ja2luZyB0byBtZW1vcnkgYWxsb2NhdGlvbnMgYmFzZWQgb24gdGhlIGNsaWVudAotIHVzZSBj
bGtfYnVsa18qKCkgZnVuY3Rpb25zCi0gcmVuYW1lIHFjb20sb2NtZW0tbXNtODk3NCB0byBxY29t
LG1zbTg5NzQtb2NtZW0KLSByZW5hbWUgcmVnLW5hbWVzIHRvIGN0cmwgYW5kIG1lbQotIHJlbW92
ZSBvY21lbS54bWwuaCBmaWxlOyB1c2UgRklFTERfUFJFUCgpIGluc3RlYWQgZm9yIHNvbWUgbmlj
ZSBjbGVhbnVwcwotIGFkZCBzdGF0aWMgaW5saW5lIG5vb3AgdmVyc2lvbnMgb2YgcHVibGljLWZh
Y2luZyBmdW5jdGlvbnMgd2hlbiBvY21lbQogIGlzIGRpc2FibGVkIHRvIHJlbW92ZSAjaWZkZWZz
IGluIGFkcmVudV9ncHUuYwotIHVzZSB1bnNpZ25lZCBsb25nIGZvciBtZW1vcnkgYWRkcmVzc2Vz
Ci0gbW92ZSBvY21lbV9kZXZfcmVtb3ZlKCkgYmVsb3cgX3Byb2JlKCkgZnVuY3Rpb24KLSByZW1v
dmUgZXJyb3IgY2hlY2sgZnJvbSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2VfYnluYW1lIGZvciBjdHJs
IHJlc291cmNlCi0gYWRkIE1PRFVMRV9ERVNDUklQVElPTigpIGFuZCBNT0RVTEVfTElDRU5TRSgp
Ci0gYWRkIGRlc2NyaXB0aW9uIHRvIHRvcCBvZiBvY21lbS5bY2hdCi0gY29ycmVjdCB0aGluIG1v
ZGUgYml0IGluIHVwZGF0ZV9vY21lbSgpCi0gYWRkICdXQVJOX09OKGNsaWVudCAhPSBPQ01FTV9H
UkFQSElDUyknIHRvIGRldmljZV9hZGRyZXNzKCkKLSBtYWtlIG9mX2dldF9vY21lbSByZXR1cm4g
ZXJyb3IgY29kZXMgdmlhIEVSUl9QVFIgaW5zdGVhZCBvZiBOVUxMCi0gb2NtZW1fe2FsbG9jYXRl
LGZyZWV9IC0gV0FSTl9PTigpIGlmIGNsaWVudCAhPSBPQ01FTV9HUkFQSElDUy4KICBTaW1wbGlm
eSBpZiBzdGF0ZW1lbnRzLgotIGFsbG93IE5VTEwgdG8gYmUgcGFzc2VkIGludG8gb2NtZW1fZnJl
ZQotIHJlbW92ZSB1bm5lY2Vzc2FyeSBpbml0aWFsaXphdGlvbiBvZiBpIGluIHVwZGF0ZV9vY21l
bSgpCi0gYWRkIGRldl9kYmcgdG8gb2NtZW1fYWxsb2NhdGUKCkNoYW5nZXMgc2luY2UgUm9iJ3Mg
bGFzdCB2ZXJzaW9uIG9mIHRoaXMgcGF0Y2ggZnJvbSAyMDE1OgpodHRwczovL3BhdGNod29yay5r
ZXJuZWwub3JnL3BhdGNoLzczNzk4MDEvCi0gcmVmb3JtYXR0ZWQgZHJpdmVyIHRvIGFsbG93IG11
bHRpcGxlIGluc3RhbmNlcwotIHVwZGF0ZWQgbG9nZ2luZyBvZiBlcnJvciBwYXRocyBkdXJpbmcg
ZGV2aWNlIHByb2JpbmcKLSByZW1vdmUgdW51c2VkIHBzZ3NjX2N0cmwKLSByZW1vdmUgX2NsayBm
cm9tIGNsb2NrIG5hbWVzCi0gcHJvcGFnYXRlIGVycm9yIGNvZGUgZnJvbSBkZXZtX2lvcmVtYXBf
cmVzb3VyY2UoKQotIHVzZSBkZXZpY2VfZ2V0X21hdGNoX2RhdGEoKQotIFNQRFggbGljZW5zZSB0
YWdzCi0gcmVtb3ZlIFFDT01fU01EIGluIEtjb25maWcKLSBzZWxlY3QgQVJDSF9RQ09NIGluIEtj
b25maWcKLSBzZWxlY3QgQVJDSF9RQ09NIGluIEtjb25maWcKLSBzZWxlY3QgUUNPTV9TQ00gaW4g
S2NvbmZpZwotIGxvbmdlciBkZXNjcmlwdGlvbiBpbiBLY29uZmlnCgogZHJpdmVycy9zb2MvcWNv
bS9LY29uZmlnICB8ICAxMCArCiBkcml2ZXJzL3NvYy9xY29tL01ha2VmaWxlIHwgICAxICsKIGRy
aXZlcnMvc29jL3Fjb20vb2NtZW0uYyAgfCA0MzMgKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysKIGluY2x1ZGUvc29jL3Fjb20vb2NtZW0uaCAgfCAgNjIgKysrKysrCiA0IGZp
bGVzIGNoYW5nZWQsIDUwNiBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9zb2MvcWNvbS9vY21lbS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS9zb2MvcWNvbS9v
Y21lbS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zb2MvcWNvbS9LY29uZmlnIGIvZHJpdmVycy9z
b2MvcWNvbS9LY29uZmlnCmluZGV4IDY2MWU0N2FjYzM1NC4uYWRiZjNiZmFlODA1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL3NvYy9xY29tL0tjb25maWcKKysrIGIvZHJpdmVycy9zb2MvcWNvbS9LY29u
ZmlnCkBAIC03NCw2ICs3NCwxNiBAQCBjb25maWcgUUNPTV9NRFRfTE9BREVSCiAJdHJpc3RhdGUK
IAlzZWxlY3QgUUNPTV9TQ00KIAorY29uZmlnIFFDT01fT0NNRU0KKwl0cmlzdGF0ZSAiUXVhbGNv
bW0gT24gQ2hpcCBNZW1vcnkgKE9DTUVNKSBkcml2ZXIiCisJZGVwZW5kcyBvbiBBUkNIX1FDT00K
KwlzZWxlY3QgUUNPTV9TQ00KKwloZWxwCisgICAgICAgICAgVGhlIE9uIENoaXAgTWVtb3J5IChP
Q01FTSkgYWxsb2NhdG9yIGFsbG93cyB2YXJpb3VzIGNsaWVudHMgdG8KKyAgICAgICAgICBhbGxv
Y2F0ZSBtZW1vcnkgZnJvbSBPQ01FTSBiYXNlZCBvbiBwZXJmb3JtYW5jZSwgbGF0ZW5jeSBhbmQg
cG93ZXIKKyAgICAgICAgICByZXF1aXJlbWVudHMuIFRoaXMgaXMgdHlwaWNhbGx5IHVzZWQgYnkg
dGhlIEdQVSwgY2FtZXJhL3ZpZGVvLCBhbmQKKyAgICAgICAgICBhdWRpbyBjb21wb25lbnRzIG9u
IHNvbWUgU25hcGRyYWdvbiBTb0NzLgorCiBjb25maWcgUUNPTV9QTQogCWJvb2wgIlF1YWxjb21t
IFBvd2VyIE1hbmFnZW1lbnQiCiAJZGVwZW5kcyBvbiBBUkNIX1FDT00gJiYgIUFSTTY0CmRpZmYg
LS1naXQgYS9kcml2ZXJzL3NvYy9xY29tL01ha2VmaWxlIGIvZHJpdmVycy9zb2MvcWNvbS9NYWtl
ZmlsZQppbmRleCAxNjI3ODg3MDFhNzcuLmFhYjMzMzcyMGJmZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9zb2MvcWNvbS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL3NvYy9xY29tL01ha2VmaWxlCkBAIC02
LDYgKzYsNyBAQCBvYmotJChDT05GSUdfUUNPTV9DT01NQU5EX0RCKSArPSBjbWQtZGIubwogb2Jq
LSQoQ09ORklHX1FDT01fR0xJTktfU1NSKSArPQlnbGlua19zc3Iubwogb2JqLSQoQ09ORklHX1FD
T01fR1NCSSkJKz0JcWNvbV9nc2JpLm8KIG9iai0kKENPTkZJR19RQ09NX01EVF9MT0FERVIpCSs9
IG1kdF9sb2FkZXIubworb2JqLSQoQ09ORklHX1FDT01fT0NNRU0pCSs9IG9jbWVtLm8KIG9iai0k
KENPTkZJR19RQ09NX1BNKQkrPQlzcG0ubwogb2JqLSQoQ09ORklHX1FDT01fUU1JX0hFTFBFUlMp
CSs9IHFtaV9oZWxwZXJzLm8KIHFtaV9oZWxwZXJzLXkJKz0gcW1pX2VuY2RlYy5vIHFtaV9pbnRl
cmZhY2UubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zb2MvcWNvbS9vY21lbS5jIGIvZHJpdmVycy9z
b2MvcWNvbS9vY21lbS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4u
N2Y5ZTk5NDRkMWVhCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9zb2MvcWNvbS9vY21lbS5j
CkBAIC0wLDAgKzEsNDMzIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1v
bmx5CisvKgorICogVGhlIE9uIENoaXAgTWVtb3J5IChPQ01FTSkgYWxsb2NhdG9yIGFsbG93cyB2
YXJpb3VzIGNsaWVudHMgdG8gYWxsb2NhdGUKKyAqIG1lbW9yeSBmcm9tIE9DTUVNIGJhc2VkIG9u
IHBlcmZvcm1hbmNlLCBsYXRlbmN5IGFuZCBwb3dlciByZXF1aXJlbWVudHMuCisgKiBUaGlzIGlz
IHR5cGljYWxseSB1c2VkIGJ5IHRoZSBHUFUsIGNhbWVyYS92aWRlbywgYW5kIGF1ZGlvIGNvbXBv
bmVudHMgb24KKyAqIHNvbWUgU25hcGRyYWdvbiBTb0NzLgorICoKKyAqIENvcHlyaWdodCAoQykg
MjAxOSBCcmlhbiBNYXNuZXkgPG1hc25leWJAb25zdGF0aW9uLm9yZz4KKyAqIENvcHlyaWdodCAo
QykgMjAxNSBSZWQgSGF0LiBBdXRob3I6IFJvYiBDbGFyayA8cm9iZGNsYXJrQGdtYWlsLmNvbT4K
KyAqLworCisjaW5jbHVkZSA8bGludXgvYml0ZmllbGQuaD4KKyNpbmNsdWRlIDxsaW51eC9jbGsu
aD4KKyNpbmNsdWRlIDxsaW51eC9pby5oPgorI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgorI2lu
Y2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L29mX2RldmljZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3Fjb21fc2Nt
Lmg+CisjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+Cisj
aW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKyNpbmNsdWRlIDxzb2MvcWNvbS9vY21lbS5oPgorCitl
bnVtIHJlZ2lvbl9tb2RlIHsKKwlXSURFX01PREUgPSAweDAsCisJVEhJTl9NT0RFLAorCU1PREVf
REVGQVVMVCA9IFdJREVfTU9ERSwKK307CisKK2VudW0gb2NtZW1fbWFjcm9fc3RhdGUgeworCVBB
U1NUSFJPVUdIID0gMCwKKwlQRVJJX09OID0gMSwKKwlDT1JFX09OID0gMiwKKwlDTEtfT0ZGID0g
NCwKK307CisKK3N0cnVjdCBvY21lbV9yZWdpb24geworCWJvb2wgaW50ZXJsZWF2ZWQ7CisJZW51
bSByZWdpb25fbW9kZSBtb2RlOworCXVuc2lnbmVkIGludCBudW1fbWFjcm9zOworCWVudW0gb2Nt
ZW1fbWFjcm9fc3RhdGUgbWFjcm9fc3RhdGVbNF07CisJdW5zaWduZWQgbG9uZyBtYWNyb19zaXpl
OworCXVuc2lnbmVkIGxvbmcgcmVnaW9uX3NpemU7Cit9OworCitzdHJ1Y3Qgb2NtZW1fY29uZmln
IHsKKwl1aW50OF90IG51bV9yZWdpb25zOworCXVuc2lnbmVkIGxvbmcgbWFjcm9fc2l6ZTsKK307
CisKK3N0cnVjdCBvY21lbSB7CisJc3RydWN0IGRldmljZSAqZGV2OworCWNvbnN0IHN0cnVjdCBv
Y21lbV9jb25maWcgKmNvbmZpZzsKKwlzdHJ1Y3QgcmVzb3VyY2UgKm1lbW9yeTsKKwl2b2lkIF9f
aW9tZW0gKm1taW87CisJdW5zaWduZWQgaW50IG51bV9wb3J0czsKKwl1bnNpZ25lZCBpbnQgbnVt
X21hY3JvczsKKwlib29sIGludGVybGVhdmVkOworCXN0cnVjdCBvY21lbV9yZWdpb24gKnJlZ2lv
bnM7CisJdW5zaWduZWQgbG9uZyBhY3RpdmVfYWxsb2NhdGlvbnM7Cit9OworCisjZGVmaW5lIE9D
TUVNX01JTl9BTElHTgkJCQlTWl82NEsKKyNkZWZpbmUgT0NNRU1fTUlOX0FMTE9DCQkJCVNaXzY0
SworCisjZGVmaW5lIE9DTUVNX1JFR19IV19WRVJTSU9OCQkJMHgwMDAwMDAwMAorI2RlZmluZSBP
Q01FTV9SRUdfSFdfUFJPRklMRQkJCTB4MDAwMDAwMDQKKworI2RlZmluZSBPQ01FTV9SRUdfUkVH
SU9OX01PREVfQ1RMCQkweDAwMDAxMDAwCisjZGVmaW5lIE9DTUVNX1JFR0lPTl9NT0RFX0NUTF9S
RUcwX1RISU4JCTB4MDAwMDAwMDEKKyNkZWZpbmUgT0NNRU1fUkVHSU9OX01PREVfQ1RMX1JFRzFf
VEhJTgkJMHgwMDAwMDAwMgorI2RlZmluZSBPQ01FTV9SRUdJT05fTU9ERV9DVExfUkVHMl9USElO
CQkweDAwMDAwMDA0CisjZGVmaW5lIE9DTUVNX1JFR0lPTl9NT0RFX0NUTF9SRUczX1RISU4JCTB4
MDAwMDAwMDgKKworI2RlZmluZSBPQ01FTV9SRUdfR0ZYX01QVV9TVEFSVAkJCTB4MDAwMDEwMDQK
KyNkZWZpbmUgT0NNRU1fUkVHX0dGWF9NUFVfRU5ECQkJMHgwMDAwMTAwOAorCisjZGVmaW5lIE9D
TUVNX0hXX1BST0ZJTEVfTlVNX1BPUlRTKHZhbCkJCUZJRUxEX1BSRVAoMHgwMDAwMDAwZiwgKHZh
bCkpCisjZGVmaW5lIE9DTUVNX0hXX1BST0ZJTEVfTlVNX01BQ1JPUyh2YWwpCUZJRUxEX1BSRVAo
MHgwMDAwM2YwMCwgKHZhbCkpCisKKyNkZWZpbmUgT0NNRU1fSFdfUFJPRklMRV9MQVNUX1JFR05f
SEFMRlNJWkUJMHgwMDAxMDAwMAorI2RlZmluZSBPQ01FTV9IV19QUk9GSUxFX0lOVEVSTEVBVklO
RwkJMHgwMDAyMDAwMAorI2RlZmluZSBPQ01FTV9SRUdfR0VOX1NUQVRVUwkJCTB4MDAwMDAwMGMK
KworI2RlZmluZSBPQ01FTV9SRUdfUFNHU0NfU1RBVFVTCQkJMHgwMDAwMDAzOAorI2RlZmluZSBP
Q01FTV9SRUdfUFNHU0NfQ1RMKGkwKQkJCSgweDAwMDAwMDNjICsgMHgxKihpMCkpCisKKyNkZWZp
bmUgT0NNRU1fUFNHU0NfQ1RMX01BQ1JPMF9NT0RFKHZhbCkJRklFTERfUFJFUCgweDAwMDAwMDA3
LCAodmFsKSkKKyNkZWZpbmUgT0NNRU1fUFNHU0NfQ1RMX01BQ1JPMV9NT0RFKHZhbCkJRklFTERf
UFJFUCgweDAwMDAwMDcwLCAodmFsKSkKKyNkZWZpbmUgT0NNRU1fUFNHU0NfQ1RMX01BQ1JPMl9N
T0RFKHZhbCkJRklFTERfUFJFUCgweDAwMDAwNzAwLCAodmFsKSkKKyNkZWZpbmUgT0NNRU1fUFNH
U0NfQ1RMX01BQ1JPM19NT0RFKHZhbCkJRklFTERfUFJFUCgweDAwMDA3MDAwLCAodmFsKSkKKwor
I2RlZmluZSBPQ01FTV9DTEtfQ09SRV9JRFgJCQkwCitzdGF0aWMgc3RydWN0IGNsa19idWxrX2Rh
dGEgb2NtZW1fY2xrc1tdID0geworCXsKKwkJLmlkID0gImNvcmUiLAorCX0sCisJeworCQkuaWQg
PSAiaWZhY2UiLAorCX0sCit9OworCitzdGF0aWMgaW5saW5lIHZvaWQgb2NtZW1fd3JpdGUoc3Ry
dWN0IG9jbWVtICpvY21lbSwgdTMyIHJlZywgdTMyIGRhdGEpCit7CisJd3JpdGVsKGRhdGEsIG9j
bWVtLT5tbWlvICsgcmVnKTsKK30KKworc3RhdGljIGlubGluZSB1MzIgb2NtZW1fcmVhZChzdHJ1
Y3Qgb2NtZW0gKm9jbWVtLCB1MzIgcmVnKQoreworCXJldHVybiByZWFkbChvY21lbS0+bW1pbyAr
IHJlZyk7Cit9CisKK3N0YXRpYyB2b2lkIHVwZGF0ZV9vY21lbShzdHJ1Y3Qgb2NtZW0gKm9jbWVt
KQoreworCXVpbnQzMl90IHJlZ2lvbl9tb2RlX2N0cmwgPSAweDA7CisJaW50IGk7CisKKwlpZiAo
IXFjb21fc2NtX29jbWVtX2xvY2tfYXZhaWxhYmxlKCkpIHsKKwkJZm9yIChpID0gMDsgaSA8IG9j
bWVtLT5jb25maWctPm51bV9yZWdpb25zOyBpKyspIHsKKwkJCXN0cnVjdCBvY21lbV9yZWdpb24g
KnJlZ2lvbiA9ICZvY21lbS0+cmVnaW9uc1tpXTsKKworCQkJaWYgKHJlZ2lvbi0+bW9kZSA9PSBU
SElOX01PREUpCisJCQkJcmVnaW9uX21vZGVfY3RybCB8PSBCSVQoaSk7CisJCX0KKworCQlkZXZf
ZGJnKG9jbWVtLT5kZXYsICJvY21lbV9yZWdpb25fbW9kZV9jb250cm9sICV4XG4iLAorCQkJcmVn
aW9uX21vZGVfY3RybCk7CisJCW9jbWVtX3dyaXRlKG9jbWVtLCBPQ01FTV9SRUdfUkVHSU9OX01P
REVfQ1RMLCByZWdpb25fbW9kZV9jdHJsKTsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwgb2NtZW0t
PmNvbmZpZy0+bnVtX3JlZ2lvbnM7IGkrKykgeworCQlzdHJ1Y3Qgb2NtZW1fcmVnaW9uICpyZWdp
b24gPSAmb2NtZW0tPnJlZ2lvbnNbaV07CisJCXUzMiBkYXRhOworCisJCWRhdGEgPSBPQ01FTV9Q
U0dTQ19DVExfTUFDUk8wX01PREUocmVnaW9uLT5tYWNyb19zdGF0ZVswXSkgfAorCQkJT0NNRU1f
UFNHU0NfQ1RMX01BQ1JPMV9NT0RFKHJlZ2lvbi0+bWFjcm9fc3RhdGVbMV0pIHwKKwkJCU9DTUVN
X1BTR1NDX0NUTF9NQUNSTzJfTU9ERShyZWdpb24tPm1hY3JvX3N0YXRlWzJdKSB8CisJCQlPQ01F
TV9QU0dTQ19DVExfTUFDUk8zX01PREUocmVnaW9uLT5tYWNyb19zdGF0ZVszXSk7CisKKwkJb2Nt
ZW1fd3JpdGUob2NtZW0sIE9DTUVNX1JFR19QU0dTQ19DVEwoaSksIGRhdGEpOworCX0KK30KKwor
c3RhdGljIHVuc2lnbmVkIGxvbmcgcGh5c190b19vZmZzZXQoc3RydWN0IG9jbWVtICpvY21lbSwK
KwkJCQkgICAgdW5zaWduZWQgbG9uZyBhZGRyKQoreworCWlmIChhZGRyIDwgb2NtZW0tPm1lbW9y
eS0+c3RhcnQgfHwgYWRkciA+PSBvY21lbS0+bWVtb3J5LT5lbmQpCisJCXJldHVybiAwOworCisJ
cmV0dXJuIGFkZHIgLSBvY21lbS0+bWVtb3J5LT5zdGFydDsKK30KKworc3RhdGljIHVuc2lnbmVk
IGxvbmcgZGV2aWNlX2FkZHJlc3Moc3RydWN0IG9jbWVtICpvY21lbSwKKwkJCQkgICAgZW51bSBv
Y21lbV9jbGllbnQgY2xpZW50LAorCQkJCSAgICB1bnNpZ25lZCBsb25nIGFkZHIpCit7CisJV0FS
Tl9PTihjbGllbnQgIT0gT0NNRU1fR1JBUEhJQ1MpOworCisJLyogVE9ETzogZ3B1IHVzZXMgcGh5
c190b19vZmZzZXQsIGJ1dCBvdGhlcnMgZG8gbm90Li4gKi8KKwlyZXR1cm4gcGh5c190b19vZmZz
ZXQob2NtZW0sIGFkZHIpOworfQorCitzdGF0aWMgdm9pZCB1cGRhdGVfcmFuZ2Uoc3RydWN0IG9j
bWVtICpvY21lbSwgc3RydWN0IG9jbWVtX2J1ZiAqYnVmLAorCQkJIGVudW0gb2NtZW1fbWFjcm9f
c3RhdGUgbXN0YXRlLCBlbnVtIHJlZ2lvbl9tb2RlIHJtb2RlKQoreworCXVuc2lnbmVkIGxvbmcg
b2Zmc2V0ID0gMDsKKwlpbnQgaSwgajsKKworCWZvciAoaSA9IDA7IGkgPCBvY21lbS0+Y29uZmln
LT5udW1fcmVnaW9uczsgaSsrKSB7CisJCXN0cnVjdCBvY21lbV9yZWdpb24gKnJlZ2lvbiA9ICZv
Y21lbS0+cmVnaW9uc1tpXTsKKworCQlpZiAoYnVmLT5vZmZzZXQgPD0gb2Zmc2V0ICYmIG9mZnNl
dCA8IGJ1Zi0+b2Zmc2V0ICsgYnVmLT5sZW4pCisJCQlyZWdpb24tPm1vZGUgPSBybW9kZTsKKwor
CQlmb3IgKGogPSAwOyBqIDwgcmVnaW9uLT5udW1fbWFjcm9zOyBqKyspIHsKKwkJCWlmIChidWYt
Pm9mZnNldCA8PSBvZmZzZXQgJiYKKwkJCSAgICBvZmZzZXQgPCBidWYtPm9mZnNldCArIGJ1Zi0+
bGVuKQorCQkJCXJlZ2lvbi0+bWFjcm9fc3RhdGVbal0gPSBtc3RhdGU7CisKKwkJCW9mZnNldCAr
PSByZWdpb24tPm1hY3JvX3NpemU7CisJCX0KKwl9CisKKwl1cGRhdGVfb2NtZW0ob2NtZW0pOwor
fQorCitzdHJ1Y3Qgb2NtZW0gKm9mX2dldF9vY21lbShzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJ
c3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldjsKKwlzdHJ1Y3QgZGV2aWNlX25vZGUgKmRldm5v
ZGU7CisKKwlkZXZub2RlID0gb2ZfcGFyc2VfcGhhbmRsZShkZXYtPm9mX25vZGUsICJzcmFtIiwg
MCk7CisJaWYgKCFkZXZub2RlIHx8ICFkZXZub2RlLT5wYXJlbnQpIHsKKwkJZGV2X2VycihkZXYs
ICJDYW5ub3QgbG9vayB1cCBzcmFtIHBoYW5kbGVcbiIpOworCQlyZXR1cm4gRVJSX1BUUigtRU5P
REVWKTsKKwl9CisKKwlwZGV2ID0gb2ZfZmluZF9kZXZpY2VfYnlfbm9kZShkZXZub2RlLT5wYXJl
bnQpOworCWlmICghcGRldikgeworCQlkZXZfZXJyKGRldiwgIkNhbm5vdCBmaW5kIGRldmljZSBu
b2RlICVzXG4iLCBkZXZub2RlLT5uYW1lKTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVQUk9CRV9ERUZF
Uik7CisJfQorCisJcmV0dXJuIHBsYXRmb3JtX2dldF9kcnZkYXRhKHBkZXYpOworfQorRVhQT1JU
X1NZTUJPTChvZl9nZXRfb2NtZW0pOworCitzdHJ1Y3Qgb2NtZW1fYnVmICpvY21lbV9hbGxvY2F0
ZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLCBlbnVtIG9jbWVtX2NsaWVudCBjbGllbnQsCisJCQkJIHVu
c2lnbmVkIGxvbmcgc2l6ZSkKK3sKKwlzdHJ1Y3Qgb2NtZW1fYnVmICpidWY7CisJaW50IHJldDsK
KworCS8qIFRPRE86IGFkZCBzdXBwb3J0IGZvciBvdGhlciBjbGllbnRzLi4uICovCisJaWYgKFdB
Uk5fT04oY2xpZW50ICE9IE9DTUVNX0dSQVBISUNTKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT0RF
Vik7CisKKwlpZiAoc2l6ZSA8IE9DTUVNX01JTl9BTExPQyB8fCAhSVNfQUxJR05FRChzaXplLCBP
Q01FTV9NSU5fQUxJR04pKQorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKKworCWlmICh0ZXN0
X2FuZF9zZXRfYml0X2xvY2soQklUKGNsaWVudCksICZvY21lbS0+YWN0aXZlX2FsbG9jYXRpb25z
KSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVCVVNZKTsKKworCWJ1ZiA9IGt6YWxsb2Moc2l6ZW9mKCpi
dWYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJ1ZikgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3Rv
IGVycl91bmxvY2s7CisJfQorCisJYnVmLT5vZmZzZXQgPSAwOworCWJ1Zi0+YWRkciA9IGRldmlj
ZV9hZGRyZXNzKG9jbWVtLCBjbGllbnQsIGJ1Zi0+b2Zmc2V0KTsKKwlidWYtPmxlbiA9IHNpemU7
CisKKwl1cGRhdGVfcmFuZ2Uob2NtZW0sIGJ1ZiwgQ09SRV9PTiwgV0lERV9NT0RFKTsKKworCWlm
IChxY29tX3NjbV9vY21lbV9sb2NrX2F2YWlsYWJsZSgpKSB7CisJCXJldCA9IHFjb21fc2NtX29j
bWVtX2xvY2soUUNPTV9TQ01fT0NNRU1fR1JBUEhJQ1NfSUQsCisJCQkJCSAgYnVmLT5vZmZzZXQs
IGJ1Zi0+bGVuLCBXSURFX01PREUpOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKG9jbWVtLT5k
ZXYsICJjb3VsZCBub3QgbG9jazogJWRcbiIsIHJldCk7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJ
Z290byBlcnJfa2ZyZWU7CisJCX0KKwl9IGVsc2UgeworCQlvY21lbV93cml0ZShvY21lbSwgT0NN
RU1fUkVHX0dGWF9NUFVfU1RBUlQsIGJ1Zi0+b2Zmc2V0KTsKKwkJb2NtZW1fd3JpdGUob2NtZW0s
IE9DTUVNX1JFR19HRlhfTVBVX0VORCwKKwkJCSAgICBidWYtPm9mZnNldCArIGJ1Zi0+bGVuKTsK
Kwl9CisKKwlkZXZfZGJnKG9jbWVtLT5kZXYsICJ1c2luZyAlbGRLIG9mIE9DTUVNIGF0IDB4JTA4
bHggZm9yIGNsaWVudCAlZFxuIiwKKwkJc2l6ZSAvIDEwMjQsIGJ1Zi0+YWRkciwgY2xpZW50KTsK
KworCXJldHVybiBidWY7CisKK2Vycl9rZnJlZToKKwlrZnJlZShidWYpOworZXJyX3VubG9jazoK
KwljbGVhcl9iaXRfdW5sb2NrKEJJVChjbGllbnQpLCAmb2NtZW0tPmFjdGl2ZV9hbGxvY2F0aW9u
cyk7CisKKwlyZXR1cm4gRVJSX1BUUihyZXQpOworfQorRVhQT1JUX1NZTUJPTChvY21lbV9hbGxv
Y2F0ZSk7CisKK3ZvaWQgb2NtZW1fZnJlZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLCBlbnVtIG9jbWVt
X2NsaWVudCBjbGllbnQsCisJCXN0cnVjdCBvY21lbV9idWYgKmJ1ZikKK3sKKwkvKiBUT0RPOiBh
ZGQgc3VwcG9ydCBmb3Igb3RoZXIgY2xpZW50cy4uLiAqLworCWlmIChXQVJOX09OKGNsaWVudCAh
PSBPQ01FTV9HUkFQSElDUykpCisJCXJldHVybjsKKworCXVwZGF0ZV9yYW5nZShvY21lbSwgYnVm
LCBDTEtfT0ZGLCBNT0RFX0RFRkFVTFQpOworCisJaWYgKHFjb21fc2NtX29jbWVtX2xvY2tfYXZh
aWxhYmxlKCkpIHsKKwkJaW50IHJldDsKKworCQlyZXQgPSBxY29tX3NjbV9vY21lbV91bmxvY2so
UUNPTV9TQ01fT0NNRU1fR1JBUEhJQ1NfSUQsCisJCQkJCSAgICBidWYtPm9mZnNldCwgYnVmLT5s
ZW4pOworCQlpZiAocmV0KQorCQkJZGV2X2VycihvY21lbS0+ZGV2LCAiY291bGQgbm90IHVubG9j
azogJWRcbiIsIHJldCk7CisJfSBlbHNlIHsKKwkJb2NtZW1fd3JpdGUob2NtZW0sIE9DTUVNX1JF
R19HRlhfTVBVX1NUQVJULCAweDApOworCQlvY21lbV93cml0ZShvY21lbSwgT0NNRU1fUkVHX0dG
WF9NUFVfRU5ELCAweDApOworCX0KKworCWtmcmVlKGJ1Zik7CisKKwljbGVhcl9iaXRfdW5sb2Nr
KEJJVChjbGllbnQpLCAmb2NtZW0tPmFjdGl2ZV9hbGxvY2F0aW9ucyk7Cit9CitFWFBPUlRfU1lN
Qk9MKG9jbWVtX2ZyZWUpOworCitzdGF0aWMgaW50IG9jbWVtX2Rldl9wcm9iZShzdHJ1Y3QgcGxh
dGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZwZGV2LT5kZXY7
CisJdW5zaWduZWQgbG9uZyByZWcsIHJlZ2lvbl9zaXplOworCWludCBpLCBqLCByZXQsIG51bV9i
YW5rczsKKwlzdHJ1Y3QgcmVzb3VyY2UgKnJlczsKKwlzdHJ1Y3Qgb2NtZW0gKm9jbWVtOworCisJ
aWYgKCFxY29tX3NjbV9pc19hdmFpbGFibGUoKSkKKwkJcmV0dXJuIC1FUFJPQkVfREVGRVI7CisK
KwlvY21lbSA9IGRldm1fa3phbGxvYyhkZXYsIHNpemVvZigqb2NtZW0pLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIW9jbWVtKQorCQlyZXR1cm4gLUVOT01FTTsKKworCW9jbWVtLT5kZXYgPSBkZXY7CisJ
b2NtZW0tPmNvbmZpZyA9IGRldmljZV9nZXRfbWF0Y2hfZGF0YShkZXYpOworCisJcmV0ID0gZGV2
bV9jbGtfYnVsa19nZXQoZGV2LCBBUlJBWV9TSVpFKG9jbWVtX2Nsa3MpLCBvY21lbV9jbGtzKTsK
KwlpZiAocmV0KSB7CisJCWlmIChyZXQgIT0gLUVQUk9CRV9ERUZFUikKKwkJCWRldl9lcnIoZGV2
LCAiVW5hYmxlIHRvIGdldCBjbG9ja3NcbiIpOworCisJCXJldHVybiByZXQ7CisJfQorCisJcmVz
ID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlX2J5bmFtZShwZGV2LCBJT1JFU09VUkNFX01FTSwgImN0
cmwiKTsKKwlvY21lbS0+bW1pbyA9IGRldm1faW9yZW1hcF9yZXNvdXJjZSgmcGRldi0+ZGV2LCBy
ZXMpOworCWlmIChJU19FUlIob2NtZW0tPm1taW8pKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwg
IkZhaWxlZCB0byBpb3JlbWFwIG9jbWVtX2N0cmwgcmVzb3VyY2VcbiIpOworCQlyZXR1cm4gUFRS
X0VSUihvY21lbS0+bW1pbyk7CisJfQorCisJb2NtZW0tPm1lbW9yeSA9IHBsYXRmb3JtX2dldF9y
ZXNvdXJjZV9ieW5hbWUocGRldiwgSU9SRVNPVVJDRV9NRU0sCisJCQkJCQkgICAgICJtZW0iKTsK
KwlpZiAoIW9jbWVtLT5tZW1vcnkpIHsKKwkJZGV2X2VycihkZXYsICJDb3VsZCBub3QgZ2V0IG1l
bSByZWdpb25cbiIpOworCQlyZXR1cm4gLUVOWElPOworCX0KKworCS8qIFRoZSBjb3JlIGNsb2Nr
IGlzIHN5bmNocm9ub3VzIHdpdGggZ3JhcGhpY3MgKi8KKwlXQVJOX09OKGNsa19zZXRfcmF0ZShv
Y21lbV9jbGtzW09DTUVNX0NMS19DT1JFX0lEWF0uY2xrLCAxMDAwKSA8IDApOworCisJcmV0ID0g
Y2xrX2J1bGtfcHJlcGFyZV9lbmFibGUoQVJSQVlfU0laRShvY21lbV9jbGtzKSwgb2NtZW1fY2xr
cyk7CisJaWYgKHJldCkgeworCQlkZXZfaW5mbyhvY21lbS0+ZGV2LCAiRmFpbGVkIHRvIGVuYWJs
ZSBjbG9ja3NcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCWlmIChxY29tX3NjbV9yZXN0b3Jl
X3NlY19jZmdfYXZhaWxhYmxlKCkpIHsKKwkJZGV2X2RiZyhkZXYsICJjb25maWd1cmluZyBzY21c
biIpOworCQlyZXQgPSBxY29tX3NjbV9yZXN0b3JlX3NlY19jZmcoUUNPTV9TQ01fT0NNRU1fREVW
X0lELCAwKTsKKwkJaWYgKHJldCkgeworCQkJZGV2X2VycihkZXYsICJDb3VsZCBub3QgZW5hYmxl
IHNlY3VyZSBjb25maWd1cmF0aW9uXG4iKTsKKwkJCWdvdG8gZXJyX2Nsa19kaXNhYmxlOworCQl9
CisJfQorCisJcmVnID0gb2NtZW1fcmVhZChvY21lbSwgT0NNRU1fUkVHX0hXX1BST0ZJTEUpOwor
CW9jbWVtLT5udW1fcG9ydHMgPSBPQ01FTV9IV19QUk9GSUxFX05VTV9QT1JUUyhyZWcpOworCW9j
bWVtLT5udW1fbWFjcm9zID0gT0NNRU1fSFdfUFJPRklMRV9OVU1fTUFDUk9TKHJlZyk7CisJb2Nt
ZW0tPmludGVybGVhdmVkID0gISEocmVnICYgT0NNRU1fSFdfUFJPRklMRV9JTlRFUkxFQVZJTkcp
OworCisJbnVtX2JhbmtzID0gb2NtZW0tPm51bV9wb3J0cyAvIDI7CisJcmVnaW9uX3NpemUgPSBv
Y21lbS0+Y29uZmlnLT5tYWNyb19zaXplICogbnVtX2JhbmtzOworCisJZGV2X2luZm8oZGV2LCAi
JXUgcG9ydHMsICV1IHJlZ2lvbnMsICV1IG1hY3JvcywgJXNpbnRlcmxlYXZlZFxuIiwKKwkJIG9j
bWVtLT5udW1fcG9ydHMsIG9jbWVtLT5jb25maWctPm51bV9yZWdpb25zLAorCQkgb2NtZW0tPm51
bV9tYWNyb3MsIG9jbWVtLT5pbnRlcmxlYXZlZCA/ICIiIDogIm5vdCAiKTsKKworCW9jbWVtLT5y
ZWdpb25zID0gZGV2bV9rY2FsbG9jKGRldiwgb2NtZW0tPmNvbmZpZy0+bnVtX3JlZ2lvbnMsCisJ
CQkJICAgICAgc2l6ZW9mKHN0cnVjdCBvY21lbV9yZWdpb24pLCBHRlBfS0VSTkVMKTsKKwlpZiAo
IW9jbWVtLT5yZWdpb25zKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZXJyX2Nsa19kaXNh
YmxlOworCX0KKworCWZvciAoaSA9IDA7IGkgPCBvY21lbS0+Y29uZmlnLT5udW1fcmVnaW9uczsg
aSsrKSB7CisJCXN0cnVjdCBvY21lbV9yZWdpb24gKnJlZ2lvbiA9ICZvY21lbS0+cmVnaW9uc1tp
XTsKKworCQlpZiAoV0FSTl9PTihudW1fYmFua3MgPiBBUlJBWV9TSVpFKHJlZ2lvbi0+bWFjcm9f
c3RhdGUpKSkgeworCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyX2Nsa19kaXNhYmxlOwor
CQl9CisKKwkJcmVnaW9uLT5tb2RlID0gTU9ERV9ERUZBVUxUOworCQlyZWdpb24tPm51bV9tYWNy
b3MgPSBudW1fYmFua3M7CisKKwkJaWYgKGkgPT0gKG9jbWVtLT5jb25maWctPm51bV9yZWdpb25z
IC0gMSkgJiYKKwkJICAgIHJlZyAmIE9DTUVNX0hXX1BST0ZJTEVfTEFTVF9SRUdOX0hBTEZTSVpF
KSB7CisJCQlyZWdpb24tPm1hY3JvX3NpemUgPSBvY21lbS0+Y29uZmlnLT5tYWNyb19zaXplIC8g
MjsKKwkJCXJlZ2lvbi0+cmVnaW9uX3NpemUgPSByZWdpb25fc2l6ZSAvIDI7CisJCX0gZWxzZSB7
CisJCQlyZWdpb24tPm1hY3JvX3NpemUgPSBvY21lbS0+Y29uZmlnLT5tYWNyb19zaXplOworCQkJ
cmVnaW9uLT5yZWdpb25fc2l6ZSA9IHJlZ2lvbl9zaXplOworCQl9CisKKwkJZm9yIChqID0gMDsg
aiA8IEFSUkFZX1NJWkUocmVnaW9uLT5tYWNyb19zdGF0ZSk7IGorKykKKwkJCXJlZ2lvbi0+bWFj
cm9fc3RhdGVbal0gPSBDTEtfT0ZGOworCX0KKworCXBsYXRmb3JtX3NldF9kcnZkYXRhKHBkZXYs
IG9jbWVtKTsKKworCXJldHVybiAwOworCitlcnJfY2xrX2Rpc2FibGU6CisJY2xrX2J1bGtfZGlz
YWJsZV91bnByZXBhcmUoQVJSQVlfU0laRShvY21lbV9jbGtzKSwgb2NtZW1fY2xrcyk7CisJcmV0
dXJuIHJldDsKK30KKworc3RhdGljIGludCBvY21lbV9kZXZfcmVtb3ZlKHN0cnVjdCBwbGF0Zm9y
bV9kZXZpY2UgKnBkZXYpCit7CisJY2xrX2J1bGtfZGlzYWJsZV91bnByZXBhcmUoQVJSQVlfU0la
RShvY21lbV9jbGtzKSwgb2NtZW1fY2xrcyk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNv
bnN0IHN0cnVjdCBvY21lbV9jb25maWcgb2NtZW1fODk3NF9jb25maWcgPSB7CisJLm51bV9yZWdp
b25zID0gMywKKwkubWFjcm9fc2l6ZSA9IFNaXzEyOEssCit9OworCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IG9mX2RldmljZV9pZCBvY21lbV9vZl9tYXRjaFtdID0geworCXsgLmNvbXBhdGlibGUgPSAi
cWNvbSxtc204OTc0LW9jbWVtIiwgLmRhdGEgPSAmb2NtZW1fODk3NF9jb25maWcgfSwKKwl7IH0K
K307CisKK01PRFVMRV9ERVZJQ0VfVEFCTEUob2YsIG9jbWVtX29mX21hdGNoKTsKKworc3RhdGlj
IHN0cnVjdCBwbGF0Zm9ybV9kcml2ZXIgb2NtZW1fZHJpdmVyID0geworCS5wcm9iZSA9IG9jbWVt
X2Rldl9wcm9iZSwKKwkucmVtb3ZlID0gb2NtZW1fZGV2X3JlbW92ZSwKKwkuZHJpdmVyID0gewor
CQkubmFtZSA9ICJvY21lbSIsCisJCS5vZl9tYXRjaF90YWJsZSA9IG9jbWVtX29mX21hdGNoLAor
CX0sCit9OworCittb2R1bGVfcGxhdGZvcm1fZHJpdmVyKG9jbWVtX2RyaXZlcik7CisKK01PRFVM
RV9ERVNDUklQVElPTigiT24gQ2hpcCBNZW1vcnkgKE9DTUVNKSBhbGxvY2F0b3IgZm9yIHNvbWUg
U25hcGRyYWdvbiBTb0NzIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7CmRpZmYgLS1naXQg
YS9pbmNsdWRlL3NvYy9xY29tL29jbWVtLmggYi9pbmNsdWRlL3NvYy9xY29tL29jbWVtLmgKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hMGFlMzM2YmE3OGIKLS0tIC9k
ZXYvbnVsbAorKysgYi9pbmNsdWRlL3NvYy9xY29tL29jbWVtLmgKQEAgLTAsMCArMSw2MiBAQAor
LyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seSAqLworLyoKKyAqIFRoZSBP
biBDaGlwIE1lbW9yeSAoT0NNRU0pIGFsbG9jYXRvciBhbGxvd3MgdmFyaW91cyBjbGllbnRzIHRv
IGFsbG9jYXRlCisgKiBtZW1vcnkgZnJvbSBPQ01FTSBiYXNlZCBvbiBwZXJmb3JtYW5jZSwgbGF0
ZW5jeSBhbmQgcG93ZXIgcmVxdWlyZW1lbnRzLgorICogVGhpcyBpcyB0eXBpY2FsbHkgdXNlZCBi
eSB0aGUgR1BVLCBjYW1lcmEvdmlkZW8sIGFuZCBhdWRpbyBjb21wb25lbnRzIG9uCisgKiBzb21l
IFNuYXBkcmFnb24gU29Dcy4KKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTkgQnJpYW4gTWFzbmV5
IDxtYXNuZXliQG9uc3RhdGlvbi5vcmc+CisgKiBDb3B5cmlnaHQgKEMpIDIwMTUgUmVkIEhhdC4g
QXV0aG9yOiBSb2IgQ2xhcmsgPHJvYmRjbGFya0BnbWFpbC5jb20+CisgKi8KKworI2lmbmRlZiBf
X09DTUVNX0hfXworI2RlZmluZSBfX09DTUVNX0hfXworCitlbnVtIG9jbWVtX2NsaWVudCB7CisJ
LyogR01FTSBjbGllbnRzICovCisJT0NNRU1fR1JBUEhJQ1MgPSAweDAsCisJLyoKKwkgKiBUT0RP
IGFkZCBtb3JlIG9uY2Ugb2NtZW1fYWxsb2NhdGUoKSBpcyBjbGV2ZXIgZW5vdWdoIHRvCisJICog
ZGVhbCB3aXRoIG11bHRpcGxlIGNsaWVudHMuCisJICovCisJT0NNRU1fQ0xJRU5UX01BWCwKK307
CisKK3N0cnVjdCBvY21lbTsKKworc3RydWN0IG9jbWVtX2J1ZiB7CisJdW5zaWduZWQgbG9uZyBv
ZmZzZXQ7CisJdW5zaWduZWQgbG9uZyBhZGRyOworCXVuc2lnbmVkIGxvbmcgbGVuOworfTsKKwor
I2lmIElTX0VOQUJMRUQoQ09ORklHX1FDT01fT0NNRU0pCisKK3N0cnVjdCBvY21lbSAqb2ZfZ2V0
X29jbWVtKHN0cnVjdCBkZXZpY2UgKmRldik7CitzdHJ1Y3Qgb2NtZW1fYnVmICpvY21lbV9hbGxv
Y2F0ZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLCBlbnVtIG9jbWVtX2NsaWVudCBjbGllbnQsCisJCQkJ
IHVuc2lnbmVkIGxvbmcgc2l6ZSk7Cit2b2lkIG9jbWVtX2ZyZWUoc3RydWN0IG9jbWVtICpvY21l
bSwgZW51bSBvY21lbV9jbGllbnQgY2xpZW50LAorCQlzdHJ1Y3Qgb2NtZW1fYnVmICpidWYpOwor
CisjZWxzZSAvKiBJU19FTkFCTEVEKENPTkZJR19RQ09NX09DTUVNKSAqLworCitzdGF0aWMgaW5s
aW5lIHN0cnVjdCBvY21lbSAqb2ZfZ2V0X29jbWVtKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwly
ZXR1cm4gRVJSX1BUUigtRU5PREVWKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3Qgb2NtZW1f
YnVmICpvY21lbV9hbGxvY2F0ZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLAorCQkJCQkgICAgICAgZW51
bSBvY21lbV9jbGllbnQgY2xpZW50LAorCQkJCQkgICAgICAgdW5zaWduZWQgbG9uZyBzaXplKQor
eworCXJldHVybiBFUlJfUFRSKC1FTk9ERVYpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgb2Nt
ZW1fZnJlZShzdHJ1Y3Qgb2NtZW0gKm9jbWVtLCBlbnVtIG9jbWVtX2NsaWVudCBjbGllbnQsCisJ
CQkgICAgICBzdHJ1Y3Qgb2NtZW1fYnVmICpidWYpCit7Cit9CisKKyNlbmRpZiAvKiBJU19FTkFC
TEVEKENPTkZJR19RQ09NX09DTUVNKSAqLworCisjZW5kaWYgLyogX19PQ01FTV9IX18gKi8KLS0g
CjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
