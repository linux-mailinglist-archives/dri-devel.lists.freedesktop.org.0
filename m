Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B715745D12
	for <lists+dri-devel@lfdr.de>; Fri, 14 Jun 2019 14:41:48 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 921158989C;
	Fri, 14 Jun 2019 12:41:38 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0BC4989622;
 Fri, 14 Jun 2019 12:41:31 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id p11so2383641wre.7;
 Fri, 14 Jun 2019 05:41:30 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=LQVSIEeD0nQzbNe4535DUZpv1oRub2NRc611Dv3vQ2E=;
 b=VBUfrMUS38XW5rBArMTM8+8pwqWdyN4uhbJxntW14jxXk7GCuUbrUBD7Lun+oXp0Tt
 A/a8D0V4NSLdLHEFZG8Jf4s8tadgK5MCcXKuihPEF3xvW4tcOJs4sVIU2apG7ANHRZQw
 suomLohy1V7fCjILnkaHguGC0AIozTAuUJXk/Nf924pKRm5HcH8itn8LeGuQeTBnlYrK
 sKrU9qvxVKgfskVdyA5MJaQKp4BglZ7e/DDp6aITTjhrJVvcFcqWJMpy4QHDt304Il79
 s2wCv8p8w5PuVuWrFlnj27FxfNS46JfAtwphBRM/mvlsZPu7bLAZy4XB0/na70+FCFFC
 OezA==
X-Gm-Message-State: APjAAAVQqpAud10Ul0rJV8uWIHm/tSLNCWztL3csryW94I/fzcrZBXkh
 EiI4JRJk8iFZETOMJ4wIgOg=
X-Google-Smtp-Source: APXvYqzEdAgdauf41YwPRc3SYhWnz6aN1kSFojwDXPTchHah0RZrzIl9XgaiXofcDmaHzXYGkQX60Q==
X-Received: by 2002:a5d:6b12:: with SMTP id v18mr65247584wrw.306.1560516089779; 
 Fri, 14 Jun 2019 05:41:29 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:e0eb:ed4e:b781:3e9f])
 by smtp.gmail.com with ESMTPSA id n1sm2648209wrx.39.2019.06.14.05.41.28
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Fri, 14 Jun 2019 05:41:29 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: daniel@ffwll.ch, l.stach@pengutronix.de, linux+etnaviv@armlinux.org.uk,
 christian.gmeiner@gmail.com, yuq825@gmail.com, eric@anholt.net,
 peterz@infradead.org, thellstrom@vmware.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 etnaviv@lists.freedesktop.org, lima@lists.freedesktop.org
Subject: [PATCH 2/6] drm/ttm: use new ww_mutex_(un)lock_for_each macros
Date: Fri, 14 Jun 2019 14:41:21 +0200
Message-Id: <20190614124125.124181-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190614124125.124181-1-christian.koenig@amd.com>
References: <20190614124125.124181-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=LQVSIEeD0nQzbNe4535DUZpv1oRub2NRc611Dv3vQ2E=;
 b=OGBD+TBx8N5h5M7hqo9FLX4pLxhzEZsCYqoAEaTl7ua/mP0uHew+Lqcg9A7yeKJIcJ
 KNs0dPdBzQH2l/YVDrrvsoWAK7N4/c0BD+0edugp+RFN9ay8P8dmMXS/NiaERFiGk8Og
 Z2Tl6XU0+Nb8PqL2WodA/Dskr7w9VTedd7TF/W6zbmOTOJaLDe+Z4S0p4KMKB4O61Ghx
 EOmdsGe7lKv5KG/H8b/dCUxv6Vh4KCorOFGnI5vW2AIEG+28pG1pdiz8p3feCjMsjHmh
 DJTt8Fjrw9BtvlXIgfMTWOBwZ58TxTogvySRswGvxJnwPfzC7rmEzGbOAIsTN7ljoV7h
 wLHg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXNlIHRoZSBwcm92aWRlZCBtYWNyb3MgaW5zdGVhZCBvZiBpbXBsZW1lbnRpbmcgZGVhZGxvY2sg
aGFuZGxpbmcgb24gb3VyIG93bi4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9leGVj
YnVmX3V0aWwuYyB8IDg3ICsrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdl
ZCwgMzAgaW5zZXJ0aW9ucygrKSwgNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9leGVjYnVmX3V0aWwuYwppbmRleCA5NTdlYzM3NWE0YmEuLjNjM2FjNmM5NGQ3ZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKQEAgLTMzLDE2ICszMyw2IEBACiAjaW5j
bHVkZSA8bGludXgvc2NoZWQuaD4KICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KIAotc3RhdGlj
IHZvaWQgdHRtX2V1X2JhY2tvZmZfcmVzZXJ2YXRpb25fcmV2ZXJzZShzdHJ1Y3QgbGlzdF9oZWFk
ICpsaXN0LAotCQkJCQkgICAgICBzdHJ1Y3QgdHRtX3ZhbGlkYXRlX2J1ZmZlciAqZW50cnkpCi17
Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeV9jb250aW51ZV9yZXZlcnNlKGVudHJ5LCBsaXN0LCBoZWFk
KSB7Ci0JCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSBlbnRyeS0+Ym87Ci0KLQkJcmVz
ZXJ2YXRpb25fb2JqZWN0X3VubG9jayhiby0+cmVzdik7Ci0JfQotfQotCiBzdGF0aWMgdm9pZCB0
dG1fZXVfZGVsX2Zyb21fbHJ1X2xvY2tlZChzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0KQogewogCXN0
cnVjdCB0dG1fdmFsaWRhdGVfYnVmZmVyICplbnRyeTsKQEAgLTk2LDggKzg2LDkgQEAgaW50IHR0
bV9ldV9yZXNlcnZlX2J1ZmZlcnMoc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQsCiAJCQkg
ICBzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0LCBib29sIGludHIsCiAJCQkgICBzdHJ1Y3QgbGlzdF9o
ZWFkICpkdXBzLCBib29sIGRlbF9scnUpCiB7Ci0Jc3RydWN0IHR0bV9ib19nbG9iYWwgKmdsb2I7
CiAJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgKmVudHJ5OworCXN0cnVjdCB3d19tdXRleCAq
Y29udGVuZGVkOworCXN0cnVjdCB0dG1fYm9fZ2xvYmFsICpnbG9iOwogCWludCByZXQ7CiAKIAlp
ZiAobGlzdF9lbXB0eShsaXN0KSkKQEAgLTEwOSw2OCArMTAwLDM5IEBAIGludCB0dG1fZXVfcmVz
ZXJ2ZV9idWZmZXJzKHN0cnVjdCB3d19hY3F1aXJlX2N0eCAqdGlja2V0LAogCWlmICh0aWNrZXQp
CiAJCXd3X2FjcXVpcmVfaW5pdCh0aWNrZXQsICZyZXNlcnZhdGlvbl93d19jbGFzcyk7CiAKLQls
aXN0X2Zvcl9lYWNoX2VudHJ5KGVudHJ5LCBsaXN0LCBoZWFkKSB7CisJd3dfbXV0ZXhfbG9ja19m
b3JfZWFjaChsaXN0X2Zvcl9lYWNoX2VudHJ5KGVudHJ5LCBsaXN0LCBoZWFkKSwKKwkJCSAgICAg
ICAmZW50cnktPmJvLT5yZXN2LT5sb2NrLCBjb250ZW5kZWQsIHJldCwKKwkJCSAgICAgICBpbnRy
LCB0aWNrZXQpCisJewogCQlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gZW50cnktPmJv
OwogCi0JCXJldCA9IF9fdHRtX2JvX3Jlc2VydmUoYm8sIGludHIsICh0aWNrZXQgPT0gTlVMTCks
IHRpY2tldCk7CiAJCWlmICghcmV0ICYmIHVubGlrZWx5KGF0b21pY19yZWFkKCZiby0+Y3B1X3dy
aXRlcnMpID4gMCkpIHsKIAkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYm8tPnJlc3YpOwot
CiAJCQlyZXQgPSAtRUJVU1k7CisJCQlnb3RvIGVycm9yOworCQl9CiAKLQkJfSBlbHNlIGlmIChy
ZXQgPT0gLUVBTFJFQURZICYmIGR1cHMpIHsKKwkJaWYgKHJldCA9PSAtRUFMUkVBRFkgJiYgZHVw
cykgewogCQkJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgKnNhZmUgPSBlbnRyeTsKKwogCQkJ
ZW50cnkgPSBsaXN0X3ByZXZfZW50cnkoZW50cnksIGhlYWQpOwogCQkJbGlzdF9kZWwoJnNhZmUt
PmhlYWQpOwogCQkJbGlzdF9hZGQoJnNhZmUtPmhlYWQsIGR1cHMpOwogCQkJY29udGludWU7CiAJ
CX0KIAotCQlpZiAoIXJldCkgewotCQkJaWYgKCFlbnRyeS0+bnVtX3NoYXJlZCkKLQkJCQljb250
aW51ZTsKLQotCQkJcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hhcmVkKGJvLT5y
ZXN2LAotCQkJCQkJCQllbnRyeS0+bnVtX3NoYXJlZCk7Ci0JCQlpZiAoIXJldCkKLQkJCQljb250
aW51ZTsKLQkJfQorCQlpZiAodW5saWtlbHkocmV0KSkKKwkJCWdvdG8gZXJyb3I7CiAKLQkJLyog
dWggb2gsIHdlIGxvc3Qgb3V0LCBkcm9wIGV2ZXJ5IHJlc2VydmF0aW9uIGFuZCB0cnkKLQkJICog
dG8gb25seSByZXNlcnZlIHRoaXMgYnVmZmVyLCB0aGVuIHN0YXJ0IG92ZXIgaWYKLQkJICogdGhp
cyBzdWNjZWVkcy4KLQkJICovCi0JCXR0bV9ldV9iYWNrb2ZmX3Jlc2VydmF0aW9uX3JldmVyc2Uo
bGlzdCwgZW50cnkpOwotCi0JCWlmIChyZXQgPT0gLUVERUFETEspIHsKLQkJCWlmIChpbnRyKSB7
Ci0JCQkJcmV0ID0gd3dfbXV0ZXhfbG9ja19zbG93X2ludGVycnVwdGlibGUoJmJvLT5yZXN2LT5s
b2NrLAotCQkJCQkJCQkgICAgICAgdGlja2V0KTsKLQkJCX0gZWxzZSB7Ci0JCQkJd3dfbXV0ZXhf
bG9ja19zbG93KCZiby0+cmVzdi0+bG9jaywgdGlja2V0KTsKLQkJCQlyZXQgPSAwOwotCQkJfQot
CQl9CisJCWlmICghZW50cnktPm51bV9zaGFyZWQpCisJCQljb250aW51ZTsKIAotCQlpZiAoIXJl
dCAmJiBlbnRyeS0+bnVtX3NoYXJlZCkKLQkJCXJldCA9IHJlc2VydmF0aW9uX29iamVjdF9yZXNl
cnZlX3NoYXJlZChiby0+cmVzdiwKLQkJCQkJCQkJZW50cnktPm51bV9zaGFyZWQpOwotCi0JCWlm
ICh1bmxpa2VseShyZXQgIT0gMCkpIHsKLQkJCWlmIChyZXQgPT0gLUVJTlRSKQotCQkJCXJldCA9
IC1FUkVTVEFSVFNZUzsKLQkJCWlmICh0aWNrZXQpIHsKLQkJCQl3d19hY3F1aXJlX2RvbmUodGlj
a2V0KTsKLQkJCQl3d19hY3F1aXJlX2ZpbmkodGlja2V0KTsKLQkJCX0KLQkJCXJldHVybiByZXQ7
CisJCXJldCA9IHJlc2VydmF0aW9uX29iamVjdF9yZXNlcnZlX3NoYXJlZChiby0+cmVzdiwKKwkJ
CQkJCQllbnRyeS0+bnVtX3NoYXJlZCk7CisJCWlmICh1bmxpa2VseShyZXQpKSB7CisJCQlyZXNl
cnZhdGlvbl9vYmplY3RfdW5sb2NrKGJvLT5yZXN2KTsKKwkJCWdvdG8gZXJyb3I7CiAJCX0KLQot
CQkvKiBtb3ZlIHRoaXMgaXRlbSB0byB0aGUgZnJvbnQgb2YgdGhlIGxpc3QsCi0JCSAqIGZvcmNl
cyBjb3JyZWN0IGl0ZXJhdGlvbiBvZiB0aGUgbG9vcCB3aXRob3V0IGtlZXBpbmcgdHJhY2sKLQkJ
ICovCi0JCWxpc3RfZGVsKCZlbnRyeS0+aGVhZCk7Ci0JCWxpc3RfYWRkKCZlbnRyeS0+aGVhZCwg
bGlzdCk7CiAJfQogCiAJaWYgKGRlbF9scnUpIHsKQEAgLTE3OSw2ICsxNDEsMTcgQEAgaW50IHR0
bV9ldV9yZXNlcnZlX2J1ZmZlcnMoc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQsCiAJCXNw
aW5fdW5sb2NrKCZnbG9iLT5scnVfbG9jayk7CiAJfQogCXJldHVybiAwOworCitlcnJvcjoKKwl3
d19tdXRleF91bmxvY2tfZm9yX2VhY2gobGlzdF9mb3JfZWFjaF9lbnRyeShlbnRyeSwgbGlzdCwg
aGVhZCksCisJCQkJICZlbnRyeS0+Ym8tPnJlc3YtPmxvY2ssIGNvbnRlbmRlZCk7CisJaWYgKHJl
dCA9PSAtRUlOVFIpCisJCXJldCA9IC1FUkVTVEFSVFNZUzsKKwlpZiAodGlja2V0KSB7CisJCXd3
X2FjcXVpcmVfZG9uZSh0aWNrZXQpOworCQl3d19hY3F1aXJlX2ZpbmkodGlja2V0KTsKKwl9CisJ
cmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0wodHRtX2V1X3Jlc2VydmVfYnVmZmVycyk7CiAK
LS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
