Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4177411770E
	for <lists+dri-devel@lfdr.de>; Mon,  9 Dec 2019 21:11:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 011806E520;
	Mon,  9 Dec 2019 20:11:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 996396E51C;
 Mon,  9 Dec 2019 20:11:46 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id j17so13858694edp.3;
 Mon, 09 Dec 2019 12:11:46 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=wZ2HOTqwIQ1NAAnGyBsMzZ3ZgaYWTk44q8tb0yDSItU=;
 b=Qme1C5QIMRu34Ece/pMdjBF1r3oqfsqgmVdSQwHbK28qNaKRUJZRgllMsU8JP5gC49
 yETYLP7nGalM0aBEZR0vKiunU/qYwTpjS0DK4LWnd8sQ7JEeSWrKeZ8p1Qh3jUJsNkcj
 ZMfBawqMK8nfi5CGNFM3O3mfz7bWvvbfFeU0667ijM0gn+4X2Cvpd7qGaqGOm7/PmrUK
 41duiIRTQ5opM/qGpgLnD9xLDHTIBCj8SIEA9omJh3m2wsTkO3M4nBy1vP5lgDdrJAbA
 KD1vtabnmzm2ihDKH+2ObDQmyZTRdOMymlYgPzx6Y4EOOZ4AMR2Ggfd4i9nFeMAe9rHd
 K3BA==
X-Gm-Message-State: APjAAAX6WlAwKkot9ooEW/eSGEL5XG4dO3+OgUypyEltZWPVOwoTwd1q
 Z+QZ7u9FcNlZe3YXXrCf1wICKHZOGNKg0a6PGGU=
X-Google-Smtp-Source: APXvYqxNLhd1U+YLI5W6r0mL/L/+plGCkZf16NdFCgs7JirzvWpkN6MvND4INCC+rb/8RpnVv3kc/vAkMgSl4wSOWkE=
X-Received: by 2002:a50:fc85:: with SMTP id f5mr34613985edq.294.1575922304961; 
 Mon, 09 Dec 2019 12:11:44 -0800 (PST)
MIME-Version: 1.0
References: <1574465484-7115-1-git-send-email-jcrouse@codeaurora.org>
 <0101016e95754002-c2fa43aa-b14b-4cff-b6f9-a67c96661e26-000000@us-west-2.amazonses.com>
In-Reply-To: <0101016e95754002-c2fa43aa-b14b-4cff-b6f9-a67c96661e26-000000@us-west-2.amazonses.com>
From: Rob Clark <robdclark@gmail.com>
Date: Mon, 9 Dec 2019 12:11:35 -0800
Message-ID: <CAF6AEGuAjSyMTqCauO2i6wQDEq1Q1baNMisCr=WZi3WHeyzxmw@mail.gmail.com>
Subject: Re: [PATCH v2 5/8] drm/msm: Attach the IOMMU device during
 initialization
To: Jordan Crouse <jcrouse@codeaurora.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=wZ2HOTqwIQ1NAAnGyBsMzZ3ZgaYWTk44q8tb0yDSItU=;
 b=KStCE1zdCoPav3I7cdyQFhCBV5DOWW+tMPDgsnz0bHDBXlJFk+/oAeNNpktiM8ai8G
 +M2zh2KIUP/+eZwy+eNkkDv9L1DWkeUjn0245DOKZUhvUODAC8Yv01KnChdek69IURzH
 /yRnR4O5MnoSHA17qiPKeNo7YKRdqrX10tlkTXtj9vQ29MY/lk54fV4dzhOsj4il2y4P
 0RL43Y+f1RkX8tht0uasZFTCbCh4No/u9+1uZOh/OJilWcq60HWKAR6yOXmLQPwBspGm
 RzxDrBDtK+nwWOI5mlbTWVmcnFJEtYJzzLrshrmR/HPX0gIP8t4y0xP5XJUZGMJUO/uN
 n8ow==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sean Paul <sean@poorly.run>, freedreno <freedreno@lists.freedesktop.org>,
 Jonathan Marek <jonathan@marek.ca>, Sam Ravnborg <sam@ravnborg.org>,
 Jeffrey Hugo <jeffrey.l.hugo@gmail.com>, David Airlie <airlied@linux.ie>,
 Robin Murphy <robin.murphy@arm.com>,
 Linux Kernel Mailing List <linux-kernel@vger.kernel.org>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Georgi Djakov <georgi.djakov@linaro.org>, Bruce Wang <bzwang@chromium.org>,
 "list@263.net:IOMMU DRIVERS <iommu@lists.linux-foundation.org>,
 Joerg Roedel <joro@8bytes.org>, " <iommu@lists.linux-foundation.org>,
 Mamta Shukla <mamtashukla555@gmail.com>,
 linux-arm-msm <linux-arm-msm@vger.kernel.org>,
 Drew Davenport <ddavenport@chromium.org>,
 AngeloGioacchino Del Regno <kholk11@gmail.com>, Will Deacon <will@kernel.org>,
 Thomas Gleixner <tglx@linutronix.de>,
 "moderated list:ARM/FREESCALE IMX / MXC ARM ARCHITECTURE"
 <linux-arm-kernel@lists.infradead.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gRnJpLCBOb3YgMjIsIDIwMTkgYXQgMzozMiBQTSBKb3JkYW4gQ3JvdXNlIDxqY3JvdXNlQGNv
ZGVhdXJvcmEub3JnPiB3cm90ZToKPgo+IEV2ZXJ5d2hlcmUgYW4gSU9NTVUgb2JqZWN0IGlzIGNy
ZWF0ZWQgYnkgbXNtX2dwdV9jcmVhdGVfYWRkcmVzc19zcGFjZQo+IHRoZSBJT01NVSBkZXZpY2Ug
aXMgYXR0YWNoZWQgaW1tZWRpYXRlbHkgYWZ0ZXIuIEluc3RlYWQgb2YgY2FycnlpbmcgYXJvdW5k
Cj4gdGhlIGluZnJhc3RydWN0dXJlIHRvIGRvIHRoZSBhdHRhY2ggZnJvbSB0aGUgZGV2aWNlIHNw
ZWNpZmljIGNvZGUgZG8gaXQKPiBkaXJlY3RseSBpbiB0aGUgbXNtX2lvbW11X2luaXQoKSBmdW5j
dGlvbi4gVGhpcyBnZXRzIGl0IG91dCBvZiB0aGUgd2F5IGZvcgo+IG1vcmUgYWdncmVzc2l2ZSBj
bGVhbnVwcyB0aGF0IGZvbGxvdy4KPgo+IFNpZ25lZC1vZmYtYnk6IEpvcmRhbiBDcm91c2UgPGpj
cm91c2VAY29kZWF1cm9yYS5vcmc+CgpIbW0sIHllYWgsIG5vdyB0aGF0IHdlIGRyb3BwZWQgdGhl
IGV4dHJhIG1tdS0+YXR0YWNoKCkgYXJncyAod2hpY2ggd2FzCnNvbWUgYW5jaWVudCBkb3duc3Ry
ZWFtIGNvbXBhdCB0aGluZyksIHdlIGRvbid0IG5lZWQgdGhlIHNlcGFyYXRlCmF0dGFjaCBzdGVw
LiAgSSBzdXBwb3NlIHdlIHByb2JhYmx5IHNob3VsZCBkbyBhIHNpbWlsYXIgY2xlYW51cCBmb3IK
bW11LT5kZXRhY2goKSwgYnV0IEkgZ3Vlc3MgdGhhdCBjYW4gYmUgaXQncyBvd24gcGF0Y2gKClJl
dmlld2VkLWJ5OiBSb2IgQ2xhcmsgPHJvYmRjbGFya0BnbWFpbC5jb20+CgoKPiAtLS0KPgo+ICBk
cml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMgIHwgIDggLS0tLS0tLS0KPiAg
ZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDQvbWRwNF9rbXMuYyB8ICA0IC0tLS0KPiAgZHJp
dmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDUvbWRwNV9rbXMuYyB8ICA3IC0tLS0tLS0KPiAgZHJp
dmVycy9ncHUvZHJtL21zbS9tc21fZ2VtX3ZtYS5jICAgICAgICB8IDIzICsrKysrKysrKysrKysr
KysrKystLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5jICAgICAgICAgICAgfCAx
MSArLS0tLS0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHVtbXUuYyAgICAgICAg
IHwgIDYgLS0tLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2lvbW11LmMgICAgICAgICAg
fCAxNSArKysrKysrLS0tLS0tLS0KPiAgZHJpdmVycy9ncHUvZHJtL21zbS9tc21fbW11LmggICAg
ICAgICAgICB8ICAxIC0KPiAgOCBmaWxlcyBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspLCA0OCBk
ZWxldGlvbnMoLSkKPgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1
MS9kcHVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvZHB1MS9kcHVfa21zLmMKPiBp
bmRleCA2YzkyZjBmLi5iMDgyYjIzIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20v
ZGlzcC9kcHUxL2RwdV9rbXMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9kcHUx
L2RwdV9rbXMuYwo+IEBAIC03MDQsNyArNzA0LDYgQEAgc3RhdGljIGludCBfZHB1X2ttc19tbXVf
aW5pdChzdHJ1Y3QgZHB1X2ttcyAqZHB1X2ttcykKPiAgewo+ICAgICAgICAgc3RydWN0IGlvbW11
X2RvbWFpbiAqZG9tYWluOwo+ICAgICAgICAgc3RydWN0IG1zbV9nZW1fYWRkcmVzc19zcGFjZSAq
YXNwYWNlOwo+IC0gICAgICAgaW50IHJldDsKPgo+ICAgICAgICAgZG9tYWluID0gaW9tbXVfZG9t
YWluX2FsbG9jKCZwbGF0Zm9ybV9idXNfdHlwZSk7Cj4gICAgICAgICBpZiAoIWRvbWFpbikKPiBA
QCAtNzIwLDEzICs3MTksNiBAQCBzdGF0aWMgaW50IF9kcHVfa21zX21tdV9pbml0KHN0cnVjdCBk
cHVfa21zICpkcHVfa21zKQo+ICAgICAgICAgICAgICAgICByZXR1cm4gUFRSX0VSUihhc3BhY2Up
Owo+ICAgICAgICAgfQo+Cj4gLSAgICAgICByZXQgPSBhc3BhY2UtPm1tdS0+ZnVuY3MtPmF0dGFj
aChhc3BhY2UtPm1tdSk7Cj4gLSAgICAgICBpZiAocmV0KSB7Cj4gLSAgICAgICAgICAgICAgIERQ
VV9FUlJPUigiZmFpbGVkIHRvIGF0dGFjaCBpb21tdSAlZFxuIiwgcmV0KTsKPiAtICAgICAgICAg
ICAgICAgbXNtX2dlbV9hZGRyZXNzX3NwYWNlX3B1dChhc3BhY2UpOwo+IC0gICAgICAgICAgICAg
ICByZXR1cm4gcmV0Owo+IC0gICAgICAgfQo+IC0KPiAgICAgICAgIGRwdV9rbXMtPmJhc2UuYXNw
YWNlID0gYXNwYWNlOwo+ICAgICAgICAgcmV0dXJuIDA7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL21zbS9kaXNwL21kcDQvbWRwNF9rbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9t
c20vZGlzcC9tZHA0L21kcDRfa21zLmMKPiBpbmRleCBkZGEwNTQzLi45ZGJhMzdjIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA0L21kcDRfa21zLmMKPiArKysgYi9k
cml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvbWRwNC9tZHA0X2ttcy5jCj4gQEAgLTUxOCwxMCArNTE4
LDYgQEAgc3RydWN0IG1zbV9rbXMgKm1kcDRfa21zX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
dikKPiAgICAgICAgICAgICAgICAgfQo+Cj4gICAgICAgICAgICAgICAgIGttcy0+YXNwYWNlID0g
YXNwYWNlOwo+IC0KPiAtICAgICAgICAgICAgICAgcmV0ID0gYXNwYWNlLT5tbXUtPmZ1bmNzLT5h
dHRhY2goYXNwYWNlLT5tbXUpOwo+IC0gICAgICAgICAgICAgICBpZiAocmV0KQo+IC0gICAgICAg
ICAgICAgICAgICAgICAgIGdvdG8gZmFpbDsKPiAgICAgICAgIH0gZWxzZSB7Cj4gICAgICAgICAg
ICAgICAgIERSTV9ERVZfSU5GTyhkZXYtPmRldiwgIm5vIGlvbW11LCBmYWxsYmFjayB0byBwaHlz
ICIKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb250aWcgYnVmZmVycyBmb3Ig
c2Nhbm91dFxuIik7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZGlzcC9tZHA1
L21kcDVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL2Rpc3AvbWRwNS9tZHA1X2ttcy5jCj4g
aW5kZXggZTQzZWNkNC4uNjUzZGFiMiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vbXNt
L2Rpc3AvbWRwNS9tZHA1X2ttcy5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9kaXNwL21k
cDUvbWRwNV9rbXMuYwo+IEBAIC03MzYsMTMgKzczNiw2IEBAIHN0cnVjdCBtc21fa21zICptZHA1
X2ttc19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCj4gICAgICAgICAgICAgICAgIH0KPgo+
ICAgICAgICAgICAgICAgICBrbXMtPmFzcGFjZSA9IGFzcGFjZTsKPiAtCj4gLSAgICAgICAgICAg
ICAgIHJldCA9IGFzcGFjZS0+bW11LT5mdW5jcy0+YXR0YWNoKGFzcGFjZS0+bW11KTsKPiAtICAg
ICAgICAgICAgICAgaWYgKHJldCkgewo+IC0gICAgICAgICAgICAgICAgICAgICAgIERSTV9ERVZf
RVJST1IoJnBkZXYtPmRldiwgImZhaWxlZCB0byBhdHRhY2ggaW9tbXU6ICVkXG4iLAo+IC0gICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0KTsKPiAtICAgICAgICAgICAgICAgICAgICAg
ICBnb3RvIGZhaWw7Cj4gLSAgICAgICAgICAgICAgIH0KPiAgICAgICAgIH0gZWxzZSB7Cj4gICAg
ICAgICAgICAgICAgIERSTV9ERVZfSU5GTygmcGRldi0+ZGV2LAo+ICAgICAgICAgICAgICAgICAg
ICAgICAgICAibm8gaW9tbXUsIGZhbGxiYWNrIHRvIHBoeXMgY29udGlnIGJ1ZmZlcnMgZm9yIHNj
YW5vdXRcbiIpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fdm1h
LmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9nZW1fdm1hLmMKPiBpbmRleCAxYWY1MzU0Li45
MWQ5OTNhIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbV92bWEuYwo+
ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dlbV92bWEuYwo+IEBAIC0xMzEsOCArMTMx
LDggQEAgbXNtX2dlbV9hZGRyZXNzX3NwYWNlX2NyZWF0ZShzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0
cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwKPiAgICAgICAgICAgICAgICAgY29uc3QgY2hhciAq
bmFtZSkKPiAgewo+ICAgICAgICAgc3RydWN0IG1zbV9nZW1fYWRkcmVzc19zcGFjZSAqYXNwYWNl
Owo+IC0gICAgICAgdTY0IHNpemUgPSBkb21haW4tPmdlb21ldHJ5LmFwZXJ0dXJlX2VuZCAtCj4g
LSAgICAgICAgICAgICAgIGRvbWFpbi0+Z2VvbWV0cnkuYXBlcnR1cmVfc3RhcnQ7Cj4gKyAgICAg
ICB1NjQgc3RhcnQgPSBkb21haW4tPmdlb21ldHJ5LmFwZXJ0dXJlX3N0YXJ0Owo+ICsgICAgICAg
dTY0IHNpemUgPSBkb21haW4tPmdlb21ldHJ5LmFwZXJ0dXJlX2VuZCAtIHN0YXJ0Owo+Cj4gICAg
ICAgICBhc3BhY2UgPSBremFsbG9jKHNpemVvZigqYXNwYWNlKSwgR0ZQX0tFUk5FTCk7Cj4gICAg
ICAgICBpZiAoIWFzcGFjZSkKPiBAQCAtMTQxLDkgKzE0MSwxOCBAQCBtc21fZ2VtX2FkZHJlc3Nf
c3BhY2VfY3JlYXRlKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IGlvbW11X2RvbWFpbiAqZG9t
YWluLAo+ICAgICAgICAgc3Bpbl9sb2NrX2luaXQoJmFzcGFjZS0+bG9jayk7Cj4gICAgICAgICBh
c3BhY2UtPm5hbWUgPSBuYW1lOwo+ICAgICAgICAgYXNwYWNlLT5tbXUgPSBtc21faW9tbXVfbmV3
KGRldiwgZG9tYWluKTsKPiArICAgICAgIGlmIChJU19FUlIoYXNwYWNlLT5tbXUpKSB7Cj4gKyAg
ICAgICAgICAgICAgIGludCByZXQgPSBQVFJfRVJSKGFzcGFjZS0+bW11KTsKPgo+IC0gICAgICAg
ZHJtX21tX2luaXQoJmFzcGFjZS0+bW0sIChkb21haW4tPmdlb21ldHJ5LmFwZXJ0dXJlX3N0YXJ0
ID4+IFBBR0VfU0hJRlQpLAo+IC0gICAgICAgICAgICAgICBzaXplID4+IFBBR0VfU0hJRlQpOwo+
ICsgICAgICAgICAgICAgICBrZnJlZShhc3BhY2UpOwo+ICsgICAgICAgICAgICAgICByZXR1cm4g
RVJSX1BUUihyZXQpOwo+ICsgICAgICAgfQo+ICsKPiArICAgICAgIC8qCj4gKyAgICAgICAgKiBB
dHRhY2hpbmcgdGhlIElPTU1VIGRldmljZSBjaGFuZ2VzIHRoZSBhcGVydHVyZSB2YWx1ZXMgc28g
dXNlIHRoZQo+ICsgICAgICAgICogY2FjaGVkIHZhbHVlcyBpbnN0ZWFkCj4gKyAgICAgICAgKi8K
PiArICAgICAgIGRybV9tbV9pbml0KCZhc3BhY2UtPm1tLCBzdGFydCA+PiBQQUdFX1NISUZULCBz
aXplID4+IFBBR0VfU0hJRlQpOwo+Cj4gICAgICAgICBrcmVmX2luaXQoJmFzcGFjZS0+a3JlZik7
Cj4KPiBAQCAtMTY0LDYgKzE3MywxMiBAQCBtc21fZ2VtX2FkZHJlc3Nfc3BhY2VfY3JlYXRlX2Ey
eHgoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgbXNtX2dwdSAqZ3B1LAo+ICAgICAgICAgc3Bp
bl9sb2NrX2luaXQoJmFzcGFjZS0+bG9jayk7Cj4gICAgICAgICBhc3BhY2UtPm5hbWUgPSBuYW1l
Owo+ICAgICAgICAgYXNwYWNlLT5tbXUgPSBtc21fZ3B1bW11X25ldyhkZXYsIGdwdSk7Cj4gKyAg
ICAgICBpZiAoSVNfRVJSKGFzcGFjZS0+bW11KSkgewo+ICsgICAgICAgICAgICAgICBpbnQgcmV0
ID0gUFRSX0VSUihhc3BhY2UtPm1tdSk7Cj4gKwo+ICsgICAgICAgICAgICAgICBrZnJlZShhc3Bh
Y2UpOwo+ICsgICAgICAgICAgICAgICByZXR1cm4gRVJSX1BUUihyZXQpOwo+ICsgICAgICAgfQo+
Cj4gICAgICAgICBkcm1fbW1faW5pdCgmYXNwYWNlLT5tbSwgKHZhX3N0YXJ0ID4+IFBBR0VfU0hJ
RlQpLAo+ICAgICAgICAgICAgICAgICBzaXplID4+IFBBR0VfU0hJRlQpOwo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHUuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNt
X2dwdS5jCj4gaW5kZXggMThmM2E1Yy4uZjdiZjgwZSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dw
dS9kcm0vbXNtL21zbV9ncHUuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2dwdS5j
Cj4gQEAgLTgwOCw3ICs4MDgsNiBAQCBtc21fZ3B1X2NyZWF0ZV9hZGRyZXNzX3NwYWNlKHN0cnVj
dCBtc21fZ3B1ICpncHUsIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCj4gICAgICAgICAg
ICAgICAgIHVpbnQ2NF90IHZhX3N0YXJ0LCB1aW50NjRfdCB2YV9lbmQpCj4gIHsKPiAgICAgICAg
IHN0cnVjdCBtc21fZ2VtX2FkZHJlc3Nfc3BhY2UgKmFzcGFjZTsKPiAtICAgICAgIGludCByZXQ7
Cj4KPiAgICAgICAgIC8qCj4gICAgICAgICAgKiBTZXR1cCBJT01NVS4uIGV2ZW50dWFsbHkgd2Ug
d2lsbCAoSSB0aGluaykgZG8gdGhpcyBvbmNlIHBlciBjb250ZXh0Cj4gQEAgLTgzMywxNyArODMy
LDkgQEAgbXNtX2dwdV9jcmVhdGVfYWRkcmVzc19zcGFjZShzdHJ1Y3QgbXNtX2dwdSAqZ3B1LCBz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAo+ICAgICAgICAgICAgICAgICAgICAgICAgIHZh
X3N0YXJ0LCB2YV9lbmQpOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBpZiAoSVNfRVJSKGFzcGFj
ZSkpIHsKPiArICAgICAgIGlmIChJU19FUlIoYXNwYWNlKSkKPiAgICAgICAgICAgICAgICAgRFJN
X0RFVl9FUlJPUihncHUtPmRldi0+ZGV2LCAiZmFpbGVkIHRvIGluaXQgbW11OiAlbGRcbiIsCj4g
ICAgICAgICAgICAgICAgICAgICAgICAgUFRSX0VSUihhc3BhY2UpKTsKPiAtICAgICAgICAgICAg
ICAgcmV0dXJuIEVSUl9DQVNUKGFzcGFjZSk7Cj4gLSAgICAgICB9Cj4gLQo+IC0gICAgICAgcmV0
ID0gYXNwYWNlLT5tbXUtPmZ1bmNzLT5hdHRhY2goYXNwYWNlLT5tbXUpOwo+IC0gICAgICAgaWYg
KHJldCkgewo+IC0gICAgICAgICAgICAgICBtc21fZ2VtX2FkZHJlc3Nfc3BhY2VfcHV0KGFzcGFj
ZSk7Cj4gLSAgICAgICAgICAgICAgIHJldHVybiBFUlJfUFRSKHJldCk7Cj4gLSAgICAgICB9Cj4K
PiAgICAgICAgIHJldHVybiBhc3BhY2U7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL21zbS9tc21fZ3B1bW11LmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHVtbXUuYwo+
IGluZGV4IDM0OTgwZDguLjBhZDBmODQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL21z
bS9tc21fZ3B1bW11LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9ncHVtbXUuYwo+
IEBAIC0yMSwxMSArMjEsNiBAQCBzdHJ1Y3QgbXNtX2dwdW1tdSB7Cj4gICNkZWZpbmUgR1BVTU1V
X1BBR0VfU0laRSBTWl80Swo+ICAjZGVmaW5lIFRBQkxFX1NJWkUgKHNpemVvZih1aW50MzJfdCkg
KiBHUFVNTVVfVkFfUkFOR0UgLyBHUFVNTVVfUEFHRV9TSVpFKQo+Cj4gLXN0YXRpYyBpbnQgbXNt
X2dwdW1tdV9hdHRhY2goc3RydWN0IG1zbV9tbXUgKm1tdSkKPiAtewo+IC0gICAgICAgcmV0dXJu
IDA7Cj4gLX0KPiAtCj4gIHN0YXRpYyB2b2lkIG1zbV9ncHVtbXVfZGV0YWNoKHN0cnVjdCBtc21f
bW11ICptbXUpCj4gIHsKPiAgfQo+IEBAIC04NSw3ICs4MCw2IEBAIHN0YXRpYyB2b2lkIG1zbV9n
cHVtbXVfZGVzdHJveShzdHJ1Y3QgbXNtX21tdSAqbW11KQo+ICB9Cj4KPiAgc3RhdGljIGNvbnN0
IHN0cnVjdCBtc21fbW11X2Z1bmNzIGZ1bmNzID0gewo+IC0gICAgICAgICAgICAgICAuYXR0YWNo
ID0gbXNtX2dwdW1tdV9hdHRhY2gsCj4gICAgICAgICAgICAgICAgIC5kZXRhY2ggPSBtc21fZ3B1
bW11X2RldGFjaCwKPiAgICAgICAgICAgICAgICAgLm1hcCA9IG1zbV9ncHVtbXVfbWFwLAo+ICAg
ICAgICAgICAgICAgICAudW5tYXAgPSBtc21fZ3B1bW11X3VubWFwLAo+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vbXNtL21zbV9pb21tdS5jIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
aW9tbXUuYwo+IGluZGV4IGFkNThjZmUuLjU0NGM1MTkgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL21zbS9tc21faW9tbXUuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2lv
bW11LmMKPiBAQCAtMjMsMTMgKzIzLDYgQEAgc3RhdGljIGludCBtc21fZmF1bHRfaGFuZGxlcihz
dHJ1Y3QgaW9tbXVfZG9tYWluICpkb21haW4sIHN0cnVjdCBkZXZpY2UgKmRldiwKPiAgICAgICAg
IHJldHVybiAwOwo+ICB9Cj4KPiAtc3RhdGljIGludCBtc21faW9tbXVfYXR0YWNoKHN0cnVjdCBt
c21fbW11ICptbXUpCj4gLXsKPiAtICAgICAgIHN0cnVjdCBtc21faW9tbXUgKmlvbW11ID0gdG9f
bXNtX2lvbW11KG1tdSk7Cj4gLQo+IC0gICAgICAgcmV0dXJuIGlvbW11X2F0dGFjaF9kZXZpY2Uo
aW9tbXUtPmRvbWFpbiwgbW11LT5kZXYpOwo+IC19Cj4gLQo+ICBzdGF0aWMgdm9pZCBtc21faW9t
bXVfZGV0YWNoKHN0cnVjdCBtc21fbW11ICptbXUpCj4gIHsKPiAgICAgICAgIHN0cnVjdCBtc21f
aW9tbXUgKmlvbW11ID0gdG9fbXNtX2lvbW11KG1tdSk7Cj4gQEAgLTY2LDcgKzU5LDYgQEAgc3Rh
dGljIHZvaWQgbXNtX2lvbW11X2Rlc3Ryb3koc3RydWN0IG1zbV9tbXUgKm1tdSkKPiAgfQo+Cj4g
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgbXNtX21tdV9mdW5jcyBmdW5jcyA9IHsKPiAtICAgICAgICAg
ICAgICAgLmF0dGFjaCA9IG1zbV9pb21tdV9hdHRhY2gsCj4gICAgICAgICAgICAgICAgIC5kZXRh
Y2ggPSBtc21faW9tbXVfZGV0YWNoLAo+ICAgICAgICAgICAgICAgICAubWFwID0gbXNtX2lvbW11
X21hcCwKPiAgICAgICAgICAgICAgICAgLnVubWFwID0gbXNtX2lvbW11X3VubWFwLAo+IEBAIC03
Niw2ICs2OCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgbXNtX21tdV9mdW5jcyBmdW5jcyA9IHsK
PiAgc3RydWN0IG1zbV9tbXUgKm1zbV9pb21tdV9uZXcoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1
Y3QgaW9tbXVfZG9tYWluICpkb21haW4pCj4gIHsKPiAgICAgICAgIHN0cnVjdCBtc21faW9tbXUg
KmlvbW11Owo+ICsgICAgICAgaW50IHJldDsKPgo+ICAgICAgICAgaW9tbXUgPSBremFsbG9jKHNp
emVvZigqaW9tbXUpLCBHRlBfS0VSTkVMKTsKPiAgICAgICAgIGlmICghaW9tbXUpCj4gQEAgLTg1
LDUgKzc4LDExIEBAIHN0cnVjdCBtc21fbW11ICptc21faW9tbXVfbmV3KHN0cnVjdCBkZXZpY2Ug
KmRldiwgc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluKQo+ICAgICAgICAgbXNtX21tdV9pbml0
KCZpb21tdS0+YmFzZSwgZGV2LCAmZnVuY3MpOwo+ICAgICAgICAgaW9tbXVfc2V0X2ZhdWx0X2hh
bmRsZXIoZG9tYWluLCBtc21fZmF1bHRfaGFuZGxlciwgaW9tbXUpOwo+Cj4gKyAgICAgICByZXQg
PSBpb21tdV9hdHRhY2hfZGV2aWNlKGlvbW11LT5kb21haW4sIGRldik7Cj4gKyAgICAgICBpZiAo
cmV0KSB7Cj4gKyAgICAgICAgICAgICAgIGtmcmVlKGlvbW11KTsKPiArICAgICAgICAgICAgICAg
cmV0dXJuIEVSUl9QVFIocmV0KTsKPiArICAgICAgIH0KPiArCj4gICAgICAgICByZXR1cm4gJmlv
bW11LT5iYXNlOwo+ICB9Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX21t
dS5oIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fbW11LmgKPiBpbmRleCA2N2E2MjNmLi5iYWU5
ZThlIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX21tdS5oCj4gKysrIGIv
ZHJpdmVycy9ncHUvZHJtL21zbS9tc21fbW11LmgKPiBAQCAtMTAsNyArMTAsNiBAQAo+ICAjaW5j
bHVkZSA8bGludXgvaW9tbXUuaD4KPgo+ICBzdHJ1Y3QgbXNtX21tdV9mdW5jcyB7Cj4gLSAgICAg
ICBpbnQgKCphdHRhY2gpKHN0cnVjdCBtc21fbW11ICptbXUpOwo+ICAgICAgICAgdm9pZCAoKmRl
dGFjaCkoc3RydWN0IG1zbV9tbXUgKm1tdSk7Cj4gICAgICAgICBpbnQgKCptYXApKHN0cnVjdCBt
c21fbW11ICptbXUsIHVpbnQ2NF90IGlvdmEsIHN0cnVjdCBzZ190YWJsZSAqc2d0LAo+ICAgICAg
ICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGxlbiwgaW50IHByb3QpOwo+IC0tCj4gMi43LjQK
PgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2
ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
