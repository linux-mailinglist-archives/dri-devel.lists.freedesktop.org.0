Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8B588D897D
	for <lists+dri-devel@lfdr.de>; Wed, 16 Oct 2019 09:33:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 94BDC6E8CB;
	Wed, 16 Oct 2019 07:33:46 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x442.google.com (mail-pf1-x442.google.com
 [IPv6:2607:f8b0:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E8596E879
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 18:16:38 +0000 (UTC)
Received: by mail-pf1-x442.google.com with SMTP id a2so12975850pfo.10
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 11:16:38 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=iRW3sh+/KRUt0IvjdYFL27lKQnR6JopWyEWGX3mhAm8=;
 b=p3hw5rFDveNnFMdPktQuAdCFgQo1+yftP3RrGYYxnTTiyKFzby5ZI/q5geVCZSgfT6
 h8A23FkHKX3lBhDyq69tdnT1I744WQV9+D65tSUI/ZIJyCcDt8KXBUbP9WQudlFPJoza
 dwoG67/z7L6XmYqqFpe3+TmYxqiad8Ea8L25fEW1jhA5YxC6NP1fSxlyyaMUksZc59Kh
 oXSXebeAGJaAgjmBdZJNLhVrurPAQcTd8W+s8aC+X11sGBCLPJUCoIE41yfa/qlC6kl/
 i6FbYDWtEPjNpwFf/6sJMhqqLM+D/hGlCKTWXxTKMId5YxK//FcXekZZJrjubmrwm9A0
 4aiA==
X-Gm-Message-State: APjAAAXOtEwP+mkueNUIyoX88bgyJiVP7sfxV6tr7xxD5GwzN17ZY6GL
 TGEfieJfjHtppehb/sOmyvWmow==
X-Google-Smtp-Source: APXvYqxn5GyOR9bQAeLu3rv5akSVrWu3Kb3RnrvMd5wFUn6mPQxIDLOICpAwdvPqp2qaflwt2NAGog==
X-Received: by 2002:a63:cc4a:: with SMTP id q10mr40292268pgi.221.1571163397873; 
 Tue, 15 Oct 2019 11:16:37 -0700 (PDT)
Received: from ziepe.ca ([24.114.26.129])
 by smtp.gmail.com with ESMTPSA id e3sm12863pjs.15.2019.10.15.11.16.37
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 15 Oct 2019 11:16:37 -0700 (PDT)
Received: from jgg by jggl.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1iKRJT-0002CB-F7; Tue, 15 Oct 2019 15:12:51 -0300
From: Jason Gunthorpe <jgg@ziepe.ca>
To: Jerome Glisse <jglisse@redhat.com>, Ralph Campbell <rcampbell@nvidia.com>,
 John Hubbard <jhubbard@nvidia.com>, Felix.Kuehling@amd.com
Subject: [PATCH hmm 06/15] RDMA/hfi1: Use mmu_range_notifier_inset for
 user_exp_rcv
Date: Tue, 15 Oct 2019 15:12:33 -0300
Message-Id: <20191015181242.8343-7-jgg@ziepe.ca>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191015181242.8343-1-jgg@ziepe.ca>
References: <20191015181242.8343-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 16 Oct 2019 07:33:45 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=iRW3sh+/KRUt0IvjdYFL27lKQnR6JopWyEWGX3mhAm8=;
 b=Eiv4i3FnS+9AnZt+YbZ7uwkDRfoZtzmZHlf/1T6Dd+TGZm+IlbQdUSdoEknCGSJT74
 NHOt1fJW8ppGprWjV+ZQYPbBf7qZUYJYFU/w5OBCKL2lFeXoF1HITZnMmdZ/5bENAh0C
 M9xiGwCNGfBNjqdoby7Du4vQTGl7Oj1wVRWwQlOdxEGgEaI66pUpPU5ImgkRbRKHUUIQ
 CsqQpVj6VqeG3eZMk7whUQDFdm9J3A2/g0W8IVTEMk/STm80nkPFwQcSWD6AHgwlBcB2
 BbORyq+gZSHLYOXtikwSUIdzMNaGUecdS1CkW+jHUBTn7GcMhoxOBSDp2/E01qI0evFI
 PtOQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrea Arcangeli <aarcange@redhat.com>,
 Mike Marciniszyn <mike.marciniszyn@intel.com>, linux-rdma@vger.kernel.org,
 Dennis Dalessandro <dennis.dalessandro@intel.com>,
 amd-gfx@lists.freedesktop.org, linux-mm@kvack.org,
 Jason Gunthorpe <jgg@mellanox.com>, dri-devel@lists.freedesktop.org,
 Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhpcyBjb252ZXJ0cyBv
bmUgb2YgdGhlIHR3byB1c2VycyBvZiBtbXVfbm90aWZpZXJzIHRvIHVzZSB0aGUgbmV3IEFQSS4K
VGhlIGNvbnZlcnNpb24gaXMgZmFpcmx5IHN0cmFpZ2h0Zm9yd2FyZCwgaG93ZXZlciB0aGUgZXhp
c3RpbmcgdXNlIG9mCm5vdGlmaWVycyBoZXJlIHNlZW1zIHRvIGJlIHJhY2V5LgoKQ2M6IE1pa2Ug
TWFyY2luaXN6eW4gPG1pa2UubWFyY2luaXN6eW5AaW50ZWwuY29tPgpDYzogRGVubmlzIERhbGVz
c2FuZHJvIDxkZW5uaXMuZGFsZXNzYW5kcm9AaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBKYXNv
biBHdW50aG9ycGUgPGpnZ0BtZWxsYW5veC5jb20+Ci0tLQogZHJpdmVycy9pbmZpbmliYW5kL2h3
L2hmaTEvZmlsZV9vcHMuYyAgICAgfCAgIDIgKy0KIGRyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkx
L2hmaS5oICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS91c2Vy
X2V4cF9yY3YuYyB8IDE0NCArKysrKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2luZmluaWJh
bmQvaHcvaGZpMS91c2VyX2V4cF9yY3YuaCB8ICAgMyArLQogNCBmaWxlcyBjaGFuZ2VkLCA1OCBp
bnNlcnRpb25zKCspLCA5MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2luZmlu
aWJhbmQvaHcvaGZpMS9maWxlX29wcy5jIGIvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hmaTEvZmls
ZV9vcHMuYwppbmRleCBmOWE3ZTlkMjljOGJhMi4uN2M1ZTNmYjIyNDEzOWEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL2ZpbGVfb3BzLmMKKysrIGIvZHJpdmVycy9pbmZp
bmliYW5kL2h3L2hmaTEvZmlsZV9vcHMuYwpAQCAtMTEzOCw3ICsxMTM4LDcgQEAgc3RhdGljIGlu
dCBnZXRfY3R4dF9pbmZvKHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwgdW5zaWduZWQgbG9uZyBh
cmcsIHUzMiBsZW4pCiAJCQlIRkkxX0NBUF9VR0VUX01BU0sodWN0eHQtPmZsYWdzLCBNQVNLKSB8
CiAJCQlIRkkxX0NBUF9LR0VUX01BU0sodWN0eHQtPmZsYWdzLCBLMlUpOwogCS8qIGFkanVzdCBm
bGFnIGlmIHRoaXMgZmQgaXMgbm90IGFibGUgdG8gY2FjaGUgKi8KLQlpZiAoIWZkLT5oYW5kbGVy
KQorCWlmICghZmQtPnVzZV9tbikKIAkJY2luZm8ucnVudGltZV9mbGFncyB8PSBIRkkxX0NBUF9U
SURfVU5NQVA7IC8qIG5vIGNhY2hpbmcgKi8KIAogCWNpbmZvLm51bV9hY3RpdmUgPSBoZmkxX2Nv
dW50X2FjdGl2ZV91bml0cygpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hm
aTEvaGZpLmggYi9kcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS9oZmkuaAppbmRleCBmYTQ1MzUw
YTlhMWQzMi4uZmMxMGQ2NWZjM2UxM2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvaW5maW5pYmFuZC9o
dy9oZmkxL2hmaS5oCisrKyBiL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL2hmaS5oCkBAIC0x
NDQ0LDcgKzE0NDQsNyBAQCBzdHJ1Y3QgaGZpMV9maWxlZGF0YSB7CiAJLyogZm9yIGNwdSBhZmZp
bml0eTsgLTEgaWYgbm9uZSAqLwogCWludCByZWNfY3B1X251bTsKIAl1MzIgdGlkX25fcGlubmVk
OwotCXN0cnVjdCBtbXVfcmJfaGFuZGxlciAqaGFuZGxlcjsKKwlib29sIHVzZV9tbjsKIAlzdHJ1
Y3QgdGlkX3JiX25vZGUgKiplbnRyeV90b19yYjsKIAlzcGlubG9ja190IHRpZF9sb2NrOyAvKiBw
cm90ZWN0IHRpZF9bbGltaXQsdXNlZF0gY291bnRlcnMgKi8KIAl1MzIgdGlkX2xpbWl0OwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hmaTEvdXNlcl9leHBfcmN2LmMgYi9kcml2
ZXJzL2luZmluaWJhbmQvaHcvaGZpMS91c2VyX2V4cF9yY3YuYwppbmRleCAzNTkyYTllYzE1NWU4
NS4uMmFjYTI4YTBiM2NhNDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkx
L3VzZXJfZXhwX3Jjdi5jCisrKyBiL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL3VzZXJfZXhw
X3Jjdi5jCkBAIC01OSwxMSArNTksMTAgQEAgc3RhdGljIGludCBzZXRfcmN2YXJyYXlfZW50cnko
c3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkLAogCQkJICAgICAgc3RydWN0IHRpZF91c2VyX2J1ZiAq
dGJ1ZiwKIAkJCSAgICAgIHUzMiByY3ZlbnRyeSwgc3RydWN0IHRpZF9ncm91cCAqZ3JwLAogCQkJ
ICAgICAgdTE2IHBhZ2VpZHgsIHVuc2lnbmVkIGludCBucGFnZXMpOwotc3RhdGljIGludCB0aWRf
cmJfaW5zZXJ0KHZvaWQgKmFyZywgc3RydWN0IG1tdV9yYl9ub2RlICpub2RlKTsKIHN0YXRpYyB2
b2lkIGNhY2hlbGVzc190aWRfcmJfcmVtb3ZlKHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZGF0YSwK
IAkJCQkgICAgc3RydWN0IHRpZF9yYl9ub2RlICp0bm9kZSk7Ci1zdGF0aWMgdm9pZCB0aWRfcmJf
cmVtb3ZlKHZvaWQgKmFyZywgc3RydWN0IG1tdV9yYl9ub2RlICpub2RlKTsKLXN0YXRpYyBpbnQg
dGlkX3JiX2ludmFsaWRhdGUodm9pZCAqYXJnLCBzdHJ1Y3QgbW11X3JiX25vZGUgKm1ub2RlKTsK
K3N0YXRpYyBib29sIHRpZF9yYl9pbnZhbGlkYXRlKHN0cnVjdCBtbXVfcmFuZ2Vfbm90aWZpZXIg
Km1ybiwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfcmFuZ2UgKnJhbmdlKTsK
IHN0YXRpYyBpbnQgcHJvZ3JhbV9yY3ZhcnJheShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsIHN0
cnVjdCB0aWRfdXNlcl9idWYgKiwKIAkJCSAgICBzdHJ1Y3QgdGlkX2dyb3VwICpncnAsCiAJCQkg
ICAgdW5zaWduZWQgaW50IHN0YXJ0LCB1MTYgY291bnQsCkBAIC03MywxMCArNzIsOCBAQCBzdGF0
aWMgaW50IHVucHJvZ3JhbV9yY3ZhcnJheShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsIHUzMiB0
aWRpbmZvLAogCQkJICAgICAgc3RydWN0IHRpZF9ncm91cCAqKmdycCk7CiBzdGF0aWMgdm9pZCBj
bGVhcl90aWRfbm9kZShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsIHN0cnVjdCB0aWRfcmJfbm9k
ZSAqbm9kZSk7CiAKLXN0YXRpYyBzdHJ1Y3QgbW11X3JiX29wcyB0aWRfcmJfb3BzID0gewotCS5p
bnNlcnQgPSB0aWRfcmJfaW5zZXJ0LAotCS5yZW1vdmUgPSB0aWRfcmJfcmVtb3ZlLAotCS5pbnZh
bGlkYXRlID0gdGlkX3JiX2ludmFsaWRhdGUKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgbW11X3Jhbmdl
X25vdGlmaWVyX29wcyB0aWRfbW5fb3BzID0geworCS5pbnZhbGlkYXRlID0gdGlkX3JiX2ludmFs
aWRhdGUsCiB9OwogCiAvKgpAQCAtODcsNyArODQsNiBAQCBzdGF0aWMgc3RydWN0IG1tdV9yYl9v
cHMgdGlkX3JiX29wcyA9IHsKIGludCBoZmkxX3VzZXJfZXhwX3Jjdl9pbml0KHN0cnVjdCBoZmkx
X2ZpbGVkYXRhICpmZCwKIAkJCSAgIHN0cnVjdCBoZmkxX2N0eHRkYXRhICp1Y3R4dCkKIHsKLQlz
dHJ1Y3QgaGZpMV9kZXZkYXRhICpkZCA9IHVjdHh0LT5kZDsKIAlpbnQgcmV0ID0gMDsKIAogCXNw
aW5fbG9ja19pbml0KCZmZC0+dGlkX2xvY2spOwpAQCAtMTA5LDIwICsxMDUsNyBAQCBpbnQgaGZp
MV91c2VyX2V4cF9yY3ZfaW5pdChzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsCiAJCQlmZC0+ZW50
cnlfdG9fcmIgPSBOVUxMOwogCQkJcmV0dXJuIC1FTk9NRU07CiAJCX0KLQotCQkvKgotCQkgKiBS
ZWdpc3RlciBNTVUgbm90aWZpZXIgY2FsbGJhY2tzLiBJZiB0aGUgcmVnaXN0cmF0aW9uCi0JCSAq
IGZhaWxzLCBjb250aW51ZSB3aXRob3V0IFRJRCBjYWNoaW5nIGZvciB0aGlzIGNvbnRleHQuCi0J
CSAqLwotCQlyZXQgPSBoZmkxX21tdV9yYl9yZWdpc3RlcihmZCwgZmQtPm1tLCAmdGlkX3JiX29w
cywKLQkJCQkJICAgZGQtPnBwb3J0LT5oZmkxX3dxLAotCQkJCQkgICAmZmQtPmhhbmRsZXIpOwot
CQlpZiAocmV0KSB7Ci0JCQlkZF9kZXZfaW5mbyhkZCwKLQkJCQkgICAgIkZhaWxlZCBNTVUgbm90
aWZpZXIgcmVnaXN0cmF0aW9uICVkXG4iLAotCQkJCSAgICByZXQpOwotCQkJcmV0ID0gMDsKLQkJ
fQorCQlmZC0+dXNlX21uID0gdHJ1ZTsKIAl9CiAKIAkvKgpAQCAtMTM5LDcgKzEyMiw3IEBAIGlu
dCBoZmkxX3VzZXJfZXhwX3Jjdl9pbml0KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwKIAkgKiBp
bml0LgogCSAqLwogCXNwaW5fbG9jaygmZmQtPnRpZF9sb2NrKTsKLQlpZiAodWN0eHQtPnN1YmN0
eHRfY250ICYmIGZkLT5oYW5kbGVyKSB7CisJaWYgKHVjdHh0LT5zdWJjdHh0X2NudCAmJiBmZC0+
dXNlX21uKSB7CiAJCXUxNiByZW1haW5kZXI7CiAKIAkJZmQtPnRpZF9saW1pdCA9IHVjdHh0LT5l
eHBlY3RlZF9jb3VudCAvIHVjdHh0LT5zdWJjdHh0X2NudDsKQEAgLTE1OCwxOCArMTQxLDEwIEBA
IHZvaWQgaGZpMV91c2VyX2V4cF9yY3ZfZnJlZShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQpCiB7
CiAJc3RydWN0IGhmaTFfY3R4dGRhdGEgKnVjdHh0ID0gZmQtPnVjdHh0OwogCi0JLyoKLQkgKiBU
aGUgbm90aWZpZXIgd291bGQgaGF2ZSBiZWVuIHJlbW92ZWQgd2hlbiB0aGUgcHJvY2VzcydlcyBt
bQotCSAqIHdhcyBmcmVlZC4KLQkgKi8KLQlpZiAoZmQtPmhhbmRsZXIpIHsKLQkJaGZpMV9tbXVf
cmJfdW5yZWdpc3RlcihmZC0+aGFuZGxlcik7Ci0JfSBlbHNlIHsKLQkJaWYgKCFFWFBfVElEX1NF
VF9FTVBUWSh1Y3R4dC0+dGlkX2Z1bGxfbGlzdCkpCi0JCQl1bmxvY2tfZXhwX3RpZHModWN0eHQs
ICZ1Y3R4dC0+dGlkX2Z1bGxfbGlzdCwgZmQpOwotCQlpZiAoIUVYUF9USURfU0VUX0VNUFRZKHVj
dHh0LT50aWRfdXNlZF9saXN0KSkKLQkJCXVubG9ja19leHBfdGlkcyh1Y3R4dCwgJnVjdHh0LT50
aWRfdXNlZF9saXN0LCBmZCk7Ci0JfQorCWlmICghRVhQX1RJRF9TRVRfRU1QVFkodWN0eHQtPnRp
ZF9mdWxsX2xpc3QpKQorCQl1bmxvY2tfZXhwX3RpZHModWN0eHQsICZ1Y3R4dC0+dGlkX2Z1bGxf
bGlzdCwgZmQpOworCWlmICghRVhQX1RJRF9TRVRfRU1QVFkodWN0eHQtPnRpZF91c2VkX2xpc3Qp
KQorCQl1bmxvY2tfZXhwX3RpZHModWN0eHQsICZ1Y3R4dC0+dGlkX3VzZWRfbGlzdCwgZmQpOwog
CiAJa2ZyZWUoZmQtPmludmFsaWRfdGlkcyk7CiAJZmQtPmludmFsaWRfdGlkcyA9IE5VTEw7CkBA
IC0yMDEsNyArMTc2LDcgQEAgc3RhdGljIHZvaWQgdW5waW5fcmN2X3BhZ2VzKHN0cnVjdCBoZmkx
X2ZpbGVkYXRhICpmZCwKIAogCWlmIChtYXBwZWQpIHsKIAkJcGNpX3VubWFwX3NpbmdsZShkZC0+
cGNpZGV2LCBub2RlLT5kbWFfYWRkciwKLQkJCQkgbm9kZS0+bW11LmxlbiwgUENJX0RNQV9GUk9N
REVWSUNFKTsKKwkJCQkgbm9kZS0+bnBhZ2VzICogUEFHRV9TSVpFLCBQQ0lfRE1BX0ZST01ERVZJ
Q0UpOwogCQlwYWdlcyA9ICZub2RlLT5wYWdlc1tpZHhdOwogCX0gZWxzZSB7CiAJCXBhZ2VzID0g
JnRpZGJ1Zi0+cGFnZXNbaWR4XTsKQEAgLTc3Nyw4ICs3NTIsOCBAQCBzdGF0aWMgaW50IHNldF9y
Y3ZhcnJheV9lbnRyeShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsCiAJCXJldHVybiAtRUZBVUxU
OwogCX0KIAotCW5vZGUtPm1tdS5hZGRyID0gdGJ1Zi0+dmFkZHIgKyAocGFnZWlkeCAqIFBBR0Vf
U0laRSk7Ci0Jbm9kZS0+bW11LmxlbiA9IG5wYWdlcyAqIFBBR0VfU0laRTsKKwlub2RlLT5ub3Rp
Zmllci5vcHMgPSAmdGlkX21uX29wczsKKwlub2RlLT5mZGF0YSA9IGZkOwogCW5vZGUtPnBoeXMg
PSBwYWdlX3RvX3BoeXMocGFnZXNbMF0pOwogCW5vZGUtPm5wYWdlcyA9IG5wYWdlczsKIAlub2Rl
LT5yY3ZlbnRyeSA9IHJjdmVudHJ5OwpAQCAtNzg3LDIzICs3NjIsMzQgQEAgc3RhdGljIGludCBz
ZXRfcmN2YXJyYXlfZW50cnkoc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkLAogCW5vZGUtPmZyZWVk
ID0gZmFsc2U7CiAJbWVtY3B5KG5vZGUtPnBhZ2VzLCBwYWdlcywgc2l6ZW9mKHN0cnVjdCBwYWdl
ICopICogbnBhZ2VzKTsKIAotCWlmICghZmQtPmhhbmRsZXIpCi0JCXJldCA9IHRpZF9yYl9pbnNl
cnQoZmQsICZub2RlLT5tbXUpOwotCWVsc2UKLQkJcmV0ID0gaGZpMV9tbXVfcmJfaW5zZXJ0KGZk
LT5oYW5kbGVyLCAmbm9kZS0+bW11KTsKLQotCWlmIChyZXQpIHsKLQkJaGZpMV9jZGJnKFRJRCwg
IkZhaWxlZCB0byBpbnNlcnQgUkIgbm9kZSAldSAweCVseCwgMHglbHggJWQiLAotCQkJICBub2Rl
LT5yY3ZlbnRyeSwgbm9kZS0+bW11LmFkZHIsIG5vZGUtPnBoeXMsIHJldCk7Ci0JCXBjaV91bm1h
cF9zaW5nbGUoZGQtPnBjaWRldiwgcGh5cywgbnBhZ2VzICogUEFHRV9TSVpFLAotCQkJCSBQQ0lf
RE1BX0ZST01ERVZJQ0UpOwotCQlrZnJlZShub2RlKTsKLQkJcmV0dXJuIC1FRkFVTFQ7CisJaWYg
KGZkLT51c2VfbW4pIHsKKwkJcmV0ID0gbW11X3JhbmdlX25vdGlmaWVyX2luc2VydCgKKwkJCSZu
b2RlLT5ub3RpZmllciwgdGJ1Zi0+dmFkZHIgKyAocGFnZWlkeCAqIFBBR0VfU0laRSksCisJCQlu
cGFnZXMgKiBQQUdFX1NJWkUsIGZkLT5tbSk7CisJCWlmIChyZXQpCisJCQlnb3RvIG91dF91bm1h
cDsKKwkJLyoKKwkJICogRklYTUU6IFRoaXMgaXMgaW4gdGhlIHdyb25nIG9yZGVyLCB0aGUgbm90
aWZpZXIgc2hvdWxkIGJlCisJCSAqIGVzdGFibGlzaGVkIGJlZm9yZSB0aGUgcGFnZXMgYXJlIHBp
bm5lZCBieSBwaW5fcmN2X3BhZ2VzLgorCQkgKi8KKwkJbW11X3JhbmdlX3JlYWRfYmVnaW4oJm5v
ZGUtPm5vdGlmaWVyKTsKIAl9CisJZmQtPmVudHJ5X3RvX3JiW25vZGUtPnJjdmVudHJ5IC0gdWN0
eHQtPmV4cGVjdGVkX2Jhc2VdID0gbm9kZTsKKwogCWhmaTFfcHV0X3RpZChkZCwgcmN2ZW50cnks
IFBUX0VYUEVDVEVELCBwaHlzLCBpbG9nMihucGFnZXMpICsgMSk7CiAJdHJhY2VfaGZpMV9leHBf
dGlkX3JlZyh1Y3R4dC0+Y3R4dCwgZmQtPnN1YmN0eHQsIHJjdmVudHJ5LCBucGFnZXMsCi0JCQkg
ICAgICAgbm9kZS0+bW11LmFkZHIsIG5vZGUtPnBoeXMsIHBoeXMpOworCQkJICAgICAgIG5vZGUt
Pm5vdGlmaWVyLmludGVydmFsX3RyZWUuc3RhcnQsIG5vZGUtPnBoeXMsCisJCQkgICAgICAgcGh5
cyk7CiAJcmV0dXJuIDA7CisKK291dF91bm1hcDoKKwloZmkxX2NkYmcoVElELCAiRmFpbGVkIHRv
IGluc2VydCBSQiBub2RlICV1IDB4JWx4LCAweCVseCAlZCIsCisJCSAgbm9kZS0+cmN2ZW50cnks
IG5vZGUtPm5vdGlmaWVyLmludGVydmFsX3RyZWUuc3RhcnQsCisJCSAgbm9kZS0+cGh5cywgcmV0
KTsKKwlwY2lfdW5tYXBfc2luZ2xlKGRkLT5wY2lkZXYsIHBoeXMsIG5wYWdlcyAqIFBBR0VfU0la
RSwKKwkJCSBQQ0lfRE1BX0ZST01ERVZJQ0UpOworCWtmcmVlKG5vZGUpOworCXJldHVybiAtRUZB
VUxUOwogfQogCiBzdGF0aWMgaW50IHVucHJvZ3JhbV9yY3ZhcnJheShzdHJ1Y3QgaGZpMV9maWxl
ZGF0YSAqZmQsIHUzMiB0aWRpbmZvLApAQCAtODMzLDEwICs4MTksOSBAQCBzdGF0aWMgaW50IHVu
cHJvZ3JhbV9yY3ZhcnJheShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsIHUzMiB0aWRpbmZvLAog
CWlmIChncnApCiAJCSpncnAgPSBub2RlLT5ncnA7CiAKLQlpZiAoIWZkLT5oYW5kbGVyKQotCQlj
YWNoZWxlc3NfdGlkX3JiX3JlbW92ZShmZCwgbm9kZSk7Ci0JZWxzZQotCQloZmkxX21tdV9yYl9y
ZW1vdmUoZmQtPmhhbmRsZXIsICZub2RlLT5tbXUpOworCWlmIChmZC0+dXNlX21uKQorCQltbXVf
cmFuZ2Vfbm90aWZpZXJfcmVtb3ZlKCZub2RlLT5ub3RpZmllcik7CisJY2FjaGVsZXNzX3RpZF9y
Yl9yZW1vdmUoZmQsIG5vZGUpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC04NDcsNyArODMyLDggQEAg
c3RhdGljIHZvaWQgY2xlYXJfdGlkX25vZGUoc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkLCBzdHJ1
Y3QgdGlkX3JiX25vZGUgKm5vZGUpCiAJc3RydWN0IGhmaTFfZGV2ZGF0YSAqZGQgPSB1Y3R4dC0+
ZGQ7CiAKIAl0cmFjZV9oZmkxX2V4cF90aWRfdW5yZWcodWN0eHQtPmN0eHQsIGZkLT5zdWJjdHh0
LCBub2RlLT5yY3ZlbnRyeSwKLQkJCQkgbm9kZS0+bnBhZ2VzLCBub2RlLT5tbXUuYWRkciwgbm9k
ZS0+cGh5cywKKwkJCQkgbm9kZS0+bnBhZ2VzLAorCQkJCSBub2RlLT5ub3RpZmllci5pbnRlcnZh
bF90cmVlLnN0YXJ0LCBub2RlLT5waHlzLAogCQkJCSBub2RlLT5kbWFfYWRkcik7CiAKIAkvKgpA
QCAtODk0LDMwICs4ODAsMjggQEAgc3RhdGljIHZvaWQgdW5sb2NrX2V4cF90aWRzKHN0cnVjdCBo
ZmkxX2N0eHRkYXRhICp1Y3R4dCwKIAkJCQlpZiAoIW5vZGUgfHwgbm9kZS0+cmN2ZW50cnkgIT0g
cmN2ZW50cnkpCiAJCQkJCWNvbnRpbnVlOwogCisJCQkJaWYgKGZkLT51c2VfbW4pCisJCQkJCW1t
dV9yYW5nZV9ub3RpZmllcl9yZW1vdmUoCisJCQkJCQkmbm9kZS0+bm90aWZpZXIpOwogCQkJCWNh
Y2hlbGVzc190aWRfcmJfcmVtb3ZlKGZkLCBub2RlKTsKIAkJCX0KIAkJfQogCX0KIH0KIAotLyoK
LSAqIEFsd2F5cyByZXR1cm4gMCBmcm9tIHRoaXMgZnVuY3Rpb24uICBBIG5vbi16ZXJvIHJldHVy
biBpbmRpY2F0ZXMgdGhhdCB0aGUKLSAqIHJlbW92ZSBvcGVyYXRpb24gd2lsbCBiZSBjYWxsZWQg
YW5kIHRoYXQgbWVtb3J5IHNob3VsZCBiZSB1bnBpbm5lZC4KLSAqIEhvd2V2ZXIsIHRoZSBkcml2
ZXIgY2Fubm90IHVucGluIG91dCBmcm9tIHVuZGVyIFBTTS4gIEluc3RlYWQsIHJldGFpbiB0aGUK
LSAqIG1lbW9yeSAoYnkgcmV0dXJuaW5nIDApIGFuZCBpbmZvcm0gUFNNIHRoYXQgdGhlIG1lbW9y
eSBpcyBnb2luZyBhd2F5LiAgUFNNCi0gKiB3aWxsIGNhbGwgYmFjayBsYXRlciB3aGVuIGl0IGhh
cyByZW1vdmVkIHRoZSBtZW1vcnkgZnJvbSBpdHMgbGlzdC4KLSAqLwotc3RhdGljIGludCB0aWRf
cmJfaW52YWxpZGF0ZSh2b2lkICphcmcsIHN0cnVjdCBtbXVfcmJfbm9kZSAqbW5vZGUpCitzdGF0
aWMgYm9vbCB0aWRfcmJfaW52YWxpZGF0ZShzdHJ1Y3QgbW11X3JhbmdlX25vdGlmaWVyICptcm4s
CisJCQkgICAgICBjb25zdCBzdHJ1Y3QgbW11X25vdGlmaWVyX3JhbmdlICpyYW5nZSkKIHsKLQlz
dHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmRhdGEgPSBhcmc7Ci0Jc3RydWN0IGhmaTFfY3R4dGRhdGEg
KnVjdHh0ID0gZmRhdGEtPnVjdHh0OwogCXN0cnVjdCB0aWRfcmJfbm9kZSAqbm9kZSA9Ci0JCWNv
bnRhaW5lcl9vZihtbm9kZSwgc3RydWN0IHRpZF9yYl9ub2RlLCBtbXUpOworCQljb250YWluZXJf
b2YobXJuLCBzdHJ1Y3QgdGlkX3JiX25vZGUsIG5vdGlmaWVyKTsKKwlzdHJ1Y3QgaGZpMV9maWxl
ZGF0YSAqZmRhdGEgPSBub2RlLT5mZGF0YTsKKwlzdHJ1Y3QgaGZpMV9jdHh0ZGF0YSAqdWN0eHQg
PSBmZGF0YS0+dWN0eHQ7CiAKIAlpZiAobm9kZS0+ZnJlZWQpCi0JCXJldHVybiAwOworCQlyZXR1
cm4gdHJ1ZTsKIAotCXRyYWNlX2hmaTFfZXhwX3RpZF9pbnZhbCh1Y3R4dC0+Y3R4dCwgZmRhdGEt
PnN1YmN0eHQsIG5vZGUtPm1tdS5hZGRyLAorCXRyYWNlX2hmaTFfZXhwX3RpZF9pbnZhbCh1Y3R4
dC0+Y3R4dCwgZmRhdGEtPnN1YmN0eHQsCisJCQkJIG5vZGUtPm5vdGlmaWVyLmludGVydmFsX3Ry
ZWUuc3RhcnQsCiAJCQkJIG5vZGUtPnJjdmVudHJ5LCBub2RlLT5ucGFnZXMsIG5vZGUtPmRtYV9h
ZGRyKTsKIAlub2RlLT5mcmVlZCA9IHRydWU7CiAKQEAgLTk0NiwxOCArOTMwLDcgQEAgc3RhdGlj
IGludCB0aWRfcmJfaW52YWxpZGF0ZSh2b2lkICphcmcsIHN0cnVjdCBtbXVfcmJfbm9kZSAqbW5v
ZGUpCiAJCWZkYXRhLT5pbnZhbGlkX3RpZF9pZHgrKzsKIAl9CiAJc3Bpbl91bmxvY2soJmZkYXRh
LT5pbnZhbGlkX2xvY2spOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHRpZF9yYl9pbnNl
cnQodm9pZCAqYXJnLCBzdHJ1Y3QgbW11X3JiX25vZGUgKm5vZGUpCi17Ci0Jc3RydWN0IGhmaTFf
ZmlsZWRhdGEgKmZkYXRhID0gYXJnOwotCXN0cnVjdCB0aWRfcmJfbm9kZSAqdG5vZGUgPQotCQlj
b250YWluZXJfb2Yobm9kZSwgc3RydWN0IHRpZF9yYl9ub2RlLCBtbXUpOwotCXUzMiBiYXNlID0g
ZmRhdGEtPnVjdHh0LT5leHBlY3RlZF9iYXNlOwotCi0JZmRhdGEtPmVudHJ5X3RvX3JiW3Rub2Rl
LT5yY3ZlbnRyeSAtIGJhc2VdID0gdG5vZGU7Ci0JcmV0dXJuIDA7CisJcmV0dXJuIHRydWU7CiB9
CiAKIHN0YXRpYyB2b2lkIGNhY2hlbGVzc190aWRfcmJfcmVtb3ZlKHN0cnVjdCBoZmkxX2ZpbGVk
YXRhICpmZGF0YSwKQEAgLTk2OCwxMiArOTQxLDMgQEAgc3RhdGljIHZvaWQgY2FjaGVsZXNzX3Rp
ZF9yYl9yZW1vdmUoc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkYXRhLAogCWZkYXRhLT5lbnRyeV90
b19yYlt0bm9kZS0+cmN2ZW50cnkgLSBiYXNlXSA9IE5VTEw7CiAJY2xlYXJfdGlkX25vZGUoZmRh
dGEsIHRub2RlKTsKIH0KLQotc3RhdGljIHZvaWQgdGlkX3JiX3JlbW92ZSh2b2lkICphcmcsIHN0
cnVjdCBtbXVfcmJfbm9kZSAqbm9kZSkKLXsKLQlzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmRhdGEg
PSBhcmc7Ci0Jc3RydWN0IHRpZF9yYl9ub2RlICp0bm9kZSA9Ci0JCWNvbnRhaW5lcl9vZihub2Rl
LCBzdHJ1Y3QgdGlkX3JiX25vZGUsIG1tdSk7Ci0KLQljYWNoZWxlc3NfdGlkX3JiX3JlbW92ZShm
ZGF0YSwgdG5vZGUpOwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hmaTEv
dXNlcl9leHBfcmN2LmggYi9kcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS91c2VyX2V4cF9yY3Yu
aAppbmRleCA0M2IxMDVkZTFkNTQyNy4uYjUzMTRkYjA4M2IxMjUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvaW5maW5pYmFuZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5oCisrKyBiL2RyaXZlcnMvaW5maW5p
YmFuZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5oCkBAIC02NSw3ICs2NSw4IEBAIHN0cnVjdCB0aWRf
dXNlcl9idWYgewogfTsKIAogc3RydWN0IHRpZF9yYl9ub2RlIHsKLQlzdHJ1Y3QgbW11X3JiX25v
ZGUgbW11OworCXN0cnVjdCBtbXVfcmFuZ2Vfbm90aWZpZXIgbm90aWZpZXI7CisJc3RydWN0IGhm
aTFfZmlsZWRhdGEgKmZkYXRhOwogCXVuc2lnbmVkIGxvbmcgcGh5czsKIAlzdHJ1Y3QgdGlkX2dy
b3VwICpncnA7CiAJdTMyIHJjdmVudHJ5OwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
