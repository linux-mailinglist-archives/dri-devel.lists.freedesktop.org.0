Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C825E61606
	for <lists+dri-devel@lfdr.de>; Sun,  7 Jul 2019 20:37:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 235C089BD4;
	Sun,  7 Jul 2019 18:37:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C709789BD4
 for <dri-devel@lists.freedesktop.org>; Sun,  7 Jul 2019 18:37:29 +0000 (UTC)
Received: from pendragon.nordic-sky.finnair.com (unknown [38.98.37.142])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id C1146AF9;
 Sun,  7 Jul 2019 20:37:11 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 48/60] drm/omap: hdmi4: Simplify EDID read
Date: Sun,  7 Jul 2019 21:19:25 +0300
Message-Id: <20190707181937.6250-45-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
References: <20190707180852.5512-1-laurent.pinchart@ideasonboard.com>
 <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1562524648;
 bh=u6N41sFjfIsctsC7ZiADCjqlA1gdMpJOuhZfV8ZMubk=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=c1Nt14vpn6gjCtTFhTaVjhL8fttJVOI/1GtXHGPPSErkH6mm2HlEbScbFr8pwd8Oc
 YhgqhC72aiqPTwPKnE0RE+pOuCkmf8jIooP7loDvKPIiA2soxtDbk811zuIKTZMvoj
 0JgeinIrtu7tOpgHTydT2tl4pLz2OUB3ibBgRTgs=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Tm93IHRoYXQgdGhlIG9tYXBfZHNzX2RldmljZSBFRElEIHJlYWQgb3BlcmF0aW9uIGhhcyBiZWVu
IHJlbW92ZWQsCnNpbXBsaWZ5IHRoZSBicmlkZ2UtYmFzZWQgRURJRCBhY2Nlc3MgYnkgbWVyZ2lu
ZyBtdWx0aXBsZSBmdW5jdGlvbnMKdG9nZXRoZXIuCgpTaWduZWQtb2ZmLWJ5OiBMYXVyZW50IFBp
bmNoYXJ0IDxsYXVyZW50LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL29tYXBkcm0vZHNzL2hkbWk0LmMgfCA5NiArKysrKysrKysrKystLS0tLS0tLS0tLS0t
LS0tLQogMSBmaWxlIGNoYW5nZWQsIDQwIGluc2VydGlvbnMoKyksIDU2IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rzcy9oZG1pNC5jIGIvZHJpdmVy
cy9ncHUvZHJtL29tYXBkcm0vZHNzL2hkbWk0LmMKaW5kZXggNzBkOThmMzliOGM2Li5iOGE1NTJi
MjVmNDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rzcy9oZG1pNC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9vbWFwZHJtL2Rzcy9oZG1pNC5jCkBAIC0zMTksNTUgKzMxOSw2
IEBAIHZvaWQgaGRtaTRfY29yZV9kaXNhYmxlKHN0cnVjdCBoZG1pX2NvcmVfZGF0YSAqY29yZSkK
IAltdXRleF91bmxvY2soJmhkbWktPmxvY2spOwogfQogCi1zdGF0aWMgc3RydWN0IGVkaWQgKgot
aGRtaV9kb19yZWFkX2VkaWQoc3RydWN0IG9tYXBfaGRtaSAqaGRtaSwKLQkJICBzdHJ1Y3QgZWRp
ZCAqKCpyZWFkKShzdHJ1Y3Qgb21hcF9oZG1pICpoZG1pLAotCQkJCSAgICAgICBzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKSwKLQkJICBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yKQotewotCXN0cnVjdCBlZGlkICplZGlkID0gTlVMTDsKLQl1bnNpZ25lZCBpbnQgY2VjX2Fk
ZHI7Ci0JYm9vbCBuZWVkX2VuYWJsZTsKLQlpbnQgcjsKLQotCW5lZWRfZW5hYmxlID0gaGRtaS0+
Y29yZV9lbmFibGVkID09IGZhbHNlOwotCi0JaWYgKG5lZWRfZW5hYmxlKSB7Ci0JCXIgPSBoZG1p
NF9jb3JlX2VuYWJsZSgmaGRtaS0+Y29yZSk7Ci0JCWlmIChyKQotCQkJcmV0dXJuIE5VTEw7Ci0J
fQotCi0JbXV0ZXhfbG9jaygmaGRtaS0+bG9jayk7Ci0JciA9IGhkbWlfcnVudGltZV9nZXQoaGRt
aSk7Ci0JQlVHX09OKHIpOwotCi0JciA9IGhkbWk0X2NvcmVfZGRjX2luaXQoJmhkbWktPmNvcmUp
OwotCWlmIChyKQotCQlnb3RvIGRvbmU7Ci0KLQllZGlkID0gcmVhZChoZG1pLCBjb25uZWN0b3Ip
OwotCi1kb25lOgotCWhkbWlfcnVudGltZV9wdXQoaGRtaSk7Ci0JbXV0ZXhfdW5sb2NrKCZoZG1p
LT5sb2NrKTsKLQotCWlmIChlZGlkICYmIGVkaWQtPmV4dGVuc2lvbnMpIHsKLQkJdW5zaWduZWQg
aW50IGxlbiA9IChlZGlkLT5leHRlbnNpb25zICsgMSkgKiBFRElEX0xFTkdUSDsKLQotCQljZWNf
YWRkciA9IGNlY19nZXRfZWRpZF9waHlzX2FkZHIoKHU4ICopZWRpZCwgbGVuLCBOVUxMKTsKLQl9
IGVsc2UgewotCQljZWNfYWRkciA9IENFQ19QSFlTX0FERFJfSU5WQUxJRDsKLQl9Ci0KLQloZG1p
NF9jZWNfc2V0X3BoeXNfYWRkcigmaGRtaS0+Y29yZSwgY2VjX2FkZHIpOwotCi0JaWYgKG5lZWRf
ZW5hYmxlKQotCQloZG1pNF9jb3JlX2Rpc2FibGUoJmhkbWktPmNvcmUpOwotCi0JcmV0dXJuIGVk
aWQ7Ci19Ci0KIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgKiBEUk0gQnJpZGdlIE9wZXJhdGlv
bnMKICAqLwpAQCAtNDkxLDE4ICs0NDIsNTEgQEAgc3RhdGljIHZvaWQgaGRtaTRfYnJpZGdlX2xv
c3RfaG90cGx1ZyhzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQogCWhkbWk0X2NlY19zZXRfcGh5
c19hZGRyKCZoZG1pLT5jb3JlLCBDRUNfUEhZU19BRERSX0lOVkFMSUQpOwogfQogCi1zdGF0aWMg
c3RydWN0IGVkaWQgKmhkbWk0X2JyaWRnZV9yZWFkX2VkaWQoc3RydWN0IG9tYXBfaGRtaSAqaGRt
aSwKLQkJCQkJICAgc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKLXsKLQlyZXR1cm4g
ZHJtX2RvX2dldF9lZGlkKGNvbm5lY3RvciwgaGRtaTRfY29yZV9kZGNfcmVhZCwgJmhkbWktPmNv
cmUpOwotfQotCiBzdGF0aWMgc3RydWN0IGVkaWQgKmhkbWk0X2JyaWRnZV9nZXRfZWRpZChzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogCQkJCQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IpCiB7CiAJc3RydWN0IG9tYXBfaGRtaSAqaGRtaSA9IGRybV9icmlkZ2VfdG9faGRtaShi
cmlkZ2UpOworCXN0cnVjdCBlZGlkICplZGlkID0gTlVMTDsKKwl1bnNpZ25lZCBpbnQgY2VjX2Fk
ZHI7CisJYm9vbCBuZWVkX2VuYWJsZTsKKwlpbnQgcjsKIAotCXJldHVybiBoZG1pX2RvX3JlYWRf
ZWRpZChoZG1pLCBoZG1pNF9icmlkZ2VfcmVhZF9lZGlkLCBjb25uZWN0b3IpOworCW5lZWRfZW5h
YmxlID0gaGRtaS0+Y29yZV9lbmFibGVkID09IGZhbHNlOworCisJaWYgKG5lZWRfZW5hYmxlKSB7
CisJCXIgPSBoZG1pNF9jb3JlX2VuYWJsZSgmaGRtaS0+Y29yZSk7CisJCWlmIChyKQorCQkJcmV0
dXJuIE5VTEw7CisJfQorCisJbXV0ZXhfbG9jaygmaGRtaS0+bG9jayk7CisJciA9IGhkbWlfcnVu
dGltZV9nZXQoaGRtaSk7CisJQlVHX09OKHIpOworCisJciA9IGhkbWk0X2NvcmVfZGRjX2luaXQo
JmhkbWktPmNvcmUpOworCWlmIChyKQorCQlnb3RvIGRvbmU7CisKKwllZGlkID0gZHJtX2RvX2dl
dF9lZGlkKGNvbm5lY3RvciwgaGRtaTRfY29yZV9kZGNfcmVhZCwgJmhkbWktPmNvcmUpOworCitk
b25lOgorCWhkbWlfcnVudGltZV9wdXQoaGRtaSk7CisJbXV0ZXhfdW5sb2NrKCZoZG1pLT5sb2Nr
KTsKKworCWlmIChlZGlkICYmIGVkaWQtPmV4dGVuc2lvbnMpIHsKKwkJdW5zaWduZWQgaW50IGxl
biA9IChlZGlkLT5leHRlbnNpb25zICsgMSkgKiBFRElEX0xFTkdUSDsKKworCQljZWNfYWRkciA9
IGNlY19nZXRfZWRpZF9waHlzX2FkZHIoKHU4ICopZWRpZCwgbGVuLCBOVUxMKTsKKwl9IGVsc2Ug
eworCQljZWNfYWRkciA9IENFQ19QSFlTX0FERFJfSU5WQUxJRDsKKwl9CisKKwloZG1pNF9jZWNf
c2V0X3BoeXNfYWRkcigmaGRtaS0+Y29yZSwgY2VjX2FkZHIpOworCisJaWYgKG5lZWRfZW5hYmxl
KQorCQloZG1pNF9jb3JlX2Rpc2FibGUoJmhkbWktPmNvcmUpOworCisJcmV0dXJuIGVkaWQ7CiB9
CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyBoZG1pNF9icmlkZ2VfZnVu
Y3MgPSB7Ci0tIApSZWdhcmRzLAoKTGF1cmVudCBQaW5jaGFydAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
