Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D110E16229
	for <lists+dri-devel@lfdr.de>; Tue,  7 May 2019 12:53:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0FBF56E795;
	Tue,  7 May 2019 10:53:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM02-CY1-obe.outbound.protection.outlook.com
 (mail-eopbgr760083.outbound.protection.outlook.com [40.107.76.83])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8308D6E795;
 Tue,  7 May 2019 10:53:34 +0000 (UTC)
Received: from DM5PR12MB1546.namprd12.prod.outlook.com (10.172.36.23) by
 DM5PR12MB1417.namprd12.prod.outlook.com (10.168.236.147) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.1856.10; Tue, 7 May 2019 10:53:29 +0000
Received: from DM5PR12MB1546.namprd12.prod.outlook.com
 ([fe80::70fc:f26c:1e22:73ba]) by DM5PR12MB1546.namprd12.prod.outlook.com
 ([fe80::70fc:f26c:1e22:73ba%10]) with mapi id 15.20.1856.012; Tue, 7 May 2019
 10:53:29 +0000
From: "Koenig, Christian" <Christian.Koenig@amd.com>
To: "Zhou, David(ChunMing)" <David1.Zhou@amd.com>, "Liang, Prike"
 <Prike.Liang@amd.com>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "amd-gfx@lists.freedesktop.org"
 <amd-gfx@lists.freedesktop.org>
Subject: Re: [PATCH 1/2] drm/ttm: fix busy memory to fail other user v6
Thread-Topic: [PATCH 1/2] drm/ttm: fix busy memory to fail other user v6
Thread-Index: AQHVBLhzEpGLJ43PNEqgNfgyqPuuKaZffLwA
Date: Tue, 7 May 2019 10:53:29 +0000
Message-ID: <f4b1ddf2-b80b-260e-54c9-b0e62ecbe90b@amd.com>
References: <20190507093642.7859-1-david1.zhou@amd.com>
In-Reply-To: <20190507093642.7859-1-david1.zhou@amd.com>
Accept-Language: de-DE, en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
user-agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.6.1
x-originating-ip: [2a02:908:1252:fb60:be8a:bd56:1f94:86e7]
x-clientproxiedby: AM0PR02CA0093.eurprd02.prod.outlook.com
 (2603:10a6:208:154::34) To DM5PR12MB1546.namprd12.prod.outlook.com
 (2603:10b6:4:8::23)
x-ms-exchange-messagesentrepresentingtype: 1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 8fa64486-bf5b-4385-da75-08d6d2da3d53
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600141)(711020)(4605104)(4618075)(2017052603328)(7193020);
 SRVR:DM5PR12MB1417; 
x-ms-traffictypediagnostic: DM5PR12MB1417:
x-microsoft-antispam-prvs: <DM5PR12MB141718591F144D1BD71DFB2083310@DM5PR12MB1417.namprd12.prod.outlook.com>
x-ms-oob-tlc-oobclassifiers: OLM:9508;
x-forefront-prvs: 0030839EEE
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(136003)(346002)(39860400002)(366004)(376002)(396003)(189003)(199004)(65826007)(14444005)(256004)(229853002)(2201001)(65806001)(6486002)(65956001)(486006)(305945005)(6436002)(2616005)(76176011)(7736002)(476003)(36756003)(71200400001)(446003)(6246003)(6512007)(102836004)(99286004)(64126003)(53936002)(52116002)(186003)(31686004)(25786009)(58126008)(46003)(450100002)(110136005)(386003)(6506007)(316002)(2906002)(6116002)(72206003)(5660300002)(478600001)(71190400001)(8676002)(81166006)(81156014)(11346002)(14454004)(31696002)(86362001)(66446008)(64756008)(66556008)(66476007)(66946007)(73956011)(2501003)(8936002)(68736007);
 DIR:OUT; SFP:1101; SCL:1; SRVR:DM5PR12MB1417;
 H:DM5PR12MB1546.namprd12.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: VDlKIvhLoTMcWZCspxdFQLXM+LwJDdRr3ldc38V4ah7Z5WsQyV/epSyF5h6OsABLcTpaPC4j+brHKlHSCz+pB//iaDtfWuyOdJuqL18Eo+1gO8N5gnaYr4oNpH+5kjqQefLhb00GDzASfLc2DWVRqaOlH3dXqCrQ7dKcbZkJsYwjcZcU31fRuJHQxPDtT0GmK9mvQ1Q5R7lYb/2/A1WHIA6r4Dwgg3U+mfrHXUaointWneYJR0N3JdmPgMHDgasm82rwbWTLvMHMm7T8KQ4A3hDvDxfY4KP8B+KyRwejiWrRtx/VcUbQXjZ/iXehIb0blNbVKvOrPQtwzy3Wjt+qzOmmj7u4K83jvZrZwexv6cHBa8wliZ2yZL8a5+dlLlRFfSV8APJ3mS3jOUaxdBZE7/I9Rh2rlKTA/39F0Su73ts=
Content-ID: <9F2AC957E19F2A42A865C07B590B99F5@namprd12.prod.outlook.com>
MIME-Version: 1.0
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 8fa64486-bf5b-4385-da75-08d6d2da3d53
X-MS-Exchange-CrossTenant-originalarrivaltime: 07 May 2019 10:53:29.7586 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM5PR12MB1417
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amd-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=F2u2I/NFTsu9I/NtOYYonn/8MDAqMPgGwN02HqHMc4g=;
 b=iXCOVNsut3bnXTNI+PfA5S0bbQFTnD6mo4EVufmk76jszJCDPyYjpVSUXfLoo+778VMTYH/QzZ52cIqHa+t1n5il/024lOAvHKQtV8AJGW88qdGn3Lydf1j/k6oBZfXiEkcqA7mKLipfdZFRO7YTfshIA2G+3VDTNC2U/IOPk2o=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=Christian.Koenig@amd.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QW0gMDcuMDUuMTkgdW0gMTE6MzYgc2NocmllYiBDaHVubWluZyBaaG91Og0KPiBoZWF2eSBncHUg
am9iIGNvdWxkIG9jY3VweSBtZW1vcnkgbG9uZyB0aW1lLCB3aGljaCBsZWFkIG90aGVyIHVzZXIg
ZmFpbCB0byBnZXQgbWVtb3J5Lg0KPg0KPiBiYXNpY2FsbHkgcGljayB1cCBDaHJpc3RpYW4gaWRl
YToNCj4NCj4gMS4gUmVzZXJ2ZSB0aGUgQk8gaW4gREMgdXNpbmcgYSB3d19tdXRleCB0aWNrZXQg
KHRyaXZpYWwpLg0KPiAyLiBJZiB3ZSB0aGVuIHJ1biBpbnRvIHRoaXMgRUJVU1kgY29uZGl0aW9u
IGluIFRUTSBjaGVjayBpZiB0aGUgQk8gd2UgbmVlZCBtZW1vcnkgZm9yIChvciByYXRoZXIgdGhl
IHd3X211dGV4IG9mIGl0cyByZXNlcnZhdGlvbiBvYmplY3QpIGhhcyBhIHRpY2tldCBhc3NpZ25l
ZC4NCj4gMy4gSWYgd2UgaGF2ZSBhIHRpY2tldCB3ZSBncmFiIGEgcmVmZXJlbmNlIHRvIHRoZSBm
aXJzdCBCTyBvbiB0aGUgTFJVLCBkcm9wIHRoZSBMUlUgbG9jayBhbmQgdHJ5IHRvIGdyYWIgdGhl
IHJlc2VydmF0aW9uIGxvY2sgd2l0aCB0aGUgdGlja2V0Lg0KPiA0LiBJZiBnZXR0aW5nIHRoZSBy
ZXNlcnZhdGlvbiBsb2NrIHdpdGggdGhlIHRpY2tldCBzdWNjZWVkZWQgd2UgY2hlY2sgaWYgdGhl
IEJPIGlzIHN0aWxsIHRoZSBmaXJzdCBvbmUgb24gdGhlIExSVSBpbiBxdWVzdGlvbiAodGhlIEJP
IGNvdWxkIGhhdmUgbW92ZWQpLg0KPiA1LiBJZiB0aGUgQk8gaXMgc3RpbGwgdGhlIGZpcnN0IG9u
ZSBvbiB0aGUgTFJVIGluIHF1ZXN0aW9uIHdlIHRyeSB0byBldmljdCBpdCBhcyB3ZSB3b3VsZCBl
dmljdCBhbnkgb3RoZXIgQk8uDQo+IDYuIElmIGFueSBvZiB0aGUgIklmJ3MiIGFib3ZlIGZhaWwg
d2UganVzdCBiYWNrIG9mZiBhbmQgcmV0dXJuIC1FQlVTWS4NCj4NCj4gdjI6IGZpeCBzb21lIG1p
bm9yIGNoZWNrDQo+IHYzOiBhZGRyZXNzIENocmlzdGlhbiB2MiBjb21tZW50cy4NCj4gdjQ6IGZp
eCBzb21lIG1pc3NpbmcNCj4gdjU6IGhhbmRsZSBmaXJzdF9ibyB1bmxvY2sgYW5kIGJvX2dldC9w
dXQNCj4gdjY6IGFic3RyYWN0IHVuaWZpZWQgaXRlcmF0ZSBmdW5jdGlvbiwgYW5kIGhhbmRsZSBh
bGwgcG9zc2libGUgdXNlY2FzZSBub3Qgb25seSBwaW5uZWQgYm8uDQo+DQo+IENoYW5nZS1JZDog
STIxNDIzZmI5MjJmODg1NDY1ZjEzODMzYzQxZGYxZTEzNDM2NGE4ZTcNCj4gU2lnbmVkLW9mZi1i
eTogQ2h1bm1pbmcgWmhvdSA8ZGF2aWQxLnpob3VAYW1kLmNvbT4NCj4gLS0tDQo+ICAgZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fYm8uYyB8IDExMyArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KystLS0tLQ0KPiAgIDEgZmlsZSBjaGFuZ2VkLCA5NyBpbnNlcnRpb25zKCspLCAxNiBkZWxldGlv
bnMoLSkNCj4NCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMgYi9k
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jDQo+IGluZGV4IDg1MDJiM2VkMmQ4OC4uYmJmMWQx
NGQwMGE3IDEwMDY0NA0KPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jDQo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMNCj4gQEAgLTc2NiwxMSArNzY2LDEzIEBA
IEVYUE9SVF9TWU1CT0wodHRtX2JvX2V2aWN0aW9uX3ZhbHVhYmxlKTsNCj4gICAgKiBiLiBPdGhl
cndpc2UsIHRyeWxvY2sgaXQuDQo+ICAgICovDQo+ICAgc3RhdGljIGJvb2wgdHRtX2JvX2V2aWN0
X3N3YXBvdXRfYWxsb3dhYmxlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sDQo+IC0JCQlz
dHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwgYm9vbCAqbG9ja2VkKQ0KPiArCQkJc3RydWN0
IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgsIGJvb2wgKmxvY2tlZCwgYm9vbCAqYnVzeSkNCj4gICB7
DQo+ICAgCWJvb2wgcmV0ID0gZmFsc2U7DQo+ICAgDQo+ICAgCSpsb2NrZWQgPSBmYWxzZTsNCj4g
KwlpZiAoYnVzeSkNCj4gKwkJKmJ1c3kgPSBmYWxzZTsNCj4gICAJaWYgKGJvLT5yZXN2ID09IGN0
eC0+cmVzdikgew0KPiAgIAkJcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGJvLT5yZXN2
KTsNCj4gICAJCWlmIChjdHgtPmZsYWdzICYgVFRNX09QVF9GTEFHX0FMTE9XX1JFU19FVklDVA0K
PiBAQCAtNzc5LDM1ICs3ODEsNDUgQEAgc3RhdGljIGJvb2wgdHRtX2JvX2V2aWN0X3N3YXBvdXRf
YWxsb3dhYmxlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sDQo+ICAgCX0gZWxzZSB7DQo+
ICAgCQkqbG9ja2VkID0gcmVzZXJ2YXRpb25fb2JqZWN0X3RyeWxvY2soYm8tPnJlc3YpOw0KPiAg
IAkJcmV0ID0gKmxvY2tlZDsNCj4gKwkJaWYgKCFyZXQgJiYgYnVzeSkNCj4gKwkJCSpidXN5ID0g
dHJ1ZTsNCj4gICAJfQ0KPiAgIA0KPiAgIAlyZXR1cm4gcmV0Ow0KPiAgIH0NCj4gICANCj4gLXN0
YXRpYyBpbnQgdHRtX21lbV9ldmljdF9maXJzdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwN
Cj4gLQkJCSAgICAgICB1aW50MzJfdCBtZW1fdHlwZSwNCj4gLQkJCSAgICAgICBjb25zdCBzdHJ1
Y3QgdHRtX3BsYWNlICpwbGFjZSwNCj4gLQkJCSAgICAgICBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9j
dHggKmN0eCkNCj4gK3N0YXRpYyBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QqDQo+ICt0dG1fbWVt
X2ZpbmRfZXZpdGFibGVfYm8oc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsDQo+ICsJCQkgc3Ry
dWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4sDQo+ICsJCQkgY29uc3Qgc3RydWN0IHR0bV9w
bGFjZSAqcGxhY2UsDQo+ICsJCQkgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgsDQo+ICsJ
CQkgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICoqZmlyc3RfYm8sDQo+ICsJCQkgYm9vbCAqbG9j
a2VkKQ0KPiAgIHsNCj4gLQlzdHJ1Y3QgdHRtX2JvX2dsb2JhbCAqZ2xvYiA9IGJkZXYtPmdsb2I7
DQo+IC0Jc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW21lbV90
eXBlXTsNCj4gICAJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyA9IE5VTEw7DQo+IC0JYm9v
bCBsb2NrZWQgPSBmYWxzZTsNCj4gLQl1bnNpZ25lZCBpOw0KPiAtCWludCByZXQ7DQo+ICsJaW50
IGk7DQo+ICAgDQo+IC0Jc3Bpbl9sb2NrKCZnbG9iLT5scnVfbG9jayk7DQo+ICsJaWYgKGZpcnN0
X2JvKQ0KPiArCQkqZmlyc3RfYm8gPSBOVUxMOw0KPiAgIAlmb3IgKGkgPSAwOyBpIDwgVFRNX01B
WF9CT19QUklPUklUWTsgKytpKSB7DQo+ICAgCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGJvLCAmbWFu
LT5scnVbaV0sIGxydSkgew0KPiAtCQkJaWYgKCF0dG1fYm9fZXZpY3Rfc3dhcG91dF9hbGxvd2Fi
bGUoYm8sIGN0eCwgJmxvY2tlZCkpDQo+ICsJCQlib29sIGJ1c3kgPSBmYWxzZTsNCj4gKwkJCWlm
ICghdHRtX2JvX2V2aWN0X3N3YXBvdXRfYWxsb3dhYmxlKGJvLCBjdHgsIGxvY2tlZCwNCj4gKwkJ
CQkJCQkgICAgJmJ1c3kpKSB7DQoNCkEgbmV3bGluZSBiZXR3ZWVuIGRlY2xhcmF0aW9uIGFuZCBj
b2RlIHBsZWFzZS4NCg0KPiArCQkJCWlmIChmaXJzdF9ibyAmJiAhKCpmaXJzdF9ibykgJiYgYnVz
eSkgew0KPiArCQkJCQl0dG1fYm9fZ2V0KGJvKTsNCj4gKwkJCQkJKmZpcnN0X2JvID0gYm87DQo+
ICsJCQkJfQ0KPiAgIAkJCQljb250aW51ZTsNCj4gKwkJCX0NCj4gICANCj4gICAJCQlpZiAocGxh
Y2UgJiYgIWJkZXYtPmRyaXZlci0+ZXZpY3Rpb25fdmFsdWFibGUoYm8sDQo+ICAgCQkJCQkJCQkg
ICAgICBwbGFjZSkpIHsNCj4gLQkJCQlpZiAobG9ja2VkKQ0KPiArCQkJCWlmICgqbG9ja2VkKQ0K
PiAgIAkJCQkJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jayhiby0+cmVzdik7DQo+ICAgCQkJCWNv
bnRpbnVlOw0KPiAgIAkJCX0NCj4gKw0KPiAgIAkJCWJyZWFrOw0KPiAgIAkJfQ0KPiAgIA0KPiBA
QCAtODE4LDkgKzgzMCw2NiBAQCBzdGF0aWMgaW50IHR0bV9tZW1fZXZpY3RfZmlyc3Qoc3RydWN0
IHR0bV9ib19kZXZpY2UgKmJkZXYsDQo+ICAgCQlibyA9IE5VTEw7DQo+ICAgCX0NCj4gICANCj4g
KwlyZXR1cm4gYm87DQo+ICt9DQo+ICsNCj4gK3N0YXRpYyBpbnQgdHRtX21lbV9ldmljdF9maXJz
dChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwNCj4gKwkJCSAgICAgICB1aW50MzJfdCBtZW1f
dHlwZSwNCj4gKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSwNCj4gKwkJ
CSAgICAgICBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCkNCj4gK3sNCj4gKwlzdHJ1Y3Qg
dHRtX2JvX2dsb2JhbCAqZ2xvYiA9IGJkZXYtPmdsb2I7DQo+ICsJc3RydWN0IHR0bV9tZW1fdHlw
ZV9tYW5hZ2VyICptYW4gPSAmYmRldi0+bWFuW21lbV90eXBlXTsNCj4gKwlzdHJ1Y3QgdHRtX2J1
ZmZlcl9vYmplY3QgKmJvID0gTlVMTCwgKmZpcnN0X2JvID0gTlVMTDsNCj4gKwlib29sIGxvY2tl
ZCA9IGZhbHNlOw0KPiArCWludCByZXQ7DQo+ICsNCj4gKwlzcGluX2xvY2soJmdsb2ItPmxydV9s
b2NrKTsNCj4gKwlibyA9IHR0bV9tZW1fZmluZF9ldml0YWJsZV9ibyhiZGV2LCBtYW4sIHBsYWNl
LCBjdHgsICZmaXJzdF9ibywNCj4gKwkJCQkgICAgICAmbG9ja2VkKTsNCj4gICAJaWYgKCFibykg
ew0KPiArCQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggYnVzeV9jdHg7DQo+ICsNCj4gICAJCXNw
aW5fdW5sb2NrKCZnbG9iLT5scnVfbG9jayk7DQo+IC0JCXJldHVybiAtRUJVU1k7DQo+ICsJCS8q
IGNoZWNrIGlmIG90aGVyIHVzZXIgb2NjdXB5IG1lbW9yeSB0b28gbG9uZyB0aW1lICovDQo+ICsJ
CWlmICghZmlyc3RfYm8gfHwgIWN0eCB8fCAhY3R4LT5yZXN2IHx8ICFjdHgtPnJlc3YtPmxvY2su
Y3R4KSB7DQo+ICsJCQlpZiAoZmlyc3RfYm8pDQo+ICsJCQkJdHRtX2JvX3B1dChmaXJzdF9ibyk7
DQo+ICsJCQlyZXR1cm4gLUVCVVNZOw0KPiArCQl9DQo+ICsJCWlmIChmaXJzdF9iby0+cmVzdiA9
PSBjdHgtPnJlc3YpIHsNCj4gKwkJCXR0bV9ib19wdXQoZmlyc3RfYm8pOw0KPiArCQkJcmV0dXJu
IC1FQlVTWTsNCj4gKwkJfQ0KPiArCQlpZiAoY3R4LT5pbnRlcnJ1cHRpYmxlKQ0KPiArCQkJcmV0
ID0gd3dfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZmaXJzdF9iby0+cmVzdi0+bG9jaywNCj4g
KwkJCQkJCQkgIGN0eC0+cmVzdi0+bG9jay5jdHgpOw0KPiArCQllbHNlDQo+ICsJCQlyZXQgPSB3
d19tdXRleF9sb2NrKCZmaXJzdF9iby0+cmVzdi0+bG9jaywgY3R4LT5yZXN2LT5sb2NrLmN0eCk7
DQo+ICsJCWlmIChyZXQpIHsNCj4gKwkJCXR0bV9ib19wdXQoZmlyc3RfYm8pOw0KPiArCQkJcmV0
dXJuIHJldDsNCj4gKwkJfQ0KPiArCQlzcGluX2xvY2soJmdsb2ItPmxydV9sb2NrKTsNCj4gKwkJ
LyogcHJldmlvdXMgYnVzeSByZXN2IGxvY2sgaXMgaGVsZCBieSBhYm92ZSwgaWRsZSBub3csDQo+
ICsJCSAqIHNvIGxldCB0aGVtIGV2aWN0YWJsZS4NCj4gKwkJICovDQo+ICsJCWJ1c3lfY3R4Lmlu
dGVycnVwdGlibGUgPSBjdHgtPmludGVycnVwdGlibGU7DQo+ICsJCWJ1c3lfY3R4Lm5vX3dhaXRf
Z3B1ICAgPSBjdHgtPm5vX3dhaXRfZ3B1Ow0KPiArCQlidXN5X2N0eC5yZXN2CSAgICAgICA9IGZp
cnN0X2JvLT5yZXN2Ow0KPiArCQlidXN5X2N0eC5mbGFncwkgICAgICAgPSBUVE1fT1BUX0ZMQUdf
QUxMT1dfUkVTX0VWSUNUOw0KPiArDQo+ICsJCWJvID0gdHRtX21lbV9maW5kX2V2aXRhYmxlX2Jv
KGJkZXYsIG1hbiwgcGxhY2UsICZidXN5X2N0eCwgTlVMTCwNCj4gKwkJCQkJICAgICAgJmxvY2tl
ZCk7DQo+ICsJCWlmIChibyAmJiAoYm8tPnJlc3YgPT0gZmlyc3RfYm8tPnJlc3YpKQ0KPiArCQkJ
bG9ja2VkID0gdHJ1ZTsNCj4gKwkJZWxzZSBpZiAoYm8pDQo+ICsJCQl3d19tdXRleF91bmxvY2so
JmZpcnN0X2JvLT5yZXN2LT5sb2NrKTsNCj4gKwkJaWYgKCFibykgew0KPiArCQkJc3Bpbl91bmxv
Y2soJmdsb2ItPmxydV9sb2NrKTsNCj4gKwkJCXR0bV9ib19wdXQoZmlyc3RfYm8pOw0KPiArCQkJ
cmV0dXJuIC1FQlVTWTsNCj4gKwkJfQ0KPiAgIAl9DQo+ICAgDQo+ICAgCWtyZWZfZ2V0KCZiby0+
bGlzdF9rcmVmKTsNCj4gQEAgLTgyOSwxMSArODk4LDE1IEBAIHN0YXRpYyBpbnQgdHRtX21lbV9l
dmljdF9maXJzdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwNCj4gICAJCXJldCA9IHR0bV9i
b19jbGVhbnVwX3JlZnMoYm8sIGN0eC0+aW50ZXJydXB0aWJsZSwNCj4gICAJCQkJCSAgY3R4LT5u
b193YWl0X2dwdSwgbG9ja2VkKTsNCj4gICAJCWtyZWZfcHV0KCZiby0+bGlzdF9rcmVmLCB0dG1f
Ym9fcmVsZWFzZV9saXN0KTsNCj4gKwkJaWYgKGZpcnN0X2JvKQ0KPiArCQkJdHRtX2JvX3B1dChm
aXJzdF9ibyk7DQo+ICAgCQlyZXR1cm4gcmV0Ow0KPiAgIAl9DQo+ICAgDQo+ICAgCXR0bV9ib19k
ZWxfZnJvbV9scnUoYm8pOw0KPiAgIAlzcGluX3VubG9jaygmZ2xvYi0+bHJ1X2xvY2spOw0KPiAr
CWlmIChmaXJzdF9ibykNCj4gKwkJdHRtX2JvX3B1dChmaXJzdF9ibyk7DQo+ICAgDQo+ICAgCXJl
dCA9IHR0bV9ib19ldmljdChibywgY3R4KTsNCj4gICAJaWYgKGxvY2tlZCkgew0KPiBAQCAtODk5
LDYgKzk3MiwxMyBAQCBzdGF0aWMgaW50IHR0bV9ib19tZW1fZm9yY2Vfc3BhY2Uoc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0ICpibywNCj4gICB7DQo+ICAgCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpi
ZGV2ID0gYm8tPmJkZXY7DQo+ICAgCXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuID0g
JmJkZXYtPm1hblttZW1fdHlwZV07DQo+ICsJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IG5hdGl2
ZV9jdHggPSB7DQo+ICsJCS5pbnRlcnJ1cHRpYmxlID0gZmFsc2UsDQo+ICsJCS5ub193YWl0X2dw
dSA9IGZhbHNlLA0KPiArCQkucmVzdiA9IGJvLT5yZXN2LA0KPiArCQkuZmxhZ3MgPSAwDQo+ICsJ
fTsNCj4gKwlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmV2aWN0X2N0eCA9IGN0eCA/IGN0eCA6
ICZuYXRpdmVfY3R4Ow0KDQpJIHRob3VnaHQgd2UgbWFkZSB0aGUgY3R4IHBhcmFtZXRlciBtYW5k
YXRvcnksIGRpZG4ndCB3ZT8gQ291bGQgYmUgdGhhdCANCkkgcmVtZW1iZXIgdGhhdCBpbmNvcnJl
Y3RseS4NCg0KQ2hyaXN0aWFuLg0KDQo+ICAgCWludCByZXQ7DQo+ICAgDQo+ICAgCWRvIHsNCj4g
QEAgLTkwNyw3ICs5ODcsNyBAQCBzdGF0aWMgaW50IHR0bV9ib19tZW1fZm9yY2Vfc3BhY2Uoc3Ry
dWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywNCj4gICAJCQlyZXR1cm4gcmV0Ow0KPiAgIAkJaWYg
KG1lbS0+bW1fbm9kZSkNCj4gICAJCQlicmVhazsNCj4gLQkJcmV0ID0gdHRtX21lbV9ldmljdF9m
aXJzdChiZGV2LCBtZW1fdHlwZSwgcGxhY2UsIGN0eCk7DQo+ICsJCXJldCA9IHR0bV9tZW1fZXZp
Y3RfZmlyc3QoYmRldiwgbWVtX3R5cGUsIHBsYWNlLCBldmljdF9jdHgpOw0KPiAgIAkJaWYgKHVu
bGlrZWx5KHJldCAhPSAwKSkNCj4gICAJCQlyZXR1cm4gcmV0Ow0KPiAgIAl9IHdoaWxlICgxKTsN
Cj4gQEAgLTE3ODQsNyArMTg2NCw4IEBAIGludCB0dG1fYm9fc3dhcG91dChzdHJ1Y3QgdHRtX2Jv
X2dsb2JhbCAqZ2xvYiwgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpDQo+ICAgCXNwaW5f
bG9jaygmZ2xvYi0+bHJ1X2xvY2spOw0KPiAgIAlmb3IgKGkgPSAwOyBpIDwgVFRNX01BWF9CT19Q
UklPUklUWTsgKytpKSB7DQo+ICAgCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGJvLCAmZ2xvYi0+c3dh
cF9scnVbaV0sIHN3YXApIHsNCj4gLQkJCWlmICh0dG1fYm9fZXZpY3Rfc3dhcG91dF9hbGxvd2Fi
bGUoYm8sIGN0eCwgJmxvY2tlZCkpIHsNCj4gKwkJCWlmICh0dG1fYm9fZXZpY3Rfc3dhcG91dF9h
bGxvd2FibGUoYm8sIGN0eCwgJmxvY2tlZCwNCj4gKwkJCQkJCQkgICBOVUxMKSkgew0KPiAgIAkJ
CQlyZXQgPSAwOw0KPiAgIAkJCQlicmVhazsNCj4gICAJCQl9DQoNCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
