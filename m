Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9AA5A1292AE
	for <lists+dri-devel@lfdr.de>; Mon, 23 Dec 2019 09:11:29 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8EF1C6E1E5;
	Mon, 23 Dec 2019 08:10:50 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.siol.net (mailoutvs31.siol.net [185.57.226.222])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A8EB489904
 for <dri-devel@lists.freedesktop.org>; Thu, 19 Dec 2019 21:59:59 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by mail.siol.net (Postfix) with ESMTP id 259DD523987;
 Thu, 19 Dec 2019 22:53:20 +0100 (CET)
X-Virus-Scanned: amavisd-new at psrvmta10.zcs-production.pri
Received: from mail.siol.net ([127.0.0.1])
 by localhost (psrvmta10.zcs-production.pri [127.0.0.1]) (amavisd-new,
 port 10032)
 with ESMTP id bHu1hfrIcIdL; Thu, 19 Dec 2019 22:53:19 +0100 (CET)
Received: from mail.siol.net (localhost [127.0.0.1])
 by mail.siol.net (Postfix) with ESMTPS id 4943B5239CE;
 Thu, 19 Dec 2019 22:53:19 +0100 (CET)
Received: from jernej-laptop.localnet (cpe-86-58-102-7.static.triera.net
 [86.58.102.7]) (Authenticated sender: jernej.skrabec@siol.net)
 by mail.siol.net (Postfix) with ESMTPA id B48D4523987;
 Thu, 19 Dec 2019 22:53:18 +0100 (CET)
From: Jernej =?utf-8?B?xaBrcmFiZWM=?= <jernej.skrabec@siol.net>
To: Neil Armstrong <narmstrong@baylibre.com>
Subject: Re: [PATCH v5 2/4] drm/bridge: Patch atomic hooks to take a
 drm_bridge_state
Date: Thu, 19 Dec 2019 22:53:18 +0100
Message-ID: <121292462.iSFXEu5GbM@jernej-laptop>
In-Reply-To: <20191219101151.28039-3-narmstrong@baylibre.com>
References: <20191219101151.28039-1-narmstrong@baylibre.com>
 <20191219101151.28039-3-narmstrong@baylibre.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 23 Dec 2019 08:10:46 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 devicetree@vger.kernel.org, Andrey Smirnov <andrew.smirnov@gmail.com>,
 Jonas Karlman <jonas@kwiboo.se>, Seung-Woo Kim <sw0312.kim@samsung.com>,
 dri-devel@lists.freedesktop.org, Rob Herring <robh+dt@kernel.org>,
 Kyungmin Park <kyungmin.park@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>, Chris Healy <cphealy@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SGkhCgpEbmUgxI1ldHJ0ZWssIDE5LiBkZWNlbWJlciAyMDE5IG9iIDExOjExOjQ5IENFVCBqZSBO
ZWlsIEFybXN0cm9uZyBuYXBpc2FsKGEpOgo+IEZyb206IEJvcmlzIEJyZXppbGxvbiA8Ym9yaXMu
YnJlemlsbG9uQGNvbGxhYm9yYS5jb20+Cj4gCj4gVGhpcyB3YXkgdGhlIGRybV9icmlkZ2VfZnVu
Y3MgaW50ZXJmYWNlIGlzIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZgo+IHRoZSBzdWJzeXN0
ZW0uCj4gCj4gVGhlIG9ubHkgZHJpdmVyIGltcGxlbWVudGluZyB0aG9zZSBob29rcyAoYW5hbG9n
aXggRFApIGlzIHBhdGNoZWQgdG9vLgo+IAo+IFNpZ25lZC1vZmYtYnk6IEJvcmlzIEJyZXppbGxv
biA8Ym9yaXMuYnJlemlsbG9uQGNvbGxhYm9yYS5jb20+Cj4gUmV2aWV3ZWQtYnk6IExhdXJlbnQg
UGluY2hhcnQgPGxhdXJlbnQucGluY2hhcnRAaWRlYXNvbmJvYXJkLmNvbT4KPiBTaWduZWQtb2Zm
LWJ5OiBOZWlsIEFybXN0cm9uZyA8bmFybXN0cm9uZ0BiYXlsaWJyZS5jb20+Cj4gLS0tCgpSZXZp
ZXdlZCBieTogSmVybmVqIFNrcmFiZWMgPGplcm5lai5za3JhYmVjQHNpb2wubmV0PgoKQmVzdCBy
ZWdhcmRzLApKZXJuZWoKCj4gQ2hhbmdlcyBpbiB2NToKPiAqIE5vbmUKPiAKPiBDaGFuZ2VzIGlu
IHY0Ogo+ICogUmVuYW1lIGZ1bmMgcGFyYW1zIGludG8gb2xkX2JyaWRnZV9zdGF0ZQo+ICogQWRk
IExhdXJlbnQncyBSYgo+IAo+IENoYW5nZXMgaW4gdjM6Cj4gKiBPbGQgc3RhdGUgY2xhcmlmaWNh
dGlvbiBtb3ZlZCB0byBhIHNlcGFyYXRlIHBhdGNoCj4gCj4gQ2hhbmdlcyBpbiB2MjoKPiAqIFBh
c3MgdGhlIG9sZCBicmlkZ2Ugc3RhdGUKPiAtLS0KPiAgLi4uL2RybS9icmlkZ2UvYW5hbG9naXgv
YW5hbG9naXhfZHBfY29yZS5jICAgIHwgNDEgKysrKysrKy0tLS0tLQo+ICBkcml2ZXJzL2dwdS9k
cm0vZHJtX2JyaWRnZS5jICAgICAgICAgICAgICAgICAgfCA2MSArKysrKysrKysrKysrKystLS0t
Cj4gIGluY2x1ZGUvZHJtL2RybV9icmlkZ2UuaCAgICAgICAgICAgICAgICAgICAgICB8ICA4ICst
LQo+ICAzIGZpbGVzIGNoYW5nZWQsIDc3IGluc2VydGlvbnMoKyksIDMzIGRlbGV0aW9ucygtKQo+
IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4
X2RwX2NvcmUuYwo+IGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeF9k
cF9jb3JlLmMgaW5kZXgKPiA2ZWZmZTUzMmY4MjAuLjZmYWI3MTk4NWNkNCAxMDA2NDQKPiAtLS0g
YS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4X2RwX2NvcmUuYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXhfZHBfY29yZS5jCj4g
QEAgLTEyODksMTkgKzEyODksMjEgQEAgc3RydWN0IGRybV9jcnRjICphbmFsb2dpeF9kcF9nZXRf
bmV3X2NydGMoc3RydWN0Cj4gYW5hbG9naXhfZHBfZGV2aWNlICpkcCwgcmV0dXJuIGNvbm5fc3Rh
dGUtPmNydGM7Cj4gIH0KPiAKPiAtc3RhdGljIHZvaWQgYW5hbG9naXhfZHBfYnJpZGdlX2F0b21p
Y19wcmVfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCj4gLQkJCQkJCSBzdHJ1Y3Qg
CmRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQo+ICtzdGF0aWMgdm9pZAo+ICthbmFsb2dpeF9kcF9i
cmlkZ2VfYXRvbWljX3ByZV9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKPiArCQkJ
CSAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgCipvbGRfYnJpZGdlX3N0YXRlKQo+ICB7Cj4g
KwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlID0gb2xkX2JyaWRnZV9zdGF0ZS0+
YmFzZS5zdGF0ZTsKPiAgCXN0cnVjdCBhbmFsb2dpeF9kcF9kZXZpY2UgKmRwID0gYnJpZGdlLT5k
cml2ZXJfcHJpdmF0ZTsKPiAgCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKPiAgCXN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7Cj4gIAlpbnQgcmV0Owo+IAo+IC0JY3J0YyA9IGFu
YWxvZ2l4X2RwX2dldF9uZXdfY3J0YyhkcCwgc3RhdGUpOwo+ICsJY3J0YyA9IGFuYWxvZ2l4X2Rw
X2dldF9uZXdfY3J0YyhkcCwgb2xkX3N0YXRlKTsKPiAgCWlmICghY3J0YykKPiAgCQlyZXR1cm47
Cj4gCj4gLQlvbGRfY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0
YXRlLCBjcnRjKTsKPiArCW9sZF9jcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfb2xkX2NydGNf
c3RhdGUob2xkX3N0YXRlLCBjcnRjKTsKPiAgCS8qIERvbid0IHRvdWNoIHRoZSBwYW5lbCBpZiB3
ZSdyZSBjb21pbmcgYmFjayBmcm9tIFBTUiAqLwo+ICAJaWYgKG9sZF9jcnRjX3N0YXRlICYmIG9s
ZF9jcnRjX3N0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQo+ICAJCXJldHVybjsKPiBAQCAtMTM2
NiwyMCArMTM2OCwyMiBAQCBzdGF0aWMgaW50IGFuYWxvZ2l4X2RwX3NldF9icmlkZ2Uoc3RydWN0
Cj4gYW5hbG9naXhfZHBfZGV2aWNlICpkcCkgcmV0dXJuIHJldDsKPiAgfQo+IAo+IC1zdGF0aWMg
dm9pZCBhbmFsb2dpeF9kcF9icmlkZ2VfYXRvbWljX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlLAo+IC0JCQkJCSAgICAgc3RydWN0IApkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKPiAr
c3RhdGljIHZvaWQKPiArYW5hbG9naXhfZHBfYnJpZGdlX2F0b21pY19lbmFibGUoc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSwKPiArCQkJCSBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAKKm9sZF9i
cmlkZ2Vfc3RhdGUpCj4gIHsKPiArCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUg
PSBvbGRfYnJpZGdlX3N0YXRlLT5iYXNlLnN0YXRlOwo+ICAJc3RydWN0IGFuYWxvZ2l4X2RwX2Rl
dmljZSAqZHAgPSBicmlkZ2UtPmRyaXZlcl9wcml2YXRlOwo+ICAJc3RydWN0IGRybV9jcnRjICpj
cnRjOwo+ICAJc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZTsKPiAgCWludCB0
aW1lb3V0X2xvb3AgPSAwOwo+ICAJaW50IHJldDsKPiAKPiAtCWNydGMgPSBhbmFsb2dpeF9kcF9n
ZXRfbmV3X2NydGMoZHAsIHN0YXRlKTsKPiArCWNydGMgPSBhbmFsb2dpeF9kcF9nZXRfbmV3X2Ny
dGMoZHAsIG9sZF9zdGF0ZSk7Cj4gIAlpZiAoIWNydGMpCj4gIAkJcmV0dXJuOwo+IAo+IC0Jb2xk
X2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7
Cj4gKwlvbGRfY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKG9sZF9z
dGF0ZSwgY3J0Yyk7Cj4gIAkvKiBOb3QgYSBmdWxsIGVuYWJsZSwganVzdCBkaXNhYmxlIFBTUiBh
bmQgY29udGludWUgKi8KPiAgCWlmIChvbGRfY3J0Y19zdGF0ZSAmJiBvbGRfY3J0Y19zdGF0ZS0+
c2VsZl9yZWZyZXNoX2FjdGl2ZSkgewo+ICAJCXJldCA9IGFuYWxvZ2l4X2RwX2Rpc2FibGVfcHNy
KGRwKTsKPiBAQCAtMTQ0MCwxOCArMTQ0NCwyMCBAQCBzdGF0aWMgdm9pZCBhbmFsb2dpeF9kcF9i
cmlkZ2VfZGlzYWJsZShzdHJ1Y3QKPiBkcm1fYnJpZGdlICpicmlkZ2UpIGRwLT5kcG1zX21vZGUg
PSBEUk1fTU9ERV9EUE1TX09GRjsKPiAgfQo+IAo+IC1zdGF0aWMgdm9pZCBhbmFsb2dpeF9kcF9i
cmlkZ2VfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKPiAtCQkJCQkg
ICAgICBzdHJ1Y3QgCmRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQo+ICtzdGF0aWMgdm9pZAo+ICth
bmFsb2dpeF9kcF9icmlkZ2VfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKPiArCQkJCSAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgCipvbGRfYnJpZGdlX3N0YXRlKQo+
ICB7Cj4gKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlID0gb2xkX2JyaWRnZV9z
dGF0ZS0+YmFzZS5zdGF0ZTsKPiAgCXN0cnVjdCBhbmFsb2dpeF9kcF9kZXZpY2UgKmRwID0gYnJp
ZGdlLT5kcml2ZXJfcHJpdmF0ZTsKPiAgCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKPiAgCXN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUgPSBOVUxMOwo+IAo+IC0JY3J0YyA9IGFu
YWxvZ2l4X2RwX2dldF9uZXdfY3J0YyhkcCwgc3RhdGUpOwo+ICsJY3J0YyA9IGFuYWxvZ2l4X2Rw
X2dldF9uZXdfY3J0YyhkcCwgb2xkX3N0YXRlKTsKPiAgCWlmICghY3J0YykKPiAgCQlnb3RvIG91
dDsKPiAKPiAtCW5ld19jcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUo
c3RhdGUsIGNydGMpOwo+ICsJbmV3X2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0
Y19zdGF0ZShvbGRfc3RhdGUsIGNydGMpOwo+ICAJaWYgKCFuZXdfY3J0Y19zdGF0ZSkKPiAgCQln
b3RvIG91dDsKPiAKPiBAQCAtMTQ2MywyMCArMTQ2OSwyMSBAQCBzdGF0aWMgdm9pZCBhbmFsb2dp
eF9kcF9icmlkZ2VfYXRvbWljX2Rpc2FibGUoc3RydWN0Cj4gZHJtX2JyaWRnZSAqYnJpZGdlLCBh
bmFsb2dpeF9kcF9icmlkZ2VfZGlzYWJsZShicmlkZ2UpOwo+ICB9Cj4gCj4gLXN0YXRpYwo+IC12
b2lkIGFuYWxvZ2l4X2RwX2JyaWRnZV9hdG9taWNfcG9zdF9kaXNhYmxlKHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UsCj4gLQkJCQkJICAgIHN0cnVjdCAKZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUp
Cj4gK3N0YXRpYyB2b2lkCj4gK2FuYWxvZ2l4X2RwX2JyaWRnZV9hdG9taWNfcG9zdF9kaXNhYmxl
KHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCj4gKwkJCQlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0
ZSAKKm9sZF9icmlkZ2Vfc3RhdGUpCj4gIHsKPiArCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpv
bGRfc3RhdGUgPSBvbGRfYnJpZGdlX3N0YXRlLT5iYXNlLnN0YXRlOwo+ICAJc3RydWN0IGFuYWxv
Z2l4X2RwX2RldmljZSAqZHAgPSBicmlkZ2UtPmRyaXZlcl9wcml2YXRlOwo+ICAJc3RydWN0IGRy
bV9jcnRjICpjcnRjOwo+ICAJc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsK
PiAgCWludCByZXQ7Cj4gCj4gLQljcnRjID0gYW5hbG9naXhfZHBfZ2V0X25ld19jcnRjKGRwLCBz
dGF0ZSk7Cj4gKwljcnRjID0gYW5hbG9naXhfZHBfZ2V0X25ld19jcnRjKGRwLCBvbGRfc3RhdGUp
Owo+ICAJaWYgKCFjcnRjKQo+ICAJCXJldHVybjsKPiAKPiAtCW5ld19jcnRjX3N0YXRlID0gZHJt
X2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwo+ICsJbmV3X2NydGNfc3Rh
dGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShvbGRfc3RhdGUsIGNydGMpOwo+ICAJ
aWYgKCFuZXdfY3J0Y19zdGF0ZSB8fCAhbmV3X2NydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3Rp
dmUpCj4gIAkJcmV0dXJuOwo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Jy
aWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwo+IGluZGV4IGEzOTIxYjQ1ZjA0
NC4uNmJkYzRhYjc4OWM5IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdl
LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCj4gQEAgLTQ2NSwxMCArNDY1
LDE5IEBAIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZGlzYWJsZShzdHJ1Y3QgZHJtX2Jy
aWRnZQo+ICpicmlkZ2UsCj4gCj4gIAllbmNvZGVyID0gYnJpZGdlLT5lbmNvZGVyOwo+ICAJbGlz
dF9mb3JfZWFjaF9lbnRyeV9yZXZlcnNlKGl0ZXIsICZlbmNvZGVyLT5icmlkZ2VfY2hhaW4sIApj
aGFpbl9ub2RlKSB7Cj4gLQkJaWYgKGl0ZXItPmZ1bmNzLT5hdG9taWNfZGlzYWJsZSkKPiAtCQkJ
aXRlci0+ZnVuY3MtPmF0b21pY19kaXNhYmxlKGl0ZXIsIApvbGRfc3RhdGUpOwo+IC0JCWVsc2Ug
aWYgKGl0ZXItPmZ1bmNzLT5kaXNhYmxlKQo+ICsJCWlmIChpdGVyLT5mdW5jcy0+YXRvbWljX2Rp
c2FibGUpIHsKPiArCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm9sZF9icmlkZ2Vfc3RhdGU7
Cj4gKwo+ICsJCQlvbGRfYnJpZGdlX3N0YXRlID0KPiArCQkJCQpkcm1fYXRvbWljX2dldF9vbGRf
YnJpZGdlX3N0YXRlKG9sZF9zdGF0ZSwKPiArCQkJCQkJCQkKaXRlcik7Cj4gKwkJCWlmIChXQVJO
X09OKCFvbGRfYnJpZGdlX3N0YXRlKSkKPiArCQkJCXJldHVybjsKPiArCj4gKwkJCWl0ZXItPmZ1
bmNzLT5hdG9taWNfZGlzYWJsZShpdGVyLCAKb2xkX2JyaWRnZV9zdGF0ZSk7Cj4gKwkJfSBlbHNl
IGlmIChpdGVyLT5mdW5jcy0+ZGlzYWJsZSkgewo+ICAJCQlpdGVyLT5mdW5jcy0+ZGlzYWJsZShp
dGVyKTsKPiArCQl9Cj4gCj4gIAkJaWYgKGl0ZXIgPT0gYnJpZGdlKQo+ICAJCQlicmVhazsKPiBA
QCAtNDk5LDEwICs1MDgsMjAgQEAgdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rp
c2FibGUoc3RydWN0Cj4gZHJtX2JyaWRnZSAqYnJpZGdlLAo+IAo+ICAJZW5jb2RlciA9IGJyaWRn
ZS0+ZW5jb2RlcjsKPiAgCWxpc3RfZm9yX2VhY2hfZW50cnlfZnJvbShicmlkZ2UsICZlbmNvZGVy
LT5icmlkZ2VfY2hhaW4sIApjaGFpbl9ub2RlKSB7Cj4gLQkJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0
b21pY19wb3N0X2Rpc2FibGUpCj4gLQkJCWJyaWRnZS0+ZnVuY3MtPmF0b21pY19wb3N0X2Rpc2Fi
bGUoYnJpZGdlLCAKb2xkX3N0YXRlKTsKPiAtCQllbHNlIGlmIChicmlkZ2UtPmZ1bmNzLT5wb3N0
X2Rpc2FibGUpCj4gKwkJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19wb3N0X2Rpc2FibGUpIHsK
PiArCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm9sZF9icmlkZ2Vfc3RhdGU7Cj4gKwo+ICsJ
CQlvbGRfYnJpZGdlX3N0YXRlID0KPiArCQkJCQpkcm1fYXRvbWljX2dldF9vbGRfYnJpZGdlX3N0
YXRlKG9sZF9zdGF0ZSwKPiArCQkJCQkJCQkKYnJpZGdlKTsKPiArCQkJaWYgKFdBUk5fT04oIW9s
ZF9icmlkZ2Vfc3RhdGUpKQo+ICsJCQkJcmV0dXJuOwo+ICsKPiArCQkJYnJpZGdlLT5mdW5jcy0+
YXRvbWljX3Bvc3RfZGlzYWJsZShicmlkZ2UsCj4gKwkJCQkJCQkgICAKb2xkX2JyaWRnZV9zdGF0
ZSk7Cj4gKwkJfSBlbHNlIGlmIChicmlkZ2UtPmZ1bmNzLT5wb3N0X2Rpc2FibGUpIHsKPiAgCQkJ
YnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7Cj4gKwkJfQo+ICAJfQo+ICB9Cj4g
IEVYUE9SVF9TWU1CT0woZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fcG9zdF9kaXNhYmxlKTsKPiBA
QCAtNTMxLDEwICs1NTAsMTkgQEAgdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wcmVfZW5h
YmxlKHN0cnVjdAo+IGRybV9icmlkZ2UgKmJyaWRnZSwKPiAKPiAgCWVuY29kZXIgPSBicmlkZ2Ut
PmVuY29kZXI7Cj4gIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVyc2UoaXRlciwgJmVuY29kZXIt
PmJyaWRnZV9jaGFpbiwgCmNoYWluX25vZGUpIHsKPiAtCQlpZiAoaXRlci0+ZnVuY3MtPmF0b21p
Y19wcmVfZW5hYmxlKQo+IC0JCQlpdGVyLT5mdW5jcy0+YXRvbWljX3ByZV9lbmFibGUoaXRlciwg
Cm9sZF9zdGF0ZSk7Cj4gLQkJZWxzZSBpZiAoaXRlci0+ZnVuY3MtPnByZV9lbmFibGUpCj4gKwkJ
aWYgKGl0ZXItPmZ1bmNzLT5hdG9taWNfcHJlX2VuYWJsZSkgewo+ICsJCQlzdHJ1Y3QgZHJtX2Jy
aWRnZV9zdGF0ZSAqb2xkX2JyaWRnZV9zdGF0ZTsKPiArCj4gKwkJCW9sZF9icmlkZ2Vfc3RhdGUg
PQo+ICsJCQkJCmRybV9hdG9taWNfZ2V0X29sZF9icmlkZ2Vfc3RhdGUob2xkX3N0YXRlLAo+ICsJ
CQkJCQkJCQppdGVyKTsKPiArCQkJaWYgKFdBUk5fT04oIW9sZF9icmlkZ2Vfc3RhdGUpKQo+ICsJ
CQkJcmV0dXJuOwo+ICsKPiArCQkJaXRlci0+ZnVuY3MtPmF0b21pY19wcmVfZW5hYmxlKGl0ZXIs
IApvbGRfYnJpZGdlX3N0YXRlKTsKPiArCQl9IGVsc2UgaWYgKGl0ZXItPmZ1bmNzLT5wcmVfZW5h
YmxlKSB7Cj4gIAkJCWl0ZXItPmZ1bmNzLT5wcmVfZW5hYmxlKGl0ZXIpOwo+ICsJCX0KPiAKPiAg
CQlpZiAoaXRlciA9PSBicmlkZ2UpCj4gIAkJCWJyZWFrOwo+IEBAIC01NjQsMTAgKzU5MiwxOSBA
QCB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZQo+
ICpicmlkZ2UsCj4gCj4gIAllbmNvZGVyID0gYnJpZGdlLT5lbmNvZGVyOwo+ICAJbGlzdF9mb3Jf
ZWFjaF9lbnRyeV9mcm9tKGJyaWRnZSwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwgCmNoYWluX25v
ZGUpIHsKPiAtCQlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX2VuYWJsZSkKPiAtCQkJYnJpZGdl
LT5mdW5jcy0+YXRvbWljX2VuYWJsZShicmlkZ2UsIApvbGRfc3RhdGUpOwo+IC0JCWVsc2UgaWYg
KGJyaWRnZS0+ZnVuY3MtPmVuYWJsZSkKPiArCQlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX2Vu
YWJsZSkgewo+ICsJCQlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqb2xkX2JyaWRnZV9zdGF0ZTsK
PiArCj4gKwkJCW9sZF9icmlkZ2Vfc3RhdGUgPQo+ICsJCQkJCmRybV9hdG9taWNfZ2V0X29sZF9i
cmlkZ2Vfc3RhdGUob2xkX3N0YXRlLAo+ICsJCQkJCQkJCQpicmlkZ2UpOwo+ICsJCQlpZiAoV0FS
Tl9PTighb2xkX2JyaWRnZV9zdGF0ZSkpCj4gKwkJCQlyZXR1cm47Cj4gKwo+ICsJCQlicmlkZ2Ut
PmZ1bmNzLT5hdG9taWNfZW5hYmxlKGJyaWRnZSwgCm9sZF9icmlkZ2Vfc3RhdGUpOwo+ICsJCX0g
ZWxzZSBpZiAoYnJpZGdlLT5mdW5jcy0+ZW5hYmxlKSB7Cj4gIAkJCWJyaWRnZS0+ZnVuY3MtPmVu
YWJsZShicmlkZ2UpOwo+ICsJCX0KPiAgCX0KPiAgfQo+ICBFWFBPUlRfU1lNQk9MKGRybV9hdG9t
aWNfYnJpZGdlX2NoYWluX2VuYWJsZSk7Cj4gZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9i
cmlkZ2UuaCBiL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAo+IGluZGV4IDhhOTI2YzFhMDhkYi4u
MDMzMWUzMzA2MzViIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAo+ICsr
KyBiL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAo+IEBAIC0yODIsNyArMjgyLDcgQEAgc3RydWN0
IGRybV9icmlkZ2VfZnVuY3Mgewo+ICAJICogVGhlIEBhdG9taWNfcHJlX2VuYWJsZSBjYWxsYmFj
ayBpcyBvcHRpb25hbC4KPiAgCSAqLwo+ICAJdm9pZCAoKmF0b21pY19wcmVfZW5hYmxlKShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAo+IC0JCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAK
Km9sZF9zdGF0ZSk7Cj4gKwkJCQkgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRlIAoqb2xkX2JyaWRn
ZV9zdGF0ZSk7Cj4gCj4gIAkvKioKPiAgCSAqIEBhdG9taWNfZW5hYmxlOgo+IEBAIC0zMDcsNyAr
MzA3LDcgQEAgc3RydWN0IGRybV9icmlkZ2VfZnVuY3Mgewo+ICAJICogVGhlIEBhdG9taWNfZW5h
YmxlIGNhbGxiYWNrIGlzIG9wdGlvbmFsLgo+ICAJICovCj4gIAl2b2lkICgqYXRvbWljX2VuYWJs
ZSkoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKPiAtCQkJICAgICAgc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKm9sZF9zdGF0ZSk7Cj4gKwkJCSAgICAgIHN0cnVjdCBkcm1fYnJpZGdlX3N0YXRl
IAoqb2xkX2JyaWRnZV9zdGF0ZSk7Cj4gIAkvKioKPiAgCSAqIEBhdG9taWNfZGlzYWJsZToKPiAg
CSAqCj4gQEAgLTMzMCw3ICszMzAsNyBAQCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7Cj4gIAkg
KiBUaGUgQGF0b21pY19kaXNhYmxlIGNhbGxiYWNrIGlzIG9wdGlvbmFsLgo+ICAJICovCj4gIAl2
b2lkICgqYXRvbWljX2Rpc2FibGUpKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCj4gLQkJCSAg
ICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKTsKPiArCQkJICAgICAgIHN0
cnVjdCBkcm1fYnJpZGdlX3N0YXRlIAoqb2xkX2JyaWRnZV9zdGF0ZSk7Cj4gCj4gIAkvKioKPiAg
CSAqIEBhdG9taWNfcG9zdF9kaXNhYmxlOgo+IEBAIC0zNTYsNyArMzU2LDcgQEAgc3RydWN0IGRy
bV9icmlkZ2VfZnVuY3Mgewo+ICAJICogVGhlIEBhdG9taWNfcG9zdF9kaXNhYmxlIGNhbGxiYWNr
IGlzIG9wdGlvbmFsLgo+ICAJICovCj4gIAl2b2lkICgqYXRvbWljX3Bvc3RfZGlzYWJsZSkoc3Ry
dWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKPiAtCQkJCSAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAKKm9sZF9zdGF0ZSk7Cj4gKwkJCQkgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgCipvbGRf
YnJpZGdlX3N0YXRlKTsKPiAKPiAgCS8qKgo+ICAJICogQGF0b21pY19kdXBsaWNhdGVfc3RhdGU6
CgoKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
