Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 12E0D568B3
	for <lists+dri-devel@lfdr.de>; Wed, 26 Jun 2019 14:23:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BD44E6E3DB;
	Wed, 26 Jun 2019 12:23:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x442.google.com (mail-wr1-x442.google.com
 [IPv6:2a00:1450:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3BDEA6E3B8;
 Wed, 26 Jun 2019 12:23:18 +0000 (UTC)
Received: by mail-wr1-x442.google.com with SMTP id v14so2508871wrr.4;
 Wed, 26 Jun 2019 05:23:18 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=N6DhTE6F9h7ziW5s8D3Yybth/pRfwB+8zOBFG4Aaoqk=;
 b=g//2f1ISgZq+CcsT4vNcLkAlAeUSjvkmSwEm0XFCnYzSs6eEsfIRicniH2aMeyi1io
 lQRDutqurb2V/fw4mBKF3VpK5l2tmLq72c+g+nCR6WE2PT8Ock60Xe31KL2L45Z6pSmL
 JVPZsWm+97YYAfmdrKx65nCRkqQVc4YA6KANrhMrJAqKGaKoAvvJiggQmTgfMHdQLH7t
 8nR5EoCcaqUY83IdUmikd68PZvuDC1YB4HXyio6efDRTJ385/WtCRq3oNSoGX+a/jl8g
 LD6jHZNisgooIbFA1f3N6gVPXupJPHAR1qstCxHm0owis3d38jXhPHl5OzfG30YxPLqv
 2Rag==
X-Gm-Message-State: APjAAAVbco1XqScp734D/kGb+5DN3BzS0o7C7yGEoZAkFbQc+AO8+Oaj
 KAXv/Gf3AvDRj+msmtI/201DRR64
X-Google-Smtp-Source: APXvYqyS08Tnu3jlriBEyrT8nFv1t8KGIKZaUwlxY1Y6MH2MBHrHajF/7yObIbUmXmoTdKyejMZWbA==
X-Received: by 2002:adf:ea4a:: with SMTP id j10mr3433305wrn.3.1561551796547;
 Wed, 26 Jun 2019 05:23:16 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:902c:2dc9:c30e:db03])
 by smtp.gmail.com with ESMTPSA id k125sm2262018wmf.41.2019.06.26.05.23.15
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 26 Jun 2019 05:23:15 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: intel-gfx@lists.freedesktop.org, dri-devel@lists.freedesktop.org,
 amd-gfx@lists.freedesktop.org
Subject: [PATCH 6/6] drm/amdgpu: add independent DMA-buf import v7
Date: Wed, 26 Jun 2019 14:23:10 +0200
Message-Id: <20190626122310.1498-6-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190626122310.1498-1-christian.koenig@amd.com>
References: <20190626122310.1498-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=N6DhTE6F9h7ziW5s8D3Yybth/pRfwB+8zOBFG4Aaoqk=;
 b=EPW2d/eBrt34A7ROlLQv3znK55OnKTIo4rtCZcWU2TDhSVXgILsb45FqTRMwNNpXmv
 k2ufigxjJTiMG7q7EHW7uQNkoFIRj3p+4bi8ZcxolxDnPhqFRy3BLJ0cHfIKij+XYaFa
 VnyUYgvyi25sjT/gBO5OwxoL/A/HShJjKhfXKPZVFqb9t9HIRJ8epxfGQn+ieyopRUrI
 uVwbyIeyL4ApEZhYuuWrv5goHugNNnZiAVvm6tDTs/olF08r9HeMSUAu7aIvIZr3cOhZ
 fWD1zMMwX2uiICIfUZAZ8BF6QWoyuPPODI+Pskg48IfdUWZvvV6XU9WVEG8X5xCR3cZ/
 V5Ag==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiByZWx5aW5nIG9uIHRoZSBEUk0gZnVuY3Rpb25zIGp1c3QgaW1wbGVtZW50IG91
ciBvd24gaW1wb3J0CmZ1bmN0aW9ucy4gVGhpcyBwcmVwYXJlcyBzdXBwb3J0IGZvciB0YWtpbmcg
Y2FyZSBvZiB1bnBpbm5lZCBETUEtYnVmLgoKdjI6IGVuYWJsZSBmb3IgYWxsIGV4cG9ydGVycywg
bm90IGp1c3QgYW1kZ3B1LCBmaXggaW52YWxpZGF0aW9uCiAgICBoYW5kbGluZywgbG9jayByZXNl
cnZhdGlvbiBvYmplY3Qgd2hpbGUgc2V0dGluZyBjYWxsYmFjawp2MzogY2hhbmdlIHRvIG5ldyBk
bWFfYnVmIGF0dGFjaCBpbnRlcmZhY2UKdjQ6IHNwbGl0IG91dCBmcm9tIHVucGlubmVkIERNQS1i
dWYgd29yawp2NTogcmViYXNlZCBhbmQgY2xlYW51cCBvbiBuZXcgRE1BLWJ1ZiBpbnRlcmZhY2UK
djY6IHNxdWFzaCB3aXRoIGludmFsaWRhdGlvbiBjYWxsYmFjayBjaGFuZ2UsCiAgICBzdG9wIHVz
aW5nIF8obWFwfHVubWFwKV9sb2NrZWQKdjc6IGRyb3AgaW52YWxpZGF0aW9ucyB3aGVuIHRoZSBC
TyBpcyBhbHJlYWR5IGluIHN5c3RlbSBkb21haW4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBL
w7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jIHwgNjggKysrKysrKysrKysrKysrKy0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oIHwgIDQgLS0KIGRyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kcnYuYyAgICAgfCAgMSAtCiBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgIHwgIDYgKysKIGRyaXZlcnMvZ3B1L2RybS9h
bWQvYW1kZ3B1L2FtZGdwdV90dG0uYyAgICAgfCAzMiArKysrKysrKy0tCiA1IGZpbGVzIGNoYW5n
ZWQsIDg2IGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCmluZGV4IDQ1NDFlYWU3YWFkYi4uMjYzMDM5M2Rh
MzVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1
Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMKQEAg
LTQyMywzMSArNDIzLDI4IEBAIHN0cnVjdCBkbWFfYnVmICphbWRncHVfZ2VtX3ByaW1lX2V4cG9y
dChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdvYmosCiB9CiAKIC8qKgotICogYW1kZ3B1X2dlbV9w
cmltZV9pbXBvcnRfc2dfdGFibGUgLSAmZHJtX2RyaXZlci5nZW1fcHJpbWVfaW1wb3J0X3NnX3Rh
YmxlCi0gKiBpbXBsZW1lbnRhdGlvbgorICogYW1kZ3B1X2RtYV9idWZfY3JlYXRlX29iaiAtIGNy
ZWF0ZSBCTyBmb3IgRE1BLWJ1ZiBpbXBvcnQKKyAqCiAgKiBAZGV2OiBEUk0gZGV2aWNlCi0gKiBA
YXR0YWNoOiBETUEtYnVmIGF0dGFjaG1lbnQKLSAqIEBzZzogU2NhdHRlci9nYXRoZXIgdGFibGUK
KyAqIEBkbWFfYnVmOiBETUEtYnVmCiAgKgotICogSW1wb3J0cyBzaGFyZWQgRE1BIGJ1ZmZlciBt
ZW1vcnkgZXhwb3J0ZWQgYnkgYW5vdGhlciBkZXZpY2UuCisgKiBDcmVhdGVzIGFuIGVtcHR5IFNH
IEJPIGZvciBETUEtYnVmIGltcG9ydC4KICAqCiAgKiBSZXR1cm5zOgogICogQSBuZXcgR0VNIEJP
IG9mIHRoZSBnaXZlbiBEUk0gZGV2aWNlLCByZXByZXNlbnRpbmcgdGhlIG1lbW9yeQogICogZGVz
Y3JpYmVkIGJ5IHRoZSBnaXZlbiBETUEtYnVmIGF0dGFjaG1lbnQgYW5kIHNjYXR0ZXIvZ2F0aGVy
IHRhYmxlLgogICovCi1zdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKgotYW1kZ3B1X2dlbV9wcmltZV9p
bXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQkgc3RydWN0IGRtYV9i
dWZfYXR0YWNobWVudCAqYXR0YWNoLAotCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnNnKQorc3RhdGlj
IHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqCithbWRncHVfZG1hX2J1Zl9jcmVhdGVfb2JqKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmKQogewotCXN0cnVjdCBy
ZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBhdHRhY2gtPmRtYWJ1Zi0+cmVzdjsKKwlzdHJ1Y3Qg
cmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gZG1hX2J1Zi0+cmVzdjsKIAlzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiA9IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGFtZGdwdV9ibyAqYm87
CiAJc3RydWN0IGFtZGdwdV9ib19wYXJhbSBicDsKIAlpbnQgcmV0OwogCiAJbWVtc2V0KCZicCwg
MCwgc2l6ZW9mKGJwKSk7Ci0JYnAuc2l6ZSA9IGF0dGFjaC0+ZG1hYnVmLT5zaXplOworCWJwLnNp
emUgPSBkbWFfYnVmLT5zaXplOwogCWJwLmJ5dGVfYWxpZ24gPSBQQUdFX1NJWkU7CiAJYnAuZG9t
YWluID0gQU1ER1BVX0dFTV9ET01BSU5fQ1BVOwogCWJwLmZsYWdzID0gMDsKQEAgLTQ1OCwxMSAr
NDU1LDkgQEAgYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAlpZiAocmV0KQogCQlnb3RvIGVycm9yOwogCi0JYm8tPnRiby5zZyA9IHNnOwot
CWJvLT50Ym8udHRtLT5zZyA9IHNnOwogCWJvLT5hbGxvd2VkX2RvbWFpbnMgPSBBTURHUFVfR0VN
X0RPTUFJTl9HVFQ7CiAJYm8tPnByZWZlcnJlZF9kb21haW5zID0gQU1ER1BVX0dFTV9ET01BSU5f
R1RUOwotCWlmIChhdHRhY2gtPmRtYWJ1Zi0+b3BzICE9ICZhbWRncHVfZG1hYnVmX29wcykKKwlp
ZiAoZG1hX2J1Zi0+b3BzICE9ICZhbWRncHVfZG1hYnVmX29wcykKIAkJYm8tPnByaW1lX3NoYXJl
ZF9jb3VudCA9IDE7CiAKIAl3d19tdXRleF91bmxvY2soJnJlc3YtPmxvY2spOwpAQCAtNDczLDYg
KzQ2OCwzNSBAQCBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCXJldHVybiBFUlJfUFRSKHJldCk7CiB9CiAKKy8qKgorICogYW1kZ3B1X2dl
bV9wcmltZV9tb3ZlX25vdGlmeSAtICZhdHRhY2gubW92ZV9ub3RpZnkgaW1wbGVtZW50YXRpb24K
KyAqCisgKiBAYXR0YWNoOiB0aGUgRE1BLWJ1ZiBhdHRhY2htZW50CisgKgorICogSW52YWxpZGF0
ZSB0aGUgRE1BLWJ1ZiBhdHRhY2htZW50LCBtYWtpbmcgc3VyZSB0aGF0IHRoZSB3ZSByZS1jcmVh
dGUgdGhlCisgKiBtYXBwaW5nIGJlZm9yZSB0aGUgbmV4dCB1c2UuCisgKi8KK3N0YXRpYyB2b2lk
CithbWRncHVfZ2VtX3ByaW1lX21vdmVfbm90aWZ5KHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQg
KmF0dGFjaCkKK3sKKwlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0geyBmYWxzZSwgZmFs
c2UgfTsKKwlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiA9IGF0dGFjaC0+aW1wb3J0ZXJfcHJp
djsKKwlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IGdlbV90b19hbWRncHVfYm8ob2JqKTsKKwlzdHJ1
Y3QgdHRtX3BsYWNlbWVudCBwbGFjZW1lbnQgPSB7fTsKKwlpbnQgcjsKKworCWlmIChiby0+dGJv
Lm1lbS5tZW1fdHlwZSA9PSBUVE1fUExfU1lTVEVNKQorCQlyZXR1cm47CisKKwlyID0gdHRtX2Jv
X3ZhbGlkYXRlKCZiby0+dGJvLCAmcGxhY2VtZW50LCAmY3R4KTsKKwlpZiAocikKKwkJRFJNX0VS
Uk9SKCJGYWlsZWQgdG8gaW52YWxpZGF0ZSBETUEtYnVmIGltcG9ydCAoJWQpKVxuIiwgcik7Cit9
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2hfb3BzIGFtZGdwdV9kbWFfYnVm
X2F0dGFjaF9vcHMgPSB7CisJLm1vdmVfbm90aWZ5ID0gYW1kZ3B1X2dlbV9wcmltZV9tb3ZlX25v
dGlmeQorfTsKKwogLyoqCiAgKiBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydCAtICZkcm1fZHJpdmVy
LmdlbV9wcmltZV9pbXBvcnQgaW1wbGVtZW50YXRpb24KICAqIEBkZXY6IERSTSBkZXZpY2UKQEAg
LTQ4Nyw2ICs1MTEsNyBAQCBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogc3RydWN0IGRybV9nZW1fb2JqZWN0ICphbWRncHVfZ2VtX3ByaW1l
X2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCQkgICAgc3RydWN0IGRtYV9idWYg
KmRtYV9idWYpCiB7CisJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOwogCXN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqb2JqOwogCiAJaWYgKGRtYV9idWYtPm9wcyA9PSAmYW1kZ3B1X2Rt
YWJ1Zl9vcHMpIHsKQEAgLTUwMSw1ICs1MjYsMTggQEAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICph
bWRncHVfZ2VtX3ByaW1lX2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQl9CiAJfQog
Ci0JcmV0dXJuIGRybV9nZW1fcHJpbWVfaW1wb3J0KGRldiwgZG1hX2J1Zik7CisJb2JqID0gYW1k
Z3B1X2RtYV9idWZfY3JlYXRlX29iaihkZXYsIGRtYV9idWYpOworCWlmIChJU19FUlIob2JqKSkK
KwkJcmV0dXJuIG9iajsKKworCWF0dGFjaCA9IGRtYV9idWZfZHluYW1pY19hdHRhY2goZG1hX2J1
ZiwgZGV2LT5kZXYsCisJCQkJCSZhbWRncHVfZG1hX2J1Zl9hdHRhY2hfb3BzLCBvYmopOworCWlm
IChJU19FUlIoYXR0YWNoKSkgeworCQlkcm1fZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJu
IEVSUl9DQVNUKGF0dGFjaCk7CisJfQorCisJZ2V0X2RtYV9idWYoZG1hX2J1Zik7CisJb2JqLT5p
bXBvcnRfYXR0YWNoID0gYXR0YWNoOworCXJldHVybiBvYmo7CiB9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oIGIvZHJpdmVycy9ncHUvZHJt
L2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuaAppbmRleCAwYWZmZGZhOWYyMmUuLjZhZmM0NzBj
YTE4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9i
dWYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5oCkBA
IC0yNSwxMCArMjUsNiBAQAogCiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KIAotc3RydWN0IGRy
bV9nZW1fb2JqZWN0ICoKLWFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsCi0JCQkJIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwK
LQkJCQkgc3RydWN0IHNnX3RhYmxlICpzZyk7CiBzdHJ1Y3QgZG1hX2J1ZiAqYW1kZ3B1X2dlbV9w
cmltZV9leHBvcnQoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnb2JqLAogCQkJCQlpbnQgZmxhZ3Mp
Owogc3RydWN0IGRybV9nZW1fb2JqZWN0ICphbWRncHVfZ2VtX3ByaW1lX2ltcG9ydChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCmlu
ZGV4IGJjMjg1MTVhNzliMC4uODM2ZjIzZGFjMDRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2Rydi5jCkBAIC0xMzM0LDcgKzEzMzQsNiBAQCBzdGF0aWMgc3RydWN0IGRybV9k
cml2ZXIga21zX2RyaXZlciA9IHsKIAkuZ2VtX3ByaW1lX2V4cG9ydCA9IGFtZGdwdV9nZW1fcHJp
bWVfZXhwb3J0LAogCS5nZW1fcHJpbWVfaW1wb3J0ID0gYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnQs
CiAJLmdlbV9wcmltZV9yZXNfb2JqID0gYW1kZ3B1X2dlbV9wcmltZV9yZXNfb2JqLAotCS5nZW1f
cHJpbWVfaW1wb3J0X3NnX3RhYmxlID0gYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUs
CiAJLmdlbV9wcmltZV92bWFwID0gYW1kZ3B1X2dlbV9wcmltZV92bWFwLAogCS5nZW1fcHJpbWVf
dnVubWFwID0gYW1kZ3B1X2dlbV9wcmltZV92dW5tYXAsCiAJLmdlbV9wcmltZV9tbWFwID0gYW1k
Z3B1X2dlbV9wcmltZV9tbWFwLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jCmluZGV4IDE5NzJmYmJiYjA5MS4uZGRiNmExMmM0OTI0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCkBAIC04NTAsNiArODUwLDkgQEAgaW50IGFt
ZGdwdV9ib19waW5fcmVzdHJpY3RlZChzdHJ1Y3QgYW1kZ3B1X2JvICpibywgdTMyIGRvbWFpbiwK
IAkJcmV0dXJuIDA7CiAJfQogCisJaWYgKGJvLT5nZW1fYmFzZS5pbXBvcnRfYXR0YWNoKQorCQlk
bWFfYnVmX3Bpbihiby0+Z2VtX2Jhc2UuaW1wb3J0X2F0dGFjaCk7CisKIAliby0+ZmxhZ3MgfD0g
QU1ER1BVX0dFTV9DUkVBVEVfVlJBTV9DT05USUdVT1VTOwogCS8qIGZvcmNlIHRvIHBpbiBpbnRv
IHZpc2libGUgdmlkZW8gcmFtICovCiAJaWYgKCEoYm8tPmZsYWdzICYgQU1ER1BVX0dFTV9DUkVB
VEVfTk9fQ1BVX0FDQ0VTUykpCkBAIC05MzMsNiArOTM2LDkgQEAgaW50IGFtZGdwdV9ib191bnBp
bihzdHJ1Y3QgYW1kZ3B1X2JvICpibykKIAogCWFtZGdwdV9ib19zdWJ0cmFjdF9waW5fc2l6ZShi
byk7CiAKKwlpZiAoYm8tPmdlbV9iYXNlLmltcG9ydF9hdHRhY2gpCisJCWRtYV9idWZfdW5waW4o
Ym8tPmdlbV9iYXNlLmltcG9ydF9hdHRhY2gpOworCiAJZm9yIChpID0gMDsgaSA8IGJvLT5wbGFj
ZW1lbnQubnVtX3BsYWNlbWVudDsgaSsrKSB7CiAJCWJvLT5wbGFjZW1lbnRzW2ldLmxwZm4gPSAw
OwogCQliby0+cGxhY2VtZW50c1tpXS5mbGFncyAmPSB+VFRNX1BMX0ZMQUdfTk9fRVZJQ1Q7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKaW5kZXggZDgxYmViZjc2MzEwLi5j
ODlmYTU4YTc5MTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKQEAg
LTM5LDYgKzM5LDcgQEAKICNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgv
c3dhcC5oPgogI2luY2x1ZGUgPGxpbnV4L3N3aW90bGIuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEt
YnVmLmg+CiAKICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KICNpbmNsdWRlIDxkcm0v
dHRtL3R0bV9ib19kcml2ZXIuaD4KQEAgLTcxMSw2ICs3MTIsNyBAQCBzdGF0aWMgdW5zaWduZWQg
bG9uZyBhbWRncHVfdHRtX2lvX21lbV9wZm4oc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
ICAqLwogc3RydWN0IGFtZGdwdV90dG1fdHQgewogCXN0cnVjdCB0dG1fZG1hX3R0CXR0bTsKKwlz
dHJ1Y3QgZHJtX2dlbV9vYmplY3QJKmdvYmo7CiAJdTY0CQkJb2Zmc2V0OwogCXVpbnQ2NF90CQl1
c2VycHRyOwogCXN0cnVjdCB0YXNrX3N0cnVjdAkqdXNlcnRhc2s7CkBAIC0xMTk4LDYgKzEyMDAs
NyBAQCBzdGF0aWMgc3RydWN0IHR0bV90dCAqYW1kZ3B1X3R0bV90dF9jcmVhdGUoc3RydWN0IHR0
bV9idWZmZXJfb2JqZWN0ICpibywKIAkJcmV0dXJuIE5VTEw7CiAJfQogCWd0dC0+dHRtLnR0bS5m
dW5jID0gJmFtZGdwdV9iYWNrZW5kX2Z1bmM7CisJZ3R0LT5nb2JqID0gJnR0bV90b19hbWRncHVf
Ym8oYm8pLT5nZW1fYmFzZTsKIAogCS8qIGFsbG9jYXRlIHNwYWNlIGZvciB0aGUgdW5pbml0aWFs
aXplZCBwYWdlIGVudHJpZXMgKi8KIAlpZiAodHRtX3NnX3R0X2luaXQoJmd0dC0+dHRtLCBibywg
cGFnZV9mbGFncykpIHsKQEAgLTEyMTgsNyArMTIyMSw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3R0
bV90dF9wb3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0sCiB7CiAJc3RydWN0IGFtZGdwdV9kZXZp
Y2UgKmFkZXYgPSBhbWRncHVfdHRtX2FkZXYodHRtLT5iZGV2KTsKIAlzdHJ1Y3QgYW1kZ3B1X3R0
bV90dCAqZ3R0ID0gKHZvaWQgKil0dG07Ci0JYm9vbCBzbGF2ZSA9ICEhKHR0bS0+cGFnZV9mbGFn
cyAmIFRUTV9QQUdFX0ZMQUdfU0cpOwogCiAJLyogdXNlciBwYWdlcyBhcmUgYm91bmQgYnkgYW1k
Z3B1X3R0bV90dF9waW5fdXNlcnB0cigpICovCiAJaWYgKGd0dCAmJiBndHQtPnVzZXJwdHIpIHsK
QEAgLTEyMzEsNyArMTIzMywxOSBAQCBzdGF0aWMgaW50IGFtZGdwdV90dG1fdHRfcG9wdWxhdGUo
c3RydWN0IHR0bV90dCAqdHRtLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAoc2xhdmUgJiYgdHRt
LT5zZykgeworCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NHKSB7CisJCWlm
ICghdHRtLT5zZykgeworCQkJc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoOworCQkJ
c3RydWN0IHNnX3RhYmxlICpzZ3Q7CisKKwkJCWF0dGFjaCA9IGd0dC0+Z29iai0+aW1wb3J0X2F0
dGFjaDsKKwkJCXNndCA9IGRtYV9idWZfbWFwX2F0dGFjaG1lbnQoYXR0YWNoLCBETUFfQklESVJF
Q1RJT05BTCk7CisJCQlpZiAoSVNfRVJSKHNndCkpCisJCQkJcmV0dXJuIFBUUl9FUlIoc2d0KTsK
KworCQkJdHRtLT5zZyA9IHNndDsKKwkJfQorCiAJCWRybV9wcmltZV9zZ190b19wYWdlX2FkZHJf
YXJyYXlzKHR0bS0+c2csIHR0bS0+cGFnZXMsCiAJCQkJCQkgZ3R0LT50dG0uZG1hX2FkZHJlc3Ms
CiAJCQkJCQkgdHRtLT5udW1fcGFnZXMpOwpAQCAtMTI1OCw5ICsxMjcyLDggQEAgc3RhdGljIGlu
dCBhbWRncHVfdHRtX3R0X3BvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSwKICAqLwogc3RhdGlj
IHZvaWQgYW1kZ3B1X3R0bV90dF91bnBvcHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bSkKIHsKLQlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldjsKIAlzdHJ1Y3QgYW1kZ3B1X3R0bV90dCAqZ3R0ID0g
KHZvaWQgKil0dG07Ci0JYm9vbCBzbGF2ZSA9ICEhKHR0bS0+cGFnZV9mbGFncyAmIFRUTV9QQUdF
X0ZMQUdfU0cpOworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2OwogCiAJaWYgKGd0dCAmJiBn
dHQtPnVzZXJwdHIpIHsKIAkJYW1kZ3B1X3R0bV90dF9zZXRfdXNlcl9wYWdlcyh0dG0sIE5VTEwp
OwpAQCAtMTI2OSw3ICsxMjgyLDE2IEBAIHN0YXRpYyB2b2lkIGFtZGdwdV90dG1fdHRfdW5wb3B1
bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0pCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoc2xhdmUpCisJ
aWYgKHR0bS0+c2cgJiYgZ3R0LT5nb2JqLT5pbXBvcnRfYXR0YWNoKSB7CisJCXN0cnVjdCBkbWFf
YnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKKworCQlhdHRhY2ggPSBndHQtPmdvYmotPmltcG9ydF9h
dHRhY2g7CisJCWRtYV9idWZfdW5tYXBfYXR0YWNobWVudChhdHRhY2gsIHR0bS0+c2csIERNQV9C
SURJUkVDVElPTkFMKTsKKwkJdHRtLT5zZyA9IE5VTEw7CisJCXJldHVybjsKKwl9CisKKwlpZiAo
dHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19TRykKIAkJcmV0dXJuOwogCiAJYWRldiA9
IGFtZGdwdV90dG1fYWRldih0dG0tPmJkZXYpOwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
