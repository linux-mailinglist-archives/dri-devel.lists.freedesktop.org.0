Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3E10995159
	for <lists+dri-devel@lfdr.de>; Tue, 20 Aug 2019 01:04:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 994C1892B7;
	Mon, 19 Aug 2019 23:04:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x643.google.com (mail-pl1-x643.google.com
 [IPv6:2607:f8b0:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D897D6E48B
 for <dri-devel@lists.freedesktop.org>; Mon, 19 Aug 2019 23:04:05 +0000 (UTC)
Received: by mail-pl1-x643.google.com with SMTP id gn20so1690317plb.2
 for <dri-devel@lists.freedesktop.org>; Mon, 19 Aug 2019 16:04:05 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=TjgKBqnULZnu1lj9DdO97YcmFn7/F/EreXqPG+h61Eo=;
 b=hi+B2zrTZlddgtd7CizxqCnC8Hr5wGtBPs1d1mqwoJd0KYcK/mO5Z4L0aZyCbTYFf2
 58EccJLwmON76NtrOKfm3t+jhAy1Yf7PnB9LoZlLIyjGrWZkoGBoPgO2pSB6OMY9lBNo
 eJzll2H/PU1crBZcESb6cOEU6Mw5b4VcR1xTWUDl3YQyZT+Zq53KRCuMVG3x9jmM3vw8
 yxnOvphKsy45+9LFVoGpG7OnLoGGwZ+41S6lfnJ1wxUDBLCWRCNueGqQvHe1h8wFFE+h
 Au6g88O6nuaC91O/agD2N56CbRdnsK1ZJp4mEaQFuuS7E7ptgcFeQHmakeeMIJRiKrqq
 p2NQ==
X-Gm-Message-State: APjAAAXOHwZXaFooGpEwcFqLPdu91oHPKhDiLwnD9YX+63wHgoH3YR9Y
 4cg2+RGVxwPwW09qY8/vkMNE/g==
X-Google-Smtp-Source: APXvYqyoBtmT0gsUbvo3d0yExIFRJ1LCT+p/RlEBEsLvJssTH1eigulblaaQ0RnOur756J5oX56Slw==
X-Received: by 2002:a17:902:b418:: with SMTP id
 x24mr24661220plr.219.1566255843997; 
 Mon, 19 Aug 2019 16:04:03 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 j15sm17256509pfr.146.2019.08.19.16.04.02
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 19 Aug 2019 16:04:03 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v4 25/25] drm: kirin: Move ade drm init to kirin drm drv
Date: Mon, 19 Aug 2019 23:03:21 +0000
Message-Id: <20190819230321.56480-26-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190819230321.56480-1-john.stultz@linaro.org>
References: <20190819230321.56480-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=TjgKBqnULZnu1lj9DdO97YcmFn7/F/EreXqPG+h61Eo=;
 b=KQpy1FjPma6psGbw5T97t7M7E/hCLcT30K7owRTnbaxb3/3d68Z0mdvJKIoRxE0CAE
 zSqBD9igvF/IpP5qaqEJNmA6icLvWiNf9naCncmb5qODUwfzCO5jMfRf0uu8tiXI1p4x
 /g8JPzxdD9vwPOnb/bwVxGScV2fo2OIIodLMCLWn/qejrfWSsIq5VLuLJipwU3R7xLHv
 I4q9AHJiURrgNoB2N6Ffgoipn6Q8Mj2nz4JObx1AqtHhgGKU+1v0uyMFSo32f9isBb6r
 77CtEusdAQW2sXgWwzH1VXgaTST1WBZb/2liS8CxJM4csWuzGKlO+yYlKfEPZHHqz7Uw
 R34g==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Xu YiPing <xuyiping@hisilicon.com>, David Airlie <airlied@linux.ie>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Rongrong Zou <zourongrong@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWHUgWWlQaW5nIDx4dXlpcGluZ0BoaXNpbGljb24uY29tPgoKQXMgcGFydCBvZiByZWZh
Y3RvcmluZyB0aGUga2lyaW4gZHJpdmVyIHRvIGJldHRlciBzdXBwb3J0CmRpZmZlcmVudCBoYXJk
d2FyZSByZXZpc2lvbnMsIHRoaXMgcGF0Y2ggcmVuYW1lcyBhZGVfZGF0YSB0bwpraXJpbl9kcm1f
cHJpdmF0ZSwgYW5kIG1vdmVzIGNydGNfaW5pdCBhbmQgcGxhbmVfaW5pdCB0bwpraXJpbiBkcm0g
ZHJ2IHRvby4gTm93IHRoYXQgdGhleSBhcmUgZ2VuZXJpYyB0aGUgZnVuY3Rpb25zCmNhbiBiZSBz
aGFyZWQgYmV0d2VlbiB0aGUga2lyaW42MjAgYW5kICh0byBiZSBhZGRlZCBsYXRlcikKa2lyaW45
NjAgc3BlY2lmaWMgc3VwcG9ydCBjb2RlLgoKQ2M6IFJvbmdyb25nIFpvdSA8em91cm9uZ3JvbmdA
Z21haWwuY29tPgpDYzogWGlubGlhbmcgTGl1IDx6LmxpdXhpbmxpYW5nQGhpc2lsaWNvbi5jb20+
CkNjOiBEYXZpZCBBaXJsaWUgPGFpcmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWxAZmZ3bGwuY2g+CkNjOiBkcmktZGV2ZWwgPGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmc+CkNjOiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+CkFja2VkLWJ5OiBYaW5s
aWFuZyBMaXUgPHoubGl1eGlubGlhbmdAaGlzaWxpY29uLmNvbT4KUmV2aWV3ZWQtYnk6IFNhbSBS
YXZuYm9yZyA8c2FtQHJhdm5ib3JnLm9yZz4KU2lnbmVkLW9mZi1ieTogWHUgWWlQaW5nIDx4dXlp
cGluZ0BoaXNpbGljb24uY29tPgpbanN0dWx0ejogUmV3b3JkZWQgY29tbWl0IG1lc3NhZ2VdClNp
Z25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2huLnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KIC4u
Li9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fYWRlLmMgICB8IDEyMyAtLS0tLS0t
LS0tLS0tLS0KIC4uLi9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMgICB8
IDE0MSArKysrKysrKysrKysrKysrLS0KIC4uLi9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJp
bl9kcm1fZHJ2LmggICB8ICAgNSAtCiAzIGZpbGVzIGNoYW5nZWQsIDEyOSBpbnNlcnRpb25zKCsp
LCAxNDAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNv
bi9raXJpbi9raXJpbl9kcm1fYWRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmlu
L2tpcmluX2RybV9hZGUuYwppbmRleCA1NTllNTIxYWRkNDMuLjFmNzVhMTkwZmQ5MiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fYWRlLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fYWRlLmMKQEAgLTUz
LDEzICs1Myw2IEBAIHN0cnVjdCBhZGVfaHdfY3R4IHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7
CiB9OwogCi1zdHJ1Y3QgYWRlX2RhdGEgewotCXN0cnVjdCBraXJpbl9jcnRjIGNydGM7Ci0Jc3Ry
dWN0IGtpcmluX3BsYW5lIHBsYW5lc1tBREVfQ0hfTlVNXTsKLQlzdHJ1Y3QgYWRlX2h3X2N0eCAq
aHdfY3R4OwotfTsKLQotLyogYWRlLWZvcm1hdCBpbmZvOiAqLwogc3RhdGljIGNvbnN0IHN0cnVj
dCBraXJpbl9mb3JtYXQgYWRlX2Zvcm1hdHNbXSA9IHsKIAkvKiAxNmJwcCBSR0I6ICovCiAJeyBE
Uk1fRk9STUFUX1JHQjU2NSwgQURFX1JHQl81NjUgfSwKQEAgLTU3MSwzNiArNTY0LDYgQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBhZGVfY3J0Y19mdW5jcyA9IHsKIAkuZGlz
YWJsZV92YmxhbmsJPSBhZGVfY3J0Y19kaXNhYmxlX3ZibGFuaywKIH07CiAKLXN0YXRpYyBpbnQg
a2lyaW5fZHJtX2NydGNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMsCi0JCQkgICAgICAgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCi0JCQkgICAgICAg
Y29uc3Qgc3RydWN0IGtpcmluX2RybV9kYXRhICpkcml2ZXJfZGF0YSkKLXsKLQlzdHJ1Y3QgZGV2
aWNlX25vZGUgKnBvcnQ7Ci0JaW50IHJldDsKLQotCS8qIHNldCBjcnRjIHBvcnQgc28gdGhhdAot
CSAqIGRybV9vZl9maW5kX3Bvc3NpYmxlX2NydGNzIGNhbGwgd29ya3MKLQkgKi8KLQlwb3J0ID0g
b2ZfZ2V0X2NoaWxkX2J5X25hbWUoZGV2LT5kZXYtPm9mX25vZGUsICJwb3J0Iik7Ci0JaWYgKCFw
b3J0KSB7Ci0JCURSTV9FUlJPUigibm8gcG9ydCBub2RlIGZvdW5kIGluICVwT0ZcbiIsIGRldi0+
ZGV2LT5vZl9ub2RlKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCW9mX25vZGVfcHV0KHBvcnQp
OwotCWNydGMtPnBvcnQgPSBwb3J0OwotCi0JcmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3BsYW5l
cyhkZXYsIGNydGMsIHBsYW5lLCBOVUxMLAotCQkJCQlkcml2ZXJfZGF0YS0+Y3J0Y19mdW5jcywg
TlVMTCk7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0IGNydGMuXG4i
KTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0KLQlkcm1fY3J0Y19oZWxwZXJfYWRkKGNydGMsIGRyaXZl
cl9kYXRhLT5jcnRjX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIHZv
aWQgYWRlX3JkbWFfc2V0KHZvaWQgX19pb21lbSAqYmFzZSwgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsCiAJCQkgdTMyIGNoLCB1MzIgeSwgdTMyIGluX2gsIHUzMiBmbXQpCiB7CkBAIC04OTMs
MjggKzg1Niw2IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIGFkZV9wbGFuZV9mdW5j
cyA9IHsKIAkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9k
ZXN0cm95X3N0YXRlLAogfTsKIAotc3RhdGljIGludCBraXJpbl9kcm1fcGxhbmVfaW5pdChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJCXN0cnVjdCBraXJpbl9wbGFuZSAqa3BsYW5lLAotCQkJ
CWVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSwKLQkJCQljb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2Rh
dGEgKmRyaXZlcl9kYXRhKQotewotCWludCByZXQgPSAwOwotCi0JcmV0ID0gZHJtX3VuaXZlcnNh
bF9wbGFuZV9pbml0KGRldiwgJmtwbGFuZS0+YmFzZSwgMSwKLQkJCQkgICAgICAgZHJpdmVyX2Rh
dGEtPnBsYW5lX2Z1bmNzLAotCQkJCSAgICAgICBkcml2ZXJfZGF0YS0+Y2hhbm5lbF9mb3JtYXRz
LAotCQkJCSAgICAgICBkcml2ZXJfZGF0YS0+Y2hhbm5lbF9mb3JtYXRzX2NudCwKLQkJCQkgICAg
ICAgTlVMTCwgdHlwZSwgTlVMTCk7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoImZhaWwgdG8g
aW5pdCBwbGFuZSwgY2g9JWRcbiIsIGtwbGFuZS0+Y2gpOwotCQlyZXR1cm4gcmV0OwotCX0KLQot
CWRybV9wbGFuZV9oZWxwZXJfYWRkKCZrcGxhbmUtPmJhc2UsIGRyaXZlcl9kYXRhLT5wbGFuZV9o
ZWxwZXJfZnVuY3MpOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkICphZGVfaHdfY3R4
X2FsbG9jKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCiAJCQkJCQkJICBzdHJ1Y3QgZHJt
X2NydGMgKmNydGMpCiB7CkBAIC05ODQsNzEgKzkyNSwxMCBAQCBzdGF0aWMgdm9pZCAqYWRlX2h3
X2N0eF9hbGxvYyhzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAogCXJldHVybiBjdHg7CiB9
CiAKLXN0YXRpYyBpbnQgYWRlX2RybV9pbml0KHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYp
Ci17Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHBsYXRmb3JtX2dldF9kcnZkYXRhKHBkZXYp
OwotCXN0cnVjdCBhZGVfZGF0YSAqYWRlOwotCXN0cnVjdCBhZGVfaHdfY3R4ICpjdHg7Ci0Jc3Ry
dWN0IGtpcmluX2NydGMgKmtjcnRjOwotCXN0cnVjdCBraXJpbl9wbGFuZSAqa3BsYW5lOwotCWVu
dW0gZHJtX3BsYW5lX3R5cGUgdHlwZTsKLQlpbnQgcmV0OwotCXUzMiBjaDsKLQotCWFkZSA9IGRl
dm1fa3phbGxvYyhkZXYtPmRldiwgc2l6ZW9mKCphZGUpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWFk
ZSkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxvYyBhZGVfZGF0YVxuIik7Ci0JCXJldHVy
biAtRU5PTUVNOwotCX0KLQotCWN0eCA9IGFkZV9kcml2ZXJfZGF0YS5hbGxvY19od19jdHgocGRl
diwgJmFkZS0+Y3J0Yy5iYXNlKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJRFJNX0VSUk9SKCJm
YWlsZWQgdG8gaW5pdGlhbGl6ZSBraXJpbl9wcml2IGh3IGN0eFxuIik7Ci0JCXJldHVybiAtRUlO
VkFMOwotCX0KLQlhZGUtPmh3X2N0eCA9IGN0eDsKLQotCWtjcnRjID0gJmFkZS0+Y3J0YzsKLQlr
Y3J0Yy0+aHdfY3R4ID0gY3R4OwotCi0JLyoKLQkgKiBwbGFuZSBpbml0Ci0JICogVE9ETzogTm93
IG9ubHkgc3VwcG9ydCBwcmltYXJ5IHBsYW5lLCBvdmVybGF5IHBsYW5lcwotCSAqIG5lZWQgdG8g
ZG8uCi0JICovCi0JZm9yIChjaCA9IDA7IGNoIDwgYWRlX2RyaXZlcl9kYXRhLm51bV9wbGFuZXM7
IGNoKyspIHsKLQkJa3BsYW5lID0gJmFkZS0+cGxhbmVzW2NoXTsKLQkJa3BsYW5lLT5jaCA9IGNo
OwotCQlrcGxhbmUtPmh3X2N0eCA9IGN0eDsKLQotCQlpZiAoY2ggPT0gYWRlX2RyaXZlcl9kYXRh
LnByaW1fcGxhbmUpCi0JCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWTsKLQkJZWxzZQot
CQkJdHlwZSA9IERSTV9QTEFORV9UWVBFX09WRVJMQVk7Ci0KLQkJcmV0ID0ga2lyaW5fZHJtX3Bs
YW5lX2luaXQoZGV2LCBrcGxhbmUsIHR5cGUsICZhZGVfZHJpdmVyX2RhdGEpOwotCQlpZiAocmV0
KQotCQkJcmV0dXJuIHJldDsKLQl9Ci0KLQkvKiBjcnRjIGluaXQgKi8KLQlyZXQgPSBraXJpbl9k
cm1fY3J0Y19pbml0KGRldiwgJmtjcnRjLT5iYXNlLAotCQkJCSZhZGUtPnBsYW5lc1thZGVfZHJp
dmVyX2RhdGEucHJpbV9wbGFuZV0uYmFzZSwKLQkJCQkmYWRlX2RyaXZlcl9kYXRhKTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkIGFkZV9o
d19jdHhfY2xlYW51cCh2b2lkICpod19jdHgpCiB7CiB9CiAKLXN0YXRpYyB2b2lkIGFkZV9kcm1f
Y2xlYW51cChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQotewotfQotCiBzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBhZGVfbW9kZV9jb25maWdfZnVuY3MgPSB7
CiAJLmZiX2NyZWF0ZSA9IGRybV9nZW1fZmJfY3JlYXRlLAogCS5hdG9taWNfY2hlY2sgPSBkcm1f
YXRvbWljX2hlbHBlcl9jaGVjaywKQEAgLTEwOTYsNyArOTc2LDQgQEAgc3RydWN0IGtpcmluX2Ry
bV9kYXRhIGFkZV9kcml2ZXJfZGF0YSA9IHsKIAogCS5hbGxvY19od19jdHggPSBhZGVfaHdfY3R4
X2FsbG9jLAogCS5jbGVhbnVwX2h3X2N0eCA9IGFkZV9od19jdHhfY2xlYW51cCwKLQotCS5pbml0
ID0gYWRlX2RybV9pbml0LAotCS5jbGVhbnVwID0gYWRlX2RybV9jbGVhbnVwCiB9OwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuYwppbmRleCA4NDIx
NWY5ZGM5ODUuLjI1NzUwNzZkNjM4YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2ls
aWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNv
bi9raXJpbi9raXJpbl9kcm1fZHJ2LmMKQEAgLTI5LDYgKzI5LDEzMCBAQAogCiAjaW5jbHVkZSAi
a2lyaW5fZHJtX2Rydi5oIgogCisjZGVmaW5lIEtJUklOX01BWF9QTEFORQkyCisKK3N0cnVjdCBr
aXJpbl9kcm1fcHJpdmF0ZSB7CisJc3RydWN0IGtpcmluX2NydGMgY3J0YzsKKwlzdHJ1Y3Qga2ly
aW5fcGxhbmUgcGxhbmVzW0tJUklOX01BWF9QTEFORV07CisJdm9pZCAqaHdfY3R4OworfTsKKwor
c3RhdGljIGludCBraXJpbl9kcm1fY3J0Y19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0
cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQlj
b25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRhKQoreworCXN0cnVjdCBkZXZp
Y2Vfbm9kZSAqcG9ydDsKKwlpbnQgcmV0OworCisJLyogc2V0IGNydGMgcG9ydCBzbyB0aGF0CisJ
ICogZHJtX29mX2ZpbmRfcG9zc2libGVfY3J0Y3MgY2FsbCB3b3JrcworCSAqLworCXBvcnQgPSBv
Zl9nZXRfY2hpbGRfYnlfbmFtZShkZXYtPmRldi0+b2Zfbm9kZSwgInBvcnQiKTsKKwlpZiAoIXBv
cnQpIHsKKwkJRFJNX0VSUk9SKCJubyBwb3J0IG5vZGUgZm91bmQgaW4gJXBPRlxuIiwgZGV2LT5k
ZXYtPm9mX25vZGUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJb2Zfbm9kZV9wdXQocG9ydCk7
CisJY3J0Yy0+cG9ydCA9IHBvcnQ7CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhfcGxhbmVz
KGRldiwgY3J0YywgcGxhbmUsIE5VTEwsCisJCQkJCWRyaXZlcl9kYXRhLT5jcnRjX2Z1bmNzLCBO
VUxMKTsKKwlpZiAocmV0KSB7CisJCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXQgY3J0Yy5cbiIp
OworCQlyZXR1cm4gcmV0OworCX0KKworCWRybV9jcnRjX2hlbHBlcl9hZGQoY3J0YywgZHJpdmVy
X2RhdGEtPmNydGNfaGVscGVyX2Z1bmNzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IGtpcmluX2RybV9wbGFuZV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1f
cGxhbmUgKnBsYW5lLAorCQkJCWVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSwKKwkJCQljb25zdCBz
dHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRhdGEpCit7CisJaW50IHJldCA9IDA7CisKKwlyZXQgPSBk
cm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoZGV2LCBwbGFuZSwgMSwgZGF0YS0+cGxhbmVfZnVuY3Ms
CisJCQkJZGF0YS0+Y2hhbm5lbF9mb3JtYXRzLAorCQkJCWRhdGEtPmNoYW5uZWxfZm9ybWF0c19j
bnQsCisJCQkJTlVMTCwgdHlwZSwgTlVMTCk7CisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoImZh
aWwgdG8gaW5pdCBwbGFuZSwgY2g9JWRcbiIsIDApOworCQlyZXR1cm4gcmV0OworCX0KKworCWRy
bV9wbGFuZV9oZWxwZXJfYWRkKHBsYW5lLCBkYXRhLT5wbGFuZV9oZWxwZXJfZnVuY3MpOworCisJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGtpcmluX2RybV9wcml2YXRlX2NsZWFudXAoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3Qga2lyaW5fZHJtX3ByaXZhdGUgKmtpcmlu
X3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZGF0YTsK
KworCWRhdGEgPSAoc3RydWN0IGtpcmluX2RybV9kYXRhICopb2ZfZGV2aWNlX2dldF9tYXRjaF9k
YXRhKGRldi0+ZGV2KTsKKwlpZiAoZGF0YS0+Y2xlYW51cF9od19jdHgpCisJCWRhdGEtPmNsZWFu
dXBfaHdfY3R4KGtpcmluX3ByaXYtPmh3X2N0eCk7CisKKwlkZXZtX2tmcmVlKGRldi0+ZGV2LCBr
aXJpbl9wcml2KTsKKwlkZXYtPmRldl9wcml2YXRlID0gTlVMTDsKK30KKworc3RhdGljIGludCBr
aXJpbl9kcm1fcHJpdmF0ZV9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJY29uc3Qg
c3RydWN0IGtpcmluX2RybV9kYXRhICpkcml2ZXJfZGF0YSkKK3sKKwlzdHJ1Y3QgcGxhdGZvcm1f
ZGV2aWNlICpwZGV2ID0gdG9fcGxhdGZvcm1fZGV2aWNlKGRldi0+ZGV2KTsKKwlzdHJ1Y3Qga2ly
aW5fZHJtX3ByaXZhdGUgKmtpcmluX3ByaXY7CisJc3RydWN0IGRybV9wbGFuZSAqcHJpbV9wbGFu
ZTsKKwllbnVtIGRybV9wbGFuZV90eXBlIHR5cGU7CisJdm9pZCAqY3R4OworCWludCByZXQ7CisJ
dTMyIGNoOworCisJa2lyaW5fcHJpdiA9IGRldm1fa3phbGxvYyhkZXYtPmRldiwgc2l6ZW9mKCpr
aXJpbl9wcml2KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFraXJpbl9wcml2KSB7CisJCURSTV9FUlJP
UigiZmFpbGVkIHRvIGFsbG9jIGtpcmluX2RybV9wcml2YXRlXG4iKTsKKwkJcmV0dXJuIC1FTk9N
RU07CisJfQorCisJY3R4ID0gZHJpdmVyX2RhdGEtPmFsbG9jX2h3X2N0eChwZGV2LCAma2lyaW5f
cHJpdi0+Y3J0Yy5iYXNlKTsKKwlpZiAoSVNfRVJSKGN0eCkpIHsKKwkJRFJNX0VSUk9SKCJmYWls
ZWQgdG8gaW5pdGlhbGl6ZSBraXJpbl9wcml2IGh3IGN0eFxuIik7CisJCXJldHVybiAtRUlOVkFM
OworCX0KKwlraXJpbl9wcml2LT5od19jdHggPSBjdHg7CisKKwkvKgorCSAqIHBsYW5lIGluaXQK
KwkgKiBUT0RPOiBOb3cgb25seSBzdXBwb3J0IHByaW1hcnkgcGxhbmUsIG92ZXJsYXkgcGxhbmVz
CisJICogbmVlZCB0byBkby4KKwkgKi8KKwlmb3IgKGNoID0gMDsgY2ggPCBkcml2ZXJfZGF0YS0+
bnVtX3BsYW5lczsgY2grKykgeworCQlpZiAoY2ggPT0gZHJpdmVyX2RhdGEtPnByaW1fcGxhbmUp
CisJCQl0eXBlID0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWTsKKwkJZWxzZQorCQkJdHlwZSA9IERS
TV9QTEFORV9UWVBFX09WRVJMQVk7CisJCXJldCA9IGtpcmluX2RybV9wbGFuZV9pbml0KGRldiwg
JmtpcmluX3ByaXYtPnBsYW5lc1tjaF0uYmFzZSwKKwkJCQkJICAgdHlwZSwgZHJpdmVyX2RhdGEp
OworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwkJa2lyaW5fcHJpdi0+cGxhbmVzW2NoXS5j
aCA9IGNoOworCQlraXJpbl9wcml2LT5wbGFuZXNbY2hdLmh3X2N0eCA9IGN0eDsKKwl9CisKKwkv
KiBjcnRjIGluaXQgKi8KKwlwcmltX3BsYW5lID0gJmtpcmluX3ByaXYtPnBsYW5lc1tkcml2ZXJf
ZGF0YS0+cHJpbV9wbGFuZV0uYmFzZTsKKwlyZXQgPSBraXJpbl9kcm1fY3J0Y19pbml0KGRldiwg
JmtpcmluX3ByaXYtPmNydGMuYmFzZSwKKwkJCQkgIHByaW1fcGxhbmUsIGRyaXZlcl9kYXRhKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCWtpcmluX3ByaXYtPmNydGMuaHdfY3R4ID0gY3R4
OworCWRldi0+ZGV2X3ByaXZhdGUgPSBraXJpbl9wcml2OworCisJcmV0dXJuIDA7Cit9CiAKIHN0
YXRpYyBpbnQga2lyaW5fZHJtX2ttc19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJ
Y29uc3Qgc3RydWN0IGtpcmluX2RybV9kYXRhICpkcml2ZXJfZGF0YSkKQEAgLTQ0LDcgKzE2OCw3
IEBAIHN0YXRpYyBpbnQga2lyaW5fZHJtX2ttc19pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJZGV2LT5tb2RlX2NvbmZpZy5mdW5jcyA9IGRyaXZlcl9kYXRhLT5tb2RlX2NvbmZpZ19mdW5j
czsKIAogCS8qIGRpc3BsYXkgY29udHJvbGxlciBpbml0ICovCi0JcmV0ID0gZHJpdmVyX2RhdGEt
PmluaXQodG9fcGxhdGZvcm1fZGV2aWNlKGRldi0+ZGV2KSk7CisJcmV0ID0ga2lyaW5fZHJtX3By
aXZhdGVfaW5pdChkZXYsIGRyaXZlcl9kYXRhKTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9tb2Rl
X2NvbmZpZ19jbGVhbnVwOwogCkBAIC01Miw3ICsxNzYsNyBAQCBzdGF0aWMgaW50IGtpcmluX2Ry
bV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXJldCA9IGNvbXBvbmVudF9iaW5k
X2FsbChkZXYtPmRldiwgZGV2KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiZmFpbGVkIHRv
IGJpbmQgYWxsIGNvbXBvbmVudC5cbiIpOwotCQlnb3RvIGVycl9kY19jbGVhbnVwOworCQlnb3Rv
IGVycl9wcml2YXRlX2NsZWFudXA7CiAJfQogCiAJLyogdmJsYW5rIGluaXQgKi8KQEAgLTc0LDEx
ICsxOTgsMTAgQEAgc3RhdGljIGludCBraXJpbl9kcm1fa21zX2luaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAogZXJyX3VuYmluZF9hbGw6CiAJY29tcG9uZW50X3VuYmluZF9hbGwoZGV2LT5k
ZXYsIGRldik7Ci1lcnJfZGNfY2xlYW51cDoKLQlkcml2ZXJfZGF0YS0+Y2xlYW51cCh0b19wbGF0
Zm9ybV9kZXZpY2UoZGV2LT5kZXYpKTsKK2Vycl9wcml2YXRlX2NsZWFudXA6CisJa2lyaW5fZHJt
X3ByaXZhdGVfY2xlYW51cChkZXYpOwogZXJyX21vZGVfY29uZmlnX2NsZWFudXA6CiAJZHJtX21v
ZGVfY29uZmlnX2NsZWFudXAoZGV2KTsKLQogCXJldHVybiByZXQ7CiB9CiAKQEAgLTg5LDE0ICsy
MTIsOCBAQCBzdGF0aWMgaW50IGNvbXBhcmVfb2Yoc3RydWN0IGRldmljZSAqZGV2LCB2b2lkICpk
YXRhKQogCiBzdGF0aWMgaW50IGtpcmluX2RybV9rbXNfY2xlYW51cChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2KQogewotCWNvbnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGE7Ci0K
IAlkcm1fa21zX2hlbHBlcl9wb2xsX2ZpbmkoZGV2KTsKLQotCWRyaXZlcl9kYXRhID0gb2ZfZGV2
aWNlX2dldF9tYXRjaF9kYXRhKGRldi0+ZGV2KTsKLQlpZiAoZHJpdmVyX2RhdGEtPmNsZWFudXAp
Ci0JCWRyaXZlcl9kYXRhLT5jbGVhbnVwKHRvX3BsYXRmb3JtX2RldmljZShkZXYtPmRldikpOwot
CisJa2lyaW5fZHJtX3ByaXZhdGVfY2xlYW51cChkZXYpOwogCWRybV9tb2RlX2NvbmZpZ19jbGVh
bnVwKGRldik7CiAKIAlyZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9r
aXJpbi9raXJpbl9kcm1fZHJ2LmgKaW5kZXggMTY2MzYxMGQyY2Q4Li40ZDVjMDVhMjQwNjUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5oCkBA
IC03LDggKzcsNiBAQAogI2lmbmRlZiBfX0tJUklOX0RSTV9EUlZfSF9fCiAjZGVmaW5lIF9fS0lS
SU5fRFJNX0RSVl9IX18KIAotI2RlZmluZSBNQVhfQ1JUQwkyCi0KICNkZWZpbmUgdG9fa2lyaW5f
Y3J0YyhjcnRjKSBcCiAJY29udGFpbmVyX29mKGNydGMsIHN0cnVjdCBraXJpbl9jcnRjLCBiYXNl
KQogCkBAIC01Myw5ICs1MSw2IEBAIHN0cnVjdCBraXJpbl9kcm1fZGF0YSB7CiAJdm9pZCAqKCph
bGxvY19od19jdHgpKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYsCiAJCQkgICAgICBzdHJ1
Y3QgZHJtX2NydGMgKmNydGMpOwogCXZvaWQgKCpjbGVhbnVwX2h3X2N0eCkodm9pZCAqaHdfY3R4
KTsKLQotCWludCAoKmluaXQpKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpOwotCXZvaWQg
KCpjbGVhbnVwKShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKIH07CiAKIGV4dGVybiBz
dHJ1Y3Qga2lyaW5fZHJtX2RhdGEgYWRlX2RyaXZlcl9kYXRhOwotLSAKMi4xNy4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
