Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 73F135FD3C
	for <lists+dri-devel@lfdr.de>; Thu,  4 Jul 2019 21:06:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A74706E3BC;
	Thu,  4 Jul 2019 19:06:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM04-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr700077.outbound.protection.outlook.com [40.107.70.77])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 57D066E3B5;
 Thu,  4 Jul 2019 19:06:25 +0000 (UTC)
Received: from BN8PR12CA0034.namprd12.prod.outlook.com (2603:10b6:408:60::47)
 by BN6PR12MB1841.namprd12.prod.outlook.com (2603:10b6:404:103::7)
 with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2032.20; Thu, 4 Jul
 2019 19:06:23 +0000
Received: from DM3NAM03FT017.eop-NAM03.prod.protection.outlook.com
 (2a01:111:f400:7e49::205) by BN8PR12CA0034.outlook.office365.com
 (2603:10b6:408:60::47) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.2008.16 via Frontend
 Transport; Thu, 4 Jul 2019 19:06:23 +0000
Received-SPF: None (protection.outlook.com: amd.com does not designate
 permitted sender hosts)
Received: from SATLEXCHOV02.amd.com (165.204.84.17) by
 DM3NAM03FT017.mail.protection.outlook.com (10.152.82.201) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384) id
 15.20.2052.18 via Frontend Transport; Thu, 4 Jul 2019 19:06:22 +0000
Received: from localhost.localdomain (10.180.168.240) by SATLEXCHOV02.amd.com
 (10.181.40.72) with Microsoft SMTP Server id 14.3.389.1;
 Thu, 4 Jul 2019 14:06:20 -0500
From: <sunpeng.li@amd.com>
To: <amd-gfx@lists.freedesktop.org>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH 02/10] drm/dp_mst: Enable registration of AUX devices for MST
 ports (v2)
Date: Thu, 4 Jul 2019 15:05:11 -0400
Message-ID: <20190704190519.29525-3-sunpeng.li@amd.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190704190519.29525-1-sunpeng.li@amd.com>
References: <20190704190519.29525-1-sunpeng.li@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-Forefront-Antispam-Report: CIP:165.204.84.17; IPV:NLI; CTRY:US; EFV:NLI;
 SFV:NSPM;
 SFS:(10009020)(4636009)(39860400002)(376002)(136003)(396003)(346002)(2980300002)(428003)(199004)(189003)(5820100001)(14444005)(6666004)(356004)(47776003)(478600001)(86362001)(2876002)(305945005)(1076003)(66574012)(30864003)(8676002)(446003)(53936002)(81156014)(81166006)(72206003)(426003)(70586007)(26005)(54906003)(126002)(5660300002)(186003)(50226002)(2906002)(316002)(77096007)(11346002)(68736007)(76176011)(8936002)(2616005)(50466002)(486006)(4326008)(70206006)(476003)(2870700001)(36756003)(110136005)(49486002)(336012)(23676004);
 DIR:OUT; SFP:1101; SCL:1; SRVR:BN6PR12MB1841; H:SATLEXCHOV02.amd.com; FPR:;
 SPF:None; LANG:en; PTR:InfoDomainNonexistent; A:1; MX:1; 
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: 4f6a9037-9bb2-4a91-ae02-08d700b2b4c2
X-Microsoft-Antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(2017052603328);
 SRVR:BN6PR12MB1841; 
X-MS-TrafficTypeDiagnostic: BN6PR12MB1841:
X-Microsoft-Antispam-PRVS: <BN6PR12MB18413D038808A10B287ED23682FA0@BN6PR12MB1841.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:565;
X-Forefront-PRVS: 0088C92887
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam-Message-Info: Dw0Zp9cFYE76wnzWWnzJ5ltSNVyBjF+09L17Xypm6IwevuRs2QKMXLGv1pCGaGAq3CHRMTVsKIKuduCeUZcTngLOldalOgsIH5bIRiJjft6Wl36j8PtNKIQ1hjuZR29zzVkVWS6njZJdom5AUcJRc8PmNZm7Dmk4urVNP8gijBd625NKfHQZZcIuz1xASaQs3e/xr6uVYCHslBgDGjapodF2qNeMA/2NbwFB3o/0YkDgBwH4UNBiyCxuYds0aUKAzULZQt6gDm8h1YaZ+QHB+rX3VoQsm/5ofqc2jh0bBj1zc+qSnZ1NsAccOBDP6Mag4+CsCEmc7cbv6RlLs+c0hCVzqguJIEr4AfJGEtlJyT0LctoGaPX11r8DwpkUiGdEVxVuVaEI7JRsWuXdxEaZkA65KM6N6LD5NTcxI0xb04U=
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 04 Jul 2019 19:06:22.9978 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: 4f6a9037-9bb2-4a91-ae02-08d700b2b4c2
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXCHOV02.amd.com]
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN6PR12MB1841
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=amdcloud.onmicrosoft.com; s=selector1-amdcloud-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=GTC40i4FZU3T/3m/CLPNPaYFYQqHCxwtxIHRT8Sfijg=;
 b=mEW3o1DoIA98+xxogSJJtrYS05k6dc0Vhjo7vW20w01ZIUol0XMetl6mx7nV6zYOlPiQjxqokNbKHrzF3TmRYpditVCrKQ3RF4JLy0DvqYkuMekK7KmbVI4Qk7Cu7hR3zk+UQnXWzOOXrsa5n+uLWZ7Xog7nOggr7/935y5hS8E=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is
 165.204.84.17)
 smtp.mailfrom=amd.com; redhat.com; dkim=none (message not signed)
 header.d=none;redhat.com; dmarc=permerror action=none header.from=amd.com;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Leo Li <sunpeng.li@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkFs
bCBhdmFpbGFibGUgZG93bnN0cmVhbSBwb3J0cyAtIHBoeXNpY2FsIGFuZCBsb2dpY2FsIC0gYXJl
IGV4cG9zZWQgZm9yCmVhY2ggTVNUIGRldmljZS4gVGhleSBhcmUgbGlzdGVkIGluIC9kZXYvLCBm
b2xsb3dpbmcgdGhlIHNhbWUgbmFtaW5nCnNjaGVtZSBhcyBTU1QgZGV2aWNlcyBieSBhcHBlbmRp
bmcgYW4gaW5jcmVtZW50YWwgSUQuCgpBbHRob3VnaCBhbGwgZG93bnN0cmVhbSBwb3J0cyBhcmUg
ZXhwb3NlZCwgb25seSBzb21lIHdpbGwgd29yayBhcwpleHBlY3RlZC4gQ29uc2lkZXIgdGhlIGZv
bGxvd2luZyB0b3BvbG9neToKCiAgICAgICAgICAgICAgICstLS0tLS0tLS0rCiAgICAgICAgICAg
ICAgIHwgIEFTSUMgICB8CiAgICAgICAgICAgICAgICstLS0tLS0tLS0rCiAgICAgICAgICAgICAg
Q29ubi0wfAogICAgICAgICAgICAgICAgICAgIHwKICAgICAgICAgICAgICAgKy0tLS12LS0tLSsK
ICAgICAgICAgICstLS0tfCBNU1QgSFVCIHwtLS0tKwogICAgICAgICAgfCAgICArLS0tLS0tLS0t
KyAgICB8CiAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgIHwKICAgICAgICAgIHxQb3J0LTEg
ICAgICAgUG9ydC0yfAogICAgKy0tLS0tdi0tLS0tKyAgICAgICArLS0tLS12LS0tLS0rCiAgICB8
ICBNU1QgICAgICB8ICAgICAgIHwgIFNTVCAgICAgIHwKICAgIHwgIERpc3BsYXkgIHwgICAgICAg
fCAgRGlzcGxheSAgfAogICAgKy0tLS0tLS0tLS0tKyAgICAgICArLS0tLS0tLS0tLS0rCiAgICAg
ICAgICB8UG9ydC0xCiAgICAgICAgICB4CgogTVNUIFBhdGggIHwgTVNUIERldmljZQogLS0tLS0t
LS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBzc3Q6MCAgICAgfCBNU1Qg
SHViCiBtc3Q6MC0xICAgfCBNU1QgRGlzcGxheQogbXN0OjAtMS0xIHwgTVNUIERpc3BsYXkncyBk
aXNjb25uZWN0ZWQgRFAgb3V0CiBtc3Q6MC0xLTggfCBNU1QgRGlzcGxheSdzIGludGVybmFsIHNp
bmsKIG1zdDowLTIgICB8IFNTVCBEaXNwbGF5CgpPbiBjZXJ0YWluIE1TVCBkaXNwbGF5cywgdGhl
IHVwc3RyZWFtIHBoeXNpY2FsIHBvcnQgd2lsbCBBQ0sgRFBDRCByZWFkcy4KSG93ZXZlciwgcmVh
ZHMgb24gdGhlIGxvY2FsIGxvZ2ljYWwgcG9ydCB0byB0aGUgaW50ZXJuYWwgc2luayB3aWxsCipO
QUsqLiBpLmUuIHJlYWRpbmcgbXN0OjAtMSBBQ0tzLCBidXQgbXN0OjAtMS04IE5BS3MuCgpUaGVy
ZSBtYXkgYWxzbyBiZSBkdXBsaWNhdGVzLiBTb21lIGRpc3BsYXlzIHdpbGwgcmV0dXJuIHRoZSBz
YW1lIEdVSUQKd2hlbiByZWFkaW5nIERQQ0QgZnJvbSBib3RoIG1zdDowLTEgYW5kIG1zdDowLTEt
OC4KClRoZXJlIGFyZSBzb21lIGRldmljZS1kZXBlbmRlbnQgYmVoYXZpb3IgYXMgd2VsbC4gVGhl
IE1TVCBodWIgdXNlZApkdXJpbmcgdGVzdGluZyB3aWxsIGFjdHVhbGx5ICpBQ0sqIHJlYWQgcmVx
dWVzdHMgb24gYSBkaXNjb25uZWN0ZWQKcGh5c2ljYWwgcG9ydCwgd2hlcmVhcyB0aGUgTVNUIGRp
c3BsYXlzIHdpbGwgTkFLLgoKSW4gbGlnaHQgb2YgdGhlc2UgZGlzY3JlcGFuY2llcywgaXQncyBz
aW1wbGVyIHRvIGV4cG9zZSBhbGwgZG93bnN0cmVhbQpwb3J0cyAtIGJvdGggcGh5c2ljYWwgYW5k
IGxvZ2ljYWwgLSBhbmQgbGV0IHRoZSB1c2VyIGRlY2lkZSB3aGF0IHRvIHVzZS4KCih2MikgY2hh
bmdlczoKCk1vdmVkIHJlbW90ZSBhdXggZGV2aWNlICh1bilyZWdpc3RyYXRpb24gdG8gbmV3IG1z
dCBjb25uZWN0b3IgbGF0ZQpyZWdpc3RlciBhbmQgZWFybHkgdW5yZWdpc3RlciBoZWxwZXJzLiBE
cml2ZXJzIHNob3VsZCBjYWxsIHRoZXNlIGZyb20KdGhlaXIgb3duIG1zdCBjb25uZWN0b3IgZnVu
Y3Rpb24gaG9va3MuCgpUaGlzIGlzIHRvIHNvbHZlIGFuIGlzc3VlIGR1cmluZyBkcml2ZXIgdW5s
b2FkLCB3aGVyZSBtc3QgY29ubmVjdG9yCmRldmljZXMgYXJlIHVucmVnaXN0ZXJlZCBiZWZvcmUg
dGhlIHJlbW90ZSBhdXggZGV2aWNlcyBhcmUuIEluIGEgc2V0dXAKd2hlcmUgYXV4IGRldmljZXMg
YXJlIGNyZWF0ZWQgYXMgY2hpbGRyZW4gb2YgY29ubmVjdG9yIGRldmljZXMsIHRoZSBhdXgKZGV2
aWNlIHdvdWxkIGJlIHJlbW92ZWQgdG9vIGVhcmx5LCBhbmQgdW5jbGVhbmx5LiBEb2luZyBzbyBp
bgplYXJseV91bnJlZ2lzdGVyIHNvbHZlcyB0aGlzIGlzc3VlLCBhcyB0aGF0IGlzIGNhbGxlZCBi
ZWZvcmUgY29ubmVjdG9yCnVucmVnaXN0cmF0aW9uLgoKU2lnbmVkLW9mZi1ieTogVmlsbGUgU3ly
asOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTGVv
IExpIDxzdW5wZW5nLmxpQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9kcF9hdXhf
ZGV2LmMgICAgICB8ICAxNiArKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5
LmMgfCAxMzcgKysrKysrKysrKysrKysrKysrKysrKysrLS0KIGluY2x1ZGUvZHJtL2RybV9kcF9o
ZWxwZXIuaCAgICAgICAgICAgfCAgIDQgKwogaW5jbHVkZS9kcm0vZHJtX2RwX21zdF9oZWxwZXIu
aCAgICAgICB8ICAxMSArKysKIDQgZmlsZXMgY2hhbmdlZCwgMTU2IGluc2VydGlvbnMoKyksIDEy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfYXV4X2Rl
di5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9kcF9hdXhfZGV2LmMKaW5kZXggMjZlMzhkYWNmNjU0
Li40YWE1ZTQ1NWU4OTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfYXV4X2Rl
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfYXV4X2Rldi5jCkBAIC0zNyw2ICszNyw3
IEBACiAKICNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2RwX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHBfbXN0X2hlbHBlci5oPgogI2luY2x1ZGUgPGRy
bS9kcm1fcHJpbnQuaD4KIAogI2luY2x1ZGUgImRybV9jcnRjX2hlbHBlcl9pbnRlcm5hbC5oIgpA
QCAtMTE2LDYgKzExNyw3IEBAIHN0YXRpYyBzc2l6ZV90IG5hbWVfc2hvdyhzdHJ1Y3QgZGV2aWNl
ICpkZXYsCiAKIAlyZXR1cm4gcmVzOwogfQorCiBzdGF0aWMgREVWSUNFX0FUVFJfUk8obmFtZSk7
CiAKIHN0YXRpYyBzdHJ1Y3QgYXR0cmlidXRlICpkcm1fZHBfYXV4X2F0dHJzW10gPSB7CkBAIC0x
NjIsNyArMTY0LDEyIEBAIHN0YXRpYyBzc2l6ZV90IGF1eGRldl9yZWFkX2l0ZXIoc3RydWN0IGtp
b2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIgKnRvKQogCQkJYnJlYWs7CiAJCX0KIAotCQlyZXMg
PSBkcm1fZHBfZHBjZF9yZWFkKGF1eF9kZXYtPmF1eCwgcG9zLCBidWYsIHRvZG8pOworCQlpZiAo
YXV4X2Rldi0+YXV4LT5pc19yZW1vdGUpCisJCQlyZXMgPSBkcm1fZHBfbXN0X2RwY2RfcmVhZChh
dXhfZGV2LT5hdXgsIHBvcywgYnVmLAorCQkJCQkJICAgdG9kbyk7CisJCWVsc2UKKwkJCXJlcyA9
IGRybV9kcF9kcGNkX3JlYWQoYXV4X2Rldi0+YXV4LCBwb3MsIGJ1ZiwgdG9kbyk7CisKIAkJaWYg
KHJlcyA8PSAwKQogCQkJYnJlYWs7CiAKQEAgLTIwOSw3ICsyMTYsMTIgQEAgc3RhdGljIHNzaXpl
X3QgYXV4ZGV2X3dyaXRlX2l0ZXIoc3RydWN0IGtpb2NiICppb2NiLCBzdHJ1Y3QgaW92X2l0ZXIg
KmZyb20pCiAJCQlicmVhazsKIAkJfQogCi0JCXJlcyA9IGRybV9kcF9kcGNkX3dyaXRlKGF1eF9k
ZXYtPmF1eCwgcG9zLCBidWYsIHRvZG8pOworCQlpZiAoYXV4X2Rldi0+YXV4LT5pc19yZW1vdGUp
CisJCQlyZXMgPSBkcm1fZHBfbXN0X2RwY2Rfd3JpdGUoYXV4X2Rldi0+YXV4LCBwb3MsIGJ1ZiwK
KwkJCQkJCSAgICB0b2RvKTsKKwkJZWxzZQorCQkJcmVzID0gZHJtX2RwX2RwY2Rfd3JpdGUoYXV4
X2Rldi0+YXV4LCBwb3MsIGJ1ZiwgdG9kbyk7CisKIAkJaWYgKHJlcyA8PSAwKQogCQkJYnJlYWs7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5LmMgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5jCmluZGV4IDA5ODRiOWEzNGQ1NS4u
ZGRlNzljNDRiNjI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3Bv
bG9neS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5LmMKQEAgLTM2
LDYgKzM2LDggQEAKICNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CiAjaW5jbHVkZSA8ZHJtL2Ry
bV9wcm9iZV9oZWxwZXIuaD4KIAorI2luY2x1ZGUgImRybV9jcnRjX2hlbHBlcl9pbnRlcm5hbC5o
IgorCiAvKioKICAqIERPQzogZHAgbXN0IGhlbHBlcgogICoKQEAgLTUzLDYgKzU1LDkgQEAgc3Rh
dGljIGludCBkcm1fZHBfZHBjZF93cml0ZV9wYXlsb2FkKHN0cnVjdCBkcm1fZHBfbXN0X3RvcG9s
b2d5X21nciAqbWdyLAogCQkJCSAgICAgaW50IGlkLAogCQkJCSAgICAgc3RydWN0IGRybV9kcF9w
YXlsb2FkICpwYXlsb2FkKTsKIAorc3RhdGljIGludCBkcm1fZHBfc2VuZF9kcGNkX3JlYWQoc3Ry
dWN0IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCisJCQkJIHN0cnVjdCBkcm1fZHBfbXN0
X3BvcnQgKnBvcnQsCisJCQkJIGludCBvZmZzZXQsIGludCBzaXplLCB1OCAqYnl0ZXMpOwogc3Rh
dGljIGludCBkcm1fZHBfc2VuZF9kcGNkX3dyaXRlKHN0cnVjdCBkcm1fZHBfbXN0X3RvcG9sb2d5
X21nciAqbWdyLAogCQkJCSAgc3RydWN0IGRybV9kcF9tc3RfcG9ydCAqcG9ydCwKIAkJCQkgIGlu
dCBvZmZzZXQsIGludCBzaXplLCB1OCAqYnl0ZXMpOwpAQCAtMTIzOCw2ICsxMjQzLDkgQEAgc3Rh
dGljIHZvaWQgZHJtX2RwX2Rlc3Ryb3lfcG9ydChzdHJ1Y3Qga3JlZiAqa3JlZikKIAlzdHJ1Y3Qg
ZHJtX2RwX21zdF90b3BvbG9neV9tZ3IgKm1nciA9IHBvcnQtPm1ncjsKIAogCWlmICghcG9ydC0+
aW5wdXQpIHsKKworCQlwb3J0LT52Y3BpLm51bV9zbG90cyA9IDA7CisKIAkJa2ZyZWUocG9ydC0+
Y2FjaGVkX2VkaWQpOwogCiAJCS8qCkBAIC0xNDgzLDYgKzE0OTEsNDggQEAgc3RhdGljIGJvb2wg
ZHJtX2RwX3BvcnRfc2V0dXBfcGR0KHN0cnVjdCBkcm1fZHBfbXN0X3BvcnQgKnBvcnQpCiAJcmV0
dXJuIHNlbmRfbGluazsKIH0KIAorLyoqCisgKiBkcm1fZHBfbXN0X2RwY2RfcmVhZCgpIC0gcmVh
ZCBhIHNlcmllcyBvZiBieXRlcyBmcm9tIHRoZSBEUENEIHZpYSBzaWRlYmFuZAorICogQGF1eDog
RmFrZSBzaWRlYmFuZCBBVVggQ0gKKyAqIEBvZmZzZXQ6IGFkZHJlc3Mgb2YgdGhlIChmaXJzdCkg
cmVnaXN0ZXIgdG8gcmVhZAorICogQGJ1ZmZlcjogYnVmZmVyIHRvIHN0b3JlIHRoZSByZWdpc3Rl
ciB2YWx1ZXMKKyAqIEBzaXplOiBudW1iZXIgb2YgYnl0ZXMgaW4gQGJ1ZmZlcgorICoKKyAqIFBl
cmZvcm1zIHRoZSBzYW1lIGZ1bmN0aW9uYWxpdHkgZm9yIHJlbW90ZSBkZXZpY2VzIHZpYQorICog
c2lkZWJhbmQgbWVzc2FnaW5nIGFzIGRybV9kcF9kcGNkX3JlYWQoKSBkb2VzIGZvciBsb2NhbAor
ICogZGV2aWNlcyB2aWEgYWN0dWFsIEFVWCBDSC4KKyAqLworc3NpemVfdCBkcm1fZHBfbXN0X2Rw
Y2RfcmVhZChzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LAorCQkJICAgICB1bnNpZ25lZCBpbnQgb2Zm
c2V0LCB2b2lkICpidWZmZXIsIHNpemVfdCBzaXplKQoreworCXN0cnVjdCBkcm1fZHBfbXN0X3Bv
cnQgKnBvcnQgPSBjb250YWluZXJfb2YoYXV4LCBzdHJ1Y3QgZHJtX2RwX21zdF9wb3J0LAorCQkJ
CQkJICAgIGF1eCk7CisKKwlyZXR1cm4gZHJtX2RwX3NlbmRfZHBjZF9yZWFkKHBvcnQtPm1nciwg
cG9ydCwKKwkJCQkgICAgIG9mZnNldCwgc2l6ZSwgYnVmZmVyKTsKK30KKworLyoqCisgKiBkcm1f
ZHBfbXN0X2RwY2Rfd3JpdGUoKSAtIHdyaXRlIGEgc2VyaWVzIG9mIGJ5dGVzIHRvIHRoZSBEUENE
IHZpYSBzaWRlYmFuZAorICogQGF1eDogRmFrZSBzaWRlYmFuZCBBVVggQ0gKKyAqIEBvZmZzZXQ6
IGFkZHJlc3Mgb2YgdGhlIChmaXJzdCkgcmVnaXN0ZXIgdG8gd3JpdGUKKyAqIEBidWZmZXI6IGJ1
ZmZlciBjb250YWluaW5nIHRoZSB2YWx1ZXMgdG8gd3JpdGUKKyAqIEBzaXplOiBudW1iZXIgb2Yg
Ynl0ZXMgaW4gQGJ1ZmZlcgorICoKKyAqIFBlcmZvcm1zIHRoZSBzYW1lIGZ1bmN0aW9uYWxpdHkg
Zm9yIHJlbW90ZSBkZXZpY2VzIHZpYQorICogc2lkZWJhbmQgbWVzc2FnaW5nIGFzIGRybV9kcF9k
cGNkX3dyaXRlKCkgZG9lcyBmb3IgbG9jYWwKKyAqIGRldmljZXMgdmlhIGFjdHVhbCBBVVggQ0gu
CisgKi8KK3NzaXplX3QgZHJtX2RwX21zdF9kcGNkX3dyaXRlKHN0cnVjdCBkcm1fZHBfYXV4ICph
dXgsCisJCQkgICAgICB1bnNpZ25lZCBpbnQgb2Zmc2V0LCB2b2lkICpidWZmZXIsIHNpemVfdCBz
aXplKQoreworCXN0cnVjdCBkcm1fZHBfbXN0X3BvcnQgKnBvcnQgPSBjb250YWluZXJfb2YoYXV4
LCBzdHJ1Y3QgZHJtX2RwX21zdF9wb3J0LAorCQkJCQkJICAgIGF1eCk7CisKKwlyZXR1cm4gZHJt
X2RwX3NlbmRfZHBjZF93cml0ZShwb3J0LT5tZ3IsIHBvcnQsCisJCQkJICAgICAgb2Zmc2V0LCBz
aXplLCBidWZmZXIpOworfQorCiBzdGF0aWMgdm9pZCBkcm1fZHBfY2hlY2tfbXN0Yl9ndWlkKHN0
cnVjdCBkcm1fZHBfbXN0X2JyYW5jaCAqbXN0YiwgdTggKmd1aWQpCiB7CiAJaW50IHJldDsKQEAg
LTE1MjYsNiArMTU3Niw0NCBAQCBzdGF0aWMgdm9pZCBidWlsZF9tc3RfcHJvcF9wYXRoKGNvbnN0
IHN0cnVjdCBkcm1fZHBfbXN0X2JyYW5jaCAqbXN0YiwKIAlzdHJsY2F0KHByb3BwYXRoLCB0ZW1w
LCBwcm9wcGF0aF9zaXplKTsKIH0KIAorLyoqCisgKiBkcm1fZHBfbXN0X2Nvbm5lY3Rvcl9sYXRl
X3JlZ2lzdGVyKCkgLSBMYXRlIE1TVCBjb25uZWN0b3IgcmVnaXN0cmF0aW9uCisgKiBAZHJtX2Nv
bm5lY3RvcjogVGhlIE1TVCBjb25uZWN0b3IKKyAqIEBwb3J0OiBUaGUgTVNUIHBvcnQgZm9yIHRo
aXMgY29ubmVjdG9yCisgKgorICogSGVscGVyIHRvIHJlZ2lzdGVyIHRoZSByZW1vdGUgYXV4IGRl
dmljZSBmb3IgdGhpcyBNU1QgcG9ydC4gRHJpdmVycyBzaG91bGQKKyAqIGNhbGwgdGhpcyBmcm9t
IHRoZWlyIG1zdCBjb25uZWN0b3IncyBsYXRlX3JlZ2lzdGVyIGhvb2sgdG8gZW5hYmxlIE1TVCBh
dXgKKyAqIGRldmljZXMuCisgKi8KK2ludCBkcm1fZHBfbXN0X2Nvbm5lY3Rvcl9sYXRlX3JlZ2lz
dGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgIHN0cnVjdCBk
cm1fZHBfbXN0X3BvcnQgKnBvcnQpCit7CisJRFJNX0RFQlVHX0tNUygicmVnaXN0ZXJpbmcgJXMg
cmVtb3RlIGJ1cyBmb3IgJXNcbiIsCisJCSAgICAgIHBvcnQtPmF1eC5uYW1lLCBjb25uZWN0b3It
PmtkZXYtPmtvYmoubmFtZSk7CisKKwlwb3J0LT5hdXguZGV2ID0gY29ubmVjdG9yLT5rZGV2Owor
CXJldHVybiBkcm1fZHBfYXV4X3JlZ2lzdGVyX2Rldm5vZGUoJnBvcnQtPmF1eCk7Cit9CitFWFBP
UlRfU1lNQk9MKGRybV9kcF9tc3RfY29ubmVjdG9yX2xhdGVfcmVnaXN0ZXIpOworCisvKioKKyAq
IGRybV9kcF9tc3RfY29ubmVjdG9yX2Vhcmx5X3VucmVnaXN0ZXIoKSAtIEVhcmx5IE1TVCBjb25u
ZWN0b3IgdW5yZWdpc3RyYXRpb24KKyAqIEBkcm1fY29ubmVjdG9yOiBUaGUgTVNUIGNvbm5lY3Rv
cgorICogQHBvcnQ6IFRoZSBNU1QgcG9ydCBmb3IgdGhpcyBjb25uZWN0b3IKKyAqCisgKiBIZWxw
ZXIgdG8gdW5yZWdpc3RlciB0aGUgcmVtb3RlIGF1eCBkZXZpY2UgZm9yIHRoaXMgTVNUIHBvcnQs
IHJlZ2lzdGVyZWQgYnkKKyAqIGRybV9kcF9tc3RfY29ubmVjdG9yX2xhdGVfcmVnaXN0ZXIoKS4g
RHJpdmVycyBzaG91bGQgY2FsbCB0aGlzIGZyb20gdGhlaXIgbXN0CisgKiBjb25uZWN0b3IncyBl
YXJseV91bnJlZ2lzdGVyIGhvb2suCisgKi8KK3ZvaWQgZHJtX2RwX21zdF9jb25uZWN0b3JfZWFy
bHlfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCQkgICBz
dHJ1Y3QgZHJtX2RwX21zdF9wb3J0ICpwb3J0KQoreworCURSTV9ERUJVR19LTVMoInVucmVnaXN0
ZXJpbmcgJXMgcmVtb3RlIGJ1cyBmb3IgJXNcbiIsCisJCSAgICAgIHBvcnQtPmF1eC5uYW1lLCBj
b25uZWN0b3ItPmtkZXYtPmtvYmoubmFtZSk7CisJZHJtX2RwX2F1eF91bnJlZ2lzdGVyX2Rldm5v
ZGUoJnBvcnQtPmF1eCk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9kcF9tc3RfY29ubmVjdG9yX2Vh
cmx5X3VucmVnaXN0ZXIpOworCiBzdGF0aWMgdm9pZCBkcm1fZHBfYWRkX3BvcnQoc3RydWN0IGRy
bV9kcF9tc3RfYnJhbmNoICptc3RiLAogCQkJICAgIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
CQkgICAgc3RydWN0IGRybV9kcF9saW5rX2FkZHJfcmVwbHlfcG9ydCAqcG9ydF9tc2cpCkBAIC0x
NTQ4LDYgKzE2MzYsNyBAQCBzdGF0aWMgdm9pZCBkcm1fZHBfYWRkX3BvcnQoc3RydWN0IGRybV9k
cF9tc3RfYnJhbmNoICptc3RiLAogCQlwb3J0LT5tZ3IgPSBtc3RiLT5tZ3I7CiAJCXBvcnQtPmF1
eC5uYW1lID0gIkRQTVNUIjsKIAkJcG9ydC0+YXV4LmRldiA9IGRldi0+ZGV2OworCQlwb3J0LT5h
dXguaXNfcmVtb3RlID0gdHJ1ZTsKIAogCQkvKgogCQkgKiBNYWtlIHN1cmUgdGhlIG1lbW9yeSBh
bGxvY2F0aW9uIGZvciBvdXIgcGFyZW50IGJyYW5jaCBzdGF5cwpAQCAtMTgxNiw3ICsxOTA1LDYg
QEAgc3RhdGljIGJvb2wgZHJtX2RwX3ZhbGlkYXRlX2d1aWQoc3RydWN0IGRybV9kcF9tc3RfdG9w
b2xvZ3lfbWdyICptZ3IsCiAJcmV0dXJuIGZhbHNlOwogfQogCi0jaWYgMAogc3RhdGljIGludCBi
dWlsZF9kcGNkX3JlYWQoc3RydWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfdHggKm1zZywgdTggcG9y
dF9udW0sIHUzMiBvZmZzZXQsIHU4IG51bV9ieXRlcykKIHsKIAlzdHJ1Y3QgZHJtX2RwX3NpZGVi
YW5kX21zZ19yZXFfYm9keSByZXE7CkBAIC0xODI5LDcgKzE5MTcsNiBAQCBzdGF0aWMgaW50IGJ1
aWxkX2RwY2RfcmVhZChzdHJ1Y3QgZHJtX2RwX3NpZGViYW5kX21zZ190eCAqbXNnLCB1OCBwb3J0
X251bSwgdTMyCiAKIAlyZXR1cm4gMDsKIH0KLSNlbmRpZgogCiBzdGF0aWMgaW50IGRybV9kcF9z
ZW5kX3NpZGViYW5kX21zZyhzdHJ1Y3QgZHJtX2RwX21zdF90b3BvbG9neV9tZ3IgKm1nciwKIAkJ
CQkgICAgYm9vbCB1cCwgdTggKm1zZywgaW50IGxlbikKQEAgLTI0NDEsMjYgKzI1MjgsNTYgQEAg
aW50IGRybV9kcF91cGRhdGVfcGF5bG9hZF9wYXJ0MihzdHJ1Y3QgZHJtX2RwX21zdF90b3BvbG9n
eV9tZ3IgKm1ncikKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2RwX3VwZGF0ZV9wYXlsb2FkX3BhcnQy
KTsKIAotI2lmIDAgLyogdW51c2VkIGFzIG9mIHlldCAqLwogc3RhdGljIGludCBkcm1fZHBfc2Vu
ZF9kcGNkX3JlYWQoc3RydWN0IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCiAJCQkJIHN0
cnVjdCBkcm1fZHBfbXN0X3BvcnQgKnBvcnQsCi0JCQkJIGludCBvZmZzZXQsIGludCBzaXplKQor
CQkJCSBpbnQgb2Zmc2V0LCBpbnQgc2l6ZSwgdTggKmJ5dGVzKQogewogCWludCBsZW47CisJaW50
IHJldCA9IDA7CiAJc3RydWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfdHggKnR4bXNnOworCXN0cnVj
dCBkcm1fZHBfbXN0X2JyYW5jaCAqbXN0YjsKKworCW1zdGIgPSBkcm1fZHBfbXN0X3RvcG9sb2d5
X2dldF9tc3RiX3ZhbGlkYXRlZChtZ3IsIHBvcnQtPnBhcmVudCk7CisJaWYgKCFtc3RiKQorCQly
ZXR1cm4gLUVJTlZBTDsKIAogCXR4bXNnID0ga3phbGxvYyhzaXplb2YoKnR4bXNnKSwgR0ZQX0tF
Uk5FTCk7Ci0JaWYgKCF0eG1zZykKLQkJcmV0dXJuIC1FTk9NRU07CisJaWYgKCF0eG1zZykgewor
CQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGZhaWxfcHV0OworCX0KIAotCWxlbiA9IGJ1aWxkX2Rw
Y2RfcmVhZCh0eG1zZywgcG9ydC0+cG9ydF9udW0sIDAsIDgpOworCWxlbiA9IGJ1aWxkX2RwY2Rf
cmVhZCh0eG1zZywgcG9ydC0+cG9ydF9udW0sIG9mZnNldCwgc2l6ZSk7CiAJdHhtc2ctPmRzdCA9
IHBvcnQtPnBhcmVudDsKIAogCWRybV9kcF9xdWV1ZV9kb3duX3R4KG1nciwgdHhtc2cpOwogCi0J
cmV0dXJuIDA7CisJcmV0ID0gZHJtX2RwX21zdF93YWl0X3R4X3JlcGx5KG1zdGIsIHR4bXNnKTsK
KwlpZiAocmV0IDwgMCkKKwkJZ290byBmYWlsX2ZyZWU7CisKKwkvKiBEUENEIHJlYWQgc2hvdWxk
IG5ldmVyIGJlIE5BQ0tlZCAqLworCWlmIChXQVJOX09OX09OQ0UodHhtc2ctPnJlcGx5LnJlcGx5
X3R5cGUgPT0gMSkpIHsKKwkJcmV0ID0gLUVJTzsKKwkJZ290byBmYWlsX2ZyZWU7CisJfQorCisJ
aWYgKHR4bXNnLT5yZXBseS51LnJlbW90ZV9kcGNkX3JlYWRfYWNrLm51bV9ieXRlcyAhPSBzaXpl
KSB7CisJCXJldCA9IC1FUFJPVE87CisJCWdvdG8gZmFpbF9mcmVlOworCX0KKworCXJldCA9IG1p
bl90KHNpemVfdCwgdHhtc2ctPnJlcGx5LnUucmVtb3RlX2RwY2RfcmVhZF9hY2subnVtX2J5dGVz
LAorCQkgICAgc2l6ZSk7CisJbWVtY3B5KGJ5dGVzLCB0eG1zZy0+cmVwbHkudS5yZW1vdGVfZHBj
ZF9yZWFkX2Fjay5ieXRlcywgcmV0KTsKKworZmFpbF9mcmVlOgorCWtmcmVlKHR4bXNnKTsKK2Zh
aWxfcHV0OgorCWRybV9kcF9tc3RfdG9wb2xvZ3lfcHV0X21zdGIobXN0Yik7CisKKwlyZXR1cm4g
cmV0OwogfQotI2VuZGlmCiAKIHN0YXRpYyBpbnQgZHJtX2RwX3NlbmRfZHBjZF93cml0ZShzdHJ1
Y3QgZHJtX2RwX21zdF90b3BvbG9neV9tZ3IgKm1nciwKIAkJCQkgIHN0cnVjdCBkcm1fZHBfbXN0
X3BvcnQgKnBvcnQsCkBAIC0yNDg5LDcgKzI2MDYsNyBAQCBzdGF0aWMgaW50IGRybV9kcF9zZW5k
X2RwY2Rfd3JpdGUoc3RydWN0IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCiAJcmV0ID0g
ZHJtX2RwX21zdF93YWl0X3R4X3JlcGx5KG1zdGIsIHR4bXNnKTsKIAlpZiAocmV0ID4gMCkgewog
CQlpZiAodHhtc2ctPnJlcGx5LnJlcGx5X3R5cGUgPT0gRFBfU0lERUJBTkRfUkVQTFlfTkFLKQot
CQkJcmV0ID0gLUVJTlZBTDsKKwkJCXJldCA9IC1FSU87CiAJCWVsc2UKIAkJCXJldCA9IDA7CiAJ
fQpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2RwX2hlbHBlci5oIGIvaW5jbHVkZS9kcm0v
ZHJtX2RwX2hlbHBlci5oCmluZGV4IDM5Nzg5NmI1YjIxYS4uY2IyZGVmYWNlOTUwIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2RybS9kcm1fZHBfaGVscGVyLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2Rw
X2hlbHBlci5oCkBAIC0xMzA5LDYgKzEzMDksMTAgQEAgc3RydWN0IGRybV9kcF9hdXggewogCSAq
IEBjZWM6IHN0cnVjdCBjb250YWluaW5nIGZpZWxkcyB1c2VkIGZvciBDRUMtVHVubmVsaW5nLW92
ZXItQVVYLgogCSAqLwogCXN0cnVjdCBkcm1fZHBfYXV4X2NlYyBjZWM7CisJLyoqCisJICogQGlz
X3JlbW90ZTogSXMgdGhpcyAiQVVYIENIIiBhY3R1YWxseSB1c2luZyBzaWRlYmFuZCBtZXNzYWdp
bmcuCisJICovCisJYm9vbCBpc19yZW1vdGU7CiB9OwogCiBzc2l6ZV90IGRybV9kcF9kcGNkX3Jl
YWQoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgdW5zaWduZWQgaW50IG9mZnNldCwKZGlmZiAtLWdp
dCBhL2luY2x1ZGUvZHJtL2RybV9kcF9tc3RfaGVscGVyLmggYi9pbmNsdWRlL2RybS9kcm1fZHBf
bXN0X2hlbHBlci5oCmluZGV4IDhjOTdhNWY5MmM0Ny4uMmJhNjI1M2VhNmQzIDEwMDY0NAotLS0g
YS9pbmNsdWRlL2RybS9kcm1fZHBfbXN0X2hlbHBlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9k
cF9tc3RfaGVscGVyLmgKQEAgLTY0Myw2ICs2NDMsMTcgQEAgdm9pZCBkcm1fZHBfbXN0X2R1bXBf
dG9wb2xvZ3koc3RydWN0IHNlcV9maWxlICptLAogdm9pZCBkcm1fZHBfbXN0X3RvcG9sb2d5X21n
cl9zdXNwZW5kKHN0cnVjdCBkcm1fZHBfbXN0X3RvcG9sb2d5X21nciAqbWdyKTsKIGludCBfX211
c3RfY2hlY2sKIGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyX3Jlc3VtZShzdHJ1Y3QgZHJtX2RwX21z
dF90b3BvbG9neV9tZ3IgKm1ncik7CisKK3NzaXplX3QgZHJtX2RwX21zdF9kcGNkX3JlYWQoc3Ry
dWN0IGRybV9kcF9hdXggKmF1eCwKKwkJCSAgICAgdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAq
YnVmZmVyLCBzaXplX3Qgc2l6ZSk7Citzc2l6ZV90IGRybV9kcF9tc3RfZHBjZF93cml0ZShzdHJ1
Y3QgZHJtX2RwX2F1eCAqYXV4LAorCQkJICAgICAgdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAq
YnVmZmVyLCBzaXplX3Qgc2l6ZSk7CisKK2ludCBkcm1fZHBfbXN0X2Nvbm5lY3Rvcl9sYXRlX3Jl
Z2lzdGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgIHN0cnVj
dCBkcm1fZHBfbXN0X3BvcnQgKnBvcnQpOwordm9pZCBkcm1fZHBfbXN0X2Nvbm5lY3Rvcl9lYXJs
eV91bnJlZ2lzdGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCSAgIHN0
cnVjdCBkcm1fZHBfbXN0X3BvcnQgKnBvcnQpOworCiBzdHJ1Y3QgZHJtX2RwX21zdF90b3BvbG9n
eV9zdGF0ZSAqZHJtX2F0b21pY19nZXRfbXN0X3RvcG9sb2d5X3N0YXRlKHN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpzdGF0ZSwKIAkJCQkJCQkJICAgIHN0cnVjdCBkcm1fZHBfbXN0X3RvcG9sb2d5
X21nciAqbWdyKTsKIGludCBfX211c3RfY2hlY2sKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApk
cmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
