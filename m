Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5EE8F3463FD
	for <lists+dri-devel@lfdr.de>; Tue, 23 Mar 2021 16:58:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7B65D6EC19;
	Tue, 23 Mar 2021 15:58:01 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5BD7F6EC15
 for <dri-devel@lists.freedesktop.org>; Tue, 23 Mar 2021 15:57:44 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v9 10/70] drm/i915: make lockdep slightly happier about
 execbuf.
Date: Tue, 23 Mar 2021 16:49:59 +0100
Message-Id: <20210323155059.628690-11-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.31.0
In-Reply-To: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
References: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QXMgc29vbiBhcyB3ZSBpbnN0YWxsIGZlbmNlcywgd2Ugc2hvdWxkIHN0b3AgYWxsb2NhdGluZyBt
ZW1vcnkKaW4gb3JkZXIgdG8gcHJldmVudCBhbnkgcG90ZW50aWFsIGRlYWRsb2Nrcy4KClRoaXMg
aXMgcmVxdWlyZWQgbGF0ZXIgb24sIHdoZW4gd2Ugc3RhcnQgYWRkaW5nIHN1cHBvcnQgZm9yCmRt
YS1mZW5jZSBhbm5vdGF0aW9ucy4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxt
YWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBUaG9tYXMgSGVs
bHN0csO2bSA8dGhvbWFzLmhlbGxzdHJvbUBsaW51eC5pbnRlbC5jb20+Ci0tLQogLi4uL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgMjQgKysrKysrKysrKysrKyst
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyAgICAgICAgICAgIHwgMjAg
KysrKysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAg
ICAgICAgIHwgIDggKysrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAg
ICAgICAgICAgIHwgIDMgKysrCiA0IGZpbGVzIGNoYW5nZWQsIDM2IGluc2VydGlvbnMoKyksIDE5
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jCmluZGV4IDFjNmQwZDkyNzAxZi4uM2MzN2E4NWMwZDlkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTUwLDExICs1MCwx
MiBAQCBlbnVtIHsKICNkZWZpbmUgREJHX0ZPUkNFX1JFTE9DIDAgLyogY2hvb3NlIG9uZSBvZiB0
aGUgYWJvdmUhICovCiB9OwogCi0jZGVmaW5lIF9fRVhFQ19PQkpFQ1RfSEFTX1BJTgkJQklUKDMx
KQotI2RlZmluZSBfX0VYRUNfT0JKRUNUX0hBU19GRU5DRQkJQklUKDMwKQotI2RlZmluZSBfX0VY
RUNfT0JKRUNUX05FRURTX01BUAkJQklUKDI5KQotI2RlZmluZSBfX0VYRUNfT0JKRUNUX05FRURT
X0JJQVMJQklUKDI4KQotI2RlZmluZSBfX0VYRUNfT0JKRUNUX0lOVEVSTkFMX0ZMQUdTCSh+MHUg
PDwgMjgpIC8qIGFsbCBvZiB0aGUgYWJvdmUgKi8KKy8qIF9fRVhFQ19PQkpFQ1RfTk9fUkVTRVJW
RSBpcyBCSVQoMzEpLCBkZWZpbmVkIGluIGk5MTVfdm1hLmggKi8KKyNkZWZpbmUgX19FWEVDX09C
SkVDVF9IQVNfUElOCQlCSVQoMzApCisjZGVmaW5lIF9fRVhFQ19PQkpFQ1RfSEFTX0ZFTkNFCQlC
SVQoMjkpCisjZGVmaW5lIF9fRVhFQ19PQkpFQ1RfTkVFRFNfTUFQCQlCSVQoMjgpCisjZGVmaW5l
IF9fRVhFQ19PQkpFQ1RfTkVFRFNfQklBUwlCSVQoMjcpCisjZGVmaW5lIF9fRVhFQ19PQkpFQ1Rf
SU5URVJOQUxfRkxBR1MJKH4wdSA8PCAyNykgLyogYWxsIG9mIHRoZSBhYm92ZSArICovCiAjZGVm
aW5lIF9fRVhFQ19PQkpFQ1RfUkVTRVJWRUQgKF9fRVhFQ19PQkpFQ1RfSEFTX1BJTiB8IF9fRVhF
Q19PQkpFQ1RfSEFTX0ZFTkNFKQogCiAjZGVmaW5lIF9fRVhFQ19IQVNfUkVMT0MJQklUKDMxKQpA
QCAtOTM1LDYgKzkzNiwxMiBAQCBzdGF0aWMgaW50IGViX3ZhbGlkYXRlX3ZtYXMoc3RydWN0IGk5
MTVfZXhlY2J1ZmZlciAqZWIpCiAJCQl9CiAJCX0KIAorCQlpZiAoIShldi0+ZmxhZ3MgJiBFWEVD
X09CSkVDVF9XUklURSkpIHsKKwkJCWVyciA9IGRtYV9yZXN2X3Jlc2VydmVfc2hhcmVkKHZtYS0+
cmVzdiwgMSk7CisJCQlpZiAoZXJyKQorCQkJCXJldHVybiBlcnI7CisJCX0KKwogCQlHRU1fQlVH
X09OKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSAmJgogCQkJICAgZWJfdm1hX21p
c3BsYWNlZCgmZWItPmV4ZWNbaV0sIHZtYSwgZXYtPmZsYWdzKSk7CiAJfQpAQCAtMjE5NSw3ICsy
MjAyLDggQEAgc3RhdGljIGludCBlYl9tb3ZlX3RvX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVy
ICplYikKIAkJfQogCiAJCWlmIChlcnIgPT0gMCkKLQkJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9f
YWN0aXZlKHZtYSwgZWItPnJlcXVlc3QsIGZsYWdzKTsKKwkJCWVyciA9IGk5MTVfdm1hX21vdmVf
dG9fYWN0aXZlKHZtYSwgZWItPnJlcXVlc3QsCisJCQkJCQkgICAgICBmbGFncyB8IF9fRVhFQ19P
QkpFQ1RfTk9fUkVTRVJWRSk7CiAJfQogCiAJaWYgKHVubGlrZWx5KGVycikpCkBAIC0yNDQ3LDYg
KzI0NTUsMTAgQEAgc3RhdGljIGludCBlYl9wYXJzZV9waXBlbGluZShzdHJ1Y3QgaTkxNV9leGVj
YnVmZmVyICplYiwKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9jb21taXQ7CiAKKwllcnIgPSBkbWFf
cmVzdl9yZXNlcnZlX3NoYXJlZChzaGFkb3ctPnJlc3YsIDEpOworCWlmIChlcnIpCisJCWdvdG8g
ZXJyX2NvbW1pdDsKKwogCS8qIFdhaXQgZm9yIGFsbCB3cml0ZXMgKGFuZCByZWxvY3MpIGludG8g
dGhlIGJhdGNoIHRvIGNvbXBsZXRlICovCiAJZXJyID0gaTkxNV9zd19mZW5jZV9hd2FpdF9yZXNl
cnZhdGlvbigmcHctPmJhc2UuY2hhaW4sCiAJCQkJCSAgICAgIHB3LT5iYXRjaC0+cmVzdiwgTlVM
TCwgZmFsc2UsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCAzYmM2MTZjYzFhZDIu
LmNmOWEzZDM4NDk3MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0yOTMsMTgg
KzI5MywxMyBAQCBzdGF0aWMgc3RydWN0IGFjdGl2ZV9ub2RlICpfX2FjdGl2ZV9sb29rdXAoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCiBzdGF0aWMgc3RydWN0IGk5MTVfYWN0aXZl
X2ZlbmNlICoKIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlk
eCkKIHsKLQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUsICpwcmVhbGxvYzsKKwlzdHJ1Y3QgYWN0
aXZlX25vZGUgKm5vZGU7CiAJc3RydWN0IHJiX25vZGUgKipwLCAqcGFyZW50OwogCiAJbm9kZSA9
IF9fYWN0aXZlX2xvb2t1cChyZWYsIGlkeCk7CiAJaWYgKGxpa2VseShub2RlKSkKIAkJcmV0dXJu
ICZub2RlLT5iYXNlOwogCi0JLyogUHJlYWxsb2NhdGUgYSByZXBsYWNlbWVudCwganVzdCBpbiBj
YXNlICovCi0JcHJlYWxsb2MgPSBrbWVtX2NhY2hlX2FsbG9jKGdsb2JhbC5zbGFiX2NhY2hlLCBH
RlBfS0VSTkVMKTsKLQlpZiAoIXByZWFsbG9jKQotCQlyZXR1cm4gTlVMTDsKLQogCXNwaW5fbG9j
a19pcnEoJnJlZi0+dHJlZV9sb2NrKTsKIAlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUo
cmVmKSk7CiAKQEAgLTMxNCwxMCArMzA5LDggQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KQogCQlwYXJlbnQgPSAqcDsKIAogCQlub2RlID0gcmJfZW50
cnkocGFyZW50LCBzdHJ1Y3QgYWN0aXZlX25vZGUsIG5vZGUpOwotCQlpZiAobm9kZS0+dGltZWxp
bmUgPT0gaWR4KSB7Ci0JCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIHByZWFs
bG9jKTsKKwkJaWYgKG5vZGUtPnRpbWVsaW5lID09IGlkeCkKIAkJCWdvdG8gb3V0OwotCQl9CiAK
IAkJaWYgKG5vZGUtPnRpbWVsaW5lIDwgaWR4KQogCQkJcCA9ICZwYXJlbnQtPnJiX3JpZ2h0OwpA
QCAtMzI1LDcgKzMxOCwxNCBAQCBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYsIHU2NCBpZHgpCiAJCQlwID0gJnBhcmVudC0+cmJfbGVmdDsKIAl9CiAKLQlub2RlID0gcHJl
YWxsb2M7CisJLyoKKwkgKiBYWFg6IFdlIHNob3VsZCBwcmVhbGxvY2F0ZSB0aGlzIGJlZm9yZSBp
OTE1X2FjdGl2ZV9yZWYoKSBpcyBldmVyCisJICogIGNhbGxlZCwgYnV0IHdlIGNhbm5vdCBjYWxs
IGludG8gZnNfcmVjbGFpbSgpIGFueXdheSwgc28gdXNlIEdGUF9BVE9NSUMuCisJICovCisJbm9k
ZSA9IGttZW1fY2FjaGVfYWxsb2MoZ2xvYmFsLnNsYWJfY2FjaGUsIEdGUF9BVE9NSUMpOworCWlm
ICghbm9kZSkKKwkJZ290byBvdXQ7CisKIAlfX2k5MTVfYWN0aXZlX2ZlbmNlX2luaXQoJm5vZGUt
PmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKIAlub2RlLT5yZWYgPSByZWY7CiAJbm9kZS0+dGlt
ZWxpbmUgPSBpZHg7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA3MzEwODkzMDg2ZjcuLjFm
ZmRhMmFhYTdhMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC0xMjQ3LDkgKzEyNDcsMTEg
QEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQlv
YmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7CiAJCW9iai0+cmVhZF9k
b21haW5zID0gMDsKIAl9IGVsc2UgewotCQllcnIgPSBkbWFfcmVzdl9yZXNlcnZlX3NoYXJlZCh2
bWEtPnJlc3YsIDEpOwotCQlpZiAodW5saWtlbHkoZXJyKSkKLQkJCXJldHVybiBlcnI7CisJCWlm
ICghKGZsYWdzICYgX19FWEVDX09CSkVDVF9OT19SRVNFUlZFKSkgeworCQkJZXJyID0gZG1hX3Jl
c3ZfcmVzZXJ2ZV9zaGFyZWQodm1hLT5yZXN2LCAxKTsKKwkJCWlmICh1bmxpa2VseShlcnIpKQor
CQkJCXJldHVybiBlcnI7CisJCX0KIAogCQlkbWFfcmVzdl9hZGRfc2hhcmVkX2ZlbmNlKHZtYS0+
cmVzdiwgJnJxLT5mZW5jZSk7CiAJCW9iai0+d3JpdGVfZG9tYWluID0gMDsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5oCmluZGV4IDNjOTE0YzlkZTlhOS4uNmI0OGY1YzQyNDg4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmgKQEAgLTUyLDYgKzUyLDkgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfdm1h
X2lzX2FjdGl2ZShjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlyZXR1cm4gIWk5MTVfYWN0
aXZlX2lzX2lkbGUoJnZtYS0+YWN0aXZlKTsKIH0KIAorLyogZG8gbm90IHJlc2VydmUgbWVtb3J5
IHRvIHByZXZlbnQgZGVhZGxvY2tzICovCisjZGVmaW5lIF9fRVhFQ19PQkpFQ1RfTk9fUkVTRVJW
RSBCSVQoMzEpCisKIGludCBfX211c3RfY2hlY2sgX19pOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJCQkJICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwog
aW50IF9fbXVzdF9jaGVjayBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwKLS0gCjIuMzEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVsCg==
