Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1B208B079A
	for <lists+dri-devel@lfdr.de>; Thu, 12 Sep 2019 06:14:40 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CA99C6E14B;
	Thu, 12 Sep 2019 04:12:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from hqemgate14.nvidia.com (hqemgate14.nvidia.com [216.228.121.143])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B94A6E0E2;
 Wed, 11 Sep 2019 22:28:53 +0000 (UTC)
Received: from hqpgpgate101.nvidia.com (Not Verified[216.228.121.13]) by
 hqemgate14.nvidia.com (using TLS: TLSv1.2, DES-CBC3-SHA)
 id <B5d7975260000>; Wed, 11 Sep 2019 15:28:54 -0700
Received: from hqmail.nvidia.com ([172.20.161.6])
 by hqpgpgate101.nvidia.com (PGP Universal service);
 Wed, 11 Sep 2019 15:28:53 -0700
X-PGP-Universal: processed;
 by hqpgpgate101.nvidia.com on Wed, 11 Sep 2019 15:28:53 -0700
Received: from HQMAIL109.nvidia.com (172.20.187.15) by HQMAIL107.nvidia.com
 (172.20.187.13) with Microsoft SMTP Server (TLS) id 15.0.1473.3; Wed, 11 Sep
 2019 22:28:52 +0000
Received: from HQMAIL111.nvidia.com (172.20.187.18) by HQMAIL109.nvidia.com
 (172.20.187.15) with Microsoft SMTP Server (TLS) id 15.0.1473.3; Wed, 11 Sep
 2019 22:28:47 +0000
Received: from hqnvemgw01.nvidia.com (172.20.150.20) by HQMAIL111.nvidia.com
 (172.20.187.18) with Microsoft SMTP Server (TLS) id 15.0.1473.3 via Frontend
 Transport; Wed, 11 Sep 2019 22:28:47 +0000
Received: from rcampbell-dev.nvidia.com (Not Verified[10.110.48.66]) by
 hqnvemgw01.nvidia.com with Trustwave SEG (v7, 5, 8, 10121)
 id <B5d79751f0000>; Wed, 11 Sep 2019 15:28:47 -0700
From: Ralph Campbell <rcampbell@nvidia.com>
To: <linux-mm@kvack.org>
Subject: [PATCH 4/4] mm/hmm/test: add self tests for HMM
Date: Wed, 11 Sep 2019 15:28:29 -0700
Message-ID: <20190911222829.28874-5-rcampbell@nvidia.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190911222829.28874-1-rcampbell@nvidia.com>
References: <20190911222829.28874-1-rcampbell@nvidia.com>
MIME-Version: 1.0
X-NVConfidentiality: public
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=nvidia.com; s=n1; 
 t=1568240934; bh=kdwaquXV9KnG7o23RUsmHkcAvBZlGcYEZX5XkWOjw+0=;
 h=X-PGP-Universal:From:To:CC:Subject:Date:Message-ID:X-Mailer:
 In-Reply-To:References:MIME-Version:X-NVConfidentiality:
 Content-Type:Content-Transfer-Encoding;
 b=YUVUKlLAQknQg43Z0S8V1a7Ls8n/PhglxXr/6gEWTZPzdDitfufgCeh2Pr8/Qq/Vz
 dl0qCviK/gOV3P8AL7ZT/Bk+LmfbHxetfY0W7nARuZe1c/xZ0WPPl6spUO0KLcSh/W
 v7pl0Q0PkXvTloCt2Wd7wQsbIAeNpC48gdm0bffUELqMoL9HK0fhg2zGhNhP051fy2
 1Ya/HqlAG4cgy+fqX3RSEmvkt13ZZof4VNO0B32E4oEkkEAyDj4hrkP5RYxLRLc9jV
 OEi77WL16PtdGvl5MsZFuTXzP4rN9qsAv8Lky3WLmxfEh4YrnkpFGkQmEVN9Xk1x9t
 2oWO7e14/HsWg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ralph Campbell <rcampbell@nvidia.com>, nouveau@lists.freedesktop.org,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 Jason Gunthorpe <jgg@mellanox.com>, amd-gfx@lists.freedesktop.org,
 Andrew Morton <akpm@linux-foundation.org>, Christoph Hellwig <hch@lst.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIHNlbGYgdGVzdHMgZm9yIEhNTS4KClNpZ25lZC1vZmYtYnk6IFJhbHBoIENhbXBiZWxsIDxy
Y2FtcGJlbGxAbnZpZGlhLmNvbT4KLS0tCiBNQUlOVEFJTkVSUyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICB8ICAgIDMgKwogZHJpdmVycy9jaGFyL0tjb25maWcgICAgICAgICAgICAgICAgICAg
fCAgIDExICsKIGRyaXZlcnMvY2hhci9NYWtlZmlsZSAgICAgICAgICAgICAgICAgIHwgICAgMSAr
CiBkcml2ZXJzL2NoYXIvaG1tX2RtaXJyb3IuYyAgICAgICAgICAgICB8IDE1MDQgKysrKysrKysr
KysrKysrKysrKysrKysrCiBpbmNsdWRlL0tidWlsZCAgICAgICAgICAgICAgICAgICAgICAgICB8
ICAgIDEgKwogaW5jbHVkZS91YXBpL2xpbnV4L2htbV9kbWlycm9yLmggICAgICAgfCAgIDc0ICsr
CiB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy92bS8uZ2l0aWdub3JlICB8ICAgIDEgKwogdG9vbHMv
dGVzdGluZy9zZWxmdGVzdHMvdm0vTWFrZWZpbGUgICAgfCAgICAzICsKIHRvb2xzL3Rlc3Rpbmcv
c2VsZnRlc3RzL3ZtL2NvbmZpZyAgICAgIHwgICAgMyArCiB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0
cy92bS9obW0tdGVzdHMuYyB8IDEzMDQgKysrKysrKysrKysrKysrKysrKysKIHRvb2xzL3Rlc3Rp
bmcvc2VsZnRlc3RzL3ZtL3J1bl92bXRlc3RzIHwgICAxNiArCiB0b29scy90ZXN0aW5nL3NlbGZ0
ZXN0cy92bS90ZXN0X2htbS5zaCB8ICAxMDUgKysKIDEyIGZpbGVzIGNoYW5nZWQsIDMwMjYgaW5z
ZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvY2hhci9obW1fZG1pcnJvci5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS91YXBpL2xpbnV4L2htbV9kbWlycm9yLmgKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCB0b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy92bS9obW0tdGVzdHMuYwog
Y3JlYXRlIG1vZGUgMTAwNzU1IHRvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL3Rlc3RfaG1tLnNo
CgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCA0MzYwNGQ2YWI5
NmMuLjhhYjI0MmQ5MTg3NiAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5F
UlMKQEAgLTczMTgsOCArNzMxOCwxMSBAQCBNOglKw6lyw7RtZSBHbGlzc2UgPGpnbGlzc2VAcmVk
aGF0LmNvbT4KIEw6CWxpbnV4LW1tQGt2YWNrLm9yZwogUzoJTWFpbnRhaW5lZAogRjoJbW0vaG1t
KgorRjoJZHJpdmVycy9jaGFyL2htbSoKIEY6CWluY2x1ZGUvbGludXgvaG1tKgorRjoJaW5jbHVk
ZS91YXBpL2xpbnV4L2htbSoKIEY6CURvY3VtZW50YXRpb24vdm0vaG1tLnJzdAorRjoJdG9vbHMv
dGVzdGluZy9zZWxmdGVzdHMvdm0vKmhtbSoKIAogSE9TVCBBUCBEUklWRVIKIE06CUpvdW5pIE1h
bGluZW4gPGpAdzEuZmk+CmRpZmYgLS1naXQgYS9kcml2ZXJzL2NoYXIvS2NvbmZpZyBiL2RyaXZl
cnMvY2hhci9LY29uZmlnCmluZGV4IDNlODY2ODg1YTQwNS4uYjRhZDg2OGVhZDYzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2NoYXIvS2NvbmZpZworKysgYi9kcml2ZXJzL2NoYXIvS2NvbmZpZwpAQCAt
NTU3LDYgKzU1NywxNyBAQCBjb25maWcgQURJCiAJICBhbmQgU1NNIChTaWxpY29uIFNlY3VyZWQg
TWVtb3J5KS4gIEludGVuZGVkIGNvbnN1bWVycyBvZiB0aGlzCiAJICBkcml2ZXIgaW5jbHVkZSBj
cmFzaCBhbmQgbWFrZWR1bXBmaWxlLgogCitjb25maWcgSE1NX0RNSVJST1IKKwl0cmlzdGF0ZSAi
SE1NIGRyaXZlciBmb3IgdGVzdGluZyBIZXRlcm9nZW5lb3VzIE1lbW9yeSBNYW5hZ2VtZW50Igor
CWRlcGVuZHMgb24gSE1NX01JUlJPUgorCWRlcGVuZHMgb24gREVWSUNFX1BSSVZBVEUKKwloZWxw
CisJICBUaGlzIGlzIGEgcHNldWRvIGRldmljZSBkcml2ZXIgc29sZWx5IGZvciB0ZXN0aW5nIEhN
TS4KKwkgIFNheSBZIGhlcmUgaWYgeW91IHdhbnQgdG8gYnVpbGQgdGhlIEhNTSB0ZXN0IGRyaXZl
ci4KKwkgIERvaW5nIHNvIHdpbGwgYWxsb3cgeW91IHRvIHJ1biB0b29scy90ZXN0aW5nL3NlbGZ0
ZXN0L3ZtL2htbS10ZXN0cy4KKworCSAgSWYgaW4gZG91YnQsIHNheSAiTiIuCisKIGVuZG1lbnUK
IAogY29uZmlnIFJBTkRPTV9UUlVTVF9DUFUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvY2hhci9NYWtl
ZmlsZSBiL2RyaXZlcnMvY2hhci9NYWtlZmlsZQppbmRleCBmYmVhN2RkMTI5MzIuLmM5ZGRkOGU1
NTBjNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9jaGFyL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvY2hh
ci9NYWtlZmlsZQpAQCAtNTQsMyArNTQsNCBAQCBqcy1ydGMteSA9IHJ0Yy5vCiBvYmotJChDT05G
SUdfWElMTFlCVVMpCQkrPSB4aWxseWJ1cy8KIG9iai0kKENPTkZJR19QT1dFUk5WX09QX1BBTkVM
KQkrPSBwb3dlcm52LW9wLXBhbmVsLm8KIG9iai0kKENPTkZJR19BREkpCQkrPSBhZGkubworb2Jq
LSQoQ09ORklHX0hNTV9ETUlSUk9SKQkrPSBobW1fZG1pcnJvci5vCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2NoYXIvaG1tX2RtaXJyb3IuYyBiL2RyaXZlcnMvY2hhci9obW1fZG1pcnJvci5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uY2NiNGUwM2EwM2I1Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9jaGFyL2htbV9kbWlycm9yLmMKQEAgLTAsMCArMSwxNTA0IEBA
CisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAy
MDEzIFJlZCBIYXQgSW5jLgorICoKKyAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5
b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKKyAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVy
bXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzCisgKiBwdWJsaXNoZWQgYnkg
dGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZgorICogdGhl
IExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCisgKgorICog
VGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1
c2VmdWwsCisgKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1w
bGllZCB3YXJyYW50eSBvZgorICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFS
VElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQorICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2Ug
Zm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiBBdXRob3JzOiBKw6lyw7RtZSBHbGlzc2UgPGpnbGlz
c2VAcmVkaGF0LmNvbT4KKyAqLworLyoKKyAqIFRoaXMgaXMgYSBkcml2ZXIgdG8gZXhlcmNpY2Ug
dGhlIEhNTSAoaGV0ZXJvZ2VuZW91cyBtZW1vcnkgbWFuYWdlbWVudCkKKyAqIG1pcnJvciBhbmQg
em9uZSBkZXZpY2UgcHJpdmF0ZSBtZW1vcnkgbWlncmF0aW9uIEFQSXMgb2YgdGhlIGtlcm5lbC4K
KyAqIFVzZXJzcGFjZSBwcm9ncmFtcyBjYW4gcmVnaXN0ZXIgd2l0aCB0aGUgZHJpdmVyIHRvIG1p
cnJvciB0aGVpciBvd24gYWRkcmVzcworICogc3BhY2UgYW5kIGNhbiB1c2UgdGhlIGRldmljZSB0
byByZWFkL3dyaXRlIGFueSB2YWxpZCB2aXJ0dWFsIGFkZHJlc3MuCisgKgorICogSW4gc29tZSB3
YXlzIGl0IGNhbiBhbHNvIHNlcnZlIGFzIGFuIGV4YW1wbGUgZHJpdmVyIGZvciBwZW9wbGUgd2Fu
dGluZyB0byB1c2UKKyAqIEhNTSBpbnNpZGUgdGhlaXIgb3duIGRldmljZSBkcml2ZXIuCisgKi8K
KyNpbmNsdWRlIDxsaW51eC9pbml0Lmg+CisjaW5jbHVkZSA8bGludXgvZnMuaD4KKyNpbmNsdWRl
IDxsaW51eC9tbS5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4
L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L2NkZXYuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZp
Y2UuaD4KKyNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgorI2luY2x1ZGUgPGxpbnV4L3J3c2VtLmg+
CisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisjaW5j
bHVkZSA8bGludXgvaGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVk
ZSA8bGludXgvcGFnZW1hcC5oPgorI2luY2x1ZGUgPGxpbnV4L2htbS5oPgorI2luY2x1ZGUgPGxp
bnV4L3ZtYWxsb2MuaD4KKyNpbmNsdWRlIDxsaW51eC9zd2FwLmg+CisjaW5jbHVkZSA8bGludXgv
c3dhcG9wcy5oPgorI2luY2x1ZGUgPGxpbnV4L3NjaGVkL21tLmg+CisjaW5jbHVkZSA8bGludXgv
cGxhdGZvcm1fZGV2aWNlLmg+CisKKyNpbmNsdWRlIDx1YXBpL2xpbnV4L2htbV9kbWlycm9yLmg+
CisKKyNkZWZpbmUgRE1JUlJPUl9OREVWSUNFUwkJMgorI2RlZmluZSBETUlSUk9SX1JBTkdFX0ZB
VUxUX1RJTUVPVVQJMTAwMAorI2RlZmluZSBERVZNRU1fQ0hVTktfU0laRQkJKDI1NiAqIDEwMjQg
KiAxMDI0VSkKKyNkZWZpbmUgREVWTUVNX0NIVU5LU19SRVNFUlZFCQkxNgorCitzdGF0aWMgY29u
c3Qgc3RydWN0IGRldl9wYWdlbWFwX29wcyBkbWlycm9yX2Rldm1lbV9vcHM7CitzdGF0aWMgZGV2
X3QgZG1pcnJvcl9kZXY7CitzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2RldmljZSAqZG1pcnJvcl9w
bGF0Zm9ybV9kZXZpY2VzW0RNSVJST1JfTkRFVklDRVNdOworc3RhdGljIHN0cnVjdCBwYWdlICpk
bWlycm9yX3plcm9fcGFnZTsKKworc3RydWN0IGRtaXJyb3JfZGV2aWNlOworCitzdHJ1Y3QgZG1p
cnJvcl9ib3VuY2UgeworCXZvaWQJCQkqcHRyOworCXVuc2lnbmVkIGxvbmcJCXNpemU7CisJdW5z
aWduZWQgbG9uZwkJYWRkcjsKKwl1bnNpZ25lZCBsb25nCQljcGFnZXM7Cit9OworCisjZGVmaW5l
IERQVF9TSElGVCBQQUdFX1NISUZUCisjZGVmaW5lIERQVF9WQUxJRCAoMVVMIDw8IDApCisjZGVm
aW5lIERQVF9XUklURSAoMVVMIDw8IDEpCisjZGVmaW5lIERQVF9EUEFHRSAoMVVMIDw8IDIpCisj
ZGVmaW5lIERQVF9aUEFHRSAweDIwVUwKKworY29uc3QgdWludDY0X3QgZG1pcnJvcl9obW1fZmxh
Z3NbSE1NX1BGTl9GTEFHX01BWF0gPSB7CisJW0hNTV9QRk5fVkFMSURdID0gRFBUX1ZBTElELAor
CVtITU1fUEZOX1dSSVRFXSA9IERQVF9XUklURSwKKwlbSE1NX1BGTl9ERVZJQ0VfUFJJVkFURV0g
PSBEUFRfRFBBR0UsCit9OworCitzdGF0aWMgY29uc3QgdWludDY0X3QgZG1pcnJvcl9obW1fdmFs
dWVzW0hNTV9QRk5fVkFMVUVfTUFYXSA9IHsKKwlbSE1NX1BGTl9OT05FXSAgICA9IDAsCisJW0hN
TV9QRk5fRVJST1JdICAgPSAweDEwLAorCVtITU1fUEZOX1NQRUNJQUxdID0gMHgyMCwJLyogYWN0
dWFsbHksIHJlYWQtb25seSB6ZXJvIHBhZ2UgKi8KK307CisKK3N0cnVjdCBkbWlycm9yX3B0IHsK
KwlhdG9taWM2NF90CQlwZ2RbUFRSU19QRVJfUEdEXTsKKwlzdHJ1Y3Qgcndfc2VtYXBob3JlCWxv
Y2s7Cit9OworCisvKgorICogRGF0YSBhdHRhY2hlZCB0byB0aGUgb3BlbiBkZXZpY2UgZmlsZS4K
KyAqIE5vdGUgdGhhdCBpdCBtaWdodCBiZSBzaGFyZWQgYWZ0ZXIgYSBmb3JrKCkuCisgKi8KK3N0
cnVjdCBkbWlycm9yIHsKKwlzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UJKm1kZXZpY2U7CisJc3RydWN0
IGhtbV9taXJyb3IJbWlycm9yOworCXN0cnVjdCBkbWlycm9yX3B0CXB0OworfTsKKworLyoKKyAq
IFpPTkVfREVWSUNFIHBhZ2VzIGZvciBtaWdyYXRpb24gYW5kIHNpbXVsYXRpbmcgZGV2aWNlIG1l
bW9yeS4KKyAqLworc3RydWN0IGRtaXJyb3JfY2h1bmsgeworCXN0cnVjdCBkZXZfcGFnZW1hcAlw
YWdlbWFwOworCXN0cnVjdCBkbWlycm9yX2RldmljZQkqbWRldmljZTsKK307CisKKy8qCisgKiBQ
ZXIgZGV2aWNlIGRhdGEuCisgKi8KK3N0cnVjdCBkbWlycm9yX2RldmljZSB7CisJc3RydWN0IGNk
ZXYJCWNkZXZpY2U7CisJc3RydWN0IGhtbV9kZXZtZW0JKmRldm1lbTsKKwlzdHJ1Y3QgcGxhdGZv
cm1fZGV2aWNlCSpwZGV2aWNlOworCisJdW5zaWduZWQgaW50CQlkZXZtZW1fY2FwYWNpdHk7CisJ
dW5zaWduZWQgaW50CQlkZXZtZW1fY291bnQ7CisJc3RydWN0IGRtaXJyb3JfY2h1bmsJKipkZXZt
ZW1fY2h1bmtzOworCXN0cnVjdCBtdXRleAkJZGV2bWVtX2xvY2s7CS8qIHByb3RlY3RzIHRoZSBh
Ym92ZSAqLworCisJdW5zaWduZWQgbG9uZwkJY2FsbG9jOworCXVuc2lnbmVkIGxvbmcJCWNmcmVl
OworCXN0cnVjdCBwYWdlCQkqZnJlZV9wYWdlczsKKwlzcGlubG9ja190CQlsb2NrOwkJLyogcHJv
dGVjdHMgdGhlIGFib3ZlICovCit9OworCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgZG1p
cnJvcl9wdF9wZ2QodW5zaWduZWQgbG9uZyBhZGRyKQoreworCXJldHVybiAoYWRkciA+PiBQR0RJ
Ul9TSElGVCkgJiAoUFRSU19QRVJfUEdEIC0gMSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdW5zaWdu
ZWQgbG9uZyBkbWlycm9yX3B0X3B1ZCh1bnNpZ25lZCBsb25nIGFkZHIpCit7CisJcmV0dXJuIChh
ZGRyID4+IFBVRF9TSElGVCkgJiAoUFRSU19QRVJfUFVEIC0gMSk7Cit9CisKK3N0YXRpYyBpbmxp
bmUgdW5zaWduZWQgbG9uZyBkbWlycm9yX3B0X3BtZCh1bnNpZ25lZCBsb25nIGFkZHIpCit7CisJ
cmV0dXJuIChhZGRyID4+IFBNRF9TSElGVCkgJiAoUFRSU19QRVJfUE1EIC0gMSk7Cit9CisKK3N0
YXRpYyBpbmxpbmUgdW5zaWduZWQgbG9uZyBkbWlycm9yX3B0X3B0ZSh1bnNpZ25lZCBsb25nIGFk
ZHIpCit7CisJcmV0dXJuIChhZGRyID4+IFBBR0VfU0hJRlQpICYgKFBUUlNfUEVSX1BURSAtIDEp
OworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBwYWdlICpkbWlycm9yX3B0X3BhZ2UoYXRvbWlj
NjRfdCAqZHB0ZXApCit7CisJczY0IGRwdGUgPSBhdG9taWM2NF9yZWFkKGRwdGVwKTsKKworCWlm
IChkcHRlID09IERQVF9aUEFHRSkKKwkJcmV0dXJuIGRtaXJyb3JfemVyb19wYWdlOworCWlmICgh
KGRwdGUgJiBEUFRfVkFMSUQpKQorCQlyZXR1cm4gTlVMTDsKKwlyZXR1cm4gcGZuX3RvX3BhZ2Uo
KHU2NClkcHRlID4+IERQVF9TSElGVCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2Ug
KmRtaXJyb3JfcHRfcGFnZV93cml0ZShhdG9taWM2NF90ICpkcHRlcCkKK3sKKwlzNjQgZHB0ZSA9
IGF0b21pYzY0X3JlYWQoZHB0ZXApOworCisJaWYgKCEoZHB0ZSAmIERQVF9WQUxJRCkgfHwgIShk
cHRlICYgRFBUX1dSSVRFKSkKKwkJcmV0dXJuIE5VTEw7CisJcmV0dXJuIHBmbl90b19wYWdlKCh1
NjQpZHB0ZSA+PiBEUFRfU0hJRlQpOworfQorCitzdGF0aWMgaW5saW5lIHM2NCBkbWlycm9yX3B0
X2Zyb21fcGFnZShzdHJ1Y3QgcGFnZSAqcGFnZSkKK3sKKwlpZiAoIXBhZ2UpCisJCXJldHVybiAw
OworCXJldHVybiAocGFnZV90b19wZm4ocGFnZSkgPDwgRFBUX1NISUZUKSB8IERQVF9WQUxJRDsK
K30KKworc3RhdGljIHN0cnVjdCBwYWdlICpwb3B1bGF0ZV9wdChhdG9taWM2NF90ICpkcHRlcCkK
K3sKKwlzdHJ1Y3QgcGFnZSAqcGFnZTsKKwlzNjQgbmV3X2RwdGU7CisJczY0IG9sZF9kcHRlOwor
CisJcGFnZSA9IGFsbG9jX3BhZ2UoR0ZQX0hJR0hVU0VSIHwgX19HRlBfWkVSTyk7CisJaWYgKHBh
Z2UpIHsKKwkJbmV3X2RwdGUgPSBkbWlycm9yX3B0X2Zyb21fcGFnZShwYWdlKTsKKwkJb2xkX2Rw
dGUgPSBhdG9taWM2NF9jbXB4Y2hnKGRwdGVwLCAwLCBuZXdfZHB0ZSk7CisJCWlmIChvbGRfZHB0
ZSkgeworCQkJX19mcmVlX3BhZ2UocGFnZSk7CisJCQlwYWdlID0gcGZuX3RvX3BhZ2UoKHU2NClv
bGRfZHB0ZSA+PiBEUFRfU0hJRlQpOworCQl9CisJfQorCXJldHVybiBwYWdlOworfQorCitzdGF0
aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgZG1pcnJvcl9wdF9wdWRfZW5kKHVuc2lnbmVkIGxvbmcg
YWRkcikKK3sKKwlyZXR1cm4gKGFkZHIgJiBQR0RJUl9NQVNLKSArICgodW5zaWduZWQgbG9uZylQ
VFJTX1BFUl9QVUQgPDwgUFVEX1NISUZUKTsKK30KKworc3RhdGljIGlubGluZSB1bnNpZ25lZCBs
b25nIGRtaXJyb3JfcHRfcG1kX2VuZCh1bnNpZ25lZCBsb25nIGFkZHIpCit7CisJcmV0dXJuIChh
ZGRyICYgUFVEX01BU0spICsgKCh1bnNpZ25lZCBsb25nKVBUUlNfUEVSX1BNRCA8PCBQTURfU0hJ
RlQpOworfQorCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgZG1pcnJvcl9wdF9wdGVfZW5k
KHVuc2lnbmVkIGxvbmcgYWRkcikKK3sKKwlyZXR1cm4gKGFkZHIgJiBQTURfTUFTSykgKyAoKHVu
c2lnbmVkIGxvbmcpUFRSU19QRVJfUFRFIDw8IFBBR0VfU0hJRlQpOworfQorCit0eXBlZGVmIGlu
dCAoKmRtaXJyb3Jfd2Fsa19jYl90KShzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciwKKwkJCQkgdW5z
aWduZWQgbG9uZyBzdGFydCwKKwkJCQkgdW5zaWduZWQgbG9uZyBlbmQsCisJCQkJIGF0b21pYzY0
X3QgKmRwdGVwLAorCQkJCSB2b2lkICpwcml2YXRlKTsKKworc3RhdGljIGludCBkbWlycm9yX3B0
X3dhbGsoc3RydWN0IGRtaXJyb3IgKmRtaXJyb3IsCisJCQkgICBkbWlycm9yX3dhbGtfY2JfdCBj
YiwKKwkJCSAgIHVuc2lnbmVkIGxvbmcgc3RhcnQsCisJCQkgICB1bnNpZ25lZCBsb25nIGVuZCwK
KwkJCSAgIHZvaWQgKnByaXZhdGUsCisJCQkgICBib29sIHBvcHVsYXRlKQoreworCWF0b21pYzY0
X3QgKmRwZ2RwID0gJmRtaXJyb3ItPnB0LnBnZFtkbWlycm9yX3B0X3BnZChzdGFydCldOworCXVu
c2lnbmVkIGxvbmcgYWRkcjsKKworCWZvciAoYWRkciA9IHN0YXJ0OyBhZGRyIDwgZW5kOyBkcGdk
cCsrKSB7CisJCWF0b21pYzY0X3QgKmRwdWRwOworCQl1bnNpZ25lZCBsb25nIHB1ZF9lbmQ7CisJ
CXN0cnVjdCBwYWdlICpwdWRfcGFnZTsKKworCQlwdWRfZW5kID0gbWluKGVuZCwgZG1pcnJvcl9w
dF9wdWRfZW5kKGFkZHIpKTsKKwkJcHVkX3BhZ2UgPSBkbWlycm9yX3B0X3BhZ2UoZHBnZHApOwor
CQlpZiAoIXB1ZF9wYWdlKSB7CisJCQlpZiAoIXBvcHVsYXRlKSB7CisJCQkJYWRkciA9IHB1ZF9l
bmQ7CisJCQkJY29udGludWU7CisJCQl9CisJCQlwdWRfcGFnZSA9IHBvcHVsYXRlX3B0KGRwZ2Rw
KTsKKwkJCWlmICghcHVkX3BhZ2UpCisJCQkJcmV0dXJuIC1FTk9NRU07CisJCX0KKwkJZHB1ZHAg
PSBrbWFwKHB1ZF9wYWdlKTsKKwkJZHB1ZHAgKz0gZG1pcnJvcl9wdF9wdWQoYWRkcik7CisJCWZv
ciAoOyBhZGRyICE9IHB1ZF9lbmQ7IGRwdWRwKyspIHsKKwkJCWF0b21pYzY0X3QgKmRwbWRwOwor
CQkJdW5zaWduZWQgbG9uZyBwbWRfZW5kOworCQkJc3RydWN0IHBhZ2UgKnBtZF9wYWdlOworCisJ
CQlwbWRfZW5kID0gbWluKGVuZCwgZG1pcnJvcl9wdF9wbWRfZW5kKGFkZHIpKTsKKwkJCXBtZF9w
YWdlID0gZG1pcnJvcl9wdF9wYWdlKGRwdWRwKTsKKwkJCWlmICghcG1kX3BhZ2UpIHsKKwkJCQlp
ZiAoIXBvcHVsYXRlKSB7CisJCQkJCWFkZHIgPSBwbWRfZW5kOworCQkJCQljb250aW51ZTsKKwkJ
CQl9CisJCQkJcG1kX3BhZ2UgPSBwb3B1bGF0ZV9wdChkcHVkcCk7CisJCQkJaWYgKCFwbWRfcGFn
ZSkgeworCQkJCQlrdW5tYXAocHVkX3BhZ2UpOworCQkJCQlyZXR1cm4gLUVOT01FTTsKKwkJCQl9
CisJCQl9CisJCQlkcG1kcCA9IGttYXAocG1kX3BhZ2UpOworCQkJZHBtZHAgKz0gZG1pcnJvcl9w
dF9wbWQoYWRkcik7CisJCQlmb3IgKDsgYWRkciAhPSBwbWRfZW5kOyBkcG1kcCsrKSB7CisJCQkJ
YXRvbWljNjRfdCAqZHB0ZXA7CisJCQkJdW5zaWduZWQgbG9uZyBwdGVfZW5kOworCQkJCXN0cnVj
dCBwYWdlICpwdGVfcGFnZTsKKwkJCQlpbnQgcmV0OworCisJCQkJcHRlX2VuZCA9IG1pbihlbmQs
IGRtaXJyb3JfcHRfcHRlX2VuZChhZGRyKSk7CisJCQkJcHRlX3BhZ2UgPSBkbWlycm9yX3B0X3Bh
Z2UoZHBtZHApOworCQkJCWlmICghcHRlX3BhZ2UpIHsKKwkJCQkJaWYgKCFwb3B1bGF0ZSkgewor
CQkJCQkJYWRkciA9IHB0ZV9lbmQ7CisJCQkJCQljb250aW51ZTsKKwkJCQkJfQorCQkJCQlwdGVf
cGFnZSA9IHBvcHVsYXRlX3B0KGRwbWRwKTsKKwkJCQkJaWYgKCFwdGVfcGFnZSkgeworCQkJCQkJ
a3VubWFwKHBtZF9wYWdlKTsKKwkJCQkJCWt1bm1hcChwdWRfcGFnZSk7CisJCQkJCQlyZXR1cm4g
LUVOT01FTTsKKwkJCQkJfQorCQkJCX0KKwkJCQlkcHRlcCA9IGttYXAocHRlX3BhZ2UpOworCQkJ
CWRwdGVwICs9IGRtaXJyb3JfcHRfcHRlKGFkZHIpOworCQkJCXJldCA9IGNiKGRtaXJyb3IsIGFk
ZHIsIHB0ZV9lbmQsIGRwdGVwLAorCQkJCQkgcHJpdmF0ZSk7CisJCQkJa3VubWFwKHB0ZV9wYWdl
KTsKKwkJCQlhZGRyID0gcHRlX2VuZDsKKwkJCQlpZiAocmV0KSB7CisJCQkJCWt1bm1hcChwbWRf
cGFnZSk7CisJCQkJCWt1bm1hcChwdWRfcGFnZSk7CisJCQkJCXJldHVybiByZXQ7CisJCQkJfQor
CQkJfQorCQkJa3VubWFwKHBtZF9wYWdlKTsKKwkJCWFkZHIgPSBwbWRfZW5kOworCQl9CisJCWt1
bm1hcChwdWRfcGFnZSk7CisJCWFkZHIgPSBwdWRfZW5kOworCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgdm9pZCBkbWlycm9yX3B0X2ZyZWUoc3RydWN0IGRtaXJyb3IgKmRtaXJyb3IpCit7
CisJYXRvbWljNjRfdCAqZHBnZHAgPSBkbWlycm9yLT5wdC5wZ2Q7CisKKwlmb3IgKDsgZHBnZHAg
IT0gZG1pcnJvci0+cHQucGdkICsgUFRSU19QRVJfUEdEOyBkcGdkcCsrKSB7CisJCWF0b21pYzY0
X3QgKmRwdWRwOworCQlhdG9taWM2NF90ICpkcHVkcF9lbmQ7CisJCXN0cnVjdCBwYWdlICpwdWRf
cGFnZTsKKworCQlwdWRfcGFnZSA9IGRtaXJyb3JfcHRfcGFnZShkcGdkcCk7CisJCWlmICghcHVk
X3BhZ2UpCisJCQljb250aW51ZTsKKworCQlkcHVkcCA9IGttYXAocHVkX3BhZ2UpOworCQlkcHVk
cF9lbmQgPSBkcHVkcCArIFBUUlNfUEVSX1BVRDsKKwkJZm9yICg7IGRwdWRwICE9IGRwdWRwX2Vu
ZDsgZHB1ZHArKykgeworCQkJYXRvbWljNjRfdCAqZHBtZHA7CisJCQlhdG9taWM2NF90ICpkcG1k
cF9lbmQ7CisJCQlzdHJ1Y3QgcGFnZSAqcG1kX3BhZ2U7CisKKwkJCXBtZF9wYWdlID0gZG1pcnJv
cl9wdF9wYWdlKGRwdWRwKTsKKwkJCWlmICghcG1kX3BhZ2UpCisJCQkJY29udGludWU7CisKKwkJ
CWRwbWRwID0ga21hcChwbWRfcGFnZSk7CisJCQlkcG1kcF9lbmQgPSBkcG1kcCArIFBUUlNfUEVS
X1BNRDsKKwkJCWZvciAoOyBkcG1kcCAhPSBkcG1kcF9lbmQ7IGRwbWRwKyspIHsKKwkJCQlzdHJ1
Y3QgcGFnZSAqcHRlX3BhZ2U7CisKKwkJCQlwdGVfcGFnZSA9IGRtaXJyb3JfcHRfcGFnZShkcG1k
cCk7CisJCQkJaWYgKCFwdGVfcGFnZSkKKwkJCQkJY29udGludWU7CisKKwkJCQlhdG9taWM2NF9z
ZXQoZHBtZHAsIDApOworCQkJCV9fZnJlZV9wYWdlKHB0ZV9wYWdlKTsKKwkJCX0KKwkJCWt1bm1h
cChwbWRfcGFnZSk7CisJCQlhdG9taWM2NF9zZXQoZHB1ZHAsIDApOworCQkJX19mcmVlX3BhZ2Uo
cG1kX3BhZ2UpOworCQl9CisJCWt1bm1hcChwdWRfcGFnZSk7CisJCWF0b21pYzY0X3NldChkcGdk
cCwgMCk7CisJCV9fZnJlZV9wYWdlKHB1ZF9wYWdlKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgZG1p
cnJvcl9ib3VuY2VfaW5pdChzdHJ1Y3QgZG1pcnJvcl9ib3VuY2UgKmJvdW5jZSwKKwkJCSAgICAg
ICB1bnNpZ25lZCBsb25nIGFkZHIsCisJCQkgICAgICAgdW5zaWduZWQgbG9uZyBzaXplKQorewor
CWJvdW5jZS0+YWRkciA9IGFkZHI7CisJYm91bmNlLT5zaXplID0gc2l6ZTsKKwlib3VuY2UtPmNw
YWdlcyA9IDA7CisJYm91bmNlLT5wdHIgPSB2bWFsbG9jKHNpemUpOworCWlmICghYm91bmNlLT5w
dHIpCisJCXJldHVybiAtRU5PTUVNOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGRtaXJy
b3JfYm91bmNlX2NvcHlfZnJvbShzdHJ1Y3QgZG1pcnJvcl9ib3VuY2UgKmJvdW5jZSwKKwkJCQkg
ICAgdW5zaWduZWQgbG9uZyBhZGRyKQoreworCXVuc2lnbmVkIGxvbmcgZW5kID0gYWRkciArIGJv
dW5jZS0+c2l6ZTsKKwljaGFyIF9fdXNlciAqdXB0ciA9ICh2b2lkIF9fdXNlciAqKWFkZHI7CisJ
dm9pZCAqcHRyID0gYm91bmNlLT5wdHI7CisKKwlmb3IgKDsgYWRkciA8IGVuZDsgYWRkciArPSBQ
QUdFX1NJWkUsIHB0ciArPSBQQUdFX1NJWkUsCisJCQkJCSAgICAgIHVwdHIgKz0gUEFHRV9TSVpF
KSB7CisJCWludCByZXQ7CisKKwkJcmV0ID0gY29weV9mcm9tX3VzZXIocHRyLCB1cHRyLCBQQUdF
X1NJWkUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIGludCBkbWlycm9yX2JvdW5jZV9jb3B5X3RvKHN0cnVjdCBkbWlycm9yX2JvdW5j
ZSAqYm91bmNlLAorCQkJCSAgdW5zaWduZWQgbG9uZyBhZGRyKQoreworCXVuc2lnbmVkIGxvbmcg
ZW5kID0gYWRkciArIGJvdW5jZS0+c2l6ZTsKKwljaGFyIF9fdXNlciAqdXB0ciA9ICh2b2lkIF9f
dXNlciAqKWFkZHI7CisJdm9pZCAqcHRyID0gYm91bmNlLT5wdHI7CisKKwlmb3IgKDsgYWRkciA8
IGVuZDsgYWRkciArPSBQQUdFX1NJWkUsIHB0ciArPSBQQUdFX1NJWkUsCisJCQkJCSAgICAgIHVw
dHIgKz0gUEFHRV9TSVpFKSB7CisJCWludCByZXQ7CisKKwkJcmV0ID0gY29weV90b191c2VyKHVw
dHIsIHB0ciwgUEFHRV9TSVpFKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCisJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRtaXJyb3JfYm91bmNlX2Zpbmkoc3RydWN0IGRt
aXJyb3JfYm91bmNlICpib3VuY2UpCit7CisJdmZyZWUoYm91bmNlLT5wdHIpOworfQorCitzdGF0
aWMgaW50IGRtaXJyb3JfZG9fdXBkYXRlKHN0cnVjdCBkbWlycm9yICpkbWlycm9yLAorCQkJICAg
ICB1bnNpZ25lZCBsb25nIGFkZHIsCisJCQkgICAgIHVuc2lnbmVkIGxvbmcgZW5kLAorCQkJICAg
ICBhdG9taWM2NF90ICpkcHRlcCwKKwkJCSAgICAgdm9pZCAqcHJpdmF0ZSkKK3sKKwlmb3IgKDsg
YWRkciA8IGVuZDsgYWRkciArPSBQQUdFX1NJWkUsICsrZHB0ZXApIHsKKwkJLyogQ2xlYXIgcHRl
ICovCisJCWF0b21pYzY0X3NldChkcHRlcCwgMCk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQgZG1pcnJvcl91cGRhdGUoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwKKwkJCSAg
Y29uc3Qgc3RydWN0IG1tdV9ub3RpZmllcl9yYW5nZSAqdXBkYXRlKQoreworCXN0cnVjdCBkbWly
cm9yICpkbWlycm9yID0gY29udGFpbmVyX29mKG1pcnJvciwgc3RydWN0IGRtaXJyb3IsIG1pcnJv
cik7CisKKwkodm9pZCkgZG1pcnJvcl9wdF93YWxrKGRtaXJyb3IsIGRtaXJyb3JfZG9fdXBkYXRl
LCB1cGRhdGUtPnN0YXJ0LAorCQkJCXVwZGF0ZS0+ZW5kLCBOVUxMLCBmYWxzZSk7CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaG1tX21pcnJvcl9vcHMgZG1pcnJvcl9vcHMg
PSB7CisJLnN5bmNfY3B1X2RldmljZV9wYWdldGFibGVzCT0gJmRtaXJyb3JfdXBkYXRlLAorfTsK
KworLyoKKyAqIGRtaXJyb3JfbmV3KCkgLSBhbGxvY2F0ZSBhbmQgaW5pdGlhbGl6ZSBkbWlycm9y
IHN0cnVjdC4KKyAqCisgKiBAbWRldmljZTogVGhlIGRldmljZSB0aGlzIG1pcnJvciBpcyBhc3Nv
Y2lhdGVkIHdpdGguCisgKiBAZmlscDogVGhlIGFjdGl2ZSBkZXZpY2UgZmlsZSBkZXNjcmlwdG9y
IHRoaXMgbWlycm9yIGlzIGFzc29jaWF0ZWQgd2l0aC4KKyAqLworc3RhdGljIHN0cnVjdCBkbWly
cm9yICpkbWlycm9yX25ldyhzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UgKm1kZXZpY2UpCit7CisJc3Ry
dWN0IG1tX3N0cnVjdCAqbW0gPSBnZXRfdGFza19tbShjdXJyZW50KTsKKwlzdHJ1Y3QgZG1pcnJv
ciAqZG1pcnJvcjsKKwlpbnQgcmV0OworCisJaWYgKCFtbSkKKwkJZ290byBlcnI7CisKKwkvKiBN
aXJyb3IgdGhpcyBwcm9jZXNzIGFkZHJlc3Mgc3BhY2UgKi8KKwlkbWlycm9yID0ga3phbGxvYyhz
aXplb2YoKmRtaXJyb3IpLCBHRlBfS0VSTkVMKTsKKwlpZiAoZG1pcnJvciA9PSBOVUxMKQorCQln
b3RvIGVycl9tbXB1dDsKKworCWRtaXJyb3ItPm1kZXZpY2UgPSBtZGV2aWNlOworCWRtaXJyb3It
Pm1pcnJvci5vcHMgPSAmZG1pcnJvcl9vcHM7CisJZG93bl93cml0ZSgmbW0tPm1tYXBfc2VtKTsK
KwlyZXQgPSBobW1fbWlycm9yX3JlZ2lzdGVyKCZkbWlycm9yLT5taXJyb3IsIG1tKTsKKwl1cF93
cml0ZSgmbW0tPm1tYXBfc2VtKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9mcmVlOworCisJbW1w
dXQobW0pOworCXJldHVybiBkbWlycm9yOworCitlcnJfZnJlZToKKwlrZnJlZShkbWlycm9yKTsK
K2Vycl9tbXB1dDoKKwltbXB1dChtbSk7CitlcnI6CisJcmV0dXJuIE5VTEw7Cit9CisKK3N0YXRp
YyB2b2lkIGRtaXJyb3JfZGVsKHN0cnVjdCBkbWlycm9yICpkbWlycm9yKQoreworCWhtbV9taXJy
b3JfdW5yZWdpc3RlcigmZG1pcnJvci0+bWlycm9yKTsKKwlkbWlycm9yX3B0X2ZyZWUoZG1pcnJv
cik7CisJa2ZyZWUoZG1pcnJvcik7Cit9CisKKy8qCisgKiBCZWxvdyBhcmUgdGhlIGZpbGUgb3Bl
cmF0aW9uIGZvciB0aGUgZG1pcnJvciBkZXZpY2UgZmlsZS4gT25seSBpb2N0bCBtYXR0ZXJzLgor
ICoKKyAqIE5vdGUgdGhpcyBpcyBoaWdobHkgc3BlY2lmaWMgdG8gdGhlIGRtaXJyb3IgZGV2aWNl
IGRyaXZlciBhbmQgc2hvdWxkIG5vdCBiZQorICogY29uc3RydWVkIGFzIGFuIGV4YW1wbGUgb24g
aG93IHRvIGRlc2lnbiB0aGUgQVBJIGEgcmVhbCBkZXZpY2UgZHJpdmVyIHdvdWxkCisgKiBleHBv
c2UgdG8gdXNlcnNwYWNlLgorICovCitzdGF0aWMgc3NpemVfdCBkbWlycm9yX2ZvcHNfcmVhZChz
dHJ1Y3QgZmlsZSAqZmlscCwKKwkJCSAgICAgICBjaGFyIF9fdXNlciAqYnVmLAorCQkJICAgICAg
IHNpemVfdCBjb3VudCwKKwkJCSAgICAgICBsb2ZmX3QgKnBwb3MpCit7CisJcmV0dXJuIC1FSU5W
QUw7Cit9CisKK3N0YXRpYyBzc2l6ZV90IGRtaXJyb3JfZm9wc193cml0ZShzdHJ1Y3QgZmlsZSAq
ZmlscCwKKwkJCQljb25zdCBjaGFyIF9fdXNlciAqYnVmLAorCQkJCXNpemVfdCBjb3VudCwKKwkJ
CQlsb2ZmX3QgKnBwb3MpCit7CisJcmV0dXJuIC1FSU5WQUw7Cit9CisKK3N0YXRpYyBpbnQgZG1p
cnJvcl9mb3BzX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
dm1hKQoreworCS8qIEZvcmJpZCBtbWFwIG9mIHRoZSBkbWlycm9yIGRldmljZSBmaWxlLiAqLwor
CXJldHVybiAtRUlOVkFMOworfQorCitzdGF0aWMgaW50IGRtaXJyb3JfZm9wc19vcGVuKHN0cnVj
dCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxwKQoreworCXN0cnVjdCBjZGV2ICpjZGV2
ID0gaW5vZGUtPmlfY2RldjsKKwlzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UgKm1kZXZpY2U7CisJc3Ry
dWN0IGRtaXJyb3IgKmRtaXJyb3I7CisKKwkvKiBObyBleGNsdXNpdmUgb3BlbnMuICovCisJaWYg
KGZpbHAtPmZfZmxhZ3MgJiBPX0VYQ0wpCisJCXJldHVybiAtRUlOVkFMOworCisJbWRldmljZSA9
IGNvbnRhaW5lcl9vZihjZGV2LCBzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UsIGNkZXZpY2UpOworCWRt
aXJyb3IgPSBkbWlycm9yX25ldyhtZGV2aWNlKTsKKwlmaWxwLT5wcml2YXRlX2RhdGEgPSBkbWly
cm9yOworCisJcmV0dXJuIGRtaXJyb3IgPyAwIDogLUVOT01FTTsKK30KKworc3RhdGljIGludCBk
bWlycm9yX2ZvcHNfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmls
cCkKK3sKKwlzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciA9IGZpbHAtPnByaXZhdGVfZGF0YTsKKwor
CWlmICghZG1pcnJvcikKKwkJcmV0dXJuIDA7CisKKwlkbWlycm9yX2RlbChkbWlycm9yKTsKKwlm
aWxwLT5wcml2YXRlX2RhdGEgPSBOVUxMOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
ZG1pcnJvcl9kb19mYXVsdChzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciwKKwkJCSAgICB1bnNpZ25l
ZCBsb25nIGFkZHIsCisJCQkgICAgdW5zaWduZWQgbG9uZyBlbmQsCisJCQkgICAgYXRvbWljNjRf
dCAqZHB0ZXAsCisJCQkgICAgdm9pZCAqcHJpdmF0ZSkKK3sKKwlzdHJ1Y3QgaG1tX3JhbmdlICpy
YW5nZSA9IHByaXZhdGU7CisJdW5zaWduZWQgbG9uZyBpZHggPSAoYWRkciAtIHJhbmdlLT5zdGFy
dCkgPj4gUEFHRV9TSElGVDsKKwl1aW50NjRfdCAqcGZucyA9IHJhbmdlLT5wZm5zOworCisJZm9y
ICg7IGFkZHIgPCBlbmQ7IGFkZHIgKz0gUEFHRV9TSVpFLCArK2RwdGVwLCArK2lkeCkgeworCQlz
dHJ1Y3QgcGFnZSAqcGFnZTsKKwkJczY0IGRwdGU7CisKKwkJLyoKKwkJICogSE1NX1BGTl9FUlJP
UiBpcyByZXR1cm5lZCBpZiBpdCBpcyBhY2Nlc3NpbmcgaW52YWxpZCBtZW1vcnkKKwkJICogZWl0
aGVyIGJlY2F1c2Ugb2YgbWVtb3J5IGVycm9yIChoYXJkd2FyZSBkZXRlY3RlZCBtZW1vcnkKKwkJ
ICogY29ycnVwdGlvbikgb3IgbW9yZSBsaWtlbHkgYmVjYXVzZSBvZiB0cnVuY2F0ZSBvbiBtbWFw
CisJCSAqIGZpbGUuCisJCSAqLworCQlpZiAocGZuc1tpZHhdID09IHJhbmdlLT52YWx1ZXNbSE1N
X1BGTl9FUlJPUl0pCisJCQlyZXR1cm4gLUVGQVVMVDsKKwkJLyoKKwkJICogVGhlIG9ubHkgc3Bl
Y2lhbCBQRk4gSE1NIHJldHVybnMgaXMgdGhlIHJlYWQtb25seSB6ZXJvIHBhZ2UKKwkJICogd2hp
Y2ggZG9lc24ndCBoYXZlIGEgbWF0Y2hpbmcgc3RydWN0IHBhZ2UuCisJCSAqLworCQlpZiAocGZu
c1tpZHhdID09IHJhbmdlLT52YWx1ZXNbSE1NX1BGTl9TUEVDSUFMXSkgeworCQkJYXRvbWljNjRf
c2V0KGRwdGVwLCBEUFRfWlBBR0UpOworCQkJY29udGludWU7CisJCX0KKwkJaWYgKCEocGZuc1tp
ZHhdICYgcmFuZ2UtPmZsYWdzW0hNTV9QRk5fVkFMSURdKSkKKwkJCXJldHVybiAtRUZBVUxUOwor
CQlwYWdlID0gaG1tX2RldmljZV9lbnRyeV90b19wYWdlKHJhbmdlLCBwZm5zW2lkeF0pOworCQlk
cHRlID0gZG1pcnJvcl9wdF9mcm9tX3BhZ2UocGFnZSk7CisJCWlmIChwZm5zW2lkeF0gJiByYW5n
ZS0+ZmxhZ3NbSE1NX1BGTl9XUklURV0pCisJCQlkcHRlIHw9IERQVF9XUklURTsKKwkJZWxzZSBp
ZiAocmFuZ2UtPmRlZmF1bHRfZmxhZ3MgJiByYW5nZS0+ZmxhZ3NbSE1NX1BGTl9XUklURV0pCisJ
CQlyZXR1cm4gLUVGQVVMVDsKKwkJYXRvbWljNjRfc2V0KGRwdGVwLCBkcHRlKTsKKwl9CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBkbWlycm9yX2ZhdWx0KHN0cnVjdCBkbWlycm9yICpk
bWlycm9yLAorCQkJIHVuc2lnbmVkIGxvbmcgc3RhcnQsCisJCQkgdW5zaWduZWQgbG9uZyBlbmQs
CisJCQkgYm9vbCB3cml0ZSkKK3sKKwlzdHJ1Y3QgbW1fc3RydWN0ICptbSA9IGRtaXJyb3ItPm1p
cnJvci5obW0tPm1tdV9ub3RpZmllci5tbTsKKwl1bnNpZ25lZCBsb25nIGFkZHI7CisJdW5zaWdu
ZWQgbG9uZyBuZXh0OworCXVpbnQ2NF90IHBmbnNbNjRdOworCXN0cnVjdCBobW1fcmFuZ2UgcmFu
Z2U7CisJaW50IHJldCA9IDA7CisKKwlyYW5nZS5wZm5zID0gcGZuczsKKwlyYW5nZS5mbGFncyA9
IGRtaXJyb3JfaG1tX2ZsYWdzOworCXJhbmdlLnZhbHVlcyA9IGRtaXJyb3JfaG1tX3ZhbHVlczsK
KwlyYW5nZS5wZm5fc2hpZnQgPSBEUFRfU0hJRlQ7CisJcmFuZ2UucGZuX2ZsYWdzX21hc2sgPSB+
KHJhbmdlLmZsYWdzW0hNTV9QRk5fVkFMSURdIHwKKwkJCQkgcmFuZ2UuZmxhZ3NbSE1NX1BGTl9X
UklURV0pOworCXJhbmdlLmRlZmF1bHRfZmxhZ3MgPSByYW5nZS5mbGFnc1tITU1fUEZOX1ZBTElE
XTsKKwlpZiAod3JpdGUpCisJCXJhbmdlLmRlZmF1bHRfZmxhZ3MgfD0gcmFuZ2UuZmxhZ3NbSE1N
X1BGTl9XUklURV07CisKKwlmb3IgKGFkZHIgPSBzdGFydDsgYWRkciA8IGVuZDsgKSB7CisJCWxv
bmcgY291bnQ7CisKKwkJbmV4dCA9IG1pbihhZGRyICsgKEFSUkFZX1NJWkUocGZucykgPDwgUEFH
RV9TSElGVCksIGVuZCk7CisJCXJhbmdlLnN0YXJ0ID0gYWRkcjsKKwkJcmFuZ2UuZW5kID0gbmV4
dDsKKworCQlkb3duX3JlYWQoJm1tLT5tbWFwX3NlbSk7CisKKwkJcmV0ID0gaG1tX3JhbmdlX3Jl
Z2lzdGVyKCZyYW5nZSwgJmRtaXJyb3ItPm1pcnJvcik7CisJCWlmIChyZXQpIHsKKwkJCXVwX3Jl
YWQoJm1tLT5tbWFwX3NlbSk7CisJCQlicmVhazsKKwkJfQorCisJCWlmICghaG1tX3JhbmdlX3dh
aXRfdW50aWxfdmFsaWQoJnJhbmdlLAorCQkJCQkJRE1JUlJPUl9SQU5HRV9GQVVMVF9USU1FT1VU
KSkgeworCQkJaG1tX3JhbmdlX3VucmVnaXN0ZXIoJnJhbmdlKTsKKwkJCXVwX3JlYWQoJm1tLT5t
bWFwX3NlbSk7CisJCQljb250aW51ZTsKKwkJfQorCisJCWNvdW50ID0gaG1tX3JhbmdlX2ZhdWx0
KCZyYW5nZSwgMCk7CisJCWlmIChjb3VudCA8IDApIHsKKwkJCXJldCA9IGNvdW50OworCQkJaG1t
X3JhbmdlX3VucmVnaXN0ZXIoJnJhbmdlKTsKKwkJCXVwX3JlYWQoJm1tLT5tbWFwX3NlbSk7CisJ
CQlicmVhazsKKwkJfQorCisJCWlmICghaG1tX3JhbmdlX3ZhbGlkKCZyYW5nZSkpIHsKKwkJCWht
bV9yYW5nZV91bnJlZ2lzdGVyKCZyYW5nZSk7CisJCQl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOwor
CQkJY29udGludWU7CisJCX0KKwkJcmV0ID0gZG1pcnJvcl9wdF93YWxrKGRtaXJyb3IsIGRtaXJy
b3JfZG9fZmF1bHQsCisJCQkJICAgICAgYWRkciwgbmV4dCwgJnJhbmdlLCB0cnVlKTsKKwkJaG1t
X3JhbmdlX3VucmVnaXN0ZXIoJnJhbmdlKTsKKwkJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsKKwkJ
aWYgKHJldCkKKwkJCWJyZWFrOworCisJCWFkZHIgPSBuZXh0OworCX0KKworCXJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRtaXJyb3JfZGV2aWNlICpkbWlycm9yX3BhZ2Vf
dG9fZGV2aWNlKHN0cnVjdCBwYWdlICpwYWdlKQorCit7CisJc3RydWN0IGRtaXJyb3JfY2h1bmsg
KmRldm1lbTsKKworCWRldm1lbSA9IGNvbnRhaW5lcl9vZihwYWdlLT5wZ21hcCwgc3RydWN0IGRt
aXJyb3JfY2h1bmssIHBhZ2VtYXApOworCXJldHVybiBkZXZtZW0tPm1kZXZpY2U7Cit9CisKK3N0
YXRpYyBib29sIGRtaXJyb3JfZGV2aWNlX2lzX21pbmUoc3RydWN0IGRtaXJyb3JfZGV2aWNlICpt
ZGV2aWNlLAorCQkJCSAgIHN0cnVjdCBwYWdlICpwYWdlKQoreworCWlmICghaXNfem9uZV9kZXZp
Y2VfcGFnZShwYWdlKSkKKwkJcmV0dXJuIGZhbHNlOworCXJldHVybiBwYWdlLT5wZ21hcC0+b3Bz
ID09ICZkbWlycm9yX2Rldm1lbV9vcHMgJiYKKwkJZG1pcnJvcl9wYWdlX3RvX2RldmljZShwYWdl
KSA9PSBtZGV2aWNlOworfQorCitzdGF0aWMgaW50IGRtaXJyb3JfZG9fcmVhZChzdHJ1Y3QgZG1p
cnJvciAqZG1pcnJvciwKKwkJCSAgIHVuc2lnbmVkIGxvbmcgYWRkciwKKwkJCSAgIHVuc2lnbmVk
IGxvbmcgZW5kLAorCQkJICAgYXRvbWljNjRfdCAqZHB0ZXAsCisJCQkgICB2b2lkICpwcml2YXRl
KQoreworCXN0cnVjdCBkbWlycm9yX2JvdW5jZSAqYm91bmNlID0gcHJpdmF0ZTsKKwl2b2lkICpw
dHI7CisKKwlwdHIgPSBib3VuY2UtPnB0ciArICgoYWRkciAtIGJvdW5jZS0+YWRkcikgJiBQQUdF
X01BU0spOworCisJZm9yICg7IGFkZHIgPCBlbmQ7IGFkZHIgKz0gUEFHRV9TSVpFLCArK2RwdGVw
KSB7CisJCXN0cnVjdCBwYWdlICpwYWdlOworCQl2b2lkICp0bXA7CisKKwkJcGFnZSA9IGRtaXJy
b3JfcHRfcGFnZShkcHRlcCk7CisJCWlmICghcGFnZSkKKwkJCXJldHVybiAtRU5PRU5UOworCQlp
ZiAoaXNfem9uZV9kZXZpY2VfcGFnZShwYWdlKSkgeworCQkJaWYgKCFkbWlycm9yX2RldmljZV9p
c19taW5lKGRtaXJyb3ItPm1kZXZpY2UsIHBhZ2UpKQorCQkJCXJldHVybiAtRU5PRU5UOworCQkJ
cGFnZSA9IHBhZ2UtPnpvbmVfZGV2aWNlX2RhdGE7CisJCX0KKworCQl0bXAgPSBrbWFwKHBhZ2Up
OworCQltZW1jcHkocHRyLCB0bXAsIFBBR0VfU0laRSk7CisJCWt1bm1hcChwYWdlKTsKKworCQlw
dHIgKz0gUEFHRV9TSVpFOworCQlib3VuY2UtPmNwYWdlcysrOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGRtaXJyb3JfcmVhZChzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciwKKwkJ
CXN0cnVjdCBobW1fZG1pcnJvcl9jbWQgKmNtZCkKK3sKKwlzdHJ1Y3QgZG1pcnJvcl9ib3VuY2Ug
Ym91bmNlOworCXVuc2lnbmVkIGxvbmcgc3RhcnQsIGVuZDsKKwl1bnNpZ25lZCBsb25nIHNpemUg
PSBjbWQtPm5wYWdlcyA8PCBQQUdFX1NISUZUOworCWludCByZXQ7CisKKwlzdGFydCA9IGNtZC0+
YWRkcjsKKwllbmQgPSBzdGFydCArIHNpemU7CisKKwlyZXQgPSBkbWlycm9yX2JvdW5jZV9pbml0
KCZib3VuY2UsIHN0YXJ0LCBzaXplKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCithZ2Fp
bjoKKwlyZXQgPSBkbWlycm9yX3B0X3dhbGsoZG1pcnJvciwgZG1pcnJvcl9kb19yZWFkLAorCQkJ
ICAgICAgc3RhcnQsIGVuZCwgJmJvdW5jZSwgdHJ1ZSk7CisJaWYgKHJldCA9PSAwKQorCQlyZXQg
PSBkbWlycm9yX2JvdW5jZV9jb3B5X3RvKCZib3VuY2UsIGNtZC0+cHRyKTsKKwllbHNlIGlmIChy
ZXQgPT0gLUVOT0VOVCkgeworCQlzdGFydCA9IGNtZC0+YWRkciArIChib3VuY2UuY3BhZ2VzIDw8
IFBBR0VfU0hJRlQpOworCQlyZXQgPSBkbWlycm9yX2ZhdWx0KGRtaXJyb3IsIHN0YXJ0LCBlbmQs
IGZhbHNlKTsKKwkJaWYgKHJldCA9PSAwKSB7CisJCQljbWQtPmZhdWx0cysrOworCQkJZ290byBh
Z2FpbjsKKwkJfQorCX0KKworCWNtZC0+Y3BhZ2VzID0gYm91bmNlLmNwYWdlczsKKwlkbWlycm9y
X2JvdW5jZV9maW5pKCZib3VuY2UpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgZG1p
cnJvcl9kb193cml0ZShzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciwKKwkJCSAgICB1bnNpZ25lZCBs
b25nIGFkZHIsCisJCQkgICAgdW5zaWduZWQgbG9uZyBlbmQsCisJCQkgICAgYXRvbWljNjRfdCAq
ZHB0ZXAsCisJCQkgICAgdm9pZCAqcHJpdmF0ZSkKK3sKKwlzdHJ1Y3QgZG1pcnJvcl9ib3VuY2Ug
KmJvdW5jZSA9IHByaXZhdGU7CisJdm9pZCAqcHRyOworCisJcHRyID0gYm91bmNlLT5wdHIgKyAo
KGFkZHIgLSBib3VuY2UtPmFkZHIpICYgUEFHRV9NQVNLKTsKKworCWZvciAoOyBhZGRyIDwgZW5k
OyBhZGRyICs9IFBBR0VfU0laRSwgKytkcHRlcCkgeworCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKwkJ
dm9pZCAqdG1wOworCisJCXBhZ2UgPSBkbWlycm9yX3B0X3BhZ2Vfd3JpdGUoZHB0ZXApOworCQlp
ZiAoIXBhZ2UpCisJCQlyZXR1cm4gLUVOT0VOVDsKKwkJaWYgKGlzX3pvbmVfZGV2aWNlX3BhZ2Uo
cGFnZSkpIHsKKwkJCWlmICghZG1pcnJvcl9kZXZpY2VfaXNfbWluZShkbWlycm9yLT5tZGV2aWNl
LCBwYWdlKSkKKwkJCQlyZXR1cm4gLUVOT0VOVDsKKwkJCXBhZ2UgPSBwYWdlLT56b25lX2Rldmlj
ZV9kYXRhOworCQl9CisKKwkJdG1wID0ga21hcChwYWdlKTsKKwkJbWVtY3B5KHRtcCwgcHRyLCBQ
QUdFX1NJWkUpOworCQlrdW5tYXAocGFnZSk7CisKKwkJcHRyICs9IFBBR0VfU0laRTsKKwkJYm91
bmNlLT5jcGFnZXMrKzsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBkbWlycm9y
X3dyaXRlKHN0cnVjdCBkbWlycm9yICpkbWlycm9yLAorCQkJIHN0cnVjdCBobW1fZG1pcnJvcl9j
bWQgKmNtZCkKK3sKKwlzdHJ1Y3QgZG1pcnJvcl9ib3VuY2UgYm91bmNlOworCXVuc2lnbmVkIGxv
bmcgc3RhcnQsIGVuZDsKKwl1bnNpZ25lZCBsb25nIHNpemUgPSBjbWQtPm5wYWdlcyA8PCBQQUdF
X1NISUZUOworCWludCByZXQ7CisKKwlzdGFydCA9IGNtZC0+YWRkcjsKKwllbmQgPSBzdGFydCAr
IHNpemU7CisKKwlyZXQgPSBkbWlycm9yX2JvdW5jZV9pbml0KCZib3VuY2UsIHN0YXJ0LCBzaXpl
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCXJldCA9IGRtaXJyb3JfYm91bmNlX2NvcHlf
ZnJvbSgmYm91bmNlLCBjbWQtPnB0cik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworYWdh
aW46CisJcmV0ID0gZG1pcnJvcl9wdF93YWxrKGRtaXJyb3IsIGRtaXJyb3JfZG9fd3JpdGUsCisJ
CQkgICAgICBzdGFydCwgZW5kLCAmYm91bmNlLCB0cnVlKTsKKwlpZiAocmV0ID09IC1FTk9FTlQp
IHsKKwkJc3RhcnQgPSBjbWQtPmFkZHIgKyAoYm91bmNlLmNwYWdlcyA8PCBQQUdFX1NISUZUKTsK
KwkJcmV0ID0gZG1pcnJvcl9mYXVsdChkbWlycm9yLCBzdGFydCwgZW5kLCB0cnVlKTsKKwkJaWYg
KHJldCA9PSAwKSB7CisJCQljbWQtPmZhdWx0cysrOworCQkJZ290byBhZ2FpbjsKKwkJfQorCX0K
KworCWNtZC0+Y3BhZ2VzID0gYm91bmNlLmNwYWdlczsKKwlkbWlycm9yX2JvdW5jZV9maW5pKCZi
b3VuY2UpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBib29sIGRtaXJyb3JfYWxsb2NhdGVf
Y2h1bmsoc3RydWN0IGRtaXJyb3JfZGV2aWNlICptZGV2aWNlLAorCQkJCSAgIHN0cnVjdCBwYWdl
ICoqcHBhZ2UpCit7CisJc3RydWN0IGRtaXJyb3JfY2h1bmsgKmRldm1lbTsKKwlzdHJ1Y3QgcmVz
b3VyY2UgKnJlczsKKwl1bnNpZ25lZCBsb25nIHBmbjsKKwl1bnNpZ25lZCBsb25nIHBmbl9maXJz
dDsKKwl1bnNpZ25lZCBsb25nIHBmbl9sYXN0OworCXZvaWQgKnB0cjsKKworCW11dGV4X2xvY2so
Jm1kZXZpY2UtPmRldm1lbV9sb2NrKTsKKworCWlmIChtZGV2aWNlLT5kZXZtZW1fY291bnQgPT0g
bWRldmljZS0+ZGV2bWVtX2NhcGFjaXR5KSB7CisJCXN0cnVjdCBkbWlycm9yX2NodW5rICoqbmV3
X2NodW5rczsKKwkJdW5zaWduZWQgaW50IG5ld19jYXBhY2l0eTsKKworCQluZXdfY2FwYWNpdHkg
PSBtZGV2aWNlLT5kZXZtZW1fY2FwYWNpdHkgKworCQkJCURFVk1FTV9DSFVOS1NfUkVTRVJWRTsK
KwkJbmV3X2NodW5rcyA9IGtyZWFsbG9jKG1kZXZpY2UtPmRldm1lbV9jaHVua3MsCisJCQkJc2l6
ZW9mKG5ld19jaHVua3NbMF0pICogbmV3X2NhcGFjaXR5LAorCQkJCUdGUF9LRVJORUwpOworCQlp
ZiAoIW5ld19jaHVua3MpCisJCQlnb3RvIGVycjsKKwkJbWRldmljZS0+ZGV2bWVtX2NhcGFjaXR5
ID0gbmV3X2NhcGFjaXR5OworCQltZGV2aWNlLT5kZXZtZW1fY2h1bmtzID0gbmV3X2NodW5rczsK
Kwl9CisKKwlyZXMgPSBkZXZtX3JlcXVlc3RfZnJlZV9tZW1fcmVnaW9uKCZtZGV2aWNlLT5wZGV2
aWNlLT5kZXYsCisJCQkJCSZpb21lbV9yZXNvdXJjZSwgREVWTUVNX0NIVU5LX1NJWkUpOworCWlm
IChJU19FUlIocmVzKSkKKwkJZ290byBlcnI7CisKKwlkZXZtZW0gPSBremFsbG9jKHNpemVvZigq
ZGV2bWVtKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZXZtZW0pCisJCWdvdG8gZXJyOworCisJZGV2
bWVtLT5wYWdlbWFwLnR5cGUgPSBNRU1PUllfREVWSUNFX1BSSVZBVEU7CisJZGV2bWVtLT5wYWdl
bWFwLnJlcyA9ICpyZXM7CisJZGV2bWVtLT5wYWdlbWFwLm9wcyA9ICZkbWlycm9yX2Rldm1lbV9v
cHM7CisJcHRyID0gZGV2bV9tZW1yZW1hcF9wYWdlcygmbWRldmljZS0+cGRldmljZS0+ZGV2LCAm
ZGV2bWVtLT5wYWdlbWFwKTsKKwlpZiAoSVNfRVJSKHB0cikpCisJCWdvdG8gZXJyX2ZyZWU7CisK
KwlkZXZtZW0tPm1kZXZpY2UgPSBtZGV2aWNlOworCXBmbl9maXJzdCA9IGRldm1lbS0+cGFnZW1h
cC5yZXMuc3RhcnQgPj4gUEFHRV9TSElGVDsKKwlwZm5fbGFzdCA9IHBmbl9maXJzdCArCisJCShy
ZXNvdXJjZV9zaXplKCZkZXZtZW0tPnBhZ2VtYXAucmVzKSA+PiBQQUdFX1NISUZUKTsKKwltZGV2
aWNlLT5kZXZtZW1fY2h1bmtzW21kZXZpY2UtPmRldm1lbV9jb3VudCsrXSA9IGRldm1lbTsKKwor
CW11dGV4X3VubG9jaygmbWRldmljZS0+ZGV2bWVtX2xvY2spOworCisJcHJfaW5mbygiYWRkZWQg
bmV3ICV1IE1CIGNodW5rICh0b3RhbCAldSBjaHVua3MsICV1IE1CKSBQRk5zIFsweCVseCAweCVs
eClcbiIsCisJCURFVk1FTV9DSFVOS19TSVpFIC8gKDEwMjQgKiAxMDI0KSwKKwkJbWRldmljZS0+
ZGV2bWVtX2NvdW50LAorCQltZGV2aWNlLT5kZXZtZW1fY291bnQgKiAoREVWTUVNX0NIVU5LX1NJ
WkUgLyAoMTAyNCAqIDEwMjQpKSwKKwkJcGZuX2ZpcnN0LCBwZm5fbGFzdCk7CisKKwlzcGluX2xv
Y2soJm1kZXZpY2UtPmxvY2spOworCWZvciAocGZuID0gcGZuX2ZpcnN0OyBwZm4gPCBwZm5fbGFz
dDsgcGZuKyspIHsKKwkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBwZm5fdG9fcGFnZShwZm4pOworCisJ
CXBhZ2UtPnpvbmVfZGV2aWNlX2RhdGEgPSBtZGV2aWNlLT5mcmVlX3BhZ2VzOworCQltZGV2aWNl
LT5mcmVlX3BhZ2VzID0gcGFnZTsKKwl9CisJaWYgKHBwYWdlKSB7CisJCSpwcGFnZSA9IG1kZXZp
Y2UtPmZyZWVfcGFnZXM7CisJCW1kZXZpY2UtPmZyZWVfcGFnZXMgPSAoKnBwYWdlKS0+em9uZV9k
ZXZpY2VfZGF0YTsKKwkJbWRldmljZS0+Y2FsbG9jKys7CisJfQorCXNwaW5fdW5sb2NrKCZtZGV2
aWNlLT5sb2NrKTsKKworCXJldHVybiB0cnVlOworCitlcnJfZnJlZToKKwlrZnJlZShkZXZtZW0p
OworZXJyOgorCW11dGV4X3VubG9jaygmbWRldmljZS0+ZGV2bWVtX2xvY2spOworCXJldHVybiBm
YWxzZTsKK30KKworc3RhdGljIHN0cnVjdCBwYWdlICpkbWlycm9yX2Rldm1lbV9hbGxvY19wYWdl
KHN0cnVjdCBkbWlycm9yX2RldmljZSAqbWRldmljZSkKK3sKKwlzdHJ1Y3QgcGFnZSAqZHBhZ2Ug
PSBOVUxMOworCXN0cnVjdCBwYWdlICpycGFnZTsKKworCS8qCisJICogVGhpcyBpcyBhIGZha2Ug
ZGV2aWNlIHNvIHdlIGFsbG9jIHJlYWwgc3lzdGVtIG1lbW9yeSB0byBmYWtlCisJICogb3VyIGRl
dmljZSBtZW1vcnkuCisJICovCisJcnBhZ2UgPSBhbGxvY19wYWdlKEdGUF9ISUdIVVNFUiB8IF9f
R0ZQX1pFUk8pOworCWlmICghcnBhZ2UpCisJCXJldHVybiBOVUxMOworCisJc3Bpbl9sb2NrKCZt
ZGV2aWNlLT5sb2NrKTsKKworCWlmIChtZGV2aWNlLT5mcmVlX3BhZ2VzKSB7CisJCWRwYWdlID0g
bWRldmljZS0+ZnJlZV9wYWdlczsKKwkJbWRldmljZS0+ZnJlZV9wYWdlcyA9IGRwYWdlLT56b25l
X2RldmljZV9kYXRhOworCQltZGV2aWNlLT5jYWxsb2MrKzsKKwkJc3Bpbl91bmxvY2soJm1kZXZp
Y2UtPmxvY2spOworCX0gZWxzZSB7CisJCXNwaW5fdW5sb2NrKCZtZGV2aWNlLT5sb2NrKTsKKwkJ
aWYgKCFkbWlycm9yX2FsbG9jYXRlX2NodW5rKG1kZXZpY2UsICZkcGFnZSkpCisJCQlnb3RvIGVy
cm9yOworCX0KKworCWRwYWdlLT56b25lX2RldmljZV9kYXRhID0gcnBhZ2U7CisJZ2V0X3BhZ2Uo
ZHBhZ2UpOworCWxvY2tfcGFnZShkcGFnZSk7CisJcmV0dXJuIGRwYWdlOworCitlcnJvcjoKKwlz
cGluX3VubG9jaygmbWRldmljZS0+bG9jayk7CisJX19mcmVlX3BhZ2UocnBhZ2UpOworCXJldHVy
biBOVUxMOworfQorCitzdGF0aWMgdm9pZCBkbWlycm9yX21pZ3JhdGVfYWxsb2NfYW5kX2NvcHko
c3RydWN0IG1pZ3JhdGVfdm1hICphcmdzLAorCQkJCQkgICBzdHJ1Y3QgZG1pcnJvciAqZG1pcnJv
cikKK3sKKwlzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UgKm1kZXZpY2UgPSBkbWlycm9yLT5tZGV2aWNl
OworCWNvbnN0IHVuc2lnbmVkIGxvbmcgKnNyY19wZm5zID0gYXJncy0+c3JjOworCXVuc2lnbmVk
IGxvbmcgKmRzdF9wZm5zID0gYXJncy0+ZHN0OworCXVuc2lnbmVkIGxvbmcgYWRkcjsKKworCWZv
ciAoYWRkciA9IGFyZ3MtPnN0YXJ0OyBhZGRyIDwgYXJncy0+ZW5kOyBhZGRyICs9IFBBR0VfU0la
RSwKKwkJCQkJCSAgIHNyY19wZm5zKyssIGRzdF9wZm5zKyspIHsKKwkJc3RydWN0IHBhZ2UgKnNw
YWdlOworCQlzdHJ1Y3QgcGFnZSAqZHBhZ2U7CisJCXN0cnVjdCBwYWdlICpycGFnZTsKKworCQlp
ZiAoISgqc3JjX3BmbnMgJiBNSUdSQVRFX1BGTl9NSUdSQVRFKSkKKwkJCWNvbnRpbnVlOworCisJ
CS8qCisJCSAqIE5vdGUgdGhhdCBzcGFnZSBtaWdodCBiZSBOVUxMIHdoaWNoIGlzIE9LIHNpbmNl
IGl0IGlzIGFuCisJCSAqIHVuYWxsb2NhdGVkIHB0ZV9ub25lKCkgb3IgcmVhZC1vbmx5IHplcm8g
cGFnZS4KKwkJICovCisJCXNwYWdlID0gbWlncmF0ZV9wZm5fdG9fcGFnZSgqc3JjX3BmbnMpOwor
CQlpZiAoc3BhZ2UgJiYgaXNfem9uZV9kZXZpY2VfcGFnZShzcGFnZSkpIHsKKwkJCWlmICghZG1p
cnJvcl9kZXZpY2VfaXNfbWluZShtZGV2aWNlLCBzcGFnZSkpCisJCQkJY29udGludWU7CisJCQlz
cGFnZSA9IHNwYWdlLT56b25lX2RldmljZV9kYXRhOworCQl9CisKKwkJZHBhZ2UgPSBkbWlycm9y
X2Rldm1lbV9hbGxvY19wYWdlKG1kZXZpY2UpOworCQlpZiAoIWRwYWdlKQorCQkJY29udGludWU7
CisKKwkJcnBhZ2UgPSBkcGFnZS0+em9uZV9kZXZpY2VfZGF0YTsKKwkJaWYgKHNwYWdlKQorCQkJ
Y29weV9oaWdocGFnZShycGFnZSwgc3BhZ2UpOworCQllbHNlCisJCQljbGVhcl9oaWdocGFnZShy
cGFnZSk7CisKKwkJLyoKKwkJICogTm9ybWFsbHksIGEgZGV2aWNlIHdvdWxkIHVzZSB0aGUgcGFn
ZS0+em9uZV9kZXZpY2VfZGF0YSB0bworCQkgKiBwb2ludCB0byB0aGUgbWlycm9yIGJ1dCBoZXJl
IHdlIHVzZSBpdCB0byBob2xkIHRoZSBwYWdlIGZvcgorCQkgKiB0aGUgc2ltdWxhdGVkIGRldmlj
ZSBtZW1vcnkgYW5kIHRoYXQgcGFnZSBob2xkcyB0aGUgcG9pbnRlcgorCQkgKiB0byB0aGUgbWly
cm9yLgorCQkgKi8KKwkJcnBhZ2UtPnpvbmVfZGV2aWNlX2RhdGEgPSBkbWlycm9yOworCisJCSpk
c3RfcGZucyA9IG1pZ3JhdGVfcGZuKHBhZ2VfdG9fcGZuKGRwYWdlKSkgfAorCQkJICAgIE1JR1JB
VEVfUEZOX0xPQ0tFRDsKKwkJaWYgKCgqc3JjX3BmbnMgJiBNSUdSQVRFX1BGTl9XUklURSkgfHwK
KwkJICAgICghc3BhZ2UgJiYgYXJncy0+dm1hLT52bV9mbGFncyAmIFZNX1dSSVRFKSkKKwkJCSpk
c3RfcGZucyB8PSBNSUdSQVRFX1BGTl9XUklURTsKKwl9Cit9CisKK3N0cnVjdCBkbWlycm9yX21p
Z3JhdGUgeworCXN0cnVjdCBobW1fZG1pcnJvcl9jbWQJCSpjbWQ7CisJY29uc3QgdW5zaWduZWQg
bG9uZwkJKm1wZm5zOworCXVuc2lnbmVkIGxvbmcJCQlzdGFydDsKK307CisKK3N0YXRpYyBpbnQg
ZG1pcnJvcl9kb19taWdyYXRlKHN0cnVjdCBkbWlycm9yICpkbWlycm9yLAorCQkJICAgICAgdW5z
aWduZWQgbG9uZyBhZGRyLAorCQkJICAgICAgdW5zaWduZWQgbG9uZyBlbmQsCisJCQkgICAgICBh
dG9taWM2NF90ICpkcHRlcCwKKwkJCSAgICAgIHZvaWQgKnByaXZhdGUpCit7CisJc3RydWN0IGRt
aXJyb3JfbWlncmF0ZSAqbWlncmF0ZSA9IHByaXZhdGU7CisJY29uc3QgdW5zaWduZWQgbG9uZyAq
bXBmbnMgPSBtaWdyYXRlLT5tcGZuczsKKwl1bnNpZ25lZCBsb25nIGlkeCA9IChhZGRyIC0gbWln
cmF0ZS0+c3RhcnQpID4+IFBBR0VfU0hJRlQ7CisKKwlmb3IgKDsgYWRkciA8IGVuZDsgYWRkciAr
PSBQQUdFX1NJWkUsICsrZHB0ZXAsICsraWR4KSB7CisJCXVuc2lnbmVkIGxvbmcgbXBmbiA9IG1w
Zm5zW2lkeF07CisJCXN0cnVjdCBwYWdlICpwYWdlOworCQlzNjQgZHB0ZTsKKworCQlwYWdlID0g
bWlncmF0ZV9wZm5fdG9fcGFnZShtcGZuKTsKKwkJaWYgKCFwYWdlKQorCQkJY29udGludWU7CisK
KwkJZHB0ZSA9IGRtaXJyb3JfcHRfZnJvbV9wYWdlKHBhZ2UpIHwgRFBUX0RQQUdFOworCQlpZiAo
bXBmbiAmIE1JR1JBVEVfUEZOX1dSSVRFKQorCQkJZHB0ZSB8PSBEUFRfV1JJVEU7CisJCWF0b21p
YzY0X3NldChkcHRlcCwgZHB0ZSk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lk
IGRtaXJyb3JfbWlncmF0ZV9maW5hbGl6ZV9hbmRfbWFwKHN0cnVjdCBtaWdyYXRlX3ZtYSAqYXJn
cywKKwkJCQkJICAgICBzdHJ1Y3QgZG1pcnJvciAqZG1pcnJvciwKKwkJCQkJICAgICBzdHJ1Y3Qg
aG1tX2RtaXJyb3JfY21kICpjbWQpCit7CisJc3RydWN0IGRtaXJyb3JfbWlncmF0ZSBtaWdyYXRl
OworCisJbWlncmF0ZS5jbWQgPSBjbWQ7CisJbWlncmF0ZS5tcGZucyA9IGFyZ3MtPmRzdDsKKwlt
aWdyYXRlLnN0YXJ0ID0gYXJncy0+c3RhcnQ7CisKKwkvKiBNYXAgdGhlIG1pZ3JhdGVkIHBhZ2Vz
IGludG8gdGhlIGRldmljZSdzIHBhZ2UgdGFibGVzLiAqLworCSh2b2lkKSBkbWlycm9yX3B0X3dh
bGsoZG1pcnJvciwgZG1pcnJvcl9kb19taWdyYXRlLCBhcmdzLT5zdGFydCwKKwkJCQlhcmdzLT5l
bmQsICZtaWdyYXRlLCB0cnVlKTsKK30KKworc3RhdGljIGludCBkbWlycm9yX21pZ3JhdGUoc3Ry
dWN0IGRtaXJyb3IgKmRtaXJyb3IsCisJCQkgICBzdHJ1Y3QgaG1tX2RtaXJyb3JfY21kICpjbWQp
Cit7CisJdW5zaWduZWQgbG9uZyBhZGRyID0gY21kLT5hZGRyOworCXVuc2lnbmVkIGxvbmcgZW5k
ID0gYWRkciArIChjbWQtPm5wYWdlcyA8PCBQQUdFX1NISUZUKTsKKwlzdHJ1Y3QgbW1fc3RydWN0
ICptbSA9IGRtaXJyb3ItPm1pcnJvci5obW0tPm1tdV9ub3RpZmllci5tbTsKKwlzdHJ1Y3Qgdm1f
YXJlYV9zdHJ1Y3QgKnZtYTsKKwl1bnNpZ25lZCBsb25nIHNyY19wZm5zWzY0XTsKKwl1bnNpZ25l
ZCBsb25nIGRzdF9wZm5zWzY0XTsKKwlzdHJ1Y3QgZG1pcnJvcl9ib3VuY2UgYm91bmNlOworCXN0
cnVjdCBtaWdyYXRlX3ZtYSBhcmdzOworCXVuc2lnbmVkIGxvbmcgbmV4dDsKKwlpbnQgcmV0Owor
CisJZG93bl9yZWFkKCZtbS0+bW1hcF9zZW0pOworCWZvciAoOyBhZGRyIDwgZW5kOyBhZGRyID0g
bmV4dCkgeworCQluZXh0ID0gbWluKGVuZCwgYWRkciArIChBUlJBWV9TSVpFKHNyY19wZm5zKSA8
PCBQQUdFX1NISUZUKSk7CisKKwkJdm1hID0gZmluZF92bWEobW0sIGFkZHIpOworCQlpZiAoIXZt
YSB8fCBhZGRyIDwgdm1hLT52bV9zdGFydCkgeworCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8g
b3V0OworCQl9CisJCWlmIChuZXh0ID4gdm1hLT52bV9lbmQpCisJCQluZXh0ID0gdm1hLT52bV9l
bmQ7CisKKwkJYXJncy52bWEgPSB2bWE7CisJCWFyZ3Muc3JjID0gc3JjX3BmbnM7CisJCWFyZ3Mu
ZHN0ID0gZHN0X3BmbnM7CisJCWFyZ3Muc3RhcnQgPSBhZGRyOworCQlhcmdzLmVuZCA9IG5leHQ7
CisJCXJldCA9IG1pZ3JhdGVfdm1hX3NldHVwKCZhcmdzKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8g
b3V0OworCisJCWRtaXJyb3JfbWlncmF0ZV9hbGxvY19hbmRfY29weSgmYXJncywgZG1pcnJvcik7
CisJCW1pZ3JhdGVfdm1hX3BhZ2VzKCZhcmdzKTsKKwkJZG1pcnJvcl9taWdyYXRlX2ZpbmFsaXpl
X2FuZF9tYXAoJmFyZ3MsIGRtaXJyb3IsIGNtZCk7CisJCW1pZ3JhdGVfdm1hX2ZpbmFsaXplKCZh
cmdzKTsKKwl9CisJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsKKworCS8qIFJldHVybiB0aGUgbWln
cmF0ZWQgZGF0YSBmb3IgdmVyaWZpY2F0aW9uLiAqLworCXJldCA9IGRtaXJyb3JfYm91bmNlX2lu
aXQoJmJvdW5jZSwgY21kLT5hZGRyLCBlbmQgLSBjbWQtPmFkZHIpOworCWlmIChyZXQpCisJCXJl
dHVybiByZXQ7CisJcmV0ID0gZG1pcnJvcl9wdF93YWxrKGRtaXJyb3IsIGRtaXJyb3JfZG9fcmVh
ZCwKKwkJCSAgICAgIGNtZC0+YWRkciwgZW5kLCAmYm91bmNlLCB0cnVlKTsKKwlpZiAocmV0ID09
IDApCisJCXJldCA9IGRtaXJyb3JfYm91bmNlX2NvcHlfdG8oJmJvdW5jZSwgY21kLT5wdHIpOwor
CWNtZC0+Y3BhZ2VzID0gYm91bmNlLmNwYWdlczsKKwlkbWlycm9yX2JvdW5jZV9maW5pKCZib3Vu
Y2UpOworCXJldHVybiByZXQ7CisKK291dDoKKwl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOworCXJl
dHVybiByZXQ7Cit9CisKK3N0YXRpYyB2b2lkIGRtaXJyb3JfbWtlbnRyeShzdHJ1Y3QgZG1pcnJv
ciAqZG1pcnJvciwKKwkJCSAgICBzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSwKKwkJCSAgICB1bnNp
Z25lZCBjaGFyICpwZXJtLAorCQkJICAgIHVpbnQ2NF90IGVudHJ5KQoreworCXN0cnVjdCBwYWdl
ICpwYWdlOworCisJaWYgKGVudHJ5ID09IHJhbmdlLT52YWx1ZXNbSE1NX1BGTl9FUlJPUl0pIHsK
KwkJKnBlcm0gPSBITU1fRE1JUlJPUl9QUk9UX0VSUk9SOworCQlyZXR1cm47CisJfQorCWlmIChl
bnRyeSA9PSByYW5nZS0+dmFsdWVzW0hNTV9QRk5fTk9ORV0pIHsKKwkJKnBlcm0gPSBITU1fRE1J
UlJPUl9QUk9UX05PTkU7CisJCXJldHVybjsKKwl9CisJaWYgKGVudHJ5ID09IHJhbmdlLT52YWx1
ZXNbSE1NX1BGTl9TUEVDSUFMXSkgeworCQkqcGVybSA9IEhNTV9ETUlSUk9SX1BST1RfWkVSTzsK
KwkJcmV0dXJuOworCX0KKwlpZiAoIShlbnRyeSAmIHJhbmdlLT5mbGFnc1tITU1fUEZOX1ZBTElE
XSkpIHsKKwkJKnBlcm0gPSBITU1fRE1JUlJPUl9QUk9UX05PTkU7CisJCXJldHVybjsKKwl9CisJ
cGFnZSA9IGhtbV9kZXZpY2VfZW50cnlfdG9fcGFnZShyYW5nZSwgZW50cnkpOworCWlmICghcGFn
ZSkKKwkJKnBlcm0gPSBITU1fRE1JUlJPUl9QUk9UX1pFUk87CisJZWxzZSBpZiAoZW50cnkgJiBy
YW5nZS0+ZmxhZ3NbSE1NX1BGTl9ERVZJQ0VfUFJJVkFURV0pIHsKKwkJLyogSXMgdGhlIHBhZ2Ug
bWlncmF0ZWQgdG8gdGhpcyBkZXZpY2Ugb3Igc29tZSBvdGhlcj8gKi8KKwkJaWYgKGRtaXJyb3It
Pm1kZXZpY2UgPT0gZG1pcnJvcl9wYWdlX3RvX2RldmljZShwYWdlKSkKKwkJCSpwZXJtID0gSE1N
X0RNSVJST1JfUFJPVF9ERVZfUFJJVkFURV9MT0NBTDsKKwkJZWxzZQorCQkJKnBlcm0gPSBITU1f
RE1JUlJPUl9QUk9UX0RFVl9QUklWQVRFX1JFTU9URTsKKwl9IGVsc2UKKwkJKnBlcm0gPSBITU1f
RE1JUlJPUl9QUk9UX05PTkU7CisJaWYgKGVudHJ5ICYgcmFuZ2UtPmZsYWdzW0hNTV9QRk5fV1JJ
VEVdKQorCQkqcGVybSB8PSBITU1fRE1JUlJPUl9QUk9UX1dSSVRFOworCWVsc2UKKwkJKnBlcm0g
fD0gSE1NX0RNSVJST1JfUFJPVF9SRUFEOworfQorCitzdGF0aWMgaW50IGRtaXJyb3Jfc25hcHNo
b3Qoc3RydWN0IGRtaXJyb3IgKmRtaXJyb3IsCisJCQkgICAgc3RydWN0IGhtbV9kbWlycm9yX2Nt
ZCAqY21kKQoreworCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tID0gZG1pcnJvci0+bWlycm9yLmhtbS0+
bW11X25vdGlmaWVyLm1tOworCXVuc2lnbmVkIGxvbmcgc3RhcnQsIGVuZDsKKwl1bnNpZ25lZCBs
b25nIHNpemUgPSBjbWQtPm5wYWdlcyA8PCBQQUdFX1NISUZUOworCXVuc2lnbmVkIGxvbmcgYWRk
cjsKKwl1bnNpZ25lZCBsb25nIG5leHQ7CisJdWludDY0X3QgcGZuc1s2NF07CisJdW5zaWduZWQg
Y2hhciBwZXJtWzY0XTsKKwljaGFyIF9fdXNlciAqdXB0cjsKKwlzdHJ1Y3QgaG1tX3JhbmdlIHJh
bmdlOworCWludCByZXQgPSAwOworCisJc3RhcnQgPSBjbWQtPmFkZHI7CisJZW5kID0gc3RhcnQg
KyBzaXplOworCXVwdHIgPSAodm9pZCBfX3VzZXIgKiljbWQtPnB0cjsKKworCXJhbmdlLnBmbnMg
PSBwZm5zOworCXJhbmdlLmZsYWdzID0gZG1pcnJvcl9obW1fZmxhZ3M7CisJcmFuZ2UudmFsdWVz
ID0gZG1pcnJvcl9obW1fdmFsdWVzOworCXJhbmdlLnBmbl9zaGlmdCA9IERQVF9TSElGVDsKKwly
YW5nZS5wZm5fZmxhZ3NfbWFzayA9IH4wVUxMOworCXJhbmdlLmRlZmF1bHRfZmxhZ3MgPSAwOwor
CisJZm9yIChhZGRyID0gc3RhcnQ7IGFkZHIgPCBlbmQ7ICkgeworCQlsb25nIGNvdW50OworCQl1
bnNpZ25lZCBsb25nIGk7CisJCXVuc2lnbmVkIGxvbmcgbjsKKworCQluZXh0ID0gbWluKGFkZHIg
KyAoQVJSQVlfU0laRShwZm5zKSA8PCBQQUdFX1NISUZUKSwgZW5kKTsKKwkJcmFuZ2Uuc3RhcnQg
PSBhZGRyOworCQlyYW5nZS5lbmQgPSBuZXh0OworCisJCWRvd25fcmVhZCgmbW0tPm1tYXBfc2Vt
KTsKKworCQlyZXQgPSBobW1fcmFuZ2VfcmVnaXN0ZXIoJnJhbmdlLCAmZG1pcnJvci0+bWlycm9y
KTsKKwkJaWYgKHJldCkgeworCQkJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsKKwkJCWJyZWFrOwor
CQl9CisKKwkJaWYgKCFobW1fcmFuZ2Vfd2FpdF91bnRpbF92YWxpZCgmcmFuZ2UsCisJCQkJCQlE
TUlSUk9SX1JBTkdFX0ZBVUxUX1RJTUVPVVQpKSB7CisJCQlobW1fcmFuZ2VfdW5yZWdpc3Rlcigm
cmFuZ2UpOworCQkJdXBfcmVhZCgmbW0tPm1tYXBfc2VtKTsKKwkJCWNvbnRpbnVlOworCQl9CisK
KwkJY291bnQgPSBobW1fcmFuZ2VfZmF1bHQoJnJhbmdlLCBITU1fRkFVTFRfU05BUFNIT1QpOwor
CQlpZiAoY291bnQgPCAwKSB7CisJCQlyZXQgPSBjb3VudDsKKwkJCWhtbV9yYW5nZV91bnJlZ2lz
dGVyKCZyYW5nZSk7CisJCQl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOworCQkJaWYgKHJldCA9PSAt
RUJVU1kpCisJCQkJY29udGludWU7CisJCQlicmVhazsKKwkJfQorCisJCWlmICghaG1tX3Jhbmdl
X3ZhbGlkKCZyYW5nZSkpIHsKKwkJCWhtbV9yYW5nZV91bnJlZ2lzdGVyKCZyYW5nZSk7CisJCQl1
cF9yZWFkKCZtbS0+bW1hcF9zZW0pOworCQkJY29udGludWU7CisJCX0KKworCQluID0gKG5leHQg
LSBhZGRyKSA+PiBQQUdFX1NISUZUOworCQlmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKQorCQkJZG1p
cnJvcl9ta2VudHJ5KGRtaXJyb3IsICZyYW5nZSwgcGVybSArIGksIHBmbnNbaV0pOworCQlobW1f
cmFuZ2VfdW5yZWdpc3RlcigmcmFuZ2UpOworCQl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOworCisJ
CXJldCA9IGNvcHlfdG9fdXNlcih1cHRyLCBwZXJtLCBuKTsKKwkJaWYgKHJldCkKKwkJCWJyZWFr
OworCisJCWNtZC0+Y3BhZ2VzICs9IG47CisJCXVwdHIgKz0gbjsKKwkJYWRkciA9IG5leHQ7CisJ
fQorCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGxvbmcgZG1pcnJvcl9mb3BzX3VubG9ja2Vk
X2lvY3RsKHN0cnVjdCBmaWxlICpmaWxwLAorCQkJCQl1bnNpZ25lZCBpbnQgY29tbWFuZCwKKwkJ
CQkJdW5zaWduZWQgbG9uZyBhcmcpCit7CisJdm9pZCBfX3VzZXIgKnVhcmcgPSAodm9pZCBfX3Vz
ZXIgKilhcmc7CisJc3RydWN0IGhtbV9kbWlycm9yX2NtZCBjbWQ7CisJc3RydWN0IGRtaXJyb3Ig
KmRtaXJyb3I7CisJaW50IHJldDsKKworCWRtaXJyb3IgPSBmaWxwLT5wcml2YXRlX2RhdGE7CisJ
aWYgKCFkbWlycm9yKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldCA9IGNvcHlfZnJvbV91c2Vy
KCZjbWQsIHVhcmcsIHNpemVvZihjbWQpKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJ
aWYgKGNtZC5hZGRyICYgflBBR0VfTUFTSykKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKGNtZC5h
ZGRyID49IChjbWQuYWRkciArIChjbWQubnBhZ2VzIDw8IFBBR0VfU0hJRlQpKSkKKwkJcmV0dXJu
IC1FSU5WQUw7CisKKwljbWQuY3BhZ2VzID0gMDsKKwljbWQuZmF1bHRzID0gMDsKKworCXN3aXRj
aCAoY29tbWFuZCkgeworCWNhc2UgSE1NX0RNSVJST1JfUkVBRDoKKwkJcmV0ID0gZG1pcnJvcl9y
ZWFkKGRtaXJyb3IsICZjbWQpOworCQlicmVhazsKKworCWNhc2UgSE1NX0RNSVJST1JfV1JJVEU6
CisJCXJldCA9IGRtaXJyb3Jfd3JpdGUoZG1pcnJvciwgJmNtZCk7CisJCWJyZWFrOworCisJY2Fz
ZSBITU1fRE1JUlJPUl9NSUdSQVRFOgorCQlyZXQgPSBkbWlycm9yX21pZ3JhdGUoZG1pcnJvciwg
JmNtZCk7CisJCWJyZWFrOworCisJY2FzZSBITU1fRE1JUlJPUl9TTkFQU0hPVDoKKwkJcmV0ID0g
ZG1pcnJvcl9zbmFwc2hvdChkbWlycm9yLCAmY21kKTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0Ogor
CQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVy
biBjb3B5X3RvX3VzZXIodWFyZywgJmNtZCwgc2l6ZW9mKGNtZCkpOworfQorCitzdGF0aWMgY29u
c3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBkbWlycm9yX2ZvcHMgPSB7CisJLnJlYWQJCT0gZG1p
cnJvcl9mb3BzX3JlYWQsCisJLndyaXRlCQk9IGRtaXJyb3JfZm9wc193cml0ZSwKKwkubW1hcAkJ
PSBkbWlycm9yX2ZvcHNfbW1hcCwKKwkub3BlbgkJPSBkbWlycm9yX2ZvcHNfb3BlbiwKKwkucmVs
ZWFzZQk9IGRtaXJyb3JfZm9wc19yZWxlYXNlLAorCS51bmxvY2tlZF9pb2N0bCA9IGRtaXJyb3Jf
Zm9wc191bmxvY2tlZF9pb2N0bCwKKwkubGxzZWVrCQk9IGRlZmF1bHRfbGxzZWVrLAorCS5vd25l
cgkJPSBUSElTX01PRFVMRSwKK307CisKK3N0YXRpYyB2b2lkIGRtaXJyb3JfZGV2bWVtX2ZyZWUo
c3RydWN0IHBhZ2UgKnBhZ2UpCit7CisJc3RydWN0IHBhZ2UgKnJwYWdlID0gcGFnZS0+em9uZV9k
ZXZpY2VfZGF0YTsKKwlzdHJ1Y3QgZG1pcnJvcl9kZXZpY2UgKm1kZXZpY2U7CisKKwlpZiAocnBh
Z2UpCisJCV9fZnJlZV9wYWdlKHJwYWdlKTsKKworCW1kZXZpY2UgPSBkbWlycm9yX3BhZ2VfdG9f
ZGV2aWNlKHBhZ2UpOworCisJc3Bpbl9sb2NrKCZtZGV2aWNlLT5sb2NrKTsKKwltZGV2aWNlLT5j
ZnJlZSsrOworCXBhZ2UtPnpvbmVfZGV2aWNlX2RhdGEgPSBtZGV2aWNlLT5mcmVlX3BhZ2VzOwor
CW1kZXZpY2UtPmZyZWVfcGFnZXMgPSBwYWdlOworCXNwaW5fdW5sb2NrKCZtZGV2aWNlLT5sb2Nr
KTsKK30KKworc3RhdGljIHZtX2ZhdWx0X3QgZG1pcnJvcl9kZXZtZW1fZmF1bHRfYWxsb2NfYW5k
X2NvcHkoc3RydWN0IG1pZ3JhdGVfdm1hICphcmdzLAorCQkJCQkJc3RydWN0IGRtaXJyb3JfZGV2
aWNlICptZGV2aWNlKQoreworCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hID0gYXJncy0+dm1h
OworCWNvbnN0IHVuc2lnbmVkIGxvbmcgKnNyY19wZm5zID0gYXJncy0+c3JjOworCXVuc2lnbmVk
IGxvbmcgKmRzdF9wZm5zID0gYXJncy0+ZHN0OworCXVuc2lnbmVkIGxvbmcgc3RhcnQgPSBhcmdz
LT5zdGFydDsKKwl1bnNpZ25lZCBsb25nIGVuZCA9IGFyZ3MtPmVuZDsKKwl1bnNpZ25lZCBsb25n
IGFkZHI7CisKKwlmb3IgKGFkZHIgPSBzdGFydDsgYWRkciA8IGVuZDsgYWRkciArPSBQQUdFX1NJ
WkUsCisJCQkJICAgICAgIHNyY19wZm5zKyssIGRzdF9wZm5zKyspIHsKKwkJc3RydWN0IHBhZ2Ug
KmRwYWdlLCAqc3BhZ2U7CisKKwkJc3BhZ2UgPSBtaWdyYXRlX3Bmbl90b19wYWdlKCpzcmNfcGZu
cyk7CisJCWlmICghc3BhZ2UgfHwgISgqc3JjX3BmbnMgJiBNSUdSQVRFX1BGTl9NSUdSQVRFKSkK
KwkJCWNvbnRpbnVlOworCQlpZiAoIWRtaXJyb3JfZGV2aWNlX2lzX21pbmUobWRldmljZSwgc3Bh
Z2UpKQorCQkJY29udGludWU7CisJCXNwYWdlID0gc3BhZ2UtPnpvbmVfZGV2aWNlX2RhdGE7CisK
KwkJZHBhZ2UgPSBhbGxvY19wYWdlX3ZtYShHRlBfSElHSFVTRVJfTU9WQUJMRSwgdm1hLCBhZGRy
KTsKKwkJaWYgKCFkcGFnZSkKKwkJCWNvbnRpbnVlOworCisJCWxvY2tfcGFnZShkcGFnZSk7CisJ
CWNvcHlfaGlnaHBhZ2UoZHBhZ2UsIHNwYWdlKTsKKwkJKmRzdF9wZm5zID0gbWlncmF0ZV9wZm4o
cGFnZV90b19wZm4oZHBhZ2UpKSB8CisJCQkgICAgTUlHUkFURV9QRk5fTE9DS0VEOworCQlpZiAo
KnNyY19wZm5zICYgTUlHUkFURV9QRk5fV1JJVEUpCisJCQkqZHN0X3BmbnMgfD0gTUlHUkFURV9Q
Rk5fV1JJVEU7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBkbWlycm9yX2Rldm1l
bV9mYXVsdF9maW5hbGl6ZV9hbmRfbWFwKHN0cnVjdCBtaWdyYXRlX3ZtYSAqYXJncywKKwkJCQkJ
CSAgc3RydWN0IGRtaXJyb3IgKmRtaXJyb3IpCit7CisJLyogSW52YWxpZGF0ZSB0aGUgZGV2aWNl
J3MgcGFnZSB0YWJsZSBtYXBwaW5nLiAqLworCSh2b2lkKSBkbWlycm9yX3B0X3dhbGsoZG1pcnJv
ciwgZG1pcnJvcl9kb191cGRhdGUsIGFyZ3MtPnN0YXJ0LAorCQkJICAgICAgIGFyZ3MtPmVuZCwg
TlVMTCwgZmFsc2UpOworfQorCitzdGF0aWMgdm1fZmF1bHRfdCBkbWlycm9yX2Rldm1lbV9mYXVs
dChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKK3sKKwlzdHJ1Y3QgbWlncmF0ZV92bWEgYXJnczsKKwl1
bnNpZ25lZCBsb25nIHNyY19wZm5zOworCXVuc2lnbmVkIGxvbmcgZHN0X3BmbnM7CisJc3RydWN0
IHBhZ2UgKnJwYWdlOworCXN0cnVjdCBkbWlycm9yICpkbWlycm9yOworCXZtX2ZhdWx0X3QgcmV0
OworCisJLyogRklYTUUgZGVtb25zdHJhdGUgaG93IHdlIGNhbiBhZGp1c3QgbWlncmF0ZSByYW5n
ZSAqLworCWFyZ3Mudm1hID0gdm1mLT52bWE7CisJYXJncy5zdGFydCA9IHZtZi0+YWRkcmVzczsK
KwlhcmdzLmVuZCA9IGFyZ3Muc3RhcnQgKyBQQUdFX1NJWkU7CisJYXJncy5zcmMgPSAmc3JjX3Bm
bnM7CisJYXJncy5kc3QgPSAmZHN0X3BmbnM7CisKKwlpZiAobWlncmF0ZV92bWFfc2V0dXAoJmFy
Z3MpKQorCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOworCisJLyoKKwkgKiBOb3JtYWxseSwgYSBk
ZXZpY2Ugd291bGQgdXNlIHRoZSBwYWdlLT56b25lX2RldmljZV9kYXRhIHRvIHBvaW50IHRvCisJ
ICogdGhlIG1pcnJvciBidXQgaGVyZSB3ZSB1c2UgaXQgdG8gaG9sZCB0aGUgcGFnZSBmb3IgdGhl
IHNpbXVsYXRlZAorCSAqIGRldmljZSBtZW1vcnkgYW5kIHRoYXQgcGFnZSBob2xkcyB0aGUgcG9p
bnRlciB0byB0aGUgbWlycm9yLgorCSAqLworCXJwYWdlID0gdm1mLT5wYWdlLT56b25lX2Rldmlj
ZV9kYXRhOworCWRtaXJyb3IgPSBycGFnZS0+em9uZV9kZXZpY2VfZGF0YTsKKworCXJldCA9IGRt
aXJyb3JfZGV2bWVtX2ZhdWx0X2FsbG9jX2FuZF9jb3B5KCZhcmdzLCBkbWlycm9yLT5tZGV2aWNl
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCW1pZ3JhdGVfdm1hX3BhZ2VzKCZhcmdzKTsK
KwlkbWlycm9yX2Rldm1lbV9mYXVsdF9maW5hbGl6ZV9hbmRfbWFwKCZhcmdzLCBkbWlycm9yKTsK
KwltaWdyYXRlX3ZtYV9maW5hbGl6ZSgmYXJncyk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZGV2X3BhZ2VtYXBfb3BzIGRtaXJyb3JfZGV2bWVtX29wcyA9IHsKKwkucGFn
ZV9mcmVlCT0gZG1pcnJvcl9kZXZtZW1fZnJlZSwKKwkubWlncmF0ZV90b19yYW0JPSBkbWlycm9y
X2Rldm1lbV9mYXVsdCwKK307CisKK3N0YXRpYyB2b2lkIGRtaXJyb3JfcGRldl9kZWwodm9pZCAq
YXJnKQoreworCXN0cnVjdCBkbWlycm9yX2RldmljZSAqbWRldmljZSA9IGFyZzsKKwl1bnNpZ25l
ZCBpbnQgaTsKKworCWlmIChtZGV2aWNlLT5kZXZtZW1fY2h1bmtzKSB7CisJCWZvciAoaSA9IDA7
IGkgPCBtZGV2aWNlLT5kZXZtZW1fY291bnQ7IGkrKykKKwkJCWtmcmVlKG1kZXZpY2UtPmRldm1l
bV9jaHVua3NbaV0pOworCQlrZnJlZShtZGV2aWNlLT5kZXZtZW1fY2h1bmtzKTsKKwl9CisKKwlj
ZGV2X2RlbCgmbWRldmljZS0+Y2RldmljZSk7CisJa2ZyZWUobWRldmljZSk7Cit9CisKK3N0YXRp
YyBpbnQgZG1pcnJvcl9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0
cnVjdCBkbWlycm9yX2RldmljZSAqbWRldmljZTsKKwlpbnQgcmV0OworCisJbWRldmljZSA9IGt6
YWxsb2Moc2l6ZW9mKCptZGV2aWNlKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFtZGV2aWNlKQorCQly
ZXR1cm4gLUVOT01FTTsKKworCW1kZXZpY2UtPnBkZXZpY2UgPSBwZGV2OworCW11dGV4X2luaXQo
Jm1kZXZpY2UtPmRldm1lbV9sb2NrKTsKKwlzcGluX2xvY2tfaW5pdCgmbWRldmljZS0+bG9jayk7
CisKKwljZGV2X2luaXQoJm1kZXZpY2UtPmNkZXZpY2UsICZkbWlycm9yX2ZvcHMpOworCXJldCA9
IGNkZXZfYWRkKCZtZGV2aWNlLT5jZGV2aWNlLCBwZGV2LT5kZXYuZGV2dCwgMSk7CisJaWYgKHJl
dCkgeworCQlrZnJlZShtZGV2aWNlKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlwbGF0Zm9ybV9z
ZXRfZHJ2ZGF0YShwZGV2LCBtZGV2aWNlKTsKKwlyZXQgPSBkZXZtX2FkZF9hY3Rpb25fb3JfcmVz
ZXQoJnBkZXYtPmRldiwgZG1pcnJvcl9wZGV2X2RlbCwgbWRldmljZSk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKKworCS8qIEJ1aWxkIGxpc3Qgb2YgZnJlZSBzdHJ1Y3QgcGFnZSAqLworCWRt
aXJyb3JfYWxsb2NhdGVfY2h1bmsobWRldmljZSwgTlVMTCk7CisKKwlyZXR1cm4gMDsKK30KKwor
c3RhdGljIGludCBkbWlycm9yX3JlbW92ZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQor
eworCS8qIGFsbCBwcm9iZSBhY3Rpb25zIGFyZSB1bndvdW5kIGJ5IGRldm0gKi8KKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIHN0cnVjdCBwbGF0Zm9ybV9kcml2ZXIgZG1pcnJvcl9kZXZpY2VfZHJp
dmVyID0geworCS5wcm9iZQkJPSBkbWlycm9yX3Byb2JlLAorCS5yZW1vdmUJCT0gZG1pcnJvcl9y
ZW1vdmUsCisJLmRyaXZlcgkJPSB7CisJCS5uYW1lCT0gIkhNTV9ETUlSUk9SIiwKKwl9LAorfTsK
Kworc3RhdGljIGludCBfX2luaXQgaG1tX2RtaXJyb3JfaW5pdCh2b2lkKQoreworCWludCByZXQ7
CisJaW50IGlkOworCisJcmV0ID0gcGxhdGZvcm1fZHJpdmVyX3JlZ2lzdGVyKCZkbWlycm9yX2Rl
dmljZV9kcml2ZXIpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBhbGxvY19j
aHJkZXZfcmVnaW9uKCZkbWlycm9yX2RldiwgMCwgRE1JUlJPUl9OREVWSUNFUywKKwkJCQkgICJI
TU1fRE1JUlJPUiIpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX3VucmVnOworCisJZm9yIChpZCA9
IDA7IGlkIDwgRE1JUlJPUl9OREVWSUNFUzsgaWQrKykgeworCQlzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZDsKKworCQlwZCA9IHBsYXRmb3JtX2RldmljZV9hbGxvYygiSE1NX0RNSVJST1IiLCBp
ZCk7CisJCWlmICghcGQpIHsKKwkJCXJldCA9IC1FTk9NRU07CisJCQlnb3RvIGVycl9jaHJkZXY7
CisJCX0KKwkJcGQtPmRldi5kZXZ0ID0gTUtERVYoTUFKT1IoZG1pcnJvcl9kZXYpLCBpZCk7CisJ
CXJldCA9IHBsYXRmb3JtX2RldmljZV9hZGQocGQpOworCQlpZiAocmV0KSB7CisJCQlwbGF0Zm9y
bV9kZXZpY2VfcHV0KHBkKTsKKwkJCWdvdG8gZXJyX2NocmRldjsKKwkJfQorCQlkbWlycm9yX3Bs
YXRmb3JtX2RldmljZXNbaWRdID0gcGQ7CisJfQorCisJLyoKKwkgKiBBbGxvY2F0ZSBhIHplcm8g
cGFnZSB0byBzaW11bGF0ZSBhIHJlc2VydmVkIHBhZ2Ugb2YgZGV2aWNlIHByaXZhdGUKKwkgKiBt
ZW1vcnkgd2hpY2ggaXMgYWx3YXlzIHplcm8uIFRoZSB6ZXJvX3BmbiBwYWdlIGlzbid0IHVzZWQg
anVzdCB0bworCSAqIG1ha2UgdGhlIGNvZGUgaGVyZSBzaW1wbGVyIChpLmUuLCB3ZSBuZWVkIGEg
c3RydWN0IHBhZ2UgZm9yIGl0KS4KKwkgKi8KKwlkbWlycm9yX3plcm9fcGFnZSA9IGFsbG9jX3Bh
Z2UoR0ZQX0hJR0hVU0VSIHwgX19HRlBfWkVSTyk7CisJaWYgKCFkbWlycm9yX3plcm9fcGFnZSkK
KwkJZ290byBlcnJfY2hyZGV2OworCisJcHJfaW5mbygiaG1tX2RtaXJyb3IgbG9hZGVkLiBUaGlz
IGlzIG9ubHkgZm9yIHRlc3RpbmcgSE1NLlxuIik7CisJcmV0dXJuIDA7CisKK2Vycl9jaHJkZXY6
CisJd2hpbGUgKC0taWQgPj0gMCkgeworCQlwbGF0Zm9ybV9kZXZpY2VfdW5yZWdpc3RlcihkbWly
cm9yX3BsYXRmb3JtX2RldmljZXNbaWRdKTsKKwkJZG1pcnJvcl9wbGF0Zm9ybV9kZXZpY2VzW2lk
XSA9IE5VTEw7CisJfQorCXVucmVnaXN0ZXJfY2hyZGV2X3JlZ2lvbihkbWlycm9yX2RldiwgMSk7
CitlcnJfdW5yZWc6CisJcGxhdGZvcm1fZHJpdmVyX3VucmVnaXN0ZXIoJmRtaXJyb3JfZGV2aWNl
X2RyaXZlcik7CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgX19leGl0IGhtbV9kbWly
cm9yX2V4aXQodm9pZCkKK3sKKwlpbnQgaWQ7CisKKwlpZiAoZG1pcnJvcl96ZXJvX3BhZ2UpCisJ
CV9fZnJlZV9wYWdlKGRtaXJyb3JfemVyb19wYWdlKTsKKwlmb3IgKGlkID0gMDsgaWQgPCBETUlS
Uk9SX05ERVZJQ0VTOyBpZCsrKQorCQlwbGF0Zm9ybV9kZXZpY2VfdW5yZWdpc3RlcihkbWlycm9y
X3BsYXRmb3JtX2RldmljZXNbaWRdKTsKKwl1bnJlZ2lzdGVyX2NocmRldl9yZWdpb24oZG1pcnJv
cl9kZXYsIERNSVJST1JfTkRFVklDRVMpOworCXBsYXRmb3JtX2RyaXZlcl91bnJlZ2lzdGVyKCZk
bWlycm9yX2RldmljZV9kcml2ZXIpOworCW1tdV9ub3RpZmllcl9zeW5jaHJvbml6ZSgpOworfQor
Cittb2R1bGVfaW5pdChobW1fZG1pcnJvcl9pbml0KTsKK21vZHVsZV9leGl0KGhtbV9kbWlycm9y
X2V4aXQpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCIpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9LYnVp
bGQgYi9pbmNsdWRlL0tidWlsZAppbmRleCBjMzhmMGQ0NmIyNjcuLjk3MmMxNjg2MjljZCAxMDA2
NDQKLS0tIGEvaW5jbHVkZS9LYnVpbGQKKysrIGIvaW5jbHVkZS9LYnVpbGQKQEAgLTExMzQsNiAr
MTEzNCw3IEBAIGhlYWRlci10ZXN0LQkJCSs9IHVhcGkvbGludXgvY29kYV9wc2Rldi5oCiBoZWFk
ZXItdGVzdC0JCQkrPSB1YXBpL2xpbnV4L2VycnF1ZXVlLmgKIGhlYWRlci10ZXN0LQkJCSs9IHVh
cGkvbGludXgvZXZlbnRwb2xsLmgKIGhlYWRlci10ZXN0LQkJCSs9IHVhcGkvbGludXgvaGRsYy9p
b2N0bC5oCitoZWFkZXItdGVzdC0JCQkrPSB1YXBpL2xpbnV4L2htbV9kbWlycm9yLmgKIGhlYWRl
ci10ZXN0LQkJCSs9IHVhcGkvbGludXgvaW5wdXQuaAogaGVhZGVyLXRlc3QtCQkJKz0gdWFwaS9s
aW51eC9rdm0uaAogaGVhZGVyLXRlc3QtCQkJKz0gdWFwaS9saW51eC9rdm1fcGFyYS5oCmRpZmYg
LS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgvaG1tX2RtaXJyb3IuaCBiL2luY2x1ZGUvdWFwaS9s
aW51eC9obW1fZG1pcnJvci5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAw
MC4uYjg4NjIxMDE0MmFkCi0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L2ht
bV9kbWlycm9yLmgKQEAgLTAsMCArMSw3NCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IEdQTC0yLjAgV0lUSCBMaW51eC1zeXNjYWxsLW5vdGUgKi8KKy8qCisgKiBDb3B5cmlnaHQgMjAx
MyBSZWQgSGF0IEluYy4KKyAqCisgKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91
IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yCisgKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1z
IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcworICogcHVibGlzaGVkIGJ5IHRo
ZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YKKyAqIHRoZSBM
aWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorICoKKyAqIFRo
aXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNl
ZnVsLAorICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxp
ZWQgd2FycmFudHkgb2YKKyAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJ
Q1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKyAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZv
ciBtb3JlIGRldGFpbHMuCisgKgorICogQXV0aG9yczogSsOpcsO0bWUgR2xpc3NlIDxqZ2xpc3Nl
QHJlZGhhdC5jb20+CisgKi8KKy8qCisgKiBUaGlzIGlzIGEgZHVtbXkgZHJpdmVyIHRvIGV4ZXJj
aXNlIHRoZSBITU0gKGhldGVyb2dlbmVvdXMgbWVtb3J5IG1hbmFnZW1lbnQpCisgKiBBUEkgb2Yg
dGhlIGtlcm5lbC4gSXQgYWxsb3dzIGEgdXNlcnNwYWNlIHByb2dyYW0gdG8gZXhwb3NlIGl0cyBl
bnRpcmUgYWRkcmVzcworICogc3BhY2UgdGhyb3VnaCB0aGUgSE1NIGR1bW15IGRyaXZlciBmaWxl
LgorICovCisjaWZuZGVmIF9VQVBJX0xJTlVYX0hNTV9ETUlSUk9SX0gKKyNkZWZpbmUgX1VBUElf
TElOVVhfSE1NX0RNSVJST1JfSAorCisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKyNpbmNsdWRl
IDxsaW51eC9pb2N0bC5oPgorCisvKgorICogU3RydWN0dXJlIHRvIHBhc3MgdG8gdGhlIEhNTSB0
ZXN0IGRyaXZlciB0byBtaW1pYyBhIGRldmljZSBhY2Nlc3NpbmcKKyAqIHN5c3RlbSBtZW1vcnkg
YW5kIFpPTkVfREVWSUNFIHByaXZhdGUgbWVtb3J5IHRocm91Z2ggZGV2aWNlIHBhZ2UgdGFibGVz
LgorICoKKyAqIEBhZGRyOiAoaW4pIHVzZXIgYWRkcmVzcyB0aGUgZGV2aWNlIHdpbGwgcmVhZC93
cml0ZQorICogQHB0cjogKGluKSB1c2VyIGFkZHJlc3Mgd2hlcmUgZGV2aWNlIGRhdGEgaXMgY29w
aWVkIHRvL2Zyb20KKyAqIEBucGFnZXM6IChpbikgbnVtYmVyIG9mIHBhZ2VzIHRvIHJlYWQvd3Jp
dGUKKyAqIEBjcGFnZXM6IChvdXQpIG51bWJlciBvZiBwYWdlcyBjb3BpZWQKKyAqIEBmYXVsdHM6
IChvdXQpIG51bWJlciBvZiBkZXZpY2UgcGFnZSBmYXVsdHMgc2VlbgorICovCitzdHJ1Y3QgaG1t
X2RtaXJyb3JfY21kIHsKKwlfX3U2NAkJYWRkcjsKKwlfX3U2NAkJcHRyOworCV9fdTY0CQlucGFn
ZXM7CisJX191NjQJCWNwYWdlczsKKwlfX3U2NAkJZmF1bHRzOworfTsKKworLyogRXhwb3NlIHRo
ZSBhZGRyZXNzIHNwYWNlIG9mIHRoZSBjYWxsaW5nIHByb2Nlc3MgdGhyb3VnaCBobW0gZHVtbXkg
ZGV2IGZpbGUgKi8KKyNkZWZpbmUgSE1NX0RNSVJST1JfUkVBRAkJX0lPV1IoJ0gnLCAweDAwLCBz
dHJ1Y3QgaG1tX2RtaXJyb3JfY21kKQorI2RlZmluZSBITU1fRE1JUlJPUl9XUklURQkJX0lPV1Io
J0gnLCAweDAxLCBzdHJ1Y3QgaG1tX2RtaXJyb3JfY21kKQorI2RlZmluZSBITU1fRE1JUlJPUl9N
SUdSQVRFCQlfSU9XUignSCcsIDB4MDIsIHN0cnVjdCBobW1fZG1pcnJvcl9jbWQpCisjZGVmaW5l
IEhNTV9ETUlSUk9SX1NOQVBTSE9UCQlfSU9XUignSCcsIDB4MDMsIHN0cnVjdCBobW1fZG1pcnJv
cl9jbWQpCisKKy8qCisgKiBWYWx1ZXMgcmV0dXJuZWQgaW4gaG1tX2RtaXJyb3JfY21kLnB0ciBm
b3IgSE1NX0RNSVJST1JfU05BUFNIT1QuCisgKiBITU1fRE1JUlJPUl9QUk9UX0VSUk9SOiBubyB2
YWxpZCBtaXJyb3IgUFRFIGZvciB0aGlzIHBhZ2UKKyAqIEhNTV9ETUlSUk9SX1BST1RfTk9ORTog
dW5wb3B1bGF0ZWQgUFRFIG9yIFBURSB3aXRoIG5vIGFjY2VzcworICogSE1NX0RNSVJST1JfUFJP
VF9SRUFEOiByZWFkLW9ubHkgUFRFCisgKiBITU1fRE1JUlJPUl9QUk9UX1dSSVRFOiByZWFkL3dy
aXRlIFBURQorICogSE1NX0RNSVJST1JfUFJPVF9aRVJPOiBzcGVjaWFsIHJlYWQtb25seSB6ZXJv
IHBhZ2UKKyAqIEhNTV9ETUlSUk9SX1BST1RfREVWX1BSSVZBVEVfTE9DQUw6IE1pZ3JhdGVkIGRl
dmljZSBwcml2YXRlIHBhZ2Ugb24gdGhlCisgKgkJCQkJZGV2aWNlIHRoZSBpb2N0bCgpIGlzIG1h
ZGUKKyAqIEhNTV9ETUlSUk9SX1BST1RfREVWX1BSSVZBVEVfUkVNT1RFOiBNaWdyYXRlZCBkZXZp
Y2UgcHJpdmF0ZSBwYWdlIG9uIHNvbWUKKyAqCQkJCQlvdGhlciBkZXZpY2UKKyAqLworZW51bSB7
CisJSE1NX0RNSVJST1JfUFJPVF9FUlJPUgkJCT0gMHhGRiwKKwlITU1fRE1JUlJPUl9QUk9UX05P
TkUJCQk9IDB4MDAsCisJSE1NX0RNSVJST1JfUFJPVF9SRUFECQkJPSAweDAxLAorCUhNTV9ETUlS
Uk9SX1BST1RfV1JJVEUJCQk9IDB4MDIsCisJSE1NX0RNSVJST1JfUFJPVF9aRVJPCQkJPSAweDEw
LAorCUhNTV9ETUlSUk9SX1BST1RfREVWX1BSSVZBVEVfTE9DQUwgICAgICA9IDB4MjAsCisJSE1N
X0RNSVJST1JfUFJPVF9ERVZfUFJJVkFURV9SRU1PVEUgICAgID0gMHgzMCwKK307CisKKyNlbmRp
ZiAvKiBfVUFQSV9MSU5VWF9ITU1fRE1JUlJPUl9IICovCmRpZmYgLS1naXQgYS90b29scy90ZXN0
aW5nL3NlbGZ0ZXN0cy92bS8uZ2l0aWdub3JlIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0v
LmdpdGlnbm9yZQppbmRleCAzMWIzYzk4YjZkMzQuLjMwNTQ1NjViM2YwNyAxMDA2NDQKLS0tIGEv
dG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vLmdpdGlnbm9yZQorKysgYi90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy92bS8uZ2l0aWdub3JlCkBAIC0xNCwzICsxNCw0IEBAIHZpcnR1YWxfYWRkcmVz
c19yYW5nZQogZ3VwX2JlbmNobWFyawogdmFfMTI4VEJzd2l0Y2gKIG1hcF9maXhlZF9ub3JlcGxh
Y2UKK2htbS10ZXN0cwpkaWZmIC0tZ2l0IGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vTWFr
ZWZpbGUgYi90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy92bS9NYWtlZmlsZQppbmRleCA5NTM0ZGMy
YmM5MjkuLjU2NDNjZmI1ZTNkNiAxMDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMv
dm0vTWFrZWZpbGUKKysrIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vTWFrZWZpbGUKQEAg
LTUsNiArNSw3IEBAIENGTEFHUyA9IC1XYWxsIC1JIC4uLy4uLy4uLy4uL3Vzci9pbmNsdWRlICQo
RVhUUkFfQ0ZMQUdTKQogTERMSUJTID0gLWxydAogVEVTVF9HRU5fRklMRVMgPSBjb21wYWN0aW9u
X3Rlc3QKIFRFU1RfR0VOX0ZJTEVTICs9IGd1cF9iZW5jaG1hcmsKK1RFU1RfR0VOX0ZJTEVTICs9
IGhtbS10ZXN0cwogVEVTVF9HRU5fRklMRVMgKz0gaHVnZXBhZ2UtbW1hcAogVEVTVF9HRU5fRklM
RVMgKz0gaHVnZXBhZ2Utc2htCiBURVNUX0dFTl9GSUxFUyArPSBtYXBfaHVnZXRsYgpAQCAtMjYs
NiArMjcsOCBAQCBURVNUX0ZJTEVTIDo9IHRlc3Rfdm1hbGxvYy5zaAogS1NGVF9LSERSX0lOU1RB
TEwgOj0gMQogaW5jbHVkZSAuLi9saWIubWsKIAorJChPVVRQVVQpL2htbS10ZXN0czogTERMSUJT
ICs9IC1saHVnZXRsYmZzIC1scHRocmVhZAorCiAkKE9VVFBVVCkvdXNlcmZhdWx0ZmQ6IExETElC
UyArPSAtbHB0aHJlYWQKIAogJChPVVRQVVQpL21sb2NrLXJhbmRvbS10ZXN0OiBMRExJQlMgKz0g
LWxjYXAKZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL2NvbmZpZyBiL3Rv
b2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL2NvbmZpZwppbmRleCAxYzBkNzZjYjVhZGYuLjM0Y2Zh
YjE4ZTczNyAxMDA2NDQKLS0tIGEvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vY29uZmlnCisr
KyBiL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL2NvbmZpZwpAQCAtMSwyICsxLDUgQEAKIENP
TkZJR19TWVNWSVBDPXkKIENPTkZJR19VU0VSRkFVTFRGRD15CitDT05GSUdfSE1NX01JUlJPUj15
CitDT05GSUdfREVWSUNFX1BSSVZBVEU9eQorQ09ORklHX0hNTV9ETUlSUk9SPW0KZGlmZiAtLWdp
dCBhL3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL2htbS10ZXN0cy5jIGIvdG9vbHMvdGVzdGlu
Zy9zZWxmdGVzdHMvdm0vaG1tLXRlc3RzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi43ODc1NmU3MmU1YzIKLS0tIC9kZXYvbnVsbAorKysgYi90b29scy90ZXN0aW5n
L3NlbGZ0ZXN0cy92bS9obW0tdGVzdHMuYwpAQCAtMCwwICsxLDEzMDQgQEAKKy8vIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0IDIwMTMgUmVkIEhhdCBJ
bmMuCisgKgorICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0
cmlidXRlIGl0IGFuZC9vcgorICogbW9kaWZ5IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05V
IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMKKyAqIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0
d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mCisgKiB0aGUgTGljZW5zZSwgb3Ig
KGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKyAqCisgKiBUaGlzIHByb2dyYW0g
aXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1
dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5
IG9mCisgKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBP
U0UuICBTZWUgdGhlCisgKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRh
aWxzLgorICoKKyAqIEF1dGhvcnM6IErDqXLDtG1lIEdsaXNzZSA8amdsaXNzZUByZWRoYXQuY29t
PgorICovCisKKy8qCisgKiBITU0gc3RhbmRzIGZvciBIZXRlcm9nZW5lb3VzIE1lbW9yeSBNYW5h
Z2VtZW50LCBpdCBpcyBhIGhlbHBlciBsYXllciBpbnNpZGUKKyAqIHRoZSBsaW51eCBrZXJuZWwg
dG8gaGVscCBkZXZpY2UgZHJpdmVycyBtaXJyb3IgYSBwcm9jZXNzIGFkZHJlc3Mgc3BhY2UgaW4K
KyAqIHRoZSBkZXZpY2UuIFRoaXMgYWxsb3dzIHRoZSBkZXZpY2UgdG8gdXNlIHRoZSBzYW1lIGFk
ZHJlc3Mgc3BhY2Ugd2hpY2gKKyAqIG1ha2VzIGNvbW11bmljYXRpb24gYW5kIGRhdGEgZXhjaGFu
Z2UgYSBsb3QgZWFzaWVyLgorICoKKyAqIFRoaXMgZnJhbWV3b3JrJ3Mgc29sZSBwdXJwb3NlIGlz
IHRvIGV4ZXJjaXNlIHZhcmlvdXMgY29kZSBwYXRocyBpbnNpZGUKKyAqIHRoZSBrZXJuZWwgdG8g
bWFrZSBzdXJlIHRoYXQgSE1NIHBlcmZvcm1zIGFzIGV4cGVjdGVkIGFuZCB0byBmbHVzaCBvdXQg
YW55CisgKiBidWdzLgorICovCisKKyNpbmNsdWRlICIuLi9rc2VsZnRlc3RfaGFybmVzcy5oIgor
CisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUgPHN0ZGlv
Lmg+CisjaW5jbHVkZSA8c3RkbGliLmg+CisjaW5jbHVkZSA8c3RkaW50Lmg+CisjaW5jbHVkZSA8
dW5pc3RkLmg+CisjaW5jbHVkZSA8c3RyaW5ncy5oPgorI2luY2x1ZGUgPHRpbWUuaD4KKyNpbmNs
dWRlIDxwdGhyZWFkLmg+CisjaW5jbHVkZSA8aHVnZXRsYmZzLmg+CisjaW5jbHVkZSA8c3lzL3R5
cGVzLmg+CisjaW5jbHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRlIDxzeXMvbW1hbi5oPgorI2lu
Y2x1ZGUgPHN5cy9pb2N0bC5oPgorI2luY2x1ZGUgPGxpbnV4L2htbV9kbWlycm9yLmg+CisKK3N0
cnVjdCBobW1fYnVmZmVyIHsKKwl2b2lkCQkqcHRyOworCXZvaWQJCSptaXJyb3I7CisJdW5zaWdu
ZWQgbG9uZwlzaXplOworCWludAkJZmQ7CisJdWludDY0X3QJY3BhZ2VzOworCXVpbnQ2NF90CWZh
dWx0czsKK307CisKKyNkZWZpbmUgVFdPTUVHCQkoMSA8PCAyMSkKKyNkZWZpbmUgSE1NX0JVRkZF
Ul9TSVpFICgxMDI0IDw8IDEyKQorI2RlZmluZSBITU1fUEFUSF9NQVggICAgNjQKKyNkZWZpbmUg
TlRJTUVTCQkyNTYKKworI2RlZmluZSBBTElHTih4LCBhKSAoKCh4KSArIChhIC0gMSkpICYgKH4o
KGEpIC0gMSkpKQorCitGSVhUVVJFKGhtbSkKK3sKKwlpbnQJCWZkOworCXVuc2lnbmVkIGludAlw
YWdlX3NpemU7CisJdW5zaWduZWQgaW50CXBhZ2Vfc2hpZnQ7Cit9OworCitGSVhUVVJFKGhtbTIp
Cit7CisJaW50CQlmZDA7CisJaW50CQlmZDE7CisJdW5zaWduZWQgaW50CXBhZ2Vfc2l6ZTsKKwl1
bnNpZ25lZCBpbnQJcGFnZV9zaGlmdDsKK307CisKK3N0YXRpYyBpbnQgaG1tX29wZW4oaW50IHVu
aXQpCit7CisJY2hhciBwYXRobmFtZVtITU1fUEFUSF9NQVhdOworCWludCBmZDsKKworCXNucHJp
bnRmKHBhdGhuYW1lLCBzaXplb2YocGF0aG5hbWUpLCAiL2Rldi9obW1fZG1pcnJvciVkIiwgdW5p
dCk7CisJZmQgPSBvcGVuKHBhdGhuYW1lLCBPX1JEV1IsIDApOworCWlmIChmZCA8IDApCisJCWZw
cmludGYoc3RkZXJyLCAiY291bGQgbm90IG9wZW4gaG1tIGRtaXJyb3IgZHJpdmVyICglcylcbiIs
CisJCQlwYXRobmFtZSk7CisJcmV0dXJuIGZkOworfQorCitGSVhUVVJFX1NFVFVQKGhtbSkKK3sK
KwlzZWxmLT5wYWdlX3NpemUgPSBzeXNjb25mKF9TQ19QQUdFX1NJWkUpOworCXNlbGYtPnBhZ2Vf
c2hpZnQgPSBmZnMoc2VsZi0+cGFnZV9zaXplKSAtIDE7CisKKwlzZWxmLT5mZCA9IGhtbV9vcGVu
KDApOworCUFTU0VSVF9HRShzZWxmLT5mZCwgMCk7Cit9CisKK0ZJWFRVUkVfU0VUVVAoaG1tMikK
K3sKKwlzZWxmLT5wYWdlX3NpemUgPSBzeXNjb25mKF9TQ19QQUdFX1NJWkUpOworCXNlbGYtPnBh
Z2Vfc2hpZnQgPSBmZnMoc2VsZi0+cGFnZV9zaXplKSAtIDE7CisKKwlzZWxmLT5mZDAgPSBobW1f
b3BlbigwKTsKKwlBU1NFUlRfR0Uoc2VsZi0+ZmQwLCAwKTsKKwlzZWxmLT5mZDEgPSBobW1fb3Bl
bigxKTsKKwlBU1NFUlRfR0Uoc2VsZi0+ZmQxLCAwKTsKK30KKworRklYVFVSRV9URUFSRE9XTiho
bW0pCit7CisJaW50IHJldCA9IGNsb3NlKHNlbGYtPmZkKTsKKworCUFTU0VSVF9FUShyZXQsIDAp
OworCXNlbGYtPmZkID0gLTE7Cit9CisKK0ZJWFRVUkVfVEVBUkRPV04oaG1tMikKK3sKKwlpbnQg
cmV0ID0gY2xvc2Uoc2VsZi0+ZmQwKTsKKworCUFTU0VSVF9FUShyZXQsIDApOworCXNlbGYtPmZk
MCA9IC0xOworCisJcmV0ID0gY2xvc2Uoc2VsZi0+ZmQxKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsK
KwlzZWxmLT5mZDEgPSAtMTsKK30KKworc3RhdGljIGludCBobW1fZG1pcnJvcl9jbWQoaW50IGZk
LAorCQkJICAgdW5zaWduZWQgbG9uZyByZXF1ZXN0LAorCQkJICAgc3RydWN0IGhtbV9idWZmZXIg
KmJ1ZmZlciwKKwkJCSAgIHVuc2lnbmVkIGxvbmcgbnBhZ2VzKQoreworCXN0cnVjdCBobW1fZG1p
cnJvcl9jbWQgY21kOworCWludCByZXQ7CisKKwkvKiBTaW11bGF0ZSBhIGRldmljZSByZWFkaW5n
IHN5c3RlbSBtZW1vcnkuICovCisJY21kLmFkZHIgPSAoX191NjQpYnVmZmVyLT5wdHI7CisJY21k
LnB0ciA9IChfX3U2NClidWZmZXItPm1pcnJvcjsKKwljbWQubnBhZ2VzID0gbnBhZ2VzOworCisJ
Zm9yICg7OykgeworCQlyZXQgPSBpb2N0bChmZCwgcmVxdWVzdCwgJmNtZCk7CisJCWlmIChyZXQg
PT0gMCkKKwkJCWJyZWFrOworCQlpZiAoZXJybm8gPT0gRUlOVFIpCisJCQljb250aW51ZTsKKwkJ
cmV0dXJuIC1lcnJubzsKKwl9CisJYnVmZmVyLT5jcGFnZXMgPSBjbWQuY3BhZ2VzOworCWJ1ZmZl
ci0+ZmF1bHRzID0gY21kLmZhdWx0czsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBo
bW1fYnVmZmVyX2ZyZWUoc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlcikKK3sKKwlpZiAoYnVmZmVy
ID09IE5VTEwpCisJCXJldHVybjsKKworCWlmIChidWZmZXItPnB0cikKKwkJbXVubWFwKGJ1ZmZl
ci0+cHRyLCBidWZmZXItPnNpemUpOworCWZyZWUoYnVmZmVyLT5taXJyb3IpOworCWZyZWUoYnVm
ZmVyKTsKK30KKworLyoKKyAqIENyZWF0ZSBhIHRlbXBvcmFyeSBmaWxlIHRoYXQgd2lsbCBiZSBk
ZWxldGVkIG9uIGNsb3NlLgorICovCitzdGF0aWMgaW50IGhtbV9jcmVhdGVfZmlsZSh1bnNpZ25l
ZCBsb25nIHNpemUpCit7CisJY2hhciBwYXRoW0hNTV9QQVRIX01BWF07CisJaW50IGZkOworCisJ
c3RyY3B5KHBhdGgsICIvdG1wIik7CisJZmQgPSBvcGVuKHBhdGgsIE9fVE1QRklMRSB8IE9fRVhD
TCB8IE9fUkRXUiwgMDYwMCk7CisJaWYgKGZkID49IDApIHsKKwkJaW50IHI7CisKKwkJZG8gewor
CQkJciA9IGZ0cnVuY2F0ZShmZCwgc2l6ZSk7CisJCX0gd2hpbGUgKHIgPT0gLTEgJiYgZXJybm8g
PT0gRUlOVFIpOworCQlpZiAoIXIpCisJCQlyZXR1cm4gZmQ7CisJCWNsb3NlKGZkKTsKKwl9CisJ
cmV0dXJuIC0xOworfQorCisvKgorICogUmV0dXJuIGEgcmFuZG9tIHVuc2lnbmVkIG51bWJlci4K
KyAqLworc3RhdGljIHVuc2lnbmVkIGludCBobW1fcmFuZG9tKHZvaWQpCit7CisJc3RhdGljIGlu
dCBmZCA9IC0xOworCXVuc2lnbmVkIGludCByOworCisJaWYgKGZkIDwgMCkgeworCQlmZCA9IG9w
ZW4oIi9kZXYvdXJhbmRvbSIsIE9fUkRPTkxZKTsKKwkJaWYgKGZkIDwgMCkgeworCQkJZnByaW50
ZihzdGRlcnIsICIlczolZCBmYWlsZWQgdG8gb3BlbiAvZGV2L3VyYW5kb21cbiIsCisJCQkJCV9f
RklMRV9fLCBfX0xJTkVfXyk7CisJCQlyZXR1cm4gfjBVOworCQl9CisJfQorCXJlYWQoZmQsICZy
LCBzaXplb2YocikpOworCXJldHVybiByOworfQorCitzdGF0aWMgdm9pZCBobW1fbmFub3NsZWVw
KHVuc2lnbmVkIGludCBuKQoreworCXN0cnVjdCB0aW1lc3BlYyB0OworCisJdC50dl9zZWMgPSAw
OworCXQudHZfbnNlYyA9IG47CisJbmFub3NsZWVwKCZ0LCBOVUxMKTsKK30KKworLyoKKyAqIFJl
YWQgcHJpdmF0ZSBhbm9ueW1vdXMgbWVtb3J5LgorICovCitURVNUX0YoaG1tLCBhbm9uX3JlYWQp
Cit7CisJc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlcjsKKwl1bnNpZ25lZCBsb25nIG5wYWdlczsK
Kwl1bnNpZ25lZCBsb25nIHNpemU7CisJdW5zaWduZWQgbG9uZyBpOworCWludCAqcHRyOworCWlu
dCByZXQ7CisJaW50IHZhbDsKKworCW5wYWdlcyA9IEFMSUdOKEhNTV9CVUZGRVJfU0laRSwgc2Vs
Zi0+cGFnZV9zaXplKSA+PiBzZWxmLT5wYWdlX3NoaWZ0OworCUFTU0VSVF9ORShucGFnZXMsIDAp
OworCXNpemUgPSBucGFnZXMgPDwgc2VsZi0+cGFnZV9zaGlmdDsKKworCWJ1ZmZlciA9IG1hbGxv
YyhzaXplb2YoKmJ1ZmZlcikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwpOworCisJYnVmZmVy
LT5mZCA9IC0xOworCWJ1ZmZlci0+c2l6ZSA9IHNpemU7CisJYnVmZmVyLT5taXJyb3IgPSBtYWxs
b2Moc2l6ZSk7CisJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCWJ1ZmZlci0+
cHRyID0gbW1hcChOVUxMLCBzaXplLAorCQkJICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKKwkJ
CSAgIE1BUF9QUklWQVRFIHwgTUFQX0FOT05ZTU9VUywKKwkJCSAgIGJ1ZmZlci0+ZmQsIDApOwor
CUFTU0VSVF9ORShidWZmZXItPnB0ciwgTUFQX0ZBSUxFRCk7CisKKwkvKgorCSAqIEluaXRpYWxp
emUgYnVmZmVyIGluIHN5c3RlbSBtZW1vcnkgYnV0IGxlYXZlIHRoZSBmaXJzdCB0d28gcGFnZXMK
KwkgKiB6ZXJvIChwdGVfbm9uZSBhbmQgcGZuX3plcm8pLgorCSAqLworCWkgPSAyICogc2VsZi0+
cGFnZV9zaXplIC8gc2l6ZW9mKCpwdHIpOworCWZvciAocHRyID0gYnVmZmVyLT5wdHI7IGkgPCBz
aXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IGk7CisKKwkvKiBTZXQgYnVmZmVy
IHBlcm1pc3Npb24gdG8gcmVhZC1vbmx5LiAqLworCXJldCA9IG1wcm90ZWN0KGJ1ZmZlci0+cHRy
LCBzaXplLCBQUk9UX1JFQUQpOworCUFTU0VSVF9FUShyZXQsIDApOworCisJLyogUG9wdWxhdGUg
dGhlIENQVSBwYWdlIHRhYmxlIHdpdGggYSBzcGVjaWFsIHplcm8gcGFnZS4gKi8KKwl2YWwgPSAq
KGludCAqKShidWZmZXItPnB0ciArIHNlbGYtPnBhZ2Vfc2l6ZSk7CisJQVNTRVJUX0VRKHZhbCwg
MCk7CisKKwkvKiBTaW11bGF0ZSBhIGRldmljZSByZWFkaW5nIHN5c3RlbSBtZW1vcnkuICovCisJ
cmV0ID0gaG1tX2RtaXJyb3JfY21kKHNlbGYtPmZkLCBITU1fRE1JUlJPUl9SRUFELCBidWZmZXIs
IG5wYWdlcyk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJQVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2Vz
LCBucGFnZXMpOworCUFTU0VSVF9FUShidWZmZXItPmZhdWx0cywgMSk7CisKKwkvKiBDaGVjayB3
aGF0IHRoZSBkZXZpY2UgcmVhZC4gKi8KKwlwdHIgPSBidWZmZXItPm1pcnJvcjsKKwlmb3IgKGkg
PSAwOyBpIDwgMiAqIHNlbGYtPnBhZ2Vfc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NF
UlRfRVEocHRyW2ldLCAwKTsKKwlmb3IgKDsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsraSkK
KwkJQVNTRVJUX0VRKHB0cltpXSwgaSk7CisKKwlobW1fYnVmZmVyX2ZyZWUoYnVmZmVyKTsKK30K
KworLyoKKyAqIFJlYWQgcHJpdmF0ZSBhbm9ueW1vdXMgbWVtb3J5IHdoaWNoIGhhcyBiZWVuIHBy
b3RlY3RlZCB3aXRoCisgKiBtcHJvdGVjdCgpIFBST1RfTk9ORS4KKyAqLworVEVTVF9GKGhtbSwg
YW5vbl9yZWFkX3Byb3QpCit7CisJc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlcjsKKwl1bnNpZ25l
ZCBsb25nIG5wYWdlczsKKwl1bnNpZ25lZCBsb25nIHNpemU7CisJdW5zaWduZWQgbG9uZyBpOwor
CWludCAqcHRyOworCWludCByZXQ7CisKKwlucGFnZXMgPSBBTElHTihITU1fQlVGRkVSX1NJWkUs
IHNlbGYtPnBhZ2Vfc2l6ZSkgPj4gc2VsZi0+cGFnZV9zaGlmdDsKKwlBU1NFUlRfTkUobnBhZ2Vz
LCAwKTsKKwlzaXplID0gbnBhZ2VzIDw8IHNlbGYtPnBhZ2Vfc2hpZnQ7CisKKwlidWZmZXIgPSBt
YWxsb2Moc2l6ZW9mKCpidWZmZXIpKTsKKwlBU1NFUlRfTkUoYnVmZmVyLCBOVUxMKTsKKworCWJ1
ZmZlci0+ZmQgPSAtMTsKKwlidWZmZXItPnNpemUgPSBzaXplOworCWJ1ZmZlci0+bWlycm9yID0g
bWFsbG9jKHNpemUpOworCUFTU0VSVF9ORShidWZmZXItPm1pcnJvciwgTlVMTCk7CisKKwlidWZm
ZXItPnB0ciA9IG1tYXAoTlVMTCwgc2l6ZSwKKwkJCSAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUs
CisJCQkgICBNQVBfUFJJVkFURSB8IE1BUF9BTk9OWU1PVVMsCisJCQkgICBidWZmZXItPmZkLCAw
KTsKKwlBU1NFUlRfTkUoYnVmZmVyLT5wdHIsIE1BUF9GQUlMRUQpOworCisJLyogSW5pdGlhbGl6
ZSBidWZmZXIgaW4gc3lzdGVtIG1lbW9yeS4gKi8KKwlmb3IgKGkgPSAwLCBwdHIgPSBidWZmZXIt
PnB0cjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsraSkKKwkJcHRyW2ldID0gaTsKKworCS8q
IEluaXRpYWxpemUgbWlycm9yIGJ1ZmZlciBzbyB3ZSBjYW4gdmVyaWZ5IGl0IGlzbid0IHdyaXR0
ZW4uICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5taXJyb3I7IGkgPCBzaXplIC8gc2l6
ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IC1pOworCisJLyogUHJvdGVjdCBidWZmZXIgZnJv
bSByZWFkaW5nLiAqLworCXJldCA9IG1wcm90ZWN0KGJ1ZmZlci0+cHRyLCBzaXplLCBQUk9UX05P
TkUpOworCUFTU0VSVF9FUShyZXQsIDApOworCisJLyogU2ltdWxhdGUgYSBkZXZpY2UgcmVhZGlu
ZyBzeXN0ZW0gbWVtb3J5LiAqLworCXJldCA9IGhtbV9kbWlycm9yX2NtZChzZWxmLT5mZCwgSE1N
X0RNSVJST1JfUkVBRCwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VSVF9FUShyZXQsIC1FRkFVTFQp
OworCisJLyogQWxsb3cgQ1BVIHRvIHJlYWQgdGhlIGJ1ZmZlciBzbyB3ZSBjYW4gY2hlY2sgaXQu
ICovCisJcmV0ID0gbXByb3RlY3QoYnVmZmVyLT5wdHIsIHNpemUsIFBST1RfUkVBRCk7CisJQVNT
RVJUX0VRKHJldCwgMCk7CisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBzaXpl
IC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCisJLyogQ2hl
Y2sgd2hhdCB0aGUgZGV2aWNlIHJlYWQuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5t
aXJyb3I7IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0s
IC1pKTsKKworCWhtbV9idWZmZXJfZnJlZShidWZmZXIpOworfQorCisvKgorICogV3JpdGUgcHJp
dmF0ZSBhbm9ueW1vdXMgbWVtb3J5LgorICovCitURVNUX0YoaG1tLCBhbm9uX3dyaXRlKQorewor
CXN0cnVjdCBobW1fYnVmZmVyICpidWZmZXI7CisJdW5zaWduZWQgbG9uZyBucGFnZXM7CisJdW5z
aWduZWQgbG9uZyBzaXplOworCXVuc2lnbmVkIGxvbmcgaTsKKwlpbnQgKnB0cjsKKwlpbnQgcmV0
OworCisJbnBhZ2VzID0gQUxJR04oSE1NX0JVRkZFUl9TSVpFLCBzZWxmLT5wYWdlX3NpemUpID4+
IHNlbGYtPnBhZ2Vfc2hpZnQ7CisJQVNTRVJUX05FKG5wYWdlcywgMCk7CisJc2l6ZSA9IG5wYWdl
cyA8PCBzZWxmLT5wYWdlX3NoaWZ0OworCisJYnVmZmVyID0gbWFsbG9jKHNpemVvZigqYnVmZmVy
KSk7CisJQVNTRVJUX05FKGJ1ZmZlciwgTlVMTCk7CisKKwlidWZmZXItPmZkID0gLTE7CisJYnVm
ZmVyLT5zaXplID0gc2l6ZTsKKwlidWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsKKwlBU1NF
UlRfTkUoYnVmZmVyLT5taXJyb3IsIE5VTEwpOworCisJYnVmZmVyLT5wdHIgPSBtbWFwKE5VTEws
IHNpemUsCisJCQkgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJICAgTUFQX1BSSVZBVEUg
fCBNQVBfQU5PTllNT1VTLAorCQkJICAgYnVmZmVyLT5mZCwgMCk7CisJQVNTRVJUX05FKGJ1ZmZl
ci0+cHRyLCBNQVBfRkFJTEVEKTsKKworCS8qIEluaXRpYWxpemUgZGF0YSB0aGF0IHRoZSBkZXZp
Y2Ugd2lsbCB3cml0ZSB0byBidWZmZXItPnB0ci4gKi8KKwlmb3IgKGkgPSAwLCBwdHIgPSBidWZm
ZXItPm1pcnJvcjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsraSkKKwkJcHRyW2ldID0gaTsK
KworCS8qIFNpbXVsYXRlIGEgZGV2aWNlIHdyaXRpbmcgc3lzdGVtIG1lbW9yeS4gKi8KKwlyZXQg
PSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQsIEhNTV9ETUlSUk9SX1dSSVRFLCBidWZmZXIsIG5w
YWdlcyk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJQVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2VzLCBu
cGFnZXMpOworCUFTU0VSVF9FUShidWZmZXItPmZhdWx0cywgMSk7CisKKwkvKiBDaGVjayB3aGF0
IHRoZSBkZXZpY2Ugd3JvdGUuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkg
PCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCisJ
aG1tX2J1ZmZlcl9mcmVlKGJ1ZmZlcik7Cit9CisKKy8qCisgKiBXcml0ZSBwcml2YXRlIGFub255
bW91cyBtZW1vcnkgd2hpY2ggaGFzIGJlZW4gcHJvdGVjdGVkIHdpdGgKKyAqIG1wcm90ZWN0KCkg
UFJPVF9SRUFELgorICovCitURVNUX0YoaG1tLCBhbm9uX3dyaXRlX3Byb3QpCit7CisJc3RydWN0
IGhtbV9idWZmZXIgKmJ1ZmZlcjsKKwl1bnNpZ25lZCBsb25nIG5wYWdlczsKKwl1bnNpZ25lZCBs
b25nIHNpemU7CisJdW5zaWduZWQgbG9uZyBpOworCWludCAqcHRyOworCWludCByZXQ7CisKKwlu
cGFnZXMgPSBBTElHTihITU1fQlVGRkVSX1NJWkUsIHNlbGYtPnBhZ2Vfc2l6ZSkgPj4gc2VsZi0+
cGFnZV9zaGlmdDsKKwlBU1NFUlRfTkUobnBhZ2VzLCAwKTsKKwlzaXplID0gbnBhZ2VzIDw8IHNl
bGYtPnBhZ2Vfc2hpZnQ7CisKKwlidWZmZXIgPSBtYWxsb2Moc2l6ZW9mKCpidWZmZXIpKTsKKwlB
U1NFUlRfTkUoYnVmZmVyLCBOVUxMKTsKKworCWJ1ZmZlci0+ZmQgPSAtMTsKKwlidWZmZXItPnNp
emUgPSBzaXplOworCWJ1ZmZlci0+bWlycm9yID0gbWFsbG9jKHNpemUpOworCUFTU0VSVF9ORShi
dWZmZXItPm1pcnJvciwgTlVMTCk7CisKKwlidWZmZXItPnB0ciA9IG1tYXAoTlVMTCwgc2l6ZSwK
KwkJCSAgIFBST1RfUkVBRCwKKwkJCSAgIE1BUF9QUklWQVRFIHwgTUFQX0FOT05ZTU9VUywKKwkJ
CSAgIGJ1ZmZlci0+ZmQsIDApOworCUFTU0VSVF9ORShidWZmZXItPnB0ciwgTUFQX0ZBSUxFRCk7
CisKKwkvKiBTaW11bGF0ZSBhIGRldmljZSByZWFkaW5nIGEgemVybyBwYWdlIG9mIG1lbW9yeS4g
Ki8KKwlyZXQgPSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQsIEhNTV9ETUlSUk9SX1JFQUQsIGJ1
ZmZlciwgMSk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJQVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2Vz
LCAxKTsKKwlBU1NFUlRfRVEoYnVmZmVyLT5mYXVsdHMsIDEpOworCisJLyogSW5pdGlhbGl6ZSBk
YXRhIHRoYXQgdGhlIGRldmljZSB3aWxsIHdyaXRlIHRvIGJ1ZmZlci0+cHRyLiAqLworCWZvciAo
aSA9IDAsIHB0ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytp
KQorCQlwdHJbaV0gPSBpOworCisJLyogU2ltdWxhdGUgYSBkZXZpY2Ugd3JpdGluZyBzeXN0ZW0g
bWVtb3J5LiAqLworCXJldCA9IGhtbV9kbWlycm9yX2NtZChzZWxmLT5mZCwgSE1NX0RNSVJST1Jf
V1JJVEUsIGJ1ZmZlciwgbnBhZ2VzKTsKKwlBU1NFUlRfRVEocmV0LCAtRVBFUk0pOworCisJLyog
Q2hlY2sgd2hhdCB0aGUgZGV2aWNlIHdyb3RlLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZl
ci0+cHRyOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ld
LCAwKTsKKworCS8qIE5vdyBhbGxvdyB3cml0aW5nIGFuZCBzZWUgdGhhdCB0aGUgemVybyBwYWdl
IGlzIHJlcGxhY2VkLiAqLworCXJldCA9IG1wcm90ZWN0KGJ1ZmZlci0+cHRyLCBzaXplLCBQUk9U
X1dSSVRFIHwgUFJPVF9SRUFEKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKworCS8qIFNpbXVsYXRl
IGEgZGV2aWNlIHdyaXRpbmcgc3lzdGVtIG1lbW9yeS4gKi8KKwlyZXQgPSBobW1fZG1pcnJvcl9j
bWQoc2VsZi0+ZmQsIEhNTV9ETUlSUk9SX1dSSVRFLCBidWZmZXIsIG5wYWdlcyk7CisJQVNTRVJU
X0VRKHJldCwgMCk7CisJQVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2VzLCBucGFnZXMpOworCUFTU0VS
VF9FUShidWZmZXItPmZhdWx0cywgMSk7CisKKwkvKiBDaGVjayB3aGF0IHRoZSBkZXZpY2Ugd3Jv
dGUuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBzaXplIC8gc2l6ZW9m
KCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCisJaG1tX2J1ZmZlcl9mcmVl
KGJ1ZmZlcik7Cit9CisKKy8qCisgKiBDaGVjayB0aGF0IGEgZGV2aWNlIHdyaXRpbmcgYW4gYW5v
bnltb3VzIHByaXZhdGUgbWFwcGluZworICogd2lsbCBjb3B5LW9uLXdyaXRlIGlmIGEgY2hpbGQg
cHJvY2VzcyBpbmhlcml0cyB0aGUgbWFwcGluZy4KKyAqLworVEVTVF9GKGhtbSwgYW5vbl93cml0
ZV9jaGlsZCkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOworCXVuc2lnbmVkIGxvbmcg
bnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwl1bnNpZ25lZCBsb25nIGk7CisJaW50ICpw
dHI7CisJcGlkX3QgcGlkOworCWludCBjaGlsZF9mZDsKKwlpbnQgcmV0OworCisJbnBhZ2VzID0g
QUxJR04oSE1NX0JVRkZFUl9TSVpFLCBzZWxmLT5wYWdlX3NpemUpID4+IHNlbGYtPnBhZ2Vfc2hp
ZnQ7CisJQVNTRVJUX05FKG5wYWdlcywgMCk7CisJc2l6ZSA9IG5wYWdlcyA8PCBzZWxmLT5wYWdl
X3NoaWZ0OworCisJYnVmZmVyID0gbWFsbG9jKHNpemVvZigqYnVmZmVyKSk7CisJQVNTRVJUX05F
KGJ1ZmZlciwgTlVMTCk7CisKKwlidWZmZXItPmZkID0gLTE7CisJYnVmZmVyLT5zaXplID0gc2l6
ZTsKKwlidWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsKKwlBU1NFUlRfTkUoYnVmZmVyLT5t
aXJyb3IsIE5VTEwpOworCisJYnVmZmVyLT5wdHIgPSBtbWFwKE5VTEwsIHNpemUsCisJCQkgICBQ
Uk9UX1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJICAgTUFQX1BSSVZBVEUgfCBNQVBfQU5PTllNT1VT
LAorCQkJICAgYnVmZmVyLT5mZCwgMCk7CisJQVNTRVJUX05FKGJ1ZmZlci0+cHRyLCBNQVBfRkFJ
TEVEKTsKKworCS8qIEluaXRpYWxpemUgYnVmZmVyLT5wdHIgc28gd2UgY2FuIHRlbGwgaWYgaXQg
aXMgd3JpdHRlbi4gKi8KKwlmb3IgKGkgPSAwLCBwdHIgPSBidWZmZXItPnB0cjsgaSA8IHNpemUg
LyBzaXplb2YoKnB0cik7ICsraSkKKwkJcHRyW2ldID0gaTsKKworCS8qIEluaXRpYWxpemUgZGF0
YSB0aGF0IHRoZSBkZXZpY2Ugd2lsbCB3cml0ZSB0byBidWZmZXItPnB0ci4gKi8KKwlmb3IgKGkg
PSAwLCBwdHIgPSBidWZmZXItPm1pcnJvcjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsraSkK
KwkJcHRyW2ldID0gLWk7CisKKwlwaWQgPSBmb3JrKCk7CisJaWYgKHBpZCA9PSAtMSkKKwkJQVNT
RVJUX0VRKHBpZCwgMCk7CisJaWYgKHBpZCAhPSAwKSB7CisJCXdhaXRwaWQocGlkLCAmcmV0LCAw
KTsKKwkJQVNTRVJUX0VRKFdJRkVYSVRFRChyZXQpLCAxKTsKKworCQkvKiBDaGVjayB0aGF0IHRo
ZSBwYXJlbnQncyBidWZmZXIgZGlkIG5vdCBjaGFuZ2UuICovCisJCWZvciAoaSA9IDAsIHB0ciA9
IGJ1ZmZlci0+cHRyOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQkJQVNTRVJUX0VR
KHB0cltpXSwgaSk7CisJCXJldHVybjsKKwl9CisKKwkvKiBDaGVjayB0aGF0IHdlIHNlZSB0aGUg
cGFyZW50J3MgdmFsdWVzLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwg
c2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKwlmb3Ig
KGkgPSAwLCBwdHIgPSBidWZmZXItPm1pcnJvcjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsr
aSkKKwkJQVNTRVJUX0VRKHB0cltpXSwgLWkpOworCisJLyogVGhlIGNoaWxkIHByb2Nlc3MgbmVl
ZHMgaXRzIG93biBtaXJyb3IgdG8gaXRzIG93biBtbS4gKi8KKwljaGlsZF9mZCA9IGhtbV9vcGVu
KDApOworCUFTU0VSVF9HRShjaGlsZF9mZCwgMCk7CisKKwkvKiBTaW11bGF0ZSBhIGRldmljZSB3
cml0aW5nIHN5c3RlbSBtZW1vcnkuICovCisJcmV0ID0gaG1tX2RtaXJyb3JfY21kKGNoaWxkX2Zk
LCBITU1fRE1JUlJPUl9XUklURSwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VSVF9FUShyZXQsIDAp
OworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKwlBU1NFUlRfRVEoYnVmZmVy
LT5mYXVsdHMsIDEpOworCisJLyogQ2hlY2sgd2hhdCB0aGUgZGV2aWNlIHdyb3RlLiAqLworCWZv
ciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytp
KQorCQlBU1NFUlRfRVEocHRyW2ldLCAtaSk7CisKKwljbG9zZShjaGlsZF9mZCk7CisJZXhpdCgw
KTsKK30KKworLyoKKyAqIENoZWNrIHRoYXQgYSBkZXZpY2Ugd3JpdGluZyBhbiBhbm9ueW1vdXMg
c2hhcmVkIG1hcHBpbmcKKyAqIHdpbGwgbm90IGNvcHktb24td3JpdGUgaWYgYSBjaGlsZCBwcm9j
ZXNzIGluaGVyaXRzIHRoZSBtYXBwaW5nLgorICovCitURVNUX0YoaG1tLCBhbm9uX3dyaXRlX2No
aWxkX3NoYXJlZCkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOworCXVuc2lnbmVkIGxv
bmcgbnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwl1bnNpZ25lZCBsb25nIGk7CisJaW50
ICpwdHI7CisJcGlkX3QgcGlkOworCWludCBjaGlsZF9mZDsKKwlpbnQgcmV0OworCisJbnBhZ2Vz
ID0gQUxJR04oSE1NX0JVRkZFUl9TSVpFLCBzZWxmLT5wYWdlX3NpemUpID4+IHNlbGYtPnBhZ2Vf
c2hpZnQ7CisJQVNTRVJUX05FKG5wYWdlcywgMCk7CisJc2l6ZSA9IG5wYWdlcyA8PCBzZWxmLT5w
YWdlX3NoaWZ0OworCisJYnVmZmVyID0gbWFsbG9jKHNpemVvZigqYnVmZmVyKSk7CisJQVNTRVJU
X05FKGJ1ZmZlciwgTlVMTCk7CisKKwlidWZmZXItPmZkID0gLTE7CisJYnVmZmVyLT5zaXplID0g
c2l6ZTsKKwlidWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsKKwlBU1NFUlRfTkUoYnVmZmVy
LT5taXJyb3IsIE5VTEwpOworCisJYnVmZmVyLT5wdHIgPSBtbWFwKE5VTEwsIHNpemUsCisJCQkg
ICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJICAgTUFQX1NIQVJFRCB8IE1BUF9BTk9OWU1P
VVMsCisJCQkgICBidWZmZXItPmZkLCAwKTsKKwlBU1NFUlRfTkUoYnVmZmVyLT5wdHIsIE1BUF9G
QUlMRUQpOworCisJLyogSW5pdGlhbGl6ZSBidWZmZXItPnB0ciBzbyB3ZSBjYW4gdGVsbCBpZiBp
dCBpcyB3cml0dGVuLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwgc2l6
ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlwdHJbaV0gPSBpOworCisJLyogSW5pdGlhbGl6ZSBk
YXRhIHRoYXQgdGhlIGRldmljZSB3aWxsIHdyaXRlIHRvIGJ1ZmZlci0+cHRyLiAqLworCWZvciAo
aSA9IDAsIHB0ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytp
KQorCQlwdHJbaV0gPSAtaTsKKworCXBpZCA9IGZvcmsoKTsKKwlpZiAocGlkID09IC0xKQorCQlB
U1NFUlRfRVEocGlkLCAwKTsKKwlpZiAocGlkICE9IDApIHsKKwkJd2FpdHBpZChwaWQsICZyZXQs
IDApOworCQlBU1NFUlRfRVEoV0lGRVhJVEVEKHJldCksIDEpOworCisJCS8qIENoZWNrIHRoYXQg
dGhlIHBhcmVudCdzIGJ1ZmZlciBkaWQgY2hhbmdlLiAqLworCQlmb3IgKGkgPSAwLCBwdHIgPSBi
dWZmZXItPnB0cjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsraSkKKwkJCUFTU0VSVF9FUShw
dHJbaV0sIC1pKTsKKwkJcmV0dXJuOworCX0KKworCS8qIENoZWNrIHRoYXQgd2Ugc2VlIHRoZSBw
YXJlbnQncyB2YWx1ZXMuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBz
aXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCWZvciAo
aSA9IDAsIHB0ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytp
KQorCQlBU1NFUlRfRVEocHRyW2ldLCAtaSk7CisKKwkvKiBUaGUgY2hpbGQgcHJvY2VzcyBuZWVk
cyBpdHMgb3duIG1pcnJvciB0byBpdHMgb3duIG1tLiAqLworCWNoaWxkX2ZkID0gaG1tX29wZW4o
MCk7CisJQVNTRVJUX0dFKGNoaWxkX2ZkLCAwKTsKKworCS8qIFNpbXVsYXRlIGEgZGV2aWNlIHdy
aXRpbmcgc3lzdGVtIG1lbW9yeS4gKi8KKwlyZXQgPSBobW1fZG1pcnJvcl9jbWQoY2hpbGRfZmQs
IEhNTV9ETUlSUk9SX1dSSVRFLCBidWZmZXIsIG5wYWdlcyk7CisJQVNTRVJUX0VRKHJldCwgMCk7
CisJQVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2VzLCBucGFnZXMpOworCUFTU0VSVF9FUShidWZmZXIt
PmZhdWx0cywgMSk7CisKKwkvKiBDaGVjayB3aGF0IHRoZSBkZXZpY2Ugd3JvdGUuICovCisJZm9y
IChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kp
CisJCUFTU0VSVF9FUShwdHJbaV0sIC1pKTsKKworCWNsb3NlKGNoaWxkX2ZkKTsKKwlleGl0KDAp
OworfQorCisvKgorICogV3JpdGUgcHJpdmF0ZSBhbm9ueW1vdXMgaHVnZSBwYWdlLgorICovCitU
RVNUX0YoaG1tLCBhbm9uX3dyaXRlX2h1Z2UpCit7CisJc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZl
cjsKKwl1bnNpZ25lZCBsb25nIG5wYWdlczsKKwl1bnNpZ25lZCBsb25nIHNpemU7CisJdW5zaWdu
ZWQgbG9uZyBpOworCXZvaWQgKm9sZF9wdHI7CisJdm9pZCAqbWFwOworCWludCAqcHRyOworCWlu
dCByZXQ7CisKKwlzaXplID0gMiAqIFRXT01FRzsKKworCWJ1ZmZlciA9IG1hbGxvYyhzaXplb2Yo
KmJ1ZmZlcikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwpOworCisJYnVmZmVyLT5mZCA9IC0x
OworCWJ1ZmZlci0+c2l6ZSA9IHNpemU7CisJYnVmZmVyLT5taXJyb3IgPSBtYWxsb2Moc2l6ZSk7
CisJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCWJ1ZmZlci0+cHRyID0gbW1h
cChOVUxMLCBzaXplLAorCQkJICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKKwkJCSAgIE1BUF9Q
UklWQVRFIHwgTUFQX0FOT05ZTU9VUywKKwkJCSAgIGJ1ZmZlci0+ZmQsIDApOworCUFTU0VSVF9O
RShidWZmZXItPnB0ciwgTUFQX0ZBSUxFRCk7CisKKwlzaXplID0gVFdPTUVHOworCW5wYWdlcyA9
IHNpemUgPj4gc2VsZi0+cGFnZV9zaGlmdDsKKwltYXAgPSAodm9pZCAqKUFMSUdOKCh1aW50cHRy
X3QpYnVmZmVyLT5wdHIsIHNpemUpOworCXJldCA9IG1hZHZpc2UobWFwLCBzaXplLCBNQURWX0hV
R0VQQUdFKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKwlvbGRfcHRyID0gYnVmZmVyLT5wdHI7CisJ
YnVmZmVyLT5wdHIgPSBtYXA7CisKKwkvKiBJbml0aWFsaXplIGRhdGEgdGhhdCB0aGUgZGV2aWNl
IHdpbGwgd3JpdGUgdG8gYnVmZmVyLT5wdHIuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVy
LT5taXJyb3I7IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IGk7CisK
KwkvKiBTaW11bGF0ZSBhIGRldmljZSB3cml0aW5nIHN5c3RlbSBtZW1vcnkuICovCisJcmV0ID0g
aG1tX2RtaXJyb3JfY21kKHNlbGYtPmZkLCBITU1fRE1JUlJPUl9XUklURSwgYnVmZmVyLCBucGFn
ZXMpOworCUFTU0VSVF9FUShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBh
Z2VzKTsKKwlBU1NFUlRfRVEoYnVmZmVyLT5mYXVsdHMsIDEpOworCisJLyogQ2hlY2sgd2hhdCB0
aGUgZGV2aWNlIHdyb3RlLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwg
c2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKworCWJ1
ZmZlci0+cHRyID0gb2xkX3B0cjsKKwlobW1fYnVmZmVyX2ZyZWUoYnVmZmVyKTsKK30KKworLyoK
KyAqIFdyaXRlIGh1Z2UgVExCRlMgcGFnZS4KKyAqLworVEVTVF9GKGhtbSwgYW5vbl93cml0ZV9o
dWdldGxiZnMpCit7CisJc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlcjsKKwl1bnNpZ25lZCBsb25n
IG5wYWdlczsKKwl1bnNpZ25lZCBsb25nIHNpemU7CisJdW5zaWduZWQgbG9uZyBpOworCWludCAq
cHRyOworCWludCByZXQ7CisJbG9uZyBwYWdlc2l6ZXNbNF07CisJaW50IG4sIGlkeDsKKworCS8q
IFNraXAgdGVzdCBpZiB3ZSBjYW4ndCBhbGxvY2F0ZSBhIGh1Z2V0bGJmcyBwYWdlLiAqLworCisJ
biA9IGdldGh1Z2VwYWdlc2l6ZXMocGFnZXNpemVzLCA0KTsKKwlpZiAobiA8PSAwKQorCQlyZXR1
cm47CisJZm9yIChpZHggPSAwOyAtLW4gPiAwOyApIHsKKwkJaWYgKHBhZ2VzaXplc1tuXSA8IHBh
Z2VzaXplc1tpZHhdKQorCQkJaWR4ID0gbjsKKwl9CisJc2l6ZSA9IEFMSUdOKFRXT01FRywgcGFn
ZXNpemVzW2lkeF0pOworCW5wYWdlcyA9IHNpemUgPj4gc2VsZi0+cGFnZV9zaGlmdDsKKworCWJ1
ZmZlciA9IG1hbGxvYyhzaXplb2YoKmJ1ZmZlcikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwp
OworCisJYnVmZmVyLT5wdHIgPSBnZXRfaHVnZXBhZ2VfcmVnaW9uKHNpemUsIEdIUl9TVFJJQ1Qp
OworCWlmIChidWZmZXItPnB0ciA9PSBOVUxMKSB7CisJCWZyZWUoYnVmZmVyKTsKKwkJcmV0dXJu
OworCX0KKworCWJ1ZmZlci0+ZmQgPSAtMTsKKwlidWZmZXItPnNpemUgPSBzaXplOworCWJ1ZmZl
ci0+bWlycm9yID0gbWFsbG9jKHNpemUpOworCUFTU0VSVF9ORShidWZmZXItPm1pcnJvciwgTlVM
TCk7CisKKwkvKiBJbml0aWFsaXplIGRhdGEgdGhhdCB0aGUgZGV2aWNlIHdpbGwgd3JpdGUgdG8g
YnVmZmVyLT5wdHIuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5taXJyb3I7IGkgPCBz
aXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IGk7CisKKwkvKiBTaW11bGF0ZSBh
IGRldmljZSB3cml0aW5nIHN5c3RlbSBtZW1vcnkuICovCisJcmV0ID0gaG1tX2RtaXJyb3JfY21k
KHNlbGYtPmZkLCBITU1fRE1JUlJPUl9XUklURSwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VSVF9F
UShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKwlBU1NFUlRf
RVEoYnVmZmVyLT5mYXVsdHMsIDEpOworCisJLyogQ2hlY2sgd2hhdCB0aGUgZGV2aWNlIHdyb3Rl
LiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwgc2l6ZSAvIHNpemVvZigq
cHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKworCWZyZWVfaHVnZXBhZ2VfcmVn
aW9uKGJ1ZmZlci0+cHRyKTsKKwlidWZmZXItPnB0ciA9IE5VTEw7CisJaG1tX2J1ZmZlcl9mcmVl
KGJ1ZmZlcik7Cit9CisKKy8qCisgKiBSZWFkIG1tYXAnZWQgZmlsZSBtZW1vcnkuCisgKi8KK1RF
U1RfRihobW0sIGZpbGVfcmVhZCkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOworCXVu
c2lnbmVkIGxvbmcgbnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwl1bnNpZ25lZCBsb25n
IGk7CisJaW50ICpwdHI7CisJaW50IHJldDsKKwlpbnQgZmQ7CisJb2ZmX3Qgb2ZmOworCXNzaXpl
X3QgbGVuOworCisJbnBhZ2VzID0gQUxJR04oSE1NX0JVRkZFUl9TSVpFLCBzZWxmLT5wYWdlX3Np
emUpID4+IHNlbGYtPnBhZ2Vfc2hpZnQ7CisJQVNTRVJUX05FKG5wYWdlcywgMCk7CisJc2l6ZSA9
IG5wYWdlcyA8PCBzZWxmLT5wYWdlX3NoaWZ0OworCisJZmQgPSBobW1fY3JlYXRlX2ZpbGUoc2l6
ZSk7CisJQVNTRVJUX0dFKGZkLCAwKTsKKworCWJ1ZmZlciA9IG1hbGxvYyhzaXplb2YoKmJ1ZmZl
cikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwpOworCisJYnVmZmVyLT5mZCA9IGZkOworCWJ1
ZmZlci0+c2l6ZSA9IHNpemU7CisJYnVmZmVyLT5taXJyb3IgPSBtYWxsb2Moc2l6ZSk7CisJQVNT
RVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCS8qIFdyaXRlIGluaXRpYWwgY29udGVu
dHMgb2YgdGhlIGZpbGUuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5taXJyb3I7IGkg
PCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IGk7CisJb2ZmID0gbHNlZWso
ZmQsIDAsIFNFRUtfU0VUKTsKKwlBU1NFUlRfRVEob2ZmLCAwKTsKKwlsZW4gPSB3cml0ZShmZCwg
YnVmZmVyLT5taXJyb3IsIHNpemUpOworCUFTU0VSVF9FUShsZW4sIHNpemUpOworCW1lbXNldChi
dWZmZXItPm1pcnJvciwgMCwgc2l6ZSk7CisKKwlidWZmZXItPnB0ciA9IG1tYXAoTlVMTCwgc2l6
ZSwKKwkJCSAgIFBST1RfUkVBRCwKKwkJCSAgIE1BUF9TSEFSRUQsCisJCQkgICBidWZmZXItPmZk
LCAwKTsKKwlBU1NFUlRfTkUoYnVmZmVyLT5wdHIsIE1BUF9GQUlMRUQpOworCisJLyogU2ltdWxh
dGUgYSBkZXZpY2UgcmVhZGluZyBzeXN0ZW0gbWVtb3J5LiAqLworCXJldCA9IGhtbV9kbWlycm9y
X2NtZChzZWxmLT5mZCwgSE1NX0RNSVJST1JfUkVBRCwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VS
VF9FUShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKwlBU1NF
UlRfRVEoYnVmZmVyLT5mYXVsdHMsIDEpOworCisJLyogQ2hlY2sgd2hhdCB0aGUgZGV2aWNlIHJl
YWQuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5taXJyb3I7IGkgPCBzaXplIC8gc2l6
ZW9mKCpwdHIpOyArK2kpCisJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCisJaG1tX2J1ZmZlcl9m
cmVlKGJ1ZmZlcik7Cit9CisKKy8qCisgKiBXcml0ZSBtbWFwJ2VkIGZpbGUgbWVtb3J5LgorICov
CitURVNUX0YoaG1tLCBmaWxlX3dyaXRlKQoreworCXN0cnVjdCBobW1fYnVmZmVyICpidWZmZXI7
CisJdW5zaWduZWQgbG9uZyBucGFnZXM7CisJdW5zaWduZWQgbG9uZyBzaXplOworCXVuc2lnbmVk
IGxvbmcgaTsKKwlpbnQgKnB0cjsKKwlpbnQgcmV0OworCWludCBmZDsKKwlvZmZfdCBvZmY7CisJ
c3NpemVfdCBsZW47CisKKwlucGFnZXMgPSBBTElHTihITU1fQlVGRkVSX1NJWkUsIHNlbGYtPnBh
Z2Vfc2l6ZSkgPj4gc2VsZi0+cGFnZV9zaGlmdDsKKwlBU1NFUlRfTkUobnBhZ2VzLCAwKTsKKwlz
aXplID0gbnBhZ2VzIDw8IHNlbGYtPnBhZ2Vfc2hpZnQ7CisKKwlmZCA9IGhtbV9jcmVhdGVfZmls
ZShzaXplKTsKKwlBU1NFUlRfR0UoZmQsIDApOworCisJYnVmZmVyID0gbWFsbG9jKHNpemVvZigq
YnVmZmVyKSk7CisJQVNTRVJUX05FKGJ1ZmZlciwgTlVMTCk7CisKKwlidWZmZXItPmZkID0gZmQ7
CisJYnVmZmVyLT5zaXplID0gc2l6ZTsKKwlidWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsK
KwlBU1NFUlRfTkUoYnVmZmVyLT5taXJyb3IsIE5VTEwpOworCisJYnVmZmVyLT5wdHIgPSBtbWFw
KE5VTEwsIHNpemUsCisJCQkgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJICAgTUFQX1NI
QVJFRCwKKwkJCSAgIGJ1ZmZlci0+ZmQsIDApOworCUFTU0VSVF9ORShidWZmZXItPnB0ciwgTUFQ
X0ZBSUxFRCk7CisKKwkvKiBJbml0aWFsaXplIGRhdGEgdGhhdCB0aGUgZGV2aWNlIHdpbGwgd3Jp
dGUgdG8gYnVmZmVyLT5wdHIuICovCisJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5taXJyb3I7
IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kpCisJCXB0cltpXSA9IGk7CisKKwkvKiBTaW11
bGF0ZSBhIGRldmljZSB3cml0aW5nIHN5c3RlbSBtZW1vcnkuICovCisJcmV0ID0gaG1tX2RtaXJy
b3JfY21kKHNlbGYtPmZkLCBITU1fRE1JUlJPUl9XUklURSwgYnVmZmVyLCBucGFnZXMpOworCUFT
U0VSVF9FUShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKwlB
U1NFUlRfRVEoYnVmZmVyLT5mYXVsdHMsIDEpOworCisJLyogQ2hlY2sgd2hhdCB0aGUgZGV2aWNl
IHdyb3RlLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwgc2l6ZSAvIHNp
emVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKworCS8qIENoZWNrIHRo
YXQgdGhlIGRldmljZSBhbHNvIHdyb3RlIHRoZSBmaWxlLiAqLworCW9mZiA9IGxzZWVrKGZkLCAw
LCBTRUVLX1NFVCk7CisJQVNTRVJUX0VRKG9mZiwgMCk7CisJbGVuID0gcmVhZChmZCwgYnVmZmVy
LT5taXJyb3IsIHNpemUpOworCUFTU0VSVF9FUShsZW4sIHNpemUpOworCWZvciAoaSA9IDAsIHB0
ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NF
UlRfRVEocHRyW2ldLCBpKTsKKworCWhtbV9idWZmZXJfZnJlZShidWZmZXIpOworfQorCisvKgor
ICogTWlncmF0ZSBhbm9ueW1vdXMgbWVtb3J5IHRvIGRldmljZSBwcml2YXRlIG1lbW9yeS4KKyAq
LworVEVTVF9GKGhtbSwgbWlncmF0ZSkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOwor
CXVuc2lnbmVkIGxvbmcgbnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwl1bnNpZ25lZCBs
b25nIGk7CisJaW50ICpwdHI7CisJaW50IHJldDsKKworCW5wYWdlcyA9IEFMSUdOKEhNTV9CVUZG
RVJfU0laRSwgc2VsZi0+cGFnZV9zaXplKSA+PiBzZWxmLT5wYWdlX3NoaWZ0OworCUFTU0VSVF9O
RShucGFnZXMsIDApOworCXNpemUgPSBucGFnZXMgPDwgc2VsZi0+cGFnZV9zaGlmdDsKKworCWJ1
ZmZlciA9IG1hbGxvYyhzaXplb2YoKmJ1ZmZlcikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwp
OworCisJYnVmZmVyLT5mZCA9IC0xOworCWJ1ZmZlci0+c2l6ZSA9IHNpemU7CisJYnVmZmVyLT5t
aXJyb3IgPSBtYWxsb2Moc2l6ZSk7CisJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsK
KworCWJ1ZmZlci0+cHRyID0gbW1hcChOVUxMLCBzaXplLAorCQkJICAgUFJPVF9SRUFEIHwgUFJP
VF9XUklURSwKKwkJCSAgIE1BUF9QUklWQVRFIHwgTUFQX0FOT05ZTU9VUywKKwkJCSAgIGJ1ZmZl
ci0+ZmQsIDApOworCUFTU0VSVF9ORShidWZmZXItPnB0ciwgTUFQX0ZBSUxFRCk7CisKKwkvKiBJ
bml0aWFsaXplIGJ1ZmZlciBpbiBzeXN0ZW0gbWVtb3J5LiAqLworCWZvciAoaSA9IDAsIHB0ciA9
IGJ1ZmZlci0+cHRyOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlwdHJbaV0gPSBp
OworCisJLyogTWlncmF0ZSBtZW1vcnkgdG8gZGV2aWNlLiAqLworCXJldCA9IGhtbV9kbWlycm9y
X2NtZChzZWxmLT5mZCwgSE1NX0RNSVJST1JfTUlHUkFURSwgYnVmZmVyLCBucGFnZXMpOworCUFT
U0VSVF9FUShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKwor
CS8qIENoZWNrIHdoYXQgdGhlIGRldmljZSByZWFkLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1
ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEo
cHRyW2ldLCBpKTsKKworCWhtbV9idWZmZXJfZnJlZShidWZmZXIpOworfQorCisvKgorICogTWln
cmF0ZSBhbm9ueW1vdXMgbWVtb3J5IHRvIGRldmljZSBwcml2YXRlIG1lbW9yeSBhbmQgZmF1bHQg
aXQgYmFjayB0byBzeXN0ZW0KKyAqIG1lbW9yeS4KKyAqLworVEVTVF9GKGhtbSwgbWlncmF0ZV9m
YXVsdCkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOworCXVuc2lnbmVkIGxvbmcgbnBh
Z2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwl1bnNpZ25lZCBsb25nIGk7CisJaW50ICpwdHI7
CisJaW50IHJldDsKKworCW5wYWdlcyA9IEFMSUdOKEhNTV9CVUZGRVJfU0laRSwgc2VsZi0+cGFn
ZV9zaXplKSA+PiBzZWxmLT5wYWdlX3NoaWZ0OworCUFTU0VSVF9ORShucGFnZXMsIDApOworCXNp
emUgPSBucGFnZXMgPDwgc2VsZi0+cGFnZV9zaGlmdDsKKworCWJ1ZmZlciA9IG1hbGxvYyhzaXpl
b2YoKmJ1ZmZlcikpOworCUFTU0VSVF9ORShidWZmZXIsIE5VTEwpOworCisJYnVmZmVyLT5mZCA9
IC0xOworCWJ1ZmZlci0+c2l6ZSA9IHNpemU7CisJYnVmZmVyLT5taXJyb3IgPSBtYWxsb2Moc2l6
ZSk7CisJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCWJ1ZmZlci0+cHRyID0g
bW1hcChOVUxMLCBzaXplLAorCQkJICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwKKwkJCSAgIE1B
UF9QUklWQVRFIHwgTUFQX0FOT05ZTU9VUywKKwkJCSAgIGJ1ZmZlci0+ZmQsIDApOworCUFTU0VS
VF9ORShidWZmZXItPnB0ciwgTUFQX0ZBSUxFRCk7CisKKwkvKiBJbml0aWFsaXplIGJ1ZmZlciBp
biBzeXN0ZW0gbWVtb3J5LiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+cHRyOyBpIDwg
c2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlwdHJbaV0gPSBpOworCisJLyogTWlncmF0ZSBt
ZW1vcnkgdG8gZGV2aWNlLiAqLworCXJldCA9IGhtbV9kbWlycm9yX2NtZChzZWxmLT5mZCwgSE1N
X0RNSVJST1JfTUlHUkFURSwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VSVF9FUShyZXQsIDApOwor
CUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKworCS8qIENoZWNrIHdoYXQgdGhl
IGRldmljZSByZWFkLiAqLworCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwg
c2l6ZSAvIHNpemVvZigqcHRyKTsgKytpKQorCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKworCS8q
IEZhdWx0IHBhZ2VzIGJhY2sgdG8gc3lzdGVtIG1lbW9yeSBhbmQgY2hlY2sgdGhlbS4gKi8KKwlm
b3IgKGkgPSAwLCBwdHIgPSBidWZmZXItPnB0cjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsr
aSkKKwkJQVNTRVJUX0VRKHB0cltpXSwgaSk7CisKKwlobW1fYnVmZmVyX2ZyZWUoYnVmZmVyKTsK
K30KKworLyoKKyAqIFRyeSB0byBtaWdyYXRlIHZhcmlvdXMgbWVtb3J5IHR5cGVzIHRvIGRldmlj
ZSBwcml2YXRlIG1lbW9yeS4KKyAqLworVEVTVF9GKGhtbTIsIG1pZ3JhdGVfbWl4ZWQpCit7CisJ
c3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlcjsKKwl1bnNpZ25lZCBsb25nIG5wYWdlczsKKwl1bnNp
Z25lZCBsb25nIHNpemU7CisJaW50ICpwdHI7CisJdW5zaWduZWQgY2hhciAqcDsKKwlpbnQgcmV0
OworCWludCB2YWw7CisKKwlucGFnZXMgPSA2OworCXNpemUgPSBucGFnZXMgPDwgc2VsZi0+cGFn
ZV9zaGlmdDsKKworCWJ1ZmZlciA9IG1hbGxvYyhzaXplb2YoKmJ1ZmZlcikpOworCUFTU0VSVF9O
RShidWZmZXIsIE5VTEwpOworCisJYnVmZmVyLT5mZCA9IC0xOworCWJ1ZmZlci0+c2l6ZSA9IHNp
emU7CisJYnVmZmVyLT5taXJyb3IgPSBtYWxsb2Moc2l6ZSk7CisJQVNTRVJUX05FKGJ1ZmZlci0+
bWlycm9yLCBOVUxMKTsKKworCS8qIFJlc2VydmUgYSByYW5nZSBvZiBhZGRyZXNzZXMuICovCisJ
YnVmZmVyLT5wdHIgPSBtbWFwKE5VTEwsIHNpemUsCisJCQkgICBQUk9UX05PTkUsCisJCQkgICBN
QVBfUFJJVkFURSB8IE1BUF9BTk9OWU1PVVMsCisJCQkgICBidWZmZXItPmZkLCAwKTsKKwlBU1NF
UlRfTkUoYnVmZmVyLT5wdHIsIE1BUF9GQUlMRUQpOworCXAgPSBidWZmZXItPnB0cjsKKworCS8q
IE5vdyB0cnkgdG8gbWlncmF0ZSBldmVyeXRoaW5nIHRvIGRldmljZSAxLiAqLworCXJldCA9IGht
bV9kbWlycm9yX2NtZChzZWxmLT5mZDEsIEhNTV9ETUlSUk9SX01JR1JBVEUsIGJ1ZmZlciwgbnBh
Z2VzKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKwlBU1NFUlRfRVEoYnVmZmVyLT5jcGFnZXMsIDYp
OworCisJLyogUHVuY2ggYSBob2xlIGFmdGVyIHRoZSBmaXJzdCBwYWdlIGFkZHJlc3MuICovCisJ
cmV0ID0gbXVubWFwKGJ1ZmZlci0+cHRyICsgc2VsZi0+cGFnZV9zaXplLCBzZWxmLT5wYWdlX3Np
emUpOworCUFTU0VSVF9FUShyZXQsIDApOworCisJLyogV2UgZXhwZWN0IGFuIGVycm9yIGlmIHRo
ZSB2bWEgZG9lc24ndCBjb3ZlciB0aGUgcmFuZ2UuICovCisJcmV0ID0gaG1tX2RtaXJyb3JfY21k
KHNlbGYtPmZkMSwgSE1NX0RNSVJST1JfTUlHUkFURSwgYnVmZmVyLCAzKTsKKwlBU1NFUlRfRVEo
cmV0LCAtRUlOVkFMKTsKKworCS8qIFBhZ2UgMiB3aWxsIGJlIGEgcmVhZC1vbmx5IHplcm8gcGFn
ZS4gKi8KKwlyZXQgPSBtcHJvdGVjdChidWZmZXItPnB0ciArIDIgKiBzZWxmLT5wYWdlX3NpemUs
IHNlbGYtPnBhZ2Vfc2l6ZSwKKwkJCQlQUk9UX1JFQUQpOworCUFTU0VSVF9FUShyZXQsIDApOwor
CXB0ciA9IChpbnQgKikoYnVmZmVyLT5wdHIgKyAyICogc2VsZi0+cGFnZV9zaXplKTsKKwl2YWwg
PSAqcHRyICsgMzsKKwlBU1NFUlRfRVEodmFsLCAzKTsKKworCS8qIFBhZ2UgMyB3aWxsIGJlIHJl
YWQtb25seS4gKi8KKwlyZXQgPSBtcHJvdGVjdChidWZmZXItPnB0ciArIDMgKiBzZWxmLT5wYWdl
X3NpemUsIHNlbGYtPnBhZ2Vfc2l6ZSwKKwkJCQlQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKKwlB
U1NFUlRfRVEocmV0LCAwKTsKKwlwdHIgPSAoaW50ICopKGJ1ZmZlci0+cHRyICsgMyAqIHNlbGYt
PnBhZ2Vfc2l6ZSk7CisJKnB0ciA9IHZhbDsKKwlyZXQgPSBtcHJvdGVjdChidWZmZXItPnB0ciAr
IDMgKiBzZWxmLT5wYWdlX3NpemUsIHNlbGYtPnBhZ2Vfc2l6ZSwKKwkJCQlQUk9UX1JFQUQpOwor
CUFTU0VSVF9FUShyZXQsIDApOworCisJLyogUGFnZSA0IHdpbGwgYmUgcmVhZC13cml0ZS4gKi8K
KwlyZXQgPSBtcHJvdGVjdChidWZmZXItPnB0ciArIDQgKiBzZWxmLT5wYWdlX3NpemUsIHNlbGYt
PnBhZ2Vfc2l6ZSwKKwkJCQlQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKKwlBU1NFUlRfRVEocmV0
LCAwKTsKKwlwdHIgPSAoaW50ICopKGJ1ZmZlci0+cHRyICsgNCAqIHNlbGYtPnBhZ2Vfc2l6ZSk7
CisJKnB0ciA9IHZhbDsKKworCS8qIFBhZ2UgNSB3b24ndCBiZSBtaWdyYXRlZCB0byBkZXZpY2Ug
MCBiZWNhdXNlIGl0J3Mgb24gZGV2aWNlIDEuICovCisJYnVmZmVyLT5wdHIgPSBwICsgNSAqIHNl
bGYtPnBhZ2Vfc2l6ZTsKKwlyZXQgPSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQwLCBITU1fRE1J
UlJPUl9NSUdSQVRFLCBidWZmZXIsIDEpOworCUFTU0VSVF9FUShyZXQsIC1FTk9FTlQpOworCWJ1
ZmZlci0+cHRyID0gcDsKKworCS8qIE5vdyB0cnkgdG8gbWlncmF0ZSBwYWdlcyAyLTMgdG8gZGV2
aWNlIDEuICovCisJYnVmZmVyLT5wdHIgPSBwICsgMiAqIHNlbGYtPnBhZ2Vfc2l6ZTsKKwlyZXQg
PSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQxLCBITU1fRE1JUlJPUl9NSUdSQVRFLCBidWZmZXIs
IDIpOworCUFTU0VSVF9FUShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgMik7
CisJYnVmZmVyLT5wdHIgPSBwOworCisJaG1tX2J1ZmZlcl9mcmVlKGJ1ZmZlcik7Cit9CisKKy8q
CisgKiBNaWdyYXRlIGFub255bW91cyBtZW1vcnkgdG8gZGV2aWNlIHByaXZhdGUgbWVtb3J5IGFu
ZCBmYXVsdCBpdCBiYWNrIHRvIHN5c3RlbQorICogbWVtb3J5IG11bHRpcGxlIHRpbWVzLgorICov
CitURVNUX0YoaG1tLCBtaWdyYXRlX211bHRpcGxlKQoreworCXN0cnVjdCBobW1fYnVmZmVyICpi
dWZmZXI7CisJdW5zaWduZWQgbG9uZyBucGFnZXM7CisJdW5zaWduZWQgbG9uZyBzaXplOworCXVu
c2lnbmVkIGxvbmcgaTsKKwl1bnNpZ25lZCBsb25nIGM7CisJaW50ICpwdHI7CisJaW50IHJldDsK
KworCW5wYWdlcyA9IEFMSUdOKEhNTV9CVUZGRVJfU0laRSwgc2VsZi0+cGFnZV9zaXplKSA+PiBz
ZWxmLT5wYWdlX3NoaWZ0OworCUFTU0VSVF9ORShucGFnZXMsIDApOworCXNpemUgPSBucGFnZXMg
PDwgc2VsZi0+cGFnZV9zaGlmdDsKKworCWZvciAoYyA9IDA7IGMgPCBOVElNRVM7IGMrKykgewor
CQlidWZmZXIgPSBtYWxsb2Moc2l6ZW9mKCpidWZmZXIpKTsKKwkJQVNTRVJUX05FKGJ1ZmZlciwg
TlVMTCk7CisKKwkJYnVmZmVyLT5mZCA9IC0xOworCQlidWZmZXItPnNpemUgPSBzaXplOworCQli
dWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsKKwkJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9y
LCBOVUxMKTsKKworCQlidWZmZXItPnB0ciA9IG1tYXAoTlVMTCwgc2l6ZSwKKwkJCQkgICBQUk9U
X1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJCSAgIE1BUF9QUklWQVRFIHwgTUFQX0FOT05ZTU9VUywK
KwkJCQkgICBidWZmZXItPmZkLCAwKTsKKwkJQVNTRVJUX05FKGJ1ZmZlci0+cHRyLCBNQVBfRkFJ
TEVEKTsKKworCQkvKiBJbml0aWFsaXplIGJ1ZmZlciBpbiBzeXN0ZW0gbWVtb3J5LiAqLworCQlm
b3IgKGkgPSAwLCBwdHIgPSBidWZmZXItPnB0cjsgaSA8IHNpemUgLyBzaXplb2YoKnB0cik7ICsr
aSkKKwkJCXB0cltpXSA9IGk7CisKKwkJLyogTWlncmF0ZSBtZW1vcnkgdG8gZGV2aWNlLiAqLwor
CQlyZXQgPSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQsIEhNTV9ETUlSUk9SX01JR1JBVEUsIGJ1
ZmZlciwKKwkJCQkgICAgICBucGFnZXMpOworCQlBU1NFUlRfRVEocmV0LCAwKTsKKwkJQVNTRVJU
X0VRKGJ1ZmZlci0+Y3BhZ2VzLCBucGFnZXMpOworCisJCS8qIENoZWNrIHdoYXQgdGhlIGRldmlj
ZSByZWFkLiAqLworCQlmb3IgKGkgPSAwLCBwdHIgPSBidWZmZXItPm1pcnJvcjsgaSA8IHNpemUg
LyBzaXplb2YoKnB0cik7ICsraSkKKwkJCUFTU0VSVF9FUShwdHJbaV0sIGkpOworCisJCS8qIEZh
dWx0IHBhZ2VzIGJhY2sgdG8gc3lzdGVtIG1lbW9yeSBhbmQgY2hlY2sgdGhlbS4gKi8KKwkJZm9y
IChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIpOyArK2kp
CisJCQlBU1NFUlRfRVEocHRyW2ldLCBpKTsKKworCQlobW1fYnVmZmVyX2ZyZWUoYnVmZmVyKTsK
Kwl9Cit9CisKKy8qCisgKiBSZWFkIGFub255bW91cyBtZW1vcnkgbXVsdGlwbGUgdGltZXMuCisg
Ki8KK1RFU1RfRihobW0sIGFub25fcmVhZF9tdWx0aXBsZSkKK3sKKwlzdHJ1Y3QgaG1tX2J1ZmZl
ciAqYnVmZmVyOworCXVuc2lnbmVkIGxvbmcgbnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsK
Kwl1bnNpZ25lZCBsb25nIGk7CisJdW5zaWduZWQgbG9uZyBjOworCWludCAqcHRyOworCWludCBy
ZXQ7CisKKwlucGFnZXMgPSBBTElHTihITU1fQlVGRkVSX1NJWkUsIHNlbGYtPnBhZ2Vfc2l6ZSkg
Pj4gc2VsZi0+cGFnZV9zaGlmdDsKKwlBU1NFUlRfTkUobnBhZ2VzLCAwKTsKKwlzaXplID0gbnBh
Z2VzIDw8IHNlbGYtPnBhZ2Vfc2hpZnQ7CisKKwlmb3IgKGMgPSAwOyBjIDwgTlRJTUVTOyBjKysp
IHsKKwkJYnVmZmVyID0gbWFsbG9jKHNpemVvZigqYnVmZmVyKSk7CisJCUFTU0VSVF9ORShidWZm
ZXIsIE5VTEwpOworCisJCWJ1ZmZlci0+ZmQgPSAtMTsKKwkJYnVmZmVyLT5zaXplID0gc2l6ZTsK
KwkJYnVmZmVyLT5taXJyb3IgPSBtYWxsb2Moc2l6ZSk7CisJCUFTU0VSVF9ORShidWZmZXItPm1p
cnJvciwgTlVMTCk7CisKKwkJYnVmZmVyLT5wdHIgPSBtbWFwKE5VTEwsIHNpemUsCisJCQkJICAg
UFJPVF9SRUFEIHwgUFJPVF9XUklURSwKKwkJCQkgICBNQVBfUFJJVkFURSB8IE1BUF9BTk9OWU1P
VVMsCisJCQkJICAgYnVmZmVyLT5mZCwgMCk7CisJCUFTU0VSVF9ORShidWZmZXItPnB0ciwgTUFQ
X0ZBSUxFRCk7CisKKwkJLyogSW5pdGlhbGl6ZSBidWZmZXIgaW4gc3lzdGVtIG1lbW9yeS4gKi8K
KwkJZm9yIChpID0gMCwgcHRyID0gYnVmZmVyLT5wdHI7IGkgPCBzaXplIC8gc2l6ZW9mKCpwdHIp
OyArK2kpCisJCQlwdHJbaV0gPSBpICsgYzsKKworCQkvKiBTaW11bGF0ZSBhIGRldmljZSByZWFk
aW5nIHN5c3RlbSBtZW1vcnkuICovCisJCXJldCA9IGhtbV9kbWlycm9yX2NtZChzZWxmLT5mZCwg
SE1NX0RNSVJST1JfUkVBRCwgYnVmZmVyLAorCQkJCSAgICAgIG5wYWdlcyk7CisJCUFTU0VSVF9F
UShyZXQsIDApOworCQlBU1NFUlRfRVEoYnVmZmVyLT5jcGFnZXMsIG5wYWdlcyk7CisJCUFTU0VS
VF9FUShidWZmZXItPmZhdWx0cywgMSk7CisKKwkJLyogQ2hlY2sgd2hhdCB0aGUgZGV2aWNlIHJl
YWQuICovCisJCWZvciAoaSA9IDAsIHB0ciA9IGJ1ZmZlci0+bWlycm9yOyBpIDwgc2l6ZSAvIHNp
emVvZigqcHRyKTsgKytpKQorCQkJQVNTRVJUX0VRKHB0cltpXSwgaSArIGMpOworCisJCWhtbV9i
dWZmZXJfZnJlZShidWZmZXIpOworCX0KK30KKwordm9pZCAqdW5tYXBfYnVmZmVyKHZvaWQgKnAp
Cit7CisJc3RydWN0IGhtbV9idWZmZXIgKmJ1ZmZlciA9IHA7CisKKwkvKiBEZWxheSBmb3IgYSBi
aXQgYW5kIHRoZW4gdW5tYXAgYnVmZmVyIHdoaWxlIGl0IGlzIGJlaW5nIHJlYWQuICovCisJaG1t
X25hbm9zbGVlcChobW1fcmFuZG9tKCkgJSAzMjAwMCk7CisJbXVubWFwKGJ1ZmZlci0+cHRyICsg
YnVmZmVyLT5zaXplIC8gMiwgYnVmZmVyLT5zaXplIC8gMik7CisJYnVmZmVyLT5wdHIgPSBOVUxM
OworCisJcmV0dXJuIE5VTEw7Cit9CisKKy8qCisgKiBUcnkgcmVhZGluZyBhbm9ueW1vdXMgbWVt
b3J5IHdoaWxlIGl0IGlzIGJlaW5nIHVubWFwcGVkLgorICovCitURVNUX0YoaG1tLCBhbm9uX3Rl
YXJkb3duKQoreworCXVuc2lnbmVkIGxvbmcgbnBhZ2VzOworCXVuc2lnbmVkIGxvbmcgc2l6ZTsK
Kwl1bnNpZ25lZCBsb25nIGM7CisJdm9pZCAqcmV0OworCisJbnBhZ2VzID0gQUxJR04oSE1NX0JV
RkZFUl9TSVpFLCBzZWxmLT5wYWdlX3NpemUpID4+IHNlbGYtPnBhZ2Vfc2hpZnQ7CisJQVNTRVJU
X05FKG5wYWdlcywgMCk7CisJc2l6ZSA9IG5wYWdlcyA8PCBzZWxmLT5wYWdlX3NoaWZ0OworCisJ
Zm9yIChjID0gMDsgYyA8IE5USU1FUzsgKytjKSB7CisJCXB0aHJlYWRfdCB0aHJlYWQ7CisJCXN0
cnVjdCBobW1fYnVmZmVyICpidWZmZXI7CisJCXVuc2lnbmVkIGxvbmcgaTsKKwkJaW50ICpwdHI7
CisJCWludCByYzsKKworCQlidWZmZXIgPSBtYWxsb2Moc2l6ZW9mKCpidWZmZXIpKTsKKwkJQVNT
RVJUX05FKGJ1ZmZlciwgTlVMTCk7CisKKwkJYnVmZmVyLT5mZCA9IC0xOworCQlidWZmZXItPnNp
emUgPSBzaXplOworCQlidWZmZXItPm1pcnJvciA9IG1hbGxvYyhzaXplKTsKKwkJQVNTRVJUX05F
KGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCQlidWZmZXItPnB0ciA9IG1tYXAoTlVMTCwgc2l6
ZSwKKwkJCQkgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLAorCQkJCSAgIE1BUF9QUklWQVRFIHwg
TUFQX0FOT05ZTU9VUywKKwkJCQkgICBidWZmZXItPmZkLCAwKTsKKwkJQVNTRVJUX05FKGJ1ZmZl
ci0+cHRyLCBNQVBfRkFJTEVEKTsKKworCQkvKiBJbml0aWFsaXplIGJ1ZmZlciBpbiBzeXN0ZW0g
bWVtb3J5LiAqLworCQlmb3IgKGkgPSAwLCBwdHIgPSBidWZmZXItPnB0cjsgaSA8IHNpemUgLyBz
aXplb2YoKnB0cik7ICsraSkKKwkJCXB0cltpXSA9IGkgKyBjOworCisJCXJjID0gcHRocmVhZF9j
cmVhdGUoJnRocmVhZCwgTlVMTCwgdW5tYXBfYnVmZmVyLCBidWZmZXIpOworCQlBU1NFUlRfRVEo
cmMsIDApOworCisJCS8qIFNpbXVsYXRlIGEgZGV2aWNlIHJlYWRpbmcgc3lzdGVtIG1lbW9yeS4g
Ki8KKwkJcmMgPSBobW1fZG1pcnJvcl9jbWQoc2VsZi0+ZmQsIEhNTV9ETUlSUk9SX1JFQUQsIGJ1
ZmZlciwKKwkJCQkgICAgIG5wYWdlcyk7CisJCWlmIChyYyA9PSAwKSB7CisJCQlBU1NFUlRfRVEo
YnVmZmVyLT5jcGFnZXMsIG5wYWdlcyk7CisJCQlBU1NFUlRfRVEoYnVmZmVyLT5mYXVsdHMsIDEp
OworCisJCQkvKiBDaGVjayB3aGF0IHRoZSBkZXZpY2UgcmVhZC4gKi8KKwkJCWZvciAoaSA9IDAs
IHB0ciA9IGJ1ZmZlci0+bWlycm9yOworCQkJICAgICBpIDwgc2l6ZSAvIHNpemVvZigqcHRyKTsK
KwkJCSAgICAgKytpKQorCQkJCUFTU0VSVF9FUShwdHJbaV0sIGkgKyBjKTsKKwkJfQorCisJCXB0
aHJlYWRfam9pbih0aHJlYWQsICZyZXQpOworCQlobW1fYnVmZmVyX2ZyZWUoYnVmZmVyKTsKKwl9
Cit9CisKKy8qCisgKiBUZXN0IG1lbW9yeSBzbmFwc2hvdCB3aXRob3V0IGZhdWx0aW5nIGluIHBh
Z2VzIGFjY2Vzc2VkIGJ5IHRoZSBkZXZpY2UuCisgKi8KK1RFU1RfRihobW0yLCBzbmFwc2hvdCkK
K3sKKwlzdHJ1Y3QgaG1tX2J1ZmZlciAqYnVmZmVyOworCXVuc2lnbmVkIGxvbmcgbnBhZ2VzOwor
CXVuc2lnbmVkIGxvbmcgc2l6ZTsKKwlpbnQgKnB0cjsKKwl1bnNpZ25lZCBjaGFyICpwOworCXVu
c2lnbmVkIGNoYXIgKm07CisJaW50IHJldDsKKwlpbnQgdmFsOworCisJbnBhZ2VzID0gNzsKKwlz
aXplID0gbnBhZ2VzIDw8IHNlbGYtPnBhZ2Vfc2hpZnQ7CisKKwlidWZmZXIgPSBtYWxsb2Moc2l6
ZW9mKCpidWZmZXIpKTsKKwlBU1NFUlRfTkUoYnVmZmVyLCBOVUxMKTsKKworCWJ1ZmZlci0+ZmQg
PSAtMTsKKwlidWZmZXItPnNpemUgPSBzaXplOworCWJ1ZmZlci0+bWlycm9yID0gbWFsbG9jKG5w
YWdlcyk7CisJQVNTRVJUX05FKGJ1ZmZlci0+bWlycm9yLCBOVUxMKTsKKworCS8qIFJlc2VydmUg
YSByYW5nZSBvZiBhZGRyZXNzZXMuICovCisJYnVmZmVyLT5wdHIgPSBtbWFwKE5VTEwsIHNpemUs
CisJCQkgICBQUk9UX05PTkUsCisJCQkgICBNQVBfUFJJVkFURSB8IE1BUF9BTk9OWU1PVVMsCisJ
CQkgICBidWZmZXItPmZkLCAwKTsKKwlBU1NFUlRfTkUoYnVmZmVyLT5wdHIsIE1BUF9GQUlMRUQp
OworCXAgPSBidWZmZXItPnB0cjsKKworCS8qIFB1bmNoIGEgaG9sZSBhZnRlciB0aGUgZmlyc3Qg
cGFnZSBhZGRyZXNzLiAqLworCXJldCA9IG11bm1hcChidWZmZXItPnB0ciArIHNlbGYtPnBhZ2Vf
c2l6ZSwgc2VsZi0+cGFnZV9zaXplKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKworCS8qIFBhZ2Ug
MiB3aWxsIGJlIHJlYWQtb25seSB6ZXJvIHBhZ2UuICovCisJcmV0ID0gbXByb3RlY3QoYnVmZmVy
LT5wdHIgKyAyICogc2VsZi0+cGFnZV9zaXplLCBzZWxmLT5wYWdlX3NpemUsCisJCQkJUFJPVF9S
RUFEKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKwlwdHIgPSAoaW50ICopKGJ1ZmZlci0+cHRyICsg
MiAqIHNlbGYtPnBhZ2Vfc2l6ZSk7CisJdmFsID0gKnB0ciArIDM7CisJQVNTRVJUX0VRKHZhbCwg
Myk7CisKKwkvKiBQYWdlIDMgd2lsbCBiZSByZWFkLW9ubHkuICovCisJcmV0ID0gbXByb3RlY3Qo
YnVmZmVyLT5wdHIgKyAzICogc2VsZi0+cGFnZV9zaXplLCBzZWxmLT5wYWdlX3NpemUsCisJCQkJ
UFJPVF9SRUFEIHwgUFJPVF9XUklURSk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJcHRyID0gKGlu
dCAqKShidWZmZXItPnB0ciArIDMgKiBzZWxmLT5wYWdlX3NpemUpOworCSpwdHIgPSB2YWw7CisJ
cmV0ID0gbXByb3RlY3QoYnVmZmVyLT5wdHIgKyAzICogc2VsZi0+cGFnZV9zaXplLCBzZWxmLT5w
YWdlX3NpemUsCisJCQkJUFJPVF9SRUFEKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKworCS8qIFBh
Z2UgNC02IHdpbGwgYmUgcmVhZC13cml0ZS4gKi8KKwlyZXQgPSBtcHJvdGVjdChidWZmZXItPnB0
ciArIDQgKiBzZWxmLT5wYWdlX3NpemUsIDMgKiBzZWxmLT5wYWdlX3NpemUsCisJCQkJUFJPVF9S
RUFEIHwgUFJPVF9XUklURSk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJcHRyID0gKGludCAqKShi
dWZmZXItPnB0ciArIDQgKiBzZWxmLT5wYWdlX3NpemUpOworCSpwdHIgPSB2YWw7CisKKwkvKiBQ
YWdlIDUgd2lsbCBiZSBtaWdyYXRlZCB0byBkZXZpY2UgMC4gKi8KKwlidWZmZXItPnB0ciA9IHAg
KyA1ICogc2VsZi0+cGFnZV9zaXplOworCXJldCA9IGhtbV9kbWlycm9yX2NtZChzZWxmLT5mZDAs
IEhNTV9ETUlSUk9SX01JR1JBVEUsIGJ1ZmZlciwgMSk7CisJQVNTRVJUX0VRKHJldCwgMCk7CisJ
QVNTRVJUX0VRKGJ1ZmZlci0+Y3BhZ2VzLCAxKTsKKworCS8qIFBhZ2UgNiB3aWxsIGJlIG1pZ3Jh
dGVkIHRvIGRldmljZSAxLiAqLworCWJ1ZmZlci0+cHRyID0gcCArIDYgKiBzZWxmLT5wYWdlX3Np
emU7CisJcmV0ID0gaG1tX2RtaXJyb3JfY21kKHNlbGYtPmZkMSwgSE1NX0RNSVJST1JfTUlHUkFU
RSwgYnVmZmVyLCAxKTsKKwlBU1NFUlRfRVEocmV0LCAwKTsKKwlBU1NFUlRfRVEoYnVmZmVyLT5j
cGFnZXMsIDEpOworCisJLyogU2ltdWxhdGUgYSBkZXZpY2Ugc25hcHNob3R0aW5nIENQVSBwYWdl
dGFibGVzLiAqLworCWJ1ZmZlci0+cHRyID0gcDsKKwlyZXQgPSBobW1fZG1pcnJvcl9jbWQoc2Vs
Zi0+ZmQwLCBITU1fRE1JUlJPUl9TTkFQU0hPVCwgYnVmZmVyLCBucGFnZXMpOworCUFTU0VSVF9F
UShyZXQsIDApOworCUFTU0VSVF9FUShidWZmZXItPmNwYWdlcywgbnBhZ2VzKTsKKworCS8qIENo
ZWNrIHdoYXQgdGhlIGRldmljZSBzYXcuICovCisJbSA9IGJ1ZmZlci0+bWlycm9yOworCUFTU0VS
VF9FUShtWzBdLCBITU1fRE1JUlJPUl9QUk9UX05PTkUpOworCUFTU0VSVF9FUShtWzFdLCBITU1f
RE1JUlJPUl9QUk9UX05PTkUpOworCUFTU0VSVF9FUShtWzJdLCBITU1fRE1JUlJPUl9QUk9UX1pF
Uk8pOworCUFTU0VSVF9FUShtWzNdLCBITU1fRE1JUlJPUl9QUk9UX1JFQUQpOworCUFTU0VSVF9F
UShtWzRdLCBITU1fRE1JUlJPUl9QUk9UX1dSSVRFKTsKKwlBU1NFUlRfRVEobVs1XSwgSE1NX0RN
SVJST1JfUFJPVF9ERVZfUFJJVkFURV9MT0NBTCB8CisJCQlITU1fRE1JUlJPUl9QUk9UX1dSSVRF
KTsKKwlBU1NFUlRfRVEobVs2XSwgSE1NX0RNSVJST1JfUFJPVF9ERVZfUFJJVkFURV9SRU1PVEUg
fAorCQkJSE1NX0RNSVJST1JfUFJPVF9XUklURSk7CisKKwlobW1fYnVmZmVyX2ZyZWUoYnVmZmVy
KTsKK30KKworVEVTVF9IQVJORVNTX01BSU4KZGlmZiAtLWdpdCBhL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL3ZtL3J1bl92bXRlc3RzIGIvdG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vcnVuX3Zt
dGVzdHMKaW5kZXggOTUxYzUwN2EyN2Y3Li42MzRjZmVmZGFmZmQgMTAwNzU1Ci0tLSBhL3Rvb2xz
L3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL3J1bl92bXRlc3RzCisrKyBiL3Rvb2xzL3Rlc3Rpbmcvc2Vs
ZnRlc3RzL3ZtL3J1bl92bXRlc3RzCkBAIC0yMjcsNCArMjI3LDIwIEBAIGVsc2UKIAlleGl0Y29k
ZT0xCiBmaQogCitlY2hvICItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0iCitl
Y2hvICJydW5uaW5nIEhNTSBzbW9rZSB0ZXN0IgorZWNobyAiLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tIgorLi90ZXN0X2htbS5zaCBzbW9rZQorcmV0X3ZhbD0kPworCitpZiBb
ICRyZXRfdmFsIC1lcSAwIF07IHRoZW4KKwllY2hvICJbUEFTU10iCitlbGlmIFsgJHJldF92YWwg
LWVxICRrc2Z0X3NraXAgXTsgdGhlbgorCWVjaG8gIltTS0lQXSIKKwlleGl0Y29kZT0ka3NmdF9z
a2lwCitlbHNlCisJZWNobyAiW0ZBSUxdIgorCWV4aXRjb2RlPTEKK2ZpCisKIGV4aXQgJGV4aXRj
b2RlCmRpZmYgLS1naXQgYS90b29scy90ZXN0aW5nL3NlbGZ0ZXN0cy92bS90ZXN0X2htbS5zaCBi
L3Rvb2xzL3Rlc3Rpbmcvc2VsZnRlc3RzL3ZtL3Rlc3RfaG1tLnNoCm5ldyBmaWxlIG1vZGUgMTAw
NzU1CmluZGV4IDAwMDAwMDAwMDAwMC4uMDY5YTM5Zjg1ODc2Ci0tLSAvZGV2L251bGwKKysrIGIv
dG9vbHMvdGVzdGluZy9zZWxmdGVzdHMvdm0vdGVzdF9obW0uc2gKQEAgLTAsMCArMSwxMDUgQEAK
KyMhL2Jpbi9iYXNoCisjIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisjCisjIENv
cHlyaWdodCAoQykgMjAxOCBVbGFkemlzbGF1IFJlemtpIChTb255KSA8dXJlemtpQGdtYWlsLmNv
bT4KKyMKKyMgVGhpcyBpcyBhIHRlc3Qgc2NyaXB0IGZvciB0aGUga2VybmVsIHRlc3QgZHJpdmVy
IHRvIGFuYWx5c2Ugdm1hbGxvYworIyBhbGxvY2F0b3IuIFRoZXJlZm9yZSBpdCBpcyBqdXN0IGEg
a2VybmVsIG1vZHVsZSBsb2FkZXIuIFlvdSBjYW4gc3BlY2lmeQorIyBhbmQgcGFzcyBkaWZmZXJl
bnQgcGFyYW1ldGVycyBpbiBvcmRlciB0bzoKKyMgICAgIGEpIGFuYWx5c2UgcGVyZm9ybWFuY2Ug
b2Ygdm1hbGxvYyBhbGxvY2F0aW9uczsKKyMgICAgIGIpIHN0cmVzc2luZyBhbmQgc3RhYmlsaXR5
IGNoZWNrIG9mIHZtYWxsb2Mgc3Vic3lzdGVtLgorCitURVNUX05BTUU9InRlc3RfaG1tIgorRFJJ
VkVSPSJobW1fZG1pcnJvciIKKworIyAxIGlmIGZhaWxzCitleGl0Y29kZT0xCisKKyMgS3NlbGZ0
ZXN0IGZyYW1ld29yayByZXF1aXJlbWVudCAtIFNLSVAgY29kZSBpcyA0Lgora3NmdF9za2lwPTQK
KworIworIyBTdGF0aWMgdGVtcGxhdGVzIGZvciBwZXJmb3JtYW5jZSwgc3RyZXNzaW5nIGFuZCBz
bW9rZSB0ZXN0cy4KKyMgQWxzbyBpdCBpcyBwb3NzaWJsZSB0byBwYXNzIGFueSBzdXBwb3J0ZWQg
cGFyYW1ldGVycyBtYW51YWx5LgorIworUEVSRl9QQVJBTT0ic2luZ2xlX2NwdV90ZXN0PTEgc2Vx
dWVudGlhbF90ZXN0X29yZGVyPTEgdGVzdF9yZXBlYXRfY291bnQ9MyIKK1NNT0tFX1BBUkFNPSJz
aW5nbGVfY3B1X3Rlc3Q9MSB0ZXN0X2xvb3BfY291bnQ9MTAwMDAgdGVzdF9yZXBlYXRfY291bnQ9
MTAiCitTVFJFU1NfUEFSQU09InRlc3RfcmVwZWF0X2NvdW50PTIwIgorCitjaGVja190ZXN0X3Jl
cXVpcmVtZW50cygpCit7CisJdWlkPSQoaWQgLXUpCisJaWYgWyAkdWlkIC1uZSAwIF07IHRoZW4K
KwkJZWNobyAiJDA6IE11c3QgYmUgcnVuIGFzIHJvb3QiCisJCWV4aXQgJGtzZnRfc2tpcAorCWZp
CisKKwlpZiAhIHdoaWNoIG1vZHByb2JlID4gL2Rldi9udWxsIDI+JjE7IHRoZW4KKwkJZWNobyAi
JDA6IFlvdSBuZWVkIG1vZHByb2JlIGluc3RhbGxlZCIKKwkJZXhpdCAka3NmdF9za2lwCisJZmkK
KworCWlmICEgbW9kaW5mbyAkRFJJVkVSID4gL2Rldi9udWxsIDI+JjE7IHRoZW4KKwkJZWNobyAi
JDA6IFlvdSBtdXN0IGhhdmUgdGhlIGZvbGxvd2luZyBlbmFibGVkIGluIHlvdXIga2VybmVsOiIK
KwkJZWNobyAiQ09ORklHX0hNTV9ETUlSUk9SPW0iCisJCWV4aXQgJGtzZnRfc2tpcAorCWZpCit9
CisKK2xvYWRfZHJpdmVyKCkKK3sKKwltb2Rwcm9iZSAkRFJJVkVSID4gL2Rldi9udWxsIDI+JjEK
KwlpZiBbICQ/ID09IDAgXTsgdGhlbgorCQltYWpvcj0kKGF3ayAiXCQyPT1cIkhNTV9ETUlSUk9S
XCIge3ByaW50IFwkMX0iIC9wcm9jL2RldmljZXMpCisJCW1rbm9kIC9kZXYvaG1tX2RtaXJyb3Iw
IGMgJG1ham9yIDAKKwkJbWtub2QgL2Rldi9obW1fZG1pcnJvcjEgYyAkbWFqb3IgMQorCWZpCit9
CisKK3VubG9hZF9kcml2ZXIoKQoreworCW1vZHByb2JlIC1yICREUklWRVIgPiAvZGV2L251bGwg
Mj4mMQorCXJtIC1mIC9kZXYvaG1tX2RtaXJyb3I/Cit9CisKK3J1bl9zbW9rZSgpCit7CisJZWNo
byAiUnVubmluZyBzbW9rZSB0ZXN0LiBOb3RlLCB0aGlzIHRlc3QgcHJvdmlkZXMgYmFzaWMgY292
ZXJhZ2UuIgorCisJbG9hZF9kcml2ZXIKKwkuL2htbS10ZXN0cworCXVubG9hZF9kcml2ZXIKK30K
KwordXNhZ2UoKQoreworCWVjaG8gLW4gIlVzYWdlOiAkMCIKKwllY2hvCisJZWNobyAiRXhhbXBs
ZSB1c2FnZToiCisJZWNobworCWVjaG8gIiMgU2hvd3MgaGVscCBtZXNzYWdlIgorCWVjaG8gIi4v
JHtURVNUX05BTUV9LnNoIgorCWVjaG8KKwllY2hvICIjIFNtb2tlIHRlc3RpbmciCisJZWNobyAi
Li8ke1RFU1RfTkFNRX0uc2ggc21va2UiCisJZWNobworCWV4aXQgMAorfQorCitmdW5jdGlvbiBy
dW5fdGVzdCgpCit7CisJaWYgWyAkIyAtZXEgMCBdOyB0aGVuCisJCXVzYWdlCisJZWxzZQorCQlp
ZiBbICIkMSIgPSAic21va2UiIF07IHRoZW4KKwkJCXJ1bl9zbW9rZQorCQllbHNlCisJCQl1c2Fn
ZQorCQlmaQorCWZpCit9CisKK2NoZWNrX3Rlc3RfcmVxdWlyZW1lbnRzCitydW5fdGVzdCAkQAor
CitleGl0IDAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
