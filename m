Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7FC8337053A
	for <lists+dri-devel@lfdr.de>; Sat,  1 May 2021 06:06:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EBD7D6E051;
	Sat,  1 May 2021 04:06:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A89056E051
 for <dri-devel@lists.freedesktop.org>; Sat,  1 May 2021 04:06:29 +0000 (UTC)
Received: by mail.kernel.org (Postfix) with ESMTPSA id 5594A6143D
 for <dri-devel@lists.freedesktop.org>; Sat,  1 May 2021 04:06:29 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1619841989;
 bh=F+isvP/CISEBur6+0efALgnBlYarHdry2+xf4t13CSQ=;
 h=References:In-Reply-To:From:Date:Subject:To:Cc:From;
 b=Laf32isseyoxoRlwVduDmzQloyXdmi8KFQvzoQbIpm//+nG2tKgMZKOTmZw8KhEws
 h6wXYysAUKvIXNy263+Fvjl8rRAFB4laVwWX1qKIHBMo/SjncrB4+CTzUTB7S6y627
 DxhBXP5/UnFst/UMWoLRlmOegqns5crpye1SjT/hWXaVMYxLsfi5bUELL+6AfbJb4d
 NGk15pJuP75yQG5eDN+1RqAtDA4yDmdjB9IlB2pB4arlDX0rqtLqoChA2GTNzlAjvR
 d+85ImFDiGyEBKS5WQGChN3HEOpOXgRquTqTWP/mIZcXoAwWEf1P+34T4T8tBkYGtn
 HjSucjlZ8y8EA==
Received: by mail-ed1-f44.google.com with SMTP id c22so339248edn.7
 for <dri-devel@lists.freedesktop.org>; Fri, 30 Apr 2021 21:06:29 -0700 (PDT)
X-Gm-Message-State: AOAM530HBfwAR4+lU57xB0swQGcTRPByxLttCQLjmADeXL0GdIzGrtJi
 +J8kXA/UGYM6mp3cnjfW0AKF6QhdKX1cTnu+ow==
X-Google-Smtp-Source: ABdhPJy/xB9YH6r0sZIkUz5zI/CnVQBqFHcrCzYVGkRITeICDiq17pGJWls+d/u9iH8uBuq2/DCSh3jzzV+xhxEq6C0=
X-Received: by 2002:aa7:db0c:: with SMTP id t12mr9503414eds.72.1619841987818; 
 Fri, 30 Apr 2021 21:06:27 -0700 (PDT)
MIME-Version: 1.0
References: <1619838819-11309-1-git-send-email-yongqiang.niu@mediatek.com>
 <1619838819-11309-2-git-send-email-yongqiang.niu@mediatek.com>
In-Reply-To: <1619838819-11309-2-git-send-email-yongqiang.niu@mediatek.com>
From: Chun-Kuang Hu <chunkuang.hu@kernel.org>
Date: Sat, 1 May 2021 12:06:15 +0800
X-Gmail-Original-Message-ID: <CAAOTY_93Ym8yg1rmTVSqG5XCCkkGTWE4HBqiUWCRYk-Af4WKNg@mail.gmail.com>
Message-ID: <CAAOTY_93Ym8yg1rmTVSqG5XCCkkGTWE4HBqiUWCRYk-Af4WKNg@mail.gmail.com>
Subject: Re: [PATCH 1/2] drm/mediatek: move page flip handle into cmdq cb
To: Yongqiang Niu <yongqiang.niu@mediatek.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Chun-Kuang Hu <chunkuang.hu@kernel.org>, DTML <devicetree@vger.kernel.org>,
 David Airlie <airlied@linux.ie>, Chun-Hung Wu <chun-hung.wu@mediatek.com>,
 linux-kernel <linux-kernel@vger.kernel.org>,
 DRI Development <dri-devel@lists.freedesktop.org>,
 Project_Global_Chrome_Upstream_Group@mediatek.com,
 Rob Herring <robh+dt@kernel.org>,
 "moderated list:ARM/Mediatek SoC support" <linux-mediatek@lists.infradead.org>,
 Matthias Brugger <matthias.bgg@gmail.com>,
 Linux ARM <linux-arm-kernel@lists.infradead.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SGksIFlvbmdxaWFuZzoKCllvbmdxaWFuZyBOaXUgPHlvbmdxaWFuZy5uaXVAbWVkaWF0ZWsuY29t
PiDmlrwgMjAyMeW5tDXmnIgx5pelIOmAseWFrSDkuIrljYgxMToxM+Wvq+mBk++8mgo+Cj4gbW92
ZSBwYWdlIGZsaXAgaGFuZGxlIGludG8gY21kcSBjYgo+IGlycSBjYWxsYmFjayB3aWxsIGJlZm9y
ZSBjbWRxIGZsdXNoIGRkcCByZWdpc3Rlcgo+IGludG8gaGFyZHdhcmUsIHRoYXQgd2lsbCBjYXVz
ZSB0aGUgZGlzcGxheSBmcmFtZSBwYWdlCj4gZmxpcCBldmVudCBiZWZvcmUgaXQgcmVhbHkgZGlz
cGxheSBvdXQgdGltZQoKQWZ0ZXIgYXBwbHkgcGF0Y2ggWzFdLCB3ZSBkb24ndCBuZWVkIHRvIGNh
cmUgYWJvdXQgd2hpY2ggb25lIChpcnEgb3IKY21kcV9jYikgY29tZSBmaXJzdC4gRXZlbiB0aG91
Z2ggY21kcV9jYiBjb21lIGxhdGVyLCBHQ0Ugd291bGQgaGF2ZQphbHJlYWR5IHdyaXRlIHJlZ2lz
dGVyIGluIHZibGFuay4KClsxXSBodHRwczovL2dpdC5rZXJuZWwub3JnL3B1Yi9zY20vbGludXgv
a2VybmVsL2dpdC9uZXh0L2xpbnV4LW5leHQuZ2l0L2NvbW1pdC8/aD1uZXh0LTIwMjEwNDMwJmlk
PTM2ODE2NmVjNzYwMGJhODM1ODdjZmNiMzFkODE3Y2Y2NDc5Y2YwMDYKClJlZ2FyZHMsCkNodW4t
S3VhbmcuCgo+Cj4gU2lnbmVkLW9mZi1ieTogWW9uZ3FpYW5nIE5pdSA8eW9uZ3FpYW5nLm5pdUBt
ZWRpYXRlay5jb20+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2Ny
dGMuYyB8IDQ2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKy0tLQo+ICAxIGZpbGUgY2hh
bmdlZCwgNDMgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKPgo+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0v
bWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMKPiBpbmRleCA4YjBkZTkwLi5jMzc4ODFiIDEwMDY0NAo+
IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuYwo+IEBAIC03Miw2ICs3MiwxMyBA
QCBzdHJ1Y3QgbXRrX2NydGNfc3RhdGUgewo+ICAgICAgICAgdW5zaWduZWQgaW50ICAgICAgICAg
ICAgICAgICAgICBwZW5kaW5nX3ZyZWZyZXNoOwo+ICB9Owo+Cj4gKyNpZiBJU19SRUFDSEFCTEUo
Q09ORklHX01US19DTURRKQo+ICtzdHJ1Y3QgbXRrX2NtZHFfY2JfZGF0YSB7Cj4gKyAgICAgICBz
dHJ1Y3QgY21kcV9wa3QgICAgICAgICAgICAgICAgICpjbWRxX2hhbmRsZTsKPiArICAgICAgIHN0
cnVjdCBtdGtfZHJtX2NydGMgICAgICAgICAgICAgKm10a19jcnRjOwo+ICt9Owo+ICsjZW5kaWYK
PiArCj4gIHN0YXRpYyBpbmxpbmUgc3RydWN0IG10a19kcm1fY3J0YyAqdG9fbXRrX2NydGMoc3Ry
dWN0IGRybV9jcnRjICpjKQo+ICB7Cj4gICAgICAgICByZXR1cm4gY29udGFpbmVyX29mKGMsIHN0
cnVjdCBtdGtfZHJtX2NydGMsIGJhc2UpOwo+IEBAIC05Niw3ICsxMDMsNiBAQCBzdGF0aWMgdm9p
ZCBtdGtfZHJtX2NydGNfZmluaXNoX3BhZ2VfZmxpcChzdHJ1Y3QgbXRrX2RybV9jcnRjICptdGtf
Y3J0YykKPgo+ICBzdGF0aWMgdm9pZCBtdGtfZHJtX2ZpbmlzaF9wYWdlX2ZsaXAoc3RydWN0IG10
a19kcm1fY3J0YyAqbXRrX2NydGMpCj4gIHsKPiAtICAgICAgIGRybV9jcnRjX2hhbmRsZV92Ymxh
bmsoJm10a19jcnRjLT5iYXNlKTsKPiAgICAgICAgIGlmIChtdGtfY3J0Yy0+cGVuZGluZ19uZWVk
c192YmxhbmspIHsKPiAgICAgICAgICAgICAgICAgbXRrX2RybV9jcnRjX2ZpbmlzaF9wYWdlX2Zs
aXAobXRrX2NydGMpOwo+ICAgICAgICAgICAgICAgICBtdGtfY3J0Yy0+cGVuZGluZ19uZWVkc192
YmxhbmsgPSBmYWxzZTsKPiBAQCAtMjIzLDcgKzIyOSwyNyBAQCBzdHJ1Y3QgbXRrX2RkcF9jb21w
ICptdGtfZHJtX2RkcF9jb21wX2Zvcl9wbGFuZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCj4gICNp
ZiBJU19SRUFDSEFCTEUoQ09ORklHX01US19DTURRKQo+ICBzdGF0aWMgdm9pZCBkZHBfY21kcV9j
YihzdHJ1Y3QgY21kcV9jYl9kYXRhIGRhdGEpCj4gIHsKPiAtICAgICAgIGNtZHFfcGt0X2Rlc3Ry
b3koZGF0YS5kYXRhKTsKPiArICAgICAgIHN0cnVjdCBtdGtfY21kcV9jYl9kYXRhICpjYl9kYXRh
ID0gZGF0YS5kYXRhOwo+ICsgICAgICAgc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGM7Cj4g
Kwo+ICsgICAgICAgaWYgKCFjYl9kYXRhKSB7Cj4gKyAgICAgICAgICAgICAgIERSTV9FUlJPUigi
Y21kcSBjYWxsYmFjayBkYXRhIGlzIG51bGwgcG9pbnRlciFcbiIpOwo+ICsgICAgICAgICAgICAg
ICByZXR1cm47Cj4gKyAgICAgICB9Cj4gKwo+ICsgICAgICAgbXRrX2NydGMgPSBjYl9kYXRhLT5t
dGtfY3J0YzsKPiArICAgICAgIGlmICghbXRrX2NydGMpIHsKPiArICAgICAgICAgICAgICAgRFJN
X0VSUk9SKCJjbWRxIGNhbGxiYWNrIG10a19jcnRjIGlzIG51bGwgcG9pbnRlciFcbiIpOwo+ICsg
ICAgICAgICAgICAgICBnb3RvIGRlc3Ryb3lfcGt0Owo+ICsgICAgICAgfQo+ICsKPiArICAgICAg
IG10a19kcm1fZmluaXNoX3BhZ2VfZmxpcChtdGtfY3J0Yyk7Cj4gKwo+ICtkZXN0cm95X3BrdDoK
PiArICAgICAgIGlmIChjYl9kYXRhLT5jbWRxX2hhbmRsZSkKPiArICAgICAgICAgICAgICAgY21k
cV9wa3RfZGVzdHJveShjYl9kYXRhLT5jbWRxX2hhbmRsZSk7Cj4gKwo+ICsgICAgICAga2ZyZWUo
Y2JfZGF0YSk7Cj4gIH0KPiAgI2VuZGlmCj4KPiBAQCAtNDYzLDEzICs0ODksMjAgQEAgc3RhdGlj
IHZvaWQgbXRrX2RybV9jcnRjX2h3X2NvbmZpZyhzdHJ1Y3QgbXRrX2RybV9jcnRjICptdGtfY3J0
YykKPiAgICAgICAgIH0KPiAgI2lmIElTX1JFQUNIQUJMRShDT05GSUdfTVRLX0NNRFEpCj4gICAg
ICAgICBpZiAobXRrX2NydGMtPmNtZHFfY2xpZW50KSB7Cj4gKyAgICAgICAgICAgICAgIHN0cnVj
dCBtdGtfY21kcV9jYl9kYXRhICpjYl9kYXRhOwo+ICsKPiAgICAgICAgICAgICAgICAgbWJveF9m
bHVzaChtdGtfY3J0Yy0+Y21kcV9jbGllbnQtPmNoYW4sIDIwMDApOwo+ICAgICAgICAgICAgICAg
ICBjbWRxX2hhbmRsZSA9IGNtZHFfcGt0X2NyZWF0ZShtdGtfY3J0Yy0+Y21kcV9jbGllbnQsIFBB
R0VfU0laRSk7Cj4gICAgICAgICAgICAgICAgIGNtZHFfcGt0X2NsZWFyX2V2ZW50KGNtZHFfaGFu
ZGxlLCBtdGtfY3J0Yy0+Y21kcV9ldmVudCk7Cj4gICAgICAgICAgICAgICAgIGNtZHFfcGt0X3dm
ZShjbWRxX2hhbmRsZSwgbXRrX2NydGMtPmNtZHFfZXZlbnQsIGZhbHNlKTsKPiAgICAgICAgICAg
ICAgICAgbXRrX2NydGNfZGRwX2NvbmZpZyhjcnRjLCBjbWRxX2hhbmRsZSk7Cj4gICAgICAgICAg
ICAgICAgIGNtZHFfcGt0X2ZpbmFsaXplKGNtZHFfaGFuZGxlKTsKPiAtICAgICAgICAgICAgICAg
Y21kcV9wa3RfZmx1c2hfYXN5bmMoY21kcV9oYW5kbGUsIGRkcF9jbWRxX2NiLCBjbWRxX2hhbmRs
ZSk7Cj4gKwo+ICsgICAgICAgICAgICAgICBjYl9kYXRhID0ga21hbGxvYyhzaXplb2YoKmNiX2Rh
dGEpLCBHRlBfS0VSTkVMKTsKPiArICAgICAgICAgICAgICAgY2JfZGF0YS0+Y21kcV9oYW5kbGUg
PSBjbWRxX2hhbmRsZTsKPiArICAgICAgICAgICAgICAgY2JfZGF0YS0+bXRrX2NydGMgPSBtdGtf
Y3J0YzsKPiArCj4gKyAgICAgICAgICAgICAgIGNtZHFfcGt0X2ZsdXNoX2FzeW5jKGNtZHFfaGFu
ZGxlLCBkZHBfY21kcV9jYiwgY2JfZGF0YSk7Cj4gICAgICAgICB9Cj4gICNlbmRpZgo+ICAgICAg
ICAgbXV0ZXhfdW5sb2NrKCZtdGtfY3J0Yy0+aHdfbG9jayk7Cj4gQEAgLTQ4OCw3ICs1MjEsMTQg
QEAgc3RhdGljIHZvaWQgbXRrX2NydGNfZGRwX2lycSh2b2lkICpkYXRhKQo+ICAjZW5kaWYKPiAg
ICAgICAgICAgICAgICAgbXRrX2NydGNfZGRwX2NvbmZpZyhjcnRjLCBOVUxMKTsKPgo+ICsgICAg
ICAgZHJtX2NydGNfaGFuZGxlX3ZibGFuaygmbXRrX2NydGMtPmJhc2UpOwo+ICsKPiArI2lmIElT
X1JFQUNIQUJMRShDT05GSUdfTVRLX0NNRFEpCj4gKyAgICAgICBpZiAoIXByaXYtPmRhdGEtPnNo
YWRvd19yZWdpc3RlciAmJiAhbXRrX2NydGMtPmNtZHFfY2xpZW50KQo+ICsgICAgICAgICAgICAg
ICBtdGtfZHJtX2ZpbmlzaF9wYWdlX2ZsaXAobXRrX2NydGMpOwo+ICsjZWxzZQo+ICAgICAgICAg
bXRrX2RybV9maW5pc2hfcGFnZV9mbGlwKG10a19jcnRjKTsKPiArI2VuZGlmCj4gIH0KPgo+ICBz
dGF0aWMgaW50IG10a19kcm1fY3J0Y19lbmFibGVfdmJsYW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0
YykKPiAtLQo+IDEuOC4xLjEuZGlydHkKPgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWwK
