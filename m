Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2ACE62D9E9
	for <lists+dri-devel@lfdr.de>; Wed, 29 May 2019 12:03:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CC6EB6E0CA;
	Wed, 29 May 2019 10:03:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-oi1-x242.google.com (mail-oi1-x242.google.com
 [IPv6:2607:f8b0:4864:20::242])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A96C06E0CA
 for <dri-devel@lists.freedesktop.org>; Wed, 29 May 2019 10:03:00 +0000 (UTC)
Received: by mail-oi1-x242.google.com with SMTP id r136so1525120oie.7
 for <dri-devel@lists.freedesktop.org>; Wed, 29 May 2019 03:03:00 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=Uz7UJoJDLUB4LzQxzPm43WUg8jb7zQotvBKMZ+c3mGo=;
 b=SyDD/AL+MyKfAnOxak+Vocj7LuGg7rAzRlFGZbB90hgF+e3/vjAbUtxxRNOaU91LRY
 dQP8OSJuGNXVd93JRRnqyzCY9kbcp6k0kN2r017/F7P9NvQi6rqCROVH6lKpDn6/sge1
 QKHicsURf4Hsbj68vuUtccWdxOzRHBnG2UhSqrCBurJfuukK2weK6lvcYHzZJ+ERgQkV
 dC2MU6VOOdfziEf73czCxI7Vos442cLKbMkARRqK0Dx/4cCZLXdpkzfgt3S9IrbNDRkW
 /2gIE+ru5cSogwf4Nc2zt6kL0Jfojj8diB5xCWczrynNgeNhE5AqZQ29plQWLCLoKK6y
 JuKA==
X-Gm-Message-State: APjAAAX/wVQhw/RsEeMcNB2TH91pQt2U4f5jsMqi4mVFaY9Uu0kd9mCB
 Jg7LC0GJ6shu3DUGXHqSsqB3B/Pm+Wu2XeOiZTlFNw==
X-Google-Smtp-Source: APXvYqyvagUPCRt/A5dJQSCY7J2ao6+wAZ8e5FTecdEzWkTow+Q9gyjbP0g/y1Wuept1Ov5VXKC2QLpU6/0BllvylYU=
X-Received: by 2002:aca:f2d5:: with SMTP id q204mr24052oih.14.1559124178593;
 Wed, 29 May 2019 03:02:58 -0700 (PDT)
MIME-Version: 1.0
References: <1555599624-12285-1-git-send-email-andrey.grodzovsky@amd.com>
 <1555599624-12285-3-git-send-email-andrey.grodzovsky@amd.com>
In-Reply-To: <1555599624-12285-3-git-send-email-andrey.grodzovsky@amd.com>
From: Daniel Vetter <daniel@ffwll.ch>
Date: Wed, 29 May 2019 12:02:47 +0200
Message-ID: <CAKMK7uG3hk_ichiqCSprnb9OioSq741cPL_gp=P5X2hKhZ+C0A@mail.gmail.com>
Subject: Re: [PATCH v5 3/6] drm/scheduler: rework job destruction
To: Andrey Grodzovsky <andrey.grodzovsky@amd.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=Uz7UJoJDLUB4LzQxzPm43WUg8jb7zQotvBKMZ+c3mGo=;
 b=MpuKsyyIUBgFawdHFJlLg4P+jTirk35B4HeU4l0WqFPMMfJXSlehQebCdg49Pa2LF+
 hgsEMZVBfHfLo7pV+yB0rugmVjT8RwLXy5XfEbZ+gfGCzN636iDK93vSlzGBD4WGtKBB
 5N7UlXEbtQ4ItUgO9PlMvE6UB22P8xB6hL0Hg=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?Q?Christian_K=C3=B6nig?= <ckoenig.leichtzumerken@gmail.com>,
 The etnaviv authors <etnaviv@lists.freedesktop.org>,
 amd-gfx list <amd-gfx@lists.freedesktop.org>,
 =?UTF-8?Q?Christian_K=C3=B6nig?= <christian.koenig@amd.com>,
 dri-devel <dri-devel@lists.freedesktop.org>, "Kazlauskas,
 Nicholas" <Nicholas.Kazlauskas@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gVGh1LCBBcHIgMTgsIDIwMTkgYXQgNTowMCBQTSBBbmRyZXkgR3JvZHpvdnNreQo8YW5kcmV5
Lmdyb2R6b3Zza3lAYW1kLmNvbT4gd3JvdGU6Cj4KPiBGcm9tOiBDaHJpc3RpYW4gS8O2bmlnIDxj
aHJpc3RpYW4ua29lbmlnQGFtZC5jb20+Cj4KPiBXZSBub3cgZGVzdHJveSBmaW5pc2hlZCBqb2Jz
IGZyb20gdGhlIHdvcmtlciB0aHJlYWQgdG8gbWFrZSBzdXJlIHRoYXQKPiB3ZSBuZXZlciBkZXN0
cm95IGEgam9iIGN1cnJlbnRseSBpbiB0aW1lb3V0IHByb2Nlc3NpbmcuCj4gQnkgdGhpcyB3ZSBh
dm9pZCBob2xkaW5nIGxvY2sgYXJvdW5kIHJpbmcgbWlycm9yIGxpc3QgaW4gZHJtX3NjaGVkX3N0
b3AKPiB3aGljaCBzaG91bGQgc29sdmUgYSBkZWFkbG9jayByZXBvcnRlZCBieSBhIHVzZXIuCj4K
PiB2MjogUmVtb3ZlIHVudXNlZCB2YXJpYWJsZS4KPiB2NDogTW92ZSBndWlsdHkgam9iIGZyZWUg
aW50byBzY2hlZCBjb2RlLgo+IHY1Ogo+IE1vdmUgc2NoZWQtPmh3X3JxX2NvdW50IHRvIGRybV9z
Y2hlZF9zdGFydCB0byBhY2NvdW50IGZvciBjb3VudGVyCj4gZGVjcmVtZW50IGluIGRybV9zY2hl
ZF9zdG9wIGV2ZW4gd2hlbiB3ZSBkb24ndCBjYWxsIHJlc3VibWl0IGpvYnMKPiBpZiBndWlseSBq
b2IgZGlkIHNpZ25hbC4KPgo+IEJ1Z3ppbGxhOiBodHRwczovL2J1Z3MuZnJlZWRlc2t0b3Aub3Jn
L3Nob3dfYnVnLmNnaT9pZD0xMDk2OTIKPgo+IFNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7Zu
aWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KPiBTaWduZWQtb2ZmLWJ5OiBBbmRyZXkgR3Jv
ZHpvdnNreSA8YW5kcmV5Lmdyb2R6b3Zza3lAYW1kLmNvbT4KCiQgbWFrZSBodG1sZG9jcwoKLi9k
cml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYzozNjU6IHdhcm5pbmc6IEZ1bmN0
aW9uCnBhcmFtZXRlciBvciBtZW1iZXIgJ2JhZCcgbm90IGRlc2NyaWJlZCBpbiAnZHJtX3NjaGVk
X3N0b3AnCgpQbGVhc2UgZml4LCB0aGFua3MuCi1EYW5pZWwKCj4gLS0tCj4gIGRyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZpY2UuYyB8ICAgOSArLQo+ICBkcml2ZXJzL2dwdS9k
cm0vZXRuYXZpdi9ldG5hdml2X2R1bXAuYyAgICAgfCAgIDQgLQo+ICBkcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X3NjaGVkLmMgICAgfCAgIDIgKy0KPiAgZHJpdmVycy9ncHUvZHJtL2xp
bWEvbGltYV9zY2hlZC5jICAgICAgICAgIHwgICAyICstCj4gIGRyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9qb2IuYyAgICB8ICAgMiArLQo+ICBkcml2ZXJzL2dwdS9kcm0vc2NoZWR1
bGVyL3NjaGVkX21haW4uYyAgICAgfCAxNTkgKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0K
PiAgZHJpdmVycy9ncHUvZHJtL3YzZC92M2Rfc2NoZWQuYyAgICAgICAgICAgIHwgICAyICstCj4g
IGluY2x1ZGUvZHJtL2dwdV9zY2hlZHVsZXIuaCAgICAgICAgICAgICAgICB8ICAgNiArLQo+ICA4
IGZpbGVzIGNoYW5nZWQsIDEwMiBpbnNlcnRpb25zKCspLCA4NCBkZWxldGlvbnMoLSkKPgo+IGRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZGV2aWNlLmMKPiBpbmRleCA3Y2VlMjY5
Li5hMGUxNjVjIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9kZXZpY2UuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kZXZp
Y2UuYwo+IEBAIC0zMzM0LDcgKzMzMzQsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9kZXZpY2VfcHJl
X2FzaWNfcmVzZXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCj4gICAgICAgICAgICAgICAg
IGlmICghcmluZyB8fCAhcmluZy0+c2NoZWQudGhyZWFkKQo+ICAgICAgICAgICAgICAgICAgICAg
ICAgIGNvbnRpbnVlOwo+Cj4gLSAgICAgICAgICAgICAgIGRybV9zY2hlZF9zdG9wKCZyaW5nLT5z
Y2hlZCk7Cj4gKyAgICAgICAgICAgICAgIGRybV9zY2hlZF9zdG9wKCZyaW5nLT5zY2hlZCwgJmpv
Yi0+YmFzZSk7Cj4KPiAgICAgICAgICAgICAgICAgLyogYWZ0ZXIgYWxsIGh3IGpvYnMgYXJlIHJl
c2V0LCBodyBmZW5jZSBpcyBtZWFuaW5nbGVzcywgc28gZm9yY2VfY29tcGxldGlvbiAqLwo+ICAg
ICAgICAgICAgICAgICBhbWRncHVfZmVuY2VfZHJpdmVyX2ZvcmNlX2NvbXBsZXRpb24ocmluZyk7
Cj4gQEAgLTMzNDMsOCArMzM0Myw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RldmljZV9wcmVfYXNp
Y19yZXNldChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKPiAgICAgICAgIGlmKGpvYikKPiAg
ICAgICAgICAgICAgICAgZHJtX3NjaGVkX2luY3JlYXNlX2thcm1hKCZqb2ItPmJhc2UpOwo+Cj4g
LQo+IC0KPiAgICAgICAgIGlmICghYW1kZ3B1X3NyaW92X3ZmKGFkZXYpKSB7Cj4KPiAgICAgICAg
ICAgICAgICAgaWYgKCFuZWVkX2Z1bGxfcmVzZXQpCj4gQEAgLTM0ODIsOCArMzQ4MCw3IEBAIHN0
YXRpYyBpbnQgYW1kZ3B1X2RvX2FzaWNfcmVzZXQoc3RydWN0IGFtZGdwdV9oaXZlX2luZm8gKmhp
dmUsCj4gICAgICAgICByZXR1cm4gcjsKPiAgfQo+Cj4gLXN0YXRpYyB2b2lkIGFtZGdwdV9kZXZp
Y2VfcG9zdF9hc2ljX3Jlc2V0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAo+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBhbWRncHVfam9iICpqb2Ip
Cj4gK3N0YXRpYyB2b2lkIGFtZGdwdV9kZXZpY2VfcG9zdF9hc2ljX3Jlc2V0KHN0cnVjdCBhbWRn
cHVfZGV2aWNlICphZGV2KQo+ICB7Cj4gICAgICAgICBpbnQgaTsKPgo+IEBAIC0zNjIzLDcgKzM2
MjAsNyBAQCBpbnQgYW1kZ3B1X2RldmljZV9ncHVfcmVjb3ZlcihzdHJ1Y3QgYW1kZ3B1X2Rldmlj
ZSAqYWRldiwKPgo+ICAgICAgICAgLyogUG9zdCBBU0lDIHJlc2V0IGZvciBhbGwgZGV2cyAuKi8K
PiAgICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkodG1wX2FkZXYsIGRldmljZV9saXN0X2hhbmRs
ZSwgZ21jLnhnbWkuaGVhZCkgewo+IC0gICAgICAgICAgICAgICBhbWRncHVfZGV2aWNlX3Bvc3Rf
YXNpY19yZXNldCh0bXBfYWRldiwgdG1wX2FkZXYgPT0gYWRldiA/IGpvYiA6IE5VTEwpOwo+ICsg
ICAgICAgICAgICAgICBhbWRncHVfZGV2aWNlX3Bvc3RfYXNpY19yZXNldCh0bXBfYWRldik7Cj4K
PiAgICAgICAgICAgICAgICAgaWYgKHIpIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICAvKiBi
YWQgbmV3cywgaG93IHRvIHRlbGwgaXQgdG8gdXNlcnNwYWNlID8gKi8KPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9kdW1wLmMgYi9kcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X2R1bXAuYwo+IGluZGV4IDMzODU0YzkuLjU3NzhkOWMgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9kdW1wLmMKPiArKysgYi9kcml2
ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2R1bXAuYwo+IEBAIC0xMzUsMTMgKzEzNSwxMSBA
QCB2b2lkIGV0bmF2aXZfY29yZV9kdW1wKHN0cnVjdCBldG5hdml2X2dwdSAqZ3B1KQo+ICAgICAg
ICAgICAgICAgICAgICAgbW11X3NpemUgKyBncHUtPmJ1ZmZlci5zaXplOwo+Cj4gICAgICAgICAv
KiBBZGQgaW4gdGhlIGFjdGl2ZSBjb21tYW5kIGJ1ZmZlcnMgKi8KPiAtICAgICAgIHNwaW5fbG9j
a19pcnFzYXZlKCZncHUtPnNjaGVkLmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiAgICAgICAgIGxp
c3RfZm9yX2VhY2hfZW50cnkoc19qb2IsICZncHUtPnNjaGVkLnJpbmdfbWlycm9yX2xpc3QsIG5v
ZGUpIHsKPiAgICAgICAgICAgICAgICAgc3VibWl0ID0gdG9fZXRuYXZpdl9zdWJtaXQoc19qb2Ip
Owo+ICAgICAgICAgICAgICAgICBmaWxlX3NpemUgKz0gc3VibWl0LT5jbWRidWYuc2l6ZTsKPiAg
ICAgICAgICAgICAgICAgbl9vYmorKzsKPiAgICAgICAgIH0KPiAtICAgICAgIHNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmdwdS0+c2NoZWQuam9iX2xpc3RfbG9jaywgZmxhZ3MpOwo+Cj4gICAgICAg
ICAvKiBBZGQgaW4gdGhlIGFjdGl2ZSBidWZmZXIgb2JqZWN0cyAqLwo+ICAgICAgICAgbGlzdF9m
b3JfZWFjaF9lbnRyeSh2cmFtLCAmZ3B1LT5tbXUtPm1hcHBpbmdzLCBtbXVfbm9kZSkgewo+IEBA
IC0xODMsMTQgKzE4MSwxMiBAQCB2b2lkIGV0bmF2aXZfY29yZV9kdW1wKHN0cnVjdCBldG5hdml2
X2dwdSAqZ3B1KQo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdwdS0+YnVmZmVyLnNp
emUsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXRuYXZpdl9jbWRidWZfZ2V0X3Zh
KCZncHUtPmJ1ZmZlcikpOwo+Cj4gLSAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmZ3B1LT5zY2hl
ZC5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4gICAgICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5KHNf
am9iLCAmZ3B1LT5zY2hlZC5yaW5nX21pcnJvcl9saXN0LCBub2RlKSB7Cj4gICAgICAgICAgICAg
ICAgIHN1Ym1pdCA9IHRvX2V0bmF2aXZfc3VibWl0KHNfam9iKTsKPiAgICAgICAgICAgICAgICAg
ZXRuYXZpdl9jb3JlX2R1bXBfbWVtKCZpdGVyLCBFVERVTVBfQlVGX0NNRCwKPiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdC0+Y21kYnVmLnZhZGRyLCBzdWJtaXQt
PmNtZGJ1Zi5zaXplLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXRu
YXZpdl9jbWRidWZfZ2V0X3ZhKCZzdWJtaXQtPmNtZGJ1ZikpOwo+ICAgICAgICAgfQo+IC0gICAg
ICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZ3B1LT5zY2hlZC5qb2JfbGlzdF9sb2NrLCBmbGFn
cyk7Cj4KPiAgICAgICAgIC8qIFJlc2VydmUgc3BhY2UgZm9yIHRoZSBib21hcCAqLwo+ICAgICAg
ICAgaWYgKG5fYm9tYXBfcGFnZXMpIHsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V0
bmF2aXYvZXRuYXZpdl9zY2hlZC5jIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9z
Y2hlZC5jCj4gaW5kZXggNmQyNGZlYS4uYTgxM2M4MiAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZXRuYXZpdi9ldG5hdml2X3NjaGVkLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vZXRu
YXZpdi9ldG5hdml2X3NjaGVkLmMKPiBAQCAtMTA5LDcgKzEwOSw3IEBAIHN0YXRpYyB2b2lkIGV0
bmF2aXZfc2NoZWRfdGltZWRvdXRfam9iKHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2Ip
Cj4gICAgICAgICB9Cj4KPiAgICAgICAgIC8qIGJsb2NrIHNjaGVkdWxlciAqLwo+IC0gICAgICAg
ZHJtX3NjaGVkX3N0b3AoJmdwdS0+c2NoZWQpOwo+ICsgICAgICAgZHJtX3NjaGVkX3N0b3AoJmdw
dS0+c2NoZWQsIHNjaGVkX2pvYik7Cj4KPiAgICAgICAgIGlmKHNjaGVkX2pvYikKPiAgICAgICAg
ICAgICAgICAgZHJtX3NjaGVkX2luY3JlYXNlX2thcm1hKHNjaGVkX2pvYik7Cj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9saW1hL2xpbWFfc2NoZWQuYyBiL2RyaXZlcnMvZ3B1L2RybS9s
aW1hL2xpbWFfc2NoZWQuYwo+IGluZGV4IDk3YmQ5YzEuLmRmOTg5MzEgMTAwNjQ0Cj4gLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2xpbWEvbGltYV9zY2hlZC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L2xpbWEvbGltYV9zY2hlZC5jCj4gQEAgLTMwMCw3ICszMDAsNyBAQCBzdGF0aWMgc3RydWN0IGRt
YV9mZW5jZSAqbGltYV9zY2hlZF9ydW5fam9iKHN0cnVjdCBkcm1fc2NoZWRfam9iICpqb2IpCj4g
IHN0YXRpYyB2b2lkIGxpbWFfc2NoZWRfaGFuZGxlX2Vycm9yX3Rhc2soc3RydWN0IGxpbWFfc2No
ZWRfcGlwZSAqcGlwZSwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IHN0cnVjdCBsaW1hX3NjaGVkX3Rhc2sgKnRhc2spCj4gIHsKPiAtICAgICAgIGRybV9zY2hlZF9z
dG9wKCZwaXBlLT5iYXNlKTsKPiArICAgICAgIGRybV9zY2hlZF9zdG9wKCZwaXBlLT5iYXNlLCAm
dGFzay0+YmFzZSk7Cj4KPiAgICAgICAgIGlmICh0YXNrKQo+ICAgICAgICAgICAgICAgICBkcm1f
c2NoZWRfaW5jcmVhc2Vfa2FybWEoJnRhc2stPmJhc2UpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rfam9iLmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJv
c3QvcGFuZnJvc3Rfam9iLmMKPiBpbmRleCAwYTdlZDA0Li5jNjMzNmI3IDEwMDY0NAo+IC0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYwo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYwo+IEBAIC0zODUsNyArMzg1LDcgQEAgc3Rh
dGljIHZvaWQgcGFuZnJvc3Rfam9iX3RpbWVkb3V0KHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hl
ZF9qb2IpCj4gICAgICAgICAgICAgICAgIHNjaGVkX2pvYik7Cj4KPiAgICAgICAgIGZvciAoaSA9
IDA7IGkgPCBOVU1fSk9CX1NMT1RTOyBpKyspCj4gLSAgICAgICAgICAgICAgIGRybV9zY2hlZF9z
dG9wKCZwZmRldi0+anMtPnF1ZXVlW2ldLnNjaGVkKTsKPiArICAgICAgICAgICAgICAgZHJtX3Nj
aGVkX3N0b3AoJnBmZGV2LT5qcy0+cXVldWVbaV0uc2NoZWQsIHNjaGVkX2pvYik7Cj4KPiAgICAg
ICAgIGlmIChzY2hlZF9qb2IpCj4gICAgICAgICAgICAgICAgIGRybV9zY2hlZF9pbmNyZWFzZV9r
YXJtYShzY2hlZF9qb2IpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVy
L3NjaGVkX21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jCj4g
aW5kZXggMTlmYzYwMS4uNzgxNmRlNyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vc2No
ZWR1bGVyL3NjaGVkX21haW4uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2No
ZWRfbWFpbi5jCj4gQEAgLTI2NSwzMiArMjY1LDYgQEAgdm9pZCBkcm1fc2NoZWRfcmVzdW1lX3Rp
bWVvdXQoc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCwKPiAgfQo+ICBFWFBPUlRfU1lN
Qk9MKGRybV9zY2hlZF9yZXN1bWVfdGltZW91dCk7Cj4KPiAtLyogam9iX2ZpbmlzaCBpcyBjYWxs
ZWQgYWZ0ZXIgaHcgZmVuY2Ugc2lnbmFsZWQKPiAtICovCj4gLXN0YXRpYyB2b2lkIGRybV9zY2hl
ZF9qb2JfZmluaXNoKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKPiAtewo+IC0gICAgICAgc3Ry
dWN0IGRybV9zY2hlZF9qb2IgKnNfam9iID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkcm1f
c2NoZWRfam9iLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGZpbmlzaF93b3JrKTsKPiAtICAgICAgIHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAq
c2NoZWQgPSBzX2pvYi0+c2NoZWQ7Cj4gLSAgICAgICB1bnNpZ25lZCBsb25nIGZsYWdzOwo+IC0K
PiAtICAgICAgIC8qCj4gLSAgICAgICAgKiBDYW5jZWxpbmcgdGhlIHRpbWVvdXQgd2l0aG91dCBy
ZW1vdmluZyBvdXIgam9iIGZyb20gdGhlIHJpbmcgbWlycm9yCj4gLSAgICAgICAgKiBsaXN0IGlz
IHNhZmUsIGFzIHdlIHdpbGwgb25seSBlbmQgdXAgaW4gdGhpcyB3b3JrZXIgaWYgb3VyIGpvYnMK
PiAtICAgICAgICAqIGZpbmlzaGVkIGZlbmNlIGhhcyBiZWVuIHNpZ25hbGVkLiBTbyBldmVuIGlm
IHNvbWUgYW5vdGhlciB3b3JrZXIKPiAtICAgICAgICAqIG1hbmFnZXMgdG8gZmluZCB0aGlzIGpv
YiBhcyB0aGUgbmV4dCBqb2IgaW4gdGhlIGxpc3QsIHRoZSBmZW5jZQo+IC0gICAgICAgICogc2ln
bmFsZWQgY2hlY2sgYmVsb3cgd2lsbCBwcmV2ZW50IHRoZSB0aW1lb3V0IHRvIGJlIHJlc3RhcnRl
ZC4KPiAtICAgICAgICAqLwo+IC0gICAgICAgY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZzY2hl
ZC0+d29ya190ZHIpOwo+IC0KPiAtICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZzY2hlZC0+am9i
X2xpc3RfbG9jaywgZmxhZ3MpOwo+IC0gICAgICAgLyogcXVldWUgVERSIGZvciBuZXh0IGpvYiAq
Lwo+IC0gICAgICAgZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQoc2NoZWQpOwo+IC0gICAgICAgc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiAtCj4g
LSAgICAgICBzY2hlZC0+b3BzLT5mcmVlX2pvYihzX2pvYik7Cj4gLX0KPiAtCj4gIHN0YXRpYyB2
b2lkIGRybV9zY2hlZF9qb2JfYmVnaW4oc3RydWN0IGRybV9zY2hlZF9qb2IgKnNfam9iKQo+ICB7
Cj4gICAgICAgICBzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkID0gc19qb2ItPnNjaGVk
Owo+IEBAIC0zMTUsNiArMjg5LDEzIEBAIHN0YXRpYyB2b2lkIGRybV9zY2hlZF9qb2JfdGltZWRv
dXQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQo+ICAgICAgICAgaWYgKGpvYikKPiAgICAgICAg
ICAgICAgICAgam9iLT5zY2hlZC0+b3BzLT50aW1lZG91dF9qb2Ioam9iKTsKPgo+ICsgICAgICAg
LyoKPiArICAgICAgICAqIEd1aWx0eSBqb2IgZGlkIGNvbXBsZXRlIGFuZCBoZW5jZSBuZWVkcyB0
byBiZSBtYW51YWxseSByZW1vdmVkCj4gKyAgICAgICAgKiBTZWUgZHJtX3NjaGVkX3N0b3AgZG9j
Lgo+ICsgICAgICAgICovCj4gKyAgICAgICBpZiAobGlzdF9lbXB0eSgmam9iLT5ub2RlKSkKPiAr
ICAgICAgICAgICAgICAgam9iLT5zY2hlZC0+b3BzLT5mcmVlX2pvYihqb2IpOwo+ICsKPiAgICAg
ICAgIHNwaW5fbG9ja19pcnFzYXZlKCZzY2hlZC0+am9iX2xpc3RfbG9jaywgZmxhZ3MpOwo+ICAg
ICAgICAgZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQoc2NoZWQpOwo+ICAgICAgICAgc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiBAQCAtMzcxLDIz
ICszNTIsMjYgQEAgRVhQT1JUX1NZTUJPTChkcm1fc2NoZWRfaW5jcmVhc2Vfa2FybWEpOwo+ICAg
KiBAc2NoZWQ6IHNjaGVkdWxlciBpbnN0YW5jZQo+ICAgKiBAYmFkOiBiYWQgc2NoZWR1bGVyIGpv
Ygo+ICAgKgo+ICsgKiBTdG9wIHRoZSBzY2hlZHVsZXIgYW5kIGFsc28gcmVtb3ZlcyBhbmQgZnJl
ZXMgYWxsIGNvbXBsZXRlZCBqb2JzLgo+ICsgKiBOb3RlOiBiYWQgam9iIHdpbGwgbm90IGJlIGZy
ZWVkIGFzIGl0IG1pZ2h0IGJlIHVzZWQgbGF0ZXIgYW5kIHNvIGl0J3MKPiArICogY2FsbGVycyBy
ZXNwb25zaWJpbGl0eSB0byByZWxlYXNlIGl0IG1hbnVhbGx5IGlmIGl0J3Mgbm90IHBhcnQgb2Yg
dGhlCj4gKyAqIG1pcnJvciBsaXN0IGFueSBtb3JlLgo+ICsgKgo+ICAgKi8KPiAtdm9pZCBkcm1f
c2NoZWRfc3RvcChzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+ICt2b2lkIGRybV9z
Y2hlZF9zdG9wKHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAqc2NoZWQsIHN0cnVjdCBkcm1fc2No
ZWRfam9iICpiYWQpCj4gIHsKPiAtICAgICAgIHN0cnVjdCBkcm1fc2NoZWRfam9iICpzX2pvYjsK
PiArICAgICAgIHN0cnVjdCBkcm1fc2NoZWRfam9iICpzX2pvYiwgKnRtcDsKPiAgICAgICAgIHVu
c2lnbmVkIGxvbmcgZmxhZ3M7Cj4gLSAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpsYXN0X2ZlbmNl
ID0gIE5VTEw7Cj4KPiAgICAgICAgIGt0aHJlYWRfcGFyayhzY2hlZC0+dGhyZWFkKTsKPgo+ICAg
ICAgICAgLyoKPiAtICAgICAgICAqIFZlcmlmeSBhbGwgdGhlIHNpZ25hbGVkIGpvYnMgaW4gbWly
cm9yIGxpc3QgYXJlIHJlbW92ZWQgZnJvbSB0aGUgcmluZwo+IC0gICAgICAgICogYnkgd2FpdGlu
ZyBmb3IgdGhlIGxhdGVzdCBqb2IgdG8gZW50ZXIgdGhlIGxpc3QuIFRoaXMgc2hvdWxkIGluc3Vy
ZSB0aGF0Cj4gLSAgICAgICAgKiBhbHNvIGFsbCB0aGUgcHJldmlvdXMgam9icyB0aGF0IHdlcmUg
aW4gZmxpZ2h0IGFsc28gYWxyZWFkeSBzaW5nYWxlZAo+IC0gICAgICAgICogYW5kIHJlbW92ZWQg
ZnJvbSB0aGUgbGlzdC4KPiArICAgICAgICAqIEl0ZXJhdGUgdGhlIGpvYiBsaXN0IGZyb20gbGF0
ZXIgdG8gIGVhcmxpZXIgb25lIGFuZCBlaXRoZXIgZGVhY3RpdmUKPiArICAgICAgICAqIHRoZWly
IEhXIGNhbGxiYWNrcyBvciByZW1vdmUgdGhlbSBmcm9tIG1pcnJvciBsaXN0IGlmIHRoZXkgYWxy
ZWFkeQo+ICsgICAgICAgICogc2lnbmFsZWQuCj4gKyAgICAgICAgKiBUaGlzIGl0ZXJhdGlvbiBp
cyB0aHJlYWQgc2FmZSBhcyBzY2hlZCB0aHJlYWQgaXMgc3RvcHBlZC4KPiAgICAgICAgICAqLwo+
IC0gICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7
Cj4gLSAgICAgICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVyc2Uoc19qb2IsICZzY2hlZC0+cmlu
Z19taXJyb3JfbGlzdCwgbm9kZSkgewo+ICsgICAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
X3JldmVyc2Uoc19qb2IsIHRtcCwgJnNjaGVkLT5yaW5nX21pcnJvcl9saXN0LCBub2RlKSB7Cj4g
ICAgICAgICAgICAgICAgIGlmIChzX2pvYi0+c19mZW5jZS0+cGFyZW50ICYmCj4gICAgICAgICAg
ICAgICAgICAgICBkbWFfZmVuY2VfcmVtb3ZlX2NhbGxiYWNrKHNfam9iLT5zX2ZlbmNlLT5wYXJl
bnQsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzX2pv
Yi0+Y2IpKSB7Cj4gQEAgLTM5NSwxNiArMzc5LDMwIEBAIHZvaWQgZHJtX3NjaGVkX3N0b3Aoc3Ry
dWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCkKPiAgICAgICAgICAgICAgICAgICAgICAgICBz
X2pvYi0+c19mZW5jZS0+cGFyZW50ID0gTlVMTDsKPiAgICAgICAgICAgICAgICAgICAgICAgICBh
dG9taWNfZGVjKCZzY2hlZC0+aHdfcnFfY291bnQpOwo+ICAgICAgICAgICAgICAgICB9IGVsc2Ug
ewo+IC0gICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2ZlbmNlID0gZG1hX2ZlbmNlX2dldCgm
c19qb2ItPnNfZmVuY2UtPmZpbmlzaGVkKTsKPiAtICAgICAgICAgICAgICAgICAgICAgICAgYnJl
YWs7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgLyoKPiArICAgICAgICAgICAgICAgICAgICAg
ICAgKiByZW1vdmUgam9iIGZyb20gcmluZ19taXJyb3JfbGlzdC4KPiArICAgICAgICAgICAgICAg
ICAgICAgICAgKiBMb2NraW5nIGhlcmUgaXMgZm9yIGNvbmN1cnJlbnQgcmVzdW1lIHRpbWVvdXQK
PiArICAgICAgICAgICAgICAgICAgICAgICAgKi8KPiArICAgICAgICAgICAgICAgICAgICAgICBz
cGluX2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiArICAgICAg
ICAgICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZzX2pvYi0+bm9kZSk7Cj4gKyAgICAgICAg
ICAgICAgICAgICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmc2NoZWQtPmpvYl9saXN0X2xv
Y2ssIGZsYWdzKTsKPiArCj4gKyAgICAgICAgICAgICAgICAgICAgICAgLyoKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgKiBXYWl0IGZvciBqb2IncyBIVyBmZW5jZSBjYWxsYmFjayB0byBmaW5p
c2ggdXNpbmcgc19qb2IKPiArICAgICAgICAgICAgICAgICAgICAgICAgKiBiZWZvcmUgcmVsZWFz
aW5nIGl0Lgo+ICsgICAgICAgICAgICAgICAgICAgICAgICAqCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICogSm9iIGlzIHN0aWxsIGFsaXZlIHNvIGZlbmNlIHJlZmNvdW50IGF0IGxlYXN0IDEK
PiArICAgICAgICAgICAgICAgICAgICAgICAgKi8KPiArICAgICAgICAgICAgICAgICAgICAgICBk
bWFfZmVuY2Vfd2FpdCgmc19qb2ItPnNfZmVuY2UtPmZpbmlzaGVkLCBmYWxzZSk7Cj4gKwo+ICsg
ICAgICAgICAgICAgICAgICAgICAgIC8qCj4gKyAgICAgICAgICAgICAgICAgICAgICAgICogV2Ug
bXVzdCBrZWVwIGJhZCBqb2IgYWxpdmUgZm9yIGxhdGVyIHVzZSBkdXJpbmcKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgKiByZWNvdmVyeSBieSBzb21lIG9mIHRoZSBkcml2ZXJzCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICovCj4gKyAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhZCAh
PSBzX2pvYikKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkLT5vcHMtPmZy
ZWVfam9iKHNfam9iKTsKPiAgICAgICAgICAgICAgICAgfQo+ICAgICAgICAgfQo+IC0gICAgICAg
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiAt
Cj4gLSAgICAgICBpZiAobGFzdF9mZW5jZSkgewo+IC0gICAgICAgICAgICAgICBkbWFfZmVuY2Vf
d2FpdChsYXN0X2ZlbmNlLCBmYWxzZSk7Cj4gLSAgICAgICAgICAgICAgIGRtYV9mZW5jZV9wdXQo
bGFzdF9mZW5jZSk7Cj4gLSAgICAgICB9Cj4gIH0KPgo+ICBFWFBPUlRfU1lNQk9MKGRybV9zY2hl
ZF9zdG9wKTsKPiBAQCAtNDE4LDIxICs0MTYsMjIgQEAgRVhQT1JUX1NZTUJPTChkcm1fc2NoZWRf
c3RvcCk7Cj4gIHZvaWQgZHJtX3NjaGVkX3N0YXJ0KHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAq
c2NoZWQsIGJvb2wgZnVsbF9yZWNvdmVyeSkKPiAgewo+ICAgICAgICAgc3RydWN0IGRybV9zY2hl
ZF9qb2IgKnNfam9iLCAqdG1wOwo+ICsgICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiAgICAg
ICAgIGludCByOwo+Cj4gLSAgICAgICBpZiAoIWZ1bGxfcmVjb3ZlcnkpCj4gLSAgICAgICAgICAg
ICAgIGdvdG8gdW5wYXJrOwo+IC0KPiAgICAgICAgIC8qCj4gICAgICAgICAgKiBMb2NraW5nIHRo
ZSBsaXN0IGlzIG5vdCByZXF1aXJlZCBoZXJlIGFzIHRoZSBzY2hlZCB0aHJlYWQgaXMgcGFya2Vk
Cj4gLSAgICAgICAgKiBzbyBubyBuZXcgam9icyBhcmUgYmVpbmcgcHVzaGVkIGluIHRvIEhXIGFu
ZCBpbiBkcm1fc2NoZWRfc3RvcCB3ZQo+IC0gICAgICAgICogZmx1c2hlZCBhbGwgdGhlIGpvYnMg
d2hvIHdlcmUgc3RpbGwgaW4gbWlycm9yIGxpc3QgYnV0IHdobyBhbHJlYWR5Cj4gLSAgICAgICAg
KiBzaWduYWxlZCBhbmQgcmVtb3ZlZCB0aGVtIHNlbGYgZnJvbSB0aGUgbGlzdC4gQWxzbyBjb25j
dXJyZW50Cj4gKyAgICAgICAgKiBzbyBubyBuZXcgam9icyBhcmUgYmVpbmcgaW5zZXJ0ZWQgb3Ig
cmVtb3ZlZC4gQWxzbyBjb25jdXJyZW50Cj4gICAgICAgICAgKiBHUFUgcmVjb3ZlcnMgY2FuJ3Qg
cnVuIGluIHBhcmFsbGVsLgo+ICAgICAgICAgICovCj4gICAgICAgICBsaXN0X2Zvcl9lYWNoX2Vu
dHJ5X3NhZmUoc19qb2IsIHRtcCwgJnNjaGVkLT5yaW5nX21pcnJvcl9saXN0LCBub2RlKSB7Cj4g
ICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gc19qb2ItPnNfZmVuY2Ut
PnBhcmVudDsKPgo+ICsgICAgICAgICAgICAgICBhdG9taWNfaW5jKCZzY2hlZC0+aHdfcnFfY291
bnQpOwo+ICsKPiArICAgICAgICAgICAgICAgaWYgKCFmdWxsX3JlY292ZXJ5KQo+ICsgICAgICAg
ICAgICAgICAgICAgICAgIGNvbnRpbnVlOwo+ICsKPiAgICAgICAgICAgICAgICAgaWYgKGZlbmNl
KSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgciA9IGRtYV9mZW5jZV9hZGRfY2FsbGJhY2so
ZmVuY2UsICZzX2pvYi0+Y2IsCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZHJtX3NjaGVkX3Byb2Nlc3Nfam9iKTsKPiBAQCAtNDQ1LDkgKzQ0NCwx
MiBAQCB2b2lkIGRybV9zY2hlZF9zdGFydChzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVk
LCBib29sIGZ1bGxfcmVjb3ZlcnkpCj4gICAgICAgICAgICAgICAgICAgICAgICAgZHJtX3NjaGVk
X3Byb2Nlc3Nfam9iKE5VTEwsICZzX2pvYi0+Y2IpOwo+ICAgICAgICAgfQo+Cj4gLSAgICAgICBk
cm1fc2NoZWRfc3RhcnRfdGltZW91dChzY2hlZCk7Cj4gKyAgICAgICBpZiAoZnVsbF9yZWNvdmVy
eSkgewo+ICsgICAgICAgICAgICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpvYl9saXN0
X2xvY2ssIGZsYWdzKTsKPiArICAgICAgICAgICAgICAgZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQo
c2NoZWQpOwo+ICsgICAgICAgICAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+
am9iX2xpc3RfbG9jaywgZmxhZ3MpOwo+ICsgICAgICAgfQo+Cj4gLXVucGFyazoKPiAgICAgICAg
IGt0aHJlYWRfdW5wYXJrKHNjaGVkLT50aHJlYWQpOwo+ICB9Cj4gIEVYUE9SVF9TWU1CT0woZHJt
X3NjaGVkX3N0YXJ0KTsKPiBAQCAtNDY0LDcgKzQ2Niw2IEBAIHZvaWQgZHJtX3NjaGVkX3Jlc3Vi
bWl0X2pvYnMoc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCkKPiAgICAgICAgIHVpbnQ2
NF90IGd1aWx0eV9jb250ZXh0Owo+ICAgICAgICAgYm9vbCBmb3VuZF9ndWlsdHkgPSBmYWxzZTsK
Pgo+IC0gICAgICAgLypUT0RPIERPIHdlIG5lZWQgc3BpbmxvY2sgaGVyZSA/ICovCj4gICAgICAg
ICBsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoc19qb2IsIHRtcCwgJnNjaGVkLT5yaW5nX21pcnJv
cl9saXN0LCBub2RlKSB7Cj4gICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1fc2NoZWRfZmVuY2Ug
KnNfZmVuY2UgPSBzX2pvYi0+c19mZW5jZTsKPgo+IEBAIC00NzcsNyArNDc4LDYgQEAgdm9pZCBk
cm1fc2NoZWRfcmVzdWJtaXRfam9icyhzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+
ICAgICAgICAgICAgICAgICAgICAgICAgIGRtYV9mZW5jZV9zZXRfZXJyb3IoJnNfZmVuY2UtPmZp
bmlzaGVkLCAtRUNBTkNFTEVEKTsKPgo+ICAgICAgICAgICAgICAgICBzX2pvYi0+c19mZW5jZS0+
cGFyZW50ID0gc2NoZWQtPm9wcy0+cnVuX2pvYihzX2pvYik7Cj4gLSAgICAgICAgICAgICAgIGF0
b21pY19pbmMoJnNjaGVkLT5od19ycV9jb3VudCk7Cj4gICAgICAgICB9Cj4gIH0KPiAgRVhQT1JU
X1NZTUJPTChkcm1fc2NoZWRfcmVzdWJtaXRfam9icyk7Cj4gQEAgLTUxNCw3ICs1MTQsNiBAQCBp
bnQgZHJtX3NjaGVkX2pvYl9pbml0KHN0cnVjdCBkcm1fc2NoZWRfam9iICpqb2IsCj4gICAgICAg
ICAgICAgICAgIHJldHVybiAtRU5PTUVNOwo+ICAgICAgICAgam9iLT5pZCA9IGF0b21pYzY0X2lu
Y19yZXR1cm4oJnNjaGVkLT5qb2JfaWRfY291bnQpOwo+Cj4gLSAgICAgICBJTklUX1dPUksoJmpv
Yi0+ZmluaXNoX3dvcmssIGRybV9zY2hlZF9qb2JfZmluaXNoKTsKPiAgICAgICAgIElOSVRfTElT
VF9IRUFEKCZqb2ItPm5vZGUpOwo+Cj4gICAgICAgICByZXR1cm4gMDsKPiBAQCAtNTk3LDI0ICs1
OTYsNTMgQEAgc3RhdGljIHZvaWQgZHJtX3NjaGVkX3Byb2Nlc3Nfam9iKHN0cnVjdCBkbWFfZmVu
Y2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQo+ICAgICAgICAgc3RydWN0IGRybV9zY2hl
ZF9qb2IgKnNfam9iID0gY29udGFpbmVyX29mKGNiLCBzdHJ1Y3QgZHJtX3NjaGVkX2pvYiwgY2Ip
Owo+ICAgICAgICAgc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZSA9IHNfam9iLT5zX2Zl
bmNlOwo+ICAgICAgICAgc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCA9IHNfZmVuY2Ut
PnNjaGVkOwo+IC0gICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiAtCj4gLSAgICAgICBjYW5j
ZWxfZGVsYXllZF93b3JrKCZzY2hlZC0+d29ya190ZHIpOwo+Cj4gICAgICAgICBhdG9taWNfZGVj
KCZzY2hlZC0+aHdfcnFfY291bnQpOwo+ICAgICAgICAgYXRvbWljX2RlYygmc2NoZWQtPm51bV9q
b2JzKTsKPgo+IC0gICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkLT5qb2JfbGlzdF9sb2Nr
LCBmbGFncyk7Cj4gLSAgICAgICAvKiByZW1vdmUgam9iIGZyb20gcmluZ19taXJyb3JfbGlzdCAq
Lwo+IC0gICAgICAgbGlzdF9kZWxfaW5pdCgmc19qb2ItPm5vZGUpOwo+IC0gICAgICAgc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiArICAgICAg
IHRyYWNlX2RybV9zY2hlZF9wcm9jZXNzX2pvYihzX2ZlbmNlKTsKPgo+ICAgICAgICAgZHJtX3Nj
aGVkX2ZlbmNlX2ZpbmlzaGVkKHNfZmVuY2UpOwo+IC0KPiAtICAgICAgIHRyYWNlX2RybV9zY2hl
ZF9wcm9jZXNzX2pvYihzX2ZlbmNlKTsKPiAgICAgICAgIHdha2VfdXBfaW50ZXJydXB0aWJsZSgm
c2NoZWQtPndha2VfdXBfd29ya2VyKTsKPiArfQo+ICsKPiArLyoqCj4gKyAqIGRybV9zY2hlZF9j
bGVhbnVwX2pvYnMgLSBkZXN0cm95IGZpbmlzaGVkIGpvYnMKPiArICoKPiArICogQHNjaGVkOiBz
Y2hlZHVsZXIgaW5zdGFuY2UKPiArICoKPiArICogUmVtb3ZlIGFsbCBmaW5pc2hlZCBqb2JzIGZy
b20gdGhlIG1pcnJvciBsaXN0IGFuZCBkZXN0cm95IHRoZW0uCj4gKyAqLwo+ICtzdGF0aWMgdm9p
ZCBkcm1fc2NoZWRfY2xlYW51cF9qb2JzKHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAqc2NoZWQp
Cj4gK3sKPiArICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4gKwo+ICsgICAgICAgLyogRG9u
J3QgZGVzdHJveSBqb2JzIHdoaWxlIHRoZSB0aW1lb3V0IHdvcmtlciBpcyBydW5uaW5nICovCj4g
KyAgICAgICBpZiAoIWNhbmNlbF9kZWxheWVkX3dvcmsoJnNjaGVkLT53b3JrX3RkcikpCj4gKyAg
ICAgICAgICAgICAgIHJldHVybjsKPiArCj4gKwo+ICsgICAgICAgd2hpbGUgKCFsaXN0X2VtcHR5
KCZzY2hlZC0+cmluZ19taXJyb3JfbGlzdCkpIHsKPiArICAgICAgICAgICAgICAgc3RydWN0IGRy
bV9zY2hlZF9qb2IgKmpvYjsKPiArCj4gKyAgICAgICAgICAgICAgIGpvYiA9IGxpc3RfZmlyc3Rf
ZW50cnkoJnNjaGVkLT5yaW5nX21pcnJvcl9saXN0LAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1fc2NoZWRfam9iLCBub2RlKTsKPiArICAgICAgICAg
ICAgICAgaWYgKCFkbWFfZmVuY2VfaXNfc2lnbmFsZWQoJmpvYi0+c19mZW5jZS0+ZmluaXNoZWQp
KQo+ICsgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ICsKPiArICAgICAgICAgICAgICAg
c3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4gKyAgICAg
ICAgICAgICAgIC8qIHJlbW92ZSBqb2IgZnJvbSByaW5nX21pcnJvcl9saXN0ICovCj4gKyAgICAg
ICAgICAgICAgIGxpc3RfZGVsX2luaXQoJmpvYi0+bm9kZSk7Cj4gKyAgICAgICAgICAgICAgIHNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4gKwo+
ICsgICAgICAgICAgICAgICBzY2hlZC0+b3BzLT5mcmVlX2pvYihqb2IpOwo+ICsgICAgICAgfQo+
ICsKPiArICAgICAgIC8qIHF1ZXVlIHRpbWVvdXQgZm9yIG5leHQgam9iICovCj4gKyAgICAgICBz
cGluX2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPiArICAgICAg
IGRybV9zY2hlZF9zdGFydF90aW1lb3V0KHNjaGVkKTsKPiArICAgICAgIHNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4KPiAtICAgICAgIHNjaGVk
dWxlX3dvcmsoJnNfam9iLT5maW5pc2hfd29yayk7Cj4gIH0KPgo+ICAvKioKPiBAQCAtNjU2LDkg
KzY4NCwxMCBAQCBzdGF0aWMgaW50IGRybV9zY2hlZF9tYWluKHZvaWQgKnBhcmFtKQo+ICAgICAg
ICAgICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKPgo+ICAgICAgICAgICAgICAgICB3
YWl0X2V2ZW50X2ludGVycnVwdGlibGUoc2NoZWQtPndha2VfdXBfd29ya2VyLAo+ICsgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGRybV9zY2hlZF9jbGVhbnVwX2pvYnMo
c2NoZWQpLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCFkcm1f
c2NoZWRfYmxvY2tlZChzY2hlZCkgJiYKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAoZW50aXR5ID0gZHJtX3NjaGVkX3NlbGVjdF9lbnRpdHkoc2NoZWQpKSkgfHwK
PiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGt0aHJlYWRfc2hvdWxk
X3N0b3AoKSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrdGhy
ZWFkX3Nob3VsZF9zdG9wKCkpKTsKPgo+ICAgICAgICAgICAgICAgICBpZiAoIWVudGl0eSkKPiAg
ICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3YzZC92M2Rfc2NoZWQuYyBiL2RyaXZlcnMvZ3B1L2RybS92M2QvdjNkX3NjaGVkLmMK
PiBpbmRleCBlNzQwZjNiLi4xYTRhYmU3IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS92
M2QvdjNkX3NjaGVkLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vdjNkL3YzZF9zY2hlZC5jCj4g
QEAgLTIzMiw3ICsyMzIsNyBAQCB2M2RfZ3B1X3Jlc2V0X2Zvcl90aW1lb3V0KHN0cnVjdCB2M2Rf
ZGV2ICp2M2QsIHN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2IpCj4KPiAgICAgICAgIC8q
IGJsb2NrIHNjaGVkdWxlciAqLwo+ICAgICAgICAgZm9yIChxID0gMDsgcSA8IFYzRF9NQVhfUVVF
VUVTOyBxKyspCj4gLSAgICAgICAgICAgICAgIGRybV9zY2hlZF9zdG9wKCZ2M2QtPnF1ZXVlW3Fd
LnNjaGVkKTsKPiArICAgICAgICAgICAgICAgZHJtX3NjaGVkX3N0b3AoJnYzZC0+cXVldWVbcV0u
c2NoZWQsIHNjaGVkX2pvYik7Cj4KPiAgICAgICAgIGlmIChzY2hlZF9qb2IpCj4gICAgICAgICAg
ICAgICAgIGRybV9zY2hlZF9pbmNyZWFzZV9rYXJtYShzY2hlZF9qb2IpOwo+IGRpZmYgLS1naXQg
YS9pbmNsdWRlL2RybS9ncHVfc2NoZWR1bGVyLmggYi9pbmNsdWRlL2RybS9ncHVfc2NoZWR1bGVy
LmgKPiBpbmRleCAwZGFjYTRkLi45ZWUwZjI3IDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvZHJtL2dw
dV9zY2hlZHVsZXIuaAo+ICsrKyBiL2luY2x1ZGUvZHJtL2dwdV9zY2hlZHVsZXIuaAo+IEBAIC0x
NjcsOSArMTY3LDYgQEAgc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqdG9fZHJtX3NjaGVkX2ZlbmNl
KHN0cnVjdCBkbWFfZmVuY2UgKmYpOwo+ICAgKiBAc2NoZWQ6IHRoZSBzY2hlZHVsZXIgaW5zdGFu
Y2Ugb24gd2hpY2ggdGhpcyBqb2IgaXMgc2NoZWR1bGVkLgo+ICAgKiBAc19mZW5jZTogY29udGFp
bnMgdGhlIGZlbmNlcyBmb3IgdGhlIHNjaGVkdWxpbmcgb2Ygam9iLgo+ICAgKiBAZmluaXNoX2Ni
OiB0aGUgY2FsbGJhY2sgZm9yIHRoZSBmaW5pc2hlZCBmZW5jZS4KPiAtICogQGZpbmlzaF93b3Jr
OiBzY2hlZHVsZXMgdGhlIGZ1bmN0aW9uIEBkcm1fc2NoZWRfam9iX2ZpbmlzaCBvbmNlIHRoZSBq
b2IgaGFzCj4gLSAqICAgICAgICAgICAgICAgZmluaXNoZWQgdG8gcmVtb3ZlIHRoZSBqb2IgZnJv
bSB0aGUKPiAtICogICAgICAgICAgICAgICBAZHJtX2dwdV9zY2hlZHVsZXIucmluZ19taXJyb3Jf
bGlzdC4KPiAgICogQG5vZGU6IHVzZWQgdG8gYXBwZW5kIHRoaXMgc3RydWN0IHRvIHRoZSBAZHJt
X2dwdV9zY2hlZHVsZXIucmluZ19taXJyb3JfbGlzdC4KPiAgICogQGlkOiBhIHVuaXF1ZSBpZCBh
c3NpZ25lZCB0byBlYWNoIGpvYiBzY2hlZHVsZWQgb24gdGhlIHNjaGVkdWxlci4KPiAgICogQGth
cm1hOiBpbmNyZW1lbnQgb24gZXZlcnkgaGFuZyBjYXVzZWQgYnkgdGhpcyBqb2IuIElmIHRoaXMg
ZXhjZWVkcyB0aGUgaGFuZwo+IEBAIC0xODgsNyArMTg1LDYgQEAgc3RydWN0IGRybV9zY2hlZF9q
b2Igewo+ICAgICAgICAgc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICAgICAgICAqc2NoZWQ7Cj4g
ICAgICAgICBzdHJ1Y3QgZHJtX3NjaGVkX2ZlbmNlICAgICAgICAgICpzX2ZlbmNlOwo+ICAgICAg
ICAgc3RydWN0IGRtYV9mZW5jZV9jYiAgICAgICAgICAgICBmaW5pc2hfY2I7Cj4gLSAgICAgICBz
dHJ1Y3Qgd29ya19zdHJ1Y3QgICAgICAgICAgICAgIGZpbmlzaF93b3JrOwo+ICAgICAgICAgc3Ry
dWN0IGxpc3RfaGVhZCAgICAgICAgICAgICAgICBub2RlOwo+ICAgICAgICAgdWludDY0X3QgICAg
ICAgICAgICAgICAgICAgICAgICBpZDsKPiAgICAgICAgIGF0b21pY190ICAgICAgICAgICAgICAg
ICAgICAgICAga2FybWE7Cj4gQEAgLTI5Niw3ICsyOTIsNyBAQCBpbnQgZHJtX3NjaGVkX2pvYl9p
bml0KHN0cnVjdCBkcm1fc2NoZWRfam9iICpqb2IsCj4gICAgICAgICAgICAgICAgICAgICAgICB2
b2lkICpvd25lcik7Cj4gIHZvaWQgZHJtX3NjaGVkX2pvYl9jbGVhbnVwKHN0cnVjdCBkcm1fc2No
ZWRfam9iICpqb2IpOwo+ICB2b2lkIGRybV9zY2hlZF93YWtldXAoc3RydWN0IGRybV9ncHVfc2No
ZWR1bGVyICpzY2hlZCk7Cj4gLXZvaWQgZHJtX3NjaGVkX3N0b3Aoc3RydWN0IGRybV9ncHVfc2No
ZWR1bGVyICpzY2hlZCk7Cj4gK3ZvaWQgZHJtX3NjaGVkX3N0b3Aoc3RydWN0IGRybV9ncHVfc2No
ZWR1bGVyICpzY2hlZCwgc3RydWN0IGRybV9zY2hlZF9qb2IgKmJhZCk7Cj4gIHZvaWQgZHJtX3Nj
aGVkX3N0YXJ0KHN0cnVjdCBkcm1fZ3B1X3NjaGVkdWxlciAqc2NoZWQsIGJvb2wgZnVsbF9yZWNv
dmVyeSk7Cj4gIHZvaWQgZHJtX3NjaGVkX3Jlc3VibWl0X2pvYnMoc3RydWN0IGRybV9ncHVfc2No
ZWR1bGVyICpzY2hlZCk7Cj4gIHZvaWQgZHJtX3NjaGVkX2luY3JlYXNlX2thcm1hKHN0cnVjdCBk
cm1fc2NoZWRfam9iICpiYWQpOwo+IC0tCj4gMi43LjQKPgo+IF9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCj4gZHJpLWRldmVsIG1haWxpbmcgbGlzdAo+IGRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKPiBodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAoKCgotLSAKRGFuaWVsIFZldHRlcgpTb2Z0
d2FyZSBFbmdpbmVlciwgSW50ZWwgQ29ycG9yYXRpb24KKzQxICgwKSA3OSAzNjUgNTcgNDggLSBo
dHRwOi8vYmxvZy5mZndsbC5jaApfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9k
cmktZGV2ZWw=
