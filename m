Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F338E10F9F9
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 09:38:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C15046E42F;
	Tue,  3 Dec 2019 08:38:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3A7516E42D
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 08:38:25 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id BA087AE03;
 Tue,  3 Dec 2019 08:38:23 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, maarten.lankhorst@linux.intel.com, mripard@kernel.org,
 airlied@linux.ie, z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com, sam@ravnborg.org,
 kraxel@redhat.com
Subject: [PATCH v3 4/5] drm/hisilicon/hibmc: Implement hibmc_dumb_create()
 with generic helpers
Date: Tue,  3 Dec 2019 09:38:18 +0100
Message-Id: <20191203083819.6643-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203083819.6643-1-tzimmermann@suse.de>
References: <20191203083819.6643-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGhpYm1jIGRyaXZlciBhbGlnbnMgc2NhbmxpbmVzIHRvIDE2IGJ5dGVzLiBCeSB1c2luZyB0
aGUgbmV3IHBpdGNoX2FsaWduCmFyZ3VtZW50IG9mIGRybV9nZW1fdnJhbV9maWxsX2NyZWF0ZV9k
dW1iKCksIGNvbnZlcnQgaGlibWMgb3Zlci4KCnYyOgoJKiBtb3ZlIGNoYW5nZXMgdG8gVlJBTSBo
ZWxwZXJzIGludG8gc2VwYXJhdGUgcGF0Y2gKClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJt
YW5uIDx0emltbWVybWFubkBzdXNlLmRlPgpSZXZpZXdlZC1ieTogRGFuaWVsIFZldHRlciA8ZGFu
aWVsLnZldHRlckBmZndsbC5jaD4KQWNrZWQtYnk6IFNhbSBSYXZuYm9yZyA8c2FtQHJhdm5ib3Jn
Lm9yZz4KLS0tCiAuLi4vZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oICAg
fCAgNCAtLQogZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYyAgIHwg
NDggKy0tLS0tLS0tLS0tLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAyIGluc2VydGlvbnMoKyks
IDUwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24v
aGlibWMvaGlibWNfZHJtX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9o
aWJtY19kcm1fZHJ2LmgKaW5kZXggOGViNzI1OGIyMzZhLi41MGEwYzFmOWQyMTEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oCkBAIC0xOCw3
ICsxOCw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9mcmFtZWJ1ZmZlci5oPgogCiBzdHJ1Y3QgZHJt
X2RldmljZTsKLXN0cnVjdCBkcm1fZ2VtX29iamVjdDsKIAogc3RydWN0IGhpYm1jX2RybV9wcml2
YXRlIHsKIAkvKiBodyAqLwpAQCAtNDEsOSArNDAsNiBAQCB2b2lkIGhpYm1jX3NldF9jdXJyZW50
X2dhdGUoc3RydWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2LAogaW50IGhpYm1jX2RlX2luaXQo
c3RydWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2KTsKIGludCBoaWJtY192ZGFjX2luaXQoc3Ry
dWN0IGhpYm1jX2RybV9wcml2YXRlICpwcml2KTsKIAotaW50IGhpYm1jX2dlbV9jcmVhdGUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdTMyIHNpemUsIGJvb2wgaXNrZXJuZWwsCi0JCSAgICAgc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqKTsKLQogaW50IGhpYm1jX21tX2luaXQoc3RydWN0IGhp
Ym1jX2RybV9wcml2YXRlICpoaWJtYyk7CiB2b2lkIGhpYm1jX21tX2Zpbmkoc3RydWN0IGhpYm1j
X2RybV9wcml2YXRlICpoaWJtYyk7CiBpbnQgaGlibWNfZHVtYl9jcmVhdGUoc3RydWN0IGRybV9m
aWxlICpmaWxlLCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24vaGlibWMvaGlibWNfdHRtLmMKaW5kZXggZjZkMjViODVjMjA5Li4wYWY1ZDk2NmE0ODAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY190dG0uYwpAQCAtNDcs
NTUgKzQ3LDExIEBAIHZvaWQgaGlibWNfbW1fZmluaShzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUg
KmhpYm1jKQogCWRybV92cmFtX2hlbHBlcl9yZWxlYXNlX21tKGhpYm1jLT5kZXYpOwogfQogCi1p
bnQgaGlibWNfZ2VtX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1MzIgc2l6ZSwgYm9v
bCBpc2tlcm5lbCwKLQkJICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKipvYmopCi17Ci0Jc3Ry
dWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibzsKLQlpbnQgcmV0OwotCi0JKm9iaiA9IE5VTEw7
Ci0KLQlzaXplID0gcm91bmR1cChzaXplLCBQQUdFX1NJWkUpOwotCWlmIChzaXplID09IDApCi0J
CXJldHVybiAtRUlOVkFMOwotCi0JZ2JvID0gZHJtX2dlbV92cmFtX2NyZWF0ZShkZXYsICZkZXYt
PnZyYW1fbW0tPmJkZXYsIHNpemUsIDAsIGZhbHNlKTsKLQlpZiAoSVNfRVJSKGdibykpIHsKLQkJ
cmV0ID0gUFRSX0VSUihnYm8pOwotCQlpZiAocmV0ICE9IC1FUkVTVEFSVFNZUykKLQkJCURSTV9F
UlJPUigiZmFpbGVkIHRvIGFsbG9jYXRlIEdFTSBvYmplY3Q6ICVkXG4iLCByZXQpOwotCQlyZXR1
cm4gcmV0OwotCX0KLQkqb2JqID0gJmdiby0+Ym8uYmFzZTsKLQlyZXR1cm4gMDsKLX0KLQogaW50
IGhpYm1jX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwgc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJICAgICAgc3RydWN0IGRybV9tb2RlX2NyZWF0ZV9kdW1iICphcmdzKQogewot
CXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ29iajsKLQl1MzIgaGFuZGxlOwotCWludCByZXQ7Ci0K
LQlhcmdzLT5waXRjaCA9IEFMSUdOKGFyZ3MtPndpZHRoICogRElWX1JPVU5EX1VQKGFyZ3MtPmJw
cCwgOCksIDE2KTsKLQlhcmdzLT5zaXplID0gYXJncy0+cGl0Y2ggKiBhcmdzLT5oZWlnaHQ7Ci0K
LQlyZXQgPSBoaWJtY19nZW1fY3JlYXRlKGRldiwgYXJncy0+c2l6ZSwgZmFsc2UsCi0JCQkgICAg
ICAgJmdvYmopOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gY3JlYXRlIEdF
TSBvYmplY3Q6ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCXJldCA9IGRybV9n
ZW1faGFuZGxlX2NyZWF0ZShmaWxlLCBnb2JqLCAmaGFuZGxlKTsKLQlkcm1fZ2VtX29iamVjdF9w
dXRfdW5sb2NrZWQoZ29iaik7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byB1
bnJlZmVyZW5jZSBHRU0gb2JqZWN0OiAlZFxuIiwgcmV0KTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0K
LQlhcmdzLT5oYW5kbGUgPSBoYW5kbGU7Ci0JcmV0dXJuIDA7CisJcmV0dXJuIGRybV9nZW1fdnJh
bV9maWxsX2NyZWF0ZV9kdW1iKGZpbGUsIGRldiwgJmRldi0+dnJhbV9tbS0+YmRldiwKKwkJCQkJ
ICAgICAwLCAxNiwgZmFsc2UsIGFyZ3MpOwogfQogCiBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29u
ZmlnX2Z1bmNzIGhpYm1jX21vZGVfZnVuY3MgPSB7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QK
ZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
