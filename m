Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 96228A1626
	for <lists+dri-devel@lfdr.de>; Thu, 29 Aug 2019 12:34:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D6CF16E0A2;
	Thu, 29 Aug 2019 10:33:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2866E6E09F
 for <dri-devel@lists.freedesktop.org>; Thu, 29 Aug 2019 10:33:08 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx07.intmail.prod.int.phx2.redhat.com
 [10.5.11.22])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 8A434301A893;
 Thu, 29 Aug 2019 10:33:07 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-95.ams2.redhat.com
 [10.36.116.95])
 by smtp.corp.redhat.com (Postfix) with ESMTP id BFC841001B09;
 Thu, 29 Aug 2019 10:33:06 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id C878331EEA; Thu, 29 Aug 2019 12:33:02 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v9 07/18] drm/virtio: add virtio_gpu_object_array & helpers
Date: Thu, 29 Aug 2019 12:32:50 +0200
Message-Id: <20190829103301.3539-8-kraxel@redhat.com>
In-Reply-To: <20190829103301.3539-1-kraxel@redhat.com>
References: <20190829103301.3539-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.22
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.45]); Thu, 29 Aug 2019 10:33:07 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>,
 Gerd Hoffmann <kraxel@redhat.com>, gurchetansingh@chromium.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U29tZSBoZWxwZXIgZnVuY3Rpb25zIHRvIG1hbmFnZSBhbiBhcnJheSBvZiBnZW0gb2JqZWN0cy4K
CnY5OiB1c2UgZG1hX3Jlc3ZfbG9ja19pbnRlcnJ1cHRpYmxlLgp2NjoKIC0gYWRkIHRpY2tldCB0
byBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkuCiAtIGFkZCB2aXJ0aW9fZ3B1X2FycmF5
X3tsb2NrLHVubG9ja31fcmVzdiBoZWxwZXJzLgogLSBhZGQgdmlydGlvX2dwdV9hcnJheV9hZGRf
ZmVuY2UgaGVscGVyLgp2NTogc29tZSBzbWFsbCBvcHRpbWl6YXRpb25zIChDaGlhLUkgV3UpLgp2
NDogbWFrZSB0aGVtIHZpcnRpby1wcml2YXRlIGluc3RlYWQgb2YgZ2VuZXJpYyBoZWxwZXJzLgoK
U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+CgpbZml4dXBd
IHZpcnRpb19ncHVfYXJyYXlfbG9ja19yZXN2Ci0tLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92
aXJ0Z3B1X2Rydi5oIHwgMTcgKysrKysKIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9n
ZW0uYyB8IDkzICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwg
MTEwIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3Zp
cnRncHVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKaW5kZXgg
ZGI1N2JiYjM2MjE2Li5iNmJkMmIxMTQxZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
ZHJ2LmgKQEAgLTg0LDYgKzg0LDEyIEBAIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdCB7CiAjZGVm
aW5lIGdlbV90b192aXJ0aW9fZ3B1X29iaihnb2JqKSBcCiAJY29udGFpbmVyX29mKChnb2JqKSwg
c3RydWN0IHZpcnRpb19ncHVfb2JqZWN0LCBnZW1fYmFzZSkKIAorc3RydWN0IHZpcnRpb19ncHVf
b2JqZWN0X2FycmF5IHsKKwlzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggdGlja2V0OworCXUzMiBuZW50
cywgdG90YWw7CisJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmpzW107Cit9OworCiBzdHJ1Y3Qg
dmlydGlvX2dwdV92YnVmZmVyOwogc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlOwogCkBAIC0yNTEs
NiArMjU3LDE3IEBAIGludCB2aXJ0aW9fZ3B1X21vZGVfZHVtYl9tbWFwKHN0cnVjdCBkcm1fZmls
ZSAqZmlsZV9wcml2LAogCQkJICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAgICAg
IHVpbnQzMl90IGhhbmRsZSwgdWludDY0X3QgKm9mZnNldF9wKTsKIAorc3RydWN0IHZpcnRpb19n
cHVfb2JqZWN0X2FycmF5ICp2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKHUzMiBuZW50cyk7CitzdHJ1
Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkqCit2aXJ0aW9fZ3B1X2FycmF5X2Zyb21faGFuZGxl
cyhzdHJ1Y3QgZHJtX2ZpbGUgKmRybV9maWxlLCB1MzIgKmhhbmRsZXMsIHUzMiBuZW50cyk7Cit2
b2lkIHZpcnRpb19ncHVfYXJyYXlfYWRkX29iaihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJy
YXkgKm9ianMsCisJCQkgICAgICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CitpbnQgdmly
dGlvX2dwdV9hcnJheV9sb2NrX3Jlc3Yoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpv
YmpzKTsKK3ZvaWQgdmlydGlvX2dwdV9hcnJheV91bmxvY2tfcmVzdihzdHJ1Y3QgdmlydGlvX2dw
dV9vYmplY3RfYXJyYXkgKm9ianMpOwordm9pZCB2aXJ0aW9fZ3B1X2FycmF5X2FkZF9mZW5jZShz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMsCisJCQkJc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpOwordm9pZCB2aXJ0aW9fZ3B1X2FycmF5X3B1dF9mcmVlKHN0cnVjdCB2aXJ0aW9f
Z3B1X29iamVjdF9hcnJheSAqb2Jqcyk7CisKIC8qIHZpcnRpbyB2ZyAqLwogaW50IHZpcnRpb19n
cHVfYWxsb2NfdmJ1ZnMoc3RydWN0IHZpcnRpb19ncHVfZGV2aWNlICp2Z2Rldik7CiB2b2lkIHZp
cnRpb19ncHVfZnJlZV92YnVmcyhzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYyBiL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYwppbmRleCA2ZmU2ZjcyZjY0ZDEuLmZkNjBiNDVh
YWJkMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2dlbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9nZW0uYwpAQCAtMTcxLDMgKzE3MSw5
NiBAQCB2b2lkIHZpcnRpb19ncHVfZ2VtX29iamVjdF9jbG9zZShzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3QgKm9iaiwKIAkJCQkJCXFvYmotPmh3X3Jlc19oYW5kbGUpOwogCXZpcnRpb19ncHVfb2JqZWN0
X3VucmVzZXJ2ZShxb2JqKTsKIH0KKworc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICp2
aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKHUzMiBuZW50cykKK3sKKwlzdHJ1Y3QgdmlydGlvX2dwdV9v
YmplY3RfYXJyYXkgKm9ianM7CisJc2l6ZV90IHNpemUgPSBzaXplb2YoKm9ianMpICsgc2l6ZW9m
KG9ianMtPm9ianNbMF0pICogbmVudHM7CisKKwlvYmpzID0ga21hbGxvYyhzaXplLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIW9ianMpCisJCXJldHVybiBOVUxMOworCisJb2Jqcy0+bmVudHMgPSAwOwor
CW9ianMtPnRvdGFsID0gbmVudHM7CisJcmV0dXJuIG9ianM7Cit9CisKK3N0YXRpYyB2b2lkIHZp
cnRpb19ncHVfYXJyYXlfZnJlZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMp
Cit7CisJa2ZyZWUob2Jqcyk7Cit9CisKK3N0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSoK
K3ZpcnRpb19ncHVfYXJyYXlfZnJvbV9oYW5kbGVzKHN0cnVjdCBkcm1fZmlsZSAqZHJtX2ZpbGUs
IHUzMiAqaGFuZGxlcywgdTMyIG5lbnRzKQoreworCXN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9h
cnJheSAqb2JqczsKKwl1MzIgaTsKKworCW9ianMgPSB2aXJ0aW9fZ3B1X2FycmF5X2FsbG9jKG5l
bnRzKTsKKwlpZiAoIW9ianMpCisJCXJldHVybiBOVUxMOworCisJZm9yIChpID0gMDsgaSA8IG5l
bnRzOyBpKyspIHsKKwkJb2Jqcy0+b2Jqc1tpXSA9IGRybV9nZW1fb2JqZWN0X2xvb2t1cChkcm1f
ZmlsZSwgaGFuZGxlc1tpXSk7CisJCWlmICghb2Jqcy0+b2Jqc1tpXSkgeworCQkJb2Jqcy0+bmVu
dHMgPSBpOworCQkJdmlydGlvX2dwdV9hcnJheV9wdXRfZnJlZShvYmpzKTsKKwkJCXJldHVybiBO
VUxMOworCQl9CisJfQorCW9ianMtPm5lbnRzID0gaTsKKwlyZXR1cm4gb2JqczsKK30KKwordm9p
ZCB2aXJ0aW9fZ3B1X2FycmF5X2FkZF9vYmooc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5
ICpvYmpzLAorCQkJICAgICAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCit7CisJaWYgKFdB
Uk5fT05fT05DRShvYmpzLT5uZW50cyA9PSBvYmpzLT50b3RhbCkpCisJCXJldHVybjsKKworCWRy
bV9nZW1fb2JqZWN0X2dldChvYmopOworCW9ianMtPm9ianNbb2Jqcy0+bmVudHNdID0gb2JqOwor
CW9ianMtPm5lbnRzKys7Cit9CisKK2ludCB2aXJ0aW9fZ3B1X2FycmF5X2xvY2tfcmVzdihzdHJ1
Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMpCit7CisJaW50IHJldDsKKworCWlmIChv
YmpzLT5uZW50cyA9PSAxKSB7CisJCXJldCA9IGRtYV9yZXN2X2xvY2tfaW50ZXJydXB0aWJsZShv
YmpzLT5vYmpzWzBdLT5yZXN2LCBOVUxMKTsKKwl9IGVsc2UgeworCQlyZXQgPSBkcm1fZ2VtX2xv
Y2tfcmVzZXJ2YXRpb25zKG9ianMtPm9ianMsIG9ianMtPm5lbnRzLAorCQkJCQkJJm9ianMtPnRp
Y2tldCk7CisJfQorCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgdmlydGlvX2dwdV9hcnJheV91bmxv
Y2tfcmVzdihzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9ianMpCit7CisJaWYgKG9i
anMtPm5lbnRzID09IDEpIHsKKwkJZG1hX3Jlc3ZfdW5sb2NrKG9ianMtPm9ianNbMF0tPnJlc3Yp
OworCX0gZWxzZSB7CisJCWRybV9nZW1fdW5sb2NrX3Jlc2VydmF0aW9ucyhvYmpzLT5vYmpzLCBv
YmpzLT5uZW50cywKKwkJCQkJICAgICZvYmpzLT50aWNrZXQpOworCX0KK30KKwordm9pZCB2aXJ0
aW9fZ3B1X2FycmF5X2FkZF9mZW5jZShzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKm9i
anMsCisJCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJaW50IGk7CisKKwlmb3IgKGkg
PSAwOyBpIDwgb2Jqcy0+bmVudHM7IGkrKykKKwkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2Jq
cy0+b2Jqc1tpXS0+cmVzdiwgZmVuY2UpOworfQorCit2b2lkIHZpcnRpb19ncHVfYXJyYXlfcHV0
X2ZyZWUoc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpzKQoreworCXUzMiBpOwor
CisJZm9yIChpID0gMDsgaSA8IG9ianMtPm5lbnRzOyBpKyspCisJCWRybV9nZW1fb2JqZWN0X3B1
dF91bmxvY2tlZChvYmpzLT5vYmpzW2ldKTsKKwl2aXJ0aW9fZ3B1X2FycmF5X2ZyZWUob2Jqcyk7
Cit9Ci0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbA==
