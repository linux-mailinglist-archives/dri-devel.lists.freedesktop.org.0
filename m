Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 36867B0DC2
	for <lists+dri-devel@lfdr.de>; Thu, 12 Sep 2019 13:28:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C9B896ECCA;
	Thu, 12 Sep 2019 11:28:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 94B9E6ECCA
 for <dri-devel@lists.freedesktop.org>; Thu, 12 Sep 2019 11:28:13 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 4D31F1597;
 Thu, 12 Sep 2019 04:28:13 -0700 (PDT)
Received: from e112269-lin.arm.com (e112269-lin.cambridge.arm.com
 [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 140643F67D;
 Thu, 12 Sep 2019 04:28:11 -0700 (PDT)
From: Steven Price <steven.price@arm.com>
To: Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>,
 Rob Herring <robh@kernel.org>, Tomeu Vizoso <tomeu.vizoso@collabora.com>
Subject: [PATCH 1/2] drm/panfrost: Use generic code for devfreq
Date: Thu, 12 Sep 2019 12:28:03 +0100
Message-Id: <20190912112804.10104-2-steven.price@arm.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190912112804.10104-1-steven.price@arm.com>
References: <20190912112804.10104-1-steven.price@arm.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-kernel@vger.kernel.org, Mark Brown <broonie@kernel.org>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 dri-devel@lists.freedesktop.org, Steven Price <steven.price@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXNlIGRldl9wbV9vcHBfc2V0X3JhdGUoKSBpbnN0ZWFkIG9mIG9wZW4gY29kaW5nIHRoZSBkZXZm
cmVxCmludGVncmF0aW9uLCBzaW1wbGlmeWluZyB0aGUgY29kZS4KClNpZ25lZC1vZmYtYnk6IFN0
ZXZlbiBQcmljZSA8c3RldmVuLnByaWNlQGFybS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3Bh
bmZyb3N0L3BhbmZyb3N0X2RldmZyZXEuYyB8IDYyICsrKystLS0tLS0tLS0tLS0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmljZS5oICB8ICAyIC0KIDIgZmlsZXMg
Y2hhbmdlZCwgMTAgaW5zZXJ0aW9ucygrKSwgNTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmZyZXEuYyBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kZXZmcmVxLmMKaW5kZXggYTFmNWZhNmE3NDJhLi43ZGVk
MjgyYTVjYTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9k
ZXZmcmVxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2RldmZyZXEu
YwpAQCAtMTgsNTcgKzE4LDE0IEBAIHN0YXRpYyB2b2lkIHBhbmZyb3N0X2RldmZyZXFfdXBkYXRl
X3V0aWxpemF0aW9uKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpCiBzdGF0aWMgaW50
IHBhbmZyb3N0X2RldmZyZXFfdGFyZ2V0KHN0cnVjdCBkZXZpY2UgKmRldiwgdW5zaWduZWQgbG9u
ZyAqZnJlcSwKIAkJCQkgICB1MzIgZmxhZ3MpCiB7Ci0Jc3RydWN0IHBhbmZyb3N0X2RldmljZSAq
cGZkZXYgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YSh0b19wbGF0Zm9ybV9kZXZpY2UoZGV2KSk7Ci0J
c3RydWN0IGRldl9wbV9vcHAgKm9wcDsKLQl1bnNpZ25lZCBsb25nIG9sZF9jbGtfcmF0ZSA9IHBm
ZGV2LT5kZXZmcmVxLmN1cl9mcmVxOwotCXVuc2lnbmVkIGxvbmcgdGFyZ2V0X3ZvbHQsIHRhcmdl
dF9yYXRlOworCXN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2ID0gZGV2X2dldF9kcnZkYXRh
KGRldik7CiAJaW50IGVycjsKIAotCW9wcCA9IGRldmZyZXFfcmVjb21tZW5kZWRfb3BwKGRldiwg
ZnJlcSwgZmxhZ3MpOwotCWlmIChJU19FUlIob3BwKSkKLQkJcmV0dXJuIFBUUl9FUlIob3BwKTsK
LQotCXRhcmdldF9yYXRlID0gZGV2X3BtX29wcF9nZXRfZnJlcShvcHApOwotCXRhcmdldF92b2x0
ID0gZGV2X3BtX29wcF9nZXRfdm9sdGFnZShvcHApOwotCWRldl9wbV9vcHBfcHV0KG9wcCk7Ci0K
LQlpZiAob2xkX2Nsa19yYXRlID09IHRhcmdldF9yYXRlKQotCQlyZXR1cm4gMDsKLQotCS8qCi0J
ICogSWYgZnJlcXVlbmN5IHNjYWxpbmcgZnJvbSBsb3cgdG8gaGlnaCwgYWRqdXN0IHZvbHRhZ2Ug
Zmlyc3QuCi0JICogSWYgZnJlcXVlbmN5IHNjYWxpbmcgZnJvbSBoaWdoIHRvIGxvdywgYWRqdXN0
IGZyZXF1ZW5jeSBmaXJzdC4KLQkgKi8KLQlpZiAob2xkX2Nsa19yYXRlIDwgdGFyZ2V0X3JhdGUg
JiYgcGZkZXYtPnJlZ3VsYXRvcikgewotCQllcnIgPSByZWd1bGF0b3Jfc2V0X3ZvbHRhZ2UocGZk
ZXYtPnJlZ3VsYXRvciwgdGFyZ2V0X3ZvbHQsCi0JCQkJCSAgICB0YXJnZXRfdm9sdCk7Ci0JCWlm
IChlcnIpIHsKLQkJCWRldl9lcnIoZGV2LCAiQ2Fubm90IHNldCB2b2x0YWdlICVsdSB1VlxuIiwK
LQkJCQl0YXJnZXRfdm9sdCk7Ci0JCQlyZXR1cm4gZXJyOwotCQl9Ci0JfQotCi0JZXJyID0gY2xr
X3NldF9yYXRlKHBmZGV2LT5jbG9jaywgdGFyZ2V0X3JhdGUpOwotCWlmIChlcnIpIHsKLQkJZGV2
X2VycihkZXYsICJDYW5ub3Qgc2V0IGZyZXF1ZW5jeSAlbHUgKCVkKVxuIiwgdGFyZ2V0X3JhdGUs
Ci0JCQllcnIpOwotCQlpZiAocGZkZXYtPnJlZ3VsYXRvcikKLQkJCXJlZ3VsYXRvcl9zZXRfdm9s
dGFnZShwZmRldi0+cmVndWxhdG9yLAotCQkJCQkgICAgICBwZmRldi0+ZGV2ZnJlcS5jdXJfdm9s
dCwKLQkJCQkJICAgICAgcGZkZXYtPmRldmZyZXEuY3VyX3ZvbHQpOworCWVyciA9IGRldl9wbV9v
cHBfc2V0X3JhdGUoZGV2LCAqZnJlcSk7CisJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKLQl9CiAK
LQlpZiAob2xkX2Nsa19yYXRlID4gdGFyZ2V0X3JhdGUgJiYgcGZkZXYtPnJlZ3VsYXRvcikgewot
CQllcnIgPSByZWd1bGF0b3Jfc2V0X3ZvbHRhZ2UocGZkZXYtPnJlZ3VsYXRvciwgdGFyZ2V0X3Zv
bHQsCi0JCQkJCSAgICB0YXJnZXRfdm9sdCk7Ci0JCWlmIChlcnIpCi0JCQlkZXZfZXJyKGRldiwg
IkNhbm5vdCBzZXQgdm9sdGFnZSAlbHUgdVZcbiIsIHRhcmdldF92b2x0KTsKLQl9Ci0KLQlwZmRl
di0+ZGV2ZnJlcS5jdXJfZnJlcSA9IHRhcmdldF9yYXRlOwotCXBmZGV2LT5kZXZmcmVxLmN1cl92
b2x0ID0gdGFyZ2V0X3ZvbHQ7CisJKmZyZXEgPSBjbGtfZ2V0X3JhdGUocGZkZXYtPmNsb2NrKTsK
IAogCXJldHVybiAwOwogfQpAQCAtODgsNyArNDUsNyBAQCBzdGF0aWMgdm9pZCBwYW5mcm9zdF9k
ZXZmcmVxX3Jlc2V0KHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KQogc3RhdGljIGludCBw
YW5mcm9zdF9kZXZmcmVxX2dldF9kZXZfc3RhdHVzKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJCQkJ
ICAgc3RydWN0IGRldmZyZXFfZGV2X3N0YXR1cyAqc3RhdHVzKQogewotCXN0cnVjdCBwYW5mcm9z
dF9kZXZpY2UgKnBmZGV2ID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEodG9fcGxhdGZvcm1fZGV2aWNl
KGRldikpOworCXN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2ID0gZGV2X2dldF9kcnZkYXRh
KGRldik7CiAJaW50IGk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgTlVNX0pPQl9TTE9UUzsgaSsrKSB7
CkBAIC0xMjEsNyArNzgsNyBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X2RldmZyZXFfZ2V0X2N1cl9m
cmVxKHN0cnVjdCBkZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyAqZnJlcQogewogCXN0cnVjdCBw
YW5mcm9zdF9kZXZpY2UgKnBmZGV2ID0gcGxhdGZvcm1fZ2V0X2RydmRhdGEodG9fcGxhdGZvcm1f
ZGV2aWNlKGRldikpOwogCi0JKmZyZXEgPSBwZmRldi0+ZGV2ZnJlcS5jdXJfZnJlcTsKKwkqZnJl
cSA9IGNsa19nZXRfcmF0ZShwZmRldi0+Y2xvY2spOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0xMzcs
NiArOTQsNyBAQCBpbnQgcGFuZnJvc3RfZGV2ZnJlcV9pbml0KHN0cnVjdCBwYW5mcm9zdF9kZXZp
Y2UgKnBmZGV2KQogewogCWludCByZXQ7CiAJc3RydWN0IGRldl9wbV9vcHAgKm9wcDsKKwl1bnNp
Z25lZCBsb25nIGN1cl9mcmVxOwogCiAJcmV0ID0gZGV2X3BtX29wcF9vZl9hZGRfdGFibGUoJnBm
ZGV2LT5wZGV2LT5kZXYpOwogCWlmIChyZXQgPT0gLUVOT0RFVikgLyogT3B0aW9uYWwsIGNvbnRp
bnVlIHdpdGhvdXQgZGV2ZnJlcSAqLwpAQCAtMTQ2LDEzICsxMDQsMTMgQEAgaW50IHBhbmZyb3N0
X2RldmZyZXFfaW5pdChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldikKIAogCXBhbmZyb3N0
X2RldmZyZXFfcmVzZXQocGZkZXYpOwogCi0JcGZkZXYtPmRldmZyZXEuY3VyX2ZyZXEgPSBjbGtf
Z2V0X3JhdGUocGZkZXYtPmNsb2NrKTsKKwljdXJfZnJlcSA9IGNsa19nZXRfcmF0ZShwZmRldi0+
Y2xvY2spOwogCi0Jb3BwID0gZGV2ZnJlcV9yZWNvbW1lbmRlZF9vcHAoJnBmZGV2LT5wZGV2LT5k
ZXYsICZwZmRldi0+ZGV2ZnJlcS5jdXJfZnJlcSwgMCk7CisJb3BwID0gZGV2ZnJlcV9yZWNvbW1l
bmRlZF9vcHAoJnBmZGV2LT5wZGV2LT5kZXYsICZjdXJfZnJlcSwgMCk7CiAJaWYgKElTX0VSUihv
cHApKQogCQlyZXR1cm4gUFRSX0VSUihvcHApOwogCi0JcGFuZnJvc3RfZGV2ZnJlcV9wcm9maWxl
LmluaXRpYWxfZnJlcSA9IHBmZGV2LT5kZXZmcmVxLmN1cl9mcmVxOworCXBhbmZyb3N0X2RldmZy
ZXFfcHJvZmlsZS5pbml0aWFsX2ZyZXEgPSBjdXJfZnJlcTsKIAlkZXZfcG1fb3BwX3B1dChvcHAp
OwogCiAJcGZkZXYtPmRldmZyZXEuZGV2ZnJlcSA9IGRldm1fZGV2ZnJlcV9hZGRfZGV2aWNlKCZw
ZmRldi0+cGRldi0+ZGV2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3Bh
bmZyb3N0X2RldmljZS5oIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rldmlj
ZS5oCmluZGV4IGY1MDNjNTY2ZTk5Zi4uNGMyYjNjODRiYWFjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZGV2aWNlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3BhbmZyb3N0L3BhbmZyb3N0X2RldmljZS5oCkBAIC05NSw4ICs5NSw2IEBAIHN0cnVjdCBwYW5m
cm9zdF9kZXZpY2UgewogCXN0cnVjdCB7CiAJCXN0cnVjdCBkZXZmcmVxICpkZXZmcmVxOwogCQlz
dHJ1Y3QgdGhlcm1hbF9jb29saW5nX2RldmljZSAqY29vbGluZzsKLQkJdW5zaWduZWQgbG9uZyBj
dXJfZnJlcTsKLQkJdW5zaWduZWQgbG9uZyBjdXJfdm9sdDsKIAkJc3RydWN0IHBhbmZyb3N0X2Rl
dmZyZXFfc2xvdCBzbG90W05VTV9KT0JfU0xPVFNdOwogCX0gZGV2ZnJlcTsKIH07Ci0tIAoyLjIw
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
