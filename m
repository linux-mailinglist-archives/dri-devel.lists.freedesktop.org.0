Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 685681079CC
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 22:09:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0B3216F57D;
	Fri, 22 Nov 2019 21:09:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D0DC76F577;
 Fri, 22 Nov 2019 21:09:01 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Nov 2019 13:09:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,231,1571727600"; d="scan'208";a="205575860"
Received: from nvishwa1-desk.sc.intel.com ([10.3.160.185])
 by fmsmga007.fm.intel.com with ESMTP; 22 Nov 2019 13:09:00 -0800
From: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [RFC 07/13] drm/i915/svm: Device memory support
Date: Fri, 22 Nov 2019 12:57:28 -0800
Message-Id: <20191122205734.15925-8-niranjana.vishwanathapura@intel.com>
X-Mailer: git-send-email 2.21.0.rc0.32.g243a4c7e27
In-Reply-To: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
References: <20191122205734.15925-1-niranjana.vishwanathapura@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sanjay.k.kumar@intel.com, sudeep.dutt@intel.com,
 dri-devel@lists.freedesktop.org, dave.hansen@intel.com, jglisse@redhat.com,
 jon.bloomfield@intel.com, daniel.vetter@intel.com, dan.j.williams@intel.com,
 ira.weiny@intel.com, jgg@mellanox.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UGx1Z2luIGRldmljZSBtZW1vcnkgdGhyb3VnaCBITU0gYXMgREVWSUNFX1BSSVZBVEUuCkFkZCBz
dXBwb3J0IGZ1bmN0aW9ucyB0byBhbGxvY2F0ZSBwYWdlcyBhbmQgZnJlZSBwYWdlcyBmcm9tIGRl
dmljZSBtZW1vcnkuCkltcGxlbWVudCBpb2N0bCB0byBtaWdyYXRlIHBhZ2VzIGZyb20gaG9zdCB0
byBkZXZpY2UgbWVtb3J5LgpGb3Igbm93LCBvbmx5IHN1cHBvcnQgbWlncmF0aW5nIHBhZ2VzIGZy
b20gaG9zdCBtZW1vcnkgdG8gZGV2aWNlIG1lbW9yeS4KCkNjOiBKb29uYXMgTGFodGluZW4gPGpv
b25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBKb24gQmxvb21maWVsZCA8am9uLmJs
b29tZmllbGRAaW50ZWwuY29tPgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRl
bC5jb20+CkNjOiBTdWRlZXAgRHV0dCA8c3VkZWVwLmR1dHRAaW50ZWwuY29tPgpTaWduZWQtb2Zm
LWJ5OiBOaXJhbmphbmEgVmlzaHdhbmF0aGFwdXJhIDxuaXJhbmphbmEudmlzaHdhbmF0aGFwdXJh
QGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnICAgICAgICAgICAg
ICAgfCAgIDkgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgIHwg
ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgfCAgMTMg
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRkeS5oICAgICAgICAgIHwgIDEyICsKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3N2bS5jICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9zdm0uaCAgICAgICAgICAgIHwgIDE1ICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3ZtX2Rldm1lbS5jICAgICB8IDM5MSArKysrKysrKysrKysrKysrKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uaCB8ICAxNCArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5jICAgfCAgMTAgKwogMTAgZmlsZXMgY2hh
bmdlZCwgNDU2IGluc2VydGlvbnMoKyksIDE0IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtX2Rldm1lbS5jCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25m
aWcKaW5kZXggNjg5ZTU3ZmUzOTczLi42NjMzN2YyY2EyYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L0tjb25maWcKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvS2NvbmZpZwpA
QCAtMTQxLDkgKzE0MSwxOCBAQCBjb25maWcgRFJNX0k5MTVfU1ZNCiAJYm9vbCAiRW5hYmxlIFNo
YXJlZCBWaXJ0dWFsIE1lbW9yeSBzdXBwb3J0IGluIGk5MTUiCiAJZGVwZW5kcyBvbiBTVEFHSU5H
CiAJZGVwZW5kcyBvbiBEUk1fSTkxNQorCWRlcGVuZHMgb24gQVJDSF9FTkFCTEVfTUVNT1JZX0hP
VFBMVUcKKwlkZXBlbmRzIG9uIEFSQ0hfRU5BQkxFX01FTU9SWV9IT1RSRU1PVkUKKwlkZXBlbmRz
IG9uIE1FTU9SWV9IT1RQTFVHCisJZGVwZW5kcyBvbiBNRU1PUllfSE9UUkVNT1ZFCisJZGVwZW5k
cyBvbiBBUkNIX0hBU19QVEVfREVWTUFQCisJZGVwZW5kcyBvbiBTUEFSU0VNRU1fVk1FTU1BUAor
CWRlcGVuZHMgb24gWk9ORV9ERVZJQ0UKKwlkZXBlbmRzIG9uIERFVklDRV9QUklWQVRFCiAJZGVw
ZW5kcyBvbiBNTVUKIAlzZWxlY3QgSE1NX01JUlJPUgogCXNlbGVjdCBNTVVfTk9USUZJRVIKKwlz
ZWxlY3QgTUlHUkFURV9WTUFfSEVMUEVSCiAJZGVmYXVsdCBuCiAJaGVscAogCSAgQ2hvb3NlIHRo
aXMgb3B0aW9uIGlmIHlvdSB3YW50IFNoYXJlZCBWaXJ0dWFsIE1lbW9yeSAoU1ZNKQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZQppbmRleCA3ZDRjZDllZWZkMTIuLmI1NzRlYzMxZWEyZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
TWFrZWZpbGUKQEAgLTE1NSw3ICsxNTUsOCBAQCBpOTE1LXkgKz0gXAogCiAjIFNWTSBjb2RlCiBp
OTE1LSQoQ09ORklHX0RSTV9JOTE1X1NWTSkgKz0gZ2VtL2k5MTVfZ2VtX3N2bS5vIFwKLQkJCSAg
ICAgICBpOTE1X3N2bS5vCisJCQkgICAgICAgaTkxNV9zdm0ubyBcCisJCQkgICAgICAgaTkxNV9z
dm1fZGV2bWVtLm8KIAogIyBnZW5lcmFsLXB1cnBvc2UgbWljcm9jb250cm9sbGVyIChHdUMpIHN1
cHBvcnQKIG9iai15ICs9IGd0L3VjLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5jCmluZGV4IGE3ZGVlMWI3NDljYi4uZGQ4OGZhODdiN2ZlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC00ODAsMTkgKzQ4MCw2IEBAIGlu
dCBfX2luaXQgaTkxNV9nbG9iYWxfb2JqZWN0c19pbml0KHZvaWQpCiAJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBlbnVtIGludGVsX3JlZ2lvbl9pZAotX19yZWdpb25faWQodTMyIHJlZ2lvbikKLXsK
LQllbnVtIGludGVsX3JlZ2lvbl9pZCBpZDsKLQotCWZvciAoaWQgPSAwOyBpZCA8IElOVEVMX1JF
R0lPTl9VTktOT1dOOyArK2lkKSB7Ci0JCWlmIChpbnRlbF9yZWdpb25fbWFwW2lkXSA9PSByZWdp
b24pCi0JCQlyZXR1cm4gaWQ7Ci0JfQotCi0JcmV0dXJuIElOVEVMX1JFR0lPTl9VTktOT1dOOwot
fQotCiBib29sCiBpOTE1X2dlbV9vYmplY3Rfc3ZtX21hcHBlZChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9i
dWRkeS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRkeS5oCmluZGV4IGVkNDFmMzUw
N2NkYy4uYWZjNDkzZTZjMTMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2J1ZGR5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRkeS5oCkBAIC05LDYg
KzksOSBAQAogI2luY2x1ZGUgPGxpbnV4L2JpdG9wcy5oPgogI2luY2x1ZGUgPGxpbnV4L2xpc3Qu
aD4KIAorLyogNTEyIGJpdHMgKG9uZSBwZXIgcGFnZXMpIHN1cHBvcnRzIDJNQiBibG9ja3MgKi8K
KyNkZWZpbmUgSTkxNV9CVUREWV9NQVhfUEFHRVMgICA1MTIKKwogc3RydWN0IGk5MTVfYnVkZHlf
YmxvY2sgewogI2RlZmluZSBJOTE1X0JVRERZX0hFQURFUl9PRkZTRVQgR0VOTUFTS19VTEwoNjMs
IDEyKQogI2RlZmluZSBJOTE1X0JVRERZX0hFQURFUl9TVEFURSAgR0VOTUFTS19VTEwoMTEsIDEw
KQpAQCAtMzIsNiArMzUsMTUgQEAgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgewogCSAqLwogCXN0
cnVjdCBsaXN0X2hlYWQgbGluazsKIAlzdHJ1Y3QgbGlzdF9oZWFkIHRtcF9saW5rOworCisJdW5z
aWduZWQgbG9uZyBwZm5fZmlyc3Q7CisJLyoKKwkgKiBGSVhNRTogVGhlcmUgYXJlIG90aGVyIGFs
dGVybmF0aXZlcyB0byBiaXRtYXAuIExpa2Ugc3BsaXR0aW5nIHRoZQorCSAqIGJsb2NrIGludG8g
Y29udGlndW91cyA0SyBzaXplZCBibG9ja3MuIEJ1dCBpdCBpcyBwYXJ0IG9mIGJpZ2dlcgorCSAq
IGlzc3VlcyBpbnZvbHZpbmcgcGFydGlhbGx5IGludmFsaWRhdGluZyBsYXJnZSBtYXBwaW5nLCBm
cmVlaW5nIHRoZQorCSAqIGJsb2NrcyBldGMuLCByZXZpc2l0LgorCSAqLworCXVuc2lnbmVkIGxv
bmcgYml0bWFwW0JJVFNfVE9fTE9OR1MoSTkxNV9CVUREWV9NQVhfUEFHRVMpXTsKIH07CiAKICNk
ZWZpbmUgSTkxNV9CVUREWV9NQVhfT1JERVIgIEk5MTVfQlVERFlfSEVBREVSX09SREVSCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuYwppbmRleCBjMTkwZGY2MTRjNDguLjc0MGI0YjlkMzlhOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0yNzcxLDYgKzI3NzEsNyBAQCBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRybV9pb2N0bF9kZXNjIGk5MTVfaW9jdGxzW10gPSB7CiAJRFJNX0lPQ1RMX0RFRl9EUlYo
STkxNV9HRU1fVk1fQ1JFQVRFLCBpOTE1X2dlbV92bV9jcmVhdGVfaW9jdGwsIERSTV9SRU5ERVJf
QUxMT1cpLAogCURSTV9JT0NUTF9ERUZfRFJWKEk5MTVfR0VNX1ZNX0RFU1RST1ksIGk5MTVfZ2Vt
X3ZtX2Rlc3Ryb3lfaW9jdGwsIERSTV9SRU5ERVJfQUxMT1cpLAogCURSTV9JT0NUTF9ERUZfRFJW
KEk5MTVfQklORCwgaTkxNV9iaW5kX2lvY3RsLCBEUk1fUkVOREVSX0FMTE9XKSwKKwlEUk1fSU9D
VExfREVGX0RSVihJOTE1X1NWTV9NSUdSQVRFLCBpOTE1X3N2bV9taWdyYXRlX2lvY3RsLCBEUk1f
UkVOREVSX0FMTE9XKQogfTsKIAogc3RhdGljIHN0cnVjdCBkcm1fZHJpdmVyIGRyaXZlciA9IHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3N2bS5jCmluZGV4IDRlNDE0ZjI1NzEyMS4uZmU3ZDUzNjM0NjA2IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N2bS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfc3ZtLmMKQEAgLTIwNiw2ICsyMDYsOCBAQCBpbnQgaTkxNV9zdm1f
YmluZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgc3RydWN0IGRybV9pOTE1X2JpbmQg
KmFyZ3MpCiAJaWYgKHVubGlrZWx5KHJldCkpCiAJCWdvdG8gdm1hX2RvbmU7CiAKKwkvKiBYWFg6
IEFzc3VtaW5nIHRoZSByYW5nZSBpcyBleGNsdXNpdmVseSBMTUVNIG9yIFNNRU0sIGZpeCBpdCAq
LworCWk5MTVfZG1lbV9jb252ZXJ0X3Bmbih2bS0+aTkxNSwgJnJhbmdlKTsKIAlzZ19wYWdlX3Np
emVzID0gaTkxNV9zdm1fYnVpbGRfc2codm0sICZyYW5nZSwgJnN0KTsKIAogCW11dGV4X2xvY2so
JnN2bS0+bXV0ZXgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdm0u
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtLmgKaW5kZXggZjE3NmYxZGM0OTNmLi5h
MWI2Mjk5N2U5MjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3ZtLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdm0uaApAQCAtMzMsNiArMzMsMTQgQEAg
c3RhdGljIGlubGluZSBib29sIGk5MTVfdm1faXNfc3ZtX2VuYWJsZWQoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0pCiAJcmV0dXJuIHZtLT5zdm07CiB9CiAKK3ZvaWQgaTkxNV9kbWVtX2Nv
bnZlcnRfcGZuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgIHN0cnVj
dCBobW1fcmFuZ2UgKnJhbmdlKTsKK2ludCBpOTE1X3N2bV9taWdyYXRlX2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCisJCQkgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVf
cHJpdik7CitzdHJ1Y3QgaTkxNV9kZXZtZW0gKmk5MTVfc3ZtX2Rldm1lbV9hZGQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJCXU2NCBzaXplKTsKK3ZvaWQgaTkxNV9zdm1fZGV2
bWVtX3JlbW92ZShzdHJ1Y3QgaTkxNV9kZXZtZW0gKmRldm1lbSk7CisKICNlbHNlCiAKIHN0cnVj
dCBpOTE1X3N2bSB7IH07CkBAIC00NSw2ICs1MywxMyBAQCBzdGF0aWMgaW5saW5lIGludCBpOTE1
X3N2bV9iaW5kX21tKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogc3RhdGljIGlubGlu
ZSBib29sIGk5MTVfdm1faXNfc3ZtX2VuYWJsZWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCiB7IHJldHVybiBmYWxzZTsgfQogCitzdGF0aWMgaW5saW5lIGludCBpOTE1X3N2bV9taWdy
YXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCisJCQkJCSBzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sgcmV0dXJuIC1FTk9UU1VQUDsgfQorc3RhdGljIGlu
bGluZQorc3RydWN0IGk5MTVfZGV2bWVtICppOTE1X3N2bV9kZXZtZW1fYWRkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LCB1NjQgc2l6ZSkKK3sgcmV0dXJuIE5VTEw7IH0KK3N0YXRpYyBp
bmxpbmUgdm9pZCBpOTE1X3N2bV9kZXZtZW1fcmVtb3ZlKHN0cnVjdCBpOTE1X2Rldm1lbSAqZGV2
bWVtKSB7IH0KICNlbmRpZgogCiAjZW5kaWYgLyogX19JOTE1X1NWTV9IICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N2bV9kZXZtZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfc3ZtX2Rldm1lbS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uNDBjMmY3OWZmNjE0Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zdm1fZGV2bWVtLmMKQEAgLTAsMCArMSwzOTEgQEAKKy8vIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9tbV90eXBlcy5oPgorI2luY2x1ZGUgPGxpbnV4
L3NjaGVkL21tLmg+CisKKyNpbmNsdWRlICJpOTE1X3N2bS5oIgorI2luY2x1ZGUgImludGVsX21l
bW9yeV9yZWdpb24uaCIKKworc3RydWN0IGk5MTVfZGV2bWVtX21pZ3JhdGUgeworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1OworCXN0cnVjdCBtaWdyYXRlX3ZtYSAqYXJnczsKKworCWVu
dW0gaW50ZWxfcmVnaW9uX2lkIHNyY19pZDsKKwllbnVtIGludGVsX3JlZ2lvbl9pZCBkc3RfaWQ7
CisJdTY0IG5wYWdlczsKK307CisKK3N0cnVjdCBpOTE1X2Rldm1lbSB7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTU7CisJc3RydWN0IGRldl9wYWdlbWFwIHBhZ2VtYXA7CisJdW5zaWdu
ZWQgbG9uZyBwZm5fZmlyc3Q7CisJdW5zaWduZWQgbG9uZyBwZm5fbGFzdDsKK307CisKK3N0YXRp
YyBpbmxpbmUgYm9vbAoraTkxNV9kbWVtX3BhZ2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBzdHJ1Y3QgcGFnZSAqcGFnZSkKK3sKKwlpZiAoIWlzX2RldmljZV9wcml2YXRlX3Bh
Z2UocGFnZSkpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiB0cnVlOworfQorCit2b2lkIGk5
MTVfZG1lbV9jb252ZXJ0X3BmbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkgICBzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkKK3sKKwl1bnNpZ25lZCBsb25nIGksIG5wYWdl
czsKKworCW5wYWdlcyA9IChyYW5nZS0+ZW5kIC0gcmFuZ2UtPnN0YXJ0KSA+PiBQQUdFX1NISUZU
OworCWZvciAoaSA9IDA7IGkgPCBucGFnZXM7ICsraSkgeworCQlzdHJ1Y3QgaTkxNV9idWRkeV9i
bG9jayAqYmxvY2s7CisJCXN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptZW07CisJCXN0cnVj
dCBwYWdlICpwYWdlOworCQl1NjQgYWRkcjsKKworCQlwYWdlID0gaG1tX2RldmljZV9lbnRyeV90
b19wYWdlKHJhbmdlLCByYW5nZS0+cGZuc1tpXSk7CisJCWlmICghcGFnZSkKKwkJCWNvbnRpbnVl
OworCisJCWlmICghKHJhbmdlLT5wZm5zW2ldICYgcmFuZ2UtPmZsYWdzW0hNTV9QRk5fREVWSUNF
X1BSSVZBVEVdKSkKKwkJCWNvbnRpbnVlOworCisJCWlmICghaTkxNV9kbWVtX3BhZ2UoZGV2X3By
aXYsIHBhZ2UpKSB7CisJCQlXQVJOKDEsICJTb21lIHVua25vd24gZGV2aWNlIG1lbW9yeSAhXG4i
KTsKKwkJCXJhbmdlLT5wZm5zW2ldID0gMDsKKwkJCWNvbnRpbnVlOworCQl9CisKKwkJYmxvY2sg
PSBwYWdlLT56b25lX2RldmljZV9kYXRhOworCQltZW0gPSBibG9jay0+cHJpdmF0ZTsKKwkJYWRk
ciA9IG1lbS0+cmVnaW9uLnN0YXJ0ICsKKwkJICAgICAgIGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0
KGJsb2NrKTsKKwkJYWRkciArPSAocGFnZV90b19wZm4ocGFnZSkgLSBibG9jay0+cGZuX2ZpcnN0
KSA8PCBQQUdFX1NISUZUOworCisJCXJhbmdlLT5wZm5zW2ldICY9IH5yYW5nZS0+ZmxhZ3NbSE1N
X1BGTl9ERVZJQ0VfUFJJVkFURV07CisJCXJhbmdlLT5wZm5zW2ldICY9ICgoMVVMIDw8IHJhbmdl
LT5wZm5fc2hpZnQpIC0gMSk7CisJCXJhbmdlLT5wZm5zW2ldIHw9IChhZGRyID4+IFBBR0VfU0hJ
RlQpIDw8IHJhbmdlLT5wZm5fc2hpZnQ7CisJfQorfQorCitzdGF0aWMgaW50CitpOTE1X2Rldm1l
bV9wYWdlX2FsbG9jX2xvY2tlZChzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAorCQkJ
ICAgICAgdW5zaWduZWQgbG9uZyBucGFnZXMsCisJCQkgICAgICBzdHJ1Y3QgbGlzdF9oZWFkICpi
bG9ja3MpCit7CisJdW5zaWduZWQgbG9uZyBzaXplID0gQUxJR04oKG5wYWdlcyAqIFBBR0VfU0la
RSksIG1lbS0+bW0uY2h1bmtfc2l6ZSk7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2Nr
OworCWludCByZXQ7CisKKwlJTklUX0xJU1RfSEVBRChibG9ja3MpOworCXJldCA9IF9faW50ZWxf
bWVtb3J5X3JlZ2lvbl9nZXRfcGFnZXNfYnVkZHkobWVtLCBzaXplLCAwLCBibG9ja3MpOworCWlm
ICh1bmxpa2VseShyZXQpKQorCQlnb3RvIGFsbG9jX2ZhaWxlZDsKKworCWxpc3RfZm9yX2VhY2hf
ZW50cnkoYmxvY2ssIGJsb2NrcywgbGluaykgeworCQlibG9jay0+cGZuX2ZpcnN0ID0gbWVtLT5k
ZXZtZW0tPnBmbl9maXJzdDsKKwkJYmxvY2stPnBmbl9maXJzdCArPSBpOTE1X2J1ZGR5X2Jsb2Nr
X29mZnNldChibG9jaykgLworCQkJCSAgICBQQUdFX1NJWkU7CisJCWJpdG1hcF96ZXJvKGJsb2Nr
LT5iaXRtYXAsIEk5MTVfQlVERFlfTUFYX1BBR0VTKTsKKwkJRFJNX0RFQlVHX0RSSVZFUigiJXMg
cGZuX2ZpcnN0IDB4JWx4IG9mZiAweCVsbHggc2l6ZSAweCVsbHhcbiIsCisJCQkJICJBbGxvY2F0
ZWQgYmxvY2siLCBibG9jay0+cGZuX2ZpcnN0LAorCQkJCSBpOTE1X2J1ZGR5X2Jsb2NrX29mZnNl
dChibG9jayksCisJCQkJIGk5MTVfYnVkZHlfYmxvY2tfc2l6ZSgmbWVtLT5tbSwgYmxvY2spKTsK
Kwl9CisKK2FsbG9jX2ZhaWxlZDoKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgc3RydWN0IHBh
Z2UgKgoraTkxNV9kZXZtZW1fcGFnZV9nZXRfbG9ja2VkKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVn
aW9uICptZW0sCisJCQkgICAgc3RydWN0IGxpc3RfaGVhZCAqYmxvY2tzKQoreworCXN0cnVjdCBp
OTE1X2J1ZGR5X2Jsb2NrICpibG9jaywgKm9uOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KGJsb2NrLCBvbiwgYmxvY2tzLCBsaW5rKSB7CisJCXVuc2lnbmVkIGxvbmcgd2VpZ2h0LCBtYXg7
CisJCXVuc2lnbmVkIGxvbmcgaSwgcGZuOworCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKworCQltYXgg
PSBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUoJm1lbS0+bW0sIGJsb2NrKSAvIFBBR0VfU0laRTsKKwkJ
aSA9IGZpbmRfZmlyc3RfemVyb19iaXQoYmxvY2stPmJpdG1hcCwgbWF4KTsKKwkJaWYgKHVubGlr
ZWx5KGkgPT0gbWF4KSkgeworCQkJV0FSTigxLCAiR2V0dGluZyBhIHBhZ2Ugc2hvdWxkIGhhdmUg
bmV2ZXIgZmFpbGVkXG4iKTsKKwkJCWJyZWFrOworCQl9CisKKwkJc2V0X2JpdChpLCBibG9jay0+
Yml0bWFwKTsKKwkJcGZuID0gYmxvY2stPnBmbl9maXJzdCArIGk7CisJCXBhZ2UgPSBwZm5fdG9f
cGFnZShwZm4pOworCQlnZXRfcGFnZShwYWdlKTsKKwkJbG9ja19wYWdlKHBhZ2UpOworCQlwYWdl
LT56b25lX2RldmljZV9kYXRhID0gYmxvY2s7CisJCXdlaWdodCA9IGJpdG1hcF93ZWlnaHQoYmxv
Y2stPmJpdG1hcCwgbWF4KTsKKwkJaWYgKHdlaWdodCA9PSBtYXgpCisJCQlsaXN0X2RlbF9pbml0
KCZibG9jay0+bGluayk7CisJCURSTV9ERUJVR19EUklWRVIoIiVzIHBmbiAweCVseCBibG9jayB3
ZWlnaHQgMHglbHhcbiIsCisJCQkJICJBbGxvY2F0ZWQgcGFnZSIsIHBmbiwgd2VpZ2h0KTsKKwkJ
cmV0dXJuIHBhZ2U7CisJfQorCXJldHVybiBOVUxMOworfQorCitzdGF0aWMgdm9pZAoraTkxNV9k
ZXZtZW1fcGFnZV9mcmVlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CisJCQkgICAgIHN0cnVjdCBwYWdlICpwYWdlKQoreworCXVubG9ja19wYWdlKHBhZ2UpOworCXB1
dF9wYWdlKHBhZ2UpOworfQorCitzdGF0aWMgaW50CitpOTE1X2Rldm1lbV9taWdyYXRlX2FsbG9j
X2FuZF9jb3B5KHN0cnVjdCBpOTE1X2Rldm1lbV9taWdyYXRlICptaWdyYXRlKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbWlncmF0ZS0+aTkxNTsKKwlzdHJ1Y3QgbWlncmF0
ZV92bWEgKmFyZ3MgPSBtaWdyYXRlLT5hcmdzOworCXN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9u
ICptZW07CisJc3RydWN0IGxpc3RfaGVhZCBibG9ja3MgPSB7MH07CisJdW5zaWduZWQgbG9uZyBp
LCBucGFnZXMsIGNudDsKKwlzdHJ1Y3QgcGFnZSAqcGFnZTsKKwlpbnQgcmV0OworCisJbnBhZ2Vz
ID0gKGFyZ3MtPmVuZCAtIGFyZ3MtPnN0YXJ0KSA+PiBQQUdFX1NISUZUOworCURSTV9ERUJVR19E
UklWRVIoInN0YXJ0IDB4JWx4IG5wYWdlcyAlbGRcbiIsIGFyZ3MtPnN0YXJ0LCBucGFnZXMpOwor
CisJLyogQ2hlY2sgc291cmNlIHBhZ2VzICovCisJZm9yIChpID0gMCwgY250ID0gMDsgaSA8IG5w
YWdlczsgaSsrKSB7CisJCWFyZ3MtPmRzdFtpXSA9IDA7CisJCXBhZ2UgPSBtaWdyYXRlX3Bmbl90
b19wYWdlKGFyZ3MtPnNyY1tpXSk7CisJCWlmICh1bmxpa2VseSghcGFnZSB8fCAhKGFyZ3MtPnNy
Y1tpXSAmIE1JR1JBVEVfUEZOX01JR1JBVEUpKSkKKwkJCWNvbnRpbnVlOworCisJCWFyZ3MtPmRz
dFtpXSA9IE1JR1JBVEVfUEZOX1ZBTElEOworCQljbnQrKzsKKwl9CisKKwlpZiAoIWNudCkgewor
CQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIG1pZ3JhdGVfb3V0OworCX0KKworCW1lbSA9IGk5MTUt
Pm1tLnJlZ2lvbnNbbWlncmF0ZS0+ZHN0X2lkXTsKKwlyZXQgPSBpOTE1X2Rldm1lbV9wYWdlX2Fs
bG9jX2xvY2tlZChtZW0sIGNudCwgJmJsb2Nrcyk7CisJaWYgKHVubGlrZWx5KHJldCkpCisJCWdv
dG8gbWlncmF0ZV9vdXQ7CisKKwkvKiBBbGxvY2F0ZSBkZXZpY2UgbWVtb3J5ICovCisJZm9yIChp
ID0gMCwgY250ID0gMDsgaSA8IG5wYWdlczsgaSsrKSB7CisJCWlmICghYXJncy0+ZHN0W2ldKQor
CQkJY29udGludWU7CisKKwkJcGFnZSA9IGk5MTVfZGV2bWVtX3BhZ2VfZ2V0X2xvY2tlZChtZW0s
ICZibG9ja3MpOworCQlpZiAodW5saWtlbHkoIXBhZ2UpKSB7CisJCQlXQVJOKDEsICJGYWlsZWQg
dG8gZ2V0IGRzdCBwYWdlXG4iKTsKKwkJCWFyZ3MtPmRzdFtpXSA9IDA7CisJCQljb250aW51ZTsK
KwkJfQorCisJCWNudCsrOworCQlhcmdzLT5kc3RbaV0gPSBtaWdyYXRlX3BmbihwYWdlX3RvX3Bm
bihwYWdlKSkgfAorCQkJICAgICAgIE1JR1JBVEVfUEZOX0xPQ0tFRDsKKwl9CisKKwlpZiAoIWNu
dCkgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIG1pZ3JhdGVfb3V0OworCX0KKworCS8qIENv
cHkgdGhlIHBhZ2VzICovCisJbWlncmF0ZS0+bnBhZ2VzID0gbnBhZ2VzOworbWlncmF0ZV9vdXQ6
CisJaWYgKHVubGlrZWx5KHJldCkpIHsKKwkJZm9yIChpID0gMDsgaSA8IG5wYWdlczsgaSsrKSB7
CisJCQlpZiAoYXJncy0+ZHN0W2ldICYgTUlHUkFURV9QRk5fTE9DS0VEKSB7CisJCQkJcGFnZSA9
IG1pZ3JhdGVfcGZuX3RvX3BhZ2UoYXJncy0+ZHN0W2ldKTsKKwkJCQlpOTE1X2Rldm1lbV9wYWdl
X2ZyZWVfbG9ja2VkKGk5MTUsIHBhZ2UpOworCQkJfQorCQkJYXJncy0+ZHN0W2ldID0gMDsKKwkJ
fQorCX0KKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgaTkxNV9kZXZtZW1fbWlncmF0ZV9maW5h
bGl6ZV9hbmRfbWFwKHN0cnVjdCBpOTE1X2Rldm1lbV9taWdyYXRlICptaWdyYXRlKQoreworCURS
TV9ERUJVR19EUklWRVIoIm5wYWdlcyAlbGxkXG4iLCBtaWdyYXRlLT5ucGFnZXMpOworfQorCitz
dGF0aWMgdm9pZCBpOTE1X2Rldm1lbV9taWdyYXRlX2NodW5rKHN0cnVjdCBpOTE1X2Rldm1lbV9t
aWdyYXRlICptaWdyYXRlKQoreworCWludCByZXQ7CisKKwlyZXQgPSBpOTE1X2Rldm1lbV9taWdy
YXRlX2FsbG9jX2FuZF9jb3B5KG1pZ3JhdGUpOworCWlmICghcmV0KSB7CisJCW1pZ3JhdGVfdm1h
X3BhZ2VzKG1pZ3JhdGUtPmFyZ3MpOworCQlpOTE1X2Rldm1lbV9taWdyYXRlX2ZpbmFsaXplX2Fu
ZF9tYXAobWlncmF0ZSk7CisJfQorCW1pZ3JhdGVfdm1hX2ZpbmFsaXplKG1pZ3JhdGUtPmFyZ3Mp
OworfQorCitpbnQgaTkxNV9kZXZtZW1fbWlncmF0ZV92bWEoc3RydWN0IGludGVsX21lbW9yeV9y
ZWdpb24gKm1lbSwKKwkJCSAgICBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwKKwkJCSAgICB1
bnNpZ25lZCBsb25nIHN0YXJ0LAorCQkJICAgIHVuc2lnbmVkIGxvbmcgZW5kKQoreworCXVuc2ln
bmVkIGxvbmcgbnBhZ2VzID0gKGVuZCAtIHN0YXJ0KSA+PiBQQUdFX1NISUZUOworCXVuc2lnbmVk
IGxvbmcgbWF4ID0gbWluX3QodW5zaWduZWQgbG9uZywgSTkxNV9CVUREWV9NQVhfUEFHRVMsIG5w
YWdlcyk7CisJc3RydWN0IGk5MTVfZGV2bWVtX21pZ3JhdGUgbWlncmF0ZSA9IHswfTsKKwlzdHJ1
Y3QgbWlncmF0ZV92bWEgYXJncyA9IHsKKwkJLnZtYQkJPSB2bWEsCisJCS5zdGFydAkJPSBzdGFy
dCwKKwl9OworCXVuc2lnbmVkIGxvbmcgYywgaTsKKwlpbnQgcmV0ID0gMDsKKworCS8qIFhYWDog
T3Bwb3J0dW5pc3RpY2FsbHkgbWlncmF0ZSBhZGRpdGlvbmFsIHBhZ2VzPyAqLworCURSTV9ERUJV
R19EUklWRVIoInN0YXJ0IDB4JWx4IGVuZCAweCVseFxuIiwgc3RhcnQsIGVuZCk7CisJYXJncy5z
cmMgPSBrY2FsbG9jKG1heCwgc2l6ZW9mKGFyZ3Muc3JjKSwgR0ZQX0tFUk5FTCk7CisJaWYgKHVu
bGlrZWx5KCFhcmdzLnNyYykpCisJCXJldHVybiAtRU5PTUVNOworCisJYXJncy5kc3QgPSBrY2Fs
bG9jKG1heCwgc2l6ZW9mKGFyZ3MuZHN0KSwgR0ZQX0tFUk5FTCk7CisJaWYgKHVubGlrZWx5KCFh
cmdzLmRzdCkpIHsKKwkJa2ZyZWUoYXJncy5zcmMpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisK
KwkvKiBYWFg6IFN1cHBvcnQgbWlncmF0aW5nIGZyb20gTE1FTSB0byBTTUVNICovCisJbWlncmF0
ZS5hcmdzID0gJmFyZ3M7CisJbWlncmF0ZS5pOTE1ID0gbWVtLT5pOTE1OworCW1pZ3JhdGUuc3Jj
X2lkID0gSU5URUxfUkVHSU9OX1NNRU07CisJbWlncmF0ZS5kc3RfaWQgPSBNRU1PUllfVFlQRV9G
Uk9NX1JFR0lPTihtZW0tPmlkKTsKKwlmb3IgKGkgPSAwOyBpIDwgbnBhZ2VzOyBpICs9IGMpIHsK
KwkJYyA9IG1pbl90KHVuc2lnbmVkIGxvbmcsIEk5MTVfQlVERFlfTUFYX1BBR0VTLCBucGFnZXMp
OworCQlhcmdzLmVuZCA9IHN0YXJ0ICsgKGMgPDwgUEFHRV9TSElGVCk7CisJCXJldCA9IG1pZ3Jh
dGVfdm1hX3NldHVwKCZhcmdzKTsKKwkJaWYgKHVubGlrZWx5KHJldCkpCisJCQlnb3RvIG1pZ3Jh
dGVfZG9uZTsKKwkJaWYgKGFyZ3MuY3BhZ2VzKQorCQkJaTkxNV9kZXZtZW1fbWlncmF0ZV9jaHVu
aygmbWlncmF0ZSk7CisJCWFyZ3Muc3RhcnQgPSBhcmdzLmVuZDsKKwl9CittaWdyYXRlX2RvbmU6
CisJa2ZyZWUoYXJncy5kc3QpOworCWtmcmVlKGFyZ3Muc3JjKTsKKwlyZXR1cm4gcmV0OworfQor
CitzdGF0aWMgdm1fZmF1bHRfdCBpOTE1X2Rldm1lbV9taWdyYXRlX3RvX3JhbShzdHJ1Y3Qgdm1f
ZmF1bHQgKnZtZikKK3sKKwlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOworfQorCitzdGF0aWMgdm9p
ZCBpOTE1X2Rldm1lbV9wYWdlX2ZyZWUoc3RydWN0IHBhZ2UgKnBhZ2UpCit7CisJc3RydWN0IGk5
MTVfYnVkZHlfYmxvY2sgKmJsb2NrID0gcGFnZS0+em9uZV9kZXZpY2VfZGF0YTsKKwlzdHJ1Y3Qg
aW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtID0gYmxvY2stPnByaXZhdGU7CisJdW5zaWduZWQgbG9u
ZyBpLCBtYXgsIHdlaWdodDsKKworCW1heCA9IGk5MTVfYnVkZHlfYmxvY2tfc2l6ZSgmbWVtLT5t
bSwgYmxvY2spIC8gUEFHRV9TSVpFOworCWkgPSBwYWdlX3RvX3BmbihwYWdlKSAtIGJsb2NrLT5w
Zm5fZmlyc3Q7CisJY2xlYXJfYml0KGksIGJsb2NrLT5iaXRtYXApOworCXdlaWdodCA9IGJpdG1h
cF93ZWlnaHQoYmxvY2stPmJpdG1hcCwgbWF4KTsKKwlEUk1fREVCVUdfRFJJVkVSKCIlcyBwZm4g
MHglbHggYmxvY2sgd2VpZ2h0IDB4JWx4XG4iLAorCQkJICJGcmVlaW5nIHBhZ2UiLCBwYWdlX3Rv
X3BmbihwYWdlKSwgd2VpZ2h0KTsKKwlpZiAoIXdlaWdodCkgeworCQlEUk1fREVCVUdfRFJJVkVS
KCIlcyBwZm5fZmlyc3QgMHglbHggb2ZmIDB4JWxseCBzaXplIDB4JWxseFxuIiwKKwkJCQkgIkZy
ZWVpbmcgYmxvY2siLCBibG9jay0+cGZuX2ZpcnN0LAorCQkJCSBpOTE1X2J1ZGR5X2Jsb2NrX29m
ZnNldChibG9jayksCisJCQkJIGk5MTVfYnVkZHlfYmxvY2tfc2l6ZSgmbWVtLT5tbSwgYmxvY2sp
KTsKKwkJX19pbnRlbF9tZW1vcnlfcmVnaW9uX3B1dF9ibG9ja19idWRkeShibG9jayk7CisJfQor
fQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRldl9wYWdlbWFwX29wcyBpOTE1X2Rldm1lbV9wYWdl
bWFwX29wcyA9IHsKKwkucGFnZV9mcmVlID0gaTkxNV9kZXZtZW1fcGFnZV9mcmVlLAorCS5taWdy
YXRlX3RvX3JhbSA9IGk5MTVfZGV2bWVtX21pZ3JhdGVfdG9fcmFtLAorfTsKKworc3RydWN0IGk5
MTVfZGV2bWVtICppOTE1X3N2bV9kZXZtZW1fYWRkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1NjQgc2l6ZSkKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtLnBkZXYt
PmRldjsKKwlzdHJ1Y3QgaTkxNV9kZXZtZW0gKmRldm1lbTsKKwlzdHJ1Y3QgcmVzb3VyY2UgKnJl
czsKKworCWRldm1lbSA9IGt6YWxsb2Moc2l6ZW9mKCpkZXZtZW0pLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWRldm1lbSkKKwkJcmV0dXJuIE5VTEw7CisKKwlkZXZtZW0tPmk5MTUgPSBpOTE1OworCXJl
cyA9IGRldm1fcmVxdWVzdF9mcmVlX21lbV9yZWdpb24oZGV2LCAmaW9tZW1fcmVzb3VyY2UsIHNp
emUpOworCWlmIChJU19FUlIocmVzKSkKKwkJZ290byBvdXRfZnJlZTsKKworCWRldm1lbS0+cGFn
ZW1hcC50eXBlID0gTUVNT1JZX0RFVklDRV9QUklWQVRFOworCWRldm1lbS0+cGFnZW1hcC5yZXMg
PSAqcmVzOworCWRldm1lbS0+cGFnZW1hcC5vcHMgPSAmaTkxNV9kZXZtZW1fcGFnZW1hcF9vcHM7
CisJaWYgKElTX0VSUihkZXZtX21lbXJlbWFwX3BhZ2VzKGRldiwgJmRldm1lbS0+cGFnZW1hcCkp
KQorCQlnb3RvIG91dF9mcmVlOworCisJZGV2bWVtLT5wZm5fZmlyc3QgPSByZXMtPnN0YXJ0ID4+
IFBBR0VfU0hJRlQ7CisJZGV2bWVtLT5wZm5fbGFzdCA9IHJlcy0+ZW5kID4+IFBBR0VfU0hJRlQ7
CisJcmV0dXJuIGRldm1lbTsKK291dF9mcmVlOgorCWtmcmVlKGRldm1lbSk7CisJcmV0dXJuIE5V
TEw7Cit9CisKK3ZvaWQgaTkxNV9zdm1fZGV2bWVtX3JlbW92ZShzdHJ1Y3QgaTkxNV9kZXZtZW0g
KmRldm1lbSkKK3sKKwkvKiBYWFg6IElzIGl0IHRoZSByaWdodCB3YXkgdG8gcmVsZWFzZT8gKi8K
KwlyZWxlYXNlX3Jlc291cmNlKCZkZXZtZW0tPnBhZ2VtYXAucmVzKTsKKwlrZnJlZShkZXZtZW0p
OworfQorCitpbnQgaTkxNV9zdm1fbWlncmF0ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAorCQkJICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9p
OTE1X3N2bV9taWdyYXRlICphcmdzID0gZGF0YTsKKwl1bnNpZ25lZCBsb25nIGFkZHIsIGVuZCwg
c2l6ZSA9IGFyZ3MtPmxlbmd0aDsKKwlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtOwor
CWVudW0gaW50ZWxfcmVnaW9uX2lkIGlkOworCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tOworCisJRFJN
X0RFQlVHX0RSSVZFUigic3RhcnQgMHglbGx4IGxlbmd0aCAweCVsbHggcmVnaW9uIDB4JXhcbiIs
CisJCQkgYXJncy0+c3RhcnQsIGFyZ3MtPmxlbmd0aCwgYXJncy0+cmVnaW9uKTsKKwlpZCA9IF9f
cmVnaW9uX2lkKGFyZ3MtPnJlZ2lvbik7CisJaWYgKChNRU1PUllfVFlQRV9GUk9NX1JFR0lPTihh
cmdzLT5yZWdpb24pICE9IElOVEVMX01FTU9SWV9MT0NBTCkgfHwKKwkgICAgaWQgPT0gSU5URUxf
UkVHSU9OX1VOS05PV04pCisJCXJldHVybiAtRUlOVkFMOworCisJbWVtID0gaTkxNS0+bW0ucmVn
aW9uc1tpZF07CisKKwltbSA9IGdldF90YXNrX21tKGN1cnJlbnQpOworCWRvd25fcmVhZCgmbW0t
Pm1tYXBfc2VtKTsKKworCWZvciAoYWRkciA9IGFyZ3MtPnN0YXJ0LCBlbmQgPSBhcmdzLT5zdGFy
dCArIHNpemU7IGFkZHIgPCBlbmQ7KSB7CisJCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hOwor
CQl1bnNpZ25lZCBsb25nIG5leHQ7CisKKwkJdm1hID0gZmluZF92bWFfaW50ZXJzZWN0aW9uKG1t
LCBhZGRyLCBlbmQpOworCQlpZiAoIXZtYSkKKwkJCWJyZWFrOworCisJCWFkZHIgJj0gUEFHRV9N
QVNLOworCQluZXh0ID0gbWluKHZtYS0+dm1fZW5kLCBlbmQpOworCQluZXh0ID0gcm91bmRfdXAo
bmV4dCwgUEFHRV9TSVpFKTsKKwkJLyogVGhpcyBpcyBhIGJlc3QgZWZmb3J0IHNvIHdlIGlnbm9y
ZSBlcnJvcnMgKi8KKwkJaTkxNV9kZXZtZW1fbWlncmF0ZV92bWEobWVtLCB2bWEsIGFkZHIsIG5l
eHQpOworCQlhZGRyID0gbmV4dDsKKwl9CisKKwl1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOworCW1t
cHV0KG1tKTsKKwlyZXR1cm4gMDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX21lbW9yeV9yZWdpb24uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9y
eV9yZWdpb24uaAppbmRleCA0NjIyYzA4NmMwNmQuLjk1ZTFlZmYwYzBiMCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbWVtb3J5X3JlZ2lvbi5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uaApAQCAtNzEsNiArNzEsNyBAQCBzdHJ1
Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbl9vcHMgewogc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24g
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OwogCisJc3RydWN0IGk5MTVfZGV2bWVt
ICpkZXZtZW07CiAJY29uc3Qgc3RydWN0IGludGVsX21lbW9yeV9yZWdpb25fb3BzICpvcHM7CiAK
IAlzdHJ1Y3QgaW9fbWFwcGluZyBpb21hcDsKQEAgLTEwMCw2ICsxMDEsMTkgQEAgc3RydWN0IGlu
dGVsX21lbW9yeV9yZWdpb24gewogCX0gb2JqZWN0czsKIH07CiAKK3N0YXRpYyBpbmxpbmUgZW51
bSBpbnRlbF9yZWdpb25faWQKK19fcmVnaW9uX2lkKHUzMiByZWdpb24pCit7CisJZW51bSBpbnRl
bF9yZWdpb25faWQgaWQ7CisKKwlmb3IgKGlkID0gMDsgaWQgPCBJTlRFTF9SRUdJT05fVU5LTk9X
TjsgKytpZCkgeworCQlpZiAoaW50ZWxfcmVnaW9uX21hcFtpZF0gPT0gcmVnaW9uKQorCQkJcmV0
dXJuIGlkOworCX0KKworCXJldHVybiBJTlRFTF9SRUdJT05fVU5LTk9XTjsKK30KKwogaW50IGlu
dGVsX21lbW9yeV9yZWdpb25faW5pdF9idWRkeShzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAq
bWVtKTsKIHZvaWQgaW50ZWxfbWVtb3J5X3JlZ2lvbl9yZWxlYXNlX2J1ZGR5KHN0cnVjdCBpbnRl
bF9tZW1vcnlfcmVnaW9uICptZW0pOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9yZWdpb25fbG1lbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVnaW9u
X2xtZW0uYwppbmRleCBlZGRiMzkyOTE3YWEuLjJiYTRhNDcyMGViNiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVnaW9uX2xtZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5jCkBAIC00LDYgKzQsNyBAQAogICovCiAKICNpbmNs
dWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfc3ZtLmgiCiAjaW5jbHVkZSAiaW50ZWxf
bWVtb3J5X3JlZ2lvbi5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9sbWVtLmgiCiAjaW5jbHVk
ZSAiZ2VtL2k5MTVfZ2VtX3JlZ2lvbi5oIgpAQCAtNjYsNiArNjcsNyBAQCBzdGF0aWMgdm9pZCBy
ZWxlYXNlX2Zha2VfbG1lbV9iYXIoc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSkKIHN0
YXRpYyB2b2lkCiByZWdpb25fbG1lbV9yZWxlYXNlKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9u
ICptZW0pCiB7CisJaTkxNV9zdm1fZGV2bWVtX3JlbW92ZShtZW0tPmRldm1lbSk7CiAJcmVsZWFz
ZV9mYWtlX2xtZW1fYmFyKG1lbSk7CiAJaW9fbWFwcGluZ19maW5pKCZtZW0tPmlvbWFwKTsKIAlp
bnRlbF9tZW1vcnlfcmVnaW9uX3JlbGVhc2VfYnVkZHkobWVtKTsKQEAgLTEyMiw2ICsxMjQsMTQg
QEAgaW50ZWxfc2V0dXBfZmFrZV9sbWVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CQkJCQkgUEFHRV9TSVpFLAogCQkJCQkgaW9fc3RhcnQsCiAJCQkJCSAmaW50ZWxfcmVnaW9uX2xt
ZW1fb3BzKTsKKwlpZiAoIUlTX0VSUihtZW0pKSB7CisJCW1lbS0+ZGV2bWVtID0gaTkxNV9zdm1f
ZGV2bWVtX2FkZChpOTE1LCBtYXBwYWJsZV9lbmQpOworCQlpZiAoSVNfRVJSKG1lbS0+ZGV2bWVt
KSkgeworCQkJaW50ZWxfbWVtb3J5X3JlZ2lvbl9wdXQobWVtKTsKKwkJCW1lbSA9IEVSUl9DQVNU
KG1lbS0+ZGV2bWVtKTsKKwkJfQorCX0KKwogCWlmICghSVNfRVJSKG1lbSkpIHsKIAkJRFJNX0lO
Rk8oIkludGVsIGdyYXBoaWNzIGZha2UgTE1FTTogJXBSXG4iLCAmbWVtLT5yZWdpb24pOwogCQlE
Uk1fSU5GTygiSW50ZWwgZ3JhcGhpY3MgZmFrZSBMTUVNIElPIHN0YXJ0OiAlbGx4XG4iLAotLSAK
Mi4yMS4wLnJjMC4zMi5nMjQzYTRjN2UyNwoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
