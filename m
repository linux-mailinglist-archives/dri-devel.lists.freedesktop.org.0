Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7CFBB4FD9E
	for <lists+dri-devel@lfdr.de>; Sun, 23 Jun 2019 20:32:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D5C98993B;
	Sun, 23 Jun 2019 18:32:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qk1-x742.google.com (mail-qk1-x742.google.com
 [IPv6:2607:f8b0:4864:20::742])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0739589824
 for <dri-devel@lists.freedesktop.org>; Sun, 23 Jun 2019 17:38:03 +0000 (UTC)
Received: by mail-qk1-x742.google.com with SMTP id x18so8074555qkn.13
 for <dri-devel@lists.freedesktop.org>; Sun, 23 Jun 2019 10:38:02 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Taorv013lx4BF1e9mQ5frJv1zsMiL53dKrJ0Mfj3qx4=;
 b=p+BrCcgepgBZetK7XdMKyp/QMzIt+1huDcDwy8tmak+RpJVZo5B6lcn/7h+abFtJf9
 MWslEh8RoVVnsxw9dkQJx/T6cyabqxavlF1lS90a4ZJa7M30Dt4EX4pBanVDOn5n7AV3
 YNCEsJ0A1x9ja2PnDcnkhHIliNwaaJp4djT0TX8BMnaOaREDin/IhKk+YJeeUTXFGiKf
 Edf4aw2AjeQHHx+zi5V46F5jWMOJ2R5cGsE54o8jtaMQ69cOhvRZ1gf9VcShDHodFV3K
 zUHzegiwQvOM131w0scU2d08B+KfeZFJS/1J1SH86CkS0uQq1yUpBTBwHVEi9h5Va+Ji
 VVtw==
X-Gm-Message-State: APjAAAVhz5QMKH+qomCkjIa1EHtgSHVBA/ezS3klQSnQX5zqO54U7K+f
 T+VP1hVdUjuMb+W0My9X3WM=
X-Google-Smtp-Source: APXvYqyxoVySJ+bjh9dacS0w0vip5Vr0BkFtivb56+vWtspFfCp3xLiTPe3jL8pbW162KCckP1ophg==
X-Received: by 2002:a37:8145:: with SMTP id c66mr13276625qkd.459.1561311482169; 
 Sun, 23 Jun 2019 10:38:02 -0700 (PDT)
Received: from localhost.localdomain (ppp91-79-162-197.pppoe.mtu-net.ru.
 [91.79.162.197])
 by smtp.gmail.com with ESMTPSA id c55sm5342498qtk.53.2019.06.23.10.38.00
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Sun, 23 Jun 2019 10:38:01 -0700 (PDT)
From: Dmitry Osipenko <digetx@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH v1 2/3] drm/tegra: Fix 2d and 3d clients detaching from IOMMU
 domain
Date: Sun, 23 Jun 2019 20:37:42 +0300
Message-Id: <20190623173743.24088-2-digetx@gmail.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190623173743.24088-1-digetx@gmail.com>
References: <20190623173743.24088-1-digetx@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Sun, 23 Jun 2019 18:32:00 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Taorv013lx4BF1e9mQ5frJv1zsMiL53dKrJ0Mfj3qx4=;
 b=i0qExktDOvmtUHmy+8LfQWIfsj+7c/KfuWryEMjvL850aOttg1UgB4u3YdMMiw6tUQ
 oUr4Uzh0mo3H0NXiw6CXiEGEqW8wY/v2soaQTvK4xSpUQ8J4AEpCfTotUDFGu6C7+2Qz
 FZRRfFHY50qwNhnwXZzX7GfNq4mSzAbYFAU+If4/4d2zgZwYzAyD5KTykp9ImlnylfYC
 Rs5ShfPEJstSCDPIknItVC/6+brEZJvUNqc7Jd1tKMk3N+zyfXTctTbBp7UezxgMJqX+
 cOSs0iEkUS/vmtde81cuHxxvPItAWeZIg0DsZWbWnOrczrXMVyYyDxdrt17f7umQn5tC
 /UVQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBzaG91bGQgc2hvdWxkIGZpcmUgdXAgb24gdGhlIERSTSdzIGRyaXZlciBtb2R1bGUgcmUt
bG9hZGVyIGJlY2F1c2UKdGhlcmUgd29uJ3QgYmUgZW5vdWdoIGF2YWlsYWJsZSBkb21haW5zIG9u
IG9sZGVyIFRlZ3JhIFNvQ3MuCgpDYzogc3RhYmxlIDxzdGFibGVAdmdlci5rZXJuZWwub3JnPgpG
aXhlczogMGM0MDdkZTVlZDFhICgiZHJtL3RlZ3JhOiBSZWZhY3RvciBJT01NVSBhdHRhY2gvZGV0
YWNoIikKU2lnbmVkLW9mZi1ieTogRG1pdHJ5IE9zaXBlbmtvIDxkaWdldHhAZ21haWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jICAgfCA0ICsrLS0KIGRyaXZlcnMvZ3B1L2Ry
bS90ZWdyYS9kcm0uYyAgfCA5ICsrKysrKy0tLQogZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5o
ICB8IDMgKystCiBkcml2ZXJzL2dwdS9kcm0vdGVncmEvZ3IyZC5jIHwgNCArKy0tCiBkcml2ZXJz
L2dwdS9kcm0vdGVncmEvZ3IzZC5jIHwgNCArKy0tCiA1IGZpbGVzIGNoYW5nZWQsIDE0IGluc2Vy
dGlvbnMoKyksIDEwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90
ZWdyYS9kYy5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RjLmMKaW5kZXggZmE1MDViYWFhYWJj
Li5jMWI4ODU0NDRkOTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jCkBAIC0yMzg4LDcgKzIzODgsNyBAQCBzdGF0
aWMgaW50IHRlZ3JhX2RjX2luaXQoc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCkKIAlpZiAo
IUlTX0VSUihwcmltYXJ5KSkKIAkJZHJtX3BsYW5lX2NsZWFudXAocHJpbWFyeSk7CiAKLQlob3N0
MXhfY2xpZW50X2lvbW11X2RldGFjaChjbGllbnQsIGRjLT5ncm91cCk7CisJaG9zdDF4X2NsaWVu
dF9pb21tdV9kZXRhY2goY2xpZW50LCBkYy0+Z3JvdXAsIHRydWUpOwogCWhvc3QxeF9zeW5jcHRf
ZnJlZShkYy0+c3luY3B0KTsKIAogCXJldHVybiBlcnI7CkBAIC0yNDEyLDcgKzI0MTIsNyBAQCBz
dGF0aWMgaW50IHRlZ3JhX2RjX2V4aXQoc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCkKIAkJ
cmV0dXJuIGVycjsKIAl9CiAKLQlob3N0MXhfY2xpZW50X2lvbW11X2RldGFjaChjbGllbnQsIGRj
LT5ncm91cCk7CisJaG9zdDF4X2NsaWVudF9pb21tdV9kZXRhY2goY2xpZW50LCBkYy0+Z3JvdXAs
IHRydWUpOwogCWhvc3QxeF9zeW5jcHRfZnJlZShkYy0+c3luY3B0KTsKIAogCXJldHVybiAwOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5jIGIvZHJpdmVycy9ncHUvZHJt
L3RlZ3JhL2RybS5jCmluZGV4IGQyMDgwYmQ3ZDM5Mi4uZjk0NDQxNDU3YzY0IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3Jh
L2RybS5jCkBAIC0xMTIwLDE1ICsxMTIwLDE4IEBAIHN0cnVjdCBpb21tdV9ncm91cCAqaG9zdDF4
X2NsaWVudF9pb21tdV9hdHRhY2goc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCwKIH0KIAog
dm9pZCBob3N0MXhfY2xpZW50X2lvbW11X2RldGFjaChzdHJ1Y3QgaG9zdDF4X2NsaWVudCAqY2xp
ZW50LAotCQkJCXN0cnVjdCBpb21tdV9ncm91cCAqZ3JvdXApCisJCQkJc3RydWN0IGlvbW11X2dy
b3VwICpncm91cCwKKwkJCQlib29sIHNoYXJlZCkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZHJt
ID0gZGV2X2dldF9kcnZkYXRhKGNsaWVudC0+cGFyZW50KTsKIAlzdHJ1Y3QgdGVncmFfZHJtICp0
ZWdyYSA9IGRybS0+ZGV2X3ByaXZhdGU7CiAKIAlpZiAoZ3JvdXApIHsKLQkJaWYgKGdyb3VwID09
IHRlZ3JhLT5ncm91cCkgeworCQlpZiAoIXNoYXJlZCB8fCBncm91cCA9PSB0ZWdyYS0+Z3JvdXAp
IHsKIAkJCWlvbW11X2RldGFjaF9ncm91cCh0ZWdyYS0+ZG9tYWluLCBncm91cCk7Ci0JCQl0ZWdy
YS0+Z3JvdXAgPSBOVUxMOworCisJCQlpZiAoZ3JvdXAgPT0gdGVncmEtPmdyb3VwKQorCQkJCXRl
Z3JhLT5ncm91cCA9IE5VTEw7CiAJCX0KIAogCQlpb21tdV9ncm91cF9wdXQoZ3JvdXApOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5oIGIvZHJpdmVycy9ncHUvZHJtL3Rl
Z3JhL2RybS5oCmluZGV4IDQ4OGYzNmYwMGJkOC4uOWYxYTNkNmYzNDA2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2Ry
bS5oCkBAIC0xMDcsNyArMTA3LDggQEAgaW50IHRlZ3JhX2RybV91bnJlZ2lzdGVyX2NsaWVudChz
dHJ1Y3QgdGVncmFfZHJtICp0ZWdyYSwKIHN0cnVjdCBpb21tdV9ncm91cCAqaG9zdDF4X2NsaWVu
dF9pb21tdV9hdHRhY2goc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCwKIAkJCQkJICAgICAg
IGJvb2wgc2hhcmVkKTsKIHZvaWQgaG9zdDF4X2NsaWVudF9pb21tdV9kZXRhY2goc3RydWN0IGhv
c3QxeF9jbGllbnQgKmNsaWVudCwKLQkJCQlzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmdyb3VwKTsKKwkJ
CQlzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmdyb3VwLAorCQkJCWJvb2wgc2hhcmVkKTsKIAogaW50IHRl
Z3JhX2RybV9pbml0KHN0cnVjdCB0ZWdyYV9kcm0gKnRlZ3JhLCBzdHJ1Y3QgZHJtX2RldmljZSAq
ZHJtKTsKIGludCB0ZWdyYV9kcm1fZXhpdChzdHJ1Y3QgdGVncmFfZHJtICp0ZWdyYSk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZ3IyZC5jIGIvZHJpdmVycy9ncHUvZHJtL3Rl
Z3JhL2dyMmQuYwppbmRleCA2NzMwNTlmZDJmY2IuLmM0ODZlMGEwNWM5ZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2dyMmQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEv
Z3IyZC5jCkBAIC02OSw3ICs2OSw3IEBAIHN0YXRpYyBpbnQgZ3IyZF9pbml0KHN0cnVjdCBob3N0
MXhfY2xpZW50ICpjbGllbnQpCiAJcmV0dXJuIDA7CiAKIGRldGFjaDoKLQlob3N0MXhfY2xpZW50
X2lvbW11X2RldGFjaChjbGllbnQsIGdyMmQtPmdyb3VwKTsKKwlob3N0MXhfY2xpZW50X2lvbW11
X2RldGFjaChjbGllbnQsIGdyMmQtPmdyb3VwLCBmYWxzZSk7CiBmcmVlOgogCWhvc3QxeF9zeW5j
cHRfZnJlZShjbGllbnQtPnN5bmNwdHNbMF0pOwogcHV0OgpAQCAtODksNyArODksNyBAQCBzdGF0
aWMgaW50IGdyMmRfZXhpdChzdHJ1Y3QgaG9zdDF4X2NsaWVudCAqY2xpZW50KQogCWlmIChlcnIg
PCAwKQogCQlyZXR1cm4gZXJyOwogCi0JaG9zdDF4X2NsaWVudF9pb21tdV9kZXRhY2goY2xpZW50
LCBncjJkLT5ncm91cCk7CisJaG9zdDF4X2NsaWVudF9pb21tdV9kZXRhY2goY2xpZW50LCBncjJk
LT5ncm91cCwgZmFsc2UpOwogCWhvc3QxeF9zeW5jcHRfZnJlZShjbGllbnQtPnN5bmNwdHNbMF0p
OwogCWhvc3QxeF9jaGFubmVsX3B1dChncjJkLT5jaGFubmVsKTsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL3RlZ3JhL2dyM2QuYyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9ncjNkLmMK
aW5kZXggNDc3OGFlOTk5NjY4Li41OTFiYWZlNDU1ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS90ZWdyYS9ncjNkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2dyM2QuYwpAQCAt
NzksNyArNzksNyBAQCBzdGF0aWMgaW50IGdyM2RfaW5pdChzdHJ1Y3QgaG9zdDF4X2NsaWVudCAq
Y2xpZW50KQogCXJldHVybiAwOwogCiBkZXRhY2g6Ci0JaG9zdDF4X2NsaWVudF9pb21tdV9kZXRh
Y2goY2xpZW50LCBncjNkLT5ncm91cCk7CisJaG9zdDF4X2NsaWVudF9pb21tdV9kZXRhY2goY2xp
ZW50LCBncjNkLT5ncm91cCwgZmFsc2UpOwogZnJlZToKIAlob3N0MXhfc3luY3B0X2ZyZWUoY2xp
ZW50LT5zeW5jcHRzWzBdKTsKIHB1dDoKQEAgLTk4LDcgKzk4LDcgQEAgc3RhdGljIGludCBncjNk
X2V4aXQoc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCkKIAlpZiAoZXJyIDwgMCkKIAkJcmV0
dXJuIGVycjsKIAotCWhvc3QxeF9jbGllbnRfaW9tbXVfZGV0YWNoKGNsaWVudCwgZ3IzZC0+Z3Jv
dXApOworCWhvc3QxeF9jbGllbnRfaW9tbXVfZGV0YWNoKGNsaWVudCwgZ3IzZC0+Z3JvdXAsIGZh
bHNlKTsKIAlob3N0MXhfc3luY3B0X2ZyZWUoY2xpZW50LT5zeW5jcHRzWzBdKTsKIAlob3N0MXhf
Y2hhbm5lbF9wdXQoZ3IzZC0+Y2hhbm5lbCk7CiAKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApk
cmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
