Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 243C95DFDA
	for <lists+dri-devel@lfdr.de>; Wed,  3 Jul 2019 10:33:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 50CEB6E0FC;
	Wed,  3 Jul 2019 08:33:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 024686E0F9
 for <dri-devel@lists.freedesktop.org>; Wed,  3 Jul 2019 08:33:11 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 49929AEA4;
 Wed,  3 Jul 2019 08:33:09 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, noralf@tronnes.org, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH 3/5] drm/ast: Replace struct ast_fbdev with generic
 framebuffer emulation
Date: Wed,  3 Jul 2019 10:33:00 +0200
Message-Id: <20190703083302.2609-4-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190703083302.2609-1-tzimmermann@suse.de>
References: <20190703083302.2609-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCByZXBsYWNlcyBhc3QncyBmcmFtZWJ1ZmZlciBjb25zb2xlIHdpdGggRFJNJ3Mg
Z2VuZXJpYwppbXBsZW1lbXRhdGlvbi4gQWxsIHJlc3BlY3RpdmUgY29kZSBpcyBiZWluZyByZW1v
dmVkIGZyb20gdGhlIGRyaXZlci4KClRoZSBjb25zb2xlIGlzIHNldCB1cCB3aXRoIGEgc2hhZG93
IGJ1ZmZlci4gVGhlIGFjdHVhbCBidWZmZXIgb2JqZWN0IGlzCm5vdCBwZXJtYW5lbnRseSBwaW5u
ZWQgaW4gdmlkZW8gcmFtLCBidXQganVzdCBhbm90aGVyIGJ1ZmZlciBvYmplY3QgdGhhdAp0aGUg
ZHJpdmVyIG1vdmVzIGluIGFuZCBvdXQgb2YgdnJhbSBhcyBuZWNlc3NhcnkuIFRoZSBkcml2ZXIn
cyBmdW5jdGlvbgphc3RfY3J0Y19kb19zZXRfYmFzZSgpIHVzZWQgdG8gY29udGFpbiBzcGVjaWFs
IGhhbmRsaW5nIGZvciB0aGUgZnJhbWVidWZmZXIKY29uc29sZS4gV2l0aCB0aGUgbmV3IGdlbmVy
aWMgZnJhbWVidWZmZXIsIHRoZSBkcml2ZXIgZG9lcyBub3QgbmVlZCB0aGlzCmNvZGUgYW4gbG9u
Z2VyLgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1c2Uu
ZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FzdC9NYWtlZmlsZSAgIHwgICAyICstCiBkcml2ZXJz
L2dwdS9kcm0vYXN0L2FzdF9kcnYuYyAgfCAgMjIgKystCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2Fz
dF9kcnYuaCAgfCAgMTcgLS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2ZiLmMgICB8IDM0MSAt
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0
X21haW4uYyB8ICAzMCArKy0KIGRyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYyB8ICAyMSAt
LQogNiBmaWxlcyBjaGFuZ2VkLCA0MSBpbnNlcnRpb25zKCspLCAzOTIgZGVsZXRpb25zKC0pCiBk
ZWxldGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfZmIuYwoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L01h
a2VmaWxlCmluZGV4IGIwODZkYWUxNzAxMy4uNTYxZjdjNDE5OWU0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vYXN0L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvTWFrZWZp
bGUKQEAgLTMsNiArMyw2IEBACiAjIE1ha2VmaWxlIGZvciB0aGUgZHJtIGRldmljZSBkcml2ZXIu
ICBUaGlzIGRyaXZlciBwcm92aWRlcyBzdXBwb3J0IGZvciB0aGUKICMgRGlyZWN0IFJlbmRlcmlu
ZyBJbmZyYXN0cnVjdHVyZSAoRFJJKSBpbiBYRnJlZTg2IDQuMS4wIGFuZCBoaWdoZXIuCiAKLWFz
dC15IDo9IGFzdF9kcnYubyBhc3RfbWFpbi5vIGFzdF9tb2RlLm8gYXN0X2ZiLm8gYXN0X3R0bS5v
IGFzdF9wb3N0Lm8gYXN0X2RwNTAxLm8KK2FzdC15IDo9IGFzdF9kcnYubyBhc3RfbWFpbi5vIGFz
dF9tb2RlLm8gYXN0X3R0bS5vIGFzdF9wb3N0Lm8gYXN0X2RwNTAxLm8KIAogb2JqLSQoQ09ORklH
X0RSTV9BU1QpIDo9IGFzdC5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9k
cnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Rydi5jCmluZGV4IDM4MTE5OTdlNzhjNC4u
NzVmNTVhYzFhMjE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuYwpAQCAtMTAzLDI1ICsxMDMsMjkgQEAg
c3RhdGljIGludCBhc3RfZHJtX2ZyZWV6ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJcGNp
X3NhdmVfc3RhdGUoZGV2LT5wZGV2KTsKIAotCWNvbnNvbGVfbG9jaygpOwotCWFzdF9mYmRldl9z
ZXRfc3VzcGVuZChkZXYsIDEpOwotCWNvbnNvbGVfdW5sb2NrKCk7CisJaWYgKGRldi0+ZmJfaGVs
cGVyKSB7CisJCWNvbnNvbGVfbG9jaygpOworCQlkcm1fZmJfaGVscGVyX3NldF9zdXNwZW5kKGRl
di0+ZmJfaGVscGVyLCAxKTsKKwkJY29uc29sZV91bmxvY2soKTsKKwl9CisKIAlyZXR1cm4gMDsK
IH0KIAogc3RhdGljIGludCBhc3RfZHJtX3RoYXcoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsK
LQlpbnQgZXJyb3IgPSAwOwotCiAJYXN0X3Bvc3RfZ3B1KGRldik7CiAKIAlkcm1fbW9kZV9jb25m
aWdfcmVzZXQoZGV2KTsKIAlkcm1faGVscGVyX3Jlc3VtZV9mb3JjZV9tb2RlKGRldik7CiAKLQlj
b25zb2xlX2xvY2soKTsKLQlhc3RfZmJkZXZfc2V0X3N1c3BlbmQoZGV2LCAwKTsKLQljb25zb2xl
X3VubG9jaygpOwotCXJldHVybiBlcnJvcjsKKwlpZiAoZGV2LT5mYl9oZWxwZXIpIHsKKwkJY29u
c29sZV9sb2NrKCk7CisJCWRybV9mYl9oZWxwZXJfc2V0X3N1c3BlbmQoZGV2LT5mYl9oZWxwZXIs
IDApOworCQljb25zb2xlX3VubG9jaygpOworCX0KKworCXJldHVybiAwOwogfQogCiBzdGF0aWMg
aW50IGFzdF9kcm1fcmVzdW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Ry
di5oCmluZGV4IGNhNzk0YTNmY2Y4Zi4uOTA3ZDc0ODBiN2JhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vYXN0L2FzdF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYu
aApAQCAtODEsOCArODEsNiBAQCBlbnVtIGFzdF90eF9jaGlwIHsKICNkZWZpbmUgQVNUX0RSQU1f
NEd4MTYgICA3CiAjZGVmaW5lIEFTVF9EUkFNXzhHeDE2ICAgOAogCi1zdHJ1Y3QgYXN0X2ZiZGV2
OwotCiBzdHJ1Y3QgYXN0X3ByaXZhdGUgewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXY7CiAKQEAg
LTk2LDggKzk0LDYgQEAgc3RydWN0IGFzdF9wcml2YXRlIHsKIAl1aW50MzJfdCBtY2xrOwogCXVp
bnQzMl90IHZyYW1fc2l6ZTsKIAotCXN0cnVjdCBhc3RfZmJkZXYgKmZiZGV2OwotCiAJaW50IGZi
X210cnI7CiAKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmN1cnNvcl9jYWNoZTsKQEAgLTIzOSwx
NCArMjM1LDYgQEAgc3RydWN0IGFzdF9lbmNvZGVyIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgYmFz
ZTsKIH07CiAKLXN0cnVjdCBhc3RfZmJkZXYgewotCXN0cnVjdCBkcm1fZmJfaGVscGVyIGhlbHBl
cjsgLyogbXVzdCBiZSBmaXJzdCAqLwotCXZvaWQgKnN5c3JhbTsKLQlpbnQgc2l6ZTsKLQlpbnQg
eDEsIHkxLCB4MiwgeTI7IC8qIGRpcnR5IHJlY3QgKi8KLQlzcGlubG9ja190IGRpcnR5X2xvY2s7
Ci19OwotCiAjZGVmaW5lIHRvX2FzdF9jcnRjKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgYXN0
X2NydGMsIGJhc2UpCiAjZGVmaW5lIHRvX2FzdF9jb25uZWN0b3IoeCkgY29udGFpbmVyX29mKHgs
IHN0cnVjdCBhc3RfY29ubmVjdG9yLCBiYXNlKQogI2RlZmluZSB0b19hc3RfZW5jb2Rlcih4KSBj
b250YWluZXJfb2YoeCwgc3RydWN0IGFzdF9lbmNvZGVyLCBiYXNlKQpAQCAtMjg5LDExICsyNzcs
NiBAQCBzdHJ1Y3QgYXN0X3ZiaW9zX21vZGVfaW5mbyB7CiBleHRlcm4gaW50IGFzdF9tb2RlX2lu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiBleHRlcm4gdm9pZCBhc3RfbW9kZV9maW5pKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogCi1pbnQgYXN0X2ZiZGV2X2luaXQoc3RydWN0IGRybV9k
ZXZpY2UgKmRldik7Ci12b2lkIGFzdF9mYmRldl9maW5pKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYp
Owotdm9pZCBhc3RfZmJkZXZfc2V0X3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50
IHN0YXRlKTsKLXZvaWQgYXN0X2ZiZGV2X3NldF9iYXNlKHN0cnVjdCBhc3RfcHJpdmF0ZSAqYXN0
LCB1bnNpZ25lZCBsb25nIGdwdV9hZGRyKTsKLQogI2RlZmluZSBBU1RfTU1fQUxJR05fU0hJRlQg
NAogI2RlZmluZSBBU1RfTU1fQUxJR05fTUFTSyAoKDEgPDwgQVNUX01NX0FMSUdOX1NISUZUKSAt
IDEpCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2ZiLmMgYi9kcml2ZXJz
L2dwdS9kcm0vYXN0L2FzdF9mYi5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBhODQ5
ZTU4YjQwYmMuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9mYi5j
CisrKyAvZGV2L251bGwKQEAgLTEsMzQxICswLDAgQEAKLS8qCi0gKiBDb3B5cmlnaHQgMjAxMiBS
ZWQgSGF0IEluYy4KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9m
IGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICogY29weSBvZiB0aGlzIHNvZnR3
YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQotICogIlNvZnR3YXJl
IiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGlu
ZwotICogd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnks
IG1lcmdlLCBwdWJsaXNoLAotICogZGlzdHJpYnV0ZSwgc3ViIGxpY2Vuc2UsIGFuZC9vciBzZWxs
IGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bwotICogcGVybWl0IHBlcnNvbnMgdG8gd2hv
bSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCi0gKiB0aGUg
Zm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJB
UyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElNUExJ
RUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hB
TlRBQklMSVRZLAotICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTi1J
TkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMCi0gKiBUSEUgQ09QWVJJR0hUIEhPTERFUlMs
IEFVVEhPUlMgQU5EL09SIElUUyBTVVBQTElFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sCi0g
KiBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09O
VFJBQ1QsIFRPUlQgT1IKLSAqIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4g
Q09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUKLSAqIFVTRSBPUiBPVEhFUiBERUFM
SU5HUyBJTiBUSEUgU09GVFdBUkUuCi0gKgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2Ug
YW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUKLSAqIG5leHQgcGFyYWdy
YXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRp
b25zCi0gKiBvZiB0aGUgU29mdHdhcmUuCi0gKgotICovCi0vKgotICogQXV0aG9yczogRGF2ZSBB
aXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KLSAqLwotI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5o
PgotI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgotI2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+Ci0j
aW5jbHVkZSA8bGludXgvc3RyaW5nLmg+Ci0jaW5jbHVkZSA8bGludXgvbW0uaD4KLSNpbmNsdWRl
IDxsaW51eC90dHkuaD4KLSNpbmNsdWRlIDxsaW51eC9zeXNycS5oPgotI2luY2x1ZGUgPGxpbnV4
L2RlbGF5Lmg+Ci0jaW5jbHVkZSA8bGludXgvaW5pdC5oPgotCi0KLSNpbmNsdWRlIDxkcm0vZHJt
UC5oPgotI2luY2x1ZGUgPGRybS9kcm1fY3J0Yy5oPgotI2luY2x1ZGUgPGRybS9kcm1fY3J0Y19o
ZWxwZXIuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9k
cm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fdXRpbC5oPgot
Ci0jaW5jbHVkZSAiYXN0X2Rydi5oIgotCi1zdGF0aWMgdm9pZCBhc3RfZGlydHlfdXBkYXRlKHN0
cnVjdCBhc3RfZmJkZXYgKmFmYmRldiwKLQkJCSAgICAgaW50IHgsIGludCB5LCBpbnQgd2lkdGgs
IGludCBoZWlnaHQpCi17Ci0JaW50IGk7Ci0Jc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdi
bzsKLQlpbnQgc3JjX29mZnNldCwgZHN0X29mZnNldDsKLQlpbnQgcmV0OwotCXU4ICpkc3Q7Ci0J
Ym9vbCB1bm1hcCA9IGZhbHNlOwotCWJvb2wgc3RvcmVfZm9yX2xhdGVyID0gZmFsc2U7Ci0JaW50
IHgyLCB5MjsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gYWZiZGV2LT5oZWxwZXIuZmI7Ci0JaW50IGJwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsK
LQotCWdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9ialswXSk7Ci0KLQlpZiAoZHJtX2Nh
bl9zbGVlcCgpKSB7Ci0JCS8qIFdlIHBpbiB0aGUgQk8gc28gaXQgd29uJ3QgYmUgbW92ZWQgZHVy
aW5nIHRoZQotCQkgKiB1cGRhdGUuIFRoZSBhY3R1YWwgbG9jYXRpb24sIHZpZGVvIFJBTSBvciBz
eXN0ZW0KLQkJICogbWVtb3J5LCBpcyBub3QgaW1wb3J0YW50LgotCQkgKi8KLQkJcmV0ID0gZHJt
X2dlbV92cmFtX3BpbihnYm8sIDApOwotCQlpZiAocmV0KSB7Ci0JCQlpZiAocmV0ICE9IC1FQlVT
WSkKLQkJCQlyZXR1cm47Ci0JCQlzdG9yZV9mb3JfbGF0ZXIgPSB0cnVlOwotCQl9Ci0JfSBlbHNl
IHsKLQkJc3RvcmVfZm9yX2xhdGVyID0gdHJ1ZTsKLQl9Ci0KLQl4MiA9IHggKyB3aWR0aCAtIDE7
Ci0JeTIgPSB5ICsgaGVpZ2h0IC0gMTsKLQlzcGluX2xvY2tfaXJxc2F2ZSgmYWZiZGV2LT5kaXJ0
eV9sb2NrLCBmbGFncyk7Ci0KLQlpZiAoYWZiZGV2LT55MSA8IHkpCi0JCXkgPSBhZmJkZXYtPnkx
OwotCWlmIChhZmJkZXYtPnkyID4geTIpCi0JCXkyID0gYWZiZGV2LT55MjsKLQlpZiAoYWZiZGV2
LT54MSA8IHgpCi0JCXggPSBhZmJkZXYtPngxOwotCWlmIChhZmJkZXYtPngyID4geDIpCi0JCXgy
ID0gYWZiZGV2LT54MjsKLQotCWlmIChzdG9yZV9mb3JfbGF0ZXIpIHsKLQkJYWZiZGV2LT54MSA9
IHg7Ci0JCWFmYmRldi0+eDIgPSB4MjsKLQkJYWZiZGV2LT55MSA9IHk7Ci0JCWFmYmRldi0+eTIg
PSB5MjsKLQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmYWZiZGV2LT5kaXJ0eV9sb2NrLCBmbGFn
cyk7Ci0JCXJldHVybjsKLQl9Ci0KLQlhZmJkZXYtPngxID0gYWZiZGV2LT55MSA9IElOVF9NQVg7
Ci0JYWZiZGV2LT54MiA9IGFmYmRldi0+eTIgPSAwOwotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JmFmYmRldi0+ZGlydHlfbG9jaywgZmxhZ3MpOwotCi0JZHN0ID0gZHJtX2dlbV92cmFtX2ttYXAo
Z2JvLCBmYWxzZSwgTlVMTCk7Ci0JaWYgKElTX0VSUihkc3QpKSB7Ci0JCURSTV9FUlJPUigiZmFp
bGVkIHRvIGttYXAgZmIgdXBkYXRlc1xuIik7Ci0JCWdvdG8gb3V0OwotCX0gZWxzZSBpZiAoIWRz
dCkgewotCQlkc3QgPSBkcm1fZ2VtX3ZyYW1fa21hcChnYm8sIHRydWUsIE5VTEwpOwotCQlpZiAo
SVNfRVJSKGRzdCkpIHsKLQkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGttYXAgZmIgdXBkYXRlc1xu
Iik7Ci0JCQlnb3RvIG91dDsKLQkJfQotCQl1bm1hcCA9IHRydWU7Ci0JfQotCi0JZm9yIChpID0g
eTsgaSA8PSB5MjsgaSsrKSB7Ci0JCS8qIGFzc3VtZSBlcXVhbCBzdHJpZGUgZm9yIG5vdyAqLwot
CQlzcmNfb2Zmc2V0ID0gZHN0X29mZnNldCA9IGkgKiBmYi0+cGl0Y2hlc1swXSArICh4ICogYnBw
KTsKLQkJbWVtY3B5X3RvaW8oZHN0ICsgZHN0X29mZnNldCwgYWZiZGV2LT5zeXNyYW0gKyBzcmNf
b2Zmc2V0LAotCQkJICAgICh4MiAtIHggKyAxKSAqIGJwcCk7Ci0JfQotCi0JaWYgKHVubWFwKQot
CQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7Ci0KLW91dDoKLQlkcm1fZ2VtX3ZyYW1fdW5waW4o
Z2JvKTsKLX0KLQotc3RhdGljIHZvaWQgYXN0X2ZpbGxyZWN0KHN0cnVjdCBmYl9pbmZvICppbmZv
LAotCQkJIGNvbnN0IHN0cnVjdCBmYl9maWxscmVjdCAqcmVjdCkKLXsKLQlzdHJ1Y3QgYXN0X2Zi
ZGV2ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0JZHJtX2ZiX2hlbHBlcl9zeXNfZmlsbHJlY3QoaW5m
bywgcmVjdCk7Ci0JYXN0X2RpcnR5X3VwZGF0ZShhZmJkZXYsIHJlY3QtPmR4LCByZWN0LT5keSwg
cmVjdC0+d2lkdGgsCi0JCQkgcmVjdC0+aGVpZ2h0KTsKLX0KLQotc3RhdGljIHZvaWQgYXN0X2Nv
cHlhcmVhKHN0cnVjdCBmYl9pbmZvICppbmZvLAotCQkJIGNvbnN0IHN0cnVjdCBmYl9jb3B5YXJl
YSAqYXJlYSkKLXsKLQlzdHJ1Y3QgYXN0X2ZiZGV2ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0JZHJt
X2ZiX2hlbHBlcl9zeXNfY29weWFyZWEoaW5mbywgYXJlYSk7Ci0JYXN0X2RpcnR5X3VwZGF0ZShh
ZmJkZXYsIGFyZWEtPmR4LCBhcmVhLT5keSwgYXJlYS0+d2lkdGgsCi0JCQkgYXJlYS0+aGVpZ2h0
KTsKLX0KLQotc3RhdGljIHZvaWQgYXN0X2ltYWdlYmxpdChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywK
LQkJCSAgY29uc3Qgc3RydWN0IGZiX2ltYWdlICppbWFnZSkKLXsKLQlzdHJ1Y3QgYXN0X2ZiZGV2
ICphZmJkZXYgPSBpbmZvLT5wYXI7Ci0JZHJtX2ZiX2hlbHBlcl9zeXNfaW1hZ2VibGl0KGluZm8s
IGltYWdlKTsKLQlhc3RfZGlydHlfdXBkYXRlKGFmYmRldiwgaW1hZ2UtPmR4LCBpbWFnZS0+ZHks
IGltYWdlLT53aWR0aCwKLQkJCSBpbWFnZS0+aGVpZ2h0KTsKLX0KLQotc3RhdGljIHN0cnVjdCBm
Yl9vcHMgYXN0ZmJfb3BzID0gewotCS5vd25lciA9IFRISVNfTU9EVUxFLAotCS5mYl9jaGVja192
YXIgPSBkcm1fZmJfaGVscGVyX2NoZWNrX3ZhciwKLQkuZmJfc2V0X3BhciA9IGRybV9mYl9oZWxw
ZXJfc2V0X3BhciwKLQkuZmJfZmlsbHJlY3QgPSBhc3RfZmlsbHJlY3QsCi0JLmZiX2NvcHlhcmVh
ID0gYXN0X2NvcHlhcmVhLAotCS5mYl9pbWFnZWJsaXQgPSBhc3RfaW1hZ2VibGl0LAotCS5mYl9w
YW5fZGlzcGxheSA9IGRybV9mYl9oZWxwZXJfcGFuX2Rpc3BsYXksCi0JLmZiX2JsYW5rID0gZHJt
X2ZiX2hlbHBlcl9ibGFuaywKLQkuZmJfc2V0Y21hcCA9IGRybV9mYl9oZWxwZXJfc2V0Y21hcCwK
LX07Ci0KLXN0YXRpYyBpbnQgYXN0ZmJfY3JlYXRlX29iamVjdChzdHJ1Y3QgYXN0X2ZiZGV2ICph
ZmJkZXYsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21k
LAotCQkJICAgICAgIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKmdvYmpfcCkKLXsKLQlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gYWZiZGV2LT5oZWxwZXIuZGV2OwotCXUzMiBzaXplOwotCXN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqZ29iajsKLQlpbnQgcmV0ID0gMDsKLQotCXNpemUgPSBtb2RlX2Nt
ZC0+cGl0Y2hlc1swXSAqIG1vZGVfY21kLT5oZWlnaHQ7Ci0JcmV0ID0gYXN0X2dlbV9jcmVhdGUo
ZGV2LCBzaXplLCB0cnVlLCAmZ29iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCSpn
b2JqX3AgPSBnb2JqOwotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyBpbnQgYXN0ZmJfY3JlYXRl
KHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCi0JCQlzdHJ1Y3QgZHJtX2ZiX2hlbHBlcl9z
dXJmYWNlX3NpemUgKnNpemVzKQotewotCXN0cnVjdCBhc3RfZmJkZXYgKmFmYmRldiA9Ci0JCWNv
bnRhaW5lcl9vZihoZWxwZXIsIHN0cnVjdCBhc3RfZmJkZXYsIGhlbHBlcik7Ci0Jc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGFmYmRldi0+aGVscGVyLmRldjsKLQlzdHJ1Y3QgZHJtX21vZGVfZmJf
Y21kMiBtb2RlX2NtZDsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKLQlzdHJ1Y3QgZmJf
aW5mbyAqaW5mbzsKLQlpbnQgc2l6ZSwgcmV0OwotCXZvaWQgKnN5c3JhbTsKLQlzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKmdvYmogPSBOVUxMOwotCW1vZGVfY21kLndpZHRoID0gc2l6ZXMtPnN1cmZh
Y2Vfd2lkdGg7Ci0JbW9kZV9jbWQuaGVpZ2h0ID0gc2l6ZXMtPnN1cmZhY2VfaGVpZ2h0OwotCW1v
ZGVfY21kLnBpdGNoZXNbMF0gPSBtb2RlX2NtZC53aWR0aCAqICgoc2l6ZXMtPnN1cmZhY2VfYnBw
ICsgNykvOCk7Ci0KLQltb2RlX2NtZC5waXhlbF9mb3JtYXQgPSBkcm1fbW9kZV9sZWdhY3lfZmJf
Zm9ybWF0KHNpemVzLT5zdXJmYWNlX2JwcCwKLQkJCQkJCQkgIHNpemVzLT5zdXJmYWNlX2RlcHRo
KTsKLQotCXNpemUgPSBtb2RlX2NtZC5waXRjaGVzWzBdICogbW9kZV9jbWQuaGVpZ2h0OwotCi0J
cmV0ID0gYXN0ZmJfY3JlYXRlX29iamVjdChhZmJkZXYsICZtb2RlX2NtZCwgJmdvYmopOwotCWlm
IChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gY3JlYXRlIGZiY29uIGJhY2tpbmcgb2Jq
ZWN0ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCXN5c3JhbSA9IHZtYWxsb2Mo
c2l6ZSk7Ci0JaWYgKCFzeXNyYW0pCi0JCXJldHVybiAtRU5PTUVNOwotCi0JaW5mbyA9IGRybV9m
Yl9oZWxwZXJfYWxsb2NfZmJpKGhlbHBlcik7Ci0JaWYgKElTX0VSUihpbmZvKSkgewotCQlyZXQg
PSBQVFJfRVJSKGluZm8pOwotCQlnb3RvIG91dDsKLQl9Ci0JZmIgPSBkcm1fZ2VtX2ZiZGV2X2Zi
X2NyZWF0ZShkZXYsIHNpemVzLCAwLCBnb2JqLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGZiKSkgewot
CQlyZXQgPSBQVFJfRVJSKGZiKTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JYWZiZGV2LT5zeXNyYW0g
PSBzeXNyYW07Ci0JYWZiZGV2LT5zaXplID0gc2l6ZTsKLQotCWFmYmRldi0+aGVscGVyLmZiID0g
ZmI7Ci0KLQlpbmZvLT5mYm9wcyA9ICZhc3RmYl9vcHM7Ci0KLQlpbmZvLT5hcGVydHVyZXMtPnJh
bmdlc1swXS5iYXNlID0gcGNpX3Jlc291cmNlX3N0YXJ0KGRldi0+cGRldiwgMCk7Ci0JaW5mby0+
YXBlcnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHBjaV9yZXNvdXJjZV9sZW4oZGV2LT5wZGV2LCAw
KTsKLQotCWRybV9mYl9oZWxwZXJfZmlsbF9pbmZvKGluZm8sICZhZmJkZXYtPmhlbHBlciwgc2l6
ZXMpOwotCi0JaW5mby0+c2NyZWVuX2Jhc2UgPSBzeXNyYW07Ci0JaW5mby0+c2NyZWVuX3NpemUg
PSBzaXplOwotCi0JaW5mby0+cGl4bWFwLmZsYWdzID0gRkJfUElYTUFQX1NZU1RFTTsKLQotCURS
TV9ERUJVR19LTVMoImFsbG9jYXRlZCAlZHglZFxuIiwKLQkJICAgICAgZmItPndpZHRoLCBmYi0+
aGVpZ2h0KTsKLQotCXJldHVybiAwOwotCi1vdXQ6Ci0JdmZyZWUoc3lzcmFtKTsKLQlyZXR1cm4g
cmV0OwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mYl9oZWxwZXJfZnVuY3MgYXN0X2Zi
X2hlbHBlcl9mdW5jcyA9IHsKLQkuZmJfcHJvYmUgPSBhc3RmYl9jcmVhdGUsCi19OwotCi1zdGF0
aWMgdm9pZCBhc3RfZmJkZXZfZGVzdHJveShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJICAg
ICAgc3RydWN0IGFzdF9mYmRldiAqYWZiZGV2KQotewotCWRybV9oZWxwZXJfZm9yY2VfZGlzYWJs
ZV9hbGwoZGV2KTsKLQlkcm1fZmJfaGVscGVyX3VucmVnaXN0ZXJfZmJpKCZhZmJkZXYtPmhlbHBl
cik7Ci0KLQlkcm1fZmJfaGVscGVyX2ZpbmkoJmFmYmRldi0+aGVscGVyKTsKLQlkcm1fZnJhbWVi
dWZmZXJfcHV0KGFmYmRldi0+aGVscGVyLmZiKTsKLQotCXZmcmVlKGFmYmRldi0+c3lzcmFtKTsK
LX0KLQotaW50IGFzdF9mYmRldl9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi17Ci0Jc3Ry
dWN0IGFzdF9wcml2YXRlICphc3QgPSBkZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBhc3RfZmJk
ZXYgKmFmYmRldjsKLQlpbnQgcmV0OwotCi0JYWZiZGV2ID0ga3phbGxvYyhzaXplb2Yoc3RydWN0
IGFzdF9mYmRldiksIEdGUF9LRVJORUwpOwotCWlmICghYWZiZGV2KQotCQlyZXR1cm4gLUVOT01F
TTsKLQotCWFzdC0+ZmJkZXYgPSBhZmJkZXY7Ci0Jc3Bpbl9sb2NrX2luaXQoJmFmYmRldi0+ZGly
dHlfbG9jayk7Ci0KLQlkcm1fZmJfaGVscGVyX3ByZXBhcmUoZGV2LCAmYWZiZGV2LT5oZWxwZXIs
ICZhc3RfZmJfaGVscGVyX2Z1bmNzKTsKLQotCXJldCA9IGRybV9mYl9oZWxwZXJfaW5pdChkZXYs
ICZhZmJkZXYtPmhlbHBlciwgMSk7Ci0JaWYgKHJldCkKLQkJZ290byBmcmVlOwotCi0JcmV0ID0g
ZHJtX2ZiX2hlbHBlcl9zaW5nbGVfYWRkX2FsbF9jb25uZWN0b3JzKCZhZmJkZXYtPmhlbHBlcik7
Ci0JaWYgKHJldCkKLQkJZ290byBmaW5pOwotCi0JLyogZGlzYWJsZSBhbGwgdGhlIHBvc3NpYmxl
IG91dHB1dHMvY3J0Y3MgYmVmb3JlIGVudGVyaW5nIEtNUyBtb2RlICovCi0JZHJtX2hlbHBlcl9k
aXNhYmxlX3VudXNlZF9mdW5jdGlvbnMoZGV2KTsKLQotCXJldCA9IGRybV9mYl9oZWxwZXJfaW5p
dGlhbF9jb25maWcoJmFmYmRldi0+aGVscGVyLCAzMik7Ci0JaWYgKHJldCkKLQkJZ290byBmaW5p
OwotCi0JcmV0dXJuIDA7Ci0KLWZpbmk6Ci0JZHJtX2ZiX2hlbHBlcl9maW5pKCZhZmJkZXYtPmhl
bHBlcik7Ci1mcmVlOgotCWtmcmVlKGFmYmRldik7Ci0JcmV0dXJuIHJldDsKLX0KLQotdm9pZCBh
c3RfZmJkZXZfZmluaShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQotewotCXN0cnVjdCBhc3RfcHJp
dmF0ZSAqYXN0ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlmICghYXN0LT5mYmRldikKLQkJcmV0
dXJuOwotCi0JYXN0X2ZiZGV2X2Rlc3Ryb3koZGV2LCBhc3QtPmZiZGV2KTsKLQlrZnJlZShhc3Qt
PmZiZGV2KTsKLQlhc3QtPmZiZGV2ID0gTlVMTDsKLX0KLQotdm9pZCBhc3RfZmJkZXZfc2V0X3N1
c3BlbmQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IHN0YXRlKQotewotCXN0cnVjdCBhc3Rf
cHJpdmF0ZSAqYXN0ID0gZGV2LT5kZXZfcHJpdmF0ZTsKLQotCWlmICghYXN0LT5mYmRldikKLQkJ
cmV0dXJuOwotCi0JZHJtX2ZiX2hlbHBlcl9zZXRfc3VzcGVuZCgmYXN0LT5mYmRldi0+aGVscGVy
LCBzdGF0ZSk7Ci19Ci0KLXZvaWQgYXN0X2ZiZGV2X3NldF9iYXNlKHN0cnVjdCBhc3RfcHJpdmF0
ZSAqYXN0LCB1bnNpZ25lZCBsb25nIGdwdV9hZGRyKQotewotCWFzdC0+ZmJkZXYtPmhlbHBlci5m
YmRldi0+Zml4LnNtZW1fc3RhcnQgPQotCQlhc3QtPmZiZGV2LT5oZWxwZXIuZmJkZXYtPmFwZXJ0
dXJlcy0+cmFuZ2VzWzBdLmJhc2UgKyBncHVfYWRkcjsKLQlhc3QtPmZiZGV2LT5oZWxwZXIuZmJk
ZXYtPmZpeC5zbWVtX2xlbiA9IGFzdC0+dnJhbV9zaXplIC0gZ3B1X2FkZHI7Ci19CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vYXN0
L2FzdF9tYWluLmMKaW5kZXggMWJkNjE2OTZlNTA5Li43OGU4ZTIwZmY1NzcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0
L2FzdF9tYWluLmMKQEAgLTM4Myw4ICszODMsMzMgQEAgc3RhdGljIGludCBhc3RfZ2V0X2RyYW1f
aW5mbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiAwOwogfQogCitzdGF0aWMgaW50
IGFzdF9mcmFtZWJ1ZmZlcl9kaXJ0eWZiKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJ
CSAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAorCQkJCSAgIHVuc2lnbmVkIGludCBmbGFn
cywKKwkJCQkgICB1bnNpZ25lZCBpbnQgY29sb3IsCisJCQkJICAgc3RydWN0IGRybV9jbGlwX3Jl
Y3QgKmNsaXBzLAorCQkJCSAgIHVuc2lnbmVkIGludCBudW1fY2xpcHMpCit7CisJLyogZW1wdHkg
cGxhY2Vob2xkZXIgZnVuY3Rpb24gdG8gZW5hYmxlIGZiY29uIHNoYWRvdyBidWZmZXIgKi8KKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXJfZnVuY3Mg
YXN0X2ZyYW1lYnVmZmVyX2Z1bmNzID0geworCS5kZXN0cm95CT0gZHJtX2dlbV9mYl9kZXN0cm95
LAorCS5jcmVhdGVfaGFuZGxlCT0gZHJtX2dlbV9mYl9jcmVhdGVfaGFuZGxlLAorCS5kaXJ0eQkJ
PSBhc3RfZnJhbWVidWZmZXJfZGlydHlmYiwKK307CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICoKK2FzdF9tb2RlX2NvbmZpZ19mYl9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgc3RydWN0IGRybV9maWxlICpmaWxlLAorCQkJICBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJf
Y21kMiAqbW9kZV9jbWQpCit7CisJcmV0dXJuIGRybV9nZW1fZmJfY3JlYXRlX3dpdGhfZnVuY3Mo
ZGV2LCBmaWxlLCBtb2RlX2NtZCwKKwkJCQkJICAgICZhc3RfZnJhbWVidWZmZXJfZnVuY3MpOwor
fQorCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBhc3RfbW9kZV9m
dW5jcyA9IHsKLQkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGUKKwkuZmJfY3JlYXRlID0g
YXN0X21vZGVfY29uZmlnX2ZiX2NyZWF0ZQogfTsKIAogc3RhdGljIHUzMiBhc3RfZ2V0X3ZyYW1f
aW5mbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQpAQCAtNTAyLDcgKzUyNyw3IEBAIGludCBhc3Rf
ZHJpdmVyX2xvYWQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgbG9uZyBmbGFncykK
IAlpZiAocmV0KQogCQlnb3RvIG91dF9mcmVlOwogCi0JcmV0ID0gYXN0X2ZiZGV2X2luaXQoZGV2
KTsKKwlyZXQgPSBkcm1fZmJkZXZfZ2VuZXJpY19zZXR1cChkZXYsIDMyKTsKIAlpZiAocmV0KQog
CQlnb3RvIG91dF9mcmVlOwogCkBAIC01MjAsNyArNTQ1LDYgQEAgdm9pZCBhc3RfZHJpdmVyX3Vu
bG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWFzdF9yZWxlYXNlX2Zpcm13YXJlKGRldik7
CiAJa2ZyZWUoYXN0LT5kcDUwMV9md19hZGRyKTsKIAlhc3RfbW9kZV9maW5pKGRldik7Ci0JYXN0
X2ZiZGV2X2ZpbmkoZGV2KTsKIAlkcm1fbW9kZV9jb25maWdfY2xlYW51cChkZXYpOwogCiAJYXN0
X21tX2ZpbmkoYXN0KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwppbmRleCBjNDgyNDlkZjc1OGUuLjNj
MDcxNjg5MWIyOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X21vZGUuYwpAQCAtNTI1LDE4ICs1MjUsMTIgQEAg
c3RhdGljIGludCBhc3RfY3J0Y19kb19zZXRfYmFzZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJ
CQkJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCQkJaW50IHgsIGludCB5LCBpbnQgYXRv
bWljKQogewotCXN0cnVjdCBhc3RfcHJpdmF0ZSAqYXN0ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0
ZTsKIAlzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvOwogCWludCByZXQ7CiAJczY0IGdw
dV9hZGRyOwotCXZvaWQgKmJhc2U7CiAKIAlpZiAoIWF0b21pYyAmJiBmYikgewogCQlnYm8gPSBk
cm1fZ2VtX3ZyYW1fb2ZfZ2VtKGZiLT5vYmpbMF0pOwotCi0JCS8qIHVubWFwIGlmIGNvbnNvbGUg
Ki8KLQkJaWYgKGFzdC0+ZmJkZXYtPmhlbHBlci5mYiA9PSBmYikKLQkJCWRybV9nZW1fdnJhbV9r
dW5tYXAoZ2JvKTsKIAkJZHJtX2dlbV92cmFtX3VucGluKGdibyk7CiAJfQogCkBAIC01NTEsMTcg
KzU0NSw2IEBAIHN0YXRpYyBpbnQgYXN0X2NydGNfZG9fc2V0X2Jhc2Uoc3RydWN0IGRybV9jcnRj
ICpjcnRjLAogCQlnb3RvIGVycl9kcm1fZ2VtX3ZyYW1fdW5waW47CiAJfQogCi0JaWYgKGFzdC0+
ZmJkZXYtPmhlbHBlci5mYiA9PSBjcnRjLT5wcmltYXJ5LT5mYikgewotCQkvKiBpZiBwdXNoaW5n
IGNvbnNvbGUgaW4ga21hcCBpdCAqLwotCQliYXNlID0gZHJtX2dlbV92cmFtX2ttYXAoZ2JvLCB0
cnVlLCBOVUxMKTsKLQkJaWYgKElTX0VSUihiYXNlKSkgewotCQkJcmV0ID0gUFRSX0VSUihiYXNl
KTsKLQkJCURSTV9FUlJPUigiZmFpbGVkIHRvIGttYXAgZmJjb25cbiIpOwotCQl9IGVsc2Ugewot
CQkJYXN0X2ZiZGV2X3NldF9iYXNlKGFzdCwgZ3B1X2FkZHIpOwotCQl9Ci0JfQotCiAJYXN0X3Nl
dF9vZmZzZXRfcmVnKGNydGMpOwogCWFzdF9zZXRfc3RhcnRfYWRkcmVzc19jcnQxKGNydGMsICh1
MzIpZ3B1X2FkZHIpOwogCkBAIC02MTgsMTQgKzYwMSwxMCBAQCBzdGF0aWMgdm9pZCBhc3RfY3J0
Y19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIAlEUk1fREVCVUdfS01TKCJcbiIpOwog
CWFzdF9jcnRjX2RwbXMoY3J0YywgRFJNX01PREVfRFBNU19PRkYpOwogCWlmIChjcnRjLT5wcmlt
YXJ5LT5mYikgewotCQlzdHJ1Y3QgYXN0X3ByaXZhdGUgKmFzdCA9IGNydGMtPmRldi0+ZGV2X3By
aXZhdGU7CiAJCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gY3J0Yy0+cHJpbWFyeS0+ZmI7
CiAJCXN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8gPQogCQkJZHJtX2dlbV92cmFtX29m
X2dlbShmYi0+b2JqWzBdKTsKIAotCQkvKiB1bm1hcCBpZiBjb25zb2xlICovCi0JCWlmIChhc3Qt
PmZiZGV2LT5oZWxwZXIuZmIgPT0gZmIpCi0JCQlkcm1fZ2VtX3ZyYW1fa3VubWFwKGdibyk7CiAJ
CWRybV9nZW1fdnJhbV91bnBpbihnYm8pOwogCX0KIAljcnRjLT5wcmltYXJ5LT5mYiA9IE5VTEw7
Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
