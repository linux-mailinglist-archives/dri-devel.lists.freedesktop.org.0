Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C1E1243351
	for <lists+dri-devel@lfdr.de>; Thu, 13 Jun 2019 09:27:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2392A892CA;
	Thu, 13 Jun 2019 07:27:26 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail3-162.sinamail.sina.com.cn (mail3-162.sinamail.sina.com.cn
 [202.108.3.162])
 by gabe.freedesktop.org (Postfix) with SMTP id 4F3AB891F2
 for <dri-devel@lists.freedesktop.org>; Thu, 13 Jun 2019 04:25:37 +0000 (UTC)
Received: from unknown (HELO localhost.localdomain)([123.112.52.116])
 by sina.com with ESMTP
 id 5D01D03E00006C8D; Thu, 13 Jun 2019 12:25:35 +0800 (CST)
X-Sender: hdanton@sina.com
X-Auth-ID: hdanton@sina.com
X-SMAIL-MID: 879478399524
From: Hillf Danton <hdanton@sina.com>
To: Thomas Hellstrom <thellstrom@vmware.com>
Subject: Re: [PATCH v5 5/9] drm/ttm: TTM fault handler helpers
Date: Thu, 13 Jun 2019 12:25:26 +0800
Message-Id: <20190613042526.12028-1-hdanton@sina.com>
In-Reply-To: <20190612064243.55340-1-thellstrom@vmwopensource.org>
References: 
MIME-Version: 1.0
X-Mailman-Approved-At: Thu, 13 Jun 2019 07:27:23 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pv-drivers@vmware.com, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, linux-graphics-maintainer@vmware.com,
 nadav.amit@gmail.com, Christian Konig <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

CkhlbGxvIFRob21hcwoKT24gV2VkLCAxMiBKdW4gMjAxOSAwODo0MjozOSArMDIwMCBUaG9tYXMg
SGVsbHN0cm9tIHdyb3RlOgo+IEZyb206IFRob21hcyBIZWxsc3Ryb20gPHRoZWxsc3Ryb21Adm13
YXJlLmNvbT4KPiAKPiBXaXRoIHRoZSB2bXdnZnggZGlydHkgdHJhY2tpbmcsIHRoZSBkZWZhdWx0
IFRUTSBmYXVsdCBoYW5kbGVyIGlzIG5vdAo+IGNvbXBsZXRlbHkgc3VmZmljaWVudCAodm13Z2Z4
IG5lZWQgdG8gbW9kaWZ5IHRoZSB2bWEtPnZtX2ZsYWdzIG1lbWJlciwKPiBhbmQgYWxzbyBuZWVk
cyB0byByZXN0cmljdCB0aGUgbnVtYmVyIG9mIHByZWZhdWx0cykuCj4gCj4gV2UgYWxzbyB3YW50
IHRvIHJlcGxpY2F0ZSB0aGUgbmV3IHR0bV9ib192bV9yZXNlcnZlKCkgZnVuY3Rpb25hbGl0eQo+
IAo+IFNvIHN0YXJ0IHR1cm5pbmcgdGhlIFRUTSB2bSBjb2RlIGludG8gaGVscGVyczogdHRtX2Jv
X3ZtX2ZhdWx0X3Jlc2VydmVkKCkKPiBhbmQgdHRtX2JvX3ZtX3Jlc2VydmUoKSwgYW5kIHByb3Zp
ZGUgYSBkZWZhdWx0IFRUTSBmYXVsdCBoYW5kbGVyIGZvciBvdGhlcgo+IGRyaXZlcnMgdG8gdXNl
Lgo+IAo+IENjOiAiQ2hyaXN0aWFuIEvDtm5pZyIgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
PiAKPiBTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgSGVsbHN0cm9tIDx0aGVsbHN0cm9tQHZtd2FyZS5j
b20+Cj4gUmV2aWV3ZWQtYnk6ICJDaHJpc3RpYW4gS8O2bmlnIiA8Y2hyaXN0aWFuLmtvZW5pZ0Bh
bWQuY29tPiAjdjEKPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYyB8IDE3
NSArKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQo+ICBpbmNsdWRlL2RybS90dG0vdHRt
X2JvX2FwaS5oICAgIHwgIDEwICsrCj4gIDIgZmlsZXMgY2hhbmdlZCwgMTEzIGluc2VydGlvbnMo
KyksIDcyIGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRt
L3R0bV9ib192bS5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwo+IGluZGV4IDE5
NmUxM2EwYWRhZC4uMmQ5ODYyZmNmNmZkIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2JvX3ZtLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib192bS5jCj4g
QEAgLTQyLDggKzQyLDYgQEAKPiAgI2luY2x1ZGUgPGxpbnV4L3VhY2Nlc3MuaD4KPiAgI2luY2x1
ZGUgPGxpbnV4L21lbV9lbmNyeXB0Lmg+Cj4gIAo+IC0jZGVmaW5lIFRUTV9CT19WTV9OVU1fUFJF
RkFVTFQgMTYKPiAtCj4gIHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9pZGxlKHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCj4gIAkJCQlzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikK
PiAgewo+IEBAIC0xMDYsMzEgKzEwNCwzMCBAQCBzdGF0aWMgdW5zaWduZWQgbG9uZyB0dG1fYm9f
aW9fbWVtX3BmbihzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAo+ICAJCSsgcGFnZV9vZmZz
ZXQ7Cj4gIH0KPiAgCj4gLXN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qg
dm1fZmF1bHQgKnZtZikKPiArLyoqCj4gKyAqIHR0bV9ib192bV9yZXNlcnZlIC0gUmVzZXJ2ZSBh
IGJ1ZmZlciBvYmplY3QgaW4gYSByZXRyeWFibGUgdm0gY2FsbGJhY2sKPiArICogQGJvOiBUaGUg
YnVmZmVyIG9iamVjdAo+ICsgKiBAdm1mOiBUaGUgZmF1bHQgc3RydWN0dXJlIGhhbmRlZCB0byB0
aGUgY2FsbGJhY2sKPiArICoKPiArICogdm0gY2FsbGJhY2tzIGxpa2UgZmF1bHQoKSBhbmQgKl9t
a3dyaXRlKCkgYWxsb3cgZm9yIHRoZSBtbV9zZW0gdG8gYmUgZHJvcHBlZAo+ICsgKiBkdXJpbmcg
bG9uZyB3YWl0cywgYW5kIGFmdGVyIHRoZSB3YWl0IHRoZSBjYWxsYmFjayB3aWxsIGJlIHJlc3Rh
cnRlZC4gVGhpcwo+ICsgKiBpcyB0byBhbGxvdyBvdGhlciB0aHJlYWRzIHVzaW5nIHRoZSBzYW1l
IHZpcnR1YWwgbWVtb3J5IHNwYWNlIGNvbmN1cnJlbnQKPiArICogYWNjZXNzIHRvIG1hcCgpLCB1
bm1hcCgpIGNvbXBsZXRlbHkgdW5yZWxhdGVkIGJ1ZmZlciBvYmplY3RzLiBUVE0gYnVmZmVyCj4g
KyAqIG9iamVjdCByZXNlcnZhdGlvbnMgc29tZXRpbWVzIHdhaXQgZm9yIEdQVSBhbmQgc2hvdWxk
IHRoZXJlZm9yZSBiZQo+ICsgKiBjb25zaWRlcmVkIGxvbmcgd2FpdHMuIFRoaXMgZnVuY3Rpb24g
cmVzZXJ2ZXMgdGhlIGJ1ZmZlciBvYmplY3QgaW50ZXJydXB0aWJseQo+ICsgKiB0YWtpbmcgdGhp
cyBpbnRvIGFjY291bnQuIFN0YXJ2YXRpb24gaXMgYXZvaWRlZCBieSB0aGUgdm0gc3lzdGVtIG5v
dAo+ICsgKiBhbGxvd2luZyB0b28gbWFueSByZXBlYXRlZCByZXN0YXJ0cy4KPiArICogVGhpcyBm
dW5jdGlvbiBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIGluIGN1c3RvbWl6ZWQgZmF1bHQoKSBhbmQg
X21rd3JpdGUoKQo+ICsgKiBoYW5kbGVycy4KPiArICoKPiArICogUmV0dXJuOgo+ICsgKiAgICAw
IG9uIHN1Y2Nlc3MgYW5kIHRoZSBibyB3YXMgcmVzZXJ2ZWQuCj4gKyAqICAgIFZNX0ZBVUxUX1JF
VFJZIGlmIGJsb2NraW5nIHdhaXQuCj4gKyAqICAgIFZNX0ZBVUxUX05PUEFHRSBpZiBibG9ja2lu
ZyB3YWl0IGFuZCByZXRyeWluZyB3YXMgbm90IGFsbG93ZWQuCj4gKyAqLwo+ICt2bV9mYXVsdF90
IHR0bV9ib192bV9yZXNlcnZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCj4gKwkJCSAg
ICAgc3RydWN0IHZtX2ZhdWx0ICp2bWYpCj4gIHsKPiAtCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
dm1hID0gdm1mLT52bWE7Cj4gLQlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gKHN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqKQo+IC0JICAgIHZtYS0+dm1fcHJpdmF0ZV9kYXRhOwo+IC0J
c3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYgPSBiby0+YmRldjsKPiAtCXVuc2lnbmVkIGxvbmcg
cGFnZV9vZmZzZXQ7Cj4gLQl1bnNpZ25lZCBsb25nIHBhZ2VfbGFzdDsKPiAtCXVuc2lnbmVkIGxv
bmcgcGZuOwo+IC0Jc3RydWN0IHR0bV90dCAqdHRtID0gTlVMTDsKPiAtCXN0cnVjdCBwYWdlICpw
YWdlOwo+IC0JaW50IGVycjsKPiAtCWludCBpOwo+IC0Jdm1fZmF1bHRfdCByZXQgPSBWTV9GQVVM
VF9OT1BBR0U7Cj4gLQl1bnNpZ25lZCBsb25nIGFkZHJlc3MgPSB2bWYtPmFkZHJlc3M7Cj4gLQlz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9Cj4gLQkJJmJkZXYtPm1hbltiby0+bWVt
Lm1lbV90eXBlXTsKPiAtCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCBjdm1hOwo+IC0KPiAtCS8qCj4g
LQkgKiBXb3JrIGFyb3VuZCBsb2NraW5nIG9yZGVyIHJldmVyc2FsIGluIGZhdWx0IC8gbm9wZm4K
PiAtCSAqIGJldHdlZW4gbW1hcF9zZW0gYW5kIGJvX3Jlc2VydmU6IFBlcmZvcm0gYSB0cnlsb2Nr
IG9wZXJhdGlvbgo+IC0JICogZm9yIHJlc2VydmUsIGFuZCBpZiBpdCBmYWlscywgcmV0cnkgdGhl
IGZhdWx0IGFmdGVyIHdhaXRpbmcKPiAtCSAqIGZvciB0aGUgYnVmZmVyIHRvIGJlY29tZSB1bnJl
c2VydmVkLgo+IC0JICovCklzIGl0IGxpa2VseSB0byBub3QgY3V0IHRoZSBjb21tZW50IGFzIHRo
ZSB0cnlsb2NrIGlzIHN0aWxsIHRoZXJlPwoKPiAgCWlmICh1bmxpa2VseSghcmVzZXJ2YXRpb25f
b2JqZWN0X3RyeWxvY2soYm8tPnJlc3YpKSkgewo+ICAJCWlmICh2bWYtPmZsYWdzICYgRkFVTFRf
RkxBR19BTExPV19SRVRSWSkgewo+ICAJCQlpZiAoISh2bWYtPmZsYWdzICYgRkFVTFRfRkxBR19S
RVRSWV9OT1dBSVQpKSB7Cj4gQEAgLTE1MSwxNCArMTQ4LDU1IEBAIHN0YXRpYyB2bV9mYXVsdF90
IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKPiAgCQlyZXR1cm4gVk1fRkFV
TFRfTk9QQUdFOwo+ICAJfQo+ICAKPiArCXJldHVybiAwOwo+ICt9Cj4gK0VYUE9SVF9TWU1CT0wo
dHRtX2JvX3ZtX3Jlc2VydmUpOwo+ICsKPiArLyoqCj4gKyAqIHR0bV9ib192bV9mYXVsdF9yZXNl
cnZlZCAtIFRUTSBmYXVsdCBoZWxwZXIKPiArICogQHZtZjogVGhlIHN0cnVjdCB2bV9mYXVsdCBn
aXZlbiBhcyBhcmd1bWVudCB0byB0aGUgZmF1bHQgY2FsbGJhY2sKPiArICogQHByb3Q6IFRoZSBw
YWdlIHByb3RlY3Rpb24gdG8gYmUgdXNlZCBmb3IgdGhpcyBtZW1vcnkgYXJlYS4KPiArICogQG51
bV9wcmVmYXVsdDogTWF4aW11bSBudW1iZXIgb2YgcHJlZmF1bHQgcGFnZXMuIFRoZSBjYWxsZXIg
bWF5IHdhbnQgdG8KPiArICogc3BlY2lmeSB0aGlzIGJhc2VkIG9uIG1hZHZpY2Ugc2V0dGluZ3Mg
YW5kIHRoZSBzaXplIG9mIHRoZSBHUFUgb2JqZWN0Cj4gKyAqIGJhY2tlZCBieSB0aGUgbWVtb3J5
Lgo+ICsgKgo+ICsgKiBUaGlzIGZ1bmN0aW9uIGluc2VydHMgb25lIG9yIG1vcmUgcGFnZSB0YWJs
ZSBlbnRyaWVzIHBvaW50aW5nIHRvIHRoZQo+ICsgKiBtZW1vcnkgYmFja2luZyB0aGUgYnVmZmVy
IG9iamVjdCwgYW5kIHRoZW4gcmV0dXJucyBhIHJldHVybiBjb2RlCj4gKyAqIGluc3RydWN0aW5n
IHRoZSBjYWxsZXIgdG8gcmV0cnkgdGhlIHBhZ2UgYWNjZXNzLgo+ICsgKgo+ICsgKiBSZXR1cm46
Cj4gKyAqICAgVk1fRkFVTFRfTk9QQUdFIG9uIHN1Y2Nlc3Mgb3IgcGVuZGluZyBzaWduYWwKPiAr
ICogICBWTV9GQVVMVF9TSUdCVVMgb24gdW5zcGVjaWZpZWQgZXJyb3IKPiArICogICBWTV9GQVVM
VF9PT00gb24gb3V0LW9mLW1lbW9yeQo+ICsgKiAgIFZNX0ZBVUxUX1JFVFJZIGlmIHJldHJ5YWJs
ZSB3YWl0Cj4gKyAqLwo+ICt2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZChzdHJ1
Y3Qgdm1fZmF1bHQgKnZtZiwKPiArCQkJCSAgICBwZ3Byb3RfdCBwcm90LAo+ICsJCQkJICAgIHBn
b2ZmX3QgbnVtX3ByZWZhdWx0KQo+ICt7Cj4gKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSA9
IHZtZi0+dm1hOwo+ICsJc3RydWN0IHZtX2FyZWFfc3RydWN0IGN2bWEgPSAqdm1hOwo+ICsJc3Ry
dWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyA9IChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKikK
PiArCSAgICB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKPiArCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpi
ZGV2ID0gYm8tPmJkZXY7Cj4gKwl1bnNpZ25lZCBsb25nIHBhZ2Vfb2Zmc2V0Owo+ICsJdW5zaWdu
ZWQgbG9uZyBwYWdlX2xhc3Q7Cj4gKwl1bnNpZ25lZCBsb25nIHBmbjsKPiArCXN0cnVjdCB0dG1f
dHQgKnR0bSA9IE5VTEw7Cj4gKwlzdHJ1Y3QgcGFnZSAqcGFnZTsKPiArCWludCBlcnI7Cj4gKwlw
Z29mZl90IGk7Cj4gKwl2bV9mYXVsdF90IHJldCA9IFZNX0ZBVUxUX05PUEFHRTsKPiArCXVuc2ln
bmVkIGxvbmcgYWRkcmVzcyA9IHZtZi0+YWRkcmVzczsKPiArCXN0cnVjdCB0dG1fbWVtX3R5cGVf
bWFuYWdlciAqbWFuID0KPiArCQkmYmRldi0+bWFuW2JvLT5tZW0ubWVtX3R5cGVdOwo+ICsKPiAg
CS8qCj4gIAkgKiBSZWZ1c2UgdG8gZmF1bHQgaW1wb3J0ZWQgcGFnZXMuIFRoaXMgc2hvdWxkIGJl
IGhhbmRsZWQKPiAgCSAqIChpZiBhdCBhbGwpIGJ5IHJlZGlyZWN0aW5nIG1tYXAgdG8gdGhlIGV4
cG9ydGVyLgo+ICAJICovCj4gLQlpZiAoYm8tPnR0bSAmJiAoYm8tPnR0bS0+cGFnZV9mbGFncyAm
IFRUTV9QQUdFX0ZMQUdfU0cpKSB7Cj4gLQkJcmV0ID0gVk1fRkFVTFRfU0lHQlVTOwo+IC0JCWdv
dG8gb3V0X3VubG9jazsKPiAtCX0KPiArCWlmIChiby0+dHRtICYmIChiby0+dHRtLT5wYWdlX2Zs
YWdzICYgVFRNX1BBR0VfRkxBR19TRykpCj4gKwkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKPiAg
Cj4gIAlpZiAoYmRldi0+ZHJpdmVyLT5mYXVsdF9yZXNlcnZlX25vdGlmeSkgewo+ICAJCXN0cnVj
dCBkbWFfZmVuY2UgKm1vdmluZyA9IGRtYV9mZW5jZV9nZXQoYm8tPm1vdmluZyk7Cj4gQEAgLTE2
OSwxMSArMjA3LDkgQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2
bV9mYXVsdCAqdm1mKQo+ICAJCQlicmVhazsKPiAgCQljYXNlIC1FQlVTWToKPiAgCQljYXNlIC1F
UkVTVEFSVFNZUzoKPiAtCQkJcmV0ID0gVk1fRkFVTFRfTk9QQUdFOwo+IC0JCQlnb3RvIG91dF91
bmxvY2s7Cj4gKwkJCXJldHVybiBWTV9GQVVMVF9OT1BBR0U7Cj4gIAkJZGVmYXVsdDoKPiAtCQkJ
cmV0ID0gVk1fRkFVTFRfU0lHQlVTOwo+IC0JCQlnb3RvIG91dF91bmxvY2s7Cj4gKwkJCXJldHVy
biBWTV9GQVVMVF9TSUdCVVM7Cj4gIAkJfQo+ICAKPiAgCQlpZiAoYm8tPm1vdmluZyAhPSBtb3Zp
bmcpIHsKPiBAQCAtMTg5LDI2ICsyMjUsMTUgQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3Zt
X2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQo+ICAJICogbW92ZS4KPiAgCSAqLwo+ICAJcmV0
ID0gdHRtX2JvX3ZtX2ZhdWx0X2lkbGUoYm8sIHZtZik7Cj4gLQlpZiAodW5saWtlbHkocmV0ICE9
IDApKSB7Cj4gLQkJaWYgKHJldCA9PSBWTV9GQVVMVF9SRVRSWSAmJgo+IC0JCSAgICAhKHZtZi0+
ZmxhZ3MgJiBGQVVMVF9GTEFHX1JFVFJZX05PV0FJVCkpIHsKPiAtCQkJLyogVGhlIEJPIGhhcyBh
bHJlYWR5IGJlZW4gdW5yZXNlcnZlZC4gKi8KPiAtCQkJcmV0dXJuIHJldDsKPiAtCQl9Cj4gLQo+
IC0JCWdvdG8gb3V0X3VubG9jazsKPiAtCX0KPiArCWlmICh1bmxpa2VseShyZXQgIT0gMCkpCj4g
KwkJcmV0dXJuIHJldDsKPiAgCj4gIAllcnIgPSB0dG1fbWVtX2lvX2xvY2sobWFuLCB0cnVlKTsK
PiAtCWlmICh1bmxpa2VseShlcnIgIT0gMCkpIHsKPiAtCQlyZXQgPSBWTV9GQVVMVF9OT1BBR0U7
Cj4gLQkJZ290byBvdXRfdW5sb2NrOwo+IC0JfQo+ICsJaWYgKHVubGlrZWx5KGVyciAhPSAwKSkK
PiArCQlyZXR1cm4gVk1fRkFVTFRfTk9QQUdFOwo+ICAJZXJyID0gdHRtX21lbV9pb19yZXNlcnZl
X3ZtKGJvKTsKPiAtCWlmICh1bmxpa2VseShlcnIgIT0gMCkpIHsKPiAtCQlyZXQgPSBWTV9GQVVM
VF9TSUdCVVM7Cj4gLQkJZ290byBvdXRfaW9fdW5sb2NrOwo+IC0JfQo+ICsJaWYgKHVubGlrZWx5
KGVyciAhPSAwKSkKPiArCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOwo+ICAKSXMgaXQgbGlrZWx5
IGEgdHlwbyB0byBza2lwIHRoZSBpb191bmxvY2s/CgotLQpIaWxsZgo+ICAJcGFnZV9vZmZzZXQg
PSAoKGFkZHJlc3MgLSB2bWEtPnZtX3N0YXJ0KSA+PiBQQUdFX1NISUZUKSArCj4gIAkJdm1hLT52
bV9wZ29mZiAtIGRybV92bWFfbm9kZV9zdGFydCgmYm8tPnZtYV9ub2RlKTsKPiBAQCAtMjIwLDE4
ICsyNDUsOCBAQCBzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHQoc3RydWN0IHZtX2Zh
dWx0ICp2bWYpCj4gIAkJZ290byBvdXRfaW9fdW5sb2NrOwo+ICAJfQo+ICAKPiAtCS8qCj4gLQkg
KiBNYWtlIGEgbG9jYWwgdm1hIGNvcHkgdG8gbW9kaWZ5IHRoZSBwYWdlX3Byb3QgbWVtYmVyCj4g
LQkgKiBhbmQgdm1fZmxhZ3MgaWYgbmVjZXNzYXJ5LiBUaGUgdm1hIHBhcmFtZXRlciBpcyBwcm90
ZWN0ZWQKPiAtCSAqIGJ5IG1tYXBfc2VtIGluIHdyaXRlIG1vZGUuCj4gLQkgKi8KPiAtCWN2bWEg
PSAqdm1hOwo+IC0JY3ZtYS52bV9wYWdlX3Byb3QgPSB2bV9nZXRfcGFnZV9wcm90KGN2bWEudm1f
ZmxhZ3MpOwo+IC0KPiAtCWlmIChiby0+bWVtLmJ1cy5pc19pb21lbSkgewo+IC0JCWN2bWEudm1f
cGFnZV9wcm90ID0gdHRtX2lvX3Byb3QoYm8tPm1lbS5wbGFjZW1lbnQsCj4gLQkJCQkJCWN2bWEu
dm1fcGFnZV9wcm90KTsKPiAtCX0gZWxzZSB7Cj4gKwljdm1hLnZtX3BhZ2VfcHJvdCA9IHR0bV9p
b19wcm90KGJvLT5tZW0ucGxhY2VtZW50LCBwcm90KTsKPiArCWlmICghYm8tPm1lbS5idXMuaXNf
aW9tZW0pIHsKPiAgCQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4ID0gewo+ICAJCQkuaW50
ZXJydXB0aWJsZSA9IGZhbHNlLAo+ICAJCQkubm9fd2FpdF9ncHUgPSBmYWxzZSwKPiBAQCAtMjQw
LDI0ICsyNTUsMjEgQEAgc3RhdGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0KHN0cnVjdCB2
bV9mYXVsdCAqdm1mKQo+ICAJCX07Cj4gIAo+ICAJCXR0bSA9IGJvLT50dG07Cj4gLQkJY3ZtYS52
bV9wYWdlX3Byb3QgPSB0dG1faW9fcHJvdChiby0+bWVtLnBsYWNlbWVudCwKPiAtCQkJCQkJY3Zt
YS52bV9wYWdlX3Byb3QpOwo+IC0KPiAtCQkvKiBBbGxvY2F0ZSBhbGwgcGFnZSBhdCBvbmNlLCBt
b3N0IGNvbW1vbiB1c2FnZSAqLwo+IC0JCWlmICh0dG1fdHRfcG9wdWxhdGUodHRtLCAmY3R4KSkg
ewo+ICsJCWlmICh0dG1fdHRfcG9wdWxhdGUoYm8tPnR0bSwgJmN0eCkpIHsKPiAgCQkJcmV0ID0g
Vk1fRkFVTFRfT09NOwo+ICAJCQlnb3RvIG91dF9pb191bmxvY2s7Cj4gIAkJfQo+ICsJfSBlbHNl
IHsKPiArCQkvKiBJb21lbSBzaG91bGQgbm90IGJlIG1hcmtlZCBlbmNyeXB0ZWQgKi8KPiArCQlj
dm1hLnZtX3BhZ2VfcHJvdCA9IHBncHJvdF9kZWNyeXB0ZWQoY3ZtYS52bV9wYWdlX3Byb3QpOwo+
ICAJfQo+ICAKPiAgCS8qCj4gIAkgKiBTcGVjdWxhdGl2ZWx5IHByZWZhdWx0IGEgbnVtYmVyIG9m
IHBhZ2VzLiBPbmx5IGVycm9yIG9uCj4gIAkgKiBmaXJzdCBwYWdlLgo+ICAJICovCj4gLQlmb3Ig
KGkgPSAwOyBpIDwgVFRNX0JPX1ZNX05VTV9QUkVGQVVMVDsgKytpKSB7Cj4gKwlmb3IgKGkgPSAw
OyBpIDwgbnVtX3ByZWZhdWx0OyArK2kpIHsKPiAgCQlpZiAoYm8tPm1lbS5idXMuaXNfaW9tZW0p
IHsKPiAtCQkJLyogSW9tZW0gc2hvdWxkIG5vdCBiZSBtYXJrZWQgZW5jcnlwdGVkICovCj4gLQkJ
CWN2bWEudm1fcGFnZV9wcm90ID0gcGdwcm90X2RlY3J5cHRlZChjdm1hLnZtX3BhZ2VfcHJvdCk7
Cj4gIAkJCXBmbiA9IHR0bV9ib19pb19tZW1fcGZuKGJvLCBwYWdlX29mZnNldCk7Cj4gIAkJfSBl
bHNlIHsKPiAgCQkJcGFnZSA9IHR0bS0+cGFnZXNbcGFnZV9vZmZzZXRdOwo+IEBAIC0yOTUsNyAr
MzA3LDI2IEBAIHN0YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1
bHQgKnZtZikKPiAgCXJldCA9IFZNX0ZBVUxUX05PUEFHRTsKPiAgb3V0X2lvX3VubG9jazoKPiAg
CXR0bV9tZW1faW9fdW5sb2NrKG1hbik7Cj4gLW91dF91bmxvY2s6Cj4gKwlyZXR1cm4gcmV0Owo+
ICt9Cj4gK0VYUE9SVF9TWU1CT0wodHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKTsKPiArCj4gK3N0
YXRpYyB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKPiAr
ewo+ICsJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKPiArCXBncHJvdF90
IHByb3Q7Cj4gKwlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gdm1hLT52bV9wcml2YXRl
X2RhdGE7Cj4gKwl2bV9mYXVsdF90IHJldDsKPiArCj4gKwlyZXQgPSB0dG1fYm9fdm1fcmVzZXJ2
ZShibywgdm1mKTsKPiArCWlmIChyZXQpCj4gKwkJcmV0dXJuIHJldDsKPiArCj4gKwlwcm90ID0g
dm1fZ2V0X3BhZ2VfcHJvdCh2bWEtPnZtX2ZsYWdzKTsKPiArCXJldCA9IHR0bV9ib192bV9mYXVs
dF9yZXNlcnZlZCh2bWYsIHByb3QsIFRUTV9CT19WTV9OVU1fUFJFRkFVTFQpOwo+ICsJaWYgKHJl
dCA9PSBWTV9GQVVMVF9SRVRSWSAmJiAhKHZtZi0+ZmxhZ3MgJiBGQVVMVF9GTEFHX1JFVFJZX05P
V0FJVCkpCj4gKwkJcmV0dXJuIHJldDsKPiArCj4gIAlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2Nr
KGJvLT5yZXN2KTsKPiAgCXJldHVybiByZXQ7Cj4gIH0KPiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS9k
cm0vdHRtL3R0bV9ib19hcGkuaCBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmgKPiBpbmRl
eCA0OWQ5Y2RmYzU4ZjIuLjQzNWQwMmY3MTlhOCAxMDA2NDQKPiAtLS0gYS9pbmNsdWRlL2RybS90
dG0vdHRtX2JvX2FwaS5oCj4gKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaAo+IEBA
IC03NjgsNCArNzY4LDE0IEBAIGludCB0dG1fYm9fc3dhcG91dChzdHJ1Y3QgdHRtX2JvX2dsb2Jh
bCAqZ2xvYiwKPiAgCQkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpOwo+ICB2b2lkIHR0
bV9ib19zd2Fwb3V0X2FsbChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldik7Cj4gIGludCB0dG1f
Ym9fd2FpdF91bnJlc2VydmVkKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pOwo+ICsKPiAr
LyogRGVmYXVsdCBudW1iZXIgb2YgcHJlLWZhdWx0ZWQgcGFnZXMgaW4gdGhlIFRUTSBmYXVsdCBo
YW5kbGVyICovCj4gKyNkZWZpbmUgVFRNX0JPX1ZNX05VTV9QUkVGQVVMVCAxNgo+ICsKPiArdm1f
ZmF1bHRfdCB0dG1fYm9fdm1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAo+
ICsJCQkgICAgIHN0cnVjdCB2bV9mYXVsdCAqdm1mKTsKPiArCj4gK3ZtX2ZhdWx0X3QgdHRtX2Jv
X3ZtX2ZhdWx0X3Jlc2VydmVkKHN0cnVjdCB2bV9mYXVsdCAqdm1mLAo+ICsJCQkJICAgIHBncHJv
dF90IHByb3QsCj4gKwkJCQkgICAgcGdvZmZfdCBudW1fcHJlZmF1bHQpOwo+ICAjZW5kaWYKPiAt
LSAKPiAyLjIwLjEKPiAKCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWw=
