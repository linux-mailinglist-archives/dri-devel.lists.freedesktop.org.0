Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5D2B6F2B06
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 10:43:23 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5CA326F3D7;
	Thu,  7 Nov 2019 09:43:16 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E6D4A6F3D3
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:43:12 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 62494B1F4;
 Thu,  7 Nov 2019 09:43:11 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, sean@poorly.run, daniel@ffwll.ch, noralf@tronnes.org,
 sam@ravnborg.org, emil.velikov@collabora.com, kraxel@redhat.com
Subject: [PATCH v3 4/4] drm/udl: Remove struct udl_gem_object and functions
Date: Thu,  7 Nov 2019 10:43:07 +0100
Message-Id: <20191107094307.19870-5-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191107094307.19870-1-tzimmermann@suse.de>
References: <20191107094307.19870-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2ltcGx5IHJlbW92ZXMgYWxsIHRoZSBvYnNvbGV0ZSBHRU0gY29kZSBmcm9tIHVkbC4gTm8gZnVu
Y3Rpb25hbApjaGFuZ2VzLgoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1t
ZXJtYW5uQHN1c2UuZGU+CkFja2VkLWJ5OiBHZXJkIEhvZmZtYW5uIDxrcmF4ZWxAcmVkaGF0LmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdWRsL01ha2VmaWxlICAgICB8ICAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL3VkbC91ZGxfZG1hYnVmLmMgfCAyNTQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3VkbC91ZGxfZHJ2LmggICAgfCAgMjkgLS0tLQogZHJp
dmVycy9ncHUvZHJtL3VkbC91ZGxfZ2VtLmMgICAgfCAyMDYgLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAxIGluc2VydGlvbigrKSwgNDkwIGRlbGV0aW9ucygtKQog
ZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2RtYWJ1Zi5jCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3VkbC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS91
ZGwvTWFrZWZpbGUKaW5kZXggZTViYjZmNzU3ZTExLi45YzQyODIwYWUzM2QgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS91ZGwvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL3VkbC9N
YWtlZmlsZQpAQCAtMSw0ICsxLDQgQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0y
LjAtb25seQotdWRsLXkgOj0gdWRsX2Rydi5vIHVkbF9tb2Rlc2V0Lm8gdWRsX2Nvbm5lY3Rvci5v
IHVkbF9lbmNvZGVyLm8gdWRsX21haW4ubyB1ZGxfZmIubyB1ZGxfdHJhbnNmZXIubyB1ZGxfZ2Vt
Lm8gdWRsX2RtYWJ1Zi5vCit1ZGwteSA6PSB1ZGxfZHJ2Lm8gdWRsX21vZGVzZXQubyB1ZGxfY29u
bmVjdG9yLm8gdWRsX2VuY29kZXIubyB1ZGxfbWFpbi5vIHVkbF9mYi5vIHVkbF90cmFuc2Zlci5v
IHVkbF9nZW0ubwogCiBvYmotJChDT05GSUdfRFJNX1VETCkgOj0gdWRsLm8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2RtYWJ1Zi5jIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91
ZGxfZG1hYnVmLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IGIxYzFlZTY0ZGU1OS4u
MDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2RtYWJ1Zi5jCisrKyAv
ZGV2L251bGwKQEAgLTEsMjU0ICswLDAgQEAKLS8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wLW9yLWxhdGVyCi0vKgotICogdWRsX2RtYWJ1Zi5jCi0gKgotICogQ29weXJpZ2h0IChj
KSAyMDE0IFRoZSBDaHJvbWl1bSBPUyBBdXRob3JzCi0gKi8KLQotI2luY2x1ZGUgPGxpbnV4L3No
bWVtX2ZzLmg+Ci0jaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgotCi0jaW5jbHVkZSA8ZHJtL2Ry
bV9wcmltZS5oPgotCi0jaW5jbHVkZSAidWRsX2Rydi5oIgotCi1zdHJ1Y3QgdWRsX2RybV9kbWFi
dWZfYXR0YWNobWVudCB7Ci0Jc3RydWN0IHNnX3RhYmxlIHNndDsKLQllbnVtIGRtYV9kYXRhX2Rp
cmVjdGlvbiBkaXI7Ci0JYm9vbCBpc19tYXBwZWQ7Ci19OwotCi1zdGF0aWMgaW50IHVkbF9hdHRh
Y2hfZG1hX2J1ZihzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAotCQkJICAgICAgc3RydWN0IGRtYV9i
dWZfYXR0YWNobWVudCAqYXR0YWNoKQotewotCXN0cnVjdCB1ZGxfZHJtX2RtYWJ1Zl9hdHRhY2ht
ZW50ICp1ZGxfYXR0YWNoOwotCi0JRFJNX0RFQlVHX1BSSU1FKCJbREVWOiVzXSBzaXplOiV6ZFxu
IiwgZGV2X25hbWUoYXR0YWNoLT5kZXYpLAotCQkJYXR0YWNoLT5kbWFidWYtPnNpemUpOwotCi0J
dWRsX2F0dGFjaCA9IGt6YWxsb2Moc2l6ZW9mKCp1ZGxfYXR0YWNoKSwgR0ZQX0tFUk5FTCk7Ci0J
aWYgKCF1ZGxfYXR0YWNoKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXVkbF9hdHRhY2gtPmRpciA9
IERNQV9OT05FOwotCWF0dGFjaC0+cHJpdiA9IHVkbF9hdHRhY2g7Ci0KLQlyZXR1cm4gMDsKLX0K
LQotc3RhdGljIHZvaWQgdWRsX2RldGFjaF9kbWFfYnVmKHN0cnVjdCBkbWFfYnVmICpkbWFidWYs
Ci0JCQkgICAgICAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQotewotCXN0cnVj
dCB1ZGxfZHJtX2RtYWJ1Zl9hdHRhY2htZW50ICp1ZGxfYXR0YWNoID0gYXR0YWNoLT5wcml2Owot
CXN0cnVjdCBzZ190YWJsZSAqc2d0OwotCi0JaWYgKCF1ZGxfYXR0YWNoKQotCQlyZXR1cm47Ci0K
LQlEUk1fREVCVUdfUFJJTUUoIltERVY6JXNdIHNpemU6JXpkXG4iLCBkZXZfbmFtZShhdHRhY2gt
PmRldiksCi0JCQlhdHRhY2gtPmRtYWJ1Zi0+c2l6ZSk7Ci0KLQlzZ3QgPSAmdWRsX2F0dGFjaC0+
c2d0OwotCi0JaWYgKHVkbF9hdHRhY2gtPmRpciAhPSBETUFfTk9ORSkKLQkJZG1hX3VubWFwX3Nn
KGF0dGFjaC0+ZGV2LCBzZ3QtPnNnbCwgc2d0LT5uZW50cywKLQkJCQl1ZGxfYXR0YWNoLT5kaXIp
OwotCi0Jc2dfZnJlZV90YWJsZShzZ3QpOwotCWtmcmVlKHVkbF9hdHRhY2gpOwotCWF0dGFjaC0+
cHJpdiA9IE5VTEw7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKnVkbF9tYXBfZG1hX2J1
ZihzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gsCi0JCQkJCWVudW0gZG1hX2RhdGFf
ZGlyZWN0aW9uIGRpcikKLXsKLQlzdHJ1Y3QgdWRsX2RybV9kbWFidWZfYXR0YWNobWVudCAqdWRs
X2F0dGFjaCA9IGF0dGFjaC0+cHJpdjsKLQlzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaiA9IHRv
X3VkbF9ibyhhdHRhY2gtPmRtYWJ1Zi0+cHJpdik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IG9iai0+YmFzZS5kZXY7Ci0Jc3RydWN0IHVkbF9kZXZpY2UgKnVkbCA9IGRldi0+ZGV2X3ByaXZh
dGU7Ci0Jc3RydWN0IHNjYXR0ZXJsaXN0ICpyZCwgKndyOwotCXN0cnVjdCBzZ190YWJsZSAqc2d0
ID0gTlVMTDsKLQl1bnNpZ25lZCBpbnQgaTsKLQlpbnQgcGFnZV9jb3VudDsKLQlpbnQgbmVudHMs
IHJldDsKLQotCURSTV9ERUJVR19QUklNRSgiW0RFVjolc10gc2l6ZTolemQgZGlyPSVkXG4iLCBk
ZXZfbmFtZShhdHRhY2gtPmRldiksCi0JCQlhdHRhY2gtPmRtYWJ1Zi0+c2l6ZSwgZGlyKTsKLQot
CS8qIGp1c3QgcmV0dXJuIGN1cnJlbnQgc2d0IGlmIGFscmVhZHkgcmVxdWVzdGVkLiAqLwotCWlm
ICh1ZGxfYXR0YWNoLT5kaXIgPT0gZGlyICYmIHVkbF9hdHRhY2gtPmlzX21hcHBlZCkKLQkJcmV0
dXJuICZ1ZGxfYXR0YWNoLT5zZ3Q7Ci0KLQlpZiAoIW9iai0+cGFnZXMpIHsKLQkJcmV0ID0gdWRs
X2dlbV9nZXRfcGFnZXMob2JqKTsKLQkJaWYgKHJldCkgewotCQkJRFJNX0VSUk9SKCJmYWlsZWQg
dG8gbWFwIHBhZ2VzLlxuIik7Ci0JCQlyZXR1cm4gRVJSX1BUUihyZXQpOwotCQl9Ci0JfQotCi0J
cGFnZV9jb3VudCA9IG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpFOwotCW9iai0+c2cgPSBkcm1f
cHJpbWVfcGFnZXNfdG9fc2cob2JqLT5wYWdlcywgcGFnZV9jb3VudCk7Ci0JaWYgKElTX0VSUihv
YmotPnNnKSkgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxvY2F0ZSBzZ3QuXG4iKTsKLQkJ
cmV0dXJuIEVSUl9DQVNUKG9iai0+c2cpOwotCX0KLQotCXNndCA9ICZ1ZGxfYXR0YWNoLT5zZ3Q7
Ci0KLQlyZXQgPSBzZ19hbGxvY190YWJsZShzZ3QsIG9iai0+c2ctPm9yaWdfbmVudHMsIEdGUF9L
RVJORUwpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2Mgc2d0Llxu
Iik7Ci0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCX0KLQotCW11dGV4X2xvY2soJnVkbC0+
Z2VtX2xvY2spOwotCi0JcmQgPSBvYmotPnNnLT5zZ2w7Ci0Jd3IgPSBzZ3QtPnNnbDsKLQlmb3Ig
KGkgPSAwOyBpIDwgc2d0LT5vcmlnX25lbnRzOyArK2kpIHsKLQkJc2dfc2V0X3BhZ2Uod3IsIHNn
X3BhZ2UocmQpLCByZC0+bGVuZ3RoLCByZC0+b2Zmc2V0KTsKLQkJcmQgPSBzZ19uZXh0KHJkKTsK
LQkJd3IgPSBzZ19uZXh0KHdyKTsKLQl9Ci0KLQlpZiAoZGlyICE9IERNQV9OT05FKSB7Ci0JCW5l
bnRzID0gZG1hX21hcF9zZyhhdHRhY2gtPmRldiwgc2d0LT5zZ2wsIHNndC0+b3JpZ19uZW50cywg
ZGlyKTsKLQkJaWYgKCFuZW50cykgewotCQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gbWFwIHNnbCB3
aXRoIGlvbW11LlxuIik7Ci0JCQlzZ19mcmVlX3RhYmxlKHNndCk7Ci0JCQlzZ3QgPSBFUlJfUFRS
KC1FSU8pOwotCQkJZ290byBlcnJfdW5sb2NrOwotCQl9Ci0JfQotCi0JdWRsX2F0dGFjaC0+aXNf
bWFwcGVkID0gdHJ1ZTsKLQl1ZGxfYXR0YWNoLT5kaXIgPSBkaXI7Ci0JYXR0YWNoLT5wcml2ID0g
dWRsX2F0dGFjaDsKLQotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJnVkbC0+Z2VtX2xvY2sp
OwotCXJldHVybiBzZ3Q7Ci19Ci0KLXN0YXRpYyB2b2lkIHVkbF91bm1hcF9kbWFfYnVmKHN0cnVj
dCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaCwKLQkJCSAgICAgIHN0cnVjdCBzZ190YWJsZSAq
c2d0LAotCQkJICAgICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyKQotewotCS8qIE5vdGhp
bmcgdG8gZG8uICovCi0JRFJNX0RFQlVHX1BSSU1FKCJbREVWOiVzXSBzaXplOiV6ZCBkaXI6JWRc
biIsIGRldl9uYW1lKGF0dGFjaC0+ZGV2KSwKLQkJCWF0dGFjaC0+ZG1hYnVmLT5zaXplLCBkaXIp
OwotfQotCi1zdGF0aWMgdm9pZCAqdWRsX2RtYWJ1Zl9rbWFwKHN0cnVjdCBkbWFfYnVmICpkbWFf
YnVmLCB1bnNpZ25lZCBsb25nIHBhZ2VfbnVtKQotewotCS8qIFRPRE8gKi8KLQotCXJldHVybiBO
VUxMOwotfQotCi1zdGF0aWMgdm9pZCB1ZGxfZG1hYnVmX2t1bm1hcChzdHJ1Y3QgZG1hX2J1ZiAq
ZG1hX2J1ZiwKLQkJCSAgICAgIHVuc2lnbmVkIGxvbmcgcGFnZV9udW0sIHZvaWQgKmFkZHIpCi17
Ci0JLyogVE9ETyAqLwotfQotCi1zdGF0aWMgaW50IHVkbF9kbWFidWZfbW1hcChzdHJ1Y3QgZG1h
X2J1ZiAqZG1hX2J1ZiwKLQkJCSAgIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQotewotCS8q
IFRPRE8gKi8KLQotCXJldHVybiAtRUlOVkFMOwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRt
YV9idWZfb3BzIHVkbF9kbWFidWZfb3BzID0gewotCS5hdHRhY2gJCQk9IHVkbF9hdHRhY2hfZG1h
X2J1ZiwKLQkuZGV0YWNoCQkJPSB1ZGxfZGV0YWNoX2RtYV9idWYsCi0JLm1hcF9kbWFfYnVmCQk9
IHVkbF9tYXBfZG1hX2J1ZiwKLQkudW5tYXBfZG1hX2J1ZgkJPSB1ZGxfdW5tYXBfZG1hX2J1ZiwK
LQkubWFwCQkJPSB1ZGxfZG1hYnVmX2ttYXAsCi0JLnVubWFwCQkJPSB1ZGxfZG1hYnVmX2t1bm1h
cCwKLQkubW1hcAkJCT0gdWRsX2RtYWJ1Zl9tbWFwLAotCS5yZWxlYXNlCQk9IGRybV9nZW1fZG1h
YnVmX3JlbGVhc2UsCi19OwotCi1zdHJ1Y3QgZG1hX2J1ZiAqdWRsX2dlbV9wcmltZV9leHBvcnQo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIGludCBmbGFncykKLXsKLQlERUZJTkVfRE1BX0JV
Rl9FWFBPUlRfSU5GTyhleHBfaW5mbyk7Ci0KLQlleHBfaW5mby5vcHMgPSAmdWRsX2RtYWJ1Zl9v
cHM7Ci0JZXhwX2luZm8uc2l6ZSA9IG9iai0+c2l6ZTsKLQlleHBfaW5mby5mbGFncyA9IGZsYWdz
OwotCWV4cF9pbmZvLnByaXYgPSBvYmo7Ci0KLQlyZXR1cm4gZHJtX2dlbV9kbWFidWZfZXhwb3J0
KG9iai0+ZGV2LCAmZXhwX2luZm8pOwotfQotCi1zdGF0aWMgaW50IHVkbF9wcmltZV9jcmVhdGUo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCSAgICBzaXplX3Qgc2l6ZSwKLQkJCSAgICBzdHJ1
Y3Qgc2dfdGFibGUgKnNnLAotCQkJICAgIHN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqKm9ial9wKQot
ewotCXN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqb2JqOwotCWludCBucGFnZXM7Ci0KLQlucGFnZXMg
PSBzaXplIC8gUEFHRV9TSVpFOwotCi0JKm9ial9wID0gTlVMTDsKLQlvYmogPSB1ZGxfZ2VtX2Fs
bG9jX29iamVjdChkZXYsIG5wYWdlcyAqIFBBR0VfU0laRSk7Ci0JaWYgKCFvYmopCi0JCXJldHVy
biAtRU5PTUVNOwotCi0Jb2JqLT5zZyA9IHNnOwotCW9iai0+cGFnZXMgPSBrdm1hbGxvY19hcnJh
eShucGFnZXMsIHNpemVvZihzdHJ1Y3QgcGFnZSAqKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKG9iai0+
cGFnZXMgPT0gTlVMTCkgewotCQlEUk1fRVJST1IoIm9iaiBwYWdlcyBpcyBOVUxMICVkXG4iLCBu
cGFnZXMpOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9Ci0KLQlkcm1fcHJpbWVfc2dfdG9fcGFnZV9h
ZGRyX2FycmF5cyhzZywgb2JqLT5wYWdlcywgTlVMTCwgbnBhZ2VzKTsKLQotCSpvYmpfcCA9IG9i
ajsKLQlyZXR1cm4gMDsKLX0KLQotc3RydWN0IGRybV9nZW1fb2JqZWN0ICp1ZGxfZ2VtX3ByaW1l
X2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJCXN0cnVjdCBkbWFfYnVmICpkbWFf
YnVmKQotewotCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaDsKLQlzdHJ1Y3Qgc2df
dGFibGUgKnNnOwotCXN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqdW9iajsKLQlpbnQgcmV0OwotCi0J
LyogbmVlZCB0byBhdHRhY2ggKi8KLQlnZXRfZGV2aWNlKGRldi0+ZGV2KTsKLQlhdHRhY2ggPSBk
bWFfYnVmX2F0dGFjaChkbWFfYnVmLCBkZXYtPmRldik7Ci0JaWYgKElTX0VSUihhdHRhY2gpKSB7
Ci0JCXB1dF9kZXZpY2UoZGV2LT5kZXYpOwotCQlyZXR1cm4gRVJSX0NBU1QoYXR0YWNoKTsKLQl9
Ci0KLQlnZXRfZG1hX2J1ZihkbWFfYnVmKTsKLQotCXNnID0gZG1hX2J1Zl9tYXBfYXR0YWNobWVu
dChhdHRhY2gsIERNQV9CSURJUkVDVElPTkFMKTsKLQlpZiAoSVNfRVJSKHNnKSkgewotCQlyZXQg
PSBQVFJfRVJSKHNnKTsKLQkJZ290byBmYWlsX2RldGFjaDsKLQl9Ci0KLQlyZXQgPSB1ZGxfcHJp
bWVfY3JlYXRlKGRldiwgZG1hX2J1Zi0+c2l6ZSwgc2csICZ1b2JqKTsKLQlpZiAocmV0KQotCQln
b3RvIGZhaWxfdW5tYXA7Ci0KLQl1b2JqLT5iYXNlLmltcG9ydF9hdHRhY2ggPSBhdHRhY2g7Ci0K
LQlyZXR1cm4gJnVvYmotPmJhc2U7Ci0KLWZhaWxfdW5tYXA6Ci0JZG1hX2J1Zl91bm1hcF9hdHRh
Y2htZW50KGF0dGFjaCwgc2csIERNQV9CSURJUkVDVElPTkFMKTsKLWZhaWxfZGV0YWNoOgotCWRt
YV9idWZfZGV0YWNoKGRtYV9idWYsIGF0dGFjaCk7Ci0JZG1hX2J1Zl9wdXQoZG1hX2J1Zik7Ci0J
cHV0X2RldmljZShkZXYtPmRldik7Ci0JcmV0dXJuIEVSUl9QVFIocmV0KTsKLX0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3VkbC91
ZGxfZHJ2LmgKaW5kZXggNjMwZTY0YWJjOTg2Li45ODdkOTlhZTJkZmEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS91ZGwvdWRsX2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRs
X2Rydi5oCkBAIC03MywxOCArNzMsOCBAQCBzdHJ1Y3QgdWRsX2RldmljZSB7CiAKICNkZWZpbmUg
dG9fdWRsKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgdWRsX2RldmljZSwgZHJtKQogCi1zdHJ1
Y3QgdWRsX2dlbV9vYmplY3QgewotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCBiYXNlOwotCXN0cnVj
dCBwYWdlICoqcGFnZXM7Ci0Jdm9pZCAqdm1hcHBpbmc7Ci0Jc3RydWN0IHNnX3RhYmxlICpzZzsK
LX07Ci0KLSNkZWZpbmUgdG9fdWRsX2JvKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgdWRsX2dl
bV9vYmplY3QsIGJhc2UpCi0KIHN0cnVjdCB1ZGxfZnJhbWVidWZmZXIgewogCXN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgYmFzZTsKLQlzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3Qg
ZHJtX2dlbV9zaG1lbV9vYmplY3QgKnNobWVtOwogCWJvb2wgYWN0aXZlXzE2OyAvKiBhY3RpdmUg
b24gdGhlIDE2LWJpdCBjaGFubmVsICovCiB9OwpAQCAtMTIwLDI3ICsxMTAsOCBAQCBpbnQgdWRs
X3JlbmRlcl9obGluZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgbG9nX2JwcCwgc3RydWN0
IHVyYiAqKnVyYl9wdHIsCiAJCSAgICAgdTMyIGJ5dGVfb2Zmc2V0LCB1MzIgZGV2aWNlX2J5dGVf
b2Zmc2V0LCB1MzIgYnl0ZV93aWR0aCwKIAkJICAgICBpbnQgKmlkZW50X3B0ciwgaW50ICpzZW50
X3B0cik7CiAKLWludCB1ZGxfZHVtYl9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYs
Ci0JCSAgICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkgICAgc3RydWN0IGRybV9tb2RlX2Ny
ZWF0ZV9kdW1iICphcmdzKTsKLWludCB1ZGxfZ2VtX21tYXAoc3RydWN0IGRybV9maWxlICpmaWxl
X3ByaXYsIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCSB1aW50MzJfdCBoYW5kbGUsIHVpbnQ2
NF90ICpvZmZzZXQpOwotCiBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnVkbF9kcml2ZXJfZ2VtX2Ny
ZWF0ZV9vYmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkJCSAgICBzaXplX3Qgc2l6
ZSk7Ci12b2lkIHVkbF9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW1f
b2JqKTsKLXN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqdWRsX2dlbV9hbGxvY19vYmplY3Qoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKLQkJCQkJICAgIHNpemVfdCBzaXplKTsKLXN0cnVjdCBkbWFfYnVm
ICp1ZGxfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgaW50IGZs
YWdzKTsKLXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqdWRsX2dlbV9wcmltZV9pbXBvcnQoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKLQkJCQlzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1Zik7Ci0KLWludCB1
ZGxfZ2VtX2dldF9wYWdlcyhzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaik7Ci12b2lkIHVkbF9n
ZW1fcHV0X3BhZ2VzKHN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqb2JqKTsKLWludCB1ZGxfZ2VtX3Zt
YXAoc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpvYmopOwotdm9pZCB1ZGxfZ2VtX3Z1bm1hcChzdHJ1
Y3QgdWRsX2dlbV9vYmplY3QgKm9iaik7Ci1pbnQgdWRsX2RybV9nZW1fbW1hcChzdHJ1Y3QgZmls
ZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpOwotdm1fZmF1bHRfdCB1ZGxfZ2Vt
X2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKTsKIAogaW50IHVkbF9oYW5kbGVfZGFtYWdlKHN0
cnVjdCB1ZGxfZnJhbWVidWZmZXIgKmZiLCBpbnQgeCwgaW50IHksCiAJCSAgICAgIGludCB3aWR0
aCwgaW50IGhlaWdodCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9nZW0u
YyBiL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2dlbS5jCmluZGV4IDk3NjIyNjVlZGZjZi4uNmVh
ZGU2YjRiMGRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9nZW0uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9nZW0uYwpAQCAtMTIwLDIwOSArMTIwLDMgQEAgc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICp1ZGxfZHJpdmVyX2dlbV9jcmVhdGVfb2JqZWN0KHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsCiAKIAlyZXR1cm4gb2JqOwogfQotCi1zdHJ1Y3QgdWRsX2dlbV9vYmpl
Y3QgKnVkbF9nZW1fYWxsb2Nfb2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0JCQkJCSAg
ICBzaXplX3Qgc2l6ZSkKLXsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKLQotCW9iaiA9
IGRldi0+ZHJpdmVyLT5nZW1fY3JlYXRlX29iamVjdChkZXYsIHNpemUpOwotCWlmIChvYmogPT0g
TlVMTCkKLQkJcmV0dXJuIE5VTEw7Ci0KLQlpZiAoZHJtX2dlbV9vYmplY3RfaW5pdChkZXYsIG9i
aiwgc2l6ZSkgIT0gMCkgewotCQlrZnJlZShvYmopOwotCQlyZXR1cm4gTlVMTDsKLQl9Ci0KLQly
ZXR1cm4gdG9fdWRsX2JvKG9iaik7Ci19Ci0KLXN0YXRpYyBpbnQKLXVkbF9nZW1fY3JlYXRlKHN0
cnVjdCBkcm1fZmlsZSAqZmlsZSwKLQkgICAgICAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkg
ICAgICAgdWludDY0X3Qgc2l6ZSwKLQkgICAgICAgdWludDMyX3QgKmhhbmRsZV9wKQotewotCXN0
cnVjdCB1ZGxfZ2VtX29iamVjdCAqb2JqOwotCWludCByZXQ7Ci0JdTMyIGhhbmRsZTsKLQotCXNp
emUgPSByb3VuZHVwKHNpemUsIFBBR0VfU0laRSk7Ci0KLQlvYmogPSB1ZGxfZ2VtX2FsbG9jX29i
amVjdChkZXYsIHNpemUpOwotCWlmIChvYmogPT0gTlVMTCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0K
LQlyZXQgPSBkcm1fZ2VtX2hhbmRsZV9jcmVhdGUoZmlsZSwgJm9iai0+YmFzZSwgJmhhbmRsZSk7
Ci0JaWYgKHJldCkgewotCQlkcm1fZ2VtX29iamVjdF9yZWxlYXNlKCZvYmotPmJhc2UpOwotCQlr
ZnJlZShvYmopOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxv
Y2tlZCgmb2JqLT5iYXNlKTsKLQkqaGFuZGxlX3AgPSBoYW5kbGU7Ci0JcmV0dXJuIDA7Ci19Ci0K
LWludCB1ZGxfZHVtYl9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAotCQkgICAgc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKLQkJICAgIHN0cnVjdCBkcm1fbW9kZV9jcmVhdGVfZHVtYiAqYXJn
cykKLXsKLQlhcmdzLT5waXRjaCA9IGFyZ3MtPndpZHRoICogRElWX1JPVU5EX1VQKGFyZ3MtPmJw
cCwgOCk7Ci0JYXJncy0+c2l6ZSA9IGFyZ3MtPnBpdGNoICogYXJncy0+aGVpZ2h0OwotCXJldHVy
biB1ZGxfZ2VtX2NyZWF0ZShmaWxlLCBkZXYsCi0JCQkgICAgICBhcmdzLT5zaXplLCAmYXJncy0+
aGFuZGxlKTsKLX0KLQotaW50IHVkbF9kcm1fZ2VtX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0
cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQotewotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
OwotCWludCByZXQ7Ci0KLQlyZXQgPSBkcm1fZ2VtX21tYXAoZmlscCwgdm1hKTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCi0Jb2JqID0gdm1hLT52bV9wcml2YXRlX2RhdGE7Ci0KLQl2bWEt
PnZtX2ZsYWdzICY9IH5WTV9QRk5NQVA7Ci0Jdm1hLT52bV9mbGFncyB8PSBWTV9NSVhFRE1BUDsK
LQotCXZtYS0+dm1fcGFnZV9wcm90ID0gdm1fZ2V0X3BhZ2VfcHJvdCh2bWEtPnZtX2ZsYWdzKTsK
LQlpZiAob2JqLT5pbXBvcnRfYXR0YWNoKQotCQl2bWEtPnZtX3BhZ2VfcHJvdCA9IHBncHJvdF93
cml0ZWNvbWJpbmUodm1hLT52bV9wYWdlX3Byb3QpOwotCi0JcmV0dXJuIHJldDsKLX0KLQotdm1f
ZmF1bHRfdCB1ZGxfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQotewotCXN0cnVjdCB2
bV9hcmVhX3N0cnVjdCAqdm1hID0gdm1mLT52bWE7Ci0Jc3RydWN0IHVkbF9nZW1fb2JqZWN0ICpv
YmogPSB0b191ZGxfYm8odm1hLT52bV9wcml2YXRlX2RhdGEpOwotCXN0cnVjdCBwYWdlICpwYWdl
OwotCXVuc2lnbmVkIGludCBwYWdlX29mZnNldDsKLQotCXBhZ2Vfb2Zmc2V0ID0gKHZtZi0+YWRk
cmVzcyAtIHZtYS0+dm1fc3RhcnQpID4+IFBBR0VfU0hJRlQ7Ci0KLQlpZiAoIW9iai0+cGFnZXMp
Ci0JCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7Ci0KLQlwYWdlID0gb2JqLT5wYWdlc1twYWdlX29m
ZnNldF07Ci0JcmV0dXJuIHZtZl9pbnNlcnRfcGFnZSh2bWEsIHZtZi0+YWRkcmVzcywgcGFnZSk7
Ci19Ci0KLWludCB1ZGxfZ2VtX2dldF9wYWdlcyhzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaikK
LXsKLQlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOwotCi0JaWYgKG9iai0+cGFnZXMpCi0JCXJldHVybiAw
OwotCi0JcGFnZXMgPSBkcm1fZ2VtX2dldF9wYWdlcygmb2JqLT5iYXNlKTsKLQlpZiAoSVNfRVJS
KHBhZ2VzKSkKLQkJcmV0dXJuIFBUUl9FUlIocGFnZXMpOwotCi0Jb2JqLT5wYWdlcyA9IHBhZ2Vz
OwotCi0JcmV0dXJuIDA7Ci19Ci0KLXZvaWQgdWRsX2dlbV9wdXRfcGFnZXMoc3RydWN0IHVkbF9n
ZW1fb2JqZWN0ICpvYmopCi17Ci0JaWYgKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoKSB7Ci0JCWt2
ZnJlZShvYmotPnBhZ2VzKTsKLQkJb2JqLT5wYWdlcyA9IE5VTEw7Ci0JCXJldHVybjsKLQl9Ci0K
LQlkcm1fZ2VtX3B1dF9wYWdlcygmb2JqLT5iYXNlLCBvYmotPnBhZ2VzLCBmYWxzZSwgZmFsc2Up
OwotCW9iai0+cGFnZXMgPSBOVUxMOwotfQotCi1pbnQgdWRsX2dlbV92bWFwKHN0cnVjdCB1ZGxf
Z2VtX29iamVjdCAqb2JqKQotewotCWludCBwYWdlX2NvdW50ID0gb2JqLT5iYXNlLnNpemUgLyBQ
QUdFX1NJWkU7Ci0JaW50IHJldDsKLQotCWlmIChvYmotPmJhc2UuaW1wb3J0X2F0dGFjaCkgewot
CQlvYmotPnZtYXBwaW5nID0gZG1hX2J1Zl92bWFwKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoLT5k
bWFidWYpOwotCQlpZiAoIW9iai0+dm1hcHBpbmcpCi0JCQlyZXR1cm4gLUVOT01FTTsKLQkJcmV0
dXJuIDA7Ci0JfQotCi0JcmV0ID0gdWRsX2dlbV9nZXRfcGFnZXMob2JqKTsKLQlpZiAocmV0KQot
CQlyZXR1cm4gcmV0OwotCi0Jb2JqLT52bWFwcGluZyA9IHZtYXAob2JqLT5wYWdlcywgcGFnZV9j
b3VudCwgMCwgUEFHRV9LRVJORUwpOwotCWlmICghb2JqLT52bWFwcGluZykKLQkJcmV0dXJuIC1F
Tk9NRU07Ci0JcmV0dXJuIDA7Ci19Ci0KLXZvaWQgdWRsX2dlbV92dW5tYXAoc3RydWN0IHVkbF9n
ZW1fb2JqZWN0ICpvYmopCi17Ci0JaWYgKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoKSB7Ci0JCWRt
YV9idWZfdnVubWFwKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoLT5kbWFidWYsIG9iai0+dm1hcHBp
bmcpOwotCQlyZXR1cm47Ci0JfQotCi0JdnVubWFwKG9iai0+dm1hcHBpbmcpOwotCi0JdWRsX2dl
bV9wdXRfcGFnZXMob2JqKTsKLX0KLQotdm9pZCB1ZGxfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqZ2VtX29iaikKLXsKLQlzdHJ1Y3QgdWRsX2dlbV9vYmplY3QgKm9iaiA9
IHRvX3VkbF9ibyhnZW1fb2JqKTsKLQotCWlmIChvYmotPnZtYXBwaW5nKQotCQl1ZGxfZ2VtX3Z1
bm1hcChvYmopOwotCi0JaWYgKGdlbV9vYmotPmltcG9ydF9hdHRhY2gpIHsKLQkJZHJtX3ByaW1l
X2dlbV9kZXN0cm95KGdlbV9vYmosIG9iai0+c2cpOwotCQlwdXRfZGV2aWNlKGdlbV9vYmotPmRl
di0+ZGV2KTsKLQl9Ci0KLQlpZiAob2JqLT5wYWdlcykKLQkJdWRsX2dlbV9wdXRfcGFnZXMob2Jq
KTsKLQotCWRybV9nZW1fZnJlZV9tbWFwX29mZnNldChnZW1fb2JqKTsKLX0KLQotLyogdGhlIGR1
bWIgaW50ZXJmYWNlIGRvZXNuJ3Qgd29yayB3aXRoIHRoZSBHRU0gc3RyYWlnaHQgTU1BUAotICAg
aW50ZXJmYWNlLCBpdCBleHBlY3RzIHRvIGRvIE1NQVAgb24gdGhlIGRybSBmZCwgbGlrZSBub3Jt
YWwgKi8KLWludCB1ZGxfZ2VtX21tYXAoc3RydWN0IGRybV9maWxlICpmaWxlLCBzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAotCQkgdWludDMyX3QgaGFuZGxlLCB1aW50NjRfdCAqb2Zmc2V0KQotewot
CXN0cnVjdCB1ZGxfZ2VtX29iamVjdCAqZ29iajsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9i
ajsKLQlzdHJ1Y3QgdWRsX2RldmljZSAqdWRsID0gdG9fdWRsKGRldik7Ci0JaW50IHJldCA9IDA7
Ci0KLQltdXRleF9sb2NrKCZ1ZGwtPmdlbV9sb2NrKTsKLQlvYmogPSBkcm1fZ2VtX29iamVjdF9s
b29rdXAoZmlsZSwgaGFuZGxlKTsKLQlpZiAob2JqID09IE5VTEwpIHsKLQkJcmV0ID0gLUVOT0VO
VDsKLQkJZ290byB1bmxvY2s7Ci0JfQotCWdvYmogPSB0b191ZGxfYm8ob2JqKTsKLQotCXJldCA9
IHVkbF9nZW1fZ2V0X3BhZ2VzKGdvYmopOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCXJldCA9
IGRybV9nZW1fY3JlYXRlX21tYXBfb2Zmc2V0KG9iaik7Ci0JaWYgKHJldCkKLQkJZ290byBvdXQ7
Ci0KLQkqb2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZnb2JqLT5iYXNlLnZtYV9u
b2RlKTsKLQotb3V0OgotCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmZ29iai0+YmFzZSk7
Ci11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZ1ZGwtPmdlbV9sb2NrKTsKLQlyZXR1cm4gcmV0Owot
fQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
