Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AFE94AD3AF
	for <lists+dri-devel@lfdr.de>; Mon,  9 Sep 2019 09:23:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 148FC89838;
	Mon,  9 Sep 2019 07:23:03 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay9-d.mail.gandi.net (relay9-d.mail.gandi.net
 [217.70.183.199])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C41006E29F
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Sep 2019 13:53:48 +0000 (UTC)
X-Originating-IP: 2.224.242.101
Received: from uno.lan (2-224-242-101.ip172.fastwebnet.it [2.224.242.101])
 (Authenticated sender: jacopo@jmondi.org)
 by relay9-d.mail.gandi.net (Postfix) with ESMTPSA id A8387FF80F;
 Fri,  6 Sep 2019 13:53:44 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli+renesas@fpond.eu,
 VenkataRajesh.Kalakodima@in.bosch.com, airlied@linux.ie, daniel@ffwll.ch
Subject: [PATCH v4 8/9] drm: rcar-du: kms: Update CMM in atomic commit tail
Date: Fri,  6 Sep 2019 15:54:35 +0200
Message-Id: <20190906135436.10622-9-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190906135436.10622-1-jacopo+renesas@jmondi.org>
References: <20190906135436.10622-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 09 Sep 2019 07:23:02 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: muroya@ksk.co.jp, koji.matsuoka.xm@renesas.com,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org,
 linux-renesas-soc@vger.kernel.org, Jacopo Mondi <jacopo+renesas@jmondi.org>,
 Harsha.ManjulaMallikarjun@in.bosch.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VXBkYXRlIENNTSBzZXR0aW5ncyBhdCBpbiB0aGUgYXRvbWljIGNvbW1pdCB0YWlsIGhlbHBlciBt
ZXRob2QuClRoZSBDTU0gaXMgdXBkYXRlZCB3aXRoIG5ldyBnYW1tYSB2YWx1ZXMgcHJvdmlkZWQg
dG8gdGhlIGRyaXZlcgppbiB0aGUgR0FNTUFfTFVUIGJsb2IgcHJvcGVydHkuCgpXaGVuIHJlc3Vt
aW5nIGZyb20gc3lzdGVtIHN1c3BlbmQsIHRoZSBEVSBkcml2ZXIgaXMgcmVzcG9uc2libGUgZm9y
CnJlcHJvZ3JhbW1pbmcgYW5kIGVuYWJsaW5nIHRoZSBDTU0gdW5pdCBpZiBpdCB3YXMgaW4gdXNl
IGF0IHRoZSB0aW1lIHRoZQpzeXN0ZW0gZW50ZXJlZCB0aGUgc3VzcGVuZCBzdGF0ZS4gIEZvcmNl
IHRoZSBjb2xvcl9tZ210X2NoYW5nZWQgZmxhZyB0bwp0cnVlIGlmIHRoZSBEUk0gZ2FtbWEgbHV0
IGNvbG9yIHRyYW5zZm9ybWF0aW9uIHByb3BlcnR5IHdhcyBzZXQgaW4gdGhlCkNSVEMgc3RhdGUg
ZHVwbGljYXRlZCBhdCBzdXNwZW5kIHRpbWUsIGFzIHRoZSBDTU0gZ2V0cyByZXByb2dyYW1tZWQg
b25seQppZiBzYWlkIGZsYWcgaXMgYWN0aXZlIGluIHRoZSByY2FyX2R1X2F0b21pY19jb21taXRf
dXBkYXRlX2NtbSgpIG1ldGhvZC4KClJldmlld2VkLWJ5OiBVbHJpY2ggSGVjaHQgPHVsaStyZW5l
c2FzQGZwb25kLmV1PgpSZXZpZXdlZC1ieTogTGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5j
aGFydEBpZGVhc29uYm9hcmQuY29tPgpTaWduZWQtb2ZmLWJ5OiBKYWNvcG8gTW9uZGkgPGphY29w
bytyZW5lc2FzQGptb25kaS5vcmc+Ci0tLQoKRGFuaWVsIGNvdWxkIHlvdSBoYXZlIGEgbG9vayBp
ZiByZXN1bWUgYml0cyBhcmUgd29ydGggYmVpbmcgbW92ZWQgdG8gdGhlCkRSTSBjb3JlPyBUaGUg
Y29sb3JfbWdtdF9jaGFuZ2VkIGZsYWcgaXMgc2V0IHRvIGZhbHNlIHdoZW4gdGhlIHN0YXRlIGlz
CmR1cGxpY2F0ZWQgaWYgSSByZWFkIHRoZSBjb2RlIGNvcnJlY3RseSwgYnV0IHdoZW4gdGhpcyBo
YXBwZW5zIGluIGEKc3VzcGVuZC9yZXN1bWUgc2VxdWVuY2UgaXRzIHZhbHVlIHNob3VsZCBwcm9i
YWJseSBiZSByZXN0b3JlZCB0byB0cnVlIGlmCmFueSBjb2xvciBtYW5hZ2VtZW50IHByb3BlcnR5
IHdhcyBzZXQgaW4gdGhlIGNydGMgc3RhdGUgd2hlbiBzeXN0ZW0gZW50ZXJlZApzdXNwZW5kLgoK
LS0tCgogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9kcnYuYyB8IDIwICsrKysrKysr
KysrKysrCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jIHwgMzggKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiAyIGZpbGVzIGNoYW5nZWQsIDU4IGluc2VydGlvbnMoKykK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2Rydi5jIGIvZHJp
dmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9kcnYuYwppbmRleCAwMTg0ODBhOGYzNWMuLmQx
MDAzZDMxY2ZhZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9k
cnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2Rydi5jCkBAIC0xNyw2
ICsxNyw3IEBACiAjaW5jbHVkZSA8bGludXgvc2xhYi5oPgogI2luY2x1ZGUgPGxpbnV4L3dhaXQu
aD4KCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21p
Y19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2ZiX2NtYV9oZWxwZXIuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX2ZiX2hlbHBlci5oPgpAQCAtNDgyLDYgKzQ4MywyNSBAQCBzdGF0aWMgaW50IHJj
YXJfZHVfcG1fc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpCiBzdGF0aWMgaW50IHJjYXJfZHVf
cG1fcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKIHsKIAlzdHJ1Y3QgcmNhcl9kdV9kZXZpY2Ug
KnJjZHUgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUgPSByY2R1LT5kZGV2LT5tb2RlX2NvbmZpZy5zdXNwZW5kX3N0YXRlOworCXVuc2lnbmVk
IGludCBpOworCisJZm9yIChpID0gMDsgaSA8IHJjZHUtPm51bV9jcnRjczsgKytpKSB7CisJCXN0
cnVjdCBkcm1fY3J0YyAqY3J0YyA9ICZyY2R1LT5jcnRjc1tpXS5jcnRjOworCQlzdHJ1Y3QgZHJt
X2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisKKwkJY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0
X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwkJaWYgKCFjcnRjX3N0YXRlKQorCQkJY29u
dGludWU7CisKKwkJLyoKKwkJICogRm9yY2UgcmUtZW5hYmxlbWVudCBvZiBDTU0gYWZ0ZXIgc3lz
dGVtIHJlc3VtZSBpZiBhbnkKKwkJICogb2YgdGhlIERSTSBjb2xvciB0cmFuc2Zvcm1hdGlvbiBw
cm9wZXJ0aWVzIHdhcyBzZXQgaW4KKwkJICogdGhlIHN0YXRlIHNhdmVkIGF0IHN5c3RlbSBzdXNw
ZW5kIHRpbWUuCisJCSAqLworCQlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbHV0KQorCQkJY3J0Y19z
dGF0ZS0+Y29sb3JfbWdtdF9jaGFuZ2VkID0gdHJ1ZTsKKwl9CgogCXJldHVybiBkcm1fbW9kZV9j
b25maWdfaGVscGVyX3Jlc3VtZShyY2R1LT5kZGV2KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9y
Y2FyX2R1X2ttcy5jCmluZGV4IDI5NDYzMGU1Njk5Mi4uZmMzMGZmZjBlYjhkIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMKQEAgLTIyLDYgKzIyLDcgQEAKICNpbmNsdWRlIDxs
aW51eC9vZl9wbGF0Zm9ybS5oPgogI2luY2x1ZGUgPGxpbnV4L3dhaXQuaD4KCisjaW5jbHVkZSAi
cmNhcl9jbW0uaCIKICNpbmNsdWRlICJyY2FyX2R1X2NydGMuaCIKICNpbmNsdWRlICJyY2FyX2R1
X2Rydi5oIgogI2luY2x1ZGUgInJjYXJfZHVfZW5jb2Rlci5oIgpAQCAtMzY4LDYgKzM2OSw0MCBA
QCByY2FyX2R1X2ZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdiwKICAqIEF0b21pYyBDaGVjayBhbmQgVXBkYXRlCiAgKi8KCitzdGF0aWMg
dm9pZCByY2FyX2R1X2F0b21pY19jb21taXRfdXBkYXRlX2NtbShzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCisJCQkJCSAgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3Ry
dWN0IHJjYXJfZHVfY3J0YyAqcmNydGMgPSB0b19yY2FyX2NydGMoY3J0Yyk7CisJc3RydWN0IHJj
YXJfY21tX2NvbmZpZyBjbW1fY29uZmlnID0ge307CisJc3RydWN0IGRldmljZSAqZGV2ID0gcmNy
dGMtPmRldi0+ZGV2OworCXN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqbHV0X2Jsb2I7CisKKwlp
ZiAoIXJjcnRjLT5jbW0gfHwgIWNydGMtPnN0YXRlLT5jb2xvcl9tZ210X2NoYW5nZWQpCisJCXJl
dHVybjsKKworCWlmICghY3J0Yy0+c3RhdGUtPmdhbW1hX2x1dCkgeworCQljbW1fY29uZmlnLmx1
dC5lbmFibGUgPSBmYWxzZTsKKwkJcmNhcl9jbW1fc2V0dXAocmNydGMtPmNtbSwgJmNtbV9jb25m
aWcpOworCQlyZXR1cm47CisJfQorCisJbHV0X2Jsb2IgPSBjcnRjLT5zdGF0ZS0+Z2FtbWFfbHV0
OworCWlmIChsdXRfYmxvYi0+bGVuZ3RoICE9IChDTTJfTFVUX1NJWkUgKiBzaXplb2Yoc3RydWN0
IGRybV9jb2xvcl9sdXQpKSkgeworCQkvKgorCQkgKiBXZSBvbmx5IGFjY2VwdCBmdWxseSBwb3B1
bGF0ZWQgTFVUIHRhYmxlczsKKwkJICogYmUgbG91ZCBoZXJlLCBvdGhlcndpc2UgdGhlIENNTSBn
ZXRzIHNpbGVudGx5IGlnbm9yZWQuCisJCSAqLworCQlkZXZfZXJyKGRldiwgImludmFsaWQgZ2Ft
bWEgbHV0IHNpemUgb2YgJWx1IGJ5dGVzXG4iLAorCQkJbHV0X2Jsb2ItPmxlbmd0aCk7CisJCXJl
dHVybjsKKwl9CisKKwljbW1fY29uZmlnLmx1dC5lbmFibGUgPSB0cnVlOworCWNtbV9jb25maWcu
bHV0LnRhYmxlID0gKHN0cnVjdCBkcm1fY29sb3JfbHV0ICopbHV0X2Jsb2ItPmRhdGE7CisKKwly
Y2FyX2NtbV9zZXR1cChyY3J0Yy0+Y21tLCAmY21tX2NvbmZpZyk7Cit9CisKIHN0YXRpYyBpbnQg
cmNhcl9kdV9hdG9taWNfY2hlY2soc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQlzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBAIC00MTAsNiArNDQ1LDkgQEAgc3RhdGljIHZv
aWQgcmNhcl9kdV9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9s
ZF9zdGF0ZSkKIAkJCXJjZHUtPmRwYWQxX3NvdXJjZSA9IHJjcnRjLT5pbmRleDsKIAl9CgorCWZv
cl9lYWNoX29sZF9jcnRjX2luX3N0YXRlKG9sZF9zdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkK
KwkJcmNhcl9kdV9hdG9taWNfY29tbWl0X3VwZGF0ZV9jbW0oY3J0YywgY3J0Y19zdGF0ZSk7CisK
IAkvKiBBcHBseSB0aGUgYXRvbWljIHVwZGF0ZS4gKi8KIAlkcm1fYXRvbWljX2hlbHBlcl9jb21t
aXRfbW9kZXNldF9kaXNhYmxlcyhkZXYsIG9sZF9zdGF0ZSk7CiAJZHJtX2F0b21pY19oZWxwZXJf
Y29tbWl0X3BsYW5lcyhkZXYsIG9sZF9zdGF0ZSwKLS0KMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
