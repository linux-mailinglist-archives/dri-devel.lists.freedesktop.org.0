Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D2A9F34C7A
	for <lists+dri-devel@lfdr.de>; Tue,  4 Jun 2019 17:42:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3325C89A57;
	Tue,  4 Jun 2019 15:42:12 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5DEF389A75
 for <dri-devel@lists.freedesktop.org>; Tue,  4 Jun 2019 15:42:09 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 33808AF70;
 Tue,  4 Jun 2019 15:42:07 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: kraxel@redhat.com, airlied@redhat.com, daniel@ffwll.ch,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, sam@ravnborg.org, christian.koenig@amd.com
Subject: [PATCH 7/8] drm: Remove lock interfaces from GEM VRAM helpers
Date: Tue,  4 Jun 2019 17:42:00 +0200
Message-Id: <20190604154201.14460-8-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190604154201.14460-1-tzimmermann@suse.de>
References: <20190604154201.14460-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGxvY2sgZnVuY3Rpb25zIGFuZCB0aGUgbG9ja2VkLXBpbi91bnBpbiBmdW5jdGlvbnMgb2Yg
R0VNIFZSQU0gYXJlIG5vdApyZXF1cmllZCBhbnkgbG9uZ2VyLiBSZW1vdmUgdGhlbS4KClNpZ25l
ZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgfCAxMDkgLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIGluY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaCAgICAgfCAgIDUg
LS0KIDIgZmlsZXMgY2hhbmdlZCwgMTE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dl
bV92cmFtX2hlbHBlci5jCmluZGV4IDQyYWQ4MDg4OGRmNy4uM2RmY2NkYjc0NGRhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMKQEAgLTE1MSwzNiArMTUxLDYgQEAgdm9pZCBk
cm1fZ2VtX3ZyYW1fcHV0KHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8pCiB9CiBFWFBP
UlRfU1lNQk9MKGRybV9nZW1fdnJhbV9wdXQpOwogCi0vKioKLSAqIGRybV9nZW1fdnJhbV9sb2Nr
KCkgLSBMb2NrcyBhIFZSQU0tYmFja2VkIEdFTSBvYmplY3QKLSAqIEBnYm86CXRoZSBHRU0gVlJB
TSBvYmplY3QKLSAqIEBub193YWl0Oglkb24ndCB3YWl0IGZvciBidWZmZXIgb2JqZWN0IHRvIGJl
Y29tZSBhdmFpbGFibGUKLSAqCi0gKiBTZWUgdHRtX2JvX3Jlc2VydmUoKSBmb3IgbW9yZSBpbmZv
cm1hdGlvbi4KLSAqCi0gKiBSZXR1cm5zOgotICogMCBvbiBzdWNjZXNzLCBvcgotICogYSBuZWdh
dGl2ZSBlcnJvciBjb2RlIG90aGVyd2lzZQotICovCi1pbnQgZHJtX2dlbV92cmFtX2xvY2soc3Ry
dWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibywgYm9vbCBub193YWl0KQotewotCXJldHVybiB0
dG1fYm9fcmVzZXJ2ZSgmZ2JvLT5ibywgdHJ1ZSwgbm9fd2FpdCwgTlVMTCk7Ci19Ci1FWFBPUlRf
U1lNQk9MKGRybV9nZW1fdnJhbV9sb2NrKTsKLQotLyoqCi0gKiBkcm1fZ2VtX3ZyYW1fdW5sb2Nr
KCkgLSBcCi0JUmVsZWFzZSBhIHJlc2VydmF0aW9uIGFjcXVpcmVkIGJ5IGRybV9nZW1fdnJhbV9s
b2NrKCkKLSAqIEBnYm86CXRoZSBHRU0gVlJBTSBvYmplY3QKLSAqCi0gKiBTZWUgdHRtX2JvX3Vu
cmVzZXJ2ZSgpIGZvciBtb3JlIGluZm9ybWF0aW9uLgotICovCi12b2lkIGRybV9nZW1fdnJhbV91
bmxvY2soc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibykKLXsKLQl0dG1fYm9fdW5yZXNl
cnZlKCZnYm8tPmJvKTsKLX0KLUVYUE9SVF9TWU1CT0woZHJtX2dlbV92cmFtX3VubG9jayk7Ci0K
IC8qKgogICogZHJtX2dlbV92cmFtX21tYXBfb2Zmc2V0KCkgLSBSZXR1cm5zIGEgR0VNIFZSQU0g
b2JqZWN0J3MgbW1hcCBvZmZzZXQKICAqIEBnYm86CXRoZSBHRU0gVlJBTSBvYmplY3QKQEAgLTI2
Miw0OSArMjMyLDYgQEAgaW50IGRybV9nZW1fdnJhbV9waW4oc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmdibywgdW5zaWduZWQgbG9uZyBwbF9mbGFnKQogfQogRVhQT1JUX1NZTUJPTChkcm1f
Z2VtX3ZyYW1fcGluKTsKIAotLyoqCi0gKiBkcm1fZ2VtX3ZyYW1fcGluX2xvY2tlZCgpIC0gUGlu
cyBhIEdFTSBWUkFNIG9iamVjdCBpbiBhIHJlZ2lvbi4KLSAqIEBnYm86CXRoZSBHRU0gVlJBTSBv
YmplY3QKLSAqIEBwbF9mbGFnOglhIGJpdG1hc2sgb2YgcG9zc2libGUgbWVtb3J5IHJlZ2lvbnMK
LSAqCi0gKiBQaW5uaW5nIGEgYnVmZmVyIG9iamVjdCBlbnN1cmVzIHRoYXQgaXQgaXMgbm90IGV2
aWN0ZWQgZnJvbQotICogYSBtZW1vcnkgcmVnaW9uLiBBIHBpbm5lZCBidWZmZXIgb2JqZWN0IGhh
cyB0byBiZSB1bnBpbm5lZCBiZWZvcmUKLSAqIGl0IGNhbiBiZSBwaW5uZWQgdG8gYW5vdGhlciBy
ZWdpb24uCi0gKgotICogVGhpcyBmdW5jdGlvbiBwaW5zIGEgR0VNIFZSQU0gb2JqZWN0IHRoYXQg
aGFzIGFscmVhZHkgYmVlbgotICogbG9ja2VkLiBVc2UgZHJtX2dlbV92cmFtX3BpbigpIGlmIHBv
c3NpYmxlLgotICoKLSAqIFJldHVybnM6Ci0gKiAwIG9uIHN1Y2Nlc3MsIG9yCi0gKiBhIG5lZ2F0
aXZlIGVycm9yIGNvZGUgb3RoZXJ3aXNlLgotICovCi1pbnQgZHJtX2dlbV92cmFtX3Bpbl9sb2Nr
ZWQoc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibywKLQkJCSAgICB1bnNpZ25lZCBsb25n
IHBsX2ZsYWcpCi17Ci0JaW50IGksIHJldDsKLQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggY3R4
ID0geyBmYWxzZSwgZmFsc2UgfTsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmdiby0+Ym8ucmVz
di0+bG9jay5iYXNlKTsKLQotCWlmIChnYm8tPnBpbl9jb3VudCkgewotCQkrK2diby0+cGluX2Nv
dW50OwotCQlyZXR1cm4gMDsKLQl9Ci0KLQlkcm1fZ2VtX3ZyYW1fcGxhY2VtZW50KGdibywgcGxf
ZmxhZyk7Ci0JZm9yIChpID0gMDsgaSA8IGdiby0+cGxhY2VtZW50Lm51bV9wbGFjZW1lbnQ7ICsr
aSkKLQkJZ2JvLT5wbGFjZW1lbnRzW2ldLmZsYWdzIHw9IFRUTV9QTF9GTEFHX05PX0VWSUNUOwot
Ci0JcmV0ID0gdHRtX2JvX3ZhbGlkYXRlKCZnYm8tPmJvLCAmZ2JvLT5wbGFjZW1lbnQsICZjdHgp
OwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0OwotCi0JZ2JvLT5waW5fY291bnQgPSAxOwot
Ci0JcmV0dXJuIDA7Ci19Ci1FWFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV9waW5fbG9ja2VkKTsK
LQogLyoqCiAgKiBkcm1fZ2VtX3ZyYW1fdW5waW4oKSAtIFVucGlucyBhIEdFTSBWUkFNIG9iamVj
dAogICogQGdibzoJdGhlIEdFTSBWUkFNIG9iamVjdApAQCAtMzQ3LDQyICsyNzQsNiBAQCBpbnQg
ZHJtX2dlbV92cmFtX3VucGluKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8pCiB9CiBF
WFBPUlRfU1lNQk9MKGRybV9nZW1fdnJhbV91bnBpbik7CiAKLS8qKgotICogZHJtX2dlbV92cmFt
X3VucGluX2xvY2tlZCgpIC0gVW5waW5zIGEgR0VNIFZSQU0gb2JqZWN0Ci0gKiBAZ2JvOgl0aGUg
R0VNIFZSQU0gb2JqZWN0Ci0gKgotICogVGhpcyBmdW5jdGlvbiB1bnBpbnMgYSBHRU0gVlJBTSBv
YmplY3QgdGhhdCBoYXMgYWxyZWFkeSBiZWVuCi0gKiBsb2NrZWQuIFVzZSBkcm1fZ2VtX3ZyYW1f
dW5waW4oKSBpZiBwb3NzaWJsZS4KLSAqCi0gKiBSZXR1cm5zOgotICogMCBvbiBzdWNjZXNzLCBv
cgotICogYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG90aGVyd2lzZS4KLSAqLwotaW50IGRybV9nZW1f
dnJhbV91bnBpbl9sb2NrZWQoc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibykKLXsKLQlp
bnQgaSwgcmV0OwotCXN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCBjdHggPSB7IGZhbHNlLCBmYWxz
ZSB9OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZ2JvLT5iby5yZXN2LT5sb2NrLmJhc2UpOwot
Ci0JaWYgKFdBUk5fT05fT05DRSghZ2JvLT5waW5fY291bnQpKQotCQlyZXR1cm4gMDsKLQotCS0t
Z2JvLT5waW5fY291bnQ7Ci0JaWYgKGdiby0+cGluX2NvdW50KQotCQlyZXR1cm4gMDsKLQotCWZv
ciAoaSA9IDA7IGkgPCBnYm8tPnBsYWNlbWVudC5udW1fcGxhY2VtZW50IDsgKytpKQotCQlnYm8t
PnBsYWNlbWVudHNbaV0uZmxhZ3MgJj0gflRUTV9QTF9GTEFHX05PX0VWSUNUOwotCi0JcmV0ID0g
dHRtX2JvX3ZhbGlkYXRlKCZnYm8tPmJvLCAmZ2JvLT5wbGFjZW1lbnQsICZjdHgpOwotCWlmIChy
ZXQgPCAwKQotCQlyZXR1cm4gcmV0OwotCi0JcmV0dXJuIDA7Ci19Ci1FWFBPUlRfU1lNQk9MKGRy
bV9nZW1fdnJhbV91bnBpbl9sb2NrZWQpOwotCiAvKioKICAqIGRybV9nZW1fdnJhbV9rbWFwX2F0
KCkgLSBNYXBzIGEgR0VNIFZSQU0gb2JqZWN0IGludG8ga2VybmVsIGFkZHJlc3Mgc3BhY2UKICAq
IEBnYm86CXRoZSBHRU0gVlJBTSBvYmplY3QKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9n
ZW1fdnJhbV9oZWxwZXIuaCBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaAppbmRl
eCA0ZDFkMmMxYmYzMmIuLjFkNGFhODdmOGRmYSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJt
X2dlbV92cmFtX2hlbHBlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIu
aApAQCAtNzcsMTUgKzc3LDEwIEBAIHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpkcm1fZ2Vt
X3ZyYW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCQl1bnNpZ25lZCBsb25n
IHBnX2FsaWduLAogCQkJCQkJYm9vbCBpbnRlcnJ1cHRpYmxlKTsKIHZvaWQgZHJtX2dlbV92cmFt
X3B1dChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvKTsKLWludCBkcm1fZ2VtX3ZyYW1f
bG9jayhzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvLCBib29sIG5vX3dhaXQpOwotdm9p
ZCBkcm1fZ2VtX3ZyYW1fdW5sb2NrKHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8pOwog
dTY0IGRybV9nZW1fdnJhbV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAq
Z2JvKTsKIHM2NCBkcm1fZ2VtX3ZyYW1fb2Zmc2V0KHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0
ICpnYm8pOwogaW50IGRybV9nZW1fdnJhbV9waW4oc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3Qg
KmdibywgdW5zaWduZWQgbG9uZyBwbF9mbGFnKTsKLWludCBkcm1fZ2VtX3ZyYW1fcGluX2xvY2tl
ZChzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvLAotCQkJICAgICAgdW5zaWduZWQgbG9u
ZyBwbF9mbGFnKTsKIGludCBkcm1fZ2VtX3ZyYW1fdW5waW4oc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmdibyk7Ci1pbnQgZHJtX2dlbV92cmFtX3VucGluX2xvY2tlZChzdHJ1Y3QgZHJtX2dl
bV92cmFtX29iamVjdCAqZ2JvKTsKIHZvaWQgKmRybV9nZW1fdnJhbV9rbWFwX2F0KHN0cnVjdCBk
cm1fZ2VtX3ZyYW1fb2JqZWN0ICpnYm8sIGJvb2wgbWFwLAogCQkJICAgYm9vbCAqaXNfaW9tZW0s
IHN0cnVjdCB0dG1fYm9fa21hcF9vYmogKmttYXApOwogdm9pZCAqZHJtX2dlbV92cmFtX2ttYXAo
c3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibywgYm9vbCBtYXAsCi0tIAoyLjIxLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBt
YWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
