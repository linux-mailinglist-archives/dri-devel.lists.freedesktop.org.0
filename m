Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F095F51926
	for <lists+dri-devel@lfdr.de>; Mon, 24 Jun 2019 18:54:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A520189D46;
	Mon, 24 Jun 2019 16:54:26 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from netline-mail3.netline.ch (mail.netline.ch [148.251.143.178])
 by gabe.freedesktop.org (Postfix) with ESMTP id 932FB89C6B;
 Mon, 24 Jun 2019 16:54:09 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by netline-mail3.netline.ch (Postfix) with ESMTP id E565F2A6046;
 Mon, 24 Jun 2019 18:54:08 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at netline-mail3.netline.ch
Received: from netline-mail3.netline.ch ([127.0.0.1])
 by localhost (netline-mail3.netline.ch [127.0.0.1]) (amavisd-new, port 10024)
 with LMTP id Q1_ecB8uGsFU; Mon, 24 Jun 2019 18:54:08 +0200 (CEST)
Received: from thor (116.245.63.188.dynamic.wline.res.cust.swisscom.ch
 [188.63.245.116])
 by netline-mail3.netline.ch (Postfix) with ESMTPSA id 494F72A6048;
 Mon, 24 Jun 2019 18:54:07 +0200 (CEST)
Received: from daenzer by thor with local (Exim 4.92)
 (envelope-from <michel@daenzer.net>)
 id 1hfSEI-0003Za-I6; Mon, 24 Jun 2019 18:54:06 +0200
From: =?UTF-8?q?Michel=20D=C3=A4nzer?= <michel@daenzer.net>
To: amd-gfx@lists.freedesktop.org
Subject: [PATCH libdrm 1/9] amdgpu: Pass file descriptor directly to
 amdgpu_close_kms_handle
Date: Mon, 24 Jun 2019 18:53:58 +0200
Message-Id: <20190624165406.13682-2-michel@daenzer.net>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190624165406.13682-1-michel@daenzer.net>
References: <20190624165406.13682-1-michel@daenzer.net>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Emil Velikov <emil.l.velikov@gmail.com>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTWljaGVsIETDpG56ZXIgPG1pY2hlbC5kYWVuemVyQGFtZC5jb20+CgpBbmQgcHJvcGFn
YXRlIGRybUlvY3RsJ3MgcmV0dXJuIHZhbHVlLgoKVGhpcyBhbGxvd3MgcmVwbGFjaW5nIGFsbCBy
ZW1haW5pbmcgb3Blbi1jb2RlZCBEUk1fSU9DVExfR0VNX0NMT1NFCmlvY3RsIGNhbGxzIHdpdGgg
YW1kZ3B1X2Nsb3NlX2ttc19oYW5kbGUgY2FsbHMuCgpTaWduZWQtb2ZmLWJ5OiBNaWNoZWwgRMOk
bnplciA8bWljaGVsLmRhZW56ZXJAYW1kLmNvbT4KLS0tCiBhbWRncHUvYW1kZ3B1X2JvLmMgfCAz
NSArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE1
IGluc2VydGlvbnMoKyksIDIwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2FtZGdwdS9hbWRn
cHVfYm8uYyBiL2FtZGdwdS9hbWRncHVfYm8uYwppbmRleCAzMmVlMzU4Zi4uNmMwYjg1MTcgMTAw
NjQ0Ci0tLSBhL2FtZGdwdS9hbWRncHVfYm8uYworKysgYi9hbWRncHUvYW1kZ3B1X2JvLmMKQEAg
LTM5LDEzICszOSwxMiBAQAogI2luY2x1ZGUgImFtZGdwdV9pbnRlcm5hbC5oIgogI2luY2x1ZGUg
InV0aWxfbWF0aC5oIgogCi1zdGF0aWMgdm9pZCBhbWRncHVfY2xvc2Vfa21zX2hhbmRsZShhbWRn
cHVfZGV2aWNlX2hhbmRsZSBkZXYsCi0JCQkJICAgICB1aW50MzJfdCBoYW5kbGUpCitzdGF0aWMg
aW50IGFtZGdwdV9jbG9zZV9rbXNfaGFuZGxlKGludCBmZCwgdWludDMyX3QgaGFuZGxlKQogewog
CXN0cnVjdCBkcm1fZ2VtX2Nsb3NlIGFyZ3MgPSB7fTsKIAogCWFyZ3MuaGFuZGxlID0gaGFuZGxl
OwotCWRybUlvY3RsKGRldi0+ZmQsIERSTV9JT0NUTF9HRU1fQ0xPU0UsICZhcmdzKTsKKwlyZXR1
cm4gZHJtSW9jdGwoZmQsIERSTV9JT0NUTF9HRU1fQ0xPU0UsICZhcmdzKTsKIH0KIAogc3RhdGlj
IGludCBhbWRncHVfYm9fY3JlYXRlKGFtZGdwdV9kZXZpY2VfaGFuZGxlIGRldiwKQEAgLTkzLDcg
KzkyLDcgQEAgZHJtX3B1YmxpYyBpbnQgYW1kZ3B1X2JvX2FsbG9jKGFtZGdwdV9kZXZpY2VfaGFu
ZGxlIGRldiwKIAlyID0gYW1kZ3B1X2JvX2NyZWF0ZShkZXYsIGFsbG9jX2J1ZmZlci0+YWxsb2Nf
c2l6ZSwgYXJncy5vdXQuaGFuZGxlLAogCQkJICAgICBidWZfaGFuZGxlKTsKIAlpZiAocikgewot
CQlhbWRncHVfY2xvc2Vfa21zX2hhbmRsZShkZXYsIGFyZ3Mub3V0LmhhbmRsZSk7CisJCWFtZGdw
dV9jbG9zZV9rbXNfaGFuZGxlKGRldi0+ZmQsIGFyZ3Mub3V0LmhhbmRsZSk7CiAJCWdvdG8gb3V0
OwogCX0KIApAQCAtMjE0LDExICsyMTMsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19leHBvcnRf
ZmxpbmsoYW1kZ3B1X2JvX2hhbmRsZSBibykKIAogCWJvLT5mbGlua19uYW1lID0gZmxpbmsubmFt
ZTsKIAotCWlmIChiby0+ZGV2LT5mbGlua19mZCAhPSBiby0+ZGV2LT5mZCkgewotCQlzdHJ1Y3Qg
ZHJtX2dlbV9jbG9zZSBhcmdzID0ge307Ci0JCWFyZ3MuaGFuZGxlID0gaGFuZGxlOwotCQlkcm1J
b2N0bChiby0+ZGV2LT5mbGlua19mZCwgRFJNX0lPQ1RMX0dFTV9DTE9TRSwgJmFyZ3MpOwotCX0K
KwlpZiAoYm8tPmRldi0+ZmxpbmtfZmQgIT0gYm8tPmRldi0+ZmQpCisJCWFtZGdwdV9jbG9zZV9r
bXNfaGFuZGxlKGJvLT5kZXYtPmZsaW5rX2ZkLCBoYW5kbGUpOwogCiAJcHRocmVhZF9tdXRleF9s
b2NrKCZiby0+ZGV2LT5ib190YWJsZV9tdXRleCk7CiAJciA9IGhhbmRsZV90YWJsZV9pbnNlcnQo
JmJvLT5kZXYtPmJvX2ZsaW5rX25hbWVzLCBiby0+ZmxpbmtfbmFtZSwgYm8pOwpAQCAtMjYxLDcg
KzI1Nyw2IEBAIGRybV9wdWJsaWMgaW50IGFtZGdwdV9ib19pbXBvcnQoYW1kZ3B1X2RldmljZV9o
YW5kbGUgZGV2LAogCQkgICAgIHN0cnVjdCBhbWRncHVfYm9faW1wb3J0X3Jlc3VsdCAqb3V0cHV0
KQogewogCXN0cnVjdCBkcm1fZ2VtX29wZW4gb3Blbl9hcmcgPSB7fTsKLQlzdHJ1Y3QgZHJtX2dl
bV9jbG9zZSBjbG9zZV9hcmcgPSB7fTsKIAlzdHJ1Y3QgYW1kZ3B1X2JvICpibyA9IE5VTEw7CiAJ
dWludDMyX3QgaGFuZGxlID0gMCwgZmxpbmtfbmFtZSA9IDA7CiAJdWludDY0X3QgYWxsb2Nfc2l6
ZSA9IDA7CkBAIC0zNDUsMTIgKzM0MCwxMiBAQCBkcm1fcHVibGljIGludCBhbWRncHVfYm9faW1w
b3J0KGFtZGdwdV9kZXZpY2VfaGFuZGxlIGRldiwKIAkJCWNsb3NlKGRtYV9mZCk7CiAJCQlpZiAo
cikKIAkJCQlnb3RvIGZyZWVfYm9faGFuZGxlOwotCQkJY2xvc2VfYXJnLmhhbmRsZSA9IG9wZW5f
YXJnLmhhbmRsZTsKLQkJCXIgPSBkcm1Jb2N0bChkZXYtPmZsaW5rX2ZkLCBEUk1fSU9DVExfR0VN
X0NMT1NFLAotCQkJCSAgICAgJmNsb3NlX2FyZyk7CisJCQlyID0gYW1kZ3B1X2Nsb3NlX2ttc19o
YW5kbGUoZGV2LT5mbGlua19mZCwKKwkJCQkJCSAgICBvcGVuX2FyZy5oYW5kbGUpOwogCQkJaWYg
KHIpCiAJCQkJZ290byBmcmVlX2JvX2hhbmRsZTsKIAkJfQorCQlvcGVuX2FyZy5oYW5kbGUgPSAw
OwogCQlicmVhazsKIAogCWNhc2UgYW1kZ3B1X2JvX2hhbmRsZV90eXBlX2RtYV9idWZfZmQ6CkBA
IC0zODgsMTQgKzM4MywxMyBAQCBkcm1fcHVibGljIGludCBhbWRncHVfYm9faW1wb3J0KGFtZGdw
dV9kZXZpY2VfaGFuZGxlIGRldiwKIHJlbW92ZV9oYW5kbGU6CiAJaGFuZGxlX3RhYmxlX3JlbW92
ZSgmZGV2LT5ib19oYW5kbGVzLCBiby0+aGFuZGxlKTsKIGZyZWVfYm9faGFuZGxlOgotCWlmIChm
bGlua19uYW1lICYmICFjbG9zZV9hcmcuaGFuZGxlICYmIG9wZW5fYXJnLmhhbmRsZSkgewotCQlj
bG9zZV9hcmcuaGFuZGxlID0gb3Blbl9hcmcuaGFuZGxlOwotCQlkcm1Jb2N0bChkZXYtPmZsaW5r
X2ZkLCBEUk1fSU9DVExfR0VNX0NMT1NFLCAmY2xvc2VfYXJnKTsKLQl9CisJaWYgKGZsaW5rX25h
bWUgJiYgb3Blbl9hcmcuaGFuZGxlKQorCQlhbWRncHVfY2xvc2Vfa21zX2hhbmRsZShkZXYtPmZs
aW5rX2ZkLCBvcGVuX2FyZy5oYW5kbGUpOworCiAJaWYgKGJvKQogCQlhbWRncHVfYm9fZnJlZShi
byk7CiAJZWxzZQotCQlhbWRncHVfY2xvc2Vfa21zX2hhbmRsZShkZXYsIGhhbmRsZSk7CisJCWFt
ZGdwdV9jbG9zZV9rbXNfaGFuZGxlKGRldi0+ZmQsIGhhbmRsZSk7CiB1bmxvY2s6CiAJcHRocmVh
ZF9tdXRleF91bmxvY2soJmRldi0+Ym9fdGFibGVfbXV0ZXgpOwogCXJldHVybiByOwpAQCAtNDI0
LDEyICs0MTgsMTMgQEAgZHJtX3B1YmxpYyBpbnQgYW1kZ3B1X2JvX2ZyZWUoYW1kZ3B1X2JvX2hh
bmRsZSBidWZfaGFuZGxlKQogCQkJYW1kZ3B1X2JvX2NwdV91bm1hcChibyk7CiAJCX0KIAotCQlh
bWRncHVfY2xvc2Vfa21zX2hhbmRsZShkZXYsIGJvLT5oYW5kbGUpOworCQlhbWRncHVfY2xvc2Vf
a21zX2hhbmRsZShkZXYtPmZkLCBiby0+aGFuZGxlKTsKIAkJcHRocmVhZF9tdXRleF9kZXN0cm95
KCZiby0+Y3B1X2FjY2Vzc19tdXRleCk7CiAJCWZyZWUoYm8pOwogCX0KIAogCXB0aHJlYWRfbXV0
ZXhfdW5sb2NrKCZkZXYtPmJvX3RhYmxlX211dGV4KTsKKwogCXJldHVybiAwOwogfQogCkBAIC02
MDQsNyArNTk5LDcgQEAgZHJtX3B1YmxpYyBpbnQgYW1kZ3B1X2NyZWF0ZV9ib19mcm9tX3VzZXJf
bWVtKGFtZGdwdV9kZXZpY2VfaGFuZGxlIGRldiwKIAogCXIgPSBhbWRncHVfYm9fY3JlYXRlKGRl
diwgc2l6ZSwgYXJncy5oYW5kbGUsIGJ1Zl9oYW5kbGUpOwogCWlmIChyKSB7Ci0JCWFtZGdwdV9j
bG9zZV9rbXNfaGFuZGxlKGRldiwgYXJncy5oYW5kbGUpOworCQlhbWRncHVfY2xvc2Vfa21zX2hh
bmRsZShkZXYtPmZkLCBhcmdzLmhhbmRsZSk7CiAJCWdvdG8gb3V0OwogCX0KIAotLSAKMi4yMC4x
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2
ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
