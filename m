Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A58D9429E3
	for <lists+dri-devel@lfdr.de>; Wed, 12 Jun 2019 16:50:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 45F13895D7;
	Wed, 12 Jun 2019 14:50:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qk1-x744.google.com (mail-qk1-x744.google.com
 [IPv6:2607:f8b0:4864:20::744])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D4FF2895D7
 for <dri-devel@lists.freedesktop.org>; Wed, 12 Jun 2019 14:50:29 +0000 (UTC)
Received: by mail-qk1-x744.google.com with SMTP id d15so10442164qkl.4
 for <dri-devel@lists.freedesktop.org>; Wed, 12 Jun 2019 07:50:29 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=l3Xw71eXyNfUXLWDz85MEfcMok5EBgeKKqagVpmirac=;
 b=sJjoK5jXTYJqWrgFVBwccqjxSJZyBNYxGaLQTXVVjDilpazQqyNe1ZT+yi5+OhjiHQ
 RACBOU6vfsHqWTU/wUVPOa/naHCBJqwn4v9NZRmlFFwgJ+Hb2LUnZBbfPz9df4hR8mjG
 6xg2KiCIUPdeEC0H8yIYfT3wnFY7WRHjBasqhIncAyF0R6J11WPzu5/KGxEkCsFFAO7w
 Lo7zyIG3pJHBFcbhsuRCW73xutXCmJdSldJ+Gy10St7/14UNqfy2RG39yhRu0qH11t1Y
 WGamVRuczDTgPR7iquZUeCPKwtzR/6qCvkC/ui3ek7N0fKs5sWDQ0JMa6wQkRZt8+W4e
 w4Yw==
X-Gm-Message-State: APjAAAVkyV0mgNe3F1UqRkOcHeARNAII7k5/Zv1GwujUiJ8yZEqF1p4x
 WdPdWOYmM+w34WlSbuMRnasROTGjoLU=
X-Google-Smtp-Source: APXvYqwJEa1P18z97evW/KtZYP3M5eIefis58GkK9pJwoHYHDTLpaAYxeiwaK38w7B/NpYH8SH+Z2w==
X-Received: by 2002:a37:482:: with SMTP id 124mr8075081qke.1.1560351028459;
 Wed, 12 Jun 2019 07:50:28 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id v186sm8766862qkc.36.2019.06.12.07.50.27
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Wed, 12 Jun 2019 07:50:27 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v6] drm: Add helpers to kick off self refresh mode in drivers
Date: Wed, 12 Jun 2019 10:50:19 -0400
Message-Id: <20190612145026.191846-1-sean@poorly.run>
X-Mailer: git-send-email 2.22.0.rc2.383.gf4fbbf30c2-goog
In-Reply-To: <20190611205645.GB18315@ravnborg.org>
References: <20190611205645.GB18315@ravnborg.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=l3Xw71eXyNfUXLWDz85MEfcMok5EBgeKKqagVpmirac=;
 b=DZBmEmAOAY4NYqRqNjZnOi3bHjjtRMnYOH6I3A1z+9qyBI0GUXuTL2o6mluPZ+PpLb
 RC3vuPeDKeRuNI6UXlhuiBqyyMtRGhnVRBf8oyjXfzVArvTM31jChpnv8sfYR1r0Yb8v
 3b94dqDph0CHK+ewQdZDki38wsKQHNDmP3wfyLrkpKevaLniJ0A3DHR3DVBaXJn74KsB
 +3EIT9R3LhVp455reofxOE8T2lacCECSvEN6GLmppQi7qdPB6VINEKhQFzzQnc29DJLb
 VIfECKQktDA24PQw2Ye/+Ai5YgXDGgES3kJWCTSXi0SHkGckION+PS6I52XURmFOM4kN
 NmCA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Zain Wang <wzz@rock-chips.com>, Jonathan Corbet <corbet@lwn.net>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>,
 linux-doc@vger.kernel.org, Jose Souza <jose.souza@intel.com>,
 Tomasz Figa <tfiga@chromium.org>, David Airlie <airlied@linux.ie>,
 Sean Paul <seanpaul@chromium.org>, Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGlzIHBhdGNoIGFkZHMg
YSBuZXcgZHJtIGhlbHBlciBsaWJyYXJ5IHRvIGhlbHAgZHJpdmVycyBpbXBsZW1lbnQKc2VsZiBy
ZWZyZXNoLiBEcml2ZXJzIGNob29zaW5nIHRvIHVzZSBpdCB3aWxsIHJlZ2lzdGVyIGNydGNzIGFu
ZAp3aWxsIHJlY2VpdmUgY2FsbGJhY2tzIHdoZW4gaXQncyB0aW1lIHRvIGVudGVyIG9yIGV4aXQg
c2VsZiByZWZyZXNoCm1vZGUuCgpJbiBpdHMgY3VycmVudCBmb3JtLCBpdCBoYXMgYSB0aW1lciB3
aGljaCB3aWxsIHRyaWdnZXIgYWZ0ZXIgYQpkcml2ZXItc3BlY2lmaWVkIGFtb3VudCBvZiBpbmFj
dGl2aXR5LiBXaGVuIHRoZSB0aW1lciB0cmlnZ2VycywgdGhlCmhlbHBlcnMgd2lsbCBzdWJtaXQg
YSBuZXcgYXRvbWljIGNvbW1pdCB0byBzaHV0IHRoZSByZWZyZXNoaW5nIHBpcGUKb2ZmLiBPbiB0
aGUgbmV4dCBhdG9taWMgY29tbWl0LCB0aGUgZHJtIGNvcmUgd2lsbCByZXZlcnQgdGhlIHNlbGYK
cmVmcmVzaCBzdGF0ZSBhbmQgYnJpbmcgZXZlcnl0aGluZyBiYWNrIHVwIHRvIGJlIGFjdGl2ZWx5
IGRyaXZlbi4KCkZyb20gdGhlIGRyaXZlcidzIHBlcnNwZWN0aXZlLCB0aGlzIHdvcmtzIGxpa2Ug
YSByZWd1bGFyIGRpc2FibGUvZW5hYmxlCmN5Y2xlLiBUaGUgZHJpdmVyIG5lZWQgb25seSBjaGVj
ayB0aGUgJ3NlbGZfcmVmcmVzaF9hY3RpdmUnIHN0YXRlIGluCmNydGNfc3RhdGUuIEl0IHNob3Vs
ZCBpbml0aWF0ZSBzZWxmIHJlZnJlc2ggbW9kZSBvbiB0aGUgcGFuZWwgYW5kIGVudGVyCmFuIG9m
ZiBvciBsb3ctcG93ZXIgc3RhdGUuCgpDaGFuZ2VzIGluIHYyOgotIHMvcHNyL3NlbGZfcmVmcmVz
aC8gKERhbmllbCkKLSBpbnRlZ3JhdGVkIHRoZSBwc3IgZXhpdCBpbnRvIHRoZSBjb21taXQgdGhh
dCB3YWtlcyBpdCB1cCAoSm9zZS9EYW5pZWwpCi0gbWFkZSB0aGUgcHNyIHN0YXRlIHBlci1jcnRj
IChKb3NlL0RhbmllbCkKQ2hhbmdlcyBpbiB2MzoKLSBSZW1vdmUgdGhlIHNlbGZfcmVmcmVzaF8o
YWN0aXZlfGNoYW5nZWQpIGZyb20gY29ubmVjdG9yIHN0YXRlIChEYW5pZWwpCi0gU2ltcGxpZnkg
bG9vcCBpbiBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZSAoRGFuaWVsKQotIElt
cHJvdmUgc2VsZl9yZWZyZXNoX2F3YXJlIGNvbW1lbnQgKERhbmllbCkKLSBzL3NlbGZfcmVmcmVz
aF9zdGF0ZS9zZWxmX3JlZnJlc2hfZGF0YS8gKERhbmllbCkKQ2hhbmdlcyBpbiB2NDoKLSBNb3Zl
IGRvY2Jvb2sgbG9jYXRpb24gYmVsb3cgcGFuZWwgKERhbmllbCkKLSBJbXByb3ZlIGRvY2Jvb2sg
d2l0aCByZWZlcmVuY2VzIGFuZCBtb3JlIGRldGFpbGVkIGV4cGxhbmF0aW9uIChEYW5pZWwpCi0g
SW5zdGVhZCBvZiByZWdpc3Rlci91bnJlZ2lzdGVyLCB1c2UgaW5pdC9jbGVhbnVwIChEYW5pZWwp
CkNoYW5nZXMgaW4gdjU6Ci0gUmVzb2x2ZWQgY29uZmxpY3QgaW4gZHJtX2F0b21pY19oZWxwZXIu
YyAjaW5jbHVkZSBibG9jawotIFJlc29sdmVkIGNvbmZsaWN0IGluIHJzdCB3aXRoIEhEQ1AgaGVs
cGVyIGRvY3MKQ2hhbmdlcyBpbiB2NjoKLSBGaXggaW5jbHVkZSBvcmRlcmluZywgY2xlYW4gdXAg
Zm9yd2FyZCBkZWNsYXJhdGlvbnMgKFNhbSkKCkxpbmsgdG8gdjE6IGh0dHBzOi8vcGF0Y2h3b3Jr
LmZyZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MDIyODIxMDkzOS44MzM4Ni0yLXNlYW5A
cG9vcmx5LnJ1bgpMaW5rIHRvIHYyOiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3RvcC5vcmcv
cGF0Y2gvbXNnaWQvMjAxOTAzMjYyMDQ1MDkuOTY1MTUtMS1zZWFuQHBvb3JseS5ydW4KTGluayB0
byB2MzogaHR0cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMTkw
NTAyMTk0OTU2LjIxODQ0MS02LXNlYW5AcG9vcmx5LnJ1bgpMaW5rIHRvIHY0OiBodHRwczovL3Bh
dGNod29yay5mcmVlZGVza3RvcC5vcmcvcGF0Y2gvbXNnaWQvMjAxOTA1MDgxNjA5MjAuMTQ0NzM5
LTYtc2VhbkBwb29ybHkucnVuCkxpbmsgdG8gdjU6IGh0dHBzOi8vcGF0Y2h3b3JrLmZyZWVkZXNr
dG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MDYxMTE2MDg0NC4yNTc0OTgtNi1zZWFuQHBvb3JseS5y
dW4KCkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBKb3NlIFNvdXphIDxq
b3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IFphaW4gV2FuZyA8d3p6QHJvY2stY2hpcHMuY29tPgpD
YzogVG9tYXN6IEZpZ2EgPHRmaWdhQGNocm9taXVtLm9yZz4KQ2M6IFZpbGxlIFN5cmrDpGzDpCA8
dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBTYW0gUmF2bmJvcmcgPHNhbUByYXZu
Ym9yZy5vcmc+ClRlc3RlZC1ieTogSGVpa28gU3R1ZWJuZXIgPGhlaWtvQHNudGVjaC5kZT4KUmV2
aWV3ZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbEBmZndsbC5jaD4KU2lnbmVkLW9mZi1ieTog
U2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+Ci0tLQogRG9jdW1lbnRhdGlvbi9ncHUv
ZHJtLWttcy1oZWxwZXJzLnJzdCAgICAgfCAgIDkgKwogZHJpdmVycy9ncHUvZHJtL01ha2VmaWxl
ICAgICAgICAgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMg
ICAgICAgICAgICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5j
ICAgICAgIHwgIDM1ICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBl
ci5jIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGkuYyAgICAgICAgIHwg
ICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuYyB8IDIxNiAr
KysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2RybS9kcm1fYXRvbWljLmggICAgICAgICAg
ICAgICAgICB8ICAxNSArKwogaW5jbHVkZS9kcm0vZHJtX2Nvbm5lY3Rvci5oICAgICAgICAgICAg
ICAgfCAgMTQgKysKIGluY2x1ZGUvZHJtL2RybV9jcnRjLmggICAgICAgICAgICAgICAgICAgIHwg
IDE5ICsrCiBpbmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oICAgICB8ICAyMCAr
KwogMTEgZmlsZXMgY2hhbmdlZCwgMzM4IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVy
LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBl
ci5oCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLWttcy1oZWxwZXJzLnJzdCBi
L0RvY3VtZW50YXRpb24vZ3B1L2RybS1rbXMtaGVscGVycy5yc3QKaW5kZXggMGZlNzI2YTZlZTY3
OC4uYjMyN2JiYzExMTgyMSAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLWttcy1o
ZWxwZXJzLnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL2dwdS9kcm0ta21zLWhlbHBlcnMucnN0CkBA
IC0xODEsNiArMTgxLDE1IEBAIFBhbmVsIEhlbHBlciBSZWZlcmVuY2UKIC4uIGtlcm5lbC1kb2M6
OiBkcml2ZXJzL2dwdS9kcm0vZHJtX3BhbmVsX29yaWVudGF0aW9uX3F1aXJrcy5jCiAgICA6ZXhw
b3J0OgogCitQYW5lbCBTZWxmIFJlZnJlc2ggSGVscGVyIFJlZmVyZW5jZQorPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT0KKworLi4ga2VybmVsLWRvYzo6IGRyaXZlcnMvZ3B1L2Ry
bS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5jCisgICA6ZG9jOiBvdmVydmlldworCisuLiBrZXJu
ZWwtZG9jOjogZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMKKyAgIDpl
eHBvcnQ6CisKIEhEQ1AgSGVscGVyIEZ1bmN0aW9ucyBSZWZlcmVuY2UKID09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxl
IGIvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlCmluZGV4IGQzNmZlYjRhNjIzMzAuLjlkNjMwYTI4
YTc4ODAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQorKysgYi9kcml2ZXJz
L2dwdS9kcm0vTWFrZWZpbGUKQEAgLTQzLDcgKzQzLDcgQEAgZHJtX2ttc19oZWxwZXIteSA6PSBk
cm1fY3J0Y19oZWxwZXIubyBkcm1fZHBfaGVscGVyLm8gZHJtX2RzYy5vIGRybV9wcm9iZV9oZWxw
ZXIKIAkJZHJtX3NpbXBsZV9rbXNfaGVscGVyLm8gZHJtX21vZGVzZXRfaGVscGVyLm8gXAogCQlk
cm1fc2NkY19oZWxwZXIubyBkcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5vIFwKIAkJZHJtX2F0
b21pY19zdGF0ZV9oZWxwZXIubyBkcm1fZGFtYWdlX2hlbHBlci5vIFwKLQkJZHJtX2Zvcm1hdF9o
ZWxwZXIubworCQlkcm1fZm9ybWF0X2hlbHBlci5vIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyLm8K
IAogZHJtX2ttc19oZWxwZXItJChDT05GSUdfRFJNX1BBTkVMX0JSSURHRSkgKz0gYnJpZGdlL3Bh
bmVsLm8KIGRybV9rbXNfaGVscGVyLSQoQ09ORklHX0RSTV9GQkRFVl9FTVVMQVRJT04pICs9IGRy
bV9mYl9oZWxwZXIubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKaW5kZXggYTRlNzc5ZGVhYjBmYi4uNDE5Mzgx
YWJiZGQxNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCkBAIC0zODQsNiArMzg0LDcgQEAgc3RhdGljIHZv
aWQgZHJtX2F0b21pY19jcnRjX3ByaW50X3N0YXRlKHN0cnVjdCBkcm1fcHJpbnRlciAqcCwKIAlk
cm1fcHJpbnRmKHAsICJjcnRjWyV1XTogJXNcbiIsIGNydGMtPmJhc2UuaWQsIGNydGMtPm5hbWUp
OwogCWRybV9wcmludGYocCwgIlx0ZW5hYmxlPSVkXG4iLCBzdGF0ZS0+ZW5hYmxlKTsKIAlkcm1f
cHJpbnRmKHAsICJcdGFjdGl2ZT0lZFxuIiwgc3RhdGUtPmFjdGl2ZSk7CisJZHJtX3ByaW50Zihw
LCAiXHRzZWxmX3JlZnJlc2hfYWN0aXZlPSVkXG4iLCBzdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2
ZSk7CiAJZHJtX3ByaW50ZihwLCAiXHRwbGFuZXNfY2hhbmdlZD0lZFxuIiwgc3RhdGUtPnBsYW5l
c19jaGFuZ2VkKTsKIAlkcm1fcHJpbnRmKHAsICJcdG1vZGVfY2hhbmdlZD0lZFxuIiwgc3RhdGUt
Pm1vZGVfY2hhbmdlZCk7CiAJZHJtX3ByaW50ZihwLCAiXHRhY3RpdmVfY2hhbmdlZD0lZFxuIiwg
c3RhdGUtPmFjdGl2ZV9jaGFuZ2VkKTsKQEAgLTk5OSw2ICsxMDAwLDcgQEAgc3RhdGljIHZvaWQg
ZHJtX2F0b21pY19jb25uZWN0b3JfcHJpbnRfc3RhdGUoc3RydWN0IGRybV9wcmludGVyICpwLAog
CiAJZHJtX3ByaW50ZihwLCAiY29ubmVjdG9yWyV1XTogJXNcbiIsIGNvbm5lY3Rvci0+YmFzZS5p
ZCwgY29ubmVjdG9yLT5uYW1lKTsKIAlkcm1fcHJpbnRmKHAsICJcdGNydGM9JXNcbiIsIHN0YXRl
LT5jcnRjID8gc3RhdGUtPmNydGMtPm5hbWUgOiAiKG51bGwpIik7CisJZHJtX3ByaW50ZihwLCAi
XHRzZWxmX3JlZnJlc2hfYXdhcmU9JWRcbiIsIHN0YXRlLT5zZWxmX3JlZnJlc2hfYXdhcmUpOwog
CiAJaWYgKGNvbm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX1dS
SVRFQkFDSykKIAkJaWYgKHN0YXRlLT53cml0ZWJhY2tfam9iICYmIHN0YXRlLT53cml0ZWJhY2tf
am9iLT5mYikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5j
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKaW5kZXggZTU4YmU2OTk2MDY5
Mi4uZDllYTdlNTFmZmRjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNf
aGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTM0
LDYgKzM0LDcgQEAKICNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgogI2luY2x1ZGUgPGRybS9k
cm1fcGxhbmVfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUg
PGRybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5r
Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV93cml0ZWJhY2suaD4KIApAQCAtOTUzLDEwICs5NTQsMzMg
QEAgaW50IGRybV9hdG9taWNfaGVscGVyX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
aWYgKHN0YXRlLT5sZWdhY3lfY3Vyc29yX3VwZGF0ZSkKIAkJc3RhdGUtPmFzeW5jX3VwZGF0ZSA9
ICFkcm1fYXRvbWljX2hlbHBlcl9hc3luY19jaGVjayhkZXYsIHN0YXRlKTsKIAorCWRybV9zZWxm
X3JlZnJlc2hfaGVscGVyX2FsdGVyX3N0YXRlKHN0YXRlKTsKKwogCXJldHVybiByZXQ7CiB9CiBF
WFBPUlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2NoZWNrKTsKIAorc3RhdGljIGJvb2wKK2Ny
dGNfbmVlZHNfZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9zdGF0ZSwKKwkJICAg
c3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfc3RhdGUpCit7CisJLyoKKwkgKiBObyBuZXdfc3Rh
dGUgbWVhbnMgdGhlIGNydGMgaXMgb2ZmLCBzbyB0aGUgb25seSBjcml0ZXJpYSBpcyB3aGV0aGVy
CisJICogaXQncyBjdXJyZW50bHkgYWN0aXZlIG9yIGluIHNlbGYgcmVmcmVzaCBtb2RlLgorCSAq
LworCWlmICghbmV3X3N0YXRlKQorCQlyZXR1cm4gZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5
X2FjdGl2ZShvbGRfc3RhdGUpOworCisJLyoKKwkgKiBXZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRo
ZSBjcnRjX2Z1bmNzLT5kaXNhYmxlKCkgZnVuY3Rpb24gaWYgdGhlIGNydGMKKwkgKiBpcyBjdXJy
ZW50bHkgb24sIGlmIGl0J3MgdHJhbnNpdGlvbmluZyB0byBzZWxmIHJlZnJlc2ggbW9kZSwgb3Ig
aWYKKwkgKiBpdCdzIGluIHNlbGYgcmVmcmVzaCBtb2RlIGFuZCBuZWVkcyB0byBiZSBmdWxseSBk
aXNhYmxlZC4KKwkgKi8KKwlyZXR1cm4gb2xkX3N0YXRlLT5hY3RpdmUgfHwKKwkgICAgICAgKG9s
ZF9zdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSAmJiAhbmV3X3N0YXRlLT5lbmFibGUpIHx8CisJ
ICAgICAgIG5ld19zdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZTsKK30KKwogc3RhdGljIHZvaWQK
IGRpc2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqb2xkX3N0YXRlKQogewpAQCAtOTc3LDcgKzEwMDEsMTQgQEAgZGlzYWJsZV9vdXRw
dXRzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRf
c3RhdGUpCiAKIAkJb2xkX2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0
ZShvbGRfc3RhdGUsIG9sZF9jb25uX3N0YXRlLT5jcnRjKTsKIAotCQlpZiAoIW9sZF9jcnRjX3N0
YXRlLT5hY3RpdmUgfHwKKwkJaWYgKG5ld19jb25uX3N0YXRlLT5jcnRjKQorCQkJbmV3X2NydGNf
c3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZSgKKwkJCQkJCW9sZF9zdGF0ZSwK
KwkJCQkJCW5ld19jb25uX3N0YXRlLT5jcnRjKTsKKwkJZWxzZQorCQkJbmV3X2NydGNfc3RhdGUg
PSBOVUxMOworCisJCWlmICghY3J0Y19uZWVkc19kaXNhYmxlKG9sZF9jcnRjX3N0YXRlLCBuZXdf
Y3J0Y19zdGF0ZSkgfHwKIAkJICAgICFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChvbGRf
Y29ubl9zdGF0ZS0+Y3J0Yy0+c3RhdGUpKQogCQkJY29udGludWU7CiAKQEAgLTEwMjMsNyArMTA1
NCw3IEBAIGRpc2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCQlpZiAoIWRybV9hdG9taWNfY3J0Y19uZWVkc19t
b2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmICghb2xkX2NydGNf
c3RhdGUtPmFjdGl2ZSkKKwkJaWYgKCFjcnRjX25lZWRzX2Rpc2FibGUob2xkX2NydGNfc3RhdGUs
IG5ld19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCWZ1bmNzID0gY3J0Yy0+aGVscGVy
X3ByaXZhdGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19zdGF0ZV9o
ZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5jCmluZGV4
IDk3YWIyNjY3OWI5NjkuLjdkNzM0N2E2ZjE5NDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRv
bWljX3N0YXRlX2hlbHBlci5jCkBAIC0xMjksNiArMTI5LDEwIEBAIHZvaWQgX19kcm1fYXRvbWlj
X2hlbHBlcl9jcnRjX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJc3Rh
dGUtPmNvbW1pdCA9IE5VTEw7CiAJc3RhdGUtPmV2ZW50ID0gTlVMTDsKIAlzdGF0ZS0+cGFnZWZs
aXBfZmxhZ3MgPSAwOworCisJLyogU2VsZiByZWZyZXNoIHNob3VsZCBiZSBjYW5jZWxlZCB3aGVu
IGEgbmV3IHVwZGF0ZSBpcyBhdmFpbGFibGUgKi8KKwlzdGF0ZS0+YWN0aXZlID0gZHJtX2F0b21p
Y19jcnRjX2VmZmVjdGl2ZWx5X2FjdGl2ZShzdGF0ZSk7CisJc3RhdGUtPnNlbGZfcmVmcmVzaF9h
Y3RpdmUgPSBmYWxzZTsKIH0KIEVYUE9SVF9TWU1CT0woX19kcm1fYXRvbWljX2hlbHBlcl9jcnRj
X2R1cGxpY2F0ZV9zdGF0ZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRv
bWljX3VhcGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGkuYwppbmRleCBlYjIy
ZThiZGQ4NTMxLi5hYmUzOGJkZjg1YWU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJt
X2F0b21pY191YXBpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfdWFwaS5jCkBA
IC00OTAsNyArNDkwLDcgQEAgZHJtX2F0b21pY19jcnRjX2dldF9wcm9wZXJ0eShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCiAJc3RydWN0IGRybV9tb2RlX2NvbmZpZyAqY29uZmlnID0gJmRldi0+bW9k
ZV9jb25maWc7CiAKIAlpZiAocHJvcGVydHkgPT0gY29uZmlnLT5wcm9wX2FjdGl2ZSkKLQkJKnZh
bCA9IHN0YXRlLT5hY3RpdmU7CisJCSp2YWwgPSBkcm1fYXRvbWljX2NydGNfZWZmZWN0aXZlbHlf
YWN0aXZlKHN0YXRlKTsKIAllbHNlIGlmIChwcm9wZXJ0eSA9PSBjb25maWctPnByb3BfbW9kZV9p
ZCkKIAkJKnZhbCA9IChzdGF0ZS0+bW9kZV9ibG9iKSA/IHN0YXRlLT5tb2RlX2Jsb2ItPmJhc2Uu
aWQgOiAwOwogCWVsc2UgaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+cHJvcF92cnJfZW5hYmxlZCkK
QEAgLTc4OCw3ICs3ODgsMTAgQEAgZHJtX2F0b21pY19jb25uZWN0b3JfZ2V0X3Byb3BlcnR5KHN0
cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+
cHJvcF9jcnRjX2lkKSB7CiAJCSp2YWwgPSAoc3RhdGUtPmNydGMpID8gc3RhdGUtPmNydGMtPmJh
c2UuaWQgOiAwOwogCX0gZWxzZSBpZiAocHJvcGVydHkgPT0gY29uZmlnLT5kcG1zX3Byb3BlcnR5
KSB7Ci0JCSp2YWwgPSBjb25uZWN0b3ItPmRwbXM7CisJCWlmIChzdGF0ZS0+Y3J0YyAmJiBzdGF0
ZS0+Y3J0Yy0+c3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUpCisJCQkqdmFsID0gRFJNX01PREVf
RFBNU19PTjsKKwkJZWxzZQorCQkJKnZhbCA9IGNvbm5lY3Rvci0+ZHBtczsKIAl9IGVsc2UgaWYg
KHByb3BlcnR5ID09IGNvbmZpZy0+dHZfc2VsZWN0X3N1YmNvbm5lY3Rvcl9wcm9wZXJ0eSkgewog
CQkqdmFsID0gc3RhdGUtPnR2LnN1YmNvbm5lY3RvcjsKIAl9IGVsc2UgaWYgKHByb3BlcnR5ID09
IGNvbmZpZy0+dHZfbGVmdF9tYXJnaW5fcHJvcGVydHkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9z
ZWxmX3JlZnJlc2hfaGVscGVyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwMC4uZWJkOTA3YzZkYmI2MwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fc2VsZl9yZWZyZXNoX2hlbHBlci5jCkBAIC0wLDAgKzEsMjE2IEBACisvKiBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IChDKSAyMDE5IEdvb2dsZSwg
SW5jLgorICoKKyAqIEF1dGhvcnM6CisgKiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9y
Zz4KKyAqLworI2luY2x1ZGUgPGxpbnV4L2JpdG9wcy5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIu
aD4KKyNpbmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRv
bWljLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fbW9kZV9jb25maWcuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX21vZGVzZXRfbG9jay5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4K
KyNpbmNsdWRlIDxkcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaD4KKworLyoqCisgKiBET0M6
IG92ZXJ2aWV3CisgKgorICogVGhpcyBoZWxwZXIgbGlicmFyeSBwcm92aWRlcyBhbiBlYXN5IHdh
eSBmb3IgZHJpdmVycyB0byBsZXZlcmFnZSB0aGUgYXRvbWljCisgKiBmcmFtZXdvcmsgdG8gaW1w
bGVtZW50IHBhbmVsIHNlbGYgcmVmcmVzaCAoU1IpIHN1cHBvcnQuIERyaXZlcnMgYXJlCisgKiBy
ZXNwb25zaWJsZSBmb3IgaW5pdGlhbGl6aW5nIGFuZCBjbGVhbmluZyB1cCB0aGUgU1IgaGVscGVy
cyBvbiBsb2FkL3VubG9hZAorICogKHNlZSAmZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfaW5pdC8m
ZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfY2xlYW51cCkuCisgKiBUaGUgY29ubmVjdG9yIGlzIHJl
c3BvbnNpYmxlIGZvciBzZXR0aW5nCisgKiAmZHJtX2Nvbm5lY3Rvcl9zdGF0ZS5zZWxmX3JlZnJl
c2hfYXdhcmUgdG8gdHJ1ZSBhdCBydW50aW1lIGlmIGl0IGlzIFNSLWF3YXJlCisgKiAobWVhbmlu
ZyBpdCBrbm93cyBob3cgdG8gaW5pdGlhdGUgc2VsZiByZWZyZXNoIG9uIHRoZSBwYW5lbCkuCisg
KgorICogT25jZSBhIGNydGMgaGFzIGVuYWJsZWQgU1IgdXNpbmcgJmRybV9zZWxmX3JlZnJlc2hf
aGVscGVyX2luaXQsIHRoZQorICogaGVscGVycyB3aWxsIG1vbml0b3IgYWN0aXZpdHkgYW5kIGNh
bGwgYmFjayBpbnRvIHRoZSBkcml2ZXIgdG8gZW5hYmxlL2Rpc2FibGUKKyAqIFNSIGFzIGFwcHJv
cHJpYXRlLiBUaGUgYmVzdCB3YXkgdG8gdGhpbmsgYWJvdXQgdGhpcyBpcyB0aGF0IGl0J3MgYSBE
UE1TCisgKiBvbi9vZmYgcmVxdWVzdCB3aXRoICZkcm1fY3J0Y19zdGF0ZS5zZWxmX3JlZnJlc2hf
YWN0aXZlIHNldCBpbiBjcnRjIHN0YXRlCisgKiB0aGF0IHRlbGxzIHlvdSB0byBkaXNhYmxlL2Vu
YWJsZSBTUiBvbiB0aGUgcGFuZWwgaW5zdGVhZCBvZiBwb3dlci1jeWNsaW5nIGl0LgorICoKKyAq
IER1cmluZyBTUiwgZHJpdmVycyBtYXkgY2hvb3NlIHRvIGZ1bGx5IGRpc2FibGUgdGhlaXIgY3J0
Yy9lbmNvZGVyL2JyaWRnZQorICogaGFyZHdhcmUgKGluIHdoaWNoIGNhc2Ugbm8gZHJpdmVyIGNo
YW5nZXMgYXJlIG5lY2Vzc2FyeSksIG9yIHRoZXkgY2FuIGluc3BlY3QKKyAqICZkcm1fY3J0Y19z
dGF0ZS5zZWxmX3JlZnJlc2hfYWN0aXZlIGlmIHRoZXkgd2FudCB0byBlbnRlciBsb3cgcG93ZXIg
bW9kZQorICogd2l0aG91dCBmdWxsIGRpc2FibGUgKGluIGNhc2UgZnVsbCBkaXNhYmxlL2VuYWJs
ZSBpcyB0b28gc2xvdykuCisgKgorICogU1Igd2lsbCBiZSBkZWFjdGl2YXRlZCBpZiB0aGVyZSBh
cmUgYW55IGF0b21pYyB1cGRhdGVzIGFmZmVjdGluZyB0aGUKKyAqIHBpcGUgdGhhdCBpcyBpbiBT
UiBtb2RlLiBJZiBhIGNydGMgaXMgZHJpdmluZyBtdWx0aXBsZSBjb25uZWN0b3JzLCBhbGwKKyAq
IGNvbm5lY3RvcnMgbXVzdCBiZSBTUiBhd2FyZSBhbmQgYWxsIHdpbGwgZW50ZXIvZXhpdCBTUiBt
b2RlIGF0IHRoZSBzYW1lIHRpbWUuCisgKgorICogSWYgdGhlIGNydGMgYW5kIGNvbm5lY3RvciBh
cmUgU1IgYXdhcmUsIGJ1dCB0aGUgcGFuZWwgY29ubmVjdGVkIGRvZXMgbm90CisgKiBzdXBwb3J0
IGl0IChvciBpcyBvdGhlcndpc2UgdW5hYmxlIHRvIGVudGVyIFNSKSwgdGhlIGRyaXZlciBzaG91
bGQgZmFpbAorICogYXRvbWljX2NoZWNrIHdoZW4gJmRybV9jcnRjX3N0YXRlLnNlbGZfcmVmcmVz
aF9hY3RpdmUgaXMgdHJ1ZS4KKyAqLworCitzdHJ1Y3QgZHJtX3NlbGZfcmVmcmVzaF9kYXRhIHsK
KwlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CisJc3RydWN0IGRlbGF5ZWRfd29yayBlbnRyeV93b3Jr
OworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzYXZlX3N0YXRlOworCXVuc2lnbmVkIGludCBl
bnRyeV9kZWxheV9tczsKK307CisKK3N0YXRpYyB2b2lkIGRybV9zZWxmX3JlZnJlc2hfaGVscGVy
X2VudHJ5X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBkcm1fc2Vs
Zl9yZWZyZXNoX2RhdGEgKnNyX2RhdGEgPSBjb250YWluZXJfb2YoCisJCQkJdG9fZGVsYXllZF93
b3JrKHdvcmspLAorCQkJCXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEsIGVudHJ5X3dvcmsp
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHNyX2RhdGEtPmNydGM7CisJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHgg
Y3R4OworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKKwlz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJaW50IGksIHJldDsKKworCWRybV9t
b2Rlc2V0X2FjcXVpcmVfaW5pdCgmY3R4LCAwKTsKKworCXN0YXRlID0gZHJtX2F0b21pY19zdGF0
ZV9hbGxvYyhkZXYpOworCWlmICghc3RhdGUpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBv
dXQ7CisJfQorCityZXRyeToKKwlzdGF0ZS0+YWNxdWlyZV9jdHggPSAmY3R4OworCisJY3J0Y19z
dGF0ZSA9IGRybV9hdG9taWNfZ2V0X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOworCWlmIChJU19F
UlIoY3J0Y19zdGF0ZSkpIHsKKwkJcmV0ID0gUFRSX0VSUihjcnRjX3N0YXRlKTsKKwkJZ290byBv
dXQ7CisJfQorCisJaWYgKCFjcnRjX3N0YXRlLT5lbmFibGUpCisJCWdvdG8gb3V0OworCisJcmV0
ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfY29ubmVjdG9ycyhzdGF0ZSwgY3J0Yyk7CisJaWYg
KHJldCkKKwkJZ290byBvdXQ7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0
YXRlLCBjb25uLCBjb25uX3N0YXRlLCBpKSB7CisJCWlmICghY29ubl9zdGF0ZS0+c2VsZl9yZWZy
ZXNoX2F3YXJlKQorCQkJZ290byBvdXQ7CisJfQorCisJY3J0Y19zdGF0ZS0+YWN0aXZlID0gZmFs
c2U7CisJY3J0Y19zdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSA9IHRydWU7CisKKwlyZXQgPSBk
cm1fYXRvbWljX2NvbW1pdChzdGF0ZSk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKK291dDoK
KwlpZiAocmV0ID09IC1FREVBRExLKSB7CisJCWRybV9hdG9taWNfc3RhdGVfY2xlYXIoc3RhdGUp
OworCQlyZXQgPSBkcm1fbW9kZXNldF9iYWNrb2ZmKCZjdHgpOworCQlpZiAoIXJldCkKKwkJCWdv
dG8gcmV0cnk7CisJfQorCisJZHJtX2F0b21pY19zdGF0ZV9wdXQoc3RhdGUpOworCWRybV9tb2Rl
c2V0X2Ryb3BfbG9ja3MoJmN0eCk7CisJZHJtX21vZGVzZXRfYWNxdWlyZV9maW5pKCZjdHgpOwor
fQorCisvKioKKyAqIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2FsdGVyX3N0YXRlIC0gQWx0ZXJz
IHRoZSBhdG9taWMgc3RhdGUgZm9yIFNSIGV4aXQKKyAqIEBzdGF0ZTogdGhlIHN0YXRlIGN1cnJl
bnRseSBiZWluZyBjaGVja2VkCisgKgorICogQ2FsbGVkIGF0IHRoZSBlbmQgb2YgYXRvbWljIGNo
ZWNrLiBUaGlzIGZ1bmN0aW9uIGNoZWNrcyB0aGUgc3RhdGUgZm9yIGZsYWdzCisgKiBpbmNvbXBh
dGlibGUgd2l0aCBzZWxmIHJlZnJlc2ggZXhpdCBhbmQgY2hhbmdlcyB0aGVtLiBUaGlzIGlzIGEg
Yml0CisgKiBkaXNpbmdlbnVvdXMgc2luY2UgdXNlcnNwYWNlIGlzIGV4cGVjdGluZyBvbmUgdGhp
bmcgYW5kIHdlJ3JlIGdpdmluZyBpdAorICogYW5vdGhlci4gSG93ZXZlciBpbiBvcmRlciB0byBr
ZWVwIHNlbGYgcmVmcmVzaCBlbnRpcmVseSBoaWRkZW4gZnJvbQorICogdXNlcnNwYWNlLCB0aGlz
IGlzIHJlcXVpcmVkLgorICoKKyAqIEF0IHRoZSBlbmQsIHdlIHF1ZXVlIHVwIHRoZSBzZWxmIHJl
ZnJlc2ggZW50cnkgd29yayBzbyB3ZSBjYW4gZW50ZXIgUFNSIGFmdGVyCisgKiB0aGUgZGVzaXJl
ZCBkZWxheS4KKyAqLwordm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZShz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9jcnRjICpjcnRj
OworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlpbnQgaTsKKworCWlmIChz
dGF0ZS0+YXN5bmNfdXBkYXRlIHx8ICFzdGF0ZS0+YWxsb3dfbW9kZXNldCkgeworCQlmb3JfZWFj
aF9vbGRfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgeworCQkJaWYg
KGNydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUpIHsKKwkJCQlzdGF0ZS0+YXN5bmNfdXBk
YXRlID0gZmFsc2U7CisJCQkJc3RhdGUtPmFsbG93X21vZGVzZXQgPSB0cnVlOworCQkJCWJyZWFr
OworCQkJfQorCQl9CisJfQorCisJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIGNydGNfc3RhdGUsIGkpIHsKKwkJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3Jf
ZGF0YTsKKworCQkvKiBEb24ndCB0cmlnZ2VyIHRoZSBlbnRyeSB0aW1lciB3aGVuIHdlJ3JlIGFs
cmVhZHkgaW4gU1IgKi8KKwkJaWYgKGNydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUpCisJ
CQljb250aW51ZTsKKworCQlzcl9kYXRhID0gY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGE7CisJCWlm
ICghc3JfZGF0YSkKKwkJCWNvbnRpbnVlOworCisJCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dx
LCAmc3JfZGF0YS0+ZW50cnlfd29yaywKKwkJCQkgbXNlY3NfdG9famlmZmllcyhzcl9kYXRhLT5l
bnRyeV9kZWxheV9tcykpOworCX0KK30KK0VYUE9SVF9TWU1CT0woZHJtX3NlbGZfcmVmcmVzaF9o
ZWxwZXJfYWx0ZXJfc3RhdGUpOworCisvKioKKyAqIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2lu
aXQgLSBJbml0aWFsaXplcyBzZWxmIHJlZnJlc2ggaGVscGVycyBmb3IgYSBjcnRjCisgKiBAY3J0
YzogdGhlIGNydGMgd2hpY2ggc3VwcG9ydHMgc2VsZiByZWZyZXNoIHN1cHBvcnRlZCBkaXNwbGF5
cworICogQGVudHJ5X2RlbGF5X21zOiBhbW91bnQgb2YgaW5hY3Rpdml0eSB0byB3YWl0IGJlZm9y
ZSBlbnRlcmluZyBzZWxmIHJlZnJlc2gKKyAqCisgKiBSZXR1cm5zIHplcm8gaWYgc3VjY2Vzc2Z1
bCBvciAtZXJybm8gb24gZmFpbHVyZQorICovCitpbnQgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJf
aW5pdChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJIHVuc2lnbmVkIGludCBlbnRyeV9kZWxh
eV9tcykKK3sKKwlzdHJ1Y3QgZHJtX3NlbGZfcmVmcmVzaF9kYXRhICpzcl9kYXRhID0gY3J0Yy0+
c2VsZl9yZWZyZXNoX2RhdGE7CisKKwkvKiBIZWxwZXIgaXMgYWxyZWFkeSBpbml0aWFsaXplZCAq
LworCWlmIChXQVJOX09OKHNyX2RhdGEpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXNyX2RhdGEg
PSBremFsbG9jKHNpemVvZigqc3JfZGF0YSksIEdGUF9LRVJORUwpOworCWlmICghc3JfZGF0YSkK
KwkJcmV0dXJuIC1FTk9NRU07CisKKwlJTklUX0RFTEFZRURfV09SSygmc3JfZGF0YS0+ZW50cnlf
d29yaywKKwkJCSAgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfZW50cnlfd29yayk7CisJc3JfZGF0
YS0+ZW50cnlfZGVsYXlfbXMgPSBlbnRyeV9kZWxheV9tczsKKwlzcl9kYXRhLT5jcnRjID0gY3J0
YzsKKworCWNydGMtPnNlbGZfcmVmcmVzaF9kYXRhID0gc3JfZGF0YTsKKwlyZXR1cm4gMDsKK30K
K0VYUE9SVF9TWU1CT0woZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfaW5pdCk7CisKKy8qKgorICog
ZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfY2xlYW51cCAtIENsZWFucyB1cCBzZWxmIHJlZnJlc2gg
aGVscGVycyBmb3IgYSBjcnRjCisgKiBAY3J0YzogdGhlIGNydGMgdG8gY2xlYW51cAorICovCit2
b2lkIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2NsZWFudXAoc3RydWN0IGRybV9jcnRjICpjcnRj
KQoreworCXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEgKnNyX2RhdGEgPSBjcnRjLT5zZWxm
X3JlZnJlc2hfZGF0YTsKKworCS8qIEhlbHBlciBpcyBhbHJlYWR5IHVuaW5pdGlhbGl6ZWQgKi8K
KwlpZiAoc3JfZGF0YSkKKwkJcmV0dXJuOworCisJY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGEgPSBO
VUxMOworCisJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZzcl9kYXRhLT5lbnRyeV93b3JrKTsK
KwlrZnJlZShzcl9kYXRhKTsKK30KK0VYUE9SVF9TWU1CT0woZHJtX3NlbGZfcmVmcmVzaF9oZWxw
ZXJfY2xlYW51cCk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmggYi9pbmNs
dWRlL2RybS9kcm1fYXRvbWljLmgKaW5kZXggZjEyMjE1NjQ3ODAxMC4uOTI3ZTEyMDVkN2FhNCAx
MDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oCisrKyBiL2luY2x1ZGUvZHJtL2Ry
bV9hdG9taWMuaApAQCAtOTU3LDQgKzk1NywxOSBAQCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9k
ZXNldChjb25zdCBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQogCSAgICAgICBzdGF0ZS0+
Y29ubmVjdG9yc19jaGFuZ2VkOwogfQogCisvKioKKyAqIGRybV9hdG9taWNfY3J0Y19lZmZlY3Rp
dmVseV9hY3RpdmUgLSBjb21wdXRlIHdoZXRoZXIgY3J0YyBpcyBhY3R1YWxseSBhY3RpdmUKKyAq
IEBzdGF0ZTogJmRybV9jcnRjX3N0YXRlIGZvciB0aGUgQ1JUQworICoKKyAqIFdoZW4gaW4gc2Vs
ZiByZWZyZXNoIG1vZGUsIHRoZSBjcnRjX3N0YXRlLT5hY3RpdmUgdmFsdWUgd2lsbCBiZSBmYWxz
ZSwgc2luY2UKKyAqIHRoZSBjcnRjIGlzIG9mZi4gSG93ZXZlciBpbiBzb21lIGNhc2VzIHdlJ3Jl
IGludGVyZXN0ZWQgaW4gd2hldGhlciB0aGUgY3J0YworICogaXMgYWN0aXZlLCBvciBlZmZlY3Rp
dmVseSBhY3RpdmUgKGllOiBpdCdzIGNvbm5lY3RlZCB0byBhbiBhY3RpdmUgZGlzcGxheSkuCisg
KiBJbiB0aGVzZSBjYXNlcywgdXNlIHRoaXMgZnVuY3Rpb24gaW5zdGVhZCBvZiBqdXN0IGNoZWNr
aW5nIGFjdGl2ZS4KKyAqLworc3RhdGljIGlubGluZSBib29sCitkcm1fYXRvbWljX2NydGNfZWZm
ZWN0aXZlbHlfYWN0aXZlKGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJ
cmV0dXJuIHN0YXRlLT5hY3RpdmUgfHwgc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmU7Cit9CisK
ICNlbmRpZiAvKiBEUk1fQVRPTUlDX0hfICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1f
Y29ubmVjdG9yLmggYi9pbmNsdWRlL2RybS9kcm1fY29ubmVjdG9yLmgKaW5kZXggMDcxMTQzYmMw
ZWJkMS4uYzZmODQ4NmQ4YjhmMyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2Nvbm5lY3Rv
ci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaApAQCAtNTQ4LDYgKzU0OCwyMCBA
QCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSB7CiAJLyoqIEB0djogVFYgY29ubmVjdG9yIHN0
YXRlICovCiAJc3RydWN0IGRybV90dl9jb25uZWN0b3Jfc3RhdGUgdHY7CiAKKwkvKioKKwkgKiBA
c2VsZl9yZWZyZXNoX2F3YXJlOgorCSAqCisJICogVGhpcyB0cmFja3Mgd2hldGhlciBhIGNvbm5l
Y3RvciBpcyBhd2FyZSBvZiB0aGUgc2VsZiByZWZyZXNoIHN0YXRlLgorCSAqIEl0IHNob3VsZCBi
ZSBzZXQgdG8gdHJ1ZSBmb3IgdGhvc2UgY29ubmVjdG9yIGltcGxlbWVudGF0aW9ucyB3aGljaAor
CSAqIHVuZGVyc3RhbmQgdGhlIHNlbGYgcmVmcmVzaCBzdGF0ZS4gVGhpcyBpcyBuZWVkZWQgc2lu
Y2UgdGhlIGNydGMKKwkgKiByZWdpc3RlcnMgdGhlIHNlbGYgcmVmcmVzaCBoZWxwZXJzIGFuZCBp
dCBkb2Vzbid0IGtub3cgaWYgdGhlCisJICogY29ubmVjdG9ycyBkb3duc3RyZWFtIGhhdmUgaW1w
bGVtZW50ZWQgc2VsZiByZWZyZXNoIGVudHJ5L2V4aXQuCisJICoKKwkgKiBEcml2ZXJzIHNob3Vs
ZCBzZXQgdGhpcyB0byB0cnVlIGluIGF0b21pY19jaGVjayBpZiB0aGV5IGtub3cgaG93IHRvCisJ
ICogaGFuZGxlIHNlbGZfcmVmcmVzaCByZXF1ZXN0cy4KKwkgKi8KKwlib29sIHNlbGZfcmVmcmVz
aF9hd2FyZTsKKwogCS8qKgogCSAqIEBwaWN0dXJlX2FzcGVjdF9yYXRpbzogQ29ubmVjdG9yIHBy
b3BlcnR5IHRvIGNvbnRyb2wgdGhlCiAJICogSERNSSBpbmZvZnJhbWUgYXNwZWN0IHJhdGlvIHNl
dHRpbmcuCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fY3J0Yy5oIGIvaW5jbHVkZS9kcm0v
ZHJtX2NydGMuaAppbmRleCBkYzQyYjllMzUzMzMzLi40ZmRhNjEwZDc2ZjI2IDEwMDY0NAotLS0g
YS9pbmNsdWRlL2RybS9kcm1fY3J0Yy5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9jcnRjLmgKQEAg
LTU0LDYgKzU0LDcgQEAgc3RydWN0IGRybV9tb2RlX3NldDsKIHN0cnVjdCBkcm1fZmlsZTsKIHN0
cnVjdCBkcm1fY2xpcF9yZWN0Owogc3RydWN0IGRybV9wcmludGVyOworc3RydWN0IGRybV9zZWxm
X3JlZnJlc2hfZGF0YTsKIHN0cnVjdCBkZXZpY2Vfbm9kZTsKIHN0cnVjdCBkbWFfZmVuY2U7CiBz
dHJ1Y3QgZWRpZDsKQEAgLTMwMCw2ICszMDEsMTcgQEAgc3RydWN0IGRybV9jcnRjX3N0YXRlIHsK
IAkgKi8KIAlib29sIHZycl9lbmFibGVkOwogCisJLyoqCisJICogQHNlbGZfcmVmcmVzaF9hY3Rp
dmU6CisJICoKKwkgKiBVc2VkIGJ5IHRoZSBzZWxmIHJlZnJlc2ggaGVscGVycyB0byBkZW5vdGUg
d2hlbiBhIHNlbGYgcmVmcmVzaAorCSAqIHRyYW5zaXRpb24gaXMgb2NjdXJpbmcuIFRoaXMgd2ls
bCBiZSBzZXQgb24gZW5hYmxlL2Rpc2FibGUgY2FsbGJhY2tzCisJICogd2hlbiBzZWxmIHJlZnJl
c2ggaXMgYmVpbmcgZW5hYmxlZCBvciBkaXNhYmxlZC4gSW4gc29tZSBjYXNlcywgaXQgbWF5CisJ
ICogbm90IGJlIGRlc2lyYWJsZSB0byBmdWxseSBzaHV0IG9mZiB0aGUgY3J0YyBkdXJpbmcgc2Vs
ZiByZWZyZXNoLgorCSAqIENSVEMncyBjYW4gaW5zcGVjdCB0aGlzIGZsYWcgYW5kIGRldGVybWlu
ZSB0aGUgYmVzdCBjb3Vyc2Ugb2YgYWN0aW9uLgorCSAqLworCWJvb2wgc2VsZl9yZWZyZXNoX2Fj
dGl2ZTsKKwogCS8qKgogCSAqIEBldmVudDoKIAkgKgpAQCAtMTA4OCw2ICsxMTAwLDEzIEBAIHN0
cnVjdCBkcm1fY3J0YyB7CiAJICogVGhlIG5hbWUgb2YgdGhlIENSVEMncyBmZW5jZSB0aW1lbGlu
ZS4KIAkgKi8KIAljaGFyIHRpbWVsaW5lX25hbWVbMzJdOworCisJLyoqCisJICogQHNlbGZfcmVm
cmVzaF9kYXRhOiBIb2xkcyB0aGUgc3RhdGUgZm9yIHRoZSBzZWxmIHJlZnJlc2ggaGVscGVycwor
CSAqCisJICogSW5pdGlhbGl6ZWQgdmlhIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX3JlZ2lzdGVy
KCkuCisJICovCisJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc2VsZl9yZWZyZXNoX2Rh
dGE7CiB9OwogCiAvKioKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hf
aGVscGVyLmggYi9pbmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMDAuLjQ1YzEwNmZiYjliNDAKLS0tIC9kZXYv
bnVsbAorKysgYi9pbmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oCkBAIC0wLDAg
KzEsMjAgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5
cmlnaHQgKEMpIDIwMTkgR29vZ2xlLCBJbmMuCisgKgorICogQXV0aG9yczoKKyAqIFNlYW4gUGF1
bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgorICovCisjaWZuZGVmIERSTV9TRUxGX1JFRlJFU0hf
SEVMUEVSX0hfCisjZGVmaW5lIERSTV9TRUxGX1JFRlJFU0hfSEVMUEVSX0hfCisKK3N0cnVjdCBk
cm1fYXRvbWljX3N0YXRlOworc3RydWN0IGRybV9jcnRjOworCit2b2lkIGRybV9zZWxmX3JlZnJl
c2hfaGVscGVyX2FsdGVyX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisK
K2ludCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9pbml0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
KwkJCQkgdW5zaWduZWQgaW50IGVudHJ5X2RlbGF5X21zKTsKKwordm9pZCBkcm1fc2VsZl9yZWZy
ZXNoX2hlbHBlcl9jbGVhbnVwKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CisjZW5kaWYKLS0gClNl
YW4gUGF1bCwgU29mdHdhcmUgRW5naW5lZXIsIEdvb2dsZSAvIENocm9taXVtIE9TCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
