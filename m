Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D0ADCE20E
	for <lists+dri-devel@lfdr.de>; Mon,  7 Oct 2019 14:45:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A83A6E5D3;
	Mon,  7 Oct 2019 12:45:10 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fllv0015.ext.ti.com (fllv0015.ext.ti.com [198.47.19.141])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5196D6E5D3
 for <dri-devel@lists.freedesktop.org>; Mon,  7 Oct 2019 12:45:09 +0000 (UTC)
Received: from fllv0034.itg.ti.com ([10.64.40.246])
 by fllv0015.ext.ti.com (8.15.2/8.15.2) with ESMTP id x97Cj1wR030306;
 Mon, 7 Oct 2019 07:45:01 -0500
Received: from DFLE105.ent.ti.com (dfle105.ent.ti.com [10.64.6.26])
 by fllv0034.itg.ti.com (8.15.2/8.15.2) with ESMTPS id x97Cj1mK094041
 (version=TLSv1.2 cipher=AES256-GCM-SHA384 bits=256 verify=FAIL);
 Mon, 7 Oct 2019 07:45:01 -0500
Received: from DFLE111.ent.ti.com (10.64.6.32) by DFLE105.ent.ti.com
 (10.64.6.26) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5; Mon, 7 Oct
 2019 07:45:00 -0500
Received: from lelv0326.itg.ti.com (10.180.67.84) by DFLE111.ent.ti.com
 (10.64.6.32) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5 via
 Frontend Transport; Mon, 7 Oct 2019 07:45:00 -0500
Received: from localhost (ileax41-snat.itg.ti.com [10.172.224.153])
 by lelv0326.itg.ti.com (8.15.2/8.15.2) with ESMTP id x97CixXC115950;
 Mon, 7 Oct 2019 07:45:00 -0500
From: Jean-Jacques Hiblot <jjhiblot@ti.com>
To: <jacek.anaszewski@gmail.com>, <pavel@ucw.cz>, <sre@kernel.org>,
 <robh+dt@kernel.org>, <mark.rutland@arm.com>, <lee.jones@linaro.org>,
 <daniel.thompson@linaro.org>
Subject: [PATCH v9 5/5] backlight: add led-backlight driver
Date: Mon, 7 Oct 2019 14:44:37 +0200
Message-ID: <20191007124437.20367-6-jjhiblot@ti.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191007124437.20367-1-jjhiblot@ti.com>
References: <20191007124437.20367-1-jjhiblot@ti.com>
MIME-Version: 1.0
X-EXCLAIMER-MD-CONFIG: e1e8a2fd-e40a-4ac6-ac9b-f7e9cc9ee180
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ti.com; s=ti-com-17Q1; t=1570452301;
 bh=tuyl5wXjPPfpn1iaywTTenuPQVjCxeueO9xgv9nTjRs=;
 h=From:To:CC:Subject:Date:In-Reply-To:References;
 b=qSZ/4sz2srok8fMxzgZClcKxowOe9c49cB53YSkvX4mzNMMI2X10v1n4PyvYFkcsv
 E5traeeBHUMN5u60dnR/Ic3SqYqrrC0WpIbgWfFRpldQ/nGXdPe4d3iFTCdIh1ft5J
 4TyZVF522MRajjQueVyFzOjWDVHoC48d9pJT/wNk=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 tomi.valkeinen@ti.com, dmurphy@ti.com, Jean-Jacques Hiblot <jjhiblot@ti.com>,
 linux-leds@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVG9taSBWYWxrZWluZW4gPHRvbWkudmFsa2VpbmVuQHRpLmNvbT4KClRoaXMgcGF0Y2gg
YWRkcyBhIGxlZC1iYWNrbGlnaHQgZHJpdmVyIChsZWRfYmwpLCB3aGljaCBpcyBzaW1pbGFyIHRv
CnB3bV9ibCBleGNlcHQgdGhlIGRyaXZlciB1c2VzIGEgTEVEIGNsYXNzIGRyaXZlciB0byBhZGp1
c3QgdGhlCmJyaWdodG5lc3MgaW4gdGhlIEhXLiBNdWx0aXBsZSBMRURzIGNhbiBiZSB1c2VkIGZv
ciBhIHNpbmdsZSBiYWNrbGlnaHQuCgpTaWduZWQtb2ZmLWJ5OiBUb21pIFZhbGtlaW5lbiA8dG9t
aS52YWxrZWluZW5AdGkuY29tPgpTaWduZWQtb2ZmLWJ5OiBKZWFuLUphY3F1ZXMgSGlibG90IDxq
amhpYmxvdEB0aS5jb20+CkFja2VkLWJ5OiBQYXZlbCBNYWNoZWsgPHBhdmVsQHVjdy5jej4KUmV2
aWV3ZWQtYnk6IERhbmllbCBUaG9tcHNvbiA8ZGFuaWVsLnRob21wc29uQGxpbmFyby5vcmc+ClJl
dmlld2VkLWJ5OiBTZWJhc3RpYW4gUmVpY2hlbCA8c2ViYXN0aWFuLnJlaWNoZWxAY29sbGFib3Jh
LmNvbT4KLS0tCiBkcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9LY29uZmlnICB8ICAgNyArCiBkcml2
ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZSB8ICAgMSArCiBkcml2ZXJzL3ZpZGVvL2JhY2ts
aWdodC9sZWRfYmwuYyB8IDI1OCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAzIGZp
bGVzIGNoYW5nZWQsIDI2NiBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy92aWRlby9iYWNrbGlnaHQvbGVkX2JsLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2Jh
Y2tsaWdodC9LY29uZmlnIGIvZHJpdmVycy92aWRlby9iYWNrbGlnaHQvS2NvbmZpZwppbmRleCA4
YjA4MWQ2MTc3M2UuLjU4NWExNzg3NjE4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy92aWRlby9iYWNr
bGlnaHQvS2NvbmZpZworKysgYi9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9LY29uZmlnCkBAIC00
NTgsNiArNDU4LDEzIEBAIGNvbmZpZyBCQUNLTElHSFRfUkFWRV9TUAogCWhlbHAKIAkgIFN1cHBv
cnQgZm9yIGJhY2tsaWdodCBjb250cm9sIG9uIFJBVkUgU1AgZGV2aWNlLgogCitjb25maWcgQkFD
S0xJR0hUX0xFRAorCXRyaXN0YXRlICJHZW5lcmljIExFRCBiYXNlZCBCYWNrbGlnaHQgRHJpdmVy
IgorCWRlcGVuZHMgb24gTEVEU19DTEFTUyAmJiBPRgorCWhlbHAKKwkgIElmIHlvdSBoYXZlIGEg
TENEIGJhY2tsaWdodCBhZGp1c3RhYmxlIGJ5IExFRCBjbGFzcyBkcml2ZXIsIHNheSBZCisJICB0
byBlbmFibGUgdGhpcyBkcml2ZXIuCisKIGVuZGlmICMgQkFDS0xJR0hUX0NMQVNTX0RFVklDRQog
CiBlbmRtZW51CmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZSBi
L2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0L01ha2VmaWxlCmluZGV4IDYzYzUwN2MwNzQzNy4uMmE2
NzY0Mjk2NmE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZQor
KysgYi9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZQpAQCAtNTcsMyArNTcsNCBAQCBv
YmotJChDT05GSUdfQkFDS0xJR0hUX1RQUzY1MjE3KQkrPSB0cHM2NTIxN19ibC5vCiBvYmotJChD
T05GSUdfQkFDS0xJR0hUX1dNODMxWCkJCSs9IHdtODMxeF9ibC5vCiBvYmotJChDT05GSUdfQkFD
S0xJR0hUX0FSQ1hDTk4pIAkrPSBhcmN4Y25uX2JsLm8KIG9iai0kKENPTkZJR19CQUNLTElHSFRf
UkFWRV9TUCkJCSs9IHJhdmUtc3AtYmFja2xpZ2h0Lm8KK29iai0kKENPTkZJR19CQUNLTElHSFRf
TEVEKQkJKz0gbGVkX2JsLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0L2xl
ZF9ibC5jIGIvZHJpdmVycy92aWRlby9iYWNrbGlnaHQvbGVkX2JsLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iODliYTIwYzFkMTYKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9sZWRfYmwuYwpAQCAtMCwwICsxLDI1OCBAQAorLy8g
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgKEMpIDIw
MTUtMjAxOSBUZXhhcyBJbnN0cnVtZW50cyBJbmNvcnBvcmF0ZWQgLSAgaHR0cDovL3d3dy50aS5j
b20vCisgKiBBdXRob3JzOiBUb21pIFZhbGtlaW5lbiA8dG9taS52YWxrZWluZW5AdGkuY29tPgor
ICogICAgICAgICAgSmVhbi1KYWNxdWVzIEhpYmxvdCA8ampoaWJsb3RAdGkuY29tPgorICovCisK
KyNpbmNsdWRlIDxsaW51eC9iYWNrbGlnaHQuaD4KKyNpbmNsdWRlIDxsaW51eC9sZWRzLmg+Cisj
aW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNl
Lmg+CisKK3N0cnVjdCBsZWRfYmxfZGF0YSB7CisJc3RydWN0IGRldmljZQkJKmRldjsKKwlzdHJ1
Y3QgYmFja2xpZ2h0X2RldmljZQkqYmxfZGV2OworCXN0cnVjdCBsZWRfY2xhc3NkZXYJKipsZWRz
OworCWJvb2wJCQllbmFibGVkOworCWludAkJCW5iX2xlZHM7CisJdW5zaWduZWQgaW50CQkqbGV2
ZWxzOworCXVuc2lnbmVkIGludAkJZGVmYXVsdF9icmlnaHRuZXNzOworCXVuc2lnbmVkIGludAkJ
bWF4X2JyaWdodG5lc3M7Cit9OworCitzdGF0aWMgdm9pZCBsZWRfYmxfc2V0X2JyaWdodG5lc3Mo
c3RydWN0IGxlZF9ibF9kYXRhICpwcml2LCBpbnQgbGV2ZWwpCit7CisJaW50IGk7CisJaW50IGJr
bF9icmlnaHRuZXNzOworCisJaWYgKHByaXYtPmxldmVscykKKwkJYmtsX2JyaWdodG5lc3MgPSBw
cml2LT5sZXZlbHNbbGV2ZWxdOworCWVsc2UKKwkJYmtsX2JyaWdodG5lc3MgPSBsZXZlbDsKKwor
CWZvciAoaSA9IDA7IGkgPCBwcml2LT5uYl9sZWRzOyBpKyspCisJCWxlZF9zZXRfYnJpZ2h0bmVz
cyhwcml2LT5sZWRzW2ldLCBia2xfYnJpZ2h0bmVzcyk7CisKKwlwcml2LT5lbmFibGVkID0gdHJ1
ZTsKK30KKworc3RhdGljIHZvaWQgbGVkX2JsX3Bvd2VyX29mZihzdHJ1Y3QgbGVkX2JsX2RhdGEg
KnByaXYpCit7CisJaW50IGk7CisKKwlpZiAoIXByaXYtPmVuYWJsZWQpCisJCXJldHVybjsKKwor
CWZvciAoaSA9IDA7IGkgPCBwcml2LT5uYl9sZWRzOyBpKyspCisJCWxlZF9zZXRfYnJpZ2h0bmVz
cyhwcml2LT5sZWRzW2ldLCBMRURfT0ZGKTsKKworCXByaXYtPmVuYWJsZWQgPSBmYWxzZTsKK30K
Kworc3RhdGljIGludCBsZWRfYmxfdXBkYXRlX3N0YXR1cyhzdHJ1Y3QgYmFja2xpZ2h0X2Rldmlj
ZSAqYmwpCit7CisJc3RydWN0IGxlZF9ibF9kYXRhICpwcml2ID0gYmxfZ2V0X2RhdGEoYmwpOwor
CWludCBicmlnaHRuZXNzID0gYmwtPnByb3BzLmJyaWdodG5lc3M7CisKKwlpZiAoYmwtPnByb3Bz
LnBvd2VyICE9IEZCX0JMQU5LX1VOQkxBTksgfHwKKwkgICAgYmwtPnByb3BzLmZiX2JsYW5rICE9
IEZCX0JMQU5LX1VOQkxBTksgfHwKKwkgICAgYmwtPnByb3BzLnN0YXRlICYgQkxfQ09SRV9GQkJM
QU5LKQorCQlicmlnaHRuZXNzID0gMDsKKworCWlmIChicmlnaHRuZXNzID4gMCkKKwkJbGVkX2Js
X3NldF9icmlnaHRuZXNzKHByaXYsIGJyaWdodG5lc3MpOworCWVsc2UKKwkJbGVkX2JsX3Bvd2Vy
X29mZihwcml2KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGJhY2ts
aWdodF9vcHMgbGVkX2JsX29wcyA9IHsKKwkudXBkYXRlX3N0YXR1cwk9IGxlZF9ibF91cGRhdGVf
c3RhdHVzLAorfTsKKworc3RhdGljIGludCBsZWRfYmxfZ2V0X2xlZHMoc3RydWN0IGRldmljZSAq
ZGV2LAorCQkJICAgc3RydWN0IGxlZF9ibF9kYXRhICpwcml2KQoreworCWludCBpLCBuYl9sZWRz
LCByZXQ7CisJc3RydWN0IGRldmljZV9ub2RlICpub2RlID0gZGV2LT5vZl9ub2RlOworCXN0cnVj
dCBsZWRfY2xhc3NkZXYgKipsZWRzOworCXVuc2lnbmVkIGludCBtYXhfYnJpZ2h0bmVzczsKKwl1
bnNpZ25lZCBpbnQgZGVmYXVsdF9icmlnaHRuZXNzOworCisJcmV0ID0gb2ZfY291bnRfcGhhbmRs
ZV93aXRoX2FyZ3Mobm9kZSwgImxlZHMiLCBOVUxMKTsKKwlpZiAocmV0IDwgMCkgeworCQlkZXZf
ZXJyKGRldiwgIlVuYWJsZSB0byBnZXQgbGVkIGNvdW50XG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7
CisJfQorCisJbmJfbGVkcyA9IHJldDsKKwlpZiAobmJfbGVkcyA8IDEpIHsKKwkJZGV2X2Vycihk
ZXYsICJBdCBsZWFzdCBvbmUgTEVEIG11c3QgYmUgc3BlY2lmaWVkIVxuIik7CisJCXJldHVybiAt
RUlOVkFMOworCX0KKworCWxlZHMgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2Yoc3RydWN0IGxl
ZF9jbGFzc2RldiAqKSAqIG5iX2xlZHMsCisJCQkgICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFsZWRz
KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWZvciAoaSA9IDA7IGkgPCBuYl9sZWRzOyBpKyspIHsK
KwkJbGVkc1tpXSA9IGRldm1fb2ZfbGVkX2dldChkZXYsIGkpOworCQlpZiAoSVNfRVJSKGxlZHNb
aV0pKQorCQkJcmV0dXJuIFBUUl9FUlIobGVkc1tpXSk7CisJfQorCisJLyogY2hlY2sgdGhhdCB0
aGUgTEVEcyBhbGwgaGF2ZSB0aGUgc2FtZSBicmlnaHRuZXNzIHJhbmdlICovCisJbWF4X2JyaWdo
dG5lc3MgPSBsZWRzWzBdLT5tYXhfYnJpZ2h0bmVzczsKKwlmb3IgKGkgPSAxOyBpIDwgbmJfbGVk
czsgaSsrKSB7CisJCWlmIChtYXhfYnJpZ2h0bmVzcyAhPSBsZWRzW2ldLT5tYXhfYnJpZ2h0bmVz
cykgeworCQkJZGV2X2VycihkZXYsICJMRURzIG11c3QgaGF2ZSBpZGVudGljYWwgcmFuZ2VzXG4i
KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCisJLyogZ2V0IHRoZSBkZWZhdWx0IGJy
aWdodG5lc3MgZnJvbSB0aGUgZmlyc3QgTEVEIGZyb20gdGhlIGxpc3QgKi8KKwlkZWZhdWx0X2Jy
aWdodG5lc3MgPSBsZWRzWzBdLT5icmlnaHRuZXNzOworCisJcHJpdi0+bmJfbGVkcyA9IG5iX2xl
ZHM7CisJcHJpdi0+bGVkcyA9IGxlZHM7CisJcHJpdi0+bWF4X2JyaWdodG5lc3MgPSBtYXhfYnJp
Z2h0bmVzczsKKwlwcml2LT5kZWZhdWx0X2JyaWdodG5lc3MgPSBkZWZhdWx0X2JyaWdodG5lc3M7
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBsZWRfYmxfcGFyc2VfbGV2ZWxzKHN0cnVj
dCBkZXZpY2UgKmRldiwKKwkJCSAgIHN0cnVjdCBsZWRfYmxfZGF0YSAqcHJpdikKK3sKKwlzdHJ1
Y3QgZGV2aWNlX25vZGUgKm5vZGUgPSBkZXYtPm9mX25vZGU7CisJaW50IG51bV9sZXZlbHM7CisJ
dTMyIHZhbHVlOworCWludCByZXQ7CisKKwlpZiAoIW5vZGUpCisJCXJldHVybiAtRU5PREVWOwor
CisJbnVtX2xldmVscyA9IG9mX3Byb3BlcnR5X2NvdW50X3UzMl9lbGVtcyhub2RlLCAiYnJpZ2h0
bmVzcy1sZXZlbHMiKTsKKwlpZiAobnVtX2xldmVscyA+IDEpIHsKKwkJaW50IGk7CisJCXVuc2ln
bmVkIGludCBkYjsKKwkJdTMyICpsZXZlbHMgPSBOVUxMOworCisJCWxldmVscyA9IGRldm1fa3ph
bGxvYyhkZXYsIHNpemVvZih1MzIpICogbnVtX2xldmVscywKKwkJCQkgICAgICBHRlBfS0VSTkVM
KTsKKwkJaWYgKCFsZXZlbHMpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlyZXQgPSBvZl9wcm9w
ZXJ0eV9yZWFkX3UzMl9hcnJheShub2RlLCAiYnJpZ2h0bmVzcy1sZXZlbHMiLAorCQkJCQkJbGV2
ZWxzLAorCQkJCQkJbnVtX2xldmVscyk7CisJCWlmIChyZXQgPCAwKQorCQkJcmV0dXJuIHJldDsK
KworCQkvKgorCQkgKiBUcnkgdG8gbWFwIGFjdHVhbCBMRUQgYnJpZ2h0bmVzcyB0byBiYWNrbGln
aHQgYnJpZ2h0bmVzcworCQkgKiBsZXZlbAorCQkgKi8KKwkJZGIgPSBwcml2LT5kZWZhdWx0X2Jy
aWdodG5lc3M7CisJCWZvciAoaSA9IDAgOyBpIDwgbnVtX2xldmVsczsgaSsrKSB7CisJCQlpZiAo
KGkgJiYgZGIgPiBsZXZlbHNbaS0xXSkgJiYgZGIgPD0gbGV2ZWxzW2ldKQorCQkJCWJyZWFrOwor
CQl9CisJCXByaXYtPmRlZmF1bHRfYnJpZ2h0bmVzcyA9IGk7CisJCXByaXYtPm1heF9icmlnaHRu
ZXNzID0gbnVtX2xldmVscyAtIDE7CisJCXByaXYtPmxldmVscyA9IGxldmVsczsKKwl9IGVsc2Ug
aWYgKG51bV9sZXZlbHMgPj0gMCkKKwkJZGV2X3dhcm4oZGV2LCAiTm90IGVub3VnaCBsZXZlbHMg
ZGVmaW5lZFxuIik7CisKKwlyZXQgPSBvZl9wcm9wZXJ0eV9yZWFkX3UzMihub2RlLCAiZGVmYXVs
dC1icmlnaHRuZXNzLWxldmVsIiwgJnZhbHVlKTsKKwlpZiAoIXJldCAmJiB2YWx1ZSA8PSBwcml2
LT5tYXhfYnJpZ2h0bmVzcykKKwkJcHJpdi0+ZGVmYXVsdF9icmlnaHRuZXNzID0gdmFsdWU7CisJ
ZWxzZSBpZiAoIXJldCAgJiYgdmFsdWUgPiBwcml2LT5tYXhfYnJpZ2h0bmVzcykKKwkJZGV2X3dh
cm4oZGV2LCAiSW52YWxpZCBkZWZhdWx0IGJyaWdodG5lc3MuIElnbm9yaW5nIGl0XG4iKTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBsZWRfYmxfY2xlYW51cCh2b2lkICpkYXRhKQor
eworCXN0cnVjdCBsZWRfYmxfZGF0YSAqcHJpdiA9IGRhdGE7CisJaW50IGk7CisKKwlsZWRfYmxf
cG93ZXJfb2ZmKHByaXYpOworCWZvciAoaSA9IDA7IGkgPCBwcml2LT5uYl9sZWRzOyBpKyspCisJ
CWxlZF9zeXNmc19lbmFibGUocHJpdi0+bGVkc1tpXSk7Cit9CisKK3N0YXRpYyBpbnQgbGVkX2Js
X3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJc3RydWN0IGJhY2tsaWdo
dF9wcm9wZXJ0aWVzIHByb3BzOworCXN0cnVjdCBsZWRfYmxfZGF0YSAqcHJpdjsKKwlpbnQgcmV0
LCBpOworCisJcHJpdiA9IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBzaXplb2YoKnByaXYpLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIXByaXYpCisJCXJldHVybiAtRU5PTUVNOworCisJcGxhdGZvcm1f
c2V0X2RydmRhdGEocGRldiwgcHJpdik7CisKKwlwcml2LT5kZXYgPSAmcGRldi0+ZGV2OworCisJ
cmV0ID0gbGVkX2JsX2dldF9sZWRzKCZwZGV2LT5kZXYsIHByaXYpOworCWlmIChyZXQpCisJCXJl
dHVybiByZXQ7CisKKwlyZXQgPSBsZWRfYmxfcGFyc2VfbGV2ZWxzKCZwZGV2LT5kZXYsIHByaXYp
OworCWlmIChyZXQgPCAwKSB7CisJCWRldl9lcnIoJnBkZXYtPmRldiwgIkZhaWxlZCB0byBwYXJz
ZSBEVCBkYXRhXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSBkZXZtX2FkZF9hY3Rp
b25fb3JfcmVzZXQoJnBkZXYtPmRldiwgbGVkX2JsX2NsZWFudXAsIHByaXYpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwlmb3IgKGkgPSAwOyBpIDwgcHJpdi0+bmJfbGVkczsgaSsrKQor
CQlsZWRfc3lzZnNfZGlzYWJsZShwcml2LT5sZWRzW2ldKTsKKworCW1lbXNldCgmcHJvcHMsIDAs
IHNpemVvZihzdHJ1Y3QgYmFja2xpZ2h0X3Byb3BlcnRpZXMpKTsKKwlwcm9wcy50eXBlID0gQkFD
S0xJR0hUX1JBVzsKKwlwcm9wcy5tYXhfYnJpZ2h0bmVzcyA9IHByaXYtPm1heF9icmlnaHRuZXNz
OworCXByb3BzLmJyaWdodG5lc3MgPSBwcml2LT5kZWZhdWx0X2JyaWdodG5lc3M7CisJcHJvcHMu
cG93ZXIgPSAocHJpdi0+ZGVmYXVsdF9icmlnaHRuZXNzID4gMCkgPyBGQl9CTEFOS19QT1dFUkRP
V04gOgorCQkgICAgICBGQl9CTEFOS19VTkJMQU5LOworCXByaXYtPmJsX2RldiA9IGRldm1fYmFj
a2xpZ2h0X2RldmljZV9yZWdpc3RlcigmcGRldi0+ZGV2LAorCQkJZGV2X25hbWUoJnBkZXYtPmRl
diksICZwZGV2LT5kZXYsIHByaXYsICZsZWRfYmxfb3BzLAorCQkJJnByb3BzKTsKKwlpZiAoSVNf
RVJSKHByaXYtPmJsX2RldikpIHsKKwkJZGV2X2VycigmcGRldi0+ZGV2LCAiRmFpbGVkIHRvIHJl
Z2lzdGVyIGJhY2tsaWdodFxuIik7CisJCXJldHVybiBQVFJfRVJSKHByaXYtPmJsX2Rldik7CisJ
fQorCisJYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMocHJpdi0+YmxfZGV2KTsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBsZWRfYmxfb2ZfbWF0Y2hb
XSA9IHsKKwl7IC5jb21wYXRpYmxlID0gImxlZC1iYWNrbGlnaHQiIH0sCisJeyB9Cit9OworCitN
T0RVTEVfREVWSUNFX1RBQkxFKG9mLCBsZWRfYmxfb2ZfbWF0Y2gpOworCitzdGF0aWMgc3RydWN0
IHBsYXRmb3JtX2RyaXZlciBsZWRfYmxfZHJpdmVyID0geworCS5kcml2ZXIJCT0geworCQkubmFt
ZQkJPSAibGVkLWJhY2tsaWdodCIsCisJCS5vZl9tYXRjaF90YWJsZQk9IGxlZF9ibF9vZl9tYXRj
aCwKKwl9LAorCS5wcm9iZQkJPSBsZWRfYmxfcHJvYmUsCit9OworCittb2R1bGVfcGxhdGZvcm1f
ZHJpdmVyKGxlZF9ibF9kcml2ZXIpOworCitNT0RVTEVfREVTQ1JJUFRJT04oIkxFRCBiYXNlZCBC
YWNrbGlnaHQgRHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIik7CitNT0RVTEVfQUxJQVMo
InBsYXRmb3JtOmxlZC1iYWNrbGlnaHQiKTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
