Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5EF332CD867
	for <lists+dri-devel@lfdr.de>; Thu,  3 Dec 2020 15:03:17 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AB2E76EB71;
	Thu,  3 Dec 2020 14:03:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B9DC76EB68
 for <dri-devel@lists.freedesktop.org>; Thu,  3 Dec 2020 14:03:10 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id 5A9A1ADC1;
 Thu,  3 Dec 2020 14:03:09 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, maarten.lankhorst@linux.intel.com,
 mripard@kernel.org, hdegoede@redhat.com, christian.koenig@amd.com,
 sumit.semwal@linaro.org
Subject: [PATCH v2 6/7] drm/vram-helper: Simplify vmap implementation
Date: Thu,  3 Dec 2020 15:02:58 +0100
Message-Id: <20201203140259.26580-7-tzimmermann@suse.de>
X-Mailer: git-send-email 2.29.2
In-Reply-To: <20201203140259.26580-1-tzimmermann@suse.de>
References: <20201203140259.26580-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linaro-mm-sig@lists.linaro.org, Thomas Zimmermann <tzimmermann@suse.de>,
 dri-devel@lists.freedesktop.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWZ0ZXIgcmVtb3ZpbmcgdGhlIHBpbm5pbmcgb3BlcmF0aW9ucywgdGhlIHZtYXAvdnVubWFwIGNv
ZGUgYXMgYmVlbgpyZWR1Y2VkIHRvIHdoYXQgdXNlZCB0byBiZSBhbiBpbnRlcm5hbCBoZWxwZXIu
IElubGluZSB0aGUgaGVscGVyIHRvCnNpbXBsaWZ5IHRoZSBpbXBsZW1lbnRhdGlvbi4KClNpZ25l
ZC1vZmYtYnk6IFRob21hcyBaaW1tZXJtYW5uIDx0emltbWVybWFubkBzdXNlLmRlPgpBY2tlZC1i
eTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmMgfCA1MiArKysrKysrKysrKy0tLS0tLS0t
LS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMCBpbnNlcnRpb25zKCspLCAzMiBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwppbmRleCAyNzZlOGY4ZWE2NjMu
LjYxNTlmNWRjOGYxZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9o
ZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC0z
NzgsMzYgKzM3OCw2IEBAIGludCBkcm1fZ2VtX3ZyYW1fdW5waW4oc3RydWN0IGRybV9nZW1fdnJh
bV9vYmplY3QgKmdibykKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92cmFtX3VucGluKTsKIAot
c3RhdGljIGludCBkcm1fZ2VtX3ZyYW1fa21hcF9sb2NrZWQoc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmdibywKLQkJCQkgICAgc3RydWN0IGRtYV9idWZfbWFwICptYXApCi17Ci0JaW50IHJl
dDsKLQotCXJldCA9IHR0bV9ib192bWFwKCZnYm8tPmJvLCAmZ2JvLT5tYXApOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7Ci0KLQkqbWFwID0gZ2JvLT5tYXA7Ci0KLQlyZXR1cm4gMDsKLX0KLQot
c3RhdGljIHZvaWQgZHJtX2dlbV92cmFtX2t1bm1hcF9sb2NrZWQoc3RydWN0IGRybV9nZW1fdnJh
bV9vYmplY3QgKmdibywKLQkJCQkgICAgICAgc3RydWN0IGRtYV9idWZfbWFwICptYXApCi17Ci0J
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGdiby0+Ym8uYmFzZS5kZXY7Ci0KLQlpZiAoZHJtX1dB
Uk5fT05fT05DRShkZXYsICFkbWFfYnVmX21hcF9pc19lcXVhbCgmZ2JvLT5tYXAsIG1hcCkpKQot
CQlyZXR1cm47IC8qIEJVRzogbWFwIG5vdCBtYXBwZWQgZnJvbSB0aGlzIEJPICovCi0KLQkvKgot
CSAqIFBlcm1hbmVudGx5IG1hcHBpbmcgYW5kIHVubWFwcGluZyBidWZmZXJzIGFkZHMgb3Zlcmhl
YWQgZnJvbQotCSAqIHVwZGF0aW5nIHRoZSBwYWdlIHRhYmxlcyBhbmQgY3JlYXRlcyBkZWJ1Z2dp
bmcgb3V0cHV0LiBUaGVyZWZvcmUsCi0JICogd2UgZGVsYXkgdGhlIGFjdHVhbCB1bm1hcCBvcGVy
YXRpb24gdW50aWwgdGhlIEJPIGdldHMgZXZpY3RlZAotCSAqIGZyb20gbWVtb3J5LiBTZWUgZHJt
X2dlbV92cmFtX2JvX2RyaXZlcl9tb3ZlX25vdGlmeSgpLgotCSAqLwotfQotCiAvKioKICAqIGRy
bV9nZW1fdnJhbV92bWFwKCkgLSBQaW5zIGFuZCBtYXBzIGEgR0VNIFZSQU0gb2JqZWN0IGludG8g
a2VybmVsIGFkZHJlc3MKICAqICAgICAgICAgICAgICAgICAgICAgICBzcGFjZQpAQCAtNDI2LDkg
KzM5NiwxNyBAQCBzdGF0aWMgdm9pZCBkcm1fZ2VtX3ZyYW1fa3VubWFwX2xvY2tlZChzdHJ1Y3Qg
ZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvLAogICovCiBpbnQgZHJtX2dlbV92cmFtX3ZtYXAoc3Ry
dWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmdibywgc3RydWN0IGRtYV9idWZfbWFwICptYXApCiB7
CisJaW50IHJldDsKKwogCWRtYV9yZXN2X2Fzc2VydF9oZWxkKGdiby0+Ym8uYmFzZS5yZXN2KTsK
IAotCXJldHVybiBkcm1fZ2VtX3ZyYW1fa21hcF9sb2NrZWQoZ2JvLCBtYXApOworCXJldCA9IHR0
bV9ib192bWFwKCZnYm8tPmJvLCAmZ2JvLT5tYXApOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CisKKwkqbWFwID0gZ2JvLT5tYXA7CisKKwlyZXR1cm4gMDsKIH0KIEVYUE9SVF9TWU1CT0woZHJt
X2dlbV92cmFtX3ZtYXApOwogCkBAIC00NDIsOSArNDIwLDE5IEBAIEVYUE9SVF9TWU1CT0woZHJt
X2dlbV92cmFtX3ZtYXApOwogICovCiB2b2lkIGRybV9nZW1fdnJhbV92dW5tYXAoc3RydWN0IGRy
bV9nZW1fdnJhbV9vYmplY3QgKmdibywgc3RydWN0IGRtYV9idWZfbWFwICptYXApCiB7CisJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IGdiby0+Ym8uYmFzZS5kZXY7CisKIAlkbWFfcmVzdl9hc3Nl
cnRfaGVsZChnYm8tPmJvLmJhc2UucmVzdik7CiAKLQlkcm1fZ2VtX3ZyYW1fa3VubWFwX2xvY2tl
ZChnYm8sIG1hcCk7CisJaWYgKGRybV9XQVJOX09OX09OQ0UoZGV2LCAhZG1hX2J1Zl9tYXBfaXNf
ZXF1YWwoJmdiby0+bWFwLCBtYXApKSkKKwkJcmV0dXJuOyAvKiBCVUc6IG1hcCBub3QgbWFwcGVk
IGZyb20gdGhpcyBCTyAqLworCisJLyoKKwkgKiBQZXJtYW5lbnRseSBtYXBwaW5nIGFuZCB1bm1h
cHBpbmcgYnVmZmVycyBhZGRzIG92ZXJoZWFkIGZyb20KKwkgKiB1cGRhdGluZyB0aGUgcGFnZSB0
YWJsZXMgYW5kIGNyZWF0ZXMgZGVidWdnaW5nIG91dHB1dC4gVGhlcmVmb3JlLAorCSAqIHdlIGRl
bGF5IHRoZSBhY3R1YWwgdW5tYXAgb3BlcmF0aW9uIHVudGlsIHRoZSBCTyBnZXRzIGV2aWN0ZWQK
KwkgKiBmcm9tIG1lbW9yeS4gU2VlIGRybV9nZW1fdnJhbV9ib19kcml2ZXJfbW92ZV9ub3RpZnko
KS4KKwkgKi8KIH0KIEVYUE9SVF9TWU1CT0woZHJtX2dlbV92cmFtX3Z1bm1hcCk7CiAKLS0gCjIu
MjkuMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
