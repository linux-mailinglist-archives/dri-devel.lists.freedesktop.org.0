Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 534386BDFC
	for <lists+dri-devel@lfdr.de>; Wed, 17 Jul 2019 16:15:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EBA4F6E1D3;
	Wed, 17 Jul 2019 14:15:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from lelv0142.ext.ti.com (lelv0142.ext.ti.com [198.47.23.249])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D731D6E1BB
 for <dri-devel@lists.freedesktop.org>; Wed, 17 Jul 2019 14:15:28 +0000 (UTC)
Received: from lelv0266.itg.ti.com ([10.180.67.225])
 by lelv0142.ext.ti.com (8.15.2/8.15.2) with ESMTP id x6HEFORk046072;
 Wed, 17 Jul 2019 09:15:24 -0500
Received: from DFLE104.ent.ti.com (dfle104.ent.ti.com [10.64.6.25])
 by lelv0266.itg.ti.com (8.15.2/8.15.2) with ESMTPS id x6HEFOgG075667
 (version=TLSv1.2 cipher=AES256-GCM-SHA384 bits=256 verify=FAIL);
 Wed, 17 Jul 2019 09:15:24 -0500
Received: from DFLE101.ent.ti.com (10.64.6.22) by DFLE104.ent.ti.com
 (10.64.6.25) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5; Wed, 17
 Jul 2019 09:15:23 -0500
Received: from lelv0326.itg.ti.com (10.180.67.84) by DFLE101.ent.ti.com
 (10.64.6.22) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5 via
 Frontend Transport; Wed, 17 Jul 2019 09:15:23 -0500
Received: from localhost (ileax41-snat.itg.ti.com [10.172.224.153])
 by lelv0326.itg.ti.com (8.15.2/8.15.2) with ESMTP id x6HEFNFu094901;
 Wed, 17 Jul 2019 09:15:23 -0500
From: Jean-Jacques Hiblot <jjhiblot@ti.com>
To: <jacek.anaszewski@gmail.com>, <pavel@ucw.cz>, <robh+dt@kernel.org>,
 <mark.rutland@arm.com>, <lee.jones@linaro.org>,
 <daniel.thompson@linaro.org>, <jingoohan1@gmail.com>
Subject: [PATCH v4 4/4] backlight: add led-backlight driver
Date: Wed, 17 Jul 2019 16:15:14 +0200
Message-ID: <20190717141514.21171-5-jjhiblot@ti.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190717141514.21171-1-jjhiblot@ti.com>
References: <20190717141514.21171-1-jjhiblot@ti.com>
MIME-Version: 1.0
X-EXCLAIMER-MD-CONFIG: e1e8a2fd-e40a-4ac6-ac9b-f7e9cc9ee180
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ti.com; s=ti-com-17Q1; t=1563372924;
 bh=rUD+mDW7qj79oqu5aA2ibwroIdtpWBev6WZwilXEqqU=;
 h=From:To:CC:Subject:Date:In-Reply-To:References;
 b=sBqN+9Ca+nTbmh14qs+owU/5jR5+jMpIev2rZDKdiKon7TLTF18MLF/g+QG04iQoO
 Z7LRpdqNBHYrqxoztjn4uGwpGloEhKDAksN38gzmJtvouwSlw7HFVywhiRLalagkQ6
 bR2zVJLMq3XQ4VeelKe+DkdYBv/ss1VZoqY/R3n4=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 tomi.valkeinen@ti.com, dmurphy@ti.com, Jean-Jacques Hiblot <jjhiblot@ti.com>,
 linux-leds@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVG9taSBWYWxrZWluZW4gPHRvbWkudmFsa2VpbmVuQHRpLmNvbT4KClRoaXMgcGF0Y2gg
YWRkcyBhIGxlZC1iYWNrbGlnaHQgZHJpdmVyIChsZWRfYmwpLCB3aGljaCBpcyBzaW1pbGFyIHRv
CnB3bV9ibCBleGNlcHQgdGhlIGRyaXZlciB1c2VzIGEgTEVEIGNsYXNzIGRyaXZlciB0byBhZGp1
c3QgdGhlCmJyaWdodG5lc3MgaW4gdGhlIEhXLiBNdWx0aXBsZSBMRURzIGNhbiBiZSB1c2VkIGZv
ciBhIHNpbmdsZSBiYWNrbGlnaHQuCgpTaWduZWQtb2ZmLWJ5OiBUb21pIFZhbGtlaW5lbiA8dG9t
aS52YWxrZWluZW5AdGkuY29tPgpTaWduZWQtb2ZmLWJ5OiBKZWFuLUphY3F1ZXMgSGlibG90IDxq
amhpYmxvdEB0aS5jb20+CkFja2VkLWJ5OiBQYXZlbCBNYWNoZWsgPHBhdmVsQHVjdy5jej4KLS0t
CiBkcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9LY29uZmlnICB8ICAgNyArCiBkcml2ZXJzL3ZpZGVv
L2JhY2tsaWdodC9NYWtlZmlsZSB8ICAgMSArCiBkcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9sZWRf
YmwuYyB8IDI2OCArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAzIGZpbGVzIGNoYW5n
ZWQsIDI3NiBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy92aWRlby9i
YWNrbGlnaHQvbGVkX2JsLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9L
Y29uZmlnIGIvZHJpdmVycy92aWRlby9iYWNrbGlnaHQvS2NvbmZpZwppbmRleCA4YjA4MWQ2MTc3
M2UuLjU4NWExNzg3NjE4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy92aWRlby9iYWNrbGlnaHQvS2Nv
bmZpZworKysgYi9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9LY29uZmlnCkBAIC00NTgsNiArNDU4
LDEzIEBAIGNvbmZpZyBCQUNLTElHSFRfUkFWRV9TUAogCWhlbHAKIAkgIFN1cHBvcnQgZm9yIGJh
Y2tsaWdodCBjb250cm9sIG9uIFJBVkUgU1AgZGV2aWNlLgogCitjb25maWcgQkFDS0xJR0hUX0xF
RAorCXRyaXN0YXRlICJHZW5lcmljIExFRCBiYXNlZCBCYWNrbGlnaHQgRHJpdmVyIgorCWRlcGVu
ZHMgb24gTEVEU19DTEFTUyAmJiBPRgorCWhlbHAKKwkgIElmIHlvdSBoYXZlIGEgTENEIGJhY2ts
aWdodCBhZGp1c3RhYmxlIGJ5IExFRCBjbGFzcyBkcml2ZXIsIHNheSBZCisJICB0byBlbmFibGUg
dGhpcyBkcml2ZXIuCisKIGVuZGlmICMgQkFDS0xJR0hUX0NMQVNTX0RFVklDRQogCiBlbmRtZW51
CmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZSBiL2RyaXZlcnMv
dmlkZW8vYmFja2xpZ2h0L01ha2VmaWxlCmluZGV4IDYzYzUwN2MwNzQzNy4uMmE2NzY0Mjk2NmE1
IDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL3ZpZGVvL2JhY2tsaWdodC9NYWtlZmlsZQpAQCAtNTcsMyArNTcsNCBAQCBvYmotJChDT05G
SUdfQkFDS0xJR0hUX1RQUzY1MjE3KQkrPSB0cHM2NTIxN19ibC5vCiBvYmotJChDT05GSUdfQkFD
S0xJR0hUX1dNODMxWCkJCSs9IHdtODMxeF9ibC5vCiBvYmotJChDT05GSUdfQkFDS0xJR0hUX0FS
Q1hDTk4pIAkrPSBhcmN4Y25uX2JsLm8KIG9iai0kKENPTkZJR19CQUNLTElHSFRfUkFWRV9TUCkJ
CSs9IHJhdmUtc3AtYmFja2xpZ2h0Lm8KK29iai0kKENPTkZJR19CQUNLTElHSFRfTEVEKQkJKz0g
bGVkX2JsLm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vYmFja2xpZ2h0L2xlZF9ibC5jIGIv
ZHJpdmVycy92aWRlby9iYWNrbGlnaHQvbGVkX2JsLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi5hYzVmZjc4ZTc4NTkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJz
L3ZpZGVvL2JhY2tsaWdodC9sZWRfYmwuYwpAQCAtMCwwICsxLDI2OCBAQAorLy8gU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgKEMpIDIwMTUtMjAxOSBU
ZXhhcyBJbnN0cnVtZW50cyBJbmNvcnBvcmF0ZWQgLSAgaHR0cDovL3d3dy50aS5jb20vCisgKiBB
dXRob3I6IFRvbWkgVmFsa2VpbmVuIDx0b21pLnZhbGtlaW5lbkB0aS5jb20+CisgKgorICogQmFz
ZWQgb24gcHdtX2JsLmMKKyAqLworCisjaW5jbHVkZSA8bGludXgvYmFja2xpZ2h0Lmg+CisjaW5j
bHVkZSA8bGludXgvZ3Bpby9jb25zdW1lci5oPgorI2luY2x1ZGUgPGxpbnV4L2xlZHMuaD4KKyNp
bmNsdWRlIDxsaW51eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9wbGF0Zm9ybV9kZXZpY2Uu
aD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisKKyNkZWZpbmUgQktMX0ZVTExfQlJJR0hUTkVT
UyAyNTUKKworc3RydWN0IGxlZF9ibF9kYXRhIHsKKwlzdHJ1Y3QgZGV2aWNlCQkqZGV2OworCXN0
cnVjdCBiYWNrbGlnaHRfZGV2aWNlCSpibF9kZXY7CisJc3RydWN0IGxlZF9jbGFzc2RldgkqKmxl
ZHM7CisJYm9vbAkJCWVuYWJsZWQ7CisJaW50CQkJbmJfbGVkczsKKwl1bnNpZ25lZCBpbnQJCSps
ZXZlbHM7CisJdW5zaWduZWQgaW50CQlkZWZhdWx0X2JyaWdodG5lc3M7CisJdW5zaWduZWQgaW50
CQltYXhfYnJpZ2h0bmVzczsKK307CisKK3N0YXRpYyBpbnQgdG9fbGVkX2JyaWdodG5lc3Moc3Ry
dWN0IGxlZF9jbGFzc2RldiAqbGVkLCBpbnQgdmFsdWUpCit7CisJcmV0dXJuICh2YWx1ZSAqIGxl
ZC0+bWF4X2JyaWdodG5lc3MpIC8gQktMX0ZVTExfQlJJR0hUTkVTUzsKK30KKworc3RhdGljIHZv
aWQgbGVkX2JsX3NldF9icmlnaHRuZXNzKHN0cnVjdCBsZWRfYmxfZGF0YSAqcHJpdiwgaW50IGxl
dmVsKQoreworCWludCBpOworCWludCBia2xfYnJpZ2h0bmVzczsKKworCWlmIChwcml2LT5sZXZl
bHMpCisJCWJrbF9icmlnaHRuZXNzID0gcHJpdi0+bGV2ZWxzW2xldmVsXTsKKwllbHNlCisJCWJr
bF9icmlnaHRuZXNzID0gbGV2ZWw7CisKKwlmb3IgKGkgPSAwOyBpIDwgcHJpdi0+bmJfbGVkczsg
aSsrKSB7CisJCWludCBsZWRfYnJpZ2h0bmVzczsKKwkJc3RydWN0IGxlZF9jbGFzc2RldiAqbGVk
ID0gcHJpdi0+bGVkc1tpXTsKKworCQlsZWRfYnJpZ2h0bmVzcyA9IHRvX2xlZF9icmlnaHRuZXNz
KGxlZCwgYmtsX2JyaWdodG5lc3MpOworCQlsZWRfc2V0X2JyaWdodG5lc3MobGVkLCBsZWRfYnJp
Z2h0bmVzcyk7CisJfQorCisJcHJpdi0+ZW5hYmxlZCA9IHRydWU7Cit9CisKK3N0YXRpYyB2b2lk
IGxlZF9ibF9wb3dlcl9vZmYoc3RydWN0IGxlZF9ibF9kYXRhICpwcml2KQoreworCWludCBpOwor
CisJaWYgKCFwcml2LT5lbmFibGVkKQorCQlyZXR1cm47CisKKwlmb3IgKGkgPSAwOyBpIDwgcHJp
di0+bmJfbGVkczsgaSsrKQorCQlsZWRfc2V0X2JyaWdodG5lc3MocHJpdi0+bGVkc1tpXSwgTEVE
X09GRik7CisKKwlwcml2LT5lbmFibGVkID0gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQgbGVkX2Js
X3VwZGF0ZV9zdGF0dXMoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJsKQoreworCXN0cnVjdCBs
ZWRfYmxfZGF0YSAqcHJpdiA9IGJsX2dldF9kYXRhKGJsKTsKKwlpbnQgYnJpZ2h0bmVzcyA9IGJs
LT5wcm9wcy5icmlnaHRuZXNzOworCisJaWYgKGJsLT5wcm9wcy5wb3dlciAhPSBGQl9CTEFOS19V
TkJMQU5LIHx8CisJICAgIGJsLT5wcm9wcy5mYl9ibGFuayAhPSBGQl9CTEFOS19VTkJMQU5LIHx8
CisJICAgIGJsLT5wcm9wcy5zdGF0ZSAmIEJMX0NPUkVfRkJCTEFOSykKKwkJYnJpZ2h0bmVzcyA9
IDA7CisKKwlpZiAoYnJpZ2h0bmVzcyA+IDApCisJCWxlZF9ibF9zZXRfYnJpZ2h0bmVzcyhwcml2
LCBicmlnaHRuZXNzKTsKKwllbHNlCisJCWxlZF9ibF9wb3dlcl9vZmYocHJpdik7CisKKwlyZXR1
cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBiYWNrbGlnaHRfb3BzIGxlZF9ibF9vcHMg
PSB7CisJLnVwZGF0ZV9zdGF0dXMJPSBsZWRfYmxfdXBkYXRlX3N0YXR1cywKK307CisKK3N0YXRp
YyBpbnQgbGVkX2JsX2dldF9sZWRzKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCSAgIHN0cnVjdCBs
ZWRfYmxfZGF0YSAqcHJpdikKK3sKKwlpbnQgaSwgbmJfbGVkcywgcmV0OworCXN0cnVjdCBkZXZp
Y2Vfbm9kZSAqbm9kZSA9IGRldi0+b2Zfbm9kZTsKKwlzdHJ1Y3QgbGVkX2NsYXNzZGV2ICoqbGVk
czsKKwl1bnNpZ25lZCBpbnQgbWF4X2JyaWdodG5lc3M7CisJdW5zaWduZWQgaW50IGRlZmF1bHRf
YnJpZ2h0bmVzczsKKworCXJldCA9IG9mX2NvdW50X3BoYW5kbGVfd2l0aF9hcmdzKG5vZGUsICJs
ZWRzIiwgTlVMTCk7CisJaWYgKHJldCA8IDApIHsKKwkJZGV2X2VycihkZXYsICJVbmFibGUgdG8g
Z2V0IGxlZCBjb3VudFxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCW5iX2xlZHMgPSBy
ZXQ7CisJaWYgKG5iX2xlZHMgPCAxKSB7CisJCWRldl9lcnIoZGV2LCAiQXQgbGVhc3Qgb25lIExF
RCBtdXN0IGJlIHNwZWNpZmllZCFcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlsZWRz
ID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9mKHN0cnVjdCBsZWRfY2xhc3NkZXYgKikgKiBuYl9s
ZWRzLAorCQkJICAgIEdGUF9LRVJORUwpOworCWlmICghbGVkcykKKwkJcmV0dXJuIC1FTk9NRU07
CisKKwlmb3IgKGkgPSAwOyBpIDwgbmJfbGVkczsgaSsrKSB7CisJCWxlZHNbaV0gPSBkZXZtX2xl
ZF9nZXQoZGV2LCBpKTsKKwkJaWYgKElTX0VSUihsZWRzW2ldKSkKKwkJCXJldHVybiBQVFJfRVJS
KGxlZHNbaV0pOworCX0KKworCS8qIGNoZWNrIHRoYXQgdGhlIExFRHMgYWxsIGhhdmUgdGhlIHNh
bWUgYnJpZ2h0bmVzcyByYW5nZSAqLworCW1heF9icmlnaHRuZXNzID0gbGVkc1swXS0+bWF4X2Jy
aWdodG5lc3M7CisJZm9yIChpID0gMTsgaSA8IG5iX2xlZHM7IGkrKykgeworCQlpZiAobWF4X2Jy
aWdodG5lc3MgIT0gbGVkc1tpXS0+bWF4X2JyaWdodG5lc3MpIHsKKwkJCWRldl9lcnIoZGV2LCAi
TEVEcyBtdXN0IGhhdmUgaWRlbnRpY2FsIHJhbmdlc1xuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsK
KwkJfQorCX0KKworCS8qIGdldCB0aGUgZGVmYXVsdCBicmlnaHRuZXNzIGZyb20gdGhlIGZpcnN0
IExFRCBmcm9tIHRoZSBsaXN0ICovCisJZGVmYXVsdF9icmlnaHRuZXNzID0gbGVkc1swXS0+YnJp
Z2h0bmVzczsKKworCXByaXYtPm5iX2xlZHMgPSBuYl9sZWRzOworCXByaXYtPmxlZHMgPSBsZWRz
OworCXByaXYtPm1heF9icmlnaHRuZXNzID0gbWF4X2JyaWdodG5lc3M7CisJcHJpdi0+ZGVmYXVs
dF9icmlnaHRuZXNzID0gZGVmYXVsdF9icmlnaHRuZXNzOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQgbGVkX2JsX3BhcnNlX2xldmVscyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkgICBz
dHJ1Y3QgbGVkX2JsX2RhdGEgKnByaXYpCit7CisJc3RydWN0IGRldmljZV9ub2RlICpub2RlID0g
ZGV2LT5vZl9ub2RlOworCWludCBudW1fbGV2ZWxzOworCXUzMiB2YWx1ZTsKKwlpbnQgcmV0Owor
CisJaWYgKCFub2RlKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCW51bV9sZXZlbHMgPSBvZl9wcm9w
ZXJ0eV9jb3VudF91MzJfZWxlbXMobm9kZSwgImJyaWdodG5lc3MtbGV2ZWxzIik7CisJaWYgKG51
bV9sZXZlbHMgPiAxKSB7CisJCWludCBpOworCQl1bnNpZ25lZCBpbnQgZGI7CisJCXUzMiAqbGV2
ZWxzID0gTlVMTDsKKworCQlsZXZlbHMgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YodTMyKSAq
IG51bV9sZXZlbHMsCisJCQkJICAgICAgR0ZQX0tFUk5FTCk7CisJCWlmICghbGV2ZWxzKQorCQkJ
cmV0dXJuIC1FTk9NRU07CisKKwkJcmV0ID0gb2ZfcHJvcGVydHlfcmVhZF91MzJfYXJyYXkobm9k
ZSwgImJyaWdodG5lc3MtbGV2ZWxzIiwKKwkJCQkJCWxldmVscywKKwkJCQkJCW51bV9sZXZlbHMp
OworCQlpZiAocmV0IDwgMCkKKwkJCXJldHVybiByZXQ7CisKKwkJLyoKKwkJICogVHJ5IHRvIG1h
cCBhY3R1YWwgTEVEIGJyaWdodG5lc3MgdG8gYmFja2xpZ2h0IGJyaWdodG5lc3MKKwkJICogbGV2
ZWwKKwkJICovCisJCWRiID0gcHJpdi0+ZGVmYXVsdF9icmlnaHRuZXNzOworCQlmb3IgKGkgPSAw
IDsgaSA8IG51bV9sZXZlbHM7IGkrKykgeworCQkJaWYgKChpICYmIGRiID4gbGV2ZWxzW2ktMV0p
ICYmIGRiIDw9IGxldmVsc1tpXSkKKwkJCQlicmVhazsKKwkJfQorCQlwcml2LT5kZWZhdWx0X2Jy
aWdodG5lc3MgPSBpOworCQlwcml2LT5tYXhfYnJpZ2h0bmVzcyA9IG51bV9sZXZlbHMgLSAxOwor
CQlwcml2LT5sZXZlbHMgPSBsZXZlbHM7CisJfSBlbHNlIGlmIChudW1fbGV2ZWxzID49IDApCisJ
CWRldl93YXJuKGRldiwgIk5vdCBlbm91Z2ggbGV2ZWxzIGRlZmluZWRcbiIpOworCisJcmV0ID0g
b2ZfcHJvcGVydHlfcmVhZF91MzIobm9kZSwgImRlZmF1bHQtYnJpZ2h0bmVzcy1sZXZlbCIsICZ2
YWx1ZSk7CisJaWYgKCFyZXQgJiYgdmFsdWUgPD0gcHJpdi0+bWF4X2JyaWdodG5lc3MpCisJCXBy
aXYtPmRlZmF1bHRfYnJpZ2h0bmVzcyA9IHZhbHVlOworCWVsc2UgaWYgKCFyZXQgICYmIHZhbHVl
ID4gcHJpdi0+bWF4X2JyaWdodG5lc3MpCisJCWRldl93YXJuKGRldiwgIkludmFsaWQgZGVmYXVs
dCBicmlnaHRuZXNzLiBJZ25vcmluZyBpdFxuIik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBsZWRfYmxfcHJvYmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1
Y3QgYmFja2xpZ2h0X3Byb3BlcnRpZXMgcHJvcHM7CisJc3RydWN0IGxlZF9ibF9kYXRhICpwcml2
OworCWludCByZXQ7CisKKwlwcml2ID0gZGV2bV9remFsbG9jKCZwZGV2LT5kZXYsIHNpemVvZigq
cHJpdiksIEdGUF9LRVJORUwpOworCWlmICghcHJpdikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlw
bGF0Zm9ybV9zZXRfZHJ2ZGF0YShwZGV2LCBwcml2KTsKKworCXByaXYtPmRldiA9ICZwZGV2LT5k
ZXY7CisKKwlyZXQgPSBsZWRfYmxfZ2V0X2xlZHMoJnBkZXYtPmRldiwgcHJpdik7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IGxlZF9ibF9wYXJzZV9sZXZlbHMoJnBkZXYtPmRl
diwgcHJpdik7CisJaWYgKHJldCA8IDApIHsKKwkJZGV2X2VycigmcGRldi0+ZGV2LCAiRmFpbGVk
IHRvIHBhcnNlIERUIGRhdGFcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCW1lbXNldCgmcHJv
cHMsIDAsIHNpemVvZihzdHJ1Y3QgYmFja2xpZ2h0X3Byb3BlcnRpZXMpKTsKKwlwcm9wcy50eXBl
ID0gQkFDS0xJR0hUX1JBVzsKKwlwcm9wcy5tYXhfYnJpZ2h0bmVzcyA9IHByaXYtPm1heF9icmln
aHRuZXNzOworCXByb3BzLmJyaWdodG5lc3MgPSBwcml2LT5kZWZhdWx0X2JyaWdodG5lc3M7CisJ
cHJvcHMucG93ZXIgPSAocHJpdi0+ZGVmYXVsdF9icmlnaHRuZXNzID4gMCkgPyBGQl9CTEFOS19Q
T1dFUkRPV04gOgorCQkgICAgICBGQl9CTEFOS19VTkJMQU5LOworCXByaXYtPmJsX2RldiA9IGJh
Y2tsaWdodF9kZXZpY2VfcmVnaXN0ZXIoZGV2X25hbWUoJnBkZXYtPmRldiksCisJCQkmcGRldi0+
ZGV2LCBwcml2LCAmbGVkX2JsX29wcywgJnByb3BzKTsKKwlpZiAoSVNfRVJSKHByaXYtPmJsX2Rl
dikpIHsKKwkJZGV2X2VycigmcGRldi0+ZGV2LCAiRmFpbGVkIHRvIHJlZ2lzdGVyIGJhY2tsaWdo
dFxuIik7CisJCXJldHVybiBQVFJfRVJSKHByaXYtPmJsX2Rldik7CisJfQorCisJYmFja2xpZ2h0
X3VwZGF0ZV9zdGF0dXMocHJpdi0+YmxfZGV2KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGxlZF9ibF9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1
Y3QgbGVkX2JsX2RhdGEgKnByaXYgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShwZGV2KTsKKwlzdHJ1
Y3QgYmFja2xpZ2h0X2RldmljZSAqYmwgPSBwcml2LT5ibF9kZXY7CisKKwliYWNrbGlnaHRfZGV2
aWNlX3VucmVnaXN0ZXIoYmwpOworCisJbGVkX2JsX3Bvd2VyX29mZihwcml2KTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBsZWRfYmxfb2ZfbWF0
Y2hbXSA9IHsKKwl7IC5jb21wYXRpYmxlID0gImxlZC1iYWNrbGlnaHQiIH0sCisJeyB9Cit9Owor
CitNT0RVTEVfREVWSUNFX1RBQkxFKG9mLCBsZWRfYmxfb2ZfbWF0Y2gpOworCitzdGF0aWMgc3Ry
dWN0IHBsYXRmb3JtX2RyaXZlciBsZWRfYmxfZHJpdmVyID0geworCS5kcml2ZXIJCT0geworCQku
bmFtZQkJPSAibGVkLWJhY2tsaWdodCIsCisJCS5vZl9tYXRjaF90YWJsZQk9IG9mX21hdGNoX3B0
cihsZWRfYmxfb2ZfbWF0Y2gpLAorCX0sCisJLnByb2JlCQk9IGxlZF9ibF9wcm9iZSwKKwkucmVt
b3ZlCQk9IGxlZF9ibF9yZW1vdmUsCit9OworCittb2R1bGVfcGxhdGZvcm1fZHJpdmVyKGxlZF9i
bF9kcml2ZXIpOworCitNT0RVTEVfREVTQ1JJUFRJT04oIkxFRCBiYXNlZCBCYWNrbGlnaHQgRHJp
dmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIik7CitNT0RVTEVfQUxJQVMoInBsYXRmb3JtOmxl
ZC1iYWNrbGlnaHQiKTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vZHJpLWRldmVs
