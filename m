Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3221CCB0BC
	for <lists+dri-devel@lfdr.de>; Thu,  3 Oct 2019 23:01:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 434E96EA86;
	Thu,  3 Oct 2019 21:01:33 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 05A6A6EA86;
 Thu,  3 Oct 2019 21:01:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18715183-1500050 
 for multiple; Thu, 03 Oct 2019 22:01:04 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH 5/5] drm/mm: Use clear_bit_unlock() for releasing the
 drm_mm_node()
Date: Thu,  3 Oct 2019 22:01:00 +0100
Message-Id: <20191003210100.22250-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003210100.22250-1-chris@chris-wilson.co.uk>
References: <20191003210100.22250-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, tvrtko.ursulin@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QSBmZXcgY2FsbGVycyBuZWVkIHRvIHNlcmlhbGlzZSB0aGUgZGVzdHJ1Y3Rpb24gb2YgdGhlaXIg
ZHJtX21tX25vZGUgYW5kCmVuc3VyZSBpdCBpcyByZW1vdmVkIGZyb20gdGhlIGRybV9tbSBiZWZv
cmUgZnJlZWluZy4gSG93ZXZlciwgdG8gYmUKY29tcGxldGVseSBzdXJlIHRoYXQgYW55IGFjY2Vz
cyBmcm9tIGFub3RoZXIgdGhyZWFkIGlzIGNvbXBsZXRlIGJlZm9yZQp3ZSBmcmVlIHRoZSBzdHJ1
Y3QsIHdlIHJlcXVpcmUgdGhlIFJFTEVBU0Ugc2VtYW50aWNzIG9mCmNsZWFyX2JpdF91bmxvY2so
KS4KClRoaXMgYWxsb3dzIHRoZSBjb25kaXRpb25hbCBsb2NraW5nIHN1Y2ggYXMKClRocmVhZCBB
CQkJCVRocmVhZCBCCiAgICBtdXRleF9sb2NrKG1tX2xvY2spOyAgICAgICAgICAgICAgICBpZiAo
ZHJtX21tX25vZGVfYWxsb2NhdGVkKG5vZGUpKSB7CiAgICBkcm1fbW1fbm9kZV9yZW1vdmUobm9k
ZSk7ICAgICAgICAgICAgICAgbXV0ZXhfbG9jayhtbV9sb2NrKTsKICAgIG11dGV4X3VubG9jayht
bV9sb2NrKTsgICAgICAgICAgICAgICAgICBkcm1fbW1fbm9kZV9yZW1vdmUobm9kZSk7CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXV0ZXhfdW5sb2NrKG1tX2xv
Y2spOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZnJlZShub2RlKTsKCnRvIHNlcmlhbGlz
ZSBjb3JyZWN0bHkgd2l0aG91dCBhbnkgbGluZ2VyaW5nIGFjY2Vzc2VzIGZyb20gQSB0byB0aGUK
ZnJlZWQgbm9kZS4gQWxsb2NhdGlvbiAvIGluc2VydGlvbiBvZiB0aGUgbm9kZSBpcyBhc3N1bWVk
IG5ldmVyIHRvIHJhY2UKd2l0aCByZW1vdmFsIG9yIGV2aWN0aW9uIHNjYW5uaW5nLgoKU2lnbmVk
LW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2RybV9tbS5jIHwgMTEgKysrKysrLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA2
IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9tbS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9tbS5jCmluZGV4IGE5Y2FiNWU1Mzcz
MS4uMmE2ZTM0NjYzMTQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX21tLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9tbS5jCkBAIC00MjQsOSArNDI0LDkgQEAgaW50IGRybV9t
bV9yZXNlcnZlX25vZGUoc3RydWN0IGRybV9tbSAqbW0sIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9k
ZSkKIAogCW5vZGUtPm1tID0gbW07CiAKKwlfX3NldF9iaXQoRFJNX01NX05PREVfQUxMT0NBVEVE
X0JJVCwgJm5vZGUtPmZsYWdzKTsKIAlsaXN0X2FkZCgmbm9kZS0+bm9kZV9saXN0LCAmaG9sZS0+
bm9kZV9saXN0KTsKIAlkcm1fbW1faW50ZXJ2YWxfdHJlZV9hZGRfbm9kZShob2xlLCBub2RlKTsK
LQlfX3NldF9iaXQoRFJNX01NX05PREVfQUxMT0NBVEVEX0JJVCwgJm5vZGUtPmZsYWdzKTsKIAlu
b2RlLT5ob2xlX3NpemUgPSAwOwogCiAJcm1faG9sZShob2xlKTsKQEAgLTU0Myw5ICs1NDMsOSBA
QCBpbnQgZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKHN0cnVjdCBkcm1fbW0gKiBjb25zdCBt
bSwKIAkJbm9kZS0+Y29sb3IgPSBjb2xvcjsKIAkJbm9kZS0+aG9sZV9zaXplID0gMDsKIAorCQlf
X3NldF9iaXQoRFJNX01NX05PREVfQUxMT0NBVEVEX0JJVCwgJm5vZGUtPmZsYWdzKTsKIAkJbGlz
dF9hZGQoJm5vZGUtPm5vZGVfbGlzdCwgJmhvbGUtPm5vZGVfbGlzdCk7CiAJCWRybV9tbV9pbnRl
cnZhbF90cmVlX2FkZF9ub2RlKGhvbGUsIG5vZGUpOwotCQlfX3NldF9iaXQoRFJNX01NX05PREVf
QUxMT0NBVEVEX0JJVCwgJm5vZGUtPmZsYWdzKTsKIAogCQlybV9ob2xlKGhvbGUpOwogCQlpZiAo
YWRqX3N0YXJ0ID4gaG9sZV9zdGFydCkKQEAgLTU4OSwxMSArNTg5LDEyIEBAIHZvaWQgZHJtX21t
X3JlbW92ZV9ub2RlKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKIAogCWRybV9tbV9pbnRlcnZh
bF90cmVlX3JlbW92ZShub2RlLCAmbW0tPmludGVydmFsX3RyZWUpOwogCWxpc3RfZGVsKCZub2Rl
LT5ub2RlX2xpc3QpOwotCV9fY2xlYXJfYml0KERSTV9NTV9OT0RFX0FMTE9DQVRFRF9CSVQsICZu
b2RlLT5mbGFncyk7CiAKIAlpZiAoZHJtX21tX2hvbGVfZm9sbG93cyhwcmV2X25vZGUpKQogCQly
bV9ob2xlKHByZXZfbm9kZSk7CiAJYWRkX2hvbGUocHJldl9ub2RlKTsKKworCWNsZWFyX2JpdF91
bmxvY2soRFJNX01NX05PREVfQUxMT0NBVEVEX0JJVCwgJm5vZGUtPmZsYWdzKTsKIH0KIEVYUE9S
VF9TWU1CT0woZHJtX21tX3JlbW92ZV9ub2RlKTsKIApAQCAtNjE0LDYgKzYxNSw3IEBAIHZvaWQg
ZHJtX21tX3JlcGxhY2Vfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm9sZCwgc3RydWN0IGRybV9t
bV9ub2RlICpuZXcpCiAKIAkqbmV3ID0gKm9sZDsKIAorCV9fc2V0X2JpdChEUk1fTU1fTk9ERV9B
TExPQ0FURURfQklULCAmbmV3LT5mbGFncyk7CiAJbGlzdF9yZXBsYWNlKCZvbGQtPm5vZGVfbGlz
dCwgJm5ldy0+bm9kZV9saXN0KTsKIAlyYl9yZXBsYWNlX25vZGVfY2FjaGVkKCZvbGQtPnJiLCAm
bmV3LT5yYiwgJm1tLT5pbnRlcnZhbF90cmVlKTsKIApAQCAtNjI3LDggKzYyOSw3IEBAIHZvaWQg
ZHJtX21tX3JlcGxhY2Vfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm9sZCwgc3RydWN0IGRybV9t
bV9ub2RlICpuZXcpCiAJCQkJJm1tLT5ob2xlc19hZGRyKTsKIAl9CiAKLQlfX2NsZWFyX2JpdChE
Uk1fTU1fTk9ERV9BTExPQ0FURURfQklULCAmb2xkLT5mbGFncyk7Ci0JX19zZXRfYml0KERSTV9N
TV9OT0RFX0FMTE9DQVRFRF9CSVQsICZuZXctPmZsYWdzKTsKKwljbGVhcl9iaXRfdW5sb2NrKERS
TV9NTV9OT0RFX0FMTE9DQVRFRF9CSVQsICZvbGQtPmZsYWdzKTsKIH0KIEVYUE9SVF9TWU1CT0wo
ZHJtX21tX3JlcGxhY2Vfbm9kZSk7CiAKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
