Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 01575EC75
	for <lists+dri-devel@lfdr.de>; Tue, 30 Apr 2019 00:08:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 259D9892E4;
	Mon, 29 Apr 2019 22:08:30 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x543.google.com (mail-pg1-x543.google.com
 [IPv6:2607:f8b0:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 15852892E4
 for <dri-devel@lists.freedesktop.org>; Mon, 29 Apr 2019 22:08:29 +0000 (UTC)
Received: by mail-pg1-x543.google.com with SMTP id t22so2811680pgi.10
 for <dri-devel@lists.freedesktop.org>; Mon, 29 Apr 2019 15:08:29 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=neudzHMjG+trVVVGpjV7l9fWvO6StovsfoKxdSU/ZIA=;
 b=AWROIKbWyc/45g3jZvRmQ3Otr9vyWxDqWjESTprBAmW9ctuAApY549KXp1D3F7hRdn
 7k3uwKG7fNAwvGVgeQA+NTRtXVTuOCCYvAjh5EeOsLtlYSN9qNP0OngpLj+iq1V4l/eE
 iKK4+94jBXqaNZqce0cKvV0/elQQ6zYSQVoBOWxoCMxBmxlQqXTLgqgNc7Ttw1ppJxTx
 EiBmft+KHWUDupemlCP6b+snw5Y0w9Y8MT70HnKy1EAR8bK0n93v4TS7iLAPpFtnyBoa
 VfjfeH4kMKKKBOR9QndM043e7IHOq93ugUB943gKppULHWwPjJ3W8MYD3f2HBDOUdLFf
 IZGA==
X-Gm-Message-State: APjAAAXLPKeC/SvYQnt/t6H1kuBYRr+yX2UTaImCLJLLfLMJ2EGjTG9W
 RpkvuB8kSGBQSj35JcaEUzUfXr1b
X-Google-Smtp-Source: APXvYqzbmnrjBmExhJ3it6/PaKTv8B/fYuVhR6UQOeIjQCeR9sWjd3dhQpfWgu915YZNl9vHK4DrUA==
X-Received: by 2002:a65:4907:: with SMTP id p7mr12744067pgs.288.1556575708070; 
 Mon, 29 Apr 2019 15:08:28 -0700 (PDT)
Received: from olv0.mtv.corp.google.com
 ([2620:15c:202:201:9649:82d6:f889:b307])
 by smtp.gmail.com with ESMTPSA id g3sm14828635pfm.167.2019.04.29.15.08.27
 for <dri-devel@lists.freedesktop.org>
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 29 Apr 2019 15:08:27 -0700 (PDT)
From: Chia-I Wu <olvaffe@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/3] drm/virtio: set seqno for dma-fence
Date: Mon, 29 Apr 2019 15:08:23 -0700
Message-Id: <20190429220825.156644-1-olvaffe@gmail.com>
X-Mailer: git-send-email 2.21.0.593.g511ec345e18-goog
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=neudzHMjG+trVVVGpjV7l9fWvO6StovsfoKxdSU/ZIA=;
 b=EAG9jofuxrKzhgGJAiMmQYJxKdNBHe+HxBCZAFLhQmKo2VKtiX9sMaudaEVVUuJbU0
 cGC7Ab55v91eh/WpQXQP/QMKb4uO+dR/NWLibN1iZeQHgLKuHp+jFGKw9ggyJk5rUXMe
 I83gbSA0b3tt2c+6a/Ok29TWlIPt3Gr911IW7DOgI6+ojW9S9+BMiDFHoPvAWqkevuBw
 gQIWN2Pjh1IFtY3GfpjnZ4beEaLbQNpzWsokrpIqyqlDkF4XZzfVFEo5KDfi9tmG8L8j
 unJgJUJrQ2Z5usush4n5xFDE8FdYnIFan5DIACzR3fJHm1mF6qCFcZZW9jQmVjYVb1uH
 5Jsg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBtb3RpdmF0ZWQgYnkgaGF2aW5nIG1lYW5pbmdmdWwgZnRyYWNlIGV2ZW50cywgYnV0
IGl0IGFsc28KZml4ZXMgdXNlIGNhc2VzIHdoZXJlIGRtYV9mZW5jZV9pc19sYXRlciBpcyBjYWxs
ZWQsIHN1Y2ggYXMgaW4Kc3luY19maWxlX21lcmdlLgoKSW4gb3RoZXIgZHJpdmVycywgZmVuY2Ug
Y3JlYXRpb24gYW5kIGNtZGJ1ZiBzdWJtaXNzaW9uIG5vcm1hbGx5CmhhcHBlbiBhdG9taWNhbGx5
LAoKICBtdXRleF9sb2NrKCk7CiAgZmVuY2UgPSBkbWFfZmVuY2VfY3JlYXRlKC4uLiwgKyt0aW1l
bGluZS0+c2Vxbm8pOwogIHN1Ym1pdF9jbWRidWYoKTsKICBtdXRleF91bmxvY2soKTsKCmFuZCBo
YXZlIG5vIHN1Y2ggaXNzdWUuICBCdXQgaW4gb3VyIGRyaXZlciwgYmVjYXVzZSBtb3N0IGlvY3Rs
cwpxdWV1ZSBjb21tYW5kcyBpbnRvIGN0cmxxLCB3ZSBkbyBub3Qgd2FudCB0byBncmFiIGEgbG9j
ay4gIEluc3RlYWQsCndlIHNldCBzZXFubyB0byAwIHdoZW4gYSBmZW5jZSBpcyBjcmVhdGVkLCBh
bmQgdXBkYXRlIGl0IHdoZW4gdGhlCmNvbW1hbmQgaXMgZmluYWxseSBxdWV1ZWQgYW5kIHRoZSBz
ZXFubyBpcyBrbm93bi4KClNpZ25lZC1vZmYtYnk6IENoaWEtSSBXdSA8b2x2YWZmZUBnbWFpbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oICAgfCAgMSAtCiBk
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZmVuY2UuYyB8IDE3ICsrKysrKysrKystLS0t
LS0tCiAyIGZpbGVzIGNoYW5nZWQsIDEwIGluc2VydGlvbnMoKyksIDggZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oIGIvZHJpdmVy
cy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCmluZGV4IDQ5MWRlYzA3MTJiMy4uOTA0NjFm
ZWVhZmRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rydi5oCkBAIC0xMDIsNyArMTAy
LDYgQEAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UgewogCXN0cnVjdCBkbWFfZmVuY2UgZjsKIAlz
dHJ1Y3QgdmlydGlvX2dwdV9mZW5jZV9kcml2ZXIgKmRydjsKIAlzdHJ1Y3QgbGlzdF9oZWFkIG5v
ZGU7Ci0JdWludDY0X3Qgc2VxOwogfTsKICNkZWZpbmUgdG9fdmlydGlvX2ZlbmNlKHgpIFwKIAlj
b250YWluZXJfb2YoeCwgc3RydWN0IHZpcnRpb19ncHVfZmVuY2UsIGYpCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZmVuY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9mZW5jZS5jCmluZGV4IDg3ZDE5NjYxOTJmNC4uNzJiNGY3NTYxNDMyIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZmVuY2UuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZmVuY2UuYwpAQCAtNDAsMTYgKzQwLDE0IEBA
IGJvb2wgdmlydGlvX2ZlbmNlX3NpZ25hbGVkKHN0cnVjdCBkbWFfZmVuY2UgKmYpCiB7CiAJc3Ry
dWN0IHZpcnRpb19ncHVfZmVuY2UgKmZlbmNlID0gdG9fdmlydGlvX2ZlbmNlKGYpOwogCi0JaWYg
KGF0b21pYzY0X3JlYWQoJmZlbmNlLT5kcnYtPmxhc3Rfc2VxKSA+PSBmZW5jZS0+c2VxKQorCWlm
IChhdG9taWM2NF9yZWFkKCZmZW5jZS0+ZHJ2LT5sYXN0X3NlcSkgPj0gZmVuY2UtPmYuc2Vxbm8p
CiAJCXJldHVybiB0cnVlOwogCXJldHVybiBmYWxzZTsKIH0KIAogc3RhdGljIHZvaWQgdmlydGlv
X2ZlbmNlX3ZhbHVlX3N0cihzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBjaGFyICpzdHIsIGludCBzaXpl
KQogewotCXN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSA9IHRvX3ZpcnRpb19mZW5jZShm
KTsKLQotCXNucHJpbnRmKHN0ciwgc2l6ZSwgIiVsbHUiLCBmZW5jZS0+c2VxKTsKKwlzbnByaW50
ZihzdHIsIHNpemUsICIlbGx1IiwgZi0+c2Vxbm8pOwogfQogCiBzdGF0aWMgdm9pZCB2aXJ0aW9f
dGltZWxpbmVfdmFsdWVfc3RyKHN0cnVjdCBkbWFfZmVuY2UgKmYsIGNoYXIgKnN0ciwgaW50IHNp
emUpCkBAIC03Niw2ICs3NCwxMSBAQCBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqdmlydGlvX2dw
dV9mZW5jZV9hbGxvYyhzdHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2KQogCQlyZXR1cm4g
ZmVuY2U7CiAKIAlmZW5jZS0+ZHJ2ID0gZHJ2OworCisJLyogVGhpcyBvbmx5IHBhcnRpYWxseSBp
bml0aWFsaXplcyB0aGUgZmVuY2UgYmVjYXVzZSB0aGUgc2Vxbm8gaXMKKwkgKiB1bmtub3duIHll
dC4gIFRoZSBmZW5jZSBtdXN0IG5vdCBiZSB1c2VkIG91dHNpZGUgb2YgdGhlIGRyaXZlcgorCSAq
IHVudGlsIHZpcnRpb19ncHVfZmVuY2VfZW1pdCBpcyBjYWxsZWQuCisJICovCiAJZG1hX2ZlbmNl
X2luaXQoJmZlbmNlLT5mLCAmdmlydGlvX2ZlbmNlX29wcywgJmRydi0+bG9jaywgZHJ2LT5jb250
ZXh0LCAwKTsKIAogCXJldHVybiBmZW5jZTsKQEAgLTg5LDEzICs5MiwxMyBAQCBpbnQgdmlydGlv
X2dwdV9mZW5jZV9lbWl0KHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdkZXYsCiAJdW5zaWdu
ZWQgbG9uZyBpcnFfZmxhZ3M7CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmZHJ2LT5sb2NrLCBpcnFf
ZmxhZ3MpOwotCWZlbmNlLT5zZXEgPSArK2Rydi0+c3luY19zZXE7CisJZmVuY2UtPmYuc2Vxbm8g
PSArK2Rydi0+c3luY19zZXE7CiAJZG1hX2ZlbmNlX2dldCgmZmVuY2UtPmYpOwogCWxpc3RfYWRk
X3RhaWwoJmZlbmNlLT5ub2RlLCAmZHJ2LT5mZW5jZXMpOwogCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJmRydi0+bG9jaywgaXJxX2ZsYWdzKTsKIAogCWNtZF9oZHItPmZsYWdzIHw9IGNwdV90b19s
ZTMyKFZJUlRJT19HUFVfRkxBR19GRU5DRSk7Ci0JY21kX2hkci0+ZmVuY2VfaWQgPSBjcHVfdG9f
bGU2NChmZW5jZS0+c2VxKTsKKwljbWRfaGRyLT5mZW5jZV9pZCA9IGNwdV90b19sZTY0KGZlbmNl
LT5mLnNlcW5vKTsKIAlyZXR1cm4gMDsKIH0KIApAQCAtMTA5LDcgKzExMiw3IEBAIHZvaWQgdmly
dGlvX2dwdV9mZW5jZV9ldmVudF9wcm9jZXNzKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdk
ZXYsCiAJc3Bpbl9sb2NrX2lycXNhdmUoJmRydi0+bG9jaywgaXJxX2ZsYWdzKTsKIAlhdG9taWM2
NF9zZXQoJnZnZGV2LT5mZW5jZV9kcnYubGFzdF9zZXEsIGxhc3Rfc2VxKTsKIAlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUoZmVuY2UsIHRtcCwgJmRydi0+ZmVuY2VzLCBub2RlKSB7Ci0JCWlmIChs
YXN0X3NlcSA8IGZlbmNlLT5zZXEpCisJCWlmIChsYXN0X3NlcSA8IGZlbmNlLT5mLnNlcW5vKQog
CQkJY29udGludWU7CiAJCWRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKCZmZW5jZS0+Zik7CiAJCWxp
c3RfZGVsKCZmZW5jZS0+bm9kZSk7Ci0tIAoyLjIxLjAuNTkzLmc1MTFlYzM0NWUxOC1nb29nCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
