Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8EF0BBB68F
	for <lists+dri-devel@lfdr.de>; Mon, 23 Sep 2019 16:22:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 21E146E92A;
	Mon, 23 Sep 2019 14:22:05 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from inva020.nxp.com (inva020.nxp.com [92.121.34.13])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 484886E928
 for <dri-devel@lists.freedesktop.org>; Mon, 23 Sep 2019 14:22:03 +0000 (UTC)
Received: from inva020.nxp.com (localhost [127.0.0.1])
 by inva020.eu-rdc02.nxp.com (Postfix) with ESMTP id 1FBDE1A0303;
 Mon, 23 Sep 2019 16:14:24 +0200 (CEST)
Received: from inva024.eu-rdc02.nxp.com (inva024.eu-rdc02.nxp.com
 [134.27.226.22])
 by inva020.eu-rdc02.nxp.com (Postfix) with ESMTP id 058181A02F2;
 Mon, 23 Sep 2019 16:14:24 +0200 (CEST)
Received: from fsr-ub1664-121.ea.freescale.net
 (fsr-ub1664-121.ea.freescale.net [10.171.82.171])
 by inva024.eu-rdc02.nxp.com (Postfix) with ESMTP id 1B2D820613;
 Mon, 23 Sep 2019 16:14:23 +0200 (CEST)
From: Laurentiu Palcu <laurentiu.palcu@nxp.com>
To: Philipp Zabel <p.zabel@pengutronix.de>, Shawn Guo <shawnguo@kernel.org>,
 Sascha Hauer <s.hauer@pengutronix.de>,
 Pengutronix Kernel Team <kernel@pengutronix.de>,
 Fabio Estevam <festevam@gmail.com>, NXP Linux Team <linux-imx@nxp.com>
Subject: [PATCH 3/5] drm/imx: Add initial support for DCSS on iMX8MQ
Date: Mon, 23 Sep 2019 17:13:17 +0300
Message-Id: <1569248002-2485-4-git-send-email-laurentiu.palcu@nxp.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1569248002-2485-1-git-send-email-laurentiu.palcu@nxp.com>
References: <1569248002-2485-1-git-send-email-laurentiu.palcu@nxp.com>
X-Virus-Scanned: ClamAV using ClamSMTP
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: agx@sigxcpu.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, Laurentiu Palcu <laurentiu.palcu@nxp.com>,
 linux-arm-kernel@lists.infradead.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGluaXRpYWwgc3VwcG9ydCBmb3IgaU1YOE1RJ3MgRGlzcGxheSBDb250cm9sbGVy
IFN1YnN5c3RlbSAoRENTUykuClNvbWUgb2YgaXRzIGNhcGFiaWxpdGllcyBpbmNsdWRlOgogKiA0
S0A2MGZwczsKICogSERSMTA7CiAqIG9uZSBncmFwaGljcyBhbmQgMiB2aWRlbyBwaXBlbGluZXM7
CiAqIG9uLXRoZS1mbHkgZGVjb21wcmVzc2lvbiBvZiBjb21wcmVzc2VkIHZpZGVvIGFuZCBncmFw
aGljczsKClRoZSByZWZlcmVuY2UgbWFudWFsIGNhbiBiZSBmb3VuZCBoZXJlOgpodHRwczovL3d3
dy5ueHAuY29tL3dlYmFwcC9Eb3dubG9hZD9jb2xDb2RlPUlNWDhNRFFMUVJNCgpUaGUgY3VycmVu
dCBwYXRjaCBhZGRzIG9ubHkgYmFzaWMgZnVuY3Rpb25hbGl0eTogb25lIHByaW1hcnkgcGxhbmUg
Zm9yCmdyYXBoaWNzLCBsaW5lYXIsIHRpbGVkIGFuZCBzdXBlci10aWxlZCBidWZmZXJzIHN1cHBv
cnQgKG5vIGdyYXBoaWNzCmRlY29tcHJlc3Npb24geWV0KSwgbm8gSERSMTAgYW5kIG5vIHZpZGVv
IHBsYW5lcy4KClZpZGVvIHBsYW5lcyBzdXBwb3J0IGFuZCBIRFIxMCB3aWxsIGJlIGFkZGVkIGlu
IHN1YnNlcXVlbnQgcGF0Y2hlcyBvbmNlCnBlci1wbGFuZSBkZS1nYW1tYS9DU0MvZ2FtbWEgc3Vw
cG9ydCBpcyBpbi4KClNpZ25lZC1vZmYtYnk6IExhdXJlbnRpdSBQYWxjdSA8bGF1cmVudGl1LnBh
bGN1QG54cC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2lteC9LY29uZmlnICAgICAgICAgICAg
fCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2lteC9NYWtlZmlsZSAgICAgICAgICAgfCAgIDEgKwog
ZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL0tjb25maWcgICAgICAgfCAgIDcgKwogZHJpdmVycy9n
cHUvZHJtL2lteC9kY3NzL01ha2VmaWxlICAgICAgfCAgIDYgKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtYmxrY3RsLmMgfCAgNzUgKysrCiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3Mv
ZGNzcy1jcnRjLmMgICB8IDIyMyArKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9k
Y3NzLWN0eGxkLmMgIHwgNDQ3ICsrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZGV2LmMgICAgfCAyODYgKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aW14L2Rjc3MvZGNzcy1kZXYuaCAgICB8IDE5NSArKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZHByLmMgICAgfCA1NTIgKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHJ2LmMgICAgfCAxODIgKysrKysrKysKIGRyaXZlcnMv
Z3B1L2RybS9pbXgvZGNzcy9kY3NzLWR0Zy5jICAgIHwgNDM4ICsrKysrKysrKysrKysrKysrCiBk
cml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuYyAgICB8IDMyMSArKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuaCAgICB8ICA1MiArKysKIGRyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXBsYW5lLmMgIHwgNDE4ICsrKysrKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zY2FsZXIuYyB8IDgzMCArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXNz
LmMgICAgIHwgMTc5ICsrKysrKysKIDE3IGZpbGVzIGNoYW5nZWQsIDQyMTQgaW5zZXJ0aW9ucygr
KQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL01ha2VmaWxlCiBjcmVh
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtYmxrY3RsLmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jcnRjLmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jdHhsZC5jCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZGV2LmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kZXYuaAogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRwci5jCiBjcmVh
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHJ2LmMKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kdGcuYwogY3JlYXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWttcy5jCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mta21zLmgKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1wbGFuZS5jCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mtc2NhbGVyLmMKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zcy5jCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2lteC9L
Y29uZmlnCmluZGV4IDIwN2JmNzQuLjYyMzEwNDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pbXgvS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L0tjb25maWcKQEAgLTM5LDMg
KzM5LDUgQEAgY29uZmlnIERSTV9JTVhfSERNSQogCWRlcGVuZHMgb24gRFJNX0lNWAogCWhlbHAK
IAkgIENob29zZSB0aGlzIGlmIHlvdSB3YW50IHRvIHVzZSBIRE1JIG9uIGkuTVg2LgorCitzb3Vy
Y2UgImRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnIgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2lteC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvTWFrZWZpbGUKaW5k
ZXggMjFjZGNjMi4uYjY0NGRlZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2lteC9NYWtl
ZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L01ha2VmaWxlCkBAIC05LDMgKzksNCBAQCBv
YmotJChDT05GSUdfRFJNX0lNWF9UVkUpICs9IGlteC10dmUubwogb2JqLSQoQ09ORklHX0RSTV9J
TVhfTERCKSArPSBpbXgtbGRiLm8KIAogb2JqLSQoQ09ORklHX0RSTV9JTVhfSERNSSkgKz0gZHdf
aGRtaS1pbXgubworb2JqLSQoQ09ORklHX0RSTV9JTVhfRENTUykgKz0gZGNzcy8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLjYzOTlj
MTIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvS2NvbmZpZwpA
QCAtMCwwICsxLDcgQEAKK2NvbmZpZyBEUk1fSU1YX0RDU1MKKwl0cmlzdGF0ZSAiaS5NWDhNUSBE
Q1NTIgorCXNlbGVjdCBSRVNFVF9DT05UUk9MTEVSCisJc2VsZWN0IElNWF9JUlFTVEVFUgorCWhl
bHAKKwkgIENob29zZSB0aGlzIGlmIHlvdSBoYXZlIGEgTlhQIGkuTVg4TVEgYmFzZWQgc3lzdGVt
IGFuZCB3YW50IHRvIHVzZSB0aGUKKwkgIERpc3BsYXkgQ29udHJvbGxlciBTdWJzeXN0ZW0uIFRo
aXMgb3B0aW9uIGVuYWJsZXMgRENTUyBzdXBwb3J0LgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2lteC9kY3NzL01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL01ha2VmaWxl
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi44YzdjOGRhCi0tLSAvZGV2L251
bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL01ha2VmaWxlCkBAIC0wLDAgKzEsNiBA
QAoraW14LWRjc3Mtb2JqcyA6PSBkY3NzLWRydi5vIGRjc3MtZGV2Lm8gZGNzcy1ibGtjdGwubyBk
Y3NzLWN0eGxkLm8gZGNzcy1kdGcubyBcCisJCQkJIGRjc3Mtc3MubyBkY3NzLWRwci5vIGRjc3Mt
c2NhbGVyLm8gZGNzcy1rbXMubyBkY3NzLWNydGMubyBcCisJCQkJIGRjc3MtcGxhbmUubworCitv
YmotJChDT05GSUdfRFJNX0lNWF9EQ1NTKSArPSBpbXgtZGNzcy5vCisKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWJsa2N0bC5jIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtYmxrY3RsLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAu
LmVlN2ZmYTEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNz
cy1ibGtjdGwuYwpAQCAtMCwwICsxLDc1IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjog
R1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAqLworCisjaW5jbHVkZSA8bGlu
dXgvZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvb2YuaD4KKworI2luY2x1ZGUgImRjc3MtZGV2
LmgiCisKKyNkZWZpbmUgRENTU19CTEtDVExfUkVTRVRfQ1RSTAkJMHgwMAorI2RlZmluZSAgIEJf
Q0xLX1JFU0VUTgkJCUJJVCgwKQorI2RlZmluZSAgIEFQQl9DTEtfUkVTRVROCQlCSVQoMSkKKyNk
ZWZpbmUgICBQX0NMS19SRVNFVE4JCQlCSVQoMikKKyNkZWZpbmUgICBSVFJfQ0xLX1JFU0VUTgkJ
QklUKDMpCisjZGVmaW5lIERDU1NfQkxLQ1RMX0NPTlRST0wwCQkweDEwCisjZGVmaW5lICAgSERN
SV9NSVBJX0NMS19TRUwJCUJJVCgwKQorI2RlZmluZSAgIERJU1BNSVhfUkVGQ0xLX1NFTF9QT1MJ
NAorI2RlZmluZSAgIERJU1BNSVhfUkVGQ0xLX1NFTF9NQVNLCUdFTk1BU0soNSwgNCkKKyNkZWZp
bmUgICBESVNQTUlYX1BJWENMS19TRUwJCUJJVCg4KQorI2RlZmluZSAgIEhETUlfU1JDX1NFQ1VS
RV9FTgkJQklUKDE2KQorCitzdHJ1Y3QgZGNzc19ibGtjdGwgeworCXN0cnVjdCBkZXZpY2UgKmRl
djsKKwl2b2lkIF9faW9tZW0gKmJhc2VfcmVnOworCisJYm9vbCBoZG1pX291dHB1dDsKK307CisK
K3ZvaWQgZGNzc19ibGtjdGxfY2ZnKHN0cnVjdCBkY3NzX2Jsa2N0bCAqYmxrY3RsKQoreworCWlm
IChibGtjdGwtPmhkbWlfb3V0cHV0KQorCQlkY3NzX3dyaXRlbCgwLCBibGtjdGwtPmJhc2VfcmVn
ICsgRENTU19CTEtDVExfQ09OVFJPTDApOworCWVsc2UKKwkJZGNzc193cml0ZWwoRElTUE1JWF9Q
SVhDTEtfU0VMLAorCQkJICAgIGJsa2N0bC0+YmFzZV9yZWcgKyBEQ1NTX0JMS0NUTF9DT05UUk9M
MCk7CisKKwlkY3NzX3NldChCX0NMS19SRVNFVE4gfCBBUEJfQ0xLX1JFU0VUTiB8IFBfQ0xLX1JF
U0VUTiB8IFJUUl9DTEtfUkVTRVROLAorCQkgYmxrY3RsLT5iYXNlX3JlZyArIERDU1NfQkxLQ1RM
X1JFU0VUX0NUUkwpOworfQorCitpbnQgZGNzc19ibGtjdGxfaW5pdChzdHJ1Y3QgZGNzc19kZXYg
KmRjc3MsIHVuc2lnbmVkIGxvbmcgYmxrY3RsX2Jhc2UpCit7CisJc3RydWN0IGRjc3NfYmxrY3Rs
ICpibGtjdGw7CisKKwlibGtjdGwgPSBkZXZtX2t6YWxsb2MoZGNzcy0+ZGV2LCBzaXplb2YoKmJs
a2N0bCksIEdGUF9LRVJORUwpOworCWlmICghYmxrY3RsKQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CWJsa2N0bC0+YmFzZV9yZWcgPSBkZXZtX2lvcmVtYXAoZGNzcy0+ZGV2LCBibGtjdGxfYmFzZSwg
U1pfNEspOworCWlmICghYmxrY3RsLT5iYXNlX3JlZykgeworCQlkZXZfZXJyKGRjc3MtPmRldiwg
InVuYWJsZSB0byByZW1hcCBCTEsgQ1RSTCBiYXNlXG4iKTsKKwkJZGV2bV9rZnJlZShkY3NzLT5k
ZXYsIGJsa2N0bCk7CisJCXJldHVybiAtRU5PTUVNOworCX0KKworCWRjc3MtPmJsa2N0bCA9IGJs
a2N0bDsKKwlibGtjdGwtPmRldiA9IGRjc3MtPmRldjsKKwlibGtjdGwtPmhkbWlfb3V0cHV0ID0g
ZGNzcy0+aGRtaV9vdXRwdXQ7CisKKwlkY3NzX2Jsa2N0bF9jZmcoYmxrY3RsKTsKKworCXJldHVy
biAwOworfQorCit2b2lkIGRjc3NfYmxrY3RsX2V4aXQoc3RydWN0IGRjc3NfYmxrY3RsICpibGtj
dGwpCit7CisJZGNzc19jbHIoUF9DTEtfUkVTRVROIHwgUlRSX0NMS19SRVNFVE4sCisJCSBibGtj
dGwtPmJhc2VfcmVnICsgRENTU19CTEtDVExfUkVTRVRfQ1RSTCk7CisKKwlpZiAoYmxrY3RsLT5i
YXNlX3JlZykKKwkJZGV2bV9pb3VubWFwKGJsa2N0bC0+ZGV2LCBibGtjdGwtPmJhc2VfcmVnKTsK
KworCWRldm1fa2ZyZWUoYmxrY3RsLT5kZXYsIGJsa2N0bCk7Cit9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rj
c3MvZGNzcy1jcnRjLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLjZhYmI0
MGMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jcnRj
LmMKQEAgLTAsMCArMSwyMjMgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4w
CisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNsdWRlIDxkcm0vZHJtUC5o
PgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGxpbnV4L3Bt
X3J1bnRpbWUuaD4KKworI2luY2x1ZGUgImRjc3MtZGV2LmgiCisjaW5jbHVkZSAiZGNzcy1rbXMu
aCIKKworc3RhdGljIGludCBkY3NzX2VuYWJsZV92Ymxhbmsoc3RydWN0IGRybV9jcnRjICpjcnRj
KQoreworCXN0cnVjdCBkY3NzX2NydGMgKmRjc3NfY3J0YyA9IGNvbnRhaW5lcl9vZihjcnRjLCBz
dHJ1Y3QgZGNzc19jcnRjLAorCQkJCQkJICAgYmFzZSk7CisJc3RydWN0IGRjc3NfZGV2ICpkY3Nz
ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsKKworCWlmIChkY3NzX2NydGMtPmlycV9lbmFibGVk
KQorCQlyZXR1cm4gMDsKKworCWRjc3NfY3J0Yy0+aXJxX2VuYWJsZWQgPSB0cnVlOworCisJZGNz
c19kdGdfdmJsYW5rX2lycV9lbmFibGUoZGNzcy0+ZHRnLCB0cnVlKTsKKworCWRjc3NfZHRnX2N0
eGxkX2tpY2tfaXJxX2VuYWJsZShkY3NzLT5kdGcsIHRydWUpOworCisJZW5hYmxlX2lycShkY3Nz
X2NydGMtPmlycSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgZGNzc19kaXNhYmxl
X3ZibGFuayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCit7CisJc3RydWN0IGRjc3NfY3J0YyAqZGNz
c19jcnRjID0gY29udGFpbmVyX29mKGNydGMsIHN0cnVjdCBkY3NzX2NydGMsCisJCQkJCQkgICBi
YXNlKTsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3MgPSBkY3NzX2NydGMtPmJhc2UuZGV2LT5kZXZf
cHJpdmF0ZTsKKworCWRpc2FibGVfaXJxX25vc3luYyhkY3NzX2NydGMtPmlycSk7CisKKwlkY3Nz
X2R0Z192YmxhbmtfaXJxX2VuYWJsZShkY3NzLT5kdGcsIGZhbHNlKTsKKworCWRjc3NfZHRnX2N0
eGxkX2tpY2tfaXJxX2VuYWJsZShkY3NzLT5kdGcsIGZhbHNlKTsKKworCWRjc3NfY3J0Yy0+aXJx
X2VuYWJsZWQgPSBmYWxzZTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5j
cyBkY3NzX2NydGNfZnVuY3MgPSB7CisJLnNldF9jb25maWcgPSBkcm1fYXRvbWljX2hlbHBlcl9z
ZXRfY29uZmlnLAorCS5kZXN0cm95ID0gZHJtX2NydGNfY2xlYW51cCwKKwkucGFnZV9mbGlwID0g
ZHJtX2F0b21pY19oZWxwZXJfcGFnZV9mbGlwLAorCS5yZXNldCA9IGRybV9hdG9taWNfaGVscGVy
X2NydGNfcmVzZXQsCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBl
cl9jcnRjX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRv
bWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUsCisJLmVuYWJsZV92YmxhbmsgPSBkY3NzX2Vu
YWJsZV92YmxhbmssCisJLmRpc2FibGVfdmJsYW5rID0gZGNzc19kaXNhYmxlX3ZibGFuaywKK307
CisKK3N0YXRpYyB2b2lkIGRjc3NfY3J0Y19hdG9taWNfYmVnaW4oc3RydWN0IGRybV9jcnRjICpj
cnRjLAorCQkJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCit7CisJ
ZHJtX2NydGNfdmJsYW5rX29uKGNydGMpOworCisJc3Bpbl9sb2NrX2lycSgmY3J0Yy0+ZGV2LT5l
dmVudF9sb2NrKTsKKwlpZiAoY3J0Yy0+c3RhdGUtPmV2ZW50KSB7CisJCVdBUk5fT04oZHJtX2Ny
dGNfdmJsYW5rX2dldChjcnRjKSk7CisJCWRybV9jcnRjX2FybV92YmxhbmtfZXZlbnQoY3J0Yywg
Y3J0Yy0+c3RhdGUtPmV2ZW50KTsKKwkJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsKKwl9CisJ
c3Bpbl91bmxvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOworfQorCitzdGF0aWMgdm9p
ZCBkY3NzX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkY3NzX2Ny
dGMgKmRjc3NfY3J0YyA9IGNvbnRhaW5lcl9vZihjcnRjLCBzdHJ1Y3QgZGNzc19jcnRjLAorCQkJ
CQkJICAgYmFzZSk7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0gZGNzc19jcnRjLT5iYXNlLmRl
di0+ZGV2X3ByaXZhdGU7CisKKwlpZiAoZGNzc19kdGdfaXNfZW5hYmxlZChkY3NzLT5kdGcpKQor
CQlkY3NzX2N0eGxkX2VuYWJsZShkY3NzLT5jdHhsZCk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nf
Y3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICAgc3RydWN0
IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZGNzc19jcnRjICpk
Y3NzX2NydGMgPSBjb250YWluZXJfb2YoY3J0Yywgc3RydWN0IGRjc3NfY3J0YywKKwkJCQkJCSAg
IGJhc2UpOworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRjc3NfY3J0Yy0+YmFzZS5kZXYtPmRl
dl9wcml2YXRlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJmNydGMtPnN0YXRl
LT5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCB2aWRlb21vZGUgdm07CisKKwlkcm1fZGlzcGxheV9t
b2RlX3RvX3ZpZGVvbW9kZShtb2RlLCAmdm0pOworCisJcG1fcnVudGltZV9nZXRfc3luYyhkY3Nz
LT5kZXYpOworCisJZGNzc19kdGdfY3R4bGRfa2lja19pcnFfZW5hYmxlKGRjc3MtPmR0ZywgdHJ1
ZSk7CisKKwl2bS5waXhlbGNsb2NrID0gbW9kZS0+Y3J0Y19jbG9jayAqIDEwMDA7CisKKwlkY3Nz
X2R0Z19zeW5jX3NldChkY3NzLT5kdGcsICZ2bSk7CisKKwlkY3NzX3NzX3N1YnNhbV9zZXQoZGNz
cy0+c3MpOworCWRjc3Nfc3Nfc3luY19zZXQoZGNzcy0+c3MsICZ2bSwgbW9kZS0+ZmxhZ3MgJiBE
Uk1fTU9ERV9GTEFHX1BIU1lOQywKKwkJCSBtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfUFZT
WU5DKTsKKworCWRjc3NfZHRnX2Nzc19zZXQoZGNzcy0+ZHRnKTsKKworCWRjc3Nfc3NfZW5hYmxl
KGRjc3MtPnNzKTsKKwlkY3NzX2R0Z19lbmFibGUoZGNzcy0+ZHRnLCB0cnVlLCBOVUxMKTsKKwlk
Y3NzX2N0eGxkX2VuYWJsZShkY3NzLT5jdHhsZCk7CisKKwlyZWluaXRfY29tcGxldGlvbigmZGNz
c19jcnRjLT5lbl9jb21wbGV0aW9uKTsKKwl3YWl0X2Zvcl9jb21wbGV0aW9uX3RpbWVvdXQoJmRj
c3NfY3J0Yy0+ZW5fY29tcGxldGlvbiwKKwkJCQkgICAgbXNlY3NfdG9famlmZmllcyg1MDApKTsK
K30KKworc3RhdGljIHZvaWQgZGNzc19jcnRjX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKKwkJCQkgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUp
Cit7CisJc3RydWN0IGRjc3NfY3J0YyAqZGNzc19jcnRjID0gY29udGFpbmVyX29mKGNydGMsIHN0
cnVjdCBkY3NzX2NydGMsCisJCQkJCQkgICBiYXNlKTsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3Mg
PSBkY3NzX2NydGMtPmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKKworCWRybV9hdG9taWNfaGVscGVy
X2Rpc2FibGVfcGxhbmVzX29uX2NydGMob2xkX2NydGNfc3RhdGUsIGZhbHNlKTsKKworCXNwaW5f
bG9ja19pcnEoJmNydGMtPmRldi0+ZXZlbnRfbG9jayk7CisJaWYgKGNydGMtPnN0YXRlLT5ldmVu
dCkgeworCQlkcm1fY3J0Y19zZW5kX3ZibGFua19ldmVudChjcnRjLCBjcnRjLT5zdGF0ZS0+ZXZl
bnQpOworCQljcnRjLT5zdGF0ZS0+ZXZlbnQgPSBOVUxMOworCX0KKwlzcGluX3VubG9ja19pcnEo
JmNydGMtPmRldi0+ZXZlbnRfbG9jayk7CisKKwlkY3NzX2R0Z19jdHhsZF9raWNrX2lycV9lbmFi
bGUoZGNzcy0+ZHRnLCB0cnVlKTsKKworCWRjc3Nfc3NfZGlzYWJsZShkY3NzLT5zcyk7CisJZGNz
c19kdGdfZW5hYmxlKGRjc3MtPmR0ZywgZmFsc2UsICZkY3NzX2NydGMtPmRpc19jb21wbGV0aW9u
KTsKKwlkY3NzX2N0eGxkX2VuYWJsZShkY3NzLT5jdHhsZCk7CisKKwlyZWluaXRfY29tcGxldGlv
bigmZGNzc19jcnRjLT5kaXNfY29tcGxldGlvbik7CisJd2FpdF9mb3JfY29tcGxldGlvbl90aW1l
b3V0KCZkY3NzX2NydGMtPmRpc19jb21wbGV0aW9uLAorCQkJCSAgICBtc2Vjc190b19qaWZmaWVz
KDEwMCkpOworCisJZHJtX2NydGNfdmJsYW5rX29mZihjcnRjKTsKKworCWRjc3NfZHRnX2N0eGxk
X2tpY2tfaXJxX2VuYWJsZShkY3NzLT5kdGcsIGZhbHNlKTsKKworCXBtX3J1bnRpbWVfcHV0X3N5
bmMoZGNzcy0+ZGV2KTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19oZWxwZXJf
ZnVuY3MgZGNzc19oZWxwZXJfZnVuY3MgPSB7CisJLmF0b21pY19iZWdpbiA9IGRjc3NfY3J0Y19h
dG9taWNfYmVnaW4sCisJLmF0b21pY19mbHVzaCA9IGRjc3NfY3J0Y19hdG9taWNfZmx1c2gsCisJ
LmF0b21pY19lbmFibGUgPSBkY3NzX2NydGNfYXRvbWljX2VuYWJsZSwKKwkuYXRvbWljX2Rpc2Fi
bGUgPSBkY3NzX2NydGNfYXRvbWljX2Rpc2FibGUsCit9OworCitzdGF0aWMgaXJxcmV0dXJuX3Qg
ZGNzc19jcnRjX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmRldl9pZCkKK3sKKwlzdHJ1Y3Qg
ZGNzc19jcnRjICpkY3NzX2NydGMgPSBkZXZfaWQ7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0g
ZGNzc19jcnRjLT5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CisKKwlpZiAoIWRjc3NfZHRnX3ZibGFu
a19pcnFfdmFsaWQoZGNzcy0+ZHRnKSkKKwkJcmV0dXJuIElSUV9IQU5ETEVEOworCisJY29tcGxl
dGUoJmRjc3NfY3J0Yy0+ZW5fY29tcGxldGlvbik7CisKKwlpZiAoZGNzc19jdHhsZF9pc19mbHVz
aGVkKGRjc3MtPmN0eGxkKSkKKwkJZHJtX2NydGNfaGFuZGxlX3ZibGFuaygmZGNzc19jcnRjLT5i
YXNlKTsKKworCWRjc3NfZHRnX3ZibGFua19pcnFfY2xlYXIoZGNzcy0+ZHRnKTsKKworCXJldHVy
biBJUlFfSEFORExFRDsKK30KKworaW50IGRjc3NfY3J0Y19pbml0KHN0cnVjdCBkY3NzX2NydGMg
KmNydGMsIHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7CisJc3RydWN0IGRjc3NfZGV2ICpkY3Nz
ID0gZHJtLT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2ID0gdG9f
cGxhdGZvcm1fZGV2aWNlKGRjc3MtPmRldik7CisJaW50IHJldDsKKworCWNydGMtPnBsYW5lWzBd
ID0gZGNzc19wbGFuZV9pbml0KGRybSwgZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSksCisJCQkJ
CSBEUk1fUExBTkVfVFlQRV9QUklNQVJZLCAwKTsKKwlpZiAoSVNfRVJSKGNydGMtPnBsYW5lWzBd
KSkKKwkJcmV0dXJuIFBUUl9FUlIoY3J0Yy0+cGxhbmVbMF0pOworCisJY3J0Yy0+YmFzZS5wb3J0
ID0gZGNzcy0+b2ZfcG9ydDsKKworCWRybV9jcnRjX2hlbHBlcl9hZGQoJmNydGMtPmJhc2UsICZk
Y3NzX2hlbHBlcl9mdW5jcyk7CisJcmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3BsYW5lcyhkcm0s
ICZjcnRjLT5iYXNlLCAmY3J0Yy0+cGxhbmVbMF0tPmJhc2UsCisJCQkJCU5VTEwsICZkY3NzX2Ny
dGNfZnVuY3MsIE5VTEwpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkY3NzLT5kZXYsICJmYWls
ZWQgdG8gaW5pdCBjcnRjXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwljcnRjLT5pcnEgPSBw
bGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2LCAidmJsYW5rIik7CisJaWYgKGNydGMtPmlycSA8
IDApIHsKKwkJZGV2X2VycihkY3NzLT5kZXYsICJ1bmFibGUgdG8gZ2V0IHZibGFuayBpbnRlcnJ1
cHRcbiIpOworCQlyZXR1cm4gY3J0Yy0+aXJxOworCX0KKworCWluaXRfY29tcGxldGlvbigmY3J0
Yy0+ZW5fY29tcGxldGlvbik7CisJaW5pdF9jb21wbGV0aW9uKCZjcnRjLT5kaXNfY29tcGxldGlv
bik7CisKKwlyZXQgPSBkZXZtX3JlcXVlc3RfaXJxKGRjc3MtPmRldiwgY3J0Yy0+aXJxLCBkY3Nz
X2NydGNfaXJxX2hhbmRsZXIsCisJCQkgICAgICAgSVJRRl9UUklHR0VSX1JJU0lORywgImRjc3Nf
ZHJtIiwgY3J0Yyk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRjc3MtPmRldiwgImlycSByZXF1
ZXN0IGZhaWxlZCB3aXRoICVkLlxuIiwgcmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlkaXNh
YmxlX2lycShjcnRjLT5pcnEpOworCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgZGNzc19jcnRjX2Rl
aW5pdChzdHJ1Y3QgZGNzc19jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX2RldmljZSAqZHJtKQorewor
CXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRybS0+ZGV2X3ByaXZhdGU7CisKKwlkZXZtX2ZyZWVf
aXJxKGRjc3MtPmRldiwgY3J0Yy0+aXJxLCBjcnRjKTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pbXgvZGNzcy9kY3NzLWN0eGxkLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3Mv
ZGNzcy1jdHhsZC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi40ZmUzNWIy
YgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWN0eGxk
LmMKQEAgLTAsMCArMSw0NDcgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4w
CisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9kZWxh
eS5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1tYXBwaW5nLmg+CisjaW5jbHVkZSA8bGludXgvaW50
ZXJydXB0Lmg+CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisKKyNpbmNsdWRl
ICJkY3NzLWRldi5oIgorCisjZGVmaW5lIERDU1NfQ1RYTERfREVWTkFNRQkJImRjc3NfY3R4bGQi
CisKKyNkZWZpbmUgRENTU19DVFhMRF9DT05UUk9MX1NUQVRVUwkweDAKKyNkZWZpbmUgICBDVFhM
RF9FTkFCTEUJCQlCSVQoMCkKKyNkZWZpbmUgICBBUkJfU0VMCQkJQklUKDEpCisjZGVmaW5lICAg
UkRfRVJSX0VOCQkJQklUKDIpCisjZGVmaW5lICAgREJfQ09NUF9FTgkJCUJJVCgzKQorI2RlZmlu
ZSAgIFNCX0hQX0NPTVBfRU4JCQlCSVQoNCkKKyNkZWZpbmUgICBTQl9MUF9DT01QX0VOCQkJQklU
KDUpCisjZGVmaW5lICAgREJfUEVORF9TQl9SRUNfRU4JCUJJVCg2KQorI2RlZmluZSAgIFNCX1BF
TkRfRElTUF9BQ1RJVkVfRU4JQklUKDcpCisjZGVmaW5lICAgQUhCX0VSUl9FTgkJCUJJVCg4KQor
I2RlZmluZSAgIFJEX0VSUgkJCUJJVCgxNikKKyNkZWZpbmUgICBEQl9DT01QCQkJQklUKDE3KQor
I2RlZmluZSAgIFNCX0hQX0NPTVAJCQlCSVQoMTgpCisjZGVmaW5lICAgU0JfTFBfQ09NUAkJCUJJ
VCgxOSkKKyNkZWZpbmUgICBEQl9QRU5EX1NCX1JFQwkJQklUKDIwKQorI2RlZmluZSAgIFNCX1BF
TkRfRElTUF9BQ1RJVkUJCUJJVCgyMSkKKyNkZWZpbmUgICBBSEJfRVJSCQkJQklUKDIyKQorI2Rl
ZmluZSBEQ1NTX0NUWExEX0RCX0JBU0VfQUREUgkJMHgxMAorI2RlZmluZSBEQ1NTX0NUWExEX0RC
X0NPVU5UCQkweDE0CisjZGVmaW5lIERDU1NfQ1RYTERfU0JfQkFTRV9BRERSCQkweDE4CisjZGVm
aW5lIERDU1NfQ1RYTERfU0JfQ09VTlQJCTB4MUMKKyNkZWZpbmUgICBTQl9IUF9DT1VOVF9QT1MJ
CTAKKyNkZWZpbmUgICBTQl9IUF9DT1VOVF9NQVNLCQkweGZmZmYKKyNkZWZpbmUgICBTQl9MUF9D
T1VOVF9QT1MJCTE2CisjZGVmaW5lICAgU0JfTFBfQ09VTlRfTUFTSwkJMHhmZmZmMDAwMAorI2Rl
ZmluZSBEQ1NTX0FIQl9FUlJfQUREUgkJMHgyMAorCisjZGVmaW5lIENUWExEX0lSUV9OQU1FCQkJ
ImN0eF9sZCIKKyNkZWZpbmUgQ1RYTERfSVJRX0NPTVBMRVRJT04JCShEQl9DT01QIHwgU0JfSFBf
Q09NUCB8IFNCX0xQX0NPTVApCisjZGVmaW5lIENUWExEX0lSUV9FUlJPUgkJCShSRF9FUlIgfCBE
Ql9QRU5EX1NCX1JFQyB8IEFIQl9FUlIpCisKKy8qIFRoZSBmb2xsb3dpbmcgc2l6ZXMgYXJlIGlu
IGNvbnRleHQgbG9hZGVyIGVudHJpZXMsIDggYnl0ZXMgZWFjaC4gKi8KKyNkZWZpbmUgQ1RYTERf
REJfQ1RYX0VOVFJJRVMJCTEwMjQJLyogbWF4IDY1NTM2ICovCisjZGVmaW5lIENUWExEX1NCX0xQ
X0NUWF9FTlRSSUVTCQkxMDI0MAkvKiBtYXggNjU1MzYgKi8KKyNkZWZpbmUgQ1RYTERfU0JfSFBf
Q1RYX0VOVFJJRVMJCTIwMDAwCS8qIG1heCA2NTUzNiAqLworI2RlZmluZSBDVFhMRF9TQl9DVFhf
RU5UUklFUwkJKENUWExEX1NCX0xQX0NUWF9FTlRSSUVTICsgXAorCQkJCQkgQ1RYTERfU0JfSFBf
Q1RYX0VOVFJJRVMpCisKKy8qIFNpemVzLCBpbiBlbnRyaWVzLCBvZiB0aGUgREIsIFNCX0hQIGFu
ZCBTQl9MUCBjb250ZXh0IHJlZ2lvbnMuICovCitzdGF0aWMgdTE2IGRjc3NfY3R4bGRfY3R4X3Np
emVbM10gPSB7CisJQ1RYTERfREJfQ1RYX0VOVFJJRVMsCisJQ1RYTERfU0JfSFBfQ1RYX0VOVFJJ
RVMsCisJQ1RYTERfU0JfTFBfQ1RYX0VOVFJJRVMKK307CisKKy8qIHRoaXMgcmVwcmVzZW50cyBh
biBlbnRyeSBpbiB0aGUgY29udGV4dCBsb2FkZXIgbWFwICovCitzdHJ1Y3QgZGNzc19jdHhsZF9p
dGVtIHsKKwl1MzIgdmFsOworCXUzMiBvZnM7Cit9OworCisjZGVmaW5lIENUWF9JVEVNX1NJWkUJ
CQlzaXplb2Yoc3RydWN0IGRjc3NfY3R4bGRfaXRlbSkKKworc3RydWN0IGRjc3NfY3R4bGQgewor
CXN0cnVjdCBkZXZpY2UgKmRldjsKKwl2b2lkIF9faW9tZW0gKmN0eGxkX3JlZzsKKwlpbnQgaXJx
OworCWJvb2wgaXJxX2VuOworCisJc3RydWN0IGRjc3NfY3R4bGRfaXRlbSAqZGJbMl07CisJc3Ry
dWN0IGRjc3NfY3R4bGRfaXRlbSAqc2JfaHBbMl07CisJc3RydWN0IGRjc3NfY3R4bGRfaXRlbSAq
c2JfbHBbMl07CisKKwlkbWFfYWRkcl90IGRiX3BhZGRyWzJdOworCWRtYV9hZGRyX3Qgc2JfcGFk
ZHJbMl07CisKKwl1MTYgY3R4X3NpemVbMl1bM107IC8qIGhvbGRzIHRoZSBzaXplcyBvZiBEQiwg
U0JfSFAgYW5kIFNCX0xQIGN0eCAqLworCXU4IGN1cnJlbnRfY3R4OworCisJYm9vbCBpbl91c2U7
CisJYm9vbCBhcm1lZDsKKworCXNwaW5sb2NrX3QgbG9jazsgLyogcHJvdGVjdHMgY29uY3VyZW50
IGFjY2VzcyB0byBwcml2YXRlIGRhdGEgKi8KKworCXZvaWQgKCpkdGdfZGlzYWJsZV9jYikodm9p
ZCAqZGF0YSk7CisJdm9pZCAqZHRnX2Rpc2FibGVfZGF0YTsKK307CisKK3N0YXRpYyBpbnQgX19k
Y3NzX2N0eGxkX2VuYWJsZShzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpOworCitzdGF0aWMgaXJx
cmV0dXJuX3QgZGNzc19jdHhsZF9pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRhKQorewor
CXN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZCA9IGRhdGE7CisJdTMyIGlycV9zdGF0dXM7CisKKwlp
cnFfc3RhdHVzID0gZGNzc19yZWFkbChjdHhsZC0+Y3R4bGRfcmVnICsgRENTU19DVFhMRF9DT05U
Uk9MX1NUQVRVUyk7CisKKwlpZiAoaXJxX3N0YXR1cyAmIENUWExEX0lSUV9DT01QTEVUSU9OICYm
CisJICAgICEoaXJxX3N0YXR1cyAmIENUWExEX0VOQUJMRSkgJiYgY3R4bGQtPmluX3VzZSkgewor
CQljdHhsZC0+aW5fdXNlID0gZmFsc2U7CisKKwkJaWYgKGN0eGxkLT5kdGdfZGlzYWJsZV9jYikg
eworCQkJY3R4bGQtPmR0Z19kaXNhYmxlX2NiKGN0eGxkLT5kdGdfZGlzYWJsZV9kYXRhKTsKKwkJ
CWN0eGxkLT5kdGdfZGlzYWJsZV9jYiA9IE5VTEw7CisJCQljdHhsZC0+ZHRnX2Rpc2FibGVfZGF0
YSA9IE5VTEw7CisJCX0KKwl9IGVsc2UgaWYgKGlycV9zdGF0dXMgJiBDVFhMRF9JUlFfRVJST1Ip
IHsKKwkJLyoKKwkJICogRXhjZXB0IGZvciB0aHJvd2luZyBhbiBlcnJvciBtZXNzYWdlIGFuZCBj
bGVhcmluZyB0aGUgc3RhdHVzCisJCSAqIHJlZ2lzdGVyLCB0aGVyZSdzIG5vdCBtdWNoIHdlIGNh
biBkbyBoZXJlLgorCQkgKi8KKwkJZGV2X2VycihjdHhsZC0+ZGV2LCAiY3R4bGQ6IGVycm9yIGVu
Y291bnRlcmVkOiAlMDh4XG4iLAorCQkJaXJxX3N0YXR1cyk7CisJCWRldl9lcnIoY3R4bGQtPmRl
diwgImN0eGxkOiBkYj0lZCwgc2JfaHA9JWQsIHNiX2xwPSVkXG4iLAorCQkJY3R4bGQtPmN0eF9z
aXplW2N0eGxkLT5jdXJyZW50X2N0eCBeIDFdW0NUWF9EQl0sCisJCQljdHhsZC0+Y3R4X3NpemVb
Y3R4bGQtPmN1cnJlbnRfY3R4IF4gMV1bQ1RYX1NCX0hQXSwKKwkJCWN0eGxkLT5jdHhfc2l6ZVtj
dHhsZC0+Y3VycmVudF9jdHggXiAxXVtDVFhfU0JfTFBdKTsKKwl9CisKKwlkY3NzX2NscihpcnFf
c3RhdHVzICYgKENUWExEX0lSUV9FUlJPUiB8IENUWExEX0lSUV9DT01QTEVUSU9OKSwKKwkJIGN0
eGxkLT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX0NPTlRST0xfU1RBVFVTKTsKKworCXJldHVybiBJ
UlFfSEFORExFRDsKK30KKworc3RhdGljIGludCBkY3NzX2N0eGxkX2lycV9jb25maWcoc3RydWN0
IGRjc3NfY3R4bGQgKmN0eGxkLAorCQkJCSBzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQor
eworCWludCByZXQ7CisKKwljdHhsZC0+aXJxID0gcGxhdGZvcm1fZ2V0X2lycV9ieW5hbWUocGRl
diwgQ1RYTERfSVJRX05BTUUpOworCWlmIChjdHhsZC0+aXJxIDwgMCkgeworCQlkZXZfZXJyKGN0
eGxkLT5kZXYsICJjdHhsZDogY2FuJ3QgZ2V0IGlycSBudW1iZXJcbiIpOworCQlyZXR1cm4gY3R4
bGQtPmlycTsKKwl9CisKKwlyZXQgPSBkZXZtX3JlcXVlc3RfaXJxKGN0eGxkLT5kZXYsIGN0eGxk
LT5pcnEsCisJCQkgICAgICAgZGNzc19jdHhsZF9pcnFfaGFuZGxlciwKKwkJCSAgICAgICBJUlFG
X09ORVNIT1QgfCBJUlFGX1RSSUdHRVJfSElHSCwKKwkJCSAgICAgICBEQ1NTX0NUWExEX0RFVk5B
TUUsIGN0eGxkKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoY3R4bGQtPmRldiwgImN0eGxkOiBp
cnEgcmVxdWVzdCBmYWlsZWQuXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwljdHhsZC0+aXJx
X2VuID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorCit2b2lkIGRjc3NfY3R4bGRfaHdfY2ZnKHN0
cnVjdCBkY3NzX2N0eGxkICpjdHhsZCkKK3sKKwlkY3NzX3dyaXRlbChSRF9FUlJfRU4gfCBTQl9I
UF9DT01QX0VOIHwKKwkJICAgIERCX1BFTkRfU0JfUkVDX0VOIHwgQUhCX0VSUl9FTiB8IFJEX0VS
UiB8IEFIQl9FUlIsCisJCSAgICBjdHhsZC0+Y3R4bGRfcmVnICsgRENTU19DVFhMRF9DT05UUk9M
X1NUQVRVUyk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfY3R4bGRfZnJlZV9jdHgoc3RydWN0IGRj
c3NfY3R4bGQgKmN0eGxkKQoreworCXN0cnVjdCBkY3NzX2N0eGxkX2l0ZW0gKmN0eDsKKwlpbnQg
aTsKKworCWZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKKwkJaWYgKGN0eGxkLT5kYltpXSkgewor
CQkJZG1hbV9mcmVlX2NvaGVyZW50KGN0eGxkLT5kZXYsCisJCQkJCSAgIENUWExEX0RCX0NUWF9F
TlRSSUVTICogc2l6ZW9mKCpjdHgpLAorCQkJCQkgICBjdHhsZC0+ZGJbaV0sIGN0eGxkLT5kYl9w
YWRkcltpXSk7CisJCQljdHhsZC0+ZGJbaV0gPSBOVUxMOworCQkJY3R4bGQtPmRiX3BhZGRyW2ld
ID0gMDsKKwkJfQorCisJCWlmIChjdHhsZC0+c2JfaHBbaV0pIHsKKwkJCWRtYW1fZnJlZV9jb2hl
cmVudChjdHhsZC0+ZGV2LAorCQkJCQkgICBDVFhMRF9TQl9DVFhfRU5UUklFUyAqIHNpemVvZigq
Y3R4KSwKKwkJCQkJICAgY3R4bGQtPnNiX2hwW2ldLCBjdHhsZC0+c2JfcGFkZHJbaV0pOworCQkJ
Y3R4bGQtPnNiX2hwW2ldID0gTlVMTDsKKwkJCWN0eGxkLT5zYl9wYWRkcltpXSA9IDA7CisJCX0K
Kwl9Cit9CisKK3N0YXRpYyBpbnQgZGNzc19jdHhsZF9hbGxvY19jdHgoc3RydWN0IGRjc3NfY3R4
bGQgKmN0eGxkKQoreworCXN0cnVjdCBkY3NzX2N0eGxkX2l0ZW0gKmN0eDsKKwlpbnQgaTsKKwlk
bWFfYWRkcl90IGRtYV9oYW5kbGU7CisKKwlmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CisJCWN0
eCA9IGRtYW1fYWxsb2NfY29oZXJlbnQoY3R4bGQtPmRldiwKKwkJCQkJICBDVFhMRF9EQl9DVFhf
RU5UUklFUyAqIHNpemVvZigqY3R4KSwKKwkJCQkJICAmZG1hX2hhbmRsZSwgR0ZQX0tFUk5FTCk7
CisJCWlmICghY3R4KQorCQkJcmV0dXJuIC1FTk9NRU07CisKKwkJY3R4bGQtPmRiW2ldID0gY3R4
OworCQljdHhsZC0+ZGJfcGFkZHJbaV0gPSBkbWFfaGFuZGxlOworCisJCWN0eCA9IGRtYW1fYWxs
b2NfY29oZXJlbnQoY3R4bGQtPmRldiwKKwkJCQkJICBDVFhMRF9TQl9DVFhfRU5UUklFUyAqIHNp
emVvZigqY3R4KSwKKwkJCQkJICAmZG1hX2hhbmRsZSwgR0ZQX0tFUk5FTCk7CisJCWlmICghY3R4
KQorCQkJcmV0dXJuIC1FTk9NRU07CisKKwkJY3R4bGQtPnNiX2hwW2ldID0gY3R4OworCQljdHhs
ZC0+c2JfbHBbaV0gPSBjdHggKyBDVFhMRF9TQl9IUF9DVFhfRU5UUklFUzsKKworCQljdHhsZC0+
c2JfcGFkZHJbaV0gPSBkbWFfaGFuZGxlOworCX0KKworCXJldHVybiAwOworfQorCitpbnQgZGNz
c19jdHhsZF9pbml0KHN0cnVjdCBkY3NzX2RldiAqZGNzcywgdW5zaWduZWQgbG9uZyBjdHhsZF9i
YXNlKQoreworCXN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZDsKKwlpbnQgcmV0OworCisJY3R4bGQg
PSBkZXZtX2t6YWxsb2MoZGNzcy0+ZGV2LCBzaXplb2Yoc3RydWN0IGRjc3NfY3R4bGQpLAorCQkJ
ICAgICBHRlBfS0VSTkVMKTsKKwlpZiAoIWN0eGxkKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRj
c3MtPmN0eGxkID0gY3R4bGQ7CisJY3R4bGQtPmRldiA9IGRjc3MtPmRldjsKKworCXNwaW5fbG9j
a19pbml0KCZjdHhsZC0+bG9jayk7CisKKwlyZXQgPSBkY3NzX2N0eGxkX2FsbG9jX2N0eChjdHhs
ZCk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGRjc3MtPmRldiwgImN0eGxkOiBjYW5ub3QgYWxs
b2NhdGUgY29udGV4dCBtZW1vcnkuXG4iKTsKKwkJZ290byBlcnI7CisJfQorCisJY3R4bGQtPmN0
eGxkX3JlZyA9IGRldm1faW9yZW1hcChkY3NzLT5kZXYsIGN0eGxkX2Jhc2UsIFNaXzRLKTsKKwlp
ZiAoIWN0eGxkLT5jdHhsZF9yZWcpIHsKKwkJZGV2X2VycihkY3NzLT5kZXYsICJjdHhsZDogdW5h
YmxlIHRvIHJlbWFwIGN0eGxkIGJhc2VcbiIpOworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGVy
cjsKKwl9CisKKwlyZXQgPSBkY3NzX2N0eGxkX2lycV9jb25maWcoY3R4bGQsIHRvX3BsYXRmb3Jt
X2RldmljZShkY3NzLT5kZXYpKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9pcnE7CisKKwlkY3Nz
X2N0eGxkX2h3X2NmZyhjdHhsZCk7CisKKwlyZXR1cm4gMDsKKworZXJyX2lycToKKwlkZXZtX2lv
dW5tYXAoY3R4bGQtPmRldiwgY3R4bGQtPmN0eGxkX3JlZyk7CisKK2VycjoKKwlkY3NzX2N0eGxk
X2ZyZWVfY3R4KGN0eGxkKTsKKwlkZXZtX2tmcmVlKGN0eGxkLT5kZXYsIGN0eGxkKTsKKworCXJl
dHVybiByZXQ7Cit9CisKK3ZvaWQgZGNzc19jdHhsZF9leGl0KHN0cnVjdCBkY3NzX2N0eGxkICpj
dHhsZCkKK3sKKwlkZXZtX2ZyZWVfaXJxKGN0eGxkLT5kZXYsIGN0eGxkLT5pcnEsIGN0eGxkKTsK
KworCWlmIChjdHhsZC0+Y3R4bGRfcmVnKQorCQlkZXZtX2lvdW5tYXAoY3R4bGQtPmRldiwgY3R4
bGQtPmN0eGxkX3JlZyk7CisKKwlkY3NzX2N0eGxkX2ZyZWVfY3R4KGN0eGxkKTsKKwlkZXZtX2tm
cmVlKGN0eGxkLT5kZXYsIGN0eGxkKTsKK30KKworc3RhdGljIGludCBfX2Rjc3NfY3R4bGRfZW5h
YmxlKHN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZCkKK3sKKwlpbnQgY3Vycl9jdHggPSBjdHhsZC0+
Y3VycmVudF9jdHg7CisJdTMyIGRiX2Jhc2UsIHNiX2Jhc2UsIHNiX2NvdW50OworCXUzMiBzYl9o
cF9jbnQsIHNiX2xwX2NudCwgZGJfY250OworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRjc3Nf
ZHJ2X2Rldl90b19kY3NzKGN0eGxkLT5kZXYpOworCisJZGNzc19kcHJfd3JpdGVfc3lzY3RybChk
Y3NzLT5kcHIpOworCisJZGNzc19zY2FsZXJfd3JpdGVfc2NsY3RybChkY3NzLT5zY2FsZXIpOwor
CisJc2JfaHBfY250ID0gY3R4bGQtPmN0eF9zaXplW2N1cnJfY3R4XVtDVFhfU0JfSFBdOworCXNi
X2xwX2NudCA9IGN0eGxkLT5jdHhfc2l6ZVtjdXJyX2N0eF1bQ1RYX1NCX0xQXTsKKwlkYl9jbnQg
PSBjdHhsZC0+Y3R4X3NpemVbY3Vycl9jdHhdW0NUWF9EQl07CisKKwkvKiBtYWtlIHN1cmUgU0Jf
TFAgY29udGV4dCBhcmVhIGNvbWVzIGFmdGVyIFNCX0hQICovCisJaWYgKHNiX2xwX2NudCAmJgor
CSAgICBjdHhsZC0+c2JfbHBbY3Vycl9jdHhdICE9IGN0eGxkLT5zYl9ocFtjdXJyX2N0eF0gKyBz
Yl9ocF9jbnQpIHsKKwkJc3RydWN0IGRjc3NfY3R4bGRfaXRlbSAqc2JfbHBfYWRqdXN0ZWQ7CisK
KwkJc2JfbHBfYWRqdXN0ZWQgPSBjdHhsZC0+c2JfaHBbY3Vycl9jdHhdICsgc2JfaHBfY250Owor
CisJCW1lbWNweShzYl9scF9hZGp1c3RlZCwgY3R4bGQtPnNiX2xwW2N1cnJfY3R4XSwKKwkJICAg
ICAgIHNiX2xwX2NudCAqIENUWF9JVEVNX1NJWkUpOworCX0KKworCWRiX2Jhc2UgPSBkYl9jbnQg
PyBjdHhsZC0+ZGJfcGFkZHJbY3Vycl9jdHhdIDogMDsKKworCWRjc3Nfd3JpdGVsKGRiX2Jhc2Us
IGN0eGxkLT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX0RCX0JBU0VfQUREUik7CisJZGNzc193cml0
ZWwoZGJfY250LCBjdHhsZC0+Y3R4bGRfcmVnICsgRENTU19DVFhMRF9EQl9DT1VOVCk7CisKKwlp
ZiAoc2JfaHBfY250KQorCQlzYl9jb3VudCA9ICgoc2JfaHBfY250IDw8IFNCX0hQX0NPVU5UX1BP
UykgJiBTQl9IUF9DT1VOVF9NQVNLKSB8CisJCQkgICAoKHNiX2xwX2NudCA8PCBTQl9MUF9DT1VO
VF9QT1MpICYgU0JfTFBfQ09VTlRfTUFTSyk7CisJZWxzZQorCQlzYl9jb3VudCA9IChzYl9scF9j
bnQgPDwgU0JfSFBfQ09VTlRfUE9TKSAmIFNCX0hQX0NPVU5UX01BU0s7CisKKwlzYl9iYXNlID0g
c2JfY291bnQgPyBjdHhsZC0+c2JfcGFkZHJbY3Vycl9jdHhdIDogMDsKKworCWRjc3Nfd3JpdGVs
KHNiX2Jhc2UsIGN0eGxkLT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX1NCX0JBU0VfQUREUik7CisJ
ZGNzc193cml0ZWwoc2JfY291bnQsIGN0eGxkLT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX1NCX0NP
VU5UKTsKKworCS8qIGVuYWJsZSB0aGUgY29udGV4dCBsb2FkZXIgKi8KKwlkY3NzX3NldChDVFhM
RF9FTkFCTEUsIGN0eGxkLT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX0NPTlRST0xfU1RBVFVTKTsK
KworCWN0eGxkLT5pbl91c2UgPSB0cnVlOworCisJLyoKKwkgKiBUb2dnbGUgdGhlIGN1cnJlbnQg
Y29udGV4dCB0byB0aGUgYWx0ZXJuYXRlIG9uZSBzbyB0aGF0IGFueSB1cGRhdGVzCisJICogaW4g
dGhlIG1vZHVsZXMnIHNldHRpbmdzIHRha2UgcGxhY2UgdGhlcmUuCisJICovCisJY3R4bGQtPmN1
cnJlbnRfY3R4IF49IDE7CisKKwljdHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJlbnRfY3R4XVtD
VFhfREJdID0gMDsKKwljdHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJlbnRfY3R4XVtDVFhfU0Jf
SFBdID0gMDsKKwljdHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJlbnRfY3R4XVtDVFhfU0JfTFBd
ID0gMDsKKworCXJldHVybiAwOworfQorCitpbnQgZGNzc19jdHhsZF9lbmFibGUoc3RydWN0IGRj
c3NfY3R4bGQgKmN0eGxkKQoreworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlzcGluX2xvY2tf
aXJxc2F2ZSgmY3R4bGQtPmxvY2ssIGZsYWdzKTsKKwljdHhsZC0+YXJtZWQgPSB0cnVlOworCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmN0eGxkLT5sb2NrLCBmbGFncyk7CisKKwlyZXR1cm4gMDsK
K30KKwordm9pZCBkY3NzX2N0eGxkX2tpY2soc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKQorewor
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmY3R4bGQtPmxvY2ss
IGZsYWdzKTsKKwlpZiAoY3R4bGQtPmFybWVkICYmICFjdHhsZC0+aW5fdXNlKSB7CisJCWN0eGxk
LT5hcm1lZCA9IGZhbHNlOworCQlfX2Rjc3NfY3R4bGRfZW5hYmxlKGN0eGxkKTsKKwl9CisJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmY3R4bGQtPmxvY2ssIGZsYWdzKTsKK30KKwordm9pZCBkY3Nz
X2N0eGxkX3dyaXRlX2lycXNhZmUoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkLCB1MzIgY3R4X2lk
LCB1MzIgdmFsLAorCQkJICAgICAgdTMyIHJlZ19vZnMpCit7CisJaW50IGN1cnJfY3R4ID0gY3R4
bGQtPmN1cnJlbnRfY3R4OworCXN0cnVjdCBkY3NzX2N0eGxkX2l0ZW0gKmN0eFtdID0geworCQlb
Q1RYX0RCXSA9IGN0eGxkLT5kYltjdXJyX2N0eF0sCisJCVtDVFhfU0JfSFBdID0gY3R4bGQtPnNi
X2hwW2N1cnJfY3R4XSwKKwkJW0NUWF9TQl9MUF0gPSBjdHhsZC0+c2JfbHBbY3Vycl9jdHhdCisJ
fTsKKwlpbnQgaXRlbV9pZHggPSBjdHhsZC0+Y3R4X3NpemVbY3Vycl9jdHhdW2N0eF9pZF07CisK
KwlpZiAoaXRlbV9pZHggKyAxID4gZGNzc19jdHhsZF9jdHhfc2l6ZVtjdHhfaWRdKSB7CisJCVdB
Uk5fT04oMSk7CisJCXJldHVybjsKKwl9CisKKwljdHhbY3R4X2lkXVtpdGVtX2lkeF0udmFsID0g
dmFsOworCWN0eFtjdHhfaWRdW2l0ZW1faWR4XS5vZnMgPSByZWdfb2ZzOworCWN0eGxkLT5jdHhf
c2l6ZVtjdXJyX2N0eF1bY3R4X2lkXSArPSAxOworfQorCit2b2lkIGRjc3NfY3R4bGRfd3JpdGUo
c3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkLCB1MzIgY3R4X2lkLAorCQkgICAgICB1MzIgdmFsLCB1
MzIgcmVnX29mcykKK3sKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJc3Bpbl9sb2NrX2lycXNh
dmUoJmN0eGxkLT5sb2NrLCBmbGFncyk7CisJZGNzc19jdHhsZF93cml0ZV9pcnFzYWZlKGN0eGxk
LCBjdHhfaWQsIHZhbCwgcmVnX29mcyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmY3R4bGQt
PmxvY2ssIGZsYWdzKTsKK30KKworYm9vbCBkY3NzX2N0eGxkX2lzX2ZsdXNoZWQoc3RydWN0IGRj
c3NfY3R4bGQgKmN0eGxkKQoreworCXJldHVybiBjdHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJl
bnRfY3R4XVtDVFhfREJdID09IDAgJiYKKwkJY3R4bGQtPmN0eF9zaXplW2N0eGxkLT5jdXJyZW50
X2N0eF1bQ1RYX1NCX0hQXSA9PSAwICYmCisJCWN0eGxkLT5jdHhfc2l6ZVtjdHhsZC0+Y3VycmVu
dF9jdHhdW0NUWF9TQl9MUF0gPT0gMDsKK30KKworaW50IGRjc3NfY3R4bGRfcmVzdW1lKHN0cnVj
dCBkY3NzX2N0eGxkICpjdHhsZCkKK3sKKwlkY3NzX2N0eGxkX2h3X2NmZyhjdHhsZCk7CisKKwlp
ZiAoIWN0eGxkLT5pcnFfZW4pIHsKKwkJZW5hYmxlX2lycShjdHhsZC0+aXJxKTsKKwkJY3R4bGQt
PmlycV9lbiA9IHRydWU7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK2ludCBkY3NzX2N0eGxkX3N1
c3BlbmQoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKQoreworCWludCByZXQgPSAwOworCWludCB3
YWl0X3RpbWVfbXMgPSAwOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlkY3NzX2N0eGxkX2tp
Y2soY3R4bGQpOworCisJd2hpbGUgKGN0eGxkLT5pbl91c2UgJiYgd2FpdF90aW1lX21zIDwgNTAw
KSB7CisJCW1zbGVlcCgyMCk7CisJCXdhaXRfdGltZV9tcyArPSAyMDsKKwl9CisKKwlpZiAod2Fp
dF90aW1lX21zID4gNTAwKQorCQlyZXR1cm4gLUVUSU1FRE9VVDsKKworCXNwaW5fbG9ja19pcnFz
YXZlKCZjdHhsZC0+bG9jaywgZmxhZ3MpOworCisJaWYgKGN0eGxkLT5pcnFfZW4pIHsKKwkJZGlz
YWJsZV9pcnFfbm9zeW5jKGN0eGxkLT5pcnEpOworCQljdHhsZC0+aXJxX2VuID0gZmFsc2U7CisJ
fQorCisJLyogcmVzZXQgY29udGV4dCByZWdpb24gYW5kIHNpemVzICovCisJY3R4bGQtPmN1cnJl
bnRfY3R4ID0gMDsKKwljdHhsZC0+Y3R4X3NpemVbMF1bQ1RYX0RCXSA9IDA7CisJY3R4bGQtPmN0
eF9zaXplWzBdW0NUWF9TQl9IUF0gPSAwOworCWN0eGxkLT5jdHhfc2l6ZVswXVtDVFhfU0JfTFBd
ID0gMDsKKworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmN0eGxkLT5sb2NrLCBmbGFncyk7CisK
KwlyZXR1cm4gcmV0OworfQorCit2b2lkIGRjc3NfY3R4bGRfcmVnaXN0ZXJfZHRnX2Rpc2FibGVf
Y2Ioc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkLAorCQkJCQl2b2lkICgqY2IpKHZvaWQgKiksCisJ
CQkJCXZvaWQgKmRhdGEpCit7CisJY3R4bGQtPmR0Z19kaXNhYmxlX2NiID0gY2I7CisJY3R4bGQt
PmR0Z19kaXNhYmxlX2RhdGEgPSBkYXRhOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2lteC9kY3NzL2Rjc3MtZGV2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kZXYu
YwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uMjY1YmYzYwotLS0gL2Rldi9u
dWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRldi5jCkBAIC0wLDAgKzEs
Mjg2IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHly
aWdodCAyMDE5IE5YUC4KKyAqLworCisjaW5jbHVkZSA8bGludXgvY2xrLmg+CisjaW5jbHVkZSA8
bGludXgvb2ZfZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvb2ZfZ3JhcGguaD4KKyNpbmNsdWRl
IDxsaW51eC9wbV9ydW50aW1lLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tb2Rlc2V0X2hlbHBlci5o
PgorCisjaW5jbHVkZSAiZGNzcy1kZXYuaCIKKworc3RhdGljIHZvaWQgZGNzc19jbG9ja3NfZW5h
YmxlKHN0cnVjdCBkY3NzX2RldiAqZGNzcykKK3sKKwlpZiAoZGNzcy0+Y2xrc19vbikKKwkJcmV0
dXJuOworCisJY2xrX3ByZXBhcmVfZW5hYmxlKGRjc3MtPmF4aV9jbGspOworCWNsa19wcmVwYXJl
X2VuYWJsZShkY3NzLT5hcGJfY2xrKTsKKwljbGtfcHJlcGFyZV9lbmFibGUoZGNzcy0+cnRybV9j
bGspOworCWNsa19wcmVwYXJlX2VuYWJsZShkY3NzLT5kdHJjX2Nsayk7CisJY2xrX3ByZXBhcmVf
ZW5hYmxlKGRjc3MtPnBpeF9jbGspOworCisJZGNzcy0+Y2xrc19vbiA9IHRydWU7Cit9CisKK3N0
YXRpYyB2b2lkIGRjc3NfY2xvY2tzX2Rpc2FibGUoc3RydWN0IGRjc3NfZGV2ICpkY3NzKQorewor
CWlmICghZGNzcy0+Y2xrc19vbikKKwkJcmV0dXJuOworCisJY2xrX2Rpc2FibGVfdW5wcmVwYXJl
KGRjc3MtPnBpeF9jbGspOworCWNsa19kaXNhYmxlX3VucHJlcGFyZShkY3NzLT5kdHJjX2Nsayk7
CisJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKGRjc3MtPnJ0cm1fY2xrKTsKKwljbGtfZGlzYWJsZV91
bnByZXBhcmUoZGNzcy0+YXBiX2Nsayk7CisJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKGRjc3MtPmF4
aV9jbGspOworCisJZGNzcy0+Y2xrc19vbiA9IGZhbHNlOworfQorCitzdGF0aWMgaW50IGRjc3Nf
c3VibW9kdWxlc19pbml0KHN0cnVjdCBkY3NzX2RldiAqZGNzcykKK3sKKwlpbnQgcmV0ID0gMDsK
Kwl1MzIgYmFzZV9hZGRyID0gZGNzcy0+c3RhcnRfYWRkcjsKKwljb25zdCBzdHJ1Y3QgZGNzc190
eXBlX2RhdGEgKmRldnR5cGUgPSBkY3NzLT5kZXZ0eXBlOworCisJZGNzc19jbG9ja3NfZW5hYmxl
KGRjc3MpOworCisJcmV0ID0gZGNzc19ibGtjdGxfaW5pdChkY3NzLCBiYXNlX2FkZHIgKyBkZXZ0
eXBlLT5ibGtjdGxfb2ZzKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gZGNz
c19jdHhsZF9pbml0KGRjc3MsIGJhc2VfYWRkciArIGRldnR5cGUtPmN0eGxkX29mcyk7CisJaWYg
KHJldCkKKwkJZ290byBjdHhsZF9lcnI7CisKKwlyZXQgPSBkY3NzX2R0Z19pbml0KGRjc3MsIGJh
c2VfYWRkciArIGRldnR5cGUtPmR0Z19vZnMpOworCWlmIChyZXQpCisJCWdvdG8gZHRnX2VycjsK
KworCXJldCA9IGRjc3Nfc3NfaW5pdChkY3NzLCBiYXNlX2FkZHIgKyBkZXZ0eXBlLT5zc19vZnMp
OworCWlmIChyZXQpCisJCWdvdG8gc3NfZXJyOworCisJcmV0ID0gZGNzc19kcHJfaW5pdChkY3Nz
LCBiYXNlX2FkZHIgKyBkZXZ0eXBlLT5kcHJfb2ZzKTsKKwlpZiAocmV0KQorCQlnb3RvIGRwcl9l
cnI7CisKKwlyZXQgPSBkY3NzX3NjYWxlcl9pbml0KGRjc3MsIGJhc2VfYWRkciArIGRldnR5cGUt
PnNjYWxlcl9vZnMpOworCWlmIChyZXQpCisJCWdvdG8gc2NhbGVyX2VycjsKKworCXJldHVybiAw
OworCitzY2FsZXJfZXJyOgorCWRjc3NfZHByX2V4aXQoZGNzcy0+ZHByKTsKKworZHByX2VycjoK
KwlkY3NzX3NzX2V4aXQoZGNzcy0+c3MpOworCitzc19lcnI6CisJZGNzc19kdGdfZXhpdChkY3Nz
LT5kdGcpOworCitkdGdfZXJyOgorCWRjc3NfY3R4bGRfZXhpdChkY3NzLT5jdHhsZCk7CisKK2N0
eGxkX2VycjoKKwlkY3NzX2Jsa2N0bF9leGl0KGRjc3MtPmJsa2N0bCk7CisKKwlkY3NzX2Nsb2Nr
c19kaXNhYmxlKGRjc3MpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgZGNzc19z
dWJtb2R1bGVzX3N0b3Aoc3RydWN0IGRjc3NfZGV2ICpkY3NzKQoreworCWRjc3NfY2xvY2tzX2Vu
YWJsZShkY3NzKTsKKwlkY3NzX3NjYWxlcl9leGl0KGRjc3MtPnNjYWxlcik7CisJZGNzc19kcHJf
ZXhpdChkY3NzLT5kcHIpOworCWRjc3Nfc3NfZXhpdChkY3NzLT5zcyk7CisJZGNzc19kdGdfZXhp
dChkY3NzLT5kdGcpOworCWRjc3NfY3R4bGRfZXhpdChkY3NzLT5jdHhsZCk7CisJZGNzc19ibGtj
dGxfZXhpdChkY3NzLT5ibGtjdGwpOworCWRjc3NfY2xvY2tzX2Rpc2FibGUoZGNzcyk7Cit9CisK
K3N0YXRpYyBpbnQgZGNzc19jbGtzX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzKQoreworCWlu
dCBpOworCXN0cnVjdCB7CisJCWNvbnN0IGNoYXIgKmlkOworCQlzdHJ1Y3QgY2xrICoqY2xrOwor
CX0gY2xrc1tdID0geworCQl7ImFwYiIsICAgJmRjc3MtPmFwYl9jbGt9LAorCQl7ImF4aSIsICAg
JmRjc3MtPmF4aV9jbGt9LAorCQl7InBpeCIsICAgJmRjc3MtPnBpeF9jbGt9LAorCQl7InJ0cm0i
LCAgJmRjc3MtPnJ0cm1fY2xrfSwKKwkJeyJkdHJjIiwgICZkY3NzLT5kdHJjX2Nsa30sCisJfTsK
KworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsa3MpOyBpKyspIHsKKwkJKmNsa3NbaV0u
Y2xrID0gZGV2bV9jbGtfZ2V0KGRjc3MtPmRldiwgY2xrc1tpXS5pZCk7CisJCWlmIChJU19FUlIo
KmNsa3NbaV0uY2xrKSkgeworCQkJZGV2X2VycihkY3NzLT5kZXYsICJmYWlsZWQgdG8gZ2V0ICVz
IGNsb2NrXG4iLAorCQkJCWNsa3NbaV0uaWQpOworCQkJcmV0dXJuIFBUUl9FUlIoKmNsa3NbaV0u
Y2xrKTsKKwkJfQorCX0KKworCWRjc3MtPmNsa3Nfb24gPSBmYWxzZTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgdm9pZCBkY3NzX2Nsa3NfcmVsZWFzZShzdHJ1Y3QgZGNzc19kZXYgKmRjc3Mp
Cit7CisJZGV2bV9jbGtfcHV0KGRjc3MtPmRldiwgZGNzcy0+ZHRyY19jbGspOworCWRldm1fY2xr
X3B1dChkY3NzLT5kZXYsIGRjc3MtPnJ0cm1fY2xrKTsKKwlkZXZtX2Nsa19wdXQoZGNzcy0+ZGV2
LCBkY3NzLT5waXhfY2xrKTsKKwlkZXZtX2Nsa19wdXQoZGNzcy0+ZGV2LCBkY3NzLT5heGlfY2xr
KTsKKwlkZXZtX2Nsa19wdXQoZGNzcy0+ZGV2LCBkY3NzLT5hcGJfY2xrKTsKK30KKworc3RydWN0
IGRjc3NfZGV2ICpkY3NzX2Rldl9jcmVhdGUoc3RydWN0IGRldmljZSAqZGV2LCBib29sIGhkbWlf
b3V0cHV0KQoreworCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYgPSB0b19wbGF0Zm9ybV9k
ZXZpY2UoZGV2KTsKKwlpbnQgcmV0OworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCXN0cnVjdCBk
Y3NzX2RldiAqZGNzczsKKwljb25zdCBzdHJ1Y3QgZGNzc190eXBlX2RhdGEgKmRldnR5cGU7CisK
KwlkZXZ0eXBlID0gb2ZfZGV2aWNlX2dldF9tYXRjaF9kYXRhKGRldik7CisJaWYgKCFkZXZ0eXBl
KSB7CisJCWRldl9lcnIoZGV2LCAibm8gZGV2aWNlIG1hdGNoIGZvdW5kXG4iKTsKKwkJcmV0dXJu
IEVSUl9QVFIoLUVOT0RFVik7CisJfQorCisJcmVzID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlKHBk
ZXYsIElPUkVTT1VSQ0VfTUVNLCAwKTsKKwlpZiAoIXJlcykgeworCQlkZXZfZXJyKGRldiwgImNh
bm5vdCBnZXQgbWVtb3J5IHJlc291cmNlXG4iKTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7
CisJfQorCisJZGNzcyA9IGRldm1fa3phbGxvYyhkZXYsIHNpemVvZihzdHJ1Y3QgZGNzc19kZXYp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRjc3MpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwor
CisJZGNzcy0+ZGV2ID0gZGV2OworCWRjc3MtPmRldnR5cGUgPSBkZXZ0eXBlOworCWRjc3MtPmhk
bWlfb3V0cHV0ID0gaGRtaV9vdXRwdXQ7CisKKwlyZXQgPSBkY3NzX2Nsa3NfaW5pdChkY3NzKTsK
KwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAiY2xvY2tzIGluaXRpYWxpemF0aW9uIGZhaWxl
ZFxuIik7CisJCWdvdG8gZXJyOworCX0KKworCWRjc3MtPm9mX3BvcnQgPSBvZl9ncmFwaF9nZXRf
cG9ydF9ieV9pZChkZXYtPm9mX25vZGUsIDApOworCWlmICghZGNzcy0+b2ZfcG9ydCkgeworCQlk
ZXZfZXJyKGRldiwgIm5vIHBvcnRAMCBub2RlIGluICVzXG4iLCBkZXYtPm9mX25vZGUtPmZ1bGxf
bmFtZSk7CisJCXJldCA9IC1FTk9ERVY7CisJCWdvdG8gY2xrc19lcnI7CisJfQorCisJZGNzcy0+
c3RhcnRfYWRkciA9IHJlcy0+c3RhcnQ7CisKKwlyZXQgPSBkY3NzX3N1Ym1vZHVsZXNfaW5pdChk
Y3NzKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGV2LCAic3VibW9kdWxlcyBpbml0aWFsaXph
dGlvbiBmYWlsZWRcbiIpOworCQlnb3RvIGNsa3NfZXJyOworCX0KKworCXBtX3J1bnRpbWVfZW5h
YmxlKGRldik7CisKKwlyZXR1cm4gZGNzczsKKworY2xrc19lcnI6CisJZGNzc19jbGtzX3JlbGVh
c2UoZGNzcyk7CisKK2VycjoKKwlkZXZtX2tmcmVlKGRjc3MtPmRldiwgZGNzcyk7CisKKwlyZXR1
cm4gRVJSX1BUUihyZXQpOworfQorCit2b2lkIGRjc3NfZGV2X2Rlc3Ryb3koc3RydWN0IGRjc3Nf
ZGV2ICpkY3NzKQoreworCXBtX3J1bnRpbWVfZGlzYWJsZShkY3NzLT5kZXYpOworCisJZGNzc19z
dWJtb2R1bGVzX3N0b3AoZGNzcyk7CisKKwlkY3NzX2Nsa3NfcmVsZWFzZShkY3NzKTsKKworCWRl
dm1fa2ZyZWUoZGNzcy0+ZGV2LCBkY3NzKTsKK30KKworI2lmZGVmIENPTkZJR19QTV9TTEVFUAor
aW50IGRjc3NfZGV2X3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCBkY3Nz
X2RldiAqZGNzcyA9IGRjc3NfZHJ2X2Rldl90b19kY3NzKGRldik7CisJaW50IHJldDsKKworCWRy
bV9tb2RlX2NvbmZpZ19oZWxwZXJfc3VzcGVuZChkY3NzX2Rydl9kZXZfdG9fZHJtKGRldikpOwor
CisJaWYgKHBtX3J1bnRpbWVfc3VzcGVuZGVkKGRldikpCisJCXJldHVybiAwOworCisJcmV0ID0g
ZGNzc19jdHhsZF9zdXNwZW5kKGRjc3MtPmN0eGxkKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCisJZGNzc19jbG9ja3NfZGlzYWJsZShkY3NzKTsKKworCXJldHVybiAwOworfQorCitpbnQg
ZGNzc19kZXZfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgZGNzc19kZXYg
KmRjc3MgPSBkY3NzX2Rydl9kZXZfdG9fZGNzcyhkZXYpOworCisJaWYgKHBtX3J1bnRpbWVfc3Vz
cGVuZGVkKGRldikpIHsKKwkJZHJtX21vZGVfY29uZmlnX2hlbHBlcl9yZXN1bWUoZGNzc19kcnZf
ZGV2X3RvX2RybShkZXYpKTsKKwkJcmV0dXJuIDA7CisJfQorCisJZGNzc19jbG9ja3NfZW5hYmxl
KGRjc3MpOworCisJZGNzc19ibGtjdGxfY2ZnKGRjc3MtPmJsa2N0bCk7CisKKwlkY3NzX2N0eGxk
X3Jlc3VtZShkY3NzLT5jdHhsZCk7CisKKwlkcm1fbW9kZV9jb25maWdfaGVscGVyX3Jlc3VtZShk
Y3NzX2Rydl9kZXZfdG9fZHJtKGRldikpOworCisJcmV0dXJuIDA7Cit9CisjZW5kaWYgLyogQ09O
RklHX1BNX1NMRUVQICovCisKKyNpZmRlZiBDT05GSUdfUE0KK2ludCBkY3NzX2Rldl9ydW50aW1l
X3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9
IGRjc3NfZHJ2X2Rldl90b19kY3NzKGRldik7CisJaW50IHJldDsKKworCXJldCA9IGRjc3NfY3R4
bGRfc3VzcGVuZChkY3NzLT5jdHhsZCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWRj
c3NfY2xvY2tzX2Rpc2FibGUoZGNzcyk7CisKKwlyZXR1cm4gMDsKK30KKworaW50IGRjc3NfZGV2
X3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgZGNzc19kZXYg
KmRjc3MgPSBkY3NzX2Rydl9kZXZfdG9fZGNzcyhkZXYpOworCisJZGNzc19jbG9ja3NfZW5hYmxl
KGRjc3MpOworCisJZGNzc19ibGtjdGxfY2ZnKGRjc3MtPmJsa2N0bCk7CisKKwlkY3NzX2N0eGxk
X3Jlc3VtZShkY3NzLT5jdHhsZCk7CisKKwlyZXR1cm4gMDsKK30KKyNlbmRpZiAvKiBDT05GSUdf
UE0gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRldi5oIGIv
ZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZGV2LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQK
aW5kZXggMDAwMDAwMDAuLjE1YzVkZTMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaW14L2Rjc3MvZGNzcy1kZXYuaApAQCAtMCwwICsxLDE5NSBAQAorLyogU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBOWFAuCisgKi8K
KworI2lmbmRlZiBfX0RDU1NfUFJWX0hfXworI2RlZmluZSBfX0RDU1NfUFJWX0hfXworCisjaW5j
bHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNsdWRlIDxsaW51eC9pby5oPgorI2luY2x1ZGUg
PHZpZGVvL3ZpZGVvbW9kZS5oPgorCisjZGVmaW5lIFNFVAkJCTB4MDQKKyNkZWZpbmUgQ0xSCQkJ
MHgwOAorI2RlZmluZSBUR0wJCQkweDBDCisKKyNkZWZpbmUgZGNzc193cml0ZWwodiwgYykJd3Jp
dGVsKCh2KSwgKGMpKQorI2RlZmluZSBkY3NzX3JlYWRsKGMpCQlyZWFkbChjKQorI2RlZmluZSBk
Y3NzX3NldCh2LCBjKQkJd3JpdGVsKCh2KSwgKGMpICsgU0VUKQorI2RlZmluZSBkY3NzX2Nscih2
LCBjKQkJd3JpdGVsKCh2KSwgKGMpICsgQ0xSKQorI2RlZmluZSBkY3NzX3RvZ2dsZSh2LCBjKQl3
cml0ZWwoKHYpLCAoYykgKyBUR0wpCisKK3N0YXRpYyBpbmxpbmUgdm9pZCBkY3NzX3VwZGF0ZSh1
MzIgdiwgdTMyIG0sIHZvaWQgX19pb21lbSAqYykKK3sKKwl3cml0ZWwoKHJlYWRsKGMpICYgfiht
KSkgfCAodiksIChjKSk7Cit9CisKKyNkZWZpbmUgRENTU19EQkdfUkVHKHJlZykJey5uYW1lID0g
I3JlZywgLm9mcyA9IHJlZ30KKworZW51bSB7CisJRENTU19JTVg4TVEgPSAwLAorfTsKKworc3Ry
dWN0IGRjc3NfdHlwZV9kYXRhIHsKKwljb25zdCBjaGFyICpuYW1lOworCXUzMiBibGtjdGxfb2Zz
OworCXUzMiBjdHhsZF9vZnM7CisJdTMyIHJkc3JjX29mczsKKwl1MzIgd3JzY2xfb2ZzOworCXUz
MiBkdGdfb2ZzOworCXUzMiBzY2FsZXJfb2ZzOworCXUzMiBzc19vZnM7CisJdTMyIGRwcl9vZnM7
CisJdTMyIGR0cmNfb2ZzOworCXUzMiBkZWM0MDBkX29mczsKKwl1MzIgaGRyMTBfb2ZzOworfTsK
Kworc3RydWN0IGRjc3NfZGVidWdfcmVnIHsKKwljaGFyICpuYW1lOworCXUzMiBvZnM7Cit9Owor
CitlbnVtIGRjc3NfY3R4bGRfY3R4X3R5cGUgeworCUNUWF9EQiwKKwlDVFhfU0JfSFAsIC8qIGhp
Z2gtcHJpb3JpdHkgKi8KKwlDVFhfU0JfTFAsIC8qIGxvdy1wcmlvcml0eSAgKi8KK307CisKK3N0
cnVjdCBkY3NzX2RldiB7CisJc3RydWN0IGRldmljZSAqZGV2OworCWNvbnN0IHN0cnVjdCBkY3Nz
X3R5cGVfZGF0YSAqZGV2dHlwZTsKKwlzdHJ1Y3QgZGV2aWNlX25vZGUgKm9mX3BvcnQ7CisKKwl1
MzIgc3RhcnRfYWRkcjsKKworCXN0cnVjdCBkY3NzX2Jsa2N0bCAqYmxrY3RsOworCXN0cnVjdCBk
Y3NzX2N0eGxkICpjdHhsZDsKKwlzdHJ1Y3QgZGNzc19kcHIgKmRwcjsKKwlzdHJ1Y3QgZGNzc19k
dGcgKmR0ZzsKKwlzdHJ1Y3QgZGNzc19zcyAqc3M7CisJc3RydWN0IGRjc3NfaGRyMTAgKmhkcjEw
OworCXN0cnVjdCBkY3NzX3NjYWxlciAqc2NhbGVyOworCXN0cnVjdCBkY3NzX2R0cmMgKmR0cmM7
CisJc3RydWN0IGRjc3NfZGVjNDAwZCAqZGVjNDAwZDsKKwlzdHJ1Y3QgZGNzc193cnNjbCAqd3Jz
Y2w7CisJc3RydWN0IGRjc3NfcmRzcmMgKnJkc3JjOworCisJc3RydWN0IGNsayAqYXBiX2NsazsK
KwlzdHJ1Y3QgY2xrICpheGlfY2xrOworCXN0cnVjdCBjbGsgKnBpeF9jbGs7CisJc3RydWN0IGNs
ayAqcnRybV9jbGs7CisJc3RydWN0IGNsayAqZHRyY19jbGs7CisJc3RydWN0IGNsayAqcGxsX3Ny
Y19jbGs7CisJc3RydWN0IGNsayAqcGxsX3BoeV9yZWZfY2xrOworCisJdm9pZCAoKmRjc3NfZGlz
YWJsZV9jYWxsYmFjaykodm9pZCAqZGF0YSk7CisKKwlib29sIGNsa3Nfb247CisJYm9vbCBoZG1p
X291dHB1dDsKK307CisKK2VudW0gZGNzc19jb2xvcl9zcGFjZSB7CisJRENTU19DT0xPUlNQQUNF
X1JHQiwKKwlEQ1NTX0NPTE9SU1BBQ0VfWVVWLAorCURDU1NfQ09MT1JTUEFDRV9VTktOT1dOLAor
fTsKKworc3RydWN0IGRjc3NfZGV2ICpkY3NzX2Rydl9kZXZfdG9fZGNzcyhzdHJ1Y3QgZGV2aWNl
ICpkZXYpOworc3RydWN0IGRybV9kZXZpY2UgKmRjc3NfZHJ2X2Rldl90b19kcm0oc3RydWN0IGRl
dmljZSAqZGV2KTsKK3N0cnVjdCBkY3NzX2RldiAqZGNzc19kZXZfY3JlYXRlKHN0cnVjdCBkZXZp
Y2UgKmRldiwgYm9vbCBtaXBpX291dHB1dCk7Cit2b2lkIGRjc3NfZGV2X2Rlc3Ryb3koc3RydWN0
IGRjc3NfZGV2ICpkY3NzKTsKK2ludCBkY3NzX2Rldl9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRl
dmljZSAqZGV2KTsKK2ludCBkY3NzX2Rldl9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpk
ZXYpOworaW50IGRjc3NfZGV2X3N1c3BlbmQoc3RydWN0IGRldmljZSAqZGV2KTsKK2ludCBkY3Nz
X2Rldl9yZXN1bWUoc3RydWN0IGRldmljZSAqZGV2KTsKKworLyogQkxLQ1RMICovCitpbnQgZGNz
c19ibGtjdGxfaW5pdChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgYmxrY3Rs
X2Jhc2UpOwordm9pZCBkY3NzX2Jsa2N0bF9jZmcoc3RydWN0IGRjc3NfYmxrY3RsICpibGtjdGwp
Owordm9pZCBkY3NzX2Jsa2N0bF9leGl0KHN0cnVjdCBkY3NzX2Jsa2N0bCAqYmxrY3RsKTsKKwor
LyogQ1RYTEQgKi8KK2ludCBkY3NzX2N0eGxkX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzLCB1
bnNpZ25lZCBsb25nIGN0eGxkX2Jhc2UpOwordm9pZCBkY3NzX2N0eGxkX2V4aXQoc3RydWN0IGRj
c3NfY3R4bGQgKmN0eGxkKTsKK3ZvaWQgZGNzc19jdHhsZF93cml0ZShzdHJ1Y3QgZGNzc19jdHhs
ZCAqY3R4bGQsIHUzMiBjdHhfaWQsCisJCSAgICAgIHUzMiB2YWwsIHUzMiByZWdfaWR4KTsKK2lu
dCBkY3NzX2N0eGxkX3Jlc3VtZShzdHJ1Y3QgZGNzc19jdHhsZCAqZGNzc19jdHhsZCk7CitpbnQg
ZGNzc19jdHhsZF9zdXNwZW5kKHN0cnVjdCBkY3NzX2N0eGxkICpkY3NzX2N0eGxkKTsKK3ZvaWQg
ZGNzc19jdHhsZF93cml0ZV9pcnFzYWZlKHN0cnVjdCBkY3NzX2N0eGxkICpjdGx4ZCwgdTMyIGN0
eF9pZCwgdTMyIHZhbCwKKwkJCSAgICAgIHUzMiByZWdfb2ZzKTsKK3ZvaWQgZGNzc19jdHhsZF9r
aWNrKHN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZCk7Citib29sIGRjc3NfY3R4bGRfaXNfZmx1c2hl
ZChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpOworaW50IGRjc3NfY3R4bGRfZW5hYmxlKHN0cnVj
dCBkY3NzX2N0eGxkICpjdHhsZCk7Cit2b2lkIGRjc3NfY3R4bGRfcmVnaXN0ZXJfZHRnX2Rpc2Fi
bGVfY2Ioc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkLAorCQkJCQl2b2lkICgqY2IpKHZvaWQgKiks
CisJCQkJCXZvaWQgKmRhdGEpOworCisvKiBEUFIgKi8KK2VudW0gZGNzc190aWxlX3R5cGUgewor
CVRJTEVfTElORUFSID0gMCwKKwlUSUxFX0dQVV9TVEFOREFSRCwKKwlUSUxFX0dQVV9TVVBFUiwK
KwlUSUxFX1ZQVV9ZVVY0MjAsCisJVElMRV9WUFVfVlA5LAorfTsKKworZW51bSBkY3NzX3BpeF9z
aXplIHsKKwlQSVhfU0laRV84LAorCVBJWF9TSVpFXzE2LAorCVBJWF9TSVpFXzMyLAorfTsKKwor
aW50IGRjc3NfZHByX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzLCB1bnNpZ25lZCBsb25nIGRw
cl9iYXNlKTsKK3ZvaWQgZGNzc19kcHJfZXhpdChzdHJ1Y3QgZGNzc19kcHIgKmRwcik7Cit2b2lk
IGRjc3NfZHByX3dyaXRlX3N5c2N0cmwoc3RydWN0IGRjc3NfZHByICpkcHIpOwordm9pZCBkY3Nz
X2Rwcl9zZXRfcmVzKHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQgY2hfbnVtLCB1MzIgeHJlcywg
dTMyIHlyZXMpOwordm9pZCBkY3NzX2Rwcl9hZGRyX3NldChzdHJ1Y3QgZGNzc19kcHIgKmRwciwg
aW50IGNoX251bSwgdTMyIGx1bWFfYmFzZV9hZGRyLAorCQkgICAgICAgdTMyIGNocm9tYV9iYXNl
X2FkZHIsIHUxNiBwaXRjaCk7Cit2b2lkIGRjc3NfZHByX2VuYWJsZShzdHJ1Y3QgZGNzc19kcHIg
KmRwciwgaW50IGNoX251bSwgYm9vbCBlbik7Cit2b2lkIGRjc3NfZHByX2Zvcm1hdF9zZXQoc3Ry
dWN0IGRjc3NfZHByICpkcHIsIGludCBjaF9udW0sCisJCQkgY29uc3Qgc3RydWN0IGRybV9mb3Jt
YXRfaW5mbyAqZm9ybWF0LCB1NjQgbW9kaWZpZXIpOwordm9pZCBkY3NzX2Rwcl9zZXRfcm90YXRp
b24oc3RydWN0IGRjc3NfZHByICpkcHIsIGludCBjaF9udW0sIHUzMiByb3RhdGlvbik7CisKKy8q
IERURyAqLworaW50IGRjc3NfZHRnX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzLCB1bnNpZ25l
ZCBsb25nIGR0Z19iYXNlKTsKK3ZvaWQgZGNzc19kdGdfZXhpdChzdHJ1Y3QgZGNzc19kdGcgKmR0
Zyk7Citib29sIGRjc3NfZHRnX3ZibGFua19pcnFfdmFsaWQoc3RydWN0IGRjc3NfZHRnICpkdGcp
Owordm9pZCBkY3NzX2R0Z192YmxhbmtfaXJxX2VuYWJsZShzdHJ1Y3QgZGNzc19kdGcgKmR0Zywg
Ym9vbCBlbik7Cit2b2lkIGRjc3NfZHRnX3ZibGFua19pcnFfY2xlYXIoc3RydWN0IGRjc3NfZHRn
ICpkdGcpOwordm9pZCBkY3NzX2R0Z19zeW5jX3NldChzdHJ1Y3QgZGNzc19kdGcgKmR0Zywgc3Ry
dWN0IHZpZGVvbW9kZSAqdm0pOwordm9pZCBkY3NzX2R0Z19jc3Nfc2V0KHN0cnVjdCBkY3NzX2R0
ZyAqZHRnKTsKK3ZvaWQgZGNzc19kdGdfZW5hYmxlKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBib29s
IGVuLAorCQkgICAgIHN0cnVjdCBjb21wbGV0aW9uICpkaXNfY29tcGxldGlvbik7Citib29sIGRj
c3NfZHRnX2lzX2VuYWJsZWQoc3RydWN0IGRjc3NfZHRnICpkdGcpOwordm9pZCBkY3NzX2R0Z19j
dHhsZF9raWNrX2lycV9lbmFibGUoc3RydWN0IGRjc3NfZHRnICpkdGcsIGJvb2wgZW4pOworYm9v
bCBkY3NzX2R0Z19nbG9iYWxfYWxwaGFfY2hhbmdlZChzdHJ1Y3QgZGNzc19kdGcgKmR0ZywgaW50
IGNoX251bSwgaW50IGFscGhhKTsKK3ZvaWQgZGNzc19kdGdfcGxhbmVfYWxwaGFfc2V0KHN0cnVj
dCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGRybV9m
b3JtYXRfaW5mbyAqZm9ybWF0LCBpbnQgYWxwaGEpOwordm9pZCBkY3NzX2R0Z19wbGFuZV9wb3Nf
c2V0KHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLAorCQkJICAgIGludCBweCwgaW50
IHB5LCBpbnQgcHcsIGludCBwaCk7Cit2b2lkIGRjc3NfZHRnX2NoX2VuYWJsZShzdHJ1Y3QgZGNz
c19kdGcgKmR0ZywgaW50IGNoX251bSwgYm9vbCBlbik7CisKKy8qIFNVQlNBTSAqLworaW50IGRj
c3Nfc3NfaW5pdChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgc3Vic2FtX2Jh
c2UpOwordm9pZCBkY3NzX3NzX2V4aXQoc3RydWN0IGRjc3Nfc3MgKnNzKTsKK3ZvaWQgZGNzc19z
c19lbmFibGUoc3RydWN0IGRjc3Nfc3MgKnNzKTsKK3ZvaWQgZGNzc19zc19kaXNhYmxlKHN0cnVj
dCBkY3NzX3NzICpzcyk7Cit2b2lkIGRjc3Nfc3Nfc3Vic2FtX3NldChzdHJ1Y3QgZGNzc19zcyAq
c3MpOwordm9pZCBkY3NzX3NzX3N5bmNfc2V0KHN0cnVjdCBkY3NzX3NzICpzcywgc3RydWN0IHZp
ZGVvbW9kZSAqdm0sCisJCSAgICAgIGJvb2wgcGhzeW5jLCBib29sIHB2c3luYyk7CisKKy8qIFND
QUxFUiAqLworaW50IGRjc3Nfc2NhbGVyX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzLCB1bnNp
Z25lZCBsb25nIHNjYWxlcl9iYXNlKTsKK3ZvaWQgZGNzc19zY2FsZXJfZXhpdChzdHJ1Y3QgZGNz
c19zY2FsZXIgKnNjbCk7Cit2b2lkIGRjc3Nfc2NhbGVyX3NldHVwKHN0cnVjdCBkY3NzX3NjYWxl
ciAqc2NsLCBpbnQgY2hfbnVtLAorCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5m
byAqZm9ybWF0LAorCQkgICAgICAgaW50IHNyY194cmVzLCBpbnQgc3JjX3lyZXMsIGludCBkc3Rf
eHJlcywgaW50IGRzdF95cmVzLAorCQkgICAgICAgdTMyIHZyZWZyZXNoX2h6KTsKK3ZvaWQgZGNz
c19zY2FsZXJfY2hfZW5hYmxlKHN0cnVjdCBkY3NzX3NjYWxlciAqc2NsLCBpbnQgY2hfbnVtLCBi
b29sIGVuKTsKK2ludCBkY3NzX3NjYWxlcl9nZXRfbWluX21heF9yYXRpb3Moc3RydWN0IGRjc3Nf
c2NhbGVyICpzY2wsIGludCBjaF9udW0sCisJCQkJICAgaW50ICptaW4sIGludCAqbWF4KTsKK3Zv
aWQgZGNzc19zY2FsZXJfd3JpdGVfc2NsY3RybChzdHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCk7CisK
KyNlbmRpZiAvKiBfX0RDU1NfUFJWX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2lteC9kY3NzL2Rjc3MtZHByLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kcHIu
YwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uZGJjNzE2OQotLS0gL2Rldi9u
dWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRwci5jCkBAIC0wLDAgKzEs
NTUyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHly
aWdodCAyMDE5IE5YUC4KKyAqLworCisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisKKyNpbmNs
dWRlICJkY3NzLWRldi5oIgorCisjZGVmaW5lIERDU1NfRFBSX1NZU1RFTV9DVFJMMAkJCTB4MDAw
CisjZGVmaW5lICAgUlVOX0VOCQkJCUJJVCgwKQorI2RlZmluZSAgIFNPRlRfUkVTRVQJCQkJQklU
KDEpCisjZGVmaW5lICAgUkVQRUFUX0VOCQkJCUJJVCgyKQorI2RlZmluZSAgIFNIQURPV19MT0FE
X0VOCQkJQklUKDMpCisjZGVmaW5lICAgU1dfU0hBRE9XX0xPQURfU0VMCQkJQklUKDQpCisjZGVm
aW5lICAgQkNNRDJBWElfTVNUUl9JRF9DVFJMCQkJQklUKDE2KQorI2RlZmluZSBEQ1NTX0RQUl9J
UlFfTUFTSwkJCTB4MDIwCisjZGVmaW5lIERDU1NfRFBSX0lSUV9NQVNLX1NUQVRVUwkJMHgwMzAK
KyNkZWZpbmUgRENTU19EUFJfSVJRX05PTk1BU0tfU1RBVFVTCQkweDA0MAorI2RlZmluZSAgIElS
UV9EUFJfQ1RSTF9ET05FCQkJQklUKDApCisjZGVmaW5lICAgSVJRX0RQUl9SVU4JCQkJQklUKDEp
CisjZGVmaW5lICAgSVJRX0RQUl9TSEFET1dfTE9BREVECQkJQklUKDIpCisjZGVmaW5lICAgSVJR
X0FYSV9SRUFEX0VSUgkJCUJJVCgzKQorI2RlZmluZSAgIERQUjJSVFJfWVJHQl9GSUZPX09WRkwJ
CUJJVCg0KQorI2RlZmluZSAgIERQUjJSVFJfVVZfRklGT19PVkZMCQkJQklUKDUpCisjZGVmaW5l
ICAgRFBSMlJUUl9GSUZPX0xEX0JVRl9SRFlfWVJHQl9FUlIJQklUKDYpCisjZGVmaW5lICAgRFBS
MlJUUl9GSUZPX0xEX0JVRl9SRFlfVVZfRVJSCUJJVCg3KQorI2RlZmluZSBEQ1NTX0RQUl9NT0RF
X0NUUkwwCQkJMHgwNTAKKyNkZWZpbmUgICBSVFJfM0JVRl9FTgkJCQlCSVQoMCkKKyNkZWZpbmUg
ICBSVFJfNExJTkVfQlVGX0VOCQkJQklUKDEpCisjZGVmaW5lICAgVElMRV9UWVBFX1BPUwkJCQky
CisjZGVmaW5lICAgVElMRV9UWVBFX01BU0sJCQlHRU5NQVNLKDQsIDIpCisjZGVmaW5lICAgWVVW
X0VOCQkJCUJJVCg2KQorI2RlZmluZSAgIENPTVBfMlBMQU5FX0VOCQkJQklUKDcpCisjZGVmaW5l
ICAgUElYX1NJWkVfUE9TCQkJCTgKKyNkZWZpbmUgICBQSVhfU0laRV9NQVNLCQkJCUdFTk1BU0so
OSwgOCkKKyNkZWZpbmUgICBQSVhfTFVNQV9VVl9TV0FQCQkJQklUKDEwKQorI2RlZmluZSAgIFBJ
WF9VVl9TV0FQCQkJCUJJVCgxMSkKKyNkZWZpbmUgICBCX0NPTVBfU0VMX1BPUwkJCTEyCisjZGVm
aW5lICAgQl9DT01QX1NFTF9NQVNLCQkJR0VOTUFTSygxMywgMTIpCisjZGVmaW5lICAgR19DT01Q
X1NFTF9QT1MJCQkxNAorI2RlZmluZSAgIEdfQ09NUF9TRUxfTUFTSwkJCUdFTk1BU0soMTUsIDE0
KQorI2RlZmluZSAgIFJfQ09NUF9TRUxfUE9TCQkJMTYKKyNkZWZpbmUgICBSX0NPTVBfU0VMX01B
U0sJCQlHRU5NQVNLKDE3LCAxNikKKyNkZWZpbmUgICBBX0NPTVBfU0VMX1BPUwkJCTE4CisjZGVm
aW5lICAgQV9DT01QX1NFTF9NQVNLCQkJR0VOTUFTSygxOSwgMTgpCisjZGVmaW5lIERDU1NfRFBS
X0ZSQU1FX0NUUkwwCQkJMHgwNzAKKyNkZWZpbmUgICBIRkxJUF9FTgkJCQlCSVQoMCkKKyNkZWZp
bmUgICBWRkxJUF9FTgkJCQlCSVQoMSkKKyNkZWZpbmUgICBST1RfRU5DX1BPUwkJCQkyCisjZGVm
aW5lICAgUk9UX0VOQ19NQVNLCQkJCUdFTk1BU0soMywgMikKKyNkZWZpbmUgICBST1RfRkxJUF9P
UkRFUl9FTgkJCUJJVCg0KQorI2RlZmluZSAgIFBJVENIX1BPUwkJCQkxNgorI2RlZmluZSAgIFBJ
VENIX01BU0sJCQkJR0VOTUFTSygzMSwgMTYpCisjZGVmaW5lIERDU1NfRFBSX0ZSQU1FXzFQX0NU
UkwwCQkJMHgwOTAKKyNkZWZpbmUgRENTU19EUFJfRlJBTUVfMVBfUElYX1hfQ1RSTAkJMHgwQTAK
KyNkZWZpbmUgRENTU19EUFJfRlJBTUVfMVBfUElYX1lfQ1RSTAkJMHgwQjAKKyNkZWZpbmUgRENT
U19EUFJfRlJBTUVfMVBfQkFTRV9BRERSCQkweDBDMAorI2RlZmluZSBEQ1NTX0RQUl9GUkFNRV8y
UF9DVFJMMAkJCTB4MEUwCisjZGVmaW5lIERDU1NfRFBSX0ZSQU1FXzJQX1BJWF9YX0NUUkwJCTB4
MEYwCisjZGVmaW5lIERDU1NfRFBSX0ZSQU1FXzJQX1BJWF9ZX0NUUkwJCTB4MTAwCisjZGVmaW5l
IERDU1NfRFBSX0ZSQU1FXzJQX0JBU0VfQUREUgkJMHgxMTAKKyNkZWZpbmUgRENTU19EUFJfU1RB
VFVTX0NUUkwwCQkJMHgxMzAKKyNkZWZpbmUgICBTVEFUVVNfTVVYX1NFTF9NQVNLCQkJR0VOTUFT
SygyLCAwKQorI2RlZmluZSAgIFNUQVRVU19TUkNfU0VMX1BPUwkJCTE2CisjZGVmaW5lICAgU1RB
VFVTX1NSQ19TRUxfTUFTSwkJCUdFTk1BU0soMTgsIDE2KQorI2RlZmluZSBEQ1NTX0RQUl9TVEFU
VVNfQ1RSTDEJCQkweDE0MAorI2RlZmluZSBEQ1NTX0RQUl9SVFJBTV9DVFJMMAkJCTB4MjAwCisj
ZGVmaW5lICAgTlVNX1JPV1NfQUNUSVZFCQkJQklUKDApCisjZGVmaW5lICAgVEhSRVNfSElHSF9Q
T1MJCQkxCisjZGVmaW5lICAgVEhSRVNfSElHSF9NQVNLCQkJR0VOTUFTSygzLCAxKQorI2RlZmlu
ZSAgIFRIUkVTX0xPV19QT1MJCQkJNAorI2RlZmluZSAgIFRIUkVTX0xPV19NQVNLCQkJR0VOTUFT
Syg2LCA0KQorI2RlZmluZSAgIEFCT1JUX1NFTAkJCQlCSVQoNykKKworc3RydWN0IGRjc3NfZHBy
X2NoIHsKKwlzdHJ1Y3QgZGNzc19kcHIgKmRwcjsKKwl2b2lkIF9faW9tZW0gKmJhc2VfcmVnOwor
CXUzMiBiYXNlX29mczsKKworCXN0cnVjdCBkcm1fZm9ybWF0X2luZm8gZm9ybWF0OworCWVudW0g
ZGNzc19waXhfc2l6ZSBwaXhfc2l6ZTsKKwllbnVtIGRjc3NfdGlsZV90eXBlIHRpbGU7CisJYm9v
bCBydHJhbV80bGluZV9lbjsKKwlib29sIHJ0cmFtXzNidWZfZW47CisKKwl1MzIgZnJhbWVfY3Ry
bDsKKwl1MzIgbW9kZV9jdHJsOworCXUzMiBzeXNfY3RybDsKKwl1MzIgcnRyYW1fY3RybDsKKwor
CWJvb2wgc3lzX2N0cmxfY2hnZDsKKworCXUzMiBwaXRjaDsKKworCWludCBjaF9udW07CisJaW50
IGlycTsKK307CisKK3N0cnVjdCBkY3NzX2RwciB7CisJc3RydWN0IGRldmljZSAqZGV2OworCXN0
cnVjdCBkY3NzX2N0eGxkICpjdHhsZDsKKwl1MzIgIGN0eF9pZDsKKworCXN0cnVjdCBkY3NzX2Rw
cl9jaCBjaFszXTsKK307CisKK3N0YXRpYyB2b2lkIGRjc3NfZHByX3dyaXRlKHN0cnVjdCBkY3Nz
X2Rwcl9jaCAqY2gsIHUzMiB2YWwsIHUzMiBvZnMpCit7CisJc3RydWN0IGRjc3NfZHByICpkcHIg
PSBjaC0+ZHByOworCisJZGNzc19jdHhsZF93cml0ZShkcHItPmN0eGxkLCBkcHItPmN0eF9pZCwg
dmFsLCBjaC0+YmFzZV9vZnMgKyBvZnMpOworfQorCitzdGF0aWMgaW50IGRjc3NfZHByX2NoX2lu
aXRfYWxsKHN0cnVjdCBkY3NzX2RwciAqZHByLCB1bnNpZ25lZCBsb25nIGRwcl9iYXNlKQorewor
CXN0cnVjdCBkY3NzX2Rwcl9jaCAqY2g7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgMzsg
aSsrKSB7CisJCWNoID0gJmRwci0+Y2hbaV07CisKKwkJY2gtPmJhc2Vfb2ZzID0gZHByX2Jhc2Ug
KyBpICogMHgxMDAwOworCisJCWNoLT5iYXNlX3JlZyA9IGRldm1faW9yZW1hcChkcHItPmRldiwg
Y2gtPmJhc2Vfb2ZzLCBTWl80Syk7CisJCWlmICghY2gtPmJhc2VfcmVnKSB7CisJCQlkZXZfZXJy
KGRwci0+ZGV2LCAiZHByOiB1bmFibGUgdG8gcmVtYXAgY2ggJWQgYmFzZVxuIiwKKwkJCQlpKTsK
KwkJCXJldHVybiAtRU5PTUVNOworCQl9CisKKwkJY2gtPmRwciA9IGRwcjsKKwkJY2gtPmNoX251
bSA9IGk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK2ludCBkY3NzX2Rwcl9pbml0KHN0cnVjdCBk
Y3NzX2RldiAqZGNzcywgdW5zaWduZWQgbG9uZyBkcHJfYmFzZSkKK3sKKwlzdHJ1Y3QgZGNzc19k
cHIgKmRwcjsKKworCWRwciA9IGRldm1fa3phbGxvYyhkY3NzLT5kZXYsIHNpemVvZihzdHJ1Y3Qg
ZGNzc19kcHIpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRwcikKKwkJcmV0dXJuIC1FTk9NRU07CisK
KwlkY3NzLT5kcHIgPSBkcHI7CisJZHByLT5kZXYgPSBkY3NzLT5kZXY7CisJZHByLT5jdHhsZCA9
IGRjc3MtPmN0eGxkOworCWRwci0+Y3R4X2lkID0gQ1RYX1NCX0hQOworCisJaWYgKGRjc3NfZHBy
X2NoX2luaXRfYWxsKGRwciwgZHByX2Jhc2UpKSB7CisJCWludCBpOworCisJCWZvciAoaSA9IDA7
IGkgPCAzOyBpKyspIHsKKwkJCWlmIChkcHItPmNoW2ldLmJhc2VfcmVnKQorCQkJCWRldm1faW91
bm1hcChkcHItPmRldiwgZHByLT5jaFtpXS5iYXNlX3JlZyk7CisJCX0KKworCQlkZXZtX2tmcmVl
KGRwci0+ZGV2LCBkcHIpOworCisJCXJldHVybiAtRU5PTUVNOworCX0KKworCXJldHVybiAwOwor
fQorCit2b2lkIGRjc3NfZHByX2V4aXQoc3RydWN0IGRjc3NfZHByICpkcHIpCit7CisJaW50IGNo
X25vOworCisJLyogc3RvcCBEUFIgb24gYWxsIGNoYW5uZWxzICovCisJZm9yIChjaF9ubyA9IDA7
IGNoX25vIDwgMzsgY2hfbm8rKykgeworCQlzdHJ1Y3QgZGNzc19kcHJfY2ggKmNoID0gJmRwci0+
Y2hbY2hfbm9dOworCisJCWRjc3Nfd3JpdGVsKDAsIGNoLT5iYXNlX3JlZyArIERDU1NfRFBSX1NZ
U1RFTV9DVFJMMCk7CisKKwkJaWYgKGNoLT5iYXNlX3JlZykKKwkJCWRldm1faW91bm1hcChkcHIt
PmRldiwgY2gtPmJhc2VfcmVnKTsKKwl9CisKKwlkZXZtX2tmcmVlKGRwci0+ZGV2LCBkcHIpOwor
fQorCitzdGF0aWMgdTMyIGRjc3NfZHByX3hfcGl4X3dpZGVfYWRqdXN0KHN0cnVjdCBkY3NzX2Rw
cl9jaCAqY2gsIHUzMiBwaXhfd2lkZSwKKwkJCQkgICAgICB1MzIgcGl4X2Zvcm1hdCkKK3sKKwl1
OCBwaXhfaW5fNjRieXRlX21hcFszXVs1XSA9IHsKKwkJLyogTElOLCBHUFVfU1RELCBHUFVfU1VQ
LCBWUFVfWVVWNDIwLCBWUFVfVlA5ICovCisJCXsgICA2NCwgICAgICAgOCwgICAgICAgOCwgICAg
ICAgICAgOCwgICAgIDE2fSwgLyogUElYX1NJWkVfOCAgKi8KKwkJeyAgIDMyLCAgICAgICA4LCAg
ICAgICA4LCAgICAgICAgICA4LCAgICAgIDh9LCAvKiBQSVhfU0laRV8xNiAqLworCQl7ICAgMTYs
ICAgICAgIDQsICAgICAgIDQsICAgICAgICAgIDgsICAgICAgOH0sIC8qIFBJWF9TSVpFXzMyICov
CisJfTsKKwl1MzIgb2Zmc2V0OworCXUzMiBkaXZfNjRieXRlX21vZCwgcGl4X2luXzY0Ynl0ZTsK
KworCXBpeF9pbl82NGJ5dGUgPSBwaXhfaW5fNjRieXRlX21hcFtjaC0+cGl4X3NpemVdW2NoLT50
aWxlXTsKKworCWlmIChwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfUDAxMCkKKwkJcGl4X3dpZGUg
PSBwaXhfd2lkZSAqIDEwIC8gODsKKworCWRpdl82NGJ5dGVfbW9kID0gcGl4X3dpZGUgJSBwaXhf
aW5fNjRieXRlOworCW9mZnNldCA9IChkaXZfNjRieXRlX21vZCA9PSAwKSA/IDAgOiAocGl4X2lu
XzY0Ynl0ZSAtIGRpdl82NGJ5dGVfbW9kKTsKKworCXJldHVybiBwaXhfd2lkZSArIG9mZnNldDsK
K30KKworc3RhdGljIHUzMiBkY3NzX2Rwcl95X3BpeF9oaWdoX2FkanVzdChzdHJ1Y3QgZGNzc19k
cHJfY2ggKmNoLCB1MzIgcGl4X2hpZ2gsCisJCQkJICAgICAgdTMyIHBpeF9mb3JtYXQpCit7CisJ
dTggbnVtX3Jvd3NfYnVmID0gY2gtPnJ0cmFtXzRsaW5lX2VuID8gNCA6IDg7CisJdTMyIG9mZnNl
dCwgcGl4X3lfbW9kOworCisJcGl4X3lfbW9kID0gcGl4X2hpZ2ggJSBudW1fcm93c19idWY7CisJ
b2Zmc2V0ID0gcGl4X3lfbW9kID8gKG51bV9yb3dzX2J1ZiAtIHBpeF95X21vZCkgOiAwOworCisJ
cmV0dXJuIHBpeF9oaWdoICsgb2Zmc2V0OworfQorCit2b2lkIGRjc3NfZHByX3NldF9yZXMoc3Ry
dWN0IGRjc3NfZHByICpkcHIsIGludCBjaF9udW0sIHUzMiB4cmVzLCB1MzIgeXJlcykKK3sKKwlz
dHJ1Y3QgZGNzc19kcHJfY2ggKmNoID0gJmRwci0+Y2hbY2hfbnVtXTsKKwl1MzIgcGl4X2Zvcm1h
dCA9IGNoLT5mb3JtYXQuZm9ybWF0OworCXUzMiBnYXAgPSBEQ1NTX0RQUl9GUkFNRV8yUF9CQVNF
X0FERFIgLSBEQ1NTX0RQUl9GUkFNRV8xUF9CQVNFX0FERFI7CisJaW50IHBsYW5lLCBtYXhfcGxh
bmVzID0gMTsKKwl1MzIgcGl4X3hfd2lkZSwgcGl4X3lfaGlnaDsKKworCWlmIChwaXhfZm9ybWF0
ID09IERSTV9GT1JNQVRfTlYxMiB8fAorCSAgICBwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfTlYy
MSkKKwkJbWF4X3BsYW5lcyA9IDI7CisKKwlmb3IgKHBsYW5lID0gMDsgcGxhbmUgPCBtYXhfcGxh
bmVzOyBwbGFuZSsrKSB7CisJCXlyZXMgPSBwbGFuZSA9PSAxID8geXJlcyA+PiAxIDogeXJlczsK
KworCQlwaXhfeF93aWRlID0gZGNzc19kcHJfeF9waXhfd2lkZV9hZGp1c3QoY2gsIHhyZXMsIHBp
eF9mb3JtYXQpOworCQlwaXhfeV9oaWdoID0gZGNzc19kcHJfeV9waXhfaGlnaF9hZGp1c3QoY2gs
IHlyZXMsIHBpeF9mb3JtYXQpOworCisJCWlmIChwbGFuZSA9PSAwKQorCQkJY2gtPnBpdGNoID0g
cGl4X3hfd2lkZTsKKworCQlkY3NzX2Rwcl93cml0ZShjaCwgcGl4X3hfd2lkZSwKKwkJCSAgICAg
ICBEQ1NTX0RQUl9GUkFNRV8xUF9QSVhfWF9DVFJMICsgcGxhbmUgKiBnYXApOworCQlkY3NzX2Rw
cl93cml0ZShjaCwgcGl4X3lfaGlnaCwKKwkJCSAgICAgICBEQ1NTX0RQUl9GUkFNRV8xUF9QSVhf
WV9DVFJMICsgcGxhbmUgKiBnYXApOworCisJCWRjc3NfZHByX3dyaXRlKGNoLCAyLCBEQ1NTX0RQ
Ul9GUkFNRV8xUF9DVFJMMCArIHBsYW5lICogZ2FwKTsKKwl9Cit9CisKK3ZvaWQgZGNzc19kcHJf
YWRkcl9zZXQoc3RydWN0IGRjc3NfZHByICpkcHIsIGludCBjaF9udW0sIHUzMiBsdW1hX2Jhc2Vf
YWRkciwKKwkJICAgICAgIHUzMiBjaHJvbWFfYmFzZV9hZGRyLCB1MTYgcGl0Y2gpCit7CisJc3Ry
dWN0IGRjc3NfZHByX2NoICpjaCA9ICZkcHItPmNoW2NoX251bV07CisKKwlkY3NzX2Rwcl93cml0
ZShjaCwgbHVtYV9iYXNlX2FkZHIsIERDU1NfRFBSX0ZSQU1FXzFQX0JBU0VfQUREUik7CisKKwlk
Y3NzX2Rwcl93cml0ZShjaCwgY2hyb21hX2Jhc2VfYWRkciwgRENTU19EUFJfRlJBTUVfMlBfQkFT
RV9BRERSKTsKKworCWNoLT5mcmFtZV9jdHJsICY9IH5QSVRDSF9NQVNLOworCWNoLT5mcmFtZV9j
dHJsIHw9ICgoKHUzMilwaXRjaCA8PCBQSVRDSF9QT1MpICYgUElUQ0hfTUFTSyk7Cit9CisKK3N0
YXRpYyB2b2lkIGRjc3NfZHByX2FyZ2JfY29tcF9zZWwoc3RydWN0IGRjc3NfZHByX2NoICpjaCwg
aW50IGFfc2VsLCBpbnQgcl9zZWwsCisJCQkJICAgaW50IGdfc2VsLCBpbnQgYl9zZWwpCit7CisJ
dTMyIHNlbDsKKworCXNlbCA9ICgoYV9zZWwgPDwgQV9DT01QX1NFTF9QT1MpICYgQV9DT01QX1NF
TF9NQVNLKSB8CisJICAgICAgKChyX3NlbCA8PCBSX0NPTVBfU0VMX1BPUykgJiBSX0NPTVBfU0VM
X01BU0spIHwKKwkgICAgICAoKGdfc2VsIDw8IEdfQ09NUF9TRUxfUE9TKSAmIEdfQ09NUF9TRUxf
TUFTSykgfAorCSAgICAgICgoYl9zZWwgPDwgQl9DT01QX1NFTF9QT1MpICYgQl9DT01QX1NFTF9N
QVNLKTsKKworCWNoLT5tb2RlX2N0cmwgJj0gfihBX0NPTVBfU0VMX01BU0sgfCBSX0NPTVBfU0VM
X01BU0sgfAorCQkJICAgR19DT01QX1NFTF9NQVNLIHwgQl9DT01QX1NFTF9NQVNLKTsKKwljaC0+
bW9kZV9jdHJsIHw9IHNlbDsKK30KKworc3RhdGljIHZvaWQgZGNzc19kcHJfcGl4X3NpemVfc2V0
KHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsCisJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICpmb3JtYXQpCit7CisJdTMyIHZhbDsKKworCXN3aXRjaCAoZm9ybWF0LT5mb3JtYXQpIHsK
KwljYXNlIERSTV9GT1JNQVRfTlYxMjoKKwljYXNlIERSTV9GT1JNQVRfTlYyMToKKwkJdmFsID0g
MDsKKwkJYnJlYWs7CisKKwljYXNlIERSTV9GT1JNQVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRf
VllVWToKKwljYXNlIERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwkJ
dmFsID0gMTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQl2YWwgPSAyOworCQlicmVhazsKKwl9
CisKKwljaC0+cGl4X3NpemUgPSB2YWw7CisKKwljaC0+bW9kZV9jdHJsICY9IH5QSVhfU0laRV9N
QVNLOworCWNoLT5tb2RlX2N0cmwgfD0gKCh2YWwgPDwgUElYX1NJWkVfUE9TKSAmIFBJWF9TSVpF
X01BU0spOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rwcl91dl9zd2FwKHN0cnVjdCBkY3NzX2Rw
cl9jaCAqY2gsIGJvb2wgc3dhcCkKK3sKKwljaC0+bW9kZV9jdHJsICY9IH5QSVhfVVZfU1dBUDsK
KwljaC0+bW9kZV9jdHJsIHw9IChzd2FwID8gUElYX1VWX1NXQVAgOiAwKTsKK30KKworc3RhdGlj
IHZvaWQgZGNzc19kcHJfeV91dl9zd2FwKHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIGJvb2wgc3dh
cCkKK3sKKwljaC0+bW9kZV9jdHJsICY9IH5QSVhfTFVNQV9VVl9TV0FQOworCWNoLT5tb2RlX2N0
cmwgfD0gKHN3YXAgPyBQSVhfTFVNQV9VVl9TV0FQIDogMCk7Cit9CisKK3N0YXRpYyB2b2lkIGRj
c3NfZHByXzJwbGFuZV9lbihzdHJ1Y3QgZGNzc19kcHJfY2ggKmNoLCBib29sIGVuKQoreworCWNo
LT5tb2RlX2N0cmwgJj0gfkNPTVBfMlBMQU5FX0VOOworCWNoLT5tb2RlX2N0cmwgfD0gKGVuID8g
Q09NUF8yUExBTkVfRU4gOiAwKTsKK30KKworc3RhdGljIHZvaWQgZGNzc19kcHJfeXV2X2VuKHN0
cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIGJvb2wgZW4pCit7CisJY2gtPm1vZGVfY3RybCAmPSB+WVVW
X0VOOworCWNoLT5tb2RlX2N0cmwgfD0gKGVuID8gWVVWX0VOIDogMCk7Cit9CisKK3ZvaWQgZGNz
c19kcHJfZW5hYmxlKHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQgY2hfbnVtLCBib29sIGVuKQor
eworCXN0cnVjdCBkY3NzX2Rwcl9jaCAqY2ggPSAmZHByLT5jaFtjaF9udW1dOworCXUzMiBzeXNf
Y3RybDsKKworCXN5c19jdHJsID0gKGVuID8gUkVQRUFUX0VOIHwgUlVOX0VOIDogMCk7CisKKwlp
ZiAoZW4pIHsKKwkJZGNzc19kcHJfd3JpdGUoY2gsIGNoLT5tb2RlX2N0cmwsIERDU1NfRFBSX01P
REVfQ1RSTDApOworCQlkY3NzX2Rwcl93cml0ZShjaCwgY2gtPmZyYW1lX2N0cmwsIERDU1NfRFBS
X0ZSQU1FX0NUUkwwKTsKKwkJZGNzc19kcHJfd3JpdGUoY2gsIGNoLT5ydHJhbV9jdHJsLCBEQ1NT
X0RQUl9SVFJBTV9DVFJMMCk7CisJfQorCisJaWYgKGNoLT5zeXNfY3RybCAhPSBzeXNfY3RybCkK
KwkJY2gtPnN5c19jdHJsX2NoZ2QgPSB0cnVlOworCisJY2gtPnN5c19jdHJsID0gc3lzX2N0cmw7
Cit9CisKK3N0cnVjdCByZ2JfY29tcF9zZWwgeworCXUzMiBkcm1fZm9ybWF0OworCWludCBhX3Nl
bDsKKwlpbnQgcl9zZWw7CisJaW50IGdfc2VsOworCWludCBiX3NlbDsKK307CisKK3N0YXRpYyBz
dHJ1Y3QgcmdiX2NvbXBfc2VsIGNvbXBfc2VsX21hcFtdID0geworCXtEUk1fRk9STUFUX0FSR0I4
ODg4LCAzLCAyLCAxLCAwfSwKKwl7RFJNX0ZPUk1BVF9YUkdCODg4OCwgMywgMiwgMSwgMH0sCisJ
e0RSTV9GT1JNQVRfQUJHUjg4ODgsIDMsIDAsIDEsIDJ9LAorCXtEUk1fRk9STUFUX1hCR1I4ODg4
LCAzLCAwLCAxLCAyfSwKKwl7RFJNX0ZPUk1BVF9SR0JBODg4OCwgMCwgMywgMiwgMX0sCisJe0RS
TV9GT1JNQVRfUkdCWDg4ODgsIDAsIDMsIDIsIDF9LAorCXtEUk1fRk9STUFUX0JHUkE4ODg4LCAw
LCAxLCAyLCAzfSwKKwl7RFJNX0ZPUk1BVF9CR1JYODg4OCwgMCwgMSwgMiwgM30sCit9OworCitz
dGF0aWMgaW50IHRvX2NvbXBfc2VsKHUzMiBwaXhfZm10LCBpbnQgKmFfc2VsLCBpbnQgKnJfc2Vs
LCBpbnQgKmdfc2VsLAorCQkgICAgICAgaW50ICpiX3NlbCkKK3sKKwlpbnQgaTsKKworCWZvciAo
aSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNvbXBfc2VsX21hcCk7IGkrKykgeworCQlpZiAoY29tcF9z
ZWxfbWFwW2ldLmRybV9mb3JtYXQgPT0gcGl4X2ZtdCkgeworCQkJKmFfc2VsID0gY29tcF9zZWxf
bWFwW2ldLmFfc2VsOworCQkJKnJfc2VsID0gY29tcF9zZWxfbWFwW2ldLnJfc2VsOworCQkJKmdf
c2VsID0gY29tcF9zZWxfbWFwW2ldLmdfc2VsOworCQkJKmJfc2VsID0gY29tcF9zZWxfbWFwW2ld
LmJfc2VsOworCisJCQlyZXR1cm4gMDsKKwkJfQorCX0KKworCXJldHVybiAtMTsKK30KKworc3Rh
dGljIHZvaWQgZGNzc19kcHJfcnRyYW1fc2V0KHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIHUzMiBw
aXhfZm9ybWF0KQoreworCXUzMiB2YWwsIG1hc2s7CisKKwlzd2l0Y2ggKHBpeF9mb3JtYXQpIHsK
KwljYXNlIERSTV9GT1JNQVRfTlYyMToKKwljYXNlIERSTV9GT1JNQVRfTlYxMjoKKwljYXNlIERS
TV9GT1JNQVRfUDAxMDoKKwkJY2gtPnJ0cmFtXzNidWZfZW4gPSB0cnVlOworCQljaC0+cnRyYW1f
NGxpbmVfZW4gPSBmYWxzZTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQljaC0+cnRyYW1fM2J1
Zl9lbiA9IHRydWU7CisJCWNoLT5ydHJhbV80bGluZV9lbiA9IHRydWU7CisJCWJyZWFrOworCX0K
KworCXZhbCA9IChjaC0+cnRyYW1fNGxpbmVfZW4gPyBSVFJfNExJTkVfQlVGX0VOIDogMCk7CisJ
dmFsIHw9IChjaC0+cnRyYW1fM2J1Zl9lbiA/IFJUUl8zQlVGX0VOIDogMCk7CisJbWFzayA9IFJU
Ul80TElORV9CVUZfRU4gfCBSVFJfM0JVRl9FTjsKKworCWNoLT5tb2RlX2N0cmwgJj0gfm1hc2s7
CisJY2gtPm1vZGVfY3RybCB8PSAodmFsICYgbWFzayk7CisKKwl2YWwgPSAoY2gtPnJ0cmFtXzRs
aW5lX2VuID8gMCA6IE5VTV9ST1dTX0FDVElWRSk7CisJdmFsIHw9ICgzIDw8IFRIUkVTX0xPV19Q
T1MpICYgVEhSRVNfTE9XX01BU0s7CisJdmFsIHw9ICg0IDw8IFRIUkVTX0hJR0hfUE9TKSAmIFRI
UkVTX0hJR0hfTUFTSzsKKwltYXNrID0gVEhSRVNfTE9XX01BU0sgfCBUSFJFU19ISUdIX01BU0sg
fCBOVU1fUk9XU19BQ1RJVkU7CisKKwljaC0+cnRyYW1fY3RybCAmPSB+bWFzazsKKwljaC0+cnRy
YW1fY3RybCB8PSAodmFsICYgbWFzayk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfZHByX3NldHVw
X2NvbXBvbmVudHMoc3RydWN0IGRjc3NfZHByX2NoICpjaCwKKwkJCQkgICAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQpCit7CisJaW50IGFfc2VsLCByX3NlbCwgZ19zZWws
IGJfc2VsOworCWJvb2wgdXZfc3dhcCwgeV91dl9zd2FwOworCisJc3dpdGNoIChmb3JtYXQtPmZv
cm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9ZVllVOgorCQl1dl9zd2FwID0gdHJ1ZTsKKwkJeV91
dl9zd2FwID0gdHJ1ZTsKKwkJYnJlYWs7CisKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNl
IERSTV9GT1JNQVRfTlYyMToKKwkJdXZfc3dhcCA9IHRydWU7CisJCXlfdXZfc3dhcCA9IGZhbHNl
OworCQlicmVhazsKKworCWNhc2UgRFJNX0ZPUk1BVF9ZVVlWOgorCQl1dl9zd2FwID0gZmFsc2U7
CisJCXlfdXZfc3dhcCA9IHRydWU7CisJCWJyZWFrOworCisJZGVmYXVsdDoKKwkJdXZfc3dhcCA9
IGZhbHNlOworCQl5X3V2X3N3YXAgPSBmYWxzZTsKKwkJYnJlYWs7CisJfQorCisJZGNzc19kcHJf
dXZfc3dhcChjaCwgdXZfc3dhcCk7CisKKwlkY3NzX2Rwcl95X3V2X3N3YXAoY2gsIHlfdXZfc3dh
cCk7CisKKwlpZiAoIWZvcm1hdC0+aXNfeXV2KSB7CisJCWlmICghdG9fY29tcF9zZWwoZm9ybWF0
LT5mb3JtYXQsICZhX3NlbCwgJnJfc2VsLAorCQkJCSAmZ19zZWwsICZiX3NlbCkpIHsKKwkJCWRj
c3NfZHByX2FyZ2JfY29tcF9zZWwoY2gsIGFfc2VsLCByX3NlbCwgZ19zZWwsIGJfc2VsKTsKKwkJ
fSBlbHNlIHsKKwkJCWRjc3NfZHByX2FyZ2JfY29tcF9zZWwoY2gsIDMsIDIsIDEsIDApOworCQl9
CisJfSBlbHNlIHsKKwkJZGNzc19kcHJfYXJnYl9jb21wX3NlbChjaCwgMCwgMCwgMCwgMCk7CisJ
fQorfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rwcl90aWxlX3NldChzdHJ1Y3QgZGNzc19kcHJfY2gg
KmNoLCB1aW50NjRfdCBtb2RpZmllcikKK3sKKwlzd2l0Y2ggKGNoLT5jaF9udW0pIHsKKwljYXNl
IDA6CisJCXN3aXRjaCAobW9kaWZpZXIpIHsKKwkJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6
CisJCQljaC0+dGlsZSA9IFRJTEVfTElORUFSOworCQkJYnJlYWs7CisJCWNhc2UgRFJNX0ZPUk1B
VF9NT0RfVklWQU5URV9USUxFRDoKKwkJCWNoLT50aWxlID0gVElMRV9HUFVfU1RBTkRBUkQ7CisJ
CQlicmVhazsKKwkJY2FzZSBEUk1fRk9STUFUX01PRF9WSVZBTlRFX1NVUEVSX1RJTEVEOgorCQkJ
Y2gtPnRpbGUgPSBUSUxFX0dQVV9TVVBFUjsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJV0FS
Tl9PTigxKTsKKwkJCWJyZWFrOworCQl9CisJCWJyZWFrOworCWNhc2UgMToKKwljYXNlIDI6CisJ
CWNoLT50aWxlID0gVElMRV9MSU5FQVI7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCVdBUk5fT04o
MSk7CisJCXJldHVybjsKKwl9CisKKwljaC0+bW9kZV9jdHJsICY9IH5USUxFX1RZUEVfTUFTSzsK
KwljaC0+bW9kZV9jdHJsIHw9ICgoY2gtPnRpbGUgPDwgVElMRV9UWVBFX1BPUykgJiBUSUxFX1RZ
UEVfTUFTSyk7Cit9CisKK3ZvaWQgZGNzc19kcHJfZm9ybWF0X3NldChzdHJ1Y3QgZGNzc19kcHIg
KmRwciwgaW50IGNoX251bSwKKwkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3Jt
YXQsIHU2NCBtb2RpZmllcikKK3sKKwlzdHJ1Y3QgZGNzc19kcHJfY2ggKmNoID0gJmRwci0+Y2hb
Y2hfbnVtXTsKKworCWNoLT5mb3JtYXQgPSAqZm9ybWF0OworCisJZGNzc19kcHJfeXV2X2VuKGNo
LCBmb3JtYXQtPmlzX3l1dik7CisKKwlkY3NzX2Rwcl9waXhfc2l6ZV9zZXQoY2gsIGZvcm1hdCk7
CisKKwlkY3NzX2Rwcl9zZXR1cF9jb21wb25lbnRzKGNoLCBmb3JtYXQpOworCisJZGNzc19kcHJf
MnBsYW5lX2VuKGNoLCBmb3JtYXQtPm51bV9wbGFuZXMgPT0gMik7CisKKwlkY3NzX2Rwcl9ydHJh
bV9zZXQoY2gsIGZvcm1hdC0+Zm9ybWF0KTsKKworCWRjc3NfZHByX3RpbGVfc2V0KGNoLCBtb2Rp
Zmllcik7Cit9CisKKy8qIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgZnJvbSBpbnRlcnJ1
cHQgY29udGV4dC4gKi8KK3ZvaWQgZGNzc19kcHJfd3JpdGVfc3lzY3RybChzdHJ1Y3QgZGNzc19k
cHIgKmRwcikKK3sKKwlpbnQgY2hudW07CisKKwlmb3IgKGNobnVtID0gMDsgY2hudW0gPCAzOyBj
aG51bSsrKSB7CisJCXN0cnVjdCBkY3NzX2Rwcl9jaCAqY2ggPSAmZHByLT5jaFtjaG51bV07CisK
KwkJaWYgKGNoLT5zeXNfY3RybF9jaGdkKSB7CisJCQlkY3NzX2N0eGxkX3dyaXRlX2lycXNhZmUo
ZHByLT5jdHhsZCwgZHByLT5jdHhfaWQsCisJCQkJCQkgY2gtPnN5c19jdHJsLAorCQkJCQkJIGNo
LT5iYXNlX29mcyArCisJCQkJCQkgRENTU19EUFJfU1lTVEVNX0NUUkwwKTsKKwkJCWNoLT5zeXNf
Y3RybF9jaGdkID0gZmFsc2U7CisJCX0KKwl9Cit9CisKK3ZvaWQgZGNzc19kcHJfc2V0X3JvdGF0
aW9uKHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQgY2hfbnVtLCB1MzIgcm90YXRpb24pCit7CisJ
c3RydWN0IGRjc3NfZHByX2NoICpjaCA9ICZkcHItPmNoW2NoX251bV07CisKKwljaC0+ZnJhbWVf
Y3RybCAmPSB+KEhGTElQX0VOIHwgVkZMSVBfRU4gfCBST1RfRU5DX01BU0spOworCisJY2gtPmZy
YW1lX2N0cmwgfD0gcm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1ggPyBIRkxJUF9FTiA6IDA7
CisJY2gtPmZyYW1lX2N0cmwgfD0gcm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1kgPyBWRkxJ
UF9FTiA6IDA7CisKKwlpZiAocm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfOTApCisJCWNoLT5m
cmFtZV9jdHJsIHw9IDEgPDwgUk9UX0VOQ19QT1M7CisJZWxzZSBpZiAocm90YXRpb24gJiBEUk1f
TU9ERV9ST1RBVEVfMTgwKQorCQljaC0+ZnJhbWVfY3RybCB8PSAyIDw8IFJPVF9FTkNfUE9TOwor
CWVsc2UgaWYgKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzI3MCkKKwkJY2gtPmZyYW1lX2N0
cmwgfD0gMyA8PCBST1RfRU5DX1BPUzsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
bXgvZGNzcy9kY3NzLWRydi5jIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHJ2LmMK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLjdlYTEzMWQKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kcnYuYwpAQCAtMCwwICsxLDE4
MiBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmln
aHQgMjAxOSBOWFAuCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUg
PGxpbnV4L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L2NvbXBvbmVudC5oPgorI2luY2x1ZGUgPGRybS9kcm1fb2YuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtUC5oPgorCisjaW5jbHVkZSAiZGNzcy1kZXYuaCIKKyNpbmNsdWRlICJkY3Nz
LWttcy5oIgorCitzdHJ1Y3QgZGNzc19kcnYgeworCXN0cnVjdCBkY3NzX2RldiAqZGNzczsKKwlz
dHJ1Y3QgZGNzc19rbXNfZGV2ICprbXM7CisKKwlib29sIGlzX2NvbXBvbmVudGl6ZWQ7Cit9Owor
CitzdHJ1Y3QgZGNzc19kZXYgKmRjc3NfZHJ2X2Rldl90b19kY3NzKHN0cnVjdCBkZXZpY2UgKmRl
dikKK3sKKwlzdHJ1Y3QgZGNzc19kcnYgKm1kcnYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwor
CXJldHVybiBtZHJ2ID8gbWRydi0+ZGNzcyA6IE5VTEw7Cit9CisKK3N0cnVjdCBkcm1fZGV2aWNl
ICpkY3NzX2Rydl9kZXZfdG9fZHJtKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgZGNz
c19kcnYgKm1kcnYgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKworCXJldHVybiBtZHJ2ID8gJm1k
cnYtPmttcy0+YmFzZSA6IE5VTEw7Cit9CisKK3N0YXRpYyBpbnQgZGNzc19kcnZfaW5pdChzdHJ1
Y3QgZGV2aWNlICpkZXYsIGJvb2wgY29tcG9uZW50aXplZCkKK3sKKwlzdHJ1Y3QgZGNzc19kcnYg
Km1kcnY7CisJaW50IGVyciA9IDA7CisKKwltZHJ2ID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9m
KCptZHJ2KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFtZHJ2KQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CW1kcnYtPmlzX2NvbXBvbmVudGl6ZWQgPSBjb21wb25lbnRpemVkOworCisJbWRydi0+ZGNzcyA9
IGRjc3NfZGV2X2NyZWF0ZShkZXYsIGNvbXBvbmVudGl6ZWQpOworCWlmIChJU19FUlIobWRydi0+
ZGNzcykpIHsKKwkJZXJyID0gUFRSX0VSUihtZHJ2LT5kY3NzKTsKKwkJZ290byBlcnI7CisJfQor
CisJZGV2X3NldF9kcnZkYXRhKGRldiwgbWRydik7CisKKwltZHJ2LT5rbXMgPSBkY3NzX2ttc19h
dHRhY2gobWRydi0+ZGNzcywgY29tcG9uZW50aXplZCk7CisJaWYgKElTX0VSUihtZHJ2LT5rbXMp
KSB7CisJCWVyciA9IFBUUl9FUlIobWRydi0+a21zKTsKKwkJZ290byBkY3NzX3NodXRvZmY7CisJ
fQorCisJcmV0dXJuIDA7CisKK2Rjc3Nfc2h1dG9mZjoKKwlkY3NzX2Rldl9kZXN0cm95KG1kcnYt
PmRjc3MpOworCisJZGV2X3NldF9kcnZkYXRhKGRldiwgTlVMTCk7CisKK2VycjoKKwlkZXZtX2tm
cmVlKGRldiwgbWRydik7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHZvaWQgZGNzc19kcnZf
ZGVpbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgYm9vbCBjb21wb25lbnRpemVkKQoreworCXN0cnVj
dCBkY3NzX2RydiAqbWRydiA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJaWYgKCFtZHJ2KQor
CQlyZXR1cm47CisKKwlkY3NzX2ttc19kZXRhY2gobWRydi0+a21zLCBjb21wb25lbnRpemVkKTsK
KwlkY3NzX2Rldl9kZXN0cm95KG1kcnYtPmRjc3MpOworCisJZGV2X3NldF9kcnZkYXRhKGRldiwg
TlVMTCk7Cit9CisKK3N0YXRpYyBpbnQgZGNzc19kcnZfYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYp
Cit7CisJcmV0dXJuIGRjc3NfZHJ2X2luaXQoZGV2LCB0cnVlKTsKK30KKworc3RhdGljIHZvaWQg
ZGNzc19kcnZfdW5iaW5kKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlyZXR1cm4gZGNzc19kcnZf
ZGVpbml0KGRldiwgdHJ1ZSk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgY29tcG9uZW50X21h
c3Rlcl9vcHMgZGNzc19tYXN0ZXJfb3BzID0geworCS5iaW5kCT0gZGNzc19kcnZfYmluZCwKKwku
dW5iaW5kCT0gZGNzc19kcnZfdW5iaW5kLAorfTsKKworc3RhdGljIGludCBjb21wYXJlX29mKHN0
cnVjdCBkZXZpY2UgKmRldiwgdm9pZCAqZGF0YSkKK3sKKwlyZXR1cm4gZGV2LT5vZl9ub2RlID09
IGRhdGE7Cit9CisKK3N0YXRpYyBpbnQgZGNzc19kcnZfcGxhdGZvcm1fcHJvYmUoc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmcGRldi0+ZGV2
OworCXN0cnVjdCBjb21wb25lbnRfbWF0Y2ggKm1hdGNoID0gTlVMTDsKKwlzdHJ1Y3QgZGV2aWNl
X25vZGUgKnJlbW90ZTsKKworCWlmICghZGV2LT5vZl9ub2RlKQorCQlyZXR1cm4gLUVOT0RFVjsK
KworCXJlbW90ZSA9IG9mX2dyYXBoX2dldF9yZW1vdGVfbm9kZShkZXYtPm9mX25vZGUsIDAsIDAp
OworCWlmICghcmVtb3RlKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCWlmIChvZl9kZXZpY2VfaXNf
Y29tcGF0aWJsZShyZW1vdGUsICJmc2wsaW14OG1xLW53bC1kc2kiKSkgeworCQlvZl9ub2RlX3B1
dChyZW1vdGUpOworCQlyZXR1cm4gZGNzc19kcnZfaW5pdChkZXYsIGZhbHNlKTsKKwl9CisKKwlk
cm1fb2ZfY29tcG9uZW50X21hdGNoX2FkZChkZXYsICZtYXRjaCwgY29tcGFyZV9vZiwgcmVtb3Rl
KTsKKwlvZl9ub2RlX3B1dChyZW1vdGUpOworCisJcmV0dXJuIGNvbXBvbmVudF9tYXN0ZXJfYWRk
X3dpdGhfbWF0Y2goZGV2LCAmZGNzc19tYXN0ZXJfb3BzLCBtYXRjaCk7Cit9CisKK3N0YXRpYyBp
bnQgZGNzc19kcnZfcGxhdGZvcm1fcmVtb3ZlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYp
Cit7CisJc3RydWN0IGRjc3NfZHJ2ICptZHJ2ID0gZGV2X2dldF9kcnZkYXRhKCZwZGV2LT5kZXYp
OworCisJaWYgKG1kcnYtPmlzX2NvbXBvbmVudGl6ZWQpCisJCWNvbXBvbmVudF9tYXN0ZXJfZGVs
KCZwZGV2LT5kZXYsICZkY3NzX21hc3Rlcl9vcHMpOworCWVsc2UKKwkJZGNzc19kcnZfZGVpbml0
KCZwZGV2LT5kZXYsIGZhbHNlKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IGRj
c3NfdHlwZV9kYXRhIGRjc3NfdHlwZXNbXSA9IHsKKwlbRENTU19JTVg4TVFdID0geworCQkubmFt
ZSA9ICJEQ1NTX0lNWDhNUSIsCisJCS5ibGtjdGxfb2ZzID0gMHgyRjAwMCwKKwkJLmN0eGxkX29m
cyA9IDB4MjMwMDAsCisJCS5kdGdfb2ZzID0gMHgyMDAwMCwKKwkJLnNjYWxlcl9vZnMgPSAweDFD
MDAwLAorCQkuc3Nfb2ZzID0gMHgxQjAwMCwKKwkJLmRwcl9vZnMgPSAweDE4MDAwLAorCX0sCit9
OworCitzdGF0aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCBkY3NzX29mX21hdGNoW10gPSB7
CisJeyAuY29tcGF0aWJsZSA9ICJueHAsaW14OG1xLWRjc3MiLCAuZGF0YSA9ICZkY3NzX3R5cGVz
W0RDU1NfSU1YOE1RXSwgfSwKKwl7fSwKK307CisKK01PRFVMRV9ERVZJQ0VfVEFCTEUob2YsIGRj
c3Nfb2ZfbWF0Y2gpOworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRldl9wbV9vcHMgZGNzc19kZXZf
cG0gPSB7CisJU0VUX1NZU1RFTV9TTEVFUF9QTV9PUFMoZGNzc19kZXZfc3VzcGVuZCwgZGNzc19k
ZXZfcmVzdW1lKQorCVNFVF9SVU5USU1FX1BNX09QUyhkY3NzX2Rldl9ydW50aW1lX3N1c3BlbmQs
CisJCQkgICBkY3NzX2Rldl9ydW50aW1lX3Jlc3VtZSwgTlVMTCkKK307CisKK3N0YXRpYyBzdHJ1
Y3QgcGxhdGZvcm1fZHJpdmVyIGRjc3NfcGxhdGZvcm1fZHJpdmVyID0geworCS5wcm9iZQk9IGRj
c3NfZHJ2X3BsYXRmb3JtX3Byb2JlLAorCS5yZW1vdmUJPSBkY3NzX2Rydl9wbGF0Zm9ybV9yZW1v
dmUsCisJLmRyaXZlcgk9IHsKKwkJLm5hbWUgPSAiaW14LWRjc3MiLAorCQkub2ZfbWF0Y2hfdGFi
bGUJPSBkY3NzX29mX21hdGNoLAorCQkucG0gPSAmZGNzc19kZXZfcG0sCisJfSwKK307CisKK21v
ZHVsZV9wbGF0Zm9ybV9kcml2ZXIoZGNzc19wbGF0Zm9ybV9kcml2ZXIpOworCitNT0RVTEVfQVVU
SE9SKCJMYXVyZW50aXUgUGFsY3UgPGxhdXJlbnRpdS5wYWxjdUBueHAuY29tPiIpOworTU9EVUxF
X0RFU0NSSVBUSU9OKCJEQ1NTIGRyaXZlciBmb3IgaS5NWDhNUSIpOworTU9EVUxFX0xJQ0VOU0Uo
IkdQTCB2MiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHRn
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kdGcuYwpuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMC4uYzgzYjNiYgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pbXgvZGNzcy9kY3NzLWR0Zy5jCkBAIC0wLDAgKzEsNDM4IEBACisvLyBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAq
LworCisjaW5jbHVkZSA8bGludXgvY2xrLmg+CisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNp
bmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9vZi5oPgorI2luY2x1
ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorCisjaW5jbHVkZSAiZGNzcy1kZXYuaCIKKwor
I2RlZmluZSBEQ1NTX0RUR19UQ19DT05UUk9MX1NUQVRVUwkJCTB4MDAKKyNkZWZpbmUgICBDSDNf
RU4JCQkJCUJJVCgwKQorI2RlZmluZSAgIENIMl9FTgkJCQkJQklUKDEpCisjZGVmaW5lICAgQ0gx
X0VOCQkJCQlCSVQoMikKKyNkZWZpbmUgICBPVkxfREFUQV9NT0RFCQkJCQlCSVQoMykKKyNkZWZp
bmUgICBCTEVOREVSX1ZJREVPX0FMUEhBX1NFTAkJCUJJVCg3KQorI2RlZmluZSAgIERUR19TVEFS
VAkJCQkJQklUKDgpCisjZGVmaW5lICAgREJZX01PREVfRU4JCQkJCUJJVCg5KQorI2RlZmluZSAg
IENIMV9BTFBIQV9TRUwJCQkJCUJJVCgxMCkKKyNkZWZpbmUgICBDU1NfUElYX0NPTVBfU1dBUF9Q
T1MJCQkJMTIKKyNkZWZpbmUgICBDU1NfUElYX0NPTVBfU1dBUF9NQVNLCQkJR0VOTUFTSygxNCwg
MTIpCisjZGVmaW5lICAgREVGQVVMVF9GR19BTFBIQV9QT1MJCQkJMjQKKyNkZWZpbmUgICBERUZB
VUxUX0ZHX0FMUEhBX01BU0sJCQkJR0VOTUFTSygzMSwgMjQpCisjZGVmaW5lIERDU1NfRFRHX1RD
X0RURwkJCQkJMHgwNAorI2RlZmluZSBEQ1NTX0RUR19UQ19ESVNQX1RPUAkJCQkweDA4CisjZGVm
aW5lIERDU1NfRFRHX1RDX0RJU1BfQk9UCQkJCTB4MEMKKyNkZWZpbmUgRENTU19EVEdfVENfQ0gx
X1RPUAkJCQkweDEwCisjZGVmaW5lIERDU1NfRFRHX1RDX0NIMV9CT1QJCQkJMHgxNAorI2RlZmlu
ZSBEQ1NTX0RUR19UQ19DSDJfVE9QCQkJCTB4MTgKKyNkZWZpbmUgRENTU19EVEdfVENfQ0gyX0JP
VAkJCQkweDFDCisjZGVmaW5lIERDU1NfRFRHX1RDX0NIM19UT1AJCQkJMHgyMAorI2RlZmluZSBE
Q1NTX0RUR19UQ19DSDNfQk9UCQkJCTB4MjQKKyNkZWZpbmUgICBUQ19YX1BPUwkJCQkJMAorI2Rl
ZmluZSAgIFRDX1hfTUFTSwkJCQkJR0VOTUFTSygxMiwgMCkKKyNkZWZpbmUgICBUQ19ZX1BPUwkJ
CQkJMTYKKyNkZWZpbmUgICBUQ19ZX01BU0sJCQkJCUdFTk1BU0soMjgsIDE2KQorI2RlZmluZSBE
Q1NTX0RUR19UQ19DVFhMRAkJCQkweDI4CisjZGVmaW5lICAgVENfQ1RYTERfREJfWV9QT1MJCQkJ
MAorI2RlZmluZSAgIFRDX0NUWExEX0RCX1lfTUFTSwkJCQlHRU5NQVNLKDEyLCAwKQorI2RlZmlu
ZSAgIFRDX0NUWExEX1NCX1lfUE9TCQkJCTE2CisjZGVmaW5lICAgVENfQ1RYTERfU0JfWV9NQVNL
CQkJCUdFTk1BU0soMjgsIDE2KQorI2RlZmluZSBEQ1NTX0RUR19UQ19DSDFfQktSTkQJCQkJMHgy
QworI2RlZmluZSBEQ1NTX0RUR19UQ19DSDJfQktSTkQJCQkJMHgzMAorI2RlZmluZSAgIEJLUk5E
X1JfWV9DT01QX1BPUwkJCQkyMAorI2RlZmluZSAgIEJLUk5EX1JfWV9DT01QX01BU0sJCQkJR0VO
TUFTSygyOSwgMjApCisjZGVmaW5lICAgQktSTkRfR19VX0NPTVBfUE9TCQkJCTEwCisjZGVmaW5l
ICAgQktSTkRfR19VX0NPTVBfTUFTSwkJCQlHRU5NQVNLKDE5LCAxMCkKKyNkZWZpbmUgICBCS1JO
RF9CX1ZfQ09NUF9QT1MJCQkJMAorI2RlZmluZSAgIEJLUk5EX0JfVl9DT01QX01BU0sJCQkJR0VO
TUFTSyg5LCAwKQorI2RlZmluZSBEQ1NTX0RUR19CTEVOREVSX0RCWV9SQU5HRUlOVgkJCTB4MzgK
KyNkZWZpbmUgRENTU19EVEdfQkxFTkRFUl9EQllfUkFOR0VNSU4JCQkweDNDCisjZGVmaW5lIERD
U1NfRFRHX0JMRU5ERVJfREJZX0JEUAkJCTB4NDAKKyNkZWZpbmUgRENTU19EVEdfQkxFTkRFUl9C
S1JORF9JCQkJMHg0NAorI2RlZmluZSBEQ1NTX0RUR19CTEVOREVSX0JLUk5EX1AJCQkweDQ4Cisj
ZGVmaW5lIERDU1NfRFRHX0JMRU5ERVJfQktSTkRfVAkJCTB4NEMKKyNkZWZpbmUgRENTU19EVEdf
TElORTBfSU5UCQkJCTB4NTAKKyNkZWZpbmUgRENTU19EVEdfTElORTFfSU5UCQkJCTB4NTQKKyNk
ZWZpbmUgRENTU19EVEdfQkdfQUxQSEFfREVGQVVMVAkJCTB4NTgKKyNkZWZpbmUgRENTU19EVEdf
SU5UX1NUQVRVUwkJCQkweDVDCisjZGVmaW5lIERDU1NfRFRHX0lOVF9DT05UUk9MCQkJCTB4NjAK
KyNkZWZpbmUgRENTU19EVEdfVENfQ0gzX0JLUk5ECQkJCTB4NjQKKyNkZWZpbmUgRENTU19EVEdf
SU5UX01BU0sJCQkJMHg2OAorI2RlZmluZSAgIExJTkUwX0lSUQkJCQkJQklUKDApCisjZGVmaW5l
ICAgTElORTFfSVJRCQkJCQlCSVQoMSkKKyNkZWZpbmUgICBMSU5FMl9JUlEJCQkJCUJJVCgyKQor
I2RlZmluZSAgIExJTkUzX0lSUQkJCQkJQklUKDMpCisjZGVmaW5lIERDU1NfRFRHX0xJTkUyX0lO
VAkJCQkweDZDCisjZGVmaW5lIERDU1NfRFRHX0xJTkUzX0lOVAkJCQkweDcwCisjZGVmaW5lIERD
U1NfRFRHX0RCWV9PTAkJCQkJMHg3NAorI2RlZmluZSBEQ1NTX0RUR19EQllfQkwJCQkJCTB4NzgK
KyNkZWZpbmUgRENTU19EVEdfREJZX0VMCQkJCQkweDdDCisKK3N0cnVjdCBkY3NzX2R0ZyB7CisJ
c3RydWN0IGRldmljZSAqZGV2OworCXN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZDsKKwl2b2lkIF9f
aW9tZW0gKmJhc2VfcmVnOworCXUzMiBiYXNlX29mczsKKworCXUzMiBjdHhfaWQ7CisKKwlib29s
IGluX3VzZTsKKworCXUzMiBkaXNfdWxjX3g7CisJdTMyIGRpc191bGNfeTsKKworCXUzMiBjb250
cm9sX3N0YXR1czsKKwl1MzIgYWxwaGE7CisKKwlpbnQgY3R4bGRfa2lja19pcnE7CisJYm9vbCBj
dHhsZF9raWNrX2lycV9lbjsKKworCXN0cnVjdCBjbGsgKnBpeF9jbGs7CisJc3RydWN0IGNsayAq
cGxsX3NyY19jbGs7CisJc3RydWN0IGNsayAqcGxsX3BoeV9yZWZfY2xrOworCisJLyoKKwkgKiBU
aGlzIHdpbGwgYmUgcGFzc2VkIG9uIGJ5IERSTSBDUlRDIHNvIHRoYXQgd2UgY2FuIHNpZ25hbCB3
aGVuIERURyBoYXMKKwkgKiBiZWVuIHN1Y2Nlc3NmdWxseSBzdG9wcGVkLiBPdGhlcndpc2UsIGFu
eSBtb2Rlc2V0dGluZyB3aGlsZSBEVEcgaXMKKwkgKiBzdGlsbCBPTiBtYXkgcmVzdWx0IGluIHVu
cHJlZGljdGFibGUgYmVoYXZpb3IuCisJICovCisJc3RydWN0IGNvbXBsZXRpb24gKmRpc19jb21w
bGV0aW9uOworfTsKKworc3RhdGljIHZvaWQgZGNzc19kdGdfd3JpdGUoc3RydWN0IGRjc3NfZHRn
ICpkdGcsIHUzMiB2YWwsIHUzMiBvZnMpCit7CisJaWYgKCFkdGctPmluX3VzZSkKKwkJZGNzc193
cml0ZWwodmFsLCBkdGctPmJhc2VfcmVnICsgb2ZzKTsKKworCWRjc3NfY3R4bGRfd3JpdGUoZHRn
LT5jdHhsZCwgZHRnLT5jdHhfaWQsIHZhbCwgZHRnLT5iYXNlX29mcyArIG9mcyk7Cit9CisKK3N0
YXRpYyBpcnFyZXR1cm5fdCBkY3NzX2R0Z19pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRh
KQoreworCXN0cnVjdCBkY3NzX2R0ZyAqZHRnID0gZGF0YTsKKwl1MzIgc3RhdHVzOworCisJc3Rh
dHVzID0gZGNzc19yZWFkbChkdGctPmJhc2VfcmVnICsgRENTU19EVEdfSU5UX1NUQVRVUyk7CisK
KwlpZiAoIShzdGF0dXMgJiBMSU5FMF9JUlEpKQorCQlyZXR1cm4gSVJRX0hBTkRMRUQ7CisKKwlk
Y3NzX2N0eGxkX2tpY2soZHRnLT5jdHhsZCk7CisKKwlkY3NzX3dyaXRlbChzdGF0dXMgJiBMSU5F
MF9JUlEsIGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRfQ09OVFJPTCk7CisKKwlyZXR1cm4g
SVJRX0hBTkRMRUQ7Cit9CisKK3N0YXRpYyBpbnQgZGNzc19kdGdfaXJxX2NvbmZpZyhzdHJ1Y3Qg
ZGNzc19kdGcgKmR0ZywKKwkJCSAgICAgICBzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQor
eworCWludCByZXQ7CisKKwlkdGctPmN0eGxkX2tpY2tfaXJxID0gcGxhdGZvcm1fZ2V0X2lycV9i
eW5hbWUocGRldiwgImN0eGxkX2tpY2siKTsKKwlpZiAoZHRnLT5jdHhsZF9raWNrX2lycSA8IDAp
IHsKKwkJZGV2X2VycihkdGctPmRldiwgImR0ZzogY2FuJ3QgZ2V0IGxpbmUyIGlycSBudW1iZXJc
biIpOworCQlyZXR1cm4gZHRnLT5jdHhsZF9raWNrX2lycTsKKwl9CisKKwlyZXQgPSBkZXZtX3Jl
cXVlc3RfaXJxKGR0Zy0+ZGV2LCBkdGctPmN0eGxkX2tpY2tfaXJxLAorCQkJICAgICAgIGRjc3Nf
ZHRnX2lycV9oYW5kbGVyLAorCQkJICAgICAgIElSUUZfVFJJR0dFUl9ISUdILAorCQkJICAgICAg
ICJkY3NzX2N0eGxkX2tpY2siLCBkdGcpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkdGctPmRl
diwgImR0ZzogaXJxIHJlcXVlc3QgZmFpbGVkLlxuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJ
ZGlzYWJsZV9pcnEoZHRnLT5jdHhsZF9raWNrX2lycSk7CisKKwlkdGctPmN0eGxkX2tpY2tfaXJx
X2VuID0gZmFsc2U7CisKKwlkY3NzX3VwZGF0ZShMSU5FMF9JUlEsIExJTkUwX0lSUSwgZHRnLT5i
YXNlX3JlZyArIERDU1NfRFRHX0lOVF9NQVNLKTsKKworCXJldHVybiAwOworfQorCitpbnQgZGNz
c19kdGdfaW5pdChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgZHRnX2Jhc2Up
Cit7CisJaW50IHJldCA9IDA7CisJc3RydWN0IGRjc3NfZHRnICpkdGc7CisKKwlkdGcgPSBkZXZt
X2t6YWxsb2MoZGNzcy0+ZGV2LCBzaXplb2YoKmR0ZyksIEdGUF9LRVJORUwpOworCWlmICghZHRn
KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRjc3MtPmR0ZyA9IGR0ZzsKKwlkdGctPmRldiA9IGRj
c3MtPmRldjsKKwlkdGctPmN0eGxkID0gZGNzcy0+Y3R4bGQ7CisKKwlkdGctPmJhc2VfcmVnID0g
ZGV2bV9pb3JlbWFwKGRjc3MtPmRldiwgZHRnX2Jhc2UsIFNaXzRLKTsKKwlpZiAoIWR0Zy0+YmFz
ZV9yZWcpIHsKKwkJZGV2X2VycihkY3NzLT5kZXYsICJkdGc6IHVuYWJsZSB0byByZW1hcCBkdGcg
YmFzZVxuIik7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZXJyX2lvcmVtYXA7CisJfQorCisJ
ZHRnLT5iYXNlX29mcyA9IGR0Z19iYXNlOworCWR0Zy0+Y3R4X2lkID0gQ1RYX0RCOworCisJZHRn
LT5waXhfY2xrID0gZGNzcy0+cGl4X2NsazsKKwlkdGctPnBsbF9zcmNfY2xrID0gZGNzcy0+cGxs
X3NyY19jbGs7CisJZHRnLT5wbGxfcGh5X3JlZl9jbGsgPSBkY3NzLT5wbGxfcGh5X3JlZl9jbGs7
CisKKwlkdGctPmFscGhhID0gMjU1OworCisJZHRnLT5jb250cm9sX3N0YXR1cyB8PSBPVkxfREFU
QV9NT0RFIHwgQkxFTkRFUl9WSURFT19BTFBIQV9TRUwgfAorCQkoKGR0Zy0+YWxwaGEgPDwgREVG
QVVMVF9GR19BTFBIQV9QT1MpICYgREVGQVVMVF9GR19BTFBIQV9NQVNLKTsKKworCXJldCA9IGRj
c3NfZHRnX2lycV9jb25maWcoZHRnLCB0b19wbGF0Zm9ybV9kZXZpY2UoZGNzcy0+ZGV2KSk7CisJ
aWYgKHJldCkKKwkJZ290byBlcnJfaXJxOworCisJcmV0dXJuIDA7CisKK2Vycl9pcnE6CisJZGV2
bV9pb3VubWFwKGR0Zy0+ZGV2LCBkdGctPmJhc2VfcmVnKTsKKworZXJyX2lvcmVtYXA6CisJZGV2
bV9rZnJlZShkdGctPmRldiwgZHRnKTsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZGNzc19k
dGdfZXhpdChzdHJ1Y3QgZGNzc19kdGcgKmR0ZykKK3sKKwkvKiBzdG9wIERURyAqLworCWRjc3Nf
d3JpdGVsKERUR19TVEFSVCwgZHRnLT5iYXNlX3JlZyArIERDU1NfRFRHX1RDX0NPTlRST0xfU1RB
VFVTKTsKKworCWRldm1fZnJlZV9pcnEoZHRnLT5kZXYsIGR0Zy0+Y3R4bGRfa2lja19pcnEsIGR0
Zyk7CisKKwlpZiAoZHRnLT5iYXNlX3JlZykKKwkJZGV2bV9pb3VubWFwKGR0Zy0+ZGV2LCBkdGct
PmJhc2VfcmVnKTsKKworCWRldm1fa2ZyZWUoZHRnLT5kZXYsIGR0Zyk7Cit9CisKK3ZvaWQgZGNz
c19kdGdfc3luY19zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcsIHN0cnVjdCB2aWRlb21vZGUgKnZt
KQoreworCXUxNiBkdGdfbHJjX3gsIGR0Z19scmNfeTsKKwl1MTYgZGlzX3VsY194LCBkaXNfdWxj
X3k7CisJdTE2IGRpc19scmNfeCwgZGlzX2xyY195OworCXUzMiBzYl9jdHhsZF90cmlnLCBkYl9j
dHhsZF90cmlnOworCXUzMiBwaXhjbG9jayA9IHZtLT5waXhlbGNsb2NrOworCXUzMiBhY3R1YWxf
Y2xrOworCisJZHRnX2xyY194ID0gdm0tPmhmcm9udF9wb3JjaCArIHZtLT5oYmFja19wb3JjaCAr
IHZtLT5oc3luY19sZW4gKworCQkgICAgdm0tPmhhY3RpdmUgLSAxOworCWR0Z19scmNfeSA9IHZt
LT52ZnJvbnRfcG9yY2ggKyB2bS0+dmJhY2tfcG9yY2ggKyB2bS0+dnN5bmNfbGVuICsKKwkJICAg
IHZtLT52YWN0aXZlIC0gMTsKKwlkaXNfdWxjX3ggPSB2bS0+aHN5bmNfbGVuICsgdm0tPmhiYWNr
X3BvcmNoIC0gMTsKKwlkaXNfdWxjX3kgPSB2bS0+dnN5bmNfbGVuICsgdm0tPnZmcm9udF9wb3Jj
aCArIHZtLT52YmFja19wb3JjaCAtIDE7CisJZGlzX2xyY194ID0gdm0tPmhzeW5jX2xlbiArIHZt
LT5oYmFja19wb3JjaCArIHZtLT5oYWN0aXZlIC0gMTsKKwlkaXNfbHJjX3kgPSB2bS0+dnN5bmNf
bGVuICsgdm0tPnZmcm9udF9wb3JjaCArIHZtLT52YmFja19wb3JjaCArCisJCSAgICB2bS0+dmFj
dGl2ZSAtIDE7CisKKwljbGtfZGlzYWJsZV91bnByZXBhcmUoZHRnLT5waXhfY2xrKTsKKwljbGtf
c2V0X3JhdGUoZHRnLT5waXhfY2xrLCB2bS0+cGl4ZWxjbG9jayk7CisJY2xrX3ByZXBhcmVfZW5h
YmxlKGR0Zy0+cGl4X2Nsayk7CisKKwlhY3R1YWxfY2xrID0gY2xrX2dldF9yYXRlKGR0Zy0+cGl4
X2Nsayk7CisJaWYgKHBpeGNsb2NrICE9IGFjdHVhbF9jbGspIHsKKwkJZGV2X2luZm8oZHRnLT5k
ZXYsCisJCQkgIlBpeGVsIGNsb2NrIHNldCB0byAldSBrSHogaW5zdGVhZCBvZiAldSBrSHouXG4i
LAorCQkJIChhY3R1YWxfY2xrIC8gMTAwMCksIChwaXhjbG9jayAvIDEwMDApKTsKKwl9CisKKwlt
c2xlZXAoNTApOworCisJZGNzc19kdGdfd3JpdGUoZHRnLCAoKGR0Z19scmNfeSA8PCBUQ19ZX1BP
UykgfCBkdGdfbHJjX3gpLAorCQkgICAgICAgRENTU19EVEdfVENfRFRHKTsKKwlkY3NzX2R0Z193
cml0ZShkdGcsICgoZGlzX3VsY195IDw8IFRDX1lfUE9TKSB8IGRpc191bGNfeCksCisJCSAgICAg
ICBEQ1NTX0RUR19UQ19ESVNQX1RPUCk7CisJZGNzc19kdGdfd3JpdGUoZHRnLCAoKGRpc19scmNf
eSA8PCBUQ19ZX1BPUykgfCBkaXNfbHJjX3gpLAorCQkgICAgICAgRENTU19EVEdfVENfRElTUF9C
T1QpOworCisJZHRnLT5kaXNfdWxjX3ggPSBkaXNfdWxjX3g7CisJZHRnLT5kaXNfdWxjX3kgPSBk
aXNfdWxjX3k7CisKKwlzYl9jdHhsZF90cmlnID0gKCgwICogZGlzX2xyY195IC8gMTAwKSA8PCBU
Q19DVFhMRF9TQl9ZX1BPUykgJgorCQkJCQkJCVRDX0NUWExEX1NCX1lfTUFTSzsKKwlkYl9jdHhs
ZF90cmlnID0gKCg5OSAqIGRpc19scmNfeSAvIDEwMCkgPDwgVENfQ1RYTERfREJfWV9QT1MpICYK
KwkJCQkJCQlUQ19DVFhMRF9EQl9ZX01BU0s7CisKKwlkY3NzX2R0Z193cml0ZShkdGcsIHNiX2N0
eGxkX3RyaWcgfCBkYl9jdHhsZF90cmlnLCBEQ1NTX0RUR19UQ19DVFhMRCk7CisKKwkvKiB2Ymxh
bmsgdHJpZ2dlciAqLworCWRjc3NfZHRnX3dyaXRlKGR0ZywgMCwgRENTU19EVEdfTElORTFfSU5U
KTsKKworCS8qIENUWExEIHRyaWdnZXIgKi8KKwlkY3NzX2R0Z193cml0ZShkdGcsICgoOTAgKiBk
aXNfbHJjX3kpIC8gMTAwKSA8PCAxNiwgRENTU19EVEdfTElORTBfSU5UKTsKK30KKwordm9pZCBk
Y3NzX2R0Z19wbGFuZV9wb3Nfc2V0KHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLAor
CQkJICAgIGludCBweCwgaW50IHB5LCBpbnQgcHcsIGludCBwaCkKK3sKKwl1MTYgcF91bGNfeCwg
cF91bGNfeTsKKwl1MTYgcF9scmNfeCwgcF9scmNfeTsKKworCXBfdWxjX3ggPSBkdGctPmRpc191
bGNfeCArIHB4OworCXBfdWxjX3kgPSBkdGctPmRpc191bGNfeSArIHB5OworCXBfbHJjX3ggPSBw
X3VsY194ICsgcHc7CisJcF9scmNfeSA9IHBfdWxjX3kgKyBwaDsKKworCWlmICghcHggJiYgIXB5
ICYmICFwdyAmJiAhcGgpIHsKKwkJZGNzc19kdGdfd3JpdGUoZHRnLCAwLCBEQ1NTX0RUR19UQ19D
SDFfVE9QICsgMHg4ICogY2hfbnVtKTsKKwkJZGNzc19kdGdfd3JpdGUoZHRnLCAwLCBEQ1NTX0RU
R19UQ19DSDFfQk9UICsgMHg4ICogY2hfbnVtKTsKKwl9IGVsc2UgeworCQlkY3NzX2R0Z193cml0
ZShkdGcsICgocF91bGNfeSA8PCBUQ19ZX1BPUykgfCBwX3VsY194KSwKKwkJCSAgICAgICBEQ1NT
X0RUR19UQ19DSDFfVE9QICsgMHg4ICogY2hfbnVtKTsKKwkJZGNzc19kdGdfd3JpdGUoZHRnLCAo
KHBfbHJjX3kgPDwgVENfWV9QT1MpIHwgcF9scmNfeCksCisJCQkgICAgICAgRENTU19EVEdfVENf
Q0gxX0JPVCArIDB4OCAqIGNoX251bSk7CisJfQorfQorCitib29sIGRjc3NfZHRnX2dsb2JhbF9h
bHBoYV9jaGFuZ2VkKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLCBpbnQgYWxwaGEp
Cit7CisJaWYgKGNoX251bSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIGFscGhhICE9IGR0
Zy0+YWxwaGE7Cit9CisKK3ZvaWQgZGNzc19kdGdfcGxhbmVfYWxwaGFfc2V0KHN0cnVjdCBkY3Nz
X2R0ZyAqZHRnLCBpbnQgY2hfbnVtLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqZm9ybWF0LCBpbnQgYWxwaGEpCit7CisJdTMyIGFscGhhX3ZhbDsKKworCS8qIHdlIGNh
cmUgYWJvdXQgYWxwaGEgb25seSB3aGVuIGNoYW5uZWwgMCBpcyBjb25jZXJuZWQgKi8KKwlpZiAo
Y2hfbnVtKQorCQlyZXR1cm47CisKKwlhbHBoYV92YWwgPSAoYWxwaGEgPDwgREVGQVVMVF9GR19B
TFBIQV9QT1MpICYgREVGQVVMVF9GR19BTFBIQV9NQVNLOworCisJLyoKKwkgKiBVc2UgZ2xvYmFs
IGFscGhhIGlmIHBpeGVsIGZvcm1hdCBkb2VzIG5vdCBoYXZlIGFscGhhIGNoYW5uZWwgb3IgdGhl
CisJICogdXNlciBleHBsaWNpdGx5IGNob3NlIHRvIHVzZSBnbG9iYWwgYWxwaGEgKGkuZS4gYWxw
aGEgaXMgbm90IE9QQVFVRSkuCisJICovCisJaWYgKCFmb3JtYXQtPmhhc19hbHBoYSB8fCBhbHBo
YSAhPSAyNTUpIHsKKwkJZHRnLT5jb250cm9sX3N0YXR1cyAmPSB+KENIMV9BTFBIQV9TRUwgfCBE
RUZBVUxUX0ZHX0FMUEhBX01BU0spOworCQlkdGctPmNvbnRyb2xfc3RhdHVzIHw9IGFscGhhX3Zh
bDsKKwl9IGVsc2UgeyAvKiB1c2UgcGVyLXBpeGVsIGFscGhhIG90aGVyd2lzZSAqLworCQlkdGct
PmNvbnRyb2xfc3RhdHVzIHw9IENIMV9BTFBIQV9TRUw7CisJfQorCisJZHRnLT5hbHBoYSA9IGFs
cGhhOworfQorCit2b2lkIGRjc3NfZHRnX2Nzc19zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcpCit7
CisJZHRnLT5jb250cm9sX3N0YXR1cyB8PQorCQkJKDB4NSA8PCBDU1NfUElYX0NPTVBfU1dBUF9Q
T1MpICYgQ1NTX1BJWF9DT01QX1NXQVBfTUFTSzsKK30KKworc3RhdGljIHZvaWQgZGNzc19kdGdf
ZGlzYWJsZV9jYWxsYmFjayh2b2lkICpkYXRhKQoreworCXN0cnVjdCBkY3NzX2R0ZyAqZHRnID0g
ZGF0YTsKKworCWR0Zy0+Y29udHJvbF9zdGF0dXMgJj0gfkRUR19TVEFSVDsKKworCWRjc3Nfd3Jp
dGVsKGR0Zy0+Y29udHJvbF9zdGF0dXMsCisJCSAgICBkdGctPmJhc2VfcmVnICsgRENTU19EVEdf
VENfQ09OVFJPTF9TVEFUVVMpOworCisJZHRnLT5pbl91c2UgPSBmYWxzZTsKKworCWNvbXBsZXRl
KGR0Zy0+ZGlzX2NvbXBsZXRpb24pOworfQorCit2b2lkIGRjc3NfZHRnX2VuYWJsZShzdHJ1Y3Qg
ZGNzc19kdGcgKmR0ZywgYm9vbCBlbiwKKwkJICAgICBzdHJ1Y3QgY29tcGxldGlvbiAqZGlzX2Nv
bXBsZXRpb24pCit7CisJaWYgKCFlbikgeworCQlkdGctPmRpc19jb21wbGV0aW9uID0gZGlzX2Nv
bXBsZXRpb247CisJCWRjc3NfY3R4bGRfcmVnaXN0ZXJfZHRnX2Rpc2FibGVfY2IoZHRnLT5jdHhs
ZCwKKwkJCQkJCSAgIGRjc3NfZHRnX2Rpc2FibGVfY2FsbGJhY2ssCisJCQkJCQkgICBkdGcpOwor
CQlyZXR1cm47CisJfQorCisJZHRnLT5kaXNfY29tcGxldGlvbiA9IE5VTEw7CisKKwlkdGctPmNv
bnRyb2xfc3RhdHVzIHw9IERUR19TVEFSVDsKKworCWRjc3NfZHRnX3dyaXRlKGR0ZywgZHRnLT5j
b250cm9sX3N0YXR1cywgRENTU19EVEdfVENfQ09OVFJPTF9TVEFUVVMpOworCisJZHRnLT5pbl91
c2UgPSB0cnVlOworfQorCitib29sIGRjc3NfZHRnX2lzX2VuYWJsZWQoc3RydWN0IGRjc3NfZHRn
ICpkdGcpCit7CisJcmV0dXJuIGR0Zy0+aW5fdXNlOworfQorCit2b2lkIGRjc3NfZHRnX2NoX2Vu
YWJsZShzdHJ1Y3QgZGNzc19kdGcgKmR0ZywgaW50IGNoX251bSwgYm9vbCBlbikKK3sKKwl1MzIg
Y2hfZW5fbWFwW10gPSB7Q0gxX0VOLCBDSDJfRU4sIENIM19FTn07CisJdTMyIGNvbnRyb2xfc3Rh
dHVzOworCisJY29udHJvbF9zdGF0dXMgPSBkdGctPmNvbnRyb2xfc3RhdHVzICYgfmNoX2VuX21h
cFtjaF9udW1dOworCWNvbnRyb2xfc3RhdHVzIHw9IGVuID8gY2hfZW5fbWFwW2NoX251bV0gOiAw
OworCisJaWYgKGR0Zy0+Y29udHJvbF9zdGF0dXMgIT0gY29udHJvbF9zdGF0dXMpCisJCWRjc3Nf
ZHRnX3dyaXRlKGR0ZywgY29udHJvbF9zdGF0dXMsIERDU1NfRFRHX1RDX0NPTlRST0xfU1RBVFVT
KTsKKworCWR0Zy0+Y29udHJvbF9zdGF0dXMgPSBjb250cm9sX3N0YXR1czsKK30KKwordm9pZCBk
Y3NzX2R0Z192YmxhbmtfaXJxX2VuYWJsZShzdHJ1Y3QgZGNzc19kdGcgKmR0ZywgYm9vbCBlbikK
K3sKKwl1MzIgc3RhdHVzOworCisJZGNzc191cGRhdGUoTElORTFfSVJRLCBMSU5FMV9JUlEsIGR0
Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRfTUFTSyk7CisKKwlpZiAoZW4pIHsKKwkJc3RhdHVz
ID0gZGNzc19yZWFkbChkdGctPmJhc2VfcmVnICsgRENTU19EVEdfSU5UX1NUQVRVUyk7CisJCWRj
c3Nfd3JpdGVsKHN0YXR1cyAmIExJTkUxX0lSUSwKKwkJCSAgICBkdGctPmJhc2VfcmVnICsgRENT
U19EVEdfSU5UX0NPTlRST0wpOworCX0KK30KKwordm9pZCBkY3NzX2R0Z19jdHhsZF9raWNrX2ly
cV9lbmFibGUoc3RydWN0IGRjc3NfZHRnICpkdGcsIGJvb2wgZW4pCit7CisJdTMyIHN0YXR1czsK
KworCWlmIChlbikgeworCQlzdGF0dXMgPSBkY3NzX3JlYWRsKGR0Zy0+YmFzZV9yZWcgKyBEQ1NT
X0RUR19JTlRfU1RBVFVTKTsKKworCQlpZiAoIWR0Zy0+Y3R4bGRfa2lja19pcnFfZW4pIHsKKwkJ
CWRjc3Nfd3JpdGVsKHN0YXR1cyAmIExJTkUwX0lSUSwKKwkJCQkgICAgZHRnLT5iYXNlX3JlZyAr
IERDU1NfRFRHX0lOVF9DT05UUk9MKTsKKwkJCWVuYWJsZV9pcnEoZHRnLT5jdHhsZF9raWNrX2ly
cSk7CisJCQlkdGctPmN0eGxkX2tpY2tfaXJxX2VuID0gdHJ1ZTsKKwkJCXJldHVybjsKKwkJfQor
CisJCXJldHVybjsKKwl9CisKKwlpZiAoIWR0Zy0+Y3R4bGRfa2lja19pcnFfZW4pCisJCXJldHVy
bjsKKworCWRpc2FibGVfaXJxX25vc3luYyhkdGctPmN0eGxkX2tpY2tfaXJxKTsKKwlkdGctPmN0
eGxkX2tpY2tfaXJxX2VuID0gZmFsc2U7Cit9CisKK3ZvaWQgZGNzc19kdGdfdmJsYW5rX2lycV9j
bGVhcihzdHJ1Y3QgZGNzc19kdGcgKmR0ZykKK3sKKwlkY3NzX3VwZGF0ZShMSU5FMV9JUlEsIExJ
TkUxX0lSUSwgZHRnLT5iYXNlX3JlZyArIERDU1NfRFRHX0lOVF9DT05UUk9MKTsKK30KKworYm9v
bCBkY3NzX2R0Z192YmxhbmtfaXJxX3ZhbGlkKHN0cnVjdCBkY3NzX2R0ZyAqZHRnKQoreworCXJl
dHVybiAhIShkY3NzX3JlYWRsKGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRfU1RBVFVTKSAm
IExJTkUxX0lSUSk7Cit9CisKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9k
Y3NzLWttcy5jIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mta21zLmMKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLmQzYmM4ODkKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuYwpAQCAtMCwwICsxLDMyMSBAQAorLy8g
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBO
WFAuCisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CisjaW5jbHVkZSA8ZHJtL2Ry
bV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX2dlbV9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJh
bWVidWZmZXJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9vZi5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fcHJvYmVfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybVAuaD4KKyNpbmNsdWRlIDxs
aW51eC9jb21wb25lbnQuaD4KKworI2luY2x1ZGUgImRjc3MtZGV2LmgiCisjaW5jbHVkZSAiZGNz
cy1rbXMuaCIKKworREVGSU5FX0RSTV9HRU1fQ01BX0ZPUFMoZGNzc19jbWFfZm9wcyk7CisKK3N0
cnVjdCBkY3NzX2RybV9jb21taXQgeworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXN0cnVj
dCBkcm1fZGV2aWNlICpkcm07CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOworfTsK
Kworc3RhdGljIHZvaWQgZGNzc19kcm1fYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkY3NzX2Ry
bV9jb21taXQgKmNvbW1pdCkKK3sKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBj
b21taXQtPnN0YXRlOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBjb21taXQtPmRybTsKKwlz
dHJ1Y3QgZGNzc19rbXNfZGV2ICprbXMgPSBjb250YWluZXJfb2YoZHJtLCBzdHJ1Y3QgZGNzc19r
bXNfZGV2LCBiYXNlKTsKKworCWRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX2ZlbmNlcyhkcm0s
IHN0YXRlLCBmYWxzZSk7CisKKwlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9kZXBlbmRlbmNp
ZXMoc3RhdGUpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMo
ZHJtLCBzdGF0ZSk7CisKKwlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfbW9kZXNldF9lbmFibGVz
KGRybSwgc3RhdGUpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X3BsYW5lcyhkcm0sIHN0
YXRlLAorCQkJCQlEUk1fUExBTkVfQ09NTUlUX0FDVElWRV9PTkxZKTsKKworCWRybV9hdG9taWNf
aGVscGVyX2NvbW1pdF9od19kb25lKHN0YXRlKTsKKworCWRybV9hdG9taWNfaGVscGVyX3dhaXRf
Zm9yX3ZibGFua3MoZHJtLCBzdGF0ZSk7CisKKwlkcm1fYXRvbWljX2hlbHBlcl9jbGVhbnVwX3Bs
YW5lcyhkcm0sIHN0YXRlKTsKKworCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9jbGVhbnVwX2Rv
bmUoc3RhdGUpOworCisJZHJtX2F0b21pY19zdGF0ZV9wdXQoc3RhdGUpOworCisJc3Bpbl9sb2Nr
KCZrbXMtPmNvbW1pdC53YWl0LmxvY2spOworCWttcy0+Y29tbWl0LnBlbmRpbmcgPSBmYWxzZTsK
Kwl3YWtlX3VwX2FsbF9sb2NrZWQoJmttcy0+Y29tbWl0LndhaXQpOworCXNwaW5fdW5sb2NrKCZr
bXMtPmNvbW1pdC53YWl0LmxvY2spOworCisJa2ZyZWUoY29tbWl0KTsKK30KKworc3RhdGljIHZv
aWQgZGNzc19jb21taXRfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0
IGRjc3NfZHJtX2NvbW1pdCAqY29tbWl0ID0gY29udGFpbmVyX29mKHdvcmssCisJCQkJCQkgICAg
ICBzdHJ1Y3QgZGNzc19kcm1fY29tbWl0LAorCQkJCQkJICAgICAgd29yayk7CisKKwlkY3NzX2Ry
bV9hdG9taWNfY29tbWl0X3RhaWwoY29tbWl0KTsKK30KKworc3RhdGljIGludCBkY3NzX2RybV9h
dG9taWNfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sCisJCQkJICBzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJICBib29sIG5vbmJsb2NrKQoreworCWludCByZXQ7CisJ
c3RydWN0IGRjc3Nfa21zX2RldiAqa21zID0gY29udGFpbmVyX29mKGRybSwgc3RydWN0IGRjc3Nf
a21zX2RldiwgYmFzZSk7CisJc3RydWN0IGRjc3NfZHJtX2NvbW1pdCAqY29tbWl0OworCisJaWYg
KHN0YXRlLT5hc3luY191cGRhdGUpIHsKKwkJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFy
ZV9wbGFuZXMoZHJtLCBzdGF0ZSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCisJCWRy
bV9hdG9taWNfaGVscGVyX2FzeW5jX2NvbW1pdChkcm0sIHN0YXRlKTsKKwkJZHJtX2F0b21pY19o
ZWxwZXJfY2xlYW51cF9wbGFuZXMoZHJtLCBzdGF0ZSk7CisKKwkJcmV0dXJuIDA7CisJfQorCisJ
Y29tbWl0ID0ga3phbGxvYyhzaXplb2YoKmNvbW1pdCksIEdGUF9LRVJORUwpOworCWlmICghY29t
bWl0KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWNvbW1pdC0+ZHJtID0gZHJtOworCWNvbW1pdC0+
c3RhdGUgPSBzdGF0ZTsKKworCXJldCA9IGRybV9hdG9taWNfaGVscGVyX3NldHVwX2NvbW1pdChz
dGF0ZSwgbm9uYmxvY2spOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2ZyZWU7CisKKwlJTklUX1dP
UksoJmNvbW1pdC0+d29yaywgZGNzc19jb21taXRfd29yayk7CisKKwlyZXQgPSBkcm1fYXRvbWlj
X2hlbHBlcl9wcmVwYXJlX3BsYW5lcyhkcm0sIHN0YXRlKTsKKwlpZiAocmV0KQorCQlnb3RvIGVy
cl9mcmVlOworCisJaWYgKCFub25ibG9jaykgeworCQlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl93
YWl0X2Zvcl9mZW5jZXMoZHJtLCBzdGF0ZSwgdHJ1ZSk7CisJCWlmIChyZXQpCisJCQlnb3RvIGVy
cjsKKwl9CisKKwlzcGluX2xvY2soJmttcy0+Y29tbWl0LndhaXQubG9jayk7CisJcmV0ID0gd2Fp
dF9ldmVudF9pbnRlcnJ1cHRpYmxlX2xvY2tlZChrbXMtPmNvbW1pdC53YWl0LAorCQkJCQkgICAg
ICAha21zLT5jb21taXQucGVuZGluZyk7CisJaWYgKHJldCA9PSAwKQorCQlrbXMtPmNvbW1pdC5w
ZW5kaW5nID0gdHJ1ZTsKKwlzcGluX3VubG9jaygma21zLT5jb21taXQud2FpdC5sb2NrKTsKKwor
CWlmIChyZXQpCisJCWdvdG8gZXJyOworCisJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfc3dhcF9z
dGF0ZShzdGF0ZSwgdHJ1ZSk7CisJaWYgKHJldCkKKwkJZ290byBlcnI7CisKKwlkcm1fYXRvbWlj
X3N0YXRlX2dldChzdGF0ZSk7CisJaWYgKG5vbmJsb2NrKQorCQlxdWV1ZV93b3JrKGttcy0+Y29t
bWl0X3dxLCAmY29tbWl0LT53b3JrKTsKKwllbHNlCisJCWRjc3NfZHJtX2F0b21pY19jb21taXRf
dGFpbChjb21taXQpOworCisJcmV0dXJuIDA7CisKK2VycjoKKwlkcm1fYXRvbWljX2hlbHBlcl9j
bGVhbnVwX3BsYW5lcyhkcm0sIHN0YXRlKTsKKworZXJyX2ZyZWU6CisJa2ZyZWUoY29tbWl0KTsK
KwlyZXR1cm4gcmV0OworfQorCitjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGRj
c3NfZHJtX21vZGVfY29uZmlnX2Z1bmNzID0geworCS5mYl9jcmVhdGUgPSBkcm1fZ2VtX2ZiX2Ny
ZWF0ZSwKKwkub3V0cHV0X3BvbGxfY2hhbmdlZCA9IGRybV9mYl9oZWxwZXJfb3V0cHV0X3BvbGxf
Y2hhbmdlZCwKKwkuYXRvbWljX2NoZWNrID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2ssCisJLmF0
b21pY19jb21taXQgPSBkY3NzX2RybV9hdG9taWNfY29tbWl0LAorfTsKKworc3RhdGljIHN0cnVj
dCBkcm1fZHJpdmVyIGRjc3Nfa21zX2RyaXZlciA9IHsKKwkuZHJpdmVyX2ZlYXR1cmVzCT0gRFJJ
VkVSX01PREVTRVQgfCBEUklWRVJfR0VNIHwgRFJJVkVSX0FUT01JQywKKwkuZ2VtX2ZyZWVfb2Jq
ZWN0X3VubG9ja2VkID0gZHJtX2dlbV9jbWFfZnJlZV9vYmplY3QsCisJLmdlbV92bV9vcHMJCT0g
JmRybV9nZW1fY21hX3ZtX29wcywKKwkuZHVtYl9jcmVhdGUJCT0gZHJtX2dlbV9jbWFfZHVtYl9j
cmVhdGUsCisKKwkucHJpbWVfaGFuZGxlX3RvX2ZkCT0gZHJtX2dlbV9wcmltZV9oYW5kbGVfdG9f
ZmQsCisJLnByaW1lX2ZkX3RvX2hhbmRsZQk9IGRybV9nZW1fcHJpbWVfZmRfdG9faGFuZGxlLAor
CS5nZW1fcHJpbWVfaW1wb3J0CT0gZHJtX2dlbV9wcmltZV9pbXBvcnQsCisJLmdlbV9wcmltZV9l
eHBvcnQJPSBkcm1fZ2VtX3ByaW1lX2V4cG9ydCwKKwkuZ2VtX3ByaW1lX2dldF9zZ190YWJsZQk9
IGRybV9nZW1fY21hX3ByaW1lX2dldF9zZ190YWJsZSwKKwkuZ2VtX3ByaW1lX2ltcG9ydF9zZ190
YWJsZSA9IGRybV9nZW1fY21hX3ByaW1lX2ltcG9ydF9zZ190YWJsZSwKKwkuZ2VtX3ByaW1lX3Zt
YXAJCT0gZHJtX2dlbV9jbWFfcHJpbWVfdm1hcCwKKwkuZ2VtX3ByaW1lX3Z1bm1hcAk9IGRybV9n
ZW1fY21hX3ByaW1lX3Z1bm1hcCwKKwkuZ2VtX3ByaW1lX21tYXAJCT0gZHJtX2dlbV9jbWFfcHJp
bWVfbW1hcCwKKwkuZm9wcwkJCT0gJmRjc3NfY21hX2ZvcHMsCisJLm5hbWUJCQk9ICJpbXgtZGNz
cyIsCisJLmRlc2MJCQk9ICJpLk1YOE1RIERpc3BsYXkgU3Vic3lzdGVtIiwKKwkuZGF0ZQkJCT0g
IjIwMTkwOTE3IiwKKwkubWFqb3IJCQk9IDEsCisJLm1pbm9yCQkJPSAwLAorCS5wYXRjaGxldmVs
CQk9IDAsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19oZWxwZXJf
ZnVuY3MgZGNzc19tb2RlX2NvbmZpZ19oZWxwZXJzID0geworCS5hdG9taWNfY29tbWl0X3RhaWwg
PSBkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfdGFpbF9ycG0sCit9OworCitzdGF0aWMgdm9pZCBk
Y3NzX2ttc19tb2RlX2NvbmZpZ19pbml0KHN0cnVjdCBkY3NzX2ttc19kZXYgKmttcykKK3sKKwlz
dHJ1Y3QgZHJtX21vZGVfY29uZmlnICpjb25maWcgPSAma21zLT5iYXNlLm1vZGVfY29uZmlnOwor
CisJZHJtX21vZGVfY29uZmlnX2luaXQoJmttcy0+YmFzZSk7CisKKwljb25maWctPm1pbl93aWR0
aCA9IDE7CisJY29uZmlnLT5taW5faGVpZ2h0ID0gMTsKKwljb25maWctPm1heF93aWR0aCA9IDQw
OTY7CisJY29uZmlnLT5tYXhfaGVpZ2h0ID0gNDA5NjsKKwljb25maWctPmFsbG93X2ZiX21vZGlm
aWVycyA9IHRydWU7CisJY29uZmlnLT5ub3JtYWxpemVfenBvcyA9IHRydWU7CisKKwljb25maWct
PmZ1bmNzID0gJmRjc3NfZHJtX21vZGVfY29uZmlnX2Z1bmNzOworCWNvbmZpZy0+aGVscGVyX3By
aXZhdGUgPSAmZGNzc19tb2RlX2NvbmZpZ19oZWxwZXJzOworfQorCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRybV9lbmNvZGVyX2Z1bmNzIGRjc3Nfa21zX3NpbXBsZV9lbmNvZGVyX2Z1bmNzID0gewor
CS5kZXN0cm95ID0gZHJtX2VuY29kZXJfY2xlYW51cCwKK307CisKK3N0YXRpYyBpbnQgZGNzc19r
bXNfc2V0dXBfZW5jb2RlcihzdHJ1Y3QgZGNzc19rbXNfZGV2ICprbXMpCit7CisJc3RydWN0IGRy
bV9kZXZpY2UgKmRkZXYgPSAma21zLT5iYXNlOworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rl
ciA9ICZrbXMtPmVuY29kZXI7CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gKHN0cnVjdCBkcm1f
Y3J0YyAqKSZrbXMtPmNydGM7CisJc3RydWN0IGRybV9wYW5lbCAqcGFuZWw7CisJc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZTsKKwlpbnQgcmV0OworCisJcmV0ID0gZHJtX29mX2ZpbmRfcGFuZWxf
b3JfYnJpZGdlKGRkZXYtPmRldi0+b2Zfbm9kZSwgMCwgMCwKKwkJCQkJICAmcGFuZWwsICZicmlk
Z2UpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAoIWJyaWRnZSkgeworCQlkZXZf
ZXJyKGRkZXYtPmRldiwgIk5vIGJyaWRnZSBmb3VuZCAlZC5cbiIsIHJldCk7CisJCXJldHVybiAt
RU5PREVWOworCX0KKworCWVuY29kZXItPnBvc3NpYmxlX2NydGNzID0gZHJtX2NydGNfbWFzayhj
cnRjKTsKKworCXJldCA9IGRybV9lbmNvZGVyX2luaXQoJmttcy0+YmFzZSwgZW5jb2RlciwKKwkJ
CSAgICAgICAmZGNzc19rbXNfc2ltcGxlX2VuY29kZXJfZnVuY3MsCisJCQkgICAgICAgRFJNX01P
REVfRU5DT0RFUl9OT05FLCBOVUxMKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZGRldi0+ZGV2
LCAiRmFpbGVkIGluaXRpYWxpemluZyBlbmNvZGVyICVkLlxuIiwgcmV0KTsKKwkJcmV0dXJuIHJl
dDsKKwl9CisKKwlyZXR1cm4gZHJtX2JyaWRnZV9hdHRhY2goZW5jb2RlciwgYnJpZGdlLCBOVUxM
KTsKK30KKworc3RydWN0IGRjc3Nfa21zX2RldiAqZGNzc19rbXNfYXR0YWNoKHN0cnVjdCBkY3Nz
X2RldiAqZGNzcywgYm9vbCBjb21wb25lbnRpemVkKQoreworCXN0cnVjdCBkY3NzX2ttc19kZXYg
KmttcyA9IGt6YWxsb2Moc2l6ZW9mKCprbXMpLCBHRlBfS0VSTkVMKTsKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZHJtOworCXN0cnVjdCBkY3NzX2NydGMgKmNydGM7CisJaW50IHJldDsKKworCWlmICgh
a21zKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKworCWRybSA9ICZrbXMtPmJhc2U7CisJ
Y3J0YyA9ICZrbXMtPmNydGM7CisJcmV0ID0gZHJtX2Rldl9pbml0KGRybSwgJmRjc3Nfa21zX2Ry
aXZlciwgZGNzcy0+ZGV2KTsKKwlpZiAocmV0KQorCQlnb3RvIGZyZWVfa21zOworCisJZHJtLT5k
ZXZfcHJpdmF0ZSA9IGRjc3M7CisKKwlkY3NzX2ttc19tb2RlX2NvbmZpZ19pbml0KGttcyk7CisK
KwlyZXQgPSBkcm1fdmJsYW5rX2luaXQoZHJtLCAxKTsKKwlpZiAocmV0KQorCQlnb3RvIGNsZWFu
dXBfbW9kZV9jb25maWc7CisKKwlkcm0tPmlycV9lbmFibGVkID0gdHJ1ZTsKKworCXJldCA9IGRj
c3NfY3J0Y19pbml0KGNydGMsIGRybSk7CisJaWYgKHJldCkKKwkJZ290byBjbGVhbnVwX21vZGVf
Y29uZmlnOworCisJa21zLT5jb21taXRfd3EgPSBhbGxvY19vcmRlcmVkX3dvcmtxdWV1ZSgiZGNz
c19ub25ibG9ja19jb21taXRfd3EiLCAwKTsKKwlpZiAoIWttcy0+Y29tbWl0X3dxKSB7CisJCXJl
dCA9IC1FTk9NRU07CisJCWdvdG8gY2xlYW51cF9jcnRjOworCX0KKworCWluaXRfd2FpdHF1ZXVl
X2hlYWQoJmttcy0+Y29tbWl0LndhaXQpOworCisJaWYgKGNvbXBvbmVudGl6ZWQpCisJCXJldCA9
IGNvbXBvbmVudF9iaW5kX2FsbChkY3NzLT5kZXYsIGttcyk7CisJZWxzZQorCQlyZXQgPSBkY3Nz
X2ttc19zZXR1cF9lbmNvZGVyKGttcyk7CisKKwlpZiAocmV0KQorCQlnb3RvIGNsZWFudXBfd3E7
CisKKwlkcm1fbW9kZV9jb25maWdfcmVzZXQoZHJtKTsKKworCWRybV9rbXNfaGVscGVyX3BvbGxf
aW5pdChkcm0pOworCisJcmV0ID0gZHJtX2Rldl9yZWdpc3Rlcihkcm0sIDApOworCWlmIChyZXQp
CisJCWdvdG8gY2xlYW51cF93cTsKKworCWRybV9mYmRldl9nZW5lcmljX3NldHVwKGRybSwgMzIp
OworCisJcmV0dXJuIGttczsKKworY2xlYW51cF93cToKKwlkcm1fa21zX2hlbHBlcl9wb2xsX2Zp
bmkoZHJtKTsKKwlkZXN0cm95X3dvcmtxdWV1ZShrbXMtPmNvbW1pdF93cSk7CisKK2NsZWFudXBf
Y3J0YzoKKwlkY3NzX2NydGNfZGVpbml0KGNydGMsIGRybSk7CisKK2NsZWFudXBfbW9kZV9jb25m
aWc6CisJZHJtX21vZGVfY29uZmlnX2NsZWFudXAoZHJtKTsKKworZnJlZV9rbXM6CisJa2ZyZWUo
a21zKTsKKwlyZXR1cm4gRVJSX1BUUihyZXQpOworfQorCit2b2lkIGRjc3Nfa21zX2RldGFjaChz
dHJ1Y3QgZGNzc19rbXNfZGV2ICprbXMsIGJvb2wgY29tcG9uZW50aXplZCkKK3sKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZHJtID0gJmttcy0+YmFzZTsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3MgPSBk
cm0tPmRldl9wcml2YXRlOworCisJZHJtX2Rldl91bnJlZ2lzdGVyKGRybSk7CisJZHJtX2ttc19o
ZWxwZXJfcG9sbF9maW5pKGRybSk7CisJZHJtX2F0b21pY19oZWxwZXJfc2h1dGRvd24oZHJtKTsK
Kwlkcm1fY3J0Y192Ymxhbmtfb2ZmKCZrbXMtPmNydGMuYmFzZSk7CisJZHJtLT5pcnFfZW5hYmxl
ZCA9IGZhbHNlOworCWRybV9tb2RlX2NvbmZpZ19jbGVhbnVwKGRybSk7CisJZGVzdHJveV93b3Jr
cXVldWUoa21zLT5jb21taXRfd3EpOworCWRjc3NfY3J0Y19kZWluaXQoJmttcy0+Y3J0YywgZHJt
KTsKKwlpZiAoY29tcG9uZW50aXplZCkKKwkJY29tcG9uZW50X3VuYmluZF9hbGwoZGNzcy0+ZGV2
LCBkcm0pOworCWRybS0+ZGV2X3ByaXZhdGUgPSBOVUxMOworCWRybV9kZXZfcHV0KGRybSk7Cit9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWttcy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi42Mjk3MDA1Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3Mta21zLmgKQEAgLTAsMCArMSw1MiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAgKi8KKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBOWFAuCisgKi8KKworI2lm
bmRlZiBfRENTU19LTVNfSF8KKyNkZWZpbmUgX0RDU1NfS01TX0hfCisKKyNpbmNsdWRlIDxkcm0v
ZHJtX2VuY29kZXIuaD4KKworc3RydWN0IGRjc3NfcGxhbmUgeworCXN0cnVjdCBkcm1fcGxhbmUg
YmFzZTsKKworCWludCBjaF9udW07Cit9OworCitzdHJ1Y3QgZGNzc19jcnRjIHsKKwlzdHJ1Y3Qg
ZHJtX2NydGMJCWJhc2U7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlCSpzdGF0ZTsKKworCXN0cnVj
dCBkY3NzX3BsYW5lCSpwbGFuZVszXTsKKworCWludAkJCWlycTsKKwlib29sCQkJaXJxX2VuYWJs
ZWQ7CisKKwlzdHJ1Y3QgY29tcGxldGlvbiBlbl9jb21wbGV0aW9uOworCXN0cnVjdCBjb21wbGV0
aW9uIGRpc19jb21wbGV0aW9uOworfTsKKworc3RydWN0IGNvbW1pdCB7CisJd2FpdF9xdWV1ZV9o
ZWFkX3Qgd2FpdDsKKwlib29sIHBlbmRpbmc7Cit9OworCitzdHJ1Y3QgZGNzc19rbXNfZGV2IHsK
KwlzdHJ1Y3QgZHJtX2RldmljZSBiYXNlOworCXN0cnVjdCBkY3NzX2NydGMgY3J0YzsKKwlzdHJ1
Y3QgZHJtX2VuY29kZXIgZW5jb2RlcjsKKwlzdHJ1Y3Qgd29ya3F1ZXVlX3N0cnVjdCAqY29tbWl0
X3dxOworCXN0cnVjdCBjb21taXQgY29tbWl0OworfTsKKworc3RydWN0IGRjc3Nfa21zX2RldiAq
ZGNzc19rbXNfYXR0YWNoKHN0cnVjdCBkY3NzX2RldiAqZGNzcywgYm9vbCBjb21wb25lbnRpemVk
KTsKK3ZvaWQgZGNzc19rbXNfZGV0YWNoKHN0cnVjdCBkY3NzX2ttc19kZXYgKmttcywgYm9vbCBj
b21wb25lbnRpemVkKTsKK2ludCBkY3NzX2NydGNfaW5pdChzdHJ1Y3QgZGNzc19jcnRjICpjcnRj
LCBzdHJ1Y3QgZHJtX2RldmljZSAqZHJtKTsKK3ZvaWQgZGNzc19jcnRjX2RlaW5pdChzdHJ1Y3Qg
ZGNzc19jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX2RldmljZSAqZHJtKTsKK3N0cnVjdCBkY3NzX3Bs
YW5lICpkY3NzX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwKKwkJCQkgICB1bnNp
Z25lZCBpbnQgcG9zc2libGVfY3J0Y3MsCisJCQkJICAgZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBl
LAorCQkJCSAgIHVuc2lnbmVkIGludCB6cG9zKTsKKworI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2lteC9k
Y3NzL2Rjc3MtcGxhbmUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uY2Ix
OGMzZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXBs
YW5lLmMKQEAgLTAsMCArMSw0MTggQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwt
Mi4wCisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNsdWRlIDxkcm0vZHJt
X2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUg
PGRybS9kcm1fZmJfY21hX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVm
ZmVyX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2NtYV9oZWxwZXIuaD4KKworI2lu
Y2x1ZGUgImRjc3MtZGV2LmgiCisjaW5jbHVkZSAiZGNzcy1rbXMuaCIKKworc3RhdGljIGNvbnN0
IHUzMiBkY3NzX2NvbW1vbl9mb3JtYXRzW10gPSB7CisJLyogUkdCICovCisJRFJNX0ZPUk1BVF9B
UkdCODg4OCwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJ
RFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX1JHQkE4ODg4LAorCURSTV9GT1JNQVRf
UkdCWDg4ODgsCisJRFJNX0ZPUk1BVF9CR1JBODg4OCwKKwlEUk1fRk9STUFUX0JHUlg4ODg4LAor
CURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1f
Rk9STUFUX1JHQlgxMDEwMTAyLAorCURSTV9GT1JNQVRfQkdSWDEwMTAxMDIsCisJRFJNX0ZPUk1B
VF9BUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfUkdC
QTEwMTAxMDIsCisJRFJNX0ZPUk1BVF9CR1JBMTAxMDEwMiwKKworCS8qIFlVVjQ0NCAqLworCURS
TV9GT1JNQVRfQVlVViwKKworCS8qIFlVVjQyMiAqLworCURSTV9GT1JNQVRfVVlWWSwKKwlEUk1f
Rk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9ZVVlWLAorCURSTV9GT1JNQVRfWVZZVSwKKworCS8q
IFlVVjQyMCAqLworCURSTV9GT1JNQVRfTlYxMiwKKwlEUk1fRk9STUFUX05WMjEsCit9OworCitz
dGF0aWMgY29uc3QgdTY0IGRjc3NfdmlkZW9fZm9ybWF0X21vZGlmaWVyc1tdID0geworCURSTV9G
T1JNQVRfTU9EX0xJTkVBUiwKKwlEUk1fRk9STUFUX01PRF9JTlZBTElELAorfTsKKworc3RhdGlj
IGNvbnN0IHU2NCBkY3NzX2dyYXBoaWNzX2Zvcm1hdF9tb2RpZmllcnNbXSA9IHsKKwlEUk1fRk9S
TUFUX01PRF9WSVZBTlRFX1RJTEVELAorCURSTV9GT1JNQVRfTU9EX1ZJVkFOVEVfU1VQRVJfVElM
RUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQsCit9
OworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBkY3NzX3BsYW5lICp0b19kY3NzX3BsYW5lKHN0cnVj
dCBkcm1fcGxhbmUgKnApCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihwLCBzdHJ1Y3QgZGNzc19w
bGFuZSwgYmFzZSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBkY3NzX3BsYW5lX2ZiX2lzX2xp
bmVhcihjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKK3sKKwlyZXR1cm4gKChmYi0+
ZmxhZ3MgJiBEUk1fTU9ERV9GQl9NT0RJRklFUlMpID09IDApIHx8CisJICAgICAgICgoZmItPmZs
YWdzICYgRFJNX01PREVfRkJfTU9ESUZJRVJTKSAhPSAwICYmCisJCWZiLT5tb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVIpOworfQorCitzdGF0aWMgdm9pZCBkY3NzX3BsYW5lX2Rlc3Ry
b3koc3RydWN0IGRybV9wbGFuZSAqcGxhbmUpCit7CisJc3RydWN0IGRjc3NfcGxhbmUgKmRjc3Nf
cGxhbmUgPSBjb250YWluZXJfb2YocGxhbmUsIHN0cnVjdCBkY3NzX3BsYW5lLAorCQkJCQkJICAg
ICBiYXNlKTsKKworCWRybV9wbGFuZV9jbGVhbnVwKHBsYW5lKTsKKwlrZnJlZShkY3NzX3BsYW5l
KTsKK30KKworc3RhdGljIGJvb2wgZGNzc19wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkJICAgIHUzMiBmb3JtYXQsCisJCQkJCSAgICB1NjQg
bW9kaWZpZXIpCit7CisJc3dpdGNoIChwbGFuZS0+dHlwZSkgeworCWNhc2UgRFJNX1BMQU5FX1RZ
UEVfUFJJTUFSWToKKwkJc3dpdGNoIChmb3JtYXQpIHsKKwkJY2FzZSBEUk1fRk9STUFUX0FSR0I4
ODg4OgorCQljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJCWNhc2UgRFJNX0ZPUk1BVF9BUkdC
MjEwMTAxMDoKKwkJCXJldHVybiBtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIgfHwK
KwkJCSAgICAgICBtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9WSVZBTlRFX1RJTEVEIHx8CisJ
CQkgICAgICAgbW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfVklWQU5URV9TVVBFUl9USUxFRDsK
KwkJZGVmYXVsdDoKKwkJCXJldHVybiBtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVI7
CisJCX0KKwkJYnJlYWs7CisJY2FzZSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZOgorCQlyZXR1cm4g
bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSOworCWRlZmF1bHQ6CisJCXJldHVybiBm
YWxzZTsKKwl9Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIGRjc3Nf
cGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9wbGFuZQkJPSBkcm1fYXRvbWljX2hlbHBlcl91cGRh
dGVfcGxhbmUsCisJLmRpc2FibGVfcGxhbmUJCT0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9w
bGFuZSwKKwkuZGVzdHJveQkJPSBkY3NzX3BsYW5lX2Rlc3Ryb3ksCisJLnJlc2V0CQkJPSBkcm1f
YXRvbWljX2hlbHBlcl9wbGFuZV9yZXNldCwKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZQk9IGRy
bV9hdG9taWNfaGVscGVyX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rlc3Ryb3lf
c3RhdGUJPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kZXN0cm95X3N0YXRlLAorCS5mb3JtYXRf
bW9kX3N1cHBvcnRlZAk9IGRjc3NfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCit9OworCitz
dGF0aWMgYm9vbCBkY3NzX3BsYW5lX2Nhbl9yb3RhdGUoY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqZm9ybWF0LAorCQkJCSAgYm9vbCBtb2RfcHJlc2VudCwgdTY0IG1vZGlmaWVyLAorCQkJ
CSAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWJvb2wgbGluZWFyX2Zvcm1hdCA9ICFtb2Rf
cHJlc2VudCB8fAorCQkJICAgICAobW9kX3ByZXNlbnQgJiYgbW9kaWZpZXIgPT0gRFJNX0ZPUk1B
VF9NT0RfTElORUFSKTsKKwl1MzIgc3VwcG9ydGVkX3JvdGF0aW9uID0gRFJNX01PREVfUk9UQVRF
XzA7CisKKwlpZiAoIWZvcm1hdC0+aXNfeXV2ICYmIGxpbmVhcl9mb3JtYXQpCisJCXN1cHBvcnRl
ZF9yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9UQVRFXzE4MCB8CisJ
CQkJICAgICBEUk1fTU9ERV9SRUZMRUNUX01BU0s7CisJZWxzZSBpZiAoIWZvcm1hdC0+aXNfeXV2
ICYmCisJCSBtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9WSVZBTlRFX1RJTEVEKQorCQlzdXBw
b3J0ZWRfcm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfTUFTSyB8CisJCQkJICAgICBEUk1fTU9E
RV9SRUZMRUNUX01BU0s7CisJZWxzZSBpZiAoZm9ybWF0LT5pc195dXYgJiYgbGluZWFyX2Zvcm1h
dCAmJgorCQkgKGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfTlYxMiB8fAorCQkgIGZvcm1h
dC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfTlYyMSkpCisJCXN1cHBvcnRlZF9yb3RhdGlvbiA9IERS
TV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9UQVRFXzE4MCB8CisJCQkJICAgICBEUk1fTU9E
RV9SRUZMRUNUX01BU0s7CisKKwlyZXR1cm4gISEocm90YXRpb24gJiBzdXBwb3J0ZWRfcm90YXRp
b24pOworfQorCitzdGF0aWMgYm9vbCBkY3NzX3BsYW5lX2lzX3NvdXJjZV9zaXplX2FsbG93ZWQo
dTE2IHNyY193LCB1MTYgc3JjX2gsIHUzMiBwaXhfZm10KQoreworCWlmIChzcmNfdyA8IDY0ICYm
CisJICAgIChwaXhfZm10ID09IERSTV9GT1JNQVRfTlYxMiB8fCBwaXhfZm10ID09IERSTV9GT1JN
QVRfTlYyMSkpCisJCXJldHVybiBmYWxzZTsKKwllbHNlIGlmIChzcmNfdyA8IDMyICYmCisJCSAo
cGl4X2ZtdCA9PSBEUk1fRk9STUFUX1VZVlkgfHwgcGl4X2ZtdCA9PSBEUk1fRk9STUFUX1ZZVVkg
fHwKKwkJICBwaXhfZm10ID09IERSTV9GT1JNQVRfWVVZViB8fCBwaXhfZm10ID09IERSTV9GT1JN
QVRfWVZZVSkpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiBzcmNfdyA+PSAxNiAmJiBzcmNf
aCA+PSA4OworfQorCitzdGF0aWMgaW50IGRjc3NfcGxhbmVfYXRvbWljX2NoZWNrKHN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQor
eworCXN0cnVjdCBkY3NzX3BsYW5lICpkY3NzX3BsYW5lID0gdG9fZGNzc19wbGFuZShwbGFuZSk7
CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0gcGxhbmUtPmRldi0+ZGV2X3ByaXZhdGU7CisJc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+ZmI7CisJYm9vbCBpc19wcmltYXJ5X3Bs
YW5lID0gcGxhbmUtPnR5cGUgPT0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWTsKKwlzdHJ1Y3QgZHJt
X2dlbV9jbWFfb2JqZWN0ICpjbWFfb2JqOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZTsKKwlpbnQgaGRpc3BsYXksIHZkaXNwbGF5OworCWludCBtaW4sIG1heDsKKwlpbnQgcmV0
OworCisJaWYgKCFmYiB8fCAhc3RhdGUtPmNydGMpCisJCXJldHVybiAwOworCisJY21hX29iaiA9
IGRybV9mYl9jbWFfZ2V0X2dlbV9vYmooZmIsIDApOworCVdBUk5fT04oIWNtYV9vYmopOworCisJ
Y3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2V4aXN0aW5nX2NydGNfc3RhdGUoc3RhdGUtPnN0
YXRlLAorCQkJCQkJCXN0YXRlLT5jcnRjKTsKKworCWhkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+YWRq
dXN0ZWRfbW9kZS5oZGlzcGxheTsKKwl2ZGlzcGxheSA9IGNydGNfc3RhdGUtPmFkanVzdGVkX21v
ZGUudmRpc3BsYXk7CisKKwlpZiAoIWRjc3NfcGxhbmVfaXNfc291cmNlX3NpemVfYWxsb3dlZChz
dGF0ZS0+c3JjX3cgPj4gMTYsCisJCQkJCSAgICAgICBzdGF0ZS0+c3JjX2ggPj4gMTYsCisJCQkJ
CSAgICAgICBmYi0+Zm9ybWF0LT5mb3JtYXQpKSB7CisJCURSTV9ERUJVR19LTVMoIlNvdXJjZSBw
bGFuZSBzaXplIGlzIG5vdCBhbGxvd2VkIVxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwor
CWRjc3Nfc2NhbGVyX2dldF9taW5fbWF4X3JhdGlvcyhkY3NzLT5zY2FsZXIsIGRjc3NfcGxhbmUt
PmNoX251bSwKKwkJCQkgICAgICAgJm1pbiwgJm1heCk7CisKKwlyZXQgPSBkcm1fYXRvbWljX2hl
bHBlcl9jaGVja19wbGFuZV9zdGF0ZShzdGF0ZSwgY3J0Y19zdGF0ZSwKKwkJCQkJCSAgbWluLCBt
YXgsICFpc19wcmltYXJ5X3BsYW5lLAorCQkJCQkJICBmYWxzZSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKworCWlmICghc3RhdGUtPnZpc2libGUpCisJCXJldHVybiAwOworCisJaWYgKCFk
Y3NzX3BsYW5lX2Nhbl9yb3RhdGUoZmItPmZvcm1hdCwKKwkJCQkgICAhIShmYi0+ZmxhZ3MgJiBE
Uk1fTU9ERV9GQl9NT0RJRklFUlMpLAorCQkJCSAgIGZiLT5tb2RpZmllciwKKwkJCQkgICBzdGF0
ZS0+cm90YXRpb24pKSB7CisJCURSTV9ERUJVR19LTVMoInJlcXVlc3RlZCByb3RhdGlvbiBpcyBu
b3QgYWxsb3dlZCFcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoKHN0YXRlLT5j
cnRjX3ggPCAwIHx8IHN0YXRlLT5jcnRjX3kgPCAwIHx8CisJICAgICBzdGF0ZS0+Y3J0Y194ICsg
c3RhdGUtPmNydGNfdyA+IGhkaXNwbGF5IHx8CisJICAgICBzdGF0ZS0+Y3J0Y195ICsgc3RhdGUt
PmNydGNfaCA+IHZkaXNwbGF5KSAmJgorCSAgICAhZGNzc19wbGFuZV9mYl9pc19saW5lYXIoZmIp
KSB7CisJCURSTV9ERUJVR19LTVMoInJlcXVlc3RlZCBjcm9wcGluZyBvcGVyYXRpb24gaXMgbm90
IGFsbG93ZWQhXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKChmYi0+ZmxhZ3Mg
JiBEUk1fTU9ERV9GQl9NT0RJRklFUlMpICYmCisJICAgICFwbGFuZS0+ZnVuY3MtPmZvcm1hdF9t
b2Rfc3VwcG9ydGVkKHBsYW5lLAorCQkJCWZiLT5mb3JtYXQtPmZvcm1hdCwKKwkJCQlmYi0+bW9k
aWZpZXIpKSB7CisJCURSTV9ERUJVR19LTVMoIkludmFsaWQgbW9kaWZpZXI6ICVsbHgiLCBmYi0+
bW9kaWZpZXIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIHZvaWQgZGNzc19wbGFuZV9hdG9taWNfc2V0X2Jhc2Uoc3RydWN0IGRjc3NfcGxhbmUgKmRj
c3NfcGxhbmUpCit7CisJc3RydWN0IGRybV9wbGFuZSAqcGxhbmUgPSAmZGNzc19wbGFuZS0+YmFz
ZTsKKwlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSA9IHBsYW5lLT5zdGF0ZTsKKwlzdHJ1
Y3QgZGNzc19kZXYgKmRjc3MgPSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICpmb3JtYXQgPSBmYi0+Zm9ybWF0OworCXN0cnVjdCBkcm1fZ2VtX2NtYV9vYmplY3QgKmNt
YV9vYmogPSBkcm1fZmJfY21hX2dldF9nZW1fb2JqKGZiLCAwKTsKKwl1bnNpZ25lZCBsb25nIHAx
X2JhID0gMCwgcDJfYmEgPSAwOworCisJaWYgKCFmb3JtYXQtPmlzX3l1diB8fAorCSAgICBmb3Jt
YXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX05WMTIgfHwKKwkgICAgZm9ybWF0LT5mb3JtYXQgPT0g
RFJNX0ZPUk1BVF9OVjIxKQorCQlwMV9iYSA9IGNtYV9vYmotPnBhZGRyICsgZmItPm9mZnNldHNb
MF0gKworCQkJZmItPnBpdGNoZXNbMF0gKiAoc3RhdGUtPnNyYy55MSA+PiAxNikgKworCQkJZm9y
bWF0LT5jaGFyX3Blcl9ibG9ja1swXSAqIChzdGF0ZS0+c3JjLngxID4+IDE2KTsKKwllbHNlIGlm
IChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1VZVlkgfHwKKwkJIGZvcm1hdC0+Zm9ybWF0
ID09IERSTV9GT1JNQVRfVllVWSB8fAorCQkgZm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9Z
VVlWIHx8CisJCSBmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1lWWVUpCisJCXAxX2JhID0g
Y21hX29iai0+cGFkZHIgKyBmYi0+b2Zmc2V0c1swXSArCisJCQlmYi0+cGl0Y2hlc1swXSAqIChz
dGF0ZS0+c3JjLnkxID4+IDE2KSArCisJCQkyICogZm9ybWF0LT5jaGFyX3Blcl9ibG9ja1swXSAq
IChzdGF0ZS0+c3JjLngxID4+IDE3KTsKKworCWlmIChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9S
TUFUX05WMTIgfHwKKwkgICAgZm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9OVjIxKQorCQlw
Ml9iYSA9IGNtYV9vYmotPnBhZGRyICsgZmItPm9mZnNldHNbMV0gKworCQkJKCgoZmItPnBpdGNo
ZXNbMV0gPj4gMSkgKiAoc3RhdGUtPnNyYy55MSA+PiAxNykgKworCQkJKHN0YXRlLT5zcmMueDEg
Pj4gMTcpKSA8PCAxKTsKKworCWRjc3NfZHByX2FkZHJfc2V0KGRjc3MtPmRwciwgZGNzc19wbGFu
ZS0+Y2hfbnVtLCBwMV9iYSwgcDJfYmEsCisJCQkgIGZiLT5waXRjaGVzWzBdKTsKK30KKworc3Rh
dGljIGJvb2wgZGNzc19wbGFuZV9uZWVkc19zZXR1cChzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpz
dGF0ZSwKKwkJCQkgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+ZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqb2xkX2ZiID0gb2xkX3N0YXRlLT5mYjsKKworCXJldHVybiBzdGF0ZS0+Y3J0Y194ICE9
IG9sZF9zdGF0ZS0+Y3J0Y194IHx8CisJICAgICAgIHN0YXRlLT5jcnRjX3kgIT0gb2xkX3N0YXRl
LT5jcnRjX3kgfHwKKwkgICAgICAgc3RhdGUtPmNydGNfdyAhPSBvbGRfc3RhdGUtPmNydGNfdyB8
fAorCSAgICAgICBzdGF0ZS0+Y3J0Y19oICE9IG9sZF9zdGF0ZS0+Y3J0Y19oIHx8CisJICAgICAg
IHN0YXRlLT5zcmNfeCAgIT0gb2xkX3N0YXRlLT5zcmNfeCAgfHwKKwkgICAgICAgc3RhdGUtPnNy
Y195ICAhPSBvbGRfc3RhdGUtPnNyY195ICB8fAorCSAgICAgICBzdGF0ZS0+c3JjX3cgICE9IG9s
ZF9zdGF0ZS0+c3JjX3cgIHx8CisJICAgICAgIHN0YXRlLT5zcmNfaCAgIT0gb2xkX3N0YXRlLT5z
cmNfaCAgfHwKKwkgICAgICAgZmItPmZvcm1hdC0+Zm9ybWF0ICE9IG9sZF9mYi0+Zm9ybWF0LT5m
b3JtYXQgfHwKKwkgICAgICAgZmItPm1vZGlmaWVyICAhPSBvbGRfZmItPm1vZGlmaWVyIHx8CisJ
ICAgICAgIHN0YXRlLT5yb3RhdGlvbiAhPSBvbGRfc3RhdGUtPnJvdGF0aW9uOworfQorCitzdGF0
aWMgdm9pZCBkY3NzX3BsYW5lX2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
CisJCQkJICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUgPSBwbGFuZS0+c3RhdGU7CisJc3RydWN0IGRjc3NfcGxh
bmUgKmRjc3NfcGxhbmUgPSB0b19kY3NzX3BsYW5lKHBsYW5lKTsKKwlzdHJ1Y3QgZGNzc19kZXYg
KmRjc3MgPSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHN0YXRlLT5mYjsKKwl1MzIgcGl4ZWxfZm9ybWF0OworCXN0cnVjdCBkcm1fY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZTsKKwlib29sIG1vZGlmaWVyc19wcmVzZW50OworCXUzMiBzcmNfdywg
c3JjX2gsIGRzdF93LCBkc3RfaDsKKwlzdHJ1Y3QgZHJtX3JlY3Qgc3JjLCBkc3Q7CisJYm9vbCBl
bmFibGUgPSB0cnVlOworCisJaWYgKCFmYiB8fCAhc3RhdGUtPmNydGMgfHwgIXN0YXRlLT52aXNp
YmxlKQorCQlyZXR1cm47CisKKwlwaXhlbF9mb3JtYXQgPSBzdGF0ZS0+ZmItPmZvcm1hdC0+Zm9y
bWF0OworCWNydGNfc3RhdGUgPSBzdGF0ZS0+Y3J0Yy0+c3RhdGU7CisJbW9kaWZpZXJzX3ByZXNl
bnQgPSAhIShmYi0+ZmxhZ3MgJiBEUk1fTU9ERV9GQl9NT0RJRklFUlMpOworCisJaWYgKG9sZF9z
dGF0ZS0+ZmIgJiYgIWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpICYm
CisJICAgICFkY3NzX3BsYW5lX25lZWRzX3NldHVwKHN0YXRlLCBvbGRfc3RhdGUpKSB7CisJCWRj
c3NfcGxhbmVfYXRvbWljX3NldF9iYXNlKGRjc3NfcGxhbmUpOworCQlyZXR1cm47CisJfQorCisJ
c3JjID0gcGxhbmUtPnN0YXRlLT5zcmM7CisJZHN0ID0gcGxhbmUtPnN0YXRlLT5kc3Q7CisKKwkv
KgorCSAqIFRoZSB3aWR0aCBhbmQgaGVpZ2h0IGFmdGVyIGNsaXBwaW5nLgorCSAqLworCXNyY193
ID0gZHJtX3JlY3Rfd2lkdGgoJnNyYykgPj4gMTY7CisJc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQo
JnNyYykgPj4gMTY7CisJZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmZHN0KTsKKwlkc3RfaCA9IGRy
bV9yZWN0X2hlaWdodCgmZHN0KTsKKworCWlmIChwbGFuZS0+dHlwZSA9PSBEUk1fUExBTkVfVFlQ
RV9PVkVSTEFZICYmCisJICAgIG1vZGlmaWVyc19wcmVzZW50ICYmIGZiLT5tb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVIpCisJCW1vZGlmaWVyc19wcmVzZW50ID0gZmFsc2U7CisKKwlk
Y3NzX2Rwcl9mb3JtYXRfc2V0KGRjc3MtPmRwciwgZGNzc19wbGFuZS0+Y2hfbnVtLCBzdGF0ZS0+
ZmItPmZvcm1hdCwKKwkJCSAgICBtb2RpZmllcnNfcHJlc2VudCA/IGZiLT5tb2RpZmllciA6CisJ
CQkJCQlEUk1fRk9STUFUX01PRF9MSU5FQVIpOworCWRjc3NfZHByX3NldF9yZXMoZGNzcy0+ZHBy
LCBkY3NzX3BsYW5lLT5jaF9udW0sIHNyY193LCBzcmNfaCk7CisJZGNzc19kcHJfc2V0X3JvdGF0
aW9uKGRjc3MtPmRwciwgZGNzc19wbGFuZS0+Y2hfbnVtLAorCQkJICAgICAgc3RhdGUtPnJvdGF0
aW9uKTsKKworCWRjc3NfcGxhbmVfYXRvbWljX3NldF9iYXNlKGRjc3NfcGxhbmUpOworCisJZGNz
c19zY2FsZXJfc2V0dXAoZGNzcy0+c2NhbGVyLCBkY3NzX3BsYW5lLT5jaF9udW0sCisJCQkgIHN0
YXRlLT5mYi0+Zm9ybWF0LCBzcmNfdywgc3JjX2gsCisJCQkgIGRzdF93LCBkc3RfaCwKKwkJCSAg
ZHJtX21vZGVfdnJlZnJlc2goJmNydGNfc3RhdGUtPm1vZGUpKTsKKworCWRjc3NfZHRnX3BsYW5l
X3Bvc19zZXQoZGNzcy0+ZHRnLCBkY3NzX3BsYW5lLT5jaF9udW0sCisJCQkgICAgICAgZHN0Lngx
LCBkc3QueTEsIGRzdF93LCBkc3RfaCk7CisJZGNzc19kdGdfcGxhbmVfYWxwaGFfc2V0KGRjc3Mt
PmR0ZywgZGNzc19wbGFuZS0+Y2hfbnVtLAorCQkJCSBmYi0+Zm9ybWF0LCBzdGF0ZS0+YWxwaGEg
Pj4gOCk7CisKKwlpZiAoIWRjc3NfcGxhbmUtPmNoX251bSAmJiAoc3RhdGUtPmFscGhhID4+IDgp
ID09IDApCisJCWVuYWJsZSA9IGZhbHNlOworCisJZGNzc19kcHJfZW5hYmxlKGRjc3MtPmRwciwg
ZGNzc19wbGFuZS0+Y2hfbnVtLCBlbmFibGUpOworCWRjc3Nfc2NhbGVyX2NoX2VuYWJsZShkY3Nz
LT5zY2FsZXIsIGRjc3NfcGxhbmUtPmNoX251bSwgZW5hYmxlKTsKKworCWlmICghZW5hYmxlKQor
CQlkY3NzX2R0Z19wbGFuZV9wb3Nfc2V0KGRjc3MtPmR0ZywgZGNzc19wbGFuZS0+Y2hfbnVtLAor
CQkJCSAgICAgICAwLCAwLCAwLCAwKTsKKworCWRjc3NfZHRnX2NoX2VuYWJsZShkY3NzLT5kdGcs
IGRjc3NfcGxhbmUtPmNoX251bSwgZW5hYmxlKTsKK30KKworc3RhdGljIHZvaWQgZGNzc19wbGFu
ZV9hdG9taWNfZGlzYWJsZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkgICAgICBzdHJ1
Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCit7CisJc3RydWN0IGRjc3NfcGxhbmUgKmRj
c3NfcGxhbmUgPSB0b19kY3NzX3BsYW5lKHBsYW5lKTsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3Mg
PSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKKworCWRjc3NfZHByX2VuYWJsZShkY3NzLT5kcHIs
IGRjc3NfcGxhbmUtPmNoX251bSwgZmFsc2UpOworCWRjc3Nfc2NhbGVyX2NoX2VuYWJsZShkY3Nz
LT5zY2FsZXIsIGRjc3NfcGxhbmUtPmNoX251bSwgZmFsc2UpOworCWRjc3NfZHRnX3BsYW5lX3Bv
c19zZXQoZGNzcy0+ZHRnLCBkY3NzX3BsYW5lLT5jaF9udW0sIDAsIDAsIDAsIDApOworCWRjc3Nf
ZHRnX2NoX2VuYWJsZShkY3NzLT5kdGcsIGRjc3NfcGxhbmUtPmNoX251bSwgZmFsc2UpOworfQor
CitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MgZGNzc19wbGFuZV9o
ZWxwZXJfZnVuY3MgPSB7CisJLnByZXBhcmVfZmIgPSBkcm1fZ2VtX2ZiX3ByZXBhcmVfZmIsCisJ
LmF0b21pY19jaGVjayA9IGRjc3NfcGxhbmVfYXRvbWljX2NoZWNrLAorCS5hdG9taWNfdXBkYXRl
ID0gZGNzc19wbGFuZV9hdG9taWNfdXBkYXRlLAorCS5hdG9taWNfZGlzYWJsZSA9IGRjc3NfcGxh
bmVfYXRvbWljX2Rpc2FibGUsCit9OworCitzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19wbGFuZV9p
bml0KHN0cnVjdCBkcm1fZGV2aWNlICpkcm0sCisJCQkJICAgdW5zaWduZWQgaW50IHBvc3NpYmxl
X2NydGNzLAorCQkJCSAgIGVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSwKKwkJCQkgICB1bnNpZ25l
ZCBpbnQgenBvcykKK3sKKwlzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19wbGFuZTsKKwljb25zdCB1
NjQgKmZvcm1hdF9tb2RpZmllcnMgPSBkY3NzX3ZpZGVvX2Zvcm1hdF9tb2RpZmllcnM7CisJaW50
IHJldDsKKworCWlmICh6cG9zID4gMikKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisKKwlk
Y3NzX3BsYW5lID0ga3phbGxvYyhzaXplb2YoKmRjc3NfcGxhbmUpLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWRjc3NfcGxhbmUpIHsKKwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2NhdGUgcGxhbmVc
biIpOworCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwl9CisKKwlpZiAodHlwZSA9PSBEUk1f
UExBTkVfVFlQRV9QUklNQVJZKQorCQlmb3JtYXRfbW9kaWZpZXJzID0gZGNzc19ncmFwaGljc19m
b3JtYXRfbW9kaWZpZXJzOworCisJcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KGRybSwg
JmRjc3NfcGxhbmUtPmJhc2UsIHBvc3NpYmxlX2NydGNzLAorCQkJCSAgICAgICAmZGNzc19wbGFu
ZV9mdW5jcywgZGNzc19jb21tb25fZm9ybWF0cywKKwkJCQkgICAgICAgQVJSQVlfU0laRShkY3Nz
X2NvbW1vbl9mb3JtYXRzKSwKKwkJCQkgICAgICAgZm9ybWF0X21vZGlmaWVycywgdHlwZSwgTlVM
TCk7CisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0aWFsaXplIHBsYW5l
XG4iKTsKKwkJa2ZyZWUoZGNzc19wbGFuZSk7CisJCXJldHVybiBFUlJfUFRSKHJldCk7CisJfQor
CisJZHJtX3BsYW5lX2hlbHBlcl9hZGQoJmRjc3NfcGxhbmUtPmJhc2UsICZkY3NzX3BsYW5lX2hl
bHBlcl9mdW5jcyk7CisKKwlyZXQgPSBkcm1fcGxhbmVfY3JlYXRlX3pwb3NfaW1tdXRhYmxlX3By
b3BlcnR5KCZkY3NzX3BsYW5lLT5iYXNlLCB6cG9zKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gRVJS
X1BUUihyZXQpOworCisJZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgmZGNzc19w
bGFuZS0+YmFzZSwKKwkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAsCisJCQkJCSAgIERSTV9NT0RF
X1JPVEFURV8wICAgfAorCQkJCQkgICBEUk1fTU9ERV9ST1RBVEVfOTAgIHwKKwkJCQkJICAgRFJN
X01PREVfUk9UQVRFXzE4MCB8CisJCQkJCSAgIERSTV9NT0RFX1JPVEFURV8yNzAgfAorCQkJCQkg
ICBEUk1fTU9ERV9SRUZMRUNUX1ggIHwKKwkJCQkJICAgRFJNX01PREVfUkVGTEVDVF9ZKTsKKwor
CWRjc3NfcGxhbmUtPmNoX251bSA9IHpwb3M7CisKKwlyZXR1cm4gZGNzc19wbGFuZTsKK30KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXNjYWxlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mtc2NhbGVyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAuLjNlMzE3ZjQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aW14L2Rjc3MvZGNzcy1zY2FsZXIuYwpAQCAtMCwwICsxLDgzMCBAQAorLy8gU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBOWFAuCisgKgorICog
U2NhbGluZyBhbGdvcml0aG1zIHdlcmUgY29udHJpYnV0ZWQgYnkgRHp1bmcgSG9hbmcgPGR6dW5n
LmhvYW5nQG54cC5jb20+CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorCisjaW5j
bHVkZSAiZGNzcy1kZXYuaCIKKworI2RlZmluZSBEQ1NTX1NDQUxFUl9DVFJMCQkJMHgwMAorI2Rl
ZmluZSAgIFNDQUxFUl9FTgkJCQlCSVQoMCkKKyNkZWZpbmUgICBSRVBFQVRfRU4JCQkJQklUKDQp
CisjZGVmaW5lICAgU0NBTEUyTUVNX0VOCQkJCUJJVCg4KQorI2RlZmluZSAgIE1FTTJPRklGT19F
TgkJCQlCSVQoMTIpCisjZGVmaW5lIERDU1NfU0NBTEVSX09GSUZPX0NUUkwJCQkweDA0CisjZGVm
aW5lICAgT0ZJRk9fTE9XX1RIUkVTX1BPUwkJCTAKKyNkZWZpbmUgICBPRklGT19MT1dfVEhSRVNf
TUFTSwkJCUdFTk1BU0soOSwgMCkKKyNkZWZpbmUgICBPRklGT19ISUdIX1RIUkVTX1BPUwkJCTE2
CisjZGVmaW5lICAgT0ZJRk9fSElHSF9USFJFU19NQVNLCQkJR0VOTUFTSygyNSwgMTYpCisjZGVm
aW5lICAgVU5ERVJSVU5fREVURUNUX0NMUgkJCUJJVCgyNikKKyNkZWZpbmUgICBMT1dfVEhSRVNf
REVURUNUX0NMUgkJCUJJVCgyNykKKyNkZWZpbmUgICBISUdIX1RIUkVTX0RFVEVDVF9DTFIJCQlC
SVQoMjgpCisjZGVmaW5lICAgVU5ERVJSVU5fREVURUNUX0VOCQkJQklUKDI5KQorI2RlZmluZSAg
IExPV19USFJFU19ERVRFQ1RfRU4JCQlCSVQoMzApCisjZGVmaW5lICAgSElHSF9USFJFU19ERVRF
Q1RfRU4JCQlCSVQoMzEpCisjZGVmaW5lIERDU1NfU0NBTEVSX1NEQVRBX0NUUkwJCQkweDA4Cisj
ZGVmaW5lICAgWVVWX0VOCQkJCUJJVCgwKQorI2RlZmluZSAgIFJUUkFNXzhMSU5FUwkJCQlCSVQo
MSkKKyNkZWZpbmUgICBZX1VWX0JZVEVfU1dBUAkJCUJJVCg0KQorI2RlZmluZSAgIEEyUjEwRzEw
QjEwX0ZPUk1BVF9QT1MJCTgKKyNkZWZpbmUgICBBMlIxMEcxMEIxMF9GT1JNQVRfTUFTSwkJR0VO
TUFTSygxMSwgOCkKKyNkZWZpbmUgRENTU19TQ0FMRVJfQklUX0RFUFRICQkJMHgwQworI2RlZmlu
ZSAgIExVTV9CSVRfREVQVEhfUE9TCQkJMAorI2RlZmluZSAgIExVTV9CSVRfREVQVEhfTUFTSwkJ
CUdFTk1BU0soMSwgMCkKKyNkZWZpbmUgICBDSFJfQklUX0RFUFRIX1BPUwkJCTQKKyNkZWZpbmUg
ICBDSFJfQklUX0RFUFRIX01BU0sJCQlHRU5NQVNLKDUsIDQpCisjZGVmaW5lIERDU1NfU0NBTEVS
X1NSQ19GT1JNQVQJCQkweDEwCisjZGVmaW5lIERDU1NfU0NBTEVSX0RTVF9GT1JNQVQJCQkweDE0
CisjZGVmaW5lICAgRk9STUFUX01BU0sJCQkJR0VOTUFTSygxLCAwKQorI2RlZmluZSBEQ1NTX1ND
QUxFUl9TUkNfTFVNX1JFUwkJCTB4MTgKKyNkZWZpbmUgRENTU19TQ0FMRVJfU1JDX0NIUl9SRVMJ
CQkweDFDCisjZGVmaW5lIERDU1NfU0NBTEVSX0RTVF9MVU1fUkVTCQkJMHgyMAorI2RlZmluZSBE
Q1NTX1NDQUxFUl9EU1RfQ0hSX1JFUwkJCTB4MjQKKyNkZWZpbmUgICBXSURUSF9QT1MJCQkJMAor
I2RlZmluZSAgIFdJRFRIX01BU0sJCQkJR0VOTUFTSygxMSwgMCkKKyNkZWZpbmUgICBIRUlHSFRf
UE9TCQkJCTE2CisjZGVmaW5lICAgSEVJR0hUX01BU0sJCQkJR0VOTUFTSygyNywgMTYpCisjZGVm
aW5lIERDU1NfU0NBTEVSX1ZfTFVNX1NUQVJUCQkJMHg0OAorI2RlZmluZSAgIFZfU1RBUlRfTUFT
SwkJCQlHRU5NQVNLKDE1LCAwKQorI2RlZmluZSBEQ1NTX1NDQUxFUl9WX0xVTV9JTkMJCQkweDRD
CisjZGVmaW5lICAgVl9JTkNfTUFTSwkJCQlHRU5NQVNLKDE1LCAwKQorI2RlZmluZSBEQ1NTX1ND
QUxFUl9IX0xVTV9TVEFSVAkJCTB4NTAKKyNkZWZpbmUgICBIX1NUQVJUX01BU0sJCQkJR0VOTUFT
SygxOCwgMCkKKyNkZWZpbmUgRENTU19TQ0FMRVJfSF9MVU1fSU5DCQkJMHg1NAorI2RlZmluZSAg
IEhfSU5DX01BU0sJCQkJR0VOTUFTSygxNSwgMCkKKyNkZWZpbmUgRENTU19TQ0FMRVJfVl9DSFJf
U1RBUlQJCQkweDU4CisjZGVmaW5lIERDU1NfU0NBTEVSX1ZfQ0hSX0lOQwkJCTB4NUMKKyNkZWZp
bmUgRENTU19TQ0FMRVJfSF9DSFJfU1RBUlQJCQkweDYwCisjZGVmaW5lIERDU1NfU0NBTEVSX0hf
Q0hSX0lOQwkJCTB4NjQKKyNkZWZpbmUgRENTU19TQ0FMRVJfQ09FRl9WTFVNCQkJMHg4MAorI2Rl
ZmluZSBEQ1NTX1NDQUxFUl9DT0VGX0hMVU0JCQkweDE0MAorI2RlZmluZSBEQ1NTX1NDQUxFUl9D
T0VGX1ZDSFIJCQkweDIwMAorI2RlZmluZSBEQ1NTX1NDQUxFUl9DT0VGX0hDSFIJCQkweDMwMAor
CitzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggeworCXZvaWQgX19pb21lbSAqYmFzZV9yZWc7CisJdTMy
IGJhc2Vfb2ZzOworCXN0cnVjdCBkY3NzX3NjYWxlciAqc2NsOworCisJdTMyIHNkYXRhX2N0cmw7
CisJdTMyIHNjYWxlcl9jdHJsOworCisJYm9vbCBzY2FsZXJfY3RybF9jaGdkOworCisJdTMyIGNf
dnN0YXJ0OworCXUzMiBjX2hzdGFydDsKK307CisKK3N0cnVjdCBkY3NzX3NjYWxlciB7CisJc3Ry
dWN0IGRldmljZSAqZGV2OworCisJc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkOworCXUzMiBjdHhf
aWQ7CisKKwlzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggY2hbM107Cit9OworCisvKiBzY2FsZXIgY29l
ZmZpY2llbnRzIGdlbmVyYXRvciAqLworI2RlZmluZSBQU0NfRlJBQ19CSVRTIDMwCisjZGVmaW5l
IFBTQ19GUkFDX1NDQUxFIEJJVChQU0NfRlJBQ19CSVRTKQorI2RlZmluZSBQU0NfQklUU19GT1Jf
UEhBU0UgNAorI2RlZmluZSBQU0NfTlVNX1BIQVNFUyAxNgorI2RlZmluZSBQU0NfU1RPUkVEX1BI
QVNFUyAoUFNDX05VTV9QSEFTRVMgLyAyICsgMSkKKyNkZWZpbmUgUFNDX05VTV9UQVBTIDcKKyNk
ZWZpbmUgUFNDX05VTV9UQVBTX1JHQkEgNQorI2RlZmluZSBQU0NfQ09FRkZfUFJFQ0lTSU9OIDEw
CisjZGVmaW5lIFBTQ19QSEFTRV9GUkFDVElPTl9CSVRTIDEzCisjZGVmaW5lIFBTQ19QSEFTRV9N
QVNLIChQU0NfTlVNX1BIQVNFUyAtIDEpCisjZGVmaW5lIFBTQ19RX0ZSQUNUSU9OIDE5CisjZGVm
aW5lIFBTQ19RX1JPVU5EX09GRlNFVCAoMSA8PCAoUFNDX1FfRlJBQ1RJT04gLSAxKSkKKworLyoq
CisgKiBtdWx0X3EoKSAtIFBlcmZvcm1zIGZpeGVkLXBvaW50IG11bHRpcGxpY2F0aW9uLgorICog
QEE6IG11bHRpcGxpZXIKKyAqIEBCOiBtdWx0aXBsaWNhbmQKKyAqLworc3RhdGljIGludCBtdWx0
X3EoaW50IEEsIGludCBCKQoreworCWludCByZXN1bHQ7CisJczY0IHRlbXA7CisKKwl0ZW1wID0g
KGludDY0X3QpQSAqIChpbnQ2NF90KUI7CisJdGVtcCArPSBQU0NfUV9ST1VORF9PRkZTRVQ7CisJ
cmVzdWx0ID0gKGludCkodGVtcCA+PiBQU0NfUV9GUkFDVElPTik7CisJcmV0dXJuIHJlc3VsdDsK
K30KKworLyoqCisgKiBkaXZfcSgpIC0gUGVyZm9ybXMgZml4ZWQtcG9pbnQgZGl2aXNpb24uCisg
KiBAQTogZGl2aWRlbmQKKyAqIEBCOiBkaXZpc29yCisgKi8KK3N0YXRpYyBpbnQgZGl2X3EoaW50
IEEsIGludCBCKQoreworCWludCByZXN1bHQ7CisJczY0IHRlbXA7CisKKwl0ZW1wID0gKGludDY0
X3QpQSA8PCBQU0NfUV9GUkFDVElPTjsKKwlpZiAoKHRlbXAgPj0gMCAmJiBCID49IDApIHx8ICh0
ZW1wIDwgMCAmJiBCIDwgMCkpCisJCXRlbXAgKz0gQiAvIDI7CisJZWxzZQorCQl0ZW1wIC09IEIg
LyAyOworCisJcmVzdWx0ID0gKGludCkodGVtcCAvIEIpOworCXJldHVybiByZXN1bHQ7Cit9CisK
Ky8qKgorICogZXhwX2FwcHJveF9xKCkgLSBDb21wdXRlIGFwcHJveGltYXRpb24gdG8gZXhwKHgp
IGZ1bmN0aW9uIHVzaW5nIFRheWxvcgorICoJCSAgICBzZXJpZXMuCisgKiBAeDogZml4ZWQtcG9p
bnQgYXJndW1lbnQgb2YgZXhwIGZ1bmN0aW9uCisgKi8KK3N0YXRpYyBpbnQgZXhwX2FwcHJveF9x
KGludCB4KQoreworCWludCBzdW0gPSAxIDw8IFBTQ19RX0ZSQUNUSU9OOworCWludCB0ZXJtID0g
MSA8PCBQU0NfUV9GUkFDVElPTjsKKworCXRlcm0gPSBtdWx0X3EodGVybSwgZGl2X3EoeCwgMSA8
PCBQU0NfUV9GUkFDVElPTikpOworCXN1bSArPSB0ZXJtOworCXRlcm0gPSBtdWx0X3EodGVybSwg
ZGl2X3EoeCwgMiA8PCBQU0NfUV9GUkFDVElPTikpOworCXN1bSArPSB0ZXJtOworCXRlcm0gPSBt
dWx0X3EodGVybSwgZGl2X3EoeCwgMyA8PCBQU0NfUV9GUkFDVElPTikpOworCXN1bSArPSB0ZXJt
OworCXRlcm0gPSBtdWx0X3EodGVybSwgZGl2X3EoeCwgNCA8PCBQU0NfUV9GUkFDVElPTikpOwor
CXN1bSArPSB0ZXJtOworCisJcmV0dXJuIHN1bTsKK30KKworLyoqCisgKiBkY3NzX3NjYWxlcl9n
YXVzc2lhbl9maWx0ZXIoKSAtIEdlbmVyYXRlIGdhdXNzaWFuIHByb3RvdHlwZSBmaWx0ZXIuCisg
KiBAZmNfcTogZml4ZWQtcG9pbnQgY3V0b2ZmIGZyZXF1ZW5jeSBub3JtYWxpemVkIHRvIHJhbmdl
IFswLCAxXQorICogQHVzZV81X3RhcHM6IGluZGljYXRlcyB3aGV0aGVyIHRvIHVzZSA1IHRhcHMg
b3IgNyB0YXBzCisgKiBAY29lZjogb3V0cHV0IGZpbHRlciBjb2VmZmljaWVudHMKKyAqLworc3Rh
dGljIHZvaWQgZGNzc19zY2FsZXJfZ2F1c3NpYW5fZmlsdGVyKGludCBmY19xLCBib29sIHVzZV81
X3RhcHMsCisJCQkJCWJvb2wgcGhhc2UwX2lkZW50aXR5LAorCQkJCQlpbnQgY29lZltdW1BTQ19O
VU1fVEFQU10pCit7CisJaW50IHNpZ21hX3EsIGcwX3EsIGcxX3EsIGcyX3E7CisJaW50IHRhcF9j
bnQxLCB0YXBfY250MiwgdGFwX2lkeCwgcGhhc2VfY250OworCWludCBtaWQ7CisJaW50IHBoYXNl
OworCWludCBpOworCWludCB0YXBzOworCisJaWYgKHVzZV81X3RhcHMpCisJCWZvciAocGhhc2Ug
PSAwOyBwaGFzZSA8IFBTQ19TVE9SRURfUEhBU0VTOyBwaGFzZSsrKSB7CisJCQljb2VmW3BoYXNl
XVswXSA9IDA7CisJCQljb2VmW3BoYXNlXVtQU0NfTlVNX1RBUFMgLSAxXSA9IDA7CisJCX0KKwor
CS8qIHNlZWQgY29lZmZpY2llbnQgc2Nhbm5lciAqLworCXRhcHMgPSB1c2VfNV90YXBzID8gUFND
X05VTV9UQVBTX1JHQkEgOiBQU0NfTlVNX1RBUFM7CisJbWlkID0gKFBTQ19OVU1fUEhBU0VTICog
dGFwcykgLyAyIC0gMTsKKwlwaGFzZV9jbnQgPSAoUFNDX05VTV9QSEFTRVMgKiAoUFNDX05VTV9U
QVBTICsgMSkpIC8gMjsKKwl0YXBfY250MSA9IChQU0NfTlVNX1BIQVNFUyAqIFBTQ19OVU1fVEFQ
UykgLyAyOworCXRhcF9jbnQyID0gKFBTQ19OVU1fUEhBU0VTICogUFNDX05VTV9UQVBTKSAvIDI7
CisKKwkvKiBzZWVkIGdhdXNzaWFuIGZpbHRlciBnZW5lcmF0b3IgKi8KKwlzaWdtYV9xID0gZGl2
X3EoUFNDX1FfUk9VTkRfT0ZGU0VULCBmY19xKTsKKwlnMF9xID0gMSA8PCBQU0NfUV9GUkFDVElP
TjsKKwlnMV9xID0gZXhwX2FwcHJveF9xKGRpdl9xKC1QU0NfUV9ST1VORF9PRkZTRVQsCisJCQkJ
ICBtdWx0X3Eoc2lnbWFfcSwgc2lnbWFfcSkpKTsKKwlnMl9xID0gbXVsdF9xKGcxX3EsIGcxX3Ep
OworCWNvZWZbcGhhc2VfY250ICYgUFNDX1BIQVNFX01BU0tdW3RhcF9jbnQxID4+IFBTQ19CSVRT
X0ZPUl9QSEFTRV0gPSBnMF9xOworCisJZm9yIChpID0gMDsgaSA8IG1pZDsgaSsrKSB7CisJCXBo
YXNlX2NudCsrOworCQl0YXBfY250MS0tOworCQl0YXBfY250MisrOworCisJCWcwX3EgPSBtdWx0
X3EoZzBfcSwgZzFfcSk7CisJCWcxX3EgPSBtdWx0X3EoZzFfcSwgZzJfcSk7CisKKwkJaWYgKChw
aGFzZV9jbnQgJiBQU0NfUEhBU0VfTUFTSykgPD0gOCkgeworCQkJdGFwX2lkeCA9IHRhcF9jbnQx
ID4+IFBTQ19CSVRTX0ZPUl9QSEFTRTsKKwkJCWNvZWZbcGhhc2VfY250ICYgUFNDX1BIQVNFX01B
U0tdW3RhcF9pZHhdID0gZzBfcTsKKwkJfQorCQlpZiAoKCgtcGhhc2VfY250KSAmIFBTQ19QSEFT
RV9NQVNLKSA8PSA4KSB7CisJCQl0YXBfaWR4ID0gdGFwX2NudDIgPj4gUFNDX0JJVFNfRk9SX1BI
QVNFOworCQkJY29lZlsoLXBoYXNlX2NudCkgJiBQU0NfUEhBU0VfTUFTS11bdGFwX2lkeF0gPSBn
MF9xOworCQl9CisJfQorCisJcGhhc2VfY250Kys7CisJdGFwX2NudDEtLTsKKwljb2VmW3BoYXNl
X2NudCAmIFBTQ19QSEFTRV9NQVNLXVt0YXBfY250MSA+PiBQU0NfQklUU19GT1JfUEhBU0VdID0g
MDsKKworCS8qIG92ZXJyaWRlIHBoYXNlIDAgd2l0aCBpZGVudGl0eSBmaWx0ZXIgaWYgc3BlY2lm
aWVkICovCisJaWYgKHBoYXNlMF9pZGVudGl0eSkKKwkJZm9yIChpID0gMDsgaSA8IFBTQ19OVU1f
VEFQUzsgaSsrKQorCQkJY29lZlswXVtpXSA9IGkgPT0gKFBTQ19OVU1fVEFQUyA+PiAxKSA/CisJ
CQkJCQkoMSA8PCBQU0NfQ09FRkZfUFJFQ0lTSU9OKSA6IDA7CisKKwkvKiBub3JtYWxpemUgY29l
ZiAqLworCWZvciAocGhhc2UgPSAwOyBwaGFzZSA8IFBTQ19TVE9SRURfUEhBU0VTOyBwaGFzZSsr
KSB7CisJCWludCBzdW0gPSAwOworCQlzNjQgbGxfdGVtcDsKKworCQlmb3IgKGkgPSAwOyBpIDwg
UFNDX05VTV9UQVBTOyBpKyspCisJCQlzdW0gKz0gY29lZltwaGFzZV1baV07CisJCWZvciAoaSA9
IDA7IGkgPCBQU0NfTlVNX1RBUFM7IGkrKykgeworCQkJbGxfdGVtcCA9IGNvZWZbcGhhc2VdW2ld
OworCQkJbGxfdGVtcCA8PD0gUFNDX0NPRUZGX1BSRUNJU0lPTjsKKwkJCWxsX3RlbXAgKz0gc3Vt
ID4+IDE7CisJCQlsbF90ZW1wIC89IHN1bTsKKwkJCWNvZWZbcGhhc2VdW2ldID0gKGludClsbF90
ZW1wOworCQl9CisJfQorfQorCisvKioKKyAqIGRjc3Nfc2NhbGVyX2ZpbHRlcl9kZXNpZ24oKSAt
IENvbXB1dGUgZmlsdGVyIGNvZWZmaWNpZW50cyB1c2luZworICoJCQkJIEdhdXNzaWFuIGZpbHRl
ci4KKyAqIEBzcmNfbGVuZ3RoOiBsZW5ndGggb2YgaW5wdXQKKyAqIEBkc3RfbGVuZ3RoOiBsZW5n
dGggb2Ygb3V0cHV0CisgKiBAdXNlXzVfdGFwczogMCBmb3IgNyB0YXBzIHBlciBwaGFzZSwgMSBm
b3IgNSB0YXBzCisgKiBAY29lZjogb3V0cHV0IGNvZWZmaWNpZW50cworICovCitzdGF0aWMgdm9p
ZCBkY3NzX3NjYWxlcl9maWx0ZXJfZGVzaWduKGludCBzcmNfbGVuZ3RoLCBpbnQgZHN0X2xlbmd0
aCwKKwkJCQkgICAgICBib29sIHVzZV81X3RhcHMsIGJvb2wgcGhhc2UwX2lkZW50aXR5LAorCQkJ
CSAgICAgIGludCBjb2VmW11bUFNDX05VTV9UQVBTXSkKK3sKKwlpbnQgZmNfcTsKKworCS8qIGNv
bXB1dGUgY3V0b2ZmIGZyZXF1ZW5jeSAqLworCWlmIChkc3RfbGVuZ3RoID49IHNyY19sZW5ndGgp
CisJCWZjX3EgPSBkaXZfcSgxLCBQU0NfTlVNX1BIQVNFUyk7CisJZWxzZQorCQlmY19xID0gZGl2
X3EoZHN0X2xlbmd0aCwgc3JjX2xlbmd0aCAqIFBTQ19OVU1fUEhBU0VTKTsKKworCS8qIGNvbXB1
dGUgZ2F1c3NpYW4gZmlsdGVyIGNvZWZmaWNpZW50cyAqLworCWRjc3Nfc2NhbGVyX2dhdXNzaWFu
X2ZpbHRlcihmY19xLCB1c2VfNV90YXBzLCBwaGFzZTBfaWRlbnRpdHksIGNvZWYpOworfQorCitz
dGF0aWMgdm9pZCBkY3NzX3NjYWxlcl93cml0ZShzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLCB1
MzIgdmFsLCB1MzIgb2ZzKQoreworCXN0cnVjdCBkY3NzX3NjYWxlciAqc2NsID0gY2gtPnNjbDsK
KworCWRjc3NfY3R4bGRfd3JpdGUoc2NsLT5jdHhsZCwgc2NsLT5jdHhfaWQsIHZhbCwgY2gtPmJh
c2Vfb2ZzICsgb2ZzKTsKK30KKworc3RhdGljIGludCBkY3NzX3NjYWxlcl9jaF9pbml0X2FsbChz
dHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCwKKwkJCQkgICB1bnNpZ25lZCBsb25nIHNjYWxlcl9iYXNl
KQoreworCXN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2g7CisJaW50IGk7CisKKwlmb3IgKGkgPSAw
OyBpIDwgMzsgaSsrKSB7CisJCWNoID0gJnNjbC0+Y2hbaV07CisKKwkJY2gtPmJhc2Vfb2ZzID0g
c2NhbGVyX2Jhc2UgKyBpICogMHg0MDA7CisKKwkJY2gtPmJhc2VfcmVnID0gZGV2bV9pb3JlbWFw
KHNjbC0+ZGV2LCBjaC0+YmFzZV9vZnMsIFNaXzRLKTsKKwkJaWYgKCFjaC0+YmFzZV9yZWcpIHsK
KwkJCWRldl9lcnIoc2NsLT5kZXYsICJzY2FsZXI6IHVuYWJsZSB0byByZW1hcCBjaCBiYXNlXG4i
KTsKKwkJCXJldHVybiAtRU5PTUVNOworCQl9CisKKwkJY2gtPnNjbCA9IHNjbDsKKwl9CisKKwly
ZXR1cm4gMDsKK30KKworaW50IGRjc3Nfc2NhbGVyX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3Nz
LCB1bnNpZ25lZCBsb25nIHNjYWxlcl9iYXNlKQoreworCXN0cnVjdCBkY3NzX3NjYWxlciAqc2Nh
bGVyOworCisJc2NhbGVyID0gZGV2bV9remFsbG9jKGRjc3MtPmRldiwgc2l6ZW9mKCpzY2FsZXIp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIXNjYWxlcikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlkY3Nz
LT5zY2FsZXIgPSBzY2FsZXI7CisJc2NhbGVyLT5kZXYgPSBkY3NzLT5kZXY7CisJc2NhbGVyLT5j
dHhsZCA9IGRjc3MtPmN0eGxkOworCXNjYWxlci0+Y3R4X2lkID0gQ1RYX1NCX0hQOworCisJaWYg
KGRjc3Nfc2NhbGVyX2NoX2luaXRfYWxsKHNjYWxlciwgc2NhbGVyX2Jhc2UpKSB7CisJCWludCBp
OworCisJCWZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKKwkJCWlmIChzY2FsZXItPmNoW2ldLmJh
c2VfcmVnKQorCQkJCWRldm1faW91bm1hcChzY2FsZXItPmRldiwKKwkJCQkJICAgICBzY2FsZXIt
PmNoW2ldLmJhc2VfcmVnKTsKKwkJfQorCisJCWRldm1fa2ZyZWUoc2NhbGVyLT5kZXYsIHNjYWxl
cik7CisKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgZGNz
c19zY2FsZXJfZXhpdChzdHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCkKK3sKKwlpbnQgY2hfbm87CisK
Kwlmb3IgKGNoX25vID0gMDsgY2hfbm8gPCAzOyBjaF9ubysrKSB7CisJCXN0cnVjdCBkY3NzX3Nj
YWxlcl9jaCAqY2ggPSAmc2NsLT5jaFtjaF9ub107CisKKwkJZGNzc193cml0ZWwoMCwgY2gtPmJh
c2VfcmVnICsgRENTU19TQ0FMRVJfQ1RSTCk7CisKKwkJaWYgKGNoLT5iYXNlX3JlZykKKwkJCWRl
dm1faW91bm1hcChzY2wtPmRldiwgY2gtPmJhc2VfcmVnKTsKKwl9CisKKwlkZXZtX2tmcmVlKHNj
bC0+ZGV2LCBzY2wpOworfQorCit2b2lkIGRjc3Nfc2NhbGVyX2NoX2VuYWJsZShzdHJ1Y3QgZGNz
c19zY2FsZXIgKnNjbCwgaW50IGNoX251bSwgYm9vbCBlbikKK3sKKwlzdHJ1Y3QgZGNzc19zY2Fs
ZXJfY2ggKmNoID0gJnNjbC0+Y2hbY2hfbnVtXTsKKwl1MzIgc2NhbGVyX2N0cmw7CisKKwlzY2Fs
ZXJfY3RybCA9IGVuID8gU0NBTEVSX0VOIHwgUkVQRUFUX0VOIDogMDsKKworCWlmIChlbikKKwkJ
ZGNzc19zY2FsZXJfd3JpdGUoY2gsIGNoLT5zZGF0YV9jdHJsLCBEQ1NTX1NDQUxFUl9TREFUQV9D
VFJMKTsKKworCWlmIChjaC0+c2NhbGVyX2N0cmwgIT0gc2NhbGVyX2N0cmwpCisJCWNoLT5zY2Fs
ZXJfY3RybF9jaGdkID0gdHJ1ZTsKKworCWNoLT5zY2FsZXJfY3RybCA9IHNjYWxlcl9jdHJsOwor
fQorCitzdGF0aWMgdm9pZCBkY3NzX3NjYWxlcl95dXZfZW5hYmxlKHN0cnVjdCBkY3NzX3NjYWxl
cl9jaCAqY2gsIGJvb2wgZW4pCit7CisJY2gtPnNkYXRhX2N0cmwgJj0gfllVVl9FTjsKKwljaC0+
c2RhdGFfY3RybCB8PSBlbiA/IFlVVl9FTiA6IDA7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nfc2Nh
bGVyX3J0cl84bGluZXNfZW5hYmxlKHN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gsIGJvb2wgZW4p
Cit7CisJY2gtPnNkYXRhX2N0cmwgJj0gflJUUkFNXzhMSU5FUzsKKwljaC0+c2RhdGFfY3RybCB8
PSBlbiA/IFJUUkFNXzhMSU5FUyA6IDA7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nfc2NhbGVyX2Jp
dF9kZXB0aF9zZXQoc3RydWN0IGRjc3Nfc2NhbGVyX2NoICpjaCwgaW50IGRlcHRoKQoreworCXUz
MiB2YWw7CisKKwl2YWwgPSBkZXB0aCA9PSAzMCA/IDIgOiAwOworCisJZGNzc19zY2FsZXJfd3Jp
dGUoY2gsCisJCQkgICgodmFsIDw8IENIUl9CSVRfREVQVEhfUE9TKSAmIENIUl9CSVRfREVQVEhf
TUFTSykgfAorCQkJICAoKHZhbCA8PCBMVU1fQklUX0RFUFRIX1BPUykgJiBMVU1fQklUX0RFUFRI
X01BU0spLAorCQkJICBEQ1NTX1NDQUxFUl9CSVRfREVQVEgpOworfQorCitlbnVtIGJ1ZmZlcl9m
b3JtYXQgeworCUJVRl9GTVRfWVVWNDIwLAorCUJVRl9GTVRfWVVWNDIyLAorCUJVRl9GTVRfQVJH
Qjg4ODhfWVVWNDQ0LAorfTsKKworZW51bSBjaHJvbWFfbG9jYXRpb24geworCVBTQ19MT0NfSE9S
Wl8wX1ZFUlRfMV9PVkVSXzQgPSAwLAorCVBTQ19MT0NfSE9SWl8xX09WRVJfNF9WRVJUXzFfT1ZF
Ul80ID0gMSwKKwlQU0NfTE9DX0hPUlpfMF9WRVJUXzAgPSAyLAorCVBTQ19MT0NfSE9SWl8xX09W
RVJfNF9WRVJUXzAgPSAzLAorCVBTQ19MT0NfSE9SWl8wX1ZFUlRfMV9PVkVSXzIgPSA0LAorCVBT
Q19MT0NfSE9SWl8xX09WRVJfNF9WRVJUXzFfT1ZFUl8yID0gNQorfTsKKworc3RhdGljIHZvaWQg
ZGNzc19zY2FsZXJfZm9ybWF0X3NldChzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLAorCQkJCSAg
IGVudW0gYnVmZmVyX2Zvcm1hdCBzcmNfZm10LAorCQkJCSAgIGVudW0gYnVmZmVyX2Zvcm1hdCBk
c3RfZm10KQoreworCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCBzcmNfZm10LCBEQ1NTX1NDQUxFUl9T
UkNfRk9STUFUKTsKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwgZHN0X2ZtdCwgRENTU19TQ0FMRVJf
RFNUX0ZPUk1BVCk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nfc2NhbGVyX3Jlc19zZXQoc3RydWN0
IGRjc3Nfc2NhbGVyX2NoICpjaCwKKwkJCQlpbnQgc3JjX3hyZXMsIGludCBzcmNfeXJlcywKKwkJ
CQlpbnQgZHN0X3hyZXMsIGludCBkc3RfeXJlcywKKwkJCQl1MzIgcGl4X2Zvcm1hdCwgZW51bSBi
dWZmZXJfZm9ybWF0IGRzdF9mb3JtYXQpCit7CisJdTMyIGxzcmNfeHJlcywgbHNyY195cmVzLCBj
c3JjX3hyZXMsIGNzcmNfeXJlczsKKwl1MzIgbGRzdF94cmVzLCBsZHN0X3lyZXMsIGNkc3RfeHJl
cywgY2RzdF95cmVzOworCWJvb2wgc3JjX2lzXzQ0NCA9IHRydWU7CisKKwlsc3JjX3hyZXMgPSBz
cmNfeHJlczsKKwljc3JjX3hyZXMgPSBzcmNfeHJlczsKKwlsc3JjX3lyZXMgPSBzcmNfeXJlczsK
Kwljc3JjX3lyZXMgPSBzcmNfeXJlczsKKwlsZHN0X3hyZXMgPSBkc3RfeHJlczsKKwljZHN0X3hy
ZXMgPSBkc3RfeHJlczsKKwlsZHN0X3lyZXMgPSBkc3RfeXJlczsKKwljZHN0X3lyZXMgPSBkc3Rf
eXJlczsKKworCWlmIChwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfVVlWWSB8fCBwaXhfZm9ybWF0
ID09IERSTV9GT1JNQVRfVllVWSB8fAorCSAgICBwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfWVVZ
ViB8fCBwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfWVZZVSkgeworCQljc3JjX3hyZXMgPj49IDE7
CisJCXNyY19pc180NDQgPSBmYWxzZTsKKwl9IGVsc2UgaWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZP
Uk1BVF9OVjEyIHx8CisJCSAgIHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9OVjIxKSB7CisJCWNz
cmNfeHJlcyA+Pj0gMTsKKwkJY3NyY195cmVzID4+PSAxOworCQlzcmNfaXNfNDQ0ID0gZmFsc2U7
CisJfQorCisJaWYgKGRzdF9mb3JtYXQgPT0gQlVGX0ZNVF9ZVVY0MjIpCisJCWNkc3RfeHJlcyA+
Pj0gMTsKKworCS8qIGZvciA0OjQ6NCB0byA0OjI6MiBjb252ZXJzaW9uLCBzb3VyY2UgaGVpZ2h0
IHNob3VsZCBiZSAxIGxlc3MgKi8KKwlpZiAoc3JjX2lzXzQ0NCAmJiBkc3RfZm9ybWF0ID09IEJV
Rl9GTVRfWVVWNDIyKSB7CisJCWxzcmNfeXJlcy0tOworCQljc3JjX3lyZXMtLTsKKwl9CisKKwlk
Y3NzX3NjYWxlcl93cml0ZShjaCwgKCgobHNyY195cmVzIC0gMSkgPDwgSEVJR0hUX1BPUykgJiBI
RUlHSFRfTUFTSykgfAorCQkJICAgICAgICgoKGxzcmNfeHJlcyAtIDEpIDw8IFdJRFRIX1BPUykg
JiBXSURUSF9NQVNLKSwKKwkJCSAgRENTU19TQ0FMRVJfU1JDX0xVTV9SRVMpOworCWRjc3Nfc2Nh
bGVyX3dyaXRlKGNoLCAoKChjc3JjX3lyZXMgLSAxKSA8PCBIRUlHSFRfUE9TKSAmIEhFSUdIVF9N
QVNLKSB8CisJCQkgICAgICAgKCgoY3NyY194cmVzIC0gMSkgPDwgV0lEVEhfUE9TKSAmIFdJRFRI
X01BU0spLAorCQkJICBEQ1NTX1NDQUxFUl9TUkNfQ0hSX1JFUyk7CisJZGNzc19zY2FsZXJfd3Jp
dGUoY2gsICgoKGxkc3RfeXJlcyAtIDEpIDw8IEhFSUdIVF9QT1MpICYgSEVJR0hUX01BU0spIHwK
KwkJCSAgICAgICAoKChsZHN0X3hyZXMgLSAxKSA8PCBXSURUSF9QT1MpICYgV0lEVEhfTUFTSyks
CisJCQkgIERDU1NfU0NBTEVSX0RTVF9MVU1fUkVTKTsKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwg
KCgoY2RzdF95cmVzIC0gMSkgPDwgSEVJR0hUX1BPUykgJiBIRUlHSFRfTUFTSykgfAorCQkJICAg
ICAgICgoKGNkc3RfeHJlcyAtIDEpIDw8IFdJRFRIX1BPUykgJiBXSURUSF9NQVNLKSwKKwkJCSAg
RENTU19TQ0FMRVJfRFNUX0NIUl9SRVMpOworfQorCisjZGVmaW5lIG1heF9kb3duc2NhbGUocmF0
aW8pCQkoKHJhdGlvKSA8PCAxNikKKyNkZWZpbmUgbWF4X3Vwc2NhbGUocmF0aW8pCQkoKDEgPDwg
MTYpIC8gKHJhdGlvKSkKKworc3RydWN0IGRjc3Nfc2NhbGVyX3JhdGlvcyB7CisJaW50IGRvd25z
Y2FsZTsKKwlpbnQgdXBzY2FsZTsKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZGNzc19zY2Fs
ZXJfcmF0aW9zIGRjc3Nfc2NhbGVyX3JhdGlvc1tdID0geworCXttYXhfZG93bnNjYWxlKDMpLCBt
YXhfdXBzY2FsZSg4KX0sCisJe21heF9kb3duc2NhbGUoNSksIG1heF91cHNjYWxlKDgpfSwKKwl7
bWF4X2Rvd25zY2FsZSg1KSwgbWF4X3Vwc2NhbGUoOCl9LAorfTsKKworc3RhdGljIHZvaWQgZGNz
c19zY2FsZXJfZnJhY3Rpb25zX3NldChzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLAorCQkJCSAg
ICAgIGludCBzcmNfeHJlcywgaW50IHNyY195cmVzLAorCQkJCSAgICAgIGludCBkc3RfeHJlcywg
aW50IGRzdF95cmVzLAorCQkJCSAgICAgIHUzMiBzcmNfZm9ybWF0LCB1MzIgZHN0X2Zvcm1hdCwK
KwkJCQkgICAgICBlbnVtIGNocm9tYV9sb2NhdGlvbiBzcmNfY2hyb21hX2xvYykKK3sKKwlpbnQg
c3JjX2NfeHJlcywgc3JjX2NfeXJlcywgZHN0X2NfeHJlcywgZHN0X2NfeXJlczsKKwl1MzIgbF92
aW5jLCBsX2hpbmMsIGNfdmluYywgY19oaW5jOworCXUzMiBjX3ZzdGFydCwgY19oc3RhcnQ7CisK
KwlzcmNfY194cmVzID0gc3JjX3hyZXM7CisJc3JjX2NfeXJlcyA9IHNyY195cmVzOworCWRzdF9j
X3hyZXMgPSBkc3RfeHJlczsKKwlkc3RfY195cmVzID0gZHN0X3lyZXM7CisKKwljX3ZzdGFydCA9
IDA7CisJY19oc3RhcnQgPSAwOworCisJLyogYWRqdXN0bWVudHMgZm9yIHNvdXJjZSBjaHJvbWEg
bG9jYXRpb24gKi8KKwlpZiAoc3JjX2Zvcm1hdCA9PSBCVUZfRk1UX1lVVjQyMCkgeworCQkvKiB2
ZXJ0aWNhbCBpbnB1dCBjaHJvbWEgcG9zaXRpb24gYWRqdXN0bWVudCAqLworCQlzd2l0Y2ggKHNy
Y19jaHJvbWFfbG9jKSB7CisJCWNhc2UgUFNDX0xPQ19IT1JaXzBfVkVSVF8xX09WRVJfNDoKKwkJ
Y2FzZSBQU0NfTE9DX0hPUlpfMV9PVkVSXzRfVkVSVF8xX09WRVJfNDoKKwkJCS8qCisJCQkgKiBt
b3ZlIGNocm9tYSB1cCB0byBmaXJzdCBsdW1hIGxpbmUKKwkJCSAqICgxLzQgY2hyb21hIGlucHV0
IGxpbmUgc3BhY2luZykKKwkJCSAqLworCQkJY192c3RhcnQgLT0gKDEgPDwgKFBTQ19QSEFTRV9G
UkFDVElPTl9CSVRTIC0gMikpOworCQkJYnJlYWs7CisJCWNhc2UgUFNDX0xPQ19IT1JaXzBfVkVS
VF8xX09WRVJfMjoKKwkJY2FzZSBQU0NfTE9DX0hPUlpfMV9PVkVSXzRfVkVSVF8xX09WRVJfMjoK
KwkJCS8qCisJCQkgKiBtb3ZlIGNocm9tYSB1cCB0byBmaXJzdCBsdW1hIGxpbmUKKwkJCSAqICgx
LzIgY2hyb21hIGlucHV0IGxpbmUgc3BhY2luZykKKwkJCSAqLworCQkJY192c3RhcnQgLT0gKDEg
PDwgKFBTQ19QSEFTRV9GUkFDVElPTl9CSVRTIC0gMSkpOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6
CisJCQlicmVhazsKKwkJfQorCQkvKiBob3Jpem9udGFsIGlucHV0IGNocm9tYSBwb3NpdGlvbiBh
ZGp1c3RtZW50ICovCisJCXN3aXRjaCAoc3JjX2Nocm9tYV9sb2MpIHsKKwkJY2FzZSBQU0NfTE9D
X0hPUlpfMV9PVkVSXzRfVkVSVF8xX09WRVJfNDoKKwkJY2FzZSBQU0NfTE9DX0hPUlpfMV9PVkVS
XzRfVkVSVF8wOgorCQljYXNlIFBTQ19MT0NfSE9SWl8xX09WRVJfNF9WRVJUXzFfT1ZFUl8yOgor
CQkJLyogbW92ZSBjaHJvbWEgbGVmdCAxLzQgY2hyb21hIGlucHV0IHNhbXBsZSBzcGFjaW5nICov
CisJCQljX2hzdGFydCAtPSAoMSA8PCAoUFNDX1BIQVNFX0ZSQUNUSU9OX0JJVFMgLSAyKSk7CisJ
CQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCWJyZWFrOworCQl9CisJfQorCisJLyogYWRqdXN0bWVu
dHMgdG8gY2hyb21hIHJlc29sdXRpb24gKi8KKwlpZiAoc3JjX2Zvcm1hdCA9PSBCVUZfRk1UX1lV
VjQyMCkgeworCQlzcmNfY194cmVzID4+PSAxOworCQlzcmNfY195cmVzID4+PSAxOworCX0gZWxz
ZSBpZiAoc3JjX2Zvcm1hdCA9PSBCVUZfRk1UX1lVVjQyMikgeworCQlzcmNfY194cmVzID4+PSAx
OworCX0KKworCWlmIChkc3RfZm9ybWF0ID09IEJVRl9GTVRfWVVWNDIyKQorCQlkc3RfY194cmVz
ID4+PSAxOworCisJbF92aW5jID0gKChzcmNfeXJlcyA8PCAxMykgKyAoZHN0X3lyZXMgPj4gMSkp
IC8gZHN0X3lyZXM7CisJY192aW5jID0gKChzcmNfY195cmVzIDw8IDEzKSArIChkc3RfY195cmVz
ID4+IDEpKSAvIGRzdF9jX3lyZXM7CisJbF9oaW5jID0gKChzcmNfeHJlcyA8PCAxMykgKyAoZHN0
X3hyZXMgPj4gMSkpIC8gZHN0X3hyZXM7CisJY19oaW5jID0gKChzcmNfY194cmVzIDw8IDEzKSAr
IChkc3RfY194cmVzID4+IDEpKSAvIGRzdF9jX3hyZXM7CisKKwkvKiBzYXZlIGNocm9tYSBzdGFy
dCBwaGFzZSAqLworCWNoLT5jX3ZzdGFydCA9IGNfdnN0YXJ0OworCWNoLT5jX2hzdGFydCA9IGNf
aHN0YXJ0OworCisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIDAsIERDU1NfU0NBTEVSX1ZfTFVNX1NU
QVJUKTsKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwgbF92aW5jLCBEQ1NTX1NDQUxFUl9WX0xVTV9J
TkMpOworCisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIDAsIERDU1NfU0NBTEVSX0hfTFVNX1NUQVJU
KTsKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwgbF9oaW5jLCBEQ1NTX1NDQUxFUl9IX0xVTV9JTkMp
OworCisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIGNfdnN0YXJ0LCBEQ1NTX1NDQUxFUl9WX0NIUl9T
VEFSVCk7CisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIGNfdmluYywgRENTU19TQ0FMRVJfVl9DSFJf
SU5DKTsKKworCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCBjX2hzdGFydCwgRENTU19TQ0FMRVJfSF9D
SFJfU1RBUlQpOworCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCBjX2hpbmMsIERDU1NfU0NBTEVSX0hf
Q0hSX0lOQyk7Cit9CisKK2ludCBkY3NzX3NjYWxlcl9nZXRfbWluX21heF9yYXRpb3Moc3RydWN0
IGRjc3Nfc2NhbGVyICpzY2wsIGludCBjaF9udW0sCisJCQkJICAgaW50ICptaW4sIGludCAqbWF4
KQoreworCSptaW4gPSBkY3NzX3NjYWxlcl9yYXRpb3NbY2hfbnVtXS51cHNjYWxlOworCSptYXgg
PSBkY3NzX3NjYWxlcl9yYXRpb3NbY2hfbnVtXS5kb3duc2NhbGU7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfcHJvZ3JhbV81X2NvZWZfc2V0KHN0cnVjdCBkY3Nz
X3NjYWxlcl9jaCAqY2gsCisJCQkJCSAgIGludCBiYXNlX2FkZHIsCisJCQkJCSAgIGludCBjb2Vm
W11bUFNDX05VTV9UQVBTXSkKK3sKKwlpbnQgaSwgcGhhc2U7CisKKwlmb3IgKGkgPSAwOyBpIDwg
UFNDX1NUT1JFRF9QSEFTRVM7IGkrKykgeworCQlkY3NzX3NjYWxlcl93cml0ZShjaCwgKChjb2Vm
W2ldWzFdICYgMHhmZmYpIDw8IDE2IHwKKwkJCQkgICAgICAgKGNvZWZbaV1bMl0gJiAweGZmZikg
PDwgNCAgfAorCQkJCSAgICAgICAoY29lZltpXVszXSAmIDB4ZjAwKSA+PiA4KSwKKwkJCQkgIGJh
c2VfYWRkciArIGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNv
ZWZbaV1bM10gJiAweDBmZikgPDwgMjAgfAorCQkJCSAgICAgICAoY29lZltpXVs0XSAmIDB4ZmZm
KSA8PCA4ICB8CisJCQkJICAgICAgIChjb2VmW2ldWzVdICYgMHhmZjApID4+IDQpLAorCQkJCSAg
YmFzZV9hZGRyICsgMHg0MCArIGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVyX3dyaXRl
KGNoLCAoKGNvZWZbaV1bNV0gJiAweDAwZikgPDwgMjQpLAorCQkJCSAgYmFzZV9hZGRyICsgMHg4
MCArIGkgKiBzaXplb2YodTMyKSk7CisJfQorCisJLyogcmV2ZXJzZSBib3RoIHBoYXNlIGFuZCB0
YXAgb3JkZXJpbmdzICovCisJZm9yIChwaGFzZSA9IChQU0NfTlVNX1BIQVNFUyA+PiAxKSAtIDE7
CisJCQlpIDwgUFNDX05VTV9QSEFTRVM7IGkrKywgcGhhc2UtLSkgeworCQlkY3NzX3NjYWxlcl93
cml0ZShjaCwgKChjb2VmW3BoYXNlXVs1XSAmIDB4ZmZmKSA8PCAxNiB8CisJCQkJICAgICAgIChj
b2VmW3BoYXNlXVs0XSAmIDB4ZmZmKSA8PCA0ICB8CisJCQkJICAgICAgIChjb2VmW3BoYXNlXVsz
XSAmIDB4ZjAwKSA+PiA4KSwKKwkJCQkgIGJhc2VfYWRkciArIGkgKiBzaXplb2YodTMyKSk7CisJ
CWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNvZWZbcGhhc2VdWzNdICYgMHgwZmYpIDw8IDIwIHwK
KwkJCQkgICAgICAgKGNvZWZbcGhhc2VdWzJdICYgMHhmZmYpIDw8IDggIHwKKwkJCQkgICAgICAg
KGNvZWZbcGhhc2VdWzFdICYgMHhmZjApID4+IDQpLAorCQkJCSAgYmFzZV9hZGRyICsgMHg0MCAr
IGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNvZWZbcGhhc2Vd
WzFdICYgMHgwMGYpIDw8IDI0KSwKKwkJCQkgIGJhc2VfYWRkciArIDB4ODAgKyBpICogc2l6ZW9m
KHUzMikpOworCX0KK30KKworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfcHJvZ3JhbV83X2NvZWZf
c2V0KHN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gsCisJCQkJCSAgIGludCBiYXNlX2FkZHIsCisJ
CQkJCSAgIGludCBjb2VmW11bUFNDX05VTV9UQVBTXSkKK3sKKwlpbnQgaSwgcGhhc2U7CisKKwlm
b3IgKGkgPSAwOyBpIDwgUFNDX1NUT1JFRF9QSEFTRVM7IGkrKykgeworCQlkY3NzX3NjYWxlcl93
cml0ZShjaCwgKChjb2VmW2ldWzBdICYgMHhmZmYpIDw8IDE2IHwKKwkJCQkgICAgICAgKGNvZWZb
aV1bMV0gJiAweGZmZikgPDwgNCAgfAorCQkJCSAgICAgICAoY29lZltpXVsyXSAmIDB4ZjAwKSA+
PiA4KSwKKwkJCQkgIGJhc2VfYWRkciArIGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVy
X3dyaXRlKGNoLCAoKGNvZWZbaV1bMl0gJiAweDBmZikgPDwgMjAgfAorCQkJCSAgICAgICAoY29l
ZltpXVszXSAmIDB4ZmZmKSA8PCA4ICB8CisJCQkJICAgICAgIChjb2VmW2ldWzRdICYgMHhmZjAp
ID4+IDQpLAorCQkJCSAgYmFzZV9hZGRyICsgMHg0MCArIGkgKiBzaXplb2YodTMyKSk7CisJCWRj
c3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNvZWZbaV1bNF0gJiAweDAwZikgPDwgMjQgfAorCQkJCSAg
ICAgICAoY29lZltpXVs1XSAmIDB4ZmZmKSA8PCAxMiB8CisJCQkJICAgICAgIChjb2VmW2ldWzZd
ICYgMHhmZmYpKSwKKwkJCQkgIGJhc2VfYWRkciArIDB4ODAgKyBpICogc2l6ZW9mKHUzMikpOwor
CX0KKworCS8qIHJldmVyc2UgYm90aCBwaGFzZSBhbmQgdGFwIG9yZGVyaW5ncyAqLworCWZvciAo
cGhhc2UgPSAoUFNDX05VTV9QSEFTRVMgPj4gMSkgLSAxOworCQkJaSA8IFBTQ19OVU1fUEhBU0VT
OyBpKyssIHBoYXNlLS0pIHsKKwkJZGNzc19zY2FsZXJfd3JpdGUoY2gsICgoY29lZltwaGFzZV1b
Nl0gJiAweGZmZikgPDwgMTYgfAorCQkJCSAgICAgICAoY29lZltwaGFzZV1bNV0gJiAweGZmZikg
PDwgNCAgfAorCQkJCSAgICAgICAoY29lZltwaGFzZV1bNF0gJiAweGYwMCkgPj4gOCksCisJCQkJ
ICBiYXNlX2FkZHIgKyBpICogc2l6ZW9mKHUzMikpOworCQlkY3NzX3NjYWxlcl93cml0ZShjaCwg
KChjb2VmW3BoYXNlXVs0XSAmIDB4MGZmKSA8PCAyMCB8CisJCQkJICAgICAgIChjb2VmW3BoYXNl
XVszXSAmIDB4ZmZmKSA8PCA4ICB8CisJCQkJICAgICAgIChjb2VmW3BoYXNlXVsyXSAmIDB4ZmYw
KSA+PiA0KSwKKwkJCQkgIGJhc2VfYWRkciArIDB4NDAgKyBpICogc2l6ZW9mKHUzMikpOworCQlk
Y3NzX3NjYWxlcl93cml0ZShjaCwgKChjb2VmW3BoYXNlXVsyXSAmIDB4MDBmKSA8PCAyNCB8CisJ
CQkJICAgICAgIChjb2VmW3BoYXNlXVsxXSAmIDB4ZmZmKSA8PCAxMiB8CisJCQkJICAgICAgIChj
b2VmW3BoYXNlXVswXSAmIDB4ZmZmKSksCisJCQkJICBiYXNlX2FkZHIgKyAweDgwICsgaSAqIHNp
emVvZih1MzIpKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nfc2NhbGVyX3l1dl9jb2VmX3Nl
dChzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLAorCQkJCSAgICAgZW51bSBidWZmZXJfZm9ybWF0
IHNyY19mb3JtYXQsCisJCQkJICAgICBlbnVtIGJ1ZmZlcl9mb3JtYXQgZHN0X2Zvcm1hdCwKKwkJ
CQkgICAgIGJvb2wgdXNlXzVfdGFwcywKKwkJCQkgICAgIGludCBzcmNfeHJlcywgaW50IHNyY195
cmVzLCBpbnQgZHN0X3hyZXMsCisJCQkJICAgICBpbnQgZHN0X3lyZXMpCit7CisJaW50IGNvZWZb
UFNDX1NUT1JFRF9QSEFTRVNdW1BTQ19OVU1fVEFQU107CisJYm9vbCBwcm9ncmFtXzVfdGFwcyA9
IHVzZV81X3RhcHMgfHwKKwkJCSAgICAgIChkc3RfZm9ybWF0ID09IEJVRl9GTVRfWVVWNDIyICYm
CisJCQkgICAgICAgc3JjX2Zvcm1hdCA9PSBCVUZfRk1UX0FSR0I4ODg4X1lVVjQ0NCk7CisKKwkv
KiBob3Jpem9udGFsIGx1bWEgKi8KKwlkY3NzX3NjYWxlcl9maWx0ZXJfZGVzaWduKHNyY194cmVz
LCBkc3RfeHJlcywgZmFsc2UsCisJCQkJICBzcmNfeHJlcyA9PSBkc3RfeHJlcywgY29lZik7CisJ
ZGNzc19zY2FsZXJfcHJvZ3JhbV83X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX0hMVU0s
IGNvZWYpOworCisJLyogdmVydGljYWwgbHVtYSAqLworCWRjc3Nfc2NhbGVyX2ZpbHRlcl9kZXNp
Z24oc3JjX3lyZXMsIGRzdF95cmVzLCBwcm9ncmFtXzVfdGFwcywKKwkJCQkgIHNyY195cmVzID09
IGRzdF95cmVzLCBjb2VmKTsKKworCWlmIChwcm9ncmFtXzVfdGFwcykKKwkJZGNzc19zY2FsZXJf
cHJvZ3JhbV81X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX1ZMVU0sIGNvZWYpOworCWVs
c2UKKwkJZGNzc19zY2FsZXJfcHJvZ3JhbV83X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VG
X1ZMVU0sIGNvZWYpOworCisJLyogYWRqdXN0IGNocm9tYSByZXNvbHV0aW9uICovCisJaWYgKHNy
Y19mb3JtYXQgIT0gQlVGX0ZNVF9BUkdCODg4OF9ZVVY0NDQpCisJCXNyY194cmVzID4+PSAxOwor
CWlmIChzcmNfZm9ybWF0ID09IEJVRl9GTVRfWVVWNDIwKQorCQlzcmNfeXJlcyA+Pj0gMTsKKwlp
ZiAoZHN0X2Zvcm1hdCAhPSBCVUZfRk1UX0FSR0I4ODg4X1lVVjQ0NCkKKwkJZHN0X3hyZXMgPj49
IDE7CisJaWYgKGRzdF9mb3JtYXQgPT0gQlVGX0ZNVF9ZVVY0MjApIC8qIHNob3VsZCBub3QgaGFw
cGVuICovCisJCWRzdF95cmVzID4+PSAxOworCisJLyogaG9yaXpvbnRhbCBjaHJvbWEgKi8KKwlk
Y3NzX3NjYWxlcl9maWx0ZXJfZGVzaWduKHNyY194cmVzLCBkc3RfeHJlcywgZmFsc2UsCisJCQkJ
ICAoc3JjX3hyZXMgPT0gZHN0X3hyZXMpICYmIChjaC0+Y19oc3RhcnQgPT0gMCksCisJCQkJICBj
b2VmKTsKKworCWRjc3Nfc2NhbGVyX3Byb2dyYW1fN19jb2VmX3NldChjaCwgRENTU19TQ0FMRVJf
Q09FRl9IQ0hSLCBjb2VmKTsKKworCS8qIHZlcnRpY2FsIGNocm9tYSAqLworCWRjc3Nfc2NhbGVy
X2ZpbHRlcl9kZXNpZ24oc3JjX3lyZXMsIGRzdF95cmVzLCBwcm9ncmFtXzVfdGFwcywKKwkJCQkg
IChzcmNfeXJlcyA9PSBkc3RfeXJlcykgJiYgKGNoLT5jX3ZzdGFydCA9PSAwKSwKKwkJCQkgIGNv
ZWYpOworCWlmIChwcm9ncmFtXzVfdGFwcykKKwkJZGNzc19zY2FsZXJfcHJvZ3JhbV81X2NvZWZf
c2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX1ZDSFIsIGNvZWYpOworCWVsc2UKKwkJZGNzc19zY2Fs
ZXJfcHJvZ3JhbV83X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX1ZDSFIsIGNvZWYpOwor
fQorCitzdGF0aWMgdm9pZCBkY3NzX3NjYWxlcl9yZ2JfY29lZl9zZXQoc3RydWN0IGRjc3Nfc2Nh
bGVyX2NoICpjaCwKKwkJCQkgICAgIGludCBzcmNfeHJlcywgaW50IHNyY195cmVzLCBpbnQgZHN0
X3hyZXMsCisJCQkJICAgICBpbnQgZHN0X3lyZXMpCit7CisJaW50IGNvZWZbUFNDX1NUT1JFRF9Q
SEFTRVNdW1BTQ19OVU1fVEFQU107CisKKwkvKiBob3Jpem9udGFsIFJHQiAqLworCWRjc3Nfc2Nh
bGVyX2ZpbHRlcl9kZXNpZ24oc3JjX3hyZXMsIGRzdF94cmVzLCBmYWxzZSwKKwkJCQkgIHNyY194
cmVzID09IGRzdF94cmVzLCBjb2VmKTsKKwlkY3NzX3NjYWxlcl9wcm9ncmFtXzdfY29lZl9zZXQo
Y2gsIERDU1NfU0NBTEVSX0NPRUZfSExVTSwgY29lZik7CisKKwkvKiB2ZXJ0aWNhbCBSR0IgKi8K
KwlkY3NzX3NjYWxlcl9maWx0ZXJfZGVzaWduKHNyY195cmVzLCBkc3RfeXJlcywgZmFsc2UsCisJ
CQkJICBzcmNfeXJlcyA9PSBkc3RfeXJlcywgY29lZik7CisJZGNzc19zY2FsZXJfcHJvZ3JhbV83
X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX1ZMVU0sIGNvZWYpOworfQorCitzdGF0aWMg
dm9pZCBkY3NzX3NjYWxlcl9zZXRfcmdiMTBfb3JkZXIoc3RydWN0IGRjc3Nfc2NhbGVyX2NoICpj
aCwKKwkJCQkJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0KQoreworCXUzMiBh
MnIxMGcxMGIxMF9mb3JtYXQ7CisKKwlpZiAoZm9ybWF0LT5pc195dXYpCisJCXJldHVybjsKKwor
CWNoLT5zZGF0YV9jdHJsICY9IH5BMlIxMEcxMEIxMF9GT1JNQVRfTUFTSzsKKworCWlmIChmb3Jt
YXQtPmRlcHRoICE9IDMwKQorCQlyZXR1cm47CisKKwlzd2l0Y2ggKGZvcm1hdC0+Zm9ybWF0KSB7
CisJY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEw
MTAxMDoKKwkJYTJyMTBnMTBiMTBfZm9ybWF0ID0gMDsKKwkJYnJlYWs7CisKKwljYXNlIERSTV9G
T1JNQVRfQUJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCQlhMnIx
MGcxMGIxMF9mb3JtYXQgPSA1OworCQlicmVhazsKKworCWNhc2UgRFJNX0ZPUk1BVF9SR0JBMTAx
MDEwMjoKKwljYXNlIERSTV9GT1JNQVRfUkdCWDEwMTAxMDI6CisJCWEycjEwZzEwYjEwX2Zvcm1h
dCA9IDY7CisJCWJyZWFrOworCisJY2FzZSBEUk1fRk9STUFUX0JHUkExMDEwMTAyOgorCWNhc2Ug
RFJNX0ZPUk1BVF9CR1JYMTAxMDEwMjoKKwkJYTJyMTBnMTBiMTBfZm9ybWF0ID0gMTE7CisJCWJy
ZWFrOworCisJZGVmYXVsdDoKKwkJYTJyMTBnMTBiMTBfZm9ybWF0ID0gMDsKKwkJYnJlYWs7CisJ
fQorCisJY2gtPnNkYXRhX2N0cmwgfD0gYTJyMTBnMTBiMTBfZm9ybWF0IDw8IEEyUjEwRzEwQjEw
X0ZPUk1BVF9QT1M7Cit9CisKK3ZvaWQgZGNzc19zY2FsZXJfc2V0dXAoc3RydWN0IGRjc3Nfc2Nh
bGVyICpzY2wsIGludCBjaF9udW0sCisJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICpmb3JtYXQsCisJCSAgICAgICBpbnQgc3JjX3hyZXMsIGludCBzcmNfeXJlcywgaW50IGRz
dF94cmVzLCBpbnQgZHN0X3lyZXMsCisJCSAgICAgICB1MzIgdnJlZnJlc2hfaHopCit7CisJc3Ry
dWN0IGRjc3Nfc2NhbGVyX2NoICpjaCA9ICZzY2wtPmNoW2NoX251bV07CisJdW5zaWduZWQgaW50
IHBpeGVsX2RlcHRoID0gMDsKKwlib29sIHJ0cl84bGluZV9lbiA9IGZhbHNlOworCWJvb2wgdXNl
XzVfdGFwcyA9IGZhbHNlOworCWVudW0gYnVmZmVyX2Zvcm1hdCBzcmNfZm9ybWF0ID0gQlVGX0ZN
VF9BUkdCODg4OF9ZVVY0NDQ7CisJZW51bSBidWZmZXJfZm9ybWF0IGRzdF9mb3JtYXQgPSBCVUZf
Rk1UX0FSR0I4ODg4X1lVVjQ0NDsKKwl1MzIgcGl4X2Zvcm1hdCA9IGZvcm1hdC0+Zm9ybWF0Owor
CisJaWYgKGZvcm1hdC0+aXNfeXV2KSB7CisJCWRjc3Nfc2NhbGVyX3l1dl9lbmFibGUoY2gsIHRy
dWUpOworCisJCWlmIChwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfTlYxMiB8fAorCQkgICAgcGl4
X2Zvcm1hdCA9PSBEUk1fRk9STUFUX05WMjEgfHwKKwkJICAgIHBpeF9mb3JtYXQgPT0gRFJNX0ZP
Uk1BVF9QMDEwKSB7CisJCQlydHJfOGxpbmVfZW4gPSB0cnVlOworCQkJc3JjX2Zvcm1hdCA9IEJV
Rl9GTVRfWVVWNDIwOworCQl9IGVsc2UgaWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9VWVZZ
IHx8CisJCQkgICBwaXhfZm9ybWF0ID09IERSTV9GT1JNQVRfVllVWSB8fAorCQkJICAgcGl4X2Zv
cm1hdCA9PSBEUk1fRk9STUFUX1lVWVYgfHwKKwkJCSAgIHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1B
VF9ZVllVKSB7CisJCQlzcmNfZm9ybWF0ID0gQlVGX0ZNVF9ZVVY0MjI7CisJCX0KKworCQl1c2Vf
NV90YXBzID0gIXJ0cl84bGluZV9lbjsKKwkJaWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9Q
MDEwKQorCQkJcGl4ZWxfZGVwdGggPSAzMDsKKworCX0gZWxzZSB7CisJCWRjc3Nfc2NhbGVyX3l1
dl9lbmFibGUoY2gsIGZhbHNlKTsKKworCQlwaXhlbF9kZXB0aCA9IGZvcm1hdC0+ZGVwdGg7CisJ
fQorCisJZGNzc19zY2FsZXJfZnJhY3Rpb25zX3NldChjaCwgc3JjX3hyZXMsIHNyY195cmVzLCBk
c3RfeHJlcywKKwkJCQkgIGRzdF95cmVzLCBzcmNfZm9ybWF0LCBkc3RfZm9ybWF0LAorCQkJCSAg
UFNDX0xPQ19IT1JaXzBfVkVSVF8xX09WRVJfNCk7CisKKwlpZiAoZm9ybWF0LT5pc195dXYpCisJ
CWRjc3Nfc2NhbGVyX3l1dl9jb2VmX3NldChjaCwgc3JjX2Zvcm1hdCwgZHN0X2Zvcm1hdCwKKwkJ
CQkJIHVzZV81X3RhcHMsIHNyY194cmVzLCBzcmNfeXJlcywKKwkJCQkJIGRzdF94cmVzLCBkc3Rf
eXJlcyk7CisJZWxzZQorCQlkY3NzX3NjYWxlcl9yZ2JfY29lZl9zZXQoY2gsIHNyY194cmVzLCBz
cmNfeXJlcywKKwkJCQkJIGRzdF94cmVzLCBkc3RfeXJlcyk7CisKKwlkY3NzX3NjYWxlcl9ydHJf
OGxpbmVzX2VuYWJsZShjaCwgcnRyXzhsaW5lX2VuKTsKKwlkY3NzX3NjYWxlcl9iaXRfZGVwdGhf
c2V0KGNoLCBwaXhlbF9kZXB0aCk7CisJZGNzc19zY2FsZXJfc2V0X3JnYjEwX29yZGVyKGNoLCBm
b3JtYXQpOworCWRjc3Nfc2NhbGVyX2Zvcm1hdF9zZXQoY2gsIHNyY19mb3JtYXQsIGRzdF9mb3Jt
YXQpOworCWRjc3Nfc2NhbGVyX3Jlc19zZXQoY2gsIHNyY194cmVzLCBzcmNfeXJlcywgZHN0X3hy
ZXMsIGRzdF95cmVzLAorCQkJICAgIHBpeF9mb3JtYXQsIGRzdF9mb3JtYXQpOworfQorCisvKiBU
aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGZyb20gaW50ZXJydXB0IGNvbnRleHQuICovCit2
b2lkIGRjc3Nfc2NhbGVyX3dyaXRlX3NjbGN0cmwoc3RydWN0IGRjc3Nfc2NhbGVyICpzY2wpCit7
CisJaW50IGNobnVtOworCisJZm9yIChjaG51bSA9IDA7IGNobnVtIDwgMzsgY2hudW0rKykgewor
CQlzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoID0gJnNjbC0+Y2hbY2hudW1dOworCisJCWlmIChj
aC0+c2NhbGVyX2N0cmxfY2hnZCkgeworCQkJZGNzc19jdHhsZF93cml0ZV9pcnFzYWZlKHNjbC0+
Y3R4bGQsIHNjbC0+Y3R4X2lkLAorCQkJCQkJIGNoLT5zY2FsZXJfY3RybCwKKwkJCQkJCSBjaC0+
YmFzZV9vZnMgKworCQkJCQkJIERDU1NfU0NBTEVSX0NUUkwpOworCQkJY2gtPnNjYWxlcl9jdHJs
X2NoZ2QgPSBmYWxzZTsKKwkJfQorCX0KK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
bXgvZGNzcy9kY3NzLXNzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zcy5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi42NWEwNWMyCi0tLSAvZGV2L251bGwK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mtc3MuYwpAQCAtMCwwICsxLDE3OSBA
QAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQg
MjAxOSBOWFAuCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RldmljZS5oPgorCisjaW5jbHVkZSAi
ZGNzcy1kZXYuaCIKKworI2RlZmluZSBEQ1NTX1NTX1NZU19DVFJMCQkJMHgwMAorI2RlZmluZSAg
IFJVTl9FTgkJCQlCSVQoMCkKKyNkZWZpbmUgRENTU19TU19ESVNQTEFZCQkJCTB4MTAKKyNkZWZp
bmUgICBMUkNfWF9QT1MJCQkJMAorI2RlZmluZSAgIExSQ19YX01BU0sJCQkJR0VOTUFTSygxMiwg
MCkKKyNkZWZpbmUgICBMUkNfWV9QT1MJCQkJMTYKKyNkZWZpbmUgICBMUkNfWV9NQVNLCQkJCUdF
Tk1BU0soMjgsIDE2KQorI2RlZmluZSBEQ1NTX1NTX0hTWU5DCQkJCTB4MjAKKyNkZWZpbmUgRENT
U19TU19WU1lOQwkJCQkweDMwCisjZGVmaW5lICAgU1lOQ19TVEFSVF9QT1MJCQkwCisjZGVmaW5l
ICAgU1lOQ19TVEFSVF9NQVNLCQkJR0VOTUFTSygxMiwgMCkKKyNkZWZpbmUgICBTWU5DX0VORF9Q
T1MJCQkJMTYKKyNkZWZpbmUgICBTWU5DX0VORF9NQVNLCQkJCUdFTk1BU0soMjgsIDE2KQorI2Rl
ZmluZSAgIFNZTkNfUE9MCQkJCUJJVCgzMSkKKyNkZWZpbmUgRENTU19TU19ERV9VTEMJCQkJMHg0
MAorI2RlZmluZSAgIFVMQ19YX1BPUwkJCQkwCisjZGVmaW5lICAgVUxDX1hfTUFTSwkJCQlHRU5N
QVNLKDEyLCAwKQorI2RlZmluZSAgIFVMQ19ZX1BPUwkJCQkxNgorI2RlZmluZSAgIFVMQ19ZX01B
U0sJCQkJR0VOTUFTSygyOCwgMTYpCisjZGVmaW5lICAgVUxDX1BPTAkJCQlCSVQoMzEpCisjZGVm
aW5lIERDU1NfU1NfREVfTFJDCQkJCTB4NTAKKyNkZWZpbmUgRENTU19TU19NT0RFCQkJCTB4NjAK
KyNkZWZpbmUgICBQSVBFX01PREVfUE9TCQkJCTAKKyNkZWZpbmUgICBQSVBFX01PREVfTUFTSwkJ
CUdFTk1BU0soMSwgMCkKKyNkZWZpbmUgRENTU19TU19DT0VGRgkJCQkweDcwCisjZGVmaW5lICAg
SE9SSVpfQV9QT1MJCQkJMAorI2RlZmluZSAgIEhPUklaX0FfTUFTSwkJCQlHRU5NQVNLKDMsIDAp
CisjZGVmaW5lICAgSE9SSVpfQl9QT1MJCQkJNAorI2RlZmluZSAgIEhPUklaX0JfTUFTSwkJCQlH
RU5NQVNLKDcsIDQpCisjZGVmaW5lICAgSE9SSVpfQ19QT1MJCQkJOAorI2RlZmluZSAgIEhPUkla
X0NfTUFTSwkJCQlHRU5NQVNLKDExLCA4KQorI2RlZmluZSAgIEhPUklaX0hfTk9STV9QT1MJCQkx
MgorI2RlZmluZSAgIEhPUklaX0hfTk9STV9NQVNLCQkJR0VOTUFTSygxNCwgMTIpCisjZGVmaW5l
ICAgVkVSVF9BX1BPUwkJCQkxNgorI2RlZmluZSAgIFZFUlRfQV9NQVNLCQkJCUdFTk1BU0soMTks
IDE2KQorI2RlZmluZSAgIFZFUlRfQl9QT1MJCQkJMjAKKyNkZWZpbmUgICBWRVJUX0JfTUFTSwkJ
CQlHRU5NQVNLKDIzLCAyMCkKKyNkZWZpbmUgICBWRVJUX0NfUE9TCQkJCTI0CisjZGVmaW5lICAg
VkVSVF9DX01BU0sJCQkJR0VOTUFTSygyNywgMjQpCisjZGVmaW5lICAgVkVSVF9IX05PUk1fUE9T
CQkJMjgKKyNkZWZpbmUgICBWRVJUX0hfTk9STV9NQVNLCQkJR0VOTUFTSygzMCwgMjgpCisjZGVm
aW5lIERDU1NfU1NfQ0xJUF9DQgkJCQkweDgwCisjZGVmaW5lIERDU1NfU1NfQ0xJUF9DUgkJCQkw
eDkwCisjZGVmaW5lICAgQ0xJUF9NSU5fUE9TCQkJCTAKKyNkZWZpbmUgICBDTElQX01JTl9NQVNL
CQkJCUdFTk1BU0soOSwgMCkKKyNkZWZpbmUgICBDTElQX01BWF9QT1MJCQkJMAorI2RlZmluZSAg
IENMSVBfTUFYX01BU0sJCQkJR0VOTUFTSygyMywgMTYpCisjZGVmaW5lIERDU1NfU1NfSU5URVJf
TU9ERQkJCTB4QTAKKyNkZWZpbmUgICBJTlRfRU4JCQkJQklUKDApCisjZGVmaW5lICAgVlNZTkNf
U0hJRlQJCQkJQklUKDEpCisKK3N0cnVjdCBkY3NzX3NzIHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7
CisJdm9pZCBfX2lvbWVtICpiYXNlX3JlZzsKKwl1MzIgYmFzZV9vZnM7CisKKwlzdHJ1Y3QgZGNz
c19jdHhsZCAqY3R4bGQ7CisJdTMyIGN0eF9pZDsKKworCWJvb2wgaW5fdXNlOworfTsKKworc3Rh
dGljIHZvaWQgZGNzc19zc193cml0ZShzdHJ1Y3QgZGNzc19zcyAqc3MsIHUzMiB2YWwsIHUzMiBv
ZnMpCit7CisJaWYgKCFzcy0+aW5fdXNlKQorCQlkY3NzX3dyaXRlbCh2YWwsIHNzLT5iYXNlX3Jl
ZyArIG9mcyk7CisKKwlkY3NzX2N0eGxkX3dyaXRlKHNzLT5jdHhsZCwgc3MtPmN0eF9pZCwgdmFs
LAorCQkJIHNzLT5iYXNlX29mcyArIG9mcyk7Cit9CisKK2ludCBkY3NzX3NzX2luaXQoc3RydWN0
IGRjc3NfZGV2ICpkY3NzLCB1bnNpZ25lZCBsb25nIHNzX2Jhc2UpCit7CisJc3RydWN0IGRjc3Nf
c3MgKnNzOworCisJc3MgPSBkZXZtX2t6YWxsb2MoZGNzcy0+ZGV2LCBzaXplb2YoKnNzKSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFzcykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlkY3NzLT5zcyA9IHNz
OworCXNzLT5kZXYgPSBkY3NzLT5kZXY7CisJc3MtPmN0eGxkID0gZGNzcy0+Y3R4bGQ7CisKKwlz
cy0+YmFzZV9yZWcgPSBkZXZtX2lvcmVtYXAoZGNzcy0+ZGV2LCBzc19iYXNlLCBTWl80Syk7CisJ
aWYgKCFzcy0+YmFzZV9yZWcpIHsKKwkJZGV2X2VycihkY3NzLT5kZXYsICJzczogdW5hYmxlIHRv
IHJlbWFwIHNzIGJhc2VcbiIpOworCQlkZXZtX2tmcmVlKHNzLT5kZXYsIHNzKTsKKwkJcmV0dXJu
IC1FTk9NRU07CisJfQorCisJc3MtPmJhc2Vfb2ZzID0gc3NfYmFzZTsKKwlzcy0+Y3R4X2lkID0g
Q1RYX1NCX0hQOworCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgZGNzc19zc19leGl0KHN0cnVjdCBk
Y3NzX3NzICpzcykKK3sKKwkvKiBzdG9wIFNTICovCisJZGNzc193cml0ZWwoMCwgc3MtPmJhc2Vf
cmVnICsgRENTU19TU19TWVNfQ1RSTCk7CisKKwlpZiAoc3MtPmJhc2VfcmVnKQorCQlkZXZtX2lv
dW5tYXAoc3MtPmRldiwgc3MtPmJhc2VfcmVnKTsKKworCWRldm1fa2ZyZWUoc3MtPmRldiwgc3Mp
OworfQorCit2b2lkIGRjc3Nfc3Nfc3Vic2FtX3NldChzdHJ1Y3QgZGNzc19zcyAqc3MpCit7CisJ
ZGNzc19zc193cml0ZShzcywgMHg0MTYxNDE2MSwgRENTU19TU19DT0VGRik7CisJZGNzc19zc193
cml0ZShzcywgMCwgRENTU19TU19NT0RFKTsKKwlkY3NzX3NzX3dyaXRlKHNzLCAweDAzZmYwMDAw
LCBEQ1NTX1NTX0NMSVBfQ0IpOworCWRjc3Nfc3Nfd3JpdGUoc3MsIDB4MDNmZjAwMDAsIERDU1Nf
U1NfQ0xJUF9DUik7Cit9CisKK3ZvaWQgZGNzc19zc19zeW5jX3NldChzdHJ1Y3QgZGNzc19zcyAq
c3MsIHN0cnVjdCB2aWRlb21vZGUgKnZtLAorCQkgICAgICBib29sIHBoc3luYywgYm9vbCBwdnN5
bmMpCit7CisJdTE2IGxyY194LCBscmNfeTsKKwl1MTYgaHN5bmNfc3RhcnQsIGhzeW5jX2VuZDsK
Kwl1MTYgdnN5bmNfc3RhcnQsIHZzeW5jX2VuZDsKKwl1MTYgZGVfdWxjX3gsIGRlX3VsY195Owor
CXUxNiBkZV9scmNfeCwgZGVfbHJjX3k7CisKKwlscmNfeCA9IHZtLT5oZnJvbnRfcG9yY2ggKyB2
bS0+aGJhY2tfcG9yY2ggKyB2bS0+aHN5bmNfbGVuICsKKwkJdm0tPmhhY3RpdmUgLSAxOworCWxy
Y195ID0gdm0tPnZmcm9udF9wb3JjaCArIHZtLT52YmFja19wb3JjaCArIHZtLT52c3luY19sZW4g
KworCQl2bS0+dmFjdGl2ZSAtIDE7CisKKwlkY3NzX3NzX3dyaXRlKHNzLCAobHJjX3kgPDwgTFJD
X1lfUE9TKSB8IGxyY194LCBEQ1NTX1NTX0RJU1BMQVkpOworCisJaHN5bmNfc3RhcnQgPSB2bS0+
aGZyb250X3BvcmNoICsgdm0tPmhiYWNrX3BvcmNoICsgdm0tPmhzeW5jX2xlbiArCisJCSAgICAg
IHZtLT5oYWN0aXZlIC0gMTsKKwloc3luY19lbmQgPSB2bS0+aHN5bmNfbGVuIC0gMTsKKworCWRj
c3Nfc3Nfd3JpdGUoc3MsIChwaHN5bmMgPyBTWU5DX1BPTCA6IDApIHwKKwkJICAgICAgKCh1MzIp
aHN5bmNfZW5kIDw8IFNZTkNfRU5EX1BPUykgfCBoc3luY19zdGFydCwKKwkJICAgICAgRENTU19T
U19IU1lOQyk7CisKKwl2c3luY19zdGFydCA9IHZtLT52ZnJvbnRfcG9yY2ggLSAxOworCXZzeW5j
X2VuZCA9IHZtLT52ZnJvbnRfcG9yY2ggKyB2bS0+dnN5bmNfbGVuIC0gMTsKKworCWRjc3Nfc3Nf
d3JpdGUoc3MsIChwdnN5bmMgPyBTWU5DX1BPTCA6IDApIHwKKwkJICAgICAgKCh1MzIpdnN5bmNf
ZW5kIDw8IFNZTkNfRU5EX1BPUykgfCB2c3luY19zdGFydCwKKwkJICAgICAgRENTU19TU19WU1lO
Qyk7CisKKwlkZV91bGNfeCA9IHZtLT5oc3luY19sZW4gKyB2bS0+aGJhY2tfcG9yY2ggLSAxOwor
CWRlX3VsY195ID0gdm0tPnZzeW5jX2xlbiArIHZtLT52ZnJvbnRfcG9yY2ggKyB2bS0+dmJhY2tf
cG9yY2g7CisKKwlkY3NzX3NzX3dyaXRlKHNzLCBTWU5DX1BPTCB8ICgodTMyKWRlX3VsY195IDw8
IFVMQ19ZX1BPUykgfCBkZV91bGNfeCwKKwkJICAgICAgRENTU19TU19ERV9VTEMpOworCisJZGVf
bHJjX3ggPSB2bS0+aHN5bmNfbGVuICsgdm0tPmhiYWNrX3BvcmNoICsgdm0tPmhhY3RpdmUgLSAx
OworCWRlX2xyY195ID0gdm0tPnZzeW5jX2xlbiArIHZtLT52ZnJvbnRfcG9yY2ggKyB2bS0+dmJh
Y2tfcG9yY2ggKworCQkgICB2bS0+dmFjdGl2ZSAtIDE7CisKKwlkY3NzX3NzX3dyaXRlKHNzLCAo
ZGVfbHJjX3kgPDwgTFJDX1lfUE9TKSB8IGRlX2xyY194LCBEQ1NTX1NTX0RFX0xSQyk7Cit9CisK
K3ZvaWQgZGNzc19zc19lbmFibGUoc3RydWN0IGRjc3Nfc3MgKnNzKQoreworCWRjc3Nfc3Nfd3Jp
dGUoc3MsIFJVTl9FTiwgRENTU19TU19TWVNfQ1RSTCk7CisJc3MtPmluX3VzZSA9IHRydWU7Cit9
CisKK3ZvaWQgZGNzc19zc19kaXNhYmxlKHN0cnVjdCBkY3NzX3NzICpzcykKK3sKKwlkY3NzX3Nz
X3dyaXRlKHNzLCAwLCBEQ1NTX1NTX1NZU19DVFJMKTsKKwlzcy0+aW5fdXNlID0gZmFsc2U7Cit9
Ci0tIAoyLjcuNAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
