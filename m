Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 88B3D103ADF
	for <lists+dri-devel@lfdr.de>; Wed, 20 Nov 2019 14:18:14 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8DF2F6E5CC;
	Wed, 20 Nov 2019 13:18:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x343.google.com (mail-wm1-x343.google.com
 [IPv6:2a00:1450:4864:20::343])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E3A656E5A0;
 Wed, 20 Nov 2019 13:18:04 +0000 (UTC)
Received: by mail-wm1-x343.google.com with SMTP id 8so7811278wmo.0;
 Wed, 20 Nov 2019 05:18:04 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=5AyiyGHIsGZmGFALOHZp007SolgJkXUVWP34NIek/X8=;
 b=PjbwWW2ibGRUs0tZFHq50ViSCZQM04l+Zj6D86Z43YOidHmT2ycsS64aDDuN64eRSA
 v9FLtnegcSBBUCjPc+4VmUbsdqjIER2rKUB7l0Xxgk6T4ZehN4XoC0/TUg31pYI+KTvL
 D/B99uH9KbmAgy1z4U3vcA8ks2+JNmc28awUE1J40fla34F93T9w0+Zt+Y0OZB7ohOve
 af9ZPWeJBipWPOsy9Xv6ILE76Oo81Vc/o9bfGfuGIeifl5iWKCkhvsrFJ/wBw+OZv4mK
 WNtlVqchm8mlNzM7x5W2RtOxvXvjMktIujADkkOVjLxJFVnSf1xwI8gGgwL+oAU9xOwV
 Vu/A==
X-Gm-Message-State: APjAAAUspfhcoZPZxwdhLuhvGlu4oStxuY0jh8NRY0yAfMxBApFJK+AL
 TddqjPMwuc/XwbJyAo1QewI=
X-Google-Smtp-Source: APXvYqy93dqU4VcLZ6ZKB4Y+sP2ZdAH5K/+PbQOE63bngO9JdLfIXPlxfRTGrWQgYoDN84MYax3IyA==
X-Received: by 2002:a1c:ca:: with SMTP id 193mr3171932wma.103.1574255883436;
 Wed, 20 Nov 2019 05:18:03 -0800 (PST)
Received: from laptop.fritz.box ([2a02:908:1252:fb60:be8a:bd56:1f94:86e7])
 by smtp.gmail.com with ESMTPSA id 4sm6726498wmd.33.2019.11.20.05.18.02
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 20 Nov 2019 05:18:02 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: imirkin@alum.mit.edu, skeggsb@gmail.com, airlied@linux.ie,
 nouveau@lists.freedesktop.org, dri-devel@lists.freedesktop.org
Subject: [PATCH 1/2] drm/nouveau: move io_reserve_lru handling into the driver
Date: Wed, 20 Nov 2019 14:17:50 +0100
Message-Id: <20191120131751.15904-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191120131751.15904-1-christian.koenig@amd.com>
References: <20191120131751.15904-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=5AyiyGHIsGZmGFALOHZp007SolgJkXUVWP34NIek/X8=;
 b=rQMLjSvtvqmRSpg14P2qhKXlhGkHKdD9TU6eYO2OVMEMx5DbZSvDTs3Up64z2XWLly
 DWmlrNXfGwIWZEmD710D33XiOATkBnKPDKSiebag+iza6X2QWC6t8stCKBo3B/DuYOfk
 XWTKELAwJJQeUnPZps5Cs3UhHxo5UCdLpBWdxuJ7H1KSl+7/l/EqqdnixAhpXN8WnZKH
 J8xXKfuGb3XowuAog5IR+Ko5y78QI4eBEzhs8X4pzlJzv7cqmdCUT/35Fc/V1+sltpbp
 xrqZXEbXwJ5qnXTv6WGIBiD7OfCts2GYOHvPk0kuWn5RaLd75sefWpkJTsXL3VXfcjDV
 h+VA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2tvZW5pZy5sZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+
CgpXaGlsZSB3b3JraW5nIG9uIFRUTSBjbGVhbnVwcyBJJ3ZlIGZvdW5kIHRoYXQgdGhlIGlvX3Jl
c2VydmVfbHJ1IHVzZWQgYnkKTm91dmVhdSBpcyBhY3R1YWxseSBub3Qgd29ya2luZyBhdCBhbGwu
CgpJbiBnZW5lcmFsIHdlIHNob3VsZCByZW1vdmUgZHJpdmVyIHNwZWNpZmljIGhhbmRsaW5nIGZy
b20gdGhlIG1lbW9yeQptYW5hZ2VtZW50LCBzbyB0aGlzIHBhdGNoIG1vdmVzIHRoZSBpb19yZXNl
cnZlX2xydSBoYW5kbGluZyBpbnRvIE5vdXZlYXUKaW5zdGVhZC4KClRoZSBwYXRjaCBzaG91bGQg
YmUgZnVuY3Rpb25hbCBjb3JyZWN0LCBidXQgaXMgb25seSBjb21waWxlIHRlc3RlZCEKClNpZ25l
ZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KQWNr
ZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICB8IDEwNiArKysrKysrKysrKysrKysrKysr
Ky0tLS0tLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oICB8ICAgMyArCiBk
cml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oIHwgICAyICsKIGRyaXZlcnMvZ3B1
L2RybS9ub3V2ZWF1L25vdXZlYXVfdHRtLmMgfCAgNDMgKysrKysrKysrKy0KIDQgZmlsZXMgY2hh
bmdlZCwgMTMwIGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfYm8uYwppbmRleCBmODAxNWUwMzE4ZDcuLmQxNDRjMjU1MGE2ZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYwpAQCAtMTM3LDYgKzEzNyw3IEBAIG5vdXZlYXVf
Ym9fZGVsX3R0bShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQogCXN0cnVjdCBub3V2ZWF1
X2JvICpudmJvID0gbm91dmVhdV9ibyhibyk7CiAKIAlXQVJOX09OKG52Ym8tPnBpbl9yZWZjbnQg
PiAwKTsKKwlub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xydShibyk7CiAJbnYxMF9ib19wdXRf
dGlsZV9yZWdpb24oZGV2LCBudmJvLT50aWxlLCBOVUxMKTsKIAogCS8qCkBAIC0zMDQsNiArMzA1
LDcgQEAgbm91dmVhdV9ib19pbml0KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1NjQgc2l6ZSwg
aW50IGFsaWduLCB1MzIgZmxhZ3MsCiAKIAludmJvLT5iby5tZW0ubnVtX3BhZ2VzID0gc2l6ZSA+
PiBQQUdFX1NISUZUOwogCW5vdXZlYXVfYm9fcGxhY2VtZW50X3NldChudmJvLCBmbGFncywgMCk7
CisJSU5JVF9MSVNUX0hFQUQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKIAogCXJldCA9IHR0bV9i
b19pbml0KG52Ym8tPmJvLmJkZXYsICZudmJvLT5ibywgc2l6ZSwgdHlwZSwKIAkJCSAgJm52Ym8t
PnBsYWNlbWVudCwgYWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsCkBAIC01NzQsNiArNTc2LDI2
IEBAIG5vdXZlYXVfYm9fc3luY19mb3JfY3B1KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvKQogCQkJ
CQlQQUdFX1NJWkUsIERNQV9GUk9NX0RFVklDRSk7CiB9CiAKK3ZvaWQgbm91dmVhdV9ib19hZGRf
aW9fcmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKK3sKKwlzdHJ1Y3Qg
bm91dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfYmRldihiby0+YmRldik7CisJc3RydWN0IG5vdXZl
YXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKKworCW11dGV4X2xvY2soJmRybS0+dHRtLmlv
X3Jlc2VydmVfbXV0ZXgpOworCWxpc3RfbW92ZV90YWlsKCZudmJvLT5pb19yZXNlcnZlX2xydSwg
JmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1KTsKKwltdXRleF91bmxvY2soJmRybS0+dHRtLmlvX3Jl
c2VydmVfbXV0ZXgpOworfQorCit2b2lkIG5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCit7CisJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0g
PSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYpOworCXN0cnVjdCBub3V2ZWF1X2JvICpudmJvID0gbm91
dmVhdV9ibyhibyk7CisKKwltdXRleF9sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsK
KwlsaXN0X2RlbF9pbml0KCZudmJvLT5pb19yZXNlcnZlX2xydSk7CisJbXV0ZXhfdW5sb2NrKCZk
cm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKK30KKwogaW50CiBub3V2ZWF1X2JvX3ZhbGlkYXRl
KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCBib29sIGludGVycnVwdGlibGUsCiAJCSAgICBib29s
IG5vX3dhaXRfZ3B1KQpAQCAtNjgyLDggKzcwNCw2IEBAIG5vdXZlYXVfYm9faW5pdF9tZW1fdHlw
ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwgdWludDMyX3QgdHlwZSwKIAkJCX0KIAogCQkJ
bWFuLT5mdW5jID0gJm5vdXZlYXVfdnJhbV9tYW5hZ2VyOwotCQkJbWFuLT5pb19yZXNlcnZlX2Zh
c3RwYXRoID0gZmFsc2U7Ci0JCQltYW4tPnVzZV9pb19yZXNlcnZlX2xydSA9IHRydWU7CiAJCX0g
ZWxzZSB7CiAJCQltYW4tPmZ1bmMgPSAmdHRtX2JvX21hbmFnZXJfZnVuYzsKIAkJfQpAQCAtMTMx
Miw2ICsxMzMyLDggQEAgbm91dmVhdV9ib19tb3ZlX250Znkoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywgYm9vbCBldmljdCwKIAlpZiAoYm8tPmRlc3Ryb3kgIT0gbm91dmVhdV9ib19kZWxf
dHRtKQogCQlyZXR1cm47CiAKKwlub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xydShibyk7CisK
IAlpZiAobWVtICYmIG5ld19yZWctPm1lbV90eXBlICE9IFRUTV9QTF9TWVNURU0gJiYKIAkgICAg
bWVtLT5tZW0ucGFnZSA9PSBudmJvLT5wYWdlKSB7CiAJCWxpc3RfZm9yX2VhY2hfZW50cnkodm1h
LCAmbnZiby0+dm1hX2xpc3QsIGhlYWQpIHsKQEAgLTE0MzQsNiArMTQ1NiwzMCBAQCBub3V2ZWF1
X2JvX3ZlcmlmeV9hY2Nlc3Moc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywgc3RydWN0IGZp
bGUgKmZpbHApCiAJCQkJCSAgZmlscC0+cHJpdmF0ZV9kYXRhKTsKIH0KIAorc3RhdGljIHZvaWQK
K25vdXZlYXVfdHRtX2lvX21lbV9mcmVlX2xvY2tlZChzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSwg
c3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCit7CisJc3RydWN0IG5vdXZlYXVfbWVtICptZW0gPSBu
b3V2ZWF1X21lbShyZWcpOworCisJaWYgKCFyZWctPmJ1cy5iYXNlKQorCQlyZXR1cm47IC8qIGFs
cmVhZHkgZnJlZWQgKi8KKworCWlmIChkcm0tPmNsaWVudC5tZW0tPm9jbGFzcyA+PSBOVklGX0NM
QVNTX01FTV9OVjUwKSB7CisJCXN3aXRjaCAocmVnLT5tZW1fdHlwZSkgeworCQljYXNlIFRUTV9Q
TF9UVDoKKwkJCWlmIChtZW0tPmtpbmQpCisJCQkJbnZpZl9vYmplY3RfdW5tYXBfaGFuZGxlKCZt
ZW0tPm1lbS5vYmplY3QpOworCQkJYnJlYWs7CisJCWNhc2UgVFRNX1BMX1ZSQU06CisJCQludmlm
X29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVjdCk7CisJCQlicmVhazsKKwkJZGVm
YXVsdDoKKwkJCWJyZWFrOworCQl9CisJfQorCXJlZy0+YnVzLmJhc2UgPSAwOworfQorCiBzdGF0
aWMgaW50CiBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCiB7CkBAIC0xNDQxLDE4ICsxNDg3LDI2IEBA
IG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBz
dHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IG5vdXZl
YXVfYmRldihiZGV2KTsKIAlzdHJ1Y3QgbnZrbV9kZXZpY2UgKmRldmljZSA9IG52eHhfZGV2aWNl
KCZkcm0tPmNsaWVudC5kZXZpY2UpOwogCXN0cnVjdCBub3V2ZWF1X21lbSAqbWVtID0gbm91dmVh
dV9tZW0ocmVnKTsKKwlzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibzsKKwlpbnQgcmV0OworCisJaWYg
KHJlZy0+YnVzLmJhc2UpCisJCXJldHVybiAwOyAvKiBhbHJlYWR5IG1hcHBlZCAqLwogCiAJcmVn
LT5idXMuYWRkciA9IE5VTEw7CiAJcmVnLT5idXMub2Zmc2V0ID0gMDsKIAlyZWctPmJ1cy5zaXpl
ID0gcmVnLT5udW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKLQlyZWctPmJ1cy5iYXNlID0gMDsKIAly
ZWctPmJ1cy5pc19pb21lbSA9IGZhbHNlOwogCWlmICghKG1hbi0+ZmxhZ3MgJiBUVE1fTUVNVFlQ
RV9GTEFHX01BUFBBQkxFKSkKIAkJcmV0dXJuIC1FSU5WQUw7CisKKwltdXRleF9sb2NrKCZkcm0t
PnR0bS5pb19yZXNlcnZlX211dGV4KTsKK3JldHJ5OgogCXN3aXRjaCAocmVnLT5tZW1fdHlwZSkg
ewogCWNhc2UgVFRNX1BMX1NZU1RFTToKIAkJLyogU3lzdGVtIG1lbW9yeSAqLwotCQlyZXR1cm4g
MDsKKwkJcmV0ID0gMDsKKwkJZ290byBvdXQ7CiAJY2FzZSBUVE1fUExfVFQ6CiAjaWYgSVNfRU5B
QkxFRChDT05GSUdfQUdQKQogCQlpZiAoZHJtLT5hZ3AuYnJpZGdlKSB7CkBAIC0xNDc2LDcgKzE1
MzAsNiBAQCBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAq
YmRldiwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCiAJCQl9IGFyZ3M7CiAJCQl1NjQgaGFuZGxl
LCBsZW5ndGg7CiAJCQl1MzIgYXJnYyA9IDA7Ci0JCQlpbnQgcmV0OwogCiAJCQlzd2l0Y2ggKG1l
bS0+bWVtLm9iamVjdC5vY2xhc3MpIHsKIAkJCWNhc2UgTlZJRl9DTEFTU19NRU1fTlY1MDoKQEAg
LTE1MDAsMzggKzE1NTMsNDUgQEAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0
bV9ib19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQogCQkJcmV0ID0gbnZp
Zl9vYmplY3RfbWFwX2hhbmRsZSgmbWVtLT5tZW0ub2JqZWN0LAogCQkJCQkJICAgICAmYXJncywg
YXJnYywKIAkJCQkJCSAgICAgJmhhbmRsZSwgJmxlbmd0aCk7Ci0JCQlpZiAocmV0ICE9IDEpCi0J
CQkJcmV0dXJuIHJldCA/IHJldCA6IC1FSU5WQUw7CisJCQlpZiAocmV0ICE9IDEpIHsKKwkJCQly
ZXQgPSByZXQgPyByZXQgOiAtRUlOVkFMOworCQkJCWdvdG8gb3V0OworCQkJfQorCQkJcmV0ID0g
MDsKIAogCQkJcmVnLT5idXMuYmFzZSA9IDA7CiAJCQlyZWctPmJ1cy5vZmZzZXQgPSBoYW5kbGU7
CiAJCX0KIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJcmV0dXJuIC1FSU5WQUw7CisJCXJldCA9IC1F
SU5WQUw7CiAJfQotCXJldHVybiAwOworCitvdXQ6CisJaWYgKHJldCA9PSAtRUFHQUlOKSB7CisJ
CW52Ym8gPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1
LAorCQkJCQkJdHlwZW9mKCpudmJvKSwKKwkJCQkJCWlvX3Jlc2VydmVfbHJ1KTsKKwkJaWYgKG52
Ym8pIHsKKwkJCWxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKKwkJCXR0bV9i
b191bm1hcF92aXJ0dWFsKCZudmJvLT5ibyk7CisJCQlub3V2ZWF1X3R0bV9pb19tZW1fZnJlZV9s
b2NrZWQoZHJtLCAmbnZiby0+Ym8ubWVtKTsKKwkJCWdvdG8gcmV0cnk7CisJCX0KKworCX0KKwlt
dXRleF91bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworCXJldHVybiByZXQ7CiB9
CiAKIHN0YXRpYyB2b2lkCiBub3V2ZWF1X3R0bV9pb19tZW1fZnJlZShzdHJ1Y3QgdHRtX2JvX2Rl
dmljZSAqYmRldiwgc3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCiB7CiAJc3RydWN0IG5vdXZlYXVf
ZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYoYmRldik7Ci0Jc3RydWN0IG5vdXZlYXVfbWVtICptZW0g
PSBub3V2ZWF1X21lbShyZWcpOwogCi0JaWYgKGRybS0+Y2xpZW50Lm1lbS0+b2NsYXNzID49IE5W
SUZfQ0xBU1NfTUVNX05WNTApIHsKLQkJc3dpdGNoIChyZWctPm1lbV90eXBlKSB7Ci0JCWNhc2Ug
VFRNX1BMX1RUOgotCQkJaWYgKG1lbS0+a2luZCkKLQkJCQludmlmX29iamVjdF91bm1hcF9oYW5k
bGUoJm1lbS0+bWVtLm9iamVjdCk7Ci0JCQlicmVhazsKLQkJY2FzZSBUVE1fUExfVlJBTToKLQkJ
CW52aWZfb2JqZWN0X3VubWFwX2hhbmRsZSgmbWVtLT5tZW0ub2JqZWN0KTsKLQkJCWJyZWFrOwot
CQlkZWZhdWx0OgotCQkJYnJlYWs7Ci0JCX0KLQl9CisJbXV0ZXhfbG9jaygmZHJtLT50dG0uaW9f
cmVzZXJ2ZV9tdXRleCk7CisJbm91dmVhdV90dG1faW9fbWVtX2ZyZWVfbG9ja2VkKGRybSwgcmVn
KTsKKwltdXRleF91bmxvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwogfQogCiBzdGF0
aWMgaW50CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgKaW5kZXggMzhmOWQ4MzUwOTYz
Li5jNDdmY2RmODBhZGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfYm8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgKQEAgLTE3
LDYgKzE3LDcgQEAgc3RydWN0IG5vdXZlYXVfYm8gewogCWJvb2wgZm9yY2VfY29oZXJlbnQ7CiAJ
c3RydWN0IHR0bV9ib19rbWFwX29iaiBrbWFwOwogCXN0cnVjdCBsaXN0X2hlYWQgaGVhZDsKKwlz
dHJ1Y3QgbGlzdF9oZWFkIGlvX3Jlc2VydmVfbHJ1OwogCiAJLyogcHJvdGVjdGVkIGJ5IHR0bV9i
b19yZXNlcnZlKCkgKi8KIAlzdHJ1Y3QgZHJtX2ZpbGUgKnJlc2VydmVkX2J5OwpAQCAtOTIsNiAr
OTMsOCBAQCBpbnQgIG5vdXZlYXVfYm9fdmFsaWRhdGUoc3RydWN0IG5vdXZlYXVfYm8gKiwgYm9v
bCBpbnRlcnJ1cHRpYmxlLAogCQkJIGJvb2wgbm9fd2FpdF9ncHUpOwogdm9pZCBub3V2ZWF1X2Jv
X3N5bmNfZm9yX2RldmljZShzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibyk7CiB2b2lkIG5vdXZlYXVf
Ym9fc3luY19mb3JfY3B1KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvKTsKK3ZvaWQgbm91dmVhdV9i
b19hZGRfaW9fcmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibyk7Cit2b2lk
IG5vdXZlYXVfYm9fZGVsX2lvX3Jlc2VydmVfbHJ1KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8pOwogCiAvKiBUT0RPOiBzdWJtaXQgZXF1aXZhbGVudCB0byBUVE0gZ2VuZXJpYyBBUEkgdXBz
dHJlYW0/ICovCiBzdGF0aWMgaW5saW5lIHZvaWQgX19pb21lbSAqCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL25vdXZl
YXUvbm91dmVhdV9kcnYuaAppbmRleCBkYThjNDZlMDk5NDMuLmNkMTljOGNlNTkzOSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oCkBAIC0xNTgsNiArMTU4LDggQEAgc3RydWN0
IG5vdXZlYXVfZHJtIHsKIAkJaW50IHR5cGVfdnJhbTsKIAkJaW50IHR5cGVfaG9zdFsyXTsKIAkJ
aW50IHR5cGVfbmNvaFsyXTsKKwkJc3RydWN0IG11dGV4IGlvX3Jlc2VydmVfbXV0ZXg7CisJCXN0
cnVjdCBsaXN0X2hlYWQgaW9fcmVzZXJ2ZV9scnU7CiAJfSB0dG07CiAKIAkvKiBHRU0gaW50ZXJm
YWNlIHN1cHBvcnQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jCmluZGV4IDc3
YTBjNmFkM2NlZi4uNTA1MThiNDhlOWI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
dHRtLmMKQEAgLTE2MiwxMyArMTYyLDUxIEBAIGNvbnN0IHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFu
YWdlcl9mdW5jIG52MDRfZ2FydF9tYW5hZ2VyID0gewogCS5kZWJ1ZyA9IG5vdXZlYXVfbWFuYWdl
cl9kZWJ1ZwogfTsKIAorc3RhdGljIHZtX2ZhdWx0X3Qgbm91dmVhdV90dG1fZmF1bHQoc3RydWN0
IHZtX2ZhdWx0ICp2bWYpCit7CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZt
YTsKKwlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gdm1hLT52bV9wcml2YXRlX2RhdGE7
CisJcGdwcm90X3QgcHJvdDsKKwl2bV9mYXVsdF90IHJldDsKKworCXJldCA9IHR0bV9ib192bV9y
ZXNlcnZlKGJvLCB2bWYpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlub3V2ZWF1X2Jv
X2RlbF9pb19yZXNlcnZlX2xydShibyk7CisKKwlwcm90ID0gdm1fZ2V0X3BhZ2VfcHJvdCh2bWEt
PnZtX2ZsYWdzKTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1mLCBwcm90LCBU
VE1fQk9fVk1fTlVNX1BSRUZBVUxUKTsKKwlpZiAocmV0ID09IFZNX0ZBVUxUX1JFVFJZICYmICEo
dm1mLT5mbGFncyAmIEZBVUxUX0ZMQUdfUkVUUllfTk9XQUlUKSkKKwkJcmV0dXJuIHJldDsKKwor
CW5vdXZlYXVfYm9fYWRkX2lvX3Jlc2VydmVfbHJ1KGJvKTsKKworCWRtYV9yZXN2X3VubG9jayhi
by0+YmFzZS5yZXN2KTsKKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qgdm1fb3Bl
cmF0aW9uc19zdHJ1Y3Qgbm91dmVhdV90dG1fdm1fb3BzID0geworCS5mYXVsdCA9IG5vdXZlYXVf
dHRtX2ZhdWx0LAorCS5vcGVuID0gdHRtX2JvX3ZtX29wZW4sCisJLmNsb3NlID0gdHRtX2JvX3Zt
X2Nsb3NlLAorCS5hY2Nlc3MgPSB0dG1fYm9fdm1fYWNjZXNzCit9OworCiBpbnQKIG5vdXZlYXVf
dHRtX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQog
ewogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2ID0gZmlscC0+cHJpdmF0ZV9kYXRhOwogCXN0
cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9kcm0oZmlsZV9wcml2LT5taW5vci0+ZGV2
KTsKKwlpbnQgcmV0OwogCi0JcmV0dXJuIHR0bV9ib19tbWFwKGZpbHAsIHZtYSwgJmRybS0+dHRt
LmJkZXYpOworCXJldCA9IHR0bV9ib19tbWFwKGZpbHAsIHZtYSwgJmRybS0+dHRtLmJkZXYpOwor
CWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwl2bWEtPnZtX29wcyA9ICZub3V2ZWF1X3R0bV92
bV9vcHM7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQKQEAgLTI3Myw2ICszMTEsOSBAQCBu
b3V2ZWF1X3R0bV9pbml0KHN0cnVjdCBub3V2ZWF1X2RybSAqZHJtKQogCQlyZXR1cm4gcmV0Owog
CX0KIAorCW11dGV4X2luaXQoJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOworCUlOSVRfTElT
VF9IRUFEKCZkcm0tPnR0bS5pb19yZXNlcnZlX2xydSk7CisKIAlOVl9JTkZPKGRybSwgIlZSQU06
ICVkIE1pQlxuIiwgKHUzMikoZHJtLT5nZW0udnJhbV9hdmFpbGFibGUgPj4gMjApKTsKIAlOVl9J
TkZPKGRybSwgIkdBUlQ6ICVkIE1pQlxuIiwgKHUzMikoZHJtLT5nZW0uZ2FydF9hdmFpbGFibGUg
Pj4gMjApKTsKIAlyZXR1cm4gMDsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
