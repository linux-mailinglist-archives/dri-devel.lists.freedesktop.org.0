Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 62A1F115431
	for <lists+dri-devel@lfdr.de>; Fri,  6 Dec 2019 16:27:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A28AF6FA3B;
	Fri,  6 Dec 2019 15:27:45 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM04-SN1-obe.outbound.protection.outlook.com
 (mail-eopbgr700132.outbound.protection.outlook.com [40.107.70.132])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 135296E141
 for <dri-devel@lists.freedesktop.org>; Fri,  6 Dec 2019 11:33:29 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=nPrSzPwXiyEeNZaZTJ24wrEInMCtEqHrGOfEdpQqpLTUzLLkuYiYcSkZXnDJ0K9wIU8vw/562FxCTXMmiGc4XdfgazEDarV0PmxHXWiObBKyn05LNP26BO3rL6BNUfh4ZRifbIVrSu+rerCnx/9wrNecTRO+BRMWgGVV3MMK0keXeS1KPFvq1DSPzanKW32VUDlhhOIRhvq3wQJf6mWP4SBPohUrUbNEpzjHeKiBvHvtVYckn9wA7dEogUe92WekE0/QIHCY6upG4nwKpLU6jCG0SDq0/XaioiIjXzPfqpQ2X8GofLAZCx1ceJrBj74RPBNEScbUzQz5QG0n+KERgQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=jVBxUvKYpmg+Cp7rFHpJJHvaJNKpSzy0jIKkCnqYXdA=;
 b=W3N3IpG6lsm2pMJZsj+jXOi2gH6mMLbxtaFMbfKdYL41CQreBSZzqnF6FlH9Y0WufPBGf0VQ4IrRa5ImQqLxk+qIiZu1dzJDd93PB9QrxmKAktM9LGeDRHujU7jdsnGgAu8LR+eH3JakVI6vnMANB4uBNne2v2BH+GDWMrMFW+YwNis+SFNk9Ymsi2E1XOW1l3HkZNKExeqtWSqfXnW1Q0cq/muFOtQflU4P/Fm5vz6ayJN9Wt9JsB1lab9kVIehEpwUNgJp7bOtwYoRgIe8ydOtp8yHVkfQutIUoagwZxsEgCSuQPuXWOxBtdvPEL4dmHQK2HTsmxVsWslofwNCzQ==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from BN8PR21MB1284.namprd21.prod.outlook.com (20.179.74.150) by
 BN8PR21MB1234.namprd21.prod.outlook.com (20.179.73.222) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2538.1; Fri, 6 Dec 2019 11:33:27 +0000
Received: from BN8PR21MB1284.namprd21.prod.outlook.com
 ([fe80::6138:f167:f1e4:fd6e]) by BN8PR21MB1284.namprd21.prod.outlook.com
 ([fe80::6138:f167:f1e4:fd6e%3]) with mapi id 15.20.2538.005; Fri, 6 Dec 2019
 11:33:26 +0000
From: Wei Hu <weh@microsoft.com>
To: b.zolnierkie@samsung.com, kys@microsoft.com, haiyangz@microsoft.com,
 sthemmin@microsoft.com, sashal@kernel.org, hch@lst.de,
 m.szyprowski@samsung.com, mchehab+samsung@kernel.org, sam@ravnborg.org,
 gregkh@linuxfoundation.org, alexandre.belloni@bootlin.com, info@metux.net,
 arnd@arndb.de, dri-devel@lists.freedesktop.org,
 linux-fbdev@vger.kernel.org, linux-kernel@vger.kernel.org,
 linux-hyperv@vger.kernel.org, decui@microsoft.com, mikelley@microsoft.com
Subject: [PATCH v3] video: hyperv: hyperv_fb: Use physical memory for fb on
 HyperV Gen 1 VMs.
Date: Fri,  6 Dec 2019 19:32:20 +0800
Message-Id: <20191206113220.1849-1-weh@microsoft.com>
X-Mailer: git-send-email 2.20.1
X-ClientProxiedBy: SG2PR01CA0103.apcprd01.prod.exchangelabs.com
 (2603:1096:3:15::29) To BN8PR21MB1284.namprd21.prod.outlook.com
 (2603:10b6:408:a2::22)
MIME-Version: 1.0
Received: from weh-g1-u1904d-testwin10.corp.microsoft.com (167.220.255.49) by
 SG2PR01CA0103.apcprd01.prod.exchangelabs.com (2603:1096:3:15::29) with
 Microsoft SMTP Server (version=TLS1_2, cipher=) via Frontend Transport;
 Fri, 6 Dec 2019 11:33:19 +0000
X-Mailer: git-send-email 2.20.1
X-Originating-IP: [167.220.255.49]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: 9721ed2a-1c83-4e9f-15a9-08d77a401be4
X-MS-TrafficTypeDiagnostic: BN8PR21MB1234:|BN8PR21MB1234:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <BN8PR21MB1234A25D8633C1A55769F466BB5F0@BN8PR21MB1234.namprd21.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:3173;
X-Forefront-PRVS: 0243E5FD68
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10019020)(346002)(366004)(39860400002)(396003)(136003)(376002)(189003)(199004)(51416003)(52116002)(186003)(26005)(25786009)(956004)(2616005)(16526019)(7696005)(50226002)(10090500001)(10290500003)(22452003)(66946007)(66476007)(66556008)(478600001)(305945005)(5660300002)(316002)(6636002)(7416002)(86362001)(3450700001)(2906002)(22746008)(30864003)(14444005)(6486002)(2870700001)(48376002)(50466002)(8936002)(81166006)(81156014)(1250700005)(8676002)(36756003)(54906003)(6666004)(4326008)(1076003)(43066004)(921003)(1121003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:BN8PR21MB1234;
 H:BN8PR21MB1284.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
Received-SPF: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: cNNdb/GF5Etn3c1UNJxnpLtps9VXKd+4O7CkjIQQTwggvmmiKnFPgA0UdMCu1ZliMrx07HLIEhHSmn3oM64ImzsyvTh24lowYuK5v7ACgIB6uXbhtXwM3J7fKyls6ZRM7xBvblG5fD8qHLKmPVxxqJA0H26bIiuqCi081PKzznJsTpvYvicbdoa2df5NSgLzdIoTUnCka4ocFWVNDrC4l0PIMxBXIkrBTxATzU/8mPRLY6F/zzA6pLpr9fTN+a1S8phJgBd9C1xXA4PYoG12TRT7OCMfP6jOTN6AiDi6C3Mk/geS3xdMXQFPpDWbihXW6AqFe00cFmJr4pxRaBoNCKtjTQ5Qixt8xwwvoMyEhU/r12UPV70kL94XX9HeJ/PaHIzTNAtcTbi/JNVcdKjF5DsMCsLOqQ4If+NdHVd1zq5E15J8bs9n1sQYktM8xgoA+95249kePEMjtloWHGRHBeDMzw8YtQFhwq1obdBUMYPL7ftxMpp5/e+sHhvIVAqv
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 9721ed2a-1c83-4e9f-15a9-08d77a401be4
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 06 Dec 2019 11:33:26.4960 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: S7V5197AMqNMOMxyaLclrVeeE4mkFgQOepg45VCNAYDW99EyYlniI8R9uTO1heeeL4ehxgrO4IFQNk3U5POBFA==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BN8PR21MB1234
X-Mailman-Approved-At: Fri, 06 Dec 2019 15:27:44 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=jVBxUvKYpmg+Cp7rFHpJJHvaJNKpSzy0jIKkCnqYXdA=;
 b=EZV9uh+fu0zoZv4zRk9SQL7kr9g9cDxMYmHKYC1WNREqAbGfikbB3ghQP5H4nNmT+dUm+4AYkJtkzmfFPoQBOS9x64NdTFBJjP+usxuuWZG6YvxxI1oMZhpsxmLFtFr27aP1GQ4gxCrsna4fp4uUYyOVWY9p5aUw7NLweol4QJ8=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: weh@microsoft.com
Cc: Wei Hu <weh@microsoft.com>, kbuild test robot <lkp@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gSHlwZXItViwgR2VuZXJhdGlvbiAxIFZNcyBjYW4gZGlyZWN0bHkgdXNlIFZNJ3MgcGh5c2lj
YWwgbWVtb3J5IGZvcgp0aGVpciBmcmFtZWJ1ZmZlcnMuIFRoaXMgY2FuIGltcHJvdmUgdGhlIGVm
ZmljaWVuY3kgb2YgZnJhbWVidWZmZXIgYW5kCm92ZXJhbGwgcGVyZm9ybWVuY2UgZm9yIFZNLiBU
aGUgcGh5c2ljYWwgbWVtb3J5IGFzc2lnbmVkIHRvIGZyYW1lYnVmZmVyCm11c3QgYmUgY29udGln
dW91cy4gV2UgdXNlIENNQSBhbGxvY2F0b3IgdG8gZ2V0IGNvbnRpZ3VvdXNlIHBoeXNpY2lhbApt
ZW1vcnkgd2hlbiB0aGUgZnJhbWVidWZmZXIgc2l6ZSBpcyBncmVhdGVyIHRoYW4gNE1CLiBGb3Ig
c2l6ZSB1bmRlcgo0TUIsIHdlIHVzZSBhbGxvY19wYWdlcyB0byBhY2hpZXZlIHRoaXMuCgpUbyBl
bmFibGUgZnJhbWVidWZmZXIgbWVtb3J5IGFsbG9jYXRpb24gZnJvbSBDTUEsIHN1cHBseSBhIGtl
cm5lbApwYXJhbWV0ZXIgdG8gZ2l2ZSBlbm91Z2ggc3BhY2UgdG8gQ01BIGFsbG9jYXRvciBhdCBi
b290IHRpbWUuIEZvcgpleGFtcGxlOgogICAgY21hPTEzMG0KVGhpcyBnaXZlcyAxMzBNQiBtZW1v
cnkgdG8gQ0FNIGFsbG9jYXRvciB0aGF0IGNhbiBiZSBhbGxvY2F0ZWQgdG8KZnJhbWVidWZmZXIu
IElmIHRoaXMgZmFpbHMsIHdlIGZhbGwgYmFjayB0byB0aGUgb2xkIHdheSBvZiB1c2luZwptbWlv
IGZvciBmcmFtZWJ1ZmZlci4KClJlcG9ydGVkLWJ5OiBrYnVpbGQgdGVzdCByb2JvdCA8bGtwQGlu
dGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogV2VpIEh1IDx3ZWhAbWljcm9zb2Z0LmNvbT4KLS0tCiAg
ICB2MjogSW5jb3Jwb3JhdGVkIHJldmlldyBjb21tZW50cyBmb3JtIGhjaEBsc3QuZGUsIE1pY2hh
ZWwgS2VsbGV5IGFuZAogICAgRGV4dWFuIEN1aQogICAgLSBVc2UgZG1hX2FsbG9jX2NvaGVyZW50
IHRvIGFsbG9jYXRlIGxhcmdlIGNvbnRpZ3VvdXMgbWVtb3J5CiAgICAtIFVzZSBwaHlzX2FkZHJf
dCBmb3IgcGh5c2ljYWwgYWRkcmVzc2VzCiAgICAtIENvcnJlY3RlZCBhIGZldyBzcGVsbGluZyBl
cnJvcnMgYW5kIG1pbm9yIGNsZWFudXBzCiAgICAtIEFsc28gdGVzdGVkIG9uIDMyIGJpdCBVYnVu
dHUgZ3Vlc3QKICAgIHYzOiBGaXhlZCBhIGJ1aWxkIGlzc3VlIHJlcG9ydGVkIGJ5IGtidWlsZCB0
ZXN0IHJvYm90IGFuZCBpbmNvcnBvcnRlZAogICAgc29tZSByZXZpZXcgY29tbWVudHMgZnJvbSBN
aWNoYWVsIEtlbGxleQogICAgLSBBZGQgQ01BIGNoZWNrIHRvIGF2b2lkIGxpbmsgZmFpbHVyZQog
ICAgLSBGaXhlZCBzbWFsbCBtZW1vcnkgbGVhayBpbnRyb2R1Y2VkIGJ5IGFsbG9jX2FwZXJ0dXJl
cwogICAgLSBDbGVhbmVkIHVwIHNvIGNvZGUKCiBkcml2ZXJzL3ZpZGVvL2ZiZGV2L0tjb25maWcg
ICAgIHwgICAxICsKIGRyaXZlcnMvdmlkZW8vZmJkZXYvaHlwZXJ2X2ZiLmMgfCAxODcgKysrKysr
KysrKysrKysrKysrKysrKysrKy0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMTQ5IGluc2VydGlv
bnMoKyksIDM5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vZmJkZXYv
S2NvbmZpZyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZpZwppbmRleCBhYTk1NDFiZjk2NGIu
LmY2NTk5MWE2N2FmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy92aWRlby9mYmRldi9LY29uZmlnCisr
KyBiL2RyaXZlcnMvdmlkZW8vZmJkZXYvS2NvbmZpZwpAQCAtMjIxNSw2ICsyMjE1LDcgQEAgY29u
ZmlnIEZCX0hZUEVSVgogCXNlbGVjdCBGQl9DRkJfQ09QWUFSRUEKIAlzZWxlY3QgRkJfQ0ZCX0lN
QUdFQkxJVAogCXNlbGVjdCBGQl9ERUZFUlJFRF9JTworCXNlbGVjdCBETUFfQ01BIGlmIEhBVkVf
RE1BX0NPTlRJR1VPVVMgJiYgQ01BCiAJaGVscAogCSAgVGhpcyBmcmFtZWJ1ZmZlciBkcml2ZXIg
c3VwcG9ydHMgTWljcm9zb2Z0IEh5cGVyLVYgU3ludGhldGljIFZpZGVvLgogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jIGIvZHJpdmVycy92aWRlby9mYmRldi9o
eXBlcnZfZmIuYwppbmRleCAzZjYwYjdiYzg1ODkuLjdkZmY4MmM3NzU1MSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2
L2h5cGVydl9mYi5jCkBAIC0zMSw2ICszMSwxNiBAQAogICogInNldC12bXZpZGVvIiBjb21tYW5k
LiBGb3IgZXhhbXBsZQogICogICAgIHNldC12bXZpZGVvIC12bW5hbWUgbmFtZSAtaG9yaXpvbnRh
bHJlc29sdXRpb246MTkyMCBcCiAgKiAtdmVydGljYWxyZXNvbHV0aW9uOjEyMDAgLXJlc29sdXRp
b250eXBlIHNpbmdsZQorICoKKyAqIEdlbiAxIFZNcyBhbHNvIHN1cHBvcnQgZGlyZWN0IHVzaW5n
IFZNJ3MgcGh5c2ljYWwgbWVtb3J5IGZvciBmcmFtZWJ1ZmZlci4KKyAqIEl0IGNvdWxkIGltcHJv
dmUgdGhlIGVmZmljaWVuY3kgYW5kIHBlcmZvcm1hbmNlIGZvciBmcmFtZWJ1ZmZlciBhbmQgVk0u
CisgKiBUaGlzIHJlcXVpcmVzIHRvIGFsbG9jYXRlIGNvbnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5
IGZyb20gTGludXgga2VybmVsJ3MKKyAqIENNQSBtZW1vcnkgYWxsb2NhdG9yLiBUbyBlbmFibGUg
dGhpcywgc3VwcGx5IGEga2VybmVsIHBhcmFtZXRlciB0byBnaXZlCisgKiBlbm91Z2ggbWVtb3J5
IHNwYWNlIHRvIENNQSBhbGxvY2F0b3IgZm9yIGZyYW1lYnVmZmVyLiBGb3IgZXhhbXBsZToKKyAq
ICAgIGNtYT0xMzBtCisgKiBUaGlzIGdpdmVzIDEzME1CIG1lbW9yeSB0byBDTUEgYWxsb2NhdG9y
IHRoYXQgY2FuIGJlIGFsbG9jYXRlZCB0bworICogZnJhbWVidWZmZXIuIEZvciByZWZlcmVuY2Us
IDhLIHJlc29sdXRpb24gKDc2ODB4NDMyMCkgdGFrZXMgYWJvdXQKKyAqIDEyN01CIG1lbW9yeS4K
ICAqLwogCiAjZGVmaW5lIHByX2ZtdChmbXQpIEtCVUlMRF9NT0ROQU1FICI6ICIgZm10CkBAIC0y
MjcsNyArMjM3LDYgQEAgc3RydWN0IHN5bnRodmlkX21zZyB7CiB9IF9fcGFja2VkOwogCiAKLQog
LyogRkIgZHJpdmVyIGRlZmluaXRpb25zIGFuZCBzdHJ1Y3R1cmVzICovCiAjZGVmaW5lIEhWRkJf
V0lEVEggMTE1MiAvKiBkZWZhdWx0IHNjcmVlbiB3aWR0aCAqLwogI2RlZmluZSBIVkZCX0hFSUdI
VCA4NjQgLyogZGVmYXVsdCBzY3JlZW4gaGVpZ2h0ICovCkBAIC0yNTYsMTIgKzI2NSwxNSBAQCBz
dHJ1Y3QgaHZmYl9wYXIgewogCS8qIElmIHRydWUsIHRoZSBWU0Mgbm90aWZpZXMgdGhlIFZTUCBv
biBldmVyeSBmcmFtZWJ1ZmZlciBjaGFuZ2UgKi8KIAlib29sIHN5bmNocm9ub3VzX2ZiOwogCisJ
LyogSWYgdHJ1ZSwgbmVlZCB0byBjb3B5IGZyb20gZGVmZXJyZWQgSU8gbWVtIHRvIGZyYW1lYnVm
ZmVyIG1lbSAqLworCWJvb2wgbmVlZF9kb2NvcHk7CisKIAlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sg
aHZmYl9wYW5pY19uYjsKIAogCS8qIE1lbW9yeSBmb3IgZGVmZXJyZWQgSU8gYW5kIGZyYW1lIGJ1
ZmZlciBpdHNlbGYgKi8KIAl1bnNpZ25lZCBjaGFyICpkaW9fdnA7CiAJdW5zaWduZWQgY2hhciAq
bW1pb192cDsKLQl1bnNpZ25lZCBsb25nIG1taW9fcHA7CisJcGh5c19hZGRyX3QgbW1pb19wcDsK
IAogCS8qIERpcnR5IHJlY3RhbmdsZSwgcHJvdGVjdGVkIGJ5IGRlbGF5ZWRfcmVmcmVzaF9sb2Nr
ICovCiAJaW50IHgxLCB5MSwgeDIsIHkyOwpAQCAtNDMyLDcgKzQ0NCw3IEBAIHN0YXRpYyB2b2lk
IHN5bnRodmlkX2RlZmVycmVkX2lvKHN0cnVjdCBmYl9pbmZvICpwLAogCQltYXh5ID0gbWF4X3Qo
aW50LCBtYXh5LCB5Mik7CiAKIAkJLyogQ29weSBmcm9tIGRpbyBzcGFjZSB0byBtbWlvIGFkZHJl
c3MgKi8KLQkJaWYgKHBhci0+ZmJfcmVhZHkpCisJCWlmIChwYXItPmZiX3JlYWR5ICYmIHBhci0+
bmVlZF9kb2NvcHkpCiAJCQlodmZiX2RvY29weShwYXIsIHN0YXJ0LCBQQUdFX1NJWkUpOwogCX0K
IApAQCAtNzQ5LDEyICs3NjEsMTIgQEAgc3RhdGljIHZvaWQgaHZmYl91cGRhdGVfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKncpCiAJCXJldHVybjsKIAogCS8qIENvcHkgdGhlIGRpcnR5IHJlY3Rh
bmdsZSB0byBmcmFtZSBidWZmZXIgbWVtb3J5ICovCi0JZm9yIChqID0geTE7IGogPCB5Mjsgaisr
KSB7Ci0JCWh2ZmJfZG9jb3B5KHBhciwKLQkJCSAgICBqICogaW5mby0+Zml4LmxpbmVfbGVuZ3Ro
ICsKLQkJCSAgICAoeDEgKiBzY3JlZW5fZGVwdGggLyA4KSwKLQkJCSAgICAoeDIgLSB4MSkgKiBz
Y3JlZW5fZGVwdGggLyA4KTsKLQl9CisJaWYgKHBhci0+bmVlZF9kb2NvcHkpCisJCWZvciAoaiA9
IHkxOyBqIDwgeTI7IGorKykKKwkJCWh2ZmJfZG9jb3B5KHBhciwKKwkJCQkgICAgaiAqIGluZm8t
PmZpeC5saW5lX2xlbmd0aCArCisJCQkJICAgICh4MSAqIHNjcmVlbl9kZXB0aCAvIDgpLAorCQkJ
CSAgICAoeDIgLSB4MSkgKiBzY3JlZW5fZGVwdGggLyA4KTsKIAogCS8qIFJlZnJlc2ggKi8KIAlp
ZiAocGFyLT5mYl9yZWFkeSAmJiBwYXItPnVwZGF0ZSkKQEAgLTc5OSw3ICs4MTEsOCBAQCBzdGF0
aWMgaW50IGh2ZmJfb25fcGFuaWMoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwKIAlwYXIgPSBj
b250YWluZXJfb2YobmIsIHN0cnVjdCBodmZiX3BhciwgaHZmYl9wYW5pY19uYik7CiAJcGFyLT5z
eW5jaHJvbm91c19mYiA9IHRydWU7CiAJaW5mbyA9IHBhci0+aW5mbzsKLQlodmZiX2RvY29weShw
YXIsIDAsIGRpb19mYl9zaXplKTsKKwlpZiAocGFyLT5uZWVkX2RvY29weSkKKwkJaHZmYl9kb2Nv
cHkocGFyLCAwLCBkaW9fZmJfc2l6ZSk7CiAJc3ludGh2aWRfdXBkYXRlKGluZm8sIDAsIDAsIElO
VF9NQVgsIElOVF9NQVgpOwogCiAJcmV0dXJuIE5PVElGWV9ET05FOwpAQCAtOTM4LDYgKzk1MSw2
NyBAQCBzdGF0aWMgdm9pZCBodmZiX2dldF9vcHRpb24oc3RydWN0IGZiX2luZm8gKmluZm8pCiAJ
cmV0dXJuOwogfQogCisvKgorICogQWxsb2NhdGUgZW5vdWdoIGNvbnRpZ3VvdXMgcGh5c2ljYWwg
bWVtb3J5LgorICogUmV0dXJuIHBoeXNpY2FsIGFkZHJlc3MgaWYgc3VjY2VlZGVkIG9yIC0xIGlm
IGZhaWxlZC4KKyAqLworc3RhdGljIHBoeXNfYWRkcl90IGh2ZmJfZ2V0X3BoeW1lbShzdHJ1Y3Qg
aHZfZGV2aWNlICpoZGV2LAorCQkJCSAgIHVuc2lnbmVkIGludCByZXF1ZXN0X3NpemUpCit7CisJ
c3RydWN0IHBhZ2UgKnBhZ2UgPSBOVUxMOworCWRtYV9hZGRyX3QgZG1hX2hhbmRsZTsKKwl2b2lk
ICp2bWVtOworCXVuc2lnbmVkIGludCByZXF1ZXN0X3BhZ2VzOworCXBoeXNfYWRkcl90IHBhZGRy
ID0gMDsKKwl1bnNpZ25lZCBpbnQgb3JkZXIgPSBnZXRfb3JkZXIocmVxdWVzdF9zaXplKTsKKwor
CWlmIChyZXF1ZXN0X3NpemUgPT0gMCkKKwkJcmV0dXJuIC0xOworCisJaWYgKG9yZGVyIDwgTUFY
X09SREVSKSB7CisJCS8qIENhbGwgYWxsb2NfcGFnZXMgaWYgdGhlIHNpemUgaXMgbGVzcyB0aGFu
IDJeTUFYX09SREVSICovCisJCXBhZ2UgPSBhbGxvY19wYWdlcyhHRlBfS0VSTkVMIHwgX19HRlBf
WkVSTywgb3JkZXIpOworCQlpZiAoIXBhZ2UpCisJCQlyZXR1cm4gLTE7CisKKwkJcGFkZHIgPSAo
cGFnZV90b19wZm4ocGFnZSkgPDwgUEFHRV9TSElGVCk7CisJCXJlcXVlc3RfcGFnZXMgPSAoMSA8
PCBvcmRlcik7CisJfSBlbHNlIHsKKwkJLyogQWxsb2NhdGUgZnJvbSBDTUEgKi8KKwkJaGRldi0+
ZGV2aWNlLmNvaGVyZW50X2RtYV9tYXNrID0gRE1BX0JJVF9NQVNLKDY0KTsKKworCQlyZXF1ZXN0
X3BhZ2VzID0gKHJvdW5kX3VwKHJlcXVlc3Rfc2l6ZSwgUEFHRV9TSVpFKSA+PgorCQkJCSBQQUdF
X1NISUZUKTsKKworCQl2bWVtID0gZG1hX2FsbG9jX2NvaGVyZW50KCZoZGV2LT5kZXZpY2UsCisJ
CQkJCSAgcmVxdWVzdF9wYWdlcyAqIFBBR0VfU0laRSwKKwkJCQkJICAmZG1hX2hhbmRsZSwKKwkJ
CQkJICBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKKworCQlpZiAoIXZtZW0pCisJCQlyZXR1
cm4gLTE7CisKKwkJcGFkZHIgPSB2aXJ0X3RvX3BoeXModm1lbSk7CisJfQorCisJcmV0dXJuIHBh
ZGRyOworfQorCisvKiBSZWxlYXNlIGNvbnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5ICovCitzdGF0
aWMgdm9pZCBodmZiX3JlbGVhc2VfcGh5bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsCisJCQkJ
cGh5c19hZGRyX3QgcGFkZHIsIHVuc2lnbmVkIGludCBzaXplKQoreworCXVuc2lnbmVkIGludCBv
cmRlciA9IGdldF9vcmRlcihzaXplKTsKKworCWlmIChvcmRlciA8IE1BWF9PUkRFUikKKwkJX19m
cmVlX3BhZ2VzKHBmbl90b19wYWdlKHBhZGRyID4+IFBBR0VfU0hJRlQpLCBvcmRlcik7CisJZWxz
ZQorCQlkbWFfZnJlZV9jb2hlcmVudCgmaGRldi0+ZGV2aWNlLAorCQkJCSAgcm91bmRfdXAoc2l6
ZSwgUEFHRV9TSVpFKSwKKwkJCQkgIHBoeXNfdG9fdmlydChwYWRkciksCisJCQkJICBwYWRkcik7
Cit9CisKIAogLyogR2V0IGZyYW1lYnVmZmVyIG1lbW9yeSBmcm9tIEh5cGVyLVYgdmlkZW8gcGNp
IHNwYWNlICovCiBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYs
IHN0cnVjdCBmYl9pbmZvICppbmZvKQpAQCAtOTQ3LDIyICsxMDIxLDYxIEBAIHN0YXRpYyBpbnQg
aHZmYl9nZXRtZW0oc3RydWN0IGh2X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8p
CiAJdm9pZCBfX2lvbWVtICpmYl92aXJ0OwogCWludCBnZW4ydm0gPSBlZmlfZW5hYmxlZChFRklf
Qk9PVCk7CiAJcmVzb3VyY2Vfc2l6ZV90IHBvdF9zdGFydCwgcG90X2VuZDsKKwlwaHlzX2FkZHJf
dCBwYWRkcjsKIAlpbnQgcmV0OwogCi0JZGlvX2ZiX3NpemUgPQotCQlzY3JlZW5fd2lkdGggKiBz
Y3JlZW5faGVpZ2h0ICogc2NyZWVuX2RlcHRoIC8gODsKKwlpbmZvLT5hcGVydHVyZXMgPSBhbGxv
Y19hcGVydHVyZXMoMSk7CisJaWYgKCFpbmZvLT5hcGVydHVyZXMpCisJCXJldHVybiAtRU5PTUVN
OwogCi0JaWYgKGdlbjJ2bSkgewotCQlwb3Rfc3RhcnQgPSAwOwotCQlwb3RfZW5kID0gLTE7Ci0J
fSBlbHNlIHsKKwlpZiAoIWdlbjJ2bSkgewogCQlwZGV2ID0gcGNpX2dldF9kZXZpY2UoUENJX1ZF
TkRPUl9JRF9NSUNST1NPRlQsCi0JCQkgICAgICBQQ0lfREVWSUNFX0lEX0hZUEVSVl9WSURFTywg
TlVMTCk7CisJCQlQQ0lfREVWSUNFX0lEX0hZUEVSVl9WSURFTywgTlVMTCk7CiAJCWlmICghcGRl
dikgewogCQkJcHJfZXJyKCJVbmFibGUgdG8gZmluZCBQQ0kgSHlwZXItViB2aWRlb1xuIik7CisJ
CQlrZnJlZShpbmZvLT5hcGVydHVyZXMpOwogCQkJcmV0dXJuIC1FTk9ERVY7CiAJCX0KIAorCQlp
bmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5iYXNlID0gcGNpX3Jlc291cmNlX3N0YXJ0KHBkZXYs
IDApOworCQlpbmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5zaXplID0gcGNpX3Jlc291cmNlX2xl
bihwZGV2LCAwKTsKKworCQkvKgorCQkgKiBGb3IgR2VuIDEgVk0sIHdlIGNhbiBkaXJlY3RseSB1
c2UgdGhlIGNvbnRpZ3VvdXMgbWVtb3J5CisJCSAqIGZyb20gVk0uIElmIHdlIHN1Y2NlZWQsIGRl
ZmVycmVkIElPIGhhcHBlbnMgZGlyZWN0bHkKKwkJICogb24gdGhpcyBhbGxvY2F0ZWQgZnJhbWVi
dWZmZXIgbWVtb3J5LCBhdm9pZGluZyBleHRyYQorCQkgKiBtZW1vcnkgY29weS4KKwkJICovCisJ
CXBhZGRyID0gaHZmYl9nZXRfcGh5bWVtKGhkZXYsIHNjcmVlbl9mYl9zaXplKTsKKwkJaWYgKHBh
ZGRyICE9IChwaHlzX2FkZHJfdCkgLTEpIHsKKwkJCXBhci0+bW1pb19wcCA9IHBhZGRyOworCQkJ
cGFyLT5tbWlvX3ZwID0gcGFyLT5kaW9fdnAgPSBfX3ZhKHBhZGRyKTsKKworCQkJaW5mby0+Zml4
LnNtZW1fc3RhcnQgPSBwYWRkcjsKKwkJCWluZm8tPmZpeC5zbWVtX2xlbiA9IHNjcmVlbl9mYl9z
aXplOworCQkJaW5mby0+c2NyZWVuX2Jhc2UgPSBwYXItPm1taW9fdnA7CisJCQlpbmZvLT5zY3Jl
ZW5fc2l6ZSA9IHNjcmVlbl9mYl9zaXplOworCisJCQlwYXItPm5lZWRfZG9jb3B5ID0gZmFsc2U7
CisJCQlnb3RvIGdldG1lbV9kb25lOworCQl9CisJCXByX2luZm8oIlVuYWJsZSB0byBhbGxvY2F0
ZSBlbm91Z2ggY29udGlndW91cyBwaHlzaWNhbCBtZW1vcnkgb24gR2VuIDEgVk0uIFVzaW5nIE1N
SU8gaW5zdGVhZC5cbiIpOworCX0gZWxzZSB7CisJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBd
LmJhc2UgPSBzY3JlZW5faW5mby5sZmJfYmFzZTsKKwkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNb
MF0uc2l6ZSA9IHNjcmVlbl9pbmZvLmxmYl9zaXplOworCX0KKworCS8qCisJICogQ2Fubm90IHVz
ZSB0aGUgY29udGlndW91cyBwaHlzaWNhbCBtZW1vcnkuCisJICogQWxsb2NhdGUgbW1pbyBzcGFj
ZSBmb3IgZnJhbWVidWZmZXIuCisJICovCisJZGlvX2ZiX3NpemUgPQorCQlzY3JlZW5fd2lkdGgg
KiBzY3JlZW5faGVpZ2h0ICogc2NyZWVuX2RlcHRoIC8gODsKKworCWlmIChnZW4ydm0pIHsKKwkJ
cG90X3N0YXJ0ID0gMDsKKwkJcG90X2VuZCA9IC0xOworCX0gZWxzZSB7CiAJCWlmICghKHBjaV9y
ZXNvdXJjZV9mbGFncyhwZGV2LCAwKSAmIElPUkVTT1VSQ0VfTUVNKSB8fAogCQkgICAgcGNpX3Jl
c291cmNlX2xlbihwZGV2LCAwKSA8IHNjcmVlbl9mYl9zaXplKSB7CiAJCQlwcl9lcnIoIlJlc291
cmNlIG5vdCBhdmFpbGFibGUgb3IgKDB4JWx4IDwgMHglbHgpXG4iLApAQCAtOTkxLDIwICsxMTA0
LDYgQEAgc3RhdGljIGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1
Y3QgZmJfaW5mbyAqaW5mbykKIAlpZiAocGFyLT5kaW9fdnAgPT0gTlVMTCkKIAkJZ290byBlcnIz
OwogCi0JaW5mby0+YXBlcnR1cmVzID0gYWxsb2NfYXBlcnR1cmVzKDEpOwotCWlmICghaW5mby0+
YXBlcnR1cmVzKQotCQlnb3RvIGVycjQ7Ci0KLQlpZiAoZ2VuMnZtKSB7Ci0JCWluZm8tPmFwZXJ0
dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBzY3JlZW5faW5mby5sZmJfYmFzZTsKLQkJaW5mby0+YXBl
cnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHNjcmVlbl9pbmZvLmxmYl9zaXplOwotCQlyZW1vdmVf
Y29uZmxpY3RpbmdfZnJhbWVidWZmZXJzKGluZm8tPmFwZXJ0dXJlcywKLQkJCQkJCUtCVUlMRF9N
T0ROQU1FLCBmYWxzZSk7Ci0JfSBlbHNlIHsKLQkJaW5mby0+YXBlcnR1cmVzLT5yYW5nZXNbMF0u
YmFzZSA9IHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAwKTsKLQkJaW5mby0+YXBlcnR1cmVzLT5y
YW5nZXNbMF0uc2l6ZSA9IHBjaV9yZXNvdXJjZV9sZW4ocGRldiwgMCk7Ci0JfQotCiAJLyogUGh5
c2ljYWwgYWRkcmVzcyBvZiBGQiBkZXZpY2UgKi8KIAlwYXItPm1taW9fcHAgPSBwYXItPm1lbS0+
c3RhcnQ7CiAJLyogVmlydHVhbCBhZGRyZXNzIG9mIEZCIGRldmljZSAqLwpAQCAtMTAxNSwxMyAr
MTExNCwxNSBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYs
IHN0cnVjdCBmYl9pbmZvICppbmZvKQogCWluZm8tPnNjcmVlbl9iYXNlID0gcGFyLT5kaW9fdnA7
CiAJaW5mby0+c2NyZWVuX3NpemUgPSBkaW9fZmJfc2l6ZTsKIAorZ2V0bWVtX2RvbmU6CisJcmVt
b3ZlX2NvbmZsaWN0aW5nX2ZyYW1lYnVmZmVycyhpbmZvLT5hcGVydHVyZXMsCisJCQkJCUtCVUlM
RF9NT0ROQU1FLCBmYWxzZSk7CiAJaWYgKCFnZW4ydm0pCiAJCXBjaV9kZXZfcHV0KHBkZXYpOwor
CWtmcmVlKGluZm8tPmFwZXJ0dXJlcyk7CiAKIAlyZXR1cm4gMDsKIAotZXJyNDoKLQl2ZnJlZShw
YXItPmRpb192cCk7CiBlcnIzOgogCWlvdW5tYXAoZmJfdmlydCk7CiBlcnIyOgpAQCAtMTAzMCwx
OCArMTEzMSwyNSBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVtKHN0cnVjdCBodl9kZXZpY2UgKmhk
ZXYsIHN0cnVjdCBmYl9pbmZvICppbmZvKQogZXJyMToKIAlpZiAoIWdlbjJ2bSkKIAkJcGNpX2Rl
dl9wdXQocGRldik7CisJa2ZyZWUoaW5mby0+YXBlcnR1cmVzKTsKIAogCXJldHVybiAtRU5PTUVN
OwogfQogCiAvKiBSZWxlYXNlIHRoZSBmcmFtZWJ1ZmZlciAqLwotc3RhdGljIHZvaWQgaHZmYl9w
dXRtZW0oc3RydWN0IGZiX2luZm8gKmluZm8pCitzdGF0aWMgdm9pZCBodmZiX3B1dG1lbShzdHJ1
Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKIHsKIAlzdHJ1Y3QgaHZm
Yl9wYXIgKnBhciA9IGluZm8tPnBhcjsKIAotCXZmcmVlKHBhci0+ZGlvX3ZwKTsKLQlpb3VubWFw
KGluZm8tPnNjcmVlbl9iYXNlKTsKLQl2bWJ1c19mcmVlX21taW8ocGFyLT5tZW0tPnN0YXJ0LCBz
Y3JlZW5fZmJfc2l6ZSk7CisJaWYgKHBhci0+bmVlZF9kb2NvcHkpIHsKKwkJdmZyZWUocGFyLT5k
aW9fdnApOworCQlpb3VubWFwKGluZm8tPnNjcmVlbl9iYXNlKTsKKwkJdm1idXNfZnJlZV9tbWlv
KHBhci0+bWVtLT5zdGFydCwgc2NyZWVuX2ZiX3NpemUpOworCX0gZWxzZSB7CisJCWh2ZmJfcmVs
ZWFzZV9waHltZW0oaGRldiwgaW5mby0+Zml4LnNtZW1fc3RhcnQsCisJCQkJICAgIHNjcmVlbl9m
Yl9zaXplKTsKKwl9CisKIAlwYXItPm1lbSA9IE5VTEw7CiB9CiAKQEAgLTEwNjAsNiArMTE2OCw3
IEBAIHN0YXRpYyBpbnQgaHZmYl9wcm9iZShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LAogCXBhciA9
IGluZm8tPnBhcjsKIAlwYXItPmluZm8gPSBpbmZvOwogCXBhci0+ZmJfcmVhZHkgPSBmYWxzZTsK
KwlwYXItPm5lZWRfZG9jb3B5ID0gdHJ1ZTsKIAlpbml0X2NvbXBsZXRpb24oJnBhci0+d2FpdCk7
CiAJSU5JVF9ERUxBWUVEX1dPUksoJnBhci0+ZHdvcmssIGh2ZmJfdXBkYXRlX3dvcmspOwogCkBA
IC0xMTQ1LDcgKzEyNTQsNyBAQCBzdGF0aWMgaW50IGh2ZmJfcHJvYmUoc3RydWN0IGh2X2Rldmlj
ZSAqaGRldiwKIAogZXJyb3I6CiAJZmJfZGVmZXJyZWRfaW9fY2xlYW51cChpbmZvKTsKLQlodmZi
X3B1dG1lbShpbmZvKTsKKwlodmZiX3B1dG1lbShoZGV2LCBpbmZvKTsKIGVycm9yMjoKIAl2bWJ1
c19jbG9zZShoZGV2LT5jaGFubmVsKTsKIGVycm9yMToKQEAgLTExNzUsNyArMTI4NCw3IEBAIHN0
YXRpYyBpbnQgaHZmYl9yZW1vdmUoc3RydWN0IGh2X2RldmljZSAqaGRldikKIAl2bWJ1c19jbG9z
ZShoZGV2LT5jaGFubmVsKTsKIAlodl9zZXRfZHJ2ZGF0YShoZGV2LCBOVUxMKTsKIAotCWh2ZmJf
cHV0bWVtKGluZm8pOworCWh2ZmJfcHV0bWVtKGhkZXYsIGluZm8pOwogCWZyYW1lYnVmZmVyX3Jl
bGVhc2UoaW5mbyk7CiAKIAlyZXR1cm4gMDsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
