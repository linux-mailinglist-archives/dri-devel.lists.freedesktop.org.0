Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B6E07CC125D
	for <lists+dri-devel@lfdr.de>; Tue, 16 Dec 2025 07:41:12 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0D1D710E6DF;
	Tue, 16 Dec 2025 06:41:11 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from outboundhk.mxmail.xiaomi.com (outboundhk.mxmail.xiaomi.com
 [118.143.206.90])
 by gabe.freedesktop.org (Postfix) with ESMTP id 2ACD610E6DF
 for <dri-devel@lists.freedesktop.org>; Tue, 16 Dec 2025 06:41:08 +0000 (UTC)
X-CSE-ConnectionGUID: TdjibYHwTbO5khYp9UEbQw==
X-CSE-MsgGUID: DmJccR/WRliNtXzZA1qFrg==
X-IronPort-AV: E=Sophos;i="6.21,152,1763395200"; 
 d="scan'208,217";a="135612130"
From: =?gb2312?B?uN/P6A==?= <gaoxiang17@xiaomi.com>
To: Steven Rostedt <rostedt@goodmis.org>, Xiang Gao <gxxa03070307@gmail.com>
CC: "sumit.semwal@linaro.org" <sumit.semwal@linaro.org>,
 "christian.koenig@amd.com" <christian.koenig@amd.com>, "mhiramat@kernel.org"
 <mhiramat@kernel.org>, "linux-media@vger.kernel.org"
 <linux-media@vger.kernel.org>, "dri-devel@lists.freedesktop.org"
 <dri-devel@lists.freedesktop.org>, "linux-kernel@vger.kernel.org"
 <linux-kernel@vger.kernel.org>, "mathieu.desnoyers@efficios.com"
 <mathieu.desnoyers@efficios.com>, "dhowells@redhat.com"
 <dhowells@redhat.com>, "kuba@kernel.org" <kuba@kernel.org>,
 "brauner@kernel.org" <brauner@kernel.org>, "akpm@linux-foundation.org"
 <akpm@linux-foundation.org>, "linux-trace-kernel@vger.kernel.org"
 <linux-trace-kernel@vger.kernel.org>
Subject: =?gb2312?B?tPC4tDogW0V4dGVybmFsIE1haWxdUmU6IFtQQVRDSCB2NV0gZG1hLWJ1Zjog?=
 =?gb2312?Q?add_some_tracepoints_to_debug.?=
Thread-Topic: [External Mail]Re: [PATCH v5] dma-buf: add some tracepoints to
 debug.
Thread-Index: AQHcbgF3EVBvLPaE1kG96KYyCLsYgbUj0cXD
Date: Tue, 16 Dec 2025 06:40:47 +0000
Message-ID: <e1f5ca78e9d74d7e816afbfdb2f9383f@xiaomi.com>
References: <20251201112148.843572-1-gxxa03070307@gmail.com>,
 <20251215153031.1a5e6d9f@gandalf.local.home>
In-Reply-To: <20251215153031.1a5e6d9f@gandalf.local.home>
Accept-Language: zh-CN, en-US
Content-Language: zh-CN
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.237.8.166]
Content-Type: multipart/alternative;
 boundary="_000_e1f5ca78e9d74d7e816afbfdb2f9383fxiaomicom_"
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

--_000_e1f5ca78e9d74d7e816afbfdb2f9383fxiaomicom_
Content-Type: text/plain; charset="gb2312"
Content-Transfer-Encoding: base64

b2ssIHRoYW5rcy4NCg0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18NCreivP7Iyzog
U3RldmVuIFJvc3RlZHQgPHJvc3RlZHRAZ29vZG1pcy5vcmc+DQq3osvNyrG85DogMjAyNcTqMTLU
wjE2yNUgNDozMDozMQ0KytW8/sjLOiBYaWFuZyBHYW8NCrOty806IHN1bWl0LnNlbXdhbEBsaW5h
cm8ub3JnOyBjaHJpc3RpYW4ua29lbmlnQGFtZC5jb207IG1oaXJhbWF0QGtlcm5lbC5vcmc7IGxp
bnV4LW1lZGlhQHZnZXIua2VybmVsLm9yZzsgZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZzsgbGludXgta2VybmVsQHZnZXIua2VybmVsLm9yZzsgbWF0aGlldS5kZXNub3llcnNAZWZmaWNp
b3MuY29tOyBkaG93ZWxsc0ByZWRoYXQuY29tOyBrdWJhQGtlcm5lbC5vcmc7IGJyYXVuZXJAa2Vy
bmVsLm9yZzsgYWtwbUBsaW51eC1mb3VuZGF0aW9uLm9yZzsgbGludXgtdHJhY2Uta2VybmVsQHZn
ZXIua2VybmVsLm9yZzsguN/P6A0K1vfM4jogW0V4dGVybmFsIE1haWxdUmU6IFtQQVRDSCB2NV0g
ZG1hLWJ1ZjogYWRkIHNvbWUgdHJhY2Vwb2ludHMgdG8gZGVidWcuDQoNClvN4rK/08q8/l0gtMvT
yrz+wLTUtNPa0KHD17mry77N4rK/o6zH6733yfe0psDtoaPI9LbU08q8/rCyyKvQ1LTm0smjrMfr
vavTyrz+16q3orj4bWlzZWNAeGlhb21pLmNvbb340NC3tMChDQoNCk9uIE1vbiwgIDEgRGVjIDIw
MjUgMTk6MjE6NDggKzA4MDANClhpYW5nIEdhbyA8Z3h4YTAzMDcwMzA3QGdtYWlsLmNvbT4gd3Jv
dGU6DQoNCj4gLS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1idWYuYw0KPiArKysgYi9kcml2ZXJz
L2RtYS1idWYvZG1hLWJ1Zi5jDQo+IEBAIC0zNSw2ICszNSwxNyBAQA0KPg0KPiAgI2luY2x1ZGUg
ImRtYS1idWYtc3lzZnMtc3RhdHMuaCINCj4NCj4gKyNkZWZpbmUgQ1JFQVRFX1RSQUNFX1BPSU5U
Uw0KPiArI2luY2x1ZGUgPHRyYWNlL2V2ZW50cy9kbWFfYnVmLmg+DQo+ICsNCg0KRnJvbSBhIHRy
YWNpbmcgcG9pbnQgb2YgdmlldyBJJ20gT0sgd2l0aCB0aGlzIHBhdGNoLCBidXQgdGhpcyBtYWNy
byByZWFsbHkNCm5lZWRzIGEgY29tbWVudC4NCg0KLS0gU3RldmUNCg0KDQo+ICsjZGVmaW5lIERN
QV9CVUZfVFJBQ0UoRlVOQywgLi4uKSAgICAgICAgICAgICAgICAgIFwNCj4gKyAgICBkbyB7ICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXA0KPiArICAgICAgICBpZiAo
RlVOQyMjX2VuYWJsZWQoKSkgeyAgICAgICAgICAgICAgICAgICBcDQo+ICsgICAgICAgICAgICBn
dWFyZChzcGlubG9jaykoJmRtYWJ1Zi0+bmFtZV9sb2NrKTsgXA0KPiArICAgICAgICAgICAgRlVO
QyhfX1ZBX0FSR1NfXyk7ICAgICAgICAgICAgICAgICAgICBcDQo+ICsgICAgICAgIH0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwNCj4gKyAgICB9IHdoaWxlICgwKQ0K
PiArDQo+ICBzdGF0aWMgaW5saW5lIGludCBpc19kbWFfYnVmX2ZpbGUoc3RydWN0IGZpbGUgKik7
DQo+DQo+ICBzdGF0aWMgREVGSU5FX01VVEVYKGRtYWJ1Zl9saXN0X211dGV4KTsNCg==

--_000_e1f5ca78e9d74d7e816afbfdb2f9383fxiaomicom_
Content-Type: text/html; charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<html>
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dgb2312">
<meta name=3D"Generator" content=3D"Microsoft Exchange Server">
<!-- converted from text --><style><!-- .EmailQuote { margin-left: 1pt; pad=
ding-left: 4pt; border-left: #800000 2px solid; } --></style>
</head>
<body>
<meta content=3D"text/html; charset=3DUTF-8">
<style type=3D"text/css" style=3D"">
<!--
p
	{margin-top:0;
	margin-bottom:0}
-->
</style>
<div dir=3D"ltr">
<div id=3D"x_divtagdefaultwrapper" dir=3D"ltr" style=3D"font-size:12pt; col=
or:#000000; font-family:Calibri,Helvetica,sans-serif">
<p>ok, thanks.</p>
</div>
<hr tabindex=3D"-1" style=3D"display:inline-block; width:98%">
<div id=3D"x_divRplyFwdMsg" dir=3D"ltr"><font face=3D"Calibri, sans-serif" =
color=3D"#000000" style=3D"font-size:11pt"><b>=B7=A2=BC=FE=C8=CB:</b> Steve=
n Rostedt &lt;rostedt@goodmis.org&gt;<br>
<b>=B7=A2=CB=CD=CA=B1=BC=E4:</b> 2025=C4=EA12=D4=C216=C8=D5 4:30:31<br>
<b>=CA=D5=BC=FE=C8=CB:</b> Xiang Gao<br>
<b>=B3=AD=CB=CD:</b> sumit.semwal@linaro.org; christian.koenig@amd.com; mhi=
ramat@kernel.org; linux-media@vger.kernel.org; dri-devel@lists.freedesktop.=
org; linux-kernel@vger.kernel.org; mathieu.desnoyers@efficios.com; dhowells=
@redhat.com; kuba@kernel.org; brauner@kernel.org;
 akpm@linux-foundation.org; linux-trace-kernel@vger.kernel.org; =B8=DF=CF=
=E8<br>
<b>=D6=F7=CC=E2:</b> [External Mail]Re: [PATCH v5] dma-buf: add some tracep=
oints to debug.</font>
<div>&nbsp;</div>
</div>
</div>
<font size=3D"2"><span style=3D"font-size:10pt;">
<div class=3D"PlainText">[=CD=E2=B2=BF=D3=CA=BC=FE] =B4=CB=D3=CA=BC=FE=C0=
=B4=D4=B4=D3=DA=D0=A1=C3=D7=B9=AB=CB=BE=CD=E2=B2=BF=A3=AC=C7=EB=BD=F7=C9=F7=
=B4=A6=C0=ED=A1=A3=C8=F4=B6=D4=D3=CA=BC=FE=B0=B2=C8=AB=D0=D4=B4=E6=D2=C9=A3=
=AC=C7=EB=BD=AB=D3=CA=BC=FE=D7=AA=B7=A2=B8=F8misec@xiaomi.com=BD=F8=D0=D0=
=B7=B4=C0=A1<br>
<br>
On Mon,&nbsp; 1 Dec 2025 19:21:48 &#43;0800<br>
Xiang Gao &lt;gxxa03070307@gmail.com&gt; wrote:<br>
<br>
&gt; --- a/drivers/dma-buf/dma-buf.c<br>
&gt; &#43;&#43;&#43; b/drivers/dma-buf/dma-buf.c<br>
&gt; @@ -35,6 &#43;35,17 @@<br>
&gt;<br>
&gt;&nbsp; #include &quot;dma-buf-sysfs-stats.h&quot;<br>
&gt;<br>
&gt; &#43;#define CREATE_TRACE_POINTS<br>
&gt; &#43;#include &lt;trace/events/dma_buf.h&gt;<br>
&gt; &#43;<br>
<br>
From a tracing point of view I'm OK with this patch, but this macro really<=
br>
needs a comment.<br>
<br>
-- Steve<br>
<br>
<br>
&gt; &#43;#define DMA_BUF_TRACE(FUNC, ...)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp; do {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (FUNC##_enabled()) =
{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
; guard(spinlock)(&amp;dmabuf-&gt;name_lock); \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
; FUNC(__VA_ARGS__);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \<br>
&gt; &#43;&nbsp;&nbsp;&nbsp; } while (0)<br>
&gt; &#43;<br>
&gt;&nbsp; static inline int is_dma_buf_file(struct file *);<br>
&gt;<br>
&gt;&nbsp; static DEFINE_MUTEX(dmabuf_list_mutex);<br>
</div>
</span></font>
</body>
</html>

--_000_e1f5ca78e9d74d7e816afbfdb2f9383fxiaomicom_--
