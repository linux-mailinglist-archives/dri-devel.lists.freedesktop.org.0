Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B10D849221
	for <lists+dri-devel@lfdr.de>; Mon, 17 Jun 2019 23:10:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 47E8F6E0AF;
	Mon, 17 Jun 2019 21:10:07 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A9A496E0A8
 for <dri-devel@lists.freedesktop.org>; Mon, 17 Jun 2019 21:10:00 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id 5C0BD1214;
 Mon, 17 Jun 2019 23:09:55 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart+renesas@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 08/10] drm: rcar-du: Create a group state object
Date: Tue, 18 Jun 2019 00:09:28 +0300
Message-Id: <20190617210930.6054-9-laurent.pinchart+renesas@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190617210930.6054-1-laurent.pinchart+renesas@ideasonboard.com>
References: <20190617210930.6054-1-laurent.pinchart+renesas@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1560805795;
 bh=9+4lq48kdImzthdq8AWckVweuhz7cyiVN6FcUM/eefM=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=QiAdtR4Dm2w5oaL0uzrfMmVFyDXD27RyPtW633k2akbJFrLuOg6qxx3ZIHxvbo9zf
 G7jH2DiPAGJTVz7dNry0+UW/+KVM+cmWfnSlCXygRqWRoxs/2MkTb63r1LQ594hdKE
 NbgO0gWRA9uw1cQyNwVbxhd9lknujOd7bzB+F0Mc=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-renesas-soc@vger.kernel.org,
 Kieran Bingham <kieran.bingham@ideasonboard.com>, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogS2llcmFuIEJpbmdoYW0gPGtpZXJhbi5iaW5naGFtK3JlbmVzYXNAaWRlYXNvbmJvYXJk
LmNvbT4KCkNyZWF0ZSBhIG5ldyBwcml2YXRlIHN0YXRlIG9iamVjdCBmb3IgdGhlIERVIGdyb3Vw
cywgYW5kIG1vdmUgdGhlCmluaXRpYWxpc2F0aW9uIG9mIGEgZ3JvdXAgb2JqZWN0IHRvIGEgbmV3
IGZ1bmN0aW9uIHJjYXJfZHVfZ3JvdXBfaW5pdCgpLgoKU2lnbmVkLW9mZi1ieTogS2llcmFuIEJp
bmdoYW0gPGtpZXJhbi5iaW5naGFtK3JlbmVzYXNAaWRlYXNvbmJvYXJkLmNvbT4KU2lnbmVkLW9m
Zi1ieTogTGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydCtyZW5lc2FzQGlkZWFzb25i
b2FyZC5jb20+Ci0tLQpDaGFuZ2VzIHNpbmNlIHYyOgoKLSBDYWxsIG11dGV4X2Rlc3Ryb3koKSB3
aGVuIGNsZWFuaW5nIHVwIHRoZSBncm91cAotIEluY2x1ZGUgbXV0ZXguaCBhbmQgc2xhYi5oCi0g
U3F1YXNoICJkcm06IHJjYXItZHU6IEFkZCByY2FyX2R1X2dldF97b2xkLG5ld31fZ3JvdXBfc3Rh
dGUoKSIKLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3VwLmMgfCAxNDQg
KysrKysrKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2dyb3VwLmggfCAgMjkgKysrKysKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21z
LmMgICB8ICAyNyArLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAxNzcgaW5zZXJ0aW9ucygrKSwgMjMg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9k
dV9ncm91cC5jIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9ncm91cC5jCmluZGV4
IDllZWU0Nzk2OWU3Ny4uOGUxMmJkNDI4OTBlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
cmNhci1kdS9yY2FyX2R1X2dyb3VwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNh
cl9kdV9ncm91cC5jCkBAIC0yNSw2ICsyNSwxMSBAQAogCiAjaW5jbHVkZSA8bGludXgvY2xrLmg+
CiAjaW5jbHVkZSA8bGludXgvaW8uaD4KKyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisKKyNpbmNs
dWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX3N0YXRlX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CiAKICNpbmNsdWRlICJyY2FyX2R1
X2Rydi5oIgogI2luY2x1ZGUgInJjYXJfZHVfZ3JvdXAuaCIKQEAgLTM1MSwzICszNTYsMTQyIEBA
IGludCByY2FyX2R1X2dyb3VwX3NldF9yb3V0aW5nKHN0cnVjdCByY2FyX2R1X2dyb3VwICpyZ3Jw
KQogCiAJcmV0dXJuIHJjYXJfZHVfc2V0X2RwYWQwX3ZzcDFfcm91dGluZyhyZ3JwLT5kZXYpOwog
fQorCisvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogR3JvdXAgU3RhdGUgSGFuZGxpbmcKKyAq
LworCitzdGF0aWMgc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICoKK3JjYXJfZHVfZ3JvdXBfYXRv
bWljX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpvYmopCit7CisJc3Ry
dWN0IHJjYXJfZHVfZ3JvdXBfc3RhdGUgKnN0YXRlOworCisJaWYgKFdBUk5fT04oIW9iai0+c3Rh
dGUpKQorCQlyZXR1cm4gTlVMTDsKKworCXN0YXRlID0ga3phbGxvYyhzaXplb2YoKnN0YXRlKSwg
R0ZQX0tFUk5FTCk7CisJaWYgKHN0YXRlID09IE5VTEwpCisJCXJldHVybiBOVUxMOworCisJX19k
cm1fYXRvbWljX2hlbHBlcl9wcml2YXRlX29ial9kdXBsaWNhdGVfc3RhdGUob2JqLCAmc3RhdGUt
PnN0YXRlKTsKKworCXJldHVybiAmc3RhdGUtPnN0YXRlOworfQorCitzdGF0aWMgdm9pZCByY2Fy
X2R1X2dyb3VwX2F0b21pY19kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogKm9i
aiwKKwkJCQkJICAgICAgIHN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSAqc3RhdGUpCit7CisJa2Zy
ZWUodG9fcmNhcl9ncm91cF9zdGF0ZShzdGF0ZSkpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9wcml2YXRlX3N0YXRlX2Z1bmNzIHJjYXJfZHVfZ3JvdXBfc3RhdGVfZnVuY3MgPSB7CisJ
LmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSByY2FyX2R1X2dyb3VwX2F0b21pY19kdXBsaWNhdGVf
c3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gcmNhcl9kdV9ncm91cF9hdG9taWNfZGVz
dHJveV9zdGF0ZSwKK307CisKKy8qKgorICogcmNhcl9kdV9nZXRfb2xkX2dyb3VwX3N0YXRlIC0g
Z2V0IG9sZCBncm91cCBzdGF0ZSwgaWYgaXQgZXhpc3RzCisgKiBAc3RhdGU6IGdsb2JhbCBhdG9t
aWMgc3RhdGUgb2JqZWN0CisgKiBAcmdycDogZ3JvdXAgdG8gZ3JhYgorICoKKyAqIFRoaXMgZnVu
Y3Rpb24gcmV0dXJucyB0aGUgb2xkIGdyb3VwIHN0YXRlIGZvciB0aGUgZ2l2ZW4gZ3JvdXAsIG9y
CisgKiBOVUxMIGlmIHRoZSBncm91cCBpcyBub3QgcGFydCBvZiB0aGUgZ2xvYmFsIGF0b21pYyBz
dGF0ZS4KKyAqLworc3RydWN0IHJjYXJfZHVfZ3JvdXBfc3RhdGUgKgorcmNhcl9kdV9nZXRfb2xk
X2dyb3VwX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgICBzdHJ1
Y3QgcmNhcl9kdV9ncm91cCAqcmdycCkKK3sKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpvYmog
PSAmcmdycC0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKnBzdGF0ZTsKKwl1
bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBzdGF0ZS0+bnVtX3ByaXZhdGVfb2Jq
czsgaSsrKSB7CisJCWlmIChvYmogPT0gc3RhdGUtPnByaXZhdGVfb2Jqc1tpXS5wdHIpIHsKKwkJ
CXBzdGF0ZSA9IHN0YXRlLT5wcml2YXRlX29ianNbaV0ub2xkX3N0YXRlOworCQkJcmV0dXJuIHRv
X3JjYXJfZ3JvdXBfc3RhdGUocHN0YXRlKTsKKwkJfQorCX0KKworCXJldHVybiBOVUxMOworfQor
CisvKioKKyAqIHJjYXJfZHVfZ2V0X25ld19ncm91cF9zdGF0ZSAtIGdldCBuZXcgZ3JvdXAgc3Rh
dGUsIGlmIGl0IGV4aXN0cworICogQHN0YXRlOiBnbG9iYWwgYXRvbWljIHN0YXRlIG9iamVjdAor
ICogQHJncnA6IGdyb3VwIHRvIGdyYWIKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgdGhl
IG5ldyBncm91cCBzdGF0ZSBmb3IgdGhlIGdpdmVuIGdyb3VwLCBvcgorICogTlVMTCBpZiB0aGUg
Z3JvdXAgaXMgbm90IHBhcnQgb2YgdGhlIGdsb2JhbCBhdG9taWMgc3RhdGUuCisgKi8KK3N0cnVj
dCByY2FyX2R1X2dyb3VwX3N0YXRlICoKK3JjYXJfZHVfZ2V0X25ld19ncm91cF9zdGF0ZShzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkgICAgc3RydWN0IHJjYXJfZHVfZ3JvdXAg
KnJncnApCit7CisJc3RydWN0IGRybV9wcml2YXRlX29iaiAqb2JqID0gJnJncnAtPnByaXZhdGU7
CisJc3RydWN0IGRybV9wcml2YXRlX3N0YXRlICpwc3RhdGU7CisJdW5zaWduZWQgaW50IGk7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgc3RhdGUtPm51bV9wcml2YXRlX29ianM7IGkrKykgeworCQlpZiAo
b2JqID09IHN0YXRlLT5wcml2YXRlX29ianNbaV0ucHRyKSB7CisJCQlwc3RhdGUgPSBzdGF0ZS0+
cHJpdmF0ZV9vYmpzW2ldLm5ld19zdGF0ZTsKKwkJCXJldHVybiB0b19yY2FyX2dyb3VwX3N0YXRl
KHBzdGF0ZSk7CisJCX0KKwl9CisKKwlyZXR1cm4gTlVMTDsKK30KKworLyogLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0KKyAqIEluaXQgYW5kIENsZWFudXAKKyAqLworCisvKgorICogcmNhcl9kdV9ncm91
cF9pbml0IC0gSW5pdGlhbGlzZSBhbmQgcmVzZXQgYSBncm91cCBvYmplY3QKKyAqCisgKiBSZXR1
cm4gMCBpbiBjYXNlIG9mIHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG90aGVyd2lz
ZS4KKyAqLworaW50IHJjYXJfZHVfZ3JvdXBfaW5pdChzdHJ1Y3QgcmNhcl9kdV9kZXZpY2UgKnJj
ZHUsIHN0cnVjdCByY2FyX2R1X2dyb3VwICpyZ3JwLAorCQkgICAgICAgdW5zaWduZWQgaW50IGlu
ZGV4KQoreworCXN0YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQgbW1pb19vZmZzZXRzW10gPSB7CisJ
CURVMF9SRUdfT0ZGU0VULCBEVTJfUkVHX09GRlNFVAorCX07CisKKwlzdHJ1Y3QgcmNhcl9kdV9n
cm91cF9zdGF0ZSAqc3RhdGU7CisKKwlzdGF0ZSA9IGt6YWxsb2Moc2l6ZW9mKCpzdGF0ZSksIEdG
UF9LRVJORUwpOworCWlmICghc3RhdGUpCisJCXJldHVybiAtRU5PTUVNOworCisJZHJtX2F0b21p
Y19wcml2YXRlX29ial9pbml0KHJjZHUtPmRkZXYsICZyZ3JwLT5wcml2YXRlLCAmc3RhdGUtPnN0
YXRlLAorCQkJCSAgICAmcmNhcl9kdV9ncm91cF9zdGF0ZV9mdW5jcyk7CisKKwltdXRleF9pbml0
KCZyZ3JwLT5sb2NrKTsKKworCXJncnAtPmRldiA9IHJjZHU7CisJcmdycC0+bW1pb19vZmZzZXQg
PSBtbWlvX29mZnNldHNbaW5kZXhdOworCXJncnAtPmluZGV4ID0gaW5kZXg7CisJLyogRXh0cmFj
dCB0aGUgY2hhbm5lbCBtYXNrIGZvciB0aGlzIGdyb3VwIG9ubHkuICovCisJcmdycC0+Y2hhbm5l
bHNfbWFzayA9IChyY2R1LT5pbmZvLT5jaGFubmVsc19tYXNrID4+ICgyICogaW5kZXgpKQorCQkJ
ICAgICYgR0VOTUFTSygxLCAwKTsKKwlyZ3JwLT5udW1fY3J0Y3MgPSBod2VpZ2h0OChyZ3JwLT5j
aGFubmVsc19tYXNrKTsKKworCS8qCisJICogSWYgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIENSVEMg
aW4gdGhpcyBncm91cCBwcmUtYXNzb2NpYXRlCisJICogdGhlIGxvdy1vcmRlciBwbGFuZXMgd2l0
aCBDUlRDIDAgYW5kIHRoZSBoaWdoLW9yZGVyIHBsYW5lcworCSAqIHdpdGggQ1JUQyAxIHRvIG1p
bmltaXplIGZsaWNrZXIgb2NjdXJyaW5nIHdoZW4gdGhlCisJICogYXNzb2NpYXRpb24gaXMgY2hh
bmdlZC4KKwkgKi8KKwlyZ3JwLT5kcHRzcl9wbGFuZXMgPSByZ3JwLT5udW1fY3J0Y3MgPiAxCisJ
CQkgICA/IChyY2R1LT5pbmZvLT5nZW4gPj0gMyA/IDB4MDQgOiAweGYwKQorCQkJICAgOiAwOwor
CisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgcmNhcl9kdV9ncm91cF9jbGVhbnVwKHN0cnVjdCByY2Fy
X2R1X2dyb3VwICpyZ3JwKQoreworCW11dGV4X2Rlc3Ryb3koJnJncnAtPmxvY2spOworCisJZHJt
X2F0b21pY19wcml2YXRlX29ial9maW5pKCZyZ3JwLT5wcml2YXRlKTsKK30KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfZ3JvdXAuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9yY2FyLWR1L3JjYXJfZHVfZ3JvdXAuaAppbmRleCA4Nzk1MGMxZjZhNTIuLmY5OTYxZjg5ZmQ5
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9ncm91cC5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfZ3JvdXAuaApAQCAtMTIsMTIgKzEy
LDE1IEBACiAKICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogCisjaW5jbHVkZSA8ZHJtL2RybV9h
dG9taWMuaD4KKwogI2luY2x1ZGUgInJjYXJfZHVfcGxhbmUuaCIKIAogc3RydWN0IHJjYXJfZHVf
ZGV2aWNlOwogCiAvKgogICogc3RydWN0IHJjYXJfZHVfZ3JvdXAgLSBDUlRDcyBhbmQgcGxhbmVz
IGdyb3VwCisgKiBAcHJpdmF0ZTogVGhlIGJhc2UgZHJtIHByaXZhdGUgb2JqZWN0CiAgKiBAZGV2
OiB0aGUgRFUgZGV2aWNlCiAgKiBAbW1pb19vZmZzZXQ6IHJlZ2lzdGVycyBvZmZzZXQgaW4gdGhl
IGRldmljZSBtZW1vcnkgbWFwCiAgKiBAaW5kZXg6IGdyb3VwIGluZGV4CkBAIC0zMiw2ICszNSw4
IEBAIHN0cnVjdCByY2FyX2R1X2RldmljZTsKICAqIEBuZWVkX3Jlc3RhcnQ6IHRoZSBncm91cCBu
ZWVkcyB0byBiZSByZXN0YXJ0ZWQgZHVlIHRvIGEgY29uZmlndXJhdGlvbiBjaGFuZ2UKICAqLwog
c3RydWN0IHJjYXJfZHVfZ3JvdXAgeworCXN0cnVjdCBkcm1fcHJpdmF0ZV9vYmogcHJpdmF0ZTsK
KwogCXN0cnVjdCByY2FyX2R1X2RldmljZSAqZGV2OwogCXVuc2lnbmVkIGludCBtbWlvX29mZnNl
dDsKIAl1bnNpZ25lZCBpbnQgaW5kZXg7CkBAIC00OSw2ICs1NCwxOSBAQCBzdHJ1Y3QgcmNhcl9k
dV9ncm91cCB7CiAJYm9vbCBuZWVkX3Jlc3RhcnQ7CiB9OwogCisjZGVmaW5lIHRvX3JjYXJfZ3Jv
dXAocykgY29udGFpbmVyX29mKHMsIHN0cnVjdCByY2FyX2R1X2dyb3VwLCBwcml2YXRlKQorCisv
KioKKyAqIHN0cnVjdCByY2FyX2R1X2dyb3VwX3N0YXRlIC0gRHJpdmVyLXNwZWNpZmljIGdyb3Vw
IHN0YXRlCisgKiBAc3RhdGU6IGJhc2UgRFJNIHByaXZhdGUgc3RhdGUKKyAqLworc3RydWN0IHJj
YXJfZHVfZ3JvdXBfc3RhdGUgeworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSBzdGF0ZTsKK307
CisKKyNkZWZpbmUgdG9fcmNhcl9ncm91cF9zdGF0ZShzKSBcCisJY29udGFpbmVyX29mKHMsIHN0
cnVjdCByY2FyX2R1X2dyb3VwX3N0YXRlLCBzdGF0ZSkKKwogdTMyIHJjYXJfZHVfZ3JvdXBfcmVh
ZChzdHJ1Y3QgcmNhcl9kdV9ncm91cCAqcmdycCwgdTMyIHJlZyk7CiB2b2lkIHJjYXJfZHVfZ3Jv
dXBfd3JpdGUoc3RydWN0IHJjYXJfZHVfZ3JvdXAgKnJncnAsIHUzMiByZWcsIHUzMiBkYXRhKTsK
IApAQCAtNjAsNCArNzgsMTUgQEAgaW50IHJjYXJfZHVfZ3JvdXBfc2V0X3JvdXRpbmcoc3RydWN0
IHJjYXJfZHVfZ3JvdXAgKnJncnApOwogCiBpbnQgcmNhcl9kdV9zZXRfZHBhZDBfdnNwMV9yb3V0
aW5nKHN0cnVjdCByY2FyX2R1X2RldmljZSAqcmNkdSk7CiAKK3N0cnVjdCByY2FyX2R1X2dyb3Vw
X3N0YXRlICoKK3JjYXJfZHVfZ2V0X29sZF9ncm91cF9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUsCisJCQkgICAgc3RydWN0IHJjYXJfZHVfZ3JvdXAgKnJncnApOworc3RydWN0
IHJjYXJfZHVfZ3JvdXBfc3RhdGUgKgorcmNhcl9kdV9nZXRfbmV3X2dyb3VwX3N0YXRlKHN0cnVj
dCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgICBzdHJ1Y3QgcmNhcl9kdV9ncm91cCAq
cmdycCk7CisKK2ludCByY2FyX2R1X2dyb3VwX2luaXQoc3RydWN0IHJjYXJfZHVfZGV2aWNlICpy
Y2R1LCBzdHJ1Y3QgcmNhcl9kdV9ncm91cCAqcmdycCwKKwkJICAgICAgIHVuc2lnbmVkIGludCBp
bmRleCk7Cit2b2lkIHJjYXJfZHVfZ3JvdXBfY2xlYW51cChzdHJ1Y3QgcmNhcl9kdV9ncm91cCAq
cmdycCk7CisKICNlbmRpZiAvKiBfX1JDQVJfRFVfR1JPVVBfSF9fICovCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jIGIvZHJpdmVycy9ncHUvZHJtL3Jj
YXItZHUvcmNhcl9kdV9rbXMuYwppbmRleCBjMDQxMzY2NzRlNTguLmY1N2EwMzVhOTRlZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9rbXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jCkBAIC0yMyw2ICsyMyw3IEBACiAjaW5j
bHVkZSAicmNhcl9kdV9jcnRjLmgiCiAjaW5jbHVkZSAicmNhcl9kdV9kcnYuaCIKICNpbmNsdWRl
ICJyY2FyX2R1X2VuY29kZXIuaCIKKyNpbmNsdWRlICJyY2FyX2R1X2dyb3VwLmgiCiAjaW5jbHVk
ZSAicmNhcl9kdV9rbXMuaCIKICNpbmNsdWRlICJyY2FyX2R1X3JlZ3MuaCIKICNpbmNsdWRlICJy
Y2FyX2R1X3ZzcC5oIgpAQCAtNjIxLDEwICs2MjIsNiBAQCBzdGF0aWMgaW50IHJjYXJfZHVfdnNw
c19pbml0KHN0cnVjdCByY2FyX2R1X2RldmljZSAqcmNkdSkKIAogaW50IHJjYXJfZHVfbW9kZXNl
dF9pbml0KHN0cnVjdCByY2FyX2R1X2RldmljZSAqcmNkdSkKIHsKLQlzdGF0aWMgY29uc3QgdW5z
aWduZWQgaW50IG1taW9fb2Zmc2V0c1tdID0gewotCQlEVTBfUkVHX09GRlNFVCwgRFUyX1JFR19P
RkZTRVQKLQl9OwotCiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHJjZHUtPmRkZXY7CiAJc3Ry
dWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVjdCByY2FyX2R1X2dyb3VwICpyZ3JwOwpA
QCAtNjcxLDI1ICs2NjgsOSBAQCBpbnQgcmNhcl9kdV9tb2Rlc2V0X2luaXQoc3RydWN0IHJjYXJf
ZHVfZGV2aWNlICpyY2R1KQogCiAJLyogSW5pdGlhbGl6ZSB0aGUgZ3JvdXBzLiAqLwogCWZvcl9l
YWNoX3JjZHVfZ3JvdXAocmNkdSwgcmdycCwgaSkgewotCQltdXRleF9pbml0KCZyZ3JwLT5sb2Nr
KTsKLQotCQlyZ3JwLT5kZXYgPSByY2R1OwotCQlyZ3JwLT5tbWlvX29mZnNldCA9IG1taW9fb2Zm
c2V0c1tpXTsKLQkJcmdycC0+aW5kZXggPSBpOwotCQkvKiBFeHRyYWN0IHRoZSBjaGFubmVsIG1h
c2sgZm9yIHRoaXMgZ3JvdXAgb25seS4gKi8KLQkJcmdycC0+Y2hhbm5lbHNfbWFzayA9IChyY2R1
LT5pbmZvLT5jaGFubmVsc19tYXNrID4+ICgyICogaSkpCi0JCQkJICAgJiBHRU5NQVNLKDEsIDAp
OwotCQlyZ3JwLT5udW1fY3J0Y3MgPSBod2VpZ2h0OChyZ3JwLT5jaGFubmVsc19tYXNrKTsKLQot
CQkvKgotCQkgKiBJZiB3ZSBoYXZlIG1vcmUgdGhhbiBvbmUgQ1JUQ3MgaW4gdGhpcyBncm91cCBw
cmUtYXNzb2NpYXRlCi0JCSAqIHRoZSBsb3ctb3JkZXIgcGxhbmVzIHdpdGggQ1JUQyAwIGFuZCB0
aGUgaGlnaC1vcmRlciBwbGFuZXMKLQkJICogd2l0aCBDUlRDIDEgdG8gbWluaW1pemUgZmxpY2tl
ciBvY2N1cnJpbmcgd2hlbiB0aGUKLQkJICogYXNzb2NpYXRpb24gaXMgY2hhbmdlZC4KLQkJICov
Ci0JCXJncnAtPmRwdHNyX3BsYW5lcyA9IHJncnAtPm51bV9jcnRjcyA+IDEKLQkJCQkgICA/IChy
Y2R1LT5pbmZvLT5nZW4gPj0gMyA/IDB4MDQgOiAweGYwKQotCQkJCSAgIDogMDsKKwkJcmV0ID0g
cmNhcl9kdV9ncm91cF9pbml0KHJjZHUsIHJncnAsIGkpOworCQlpZiAocmV0IDwgMCkKKwkJCXJl
dHVybiByZXQ7CiAKIAkJaWYgKCFyY2FyX2R1X2hhcyhyY2R1LCBSQ0FSX0RVX0ZFQVRVUkVfVlNQ
MV9TT1VSQ0UpKSB7CiAJCQlyZXQgPSByY2FyX2R1X3BsYW5lc19pbml0KHJncnApOwotLSAKUmVn
YXJkcywKCkxhdXJlbnQgUGluY2hhcnQKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2RyaS1kZXZlbA==
