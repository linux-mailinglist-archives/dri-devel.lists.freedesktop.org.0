Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 55A2891139
	for <lists+dri-devel@lfdr.de>; Sat, 17 Aug 2019 17:23:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 203CE6E51C;
	Sat, 17 Aug 2019 15:23:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C84026E516;
 Sat, 17 Aug 2019 15:23:11 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18173702-1500050 
 for multiple; Sat, 17 Aug 2019 16:23:01 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3] dma-fence: Simply wrap dma_fence_signal_locked with
 dma_fence_signal
Date: Sat, 17 Aug 2019 16:23:00 +0100
Message-Id: <20190817152300.5370-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190817144736.7826-5-chris@chris-wilson.co.uk>
References: <20190817144736.7826-5-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>, intel-gfx@lists.freedesktop.org,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGRtYV9mZW5jZV9zaWduYWwoKSB0cmllcyB0byBhdm9pZCB0aGUgc3BpbmxvY2sg
YW5kIG9ubHkgdGFrZXMKaXQgaWYgYWJzb2x1dGVseSByZXF1aXJlZCB0byB3YWxrIHRoZSBjYWxs
YmFjayBsaXN0LiBIb3dldmVyLCB0byBhbGxvdwpmb3Igc29tZSB1c2VycyB0byBzdXJyZXB0aXRp
b3VzbHkgaW5zZXJ0IGxhenkgc2lnbmFsIGNhbGxiYWNrcyB0aGF0CmRvIG5vdCBkZXBlbmQgb24g
ZW5hYmxpbmcgdGhlIHNpZ25hbGluZyBtZWNoYW5pc20gYXJvdW5kIGV2ZXJ5IGZlbmNlLAp3ZSBh
bHdheXMgbmVlZCB0byBub3RpZnkgdGhlIGNhbGxiYWNrcyBvbiBzaWduYWxpbmcuIEFzIHN1Y2gs
IHdlIHdpbGwKYWx3YXlzIG5lZWQgdG8gdGFrZSB0aGUgc3BpbmxvY2sgYW5kIGRtYV9mZW5jZV9z
aWduYWwoKSBlZmZlY3RpdmVseQpiZWNvbWVzIGEgY2xvbmUgb2YgZG1hX2ZlbmNlX3NpZ25hbF9s
b2NrZWQoKS4KCnYyOiBVcGRhdGUgdGhlIHRlc3RfYW5kX3NldF9iaXQoKSBiZWZvcmUgZW50ZXJp
bmcgdGhlIHNwaW5sb2NrLgp2MzogRHJvcCB0aGUgdGVzdF9bYW5kX3NldF1fYml0KCkgYmVmb3Jl
IHRoZSBzcGlubG9jaywgaXQncyBhIGNhbGxlcgplcnJvciBzbyBleHBlY3RlZCB0byBiZSB2ZXJ5
IHVubGlrZWx5LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxz
b24uY28udWs+CkNjOiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+
CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgotLS0KIGRyaXZlcnMv
ZG1hLWJ1Zi9kbWEtZmVuY2UuYyB8IDQ0ICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMiBpbnNlcnRpb25zKCspLCAzMiBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMgYi9kcml2ZXJzL2RtYS1i
dWYvZG1hLWZlbmNlLmMKaW5kZXggZmYwY2Q2ZWFlNzY2Li44YTZkMDI1MDI4NWQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYworKysgYi9kcml2ZXJzL2RtYS1idWYvZG1h
LWZlbmNlLmMKQEAgLTEyOSwyNSArMTI5LDE2IEBAIEVYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX2Nv
bnRleHRfYWxsb2MpOwogaW50IGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKHN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlKQogewogCXN0cnVjdCBkbWFfZmVuY2VfY2IgKmN1ciwgKnRtcDsKLQlpbnQgcmV0
ID0gMDsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoZmVuY2UtPmxvY2spOwogCi0JaWYgKFdBUk5f
T04oIWZlbmNlKSkKKwlpZiAodW5saWtlbHkodGVzdF9hbmRfc2V0X2JpdChETUFfRkVOQ0VfRkxB
R19TSUdOQUxFRF9CSVQsCisJCQkJICAgICAgJmZlbmNlLT5mbGFncykpKQogCQlyZXR1cm4gLUVJ
TlZBTDsKIAotCWlmICh0ZXN0X2FuZF9zZXRfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJ
VCwgJmZlbmNlLT5mbGFncykpIHsKLQkJcmV0ID0gLUVJTlZBTDsKLQotCQkvKgotCQkgKiB3ZSBt
aWdodCBoYXZlIHJhY2VkIHdpdGggdGhlIHVubG9ja2VkIGRtYV9mZW5jZV9zaWduYWwsCi0JCSAq
IHN0aWxsIHJ1biB0aHJvdWdoIGFsbCBjYWxsYmFja3MKLQkJICovCi0JfSBlbHNlIHsKLQkJZmVu
Y2UtPnRpbWVzdGFtcCA9IGt0aW1lX2dldCgpOwotCQlzZXRfYml0KERNQV9GRU5DRV9GTEFHX1RJ
TUVTVEFNUF9CSVQsICZmZW5jZS0+ZmxhZ3MpOwotCQl0cmFjZV9kbWFfZmVuY2Vfc2lnbmFsZWQo
ZmVuY2UpOwotCX0KKwlmZW5jZS0+dGltZXN0YW1wID0ga3RpbWVfZ2V0KCk7CisJc2V0X2JpdChE
TUFfRkVOQ0VfRkxBR19USU1FU1RBTVBfQklULCAmZmVuY2UtPmZsYWdzKTsKKwl0cmFjZV9kbWFf
ZmVuY2Vfc2lnbmFsZWQoZmVuY2UpOwogCiAJaWYgKCFsaXN0X2VtcHR5KCZmZW5jZS0+Y2JfbGlz
dCkpIHsKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2UtPmNiX2xp
c3QsIG5vZGUpIHsKQEAgLTE1Niw3ICsxNDcsOCBAQCBpbnQgZG1hX2ZlbmNlX3NpZ25hbF9sb2Nr
ZWQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAJCX0KIAkJSU5JVF9MSVNUX0hFQUQoJmZlbmNl
LT5jYl9saXN0KTsKIAl9Ci0JcmV0dXJuIHJldDsKKworCXJldHVybiAwOwogfQogRVhQT1JUX1NZ
TUJPTChkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZCk7CiAKQEAgLTE3NiwyOCArMTY4LDE2IEBAIEVY
UE9SVF9TWU1CT0woZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQpOwogaW50IGRtYV9mZW5jZV9zaWdu
YWwoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlp
bnQgcmV0OwogCiAJaWYgKCFmZW5jZSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlpZiAodGVzdF9h
bmRfc2V0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpKQot
CQlyZXR1cm4gLUVJTlZBTDsKLQotCWZlbmNlLT50aW1lc3RhbXAgPSBrdGltZV9nZXQoKTsKLQlz
ZXRfYml0KERNQV9GRU5DRV9GTEFHX1RJTUVTVEFNUF9CSVQsICZmZW5jZS0+ZmxhZ3MpOwotCXRy
YWNlX2RtYV9mZW5jZV9zaWduYWxlZChmZW5jZSk7Ci0KLQlpZiAodGVzdF9iaXQoRE1BX0ZFTkNF
X0ZMQUdfRU5BQkxFX1NJR05BTF9CSVQsICZmZW5jZS0+ZmxhZ3MpKSB7Ci0JCXN0cnVjdCBkbWFf
ZmVuY2VfY2IgKmN1ciwgKnRtcDsKKwlzcGluX2xvY2tfaXJxc2F2ZShmZW5jZS0+bG9jaywgZmxh
Z3MpOworCXJldCA9IGRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKGZlbmNlKTsKKwlzcGluX3VubG9j
a19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CiAKLQkJc3Bpbl9sb2NrX2lycXNhdmUo
ZmVuY2UtPmxvY2ssIGZsYWdzKTsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1w
LCAmZmVuY2UtPmNiX2xpc3QsIG5vZGUpIHsKLQkJCWxpc3RfZGVsX2luaXQoJmN1ci0+bm9kZSk7
Ci0JCQljdXItPmZ1bmMoZmVuY2UsIGN1cik7Ci0JCX0KLQkJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZShmZW5jZS0+bG9jaywgZmxhZ3MpOwotCX0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gcmV0OwogfQog
RVhQT1JUX1NZTUJPTChkbWFfZmVuY2Vfc2lnbmFsKTsKIAotLSAKMi4yMy4wLnJjMQoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
