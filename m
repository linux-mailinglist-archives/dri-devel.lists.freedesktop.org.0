Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 98794282078
	for <lists+dri-devel@lfdr.de>; Sat,  3 Oct 2020 04:17:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6071B6EA15;
	Sat,  3 Oct 2020 02:17:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 383906EA09
 for <dri-devel@lists.freedesktop.org>; Sat,  3 Oct 2020 02:17:34 +0000 (UTC)
IronPort-SDR: OON0y1Ci+88CZCCXaTbBZS8D261rcBgDcT8q7OLN+n0Z/Wo6NTWpva+/cRERoMdPDxNo/X911y
 Cw+sO5mYbF2Q==
X-IronPort-AV: E=McAfee;i="6000,8403,9762"; a="247871949"
X-IronPort-AV: E=Sophos;i="5.77,330,1596524400"; d="scan'208";a="247871949"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga105.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 02 Oct 2020 19:17:32 -0700
IronPort-SDR: Mz9bS4pLMuqzY/U4y89fzwYxskpnlE2UJwU9K7CJ5QWU8sQMsFklpYBcWJ26QJfwfPyvPsNM1e
 uLJVmkao7w0A==
X-IronPort-AV: E=Sophos;i="5.77,330,1596524400"; d="scan'208";a="340197141"
Received: from cshinn-mobl1.amr.corp.intel.com (HELO
 achrisan-DESK2.amr.corp.intel.com) ([10.255.91.49])
 by fmsmga004-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-SHA;
 02 Oct 2020 19:17:32 -0700
From: Anitha Chrisanthus <anitha.chrisanthus@intel.com>
To: dri-devel@lists.freedesktop.org, anitha.chrisanthus@intel.com,
 bob.j.paauwe@intel.com, edmund.j.dea@intel.com
Subject: [PATCH v8 2/4] drm/kmb: Add support for KeemBay Display
Date: Fri,  2 Oct 2020 19:17:00 -0700
Message-Id: <1601691422-12851-3-git-send-email-anitha.chrisanthus@intel.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1601691422-12851-1-git-send-email-anitha.chrisanthus@intel.com>
References: <1601691422-12851-1-git-send-email-anitha.chrisanthus@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: daniel.vetter@intel.com, sam@ravnborg.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBhIGJhc2ljIEtNUyBhdG9taWMgbW9kZXNldHRpbmcgZGlzcGxheSBkcml2ZXIgZm9y
IEtlZW1CYXkgZmFtaWx5IG9mClNPQ3MuIERyaXZlciBoYXMgbm8gMkQgb3IgM0QgZ3JhcGhpY3Mu
SXQgY2FsbHMgaW50byB0aGUgQURWIGJyaWRnZQpkcml2ZXIgYXQgdGhlIGNvbm5lY3RvciBsZXZl
bC4KClNpbmdsZSBDUlRDIHdpdGggTENEIGNvbnRyb2xsZXItPm1pcGkgRFNJLT4gQURWIGJyaWRn
ZQoKT25seSAxMDgwcCByZXNvbHV0aW9uIGFuZCBzaW5nbGUgcGxhbmUgaXMgc3VwcG9ydGVkIGF0
IHRoaXMgdGltZS4KCnYyOiBtb3ZlZCBleHRlcm4gdG8gLmgsIHJlbW92ZWQgbGljZW5zZSB0ZXh0
CiAgICB1c2UgZHJtX2Rldl9pbml0LCB1cGNsYXNzZWQgZGV2X3ByaXZhdGUsIHJlbW92ZWQgSEFW
RV9JUlEuKFNhbSkKCnYzOiBTcXVhc2hlZCBhbGwgNTkgY29tbWl0cyB0byBvbmUKCnY0OiByZXZp
ZXcgY2hhbmdlcyBmcm9tIFNhbSBSYXZuYm9yZwoJcmVuYW1lZCBkZXZfcCB0byBrbWIKCW1vdmVk
IGNsb2NrcyB1bmRlciBrbWJfY2xvY2ssIGNvbnNvbGlkYXRlZCBjbGsgaW5pdGlhbGl6YXRpb25z
Cgl1c2UgZHJtbSBmdW5jdGlvbnMKCXVzZSBEUk1fR0VNX0NNQV9EUklWRVJfT1BTX1ZNQVAKCnY1
OiBjb3JyZWN0ZWQgc3BlbGxpbmdzCnY2OiBjb3JyZWN0ZWQgY2hlY2twYXRjaCB3YXJuaW5ncwp2
NzogcmV2aWV3IGNoYW5nZXMgU2FtIFJhdm5ib3JnIGFuZCBUaG9tYXMgWmltbWVybWFuCglyZW1v
dmVkIGttYl9jcnRjLmgga21iX2NydGNfY2xlYW51cCAoVGhvbWFzKQoJcmVuYW1lZCBtb2RlX3Nl
dCwga21iX2xvYWQsIGlubGluZWQgdW5sb2FkIChUaG9tYXMpCgltb3ZlZCByZW1haW5pbmcgbG9n
Z2luZyB0byBkcm1fKihUaG9tYXMpCglyZS1vcmdlZCBkcml2ZXIgaW5pdGlhbGl6YXRpb24gKFRo
b21hcykKCW1vdmVkIHBsYW5lX3N0YXR1cyB0byBkcm1fcHJpdmF0ZSAoU2FtKQoJcmVtb3ZlZCB1
bm5lY2Vzc2FyeSBsb2dzIGFuZCBkZWZpbmVzIGFuZCBpZmRlZiBjb2RlcyAoU2FtKQoJY2FsbCBo
ZWxwZXJfY2hlY2sgaW4gcGxhbmVfYXRvbWljX2NoZWNrIChTYW0pCglyZW5hbWVkIHNldCB0byBn
ZXQgZm9yIGJwcCBhbmQgZm9ybWF0IGZ1bmN0aW9ucyhTYW0pCgl1c2UgZHJtIGhlbHBlciBmdW5j
dGlvbnMgZm9yIHJlc2V0LCBkdXBsaWNhdGUvZGVzdHJveSBzdGF0ZSBpbnN0ZWFkCglvZiBrbWIg
ZnVuY3Rpb25zIChTYW0pCglyZW1vdmVkIGttYl9wcml2IGZyb20ga21iX3BsYW5lIGFuZCByZW1v
dmVkIGttYl9wbGFuZV9zdGF0ZSAoU2FtKQp2ODogZ2V0IGNsa19wbGwwIGZyb20gZGlzcGxheSBu
b2RlIGluIGR0CgpDYzogU2FtIFJhdm5ib3JnIDxzYW1AcmF2bmJvcmcub3JnPgpTaWduZWQtb2Zm
LWJ5OiBBbml0aGEgQ2hyaXNhbnRodXMgPGFuaXRoYS5jaHJpc2FudGh1c0BpbnRlbC5jb20+ClJl
dmlld2VkLWJ5OiBCb2IgUGFhdXdlIDxib2Iuai5wYWF1d2VAaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9rbWIva21iX2NydGMuYyAgfCAyMjQgKysrKysrKysrKysrKwogZHJpdmVycy9n
cHUvZHJtL2ttYi9rbWJfZHJ2LmMgICB8IDY3NSArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0va21iL2ttYl9kcnYuaCAgIHwgMTcwICsrKysr
KysrKysKIGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmMgfCA0ODAgKysrKysrKysrKysr
KysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuaCB8IDExMCAr
KysrKysrCiA1IGZpbGVzIGNoYW5nZWQsIDE2NTkgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX2NydGMuYwogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9ncHUvZHJtL2ttYi9rbWJfZHJ2LmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0va21iL2ttYl9wbGFuZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2tt
Yi9rbWJfcGxhbmUuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2NydGMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2NydGMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwLi5hNjg0MzMxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2ttYi9rbWJfY3J0Yy5jCkBAIC0wLDAgKzEsMjI0IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogR1BMLTIuMC1vbmx5CisvKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBD
b3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51
eC9vZl9ncmFwaC5oPgorI2luY2x1ZGUgPGxpbnV4L3BsYXRmb3JtX2RhdGEvc2ltcGxlZmIuaD4K
KworI2luY2x1ZGUgPHZpZGVvL3ZpZGVvbW9kZS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9t
aWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0v
ZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGNfaGVscGVyLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9kZWJ1Z2ZzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kZXZpY2UuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2Rydi5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmJfY21hX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fZmJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fY21hX2hl
bHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fb2YuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3BsYW5l
X2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fdmJsYW5rLmg+CisKKyNpbmNsdWRlICJrbWJf
ZHJ2LmgiCisjaW5jbHVkZSAia21iX2RzaS5oIgorI2luY2x1ZGUgImttYl9wbGFuZS5oIgorI2lu
Y2x1ZGUgImttYl9yZWdzLmgiCisKK3N0cnVjdCBrbWJfY3J0Y190aW1pbmcgeworCXUzMiB2ZnJv
bnRfcG9yY2g7CisJdTMyIHZiYWNrX3BvcmNoOworCXUzMiB2c3luY19sZW47CisJdTMyIGhmcm9u
dF9wb3JjaDsKKwl1MzIgaGJhY2tfcG9yY2g7CisJdTMyIGhzeW5jX2xlbjsKK307CisKK3N0YXRp
YyBpbnQga21iX2NydGNfZW5hYmxlX3ZibGFuayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCit7CisJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3Qga21iX2RybV9wcml2
YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCS8qIENsZWFyIGludGVycnVwdCAqLworCWttYl93
cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0RfSU5UX1ZFUlRfQ09NUCk7CisJLyogU2V0
IHdoaWNoIGludGVydmFsIHRvIGdlbmVyYXRlIHZlcnRpY2FsIGludGVycnVwdCAqLworCWttYl93
cml0ZV9sY2Qoa21iLCBMQ0RfVlNUQVRVU19DT01QQVJFLAorCQkgICAgICBMQ0RfVlNUQVRVU19D
T01QQVJFX1ZTWU5DKTsKKwkvKiBFbmFibGUgdmVydGljYWwgaW50ZXJydXB0ICovCisJa21iX3Nl
dF9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLAorCQkJICAgIExDRF9JTlRfVkVSVF9D
T01QKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQga21iX2NydGNfZGlzYWJsZV92Ymxh
bmsoc3RydWN0IGRybV9jcnRjICpjcnRjKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjLT5kZXY7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRldik7CisK
KwkvKiBDbGVhciBpbnRlcnJ1cHQgKi8KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0lOVF9DTEVB
UiwgTENEX0lOVF9WRVJUX0NPTVApOworCS8qIERpc2FibGUgdmVydGljYWwgaW50ZXJydXB0ICov
CisJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLAorCQkJICAgIExDRF9J
TlRfVkVSVF9DT01QKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBr
bWJfY3J0Y19mdW5jcyA9IHsKKwkuZGVzdHJveSA9IGRybV9jcnRjX2NsZWFudXAsCisJLnNldF9j
b25maWcgPSBkcm1fYXRvbWljX2hlbHBlcl9zZXRfY29uZmlnLAorCS5wYWdlX2ZsaXAgPSBkcm1f
YXRvbWljX2hlbHBlcl9wYWdlX2ZsaXAsCisJLnJlc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfY3J0
Y19yZXNldCwKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2Ny
dGNfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNf
aGVscGVyX2NydGNfZGVzdHJveV9zdGF0ZSwKKwkuZW5hYmxlX3ZibGFuayA9IGttYl9jcnRjX2Vu
YWJsZV92YmxhbmssCisJLmRpc2FibGVfdmJsYW5rID0ga21iX2NydGNfZGlzYWJsZV92Ymxhbmss
Cit9OworCitzdGF0aWMgdm9pZCBrbWJfY3J0Y19zZXRfbW9kZShzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbSA9ICZjcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3Qg
a21iX2NydGNfdGltaW5nIHZtOworCWludCB2c3luY19zdGFydF9vZmZzZXQ7CisJaW50IHZzeW5j
X2VuZF9vZmZzZXQ7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9fa21iKGRldik7
CisJdW5zaWduZWQgaW50IHZhbCA9IDA7CisKKwkvKiBJbml0aWFsaXplIG1pcGkgKi8KKwlrbWJf
ZHNpX2h3X2luaXQoZGV2LCBtKTsKKwlkcm1faW5mbyhkZXYsCisJCSAidmZwPSAlZCB2YnA9ICVk
IHZzeWNfbGVuPSVkIGhmcD0lZCBoYnA9JWQgaHN5bmNfbGVuPSVkXG4iLAorCQkgbS0+Y3J0Y192
c3luY19zdGFydCAtIG0tPmNydGNfdmRpc3BsYXksCisJCSBtLT5jcnRjX3Z0b3RhbCAtIG0tPmNy
dGNfdnN5bmNfZW5kLAorCQkgbS0+Y3J0Y192c3luY19lbmQgLSBtLT5jcnRjX3ZzeW5jX3N0YXJ0
LAorCQkgbS0+Y3J0Y19oc3luY19zdGFydCAtIG0tPmNydGNfaGRpc3BsYXksCisJCSBtLT5jcnRj
X2h0b3RhbCAtIG0tPmNydGNfaHN5bmNfZW5kLAorCQkgbS0+Y3J0Y19oc3luY19lbmQgLSBtLT5j
cnRjX2hzeW5jX3N0YXJ0KTsKKwl2YWwgPSBrbWJfcmVhZF9sY2Qoa21iLCBMQ0RfSU5UX0VOQUJM
RSk7CisJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLCB2YWwpOworCWtt
Yl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCB+MHgwKTsKKwl2bS52ZnJvbnRf
cG9yY2ggPSAyOworCXZtLnZiYWNrX3BvcmNoID0gMjsKKwl2bS52c3luY19sZW4gPSA4OworCXZt
Lmhmcm9udF9wb3JjaCA9IDA7CisJdm0uaGJhY2tfcG9yY2ggPSAwOworCXZtLmhzeW5jX2xlbiA9
IDI4OworCisJdnN5bmNfc3RhcnRfb2Zmc2V0ID0gIG0tPmNydGNfdnN5bmNfc3RhcnQgLSAgbS0+
Y3J0Y19oc3luY19zdGFydDsKKwl2c3luY19lbmRfb2Zmc2V0ID0gIG0tPmNydGNfdnN5bmNfZW5k
IC0gbS0+Y3J0Y19oc3luY19lbmQ7CisKKwlkcm1fZGJnKGRldiwgIiVzIDogJWRhY3RpdmUgaGVp
Z2h0PSAlZCB2YnA9JWQgdmZwPSVkIHZzeW5jLXc9JWQgaC1hY3RpdmU9JWQgaC1icD0lZCBoLWZw
PSVkIGh5c25jLWw9JWQiLAorCQlfX2Z1bmNfXywgX19MSU5FX18sCisJCQltLT5jcnRjX3ZkaXNw
bGF5LCB2bS52YmFja19wb3JjaCwgdm0udmZyb250X3BvcmNoLAorCQkJdm0udnN5bmNfbGVuLCBt
LT5jcnRjX2hkaXNwbGF5LCB2bS5oYmFja19wb3JjaCwKKwkJCXZtLmhmcm9udF9wb3JjaCwgdm0u
aHN5bmNfbGVuKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX1ZfQUNUSVZFSEVJR0hULAorCQkg
ICAgICBtLT5jcnRjX3ZkaXNwbGF5IC0gMSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9WX0JB
Q0tQT1JDSCwgdm0udmJhY2tfcG9yY2gpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVl9GUk9O
VFBPUkNILCB2bS52ZnJvbnRfcG9yY2gpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfVlNZTkNf
V0lEVEgsIHZtLnZzeW5jX2xlbiAtIDEpOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSF9BQ1RJ
VkVXSURUSCwKKwkJICAgICAgbS0+Y3J0Y19oZGlzcGxheSAtIDEpOworCWttYl93cml0ZV9sY2Qo
a21iLCBMQ0RfSF9CQUNLUE9SQ0gsIHZtLmhiYWNrX3BvcmNoKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0hfRlJPTlRQT1JDSCwgdm0uaGZyb250X3BvcmNoKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0hTWU5DX1dJRFRILCB2bS5oc3luY19sZW4gLSAxKTsKKwkvKiBUaGlzIGlzIGhhcmRj
b2RlZCBhcyAwIGluIHRoZSBNeXJpYWR4IGNvZGUgKi8KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENE
X1ZTWU5DX1NUQVJULCAwKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX1ZTWU5DX0VORCwgMCk7
CisJLyogQmFjayBncm91bmQgY29sb3IgKi8KKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0JHX0NP
TE9VUl9MUywgMHg0KTsKKwlpZiAobS0+ZmxhZ3MgPT0gRFJNX01PREVfRkxBR19JTlRFUkxBQ0Up
IHsKKwkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkgICAgICBMQ0RfVlNZTkNfV0lEVEhfRVZFTiwg
dm0udnN5bmNfbGVuIC0gMSk7CisJCWttYl93cml0ZV9sY2Qoa21iLAorCQkJICAgICAgTENEX1Zf
QkFDS1BPUkNIX0VWRU4sIHZtLnZiYWNrX3BvcmNoKTsKKwkJa21iX3dyaXRlX2xjZChrbWIsCisJ
CQkgICAgICBMQ0RfVl9GUk9OVFBPUkNIX0VWRU4sIHZtLnZmcm9udF9wb3JjaCk7CisJCWttYl93
cml0ZV9sY2Qoa21iLCBMQ0RfVl9BQ1RJVkVIRUlHSFRfRVZFTiwKKwkJCSAgICAgIG0tPmNydGNf
dmRpc3BsYXkgLSAxKTsKKwkJLyogVGhpcyBpcyBoYXJkY29kZWQgYXMgMTAgaW4gdGhlIE15cmlh
ZHggY29kZSAqLworCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX1ZTWU5DX1NUQVJUX0VWRU4sIDEw
KTsKKwkJa21iX3dyaXRlX2xjZChrbWIsIExDRF9WU1lOQ19FTkRfRVZFTiwgMTApOworCX0KKwlr
bWJfd3JpdGVfbGNkKGttYiwgTENEX1RJTUlOR19HRU5fVFJJRywgRU5BQkxFKTsKKwlrbWJfc2V0
X2JpdG1hc2tfbGNkKGttYiwgTENEX0NPTlRST0wsIExDRF9DVFJMX0VOQUJMRSk7CisJa21iX3Nl
dF9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLCB2YWwpOworfQorCitzdGF0aWMgdm9p
ZCBrbWJfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICBz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3Qga21iX2RybV9wcml2
YXRlICpsY2QgPSBjcnRjX3RvX2ttYl9wcml2KGNydGMpOworCisJY2xrX3ByZXBhcmVfZW5hYmxl
KGxjZC0+Y2xrKTsKKwlrbWJfY3J0Y19zZXRfbW9kZShjcnRjKTsKKwlkcm1fY3J0Y192Ymxhbmtf
b24oY3J0Yyk7Cit9CisKK3N0YXRpYyB2b2lkIGttYl9jcnRjX2F0b21pY19kaXNhYmxlKHN0cnVj
dCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3Rh
dGUpCit7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqbGNkID0gY3J0Y190b19rbWJfcHJpdihj
cnRjKTsKKworCS8qIGR1ZSB0byBodyBsaW1pdGF0aW9ucywgcGxhbmVzIG5lZWQgdG8gYmUgb2Zm
IHdoZW4gY3J0YyBpcyBvZmYgKi8KKwlkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lc19v
bl9jcnRjKG9sZF9zdGF0ZSwgZmFsc2UpOworCisJZHJtX2NydGNfdmJsYW5rX29mZihjcnRjKTsK
KwljbGtfZGlzYWJsZV91bnByZXBhcmUobGNkLT5jbGspOworfQorCitzdGF0aWMgdm9pZCBrbWJf
Y3J0Y19hdG9taWNfYmVnaW4oc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgc3RydWN0IGRy
bV9jcnRjX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+
ZGV2OworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9IHRvX2ttYihkZXYpOworCisJa21i
X2Nscl9iaXRtYXNrX2xjZChrbWIsIExDRF9JTlRfRU5BQkxFLAorCQkJICAgIExDRF9JTlRfVkVS
VF9DT01QKTsKK30KKworc3RhdGljIHZvaWQga21iX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBk
cm1fY3J0YyAqY3J0YywKKwkJCQkgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKKwlzdHJ1Y3Qga21iX2RybV9wcml2
YXRlICprbWIgPSB0b19rbWIoZGV2KTsKKworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0Rf
SU5UX0VOQUJMRSwKKwkJCSAgICBMQ0RfSU5UX1ZFUlRfQ09NUCk7CisKKwlzcGluX2xvY2tfaXJx
KCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOworCWlmIChjcnRjLT5zdGF0ZS0+ZXZlbnQpCisJCWRy
bV9jcnRjX3NlbmRfdmJsYW5rX2V2ZW50KGNydGMsIGNydGMtPnN0YXRlLT5ldmVudCk7CisJY3J0
Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsKKwlzcGluX3VubG9ja19pcnEoJmNydGMtPmRldi0+ZXZl
bnRfbG9jayk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfaGVscGVyX2Z1bmNz
IGttYl9jcnRjX2hlbHBlcl9mdW5jcyA9IHsKKwkuYXRvbWljX2JlZ2luID0ga21iX2NydGNfYXRv
bWljX2JlZ2luLAorCS5hdG9taWNfZW5hYmxlID0ga21iX2NydGNfYXRvbWljX2VuYWJsZSwKKwku
YXRvbWljX2Rpc2FibGUgPSBrbWJfY3J0Y19hdG9taWNfZGlzYWJsZSwKKwkuYXRvbWljX2ZsdXNo
ID0ga21iX2NydGNfYXRvbWljX2ZsdXNoLAorfTsKKworaW50IGttYl9zZXR1cF9jcnRjKHN0cnVj
dCBkcm1fZGV2aWNlICpkcm0pCit7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iID0gdG9f
a21iKGRybSk7CisJc3RydWN0IGttYl9wbGFuZSAqcHJpbWFyeTsKKwlpbnQgcmV0OworCisJcHJp
bWFyeSA9IGttYl9wbGFuZV9pbml0KGRybSk7CisJaWYgKElTX0VSUihwcmltYXJ5KSkKKwkJcmV0
dXJuIFBUUl9FUlIocHJpbWFyeSk7CisKKwlyZXQgPSBkcm1fY3J0Y19pbml0X3dpdGhfcGxhbmVz
KGRybSwgJmttYi0+Y3J0YywgJnByaW1hcnktPmJhc2VfcGxhbmUsCisJCQkJCU5VTEwsICZrbWJf
Y3J0Y19mdW5jcywgTlVMTCk7CisJaWYgKHJldCkgeworCQlrbWJfcGxhbmVfZGVzdHJveSgmcHJp
bWFyeS0+YmFzZV9wbGFuZSk7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJtX2NydGNfaGVscGVy
X2FkZCgma21iLT5jcnRjLCAma21iX2NydGNfaGVscGVyX2Z1bmNzKTsKKwlyZXR1cm4gMDsKK30K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5jIGIvZHJpdmVycy9ncHUv
ZHJtL2ttYi9rbWJfZHJ2LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uZmRm
Nzk5MQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5jCkBA
IC0wLDAgKzEsNjc1IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5
CisvKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisK
KyNpbmNsdWRlIDxsaW51eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51eC9jb25zb2xlLmg+CisjaW5j
bHVkZSA8bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUg
PGxpbnV4L29mX2dyYXBoLmg+CisjaW5jbHVkZSA8bGludXgvb2ZfcmVzZXJ2ZWRfbWVtLmg+Cisj
aW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvcG1fcnVu
dGltZS5oPgorI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJt
Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21p
Y19oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X2RldmljZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9m
Yl9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2dlbV9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVi
dWZmZXJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9pb2N0bC5oPgorI2luY2x1ZGUgPGRy
bS9kcm1faXJxLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9vZi5oPgorI2luY2x1ZGUgPGRybS9kcm1f
cHJvYmVfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KKworI2luY2x1ZGUg
ImttYl9kcnYuaCIKKyNpbmNsdWRlICJrbWJfZHNpLmgiCisjaW5jbHVkZSAia21iX3JlZ3MuaCIK
KworaW50IGttYl91bmRlcl9mbG93ID0gMCwga21iX2ZsdXNoX2RvbmUgPSAwLCBsYXllcl9ubyA9
IDA7CitzdGF0aWMgc3RydWN0IGttYl9jbG9jayBrbWJfY2xrOworCitzdGF0aWMgc3RydWN0IGRy
bV9icmlkZ2UgKmFkdl9icmlkZ2U7CisKK2ludCBrbWJfZGlzcGxheV9jbGtfZW5hYmxlKHN0cnVj
dCBrbWJfZHJtX3ByaXZhdGUgKmttYikKK3sKKwlpbnQgcmV0ID0gMDsKKworCXJldCA9IGNsa19w
cmVwYXJlX2VuYWJsZShrbWJfY2xrLmNsa19sY2QpOworCWlmIChyZXQpIHsKKwkJZHJtX2Vycigm
a21iLT5kcm0sICJGYWlsZWQgdG8gZW5hYmxlIExDRCBjbG9jazogJWRcbiIsIHJldCk7CisJCXJl
dHVybiByZXQ7CisJfQorCisJcmV0ID0gY2xrX3ByZXBhcmVfZW5hYmxlKGttYl9jbGsuY2xrX21p
cGkpOworCWlmIChyZXQpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJGYWlsZWQgdG8gZW5hYmxl
IE1JUEkgY2xvY2s6ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldCA9IGNs
a19wcmVwYXJlX2VuYWJsZShrbWJfY2xrLmNsa19taXBpX2VjZmcpOworCWlmIChyZXQpIHsKKwkJ
ZHJtX2Vycigma21iLT5kcm0sCisJCQkiRmFpbGVkIHRvIGVuYWJsZSBNSVBJX0VDRkcgY2xvY2s6
ICVkXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldCA9IGNsa19wcmVwYXJlX2Vu
YWJsZShrbWJfY2xrLmNsa19taXBpX2NmZyk7CisJaWYgKHJldCkgeworCQlkcm1fZXJyKCZrbWIt
PmRybSwKKwkJCSJGYWlsZWQgdG8gZW5hYmxlIE1JUElfQ0ZHIGNsb2NrOiAlZFxuIiwgcmV0KTsK
KwkJcmV0dXJuIHJldDsKKwl9CisJRFJNX0lORk8oIlNVQ0NFU1MgOiBlbmFibGVkIExDRCBNSVBJ
IGNsb2Nrc1xuIik7CisJcmV0dXJuIDA7Cit9CisKK2ludCBrbWJfaW5pdGlhbGl6ZV9jbG9ja3Mo
c3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCit7CisJdW5z
aWduZWQgbG9uZyBjbGs7CisJaW50IHJldCA9IDA7CisKKwlrbWJfY2xrLmNsa19sY2QgPSBjbGtf
Z2V0KGRldiwgImNsa19sY2QiKTsKKwlpZiAoSVNfRVJSKGttYl9jbGsuY2xrX2xjZCkpIHsKKwkJ
ZHJtX2Vycigma21iLT5kcm0sICJjbGtfZ2V0KCkgZmFpbGVkIGNsa19sY2RcbiIpOworCQlyZXR1
cm4gUFRSX0VSUihrbWJfY2xrLmNsa19sY2QpOworCX0KKworCWttYl9jbGsuY2xrX21pcGkgPSBj
bGtfZ2V0KGRldiwgImNsa19taXBpIik7CisJaWYgKElTX0VSUihrbWJfY2xrLmNsa19taXBpKSkg
eworCQlkcm1fZXJyKCZrbWItPmRybSwgImNsa19nZXQoKSBmYWlsZWQgY2xrX21pcGlcbiIpOwor
CQlyZXR1cm4gUFRSX0VSUihrbWJfY2xrLmNsa19taXBpKTsKKwl9CisKKwlrbWJfY2xrLmNsa19t
aXBpX2VjZmcgPSBjbGtfZ2V0KGRldiwgImNsa19taXBpX2VjZmciKTsKKwlpZiAoSVNfRVJSKGtt
Yl9jbGsuY2xrX21pcGlfZWNmZykpIHsKKwkJZHJtX2Vycigma21iLT5kcm0sICJjbGtfZ2V0KCkg
ZmFpbGVkIGNsa19taXBpX2VjZmdcbiIpOworCQlyZXR1cm4gUFRSX0VSUihrbWJfY2xrLmNsa19t
aXBpX2VjZmcpOworCX0KKworCWttYl9jbGsuY2xrX21pcGlfY2ZnID0gY2xrX2dldChkZXYsICJj
bGtfbWlwaV9jZmciKTsKKwlpZiAoSVNfRVJSKGttYl9jbGsuY2xrX21pcGlfY2ZnKSkgeworCQlk
cm1fZXJyKCZrbWItPmRybSwgImNsa19nZXQoKSBmYWlsZWQgY2xrX21pcGlfY2ZnXG4iKTsKKwkJ
cmV0dXJuIFBUUl9FUlIoa21iX2Nsay5jbGtfbWlwaV9jZmcpOworCX0KKworCWttYl9jbGsuY2xr
X3BsbDAgPSBjbGtfZ2V0KGRldiwgImNsa19wbGwwIik7CisJaWYgKElTX0VSUihrbWJfY2xrLmNs
a19wbGwwKSkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImNsa19nZXQoKSBmYWlsZWQgY2xrX3Bs
bDAgIik7CisJCXJldHVybiBQVFJfRVJSKGttYl9jbGsuY2xrX3BsbDApOworCX0KKwlrbWItPnN5
c19jbGtfbWh6ID0gY2xrX2dldF9yYXRlKGttYl9jbGsuY2xrX3BsbDApIC8gMTAwMDAwMDsKKwlk
cm1faW5mbygma21iLT5kcm0sICJzeXN0ZW0gY2xrID0gJWQgTWh6Iiwga21iLT5zeXNfY2xrX21o
eik7CisKKwkvKiBTZXQgTENEIGNsb2NrIHRvIDIwMCBNaHogKi8KKwljbGtfc2V0X3JhdGUoa21i
X2Nsay5jbGtfbGNkLCBLTUJfTENEX0RFRkFVTFRfQ0xLKTsKKwlpZiAoY2xrX2dldF9yYXRlKGtt
Yl9jbGsuY2xrX2xjZCkgIT0gS01CX0xDRF9ERUZBVUxUX0NMSykgeworCQlkcm1fZXJyKCZrbWIt
PmRybSwgImZhaWxlZCB0byBzZXQgdG8gY2xrX2xjZCB0byAlZFxuIiwKKwkJCUtNQl9MQ0RfREVG
QVVMVF9DTEspOworCQlyZXR1cm4gLTE7CisJfQorCWRybV9kYmcoJmttYi0+ZHJtLCAiY2xrX2xj
ZCA9ICVsZFxuIiwgY2xrX2dldF9yYXRlKGttYl9jbGsuY2xrX2xjZCkpOworCisJLyogU2V0IE1J
UEkgY2xvY2sgdG8gMjQgTWh6ICovCisJY2xrX3NldF9yYXRlKGttYl9jbGsuY2xrX21pcGksIEtN
Ql9NSVBJX0RFRkFVTFRfQ0xLKTsKKwlpZiAoY2xrX2dldF9yYXRlKGttYl9jbGsuY2xrX21pcGkp
ICE9IEtNQl9NSVBJX0RFRkFVTFRfQ0xLKSB7CisJCWRybV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVk
IHRvIHNldCB0byBjbGtfbWlwaSB0byAlZFxuIiwKKwkJCUtNQl9NSVBJX0RFRkFVTFRfQ0xLKTsK
KwkJcmV0dXJuIC0xOworCX0KKwlkcm1fZGJnKCZrbWItPmRybSwgImNsa19taXBpID0gJWxkXG4i
LCBjbGtfZ2V0X3JhdGUoa21iX2Nsay5jbGtfbWlwaSkpOworCisJY2xrID0gY2xrX2dldF9yYXRl
KGttYl9jbGsuY2xrX21pcGlfZWNmZyk7CisJaWYgKGNsayAhPSBLTUJfTUlQSV9ERUZBVUxUX0NG
R19DTEspIHsKKwkJLyogU2V0IE1JUElfRUNGRyBjbG9jayB0byAyNCBNaHogKi8KKwkJY2xrX3Nl
dF9yYXRlKGttYl9jbGsuY2xrX21pcGlfZWNmZywgS01CX01JUElfREVGQVVMVF9DRkdfQ0xLKTsK
KwkJY2xrID0gY2xrX2dldF9yYXRlKGttYl9jbGsuY2xrX21pcGlfZWNmZyk7CisJCWlmIChjbGsg
IT0gS01CX01JUElfREVGQVVMVF9DRkdfQ0xLKSB7CisJCQlkcm1fZXJyKCZrbWItPmRybSwKKwkJ
CQkiZmFpbGVkIHRvIHNldCB0byBjbGtfbWlwaV9lY2ZnIHRvICVkXG4iLAorCQkJCSBLTUJfTUlQ
SV9ERUZBVUxUX0NGR19DTEspOworCQkJcmV0dXJuIC0xOworCQl9CisJfQorCisJY2xrID0gY2xr
X2dldF9yYXRlKGttYl9jbGsuY2xrX21pcGlfY2ZnKTsKKwlpZiAoY2xrICE9IEtNQl9NSVBJX0RF
RkFVTFRfQ0ZHX0NMSykgeworCQkvKiBTZXQgTUlQSV9DRkcgY2xvY2sgdG8gMjQgTWh6ICovCisJ
CWNsa19zZXRfcmF0ZShrbWJfY2xrLmNsa19taXBpX2NmZywgMjQwMDAwMDApOworCQljbGsgPSBj
bGtfZ2V0X3JhdGUoa21iX2Nsay5jbGtfbWlwaV9jZmcpOworCQlpZiAoY2xrICE9IEtNQl9NSVBJ
X0RFRkFVTFRfQ0ZHX0NMSykgeworCQkJZHJtX2Vycigma21iLT5kcm0sCisJCQkJImZhaWxlZCB0
byBzZXQgY2xrX21pcGlfY2ZnIHRvICVkXG4iLAorCQkJCSAgS01CX01JUElfREVGQVVMVF9DRkdf
Q0xLKTsKKwkJCXJldHVybiAtMTsKKwkJfQorCX0KKworCXJldCA9IGttYl9kaXNwbGF5X2Nsa19l
bmFibGUoa21iKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJLyogRW5hYmxlIE1TU19D
QU1fQ0xLX0NUUkwgZm9yIE1JUEkgVFggYW5kIExDRCAqLworCWttYl9zZXRfYml0bWFza19tc3Nj
YW0oa21iLCBNU1NfQ0FNX0NMS19DVFJMLCAweDFmZmYpOworCWttYl9zZXRfYml0bWFza19tc3Nj
YW0oa21iLCBNU1NfQ0FNX1JTVE5fQ1RSTCwgMHhmZmZmZmZmZik7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQga21iX2Rpc3BsYXlfY2xrX2Rpc2FibGUodm9pZCkKK3sKKwlpZiAoa21iX2Ns
ay5jbGtfbGNkKQorCQljbGtfZGlzYWJsZV91bnByZXBhcmUoa21iX2Nsay5jbGtfbGNkKTsKKwlp
ZiAoa21iX2Nsay5jbGtfbWlwaSkKKwkJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKGttYl9jbGsuY2xr
X21pcGkpOworCWlmIChrbWJfY2xrLmNsa19taXBpX2VjZmcpCisJCWNsa19kaXNhYmxlX3VucHJl
cGFyZShrbWJfY2xrLmNsa19taXBpX2VjZmcpOworCWlmIChrbWJfY2xrLmNsa19taXBpX2NmZykK
KwkJY2xrX2Rpc2FibGVfdW5wcmVwYXJlKGttYl9jbGsuY2xrX21pcGlfY2ZnKTsKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIHZvaWQgX19pb21lbSAqa21iX21hcF9tbWlvKHN0cnVjdCBkcm1fZGV2
aWNlICpkcm0sIGNoYXIgKm5hbWUpCit7CisJc3RydWN0IHJlc291cmNlICpyZXM7CisJc3RydWN0
IHBsYXRmb3JtX2RldmljZSAqcGRldiA9IHRvX3BsYXRmb3JtX2RldmljZShkcm0tPmRldik7CisJ
dm9pZCBfX2lvbWVtICptZW07CisKKwlyZXMgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2VfYnluYW1l
KHBkZXYsIElPUkVTT1VSQ0VfTUVNLCBuYW1lKTsKKwlpZiAoIXJlcykgeworCQlkcm1fZXJyKGRy
bSwgImZhaWxlZCB0byBnZXQgcmVzb3VyY2UgZm9yICVzIiwgbmFtZSk7CisJCXJldHVybiBFUlJf
UFRSKC1FTk9NRU0pOworCX0KKwltZW0gPSBkZXZtX2lvcmVtYXBfcmVzb3VyY2UoZHJtLT5kZXYs
IHJlcyk7CisJaWYgKElTX0VSUihtZW0pKQorCQlkcm1fZXJyKGRybSwgImZhaWxlZCB0byBpb3Jl
bWFwICVzIHJlZ2lzdGVycyIsIG5hbWUpOworCXJldHVybiBtZW07Cit9CisKK3N0YXRpYyBpbnQg
a21iX2h3X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwgdW5zaWduZWQgbG9uZyBmbGFncykK
K3sKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKwlzdHJ1Y3Qg
cGxhdGZvcm1fZGV2aWNlICpwZGV2ID0gdG9fcGxhdGZvcm1fZGV2aWNlKGRybS0+ZGV2KTsKKwlp
bnQgaXJxX2xjZDsKKwlpbnQgcmV0ID0gMDsKKworCS8qIE1hcCBMQ0QgTU1JTyByZWdpc3RlcnMg
Ki8KKwlrbWItPmxjZF9tbWlvID0ga21iX21hcF9tbWlvKGRybSwgImxjZF9yZWdzIik7CisJaWYg
KElTX0VSUihrbWItPmxjZF9tbWlvKSkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZhaWxlZCB0
byBtYXAgTENEIHJlZ2lzdGVyc1xuIik7CisJCXJldHVybiAtRU5PTUVNOworCX0KKworCS8qIE1h
cCBNSVBJIE1NSU8gcmVnaXN0ZXJzICovCisJa21iLT5taXBpX21taW8gPSBrbWJfbWFwX21taW8o
ZHJtLCAibWlwaV9yZWdzIik7CisJaWYgKElTX0VSUihrbWItPm1pcGlfbW1pbykpIHsKKwkJZHJt
X2Vycigma21iLT5kcm0sICJmYWlsZWQgdG8gbWFwIE1JUEkgcmVnaXN0ZXJzXG4iKTsKKwkJaW91
bm1hcChrbWItPmxjZF9tbWlvKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJLyogVGhpcyBp
cyBvbmx5IGZvciBNSVBJX1RYX01TU19MQ0RfTUlQSV9DRkcgYW5kCisJICogTVNTX0NBTV9DTEtf
Q1RSTCByZWdpc3RlcgorCSAqLworCWttYi0+bXNzY2FtX21taW8gPSBrbWJfbWFwX21taW8oZHJt
LCAibXNzY2FtX3JlZ3MiKTsKKwlpZiAoSVNfRVJSKGttYi0+bXNzY2FtX21taW8pKSB7CisJCWRy
bV9lcnIoJmttYi0+ZHJtLCAiZmFpbGVkIHRvIG1hcCBNU1NDQU0gcmVnaXN0ZXJzXG4iKTsKKwkJ
aW91bm1hcChrbWItPmxjZF9tbWlvKTsKKwkJaW91bm1hcChrbWItPm1pcGlfbW1pbyk7CisJCXJl
dHVybiAtRU5PTUVNOworCX0KKworCWlmIChJU19FUlIoa21iLT5tc3NjYW1fbW1pbykpIHsKKwkJ
ZHJtX2Vycigma21iLT5kcm0sICJmYWlsZWQgdG8gbWFwIE1TU0NBTSByZWdpc3RlcnNcbiIpOwor
CQlpb3VubWFwKGttYi0+bGNkX21taW8pOworCQlpb3VubWFwKGttYi0+bWlwaV9tbWlvKTsKKwkJ
cmV0dXJuIC1FTk9NRU07CisJfQorCS8qIEVuYWJsZSBkaXNwbGF5IGNsb2NrcyAqLworCWttYl9p
bml0aWFsaXplX2Nsb2NrcyhrbWIsICZwZGV2LT5kZXYpOworCisJLyogUmVnaXN0ZXIgaXJxcyBo
ZXJlIC0gc2VjdGlvbiAxNy4zIGluIGRhdGFib29rCisJICogbGlzdHMgTENEIGF0IDc5IGFuZCA4
MiBmb3IgTUlQSSB1bmRlciBNU1MgQ1BVIC0KKwkgKiBmaXJtd2FyZSBoYXMgcmVkaXJlY3RlZCA3
OSB0byBBNTMgSVJRIDMzCisJICovCisKKwkvKiBBbGxvY2F0ZSBMQ0QgaW50ZXJydXB0IHJlc291
cmNlcyAqLworCWlycV9sY2QgPSBwbGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2LCAiaXJxX2xj
ZCIpOworCWlmIChpcnFfbGNkIDwgMCkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImlycV9sY2Qg
bm90IGZvdW5kIik7CisJCWdvdG8gc2V0dXBfZmFpbDsKKwl9CisKKwkvKiBHZXQgdGhlIG9wdGlv
bmFsIGZyYW1lYnVmZmVyIG1lbW9yeSByZXNvdXJjZSAqLworCXJldCA9IG9mX3Jlc2VydmVkX21l
bV9kZXZpY2VfaW5pdChkcm0tPmRldik7CisJaWYgKHJldCAmJiByZXQgIT0gLUVOT0RFVikKKwkJ
cmV0dXJuIHJldDsKKworCXNwaW5fbG9ja19pbml0KCZrbWItPmlycV9sb2NrKTsKKworCWttYi0+
aXJxX2xjZCA9IGlycV9sY2Q7CisKKwlyZXR1cm4gMDsKKworIHNldHVwX2ZhaWw6CisJb2ZfcmVz
ZXJ2ZWRfbWVtX2RldmljZV9yZWxlYXNlKGRybS0+ZGV2KTsKKworCXJldHVybiByZXQ7Cit9CisK
K3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGttYl9tb2RlX2NvbmZp
Z19mdW5jcyA9IHsKKwkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGUsCisJLmF0b21pY19j
aGVjayA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrLAorCS5hdG9taWNfY29tbWl0ID0gZHJtX2F0
b21pY19oZWxwZXJfY29tbWl0LAorfTsKKworc3RhdGljIGludCBrbWJfc2V0dXBfbW9kZV9jb25m
aWcoc3RydWN0IGRybV9kZXZpY2UgKmRybSkKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBrbWJfZHJt
X3ByaXZhdGUgKmttYiA9IHRvX2ttYihkcm0pOworCisJcmV0ID0gZHJtbV9tb2RlX2NvbmZpZ19p
bml0KGRybSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwlkcm0tPm1vZGVfY29uZmlnLm1p
bl93aWR0aCA9IEtNQl9NSU5fV0lEVEg7CisJZHJtLT5tb2RlX2NvbmZpZy5taW5faGVpZ2h0ID0g
S01CX01JTl9IRUlHSFQ7CisJZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGggPSBLTUJfTUFYX1dJ
RFRIOworCWRybS0+bW9kZV9jb25maWcubWF4X2hlaWdodCA9IEtNQl9NQVhfSEVJR0hUOworCWRy
bS0+bW9kZV9jb25maWcuZnVuY3MgPSAma21iX21vZGVfY29uZmlnX2Z1bmNzOworCisJcmV0ID0g
a21iX3NldHVwX2NydGMoZHJtKTsKKwlpZiAocmV0IDwgMCkgeworCQlkcm1fZXJyKGRybSwgImZh
aWxlZCB0byBjcmVhdGUgY3J0Y1xuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJLyogSW5pdGlh
bGl6ZSBNSVBJIERTSSAqLworCXJldCA9IGttYl9kc2lfaW5pdChkcm0sIGFkdl9icmlkZ2UpOwor
CWlmIChyZXQpIHsKKwkJZHJtX2Vycihkcm0sICJmYWlsZWQgdG8gaW5pdGlhbGl6ZSBEU0lcbiIp
OworCQlyZXR1cm4gcmV0OworCX0KKworCS8qIFNldCB0aGUgQ1JUQydzIHBvcnQgc28gdGhhdCB0
aGUgZW5jb2RlciBjb21wb25lbnQgY2FuIGZpbmQgaXQgKi8KKwlrbWItPmNydGMucG9ydCA9IG9m
X2dyYXBoX2dldF9wb3J0X2J5X2lkKGRybS0+ZGV2LT5vZl9ub2RlLCAwKTsKKwlyZXQgPSBkcm1f
dmJsYW5rX2luaXQoZHJtLCBkcm0tPm1vZGVfY29uZmlnLm51bV9jcnRjKTsKKwlpZiAocmV0IDwg
MCkgeworCQlkcm1fZXJyKGRybSwgImZhaWxlZCB0byBpbml0aWFsaXplIHZibGFua1xuIik7CisJ
CXBtX3J1bnRpbWVfZGlzYWJsZShkcm0tPmRldik7CisJCXJldHVybiByZXQ7CisJfQorCisJZHJt
X21vZGVfY29uZmlnX3Jlc2V0KGRybSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpcnFyZXR1
cm5fdCBoYW5kbGVfbGNkX2lycShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQoreworCXVuc2lnbmVk
IGxvbmcgc3RhdHVzLCB2YWwsIHZhbDE7CisJaW50IHBsYW5lX2lkLCBkbWEwX3N0YXRlLCBkbWEx
X3N0YXRlOworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9IHRvX2ttYihkZXYpOworCisJ
c3RhdHVzID0ga21iX3JlYWRfbGNkKGttYiwgTENEX0lOVF9TVEFUVVMpOworCisJaWYgKHN0YXR1
cyAmIExDRF9JTlRfRU9GKSB7CisJCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBM
Q0RfSU5UX0VPRik7CisKKwkJLyogV2hlbiBkaXNhYmxpbmcvZW5hYmxpbmcgTENEIGxheWVycywg
dGhlIGNoYW5nZSB0YWtlcyBlZmZlY3QKKwkJICogaW1tZWRpYXRlbHkgYW5kIGRvZXMgbm90IHdh
aXQgZm9yIEVPRiAoZW5kIG9mIGZyYW1lKS4KKwkJICogV2hlbiBrbWJfcGxhbmVfYXRvbWljX2Rp
c2FibGUgaXMgY2FsbGVkLCBtYXJrIHRoZSBwbGFuZSBhcworCQkgKiBkaXNhYmxlZCBidXQgYWN0
dWFsbHkgZGlzYWJsZSB0aGUgcGxhbmUgd2hlbiBFT0YgaXJxIGlzCisJCSAqIGJlaW5nIGhhbmRs
ZWQuCisJCSAqLworCQlmb3IgKHBsYW5lX2lkID0gTEFZRVJfMDsKKwkJCQlwbGFuZV9pZCA8IEtN
Ql9NQVhfUExBTkVTOyBwbGFuZV9pZCsrKSB7CisJCQlpZiAoa21iLT5wbGFuZV9zdGF0dXNbcGxh
bmVfaWRdLmRpc2FibGUpIHsKKwkJCQlrbWJfY2xyX2JpdG1hc2tfbGNkKGttYiwKKwkJCQkJCSAg
ICBMQ0RfTEFZRVJuX0RNQV9DRkcKKwkJCQkJCSAgICAocGxhbmVfaWQpLAorCQkJCQkJICAgIExD
RF9ETUFfTEFZRVJfRU5BQkxFKTsKKworCQkJCWttYl9jbHJfYml0bWFza19sY2Qoa21iLCBMQ0Rf
Q09OVFJPTCwKKwkJCQkJCSAgICBrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uY3RybCk7CisK
KwkJCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uZGlzYWJsZSA9IGZhbHNlOworCQkJfQor
CQl9CisJCWlmIChrbWJfdW5kZXJfZmxvdykgeworCQkJLyogRE1BIFJlY292ZXJ5IGFmdGVyIHVu
ZGVyZmxvdyAqLworCQkJZG1hMF9zdGF0ZSA9IChsYXllcl9ubyA9PSAwKSA/CisJCQkgICAgTENE
X1ZJREVPMF9ETUEwX1NUQVRFIDogTENEX1ZJREVPMV9ETUEwX1NUQVRFOworCQkJZG1hMV9zdGF0
ZSA9IChsYXllcl9ubyA9PSAwKSA/CisJCQkgICAgTENEX1ZJREVPMF9ETUExX1NUQVRFIDogTENE
X1ZJREVPMV9ETUExX1NUQVRFOworCisJCQlkbyB7CisJCQkJa21iX3dyaXRlX2xjZChrbWIsIExD
RF9GSUZPX0ZMVVNILCAxKTsKKwkJCQl2YWwgPSBrbWJfcmVhZF9sY2Qoa21iLCBkbWEwX3N0YXRl
KQorCQkJCSAgICAmIExDRF9ETUFfU1RBVEVfQUNUSVZFOworCQkJCXZhbDEgPSBrbWJfcmVhZF9s
Y2Qoa21iLCBkbWExX3N0YXRlKQorCQkJCSAgICAmIExDRF9ETUFfU1RBVEVfQUNUSVZFOworCQkJ
fSB3aGlsZSAoKHZhbCB8fCB2YWwxKSk7CisJCQkvKiBkaXNhYmxlIGRtYSAqLworCQkJa21iX2Ns
cl9iaXRtYXNrX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NGRyhsYXllcl9ubyksCisJCQkJCSAg
ICBMQ0RfRE1BX0xBWUVSX0VOQUJMRSk7CisJCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0ZJRk9f
RkxVU0gsIDEpOworCQkJa21iX2ZsdXNoX2RvbmUgPSAxOworCQkJa21iX3VuZGVyX2Zsb3cgPSAw
OworCQl9CisJfQorCisJaWYgKHN0YXR1cyAmIExDRF9JTlRfTElORV9DTVApIHsKKwkJLyogY2xl
YXIgbGluZSBjb21wYXJlIGludGVycnVwdCAqLworCQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0lO
VF9DTEVBUiwgTENEX0lOVF9MSU5FX0NNUCk7CisJfQorCisJaWYgKHN0YXR1cyAmIExDRF9JTlRf
VkVSVF9DT01QKSB7CisJCS8qIFJlYWQgVlNUQVRVUyAqLworCQl2YWwgPSBrbWJfcmVhZF9sY2Qo
a21iLCBMQ0RfVlNUQVRVUyk7CisJCXZhbCA9ICh2YWwgJiBMQ0RfVlNUQVRVU19WRVJUSUNBTF9T
VEFUVVNfTUFTSyk7CisJCXN3aXRjaCAodmFsKSB7CisJCWNhc2UgTENEX1ZTVEFUVVNfQ09NUEFS
RV9WU1lOQzoKKwkJCS8qIENsZWFyIHZlcnRpY2FsIGNvbXBhcmUgaW50ZXJydXB0ICovCisJCQlr
bWJfd3JpdGVfbGNkKGttYiwgTENEX0lOVF9DTEVBUiwgTENEX0lOVF9WRVJUX0NPTVApOworCQkJ
aWYgKGttYl9mbHVzaF9kb25lKSB7CisJCQkJa21iX3NldF9iaXRtYXNrX2xjZChrbWIsCisJCQkJ
CQkgICAgTENEX0xBWUVSbl9ETUFfQ0ZHCisJCQkJCQkgICAgKGxheWVyX25vKSwKKwkJCQkJCSAg
ICBMQ0RfRE1BX0xBWUVSX0VOQUJMRSk7CisJCQkJa21iX2ZsdXNoX2RvbmUgPSAwOworCQkJfQor
CQkJZHJtX2hhbmRsZV92YmxhbmsoZGV2LCAwKTsKKwkJCWJyZWFrOworCQljYXNlIExDRF9WU1RB
VFVTX0NPTVBBUkVfQkFDS1BPUkNIOgorCQljYXNlIExDRF9WU1RBVFVTX0NPTVBBUkVfQUNUSVZF
OgorCQljYXNlIExDRF9WU1RBVFVTX0NPTVBBUkVfRlJPTlRfUE9SQ0g6CisJCQlrbWJfd3JpdGVf
bGNkKGttYiwgTENEX0lOVF9DTEVBUiwgTENEX0lOVF9WRVJUX0NPTVApOworCQkJYnJlYWs7CisJ
CX0KKwl9CisJaWYgKHN0YXR1cyAmIExDRF9JTlRfRE1BX0VSUikgeworCQl2YWwgPQorCQkgICAg
KHN0YXR1cyAmIExDRF9JTlRfRE1BX0VSUiAmCisJCSAgICAga21iX3JlYWRfbGNkKGttYiwgTENE
X0lOVF9FTkFCTEUpKTsKKwkJLyogTEFZRVIwIC0gVkwwICovCisJCWlmICh2YWwgJiAoTEFZRVIw
X0RNQV9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjBfRE1BX0NCX0ZJRk9fVU5ERVJGTE9X
IHwKKwkJCSAgIExBWUVSMF9ETUFfQ1JfRklGT19VTkRFUkZMT1cpKSB7CisJCQlrbWJfdW5kZXJf
ZmxvdysrOworCQkJZHJtX2luZm8oJmttYi0+ZHJtLAorCQkJCSAiIUxBWUVSMDpWTDAgRE1BIFVO
REVSRkxPVyB2YWwgPSAweCVseCx1bmRlcl9mbG93PSVkIiwKKwkJCSAgICAgdmFsLCBrbWJfdW5k
ZXJfZmxvdyk7CisJCQkvKiBkaXNhYmxlIHVuZGVyZmxvdyBpbnRlcnJ1cHQgKi8KKwkJCWttYl9j
bHJfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0VOQUJMRSwKKwkJCQkJICAgIExBWUVSMF9ETUFf
RklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIwX0RNQV9DQl9GSUZPX1VOREVSRkxPVyB8
CisJCQkJCSAgICBMQVlFUjBfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKTsKKwkJCWttYl9zZXRfYml0
bWFza19sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLAorCQkJCQkgICAgTEFZRVIwX0RNQV9DQl9GSUZP
X1VOREVSRkxPVyB8CisJCQkJCSAgICBMQVlFUjBfRE1BX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJ
ICAgIExBWUVSMF9ETUFfQ1JfRklGT19VTkRFUkZMT1cpOworCQkJLyogZGlzYWJsZSBhdXRvIHJl
c3RhcnQgbW9kZSAqLworCQkJa21iX2Nscl9iaXRtYXNrX2xjZChrbWIsIExDRF9MQVlFUm5fRE1B
X0NGRygwKSwKKwkJCQkJICAgIExDRF9ETUFfTEFZRVJfQ09OVF9QSU5HX1BPTkdfVVBEQVRFKTsK
KwkJCWxheWVyX25vID0gMDsKKwkJfQorCisJCWlmICh2YWwgJiBMQVlFUjBfRE1BX0ZJRk9fT1ZF
UkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIwOlZMMCBETUEgT1ZFUkZM
T1cgdmFsID0gMHglbHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIwX0RNQV9DQl9GSUZPX09W
RVJGTE9XKQorCQkJZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMDpWTDAgRE1BIENCIE9W
RVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAmIExBWUVSMF9ETUFfQ1JfRklG
T19PVkVSRkxPVykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjA6VkwwIERNQSBD
UiBPVkVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisKKwkJLyogTEFZRVIxIC0gVkwxICovCisJ
CWlmICh2YWwgJiAoTEFZRVIxX0RNQV9GSUZPX1VOREVSRkxPVyB8CisJCQkgICBMQVlFUjFfRE1B
X0NCX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCSAgIExBWUVSMV9ETUFfQ1JfRklGT19VTkRFUkZMT1cp
KSB7CisJCQlrbWJfdW5kZXJfZmxvdysrOworCQkJZHJtX2luZm8oJmttYi0+ZHJtLAorCQkJCSAi
IUxBWUVSMTpWTDEgRE1BIFVOREVSRkxPVyB2YWwgPSAweCVseCwgdW5kZXJfZmxvdz0lZCIsCisJ
CQkgICAgIHZhbCwga21iX3VuZGVyX2Zsb3cpOworCQkJLyogZGlzYWJsZSB1bmRlcmZsb3cgaW50
ZXJydXB0ICovCisJCQlrbWJfY2xyX2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9FTkFCTEUsCisJ
CQkJCSAgICBMQVlFUjFfRE1BX0ZJRk9fVU5ERVJGTE9XIHwKKwkJCQkJICAgIExBWUVSMV9ETUFf
Q0JfRklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIxX0RNQV9DUl9GSUZPX1VOREVSRkxP
Vyk7CisJCQlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0lOVF9DTEVBUiwKKwkJCQkJICAg
IExBWUVSMV9ETUFfQ0JfRklGT19VTkRFUkZMT1cgfAorCQkJCQkgICAgTEFZRVIxX0RNQV9GSUZP
X1VOREVSRkxPVyB8CisJCQkJCSAgICBMQVlFUjFfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKTsKKwkJ
CS8qIGRpc2FibGUgYXV0byByZXN0YXJ0IG1vZGUgKi8KKwkJCWttYl9jbHJfYml0bWFza19sY2Qo
a21iLCBMQ0RfTEFZRVJuX0RNQV9DRkcoMSksCisJCQkJCSAgICBMQ0RfRE1BX0xBWUVSX0NPTlRf
UElOR19QT05HX1VQREFURSk7CisJCQlsYXllcl9ubyA9IDE7CisJCX0KKworCQkvKiBMQVlFUjEg
LSBWTDEgKi8KKwkJaWYgKHZhbCAmIExBWUVSMV9ETUFfRklGT19PVkVSRkxPVykKKwkJCWRybV9k
YmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjE6VkwxIERNQSBPVkVSRkxPVyB2YWwgPSAweCVseCIs
IHZhbCk7CisJCWlmICh2YWwgJiBMQVlFUjFfRE1BX0NCX0ZJRk9fT1ZFUkZMT1cpCisJCQlkcm1f
ZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIxOlZMMSBETUEgQ0IgT1ZFUkZMT1cgdmFsID0gMHgl
bHgiLCB2YWwpOworCQlpZiAodmFsICYgTEFZRVIxX0RNQV9DUl9GSUZPX09WRVJGTE9XKQorCQkJ
ZHJtX2RiZygma21iLT5kcm0sCisJCQkJIkxBWUVSMTpWTDEgRE1BIENSIE9WRVJGTE9XIHZhbCA9
IDB4JWx4IiwgdmFsKTsKKworCQkvKiBMQVlFUjIgLSBHTDAgKi8KKwkJaWYgKHZhbCAmIExBWUVS
Ml9ETUFfRklGT19VTkRFUkZMT1cpCisJCQlkcm1fZGJnKCZrbWItPmRybSwKKwkJCQkiTEFZRVIy
OkdMMCBETUEgVU5ERVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFsKTsKKwkJaWYgKHZhbCAmIExBWUVS
Ml9ETUFfRklGT19PVkVSRkxPVykKKwkJCWRybV9kYmcoJmttYi0+ZHJtLAorCQkJCSJMQVlFUjI6
R0wwIERNQSBPVkVSRkxPVyB2YWwgPSAweCVseCIsIHZhbCk7CisKKwkJLyogTEFZRVIzIC0gR0wx
ICovCisJCWlmICh2YWwgJiBMQVlFUjNfRE1BX0ZJRk9fVU5ERVJGTE9XKQorCQkJZHJtX2RiZygm
a21iLT5kcm0sCisJCQkJIkxBWUVSMzpHTDEgRE1BIFVOREVSRkxPVyB2YWwgPSAweCVseCIsIHZh
bCk7CisJCWlmICh2YWwgJiBMQVlFUjNfRE1BX0ZJRk9fVU5ERVJGTE9XKQorCQkJZHJtX2RiZygm
a21iLT5kcm0sCisJCQkJIkxBWUVSMzpHTDEgRE1BIE9WRVJGTE9XIHZhbCA9IDB4JWx4IiwgdmFs
KTsKKwl9CisKKwlpZiAoc3RhdHVzICYgTENEX0lOVF9MQVlFUikgeworCQkvKiBDbGVhciBsYXll
ciBpbnRlcnJ1cHRzICovCisJCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0Rf
SU5UX0xBWUVSKTsKKwl9CisKKwkvKiBDbGVhciBhbGwgaW50ZXJydXB0cyAqLworCWttYl9zZXRf
Yml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCAxKTsKKwlyZXR1cm4gSVJRX0hBTkRMRUQ7
Cit9CisKKy8qIElSUSBoYW5kbGVyICovCitzdGF0aWMgaXJxcmV0dXJuX3Qga21iX2lzcihpbnQg
aXJxLCB2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IChzdHJ1Y3QgZHJt
X2RldmljZSAqKWFyZzsKKworCWhhbmRsZV9sY2RfaXJxKGRldik7CisJcmV0dXJuIElSUV9IQU5E
TEVEOworfQorCitzdGF0aWMgdm9pZCBrbWJfaXJxX3Jlc2V0KHN0cnVjdCBkcm1fZGV2aWNlICpk
cm0pCit7CisJa21iX3dyaXRlX2xjZCh0b19rbWIoZHJtKSwgTENEX0lOVF9DTEVBUiwgMHhGRkZG
KTsKKwlrbWJfd3JpdGVfbGNkKHRvX2ttYihkcm0pLCBMQ0RfSU5UX0VOQUJMRSwgMCk7Cit9CisK
K0RFRklORV9EUk1fR0VNX0NNQV9GT1BTKGZvcHMpOworCitzdGF0aWMgc3RydWN0IGRybV9kcml2
ZXIga21iX2RyaXZlciA9IHsKKwkuZHJpdmVyX2ZlYXR1cmVzID0gRFJJVkVSX0dFTSB8CisJICAg
IERSSVZFUl9NT0RFU0VUIHwgRFJJVkVSX0FUT01JQywKKwkuaXJxX2hhbmRsZXIgPSBrbWJfaXNy
LAorCS5pcnFfcHJlaW5zdGFsbCA9IGttYl9pcnFfcmVzZXQsCisJLmlycV91bmluc3RhbGwgPSBr
bWJfaXJxX3Jlc2V0LAorCS8qIEdFTSBPcGVyYXRpb25zICovCisJLmZvcHMgPSAmZm9wcywKKwlE
Uk1fR0VNX0NNQV9EUklWRVJfT1BTX1ZNQVAsCisJLm5hbWUgPSAia21iLWRybSIsCisJLmRlc2Mg
PSAiS0VFTUJBWSBESVNQTEFZIERSSVZFUiAiLAorCS5kYXRlID0gIjIwMTkwMTIyIiwKKwkubWFq
b3IgPSAxLAorCS5taW5vciA9IDAsCit9OworCitzdGF0aWMgaW50IGttYl9yZW1vdmUoc3RydWN0
IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmcGRldi0+
ZGV2OworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwlz
dHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKworCWRybV9kZXZfdW5y
ZWdpc3Rlcihkcm0pOworCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaShkcm0pOworCW9mX25vZGVf
cHV0KGttYi0+Y3J0Yy5wb3J0KTsKKwlrbWItPmNydGMucG9ydCA9IE5VTEw7CisJcG1fcnVudGlt
ZV9nZXRfc3luYyhkcm0tPmRldik7CisJZHJtX2lycV91bmluc3RhbGwoZHJtKTsKKwlwbV9ydW50
aW1lX3B1dF9zeW5jKGRybS0+ZGV2KTsKKwlwbV9ydW50aW1lX2Rpc2FibGUoZHJtLT5kZXYpOwor
CisJb2ZfcmVzZXJ2ZWRfbWVtX2RldmljZV9yZWxlYXNlKGRybS0+ZGV2KTsKKworCS8qIFJlbGVh
c2UgY2xrcyAqLworCWttYl9kaXNwbGF5X2Nsa19kaXNhYmxlKCk7CisJY2xrX3B1dChrbWJfY2xr
LmNsa19sY2QpOworCWNsa19wdXQoa21iX2Nsay5jbGtfbWlwaSk7CisKKwlkZXZfc2V0X2RydmRh
dGEoZGV2LCBOVUxMKTsKKworCS8qIFVucmVnaXN0ZXIgRFNJIGhvc3QgKi8KKwlrbWJfZHNpX2hv
c3RfdW5yZWdpc3RlcigpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGttYl9wcm9iZShz
dHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9IGdl
dF9kZXZpY2UoJnBkZXYtPmRldik7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqa21iOworCWlu
dCByZXQgPSAwOworCisJLyogVGhlIGJyaWRnZSAoQURWIDc1MzUpIHdpbGwgcmV0dXJuIC1FUFJP
QkVfREVGRVIgdW50aWwgaXQKKwkgKiBoYXMgYSBtaXBpX2RzaV9ob3N0IHRvIHJlZ2lzdGVyIGl0
cyBkZXZpY2UgdG8uIFNvLCB3ZQorCSAqIGZpcnN0IHJlZ2lzdGVyIHRoZSBEU0kgaG9zdCBkdXJp
bmcgcHJvYmUgdGltZSwgYW5kIHRoZW4gcmV0dXJuCisJICogLUVQUk9CRV9ERUZFUiB1bnRpbCB0
aGUgYnJpZGdlIGlzIGxvYWRlZC4gUHJvYmUgd2lsbCBiZSBjYWxsZWQgYWdhaW4KKwkgKiAgYW5k
IHRoZW4gdGhlIHJlc3Qgb2YgdGhlIGRyaXZlciBpbml0aWFsaXphdGlvbiBjYW4gcHJvY2VlZAor
CSAqICBhZnRlcndhcmRzIGFuZCB0aGUgYnJpZGdlIGNhbiBiZSBzdWNjZXNzZnVsbHkgYXR0YWNo
ZWQuCisJICovCisJYWR2X2JyaWRnZSA9IGttYl9kc2lfaG9zdF9icmlkZ2VfaW5pdChkZXYpOwor
CisJaWYgKGFkdl9icmlkZ2UgPT0gRVJSX1BUUigtRVBST0JFX0RFRkVSKSkgeworCQlyZXR1cm4g
LUVQUk9CRV9ERUZFUjsKKwl9IGVsc2UgaWYgKElTX0VSUihhZHZfYnJpZGdlKSkgeworCQlEUk1f
RVJST1IoInByb2JlIGZhaWxlZCB0byBpbml0aWFsaXplIERTSSBob3N0IGJyaWRnZVxuIik7CisJ
CXJldHVybiBQVFJfRVJSKGFkdl9icmlkZ2UpOworCX0KKworCS8qIENyZWF0ZSBEUk0gZGV2aWNl
ICovCisJa21iID0gZGV2bV9kcm1fZGV2X2FsbG9jKGRldiwgJmttYl9kcml2ZXIsCisJCQkJIHN0
cnVjdCBrbWJfZHJtX3ByaXZhdGUsIGRybSk7CisJaWYgKElTX0VSUihrbWIpKQorCQlyZXR1cm4g
UFRSX0VSUihrbWIpOworCisJZGV2X3NldF9kcnZkYXRhKGRldiwgJmttYi0+ZHJtKTsKKworCXJl
dCA9IGttYl9od19pbml0KCZrbWItPmRybSwgMCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZnJl
ZTE7CisKKwlyZXQgPSBrbWJfc2V0dXBfbW9kZV9jb25maWcoJmttYi0+ZHJtKTsKKwlpZiAocmV0
KQorCQlnb3RvIGVycl9mcmVlOworCisJcmV0ID0gZHJtX2lycV9pbnN0YWxsKCZrbWItPmRybSwg
a21iLT5pcnFfbGNkKTsKKwlpZiAocmV0IDwgMCkgeworCQlkcm1fZXJyKCZrbWItPmRybSwgImZh
aWxlZCB0byBpbnN0YWxsIElSUSBoYW5kbGVyXG4iKTsKKwkJZ290byBlcnJfaXJxOworCX0KKwor
CWRybV9rbXNfaGVscGVyX3BvbGxfaW5pdCgma21iLT5kcm0pOworCisJLyogUmVnaXN0ZXIgZ3Jh
cGhpY3MgZGV2aWNlIHdpdGggdGhlIGtlcm5lbCAqLworCXJldCA9IGRybV9kZXZfcmVnaXN0ZXIo
JmttYi0+ZHJtLCAwKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9yZWdpc3RlcjsKKworCXJldHVy
biAwOworCisgZXJyX3JlZ2lzdGVyOgorCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaSgma21iLT5k
cm0pOworIGVycl9pcnE6CisJcG1fcnVudGltZV9kaXNhYmxlKGttYi0+ZHJtLmRldik7CisgZXJy
X2ZyZWU6CisJZHJtX2NydGNfY2xlYW51cCgma21iLT5jcnRjKTsKKwlkcm1fbW9kZV9jb25maWdf
Y2xlYW51cCgma21iLT5kcm0pOworIGVycl9mcmVlMToKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBO
VUxMKTsKKwlrbWJfZHNpX2hvc3RfdW5yZWdpc3RlcigpOworCisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQga21iX29mX21hdGNoW10gPSB7CisJey5j
b21wYXRpYmxlID0gImludGVsLGttYl9kaXNwbGF5In0sCisJe30sCit9OworCitNT0RVTEVfREVW
SUNFX1RBQkxFKG9mLCBrbWJfb2ZfbWF0Y2gpOworCitzdGF0aWMgaW50IF9fbWF5YmVfdW51c2Vk
IGttYl9wbV9zdXNwZW5kKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZHJtID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisJc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAq
a21iID0gZHJtID8gdG9fa21iKGRybSkgOiBOVUxMOworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9k
aXNhYmxlKGRybSk7CisKKwlrbWItPnN0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfc3VzcGVuZChk
cm0pOworCWlmIChJU19FUlIoa21iLT5zdGF0ZSkpIHsKKwkJZHJtX2ttc19oZWxwZXJfcG9sbF9l
bmFibGUoZHJtKTsKKwkJcmV0dXJuIFBUUl9FUlIoa21iLT5zdGF0ZSk7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgX19tYXliZV91bnVzZWQga21iX3BtX3Jlc3VtZShzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IGRldl9nZXRfZHJ2ZGF0
YShkZXYpOworCXN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmttYiA9IGRybSA/IHRvX2ttYihkcm0p
IDogTlVMTDsKKworCWlmICgha21iKQorCQlyZXR1cm4gMDsKKworCWRybV9hdG9taWNfaGVscGVy
X3Jlc3VtZShkcm0sIGttYi0+c3RhdGUpOworCWRybV9rbXNfaGVscGVyX3BvbGxfZW5hYmxlKGRy
bSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIFNJTVBMRV9ERVZfUE1fT1BTKGttYl9wbV9v
cHMsIGttYl9wbV9zdXNwZW5kLCBrbWJfcG1fcmVzdW1lKTsKKworc3RhdGljIHN0cnVjdCBwbGF0
Zm9ybV9kcml2ZXIga21iX3BsYXRmb3JtX2RyaXZlciA9IHsKKwkucHJvYmUgPSBrbWJfcHJvYmUs
CisJLnJlbW92ZSA9IGttYl9yZW1vdmUsCisJLmRyaXZlciA9IHsKKwkJLm5hbWUgPSAia21iLWRy
bSIsCisJCS5wbSA9ICZrbWJfcG1fb3BzLAorCQkub2ZfbWF0Y2hfdGFibGUgPSBrbWJfb2ZfbWF0
Y2gsCisJfSwKK307CisKK21vZHVsZV9wbGF0Zm9ybV9kcml2ZXIoa21iX3BsYXRmb3JtX2RyaXZl
cik7CisKK01PRFVMRV9BVVRIT1IoIkludGVsIENvcnBvcmF0aW9uIik7CitNT0RVTEVfREVTQ1JJ
UFRJT04oIktlZW1iYXkgRGlzcGxheSBkcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwgdjIi
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5oIGIvZHJpdmVycy9n
cHUvZHJtL2ttYi9rbWJfZHJ2LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4u
MzUyZjJkMgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX2Rydi5o
CkBAIC0wLDAgKzEsMTcwIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1v
bmx5CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpZm5kZWYgX19LTUJfRFJWX0hfXworI2RlZmluZSBfX0tNQl9EUlZfSF9fCisKKyNpbmNs
dWRlICJrbWJfcGxhbmUuaCIKKyNpbmNsdWRlICJrbWJfcmVncy5oIgorCisjZGVmaW5lIEtNQl9N
QVhfV0lEVEgJCQkxOTIwIC8qbWF4IHdpZHRoIGluIHBpeGVscyAqLworI2RlZmluZSBLTUJfTUFY
X0hFSUdIVAkJCTEwODAgLyptYXggaGVpZ2h0IGluIHBpeGVscyAqLworI2RlZmluZSBLTUJfTUlO
X1dJRFRIICAgICAgICAgICAgICAgICAgIDE5MjAgLyptYXggd2lkdGggaW4gcGl4ZWxzICovCisj
ZGVmaW5lIEtNQl9NSU5fSEVJR0hUICAgICAgICAgICAgICAgICAgMTA4MCAvKm1heCBoZWlnaHQg
aW4gcGl4ZWxzICovCisjZGVmaW5lIEtNQl9MQ0RfREVGQVVMVF9DTEsJCTIwMDAwMDAwMAorI2Rl
ZmluZSBLTUJfTUlQSV9ERUZBVUxUX0NMSwkJMjQwMDAwMDAKKyNkZWZpbmUgS01CX01JUElfREVG
QVVMVF9DRkdfQ0xLCTI0MDAwMDAwCisjZGVmaW5lIEtNQl9TWVNfQ0xLX01IWgkJCTUwMAorCisj
ZGVmaW5lIElDQU1fTU1JTwkJMHgzYjEwMDAwMAorI2RlZmluZSBJQ0FNX0xDRF9PRkZTRVQJCTB4
MTA4MAorI2RlZmluZSBJQ0FNX01NSU9fU0laRQkJMHgyMDAwCisKK3N0cnVjdCBrbWJfZHJtX3By
aXZhdGUgeworCXN0cnVjdCBkcm1fZGV2aWNlCQlkcm07CisJdm9pZCBfX2lvbWVtCQkJKmxjZF9t
bWlvOworCXZvaWQgX19pb21lbQkJCSptaXBpX21taW87CisJdm9pZCBfX2lvbWVtCQkJKm1zc2Nh
bV9tbWlvOworCXN0cnVjdCBjbGsJCQkqY2xrOworCXN0cnVjdCBkcm1fY3J0YwkJCWNydGM7CisJ
c3RydWN0IGttYl9wbGFuZQkJKnBsYW5lOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlCQkqc3Rh
dGU7CisJc3BpbmxvY2tfdAkJCWlycV9sb2NrOworCWludAkJCQlpcnFfbGNkOworCWludAkJCQlp
cnFfbWlwaTsKKwlpbnQJCQkJc3lzX2Nsa19taHo7CisJZG1hX2FkZHJfdAkJCWZiX2FkZHI7CisJ
c3RydWN0IGxheWVyX3N0YXR1cwkJcGxhbmVfc3RhdHVzW0tNQl9NQVhfUExBTkVTXTsKK307CisK
K3N0cnVjdCBrbWJfY2xvY2sgeworCXN0cnVjdCBjbGsgKmNsa19sY2Q7CisJc3RydWN0IGNsayAq
Y2xrX21pcGk7CisJc3RydWN0IGNsayAqY2xrX21pcGlfZWNmZzsKKwlzdHJ1Y3QgY2xrICpjbGtf
bWlwaV9jZmc7CisJc3RydWN0IGNsayAqY2xrX3BsbDA7Cit9OworCitzdGF0aWMgaW5saW5lIHN0
cnVjdCBrbWJfZHJtX3ByaXZhdGUgKnRvX2ttYihjb25zdCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQoreworCXJldHVybiBjb250YWluZXJfb2YoZGV2LCBzdHJ1Y3Qga21iX2RybV9wcml2YXRlLCBk
cm0pOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmNydGNfdG9f
a21iX3ByaXYoY29uc3Qgc3RydWN0IGRybV9jcnRjICp4KQoreworCXJldHVybiBjb250YWluZXJf
b2YoeCwgc3RydWN0IGttYl9kcm1fcHJpdmF0ZSwgY3J0Yyk7Cit9CisKK3N0cnVjdCBibHRfbGF5
ZXJfY29uZmlnIHsKKwl1bnNpZ25lZCBjaGFyIGxheWVyX2Zvcm1hdDsKK307CisKK3N0YXRpYyBp
bmxpbmUgdm9pZCBrbWJfd3JpdGVfbGNkKHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmRldl9wLAor
CQkJCSB1bnNpZ25lZCBpbnQgcmVnLCB1MzIgdmFsdWUpCit7CisJd3JpdGVsKHZhbHVlLCAoZGV2
X3AtPmxjZF9tbWlvICsgcmVnKSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfd3JpdGVf
bWlwaShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkgIHVuc2lnbmVkIGludCBy
ZWcsIHUzMiB2YWx1ZSkKK3sKKwl3cml0ZWwodmFsdWUsIChkZXZfcC0+bWlwaV9tbWlvICsgcmVn
KSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfd3JpdGVfbXNzY2FtKHN0cnVjdCBrbWJf
ZHJtX3ByaXZhdGUgKmRldl9wLAorCQkJCSAgICB1bnNpZ25lZCBpbnQgcmVnLCB1MzIgdmFsdWUp
Cit7CisJd3JpdGVsKHZhbHVlLCAoZGV2X3AtPm1zc2NhbV9tbWlvICsgcmVnKSk7Cit9CisKK3N0
YXRpYyBpbmxpbmUgdTMyIGttYl9yZWFkX21zc2NhbShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpk
ZXZfcCwKKwkJCQkgIHVuc2lnbmVkIGludCByZWcpCit7CisJcmV0dXJuIHJlYWRsKGRldl9wLT5t
c3NjYW1fbW1pbyArIHJlZyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfc2V0X2JpdG1h
c2tfbXNzY2FtKHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmRldl9wLAorCQkJCQkgIHVuc2lnbmVk
IGludCByZWcsIHUzMiBtYXNrKQoreworCXUzMiByZWdfdmFsID0ga21iX3JlYWRfbXNzY2FtKGRl
dl9wLCByZWcpOworCisJa21iX3dyaXRlX21zc2NhbShkZXZfcCwgcmVnLCAocmVnX3ZhbCB8IG1h
c2spKTsKK30KKworc3RhdGljIGlubGluZSB1MzIga21iX3JlYWRfbGNkKHN0cnVjdCBrbWJfZHJt
X3ByaXZhdGUgKmRldl9wLCB1bnNpZ25lZCBpbnQgcmVnKQoreworCXJldHVybiByZWFkbChkZXZf
cC0+bGNkX21taW8gKyByZWcpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX3NldF9iaXRt
YXNrX2xjZChzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkgICAgICAgdW5zaWdu
ZWQgaW50IHJlZywgdTMyIG1hc2spCit7CisJdTMyIHJlZ192YWwgPSBrbWJfcmVhZF9sY2QoZGV2
X3AsIHJlZyk7CisKKwlrbWJfd3JpdGVfbGNkKGRldl9wLCByZWcsIChyZWdfdmFsIHwgbWFzaykp
OworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX2Nscl9iaXRtYXNrX2xjZChzdHJ1Y3Qga21i
X2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkgICAgICAgdW5zaWduZWQgaW50IHJlZywgdTMyIG1h
c2spCit7CisJdTMyIHJlZ192YWwgPSBrbWJfcmVhZF9sY2QoZGV2X3AsIHJlZyk7CisKKwlrbWJf
d3JpdGVfbGNkKGRldl9wLCByZWcsIChyZWdfdmFsICYgKH5tYXNrKSkpOworfQorCitzdGF0aWMg
aW5saW5lIHUzMiBrbWJfcmVhZF9taXBpKHN0cnVjdCBrbWJfZHJtX3ByaXZhdGUgKmRldl9wLCB1
bnNpZ25lZCBpbnQgcmVnKQoreworCXJldHVybiByZWFkbChkZXZfcC0+bWlwaV9tbWlvICsgcmVn
KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl93cml0ZV9iaXRzX21pcGkoc3RydWN0IGtt
Yl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgICAgIHVuc2lnbmVkIGludCByZWcsIHUzMiBv
ZmZzZXQsCisJCQkJICAgICAgIHUzMiBudW1fYml0cywgdTMyIHZhbHVlKQoreworCXUzMiByZWdf
dmFsID0ga21iX3JlYWRfbWlwaShkZXZfcCwgcmVnKTsKKwl1MzIgbWFzayA9ICgxIDw8IG51bV9i
aXRzKSAtIDE7CisKKwl2YWx1ZSAmPSBtYXNrOworCW1hc2sgPDw9IG9mZnNldDsKKwlyZWdfdmFs
ICY9ICh+bWFzayk7CisJcmVnX3ZhbCB8PSAodmFsdWUgPDwgb2Zmc2V0KTsKKwlrbWJfd3JpdGVf
bWlwaShkZXZfcCwgcmVnLCByZWdfdmFsKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGttYl9z
ZXRfYml0X21pcGkoc3RydWN0IGttYl9kcm1fcHJpdmF0ZSAqZGV2X3AsCisJCQkJICAgIHVuc2ln
bmVkIGludCByZWcsIHUzMiBvZmZzZXQpCit7CisJdTMyIHJlZ192YWwgPSBrbWJfcmVhZF9taXBp
KGRldl9wLCByZWcpOworCisJa21iX3dyaXRlX21pcGkoZGV2X3AsIHJlZywgcmVnX3ZhbCB8ICgx
IDw8IG9mZnNldCkpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQga21iX2Nscl9iaXRfbWlwaShz
dHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkgICAgdW5zaWduZWQgaW50IHJlZywg
dTMyIG9mZnNldCkKK3sKKwl1MzIgcmVnX3ZhbCA9IGttYl9yZWFkX21pcGkoZGV2X3AsIHJlZyk7
CisKKwlrbWJfd3JpdGVfbWlwaShkZXZfcCwgcmVnLCByZWdfdmFsICYgKH4oMSA8PCBvZmZzZXQp
KSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBrbWJfc2V0X2JpdG1hc2tfbWlwaShzdHJ1Y3Qg
a21iX2RybV9wcml2YXRlICpkZXZfcCwKKwkJCQkJdW5zaWduZWQgaW50IHJlZywgdTMyIG1hc2sp
Cit7CisJdTMyIHJlZ192YWwgPSBrbWJfcmVhZF9taXBpKGRldl9wLCByZWcpOworCisJa21iX3dy
aXRlX21pcGkoZGV2X3AsIHJlZywgKHJlZ192YWwgfCBtYXNrKSk7Cit9CisKK3N0YXRpYyBpbmxp
bmUgdm9pZCBrbWJfY2xyX2JpdG1hc2tfbWlwaShzdHJ1Y3Qga21iX2RybV9wcml2YXRlICpkZXZf
cCwKKwkJCQkJdW5zaWduZWQgaW50IHJlZywgdTMyIG1hc2spCit7CisJdTMyIHJlZ192YWwgPSBr
bWJfcmVhZF9taXBpKGRldl9wLCByZWcpOworCisJa21iX3dyaXRlX21pcGkoZGV2X3AsIHJlZywg
KHJlZ192YWwgJiAofm1hc2spKSk7Cit9CisKK2ludCBrbWJfc2V0dXBfY3J0YyhzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KTsKK3ZvaWQga21iX3NldF9zY2Fub3V0KHN0cnVjdCBrbWJfZHJtX3ByaXZh
dGUgKmxjZCk7CisjZW5kaWYgLyogX19LTUJfRFJWX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2ttYi9rbWJfcGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5l
LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uZDFlNzc4NgotLS0gL2Rldi9u
dWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5lLmMKQEAgLTAsMCArMSw0ODAg
QEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKKy8qCisgKiBDb3B5
cmlnaHQgwqkgMjAxOC0yMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGRy
bS9kcm1fYXRvbWljLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9jcnRjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jcnRjX2hlbHBlci5oPgor
I2luY2x1ZGUgPGRybS9kcm1fZmJfY21hX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmJf
aGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X2dlbV9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tYW5hZ2VkLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9wbGFuZV9oZWxwZXIuaD4KKworI2luY2x1ZGUgImttYl9kcnYuaCIKKyNpbmNs
dWRlICJrbWJfcGxhbmUuaCIKKyNpbmNsdWRlICJrbWJfcmVncy5oIgorCitjb25zdCB1MzIgbGF5
ZXJfaXJxc1tdID0geworCUxDRF9JTlRfVkwwLAorCUxDRF9JTlRfVkwxLAorCUxDRF9JTlRfR0ww
LAorCUxDRF9JTlRfR0wxCit9OworCitzdGF0aWMgdW5zaWduZWQgaW50IGNoZWNrX3BpeGVsX2Zv
cm1hdChzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwgdTMyIGZvcm1hdCkKK3sKKwlpbnQgaTsKKwor
CWZvciAoaSA9IDA7IGkgPCBwbGFuZS0+Zm9ybWF0X2NvdW50OyBpKyspIHsKKwkJaWYgKHBsYW5l
LT5mb3JtYXRfdHlwZXNbaV0gPT0gZm9ybWF0KQorCQkJcmV0dXJuIDA7CisJfQorCXJldHVybiAt
RUlOVkFMOworfQorCitzdGF0aWMgaW50IGttYl9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRy
bV9wbGFuZSAqcGxhbmUsCisJCQkJICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKKwlpbnQgcmV0OworCXN0cnVjdCBkcm1fY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlib29sIGNhbl9wb3NpdGlvbjsKKworCWZiID0gc3RhdGUt
PmZiOworCWlmICghZmIgfHwgIXN0YXRlLT5jcnRjKQorCQlyZXR1cm4gMDsKKworCXJldCA9IGNo
ZWNrX3BpeGVsX2Zvcm1hdChwbGFuZSwgZmItPmZvcm1hdC0+Zm9ybWF0KTsKKwlpZiAocmV0KQor
CQlyZXR1cm4gcmV0OworCisJaWYgKHN0YXRlLT5jcnRjX3cgPiBLTUJfTUFYX1dJRFRIIHx8IHN0
YXRlLT5jcnRjX2ggPiBLTUJfTUFYX0hFSUdIVCkKKwkJcmV0dXJuIC1FSU5WQUw7CisJaWYgKHN0
YXRlLT5jcnRjX3cgPCBLTUJfTUlOX1dJRFRIIHx8IHN0YXRlLT5jcnRjX2ggPCBLTUJfTUlOX0hF
SUdIVCkKKwkJcmV0dXJuIC1FSU5WQUw7CisJY2FuX3Bvc2l0aW9uID0gKHBsYW5lLT50eXBlID09
IERSTV9QTEFORV9UWVBFX09WRVJMQVkpOworCWNydGNfc3RhdGUgPQorCQlkcm1fYXRvbWljX2dl
dF9leGlzdGluZ19jcnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwgc3RhdGUtPmNydGMpOworCXJldHVy
biBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZShzdGF0ZSwgY3J0Y19zdGF0ZSwK
KwkJCQkJCSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCisJCQkJCQkgRFJNX1BMQU5FX0hF
TFBFUl9OT19TQ0FMSU5HLAorCQkJCQkJIGNhbl9wb3NpdGlvbiwgdHJ1ZSk7Cit9CisKK3N0YXRp
YyB2b2lkIGttYl9wbGFuZV9hdG9taWNfZGlzYWJsZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
KwkJCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBrbWJf
cGxhbmUgKmttYl9wbGFuZSA9IHRvX2ttYl9wbGFuZShwbGFuZSk7CisJaW50IHBsYW5lX2lkID0g
a21iX3BsYW5lLT5pZDsKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWI7CisKKwlrbWIgPSB0
b19rbWIocGxhbmUtPmRldik7CisKKwlzd2l0Y2ggKHBsYW5lX2lkKSB7CisJY2FzZSBMQVlFUl8w
OgorCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9pZF0uY3RybCA9IExDRF9DVFJMX1ZMMV9FTkFC
TEU7CisJCWJyZWFrOworCWNhc2UgTEFZRVJfMToKKwkJa21iLT5wbGFuZV9zdGF0dXNbcGxhbmVf
aWRdLmN0cmwgPSBMQ0RfQ1RSTF9WTDJfRU5BQkxFOworCQlicmVhazsKKwljYXNlIExBWUVSXzI6
CisJCWttYi0+cGxhbmVfc3RhdHVzW3BsYW5lX2lkXS5jdHJsID0gTENEX0NUUkxfR0wxX0VOQUJM
RTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8zOgorCQlrbWItPnBsYW5lX3N0YXR1c1twbGFuZV9p
ZF0uY3RybCA9IExDRF9DVFJMX0dMMl9FTkFCTEU7CisJCWJyZWFrOworCX0KKworCWttYi0+cGxh
bmVfc3RhdHVzW3BsYW5lX2lkXS5kaXNhYmxlID0gdHJ1ZTsKK30KKwordW5zaWduZWQgaW50IGdl
dF9waXhlbF9mb3JtYXQodTMyIGZvcm1hdCkKK3sKKwl1bnNpZ25lZCBpbnQgdmFsID0gMDsKKwor
CXN3aXRjaCAoZm9ybWF0KSB7CisJCS8qIHBsYW5hciBmb3JtYXRzICovCisJY2FzZSBEUk1fRk9S
TUFUX1lVVjQ0NDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9ZQ0JDUjQ0NFBMQU4gfCBMQ0Rf
TEFZRVJfUExBTkFSX1NUT1JBR0U7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9ZVlU0NDQ6
CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfWUNCQ1I0NDRQTEFOIHwgTENEX0xBWUVSX1BMQU5B
Ul9TVE9SQUdFCisJCSAgICB8IExDRF9MQVlFUl9DUkNCX09SREVSOworCQlicmVhazsKKwljYXNl
IERSTV9GT1JNQVRfWVVWNDIyOgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1lDQkNSNDIyUExB
TiB8IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFU
X1lWVTQyMjoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9ZQ0JDUjQyMlBMQU4gfCBMQ0RfTEFZ
RVJfUExBTkFSX1NUT1JBR0UKKwkJICAgIHwgTENEX0xBWUVSX0NSQ0JfT1JERVI7CisJCWJyZWFr
OworCWNhc2UgRFJNX0ZPUk1BVF9ZVVY0MjA6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfWUNC
Q1I0MjBQTEFOIHwgTENEX0xBWUVSX1BMQU5BUl9TVE9SQUdFOworCQlicmVhazsKKwljYXNlIERS
TV9GT1JNQVRfWVZVNDIwOgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1lDQkNSNDIwUExBTiB8
IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRQorCQkgICAgfCBMQ0RfTEFZRVJfQ1JDQl9PUkRFUjsK
KwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JN
QVRfTlYxMiB8IExDRF9MQVlFUl9QTEFOQVJfU1RPUkFHRTsKKwkJYnJlYWs7CisJY2FzZSBEUk1f
Rk9STUFUX05WMjE6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfTlYxMiB8IExDRF9MQVlFUl9Q
TEFOQVJfU1RPUkFHRQorCQkgICAgfCBMQ0RfTEFZRVJfQ1JDQl9PUkRFUjsKKwkJYnJlYWs7CisJ
CS8qIHBhY2tlZCBmb3JtYXRzICovCisJCS8qIGxvb2tzIGh3IHJlcXVpcmVzIEIgJiBHIHRvIGJl
IHN3YXBwZWQgd2hlbiBSR0IgKi8KKwljYXNlIERSTV9GT1JNQVRfUkdCMzMyOgorCQl2YWwgPSBM
Q0RfTEFZRVJfRk9STUFUX1JHQjMzMiB8IExDRF9MQVlFUl9CR1JfT1JERVI7CisJCWJyZWFrOwor
CWNhc2UgRFJNX0ZPUk1BVF9YQkdSNDQ0NDoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0JY
NDQ0NDsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX0FSR0I0NDQ0OgorCQl2YWwgPSBMQ0Rf
TEFZRVJfRk9STUFUX1JHQkE0NDQ0IHwgTENEX0xBWUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJ
Y2FzZSBEUk1fRk9STUFUX0FCR1I0NDQ0OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQkE0
NDQ0OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE1NTU6CisJCXZhbCA9IExDRF9M
QVlFUl9GT1JNQVRfWFJHQjE1NTUgfCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwlj
YXNlIERSTV9GT1JNQVRfWEJHUjE1NTU6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfWFJHQjE1
NTU7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTU1NToKKwkJdmFsID0gTENEX0xB
WUVSX0ZPUk1BVF9SR0JBMTU1NSB8IExDRF9MQVlFUl9CR1JfT1JERVI7CisJCWJyZWFrOworCWNh
c2UgRFJNX0ZPUk1BVF9BQkdSMTU1NToKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9SR0JBMTU1
NTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJdmFsID0gTENEX0xBWUVS
X0ZPUk1BVF9SR0I1NjUgfCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERS
TV9GT1JNQVRfQkdSNTY1OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjU2NTsKKwkJYnJl
YWs7CisJY2FzZSBEUk1fRk9STUFUX1JHQjg4ODoKKwkJdmFsID0gTENEX0xBWUVSX0ZPUk1BVF9S
R0I4ODggfCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRf
QkdSODg4OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQjg4ODsKKwkJYnJlYWs7CisJY2Fz
ZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQlg4ODg4
IHwgTENEX0xBWUVSX0JHUl9PUkRFUjsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hCR1I4
ODg4OgorCQl2YWwgPSBMQ0RfTEFZRVJfRk9STUFUX1JHQlg4ODg4OworCQlicmVhazsKKwljYXNl
IERSTV9GT1JNQVRfQVJHQjg4ODg6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTg4ODgg
fCBMQ0RfTEFZRVJfQkdSX09SREVSOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfQUJHUjg4
ODg6CisJCXZhbCA9IExDRF9MQVlFUl9GT1JNQVRfUkdCQTg4ODg7CisJCWJyZWFrOworCX0KKwlE
Uk1fSU5GT19PTkNFKCIlcyA6ICVkIGZvcm1hdD0weCV4IHZhbD0weCV4XG4iLAorCQkgICAgICBf
X2Z1bmNfXywgX19MSU5FX18sIGZvcm1hdCwgdmFsKTsKKwlyZXR1cm4gdmFsOworfQorCit1bnNp
Z25lZCBpbnQgZ2V0X2JpdHNfcGVyX3BpeGVsKGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8g
KmZvcm1hdCkKK3sKKwl1MzIgYnBwID0gMDsKKwl1bnNpZ25lZCBpbnQgdmFsID0gMDsKKworCWlm
IChmb3JtYXQtPm51bV9wbGFuZXMgPiAxKSB7CisJCXZhbCA9IExDRF9MQVlFUl84QlBQOworCQly
ZXR1cm4gdmFsOworCX0KKworCWJwcCArPSA4ICogZm9ybWF0LT5jcHBbMF07CisKKwlzd2l0Y2gg
KGJwcCkgeworCWNhc2UgODoKKwkJdmFsID0gTENEX0xBWUVSXzhCUFA7CisJCWJyZWFrOworCWNh
c2UgMTY6CisJCXZhbCA9IExDRF9MQVlFUl8xNkJQUDsKKwkJYnJlYWs7CisJY2FzZSAyNDoKKwkJ
dmFsID0gTENEX0xBWUVSXzI0QlBQOworCQlicmVhazsKKwljYXNlIDMyOgorCQl2YWwgPSBMQ0Rf
TEFZRVJfMzJCUFA7CisJCWJyZWFrOworCX0KKworCURSTV9ERUJVRygiYnBwPSVkIHZhbD0weCV4
XG4iLCBicHAsIHZhbCk7CisJcmV0dXJuIHZhbDsKK30KKworc3RhdGljIHZvaWQgY29uZmlnX2Nz
YyhzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIsIGludCBwbGFuZV9pZCkKK3sKKwkvKiBZVVYg
dG8gUkdCIGNvbnZlcnNpb24gdXNpbmcgdGhlIGZpeGVkIG1hdHJpeCBjc2NfY29lZl9sY2QgKi8K
KwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfQ09FRkYxMShwbGFuZV9pZCksIGNz
Y19jb2VmX2xjZFswXSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZG
MTIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2RbMV0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0Rf
TEFZRVJuX0NTQ19DT0VGRjEzKHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzJdKTsKKwlrbWJfd3Jp
dGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfQ09FRkYyMShwbGFuZV9pZCksIGNzY19jb2VmX2xj
ZFszXSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMjIocGxhbmVf
aWQpLCBjc2NfY29lZl9sY2RbNF0pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NT
Q19DT0VGRjIzKHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzVdKTsKKwlrbWJfd3JpdGVfbGNkKGtt
YiwgTENEX0xBWUVSbl9DU0NfQ09FRkYzMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFs2XSk7CisJ
a21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fQ1NDX0NPRUZGMzIocGxhbmVfaWQpLCBjc2Nf
Y29lZl9sY2RbN10pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NTQ19DT0VGRjMz
KHBsYW5lX2lkKSwgY3NjX2NvZWZfbGNkWzhdKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xB
WUVSbl9DU0NfT0ZGMShwbGFuZV9pZCksIGNzY19jb2VmX2xjZFs5XSk7CisJa21iX3dyaXRlX2xj
ZChrbWIsIExDRF9MQVlFUm5fQ1NDX09GRjIocGxhbmVfaWQpLCBjc2NfY29lZl9sY2RbMTBdKTsK
KwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9DU0NfT0ZGMyhwbGFuZV9pZCksIGNzY19j
b2VmX2xjZFsxMV0pOworfQorCitzdGF0aWMgdm9pZCBrbWJfcGxhbmVfYXRvbWljX3VwZGF0ZShz
dHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
c3RhdGUpCit7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGttYl9kcm1f
cHJpdmF0ZSAqa21iOworCXVuc2lnbmVkIGludCB3aWR0aDsKKwl1bnNpZ25lZCBpbnQgaGVpZ2h0
OworCXVuc2lnbmVkIGludCBkbWFfbGVuOworCXN0cnVjdCBrbWJfcGxhbmUgKmttYl9wbGFuZTsK
Kwl1bnNpZ25lZCBpbnQgZG1hX2NmZzsKKwl1bnNpZ25lZCBpbnQgY3RybCA9IDAsIHZhbCA9IDAs
IG91dF9mb3JtYXQgPSAwOworCXVuc2lnbmVkIGludCBzcmNfdywgc3JjX2gsIGNydGNfeCwgY3J0
Y195OworCXVuc2lnbmVkIGNoYXIgcGxhbmVfaWQ7CisJaW50IG51bV9wbGFuZXM7CisJc3RhdGlj
IGRtYV9hZGRyX3QgYWRkcltNQVhfU1VCX1BMQU5FU107CisKKwlpZiAoIXBsYW5lIHx8ICFwbGFu
ZS0+c3RhdGUgfHwgIXN0YXRlKQorCQlyZXR1cm47CisKKwlmYiA9IHBsYW5lLT5zdGF0ZS0+ZmI7
CisJaWYgKCFmYikKKwkJcmV0dXJuOworCW51bV9wbGFuZXMgPSBmYi0+Zm9ybWF0LT5udW1fcGxh
bmVzOworCWttYl9wbGFuZSA9IHRvX2ttYl9wbGFuZShwbGFuZSk7CisJcGxhbmVfaWQgPSBrbWJf
cGxhbmUtPmlkOworCisJa21iID0gdG9fa21iKHBsYW5lLT5kZXYpOworCisJaWYgKGttYl91bmRl
cl9mbG93IHx8IGttYl9mbHVzaF9kb25lKSB7CisJCWRybV9kYmcoJmttYi0+ZHJtLCAicGxhbmVf
dXBkYXRlOnVuZGVyZmxvdyEhISEgcmV0dXJuaW5nIik7CisJCXJldHVybjsKKwl9CisKKwlzcmNf
dyA9IChwbGFuZS0+c3RhdGUtPnNyY193ID4+IDE2KTsKKwlzcmNfaCA9IHBsYW5lLT5zdGF0ZS0+
c3JjX2ggPj4gMTY7CisJY3J0Y194ID0gcGxhbmUtPnN0YXRlLT5jcnRjX3g7CisJY3J0Y195ID0g
cGxhbmUtPnN0YXRlLT5jcnRjX3k7CisKKwlkcm1fZGJnKCZrbWItPmRybSwKKwkJInNyY193PSVk
IHNyY19oPSVkLCBmYi0+Zm9ybWF0LT5mb3JtYXQ9MHgleCBmYi0+ZmxhZ3M9MHgleFxuIiwKKwkJ
ICBzcmNfdywgc3JjX2gsIGZiLT5mb3JtYXQtPmZvcm1hdCwgZmItPmZsYWdzKTsKKworCXdpZHRo
ID0gZmItPndpZHRoOworCWhlaWdodCA9IGZiLT5oZWlnaHQ7CisJZG1hX2xlbiA9ICh3aWR0aCAq
IGhlaWdodCAqIGZiLT5mb3JtYXQtPmNwcFswXSk7CisJZHJtX2RiZygma21iLT5kcm0sICJkbWFf
bGVuPSVkICIsIGRtYV9sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0RNQV9M
RU4ocGxhbmVfaWQpLCBkbWFfbGVuKTsKKwlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9E
TUFfTEVOX1NIQURPVyhwbGFuZV9pZCksIGRtYV9sZW4pOworCWttYl93cml0ZV9sY2Qoa21iLCBM
Q0RfTEFZRVJuX0RNQV9MSU5FX1ZTVFJJREUocGxhbmVfaWQpLAorCQkgICAgICBmYi0+cGl0Y2hl
c1swXSk7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0xJTkVfV0lEVEgocGxh
bmVfaWQpLAorCQkgICAgICAod2lkdGggKiBmYi0+Zm9ybWF0LT5jcHBbMF0pKTsKKworCWFkZHJb
WV9QTEFORV0gPSBkcm1fZmJfY21hX2dldF9nZW1fYWRkcihmYiwgcGxhbmUtPnN0YXRlLCAwKTsK
KwlrbWItPmZiX2FkZHIgPSBhZGRyW1lfUExBTkVdOworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0Rf
TEFZRVJuX0RNQV9TVEFSVF9BRERSKHBsYW5lX2lkKSwKKwkJICAgICAgYWRkcltZX1BMQU5FXSAr
IGZiLT5vZmZzZXRzWzBdKTsKKwl2YWwgPSBnZXRfcGl4ZWxfZm9ybWF0KGZiLT5mb3JtYXQtPmZv
cm1hdCk7CisJdmFsIHw9IGdldF9iaXRzX3Blcl9waXhlbChmYi0+Zm9ybWF0KTsKKwkvKiBQcm9n
cmFtIENiL0NyIGZvciBwbGFuYXIgZm9ybWF0cyAqLworCWlmIChudW1fcGxhbmVzID4gMSkgewor
CQlrbWJfd3JpdGVfbGNkKGttYiwgTENEX0xBWUVSbl9ETUFfQ0JfTElORV9WU1RSSURFKHBsYW5l
X2lkKSwKKwkJCSAgICAgIHdpZHRoICogZmItPmZvcm1hdC0+Y3BwWzBdKTsKKwkJa21iX3dyaXRl
X2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NCX0xJTkVfV0lEVEgocGxhbmVfaWQpLAorCQkJICAg
ICAgKHdpZHRoICogZmItPmZvcm1hdC0+Y3BwWzBdKSk7CisKKwkJYWRkcltVX1BMQU5FXSA9IGRy
bV9mYl9jbWFfZ2V0X2dlbV9hZGRyKGZiLCBwbGFuZS0+c3RhdGUsCisJCQkJCQkJVV9QTEFORSk7
CisJCS8qIGNoZWNrIGlmIENiL0NyIGlzIHN3YXBwZWQqLworCQlpZiAobnVtX3BsYW5lcyA9PSAz
ICYmICh2YWwgJiBMQ0RfTEFZRVJfQ1JDQl9PUkRFUikpCisJCQlrbWJfd3JpdGVfbGNkKGttYiwK
KwkJCQkgICAgICBMQ0RfTEFZRVJuX0RNQV9TVEFSVF9DUl9BRFIocGxhbmVfaWQpLAorCQkJCQlh
ZGRyW1VfUExBTkVdKTsKKwkJZWxzZQorCQkJa21iX3dyaXRlX2xjZChrbWIsCisJCQkJICAgICAg
TENEX0xBWUVSbl9ETUFfU1RBUlRfQ0JfQURSKHBsYW5lX2lkKSwKKwkJCQkJYWRkcltVX1BMQU5F
XSk7CisKKwkJaWYgKG51bV9wbGFuZXMgPT0gMykgeworCQkJa21iX3dyaXRlX2xjZChrbWIsCisJ
CQkJICAgICAgTENEX0xBWUVSbl9ETUFfQ1JfTElORV9WU1RSSURFKHBsYW5lX2lkKSwKKwkJCQkg
ICAgICAoKHdpZHRoKSAqIGZiLT5mb3JtYXQtPmNwcFswXSkpOworCisJCQlrbWJfd3JpdGVfbGNk
KGttYiwKKwkJCQkgICAgICBMQ0RfTEFZRVJuX0RNQV9DUl9MSU5FX1dJRFRIKHBsYW5lX2lkKSwK
KwkJCQkgICAgICAoKHdpZHRoKSAqIGZiLT5mb3JtYXQtPmNwcFswXSkpOworCisJCQlhZGRyW1Zf
UExBTkVdID0gZHJtX2ZiX2NtYV9nZXRfZ2VtX2FkZHIoZmIsCisJCQkJCQkJCXBsYW5lLT5zdGF0
ZSwKKwkJCQkJCQkJVl9QTEFORSk7CisKKwkJCS8qIGNoZWNrIGlmIENiL0NyIGlzIHN3YXBwZWQq
LworCQkJaWYgKHZhbCAmIExDRF9MQVlFUl9DUkNCX09SREVSKQorCQkJCWttYl93cml0ZV9sY2Qo
a21iLAorCQkJCQkgICAgICBMQ0RfTEFZRVJuX0RNQV9TVEFSVF9DQl9BRFIocGxhbmVfaWQpLAor
CQkJCQkgICAgICBhZGRyW1ZfUExBTkVdKTsKKwkJCWVsc2UKKwkJCQlrbWJfd3JpdGVfbGNkKGtt
YiwKKwkJCQkJICAgICAgTENEX0xBWUVSbl9ETUFfU1RBUlRfQ1JfQURSKHBsYW5lX2lkKSwKKwkJ
CQkJICAgICAgYWRkcltWX1BMQU5FXSk7CisJCX0KKwl9CisKKwlrbWJfd3JpdGVfbGNkKGttYiwg
TENEX0xBWUVSbl9XSURUSChwbGFuZV9pZCksIHNyY193IC0gMSk7CisJa21iX3dyaXRlX2xjZChr
bWIsIExDRF9MQVlFUm5fSEVJR0hUKHBsYW5lX2lkKSwgc3JjX2ggLSAxKTsKKwlrbWJfd3JpdGVf
bGNkKGttYiwgTENEX0xBWUVSbl9DT0xfU1RBUlQocGxhbmVfaWQpLCBjcnRjX3gpOworCWttYl93
cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX1JPV19TVEFSVChwbGFuZV9pZCksIGNydGNfeSk7CisK
Kwl2YWwgfD0gTENEX0xBWUVSX0ZJRk9fMTAwOworCisJaWYgKHZhbCAmIExDRF9MQVlFUl9QTEFO
QVJfU1RPUkFHRSkgeworCQl2YWwgfD0gTENEX0xBWUVSX0NTQ19FTjsKKworCQkvKiBFbmFibGUg
Q1NDIGlmIGlucHV0IGlzIHBsYW5hciBhbmQgb3V0cHV0IGlzIFJHQiAqLworCQljb25maWdfY3Nj
KGttYiwgcGxhbmVfaWQpOworCX0KKworCWttYl93cml0ZV9sY2Qoa21iLCBMQ0RfTEFZRVJuX0NG
RyhwbGFuZV9pZCksIHZhbCk7CisKKwlzd2l0Y2ggKHBsYW5lX2lkKSB7CisJY2FzZSBMQVlFUl8w
OgorCQljdHJsID0gTENEX0NUUkxfVkwxX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8x
OgorCQljdHJsID0gTENEX0NUUkxfVkwyX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8y
OgorCQljdHJsID0gTENEX0NUUkxfR0wxX0VOQUJMRTsKKwkJYnJlYWs7CisJY2FzZSBMQVlFUl8z
OgorCQljdHJsID0gTENEX0NUUkxfR0wyX0VOQUJMRTsKKwkJYnJlYWs7CisJfQorCisJY3RybCB8
PSBMQ0RfQ1RSTF9QUk9HUkVTU0lWRSB8IExDRF9DVFJMX1RJTV9HRU5fRU5BQkxFCisJICAgIHwg
TENEX0NUUkxfQ09OVElOVU9VUyB8IExDRF9DVFJMX09VVFBVVF9FTkFCTEVEOworCisJLyogTENE
IGlzIGNvbm5lY3RlZCB0byBNSVBJIG9uIGttYgorCSAqIFRoZXJlZm9yZSB0aGlzIGJpdCBpcyBy
ZXF1aXJlZCBmb3IgRFNJIFR4CisJICovCisJY3RybCB8PSBMQ0RfQ1RSTF9WSFNZTkNfSURMRV9M
Vkw7CisKKwlrbWJfc2V0X2JpdG1hc2tfbGNkKGttYiwgTENEX0NPTlRST0wsIGN0cmwpOworCisJ
LyogRklYTUUgbm8gZG9jIG9uIGhvdyB0byBzZXQgb3V0cHV0IGZvcm1hdCx0aGVzZSB2YWx1ZXMg
YXJlCisJICogdGFrZW4gZnJvbSB0aGUgTXlyaWFkeCB0ZXN0cworCSAqLworCW91dF9mb3JtYXQg
fD0gTENEX09VVEZfRk9STUFUX1JHQjg4ODsKKworCS8qIExlYXZlIFJHQiBvcmRlcixjb252ZXJz
aW9uIG1vZGUgYW5kIGNsaXAgbW9kZSB0byBkZWZhdWx0ICovCisJLyogZG8gbm90IGludGVybGVh
dmUgUkdCIGNoYW5uZWxzIGZvciBtaXBpIFR4IGNvbXBhdGliaWxpdHkgKi8KKwlvdXRfZm9ybWF0
IHw9IExDRF9PVVRGX01JUElfUkdCX01PREU7CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9PVVRf
Rk9STUFUX0NGRywgb3V0X2Zvcm1hdCk7CisKKwlkbWFfY2ZnID0gTENEX0RNQV9MQVlFUl9FTkFC
TEUgfCBMQ0RfRE1BX0xBWUVSX1ZTVFJJREVfRU4gfAorCSAgICBMQ0RfRE1BX0xBWUVSX0NPTlRf
VVBEQVRFIHwgTENEX0RNQV9MQVlFUl9BWElfQlVSU1RfMTY7CisKKwkvKiBFbmFibGUgRE1BICov
CisJa21iX3dyaXRlX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NGRyhwbGFuZV9pZCksIGRtYV9j
ZmcpOworCWRybV9kYmcoJmttYi0+ZHJtLCAiZG1hX2NmZz0weCV4IExDRF9ETUFfQ0ZHPTB4JXhc
biIsIGRtYV9jZmcsCisJCWttYl9yZWFkX2xjZChrbWIsIExDRF9MQVlFUm5fRE1BX0NGRyhwbGFu
ZV9pZCkpKTsKKworCWttYl9zZXRfYml0bWFza19sY2Qoa21iLCBMQ0RfSU5UX0NMRUFSLCBMQ0Rf
SU5UX0VPRiB8CisJCQlMQ0RfSU5UX0RNQV9FUlIpOworCWttYl9zZXRfYml0bWFza19sY2Qoa21i
LCBMQ0RfSU5UX0VOQUJMRSwgTENEX0lOVF9FT0YgfAorCQkJTENEX0lOVF9ETUFfRVJSKTsKK30K
Kworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfaGVscGVyX2Z1bmNzIGttYl9wbGFuZV9o
ZWxwZXJfZnVuY3MgPSB7CisJLmF0b21pY19jaGVjayA9IGttYl9wbGFuZV9hdG9taWNfY2hlY2ss
CisJLmF0b21pY191cGRhdGUgPSBrbWJfcGxhbmVfYXRvbWljX3VwZGF0ZSwKKwkuYXRvbWljX2Rp
c2FibGUgPSBrbWJfcGxhbmVfYXRvbWljX2Rpc2FibGUKK307CisKK3ZvaWQga21iX3BsYW5lX2Rl
c3Ryb3koc3RydWN0IGRybV9wbGFuZSAqcGxhbmUpCit7CisJc3RydWN0IGttYl9wbGFuZSAqa21i
X3BsYW5lID0gdG9fa21iX3BsYW5lKHBsYW5lKTsKKworCWRybV9wbGFuZV9jbGVhbnVwKHBsYW5l
KTsKKwlrZnJlZShrbWJfcGxhbmUpOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFu
ZV9mdW5jcyBrbWJfcGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNf
aGVscGVyX3VwZGF0ZV9wbGFuZSwKKwkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVy
X2Rpc2FibGVfcGxhbmUsCisJLmRlc3Ryb3kgPSBrbWJfcGxhbmVfZGVzdHJveSwKKwkucmVzZXQg
PSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9yZXNldCwKKwkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0
ZSA9IGRybV9hdG9taWNfaGVscGVyX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWljX2Rl
c3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kZXN0cm95X3N0YXRlLAorfTsK
Kworc3RydWN0IGttYl9wbGFuZSAqa21iX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRy
bSkKK3sKKwlzdHJ1Y3Qga21iX2RybV9wcml2YXRlICprbWIgPSB0b19rbWIoZHJtKTsKKwlzdHJ1
Y3Qga21iX3BsYW5lICpwbGFuZSA9IE5VTEw7CisJc3RydWN0IGttYl9wbGFuZSAqcHJpbWFyeSA9
IE5VTEw7CisJaW50IGkgPSAwOworCWludCByZXQgPSAwOworCWVudW0gZHJtX3BsYW5lX3R5cGUg
cGxhbmVfdHlwZTsKKwljb25zdCB1MzIgKnBsYW5lX2Zvcm1hdHM7CisJaW50IG51bV9wbGFuZV9m
b3JtYXRzOworCisJZm9yIChpID0gMDsgaSA8IEtNQl9NQVhfUExBTkVTOyBpKyspIHsKKwkJcGxh
bmUgPSBkcm1tX2t6YWxsb2MoZHJtLCBzaXplb2YoKnBsYW5lKSwgR0ZQX0tFUk5FTCk7CisKKwkJ
aWYgKCFwbGFuZSkgeworCQkJZHJtX2Vycihkcm0sICJGYWlsZWQgdG8gYWxsb2NhdGUgcGxhbmVc
biIpOworCQkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJCX0KKworCQlwbGFuZV90eXBlID0g
KGkgPT0gMCkgPyBEUk1fUExBTkVfVFlQRV9QUklNQVJZIDoKKwkJICAgIERSTV9QTEFORV9UWVBF
X09WRVJMQVk7CisJCWlmIChpIDwgMikgeworCQkJcGxhbmVfZm9ybWF0cyA9IGttYl9mb3JtYXRz
X3Y7CisJCQludW1fcGxhbmVfZm9ybWF0cyA9IEFSUkFZX1NJWkUoa21iX2Zvcm1hdHNfdik7CisJ
CX0gZWxzZSB7CisJCQlwbGFuZV9mb3JtYXRzID0ga21iX2Zvcm1hdHNfZzsKKwkJCW51bV9wbGFu
ZV9mb3JtYXRzID0gQVJSQVlfU0laRShrbWJfZm9ybWF0c19nKTsKKwkJfQorCisJCXJldCA9IGRy
bV91bml2ZXJzYWxfcGxhbmVfaW5pdChkcm0sICZwbGFuZS0+YmFzZV9wbGFuZSwKKwkJCQkJICAg
ICAgIFBPU1NJQkxFX0NSVENTLCAma21iX3BsYW5lX2Z1bmNzLAorCQkJCQkgICAgICAgcGxhbmVf
Zm9ybWF0cywgbnVtX3BsYW5lX2Zvcm1hdHMsCisJCQkJCSAgICAgICBOVUxMLCBwbGFuZV90eXBl
LCAicGxhbmUgJWQiLCBpKTsKKwkJaWYgKHJldCA8IDApIHsKKwkJCWRybV9lcnIoZHJtLCAiZHJt
X3VuaXZlcnNhbF9wbGFuZV9pbml0IGZhaWxlZCAocmV0PSVkKSIsCisJCQkJcmV0KTsKKwkJCWdv
dG8gY2xlYW51cDsKKwkJfQorCQlkcm1fZGJnKGRybSwgIiVzIDogJWQgaT0lZCB0eXBlPSVkIiwK
KwkJCV9fZnVuY19fLCBfX0xJTkVfXywKKwkJCSAgaSwgcGxhbmVfdHlwZSk7CisJCWRybV9wbGFu
ZV9oZWxwZXJfYWRkKCZwbGFuZS0+YmFzZV9wbGFuZSwKKwkJCQkgICAgICZrbWJfcGxhbmVfaGVs
cGVyX2Z1bmNzKTsKKwkJaWYgKHBsYW5lX3R5cGUgPT0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWSkg
eworCQkJcHJpbWFyeSA9IHBsYW5lOworCQkJa21iLT5wbGFuZSA9IHBsYW5lOworCQl9CisJCWRy
bV9kYmcoZHJtLCAiJXMgOiAlZCBwcmltYXJ5PSVwXG4iLCBfX2Z1bmNfXywgX19MSU5FX18sCisJ
CQkmcHJpbWFyeS0+YmFzZV9wbGFuZSk7CisJCXBsYW5lLT5pZCA9IGk7CisJfQorCisJcmV0dXJu
IHByaW1hcnk7CitjbGVhbnVwOgorCWRybW1fa2ZyZWUoZHJtLCBwbGFuZSk7CisJcmV0dXJuIEVS
Ul9QVFIocmV0KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9rbWIva21iX3BsYW5l
LmggYi9kcml2ZXJzL2dwdS9kcm0va21iL2ttYl9wbGFuZS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAuLjE0MWNkYWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0va21iL2ttYl9wbGFuZS5oCkBAIC0wLDAgKzEsMTEwIEBACisvKiBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogR1BMLTIuMC1vbmx5CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTgtMjAyMCBJbnRl
bCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgX19LTUJfUExBTkVfSF9fCisjZGVmaW5lIF9f
S01CX1BMQU5FX0hfXworCitleHRlcm4gaW50IGttYl91bmRlcl9mbG93OworZXh0ZXJuIGludCBr
bWJfZmx1c2hfZG9uZTsKKworI2RlZmluZSBMQ0RfSU5UX1ZMMF9FUlIgKChMQVlFUjBfRE1BX0ZJ
Rk9fVU5ERVJGTE9XKSB8IFwKKwkJCShMQVlFUjBfRE1BX0ZJRk9fT1ZFUkZMT1cpIHwgXAorCQkJ
KExBWUVSMF9ETUFfQ0JfRklGT19PVkVSRkxPVykgfCBcCisJCQkoTEFZRVIwX0RNQV9DQl9GSUZP
X1VOREVSRkxPVykgfCBcCisJCQkoTEFZRVIwX0RNQV9DUl9GSUZPX09WRVJGTE9XKSB8IFwKKwkJ
CShMQVlFUjBfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKSkKKworI2RlZmluZSBMQ0RfSU5UX1ZMMV9F
UlIgKChMQVlFUjFfRE1BX0ZJRk9fVU5ERVJGTE9XKSB8IFwKKwkJCShMQVlFUjFfRE1BX0ZJRk9f
T1ZFUkZMT1cpIHwgXAorCQkJKExBWUVSMV9ETUFfQ0JfRklGT19PVkVSRkxPVykgfCBcCisJCQko
TEFZRVIxX0RNQV9DQl9GSUZPX1VOREVSRkxPVykgfCBcCisJCQkoTEFZRVIxX0RNQV9DUl9GSUZP
X09WRVJGTE9XKSB8IFwKKwkJCShMQVlFUjFfRE1BX0NSX0ZJRk9fVU5ERVJGTE9XKSkKKworI2Rl
ZmluZSBMQ0RfSU5UX0dMMF9FUlIgKExBWUVSMl9ETUFfRklGT19PVkVSRkxPVyB8IExBWUVSMl9E
TUFfRklGT19VTkRFUkZMT1cpCisjZGVmaW5lIExDRF9JTlRfR0wxX0VSUiAoTEFZRVIzX0RNQV9G
SUZPX09WRVJGTE9XIHwgTEFZRVIzX0RNQV9GSUZPX1VOREVSRkxPVykKKyNkZWZpbmUgTENEX0lO
VF9WTDAgKExBWUVSMF9ETUFfRE9ORSB8IExBWUVSMF9ETUFfSURMRSB8IExDRF9JTlRfVkwwX0VS
UikKKyNkZWZpbmUgTENEX0lOVF9WTDEgKExBWUVSMV9ETUFfRE9ORSB8IExBWUVSMV9ETUFfSURM
RSB8IExDRF9JTlRfVkwxX0VSUikKKyNkZWZpbmUgTENEX0lOVF9HTDAgKExBWUVSMl9ETUFfRE9O
RSB8IExBWUVSMl9ETUFfSURMRSB8IExDRF9JTlRfR0wwX0VSUikKKyNkZWZpbmUgTENEX0lOVF9H
TDEgKExBWUVSM19ETUFfRE9ORSB8IExBWUVSM19ETUFfSURMRSB8IExDRF9JTlRfR0wxX0VSUikK
KyNkZWZpbmUgTENEX0lOVF9ETUFfRVJSIChMQ0RfSU5UX1ZMMF9FUlIgfCBMQ0RfSU5UX1ZMMV9F
UlIgXAorCQl8IExDRF9JTlRfR0wwX0VSUiB8IExDRF9JTlRfR0wxX0VSUikKKworI2RlZmluZSBQ
T1NTSUJMRV9DUlRDUyAxCisjZGVmaW5lIHRvX2ttYl9wbGFuZSh4KSBjb250YWluZXJfb2YoeCwg
c3RydWN0IGttYl9wbGFuZSwgYmFzZV9wbGFuZSkKKworZW51bSBsYXllcl9pZCB7CisJTEFZRVJf
MCwKKwlMQVlFUl8xLAorCUxBWUVSXzIsCisJTEFZRVJfMywKKwkvKiBLTUJfTUFYX1BMQU5FUyAq
LworfTsKKworI2RlZmluZSBLTUJfTUFYX1BMQU5FUyAxCisKK2VudW0gc3ViX3BsYW5lX2lkIHsK
KwlZX1BMQU5FLAorCVVfUExBTkUsCisJVl9QTEFORSwKKwlNQVhfU1VCX1BMQU5FUywKK307CisK
K3N0cnVjdCBrbWJfcGxhbmUgeworCXN0cnVjdCBkcm1fcGxhbmUgYmFzZV9wbGFuZTsKKwl1bnNp
Z25lZCBjaGFyIGlkOworfTsKKworLyogR3JhcGhpY3MgbGF5ZXIgKGxheWVycyAyICYgMykgZm9y
bWF0cywgb25seSBwYWNrZWQgZm9ybWF0cyAgYXJlIHN1cHBvcnRlZCAqLworc3RhdGljIGNvbnN0
IHUzMiBrbWJfZm9ybWF0c19nW10gPSB7CisJRFJNX0ZPUk1BVF9SR0IzMzIsCisJRFJNX0ZPUk1B
VF9YUkdCNDQ0NCwgRFJNX0ZPUk1BVF9YQkdSNDQ0NCwKKwlEUk1fRk9STUFUX0FSR0I0NDQ0LCBE
Uk1fRk9STUFUX0FCR1I0NDQ0LAorCURSTV9GT1JNQVRfWFJHQjE1NTUsIERSTV9GT1JNQVRfWEJH
UjE1NTUsCisJRFJNX0ZPUk1BVF9BUkdCMTU1NSwgRFJNX0ZPUk1BVF9BQkdSMTU1NSwKKwlEUk1f
Rk9STUFUX1JHQjU2NSwgRFJNX0ZPUk1BVF9CR1I1NjUsCisJRFJNX0ZPUk1BVF9SR0I4ODgsIERS
TV9GT1JNQVRfQkdSODg4LAorCURSTV9GT1JNQVRfWFJHQjg4ODgsIERSTV9GT1JNQVRfWEJHUjg4
ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwgRFJNX0ZPUk1BVF9BQkdSODg4OCwKK307CisKKyNk
ZWZpbmUgTUFYX0ZPUk1BVF9HCShBUlJBWV9TSVpFKGttYl9mb3JtYXRzX2cpKQorI2RlZmluZSBN
QVhfRk9STUFUX1YJKEFSUkFZX1NJWkUoa21iX2Zvcm1hdHNfdikpCisKKy8qIFZpZGVvIGxheWVy
ICggMCAmIDEpIGZvcm1hdHMsIHBhY2tlZCBhbmQgcGxhbmFyIGZvcm1hdHMgYXJlIHN1cHBvcnRl
ZCAqLworc3RhdGljIGNvbnN0IHUzMiBrbWJfZm9ybWF0c192W10gPSB7CisJLyogcGFja2VkIGZv
cm1hdHMgKi8KKwlEUk1fRk9STUFUX1JHQjMzMiwKKwlEUk1fRk9STUFUX1hSR0I0NDQ0LCBEUk1f
Rk9STUFUX1hCR1I0NDQ0LAorCURSTV9GT1JNQVRfQVJHQjQ0NDQsIERSTV9GT1JNQVRfQUJHUjQ0
NDQsCisJRFJNX0ZPUk1BVF9YUkdCMTU1NSwgRFJNX0ZPUk1BVF9YQkdSMTU1NSwKKwlEUk1fRk9S
TUFUX0FSR0IxNTU1LCBEUk1fRk9STUFUX0FCR1IxNTU1LAorCURSTV9GT1JNQVRfUkdCNTY1LCBE
Uk1fRk9STUFUX0JHUjU2NSwKKwlEUk1fRk9STUFUX1JHQjg4OCwgRFJNX0ZPUk1BVF9CR1I4ODgs
CisJRFJNX0ZPUk1BVF9YUkdCODg4OCwgRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFU
X0FSR0I4ODg4LCBEUk1fRk9STUFUX0FCR1I4ODg4LAorCS8qcGxhbmFyIGZvcm1hdHMgKi8KKwlE
Uk1fRk9STUFUX1lVVjQyMCwgRFJNX0ZPUk1BVF9ZVlU0MjAsCisJRFJNX0ZPUk1BVF9ZVVY0MjIs
IERSTV9GT1JNQVRfWVZVNDIyLAorCURSTV9GT1JNQVRfWVVWNDQ0LCBEUk1fRk9STUFUX1lWVTQ0
NCwKKwlEUk1fRk9STUFUX05WMTIsIERSTV9GT1JNQVRfTlYyMSwKK307CisKKy8qIENvbnZlcnNp
b24gKHl1di0+cmdiKSBtYXRyaXggZnJvbSBteXJpYWR4ICovCitzdGF0aWMgY29uc3QgdTMyIGNz
Y19jb2VmX2xjZFtdID0geworCTEwMjQsIDAsIDE0MzYsCisJMTAyNCwgLTM1MiwgLTczMSwKKwkx
MDI0LCAxODE0LCAwLAorCS0xNzksIDEyNSwgLTIyNgorfTsKKworc3RydWN0IGxheWVyX3N0YXR1
cyB7CisJYm9vbCBkaXNhYmxlOworCXUzMiBjdHJsOworfTsKKworc3RydWN0IGttYl9wbGFuZSAq
a21iX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSk7Cit2b2lkIGttYl9wbGFuZV9k
ZXN0cm95KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKTsKKyNlbmRpZiAvKiBfX0tNQl9QTEFORV9I
X18gKi8KLS0gCjIuNy40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmkt
ZGV2ZWwK
