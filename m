Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 15A263D1D0
	for <lists+dri-devel@lfdr.de>; Tue, 11 Jun 2019 18:09:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DB90F8924A;
	Tue, 11 Jun 2019 16:09:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x844.google.com (mail-qt1-x844.google.com
 [IPv6:2607:f8b0:4864:20::844])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BCBDC8924A
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 16:09:38 +0000 (UTC)
Received: by mail-qt1-x844.google.com with SMTP id j19so15161592qtr.12
 for <dri-devel@lists.freedesktop.org>; Tue, 11 Jun 2019 09:09:38 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=iXk3In61G/xVZVremlzhKSVYIWcrDPo+B818qbXfT4U=;
 b=H5nT3pk/g7PI2f/+6FiWP+CFxEu9K1GIcGpezjUqHX7+b/7V0RNyapxAYeAvpHCYxo
 oVE+DXs7BydY0641rZKBRkVoHnBJYTT80gg7T0wP/6A0PJ7AqeQctuLgCi9vcoTCfWDb
 0VhAICQOcUhn9uLZiMUbvM/oGy40iP7YV2dZYCqi9qKPWmcV/9Bq1fy1zlG1GmLWUeGG
 /qo4Ha2KYG0BD4sfQSAJR8JP4kuI+npaGEsxrd9vaQ1ssU9jj66AxXcoXFM37zHcZJ6o
 LsRhWzUka1kJFpm1nGS3ph99OxpYHAbEdroarRbhhAESDHeQ6UGizGEqZNElmEau8tXv
 kyrA==
X-Gm-Message-State: APjAAAXv2vOFf2lTd0IwCd/riIa7YgXI3y7T3A3wwy+t7bBWd83OusJH
 1R4JtiDjdt+L7pP0T8K3gw2JwIykYro=
X-Google-Smtp-Source: APXvYqzFJhkt3GwRHx33Av6pxPu4r3CVStuPZPJba8WsR8RH6rwaS7G4imFGuZdRxHC5scFqIZX/rw==
X-Received: by 2002:a0c:880b:: with SMTP id 11mr44882459qvl.185.1560269377622; 
 Tue, 11 Jun 2019 09:09:37 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id d188sm6755094qkf.40.2019.06.11.09.09.36
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Tue, 11 Jun 2019 09:09:37 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 05/11] drm: Add helpers to kick off self refresh mode in
 drivers
Date: Tue, 11 Jun 2019 12:08:19 -0400
Message-Id: <20190611160844.257498-6-sean@poorly.run>
X-Mailer: git-send-email 2.22.0.rc2.383.gf4fbbf30c2-goog
In-Reply-To: <20190611160844.257498-1-sean@poorly.run>
References: <20190611160844.257498-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=iXk3In61G/xVZVremlzhKSVYIWcrDPo+B818qbXfT4U=;
 b=ApImcsDHgY9DuJPSsiAQBL7oJdObheTioD4GcA61c47UozVbu7S2pHBUdcKQk+Wpkx
 ZNiE8OJrlh4DQ/LagDKUiG2nLjuTlu6FNO6r+bObn030KcRWbk3xROMghSrtIPlli9Dq
 9OL77zL9k+/LkloRI1rdKkncTrGSxa6YcTd1Qc/YG1WyAnqPHuCrVDhlWwXCtOBVZx0t
 EmIF3mn/Qcbq5CrcZNBIqF/8LIEaHl5mp19V86iq+M8HIZAyjhCVSY7kV7QLo7ALdzRv
 +yIfDciTV/ffteMUFiz8uv0j+CmoYc8cP+Aler9WmWUR6lXOm1rVtcGLf1QIX+q8wshJ
 z74Q==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Zain Wang <wzz@rock-chips.com>, Jonathan Corbet <corbet@lwn.net>,
 David Airlie <airlied@linux.ie>, linux-doc@vger.kernel.org,
 Jose Souza <jose.souza@intel.com>, Tomasz Figa <tfiga@chromium.org>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <seanpaul@chromium.org>,
 Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGlzIHBhdGNoIGFkZHMg
YSBuZXcgZHJtIGhlbHBlciBsaWJyYXJ5IHRvIGhlbHAgZHJpdmVycyBpbXBsZW1lbnQKc2VsZiBy
ZWZyZXNoLiBEcml2ZXJzIGNob29zaW5nIHRvIHVzZSBpdCB3aWxsIHJlZ2lzdGVyIGNydGNzIGFu
ZAp3aWxsIHJlY2VpdmUgY2FsbGJhY2tzIHdoZW4gaXQncyB0aW1lIHRvIGVudGVyIG9yIGV4aXQg
c2VsZiByZWZyZXNoCm1vZGUuCgpJbiBpdHMgY3VycmVudCBmb3JtLCBpdCBoYXMgYSB0aW1lciB3
aGljaCB3aWxsIHRyaWdnZXIgYWZ0ZXIgYQpkcml2ZXItc3BlY2lmaWVkIGFtb3VudCBvZiBpbmFj
dGl2aXR5LiBXaGVuIHRoZSB0aW1lciB0cmlnZ2VycywgdGhlCmhlbHBlcnMgd2lsbCBzdWJtaXQg
YSBuZXcgYXRvbWljIGNvbW1pdCB0byBzaHV0IHRoZSByZWZyZXNoaW5nIHBpcGUKb2ZmLiBPbiB0
aGUgbmV4dCBhdG9taWMgY29tbWl0LCB0aGUgZHJtIGNvcmUgd2lsbCByZXZlcnQgdGhlIHNlbGYK
cmVmcmVzaCBzdGF0ZSBhbmQgYnJpbmcgZXZlcnl0aGluZyBiYWNrIHVwIHRvIGJlIGFjdGl2ZWx5
IGRyaXZlbi4KCkZyb20gdGhlIGRyaXZlcidzIHBlcnNwZWN0aXZlLCB0aGlzIHdvcmtzIGxpa2Ug
YSByZWd1bGFyIGRpc2FibGUvZW5hYmxlCmN5Y2xlLiBUaGUgZHJpdmVyIG5lZWQgb25seSBjaGVj
ayB0aGUgJ3NlbGZfcmVmcmVzaF9hY3RpdmUnIHN0YXRlIGluCmNydGNfc3RhdGUuIEl0IHNob3Vs
ZCBpbml0aWF0ZSBzZWxmIHJlZnJlc2ggbW9kZSBvbiB0aGUgcGFuZWwgYW5kIGVudGVyCmFuIG9m
ZiBvciBsb3ctcG93ZXIgc3RhdGUuCgpDaGFuZ2VzIGluIHYyOgotIHMvcHNyL3NlbGZfcmVmcmVz
aC8gKERhbmllbCkKLSBpbnRlZ3JhdGVkIHRoZSBwc3IgZXhpdCBpbnRvIHRoZSBjb21taXQgdGhh
dCB3YWtlcyBpdCB1cCAoSm9zZS9EYW5pZWwpCi0gbWFkZSB0aGUgcHNyIHN0YXRlIHBlci1jcnRj
IChKb3NlL0RhbmllbCkKQ2hhbmdlcyBpbiB2MzoKLSBSZW1vdmUgdGhlIHNlbGZfcmVmcmVzaF8o
YWN0aXZlfGNoYW5nZWQpIGZyb20gY29ubmVjdG9yIHN0YXRlIChEYW5pZWwpCi0gU2ltcGxpZnkg
bG9vcCBpbiBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZSAoRGFuaWVsKQotIElt
cHJvdmUgc2VsZl9yZWZyZXNoX2F3YXJlIGNvbW1lbnQgKERhbmllbCkKLSBzL3NlbGZfcmVmcmVz
aF9zdGF0ZS9zZWxmX3JlZnJlc2hfZGF0YS8gKERhbmllbCkKQ2hhbmdlcyBpbiB2NDoKLSBNb3Zl
IGRvY2Jvb2sgbG9jYXRpb24gYmVsb3cgcGFuZWwgKERhbmllbCkKLSBJbXByb3ZlIGRvY2Jvb2sg
d2l0aCByZWZlcmVuY2VzIGFuZCBtb3JlIGRldGFpbGVkIGV4cGxhbmF0aW9uIChEYW5pZWwpCi0g
SW5zdGVhZCBvZiByZWdpc3Rlci91bnJlZ2lzdGVyLCB1c2UgaW5pdC9jbGVhbnVwIChEYW5pZWwp
CkNoYW5nZXMgaW4gdjU6Ci0gUmVzb2x2ZWQgY29uZmxpY3QgaW4gZHJtX2F0b21pY19oZWxwZXIu
YyAjaW5jbHVkZSBibG9jawotIFJlc29sdmVkIGNvbmZsaWN0IGluIHJzdCB3aXRoIEhEQ1AgaGVs
cGVyIGRvY3MKCkxpbmsgdG8gdjE6IGh0dHBzOi8vcGF0Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9w
YXRjaC9tc2dpZC8yMDE5MDIyODIxMDkzOS44MzM4Ni0yLXNlYW5AcG9vcmx5LnJ1bgpMaW5rIHRv
IHYyOiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3RvcC5vcmcvcGF0Y2gvbXNnaWQvMjAxOTAz
MjYyMDQ1MDkuOTY1MTUtMS1zZWFuQHBvb3JseS5ydW4KTGluayB0byB2MzogaHR0cHM6Ly9wYXRj
aHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMTkwNTAyMTk0OTU2LjIxODQ0MS02
LXNlYW5AcG9vcmx5LnJ1bgpMaW5rIHRvIHY0OiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3Rv
cC5vcmcvcGF0Y2gvbXNnaWQvMjAxOTA1MDgxNjA5MjAuMTQ0NzM5LTYtc2VhbkBwb29ybHkucnVu
CgpDYzogRGFuaWVsIFZldHRlciA8ZGFuaWVsQGZmd2xsLmNoPgpDYzogSm9zZSBTb3V6YSA8am9z
ZS5zb3V6YUBpbnRlbC5jb20+CkNjOiBaYWluIFdhbmcgPHd6ekByb2NrLWNoaXBzLmNvbT4KQ2M6
IFRvbWFzeiBGaWdhIDx0ZmlnYUBjaHJvbWl1bS5vcmc+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZp
bGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpUZXN0ZWQtYnk6IEhlaWtvIFN0dWVibmVyIDxo
ZWlrb0BzbnRlY2guZGU+ClJldmlld2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwu
Y2g+ClNpZ25lZC1vZmYtYnk6IFNlYW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgotLS0K
IERvY3VtZW50YXRpb24vZ3B1L2RybS1rbXMtaGVscGVycy5yc3QgICAgIHwgICA5ICsKIGRyaXZl
cnMvZ3B1L2RybS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vZHJtX2F0b21pYy5jICAgICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pY19oZWxwZXIuYyAgICAgICB8ICAzNSArKystCiBkcml2ZXJzL2dwdS9kcm0vZHJt
X2F0b21pY19zdGF0ZV9oZWxwZXIuYyB8ICAgNCArCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21p
Y191YXBpLmMgICAgICAgICB8ICAgNyArLQogZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJl
c2hfaGVscGVyLmMgfCAyMTMgKysrKysrKysrKysrKysrKysrKysrKwogaW5jbHVkZS9kcm0vZHJt
X2F0b21pYy5oICAgICAgICAgICAgICAgICAgfCAgMTUgKysKIGluY2x1ZGUvZHJtL2RybV9jb25u
ZWN0b3IuaCAgICAgICAgICAgICAgIHwgIDE0ICsrCiBpbmNsdWRlL2RybS9kcm1fY3J0Yy5oICAg
ICAgICAgICAgICAgICAgICB8ICAxOSArKwogaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9o
ZWxwZXIuaCAgICAgfCAgMjIgKysrCiAxMSBmaWxlcyBjaGFuZ2VkLCAzMzcgaW5zZXJ0aW9ucygr
KSwgNSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZHJt
X3NlbGZfcmVmcmVzaF9oZWxwZXIuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvZHJtL2Ry
bV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL2dwdS9k
cm0ta21zLWhlbHBlcnMucnN0IGIvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLWttcy1oZWxwZXJzLnJz
dAppbmRleCAwZmU3MjZhNmVlNjc4Li5iMzI3YmJjMTExODIxIDEwMDY0NAotLS0gYS9Eb2N1bWVu
dGF0aW9uL2dwdS9kcm0ta21zLWhlbHBlcnMucnN0CisrKyBiL0RvY3VtZW50YXRpb24vZ3B1L2Ry
bS1rbXMtaGVscGVycy5yc3QKQEAgLTE4MSw2ICsxODEsMTUgQEAgUGFuZWwgSGVscGVyIFJlZmVy
ZW5jZQogLi4ga2VybmVsLWRvYzo6IGRyaXZlcnMvZ3B1L2RybS9kcm1fcGFuZWxfb3JpZW50YXRp
b25fcXVpcmtzLmMKICAgIDpleHBvcnQ6CiAKK1BhbmVsIFNlbGYgUmVmcmVzaCBIZWxwZXIgUmVm
ZXJlbmNlCis9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQorCisuLiBrZXJuZWwt
ZG9jOjogZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMKKyAgIDpkb2M6
IG92ZXJ2aWV3CisKKy4uIGtlcm5lbC1kb2M6OiBkcml2ZXJzL2dwdS9kcm0vZHJtX3NlbGZfcmVm
cmVzaF9oZWxwZXIuYworICAgOmV4cG9ydDoKKwogSERDUCBIZWxwZXIgRnVuY3Rpb25zIFJlZmVy
ZW5jZQogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUKaW5kZXggZDM2
ZmViNGE2MjMzMC4uOWQ2MzBhMjhhNzg4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01h
a2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtNDMsNyArNDMsNyBAQCBk
cm1fa21zX2hlbHBlci15IDo9IGRybV9jcnRjX2hlbHBlci5vIGRybV9kcF9oZWxwZXIubyBkcm1f
ZHNjLm8gZHJtX3Byb2JlX2hlbHBlcgogCQlkcm1fc2ltcGxlX2ttc19oZWxwZXIubyBkcm1fbW9k
ZXNldF9oZWxwZXIubyBcCiAJCWRybV9zY2RjX2hlbHBlci5vIGRybV9nZW1fZnJhbWVidWZmZXJf
aGVscGVyLm8gXAogCQlkcm1fYXRvbWljX3N0YXRlX2hlbHBlci5vIGRybV9kYW1hZ2VfaGVscGVy
Lm8gXAotCQlkcm1fZm9ybWF0X2hlbHBlci5vCisJCWRybV9mb3JtYXRfaGVscGVyLm8gZHJtX3Nl
bGZfcmVmcmVzaF9oZWxwZXIubwogCiBkcm1fa21zX2hlbHBlci0kKENPTkZJR19EUk1fUEFORUxf
QlJJREdFKSArPSBicmlkZ2UvcGFuZWwubwogZHJtX2ttc19oZWxwZXItJChDT05GSUdfRFJNX0ZC
REVWX0VNVUxBVElPTikgKz0gZHJtX2ZiX2hlbHBlci5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwppbmRleCBh
NGU3NzlkZWFiMGZiLi40MTkzODFhYmJkZDE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
ZHJtX2F0b21pYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKQEAgLTM4NCw2
ICszODQsNyBAQCBzdGF0aWMgdm9pZCBkcm1fYXRvbWljX2NydGNfcHJpbnRfc3RhdGUoc3RydWN0
IGRybV9wcmludGVyICpwLAogCWRybV9wcmludGYocCwgImNydGNbJXVdOiAlc1xuIiwgY3J0Yy0+
YmFzZS5pZCwgY3J0Yy0+bmFtZSk7CiAJZHJtX3ByaW50ZihwLCAiXHRlbmFibGU9JWRcbiIsIHN0
YXRlLT5lbmFibGUpOwogCWRybV9wcmludGYocCwgIlx0YWN0aXZlPSVkXG4iLCBzdGF0ZS0+YWN0
aXZlKTsKKwlkcm1fcHJpbnRmKHAsICJcdHNlbGZfcmVmcmVzaF9hY3RpdmU9JWRcbiIsIHN0YXRl
LT5zZWxmX3JlZnJlc2hfYWN0aXZlKTsKIAlkcm1fcHJpbnRmKHAsICJcdHBsYW5lc19jaGFuZ2Vk
PSVkXG4iLCBzdGF0ZS0+cGxhbmVzX2NoYW5nZWQpOwogCWRybV9wcmludGYocCwgIlx0bW9kZV9j
aGFuZ2VkPSVkXG4iLCBzdGF0ZS0+bW9kZV9jaGFuZ2VkKTsKIAlkcm1fcHJpbnRmKHAsICJcdGFj
dGl2ZV9jaGFuZ2VkPSVkXG4iLCBzdGF0ZS0+YWN0aXZlX2NoYW5nZWQpOwpAQCAtOTk5LDYgKzEw
MDAsNyBAQCBzdGF0aWMgdm9pZCBkcm1fYXRvbWljX2Nvbm5lY3Rvcl9wcmludF9zdGF0ZShzdHJ1
Y3QgZHJtX3ByaW50ZXIgKnAsCiAKIAlkcm1fcHJpbnRmKHAsICJjb25uZWN0b3JbJXVdOiAlc1xu
IiwgY29ubmVjdG9yLT5iYXNlLmlkLCBjb25uZWN0b3ItPm5hbWUpOwogCWRybV9wcmludGYocCwg
Ilx0Y3J0Yz0lc1xuIiwgc3RhdGUtPmNydGMgPyBzdGF0ZS0+Y3J0Yy0+bmFtZSA6ICIobnVsbCki
KTsKKwlkcm1fcHJpbnRmKHAsICJcdHNlbGZfcmVmcmVzaF9hd2FyZT0lZFxuIiwgc3RhdGUtPnNl
bGZfcmVmcmVzaF9hd2FyZSk7CiAKIAlpZiAoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBE
Uk1fTU9ERV9DT05ORUNUT1JfV1JJVEVCQUNLKQogCQlpZiAoc3RhdGUtPndyaXRlYmFja19qb2Ig
JiYgc3RhdGUtPndyaXRlYmFja19qb2ItPmZiKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2RybV9hdG9taWNfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIu
YwppbmRleCBlNThiZTY5OTYwNjkyLi5iYzQzY2MwOGNkYzExIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0
b21pY19oZWxwZXIuYwpAQCAtMzMsNiArMzMsNyBAQAogI2luY2x1ZGUgPGRybS9kcm1fZGFtYWdl
X2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CiAjaW5jbHVkZSA8ZHJtL2Ry
bV9wbGFuZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIu
aD4KICNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV92Ymxhbmsu
aD4KICNpbmNsdWRlIDxkcm0vZHJtX3dyaXRlYmFjay5oPgpAQCAtOTUzLDEwICs5NTQsMzMgQEAg
aW50IGRybV9hdG9taWNfaGVscGVyX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYg
KHN0YXRlLT5sZWdhY3lfY3Vyc29yX3VwZGF0ZSkKIAkJc3RhdGUtPmFzeW5jX3VwZGF0ZSA9ICFk
cm1fYXRvbWljX2hlbHBlcl9hc3luY19jaGVjayhkZXYsIHN0YXRlKTsKIAorCWRybV9zZWxmX3Jl
ZnJlc2hfaGVscGVyX2FsdGVyX3N0YXRlKHN0YXRlKTsKKwogCXJldHVybiByZXQ7CiB9CiBFWFBP
UlRfU1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2NoZWNrKTsKIAorc3RhdGljIGJvb2wKK2NydGNf
bmVlZHNfZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9zdGF0ZSwKKwkJICAgc3Ry
dWN0IGRybV9jcnRjX3N0YXRlICpuZXdfc3RhdGUpCit7CisJLyoKKwkgKiBObyBuZXdfc3RhdGUg
bWVhbnMgdGhlIGNydGMgaXMgb2ZmLCBzbyB0aGUgb25seSBjcml0ZXJpYSBpcyB3aGV0aGVyCisJ
ICogaXQncyBjdXJyZW50bHkgYWN0aXZlIG9yIGluIHNlbGYgcmVmcmVzaCBtb2RlLgorCSAqLwor
CWlmICghbmV3X3N0YXRlKQorCQlyZXR1cm4gZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5X2Fj
dGl2ZShvbGRfc3RhdGUpOworCisJLyoKKwkgKiBXZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRoZSBj
cnRjX2Z1bmNzLT5kaXNhYmxlKCkgZnVuY3Rpb24gaWYgdGhlIGNydGMKKwkgKiBpcyBjdXJyZW50
bHkgb24sIGlmIGl0J3MgdHJhbnNpdGlvbmluZyB0byBzZWxmIHJlZnJlc2ggbW9kZSwgb3IgaWYK
KwkgKiBpdCdzIGluIHNlbGYgcmVmcmVzaCBtb2RlIGFuZCBuZWVkcyB0byBiZSBmdWxseSBkaXNh
YmxlZC4KKwkgKi8KKwlyZXR1cm4gb2xkX3N0YXRlLT5hY3RpdmUgfHwKKwkgICAgICAgKG9sZF9z
dGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSAmJiAhbmV3X3N0YXRlLT5lbmFibGUpIHx8CisJICAg
ICAgIG5ld19zdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZTsKK30KKwogc3RhdGljIHZvaWQKIGRp
c2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqb2xkX3N0YXRlKQogewpAQCAtOTc3LDcgKzEwMDEsMTQgQEAgZGlzYWJsZV9vdXRwdXRz
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3Rh
dGUpCiAKIAkJb2xkX2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShv
bGRfc3RhdGUsIG9sZF9jb25uX3N0YXRlLT5jcnRjKTsKIAotCQlpZiAoIW9sZF9jcnRjX3N0YXRl
LT5hY3RpdmUgfHwKKwkJaWYgKG5ld19jb25uX3N0YXRlLT5jcnRjKQorCQkJbmV3X2NydGNfc3Rh
dGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZSgKKwkJCQkJCW9sZF9zdGF0ZSwKKwkJ
CQkJCW5ld19jb25uX3N0YXRlLT5jcnRjKTsKKwkJZWxzZQorCQkJbmV3X2NydGNfc3RhdGUgPSBO
VUxMOworCisJCWlmICghY3J0Y19uZWVkc19kaXNhYmxlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0
Y19zdGF0ZSkgfHwKIAkJICAgICFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChvbGRfY29u
bl9zdGF0ZS0+Y3J0Yy0+c3RhdGUpKQogCQkJY29udGludWU7CiAKQEAgLTEwMjMsNyArMTA1NCw3
IEBAIGRpc2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCQlpZiAoIWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rl
c2V0KG5ld19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmICghb2xkX2NydGNfc3Rh
dGUtPmFjdGl2ZSkKKwkJaWYgKCFjcnRjX25lZWRzX2Rpc2FibGUob2xkX2NydGNfc3RhdGUsIG5l
d19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCWZ1bmNzID0gY3J0Yy0+aGVscGVyX3By
aXZhdGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19zdGF0ZV9oZWxw
ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5jCmluZGV4IDk3
YWIyNjY3OWI5NjkuLjdkNzM0N2E2ZjE5NDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9k
cm1fYXRvbWljX3N0YXRlX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWlj
X3N0YXRlX2hlbHBlci5jCkBAIC0xMjksNiArMTI5LDEwIEBAIHZvaWQgX19kcm1fYXRvbWljX2hl
bHBlcl9jcnRjX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJc3RhdGUt
PmNvbW1pdCA9IE5VTEw7CiAJc3RhdGUtPmV2ZW50ID0gTlVMTDsKIAlzdGF0ZS0+cGFnZWZsaXBf
ZmxhZ3MgPSAwOworCisJLyogU2VsZiByZWZyZXNoIHNob3VsZCBiZSBjYW5jZWxlZCB3aGVuIGEg
bmV3IHVwZGF0ZSBpcyBhdmFpbGFibGUgKi8KKwlzdGF0ZS0+YWN0aXZlID0gZHJtX2F0b21pY19j
cnRjX2VmZmVjdGl2ZWx5X2FjdGl2ZShzdGF0ZSk7CisJc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3Rp
dmUgPSBmYWxzZTsKIH0KIEVYUE9SVF9TWU1CT0woX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2R1
cGxpY2F0ZV9zdGF0ZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWlj
X3VhcGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGkuYwppbmRleCBlYjIyZThi
ZGQ4NTMxLi5hYmUzOGJkZjg1YWU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0
b21pY191YXBpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfdWFwaS5jCkBAIC00
OTAsNyArNDkwLDcgQEAgZHJtX2F0b21pY19jcnRjX2dldF9wcm9wZXJ0eShzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMsCiAJc3RydWN0IGRybV9tb2RlX2NvbmZpZyAqY29uZmlnID0gJmRldi0+bW9kZV9j
b25maWc7CiAKIAlpZiAocHJvcGVydHkgPT0gY29uZmlnLT5wcm9wX2FjdGl2ZSkKLQkJKnZhbCA9
IHN0YXRlLT5hY3RpdmU7CisJCSp2YWwgPSBkcm1fYXRvbWljX2NydGNfZWZmZWN0aXZlbHlfYWN0
aXZlKHN0YXRlKTsKIAllbHNlIGlmIChwcm9wZXJ0eSA9PSBjb25maWctPnByb3BfbW9kZV9pZCkK
IAkJKnZhbCA9IChzdGF0ZS0+bW9kZV9ibG9iKSA/IHN0YXRlLT5tb2RlX2Jsb2ItPmJhc2UuaWQg
OiAwOwogCWVsc2UgaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+cHJvcF92cnJfZW5hYmxlZCkKQEAg
LTc4OCw3ICs3ODgsMTAgQEAgZHJtX2F0b21pY19jb25uZWN0b3JfZ2V0X3Byb3BlcnR5KHN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+cHJv
cF9jcnRjX2lkKSB7CiAJCSp2YWwgPSAoc3RhdGUtPmNydGMpID8gc3RhdGUtPmNydGMtPmJhc2Uu
aWQgOiAwOwogCX0gZWxzZSBpZiAocHJvcGVydHkgPT0gY29uZmlnLT5kcG1zX3Byb3BlcnR5KSB7
Ci0JCSp2YWwgPSBjb25uZWN0b3ItPmRwbXM7CisJCWlmIChzdGF0ZS0+Y3J0YyAmJiBzdGF0ZS0+
Y3J0Yy0+c3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUpCisJCQkqdmFsID0gRFJNX01PREVfRFBN
U19PTjsKKwkJZWxzZQorCQkJKnZhbCA9IGNvbm5lY3Rvci0+ZHBtczsKIAl9IGVsc2UgaWYgKHBy
b3BlcnR5ID09IGNvbmZpZy0+dHZfc2VsZWN0X3N1YmNvbm5lY3Rvcl9wcm9wZXJ0eSkgewogCQkq
dmFsID0gc3RhdGUtPnR2LnN1YmNvbm5lY3RvcjsKIAl9IGVsc2UgaWYgKHByb3BlcnR5ID09IGNv
bmZpZy0+dHZfbGVmdF9tYXJnaW5fcHJvcGVydHkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9zZWxm
X3JlZnJlc2hfaGVscGVyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
MC4uYzcwODNjNTY5NGZlZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1f
c2VsZl9yZWZyZXNoX2hlbHBlci5jCkBAIC0wLDAgKzEsMjEzIEBACisvKiBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IChDKSAyMDE5IEdvb2dsZSwgSW5j
LgorICoKKyAqIEF1dGhvcnM6CisgKiBTZWFuIFBhdWwgPHNlYW5wYXVsQGNocm9taXVtLm9yZz4K
KyAqLworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9t
aWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxk
cm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRy
bS9kcm1fbW9kZV9jb25maWcuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzZXRfbG9jay5oPgor
I2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NlbGZfcmVmcmVz
aF9oZWxwZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9iaXRvcHMuaD4KKyNpbmNsdWRlIDxsaW51eC9z
bGFiLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CisKKy8qKgorICogRE9DOiBvdmVy
dmlldworICoKKyAqIFRoaXMgaGVscGVyIGxpYnJhcnkgcHJvdmlkZXMgYW4gZWFzeSB3YXkgZm9y
IGRyaXZlcnMgdG8gbGV2ZXJhZ2UgdGhlIGF0b21pYworICogZnJhbWV3b3JrIHRvIGltcGxlbWVu
dCBwYW5lbCBzZWxmIHJlZnJlc2ggKFNSKSBzdXBwb3J0LiBEcml2ZXJzIGFyZQorICogcmVzcG9u
c2libGUgZm9yIGluaXRpYWxpemluZyBhbmQgY2xlYW5pbmcgdXAgdGhlIFNSIGhlbHBlcnMgb24g
bG9hZC91bmxvYWQKKyAqIChzZWUgJmRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQvJmRybV9z
ZWxmX3JlZnJlc2hfaGVscGVyX2NsZWFudXApLgorICogVGhlIGNvbm5lY3RvciBpcyByZXNwb25z
aWJsZSBmb3Igc2V0dGluZworICogJmRybV9jb25uZWN0b3Jfc3RhdGUuc2VsZl9yZWZyZXNoX2F3
YXJlIHRvIHRydWUgYXQgcnVudGltZSBpZiBpdCBpcyBTUi1hd2FyZQorICogKG1lYW5pbmcgaXQg
a25vd3MgaG93IHRvIGluaXRpYXRlIHNlbGYgcmVmcmVzaCBvbiB0aGUgcGFuZWwpLgorICoKKyAq
IE9uY2UgYSBjcnRjIGhhcyBlbmFibGVkIFNSIHVzaW5nICZkcm1fc2VsZl9yZWZyZXNoX2hlbHBl
cl9pbml0LCB0aGUKKyAqIGhlbHBlcnMgd2lsbCBtb25pdG9yIGFjdGl2aXR5IGFuZCBjYWxsIGJh
Y2sgaW50byB0aGUgZHJpdmVyIHRvIGVuYWJsZS9kaXNhYmxlCisgKiBTUiBhcyBhcHByb3ByaWF0
ZS4gVGhlIGJlc3Qgd2F5IHRvIHRoaW5rIGFib3V0IHRoaXMgaXMgdGhhdCBpdCdzIGEgRFBNUwor
ICogb24vb2ZmIHJlcXVlc3Qgd2l0aCAmZHJtX2NydGNfc3RhdGUuc2VsZl9yZWZyZXNoX2FjdGl2
ZSBzZXQgaW4gY3J0YyBzdGF0ZQorICogdGhhdCB0ZWxscyB5b3UgdG8gZGlzYWJsZS9lbmFibGUg
U1Igb24gdGhlIHBhbmVsIGluc3RlYWQgb2YgcG93ZXItY3ljbGluZyBpdC4KKyAqCisgKiBEdXJp
bmcgU1IsIGRyaXZlcnMgbWF5IGNob29zZSB0byBmdWxseSBkaXNhYmxlIHRoZWlyIGNydGMvZW5j
b2Rlci9icmlkZ2UKKyAqIGhhcmR3YXJlIChpbiB3aGljaCBjYXNlIG5vIGRyaXZlciBjaGFuZ2Vz
IGFyZSBuZWNlc3NhcnkpLCBvciB0aGV5IGNhbiBpbnNwZWN0CisgKiAmZHJtX2NydGNfc3RhdGUu
c2VsZl9yZWZyZXNoX2FjdGl2ZSBpZiB0aGV5IHdhbnQgdG8gZW50ZXIgbG93IHBvd2VyIG1vZGUK
KyAqIHdpdGhvdXQgZnVsbCBkaXNhYmxlIChpbiBjYXNlIGZ1bGwgZGlzYWJsZS9lbmFibGUgaXMg
dG9vIHNsb3cpLgorICoKKyAqIFNSIHdpbGwgYmUgZGVhY3RpdmF0ZWQgaWYgdGhlcmUgYXJlIGFu
eSBhdG9taWMgdXBkYXRlcyBhZmZlY3RpbmcgdGhlCisgKiBwaXBlIHRoYXQgaXMgaW4gU1IgbW9k
ZS4gSWYgYSBjcnRjIGlzIGRyaXZpbmcgbXVsdGlwbGUgY29ubmVjdG9ycywgYWxsCisgKiBjb25u
ZWN0b3JzIG11c3QgYmUgU1IgYXdhcmUgYW5kIGFsbCB3aWxsIGVudGVyL2V4aXQgU1IgbW9kZSBh
dCB0aGUgc2FtZSB0aW1lLgorICoKKyAqIElmIHRoZSBjcnRjIGFuZCBjb25uZWN0b3IgYXJlIFNS
IGF3YXJlLCBidXQgdGhlIHBhbmVsIGNvbm5lY3RlZCBkb2VzIG5vdAorICogc3VwcG9ydCBpdCAo
b3IgaXMgb3RoZXJ3aXNlIHVuYWJsZSB0byBlbnRlciBTUiksIHRoZSBkcml2ZXIgc2hvdWxkIGZh
aWwKKyAqIGF0b21pY19jaGVjayB3aGVuICZkcm1fY3J0Y19zdGF0ZS5zZWxmX3JlZnJlc2hfYWN0
aXZlIGlzIHRydWUuCisgKi8KKworc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSB7CisJc3Ry
dWN0IGRybV9jcnRjICpjcnRjOworCXN0cnVjdCBkZWxheWVkX3dvcmsgZW50cnlfd29yazsKKwlz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc2F2ZV9zdGF0ZTsKKwl1bnNpZ25lZCBpbnQgZW50cnlf
ZGVsYXlfbXM7Cit9OworCitzdGF0aWMgdm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9lbnRy
eV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZHJtX3NlbGZfcmVm
cmVzaF9kYXRhICpzcl9kYXRhID0gY29udGFpbmVyX29mKAorCQkJCXRvX2RlbGF5ZWRfd29yayh3
b3JrKSwKKwkJCQlzdHJ1Y3QgZHJtX3NlbGZfcmVmcmVzaF9kYXRhLCBlbnRyeV93b3JrKTsKKwlz
dHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBzcl9kYXRhLT5jcnRjOworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBjcnRjLT5kZXY7CisJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4IGN0eDsK
KwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGU7CisJc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm47CisJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGU7CisJc3RydWN0
IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCWludCBpLCByZXQ7CisKKwlkcm1fbW9kZXNl
dF9hY3F1aXJlX2luaXQoJmN0eCwgMCk7CisKKwlzdGF0ZSA9IGRybV9hdG9taWNfc3RhdGVfYWxs
b2MoZGV2KTsKKwlpZiAoIXN0YXRlKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gb3V0Owor
CX0KKworcmV0cnk6CisJc3RhdGUtPmFjcXVpcmVfY3R4ID0gJmN0eDsKKworCWNydGNfc3RhdGUg
PSBkcm1fYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwlpZiAoSVNfRVJSKGNy
dGNfc3RhdGUpKSB7CisJCXJldCA9IFBUUl9FUlIoY3J0Y19zdGF0ZSk7CisJCWdvdG8gb3V0Owor
CX0KKworCWlmICghY3J0Y19zdGF0ZS0+ZW5hYmxlKQorCQlnb3RvIG91dDsKKworCXJldCA9IGRy
bV9hdG9taWNfYWRkX2FmZmVjdGVkX2Nvbm5lY3RvcnMoc3RhdGUsIGNydGMpOworCWlmIChyZXQp
CisJCWdvdG8gb3V0OworCisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwg
Y29ubiwgY29ubl9zdGF0ZSwgaSkgeworCQlpZiAoIWNvbm5fc3RhdGUtPnNlbGZfcmVmcmVzaF9h
d2FyZSkKKwkJCWdvdG8gb3V0OworCX0KKworCWNydGNfc3RhdGUtPmFjdGl2ZSA9IGZhbHNlOwor
CWNydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUgPSB0cnVlOworCisJcmV0ID0gZHJtX2F0
b21pY19jb21taXQoc3RhdGUpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCitvdXQ6CisJaWYg
KHJldCA9PSAtRURFQURMSykgeworCQlkcm1fYXRvbWljX3N0YXRlX2NsZWFyKHN0YXRlKTsKKwkJ
cmV0ID0gZHJtX21vZGVzZXRfYmFja29mZigmY3R4KTsKKwkJaWYgKCFyZXQpCisJCQlnb3RvIHJl
dHJ5OworCX0KKworCWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsKKwlkcm1fbW9kZXNldF9k
cm9wX2xvY2tzKCZjdHgpOworCWRybV9tb2Rlc2V0X2FjcXVpcmVfZmluaSgmY3R4KTsKK30KKwor
LyoqCisgKiBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZSAtIEFsdGVycyB0aGUg
YXRvbWljIHN0YXRlIGZvciBTUiBleGl0CisgKiBAc3RhdGU6IHRoZSBzdGF0ZSBjdXJyZW50bHkg
YmVpbmcgY2hlY2tlZAorICoKKyAqIENhbGxlZCBhdCB0aGUgZW5kIG9mIGF0b21pYyBjaGVjay4g
VGhpcyBmdW5jdGlvbiBjaGVja3MgdGhlIHN0YXRlIGZvciBmbGFncworICogaW5jb21wYXRpYmxl
IHdpdGggc2VsZiByZWZyZXNoIGV4aXQgYW5kIGNoYW5nZXMgdGhlbS4gVGhpcyBpcyBhIGJpdAor
ICogZGlzaW5nZW51b3VzIHNpbmNlIHVzZXJzcGFjZSBpcyBleHBlY3Rpbmcgb25lIHRoaW5nIGFu
ZCB3ZSdyZSBnaXZpbmcgaXQKKyAqIGFub3RoZXIuIEhvd2V2ZXIgaW4gb3JkZXIgdG8ga2VlcCBz
ZWxmIHJlZnJlc2ggZW50aXJlbHkgaGlkZGVuIGZyb20KKyAqIHVzZXJzcGFjZSwgdGhpcyBpcyBy
ZXF1aXJlZC4KKyAqCisgKiBBdCB0aGUgZW5kLCB3ZSBxdWV1ZSB1cCB0aGUgc2VsZiByZWZyZXNo
IGVudHJ5IHdvcmsgc28gd2UgY2FuIGVudGVyIFBTUiBhZnRlcgorICogdGhlIGRlc2lyZWQgZGVs
YXkuCisgKi8KK3ZvaWQgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfYWx0ZXJfc3RhdGUoc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKwlz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJaW50IGk7CisKKwlpZiAoc3RhdGUt
PmFzeW5jX3VwZGF0ZSB8fCAhc3RhdGUtPmFsbG93X21vZGVzZXQpIHsKKwkJZm9yX2VhY2hfb2xk
X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKKwkJCWlmIChjcnRj
X3N0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKSB7CisJCQkJc3RhdGUtPmFzeW5jX3VwZGF0ZSA9
IGZhbHNlOworCQkJCXN0YXRlLT5hbGxvd19tb2Rlc2V0ID0gdHJ1ZTsKKwkJCQlicmVhazsKKwkJ
CX0KKwkJfQorCX0KKworCWZvcl9lYWNoX25ld19jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBj
cnRjX3N0YXRlLCBpKSB7CisJCXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEgKnNyX2RhdGE7
CisKKwkJLyogRG9uJ3QgdHJpZ2dlciB0aGUgZW50cnkgdGltZXIgd2hlbiB3ZSdyZSBhbHJlYWR5
IGluIFNSICovCisJCWlmIChjcnRjX3N0YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQkJY29u
dGludWU7CisKKwkJc3JfZGF0YSA9IGNydGMtPnNlbGZfcmVmcmVzaF9kYXRhOworCQlpZiAoIXNy
X2RhdGEpCisJCQljb250aW51ZTsKKworCQltb2RfZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJnNy
X2RhdGEtPmVudHJ5X3dvcmssCisJCQkJIG1zZWNzX3RvX2ppZmZpZXMoc3JfZGF0YS0+ZW50cnlf
ZGVsYXlfbXMpKTsKKwl9Cit9CitFWFBPUlRfU1lNQk9MKGRybV9zZWxmX3JlZnJlc2hfaGVscGVy
X2FsdGVyX3N0YXRlKTsKKworLyoqCisgKiBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9pbml0IC0g
SW5pdGlhbGl6ZXMgc2VsZiByZWZyZXNoIGhlbHBlcnMgZm9yIGEgY3J0YworICogQGNydGM6IHRo
ZSBjcnRjIHdoaWNoIHN1cHBvcnRzIHNlbGYgcmVmcmVzaCBzdXBwb3J0ZWQgZGlzcGxheXMKKyAq
IEBlbnRyeV9kZWxheV9tczogYW1vdW50IG9mIGluYWN0aXZpdHkgdG8gd2FpdCBiZWZvcmUgZW50
ZXJpbmcgc2VsZiByZWZyZXNoCisgKi8KK2ludCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9pbml0
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgdW5zaWduZWQgaW50IGVudHJ5X2RlbGF5X21z
KQoreworCXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEgKnNyX2RhdGEgPSBjcnRjLT5zZWxm
X3JlZnJlc2hfZGF0YTsKKworCS8qIEhlbHBlciBpcyBhbHJlYWR5IGluaXRpYWxpemVkICovCisJ
aWYgKFdBUk5fT04oc3JfZGF0YSkpCisJCXJldHVybiAtRUlOVkFMOworCisJc3JfZGF0YSA9IGt6
YWxsb2Moc2l6ZW9mKCpzcl9kYXRhKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzcl9kYXRhKQorCQly
ZXR1cm4gLUVOT01FTTsKKworCUlOSVRfREVMQVlFRF9XT1JLKCZzcl9kYXRhLT5lbnRyeV93b3Jr
LAorCQkJICBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9lbnRyeV93b3JrKTsKKwlzcl9kYXRhLT5l
bnRyeV9kZWxheV9tcyA9IGVudHJ5X2RlbGF5X21zOworCXNyX2RhdGEtPmNydGMgPSBjcnRjOwor
CisJY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGEgPSBzcl9kYXRhOworCXJldHVybiAwOworfQorRVhQ
T1JUX1NZTUJPTChkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9pbml0KTsKKworLyoqCisgKiBkcm1f
c2VsZl9yZWZyZXNoX2hlbHBlcl9jbGVhbnVwIC0gQ2xlYW5zIHVwIHNlbGYgcmVmcmVzaCBoZWxw
ZXJzIGZvciBhIGNydGMKKyAqIEBjcnRjOiB0aGUgY3J0YyB0byBjbGVhbnVwCisgKi8KK3ZvaWQg
ZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfY2xlYW51cChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCit7
CisJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3JfZGF0YSA9IGNydGMtPnNlbGZfcmVm
cmVzaF9kYXRhOworCisJLyogSGVscGVyIGlzIGFscmVhZHkgdW5pbml0aWFsaXplZCAqLworCWlm
IChzcl9kYXRhKQorCQlyZXR1cm47CisKKwljcnRjLT5zZWxmX3JlZnJlc2hfZGF0YSA9IE5VTEw7
CisKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJnNyX2RhdGEtPmVudHJ5X3dvcmspOworCWtm
cmVlKHNyX2RhdGEpOworfQorRVhQT1JUX1NZTUJPTChkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9j
bGVhbnVwKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9hdG9taWMuaCBiL2luY2x1ZGUv
ZHJtL2RybV9hdG9taWMuaAppbmRleCBmMTIyMTU2NDc4MDEwLi45MjdlMTIwNWQ3YWE0IDEwMDY0
NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fYXRvbWljLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2F0
b21pYy5oCkBAIC05NTcsNCArOTU3LDE5IEBAIGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0
KGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCiAJICAgICAgIHN0YXRlLT5jb25u
ZWN0b3JzX2NoYW5nZWQ7CiB9CiAKKy8qKgorICogZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5
X2FjdGl2ZSAtIGNvbXB1dGUgd2hldGhlciBjcnRjIGlzIGFjdHVhbGx5IGFjdGl2ZQorICogQHN0
YXRlOiAmZHJtX2NydGNfc3RhdGUgZm9yIHRoZSBDUlRDCisgKgorICogV2hlbiBpbiBzZWxmIHJl
ZnJlc2ggbW9kZSwgdGhlIGNydGNfc3RhdGUtPmFjdGl2ZSB2YWx1ZSB3aWxsIGJlIGZhbHNlLCBz
aW5jZQorICogdGhlIGNydGMgaXMgb2ZmLiBIb3dldmVyIGluIHNvbWUgY2FzZXMgd2UncmUgaW50
ZXJlc3RlZCBpbiB3aGV0aGVyIHRoZSBjcnRjCisgKiBpcyBhY3RpdmUsIG9yIGVmZmVjdGl2ZWx5
IGFjdGl2ZSAoaWU6IGl0J3MgY29ubmVjdGVkIHRvIGFuIGFjdGl2ZSBkaXNwbGF5KS4KKyAqIElu
IHRoZXNlIGNhc2VzLCB1c2UgdGhpcyBmdW5jdGlvbiBpbnN0ZWFkIG9mIGp1c3QgY2hlY2tpbmcg
YWN0aXZlLgorICovCitzdGF0aWMgaW5saW5lIGJvb2wKK2RybV9hdG9taWNfY3J0Y19lZmZlY3Rp
dmVseV9hY3RpdmUoY29uc3Qgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKK3sKKwlyZXR1
cm4gc3RhdGUtPmFjdGl2ZSB8fCBzdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZTsKK30KKwogI2Vu
ZGlmIC8qIERSTV9BVE9NSUNfSF8gKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9jb25u
ZWN0b3IuaCBiL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaAppbmRleCAwNzExNDNiYzBlYmQx
Li5jNmY4NDg2ZDhiOGYzIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fY29ubmVjdG9yLmgK
KysrIGIvaW5jbHVkZS9kcm0vZHJtX2Nvbm5lY3Rvci5oCkBAIC01NDgsNiArNTQ4LDIwIEBAIHN0
cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlIHsKIAkvKiogQHR2OiBUViBjb25uZWN0b3Igc3RhdGUg
Ki8KIAlzdHJ1Y3QgZHJtX3R2X2Nvbm5lY3Rvcl9zdGF0ZSB0djsKIAorCS8qKgorCSAqIEBzZWxm
X3JlZnJlc2hfYXdhcmU6CisJICoKKwkgKiBUaGlzIHRyYWNrcyB3aGV0aGVyIGEgY29ubmVjdG9y
IGlzIGF3YXJlIG9mIHRoZSBzZWxmIHJlZnJlc2ggc3RhdGUuCisJICogSXQgc2hvdWxkIGJlIHNl
dCB0byB0cnVlIGZvciB0aG9zZSBjb25uZWN0b3IgaW1wbGVtZW50YXRpb25zIHdoaWNoCisJICog
dW5kZXJzdGFuZCB0aGUgc2VsZiByZWZyZXNoIHN0YXRlLiBUaGlzIGlzIG5lZWRlZCBzaW5jZSB0
aGUgY3J0YworCSAqIHJlZ2lzdGVycyB0aGUgc2VsZiByZWZyZXNoIGhlbHBlcnMgYW5kIGl0IGRv
ZXNuJ3Qga25vdyBpZiB0aGUKKwkgKiBjb25uZWN0b3JzIGRvd25zdHJlYW0gaGF2ZSBpbXBsZW1l
bnRlZCBzZWxmIHJlZnJlc2ggZW50cnkvZXhpdC4KKwkgKgorCSAqIERyaXZlcnMgc2hvdWxkIHNl
dCB0aGlzIHRvIHRydWUgaW4gYXRvbWljX2NoZWNrIGlmIHRoZXkga25vdyBob3cgdG8KKwkgKiBo
YW5kbGUgc2VsZl9yZWZyZXNoIHJlcXVlc3RzLgorCSAqLworCWJvb2wgc2VsZl9yZWZyZXNoX2F3
YXJlOworCiAJLyoqCiAJICogQHBpY3R1cmVfYXNwZWN0X3JhdGlvOiBDb25uZWN0b3IgcHJvcGVy
dHkgdG8gY29udHJvbCB0aGUKIAkgKiBIRE1JIGluZm9mcmFtZSBhc3BlY3QgcmF0aW8gc2V0dGlu
Zy4KZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9jcnRjLmggYi9pbmNsdWRlL2RybS9kcm1f
Y3J0Yy5oCmluZGV4IGRjNDJiOWUzNTMzMzMuLjRmZGE2MTBkNzZmMjYgMTAwNjQ0Ci0tLSBhL2lu
Y2x1ZGUvZHJtL2RybV9jcnRjLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2NydGMuaApAQCAtNTQs
NiArNTQsNyBAQCBzdHJ1Y3QgZHJtX21vZGVfc2V0Owogc3RydWN0IGRybV9maWxlOwogc3RydWN0
IGRybV9jbGlwX3JlY3Q7CiBzdHJ1Y3QgZHJtX3ByaW50ZXI7CitzdHJ1Y3QgZHJtX3NlbGZfcmVm
cmVzaF9kYXRhOwogc3RydWN0IGRldmljZV9ub2RlOwogc3RydWN0IGRtYV9mZW5jZTsKIHN0cnVj
dCBlZGlkOwpAQCAtMzAwLDYgKzMwMSwxNyBAQCBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgewogCSAq
LwogCWJvb2wgdnJyX2VuYWJsZWQ7CiAKKwkvKioKKwkgKiBAc2VsZl9yZWZyZXNoX2FjdGl2ZToK
KwkgKgorCSAqIFVzZWQgYnkgdGhlIHNlbGYgcmVmcmVzaCBoZWxwZXJzIHRvIGRlbm90ZSB3aGVu
IGEgc2VsZiByZWZyZXNoCisJICogdHJhbnNpdGlvbiBpcyBvY2N1cmluZy4gVGhpcyB3aWxsIGJl
IHNldCBvbiBlbmFibGUvZGlzYWJsZSBjYWxsYmFja3MKKwkgKiB3aGVuIHNlbGYgcmVmcmVzaCBp
cyBiZWluZyBlbmFibGVkIG9yIGRpc2FibGVkLiBJbiBzb21lIGNhc2VzLCBpdCBtYXkKKwkgKiBu
b3QgYmUgZGVzaXJhYmxlIHRvIGZ1bGx5IHNodXQgb2ZmIHRoZSBjcnRjIGR1cmluZyBzZWxmIHJl
ZnJlc2guCisJICogQ1JUQydzIGNhbiBpbnNwZWN0IHRoaXMgZmxhZyBhbmQgZGV0ZXJtaW5lIHRo
ZSBiZXN0IGNvdXJzZSBvZiBhY3Rpb24uCisJICovCisJYm9vbCBzZWxmX3JlZnJlc2hfYWN0aXZl
OworCiAJLyoqCiAJICogQGV2ZW50OgogCSAqCkBAIC0xMDg4LDYgKzExMDAsMTMgQEAgc3RydWN0
IGRybV9jcnRjIHsKIAkgKiBUaGUgbmFtZSBvZiB0aGUgQ1JUQydzIGZlbmNlIHRpbWVsaW5lLgog
CSAqLwogCWNoYXIgdGltZWxpbmVfbmFtZVszMl07CisKKwkvKioKKwkgKiBAc2VsZl9yZWZyZXNo
X2RhdGE6IEhvbGRzIHRoZSBzdGF0ZSBmb3IgdGhlIHNlbGYgcmVmcmVzaCBoZWxwZXJzCisJICoK
KwkgKiBJbml0aWFsaXplZCB2aWEgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfcmVnaXN0ZXIoKS4K
KwkgKi8KKwlzdHJ1Y3QgZHJtX3NlbGZfcmVmcmVzaF9kYXRhICpzZWxmX3JlZnJlc2hfZGF0YTsK
IH07CiAKIC8qKgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxw
ZXIuaCBiL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwMC4uNDA1ZTg2ZmI4NDYxZQotLS0gL2Rldi9udWxs
CisrKyBiL2luY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKQEAgLTAsMCArMSwy
MiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdo
dCAoQykgMjAxOSBHb29nbGUsIEluYy4KKyAqCisgKiBBdXRob3JzOgorICogU2VhbiBQYXVsIDxz
ZWFucGF1bEBjaHJvbWl1bS5vcmc+CisgKi8KKyNpZm5kZWYgRFJNX1NFTEZfUkVGUkVTSF9IRUxQ
RVJfSF8KKyNkZWZpbmUgRFJNX1NFTEZfUkVGUkVTSF9IRUxQRVJfSF8KKworc3RydWN0IGRybV9h
dG9taWNfc3RhdGU7CitzdHJ1Y3QgZHJtX2Nvbm5lY3RvcjsKK3N0cnVjdCBkcm1fZGV2aWNlOwor
c3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4OworCit2b2lkIGRybV9zZWxmX3JlZnJlc2hf
aGVscGVyX2FsdGVyX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisKK2lu
dCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9pbml0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJ
CQkgICAgIHVuc2lnbmVkIGludCBlbnRyeV9kZWxheV9tcyk7CisKK3ZvaWQgZHJtX3NlbGZfcmVm
cmVzaF9oZWxwZXJfY2xlYW51cChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpOworI2VuZGlmCi0tIApT
ZWFuIFBhdWwsIFNvZnR3YXJlIEVuZ2luZWVyLCBHb29nbGUgLyBDaHJvbWl1bSBPUwoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
