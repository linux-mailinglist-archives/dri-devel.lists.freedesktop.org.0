Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 39F10585D2
	for <lists+dri-devel@lfdr.de>; Thu, 27 Jun 2019 17:33:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AE1F16E4F8;
	Thu, 27 Jun 2019 15:33:26 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id 2B54C6E0D1
 for <dri-devel@lists.freedesktop.org>; Thu, 27 Jun 2019 11:19:48 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 7160D2B;
 Thu, 27 Jun 2019 04:19:47 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id BDC323F718;
 Thu, 27 Jun 2019 04:19:46 -0700 (PDT)
Subject: Re: [RFC PATCH] drm/panfrost: Add support for mapping BOs on GPU page
 faults
To: Rob Herring <robh@kernel.org>, dri-devel@lists.freedesktop.org
References: <20190610170440.28525-1-robh@kernel.org>
From: Steven Price <steven.price@arm.com>
Message-ID: <317d8a54-d5d4-7bfa-6e37-4de9bc4ba848@arm.com>
Date: Thu, 27 Jun 2019 12:19:45 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190610170440.28525-1-robh@kernel.org>
Content-Language: en-GB
X-Mailman-Approved-At: Thu, 27 Jun 2019 15:33:25 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Boris Brezillon <boris.brezillon@collabora.com>,
 Robin Murphy <robin.murphy@arm.com>, Alyssa Rosenzweig <alyssa@rosenzweig.io>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMTAvMDYvMjAxOSAxODowNCwgUm9iIEhlcnJpbmcgd3JvdGU6Cj4gVGhlIG1pZGdhcmQvYmlm
cm9zdCBHUFVzIG5lZWQgdG8gYWxsb2NhdGUgR1BVIG1lbW9yeSB3aGljaCBpcyBhbGxvY2F0ZWQK
PiBvbiBHUFUgcGFnZSBmYXVsdHMgYW5kIG5vdCBwaW5uZWQgaW4gbWVtb3J5LiBUaGUgdmVuZG9y
IGRyaXZlciBjYWxscwo+IHRoaXMgZnVuY3Rpb25hbGl0eSBHUk9XX09OX0dQRi4KPiAKPiBUaGlz
IGltcGxlbWVudGF0aW9uIGFzc3VtZXMgdGhhdCBCT3MgYWxsb2NhdGVkIHdpdGggdGhlCj4gUEFO
RlJPU1RfQk9fTk9NQVAgZmxhZyBhcmUgbmV2ZXIgbW1hcHBlZCBvciBleHBvcnRlZC4gQm90aCBv
ZiB0aG9zZSBtYXkKPiBhY3R1YWxseSB3b3JrLCBidXQgSSdtIHVuc3VyZSBpZiB0aGVyZSdzIHNv
bWUgaW50ZXJhY3Rpb24gdGhlcmUuIEl0Cj4gd291bGQgY2F1c2UgdGhlIHdob2xlIG9iamVjdCB0
byBiZSBwaW5uZWQgaW4gbWVtb3J5IHdoaWNoIHdvdWxkIGRlZmVhdAo+IHRoZSBwb2ludCBvZiB0
aGlzLgo+IAo+IElzc3Vlcy9xdWVzdGlvbnMvdGhvdWdodHM6Cj4gCj4gV2hhdCdzIHRoZSBkaWZm
ZXJlbmNlIGJldHdlZW4gaV9tYXBwaW5nIGFuZCBmX21hcHBpbmc/Cj4gCj4gV2hhdCBraW5kIG9m
IGNsZWFuLXVwIG9uIGNsb3NlIGlzIG5lZWRlZD8gQmFzZWQgb24gdmdlbSBmYXVsdHMsIHRoZXJl
Cj4gZG9lc24ndCBzZWVtIHRvIGJlIGFueSByZWZjb3VudGluZy4gQXNzdW1lIHVzZXJzcGFjZSBp
cyByZXNwb25zaWJsZSBmb3IKPiBub3QgZnJlZWluZyB0aGUgQk8gd2hpbGUgYSBwYWdlIGZhdWx0
IGNhbiBvY2N1cj8KPiAKPiBXaGF0IGFib3V0IGV2aWN0aW9ucz8gTmVlZCB0byBjYWxsIG1hcHBp
bmdfc2V0X3VuZXZpY3RhYmxlKCk/IE1heWJlIHdlCj4gd2FudCB0aGVzZSBwYWdlcyB0byBiZSBz
d2FwcGFibGUsIGJ1dCB0aGVuIHdlIG5lZWQgc29tZSBub3RpZmljYXRpb24gdG8KPiB1bm1hcCB0
aGVtLgo+IAo+IE5vIG5lZWQgZm9yIHJ1bnRpbWUgUE0sIGJlY2F1c2UgZmF1bHRzIHNob3VsZCBv
bmx5IG9jY3VyIGR1cmluZyBqb2IKPiBzdWJtaXQ/CgpBbHRob3VnaCBub3JtYWxseSBmYXVsdHMg
c2hvdWxkIG9ubHkgb2NjdXIgd2hlbiBhIGpvYiBpcyBydW5uaW5nIEkKYmVsaWV2ZSBpbiBzb21l
IHNpdHVhdGlvbnMgaXQgaXMgcG9zc2libGUgZm9yIHRoZSBqb2IgdG8gaGF2ZSBjb21wbGV0ZWQK
d2hpbGUgdGhlcmUgaXMgYSBwYWdlIGZhdWx0IG91dHN0YW5kaW5nIChJIHRoaW5rIHRoaXMgY2Fu
IG9jY3VyIHdoZW4gdGhlCmpvYiBmYWlscyBhdCB0aGUgc2FtZSB0aW1lIGFzIHRoZSBwYWdlIGZh
dWx0IGhhcHBlbnMpLiBJbiB0aGlzIHNpdHVhdGlvbgp0aGUgR1BVIG1pZ2h0IGJlIGNvbnNpZGVy
ZWQgaWRsZSB3aGVuIHRoZSBNTVUgaXJxIGlzIGJlaW5nIGhhbmRsZWQuCgo+IE5lZWQgdG8gZmF1
bHQgaW4gMk1CIHNlY3Rpb25zIHdoZW4gcG9zc2libGUuIEl0IHNlZW1zIHRoaXMgaGFzIHRvIGJl
Cj4gZG9uZSBieSBnZXR0aW5nIGFuIGFycmF5IG9mIHN0cnVjdCBwYWdlcyBhbmQgdGhlbiBjb252
ZXJ0aW5nIHRvIGEKPiBzY2F0dGVybGlzdC4gTm90IHN1cmUgaWYgdGhlcmUgaXMgYSBiZXR0ZXIg
d2F5IHRvIGRvIHRoYXQuIFRoZXJlJ3MgYWxzbwo+IHNvbWUgZXJyYXRhIG9uIFQ2MDQgbmVlZGlu
ZyB0byBmYXVsdCBpbiBhdCBsZWFzdCA4IHBhZ2VzIGF0IGEgdGltZSB3aGljaAo+IGlzbid0IGhh
bmRsZWQuCgprYmFzZSBzaW1wbHkgZG9lc24ndCBzdXBwb3J0IGEgcGFnZS1ieS1wYWdlIG1hcHBp
bmcgb2YgbWVtb3J5LiBUaGVyZSBpcwphIHJlZ2lvbiBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgYnVm
ZmVyIHdoaWNoIGlzIG1hcHBlZCBhbmQgYWZ0ZXIgdGhhdCB0aGUKYnVmZmVyIGlzIHVubWFwcGVk
LiBJdCBpcyB0aGVuIHF1aXRlIHNpbXBsZSB0byByb3VuZCB1cCB0aGUgcmVnaW9uIHRvCm1hcCB0
byB0aGUgbmV4dCAyTUIgc2VjdGlvbi84LXBhZ2UgYm91bmRhcnkuIEl0J3MgYWxzbyBhIGdvb2QK
cGVyZm9ybWFuY2UgaW1wcm92ZW1lbnQgYmVjYXVzZSBwYWdlIGZhdWx0cyBhcmUgcmVsYXRpdmVs
eSBleHBlbnNpdmUgYW5kCnlvdSBtaWdodCBuZWVkIHRvIGdyb3cgdGhlIGJ1ZmZlciBieSBhIGxh
cmdlIHNpemUgZm9yIHRoZSBqb2IgdG8KY29tcGxldGUgKGUuZy4gb24gdGhlIGZpcnN0IGZldyBm
cmFtZXMpLiBUaGVyZSBhcmVuJ3QgbWFueSB1c2UtY2FzZXMgZm9yCmhhdmluZyBhIGJ1ZmZlciB3
aXRoIG11bHRpcGxlIGhvbGVzIGluIC0gYWx0aG91Z2ggVnVsa2FuIGRvZXMgaGF2ZSBhCiJzcGFy
c2UiIG1lY2hhbmlzbSB3aGljaCBtaWdodCByZXF1aXJlIHNvbWV0aGluZyBzaW1pbGFyIChidXQg
dW5saWtlbHkKdG8gcmVxdWlyZSBmYXVsdGluZyBpbikuCgo+IENjOiBSb2JpbiBNdXJwaHkgPHJv
YmluLm11cnBoeUBhcm0uY29tPgo+IENjOiBTdGV2ZW4gUHJpY2UgPHN0ZXZlbi5wcmljZUBhcm0u
Y29tPgo+IENjOiBBbHlzc2EgUm9zZW56d2VpZyA8YWx5c3NhQHJvc2VuendlaWcuaW8+Cj4gQ2M6
IFRvbWV1IFZpem9zbyA8dG9tZXVAdG9tZXV2aXpvc28ubmV0Pgo+IFNpZ25lZC1vZmYtYnk6IFJv
YiBIZXJyaW5nIDxyb2JoQGtlcm5lbC5vcmc+Cj4gLS0tCj4gCj4gIGRyaXZlcnMvZ3B1L2RybS9w
YW5mcm9zdC9UT0RPICAgICAgICAgICB8ICAyIC0KPiAgZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0
L3BhbmZyb3N0X2Rydi5jIHwgMjIgKysrKystLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3Qv
cGFuZnJvc3RfZ2VtLmMgfCAgMyArLQo+ICBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3RfZ2VtLmggfCAgOCArKysKPiAgZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X21t
dS5jIHwgNzYgKysrKysrKysrKysrKysrKysrKysrKystLQo+ICBpbmNsdWRlL3VhcGkvZHJtL3Bh
bmZyb3N0X2RybS5oICAgICAgICAgfCAgMiArCj4gIDYgZmlsZXMgY2hhbmdlZCwgMTAwIGluc2Vy
dGlvbnMoKyksIDEzIGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vcGFuZnJvc3QvVE9ETyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9UT0RPCj4gaW5kZXgg
YzJlNDRhZGQzN2Q4Li42NDEyOWJmNzM5MzMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJt
L3BhbmZyb3N0L1RPRE8KPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvVE9ETwo+IEBA
IC0xNCw4ICsxNCw2IEBACj4gICAgVGhlIGhhcmQgcGFydCBpcyBoYW5kbGluZyB3aGVuIG1vcmUg
YWRkcmVzcyBzcGFjZXMgYXJlIG5lZWRlZCB0aGFuIHdoYXQKPiAgICB0aGUgaC93IHByb3ZpZGVz
Lgo+ICAKPiAtLSBTdXBwb3J0IHBpbm5pbmcgcGFnZXMgb24gZGVtYW5kIChHUFUgcGFnZSBmYXVs
dHMpLgo+IC0KPiAgLSBTdXBwb3J0IHVzZXJzcGFjZSBjb250cm9sbGVkIEdQVSB2aXJ0dWFsIGFk
ZHJlc3Nlcy4gTmVlZGVkIGZvciBWdWxrYW4uIChUb21ldSkKPiAgCj4gIC0gU3VwcG9ydCBmb3Ig
bWFkdmlzZSBhbmQgYSBzaHJpbmtlci4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Bh
bmZyb3N0L3BhbmZyb3N0X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X2Rydi5jCj4gaW5kZXggZDExZTIyODFkZGU2Li5mMDhkNDFkNTE4NmEgMTAwNjQ0Cj4gLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4gKysrIGIvZHJpdmVycy9n
cHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCj4gQEAgLTQ0LDkgKzQ0LDExIEBAIHN0YXRp
YyBpbnQgcGFuZnJvc3RfaW9jdGxfY3JlYXRlX2JvKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCj4gIHsKPiAgCWludCByZXQ7Cj4gIAlzdHJ1Y3QgZHJtX2dlbV9zaG1lbV9vYmpl
Y3QgKnNobWVtOwo+ICsJc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJvOwo+ICAJc3RydWN0
IGRybV9wYW5mcm9zdF9jcmVhdGVfYm8gKmFyZ3MgPSBkYXRhOwo+ICAKPiAtCWlmICghYXJncy0+
c2l6ZSB8fCBhcmdzLT5mbGFncyB8fCBhcmdzLT5wYWQpCj4gKwlpZiAoIWFyZ3MtPnNpemUgfHwg
YXJncy0+cGFkIHx8Cj4gKwkgICAgKGFyZ3MtPmZsYWdzICYgflBBTkZST1NUX0JPX05PTUFQKSkK
PiAgCQlyZXR1cm4gLUVJTlZBTDsKPiAgCj4gIAlzaG1lbSA9IGRybV9nZW1fc2htZW1fY3JlYXRl
X3dpdGhfaGFuZGxlKGZpbGUsIGRldiwgYXJncy0+c2l6ZSwKPiBAQCAtNTQsMTEgKzU2LDE2IEBA
IHN0YXRpYyBpbnQgcGFuZnJvc3RfaW9jdGxfY3JlYXRlX2JvKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCj4gIAlpZiAoSVNfRVJSKHNobWVtKSkKPiAgCQlyZXR1cm4gUFRSX0VS
UihzaG1lbSk7Cj4gIAo+IC0JcmV0ID0gcGFuZnJvc3RfbW11X21hcCh0b19wYW5mcm9zdF9ibygm
c2htZW0tPmJhc2UpKTsKPiAtCWlmIChyZXQpCj4gLQkJZ290byBlcnJfZnJlZTsKPiArCWJvID0g
dG9fcGFuZnJvc3RfYm8oJnNobWVtLT5iYXNlKTsKPiAgCj4gLQlhcmdzLT5vZmZzZXQgPSB0b19w
YW5mcm9zdF9ibygmc2htZW0tPmJhc2UpLT5ub2RlLnN0YXJ0IDw8IFBBR0VfU0hJRlQ7Cj4gKwlp
ZiAoIShhcmdzLT5mbGFncyAmIFBBTkZST1NUX0JPX05PTUFQKSkgewo+ICsJCXJldCA9IHBhbmZy
b3N0X21tdV9tYXAoYm8pOwo+ICsJCWlmIChyZXQpCj4gKwkJCWdvdG8gZXJyX2ZyZWU7Cj4gKwl9
IGVsc2UKPiArCQliby0+bm9fbWFwID0gMTsKPiArCj4gKwlhcmdzLT5vZmZzZXQgPSBiby0+bm9k
ZS5zdGFydCA8PCBQQUdFX1NISUZUOwo+ICAKPiAgCXJldHVybiAwOwo+ICAKPiBAQCAtMjY5LDYg
KzI3NiwxMSBAQCBzdGF0aWMgaW50IHBhbmZyb3N0X2lvY3RsX21tYXBfYm8oc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKPiAgCQlyZXR1cm4gLUVOT0VOVDsKPiAgCX0KPiAgCj4g
KwlpZiAodG9fcGFuZnJvc3RfYm8oZ2VtX29iaiktPm5vX21hcCkgewo+ICsJCURSTV9ERUJVRygi
Q2FuJ3QgbW1hcCAnbm9fbWFwJyBHRU0gQk8gJWRcbiIsIGFyZ3MtPmhhbmRsZSk7Cj4gKwkJcmV0
dXJuIC1FSU5WQUw7Cj4gKwl9Cj4gKwo+ICAJcmV0ID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZz
ZXQoZ2VtX29iaik7Cj4gIAlpZiAocmV0ID09IDApCj4gIAkJYXJncy0+b2Zmc2V0ID0gZHJtX3Zt
YV9ub2RlX29mZnNldF9hZGRyKCZnZW1fb2JqLT52bWFfbm9kZSk7Cj4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9w
YW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+IGluZGV4IDg4Njg3NWFlMzFkMy4uZWQwYjRmNzk2MTBh
IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+
ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwo+IEBAIC0xOSw3
ICsxOSw4IEBAIHN0YXRpYyB2b2lkIHBhbmZyb3N0X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKm9iaikKPiAgCXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibyA9IHRv
X3BhbmZyb3N0X2JvKG9iaik7Cj4gIAlzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiA9IG9i
ai0+ZGV2LT5kZXZfcHJpdmF0ZTsKPiAgCj4gLQlwYW5mcm9zdF9tbXVfdW5tYXAoYm8pOwo+ICsJ
aWYgKCFiby0+bm9fbWFwKQo+ICsJCXBhbmZyb3N0X21tdV91bm1hcChibyk7Cj4gIAo+ICAJc3Bp
bl9sb2NrKCZwZmRldi0+bW1fbG9jayk7Cj4gIAlkcm1fbW1fcmVtb3ZlX25vZGUoJmJvLT5ub2Rl
KTsKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5o
IGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbS5oCj4gaW5kZXggMDQ1MDAw
ZWI1ZmNmLi5hYTIxMGQ3Y2JmM2YgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZy
b3N0L3BhbmZyb3N0X2dlbS5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZy
b3N0X2dlbS5oCj4gQEAgLTExLDYgKzExLDcgQEAgc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3Qg
ewo+ICAJc3RydWN0IGRybV9nZW1fc2htZW1fb2JqZWN0IGJhc2U7Cj4gIAo+ICAJc3RydWN0IGRy
bV9tbV9ub2RlIG5vZGU7Cj4gKwl1bnNpZ25lZCBub19tYXA6IDE7Cj4gIH07Cj4gIAo+ICBzdGF0
aWMgaW5saW5lCj4gQEAgLTE5LDYgKzIwLDEzIEBAIHN0cnVjdCAgcGFuZnJvc3RfZ2VtX29iamVj
dCAqdG9fcGFuZnJvc3RfYm8oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCj4gIAlyZXR1cm4g
Y29udGFpbmVyX29mKHRvX2RybV9nZW1fc2htZW1fb2JqKG9iaiksIHN0cnVjdCBwYW5mcm9zdF9n
ZW1fb2JqZWN0LCBiYXNlKTsKPiAgfQo+ICAKPiArc3RhdGljIGlubGluZQo+ICtzdHJ1Y3QgIHBh
bmZyb3N0X2dlbV9vYmplY3QgKmRybV9tbV9ub2RlX3RvX3BhbmZyb3N0X2JvKHN0cnVjdCBkcm1f
bW1fbm9kZSAqbm9kZSkKPiArewo+ICsJcmV0dXJuIGNvbnRhaW5lcl9vZihub2RlLCBzdHJ1Y3Qg
cGFuZnJvc3RfZ2VtX29iamVjdCwgbm9kZSk7Cj4gK30KPiArCj4gKwo+ICBzdHJ1Y3QgZHJtX2dl
bV9vYmplY3QgKnBhbmZyb3N0X2dlbV9jcmVhdGVfb2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHNpemVfdCBzaXplKTsKPiAgCj4gIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqCj4gZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYyBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwo+IGluZGV4IDQxZDE4NGZhYjA3Zi4uNWEz
NjQ5NWEzOGYzIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9z
dF9tbXUuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwo+
IEBAIC0zLDYgKzMsNyBAQAo+ICAvKiBDb3B5cmlnaHQgKEMpIDIwMTkgQXJtIEx0ZC4gKi8KPiAg
I2luY2x1ZGUgPGxpbnV4L2JpdGZpZWxkLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9kZWxheS5oPgo+
ICsjaW5jbHVkZSA8bGludXgvZG1hLW1hcHBpbmcuaD4KPiAgI2luY2x1ZGUgPGxpbnV4L2ludGVy
cnVwdC5oPgo+ICAjaW5jbHVkZSA8bGludXgvaW8uaD4KPiAgI2luY2x1ZGUgPGxpbnV4L2lvcG9s
bC5oPgo+IEBAIC0xMCw2ICsxMSw3IEBACj4gICNpbmNsdWRlIDxsaW51eC9pb21tdS5oPgo+ICAj
aW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+Cj4gICNpbmNsdWRlIDxsaW51eC9wbV9y
dW50aW1lLmg+Cj4gKyNpbmNsdWRlIDxsaW51eC9zaG1lbV9mcy5oPgo+ICAjaW5jbHVkZSA8bGlu
dXgvc2l6ZXMuaD4KPiAgCj4gICNpbmNsdWRlICJwYW5mcm9zdF9kZXZpY2UuaCIKPiBAQCAtMjc3
LDYgKzI3OSw2MCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGlvbW11X2dhdGhlcl9vcHMgbW11X3Rs
Yl9vcHMgPSB7Cj4gIAkudGxiX3N5bmMJPSBtbXVfdGxiX3N5bmNfY29udGV4dCwKPiAgfTsKPiAg
Cj4gK3N0YXRpYyBzdHJ1Y3QgZHJtX21tX25vZGUgKmFkZHJfdG9fZHJtX21tX25vZGUoc3RydWN0
IHBhbmZyb3N0X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiArCXN0cnVj
dCBkcm1fbW1fbm9kZSAqbm9kZTsKPiArCXU2NCBvZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7
Cj4gKwo+ICsJZHJtX21tX2Zvcl9lYWNoX25vZGUobm9kZSwgJnBmZGV2LT5tbSkgewo+ICsJCWlm
IChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYgb2Zmc2V0IDwgKG5vZGUtPnN0YXJ0ICsgbm9kZS0+
c2l6ZSkpCj4gKwkJCXJldHVybiBub2RlOwo+ICsJfQo+ICsJcmV0dXJuIE5VTEw7Cj4gK30KPiAr
Cj4gK2ludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZyb3N0X2Rldmlj
ZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCj4gK3sKPiArCXN0cnVjdCBwYWdlICpwYWdlOwo+
ICsJZG1hX2FkZHJfdCBkbWFfYWRkcjsKPiArCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZTsKPiAr
CXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibzsKPiArCXN0cnVjdCBpb19wZ3RhYmxlX29w
cyAqb3BzID0gcGZkZXYtPm1tdS0+cGd0Ymxfb3BzOwo+ICsJcGdvZmZfdCBwYWdlX29mZnNldCA9
IGFkZHIgPj4gUEFHRV9TSElGVDsKPiArCj4gKwlhZGRyICY9IFBBR0VfTUFTSzsKPiArCj4gKwlu
b2RlID0gYWRkcl90b19kcm1fbW1fbm9kZShwZmRldiwgYXMsIGFkZHIpOwo+ICsJaWYgKCFub2Rl
KQo+ICsJCXJldHVybiAtRU5PRU5UOwo+ICsKPiArCXBhZ2Vfb2Zmc2V0IC09IG5vZGUtPnN0YXJ0
Owo+ICsJYm8gPSBkcm1fbW1fbm9kZV90b19wYW5mcm9zdF9ibyhub2RlKTsKPiArCWlmIChXQVJO
X09OKCFiby0+bm9fbWFwKSkKPiArCQlyZXR1cm4gLUVJTlZBTDsKPiArCj4gKwlkZXZfaW5mbyhw
ZmRldi0+ZGV2LCAibWFwcGluZyBwYWdlIGZhdWx0IEAgJWxseCIsIGFkZHIpOwo+ICsKPiArCXBh
Z2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFnZShiby0+YmFzZS5iYXNlLmZpbHAtPmZfbWFwcGlu
ZywKPiArCQkJCSAgICAgICBwYWdlX29mZnNldCk7Cj4gKwlpZiAoSVNfRVJSKHBhZ2UpKQo+ICsJ
CXJldHVybiBQVFJfRVJSKHBhZ2UpOwo+ICsKPiArCWRtYV9hZGRyID0gZG1hX21hcF9wYWdlKHBm
ZGV2LT5kZXYsIHBhZ2UsIDAsIFBBR0VfU0laRSwgRE1BX0JJRElSRUNUSU9OQUwpOwo+ICsKPiAr
CW11dGV4X2xvY2soJnBmZGV2LT5tbXUtPmxvY2spOwo+ICsKPiArCW9wcy0+bWFwKG9wcywgYWRk
ciwgZG1hX2FkZHIsIFBBR0VfU0laRSwgSU9NTVVfV1JJVEUgfCBJT01NVV9SRUFEKTsKPiArCj4g
KwltbXVfd3JpdGUocGZkZXYsIE1NVV9JTlRfQ0xFQVIsIEJJVChhcykpOwo+ICsKPiArCW1tdV9o
d19kb19vcGVyYXRpb24ocGZkZXYsIGFzLCBhZGRyLCBQQUdFX1NJWkUsIEFTX0NPTU1BTkRfRkxV
U0hfUFQpOwo+ICsKPiArCW11dGV4X3VubG9jaygmcGZkZXYtPm1tdS0+bG9jayk7Cj4gKwo+ICsJ
cmV0dXJuIDA7Cj4gK30KPiArCj4gIHN0YXRpYyBjb25zdCBjaGFyICphY2Nlc3NfdHlwZV9uYW1l
KHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LAo+ICAJCXUzMiBmYXVsdF9zdGF0dXMpCj4g
IHsKPiBAQCAtMzAyLDEzICszNTgsMTEgQEAgc3RhdGljIGlycXJldHVybl90IHBhbmZyb3N0X21t
dV9pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICpkYXRhKQo+ICB7Cj4gIAlzdHJ1Y3QgcGFuZnJv
c3RfZGV2aWNlICpwZmRldiA9IGRhdGE7Cj4gIAl1MzIgc3RhdHVzID0gbW11X3JlYWQocGZkZXYs
IE1NVV9JTlRfU1RBVCk7Cj4gLQlpbnQgaTsKPiArCWludCBpLCByZXQ7Cj4gIAo+ICAJaWYgKCFz
dGF0dXMpCj4gIAkJcmV0dXJuIElSUV9OT05FOwo+ICAKPiAtCWRldl9lcnIocGZkZXYtPmRldiwg
Im1tdSBpcnEgc3RhdHVzPSV4XG4iLCBzdGF0dXMpOwo+IC0KPiAgCWZvciAoaSA9IDA7IHN0YXR1
czsgaSsrKSB7Cj4gIAkJdTMyIG1hc2sgPSBCSVQoaSkgfCBCSVQoaSArIDE2KTsKPiAgCQl1NjQg
YWRkcjsKPiBAQCAtMzI5LDYgKzM4MywxNyBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgcGFuZnJvc3Rf
bW11X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmRhdGEpCj4gIAkJYWNjZXNzX3R5cGUgPSAo
ZmF1bHRfc3RhdHVzID4+IDgpICYgMHgzOwo+ICAJCXNvdXJjZV9pZCA9IChmYXVsdF9zdGF0dXMg
Pj4gMTYpOwo+ICAKPiArCQkvKiBQYWdlIGZhdWx0IG9ubHkgKi8KPiArCQlpZiAoKHN0YXR1cyAm
IG1hc2spID09IEJJVChpKSkgewo+ICsJCQlXQVJOX09OKGV4Y2VwdGlvbl90eXBlIDwgMHhDMSB8
fCBleGNlcHRpb25fdHlwZSA+IDB4QzQpOwo+ICsKPiArCQkJcmV0ID0gcGFuZnJvc3RfbW11X21h
cF9mYXVsdF9hZGRyKHBmZGV2LCBpLCBhZGRyKTsKPiArCQkJaWYgKCFyZXQpIHsKPiArCQkJCXN0
YXR1cyAmPSB+bWFzazsKPiArCQkJCWNvbnRpbnVlOwo+ICsJCQl9Cj4gKwkJfQo+ICsKPiAgCQkv
KiB0ZXJtaW5hbCBmYXVsdCwgcHJpbnQgaW5mbyBhYm91dCB0aGUgZmF1bHQgKi8KPiAgCQlkZXZf
ZXJyKHBmZGV2LT5kZXYsCj4gIAkJCSJVbmhhbmRsZWQgUGFnZSBmYXVsdCBpbiBBUyVkIGF0IFZB
IDB4JTAxNmxsWFxuIgo+IEBAIC0zNzAsOCArNDM1LDkgQEAgaW50IHBhbmZyb3N0X21tdV9pbml0
KHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2KQo+ICAJaWYgKGlycSA8PSAwKQo+ICAJCXJl
dHVybiAtRU5PREVWOwo+ICAKPiAtCWVyciA9IGRldm1fcmVxdWVzdF9pcnEocGZkZXYtPmRldiwg
aXJxLCBwYW5mcm9zdF9tbXVfaXJxX2hhbmRsZXIsCj4gLQkJCSAgICAgICBJUlFGX1NIQVJFRCwg
Im1tdSIsIHBmZGV2KTsKPiArCWVyciA9IGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEocGZkZXYt
PmRldiwgaXJxLCBOVUxMLAo+ICsJCQkJCXBhbmZyb3N0X21tdV9pcnFfaGFuZGxlciwKPiArCQkJ
CQlJUlFGX09ORVNIT1QsICJtbXUiLCBwZmRldik7CgpJcyBpdCBpbnRlbnRpb25hbCB0byBkcm9w
IHRoZSBTSEFSRUQgZmxhZz8gSSBoYXZlIHRvIGFkbWl0IEkgY2FuJ3QgdGhpbmsKb2YgYSAocmVh
bCkgcGxhdGZvcm0gd2hpY2ggZG9lcyBzaGFyZSB0aGUgSVJRLCBidXQga2Jhc2UgaGFzIGFsd2F5
cwpzdXBwb3J0ZWQgc2hhcmluZyB0aGUgR1BVIGludGVycnVwdHMuCgpTdGV2ZQoKPiAgCj4gIAlp
ZiAoZXJyKSB7Cj4gIAkJZGV2X2VycihwZmRldi0+ZGV2LCAiZmFpbGVkIHRvIHJlcXVlc3QgbW11
IGlycSIpOwo+IGRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oIGIv
aW5jbHVkZS91YXBpL2RybS9wYW5mcm9zdF9kcm0uaAo+IGluZGV4IGE1MmUwMjgzYjkwZC4uNmQ4
M2JhYTBlNGMxIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vcGFuZnJvc3RfZHJtLmgK
PiArKysgYi9pbmNsdWRlL3VhcGkvZHJtL3BhbmZyb3N0X2RybS5oCj4gQEAgLTcxLDYgKzcxLDgg
QEAgc3RydWN0IGRybV9wYW5mcm9zdF93YWl0X2JvIHsKPiAgCV9fczY0IHRpbWVvdXRfbnM7CS8q
IGFic29sdXRlICovCj4gIH07Cj4gIAo+ICsjZGVmaW5lIFBBTkZST1NUX0JPX05PTUFQCTEKPiAr
Cj4gIC8qKgo+ICAgKiBzdHJ1Y3QgZHJtX3BhbmZyb3N0X2NyZWF0ZV9ibyAtIGlvY3RsIGFyZ3Vt
ZW50IGZvciBjcmVhdGluZyBQYW5mcm9zdCBCT3MuCj4gICAqCj4gCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRy
aS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
