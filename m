Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 99E7F57DE8
	for <lists+dri-devel@lfdr.de>; Thu, 27 Jun 2019 10:09:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BCA976E828;
	Thu, 27 Jun 2019 08:09:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A06DD6E828
 for <dri-devel@lists.freedesktop.org>; Thu, 27 Jun 2019 08:09:23 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 250F4AC8C;
 Thu, 27 Jun 2019 08:09:22 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: kraxel@redhat.com, airlied@redhat.com, daniel@ffwll.ch,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, sam@ravnborg.org, dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/mgag200: Replace struct mga_framebuffer with GEM
 framebuffer helpers
Date: Thu, 27 Jun 2019 10:09:09 +0200
Message-Id: <20190627080909.30471-1-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIG1nYWcyMDAgZHJpdmVyJ3Mgc3RydWN0IG1nYV9mcmFtZWJ1ZmZlciBpcyBhIGJ1ZmZlciBv
YmplY3Qgd2l0aCBHRU0KaW50ZXJmYWNlLiBUaGVyZSBhcmUgYWxyZWFkeSBHRU0gZnJhbWVidWZm
ZXIgaGVscGVycyB0aGF0IGltcGxlbWVudCB0aGUKc2FtZSBmdW5jdGlvbmFsaXR5LiBDb252ZXJ0
IG1nYWcyMDAgdG8gdGhlc2UuCgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHpp
bW1lcm1hbm5Ac3VzZS5kZT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Ry
di5oICB8IDEzIC0tLS0tLQogZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9mYi5jICAg
fCA0MSArKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9t
YWluLmMgfCA2MSArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL21n
YWcyMDAvbWdhZzIwMF9tb2RlLmMgfCAyMiArKysrLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDI2
IGluc2VydGlvbnMoKyksIDExMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdh
ZzIwMF9kcnYuaAppbmRleCBjNDc2NzFjZTZjNDguLjM2ODYyODI0YjU2NyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oCkBAIC0xMDAsMTYgKzEwMCw5IEBACiAjZGVmaW5lIHRv
X21nYV9jcnRjKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgbWdhX2NydGMsIGJhc2UpCiAjZGVm
aW5lIHRvX21nYV9lbmNvZGVyKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgbWdhX2VuY29kZXIs
IGJhc2UpCiAjZGVmaW5lIHRvX21nYV9jb25uZWN0b3IoeCkgY29udGFpbmVyX29mKHgsIHN0cnVj
dCBtZ2FfY29ubmVjdG9yLCBiYXNlKQotI2RlZmluZSB0b19tZ2FfZnJhbWVidWZmZXIoeCkgY29u
dGFpbmVyX29mKHgsIHN0cnVjdCBtZ2FfZnJhbWVidWZmZXIsIGJhc2UpCi0KLXN0cnVjdCBtZ2Ff
ZnJhbWVidWZmZXIgewotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgYmFzZTsKLQlzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKm9iajsKLX07CiAKIHN0cnVjdCBtZ2FfZmJkZXYgewogCXN0cnVjdCBkcm1f
ZmJfaGVscGVyIGhlbHBlcjsgLyogbXVzdCBiZSBmaXJzdCAqLwotCXN0cnVjdCBtZ2FfZnJhbWVi
dWZmZXIgbWZiOwogCXZvaWQgKnN5c3JhbTsKIAlpbnQgc2l6ZTsKIAlpbnQgeDEsIHkxLCB4Miwg
eTI7IC8qIGRpcnR5IHJlY3QgKi8KQEAgLTIxNSwxMiArMjA4LDYgQEAgaW50IG1nYWcyMDBfZmJk
ZXZfaW5pdChzdHJ1Y3QgbWdhX2RldmljZSAqbWRldik7CiB2b2lkIG1nYWcyMDBfZmJkZXZfZmlu
aShzdHJ1Y3QgbWdhX2RldmljZSAqbWRldik7CiAKIAkJCQkvKiBtZ2FnMjAwX21haW4uYyAqLwot
aW50IG1nYWcyMDBfZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkJ
ICAgICBzdHJ1Y3QgbWdhX2ZyYW1lYnVmZmVyICptZmIsCi0JCQkgICAgIGNvbnN0IHN0cnVjdCBk
cm1fbW9kZV9mYl9jbWQyICptb2RlX2NtZCwKLQkJCSAgICAgc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpvYmopOwotCi0KIGludCBtZ2FnMjAwX2RyaXZlcl9sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpOwogdm9pZCBtZ2FnMjAwX2RyaXZlcl91bmxvYWQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldik7CiBpbnQgbWdhZzIwMF9nZW1fY3JlYXRlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAw
X2ZiLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2ZiLmMKaW5kZXggOGFkYjMz
MjI4NzMyLi5lMDJkNTQ3OWVhNDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAw
L21nYWcyMDBfZmIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2ZiLmMK
QEAgLTExLDYgKzExLDcgQEAKICNpbmNsdWRlIDxkcm0vZHJtUC5oPgogI2luY2x1ZGUgPGRybS9k
cm1fdXRpbC5oPgogI2luY2x1ZGUgPGRybS9kcm1fZmJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRjX2hl
bHBlci5oPgogCiAjaW5jbHVkZSAibWdhZzIwMF9kcnYuaCIKQEAgLTE5LDE5ICsyMCwxOCBAQCBz
dGF0aWMgdm9pZCBtZ2FfZGlydHlfdXBkYXRlKHN0cnVjdCBtZ2FfZmJkZXYgKm1mYmRldiwKIAkJ
CSAgICAgaW50IHgsIGludCB5LCBpbnQgd2lkdGgsIGludCBoZWlnaHQpCiB7CiAJaW50IGk7Ci0J
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3Qg
KmdibzsKIAlpbnQgc3JjX29mZnNldCwgZHN0X29mZnNldDsKLQlpbnQgYnBwID0gbWZiZGV2LT5t
ZmIuYmFzZS5mb3JtYXQtPmNwcFswXTsKIAlpbnQgcmV0OwogCXU4ICpkc3Q7CiAJYm9vbCB1bm1h
cCA9IGZhbHNlOwogCWJvb2wgc3RvcmVfZm9yX2xhdGVyID0gZmFsc2U7CiAJaW50IHgyLCB5MjsK
IAl1bnNpZ25lZCBsb25nIGZsYWdzOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbWZi
ZGV2LT5oZWxwZXIuZmI7CisJaW50IGJwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsKIAotCW9iaiA9
IG1mYmRldi0+bWZiLm9iajsKLQlnYm8gPSBkcm1fZ2VtX3ZyYW1fb2ZfZ2VtKG9iaik7CisJZ2Jv
ID0gZHJtX2dlbV92cmFtX29mX2dlbShmYi0+b2JqWzBdKTsKIAogCWlmIChkcm1fY2FuX3NsZWVw
KCkpIHsKIAkJLyogV2UgcGluIHRoZSBCTyBzbyBpdCB3b24ndCBiZSBtb3ZlZCBkdXJpbmcgdGhl
CkBAIC04OSw4ICs4OSw3IEBAIHN0YXRpYyB2b2lkIG1nYV9kaXJ0eV91cGRhdGUoc3RydWN0IG1n
YV9mYmRldiAqbWZiZGV2LAogCiAJZm9yIChpID0geTsgaSA8PSB5MjsgaSsrKSB7CiAJCS8qIGFz
c3VtZSBlcXVhbCBzdHJpZGUgZm9yIG5vdyAqLwotCQlzcmNfb2Zmc2V0ID0gZHN0X29mZnNldCA9
Ci0JCQlpICogbWZiZGV2LT5tZmIuYmFzZS5waXRjaGVzWzBdICsgKHggKiBicHApOworCQlzcmNf
b2Zmc2V0ID0gZHN0X29mZnNldCA9IGkgKiBmYi0+cGl0Y2hlc1swXSArICh4ICogYnBwKTsKIAkJ
bWVtY3B5X3RvaW8oZHN0ICsgZHN0X29mZnNldCwgbWZiZGV2LT5zeXNyYW0gKyBzcmNfb2Zmc2V0
LAogCQkJICAgICh4MiAtIHggKyAxKSAqIGJwcCk7CiAJfQpAQCAtMTkyLDI0ICsxOTEsMjQgQEAg
c3RhdGljIGludCBtZ2FnMjAwZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIs
CiAJc3lzcmFtID0gdm1hbGxvYyhzaXplKTsKIAlpZiAoIXN5c3JhbSkgewogCQlyZXQgPSAtRU5P
TUVNOwotCQlnb3RvIGVycl9zeXNyYW07CisJCWdvdG8gZXJyX2RybV9nZW1fb2JqZWN0X3B1dF91
bmxvY2tlZDsKIAl9CiAKIAlpbmZvID0gZHJtX2ZiX2hlbHBlcl9hbGxvY19mYmkoaGVscGVyKTsK
IAlpZiAoSVNfRVJSKGluZm8pKSB7CiAJCXJldCA9IFBUUl9FUlIoaW5mbyk7Ci0JCWdvdG8gZXJy
X2FsbG9jX2ZiaTsKKwkJZ290byBlcnJfdmZyZWU7CiAJfQogCi0JcmV0ID0gbWdhZzIwMF9mcmFt
ZWJ1ZmZlcl9pbml0KGRldiwgJm1mYmRldi0+bWZiLCAmbW9kZV9jbWQsIGdvYmopOwotCWlmIChy
ZXQpCi0JCWdvdG8gZXJyX2FsbG9jX2ZiaTsKKwlmYiA9IGRybV9nZW1fZmJkZXZfZmJfY3JlYXRl
KGRldiwgc2l6ZXMsIDAsIGdvYmosIE5VTEwpOworCWlmIChJU19FUlIoZmIpKSB7CisJCXJldCA9
IFBUUl9FUlIoZmIpOworCQlnb3RvIGVycl92ZnJlZTsKKwl9CiAKIAltZmJkZXYtPnN5c3JhbSA9
IHN5c3JhbTsKIAltZmJkZXYtPnNpemUgPSBzaXplOwogCi0JZmIgPSAmbWZiZGV2LT5tZmIuYmFz
ZTsKLQogCS8qIHNldHVwIGhlbHBlciAqLwogCW1mYmRldi0+aGVscGVyLmZiID0gZmI7CiAKQEAg
LTIzMCwyOSArMjI5LDIxIEBAIHN0YXRpYyBpbnQgbWdhZzIwMGZiX2NyZWF0ZShzdHJ1Y3QgZHJt
X2ZiX2hlbHBlciAqaGVscGVyLAogCiAJcmV0dXJuIDA7CiAKLWVycl9hbGxvY19mYmk6CitlcnJf
dmZyZWU6CiAJdmZyZWUoc3lzcmFtKTsKLWVycl9zeXNyYW06CitlcnJfZHJtX2dlbV9vYmplY3Rf
cHV0X3VubG9ja2VkOgogCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChnb2JqKTsKLQogCXJl
dHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgbWdhX2ZiZGV2X2Rlc3Ryb3koc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAkJCQlzdHJ1Y3QgbWdhX2ZiZGV2ICptZmJkZXYpCiB7Ci0Jc3RydWN0IG1n
YV9mcmFtZWJ1ZmZlciAqbWZiID0gJm1mYmRldi0+bWZiOwotCiAJZHJtX2ZiX2hlbHBlcl91bnJl
Z2lzdGVyX2ZiaSgmbWZiZGV2LT5oZWxwZXIpOwotCi0JaWYgKG1mYi0+b2JqKSB7Ci0JCWRybV9n
ZW1fb2JqZWN0X3B1dF91bmxvY2tlZChtZmItPm9iaik7Ci0JCW1mYi0+b2JqID0gTlVMTDsKLQl9
CiAJZHJtX2ZiX2hlbHBlcl9maW5pKCZtZmJkZXYtPmhlbHBlcik7CisJZHJtX2ZyYW1lYnVmZmVy
X3B1dChtZmJkZXYtPmhlbHBlci5mYik7CisKIAl2ZnJlZShtZmJkZXYtPnN5c3JhbSk7Ci0JZHJt
X2ZyYW1lYnVmZmVyX3VucmVnaXN0ZXJfcHJpdmF0ZSgmbWZiLT5iYXNlKTsKLQlkcm1fZnJhbWVi
dWZmZXJfY2xlYW51cCgmbWZiLT5iYXNlKTsKIAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0v
bWdhZzIwMC9tZ2FnMjAwX21haW4uYwppbmRleCBkZDYxY2NjNWFmNWMuLjQ5MzZmYjhiNjhlZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tYWluLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tYWluLmMKQEAgLTksNjggKzksMTEgQEAK
ICAqLwogI2luY2x1ZGUgPGRybS9kcm1QLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRjX2hlbHBl
ci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVmZmVyX2hlbHBlci5oPgogI2luY2x1
ZGUgIm1nYWcyMDBfZHJ2LmgiCiAKLXN0YXRpYyB2b2lkIG1nYV91c2VyX2ZyYW1lYnVmZmVyX2Rl
c3Ryb3koc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCi17Ci0Jc3RydWN0IG1nYV9mcmFtZWJ1
ZmZlciAqbWdhX2ZiID0gdG9fbWdhX2ZyYW1lYnVmZmVyKGZiKTsKLQotCWRybV9nZW1fb2JqZWN0
X3B1dF91bmxvY2tlZChtZ2FfZmItPm9iaik7Ci0JZHJtX2ZyYW1lYnVmZmVyX2NsZWFudXAoZmIp
OwotCWtmcmVlKGZiKTsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXJf
ZnVuY3MgbWdhX2ZiX2Z1bmNzID0gewotCS5kZXN0cm95ID0gbWdhX3VzZXJfZnJhbWVidWZmZXJf
ZGVzdHJveSwKLX07Ci0KLWludCBtZ2FnMjAwX2ZyYW1lYnVmZmVyX2luaXQoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKLQkJCSAgICAgc3RydWN0IG1nYV9mcmFtZWJ1ZmZlciAqZ2ZiLAotCQkJICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqbW9kZV9jbWQsCi0JCQkgICAgIHN0cnVj
dCBkcm1fZ2VtX29iamVjdCAqb2JqKQotewotCWludCByZXQ7Ci0KLQlkcm1faGVscGVyX21vZGVf
ZmlsbF9mYl9zdHJ1Y3QoZGV2LCAmZ2ZiLT5iYXNlLCBtb2RlX2NtZCk7Ci0JZ2ZiLT5vYmogPSBv
Ymo7Ci0JcmV0ID0gZHJtX2ZyYW1lYnVmZmVyX2luaXQoZGV2LCAmZ2ZiLT5iYXNlLCAmbWdhX2Zi
X2Z1bmNzKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiZHJtX2ZyYW1lYnVmZmVyX2luaXQg
ZmFpbGVkOiAlZFxuIiwgcmV0KTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0JcmV0dXJuIDA7Ci19Ci0K
LXN0YXRpYyBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICoKLW1nYWcyMDBfdXNlcl9mcmFtZWJ1ZmZl
cl9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bHAsCi0JCQkJY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21kKQotewotCXN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBtZ2FfZnJhbWVidWZmZXIgKm1nYV9m
YjsKLQlpbnQgcmV0OwotCi0Jb2JqID0gZHJtX2dlbV9vYmplY3RfbG9va3VwKGZpbHAsIG1vZGVf
Y21kLT5oYW5kbGVzWzBdKTsKLQlpZiAob2JqID09IE5VTEwpCi0JCXJldHVybiBFUlJfUFRSKC1F
Tk9FTlQpOwotCi0JbWdhX2ZiID0ga3phbGxvYyhzaXplb2YoKm1nYV9mYiksIEdGUF9LRVJORUwp
OwotCWlmICghbWdhX2ZiKSB7Ci0JCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChvYmopOwot
CQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKLQl9Ci0KLQlyZXQgPSBtZ2FnMjAwX2ZyYW1lYnVm
ZmVyX2luaXQoZGV2LCBtZ2FfZmIsIG1vZGVfY21kLCBvYmopOwotCWlmIChyZXQpIHsKLQkJZHJt
X2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKG9iaik7Ci0JCWtmcmVlKG1nYV9mYik7Ci0JCXJldHVy
biBFUlJfUFRSKHJldCk7Ci0JfQotCXJldHVybiAmbWdhX2ZiLT5iYXNlOwotfQotCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBtZ2FfbW9kZV9mdW5jcyA9IHsKLQku
ZmJfY3JlYXRlID0gbWdhZzIwMF91c2VyX2ZyYW1lYnVmZmVyX2NyZWF0ZSwKKwkuZmJfY3JlYXRl
ID0gZHJtX2dlbV9mYl9jcmVhdGUKIH07CiAKIHN0YXRpYyBpbnQgbWdhX3Byb2JlX3ZyYW0oc3Ry
dWN0IG1nYV9kZXZpY2UgKm1kZXYsIHZvaWQgX19pb21lbSAqbWVtKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tb2RlLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWdh
ZzIwMC9tZ2FnMjAwX21vZGUuYwppbmRleCBhMjUwNTQwMTVlOGMuLjVlMzgyYmY3ZmMxZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tb2RlLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL21nYWcyMDAvbWdhZzIwMF9tb2RlLmMKQEAgLTg2MCwyNyArODYwLDIxIEBA
IHN0YXRpYyBpbnQgbWdhX2NydGNfZG9fc2V0X2Jhc2Uoc3RydWN0IGRybV9jcnRjICpjcnRjLAog
CQkJCWludCB4LCBpbnQgeSwgaW50IGF0b21pYykKIHsKIAlzdHJ1Y3QgbWdhX2RldmljZSAqbWRl
diA9IGNydGMtPmRldi0+ZGV2X3ByaXZhdGU7Ci0Jc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmo7
Ci0Jc3RydWN0IG1nYV9mcmFtZWJ1ZmZlciAqbWdhX2ZiOwogCXN0cnVjdCBkcm1fZ2VtX3ZyYW1f
b2JqZWN0ICpnYm87CiAJaW50IHJldDsKIAlzNjQgZ3B1X2FkZHI7CiAJdm9pZCAqYmFzZTsKIAog
CWlmICghYXRvbWljICYmIGZiKSB7Ci0JCW1nYV9mYiA9IHRvX21nYV9mcmFtZWJ1ZmZlcihmYik7
Ci0JCW9iaiA9IG1nYV9mYi0+b2JqOwotCQlnYm8gPSBkcm1fZ2VtX3ZyYW1fb2ZfZ2VtKG9iaik7
CisJCWdibyA9IGRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9ialswXSk7CiAKIAkJLyogdW5tYXAg
aWYgY29uc29sZSAqLwotCQlpZiAoJm1kZXYtPm1mYmRldi0+bWZiID09IG1nYV9mYikKKwkJaWYg
KG1kZXYtPm1mYmRldi0+aGVscGVyLmZiID09IGZiKQogCQkJZHJtX2dlbV92cmFtX2t1bm1hcChn
Ym8pOwogCQlkcm1fZ2VtX3ZyYW1fdW5waW4oZ2JvKTsKIAl9CiAKLQltZ2FfZmIgPSB0b19tZ2Ff
ZnJhbWVidWZmZXIoY3J0Yy0+cHJpbWFyeS0+ZmIpOwotCW9iaiA9IG1nYV9mYi0+b2JqOwotCWdi
byA9IGRybV9nZW1fdnJhbV9vZl9nZW0ob2JqKTsKKwlnYm8gPSBkcm1fZ2VtX3ZyYW1fb2ZfZ2Vt
KGNydGMtPnByaW1hcnktPmZiLT5vYmpbMF0pOwogCiAJcmV0ID0gZHJtX2dlbV92cmFtX3Bpbihn
Ym8sIERSTV9HRU1fVlJBTV9QTF9GTEFHX1ZSQU0pOwogCWlmIChyZXQpCkBAIC04OTEsNyArODg1
LDcgQEAgc3RhdGljIGludCBtZ2FfY3J0Y19kb19zZXRfYmFzZShzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCiAJCWdvdG8gZXJyX2RybV9nZW1fdnJhbV91bnBpbjsKIAl9CiAKLQlpZiAoJm1kZXYtPm1m
YmRldi0+bWZiID09IG1nYV9mYikgeworCWlmIChtZGV2LT5tZmJkZXYtPmhlbHBlci5mYiA9PSBj
cnRjLT5wcmltYXJ5LT5mYikgewogCQkvKiBpZiBwdXNoaW5nIGNvbnNvbGUgaW4ga21hcCBpdCAq
LwogCQliYXNlID0gZHJtX2dlbV92cmFtX2ttYXAoZ2JvLCB0cnVlLCBOVUxMKTsKIAkJaWYgKElT
X0VSUihiYXNlKSkgewpAQCAtMTQyNCwxMiArMTQxOCwxMiBAQCBzdGF0aWMgdm9pZCBtZ2FfY3J0
Y19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIAltZ2FfY3J0Y19kcG1zKGNydGMsIERS
TV9NT0RFX0RQTVNfT0ZGKTsKIAlpZiAoY3J0Yy0+cHJpbWFyeS0+ZmIpIHsKIAkJc3RydWN0IG1n
YV9kZXZpY2UgKm1kZXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwotCQlzdHJ1Y3QgbWdhX2Zy
YW1lYnVmZmVyICptZ2FfZmIgPSB0b19tZ2FfZnJhbWVidWZmZXIoY3J0Yy0+cHJpbWFyeS0+ZmIp
OwotCQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiA9IG1nYV9mYi0+b2JqOwotCQlzdHJ1Y3Qg
ZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvID0gZHJtX2dlbV92cmFtX29mX2dlbShvYmopOworCQlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IGNydGMtPnByaW1hcnktPmZiOworCQlzdHJ1Y3Qg
ZHJtX2dlbV92cmFtX29iamVjdCAqZ2JvID0KKwkJCWRybV9nZW1fdnJhbV9vZl9nZW0oZmItPm9i
alswXSk7CiAKIAkJLyogdW5tYXAgaWYgY29uc29sZSAqLwotCQlpZiAoJm1kZXYtPm1mYmRldi0+
bWZiID09IG1nYV9mYikKKwkJaWYgKG1kZXYtPm1mYmRldi0+aGVscGVyLmZiID09IGZiKQogCQkJ
ZHJtX2dlbV92cmFtX2t1bm1hcChnYm8pOwogCQlkcm1fZ2VtX3ZyYW1fdW5waW4oZ2JvKTsKIAl9
Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
