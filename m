Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C02912DDBBE
	for <lists+dri-devel@lfdr.de>; Fri, 18 Dec 2020 00:06:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9C79E89A4E;
	Thu, 17 Dec 2020 23:06:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x432.google.com (mail-pf1-x432.google.com
 [IPv6:2607:f8b0:4864:20::432])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DC23189A4E
 for <dri-devel@lists.freedesktop.org>; Thu, 17 Dec 2020 23:06:19 +0000 (UTC)
Received: by mail-pf1-x432.google.com with SMTP id t8so340842pfg.8
 for <dri-devel@lists.freedesktop.org>; Thu, 17 Dec 2020 15:06:19 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=uAZMFvhVb6Eal/4evY++sNk0jscaxGLqs718IzEgtfA=;
 b=v83XWYa2YNnPD7aec5PNdxseR1Y/sUisiPYfR8FyqDAFb2zErOKxJgtsQUmOqyjedz
 NGiZ+FhC+mwAcIfB2l2m9WN7be9bU+vNtCNDiKnjvMFk5vZQaGF1mkSLePMo+oepC9Cn
 IFk7GlCNU5CfZ5ux4nzNStixNyFV5EDh/qEvSv+y6+1Sqw/THn1pc4kTu79MZA0pQsLz
 Dla5S7ftQ5RrH0hpPgrfoLldX9wzx/Vq92GVt8J+TvwFWKboHOOyiP9R7RsZZ6kS+vOn
 3NB+xMDwPW7mVzTt6i8ll05ptaILp7GY1I5t0aAtjZKJnKUQ/KUpSQdpA7MEZmpe9B21
 vxug==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=uAZMFvhVb6Eal/4evY++sNk0jscaxGLqs718IzEgtfA=;
 b=eG4GE3v5sa00PPq5f+KVntbsU7fMYqTe6WGfIhbAY6Dgqs/WNE4cMzxfZcYtKoonth
 HFdfSP4Frkk1cb7bix9Gq2oPDoszS1UD0ULCOYmCPNTooQnobZ6Kl0zM+UILfjWLOW2i
 rUTzXadDmPXQC+klob9OKcmKqNNpwEjKMvII+Eq1nlNbxSCUYmeF2nz6OBzIpgsG7Hu/
 Qv3uab/n3Rvh06ZkR+/MDMMSoO1yq3RKqQ7PB8eZ6qrkx+taTj1SReodPI084LLqL2dn
 Ps58vnwql8EDjBLhu8VGsVK/+Y4CFojgcP7MDEs8IPtHB0tAkdTD0SzTSsVM5XU6EkX7
 7u1g==
X-Gm-Message-State: AOAM530NZ2YoT+Flywwss3EYb1xsPJGfEAU2a6IUir7nRarE/6iTQMZE
 2s3ZgVTQvqd0BwwFwrob28Z7Ng==
X-Google-Smtp-Source: ABdhPJwymKjQzvxQu0BjSpaG0P1NH7tVHLKT/pmV+W4uevA6LHyp/eohg7UcoVWSSb/68o0OizIdXQ==
X-Received: by 2002:a63:1b58:: with SMTP id b24mr1505551pgm.38.1608246379486; 
 Thu, 17 Dec 2020 15:06:19 -0800 (PST)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 q9sm7074036pgb.82.2020.12.17.15.06.17
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 17 Dec 2020 15:06:18 -0800 (PST)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RFC][PATCH 2/3] dma-buf: system_heap: Add pagepool support to system
 heap
Date: Thu, 17 Dec 2020 23:06:11 +0000
Message-Id: <20201217230612.32397-2-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201217230612.32397-1-john.stultz@linaro.org>
References: <20201217230612.32397-1-john.stultz@linaro.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Sandeep Patil <sspatil@google.com>, dri-devel@lists.freedesktop.org,
 Ezequiel Garcia <ezequiel@collabora.com>, Robin Murphy <robin.murphy@arm.com>,
 James Jones <jajones@nvidia.com>, Liam Mark <lmark@codeaurora.org>,
 Laura Abbott <labbott@kernel.org>, Chris Goldsworthy <cgoldswo@codeaurora.org>,
 Hridya Valsaraju <hridya@google.com>,
 =?UTF-8?q?=C3=98rjan=20Eide?= <orjan.eide@arm.com>,
 linux-media@vger.kernel.org, Suren Baghdasaryan <surenb@google.com>,
 Daniel Mentz <danielmentz@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

UmV1c2UvYWJ1c2UgdGhlIHBhZ2Vwb29sIGNvZGUgZnJvbSB0aGUgbmV0d29yayBjb2RlIHRvIHNw
ZWVkCnVwIGFsbG9jYXRpb24gcGVyZm9ybWFuY2UuCgpUaGlzIGlzIHNpbWlsYXIgdG8gdGhlIElP
TiBwYWdlcG9vbCB1c2FnZSwgYnV0IHRyaWVzIHRvCnV0aWxpemUgZ2VuZXJpYyBjb2RlIGluc3Rl
YWQgb2YgYSBjdXN0b20gaW1wbGVtZW50YXRpb24uCgpDYzogU3VtaXQgU2Vtd2FsIDxzdW1pdC5z
ZW13YWxAbGluYXJvLm9yZz4KQ2M6IExpYW0gTWFyayA8bG1hcmtAY29kZWF1cm9yYS5vcmc+CkNj
OiBDaHJpcyBHb2xkc3dvcnRoeSA8Y2dvbGRzd29AY29kZWF1cm9yYS5vcmc+CkNjOiBMYXVyYSBB
YmJvdHQgPGxhYmJvdHRAa2VybmVsLm9yZz4KQ2M6IEJyaWFuIFN0YXJrZXkgPEJyaWFuLlN0YXJr
ZXlAYXJtLmNvbT4KQ2M6IEhyaWR5YSBWYWxzYXJhanUgPGhyaWR5YUBnb29nbGUuY29tPgpDYzog
U3VyZW4gQmFnaGRhc2FyeWFuIDxzdXJlbmJAZ29vZ2xlLmNvbT4KQ2M6IFNhbmRlZXAgUGF0aWwg
PHNzcGF0aWxAZ29vZ2xlLmNvbT4KQ2M6IERhbmllbCBNZW50eiA8ZGFuaWVsbWVudHpAZ29vZ2xl
LmNvbT4KQ2M6IMOYcmphbiBFaWRlIDxvcmphbi5laWRlQGFybS5jb20+CkNjOiBSb2JpbiBNdXJw
aHkgPHJvYmluLm11cnBoeUBhcm0uY29tPgpDYzogRXplcXVpZWwgR2FyY2lhIDxlemVxdWllbEBj
b2xsYWJvcmEuY29tPgpDYzogU2ltb24gU2VyIDxjb250YWN0QGVtZXJzaW9uLmZyPgpDYzogSmFt
ZXMgSm9uZXMgPGpham9uZXNAbnZpZGlhLmNvbT4KQ2M6IGxpbnV4LW1lZGlhQHZnZXIua2VybmVs
Lm9yZwpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpTaWduZWQtb2ZmLWJ5OiBK
b2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9yZz4KLS0tCiBkcml2ZXJzL2RtYS1idWYv
aGVhcHMvS2NvbmZpZyAgICAgICB8ICAxICsKIGRyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1f
aGVhcC5jIHwgNjggKysrKysrKysrKysrKysrKysrKysrKysrKysrLS0KIDIgZmlsZXMgY2hhbmdl
ZCwgNjUgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2RtYS1idWYvaGVhcHMvS2NvbmZpZyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9LY29uZmlnCmlu
ZGV4IGVjZjY1MjA0ZjcxNC4uZmE1ZTFjMzMwY2NlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2RtYS1i
dWYvaGVhcHMvS2NvbmZpZworKysgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwpAQCAt
NCw2ICs0LDcgQEAgY29uZmlnIERNQUJVRl9IRUFQU19ERUZFUlJFRF9GUkVFCiBjb25maWcgRE1B
QlVGX0hFQVBTX1NZU1RFTQogCWJvb2wgIkRNQS1CVUYgU3lzdGVtIEhlYXAiCiAJZGVwZW5kcyBv
biBETUFCVUZfSEVBUFMKKwlzZWxlY3QgUEFHRV9QT09MCiAJaGVscAogCSAgQ2hvb3NlIHRoaXMg
b3B0aW9uIHRvIGVuYWJsZSB0aGUgc3lzdGVtIGRtYWJ1ZiBoZWFwLiBUaGUgc3lzdGVtIGhlYXAK
IAkgIGlzIGJhY2tlZCBieSBwYWdlcyBmcm9tIHRoZSBidWRkeSBhbGxvY2F0b3IuIElmIGluIGRv
dWJ0LCBzYXkgWS4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVh
cC5jIGIvZHJpdmVycy9kbWEtYnVmL2hlYXBzL3N5c3RlbV9oZWFwLmMKaW5kZXggMTdlMGU5YTY4
YmFmLi44ODVlMzA4OTRiNzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0
ZW1faGVhcC5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9zeXN0ZW1faGVhcC5jCkBAIC0y
MCw2ICsyMCw3IEBACiAjaW5jbHVkZSA8bGludXgvc2NhdHRlcmxpc3QuaD4KICNpbmNsdWRlIDxs
aW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8bGludXgvdm1hbGxvYy5oPgorI2luY2x1ZGUgPG5ldC9w
YWdlX3Bvb2wuaD4KIAogc3RhdGljIHN0cnVjdCBkbWFfaGVhcCAqc3lzX2hlYXA7CiAKQEAgLTUz
LDYgKzU0LDcgQEAgc3RhdGljIGdmcF90IG9yZGVyX2ZsYWdzW10gPSB7SElHSF9PUkRFUl9HRlAs
IExPV19PUkRFUl9HRlAsIExPV19PUkRFUl9HRlB9OwogICovCiBzdGF0aWMgY29uc3QgdW5zaWdu
ZWQgaW50IG9yZGVyc1tdID0gezgsIDQsIDB9OwogI2RlZmluZSBOVU1fT1JERVJTIEFSUkFZX1NJ
WkUob3JkZXJzKQorc3RydWN0IHBhZ2VfcG9vbCAqcG9vbHNbTlVNX09SREVSU107CiAKIHN0YXRp
YyBzdHJ1Y3Qgc2dfdGFibGUgKmR1cF9zZ190YWJsZShzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlKQog
ewpAQCAtMjgxLDE4ICsyODMsNTkgQEAgc3RhdGljIHZvaWQgc3lzdGVtX2hlYXBfdnVubWFwKHN0
cnVjdCBkbWFfYnVmICpkbWFidWYsIHN0cnVjdCBkbWFfYnVmX21hcCAqbWFwKQogCWRtYV9idWZf
bWFwX2NsZWFyKG1hcCk7CiB9CiAKK3N0YXRpYyBpbnQgc3lzdGVtX2hlYXBfY2xlYXJfcGFnZXMo
c3RydWN0IHBhZ2UgKipwYWdlcywgaW50IG51bSwgcGdwcm90X3QgcGdwcm90KQoreworCXZvaWQg
KmFkZHIgPSB2bWFwKHBhZ2VzLCBudW0sIFZNX01BUCwgcGdwcm90KTsKKworCWlmICghYWRkcikK
KwkJcmV0dXJuIC1FTk9NRU07CisJbWVtc2V0KGFkZHIsIDAsIFBBR0VfU0laRSAqIG51bSk7CisJ
dnVubWFwKGFkZHIpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHN5c3RlbV9oZWFwX3pl
cm9fYnVmZmVyKHN0cnVjdCBzeXN0ZW1faGVhcF9idWZmZXIgKmJ1ZmZlcikKK3sKKwlzdHJ1Y3Qg
c2dfdGFibGUgKnNndCA9ICZidWZmZXItPnNnX3RhYmxlOworCXN0cnVjdCBzZ19wYWdlX2l0ZXIg
cGl0ZXI7CisJc3RydWN0IHBhZ2UgKnBhZ2VzWzMyXTsKKwlpbnQgcCA9IDA7CisJaW50IHJldCA9
IDA7CisKKwlmb3JfZWFjaF9zZ3RhYmxlX3BhZ2Uoc2d0LCAmcGl0ZXIsIDApIHsKKwkJcGFnZXNb
cCsrXSA9IHNnX3BhZ2VfaXRlcl9wYWdlKCZwaXRlcik7CisJCWlmIChwID09IEFSUkFZX1NJWkUo
cGFnZXMpKSB7CisJCQlyZXQgPSBzeXN0ZW1faGVhcF9jbGVhcl9wYWdlcyhwYWdlcywgcCwgUEFH
RV9LRVJORUwpOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCQkJcCA9IDA7CisJCX0K
Kwl9CisJaWYgKHApCisJCXJldCA9IHN5c3RlbV9oZWFwX2NsZWFyX3BhZ2VzKHBhZ2VzLCBwLCBQ
QUdFX0tFUk5FTCk7CisKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdm9pZCBzeXN0ZW1faGVh
cF9kbWFfYnVmX3JlbGVhc2Uoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKIHsKIAlzdHJ1Y3Qgc3lz
dGVtX2hlYXBfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CiAJc3RydWN0IHNnX3RhYmxl
ICp0YWJsZTsKIAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCWludCBpOworCWludCBpLCBqOwor
CisJLyogWmVybyB0aGUgYnVmZmVyIHBhZ2VzIGJlZm9yZSBhZGRpbmcgYmFjayB0byB0aGUgcG9v
bCAqLworCXN5c3RlbV9oZWFwX3plcm9fYnVmZmVyKGJ1ZmZlcik7CiAKIAl0YWJsZSA9ICZidWZm
ZXItPnNnX3RhYmxlOwogCWZvcl9lYWNoX3NnKHRhYmxlLT5zZ2wsIHNnLCB0YWJsZS0+bmVudHMs
IGkpIHsKIAkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBzZ19wYWdlKHNnKTsKIAotCQlfX2ZyZWVfcGFn
ZXMocGFnZSwgY29tcG91bmRfb3JkZXIocGFnZSkpOworCQlmb3IgKGogPSAwOyBqIDwgTlVNX09S
REVSUzsgaisrKSB7CisJCQlpZiAoY29tcG91bmRfb3JkZXIocGFnZSkgPT0gb3JkZXJzW2pdKQor
CQkJCWJyZWFrOworCQl9CisJCXBhZ2VfcG9vbF9wdXRfZnVsbF9wYWdlKHBvb2xzW2pdLCBwYWdl
LCBmYWxzZSk7CiAJfQogCXNnX2ZyZWVfdGFibGUodGFibGUpOwogCWtmcmVlKGJ1ZmZlcik7CkBA
IC0zMjIsOCArMzY1LDcgQEAgc3RhdGljIHN0cnVjdCBwYWdlICphbGxvY19sYXJnZXN0X2F2YWls
YWJsZSh1bnNpZ25lZCBsb25nIHNpemUsCiAJCQljb250aW51ZTsKIAkJaWYgKG1heF9vcmRlciA8
IG9yZGVyc1tpXSkKIAkJCWNvbnRpbnVlOwotCi0JCXBhZ2UgPSBhbGxvY19wYWdlcyhvcmRlcl9m
bGFnc1tpXSwgb3JkZXJzW2ldKTsKKwkJcGFnZSA9IHBhZ2VfcG9vbF9hbGxvY19wYWdlcyhwb29s
c1tpXSwgb3JkZXJfZmxhZ3NbaV0pOwogCQlpZiAoIXBhZ2UpCiAJCQljb250aW51ZTsKIAkJcmV0
dXJuIHBhZ2U7CkBAIC00MjgsNiArNDcwLDI0IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2hl
YXBfb3BzIHN5c3RlbV9oZWFwX29wcyA9IHsKIHN0YXRpYyBpbnQgc3lzdGVtX2hlYXBfY3JlYXRl
KHZvaWQpCiB7CiAJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCWludCBp
OworCisJZm9yIChpID0gMDsgaSA8IE5VTV9PUkRFUlM7IGkrKykgeworCQlzdHJ1Y3QgcGFnZV9w
b29sX3BhcmFtcyBwcDsKKworCQltZW1zZXQoJnBwLCAwLCBzaXplb2YocHApKTsKKwkJcHAub3Jk
ZXIgPSBvcmRlcnNbaV07CisJCXBvb2xzW2ldID0gcGFnZV9wb29sX2NyZWF0ZSgmcHApOworCisJ
CWlmIChJU19FUlIocG9vbHNbaV0pKSB7CisJCQlpbnQgajsKKworCQkJcHJfZXJyKCIlczogcGFn
ZSBwb29sIGNyZWF0aW9uIGZhaWxlZCFcbiIsIF9fZnVuY19fKTsKKwkJCWZvciAoaiA9IDA7IGog
PCBpOyBqKyspCisJCQkJcGFnZV9wb29sX2Rlc3Ryb3kocG9vbHNbal0pOworCQkJcmV0dXJuIFBU
Ul9FUlIocG9vbHNbaV0pOworCQl9CisJfQogCiAJZXhwX2luZm8ubmFtZSA9ICJzeXN0ZW0iOwog
CWV4cF9pbmZvLm9wcyA9ICZzeXN0ZW1faGVhcF9vcHM7Ci0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
