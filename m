Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CEC3F5F2DA
	for <lists+dri-devel@lfdr.de>; Thu,  4 Jul 2019 08:31:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6854E6E264;
	Thu,  4 Jul 2019 06:31:04 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from EUR03-VE1-obe.outbound.protection.outlook.com
 (mail-ve1eur03on0613.outbound.protection.outlook.com
 [IPv6:2a01:111:f400:fe09::613])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 999BF6E264
 for <dri-devel@lists.freedesktop.org>; Thu,  4 Jul 2019 06:31:02 +0000 (UTC)
Received: from VE1PR08MB5006.eurprd08.prod.outlook.com (10.255.159.31) by
 VE1PR08MB5229.eurprd08.prod.outlook.com (10.255.27.17) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2032.20; Thu, 4 Jul 2019 06:30:59 +0000
Received: from VE1PR08MB5006.eurprd08.prod.outlook.com
 ([fe80::4062:a380:35ba:11d1]) by VE1PR08MB5006.eurprd08.prod.outlook.com
 ([fe80::4062:a380:35ba:11d1%3]) with mapi id 15.20.2032.019; Thu, 4 Jul 2019
 06:30:59 +0000
From: "james qian wang (Arm Technology China)" <james.qian.wang@arm.com>
To: Liviu Dudau <Liviu.Dudau@arm.com>, "airlied@linux.ie" <airlied@linux.ie>, 
 Brian Starkey <Brian.Starkey@arm.com>, "maarten.lankhorst@linux.intel.com"
 <maarten.lankhorst@linux.intel.com>, "sean@poorly.run" <sean@poorly.run>
Subject: [PATCH 2/6] drm/komeda: Add side by side plane_state split
Thread-Topic: [PATCH 2/6] drm/komeda: Add side by side plane_state split
Thread-Index: AQHVMjILVxnNgDqtCU+ikD0xeBTFCg==
Date: Thu, 4 Jul 2019 06:30:59 +0000
Message-ID: <20190704063011.7431-3-james.qian.wang@arm.com>
References: <20190704063011.7431-1-james.qian.wang@arm.com>
In-Reply-To: <20190704063011.7431-1-james.qian.wang@arm.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [113.29.88.7]
x-clientproxiedby: HK0PR03CA0022.apcprd03.prod.outlook.com
 (2603:1096:203:2e::34) To VE1PR08MB5006.eurprd08.prod.outlook.com
 (2603:10a6:803:113::31)
x-ms-exchange-messagesentrepresentingtype: 1
x-mailer: git-send-email 2.20.1
x-ms-publictraffictype: Email
x-ms-office365-filtering-correlation-id: 137dd5a0-e497-4ea8-1ac6-08d700492d74
x-ms-office365-filtering-ht: Tenant
x-microsoft-antispam: BCL:0; PCL:0;
 RULEID:(2390118)(7020095)(4652040)(8989299)(4534185)(7168020)(4627221)(201703031133081)(201702281549075)(8990200)(5600148)(711020)(4605104)(1401327)(4618075)(2017052603328)(7193020);
 SRVR:VE1PR08MB5229; 
x-ms-traffictypediagnostic: VE1PR08MB5229:
x-microsoft-antispam-prvs: <VE1PR08MB5229F5EB6D711953414E9969B3FA0@VE1PR08MB5229.eurprd08.prod.outlook.com>
nodisclaimer: True
x-ms-oob-tlc-oobclassifiers: OLM:4502;
x-forefront-prvs: 0088C92887
x-forefront-antispam-report: SFV:NSPM;
 SFS:(10009020)(4636009)(136003)(39860400002)(366004)(396003)(376002)(346002)(189003)(199004)(76176011)(6506007)(66066001)(110136005)(386003)(54906003)(103116003)(2906002)(316002)(186003)(86362001)(2201001)(52116002)(55236004)(99286004)(26005)(102836004)(6486002)(50226002)(25786009)(478600001)(71200400001)(71190400001)(6512007)(6436002)(4326008)(68736007)(53936002)(14454004)(2616005)(476003)(486006)(36756003)(30864003)(446003)(11346002)(81166006)(8676002)(256004)(81156014)(8936002)(305945005)(7736002)(66946007)(6116002)(73956011)(66476007)(66556008)(64756008)(66446008)(3846002)(2501003)(5660300002)(1076003);
 DIR:OUT; SFP:1101; SCL:1; SRVR:VE1PR08MB5229;
 H:VE1PR08MB5006.eurprd08.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; MX:1; A:1; 
received-spf: None (protection.outlook.com: arm.com does not designate
 permitted sender hosts)
x-ms-exchange-senderadcheck: 1
x-microsoft-antispam-message-info: 6VyUWhQwc3AuSaaMugNy7pdGBTxGxEs52amLcDxEhWzX+KBD6L4HkGFDxFFxKAz+waSe5dz7ZhfVC6xmmZyjVV7p3koRkPXF+hZtHM2OeFklKakRL66nO5xWizAgjDAJv4d9k6y/DfoVEcbwsFEpz5MVVVeURyBsGHmfs8Su3PSBSjBm4ZeN+YXYbnlTj9J19VU6Sv0M3yjn0MRdw0bxWrXL20DPG+UZo9kRr7QoJeAbzph1Z9hZUBKC5HksEf5f6FIlrssiaGJ9w1XtdJAwMsYbwYgc1ijAdn4pmtYFURrwTta3mGFCaV7EHURVxGdTIPSoeTL416nHUzsxaWK2s1wwA+5qBg+HKGVgggYipmtB4POzGU6YxE7/7MAKe9t33mszBtfVX/iHIMDp9kS1gpQ23b14+DfaKiFSdioQ6Jk=
MIME-Version: 1.0
X-OriginatorOrg: arm.com
X-MS-Exchange-CrossTenant-Network-Message-Id: 137dd5a0-e497-4ea8-1ac6-08d700492d74
X-MS-Exchange-CrossTenant-originalarrivaltime: 04 Jul 2019 06:30:59.6467 (UTC)
X-MS-Exchange-CrossTenant-fromentityheader: Hosted
X-MS-Exchange-CrossTenant-id: f34e5979-57d9-4aaa-ad4d-b122a662184d
X-MS-Exchange-CrossTenant-mailboxtype: HOSTED
X-MS-Exchange-CrossTenant-userprincipalname: james.qian.wang@arm.com
X-MS-Exchange-Transport-CrossTenantHeadersStamped: VE1PR08MB5229
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=armh.onmicrosoft.com; 
 s=selector2-armh-onmicrosoft-com;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=eVJmM650iZrJXShIkidsXZ6RIhGHrmzctzH2PLmRtrY=;
 b=E/xouiEKyNU9TBg/w0Z2jgEfu6BkkTA2zYse4J58QrnrAL7bV3yctzgv+pK/JIxYRuxTq66fJ5xBtSho4IaZtNYz5LZwRhaOkxh3MlJDAO1wGQUgkyEhRYja66xrQSEijyunSuf4oO+36lhDt5Hs/LRs/wNjLVKV9Y+UT4yY/YI=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=james.qian.wang@arm.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: nd <nd@arm.com>, Ayan Halder <Ayan.Halder@arm.com>, "Oscar
 Zhang \(Arm Technology China\)" <Oscar.Zhang@arm.com>, "Tiannan Zhu \(Arm
 Technology China\)" <Tiannan.Zhu@arm.com>,
 "Jonathan Chai \(Arm Technology China\)" <Jonathan.Chai@arm.com>,
 "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
 "dri-devel@lists.freedesktop.org" <dri-devel@lists.freedesktop.org>, "Julien
 Yin \(Arm Technology China\)" <Julien.Yin@arm.com>, "Channing Chen \(Arm
 Technology China\)" <Channing.Chen@arm.com>, "james qian wang \(Arm Technology
 China\)" <james.qian.wang@arm.com>,
 "Yiqi Kang \(Arm Technology China\)" <Yiqi.Kang@arm.com>,
 "thomas Sun \(Arm Technology China\)" <thomas.Sun@arm.com>,
 "Lowry Li \(Arm Technology China\)" <Lowry.Li@arm.com>,
 Ben Davis <Ben.Davis@arm.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gc2lkZSBieSBzaWRlIG1vZGUsIFRoZSBmdWxsIGRpc3BsYXkgZnJhbWUgd2lsbCBiZSBzcGxp
dCBpbnRvIHR3byBwYXJ0cwooTGVmdC9SaWdodCksIGFuZCBlYWNoIHBhcnQgd2lsbCBiZSBoYW5k
bGVkIGJ5IGEgc2luZ2xlIHBpcGVsaW5lIHNlcGFyYXRlbHkKbWFzdGVyIHBpcGVsaW5lIGZvciBs
ZWZ0IHBhcnQsIHNsYXZlIGZvciByaWdodC4KClRvIHNpbXBsaWZ5IHRoZSB1c2FnZSBhbmQgaW1w
bGVtZW50YXRpb24sIGtvbWVkYSB1c2UgdGhlIGZvbGxvd2luZyBzY2hlbWUKdG8gZG8gdGhlIHNp
ZGUgYnkgc2lkZSBzcGxpdAoxLiBUaGUgcGxhbmVzIGFsc28gaGF2ZSBiZWVuIGdyb3VwZWQgaW50
byB0d28gY2xhc3NlczoKICAgbWFzdGVyLXBsYW5lcyBhbmQgc2xhdmUtcGxhbmVzLgoyLiBUaGUg
bWFzdGVyIHBsYW5lIGNhbiBkaXNwbGF5IGl0cyBpbWFnZSBvbiBhbnkgbG9jYXRpb24gb2YgdGhl
IGZpbmFsL2Z1bGwKICAgZGlzcGxheSBmcmFtZSwga29tZWRhIHdpbGwgaGVscCB0byBzcGxpdCB0
aGUgcGxhbmUgY29uZmlndXJhdGlvbiB0byB0d28KICAgcGFydHMgYW5kIGZlZCB0aGVtIGludG8g
bWFzdGVyIGFuZCBzbGF2ZSBwaXBlbGluZXMuCjMuIFRoZSBzbGF2ZSBwbGFuZSBvbmx5IGNhbiBw
dXQgaXRzIGRpc3BsYXkgcmVjdCBvbiB0aGUgcmlnaHQgcGFydCBvZiB0aGUKICAgZmluYWwgZGlz
cGxheSBmcmFtZSwgYW5kIGl0cyBkYXRhIGlzIG9ubHkgY2FuIGJlIGZlZCBpbnRvIHRoZSBzbGF2
ZQogICBwaXBlbGluZS4KCkZyb20gdGhlIHBlcnNwZWN0aXZlIG9mIHJlc291cmNlIHVzYWdlIGFu
ZCBhc3NpZ25tZW50OgpUaGUgbWFzdGVyIHBsYW5lIGNhbiB1c2UgdGhlIHJlc291cmNlcyBmcm9t
IHRoZSBtYXN0ZXIgcGlwZWxpbmUgYW5kIHNsYXZlCnBpcGVsaW5lIGJvdGgsIGJ1dCBzbGF2ZSBw
bGFuZSBvbmx5IGNhbiB1c2UgdGhlIHNsYXZlIHBpcGVsaW5lIHJlc291cmNlcy4KCldpdGggc3Vj
aCBzY2hlbWUsIHRoZSB1c2FnZSBvZiBtYXN0ZXIgcGxhbmVzIGFyZSBzYW1lIGFzIHRoZSBub25l
CnNpZGVfYnlfc2lkZSBtb2RlLiB1c2VyIGNhbiBlYXNpbHkgc2tpcCB0aGUgc2xhdmUgcGxhbmVz
IGFuZCBubyBuZWVkIHRvCmNvbnNpZGVyIHNpZGVfYnlfc2lkZSBmb3IgdGhlbS4KClNpZ25lZC1v
ZmYtYnk6IEphbWVzIFFpYW4gV2FuZyAoQXJtIFRlY2hub2xvZ3kgQ2hpbmEpIDxqYW1lcy5xaWFu
LndhbmdAYXJtLmNvbT4KLS0tCiAuLi4vZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfcGlw
ZWxpbmUuaCAgfCAgMzMgKystCiAuLi4vZGlzcGxheS9rb21lZGEva29tZWRhX3BpcGVsaW5lX3N0
YXRlLmMgICAgfCAxODggKysrKysrKysrKysrKysrKysrCiAuLi4vZ3B1L2RybS9hcm0vZGlzcGxh
eS9rb21lZGEva29tZWRhX3BsYW5lLmMgfCAgIDcgKy0KIDMgZmlsZXMgY2hhbmdlZCwgMjIwIGlu
c2VydGlvbnMoKyksIDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfcGlwZWxpbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9h
cm0vZGlzcGxheS9rb21lZGEva29tZWRhX3BpcGVsaW5lLmgKaW5kZXggNmQzNzQ1YmI4YzFkLi5h
YTdjMGZlZmE0N2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21l
ZGEva29tZWRhX3BpcGVsaW5lLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tv
bWVkYS9rb21lZGFfcGlwZWxpbmUuaApAQCAtNTExLDYgKzUxMSwyMCBAQCBrb21lZGFfY29tcG9u
ZW50X3BpY2t1cF9vdXRwdXQoc3RydWN0IGtvbWVkYV9jb21wb25lbnQgKmMsIHUzMiBhdmFpbF9j
b21wcykKIAlyZXR1cm4ga29tZWRhX3BpcGVsaW5lX2dldF9maXJzdF9jb21wb25lbnQoYy0+cGlw
ZWxpbmUsIGF2YWlsX2lucHV0cyk7CiB9Cgorc3RhdGljIGlubGluZSBjb25zdCBjaGFyICoKK2tv
bWVkYV9kYXRhX2Zsb3dfbXNnKHN0cnVjdCBrb21lZGFfZGF0YV9mbG93X2NmZyAqY29uZmlnKQor
eworCXN0YXRpYyBjaGFyIHN0clsxMjhdOworCisJc25wcmludGYoc3RyLCBzaXplb2Yoc3RyKSwK
KwkJICJyb3Q6ICV4IHNyY1t4L3k6JWQvJWQsIHcvaDolZC8lZF0gZGlzcFt4L3k6JWQvJWQsIHcv
aDolZC8lZF0iLAorCQkgY29uZmlnLT5yb3QsCisJCSBjb25maWctPmluX3gsIGNvbmZpZy0+aW5f
eSwgY29uZmlnLT5pbl93LCBjb25maWctPmluX2gsCisJCSBjb25maWctPm91dF94LCBjb25maWct
Pm91dF95LCBjb25maWctPm91dF93LCBjb25maWctPm91dF9oKTsKKworCXJldHVybiBzdHI7Cit9
CisKIHN0cnVjdCBrb21lZGFfcGxhbmVfc3RhdGU7CiBzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGU7
CiBzdHJ1Y3Qga29tZWRhX2NydGM7CkBAIC01MjIsMjIgKzUzNiwyNyBAQCBpbnQga29tZWRhX2J1
aWxkX2xheWVyX2RhdGFfZmxvdyhzdHJ1Y3Qga29tZWRhX2xheWVyICpsYXllciwKIAkJCQkgc3Ry
dWN0IGtvbWVkYV9wbGFuZV9zdGF0ZSAqa3BsYW5lX3N0LAogCQkJCSBzdHJ1Y3Qga29tZWRhX2Ny
dGNfc3RhdGUgKmtjcnRjX3N0LAogCQkJCSBzdHJ1Y3Qga29tZWRhX2RhdGFfZmxvd19jZmcgKmRm
bG93KTsKLWludCBrb21lZGFfYnVpbGRfd2JfZGF0YV9mbG93KHN0cnVjdCBrb21lZGFfbGF5ZXIg
KndiX2xheWVyLAotCQkJICAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3Qs
Ci0JCQkgICAgICBzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGUgKmtjcnRjX3N0LAotCQkJICAgICAg
c3RydWN0IGtvbWVkYV9kYXRhX2Zsb3dfY2ZnICpkZmxvdyk7Ci1pbnQga29tZWRhX2J1aWxkX2Rp
c3BsYXlfZGF0YV9mbG93KHN0cnVjdCBrb21lZGFfY3J0YyAqa2NydGMsCi0JCQkJICAgc3RydWN0
IGtvbWVkYV9jcnRjX3N0YXRlICprY3J0Y19zdCk7Ci0KIGludCBrb21lZGFfYnVpbGRfbGF5ZXJf
c3BsaXRfZGF0YV9mbG93KHN0cnVjdCBrb21lZGFfbGF5ZXIgKmxlZnQsCiAJCQkJICAgICAgIHN0
cnVjdCBrb21lZGFfcGxhbmVfc3RhdGUgKmtwbGFuZV9zdCwKIAkJCQkgICAgICAgc3RydWN0IGtv
bWVkYV9jcnRjX3N0YXRlICprY3J0Y19zdCwKIAkJCQkgICAgICAgc3RydWN0IGtvbWVkYV9kYXRh
X2Zsb3dfY2ZnICpkZmxvdyk7CitpbnQga29tZWRhX2J1aWxkX2xheWVyX3Nic19kYXRhX2Zsb3co
c3RydWN0IGtvbWVkYV9sYXllciAqbGF5ZXIsCisJCQkJICAgICBzdHJ1Y3Qga29tZWRhX3BsYW5l
X3N0YXRlICprcGxhbmVfc3QsCisJCQkJICAgICBzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGUgKmtj
cnRjX3N0LAorCQkJCSAgICAgc3RydWN0IGtvbWVkYV9kYXRhX2Zsb3dfY2ZnICpkZmxvdyk7CisK
K2ludCBrb21lZGFfYnVpbGRfd2JfZGF0YV9mbG93KHN0cnVjdCBrb21lZGFfbGF5ZXIgKndiX2xh
eWVyLAorCQkJICAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3QsCisJCQkg
ICAgICBzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGUgKmtjcnRjX3N0LAorCQkJICAgICAgc3RydWN0
IGtvbWVkYV9kYXRhX2Zsb3dfY2ZnICpkZmxvdyk7CiBpbnQga29tZWRhX2J1aWxkX3diX3NwbGl0
X2RhdGFfZmxvdyhzdHJ1Y3Qga29tZWRhX2xheWVyICp3Yl9sYXllciwKIAkJCQkgICAgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3QsCiAJCQkJICAgIHN0cnVjdCBrb21lZGFfY3J0
Y19zdGF0ZSAqa2NydGNfc3QsCiAJCQkJICAgIHN0cnVjdCBrb21lZGFfZGF0YV9mbG93X2NmZyAq
ZGZsb3cpOwoKK2ludCBrb21lZGFfYnVpbGRfZGlzcGxheV9kYXRhX2Zsb3coc3RydWN0IGtvbWVk
YV9jcnRjICprY3J0YywKKwkJCQkgICBzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGUgKmtjcnRjX3N0
KTsKKwogaW50IGtvbWVkYV9yZWxlYXNlX3VuY2xhaW1lZF9yZXNvdXJjZXMoc3RydWN0IGtvbWVk
YV9waXBlbGluZSAqcGlwZSwKIAkJCQkgICAgICAgc3RydWN0IGtvbWVkYV9jcnRjX3N0YXRlICpr
Y3J0Y19zdCk7CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVk
YS9rb21lZGFfcGlwZWxpbmVfc3RhdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9r
b21lZGEva29tZWRhX3BpcGVsaW5lX3N0YXRlLmMKaW5kZXggOTEyMzI4NGM5OGExLi5jMDhkNTlh
ZTcwOTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21lZGEva29t
ZWRhX3BpcGVsaW5lX3N0YXRlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tv
bWVkYS9rb21lZGFfcGlwZWxpbmVfc3RhdGUuYwpAQCAtMTEwMiw2ICsxMTAyLDE5NCBAQCBpbnQg
a29tZWRhX2J1aWxkX2xheWVyX3NwbGl0X2RhdGFfZmxvdyhzdHJ1Y3Qga29tZWRhX2xheWVyICps
ZWZ0LAogCXJldHVybiBlcnI7CiB9CgorLyogc3BsaXQgZnVuYyB3aWxsIHNwbGl0IGNvbmZpZ3Vy
YXRpb24gb2YgbWFzdGVyIHBsYW5lIHRvIHR3byBsYXllciBkYXRhCisgKiBmbG93cywgd2hpY2gg
d2lsbCBiZSBmZWQgaW50byBtYXN0ZXIgYW5kIHNsYXZlIHBpcGVsaW5lIHRoZW4uCisgKiBOT1RF
OiBAbV9kZmxvdyBpcyBmaXJzdCB1c2VkIGFzIGlucHV0IGFyZ3VtZW50IHRvIHBhc3MgdGhlIGNv
bmZpZ3VyYXRpb24gb2YKKyAqCSBtYXN0ZXJfcGxhbmUuIHdoZW4gdGhlIHNwbGl0IGlzIGRvbmUs
IEAqbV9kZmxvdyBAKnNfZGZsb3cgYXJlIHRoZQorICoJIG91dHB1dCBkYXRhIGZsb3cgZm9yIHBp
cGVsaW5lLgorICovCitzdGF0aWMgaW50Citrb21lZGFfc3BsaXRfc2JzX21hc3Rlcl9kYXRhX2Zs
b3coc3RydWN0IGtvbWVkYV9jcnRjX3N0YXRlICprY3J0Y19zdCwKKwkJCQkgIHN0cnVjdCBrb21l
ZGFfZGF0YV9mbG93X2NmZyAqKm1fZGZsb3csCisJCQkJICBzdHJ1Y3Qga29tZWRhX2RhdGFfZmxv
d19jZmcgKipzX2RmbG93KQoreworCXN0cnVjdCBrb21lZGFfZGF0YV9mbG93X2NmZyAqbWFzdGVy
ID0gKm1fZGZsb3c7CisJc3RydWN0IGtvbWVkYV9kYXRhX2Zsb3dfY2ZnICpzbGF2ZSA9ICpzX2Rm
bG93OworCXUzMiBkaXNwX2VuZCA9IG1hc3Rlci0+b3V0X3ggKyBtYXN0ZXItPm91dF93OworCXUx
NiBib3VuZGFyeTsKKworCXBpcGVsaW5lX2NvbXBvc2l0aW9uX3NpemUoa2NydGNfc3QsICZib3Vu
ZGFyeSwgTlVMTCk7CisKKwlpZiAoZGlzcF9lbmQgPD0gYm91bmRhcnkpIHsKKwkJLyogdGhlIG1h
c3RlciB2aWV3cG9ydCBvbmx5IGxvY2F0ZWQgaW4gbWFzdGVyIHNpZGUsIG5vIG5lZWQKKwkJICog
c2xhdmUgYW55bW9yZQorCQkgKi8KKwkJKnNfZGZsb3cgPSBOVUxMOworCX0gZWxzZSBpZiAoKG1h
c3Rlci0+b3V0X3ggPCBib3VuZGFyeSkgJiYgKGRpc3BfZW5kID4gYm91bmRhcnkpKSB7CisJCS8q
IHRoZSBtYXN0ZXIgdmlld3BvcnQgYWNyb3NzIHR3byBwaXBlbGluZXMsIHNwbGl0IGl0ICovCisJ
CWJvb2wgZmxpcF9oID0gaGFzX2ZsaXBfaChtYXN0ZXItPnJvdCk7CisJCWJvb2wgcjkwICA9IGRy
bV9yb3RhdGlvbl85MF9vcl8yNzAobWFzdGVyLT5yb3QpOworCQl1MzIgc3JjX3ggPSBtYXN0ZXIt
PmluX3g7CisJCXUzMiBzcmNfeSA9IG1hc3Rlci0+aW5feTsKKwkJdTMyIHNyY193ID0gbWFzdGVy
LT5pbl93OworCQl1MzIgc3JjX2ggPSBtYXN0ZXItPmluX2g7CisKKwkJaWYgKG1hc3Rlci0+ZW5f
c2NhbGluZyB8fCBtYXN0ZXItPmVuX2ltZ19lbmhhbmNlbWVudCkgeworCQkJRFJNX0RFQlVHX0FU
T01JQygic2JzIGRvZXNuJ3Qgc3VwcG9ydCB0byBzcGxpdCBhIHNjYWxpbmcgaW1hZ2UuXG4iKTsK
KwkJCXJldHVybiAtRUlOVkFMOworCQl9CisKKwkJbWVtY3B5KHNsYXZlLCBtYXN0ZXIsIHNpemVv
ZigqbWFzdGVyKSk7CisKKwkJLyogbWFzdGVyIGZvciBsZWZ0IHBhcnQgb2YgZGlzcGxheSwgc2xh
dmUgZm9yIHRoZSByaWdodCBwYXJ0ICovCisJCS8qIHNwbGl0IHRoZSBkaXNwX3JlY3QgKi8KKwkJ
bWFzdGVyLT5vdXRfdyA9IGJvdW5kYXJ5IC0gbWFzdGVyLT5vdXRfeDsKKwkJc2xhdmUtPm91dF93
ICA9IGRpc3BfZW5kIC0gYm91bmRhcnk7CisJCXNsYXZlLT5vdXRfeCAgPSAwOworCisJCWlmIChy
OTApIHsKKwkJCW1hc3Rlci0+aW5faCA9IG1hc3Rlci0+b3V0X3c7CisJCQlzbGF2ZS0+aW5faCA9
IHNsYXZlLT5vdXRfdzsKKworCQkJaWYgKGZsaXBfaCkKKwkJCQltYXN0ZXItPmluX3kgPSBzcmNf
eSArIHNyY19oIC0gbWFzdGVyLT5pbl9oOworCQkJZWxzZQorCQkJCXNsYXZlLT5pbl95ID0gc3Jj
X3kgKyBzcmNfaCAtIHNsYXZlLT5pbl9oOworCQl9IGVsc2UgeworCQkJbWFzdGVyLT5pbl93ID0g
bWFzdGVyLT5vdXRfdzsKKwkJCXNsYXZlLT5pbl93ID0gc2xhdmUtPm91dF93OworCisJCQkvKiBv
biBmbGlwX2gsIHRoZSBsZWZ0IGRpc3BsYXkgY29udGVudCBmcm9tIHRoZSByaWdodC1zb3VyY2Ug
Ki8KKwkJCWlmIChmbGlwX2gpCisJCQkJbWFzdGVyLT5pbl94ID0gc3JjX3cgKyBzcmNfeCAtIG1h
c3Rlci0+aW5fdzsKKwkJCWVsc2UKKwkJCQlzbGF2ZS0+aW5feCA9IHNyY193ICsgc3JjX3ggLSBz
bGF2ZS0+aW5fdzsKKwkJfQorCX0gZWxzZSBpZiAobWFzdGVyLT5vdXRfeCA+PSBib3VuZGFyeSkg
eworCQkvKiBkaXNwX3JlY3Qgb25seSBsb2NhdGUgaW4gcmlnaHQgcGFydCwgbW92ZSB0aGUgZGZs
b3cgdG8gc2xhdmUgKi8KKwkJbWFzdGVyLT5vdXRfeCAtPSBib3VuZGFyeTsKKwkJKnNfZGZsb3cg
PSBtYXN0ZXI7CisJCSptX2RmbG93ID0gTlVMTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludAora29tZWRhX3NwbGl0X3Nic19zbGF2ZV9kYXRhX2Zsb3coc3RydWN0IGtvbWVkYV9j
cnRjX3N0YXRlICprY3J0Y19zdCwKKwkJCQkgc3RydWN0IGtvbWVkYV9kYXRhX2Zsb3dfY2ZnICpz
bGF2ZSkKK3sKKwl1MTYgYm91bmRhcnk7CisKKwlwaXBlbGluZV9jb21wb3NpdGlvbl9zaXplKGtj
cnRjX3N0LCAmYm91bmRhcnksIE5VTEwpOworCisJaWYgKHNsYXZlLT5vdXRfeCA8IGJvdW5kYXJ5
KSB7CisJCURSTV9ERUJVR19BVE9NSUMoIlNCUyBTbGF2ZSBwbGFuZSBpcyBvbmx5IGFsbG93ZWQg
dG8gY29uZmlndXJlIHRoZSByaWdodCBwYXJ0IGZyYW1lLlxuIik7CisJCXJldHVybiAtRUlOVkFM
OworCX0KKworCS8qIHNsYXZlLT5kaXNwX3JlY3QgbG9jYXRlIGluIHRoZSByaWdodCBwYXJ0ICov
CisJc2xhdmUtPm91dF94IC09IGJvdW5kYXJ5OworCisJcmV0dXJuIDA7Cit9CisKKy8qIE9uIHNp
ZGUgYnkgc2lkZSBtb2RlLCBUaGUgZnVsbCBkaXNwbGF5IGZyYW1lIHdpbGwgYmUgc3BsaXQgdG8g
dHdvIHBhcnRzCisgKiAoTGVmdC9SaWdodCksIGFuZCBlYWNoIHBhcnQgd2lsbCBiZSBoYW5kbGVk
IGJ5IGEgc2luZ2xlIHBpcGVsaW5lIHNlcGFyYXRlbHksCisgKiBtYXN0ZXIgcGlwZWxpbmUgZm9y
IGxlZnQgcGFydCwgc2xhdmUgZm9yIHJpZ2h0LgorICoKKyAqIFRvIHNpbXBsaWZ5IHRoZSB1c2Fn
ZSBhbmQgaW1wbGVtZW50YXRpb24sIGtvbWVkYSB1c2UgdGhlIGZvbGxvd2luZyBzY2hlbWUKKyAq
IHRvIGRvIHRoZSBzaWRlIGJ5IHNpZGUgc3BsaXQKKyAqIDEuIFRoZSBwbGFuZXMgYWxzbyBoYXZl
IGJlZW4gZ3JvdXBlZCBpbnRvIHR3byBjbGFzc2VzOgorICogICAgbWFzdGVyLXBsYW5lcyBhbmQg
c2xhdmUtcGxhbmVzLgorICogMi4gVGhlIG1hc3RlciBwbGFuZSBjYW4gZGlzcGxheSBpdHMgaW1h
Z2Ugb24gYW55IGxvY2F0aW9uIG9mIHRoZSBmaW5hbC9mdWxsCisgKiAgICBkaXNwbGF5IGZyYW1l
LCBrb21lZGEgd2lsbCBoZWxwIHRvIHNwbGl0IHRoZSBwbGFuZSBjb25maWd1cmF0aW9uIHRvIHR3
bworICogICAgcGFydHMgYW5kIGZlZCB0aGVtIGludG8gbWFzdGVyIGFuZCBzbGF2ZSBwaXBlbGlu
ZXMuCisgKiAzLiBUaGUgc2xhdmUgcGxhbmUgb25seSBjYW4gcHV0IGl0cyBkaXNwbGF5IHJlY3Qg
b24gdGhlIHJpZ2h0IHBhcnQgb2YgdGhlCisgKiAgICBmaW5hbCBkaXNwbGF5IGZyYW1lLCBhbmQg
aXRzIGRhdGEgaXMgb25seSBjYW4gYmUgZmVkIGludG8gdGhlIHNsYXZlCisgKiAgICBwaXBlbGlu
ZS4KKyAqCisgKiBGcm9tIHRoZSBwZXJzcGVjdGl2ZSBvZiByZXNvdXJjZSB1c2FnZSBhbmQgYXNz
aWdubWVudDoKKyAqIFRoZSBtYXN0ZXIgcGxhbmUgY2FuIHVzZSB0aGUgcmVzb3VyY2VzIGZyb20g
dGhlIG1hc3RlciBwaXBlbGluZSBhbmQgc2xhdmUKKyAqIHBpcGVsaW5lIGJvdGgsIGJ1dCBzbGF2
ZSBwbGFuZSBvbmx5IGNhbiB1c2UgdGhlIHNsYXZlIHBpcGVsaW5lIHJlc291cmNlcy4KKyAqCisg
KiBXaXRoIHN1Y2ggc2NoZW1lLCB0aGUgdXNhZ2Ugb2YgbWFzdGVyIHBsYW5lcyBhcmUgc2FtZSBh
cyB0aGUgbm9uZQorICogc2lkZV9ieV9zaWRlIG1vZGUuIHVzZXIgY2FuIGVhc2lseSBza2lwIHRo
ZSBzbGF2ZSBwbGFuZXMgYW5kIG5vIG5lZWQgdG8KKyAqIGNvbnNpZGVyIHNpZGVfYnlfc2lkZSBm
b3IgdGhlbS4KKyAqCisgKiBOT1RFOiBzaWRlX2J5X3NpZGUgc3BsaXQgaXMgb2NjdXJyZWQgb24g
cGlwZWxpbmUgbGV2ZWwgd2hpY2ggc3BsaXQgdGhlIHBsYW5lCisgKgkgZGF0YSBmbG93IGludG8g
cGlwZWxpbmVzLCBidXQgdGhlIGxheWVyIHNwbGl0IGlzIGEgcGlwZWxpbmUKKyAqCSBpbnRlcm5h
bCBzcGxpdCB3aGljaCBzcGxpdHMgdGhlIGRhdGEgZmxvdyBpbnRvIHBpcGVsaW5lIGxheWVycy4K
KyAqCSBTbyBrb21lZGEgc3RpbGwgc3VwcG9ydHMgdG8gYXBwbHkgYSBmdXJ0aGVyIGxheWVyIHNw
bGl0IHRvIHRoZSBzYnMKKyAqCSBzcGxpdCBkYXRhIGZsb3cuCisgKi8KK2ludCBrb21lZGFfYnVp
bGRfbGF5ZXJfc2JzX2RhdGFfZmxvdyhzdHJ1Y3Qga29tZWRhX2xheWVyICpsYXllciwKKwkJCQkg
ICAgIHN0cnVjdCBrb21lZGFfcGxhbmVfc3RhdGUgKmtwbGFuZV9zdCwKKwkJCQkgICAgIHN0cnVj
dCBrb21lZGFfY3J0Y19zdGF0ZSAqa2NydGNfc3QsCisJCQkJICAgICBzdHJ1Y3Qga29tZWRhX2Rh
dGFfZmxvd19jZmcgKmRmbG93KQoreworCXN0cnVjdCBrb21lZGFfY3J0YyAqa2NydGMgPSB0b19r
Y3J0YyhrY3J0Y19zdC0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSA9IGtw
bGFuZV9zdC0+YmFzZS5wbGFuZTsKKwlzdHJ1Y3Qga29tZWRhX2RhdGFfZmxvd19jZmcgdGVtcCwg
Km1hc3Rlcl9kZmxvdywgKnNsYXZlX2RmbG93OworCXN0cnVjdCBrb21lZGFfbGF5ZXIgKm1hc3Rl
ciwgKnNsYXZlOworCWJvb2wgbWFzdGVyX3BsYW5lID0gbGF5ZXItPmJhc2UucGlwZWxpbmUgPT0g
a2NydGMtPm1hc3RlcjsKKwlpbnQgZXJyOworCisJRFJNX0RFQlVHX0FUT01JQygiU0JTIHByZXBh
cmUgJXMtW1BMQU5FOiVkOiVzXTogJXMuXG4iLAorCQkJIG1hc3Rlcl9wbGFuZSA/ICJNYXN0ZXIi
IDogIlNsYXZlIiwKKwkJCSBwbGFuZS0+YmFzZS5pZCwgcGxhbmUtPm5hbWUsCisJCQkga29tZWRh
X2RhdGFfZmxvd19tc2coZGZsb3cpKTsKKworCWlmIChtYXN0ZXJfcGxhbmUpIHsKKwkJbWFzdGVy
ID0gbGF5ZXI7CisJCXNsYXZlID0gbGF5ZXItPnNic19zbGF2ZTsKKwkJbWFzdGVyX2RmbG93ID0g
ZGZsb3c7CisJCXNsYXZlX2RmbG93ICA9ICZ0ZW1wOworCQllcnIgPSBrb21lZGFfc3BsaXRfc2Jz
X21hc3Rlcl9kYXRhX2Zsb3coa2NydGNfc3QsCisJCQkJJm1hc3Rlcl9kZmxvdywgJnNsYXZlX2Rm
bG93KTsKKwl9IGVsc2UgeworCQltYXN0ZXIgPSBOVUxMOworCQlzbGF2ZSA9IGxheWVyOworCQlt
YXN0ZXJfZGZsb3cgPSBOVUxMOworCQlzbGF2ZV9kZmxvdyA9IGRmbG93OworCQllcnIgPSBrb21l
ZGFfc3BsaXRfc2JzX3NsYXZlX2RhdGFfZmxvdyhrY3J0Y19zdCwgc2xhdmVfZGZsb3cpOworCX0K
KworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAobWFzdGVyX2RmbG93KSB7CisJCURS
TV9ERUJVR19BVE9NSUMoIlNCUyBNYXN0ZXItJXMgYXNzaWduZWQ6ICVzXG4iLAorCQkJbWFzdGVy
LT5iYXNlLm5hbWUsIGtvbWVkYV9kYXRhX2Zsb3dfbXNnKG1hc3Rlcl9kZmxvdykpOworCisJCWlm
IChtYXN0ZXJfZGZsb3ctPmVuX3NwbGl0KQorCQkJZXJyID0ga29tZWRhX2J1aWxkX2xheWVyX3Nw
bGl0X2RhdGFfZmxvdyhtYXN0ZXIsCisJCQkJCWtwbGFuZV9zdCwga2NydGNfc3QsIG1hc3Rlcl9k
Zmxvdyk7CisJCWVsc2UKKwkJCWVyciA9IGtvbWVkYV9idWlsZF9sYXllcl9kYXRhX2Zsb3cobWFz
dGVyLAorCQkJCQlrcGxhbmVfc3QsIGtjcnRjX3N0LCBtYXN0ZXJfZGZsb3cpOworCisJCWlmIChl
cnIpCisJCQlyZXR1cm4gZXJyOworCX0KKworCWlmIChzbGF2ZV9kZmxvdykgeworCQlEUk1fREVC
VUdfQVRPTUlDKCJTQlMgU2xhdmUtJXMgYXNzaWduZWQ6ICVzXG4iLAorCQkJc2xhdmUtPmJhc2Uu
bmFtZSwga29tZWRhX2RhdGFfZmxvd19tc2coc2xhdmVfZGZsb3cpKTsKKworCQlpZiAoc2xhdmVf
ZGZsb3ctPmVuX3NwbGl0KQorCQkJZXJyID0ga29tZWRhX2J1aWxkX2xheWVyX3NwbGl0X2RhdGFf
ZmxvdyhzbGF2ZSwKKwkJCQkJa3BsYW5lX3N0LCBrY3J0Y19zdCwgc2xhdmVfZGZsb3cpOworCQll
bHNlCisJCQllcnIgPSBrb21lZGFfYnVpbGRfbGF5ZXJfZGF0YV9mbG93KHNsYXZlLAorCQkJCQlr
cGxhbmVfc3QsIGtjcnRjX3N0LCBzbGF2ZV9kZmxvdyk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4g
ZXJyOworCX0KKworCXJldHVybiAwOworfQorCiAvKiB3cml0ZWJhY2sgZGF0YSBwYXRoOiBjb21w
aXogLT4gc2NhbGVyIC0+IHdiX2xheWVyIC0+IG1lbW9yeSAqLwogaW50IGtvbWVkYV9idWlsZF93
Yl9kYXRhX2Zsb3coc3RydWN0IGtvbWVkYV9sYXllciAqd2JfbGF5ZXIsCiAJCQkgICAgICBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9hcm0vZGlzcGxheS9rb21lZGEva29tZWRhX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YXJtL2Rpc3BsYXkva29tZWRhL2tvbWVkYV9wbGFuZS5jCmluZGV4IGE1NjI1ZjQ2MTIwZi4uNDM2
ZGRhMWNhNmRkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXJtL2Rpc3BsYXkva29tZWRh
L2tvbWVkYV9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21lZGEv
a29tZWRhX3BsYW5lLmMKQEAgLTgxLDYgKzgxLDcgQEAga29tZWRhX3BsYW5lX2F0b21pY19jaGVj
ayhzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlzdHJ1Y3Qga29tZWRhX3BsYW5lX3N0YXRlICpr
cGxhbmVfc3QgPSB0b19rcGxhbmVfc3Qoc3RhdGUpOwogCXN0cnVjdCBrb21lZGFfbGF5ZXIgKmxh
eWVyID0ga3BsYW5lLT5sYXllcjsKIAlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3Q7CisJ
c3RydWN0IGtvbWVkYV9jcnRjICprY3J0YzsKIAlzdHJ1Y3Qga29tZWRhX2NydGNfc3RhdGUgKmtj
cnRjX3N0OwogCXN0cnVjdCBrb21lZGFfZGF0YV9mbG93X2NmZyBkZmxvdzsKIAlpbnQgZXJyOwpA
QCAtOTgsMTMgKzk5LDE3IEBAIGtvbWVkYV9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRybV9w
bGFuZSAqcGxhbmUsCiAJaWYgKCFjcnRjX3N0LT5hY3RpdmUpCiAJCXJldHVybiAwOwoKKwlrY3J0
YyA9IHRvX2tjcnRjKGNydGNfc3QtPmNydGMpOwogCWtjcnRjX3N0ID0gdG9fa2NydGNfc3QoY3J0
Y19zdCk7CgogCWVyciA9IGtvbWVkYV9wbGFuZV9pbml0X2RhdGFfZmxvdyhzdGF0ZSwga2NydGNf
c3QsICZkZmxvdyk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKCi0JaWYgKGRmbG93LmVuX3Nw
bGl0KQorCWlmIChrY3J0Yy0+c2lkZV9ieV9zaWRlKQorCQllcnIgPSBrb21lZGFfYnVpbGRfbGF5
ZXJfc2JzX2RhdGFfZmxvdyhsYXllciwKKwkJCQlrcGxhbmVfc3QsIGtjcnRjX3N0LCAmZGZsb3cp
OworCWVsc2UgaWYgKGRmbG93LmVuX3NwbGl0KQogCQllcnIgPSBrb21lZGFfYnVpbGRfbGF5ZXJf
c3BsaXRfZGF0YV9mbG93KGxheWVyLAogCQkJCWtwbGFuZV9zdCwga2NydGNfc3QsICZkZmxvdyk7
CiAJZWxzZQotLQoyLjIwLjEKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJp
LWRldmVs
