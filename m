Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 720B498393
	for <lists+dri-devel@lfdr.de>; Wed, 21 Aug 2019 20:50:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 203A36E97C;
	Wed, 21 Aug 2019 18:50:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EB3F86E340
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Aug 2019 18:50:17 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id 79D619A1;
 Wed, 21 Aug 2019 20:50:15 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH/RFC 3/5] drm/edid: Move DisplayID tile parsing to
 drm_connector.c
Date: Wed, 21 Aug 2019 21:50:03 +0300
Message-Id: <20190821185005.9789-4-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190821185005.9789-1-laurent.pinchart@ideasonboard.com>
References: <20190821185005.9789-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1566413415;
 bh=poiUObtPAmyQEP239ZHT8gS91f6ECxORelZGqlhVCBw=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=R481xMY0rJg4xwCfNsnZPSXQ+RBMkUauan+yiVZ9+eci7tZ6EiD9oJgXUkiAgtmDs
 Ka9RVFAJeBiwVM4Md2QbL83ujMTT2koZvr6RTSyZVdTEFOTXhgHQc3jiCru+vSIWEH
 ZomPlYp1jB2QE3uDox53XM2RqTTLZw6zLsgTtYOY=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomi Valkeinen <tomi.valkeinen@ti.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHN0YXRpYyBmdW5jdGlvbiB0aGF0IHBvcHVsYXRlcyB0aGUgZHJtX2Nvbm5lY3RvciB0aWxl
LXJlbGF0ZWQgZmllbGRzCmZyb20gRURJRCBkaXNwbGF5aWQgd2lsbCBiZSB1c2VkIG91dHNpZGUg
b2YgZHJtX2VkaWQuYy4gQXMgaXQgbG9naWNhbGx5CmJlbG9uZ3MgdG8gY29ubmVjdG9yIGNvZGUs
IG1vdmUgaXQgdG8gZHJtX2Nvbm5lY3Rvci5jIGFuZCByZW5hbWUgaXQgZnJvbQpkcm1fZ2V0X2Rp
c3BsYXlpZCgpIHRvIGRybV9jb25uZWN0b3Jfc2V0X2Rpc3BsYXlpZCgpLgoKV2hpbGUgYXQgaXQs
IGZpeCBhIGZldyBjaGVja3BhdGNoIHdhcm5pbmdzIGluIHRoZSBtb3ZlZCBjb2RlLgoKU2lnbmVk
LW9mZi1ieTogTGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fY29ubmVjdG9yLmMgICAgICAgfCAxMzcgKysr
KysrKysrKysrKysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9s
b2d5LmMgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZWRpZC5jICAgICAgICAgICAgfCAx
MzEgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBpbmNsdWRlL2RybS9kcm1fY29ubmVjdG9yLmgg
ICAgICAgICAgIHwgICAzICstCiBpbmNsdWRlL2RybS9kcm1fZGlzcGxheWlkLmggICAgICAgICAg
IHwgICAyICsKIGluY2x1ZGUvZHJtL2RybV9lZGlkLmggICAgICAgICAgICAgICAgfCAgIDIgKwog
NiBmaWxlcyBjaGFuZ2VkLCAxNDggaW5zZXJ0aW9ucygrKSwgMTMwIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fY29ubmVjdG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2Nvbm5lY3Rvci5jCmluZGV4IDRjNzY2NjI0YjIwZC4uMDRmNzJhZDBkOWI2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Nvbm5lY3Rvci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fY29ubmVjdG9yLmMKQEAgLTIxLDYgKzIxLDcgQEAKICAqLwogCiAjaW5jbHVkZSA8
ZHJtL2RybV9jb25uZWN0b3IuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Rpc3BsYXlpZC5oPgogI2lu
Y2x1ZGUgPGRybS9kcm1fZWRpZC5oPgogI2luY2x1ZGUgPGRybS9kcm1fZW5jb2Rlci5oPgogI2lu
Y2x1ZGUgPGRybS9kcm1fdXRpbHMuaD4KQEAgLTE4MDEsNiArMTgwMiwxMzUgQEAgaW50IGRybV9j
b25uZWN0b3Jfc2V0X3BhdGhfcHJvcGVydHkoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rv
ciwKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2Nvbm5lY3Rvcl9zZXRfcGF0aF9wcm9wZXJ0eSk7CiAK
K3N0YXRpYyBpbnQgZHJtX3BhcnNlX3RpbGVkX2Jsb2NrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsCisJCQkJIHN0cnVjdCBkaXNwbGF5aWRfYmxvY2sgKmJsb2NrKQoreworCXN0cnVj
dCBkaXNwbGF5aWRfdGlsZWRfYmxvY2sgKnRpbGUgPQorCQkoc3RydWN0IGRpc3BsYXlpZF90aWxl
ZF9ibG9jayAqKWJsb2NrOworCXN0cnVjdCBkcm1fdGlsZV9ncm91cCAqdGc7CisJdTggdGlsZV92
X2xvYywgdGlsZV9oX2xvYzsKKwl1OCBudW1fdl90aWxlLCBudW1faF90aWxlOworCXUxNiB3LCBo
OworCisJdyA9IHRpbGUtPnRpbGVfc2l6ZVswXSB8IHRpbGUtPnRpbGVfc2l6ZVsxXSA8PCA4Owor
CWggPSB0aWxlLT50aWxlX3NpemVbMl0gfCB0aWxlLT50aWxlX3NpemVbM10gPDwgODsKKworCW51
bV92X3RpbGUgPSAodGlsZS0+dG9wb1swXSAmIDB4ZikgfCAodGlsZS0+dG9wb1syXSAmIDB4MzAp
OworCW51bV9oX3RpbGUgPSAodGlsZS0+dG9wb1swXSA+PiA0KSB8ICgodGlsZS0+dG9wb1syXSA+
PiAyKSAmIDB4MzApOworCXRpbGVfdl9sb2MgPSAodGlsZS0+dG9wb1sxXSAmIDB4ZikgfCAoKHRp
bGUtPnRvcG9bMl0gJiAweDMpIDw8IDQpOworCXRpbGVfaF9sb2MgPSAodGlsZS0+dG9wb1sxXSA+
PiA0KSB8ICgoKHRpbGUtPnRvcG9bMl0gPj4gMikgJiAweDMpIDw8IDQpOworCisJY29ubmVjdG9y
LT5oYXNfdGlsZSA9IHRydWU7CisJaWYgKHRpbGUtPnRpbGVfY2FwICYgMHg4MCkKKwkJY29ubmVj
dG9yLT50aWxlX2lzX3NpbmdsZV9tb25pdG9yID0gdHJ1ZTsKKworCWNvbm5lY3Rvci0+bnVtX2hf
dGlsZSA9IG51bV9oX3RpbGUgKyAxOworCWNvbm5lY3Rvci0+bnVtX3ZfdGlsZSA9IG51bV92X3Rp
bGUgKyAxOworCWNvbm5lY3Rvci0+dGlsZV9oX2xvYyA9IHRpbGVfaF9sb2M7CisJY29ubmVjdG9y
LT50aWxlX3ZfbG9jID0gdGlsZV92X2xvYzsKKwljb25uZWN0b3ItPnRpbGVfaF9zaXplID0gdyAr
IDE7CisJY29ubmVjdG9yLT50aWxlX3Zfc2l6ZSA9IGggKyAxOworCisJRFJNX0RFQlVHX0tNUygi
dGlsZSBjYXAgMHgleFxuIiwgdGlsZS0+dGlsZV9jYXApOworCURSTV9ERUJVR19LTVMoInRpbGVf
c2l6ZSAlZCB4ICVkXG4iLCB3ICsgMSwgaCArIDEpOworCURSTV9ERUJVR19LTVMoInRvcG8gbnVt
IHRpbGVzICVkeCVkLCBsb2NhdGlvbiAlZHglZFxuIiwKKwkJICAgICAgbnVtX2hfdGlsZSArIDEs
IG51bV92X3RpbGUgKyAxLCB0aWxlX2hfbG9jLCB0aWxlX3ZfbG9jKTsKKwlEUk1fREVCVUdfS01T
KCJ2ZW5kICVjJWMlY1xuIiwgdGlsZS0+dG9wb2xvZ3lfaWRbMF0sCisJCSAgICAgIHRpbGUtPnRv
cG9sb2d5X2lkWzFdLCB0aWxlLT50b3BvbG9neV9pZFsyXSk7CisKKwl0ZyA9IGRybV9tb2RlX2dl
dF90aWxlX2dyb3VwKGNvbm5lY3Rvci0+ZGV2LCB0aWxlLT50b3BvbG9neV9pZCk7CisJaWYgKCF0
ZykKKwkJdGcgPSBkcm1fbW9kZV9jcmVhdGVfdGlsZV9ncm91cChjb25uZWN0b3ItPmRldiwKKwkJ
CQkJCXRpbGUtPnRvcG9sb2d5X2lkKTsKKwlpZiAoIXRnKQorCQlyZXR1cm4gLUVOT01FTTsKKwor
CWlmIChjb25uZWN0b3ItPnRpbGVfZ3JvdXAgIT0gdGcpIHsKKwkJLyoKKwkJICogSWYgd2UgaGF2
ZW4ndCBnb3QgYSBwb2ludGVyLCB0YWtlIHRoZSByZWZlcmVuY2UsIGRyb3AgcmVmIHRvCisJCSAq
IG9sZCB0aWxlIGdyb3VwLgorCQkgKi8KKwkJaWYgKGNvbm5lY3Rvci0+dGlsZV9ncm91cCkKKwkJ
CWRybV9tb2RlX3B1dF90aWxlX2dyb3VwKGNvbm5lY3Rvci0+ZGV2LAorCQkJCQkJY29ubmVjdG9y
LT50aWxlX2dyb3VwKTsKKwkJY29ubmVjdG9yLT50aWxlX2dyb3VwID0gdGc7CisJfSBlbHNlIHsK
KwkJLyogSWYgc2FtZSB0aWxlIGdyb3VwLCB0aGVuIHJlbGVhc2UgdGhlIHJlZiB3ZSBqdXN0IHRv
b2suICovCisJCWRybV9tb2RlX3B1dF90aWxlX2dyb3VwKGNvbm5lY3Rvci0+ZGV2LCB0Zyk7CisJ
fQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZHJtX2Nvbm5lY3Rvcl9wYXJzZV9kaXNw
bGF5aWRfdGlsZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCQkgICAgICB1
OCAqZGlzcGxheWlkLCBpbnQgbGVuZ3RoKQoreworCXN0cnVjdCBkaXNwbGF5aWRfYmxvY2sgKmJs
b2NrOworCWludCBpZHg7CisJaW50IHJldDsKKworCWlmICghZHJtX2Rpc3BsYXlpZF9pc192YWxp
ZChkaXNwbGF5aWQsIGxlbmd0aCkpCisJCXJldHVybiAtRUlOVkFMOworCisJaWR4ID0gc2l6ZW9m
KHN0cnVjdCBkaXNwbGF5aWRfaGRyKTsKKwlmb3JfZWFjaF9kaXNwbGF5aWRfZGIoZGlzcGxheWlk
LCBibG9jaywgaWR4LCBsZW5ndGgpIHsKKwkJRFJNX0RFQlVHX0tNUygiYmxvY2sgaWQgMHgleCwg
cmV2ICVkLCBsZW4gJWRcbiIsCisJCQkgICAgICBibG9jay0+dGFnLCBibG9jay0+cmV2LCBibG9j
ay0+bnVtX2J5dGVzKTsKKworCQlzd2l0Y2ggKGJsb2NrLT50YWcpIHsKKwkJY2FzZSBEQVRBX0JM
T0NLX1RJTEVEX0RJU1BMQVk6CisJCQlyZXQgPSBkcm1fcGFyc2VfdGlsZWRfYmxvY2soY29ubmVj
dG9yLCBibG9jayk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisJCQlicmVhazsKKwkJ
Y2FzZSBEQVRBX0JMT0NLX1RZUEVfMV9ERVRBSUxFRF9USU1JTkc6CisJCQkvKiBoYW5kbGVkIGlu
IG1vZGUgZ2F0aGVyaW5nIGNvZGUuICovCisJCQlicmVhazsKKwkJY2FzZSBEQVRBX0JMT0NLX0NU
QToKKwkJCS8qIGhhbmRsZWQgaW4gdGhlIGNlYSBwYXJzZXIgY29kZS4gKi8KKwkJCWJyZWFrOwor
CQlkZWZhdWx0OgorCQkJRFJNX0RFQlVHX0tNUygiZm91bmQgRGlzcGxheUlEIHRhZyAweCV4LCB1
bmhhbmRsZWRcbiIsCisJCQkJICAgICAgYmxvY2stPnRhZyk7CisJCQlicmVhazsKKwkJfQorCX0K
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgZHJtX2Nvbm5lY3Rvcl9zZXRfZGlzcGxheWlk
X3RpbGUoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkJICAgICB2b2lkICpk
aXNwbGF5aWQsCisJCQkJCSAgICAgdW5zaWduZWQgaW50IGxlbmd0aCkKK3sKKwljb25uZWN0b3It
Pmhhc190aWxlID0gZmFsc2U7CisKKwlpZiAoZGlzcGxheWlkKQorCQlkcm1fY29ubmVjdG9yX3Bh
cnNlX2Rpc3BsYXlpZF90aWxlKGNvbm5lY3RvciwgZGlzcGxheWlkLAorCQkJCQkJICAgbGVuZ3Ro
KTsKKworCWlmICghY29ubmVjdG9yLT5oYXNfdGlsZSAmJiBjb25uZWN0b3ItPnRpbGVfZ3JvdXAp
IHsKKwkJZHJtX21vZGVfcHV0X3RpbGVfZ3JvdXAoY29ubmVjdG9yLT5kZXYsIGNvbm5lY3Rvci0+
dGlsZV9ncm91cCk7CisJCWNvbm5lY3Rvci0+dGlsZV9ncm91cCA9IE5VTEw7CisJfQorfQorCitz
dGF0aWMgdm9pZCBkcm1fY29ubmVjdG9yX3NldF9lZGlkX3RpbGUoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvciwKKwkJCQkJY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpCit7CisJdW5zaWdu
ZWQgaW50IGxlbmd0aDsKKwl2b2lkICpkaXNwbGF5aWQ7CisKKwlpZiAoZWRpZCkgeworCQlkaXNw
bGF5aWQgPSBkcm1fZWRpZF9maW5kX2Rpc3BsYXlpZF9leHRlbnNpb24oZWRpZCk7CisJCWxlbmd0
aCA9IEVESURfTEVOR1RIIC0gMTsKKwl9IGVsc2UgeworCQlkaXNwbGF5aWQgPSBOVUxMOworCQls
ZW5ndGggPSAwOworCX0KKworCWRybV9jb25uZWN0b3Jfc2V0X2Rpc3BsYXlpZF90aWxlKGNvbm5l
Y3RvciwgZGlzcGxheWlkLCBsZW5ndGgpOworfQorCiAvKioKICAqIGRybV9jb25uZWN0b3Jfc2V0
X3RpbGVfcHJvcGVydHkgLSBzZXQgdGlsZSBwcm9wZXJ0eSBvbiBjb25uZWN0b3IKICAqIEBjb25u
ZWN0b3I6IGNvbm5lY3RvciB0byBzZXQgcHJvcGVydHkgb24uCkBAIC0xODE0LDEyICsxOTQ0LDE1
IEBAIEVYUE9SVF9TWU1CT0woZHJtX2Nvbm5lY3Rvcl9zZXRfcGF0aF9wcm9wZXJ0eSk7CiAgKiBS
ZXR1cm5zOgogICogWmVybyBvbiBzdWNjZXNzLCBlcnJubyBvbiBmYWlsdXJlLgogICovCi1pbnQg
ZHJtX2Nvbm5lY3Rvcl9zZXRfdGlsZV9wcm9wZXJ0eShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29u
bmVjdG9yKQoraW50IGRybV9jb25uZWN0b3Jfc2V0X3RpbGVfcHJvcGVydHkoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkgICAgY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpCiB7
CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+ZGV2OwogCWNoYXIgdGlsZVsy
NTZdOwogCWludCByZXQ7CiAKKwlkcm1fY29ubmVjdG9yX3NldF9lZGlkX3RpbGUoY29ubmVjdG9y
LCBlZGlkKTsKKwogCWlmICghY29ubmVjdG9yLT5oYXNfdGlsZSkgewogCQlyZXQgID0gZHJtX3By
b3BlcnR5X3JlcGxhY2VfZ2xvYmFsX2Jsb2IoZGV2LAogCQkgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgJmNvbm5lY3Rvci0+dGlsZV9ibG9iX3B0ciwKQEAgLTE4OTksNyAr
MjAzMiw3IEBAIGludCBkcm1fY29ubmVjdG9yX3VwZGF0ZV9lZGlkX3Byb3BlcnR5KHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZGV2LT5tb2RlX2NvbmZpZy5lZGlkX3Byb3BlcnR5KTsKIAlpZiAocmV0KQogCQly
ZXR1cm4gcmV0OwotCXJldHVybiBkcm1fY29ubmVjdG9yX3NldF90aWxlX3Byb3BlcnR5KGNvbm5l
Y3Rvcik7CisJcmV0dXJuIGRybV9jb25uZWN0b3Jfc2V0X3RpbGVfcHJvcGVydHkoY29ubmVjdG9y
LCBlZGlkKTsKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2Nvbm5lY3Rvcl91cGRhdGVfZWRpZF9wcm9w
ZXJ0eSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5jCmluZGV4IDgyYWRkNzM2
ZTE3ZC4uNmVkZjliZjhmZDliIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21z
dF90b3BvbG9neS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5LmMK
QEAgLTE3MTIsNyArMTcxMiw4IEBAIHN0YXRpYyB2b2lkIGRybV9kcF9hZGRfcG9ydChzdHJ1Y3Qg
ZHJtX2RwX21zdF9icmFuY2ggKm1zdGIsCiAJCSAgICBwb3J0LT5wb3J0X251bSA+PSBEUF9NU1Rf
TE9HSUNBTF9QT1JUXzApIHsKIAkJCXBvcnQtPmNhY2hlZF9lZGlkID0gZHJtX2dldF9lZGlkKHBv
cnQtPmNvbm5lY3RvciwKIAkJCQkJCQkgJnBvcnQtPmF1eC5kZGMpOwotCQkJZHJtX2Nvbm5lY3Rv
cl9zZXRfdGlsZV9wcm9wZXJ0eShwb3J0LT5jb25uZWN0b3IpOworCQkJZHJtX2Nvbm5lY3Rvcl9z
ZXRfdGlsZV9wcm9wZXJ0eShwb3J0LT5jb25uZWN0b3IsCisJCQkJCQkJcG9ydC0+Y2FjaGVkX2Vk
aWQpOwogCQl9CiAJCSgqbXN0Yi0+bWdyLT5jYnMtPnJlZ2lzdGVyX2Nvbm5lY3RvcikocG9ydC0+
Y29ubmVjdG9yKTsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYyBi
L2RyaXZlcnMvZ3B1L2RybS9kcm1fZWRpZC5jCmluZGV4IGJmY2IyMzJiOTc2MC4uNTQxZTUwYjg1
OGUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VkaWQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vZHJtX2VkaWQuYwpAQCAtMjYwNiw3ICsyNjA2LDcgQEAgc3RhdGljIHU4ICpkcm1f
ZmluZF9lZGlkX2V4dGVuc2lvbihjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCwgaW50IGV4dF9pZCkK
IAlyZXR1cm4gZWRpZF9leHQ7CiB9CiAKLXN0YXRpYyBib29sIGRybV9kaXNwbGF5aWRfaXNfdmFs
aWQodTggKmRpc3BsYXlpZCwgdW5zaWduZWQgaW50IGxlbmd0aCkKK2Jvb2wgZHJtX2Rpc3BsYXlp
ZF9pc192YWxpZCh1OCAqZGlzcGxheWlkLCB1bnNpZ25lZCBpbnQgbGVuZ3RoKQogewogCXN0cnVj
dCBkaXNwbGF5aWRfaGRyICpiYXNlOwogCXU4IGNzdW0gPSAwOwpAQCAtMjYzMSw3ICsyNjMxLDcg
QEAgc3RhdGljIGJvb2wgZHJtX2Rpc3BsYXlpZF9pc192YWxpZCh1OCAqZGlzcGxheWlkLCB1bnNp
Z25lZCBpbnQgbGVuZ3RoKQogCXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgdTggKmRybV9maW5k
X2Rpc3BsYXlpZF9leHRlbnNpb24oY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpCit1OCAqZHJtX2Vk
aWRfZmluZF9kaXNwbGF5aWRfZXh0ZW5zaW9uKGNvbnN0IHN0cnVjdCBlZGlkICplZGlkKQogewog
CXU4ICpleHQgPSBkcm1fZmluZF9lZGlkX2V4dGVuc2lvbihlZGlkLCBESVNQTEFZSURfRVhUKTsK
IApAQCAtMjY1OSw3ICsyNjU5LDcgQEAgc3RhdGljIHU4ICpkcm1fZmluZF9jZWFfZXh0ZW5zaW9u
KGNvbnN0IHN0cnVjdCBlZGlkICplZGlkKQogCQlyZXR1cm4gY2VhOwogCiAJLyogQ0VBIGJsb2Nr
cyBjYW4gYWxzbyBiZSBmb3VuZCBlbWJlZGRlZCBpbiBhIERpc3BsYXlJRCBibG9jayAqLwotCWRp
c3BsYXlpZCA9IGRybV9maW5kX2Rpc3BsYXlpZF9leHRlbnNpb24oZWRpZCk7CisJZGlzcGxheWlk
ID0gZHJtX2VkaWRfZmluZF9kaXNwbGF5aWRfZXh0ZW5zaW9uKGVkaWQpOwogCWlmICghZGlzcGxh
eWlkKQogCQlyZXR1cm4gTlVMTDsKIApAQCAtNDUwMSw3ICs0NTAxLDcgQEAgc3RhdGljIGludCBh
ZGRfZGlzcGxheWlkX2RldGFpbGVkX21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IsCiAJc3RydWN0IGRpc3BsYXlpZF9ibG9jayAqYmxvY2s7CiAJaW50IG51bV9tb2RlcyA9IDA7
CiAKLQlkaXNwbGF5aWQgPSBkcm1fZmluZF9kaXNwbGF5aWRfZXh0ZW5zaW9uKGVkaWQpOworCWRp
c3BsYXlpZCA9IGRybV9lZGlkX2ZpbmRfZGlzcGxheWlkX2V4dGVuc2lvbihlZGlkKTsKIAlpZiAo
IWRpc3BsYXlpZCkKIAkJcmV0dXJuIDA7CiAKQEAgLTUwNTUsMTIyICs1MDU1LDYgQEAgZHJtX2hk
bWlfdmVuZG9yX2luZm9mcmFtZV9mcm9tX2Rpc3BsYXlfbW9kZShzdHJ1Y3QgaGRtaV92ZW5kb3Jf
aW5mb2ZyYW1lICpmcmFtZSwKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2hkbWlfdmVuZG9yX2luZm9m
cmFtZV9mcm9tX2Rpc3BsYXlfbW9kZSk7CiAKLXN0YXRpYyBpbnQgZHJtX3BhcnNlX3RpbGVkX2Js
b2NrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCi0JCQkJIHN0cnVjdCBkaXNwbGF5
aWRfYmxvY2sgKmJsb2NrKQotewotCXN0cnVjdCBkaXNwbGF5aWRfdGlsZWRfYmxvY2sgKnRpbGUg
PSAoc3RydWN0IGRpc3BsYXlpZF90aWxlZF9ibG9jayAqKWJsb2NrOwotCXUxNiB3LCBoOwotCXU4
IHRpbGVfdl9sb2MsIHRpbGVfaF9sb2M7Ci0JdTggbnVtX3ZfdGlsZSwgbnVtX2hfdGlsZTsKLQlz
dHJ1Y3QgZHJtX3RpbGVfZ3JvdXAgKnRnOwotCi0JdyA9IHRpbGUtPnRpbGVfc2l6ZVswXSB8IHRp
bGUtPnRpbGVfc2l6ZVsxXSA8PCA4OwotCWggPSB0aWxlLT50aWxlX3NpemVbMl0gfCB0aWxlLT50
aWxlX3NpemVbM10gPDwgODsKLQotCW51bV92X3RpbGUgPSAodGlsZS0+dG9wb1swXSAmIDB4Zikg
fCAodGlsZS0+dG9wb1syXSAmIDB4MzApOwotCW51bV9oX3RpbGUgPSAodGlsZS0+dG9wb1swXSA+
PiA0KSB8ICgodGlsZS0+dG9wb1syXSA+PiAyKSAmIDB4MzApOwotCXRpbGVfdl9sb2MgPSAodGls
ZS0+dG9wb1sxXSAmIDB4ZikgfCAoKHRpbGUtPnRvcG9bMl0gJiAweDMpIDw8IDQpOwotCXRpbGVf
aF9sb2MgPSAodGlsZS0+dG9wb1sxXSA+PiA0KSB8ICgoKHRpbGUtPnRvcG9bMl0gPj4gMikgJiAw
eDMpIDw8IDQpOwotCi0JY29ubmVjdG9yLT5oYXNfdGlsZSA9IHRydWU7Ci0JaWYgKHRpbGUtPnRp
bGVfY2FwICYgMHg4MCkKLQkJY29ubmVjdG9yLT50aWxlX2lzX3NpbmdsZV9tb25pdG9yID0gdHJ1
ZTsKLQotCWNvbm5lY3Rvci0+bnVtX2hfdGlsZSA9IG51bV9oX3RpbGUgKyAxOwotCWNvbm5lY3Rv
ci0+bnVtX3ZfdGlsZSA9IG51bV92X3RpbGUgKyAxOwotCWNvbm5lY3Rvci0+dGlsZV9oX2xvYyA9
IHRpbGVfaF9sb2M7Ci0JY29ubmVjdG9yLT50aWxlX3ZfbG9jID0gdGlsZV92X2xvYzsKLQljb25u
ZWN0b3ItPnRpbGVfaF9zaXplID0gdyArIDE7Ci0JY29ubmVjdG9yLT50aWxlX3Zfc2l6ZSA9IGgg
KyAxOwotCi0JRFJNX0RFQlVHX0tNUygidGlsZSBjYXAgMHgleFxuIiwgdGlsZS0+dGlsZV9jYXAp
OwotCURSTV9ERUJVR19LTVMoInRpbGVfc2l6ZSAlZCB4ICVkXG4iLCB3ICsgMSwgaCArIDEpOwot
CURSTV9ERUJVR19LTVMoInRvcG8gbnVtIHRpbGVzICVkeCVkLCBsb2NhdGlvbiAlZHglZFxuIiwK
LQkJICAgICAgbnVtX2hfdGlsZSArIDEsIG51bV92X3RpbGUgKyAxLCB0aWxlX2hfbG9jLCB0aWxl
X3ZfbG9jKTsKLQlEUk1fREVCVUdfS01TKCJ2ZW5kICVjJWMlY1xuIiwgdGlsZS0+dG9wb2xvZ3lf
aWRbMF0sIHRpbGUtPnRvcG9sb2d5X2lkWzFdLCB0aWxlLT50b3BvbG9neV9pZFsyXSk7Ci0KLQl0
ZyA9IGRybV9tb2RlX2dldF90aWxlX2dyb3VwKGNvbm5lY3Rvci0+ZGV2LCB0aWxlLT50b3BvbG9n
eV9pZCk7Ci0JaWYgKCF0ZykgewotCQl0ZyA9IGRybV9tb2RlX2NyZWF0ZV90aWxlX2dyb3VwKGNv
bm5lY3Rvci0+ZGV2LCB0aWxlLT50b3BvbG9neV9pZCk7Ci0JfQotCWlmICghdGcpCi0JCXJldHVy
biAtRU5PTUVNOwotCi0JaWYgKGNvbm5lY3Rvci0+dGlsZV9ncm91cCAhPSB0ZykgewotCQkvKiBp
ZiB3ZSBoYXZlbid0IGdvdCBhIHBvaW50ZXIsCi0JCSAgIHRha2UgdGhlIHJlZmVyZW5jZSwgZHJv
cCByZWYgdG8gb2xkIHRpbGUgZ3JvdXAgKi8KLQkJaWYgKGNvbm5lY3Rvci0+dGlsZV9ncm91cCkg
ewotCQkJZHJtX21vZGVfcHV0X3RpbGVfZ3JvdXAoY29ubmVjdG9yLT5kZXYsIGNvbm5lY3Rvci0+
dGlsZV9ncm91cCk7Ci0JCX0KLQkJY29ubmVjdG9yLT50aWxlX2dyb3VwID0gdGc7Ci0JfSBlbHNl
Ci0JCS8qIGlmIHNhbWUgdGlsZSBncm91cCwgdGhlbiByZWxlYXNlIHRoZSByZWYgd2UganVzdCB0
b29rLiAqLwotCQlkcm1fbW9kZV9wdXRfdGlsZV9ncm91cChjb25uZWN0b3ItPmRldiwgdGcpOwot
CXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGRybV9wYXJzZV9kaXNwbGF5aWQoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCSAgICAgICB1OCAqZGlzcGxheWlkLCBpbnQgbGVu
Z3RoKQotewotCXN0cnVjdCBkaXNwbGF5aWRfYmxvY2sgKmJsb2NrOwotCWludCBpZHg7Ci0JaW50
IHJldDsKLQotCWlmICghZHJtX2Rpc3BsYXlpZF9pc192YWxpZChkaXNwbGF5aWQsIGxlbmd0aCkp
Ci0JCXJldHVybiAtRUlOVkFMOwotCi0JaWR4ID0gc2l6ZW9mKHN0cnVjdCBkaXNwbGF5aWRfaGRy
KTsKLQlmb3JfZWFjaF9kaXNwbGF5aWRfZGIoZGlzcGxheWlkLCBibG9jaywgaWR4LCBsZW5ndGgp
IHsKLQkJRFJNX0RFQlVHX0tNUygiYmxvY2sgaWQgMHgleCwgcmV2ICVkLCBsZW4gJWRcbiIsCi0J
CQkgICAgICBibG9jay0+dGFnLCBibG9jay0+cmV2LCBibG9jay0+bnVtX2J5dGVzKTsKLQotCQlz
d2l0Y2ggKGJsb2NrLT50YWcpIHsKLQkJY2FzZSBEQVRBX0JMT0NLX1RJTEVEX0RJU1BMQVk6Ci0J
CQlyZXQgPSBkcm1fcGFyc2VfdGlsZWRfYmxvY2soY29ubmVjdG9yLCBibG9jayk7Ci0JCQlpZiAo
cmV0KQotCQkJCXJldHVybiByZXQ7Ci0JCQlicmVhazsKLQkJY2FzZSBEQVRBX0JMT0NLX1RZUEVf
MV9ERVRBSUxFRF9USU1JTkc6Ci0JCQkvKiBoYW5kbGVkIGluIG1vZGUgZ2F0aGVyaW5nIGNvZGUu
ICovCi0JCQlicmVhazsKLQkJY2FzZSBEQVRBX0JMT0NLX0NUQToKLQkJCS8qIGhhbmRsZWQgaW4g
dGhlIGNlYSBwYXJzZXIgY29kZS4gKi8KLQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJRFJNX0RF
QlVHX0tNUygiZm91bmQgRGlzcGxheUlEIHRhZyAweCV4LCB1bmhhbmRsZWRcbiIsIGJsb2NrLT50
YWcpOwotCQkJYnJlYWs7Ci0JCX0KLQl9Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIGRy
bV9nZXRfZGlzcGxheWlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCi0JCQkgICAg
ICBzdHJ1Y3QgZWRpZCAqZWRpZCkKLXsKLQl2b2lkICpkaXNwbGF5aWQ7Ci0JaW50IHJldDsKLQot
CWNvbm5lY3Rvci0+aGFzX3RpbGUgPSBmYWxzZTsKLQlkaXNwbGF5aWQgPSBkcm1fZmluZF9kaXNw
bGF5aWRfZXh0ZW5zaW9uKGVkaWQpOwotCWlmICghZGlzcGxheWlkKSB7Ci0JCS8qIGRyb3AgcmVm
ZXJlbmNlIHRvIGFueSB0aWxlIGdyb3VwIHdlIGhhZCAqLwotCQlnb3RvIG91dF9kcm9wX3JlZjsK
LQl9Ci0KLQlyZXQgPSBkcm1fcGFyc2VfZGlzcGxheWlkKGNvbm5lY3RvciwgZGlzcGxheWlkLCBF
RElEX0xFTkdUSCAtIDEpOwotCWlmIChyZXQgPCAwKQotCQlnb3RvIG91dF9kcm9wX3JlZjsKLQlp
ZiAoIWNvbm5lY3Rvci0+aGFzX3RpbGUpCi0JCWdvdG8gb3V0X2Ryb3BfcmVmOwotCXJldHVybjsK
LQotb3V0X2Ryb3BfcmVmOgotCWlmIChjb25uZWN0b3ItPnRpbGVfZ3JvdXApIHsKLQkJZHJtX21v
ZGVfcHV0X3RpbGVfZ3JvdXAoY29ubmVjdG9yLT5kZXYsIGNvbm5lY3Rvci0+dGlsZV9ncm91cCk7
Ci0JCWNvbm5lY3Rvci0+dGlsZV9ncm91cCA9IE5VTEw7Ci0JfQotfQotCiAjZGVmaW5lIEREQ19T
RUdNRU5UX0FERFIgMHgzMAogLyoqCiAgKiBkcm1fZG9fcHJvYmVfZGRjX2VkaWQoKSAtIGdldCBF
RElEIGluZm9ybWF0aW9uIHZpYSBJMkMKQEAgLTU0NDgsMTggKzUzMzIsMTMgQEAgRVhQT1JUX1NZ
TUJPTChkcm1fcHJvYmVfZGRjKTsKIHN0cnVjdCBlZGlkICpkcm1fZ2V0X2VkaWQoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCSAgc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVy
KQogewotCXN0cnVjdCBlZGlkICplZGlkOwotCiAJaWYgKGNvbm5lY3Rvci0+Zm9yY2UgPT0gRFJN
X0ZPUkNFX09GRikKIAkJcmV0dXJuIE5VTEw7CiAKIAlpZiAoY29ubmVjdG9yLT5mb3JjZSA9PSBE
Uk1fRk9SQ0VfVU5TUEVDSUZJRUQgJiYgIWRybV9wcm9iZV9kZGMoYWRhcHRlcikpCiAJCXJldHVy
biBOVUxMOwogCi0JZWRpZCA9IGRybV9kb19nZXRfZWRpZChjb25uZWN0b3IsIGRybV9kb19wcm9i
ZV9kZGNfZWRpZCwgYWRhcHRlcik7Ci0JaWYgKGVkaWQpCi0JCWRybV9nZXRfZGlzcGxheWlkKGNv
bm5lY3RvciwgZWRpZCk7Ci0JcmV0dXJuIGVkaWQ7CisJcmV0dXJuIGRybV9kb19nZXRfZWRpZChj
b25uZWN0b3IsIGRybV9kb19wcm9iZV9kZGNfZWRpZCwgYWRhcHRlcik7CiB9CiBFWFBPUlRfU1lN
Qk9MKGRybV9nZXRfZWRpZCk7CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0
b3IuaCBiL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaAppbmRleCA2ODFjYjU5MGY5NTIuLjlm
ZjA3ZjhkNmE0NCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2Nvbm5lY3Rvci5oCisrKyBi
L2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaApAQCAtMTUzMiw3ICsxNTMyLDggQEAgaW50IGRy
bV9tb2RlX2NyZWF0ZV9zdWdnZXN0ZWRfb2Zmc2V0X3Byb3BlcnRpZXMoc3RydWN0IGRybV9kZXZp
Y2UgKmRldik7CiAKIGludCBkcm1fY29ubmVjdG9yX3NldF9wYXRoX3Byb3BlcnR5KHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkJICAgIGNvbnN0IGNoYXIgKnBhdGgpOwotaW50
IGRybV9jb25uZWN0b3Jfc2V0X3RpbGVfcHJvcGVydHkoc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3Rvcik7CitpbnQgZHJtX2Nvbm5lY3Rvcl9zZXRfdGlsZV9wcm9wZXJ0eShzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCSAgICBjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCk7
CiBpbnQgZHJtX2Nvbm5lY3Rvcl91cGRhdGVfZWRpZF9wcm9wZXJ0eShzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLAogCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZWRpZCAqZWRpZCk7CiB2
b2lkIGRybV9jb25uZWN0b3Jfc2V0X2xpbmtfc3RhdHVzX3Byb3BlcnR5KHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZGlzcGxheWlk
LmggYi9pbmNsdWRlL2RybS9kcm1fZGlzcGxheWlkLmgKaW5kZXggOWQzYjc0NWMzMTA3Li4yNGYy
ZmFmM2FiZjggMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9kaXNwbGF5aWQuaAorKysgYi9p
bmNsdWRlL2RybS9kcm1fZGlzcGxheWlkLmgKQEAgLTEwMCw0ICsxMDAsNiBAQCBzdHJ1Y3QgZGlz
cGxheWlkX2RldGFpbGVkX3RpbWluZ19ibG9jayB7CiAJICAgICAoaWR4KSArPSAoYmxvY2spLT5u
dW1fYnl0ZXMgKyBzaXplb2Yoc3RydWN0IGRpc3BsYXlpZF9ibG9jayksIFwKIAkgICAgIChibG9j
aykgPSAoc3RydWN0IGRpc3BsYXlpZF9ibG9jayAqKSYoZGlzcGxheWlkKVtpZHhdKQogCitib29s
IGRybV9kaXNwbGF5aWRfaXNfdmFsaWQodTggKmRpc3BsYXlpZCwgdW5zaWduZWQgaW50IGxlbmd0
aCk7CisKICNlbmRpZgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2VkaWQuaCBiL2luY2x1
ZGUvZHJtL2RybV9lZGlkLmgKaW5kZXggYjk3MTk0MThjM2QyLi5jZjU4ZTZjOTg3ZDEgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9lZGlkLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2VkaWQu
aApAQCAtNDk1LDYgKzQ5NSw4IEBAIGludCBkcm1fZWRpZF9oZWFkZXJfaXNfdmFsaWQoY29uc3Qg
dTggKnJhd19lZGlkKTsKIGJvb2wgZHJtX2VkaWRfYmxvY2tfdmFsaWQodTggKnJhd19lZGlkLCBp
bnQgYmxvY2ssIGJvb2wgcHJpbnRfYmFkX2VkaWQsCiAJCQkgIGJvb2wgKmVkaWRfY29ycnVwdCk7
CiBib29sIGRybV9lZGlkX2lzX3ZhbGlkKHN0cnVjdCBlZGlkICplZGlkKTsKK3U4ICpkcm1fZWRp
ZF9maW5kX2Rpc3BsYXlpZF9leHRlbnNpb24oY29uc3Qgc3RydWN0IGVkaWQgKmVkaWQpOworCiB2
b2lkIGRybV9lZGlkX2dldF9tb25pdG9yX25hbWUoc3RydWN0IGVkaWQgKmVkaWQsIGNoYXIgKm5h
bWUsCiAJCQkgICAgICAgaW50IGJ1Zmxlbik7CiBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZHJt
X21vZGVfZmluZF9kbXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLS0gClJlZ2FyZHMsCgpMYXVy
ZW50IFBpbmNoYXJ0CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
