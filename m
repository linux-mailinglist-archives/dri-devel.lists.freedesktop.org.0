Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8EEB1C8A7D
	for <lists+dri-devel@lfdr.de>; Wed,  2 Oct 2019 16:05:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4A57589D4F;
	Wed,  2 Oct 2019 14:05:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from inva020.nxp.com (inva020.nxp.com [92.121.34.13])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BEF6689D4F
 for <dri-devel@lists.freedesktop.org>; Wed,  2 Oct 2019 14:05:47 +0000 (UTC)
Received: from inva020.nxp.com (localhost [127.0.0.1])
 by inva020.eu-rdc02.nxp.com (Postfix) with ESMTP id 31AAC1A0ACC;
 Wed,  2 Oct 2019 16:05:46 +0200 (CEST)
Received: from inva024.eu-rdc02.nxp.com (inva024.eu-rdc02.nxp.com
 [134.27.226.22])
 by inva020.eu-rdc02.nxp.com (Postfix) with ESMTP id 123961A0659;
 Wed,  2 Oct 2019 16:05:46 +0200 (CEST)
Received: from fsr-ub1664-121.ea.freescale.net
 (fsr-ub1664-121.ea.freescale.net [10.171.82.171])
 by inva024.eu-rdc02.nxp.com (Postfix) with ESMTP id 68C482060C;
 Wed,  2 Oct 2019 16:05:45 +0200 (CEST)
From: Laurentiu Palcu <laurentiu.palcu@nxp.com>
To: Philipp Zabel <p.zabel@pengutronix.de>, Shawn Guo <shawnguo@kernel.org>,
 Sascha Hauer <s.hauer@pengutronix.de>,
 Pengutronix Kernel Team <kernel@pengutronix.de>,
 Fabio Estevam <festevam@gmail.com>, NXP Linux Team <linux-imx@nxp.com>
Subject: [PATCH v2 3/5] drm/imx: Add initial support for DCSS on iMX8MQ
Date: Wed,  2 Oct 2019 17:04:55 +0300
Message-Id: <1570025100-5634-4-git-send-email-laurentiu.palcu@nxp.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1570025100-5634-1-git-send-email-laurentiu.palcu@nxp.com>
References: <1570025100-5634-1-git-send-email-laurentiu.palcu@nxp.com>
X-Virus-Scanned: ClamAV using ClamSMTP
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: agx@sigxcpu.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, Laurentiu Palcu <laurentiu.palcu@nxp.com>,
 linux-arm-kernel@lists.infradead.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGluaXRpYWwgc3VwcG9ydCBmb3IgaU1YOE1RJ3MgRGlzcGxheSBDb250cm9sbGVy
IFN1YnN5c3RlbSAoRENTUykuClNvbWUgb2YgaXRzIGNhcGFiaWxpdGllcyBpbmNsdWRlOgogKiA0
S0A2MGZwczsKICogSERSMTA7CiAqIG9uZSBncmFwaGljcyBhbmQgMiB2aWRlbyBwaXBlbGluZXM7
CiAqIG9uLXRoZS1mbHkgZGVjb21wcmVzc2lvbiBvZiBjb21wcmVzc2VkIHZpZGVvIGFuZCBncmFw
aGljczsKClRoZSByZWZlcmVuY2UgbWFudWFsIGNhbiBiZSBmb3VuZCBoZXJlOgpodHRwczovL3d3
dy5ueHAuY29tL3dlYmFwcC9Eb3dubG9hZD9jb2xDb2RlPUlNWDhNRFFMUVJNCgpUaGUgY3VycmVu
dCBwYXRjaCBhZGRzIG9ubHkgYmFzaWMgZnVuY3Rpb25hbGl0eTogb25lIHByaW1hcnkgcGxhbmUg
Zm9yCmdyYXBoaWNzLCBsaW5lYXIsIHRpbGVkIGFuZCBzdXBlci10aWxlZCBidWZmZXJzIHN1cHBv
cnQgKG5vIGdyYXBoaWNzCmRlY29tcHJlc3Npb24geWV0KSwgbm8gSERSMTAgYW5kIG5vIHZpZGVv
IHBsYW5lcy4KClZpZGVvIHBsYW5lcyBzdXBwb3J0IGFuZCBIRFIxMCB3aWxsIGJlIGFkZGVkIGlu
IHN1YnNlcXVlbnQgcGF0Y2hlcyBvbmNlCnBlci1wbGFuZSBkZS1nYW1tYS9DU0MvZ2FtbWEgc3Vw
cG9ydCBpcyBpbi4KClNpZ25lZC1vZmYtYnk6IExhdXJlbnRpdSBQYWxjdSA8bGF1cmVudGl1LnBh
bGN1QG54cC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2lteC9LY29uZmlnICAgICAgICAgICAg
fCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2lteC9NYWtlZmlsZSAgICAgICAgICAgfCAgIDEgKwog
ZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL0tjb25maWcgICAgICAgfCAgIDggKwogZHJpdmVycy9n
cHUvZHJtL2lteC9kY3NzL01ha2VmaWxlICAgICAgfCAgIDYgKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtYmxrY3RsLmMgfCAgNzUgKysrCiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3Mv
ZGNzcy1jcnRjLmMgICB8IDIyMyArKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9k
Y3NzLWN0eGxkLmMgIHwgNDQ3ICsrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZGV2LmMgICAgfCAyODYgKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aW14L2Rjc3MvZGNzcy1kZXYuaCAgICB8IDE5NSArKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZHByLmMgICAgfCA1NDggKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHJ2LmMgICAgfCAxODIgKysrKysrKysKIGRyaXZlcnMv
Z3B1L2RybS9pbXgvZGNzcy9kY3NzLWR0Zy5jICAgIHwgNDM4ICsrKysrKysrKysrKysrKysrCiBk
cml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuYyAgICB8IDMyMSArKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuaCAgICB8ICA1MiArKysKIGRyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXBsYW5lLmMgIHwgNDE4ICsrKysrKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zY2FsZXIuYyB8IDgyNiArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXNz
LmMgICAgIHwgMTc5ICsrKysrKysKIDE3IGZpbGVzIGNoYW5nZWQsIDQyMDcgaW5zZXJ0aW9ucygr
KQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL01ha2VmaWxlCiBjcmVh
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtYmxrY3RsLmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jcnRjLmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1jdHhsZC5jCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZGV2LmMKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kZXYuaAogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRwci5jCiBjcmVh
dGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtZHJ2LmMKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kdGcuYwogY3JlYXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWttcy5jCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mta21zLmgKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1wbGFuZS5jCiBjcmVhdGUg
bW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mtc2NhbGVyLmMKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zcy5jCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2lteC9L
Y29uZmlnCmluZGV4IDIwN2JmNzQuLjYyMzEwNDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pbXgvS2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L0tjb25maWcKQEAgLTM5LDMg
KzM5LDUgQEAgY29uZmlnIERSTV9JTVhfSERNSQogCWRlcGVuZHMgb24gRFJNX0lNWAogCWhlbHAK
IAkgIENob29zZSB0aGlzIGlmIHlvdSB3YW50IHRvIHVzZSBIRE1JIG9uIGkuTVg2LgorCitzb3Vy
Y2UgImRyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnIgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2lteC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvTWFrZWZpbGUKaW5k
ZXggMjFjZGNjMi4uYjY0NGRlZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2lteC9NYWtl
ZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L01ha2VmaWxlCkBAIC05LDMgKzksNCBAQCBv
YmotJChDT05GSUdfRFJNX0lNWF9UVkUpICs9IGlteC10dmUubwogb2JqLSQoQ09ORklHX0RSTV9J
TVhfTERCKSArPSBpbXgtbGRiLm8KIAogb2JqLSQoQ09ORklHX0RSTV9JTVhfSERNSSkgKz0gZHdf
aGRtaS1pbXgubworb2JqLSQoQ09ORklHX0RSTV9JTVhfRENTUykgKz0gZGNzcy8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL0tjb25maWcKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLmExODlk
YWMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvS2NvbmZpZwpA
QCAtMCwwICsxLDggQEAKK2NvbmZpZyBEUk1fSU1YX0RDU1MKKwl0cmlzdGF0ZSAiaS5NWDhNUSBE
Q1NTIgorCXNlbGVjdCBSRVNFVF9DT05UUk9MTEVSCisJc2VsZWN0IElNWF9JUlFTVEVFUgorCWRl
cGVuZHMgb24gRFJNICYmIEFSQ0hfTVhDCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgaWYgeW91IGhh
dmUgYSBOWFAgaS5NWDhNUSBiYXNlZCBzeXN0ZW0gYW5kIHdhbnQgdG8gdXNlIHRoZQorCSAgRGlz
cGxheSBDb250cm9sbGVyIFN1YnN5c3RlbS4gVGhpcyBvcHRpb24gZW5hYmxlcyBEQ1NTIHN1cHBv
cnQuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvTWFrZWZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vaW14L2Rjc3MvTWFrZWZpbGUKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAuLjhjN2M4ZGEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14
L2Rjc3MvTWFrZWZpbGUKQEAgLTAsMCArMSw2IEBACitpbXgtZGNzcy1vYmpzIDo9IGRjc3MtZHJ2
Lm8gZGNzcy1kZXYubyBkY3NzLWJsa2N0bC5vIGRjc3MtY3R4bGQubyBkY3NzLWR0Zy5vIFwKKwkJ
CQkgZGNzcy1zcy5vIGRjc3MtZHByLm8gZGNzcy1zY2FsZXIubyBkY3NzLWttcy5vIGRjc3MtY3J0
Yy5vIFwKKwkJCQkgZGNzcy1wbGFuZS5vCisKK29iai0kKENPTkZJR19EUk1fSU1YX0RDU1MpICs9
IGlteC1kY3NzLm8KKwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mt
YmxrY3RsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1ibGtjdGwuYwpuZXcgZmls
ZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uZWU3ZmZhMQotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWJsa2N0bC5jCkBAIC0wLDAgKzEsNzUgQEAK
Ky8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0IDIw
MTkgTlhQLgorICovCisKKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51
eC9vZi5oPgorCisjaW5jbHVkZSAiZGNzcy1kZXYuaCIKKworI2RlZmluZSBEQ1NTX0JMS0NUTF9S
RVNFVF9DVFJMCQkweDAwCisjZGVmaW5lICAgQl9DTEtfUkVTRVROCQkJQklUKDApCisjZGVmaW5l
ICAgQVBCX0NMS19SRVNFVE4JCUJJVCgxKQorI2RlZmluZSAgIFBfQ0xLX1JFU0VUTgkJCUJJVCgy
KQorI2RlZmluZSAgIFJUUl9DTEtfUkVTRVROCQlCSVQoMykKKyNkZWZpbmUgRENTU19CTEtDVExf
Q09OVFJPTDAJCTB4MTAKKyNkZWZpbmUgICBIRE1JX01JUElfQ0xLX1NFTAkJQklUKDApCisjZGVm
aW5lICAgRElTUE1JWF9SRUZDTEtfU0VMX1BPUwk0CisjZGVmaW5lICAgRElTUE1JWF9SRUZDTEtf
U0VMX01BU0sJR0VOTUFTSyg1LCA0KQorI2RlZmluZSAgIERJU1BNSVhfUElYQ0xLX1NFTAkJQklU
KDgpCisjZGVmaW5lICAgSERNSV9TUkNfU0VDVVJFX0VOCQlCSVQoMTYpCisKK3N0cnVjdCBkY3Nz
X2Jsa2N0bCB7CisJc3RydWN0IGRldmljZSAqZGV2OworCXZvaWQgX19pb21lbSAqYmFzZV9yZWc7
CisKKwlib29sIGhkbWlfb3V0cHV0OworfTsKKwordm9pZCBkY3NzX2Jsa2N0bF9jZmcoc3RydWN0
IGRjc3NfYmxrY3RsICpibGtjdGwpCit7CisJaWYgKGJsa2N0bC0+aGRtaV9vdXRwdXQpCisJCWRj
c3Nfd3JpdGVsKDAsIGJsa2N0bC0+YmFzZV9yZWcgKyBEQ1NTX0JMS0NUTF9DT05UUk9MMCk7CisJ
ZWxzZQorCQlkY3NzX3dyaXRlbChESVNQTUlYX1BJWENMS19TRUwsCisJCQkgICAgYmxrY3RsLT5i
YXNlX3JlZyArIERDU1NfQkxLQ1RMX0NPTlRST0wwKTsKKworCWRjc3Nfc2V0KEJfQ0xLX1JFU0VU
TiB8IEFQQl9DTEtfUkVTRVROIHwgUF9DTEtfUkVTRVROIHwgUlRSX0NMS19SRVNFVE4sCisJCSBi
bGtjdGwtPmJhc2VfcmVnICsgRENTU19CTEtDVExfUkVTRVRfQ1RSTCk7Cit9CisKK2ludCBkY3Nz
X2Jsa2N0bF9pbml0KHN0cnVjdCBkY3NzX2RldiAqZGNzcywgdW5zaWduZWQgbG9uZyBibGtjdGxf
YmFzZSkKK3sKKwlzdHJ1Y3QgZGNzc19ibGtjdGwgKmJsa2N0bDsKKworCWJsa2N0bCA9IGRldm1f
a3phbGxvYyhkY3NzLT5kZXYsIHNpemVvZigqYmxrY3RsKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFi
bGtjdGwpCisJCXJldHVybiAtRU5PTUVNOworCisJYmxrY3RsLT5iYXNlX3JlZyA9IGRldm1faW9y
ZW1hcChkY3NzLT5kZXYsIGJsa2N0bF9iYXNlLCBTWl80Syk7CisJaWYgKCFibGtjdGwtPmJhc2Vf
cmVnKSB7CisJCWRldl9lcnIoZGNzcy0+ZGV2LCAidW5hYmxlIHRvIHJlbWFwIEJMSyBDVFJMIGJh
c2VcbiIpOworCQlkZXZtX2tmcmVlKGRjc3MtPmRldiwgYmxrY3RsKTsKKwkJcmV0dXJuIC1FTk9N
RU07CisJfQorCisJZGNzcy0+YmxrY3RsID0gYmxrY3RsOworCWJsa2N0bC0+ZGV2ID0gZGNzcy0+
ZGV2OworCWJsa2N0bC0+aGRtaV9vdXRwdXQgPSBkY3NzLT5oZG1pX291dHB1dDsKKworCWRjc3Nf
YmxrY3RsX2NmZyhibGtjdGwpOworCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgZGNzc19ibGtjdGxf
ZXhpdChzdHJ1Y3QgZGNzc19ibGtjdGwgKmJsa2N0bCkKK3sKKwlkY3NzX2NscihQX0NMS19SRVNF
VE4gfCBSVFJfQ0xLX1JFU0VUTiwKKwkJIGJsa2N0bC0+YmFzZV9yZWcgKyBEQ1NTX0JMS0NUTF9S
RVNFVF9DVFJMKTsKKworCWlmIChibGtjdGwtPmJhc2VfcmVnKQorCQlkZXZtX2lvdW5tYXAoYmxr
Y3RsLT5kZXYsIGJsa2N0bC0+YmFzZV9yZWcpOworCisJZGV2bV9rZnJlZShibGtjdGwtPmRldiwg
YmxrY3RsKTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWNy
dGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWNydGMuYwpuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMC4uNmFiYjQwYwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWNydGMuYwpAQCAtMCwwICsxLDIyMyBAQAorLy8gU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBOWFAu
CisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1QLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNf
aGVscGVyLmg+CisjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgorCisjaW5jbHVkZSAiZGNz
cy1kZXYuaCIKKyNpbmNsdWRlICJkY3NzLWttcy5oIgorCitzdGF0aWMgaW50IGRjc3NfZW5hYmxl
X3ZibGFuayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCit7CisJc3RydWN0IGRjc3NfY3J0YyAqZGNz
c19jcnRjID0gY29udGFpbmVyX29mKGNydGMsIHN0cnVjdCBkY3NzX2NydGMsCisJCQkJCQkgICBi
YXNlKTsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3MgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOwor
CisJaWYgKGRjc3NfY3J0Yy0+aXJxX2VuYWJsZWQpCisJCXJldHVybiAwOworCisJZGNzc19jcnRj
LT5pcnFfZW5hYmxlZCA9IHRydWU7CisKKwlkY3NzX2R0Z192YmxhbmtfaXJxX2VuYWJsZShkY3Nz
LT5kdGcsIHRydWUpOworCisJZGNzc19kdGdfY3R4bGRfa2lja19pcnFfZW5hYmxlKGRjc3MtPmR0
ZywgdHJ1ZSk7CisKKwllbmFibGVfaXJxKGRjc3NfY3J0Yy0+aXJxKTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgdm9pZCBkY3NzX2Rpc2FibGVfdmJsYW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0
YykKK3sKKwlzdHJ1Y3QgZGNzc19jcnRjICpkY3NzX2NydGMgPSBjb250YWluZXJfb2YoY3J0Yywg
c3RydWN0IGRjc3NfY3J0YywKKwkJCQkJCSAgIGJhc2UpOworCXN0cnVjdCBkY3NzX2RldiAqZGNz
cyA9IGRjc3NfY3J0Yy0+YmFzZS5kZXYtPmRldl9wcml2YXRlOworCisJZGlzYWJsZV9pcnFfbm9z
eW5jKGRjc3NfY3J0Yy0+aXJxKTsKKworCWRjc3NfZHRnX3ZibGFua19pcnFfZW5hYmxlKGRjc3Mt
PmR0ZywgZmFsc2UpOworCisJZGNzc19kdGdfY3R4bGRfa2lja19pcnFfZW5hYmxlKGRjc3MtPmR0
ZywgZmFsc2UpOworCisJZGNzc19jcnRjLT5pcnFfZW5hYmxlZCA9IGZhbHNlOworfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGRjc3NfY3J0Y19mdW5jcyA9IHsKKwkuc2V0
X2NvbmZpZyA9IGRybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcsCisJLmRlc3Ryb3kgPSBkcm1f
Y3J0Y19jbGVhbnVwLAorCS5wYWdlX2ZsaXAgPSBkcm1fYXRvbWljX2hlbHBlcl9wYWdlX2ZsaXAs
CisJLnJlc2V0ID0gZHJtX2F0b21pY19oZWxwZXJfY3J0Y19yZXNldCwKKwkuYXRvbWljX2R1cGxp
Y2F0ZV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2NydGNfZHVwbGljYXRlX3N0YXRlLAorCS5h
dG9taWNfZGVzdHJveV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0
ZSwKKwkuZW5hYmxlX3ZibGFuayA9IGRjc3NfZW5hYmxlX3ZibGFuaywKKwkuZGlzYWJsZV92Ymxh
bmsgPSBkY3NzX2Rpc2FibGVfdmJsYW5rLAorfTsKKworc3RhdGljIHZvaWQgZGNzc19jcnRjX2F0
b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJICAgc3RydWN0IGRybV9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKK3sKKwlkcm1fY3J0Y192Ymxhbmtfb24oY3J0Yyk7CisK
KwlzcGluX2xvY2tfaXJxKCZjcnRjLT5kZXYtPmV2ZW50X2xvY2spOworCWlmIChjcnRjLT5zdGF0
ZS0+ZXZlbnQpIHsKKwkJV0FSTl9PTihkcm1fY3J0Y192YmxhbmtfZ2V0KGNydGMpKTsKKwkJZHJt
X2NydGNfYXJtX3ZibGFua19ldmVudChjcnRjLCBjcnRjLT5zdGF0ZS0+ZXZlbnQpOworCQljcnRj
LT5zdGF0ZS0+ZXZlbnQgPSBOVUxMOworCX0KKwlzcGluX3VubG9ja19pcnEoJmNydGMtPmRldi0+
ZXZlbnRfbG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfY3J0Y19hdG9taWNfZmx1c2goc3Ry
dWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGUpCit7CisJc3RydWN0IGRjc3NfY3J0YyAqZGNzc19jcnRjID0gY29udGFpbmVyX29m
KGNydGMsIHN0cnVjdCBkY3NzX2NydGMsCisJCQkJCQkgICBiYXNlKTsKKwlzdHJ1Y3QgZGNzc19k
ZXYgKmRjc3MgPSBkY3NzX2NydGMtPmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKKworCWlmIChkY3Nz
X2R0Z19pc19lbmFibGVkKGRjc3MtPmR0ZykpCisJCWRjc3NfY3R4bGRfZW5hYmxlKGRjc3MtPmN0
eGxkKTsKK30KKworc3RhdGljIHZvaWQgZGNzc19jcnRjX2F0b21pY19lbmFibGUoc3RydWN0IGRy
bV9jcnRjICpjcnRjLAorCQkJCSAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0
YXRlKQoreworCXN0cnVjdCBkY3NzX2NydGMgKmRjc3NfY3J0YyA9IGNvbnRhaW5lcl9vZihjcnRj
LCBzdHJ1Y3QgZGNzc19jcnRjLAorCQkJCQkJICAgYmFzZSk7CisJc3RydWN0IGRjc3NfZGV2ICpk
Y3NzID0gZGNzc19jcnRjLT5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKm1vZGUgPSAmY3J0Yy0+c3RhdGUtPmFkanVzdGVkX21vZGU7CisJc3RydWN0IHZp
ZGVvbW9kZSB2bTsKKworCWRybV9kaXNwbGF5X21vZGVfdG9fdmlkZW9tb2RlKG1vZGUsICZ2bSk7
CisKKwlwbV9ydW50aW1lX2dldF9zeW5jKGRjc3MtPmRldik7CisKKwlkY3NzX2R0Z19jdHhsZF9r
aWNrX2lycV9lbmFibGUoZGNzcy0+ZHRnLCB0cnVlKTsKKworCXZtLnBpeGVsY2xvY2sgPSBtb2Rl
LT5jcnRjX2Nsb2NrICogMTAwMDsKKworCWRjc3NfZHRnX3N5bmNfc2V0KGRjc3MtPmR0ZywgJnZt
KTsKKworCWRjc3Nfc3Nfc3Vic2FtX3NldChkY3NzLT5zcyk7CisJZGNzc19zc19zeW5jX3NldChk
Y3NzLT5zcywgJnZtLCBtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfUEhTWU5DLAorCQkJIG1v
ZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19QVlNZTkMpOworCisJZGNzc19kdGdfY3NzX3NldChk
Y3NzLT5kdGcpOworCisJZGNzc19zc19lbmFibGUoZGNzcy0+c3MpOworCWRjc3NfZHRnX2VuYWJs
ZShkY3NzLT5kdGcsIHRydWUsIE5VTEwpOworCWRjc3NfY3R4bGRfZW5hYmxlKGRjc3MtPmN0eGxk
KTsKKworCXJlaW5pdF9jb21wbGV0aW9uKCZkY3NzX2NydGMtPmVuX2NvbXBsZXRpb24pOworCXdh
aXRfZm9yX2NvbXBsZXRpb25fdGltZW91dCgmZGNzc19jcnRjLT5lbl9jb21wbGV0aW9uLAorCQkJ
CSAgICBtc2Vjc190b19qaWZmaWVzKDUwMCkpOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2NydGNf
YXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgICAgc3RydWN0IGRy
bV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZGNzc19jcnRjICpkY3Nz
X2NydGMgPSBjb250YWluZXJfb2YoY3J0Yywgc3RydWN0IGRjc3NfY3J0YywKKwkJCQkJCSAgIGJh
c2UpOworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRjc3NfY3J0Yy0+YmFzZS5kZXYtPmRldl9w
cml2YXRlOworCisJZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZXNfb25fY3J0YyhvbGRf
Y3J0Y19zdGF0ZSwgZmFsc2UpOworCisJc3Bpbl9sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9s
b2NrKTsKKwlpZiAoY3J0Yy0+c3RhdGUtPmV2ZW50KSB7CisJCWRybV9jcnRjX3NlbmRfdmJsYW5r
X2V2ZW50KGNydGMsIGNydGMtPnN0YXRlLT5ldmVudCk7CisJCWNydGMtPnN0YXRlLT5ldmVudCA9
IE5VTEw7CisJfQorCXNwaW5fdW5sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKKwor
CWRjc3NfZHRnX2N0eGxkX2tpY2tfaXJxX2VuYWJsZShkY3NzLT5kdGcsIHRydWUpOworCisJZGNz
c19zc19kaXNhYmxlKGRjc3MtPnNzKTsKKwlkY3NzX2R0Z19lbmFibGUoZGNzcy0+ZHRnLCBmYWxz
ZSwgJmRjc3NfY3J0Yy0+ZGlzX2NvbXBsZXRpb24pOworCWRjc3NfY3R4bGRfZW5hYmxlKGRjc3Mt
PmN0eGxkKTsKKworCXJlaW5pdF9jb21wbGV0aW9uKCZkY3NzX2NydGMtPmRpc19jb21wbGV0aW9u
KTsKKwl3YWl0X2Zvcl9jb21wbGV0aW9uX3RpbWVvdXQoJmRjc3NfY3J0Yy0+ZGlzX2NvbXBsZXRp
b24sCisJCQkJICAgIG1zZWNzX3RvX2ppZmZpZXMoMTAwKSk7CisKKwlkcm1fY3J0Y192Ymxhbmtf
b2ZmKGNydGMpOworCisJZGNzc19kdGdfY3R4bGRfa2lja19pcnFfZW5hYmxlKGRjc3MtPmR0Zywg
ZmFsc2UpOworCisJcG1fcnVudGltZV9wdXRfc3luYyhkY3NzLT5kZXYpOworfQorCitzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9jcnRjX2hlbHBlcl9mdW5jcyBkY3NzX2hlbHBlcl9mdW5jcyA9IHsK
KwkuYXRvbWljX2JlZ2luID0gZGNzc19jcnRjX2F0b21pY19iZWdpbiwKKwkuYXRvbWljX2ZsdXNo
ID0gZGNzc19jcnRjX2F0b21pY19mbHVzaCwKKwkuYXRvbWljX2VuYWJsZSA9IGRjc3NfY3J0Y19h
dG9taWNfZW5hYmxlLAorCS5hdG9taWNfZGlzYWJsZSA9IGRjc3NfY3J0Y19hdG9taWNfZGlzYWJs
ZSwKK307CisKK3N0YXRpYyBpcnFyZXR1cm5fdCBkY3NzX2NydGNfaXJxX2hhbmRsZXIoaW50IGly
cSwgdm9pZCAqZGV2X2lkKQoreworCXN0cnVjdCBkY3NzX2NydGMgKmRjc3NfY3J0YyA9IGRldl9p
ZDsKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3MgPSBkY3NzX2NydGMtPmJhc2UuZGV2LT5kZXZfcHJp
dmF0ZTsKKworCWlmICghZGNzc19kdGdfdmJsYW5rX2lycV92YWxpZChkY3NzLT5kdGcpKQorCQly
ZXR1cm4gSVJRX0hBTkRMRUQ7CisKKwljb21wbGV0ZSgmZGNzc19jcnRjLT5lbl9jb21wbGV0aW9u
KTsKKworCWlmIChkY3NzX2N0eGxkX2lzX2ZsdXNoZWQoZGNzcy0+Y3R4bGQpKQorCQlkcm1fY3J0
Y19oYW5kbGVfdmJsYW5rKCZkY3NzX2NydGMtPmJhc2UpOworCisJZGNzc19kdGdfdmJsYW5rX2ly
cV9jbGVhcihkY3NzLT5kdGcpOworCisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCitpbnQgZGNz
c19jcnRjX2luaXQoc3RydWN0IGRjc3NfY3J0YyAqY3J0Yywgc3RydWN0IGRybV9kZXZpY2UgKmRy
bSkKK3sKKwlzdHJ1Y3QgZGNzc19kZXYgKmRjc3MgPSBkcm0tPmRldl9wcml2YXRlOworCXN0cnVj
dCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYgPSB0b19wbGF0Zm9ybV9kZXZpY2UoZGNzcy0+ZGV2KTsK
KwlpbnQgcmV0OworCisJY3J0Yy0+cGxhbmVbMF0gPSBkY3NzX3BsYW5lX2luaXQoZHJtLCBkcm1f
Y3J0Y19tYXNrKCZjcnRjLT5iYXNlKSwKKwkJCQkJIERSTV9QTEFORV9UWVBFX1BSSU1BUlksIDAp
OworCWlmIChJU19FUlIoY3J0Yy0+cGxhbmVbMF0pKQorCQlyZXR1cm4gUFRSX0VSUihjcnRjLT5w
bGFuZVswXSk7CisKKwljcnRjLT5iYXNlLnBvcnQgPSBkY3NzLT5vZl9wb3J0OworCisJZHJtX2Ny
dGNfaGVscGVyX2FkZCgmY3J0Yy0+YmFzZSwgJmRjc3NfaGVscGVyX2Z1bmNzKTsKKwlyZXQgPSBk
cm1fY3J0Y19pbml0X3dpdGhfcGxhbmVzKGRybSwgJmNydGMtPmJhc2UsICZjcnRjLT5wbGFuZVsw
XS0+YmFzZSwKKwkJCQkJTlVMTCwgJmRjc3NfY3J0Y19mdW5jcywgTlVMTCk7CisJaWYgKHJldCkg
eworCQlkZXZfZXJyKGRjc3MtPmRldiwgImZhaWxlZCB0byBpbml0IGNydGNcbiIpOworCQlyZXR1
cm4gcmV0OworCX0KKworCWNydGMtPmlycSA9IHBsYXRmb3JtX2dldF9pcnFfYnluYW1lKHBkZXYs
ICJ2YmxhbmsiKTsKKwlpZiAoY3J0Yy0+aXJxIDwgMCkgeworCQlkZXZfZXJyKGRjc3MtPmRldiwg
InVuYWJsZSB0byBnZXQgdmJsYW5rIGludGVycnVwdFxuIik7CisJCXJldHVybiBjcnRjLT5pcnE7
CisJfQorCisJaW5pdF9jb21wbGV0aW9uKCZjcnRjLT5lbl9jb21wbGV0aW9uKTsKKwlpbml0X2Nv
bXBsZXRpb24oJmNydGMtPmRpc19jb21wbGV0aW9uKTsKKworCXJldCA9IGRldm1fcmVxdWVzdF9p
cnEoZGNzcy0+ZGV2LCBjcnRjLT5pcnEsIGRjc3NfY3J0Y19pcnFfaGFuZGxlciwKKwkJCSAgICAg
ICBJUlFGX1RSSUdHRVJfUklTSU5HLCAiZGNzc19kcm0iLCBjcnRjKTsKKwlpZiAocmV0KSB7CisJ
CWRldl9lcnIoZGNzcy0+ZGV2LCAiaXJxIHJlcXVlc3QgZmFpbGVkIHdpdGggJWQuXG4iLCByZXQp
OworCQlyZXR1cm4gcmV0OworCX0KKworCWRpc2FibGVfaXJxKGNydGMtPmlycSk7CisKKwlyZXR1
cm4gMDsKK30KKwordm9pZCBkY3NzX2NydGNfZGVpbml0KHN0cnVjdCBkY3NzX2NydGMgKmNydGMs
IHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCit7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0gZHJt
LT5kZXZfcHJpdmF0ZTsKKworCWRldm1fZnJlZV9pcnEoZGNzcy0+ZGV2LCBjcnRjLT5pcnEsIGNy
dGMpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtY3R4bGQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWN0eGxkLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAuLjRmZTM1YjJiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtY3R4bGQuYwpAQCAtMCwwICsxLDQ0NyBAQAorLy8gU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisgKiBDb3B5cmlnaHQgMjAxOSBOWFAu
CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+CisjaW5jbHVkZSA8bGludXgvZG1hLW1h
cHBpbmcuaD4KKyNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9w
bGF0Zm9ybV9kZXZpY2UuaD4KKworI2luY2x1ZGUgImRjc3MtZGV2LmgiCisKKyNkZWZpbmUgRENT
U19DVFhMRF9ERVZOQU1FCQkiZGNzc19jdHhsZCIKKworI2RlZmluZSBEQ1NTX0NUWExEX0NPTlRS
T0xfU1RBVFVTCTB4MAorI2RlZmluZSAgIENUWExEX0VOQUJMRQkJCUJJVCgwKQorI2RlZmluZSAg
IEFSQl9TRUwJCQlCSVQoMSkKKyNkZWZpbmUgICBSRF9FUlJfRU4JCQlCSVQoMikKKyNkZWZpbmUg
ICBEQl9DT01QX0VOCQkJQklUKDMpCisjZGVmaW5lICAgU0JfSFBfQ09NUF9FTgkJCUJJVCg0KQor
I2RlZmluZSAgIFNCX0xQX0NPTVBfRU4JCQlCSVQoNSkKKyNkZWZpbmUgICBEQl9QRU5EX1NCX1JF
Q19FTgkJQklUKDYpCisjZGVmaW5lICAgU0JfUEVORF9ESVNQX0FDVElWRV9FTglCSVQoNykKKyNk
ZWZpbmUgICBBSEJfRVJSX0VOCQkJQklUKDgpCisjZGVmaW5lICAgUkRfRVJSCQkJQklUKDE2KQor
I2RlZmluZSAgIERCX0NPTVAJCQlCSVQoMTcpCisjZGVmaW5lICAgU0JfSFBfQ09NUAkJCUJJVCgx
OCkKKyNkZWZpbmUgICBTQl9MUF9DT01QCQkJQklUKDE5KQorI2RlZmluZSAgIERCX1BFTkRfU0Jf
UkVDCQlCSVQoMjApCisjZGVmaW5lICAgU0JfUEVORF9ESVNQX0FDVElWRQkJQklUKDIxKQorI2Rl
ZmluZSAgIEFIQl9FUlIJCQlCSVQoMjIpCisjZGVmaW5lIERDU1NfQ1RYTERfREJfQkFTRV9BRERS
CQkweDEwCisjZGVmaW5lIERDU1NfQ1RYTERfREJfQ09VTlQJCTB4MTQKKyNkZWZpbmUgRENTU19D
VFhMRF9TQl9CQVNFX0FERFIJCTB4MTgKKyNkZWZpbmUgRENTU19DVFhMRF9TQl9DT1VOVAkJMHgx
QworI2RlZmluZSAgIFNCX0hQX0NPVU5UX1BPUwkJMAorI2RlZmluZSAgIFNCX0hQX0NPVU5UX01B
U0sJCTB4ZmZmZgorI2RlZmluZSAgIFNCX0xQX0NPVU5UX1BPUwkJMTYKKyNkZWZpbmUgICBTQl9M
UF9DT1VOVF9NQVNLCQkweGZmZmYwMDAwCisjZGVmaW5lIERDU1NfQUhCX0VSUl9BRERSCQkweDIw
CisKKyNkZWZpbmUgQ1RYTERfSVJRX05BTUUJCQkiY3R4X2xkIgorI2RlZmluZSBDVFhMRF9JUlFf
Q09NUExFVElPTgkJKERCX0NPTVAgfCBTQl9IUF9DT01QIHwgU0JfTFBfQ09NUCkKKyNkZWZpbmUg
Q1RYTERfSVJRX0VSUk9SCQkJKFJEX0VSUiB8IERCX1BFTkRfU0JfUkVDIHwgQUhCX0VSUikKKwor
LyogVGhlIGZvbGxvd2luZyBzaXplcyBhcmUgaW4gY29udGV4dCBsb2FkZXIgZW50cmllcywgOCBi
eXRlcyBlYWNoLiAqLworI2RlZmluZSBDVFhMRF9EQl9DVFhfRU5UUklFUwkJMTAyNAkvKiBtYXgg
NjU1MzYgKi8KKyNkZWZpbmUgQ1RYTERfU0JfTFBfQ1RYX0VOVFJJRVMJCTEwMjQwCS8qIG1heCA2
NTUzNiAqLworI2RlZmluZSBDVFhMRF9TQl9IUF9DVFhfRU5UUklFUwkJMjAwMDAJLyogbWF4IDY1
NTM2ICovCisjZGVmaW5lIENUWExEX1NCX0NUWF9FTlRSSUVTCQkoQ1RYTERfU0JfTFBfQ1RYX0VO
VFJJRVMgKyBcCisJCQkJCSBDVFhMRF9TQl9IUF9DVFhfRU5UUklFUykKKworLyogU2l6ZXMsIGlu
IGVudHJpZXMsIG9mIHRoZSBEQiwgU0JfSFAgYW5kIFNCX0xQIGNvbnRleHQgcmVnaW9ucy4gKi8K
K3N0YXRpYyB1MTYgZGNzc19jdHhsZF9jdHhfc2l6ZVszXSA9IHsKKwlDVFhMRF9EQl9DVFhfRU5U
UklFUywKKwlDVFhMRF9TQl9IUF9DVFhfRU5UUklFUywKKwlDVFhMRF9TQl9MUF9DVFhfRU5UUklF
UworfTsKKworLyogdGhpcyByZXByZXNlbnRzIGFuIGVudHJ5IGluIHRoZSBjb250ZXh0IGxvYWRl
ciBtYXAgKi8KK3N0cnVjdCBkY3NzX2N0eGxkX2l0ZW0geworCXUzMiB2YWw7CisJdTMyIG9mczsK
K307CisKKyNkZWZpbmUgQ1RYX0lURU1fU0laRQkJCXNpemVvZihzdHJ1Y3QgZGNzc19jdHhsZF9p
dGVtKQorCitzdHJ1Y3QgZGNzc19jdHhsZCB7CisJc3RydWN0IGRldmljZSAqZGV2OworCXZvaWQg
X19pb21lbSAqY3R4bGRfcmVnOworCWludCBpcnE7CisJYm9vbCBpcnFfZW47CisKKwlzdHJ1Y3Qg
ZGNzc19jdHhsZF9pdGVtICpkYlsyXTsKKwlzdHJ1Y3QgZGNzc19jdHhsZF9pdGVtICpzYl9ocFsy
XTsKKwlzdHJ1Y3QgZGNzc19jdHhsZF9pdGVtICpzYl9scFsyXTsKKworCWRtYV9hZGRyX3QgZGJf
cGFkZHJbMl07CisJZG1hX2FkZHJfdCBzYl9wYWRkclsyXTsKKworCXUxNiBjdHhfc2l6ZVsyXVsz
XTsgLyogaG9sZHMgdGhlIHNpemVzIG9mIERCLCBTQl9IUCBhbmQgU0JfTFAgY3R4ICovCisJdTgg
Y3VycmVudF9jdHg7CisKKwlib29sIGluX3VzZTsKKwlib29sIGFybWVkOworCisJc3BpbmxvY2tf
dCBsb2NrOyAvKiBwcm90ZWN0cyBjb25jdXJlbnQgYWNjZXNzIHRvIHByaXZhdGUgZGF0YSAqLwor
CisJdm9pZCAoKmR0Z19kaXNhYmxlX2NiKSh2b2lkICpkYXRhKTsKKwl2b2lkICpkdGdfZGlzYWJs
ZV9kYXRhOworfTsKKworc3RhdGljIGludCBfX2Rjc3NfY3R4bGRfZW5hYmxlKHN0cnVjdCBkY3Nz
X2N0eGxkICpjdHhsZCk7CisKK3N0YXRpYyBpcnFyZXR1cm5fdCBkY3NzX2N0eGxkX2lycV9oYW5k
bGVyKGludCBpcnEsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkID0g
ZGF0YTsKKwl1MzIgaXJxX3N0YXR1czsKKworCWlycV9zdGF0dXMgPSBkY3NzX3JlYWRsKGN0eGxk
LT5jdHhsZF9yZWcgKyBEQ1NTX0NUWExEX0NPTlRST0xfU1RBVFVTKTsKKworCWlmIChpcnFfc3Rh
dHVzICYgQ1RYTERfSVJRX0NPTVBMRVRJT04gJiYKKwkgICAgIShpcnFfc3RhdHVzICYgQ1RYTERf
RU5BQkxFKSAmJiBjdHhsZC0+aW5fdXNlKSB7CisJCWN0eGxkLT5pbl91c2UgPSBmYWxzZTsKKwor
CQlpZiAoY3R4bGQtPmR0Z19kaXNhYmxlX2NiKSB7CisJCQljdHhsZC0+ZHRnX2Rpc2FibGVfY2Io
Y3R4bGQtPmR0Z19kaXNhYmxlX2RhdGEpOworCQkJY3R4bGQtPmR0Z19kaXNhYmxlX2NiID0gTlVM
TDsKKwkJCWN0eGxkLT5kdGdfZGlzYWJsZV9kYXRhID0gTlVMTDsKKwkJfQorCX0gZWxzZSBpZiAo
aXJxX3N0YXR1cyAmIENUWExEX0lSUV9FUlJPUikgeworCQkvKgorCQkgKiBFeGNlcHQgZm9yIHRo
cm93aW5nIGFuIGVycm9yIG1lc3NhZ2UgYW5kIGNsZWFyaW5nIHRoZSBzdGF0dXMKKwkJICogcmVn
aXN0ZXIsIHRoZXJlJ3Mgbm90IG11Y2ggd2UgY2FuIGRvIGhlcmUuCisJCSAqLworCQlkZXZfZXJy
KGN0eGxkLT5kZXYsICJjdHhsZDogZXJyb3IgZW5jb3VudGVyZWQ6ICUwOHhcbiIsCisJCQlpcnFf
c3RhdHVzKTsKKwkJZGV2X2VycihjdHhsZC0+ZGV2LCAiY3R4bGQ6IGRiPSVkLCBzYl9ocD0lZCwg
c2JfbHA9JWRcbiIsCisJCQljdHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJlbnRfY3R4IF4gMV1b
Q1RYX0RCXSwKKwkJCWN0eGxkLT5jdHhfc2l6ZVtjdHhsZC0+Y3VycmVudF9jdHggXiAxXVtDVFhf
U0JfSFBdLAorCQkJY3R4bGQtPmN0eF9zaXplW2N0eGxkLT5jdXJyZW50X2N0eCBeIDFdW0NUWF9T
Ql9MUF0pOworCX0KKworCWRjc3NfY2xyKGlycV9zdGF0dXMgJiAoQ1RYTERfSVJRX0VSUk9SIHwg
Q1RYTERfSVJRX0NPTVBMRVRJT04pLAorCQkgY3R4bGQtPmN0eGxkX3JlZyArIERDU1NfQ1RYTERf
Q09OVFJPTF9TVEFUVVMpOworCisJcmV0dXJuIElSUV9IQU5ETEVEOworfQorCitzdGF0aWMgaW50
IGRjc3NfY3R4bGRfaXJxX2NvbmZpZyhzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQsCisJCQkJIHN0
cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJaW50IHJldDsKKworCWN0eGxkLT5pcnEg
PSBwbGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2LCBDVFhMRF9JUlFfTkFNRSk7CisJaWYgKGN0
eGxkLT5pcnEgPCAwKSB7CisJCWRldl9lcnIoY3R4bGQtPmRldiwgImN0eGxkOiBjYW4ndCBnZXQg
aXJxIG51bWJlclxuIik7CisJCXJldHVybiBjdHhsZC0+aXJxOworCX0KKworCXJldCA9IGRldm1f
cmVxdWVzdF9pcnEoY3R4bGQtPmRldiwgY3R4bGQtPmlycSwKKwkJCSAgICAgICBkY3NzX2N0eGxk
X2lycV9oYW5kbGVyLAorCQkJICAgICAgIElSUUZfT05FU0hPVCB8IElSUUZfVFJJR0dFUl9ISUdI
LAorCQkJICAgICAgIERDU1NfQ1RYTERfREVWTkFNRSwgY3R4bGQpOworCWlmIChyZXQpIHsKKwkJ
ZGV2X2VycihjdHhsZC0+ZGV2LCAiY3R4bGQ6IGlycSByZXF1ZXN0IGZhaWxlZC5cbiIpOworCQly
ZXR1cm4gcmV0OworCX0KKworCWN0eGxkLT5pcnFfZW4gPSB0cnVlOworCisJcmV0dXJuIDA7Cit9
CisKK3ZvaWQgZGNzc19jdHhsZF9od19jZmcoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKQorewor
CWRjc3Nfd3JpdGVsKFJEX0VSUl9FTiB8IFNCX0hQX0NPTVBfRU4gfAorCQkgICAgREJfUEVORF9T
Ql9SRUNfRU4gfCBBSEJfRVJSX0VOIHwgUkRfRVJSIHwgQUhCX0VSUiwKKwkJICAgIGN0eGxkLT5j
dHhsZF9yZWcgKyBEQ1NTX0NUWExEX0NPTlRST0xfU1RBVFVTKTsKK30KKworc3RhdGljIHZvaWQg
ZGNzc19jdHhsZF9mcmVlX2N0eChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpCit7CisJc3RydWN0
IGRjc3NfY3R4bGRfaXRlbSAqY3R4OworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IDI7IGkr
KykgeworCQlpZiAoY3R4bGQtPmRiW2ldKSB7CisJCQlkbWFtX2ZyZWVfY29oZXJlbnQoY3R4bGQt
PmRldiwKKwkJCQkJICAgQ1RYTERfREJfQ1RYX0VOVFJJRVMgKiBzaXplb2YoKmN0eCksCisJCQkJ
CSAgIGN0eGxkLT5kYltpXSwgY3R4bGQtPmRiX3BhZGRyW2ldKTsKKwkJCWN0eGxkLT5kYltpXSA9
IE5VTEw7CisJCQljdHhsZC0+ZGJfcGFkZHJbaV0gPSAwOworCQl9CisKKwkJaWYgKGN0eGxkLT5z
Yl9ocFtpXSkgeworCQkJZG1hbV9mcmVlX2NvaGVyZW50KGN0eGxkLT5kZXYsCisJCQkJCSAgIENU
WExEX1NCX0NUWF9FTlRSSUVTICogc2l6ZW9mKCpjdHgpLAorCQkJCQkgICBjdHhsZC0+c2JfaHBb
aV0sIGN0eGxkLT5zYl9wYWRkcltpXSk7CisJCQljdHhsZC0+c2JfaHBbaV0gPSBOVUxMOworCQkJ
Y3R4bGQtPnNiX3BhZGRyW2ldID0gMDsKKwkJfQorCX0KK30KKworc3RhdGljIGludCBkY3NzX2N0
eGxkX2FsbG9jX2N0eChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpCit7CisJc3RydWN0IGRjc3Nf
Y3R4bGRfaXRlbSAqY3R4OworCWludCBpOworCWRtYV9hZGRyX3QgZG1hX2hhbmRsZTsKKworCWZv
ciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKKwkJY3R4ID0gZG1hbV9hbGxvY19jb2hlcmVudChjdHhs
ZC0+ZGV2LAorCQkJCQkgIENUWExEX0RCX0NUWF9FTlRSSUVTICogc2l6ZW9mKCpjdHgpLAorCQkJ
CQkgICZkbWFfaGFuZGxlLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFjdHgpCisJCQlyZXR1cm4gLUVO
T01FTTsKKworCQljdHhsZC0+ZGJbaV0gPSBjdHg7CisJCWN0eGxkLT5kYl9wYWRkcltpXSA9IGRt
YV9oYW5kbGU7CisKKwkJY3R4ID0gZG1hbV9hbGxvY19jb2hlcmVudChjdHhsZC0+ZGV2LAorCQkJ
CQkgIENUWExEX1NCX0NUWF9FTlRSSUVTICogc2l6ZW9mKCpjdHgpLAorCQkJCQkgICZkbWFfaGFu
ZGxlLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFjdHgpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlj
dHhsZC0+c2JfaHBbaV0gPSBjdHg7CisJCWN0eGxkLT5zYl9scFtpXSA9IGN0eCArIENUWExEX1NC
X0hQX0NUWF9FTlRSSUVTOworCisJCWN0eGxkLT5zYl9wYWRkcltpXSA9IGRtYV9oYW5kbGU7CisJ
fQorCisJcmV0dXJuIDA7Cit9CisKK2ludCBkY3NzX2N0eGxkX2luaXQoc3RydWN0IGRjc3NfZGV2
ICpkY3NzLCB1bnNpZ25lZCBsb25nIGN0eGxkX2Jhc2UpCit7CisJc3RydWN0IGRjc3NfY3R4bGQg
KmN0eGxkOworCWludCByZXQ7CisKKwljdHhsZCA9IGRldm1fa3phbGxvYyhkY3NzLT5kZXYsIHNp
emVvZihzdHJ1Y3QgZGNzc19jdHhsZCksCisJCQkgICAgIEdGUF9LRVJORUwpOworCWlmICghY3R4
bGQpCisJCXJldHVybiAtRU5PTUVNOworCisJZGNzcy0+Y3R4bGQgPSBjdHhsZDsKKwljdHhsZC0+
ZGV2ID0gZGNzcy0+ZGV2OworCisJc3Bpbl9sb2NrX2luaXQoJmN0eGxkLT5sb2NrKTsKKworCXJl
dCA9IGRjc3NfY3R4bGRfYWxsb2NfY3R4KGN0eGxkKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIo
ZGNzcy0+ZGV2LCAiY3R4bGQ6IGNhbm5vdCBhbGxvY2F0ZSBjb250ZXh0IG1lbW9yeS5cbiIpOwor
CQlnb3RvIGVycjsKKwl9CisKKwljdHhsZC0+Y3R4bGRfcmVnID0gZGV2bV9pb3JlbWFwKGRjc3Mt
PmRldiwgY3R4bGRfYmFzZSwgU1pfNEspOworCWlmICghY3R4bGQtPmN0eGxkX3JlZykgeworCQlk
ZXZfZXJyKGRjc3MtPmRldiwgImN0eGxkOiB1bmFibGUgdG8gcmVtYXAgY3R4bGQgYmFzZVxuIik7
CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZXJyOworCX0KKworCXJldCA9IGRjc3NfY3R4bGRf
aXJxX2NvbmZpZyhjdHhsZCwgdG9fcGxhdGZvcm1fZGV2aWNlKGRjc3MtPmRldikpOworCWlmIChy
ZXQpCisJCWdvdG8gZXJyX2lycTsKKworCWRjc3NfY3R4bGRfaHdfY2ZnKGN0eGxkKTsKKworCXJl
dHVybiAwOworCitlcnJfaXJxOgorCWRldm1faW91bm1hcChjdHhsZC0+ZGV2LCBjdHhsZC0+Y3R4
bGRfcmVnKTsKKworZXJyOgorCWRjc3NfY3R4bGRfZnJlZV9jdHgoY3R4bGQpOworCWRldm1fa2Zy
ZWUoY3R4bGQtPmRldiwgY3R4bGQpOworCisJcmV0dXJuIHJldDsKK30KKwordm9pZCBkY3NzX2N0
eGxkX2V4aXQoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKQoreworCWRldm1fZnJlZV9pcnEoY3R4
bGQtPmRldiwgY3R4bGQtPmlycSwgY3R4bGQpOworCisJaWYgKGN0eGxkLT5jdHhsZF9yZWcpCisJ
CWRldm1faW91bm1hcChjdHhsZC0+ZGV2LCBjdHhsZC0+Y3R4bGRfcmVnKTsKKworCWRjc3NfY3R4
bGRfZnJlZV9jdHgoY3R4bGQpOworCWRldm1fa2ZyZWUoY3R4bGQtPmRldiwgY3R4bGQpOworfQor
CitzdGF0aWMgaW50IF9fZGNzc19jdHhsZF9lbmFibGUoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxk
KQoreworCWludCBjdXJyX2N0eCA9IGN0eGxkLT5jdXJyZW50X2N0eDsKKwl1MzIgZGJfYmFzZSwg
c2JfYmFzZSwgc2JfY291bnQ7CisJdTMyIHNiX2hwX2NudCwgc2JfbHBfY250LCBkYl9jbnQ7CisJ
c3RydWN0IGRjc3NfZGV2ICpkY3NzID0gZGNzc19kcnZfZGV2X3RvX2Rjc3MoY3R4bGQtPmRldik7
CisKKwlkY3NzX2Rwcl93cml0ZV9zeXNjdHJsKGRjc3MtPmRwcik7CisKKwlkY3NzX3NjYWxlcl93
cml0ZV9zY2xjdHJsKGRjc3MtPnNjYWxlcik7CisKKwlzYl9ocF9jbnQgPSBjdHhsZC0+Y3R4X3Np
emVbY3Vycl9jdHhdW0NUWF9TQl9IUF07CisJc2JfbHBfY250ID0gY3R4bGQtPmN0eF9zaXplW2N1
cnJfY3R4XVtDVFhfU0JfTFBdOworCWRiX2NudCA9IGN0eGxkLT5jdHhfc2l6ZVtjdXJyX2N0eF1b
Q1RYX0RCXTsKKworCS8qIG1ha2Ugc3VyZSBTQl9MUCBjb250ZXh0IGFyZWEgY29tZXMgYWZ0ZXIg
U0JfSFAgKi8KKwlpZiAoc2JfbHBfY250ICYmCisJICAgIGN0eGxkLT5zYl9scFtjdXJyX2N0eF0g
IT0gY3R4bGQtPnNiX2hwW2N1cnJfY3R4XSArIHNiX2hwX2NudCkgeworCQlzdHJ1Y3QgZGNzc19j
dHhsZF9pdGVtICpzYl9scF9hZGp1c3RlZDsKKworCQlzYl9scF9hZGp1c3RlZCA9IGN0eGxkLT5z
Yl9ocFtjdXJyX2N0eF0gKyBzYl9ocF9jbnQ7CisKKwkJbWVtY3B5KHNiX2xwX2FkanVzdGVkLCBj
dHhsZC0+c2JfbHBbY3Vycl9jdHhdLAorCQkgICAgICAgc2JfbHBfY250ICogQ1RYX0lURU1fU0la
RSk7CisJfQorCisJZGJfYmFzZSA9IGRiX2NudCA/IGN0eGxkLT5kYl9wYWRkcltjdXJyX2N0eF0g
OiAwOworCisJZGNzc193cml0ZWwoZGJfYmFzZSwgY3R4bGQtPmN0eGxkX3JlZyArIERDU1NfQ1RY
TERfREJfQkFTRV9BRERSKTsKKwlkY3NzX3dyaXRlbChkYl9jbnQsIGN0eGxkLT5jdHhsZF9yZWcg
KyBEQ1NTX0NUWExEX0RCX0NPVU5UKTsKKworCWlmIChzYl9ocF9jbnQpCisJCXNiX2NvdW50ID0g
KChzYl9ocF9jbnQgPDwgU0JfSFBfQ09VTlRfUE9TKSAmIFNCX0hQX0NPVU5UX01BU0spIHwKKwkJ
CSAgICgoc2JfbHBfY250IDw8IFNCX0xQX0NPVU5UX1BPUykgJiBTQl9MUF9DT1VOVF9NQVNLKTsK
KwllbHNlCisJCXNiX2NvdW50ID0gKHNiX2xwX2NudCA8PCBTQl9IUF9DT1VOVF9QT1MpICYgU0Jf
SFBfQ09VTlRfTUFTSzsKKworCXNiX2Jhc2UgPSBzYl9jb3VudCA/IGN0eGxkLT5zYl9wYWRkcltj
dXJyX2N0eF0gOiAwOworCisJZGNzc193cml0ZWwoc2JfYmFzZSwgY3R4bGQtPmN0eGxkX3JlZyAr
IERDU1NfQ1RYTERfU0JfQkFTRV9BRERSKTsKKwlkY3NzX3dyaXRlbChzYl9jb3VudCwgY3R4bGQt
PmN0eGxkX3JlZyArIERDU1NfQ1RYTERfU0JfQ09VTlQpOworCisJLyogZW5hYmxlIHRoZSBjb250
ZXh0IGxvYWRlciAqLworCWRjc3Nfc2V0KENUWExEX0VOQUJMRSwgY3R4bGQtPmN0eGxkX3JlZyAr
IERDU1NfQ1RYTERfQ09OVFJPTF9TVEFUVVMpOworCisJY3R4bGQtPmluX3VzZSA9IHRydWU7CisK
KwkvKgorCSAqIFRvZ2dsZSB0aGUgY3VycmVudCBjb250ZXh0IHRvIHRoZSBhbHRlcm5hdGUgb25l
IHNvIHRoYXQgYW55IHVwZGF0ZXMKKwkgKiBpbiB0aGUgbW9kdWxlcycgc2V0dGluZ3MgdGFrZSBw
bGFjZSB0aGVyZS4KKwkgKi8KKwljdHhsZC0+Y3VycmVudF9jdHggXj0gMTsKKworCWN0eGxkLT5j
dHhfc2l6ZVtjdHhsZC0+Y3VycmVudF9jdHhdW0NUWF9EQl0gPSAwOworCWN0eGxkLT5jdHhfc2l6
ZVtjdHhsZC0+Y3VycmVudF9jdHhdW0NUWF9TQl9IUF0gPSAwOworCWN0eGxkLT5jdHhfc2l6ZVtj
dHhsZC0+Y3VycmVudF9jdHhdW0NUWF9TQl9MUF0gPSAwOworCisJcmV0dXJuIDA7Cit9CisKK2lu
dCBkY3NzX2N0eGxkX2VuYWJsZShzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpCit7CisJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZjdHhsZC0+bG9jaywgZmxhZ3Mp
OworCWN0eGxkLT5hcm1lZCA9IHRydWU7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmY3R4bGQt
PmxvY2ssIGZsYWdzKTsKKworCXJldHVybiAwOworfQorCit2b2lkIGRjc3NfY3R4bGRfa2ljayhz
dHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpCit7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCXNw
aW5fbG9ja19pcnFzYXZlKCZjdHhsZC0+bG9jaywgZmxhZ3MpOworCWlmIChjdHhsZC0+YXJtZWQg
JiYgIWN0eGxkLT5pbl91c2UpIHsKKwkJY3R4bGQtPmFybWVkID0gZmFsc2U7CisJCV9fZGNzc19j
dHhsZF9lbmFibGUoY3R4bGQpOworCX0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZjdHhsZC0+
bG9jaywgZmxhZ3MpOworfQorCit2b2lkIGRjc3NfY3R4bGRfd3JpdGVfaXJxc2FmZShzdHJ1Y3Qg
ZGNzc19jdHhsZCAqY3R4bGQsIHUzMiBjdHhfaWQsIHUzMiB2YWwsCisJCQkgICAgICB1MzIgcmVn
X29mcykKK3sKKwlpbnQgY3Vycl9jdHggPSBjdHhsZC0+Y3VycmVudF9jdHg7CisJc3RydWN0IGRj
c3NfY3R4bGRfaXRlbSAqY3R4W10gPSB7CisJCVtDVFhfREJdID0gY3R4bGQtPmRiW2N1cnJfY3R4
XSwKKwkJW0NUWF9TQl9IUF0gPSBjdHhsZC0+c2JfaHBbY3Vycl9jdHhdLAorCQlbQ1RYX1NCX0xQ
XSA9IGN0eGxkLT5zYl9scFtjdXJyX2N0eF0KKwl9OworCWludCBpdGVtX2lkeCA9IGN0eGxkLT5j
dHhfc2l6ZVtjdXJyX2N0eF1bY3R4X2lkXTsKKworCWlmIChpdGVtX2lkeCArIDEgPiBkY3NzX2N0
eGxkX2N0eF9zaXplW2N0eF9pZF0pIHsKKwkJV0FSTl9PTigxKTsKKwkJcmV0dXJuOworCX0KKwor
CWN0eFtjdHhfaWRdW2l0ZW1faWR4XS52YWwgPSB2YWw7CisJY3R4W2N0eF9pZF1baXRlbV9pZHhd
Lm9mcyA9IHJlZ19vZnM7CisJY3R4bGQtPmN0eF9zaXplW2N1cnJfY3R4XVtjdHhfaWRdICs9IDE7
Cit9CisKK3ZvaWQgZGNzc19jdHhsZF93cml0ZShzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQsIHUz
MiBjdHhfaWQsCisJCSAgICAgIHUzMiB2YWwsIHUzMiByZWdfb2ZzKQoreworCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmY3R4bGQtPmxvY2ssIGZsYWdzKTsKKwlk
Y3NzX2N0eGxkX3dyaXRlX2lycXNhZmUoY3R4bGQsIGN0eF9pZCwgdmFsLCByZWdfb2ZzKTsKKwlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZjdHhsZC0+bG9jaywgZmxhZ3MpOworfQorCitib29sIGRj
c3NfY3R4bGRfaXNfZmx1c2hlZChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpCit7CisJcmV0dXJu
IGN0eGxkLT5jdHhfc2l6ZVtjdHhsZC0+Y3VycmVudF9jdHhdW0NUWF9EQl0gPT0gMCAmJgorCQlj
dHhsZC0+Y3R4X3NpemVbY3R4bGQtPmN1cnJlbnRfY3R4XVtDVFhfU0JfSFBdID09IDAgJiYKKwkJ
Y3R4bGQtPmN0eF9zaXplW2N0eGxkLT5jdXJyZW50X2N0eF1bQ1RYX1NCX0xQXSA9PSAwOworfQor
CitpbnQgZGNzc19jdHhsZF9yZXN1bWUoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKQoreworCWRj
c3NfY3R4bGRfaHdfY2ZnKGN0eGxkKTsKKworCWlmICghY3R4bGQtPmlycV9lbikgeworCQllbmFi
bGVfaXJxKGN0eGxkLT5pcnEpOworCQljdHhsZC0+aXJxX2VuID0gdHJ1ZTsKKwl9CisKKwlyZXR1
cm4gMDsKK30KKworaW50IGRjc3NfY3R4bGRfc3VzcGVuZChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4
bGQpCit7CisJaW50IHJldCA9IDA7CisJaW50IHdhaXRfdGltZV9tcyA9IDA7CisJdW5zaWduZWQg
bG9uZyBmbGFnczsKKworCWRjc3NfY3R4bGRfa2ljayhjdHhsZCk7CisKKwl3aGlsZSAoY3R4bGQt
PmluX3VzZSAmJiB3YWl0X3RpbWVfbXMgPCA1MDApIHsKKwkJbXNsZWVwKDIwKTsKKwkJd2FpdF90
aW1lX21zICs9IDIwOworCX0KKworCWlmICh3YWl0X3RpbWVfbXMgPiA1MDApCisJCXJldHVybiAt
RVRJTUVET1VUOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmN0eGxkLT5sb2NrLCBmbGFncyk7CisK
KwlpZiAoY3R4bGQtPmlycV9lbikgeworCQlkaXNhYmxlX2lycV9ub3N5bmMoY3R4bGQtPmlycSk7
CisJCWN0eGxkLT5pcnFfZW4gPSBmYWxzZTsKKwl9CisKKwkvKiByZXNldCBjb250ZXh0IHJlZ2lv
biBhbmQgc2l6ZXMgKi8KKwljdHhsZC0+Y3VycmVudF9jdHggPSAwOworCWN0eGxkLT5jdHhfc2l6
ZVswXVtDVFhfREJdID0gMDsKKwljdHhsZC0+Y3R4X3NpemVbMF1bQ1RYX1NCX0hQXSA9IDA7CisJ
Y3R4bGQtPmN0eF9zaXplWzBdW0NUWF9TQl9MUF0gPSAwOworCisJc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmY3R4bGQtPmxvY2ssIGZsYWdzKTsKKworCXJldHVybiByZXQ7Cit9CisKK3ZvaWQgZGNz
c19jdHhsZF9yZWdpc3Rlcl9kdGdfZGlzYWJsZV9jYihzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQs
CisJCQkJCXZvaWQgKCpjYikodm9pZCAqKSwKKwkJCQkJdm9pZCAqZGF0YSkKK3sKKwljdHhsZC0+
ZHRnX2Rpc2FibGVfY2IgPSBjYjsKKwljdHhsZC0+ZHRnX2Rpc2FibGVfZGF0YSA9IGRhdGE7Cit9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kZXYuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRldi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi4yNjViZjNjCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZGV2LmMKQEAgLTAsMCArMSwyODYgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNs
dWRlIDxsaW51eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51eC9vZl9kZXZpY2UuaD4KKyNpbmNsdWRl
IDxsaW51eC9vZl9ncmFwaC5oPgorI2luY2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX21vZGVzZXRfaGVscGVyLmg+CisKKyNpbmNsdWRlICJkY3NzLWRldi5oIgor
CitzdGF0aWMgdm9pZCBkY3NzX2Nsb2Nrc19lbmFibGUoc3RydWN0IGRjc3NfZGV2ICpkY3NzKQor
eworCWlmIChkY3NzLT5jbGtzX29uKQorCQlyZXR1cm47CisKKwljbGtfcHJlcGFyZV9lbmFibGUo
ZGNzcy0+YXhpX2Nsayk7CisJY2xrX3ByZXBhcmVfZW5hYmxlKGRjc3MtPmFwYl9jbGspOworCWNs
a19wcmVwYXJlX2VuYWJsZShkY3NzLT5ydHJtX2Nsayk7CisJY2xrX3ByZXBhcmVfZW5hYmxlKGRj
c3MtPmR0cmNfY2xrKTsKKwljbGtfcHJlcGFyZV9lbmFibGUoZGNzcy0+cGl4X2Nsayk7CisKKwlk
Y3NzLT5jbGtzX29uID0gdHJ1ZTsKK30KKworc3RhdGljIHZvaWQgZGNzc19jbG9ja3NfZGlzYWJs
ZShzdHJ1Y3QgZGNzc19kZXYgKmRjc3MpCit7CisJaWYgKCFkY3NzLT5jbGtzX29uKQorCQlyZXR1
cm47CisKKwljbGtfZGlzYWJsZV91bnByZXBhcmUoZGNzcy0+cGl4X2Nsayk7CisJY2xrX2Rpc2Fi
bGVfdW5wcmVwYXJlKGRjc3MtPmR0cmNfY2xrKTsKKwljbGtfZGlzYWJsZV91bnByZXBhcmUoZGNz
cy0+cnRybV9jbGspOworCWNsa19kaXNhYmxlX3VucHJlcGFyZShkY3NzLT5hcGJfY2xrKTsKKwlj
bGtfZGlzYWJsZV91bnByZXBhcmUoZGNzcy0+YXhpX2Nsayk7CisKKwlkY3NzLT5jbGtzX29uID0g
ZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQgZGNzc19zdWJtb2R1bGVzX2luaXQoc3RydWN0IGRjc3Nf
ZGV2ICpkY3NzKQoreworCWludCByZXQgPSAwOworCXUzMiBiYXNlX2FkZHIgPSBkY3NzLT5zdGFy
dF9hZGRyOworCWNvbnN0IHN0cnVjdCBkY3NzX3R5cGVfZGF0YSAqZGV2dHlwZSA9IGRjc3MtPmRl
dnR5cGU7CisKKwlkY3NzX2Nsb2Nrc19lbmFibGUoZGNzcyk7CisKKwlyZXQgPSBkY3NzX2Jsa2N0
bF9pbml0KGRjc3MsIGJhc2VfYWRkciArIGRldnR5cGUtPmJsa2N0bF9vZnMpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBkY3NzX2N0eGxkX2luaXQoZGNzcywgYmFzZV9hZGRy
ICsgZGV2dHlwZS0+Y3R4bGRfb2ZzKTsKKwlpZiAocmV0KQorCQlnb3RvIGN0eGxkX2VycjsKKwor
CXJldCA9IGRjc3NfZHRnX2luaXQoZGNzcywgYmFzZV9hZGRyICsgZGV2dHlwZS0+ZHRnX29mcyk7
CisJaWYgKHJldCkKKwkJZ290byBkdGdfZXJyOworCisJcmV0ID0gZGNzc19zc19pbml0KGRjc3Ms
IGJhc2VfYWRkciArIGRldnR5cGUtPnNzX29mcyk7CisJaWYgKHJldCkKKwkJZ290byBzc19lcnI7
CisKKwlyZXQgPSBkY3NzX2Rwcl9pbml0KGRjc3MsIGJhc2VfYWRkciArIGRldnR5cGUtPmRwcl9v
ZnMpOworCWlmIChyZXQpCisJCWdvdG8gZHByX2VycjsKKworCXJldCA9IGRjc3Nfc2NhbGVyX2lu
aXQoZGNzcywgYmFzZV9hZGRyICsgZGV2dHlwZS0+c2NhbGVyX29mcyk7CisJaWYgKHJldCkKKwkJ
Z290byBzY2FsZXJfZXJyOworCisJcmV0dXJuIDA7CisKK3NjYWxlcl9lcnI6CisJZGNzc19kcHJf
ZXhpdChkY3NzLT5kcHIpOworCitkcHJfZXJyOgorCWRjc3Nfc3NfZXhpdChkY3NzLT5zcyk7CisK
K3NzX2VycjoKKwlkY3NzX2R0Z19leGl0KGRjc3MtPmR0Zyk7CisKK2R0Z19lcnI6CisJZGNzc19j
dHhsZF9leGl0KGRjc3MtPmN0eGxkKTsKKworY3R4bGRfZXJyOgorCWRjc3NfYmxrY3RsX2V4aXQo
ZGNzcy0+YmxrY3RsKTsKKworCWRjc3NfY2xvY2tzX2Rpc2FibGUoZGNzcyk7CisKKwlyZXR1cm4g
cmV0OworfQorCitzdGF0aWMgdm9pZCBkY3NzX3N1Ym1vZHVsZXNfc3RvcChzdHJ1Y3QgZGNzc19k
ZXYgKmRjc3MpCit7CisJZGNzc19jbG9ja3NfZW5hYmxlKGRjc3MpOworCWRjc3Nfc2NhbGVyX2V4
aXQoZGNzcy0+c2NhbGVyKTsKKwlkY3NzX2Rwcl9leGl0KGRjc3MtPmRwcik7CisJZGNzc19zc19l
eGl0KGRjc3MtPnNzKTsKKwlkY3NzX2R0Z19leGl0KGRjc3MtPmR0Zyk7CisJZGNzc19jdHhsZF9l
eGl0KGRjc3MtPmN0eGxkKTsKKwlkY3NzX2Jsa2N0bF9leGl0KGRjc3MtPmJsa2N0bCk7CisJZGNz
c19jbG9ja3NfZGlzYWJsZShkY3NzKTsKK30KKworc3RhdGljIGludCBkY3NzX2Nsa3NfaW5pdChz
dHJ1Y3QgZGNzc19kZXYgKmRjc3MpCit7CisJaW50IGk7CisJc3RydWN0IHsKKwkJY29uc3QgY2hh
ciAqaWQ7CisJCXN0cnVjdCBjbGsgKipjbGs7CisJfSBjbGtzW10gPSB7CisJCXsiYXBiIiwgICAm
ZGNzcy0+YXBiX2Nsa30sCisJCXsiYXhpIiwgICAmZGNzcy0+YXhpX2Nsa30sCisJCXsicGl4Iiwg
ICAmZGNzcy0+cGl4X2Nsa30sCisJCXsicnRybSIsICAmZGNzcy0+cnRybV9jbGt9LAorCQl7ImR0
cmMiLCAgJmRjc3MtPmR0cmNfY2xrfSwKKwl9OworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJ
WkUoY2xrcyk7IGkrKykgeworCQkqY2xrc1tpXS5jbGsgPSBkZXZtX2Nsa19nZXQoZGNzcy0+ZGV2
LCBjbGtzW2ldLmlkKTsKKwkJaWYgKElTX0VSUigqY2xrc1tpXS5jbGspKSB7CisJCQlkZXZfZXJy
KGRjc3MtPmRldiwgImZhaWxlZCB0byBnZXQgJXMgY2xvY2tcbiIsCisJCQkJY2xrc1tpXS5pZCk7
CisJCQlyZXR1cm4gUFRSX0VSUigqY2xrc1tpXS5jbGspOworCQl9CisJfQorCisJZGNzcy0+Y2xr
c19vbiA9IGZhbHNlOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfY2xrc19y
ZWxlYXNlKHN0cnVjdCBkY3NzX2RldiAqZGNzcykKK3sKKwlkZXZtX2Nsa19wdXQoZGNzcy0+ZGV2
LCBkY3NzLT5kdHJjX2Nsayk7CisJZGV2bV9jbGtfcHV0KGRjc3MtPmRldiwgZGNzcy0+cnRybV9j
bGspOworCWRldm1fY2xrX3B1dChkY3NzLT5kZXYsIGRjc3MtPnBpeF9jbGspOworCWRldm1fY2xr
X3B1dChkY3NzLT5kZXYsIGRjc3MtPmF4aV9jbGspOworCWRldm1fY2xrX3B1dChkY3NzLT5kZXYs
IGRjc3MtPmFwYl9jbGspOworfQorCitzdHJ1Y3QgZGNzc19kZXYgKmRjc3NfZGV2X2NyZWF0ZShz
dHJ1Y3QgZGV2aWNlICpkZXYsIGJvb2wgaGRtaV9vdXRwdXQpCit7CisJc3RydWN0IHBsYXRmb3Jt
X2RldmljZSAqcGRldiA9IHRvX3BsYXRmb3JtX2RldmljZShkZXYpOworCWludCByZXQ7CisJc3Ry
dWN0IHJlc291cmNlICpyZXM7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzOworCWNvbnN0IHN0cnVj
dCBkY3NzX3R5cGVfZGF0YSAqZGV2dHlwZTsKKworCWRldnR5cGUgPSBvZl9kZXZpY2VfZ2V0X21h
dGNoX2RhdGEoZGV2KTsKKwlpZiAoIWRldnR5cGUpIHsKKwkJZGV2X2VycihkZXYsICJubyBkZXZp
Y2UgbWF0Y2ggZm91bmRcbiIpOworCQlyZXR1cm4gRVJSX1BUUigtRU5PREVWKTsKKwl9CisKKwly
ZXMgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2UocGRldiwgSU9SRVNPVVJDRV9NRU0sIDApOworCWlm
ICghcmVzKSB7CisJCWRldl9lcnIoZGV2LCAiY2Fubm90IGdldCBtZW1vcnkgcmVzb3VyY2VcbiIp
OworCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKKwl9CisKKwlkY3NzID0gZGV2bV9remFsbG9j
KGRldiwgc2l6ZW9mKHN0cnVjdCBkY3NzX2RldiksIEdGUF9LRVJORUwpOworCWlmICghZGNzcykK
KwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlkY3NzLT5kZXYgPSBkZXY7CisJZGNzcy0+
ZGV2dHlwZSA9IGRldnR5cGU7CisJZGNzcy0+aGRtaV9vdXRwdXQgPSBoZG1pX291dHB1dDsKKwor
CXJldCA9IGRjc3NfY2xrc19pbml0KGRjc3MpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkZXYs
ICJjbG9ja3MgaW5pdGlhbGl6YXRpb24gZmFpbGVkXG4iKTsKKwkJZ290byBlcnI7CisJfQorCisJ
ZGNzcy0+b2ZfcG9ydCA9IG9mX2dyYXBoX2dldF9wb3J0X2J5X2lkKGRldi0+b2Zfbm9kZSwgMCk7
CisJaWYgKCFkY3NzLT5vZl9wb3J0KSB7CisJCWRldl9lcnIoZGV2LCAibm8gcG9ydEAwIG5vZGUg
aW4gJXNcbiIsIGRldi0+b2Zfbm9kZS0+ZnVsbF9uYW1lKTsKKwkJcmV0ID0gLUVOT0RFVjsKKwkJ
Z290byBjbGtzX2VycjsKKwl9CisKKwlkY3NzLT5zdGFydF9hZGRyID0gcmVzLT5zdGFydDsKKwor
CXJldCA9IGRjc3Nfc3VibW9kdWxlc19pbml0KGRjc3MpOworCWlmIChyZXQpIHsKKwkJZGV2X2Vy
cihkZXYsICJzdWJtb2R1bGVzIGluaXRpYWxpemF0aW9uIGZhaWxlZFxuIik7CisJCWdvdG8gY2xr
c19lcnI7CisJfQorCisJcG1fcnVudGltZV9lbmFibGUoZGV2KTsKKworCXJldHVybiBkY3NzOwor
CitjbGtzX2VycjoKKwlkY3NzX2Nsa3NfcmVsZWFzZShkY3NzKTsKKworZXJyOgorCWRldm1fa2Zy
ZWUoZGNzcy0+ZGV2LCBkY3NzKTsKKworCXJldHVybiBFUlJfUFRSKHJldCk7Cit9CisKK3ZvaWQg
ZGNzc19kZXZfZGVzdHJveShzdHJ1Y3QgZGNzc19kZXYgKmRjc3MpCit7CisJcG1fcnVudGltZV9k
aXNhYmxlKGRjc3MtPmRldik7CisKKwlkY3NzX3N1Ym1vZHVsZXNfc3RvcChkY3NzKTsKKworCWRj
c3NfY2xrc19yZWxlYXNlKGRjc3MpOworCisJZGV2bV9rZnJlZShkY3NzLT5kZXYsIGRjc3MpOwor
fQorCisjaWZkZWYgQ09ORklHX1BNX1NMRUVQCitpbnQgZGNzc19kZXZfc3VzcGVuZChzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0gZGNzc19kcnZfZGV2X3Rv
X2Rjc3MoZGV2KTsKKwlpbnQgcmV0OworCisJZHJtX21vZGVfY29uZmlnX2hlbHBlcl9zdXNwZW5k
KGRjc3NfZHJ2X2Rldl90b19kcm0oZGV2KSk7CisKKwlpZiAocG1fcnVudGltZV9zdXNwZW5kZWQo
ZGV2KSkKKwkJcmV0dXJuIDA7CisKKwlyZXQgPSBkY3NzX2N0eGxkX3N1c3BlbmQoZGNzcy0+Y3R4
bGQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkY3NzX2Nsb2Nrc19kaXNhYmxlKGRj
c3MpOworCisJcmV0dXJuIDA7Cit9CisKK2ludCBkY3NzX2Rldl9yZXN1bWUoc3RydWN0IGRldmlj
ZSAqZGV2KQoreworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRjc3NfZHJ2X2Rldl90b19kY3Nz
KGRldik7CisKKwlpZiAocG1fcnVudGltZV9zdXNwZW5kZWQoZGV2KSkgeworCQlkcm1fbW9kZV9j
b25maWdfaGVscGVyX3Jlc3VtZShkY3NzX2Rydl9kZXZfdG9fZHJtKGRldikpOworCQlyZXR1cm4g
MDsKKwl9CisKKwlkY3NzX2Nsb2Nrc19lbmFibGUoZGNzcyk7CisKKwlkY3NzX2Jsa2N0bF9jZmco
ZGNzcy0+YmxrY3RsKTsKKworCWRjc3NfY3R4bGRfcmVzdW1lKGRjc3MtPmN0eGxkKTsKKworCWRy
bV9tb2RlX2NvbmZpZ19oZWxwZXJfcmVzdW1lKGRjc3NfZHJ2X2Rldl90b19kcm0oZGV2KSk7CisK
KwlyZXR1cm4gMDsKK30KKyNlbmRpZiAvKiBDT05GSUdfUE1fU0xFRVAgKi8KKworI2lmZGVmIENP
TkZJR19QTQoraW50IGRjc3NfZGV2X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYp
Cit7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzID0gZGNzc19kcnZfZGV2X3RvX2Rjc3MoZGV2KTsK
KwlpbnQgcmV0OworCisJcmV0ID0gZGNzc19jdHhsZF9zdXNwZW5kKGRjc3MtPmN0eGxkKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZGNzc19jbG9ja3NfZGlzYWJsZShkY3NzKTsKKwor
CXJldHVybiAwOworfQorCitpbnQgZGNzc19kZXZfcnVudGltZV9yZXN1bWUoc3RydWN0IGRldmlj
ZSAqZGV2KQoreworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRjc3NfZHJ2X2Rldl90b19kY3Nz
KGRldik7CisKKwlkY3NzX2Nsb2Nrc19lbmFibGUoZGNzcyk7CisKKwlkY3NzX2Jsa2N0bF9jZmco
ZGNzcy0+YmxrY3RsKTsKKworCWRjc3NfY3R4bGRfcmVzdW1lKGRjc3MtPmN0eGxkKTsKKworCXJl
dHVybiAwOworfQorI2VuZGlmIC8qIENPTkZJR19QTSAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2lteC9kY3NzL2Rjc3MtZGV2LmggYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNz
cy1kZXYuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uMTVjNWRlMwotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRldi5oCkBAIC0w
LDAgKzEsMTk1IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMCAqLworLyoK
KyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAqLworCisjaWZuZGVmIF9fRENTU19QUlZfSF9fCisj
ZGVmaW5lIF9fRENTU19QUlZfSF9fCisKKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgorI2lu
Y2x1ZGUgPGxpbnV4L2lvLmg+CisjaW5jbHVkZSA8dmlkZW8vdmlkZW9tb2RlLmg+CisKKyNkZWZp
bmUgU0VUCQkJMHgwNAorI2RlZmluZSBDTFIJCQkweDA4CisjZGVmaW5lIFRHTAkJCTB4MEMKKwor
I2RlZmluZSBkY3NzX3dyaXRlbCh2LCBjKQl3cml0ZWwoKHYpLCAoYykpCisjZGVmaW5lIGRjc3Nf
cmVhZGwoYykJCXJlYWRsKGMpCisjZGVmaW5lIGRjc3Nfc2V0KHYsIGMpCQl3cml0ZWwoKHYpLCAo
YykgKyBTRVQpCisjZGVmaW5lIGRjc3NfY2xyKHYsIGMpCQl3cml0ZWwoKHYpLCAoYykgKyBDTFIp
CisjZGVmaW5lIGRjc3NfdG9nZ2xlKHYsIGMpCXdyaXRlbCgodiksIChjKSArIFRHTCkKKworc3Rh
dGljIGlubGluZSB2b2lkIGRjc3NfdXBkYXRlKHUzMiB2LCB1MzIgbSwgdm9pZCBfX2lvbWVtICpj
KQoreworCXdyaXRlbCgocmVhZGwoYykgJiB+KG0pKSB8ICh2KSwgKGMpKTsKK30KKworI2RlZmlu
ZSBEQ1NTX0RCR19SRUcocmVnKQl7Lm5hbWUgPSAjcmVnLCAub2ZzID0gcmVnfQorCitlbnVtIHsK
KwlEQ1NTX0lNWDhNUSA9IDAsCit9OworCitzdHJ1Y3QgZGNzc190eXBlX2RhdGEgeworCWNvbnN0
IGNoYXIgKm5hbWU7CisJdTMyIGJsa2N0bF9vZnM7CisJdTMyIGN0eGxkX29mczsKKwl1MzIgcmRz
cmNfb2ZzOworCXUzMiB3cnNjbF9vZnM7CisJdTMyIGR0Z19vZnM7CisJdTMyIHNjYWxlcl9vZnM7
CisJdTMyIHNzX29mczsKKwl1MzIgZHByX29mczsKKwl1MzIgZHRyY19vZnM7CisJdTMyIGRlYzQw
MGRfb2ZzOworCXUzMiBoZHIxMF9vZnM7Cit9OworCitzdHJ1Y3QgZGNzc19kZWJ1Z19yZWcgewor
CWNoYXIgKm5hbWU7CisJdTMyIG9mczsKK307CisKK2VudW0gZGNzc19jdHhsZF9jdHhfdHlwZSB7
CisJQ1RYX0RCLAorCUNUWF9TQl9IUCwgLyogaGlnaC1wcmlvcml0eSAqLworCUNUWF9TQl9MUCwg
LyogbG93LXByaW9yaXR5ICAqLworfTsKKworc3RydWN0IGRjc3NfZGV2IHsKKwlzdHJ1Y3QgZGV2
aWNlICpkZXY7CisJY29uc3Qgc3RydWN0IGRjc3NfdHlwZV9kYXRhICpkZXZ0eXBlOworCXN0cnVj
dCBkZXZpY2Vfbm9kZSAqb2ZfcG9ydDsKKworCXUzMiBzdGFydF9hZGRyOworCisJc3RydWN0IGRj
c3NfYmxrY3RsICpibGtjdGw7CisJc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkOworCXN0cnVjdCBk
Y3NzX2RwciAqZHByOworCXN0cnVjdCBkY3NzX2R0ZyAqZHRnOworCXN0cnVjdCBkY3NzX3NzICpz
czsKKwlzdHJ1Y3QgZGNzc19oZHIxMCAqaGRyMTA7CisJc3RydWN0IGRjc3Nfc2NhbGVyICpzY2Fs
ZXI7CisJc3RydWN0IGRjc3NfZHRyYyAqZHRyYzsKKwlzdHJ1Y3QgZGNzc19kZWM0MDBkICpkZWM0
MDBkOworCXN0cnVjdCBkY3NzX3dyc2NsICp3cnNjbDsKKwlzdHJ1Y3QgZGNzc19yZHNyYyAqcmRz
cmM7CisKKwlzdHJ1Y3QgY2xrICphcGJfY2xrOworCXN0cnVjdCBjbGsgKmF4aV9jbGs7CisJc3Ry
dWN0IGNsayAqcGl4X2NsazsKKwlzdHJ1Y3QgY2xrICpydHJtX2NsazsKKwlzdHJ1Y3QgY2xrICpk
dHJjX2NsazsKKwlzdHJ1Y3QgY2xrICpwbGxfc3JjX2NsazsKKwlzdHJ1Y3QgY2xrICpwbGxfcGh5
X3JlZl9jbGs7CisKKwl2b2lkICgqZGNzc19kaXNhYmxlX2NhbGxiYWNrKSh2b2lkICpkYXRhKTsK
KworCWJvb2wgY2xrc19vbjsKKwlib29sIGhkbWlfb3V0cHV0OworfTsKKworZW51bSBkY3NzX2Nv
bG9yX3NwYWNlIHsKKwlEQ1NTX0NPTE9SU1BBQ0VfUkdCLAorCURDU1NfQ09MT1JTUEFDRV9ZVVYs
CisJRENTU19DT0xPUlNQQUNFX1VOS05PV04sCit9OworCitzdHJ1Y3QgZGNzc19kZXYgKmRjc3Nf
ZHJ2X2Rldl90b19kY3NzKHN0cnVjdCBkZXZpY2UgKmRldik7CitzdHJ1Y3QgZHJtX2RldmljZSAq
ZGNzc19kcnZfZGV2X3RvX2RybShzdHJ1Y3QgZGV2aWNlICpkZXYpOworc3RydWN0IGRjc3NfZGV2
ICpkY3NzX2Rldl9jcmVhdGUoc3RydWN0IGRldmljZSAqZGV2LCBib29sIG1pcGlfb3V0cHV0KTsK
K3ZvaWQgZGNzc19kZXZfZGVzdHJveShzdHJ1Y3QgZGNzc19kZXYgKmRjc3MpOworaW50IGRjc3Nf
ZGV2X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICpkZXYpOworaW50IGRjc3NfZGV2X3J1
bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmRldik7CitpbnQgZGNzc19kZXZfc3VzcGVuZChz
dHJ1Y3QgZGV2aWNlICpkZXYpOworaW50IGRjc3NfZGV2X3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpk
ZXYpOworCisvKiBCTEtDVEwgKi8KK2ludCBkY3NzX2Jsa2N0bF9pbml0KHN0cnVjdCBkY3NzX2Rl
diAqZGNzcywgdW5zaWduZWQgbG9uZyBibGtjdGxfYmFzZSk7Cit2b2lkIGRjc3NfYmxrY3RsX2Nm
ZyhzdHJ1Y3QgZGNzc19ibGtjdGwgKmJsa2N0bCk7Cit2b2lkIGRjc3NfYmxrY3RsX2V4aXQoc3Ry
dWN0IGRjc3NfYmxrY3RsICpibGtjdGwpOworCisvKiBDVFhMRCAqLworaW50IGRjc3NfY3R4bGRf
aW5pdChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgY3R4bGRfYmFzZSk7Cit2
b2lkIGRjc3NfY3R4bGRfZXhpdChzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQpOwordm9pZCBkY3Nz
X2N0eGxkX3dyaXRlKHN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZCwgdTMyIGN0eF9pZCwKKwkJICAg
ICAgdTMyIHZhbCwgdTMyIHJlZ19pZHgpOworaW50IGRjc3NfY3R4bGRfcmVzdW1lKHN0cnVjdCBk
Y3NzX2N0eGxkICpkY3NzX2N0eGxkKTsKK2ludCBkY3NzX2N0eGxkX3N1c3BlbmQoc3RydWN0IGRj
c3NfY3R4bGQgKmRjc3NfY3R4bGQpOwordm9pZCBkY3NzX2N0eGxkX3dyaXRlX2lycXNhZmUoc3Ry
dWN0IGRjc3NfY3R4bGQgKmN0bHhkLCB1MzIgY3R4X2lkLCB1MzIgdmFsLAorCQkJICAgICAgdTMy
IHJlZ19vZnMpOwordm9pZCBkY3NzX2N0eGxkX2tpY2soc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxk
KTsKK2Jvb2wgZGNzc19jdHhsZF9pc19mbHVzaGVkKHN0cnVjdCBkY3NzX2N0eGxkICpjdHhsZCk7
CitpbnQgZGNzc19jdHhsZF9lbmFibGUoc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkKTsKK3ZvaWQg
ZGNzc19jdHhsZF9yZWdpc3Rlcl9kdGdfZGlzYWJsZV9jYihzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4
bGQsCisJCQkJCXZvaWQgKCpjYikodm9pZCAqKSwKKwkJCQkJdm9pZCAqZGF0YSk7CisKKy8qIERQ
UiAqLworZW51bSBkY3NzX3RpbGVfdHlwZSB7CisJVElMRV9MSU5FQVIgPSAwLAorCVRJTEVfR1BV
X1NUQU5EQVJELAorCVRJTEVfR1BVX1NVUEVSLAorCVRJTEVfVlBVX1lVVjQyMCwKKwlUSUxFX1ZQ
VV9WUDksCit9OworCitlbnVtIGRjc3NfcGl4X3NpemUgeworCVBJWF9TSVpFXzgsCisJUElYX1NJ
WkVfMTYsCisJUElYX1NJWkVfMzIsCit9OworCitpbnQgZGNzc19kcHJfaW5pdChzdHJ1Y3QgZGNz
c19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgZHByX2Jhc2UpOwordm9pZCBkY3NzX2Rwcl9leGl0
KHN0cnVjdCBkY3NzX2RwciAqZHByKTsKK3ZvaWQgZGNzc19kcHJfd3JpdGVfc3lzY3RybChzdHJ1
Y3QgZGNzc19kcHIgKmRwcik7Cit2b2lkIGRjc3NfZHByX3NldF9yZXMoc3RydWN0IGRjc3NfZHBy
ICpkcHIsIGludCBjaF9udW0sIHUzMiB4cmVzLCB1MzIgeXJlcyk7Cit2b2lkIGRjc3NfZHByX2Fk
ZHJfc2V0KHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQgY2hfbnVtLCB1MzIgbHVtYV9iYXNlX2Fk
ZHIsCisJCSAgICAgICB1MzIgY2hyb21hX2Jhc2VfYWRkciwgdTE2IHBpdGNoKTsKK3ZvaWQgZGNz
c19kcHJfZW5hYmxlKHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQgY2hfbnVtLCBib29sIGVuKTsK
K3ZvaWQgZGNzc19kcHJfZm9ybWF0X3NldChzdHJ1Y3QgZGNzc19kcHIgKmRwciwgaW50IGNoX251
bSwKKwkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsIHU2NCBtb2RpZmll
cik7Cit2b2lkIGRjc3NfZHByX3NldF9yb3RhdGlvbihzdHJ1Y3QgZGNzc19kcHIgKmRwciwgaW50
IGNoX251bSwgdTMyIHJvdGF0aW9uKTsKKworLyogRFRHICovCitpbnQgZGNzc19kdGdfaW5pdChz
dHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgZHRnX2Jhc2UpOwordm9pZCBkY3Nz
X2R0Z19leGl0KHN0cnVjdCBkY3NzX2R0ZyAqZHRnKTsKK2Jvb2wgZGNzc19kdGdfdmJsYW5rX2ly
cV92YWxpZChzdHJ1Y3QgZGNzc19kdGcgKmR0Zyk7Cit2b2lkIGRjc3NfZHRnX3ZibGFua19pcnFf
ZW5hYmxlKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBib29sIGVuKTsKK3ZvaWQgZGNzc19kdGdfdmJs
YW5rX2lycV9jbGVhcihzdHJ1Y3QgZGNzc19kdGcgKmR0Zyk7Cit2b2lkIGRjc3NfZHRnX3N5bmNf
c2V0KHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBzdHJ1Y3QgdmlkZW9tb2RlICp2bSk7Cit2b2lkIGRj
c3NfZHRnX2Nzc19zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcpOwordm9pZCBkY3NzX2R0Z19lbmFi
bGUoc3RydWN0IGRjc3NfZHRnICpkdGcsIGJvb2wgZW4sCisJCSAgICAgc3RydWN0IGNvbXBsZXRp
b24gKmRpc19jb21wbGV0aW9uKTsKK2Jvb2wgZGNzc19kdGdfaXNfZW5hYmxlZChzdHJ1Y3QgZGNz
c19kdGcgKmR0Zyk7Cit2b2lkIGRjc3NfZHRnX2N0eGxkX2tpY2tfaXJxX2VuYWJsZShzdHJ1Y3Qg
ZGNzc19kdGcgKmR0ZywgYm9vbCBlbik7Citib29sIGRjc3NfZHRnX2dsb2JhbF9hbHBoYV9jaGFu
Z2VkKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLCBpbnQgYWxwaGEpOwordm9pZCBk
Y3NzX2R0Z19wbGFuZV9hbHBoYV9zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcsIGludCBjaF9udW0s
CisJCQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsIGludCBhbHBo
YSk7Cit2b2lkIGRjc3NfZHRnX3BsYW5lX3Bvc19zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcsIGlu
dCBjaF9udW0sCisJCQkgICAgaW50IHB4LCBpbnQgcHksIGludCBwdywgaW50IHBoKTsKK3ZvaWQg
ZGNzc19kdGdfY2hfZW5hYmxlKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLCBib29s
IGVuKTsKKworLyogU1VCU0FNICovCitpbnQgZGNzc19zc19pbml0KHN0cnVjdCBkY3NzX2RldiAq
ZGNzcywgdW5zaWduZWQgbG9uZyBzdWJzYW1fYmFzZSk7Cit2b2lkIGRjc3Nfc3NfZXhpdChzdHJ1
Y3QgZGNzc19zcyAqc3MpOwordm9pZCBkY3NzX3NzX2VuYWJsZShzdHJ1Y3QgZGNzc19zcyAqc3Mp
Owordm9pZCBkY3NzX3NzX2Rpc2FibGUoc3RydWN0IGRjc3Nfc3MgKnNzKTsKK3ZvaWQgZGNzc19z
c19zdWJzYW1fc2V0KHN0cnVjdCBkY3NzX3NzICpzcyk7Cit2b2lkIGRjc3Nfc3Nfc3luY19zZXQo
c3RydWN0IGRjc3Nfc3MgKnNzLCBzdHJ1Y3QgdmlkZW9tb2RlICp2bSwKKwkJICAgICAgYm9vbCBw
aHN5bmMsIGJvb2wgcHZzeW5jKTsKKworLyogU0NBTEVSICovCitpbnQgZGNzc19zY2FsZXJfaW5p
dChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgc2NhbGVyX2Jhc2UpOwordm9p
ZCBkY3NzX3NjYWxlcl9leGl0KHN0cnVjdCBkY3NzX3NjYWxlciAqc2NsKTsKK3ZvaWQgZGNzc19z
Y2FsZXJfc2V0dXAoc3RydWN0IGRjc3Nfc2NhbGVyICpzY2wsIGludCBjaF9udW0sCisJCSAgICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQsCisJCSAgICAgICBpbnQgc3Jj
X3hyZXMsIGludCBzcmNfeXJlcywgaW50IGRzdF94cmVzLCBpbnQgZHN0X3lyZXMsCisJCSAgICAg
ICB1MzIgdnJlZnJlc2hfaHopOwordm9pZCBkY3NzX3NjYWxlcl9jaF9lbmFibGUoc3RydWN0IGRj
c3Nfc2NhbGVyICpzY2wsIGludCBjaF9udW0sIGJvb2wgZW4pOworaW50IGRjc3Nfc2NhbGVyX2dl
dF9taW5fbWF4X3JhdGlvcyhzdHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCwgaW50IGNoX251bSwKKwkJ
CQkgICBpbnQgKm1pbiwgaW50ICptYXgpOwordm9pZCBkY3NzX3NjYWxlcl93cml0ZV9zY2xjdHJs
KHN0cnVjdCBkY3NzX3NjYWxlciAqc2NsKTsKKworI2VuZGlmIC8qIF9fRENTU19QUlZfSF9fICov
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kcHIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRwci5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi45MDg1NjA2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZHByLmMKQEAgLTAsMCArMSw1NDggQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNs
dWRlIDxsaW51eC9kZXZpY2UuaD4KKworI2luY2x1ZGUgImRjc3MtZGV2LmgiCisKKyNkZWZpbmUg
RENTU19EUFJfU1lTVEVNX0NUUkwwCQkJMHgwMDAKKyNkZWZpbmUgICBSVU5fRU4JCQkJQklUKDAp
CisjZGVmaW5lICAgU09GVF9SRVNFVAkJCQlCSVQoMSkKKyNkZWZpbmUgICBSRVBFQVRfRU4JCQkJ
QklUKDIpCisjZGVmaW5lICAgU0hBRE9XX0xPQURfRU4JCQlCSVQoMykKKyNkZWZpbmUgICBTV19T
SEFET1dfTE9BRF9TRUwJCQlCSVQoNCkKKyNkZWZpbmUgICBCQ01EMkFYSV9NU1RSX0lEX0NUUkwJ
CQlCSVQoMTYpCisjZGVmaW5lIERDU1NfRFBSX0lSUV9NQVNLCQkJMHgwMjAKKyNkZWZpbmUgRENT
U19EUFJfSVJRX01BU0tfU1RBVFVTCQkweDAzMAorI2RlZmluZSBEQ1NTX0RQUl9JUlFfTk9OTUFT
S19TVEFUVVMJCTB4MDQwCisjZGVmaW5lICAgSVJRX0RQUl9DVFJMX0RPTkUJCQlCSVQoMCkKKyNk
ZWZpbmUgICBJUlFfRFBSX1JVTgkJCQlCSVQoMSkKKyNkZWZpbmUgICBJUlFfRFBSX1NIQURPV19M
T0FERUQJCQlCSVQoMikKKyNkZWZpbmUgICBJUlFfQVhJX1JFQURfRVJSCQkJQklUKDMpCisjZGVm
aW5lICAgRFBSMlJUUl9ZUkdCX0ZJRk9fT1ZGTAkJQklUKDQpCisjZGVmaW5lICAgRFBSMlJUUl9V
Vl9GSUZPX09WRkwJCQlCSVQoNSkKKyNkZWZpbmUgICBEUFIyUlRSX0ZJRk9fTERfQlVGX1JEWV9Z
UkdCX0VSUglCSVQoNikKKyNkZWZpbmUgICBEUFIyUlRSX0ZJRk9fTERfQlVGX1JEWV9VVl9FUlIJ
QklUKDcpCisjZGVmaW5lIERDU1NfRFBSX01PREVfQ1RSTDAJCQkweDA1MAorI2RlZmluZSAgIFJU
Ul8zQlVGX0VOCQkJCUJJVCgwKQorI2RlZmluZSAgIFJUUl80TElORV9CVUZfRU4JCQlCSVQoMSkK
KyNkZWZpbmUgICBUSUxFX1RZUEVfUE9TCQkJCTIKKyNkZWZpbmUgICBUSUxFX1RZUEVfTUFTSwkJ
CUdFTk1BU0soNCwgMikKKyNkZWZpbmUgICBZVVZfRU4JCQkJQklUKDYpCisjZGVmaW5lICAgQ09N
UF8yUExBTkVfRU4JCQlCSVQoNykKKyNkZWZpbmUgICBQSVhfU0laRV9QT1MJCQkJOAorI2RlZmlu
ZSAgIFBJWF9TSVpFX01BU0sJCQkJR0VOTUFTSyg5LCA4KQorI2RlZmluZSAgIFBJWF9MVU1BX1VW
X1NXQVAJCQlCSVQoMTApCisjZGVmaW5lICAgUElYX1VWX1NXQVAJCQkJQklUKDExKQorI2RlZmlu
ZSAgIEJfQ09NUF9TRUxfUE9TCQkJMTIKKyNkZWZpbmUgICBCX0NPTVBfU0VMX01BU0sJCQlHRU5N
QVNLKDEzLCAxMikKKyNkZWZpbmUgICBHX0NPTVBfU0VMX1BPUwkJCTE0CisjZGVmaW5lICAgR19D
T01QX1NFTF9NQVNLCQkJR0VOTUFTSygxNSwgMTQpCisjZGVmaW5lICAgUl9DT01QX1NFTF9QT1MJ
CQkxNgorI2RlZmluZSAgIFJfQ09NUF9TRUxfTUFTSwkJCUdFTk1BU0soMTcsIDE2KQorI2RlZmlu
ZSAgIEFfQ09NUF9TRUxfUE9TCQkJMTgKKyNkZWZpbmUgICBBX0NPTVBfU0VMX01BU0sJCQlHRU5N
QVNLKDE5LCAxOCkKKyNkZWZpbmUgRENTU19EUFJfRlJBTUVfQ1RSTDAJCQkweDA3MAorI2RlZmlu
ZSAgIEhGTElQX0VOCQkJCUJJVCgwKQorI2RlZmluZSAgIFZGTElQX0VOCQkJCUJJVCgxKQorI2Rl
ZmluZSAgIFJPVF9FTkNfUE9TCQkJCTIKKyNkZWZpbmUgICBST1RfRU5DX01BU0sJCQkJR0VOTUFT
SygzLCAyKQorI2RlZmluZSAgIFJPVF9GTElQX09SREVSX0VOCQkJQklUKDQpCisjZGVmaW5lICAg
UElUQ0hfUE9TCQkJCTE2CisjZGVmaW5lICAgUElUQ0hfTUFTSwkJCQlHRU5NQVNLKDMxLCAxNikK
KyNkZWZpbmUgRENTU19EUFJfRlJBTUVfMVBfQ1RSTDAJCQkweDA5MAorI2RlZmluZSBEQ1NTX0RQ
Ul9GUkFNRV8xUF9QSVhfWF9DVFJMCQkweDBBMAorI2RlZmluZSBEQ1NTX0RQUl9GUkFNRV8xUF9Q
SVhfWV9DVFJMCQkweDBCMAorI2RlZmluZSBEQ1NTX0RQUl9GUkFNRV8xUF9CQVNFX0FERFIJCTB4
MEMwCisjZGVmaW5lIERDU1NfRFBSX0ZSQU1FXzJQX0NUUkwwCQkJMHgwRTAKKyNkZWZpbmUgRENT
U19EUFJfRlJBTUVfMlBfUElYX1hfQ1RSTAkJMHgwRjAKKyNkZWZpbmUgRENTU19EUFJfRlJBTUVf
MlBfUElYX1lfQ1RSTAkJMHgxMDAKKyNkZWZpbmUgRENTU19EUFJfRlJBTUVfMlBfQkFTRV9BRERS
CQkweDExMAorI2RlZmluZSBEQ1NTX0RQUl9TVEFUVVNfQ1RSTDAJCQkweDEzMAorI2RlZmluZSAg
IFNUQVRVU19NVVhfU0VMX01BU0sJCQlHRU5NQVNLKDIsIDApCisjZGVmaW5lICAgU1RBVFVTX1NS
Q19TRUxfUE9TCQkJMTYKKyNkZWZpbmUgICBTVEFUVVNfU1JDX1NFTF9NQVNLCQkJR0VOTUFTSygx
OCwgMTYpCisjZGVmaW5lIERDU1NfRFBSX1NUQVRVU19DVFJMMQkJCTB4MTQwCisjZGVmaW5lIERD
U1NfRFBSX1JUUkFNX0NUUkwwCQkJMHgyMDAKKyNkZWZpbmUgICBOVU1fUk9XU19BQ1RJVkUJCQlC
SVQoMCkKKyNkZWZpbmUgICBUSFJFU19ISUdIX1BPUwkJCTEKKyNkZWZpbmUgICBUSFJFU19ISUdI
X01BU0sJCQlHRU5NQVNLKDMsIDEpCisjZGVmaW5lICAgVEhSRVNfTE9XX1BPUwkJCQk0CisjZGVm
aW5lICAgVEhSRVNfTE9XX01BU0sJCQlHRU5NQVNLKDYsIDQpCisjZGVmaW5lICAgQUJPUlRfU0VM
CQkJCUJJVCg3KQorCitzdHJ1Y3QgZGNzc19kcHJfY2ggeworCXN0cnVjdCBkY3NzX2RwciAqZHBy
OworCXZvaWQgX19pb21lbSAqYmFzZV9yZWc7CisJdTMyIGJhc2Vfb2ZzOworCisJc3RydWN0IGRy
bV9mb3JtYXRfaW5mbyBmb3JtYXQ7CisJZW51bSBkY3NzX3BpeF9zaXplIHBpeF9zaXplOworCWVu
dW0gZGNzc190aWxlX3R5cGUgdGlsZTsKKwlib29sIHJ0cmFtXzRsaW5lX2VuOworCWJvb2wgcnRy
YW1fM2J1Zl9lbjsKKworCXUzMiBmcmFtZV9jdHJsOworCXUzMiBtb2RlX2N0cmw7CisJdTMyIHN5
c19jdHJsOworCXUzMiBydHJhbV9jdHJsOworCisJYm9vbCBzeXNfY3RybF9jaGdkOworCisJdTMy
IHBpdGNoOworCisJaW50IGNoX251bTsKKwlpbnQgaXJxOworfTsKKworc3RydWN0IGRjc3NfZHBy
IHsKKwlzdHJ1Y3QgZGV2aWNlICpkZXY7CisJc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkOworCXUz
MiAgY3R4X2lkOworCisJc3RydWN0IGRjc3NfZHByX2NoIGNoWzNdOworfTsKKworc3RhdGljIHZv
aWQgZGNzc19kcHJfd3JpdGUoc3RydWN0IGRjc3NfZHByX2NoICpjaCwgdTMyIHZhbCwgdTMyIG9m
cykKK3sKKwlzdHJ1Y3QgZGNzc19kcHIgKmRwciA9IGNoLT5kcHI7CisKKwlkY3NzX2N0eGxkX3dy
aXRlKGRwci0+Y3R4bGQsIGRwci0+Y3R4X2lkLCB2YWwsIGNoLT5iYXNlX29mcyArIG9mcyk7Cit9
CisKK3N0YXRpYyBpbnQgZGNzc19kcHJfY2hfaW5pdF9hbGwoc3RydWN0IGRjc3NfZHByICpkcHIs
IHVuc2lnbmVkIGxvbmcgZHByX2Jhc2UpCit7CisJc3RydWN0IGRjc3NfZHByX2NoICpjaDsKKwlp
bnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKKwkJY2ggPSAmZHByLT5jaFtpXTsK
KworCQljaC0+YmFzZV9vZnMgPSBkcHJfYmFzZSArIGkgKiAweDEwMDA7CisKKwkJY2gtPmJhc2Vf
cmVnID0gZGV2bV9pb3JlbWFwKGRwci0+ZGV2LCBjaC0+YmFzZV9vZnMsIFNaXzRLKTsKKwkJaWYg
KCFjaC0+YmFzZV9yZWcpIHsKKwkJCWRldl9lcnIoZHByLT5kZXYsICJkcHI6IHVuYWJsZSB0byBy
ZW1hcCBjaCAlZCBiYXNlXG4iLAorCQkJCWkpOworCQkJcmV0dXJuIC1FTk9NRU07CisJCX0KKwor
CQljaC0+ZHByID0gZHByOworCQljaC0+Y2hfbnVtID0gaTsKKwl9CisKKwlyZXR1cm4gMDsKK30K
KworaW50IGRjc3NfZHByX2luaXQoc3RydWN0IGRjc3NfZGV2ICpkY3NzLCB1bnNpZ25lZCBsb25n
IGRwcl9iYXNlKQoreworCXN0cnVjdCBkY3NzX2RwciAqZHByOworCisJZHByID0gZGV2bV9remFs
bG9jKGRjc3MtPmRldiwgc2l6ZW9mKHN0cnVjdCBkY3NzX2RwciksIEdGUF9LRVJORUwpOworCWlm
ICghZHByKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRjc3MtPmRwciA9IGRwcjsKKwlkcHItPmRl
diA9IGRjc3MtPmRldjsKKwlkcHItPmN0eGxkID0gZGNzcy0+Y3R4bGQ7CisJZHByLT5jdHhfaWQg
PSBDVFhfU0JfSFA7CisKKwlpZiAoZGNzc19kcHJfY2hfaW5pdF9hbGwoZHByLCBkcHJfYmFzZSkp
IHsKKwkJaW50IGk7CisKKwkJZm9yIChpID0gMDsgaSA8IDM7IGkrKykgeworCQkJaWYgKGRwci0+
Y2hbaV0uYmFzZV9yZWcpCisJCQkJZGV2bV9pb3VubWFwKGRwci0+ZGV2LCBkcHItPmNoW2ldLmJh
c2VfcmVnKTsKKwkJfQorCisJCWRldm1fa2ZyZWUoZHByLT5kZXYsIGRwcik7CisKKwkJcmV0dXJu
IC1FTk9NRU07CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgZGNzc19kcHJfZXhpdChzdHJ1
Y3QgZGNzc19kcHIgKmRwcikKK3sKKwlpbnQgY2hfbm87CisKKwkvKiBzdG9wIERQUiBvbiBhbGwg
Y2hhbm5lbHMgKi8KKwlmb3IgKGNoX25vID0gMDsgY2hfbm8gPCAzOyBjaF9ubysrKSB7CisJCXN0
cnVjdCBkY3NzX2Rwcl9jaCAqY2ggPSAmZHByLT5jaFtjaF9ub107CisKKwkJZGNzc193cml0ZWwo
MCwgY2gtPmJhc2VfcmVnICsgRENTU19EUFJfU1lTVEVNX0NUUkwwKTsKKworCQlpZiAoY2gtPmJh
c2VfcmVnKQorCQkJZGV2bV9pb3VubWFwKGRwci0+ZGV2LCBjaC0+YmFzZV9yZWcpOworCX0KKwor
CWRldm1fa2ZyZWUoZHByLT5kZXYsIGRwcik7Cit9CisKK3N0YXRpYyB1MzIgZGNzc19kcHJfeF9w
aXhfd2lkZV9hZGp1c3Qoc3RydWN0IGRjc3NfZHByX2NoICpjaCwgdTMyIHBpeF93aWRlLAorCQkJ
CSAgICAgIHUzMiBwaXhfZm9ybWF0KQoreworCXU4IHBpeF9pbl82NGJ5dGVfbWFwWzNdWzVdID0g
eworCQkvKiBMSU4sIEdQVV9TVEQsIEdQVV9TVVAsIFZQVV9ZVVY0MjAsIFZQVV9WUDkgKi8KKwkJ
eyAgIDY0LCAgICAgICA4LCAgICAgICA4LCAgICAgICAgICA4LCAgICAgMTZ9LCAvKiBQSVhfU0la
RV84ICAqLworCQl7ICAgMzIsICAgICAgIDgsICAgICAgIDgsICAgICAgICAgIDgsICAgICAgOH0s
IC8qIFBJWF9TSVpFXzE2ICovCisJCXsgICAxNiwgICAgICAgNCwgICAgICAgNCwgICAgICAgICAg
OCwgICAgICA4fSwgLyogUElYX1NJWkVfMzIgKi8KKwl9OworCXUzMiBvZmZzZXQ7CisJdTMyIGRp
dl82NGJ5dGVfbW9kLCBwaXhfaW5fNjRieXRlOworCisJcGl4X2luXzY0Ynl0ZSA9IHBpeF9pbl82
NGJ5dGVfbWFwW2NoLT5waXhfc2l6ZV1bY2gtPnRpbGVdOworCisJZGl2XzY0Ynl0ZV9tb2QgPSBw
aXhfd2lkZSAlIHBpeF9pbl82NGJ5dGU7CisJb2Zmc2V0ID0gKGRpdl82NGJ5dGVfbW9kID09IDAp
ID8gMCA6IChwaXhfaW5fNjRieXRlIC0gZGl2XzY0Ynl0ZV9tb2QpOworCisJcmV0dXJuIHBpeF93
aWRlICsgb2Zmc2V0OworfQorCitzdGF0aWMgdTMyIGRjc3NfZHByX3lfcGl4X2hpZ2hfYWRqdXN0
KHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIHUzMiBwaXhfaGlnaCwKKwkJCQkgICAgICB1MzIgcGl4
X2Zvcm1hdCkKK3sKKwl1OCBudW1fcm93c19idWYgPSBjaC0+cnRyYW1fNGxpbmVfZW4gPyA0IDog
ODsKKwl1MzIgb2Zmc2V0LCBwaXhfeV9tb2Q7CisKKwlwaXhfeV9tb2QgPSBwaXhfaGlnaCAlIG51
bV9yb3dzX2J1ZjsKKwlvZmZzZXQgPSBwaXhfeV9tb2QgPyAobnVtX3Jvd3NfYnVmIC0gcGl4X3lf
bW9kKSA6IDA7CisKKwlyZXR1cm4gcGl4X2hpZ2ggKyBvZmZzZXQ7Cit9CisKK3ZvaWQgZGNzc19k
cHJfc2V0X3JlcyhzdHJ1Y3QgZGNzc19kcHIgKmRwciwgaW50IGNoX251bSwgdTMyIHhyZXMsIHUz
MiB5cmVzKQoreworCXN0cnVjdCBkY3NzX2Rwcl9jaCAqY2ggPSAmZHByLT5jaFtjaF9udW1dOwor
CXUzMiBwaXhfZm9ybWF0ID0gY2gtPmZvcm1hdC5mb3JtYXQ7CisJdTMyIGdhcCA9IERDU1NfRFBS
X0ZSQU1FXzJQX0JBU0VfQUREUiAtIERDU1NfRFBSX0ZSQU1FXzFQX0JBU0VfQUREUjsKKwlpbnQg
cGxhbmUsIG1heF9wbGFuZXMgPSAxOworCXUzMiBwaXhfeF93aWRlLCBwaXhfeV9oaWdoOworCisJ
aWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9OVjEyIHx8CisJICAgIHBpeF9mb3JtYXQgPT0g
RFJNX0ZPUk1BVF9OVjIxKQorCQltYXhfcGxhbmVzID0gMjsKKworCWZvciAocGxhbmUgPSAwOyBw
bGFuZSA8IG1heF9wbGFuZXM7IHBsYW5lKyspIHsKKwkJeXJlcyA9IHBsYW5lID09IDEgPyB5cmVz
ID4+IDEgOiB5cmVzOworCisJCXBpeF94X3dpZGUgPSBkY3NzX2Rwcl94X3BpeF93aWRlX2FkanVz
dChjaCwgeHJlcywgcGl4X2Zvcm1hdCk7CisJCXBpeF95X2hpZ2ggPSBkY3NzX2Rwcl95X3BpeF9o
aWdoX2FkanVzdChjaCwgeXJlcywgcGl4X2Zvcm1hdCk7CisKKwkJaWYgKHBsYW5lID09IDApCisJ
CQljaC0+cGl0Y2ggPSBwaXhfeF93aWRlOworCisJCWRjc3NfZHByX3dyaXRlKGNoLCBwaXhfeF93
aWRlLAorCQkJICAgICAgIERDU1NfRFBSX0ZSQU1FXzFQX1BJWF9YX0NUUkwgKyBwbGFuZSAqIGdh
cCk7CisJCWRjc3NfZHByX3dyaXRlKGNoLCBwaXhfeV9oaWdoLAorCQkJICAgICAgIERDU1NfRFBS
X0ZSQU1FXzFQX1BJWF9ZX0NUUkwgKyBwbGFuZSAqIGdhcCk7CisKKwkJZGNzc19kcHJfd3JpdGUo
Y2gsIDIsIERDU1NfRFBSX0ZSQU1FXzFQX0NUUkwwICsgcGxhbmUgKiBnYXApOworCX0KK30KKwor
dm9pZCBkY3NzX2Rwcl9hZGRyX3NldChzdHJ1Y3QgZGNzc19kcHIgKmRwciwgaW50IGNoX251bSwg
dTMyIGx1bWFfYmFzZV9hZGRyLAorCQkgICAgICAgdTMyIGNocm9tYV9iYXNlX2FkZHIsIHUxNiBw
aXRjaCkKK3sKKwlzdHJ1Y3QgZGNzc19kcHJfY2ggKmNoID0gJmRwci0+Y2hbY2hfbnVtXTsKKwor
CWRjc3NfZHByX3dyaXRlKGNoLCBsdW1hX2Jhc2VfYWRkciwgRENTU19EUFJfRlJBTUVfMVBfQkFT
RV9BRERSKTsKKworCWRjc3NfZHByX3dyaXRlKGNoLCBjaHJvbWFfYmFzZV9hZGRyLCBEQ1NTX0RQ
Ul9GUkFNRV8yUF9CQVNFX0FERFIpOworCisJY2gtPmZyYW1lX2N0cmwgJj0gflBJVENIX01BU0s7
CisJY2gtPmZyYW1lX2N0cmwgfD0gKCgodTMyKXBpdGNoIDw8IFBJVENIX1BPUykgJiBQSVRDSF9N
QVNLKTsKK30KKworc3RhdGljIHZvaWQgZGNzc19kcHJfYXJnYl9jb21wX3NlbChzdHJ1Y3QgZGNz
c19kcHJfY2ggKmNoLCBpbnQgYV9zZWwsIGludCByX3NlbCwKKwkJCQkgICBpbnQgZ19zZWwsIGlu
dCBiX3NlbCkKK3sKKwl1MzIgc2VsOworCisJc2VsID0gKChhX3NlbCA8PCBBX0NPTVBfU0VMX1BP
UykgJiBBX0NPTVBfU0VMX01BU0spIHwKKwkgICAgICAoKHJfc2VsIDw8IFJfQ09NUF9TRUxfUE9T
KSAmIFJfQ09NUF9TRUxfTUFTSykgfAorCSAgICAgICgoZ19zZWwgPDwgR19DT01QX1NFTF9QT1Mp
ICYgR19DT01QX1NFTF9NQVNLKSB8CisJICAgICAgKChiX3NlbCA8PCBCX0NPTVBfU0VMX1BPUykg
JiBCX0NPTVBfU0VMX01BU0spOworCisJY2gtPm1vZGVfY3RybCAmPSB+KEFfQ09NUF9TRUxfTUFT
SyB8IFJfQ09NUF9TRUxfTUFTSyB8CisJCQkgICBHX0NPTVBfU0VMX01BU0sgfCBCX0NPTVBfU0VM
X01BU0spOworCWNoLT5tb2RlX2N0cmwgfD0gc2VsOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rw
cl9waXhfc2l6ZV9zZXQoc3RydWN0IGRjc3NfZHByX2NoICpjaCwKKwkJCQkgIGNvbnN0IHN0cnVj
dCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCkKK3sKKwl1MzIgdmFsOworCisJc3dpdGNoIChmb3Jt
YXQtPmZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9OVjEyOgorCWNhc2UgRFJNX0ZPUk1BVF9O
VjIxOgorCQl2YWwgPSAwOworCQlicmVhazsKKworCWNhc2UgRFJNX0ZPUk1BVF9VWVZZOgorCWNh
c2UgRFJNX0ZPUk1BVF9WWVVZOgorCWNhc2UgRFJNX0ZPUk1BVF9ZVVlWOgorCWNhc2UgRFJNX0ZP
Uk1BVF9ZVllVOgorCQl2YWwgPSAxOworCQlicmVhazsKKworCWRlZmF1bHQ6CisJCXZhbCA9IDI7
CisJCWJyZWFrOworCX0KKworCWNoLT5waXhfc2l6ZSA9IHZhbDsKKworCWNoLT5tb2RlX2N0cmwg
Jj0gflBJWF9TSVpFX01BU0s7CisJY2gtPm1vZGVfY3RybCB8PSAoKHZhbCA8PCBQSVhfU0laRV9Q
T1MpICYgUElYX1NJWkVfTUFTSyk7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfZHByX3V2X3N3YXAo
c3RydWN0IGRjc3NfZHByX2NoICpjaCwgYm9vbCBzd2FwKQoreworCWNoLT5tb2RlX2N0cmwgJj0g
flBJWF9VVl9TV0FQOworCWNoLT5tb2RlX2N0cmwgfD0gKHN3YXAgPyBQSVhfVVZfU1dBUCA6IDAp
OworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rwcl95X3V2X3N3YXAoc3RydWN0IGRjc3NfZHByX2No
ICpjaCwgYm9vbCBzd2FwKQoreworCWNoLT5tb2RlX2N0cmwgJj0gflBJWF9MVU1BX1VWX1NXQVA7
CisJY2gtPm1vZGVfY3RybCB8PSAoc3dhcCA/IFBJWF9MVU1BX1VWX1NXQVAgOiAwKTsKK30KKwor
c3RhdGljIHZvaWQgZGNzc19kcHJfMnBsYW5lX2VuKHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIGJv
b2wgZW4pCit7CisJY2gtPm1vZGVfY3RybCAmPSB+Q09NUF8yUExBTkVfRU47CisJY2gtPm1vZGVf
Y3RybCB8PSAoZW4gPyBDT01QXzJQTEFORV9FTiA6IDApOworfQorCitzdGF0aWMgdm9pZCBkY3Nz
X2Rwcl95dXZfZW4oc3RydWN0IGRjc3NfZHByX2NoICpjaCwgYm9vbCBlbikKK3sKKwljaC0+bW9k
ZV9jdHJsICY9IH5ZVVZfRU47CisJY2gtPm1vZGVfY3RybCB8PSAoZW4gPyBZVVZfRU4gOiAwKTsK
K30KKwordm9pZCBkY3NzX2Rwcl9lbmFibGUoc3RydWN0IGRjc3NfZHByICpkcHIsIGludCBjaF9u
dW0sIGJvb2wgZW4pCit7CisJc3RydWN0IGRjc3NfZHByX2NoICpjaCA9ICZkcHItPmNoW2NoX251
bV07CisJdTMyIHN5c19jdHJsOworCisJc3lzX2N0cmwgPSAoZW4gPyBSRVBFQVRfRU4gfCBSVU5f
RU4gOiAwKTsKKworCWlmIChlbikgeworCQlkY3NzX2Rwcl93cml0ZShjaCwgY2gtPm1vZGVfY3Ry
bCwgRENTU19EUFJfTU9ERV9DVFJMMCk7CisJCWRjc3NfZHByX3dyaXRlKGNoLCBjaC0+ZnJhbWVf
Y3RybCwgRENTU19EUFJfRlJBTUVfQ1RSTDApOworCQlkY3NzX2Rwcl93cml0ZShjaCwgY2gtPnJ0
cmFtX2N0cmwsIERDU1NfRFBSX1JUUkFNX0NUUkwwKTsKKwl9CisKKwlpZiAoY2gtPnN5c19jdHJs
ICE9IHN5c19jdHJsKQorCQljaC0+c3lzX2N0cmxfY2hnZCA9IHRydWU7CisKKwljaC0+c3lzX2N0
cmwgPSBzeXNfY3RybDsKK30KKworc3RydWN0IHJnYl9jb21wX3NlbCB7CisJdTMyIGRybV9mb3Jt
YXQ7CisJaW50IGFfc2VsOworCWludCByX3NlbDsKKwlpbnQgZ19zZWw7CisJaW50IGJfc2VsOwor
fTsKKworc3RhdGljIHN0cnVjdCByZ2JfY29tcF9zZWwgY29tcF9zZWxfbWFwW10gPSB7CisJe0RS
TV9GT1JNQVRfQVJHQjg4ODgsIDMsIDIsIDEsIDB9LAorCXtEUk1fRk9STUFUX1hSR0I4ODg4LCAz
LCAyLCAxLCAwfSwKKwl7RFJNX0ZPUk1BVF9BQkdSODg4OCwgMywgMCwgMSwgMn0sCisJe0RSTV9G
T1JNQVRfWEJHUjg4ODgsIDMsIDAsIDEsIDJ9LAorCXtEUk1fRk9STUFUX1JHQkE4ODg4LCAwLCAz
LCAyLCAxfSwKKwl7RFJNX0ZPUk1BVF9SR0JYODg4OCwgMCwgMywgMiwgMX0sCisJe0RSTV9GT1JN
QVRfQkdSQTg4ODgsIDAsIDEsIDIsIDN9LAorCXtEUk1fRk9STUFUX0JHUlg4ODg4LCAwLCAxLCAy
LCAzfSwKK307CisKK3N0YXRpYyBpbnQgdG9fY29tcF9zZWwodTMyIHBpeF9mbXQsIGludCAqYV9z
ZWwsIGludCAqcl9zZWwsIGludCAqZ19zZWwsCisJCSAgICAgICBpbnQgKmJfc2VsKQoreworCWlu
dCBpOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY29tcF9zZWxfbWFwKTsgaSsrKSB7
CisJCWlmIChjb21wX3NlbF9tYXBbaV0uZHJtX2Zvcm1hdCA9PSBwaXhfZm10KSB7CisJCQkqYV9z
ZWwgPSBjb21wX3NlbF9tYXBbaV0uYV9zZWw7CisJCQkqcl9zZWwgPSBjb21wX3NlbF9tYXBbaV0u
cl9zZWw7CisJCQkqZ19zZWwgPSBjb21wX3NlbF9tYXBbaV0uZ19zZWw7CisJCQkqYl9zZWwgPSBj
b21wX3NlbF9tYXBbaV0uYl9zZWw7CisKKwkJCXJldHVybiAwOworCQl9CisJfQorCisJcmV0dXJu
IC0xOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rwcl9ydHJhbV9zZXQoc3RydWN0IGRjc3NfZHBy
X2NoICpjaCwgdTMyIHBpeF9mb3JtYXQpCit7CisJdTMyIHZhbCwgbWFzazsKKworCXN3aXRjaCAo
cGl4X2Zvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9OVjIxOgorCWNhc2UgRFJNX0ZPUk1BVF9O
VjEyOgorCQljaC0+cnRyYW1fM2J1Zl9lbiA9IHRydWU7CisJCWNoLT5ydHJhbV80bGluZV9lbiA9
IGZhbHNlOworCQlicmVhazsKKworCWRlZmF1bHQ6CisJCWNoLT5ydHJhbV8zYnVmX2VuID0gdHJ1
ZTsKKwkJY2gtPnJ0cmFtXzRsaW5lX2VuID0gdHJ1ZTsKKwkJYnJlYWs7CisJfQorCisJdmFsID0g
KGNoLT5ydHJhbV80bGluZV9lbiA/IFJUUl80TElORV9CVUZfRU4gOiAwKTsKKwl2YWwgfD0gKGNo
LT5ydHJhbV8zYnVmX2VuID8gUlRSXzNCVUZfRU4gOiAwKTsKKwltYXNrID0gUlRSXzRMSU5FX0JV
Rl9FTiB8IFJUUl8zQlVGX0VOOworCisJY2gtPm1vZGVfY3RybCAmPSB+bWFzazsKKwljaC0+bW9k
ZV9jdHJsIHw9ICh2YWwgJiBtYXNrKTsKKworCXZhbCA9IChjaC0+cnRyYW1fNGxpbmVfZW4gPyAw
IDogTlVNX1JPV1NfQUNUSVZFKTsKKwl2YWwgfD0gKDMgPDwgVEhSRVNfTE9XX1BPUykgJiBUSFJF
U19MT1dfTUFTSzsKKwl2YWwgfD0gKDQgPDwgVEhSRVNfSElHSF9QT1MpICYgVEhSRVNfSElHSF9N
QVNLOworCW1hc2sgPSBUSFJFU19MT1dfTUFTSyB8IFRIUkVTX0hJR0hfTUFTSyB8IE5VTV9ST1dT
X0FDVElWRTsKKworCWNoLT5ydHJhbV9jdHJsICY9IH5tYXNrOworCWNoLT5ydHJhbV9jdHJsIHw9
ICh2YWwgJiBtYXNrKTsKK30KKworc3RhdGljIHZvaWQgZGNzc19kcHJfc2V0dXBfY29tcG9uZW50
cyhzdHJ1Y3QgZGNzc19kcHJfY2ggKmNoLAorCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZm9y
bWF0X2luZm8gKmZvcm1hdCkKK3sKKwlpbnQgYV9zZWwsIHJfc2VsLCBnX3NlbCwgYl9zZWw7CisJ
Ym9vbCB1dl9zd2FwLCB5X3V2X3N3YXA7CisKKwlzd2l0Y2ggKGZvcm1hdC0+Zm9ybWF0KSB7CisJ
Y2FzZSBEUk1fRk9STUFUX1lWWVU6CisJCXV2X3N3YXAgPSB0cnVlOworCQl5X3V2X3N3YXAgPSB0
cnVlOworCQlicmVhazsKKworCWNhc2UgRFJNX0ZPUk1BVF9WWVVZOgorCWNhc2UgRFJNX0ZPUk1B
VF9OVjIxOgorCQl1dl9zd2FwID0gdHJ1ZTsKKwkJeV91dl9zd2FwID0gZmFsc2U7CisJCWJyZWFr
OworCisJY2FzZSBEUk1fRk9STUFUX1lVWVY6CisJCXV2X3N3YXAgPSBmYWxzZTsKKwkJeV91dl9z
d2FwID0gdHJ1ZTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQl1dl9zd2FwID0gZmFsc2U7CisJ
CXlfdXZfc3dhcCA9IGZhbHNlOworCQlicmVhazsKKwl9CisKKwlkY3NzX2Rwcl91dl9zd2FwKGNo
LCB1dl9zd2FwKTsKKworCWRjc3NfZHByX3lfdXZfc3dhcChjaCwgeV91dl9zd2FwKTsKKworCWlm
ICghZm9ybWF0LT5pc195dXYpIHsKKwkJaWYgKCF0b19jb21wX3NlbChmb3JtYXQtPmZvcm1hdCwg
JmFfc2VsLCAmcl9zZWwsCisJCQkJICZnX3NlbCwgJmJfc2VsKSkgeworCQkJZGNzc19kcHJfYXJn
Yl9jb21wX3NlbChjaCwgYV9zZWwsIHJfc2VsLCBnX3NlbCwgYl9zZWwpOworCQl9IGVsc2Ugewor
CQkJZGNzc19kcHJfYXJnYl9jb21wX3NlbChjaCwgMywgMiwgMSwgMCk7CisJCX0KKwl9IGVsc2Ug
eworCQlkY3NzX2Rwcl9hcmdiX2NvbXBfc2VsKGNoLCAwLCAwLCAwLCAwKTsKKwl9Cit9CisKK3N0
YXRpYyB2b2lkIGRjc3NfZHByX3RpbGVfc2V0KHN0cnVjdCBkY3NzX2Rwcl9jaCAqY2gsIHVpbnQ2
NF90IG1vZGlmaWVyKQoreworCXN3aXRjaCAoY2gtPmNoX251bSkgeworCWNhc2UgMDoKKwkJc3dp
dGNoIChtb2RpZmllcikgeworCQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKKwkJCWNoLT50
aWxlID0gVElMRV9MSU5FQVI7CisJCQlicmVhazsKKwkJY2FzZSBEUk1fRk9STUFUX01PRF9WSVZB
TlRFX1RJTEVEOgorCQkJY2gtPnRpbGUgPSBUSUxFX0dQVV9TVEFOREFSRDsKKwkJCWJyZWFrOwor
CQljYXNlIERSTV9GT1JNQVRfTU9EX1ZJVkFOVEVfU1VQRVJfVElMRUQ6CisJCQljaC0+dGlsZSA9
IFRJTEVfR1BVX1NVUEVSOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlXQVJOX09OKDEpOwor
CQkJYnJlYWs7CisJCX0KKwkJYnJlYWs7CisJY2FzZSAxOgorCWNhc2UgMjoKKwkJY2gtPnRpbGUg
PSBUSUxFX0xJTkVBUjsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJV0FSTl9PTigxKTsKKwkJcmV0
dXJuOworCX0KKworCWNoLT5tb2RlX2N0cmwgJj0gflRJTEVfVFlQRV9NQVNLOworCWNoLT5tb2Rl
X2N0cmwgfD0gKChjaC0+dGlsZSA8PCBUSUxFX1RZUEVfUE9TKSAmIFRJTEVfVFlQRV9NQVNLKTsK
K30KKwordm9pZCBkY3NzX2Rwcl9mb3JtYXRfc2V0KHN0cnVjdCBkY3NzX2RwciAqZHByLCBpbnQg
Y2hfbnVtLAorCQkJIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1hdCwgdTY0IG1v
ZGlmaWVyKQoreworCXN0cnVjdCBkY3NzX2Rwcl9jaCAqY2ggPSAmZHByLT5jaFtjaF9udW1dOwor
CisJY2gtPmZvcm1hdCA9ICpmb3JtYXQ7CisKKwlkY3NzX2Rwcl95dXZfZW4oY2gsIGZvcm1hdC0+
aXNfeXV2KTsKKworCWRjc3NfZHByX3BpeF9zaXplX3NldChjaCwgZm9ybWF0KTsKKworCWRjc3Nf
ZHByX3NldHVwX2NvbXBvbmVudHMoY2gsIGZvcm1hdCk7CisKKwlkY3NzX2Rwcl8ycGxhbmVfZW4o
Y2gsIGZvcm1hdC0+bnVtX3BsYW5lcyA9PSAyKTsKKworCWRjc3NfZHByX3J0cmFtX3NldChjaCwg
Zm9ybWF0LT5mb3JtYXQpOworCisJZGNzc19kcHJfdGlsZV9zZXQoY2gsIG1vZGlmaWVyKTsKK30K
KworLyogVGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBmcm9tIGludGVycnVwdCBjb250ZXh0
LiAqLwordm9pZCBkY3NzX2Rwcl93cml0ZV9zeXNjdHJsKHN0cnVjdCBkY3NzX2RwciAqZHByKQor
eworCWludCBjaG51bTsKKworCWZvciAoY2hudW0gPSAwOyBjaG51bSA8IDM7IGNobnVtKyspIHsK
KwkJc3RydWN0IGRjc3NfZHByX2NoICpjaCA9ICZkcHItPmNoW2NobnVtXTsKKworCQlpZiAoY2gt
PnN5c19jdHJsX2NoZ2QpIHsKKwkJCWRjc3NfY3R4bGRfd3JpdGVfaXJxc2FmZShkcHItPmN0eGxk
LCBkcHItPmN0eF9pZCwKKwkJCQkJCSBjaC0+c3lzX2N0cmwsCisJCQkJCQkgY2gtPmJhc2Vfb2Zz
ICsKKwkJCQkJCSBEQ1NTX0RQUl9TWVNURU1fQ1RSTDApOworCQkJY2gtPnN5c19jdHJsX2NoZ2Qg
PSBmYWxzZTsKKwkJfQorCX0KK30KKwordm9pZCBkY3NzX2Rwcl9zZXRfcm90YXRpb24oc3RydWN0
IGRjc3NfZHByICpkcHIsIGludCBjaF9udW0sIHUzMiByb3RhdGlvbikKK3sKKwlzdHJ1Y3QgZGNz
c19kcHJfY2ggKmNoID0gJmRwci0+Y2hbY2hfbnVtXTsKKworCWNoLT5mcmFtZV9jdHJsICY9IH4o
SEZMSVBfRU4gfCBWRkxJUF9FTiB8IFJPVF9FTkNfTUFTSyk7CisKKwljaC0+ZnJhbWVfY3RybCB8
PSByb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWCA/IEhGTElQX0VOIDogMDsKKwljaC0+ZnJh
bWVfY3RybCB8PSByb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWSA/IFZGTElQX0VOIDogMDsK
KworCWlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV85MCkKKwkJY2gtPmZyYW1lX2N0cmwg
fD0gMSA8PCBST1RfRU5DX1BPUzsKKwllbHNlIGlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFU
RV8xODApCisJCWNoLT5mcmFtZV9jdHJsIHw9IDIgPDwgUk9UX0VOQ19QT1M7CisJZWxzZSBpZiAo
cm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMjcwKQorCQljaC0+ZnJhbWVfY3RybCB8PSAzIDw8
IFJPVF9FTkNfUE9TOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rj
c3MtZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kcnYuYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMC4uN2VhMTMxZAotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWRydi5jCkBAIC0wLDAgKzEsMTgyIEBACisvLyBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAyMDE5IE5Y
UC4KKyAqLworCisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+CisjaW5jbHVkZSA8bGludXgva2Vy
bmVsLmg+CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8bGlu
dXgvY29tcG9uZW50Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9vZi5oPgorI2luY2x1ZGUgPGRybS9k
cm1QLmg+CisKKyNpbmNsdWRlICJkY3NzLWRldi5oIgorI2luY2x1ZGUgImRjc3Mta21zLmgiCisK
K3N0cnVjdCBkY3NzX2RydiB7CisJc3RydWN0IGRjc3NfZGV2ICpkY3NzOworCXN0cnVjdCBkY3Nz
X2ttc19kZXYgKmttczsKKworCWJvb2wgaXNfY29tcG9uZW50aXplZDsKK307CisKK3N0cnVjdCBk
Y3NzX2RldiAqZGNzc19kcnZfZGV2X3RvX2Rjc3Moc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0
cnVjdCBkY3NzX2RydiAqbWRydiA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJcmV0dXJuIG1k
cnYgPyBtZHJ2LT5kY3NzIDogTlVMTDsKK30KKworc3RydWN0IGRybV9kZXZpY2UgKmRjc3NfZHJ2
X2Rldl90b19kcm0oc3RydWN0IGRldmljZSAqZGV2KQoreworCXN0cnVjdCBkY3NzX2RydiAqbWRy
diA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOworCisJcmV0dXJuIG1kcnYgPyAmbWRydi0+a21zLT5i
YXNlIDogTlVMTDsKK30KKworc3RhdGljIGludCBkY3NzX2Rydl9pbml0KHN0cnVjdCBkZXZpY2Ug
KmRldiwgYm9vbCBjb21wb25lbnRpemVkKQoreworCXN0cnVjdCBkY3NzX2RydiAqbWRydjsKKwlp
bnQgZXJyID0gMDsKKworCW1kcnYgPSBkZXZtX2t6YWxsb2MoZGV2LCBzaXplb2YoKm1kcnYpLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIW1kcnYpCisJCXJldHVybiAtRU5PTUVNOworCisJbWRydi0+aXNf
Y29tcG9uZW50aXplZCA9IGNvbXBvbmVudGl6ZWQ7CisKKwltZHJ2LT5kY3NzID0gZGNzc19kZXZf
Y3JlYXRlKGRldiwgY29tcG9uZW50aXplZCk7CisJaWYgKElTX0VSUihtZHJ2LT5kY3NzKSkgewor
CQllcnIgPSBQVFJfRVJSKG1kcnYtPmRjc3MpOworCQlnb3RvIGVycjsKKwl9CisKKwlkZXZfc2V0
X2RydmRhdGEoZGV2LCBtZHJ2KTsKKworCW1kcnYtPmttcyA9IGRjc3Nfa21zX2F0dGFjaChtZHJ2
LT5kY3NzLCBjb21wb25lbnRpemVkKTsKKwlpZiAoSVNfRVJSKG1kcnYtPmttcykpIHsKKwkJZXJy
ID0gUFRSX0VSUihtZHJ2LT5rbXMpOworCQlnb3RvIGRjc3Nfc2h1dG9mZjsKKwl9CisKKwlyZXR1
cm4gMDsKKworZGNzc19zaHV0b2ZmOgorCWRjc3NfZGV2X2Rlc3Ryb3kobWRydi0+ZGNzcyk7CisK
KwlkZXZfc2V0X2RydmRhdGEoZGV2LCBOVUxMKTsKKworZXJyOgorCWRldm1fa2ZyZWUoZGV2LCBt
ZHJ2KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rydl9kZWluaXQoc3Ry
dWN0IGRldmljZSAqZGV2LCBib29sIGNvbXBvbmVudGl6ZWQpCit7CisJc3RydWN0IGRjc3NfZHJ2
ICptZHJ2ID0gZGV2X2dldF9kcnZkYXRhKGRldik7CisKKwlpZiAoIW1kcnYpCisJCXJldHVybjsK
KworCWRjc3Nfa21zX2RldGFjaChtZHJ2LT5rbXMsIGNvbXBvbmVudGl6ZWQpOworCWRjc3NfZGV2
X2Rlc3Ryb3kobWRydi0+ZGNzcyk7CisKKwlkZXZfc2V0X2RydmRhdGEoZGV2LCBOVUxMKTsKK30K
Kworc3RhdGljIGludCBkY3NzX2Rydl9iaW5kKHN0cnVjdCBkZXZpY2UgKmRldikKK3sKKwlyZXR1
cm4gZGNzc19kcnZfaW5pdChkZXYsIHRydWUpOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Rydl91
bmJpbmQoc3RydWN0IGRldmljZSAqZGV2KQoreworCXJldHVybiBkY3NzX2Rydl9kZWluaXQoZGV2
LCB0cnVlKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBjb21wb25lbnRfbWFzdGVyX29wcyBk
Y3NzX21hc3Rlcl9vcHMgPSB7CisJLmJpbmQJPSBkY3NzX2Rydl9iaW5kLAorCS51bmJpbmQJPSBk
Y3NzX2Rydl91bmJpbmQsCit9OworCitzdGF0aWMgaW50IGNvbXBhcmVfb2Yoc3RydWN0IGRldmlj
ZSAqZGV2LCB2b2lkICpkYXRhKQoreworCXJldHVybiBkZXYtPm9mX25vZGUgPT0gZGF0YTsKK30K
Kworc3RhdGljIGludCBkY3NzX2Rydl9wbGF0Zm9ybV9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2
aWNlICpwZGV2KQoreworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZwZGV2LT5kZXY7CisJc3RydWN0
IGNvbXBvbmVudF9tYXRjaCAqbWF0Y2ggPSBOVUxMOworCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcmVt
b3RlOworCisJaWYgKCFkZXYtPm9mX25vZGUpCisJCXJldHVybiAtRU5PREVWOworCisJcmVtb3Rl
ID0gb2ZfZ3JhcGhfZ2V0X3JlbW90ZV9ub2RlKGRldi0+b2Zfbm9kZSwgMCwgMCk7CisJaWYgKCFy
ZW1vdGUpCisJCXJldHVybiAtRU5PREVWOworCisJaWYgKG9mX2RldmljZV9pc19jb21wYXRpYmxl
KHJlbW90ZSwgImZzbCxpbXg4bXEtbndsLWRzaSIpKSB7CisJCW9mX25vZGVfcHV0KHJlbW90ZSk7
CisJCXJldHVybiBkY3NzX2Rydl9pbml0KGRldiwgZmFsc2UpOworCX0KKworCWRybV9vZl9jb21w
b25lbnRfbWF0Y2hfYWRkKGRldiwgJm1hdGNoLCBjb21wYXJlX29mLCByZW1vdGUpOworCW9mX25v
ZGVfcHV0KHJlbW90ZSk7CisKKwlyZXR1cm4gY29tcG9uZW50X21hc3Rlcl9hZGRfd2l0aF9tYXRj
aChkZXYsICZkY3NzX21hc3Rlcl9vcHMsIG1hdGNoKTsKK30KKworc3RhdGljIGludCBkY3NzX2Ry
dl9wbGF0Zm9ybV9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKK3sKKwlzdHJ1
Y3QgZGNzc19kcnYgKm1kcnYgPSBkZXZfZ2V0X2RydmRhdGEoJnBkZXYtPmRldik7CisKKwlpZiAo
bWRydi0+aXNfY29tcG9uZW50aXplZCkKKwkJY29tcG9uZW50X21hc3Rlcl9kZWwoJnBkZXYtPmRl
diwgJmRjc3NfbWFzdGVyX29wcyk7CisJZWxzZQorCQlkY3NzX2Rydl9kZWluaXQoJnBkZXYtPmRl
diwgZmFsc2UpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZGNzc190eXBlX2Rh
dGEgZGNzc190eXBlc1tdID0geworCVtEQ1NTX0lNWDhNUV0gPSB7CisJCS5uYW1lID0gIkRDU1Nf
SU1YOE1RIiwKKwkJLmJsa2N0bF9vZnMgPSAweDJGMDAwLAorCQkuY3R4bGRfb2ZzID0gMHgyMzAw
MCwKKwkJLmR0Z19vZnMgPSAweDIwMDAwLAorCQkuc2NhbGVyX29mcyA9IDB4MUMwMDAsCisJCS5z
c19vZnMgPSAweDFCMDAwLAorCQkuZHByX29mcyA9IDB4MTgwMDAsCisJfSwKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGRjc3Nfb2ZfbWF0Y2hbXSA9IHsKKwl7IC5jb21w
YXRpYmxlID0gIm54cCxpbXg4bXEtZGNzcyIsIC5kYXRhID0gJmRjc3NfdHlwZXNbRENTU19JTVg4
TVFdLCB9LAorCXt9LAorfTsKKworTU9EVUxFX0RFVklDRV9UQUJMRShvZiwgZGNzc19vZl9tYXRj
aCk7CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyBkY3NzX2Rldl9wbSA9IHsKKwlT
RVRfU1lTVEVNX1NMRUVQX1BNX09QUyhkY3NzX2Rldl9zdXNwZW5kLCBkY3NzX2Rldl9yZXN1bWUp
CisJU0VUX1JVTlRJTUVfUE1fT1BTKGRjc3NfZGV2X3J1bnRpbWVfc3VzcGVuZCwKKwkJCSAgIGRj
c3NfZGV2X3J1bnRpbWVfcmVzdW1lLCBOVUxMKQorfTsKKworc3RhdGljIHN0cnVjdCBwbGF0Zm9y
bV9kcml2ZXIgZGNzc19wbGF0Zm9ybV9kcml2ZXIgPSB7CisJLnByb2JlCT0gZGNzc19kcnZfcGxh
dGZvcm1fcHJvYmUsCisJLnJlbW92ZQk9IGRjc3NfZHJ2X3BsYXRmb3JtX3JlbW92ZSwKKwkuZHJp
dmVyCT0geworCQkubmFtZSA9ICJpbXgtZGNzcyIsCisJCS5vZl9tYXRjaF90YWJsZQk9IGRjc3Nf
b2ZfbWF0Y2gsCisJCS5wbSA9ICZkY3NzX2Rldl9wbSwKKwl9LAorfTsKKworbW9kdWxlX3BsYXRm
b3JtX2RyaXZlcihkY3NzX3BsYXRmb3JtX2RyaXZlcik7CisKK01PRFVMRV9BVVRIT1IoIkxhdXJl
bnRpdSBQYWxjdSA8bGF1cmVudGl1LnBhbGN1QG54cC5jb20+Iik7CitNT0RVTEVfREVTQ1JJUFRJ
T04oIkRDU1MgZHJpdmVyIGZvciBpLk1YOE1RIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1kdGcuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWR0Zy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwLi5jODNiM2JiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lt
eC9kY3NzL2Rjc3MtZHRnLmMKQEAgLTAsMCArMSw0MzggQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVu
dGlmaWVyOiBHUEwtMi4wCisvKgorICogQ29weXJpZ2h0IDIwMTkgTlhQLgorICovCisKKyNpbmNs
dWRlIDxsaW51eC9jbGsuaD4KKyNpbmNsdWRlIDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxp
bnV4L2ludGVycnVwdC5oPgorI2luY2x1ZGUgPGxpbnV4L29mLmg+CisjaW5jbHVkZSA8bGludXgv
cGxhdGZvcm1fZGV2aWNlLmg+CisKKyNpbmNsdWRlICJkY3NzLWRldi5oIgorCisjZGVmaW5lIERD
U1NfRFRHX1RDX0NPTlRST0xfU1RBVFVTCQkJMHgwMAorI2RlZmluZSAgIENIM19FTgkJCQkJQklU
KDApCisjZGVmaW5lICAgQ0gyX0VOCQkJCQlCSVQoMSkKKyNkZWZpbmUgICBDSDFfRU4JCQkJCUJJ
VCgyKQorI2RlZmluZSAgIE9WTF9EQVRBX01PREUJCQkJCUJJVCgzKQorI2RlZmluZSAgIEJMRU5E
RVJfVklERU9fQUxQSEFfU0VMCQkJQklUKDcpCisjZGVmaW5lICAgRFRHX1NUQVJUCQkJCQlCSVQo
OCkKKyNkZWZpbmUgICBEQllfTU9ERV9FTgkJCQkJQklUKDkpCisjZGVmaW5lICAgQ0gxX0FMUEhB
X1NFTAkJCQkJQklUKDEwKQorI2RlZmluZSAgIENTU19QSVhfQ09NUF9TV0FQX1BPUwkJCQkxMgor
I2RlZmluZSAgIENTU19QSVhfQ09NUF9TV0FQX01BU0sJCQlHRU5NQVNLKDE0LCAxMikKKyNkZWZp
bmUgICBERUZBVUxUX0ZHX0FMUEhBX1BPUwkJCQkyNAorI2RlZmluZSAgIERFRkFVTFRfRkdfQUxQ
SEFfTUFTSwkJCQlHRU5NQVNLKDMxLCAyNCkKKyNkZWZpbmUgRENTU19EVEdfVENfRFRHCQkJCQkw
eDA0CisjZGVmaW5lIERDU1NfRFRHX1RDX0RJU1BfVE9QCQkJCTB4MDgKKyNkZWZpbmUgRENTU19E
VEdfVENfRElTUF9CT1QJCQkJMHgwQworI2RlZmluZSBEQ1NTX0RUR19UQ19DSDFfVE9QCQkJCTB4
MTAKKyNkZWZpbmUgRENTU19EVEdfVENfQ0gxX0JPVAkJCQkweDE0CisjZGVmaW5lIERDU1NfRFRH
X1RDX0NIMl9UT1AJCQkJMHgxOAorI2RlZmluZSBEQ1NTX0RUR19UQ19DSDJfQk9UCQkJCTB4MUMK
KyNkZWZpbmUgRENTU19EVEdfVENfQ0gzX1RPUAkJCQkweDIwCisjZGVmaW5lIERDU1NfRFRHX1RD
X0NIM19CT1QJCQkJMHgyNAorI2RlZmluZSAgIFRDX1hfUE9TCQkJCQkwCisjZGVmaW5lICAgVENf
WF9NQVNLCQkJCQlHRU5NQVNLKDEyLCAwKQorI2RlZmluZSAgIFRDX1lfUE9TCQkJCQkxNgorI2Rl
ZmluZSAgIFRDX1lfTUFTSwkJCQkJR0VOTUFTSygyOCwgMTYpCisjZGVmaW5lIERDU1NfRFRHX1RD
X0NUWExECQkJCTB4MjgKKyNkZWZpbmUgICBUQ19DVFhMRF9EQl9ZX1BPUwkJCQkwCisjZGVmaW5l
ICAgVENfQ1RYTERfREJfWV9NQVNLCQkJCUdFTk1BU0soMTIsIDApCisjZGVmaW5lICAgVENfQ1RY
TERfU0JfWV9QT1MJCQkJMTYKKyNkZWZpbmUgICBUQ19DVFhMRF9TQl9ZX01BU0sJCQkJR0VOTUFT
SygyOCwgMTYpCisjZGVmaW5lIERDU1NfRFRHX1RDX0NIMV9CS1JORAkJCQkweDJDCisjZGVmaW5l
IERDU1NfRFRHX1RDX0NIMl9CS1JORAkJCQkweDMwCisjZGVmaW5lICAgQktSTkRfUl9ZX0NPTVBf
UE9TCQkJCTIwCisjZGVmaW5lICAgQktSTkRfUl9ZX0NPTVBfTUFTSwkJCQlHRU5NQVNLKDI5LCAy
MCkKKyNkZWZpbmUgICBCS1JORF9HX1VfQ09NUF9QT1MJCQkJMTAKKyNkZWZpbmUgICBCS1JORF9H
X1VfQ09NUF9NQVNLCQkJCUdFTk1BU0soMTksIDEwKQorI2RlZmluZSAgIEJLUk5EX0JfVl9DT01Q
X1BPUwkJCQkwCisjZGVmaW5lICAgQktSTkRfQl9WX0NPTVBfTUFTSwkJCQlHRU5NQVNLKDksIDAp
CisjZGVmaW5lIERDU1NfRFRHX0JMRU5ERVJfREJZX1JBTkdFSU5WCQkJMHgzOAorI2RlZmluZSBE
Q1NTX0RUR19CTEVOREVSX0RCWV9SQU5HRU1JTgkJCTB4M0MKKyNkZWZpbmUgRENTU19EVEdfQkxF
TkRFUl9EQllfQkRQCQkJMHg0MAorI2RlZmluZSBEQ1NTX0RUR19CTEVOREVSX0JLUk5EX0kJCQkw
eDQ0CisjZGVmaW5lIERDU1NfRFRHX0JMRU5ERVJfQktSTkRfUAkJCTB4NDgKKyNkZWZpbmUgRENT
U19EVEdfQkxFTkRFUl9CS1JORF9UCQkJMHg0QworI2RlZmluZSBEQ1NTX0RUR19MSU5FMF9JTlQJ
CQkJMHg1MAorI2RlZmluZSBEQ1NTX0RUR19MSU5FMV9JTlQJCQkJMHg1NAorI2RlZmluZSBEQ1NT
X0RUR19CR19BTFBIQV9ERUZBVUxUCQkJMHg1OAorI2RlZmluZSBEQ1NTX0RUR19JTlRfU1RBVFVT
CQkJCTB4NUMKKyNkZWZpbmUgRENTU19EVEdfSU5UX0NPTlRST0wJCQkJMHg2MAorI2RlZmluZSBE
Q1NTX0RUR19UQ19DSDNfQktSTkQJCQkJMHg2NAorI2RlZmluZSBEQ1NTX0RUR19JTlRfTUFTSwkJ
CQkweDY4CisjZGVmaW5lICAgTElORTBfSVJRCQkJCQlCSVQoMCkKKyNkZWZpbmUgICBMSU5FMV9J
UlEJCQkJCUJJVCgxKQorI2RlZmluZSAgIExJTkUyX0lSUQkJCQkJQklUKDIpCisjZGVmaW5lICAg
TElORTNfSVJRCQkJCQlCSVQoMykKKyNkZWZpbmUgRENTU19EVEdfTElORTJfSU5UCQkJCTB4NkMK
KyNkZWZpbmUgRENTU19EVEdfTElORTNfSU5UCQkJCTB4NzAKKyNkZWZpbmUgRENTU19EVEdfREJZ
X09MCQkJCQkweDc0CisjZGVmaW5lIERDU1NfRFRHX0RCWV9CTAkJCQkJMHg3OAorI2RlZmluZSBE
Q1NTX0RUR19EQllfRUwJCQkJCTB4N0MKKworc3RydWN0IGRjc3NfZHRnIHsKKwlzdHJ1Y3QgZGV2
aWNlICpkZXY7CisJc3RydWN0IGRjc3NfY3R4bGQgKmN0eGxkOworCXZvaWQgX19pb21lbSAqYmFz
ZV9yZWc7CisJdTMyIGJhc2Vfb2ZzOworCisJdTMyIGN0eF9pZDsKKworCWJvb2wgaW5fdXNlOwor
CisJdTMyIGRpc191bGNfeDsKKwl1MzIgZGlzX3VsY195OworCisJdTMyIGNvbnRyb2xfc3RhdHVz
OworCXUzMiBhbHBoYTsKKworCWludCBjdHhsZF9raWNrX2lycTsKKwlib29sIGN0eGxkX2tpY2tf
aXJxX2VuOworCisJc3RydWN0IGNsayAqcGl4X2NsazsKKwlzdHJ1Y3QgY2xrICpwbGxfc3JjX2Ns
azsKKwlzdHJ1Y3QgY2xrICpwbGxfcGh5X3JlZl9jbGs7CisKKwkvKgorCSAqIFRoaXMgd2lsbCBi
ZSBwYXNzZWQgb24gYnkgRFJNIENSVEMgc28gdGhhdCB3ZSBjYW4gc2lnbmFsIHdoZW4gRFRHIGhh
cworCSAqIGJlZW4gc3VjY2Vzc2Z1bGx5IHN0b3BwZWQuIE90aGVyd2lzZSwgYW55IG1vZGVzZXR0
aW5nIHdoaWxlIERURyBpcworCSAqIHN0aWxsIE9OIG1heSByZXN1bHQgaW4gdW5wcmVkaWN0YWJs
ZSBiZWhhdmlvci4KKwkgKi8KKwlzdHJ1Y3QgY29tcGxldGlvbiAqZGlzX2NvbXBsZXRpb247Cit9
OworCitzdGF0aWMgdm9pZCBkY3NzX2R0Z193cml0ZShzdHJ1Y3QgZGNzc19kdGcgKmR0ZywgdTMy
IHZhbCwgdTMyIG9mcykKK3sKKwlpZiAoIWR0Zy0+aW5fdXNlKQorCQlkY3NzX3dyaXRlbCh2YWws
IGR0Zy0+YmFzZV9yZWcgKyBvZnMpOworCisJZGNzc19jdHhsZF93cml0ZShkdGctPmN0eGxkLCBk
dGctPmN0eF9pZCwgdmFsLCBkdGctPmJhc2Vfb2ZzICsgb2ZzKTsKK30KKworc3RhdGljIGlycXJl
dHVybl90IGRjc3NfZHRnX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmRhdGEpCit7CisJc3Ry
dWN0IGRjc3NfZHRnICpkdGcgPSBkYXRhOworCXUzMiBzdGF0dXM7CisKKwlzdGF0dXMgPSBkY3Nz
X3JlYWRsKGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRfU1RBVFVTKTsKKworCWlmICghKHN0
YXR1cyAmIExJTkUwX0lSUSkpCisJCXJldHVybiBJUlFfSEFORExFRDsKKworCWRjc3NfY3R4bGRf
a2ljayhkdGctPmN0eGxkKTsKKworCWRjc3Nfd3JpdGVsKHN0YXR1cyAmIExJTkUwX0lSUSwgZHRn
LT5iYXNlX3JlZyArIERDU1NfRFRHX0lOVF9DT05UUk9MKTsKKworCXJldHVybiBJUlFfSEFORExF
RDsKK30KKworc3RhdGljIGludCBkY3NzX2R0Z19pcnFfY29uZmlnKHN0cnVjdCBkY3NzX2R0ZyAq
ZHRnLAorCQkJICAgICAgIHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCit7CisJaW50IHJl
dDsKKworCWR0Zy0+Y3R4bGRfa2lja19pcnEgPSBwbGF0Zm9ybV9nZXRfaXJxX2J5bmFtZShwZGV2
LCAiY3R4bGRfa2ljayIpOworCWlmIChkdGctPmN0eGxkX2tpY2tfaXJxIDwgMCkgeworCQlkZXZf
ZXJyKGR0Zy0+ZGV2LCAiZHRnOiBjYW4ndCBnZXQgbGluZTIgaXJxIG51bWJlclxuIik7CisJCXJl
dHVybiBkdGctPmN0eGxkX2tpY2tfaXJxOworCX0KKworCXJldCA9IGRldm1fcmVxdWVzdF9pcnEo
ZHRnLT5kZXYsIGR0Zy0+Y3R4bGRfa2lja19pcnEsCisJCQkgICAgICAgZGNzc19kdGdfaXJxX2hh
bmRsZXIsCisJCQkgICAgICAgSVJRRl9UUklHR0VSX0hJR0gsCisJCQkgICAgICAgImRjc3NfY3R4
bGRfa2ljayIsIGR0Zyk7CisJaWYgKHJldCkgeworCQlkZXZfZXJyKGR0Zy0+ZGV2LCAiZHRnOiBp
cnEgcmVxdWVzdCBmYWlsZWQuXG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlkaXNhYmxlX2ly
cShkdGctPmN0eGxkX2tpY2tfaXJxKTsKKworCWR0Zy0+Y3R4bGRfa2lja19pcnFfZW4gPSBmYWxz
ZTsKKworCWRjc3NfdXBkYXRlKExJTkUwX0lSUSwgTElORTBfSVJRLCBkdGctPmJhc2VfcmVnICsg
RENTU19EVEdfSU5UX01BU0spOworCisJcmV0dXJuIDA7Cit9CisKK2ludCBkY3NzX2R0Z19pbml0
KHN0cnVjdCBkY3NzX2RldiAqZGNzcywgdW5zaWduZWQgbG9uZyBkdGdfYmFzZSkKK3sKKwlpbnQg
cmV0ID0gMDsKKwlzdHJ1Y3QgZGNzc19kdGcgKmR0ZzsKKworCWR0ZyA9IGRldm1fa3phbGxvYyhk
Y3NzLT5kZXYsIHNpemVvZigqZHRnKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkdGcpCisJCXJldHVy
biAtRU5PTUVNOworCisJZGNzcy0+ZHRnID0gZHRnOworCWR0Zy0+ZGV2ID0gZGNzcy0+ZGV2Owor
CWR0Zy0+Y3R4bGQgPSBkY3NzLT5jdHhsZDsKKworCWR0Zy0+YmFzZV9yZWcgPSBkZXZtX2lvcmVt
YXAoZGNzcy0+ZGV2LCBkdGdfYmFzZSwgU1pfNEspOworCWlmICghZHRnLT5iYXNlX3JlZykgewor
CQlkZXZfZXJyKGRjc3MtPmRldiwgImR0ZzogdW5hYmxlIHRvIHJlbWFwIGR0ZyBiYXNlXG4iKTsK
KwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBlcnJfaW9yZW1hcDsKKwl9CisKKwlkdGctPmJhc2Vf
b2ZzID0gZHRnX2Jhc2U7CisJZHRnLT5jdHhfaWQgPSBDVFhfREI7CisKKwlkdGctPnBpeF9jbGsg
PSBkY3NzLT5waXhfY2xrOworCWR0Zy0+cGxsX3NyY19jbGsgPSBkY3NzLT5wbGxfc3JjX2NsazsK
KwlkdGctPnBsbF9waHlfcmVmX2NsayA9IGRjc3MtPnBsbF9waHlfcmVmX2NsazsKKworCWR0Zy0+
YWxwaGEgPSAyNTU7CisKKwlkdGctPmNvbnRyb2xfc3RhdHVzIHw9IE9WTF9EQVRBX01PREUgfCBC
TEVOREVSX1ZJREVPX0FMUEhBX1NFTCB8CisJCSgoZHRnLT5hbHBoYSA8PCBERUZBVUxUX0ZHX0FM
UEhBX1BPUykgJiBERUZBVUxUX0ZHX0FMUEhBX01BU0spOworCisJcmV0ID0gZGNzc19kdGdfaXJx
X2NvbmZpZyhkdGcsIHRvX3BsYXRmb3JtX2RldmljZShkY3NzLT5kZXYpKTsKKwlpZiAocmV0KQor
CQlnb3RvIGVycl9pcnE7CisKKwlyZXR1cm4gMDsKKworZXJyX2lycToKKwlkZXZtX2lvdW5tYXAo
ZHRnLT5kZXYsIGR0Zy0+YmFzZV9yZWcpOworCitlcnJfaW9yZW1hcDoKKwlkZXZtX2tmcmVlKGR0
Zy0+ZGV2LCBkdGcpOworCisJcmV0dXJuIHJldDsKK30KKwordm9pZCBkY3NzX2R0Z19leGl0KHN0
cnVjdCBkY3NzX2R0ZyAqZHRnKQoreworCS8qIHN0b3AgRFRHICovCisJZGNzc193cml0ZWwoRFRH
X1NUQVJULCBkdGctPmJhc2VfcmVnICsgRENTU19EVEdfVENfQ09OVFJPTF9TVEFUVVMpOworCisJ
ZGV2bV9mcmVlX2lycShkdGctPmRldiwgZHRnLT5jdHhsZF9raWNrX2lycSwgZHRnKTsKKworCWlm
IChkdGctPmJhc2VfcmVnKQorCQlkZXZtX2lvdW5tYXAoZHRnLT5kZXYsIGR0Zy0+YmFzZV9yZWcp
OworCisJZGV2bV9rZnJlZShkdGctPmRldiwgZHRnKTsKK30KKwordm9pZCBkY3NzX2R0Z19zeW5j
X3NldChzdHJ1Y3QgZGNzc19kdGcgKmR0Zywgc3RydWN0IHZpZGVvbW9kZSAqdm0pCit7CisJdTE2
IGR0Z19scmNfeCwgZHRnX2xyY195OworCXUxNiBkaXNfdWxjX3gsIGRpc191bGNfeTsKKwl1MTYg
ZGlzX2xyY194LCBkaXNfbHJjX3k7CisJdTMyIHNiX2N0eGxkX3RyaWcsIGRiX2N0eGxkX3RyaWc7
CisJdTMyIHBpeGNsb2NrID0gdm0tPnBpeGVsY2xvY2s7CisJdTMyIGFjdHVhbF9jbGs7CisKKwlk
dGdfbHJjX3ggPSB2bS0+aGZyb250X3BvcmNoICsgdm0tPmhiYWNrX3BvcmNoICsgdm0tPmhzeW5j
X2xlbiArCisJCSAgICB2bS0+aGFjdGl2ZSAtIDE7CisJZHRnX2xyY195ID0gdm0tPnZmcm9udF9w
b3JjaCArIHZtLT52YmFja19wb3JjaCArIHZtLT52c3luY19sZW4gKworCQkgICAgdm0tPnZhY3Rp
dmUgLSAxOworCWRpc191bGNfeCA9IHZtLT5oc3luY19sZW4gKyB2bS0+aGJhY2tfcG9yY2ggLSAx
OworCWRpc191bGNfeSA9IHZtLT52c3luY19sZW4gKyB2bS0+dmZyb250X3BvcmNoICsgdm0tPnZi
YWNrX3BvcmNoIC0gMTsKKwlkaXNfbHJjX3ggPSB2bS0+aHN5bmNfbGVuICsgdm0tPmhiYWNrX3Bv
cmNoICsgdm0tPmhhY3RpdmUgLSAxOworCWRpc19scmNfeSA9IHZtLT52c3luY19sZW4gKyB2bS0+
dmZyb250X3BvcmNoICsgdm0tPnZiYWNrX3BvcmNoICsKKwkJICAgIHZtLT52YWN0aXZlIC0gMTsK
KworCWNsa19kaXNhYmxlX3VucHJlcGFyZShkdGctPnBpeF9jbGspOworCWNsa19zZXRfcmF0ZShk
dGctPnBpeF9jbGssIHZtLT5waXhlbGNsb2NrKTsKKwljbGtfcHJlcGFyZV9lbmFibGUoZHRnLT5w
aXhfY2xrKTsKKworCWFjdHVhbF9jbGsgPSBjbGtfZ2V0X3JhdGUoZHRnLT5waXhfY2xrKTsKKwlp
ZiAocGl4Y2xvY2sgIT0gYWN0dWFsX2NsaykgeworCQlkZXZfaW5mbyhkdGctPmRldiwKKwkJCSAi
UGl4ZWwgY2xvY2sgc2V0IHRvICV1IGtIeiBpbnN0ZWFkIG9mICV1IGtIei5cbiIsCisJCQkgKGFj
dHVhbF9jbGsgLyAxMDAwKSwgKHBpeGNsb2NrIC8gMTAwMCkpOworCX0KKworCW1zbGVlcCg1MCk7
CisKKwlkY3NzX2R0Z193cml0ZShkdGcsICgoZHRnX2xyY195IDw8IFRDX1lfUE9TKSB8IGR0Z19s
cmNfeCksCisJCSAgICAgICBEQ1NTX0RUR19UQ19EVEcpOworCWRjc3NfZHRnX3dyaXRlKGR0Zywg
KChkaXNfdWxjX3kgPDwgVENfWV9QT1MpIHwgZGlzX3VsY194KSwKKwkJICAgICAgIERDU1NfRFRH
X1RDX0RJU1BfVE9QKTsKKwlkY3NzX2R0Z193cml0ZShkdGcsICgoZGlzX2xyY195IDw8IFRDX1lf
UE9TKSB8IGRpc19scmNfeCksCisJCSAgICAgICBEQ1NTX0RUR19UQ19ESVNQX0JPVCk7CisKKwlk
dGctPmRpc191bGNfeCA9IGRpc191bGNfeDsKKwlkdGctPmRpc191bGNfeSA9IGRpc191bGNfeTsK
KworCXNiX2N0eGxkX3RyaWcgPSAoKDAgKiBkaXNfbHJjX3kgLyAxMDApIDw8IFRDX0NUWExEX1NC
X1lfUE9TKSAmCisJCQkJCQkJVENfQ1RYTERfU0JfWV9NQVNLOworCWRiX2N0eGxkX3RyaWcgPSAo
KDk5ICogZGlzX2xyY195IC8gMTAwKSA8PCBUQ19DVFhMRF9EQl9ZX1BPUykgJgorCQkJCQkJCVRD
X0NUWExEX0RCX1lfTUFTSzsKKworCWRjc3NfZHRnX3dyaXRlKGR0Zywgc2JfY3R4bGRfdHJpZyB8
IGRiX2N0eGxkX3RyaWcsIERDU1NfRFRHX1RDX0NUWExEKTsKKworCS8qIHZibGFuayB0cmlnZ2Vy
ICovCisJZGNzc19kdGdfd3JpdGUoZHRnLCAwLCBEQ1NTX0RUR19MSU5FMV9JTlQpOworCisJLyog
Q1RYTEQgdHJpZ2dlciAqLworCWRjc3NfZHRnX3dyaXRlKGR0ZywgKCg5MCAqIGRpc19scmNfeSkg
LyAxMDApIDw8IDE2LCBEQ1NTX0RUR19MSU5FMF9JTlQpOworfQorCit2b2lkIGRjc3NfZHRnX3Bs
YW5lX3Bvc19zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcsIGludCBjaF9udW0sCisJCQkgICAgaW50
IHB4LCBpbnQgcHksIGludCBwdywgaW50IHBoKQoreworCXUxNiBwX3VsY194LCBwX3VsY195Owor
CXUxNiBwX2xyY194LCBwX2xyY195OworCisJcF91bGNfeCA9IGR0Zy0+ZGlzX3VsY194ICsgcHg7
CisJcF91bGNfeSA9IGR0Zy0+ZGlzX3VsY195ICsgcHk7CisJcF9scmNfeCA9IHBfdWxjX3ggKyBw
dzsKKwlwX2xyY195ID0gcF91bGNfeSArIHBoOworCisJaWYgKCFweCAmJiAhcHkgJiYgIXB3ICYm
ICFwaCkgeworCQlkY3NzX2R0Z193cml0ZShkdGcsIDAsIERDU1NfRFRHX1RDX0NIMV9UT1AgKyAw
eDggKiBjaF9udW0pOworCQlkY3NzX2R0Z193cml0ZShkdGcsIDAsIERDU1NfRFRHX1RDX0NIMV9C
T1QgKyAweDggKiBjaF9udW0pOworCX0gZWxzZSB7CisJCWRjc3NfZHRnX3dyaXRlKGR0ZywgKChw
X3VsY195IDw8IFRDX1lfUE9TKSB8IHBfdWxjX3gpLAorCQkJICAgICAgIERDU1NfRFRHX1RDX0NI
MV9UT1AgKyAweDggKiBjaF9udW0pOworCQlkY3NzX2R0Z193cml0ZShkdGcsICgocF9scmNfeSA8
PCBUQ19ZX1BPUykgfCBwX2xyY194KSwKKwkJCSAgICAgICBEQ1NTX0RUR19UQ19DSDFfQk9UICsg
MHg4ICogY2hfbnVtKTsKKwl9Cit9CisKK2Jvb2wgZGNzc19kdGdfZ2xvYmFsX2FscGhhX2NoYW5n
ZWQoc3RydWN0IGRjc3NfZHRnICpkdGcsIGludCBjaF9udW0sIGludCBhbHBoYSkKK3sKKwlpZiAo
Y2hfbnVtKQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gYWxwaGEgIT0gZHRnLT5hbHBoYTsK
K30KKwordm9pZCBkY3NzX2R0Z19wbGFuZV9hbHBoYV9zZXQoc3RydWN0IGRjc3NfZHRnICpkdGcs
IGludCBjaF9udW0sCisJCQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3Jt
YXQsIGludCBhbHBoYSkKK3sKKwl1MzIgYWxwaGFfdmFsOworCisJLyogd2UgY2FyZSBhYm91dCBh
bHBoYSBvbmx5IHdoZW4gY2hhbm5lbCAwIGlzIGNvbmNlcm5lZCAqLworCWlmIChjaF9udW0pCisJ
CXJldHVybjsKKworCWFscGhhX3ZhbCA9IChhbHBoYSA8PCBERUZBVUxUX0ZHX0FMUEhBX1BPUykg
JiBERUZBVUxUX0ZHX0FMUEhBX01BU0s7CisKKwkvKgorCSAqIFVzZSBnbG9iYWwgYWxwaGEgaWYg
cGl4ZWwgZm9ybWF0IGRvZXMgbm90IGhhdmUgYWxwaGEgY2hhbm5lbCBvciB0aGUKKwkgKiB1c2Vy
IGV4cGxpY2l0bHkgY2hvc2UgdG8gdXNlIGdsb2JhbCBhbHBoYSAoaS5lLiBhbHBoYSBpcyBub3Qg
T1BBUVVFKS4KKwkgKi8KKwlpZiAoIWZvcm1hdC0+aGFzX2FscGhhIHx8IGFscGhhICE9IDI1NSkg
eworCQlkdGctPmNvbnRyb2xfc3RhdHVzICY9IH4oQ0gxX0FMUEhBX1NFTCB8IERFRkFVTFRfRkdf
QUxQSEFfTUFTSyk7CisJCWR0Zy0+Y29udHJvbF9zdGF0dXMgfD0gYWxwaGFfdmFsOworCX0gZWxz
ZSB7IC8qIHVzZSBwZXItcGl4ZWwgYWxwaGEgb3RoZXJ3aXNlICovCisJCWR0Zy0+Y29udHJvbF9z
dGF0dXMgfD0gQ0gxX0FMUEhBX1NFTDsKKwl9CisKKwlkdGctPmFscGhhID0gYWxwaGE7Cit9CisK
K3ZvaWQgZGNzc19kdGdfY3NzX3NldChzdHJ1Y3QgZGNzc19kdGcgKmR0ZykKK3sKKwlkdGctPmNv
bnRyb2xfc3RhdHVzIHw9CisJCQkoMHg1IDw8IENTU19QSVhfQ09NUF9TV0FQX1BPUykgJiBDU1Nf
UElYX0NPTVBfU1dBUF9NQVNLOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2R0Z19kaXNhYmxlX2Nh
bGxiYWNrKHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRjc3NfZHRnICpkdGcgPSBkYXRhOworCisJ
ZHRnLT5jb250cm9sX3N0YXR1cyAmPSB+RFRHX1NUQVJUOworCisJZGNzc193cml0ZWwoZHRnLT5j
b250cm9sX3N0YXR1cywKKwkJICAgIGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19UQ19DT05UUk9M
X1NUQVRVUyk7CisKKwlkdGctPmluX3VzZSA9IGZhbHNlOworCisJY29tcGxldGUoZHRnLT5kaXNf
Y29tcGxldGlvbik7Cit9CisKK3ZvaWQgZGNzc19kdGdfZW5hYmxlKHN0cnVjdCBkY3NzX2R0ZyAq
ZHRnLCBib29sIGVuLAorCQkgICAgIHN0cnVjdCBjb21wbGV0aW9uICpkaXNfY29tcGxldGlvbikK
K3sKKwlpZiAoIWVuKSB7CisJCWR0Zy0+ZGlzX2NvbXBsZXRpb24gPSBkaXNfY29tcGxldGlvbjsK
KwkJZGNzc19jdHhsZF9yZWdpc3Rlcl9kdGdfZGlzYWJsZV9jYihkdGctPmN0eGxkLAorCQkJCQkJ
ICAgZGNzc19kdGdfZGlzYWJsZV9jYWxsYmFjaywKKwkJCQkJCSAgIGR0Zyk7CisJCXJldHVybjsK
Kwl9CisKKwlkdGctPmRpc19jb21wbGV0aW9uID0gTlVMTDsKKworCWR0Zy0+Y29udHJvbF9zdGF0
dXMgfD0gRFRHX1NUQVJUOworCisJZGNzc19kdGdfd3JpdGUoZHRnLCBkdGctPmNvbnRyb2xfc3Rh
dHVzLCBEQ1NTX0RUR19UQ19DT05UUk9MX1NUQVRVUyk7CisKKwlkdGctPmluX3VzZSA9IHRydWU7
Cit9CisKK2Jvb2wgZGNzc19kdGdfaXNfZW5hYmxlZChzdHJ1Y3QgZGNzc19kdGcgKmR0ZykKK3sK
KwlyZXR1cm4gZHRnLT5pbl91c2U7Cit9CisKK3ZvaWQgZGNzc19kdGdfY2hfZW5hYmxlKHN0cnVj
dCBkY3NzX2R0ZyAqZHRnLCBpbnQgY2hfbnVtLCBib29sIGVuKQoreworCXUzMiBjaF9lbl9tYXBb
XSA9IHtDSDFfRU4sIENIMl9FTiwgQ0gzX0VOfTsKKwl1MzIgY29udHJvbF9zdGF0dXM7CisKKwlj
b250cm9sX3N0YXR1cyA9IGR0Zy0+Y29udHJvbF9zdGF0dXMgJiB+Y2hfZW5fbWFwW2NoX251bV07
CisJY29udHJvbF9zdGF0dXMgfD0gZW4gPyBjaF9lbl9tYXBbY2hfbnVtXSA6IDA7CisKKwlpZiAo
ZHRnLT5jb250cm9sX3N0YXR1cyAhPSBjb250cm9sX3N0YXR1cykKKwkJZGNzc19kdGdfd3JpdGUo
ZHRnLCBjb250cm9sX3N0YXR1cywgRENTU19EVEdfVENfQ09OVFJPTF9TVEFUVVMpOworCisJZHRn
LT5jb250cm9sX3N0YXR1cyA9IGNvbnRyb2xfc3RhdHVzOworfQorCit2b2lkIGRjc3NfZHRnX3Zi
bGFua19pcnFfZW5hYmxlKHN0cnVjdCBkY3NzX2R0ZyAqZHRnLCBib29sIGVuKQoreworCXUzMiBz
dGF0dXM7CisKKwlkY3NzX3VwZGF0ZShMSU5FMV9JUlEsIExJTkUxX0lSUSwgZHRnLT5iYXNlX3Jl
ZyArIERDU1NfRFRHX0lOVF9NQVNLKTsKKworCWlmIChlbikgeworCQlzdGF0dXMgPSBkY3NzX3Jl
YWRsKGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRfU1RBVFVTKTsKKwkJZGNzc193cml0ZWwo
c3RhdHVzICYgTElORTFfSVJRLAorCQkJICAgIGR0Zy0+YmFzZV9yZWcgKyBEQ1NTX0RUR19JTlRf
Q09OVFJPTCk7CisJfQorfQorCit2b2lkIGRjc3NfZHRnX2N0eGxkX2tpY2tfaXJxX2VuYWJsZShz
dHJ1Y3QgZGNzc19kdGcgKmR0ZywgYm9vbCBlbikKK3sKKwl1MzIgc3RhdHVzOworCisJaWYgKGVu
KSB7CisJCXN0YXR1cyA9IGRjc3NfcmVhZGwoZHRnLT5iYXNlX3JlZyArIERDU1NfRFRHX0lOVF9T
VEFUVVMpOworCisJCWlmICghZHRnLT5jdHhsZF9raWNrX2lycV9lbikgeworCQkJZGNzc193cml0
ZWwoc3RhdHVzICYgTElORTBfSVJRLAorCQkJCSAgICBkdGctPmJhc2VfcmVnICsgRENTU19EVEdf
SU5UX0NPTlRST0wpOworCQkJZW5hYmxlX2lycShkdGctPmN0eGxkX2tpY2tfaXJxKTsKKwkJCWR0
Zy0+Y3R4bGRfa2lja19pcnFfZW4gPSB0cnVlOworCQkJcmV0dXJuOworCQl9CisKKwkJcmV0dXJu
OworCX0KKworCWlmICghZHRnLT5jdHhsZF9raWNrX2lycV9lbikKKwkJcmV0dXJuOworCisJZGlz
YWJsZV9pcnFfbm9zeW5jKGR0Zy0+Y3R4bGRfa2lja19pcnEpOworCWR0Zy0+Y3R4bGRfa2lja19p
cnFfZW4gPSBmYWxzZTsKK30KKwordm9pZCBkY3NzX2R0Z192YmxhbmtfaXJxX2NsZWFyKHN0cnVj
dCBkY3NzX2R0ZyAqZHRnKQoreworCWRjc3NfdXBkYXRlKExJTkUxX0lSUSwgTElORTFfSVJRLCBk
dGctPmJhc2VfcmVnICsgRENTU19EVEdfSU5UX0NPTlRST0wpOworfQorCitib29sIGRjc3NfZHRn
X3ZibGFua19pcnFfdmFsaWQoc3RydWN0IGRjc3NfZHRnICpkdGcpCit7CisJcmV0dXJuICEhKGRj
c3NfcmVhZGwoZHRnLT5iYXNlX3JlZyArIERDU1NfRFRHX0lOVF9TVEFUVVMpICYgTElORTFfSVJR
KTsKK30KKwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mta21zLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1rbXMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMC4uZDNiYzg4OQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pbXgvZGNzcy9kY3NzLWttcy5jCkBAIC0wLDAgKzEsMzIxIEBACisvLyBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAqLwor
CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19o
ZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9k
cm1fZ2VtX2NtYV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9o
ZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX29mLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wcm9i
ZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtUC5oPgorI2luY2x1ZGUgPGxpbnV4L2NvbXBv
bmVudC5oPgorCisjaW5jbHVkZSAiZGNzcy1kZXYuaCIKKyNpbmNsdWRlICJkY3NzLWttcy5oIgor
CitERUZJTkVfRFJNX0dFTV9DTUFfRk9QUyhkY3NzX2NtYV9mb3BzKTsKKworc3RydWN0IGRjc3Nf
ZHJtX2NvbW1pdCB7CisJc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CisJc3RydWN0IGRybV9kZXZp
Y2UgKmRybTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGU7Cit9OworCitzdGF0aWMg
dm9pZCBkY3NzX2RybV9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRjc3NfZHJtX2NvbW1pdCAq
Y29tbWl0KQoreworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNvbW1pdC0+c3Rh
dGU7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IGNvbW1pdC0+ZHJtOworCXN0cnVjdCBkY3Nz
X2ttc19kZXYgKmttcyA9IGNvbnRhaW5lcl9vZihkcm0sIHN0cnVjdCBkY3NzX2ttc19kZXYsIGJh
c2UpOworCisJZHJtX2F0b21pY19oZWxwZXJfd2FpdF9mb3JfZmVuY2VzKGRybSwgc3RhdGUsIGZh
bHNlKTsKKworCWRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX2RlcGVuZGVuY2llcyhzdGF0ZSk7
CisKKwlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfbW9kZXNldF9kaXNhYmxlcyhkcm0sIHN0YXRl
KTsKKworCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoZHJtLCBzdGF0
ZSk7CisKKwlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfcGxhbmVzKGRybSwgc3RhdGUsCisJCQkJ
CURSTV9QTEFORV9DT01NSVRfQUNUSVZFX09OTFkpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29t
bWl0X2h3X2RvbmUoc3RhdGUpOworCisJZHJtX2F0b21pY19oZWxwZXJfd2FpdF9mb3JfdmJsYW5r
cyhkcm0sIHN0YXRlKTsKKworCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKGRybSwg
c3RhdGUpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2NsZWFudXBfZG9uZShzdGF0ZSk7
CisKKwlkcm1fYXRvbWljX3N0YXRlX3B1dChzdGF0ZSk7CisKKwlzcGluX2xvY2soJmttcy0+Y29t
bWl0LndhaXQubG9jayk7CisJa21zLT5jb21taXQucGVuZGluZyA9IGZhbHNlOworCXdha2VfdXBf
YWxsX2xvY2tlZCgma21zLT5jb21taXQud2FpdCk7CisJc3Bpbl91bmxvY2soJmttcy0+Y29tbWl0
LndhaXQubG9jayk7CisKKwlrZnJlZShjb21taXQpOworfQorCitzdGF0aWMgdm9pZCBkY3NzX2Nv
bW1pdF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZGNzc19kcm1f
Y29tbWl0ICpjb21taXQgPSBjb250YWluZXJfb2Yod29yaywKKwkJCQkJCSAgICAgIHN0cnVjdCBk
Y3NzX2RybV9jb21taXQsCisJCQkJCQkgICAgICB3b3JrKTsKKworCWRjc3NfZHJtX2F0b21pY19j
b21taXRfdGFpbChjb21taXQpOworfQorCitzdGF0aWMgaW50IGRjc3NfZHJtX2F0b21pY19jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRybSwKKwkJCQkgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSwKKwkJCQkgIGJvb2wgbm9uYmxvY2spCit7CisJaW50IHJldDsKKwlzdHJ1Y3QgZGNz
c19rbXNfZGV2ICprbXMgPSBjb250YWluZXJfb2YoZHJtLCBzdHJ1Y3QgZGNzc19rbXNfZGV2LCBi
YXNlKTsKKwlzdHJ1Y3QgZGNzc19kcm1fY29tbWl0ICpjb21taXQ7CisKKwlpZiAoc3RhdGUtPmFz
eW5jX3VwZGF0ZSkgeworCQlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9wcmVwYXJlX3BsYW5lcyhk
cm0sIHN0YXRlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJZHJtX2F0b21pY19o
ZWxwZXJfYXN5bmNfY29tbWl0KGRybSwgc3RhdGUpOworCQlkcm1fYXRvbWljX2hlbHBlcl9jbGVh
bnVwX3BsYW5lcyhkcm0sIHN0YXRlKTsKKworCQlyZXR1cm4gMDsKKwl9CisKKwljb21taXQgPSBr
emFsbG9jKHNpemVvZigqY29tbWl0KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFjb21taXQpCisJCXJl
dHVybiAtRU5PTUVNOworCisJY29tbWl0LT5kcm0gPSBkcm07CisJY29tbWl0LT5zdGF0ZSA9IHN0
YXRlOworCisJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfc2V0dXBfY29tbWl0KHN0YXRlLCBub25i
bG9jayk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZnJlZTsKKworCUlOSVRfV09SSygmY29tbWl0
LT53b3JrLCBkY3NzX2NvbW1pdF93b3JrKTsKKworCXJldCA9IGRybV9hdG9taWNfaGVscGVyX3By
ZXBhcmVfcGxhbmVzKGRybSwgc3RhdGUpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2ZyZWU7CisK
KwlpZiAoIW5vbmJsb2NrKSB7CisJCXJldCA9IGRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX2Zl
bmNlcyhkcm0sIHN0YXRlLCB0cnVlKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gZXJyOworCX0KKwor
CXNwaW5fbG9jaygma21zLT5jb21taXQud2FpdC5sb2NrKTsKKwlyZXQgPSB3YWl0X2V2ZW50X2lu
dGVycnVwdGlibGVfbG9ja2VkKGttcy0+Y29tbWl0LndhaXQsCisJCQkJCSAgICAgICFrbXMtPmNv
bW1pdC5wZW5kaW5nKTsKKwlpZiAocmV0ID09IDApCisJCWttcy0+Y29tbWl0LnBlbmRpbmcgPSB0
cnVlOworCXNwaW5fdW5sb2NrKCZrbXMtPmNvbW1pdC53YWl0LmxvY2spOworCisJaWYgKHJldCkK
KwkJZ290byBlcnI7CisKKwlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9zd2FwX3N0YXRlKHN0YXRl
LCB0cnVlKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKKworCWRybV9hdG9taWNfc3RhdGVfZ2V0
KHN0YXRlKTsKKwlpZiAobm9uYmxvY2spCisJCXF1ZXVlX3dvcmsoa21zLT5jb21taXRfd3EsICZj
b21taXQtPndvcmspOworCWVsc2UKKwkJZGNzc19kcm1fYXRvbWljX2NvbW1pdF90YWlsKGNvbW1p
dCk7CisKKwlyZXR1cm4gMDsKKworZXJyOgorCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxh
bmVzKGRybSwgc3RhdGUpOworCitlcnJfZnJlZToKKwlrZnJlZShjb21taXQpOworCXJldHVybiBy
ZXQ7Cit9CisKK2NvbnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfZnVuY3MgZGNzc19kcm1fbW9k
ZV9jb25maWdfZnVuY3MgPSB7CisJLmZiX2NyZWF0ZSA9IGRybV9nZW1fZmJfY3JlYXRlLAorCS5v
dXRwdXRfcG9sbF9jaGFuZ2VkID0gZHJtX2ZiX2hlbHBlcl9vdXRwdXRfcG9sbF9jaGFuZ2VkLAor
CS5hdG9taWNfY2hlY2sgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVjaywKKwkuYXRvbWljX2NvbW1p
dCA9IGRjc3NfZHJtX2F0b21pY19jb21taXQsCit9OworCitzdGF0aWMgc3RydWN0IGRybV9kcml2
ZXIgZGNzc19rbXNfZHJpdmVyID0geworCS5kcml2ZXJfZmVhdHVyZXMJPSBEUklWRVJfTU9ERVNF
VCB8IERSSVZFUl9HRU0gfCBEUklWRVJfQVRPTUlDLAorCS5nZW1fZnJlZV9vYmplY3RfdW5sb2Nr
ZWQgPSBkcm1fZ2VtX2NtYV9mcmVlX29iamVjdCwKKwkuZ2VtX3ZtX29wcwkJPSAmZHJtX2dlbV9j
bWFfdm1fb3BzLAorCS5kdW1iX2NyZWF0ZQkJPSBkcm1fZ2VtX2NtYV9kdW1iX2NyZWF0ZSwKKwor
CS5wcmltZV9oYW5kbGVfdG9fZmQJPSBkcm1fZ2VtX3ByaW1lX2hhbmRsZV90b19mZCwKKwkucHJp
bWVfZmRfdG9faGFuZGxlCT0gZHJtX2dlbV9wcmltZV9mZF90b19oYW5kbGUsCisJLmdlbV9wcmlt
ZV9pbXBvcnQJPSBkcm1fZ2VtX3ByaW1lX2ltcG9ydCwKKwkuZ2VtX3ByaW1lX2V4cG9ydAk9IGRy
bV9nZW1fcHJpbWVfZXhwb3J0LAorCS5nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlCT0gZHJtX2dlbV9j
bWFfcHJpbWVfZ2V0X3NnX3RhYmxlLAorCS5nZW1fcHJpbWVfaW1wb3J0X3NnX3RhYmxlID0gZHJt
X2dlbV9jbWFfcHJpbWVfaW1wb3J0X3NnX3RhYmxlLAorCS5nZW1fcHJpbWVfdm1hcAkJPSBkcm1f
Z2VtX2NtYV9wcmltZV92bWFwLAorCS5nZW1fcHJpbWVfdnVubWFwCT0gZHJtX2dlbV9jbWFfcHJp
bWVfdnVubWFwLAorCS5nZW1fcHJpbWVfbW1hcAkJPSBkcm1fZ2VtX2NtYV9wcmltZV9tbWFwLAor
CS5mb3BzCQkJPSAmZGNzc19jbWFfZm9wcywKKwkubmFtZQkJCT0gImlteC1kY3NzIiwKKwkuZGVz
YwkJCT0gImkuTVg4TVEgRGlzcGxheSBTdWJzeXN0ZW0iLAorCS5kYXRlCQkJPSAiMjAxOTA5MTci
LAorCS5tYWpvcgkJCT0gMSwKKwkubWlub3IJCQk9IDAsCisJLnBhdGNobGV2ZWwJCT0gMCwKK307
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2hlbHBlcl9mdW5jcyBkY3Nz
X21vZGVfY29uZmlnX2hlbHBlcnMgPSB7CisJLmF0b21pY19jb21taXRfdGFpbCA9IGRybV9hdG9t
aWNfaGVscGVyX2NvbW1pdF90YWlsX3JwbSwKK307CisKK3N0YXRpYyB2b2lkIGRjc3Nfa21zX21v
ZGVfY29uZmlnX2luaXQoc3RydWN0IGRjc3Nfa21zX2RldiAqa21zKQoreworCXN0cnVjdCBkcm1f
bW9kZV9jb25maWcgKmNvbmZpZyA9ICZrbXMtPmJhc2UubW9kZV9jb25maWc7CisKKwlkcm1fbW9k
ZV9jb25maWdfaW5pdCgma21zLT5iYXNlKTsKKworCWNvbmZpZy0+bWluX3dpZHRoID0gMTsKKwlj
b25maWctPm1pbl9oZWlnaHQgPSAxOworCWNvbmZpZy0+bWF4X3dpZHRoID0gNDA5NjsKKwljb25m
aWctPm1heF9oZWlnaHQgPSA0MDk2OworCWNvbmZpZy0+YWxsb3dfZmJfbW9kaWZpZXJzID0gdHJ1
ZTsKKwljb25maWctPm5vcm1hbGl6ZV96cG9zID0gdHJ1ZTsKKworCWNvbmZpZy0+ZnVuY3MgPSAm
ZGNzc19kcm1fbW9kZV9jb25maWdfZnVuY3M7CisJY29uZmlnLT5oZWxwZXJfcHJpdmF0ZSA9ICZk
Y3NzX21vZGVfY29uZmlnX2hlbHBlcnM7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Vu
Y29kZXJfZnVuY3MgZGNzc19rbXNfc2ltcGxlX2VuY29kZXJfZnVuY3MgPSB7CisJLmRlc3Ryb3kg
PSBkcm1fZW5jb2Rlcl9jbGVhbnVwLAorfTsKKworc3RhdGljIGludCBkY3NzX2ttc19zZXR1cF9l
bmNvZGVyKHN0cnVjdCBkY3NzX2ttc19kZXYgKmttcykKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGRldiA9ICZrbXMtPmJhc2U7CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyID0gJmttcy0+
ZW5jb2RlcjsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAoc3RydWN0IGRybV9jcnRjICopJmtt
cy0+Y3J0YzsKKwlzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbDsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlOworCWludCByZXQ7CisKKwlyZXQgPSBkcm1fb2ZfZmluZF9wYW5lbF9vcl9icmlkZ2Uo
ZGRldi0+ZGV2LT5vZl9ub2RlLCAwLCAwLAorCQkJCQkgICZwYW5lbCwgJmJyaWRnZSk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICghYnJpZGdlKSB7CisJCWRldl9lcnIoZGRldi0+
ZGV2LCAiTm8gYnJpZGdlIGZvdW5kICVkLlxuIiwgcmV0KTsKKwkJcmV0dXJuIC1FTk9ERVY7CisJ
fQorCisJZW5jb2Rlci0+cG9zc2libGVfY3J0Y3MgPSBkcm1fY3J0Y19tYXNrKGNydGMpOworCisJ
cmV0ID0gZHJtX2VuY29kZXJfaW5pdCgma21zLT5iYXNlLCBlbmNvZGVyLAorCQkJICAgICAgICZk
Y3NzX2ttc19zaW1wbGVfZW5jb2Rlcl9mdW5jcywKKwkJCSAgICAgICBEUk1fTU9ERV9FTkNPREVS
X05PTkUsIE5VTEwpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihkZGV2LT5kZXYsICJGYWlsZWQg
aW5pdGlhbGl6aW5nIGVuY29kZXIgJWQuXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKwor
CXJldHVybiBkcm1fYnJpZGdlX2F0dGFjaChlbmNvZGVyLCBicmlkZ2UsIE5VTEwpOworfQorCitz
dHJ1Y3QgZGNzc19rbXNfZGV2ICpkY3NzX2ttc19hdHRhY2goc3RydWN0IGRjc3NfZGV2ICpkY3Nz
LCBib29sIGNvbXBvbmVudGl6ZWQpCit7CisJc3RydWN0IGRjc3Nfa21zX2RldiAqa21zID0ga3ph
bGxvYyhzaXplb2YoKmttcyksIEdGUF9LRVJORUwpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm07
CisJc3RydWN0IGRjc3NfY3J0YyAqY3J0YzsKKwlpbnQgcmV0OworCisJaWYgKCFrbXMpCisJCXJl
dHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJZHJtID0gJmttcy0+YmFzZTsKKwljcnRjID0gJmtt
cy0+Y3J0YzsKKwlyZXQgPSBkcm1fZGV2X2luaXQoZHJtLCAmZGNzc19rbXNfZHJpdmVyLCBkY3Nz
LT5kZXYpOworCWlmIChyZXQpCisJCWdvdG8gZnJlZV9rbXM7CisKKwlkcm0tPmRldl9wcml2YXRl
ID0gZGNzczsKKworCWRjc3Nfa21zX21vZGVfY29uZmlnX2luaXQoa21zKTsKKworCXJldCA9IGRy
bV92YmxhbmtfaW5pdChkcm0sIDEpOworCWlmIChyZXQpCisJCWdvdG8gY2xlYW51cF9tb2RlX2Nv
bmZpZzsKKworCWRybS0+aXJxX2VuYWJsZWQgPSB0cnVlOworCisJcmV0ID0gZGNzc19jcnRjX2lu
aXQoY3J0YywgZHJtKTsKKwlpZiAocmV0KQorCQlnb3RvIGNsZWFudXBfbW9kZV9jb25maWc7CisK
KwlrbXMtPmNvbW1pdF93cSA9IGFsbG9jX29yZGVyZWRfd29ya3F1ZXVlKCJkY3NzX25vbmJsb2Nr
X2NvbW1pdF93cSIsIDApOworCWlmICgha21zLT5jb21taXRfd3EpIHsKKwkJcmV0ID0gLUVOT01F
TTsKKwkJZ290byBjbGVhbnVwX2NydGM7CisJfQorCisJaW5pdF93YWl0cXVldWVfaGVhZCgma21z
LT5jb21taXQud2FpdCk7CisKKwlpZiAoY29tcG9uZW50aXplZCkKKwkJcmV0ID0gY29tcG9uZW50
X2JpbmRfYWxsKGRjc3MtPmRldiwga21zKTsKKwllbHNlCisJCXJldCA9IGRjc3Nfa21zX3NldHVw
X2VuY29kZXIoa21zKTsKKworCWlmIChyZXQpCisJCWdvdG8gY2xlYW51cF93cTsKKworCWRybV9t
b2RlX2NvbmZpZ19yZXNldChkcm0pOworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9pbml0KGRybSk7
CisKKwlyZXQgPSBkcm1fZGV2X3JlZ2lzdGVyKGRybSwgMCk7CisJaWYgKHJldCkKKwkJZ290byBj
bGVhbnVwX3dxOworCisJZHJtX2ZiZGV2X2dlbmVyaWNfc2V0dXAoZHJtLCAzMik7CisKKwlyZXR1
cm4ga21zOworCitjbGVhbnVwX3dxOgorCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaShkcm0pOwor
CWRlc3Ryb3lfd29ya3F1ZXVlKGttcy0+Y29tbWl0X3dxKTsKKworY2xlYW51cF9jcnRjOgorCWRj
c3NfY3J0Y19kZWluaXQoY3J0YywgZHJtKTsKKworY2xlYW51cF9tb2RlX2NvbmZpZzoKKwlkcm1f
bW9kZV9jb25maWdfY2xlYW51cChkcm0pOworCitmcmVlX2ttczoKKwlrZnJlZShrbXMpOworCXJl
dHVybiBFUlJfUFRSKHJldCk7Cit9CisKK3ZvaWQgZGNzc19rbXNfZGV0YWNoKHN0cnVjdCBkY3Nz
X2ttc19kZXYgKmttcywgYm9vbCBjb21wb25lbnRpemVkKQoreworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkcm0gPSAma21zLT5iYXNlOworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IGRybS0+ZGV2X3By
aXZhdGU7CisKKwlkcm1fZGV2X3VucmVnaXN0ZXIoZHJtKTsKKwlkcm1fa21zX2hlbHBlcl9wb2xs
X2ZpbmkoZHJtKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93bihkcm0pOworCWRybV9jcnRj
X3ZibGFua19vZmYoJmttcy0+Y3J0Yy5iYXNlKTsKKwlkcm0tPmlycV9lbmFibGVkID0gZmFsc2U7
CisJZHJtX21vZGVfY29uZmlnX2NsZWFudXAoZHJtKTsKKwlkZXN0cm95X3dvcmtxdWV1ZShrbXMt
PmNvbW1pdF93cSk7CisJZGNzc19jcnRjX2RlaW5pdCgma21zLT5jcnRjLCBkcm0pOworCWlmIChj
b21wb25lbnRpemVkKQorCQljb21wb25lbnRfdW5iaW5kX2FsbChkY3NzLT5kZXYsIGRybSk7CisJ
ZHJtLT5kZXZfcHJpdmF0ZSA9IE5VTEw7CisJZHJtX2Rldl9wdXQoZHJtKTsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLWttcy5oIGIvZHJpdmVycy9ncHUvZHJt
L2lteC9kY3NzL2Rjc3Mta21zLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAu
LjYyOTcwMDUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNz
cy1rbXMuaApAQCAtMCwwICsxLDUyIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BM
LTIuMCAqLworLyoKKyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAqLworCisjaWZuZGVmIF9EQ1NT
X0tNU19IXworI2RlZmluZSBfRENTU19LTVNfSF8KKworI2luY2x1ZGUgPGRybS9kcm1fZW5jb2Rl
ci5oPgorCitzdHJ1Y3QgZGNzc19wbGFuZSB7CisJc3RydWN0IGRybV9wbGFuZSBiYXNlOworCisJ
aW50IGNoX251bTsKK307CisKK3N0cnVjdCBkY3NzX2NydGMgeworCXN0cnVjdCBkcm1fY3J0YwkJ
YmFzZTsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUJKnN0YXRlOworCisJc3RydWN0IGRjc3NfcGxh
bmUJKnBsYW5lWzNdOworCisJaW50CQkJaXJxOworCWJvb2wJCQlpcnFfZW5hYmxlZDsKKworCXN0
cnVjdCBjb21wbGV0aW9uIGVuX2NvbXBsZXRpb247CisJc3RydWN0IGNvbXBsZXRpb24gZGlzX2Nv
bXBsZXRpb247Cit9OworCitzdHJ1Y3QgY29tbWl0IHsKKwl3YWl0X3F1ZXVlX2hlYWRfdCB3YWl0
OworCWJvb2wgcGVuZGluZzsKK307CisKK3N0cnVjdCBkY3NzX2ttc19kZXYgeworCXN0cnVjdCBk
cm1fZGV2aWNlIGJhc2U7CisJc3RydWN0IGRjc3NfY3J0YyBjcnRjOworCXN0cnVjdCBkcm1fZW5j
b2RlciBlbmNvZGVyOworCXN0cnVjdCB3b3JrcXVldWVfc3RydWN0ICpjb21taXRfd3E7CisJc3Ry
dWN0IGNvbW1pdCBjb21taXQ7Cit9OworCitzdHJ1Y3QgZGNzc19rbXNfZGV2ICpkY3NzX2ttc19h
dHRhY2goc3RydWN0IGRjc3NfZGV2ICpkY3NzLCBib29sIGNvbXBvbmVudGl6ZWQpOwordm9pZCBk
Y3NzX2ttc19kZXRhY2goc3RydWN0IGRjc3Nfa21zX2RldiAqa21zLCBib29sIGNvbXBvbmVudGl6
ZWQpOworaW50IGRjc3NfY3J0Y19pbml0KHN0cnVjdCBkY3NzX2NydGMgKmNydGMsIHN0cnVjdCBk
cm1fZGV2aWNlICpkcm0pOwordm9pZCBkY3NzX2NydGNfZGVpbml0KHN0cnVjdCBkY3NzX2NydGMg
KmNydGMsIHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pOworc3RydWN0IGRjc3NfcGxhbmUgKmRjc3Nf
cGxhbmVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZHJtLAorCQkJCSAgIHVuc2lnbmVkIGludCBw
b3NzaWJsZV9jcnRjcywKKwkJCQkgICBlbnVtIGRybV9wbGFuZV90eXBlIHR5cGUsCisJCQkJICAg
dW5zaWduZWQgaW50IHpwb3MpOworCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pbXgvZGNzcy9kY3NzLXBsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1w
bGFuZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwLi5jYjE4YzNlCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3MtcGxhbmUuYwpAQCAt
MCwwICsxLDQxOCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisg
KiBDb3B5cmlnaHQgMjAxOSBOWFAuCisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9m
Yl9jbWFfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVy
Lmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fY21hX2hlbHBlci5oPgorCisjaW5jbHVkZSAiZGNz
cy1kZXYuaCIKKyNpbmNsdWRlICJkY3NzLWttcy5oIgorCitzdGF0aWMgY29uc3QgdTMyIGRjc3Nf
Y29tbW9uX2Zvcm1hdHNbXSA9IHsKKwkvKiBSR0IgKi8KKwlEUk1fRk9STUFUX0FSR0I4ODg4LAor
CURSTV9GT1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlEUk1fRk9STUFU
X1hCR1I4ODg4LAorCURSTV9GT1JNQVRfUkdCQTg4ODgsCisJRFJNX0ZPUk1BVF9SR0JYODg4OCwK
KwlEUk1fRk9STUFUX0JHUkE4ODg4LAorCURSTV9GT1JNQVRfQkdSWDg4ODgsCisJRFJNX0ZPUk1B
VF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfUkdC
WDEwMTAxMDIsCisJRFJNX0ZPUk1BVF9CR1JYMTAxMDEwMiwKKwlEUk1fRk9STUFUX0FSR0IyMTAx
MDEwLAorCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9SR0JBMTAxMDEwMiwK
KwlEUk1fRk9STUFUX0JHUkExMDEwMTAyLAorCisJLyogWVVWNDQ0ICovCisJRFJNX0ZPUk1BVF9B
WVVWLAorCisJLyogWVVWNDIyICovCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllV
WSwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCisJLyogWVVWNDIwICov
CisJRFJNX0ZPUk1BVF9OVjEyLAorCURSTV9GT1JNQVRfTlYyMSwKK307CisKK3N0YXRpYyBjb25z
dCB1NjQgZGNzc192aWRlb19mb3JtYXRfbW9kaWZpZXJzW10gPSB7CisJRFJNX0ZPUk1BVF9NT0Rf
TElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQsCit9OworCitzdGF0aWMgY29uc3QgdTY0
IGRjc3NfZ3JhcGhpY3NfZm9ybWF0X21vZGlmaWVyc1tdID0geworCURSTV9GT1JNQVRfTU9EX1ZJ
VkFOVEVfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfVklWQU5URV9TVVBFUl9USUxFRCwKKwlEUk1f
Rk9STUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRCwKK307CisKK3N0YXRp
YyBpbmxpbmUgc3RydWN0IGRjc3NfcGxhbmUgKnRvX2Rjc3NfcGxhbmUoc3RydWN0IGRybV9wbGFu
ZSAqcCkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKHAsIHN0cnVjdCBkY3NzX3BsYW5lLCBiYXNl
KTsKK30KKworc3RhdGljIGlubGluZSBib29sIGRjc3NfcGxhbmVfZmJfaXNfbGluZWFyKGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQoreworCXJldHVybiAoKGZiLT5mbGFncyAmIERS
TV9NT0RFX0ZCX01PRElGSUVSUykgPT0gMCkgfHwKKwkgICAgICAgKChmYi0+ZmxhZ3MgJiBEUk1f
TU9ERV9GQl9NT0RJRklFUlMpICE9IDAgJiYKKwkJZmItPm1vZGlmaWVyID09IERSTV9GT1JNQVRf
TU9EX0xJTkVBUik7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3NfcGxhbmVfZGVzdHJveShzdHJ1Y3Qg
ZHJtX3BsYW5lICpwbGFuZSkKK3sKKwlzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19wbGFuZSA9IGNv
bnRhaW5lcl9vZihwbGFuZSwgc3RydWN0IGRjc3NfcGxhbmUsCisJCQkJCQkgICAgIGJhc2UpOwor
CisJZHJtX3BsYW5lX2NsZWFudXAocGxhbmUpOworCWtmcmVlKGRjc3NfcGxhbmUpOworfQorCitz
dGF0aWMgYm9vbCBkY3NzX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAorCQkJCQkgICAgdTMyIGZvcm1hdCwKKwkJCQkJICAgIHU2NCBtb2RpZmllcikK
K3sKKwlzd2l0Y2ggKHBsYW5lLT50eXBlKSB7CisJY2FzZSBEUk1fUExBTkVfVFlQRV9QUklNQVJZ
OgorCQlzd2l0Y2ggKGZvcm1hdCkgeworCQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJCWNh
c2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwkJY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgor
CQkJcmV0dXJuIG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUiB8fAorCQkJICAgICAg
IG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX1ZJVkFOVEVfVElMRUQgfHwKKwkJCSAgICAgICBt
b2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9WSVZBTlRFX1NVUEVSX1RJTEVEOworCQlkZWZhdWx0
OgorCQkJcmV0dXJuIG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsKKwkJfQorCQli
cmVhazsKKwljYXNlIERSTV9QTEFORV9UWVBFX09WRVJMQVk6CisJCXJldHVybiBtb2RpZmllciA9
PSBEUk1fRk9STUFUX01PRF9MSU5FQVI7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0K
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgZGNzc19wbGFuZV9mdW5j
cyA9IHsKKwkudXBkYXRlX3BsYW5lCQk9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwK
KwkuZGlzYWJsZV9wbGFuZQkJPSBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLAorCS5k
ZXN0cm95CQk9IGRjc3NfcGxhbmVfZGVzdHJveSwKKwkucmVzZXQJCQk9IGRybV9hdG9taWNfaGVs
cGVyX3BsYW5lX3Jlc2V0LAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlCT0gZHJtX2F0b21pY19o
ZWxwZXJfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZQk9IGRy
bV9hdG9taWNfaGVscGVyX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCisJLmZvcm1hdF9tb2Rfc3VwcG9y
dGVkCT0gZGNzc19wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZCwKK307CisKK3N0YXRpYyBib29s
IGRjc3NfcGxhbmVfY2FuX3JvdGF0ZShjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3Jt
YXQsCisJCQkJICBib29sIG1vZF9wcmVzZW50LCB1NjQgbW9kaWZpZXIsCisJCQkJICB1bnNpZ25l
ZCBpbnQgcm90YXRpb24pCit7CisJYm9vbCBsaW5lYXJfZm9ybWF0ID0gIW1vZF9wcmVzZW50IHx8
CisJCQkgICAgIChtb2RfcHJlc2VudCAmJiBtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5F
QVIpOworCXUzMiBzdXBwb3J0ZWRfcm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMDsKKworCWlm
ICghZm9ybWF0LT5pc195dXYgJiYgbGluZWFyX2Zvcm1hdCkKKwkJc3VwcG9ydGVkX3JvdGF0aW9u
ID0gRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfMTgwIHwKKwkJCQkgICAgIERS
TV9NT0RFX1JFRkxFQ1RfTUFTSzsKKwllbHNlIGlmICghZm9ybWF0LT5pc195dXYgJiYKKwkJIG1v
ZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX1ZJVkFOVEVfVElMRUQpCisJCXN1cHBvcnRlZF9yb3Rh
dGlvbiA9IERSTV9NT0RFX1JPVEFURV9NQVNLIHwKKwkJCQkgICAgIERSTV9NT0RFX1JFRkxFQ1Rf
TUFTSzsKKwllbHNlIGlmIChmb3JtYXQtPmlzX3l1diAmJiBsaW5lYXJfZm9ybWF0ICYmCisJCSAo
Zm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9OVjEyIHx8CisJCSAgZm9ybWF0LT5mb3JtYXQg
PT0gRFJNX0ZPUk1BVF9OVjIxKSkKKwkJc3VwcG9ydGVkX3JvdGF0aW9uID0gRFJNX01PREVfUk9U
QVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfMTgwIHwKKwkJCQkgICAgIERSTV9NT0RFX1JFRkxFQ1Rf
TUFTSzsKKworCXJldHVybiAhIShyb3RhdGlvbiAmIHN1cHBvcnRlZF9yb3RhdGlvbik7Cit9CisK
K3N0YXRpYyBib29sIGRjc3NfcGxhbmVfaXNfc291cmNlX3NpemVfYWxsb3dlZCh1MTYgc3JjX3cs
IHUxNiBzcmNfaCwgdTMyIHBpeF9mbXQpCit7CisJaWYgKHNyY193IDwgNjQgJiYKKwkgICAgKHBp
eF9mbXQgPT0gRFJNX0ZPUk1BVF9OVjEyIHx8IHBpeF9mbXQgPT0gRFJNX0ZPUk1BVF9OVjIxKSkK
KwkJcmV0dXJuIGZhbHNlOworCWVsc2UgaWYgKHNyY193IDwgMzIgJiYKKwkJIChwaXhfZm10ID09
IERSTV9GT1JNQVRfVVlWWSB8fCBwaXhfZm10ID09IERSTV9GT1JNQVRfVllVWSB8fAorCQkgIHBp
eF9mbXQgPT0gRFJNX0ZPUk1BVF9ZVVlWIHx8IHBpeF9mbXQgPT0gRFJNX0ZPUk1BVF9ZVllVKSkK
KwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHNyY193ID49IDE2ICYmIHNyY19oID49IDg7Cit9
CisKK3N0YXRpYyBpbnQgZGNzc19wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCisJCQkJICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IGRjc3NfcGxhbmUgKmRjc3NfcGxhbmUgPSB0b19kY3NzX3BsYW5lKHBsYW5lKTsKKwlzdHJ1Y3Qg
ZGNzc19kZXYgKmRjc3MgPSBwbGFuZS0+ZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHN0YXRlLT5mYjsKKwlib29sIGlzX3ByaW1hcnlfcGxhbmUgPSBwbGFu
ZS0+dHlwZSA9PSBEUk1fUExBTkVfVFlQRV9QUklNQVJZOworCXN0cnVjdCBkcm1fZ2VtX2NtYV9v
YmplY3QgKmNtYV9vYmo7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCWlu
dCBoZGlzcGxheSwgdmRpc3BsYXk7CisJaW50IG1pbiwgbWF4OworCWludCByZXQ7CisKKwlpZiAo
IWZiIHx8ICFzdGF0ZS0+Y3J0YykKKwkJcmV0dXJuIDA7CisKKwljbWFfb2JqID0gZHJtX2ZiX2Nt
YV9nZXRfZ2VtX29iaihmYiwgMCk7CisJV0FSTl9PTighY21hX29iaik7CisKKwljcnRjX3N0YXRl
ID0gZHJtX2F0b21pY19nZXRfZXhpc3RpbmdfY3J0Y19zdGF0ZShzdGF0ZS0+c3RhdGUsCisJCQkJ
CQkJc3RhdGUtPmNydGMpOworCisJaGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5hZGp1c3RlZF9tb2Rl
LmhkaXNwbGF5OworCXZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+YWRqdXN0ZWRfbW9kZS52ZGlzcGxh
eTsKKworCWlmICghZGNzc19wbGFuZV9pc19zb3VyY2Vfc2l6ZV9hbGxvd2VkKHN0YXRlLT5zcmNf
dyA+PiAxNiwKKwkJCQkJICAgICAgIHN0YXRlLT5zcmNfaCA+PiAxNiwKKwkJCQkJICAgICAgIGZi
LT5mb3JtYXQtPmZvcm1hdCkpIHsKKwkJRFJNX0RFQlVHX0tNUygiU291cmNlIHBsYW5lIHNpemUg
aXMgbm90IGFsbG93ZWQhXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJZGNzc19zY2Fs
ZXJfZ2V0X21pbl9tYXhfcmF0aW9zKGRjc3MtPnNjYWxlciwgZGNzc19wbGFuZS0+Y2hfbnVtLAor
CQkJCSAgICAgICAmbWluLCAmbWF4KTsKKworCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNr
X3BsYW5lX3N0YXRlKHN0YXRlLCBjcnRjX3N0YXRlLAorCQkJCQkJICBtaW4sIG1heCwgIWlzX3By
aW1hcnlfcGxhbmUsCisJCQkJCQkgIGZhbHNlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJaWYgKCFzdGF0ZS0+dmlzaWJsZSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoIWRjc3NfcGxhbmVf
Y2FuX3JvdGF0ZShmYi0+Zm9ybWF0LAorCQkJCSAgICEhKGZiLT5mbGFncyAmIERSTV9NT0RFX0ZC
X01PRElGSUVSUyksCisJCQkJICAgZmItPm1vZGlmaWVyLAorCQkJCSAgIHN0YXRlLT5yb3RhdGlv
bikpIHsKKwkJRFJNX0RFQlVHX0tNUygicmVxdWVzdGVkIHJvdGF0aW9uIGlzIG5vdCBhbGxvd2Vk
IVxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmICgoc3RhdGUtPmNydGNfeCA8IDAg
fHwgc3RhdGUtPmNydGNfeSA8IDAgfHwKKwkgICAgIHN0YXRlLT5jcnRjX3ggKyBzdGF0ZS0+Y3J0
Y193ID4gaGRpc3BsYXkgfHwKKwkgICAgIHN0YXRlLT5jcnRjX3kgKyBzdGF0ZS0+Y3J0Y19oID4g
dmRpc3BsYXkpICYmCisJICAgICFkY3NzX3BsYW5lX2ZiX2lzX2xpbmVhcihmYikpIHsKKwkJRFJN
X0RFQlVHX0tNUygicmVxdWVzdGVkIGNyb3BwaW5nIG9wZXJhdGlvbiBpcyBub3QgYWxsb3dlZCFc
biIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoKGZiLT5mbGFncyAmIERSTV9NT0RF
X0ZCX01PRElGSUVSUykgJiYKKwkgICAgIXBsYW5lLT5mdW5jcy0+Zm9ybWF0X21vZF9zdXBwb3J0
ZWQocGxhbmUsCisJCQkJZmItPmZvcm1hdC0+Zm9ybWF0LAorCQkJCWZiLT5tb2RpZmllcikpIHsK
KwkJRFJNX0RFQlVHX0tNUygiSW52YWxpZCBtb2RpZmllcjogJWxseCIsIGZiLT5tb2RpZmllcik7
CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBk
Y3NzX3BsYW5lX2F0b21pY19zZXRfYmFzZShzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19wbGFuZSkK
K3sKKwlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSA9ICZkY3NzX3BsYW5lLT5iYXNlOworCXN0cnVj
dCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlID0gcGxhbmUtPnN0YXRlOworCXN0cnVjdCBkY3NzX2Rl
diAqZGNzcyA9IHBsYW5lLT5kZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gc3RhdGUtPmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1h
dCA9IGZiLT5mb3JtYXQ7CisJc3RydWN0IGRybV9nZW1fY21hX29iamVjdCAqY21hX29iaiA9IGRy
bV9mYl9jbWFfZ2V0X2dlbV9vYmooZmIsIDApOworCXVuc2lnbmVkIGxvbmcgcDFfYmEgPSAwLCBw
Ml9iYSA9IDA7CisKKwlpZiAoIWZvcm1hdC0+aXNfeXV2IHx8CisJICAgIGZvcm1hdC0+Zm9ybWF0
ID09IERSTV9GT1JNQVRfTlYxMiB8fAorCSAgICBmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFU
X05WMjEpCisJCXAxX2JhID0gY21hX29iai0+cGFkZHIgKyBmYi0+b2Zmc2V0c1swXSArCisJCQlm
Yi0+cGl0Y2hlc1swXSAqIChzdGF0ZS0+c3JjLnkxID4+IDE2KSArCisJCQlmb3JtYXQtPmNoYXJf
cGVyX2Jsb2NrWzBdICogKHN0YXRlLT5zcmMueDEgPj4gMTYpOworCWVsc2UgaWYgKGZvcm1hdC0+
Zm9ybWF0ID09IERSTV9GT1JNQVRfVVlWWSB8fAorCQkgZm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZP
Uk1BVF9WWVVZIHx8CisJCSBmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1lVWVYgfHwKKwkJ
IGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfWVZZVSkKKwkJcDFfYmEgPSBjbWFfb2JqLT5w
YWRkciArIGZiLT5vZmZzZXRzWzBdICsKKwkJCWZiLT5waXRjaGVzWzBdICogKHN0YXRlLT5zcmMu
eTEgPj4gMTYpICsKKwkJCTIgKiBmb3JtYXQtPmNoYXJfcGVyX2Jsb2NrWzBdICogKHN0YXRlLT5z
cmMueDEgPj4gMTcpOworCisJaWYgKGZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfTlYxMiB8
fAorCSAgICBmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX05WMjEpCisJCXAyX2JhID0gY21h
X29iai0+cGFkZHIgKyBmYi0+b2Zmc2V0c1sxXSArCisJCQkoKChmYi0+cGl0Y2hlc1sxXSA+PiAx
KSAqIChzdGF0ZS0+c3JjLnkxID4+IDE3KSArCisJCQkoc3RhdGUtPnNyYy54MSA+PiAxNykpIDw8
IDEpOworCisJZGNzc19kcHJfYWRkcl9zZXQoZGNzcy0+ZHByLCBkY3NzX3BsYW5lLT5jaF9udW0s
IHAxX2JhLCBwMl9iYSwKKwkJCSAgZmItPnBpdGNoZXNbMF0pOworfQorCitzdGF0aWMgYm9vbCBk
Y3NzX3BsYW5lX25lZWRzX3NldHVwKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlLAorCQkJ
CSAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHN0YXRlLT5mYjsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRf
ZmIgPSBvbGRfc3RhdGUtPmZiOworCisJcmV0dXJuIHN0YXRlLT5jcnRjX3ggIT0gb2xkX3N0YXRl
LT5jcnRjX3ggfHwKKwkgICAgICAgc3RhdGUtPmNydGNfeSAhPSBvbGRfc3RhdGUtPmNydGNfeSB8
fAorCSAgICAgICBzdGF0ZS0+Y3J0Y193ICE9IG9sZF9zdGF0ZS0+Y3J0Y193IHx8CisJICAgICAg
IHN0YXRlLT5jcnRjX2ggIT0gb2xkX3N0YXRlLT5jcnRjX2ggfHwKKwkgICAgICAgc3RhdGUtPnNy
Y194ICAhPSBvbGRfc3RhdGUtPnNyY194ICB8fAorCSAgICAgICBzdGF0ZS0+c3JjX3kgICE9IG9s
ZF9zdGF0ZS0+c3JjX3kgIHx8CisJICAgICAgIHN0YXRlLT5zcmNfdyAgIT0gb2xkX3N0YXRlLT5z
cmNfdyAgfHwKKwkgICAgICAgc3RhdGUtPnNyY19oICAhPSBvbGRfc3RhdGUtPnNyY19oICB8fAor
CSAgICAgICBmYi0+Zm9ybWF0LT5mb3JtYXQgIT0gb2xkX2ZiLT5mb3JtYXQtPmZvcm1hdCB8fAor
CSAgICAgICBmYi0+bW9kaWZpZXIgICE9IG9sZF9mYi0+bW9kaWZpZXIgfHwKKwkgICAgICAgc3Rh
dGUtPnJvdGF0aW9uICE9IG9sZF9zdGF0ZS0+cm90YXRpb247Cit9CisKK3N0YXRpYyB2b2lkIGRj
c3NfcGxhbmVfYXRvbWljX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKKwkJCQkgICAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX3BsYW5l
X3N0YXRlICpzdGF0ZSA9IHBsYW5lLT5zdGF0ZTsKKwlzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19w
bGFuZSA9IHRvX2Rjc3NfcGxhbmUocGxhbmUpOworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IHBs
YW5lLT5kZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3Rh
dGUtPmZiOworCXUzMiBwaXhlbF9mb3JtYXQ7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlOworCWJvb2wgbW9kaWZpZXJzX3ByZXNlbnQ7CisJdTMyIHNyY193LCBzcmNfaCwgZHN0
X3csIGRzdF9oOworCXN0cnVjdCBkcm1fcmVjdCBzcmMsIGRzdDsKKwlib29sIGVuYWJsZSA9IHRy
dWU7CisKKwlpZiAoIWZiIHx8ICFzdGF0ZS0+Y3J0YyB8fCAhc3RhdGUtPnZpc2libGUpCisJCXJl
dHVybjsKKworCXBpeGVsX2Zvcm1hdCA9IHN0YXRlLT5mYi0+Zm9ybWF0LT5mb3JtYXQ7CisJY3J0
Y19zdGF0ZSA9IHN0YXRlLT5jcnRjLT5zdGF0ZTsKKwltb2RpZmllcnNfcHJlc2VudCA9ICEhKGZi
LT5mbGFncyAmIERSTV9NT0RFX0ZCX01PRElGSUVSUyk7CisKKwlpZiAob2xkX3N0YXRlLT5mYiAm
JiAhZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkgJiYKKwkgICAgIWRj
c3NfcGxhbmVfbmVlZHNfc2V0dXAoc3RhdGUsIG9sZF9zdGF0ZSkpIHsKKwkJZGNzc19wbGFuZV9h
dG9taWNfc2V0X2Jhc2UoZGNzc19wbGFuZSk7CisJCXJldHVybjsKKwl9CisKKwlzcmMgPSBwbGFu
ZS0+c3RhdGUtPnNyYzsKKwlkc3QgPSBwbGFuZS0+c3RhdGUtPmRzdDsKKworCS8qCisJICogVGhl
IHdpZHRoIGFuZCBoZWlnaHQgYWZ0ZXIgY2xpcHBpbmcuCisJICovCisJc3JjX3cgPSBkcm1fcmVj
dF93aWR0aCgmc3JjKSA+PiAxNjsKKwlzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmc3JjKSA+PiAx
NjsKKwlkc3RfdyA9IGRybV9yZWN0X3dpZHRoKCZkc3QpOworCWRzdF9oID0gZHJtX3JlY3RfaGVp
Z2h0KCZkc3QpOworCisJaWYgKHBsYW5lLT50eXBlID09IERSTV9QTEFORV9UWVBFX09WRVJMQVkg
JiYKKwkgICAgbW9kaWZpZXJzX3ByZXNlbnQgJiYgZmItPm1vZGlmaWVyID09IERSTV9GT1JNQVRf
TU9EX0xJTkVBUikKKwkJbW9kaWZpZXJzX3ByZXNlbnQgPSBmYWxzZTsKKworCWRjc3NfZHByX2Zv
cm1hdF9zZXQoZGNzcy0+ZHByLCBkY3NzX3BsYW5lLT5jaF9udW0sIHN0YXRlLT5mYi0+Zm9ybWF0
LAorCQkJICAgIG1vZGlmaWVyc19wcmVzZW50ID8gZmItPm1vZGlmaWVyIDoKKwkJCQkJCURSTV9G
T1JNQVRfTU9EX0xJTkVBUik7CisJZGNzc19kcHJfc2V0X3JlcyhkY3NzLT5kcHIsIGRjc3NfcGxh
bmUtPmNoX251bSwgc3JjX3csIHNyY19oKTsKKwlkY3NzX2Rwcl9zZXRfcm90YXRpb24oZGNzcy0+
ZHByLCBkY3NzX3BsYW5lLT5jaF9udW0sCisJCQkgICAgICBzdGF0ZS0+cm90YXRpb24pOworCisJ
ZGNzc19wbGFuZV9hdG9taWNfc2V0X2Jhc2UoZGNzc19wbGFuZSk7CisKKwlkY3NzX3NjYWxlcl9z
ZXR1cChkY3NzLT5zY2FsZXIsIGRjc3NfcGxhbmUtPmNoX251bSwKKwkJCSAgc3RhdGUtPmZiLT5m
b3JtYXQsIHNyY193LCBzcmNfaCwKKwkJCSAgZHN0X3csIGRzdF9oLAorCQkJICBkcm1fbW9kZV92
cmVmcmVzaCgmY3J0Y19zdGF0ZS0+bW9kZSkpOworCisJZGNzc19kdGdfcGxhbmVfcG9zX3NldChk
Y3NzLT5kdGcsIGRjc3NfcGxhbmUtPmNoX251bSwKKwkJCSAgICAgICBkc3QueDEsIGRzdC55MSwg
ZHN0X3csIGRzdF9oKTsKKwlkY3NzX2R0Z19wbGFuZV9hbHBoYV9zZXQoZGNzcy0+ZHRnLCBkY3Nz
X3BsYW5lLT5jaF9udW0sCisJCQkJIGZiLT5mb3JtYXQsIHN0YXRlLT5hbHBoYSA+PiA4KTsKKwor
CWlmICghZGNzc19wbGFuZS0+Y2hfbnVtICYmIChzdGF0ZS0+YWxwaGEgPj4gOCkgPT0gMCkKKwkJ
ZW5hYmxlID0gZmFsc2U7CisKKwlkY3NzX2Rwcl9lbmFibGUoZGNzcy0+ZHByLCBkY3NzX3BsYW5l
LT5jaF9udW0sIGVuYWJsZSk7CisJZGNzc19zY2FsZXJfY2hfZW5hYmxlKGRjc3MtPnNjYWxlciwg
ZGNzc19wbGFuZS0+Y2hfbnVtLCBlbmFibGUpOworCisJaWYgKCFlbmFibGUpCisJCWRjc3NfZHRn
X3BsYW5lX3Bvc19zZXQoZGNzcy0+ZHRnLCBkY3NzX3BsYW5lLT5jaF9udW0sCisJCQkJICAgICAg
IDAsIDAsIDAsIDApOworCisJZGNzc19kdGdfY2hfZW5hYmxlKGRjc3MtPmR0ZywgZGNzc19wbGFu
ZS0+Y2hfbnVtLCBlbmFibGUpOworfQorCitzdGF0aWMgdm9pZCBkY3NzX3BsYW5lX2F0b21pY19k
aXNhYmxlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAorCQkJCSAgICAgIHN0cnVjdCBkcm1fcGxh
bmVfc3RhdGUgKm9sZF9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZGNzc19wbGFuZSAqZGNzc19wbGFuZSA9
IHRvX2Rjc3NfcGxhbmUocGxhbmUpOworCXN0cnVjdCBkY3NzX2RldiAqZGNzcyA9IHBsYW5lLT5k
ZXYtPmRldl9wcml2YXRlOworCisJZGNzc19kcHJfZW5hYmxlKGRjc3MtPmRwciwgZGNzc19wbGFu
ZS0+Y2hfbnVtLCBmYWxzZSk7CisJZGNzc19zY2FsZXJfY2hfZW5hYmxlKGRjc3MtPnNjYWxlciwg
ZGNzc19wbGFuZS0+Y2hfbnVtLCBmYWxzZSk7CisJZGNzc19kdGdfcGxhbmVfcG9zX3NldChkY3Nz
LT5kdGcsIGRjc3NfcGxhbmUtPmNoX251bSwgMCwgMCwgMCwgMCk7CisJZGNzc19kdGdfY2hfZW5h
YmxlKGRjc3MtPmR0ZywgZGNzc19wbGFuZS0+Y2hfbnVtLCBmYWxzZSk7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2hlbHBlcl9mdW5jcyBkY3NzX3BsYW5lX2hlbHBlcl9mdW5j
cyA9IHsKKwkucHJlcGFyZV9mYiA9IGRybV9nZW1fZmJfcHJlcGFyZV9mYiwKKwkuYXRvbWljX2No
ZWNrID0gZGNzc19wbGFuZV9hdG9taWNfY2hlY2ssCisJLmF0b21pY191cGRhdGUgPSBkY3NzX3Bs
YW5lX2F0b21pY191cGRhdGUsCisJLmF0b21pY19kaXNhYmxlID0gZGNzc19wbGFuZV9hdG9taWNf
ZGlzYWJsZSwKK307CisKK3N0cnVjdCBkY3NzX3BsYW5lICpkY3NzX3BsYW5lX2luaXQoc3RydWN0
IGRybV9kZXZpY2UgKmRybSwKKwkJCQkgICB1bnNpZ25lZCBpbnQgcG9zc2libGVfY3J0Y3MsCisJ
CQkJICAgZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlLAorCQkJCSAgIHVuc2lnbmVkIGludCB6cG9z
KQoreworCXN0cnVjdCBkY3NzX3BsYW5lICpkY3NzX3BsYW5lOworCWNvbnN0IHU2NCAqZm9ybWF0
X21vZGlmaWVycyA9IGRjc3NfdmlkZW9fZm9ybWF0X21vZGlmaWVyczsKKwlpbnQgcmV0OworCisJ
aWYgKHpwb3MgPiAyKQorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKKworCWRjc3NfcGxhbmUg
PSBremFsbG9jKHNpemVvZigqZGNzc19wbGFuZSksIEdGUF9LRVJORUwpOworCWlmICghZGNzc19w
bGFuZSkgeworCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxvY2F0ZSBwbGFuZVxuIik7CisJCXJl
dHVybiBFUlJfUFRSKC1FTk9NRU0pOworCX0KKworCWlmICh0eXBlID09IERSTV9QTEFORV9UWVBF
X1BSSU1BUlkpCisJCWZvcm1hdF9tb2RpZmllcnMgPSBkY3NzX2dyYXBoaWNzX2Zvcm1hdF9tb2Rp
ZmllcnM7CisKKwlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoZHJtLCAmZGNzc19wbGFu
ZS0+YmFzZSwgcG9zc2libGVfY3J0Y3MsCisJCQkJICAgICAgICZkY3NzX3BsYW5lX2Z1bmNzLCBk
Y3NzX2NvbW1vbl9mb3JtYXRzLAorCQkJCSAgICAgICBBUlJBWV9TSVpFKGRjc3NfY29tbW9uX2Zv
cm1hdHMpLAorCQkJCSAgICAgICBmb3JtYXRfbW9kaWZpZXJzLCB0eXBlLCBOVUxMKTsKKwlpZiAo
cmV0KSB7CisJCURSTV9FUlJPUigiZmFpbGVkIHRvIGluaXRpYWxpemUgcGxhbmVcbiIpOworCQlr
ZnJlZShkY3NzX3BsYW5lKTsKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwl9CisKKwlkcm1fcGxh
bmVfaGVscGVyX2FkZCgmZGNzc19wbGFuZS0+YmFzZSwgJmRjc3NfcGxhbmVfaGVscGVyX2Z1bmNz
KTsKKworCXJldCA9IGRybV9wbGFuZV9jcmVhdGVfenBvc19pbW11dGFibGVfcHJvcGVydHkoJmRj
c3NfcGxhbmUtPmJhc2UsIHpwb3MpOworCWlmIChyZXQpCisJCXJldHVybiBFUlJfUFRSKHJldCk7
CisKKwlkcm1fcGxhbmVfY3JlYXRlX3JvdGF0aW9uX3Byb3BlcnR5KCZkY3NzX3BsYW5lLT5iYXNl
LAorCQkJCQkgICBEUk1fTU9ERV9ST1RBVEVfMCwKKwkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAg
ICB8CisJCQkJCSAgIERSTV9NT0RFX1JPVEFURV85MCAgfAorCQkJCQkgICBEUk1fTU9ERV9ST1RB
VEVfMTgwIHwKKwkJCQkJICAgRFJNX01PREVfUk9UQVRFXzI3MCB8CisJCQkJCSAgIERSTV9NT0RF
X1JFRkxFQ1RfWCAgfAorCQkJCQkgICBEUk1fTU9ERV9SRUZMRUNUX1kpOworCisJZGNzc19wbGFu
ZS0+Y2hfbnVtID0genBvczsKKworCXJldHVybiBkY3NzX3BsYW5lOworfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2lteC9kY3NzL2Rjc3Mtc2NhbGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aW14L2Rjc3MvZGNzcy1zY2FsZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MC4uNTZmYzg3MgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9k
Y3NzLXNjYWxlci5jCkBAIC0wLDAgKzEsODI2IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmll
cjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdodCAyMDE5IE5YUC4KKyAqCisgKiBTY2FsaW5nIGFs
Z29yaXRobXMgd2VyZSBjb250cmlidXRlZCBieSBEenVuZyBIb2FuZyA8ZHp1bmcuaG9hbmdAbnhw
LmNvbT4KKyAqLworCisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisKKyNpbmNsdWRlICJkY3Nz
LWRldi5oIgorCisjZGVmaW5lIERDU1NfU0NBTEVSX0NUUkwJCQkweDAwCisjZGVmaW5lICAgU0NB
TEVSX0VOCQkJCUJJVCgwKQorI2RlZmluZSAgIFJFUEVBVF9FTgkJCQlCSVQoNCkKKyNkZWZpbmUg
ICBTQ0FMRTJNRU1fRU4JCQkJQklUKDgpCisjZGVmaW5lICAgTUVNMk9GSUZPX0VOCQkJCUJJVCgx
MikKKyNkZWZpbmUgRENTU19TQ0FMRVJfT0ZJRk9fQ1RSTAkJCTB4MDQKKyNkZWZpbmUgICBPRklG
T19MT1dfVEhSRVNfUE9TCQkJMAorI2RlZmluZSAgIE9GSUZPX0xPV19USFJFU19NQVNLCQkJR0VO
TUFTSyg5LCAwKQorI2RlZmluZSAgIE9GSUZPX0hJR0hfVEhSRVNfUE9TCQkJMTYKKyNkZWZpbmUg
ICBPRklGT19ISUdIX1RIUkVTX01BU0sJCQlHRU5NQVNLKDI1LCAxNikKKyNkZWZpbmUgICBVTkRF
UlJVTl9ERVRFQ1RfQ0xSCQkJQklUKDI2KQorI2RlZmluZSAgIExPV19USFJFU19ERVRFQ1RfQ0xS
CQkJQklUKDI3KQorI2RlZmluZSAgIEhJR0hfVEhSRVNfREVURUNUX0NMUgkJCUJJVCgyOCkKKyNk
ZWZpbmUgICBVTkRFUlJVTl9ERVRFQ1RfRU4JCQlCSVQoMjkpCisjZGVmaW5lICAgTE9XX1RIUkVT
X0RFVEVDVF9FTgkJCUJJVCgzMCkKKyNkZWZpbmUgICBISUdIX1RIUkVTX0RFVEVDVF9FTgkJCUJJ
VCgzMSkKKyNkZWZpbmUgRENTU19TQ0FMRVJfU0RBVEFfQ1RSTAkJCTB4MDgKKyNkZWZpbmUgICBZ
VVZfRU4JCQkJQklUKDApCisjZGVmaW5lICAgUlRSQU1fOExJTkVTCQkJCUJJVCgxKQorI2RlZmlu
ZSAgIFlfVVZfQllURV9TV0FQCQkJQklUKDQpCisjZGVmaW5lICAgQTJSMTBHMTBCMTBfRk9STUFU
X1BPUwkJOAorI2RlZmluZSAgIEEyUjEwRzEwQjEwX0ZPUk1BVF9NQVNLCQlHRU5NQVNLKDExLCA4
KQorI2RlZmluZSBEQ1NTX1NDQUxFUl9CSVRfREVQVEgJCQkweDBDCisjZGVmaW5lICAgTFVNX0JJ
VF9ERVBUSF9QT1MJCQkwCisjZGVmaW5lICAgTFVNX0JJVF9ERVBUSF9NQVNLCQkJR0VOTUFTSygx
LCAwKQorI2RlZmluZSAgIENIUl9CSVRfREVQVEhfUE9TCQkJNAorI2RlZmluZSAgIENIUl9CSVRf
REVQVEhfTUFTSwkJCUdFTk1BU0soNSwgNCkKKyNkZWZpbmUgRENTU19TQ0FMRVJfU1JDX0ZPUk1B
VAkJCTB4MTAKKyNkZWZpbmUgRENTU19TQ0FMRVJfRFNUX0ZPUk1BVAkJCTB4MTQKKyNkZWZpbmUg
ICBGT1JNQVRfTUFTSwkJCQlHRU5NQVNLKDEsIDApCisjZGVmaW5lIERDU1NfU0NBTEVSX1NSQ19M
VU1fUkVTCQkJMHgxOAorI2RlZmluZSBEQ1NTX1NDQUxFUl9TUkNfQ0hSX1JFUwkJCTB4MUMKKyNk
ZWZpbmUgRENTU19TQ0FMRVJfRFNUX0xVTV9SRVMJCQkweDIwCisjZGVmaW5lIERDU1NfU0NBTEVS
X0RTVF9DSFJfUkVTCQkJMHgyNAorI2RlZmluZSAgIFdJRFRIX1BPUwkJCQkwCisjZGVmaW5lICAg
V0lEVEhfTUFTSwkJCQlHRU5NQVNLKDExLCAwKQorI2RlZmluZSAgIEhFSUdIVF9QT1MJCQkJMTYK
KyNkZWZpbmUgICBIRUlHSFRfTUFTSwkJCQlHRU5NQVNLKDI3LCAxNikKKyNkZWZpbmUgRENTU19T
Q0FMRVJfVl9MVU1fU1RBUlQJCQkweDQ4CisjZGVmaW5lICAgVl9TVEFSVF9NQVNLCQkJCUdFTk1B
U0soMTUsIDApCisjZGVmaW5lIERDU1NfU0NBTEVSX1ZfTFVNX0lOQwkJCTB4NEMKKyNkZWZpbmUg
ICBWX0lOQ19NQVNLCQkJCUdFTk1BU0soMTUsIDApCisjZGVmaW5lIERDU1NfU0NBTEVSX0hfTFVN
X1NUQVJUCQkJMHg1MAorI2RlZmluZSAgIEhfU1RBUlRfTUFTSwkJCQlHRU5NQVNLKDE4LCAwKQor
I2RlZmluZSBEQ1NTX1NDQUxFUl9IX0xVTV9JTkMJCQkweDU0CisjZGVmaW5lICAgSF9JTkNfTUFT
SwkJCQlHRU5NQVNLKDE1LCAwKQorI2RlZmluZSBEQ1NTX1NDQUxFUl9WX0NIUl9TVEFSVAkJCTB4
NTgKKyNkZWZpbmUgRENTU19TQ0FMRVJfVl9DSFJfSU5DCQkJMHg1QworI2RlZmluZSBEQ1NTX1ND
QUxFUl9IX0NIUl9TVEFSVAkJCTB4NjAKKyNkZWZpbmUgRENTU19TQ0FMRVJfSF9DSFJfSU5DCQkJ
MHg2NAorI2RlZmluZSBEQ1NTX1NDQUxFUl9DT0VGX1ZMVU0JCQkweDgwCisjZGVmaW5lIERDU1Nf
U0NBTEVSX0NPRUZfSExVTQkJCTB4MTQwCisjZGVmaW5lIERDU1NfU0NBTEVSX0NPRUZfVkNIUgkJ
CTB4MjAwCisjZGVmaW5lIERDU1NfU0NBTEVSX0NPRUZfSENIUgkJCTB4MzAwCisKK3N0cnVjdCBk
Y3NzX3NjYWxlcl9jaCB7CisJdm9pZCBfX2lvbWVtICpiYXNlX3JlZzsKKwl1MzIgYmFzZV9vZnM7
CisJc3RydWN0IGRjc3Nfc2NhbGVyICpzY2w7CisKKwl1MzIgc2RhdGFfY3RybDsKKwl1MzIgc2Nh
bGVyX2N0cmw7CisKKwlib29sIHNjYWxlcl9jdHJsX2NoZ2Q7CisKKwl1MzIgY192c3RhcnQ7CisJ
dTMyIGNfaHN0YXJ0OworfTsKKworc3RydWN0IGRjc3Nfc2NhbGVyIHsKKwlzdHJ1Y3QgZGV2aWNl
ICpkZXY7CisKKwlzdHJ1Y3QgZGNzc19jdHhsZCAqY3R4bGQ7CisJdTMyIGN0eF9pZDsKKworCXN0
cnVjdCBkY3NzX3NjYWxlcl9jaCBjaFszXTsKK307CisKKy8qIHNjYWxlciBjb2VmZmljaWVudHMg
Z2VuZXJhdG9yICovCisjZGVmaW5lIFBTQ19GUkFDX0JJVFMgMzAKKyNkZWZpbmUgUFNDX0ZSQUNf
U0NBTEUgQklUKFBTQ19GUkFDX0JJVFMpCisjZGVmaW5lIFBTQ19CSVRTX0ZPUl9QSEFTRSA0Cisj
ZGVmaW5lIFBTQ19OVU1fUEhBU0VTIDE2CisjZGVmaW5lIFBTQ19TVE9SRURfUEhBU0VTIChQU0Nf
TlVNX1BIQVNFUyAvIDIgKyAxKQorI2RlZmluZSBQU0NfTlVNX1RBUFMgNworI2RlZmluZSBQU0Nf
TlVNX1RBUFNfUkdCQSA1CisjZGVmaW5lIFBTQ19DT0VGRl9QUkVDSVNJT04gMTAKKyNkZWZpbmUg
UFNDX1BIQVNFX0ZSQUNUSU9OX0JJVFMgMTMKKyNkZWZpbmUgUFNDX1BIQVNFX01BU0sgKFBTQ19O
VU1fUEhBU0VTIC0gMSkKKyNkZWZpbmUgUFNDX1FfRlJBQ1RJT04gMTkKKyNkZWZpbmUgUFNDX1Ff
Uk9VTkRfT0ZGU0VUICgxIDw8IChQU0NfUV9GUkFDVElPTiAtIDEpKQorCisvKioKKyAqIG11bHRf
cSgpIC0gUGVyZm9ybXMgZml4ZWQtcG9pbnQgbXVsdGlwbGljYXRpb24uCisgKiBAQTogbXVsdGlw
bGllcgorICogQEI6IG11bHRpcGxpY2FuZAorICovCitzdGF0aWMgaW50IG11bHRfcShpbnQgQSwg
aW50IEIpCit7CisJaW50IHJlc3VsdDsKKwlzNjQgdGVtcDsKKworCXRlbXAgPSAoaW50NjRfdClB
ICogKGludDY0X3QpQjsKKwl0ZW1wICs9IFBTQ19RX1JPVU5EX09GRlNFVDsKKwlyZXN1bHQgPSAo
aW50KSh0ZW1wID4+IFBTQ19RX0ZSQUNUSU9OKTsKKwlyZXR1cm4gcmVzdWx0OworfQorCisvKioK
KyAqIGRpdl9xKCkgLSBQZXJmb3JtcyBmaXhlZC1wb2ludCBkaXZpc2lvbi4KKyAqIEBBOiBkaXZp
ZGVuZAorICogQEI6IGRpdmlzb3IKKyAqLworc3RhdGljIGludCBkaXZfcShpbnQgQSwgaW50IEIp
Cit7CisJaW50IHJlc3VsdDsKKwlzNjQgdGVtcDsKKworCXRlbXAgPSAoaW50NjRfdClBIDw8IFBT
Q19RX0ZSQUNUSU9OOworCWlmICgodGVtcCA+PSAwICYmIEIgPj0gMCkgfHwgKHRlbXAgPCAwICYm
IEIgPCAwKSkKKwkJdGVtcCArPSBCIC8gMjsKKwllbHNlCisJCXRlbXAgLT0gQiAvIDI7CisKKwly
ZXN1bHQgPSAoaW50KSh0ZW1wIC8gQik7CisJcmV0dXJuIHJlc3VsdDsKK30KKworLyoqCisgKiBl
eHBfYXBwcm94X3EoKSAtIENvbXB1dGUgYXBwcm94aW1hdGlvbiB0byBleHAoeCkgZnVuY3Rpb24g
dXNpbmcgVGF5bG9yCisgKgkJICAgIHNlcmllcy4KKyAqIEB4OiBmaXhlZC1wb2ludCBhcmd1bWVu
dCBvZiBleHAgZnVuY3Rpb24KKyAqLworc3RhdGljIGludCBleHBfYXBwcm94X3EoaW50IHgpCit7
CisJaW50IHN1bSA9IDEgPDwgUFNDX1FfRlJBQ1RJT047CisJaW50IHRlcm0gPSAxIDw8IFBTQ19R
X0ZSQUNUSU9OOworCisJdGVybSA9IG11bHRfcSh0ZXJtLCBkaXZfcSh4LCAxIDw8IFBTQ19RX0ZS
QUNUSU9OKSk7CisJc3VtICs9IHRlcm07CisJdGVybSA9IG11bHRfcSh0ZXJtLCBkaXZfcSh4LCAy
IDw8IFBTQ19RX0ZSQUNUSU9OKSk7CisJc3VtICs9IHRlcm07CisJdGVybSA9IG11bHRfcSh0ZXJt
LCBkaXZfcSh4LCAzIDw8IFBTQ19RX0ZSQUNUSU9OKSk7CisJc3VtICs9IHRlcm07CisJdGVybSA9
IG11bHRfcSh0ZXJtLCBkaXZfcSh4LCA0IDw8IFBTQ19RX0ZSQUNUSU9OKSk7CisJc3VtICs9IHRl
cm07CisKKwlyZXR1cm4gc3VtOworfQorCisvKioKKyAqIGRjc3Nfc2NhbGVyX2dhdXNzaWFuX2Zp
bHRlcigpIC0gR2VuZXJhdGUgZ2F1c3NpYW4gcHJvdG90eXBlIGZpbHRlci4KKyAqIEBmY19xOiBm
aXhlZC1wb2ludCBjdXRvZmYgZnJlcXVlbmN5IG5vcm1hbGl6ZWQgdG8gcmFuZ2UgWzAsIDFdCisg
KiBAdXNlXzVfdGFwczogaW5kaWNhdGVzIHdoZXRoZXIgdG8gdXNlIDUgdGFwcyBvciA3IHRhcHMK
KyAqIEBjb2VmOiBvdXRwdXQgZmlsdGVyIGNvZWZmaWNpZW50cworICovCitzdGF0aWMgdm9pZCBk
Y3NzX3NjYWxlcl9nYXVzc2lhbl9maWx0ZXIoaW50IGZjX3EsIGJvb2wgdXNlXzVfdGFwcywKKwkJ
CQkJYm9vbCBwaGFzZTBfaWRlbnRpdHksCisJCQkJCWludCBjb2VmW11bUFNDX05VTV9UQVBTXSkK
K3sKKwlpbnQgc2lnbWFfcSwgZzBfcSwgZzFfcSwgZzJfcTsKKwlpbnQgdGFwX2NudDEsIHRhcF9j
bnQyLCB0YXBfaWR4LCBwaGFzZV9jbnQ7CisJaW50IG1pZDsKKwlpbnQgcGhhc2U7CisJaW50IGk7
CisJaW50IHRhcHM7CisKKwlpZiAodXNlXzVfdGFwcykKKwkJZm9yIChwaGFzZSA9IDA7IHBoYXNl
IDwgUFNDX1NUT1JFRF9QSEFTRVM7IHBoYXNlKyspIHsKKwkJCWNvZWZbcGhhc2VdWzBdID0gMDsK
KwkJCWNvZWZbcGhhc2VdW1BTQ19OVU1fVEFQUyAtIDFdID0gMDsKKwkJfQorCisJLyogc2VlZCBj
b2VmZmljaWVudCBzY2FubmVyICovCisJdGFwcyA9IHVzZV81X3RhcHMgPyBQU0NfTlVNX1RBUFNf
UkdCQSA6IFBTQ19OVU1fVEFQUzsKKwltaWQgPSAoUFNDX05VTV9QSEFTRVMgKiB0YXBzKSAvIDIg
LSAxOworCXBoYXNlX2NudCA9IChQU0NfTlVNX1BIQVNFUyAqIChQU0NfTlVNX1RBUFMgKyAxKSkg
LyAyOworCXRhcF9jbnQxID0gKFBTQ19OVU1fUEhBU0VTICogUFNDX05VTV9UQVBTKSAvIDI7CisJ
dGFwX2NudDIgPSAoUFNDX05VTV9QSEFTRVMgKiBQU0NfTlVNX1RBUFMpIC8gMjsKKworCS8qIHNl
ZWQgZ2F1c3NpYW4gZmlsdGVyIGdlbmVyYXRvciAqLworCXNpZ21hX3EgPSBkaXZfcShQU0NfUV9S
T1VORF9PRkZTRVQsIGZjX3EpOworCWcwX3EgPSAxIDw8IFBTQ19RX0ZSQUNUSU9OOworCWcxX3Eg
PSBleHBfYXBwcm94X3EoZGl2X3EoLVBTQ19RX1JPVU5EX09GRlNFVCwKKwkJCQkgIG11bHRfcShz
aWdtYV9xLCBzaWdtYV9xKSkpOworCWcyX3EgPSBtdWx0X3EoZzFfcSwgZzFfcSk7CisJY29lZltw
aGFzZV9jbnQgJiBQU0NfUEhBU0VfTUFTS11bdGFwX2NudDEgPj4gUFNDX0JJVFNfRk9SX1BIQVNF
XSA9IGcwX3E7CisKKwlmb3IgKGkgPSAwOyBpIDwgbWlkOyBpKyspIHsKKwkJcGhhc2VfY250Kys7
CisJCXRhcF9jbnQxLS07CisJCXRhcF9jbnQyKys7CisKKwkJZzBfcSA9IG11bHRfcShnMF9xLCBn
MV9xKTsKKwkJZzFfcSA9IG11bHRfcShnMV9xLCBnMl9xKTsKKworCQlpZiAoKHBoYXNlX2NudCAm
IFBTQ19QSEFTRV9NQVNLKSA8PSA4KSB7CisJCQl0YXBfaWR4ID0gdGFwX2NudDEgPj4gUFNDX0JJ
VFNfRk9SX1BIQVNFOworCQkJY29lZltwaGFzZV9jbnQgJiBQU0NfUEhBU0VfTUFTS11bdGFwX2lk
eF0gPSBnMF9xOworCQl9CisJCWlmICgoKC1waGFzZV9jbnQpICYgUFNDX1BIQVNFX01BU0spIDw9
IDgpIHsKKwkJCXRhcF9pZHggPSB0YXBfY250MiA+PiBQU0NfQklUU19GT1JfUEhBU0U7CisJCQlj
b2VmWygtcGhhc2VfY250KSAmIFBTQ19QSEFTRV9NQVNLXVt0YXBfaWR4XSA9IGcwX3E7CisJCX0K
Kwl9CisKKwlwaGFzZV9jbnQrKzsKKwl0YXBfY250MS0tOworCWNvZWZbcGhhc2VfY250ICYgUFND
X1BIQVNFX01BU0tdW3RhcF9jbnQxID4+IFBTQ19CSVRTX0ZPUl9QSEFTRV0gPSAwOworCisJLyog
b3ZlcnJpZGUgcGhhc2UgMCB3aXRoIGlkZW50aXR5IGZpbHRlciBpZiBzcGVjaWZpZWQgKi8KKwlp
ZiAocGhhc2UwX2lkZW50aXR5KQorCQlmb3IgKGkgPSAwOyBpIDwgUFNDX05VTV9UQVBTOyBpKysp
CisJCQljb2VmWzBdW2ldID0gaSA9PSAoUFNDX05VTV9UQVBTID4+IDEpID8KKwkJCQkJCSgxIDw8
IFBTQ19DT0VGRl9QUkVDSVNJT04pIDogMDsKKworCS8qIG5vcm1hbGl6ZSBjb2VmICovCisJZm9y
IChwaGFzZSA9IDA7IHBoYXNlIDwgUFNDX1NUT1JFRF9QSEFTRVM7IHBoYXNlKyspIHsKKwkJaW50
IHN1bSA9IDA7CisJCXM2NCBsbF90ZW1wOworCisJCWZvciAoaSA9IDA7IGkgPCBQU0NfTlVNX1RB
UFM7IGkrKykKKwkJCXN1bSArPSBjb2VmW3BoYXNlXVtpXTsKKwkJZm9yIChpID0gMDsgaSA8IFBT
Q19OVU1fVEFQUzsgaSsrKSB7CisJCQlsbF90ZW1wID0gY29lZltwaGFzZV1baV07CisJCQlsbF90
ZW1wIDw8PSBQU0NfQ09FRkZfUFJFQ0lTSU9OOworCQkJbGxfdGVtcCArPSBzdW0gPj4gMTsKKwkJ
CWxsX3RlbXAgLz0gc3VtOworCQkJY29lZltwaGFzZV1baV0gPSAoaW50KWxsX3RlbXA7CisJCX0K
Kwl9Cit9CisKKy8qKgorICogZGNzc19zY2FsZXJfZmlsdGVyX2Rlc2lnbigpIC0gQ29tcHV0ZSBm
aWx0ZXIgY29lZmZpY2llbnRzIHVzaW5nCisgKgkJCQkgR2F1c3NpYW4gZmlsdGVyLgorICogQHNy
Y19sZW5ndGg6IGxlbmd0aCBvZiBpbnB1dAorICogQGRzdF9sZW5ndGg6IGxlbmd0aCBvZiBvdXRw
dXQKKyAqIEB1c2VfNV90YXBzOiAwIGZvciA3IHRhcHMgcGVyIHBoYXNlLCAxIGZvciA1IHRhcHMK
KyAqIEBjb2VmOiBvdXRwdXQgY29lZmZpY2llbnRzCisgKi8KK3N0YXRpYyB2b2lkIGRjc3Nfc2Nh
bGVyX2ZpbHRlcl9kZXNpZ24oaW50IHNyY19sZW5ndGgsIGludCBkc3RfbGVuZ3RoLAorCQkJCSAg
ICAgIGJvb2wgdXNlXzVfdGFwcywgYm9vbCBwaGFzZTBfaWRlbnRpdHksCisJCQkJICAgICAgaW50
IGNvZWZbXVtQU0NfTlVNX1RBUFNdKQoreworCWludCBmY19xOworCisJLyogY29tcHV0ZSBjdXRv
ZmYgZnJlcXVlbmN5ICovCisJaWYgKGRzdF9sZW5ndGggPj0gc3JjX2xlbmd0aCkKKwkJZmNfcSA9
IGRpdl9xKDEsIFBTQ19OVU1fUEhBU0VTKTsKKwllbHNlCisJCWZjX3EgPSBkaXZfcShkc3RfbGVu
Z3RoLCBzcmNfbGVuZ3RoICogUFNDX05VTV9QSEFTRVMpOworCisJLyogY29tcHV0ZSBnYXVzc2lh
biBmaWx0ZXIgY29lZmZpY2llbnRzICovCisJZGNzc19zY2FsZXJfZ2F1c3NpYW5fZmlsdGVyKGZj
X3EsIHVzZV81X3RhcHMsIHBoYXNlMF9pZGVudGl0eSwgY29lZik7Cit9CisKK3N0YXRpYyB2b2lk
IGRjc3Nfc2NhbGVyX3dyaXRlKHN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gsIHUzMiB2YWwsIHUz
MiBvZnMpCit7CisJc3RydWN0IGRjc3Nfc2NhbGVyICpzY2wgPSBjaC0+c2NsOworCisJZGNzc19j
dHhsZF93cml0ZShzY2wtPmN0eGxkLCBzY2wtPmN0eF9pZCwgdmFsLCBjaC0+YmFzZV9vZnMgKyBv
ZnMpOworfQorCitzdGF0aWMgaW50IGRjc3Nfc2NhbGVyX2NoX2luaXRfYWxsKHN0cnVjdCBkY3Nz
X3NjYWxlciAqc2NsLAorCQkJCSAgIHVuc2lnbmVkIGxvbmcgc2NhbGVyX2Jhc2UpCit7CisJc3Ry
dWN0IGRjc3Nfc2NhbGVyX2NoICpjaDsKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCAzOyBp
KyspIHsKKwkJY2ggPSAmc2NsLT5jaFtpXTsKKworCQljaC0+YmFzZV9vZnMgPSBzY2FsZXJfYmFz
ZSArIGkgKiAweDQwMDsKKworCQljaC0+YmFzZV9yZWcgPSBkZXZtX2lvcmVtYXAoc2NsLT5kZXYs
IGNoLT5iYXNlX29mcywgU1pfNEspOworCQlpZiAoIWNoLT5iYXNlX3JlZykgeworCQkJZGV2X2Vy
cihzY2wtPmRldiwgInNjYWxlcjogdW5hYmxlIHRvIHJlbWFwIGNoIGJhc2VcbiIpOworCQkJcmV0
dXJuIC1FTk9NRU07CisJCX0KKworCQljaC0+c2NsID0gc2NsOworCX0KKworCXJldHVybiAwOwor
fQorCitpbnQgZGNzc19zY2FsZXJfaW5pdChzdHJ1Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVk
IGxvbmcgc2NhbGVyX2Jhc2UpCit7CisJc3RydWN0IGRjc3Nfc2NhbGVyICpzY2FsZXI7CisKKwlz
Y2FsZXIgPSBkZXZtX2t6YWxsb2MoZGNzcy0+ZGV2LCBzaXplb2YoKnNjYWxlciksIEdGUF9LRVJO
RUwpOworCWlmICghc2NhbGVyKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRjc3MtPnNjYWxlciA9
IHNjYWxlcjsKKwlzY2FsZXItPmRldiA9IGRjc3MtPmRldjsKKwlzY2FsZXItPmN0eGxkID0gZGNz
cy0+Y3R4bGQ7CisJc2NhbGVyLT5jdHhfaWQgPSBDVFhfU0JfSFA7CisKKwlpZiAoZGNzc19zY2Fs
ZXJfY2hfaW5pdF9hbGwoc2NhbGVyLCBzY2FsZXJfYmFzZSkpIHsKKwkJaW50IGk7CisKKwkJZm9y
IChpID0gMDsgaSA8IDM7IGkrKykgeworCQkJaWYgKHNjYWxlci0+Y2hbaV0uYmFzZV9yZWcpCisJ
CQkJZGV2bV9pb3VubWFwKHNjYWxlci0+ZGV2LAorCQkJCQkgICAgIHNjYWxlci0+Y2hbaV0uYmFz
ZV9yZWcpOworCQl9CisKKwkJZGV2bV9rZnJlZShzY2FsZXItPmRldiwgc2NhbGVyKTsKKworCQly
ZXR1cm4gLUVOT01FTTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwordm9pZCBkY3NzX3NjYWxlcl9l
eGl0KHN0cnVjdCBkY3NzX3NjYWxlciAqc2NsKQoreworCWludCBjaF9ubzsKKworCWZvciAoY2hf
bm8gPSAwOyBjaF9ubyA8IDM7IGNoX25vKyspIHsKKwkJc3RydWN0IGRjc3Nfc2NhbGVyX2NoICpj
aCA9ICZzY2wtPmNoW2NoX25vXTsKKworCQlkY3NzX3dyaXRlbCgwLCBjaC0+YmFzZV9yZWcgKyBE
Q1NTX1NDQUxFUl9DVFJMKTsKKworCQlpZiAoY2gtPmJhc2VfcmVnKQorCQkJZGV2bV9pb3VubWFw
KHNjbC0+ZGV2LCBjaC0+YmFzZV9yZWcpOworCX0KKworCWRldm1fa2ZyZWUoc2NsLT5kZXYsIHNj
bCk7Cit9CisKK3ZvaWQgZGNzc19zY2FsZXJfY2hfZW5hYmxlKHN0cnVjdCBkY3NzX3NjYWxlciAq
c2NsLCBpbnQgY2hfbnVtLCBib29sIGVuKQoreworCXN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gg
PSAmc2NsLT5jaFtjaF9udW1dOworCXUzMiBzY2FsZXJfY3RybDsKKworCXNjYWxlcl9jdHJsID0g
ZW4gPyBTQ0FMRVJfRU4gfCBSRVBFQVRfRU4gOiAwOworCisJaWYgKGVuKQorCQlkY3NzX3NjYWxl
cl93cml0ZShjaCwgY2gtPnNkYXRhX2N0cmwsIERDU1NfU0NBTEVSX1NEQVRBX0NUUkwpOworCisJ
aWYgKGNoLT5zY2FsZXJfY3RybCAhPSBzY2FsZXJfY3RybCkKKwkJY2gtPnNjYWxlcl9jdHJsX2No
Z2QgPSB0cnVlOworCisJY2gtPnNjYWxlcl9jdHJsID0gc2NhbGVyX2N0cmw7Cit9CisKK3N0YXRp
YyB2b2lkIGRjc3Nfc2NhbGVyX3l1dl9lbmFibGUoc3RydWN0IGRjc3Nfc2NhbGVyX2NoICpjaCwg
Ym9vbCBlbikKK3sKKwljaC0+c2RhdGFfY3RybCAmPSB+WVVWX0VOOworCWNoLT5zZGF0YV9jdHJs
IHw9IGVuID8gWVVWX0VOIDogMDsKK30KKworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfcnRyXzhs
aW5lc19lbmFibGUoc3RydWN0IGRjc3Nfc2NhbGVyX2NoICpjaCwgYm9vbCBlbikKK3sKKwljaC0+
c2RhdGFfY3RybCAmPSB+UlRSQU1fOExJTkVTOworCWNoLT5zZGF0YV9jdHJsIHw9IGVuID8gUlRS
QU1fOExJTkVTIDogMDsKK30KKworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfYml0X2RlcHRoX3Nl
dChzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLCBpbnQgZGVwdGgpCit7CisJdTMyIHZhbDsKKwor
CXZhbCA9IGRlcHRoID09IDMwID8gMiA6IDA7CisKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwKKwkJ
CSAgKCh2YWwgPDwgQ0hSX0JJVF9ERVBUSF9QT1MpICYgQ0hSX0JJVF9ERVBUSF9NQVNLKSB8CisJ
CQkgICgodmFsIDw8IExVTV9CSVRfREVQVEhfUE9TKSAmIExVTV9CSVRfREVQVEhfTUFTSyksCisJ
CQkgIERDU1NfU0NBTEVSX0JJVF9ERVBUSCk7Cit9CisKK2VudW0gYnVmZmVyX2Zvcm1hdCB7CisJ
QlVGX0ZNVF9ZVVY0MjAsCisJQlVGX0ZNVF9ZVVY0MjIsCisJQlVGX0ZNVF9BUkdCODg4OF9ZVVY0
NDQsCit9OworCitlbnVtIGNocm9tYV9sb2NhdGlvbiB7CisJUFNDX0xPQ19IT1JaXzBfVkVSVF8x
X09WRVJfNCA9IDAsCisJUFNDX0xPQ19IT1JaXzFfT1ZFUl80X1ZFUlRfMV9PVkVSXzQgPSAxLAor
CVBTQ19MT0NfSE9SWl8wX1ZFUlRfMCA9IDIsCisJUFNDX0xPQ19IT1JaXzFfT1ZFUl80X1ZFUlRf
MCA9IDMsCisJUFNDX0xPQ19IT1JaXzBfVkVSVF8xX09WRVJfMiA9IDQsCisJUFNDX0xPQ19IT1Ja
XzFfT1ZFUl80X1ZFUlRfMV9PVkVSXzIgPSA1Cit9OworCitzdGF0aWMgdm9pZCBkY3NzX3NjYWxl
cl9mb3JtYXRfc2V0KHN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gsCisJCQkJICAgZW51bSBidWZm
ZXJfZm9ybWF0IHNyY19mbXQsCisJCQkJICAgZW51bSBidWZmZXJfZm9ybWF0IGRzdF9mbXQpCit7
CisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIHNyY19mbXQsIERDU1NfU0NBTEVSX1NSQ19GT1JNQVQp
OworCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCBkc3RfZm10LCBEQ1NTX1NDQUxFUl9EU1RfRk9STUFU
KTsKK30KKworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfcmVzX3NldChzdHJ1Y3QgZGNzc19zY2Fs
ZXJfY2ggKmNoLAorCQkJCWludCBzcmNfeHJlcywgaW50IHNyY195cmVzLAorCQkJCWludCBkc3Rf
eHJlcywgaW50IGRzdF95cmVzLAorCQkJCXUzMiBwaXhfZm9ybWF0LCBlbnVtIGJ1ZmZlcl9mb3Jt
YXQgZHN0X2Zvcm1hdCkKK3sKKwl1MzIgbHNyY194cmVzLCBsc3JjX3lyZXMsIGNzcmNfeHJlcywg
Y3NyY195cmVzOworCXUzMiBsZHN0X3hyZXMsIGxkc3RfeXJlcywgY2RzdF94cmVzLCBjZHN0X3ly
ZXM7CisJYm9vbCBzcmNfaXNfNDQ0ID0gdHJ1ZTsKKworCWxzcmNfeHJlcyA9IHNyY194cmVzOwor
CWNzcmNfeHJlcyA9IHNyY194cmVzOworCWxzcmNfeXJlcyA9IHNyY195cmVzOworCWNzcmNfeXJl
cyA9IHNyY195cmVzOworCWxkc3RfeHJlcyA9IGRzdF94cmVzOworCWNkc3RfeHJlcyA9IGRzdF94
cmVzOworCWxkc3RfeXJlcyA9IGRzdF95cmVzOworCWNkc3RfeXJlcyA9IGRzdF95cmVzOworCisJ
aWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9VWVZZIHx8IHBpeF9mb3JtYXQgPT0gRFJNX0ZP
Uk1BVF9WWVVZIHx8CisJICAgIHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9ZVVlWIHx8IHBpeF9m
b3JtYXQgPT0gRFJNX0ZPUk1BVF9ZVllVKSB7CisJCWNzcmNfeHJlcyA+Pj0gMTsKKwkJc3JjX2lz
XzQ0NCA9IGZhbHNlOworCX0gZWxzZSBpZiAocGl4X2Zvcm1hdCA9PSBEUk1fRk9STUFUX05WMTIg
fHwKKwkJICAgcGl4X2Zvcm1hdCA9PSBEUk1fRk9STUFUX05WMjEpIHsKKwkJY3NyY194cmVzID4+
PSAxOworCQljc3JjX3lyZXMgPj49IDE7CisJCXNyY19pc180NDQgPSBmYWxzZTsKKwl9CisKKwlp
ZiAoZHN0X2Zvcm1hdCA9PSBCVUZfRk1UX1lVVjQyMikKKwkJY2RzdF94cmVzID4+PSAxOworCisJ
LyogZm9yIDQ6NDo0IHRvIDQ6MjoyIGNvbnZlcnNpb24sIHNvdXJjZSBoZWlnaHQgc2hvdWxkIGJl
IDEgbGVzcyAqLworCWlmIChzcmNfaXNfNDQ0ICYmIGRzdF9mb3JtYXQgPT0gQlVGX0ZNVF9ZVVY0
MjIpIHsKKwkJbHNyY195cmVzLS07CisJCWNzcmNfeXJlcy0tOworCX0KKworCWRjc3Nfc2NhbGVy
X3dyaXRlKGNoLCAoKChsc3JjX3lyZXMgLSAxKSA8PCBIRUlHSFRfUE9TKSAmIEhFSUdIVF9NQVNL
KSB8CisJCQkgICAgICAgKCgobHNyY194cmVzIC0gMSkgPDwgV0lEVEhfUE9TKSAmIFdJRFRIX01B
U0spLAorCQkJICBEQ1NTX1NDQUxFUl9TUkNfTFVNX1JFUyk7CisJZGNzc19zY2FsZXJfd3JpdGUo
Y2gsICgoKGNzcmNfeXJlcyAtIDEpIDw8IEhFSUdIVF9QT1MpICYgSEVJR0hUX01BU0spIHwKKwkJ
CSAgICAgICAoKChjc3JjX3hyZXMgLSAxKSA8PCBXSURUSF9QT1MpICYgV0lEVEhfTUFTSyksCisJ
CQkgIERDU1NfU0NBTEVSX1NSQ19DSFJfUkVTKTsKKwlkY3NzX3NjYWxlcl93cml0ZShjaCwgKCgo
bGRzdF95cmVzIC0gMSkgPDwgSEVJR0hUX1BPUykgJiBIRUlHSFRfTUFTSykgfAorCQkJICAgICAg
ICgoKGxkc3RfeHJlcyAtIDEpIDw8IFdJRFRIX1BPUykgJiBXSURUSF9NQVNLKSwKKwkJCSAgRENT
U19TQ0FMRVJfRFNUX0xVTV9SRVMpOworCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKChjZHN0X3ly
ZXMgLSAxKSA8PCBIRUlHSFRfUE9TKSAmIEhFSUdIVF9NQVNLKSB8CisJCQkgICAgICAgKCgoY2Rz
dF94cmVzIC0gMSkgPDwgV0lEVEhfUE9TKSAmIFdJRFRIX01BU0spLAorCQkJICBEQ1NTX1NDQUxF
Ul9EU1RfQ0hSX1JFUyk7Cit9CisKKyNkZWZpbmUgbWF4X2Rvd25zY2FsZShyYXRpbykJCSgocmF0
aW8pIDw8IDE2KQorI2RlZmluZSBtYXhfdXBzY2FsZShyYXRpbykJCSgoMSA8PCAxNikgLyAocmF0
aW8pKQorCitzdHJ1Y3QgZGNzc19zY2FsZXJfcmF0aW9zIHsKKwlpbnQgZG93bnNjYWxlOworCWlu
dCB1cHNjYWxlOworfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkY3NzX3NjYWxlcl9yYXRpb3Mg
ZGNzc19zY2FsZXJfcmF0aW9zW10gPSB7CisJe21heF9kb3duc2NhbGUoMyksIG1heF91cHNjYWxl
KDgpfSwKKwl7bWF4X2Rvd25zY2FsZSg1KSwgbWF4X3Vwc2NhbGUoOCl9LAorCXttYXhfZG93bnNj
YWxlKDUpLCBtYXhfdXBzY2FsZSg4KX0sCit9OworCitzdGF0aWMgdm9pZCBkY3NzX3NjYWxlcl9m
cmFjdGlvbnNfc2V0KHN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2gsCisJCQkJICAgICAgaW50IHNy
Y194cmVzLCBpbnQgc3JjX3lyZXMsCisJCQkJICAgICAgaW50IGRzdF94cmVzLCBpbnQgZHN0X3ly
ZXMsCisJCQkJICAgICAgdTMyIHNyY19mb3JtYXQsIHUzMiBkc3RfZm9ybWF0LAorCQkJCSAgICAg
IGVudW0gY2hyb21hX2xvY2F0aW9uIHNyY19jaHJvbWFfbG9jKQoreworCWludCBzcmNfY194cmVz
LCBzcmNfY195cmVzLCBkc3RfY194cmVzLCBkc3RfY195cmVzOworCXUzMiBsX3ZpbmMsIGxfaGlu
YywgY192aW5jLCBjX2hpbmM7CisJdTMyIGNfdnN0YXJ0LCBjX2hzdGFydDsKKworCXNyY19jX3hy
ZXMgPSBzcmNfeHJlczsKKwlzcmNfY195cmVzID0gc3JjX3lyZXM7CisJZHN0X2NfeHJlcyA9IGRz
dF94cmVzOworCWRzdF9jX3lyZXMgPSBkc3RfeXJlczsKKworCWNfdnN0YXJ0ID0gMDsKKwljX2hz
dGFydCA9IDA7CisKKwkvKiBhZGp1c3RtZW50cyBmb3Igc291cmNlIGNocm9tYSBsb2NhdGlvbiAq
LworCWlmIChzcmNfZm9ybWF0ID09IEJVRl9GTVRfWVVWNDIwKSB7CisJCS8qIHZlcnRpY2FsIGlu
cHV0IGNocm9tYSBwb3NpdGlvbiBhZGp1c3RtZW50ICovCisJCXN3aXRjaCAoc3JjX2Nocm9tYV9s
b2MpIHsKKwkJY2FzZSBQU0NfTE9DX0hPUlpfMF9WRVJUXzFfT1ZFUl80OgorCQljYXNlIFBTQ19M
T0NfSE9SWl8xX09WRVJfNF9WRVJUXzFfT1ZFUl80OgorCQkJLyoKKwkJCSAqIG1vdmUgY2hyb21h
IHVwIHRvIGZpcnN0IGx1bWEgbGluZQorCQkJICogKDEvNCBjaHJvbWEgaW5wdXQgbGluZSBzcGFj
aW5nKQorCQkJICovCisJCQljX3ZzdGFydCAtPSAoMSA8PCAoUFNDX1BIQVNFX0ZSQUNUSU9OX0JJ
VFMgLSAyKSk7CisJCQlicmVhazsKKwkJY2FzZSBQU0NfTE9DX0hPUlpfMF9WRVJUXzFfT1ZFUl8y
OgorCQljYXNlIFBTQ19MT0NfSE9SWl8xX09WRVJfNF9WRVJUXzFfT1ZFUl8yOgorCQkJLyoKKwkJ
CSAqIG1vdmUgY2hyb21hIHVwIHRvIGZpcnN0IGx1bWEgbGluZQorCQkJICogKDEvMiBjaHJvbWEg
aW5wdXQgbGluZSBzcGFjaW5nKQorCQkJICovCisJCQljX3ZzdGFydCAtPSAoMSA8PCAoUFNDX1BI
QVNFX0ZSQUNUSU9OX0JJVFMgLSAxKSk7CisJCQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCWJyZWFr
OworCQl9CisJCS8qIGhvcml6b250YWwgaW5wdXQgY2hyb21hIHBvc2l0aW9uIGFkanVzdG1lbnQg
Ki8KKwkJc3dpdGNoIChzcmNfY2hyb21hX2xvYykgeworCQljYXNlIFBTQ19MT0NfSE9SWl8xX09W
RVJfNF9WRVJUXzFfT1ZFUl80OgorCQljYXNlIFBTQ19MT0NfSE9SWl8xX09WRVJfNF9WRVJUXzA6
CisJCWNhc2UgUFNDX0xPQ19IT1JaXzFfT1ZFUl80X1ZFUlRfMV9PVkVSXzI6CisJCQkvKiBtb3Zl
IGNocm9tYSBsZWZ0IDEvNCBjaHJvbWEgaW5wdXQgc2FtcGxlIHNwYWNpbmcgKi8KKwkJCWNfaHN0
YXJ0IC09ICgxIDw8IChQU0NfUEhBU0VfRlJBQ1RJT05fQklUUyAtIDIpKTsKKwkJCWJyZWFrOwor
CQlkZWZhdWx0OgorCQkJYnJlYWs7CisJCX0KKwl9CisKKwkvKiBhZGp1c3RtZW50cyB0byBjaHJv
bWEgcmVzb2x1dGlvbiAqLworCWlmIChzcmNfZm9ybWF0ID09IEJVRl9GTVRfWVVWNDIwKSB7CisJ
CXNyY19jX3hyZXMgPj49IDE7CisJCXNyY19jX3lyZXMgPj49IDE7CisJfSBlbHNlIGlmIChzcmNf
Zm9ybWF0ID09IEJVRl9GTVRfWVVWNDIyKSB7CisJCXNyY19jX3hyZXMgPj49IDE7CisJfQorCisJ
aWYgKGRzdF9mb3JtYXQgPT0gQlVGX0ZNVF9ZVVY0MjIpCisJCWRzdF9jX3hyZXMgPj49IDE7CisK
KwlsX3ZpbmMgPSAoKHNyY195cmVzIDw8IDEzKSArIChkc3RfeXJlcyA+PiAxKSkgLyBkc3RfeXJl
czsKKwljX3ZpbmMgPSAoKHNyY19jX3lyZXMgPDwgMTMpICsgKGRzdF9jX3lyZXMgPj4gMSkpIC8g
ZHN0X2NfeXJlczsKKwlsX2hpbmMgPSAoKHNyY194cmVzIDw8IDEzKSArIChkc3RfeHJlcyA+PiAx
KSkgLyBkc3RfeHJlczsKKwljX2hpbmMgPSAoKHNyY19jX3hyZXMgPDwgMTMpICsgKGRzdF9jX3hy
ZXMgPj4gMSkpIC8gZHN0X2NfeHJlczsKKworCS8qIHNhdmUgY2hyb21hIHN0YXJ0IHBoYXNlICov
CisJY2gtPmNfdnN0YXJ0ID0gY192c3RhcnQ7CisJY2gtPmNfaHN0YXJ0ID0gY19oc3RhcnQ7CisK
KwlkY3NzX3NjYWxlcl93cml0ZShjaCwgMCwgRENTU19TQ0FMRVJfVl9MVU1fU1RBUlQpOworCWRj
c3Nfc2NhbGVyX3dyaXRlKGNoLCBsX3ZpbmMsIERDU1NfU0NBTEVSX1ZfTFVNX0lOQyk7CisKKwlk
Y3NzX3NjYWxlcl93cml0ZShjaCwgMCwgRENTU19TQ0FMRVJfSF9MVU1fU1RBUlQpOworCWRjc3Nf
c2NhbGVyX3dyaXRlKGNoLCBsX2hpbmMsIERDU1NfU0NBTEVSX0hfTFVNX0lOQyk7CisKKwlkY3Nz
X3NjYWxlcl93cml0ZShjaCwgY192c3RhcnQsIERDU1NfU0NBTEVSX1ZfQ0hSX1NUQVJUKTsKKwlk
Y3NzX3NjYWxlcl93cml0ZShjaCwgY192aW5jLCBEQ1NTX1NDQUxFUl9WX0NIUl9JTkMpOworCisJ
ZGNzc19zY2FsZXJfd3JpdGUoY2gsIGNfaHN0YXJ0LCBEQ1NTX1NDQUxFUl9IX0NIUl9TVEFSVCk7
CisJZGNzc19zY2FsZXJfd3JpdGUoY2gsIGNfaGluYywgRENTU19TQ0FMRVJfSF9DSFJfSU5DKTsK
K30KKworaW50IGRjc3Nfc2NhbGVyX2dldF9taW5fbWF4X3JhdGlvcyhzdHJ1Y3QgZGNzc19zY2Fs
ZXIgKnNjbCwgaW50IGNoX251bSwKKwkJCQkgICBpbnQgKm1pbiwgaW50ICptYXgpCit7CisJKm1p
biA9IGRjc3Nfc2NhbGVyX3JhdGlvc1tjaF9udW1dLnVwc2NhbGU7CisJKm1heCA9IGRjc3Nfc2Nh
bGVyX3JhdGlvc1tjaF9udW1dLmRvd25zY2FsZTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
dm9pZCBkY3NzX3NjYWxlcl9wcm9ncmFtXzVfY29lZl9zZXQoc3RydWN0IGRjc3Nfc2NhbGVyX2No
ICpjaCwKKwkJCQkJICAgaW50IGJhc2VfYWRkciwKKwkJCQkJICAgaW50IGNvZWZbXVtQU0NfTlVN
X1RBUFNdKQoreworCWludCBpLCBwaGFzZTsKKworCWZvciAoaSA9IDA7IGkgPCBQU0NfU1RPUkVE
X1BIQVNFUzsgaSsrKSB7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNvZWZbaV1bMV0gJiAw
eGZmZikgPDwgMTYgfAorCQkJCSAgICAgICAoY29lZltpXVsyXSAmIDB4ZmZmKSA8PCA0ICB8CisJ
CQkJICAgICAgIChjb2VmW2ldWzNdICYgMHhmMDApID4+IDgpLAorCQkJCSAgYmFzZV9hZGRyICsg
aSAqIHNpemVvZih1MzIpKTsKKwkJZGNzc19zY2FsZXJfd3JpdGUoY2gsICgoY29lZltpXVszXSAm
IDB4MGZmKSA8PCAyMCB8CisJCQkJICAgICAgIChjb2VmW2ldWzRdICYgMHhmZmYpIDw8IDggIHwK
KwkJCQkgICAgICAgKGNvZWZbaV1bNV0gJiAweGZmMCkgPj4gNCksCisJCQkJICBiYXNlX2FkZHIg
KyAweDQwICsgaSAqIHNpemVvZih1MzIpKTsKKwkJZGNzc19zY2FsZXJfd3JpdGUoY2gsICgoY29l
ZltpXVs1XSAmIDB4MDBmKSA8PCAyNCksCisJCQkJICBiYXNlX2FkZHIgKyAweDgwICsgaSAqIHNp
emVvZih1MzIpKTsKKwl9CisKKwkvKiByZXZlcnNlIGJvdGggcGhhc2UgYW5kIHRhcCBvcmRlcmlu
Z3MgKi8KKwlmb3IgKHBoYXNlID0gKFBTQ19OVU1fUEhBU0VTID4+IDEpIC0gMTsKKwkJCWkgPCBQ
U0NfTlVNX1BIQVNFUzsgaSsrLCBwaGFzZS0tKSB7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAo
KGNvZWZbcGhhc2VdWzVdICYgMHhmZmYpIDw8IDE2IHwKKwkJCQkgICAgICAgKGNvZWZbcGhhc2Vd
WzRdICYgMHhmZmYpIDw8IDQgIHwKKwkJCQkgICAgICAgKGNvZWZbcGhhc2VdWzNdICYgMHhmMDAp
ID4+IDgpLAorCQkJCSAgYmFzZV9hZGRyICsgaSAqIHNpemVvZih1MzIpKTsKKwkJZGNzc19zY2Fs
ZXJfd3JpdGUoY2gsICgoY29lZltwaGFzZV1bM10gJiAweDBmZikgPDwgMjAgfAorCQkJCSAgICAg
ICAoY29lZltwaGFzZV1bMl0gJiAweGZmZikgPDwgOCAgfAorCQkJCSAgICAgICAoY29lZltwaGFz
ZV1bMV0gJiAweGZmMCkgPj4gNCksCisJCQkJICBiYXNlX2FkZHIgKyAweDQwICsgaSAqIHNpemVv
Zih1MzIpKTsKKwkJZGNzc19zY2FsZXJfd3JpdGUoY2gsICgoY29lZltwaGFzZV1bMV0gJiAweDAw
ZikgPDwgMjQpLAorCQkJCSAgYmFzZV9hZGRyICsgMHg4MCArIGkgKiBzaXplb2YodTMyKSk7CisJ
fQorfQorCitzdGF0aWMgdm9pZCBkY3NzX3NjYWxlcl9wcm9ncmFtXzdfY29lZl9zZXQoc3RydWN0
IGRjc3Nfc2NhbGVyX2NoICpjaCwKKwkJCQkJICAgaW50IGJhc2VfYWRkciwKKwkJCQkJICAgaW50
IGNvZWZbXVtQU0NfTlVNX1RBUFNdKQoreworCWludCBpLCBwaGFzZTsKKworCWZvciAoaSA9IDA7
IGkgPCBQU0NfU1RPUkVEX1BIQVNFUzsgaSsrKSB7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAo
KGNvZWZbaV1bMF0gJiAweGZmZikgPDwgMTYgfAorCQkJCSAgICAgICAoY29lZltpXVsxXSAmIDB4
ZmZmKSA8PCA0ICB8CisJCQkJICAgICAgIChjb2VmW2ldWzJdICYgMHhmMDApID4+IDgpLAorCQkJ
CSAgYmFzZV9hZGRyICsgaSAqIHNpemVvZih1MzIpKTsKKwkJZGNzc19zY2FsZXJfd3JpdGUoY2gs
ICgoY29lZltpXVsyXSAmIDB4MGZmKSA8PCAyMCB8CisJCQkJICAgICAgIChjb2VmW2ldWzNdICYg
MHhmZmYpIDw8IDggIHwKKwkJCQkgICAgICAgKGNvZWZbaV1bNF0gJiAweGZmMCkgPj4gNCksCisJ
CQkJICBiYXNlX2FkZHIgKyAweDQwICsgaSAqIHNpemVvZih1MzIpKTsKKwkJZGNzc19zY2FsZXJf
d3JpdGUoY2gsICgoY29lZltpXVs0XSAmIDB4MDBmKSA8PCAyNCB8CisJCQkJICAgICAgIChjb2Vm
W2ldWzVdICYgMHhmZmYpIDw8IDEyIHwKKwkJCQkgICAgICAgKGNvZWZbaV1bNl0gJiAweGZmZikp
LAorCQkJCSAgYmFzZV9hZGRyICsgMHg4MCArIGkgKiBzaXplb2YodTMyKSk7CisJfQorCisJLyog
cmV2ZXJzZSBib3RoIHBoYXNlIGFuZCB0YXAgb3JkZXJpbmdzICovCisJZm9yIChwaGFzZSA9IChQ
U0NfTlVNX1BIQVNFUyA+PiAxKSAtIDE7CisJCQlpIDwgUFNDX05VTV9QSEFTRVM7IGkrKywgcGhh
c2UtLSkgeworCQlkY3NzX3NjYWxlcl93cml0ZShjaCwgKChjb2VmW3BoYXNlXVs2XSAmIDB4ZmZm
KSA8PCAxNiB8CisJCQkJICAgICAgIChjb2VmW3BoYXNlXVs1XSAmIDB4ZmZmKSA8PCA0ICB8CisJ
CQkJICAgICAgIChjb2VmW3BoYXNlXVs0XSAmIDB4ZjAwKSA+PiA4KSwKKwkJCQkgIGJhc2VfYWRk
ciArIGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVyX3dyaXRlKGNoLCAoKGNvZWZbcGhh
c2VdWzRdICYgMHgwZmYpIDw8IDIwIHwKKwkJCQkgICAgICAgKGNvZWZbcGhhc2VdWzNdICYgMHhm
ZmYpIDw8IDggIHwKKwkJCQkgICAgICAgKGNvZWZbcGhhc2VdWzJdICYgMHhmZjApID4+IDQpLAor
CQkJCSAgYmFzZV9hZGRyICsgMHg0MCArIGkgKiBzaXplb2YodTMyKSk7CisJCWRjc3Nfc2NhbGVy
X3dyaXRlKGNoLCAoKGNvZWZbcGhhc2VdWzJdICYgMHgwMGYpIDw8IDI0IHwKKwkJCQkgICAgICAg
KGNvZWZbcGhhc2VdWzFdICYgMHhmZmYpIDw8IDEyIHwKKwkJCQkgICAgICAgKGNvZWZbcGhhc2Vd
WzBdICYgMHhmZmYpKSwKKwkJCQkgIGJhc2VfYWRkciArIDB4ODAgKyBpICogc2l6ZW9mKHUzMikp
OworCX0KK30KKworc3RhdGljIHZvaWQgZGNzc19zY2FsZXJfeXV2X2NvZWZfc2V0KHN0cnVjdCBk
Y3NzX3NjYWxlcl9jaCAqY2gsCisJCQkJICAgICBlbnVtIGJ1ZmZlcl9mb3JtYXQgc3JjX2Zvcm1h
dCwKKwkJCQkgICAgIGVudW0gYnVmZmVyX2Zvcm1hdCBkc3RfZm9ybWF0LAorCQkJCSAgICAgYm9v
bCB1c2VfNV90YXBzLAorCQkJCSAgICAgaW50IHNyY194cmVzLCBpbnQgc3JjX3lyZXMsIGludCBk
c3RfeHJlcywKKwkJCQkgICAgIGludCBkc3RfeXJlcykKK3sKKwlpbnQgY29lZltQU0NfU1RPUkVE
X1BIQVNFU11bUFNDX05VTV9UQVBTXTsKKwlib29sIHByb2dyYW1fNV90YXBzID0gdXNlXzVfdGFw
cyB8fAorCQkJICAgICAgKGRzdF9mb3JtYXQgPT0gQlVGX0ZNVF9ZVVY0MjIgJiYKKwkJCSAgICAg
ICBzcmNfZm9ybWF0ID09IEJVRl9GTVRfQVJHQjg4ODhfWVVWNDQ0KTsKKworCS8qIGhvcml6b250
YWwgbHVtYSAqLworCWRjc3Nfc2NhbGVyX2ZpbHRlcl9kZXNpZ24oc3JjX3hyZXMsIGRzdF94cmVz
LCBmYWxzZSwKKwkJCQkgIHNyY194cmVzID09IGRzdF94cmVzLCBjb2VmKTsKKwlkY3NzX3NjYWxl
cl9wcm9ncmFtXzdfY29lZl9zZXQoY2gsIERDU1NfU0NBTEVSX0NPRUZfSExVTSwgY29lZik7CisK
KwkvKiB2ZXJ0aWNhbCBsdW1hICovCisJZGNzc19zY2FsZXJfZmlsdGVyX2Rlc2lnbihzcmNfeXJl
cywgZHN0X3lyZXMsIHByb2dyYW1fNV90YXBzLAorCQkJCSAgc3JjX3lyZXMgPT0gZHN0X3lyZXMs
IGNvZWYpOworCisJaWYgKHByb2dyYW1fNV90YXBzKQorCQlkY3NzX3NjYWxlcl9wcm9ncmFtXzVf
Y29lZl9zZXQoY2gsIERDU1NfU0NBTEVSX0NPRUZfVkxVTSwgY29lZik7CisJZWxzZQorCQlkY3Nz
X3NjYWxlcl9wcm9ncmFtXzdfY29lZl9zZXQoY2gsIERDU1NfU0NBTEVSX0NPRUZfVkxVTSwgY29l
Zik7CisKKwkvKiBhZGp1c3QgY2hyb21hIHJlc29sdXRpb24gKi8KKwlpZiAoc3JjX2Zvcm1hdCAh
PSBCVUZfRk1UX0FSR0I4ODg4X1lVVjQ0NCkKKwkJc3JjX3hyZXMgPj49IDE7CisJaWYgKHNyY19m
b3JtYXQgPT0gQlVGX0ZNVF9ZVVY0MjApCisJCXNyY195cmVzID4+PSAxOworCWlmIChkc3RfZm9y
bWF0ICE9IEJVRl9GTVRfQVJHQjg4ODhfWVVWNDQ0KQorCQlkc3RfeHJlcyA+Pj0gMTsKKwlpZiAo
ZHN0X2Zvcm1hdCA9PSBCVUZfRk1UX1lVVjQyMCkgLyogc2hvdWxkIG5vdCBoYXBwZW4gKi8KKwkJ
ZHN0X3lyZXMgPj49IDE7CisKKwkvKiBob3Jpem9udGFsIGNocm9tYSAqLworCWRjc3Nfc2NhbGVy
X2ZpbHRlcl9kZXNpZ24oc3JjX3hyZXMsIGRzdF94cmVzLCBmYWxzZSwKKwkJCQkgIChzcmNfeHJl
cyA9PSBkc3RfeHJlcykgJiYgKGNoLT5jX2hzdGFydCA9PSAwKSwKKwkJCQkgIGNvZWYpOworCisJ
ZGNzc19zY2FsZXJfcHJvZ3JhbV83X2NvZWZfc2V0KGNoLCBEQ1NTX1NDQUxFUl9DT0VGX0hDSFIs
IGNvZWYpOworCisJLyogdmVydGljYWwgY2hyb21hICovCisJZGNzc19zY2FsZXJfZmlsdGVyX2Rl
c2lnbihzcmNfeXJlcywgZHN0X3lyZXMsIHByb2dyYW1fNV90YXBzLAorCQkJCSAgKHNyY195cmVz
ID09IGRzdF95cmVzKSAmJiAoY2gtPmNfdnN0YXJ0ID09IDApLAorCQkJCSAgY29lZik7CisJaWYg
KHByb2dyYW1fNV90YXBzKQorCQlkY3NzX3NjYWxlcl9wcm9ncmFtXzVfY29lZl9zZXQoY2gsIERD
U1NfU0NBTEVSX0NPRUZfVkNIUiwgY29lZik7CisJZWxzZQorCQlkY3NzX3NjYWxlcl9wcm9ncmFt
XzdfY29lZl9zZXQoY2gsIERDU1NfU0NBTEVSX0NPRUZfVkNIUiwgY29lZik7Cit9CisKK3N0YXRp
YyB2b2lkIGRjc3Nfc2NhbGVyX3JnYl9jb2VmX3NldChzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNo
LAorCQkJCSAgICAgaW50IHNyY194cmVzLCBpbnQgc3JjX3lyZXMsIGludCBkc3RfeHJlcywKKwkJ
CQkgICAgIGludCBkc3RfeXJlcykKK3sKKwlpbnQgY29lZltQU0NfU1RPUkVEX1BIQVNFU11bUFND
X05VTV9UQVBTXTsKKworCS8qIGhvcml6b250YWwgUkdCICovCisJZGNzc19zY2FsZXJfZmlsdGVy
X2Rlc2lnbihzcmNfeHJlcywgZHN0X3hyZXMsIGZhbHNlLAorCQkJCSAgc3JjX3hyZXMgPT0gZHN0
X3hyZXMsIGNvZWYpOworCWRjc3Nfc2NhbGVyX3Byb2dyYW1fN19jb2VmX3NldChjaCwgRENTU19T
Q0FMRVJfQ09FRl9ITFVNLCBjb2VmKTsKKworCS8qIHZlcnRpY2FsIFJHQiAqLworCWRjc3Nfc2Nh
bGVyX2ZpbHRlcl9kZXNpZ24oc3JjX3lyZXMsIGRzdF95cmVzLCBmYWxzZSwKKwkJCQkgIHNyY195
cmVzID09IGRzdF95cmVzLCBjb2VmKTsKKwlkY3NzX3NjYWxlcl9wcm9ncmFtXzdfY29lZl9zZXQo
Y2gsIERDU1NfU0NBTEVSX0NPRUZfVkxVTSwgY29lZik7Cit9CisKK3N0YXRpYyB2b2lkIGRjc3Nf
c2NhbGVyX3NldF9yZ2IxMF9vcmRlcihzdHJ1Y3QgZGNzc19zY2FsZXJfY2ggKmNoLAorCQkJCQlj
b25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQpCit7CisJdTMyIGEycjEwZzEwYjEw
X2Zvcm1hdDsKKworCWlmIChmb3JtYXQtPmlzX3l1dikKKwkJcmV0dXJuOworCisJY2gtPnNkYXRh
X2N0cmwgJj0gfkEyUjEwRzEwQjEwX0ZPUk1BVF9NQVNLOworCisJaWYgKGZvcm1hdC0+ZGVwdGgg
IT0gMzApCisJCXJldHVybjsKKworCXN3aXRjaCAoZm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERS
TV9GT1JNQVRfQVJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgorCQlh
MnIxMGcxMGIxMF9mb3JtYXQgPSAwOworCQlicmVhazsKKworCWNhc2UgRFJNX0ZPUk1BVF9BQkdS
MjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJCWEycjEwZzEwYjEwX2Zv
cm1hdCA9IDU7CisJCWJyZWFrOworCisJY2FzZSBEUk1fRk9STUFUX1JHQkExMDEwMTAyOgorCWNh
c2UgRFJNX0ZPUk1BVF9SR0JYMTAxMDEwMjoKKwkJYTJyMTBnMTBiMTBfZm9ybWF0ID0gNjsKKwkJ
YnJlYWs7CisKKwljYXNlIERSTV9GT1JNQVRfQkdSQTEwMTAxMDI6CisJY2FzZSBEUk1fRk9STUFU
X0JHUlgxMDEwMTAyOgorCQlhMnIxMGcxMGIxMF9mb3JtYXQgPSAxMTsKKwkJYnJlYWs7CisKKwlk
ZWZhdWx0OgorCQlhMnIxMGcxMGIxMF9mb3JtYXQgPSAwOworCQlicmVhazsKKwl9CisKKwljaC0+
c2RhdGFfY3RybCB8PSBhMnIxMGcxMGIxMF9mb3JtYXQgPDwgQTJSMTBHMTBCMTBfRk9STUFUX1BP
UzsKK30KKwordm9pZCBkY3NzX3NjYWxlcl9zZXR1cChzdHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCwg
aW50IGNoX251bSwKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKmZvcm1h
dCwKKwkJICAgICAgIGludCBzcmNfeHJlcywgaW50IHNyY195cmVzLCBpbnQgZHN0X3hyZXMsIGlu
dCBkc3RfeXJlcywKKwkJICAgICAgIHUzMiB2cmVmcmVzaF9oeikKK3sKKwlzdHJ1Y3QgZGNzc19z
Y2FsZXJfY2ggKmNoID0gJnNjbC0+Y2hbY2hfbnVtXTsKKwl1bnNpZ25lZCBpbnQgcGl4ZWxfZGVw
dGggPSAwOworCWJvb2wgcnRyXzhsaW5lX2VuID0gZmFsc2U7CisJYm9vbCB1c2VfNV90YXBzID0g
ZmFsc2U7CisJZW51bSBidWZmZXJfZm9ybWF0IHNyY19mb3JtYXQgPSBCVUZfRk1UX0FSR0I4ODg4
X1lVVjQ0NDsKKwllbnVtIGJ1ZmZlcl9mb3JtYXQgZHN0X2Zvcm1hdCA9IEJVRl9GTVRfQVJHQjg4
ODhfWVVWNDQ0OworCXUzMiBwaXhfZm9ybWF0ID0gZm9ybWF0LT5mb3JtYXQ7CisKKwlpZiAoZm9y
bWF0LT5pc195dXYpIHsKKwkJZGNzc19zY2FsZXJfeXV2X2VuYWJsZShjaCwgdHJ1ZSk7CisKKwkJ
aWYgKHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9OVjEyIHx8CisJCSAgICBwaXhfZm9ybWF0ID09
IERSTV9GT1JNQVRfTlYyMSkgeworCQkJcnRyXzhsaW5lX2VuID0gdHJ1ZTsKKwkJCXNyY19mb3Jt
YXQgPSBCVUZfRk1UX1lVVjQyMDsKKwkJfSBlbHNlIGlmIChwaXhfZm9ybWF0ID09IERSTV9GT1JN
QVRfVVlWWSB8fAorCQkJICAgcGl4X2Zvcm1hdCA9PSBEUk1fRk9STUFUX1ZZVVkgfHwKKwkJCSAg
IHBpeF9mb3JtYXQgPT0gRFJNX0ZPUk1BVF9ZVVlWIHx8CisJCQkgICBwaXhfZm9ybWF0ID09IERS
TV9GT1JNQVRfWVZZVSkgeworCQkJc3JjX2Zvcm1hdCA9IEJVRl9GTVRfWVVWNDIyOworCQl9CisK
KwkJdXNlXzVfdGFwcyA9ICFydHJfOGxpbmVfZW47CisJfSBlbHNlIHsKKwkJZGNzc19zY2FsZXJf
eXV2X2VuYWJsZShjaCwgZmFsc2UpOworCisJCXBpeGVsX2RlcHRoID0gZm9ybWF0LT5kZXB0aDsK
Kwl9CisKKwlkY3NzX3NjYWxlcl9mcmFjdGlvbnNfc2V0KGNoLCBzcmNfeHJlcywgc3JjX3lyZXMs
IGRzdF94cmVzLAorCQkJCSAgZHN0X3lyZXMsIHNyY19mb3JtYXQsIGRzdF9mb3JtYXQsCisJCQkJ
ICBQU0NfTE9DX0hPUlpfMF9WRVJUXzFfT1ZFUl80KTsKKworCWlmIChmb3JtYXQtPmlzX3l1dikK
KwkJZGNzc19zY2FsZXJfeXV2X2NvZWZfc2V0KGNoLCBzcmNfZm9ybWF0LCBkc3RfZm9ybWF0LAor
CQkJCQkgdXNlXzVfdGFwcywgc3JjX3hyZXMsIHNyY195cmVzLAorCQkJCQkgZHN0X3hyZXMsIGRz
dF95cmVzKTsKKwllbHNlCisJCWRjc3Nfc2NhbGVyX3JnYl9jb2VmX3NldChjaCwgc3JjX3hyZXMs
IHNyY195cmVzLAorCQkJCQkgZHN0X3hyZXMsIGRzdF95cmVzKTsKKworCWRjc3Nfc2NhbGVyX3J0
cl84bGluZXNfZW5hYmxlKGNoLCBydHJfOGxpbmVfZW4pOworCWRjc3Nfc2NhbGVyX2JpdF9kZXB0
aF9zZXQoY2gsIHBpeGVsX2RlcHRoKTsKKwlkY3NzX3NjYWxlcl9zZXRfcmdiMTBfb3JkZXIoY2gs
IGZvcm1hdCk7CisJZGNzc19zY2FsZXJfZm9ybWF0X3NldChjaCwgc3JjX2Zvcm1hdCwgZHN0X2Zv
cm1hdCk7CisJZGNzc19zY2FsZXJfcmVzX3NldChjaCwgc3JjX3hyZXMsIHNyY195cmVzLCBkc3Rf
eHJlcywgZHN0X3lyZXMsCisJCQkgICAgcGl4X2Zvcm1hdCwgZHN0X2Zvcm1hdCk7Cit9CisKKy8q
IFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgZnJvbSBpbnRlcnJ1cHQgY29udGV4dC4gKi8K
K3ZvaWQgZGNzc19zY2FsZXJfd3JpdGVfc2NsY3RybChzdHJ1Y3QgZGNzc19zY2FsZXIgKnNjbCkK
K3sKKwlpbnQgY2hudW07CisKKwlmb3IgKGNobnVtID0gMDsgY2hudW0gPCAzOyBjaG51bSsrKSB7
CisJCXN0cnVjdCBkY3NzX3NjYWxlcl9jaCAqY2ggPSAmc2NsLT5jaFtjaG51bV07CisKKwkJaWYg
KGNoLT5zY2FsZXJfY3RybF9jaGdkKSB7CisJCQlkY3NzX2N0eGxkX3dyaXRlX2lycXNhZmUoc2Ns
LT5jdHhsZCwgc2NsLT5jdHhfaWQsCisJCQkJCQkgY2gtPnNjYWxlcl9jdHJsLAorCQkJCQkJIGNo
LT5iYXNlX29mcyArCisJCQkJCQkgRENTU19TQ0FMRVJfQ1RSTCk7CisJCQljaC0+c2NhbGVyX2N0
cmxfY2hnZCA9IGZhbHNlOworCQl9CisJfQorfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2lteC9kY3NzL2Rjc3Mtc3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pbXgvZGNzcy9kY3NzLXNzLmMK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAuLjY1YTA1YzIKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaW14L2Rjc3MvZGNzcy1zcy5jCkBAIC0wLDAgKzEsMTc5
IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIENvcHlyaWdo
dCAyMDE5IE5YUC4KKyAqLworCisjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CisKKyNpbmNsdWRl
ICJkY3NzLWRldi5oIgorCisjZGVmaW5lIERDU1NfU1NfU1lTX0NUUkwJCQkweDAwCisjZGVmaW5l
ICAgUlVOX0VOCQkJCUJJVCgwKQorI2RlZmluZSBEQ1NTX1NTX0RJU1BMQVkJCQkJMHgxMAorI2Rl
ZmluZSAgIExSQ19YX1BPUwkJCQkwCisjZGVmaW5lICAgTFJDX1hfTUFTSwkJCQlHRU5NQVNLKDEy
LCAwKQorI2RlZmluZSAgIExSQ19ZX1BPUwkJCQkxNgorI2RlZmluZSAgIExSQ19ZX01BU0sJCQkJ
R0VOTUFTSygyOCwgMTYpCisjZGVmaW5lIERDU1NfU1NfSFNZTkMJCQkJMHgyMAorI2RlZmluZSBE
Q1NTX1NTX1ZTWU5DCQkJCTB4MzAKKyNkZWZpbmUgICBTWU5DX1NUQVJUX1BPUwkJCTAKKyNkZWZp
bmUgICBTWU5DX1NUQVJUX01BU0sJCQlHRU5NQVNLKDEyLCAwKQorI2RlZmluZSAgIFNZTkNfRU5E
X1BPUwkJCQkxNgorI2RlZmluZSAgIFNZTkNfRU5EX01BU0sJCQkJR0VOTUFTSygyOCwgMTYpCisj
ZGVmaW5lICAgU1lOQ19QT0wJCQkJQklUKDMxKQorI2RlZmluZSBEQ1NTX1NTX0RFX1VMQwkJCQkw
eDQwCisjZGVmaW5lICAgVUxDX1hfUE9TCQkJCTAKKyNkZWZpbmUgICBVTENfWF9NQVNLCQkJCUdF
Tk1BU0soMTIsIDApCisjZGVmaW5lICAgVUxDX1lfUE9TCQkJCTE2CisjZGVmaW5lICAgVUxDX1lf
TUFTSwkJCQlHRU5NQVNLKDI4LCAxNikKKyNkZWZpbmUgICBVTENfUE9MCQkJCUJJVCgzMSkKKyNk
ZWZpbmUgRENTU19TU19ERV9MUkMJCQkJMHg1MAorI2RlZmluZSBEQ1NTX1NTX01PREUJCQkJMHg2
MAorI2RlZmluZSAgIFBJUEVfTU9ERV9QT1MJCQkJMAorI2RlZmluZSAgIFBJUEVfTU9ERV9NQVNL
CQkJR0VOTUFTSygxLCAwKQorI2RlZmluZSBEQ1NTX1NTX0NPRUZGCQkJCTB4NzAKKyNkZWZpbmUg
ICBIT1JJWl9BX1BPUwkJCQkwCisjZGVmaW5lICAgSE9SSVpfQV9NQVNLCQkJCUdFTk1BU0soMywg
MCkKKyNkZWZpbmUgICBIT1JJWl9CX1BPUwkJCQk0CisjZGVmaW5lICAgSE9SSVpfQl9NQVNLCQkJ
CUdFTk1BU0soNywgNCkKKyNkZWZpbmUgICBIT1JJWl9DX1BPUwkJCQk4CisjZGVmaW5lICAgSE9S
SVpfQ19NQVNLCQkJCUdFTk1BU0soMTEsIDgpCisjZGVmaW5lICAgSE9SSVpfSF9OT1JNX1BPUwkJ
CTEyCisjZGVmaW5lICAgSE9SSVpfSF9OT1JNX01BU0sJCQlHRU5NQVNLKDE0LCAxMikKKyNkZWZp
bmUgICBWRVJUX0FfUE9TCQkJCTE2CisjZGVmaW5lICAgVkVSVF9BX01BU0sJCQkJR0VOTUFTSygx
OSwgMTYpCisjZGVmaW5lICAgVkVSVF9CX1BPUwkJCQkyMAorI2RlZmluZSAgIFZFUlRfQl9NQVNL
CQkJCUdFTk1BU0soMjMsIDIwKQorI2RlZmluZSAgIFZFUlRfQ19QT1MJCQkJMjQKKyNkZWZpbmUg
ICBWRVJUX0NfTUFTSwkJCQlHRU5NQVNLKDI3LCAyNCkKKyNkZWZpbmUgICBWRVJUX0hfTk9STV9Q
T1MJCQkyOAorI2RlZmluZSAgIFZFUlRfSF9OT1JNX01BU0sJCQlHRU5NQVNLKDMwLCAyOCkKKyNk
ZWZpbmUgRENTU19TU19DTElQX0NCCQkJCTB4ODAKKyNkZWZpbmUgRENTU19TU19DTElQX0NSCQkJ
CTB4OTAKKyNkZWZpbmUgICBDTElQX01JTl9QT1MJCQkJMAorI2RlZmluZSAgIENMSVBfTUlOX01B
U0sJCQkJR0VOTUFTSyg5LCAwKQorI2RlZmluZSAgIENMSVBfTUFYX1BPUwkJCQkwCisjZGVmaW5l
ICAgQ0xJUF9NQVhfTUFTSwkJCQlHRU5NQVNLKDIzLCAxNikKKyNkZWZpbmUgRENTU19TU19JTlRF
Ul9NT0RFCQkJMHhBMAorI2RlZmluZSAgIElOVF9FTgkJCQlCSVQoMCkKKyNkZWZpbmUgICBWU1lO
Q19TSElGVAkJCQlCSVQoMSkKKworc3RydWN0IGRjc3Nfc3MgeworCXN0cnVjdCBkZXZpY2UgKmRl
djsKKwl2b2lkIF9faW9tZW0gKmJhc2VfcmVnOworCXUzMiBiYXNlX29mczsKKworCXN0cnVjdCBk
Y3NzX2N0eGxkICpjdHhsZDsKKwl1MzIgY3R4X2lkOworCisJYm9vbCBpbl91c2U7Cit9OworCitz
dGF0aWMgdm9pZCBkY3NzX3NzX3dyaXRlKHN0cnVjdCBkY3NzX3NzICpzcywgdTMyIHZhbCwgdTMy
IG9mcykKK3sKKwlpZiAoIXNzLT5pbl91c2UpCisJCWRjc3Nfd3JpdGVsKHZhbCwgc3MtPmJhc2Vf
cmVnICsgb2ZzKTsKKworCWRjc3NfY3R4bGRfd3JpdGUoc3MtPmN0eGxkLCBzcy0+Y3R4X2lkLCB2
YWwsCisJCQkgc3MtPmJhc2Vfb2ZzICsgb2ZzKTsKK30KKworaW50IGRjc3Nfc3NfaW5pdChzdHJ1
Y3QgZGNzc19kZXYgKmRjc3MsIHVuc2lnbmVkIGxvbmcgc3NfYmFzZSkKK3sKKwlzdHJ1Y3QgZGNz
c19zcyAqc3M7CisKKwlzcyA9IGRldm1fa3phbGxvYyhkY3NzLT5kZXYsIHNpemVvZigqc3MpLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIXNzKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRjc3MtPnNzID0g
c3M7CisJc3MtPmRldiA9IGRjc3MtPmRldjsKKwlzcy0+Y3R4bGQgPSBkY3NzLT5jdHhsZDsKKwor
CXNzLT5iYXNlX3JlZyA9IGRldm1faW9yZW1hcChkY3NzLT5kZXYsIHNzX2Jhc2UsIFNaXzRLKTsK
KwlpZiAoIXNzLT5iYXNlX3JlZykgeworCQlkZXZfZXJyKGRjc3MtPmRldiwgInNzOiB1bmFibGUg
dG8gcmVtYXAgc3MgYmFzZVxuIik7CisJCWRldm1fa2ZyZWUoc3MtPmRldiwgc3MpOworCQlyZXR1
cm4gLUVOT01FTTsKKwl9CisKKwlzcy0+YmFzZV9vZnMgPSBzc19iYXNlOworCXNzLT5jdHhfaWQg
PSBDVFhfU0JfSFA7CisKKwlyZXR1cm4gMDsKK30KKwordm9pZCBkY3NzX3NzX2V4aXQoc3RydWN0
IGRjc3Nfc3MgKnNzKQoreworCS8qIHN0b3AgU1MgKi8KKwlkY3NzX3dyaXRlbCgwLCBzcy0+YmFz
ZV9yZWcgKyBEQ1NTX1NTX1NZU19DVFJMKTsKKworCWlmIChzcy0+YmFzZV9yZWcpCisJCWRldm1f
aW91bm1hcChzcy0+ZGV2LCBzcy0+YmFzZV9yZWcpOworCisJZGV2bV9rZnJlZShzcy0+ZGV2LCBz
cyk7Cit9CisKK3ZvaWQgZGNzc19zc19zdWJzYW1fc2V0KHN0cnVjdCBkY3NzX3NzICpzcykKK3sK
KwlkY3NzX3NzX3dyaXRlKHNzLCAweDQxNjE0MTYxLCBEQ1NTX1NTX0NPRUZGKTsKKwlkY3NzX3Nz
X3dyaXRlKHNzLCAwLCBEQ1NTX1NTX01PREUpOworCWRjc3Nfc3Nfd3JpdGUoc3MsIDB4MDNmZjAw
MDAsIERDU1NfU1NfQ0xJUF9DQik7CisJZGNzc19zc193cml0ZShzcywgMHgwM2ZmMDAwMCwgRENT
U19TU19DTElQX0NSKTsKK30KKwordm9pZCBkY3NzX3NzX3N5bmNfc2V0KHN0cnVjdCBkY3NzX3Nz
ICpzcywgc3RydWN0IHZpZGVvbW9kZSAqdm0sCisJCSAgICAgIGJvb2wgcGhzeW5jLCBib29sIHB2
c3luYykKK3sKKwl1MTYgbHJjX3gsIGxyY195OworCXUxNiBoc3luY19zdGFydCwgaHN5bmNfZW5k
OworCXUxNiB2c3luY19zdGFydCwgdnN5bmNfZW5kOworCXUxNiBkZV91bGNfeCwgZGVfdWxjX3k7
CisJdTE2IGRlX2xyY194LCBkZV9scmNfeTsKKworCWxyY194ID0gdm0tPmhmcm9udF9wb3JjaCAr
IHZtLT5oYmFja19wb3JjaCArIHZtLT5oc3luY19sZW4gKworCQl2bS0+aGFjdGl2ZSAtIDE7CisJ
bHJjX3kgPSB2bS0+dmZyb250X3BvcmNoICsgdm0tPnZiYWNrX3BvcmNoICsgdm0tPnZzeW5jX2xl
biArCisJCXZtLT52YWN0aXZlIC0gMTsKKworCWRjc3Nfc3Nfd3JpdGUoc3MsIChscmNfeSA8PCBM
UkNfWV9QT1MpIHwgbHJjX3gsIERDU1NfU1NfRElTUExBWSk7CisKKwloc3luY19zdGFydCA9IHZt
LT5oZnJvbnRfcG9yY2ggKyB2bS0+aGJhY2tfcG9yY2ggKyB2bS0+aHN5bmNfbGVuICsKKwkJICAg
ICAgdm0tPmhhY3RpdmUgLSAxOworCWhzeW5jX2VuZCA9IHZtLT5oc3luY19sZW4gLSAxOworCisJ
ZGNzc19zc193cml0ZShzcywgKHBoc3luYyA/IFNZTkNfUE9MIDogMCkgfAorCQkgICAgICAoKHUz
Miloc3luY19lbmQgPDwgU1lOQ19FTkRfUE9TKSB8IGhzeW5jX3N0YXJ0LAorCQkgICAgICBEQ1NT
X1NTX0hTWU5DKTsKKworCXZzeW5jX3N0YXJ0ID0gdm0tPnZmcm9udF9wb3JjaCAtIDE7CisJdnN5
bmNfZW5kID0gdm0tPnZmcm9udF9wb3JjaCArIHZtLT52c3luY19sZW4gLSAxOworCisJZGNzc19z
c193cml0ZShzcywgKHB2c3luYyA/IFNZTkNfUE9MIDogMCkgfAorCQkgICAgICAoKHUzMil2c3lu
Y19lbmQgPDwgU1lOQ19FTkRfUE9TKSB8IHZzeW5jX3N0YXJ0LAorCQkgICAgICBEQ1NTX1NTX1ZT
WU5DKTsKKworCWRlX3VsY194ID0gdm0tPmhzeW5jX2xlbiArIHZtLT5oYmFja19wb3JjaCAtIDE7
CisJZGVfdWxjX3kgPSB2bS0+dnN5bmNfbGVuICsgdm0tPnZmcm9udF9wb3JjaCArIHZtLT52YmFj
a19wb3JjaDsKKworCWRjc3Nfc3Nfd3JpdGUoc3MsIFNZTkNfUE9MIHwgKCh1MzIpZGVfdWxjX3kg
PDwgVUxDX1lfUE9TKSB8IGRlX3VsY194LAorCQkgICAgICBEQ1NTX1NTX0RFX1VMQyk7CisKKwlk
ZV9scmNfeCA9IHZtLT5oc3luY19sZW4gKyB2bS0+aGJhY2tfcG9yY2ggKyB2bS0+aGFjdGl2ZSAt
IDE7CisJZGVfbHJjX3kgPSB2bS0+dnN5bmNfbGVuICsgdm0tPnZmcm9udF9wb3JjaCArIHZtLT52
YmFja19wb3JjaCArCisJCSAgIHZtLT52YWN0aXZlIC0gMTsKKworCWRjc3Nfc3Nfd3JpdGUoc3Ms
IChkZV9scmNfeSA8PCBMUkNfWV9QT1MpIHwgZGVfbHJjX3gsIERDU1NfU1NfREVfTFJDKTsKK30K
Kwordm9pZCBkY3NzX3NzX2VuYWJsZShzdHJ1Y3QgZGNzc19zcyAqc3MpCit7CisJZGNzc19zc193
cml0ZShzcywgUlVOX0VOLCBEQ1NTX1NTX1NZU19DVFJMKTsKKwlzcy0+aW5fdXNlID0gdHJ1ZTsK
K30KKwordm9pZCBkY3NzX3NzX2Rpc2FibGUoc3RydWN0IGRjc3Nfc3MgKnNzKQoreworCWRjc3Nf
c3Nfd3JpdGUoc3MsIDAsIERDU1NfU1NfU1lTX0NUUkwpOworCXNzLT5pbl91c2UgPSBmYWxzZTsK
K30KLS0gCjIuNy40CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
