Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BA7B6B63E6
	for <lists+dri-devel@lfdr.de>; Wed, 18 Sep 2019 14:59:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BDA3D6EF34;
	Wed, 18 Sep 2019 12:59:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa2.bahnhof.se (ste-pvt-msa2.bahnhof.se
 [213.80.101.71])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2C89F6EF31
 for <dri-devel@lists.freedesktop.org>; Wed, 18 Sep 2019 12:59:34 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTP id 28AB33F76F;
 Wed, 18 Sep 2019 14:59:27 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Received: from ste-pvt-msa2.bahnhof.se ([127.0.0.1])
 by localhost (ste-ftg-msa2.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Fivy1EwBAv0d; Wed, 18 Sep 2019 14:59:26 +0200 (CEST)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTPA id 058013F75E;
 Wed, 18 Sep 2019 14:59:26 +0200 (CEST)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id CC5D7360596;
 Wed, 18 Sep 2019 14:59:24 +0200 (CEST)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org
Subject: [PATCH 5/7] drm/vmwgfx: Use an RBtree instead of linked list for MOB
 resources
Date: Wed, 18 Sep 2019 14:59:12 +0200
Message-Id: <20190918125914.38497-6-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190918125914.38497-1-thomas_os@shipmail.org>
References: <20190918125914.38497-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1568811564; bh=SNbcWxMXta8qaUE8qMDRNvV7AMAIqFn6HCBuIiXlnnE=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=IzRdp8+v7fA4LMekLnj0MXiJtJBLq7XeZlx+7y0zwbTlL2u4xunODnSG8tZPd/m3u
 6TuKjbIE7fxf3euoq6e383hZPhc8vxvm02AJXyoiku97K7G9BOIUCPWvg4t3/VQuOW
 SbI1JeyHO8wCmE0jTOoHT251CipJNnDcW2uxYOQU=
X-Mailman-Original-Authentication-Results: ste-pvt-msa2.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=IzRdp8+v; 
 dkim-atps=neutral
X-Mailman-Original-Authentication-Results: ste-ftg-msa2.bahnhof.se
 (amavisd-new); 
 dkim=pass (1024-bit key) header.d=shipmail.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 Rik van Riel <riel@surriel.com>, pv-drivers@vmware.com,
 Minchan Kim <minchan@kernel.org>, Will Deacon <will.deacon@arm.com>,
 Matthew Wilcox <willy@infradead.org>, Christoph Hellwig <hch@infradead.org>,
 Peter Zijlstra <peterz@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com, Souptick Joarder <jrdr.linux@gmail.com>,
 Huang Ying <ying.huang@intel.com>, Andrew Morton <akpm@linux-foundation.org>,
 Deepak Rawat <drawat@vmware.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKV2l0aCBlbXVs
YXRlZCBjb2hlcmVudCBtZW1vcnkgd2UgbmVlZCB0byBiZSBhYmxlIHRvIHF1aWNrbHkgbG9vayB1
cAphIHJlc291cmNlIGZyb20gdGhlIE1PQiBvZmZzZXQuIEluc3RlYWQgb2YgdHJhdmVyc2luZyBh
IGxpbmtlZCBsaXN0IHdpdGgKTyhuKSB3b3JzdCBjYXNlLCB1c2UgYW4gUkJ0cmVlIHdpdGggTyhs
b2cgbikgd29yc3QgY2FzZSBjb21wbGV4aXR5LgoKQ2M6IEFuZHJldyBNb3J0b24gPGFrcG1AbGlu
dXgtZm91bmRhdGlvbi5vcmc+CkNjOiBNYXR0aGV3IFdpbGNveCA8d2lsbHlAaW5mcmFkZWFkLm9y
Zz4KQ2M6IFdpbGwgRGVhY29uIDx3aWxsLmRlYWNvbkBhcm0uY29tPgpDYzogUGV0ZXIgWmlqbHN0
cmEgPHBldGVyekBpbmZyYWRlYWQub3JnPgpDYzogUmlrIHZhbiBSaWVsIDxyaWVsQHN1cnJpZWwu
Y29tPgpDYzogTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9yZz4KQ2M6IE1pY2hhbCBIb2Nr
byA8bWhvY2tvQHN1c2UuY29tPgpDYzogSHVhbmcgWWluZyA8eWluZy5odWFuZ0BpbnRlbC5jb20+
CkNjOiBTb3VwdGljayBKb2FyZGVyIDxqcmRyLmxpbnV4QGdtYWlsLmNvbT4KQ2M6ICJKw6lyw7Rt
ZSBHbGlzc2UiIDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiAiQ2hyaXN0aWFuIEvDtm5pZyIgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFk
ZWFkLm9yZz4KU2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdh
cmUuY29tPgpSZXZpZXdlZC1ieTogRGVlcGFrIFJhd2F0IDxkcmF3YXRAdm13YXJlLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jICAgICAgIHwgIDUgKystLQogZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmggICAgICB8IDEwICsrKy0tLS0KIGRyaXZl
cnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3Jlc291cmNlLmMgfCAzMyArKysrKysrKysrKysrKysr
Ky0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMzIgaW5zZXJ0aW9ucygrKSwgMTYgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYyBiL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKaW5kZXggODY5YWVhZWMyZjg2Li4xOGU0
YjMyOWU1NjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYwpAQCAtNDYzLDYgKzQ2Myw3
IEBAIHZvaWQgdm13X2JvX2JvX2ZyZWUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAlz
dHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZtd19ibyA9IHZtd19idWZmZXJfb2JqZWN0KGJvKTsK
IAogCVdBUk5fT04odm13X2JvLT5kaXJ0eSk7CisJV0FSTl9PTighUkJfRU1QVFlfUk9PVCgmdm13
X2JvLT5yZXNfdHJlZSkpOwogCXZtd19ib191bm1hcCh2bXdfYm8pOwogCWtmcmVlKHZtd19ibyk7
CiB9CkBAIC00NzksNiArNDgwLDcgQEAgc3RhdGljIHZvaWQgdm13X3VzZXJfYm9fZGVzdHJveShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQogCXN0cnVjdCB2bXdfYnVmZmVyX29iamVjdCAq
dmJvID0gJnZtd191c2VyX2JvLT52Ym87CiAKIAlXQVJOX09OKHZiby0+ZGlydHkpOworCVdBUk5f
T04oIVJCX0VNUFRZX1JPT1QoJnZiby0+cmVzX3RyZWUpKTsKIAl2bXdfYm9fdW5tYXAodmJvKTsK
IAl0dG1fcHJpbWVfb2JqZWN0X2tmcmVlKHZtd191c2VyX2JvLCBwcmltZSk7CiB9CkBAIC01MTQs
OCArNTE2LDcgQEAgaW50IHZtd19ib19pbml0KHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJbWVtc2V0KHZtd19ibywgMCwgc2l6ZW9mKCp2bXdfYm8pKTsKIAlCVUlMRF9CVUdfT04oVFRN
X01BWF9CT19QUklPUklUWSA8PSAzKTsKIAl2bXdfYm8tPmJhc2UucHJpb3JpdHkgPSAzOwotCi0J
SU5JVF9MSVNUX0hFQUQoJnZtd19iby0+cmVzX2xpc3QpOworCXZtd19iby0+cmVzX3RyZWUgPSBS
Ql9ST09UOwogCiAJcmV0ID0gdHRtX2JvX2luaXQoYmRldiwgJnZtd19iby0+YmFzZSwgc2l6ZSwK
IAkJCSAgdHRtX2JvX3R5cGVfZGV2aWNlLCBwbGFjZW1lbnQsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13
Z2Z4X2Rydi5oCmluZGV4IDc5NDRkYmJiZGQ3Mi4uNTNmODUyMmFlMDMyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
dm13Z2Z4L3Ztd2dmeF9kcnYuaApAQCAtMTAwLDcgKzEwMCw3IEBAIHN0cnVjdCB2bXdfZnByaXYg
ewogLyoqCiAgKiBzdHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgLSBUVE0gYnVmZmVyIG9iamVjdCB3
aXRoIHZtd2dmeCBhZGRpdGlvbnMKICAqIEBiYXNlOiBUaGUgVFRNIGJ1ZmZlciBvYmplY3QKLSAq
IEByZXNfbGlzdDogTGlzdCBvZiByZXNvdXJjZXMgdXNpbmcgdGhpcyBidWZmZXIgb2JqZWN0IGFz
IGEgYmFja2luZyBNT0IKKyAqIEByZXNfdHJlZTogUkIgdHJlZSBvZiByZXNvdXJjZXMgdXNpbmcg
dGhpcyBidWZmZXIgb2JqZWN0IGFzIGEgYmFja2luZyBNT0IKICAqIEBwaW5fY291bnQ6IHBpbiBk
ZXB0aAogICogQGR4X3F1ZXJ5X2N0eDogRFggY29udGV4dCBpZiB0aGlzIGJ1ZmZlciBvYmplY3Qg
aXMgdXNlZCBhcyBhIERYIHF1ZXJ5IE1PQgogICogQG1hcDogS21hcCBvYmplY3QgZm9yIHNlbWkt
cGVyc2lzdGVudCBtYXBwaW5ncwpAQCAtMTA5LDcgKzEwOSw3IEBAIHN0cnVjdCB2bXdfZnByaXYg
ewogICovCiBzdHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgewogCXN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCBiYXNlOwotCXN0cnVjdCBsaXN0X2hlYWQgcmVzX2xpc3Q7CisJc3RydWN0IHJiX3Jvb3Qg
cmVzX3RyZWU7CiAJczMyIHBpbl9jb3VudDsKIAkvKiBOb3QgcmVmLWNvdW50ZWQuICBQcm90ZWN0
ZWQgYnkgYmluZGluZ19tdXRleCAqLwogCXN0cnVjdCB2bXdfcmVzb3VyY2UgKmR4X3F1ZXJ5X2N0
eDsKQEAgLTE1Nyw4ICsxNTcsOCBAQCBzdHJ1Y3Qgdm13X3Jlc19mdW5jOwogICogcGluLWNvdW50
IGdyZWF0ZXIgdGhhbiB6ZXJvLiBJdCBpcyBub3Qgb24gdGhlIHJlc291cmNlIExSVSBsaXN0cyBh
bmQgaXRzCiAgKiBiYWNrdXAgYnVmZmVyIGlzIHBpbm5lZC4gSGVuY2UgaXQgY2FuJ3QgYmUgZXZp
Y3RlZC4KICAqIEBmdW5jOiBNZXRob2QgdnRhYmxlIGZvciB0aGlzIHJlc291cmNlLiBJbW11dGFi
bGUuCisgKiBAbW9iX25vZGU7IE5vZGUgZm9yIHRoZSBNT0IgYmFja3VwIHJidHJlZS4gUHJvdGVj
dGVkIGJ5IEBiYWNrdXAgcmVzZXJ2ZWQuCiAgKiBAbHJ1X2hlYWQ6IExpc3QgaGVhZCBmb3IgdGhl
IExSVSBsaXN0LiBQcm90ZWN0ZWQgYnkgQGRldl9wcml2OjpyZXNvdXJjZV9sb2NrLgotICogQG1v
Yl9oZWFkOiBMaXN0IGhlYWQgZm9yIHRoZSBNT0IgYmFja3VwIGxpc3QuIFByb3RlY3RlZCBieSBA
YmFja3VwIHJlc2VydmVkLgogICogQGJpbmRpbmdfaGVhZDogTGlzdCBoZWFkIGZvciB0aGUgY29u
dGV4dCBiaW5kaW5nIGxpc3QuIFByb3RlY3RlZCBieQogICogdGhlIEBkZXZfcHJpdjo6YmluZGlu
Z19tdXRleAogICogQHJlc19mcmVlOiBUaGUgcmVzb3VyY2UgZGVzdHJ1Y3Rvci4KQEAgLTE3OSw4
ICsxNzksOCBAQCBzdHJ1Y3Qgdm13X3Jlc291cmNlIHsKIAl1bnNpZ25lZCBsb25nIGJhY2t1cF9v
ZmZzZXQ7CiAJdW5zaWduZWQgbG9uZyBwaW5fY291bnQ7CiAJY29uc3Qgc3RydWN0IHZtd19yZXNf
ZnVuYyAqZnVuYzsKKwlzdHJ1Y3QgcmJfbm9kZSBtb2Jfbm9kZTsKIAlzdHJ1Y3QgbGlzdF9oZWFk
IGxydV9oZWFkOwotCXN0cnVjdCBsaXN0X2hlYWQgbW9iX2hlYWQ7CiAJc3RydWN0IGxpc3RfaGVh
ZCBiaW5kaW5nX2hlYWQ7CiAJc3RydWN0IHZtd19yZXNvdXJjZV9kaXJ0eSAqZGlydHk7CiAJdm9p
ZCAoKnJlc19mcmVlKSAoc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKTsKQEAgLTczMyw3ICs3MzMs
NyBAQCB2b2lkIHZtd19yZXNvdXJjZV9kaXJ0eV91cGRhdGUoc3RydWN0IHZtd19yZXNvdXJjZSAq
cmVzLCBwZ29mZl90IHN0YXJ0LAogICovCiBzdGF0aWMgaW5saW5lIGJvb2wgdm13X3Jlc291cmNl
X21vYl9hdHRhY2hlZChjb25zdCBzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMpCiB7Ci0JcmV0dXJu
ICFsaXN0X2VtcHR5KCZyZXMtPm1vYl9oZWFkKTsKKwlyZXR1cm4gIVJCX0VNUFRZX05PREUoJnJl
cy0+bW9iX25vZGUpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92bXdn
Zngvdm13Z2Z4X3Jlc291cmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNv
dXJjZS5jCmluZGV4IGU0Yzk3YTRjZjJmZi4uMzI4YWQ0NjA3NmZmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS92bXdnZngvdm13Z2Z4X3Jlc291cmNlLmMKQEAgLTQwLDExICs0MCwyNCBAQAogdm9pZCB2bXdf
cmVzb3VyY2VfbW9iX2F0dGFjaChzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMpCiB7CiAJc3RydWN0
IHZtd19idWZmZXJfb2JqZWN0ICpiYWNrdXAgPSByZXMtPmJhY2t1cDsKKwlzdHJ1Y3QgcmJfbm9k
ZSAqKm5ldyA9ICZiYWNrdXAtPnJlc190cmVlLnJiX25vZGUsICpwYXJlbnQgPSBOVUxMOwogCiAJ
ZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQocmVzLT5iYWNrdXAtPmJhc2UuYmFzZS5yZXN2KTsKIAlyZXMt
PnVzZWRfcHJpbyA9IChyZXMtPnJlc19kaXJ0eSkgPyByZXMtPmZ1bmMtPmRpcnR5X3ByaW8gOgog
CQlyZXMtPmZ1bmMtPnByaW87Ci0JbGlzdF9hZGRfdGFpbCgmcmVzLT5tb2JfaGVhZCwgJmJhY2t1
cC0+cmVzX2xpc3QpOworCisJd2hpbGUgKCpuZXcpIHsKKwkJc3RydWN0IHZtd19yZXNvdXJjZSAq
dGhpcyA9CisJCQljb250YWluZXJfb2YoKm5ldywgc3RydWN0IHZtd19yZXNvdXJjZSwgbW9iX25v
ZGUpOworCisJCXBhcmVudCA9ICpuZXc7CisJCW5ldyA9IChyZXMtPmJhY2t1cF9vZmZzZXQgPCB0
aGlzLT5iYWNrdXBfb2Zmc2V0KSA/CisJCQkmKCgqbmV3KS0+cmJfbGVmdCkgOiAmKCgqbmV3KS0+
cmJfcmlnaHQpOworCX0KKworCXJiX2xpbmtfbm9kZSgmcmVzLT5tb2Jfbm9kZSwgcGFyZW50LCBu
ZXcpOworCXJiX2luc2VydF9jb2xvcigmcmVzLT5tb2Jfbm9kZSwgJmJhY2t1cC0+cmVzX3RyZWUp
OworCiAJdm13X2JvX3ByaW9fYWRkKGJhY2t1cCwgcmVzLT51c2VkX3ByaW8pOwogfQogCkBAIC01
OCw3ICs3MSw4IEBAIHZvaWQgdm13X3Jlc291cmNlX21vYl9kZXRhY2goc3RydWN0IHZtd19yZXNv
dXJjZSAqcmVzKQogCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQoYmFja3VwLT5iYXNlLmJhc2UucmVz
dik7CiAJaWYgKHZtd19yZXNvdXJjZV9tb2JfYXR0YWNoZWQocmVzKSkgewotCQlsaXN0X2RlbF9p
bml0KCZyZXMtPm1vYl9oZWFkKTsKKwkJcmJfZXJhc2UoJnJlcy0+bW9iX25vZGUsICZiYWNrdXAt
PnJlc190cmVlKTsKKwkJUkJfQ0xFQVJfTk9ERSgmcmVzLT5tb2Jfbm9kZSk7CiAJCXZtd19ib19w
cmlvX2RlbChiYWNrdXAsIHJlcy0+dXNlZF9wcmlvKTsKIAl9CiB9CkBAIC0yMDQsOCArMjE4LDgg
QEAgaW50IHZtd19yZXNvdXJjZV9pbml0KHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0
cnVjdCB2bXdfcmVzb3VyY2UgKnJlcywKIAlyZXMtPnJlc19mcmVlID0gcmVzX2ZyZWU7CiAJcmVz
LT5kZXZfcHJpdiA9IGRldl9wcml2OwogCXJlcy0+ZnVuYyA9IGZ1bmM7CisJUkJfQ0xFQVJfTk9E
RSgmcmVzLT5tb2Jfbm9kZSk7CiAJSU5JVF9MSVNUX0hFQUQoJnJlcy0+bHJ1X2hlYWQpOwotCUlO
SVRfTElTVF9IRUFEKCZyZXMtPm1vYl9oZWFkKTsKIAlJTklUX0xJU1RfSEVBRCgmcmVzLT5iaW5k
aW5nX2hlYWQpOwogCXJlcy0+aWQgPSAtMTsKIAlyZXMtPmJhY2t1cCA9IE5VTEw7CkBAIC03NTQs
MTkgKzc2OCwyMCBAQCBpbnQgdm13X3Jlc291cmNlX3ZhbGlkYXRlKHN0cnVjdCB2bXdfcmVzb3Vy
Y2UgKnJlcywgYm9vbCBpbnRyKQogICovCiB2b2lkIHZtd19yZXNvdXJjZV91bmJpbmRfbGlzdChz
dHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibykKIHsKLQotCXN0cnVjdCB2bXdfcmVzb3VyY2Ug
KnJlcywgKm5leHQ7CiAJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgdmFsX2J1ZiA9IHsKIAkJ
LmJvID0gJnZiby0+YmFzZSwKIAkJLm51bV9zaGFyZWQgPSAwCiAJfTsKIAogCWRtYV9yZXN2X2Fz
c2VydF9oZWxkKHZiby0+YmFzZS5iYXNlLnJlc3YpOwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZShyZXMsIG5leHQsICZ2Ym8tPnJlc19saXN0LCBtb2JfaGVhZCkgewotCQlpZiAoIXJlcy0+ZnVu
Yy0+dW5iaW5kKQotCQkJY29udGludWU7CisJd2hpbGUgKCFSQl9FTVBUWV9ST09UKCZ2Ym8tPnJl
c190cmVlKSkgeworCQlzdHJ1Y3QgcmJfbm9kZSAqbm9kZSA9IHZiby0+cmVzX3RyZWUucmJfbm9k
ZTsKKwkJc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzID0KKwkJCWNvbnRhaW5lcl9vZihub2RlLCBz
dHJ1Y3Qgdm13X3Jlc291cmNlLCBtb2Jfbm9kZSk7CisKKwkJaWYgKCFXQVJOX09OX09OQ0UoIXJl
cy0+ZnVuYy0+dW5iaW5kKSkKKwkJCSh2b2lkKSByZXMtPmZ1bmMtPnVuYmluZChyZXMsIHJlcy0+
cmVzX2RpcnR5LCAmdmFsX2J1Zik7CiAKLQkJKHZvaWQpIHJlcy0+ZnVuYy0+dW5iaW5kKHJlcywg
cmVzLT5yZXNfZGlydHksICZ2YWxfYnVmKTsKIAkJcmVzLT5iYWNrdXBfZGlydHkgPSB0cnVlOwog
CQlyZXMtPnJlc19kaXJ0eSA9IGZhbHNlOwogCQl2bXdfcmVzb3VyY2VfbW9iX2RldGFjaChyZXMp
OwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2
ZWw=
