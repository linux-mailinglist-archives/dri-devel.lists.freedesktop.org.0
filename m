Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D29E5106824
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 09:30:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F05ED6E2ED;
	Fri, 22 Nov 2019 08:30:53 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2F20C6E2ED
 for <dri-devel@lists.freedesktop.org>; Fri, 22 Nov 2019 08:30:49 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id A2951B39F;
 Fri, 22 Nov 2019 08:30:47 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, maarten.lankhorst@linux.intel.com, mripard@kernel.org,
 airlied@linux.ie, z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com, sam@ravnborg.org,
 kraxel@redhat.com, hslester96@gmail.com, yuehaibing@huawei.com
Subject: [PATCH 2/4] drm/hisilicon/hibmc: Replace struct hibmc_framebuffer
 with generic code
Date: Fri, 22 Nov 2019 09:30:42 +0100
Message-Id: <20191122083044.6627-3-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191122083044.6627-1-tzimmermann@suse.de>
References: <20191122083044.6627-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIGhpYm1jIGRyaXZlcidzIHN0cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciBzdG9yZXMgYSBEUk0g
ZnJhbWVidWZmZXIKd2l0aCBhbiBhc3NvY2lhdGVkIEdFTSBvYmplY3QuIFRoaXMgZnVuY3Rpb25h
bGl0eSBpcyBhbHNvIHByb3ZpZGVkIGJ5CmdlbmVyaWMgY29kZS4gU3dpdGNoIGhpYm1jIG92ZXIu
CgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4K
LS0tCiAuLi4vZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2RlLmMgICAgfCAgNCAr
LQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuaCAgIHwgMTEgLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jICAgfCA2OSArLS0t
LS0tLS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDMgaW5zZXJ0aW9ucygrKSwgODEgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9o
aWJtY19kcm1fZGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJt
X2RlLmMKaW5kZXggNjUyN2E5N2Y2OGEzLi43ZmE3ZDQ5MzNmNjAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2RlLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZGUuYwpAQCAtOTksMTQgKzk5LDEyIEBA
IHN0YXRpYyB2b2lkIGhpYm1jX3BsYW5lX2F0b21pY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCiAJczY0IGdwdV9hZGRyID0gMDsKIAl1bnNpZ25lZCBpbnQgbGluZV9sOwogCXN0cnVj
dCBoaWJtY19kcm1fcHJpdmF0ZSAqcHJpdiA9IHBsYW5lLT5kZXYtPmRldl9wcml2YXRlOwotCXN0
cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciAqaGlibWNfZmI7CiAJc3RydWN0IGRybV9nZW1fdnJhbV9v
YmplY3QgKmdibzsKIAogCWlmICghc3RhdGUtPmZiKQogCQlyZXR1cm47CiAKLQloaWJtY19mYiA9
IHRvX2hpYm1jX2ZyYW1lYnVmZmVyKHN0YXRlLT5mYik7Ci0JZ2JvID0gZHJtX2dlbV92cmFtX29m
X2dlbShoaWJtY19mYi0+b2JqKTsKKwlnYm8gPSBkcm1fZ2VtX3ZyYW1fb2ZfZ2VtKHN0YXRlLT5m
Yi0+b2JqWzBdKTsKIAogCWdwdV9hZGRyID0gZHJtX2dlbV92cmFtX29mZnNldChnYm8pOwogCWlm
IChXQVJOX09OX09OQ0UoZ3B1X2FkZHIgPCAwKSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2hpc2ls
aWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmgKaW5kZXggYjM0NDkzZWFkMzBiLi44ZWI3MjU4YjIz
NmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJt
X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Ry
di5oCkBAIC0yMCwxMSArMjAsNiBAQAogc3RydWN0IGRybV9kZXZpY2U7CiBzdHJ1Y3QgZHJtX2dl
bV9vYmplY3Q7CiAKLXN0cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciB7Ci0Jc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciBmYjsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKLX07Ci0KIHN0cnVjdCBo
aWJtY19kcm1fcHJpdmF0ZSB7CiAJLyogaHcgKi8KIAl2b2lkIF9faW9tZW0gICAqbW1pbzsKQEAg
LTM4LDggKzMzLDYgQEAgc3RydWN0IGhpYm1jX2RybV9wcml2YXRlIHsKIAlib29sIG1vZGVfY29u
ZmlnX2luaXRpYWxpemVkOwogfTsKIAotI2RlZmluZSB0b19oaWJtY19mcmFtZWJ1ZmZlcih4KSBj
b250YWluZXJfb2YoeCwgc3RydWN0IGhpYm1jX2ZyYW1lYnVmZmVyLCBmYikKLQogdm9pZCBoaWJt
Y19zZXRfcG93ZXJfbW9kZShzdHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnByaXYsCiAJCQkgIHVu
c2lnbmVkIGludCBwb3dlcl9tb2RlKTsKIHZvaWQgaGlibWNfc2V0X2N1cnJlbnRfZ2F0ZShzdHJ1
Y3QgaGlibWNfZHJtX3ByaXZhdGUgKnByaXYsCkBAIC01MCwxMCArNDMsNiBAQCBpbnQgaGlibWNf
dmRhY19pbml0KHN0cnVjdCBoaWJtY19kcm1fcHJpdmF0ZSAqcHJpdik7CiAKIGludCBoaWJtY19n
ZW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHUzMiBzaXplLCBib29sIGlza2VybmVs
LAogCQkgICAgIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKm9iaik7Ci1zdHJ1Y3QgaGlibWNfZnJh
bWVidWZmZXIgKgotaGlibWNfZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAotCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21kLAotCQkg
ICAgICAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopOwogCiBpbnQgaGlibWNfbW1faW5pdChz
dHJ1Y3QgaGlibWNfZHJtX3ByaXZhdGUgKmhpYm1jKTsKIHZvaWQgaGlibWNfbW1fZmluaShzdHJ1
Y3QgaGlibWNfZHJtX3ByaXZhdGUgKmhpYm1jKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29u
L2hpYm1jL2hpYm1jX3R0bS5jCmluZGV4IDIxYjY4NGVhYjVjOS4uZjZkMjViODVjMjA5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMKQEAgLTE1LDYgKzE1
LDcgQEAKIAogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgogI2luY2x1ZGUgPGRy
bS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+
CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJt
X3ByaW50Lmg+CiAKQEAgLTk3LDc0ICs5OCw4IEBAIGludCBoaWJtY19kdW1iX2NyZWF0ZShzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGUsIHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJcmV0dXJuIDA7CiB9
CiAKLXN0YXRpYyB2b2lkIGhpYm1jX3VzZXJfZnJhbWVidWZmZXJfZGVzdHJveShzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYikKLXsKLQlzdHJ1Y3QgaGlibWNfZnJhbWVidWZmZXIgKmhpYm1jX2Zi
ID0gdG9faGlibWNfZnJhbWVidWZmZXIoZmIpOwotCi0JZHJtX2dlbV9vYmplY3RfcHV0X3VubG9j
a2VkKGhpYm1jX2ZiLT5vYmopOwotCWRybV9mcmFtZWJ1ZmZlcl9jbGVhbnVwKGZiKTsKLQlrZnJl
ZShoaWJtY19mYik7Ci19Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyX2Z1
bmNzIGhpYm1jX2ZiX2Z1bmNzID0gewotCS5kZXN0cm95ID0gaGlibWNfdXNlcl9mcmFtZWJ1ZmZl
cl9kZXN0cm95LAotfTsKLQotc3RydWN0IGhpYm1jX2ZyYW1lYnVmZmVyICoKLWhpYm1jX2ZyYW1l
YnVmZmVyX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgICAgIGNvbnN0IHN0cnVj
dCBkcm1fbW9kZV9mYl9jbWQyICptb2RlX2NtZCwKLQkJICAgICAgIHN0cnVjdCBkcm1fZ2VtX29i
amVjdCAqb2JqKQotewotCXN0cnVjdCBoaWJtY19mcmFtZWJ1ZmZlciAqaGlibWNfZmI7Ci0JaW50
IHJldDsKLQotCWhpYm1jX2ZiID0ga3phbGxvYyhzaXplb2YoKmhpYm1jX2ZiKSwgR0ZQX0tFUk5F
TCk7Ci0JaWYgKCFoaWJtY19mYikgewotCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxvY2F0ZSBo
aWJtY19mYlxuIik7Ci0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCX0KLQotCWRybV9oZWxw
ZXJfbW9kZV9maWxsX2ZiX3N0cnVjdChkZXYsICZoaWJtY19mYi0+ZmIsIG1vZGVfY21kKTsKLQlo
aWJtY19mYi0+b2JqID0gb2JqOwotCXJldCA9IGRybV9mcmFtZWJ1ZmZlcl9pbml0KGRldiwgJmhp
Ym1jX2ZiLT5mYiwgJmhpYm1jX2ZiX2Z1bmNzKTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigi
ZHJtX2ZyYW1lYnVmZmVyX2luaXQgZmFpbGVkOiAlZFxuIiwgcmV0KTsKLQkJa2ZyZWUoaGlibWNf
ZmIpOwotCQlyZXR1cm4gRVJSX1BUUihyZXQpOwotCX0KLQotCXJldHVybiBoaWJtY19mYjsKLX0K
LQotc3RhdGljIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKgotaGlibWNfdXNlcl9mcmFtZWJ1ZmZl
cl9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCSAgICAgIHN0cnVjdCBkcm1fZmls
ZSAqZmlscCwKLQkJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICptb2RlX2Nt
ZCkKLXsKLQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgaGlibWNfZnJhbWVi
dWZmZXIgKmhpYm1jX2ZiOwotCi0JRFJNX0RFQlVHX0RSSVZFUigiJWR4JWQsIGZvcm1hdCAlYyVj
JWMlY1xuIiwKLQkJCSBtb2RlX2NtZC0+d2lkdGgsIG1vZGVfY21kLT5oZWlnaHQsCi0JCQkgKG1v
ZGVfY21kLT5waXhlbF9mb3JtYXQpICYgMHhmZiwKLQkJCSAobW9kZV9jbWQtPnBpeGVsX2Zvcm1h
dCA+PiA4KSAgJiAweGZmLAotCQkJIChtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0ID4+IDE2KSAmIDB4
ZmYsCi0JCQkgKG1vZGVfY21kLT5waXhlbF9mb3JtYXQgPj4gMjQpICYgMHhmZik7Ci0KLQlvYmog
PSBkcm1fZ2VtX29iamVjdF9sb29rdXAoZmlscCwgbW9kZV9jbWQtPmhhbmRsZXNbMF0pOwotCWlm
ICghb2JqKQotCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsKLQotCWhpYm1jX2ZiID0gaGlibWNf
ZnJhbWVidWZmZXJfaW5pdChkZXYsIG1vZGVfY21kLCBvYmopOwotCWlmIChJU19FUlIoaGlibWNf
ZmIpKSB7Ci0JCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZChvYmopOwotCQlyZXR1cm4gRVJS
X1BUUigobG9uZyloaWJtY19mYik7Ci0JfQotCXJldHVybiAmaGlibWNfZmItPmZiOwotfQotCiBj
b25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIGhpYm1jX21vZGVfZnVuY3MgPSB7CiAJ
LmF0b21pY19jaGVjayA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrLAogCS5hdG9taWNfY29tbWl0
ID0gZHJtX2F0b21pY19oZWxwZXJfY29tbWl0LAotCS5mYl9jcmVhdGUgPSBoaWJtY191c2VyX2Zy
YW1lYnVmZmVyX2NyZWF0ZSwKKwkuZmJfY3JlYXRlID0gZHJtX2dlbV9mYl9jcmVhdGUsCiB9Owot
LSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
