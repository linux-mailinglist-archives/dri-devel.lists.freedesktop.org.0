Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 76729CB7FA
	for <lists+dri-devel@lfdr.de>; Fri,  4 Oct 2019 12:12:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 232786EB0C;
	Fri,  4 Oct 2019 10:12:04 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 557306EB0A;
 Fri,  4 Oct 2019 10:12:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18720645-1500050 
 for multiple; Fri, 04 Oct 2019 11:11:43 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH] dma-fence: Serialise signal enabling
 (dma_fence_enable_sw_signaling)
Date: Fri,  4 Oct 2019 11:11:40 +0100
Message-Id: <20191004101140.32713-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003210100.22250-2-chris@chris-wilson.co.uk>
References: <20191003210100.22250-2-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org, tvrtko.ursulin@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWFrZSBkbWFfZmVuY2VfZW5hYmxlX3N3X3NpZ25hbGluZygpIGJlaGF2ZSBsaWtlIGl0cwpkbWFf
ZmVuY2VfYWRkX2NhbGxiYWNrKCkgYW5kIGRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoKSBjb3VudGVy
cGFydHMgYW5kCnBlcmZvcm0gdGhlIHRlc3QgdG8gZW5hYmxlIHNpZ25hbGluZyB1bmRlciB0aGUg
ZmVuY2UtPmxvY2ssIGFsb25nIHdpdGgKdGhlIGFjdGlvbiB0byBkbyBzby4gVGhpcyBlbnN1cmUg
dGhhdCBzaG91bGQgYW4gaW1wbGVtZW50YXRpb24gYmUgdHJ5aW5nCnRvIGZsdXNoIHRoZSBjYl9s
aXN0IChieSBzaWduYWxpbmcpIG9uIHJldGlyZW1lbnQgYmVmb3JlIGZyZWVpbmcgdGhlCmZlbmNl
LCBpdCBjYW4gZG8gc28gaW4gYSByYWNlLWZyZWUgbWFubmVyLgoKU2VlIGFsc28gMGZjODliNjgw
MmJhICgiZG1hLWZlbmNlOiBTaW1wbHkgd3JhcCBkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZAp3aXRo
IGRtYV9mZW5jZV9zaWduYWwiKS4KCnYyOiBSZWZhY3RvciBhbGwgMyBlbmFibGVfc2lnbmFsaW5n
IHBhdGhzIHRvIHVzZSBhIGNvbW1vbiBmdW5jdGlvbi4KdjM6IERvbid0IGFyZ3VlLCBqdXN0IGtl
ZXAgdGhlIHRyYWNlcG9pbnQgaW4gdGhlIGV4aXN0aW5nIHNwb3QuCgpTaWduZWQtb2ZmLWJ5OiBD
aHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGlu
IDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5j
ZS5jIHwgNzggKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNo
YW5nZWQsIDM1IGluc2VydGlvbnMoKyksIDQzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwpp
bmRleCAyYzEzNmFlZTNlNzkuLjA1MmE0MWUyNDUxYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEt
YnVmL2RtYS1mZW5jZS5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYwpAQCAtMjcz
LDYgKzI3MywzMCBAQCB2b2lkIGRtYV9mZW5jZV9mcmVlKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQogfQogRVhQT1JUX1NZTUJPTChkbWFfZmVuY2VfZnJlZSk7CiAKK3N0YXRpYyBib29sIF9fZG1h
X2ZlbmNlX2VuYWJsZV9zaWduYWxpbmcoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJYm9v
bCB3YXNfc2V0OworCisJbG9ja2RlcF9hc3NlcnRfaGVsZChmZW5jZS0+bG9jayk7CisKKwl3YXNf
c2V0ID0gdGVzdF9hbmRfc2V0X2JpdChETUFfRkVOQ0VfRkxBR19FTkFCTEVfU0lHTkFMX0JJVCwK
KwkJCQkgICAmZmVuY2UtPmZsYWdzKTsKKworCWlmICh0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19T
SUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAoIXdh
c19zZXQgJiYgZmVuY2UtPm9wcy0+ZW5hYmxlX3NpZ25hbGluZykgeworCQl0cmFjZV9kbWFfZmVu
Y2VfZW5hYmxlX3NpZ25hbChmZW5jZSk7CisKKwkJaWYgKCFmZW5jZS0+b3BzLT5lbmFibGVfc2ln
bmFsaW5nKGZlbmNlKSkgeworCQkJZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQoZmVuY2UpOworCQkJ
cmV0dXJuIGZhbHNlOworCQl9CisJfQorCisJcmV0dXJuIHRydWU7Cit9CisKIC8qKgogICogZG1h
X2ZlbmNlX2VuYWJsZV9zd19zaWduYWxpbmcgLSBlbmFibGUgc2lnbmFsaW5nIG9uIGZlbmNlCiAg
KiBAZmVuY2U6IHRoZSBmZW5jZSB0byBlbmFibGUKQEAgLTI4NSwxOSArMzA5LDEyIEBAIHZvaWQg
ZG1hX2ZlbmNlX2VuYWJsZV9zd19zaWduYWxpbmcoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7
CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCWlmICghdGVzdF9hbmRfc2V0X2JpdChETUFfRkVO
Q0VfRkxBR19FTkFCTEVfU0lHTkFMX0JJVCwKLQkJCSAgICAgICZmZW5jZS0+ZmxhZ3MpICYmCi0J
ICAgICF0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3Mp
ICYmCi0JICAgIGZlbmNlLT5vcHMtPmVuYWJsZV9zaWduYWxpbmcpIHsKLQkJdHJhY2VfZG1hX2Zl
bmNlX2VuYWJsZV9zaWduYWwoZmVuY2UpOwotCi0JCXNwaW5fbG9ja19pcnFzYXZlKGZlbmNlLT5s
b2NrLCBmbGFncyk7Ci0KLQkJaWYgKCFmZW5jZS0+b3BzLT5lbmFibGVfc2lnbmFsaW5nKGZlbmNl
KSkKLQkJCWRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKGZlbmNlKTsKKwlpZiAodGVzdF9iaXQoRE1B
X0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSkKKwkJcmV0dXJuOwogCi0J
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKLQl9CisJc3Bpbl9s
b2NrX2lycXNhdmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKKwlfX2RtYV9mZW5jZV9lbmFibGVfc2ln
bmFsaW5nKGZlbmNlKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFn
cyk7CiB9CiBFWFBPUlRfU1lNQk9MKGRtYV9mZW5jZV9lbmFibGVfc3dfc2lnbmFsaW5nKTsKIApA
QCAtMzMxLDcgKzM0OCw2IEBAIGludCBkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYiwKIHsKIAl1bnNpZ25lZCBsb25n
IGZsYWdzOwogCWludCByZXQgPSAwOwotCWJvb2wgd2FzX3NldDsKIAogCWlmIChXQVJOX09OKCFm
ZW5jZSB8fCAhZnVuYykpCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMzQzLDI1ICszNTksMTQgQEAg
aW50IGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVj
dCBkbWFfZmVuY2VfY2IgKmNiLAogCiAJc3Bpbl9sb2NrX2lycXNhdmUoZmVuY2UtPmxvY2ssIGZs
YWdzKTsKIAotCXdhc19zZXQgPSB0ZXN0X2FuZF9zZXRfYml0KERNQV9GRU5DRV9GTEFHX0VOQUJM
RV9TSUdOQUxfQklULAotCQkJCSAgICZmZW5jZS0+ZmxhZ3MpOwotCi0JaWYgKHRlc3RfYml0KERN
QV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFncykpCi0JCXJldCA9IC1FTk9F
TlQ7Ci0JZWxzZSBpZiAoIXdhc19zZXQgJiYgZmVuY2UtPm9wcy0+ZW5hYmxlX3NpZ25hbGluZykg
ewotCQl0cmFjZV9kbWFfZmVuY2VfZW5hYmxlX3NpZ25hbChmZW5jZSk7Ci0KLQkJaWYgKCFmZW5j
ZS0+b3BzLT5lbmFibGVfc2lnbmFsaW5nKGZlbmNlKSkgewotCQkJZG1hX2ZlbmNlX3NpZ25hbF9s
b2NrZWQoZmVuY2UpOwotCQkJcmV0ID0gLUVOT0VOVDsKLQkJfQotCX0KLQotCWlmICghcmV0KSB7
CisJaWYgKF9fZG1hX2ZlbmNlX2VuYWJsZV9zaWduYWxpbmcoZmVuY2UpKSB7CiAJCWNiLT5mdW5j
ID0gZnVuYzsKIAkJbGlzdF9hZGRfdGFpbCgmY2ItPm5vZGUsICZmZW5jZS0+Y2JfbGlzdCk7Ci0J
fSBlbHNlCisJfSBlbHNlIHsKIAkJSU5JVF9MSVNUX0hFQUQoJmNiLT5ub2RlKTsKKwkJcmV0ID0g
LUVOT0VOVDsKKwl9CisKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFn
cyk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtNDYxLDcgKzQ2Niw2IEBAIGRtYV9mZW5jZV9kZWZhdWx0
X3dhaXQoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIGJvb2wgaW50ciwgc2lnbmVkIGxvbmcgdGlt
ZW91dCkKIAlzdHJ1Y3QgZGVmYXVsdF93YWl0X2NiIGNiOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
CiAJc2lnbmVkIGxvbmcgcmV0ID0gdGltZW91dCA/IHRpbWVvdXQgOiAxOwotCWJvb2wgd2FzX3Nl
dDsKIAogCWlmICh0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+
ZmxhZ3MpKQogCQlyZXR1cm4gcmV0OwpAQCAtNDczLDIxICs0NzcsOSBAQCBkbWFfZmVuY2VfZGVm
YXVsdF93YWl0KHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBib29sIGludHIsIHNpZ25lZCBsb25n
IHRpbWVvdXQpCiAJCWdvdG8gb3V0OwogCX0KIAotCXdhc19zZXQgPSB0ZXN0X2FuZF9zZXRfYml0
KERNQV9GRU5DRV9GTEFHX0VOQUJMRV9TSUdOQUxfQklULAotCQkJCSAgICZmZW5jZS0+ZmxhZ3Mp
OwotCi0JaWYgKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5m
bGFncykpCisJaWYgKCFfX2RtYV9mZW5jZV9lbmFibGVfc2lnbmFsaW5nKGZlbmNlKSkKIAkJZ290
byBvdXQ7CiAKLQlpZiAoIXdhc19zZXQgJiYgZmVuY2UtPm9wcy0+ZW5hYmxlX3NpZ25hbGluZykg
ewotCQl0cmFjZV9kbWFfZmVuY2VfZW5hYmxlX3NpZ25hbChmZW5jZSk7Ci0KLQkJaWYgKCFmZW5j
ZS0+b3BzLT5lbmFibGVfc2lnbmFsaW5nKGZlbmNlKSkgewotCQkJZG1hX2ZlbmNlX3NpZ25hbF9s
b2NrZWQoZmVuY2UpOwotCQkJZ290byBvdXQ7Ci0JCX0KLQl9Ci0KIAlpZiAoIXRpbWVvdXQpIHsK
IAkJcmV0ID0gMDsKIAkJZ290byBvdXQ7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRl
dmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
