Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3879F8C1E1
	for <lists+dri-devel@lfdr.de>; Tue, 13 Aug 2019 22:11:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7DC586E16D;
	Tue, 13 Aug 2019 20:11:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9D0AA6E10C
 for <dri-devel@lists.freedesktop.org>; Tue, 13 Aug 2019 20:11:16 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id 27C41E56;
 Tue, 13 Aug 2019 22:11:12 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 7/9] drm/panel: Add driver for the Sony ACX565AKM panel
Date: Tue, 13 Aug 2019 23:10:59 +0300
Message-Id: <20190813201101.30980-8-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190813201101.30980-1-laurent.pinchart@ideasonboard.com>
References: <20190813201101.30980-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1565727072;
 bh=tKTj5mwOkiVW3HaO8D9abuhpsb1OQVBwCq3Gzw05ylA=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=tSLydQMpaSHryRzzyOks1QsisvMFMzD5EBH5zRQ0Oy4gKcxUE9fxbwPZh8uZx0T0M
 rR30XvrWZFY3ipZIYKsCSsMU3l6FTuxi+Totm7/Cd5VcGXVyfu3xMIZSDNTYLUMfzH
 HYK3gWAh4d2PWWAdj62vfwVuzO1mnXOuBlWudlM0=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thierry Reding <thierry.reding@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYW5lbCBpcyB1c2VkIG9uIHRoZSBOb2tpYSBOOTAwLgoKVGhlIGNvZGUgaXMgYmFzZWQg
b24gdGhlIG9tYXBkcm0tc3BlY2lmaWMgcGFuZWwtc29ueS1hY3g1NjVha20gZHJpdmVyLgpUaGUg
aGFyZHdhcmUtcmVsYXRlZCBsb2dpYyBoYXMgYmVlbiBjaGFuZ2VkIGFzIGxpdHRsZSBhcyBwb3Nz
aWJsZSB0bwphdm9pZCByZWdyZXNzaW9ucyBhcyBoYXJkd2FyZSBhdmFpbGFiaWxpdHkgaXMgbGFj
a2luZyB0byB0ZXN0IHRoZQpjaGFuZ2VzLiBGb2xsb3ctdXAgcGF0Y2hlcyBzaG91bGQgYWRkcmVz
cyB0aGUgaXRlbXMgbGlzdGVkIGluIHRoZSBUT0RPCmxpc3QuCgpTaWduZWQtb2ZmLWJ5OiBMYXVy
ZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+ClJldmlld2Vk
LWJ5OiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+Ci0tLQpDaGFuZ2VzIHNpbmNlIHYz
OgoKLSBBZGQgVE9ETwoKQ2hhbmdlcyBzaW5jZSB2MjoKCi0gQ2FsbCBkcm1fcGFuZWxfdW5wcmVw
YXJlKCkgaW4gLnJlbW92ZSgpIGhhbmRsZXIKCkNoYW5nZXMgc2luY2UgdjE6CgotIE1lbnRpb24g
Ym9hcmRzIHVzaW5nIHRoZSBwYW5lbCBpbiBLY29uZmlnCi0gUmVuYW1lZCBhY3g1NjVha21fZGV2
aWNlIHRvIGFjeDU2NWFrbV9wYW5lbAotIENvbW1lbnRzIHVwZGF0ZXMKLSBTdG9yZSB3aWR0aF9t
bSBhbmQgaGVpZ2h0X21tIGluIGRybV9kaXNwbGF5X21vZGUKLSBVc2UgZHJtX3BhbmVsX2Rpc2Fi
bGUoKSBpbiAucmVtb3ZlKCkgaGFuZGxlcgotLS0KIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29u
ZmlnICAgICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmls
ZSAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255
LWFjeDU2NWFrbS5jIHwgNzAxICsrKysrKysrKysrKysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwg
NzEwIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vcGFu
ZWwvcGFuZWwtc29ueS1hY3g1NjVha20uYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9w
YW5lbC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL0tjb25maWcKaW5kZXggOGQ5YThj
ZGI3MDRlLi5iMDU2NDliMzExOGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9L
Y29uZmlnCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9LY29uZmlnCkBAIC0zMTYsNiArMzE2
LDE0IEBAIGNvbmZpZyBEUk1fUEFORUxfU0lUUk9OSVhfU1Q3Nzg5VgogCSAgU2F5IFkgaGVyZSBp
ZiB5b3Ugd2FudCB0byBlbmFibGUgc3VwcG9ydCBmb3IgdGhlIFNpdHJvbml4CiAJICBTVDc3ODlW
IGNvbnRyb2xsZXIgZm9yIDI0MHgzMjAgTENEIHBhbmVscwogCitjb25maWcgRFJNX1BBTkVMX1NP
TllfQUNYNTY1QUtNCisJdHJpc3RhdGUgIlNvbnkgQUNYNTY1QUtNIHBhbmVsIgorCWRlcGVuZHMg
b24gR1BJT0xJQiAmJiBPRiAmJiBTUEkKKwlkZXBlbmRzIG9uIEJBQ0tMSUdIVF9DTEFTU19ERVZJ
Q0UKKwloZWxwCisJICBTYXkgWSBoZXJlIGlmIHlvdSB3YW50IHRvIGVuYWJsZSBzdXBwb3J0IGZv
ciB0aGUgU29ueSBBQ1g1NjVBS00KKwkgIDgwMHg2MDAgMy41IiBwYW5lbCAoZm91bmQgb24gdGhl
IE5va2lhIE45MDApLgorCiBjb25maWcgRFJNX1BBTkVMX1RQT19UUEcxMTAKIAl0cmlzdGF0ZSAi
VFBPIFRQRyA4MDB4NDAwIHBhbmVsIgogCWRlcGVuZHMgb24gT0YgJiYgU1BJICYmIEdQSU9MSUIK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5lbC9NYWtlZmlsZQppbmRleCAxNGQxYzQ5ZWYzYWIuLjI4Y2YyMzMyZmQwNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmVsL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5lbC9NYWtlZmlsZQpAQCAtMzMsNSArMzMsNiBAQCBvYmotJChDT05GSUdfRFJNX1BB
TkVMX1NIQVJQX0xTMDM3VjdEVzAxKSArPSBwYW5lbC1zaGFycC1sczAzN3Y3ZHcwMS5vCiBvYmot
JChDT05GSUdfRFJNX1BBTkVMX1NIQVJQX0xTMDQzVDFMRTAxKSArPSBwYW5lbC1zaGFycC1sczA0
M3QxbGUwMS5vCiBvYmotJChDT05GSUdfRFJNX1BBTkVMX1NJVFJPTklYX1NUNzcwMSkgKz0gcGFu
ZWwtc2l0cm9uaXgtc3Q3NzAxLm8KIG9iai0kKENPTkZJR19EUk1fUEFORUxfU0lUUk9OSVhfU1Q3
Nzg5VikgKz0gcGFuZWwtc2l0cm9uaXgtc3Q3Nzg5di5vCitvYmotJChDT05GSUdfRFJNX1BBTkVM
X1NPTllfQUNYNTY1QUtNKSArPSBwYW5lbC1zb255LWFjeDU2NWFrbS5vCiBvYmotJChDT05GSUdf
RFJNX1BBTkVMX1RQT19UUEcxMTApICs9IHBhbmVsLXRwby10cGcxMTAubwogb2JqLSQoQ09ORklH
X0RSTV9QQU5FTF9UUlVMWV9OVDM1NTk3X1dRWEdBKSArPSBwYW5lbC10cnVseS1udDM1NTk3Lm8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5lbC9wYW5lbC1zb255LWFjeDU2NWFrbS5j
IGIvZHJpdmVycy9ncHUvZHJtL3BhbmVsL3BhbmVsLXNvbnktYWN4NTY1YWttLmMKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4yOGQ5MDBkNjBmMmQKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtc29ueS1hY3g1NjVha20uYwpAQCAt
MCwwICsxLDcwMSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKy8qCisg
KiBTb255IEFDWDU2NUFLTSBMQ0QgUGFuZWwgZHJpdmVyCisgKgorICogQ29weXJpZ2h0IChDKSAy
MDE5IFRleGFzIEluc3RydW1lbnRzIEluY29ycG9yYXRlZAorICoKKyAqIEJhc2VkIG9uIHRoZSBv
bWFwZHJtLXNwZWNpZmljIHBhbmVsLXNvbnktYWN4NTY1YWttIGRyaXZlcgorICoKKyAqIENvcHly
aWdodCAoQykgMjAxMCBOb2tpYSBDb3Jwb3JhdGlvbgorICogQXV0aG9yOiBJbXJlIERlYWsgPGlt
cmUuZGVha0Bub2tpYS5jb20+CisgKi8KKworLyoKKyAqIFRPRE8gKHRvIGJlIGFkZHJlc3NlZCB3
aXRoIGhhcmR3YXJlIGFjY2VzcyB0byB0ZXN0IHRoZSBjaGFuZ2VzKToKKyAqCisgKiAtIFVwZGF0
ZSBiYWNrbGlnaHQgc3VwcG9ydCB0byB1c2UgYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMoKSBldGMu
CisgKiAtIFVzZSBwcmVwYXJlL3VucHJlcGFyZSBmb3IgdGhlIGJhc2ljIHBvd2VyIG9uL29mZiBv
ZiB0aGUgYmFja2xpZ3QKKyAqLworCisjaW5jbHVkZSA8bGludXgvYmFja2xpZ2h0Lmg+CisjaW5j
bHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxsaW51eC9ncGlvL2NvbnN1bWVyLmg+Cisj
aW5jbHVkZSA8bGludXgvamlmZmllcy5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L211dGV4Lmg+CisjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KKyNpbmNsdWRl
IDxsaW51eC9zcGkvc3BpLmg+CisjaW5jbHVkZSA8dmlkZW8vbWlwaV9kaXNwbGF5Lmg+CisKKyNp
bmNsdWRlIDxkcm0vZHJtX2Nvbm5lY3Rvci5oPgorI2luY2x1ZGUgPGRybS9kcm1fbW9kZXMuaD4K
KyNpbmNsdWRlIDxkcm0vZHJtX3BhbmVsLmg+CisKKyNkZWZpbmUgQ1RSTF9ESVNQX0JSSUdIVE5F
U1NfQ1RSTF9PTgkJKDEgPDwgNSkKKyNkZWZpbmUgQ1RSTF9ESVNQX0FNQklFTlRfTElHSFRfQ1RS
TF9PTgkJKDEgPDwgNCkKKyNkZWZpbmUgQ1RSTF9ESVNQX0JBQ0tMSUdIVF9PTgkJCSgxIDw8IDIp
CisjZGVmaW5lIENUUkxfRElTUF9BVVRPX0JSSUdIVE5FU1NfT04JCSgxIDw8IDEpCisKKyNkZWZp
bmUgTUlQSURfQ01EX1dSSVRFX0NBQkMJCTB4NTUKKyNkZWZpbmUgTUlQSURfQ01EX1JFQURfQ0FC
QwkJMHg1NgorCisjZGVmaW5lIE1JUElEX1ZFUl9MUEg4OTIzCQkzCisjZGVmaW5lIE1JUElEX1ZF
Ul9MUzA0MVkzCQk0CisjZGVmaW5lIE1JUElEX1ZFUl9MNEYwMDMxMQkJOAorI2RlZmluZSBNSVBJ
RF9WRVJfQUNYNTY1QUtNCQk5CisKK3N0cnVjdCBhY3g1NjVha21fcGFuZWwgeworCXN0cnVjdCBk
cm1fcGFuZWwgcGFuZWw7CisKKwlzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpOworCXN0cnVjdCBncGlv
X2Rlc2MgKnJlc2V0X2dwaW87CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJhY2tsaWdodDsK
KworCXN0cnVjdCBtdXRleCBtdXRleDsKKworCWNvbnN0IGNoYXIgKm5hbWU7CisJdTggZGlzcGxh
eV9pZFszXTsKKwlpbnQgbW9kZWw7CisJaW50IHJldmlzaW9uOworCWJvb2wgaGFzX2JjOworCWJv
b2wgaGFzX2NhYmM7CisKKwlib29sIGVuYWJsZWQ7CisJdW5zaWduZWQgaW50IGNhYmNfbW9kZTsK
KwkvKgorCSAqIE5leHQgdmFsdWUgb2YgamlmZmllcyB3aGVuIHdlIGNhbiBpc3N1ZSB0aGUgbmV4
dCBzbGVlcCBpbi9vdXQKKwkgKiBjb21tYW5kLgorCSAqLworCXVuc2lnbmVkIGxvbmcgaHdfZ3Vh
cmRfZW5kOworCXVuc2lnbmVkIGxvbmcgaHdfZ3VhcmRfd2FpdDsJCS8qIG1heCBndWFyZCB0aW1l
IGluIGppZmZpZXMgKi8KK307CisKKyNkZWZpbmUgdG9fYWN4NTY1YWttX2RldmljZShwKSBjb250
YWluZXJfb2YocCwgc3RydWN0IGFjeDU2NWFrbV9wYW5lbCwgcGFuZWwpCisKK3N0YXRpYyB2b2lk
IGFjeDU2NWFrbV90cmFuc2ZlcihzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QsIGludCBjbWQs
CisJCQkgICAgICBjb25zdCB1OCAqd2J1ZiwgaW50IHdsZW4sIHU4ICpyYnVmLCBpbnQgcmxlbikK
K3sKKwlzdHJ1Y3Qgc3BpX21lc3NhZ2UJbTsKKwlzdHJ1Y3Qgc3BpX3RyYW5zZmVyCSp4LCB4ZmVy
WzVdOworCWludAkJCXJldDsKKworCXNwaV9tZXNzYWdlX2luaXQoJm0pOworCisJbWVtc2V0KHhm
ZXIsIDAsIHNpemVvZih4ZmVyKSk7CisJeCA9ICZ4ZmVyWzBdOworCisJY21kICY9ICAweGZmOwor
CXgtPnR4X2J1ZiA9ICZjbWQ7CisJeC0+Yml0c19wZXJfd29yZCA9IDk7CisJeC0+bGVuID0gMjsK
KworCWlmIChybGVuID4gMSAmJiB3bGVuID09IDApIHsKKwkJLyoKKwkJICogQmV0d2VlbiB0aGUg
Y29tbWFuZCBhbmQgdGhlIHJlc3BvbnNlIGRhdGEgdGhlcmUgaXMgYQorCQkgKiBkdW1teSBjbG9j
ayBjeWNsZS4gQWRkIGFuIGV4dHJhIGJpdCBhZnRlciB0aGUgY29tbWFuZAorCQkgKiB3b3JkIHRv
IGFjY291bnQgZm9yIHRoaXMuCisJCSAqLworCQl4LT5iaXRzX3Blcl93b3JkID0gMTA7CisJCWNt
ZCA8PD0gMTsKKwl9CisJc3BpX21lc3NhZ2VfYWRkX3RhaWwoeCwgJm0pOworCisJaWYgKHdsZW4p
IHsKKwkJeCsrOworCQl4LT50eF9idWYgPSB3YnVmOworCQl4LT5sZW4gPSB3bGVuOworCQl4LT5i
aXRzX3Blcl93b3JkID0gOTsKKwkJc3BpX21lc3NhZ2VfYWRkX3RhaWwoeCwgJm0pOworCX0KKwor
CWlmIChybGVuKSB7CisJCXgrKzsKKwkJeC0+cnhfYnVmCT0gcmJ1ZjsKKwkJeC0+bGVuCQk9IHJs
ZW47CisJCXNwaV9tZXNzYWdlX2FkZF90YWlsKHgsICZtKTsKKwl9CisKKwlyZXQgPSBzcGlfc3lu
YyhsY2QtPnNwaSwgJm0pOworCWlmIChyZXQgPCAwKQorCQlkZXZfZGJnKCZsY2QtPnNwaS0+ZGV2
LCAic3BpX3N5bmMgJWRcbiIsIHJldCk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBhY3g1NjVh
a21fY21kKHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCwgaW50IGNtZCkKK3sKKwlhY3g1NjVh
a21fdHJhbnNmZXIobGNkLCBjbWQsIE5VTEwsIDAsIE5VTEwsIDApOworfQorCitzdGF0aWMgaW5s
aW5lIHZvaWQgYWN4NTY1YWttX3dyaXRlKHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCwKKwkJ
CSAgICAgICBpbnQgcmVnLCBjb25zdCB1OCAqYnVmLCBpbnQgbGVuKQoreworCWFjeDU2NWFrbV90
cmFuc2ZlcihsY2QsIHJlZywgYnVmLCBsZW4sIE5VTEwsIDApOworfQorCitzdGF0aWMgaW5saW5l
IHZvaWQgYWN4NTY1YWttX3JlYWQoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkLAorCQkJICAg
ICAgaW50IHJlZywgdTggKmJ1ZiwgaW50IGxlbikKK3sKKwlhY3g1NjVha21fdHJhbnNmZXIobGNk
LCByZWcsIE5VTEwsIDAsIGJ1ZiwgbGVuKTsKK30KKworLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0K
KyAqIEF1dG8gQnJpZ2h0bmVzcyBDb250cm9sIFZpYSBzeXNmcworICovCisKK3N0YXRpYyB1bnNp
Z25lZCBpbnQgYWN4NTY1YWttX2dldF9jYWJjX21vZGUoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAq
bGNkKQoreworCXJldHVybiBsY2QtPmNhYmNfbW9kZTsKK30KKworc3RhdGljIHZvaWQgYWN4NTY1
YWttX3NldF9jYWJjX21vZGUoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkLAorCQkJCSAgICB1
bnNpZ25lZCBpbnQgbW9kZSkKK3sKKwl1MTYgY2FiY19jdHJsOworCisJbGNkLT5jYWJjX21vZGUg
PSBtb2RlOworCWlmICghbGNkLT5lbmFibGVkKQorCQlyZXR1cm47CisJY2FiY19jdHJsID0gMDsK
KwlhY3g1NjVha21fcmVhZChsY2QsIE1JUElEX0NNRF9SRUFEX0NBQkMsICh1OCAqKSZjYWJjX2N0
cmwsIDEpOworCWNhYmNfY3RybCAmPSB+MzsKKwljYWJjX2N0cmwgfD0gKDEgPDwgOCkgfCAobW9k
ZSAmIDMpOworCWFjeDU2NWFrbV93cml0ZShsY2QsIE1JUElEX0NNRF9XUklURV9DQUJDLCAodTgg
KikmY2FiY19jdHJsLCAyKTsKK30KKworc3RhdGljIHVuc2lnbmVkIGludCBhY3g1NjVha21fZ2V0
X2h3X2NhYmNfbW9kZShzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QpCit7CisJdTggY2FiY19j
dHJsOworCisJYWN4NTY1YWttX3JlYWQobGNkLCBNSVBJRF9DTURfUkVBRF9DQUJDLCAmY2FiY19j
dHJsLCAxKTsKKwlyZXR1cm4gY2FiY19jdHJsICYgMzsKK30KKworc3RhdGljIGNvbnN0IGNoYXIg
KiBjb25zdCBhY3g1NjVha21fY2FiY19tb2Rlc1tdID0geworCSJvZmYiLAkJLyogYWx3YXlzIHVz
ZWQgd2hlbiBDQUJDIGlzIG5vdCBzdXBwb3J0ZWQgKi8KKwkidWkiLAorCSJzdGlsbC1pbWFnZSIs
CisJIm1vdmluZy1pbWFnZSIsCit9OworCitzdGF0aWMgc3NpemVfdCBjYWJjX21vZGVfc2hvdyhz
dHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkgICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwKKwkJCSAgICAgIGNoYXIgKmJ1ZikKK3sKKwlzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2Qg
PSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwljb25zdCBjaGFyICptb2RlX3N0cjsKKwlpbnQgbW9k
ZTsKKworCWlmICghbGNkLT5oYXNfY2FiYykKKwkJbW9kZSA9IDA7CisJZWxzZQorCQltb2RlID0g
YWN4NTY1YWttX2dldF9jYWJjX21vZGUobGNkKTsKKworCW1vZGVfc3RyID0gInVua25vd24iOwor
CWlmIChtb2RlID49IDAgJiYgbW9kZSA8IEFSUkFZX1NJWkUoYWN4NTY1YWttX2NhYmNfbW9kZXMp
KQorCQltb2RlX3N0ciA9IGFjeDU2NWFrbV9jYWJjX21vZGVzW21vZGVdOworCisJcmV0dXJuIHNw
cmludGYoYnVmLCAiJXNcbiIsIG1vZGVfc3RyKTsKK30KKworc3RhdGljIHNzaXplX3QgY2FiY19t
b2RlX3N0b3JlKHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJCSAgICAgICBzdHJ1Y3QgZGV2aWNlX2F0
dHJpYnV0ZSAqYXR0ciwKKwkJCSAgICAgICBjb25zdCBjaGFyICpidWYsIHNpemVfdCBjb3VudCkK
K3sKKwlzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsK
Kwl1bnNpZ25lZCBpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGFjeDU2NWFr
bV9jYWJjX21vZGVzKTsgaSsrKSB7CisJCWNvbnN0IGNoYXIgKm1vZGVfc3RyID0gYWN4NTY1YWtt
X2NhYmNfbW9kZXNbaV07CisJCWludCBjbXBfbGVuID0gc3RybGVuKG1vZGVfc3RyKTsKKworCQlp
ZiAoY291bnQgPiAwICYmIGJ1Zltjb3VudCAtIDFdID09ICdcbicpCisJCQljb3VudC0tOworCQlp
ZiAoY291bnQgIT0gY21wX2xlbikKKwkJCWNvbnRpbnVlOworCisJCWlmIChzdHJuY21wKGJ1Ziwg
bW9kZV9zdHIsIGNtcF9sZW4pID09IDApCisJCQlicmVhazsKKwl9CisKKwlpZiAoaSA9PSBBUlJB
WV9TSVpFKGFjeDU2NWFrbV9jYWJjX21vZGVzKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAo
IWxjZC0+aGFzX2NhYmMgJiYgaSAhPSAwKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCW11dGV4X2xv
Y2soJmxjZC0+bXV0ZXgpOworCWFjeDU2NWFrbV9zZXRfY2FiY19tb2RlKGxjZCwgaSk7CisJbXV0
ZXhfdW5sb2NrKCZsY2QtPm11dGV4KTsKKworCXJldHVybiBjb3VudDsKK30KKworc3RhdGljIHNz
aXplX3QgY2FiY19hdmFpbGFibGVfbW9kZXNfc2hvdyhzdHJ1Y3QgZGV2aWNlICpkZXYsCisJCQkJ
CSBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwKKwkJCQkJIGNoYXIgKmJ1ZikKK3sKKwlz
dHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoZGV2KTsKKwl1bnNp
Z25lZCBpbnQgaTsKKwlzaXplX3QgbGVuID0gMDsKKworCWlmICghbGNkLT5oYXNfY2FiYykKKwkJ
cmV0dXJuIHNwcmludGYoYnVmLCAiJXNcbiIsIGFjeDU2NWFrbV9jYWJjX21vZGVzWzBdKTsKKwor
CWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGFjeDU2NWFrbV9jYWJjX21vZGVzKTsgaSsrKQor
CQlsZW4gKz0gc3ByaW50ZigmYnVmW2xlbl0sICIlcyVzIiwgaSA/ICIgIiA6ICIiLAorCQkJICAg
ICAgIGFjeDU2NWFrbV9jYWJjX21vZGVzW2ldKTsKKworCWJ1ZltsZW4rK10gPSAnXG4nOworCisJ
cmV0dXJuIGxlbjsKK30KKworc3RhdGljIERFVklDRV9BVFRSX1JXKGNhYmNfbW9kZSk7CitzdGF0
aWMgREVWSUNFX0FUVFJfUk8oY2FiY19hdmFpbGFibGVfbW9kZXMpOworCitzdGF0aWMgc3RydWN0
IGF0dHJpYnV0ZSAqYWN4NTY1YWttX2NhYmNfYXR0cnNbXSA9IHsKKwkmZGV2X2F0dHJfY2FiY19t
b2RlLmF0dHIsCisJJmRldl9hdHRyX2NhYmNfYXZhaWxhYmxlX21vZGVzLmF0dHIsCisJTlVMTCwK
K307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIGFjeDU2NWFrbV9jYWJj
X2F0dHJfZ3JvdXAgPSB7CisJLmF0dHJzID0gYWN4NTY1YWttX2NhYmNfYXR0cnMsCit9OworCisv
KiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICogQmFja2xpZ2h0IERldmljZQorICovCisKK3N0YXRp
YyBpbnQgYWN4NTY1YWttX2dldF9hY3R1YWxfYnJpZ2h0bmVzcyhzdHJ1Y3QgYWN4NTY1YWttX3Bh
bmVsICpsY2QpCit7CisJdTggYnY7CisKKwlhY3g1NjVha21fcmVhZChsY2QsIE1JUElfRENTX0dF
VF9ESVNQTEFZX0JSSUdIVE5FU1MsICZidiwgMSk7CisKKwlyZXR1cm4gYnY7Cit9CisKK3N0YXRp
YyB2b2lkIGFjeDU2NWFrbV9zZXRfYnJpZ2h0bmVzcyhzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICps
Y2QsIGludCBsZXZlbCkKK3sKKwl1MTYgY3RybDsKKwlpbnQgYnY7CisKKwlidiA9IGxldmVsIHwg
KDEgPDwgOCk7CisJYWN4NTY1YWttX3dyaXRlKGxjZCwgTUlQSV9EQ1NfU0VUX0RJU1BMQVlfQlJJ
R0hUTkVTUywgKHU4ICopJmJ2LCAyKTsKKworCWFjeDU2NWFrbV9yZWFkKGxjZCwgTUlQSV9EQ1Nf
R0VUX0NPTlRST0xfRElTUExBWSwgKHU4ICopJmN0cmwsIDEpOworCWlmIChsZXZlbCkKKwkJY3Ry
bCB8PSBDVFJMX0RJU1BfQlJJR0hUTkVTU19DVFJMX09OIHwKKwkJCUNUUkxfRElTUF9CQUNLTElH
SFRfT047CisJZWxzZQorCQljdHJsICY9IH4oQ1RSTF9ESVNQX0JSSUdIVE5FU1NfQ1RSTF9PTiB8
CisJCQkgIENUUkxfRElTUF9CQUNLTElHSFRfT04pOworCisJY3RybCB8PSAxIDw8IDg7CisJYWN4
NTY1YWttX3dyaXRlKGxjZCwgTUlQSV9EQ1NfV1JJVEVfQ09OVFJPTF9ESVNQTEFZLCAodTggKikm
Y3RybCwgMik7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1YWttX2JsX3VwZGF0ZV9zdGF0dXNfbG9j
a2VkKHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGFjeDU2NWFrbV9w
YW5lbCAqbGNkID0gZGV2X2dldF9kcnZkYXRhKCZkZXYtPmRldik7CisJaW50IGxldmVsOworCisJ
aWYgKGRldi0+cHJvcHMuZmJfYmxhbmsgPT0gRkJfQkxBTktfVU5CTEFOSyAmJgorCSAgICBkZXYt
PnByb3BzLnBvd2VyID09IEZCX0JMQU5LX1VOQkxBTkspCisJCWxldmVsID0gZGV2LT5wcm9wcy5i
cmlnaHRuZXNzOworCWVsc2UKKwkJbGV2ZWwgPSAwOworCisJYWN4NTY1YWttX3NldF9icmlnaHRu
ZXNzKGxjZCwgbGV2ZWwpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1YWtt
X2JsX3VwZGF0ZV9zdGF0dXMoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmRldikKK3sKKwlzdHJ1
Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoJmRldi0+ZGV2KTsKKwlp
bnQgcmV0OworCisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisJcmV0ID0gYWN4NTY1YWttX2Js
X3VwZGF0ZV9zdGF0dXNfbG9ja2VkKGRldik7CisJbXV0ZXhfdW5sb2NrKCZsY2QtPm11dGV4KTsK
KworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgYWN4NTY1YWttX2JsX2dldF9pbnRlbnNp
dHkoc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmRldikKK3sKKwlzdHJ1Y3QgYWN4NTY1YWttX3Bh
bmVsICpsY2QgPSBkZXZfZ2V0X2RydmRhdGEoJmRldi0+ZGV2KTsKKwl1bnNpZ25lZCBpbnQgaW50
ZW5zaXR5OworCisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisKKwlpZiAoZGV2LT5wcm9wcy5m
Yl9ibGFuayA9PSBGQl9CTEFOS19VTkJMQU5LICYmCisJICAgIGRldi0+cHJvcHMucG93ZXIgPT0g
RkJfQkxBTktfVU5CTEFOSykKKwkJaW50ZW5zaXR5ID0gYWN4NTY1YWttX2dldF9hY3R1YWxfYnJp
Z2h0bmVzcyhsY2QpOworCWVsc2UKKwkJaW50ZW5zaXR5ID0gMDsKKworCW11dGV4X3VubG9jaygm
bGNkLT5tdXRleCk7CisKKwlyZXR1cm4gaW50ZW5zaXR5OworfQorCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGJhY2tsaWdodF9vcHMgYWN4NTY1YWttX2JsX29wcyA9IHsKKwkuZ2V0X2JyaWdodG5lc3Mg
PSBhY3g1NjVha21fYmxfZ2V0X2ludGVuc2l0eSwKKwkudXBkYXRlX3N0YXR1cyAgPSBhY3g1NjVh
a21fYmxfdXBkYXRlX3N0YXR1cywKK307CisKK3N0YXRpYyBpbnQgYWN4NTY1YWttX2JhY2tsaWdo
dF9pbml0KHN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCkKK3sKKwlzdHJ1Y3QgYmFja2xpZ2h0
X3Byb3BlcnRpZXMgcHJvcHMgPSB7CisJCS5mYl9ibGFuayA9IEZCX0JMQU5LX1VOQkxBTkssCisJ
CS5wb3dlciA9IEZCX0JMQU5LX1VOQkxBTkssCisJCS50eXBlID0gQkFDS0xJR0hUX1JBVywKKwl9
OworCWludCByZXQ7CisKKwlsY2QtPmJhY2tsaWdodCA9IGJhY2tsaWdodF9kZXZpY2VfcmVnaXN0
ZXIobGNkLT5uYW1lLCAmbGNkLT5zcGktPmRldiwKKwkJCQkJCSAgIGxjZCwgJmFjeDU2NWFrbV9i
bF9vcHMsCisJCQkJCQkgICAmcHJvcHMpOworCWlmIChJU19FUlIobGNkLT5iYWNrbGlnaHQpKSB7
CisJCXJldCA9IFBUUl9FUlIobGNkLT5iYWNrbGlnaHQpOworCQlsY2QtPmJhY2tsaWdodCA9IE5V
TEw7CisJCXJldHVybiByZXQ7CisJfQorCisJaWYgKGxjZC0+aGFzX2NhYmMpIHsKKwkJcmV0ID0g
c3lzZnNfY3JlYXRlX2dyb3VwKCZsY2QtPmJhY2tsaWdodC0+ZGV2LmtvYmosCisJCQkJCSAmYWN4
NTY1YWttX2NhYmNfYXR0cl9ncm91cCk7CisJCWlmIChyZXQgPCAwKSB7CisJCQlkZXZfZXJyKCZs
Y2QtPnNwaS0+ZGV2LAorCQkJCSIlcyBmYWlsZWQgdG8gY3JlYXRlIHN5c2ZzIGZpbGVzXG4iLCBf
X2Z1bmNfXyk7CisJCQliYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIobGNkLT5iYWNrbGlnaHQp
OworCQkJcmV0dXJuIHJldDsKKwkJfQorCisJCWxjZC0+Y2FiY19tb2RlID0gYWN4NTY1YWttX2dl
dF9od19jYWJjX21vZGUobGNkKTsKKwl9CisKKwlsY2QtPmJhY2tsaWdodC0+cHJvcHMubWF4X2Jy
aWdodG5lc3MgPSAyNTU7CisJbGNkLT5iYWNrbGlnaHQtPnByb3BzLmJyaWdodG5lc3MgPSBhY3g1
NjVha21fZ2V0X2FjdHVhbF9icmlnaHRuZXNzKGxjZCk7CisKKwlhY3g1NjVha21fYmxfdXBkYXRl
X3N0YXR1c19sb2NrZWQobGNkLT5iYWNrbGlnaHQpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyB2b2lkIGFjeDU2NWFrbV9iYWNrbGlnaHRfY2xlYW51cChzdHJ1Y3QgYWN4NTY1YWttX3BhbmVs
ICpsY2QpCit7CisJaWYgKGxjZC0+aGFzX2NhYmMpCisJCXN5c2ZzX3JlbW92ZV9ncm91cCgmbGNk
LT5iYWNrbGlnaHQtPmRldi5rb2JqLAorCQkJCSAgICZhY3g1NjVha21fY2FiY19hdHRyX2dyb3Vw
KTsKKworCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdpc3RlcihsY2QtPmJhY2tsaWdodCk7Cit9CisK
Ky8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBEUk0gQnJpZGdlIE9wZXJhdGlvbnMKKyAqLwor
CitzdGF0aWMgdm9pZCBhY3g1NjVha21fc2V0X3NsZWVwX21vZGUoc3RydWN0IGFjeDU2NWFrbV9w
YW5lbCAqbGNkLCBpbnQgb24pCit7CisJaW50IGNtZCA9IG9uID8gTUlQSV9EQ1NfRU5URVJfU0xF
RVBfTU9ERSA6IE1JUElfRENTX0VYSVRfU0xFRVBfTU9ERTsKKwl1bnNpZ25lZCBsb25nIHdhaXQ7
CisKKwkvKgorCSAqIFdlIGhhdmUgdG8ga2VlcCAxMjBtc2VjIGJldHdlZW4gc2xlZXAgaW4vb3V0
IGNvbW1hbmRzLgorCSAqICg4LjIuMTUsIDguMi4xNikuCisJICovCisJd2FpdCA9IGxjZC0+aHdf
Z3VhcmRfZW5kIC0gamlmZmllczsKKwlpZiAoKGxvbmcpd2FpdCA+IDAgJiYgd2FpdCA8PSBsY2Qt
Pmh3X2d1YXJkX3dhaXQpIHsKKwkJc2V0X2N1cnJlbnRfc3RhdGUoVEFTS19VTklOVEVSUlVQVElC
TEUpOworCQlzY2hlZHVsZV90aW1lb3V0KHdhaXQpOworCX0KKworCWFjeDU2NWFrbV9jbWQobGNk
LCBjbWQpOworCisJbGNkLT5od19ndWFyZF93YWl0ID0gbXNlY3NfdG9famlmZmllcygxMjApOwor
CWxjZC0+aHdfZ3VhcmRfZW5kID0gamlmZmllcyArIGxjZC0+aHdfZ3VhcmRfd2FpdDsKK30KKwor
c3RhdGljIHZvaWQgYWN4NTY1YWttX3NldF9kaXNwbGF5X3N0YXRlKHN0cnVjdCBhY3g1NjVha21f
cGFuZWwgKmxjZCwKKwkJCQkJaW50IGVuYWJsZWQpCit7CisJaW50IGNtZCA9IGVuYWJsZWQgPyBN
SVBJX0RDU19TRVRfRElTUExBWV9PTiA6IE1JUElfRENTX1NFVF9ESVNQTEFZX09GRjsKKworCWFj
eDU2NWFrbV9jbWQobGNkLCBjbWQpOworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9wb3dlcl9v
bihzdHJ1Y3QgYWN4NTY1YWttX3BhbmVsICpsY2QpCit7CisJLypGSVhNRSB0d2VhayBtZSAqLwor
CW1zbGVlcCg1MCk7CisKKwlncGlvZF9zZXRfdmFsdWUobGNkLT5yZXNldF9ncGlvLCAxKTsKKwor
CWlmIChsY2QtPmVuYWJsZWQpIHsKKwkJZGV2X2RiZygmbGNkLT5zcGktPmRldiwgInBhbmVsIGFs
cmVhZHkgZW5hYmxlZFxuIik7CisJCXJldHVybiAwOworCX0KKworCS8qCisJICogV2UgaGF2ZSB0
byBtZWV0IGFsbCB0aGUgZm9sbG93aW5nIGRlbGF5IHJlcXVpcmVtZW50czoKKwkgKiAxLiB0Ulc6
IHJlc2V0IHB1bHNlIHdpZHRoIDEwdXNlYyAoNy4xMi4xKQorCSAqIDIuIHRSVDogcmVzZXQgY2Fu
Y2VsIHRpbWUgNW1zZWMgKDcuMTIuMSkKKwkgKiAzLiBQcm92aWRpbmcgUENMSyxIUyxWUyBzaWdu
YWxzIGZvciAyIGZyYW1lcyA9IH41MG1zZWMgd29yc3QKKwkgKiAgICBjYXNlICg3LjYuMikKKwkg
KiA0LiAxMjBtc2VjIGJlZm9yZSB0aGUgc2xlZXAgb3V0IGNvbW1hbmQgKDcuMTIuMSkKKwkgKi8K
Kwltc2xlZXAoMTIwKTsKKworCWFjeDU2NWFrbV9zZXRfc2xlZXBfbW9kZShsY2QsIDApOworCWxj
ZC0+ZW5hYmxlZCA9IHRydWU7CisKKwkvKiA1bXNlYyBiZXR3ZWVuIHNsZWVwIG91dCBhbmQgdGhl
IG5leHQgY29tbWFuZC4gKDguMi4xNikgKi8KKwl1c2xlZXBfcmFuZ2UoNTAwMCwgMTAwMDApOwor
CWFjeDU2NWFrbV9zZXRfZGlzcGxheV9zdGF0ZShsY2QsIDEpOworCWFjeDU2NWFrbV9zZXRfY2Fi
Y19tb2RlKGxjZCwgbGNkLT5jYWJjX21vZGUpOworCisJcmV0dXJuIGFjeDU2NWFrbV9ibF91cGRh
dGVfc3RhdHVzX2xvY2tlZChsY2QtPmJhY2tsaWdodCk7Cit9CisKK3N0YXRpYyB2b2lkIGFjeDU2
NWFrbV9wb3dlcl9vZmYoc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAqbGNkKQoreworCWlmICghbGNk
LT5lbmFibGVkKQorCQlyZXR1cm47CisKKwlhY3g1NjVha21fc2V0X2Rpc3BsYXlfc3RhdGUobGNk
LCAwKTsKKwlhY3g1NjVha21fc2V0X3NsZWVwX21vZGUobGNkLCAxKTsKKwlsY2QtPmVuYWJsZWQg
PSBmYWxzZTsKKwkvKgorCSAqIFdlIGhhdmUgdG8gcHJvdmlkZSBQQ0xLLEhTLFZTIHNpZ25hbHMg
Zm9yIDIgZnJhbWVzICh3b3JzdCBjYXNlCisJICogfjUwbXNlYykgYWZ0ZXIgc2VuZGluZyB0aGUg
c2xlZXAgaW4gY29tbWFuZCBhbmQgYXNzZXJ0aW5nIHRoZQorCSAqIHJlc2V0IHNpZ25hbC4gV2Ug
cHJvYmFibHkgY291bGQgYXNzZXJ0IHRoZSByZXNldCB3L28gdGhlIGRlbGF5CisJICogYnV0IHdl
IHN0aWxsIGRlbGF5IHRvIGF2b2lkIHBvc3NpYmxlIGFydGlmYWN0cy4gKDcuNi4xKQorCSAqLwor
CW1zbGVlcCg1MCk7CisKKwlncGlvZF9zZXRfdmFsdWUobGNkLT5yZXNldF9ncGlvLCAwKTsKKwor
CS8qIEZJWE1FIG5lZWQgdG8gdHdlYWsgdGhpcyBkZWxheSAqLworCW1zbGVlcCgxMDApOworfQor
CitzdGF0aWMgaW50IGFjeDU2NWFrbV9kaXNhYmxlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQor
eworCXN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCA9IHRvX2FjeDU2NWFrbV9kZXZpY2UocGFu
ZWwpOworCisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisJYWN4NTY1YWttX3Bvd2VyX29mZihs
Y2QpOworCW11dGV4X3VubG9jaygmbGNkLT5tdXRleCk7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBhY3g1NjVha21fZW5hYmxlKHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsKQoreworCXN0
cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZCA9IHRvX2FjeDU2NWFrbV9kZXZpY2UocGFuZWwpOwor
CisJbXV0ZXhfbG9jaygmbGNkLT5tdXRleCk7CisJYWN4NTY1YWttX3Bvd2VyX29uKGxjZCk7CisJ
bXV0ZXhfdW5sb2NrKCZsY2QtPm11dGV4KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgYWN4NTY1YWttX21vZGUgPSB7CisJLmNsb2NrID0g
MjQwMDAsCisJLmhkaXNwbGF5ID0gODAwLAorCS5oc3luY19zdGFydCA9IDgwMCArIDI4LAorCS5o
c3luY19lbmQgPSA4MDAgKyAyOCArIDQsCisJLmh0b3RhbCA9IDgwMCArIDI4ICsgNCArIDI0LAor
CS52ZGlzcGxheSA9IDQ4MCwKKwkudnN5bmNfc3RhcnQgPSA0ODAgKyAzLAorCS52c3luY19lbmQg
PSA0ODAgKyAzICsgMywKKwkudnRvdGFsID0gNDgwICsgMyArIDMgKyA0LAorCS52cmVmcmVzaCA9
IDU3LAorCS50eXBlID0gRFJNX01PREVfVFlQRV9EUklWRVIgfCBEUk1fTU9ERV9UWVBFX1BSRUZF
UlJFRCwKKwkuZmxhZ3MgPSBEUk1fTU9ERV9GTEFHX05IU1lOQyB8IERSTV9NT0RFX0ZMQUdfTlZT
WU5DLAorCS53aWR0aF9tbSA9IDc3LAorCS5oZWlnaHRfbW0gPSA0NiwKK307CisKK3N0YXRpYyBp
bnQgYWN4NTY1YWttX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbCkKK3sKKwlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gcGFuZWwtPmNvbm5lY3RvcjsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKKworCW1vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUocGFu
ZWwtPmRybSwgJmFjeDU2NWFrbV9tb2RlKTsKKwlpZiAoIW1vZGUpCisJCXJldHVybiAtRU5PTUVN
OworCisJZHJtX21vZGVfc2V0X25hbWUobW9kZSk7CisJZHJtX21vZGVfcHJvYmVkX2FkZChjb25u
ZWN0b3IsIG1vZGUpOworCisJY29ubmVjdG9yLT5kaXNwbGF5X2luZm8ud2lkdGhfbW0gPSBhY3g1
NjVha21fbW9kZS53aWR0aF9tbTsKKwljb25uZWN0b3ItPmRpc3BsYXlfaW5mby5oZWlnaHRfbW0g
PSBhY3g1NjVha21fbW9kZS5oZWlnaHRfbW07CisJY29ubmVjdG9yLT5kaXNwbGF5X2luZm8uYnVz
X2ZsYWdzID0gRFJNX0JVU19GTEFHX0RFX0hJR0gKKwkJCQkJICB8IERSTV9CVVNfRkxBR19TWU5D
X1NBTVBMRV9QT1NFREdFCisJCQkJCSAgfCBEUk1fQlVTX0ZMQUdfUElYREFUQV9TQU1QTEVfTkVH
RURHRTsKKworCXJldHVybiAxOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wYW5lbF9m
dW5jcyBhY3g1NjVha21fZnVuY3MgPSB7CisJLmRpc2FibGUgPSBhY3g1NjVha21fZGlzYWJsZSwK
KwkuZW5hYmxlID0gYWN4NTY1YWttX2VuYWJsZSwKKwkuZ2V0X21vZGVzID0gYWN4NTY1YWttX2dl
dF9tb2RlcywKK307CisKKy8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKiBQcm9iZSwgRGV0ZWN0
IGFuZCBSZW1vdmUKKyAqLworCitzdGF0aWMgaW50IGFjeDU2NWFrbV9kZXRlY3Qoc3RydWN0IGFj
eDU2NWFrbV9wYW5lbCAqbGNkKQoreworCV9fYmUzMiB2YWx1ZTsKKwl1MzIgc3RhdHVzOworCWlu
dCByZXQgPSAwOworCisJLyoKKwkgKiBBZnRlciBiZWluZyB0YWtlbiBvdXQgb2YgcmVzZXQgdGhl
IHBhbmVsIG5lZWRzIDVtcyBiZWZvcmUgdGhlIGZpcnN0CisJICogY29tbWFuZCBjYW4gYmUgc2Vu
dC4KKwkgKi8KKwlncGlvZF9zZXRfdmFsdWUobGNkLT5yZXNldF9ncGlvLCAxKTsKKwl1c2xlZXBf
cmFuZ2UoNTAwMCwgMTAwMDApOworCisJYWN4NTY1YWttX3JlYWQobGNkLCBNSVBJX0RDU19HRVRf
RElTUExBWV9TVEFUVVMsICh1OCAqKSZ2YWx1ZSwgNCk7CisJc3RhdHVzID0gX19iZTMyX3RvX2Nw
dSh2YWx1ZSk7CisJbGNkLT5lbmFibGVkID0gKHN0YXR1cyAmICgxIDw8IDE3KSkgJiYgKHN0YXR1
cyAmICgxIDw8IDEwKSk7CisKKwlkZXZfZGJnKCZsY2QtPnNwaS0+ZGV2LAorCQkiTENEIHBhbmVs
ICVzIGJ5IGJvb3Rsb2FkZXIgKHN0YXR1cyAweCUwNHgpXG4iLAorCQlsY2QtPmVuYWJsZWQgPyAi
ZW5hYmxlZCIgOiAiZGlzYWJsZWQgIiwgc3RhdHVzKTsKKworCWFjeDU2NWFrbV9yZWFkKGxjZCwg
TUlQSV9EQ1NfR0VUX0RJU1BMQVlfSUQsIGxjZC0+ZGlzcGxheV9pZCwgMyk7CisJZGV2X2RiZygm
bGNkLT5zcGktPmRldiwgIk1JUEkgZGlzcGxheSBJRDogJTAyeCUwMnglMDJ4XG4iLAorCQlsY2Qt
PmRpc3BsYXlfaWRbMF0sIGxjZC0+ZGlzcGxheV9pZFsxXSwgbGNkLT5kaXNwbGF5X2lkWzJdKTsK
KworCXN3aXRjaCAobGNkLT5kaXNwbGF5X2lkWzBdKSB7CisJY2FzZSAweDEwOgorCQlsY2QtPm1v
ZGVsID0gTUlQSURfVkVSX0FDWDU2NUFLTTsKKwkJbGNkLT5uYW1lID0gImFjeDU2NWFrbSI7CisJ
CWxjZC0+aGFzX2JjID0gMTsKKwkJbGNkLT5oYXNfY2FiYyA9IDE7CisJCWJyZWFrOworCWNhc2Ug
MHgyOToKKwkJbGNkLT5tb2RlbCA9IE1JUElEX1ZFUl9MNEYwMDMxMTsKKwkJbGNkLT5uYW1lID0g
Imw0ZjAwMzExIjsKKwkJYnJlYWs7CisJY2FzZSAweDQ1OgorCQlsY2QtPm1vZGVsID0gTUlQSURf
VkVSX0xQSDg5MjM7CisJCWxjZC0+bmFtZSA9ICJscGg4OTIzIjsKKwkJYnJlYWs7CisJY2FzZSAw
eDgzOgorCQlsY2QtPm1vZGVsID0gTUlQSURfVkVSX0xTMDQxWTM7CisJCWxjZC0+bmFtZSA9ICJs
czA0MXkzIjsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJbGNkLT5uYW1lID0gInVua25vd24iOwor
CQlkZXZfZXJyKCZsY2QtPnNwaS0+ZGV2LCAidW5rbm93biBkaXNwbGF5IElEXG4iKTsKKwkJcmV0
ID0gLUVOT0RFVjsKKwkJZ290byBkb25lOworCX0KKworCWxjZC0+cmV2aXNpb24gPSBsY2QtPmRp
c3BsYXlfaWRbMV07CisKKwlkZXZfaW5mbygmbGNkLT5zcGktPmRldiwgIiVzIHJldiAlMDJ4IHBh
bmVsIGRldGVjdGVkXG4iLAorCQkgbGNkLT5uYW1lLCBsY2QtPnJldmlzaW9uKTsKKworZG9uZToK
KwlpZiAoIWxjZC0+ZW5hYmxlZCkKKwkJZ3Bpb2Rfc2V0X3ZhbHVlKGxjZC0+cmVzZXRfZ3Bpbywg
MCk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGFjeDU2NWFrbV9wcm9iZShzdHJ1
Y3Qgc3BpX2RldmljZSAqc3BpKQoreworCXN0cnVjdCBhY3g1NjVha21fcGFuZWwgKmxjZDsKKwlp
bnQgcmV0OworCisJbGNkID0gZGV2bV9remFsbG9jKCZzcGktPmRldiwgc2l6ZW9mKCpsY2QpLCBH
RlBfS0VSTkVMKTsKKwlpZiAobGNkID09IE5VTEwpCisJCXJldHVybiAtRU5PTUVNOworCisJc3Bp
X3NldF9kcnZkYXRhKHNwaSwgbGNkKTsKKwlzcGktPm1vZGUgPSBTUElfTU9ERV8zOworCisJbGNk
LT5zcGkgPSBzcGk7CisJbXV0ZXhfaW5pdCgmbGNkLT5tdXRleCk7CisKKwlsY2QtPnJlc2V0X2dw
aW8gPSBkZXZtX2dwaW9kX2dldCgmc3BpLT5kZXYsICJyZXNldCIsIEdQSU9EX09VVF9MT1cpOwor
CWlmIChJU19FUlIobGNkLT5yZXNldF9ncGlvKSkgeworCQlkZXZfZXJyKCZzcGktPmRldiwgImZh
aWxlZCB0byBnZXQgcmVzZXQgR1BJT1xuIik7CisJCXJldHVybiBQVFJfRVJSKGxjZC0+cmVzZXRf
Z3Bpbyk7CisJfQorCisJcmV0ID0gYWN4NTY1YWttX2RldGVjdChsY2QpOworCWlmIChyZXQgPCAw
KSB7CisJCWRldl9lcnIoJnNwaS0+ZGV2LCAicGFuZWwgZGV0ZWN0aW9uIGZhaWxlZFxuIik7CisJ
CXJldHVybiByZXQ7CisJfQorCisJaWYgKGxjZC0+aGFzX2JjKSB7CisJCXJldCA9IGFjeDU2NWFr
bV9iYWNrbGlnaHRfaW5pdChsY2QpOworCQlpZiAocmV0IDwgMCkKKwkJCXJldHVybiByZXQ7CisJ
fQorCisJZHJtX3BhbmVsX2luaXQoJmxjZC0+cGFuZWwpOworCWxjZC0+cGFuZWwuZGV2ID0gJmxj
ZC0+c3BpLT5kZXY7CisJbGNkLT5wYW5lbC5mdW5jcyA9ICZhY3g1NjVha21fZnVuY3M7CisKKwly
ZXQgPSBkcm1fcGFuZWxfYWRkKCZsY2QtPnBhbmVsKTsKKwlpZiAocmV0IDwgMCkgeworCQlpZiAo
bGNkLT5oYXNfYmMpCisJCQlhY3g1NjVha21fYmFja2xpZ2h0X2NsZWFudXAobGNkKTsKKwkJcmV0
dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBhY3g1NjVha21fcmVt
b3ZlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCit7CisJc3RydWN0IGFjeDU2NWFrbV9wYW5lbCAq
bGNkID0gc3BpX2dldF9kcnZkYXRhKHNwaSk7CisKKwlkcm1fcGFuZWxfcmVtb3ZlKCZsY2QtPnBh
bmVsKTsKKworCWlmIChsY2QtPmhhc19iYykKKwkJYWN4NTY1YWttX2JhY2tsaWdodF9jbGVhbnVw
KGxjZCk7CisKKwlkcm1fcGFuZWxfZGlzYWJsZSgmbGNkLT5wYW5lbCk7CisJZHJtX3BhbmVsX3Vu
cHJlcGFyZSgmbGNkLT5wYW5lbCk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBvZl9kZXZpY2VfaWQgYWN4NTY1YWttX29mX21hdGNoW10gPSB7CisJeyAuY29tcGF0aWJs
ZSA9ICJzb255LGFjeDU2NWFrbSIsIH0sCisJeyAvKiBzZW50aW5lbCAqLyB9LAorfTsKKworTU9E
VUxFX0RFVklDRV9UQUJMRShvZiwgYWN4NTY1YWttX29mX21hdGNoKTsKKworc3RhdGljIHN0cnVj
dCBzcGlfZHJpdmVyIGFjeDU2NWFrbV9kcml2ZXIgPSB7CisJLnByb2JlCQk9IGFjeDU2NWFrbV9w
cm9iZSwKKwkucmVtb3ZlCQk9IGFjeDU2NWFrbV9yZW1vdmUsCisJLmRyaXZlcgkJPSB7CisJCS5u
YW1lCT0gInBhbmVsLXNvbnktYWN4NTY1YWttIiwKKwkJLm9mX21hdGNoX3RhYmxlID0gYWN4NTY1
YWttX29mX21hdGNoLAorCX0sCit9OworCittb2R1bGVfc3BpX2RyaXZlcihhY3g1NjVha21fZHJp
dmVyKTsKKworTU9EVUxFX0FMSUFTKCJzcGk6c29ueSxhY3g1NjVha20iKTsKK01PRFVMRV9BVVRI
T1IoIk5va2lhIENvcnBvcmF0aW9uIik7CitNT0RVTEVfREVTQ1JJUFRJT04oIlNvbnkgQUNYNTY1
QUtNIExDRCBQYW5lbCBEcml2ZXIiKTsKK01PRFVMRV9MSUNFTlNFKCJHUEwiKTsKLS0gClJlZ2Fy
ZHMsCgpMYXVyZW50IFBpbmNoYXJ0CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWw=
