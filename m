Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id DC0328DD66
	for <lists+dri-devel@lfdr.de>; Wed, 14 Aug 2019 20:48:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB8786E7D6;
	Wed, 14 Aug 2019 18:48:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x644.google.com (mail-pl1-x644.google.com
 [IPv6:2607:f8b0:4864:20::644])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0DFB56E802
 for <dri-devel@lists.freedesktop.org>; Wed, 14 Aug 2019 18:47:49 +0000 (UTC)
Received: by mail-pl1-x644.google.com with SMTP id 4so44065179pld.10
 for <dri-devel@lists.freedesktop.org>; Wed, 14 Aug 2019 11:47:49 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=BM6japHtNosu612QM3iXbsmNmPuxWQL1sToNVcdmCkY=;
 b=oqxTmAV5WxOBVaEEmdVyxk5XsQpEFXabX8dUDuIGU+0L+8CeuiYTfubMk5Y+eTZFRd
 tm4vkgB9OsSC9DFwa+lCLX3eyjDWIxLpGNIxe2I3ssqLmyejWCHLhWMQ5IMsy27q59ff
 WWsp+VQSTCvjw7o142NZ5K7V5eqvSWKAy4MP6TluREQyhRJ5xQ+aYCndruf8np6ALhKQ
 S94do6+s7kSzHO46QisMciFXwupLR9g72n83Wh5gl1B7qmk2S5IMdi1YibSQh3DMc4XH
 JZNQOA3iyv7024oIGuCAVTVXEJb+QAbpSSrQzSYkt9c9UHNOEk/xL1Mmn+/QC6r9dPWR
 ogZQ==
X-Gm-Message-State: APjAAAVaFWA8EXxZJgg0yjjsrmnEKQ0yWMq4XZaSJw5E081FaOFTRK8C
 l7cceHByWflNzUt+5a+//ivWIQ==
X-Google-Smtp-Source: APXvYqwbaB7LUn/FgZ0iMUdFPU/7V2ugfwRyQ9avlRChogLRQEo88iupMMV/3WbAl7SvE0OBH/K1OQ==
X-Received: by 2002:a17:902:1e6:: with SMTP id
 b93mr727597plb.295.1565808466769; 
 Wed, 14 Aug 2019 11:47:46 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 y16sm610855pfc.36.2019.08.14.11.47.45
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Wed, 14 Aug 2019 11:47:46 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RESEND][PATCH v3 26/26] drm: kirin: Move ade drm init to kirin drm
 drv
Date: Wed, 14 Aug 2019 18:47:02 +0000
Message-Id: <20190814184702.54275-27-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190814184702.54275-1-john.stultz@linaro.org>
References: <20190814184702.54275-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=BM6japHtNosu612QM3iXbsmNmPuxWQL1sToNVcdmCkY=;
 b=VCeSzqLmUL1WjtpIM6CEJtF0/NzzB5tDrFv2RJC9BrlxKlMumoygw7h/DJHcFX2ftM
 6Fl/GKjsThMBeEAqqmJmsL9UQz/Vvp2jXugm+GmnDowOzBMZVusvjssmDz98H2F7CMRc
 2bmhcfZE0rSe07/s20hP+6MRXc/iOPwedjh1cJyG4I2vTeitmGUhFTRzn/nlBlu78g+0
 zujrorPWvGAnd8SJ+lZ57fDx53gjGVlRd9jdT9/VUUt3/4U5MqkyNH5MatUGzeugB+50
 0BLdy0pu6jM7H13gmYDuUjSVridhWengvSInhrfPaUn6ktLAUhNBx2Xv7Keqszl1hYHt
 awGw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Xu YiPing <xuyiping@hisilicon.com>, David Airlie <airlied@linux.ie>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Rongrong Zou <zourongrong@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWHUgWWlQaW5nIDx4dXlpcGluZ0BoaXNpbGljb24uY29tPgoKQXMgcGFydCBvZiByZWZh
Y3RvcmluZyB0aGUga2lyaW4gZHJpdmVyIHRvIGJldHRlciBzdXBwb3J0CmRpZmZlcmVudCBoYXJk
d2FyZSByZXZpc2lvbnMsIHRoaXMgcGF0Y2ggcmVuYW1lcyBhZGVfZGF0YSB0bwpraXJpbl9kcm1f
cHJpdmF0ZSwgYW5kIG1vdmVzIGNydGNfaW5pdCBhbmQgcGxhbmVfaW5pdCB0bwpraXJpbiBkcm0g
ZHJ2IHRvby4gTm93IHRoYXQgdGhleSBhcmUgZ2VuZXJpYyB0aGUgZnVuY3Rpb25zCmNhbiBiZSBz
aGFyZWQgYmV0d2VlbiB0aGUga2lyaW42MjAgYW5kICh0byBiZSBhZGRlZCBsYXRlcikKa2lyaW45
NjAgc3BlY2lmaWMgc3VwcG9ydCBjb2RlLgoKQ2M6IFJvbmdyb25nIFpvdSA8em91cm9uZ3JvbmdA
Z21haWwuY29tPgpDYzogWGlubGlhbmcgTGl1IDx6LmxpdXhpbmxpYW5nQGhpc2lsaWNvbi5jb20+
CkNjOiBEYXZpZCBBaXJsaWUgPGFpcmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWxAZmZ3bGwuY2g+CkNjOiBkcmktZGV2ZWwgPGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmc+CkNjOiBTYW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+ClJldmlld2VkLWJ5OiBT
YW0gUmF2bmJvcmcgPHNhbUByYXZuYm9yZy5vcmc+ClNpZ25lZC1vZmYtYnk6IFh1IFlpUGluZyA8
eHV5aXBpbmdAaGlzaWxpY29uLmNvbT4KW2pzdHVsdHo6IFJld29yZGVkIGNvbW1pdCBtZXNzYWdl
XQpTaWduZWQtb2ZmLWJ5OiBKb2huIFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9yZz4KLS0t
CiAuLi4vZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5jICAgfCAxMjMgLS0t
LS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5j
ICAgfCAxNDEgKysrKysrKysrKysrKysrKy0tCiAuLi4vZ3B1L2RybS9oaXNpbGljb24va2lyaW4v
a2lyaW5fZHJtX2Rydi5oICAgfCAgIDUgLQogMyBmaWxlcyBjaGFuZ2VkLCAxMjkgaW5zZXJ0aW9u
cygrKSwgMTQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5jIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9r
aXJpbi9raXJpbl9kcm1fYWRlLmMKaW5kZXggYWIwYzVkMDM5MDNkLi40MjgyMDZlY2NmYTAgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2FkZS5jCkBA
IC01MywxMyArNTMsNiBAQCBzdHJ1Y3QgYWRlX2h3X2N0eCB7CiAJc3RydWN0IGRybV9jcnRjICpj
cnRjOwogfTsKIAotc3RydWN0IGFkZV9kYXRhIHsKLQlzdHJ1Y3Qga2lyaW5fY3J0YyBjcnRjOwot
CXN0cnVjdCBraXJpbl9wbGFuZSBwbGFuZXNbQURFX0NIX05VTV07Ci0Jc3RydWN0IGFkZV9od19j
dHggKmh3X2N0eDsKLX07Ci0KLS8qIGFkZS1mb3JtYXQgaW5mbzogKi8KIHN0YXRpYyBjb25zdCBz
dHJ1Y3Qga2lyaW5fZm9ybWF0IGFkZV9mb3JtYXRzW10gPSB7CiAJLyogMTZicHAgUkdCOiAqLwog
CXsgRFJNX0ZPUk1BVF9SR0I1NjUsIEFERV9SR0JfNTY1IH0sCkBAIC01NzEsMzYgKzU2NCw2IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3MgYWRlX2NydGNfZnVuY3MgPSB7CiAJ
LmRpc2FibGVfdmJsYW5rCT0gYWRlX2NydGNfZGlzYWJsZV92YmxhbmssCiB9OwogCi1zdGF0aWMg
aW50IGtpcmluX2RybV9jcnRjX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRy
bV9jcnRjICpjcnRjLAotCQkJICAgICAgIHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAotCQkJICAg
ICAgIGNvbnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGEpCi17Ci0Jc3RydWN0
IGRldmljZV9ub2RlICpwb3J0OwotCWludCByZXQ7Ci0KLQkvKiBzZXQgY3J0YyBwb3J0IHNvIHRo
YXQKLQkgKiBkcm1fb2ZfZmluZF9wb3NzaWJsZV9jcnRjcyBjYWxsIHdvcmtzCi0JICovCi0JcG9y
dCA9IG9mX2dldF9jaGlsZF9ieV9uYW1lKGRldi0+ZGV2LT5vZl9ub2RlLCAicG9ydCIpOwotCWlm
ICghcG9ydCkgewotCQlEUk1fRVJST1IoIm5vIHBvcnQgbm9kZSBmb3VuZCBpbiAlcE9GXG4iLCBk
ZXYtPmRldi0+b2Zfbm9kZSk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQlvZl9ub2RlX3B1dChw
b3J0KTsKLQljcnRjLT5wb3J0ID0gcG9ydDsKLQotCXJldCA9IGRybV9jcnRjX2luaXRfd2l0aF9w
bGFuZXMoZGV2LCBjcnRjLCBwbGFuZSwgTlVMTCwKLQkJCQkJZHJpdmVyX2RhdGEtPmNydGNfZnVu
Y3MsIE5VTEwpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gaW5pdCBjcnRj
LlxuIik7Ci0JCXJldHVybiByZXQ7Ci0JfQotCi0JZHJtX2NydGNfaGVscGVyX2FkZChjcnRjLCBk
cml2ZXJfZGF0YS0+Y3J0Y19oZWxwZXJfZnVuY3MpOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRp
YyB2b2lkIGFkZV9yZG1hX3NldCh2b2lkIF9faW9tZW0gKmJhc2UsIHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAogCQkJIHUzMiBjaCwgdTMyIHksIHUzMiBpbl9oLCB1MzIgZm10KQogewpAQCAt
ODkzLDI4ICs4NTYsNiBAQCBzdGF0aWMgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBhZGVfcGxhbmVf
ZnVuY3MgPSB7CiAJLmF0b21pY19kZXN0cm95X3N0YXRlID0gZHJtX2F0b21pY19oZWxwZXJfcGxh
bmVfZGVzdHJveV9zdGF0ZSwKIH07CiAKLXN0YXRpYyBpbnQga2lyaW5fZHJtX3BsYW5lX2luaXQo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJCQlzdHJ1Y3Qga2lyaW5fcGxhbmUgKmtwbGFuZSwK
LQkJCQllbnVtIGRybV9wbGFuZV90eXBlIHR5cGUsCi0JCQkJY29uc3Qgc3RydWN0IGtpcmluX2Ry
bV9kYXRhICpkcml2ZXJfZGF0YSkKLXsKLQlpbnQgcmV0ID0gMDsKLQotCXJldCA9IGRybV91bml2
ZXJzYWxfcGxhbmVfaW5pdChkZXYsICZrcGxhbmUtPmJhc2UsIDEsCi0JCQkJICAgICAgIGRyaXZl
cl9kYXRhLT5wbGFuZV9mdW5jcywKLQkJCQkgICAgICAgZHJpdmVyX2RhdGEtPmNoYW5uZWxfZm9y
bWF0cywKLQkJCQkgICAgICAgZHJpdmVyX2RhdGEtPmNoYW5uZWxfZm9ybWF0c19jbnQsCi0JCQkJ
ICAgICAgIE5VTEwsIHR5cGUsIE5VTEwpOwotCWlmIChyZXQpIHsKLQkJRFJNX0VSUk9SKCJmYWls
IHRvIGluaXQgcGxhbmUsIGNoPSVkXG4iLCBrcGxhbmUtPmNoKTsKLQkJcmV0dXJuIHJldDsKLQl9
Ci0KLQlkcm1fcGxhbmVfaGVscGVyX2FkZCgma3BsYW5lLT5iYXNlLCBkcml2ZXJfZGF0YS0+cGxh
bmVfaGVscGVyX2Z1bmNzKTsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMgdm9pZCAqYWRlX2h3
X2N0eF9hbGxvYyhzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAogCQkJCQkJCSAgc3RydWN0
IGRybV9jcnRjICpjcnRjKQogewpAQCAtOTg0LDcxICs5MjUsMTAgQEAgc3RhdGljIHZvaWQgKmFk
ZV9od19jdHhfYWxsb2Moc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldiwKIAlyZXR1cm4gY3R4
OwogfQogCi1zdGF0aWMgaW50IGFkZV9kcm1faW5pdChzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpw
ZGV2KQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBwbGF0Zm9ybV9nZXRfZHJ2ZGF0YShw
ZGV2KTsKLQlzdHJ1Y3QgYWRlX2RhdGEgKmFkZTsKLQlzdHJ1Y3QgYWRlX2h3X2N0eCAqY3R4Owot
CXN0cnVjdCBraXJpbl9jcnRjICprY3J0YzsKLQlzdHJ1Y3Qga2lyaW5fcGxhbmUgKmtwbGFuZTsK
LQllbnVtIGRybV9wbGFuZV90eXBlIHR5cGU7Ci0JaW50IHJldDsKLQl1MzIgY2g7Ci0KLQlhZGUg
PSBkZXZtX2t6YWxsb2MoZGV2LT5kZXYsIHNpemVvZigqYWRlKSwgR0ZQX0tFUk5FTCk7Ci0JaWYg
KCFhZGUpIHsKLQkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2MgYWRlX2RhdGFcbiIpOwotCQly
ZXR1cm4gLUVOT01FTTsKLQl9Ci0KLQljdHggPSBhZGVfZHJpdmVyX2RhdGEuYWxsb2NfaHdfY3R4
KHBkZXYsICZhZGUtPmNydGMuYmFzZSk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCURSTV9FUlJP
UigiZmFpbGVkIHRvIGluaXRpYWxpemUga2lyaW5fcHJpdiBodyBjdHhcbiIpOwotCQlyZXR1cm4g
LUVJTlZBTDsKLQl9Ci0JYWRlLT5od19jdHggPSBjdHg7Ci0KLQlrY3J0YyA9ICZhZGUtPmNydGM7
Ci0Ja2NydGMtPmh3X2N0eCA9IGN0eDsKLQotCS8qCi0JICogcGxhbmUgaW5pdAotCSAqIFRPRE86
IE5vdyBvbmx5IHN1cHBvcnQgcHJpbWFyeSBwbGFuZSwgb3ZlcmxheSBwbGFuZXMKLQkgKiBuZWVk
IHRvIGRvLgotCSAqLwotCWZvciAoY2ggPSAwOyBjaCA8IGFkZV9kcml2ZXJfZGF0YS5udW1fcGxh
bmVzOyBjaCsrKSB7Ci0JCWtwbGFuZSA9ICZhZGUtPnBsYW5lc1tjaF07Ci0JCWtwbGFuZS0+Y2gg
PSBjaDsKLQkJa3BsYW5lLT5od19jdHggPSBjdHg7Ci0KLQkJaWYgKGNoID09IGFkZV9kcml2ZXJf
ZGF0YS5wcmltX3BsYW5lKQotCQkJdHlwZSA9IERSTV9QTEFORV9UWVBFX1BSSU1BUlk7Ci0JCWVs
c2UKLQkJCXR5cGUgPSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZOwotCi0JCXJldCA9IGtpcmluX2Ry
bV9wbGFuZV9pbml0KGRldiwga3BsYW5lLCB0eXBlLCAmYWRlX2RyaXZlcl9kYXRhKTsKLQkJaWYg
KHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCi0JLyogY3J0YyBpbml0ICovCi0JcmV0ID0ga2ly
aW5fZHJtX2NydGNfaW5pdChkZXYsICZrY3J0Yy0+YmFzZSwKLQkJCQkmYWRlLT5wbGFuZXNbYWRl
X2RyaXZlcl9kYXRhLnByaW1fcGxhbmVdLmJhc2UsCi0JCQkJJmFkZV9kcml2ZXJfZGF0YSk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMgdm9pZCBh
ZGVfaHdfY3R4X2NsZWFudXAodm9pZCAqaHdfY3R4KQogewogfQogCi1zdGF0aWMgdm9pZCBhZGVf
ZHJtX2NsZWFudXAoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldikKLXsKLX0KLQogc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfZnVuY3MgYWRlX21vZGVfY29uZmlnX2Z1bmNz
ID0gewogCS5mYl9jcmVhdGUgPSBkcm1fZ2VtX2ZiX2NyZWF0ZSwKIAkuYXRvbWljX2NoZWNrID0g
ZHJtX2F0b21pY19oZWxwZXJfY2hlY2ssCkBAIC0xMDk5LDcgKzk3OSw0IEBAIHN0cnVjdCBraXJp
bl9kcm1fZGF0YSBhZGVfZHJpdmVyX2RhdGEgPSB7CiAKIAkuYWxsb2NfaHdfY3R4ID0gYWRlX2h3
X2N0eF9hbGxvYywKIAkuY2xlYW51cF9od19jdHggPSBhZGVfaHdfY3R4X2NsZWFudXAsCi0KLQku
aW5pdCA9IGFkZV9kcm1faW5pdCwKLQkuY2xlYW51cCA9IGFkZV9kcm1fY2xlYW51cAogfTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5j
IGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMKaW5kZXgg
Y2M3OWJkNGVjZWMyLi42OWFhNWUxODIxZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9o
aXNpbGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24va2lyaW4va2lyaW5fZHJtX2Rydi5jCkBAIC0yOCw2ICsyOCwxMzAgQEAKIAogI2luY2x1
ZGUgImtpcmluX2RybV9kcnYuaCIKIAorI2RlZmluZSBLSVJJTl9NQVhfUExBTkUJMgorCitzdHJ1
Y3Qga2lyaW5fZHJtX3ByaXZhdGUgeworCXN0cnVjdCBraXJpbl9jcnRjIGNydGM7CisJc3RydWN0
IGtpcmluX3BsYW5lIHBsYW5lc1tLSVJJTl9NQVhfUExBTkVdOworCXZvaWQgKmh3X2N0eDsKK307
CisKK3N0YXRpYyBpbnQga2lyaW5fZHJtX2NydGNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCBzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCisJ
CQkJY29uc3Qgc3RydWN0IGtpcmluX2RybV9kYXRhICpkcml2ZXJfZGF0YSkKK3sKKwlzdHJ1Y3Qg
ZGV2aWNlX25vZGUgKnBvcnQ7CisJaW50IHJldDsKKworCS8qIHNldCBjcnRjIHBvcnQgc28gdGhh
dAorCSAqIGRybV9vZl9maW5kX3Bvc3NpYmxlX2NydGNzIGNhbGwgd29ya3MKKwkgKi8KKwlwb3J0
ID0gb2ZfZ2V0X2NoaWxkX2J5X25hbWUoZGV2LT5kZXYtPm9mX25vZGUsICJwb3J0Iik7CisJaWYg
KCFwb3J0KSB7CisJCURSTV9FUlJPUigibm8gcG9ydCBub2RlIGZvdW5kIGluICVwT0ZcbiIsIGRl
di0+ZGV2LT5vZl9ub2RlKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCW9mX25vZGVfcHV0KHBv
cnQpOworCWNydGMtPnBvcnQgPSBwb3J0OworCisJcmV0ID0gZHJtX2NydGNfaW5pdF93aXRoX3Bs
YW5lcyhkZXYsIGNydGMsIHBsYW5lLCBOVUxMLAorCQkJCQlkcml2ZXJfZGF0YS0+Y3J0Y19mdW5j
cywgTlVMTCk7CisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoImZhaWxlZCB0byBpbml0IGNydGMu
XG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlkcm1fY3J0Y19oZWxwZXJfYWRkKGNydGMsIGRy
aXZlcl9kYXRhLT5jcnRjX2hlbHBlcl9mdW5jcyk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IGludCBraXJpbl9kcm1fcGxhbmVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3Qg
ZHJtX3BsYW5lICpwbGFuZSwKKwkJCQllbnVtIGRybV9wbGFuZV90eXBlIHR5cGUsCisJCQkJY29u
c3Qgc3RydWN0IGtpcmluX2RybV9kYXRhICpkYXRhKQoreworCWludCByZXQgPSAwOworCisJcmV0
ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KGRldiwgcGxhbmUsIDEsIGRhdGEtPnBsYW5lX2Z1
bmNzLAorCQkJCWRhdGEtPmNoYW5uZWxfZm9ybWF0cywKKwkJCQlkYXRhLT5jaGFubmVsX2Zvcm1h
dHNfY250LAorCQkJCU5VTEwsIHR5cGUsIE5VTEwpOworCWlmIChyZXQpIHsKKwkJRFJNX0VSUk9S
KCJmYWlsIHRvIGluaXQgcGxhbmUsIGNoPSVkXG4iLCAwKTsKKwkJcmV0dXJuIHJldDsKKwl9CisK
Kwlkcm1fcGxhbmVfaGVscGVyX2FkZChwbGFuZSwgZGF0YS0+cGxhbmVfaGVscGVyX2Z1bmNzKTsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBraXJpbl9kcm1fcHJpdmF0ZV9jbGVhbnVw
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCit7CisJc3RydWN0IGtpcmluX2RybV9wcml2YXRlICpr
aXJpbl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRh
dGE7CisKKwlkYXRhID0gKHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqKW9mX2RldmljZV9nZXRfbWF0
Y2hfZGF0YShkZXYtPmRldik7CisJaWYgKGRhdGEtPmNsZWFudXBfaHdfY3R4KQorCQlkYXRhLT5j
bGVhbnVwX2h3X2N0eChraXJpbl9wcml2LT5od19jdHgpOworCisJZGV2bV9rZnJlZShkZXYtPmRl
diwga2lyaW5fcHJpdik7CisJZGV2LT5kZXZfcHJpdmF0ZSA9IE5VTEw7Cit9CisKK3N0YXRpYyBp
bnQga2lyaW5fZHJtX3ByaXZhdGVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkJCWNv
bnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGEpCit7CisJc3RydWN0IHBsYXRm
b3JtX2RldmljZSAqcGRldiA9IHRvX3BsYXRmb3JtX2RldmljZShkZXYtPmRldik7CisJc3RydWN0
IGtpcmluX2RybV9wcml2YXRlICpraXJpbl9wcml2OworCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1f
cGxhbmU7CisJZW51bSBkcm1fcGxhbmVfdHlwZSB0eXBlOworCXZvaWQgKmN0eDsKKwlpbnQgcmV0
OworCXUzMiBjaDsKKworCWtpcmluX3ByaXYgPSBkZXZtX2t6YWxsb2MoZGV2LT5kZXYsIHNpemVv
Zigqa2lyaW5fcHJpdiksIEdGUF9LRVJORUwpOworCWlmICgha2lyaW5fcHJpdikgeworCQlEUk1f
RVJST1IoImZhaWxlZCB0byBhbGxvYyBraXJpbl9kcm1fcHJpdmF0ZVxuIik7CisJCXJldHVybiAt
RU5PTUVNOworCX0KKworCWN0eCA9IGRyaXZlcl9kYXRhLT5hbGxvY19od19jdHgocGRldiwgJmtp
cmluX3ByaXYtPmNydGMuYmFzZSk7CisJaWYgKElTX0VSUihjdHgpKSB7CisJCURSTV9FUlJPUigi
ZmFpbGVkIHRvIGluaXRpYWxpemUga2lyaW5fcHJpdiBodyBjdHhcbiIpOworCQlyZXR1cm4gLUVJ
TlZBTDsKKwl9CisJa2lyaW5fcHJpdi0+aHdfY3R4ID0gY3R4OworCisJLyoKKwkgKiBwbGFuZSBp
bml0CisJICogVE9ETzogTm93IG9ubHkgc3VwcG9ydCBwcmltYXJ5IHBsYW5lLCBvdmVybGF5IHBs
YW5lcworCSAqIG5lZWQgdG8gZG8uCisJICovCisJZm9yIChjaCA9IDA7IGNoIDwgZHJpdmVyX2Rh
dGEtPm51bV9wbGFuZXM7IGNoKyspIHsKKwkJaWYgKGNoID09IGRyaXZlcl9kYXRhLT5wcmltX3Bs
YW5lKQorCQkJdHlwZSA9IERSTV9QTEFORV9UWVBFX1BSSU1BUlk7CisJCWVsc2UKKwkJCXR5cGUg
PSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZOworCQlyZXQgPSBraXJpbl9kcm1fcGxhbmVfaW5pdChk
ZXYsICZraXJpbl9wcml2LT5wbGFuZXNbY2hdLmJhc2UsCisJCQkJCSAgIHR5cGUsIGRyaXZlcl9k
YXRhKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJCWtpcmluX3ByaXYtPnBsYW5lc1tj
aF0uY2ggPSBjaDsKKwkJa2lyaW5fcHJpdi0+cGxhbmVzW2NoXS5od19jdHggPSBjdHg7CisJfQor
CisJLyogY3J0YyBpbml0ICovCisJcHJpbV9wbGFuZSA9ICZraXJpbl9wcml2LT5wbGFuZXNbZHJp
dmVyX2RhdGEtPnByaW1fcGxhbmVdLmJhc2U7CisJcmV0ID0ga2lyaW5fZHJtX2NydGNfaW5pdChk
ZXYsICZraXJpbl9wcml2LT5jcnRjLmJhc2UsCisJCQkJICBwcmltX3BsYW5lLCBkcml2ZXJfZGF0
YSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwlraXJpbl9wcml2LT5jcnRjLmh3X2N0eCA9
IGN0eDsKKwlkZXYtPmRldl9wcml2YXRlID0ga2lyaW5fcHJpdjsKKworCXJldHVybiAwOworfQog
CiBzdGF0aWMgaW50IGtpcmluX2RybV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CQkJCWNvbnN0IHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqZHJpdmVyX2RhdGEpCkBAIC00Myw3ICsx
NjcsNyBAQCBzdGF0aWMgaW50IGtpcmluX2RybV9rbXNfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCWRldi0+bW9kZV9jb25maWcuZnVuY3MgPSBkcml2ZXJfZGF0YS0+bW9kZV9jb25maWdf
ZnVuY3M7CiAKIAkvKiBkaXNwbGF5IGNvbnRyb2xsZXIgaW5pdCAqLwotCXJldCA9IGRyaXZlcl9k
YXRhLT5pbml0KHRvX3BsYXRmb3JtX2RldmljZShkZXYtPmRldikpOworCXJldCA9IGtpcmluX2Ry
bV9wcml2YXRlX2luaXQoZGV2LCBkcml2ZXJfZGF0YSk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJf
bW9kZV9jb25maWdfY2xlYW51cDsKIApAQCAtNTEsNyArMTc1LDcgQEAgc3RhdGljIGludCBraXJp
bl9kcm1fa21zX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlyZXQgPSBjb21wb25lbnRf
YmluZF9hbGwoZGV2LT5kZXYsIGRldik7CiAJaWYgKHJldCkgewogCQlEUk1fRVJST1IoImZhaWxl
ZCB0byBiaW5kIGFsbCBjb21wb25lbnQuXG4iKTsKLQkJZ290byBlcnJfZGNfY2xlYW51cDsKKwkJ
Z290byBlcnJfcHJpdmF0ZV9jbGVhbnVwOwogCX0KIAogCS8qIHZibGFuayBpbml0ICovCkBAIC03
MywxMSArMTk3LDEwIEBAIHN0YXRpYyBpbnQga2lyaW5fZHJtX2ttc19pbml0KHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCiAKIGVycl91bmJpbmRfYWxsOgogCWNvbXBvbmVudF91bmJpbmRfYWxsKGRl
di0+ZGV2LCBkZXYpOwotZXJyX2RjX2NsZWFudXA6Ci0JZHJpdmVyX2RhdGEtPmNsZWFudXAodG9f
cGxhdGZvcm1fZGV2aWNlKGRldi0+ZGV2KSk7CitlcnJfcHJpdmF0ZV9jbGVhbnVwOgorCWtpcmlu
X2RybV9wcml2YXRlX2NsZWFudXAoZGV2KTsKIGVycl9tb2RlX2NvbmZpZ19jbGVhbnVwOgogCWRy
bV9tb2RlX2NvbmZpZ19jbGVhbnVwKGRldik7Ci0KIAlyZXR1cm4gcmV0OwogfQogCkBAIC04OCwx
NCArMjExLDggQEAgc3RhdGljIGludCBjb21wYXJlX29mKHN0cnVjdCBkZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSkKIAogc3RhdGljIGludCBraXJpbl9kcm1fa21zX2NsZWFudXAoc3RydWN0IGRybV9k
ZXZpY2UgKmRldikKIHsKLQljb25zdCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRh
OwotCiAJZHJtX2ttc19oZWxwZXJfcG9sbF9maW5pKGRldik7Ci0KLQlkcml2ZXJfZGF0YSA9IG9m
X2RldmljZV9nZXRfbWF0Y2hfZGF0YShkZXYtPmRldik7Ci0JaWYgKGRyaXZlcl9kYXRhLT5jbGVh
bnVwKQotCQlkcml2ZXJfZGF0YS0+Y2xlYW51cCh0b19wbGF0Zm9ybV9kZXZpY2UoZGV2LT5kZXYp
KTsKLQorCWtpcmluX2RybV9wcml2YXRlX2NsZWFudXAoZGV2KTsKIAlkcm1fbW9kZV9jb25maWdf
Y2xlYW51cChkZXYpOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGlj
b24va2lyaW4va2lyaW5fZHJtX2Rydi5oCmluZGV4IDE2NjM2MTBkMmNkOC4uNGQ1YzA1YTI0MDY1
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9k
cnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYu
aApAQCAtNyw4ICs3LDYgQEAKICNpZm5kZWYgX19LSVJJTl9EUk1fRFJWX0hfXwogI2RlZmluZSBf
X0tJUklOX0RSTV9EUlZfSF9fCiAKLSNkZWZpbmUgTUFYX0NSVEMJMgotCiAjZGVmaW5lIHRvX2tp
cmluX2NydGMoY3J0YykgXAogCWNvbnRhaW5lcl9vZihjcnRjLCBzdHJ1Y3Qga2lyaW5fY3J0Yywg
YmFzZSkKIApAQCAtNTMsOSArNTEsNiBAQCBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgewogCXZvaWQg
KigqYWxsb2NfaHdfY3R4KShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2LAogCQkJICAgICAg
c3RydWN0IGRybV9jcnRjICpjcnRjKTsKIAl2b2lkICgqY2xlYW51cF9od19jdHgpKHZvaWQgKmh3
X2N0eCk7Ci0KLQlpbnQgKCppbml0KShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KTsKLQl2
b2lkICgqY2xlYW51cCkoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRldik7CiB9OwogCiBleHRl
cm4gc3RydWN0IGtpcmluX2RybV9kYXRhIGFkZV9kcml2ZXJfZGF0YTsKLS0gCjIuMTcuMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
