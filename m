Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3B110E1FCF
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:45:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6C0176EB20;
	Wed, 23 Oct 2019 15:45:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BAF7A6EB1B
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:29 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id F07D928F95D;
 Wed, 23 Oct 2019 16:45:27 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 12/21] drm/bridge: Add an ->atomic_check() hook
Date: Wed, 23 Oct 2019 17:45:03 +0200
Message-Id: <20191023154512.9762-13-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U28gdGhhdCBicmlkZ2UgZHJpdmVycyBoYXZlIGEgd2F5IHRvIGNoZWNrL3JlamVjdCBhbiBhdG9t
aWMgb3BlcmF0aW9uLgpUaGUgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2soKSAod2hpY2gg
aXMganVzdCBhIHdyYXBwZXIgYXJvdW5kCnRoZSAtPmF0b21pY19jaGVjaygpIGhvb2spIGlzIGNh
bGxlZCBpbiBwbGFjZSBvZgpkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoKSAod2hlbiAtPmF0
b21pY19jaGVjaygpIGlzIG5vdCBpbXBsZW1lbnRlZCwKdGhlIGNvcmUgZmFsbHMgYmFjayBvbiAt
Pm1vZGVfZml4dXAoKSwgc28gdGhlIGJlaGF2aW9yIHNob3VsZCBzdGF5CnRoZSBzYW1lIGZvciBl
eGlzdGluZyBicmlkZ2UgZHJpdmVycykuCgpTaWduZWQtb2ZmLWJ5OiBCb3JpcyBCcmV6aWxsb24g
PGJvcmlzLmJyZXppbGxvbkBjb2xsYWJvcmEuY29tPgotLS0KQ2hhbmdlcyBpbiB2MzoKKiBOb25l
CgpDaGFuZ2VzIGluIHYyOgoqIENsYXJpZnkgdGhlIGZhY3QgdGhhdCAtPmF0b21pY19jaGVjaygp
IGlzIHJlcGxhY2luZyAtPm1vZGVfZml4dXAoKQotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRv
bWljX2hlbHBlci5jIHwgMTIgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAg
ICAgICB8IDYyICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL2RybS9kcm1f
YnJpZGdlLmggICAgICAgICAgICB8IDI5ICsrKysrKysrKysrKystCiAzIGZpbGVzIGNoYW5nZWQs
IDk2IGluc2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19o
ZWxwZXIuYwppbmRleCBkZTk4NWJhN2NlMmQuLjFkMGExOTUxMWEwZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2Ry
bV9hdG9taWNfaGVscGVyLmMKQEAgLTQzNywxMiArNDM3LDEyIEBAIG1vZGVfZml4dXAoc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlmdW5jcyA9IGVuY29kZXItPmhlbHBlcl9wcml2
YXRlOwogCiAJCWJyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShlbmNv
ZGVyKTsKLQkJcmV0ID0gZHJtX2JyaWRnZV9jaGFpbl9tb2RlX2ZpeHVwKGJyaWRnZSwKLQkJCQkJ
Jm5ld19jcnRjX3N0YXRlLT5tb2RlLAotCQkJCQkmbmV3X2NydGNfc3RhdGUtPmFkanVzdGVkX21v
ZGUpOwotCQlpZiAoIXJldCkgewotCQkJRFJNX0RFQlVHX0FUT01JQygiQnJpZGdlIGZpeHVwIGZh
aWxlZFxuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKKwkJcmV0ID0gZHJtX2F0b21pY19icmlkZ2Vf
Y2hhaW5fY2hlY2soYnJpZGdlLAorCQkJCQkJICAgIG5ld19jcnRjX3N0YXRlLAorCQkJCQkJICAg
IG5ld19jb25uX3N0YXRlKTsKKwkJaWYgKHJldCkgeworCQkJRFJNX0RFQlVHX0FUT01JQygiQnJp
ZGdlIGF0b21pYyBjaGVjayBmYWlsZWRcbiIpOworCQkJcmV0dXJuIHJldDsKIAkJfQogCiAJCWlm
IChmdW5jcyAmJiBmdW5jcy0+YXRvbWljX2NoZWNrKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2JyaWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwppbmRleCAz
Nzc4NjZlMzIxNGYuLjk5MGUwNTYyOTZiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9icmlkZ2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCkBAIC02MTUsNiAr
NjE1LDY4IEBAIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKHN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2UsCiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWlu
X2VuYWJsZSk7CiAKK3N0YXRpYyBpbnQgZHJtX2F0b21pY19icmlkZ2VfY2hlY2soc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSwKKwkJCQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCisJCQkJICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCit7CisJ
aWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19jaGVjaykgeworCQlzdHJ1Y3QgZHJtX2JyaWRnZV9z
dGF0ZSAqYnJpZGdlX3N0YXRlOworCQlpbnQgcmV0OworCisJCWJyaWRnZV9zdGF0ZSA9IGRybV9h
dG9taWNfZ2V0X25ld19icmlkZ2Vfc3RhdGUoY3J0Y19zdGF0ZS0+c3RhdGUsCisJCQkJCQkJICAg
ICAgIGJyaWRnZSk7CisJCWlmIChXQVJOX09OKCFicmlkZ2Vfc3RhdGUpKQorCQkJcmV0dXJuIC1F
SU5WQUw7CisKKwkJcmV0ID0gYnJpZGdlLT5mdW5jcy0+YXRvbWljX2NoZWNrKGJyaWRnZSwgYnJp
ZGdlX3N0YXRlLAorCQkJCQkJICBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwkJaWYgKHJldCkK
KwkJCXJldHVybiByZXQ7CisJfSBlbHNlIGlmIChicmlkZ2UtPmZ1bmNzLT5tb2RlX2ZpeHVwKSB7
CisJCWlmICghYnJpZGdlLT5mdW5jcy0+bW9kZV9maXh1cChicmlkZ2UsICZjcnRjX3N0YXRlLT5t
b2RlLAorCQkJCQkgICAgICAgJmNydGNfc3RhdGUtPmFkanVzdGVkX21vZGUpKQorCQkJcmV0dXJu
IC1FSU5WQUw7CisJfQorCisJcmV0dXJuIDA7Cit9CisKKy8qKgorICogZHJtX2F0b21pY19icmlk
Z2VfY2hhaW5fY2hlY2soKSAtIERvIGFuIGF0b21pYyBjaGVjayBvbiB0aGUgYnJpZGdlIGNoYWlu
CisgKiBAYnJpZGdlOiBicmlkZ2UgY29udHJvbCBzdHJ1Y3R1cmUKKyAqIEBjcnRjX3N0YXRlOiBu
ZXcgQ1JUQyBzdGF0ZQorICogQGNvbm5fc3RhdGU6IG5ldyBjb25uZWN0b3Igc3RhdGUKKyAqCisg
KiBDYWxscyAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfY2hlY2soKSAoZmFsbHMgYmFjayBvbgor
ICogJmRybV9icmlkZ2VfZnVuY3MubW9kZV9maXh1cCgpKSBvcCBmb3IgYWxsIHRoZSBicmlkZ2Vz
IGluIHRoZSBlbmNvZGVyIGNoYWluLAorICogc3RhcnRpbmcgZnJvbSB0aGUgbGFzdCBicmlkZ2Ug
dG8gdGhlIGZpcnN0LiBUaGVzZSBhcmUgY2FsbGVkIGJlZm9yZSBjYWxsaW5nCisgKiAmZHJtX2Vu
Y29kZXJfaGVscGVyX2Z1bmNzLmF0b21pY19jaGVjaygpCisgKgorICogUkVUVVJOUzoKKyAqIDAg
b24gc3VjY2VzcywgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUKKyAqLworaW50IGRy
bV9hdG9taWNfYnJpZGdlX2NoYWluX2NoZWNrKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJ
CQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVu
Y29kZXIgPSBicmlkZ2UtPmVuY29kZXI7CisJc3RydWN0IGRybV9icmlkZ2UgKml0ZXI7CisKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVyc2UoaXRlciwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwg
Y2hhaW5fbm9kZSkgeworCQlpbnQgcmV0OworCisJCXJldCA9IGRybV9hdG9taWNfYnJpZGdlX2No
ZWNrKGl0ZXIsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJu
IHJldDsKKworCQlpZiAoaXRlciA9PSBicmlkZ2UpCisJCQlicmVhazsKKwl9CisKKwlyZXR1cm4g
MDsKK30KK0VYUE9SVF9TWU1CT0woZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fY2hlY2spOworCiAv
KioKICAqIGRybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kZXN0cm95X3N0YXRlKCkgLSBEZWZhdWx0
IGRlc3Ryb3kgc3RhdGUgaGVscGVyCiAgKiBAYnJpZGdlOiB0aGUgYnJpZGdlIHRoaXMgc3RhdGUg
cmVmZXJzIHRvCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggYi9pbmNsdWRl
L2RybS9kcm1fYnJpZGdlLmgKaW5kZXggYjFmNTU3ZDhkYmE5Li4yYmViMWVmOWE3MzMgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fYnJp
ZGdlLmgKQEAgLTEyNyw3ICsxMjcsOSBAQCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7CiAJICog
dGhpcyBmdW5jdGlvbiBwYXNzZXMgYWxsIG90aGVyIGNhbGxiYWNrcyBtdXN0IHN1Y2NlZWQgZm9y
IHRoaXMKIAkgKiBjb25maWd1cmF0aW9uLgogCSAqCi0JICogVGhlIEBtb2RlX2ZpeHVwIGNhbGxi
YWNrIGlzIG9wdGlvbmFsLgorCSAqIFRoZSBtb2RlX2ZpeHVwIGNhbGxiYWNrIGlzIG9wdGlvbmFs
LiAmZHJtX2JyaWRnZV9mdW5jcy5tb2RlX2ZpeHVwKCkKKwkgKiBpcyBub3QgY2FsbGVkIHdoZW4g
JmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2NoZWNrKCkgaXMgaW1wbGVtZW50ZWQsCisJICogc28g
b25seSBvbmUgb2YgdGhlbSBzaG91bGQgYmUgcHJvdmlkZWQuCiAJICoKIAkgKiBOT1RFOgogCSAq
CkBAIC0zOTEsNiArMzkzLDI4IEBAIHN0cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIHsKIAl2b2lkICgq
YXRvbWljX2Rlc3Ryb3lfc3RhdGUpKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCQkJICAg
ICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpOwogCisJLyoqCisJICogQGF0b21pY19j
aGVjazoKKwkgKgorCSAqIFRoaXMgbWV0aG9kIGlzIHJlc3BvbnNpYmxlIGZvciBjaGVja2luZyBi
cmlkZ2Ugc3RhdGUgY29ycmVjdG5lc3MuCisJICogSXQgY2FuIGFsc28gY2hlY2sgdGhlIHN0YXRl
IG9mIHRoZSBzdXJyb3VuZGluZyBjb21wb25lbnRzIGluIGNoYWluCisJICogdG8gbWFrZSBzdXJl
IHRoZSB3aG9sZSBwaXBlbGluZSBjYW4gd29yayBwcm9wZXJseS4KKwkgKgorCSAqICZkcm1fYnJp
ZGdlX2Z1bmNzLmF0b21pY19jaGVjaygpIGhvb2tzIGFyZSBjYWxsZWQgaW4gcmV2ZXJzZQorCSAq
IG9yZGVyIChmcm9tIHRoZSBsYXN0IHRvIHRoZSBmaXJzdCBicmlkZ2UpLgorCSAqCisJICogVGhp
cyBtZXRob2QgaXMgb3B0aW9uYWwuICZkcm1fYnJpZGdlX2Z1bmNzLm1vZGVfZml4dXAoKSBpcyBu
b3QKKwkgKiBjYWxsZWQgd2hlbiAmZHJtX2JyaWRnZV9mdW5jcy5hdG9taWNfY2hlY2soKSBpcyBp
bXBsZW1lbnRlZCwgc28gb25seQorCSAqIG9uZSBvZiB0aGVtIHNob3VsZCBiZSBwcm92aWRlZC4K
KwkgKgorCSAqIFJFVFVSTlM6CisJICogemVybyBpZiB0aGUgY2hlY2sgcGFzc2VkLCBhIG5lZ2F0
aXZlIGVycm9yIGNvZGUgb3RoZXJ3aXNlLgorCSAqLworCWludCAoKmF0b21pY19jaGVjaykoc3Ry
dWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKKwkJCSAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAq
YnJpZGdlX3N0YXRlLAorCQkJICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
KwkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7CisKIAkvKioK
IAkgKiBAYXRvbWljX3Jlc2V0OgogCSAqCkBAIC01NDIsNiArNTY2LDkgQEAgdm9pZCBkcm1fYnJp
ZGdlX2NoYWluX21vZGVfc2V0KHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiB2b2lkIGRybV9i
cmlkZ2VfY2hhaW5fcHJlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKTsKIHZvaWQg
ZHJtX2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSk7CiAKK2lu
dCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9jaGVjayhzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdl
LAorCQkJCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpOwogdm9pZCBkcm1fYXRvbWljX2JyaWRn
ZV9jaGFpbl9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCQkJICAgICBzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFp
bl9wb3N0X2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKLS0gCjIuMjEuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
