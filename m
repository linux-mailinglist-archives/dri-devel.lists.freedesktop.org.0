Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3186E31A943
	for <lists+dri-devel@lfdr.de>; Sat, 13 Feb 2021 02:08:53 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5CF7B6F3E7;
	Sat, 13 Feb 2021 01:08:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM04-BN8-obe.outbound.protection.outlook.com
 (mail-bn8nam08on2077.outbound.protection.outlook.com [40.107.100.77])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1D0856F3E7;
 Sat, 13 Feb 2021 01:08:46 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=RbZwHbUfXf4FHfYNBOBlZF0Uub5WVLiFeek3QEhpKAwmD+OJlNSxQZW7o75UcAa12m23Dejs+LXoJ9L/GeGRTZ793+T/q8e/J39pLzwcPDPB/s0ahOTfZsrS5tvtRSDreWQ/SMqgxpthkZFHDhpq0O4NohMrBiC+1dkNdgfur5TPEVo4Cl2lNQnJ4kzdtBjRnKiwMYjCSJBnD9Pxyq1FrD6GtFz1+f4J6LrH42ySgwubnl/MZ/HhqSTA4owrMUhxKWnl2jfV3FjYVgFcL5pOA6hwjsVgNeWvqv7ch31YBXDRN4BWFb+bLx24EE0MMLS696tSTahlCBHZ7b0VFzUrLA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=j1XyYdfYgy0Ix/RXcwpb0hemAgT7W1nRADGPhGoaGls=;
 b=PfcWZulVQpNhyhdTRz6liLpDnHE2l7aYkdznoAndmqFat1IcIJyNVqDNUDv3SHELpSqgl01R/+kd1bpJ4fX7aL7G5AfrOgiLrn59xmXfX/MAkQsKhVuoBbeQipUoV+0Po7GYSGDu8I4cTmeuQ4uYGcC3DvusAaN/2nQOVejJX38C2Yiovxucf37CXyc8VOeXdzmjUR+zsutCJsbTyOBjZU+jsGnlmkojnT7bGTcl7VK/rV07YxyaBIbx3TjUUSGIBp5NmRuzqWFbKUkHX1OmQDzwbPU3QZdvotat7mgTzq25KumlttBugRRAdbrEbZDmFSFOIQa44wqC3J2s1Jtpsg==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=softfail (sender ip
 is 165.204.84.17) smtp.rcpttodomain=lists.freedesktop.org
 smtp.mailfrom=amd.com; dmarc=fail (p=none sp=none pct=100) action=none
 header.from=amd.com; dkim=none (message not signed); arc=none
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=amd.com; s=selector1; 
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=j1XyYdfYgy0Ix/RXcwpb0hemAgT7W1nRADGPhGoaGls=;
 b=Efj4LVO2yRDLPi32DeNE6qq4D5afqOLYAVM+wTtWwfJyiXGIkrNxiCrus9y8lW3VGCJLej1twugnJDD6ymA70Zxdyz4wCIqi0dhEo4LBlZoOmULQtRA60ibvVYUmas4melOvd+g+xHKs+xg+J+ulkC2O7f7ojwPj/49VTtABVEo=
Received: from BN0PR04CA0055.namprd04.prod.outlook.com (2603:10b6:408:e8::30)
 by DM5PR12MB1692.namprd12.prod.outlook.com (2603:10b6:4:5::14) with
 Microsoft
 SMTP Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.3825.29; Sat, 13 Feb 2021 01:08:42 +0000
Received: from BN8NAM11FT008.eop-nam11.prod.protection.outlook.com
 (2603:10b6:408:e8:cafe::7b) by BN0PR04CA0055.outlook.office365.com
 (2603:10b6:408:e8::30) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.20.3846.25 via Frontend
 Transport; Sat, 13 Feb 2021 01:08:42 +0000
X-MS-Exchange-Authentication-Results: spf=softfail (sender IP is
 165.204.84.17) smtp.mailfrom=amd.com; lists.freedesktop.org; dkim=none
 (message not signed) header.d=none;lists.freedesktop.org; dmarc=fail
 action=none header.from=amd.com;
Received-SPF: SoftFail (protection.outlook.com: domain of transitioning
 amd.com discourages use of 165.204.84.17 as permitted sender)
Received: from SATLEXMB02.amd.com (165.204.84.17) by
 BN8NAM11FT008.mail.protection.outlook.com (10.13.177.95) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.20.3846.25 via Frontend Transport; Sat, 13 Feb 2021 01:08:40 +0000
Received: from SATLEXMB05.amd.com (10.181.40.146) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Fri, 12 Feb
 2021 19:08:39 -0600
Received: from SATLEXMB02.amd.com (10.181.40.143) by SATLEXMB05.amd.com
 (10.181.40.146) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id 15.1.1979.3; Fri, 12 Feb
 2021 19:08:38 -0600
Received: from elite-desk-aura.amd.com (10.180.168.240) by SATLEXMB02.amd.com
 (10.181.40.143) with Microsoft SMTP Server id 15.1.1979.3 via
 Frontend Transport; Fri, 12 Feb 2021 19:08:37 -0600
From: Aurabindo Pillai <aurabindo.pillai@amd.com>
To: <amd-gfx@lists.freedesktop.org>, <dri-devel@lists.freedesktop.org>
Subject: [PATCH v6 2/3] drm/amd/display: Add freesync video modes based on
 preferred modes
Date: Fri, 12 Feb 2021 20:08:26 -0500
Message-ID: <20210213010827.261272-3-aurabindo.pillai@amd.com>
X-Mailer: git-send-email 2.30.0
In-Reply-To: <20210213010827.261272-1-aurabindo.pillai@amd.com>
References: <20210213010827.261272-1-aurabindo.pillai@amd.com>
MIME-Version: 1.0
X-EOPAttributedMessage: 0
X-MS-Office365-Filtering-HT: Tenant
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-Correlation-Id: eec89e68-e09c-404b-933e-08d8cfbbe69e
X-MS-TrafficTypeDiagnostic: DM5PR12MB1692:
X-Microsoft-Antispam-PRVS: <DM5PR12MB1692D5A9BA7F1C33104464A38B8A9@DM5PR12MB1692.namprd12.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:4502;
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: +Lf8b4O5/O3JTByj17lHQXj7azAmbuedueSiRkd6KUNz6FNiHKSs3Bf6r01YgTc5e8KFSyy57R0T8LYsVGtTyJyFl0UbbKgQDl7SYozpbz9FJmFgKEUdDItfeQNoeCj1j3ax4wPiXdqIsrLJbEYI8/QUNvKTEClZ6I8Mz+RhW4o21KK/BllwfEz1HHrEfpDK+j1Z/B640FEqjXSkUB3GfQeoQPITYI6YFtAQ4L980445UlEfLjyYS55T2fk5Ei3AzjzePNT6cOMq2fR1pwEhXWpFPpKUI7VAuhIGT9kJkm6GRDs/Xv/xjtMOv66rgqplgRx1jSxgke1MgSQNgvnhuFi2xVhsp6yM1lke5fyLQMw8+ICmmS0w70ieUB/9eDCyIQzCVT5kpnUiXzMsdnePBgAuokQZlEKIdQVoopL9jO9YGqaJ26MukeiBls7v0lwOR0j4KmGR3XR0IEGh8WaTXmZwmJpFhHHOkOfx9T2MN1Ouiq0msqNDqbT7RjzFyeAJjYzZvbTXqtGIID4Fh1PJfkicr8ezJxHkVyybnGXPC6UyzAoDVtBOcAn0/tQlwo1AY5Cs3l0JbEYW2EexHCkVnJUV+IusdiWUkVxIXhiNq6//haGnf4nYZ2powWpnvl8g/lgz9sqGXCzYgj64/QlpdvlFaKg8blY38y1kTIJ7kIheaAaZBtVasNqyIuh84+uq
X-Forefront-Antispam-Report: CIP:165.204.84.17; CTRY:US; LANG:en; SCL:1; SRV:;
 IPV:NLI; SFV:NSPM; H:SATLEXMB02.amd.com; PTR:ErrorRetry; CAT:NONE;
 SFS:(4636009)(39860400002)(396003)(136003)(346002)(376002)(46966006)(36840700001)(6666004)(82740400003)(44832011)(70586007)(8936002)(450100002)(36860700001)(2616005)(186003)(81166007)(336012)(82310400003)(426003)(26005)(86362001)(36756003)(356005)(47076005)(478600001)(8676002)(1076003)(2906002)(54906003)(110136005)(5660300002)(83380400001)(70206006)(316002)(4326008)(7696005)(36900700001);
 DIR:OUT; SFP:1101; 
X-OriginatorOrg: amd.com
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 13 Feb 2021 01:08:40.7471 (UTC)
X-MS-Exchange-CrossTenant-Network-Message-Id: eec89e68-e09c-404b-933e-08d8cfbbe69e
X-MS-Exchange-CrossTenant-Id: 3dd8961f-e488-4e60-8e11-a82d994e183d
X-MS-Exchange-CrossTenant-OriginalAttributedTenantConnectingIp: TenantId=3dd8961f-e488-4e60-8e11-a82d994e183d; Ip=[165.204.84.17];
 Helo=[SATLEXMB02.amd.com]
X-MS-Exchange-CrossTenant-AuthSource: BN8NAM11FT008.eop-nam11.prod.protection.outlook.com
X-MS-Exchange-CrossTenant-AuthAs: Anonymous
X-MS-Exchange-CrossTenant-FromEntityHeader: HybridOnPrem
X-MS-Exchange-Transport-CrossTenantHeadersStamped: DM5PR12MB1692
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: stylon.wang@amd.com, shashank.sharma@amd.com,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 aurabindo.pillai@amd.com, wayne.lin@amd.com, alexander.deucher@amd.com,
 nicholas.kazlauskas@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

W1doeV0KV2hpbGUgcG9zc2libGUgZm9yIHVzZXJzcGFjZSB0byBjcmVhdGUgYW5kIGFkZCBjdXN0
b20gbW9kZSBiYXNlZCBvZmYgdGhlCm9wdGltaXplZCBtb2RlIGZvciB0aGUgY29ubmVjdGVkIGRp
c3BsYXkgd2hpY2ggZGlmZmVycyBvbmx5IGluIGZyb250IHBvcmNoCnRpbWluZywgdGhpcyBwYXRj
aCBzZXQgYWRkcyBhIGxpc3Qgb2YgY29tbW9uIHZpZGVvIG1vZGVzIGluIGFkdmFuY2UuCgpUaGUg
bGlzdCBvZiBjb21tb24gdmlkZW8gcmVmcmVzaCByYXRlcyBpcyBzbWFsbCwgd2VsbCBrbm93biBh
bmQgdGhlIG9wdGltaXplZAptb2RlIGhhcyBzcGVjaWZpYyByZXF1aXJlbWVudHMgdG8gYmUgYWJs
ZSB0byBlbmFibGUgSFcgZnJhbWUgZG91YmxpbmcgYW5kCnRyaXBsaW5nIHNvIGl0IG1ha2VzIG1v
c3Qgc2Vuc2UgdG8gY3JlYXRlIHRoZSBtb2RlcyB0aGF0IHZpZGVvIHBsYXllcnMgd2lsbCBuZWVk
CmluIGFkdmFuY2UuIFRoZSBvcHRpbWl6ZWQgbW9kZSBtYXRjaGVzIHRoZSBwcmVmZXJyZWQgbW9k
ZSByZXNvbHV0aW9uIGJ1dCBoYXMgdGhlCmhpZ2hlc3QgcmVmcmVzaCByYXRlIGF2YWlsYWJsZSB0
byBlbmFibGUgdGhlIGxhcmdlc3QgZnJvbnQgcG9yY2ggZXh0ZW5zaW9uLgoKW0hvd10KRmluZCB0
aGUgb3B0aW1pemVkIG1vZGUgYW5kIHN0b3JlIGl0IG9uIHRoZSBjb25uZWN0b3Igc28gd2UgY2Fu
IGNoZWNrIGl0CmxhdGVyIGR1cmluZyBvdXIgb3B0aW1pemVkIG1vZGVzZXQuCgpQcmVwb3B1bGF0
ZSB0aGUgbW9kZSBsaXN0IHdpdGggYSBsaXN0IG9mIGNvbW1vbiB2aWRlbyBtYWRlcyBiYXNlZCBv
biB0aGUKb3B0aW1pemVkIG1vZGUgKGJ1dCB3aXRoIGEgbG9uZ2VyIGZyb250IHBvcmNoKSBpZiB0
aGUgcGFuZWwgZG9lc24ndCBzdXBwb3J0IGEKdmFyaWFudCBvZiB0aGUgbW9kZSBuYXRpdmVseS4K
ClNpZ25lZC1vZmYtYnk6IEF1cmFiaW5kbyBQaWxsYWkgPGF1cmFiaW5kby5waWxsYWlAYW1kLmNv
bT4KQWNrZWQtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
UmV2aWV3ZWQtYnk6IFNoYXNoYW5rIFNoYXJtYSA8c2hhc2hhbmsuc2hhcm1hQGFtZC5jb20+Ci0t
LQogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jIHwgMTU5ICsr
KysrKysrKysrKysrKysrKwogLi4uL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdw
dV9kbS5oIHwgICAyICsKIDIgZmlsZXMgY2hhbmdlZCwgMTYxIGluc2VydGlvbnMoKykKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYwppbmRl
eCA2MjZhOGNjOTJkNjUuLmM0NzI5MDVjN2Q3MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2FtZC9kaXNwbGF5L2FtZGdwdV9kbS9hbWRncHVfZG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
YW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5jCkBAIC01MTg3LDYgKzUxODcsNTkgQEAg
c3RhdGljIHZvaWQgZG1fZW5hYmxlX3Blcl9mcmFtZV9jcnRjX21hc3Rlcl9zeW5jKHN0cnVjdCBk
Y19zdGF0ZSAqY29udGV4dCkKIAlzZXRfbWFzdGVyX3N0cmVhbShjb250ZXh0LT5zdHJlYW1zLCBj
b250ZXh0LT5zdHJlYW1fY291bnQpOwogfQogCitzdGF0aWMgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKgorZ2V0X2hpZ2hlc3RfcmVmcmVzaF9yYXRlX21vZGUoc3RydWN0IGFtZGdwdV9kbV9jb25u
ZWN0b3IgKmFjb25uZWN0b3IsCisJCQkgIGJvb2wgdXNlX3Byb2JlZF9tb2RlcykKK3sKKwlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbSwgKm1fcHJlZiA9IE5VTEw7CisJdTE2IGN1cnJlbnRfcmVm
cmVzaCwgaGlnaGVzdF9yZWZyZXNoOworCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3RfaGVhZCA9IHVz
ZV9wcm9iZWRfbW9kZXMgPworCQkJCQkJICAgICZhY29ubmVjdG9yLT5iYXNlLnByb2JlZF9tb2Rl
cyA6CisJCQkJCQkgICAgJmFjb25uZWN0b3ItPmJhc2UubW9kZXM7CisKKwlpZiAoYWNvbm5lY3Rv
ci0+ZnJlZXN5bmNfdmlkX2Jhc2UuY2xvY2sgIT0gMCkKKwkJcmV0dXJuICZhY29ubmVjdG9yLT5m
cmVlc3luY192aWRfYmFzZTsKKworCS8qIEZpbmQgdGhlIHByZWZlcnJlZCBtb2RlICovCisJbGlz
dF9mb3JfZWFjaF9lbnRyeSAobSwgbGlzdF9oZWFkLCBoZWFkKSB7CisJCWlmIChtLT50eXBlICYg
RFJNX01PREVfVFlQRV9QUkVGRVJSRUQpIHsKKwkJCW1fcHJlZiA9IG07CisJCQlicmVhazsKKwkJ
fQorCX0KKworCWlmICghbV9wcmVmKSB7CisJCS8qIFByb2JhYmx5IGFuIEVESUQgd2l0aCBubyBw
cmVmZXJyZWQgbW9kZS4gRmFsbGJhY2sgdG8gZmlyc3QgZW50cnkgKi8KKwkJbV9wcmVmID0gbGlz
dF9maXJzdF9lbnRyeV9vcl9udWxsKAorCQkJJmFjb25uZWN0b3ItPmJhc2UubW9kZXMsIHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlLCBoZWFkKTsKKwkJaWYgKCFtX3ByZWYpIHsKKwkJCURSTV9ERUJV
R19EUklWRVIoIk5vIHByZWZlcnJlZCBtb2RlIGZvdW5kIGluIEVESURcbiIpOworCQkJcmV0dXJu
IE5VTEw7CisJCX0KKwl9CisKKwloaWdoZXN0X3JlZnJlc2ggPSBkcm1fbW9kZV92cmVmcmVzaCht
X3ByZWYpOworCisJLyoKKwkgKiBGaW5kIHRoZSBtb2RlIHdpdGggaGlnaGVzdCByZWZyZXNoIHJh
dGUgd2l0aCBzYW1lIHJlc29sdXRpb24uCisJICogRm9yIHNvbWUgbW9uaXRvcnMsIHByZWZlcnJl
ZCBtb2RlIGlzIG5vdCB0aGUgbW9kZSB3aXRoIGhpZ2hlc3QKKwkgKiBzdXBwb3J0ZWQgcmVmcmVz
aCByYXRlLgorCSAqLworCWxpc3RfZm9yX2VhY2hfZW50cnkgKG0sIGxpc3RfaGVhZCwgaGVhZCkg
eworCQljdXJyZW50X3JlZnJlc2ggID0gZHJtX21vZGVfdnJlZnJlc2gobSk7CisKKwkJaWYgKG0t
PmhkaXNwbGF5ID09IG1fcHJlZi0+aGRpc3BsYXkgJiYKKwkJICAgIG0tPnZkaXNwbGF5ID09IG1f
cHJlZi0+dmRpc3BsYXkgJiYKKwkJICAgIGhpZ2hlc3RfcmVmcmVzaCA8IGN1cnJlbnRfcmVmcmVz
aCkgeworCQkJaGlnaGVzdF9yZWZyZXNoID0gY3VycmVudF9yZWZyZXNoOworCQkJbV9wcmVmID0g
bTsKKwkJfQorCX0KKworCWFjb25uZWN0b3ItPmZyZWVzeW5jX3ZpZF9iYXNlID0gKm1fcHJlZjsK
KwlyZXR1cm4gbV9wcmVmOworfQorCiBzdGF0aWMgc3RydWN0IGRjX3N0cmVhbV9zdGF0ZSAqCiBj
cmVhdGVfc3RyZWFtX2Zvcl9zaW5rKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICphY29ubmVj
dG9yLAogCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRybV9tb2RlLApA
QCAtNzAwMCw2ICs3MDUzLDExMSBAQCBzdGF0aWMgdm9pZCBhbWRncHVfZG1fY29ubmVjdG9yX2Rk
Y19nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAl9CiB9CiAKK3N0
YXRpYyBib29sIGlzX2R1cGxpY2F0ZV9tb2RlKHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yICph
Y29ubmVjdG9yLAorCQkJICAgICAgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCit7CisJ
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm07CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5IChtLCAm
YWNvbm5lY3Rvci0+YmFzZS5wcm9iZWRfbW9kZXMsIGhlYWQpIHsKKwkJaWYgKGRybV9tb2RlX2Vx
dWFsKG0sIG1vZGUpKQorCQkJcmV0dXJuIHRydWU7CisJfQorCisJcmV0dXJuIGZhbHNlOworfQor
CitzdGF0aWMgdWludCBhZGRfZnNfbW9kZXMoc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFj
b25uZWN0b3IpCit7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm07CisJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm5ld19tb2RlOworCXVpbnQgaTsKKwl1aW50MzJfdCBuZXdfbW9k
ZXNfY291bnQgPSAwOworCisJLyogU3RhbmRhcmQgRlBTIHZhbHVlcworCSAqCisJICogMjMuOTc2
ICAgLSBUVi9OVFNDCisJICogMjQgCSAgICAtIENpbmVtYQorCSAqIDI1IAkgICAgLSBUVi9QQUwK
KwkgKiAyOS45NyAgICAtIFRWL05UU0MKKwkgKiAzMCAJICAgIC0gVFYvTlRTQworCSAqIDQ4IAkg
ICAgLSBDaW5lbWEgSEZSCisJICogNTAgCSAgICAtIFRWL1BBTAorCSAqIDYwIAkgICAgLSBDb21t
b25seSB1c2VkCisJICogNDgsNzIsOTYgLSBNdWx0aXBsZXMgb2YgMjQKKwkgKi8KKwljb25zdCB1
aW50MzJfdCBjb21tb25fcmF0ZXNbXSA9IHsgMjM5NzYsIDI0MDAwLCAyNTAwMCwgMjk5NzAsIDMw
MDAwLAorCQkJCQkgNDgwMDAsIDUwMDAwLCA2MDAwMCwgNzIwMDAsIDk2MDAwIH07CisKKwkvKgor
CSAqIEZpbmQgbW9kZSB3aXRoIGhpZ2hlc3QgcmVmcmVzaCByYXRlIHdpdGggdGhlIHNhbWUgcmVz
b2x1dGlvbgorCSAqIGFzIHRoZSBwcmVmZXJyZWQgbW9kZS4gU29tZSBtb25pdG9ycyByZXBvcnQg
YSBwcmVmZXJyZWQgbW9kZQorCSAqIHdpdGggbG93ZXIgcmVzb2x1dGlvbiB0aGFuIHRoZSBoaWdo
ZXN0IHJlZnJlc2ggcmF0ZSBzdXBwb3J0ZWQuCisJICovCisKKwltID0gZ2V0X2hpZ2hlc3RfcmVm
cmVzaF9yYXRlX21vZGUoYWNvbm5lY3RvciwgdHJ1ZSk7CisJaWYgKCFtKQorCQlyZXR1cm4gMDsK
KworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNvbW1vbl9yYXRlcyk7IGkrKykgeworCQl1
aW50NjRfdCB0YXJnZXRfdnRvdGFsLCB0YXJnZXRfdnRvdGFsX2RpZmY7CisJCXVpbnQ2NF90IG51
bSwgZGVuOworCisJCWlmIChkcm1fbW9kZV92cmVmcmVzaChtKSAqIDEwMDAgPCBjb21tb25fcmF0
ZXNbaV0pCisJCQljb250aW51ZTsKKworCQlpZiAoY29tbW9uX3JhdGVzW2ldIDwgYWNvbm5lY3Rv
ci0+bWluX3ZmcmVxICogMTAwMCB8fAorCQkgICAgY29tbW9uX3JhdGVzW2ldID4gYWNvbm5lY3Rv
ci0+bWF4X3ZmcmVxICogMTAwMCkKKwkJCWNvbnRpbnVlOworCisJCW51bSA9ICh1bnNpZ25lZCBs
b25nIGxvbmcpbS0+Y2xvY2sgKiAxMDAwICogMTAwMDsKKwkJZGVuID0gY29tbW9uX3JhdGVzW2ld
ICogKHVuc2lnbmVkIGxvbmcgbG9uZyltLT5odG90YWw7CisJCXRhcmdldF92dG90YWwgPSBkaXZf
dTY0KG51bSwgZGVuKTsKKwkJdGFyZ2V0X3Z0b3RhbF9kaWZmID0gdGFyZ2V0X3Z0b3RhbCAtIG0t
PnZ0b3RhbDsKKworCQkvKiBDaGVjayBmb3IgaWxsZWdhbCBtb2RlcyAqLworCQlpZiAobS0+dnN5
bmNfc3RhcnQgKyB0YXJnZXRfdnRvdGFsX2RpZmYgPCBtLT52ZGlzcGxheSB8fAorCQkgICAgbS0+
dnN5bmNfZW5kICsgdGFyZ2V0X3Z0b3RhbF9kaWZmIDwgbS0+dnN5bmNfc3RhcnQgfHwKKwkJICAg
IG0tPnZ0b3RhbCArIHRhcmdldF92dG90YWxfZGlmZiA8IG0tPnZzeW5jX2VuZCkKKwkJCWNvbnRp
bnVlOworCisJCW5ld19tb2RlID0gZHJtX21vZGVfZHVwbGljYXRlKGFjb25uZWN0b3ItPmJhc2Uu
ZGV2LCBtKTsKKwkJaWYgKCFuZXdfbW9kZSkKKwkJCWdvdG8gb3V0OworCisJCW5ld19tb2RlLT52
dG90YWwgKz0gKHUxNil0YXJnZXRfdnRvdGFsX2RpZmY7CisJCW5ld19tb2RlLT52c3luY19zdGFy
dCArPSAodTE2KXRhcmdldF92dG90YWxfZGlmZjsKKwkJbmV3X21vZGUtPnZzeW5jX2VuZCArPSAo
dTE2KXRhcmdldF92dG90YWxfZGlmZjsKKwkJbmV3X21vZGUtPnR5cGUgJj0gfkRSTV9NT0RFX1RZ
UEVfUFJFRkVSUkVEOworCQluZXdfbW9kZS0+dHlwZSB8PSBEUk1fTU9ERV9UWVBFX0RSSVZFUjsK
KworCQlpZiAoIWlzX2R1cGxpY2F0ZV9tb2RlKGFjb25uZWN0b3IsIG5ld19tb2RlKSkgeworCQkJ
ZHJtX21vZGVfcHJvYmVkX2FkZCgmYWNvbm5lY3Rvci0+YmFzZSwgbmV3X21vZGUpOworCQkJbmV3
X21vZGVzX2NvdW50ICs9IDE7CisJCX0gZWxzZQorCQkJZHJtX21vZGVfZGVzdHJveShhY29ubmVj
dG9yLT5iYXNlLmRldiwgbmV3X21vZGUpOworCX0KKyBvdXQ6CisJcmV0dXJuIG5ld19tb2Rlc19j
b3VudDsKK30KKworc3RhdGljIHZvaWQgYW1kZ3B1X2RtX2Nvbm5lY3Rvcl9hZGRfZnJlZXN5bmNf
bW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJCQkJCSAgIHN0cnVjdCBl
ZGlkICplZGlkKQoreworCXVpbnQ4X3QgaTsKKwlzdHJ1Y3QgZGV0YWlsZWRfdGltaW5nICp0aW1p
bmc7CisJc3RydWN0IGRldGFpbGVkX25vbl9waXhlbCAqZGF0YTsKKwlzdHJ1Y3QgZGV0YWlsZWRf
ZGF0YV9tb25pdG9yX3JhbmdlICpyYW5nZTsKKwlzdHJ1Y3QgYW1kZ3B1X2RtX2Nvbm5lY3RvciAq
YW1kZ3B1X2RtX2Nvbm5lY3RvciA9CisJCXRvX2FtZGdwdV9kbV9jb25uZWN0b3IoY29ubmVjdG9y
KTsKKworCWlmICghKGFtZGdwdV9leHBfZnJlZXN5bmNfdmlkX21vZGUgJiYgZWRpZCkpCisJCXJl
dHVybjsKKwkKKwlpZiAoYW1kZ3B1X2RtX2Nvbm5lY3Rvci0+bWF4X3ZmcmVxIC0gYW1kZ3B1X2Rt
X2Nvbm5lY3Rvci0+bWluX3ZmcmVxID4gMTApCisJCWFtZGdwdV9kbV9jb25uZWN0b3ItPm51bV9t
b2RlcyArPQorCQkJYWRkX2ZzX21vZGVzKGFtZGdwdV9kbV9jb25uZWN0b3IpOworfQorCiBzdGF0
aWMgaW50IGFtZGdwdV9kbV9jb25uZWN0b3JfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IpCiB7CiAJc3RydWN0IGFtZGdwdV9kbV9jb25uZWN0b3IgKmFtZGdwdV9kbV9j
b25uZWN0b3IgPQpAQCAtNzAxNSw2ICs3MTczLDcgQEAgc3RhdGljIGludCBhbWRncHVfZG1fY29u
bmVjdG9yX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCX0gZWxz
ZSB7CiAJCWFtZGdwdV9kbV9jb25uZWN0b3JfZGRjX2dldF9tb2Rlcyhjb25uZWN0b3IsIGVkaWQp
OwogCQlhbWRncHVfZG1fY29ubmVjdG9yX2FkZF9jb21tb25fbW9kZXMoZW5jb2RlciwgY29ubmVj
dG9yKTsKKwkJYW1kZ3B1X2RtX2Nvbm5lY3Rvcl9hZGRfZnJlZXN5bmNfbW9kZXMoY29ubmVjdG9y
LCBlZGlkKTsKIAl9CiAJYW1kZ3B1X2RtX2ZiY19pbml0KGNvbm5lY3Rvcik7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmggYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5oCmluZGV4IDM4
YmMwZjg4YjI5Yy4uNzQ3ZTQxMGY1MGI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1k
L2Rpc3BsYXkvYW1kZ3B1X2RtL2FtZGdwdV9kbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQv
ZGlzcGxheS9hbWRncHVfZG0vYW1kZ3B1X2RtLmgKQEAgLTQxMyw2ICs0MTMsOCBAQCBzdHJ1Y3Qg
YW1kZ3B1X2RtX2Nvbm5lY3RvciB7CiAjZW5kaWYKIAlib29sIGZvcmNlX3l1djQyMF9vdXRwdXQ7
CiAJc3RydWN0IGRzY19wcmVmZXJyZWRfc2V0dGluZ3MgZHNjX3NldHRpbmdzOworCS8qIENhY2hl
ZCBkaXNwbGF5IG1vZGVzICovCisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgZnJlZXN5bmNfdmlk
X2Jhc2U7CiB9OwogCiAjZGVmaW5lIHRvX2FtZGdwdV9kbV9jb25uZWN0b3IoeCkgY29udGFpbmVy
X29mKHgsIHN0cnVjdCBhbWRncHVfZG1fY29ubmVjdG9yLCBiYXNlKQotLSAKMi4zMC4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFp
bGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
