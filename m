Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F35A923B30E
	for <lists+dri-devel@lfdr.de>; Tue,  4 Aug 2020 04:58:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 015616E3FB;
	Tue,  4 Aug 2020 02:58:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from us-smtp-delivery-1.mimecast.com (us-smtp-1.mimecast.com
 [205.139.110.61])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A83996E3FB
 for <dri-devel@lists.freedesktop.org>; Tue,  4 Aug 2020 02:58:45 +0000 (UTC)
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-86-srbyL8hGNKiLhj0IDk6Aeg-1; Mon, 03 Aug 2020 22:58:38 -0400
X-MC-Unique: srbyL8hGNKiLhj0IDk6Aeg-1
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 6B42D100AA22;
 Tue,  4 Aug 2020 02:58:37 +0000 (UTC)
Received: from tyrion-bne-redhat-com.redhat.com (vpn2-54-17.bne.redhat.com
 [10.64.54.17])
 by smtp.corp.redhat.com (Postfix) with ESMTP id C055F90E68;
 Tue,  4 Aug 2020 02:58:35 +0000 (UTC)
From: Dave Airlie <airlied@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 47/59] drm/ttm: move range manager to subclassed driver
 allocation
Date: Tue,  4 Aug 2020 12:56:20 +1000
Message-Id: <20200804025632.3868079-48-airlied@gmail.com>
In-Reply-To: <20200804025632.3868079-1-airlied@gmail.com>
References: <20200804025632.3868079-1-airlied@gmail.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: gmail.com
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: sroland@vmware.com, christian.koenig@amd.com,
 linux-graphics-maintainer@vmware.com, bskeggs@redhat.com, kraxel@redhat.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClJldmlld2VkLWJ5OiBDaHJp
c3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IERh
dmUgQWlybGllIDxhaXJsaWVkQHJlZGhhdC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fYm9fbWFuYWdlci5jIHwgMzEgKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDEyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX21hbmFnZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2JvX21hbmFnZXIuYwppbmRleCBkODNjYjk2N2ExMDcuLjAxZDQxYzZmMmY3YiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fbWFuYWdlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS90dG0vdHRtX2JvX21hbmFnZXIuYwpAQCAtNDQsMTYgKzQ0LDIyIEBACiAgKi8K
IAogc3RydWN0IHR0bV9yYW5nZV9tYW5hZ2VyIHsKKwlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFn
ZXIgbWFuYWdlcjsKIAlzdHJ1Y3QgZHJtX21tIG1tOwogCXNwaW5sb2NrX3QgbG9jazsKIH07CiAK
K3N0YXRpYyBpbmxpbmUgc3RydWN0IHR0bV9yYW5nZV9tYW5hZ2VyICp0b19yYW5nZV9tYW5hZ2Vy
KHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuKQoreworCXJldHVybiBjb250YWluZXJf
b2YobWFuLCBzdHJ1Y3QgdHRtX3JhbmdlX21hbmFnZXIsIG1hbmFnZXIpOworfQorCiBzdGF0aWMg
aW50IHR0bV9ib19tYW5fZ2V0X25vZGUoc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4s
CiAJCQkgICAgICAgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJCSAgICAgICBjb25z
dCBzdHJ1Y3QgdHRtX3BsYWNlICpwbGFjZSwKIAkJCSAgICAgICBzdHJ1Y3QgdHRtX21lbV9yZWcg
Km1lbSkKIHsKLQlzdHJ1Y3QgdHRtX3JhbmdlX21hbmFnZXIgKnJtYW4gPSAoc3RydWN0IHR0bV9y
YW5nZV9tYW5hZ2VyICopIG1hbi0+cHJpdjsKKwlzdHJ1Y3QgdHRtX3JhbmdlX21hbmFnZXIgKnJt
YW4gPSB0b19yYW5nZV9tYW5hZ2VyKG1hbik7CiAJc3RydWN0IGRybV9tbSAqbW0gPSAmcm1hbi0+
bW07CiAJc3RydWN0IGRybV9tbV9ub2RlICpub2RlOwogCWVudW0gZHJtX21tX2luc2VydF9tb2Rl
IG1vZGU7CkBAIC05Miw3ICs5OCw3IEBAIHN0YXRpYyBpbnQgdHRtX2JvX21hbl9nZXRfbm9kZShz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiwKIHN0YXRpYyB2b2lkIHR0bV9ib19tYW5f
cHV0X25vZGUoc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4sCiAJCQkJc3RydWN0IHR0
bV9tZW1fcmVnICptZW0pCiB7Ci0Jc3RydWN0IHR0bV9yYW5nZV9tYW5hZ2VyICpybWFuID0gKHN0
cnVjdCB0dG1fcmFuZ2VfbWFuYWdlciAqKSBtYW4tPnByaXY7CisJc3RydWN0IHR0bV9yYW5nZV9t
YW5hZ2VyICpybWFuID0gdG9fcmFuZ2VfbWFuYWdlcihtYW4pOwogCiAJaWYgKG1lbS0+bW1fbm9k
ZSkgewogCQlzcGluX2xvY2soJnJtYW4tPmxvY2spOwpAQCAtMTEzLDI1ICsxMTksMjYgQEAgaW50
IHR0bV9yYW5nZV9tYW5faW5pdChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJICAgICAg
IGJvb2wgdXNlX3R0LAogCQkgICAgICAgdW5zaWduZWQgbG9uZyBwX3NpemUpCiB7Ci0Jc3RydWN0
IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSB0dG1fbWFuYWdlcl90eXBlKGJkZXYsIHR5cGUp
OworCXN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuOwogCXN0cnVjdCB0dG1fcmFuZ2Vf
bWFuYWdlciAqcm1hbjsKIAotCW1hbi0+YXZhaWxhYmxlX2NhY2hpbmcgPSBhdmFpbGFibGVfY2Fj
aGluZzsKLQltYW4tPmRlZmF1bHRfY2FjaGluZyA9IGRlZmF1bHRfY2FjaGluZzsKLQltYW4tPnVz
ZV90dCA9IHVzZV90dDsKLQogCXJtYW4gPSBremFsbG9jKHNpemVvZigqcm1hbiksIEdGUF9LRVJO
RUwpOwogCWlmICghcm1hbikKIAkJcmV0dXJuIC1FTk9NRU07CiAKKwltYW4gPSAmcm1hbi0+bWFu
YWdlcjsKKwltYW4tPmF2YWlsYWJsZV9jYWNoaW5nID0gYXZhaWxhYmxlX2NhY2hpbmc7CisJbWFu
LT5kZWZhdWx0X2NhY2hpbmcgPSBkZWZhdWx0X2NhY2hpbmc7CisJbWFuLT51c2VfdHQgPSB1c2Vf
dHQ7CisKIAltYW4tPmZ1bmMgPSAmdHRtX2JvX21hbmFnZXJfZnVuYzsKIAogCXR0bV9tZW1fdHlw
ZV9tYW5hZ2VyX2luaXQoYmRldiwgbWFuLCBwX3NpemUpOwogCiAJZHJtX21tX2luaXQoJnJtYW4t
Pm1tLCAwLCBwX3NpemUpOwogCXNwaW5fbG9ja19pbml0KCZybWFuLT5sb2NrKTsKLQltYW4tPnBy
aXYgPSBybWFuOwogCisJdHRtX3NldF9kcml2ZXJfbWFuYWdlcihiZGV2LCB0eXBlLCAmcm1hbi0+
bWFuYWdlcik7CiAJdHRtX21lbV90eXBlX21hbmFnZXJfc2V0X3VzZWQobWFuLCB0cnVlKTsKIAly
ZXR1cm4gMDsKIH0KQEAgLTE0MSw3ICsxNDgsNyBAQCBpbnQgdHRtX3JhbmdlX21hbl9maW5pKHN0
cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCQkgICAgICAgdW5zaWduZWQgdHlwZSkKIHsKIAlz
dHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9IHR0bV9tYW5hZ2VyX3R5cGUoYmRldiwg
dHlwZSk7Ci0Jc3RydWN0IHR0bV9yYW5nZV9tYW5hZ2VyICpybWFuID0gKHN0cnVjdCB0dG1fcmFu
Z2VfbWFuYWdlciAqKSBtYW4tPnByaXY7CisJc3RydWN0IHR0bV9yYW5nZV9tYW5hZ2VyICpybWFu
ID0gdG9fcmFuZ2VfbWFuYWdlcihtYW4pOwogCXN0cnVjdCBkcm1fbW0gKm1tID0gJnJtYW4tPm1t
OwogCWludCByZXQ7CiAKQEAgLTE1NSwxMCArMTYyLDEwIEBAIGludCB0dG1fcmFuZ2VfbWFuX2Zp
bmkoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCiAJZHJtX21tX2NsZWFuKG1tKTsKIAlkcm1f
bW1fdGFrZWRvd24obW0pOwogCXNwaW5fdW5sb2NrKCZybWFuLT5sb2NrKTsKLQlrZnJlZShybWFu
KTsKLQltYW4tPnByaXYgPSBOVUxMOwogCiAJdHRtX21lbV90eXBlX21hbmFnZXJfY2xlYW51cCht
YW4pOworCXR0bV9zZXRfZHJpdmVyX21hbmFnZXIoYmRldiwgdHlwZSwgTlVMTCk7CisJa2ZyZWUo
cm1hbik7CiAJcmV0dXJuIDA7CiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9yYW5nZV9tYW5fZmluaSk7
CkBAIC0xNjYsNyArMTczLDcgQEAgRVhQT1JUX1NZTUJPTCh0dG1fcmFuZ2VfbWFuX2ZpbmkpOwog
c3RhdGljIHZvaWQgdHRtX2JvX21hbl9kZWJ1ZyhzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIg
Km1hbiwKIAkJCSAgICAgc3RydWN0IGRybV9wcmludGVyICpwcmludGVyKQogewotCXN0cnVjdCB0
dG1fcmFuZ2VfbWFuYWdlciAqcm1hbiA9IChzdHJ1Y3QgdHRtX3JhbmdlX21hbmFnZXIgKikgbWFu
LT5wcml2OworCXN0cnVjdCB0dG1fcmFuZ2VfbWFuYWdlciAqcm1hbiA9IHRvX3JhbmdlX21hbmFn
ZXIobWFuKTsKIAogCXNwaW5fbG9jaygmcm1hbi0+bG9jayk7CiAJZHJtX21tX3ByaW50KCZybWFu
LT5tbSwgcHJpbnRlcik7Ci0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbAo=
