Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 34C0D2A2BC5
	for <lists+dri-devel@lfdr.de>; Mon,  2 Nov 2020 14:43:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 99C356EB41;
	Mon,  2 Nov 2020 13:43:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from wout5-smtp.messagingengine.com (wout5-smtp.messagingengine.com
 [64.147.123.21])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 546AF6E0B8
 for <dri-devel@lists.freedesktop.org>; Mon,  2 Nov 2020 13:38:43 +0000 (UTC)
Received: from compute6.internal (compute6.nyi.internal [10.202.2.46])
 by mailout.west.internal (Postfix) with ESMTP id B510FCCB;
 Mon,  2 Nov 2020 08:38:39 -0500 (EST)
Received: from mailfrontend2 ([10.202.2.163])
 by compute6.internal (MEProxy); Mon, 02 Nov 2020 08:38:40 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=cerno.tech; h=
 from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-type:content-transfer-encoding; s=fm1; bh=
 zBKhMMMSbtCUi4qonHbLU+eYIfAp0Wxup7TMhxJzpEQ=; b=nHqTv3TT1zaIunhl
 wlwwByaqb8wBsvx6YY9YwK9RZ/ImV1doSnlQJ4VRo2xBgzeBPBPp8BYd3KLP+C4y
 LvG2j0ajpszZqFNOmgLXb07lXMNSeGf1DJTSVeHgYFTR7tvMkH7wwav3vs6bbvZX
 fPyERkuIamc5Sf0Z2cNHXX1MWazqv6BfRACUNf8qaHVjuf5q/GGZqcJ9e+gplc/e
 I2dIKVoVMzPlUQuQdbRjlUuSG3HHMFvsjGy9twWsVqjg9rmDBfp4k7Z02rvd4pSq
 BYqxMzNHFOGUc0mhCxPV5VTHx85WZ1Z2zR+EEf01akxW6TWOaUl+VhJCo/lLhwms
 2EL/4Q==
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=
 messagingengine.com; h=cc:content-transfer-encoding:content-type
 :date:from:in-reply-to:message-id:mime-version:references
 :subject:to:x-me-proxy:x-me-proxy:x-me-sender:x-me-sender
 :x-sasl-enc; s=fm1; bh=zBKhMMMSbtCUi4qonHbLU+eYIfAp0Wxup7TMhxJzp
 EQ=; b=gyAWp9Mn7FbwgJOjGxpPH/UCe2P5+WZmcwo25TGwAI44qMW4duRa+QtVA
 QWZ+sQWZuuyWBSLMHQB4bAb5mS6UhRUxdkfaO3dvJ8kKSATeILeg8xixetce+6gA
 p57aNoj3KTwMgfHR7LWkZ+kSycRle7jsiuu5tFHnDNU56wELWe3RboZ1kzhaF8ls
 tJj+kShXThun/BnZsscfnkk+ixXgy/0N+u5DM4WcQBCnbfhKvZYFxpJmEm5ipcsF
 JWlc0xJPEhr/XcTEonxAYGqhju8WtElZzOnih9W3TIYG+E1bHjwrl49i5GFqGX+Z
 4FfFBhmraHZo+ixdse7QcQiZvMxJA==
X-ME-Sender: <xms:3wugX19cGya_GuuimVRx_ESxRA4BIm5RkIZ1ZN2mpnskqHhks17grQ>
 <xme:3wugX5vKLaD1jfec-6NvssL-1SUxdrOesvFpP5UcPC3r_orqItSKJoOIGNesh8Nge
 E1Jj81tzFox0qUX378>
X-ME-Proxy-Cause: gggruggvucftvghtrhhoucdtuddrgedujedruddtuddgheegucetufdoteggodetrfdotf
 fvucfrrhhofhhilhgvmecuhfgrshhtofgrihhlpdfqfgfvpdfurfetoffkrfgpnffqhgen
 uceurghilhhouhhtmecufedttdenucesvcftvggtihhpihgvnhhtshculddquddttddmne
 cujfgurhephffvufffkffojghfgggtgfesthekredtredtjeenucfhrhhomhepofgrgihi
 mhgvucftihhprghrugcuoehmrgigihhmvgestggvrhhnohdrthgvtghhqeenucggtffrrg
 htthgvrhhnpeejuefggeekfffgueevtddvudffhfejffejjedvvdduudethefhfefhfeeg
 ieekkeenucfkphepledtrdekledrieekrdejieenucevlhhushhtvghrufhiiigvpedtne
 curfgrrhgrmhepmhgrihhlfhhrohhmpehmrgigihhmvgestggvrhhnohdrthgvtghh
X-ME-Proxy: <xmx:3wugXzDeyn-u4AH6uVufdkJUrm1U4Ef5qzVmdt1kR4SyyDDD17ByOg>
 <xmx:3wugX5cmI2Z5050eLsIoQk-1HRNyrlu9F9Y0Ihdn-kUzwLh2wwIx2w>
 <xmx:3wugX6PcGtN3nVZrYhV3rvH269wZn98snbQp02HbHPnZ9RmTEaRg5w>
 <xmx:3wugX3r23Twi3pVLOM-culJKFdvt3oDUu8roWdxszZKwyN-Lyw1rbQ>
Received: from localhost (lfbn-tou-1-1502-76.w90-89.abo.wanadoo.fr
 [90.89.68.76])
 by mail.messagingengine.com (Postfix) with ESMTPA id D1A6E3064680;
 Mon,  2 Nov 2020 08:38:38 -0500 (EST)
From: Maxime Ripard <maxime@cerno.tech>
To: Daniel Vetter <daniel.vetter@intel.com>, David Airlie <airlied@linux.ie>,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Thomas Zimmermann <tzimmermann@suse.de>, Maxime Ripard <maxime@cerno.tech>
Subject: [PATCH 2/3] drm: Use state helper instead of CRTC state pointer
Date: Mon,  2 Nov 2020 14:38:33 +0100
Message-Id: <20201102133834.1176740-2-maxime@cerno.tech>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20201102133834.1176740-1-maxime@cerno.tech>
References: <20201102133834.1176740-1-maxime@cerno.tech>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 02 Nov 2020 13:43:21 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

TWFueSBkcml2ZXJzIHJlZmVyZW5jZSB0aGUgY3J0Yy0+cG9pbnRlciBpbiBvcmRlciB0byBnZXQg
dGhlIGN1cnJlbnQgQ1JUQwpzdGF0ZSBpbiB0aGVpciBhdG9taWNfYmVnaW4gb3IgYXRvbWljX2Zs
dXNoIGhvb2tzLCB3aGljaCB3b3VsZCBiZSB0aGUgbmV3CkNSVEMgc3RhdGUgaW4gdGhlIGdsb2Jh
bCBhdG9taWMgc3RhdGUgc2luY2UgX3N3YXBfc3RhdGUgaGFwcGVuZWQgd2hlbiB0aG9zZQpob29r
cyBhcmUgcnVuLgoKVXNlIHRoZSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZSBoZWxwZXIg
dG8gZ2V0IHRoYXQgc3RhdGUgdG8gbWFrZSBpdAptb3JlIG9idmlvdXMuCgpUaGlzIHdhcyBtYWRl
IHVzaW5nIHRoZSBjb2NjaW5lbGxlIHNjcmlwdCBiZWxvdzoKCkAgY3J0Y19hdG9taWNfZnVuYyBA
CmlkZW50aWZpZXIgaGVscGVyczsKaWRlbnRpZmllciBmdW5jOwpAQAoKKApzdGF0aWMgc3RydWN0
IGRybV9jcnRjX2hlbHBlcl9mdW5jcyBoZWxwZXJzID0gewoJLi4uLAoJLmF0b21pY19iZWdpbiA9
IGZ1bmMsCgkuLi4sCn07CnwKc3RhdGljIHN0cnVjdCBkcm1fY3J0Y19oZWxwZXJfZnVuY3MgaGVs
cGVycyA9IHsKCS4uLiwKCS5hdG9taWNfZmx1c2ggPSBmdW5jLAoJLi4uLAp9OwopCgpAQAppZGVu
dGlmaWVyIGNydGNfYXRvbWljX2Z1bmMuZnVuYzsKaWRlbnRpZmllciBjcnRjLCBzdGF0ZTsKc3lt
Ym9sIGNydGNfc3RhdGU7CmV4cHJlc3Npb24gZTsKQEAKCiAgZnVuYyhzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkgewogIC4uLgotIHN0cnVjdCB0
ZWdyYV9kY19zdGF0ZSAqY3J0Y19zdGF0ZSA9IGU7Cisgc3RydWN0IHRlZ3JhX2RjX3N0YXRlICpk
Y19zdGF0ZSA9IGU7CiAgPCsuLi4KLSAgICAgICBjcnRjX3N0YXRlCisJZGNfc3RhdGUKICAuLi4r
PgogIH0KCkBACmlkZW50aWZpZXIgY3J0Y19hdG9taWNfZnVuYy5mdW5jOwppZGVudGlmaWVyIGNy
dGMsIHN0YXRlOwpzeW1ib2wgY3J0Y19zdGF0ZTsKZXhwcmVzc2lvbiBlOwpAQAoKICBmdW5jKHN0
cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKSB7CiAg
Li4uCi0gc3RydWN0IG10a19jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gZTsKKyBzdHJ1Y3QgbXRr
X2NydGNfc3RhdGUgKm10a19jcnRjX3N0YXRlID0gZTsKICA8Ky4uLgotICAgICAgIGNydGNfc3Rh
dGUKKwltdGtfY3J0Y19zdGF0ZQogIC4uLis+CiAgfQoKQCByZXBsYWNlc19uZXdfc3RhdGUgQApp
ZGVudGlmaWVyIGNydGNfYXRvbWljX2Z1bmMuZnVuYzsKaWRlbnRpZmllciBjcnRjLCBzdGF0ZSwg
Y3J0Y19zdGF0ZTsKQEAKCiAgZnVuYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSkgewogIC4uLgotIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSA9IGNydGMtPnN0YXRlOworIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSA9IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKICAuLi4KIH0K
CkBACmlkZW50aWZpZXIgY3J0Y19hdG9taWNfZnVuYy5mdW5jOwppZGVudGlmaWVyIGNydGMsIHN0
YXRlLCBjcnRjX3N0YXRlOwpAQAoKICBmdW5jKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKSB7CiAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogIC4u
LgotIGNydGMtPnN0YXRlCisgY3J0Y19zdGF0ZQogIC4uLgogfQoKQCBhZGRzX25ld19zdGF0ZSBA
CmlkZW50aWZpZXIgY3J0Y19hdG9taWNfZnVuYy5mdW5jOwppZGVudGlmaWVyIGNydGMsIHN0YXRl
OwpAQAoKICBmdW5jKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKSB7Cisgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gZHJtX2F0
b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogIC4uLgotIGNydGMtPnN0YXRl
CisgY3J0Y19zdGF0ZQogIC4uLgogfQoKQCBpbmNsdWRlIGRlcGVuZHMgb24gYWRkc19uZXdfc3Rh
dGUgfHwgcmVwbGFjZXNfbmV3X3N0YXRlIEAKQEAKCiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMu
aD4KCkAgbm9faW5jbHVkZSBkZXBlbmRzIG9uICFpbmNsdWRlICYmIChhZGRzX25ld19zdGF0ZSB8
fCByZXBsYWNlc19uZXdfc3RhdGUpIEAKQEAKCisgI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+
CiAgI2luY2x1ZGUgPGRybS8uLi4+CgpTdWdnZXN0ZWQtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmls
bGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IE1heGltZSBSaXBhcmQg
PG1heGltZUBjZXJuby50ZWNoPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9hcm0vZGlzcGxheS9rb21l
ZGEva29tZWRhX2NydGMuYyB8ICA0ICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9hcm1hZGEvYXJtYWRh
X2NydGMuYyAgICAgICAgICAgICB8ICA4ICsrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2Fz
dF9tb2RlLmMgICAgICAgICAgICAgICAgICAgfCAgNCArKystCiBkcml2ZXJzL2dwdS9kcm0vaW5n
ZW5pYy9pbmdlbmljLWRybS1kcnYuYyAgICAgICAgfCAgNyArKysrKy0tCiBkcml2ZXJzL2dwdS9k
cm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMgICAgICAgICAgfCAxNSArKysrKysrKystLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMgICAgICB8ICA2ICsr
KystLQogZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RjLmMgICAgICAgICAgICAgICAgICAgICAgIHwg
IDggKysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kaXNwbGF5LmMgICAg
ICAgICB8ICA0ICsrKy0KIDggZmlsZXMgY2hhbmdlZCwgMzggaW5zZXJ0aW9ucygrKSwgMTggZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVk
YS9rb21lZGFfY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21l
ZGFfY3J0Yy5jCmluZGV4IGRmMGI5ZWViODkzMy4uNGI0ODVlYjUxMmUyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYXJtL2Rpc3BsYXkva29tZWRhL2tvbWVkYV9jcnRjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2FybS9kaXNwbGF5L2tvbWVkYS9rb21lZGFfY3J0Yy5jCkBAIC0zODcsMTAg
KzM4NywxMiBAQCBzdGF0aWMgdm9pZAoga29tZWRhX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBk
cm1fY3J0YyAqY3J0YywKIAkJCSBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CisJ
c3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2Ny
dGNfc3RhdGUoc3RhdGUsCisJCQkJCQkJCQkgIGNydGMpOwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqb2xkID0gZHJtX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsCiAJCQkJCQkJCSAg
IGNydGMpOwogCS8qIGNvbW1pdCB3aXRoIG1vZGVzZXQgd2lsbCBiZSBoYW5kbGVkIGluIGVuYWJs
ZS9kaXNhYmxlICovCi0JaWYgKGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNydGMtPnN0
YXRlKSkKKwlpZiAoZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkpCiAJ
CXJldHVybjsKIAogCWtvbWVkYV9jcnRjX2RvX2ZsdXNoKGNydGMsIG9sZCk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vYXJtYWRhL2FybWFkYV9jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0v
YXJtYWRhL2FybWFkYV9jcnRjLmMKaW5kZXggY2E2NDNmNGUyMDY0Li4zZWJjZjVhNTJjOGIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hcm1hZGEvYXJtYWRhX2NydGMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vYXJtYWRhL2FybWFkYV9jcnRjLmMKQEAgLTQzMSwxMSArNDMxLDEzIEBAIHN0
YXRpYyBpbnQgYXJtYWRhX2RybV9jcnRjX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCiBzdGF0aWMgdm9pZCBhcm1hZGFfZHJtX2NydGNfYXRvbWljX2JlZ2luKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywKIAkJCQkJIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKKwlz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0
Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCQkJCSAgY3J0Yyk7CiAJc3RydWN0IGFybWFkYV9jcnRjICpk
Y3J0YyA9IGRybV90b19hcm1hZGFfY3J0YyhjcnRjKTsKIAogCURSTV9ERUJVR19LTVMoIltDUlRD
OiVkOiVzXVxuIiwgY3J0Yy0+YmFzZS5pZCwgY3J0Yy0+bmFtZSk7CiAKLQlpZiAoY3J0Yy0+c3Rh
dGUtPmNvbG9yX21nbXRfY2hhbmdlZCkKKwlpZiAoY3J0Y19zdGF0ZS0+Y29sb3JfbWdtdF9jaGFu
Z2VkKQogCQlhcm1hZGFfZHJtX3VwZGF0ZV9nYW1tYShjcnRjKTsKIAogCWRjcnRjLT5yZWdzX2lk
eCA9IDA7CkBAIC00NDUsNiArNDQ3LDggQEAgc3RhdGljIHZvaWQgYXJtYWRhX2RybV9jcnRjX2F0
b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCBhcm1hZGFfZHJt
X2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkJIHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCQkJCSAg
Y3J0Yyk7CiAJc3RydWN0IGFybWFkYV9jcnRjICpkY3J0YyA9IGRybV90b19hcm1hZGFfY3J0Yyhj
cnRjKTsKIAogCURSTV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXVxuIiwgY3J0Yy0+YmFzZS5pZCwg
Y3J0Yy0+bmFtZSk7CkBAIC00NTUsNyArNDU5LDcgQEAgc3RhdGljIHZvaWQgYXJtYWRhX2RybV9j
cnRjX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJICogSWYgd2UgYXJlbid0
IGRvaW5nIGEgZnVsbCBtb2Rlc2V0LCB0aGVuIHdlIG5lZWQgdG8gcXVldWUKIAkgKiB0aGUgZXZl
bnQgaGVyZS4KIAkgKi8KLQlpZiAoIWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNydGMt
PnN0YXRlKSkgeworCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoY3J0Y19zdGF0
ZSkpIHsKIAkJZGNydGMtPnVwZGF0ZV9wZW5kaW5nID0gdHJ1ZTsKIAkJYXJtYWRhX2RybV9jcnRj
X3F1ZXVlX3N0YXRlX2V2ZW50KGNydGMpOwogCQlzcGluX2xvY2tfaXJxKCZkY3J0Yy0+aXJxX2xv
Y2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCmluZGV4IDIyZjBlNjVmYmU5YS4uODdjNWM1ZjM1ZjEw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tb2RlLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2FzdC9hc3RfbW9kZS5jCkBAIC03ODIsMTAgKzc4MiwxMiBAQCBzdGF0aWMgdm9p
ZAogYXN0X2NydGNfaGVscGVyX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJ
CQkgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKKwlzdHJ1Y3QgZHJtX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0
ZSwKKwkJCQkJCQkJICAgICAgICAgIGNydGMpOwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwKIAkJCQkJ
CQkJCSAgICAgIGNydGMpOwogCXN0cnVjdCBhc3RfcHJpdmF0ZSAqYXN0ID0gdG9fYXN0X3ByaXZh
dGUoY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgYXN0X2NydGNfc3RhdGUgKmFzdF9jcnRjX3N0YXRlID0g
dG9fYXN0X2NydGNfc3RhdGUoY3J0Yy0+c3RhdGUpOworCXN0cnVjdCBhc3RfY3J0Y19zdGF0ZSAq
YXN0X2NydGNfc3RhdGUgPSB0b19hc3RfY3J0Y19zdGF0ZShjcnRjX3N0YXRlKTsKIAlzdHJ1Y3Qg
YXN0X2NydGNfc3RhdGUgKm9sZF9hc3RfY3J0Y19zdGF0ZSA9IHRvX2FzdF9jcnRjX3N0YXRlKG9s
ZF9jcnRjX3N0YXRlKTsKIAogCS8qCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaW5nZW5p
Yy9pbmdlbmljLWRybS1kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pbmdlbmljL2luZ2VuaWMtZHJt
LWRydi5jCmluZGV4IGI5YzE1NmUxMzE1Ni4uNzYwM2Y4NmRkMGQxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaW5nZW5pYy9pbmdlbmljLWRybS1kcnYuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaW5nZW5pYy9pbmdlbmljLWRybS1kcnYuYwpAQCAtMzA1LDExICszMDUsMTMgQEAgaW5nZW5p
Y19kcm1fY3J0Y19tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUKIHN0YXRpYyB2b2lkIGluZ2VuaWNfZHJtX2NydGNfYXRvbWljX2Jl
Z2luKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiB7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gZHJtX2F0
b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsCisJCQkJCQkJCQkgIGNydGMpOwogCXN0cnVj
dCBpbmdlbmljX2RybSAqcHJpdiA9IGRybV9jcnRjX2dldF9wcml2KGNydGMpOwogCXUzMiBjdHJs
ID0gMDsKIAogCWlmIChwcml2LT5zb2NfaW5mby0+aGFzX29zZCAmJgotCSAgICBkcm1fYXRvbWlj
X2NydGNfbmVlZHNfbW9kZXNldChjcnRjLT5zdGF0ZSkpIHsKKwkgICAgZHJtX2F0b21pY19jcnRj
X25lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkpIHsKIAkJLyoKIAkJICogSWYgSVBVIHBsYW5lIGlz
IGVuYWJsZWQsIGVuYWJsZSBJUFUgYXMgc291cmNlIGZvciB0aGUgRjEKIAkJICogcGxhbmU7IG90
aGVyd2lzZSB1c2UgcmVndWxhciBETUEuCkBAIC0zMjYsNyArMzI4LDggQEAgc3RhdGljIHZvaWQg
aW5nZW5pY19kcm1fY3J0Y19hdG9taWNfZmx1c2goc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJ
CQkgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgaW5nZW5pY19k
cm0gKnByaXYgPSBkcm1fY3J0Y19nZXRfcHJpdihjcnRjKTsKLQlzdHJ1Y3QgZHJtX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUgPSBjcnRjLT5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCQkJ
CSAgY3J0Yyk7CiAJc3RydWN0IGRybV9wZW5kaW5nX3ZibGFua19ldmVudCAqZXZlbnQgPSBjcnRj
X3N0YXRlLT5ldmVudDsKIAogCWlmIChkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChjcnRj
X3N0YXRlKSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1f
Y3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5jCmluZGV4IDIz
ZjVjMTBiMGM2Ny4uMTkzODQ4ZmQ3NTE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVk
aWF0ZWsvbXRrX2RybV9jcnRjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19k
cm1fY3J0Yy5jCkBAIC0xMSw2ICsxMSw3IEBACiAjaW5jbHVkZSA8YXNtL2JhcnJpZXIuaD4KICNp
bmNsdWRlIDxzb2MvbWVkaWF0ZWsvc21pLmg+CiAKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5o
PgogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1f
cGxhbmVfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4KQEAgLTU3
NywxNyArNTc4LDE5IEBAIHN0YXRpYyB2b2lkIG10a19kcm1fY3J0Y19hdG9taWNfZGlzYWJsZShz
dHJ1Y3QgZHJtX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCBtdGtfZHJtX2NydGNfYXRvbWljX2Jl
Z2luKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkgICAgICBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IG10a19jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gdG9f
bXRrX2NydGNfc3RhdGUoY3J0Yy0+c3RhdGUpOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLAorCQkJCQkJCQkJ
ICBjcnRjKTsKKwlzdHJ1Y3QgbXRrX2NydGNfc3RhdGUgKm10a19jcnRjX3N0YXRlID0gdG9fbXRr
X2NydGNfc3RhdGUoY3J0Y19zdGF0ZSk7CiAJc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGMg
PSB0b19tdGtfY3J0YyhjcnRjKTsKIAotCWlmIChtdGtfY3J0Yy0+ZXZlbnQgJiYgY3J0Y19zdGF0
ZS0+YmFzZS5ldmVudCkKKwlpZiAobXRrX2NydGMtPmV2ZW50ICYmIG10a19jcnRjX3N0YXRlLT5i
YXNlLmV2ZW50KQogCQlEUk1fRVJST1IoIm5ldyBldmVudCB3aGlsZSB0aGVyZSBpcyBzdGlsbCBh
IHBlbmRpbmcgZXZlbnRcbiIpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuZXZlbnQpIHsKLQkJ
Y3J0Y19zdGF0ZS0+YmFzZS5ldmVudC0+cGlwZSA9IGRybV9jcnRjX2luZGV4KGNydGMpOworCWlm
IChtdGtfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCkgeworCQltdGtfY3J0Y19zdGF0ZS0+YmFzZS5l
dmVudC0+cGlwZSA9IGRybV9jcnRjX2luZGV4KGNydGMpOwogCQlXQVJOX09OKGRybV9jcnRjX3Zi
bGFua19nZXQoY3J0YykgIT0gMCk7Ci0JCW10a19jcnRjLT5ldmVudCA9IGNydGNfc3RhdGUtPmJh
c2UuZXZlbnQ7Ci0JCWNydGNfc3RhdGUtPmJhc2UuZXZlbnQgPSBOVUxMOworCQltdGtfY3J0Yy0+
ZXZlbnQgPSBtdGtfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudDsKKwkJbXRrX2NydGNfc3RhdGUtPmJh
c2UuZXZlbnQgPSBOVUxMOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Jv
Y2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYyBiL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2Nr
Y2hpcF9kcm1fdm9wLmMKaW5kZXggOGNkMzlmY2E4MWEzLi5mODIwNjU0YjI0OTIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9yb2NrY2hpcC9yb2NrY2hpcF9kcm1fdm9wLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3JvY2tjaGlwL3JvY2tjaGlwX2RybV92b3AuYwpAQCAtMTI0OCw2ICsxMjQ4
LDggQEAgc3RhdGljIHZvaWQgdm9wX2NydGNfZ2FtbWFfc2V0KHN0cnVjdCB2b3AgKnZvcCwgc3Ry
dWN0IGRybV9jcnRjICpjcnRjLAogc3RhdGljIHZvaWQgdm9wX2NydGNfYXRvbWljX2JlZ2luKHN0
cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZSkKIHsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dl
dF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJCQkJICAgICAgICAgIGNydGMpOwogCXN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY3J0
Y19zdGF0ZShzdGF0ZSwKIAkJCQkJCQkJCSAgICAgIGNydGMpOwogCXN0cnVjdCB2b3AgKnZvcCA9
IHRvX3ZvcChjcnRjKTsKQEAgLTEyNTYsOCArMTI1OCw4IEBAIHN0YXRpYyB2b2lkIHZvcF9jcnRj
X2F0b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJICogT25seSB1cGRhdGUgR0FN
TUEgaWYgdGhlICdhY3RpdmUnIGZsYWcgaXMgbm90IGNoYW5nZWQsCiAJICogb3RoZXJ3aXNlIGl0
J3MgdXBkYXRlZCBieSAuYXRvbWljX2VuYWJsZS4KIAkgKi8KLQlpZiAoY3J0Yy0+c3RhdGUtPmNv
bG9yX21nbXRfY2hhbmdlZCAmJgotCSAgICAhY3J0Yy0+c3RhdGUtPmFjdGl2ZV9jaGFuZ2VkKQor
CWlmIChjcnRjX3N0YXRlLT5jb2xvcl9tZ210X2NoYW5nZWQgJiYKKwkgICAgIWNydGNfc3RhdGUt
PmFjdGl2ZV9jaGFuZ2VkKQogCQl2b3BfY3J0Y19nYW1tYV9zZXQodm9wLCBjcnRjLCBvbGRfY3J0
Y19zdGF0ZSk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jIGIv
ZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RjLmMKaW5kZXggMmQ4NjYyN2IwZDRlLi44NWRkNzEzMTU1
M2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS90ZWdyYS9kYy5jCkBAIC0xOTM5LDE1ICsxOTM5LDE3IEBAIHN0YXRpYyB2b2lkIHRl
Z3JhX2NydGNfYXRvbWljX2JlZ2luKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIHN0YXRpYyB2b2lk
IHRlZ3JhX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkgICAg
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCB0ZWdyYV9kY19zdGF0
ZSAqY3J0Y19zdGF0ZSA9IHRvX2RjX3N0YXRlKGNydGMtPnN0YXRlKTsKKwlzdHJ1Y3QgZHJtX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0
ZSwKKwkJCQkJCQkJCSAgY3J0Yyk7CisJc3RydWN0IHRlZ3JhX2RjX3N0YXRlICpkY19zdGF0ZSA9
IHRvX2RjX3N0YXRlKGNydGNfc3RhdGUpOwogCXN0cnVjdCB0ZWdyYV9kYyAqZGMgPSB0b190ZWdy
YV9kYyhjcnRjKTsKIAl1MzIgdmFsdWU7CiAKLQl2YWx1ZSA9IGNydGNfc3RhdGUtPnBsYW5lcyA8
PCA4IHwgR0VORVJBTF9VUERBVEU7CisJdmFsdWUgPSBkY19zdGF0ZS0+cGxhbmVzIDw8IDggfCBH
RU5FUkFMX1VQREFURTsKIAl0ZWdyYV9kY193cml0ZWwoZGMsIHZhbHVlLCBEQ19DTURfU1RBVEVf
Q09OVFJPTCk7CiAJdmFsdWUgPSB0ZWdyYV9kY19yZWFkbChkYywgRENfQ01EX1NUQVRFX0NPTlRS
T0wpOwogCi0JdmFsdWUgPSBjcnRjX3N0YXRlLT5wbGFuZXMgfCBHRU5FUkFMX0FDVF9SRVE7CisJ
dmFsdWUgPSBkY19zdGF0ZS0+cGxhbmVzIHwgR0VORVJBTF9BQ1RfUkVROwogCXRlZ3JhX2RjX3dy
aXRlbChkYywgdmFsdWUsIERDX0NNRF9TVEFURV9DT05UUk9MKTsKIAl2YWx1ZSA9IHRlZ3JhX2Rj
X3JlYWRsKGRjLCBEQ19DTURfU1RBVEVfQ09OVFJPTCk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRp
by92aXJ0Z3B1X2Rpc3BsYXkuYwppbmRleCA0YmY3NDgzNmJkNTMuLmE2Y2FlYmQ0YTBkZCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2Rpc3BsYXkuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZGlzcGxheS5jCkBAIC0xMTksNiArMTE5LDgg
QEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1X2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIHN0YXRpYyB2b2lkIHZpcnRpb19ncHVfY3J0Y19hdG9taWNfZmx1c2goc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCQkJCQkgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQog
eworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X25l
d19jcnRjX3N0YXRlKHN0YXRlLAorCQkJCQkJCQkJICBjcnRjKTsKIAlzdHJ1Y3QgdmlydGlvX2dw
dV9vdXRwdXQgKm91dHB1dCA9IGRybV9jcnRjX3RvX3ZpcnRpb19ncHVfb3V0cHV0KGNydGMpOwog
CiAJLyoKQEAgLTEyNyw3ICsxMjksNyBAQCBzdGF0aWMgdm9pZCB2aXJ0aW9fZ3B1X2NydGNfYXRv
bWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkgKiBpbiB0aGUgcGxhbmUgdXBkYXRl
IGNhbGxiYWNrLCBhbmQgaGVyZSB3ZSBqdXN0IGNoZWNrCiAJICogd2hlbmV2ZXIgd2UgbXVzdCBm
b3JjZSB0aGUgbW9kZXNldC4KIAkgKi8KLQlpZiAoZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVz
ZXQoY3J0Yy0+c3RhdGUpKSB7CisJaWYgKGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNy
dGNfc3RhdGUpKSB7CiAJCW91dHB1dC0+bmVlZHNfbW9kZXNldCA9IHRydWU7CiAJfQogfQotLSAK
Mi4yOC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpk
cmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
