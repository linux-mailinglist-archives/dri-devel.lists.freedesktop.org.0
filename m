Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32108FAB7B
	for <lists+dri-devel@lfdr.de>; Wed, 13 Nov 2019 08:56:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 06BD56E8F3;
	Wed, 13 Nov 2019 07:56:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x844.google.com (mail-qt1-x844.google.com
 [IPv6:2607:f8b0:4864:20::844])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 450776EBC8
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Nov 2019 20:22:53 +0000 (UTC)
Received: by mail-qt1-x844.google.com with SMTP id o49so21233770qta.7
 for <dri-devel@lists.freedesktop.org>; Tue, 12 Nov 2019 12:22:53 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=BSFUg/W9A6HnwsbPbuDzq/9L6ti4sGNMmL25wGbaBxI=;
 b=SpS/3ujqNCfHTFLXmNhelYKx4F/0Z6dR+rgvvJ5txgT5XR+a0iMcKAtFP82yPLqS5V
 goLpcfl9lpB3EcXawUuI1vTY+cs0eMPzRNK88y+G/wkMcbMBf92pbfnjRxl3sogQ0ce+
 Vb0sVbSpneF6rolXPMGt18Kdcls4jnaUPA8YDVxEORPqFMLpeOQyqfGmjaLSGCRgid1Y
 nw95AXRw+8GyYVZbVstFs1nkoK0iBQaewUMW7IypDI53Mkt4TgrXceQeIF6JeNrUgd0P
 M6ZYlYlsTRgFLCF6wnKWCJvDqSFcifE+b3GBHubjOLyZuzFR2hCuDjPYNrEtHKMwd3Cz
 8HkQ==
X-Gm-Message-State: APjAAAXz6ZISE23T3GVTpCOySaBZHLNiIecPE7SsaAZh8AJRXLvGXwMt
 9Vm7F3HyBdpFbefd3jXjyu6htA==
X-Google-Smtp-Source: APXvYqyh7GmjUHdAPkfQnL2h1rs4I1Aq/QuqAEqebx0t7FVTldSAgXXVkrqtZm6Vk74H36QsCmVYvg==
X-Received: by 2002:ac8:f88:: with SMTP id b8mr33625110qtk.382.1573590172345; 
 Tue, 12 Nov 2019 12:22:52 -0800 (PST)
Received: from ziepe.ca
 (hlfxns017vw-142-162-113-180.dhcp-dynamic.fibreop.ns.bellaliant.net.
 [142.162.113.180])
 by smtp.gmail.com with ESMTPSA id q16sm7487987qkm.27.2019.11.12.12.22.47
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 12 Nov 2019 12:22:48 -0800 (PST)
Received: from jgg by mlx.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1iUcgZ-0003k4-DE; Tue, 12 Nov 2019 16:22:47 -0400
From: Jason Gunthorpe <jgg@ziepe.ca>
To: linux-mm@kvack.org, Jerome Glisse <jglisse@redhat.com>,
 Ralph Campbell <rcampbell@nvidia.com>, John Hubbard <jhubbard@nvidia.com>,
 Felix.Kuehling@amd.com
Subject: [PATCH v3 06/14] RDMA/hfi1: Use mmu_interval_notifier_insert for
 user_exp_rcv
Date: Tue, 12 Nov 2019 16:22:23 -0400
Message-Id: <20191112202231.3856-7-jgg@ziepe.ca>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112202231.3856-1-jgg@ziepe.ca>
References: <20191112202231.3856-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 13 Nov 2019 07:55:45 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=BSFUg/W9A6HnwsbPbuDzq/9L6ti4sGNMmL25wGbaBxI=;
 b=U5tMGzDohM88Dhb5OT+KNGasGrxJPURV3VJCgcEbLNaNLggNPtNvaJWNxh0oGCxd+G
 e1TTaZrAQm6MtqEffeVMDJceNyB8NHz11Rhj2PRrGCd72azzt1/3JDGtzA2cy4YX6/0u
 mAW2VzEiinIlE+wrNwjawDIV7wV6QvRGUW8Ksp2RYkql90eX+Syq6crGDA8ezIa/znBG
 nlMhQqdyxhN7pb6Jafd7qjYQ0G5GzVjTbGXchwZj6vkoj/p7ny/lKxLlNyJPBZEnc930
 TG5K5USOVXpcnWbR/x/G0Wx3Ef54r2hr8Dpu4fajLIw10HvmTDAD5WQT4pVIm1hLNM6F
 P6MA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Juergen Gross <jgross@suse.com>,
 Mike Marciniszyn <mike.marciniszyn@intel.com>,
 Stefano Stabellini <sstabellini@kernel.org>,
 Oleksandr Andrushchenko <oleksandr_andrushchenko@epam.com>,
 linux-rdma@vger.kernel.org, nouveau@lists.freedesktop.org,
 Dennis Dalessandro <dennis.dalessandro@intel.com>,
 amd-gfx@lists.freedesktop.org, Christoph Hellwig <hch@infradead.org>,
 Jason Gunthorpe <jgg@mellanox.com>, dri-devel@lists.freedesktop.org,
 Alex Deucher <alexander.deucher@amd.com>, xen-devel@lists.xenproject.org,
 Boris Ostrovsky <boris.ostrovsky@oracle.com>, Petr Cvek <petrcvekcz@gmail.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhpcyBjb252ZXJ0cyBv
bmUgb2YgdGhlIHR3byB1c2VycyBvZiBtbXVfbm90aWZpZXJzIHRvIHVzZSB0aGUgbmV3IEFQSS4K
VGhlIGNvbnZlcnNpb24gaXMgZmFpcmx5IHN0cmFpZ2h0Zm9yd2FyZCwgaG93ZXZlciB0aGUgZXhp
c3RpbmcgdXNlIG9mCm5vdGlmaWVycyBoZXJlIHNlZW1zIHRvIGJlIHJhY2V5LgoKVGVzdGVkLWJ5
OiBEZW5uaXMgRGFsZXNzYW5kcm8gPGRlbm5pcy5kYWxlc3NhbmRyb0BpbnRlbC5jb20+ClNpZ25l
ZC1vZmYtYnk6IEphc29uIEd1bnRob3JwZSA8amdnQG1lbGxhbm94LmNvbT4KLS0tCiBkcml2ZXJz
L2luZmluaWJhbmQvaHcvaGZpMS9maWxlX29wcy5jICAgICB8ICAgMiArLQogZHJpdmVycy9pbmZp
bmliYW5kL2h3L2hmaTEvaGZpLmggICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvaW5maW5pYmFu
ZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5jIHwgMTQ2ICsrKysrKysrKy0tLS0tLS0tLS0tLS0KIGRy
aXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5oIHwgICAzICstCiA0IGZpbGVz
IGNoYW5nZWQsIDYwIGluc2VydGlvbnMoKyksIDkzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL2ZpbGVfb3BzLmMgYi9kcml2ZXJzL2luZmluaWJh
bmQvaHcvaGZpMS9maWxlX29wcy5jCmluZGV4IGY5YTdlOWQyOWM4YmEyLi43YzVlM2ZiMjI0MTM5
YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hmaTEvZmlsZV9vcHMuYworKysg
Yi9kcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS9maWxlX29wcy5jCkBAIC0xMTM4LDcgKzExMzgs
NyBAQCBzdGF0aWMgaW50IGdldF9jdHh0X2luZm8oc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkLCB1
bnNpZ25lZCBsb25nIGFyZywgdTMyIGxlbikKIAkJCUhGSTFfQ0FQX1VHRVRfTUFTSyh1Y3R4dC0+
ZmxhZ3MsIE1BU0spIHwKIAkJCUhGSTFfQ0FQX0tHRVRfTUFTSyh1Y3R4dC0+ZmxhZ3MsIEsyVSk7
CiAJLyogYWRqdXN0IGZsYWcgaWYgdGhpcyBmZCBpcyBub3QgYWJsZSB0byBjYWNoZSAqLwotCWlm
ICghZmQtPmhhbmRsZXIpCisJaWYgKCFmZC0+dXNlX21uKQogCQljaW5mby5ydW50aW1lX2ZsYWdz
IHw9IEhGSTFfQ0FQX1RJRF9VTk1BUDsgLyogbm8gY2FjaGluZyAqLwogCiAJY2luZm8ubnVtX2Fj
dGl2ZSA9IGhmaTFfY291bnRfYWN0aXZlX3VuaXRzKCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2lu
ZmluaWJhbmQvaHcvaGZpMS9oZmkuaCBiL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL2hmaS5o
CmluZGV4IGZhNDUzNTBhOWExZDMyLi5mYzEwZDY1ZmMzZTEzYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9pbmZpbmliYW5kL2h3L2hmaTEvaGZpLmgKKysrIGIvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hm
aTEvaGZpLmgKQEAgLTE0NDQsNyArMTQ0NCw3IEBAIHN0cnVjdCBoZmkxX2ZpbGVkYXRhIHsKIAkv
KiBmb3IgY3B1IGFmZmluaXR5OyAtMSBpZiBub25lICovCiAJaW50IHJlY19jcHVfbnVtOwogCXUz
MiB0aWRfbl9waW5uZWQ7Ci0Jc3RydWN0IG1tdV9yYl9oYW5kbGVyICpoYW5kbGVyOworCWJvb2wg
dXNlX21uOwogCXN0cnVjdCB0aWRfcmJfbm9kZSAqKmVudHJ5X3RvX3JiOwogCXNwaW5sb2NrX3Qg
dGlkX2xvY2s7IC8qIHByb3RlY3QgdGlkX1tsaW1pdCx1c2VkXSBjb3VudGVycyAqLwogCXUzMiB0
aWRfbGltaXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS91c2VyX2V4
cF9yY3YuYyBiL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5jCmluZGV4
IDM1OTJhOWVjMTU1ZTg1Li43NWEzNzgxNjIxNjJkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9pbmZp
bmliYW5kL2h3L2hmaTEvdXNlcl9leHBfcmN2LmMKKysrIGIvZHJpdmVycy9pbmZpbmliYW5kL2h3
L2hmaTEvdXNlcl9leHBfcmN2LmMKQEAgLTU5LDExICs1OSwxMSBAQCBzdGF0aWMgaW50IHNldF9y
Y3ZhcnJheV9lbnRyeShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsCiAJCQkgICAgICBzdHJ1Y3Qg
dGlkX3VzZXJfYnVmICp0YnVmLAogCQkJICAgICAgdTMyIHJjdmVudHJ5LCBzdHJ1Y3QgdGlkX2dy
b3VwICpncnAsCiAJCQkgICAgICB1MTYgcGFnZWlkeCwgdW5zaWduZWQgaW50IG5wYWdlcyk7Ci1z
dGF0aWMgaW50IHRpZF9yYl9pbnNlcnQodm9pZCAqYXJnLCBzdHJ1Y3QgbW11X3JiX25vZGUgKm5v
ZGUpOwogc3RhdGljIHZvaWQgY2FjaGVsZXNzX3RpZF9yYl9yZW1vdmUoc3RydWN0IGhmaTFfZmls
ZWRhdGEgKmZkYXRhLAogCQkJCSAgICBzdHJ1Y3QgdGlkX3JiX25vZGUgKnRub2RlKTsKLXN0YXRp
YyB2b2lkIHRpZF9yYl9yZW1vdmUodm9pZCAqYXJnLCBzdHJ1Y3QgbW11X3JiX25vZGUgKm5vZGUp
Owotc3RhdGljIGludCB0aWRfcmJfaW52YWxpZGF0ZSh2b2lkICphcmcsIHN0cnVjdCBtbXVfcmJf
bm9kZSAqbW5vZGUpOworc3RhdGljIGJvb2wgdGlkX3JiX2ludmFsaWRhdGUoc3RydWN0IG1tdV9p
bnRlcnZhbF9ub3RpZmllciAqbW5pLAorCQkJICAgICAgY29uc3Qgc3RydWN0IG1tdV9ub3RpZmll
cl9yYW5nZSAqcmFuZ2UsCisJCQkgICAgICB1bnNpZ25lZCBsb25nIGN1cl9zZXEpOwogc3RhdGlj
IGludCBwcm9ncmFtX3JjdmFycmF5KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwgc3RydWN0IHRp
ZF91c2VyX2J1ZiAqLAogCQkJICAgIHN0cnVjdCB0aWRfZ3JvdXAgKmdycCwKIAkJCSAgICB1bnNp
Z25lZCBpbnQgc3RhcnQsIHUxNiBjb3VudCwKQEAgLTczLDEwICs3Myw4IEBAIHN0YXRpYyBpbnQg
dW5wcm9ncmFtX3JjdmFycmF5KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwgdTMyIHRpZGluZm8s
CiAJCQkgICAgICBzdHJ1Y3QgdGlkX2dyb3VwICoqZ3JwKTsKIHN0YXRpYyB2b2lkIGNsZWFyX3Rp
ZF9ub2RlKHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwgc3RydWN0IHRpZF9yYl9ub2RlICpub2Rl
KTsKIAotc3RhdGljIHN0cnVjdCBtbXVfcmJfb3BzIHRpZF9yYl9vcHMgPSB7Ci0JLmluc2VydCA9
IHRpZF9yYl9pbnNlcnQsCi0JLnJlbW92ZSA9IHRpZF9yYl9yZW1vdmUsCi0JLmludmFsaWRhdGUg
PSB0aWRfcmJfaW52YWxpZGF0ZQorc3RhdGljIGNvbnN0IHN0cnVjdCBtbXVfaW50ZXJ2YWxfbm90
aWZpZXJfb3BzIHRpZF9tbl9vcHMgPSB7CisJLmludmFsaWRhdGUgPSB0aWRfcmJfaW52YWxpZGF0
ZSwKIH07CiAKIC8qCkBAIC04Nyw3ICs4NSw2IEBAIHN0YXRpYyBzdHJ1Y3QgbW11X3JiX29wcyB0
aWRfcmJfb3BzID0gewogaW50IGhmaTFfdXNlcl9leHBfcmN2X2luaXQoc3RydWN0IGhmaTFfZmls
ZWRhdGEgKmZkLAogCQkJICAgc3RydWN0IGhmaTFfY3R4dGRhdGEgKnVjdHh0KQogewotCXN0cnVj
dCBoZmkxX2RldmRhdGEgKmRkID0gdWN0eHQtPmRkOwogCWludCByZXQgPSAwOwogCiAJc3Bpbl9s
b2NrX2luaXQoJmZkLT50aWRfbG9jayk7CkBAIC0xMDksMjAgKzEwNiw3IEBAIGludCBoZmkxX3Vz
ZXJfZXhwX3Jjdl9pbml0KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwKIAkJCWZkLT5lbnRyeV90
b19yYiA9IE5VTEw7CiAJCQlyZXR1cm4gLUVOT01FTTsKIAkJfQotCi0JCS8qCi0JCSAqIFJlZ2lz
dGVyIE1NVSBub3RpZmllciBjYWxsYmFja3MuIElmIHRoZSByZWdpc3RyYXRpb24KLQkJICogZmFp
bHMsIGNvbnRpbnVlIHdpdGhvdXQgVElEIGNhY2hpbmcgZm9yIHRoaXMgY29udGV4dC4KLQkJICov
Ci0JCXJldCA9IGhmaTFfbW11X3JiX3JlZ2lzdGVyKGZkLCBmZC0+bW0sICZ0aWRfcmJfb3BzLAot
CQkJCQkgICBkZC0+cHBvcnQtPmhmaTFfd3EsCi0JCQkJCSAgICZmZC0+aGFuZGxlcik7Ci0JCWlm
IChyZXQpIHsKLQkJCWRkX2Rldl9pbmZvKGRkLAotCQkJCSAgICAiRmFpbGVkIE1NVSBub3RpZmll
ciByZWdpc3RyYXRpb24gJWRcbiIsCi0JCQkJICAgIHJldCk7Ci0JCQlyZXQgPSAwOwotCQl9CisJ
CWZkLT51c2VfbW4gPSB0cnVlOwogCX0KIAogCS8qCkBAIC0xMzksNyArMTIzLDcgQEAgaW50IGhm
aTFfdXNlcl9leHBfcmN2X2luaXQoc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkLAogCSAqIGluaXQu
CiAJICovCiAJc3Bpbl9sb2NrKCZmZC0+dGlkX2xvY2spOwotCWlmICh1Y3R4dC0+c3ViY3R4dF9j
bnQgJiYgZmQtPmhhbmRsZXIpIHsKKwlpZiAodWN0eHQtPnN1YmN0eHRfY250ICYmIGZkLT51c2Vf
bW4pIHsKIAkJdTE2IHJlbWFpbmRlcjsKIAogCQlmZC0+dGlkX2xpbWl0ID0gdWN0eHQtPmV4cGVj
dGVkX2NvdW50IC8gdWN0eHQtPnN1YmN0eHRfY250OwpAQCAtMTU4LDE4ICsxNDIsMTAgQEAgdm9p
ZCBoZmkxX3VzZXJfZXhwX3Jjdl9mcmVlKHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCkKIHsKIAlz
dHJ1Y3QgaGZpMV9jdHh0ZGF0YSAqdWN0eHQgPSBmZC0+dWN0eHQ7CiAKLQkvKgotCSAqIFRoZSBu
b3RpZmllciB3b3VsZCBoYXZlIGJlZW4gcmVtb3ZlZCB3aGVuIHRoZSBwcm9jZXNzJ2VzIG1tCi0J
ICogd2FzIGZyZWVkLgotCSAqLwotCWlmIChmZC0+aGFuZGxlcikgewotCQloZmkxX21tdV9yYl91
bnJlZ2lzdGVyKGZkLT5oYW5kbGVyKTsKLQl9IGVsc2UgewotCQlpZiAoIUVYUF9USURfU0VUX0VN
UFRZKHVjdHh0LT50aWRfZnVsbF9saXN0KSkKLQkJCXVubG9ja19leHBfdGlkcyh1Y3R4dCwgJnVj
dHh0LT50aWRfZnVsbF9saXN0LCBmZCk7Ci0JCWlmICghRVhQX1RJRF9TRVRfRU1QVFkodWN0eHQt
PnRpZF91c2VkX2xpc3QpKQotCQkJdW5sb2NrX2V4cF90aWRzKHVjdHh0LCAmdWN0eHQtPnRpZF91
c2VkX2xpc3QsIGZkKTsKLQl9CisJaWYgKCFFWFBfVElEX1NFVF9FTVBUWSh1Y3R4dC0+dGlkX2Z1
bGxfbGlzdCkpCisJCXVubG9ja19leHBfdGlkcyh1Y3R4dCwgJnVjdHh0LT50aWRfZnVsbF9saXN0
LCBmZCk7CisJaWYgKCFFWFBfVElEX1NFVF9FTVBUWSh1Y3R4dC0+dGlkX3VzZWRfbGlzdCkpCisJ
CXVubG9ja19leHBfdGlkcyh1Y3R4dCwgJnVjdHh0LT50aWRfdXNlZF9saXN0LCBmZCk7CiAKIAlr
ZnJlZShmZC0+aW52YWxpZF90aWRzKTsKIAlmZC0+aW52YWxpZF90aWRzID0gTlVMTDsKQEAgLTIw
MSw3ICsxNzcsNyBAQCBzdGF0aWMgdm9pZCB1bnBpbl9yY3ZfcGFnZXMoc3RydWN0IGhmaTFfZmls
ZWRhdGEgKmZkLAogCiAJaWYgKG1hcHBlZCkgewogCQlwY2lfdW5tYXBfc2luZ2xlKGRkLT5wY2lk
ZXYsIG5vZGUtPmRtYV9hZGRyLAotCQkJCSBub2RlLT5tbXUubGVuLCBQQ0lfRE1BX0ZST01ERVZJ
Q0UpOworCQkJCSBub2RlLT5ucGFnZXMgKiBQQUdFX1NJWkUsIFBDSV9ETUFfRlJPTURFVklDRSk7
CiAJCXBhZ2VzID0gJm5vZGUtPnBhZ2VzW2lkeF07CiAJfSBlbHNlIHsKIAkJcGFnZXMgPSAmdGlk
YnVmLT5wYWdlc1tpZHhdOwpAQCAtNzc3LDggKzc1Myw4IEBAIHN0YXRpYyBpbnQgc2V0X3JjdmFy
cmF5X2VudHJ5KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwKIAkJcmV0dXJuIC1FRkFVTFQ7CiAJ
fQogCi0Jbm9kZS0+bW11LmFkZHIgPSB0YnVmLT52YWRkciArIChwYWdlaWR4ICogUEFHRV9TSVpF
KTsKLQlub2RlLT5tbXUubGVuID0gbnBhZ2VzICogUEFHRV9TSVpFOworCW5vZGUtPm5vdGlmaWVy
Lm9wcyA9ICZ0aWRfbW5fb3BzOworCW5vZGUtPmZkYXRhID0gZmQ7CiAJbm9kZS0+cGh5cyA9IHBh
Z2VfdG9fcGh5cyhwYWdlc1swXSk7CiAJbm9kZS0+bnBhZ2VzID0gbnBhZ2VzOwogCW5vZGUtPnJj
dmVudHJ5ID0gcmN2ZW50cnk7CkBAIC03ODcsMjMgKzc2MywzNCBAQCBzdGF0aWMgaW50IHNldF9y
Y3ZhcnJheV9lbnRyeShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQsCiAJbm9kZS0+ZnJlZWQgPSBm
YWxzZTsKIAltZW1jcHkobm9kZS0+cGFnZXMsIHBhZ2VzLCBzaXplb2Yoc3RydWN0IHBhZ2UgKikg
KiBucGFnZXMpOwogCi0JaWYgKCFmZC0+aGFuZGxlcikKLQkJcmV0ID0gdGlkX3JiX2luc2VydChm
ZCwgJm5vZGUtPm1tdSk7Ci0JZWxzZQotCQlyZXQgPSBoZmkxX21tdV9yYl9pbnNlcnQoZmQtPmhh
bmRsZXIsICZub2RlLT5tbXUpOwotCi0JaWYgKHJldCkgewotCQloZmkxX2NkYmcoVElELCAiRmFp
bGVkIHRvIGluc2VydCBSQiBub2RlICV1IDB4JWx4LCAweCVseCAlZCIsCi0JCQkgIG5vZGUtPnJj
dmVudHJ5LCBub2RlLT5tbXUuYWRkciwgbm9kZS0+cGh5cywgcmV0KTsKLQkJcGNpX3VubWFwX3Np
bmdsZShkZC0+cGNpZGV2LCBwaHlzLCBucGFnZXMgKiBQQUdFX1NJWkUsCi0JCQkJIFBDSV9ETUFf
RlJPTURFVklDRSk7Ci0JCWtmcmVlKG5vZGUpOwotCQlyZXR1cm4gLUVGQVVMVDsKKwlpZiAoZmQt
PnVzZV9tbikgeworCQlyZXQgPSBtbXVfaW50ZXJ2YWxfbm90aWZpZXJfaW5zZXJ0KAorCQkJJm5v
ZGUtPm5vdGlmaWVyLCB0YnVmLT52YWRkciArIChwYWdlaWR4ICogUEFHRV9TSVpFKSwKKwkJCW5w
YWdlcyAqIFBBR0VfU0laRSwgZmQtPm1tKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gb3V0X3VubWFw
OworCQkvKgorCQkgKiBGSVhNRTogVGhpcyBpcyBpbiB0aGUgd3Jvbmcgb3JkZXIsIHRoZSBub3Rp
ZmllciBzaG91bGQgYmUKKwkJICogZXN0YWJsaXNoZWQgYmVmb3JlIHRoZSBwYWdlcyBhcmUgcGlu
bmVkIGJ5IHBpbl9yY3ZfcGFnZXMuCisJCSAqLworCQltbXVfaW50ZXJ2YWxfcmVhZF9iZWdpbigm
bm9kZS0+bm90aWZpZXIpOwogCX0KKwlmZC0+ZW50cnlfdG9fcmJbbm9kZS0+cmN2ZW50cnkgLSB1
Y3R4dC0+ZXhwZWN0ZWRfYmFzZV0gPSBub2RlOworCiAJaGZpMV9wdXRfdGlkKGRkLCByY3ZlbnRy
eSwgUFRfRVhQRUNURUQsIHBoeXMsIGlsb2cyKG5wYWdlcykgKyAxKTsKIAl0cmFjZV9oZmkxX2V4
cF90aWRfcmVnKHVjdHh0LT5jdHh0LCBmZC0+c3ViY3R4dCwgcmN2ZW50cnksIG5wYWdlcywKLQkJ
CSAgICAgICBub2RlLT5tbXUuYWRkciwgbm9kZS0+cGh5cywgcGh5cyk7CisJCQkgICAgICAgbm9k
ZS0+bm90aWZpZXIuaW50ZXJ2YWxfdHJlZS5zdGFydCwgbm9kZS0+cGh5cywKKwkJCSAgICAgICBw
aHlzKTsKIAlyZXR1cm4gMDsKKworb3V0X3VubWFwOgorCWhmaTFfY2RiZyhUSUQsICJGYWlsZWQg
dG8gaW5zZXJ0IFJCIG5vZGUgJXUgMHglbHgsIDB4JWx4ICVkIiwKKwkJICBub2RlLT5yY3ZlbnRy
eSwgbm9kZS0+bm90aWZpZXIuaW50ZXJ2YWxfdHJlZS5zdGFydCwKKwkJICBub2RlLT5waHlzLCBy
ZXQpOworCXBjaV91bm1hcF9zaW5nbGUoZGQtPnBjaWRldiwgcGh5cywgbnBhZ2VzICogUEFHRV9T
SVpFLAorCQkJIFBDSV9ETUFfRlJPTURFVklDRSk7CisJa2ZyZWUobm9kZSk7CisJcmV0dXJuIC1F
RkFVTFQ7CiB9CiAKIHN0YXRpYyBpbnQgdW5wcm9ncmFtX3JjdmFycmF5KHN0cnVjdCBoZmkxX2Zp
bGVkYXRhICpmZCwgdTMyIHRpZGluZm8sCkBAIC04MzMsMTAgKzgyMCw5IEBAIHN0YXRpYyBpbnQg
dW5wcm9ncmFtX3JjdmFycmF5KHN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZCwgdTMyIHRpZGluZm8s
CiAJaWYgKGdycCkKIAkJKmdycCA9IG5vZGUtPmdycDsKIAotCWlmICghZmQtPmhhbmRsZXIpCi0J
CWNhY2hlbGVzc190aWRfcmJfcmVtb3ZlKGZkLCBub2RlKTsKLQllbHNlCi0JCWhmaTFfbW11X3Ji
X3JlbW92ZShmZC0+aGFuZGxlciwgJm5vZGUtPm1tdSk7CisJaWYgKGZkLT51c2VfbW4pCisJCW1t
dV9pbnRlcnZhbF9ub3RpZmllcl9yZW1vdmUoJm5vZGUtPm5vdGlmaWVyKTsKKwljYWNoZWxlc3Nf
dGlkX3JiX3JlbW92ZShmZCwgbm9kZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTg0Nyw3ICs4MzMs
OCBAQCBzdGF0aWMgdm9pZCBjbGVhcl90aWRfbm9kZShzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmQs
IHN0cnVjdCB0aWRfcmJfbm9kZSAqbm9kZSkKIAlzdHJ1Y3QgaGZpMV9kZXZkYXRhICpkZCA9IHVj
dHh0LT5kZDsKIAogCXRyYWNlX2hmaTFfZXhwX3RpZF91bnJlZyh1Y3R4dC0+Y3R4dCwgZmQtPnN1
YmN0eHQsIG5vZGUtPnJjdmVudHJ5LAotCQkJCSBub2RlLT5ucGFnZXMsIG5vZGUtPm1tdS5hZGRy
LCBub2RlLT5waHlzLAorCQkJCSBub2RlLT5ucGFnZXMsCisJCQkJIG5vZGUtPm5vdGlmaWVyLmlu
dGVydmFsX3RyZWUuc3RhcnQsIG5vZGUtPnBoeXMsCiAJCQkJIG5vZGUtPmRtYV9hZGRyKTsKIAog
CS8qCkBAIC04OTQsMzAgKzg4MSwyOSBAQCBzdGF0aWMgdm9pZCB1bmxvY2tfZXhwX3RpZHMoc3Ry
dWN0IGhmaTFfY3R4dGRhdGEgKnVjdHh0LAogCQkJCWlmICghbm9kZSB8fCBub2RlLT5yY3ZlbnRy
eSAhPSByY3ZlbnRyeSkKIAkJCQkJY29udGludWU7CiAKKwkJCQlpZiAoZmQtPnVzZV9tbikKKwkJ
CQkJbW11X2ludGVydmFsX25vdGlmaWVyX3JlbW92ZSgKKwkJCQkJCSZub2RlLT5ub3RpZmllcik7
CiAJCQkJY2FjaGVsZXNzX3RpZF9yYl9yZW1vdmUoZmQsIG5vZGUpOwogCQkJfQogCQl9CiAJfQog
fQogCi0vKgotICogQWx3YXlzIHJldHVybiAwIGZyb20gdGhpcyBmdW5jdGlvbi4gIEEgbm9uLXpl
cm8gcmV0dXJuIGluZGljYXRlcyB0aGF0IHRoZQotICogcmVtb3ZlIG9wZXJhdGlvbiB3aWxsIGJl
IGNhbGxlZCBhbmQgdGhhdCBtZW1vcnkgc2hvdWxkIGJlIHVucGlubmVkLgotICogSG93ZXZlciwg
dGhlIGRyaXZlciBjYW5ub3QgdW5waW4gb3V0IGZyb20gdW5kZXIgUFNNLiAgSW5zdGVhZCwgcmV0
YWluIHRoZQotICogbWVtb3J5IChieSByZXR1cm5pbmcgMCkgYW5kIGluZm9ybSBQU00gdGhhdCB0
aGUgbWVtb3J5IGlzIGdvaW5nIGF3YXkuICBQU00KLSAqIHdpbGwgY2FsbCBiYWNrIGxhdGVyIHdo
ZW4gaXQgaGFzIHJlbW92ZWQgdGhlIG1lbW9yeSBmcm9tIGl0cyBsaXN0LgotICovCi1zdGF0aWMg
aW50IHRpZF9yYl9pbnZhbGlkYXRlKHZvaWQgKmFyZywgc3RydWN0IG1tdV9yYl9ub2RlICptbm9k
ZSkKK3N0YXRpYyBib29sIHRpZF9yYl9pbnZhbGlkYXRlKHN0cnVjdCBtbXVfaW50ZXJ2YWxfbm90
aWZpZXIgKm1uaSwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfcmFuZ2UgKnJh
bmdlLAorCQkJICAgICAgdW5zaWduZWQgbG9uZyBjdXJfc2VxKQogewotCXN0cnVjdCBoZmkxX2Zp
bGVkYXRhICpmZGF0YSA9IGFyZzsKLQlzdHJ1Y3QgaGZpMV9jdHh0ZGF0YSAqdWN0eHQgPSBmZGF0
YS0+dWN0eHQ7CiAJc3RydWN0IHRpZF9yYl9ub2RlICpub2RlID0KLQkJY29udGFpbmVyX29mKG1u
b2RlLCBzdHJ1Y3QgdGlkX3JiX25vZGUsIG1tdSk7CisJCWNvbnRhaW5lcl9vZihtbmksIHN0cnVj
dCB0aWRfcmJfbm9kZSwgbm90aWZpZXIpOworCXN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZGF0YSA9
IG5vZGUtPmZkYXRhOworCXN0cnVjdCBoZmkxX2N0eHRkYXRhICp1Y3R4dCA9IGZkYXRhLT51Y3R4
dDsKIAogCWlmIChub2RlLT5mcmVlZCkKLQkJcmV0dXJuIDA7CisJCXJldHVybiB0cnVlOwogCi0J
dHJhY2VfaGZpMV9leHBfdGlkX2ludmFsKHVjdHh0LT5jdHh0LCBmZGF0YS0+c3ViY3R4dCwgbm9k
ZS0+bW11LmFkZHIsCisJdHJhY2VfaGZpMV9leHBfdGlkX2ludmFsKHVjdHh0LT5jdHh0LCBmZGF0
YS0+c3ViY3R4dCwKKwkJCQkgbm9kZS0+bm90aWZpZXIuaW50ZXJ2YWxfdHJlZS5zdGFydCwKIAkJ
CQkgbm9kZS0+cmN2ZW50cnksIG5vZGUtPm5wYWdlcywgbm9kZS0+ZG1hX2FkZHIpOwogCW5vZGUt
PmZyZWVkID0gdHJ1ZTsKIApAQCAtOTQ2LDE4ICs5MzIsNyBAQCBzdGF0aWMgaW50IHRpZF9yYl9p
bnZhbGlkYXRlKHZvaWQgKmFyZywgc3RydWN0IG1tdV9yYl9ub2RlICptbm9kZSkKIAkJZmRhdGEt
PmludmFsaWRfdGlkX2lkeCsrOwogCX0KIAlzcGluX3VubG9jaygmZmRhdGEtPmludmFsaWRfbG9j
ayk7Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgdGlkX3JiX2luc2VydCh2b2lkICphcmcs
IHN0cnVjdCBtbXVfcmJfbm9kZSAqbm9kZSkKLXsKLQlzdHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmRh
dGEgPSBhcmc7Ci0Jc3RydWN0IHRpZF9yYl9ub2RlICp0bm9kZSA9Ci0JCWNvbnRhaW5lcl9vZihu
b2RlLCBzdHJ1Y3QgdGlkX3JiX25vZGUsIG1tdSk7Ci0JdTMyIGJhc2UgPSBmZGF0YS0+dWN0eHQt
PmV4cGVjdGVkX2Jhc2U7Ci0KLQlmZGF0YS0+ZW50cnlfdG9fcmJbdG5vZGUtPnJjdmVudHJ5IC0g
YmFzZV0gPSB0bm9kZTsKLQlyZXR1cm4gMDsKKwlyZXR1cm4gdHJ1ZTsKIH0KIAogc3RhdGljIHZv
aWQgY2FjaGVsZXNzX3RpZF9yYl9yZW1vdmUoc3RydWN0IGhmaTFfZmlsZWRhdGEgKmZkYXRhLApA
QCAtOTY4LDEyICs5NDMsMyBAQCBzdGF0aWMgdm9pZCBjYWNoZWxlc3NfdGlkX3JiX3JlbW92ZShz
dHJ1Y3QgaGZpMV9maWxlZGF0YSAqZmRhdGEsCiAJZmRhdGEtPmVudHJ5X3RvX3JiW3Rub2RlLT5y
Y3ZlbnRyeSAtIGJhc2VdID0gTlVMTDsKIAljbGVhcl90aWRfbm9kZShmZGF0YSwgdG5vZGUpOwog
fQotCi1zdGF0aWMgdm9pZCB0aWRfcmJfcmVtb3ZlKHZvaWQgKmFyZywgc3RydWN0IG1tdV9yYl9u
b2RlICpub2RlKQotewotCXN0cnVjdCBoZmkxX2ZpbGVkYXRhICpmZGF0YSA9IGFyZzsKLQlzdHJ1
Y3QgdGlkX3JiX25vZGUgKnRub2RlID0KLQkJY29udGFpbmVyX29mKG5vZGUsIHN0cnVjdCB0aWRf
cmJfbm9kZSwgbW11KTsKLQotCWNhY2hlbGVzc190aWRfcmJfcmVtb3ZlKGZkYXRhLCB0bm9kZSk7
Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJzL2luZmluaWJhbmQvaHcvaGZpMS91c2VyX2V4cF9yY3Yu
aCBiL2RyaXZlcnMvaW5maW5pYmFuZC9ody9oZmkxL3VzZXJfZXhwX3Jjdi5oCmluZGV4IDQzYjEw
NWRlMWQ1NDI3Li42MjU3ZWVlMDgzYTFhMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9pbmZpbmliYW5k
L2h3L2hmaTEvdXNlcl9leHBfcmN2LmgKKysrIGIvZHJpdmVycy9pbmZpbmliYW5kL2h3L2hmaTEv
dXNlcl9leHBfcmN2LmgKQEAgLTY1LDcgKzY1LDggQEAgc3RydWN0IHRpZF91c2VyX2J1ZiB7CiB9
OwogCiBzdHJ1Y3QgdGlkX3JiX25vZGUgewotCXN0cnVjdCBtbXVfcmJfbm9kZSBtbXU7CisJc3Ry
dWN0IG1tdV9pbnRlcnZhbF9ub3RpZmllciBub3RpZmllcjsKKwlzdHJ1Y3QgaGZpMV9maWxlZGF0
YSAqZmRhdGE7CiAJdW5zaWduZWQgbG9uZyBwaHlzOwogCXN0cnVjdCB0aWRfZ3JvdXAgKmdycDsK
IAl1MzIgcmN2ZW50cnk7Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
