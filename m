Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B7D6BF4C4
	for <lists+dri-devel@lfdr.de>; Thu, 26 Sep 2019 16:12:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DDE5C6ED3F;
	Thu, 26 Sep 2019 14:12:22 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x541.google.com (mail-pg1-x541.google.com
 [IPv6:2607:f8b0:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 28C1B6ECA3;
 Thu, 26 Sep 2019 14:12:21 +0000 (UTC)
Received: by mail-pg1-x541.google.com with SMTP id a24so1670164pgj.2;
 Thu, 26 Sep 2019 07:12:21 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=HOoEKq7SdYTamPsI1DO5rXNhccW9uQv4woFf7R40cG8=;
 b=HRasDRDbvhwH07bRFxyUDNjGLpuF+K3JuwTAlz6fTu1fQ9WveHqP7NyIpTrUa1cmRJ
 z+i5cyf3y3yiginPV364bdT7/ttYpEppxTAQOLMJPrNP+BhdJOOz0Ueyizp0cKnGUFRS
 bndCL1S9UERVUjo5DZoM4ihTaF7Rvv6q44MroLMn6e/oCj3kQmlwMmhDc79543pk97JG
 txKQB89D1rDu3wDVlSCEx0NdYuatuZ9pjNgcyewgC8BOfSjlBAWzrt8b49bIXFiKMQ2x
 EAm6gaTM4DwMXgN9Td5+RhftyW/fLLz+O/kwzj0ss9pM8k+wX+DMRELfCY4+KT0sx22p
 xiAg==
X-Gm-Message-State: APjAAAWqMaOfZ0qb9uYWI4Bl3AWRUx6rB/nxy6CAfjSxk+L6r9UvMT/t
 24OPkw8URVhiQ50nJvkW+BWdyIRlEkE=
X-Google-Smtp-Source: APXvYqxDIAfMkuncwVojb17wXNfN4lmYIxhICZMNK6mFuzFtTFLddgYsYeZuYUvE15MZguBcWrVvyg==
X-Received: by 2002:a17:90a:8e81:: with SMTP id
 f1mr3797976pjo.109.1569507140587; 
 Thu, 26 Sep 2019 07:12:20 -0700 (PDT)
Received: from localhost.localdomain (ah.ptr230.ptrcloud.net. [153.122.161.8])
 by smtp.gmail.com with ESMTPSA id
 w188sm2176740pgw.26.2019.09.26.07.12.16
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 26 Sep 2019 07:12:20 -0700 (PDT)
From: Qiang Yu <yuq825@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/6] drm/gem: refine drm_gem_objects_lookup
Date: Thu, 26 Sep 2019 22:10:40 +0800
Message-Id: <20190926141046.30758-3-yuq825@gmail.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190926141046.30758-1-yuq825@gmail.com>
References: <20190926141046.30758-1-yuq825@gmail.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=HOoEKq7SdYTamPsI1DO5rXNhccW9uQv4woFf7R40cG8=;
 b=B7zRAknYIS9fiNCF+K4JJiaJ557+INdD63DA7WUUamSatnpeCTfMapl7XFH+xKlmm4
 CmBKXN/qUJlwlQ0rvfbJkF4EP2GfeqANB6G7WykHYFkBXZBJz76zBdrzNoANBwekAnZn
 EwCQwpNMOn27GCEUOIe4uLEeWyCDbVtOo8DNPHtwiV0IXjl5mip3qrjw134iVmldWkpJ
 azLjK6N/Th0UjicuTd0w84Vkxz10TPixjMNf41a4MGCER1236gEVew13zMGJI6Cs+uB/
 JGN6sg+ZYO+oPtYBuO01CS04927IP8/+I4C4DzSqia+iZCpIzVWROXReD2UnvHsA/V/x
 ZCOw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, lima@lists.freedesktop.org,
 Maxime Ripard <maxime.ripard@bootlin.com>, Steven Price <steven.price@arm.com>,
 David Airlie <airlied@linux.ie>, Qiang Yu <yuq825@gmail.com>,
 Sean Paul <sean@poorly.run>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RG8gbm90IHVzZSB1c2VyIHNwYWNlIGJvIGhhbmRsZXMgZGlyZWN0bHkgYW5kIGxlZnQgdGhlIHVz
ZXIKdG8ga2VybmVsIGNvcHkgd29yayB0byBkcml2ZXJzIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4K
ClRoaXMgaXMgZm9yIGRyaXZlciBsaWtlIGxpbWEgd2hpY2ggZG9lcyBub3QgcGFzcyBnZW0gYm8K
aGFuZGxlcyBjb250aW5vdXNseSBpbiBhbiBhcnJheSBpbiBpb2N0bCBhcmd1bWVudC4KCkNjOiBS
b2IgSGVycmluZyA8cm9iaEBrZXJuZWwub3JnPgpDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpv
c29AY29sbGFib3JhLmNvbT4KQ2M6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnByaWNlQGFybS5jb20+
CkNjOiBBbHlzc2EgUm9zZW56d2VpZyA8YWx5c3NhLnJvc2VuendlaWdAY29sbGFib3JhLmNvbT4K
U2lnbmVkLW9mZi1ieTogUWlhbmcgWXUgPHl1cTgyNUBnbWFpbC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2RybV9nZW0uYyAgICAgICAgICAgICAgIHwgMjggKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jIHwgMjMgKysrKysr
KysrKysrKysrKystLS0KIGluY2x1ZGUvZHJtL2RybV9nZW0uaCAgICAgICAgICAgICAgICAgICB8
ICAyICstCiAzIGZpbGVzIGNoYW5nZWQsIDI5IGluc2VydGlvbnMoKyksIDI0IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2dlbS5jCmluZGV4IDY4NTRmNTg2N2Q1MS4uOWY3M2U1ZjNiNTNmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2Vt
LmMKQEAgLTY3OSwxMSArNjc5LDExIEBAIHN0YXRpYyBpbnQgb2JqZWN0c19sb29rdXAoc3RydWN0
IGRybV9maWxlICpmaWxwLCB1MzIgKmhhbmRsZSwgaW50IGNvdW50LAogLyoqCiAgKiBkcm1fZ2Vt
X29iamVjdHNfbG9va3VwIC0gbG9vayB1cCBHRU0gb2JqZWN0cyBmcm9tIGFuIGFycmF5IG9mIGhh
bmRsZXMKICAqIEBmaWxwOiBEUk0gZmlsZSBwcml2YXRlIGRhdGUKLSAqIEBib19oYW5kbGVzOiB1
c2VyIHBvaW50ZXIgdG8gYXJyYXkgb2YgdXNlcnNwYWNlIGhhbmRsZQorICogQGJvX2hhbmRsZXM6
IGFycmF5IG9mIEdFTSBvYmplY3QgaGFuZGxlcwogICogQGNvdW50OiBzaXplIG9mIGhhbmRsZSBh
cnJheQogICogQG9ianNfb3V0OiByZXR1cm5lZCBwb2ludGVyIHRvIGFycmF5IG9mIGRybV9nZW1f
b2JqZWN0IHBvaW50ZXJzCiAgKgotICogVGFrZXMgYW4gYXJyYXkgb2YgdXNlcnNwYWNlIGhhbmRs
ZXMgYW5kIHJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgYXJyYXkgb2YKKyAqIFRha2VzIGFuIGFy
cmF5IG9mIEdFTSBvYmplY3QgaGFuZGxlcyBhbmQgcmV0dXJucyBhIG5ld2x5IGFsbG9jYXRlZCBh
cnJheSBvZgogICogR0VNIG9iamVjdHMuCiAgKgogICogRm9yIGEgc2luZ2xlIGhhbmRsZSBsb29r
dXAsIHVzZSBkcm1fZ2VtX29iamVjdF9sb29rdXAoKS4KQEAgLTY5NSwxMSArNjk1LDEwIEBAIHN0
YXRpYyBpbnQgb2JqZWN0c19sb29rdXAoc3RydWN0IGRybV9maWxlICpmaWxwLCB1MzIgKmhhbmRs
ZSwgaW50IGNvdW50LAogICogZmFpbHVyZS4gMCBpcyByZXR1cm5lZCBvbiBzdWNjZXNzLgogICoK
ICAqLwotaW50IGRybV9nZW1fb2JqZWN0c19sb29rdXAoc3RydWN0IGRybV9maWxlICpmaWxwLCB2
b2lkIF9fdXNlciAqYm9faGFuZGxlcywKK2ludCBkcm1fZ2VtX29iamVjdHNfbG9va3VwKHN0cnVj
dCBkcm1fZmlsZSAqZmlscCwgdTMyICpib19oYW5kbGVzLAogCQkJICAgaW50IGNvdW50LCBzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKioqb2Jqc19vdXQpCiB7CiAJaW50IHJldDsKLQl1MzIgKmhhbmRs
ZXM7CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqczsKIAogCWlmICghY291bnQpCkBAIC03
MTAsMjMgKzcwOSwxMiBAQCBpbnQgZHJtX2dlbV9vYmplY3RzX2xvb2t1cChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbHAsIHZvaWQgX191c2VyICpib19oYW5kbGVzLAogCWlmICghb2JqcykKIAkJcmV0dXJu
IC1FTk9NRU07CiAKLQloYW5kbGVzID0ga3ZtYWxsb2NfYXJyYXkoY291bnQsIHNpemVvZih1MzIp
LCBHRlBfS0VSTkVMKTsKLQlpZiAoIWhhbmRsZXMpIHsKLQkJcmV0ID0gLUVOT01FTTsKLQkJZ290
byBvdXQ7Ci0JfQotCi0JaWYgKGNvcHlfZnJvbV91c2VyKGhhbmRsZXMsIGJvX2hhbmRsZXMsIGNv
dW50ICogc2l6ZW9mKHUzMikpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0JCURSTV9ERUJVRygiRmFp
bGVkIHRvIGNvcHkgaW4gR0VNIGhhbmRsZXNcbiIpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlyZXQg
PSBvYmplY3RzX2xvb2t1cChmaWxwLCBoYW5kbGVzLCBjb3VudCwgb2Jqcyk7Ci0JKm9ianNfb3V0
ID0gb2JqczsKKwlyZXQgPSBvYmplY3RzX2xvb2t1cChmaWxwLCBib19oYW5kbGVzLCBjb3VudCwg
b2Jqcyk7CisJaWYgKHJldCkKKwkJa3ZmcmVlKG9ianMpOworCWVsc2UKKwkJKm9ianNfb3V0ID0g
b2JqczsKIAotb3V0OgotCWt2ZnJlZShoYW5kbGVzKTsKIAlyZXR1cm4gcmV0OwogCiB9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKaW5kZXggZDc0NDQyZDcxMDQ4Li42MTZm
OGZjYzQ2NTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9k
cnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKQEAgLTEx
OSw2ICsxMTksOSBAQCBwYW5mcm9zdF9sb29rdXBfYm9zKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJCSAgc3RydWN0IGRybV9wYW5mcm9zdF9zdWJtaXQgKmFyZ3MsCiAJCSAgc3RydWN0IHBhbmZy
b3N0X2pvYiAqam9iKQogeworCXUzMiAqaGFuZGxlczsKKwlpbnQgcmV0OworCiAJam9iLT5ib19j
b3VudCA9IGFyZ3MtPmJvX2hhbmRsZV9jb3VudDsKIAogCWlmICgham9iLT5ib19jb3VudCkKQEAg
LTEzMCw5ICsxMzMsMjMgQEAgcGFuZnJvc3RfbG9va3VwX2JvcyhzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCWlmICgham9iLT5pbXBsaWNpdF9mZW5jZXMpCiAJCXJldHVybiAtRU5PTUVNOwogCi0J
cmV0dXJuIGRybV9nZW1fb2JqZWN0c19sb29rdXAoZmlsZV9wcml2LAotCQkJCSAgICAgICh2b2lk
IF9fdXNlciAqKSh1aW50cHRyX3QpYXJncy0+Ym9faGFuZGxlcywKLQkJCQkgICAgICBqb2ItPmJv
X2NvdW50LCAmam9iLT5ib3MpOworCWhhbmRsZXMgPSBrdm1hbGxvY19hcnJheShqb2ItPmJvX2Nv
dW50LCBzaXplb2YodTMyKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFoYW5kbGVzKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCWlmIChjb3B5X2Zyb21fdXNlcihoYW5kbGVzLCAodm9pZCBfX3VzZXIgKiko
dWludHB0cl90KWFyZ3MtPmJvX2hhbmRsZXMsCisJCQkgICBqb2ItPmJvX2NvdW50ICogc2l6ZW9m
KHUzMikpKSB7CisJCURSTV9ERUJVRygiRmFpbGVkIHRvIGNvcHkgaW4gR0VNIGhhbmRsZXNcbiIp
OworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSBkcm1fZ2VtX29i
amVjdHNfbG9va3VwKGZpbGVfcHJpdiwgaGFuZGxlcywKKwkJCQkgICAgIGpvYi0+Ym9fY291bnQs
ICZqb2ItPmJvcyk7CisKK291dDoKKwlrdmZyZWUoaGFuZGxlcyk7CisJcmV0dXJuIHJldDsKIH0K
IAogLyoqCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtLmggYi9pbmNsdWRlL2RybS9k
cm1fZ2VtLmgKaW5kZXggNmFhYmExNGY1OTcyLi5jMjNhYzM2MjMxYmEgMTAwNjQ0Ci0tLSBhL2lu
Y2x1ZGUvZHJtL2RybV9nZW0uaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtLmgKQEAgLTM4Nyw3
ICszODcsNyBAQCBzdHJ1Y3QgcGFnZSAqKmRybV9nZW1fZ2V0X3BhZ2VzKHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqb2JqKTsKIHZvaWQgZHJtX2dlbV9wdXRfcGFnZXMoc3RydWN0IGRybV9nZW1fb2Jq
ZWN0ICpvYmosIHN0cnVjdCBwYWdlICoqcGFnZXMsCiAJCWJvb2wgZGlydHksIGJvb2wgYWNjZXNz
ZWQpOwogCi1pbnQgZHJtX2dlbV9vYmplY3RzX2xvb2t1cChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbHAs
IHZvaWQgX191c2VyICpib19oYW5kbGVzLAoraW50IGRybV9nZW1fb2JqZWN0c19sb29rdXAoc3Ry
dWN0IGRybV9maWxlICpmaWxwLCB1MzIgKmJvX2hhbmRsZXMsCiAJCQkgICBpbnQgY291bnQsIHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqKipvYmpzX291dCk7CiBzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
KmRybV9nZW1fb2JqZWN0X2xvb2t1cChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbHAsIHUzMiBoYW5kbGUp
OwogbG9uZyBkcm1fZ2VtX2RtYV9yZXN2X3dhaXQoc3RydWN0IGRybV9maWxlICpmaWxlcCwgdTMy
IGhhbmRsZSwKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
