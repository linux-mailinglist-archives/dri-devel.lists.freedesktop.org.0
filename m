Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A0799D41C5
	for <lists+dri-devel@lfdr.de>; Fri, 11 Oct 2019 15:48:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 71BF36EC3F;
	Fri, 11 Oct 2019 13:48:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 117706EC40
 for <dri-devel@lists.freedesktop.org>; Fri, 11 Oct 2019 13:48:20 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 864F7AE46;
 Fri, 11 Oct 2019 13:48:18 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: hdegoede@redhat.com,
	airlied@linux.ie,
	daniel@ffwll.ch
Subject: [PATCH 2/3] drm/vboxvideo: Switch to drm_atomic_helper_dirty_fb()
Date: Fri, 11 Oct 2019 15:48:07 +0200
Message-Id: <20191011134808.3955-3-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191011134808.3955-1-tzimmermann@suse.de>
References: <20191011134808.3955-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHZib3h2aWRlbyBkcml2ZXIgcHJvdmlkZXMgc3RydWN0IGRybV9mcmFtZWJ1ZmZlcl9mdW5j
cy5kaXJ0eV9mYiBmcm9tCml0cyBvd24gaW1wbGVtZW50YXRpb24uIFN3aXRjaCBvdmVyIHRvIGRy
bV9hdG9taWNfaGVscGVyX2RpcnR5X2ZiKCkgYW5kCmhhbmRsZSBzY3JlZW4gdXBkYXRlcyBpbiB0
aGUgcHJpbWFyeSBwbGFuZSdzIGF0b21pY191cGRhdGUgZnVuY3Rpb24uCgpXaXRoIGRpcnR5X2Zi
IG91dCBvZiB0aGUgd2F5LCB3ZSBjYW4gZnVydGhlciByZXBsYWNlIHN0cnVjdCB2Ym94X2ZyYW1t
ZWJ1ZmZlcgp3aXRoIGdlbmVyaWMgY29kZS4KClNpZ25lZC1vZmYtYnk6IFRob21hcyBaaW1tZXJt
YW5uIDx0emltbWVybWFubkBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8v
dmJveF9kcnYuaCAgfCAgNCAtLQogZHJpdmVycy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X21haW4u
YyB8IDYxICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3Zib3h2
aWRlby92Ym94X21vZGUuYyB8IDM0ICsrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFuZ2VkLCAz
NiBpbnNlcnRpb25zKCspLCA2MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdmJveHZpZGVvL3Zib3hfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vdmJveHZpZGVvL3Zi
b3hfZHJ2LmgKaW5kZXggYmIwYzM5ZmU3OTExLi45OTc2NTU0YjU4Y2IgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
dmJveHZpZGVvL3Zib3hfZHJ2LmgKQEAgLTE0MywxMCArMTQzLDYgQEAgdm9pZCB2Ym94X21vZGVf
ZmluaShzdHJ1Y3QgdmJveF9wcml2YXRlICp2Ym94KTsKIAogdm9pZCB2Ym94X3JlcG9ydF9jYXBz
KHN0cnVjdCB2Ym94X3ByaXZhdGUgKnZib3gpOwogCi12b2lkIHZib3hfZnJhbWVidWZmZXJfZGly
dHlfcmVjdGFuZ2xlcyhzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgICAgICAgc3Ry
dWN0IGRybV9jbGlwX3JlY3QgKnJlY3RzLAotCQkJCSAgICAgICB1bnNpZ25lZCBpbnQgbnVtX3Jl
Y3RzKTsKLQogaW50IHZib3hfZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgdmJveF9wcml2YXRlICp2
Ym94LAogCQkJICBzdHJ1Y3QgdmJveF9mcmFtZWJ1ZmZlciAqdmJveF9mYiwKIAkJCSAgY29uc3Qg
c3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21kLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3Zib3h2aWRlby92Ym94X21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8v
dmJveF9tYWluLmMKaW5kZXggMDJmYTgyNzdmZjFlLi5iYTI0YTkyOTNkMTcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL3Zib3h2aWRlby92Ym94X21haW4uYwpAQCAtMTEsNiArMTEsNyBAQAogI2luY2x1ZGUgPGxp
bnV4L3Zib3hfZXJyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxwZXIuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX2NydGNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVy
Lmg+CiAKICNpbmNsdWRlICJ2Ym94X2Rydi5oIgogI2luY2x1ZGUgInZib3h2aWRlb19ndWVzdC5o
IgpAQCAtMzgsNjcgKzM5LDkgQEAgdm9pZCB2Ym94X3JlcG9ydF9jYXBzKHN0cnVjdCB2Ym94X3By
aXZhdGUgKnZib3gpCiAJaGdzbWlfc2VuZF9jYXBzX2luZm8odmJveC0+Z3Vlc3RfcG9vbCwgY2Fw
cyk7CiB9CiAKLS8qIFNlbmQgaW5mb3JtYXRpb24gYWJvdXQgZGlydHkgcmVjdGFuZ2xlcyB0byBW
QlZBLiAqLwotdm9pZCB2Ym94X2ZyYW1lYnVmZmVyX2RpcnR5X3JlY3RhbmdsZXMoc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkJICAgICAgIHN0cnVjdCBkcm1fY2xpcF9yZWN0ICpyZWN0
cywKLQkJCQkgICAgICAgdW5zaWduZWQgaW50IG51bV9yZWN0cykKLXsKLQlzdHJ1Y3QgdmJveF9w
cml2YXRlICp2Ym94ID0gZmItPmRldi0+ZGV2X3ByaXZhdGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKm1vZGU7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjOwotCWludCBjcnRjX3gsIGNydGNf
eTsKLQl1bnNpZ25lZCBpbnQgaTsKLQotCW11dGV4X2xvY2soJnZib3gtPmh3X211dGV4KTsKLQls
aXN0X2Zvcl9lYWNoX2VudHJ5KGNydGMsICZmYi0+ZGV2LT5tb2RlX2NvbmZpZy5jcnRjX2xpc3Qs
IGhlYWQpIHsKLQkJaWYgKGNydGMtPnByaW1hcnktPnN0YXRlLT5mYiAhPSBmYikKLQkJCWNvbnRp
bnVlOwotCi0JCW1vZGUgPSAmY3J0Yy0+c3RhdGUtPm1vZGU7Ci0JCWNydGNfeCA9IGNydGMtPnBy
aW1hcnktPnN0YXRlLT5zcmNfeCA+PiAxNjsKLQkJY3J0Y195ID0gY3J0Yy0+cHJpbWFyeS0+c3Rh
dGUtPnNyY195ID4+IDE2OwotCi0JCWZvciAoaSA9IDA7IGkgPCBudW1fcmVjdHM7ICsraSkgewot
CQkJc3RydWN0IHZidmFfY21kX2hkciBjbWRfaGRyOwotCQkJdW5zaWduZWQgaW50IGNydGNfaWQg
PSB0b192Ym94X2NydGMoY3J0YyktPmNydGNfaWQ7Ci0KLQkJCWlmIChyZWN0c1tpXS54MSA+IGNy
dGNfeCArIG1vZGUtPmhkaXNwbGF5IHx8Ci0JCQkgICAgcmVjdHNbaV0ueTEgPiBjcnRjX3kgKyBt
b2RlLT52ZGlzcGxheSB8fAotCQkJICAgIHJlY3RzW2ldLngyIDwgY3J0Y194IHx8Ci0JCQkgICAg
cmVjdHNbaV0ueTIgPCBjcnRjX3kpCi0JCQkJY29udGludWU7Ci0KLQkJCWNtZF9oZHIueCA9IChz
MTYpcmVjdHNbaV0ueDE7Ci0JCQljbWRfaGRyLnkgPSAoczE2KXJlY3RzW2ldLnkxOwotCQkJY21k
X2hkci53ID0gKHUxNilyZWN0c1tpXS54MiAtIHJlY3RzW2ldLngxOwotCQkJY21kX2hkci5oID0g
KHUxNilyZWN0c1tpXS55MiAtIHJlY3RzW2ldLnkxOwotCi0JCQlpZiAoIXZidmFfYnVmZmVyX2Jl
Z2luX3VwZGF0ZSgmdmJveC0+dmJ2YV9pbmZvW2NydGNfaWRdLAotCQkJCQkJICAgICAgdmJveC0+
Z3Vlc3RfcG9vbCkpCi0JCQkJY29udGludWU7Ci0KLQkJCXZidmFfd3JpdGUoJnZib3gtPnZidmFf
aW5mb1tjcnRjX2lkXSwgdmJveC0+Z3Vlc3RfcG9vbCwKLQkJCQkgICAmY21kX2hkciwgc2l6ZW9m
KGNtZF9oZHIpKTsKLQkJCXZidmFfYnVmZmVyX2VuZF91cGRhdGUoJnZib3gtPnZidmFfaW5mb1tj
cnRjX2lkXSk7Ci0JCX0KLQl9Ci0JbXV0ZXhfdW5sb2NrKCZ2Ym94LT5od19tdXRleCk7Ci19Ci0K
LXN0YXRpYyBpbnQgdmJveF91c2VyX2ZyYW1lYnVmZmVyX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAotCQkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwKLQkJCQkg
ICAgICAgdW5zaWduZWQgaW50IGZsYWdzLCB1bnNpZ25lZCBpbnQgY29sb3IsCi0JCQkJICAgICAg
IHN0cnVjdCBkcm1fY2xpcF9yZWN0ICpyZWN0cywKLQkJCQkgICAgICAgdW5zaWduZWQgaW50IG51
bV9yZWN0cykKLXsKLQl2Ym94X2ZyYW1lYnVmZmVyX2RpcnR5X3JlY3RhbmdsZXMoZmIsIHJlY3Rz
LCBudW1fcmVjdHMpOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyX2Z1bmNzIHZib3hfZmJfZnVuY3MgPSB7CiAJLmRlc3Ryb3kgPSB2Ym94X3Vz
ZXJfZnJhbWVidWZmZXJfZGVzdHJveSwKLQkuZGlydHkgPSB2Ym94X3VzZXJfZnJhbWVidWZmZXJf
ZGlydHksCisJLmRpcnR5ID0gZHJtX2F0b21pY19oZWxwZXJfZGlydHlmYiwKIH07CiAKIGludCB2
Ym94X2ZyYW1lYnVmZmVyX2luaXQoc3RydWN0IHZib3hfcHJpdmF0ZSAqdmJveCwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tb2RlLmMgYi9kcml2ZXJzL2dwdS9k
cm0vdmJveHZpZGVvL3Zib3hfbW9kZS5jCmluZGV4IGRkOWFkM2ZkZDkxOS4uNzA3NTRlOWEwODdl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmJveHZpZGVvL3Zib3hfbW9kZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9tb2RlLmMKQEAgLTI4NCwxMCArMjg0LDQ0
IEBAIHN0YXRpYyB2b2lkIHZib3hfcHJpbWFyeV9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAogewogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBsYW5lLT5zdGF0ZS0+Y3J0
YzsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lLT5zdGF0ZS0+ZmI7CisJc3Ry
dWN0IHZib3hfcHJpdmF0ZSAqdmJveCA9IGZiLT5kZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBk
cm1fbW9kZV9yZWN0ICpjbGlwczsKKwl1aW50MzJfdCBudW1fY2xpcHMsIGk7CiAKIAl2Ym94X2Ny
dGNfc2V0X2Jhc2VfYW5kX21vZGUoY3J0YywgZmIsCiAJCQkJICAgIHBsYW5lLT5zdGF0ZS0+c3Jj
X3ggPj4gMTYsCiAJCQkJICAgIHBsYW5lLT5zdGF0ZS0+c3JjX3kgPj4gMTYpOworCisJLyogU2Vu
ZCBpbmZvcm1hdGlvbiBhYm91dCBkaXJ0eSByZWN0YW5nbGVzIHRvIFZCVkEuICovCisKKwljbGlw
cyA9IGRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBzKHBsYW5lLT5zdGF0ZSk7CisJbnVtX2NsaXBz
ID0gZHJtX3BsYW5lX2dldF9kYW1hZ2VfY2xpcHNfY291bnQocGxhbmUtPnN0YXRlKTsKKworCWlm
ICghbnVtX2NsaXBzKQorCQlyZXR1cm47CisKKwltdXRleF9sb2NrKCZ2Ym94LT5od19tdXRleCk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtX2NsaXBzOyArK2ksICsrY2xpcHMpIHsKKworCQlzdHJ1
Y3QgdmJ2YV9jbWRfaGRyIGNtZF9oZHI7CisJCXVuc2lnbmVkIGludCBjcnRjX2lkID0gdG9fdmJv
eF9jcnRjKGNydGMpLT5jcnRjX2lkOworCisJCWNtZF9oZHIueCA9IChzMTYpY2xpcHMtPngxOwor
CQljbWRfaGRyLnkgPSAoczE2KWNsaXBzLT55MTsKKwkJY21kX2hkci53ID0gKHUxNiljbGlwcy0+
eDIgLSBjbGlwcy0+eDE7CisJCWNtZF9oZHIuaCA9ICh1MTYpY2xpcHMtPnkyIC0gY2xpcHMtPnkx
OworCisJCWlmICghdmJ2YV9idWZmZXJfYmVnaW5fdXBkYXRlKCZ2Ym94LT52YnZhX2luZm9bY3J0
Y19pZF0sCisJCQkJCSAgICAgIHZib3gtPmd1ZXN0X3Bvb2wpKQorCQkJY29udGludWU7CisKKwkJ
dmJ2YV93cml0ZSgmdmJveC0+dmJ2YV9pbmZvW2NydGNfaWRdLCB2Ym94LT5ndWVzdF9wb29sLAor
CQkJICAgJmNtZF9oZHIsIHNpemVvZihjbWRfaGRyKSk7CisJCXZidmFfYnVmZmVyX2VuZF91cGRh
dGUoJnZib3gtPnZidmFfaW5mb1tjcnRjX2lkXSk7CisJfQorCisJbXV0ZXhfdW5sb2NrKCZ2Ym94
LT5od19tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIHZib3hfcHJpbWFyeV9hdG9taWNfZGlzYWJs
ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
