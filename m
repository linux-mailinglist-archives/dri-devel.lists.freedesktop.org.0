Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3921D357E2
	for <lists+dri-devel@lfdr.de>; Wed,  5 Jun 2019 09:34:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7215D896AF;
	Wed,  5 Jun 2019 07:33:28 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x542.google.com (mail-pg1-x542.google.com
 [IPv6:2607:f8b0:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 89A6C893EA
 for <dri-devel@lists.freedesktop.org>; Wed,  5 Jun 2019 07:05:30 +0000 (UTC)
Received: by mail-pg1-x542.google.com with SMTP id v9so11854120pgr.13
 for <dri-devel@lists.freedesktop.org>; Wed, 05 Jun 2019 00:05:30 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=6pCTJe2VImOAmmKb6aOClOEflGCuNLp/Str0ZsPpKNY=;
 b=BzS8+OBrYcYwiPpe/+M5CeYgP2EbgCYEhptkJi5Tnu0zoxUnUR042cMir4c+6Xi7Hi
 fTAPcV6Ax2XplVgNSXxyn7kZjlr6dXJ5Swq9JdHRX7CjhYpihgRdI3MiWaOEEX2AZ9Li
 bB8OeZxk5XZ6cBTmdKHXxmOxBLkW5oyXRDfyMyNM+llRdvcly50HI5lqkUxaaW+cROjF
 1XSGMZOcaInSVbNJ3PGUgHGaZbwKjoBzd75LcEf1Z3AB+k+DJNkU7byg0+MbgdiZfiOs
 0uR4LHST7cV0IpUo2gJAdpMX5EODDVgw8qT+BhkVfeNoSxdOOtj2bL5vaw5N+UOr7Nw5
 1Ptg==
X-Gm-Message-State: APjAAAUJbRj7E/BHatQ81eFKB1zCXKJTFAF0oKy1fy8KMcFqVNxgFmM8
 yThTkUbI/G85eVf/J4HZlWF0IhIBZek=
X-Google-Smtp-Source: APXvYqxLMKk6U6zKXqr6gpbPvdRS62LU0IcUwv0kHLnS3kfhLDuFhpMReMWIwBWDwRtDdx2ssskCMw==
X-Received: by 2002:a65:4c4b:: with SMTP id l11mr2455871pgr.9.1559718329500;
 Wed, 05 Jun 2019 00:05:29 -0700 (PDT)
Received: from localhost.lan (c-24-22-235-96.hsd1.wa.comcast.net.
 [24.22.235.96])
 by smtp.gmail.com with ESMTPSA id d132sm6527348pfd.61.2019.06.05.00.05.27
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Wed, 05 Jun 2019 00:05:28 -0700 (PDT)
From: Andrey Smirnov <andrew.smirnov@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 05/15] drm/bridge: tc358767: Drop custom
 tc_write()/tc_read() accessors
Date: Wed,  5 Jun 2019 00:04:57 -0700
Message-Id: <20190605070507.11417-6-andrew.smirnov@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190605070507.11417-1-andrew.smirnov@gmail.com>
References: <20190605070507.11417-1-andrew.smirnov@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 05 Jun 2019 07:33:23 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=6pCTJe2VImOAmmKb6aOClOEflGCuNLp/Str0ZsPpKNY=;
 b=anGs2CjQdOuIY+L/wjc+Z50heuqNDqAcDdhFpkffhWuJId1R0EAL3L58xzy/kMCe6k
 TnMoPLOhPrkivjtTgcVX9HU0eZEfL5m9NkP7hRjzIxrceAgcXEZezCYaSNnxjIrmfHbt
 0iOfwMrQsTyav79ZFseuZyxuOpZlJ/DYVT8kGiC+K6hBm9TeO1jlMLyqalSWCpt2X317
 f3pJ3ByqfVf2xHpqil42WbClKpuuzDkKk9nRgovFiDXTJiKonvYEOgzDlRvOBuSltjBH
 tfyKrxBKvw3ecviUWwhD96MJAIOEB+lvsGaI/Nty47jLO5zprNaj2eApxx4pAVABi8rC
 NVhg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Cory Tusar <cory.tusar@zii.aero>, Archit Taneja <architt@codeaurora.org>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Andrey Gusakov <andrey.gusakov@cogentembedded.com>,
 linux-kernel@vger.kernel.org, Tomi Valkeinen <tomi.valkeinen@ti.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Chris Healy <cphealy@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QSB2ZXJ5IHVuZm9ydHVuYXRlIGFzcGVjdCBvZiB0Y193cml0ZSgpL3RjX3JlYWQoKSBtYWNybyBo
ZWxwZXJzIGlzCnRoYXQgdGhleSBjYXB0dXJlIHF1aXRlIGEgYml0IG9mIGNvbnRleHQgYXJvdW5k
IHRoZW0gYW5kIHRodXMgcmVxdWlyZQp0aGUgY2FsbGVyIHRvIGhhdmUgbWFnaWMgdmFyaWFibGVz
ICdyZXQnIGFuZCAndGMnIGFzIHdlbGwgYXMgbGFiZWwKJ2VycicuIFRoYXQgbWFrZXMgYSBudW1i
ZXIgb2YgY29kZSBwYXRocyByYXRoZXIgY291bnRlcmludHVpdGl2ZSBhbmQKc29tZXdoYXQgY2x1
bmt5LCBmb3IgZXhhbXBsZSB0Y19zdHJlYW1fY2xvY2tfY2FsYygpIGVuZHMgdXAgYmVpbmcgbGlr
ZQp0aGlzOgoKCWludCByZXQ7CgoJdGNfd3JpdGUoRFAwX1ZJRE1OR0VOMSwgMzI3NjgpOwoKCXJl
dHVybiAwOwplcnI6CglyZXR1cm4gcmV0OwoKd2hpY2ggaXMgcmF0aGVyIHN1cnByaXNpbmcgd2hl
biB5b3UgcmVhZCB0aGUgY29kZSBmb3IgdGhlIGZpcnN0CnRpbWUuIFNpbmNlIHRob3NlIGhlbHBl
cnMgYXJndWFibHkgYXJlbid0IHJlYWxseSBzYXZpbmcgdGhhdCBtdWNoIGNvZGUKYW5kIHRoZXJl
J3Mgbm8gd2F5IG9mIGZpeGluZyB0aGVtIHdpdGhvdXQgbWFraW5nIHRoZW0gdG9vIHZlcmJvc2Ug
dG8KYmUgd29ydGggaXQgY2hhbmdlIHRoZSBkcml2ZXIgY29kZSB0byBub3QgdXNlIHRoZW0gYXQg
YWxsLgoKU2lnbmVkLW9mZi1ieTogQW5kcmV5IFNtaXJub3YgPGFuZHJldy5zbWlybm92QGdtYWls
LmNvbT4KQ2M6IEFyY2hpdCBUYW5lamEgPGFyY2hpdHRAY29kZWF1cm9yYS5vcmc+CkNjOiBBbmRy
emVqIEhhamRhIDxhLmhhamRhQHNhbXN1bmcuY29tPgpDYzogTGF1cmVudCBQaW5jaGFydCA8TGF1
cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29tPgpDYzogVG9taSBWYWxrZWluZW4gPHRvbWku
dmFsa2VpbmVuQHRpLmNvbT4KQ2M6IEFuZHJleSBHdXNha292IDxhbmRyZXkuZ3VzYWtvdkBjb2dl
bnRlbWJlZGRlZC5jb20+CkNjOiBQaGlsaXBwIFphYmVsIDxwLnphYmVsQHBlbmd1dHJvbml4LmRl
PgpDYzogQ29yeSBUdXNhciA8Y29yeS50dXNhckB6aWkuYWVybz4KQ2M6IENocmlzIEhlYWx5IDxj
cGhlYWx5QGdtYWlsLmNvbT4KQ2M6IEx1Y2FzIFN0YWNoIDxsLnN0YWNoQHBlbmd1dHJvbml4LmRl
PgpDYzogZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpDYzogbGludXgta2VybmVsQHZn
ZXIua2VybmVsLm9yZwotLS0KIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvdGMzNTg3NjcuYyB8IDM4
MSArKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMjkgaW5z
ZXJ0aW9ucygrKSwgMTUyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9icmlkZ2UvdGMzNTg3NjcuYyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvdGMzNTg3NjcuYwpp
bmRleCBjMGZjNjg2Y2U1ZWMuLmUxOTdjZTBmYjE2NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS90YzM1ODc2Ny5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9icmlkZ2UvdGMzNTg3
NjcuYwpAQCAtMjgwLDIwICsyODAsNiBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCB0Y19kYXRhICpj
b25uZWN0b3JfdG9fdGMoc3RydWN0IGRybV9jb25uZWN0b3IgKmMpCiAJcmV0dXJuIGNvbnRhaW5l
cl9vZihjLCBzdHJ1Y3QgdGNfZGF0YSwgY29ubmVjdG9yKTsKIH0KIAotLyogU2ltcGxlIG1hY3Jv
cyB0byBhdm9pZCByZXBlYXRlZCBlcnJvciBjaGVja3MgKi8KLSNkZWZpbmUgdGNfd3JpdGUocmVn
LCB2YXIpCQkJCQlcCi0JZG8gewkJCQkJCQlcCi0JCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVn
bWFwLCByZWcsIHZhcik7CVwKLQkJaWYgKHJldCkJCQkJCVwKLQkJCWdvdG8gZXJyOwkJCQlcCi0J
fSB3aGlsZSAoMCkKLSNkZWZpbmUgdGNfcmVhZChyZWcsIHZhcikJCQkJCVwKLQlkbyB7CQkJCQkJ
CVwKLQkJcmV0ID0gcmVnbWFwX3JlYWQodGMtPnJlZ21hcCwgcmVnLCB2YXIpOwlcCi0JCWlmIChy
ZXQpCQkJCQlcCi0JCQlnb3RvIGVycjsJCQkJXAotCX0gd2hpbGUgKDApCi0KIHN0YXRpYyBpbmxp
bmUgaW50IHRjX3BvbGxfdGltZW91dChzdHJ1Y3QgdGNfZGF0YSAqdGMsIHVuc2lnbmVkIGludCBh
ZGRyLAogCQkJCSAgdW5zaWduZWQgaW50IGNvbmRfbWFzaywKIAkJCQkgIHVuc2lnbmVkIGludCBj
b25kX3ZhbHVlLApAQCAtMzUxLDcgKzMzNyw3IEBAIHN0YXRpYyBzc2l6ZV90IHRjX2F1eF90cmFu
c2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4LAogCiAJcmV0ID0gdGNfYXV4X3dhaXRfYnVzeSh0
YywgMTAwKTsKIAlpZiAocmV0KQotCQlnb3RvIGVycjsKKwkJcmV0dXJuIHJldDsKIAogCWlmIChy
ZXF1ZXN0ID09IERQX0FVWF9JMkNfV1JJVEUgfHwgcmVxdWVzdCA9PSBEUF9BVVhfTkFUSVZFX1dS
SVRFKSB7CiAJCS8qIFN0b3JlIGRhdGEgKi8KQEAgLTM2Miw3ICszNDgsMTEgQEAgc3RhdGljIHNz
aXplX3QgdGNfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsCiAJCQkJdG1wID0g
KHRtcCA8PCA4KSB8IGJ1ZltpXTsKIAkJCWkrKzsKIAkJCWlmICgoKGkgJSA0KSA9PSAwKSB8fCAo
aSA9PSBzaXplKSkgewotCQkJCXRjX3dyaXRlKERQMF9BVVhXREFUQSgoaSAtIDEpID4+IDIpLCB0
bXApOworCQkJCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLAorCQkJCQkJICAgRFAwX0FV
WFdEQVRBKChpIC0gMSkgPj4gMiksCisJCQkJCQkgICB0bXApOworCQkJCWlmIChyZXQpCisJCQkJ
CXJldHVybiByZXQ7CiAJCQkJdG1wID0gMDsKIAkJCX0KIAkJfQpAQCAtMzcyLDIzICszNjIsMzIg
QEAgc3RhdGljIHNzaXplX3QgdGNfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgs
CiAJfQogCiAJLyogU3RvcmUgYWRkcmVzcyAqLwotCXRjX3dyaXRlKERQMF9BVVhBRERSLCBtc2ct
PmFkZHJlc3MpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfQVVYQUREUiwg
bXNnLT5hZGRyZXNzKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCS8qIFN0YXJ0IHRyYW5z
ZmVyICovCi0JdGNfd3JpdGUoRFAwX0FVWENGRzAsICgoc2l6ZSAtIDEpIDw8IDgpIHwgcmVxdWVz
dCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9BVVhDRkcwLAorCQkJICAg
KChzaXplIC0gMSkgPDwgOCkgfCByZXF1ZXN0KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owog
CiAJcmV0ID0gdGNfYXV4X3dhaXRfYnVzeSh0YywgMTAwKTsKIAlpZiAocmV0KQotCQlnb3RvIGVy
cjsKKwkJcmV0dXJuIHJldDsKIAogCXJldCA9IHRjX2F1eF9nZXRfc3RhdHVzKHRjLCAmbXNnLT5y
ZXBseSk7CiAJaWYgKHJldCkKLQkJZ290byBlcnI7CisJCXJldHVybiByZXQ7CiAKIAlpZiAocmVx
dWVzdCA9PSBEUF9BVVhfSTJDX1JFQUQgfHwgcmVxdWVzdCA9PSBEUF9BVVhfTkFUSVZFX1JFQUQp
IHsKIAkJLyogUmVhZCBkYXRhICovCiAJCXdoaWxlIChpIDwgc2l6ZSkgewotCQkJaWYgKChpICUg
NCkgPT0gMCkKLQkJCQl0Y19yZWFkKERQMF9BVVhSREFUQShpID4+IDIpLCAmdG1wKTsKKwkJCWlm
ICgoaSAlIDQpID09IDApIHsKKwkJCQlyZXQgPSByZWdtYXBfcmVhZCh0Yy0+cmVnbWFwLAorCQkJ
CQkJICBEUDBfQVVYUkRBVEEoaSA+PiAyKSwgJnRtcCk7CisJCQkJaWYgKHJldCkKKwkJCQkJcmV0
dXJuIHJldDsKKwkJCX0KIAkJCWJ1ZltpXSA9IHRtcCAmIDB4ZmY7CiAJCQl0bXAgPSB0bXAgPj4g
ODsKIAkJCWkrKzsKQEAgLTM5Niw4ICszOTUsNiBAQCBzdGF0aWMgc3NpemVfdCB0Y19hdXhfdHJh
bnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwKIAl9CiAKIAlyZXR1cm4gc2l6ZTsKLWVycjoK
LQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IHRyYWluaW5nX3Bh
dHRlcm4xX2Vycm9yc1tdID0gewpAQCAtNDU0LDYgKzQ1MSw3IEBAIHN0YXRpYyBpbnQgdGNfcHhs
X3BsbF9lbihzdHJ1Y3QgdGNfZGF0YSAqdGMsIHUzMiByZWZjbGssIHUzMiBwaXhlbGNsb2NrKQog
CWludCBleHRfZGl2W10gPSB7MSwgMiwgMywgNSwgN307CiAJaW50IGJlc3RfcGl4ZWxjbG9jayA9
IDA7CiAJaW50IHZjb19oaSA9IDA7CisJdTMyIHB4bF9wbGxwYXJhbTsKIAogCWRldl9kYmcodGMt
PmRldiwgIlBMTDogcmVxdWVzdGVkICVkIHBpeGVsY2xvY2ssIHJlZiAlZFxuIiwgcGl4ZWxjbG9j
aywKIAkJcmVmY2xrKTsKQEAgLTUyMywyNCArNTIxLDI5IEBAIHN0YXRpYyBpbnQgdGNfcHhsX3Bs
bF9lbihzdHJ1Y3QgdGNfZGF0YSAqdGMsIHUzMiByZWZjbGssIHUzMiBwaXhlbGNsb2NrKQogCQli
ZXN0X211bCA9IDA7CiAKIAkvKiBQb3dlciB1cCBQTEwgYW5kIHN3aXRjaCB0byBieXBhc3MgKi8K
LQl0Y193cml0ZShQWExfUExMQ1RSTCwgUExMQllQIHwgUExMRU4pOworCXJldCA9IHJlZ21hcF93
cml0ZSh0Yy0+cmVnbWFwLCBQWExfUExMQ1RSTCwgUExMQllQIHwgUExMRU4pOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwlweGxfcGxscGFyYW0gID0gdmNvX2hpIDw8IDI0OyAvKiBGb3Ig
UExMIFZDTyA+PSAzMDAgTUh6ID0gMSAqLworCXB4bF9wbGxwYXJhbSB8PSBleHRfZGl2W2Jlc3Rf
cHJlXSA8PCAyMDsgLyogRXh0ZXJuYWwgUHJlLWRpdmlkZXIgKi8KKwlweGxfcGxscGFyYW0gfD0g
ZXh0X2RpdltiZXN0X3Bvc3RdIDw8IDE2OyAvKiBFeHRlcm5hbCBQb3N0LWRpdmlkZXIgKi8KKwlw
eGxfcGxscGFyYW0gfD0gSU5fU0VMX1JFRkNMSzsgLyogVXNlIFJlZkNsayBhcyBQTEwgaW5wdXQg
Ki8KKwlweGxfcGxscGFyYW0gfD0gYmVzdF9kaXYgPDwgODsgLyogRGl2aWRlciBmb3IgUExMIFJl
ZkNsayAqLworCXB4bF9wbGxwYXJhbSB8PSBiZXN0X211bDsgLyogTXVsdGlwbGllciBmb3IgUExM
ICovCiAKLQl0Y193cml0ZShQWExfUExMUEFSQU0sCi0JCSAodmNvX2hpIDw8IDI0KSB8CQkvKiBG
b3IgUExMIFZDTyA+PSAzMDAgTUh6ID0gMSAqLwotCQkgKGV4dF9kaXZbYmVzdF9wcmVdIDw8IDIw
KSB8CS8qIEV4dGVybmFsIFByZS1kaXZpZGVyICovCi0JCSAoZXh0X2RpdltiZXN0X3Bvc3RdIDw8
IDE2KSB8CS8qIEV4dGVybmFsIFBvc3QtZGl2aWRlciAqLwotCQkgSU5fU0VMX1JFRkNMSyB8CQkv
KiBVc2UgUmVmQ2xrIGFzIFBMTCBpbnB1dCAqLwotCQkgKGJlc3RfZGl2IDw8IDgpIHwJCS8qIERp
dmlkZXIgZm9yIFBMTCBSZWZDbGsgKi8KLQkJIChiZXN0X211bCA8PCAwKSk7CQkvKiBNdWx0aXBs
aWVyIGZvciBQTEwgKi8KKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgUFhMX1BMTFBB
UkFNLCBweGxfcGxscGFyYW0pOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAkvKiBGb3Jj
ZSBQTEwgcGFyYW1ldGVyIHVwZGF0ZSBhbmQgZGlzYWJsZSBieXBhc3MgKi8KLQl0Y193cml0ZShQ
WExfUExMQ1RSTCwgUExMVVBEQVRFIHwgUExMRU4pOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+
cmVnbWFwLCBQWExfUExMQ1RSTCwgUExMVVBEQVRFIHwgUExMRU4pOworCWlmIChyZXQpCisJCXJl
dHVybiByZXQ7CiAKIAl0Y193YWl0X3BsbF9sb2NrKHRjKTsKIAogCXJldHVybiAwOwotZXJyOgot
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdGNfcHhsX3BsbF9kaXMoc3RydWN0IHRjX2Rh
dGEgKnRjKQpAQCAtNTUxLDcgKzU1NCw2IEBAIHN0YXRpYyBpbnQgdGNfcHhsX3BsbF9kaXMoc3Ry
dWN0IHRjX2RhdGEgKnRjKQogCiBzdGF0aWMgaW50IHRjX3N0cmVhbV9jbG9ja19jYWxjKHN0cnVj
dCB0Y19kYXRhICp0YykKIHsKLQlpbnQgcmV0OwogCS8qCiAJICogSWYgdGhlIFN0cmVhbSBjbG9j
ayBhbmQgTGluayBTeW1ib2wgY2xvY2sgYXJlCiAJICogYXN5bmNocm9ub3VzIHdpdGggZWFjaCBv
dGhlciwgdGhlIHZhbHVlIG9mIE0gY2hhbmdlcyBvdmVyCkBAIC01NjcsMTYgKzU2OSwxMyBAQCBz
dGF0aWMgaW50IHRjX3N0cmVhbV9jbG9ja19jYWxjKHN0cnVjdCB0Y19kYXRhICp0YykKIAkgKiBN
L04gPSBmX1NUUk1DTEsgLyBmX0xTQ0xLCiAJICoKIAkgKi8KLQl0Y193cml0ZShEUDBfVklETU5H
RU4xLCAzMjc2OCk7Ci0KLQlyZXR1cm4gMDsKLWVycjoKLQlyZXR1cm4gcmV0OworCXJldHVybiBy
ZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1ZJRE1OR0VOMSwgMzI3NjgpOwogfQogCiBzdGF0
aWMgaW50IHRjX2F1eF9saW5rX3NldHVwKHN0cnVjdCB0Y19kYXRhICp0YykKIHsKIAl1bnNpZ25l
ZCBsb25nIHJhdGU7CisJdTMyIGRwMF9hdXhjZmcxOwogCXUzMiB2YWx1ZTsKIAlpbnQgcmV0Owog
CkBAIC02MDEsMTggKzYwMCwyNSBAQCBzdGF0aWMgaW50IHRjX2F1eF9saW5rX3NldHVwKHN0cnVj
dCB0Y19kYXRhICp0YykKIAogCS8qIFNldHVwIERQLVBIWSAvIFBMTCAqLwogCXZhbHVlIHw9IFNZ
U0NMS19TRUxfTFNDTEsgfCBMU0NMS19ESVZfMjsKLQl0Y193cml0ZShTWVNfUExMUEFSQU0sIHZh
bHVlKTsKLQotCXRjX3dyaXRlKERQX1BIWV9DVFJMLCBCR1JFTiB8IFBXUl9TV19FTiB8IFBIWV9B
MF9FTik7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIFNZU19QTExQQVJBTSwgdmFs
dWUpOworCWlmIChyZXQpCisJCWdvdG8gZXJyOwogCisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5y
ZWdtYXAsIERQX1BIWV9DVFJMLCBCR1JFTiB8IFBXUl9TV19FTiB8IFBIWV9BMF9FTik7CisJaWYg
KHJldCkKKwkJZ290byBlcnI7CiAJLyoKIAkgKiBJbml0aWFsbHkgUExMcyBhcmUgaW4gYnlwYXNz
LiBGb3JjZSBQTEwgcGFyYW1ldGVyIHVwZGF0ZSwKIAkgKiBkaXNhYmxlIFBMTCBieXBhc3MsIGVu
YWJsZSBQTEwKIAkgKi8KLQl0Y193cml0ZShEUDBfUExMQ1RSTCwgUExMVVBEQVRFIHwgUExMRU4p
OworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfUExMQ1RSTCwgUExMVVBEQVRF
IHwgUExMRU4pOworCWlmIChyZXQpCisJCWdvdG8gZXJyOwogCXRjX3dhaXRfcGxsX2xvY2sodGMp
OwogCi0JdGNfd3JpdGUoRFAxX1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsKKwlyZXQgPSBy
ZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAxX1BMTENUUkwsIFBMTFVQREFURSB8IFBMTEVOKTsK
KwlpZiAocmV0KQorCQlnb3RvIGVycjsKIAl0Y193YWl0X3BsbF9sb2NrKHRjKTsKIAogCXJldCA9
IHRjX3BvbGxfdGltZW91dCh0YywgRFBfUEhZX0NUUkwsIFBIWV9SRFksIFBIWV9SRFksIDEsIDEw
MDApOwpAQCAtNjI0LDkgKzYzMCwxMyBAQCBzdGF0aWMgaW50IHRjX2F1eF9saW5rX3NldHVwKHN0
cnVjdCB0Y19kYXRhICp0YykKIAl9CiAKIAkvKiBTZXR1cCBBVVggbGluayAqLwotCXRjX3dyaXRl
KERQMF9BVVhDRkcxLCBBVVhfUlhfRklMVEVSX0VOIHwKLQkJICgweDA2IDw8IDgpIHwJLyogQXV4
IEJpdCBQZXJpb2QgQ2FsY3VsYXRvciBUaHJlc2hvbGQgKi8KLQkJICgweDNmIDw8IDApKTsJLyog
QXV4IFJlc3BvbnNlIFRpbWVvdXQgVGltZXIgKi8KKwlkcDBfYXV4Y2ZnMSAgPSBBVVhfUlhfRklM
VEVSX0VOOworCWRwMF9hdXhjZmcxIHw9IDB4MDYgPDwgODsgLyogQXV4IEJpdCBQZXJpb2QgQ2Fs
Y3VsYXRvciBUaHJlc2hvbGQgKi8KKwlkcDBfYXV4Y2ZnMSB8PSAweDNmIDw8IDA7IC8qIEF1eCBS
ZXNwb25zZSBUaW1lb3V0IFRpbWVyICovCisKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21h
cCwgRFAwX0FVWENGRzEsIGRwMF9hdXhjZmcxKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKIAog
CXJldHVybiAwOwogZXJyOgpAQCAtNzI3LDQ4ICs3MzcsNzMgQEAgc3RhdGljIGludCB0Y19zZXRf
dmlkZW9fbW9kZShzdHJ1Y3QgdGNfZGF0YSAqdGMsCiAJICogYXNzdW1lIHdlIGRvIG5vdCBuZWVk
IGFueSBkZWxheSB3aGVuIERQSSBpcyBhIHNvdXJjZSBvZgogCSAqIHN5bmMgc2lnbmFscwogCSAq
LwotCXRjX3dyaXRlKFZQQ1RSTDAsCi0JCSBGSUVMRF9QUkVQKFZTREVMQVksIDApIHwKLQkJIE9Q
WExGTVRfUkdCODg4IHwgRlJNU1lOQ19ESVNBQkxFRCB8IE1TRl9ESVNBQkxFRCk7Ci0JdGNfd3Jp
dGUoSFRJTTAxLAotCQkgRklFTERfUFJFUChIQlBSLCBBTElHTihsZWZ0X21hcmdpbiwgMikpIHwK
LQkJIEZJRUxEX1BSRVAoSFBXLCBBTElHTihoc3luY19sZW4sIDIpKSk7Ci0JdGNfd3JpdGUoSFRJ
TTAyLAotCQkgRklFTERfUFJFUChIRElTUFIsIEFMSUdOKG1vZGUtPmhkaXNwbGF5LCAyKSkgfAot
CQkgRklFTERfUFJFUChIRlBSLCBBTElHTihyaWdodF9tYXJnaW4sIDIpKSk7Ci0JdGNfd3JpdGUo
VlRJTTAxLAotCQkgRklFTERfUFJFUChWQlBSLCB1cHBlcl9tYXJnaW4pIHwKLQkJIEZJRUxEX1BS
RVAoVlNQUiwgdnN5bmNfbGVuKSk7Ci0JdGNfd3JpdGUoVlRJTTAyLAotCQkgRklFTERfUFJFUChW
RlBSLCBsb3dlcl9tYXJnaW4pIHwKLQkJIEZJRUxEX1BSRVAoVkRJU1BSLCBtb2RlLT52ZGlzcGxh
eSkpOwotCXRjX3dyaXRlKFZGVUVOMCwgVkZVRU4pOwkJLyogdXBkYXRlIHNldHRpbmdzICovCisJ
cmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIFZQQ1RSTDAsCisJCQkgICBGSUVMRF9QUkVQ
KFZTREVMQVksIDApIHwKKwkJCSAgIE9QWExGTVRfUkdCODg4IHwgRlJNU1lOQ19ESVNBQkxFRCB8
IE1TRl9ESVNBQkxFRCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IHJlZ21h
cF93cml0ZSh0Yy0+cmVnbWFwLCBIVElNMDEsCisJCQkgICBGSUVMRF9QUkVQKEhCUFIsIEFMSUdO
KGxlZnRfbWFyZ2luLCAyKSkgfAorCQkJICAgRklFTERfUFJFUChIUFcsIEFMSUdOKGhzeW5jX2xl
biwgMikpKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gcmVnbWFwX3dyaXRl
KHRjLT5yZWdtYXAsIEhUSU0wMiwKKwkJCSAgIEZJRUxEX1BSRVAoSERJU1BSLCBBTElHTihtb2Rl
LT5oZGlzcGxheSwgMikpIHwKKwkJCSAgIEZJRUxEX1BSRVAoSEZQUiwgQUxJR04ocmlnaHRfbWFy
Z2luLCAyKSkpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSByZWdtYXBfd3Jp
dGUodGMtPnJlZ21hcCwgVlRJTTAxLAorCQkJICAgRklFTERfUFJFUChWQlBSLCB1cHBlcl9tYXJn
aW4pIHwKKwkJCSAgIEZJRUxEX1BSRVAoVlNQUiwgdnN5bmNfbGVuKSk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKKworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBWVElNMDIsCisJ
CQkgICBGSUVMRF9QUkVQKFZGUFIsIGxvd2VyX21hcmdpbikgfAorCQkJICAgRklFTERfUFJFUChW
RElTUFIsIG1vZGUtPnZkaXNwbGF5KSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJl
dCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBWRlVFTjAsIFZGVUVOKTsgLyogdXBkYXRlIHNl
dHRpbmdzICovCisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAogCS8qIFRlc3QgcGF0dGVybiBz
ZXR0aW5ncyAqLwotCXRjX3dyaXRlKFRTVENUTCwKLQkJIEZJRUxEX1BSRVAoQ09MT1JfUiwgMTIw
KSB8Ci0JCSBGSUVMRF9QUkVQKENPTE9SX0csIDIwKSB8Ci0JCSBGSUVMRF9QUkVQKENPTE9SX0Is
IDk5KSB8Ci0JCSBFTkkyQ0ZJTFRFUiB8Ci0JCSBGSUVMRF9QUkVQKENPTE9SX0JBUl9NT0RFLCBD
T0xPUl9CQVJfTU9ERV9CQVJTKSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIFRT
VENUTCwKKwkJCSAgIEZJRUxEX1BSRVAoQ09MT1JfUiwgMTIwKSB8CisJCQkgICBGSUVMRF9QUkVQ
KENPTE9SX0csIDIwKSB8CisJCQkgICBGSUVMRF9QUkVQKENPTE9SX0IsIDk5KSB8CisJCQkgICBF
TkkyQ0ZJTFRFUiB8CisJCQkgICBGSUVMRF9QUkVQKENPTE9SX0JBUl9NT0RFLCBDT0xPUl9CQVJf
TU9ERV9CQVJTKSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAogCS8qIERQIE1haW4gU3Ry
ZWFtIEF0dHJpYnV0ZXMgKi8KIAl2aWRfc3luY19kbHkgPSBoc3luY19sZW4gKyBsZWZ0X21hcmdp
biArIG1vZGUtPmhkaXNwbGF5OwotCXRjX3dyaXRlKERQMF9WSURTWU5DREVMQVksCisJcmV0ID0g
cmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9WSURTWU5DREVMQVksCiAJCSBGSUVMRF9QUkVQ
KFRIUkVTSF9ETFksIG1heF90dV9zeW1ib2wpIHwKIAkJIEZJRUxEX1BSRVAoVklEX1NZTkNfRExZ
LCB2aWRfc3luY19kbHkpKTsKIAotCXRjX3dyaXRlKERQMF9UT1RBTFZBTCwKLQkJIEZJRUxEX1BS
RVAoSF9UT1RBTCwgbW9kZS0+aHRvdGFsKSB8Ci0JCSBGSUVMRF9QUkVQKFZfVE9UQUwsIG1vZGUt
PnZ0b3RhbCkpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfVE9UQUxWQUws
CisJCQkgICBGSUVMRF9QUkVQKEhfVE9UQUwsIG1vZGUtPmh0b3RhbCkgfAorCQkJICAgRklFTERf
UFJFUChWX1RPVEFMLCBtb2RlLT52dG90YWwpKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owog
Ci0JdGNfd3JpdGUoRFAwX1NUQVJUVkFMLAotCQkgRklFTERfUFJFUChIX1NUQVJULCBsZWZ0X21h
cmdpbiArIGhzeW5jX2xlbikgfAotCQkgRklFTERfUFJFUChWX1NUQVJULCB1cHBlcl9tYXJnaW4g
KyB2c3luY19sZW4pKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1NUQVJU
VkFMLAorCQkJICAgRklFTERfUFJFUChIX1NUQVJULCBsZWZ0X21hcmdpbiArIGhzeW5jX2xlbikg
fAorCQkJICAgRklFTERfUFJFUChWX1NUQVJULCB1cHBlcl9tYXJnaW4gKyB2c3luY19sZW4pKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0JdGNfd3JpdGUoRFAwX0FDVElWRVZBTCwKLQkJ
IEZJRUxEX1BSRVAoVl9BQ1QsIG1vZGUtPnZkaXNwbGF5KSB8Ci0JCSBGSUVMRF9QUkVQKEhfQUNU
LCBtb2RlLT5oZGlzcGxheSkpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBf
QUNUSVZFVkFMLAorCQkJICAgRklFTERfUFJFUChWX0FDVCwgbW9kZS0+dmRpc3BsYXkpIHwKKwkJ
CSAgIEZJRUxEX1BSRVAoSF9BQ1QsIG1vZGUtPmhkaXNwbGF5KSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKIAogCWRwMF9zeW5jdmFsID0gRklFTERfUFJFUChWU19XSURUSCwgdnN5bmNfbGVu
KSB8CiAJCSAgICAgIEZJRUxEX1BSRVAoSFNfV0lEVEgsIGhzeW5jX2xlbik7CkBAIC03NzksMjEg
KzgxNCwyNSBAQCBzdGF0aWMgaW50IHRjX3NldF92aWRlb19tb2RlKHN0cnVjdCB0Y19kYXRhICp0
YywKIAlpZiAobW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX05IU1lOQykKIAkJZHAwX3N5bmN2
YWwgfD0gU1lOQ1ZBTF9IU19QT0xfQUNUSVZFX0xPVzsKIAotCXRjX3dyaXRlKERQMF9TWU5DVkFM
LCBkcDBfc3luY3ZhbCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9TWU5D
VkFMLCBkcDBfc3luY3ZhbCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAotCXRjX3dyaXRl
KERQSVBYTEZNVCwKLQkJIFZTX1BPTF9BQ1RJVkVfTE9XIHwgSFNfUE9MX0FDVElWRV9MT1cgfAot
CQkgREVfUE9MX0FDVElWRV9ISUdIIHwgU1VCX0NGR19UWVBFX0NPTkZJRzEgfAotCQkgRFBJX0JQ
UF9SR0I4ODgpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUElQWExGTVQsCisJ
CQkgICBWU19QT0xfQUNUSVZFX0xPVyB8IEhTX1BPTF9BQ1RJVkVfTE9XIHwKKwkJCSAgIERFX1BP
TF9BQ1RJVkVfSElHSCB8IFNVQl9DRkdfVFlQRV9DT05GSUcxIHwKKwkJCSAgIERQSV9CUFBfUkdC
ODg4KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0JdGNfd3JpdGUoRFAwX01JU0MsCi0J
CSBGSUVMRF9QUkVQKE1BWF9UVV9TWU1CT0wsIG1heF90dV9zeW1ib2wpIHwKLQkJIEZJRUxEX1BS
RVAoVFVfU0laRSwgVFVfU0laRV9SRUNPTU1FTkRFRCkgfAotCQkgQlBDXzgpOworCXJldCA9IHJl
Z21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfTUlTQywKKwkJCSAgIEZJRUxEX1BSRVAoTUFYX1RV
X1NZTUJPTCwgbWF4X3R1X3N5bWJvbCkgfAorCQkJICAgRklFTERfUFJFUChUVV9TSVpFLCBUVV9T
SVpFX1JFQ09NTUVOREVEKSB8CisJCQkgICBCUENfOCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKIAogCXJldHVybiAwOwotZXJyOgotCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdGNf
d2FpdF9saW5rX3RyYWluaW5nKHN0cnVjdCB0Y19kYXRhICp0YykKQEAgLTgwOCwxMSArODQ3LDEx
IEBAIHN0YXRpYyBpbnQgdGNfd2FpdF9saW5rX3RyYWluaW5nKHN0cnVjdCB0Y19kYXRhICp0YykK
IAkJcmV0dXJuIHJldDsKIAl9CiAKLQl0Y19yZWFkKERQMF9MVFNUQVQsICZ2YWx1ZSk7CisJcmV0
ID0gcmVnbWFwX3JlYWQodGMtPnJlZ21hcCwgRFAwX0xUU1RBVCwgJnZhbHVlKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OwogCiAJcmV0dXJuICh2YWx1ZSA+PiA4KSAmIDB4NzsKLWVycjoKLQly
ZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IHRjX21haW5fbGlua19lbmFibGUoc3RydWN0IHRj
X2RhdGEgKnRjKQpAQCAtODI3LDE1ICs4NjYsMjUgQEAgc3RhdGljIGludCB0Y19tYWluX2xpbmtf
ZW5hYmxlKHN0cnVjdCB0Y19kYXRhICp0YykKIAogCWRldl9kYmcodGMtPmRldiwgImxpbmsgZW5h
YmxlXG4iKTsKIAotCXRjX3JlYWQoRFAwQ1RMLCAmdmFsdWUpOwotCWlmIChXQVJOX09OKHZhbHVl
ICYgRFBfRU4pKQotCQl0Y193cml0ZShEUDBDVEwsIDApOworCXJldCA9IHJlZ21hcF9yZWFkKHRj
LT5yZWdtYXAsIERQMENUTCwgJnZhbHVlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJ
aWYgKFdBUk5fT04odmFsdWUgJiBEUF9FTikpIHsKKwkJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5y
ZWdtYXAsIERQMENUTCwgMCk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KIAotCXRj
X3dyaXRlKERQMF9TUkNDVFJMLCB0Y19zcmNjdHJsKHRjKSk7CisJcmV0ID0gcmVnbWFwX3dyaXRl
KHRjLT5yZWdtYXAsIERQMF9TUkNDVFJMLCB0Y19zcmNjdHJsKHRjKSk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIHJldDsKIAkvKiBTU0NHIGFuZCBCVzI3IG9uIERQMSBtdXN0IGJlIHNldCB0byB0aGUg
c2FtZSBhcyBvbiBEUDAgKi8KLQl0Y193cml0ZShEUDFfU1JDQ1RSTCwKKwlyZXQgPSByZWdtYXBf
d3JpdGUodGMtPnJlZ21hcCwgRFAxX1NSQ0NUUkwsCiAJCSAodGMtPmxpbmsuc3ByZWFkID8gRFAw
X1NSQ0NUUkxfU1NDRyA6IDApIHwKIAkJICgodGMtPmxpbmsuYmFzZS5yYXRlICE9IDE2MjAwMCkg
PyBEUDBfU1JDQ1RSTF9CVzI3IDogMCkpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAly
YXRlID0gY2xrX2dldF9yYXRlKHRjLT5yZWZjbGspOwogCXN3aXRjaCAocmF0ZSkgewpAQCAtODU1
LDI3ICs5MDQsMzYgQEAgc3RhdGljIGludCB0Y19tYWluX2xpbmtfZW5hYmxlKHN0cnVjdCB0Y19k
YXRhICp0YykKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCXZhbHVlIHw9IFNZU0NMS19TRUxfTFND
TEsgfCBMU0NMS19ESVZfMjsKLQl0Y193cml0ZShTWVNfUExMUEFSQU0sIHZhbHVlKTsKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgU1lTX1BMTFBBUkFNLCB2YWx1ZSk7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKIAogCS8qIFNldHVwIE1haW4gTGluayAqLwogCWRwX3BoeV9jdHJs
ID0gQkdSRU4gfCBQV1JfU1dfRU4gfCBQSFlfQTBfRU4gfCBQSFlfTTBfRU47CiAJaWYgKHRjLT5s
aW5rLmJhc2UubnVtX2xhbmVzID09IDIpCiAJCWRwX3BoeV9jdHJsIHw9IFBIWV8yTEFORTsKLQl0
Y193cml0ZShEUF9QSFlfQ1RSTCwgZHBfcGh5X2N0cmwpOworCisJcmV0ID0gcmVnbWFwX3dyaXRl
KHRjLT5yZWdtYXAsIERQX1BIWV9DVFJMLCBkcF9waHlfY3RybCk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKIAogCS8qIFBMTCBzZXR1cCAqLwotCXRjX3dyaXRlKERQMF9QTExDVFJMLCBQTExV
UERBVEUgfCBQTExFTik7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9QTExD
VFJMLCBQTExVUERBVEUgfCBQTExFTik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAl0Y193
YWl0X3BsbF9sb2NrKHRjKTsKIAotCXRjX3dyaXRlKERQMV9QTExDVFJMLCBQTExVUERBVEUgfCBQ
TExFTik7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMV9QTExDVFJMLCBQTExV
UERBVEUgfCBQTExFTik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAl0Y193YWl0X3BsbF9s
b2NrKHRjKTsKIAogCS8qIFJlc2V0L0VuYWJsZSBNYWluIExpbmtzICovCiAJZHBfcGh5X2N0cmwg
fD0gRFBfUEhZX1JTVCB8IFBIWV9NMV9SU1QgfCBQSFlfTTBfUlNUOwotCXRjX3dyaXRlKERQX1BI
WV9DVFJMLCBkcF9waHlfY3RybCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQ
X1BIWV9DVFJMLCBkcF9waHlfY3RybCk7CiAJdXNsZWVwX3JhbmdlKDEwMCwgMjAwKTsKIAlkcF9w
aHlfY3RybCAmPSB+KERQX1BIWV9SU1QgfCBQSFlfTTFfUlNUIHwgUEhZX00wX1JTVCk7Ci0JdGNf
d3JpdGUoRFBfUEhZX0NUUkwsIGRwX3BoeV9jdHJsKTsKKwlyZXQgPSByZWdtYXBfd3JpdGUodGMt
PnJlZ21hcCwgRFBfUEhZX0NUUkwsIGRwX3BoeV9jdHJsKTsKIAogCXJldCA9IHRjX3BvbGxfdGlt
ZW91dCh0YywgRFBfUEhZX0NUUkwsIFBIWV9SRFksIFBIWV9SRFksIDEsIDEwMDApOwogCWlmIChy
ZXQpIHsKQEAgLTg4Nyw3ICs5NDUsNyBAQCBzdGF0aWMgaW50IHRjX21haW5fbGlua19lbmFibGUo
c3RydWN0IHRjX2RhdGEgKnRjKQogCS8qIFNldCBtaXNjOiA4IGJpdHMgcGVyIGNvbG9yICovCiAJ
cmV0ID0gcmVnbWFwX3VwZGF0ZV9iaXRzKHRjLT5yZWdtYXAsIERQMF9NSVNDLCBCUENfOCwgQlBD
XzgpOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyOworCQlyZXR1cm4gcmV0OwogCiAJLyoKIAkgKiBB
U1NSIG1vZGUKQEAgLTk0MCw1MyArOTk4LDcxIEBAIHN0YXRpYyBpbnQgdGNfbWFpbl9saW5rX2Vu
YWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAJLyogQ2xvY2stUmVjb3ZlcnkgKi8KIAogCS8qIFNl
dCBEUENEIDB4MTAyIGZvciBUcmFpbmluZyBQYXR0ZXJuIDEgKi8KLQl0Y193cml0ZShEUDBfU05L
TFRDVFJMLCBEUF9MSU5LX1NDUkFNQkxJTkdfRElTQUJMRSB8Ci0JCSBEUF9UUkFJTklOR19QQVRU
RVJOXzEpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfU05LTFRDVFJMLAor
CQkJICAgRFBfTElOS19TQ1JBTUJMSU5HX0RJU0FCTEUgfAorCQkJICAgRFBfVFJBSU5JTkdfUEFU
VEVSTl8xKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0JdGNfd3JpdGUoRFAwX0xUTE9P
UENUUkwsCi0JCSAoMTUgPDwgMjgpIHwJLyogRGVmZXIgSXRlcmF0aW9uIENvdW50ICovCi0JCSAo
MTUgPDwgMjQpIHwJLyogTG9vcCBJdGVyYXRpb24gQ291bnQgKi8KLQkJICgweGQgPDwgMCkpOwkv
KiBMb29wIFRpbWVyIERlbGF5ICovCisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQ
MF9MVExPT1BDVFJMLAorCQkJICAgKDE1IDw8IDI4KSB8CS8qIERlZmVyIEl0ZXJhdGlvbiBDb3Vu
dCAqLworCQkJICAgKDE1IDw8IDI0KSB8CS8qIExvb3AgSXRlcmF0aW9uIENvdW50ICovCisJCQkg
ICAoMHhkIDw8IDApKTsJLyogTG9vcCBUaW1lciBEZWxheSAqLworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CiAKLQl0Y193cml0ZShEUDBfU1JDQ1RSTCwgdGNfc3JjY3RybCh0YykgfCBEUDBfU1JD
Q1RSTF9TQ1JNQkxESVMgfAotCQkgRFAwX1NSQ0NUUkxfQVVUT0NPUlJFQ1QgfCBEUDBfU1JDQ1RS
TF9UUDEpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBfU1JDQ1RSTCwKKwkJ
CSAgIHRjX3NyY2N0cmwodGMpIHwgRFAwX1NSQ0NUUkxfU0NSTUJMRElTIHwKKwkJCSAgIERQMF9T
UkNDVFJMX0FVVE9DT1JSRUNUIHwKKwkJCSAgIERQMF9TUkNDVFJMX1RQMSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKIAogCS8qIEVuYWJsZSBEUDAgdG8gc3RhcnQgTGluayBUcmFpbmluZyAq
LwotCXRjX3dyaXRlKERQMENUTCwKLQkJICgodGMtPmxpbmsuYmFzZS5jYXBhYmlsaXRpZXMgJiBE
UF9MSU5LX0NBUF9FTkhBTkNFRF9GUkFNSU5HKSA/IEVGX0VOIDogMCkgfAotCQkgRFBfRU4pOwor
CXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBEUDBDVEwsCisJCQkgICAoKHRjLT5saW5r
LmJhc2UuY2FwYWJpbGl0aWVzICYKKwkJCSAgICAgRFBfTElOS19DQVBfRU5IQU5DRURfRlJBTUlO
RykgPyBFRl9FTiA6IDApIHwKKwkJCSAgIERQX0VOKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OwogCiAJLyogd2FpdCAqLworCiAJcmV0ID0gdGNfd2FpdF9saW5rX3RyYWluaW5nKHRjKTsKIAlp
ZiAocmV0IDwgMCkKLQkJZ290byBlcnI7CisJCXJldHVybiByZXQ7CiAKIAlpZiAocmV0KSB7CiAJ
CWRldl9lcnIodGMtPmRldiwgIkxpbmsgdHJhaW5pbmcgcGhhc2UgMSBmYWlsZWQ6ICVzXG4iLAog
CQkJdHJhaW5pbmdfcGF0dGVybjFfZXJyb3JzW3JldF0pOwotCQlyZXQgPSAtRU5PREVWOwotCQln
b3RvIGVycjsKKwkJcmV0dXJuIC1FTk9ERVY7CiAJfQogCiAJLyogQ2hhbm5lbCBFcXVhbGl6YXRp
b24gKi8KIAogCS8qIFNldCBEUENEIDB4MTAyIGZvciBUcmFpbmluZyBQYXR0ZXJuIDIgKi8KLQl0
Y193cml0ZShEUDBfU05LTFRDVFJMLCBEUF9MSU5LX1NDUkFNQkxJTkdfRElTQUJMRSB8Ci0JCSBE
UF9UUkFJTklOR19QQVRURVJOXzIpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBE
UDBfU05LTFRDVFJMLAorCQkJICAgRFBfTElOS19TQ1JBTUJMSU5HX0RJU0FCTEUgfAorCQkJICAg
RFBfVFJBSU5JTkdfUEFUVEVSTl8yKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCi0JdGNf
d3JpdGUoRFAwX1NSQ0NUUkwsIHRjX3NyY2N0cmwodGMpIHwgRFAwX1NSQ0NUUkxfU0NSTUJMRElT
IHwKLQkJIERQMF9TUkNDVFJMX0FVVE9DT1JSRUNUIHwgRFAwX1NSQ0NUUkxfVFAyKTsKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1NSQ0NUUkwsCisJCQkgICB0Y19zcmNjdHJs
KHRjKSB8IERQMF9TUkNDVFJMX1NDUk1CTERJUyB8CisJCQkgICBEUDBfU1JDQ1RSTF9BVVRPQ09S
UkVDVCB8CisJCQkgICBEUDBfU1JDQ1RSTF9UUDIpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CiAKIAkvKiB3YWl0ICovCiAJcmV0ID0gdGNfd2FpdF9saW5rX3RyYWluaW5nKHRjKTsKIAlpZiAo
cmV0IDwgMCkKLQkJZ290byBlcnI7CisJCXJldHVybiByZXQ7CiAKIAlpZiAocmV0KSB7CiAJCWRl
dl9lcnIodGMtPmRldiwgIkxpbmsgdHJhaW5pbmcgcGhhc2UgMiBmYWlsZWQ6ICVzXG4iLAogCQkJ
dHJhaW5pbmdfcGF0dGVybjJfZXJyb3JzW3JldF0pOwotCQlyZXQgPSAtRU5PREVWOwotCQlnb3Rv
IGVycjsKKwkJcmV0dXJuIC1FTk9ERVY7CiAJfQogCiAJLyoKQEAgLTk5OSw3ICsxMDc1LDEwIEBA
IHN0YXRpYyBpbnQgdGNfbWFpbl9saW5rX2VuYWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAJICov
CiAKIAkvKiBDbGVhciBUcmFpbmluZyBQYXR0ZXJuLCBzZXQgQXV0b0NvcnJlY3QgTW9kZSA9IDEg
Ki8KLQl0Y193cml0ZShEUDBfU1JDQ1RSTCwgdGNfc3JjY3RybCh0YykgfCBEUDBfU1JDQ1RSTF9B
VVRPQ09SUkVDVCk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRjLT5yZWdtYXAsIERQMF9TUkNDVFJM
LCB0Y19zcmNjdHJsKHRjKSB8CisJCQkgICBEUDBfU1JDQ1RSTF9BVVRPQ09SUkVDVCk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKIAogCS8qIENsZWFyIERQQ0QgMHgxMDIgKi8KIAkvKiBOb3Rl
OiBDYW4gTm90IHVzZSBEUDBfU05LTFRDVFJMICgweDA2RTQpIHNob3J0IGN1dCAqLwpAQCAtMTA0
Myw3ICsxMTIyLDcgQEAgc3RhdGljIGludCB0Y19tYWluX2xpbmtfZW5hYmxlKHN0cnVjdCB0Y19k
YXRhICp0YykKIAkJZGV2X2VycihkZXYsICIweDAyMDUgU0lOS19TVEFUVVM6ICAgICAgICAgICAg
ICAgMHglMDJ4XG4iLCB0bXBbM10pOwogCQlkZXZfZXJyKGRldiwgIjB4MDIwNiBBREpVU1RfUkVR
VUVTVF9MQU5FMF8xOiAgICAweCUwMnhcbiIsIHRtcFs0XSk7CiAJCWRldl9lcnIoZGV2LCAiMHgw
MjA3IEFESlVTVF9SRVFVRVNUX0xBTkUyXzM6ICAgIDB4JTAyeFxuIiwgdG1wWzVdKTsKLQkJZ290
byBlcnI7CisJCXJldHVybiByZXQ7CiAJfQogCiAJcmV0dXJuIDA7CkBAIC0xMDUyLDcgKzExMzEs
NiBAQCBzdGF0aWMgaW50IHRjX21haW5fbGlua19lbmFibGUoc3RydWN0IHRjX2RhdGEgKnRjKQog
CXJldHVybiByZXQ7CiBlcnJfZHBjZF93cml0ZToKIAlkZXZfZXJyKHRjLT5kZXYsICJGYWlsZWQg
dG8gd3JpdGUgRFBDRDogJWRcbiIsIHJldCk7Ci1lcnI6CiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
MTA2MiwxMiArMTE0MCwxMSBAQCBzdGF0aWMgaW50IHRjX21haW5fbGlua19kaXNhYmxlKHN0cnVj
dCB0Y19kYXRhICp0YykKIAogCWRldl9kYmcodGMtPmRldiwgImxpbmsgZGlzYWJsZVxuIik7CiAK
LQl0Y193cml0ZShEUDBfU1JDQ1RSTCwgMCk7Ci0JdGNfd3JpdGUoRFAwQ1RMLCAwKTsKKwlyZXQg
PSByZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwX1NSQ0NUUkwsIDApOworCWlmIChyZXQpCisJ
CXJldHVybiByZXQ7CiAKLQlyZXR1cm4gMDsKLWVycjoKLQlyZXR1cm4gcmV0OworCXJldHVybiBy
ZWdtYXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwQ1RMLCAwKTsKIH0KIAogc3RhdGljIGludCB0Y19z
dHJlYW1fZW5hYmxlKHN0cnVjdCB0Y19kYXRhICp0YykKQEAgLTEwODIsNyArMTE1OSw3IEBAIHN0
YXRpYyBpbnQgdGNfc3RyZWFtX2VuYWJsZShzdHJ1Y3QgdGNfZGF0YSAqdGMpCiAJCXJldCA9IHRj
X3B4bF9wbGxfZW4odGMsIGNsa19nZXRfcmF0ZSh0Yy0+cmVmY2xrKSwKIAkJCQkgICAgMTAwMCAq
IHRjLT5tb2RlLmNsb2NrKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyOworCQkJcmV0dXJuIHJl
dDsKIAl9CiAKIAlyZXQgPSB0Y19zZXRfdmlkZW9fbW9kZSh0YywgJnRjLT5tb2RlKTsKQEAgLTEw
OTcsNyArMTE3NCw5IEBAIHN0YXRpYyBpbnQgdGNfc3RyZWFtX2VuYWJsZShzdHJ1Y3QgdGNfZGF0
YSAqdGMpCiAJdmFsdWUgPSBWSURfTU5fR0VOIHwgRFBfRU47CiAJaWYgKHRjLT5saW5rLmJhc2Uu
Y2FwYWJpbGl0aWVzICYgRFBfTElOS19DQVBfRU5IQU5DRURfRlJBTUlORykKIAkJdmFsdWUgfD0g
RUZfRU47Ci0JdGNfd3JpdGUoRFAwQ1RMLCB2YWx1ZSk7CisJcmV0ID0gcmVnbWFwX3dyaXRlKHRj
LT5yZWdtYXAsIERQMENUTCwgdmFsdWUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAJLyoK
IAkgKiBWSURfRU4gYXNzZXJ0aW9uIHNob3VsZCBiZSBkZWxheWVkIGJ5IGF0IGxlYXN0IE4gKiBM
U0NMSwogCSAqIGN5Y2xlcyBmcm9tIHRoZSB0aW1lIFZJRF9NTl9HRU4gaXMgZW5hYmxlZCBpbiBv
cmRlciB0bwpAQCAtMTEwNywzNiArMTE4NiwzNSBAQCBzdGF0aWMgaW50IHRjX3N0cmVhbV9lbmFi
bGUoc3RydWN0IHRjX2RhdGEgKnRjKQogCSAqLwogCXVzbGVlcF9yYW5nZSg1MDAsIDEwMDApOwog
CXZhbHVlIHw9IFZJRF9FTjsKLQl0Y193cml0ZShEUDBDVEwsIHZhbHVlKTsKKwlyZXQgPSByZWdt
YXBfd3JpdGUodGMtPnJlZ21hcCwgRFAwQ1RMLCB2YWx1ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJu
IHJldDsKIAkvKiBTZXQgaW5wdXQgaW50ZXJmYWNlICovCiAJdmFsdWUgPSBEUDBfQVVEU1JDX05P
X0lOUFVUOwogCWlmICh0Y190ZXN0X3BhdHRlcm4pCiAJCXZhbHVlIHw9IERQMF9WSURTUkNfQ09M
T1JfQkFSOwogCWVsc2UKIAkJdmFsdWUgfD0gRFAwX1ZJRFNSQ19EUElfUlg7Ci0JdGNfd3JpdGUo
U1lTQ1RSTCwgdmFsdWUpOworCXJldCA9IHJlZ21hcF93cml0ZSh0Yy0+cmVnbWFwLCBTWVNDVFJM
LCB2YWx1ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAogCXJldHVybiAwOwotZXJyOgot
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdGNfc3RyZWFtX2Rpc2FibGUoc3RydWN0IHRj
X2RhdGEgKnRjKQogewogCWludCByZXQ7Ci0JdTMyIHZhbDsKIAogCWRldl9kYmcodGMtPmRldiwg
ImRpc2FibGUgdmlkZW8gc3RyZWFtXG4iKTsKIAotCXRjX3JlYWQoRFAwQ1RMLCAmdmFsKTsKLQl2
YWwgJj0gflZJRF9FTjsKLQl0Y193cml0ZShEUDBDVEwsIHZhbCk7CisJcmV0ID0gcmVnbWFwX3Vw
ZGF0ZV9iaXRzKHRjLT5yZWdtYXAsIERQMENUTCwgVklEX0VOLCAwKTsKKwlpZiAocmV0KQorCQly
ZXR1cm4gcmV0OwogCiAJdGNfcHhsX3BsbF9kaXModGMpOwogCiAJcmV0dXJuIDA7Ci1lcnI6Ci0J
cmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHZvaWQgdGNfYnJpZGdlX3ByZV9lbmFibGUoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSkKQEAgLTEzMjgsNyArMTQwNiw5IEBAIHN0YXRpYyBlbnVtIGRy
bV9jb25uZWN0b3Jfc3RhdHVzIHRjX2Nvbm5lY3Rvcl9kZXRlY3Qoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lCiAJCQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c191bmtub3duOwogCX0KIAotCXRj
X3JlYWQoR1BJT0ksICZ2YWwpOworCXJldCA9IHJlZ21hcF9yZWFkKHRjLT5yZWdtYXAsIEdQSU9J
LCAmdmFsKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c191bmtub3duOwog
CiAJY29ubiA9IHZhbCAmIEJJVCh0Yy0+aHBkX3Bpbik7CiAKQEAgLTEzMzYsOSArMTQxNiw2IEBA
IHN0YXRpYyBlbnVtIGRybV9jb25uZWN0b3Jfc3RhdHVzIHRjX2Nvbm5lY3Rvcl9kZXRlY3Qoc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lCiAJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5l
Y3RlZDsKIAllbHNlCiAJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKLQot
ZXJyOgotCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX3Vua25vd247CiB9CiAKIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9mdW5jcyB0Y19jb25uZWN0b3JfZnVuY3MgPSB7Ci0tIAoy
LjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRy
aS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
