Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BAB89288454
	for <lists+dri-devel@lfdr.de>; Fri,  9 Oct 2020 10:00:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8BCF86EC86;
	Fri,  9 Oct 2020 08:00:13 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9D4D66ECAB
 for <dri-devel@lists.freedesktop.org>; Fri,  9 Oct 2020 08:00:05 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id m6so9257641wrn.0
 for <dri-devel@lists.freedesktop.org>; Fri, 09 Oct 2020 01:00:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=X4YPw4aMBEIEW3EKL3Rrjh8cYpxDDu/3udcPtwUh360=;
 b=bCCEbrj8HXwsYeCGdtRhueW/WP3h5AIUVs+0WKR5JezCZAxpSZJLP7pJbouSWNLwcP
 Siv24sIgXKCEbpQ5T7HWnt5hai8j4gqTeIle2FvkXGfHuEX2Ja+XvENt3NXUpNLV6z9i
 mhbDix/VH2lJsWJIvcVQl1Cf7Nhf3QI7cNCDw=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=X4YPw4aMBEIEW3EKL3Rrjh8cYpxDDu/3udcPtwUh360=;
 b=hWLVvLdIX5nLPAfZftjJevFfrhqTWCyDx2s00pU6eYItWmPST+ExmqvSNZZgLxKTil
 Cd/2gNr7PggVo+Kv6cGj+KlD9Y0YwkdJLNZhCDr/kZjZLpQBiF4HoG0uYhU0OUmXpIRt
 lq79saqH1OEAt/681EAhVHTGsUb0QYiOqGxESrS/4N+sZ18z46yA7ce8D1llqo2GiHK/
 hxmHZaDxj3gJgu/KjG25Tshk2juks0gGDtCavzP6FVvKPS1knmCCzp+T522RNdXi+mNV
 gjLm1WFTBwTNsiB6Jn+CRYAJsZ8TuDlC3MFc/2PJKaWjRy2fN3WDAhD4OdFzd42IEAfM
 smeQ==
X-Gm-Message-State: AOAM5300VZeRcmaVmb52/2fCAsbaTXGSHK68q7qIHsJCaWFxS5ALNG1O
 WNG8KiG8wPcgwb9ctMvNHPuwQ8UwoUeJVwU/
X-Google-Smtp-Source: ABdhPJwzQNY2KcIc5e/GuTH1z0+BpDCjhxbMoVaEX6dxiObPD8e9HbCzPtgw4CPmEpaFAJRAX6EU4g==
X-Received: by 2002:a5d:5449:: with SMTP id w9mr14288781wrv.182.1602230403743; 
 Fri, 09 Oct 2020 01:00:03 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id u17sm11634118wri.45.2020.10.09.01.00.02
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 09 Oct 2020 01:00:03 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH v2 08/17] s390/pci: Remove races against pte updates
Date: Fri,  9 Oct 2020 09:59:25 +0200
Message-Id: <20201009075934.3509076-9-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20201009075934.3509076-1-daniel.vetter@ffwll.ch>
References: <20201009075934.3509076-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-s390@vger.kernel.org, linux-samsung-soc@vger.kernel.org,
 Jan Kara <jack@suse.cz>, Kees Cook <keescook@chromium.org>,
 kvm@vger.kernel.org, Jason Gunthorpe <jgg@ziepe.ca>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Niklas Schnelle <schnelle@linux.ibm.com>,
 Andrew Morton <akpm@linux-foundation.org>, linux-mm@kvack.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 John Hubbard <jhubbard@nvidia.com>, Daniel Vetter <daniel.vetter@intel.com>,
 Gerald Schaefer <gerald.schaefer@linux.ibm.com>,
 Dan Williams <dan.j.williams@intel.com>, linux-arm-kernel@lists.infradead.org,
 linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2F5IGJhY2sgaXQgd2FzIGEgcmVhc29uYWJsZSBhc3N1bXB0aW9ucyB0aGF0IGlvbWVtIG1hcHBp
bmdzIG5ldmVyCmNoYW5nZSB0aGUgcGZuIHJhbmdlIHRoZXkgcG9pbnQgYXQuIEJ1dCB0aGlzIGhh
cyBjaGFuZ2VkOgoKLSBncHUgZHJpdmVycyBkeW5hbWljYWxseSBtYW5hZ2UgdGhlaXIgbWVtb3J5
IG5vd2FkYXlzLCBpbnZhbGlkYXRpbmcKcHRlcyB3aXRoIHVubWFwX21hcHBpbmdfcmFuZ2Ugd2hl
biBidWZmZXJzIGdldCBtb3ZlZAoKLSBjb250aWd1b3VzIGRtYSBhbGxvY2F0aW9ucyBoYXZlIG1v
dmVkIGZyb20gZGVkaWNhdGVkIGNhcnZldG91dHMgdG8KY21hIHJlZ2lvbnMuIFRoaXMgbWVhbnMg
aWYgd2UgbWlzcyB0aGUgdW5tYXAgdGhlIHBmbiBtaWdodCBjb250YWluCnBhZ2VjYWNoZSBvciBh
bm9uIG1lbW9yeSAod2VsbCBhbnl0aGluZyBhbGxvY2F0ZWQgd2l0aCBHRlBfTU9WRUFCTEUpCgot
IGV2ZW4gL2Rldi9tZW0gbm93IGludmFsaWRhdGVzIG1hcHBpbmdzIHdoZW4gdGhlIGtlcm5lbCBy
ZXF1ZXN0cyB0aGF0CmlvbWVtIHJlZ2lvbiB3aGVuIENPTkZJR19JT19TVFJJQ1RfREVWTUVNIGlz
IHNldCwgc2VlIDMyMzRhYzY2NGE4NwooIi9kZXYvbWVtOiBSZXZva2UgbWFwcGluZ3Mgd2hlbiBh
IGRyaXZlciBjbGFpbXMgdGhlIHJlZ2lvbiIpCgpBY2Nlc3NpbmcgcGZucyBvYnRhaW5lZCBmcm9t
IHB0ZXMgd2l0aG91dCBob2xkaW5nIGFsbCB0aGUgbG9ja3MgaXMKdGhlcmVmb3JlIG5vIGxvbmdl
ciBhIGdvb2QgaWRlYS4gRml4IHRoaXMuCgpTaW5jZSB6cGNpX21lbWNweV9mcm9tfHRvaW8gc2Vl
bXMgdG8gbm90IGRvIGFueXRoaW5nIG5lZmFyaW91cyB3aXRoCmxvY2tzIHdlIGp1c3QgbmVlZCB0
byBvcGVuIGNvZGUgZ2V0X3BmbiBhbmQgZm9sbG93X3BmbiBhbmQgbWFrZSBzdXJlCndlIGRyb3Ag
dGhlIGxvY2tzIG9ubHkgYWZ0ZXIgd2UndmUgZG9uZS4gVGhlIHdyaXRlIGZ1bmN0aW9uIGFsc28g
bmVlZHMKdGhlIGNvcHlfZnJvbV91c2VyIG1vdmUsIHNpbmNlIHdlIGNhbid0IHRha2UgdXNlcnNw
YWNlIGZhdWx0cyB3aGlsZQpob2xkaW5nIHRoZSBtbWFwIHNlbS4KClJldmlld2VkLWJ5OiBHZXJh
bGQgU2NoYWVmZXIgPGdlcmFsZC5zY2hhZWZlckBsaW51eC5pYm0uY29tPgoKU2lnbmVkLW9mZi1i
eTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+CkNjOiBKYXNvbiBHdW50
aG9ycGUgPGpnZ0B6aWVwZS5jYT4KQ2M6IERhbiBXaWxsaWFtcyA8ZGFuLmoud2lsbGlhbXNAaW50
ZWwuY29tPgpDYzogS2VlcyBDb29rIDxrZWVzY29va0BjaHJvbWl1bS5vcmc+CkNjOiBBbmRyZXcg
TW9ydG9uIDxha3BtQGxpbnV4LWZvdW5kYXRpb24ub3JnPgpDYzogSm9obiBIdWJiYXJkIDxqaHVi
YmFyZEBudmlkaWEuY29tPgpDYzogSsOpcsO0bWUgR2xpc3NlIDxqZ2xpc3NlQHJlZGhhdC5jb20+
CkNjOiBKYW4gS2FyYSA8amFja0BzdXNlLmN6PgpDYzogRGFuIFdpbGxpYW1zIDxkYW4uai53aWxs
aWFtc0BpbnRlbC5jb20+CkNjOiBsaW51eC1tbUBrdmFjay5vcmcKQ2M6IGxpbnV4LWFybS1rZXJu
ZWxAbGlzdHMuaW5mcmFkZWFkLm9yZwpDYzogbGludXgtc2Ftc3VuZy1zb2NAdmdlci5rZXJuZWwu
b3JnCkNjOiBsaW51eC1tZWRpYUB2Z2VyLmtlcm5lbC5vcmcKQ2M6IE5pa2xhcyBTY2huZWxsZSA8
c2NobmVsbGVAbGludXguaWJtLmNvbT4KQ2M6IEdlcmFsZCBTY2hhZWZlciA8Z2VyYWxkLnNjaGFl
ZmVyQGxpbnV4LmlibS5jb20+CkNjOiBsaW51eC1zMzkwQHZnZXIua2VybmVsLm9yZwotLQp2Mjog
TW92ZSBWTV9JTyB8IFZNX1BGTk1BUCBjaGVja3MgYXJvdW5kIHNvIHRoZXkga2VlcCByZXR1cm5p
bmcgRUlOVkFMCmxpa2UgYmVmb3JlIChHZXJhcmQpCi0tLQogYXJjaC9zMzkwL3BjaS9wY2lfbW1p
by5jIHwgOTggKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxl
IGNoYW5nZWQsIDU3IGluc2VydGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2FyY2gvczM5MC9wY2kvcGNpX21taW8uYyBiL2FyY2gvczM5MC9wY2kvcGNpX21taW8uYwppbmRl
eCA0MDFjZjY3MGEyNDMuLjFhNmFkYmM2OGVlOCAxMDA2NDQKLS0tIGEvYXJjaC9zMzkwL3BjaS9w
Y2lfbW1pby5jCisrKyBiL2FyY2gvczM5MC9wY2kvcGNpX21taW8uYwpAQCAtMTE5LDMzICsxMTks
MTUgQEAgc3RhdGljIGlubGluZSBpbnQgX19tZW1jcHlfdG9pb19pbnVzZXIodm9pZCBfX2lvbWVt
ICpkc3QsCiAJcmV0dXJuIHJjOwogfQogCi1zdGF0aWMgbG9uZyBnZXRfcGZuKHVuc2lnbmVkIGxv
bmcgdXNlcl9hZGRyLCB1bnNpZ25lZCBsb25nIGFjY2VzcywKLQkJICAgIHVuc2lnbmVkIGxvbmcg
KnBmbikKLXsKLQlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYTsKLQlsb25nIHJldDsKLQotCW1t
YXBfcmVhZF9sb2NrKGN1cnJlbnQtPm1tKTsKLQlyZXQgPSAtRUlOVkFMOwotCXZtYSA9IGZpbmRf
dm1hKGN1cnJlbnQtPm1tLCB1c2VyX2FkZHIpOwotCWlmICghdm1hKQotCQlnb3RvIG91dDsKLQly
ZXQgPSAtRUFDQ0VTOwotCWlmICghKHZtYS0+dm1fZmxhZ3MgJiBhY2Nlc3MpKQotCQlnb3RvIG91
dDsKLQlyZXQgPSBmb2xsb3dfcGZuKHZtYSwgdXNlcl9hZGRyLCBwZm4pOwotb3V0OgotCW1tYXBf
cmVhZF91bmxvY2soY3VycmVudC0+bW0pOwotCXJldHVybiByZXQ7Ci19Ci0KIFNZU0NBTExfREVG
SU5FMyhzMzkwX3BjaV9tbWlvX3dyaXRlLCB1bnNpZ25lZCBsb25nLCBtbWlvX2FkZHIsCiAJCWNv
bnN0IHZvaWQgX191c2VyICosIHVzZXJfYnVmZmVyLCBzaXplX3QsIGxlbmd0aCkKIHsKIAl1OCBs
b2NhbF9idWZbNjRdOwogCXZvaWQgX19pb21lbSAqaW9fYWRkcjsKIAl2b2lkICpidWY7Ci0JdW5z
aWduZWQgbG9uZyBwZm47CisJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWE7CisJcHRlX3QgKnB0
ZXA7CisJc3BpbmxvY2tfdCAqcHRsOwogCWxvbmcgcmV0OwogCiAJaWYgKCF6cGNpX2lzX2VuYWJs
ZWQoKSkKQEAgLTE1OCw3ICsxNDAsNyBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9wY2lfbW1pb193
cml0ZSwgdW5zaWduZWQgbG9uZywgbW1pb19hZGRyLAogCSAqIFdlIG9ubHkgc3VwcG9ydCB3cml0
ZSBhY2Nlc3MgdG8gTUlPIGNhcGFibGUgZGV2aWNlcyBpZiB3ZSBhcmUgb24KIAkgKiBhIE1JTyBl
bmFibGVkIHN5c3RlbS4gT3RoZXJ3aXNlIHdlIHdvdWxkIGhhdmUgdG8gY2hlY2sgZm9yIGV2ZXJ5
CiAJICogYWRkcmVzcyBpZiBpdCBpcyBhIHNwZWNpYWwgWlBDSV9BRERSIGFuZCB3b3VsZCBoYXZl
IHRvIGRvCi0JICogYSBnZXRfcGZuKCkgd2hpY2ggd2UgZG9uJ3QgbmVlZCBmb3IgTUlPIGNhcGFi
bGUgZGV2aWNlcy4gIEN1cnJlbnRseQorCSAqIGEgcGZuIGxvb2t1cCB3aGljaCB3ZSBkb24ndCBu
ZWVkIGZvciBNSU8gY2FwYWJsZSBkZXZpY2VzLiAgQ3VycmVudGx5CiAJICogSVNNIGRldmljZXMg
YXJlIHRoZSBvbmx5IGRldmljZXMgd2l0aG91dCBNSU8gc3VwcG9ydCBhbmQgdGhlcmUgaXMgbm8K
IAkgKiBrbm93biBuZWVkIGZvciBhY2Nlc3NpbmcgdGhlc2UgZnJvbSB1c2Vyc3BhY2UuCiAJICov
CkBAIC0xNzYsMjEgKzE1OCwzNyBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9wY2lfbW1pb193cml0
ZSwgdW5zaWduZWQgbG9uZywgbW1pb19hZGRyLAogCX0gZWxzZQogCQlidWYgPSBsb2NhbF9idWY7
CiAKLQlyZXQgPSBnZXRfcGZuKG1taW9fYWRkciwgVk1fV1JJVEUsICZwZm4pOworCXJldCA9IC1F
RkFVTFQ7CisJaWYgKGNvcHlfZnJvbV91c2VyKGJ1ZiwgdXNlcl9idWZmZXIsIGxlbmd0aCkpCisJ
CWdvdG8gb3V0X2ZyZWU7CisKKwltbWFwX3JlYWRfbG9jayhjdXJyZW50LT5tbSk7CisJcmV0ID0g
LUVJTlZBTDsKKwl2bWEgPSBmaW5kX3ZtYShjdXJyZW50LT5tbSwgbW1pb19hZGRyKTsKKwlpZiAo
IXZtYSkKKwkJZ290byBvdXRfdW5sb2NrX21tYXA7CisJaWYgKCEodm1hLT52bV9mbGFncyAmIChW
TV9JTyB8IFZNX1BGTk1BUCkpKQorCQlnb3RvIG91dF91bmxvY2tfbW1hcDsKKwlyZXQgPSAtRUFD
Q0VTOworCWlmICghKHZtYS0+dm1fZmxhZ3MgJiBWTV9XUklURSkpCisJCWdvdG8gb3V0X3VubG9j
a19tbWFwOworCisJcmV0ID0gZm9sbG93X3B0ZV9wbWQodm1hLT52bV9tbSwgbW1pb19hZGRyLCBO
VUxMLCAmcHRlcCwgTlVMTCwgJnB0bCk7CiAJaWYgKHJldCkKLQkJZ290byBvdXQ7Ci0JaW9fYWRk
ciA9ICh2b2lkIF9faW9tZW0gKikoKHBmbiA8PCBQQUdFX1NISUZUKSB8CisJCWdvdG8gb3V0X3Vu
bG9ja19tbWFwOworCisJaW9fYWRkciA9ICh2b2lkIF9faW9tZW0gKikoKHB0ZV9wZm4oKnB0ZXAp
IDw8IFBBR0VfU0hJRlQpIHwKIAkJCShtbWlvX2FkZHIgJiB+UEFHRV9NQVNLKSk7CiAKLQlyZXQg
PSAtRUZBVUxUOwogCWlmICgodW5zaWduZWQgbG9uZykgaW9fYWRkciA8IFpQQ0lfSU9NQVBfQURE
Ul9CQVNFKQotCQlnb3RvIG91dDsKLQotCWlmIChjb3B5X2Zyb21fdXNlcihidWYsIHVzZXJfYnVm
ZmVyLCBsZW5ndGgpKQotCQlnb3RvIG91dDsKKwkJZ290byBvdXRfdW5sb2NrX3B0OwogCiAJcmV0
ID0genBjaV9tZW1jcHlfdG9pbyhpb19hZGRyLCBidWYsIGxlbmd0aCk7Ci1vdXQ6CitvdXRfdW5s
b2NrX3B0OgorCXB0ZV91bm1hcF91bmxvY2socHRlcCwgcHRsKTsKK291dF91bmxvY2tfbW1hcDoK
KwltbWFwX3JlYWRfdW5sb2NrKGN1cnJlbnQtPm1tKTsKK291dF9mcmVlOgogCWlmIChidWYgIT0g
bG9jYWxfYnVmKQogCQlrZnJlZShidWYpOwogCXJldHVybiByZXQ7CkBAIC0yNzQsNyArMjcyLDkg
QEAgU1lTQ0FMTF9ERUZJTkUzKHMzOTBfcGNpX21taW9fcmVhZCwgdW5zaWduZWQgbG9uZywgbW1p
b19hZGRyLAogCXU4IGxvY2FsX2J1Zls2NF07CiAJdm9pZCBfX2lvbWVtICppb19hZGRyOwogCXZv
aWQgKmJ1ZjsKLQl1bnNpZ25lZCBsb25nIHBmbjsKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZt
YTsKKwlwdGVfdCAqcHRlcDsKKwlzcGlubG9ja190ICpwdGw7CiAJbG9uZyByZXQ7CiAKIAlpZiAo
IXpwY2lfaXNfZW5hYmxlZCgpKQpAQCAtMjg3LDcgKzI4Nyw3IEBAIFNZU0NBTExfREVGSU5FMyhz
MzkwX3BjaV9tbWlvX3JlYWQsIHVuc2lnbmVkIGxvbmcsIG1taW9fYWRkciwKIAkgKiBXZSBvbmx5
IHN1cHBvcnQgcmVhZCBhY2Nlc3MgdG8gTUlPIGNhcGFibGUgZGV2aWNlcyBpZiB3ZSBhcmUgb24K
IAkgKiBhIE1JTyBlbmFibGVkIHN5c3RlbS4gT3RoZXJ3aXNlIHdlIHdvdWxkIGhhdmUgdG8gY2hl
Y2sgZm9yIGV2ZXJ5CiAJICogYWRkcmVzcyBpZiBpdCBpcyBhIHNwZWNpYWwgWlBDSV9BRERSIGFu
ZCB3b3VsZCBoYXZlIHRvIGRvCi0JICogYSBnZXRfcGZuKCkgd2hpY2ggd2UgZG9uJ3QgbmVlZCBm
b3IgTUlPIGNhcGFibGUgZGV2aWNlcy4gIEN1cnJlbnRseQorCSAqIGEgcGZuIGxvb2t1cCB3aGlj
aCB3ZSBkb24ndCBuZWVkIGZvciBNSU8gY2FwYWJsZSBkZXZpY2VzLiAgQ3VycmVudGx5CiAJICog
SVNNIGRldmljZXMgYXJlIHRoZSBvbmx5IGRldmljZXMgd2l0aG91dCBNSU8gc3VwcG9ydCBhbmQg
dGhlcmUgaXMgbm8KIAkgKiBrbm93biBuZWVkIGZvciBhY2Nlc3NpbmcgdGhlc2UgZnJvbSB1c2Vy
c3BhY2UuCiAJICovCkBAIC0zMDYsMjIgKzMwNiwzOCBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9w
Y2lfbW1pb19yZWFkLCB1bnNpZ25lZCBsb25nLCBtbWlvX2FkZHIsCiAJCWJ1ZiA9IGxvY2FsX2J1
ZjsKIAl9CiAKLQlyZXQgPSBnZXRfcGZuKG1taW9fYWRkciwgVk1fUkVBRCwgJnBmbik7CisJbW1h
cF9yZWFkX2xvY2soY3VycmVudC0+bW0pOworCXJldCA9IC1FSU5WQUw7CisJdm1hID0gZmluZF92
bWEoY3VycmVudC0+bW0sIG1taW9fYWRkcik7CisJaWYgKCF2bWEpCisJCWdvdG8gb3V0X3VubG9j
a19tbWFwOworCWlmICghKHZtYS0+dm1fZmxhZ3MgJiAoVk1fSU8gfCBWTV9QRk5NQVApKSkKKwkJ
Z290byBvdXRfdW5sb2NrX21tYXA7CisJcmV0ID0gLUVBQ0NFUzsKKwlpZiAoISh2bWEtPnZtX2Zs
YWdzICYgVk1fV1JJVEUpKQorCQlnb3RvIG91dF91bmxvY2tfbW1hcDsKKworCXJldCA9IGZvbGxv
d19wdGVfcG1kKHZtYS0+dm1fbW0sIG1taW9fYWRkciwgTlVMTCwgJnB0ZXAsIE5VTEwsICZwdGwp
OwogCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCWlvX2FkZHIgPSAodm9pZCBfX2lvbWVtICopKChw
Zm4gPDwgUEFHRV9TSElGVCkgfCAobW1pb19hZGRyICYgflBBR0VfTUFTSykpOworCQlnb3RvIG91
dF91bmxvY2tfbW1hcDsKKworCWlvX2FkZHIgPSAodm9pZCBfX2lvbWVtICopKChwdGVfcGZuKCpw
dGVwKSA8PCBQQUdFX1NISUZUKSB8CisJCQkobW1pb19hZGRyICYgflBBR0VfTUFTSykpOwogCiAJ
aWYgKCh1bnNpZ25lZCBsb25nKSBpb19hZGRyIDwgWlBDSV9JT01BUF9BRERSX0JBU0UpIHsKIAkJ
cmV0ID0gLUVGQVVMVDsKLQkJZ290byBvdXQ7CisJCWdvdG8gb3V0X3VubG9ja19wdDsKIAl9CiAJ
cmV0ID0genBjaV9tZW1jcHlfZnJvbWlvKGJ1ZiwgaW9fYWRkciwgbGVuZ3RoKTsKLQlpZiAocmV0
KQotCQlnb3RvIG91dDsKLQlpZiAoY29weV90b191c2VyKHVzZXJfYnVmZmVyLCBidWYsIGxlbmd0
aCkpCisKK291dF91bmxvY2tfcHQ6CisJcHRlX3VubWFwX3VubG9jayhwdGVwLCBwdGwpOworb3V0
X3VubG9ja19tbWFwOgorCW1tYXBfcmVhZF91bmxvY2soY3VycmVudC0+bW0pOworCisJaWYgKCFy
ZXQgJiYgY29weV90b191c2VyKHVzZXJfYnVmZmVyLCBidWYsIGxlbmd0aCkpCiAJCXJldCA9IC1F
RkFVTFQ7CiAKLW91dDoKIAlpZiAoYnVmICE9IGxvY2FsX2J1ZikKIAkJa2ZyZWUoYnVmKTsKIAly
ZXR1cm4gcmV0OwotLSAKMi4yOC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWwK
