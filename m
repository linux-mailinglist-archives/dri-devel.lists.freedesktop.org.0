Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 35DDF615FF
	for <lists+dri-devel@lfdr.de>; Sun,  7 Jul 2019 20:35:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1613789BBE;
	Sun,  7 Jul 2019 18:35:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [IPv6:2001:4b98:dc2:55:216:3eff:fef7:d647])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5695789BBE
 for <dri-devel@lists.freedesktop.org>; Sun,  7 Jul 2019 18:35:30 +0000 (UTC)
Received: from pendragon.nordic-sky.finnair.com (unknown [38.98.37.142])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id A39BFCC;
 Sun,  7 Jul 2019 20:35:10 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 42/60] drm/omap: venc: Register a drm_bridge
Date: Sun,  7 Jul 2019 21:19:19 +0300
Message-Id: <20190707181937.6250-39-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
References: <20190707180852.5512-1-laurent.pinchart@ideasonboard.com>
 <20190707181937.6250-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1562524529;
 bh=Hgluwy1FZCmMUI79V3jUoH1KBL17i5+mxUkQPwbvit8=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=Surwd4sYUaNmo4DxTAGrrOBBBkywwHj/5urHuV3TpXMdlVc2s5Lpoiu89jGFDERxm
 1Kq1XXzD93l4pbr2JgfcA6BBERHqO4y5omLBqtHtQAUVhni6RanD0C0GRiEYpM4oAx
 6oWFr3eqmJjDSWJiJ37kjN8dA8hAQdqDOYBP9XHM=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Sebastian Reichel <sebastian.reichel@collabora.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW4gb3JkZXIgdG8gaW50ZWdyYXRlIHdpdGggYSBjaGFpbiBvZiBkcm1fYnJpZGdlLCB0aGUgaW50
ZXJuYWwgVkVOQwplbmNvZGVyIGhhcyB0byBleHBvc2UgdGhlIG1vZGUgdmFsaWQsIGZpeHVwIGFu
ZCBzZXQsIHRoZSBlbmFibGUgYW5kCmRpc2FibGUgYW5kIHRoZSBnZXQgbW9kZXMgb3BlcmF0aW9u
cyB0aHJvdWdoIHRoZSBkcm1fYnJpZGdlIEFQSS4KUmVnaXN0ZXIgYSBicmlkZ2UgYXQgaW5pdGlh
bGlzYXRpb24gdGltZSB0byBkbyBzby4KCk1vc3Qgb2YgdGhvc2Ugb3BlcmF0aW9ucyBhcmUgcmVt
b3ZlZCBmcm9tIHRoZSBvbWFwX2Rzc19kZXZpY2UgYXMgdGhleQphcmUgbm93IGNhbGxlZCB0aHJv
dWdoIHRoZSBkcm1fYnJpZGdlIEFQSSBieSB0aGUgRFJNIGF0b21pYyBoZWxwZXJzLiBUaGUKb25s
eSBleGNlcHRpb24gaXMgdGhlIC5nZXRfbW9kZXMoKSBvcGVyYXRpb24gdGhhdCBpcyBzdGlsbCBp
bnZva2VkCnRocm91Z2ggdGhlIG9tYXBfZHNzX2RldmljZS1iYXNlZCBwaXBlbGluZS4KCkZvciB0
aGUgdGltZSBiZWluZyBtYWtlIHRoZSBuZXh0IGJyaWRnZSBpbiB0aGUgY2hhaW4gb3B0aW9uYWwg
YXMgdGhlClZFTkMgb3V0cHV0IGlzIHN0aWxsIGJhc2VkIG9uIG9tYXBfZHNzX2RldmljZS4gVGhl
IGNyZWF0ZV9jb25uZWN0b3IKYXJndW1lbnQgdG8gdGhlIGJyaWRnZSBhdHRhY2ggZnVuY3Rpb24g
aXMgYWxzbyBpZ25vcmVkIGZvciB0aGUgc2FtZQpyZWFzb24uIFRoaXMgd2lsbCBiZSBjaGFuZ2Vk
IGxhdGVyIHdoZW4gcmVtb3ZpbmcgdGhlIHJlbGF0ZWQKb21hcGRybS1zcGVjaWZpYyBkaXNwbGF5
IGRyaXZlcnMuCgpTaWduZWQtb2ZmLWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50LnBpbmNo
YXJ0QGlkZWFzb25ib2FyZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL3Zl
bmMuYyB8IDI0NCArKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQs
IDE2MCBpbnNlcnRpb25zKCspLCA4NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vb21hcGRybS9kc3MvdmVuYy5jIGIvZHJpdmVycy9ncHUvZHJtL29tYXBkcm0vZHNz
L3ZlbmMuYwppbmRleCAwYTgxZGQ1YzkzZDYuLmQ5ZjgyMDhlMGVlOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL29tYXBkcm0vZHNzL3ZlbmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vb21h
cGRybS9kc3MvdmVuYy5jCkBAIC0zNyw2ICszNyw4IEBACiAjaW5jbHVkZSA8bGludXgvY29tcG9u
ZW50Lmg+CiAjaW5jbHVkZSA8bGludXgvc3lzX3NvYy5oPgogCisjaW5jbHVkZSA8ZHJtL2RybV9i
cmlkZ2UuaD4KKwogI2luY2x1ZGUgIm9tYXBkc3MuaCIKICNpbmNsdWRlICJkc3MuaCIKIApAQCAt
MzE0LDkgKzMxNiwxMSBAQCBzdHJ1Y3QgdmVuY19kZXZpY2UgewogCWJvb2wgcmVxdWlyZXNfdHZf
ZGFjX2NsazsKIAogCXN0cnVjdCBvbWFwX2Rzc19kZXZpY2Ugb3V0cHV0OworCXN0cnVjdCBkcm1f
YnJpZGdlIGJyaWRnZTsKIH07CiAKICNkZWZpbmUgZHNzZGV2X3RvX3ZlbmMoZHNzZGV2KSBjb250
YWluZXJfb2YoZHNzZGV2LCBzdHJ1Y3QgdmVuY19kZXZpY2UsIG91dHB1dCkKKyNkZWZpbmUgZHJt
X2JyaWRnZV90b192ZW5jKGIpIGNvbnRhaW5lcl9vZihiLCBzdHJ1Y3QgdmVuY19kZXZpY2UsIGJy
aWRnZSkKIAogc3RhdGljIGlubGluZSB2b2lkIHZlbmNfd3JpdGVfcmVnKHN0cnVjdCB2ZW5jX2Rl
dmljZSAqdmVuYywgaW50IGlkeCwgdTMyIHZhbCkKIHsKQEAgLTQ4OCwzMiArNDkyLDYgQEAgc3Rh
dGljIHZvaWQgdmVuY19wb3dlcl9vZmYoc3RydWN0IHZlbmNfZGV2aWNlICp2ZW5jKQogCXZlbmNf
cnVudGltZV9wdXQodmVuYyk7CiB9CiAKLXN0YXRpYyB2b2lkIHZlbmNfZGlzcGxheV9lbmFibGUo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2KQotewotCXN0cnVjdCB2ZW5jX2RldmljZSAq
dmVuYyA9IGRzc2Rldl90b192ZW5jKGRzc2Rldik7Ci0KLQlEU1NEQkcoInZlbmNfZGlzcGxheV9l
bmFibGVcbiIpOwotCi0JbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2NrKTsKLQotCXZlbmNfcG93
ZXJfb24odmVuYyk7Ci0KLQltdXRleF91bmxvY2soJnZlbmMtPnZlbmNfbG9jayk7Ci19Ci0KLXN0
YXRpYyB2b2lkIHZlbmNfZGlzcGxheV9kaXNhYmxlKHN0cnVjdCBvbWFwX2Rzc19kZXZpY2UgKmRz
c2RldikKLXsKLQlzdHJ1Y3QgdmVuY19kZXZpY2UgKnZlbmMgPSBkc3NkZXZfdG9fdmVuYyhkc3Nk
ZXYpOwotCi0JRFNTREJHKCJ2ZW5jX2Rpc3BsYXlfZGlzYWJsZVxuIik7Ci0KLQltdXRleF9sb2Nr
KCZ2ZW5jLT52ZW5jX2xvY2spOwotCi0JdmVuY19wb3dlcl9vZmYodmVuYyk7Ci0KLQltdXRleF91
bmxvY2soJnZlbmMtPnZlbmNfbG9jayk7Ci19Ci0KIHN0YXRpYyBpbnQgdmVuY19nZXRfbW9kZXMo
c3RydWN0IG9tYXBfZHNzX2RldmljZSAqZHNzZGV2LAogCQkJICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQogewpAQCAtNTU2LDU3ICs1MzQsNiBAQCBzdGF0aWMgZW51bSB2ZW5jX3Zp
ZGVvbW9kZSB2ZW5jX2dldF92aWRlb21vZGUoY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZAogCXJldHVybiBWRU5DX01PREVfVU5LTk9XTjsKIH0KIAotc3RhdGljIHZvaWQgdmVuY19z
ZXRfdGltaW5ncyhzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCi0JCQkgICAgIGNvbnN0
IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlKQotewotCXN0cnVjdCB2ZW5jX2RldmljZSAq
dmVuYyA9IGRzc2Rldl90b192ZW5jKGRzc2Rldik7Ci0JZW51bSB2ZW5jX3ZpZGVvbW9kZSB2ZW5j
X21vZGUgPSB2ZW5jX2dldF92aWRlb21vZGUobW9kZSk7Ci0KLQlEU1NEQkcoInZlbmNfc2V0X3Rp
bWluZ3NcbiIpOwotCi0JbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2NrKTsKLQotCXN3aXRjaCAo
dmVuY19tb2RlKSB7Ci0JZGVmYXVsdDoKLQkJV0FSTl9PTl9PTkNFKDEpOwotCQkvKiBGYWxsLXRo
cm91Z2ggKi8KLQljYXNlIFZFTkNfTU9ERV9QQUw6Ci0JCXZlbmMtPmNvbmZpZyA9ICZ2ZW5jX2Nv
bmZpZ19wYWxfdHJtOwotCQlicmVhazsKLQotCWNhc2UgVkVOQ19NT0RFX05UU0M6Ci0JCXZlbmMt
PmNvbmZpZyA9ICZ2ZW5jX2NvbmZpZ19udHNjX3RybTsKLQkJYnJlYWs7Ci0JfQotCi0JZGlzcGNf
c2V0X3R2X3BjbGsodmVuYy0+ZHNzLT5kaXNwYywgMTM1MDAwMDApOwotCi0JbXV0ZXhfdW5sb2Nr
KCZ2ZW5jLT52ZW5jX2xvY2spOwotfQotCi1zdGF0aWMgaW50IHZlbmNfY2hlY2tfdGltaW5ncyhz
dHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpkc3NkZXYsCi0JCQkgICAgICBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZSkKLXsKLQlEU1NEQkcoInZlbmNfY2hlY2tfdGltaW5nc1xuIik7Ci0KLQlz
d2l0Y2ggKHZlbmNfZ2V0X3ZpZGVvbW9kZShtb2RlKSkgewotCWNhc2UgVkVOQ19NT0RFX1BBTDoK
LQkJZHJtX21vZGVfY29weShtb2RlLCAmb21hcF9kc3NfcGFsX21vZGUpOwotCQlicmVhazsKLQot
CWNhc2UgVkVOQ19NT0RFX05UU0M6Ci0JCWRybV9tb2RlX2NvcHkobW9kZSwgJm9tYXBfZHNzX250
c2NfbW9kZSk7Ci0JCWJyZWFrOwotCi0JZGVmYXVsdDoKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQot
Ci0JZHJtX21vZGVfc2V0X2NydGNpbmZvKG1vZGUsIENSVENfSU5URVJMQUNFX0hBTFZFX1YpOwot
CWRybV9tb2RlX3NldF9uYW1lKG1vZGUpOwotCXJldHVybiAwOwotfQotCiBzdGF0aWMgaW50IHZl
bmNfZHVtcF9yZWdzKHN0cnVjdCBzZXFfZmlsZSAqcywgdm9pZCAqcCkKIHsKIAlzdHJ1Y3QgdmVu
Y19kZXZpY2UgKnZlbmMgPSBzLT5wcml2YXRlOwpAQCAtNzAwLDE1ICs2MjcsMTYwIEBAIHN0YXRp
YyBjb25zdCBzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlX29wcyB2ZW5jX29wcyA9IHsKIAkuY29ubmVj
dCA9IHZlbmNfY29ubmVjdCwKIAkuZGlzY29ubmVjdCA9IHZlbmNfZGlzY29ubmVjdCwKIAotCS5l
bmFibGUgPSB2ZW5jX2Rpc3BsYXlfZW5hYmxlLAotCS5kaXNhYmxlID0gdmVuY19kaXNwbGF5X2Rp
c2FibGUsCi0KLQkuY2hlY2tfdGltaW5ncyA9IHZlbmNfY2hlY2tfdGltaW5ncywKLQkuc2V0X3Rp
bWluZ3MgPSB2ZW5jX3NldF90aW1pbmdzLAotCiAJLmdldF9tb2RlcyA9IHZlbmNfZ2V0X21vZGVz
LAogfTsKIAorLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIERSTSBCcmlkZ2UgT3BlcmF0aW9u
cworICovCisKK3N0YXRpYyBpbnQgdmVuY19icmlkZ2VfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2UsIGJvb2wgY3JlYXRlX2Nvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgdmVuY19kZXZpY2Ug
KnZlbmMgPSBkcm1fYnJpZGdlX3RvX3ZlbmMoYnJpZGdlKTsKKworCWlmICh2ZW5jLT5vdXRwdXQu
bmV4dF9icmlkZ2UpCisJCXJldHVybiAwOworCisJcmV0dXJuIGRybV9icmlkZ2VfYXR0YWNoKGJy
aWRnZS0+ZW5jb2RlciwgdmVuYy0+b3V0cHV0Lm5leHRfYnJpZGdlLAorCQkJCSBicmlkZ2UsIGZh
bHNlKTsKK30KKworc3RhdGljIGVudW0gZHJtX21vZGVfc3RhdHVzCit2ZW5jX2JyaWRnZV9tb2Rl
X3ZhbGlkKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCSAgICAgICBjb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKK3sKKwlzd2l0Y2ggKHZlbmNfZ2V0X3ZpZGVvbW9kZSht
b2RlKSkgeworCWNhc2UgVkVOQ19NT0RFX1BBTDoKKwljYXNlIFZFTkNfTU9ERV9OVFNDOgorCQly
ZXR1cm4gTU9ERV9PSzsKKworCWRlZmF1bHQ6CisJCXJldHVybiBNT0RFX0JBRDsKKwl9Cit9CisK
K3N0YXRpYyBib29sIHZlbmNfYnJpZGdlX21vZGVfZml4dXAoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSwKKwkJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKKwkJCQkg
ICBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSkKK3sKKwljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqdmVuY19tb2RlOworCisJc3dpdGNoICh2ZW5jX2dldF92aWRl
b21vZGUoYWRqdXN0ZWRfbW9kZSkpIHsKKwljYXNlIFZFTkNfTU9ERV9QQUw6CisJCXZlbmNfbW9k
ZSA9ICZvbWFwX2Rzc19wYWxfbW9kZTsKKwkJYnJlYWs7CisKKwljYXNlIFZFTkNfTU9ERV9OVFND
OgorCQl2ZW5jX21vZGUgPSAmb21hcF9kc3NfbnRzY19tb2RlOworCQlicmVhazsKKworCWRlZmF1
bHQ6CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlkcm1fbW9kZV9jb3B5KGFkanVzdGVkX21vZGUs
IHZlbmNfbW9kZSk7CisJZHJtX21vZGVfc2V0X2NydGNpbmZvKGFkanVzdGVkX21vZGUsIENSVENf
SU5URVJMQUNFX0hBTFZFX1YpOworCWRybV9tb2RlX3NldF9uYW1lKGFkanVzdGVkX21vZGUpOwor
CisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRpYyB2b2lkIHZlbmNfYnJpZGdlX21vZGVfc2V0KHN0
cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICptb2RlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSkKK3sKKwlzdHJ1Y3QgdmVuY19kZXZpY2UgKnZlbmMgPSBkcm1fYnJpZGdlX3RvX3ZlbmMo
YnJpZGdlKTsKKwllbnVtIHZlbmNfdmlkZW9tb2RlIHZlbmNfbW9kZSA9IHZlbmNfZ2V0X3ZpZGVv
bW9kZShhZGp1c3RlZF9tb2RlKTsKKworCW11dGV4X2xvY2soJnZlbmMtPnZlbmNfbG9jayk7CisK
Kwlzd2l0Y2ggKHZlbmNfbW9kZSkgeworCWRlZmF1bHQ6CisJCVdBUk5fT05fT05DRSgxKTsKKwkJ
LyogRmFsbC10aHJvdWdoICovCisJY2FzZSBWRU5DX01PREVfUEFMOgorCQl2ZW5jLT5jb25maWcg
PSAmdmVuY19jb25maWdfcGFsX3RybTsKKwkJYnJlYWs7CisKKwljYXNlIFZFTkNfTU9ERV9OVFND
OgorCQl2ZW5jLT5jb25maWcgPSAmdmVuY19jb25maWdfbnRzY190cm07CisJCWJyZWFrOworCX0K
KworCWRpc3BjX3NldF90dl9wY2xrKHZlbmMtPmRzcy0+ZGlzcGMsIDEzNTAwMDAwKTsKKworCW11
dGV4X3VubG9jaygmdmVuYy0+dmVuY19sb2NrKTsKK30KKworc3RhdGljIHZvaWQgdmVuY19icmlk
Z2VfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkgICAgICAgc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYyA9IGRy
bV9icmlkZ2VfdG9fdmVuYyhicmlkZ2UpOworCisJbXV0ZXhfbG9jaygmdmVuYy0+dmVuY19sb2Nr
KTsKKwl2ZW5jX3Bvd2VyX29uKHZlbmMpOworCW11dGV4X3VubG9jaygmdmVuYy0+dmVuY19sb2Nr
KTsKK30KKworc3RhdGljIHZvaWQgdmVuY19icmlkZ2VfZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRn
ZSAqYnJpZGdlLAorCQkJCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1
Y3QgdmVuY19kZXZpY2UgKnZlbmMgPSBkcm1fYnJpZGdlX3RvX3ZlbmMoYnJpZGdlKTsKKworCW11
dGV4X2xvY2soJnZlbmMtPnZlbmNfbG9jayk7CisJdmVuY19wb3dlcl9vZmYodmVuYyk7CisJbXV0
ZXhfdW5sb2NrKCZ2ZW5jLT52ZW5jX2xvY2spOworfQorCitzdGF0aWMgaW50IHZlbmNfYnJpZGdl
X2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSBzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqbW9kZXNbXSA9IHsKKwkJJm9tYXBfZHNzX3BhbF9tb2RlLAorCQkmb21hcF9kc3NfbnRz
Y19tb2RlLAorCX07CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShtb2Rlcyk7ICsraSkgeworCQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKKwor
CQltb2RlID0gZHJtX21vZGVfZHVwbGljYXRlKGNvbm5lY3Rvci0+ZGV2LCBtb2Rlc1tpXSk7CisJ
CWlmICghbW9kZSkKKwkJCXJldHVybiBpOworCisJCW1vZGUtPnR5cGUgPSBEUk1fTU9ERV9UWVBF
X0RSSVZFUiB8IERSTV9NT0RFX1RZUEVfUFJFRkVSUkVEOworCQlkcm1fbW9kZV9zZXRfbmFtZSht
b2RlKTsKKwkJZHJtX21vZGVfcHJvYmVkX2FkZChjb25uZWN0b3IsIG1vZGUpOworCX0KKworCXJl
dHVybiBBUlJBWV9TSVpFKG1vZGVzKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fYnJp
ZGdlX2Z1bmNzIHZlbmNfYnJpZGdlX2Z1bmNzID0geworCS5hdHRhY2ggPSB2ZW5jX2JyaWRnZV9h
dHRhY2gsCisJLm1vZGVfdmFsaWQgPSB2ZW5jX2JyaWRnZV9tb2RlX3ZhbGlkLAorCS5tb2RlX2Zp
eHVwID0gdmVuY19icmlkZ2VfbW9kZV9maXh1cCwKKwkubW9kZV9zZXQgPSB2ZW5jX2JyaWRnZV9t
b2RlX3NldCwKKwkuYXRvbWljX2VuYWJsZSA9IHZlbmNfYnJpZGdlX2VuYWJsZSwKKwkuYXRvbWlj
X2Rpc2FibGUgPSB2ZW5jX2JyaWRnZV9kaXNhYmxlLAorCS5nZXRfbW9kZXMgPSB2ZW5jX2JyaWRn
ZV9nZXRfbW9kZXMsCit9OworCitzdGF0aWMgdm9pZCB2ZW5jX2JyaWRnZV9pbml0KHN0cnVjdCB2
ZW5jX2RldmljZSAqdmVuYykKK3sKKwl2ZW5jLT5icmlkZ2UuZnVuY3MgPSAmdmVuY19icmlkZ2Vf
ZnVuY3M7CisJdmVuYy0+YnJpZGdlLm9mX25vZGUgPSB2ZW5jLT5wZGV2LT5kZXYub2Zfbm9kZTsK
Kwl2ZW5jLT5icmlkZ2Uub3BzID0gRFJNX0JSSURHRV9PUF9NT0RFUzsKKwl2ZW5jLT5icmlkZ2Uu
dHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9TVklERU87CisKKwlkcm1fYnJpZGdlX2FkZCgmdmVu
Yy0+YnJpZGdlKTsKK30KKworc3RhdGljIHZvaWQgdmVuY19icmlkZ2VfY2xlYW51cChzdHJ1Y3Qg
dmVuY19kZXZpY2UgKnZlbmMpCit7CisJZHJtX2JyaWRnZV9yZW1vdmUoJnZlbmMtPmJyaWRnZSk7
Cit9CisKIC8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgKiBDb21wb25lbnQgQmluZCAmIFVuYmlu
ZAogICovCkBAIC03NTgsNiArODMwLDggQEAgc3RhdGljIGludCB2ZW5jX2luaXRfb3V0cHV0KHN0
cnVjdCB2ZW5jX2RldmljZSAqdmVuYykKIAlzdHJ1Y3Qgb21hcF9kc3NfZGV2aWNlICpvdXQgPSAm
dmVuYy0+b3V0cHV0OwogCWludCByOwogCisJdmVuY19icmlkZ2VfaW5pdCh2ZW5jKTsKKwogCW91
dC0+ZGV2ID0gJnZlbmMtPnBkZXYtPmRldjsKIAlvdXQtPmlkID0gT01BUF9EU1NfT1VUUFVUX1ZF
TkM7CiAJb3V0LT50eXBlID0gT01BUF9ESVNQTEFZX1RZUEVfVkVOQzsKQEAgLTc2OCw3ICs4NDIs
NyBAQCBzdGF0aWMgaW50IHZlbmNfaW5pdF9vdXRwdXQoc3RydWN0IHZlbmNfZGV2aWNlICp2ZW5j
KQogCW91dC0+b2ZfcG9ydCA9IDA7CiAJb3V0LT5vcHNfZmxhZ3MgPSBPTUFQX0RTU19ERVZJQ0Vf
T1BfTU9ERVM7CiAKLQlyID0gb21hcGRzc19kZXZpY2VfaW5pdF9vdXRwdXQob3V0LCBOVUxMKTsK
KwlyID0gb21hcGRzc19kZXZpY2VfaW5pdF9vdXRwdXQob3V0LCAmdmVuYy0+YnJpZGdlKTsKIAlp
ZiAociA8IDApCiAJCXJldHVybiByOwogCkBAIC03ODEsNiArODU1LDggQEAgc3RhdGljIHZvaWQg
dmVuY191bmluaXRfb3V0cHV0KHN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYykKIHsKIAlvbWFwZHNz
X2RldmljZV91bnJlZ2lzdGVyKCZ2ZW5jLT5vdXRwdXQpOwogCW9tYXBkc3NfZGV2aWNlX2NsZWFu
dXBfb3V0cHV0KCZ2ZW5jLT5vdXRwdXQpOworCisJdmVuY19icmlkZ2VfY2xlYW51cCh2ZW5jKTsK
IH0KIAogc3RhdGljIGludCB2ZW5jX3Byb2JlX29mKHN0cnVjdCB2ZW5jX2RldmljZSAqdmVuYykK
LS0gClJlZ2FyZHMsCgpMYXVyZW50IFBpbmNoYXJ0CgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9kcmktZGV2ZWw=
