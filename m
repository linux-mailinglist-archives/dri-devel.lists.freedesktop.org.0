Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E8B86DEA9B
	for <lists+dri-devel@lfdr.de>; Mon, 21 Oct 2019 13:15:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A4666890B3;
	Mon, 21 Oct 2019 11:15:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wm1-x343.google.com (mail-wm1-x343.google.com
 [IPv6:2a00:1450:4864:20::343])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2DEF18907B;
 Mon, 21 Oct 2019 11:15:31 +0000 (UTC)
Received: by mail-wm1-x343.google.com with SMTP id 3so12354170wmi.3;
 Mon, 21 Oct 2019 04:15:31 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=ieftc5OZzoBpkKERgd4ypTIz03QnzZwqaxbRIvJjQOA=;
 b=LBSoZw/Z+eOC4tqAA/0ykoftt+ADRLejI1zzPZdp0P2H6QNMRp/sSD0cHZGY2LWc8A
 TVW2YmEg6ayEvFCMdQAB5IVAsgZVb+pBU8ZuMekvvBYwb4bAo0DDz3lGdyN3481oBPcC
 rGHA8V9zd0RVrTfeeKUk54vjAPi02fpG57yZQtpNHJgtoonmEAik/0FORk3f4M1YFDHV
 3CSNEwwbqefNthMi8PoDklozTNUbnMOW5B771KtCpIdAQcs1h+CmvrlgVky8zmRkn1yP
 qg7Tw7T17/qjryxm3mqCL0c3NtSCmOHumVLE7eVORP346NeAhV7J/ed2hYv/DQtWzqfB
 qH8w==
X-Gm-Message-State: APjAAAUs8mOjv9SdPshODzHYCLDmoiV308kPrfYuHmui/Lv1e/GDYSID
 2ivyXA5Q/P7bOIxnVmXWyrQFLBgU
X-Google-Smtp-Source: APXvYqwSWSdNGiq0uG1tH9MYN8Xd9D4kczQWQOq6ynTQEEslg2xeNf2B/6PXeTI1H7YpyAsvyyT+NA==
X-Received: by 2002:a1c:5409:: with SMTP id i9mr19173338wmb.120.1571656529411; 
 Mon, 21 Oct 2019 04:15:29 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c194:dd41:4bef:70cc])
 by smtp.gmail.com with ESMTPSA id l9sm13152415wme.45.2019.10.21.04.15.28
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 21 Oct 2019 04:15:28 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, sumit.semwal@linaro.org,
 linaro-mm-sig@lists.linaro.org, linux-media@vger.kernel.org,
 intel-gfx@lists.freedesktop.org, daniel@ffwll.ch
Subject: [PATCH 3/4] drm/amdgpu: add independent DMA-buf export v7
Date: Mon, 21 Oct 2019 13:15:23 +0200
Message-Id: <20191021111524.14793-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191021111524.14793-1-christian.koenig@amd.com>
References: <20191021111524.14793-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=ieftc5OZzoBpkKERgd4ypTIz03QnzZwqaxbRIvJjQOA=;
 b=Ae5csJtRLnGC7zwpq6aSDSObm8rh7TuAvDu9qb1IAYy9vtmg1Apu8P4Qk9iN0EYgAV
 dcugcJqSOm1lt6s62FFze5yp+eQJDh/rp53bV/qQU6hd/3N06k4hu/HrxbPUjxif1Ppc
 pQ+WBttoBnU+orm/Mat2Btrwh1FNmfZHIS23DyAjnjhCmaZbh/wrleBViEvuNOL7rgFF
 kPPgmoX95jknfyziotOSK7wmfVuhjO87wjhFWjHX34WR44iovYpDgF1hAz3VeNInmxWR
 3W8lmKtsdK4n7CXximDf8FLIKbXlygygS5Fz6c+ftWlDml8g/u6zkiQAqJ2oj5kVwiuf
 b++A==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

QWRkIGFuIERNQS1idWYgZXhwb3J0IGltcGxlbWVudGF0aW9uIGluZGVwZW5kZW50IG9mIHRoZSBE
Uk0gaGVscGVycy4KClRoaXMgbm90IG9ubHkgYXZvaWRzIHRoZSBjYWNoaW5nIG9mIERNQS1idWYg
bWFwcGluZ3MsIGJ1dCBhbHNvCmFsbG93cyB1cyB0byB1c2UgdGhlIG5ldyBkeW5hbWljIGxvY2tp
bmcgYXBwcm9hY2guCgpUaGlzIGlzIGFsc28gYSBwcmVyZXF1aXNpdGUgb2YgdW5waW5uZWQgRE1B
LWJ1ZiBoYW5kbGluZy4KCnYyOiBmaXggdW5pbnRlbmRlZCByZWN1cnNpb24sIHJlbW92ZSBkZWJ1
Z2dpbmcgbGVmdG92ZXJzCnYzOiBzcGxpdCBvdXQgZnJvbSB1bnBpbm5lZCBETUEtYnVmIHdvcmsK
djQ6IHJlYmFzZSBvbiB0b3Agb2YgbmV3IG5vX3NndF9jYWNoZSBmbGFnCnY1OiBmaXggc29tZSB3
YXJuaW5ncyBieSBpbmNsdWRpbmcgYW1kZ3B1X2RtYV9idWYuaAp2NjogZml4IGxvY2tpbmcgZm9y
IG5vbiBhbWRncHUgZXhwb3J0cwp2NzogcmViYXNlZCBvbiBuZXcgRE1BLWJ1ZiBsb2NraW5nIHBh
dGNoCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFt
ZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyB8
IDE3MiArKysrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X2RtYV9idWYuaCB8ICAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZHJ2LmMgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmpl
Y3QuYyAgfCAgIDEgKwogNCBmaWxlcyBjaGFuZ2VkLCA5NyBpbnNlcnRpb25zKCspLCA3OCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZG1hX2J1Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYwpp
bmRleCA2MWYxMDhlYzJiNWMuLmYxNGI1MmNjNzIwNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCkBAIC0zNCwyNiArMzQsMTEgQEAKICNpbmNsdWRlICJh
bWRncHUuaCIKICNpbmNsdWRlICJhbWRncHVfZGlzcGxheS5oIgogI2luY2x1ZGUgImFtZGdwdV9n
ZW0uaCIKKyNpbmNsdWRlICJhbWRncHVfZG1hX2J1Zi5oIgogI2luY2x1ZGUgPGRybS9hbWRncHVf
ZHJtLmg+CiAjaW5jbHVkZSA8bGludXgvZG1hLWJ1Zi5oPgogI2luY2x1ZGUgPGxpbnV4L2RtYS1m
ZW5jZS1hcnJheS5oPgogCi0vKioKLSAqIGFtZGdwdV9nZW1fcHJpbWVfZ2V0X3NnX3RhYmxlIC0g
JmRybV9kcml2ZXIuZ2VtX3ByaW1lX2dldF9zZ190YWJsZQotICogaW1wbGVtZW50YXRpb24KLSAq
IEBvYmo6IEdFTSBidWZmZXIgb2JqZWN0IChCTykKLSAqCi0gKiBSZXR1cm5zOgotICogQSBzY2F0
dGVyL2dhdGhlciB0YWJsZSBmb3IgdGhlIHBpbm5lZCBwYWdlcyBvZiB0aGUgQk8ncyBtZW1vcnku
Ci0gKi8KLXN0cnVjdCBzZ190YWJsZSAqYW1kZ3B1X2dlbV9wcmltZV9nZXRfc2dfdGFibGUoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBnZW1f
dG9fYW1kZ3B1X2JvKG9iaik7Ci0JaW50IG5wYWdlcyA9IGJvLT50Ym8ubnVtX3BhZ2VzOwotCi0J
cmV0dXJuIGRybV9wcmltZV9wYWdlc190b19zZyhiby0+dGJvLnR0bS0+cGFnZXMsIG5wYWdlcyk7
Ci19Ci0KIC8qKgogICogYW1kZ3B1X2dlbV9wcmltZV92bWFwIC0gJmRtYV9idWZfb3BzLnZtYXAg
aW1wbGVtZW50YXRpb24KICAqIEBvYmo6IEdFTSBCTwpAQCAtMTc5LDkyICsxNjQsMTI2IEBAIF9f
ZG1hX3Jlc3ZfbWFrZV9leGNsdXNpdmUoc3RydWN0IGRtYV9yZXN2ICpvYmopCiB9CiAKIC8qKgot
ICogYW1kZ3B1X2RtYV9idWZfbWFwX2F0dGFjaCAtICZkbWFfYnVmX29wcy5hdHRhY2ggaW1wbGVt
ZW50YXRpb24KLSAqIEBkbWFfYnVmOiBTaGFyZWQgRE1BIGJ1ZmZlcgorICogYW1kZ3B1X2RtYV9i
dWZfYXR0YWNoIC0gJmRtYV9idWZfb3BzLmF0dGFjaCBpbXBsZW1lbnRhdGlvbgorICoKKyAqIEBk
bWFidWY6IERNQS1idWYgd2hlcmUgd2UgYXR0YWNoIHRvCisgKiBAYXR0YWNoOiBhdHRhY2htZW50
IHRvIGFkZAorICoKKyAqIEFkZCB0aGUgYXR0YWNobWVudCBhcyB1c2VyIHRvIHRoZSBleHBvcnRl
ZCBETUEtYnVmLgorICovCitzdGF0aWMgaW50IGFtZGdwdV9kbWFfYnVmX2F0dGFjaChzdHJ1Y3Qg
ZG1hX2J1ZiAqZG1hYnVmLAorCQkJCSBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gp
Cit7CisJc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmogPSBkbWFidWYtPnByaXY7CisJc3RydWN0
IGFtZGdwdV9ibyAqYm8gPSBnZW1fdG9fYW1kZ3B1X2JvKG9iaik7CisJc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYgPSBhbWRncHVfdHRtX2FkZXYoYm8tPnRiby5iZGV2KTsKKwlpbnQgcjsKKwor
CWlmIChhdHRhY2gtPmRldi0+ZHJpdmVyID09IGFkZXYtPmRldi0+ZHJpdmVyKQorCQlyZXR1cm4g
MDsKKworCXIgPSBhbWRncHVfYm9fcmVzZXJ2ZShibywgZmFsc2UpOworCWlmICh1bmxpa2VseShy
ICE9IDApKQorCQlyZXR1cm4gcjsKKworCS8qCisJICogV2Ugb25seSBjcmVhdGUgc2hhcmVkIGZl
bmNlcyBmb3IgaW50ZXJuYWwgdXNlLCBidXQgaW1wb3J0ZXJzCisJICogb2YgdGhlIGRtYWJ1ZiBy
ZWx5IG9uIGV4Y2x1c2l2ZSBmZW5jZXMgZm9yIGltcGxpY2l0bHkKKwkgKiB0cmFja2luZyB3cml0
ZSBoYXphcmRzLiBBcyBhbnkgb2YgdGhlIGN1cnJlbnQgZmVuY2VzIG1heQorCSAqIGNvcnJlc3Bv
bmQgdG8gYSB3cml0ZSwgd2UgbmVlZCB0byBjb252ZXJ0IGFsbCBleGlzdGluZworCSAqIGZlbmNl
cyBvbiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0IGludG8gYSBzaW5nbGUgZXhjbHVzaXZlCisJICog
ZmVuY2UuCisJICovCisJciA9IF9fZG1hX3Jlc3ZfbWFrZV9leGNsdXNpdmUoYm8tPnRiby5iYXNl
LnJlc3YpOworCWlmIChyKQorCQlyZXR1cm4gcjsKKworCWJvLT5wcmltZV9zaGFyZWRfY291bnQr
KzsKKwlhbWRncHVfYm9fdW5yZXNlcnZlKGJvKTsKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBh
bWRncHVfZG1hX2J1Zl9kZXRhY2ggLSAmZG1hX2J1Zl9vcHMuZGV0YWNoIGltcGxlbWVudGF0aW9u
CisgKgorICogQGRtYWJ1ZjogRE1BLWJ1ZiB3aGVyZSB3ZSByZW1vdmUgdGhlIGF0dGFjaG1lbnQg
ZnJvbQorICogQGF0dGFjaDogdGhlIGF0dGFjaG1lbnQgdG8gcmVtb3ZlCisgKgorICogQ2FsbGVk
IHdoZW4gYW4gYXR0YWNobWVudCBpcyByZW1vdmVkIGZyb20gdGhlIERNQS1idWYuCisgKi8KK3N0
YXRpYyB2b2lkIGFtZGdwdV9kbWFfYnVmX2RldGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAor
CQkJCSAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQoreworCXN0cnVjdCBkcm1f
Z2VtX29iamVjdCAqb2JqID0gZG1hYnVmLT5wcml2OworCXN0cnVjdCBhbWRncHVfYm8gKmJvID0g
Z2VtX3RvX2FtZGdwdV9ibyhvYmopOworCXN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2ID0gYW1k
Z3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7CisKKwlpZiAoYXR0YWNoLT5kZXYtPmRyaXZlciAh
PSBhZGV2LT5kZXYtPmRyaXZlciAmJiBiby0+cHJpbWVfc2hhcmVkX2NvdW50KQorCQliby0+cHJp
bWVfc2hhcmVkX2NvdW50LS07Cit9CisKKy8qKgorICogYW1kZ3B1X2RtYV9idWZfbWFwIC0gJmRt
YV9idWZfb3BzLm1hcF9kbWFfYnVmIGltcGxlbWVudGF0aW9uCiAgKiBAYXR0YWNoOiBETUEtYnVm
IGF0dGFjaG1lbnQKKyAqIEBkaXI6IERNQSBkaXJlY3Rpb24KICAqCiAgKiBNYWtlcyBzdXJlIHRo
YXQgdGhlIHNoYXJlZCBETUEgYnVmZmVyIGNhbiBiZSBhY2Nlc3NlZCBieSB0aGUgdGFyZ2V0IGRl
dmljZS4KICAqIEZvciBub3csIHNpbXBseSBwaW5zIGl0IHRvIHRoZSBHVFQgZG9tYWluLCB3aGVy
ZSBpdCBzaG91bGQgYmUgYWNjZXNzaWJsZSBieQogICogYWxsIERNQSBkZXZpY2VzLgogICoKICAq
IFJldHVybnM6Ci0gKiAwIG9uIHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZh
aWx1cmUuCisgKiBzZ190YWJsZSBmaWxsZWQgd2l0aCB0aGUgRE1BIGFkZHJlc3NlcyB0byB1c2Ug
b3IgRVJSX1BSVCB3aXRoIG5lZ2F0aXZlIGVycm9yCisgKiBjb2RlLgogICovCi1zdGF0aWMgaW50
IGFtZGdwdV9kbWFfYnVmX21hcF9hdHRhY2goc3RydWN0IGRtYV9idWYgKmRtYV9idWYsCi0JCQkJ
ICAgICBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2gpCitzdGF0aWMgc3RydWN0IHNn
X3RhYmxlICphbWRncHVfZG1hX2J1Zl9tYXAoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0
YWNoLAorCQkJCQkgICBlbnVtIGRtYV9kYXRhX2RpcmVjdGlvbiBkaXIpCiB7CisJc3RydWN0IGRt
YV9idWYgKmRtYV9idWYgPSBhdHRhY2gtPmRtYWJ1ZjsKIAlzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
Km9iaiA9IGRtYV9idWYtPnByaXY7CiAJc3RydWN0IGFtZGdwdV9ibyAqYm8gPSBnZW1fdG9fYW1k
Z3B1X2JvKG9iaik7Ci0Jc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRncHVfdHRtX2Fk
ZXYoYm8tPnRiby5iZGV2KTsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnNndDsKIAlsb25nIHI7CiAKLQly
ID0gZHJtX2dlbV9tYXBfYXR0YWNoKGRtYV9idWYsIGF0dGFjaCk7Ci0JaWYgKHIpCi0JCXJldHVy
biByOwotCi0JciA9IGFtZGdwdV9ib19yZXNlcnZlKGJvLCBmYWxzZSk7Ci0JaWYgKHVubGlrZWx5
KHIgIT0gMCkpCi0JCWdvdG8gZXJyb3JfZGV0YWNoOwotCi0KLQlpZiAoYXR0YWNoLT5kZXYtPmRy
aXZlciAhPSBhZGV2LT5kZXYtPmRyaXZlcikgewotCQkvKgotCQkgKiBXZSBvbmx5IGNyZWF0ZSBz
aGFyZWQgZmVuY2VzIGZvciBpbnRlcm5hbCB1c2UsIGJ1dCBpbXBvcnRlcnMKLQkJICogb2YgdGhl
IGRtYWJ1ZiByZWx5IG9uIGV4Y2x1c2l2ZSBmZW5jZXMgZm9yIGltcGxpY2l0bHkKLQkJICogdHJh
Y2tpbmcgd3JpdGUgaGF6YXJkcy4gQXMgYW55IG9mIHRoZSBjdXJyZW50IGZlbmNlcyBtYXkKLQkJ
ICogY29ycmVzcG9uZCB0byBhIHdyaXRlLCB3ZSBuZWVkIHRvIGNvbnZlcnQgYWxsIGV4aXN0aW5n
Ci0JCSAqIGZlbmNlcyBvbiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0IGludG8gYSBzaW5nbGUgZXhj
bHVzaXZlCi0JCSAqIGZlbmNlLgotCQkgKi8KLQkJciA9IF9fZG1hX3Jlc3ZfbWFrZV9leGNsdXNp
dmUoYm8tPnRiby5iYXNlLnJlc3YpOwotCQlpZiAocikKLQkJCWdvdG8gZXJyb3JfdW5yZXNlcnZl
OwotCX0KLQotCS8qIHBpbiBidWZmZXIgaW50byBHVFQgKi8KIAlyID0gYW1kZ3B1X2JvX3Bpbihi
bywgQU1ER1BVX0dFTV9ET01BSU5fR1RUKTsKIAlpZiAocikKLQkJZ290byBlcnJvcl91bnJlc2Vy
dmU7CisJCXJldHVybiBFUlJfUFRSKHIpOwogCi0JaWYgKGF0dGFjaC0+ZGV2LT5kcml2ZXIgIT0g
YWRldi0+ZGV2LT5kcml2ZXIpCi0JCWJvLT5wcmltZV9zaGFyZWRfY291bnQrKzsKKwlzZ3QgPSBk
cm1fcHJpbWVfcGFnZXNfdG9fc2coYm8tPnRiby50dG0tPnBhZ2VzLCBiby0+dGJvLm51bV9wYWdl
cyk7CisJaWYgKElTX0VSUihzZ3QpKQorCQlyZXR1cm4gc2d0OwogCi1lcnJvcl91bnJlc2VydmU6
Ci0JYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7CisJaWYgKCFkbWFfbWFwX3NnX2F0dHJzKGF0dGFj
aC0+ZGV2LCBzZ3QtPnNnbCwgc2d0LT5uZW50cywgZGlyLAorCQkJICAgICAgRE1BX0FUVFJfU0tJ
UF9DUFVfU1lOQykpCisJCWdvdG8gZXJyb3JfZnJlZTsKIAotZXJyb3JfZGV0YWNoOgotCWlmIChy
KQotCQlkcm1fZ2VtX21hcF9kZXRhY2goZG1hX2J1ZiwgYXR0YWNoKTsKLQlyZXR1cm4gcjsKKwly
ZXR1cm4gc2d0OworCitlcnJvcl9mcmVlOgorCXNnX2ZyZWVfdGFibGUoc2d0KTsKKwlrZnJlZShz
Z3QpOworCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogfQogCiAvKioKLSAqIGFtZGdwdV9kbWFf
YnVmX21hcF9kZXRhY2ggLSAmZG1hX2J1Zl9vcHMuZGV0YWNoIGltcGxlbWVudGF0aW9uCi0gKiBA
ZG1hX2J1ZjogU2hhcmVkIERNQSBidWZmZXIKKyAqIGFtZGdwdV9kbWFfYnVmX3VubWFwIC0gJmRt
YV9idWZfb3BzLnVubWFwX2RtYV9idWYgaW1wbGVtZW50YXRpb24KICAqIEBhdHRhY2g6IERNQS1i
dWYgYXR0YWNobWVudAorICogQHNndDogc2dfdGFibGUgdG8gdW5tYXAKKyAqIEBkaXI6IERNQSBk
aXJlY3Rpb24KICAqCiAgKiBUaGlzIGlzIGNhbGxlZCB3aGVuIGEgc2hhcmVkIERNQSBidWZmZXIg
bm8gbG9uZ2VyIG5lZWRzIHRvIGJlIGFjY2Vzc2libGUgYnkKICAqIGFub3RoZXIgZGV2aWNlLiBG
b3Igbm93LCBzaW1wbHkgdW5waW5zIHRoZSBidWZmZXIgZnJvbSBHVFQuCiAgKi8KLXN0YXRpYyB2
b2lkIGFtZGdwdV9kbWFfYnVmX21hcF9kZXRhY2goc3RydWN0IGRtYV9idWYgKmRtYV9idWYsCi0J
CQkJICAgICAgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoKQorc3RhdGljIHZvaWQg
YW1kZ3B1X2RtYV9idWZfdW5tYXAoc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLAor
CQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnNndCwKKwkJCQkgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24g
ZGlyKQogewotCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqID0gZG1hX2J1Zi0+cHJpdjsKKwlz
dHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiA9IGF0dGFjaC0+ZG1hYnVmLT5wcml2OwogCXN0cnVj
dCBhbWRncHVfYm8gKmJvID0gZ2VtX3RvX2FtZGdwdV9ibyhvYmopOwotCXN0cnVjdCBhbWRncHVf
ZGV2aWNlICphZGV2ID0gYW1kZ3B1X3R0bV9hZGV2KGJvLT50Ym8uYmRldik7Ci0JaW50IHJldCA9
IDA7Ci0KLQlyZXQgPSBhbWRncHVfYm9fcmVzZXJ2ZShibywgdHJ1ZSk7Ci0JaWYgKHVubGlrZWx5
KHJldCAhPSAwKSkKLQkJZ290byBlcnJvcjsKIAorCWRtYV91bm1hcF9zZyhhdHRhY2gtPmRldiwg
c2d0LT5zZ2wsIHNndC0+bmVudHMsIGRpcik7CisJc2dfZnJlZV90YWJsZShzZ3QpOworCWtmcmVl
KHNndCk7CiAJYW1kZ3B1X2JvX3VucGluKGJvKTsKLQlpZiAoYXR0YWNoLT5kZXYtPmRyaXZlciAh
PSBhZGV2LT5kZXYtPmRyaXZlciAmJiBiby0+cHJpbWVfc2hhcmVkX2NvdW50KQotCQliby0+cHJp
bWVfc2hhcmVkX2NvdW50LS07Ci0JYW1kZ3B1X2JvX3VucmVzZXJ2ZShibyk7Ci0KLWVycm9yOgot
CWRybV9nZW1fbWFwX2RldGFjaChkbWFfYnVmLCBhdHRhY2gpOwogfQogCiAvKioKQEAgLTMwOCwx
MCArMzI3LDExIEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2RtYV9idWZfYmVnaW5fY3B1X2FjY2Vzcyhz
dHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiwKIH0KIAogY29uc3Qgc3RydWN0IGRtYV9idWZfb3BzIGFt
ZGdwdV9kbWFidWZfb3BzID0gewotCS5hdHRhY2ggPSBhbWRncHVfZG1hX2J1Zl9tYXBfYXR0YWNo
LAotCS5kZXRhY2ggPSBhbWRncHVfZG1hX2J1Zl9tYXBfZGV0YWNoLAotCS5tYXBfZG1hX2J1ZiA9
IGRybV9nZW1fbWFwX2RtYV9idWYsCi0JLnVubWFwX2RtYV9idWYgPSBkcm1fZ2VtX3VubWFwX2Rt
YV9idWYsCisJLmR5bmFtaWNfbWFwcGluZyA9IHRydWUsCisJLmF0dGFjaCA9IGFtZGdwdV9kbWFf
YnVmX2F0dGFjaCwKKwkuZGV0YWNoID0gYW1kZ3B1X2RtYV9idWZfZGV0YWNoLAorCS5tYXBfZG1h
X2J1ZiA9IGFtZGdwdV9kbWFfYnVmX21hcCwKKwkudW5tYXBfZG1hX2J1ZiA9IGFtZGdwdV9kbWFf
YnVmX3VubWFwLAogCS5yZWxlYXNlID0gZHJtX2dlbV9kbWFidWZfcmVsZWFzZSwKIAkuYmVnaW5f
Y3B1X2FjY2VzcyA9IGFtZGdwdV9kbWFfYnVmX2JlZ2luX2NwdV9hY2Nlc3MsCiAJLm1tYXAgPSBk
cm1fZ2VtX2RtYWJ1Zl9tbWFwLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2RtYV9idWYuaCBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9k
bWFfYnVmLmgKaW5kZXggNTAxMmU2YWI1OGYxLi5jZTFiM2YwMTc0NTEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuaApAQCAtMjUsNyArMjUsNiBAQAogCiAj
aW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KIAotc3RydWN0IHNnX3RhYmxlICphbWRncHVfZ2VtX3By
aW1lX2dldF9zZ190YWJsZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiBzdHJ1Y3QgZHJt
X2dlbV9vYmplY3QgKgogYW1kZ3B1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAkJCQkgc3RydWN0IGRtYV9idWZfYXR0YWNobWVudCAqYXR0YWNoLApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jIGIvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCmluZGV4IDNmYWUxMDA3MTQzZS4u
YmY1YmYxNWIxMmUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2Rydi5jCkBA
IC0xNDA5LDcgKzE0MDksNiBAQCBzdGF0aWMgc3RydWN0IGRybV9kcml2ZXIga21zX2RyaXZlciA9
IHsKIAkucHJpbWVfZmRfdG9faGFuZGxlID0gZHJtX2dlbV9wcmltZV9mZF90b19oYW5kbGUsCiAJ
LmdlbV9wcmltZV9leHBvcnQgPSBhbWRncHVfZ2VtX3ByaW1lX2V4cG9ydCwKIAkuZ2VtX3ByaW1l
X2ltcG9ydCA9IGFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0LAotCS5nZW1fcHJpbWVfZ2V0X3NnX3Rh
YmxlID0gYW1kZ3B1X2dlbV9wcmltZV9nZXRfc2dfdGFibGUsCiAJLmdlbV9wcmltZV9pbXBvcnRf
c2dfdGFibGUgPSBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZSwKIAkuZ2VtX3ByaW1l
X3ZtYXAgPSBhbWRncHVfZ2VtX3ByaW1lX3ZtYXAsCiAJLmdlbV9wcmltZV92dW5tYXAgPSBhbWRn
cHVfZ2VtX3ByaW1lX3Z1bm1hcCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9v
YmplY3QuYwppbmRleCA2ZjBiNzg5YTBiNDkuLmIzMTkyNTQ1MzdiOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtMzEsNiArMzEsNyBAQAogICovCiAj
aW5jbHVkZSA8bGludXgvbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRl
IDxsaW51eC9kbWEtYnVmLmg+CiAKICNpbmNsdWRlIDxkcm0vYW1kZ3B1X2RybS5oPgogI2luY2x1
ZGUgPGRybS9kcm1fY2FjaGUuaD4KLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
