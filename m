Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8CBC014AF2D
	for <lists+dri-devel@lfdr.de>; Tue, 28 Jan 2020 06:50:16 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3D92F6EC92;
	Tue, 28 Jan 2020 05:50:10 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yw1-xc43.google.com (mail-yw1-xc43.google.com
 [IPv6:2607:f8b0:4864:20::c43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B84EA6EC91;
 Tue, 28 Jan 2020 05:50:08 +0000 (UTC)
Received: by mail-yw1-xc43.google.com with SMTP id u139so5986636ywf.13;
 Mon, 27 Jan 2020 21:50:08 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc:content-transfer-encoding;
 bh=ZvYep82MJkgR/i/If++BTCiUiNwD0GUfJeeD8qY75mM=;
 b=eTqf3Ahi6XCc+q1aVW7ahuf5+3dVL6jEh5IK1Yonfr2qIEXLynPC7WMhGVV2Moulql
 dFAqiH9lGHOB/m0bUfaoSdmjs05nQmfEcm4ojfMOLIW5sMdVm4CzXptvMYLatfS6B26v
 GGz7mMdrNBJ5QZGDR4XjxO6aiqvdbiKnB30pdpV9+Rv5UewaIZgrStBkCKjk4yKKf0bM
 ZFwOv3huHJ6RgzGwYrSE4a72IuQJ9gMgm5fwRAtF/PYHAe2VQ7UDKXA11VYABBrfnqUb
 e+0wNA/jJ2kazyUeae1b8t+nCRc1Yc63WIDFtxpfpycm9aey7xyDz9+hcfyX/c/0BB00
 iqEA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc:content-transfer-encoding;
 bh=ZvYep82MJkgR/i/If++BTCiUiNwD0GUfJeeD8qY75mM=;
 b=mo+W810Pkn4Eh3MP6QrIv8jTVKObV4q38zv3nH47dz6cobm41tehxigy4HHF+GvQ/r
 pMhQssf2gAcActJ+ktNkHafRCLzjc0+53X7eZ7q7yEQW0I+n9LN+D2AFB7Kyltw9tsPP
 MJ9nyv4wAmgcJu3nGcojv8OZ2SP8Y4cTOj3AOr3BnedCEPGRoKuc61CpQ/RZ4ZxHu6y3
 +6laHUvzENgGgXpTvc0YWSHyd/VDFl7EcbdLHQgF1aAYStLmYIB2QIXLo3JRPq4cO2u2
 0f9wugGE4zBcLvS3h7I+ljoRvPTPIM2BJtCMV9KjY8BgSzqhvu/Bi5ASCHq8yNkIMz8N
 BJ/A==
X-Gm-Message-State: APjAAAXMMYuzPSk0gX2H1M3DLIOVDobNXphgrmWtoKYMN+2CoATitf+h
 dkUWlWbVi7pHpS80CMBYfDktxaXPzlmfZXCTBPM=
X-Google-Smtp-Source: APXvYqxf3MGZzjZFfI/orZ60uWWMfSuG1kWj6mWa6bawXrxWbT/tCQTN+2U+K23VIzXw+c0OKq2av0TeK3aT4B1KVg4=
X-Received: by 2002:a0d:e6cc:: with SMTP id
 p195mr14341075ywe.413.1580190607241; 
 Mon, 27 Jan 2020 21:50:07 -0800 (PST)
MIME-Version: 1.0
References: <20200124143042.93733-1-christian.koenig@amd.com>
 <20200124143042.93733-2-christian.koenig@amd.com>
In-Reply-To: <20200124143042.93733-2-christian.koenig@amd.com>
From: Ben Skeggs <skeggsb@gmail.com>
Date: Tue, 28 Jan 2020 15:49:56 +1000
Message-ID: <CACAvsv4OmB2DhMeK4omcTENK0VhjWe4Z=JRtHrphHehbGR72gA@mail.gmail.com>
Subject: Re: [Nouveau] [PATCH 1/2] drm/nouveau: move io_reserve_lru handling
 into the driver v2
To: =?UTF-8?Q?Christian_K=C3=B6nig?= <ckoenig.leichtzumerken@gmail.com>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Dave Airlie <airlied@linux.ie>, ML nouveau <nouveau@lists.freedesktop.org>,
 ML dri-devel <dri-devel@lists.freedesktop.org>,
 Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gU2F0LCAyNSBKYW4gMjAyMCBhdCAwMDozMCwgQ2hyaXN0aWFuIEvDtm5pZwo8Y2tvZW5pZy5s
ZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+IHdyb3RlOgo+Cj4gRnJvbTogQ2hyaXN0aWFuIEvDtm5p
ZyA8Y2tvZW5pZy5sZWljaHR6dW1lcmtlbkBnbWFpbC5jb20+Cj4KPiBXaGlsZSB3b3JraW5nIG9u
IFRUTSBjbGVhbnVwcyBJJ3ZlIGZvdW5kIHRoYXQgdGhlIGlvX3Jlc2VydmVfbHJ1IHVzZWQgYnkK
PiBOb3V2ZWF1IGlzIGFjdHVhbGx5IG5vdCB3b3JraW5nIGF0IGFsbC4KPgo+IEluIGdlbmVyYWwg
d2Ugc2hvdWxkIHJlbW92ZSBkcml2ZXIgc3BlY2lmaWMgaGFuZGxpbmcgZnJvbSB0aGUgbWVtb3J5
Cj4gbWFuYWdlbWVudCwgc28gdGhpcyBwYXRjaCBtb3ZlcyB0aGUgaW9fcmVzZXJ2ZV9scnUgaGFu
ZGxpbmcgaW50byBOb3V2ZWF1Cj4gaW5zdGVhZC4KPgo+IFRoZSBwYXRjaCBzaG91bGQgYmUgZnVu
Y3Rpb25hbCBjb3JyZWN0LCBidXQgaXMgb25seSBjb21waWxlIHRlc3RlZCEKTkFDSyBvbiB0aGlz
IGFzIGl0IGN1cnJlbnRseSBzdGFuZHMuICBJdCBub3Qgb25seSBjYXVzZXMgaW52YWxpZCBpbwph
Y2Nlc3NlcyBzb21laG93IG9uIG1vZHVsZSBsb2FkLCBidXQgd2hpbGUgYXR0ZW1wdGluZyB0byB0
cmFjayBkb3duCndoeSwgSSByZWFsaXNlZCB0aGVyZSdzIGEgbW9yZSBzZXZlcmUgaXNzdWUuICBU
aGlzIHJlbW92ZXMgdGhlCmRpc3RpbmN0aW9uIGJldHdlZW4ga21hcCgpIGFuZCBtYXBwaW5nIGlu
dG8gdXNlcnNwYWNlLCB0aGUgZm9ybWVyIG9mCndoaWNoIHNob3VsZCBub3QgYmUgcGxhY2VkIG9u
dG8gdGhlIExSVSBhcyBhbiBldmljdGlvbiBjYW5kaWRhdGUuCgpXZSAqZG8qIHJlcXVpcmUgdGhl
IExSVSwgc28gaXQncyBub3Qgc29tZXRoaW5nIHRoYXQgY2FuIGp1c3QgYmUKZHJvcHBlZCBjb21w
bGV0ZWx5LiAgVGhlcmUncyBhIHVzZXIgcmVwb3J0IHdoZXJlIHRoZXkncmUgZ2V0dGluZyBhClNJ
R0JVUyBkdWUgdG8gdGhlIGJ1ZyB5b3Ugbm90aWNlZCBjYXVzaW5nIGl0IHRvIG5vdCB3b3JrIHJp
Z2h0IG5vdy4KCkJlbi4KCj4KPiB2MjogZG9uJ3QgY2FsbCB0dG1fYm9fdW5tYXBfdmlydHVhbCBp
biBub3V2ZWF1X3R0bV9pb19tZW1fcmVzZXJ2ZQo+Cj4gU2lnbmVkLW9mZi1ieTogQ2hyaXN0aWFu
IEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgo+IEFja2VkLWJ5OiBEYW5pZWwgVmV0
dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgo+IC0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2JvLmMgIHwgMTA3ICsrKysrKysrKysrKysrKysrKysrLS0tLS0tCj4gIGRy
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uaCAgfCAgIDMgKwo+ICBkcml2ZXJzL2dw
dS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oIHwgICAyICsKPiAgZHJpdmVycy9ncHUvZHJtL25v
dXZlYXUvbm91dmVhdV90dG0uYyB8ICA0MyArKysrKysrKysrLQo+ICA0IGZpbGVzIGNoYW5nZWQs
IDEzMSBpbnNlcnRpb25zKCspLCAyNCBkZWxldGlvbnMoLSkKPgo+IGRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVh
dS9ub3V2ZWF1X2JvLmMKPiBpbmRleCA4MTY2ODEwNDU5NWYuLmFjZWUwNTRmNzdlZCAxMDA2NDQK
PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKPiArKysgYi9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKPiBAQCAtMTM3LDYgKzEzNyw3IEBAIG5v
dXZlYXVfYm9fZGVsX3R0bShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQo+ICAgICAgICAg
c3RydWN0IG5vdXZlYXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPgo+ICAgICAgICAgV0FS
Tl9PTihudmJvLT5waW5fcmVmY250ID4gMCk7Cj4gKyAgICAgICBub3V2ZWF1X2JvX2RlbF9pb19y
ZXNlcnZlX2xydShibyk7Cj4gICAgICAgICBudjEwX2JvX3B1dF90aWxlX3JlZ2lvbihkZXYsIG52
Ym8tPnRpbGUsIE5VTEwpOwo+Cj4gICAgICAgICAvKgo+IEBAIC0zMDQsNiArMzA1LDcgQEAgbm91
dmVhdV9ib19pbml0KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1NjQgc2l6ZSwgaW50IGFsaWdu
LCB1MzIgZmxhZ3MsCj4KPiAgICAgICAgIG52Ym8tPmJvLm1lbS5udW1fcGFnZXMgPSBzaXplID4+
IFBBR0VfU0hJRlQ7Cj4gICAgICAgICBub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywgZmxh
Z3MsIDApOwo+ICsgICAgICAgSU5JVF9MSVNUX0hFQUQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsK
Pgo+ICAgICAgICAgcmV0ID0gdHRtX2JvX2luaXQobnZiby0+Ym8uYmRldiwgJm52Ym8tPmJvLCBz
aXplLCB0eXBlLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgJm52Ym8tPnBsYWNlbWVudCwg
YWxpZ24gPj4gUEFHRV9TSElGVCwgZmFsc2UsCj4gQEAgLTU3NCw2ICs1NzYsMjYgQEAgbm91dmVh
dV9ib19zeW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8pCj4gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBR0VfU0laRSwgRE1BX0ZST01fREVWSUNFKTsK
PiAgfQo+Cj4gK3ZvaWQgbm91dmVhdV9ib19hZGRfaW9fcmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibykKPiArewo+ICsgICAgICAgc3RydWN0IG5vdXZlYXVfZHJtICpkcm0g
PSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYpOwo+ICsgICAgICAgc3RydWN0IG5vdXZlYXVfYm8gKm52
Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiArCj4gKyAgICAgICBtdXRleF9sb2NrKCZkcm0tPnR0bS5p
b19yZXNlcnZlX211dGV4KTsKPiArICAgICAgIGxpc3RfbW92ZV90YWlsKCZudmJvLT5pb19yZXNl
cnZlX2xydSwgJmRybS0+dHRtLmlvX3Jlc2VydmVfbHJ1KTsKPiArICAgICAgIG11dGV4X3VubG9j
aygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gK30KPiArCj4gK3ZvaWQgbm91dmVhdV9i
b19kZWxfaW9fcmVzZXJ2ZV9scnUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKPiArewo+
ICsgICAgICAgc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYoYm8tPmJkZXYp
Owo+ICsgICAgICAgc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8gPSBub3V2ZWF1X2JvKGJvKTsKPiAr
Cj4gKyAgICAgICBtdXRleF9sb2NrKCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiArICAg
ICAgIGxpc3RfZGVsX2luaXQoJm52Ym8tPmlvX3Jlc2VydmVfbHJ1KTsKPiArICAgICAgIG11dGV4
X3VubG9jaygmZHJtLT50dG0uaW9fcmVzZXJ2ZV9tdXRleCk7Cj4gK30KPiArCj4gIGludAo+ICBu
b3V2ZWF1X2JvX3ZhbGlkYXRlKHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCBib29sIGludGVycnVw
dGlibGUsCj4gICAgICAgICAgICAgICAgICAgICBib29sIG5vX3dhaXRfZ3B1KQo+IEBAIC02NzUs
OCArNjk3LDYgQEAgbm91dmVhdV9ib19pbml0X21lbV90eXBlKHN0cnVjdCB0dG1fYm9fZGV2aWNl
ICpiZGV2LCB1aW50MzJfdCB0eXBlLAo+ICAgICAgICAgICAgICAgICAgICAgICAgIH0KPgo+ICAg
ICAgICAgICAgICAgICAgICAgICAgIG1hbi0+ZnVuYyA9ICZub3V2ZWF1X3ZyYW1fbWFuYWdlcjsK
PiAtICAgICAgICAgICAgICAgICAgICAgICBtYW4tPmlvX3Jlc2VydmVfZmFzdHBhdGggPSBmYWxz
ZTsKPiAtICAgICAgICAgICAgICAgICAgICAgICBtYW4tPnVzZV9pb19yZXNlcnZlX2xydSA9IHRy
dWU7Cj4gICAgICAgICAgICAgICAgIH0gZWxzZSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAg
bWFuLT5mdW5jID0gJnR0bV9ib19tYW5hZ2VyX2Z1bmM7Cj4gICAgICAgICAgICAgICAgIH0KPiBA
QCAtMTMwNSw2ICsxMzI1LDggQEAgbm91dmVhdV9ib19tb3ZlX250Znkoc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibywgYm9vbCBldmljdCwKPiAgICAgICAgIGlmIChiby0+ZGVzdHJveSAhPSBu
b3V2ZWF1X2JvX2RlbF90dG0pCj4gICAgICAgICAgICAgICAgIHJldHVybjsKPgo+ICsgICAgICAg
bm91dmVhdV9ib19kZWxfaW9fcmVzZXJ2ZV9scnUoYm8pOwo+ICsKPiAgICAgICAgIGlmIChtZW0g
JiYgbmV3X3JlZy0+bWVtX3R5cGUgIT0gVFRNX1BMX1NZU1RFTSAmJgo+ICAgICAgICAgICAgIG1l
bS0+bWVtLnBhZ2UgPT0gbnZiby0+cGFnZSkgewo+ICAgICAgICAgICAgICAgICBsaXN0X2Zvcl9l
YWNoX2VudHJ5KHZtYSwgJm52Ym8tPnZtYV9saXN0LCBoZWFkKSB7Cj4gQEAgLTE0MjcsNiArMTQ0
OSwzMCBAQCBub3V2ZWF1X2JvX3ZlcmlmeV9hY2Nlc3Moc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0
ICpibywgc3RydWN0IGZpbGUgKmZpbHApCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgZmlscC0+cHJpdmF0ZV9kYXRhKTsKPiAgfQo+Cj4gK3N0YXRpYyB2b2lkCj4g
K25vdXZlYXVfdHRtX2lvX21lbV9mcmVlX2xvY2tlZChzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSwg
c3RydWN0IHR0bV9tZW1fcmVnICpyZWcpCj4gK3sKPiArICAgICAgIHN0cnVjdCBub3V2ZWF1X21l
bSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKPiArCj4gKyAgICAgICBpZiAoIXJlZy0+YnVzLmJh
c2UpCj4gKyAgICAgICAgICAgICAgIHJldHVybjsgLyogYWxyZWFkeSBmcmVlZCAqLwo+ICsKPiAr
ICAgICAgIGlmIChkcm0tPmNsaWVudC5tZW0tPm9jbGFzcyA+PSBOVklGX0NMQVNTX01FTV9OVjUw
KSB7Cj4gKyAgICAgICAgICAgICAgIHN3aXRjaCAocmVnLT5tZW1fdHlwZSkgewo+ICsgICAgICAg
ICAgICAgICBjYXNlIFRUTV9QTF9UVDoKPiArICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVt
LT5raW5kKQo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnZpZl9vYmplY3RfdW5t
YXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QpOwo+ICsgICAgICAgICAgICAgICAgICAgICAgIGJy
ZWFrOwo+ICsgICAgICAgICAgICAgICBjYXNlIFRUTV9QTF9WUkFNOgo+ICsgICAgICAgICAgICAg
ICAgICAgICAgIG52aWZfb2JqZWN0X3VubWFwX2hhbmRsZSgmbWVtLT5tZW0ub2JqZWN0KTsKPiAr
ICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKPiArICAgICAgICAgICAgICAgZGVmYXVsdDoK
PiArICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKPiArICAgICAgICAgICAgICAgfQo+ICsg
ICAgICAgfQo+ICsgICAgICAgcmVnLT5idXMuYmFzZSA9IDA7Cj4gK30KPiArCj4gIHN0YXRpYyBp
bnQKPiAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJk
ZXYsIHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQo+ICB7Cj4gQEAgLTE0MzQsMTggKzE0ODAsMjYg
QEAgbm91dmVhdV90dG1faW9fbWVtX3Jlc2VydmUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
IHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQo+ICAgICAgICAgc3RydWN0IG5vdXZlYXVfZHJtICpk
cm0gPSBub3V2ZWF1X2JkZXYoYmRldik7Cj4gICAgICAgICBzdHJ1Y3QgbnZrbV9kZXZpY2UgKmRl
dmljZSA9IG52eHhfZGV2aWNlKCZkcm0tPmNsaWVudC5kZXZpY2UpOwo+ICAgICAgICAgc3RydWN0
IG5vdXZlYXVfbWVtICptZW0gPSBub3V2ZWF1X21lbShyZWcpOwo+ICsgICAgICAgc3RydWN0IG5v
dXZlYXVfYm8gKm52Ym87Cj4gKyAgICAgICBpbnQgcmV0Owo+ICsKPiArICAgICAgIGlmIChyZWct
PmJ1cy5iYXNlKQo+ICsgICAgICAgICAgICAgICByZXR1cm4gMDsgLyogYWxyZWFkeSBtYXBwZWQg
Ki8KPgo+ICAgICAgICAgcmVnLT5idXMuYWRkciA9IE5VTEw7Cj4gICAgICAgICByZWctPmJ1cy5v
ZmZzZXQgPSAwOwo+ICAgICAgICAgcmVnLT5idXMuc2l6ZSA9IHJlZy0+bnVtX3BhZ2VzIDw8IFBB
R0VfU0hJRlQ7Cj4gLSAgICAgICByZWctPmJ1cy5iYXNlID0gMDsKPiAgICAgICAgIHJlZy0+YnVz
LmlzX2lvbWVtID0gZmFsc2U7Cj4gICAgICAgICBpZiAoIShtYW4tPmZsYWdzICYgVFRNX01FTVRZ
UEVfRkxBR19NQVBQQUJMRSkpCj4gICAgICAgICAgICAgICAgIHJldHVybiAtRUlOVkFMOwo+ICsK
PiArICAgICAgIG11dGV4X2xvY2soJmRybS0+dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwo+ICtyZXRy
eToKPiAgICAgICAgIHN3aXRjaCAocmVnLT5tZW1fdHlwZSkgewo+ICAgICAgICAgY2FzZSBUVE1f
UExfU1lTVEVNOgo+ICAgICAgICAgICAgICAgICAvKiBTeXN0ZW0gbWVtb3J5ICovCj4gLSAgICAg
ICAgICAgICAgIHJldHVybiAwOwo+ICsgICAgICAgICAgICAgICByZXQgPSAwOwo+ICsgICAgICAg
ICAgICAgICBnb3RvIG91dDsKPiAgICAgICAgIGNhc2UgVFRNX1BMX1RUOgo+ICAjaWYgSVNfRU5B
QkxFRChDT05GSUdfQUdQKQo+ICAgICAgICAgICAgICAgICBpZiAoZHJtLT5hZ3AuYnJpZGdlKSB7
Cj4gQEAgLTE0NjksNyArMTUyMyw2IEBAIG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVj
dCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiAgICAgICAg
ICAgICAgICAgICAgICAgICB9IGFyZ3M7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgdTY0IGhh
bmRsZSwgbGVuZ3RoOwo+ICAgICAgICAgICAgICAgICAgICAgICAgIHUzMiBhcmdjID0gMDsKPiAt
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmV0Owo+Cj4gICAgICAgICAgICAgICAgICAgICAg
ICAgc3dpdGNoIChtZW0tPm1lbS5vYmplY3Qub2NsYXNzKSB7Cj4gICAgICAgICAgICAgICAgICAg
ICAgICAgY2FzZSBOVklGX0NMQVNTX01FTV9OVjUwOgo+IEBAIC0xNDkzLDM4ICsxNTQ2LDQ2IEBA
IG5vdXZlYXVfdHRtX2lvX21lbV9yZXNlcnZlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBz
dHJ1Y3QgdHRtX21lbV9yZWcgKnJlZykKPiAgICAgICAgICAgICAgICAgICAgICAgICByZXQgPSBu
dmlmX29iamVjdF9tYXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QsCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmYXJncywgYXJnYywKPiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZoYW5kbGUs
ICZsZW5ndGgpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXQgIT0gMSkKPiAtICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQgPyByZXQgOiAtRUlOVkFMOwo+
ICsgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXQgIT0gMSkgewo+ICsgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0ID8gcmV0IDogLUVJTlZBTDsKPiArICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0Owo+ICsgICAgICAgICAgICAgICAgICAgICAg
IH0KPiArICAgICAgICAgICAgICAgICAgICAgICByZXQgPSAwOwo+Cj4gICAgICAgICAgICAgICAg
ICAgICAgICAgcmVnLT5idXMuYmFzZSA9IDA7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgcmVn
LT5idXMub2Zmc2V0ID0gaGFuZGxlOwo+ICAgICAgICAgICAgICAgICB9Cj4gICAgICAgICAgICAg
ICAgIGJyZWFrOwo+ICAgICAgICAgZGVmYXVsdDoKPiAtICAgICAgICAgICAgICAgcmV0dXJuIC1F
SU5WQUw7Cj4gKyAgICAgICAgICAgICAgIHJldCA9IC1FSU5WQUw7Cj4gICAgICAgICB9Cj4gLSAg
ICAgICByZXR1cm4gMDsKPiArCj4gK291dDoKPiArICAgICAgIGlmIChyZXQgPT0gLUVBR0FJTikg
ewo+ICsgICAgICAgICAgICAgICBudmJvID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZkcm0t
PnR0bS5pb19yZXNlcnZlX2xydSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICB0eXBlb2YoKm52Ym8pLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGlvX3Jlc2VydmVfbHJ1KTsKPiArICAgICAgICAgICAgICAg
aWYgKG52Ym8pIHsKPiArICAgICAgICAgICAgICAgICAgICAgICBsaXN0X2RlbF9pbml0KCZudmJv
LT5pb19yZXNlcnZlX2xydSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgZHJtX3ZtYV9ub2Rl
X3VubWFwKCZudmJvLT5iby5iYXNlLnZtYV9ub2RlLAo+ICsgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBiZGV2LT5kZXZfbWFwcGluZyk7Cj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgbm91dmVhdV90dG1faW9fbWVtX2ZyZWVfbG9ja2VkKGRybSwgJm52Ym8tPmJvLm1l
bSk7Cj4gKyAgICAgICAgICAgICAgICAgICAgICAgZ290byByZXRyeTsKPiArICAgICAgICAgICAg
ICAgfQo+ICsKPiArICAgICAgIH0KPiArICAgICAgIG11dGV4X3VubG9jaygmZHJtLT50dG0uaW9f
cmVzZXJ2ZV9tdXRleCk7Cj4gKyAgICAgICByZXR1cm4gcmV0Owo+ICB9Cj4KPiAgc3RhdGljIHZv
aWQKPiAgbm91dmVhdV90dG1faW9fbWVtX2ZyZWUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYs
IHN0cnVjdCB0dG1fbWVtX3JlZyAqcmVnKQo+ICB7Cj4gICAgICAgICBzdHJ1Y3Qgbm91dmVhdV9k
cm0gKmRybSA9IG5vdXZlYXVfYmRldihiZGV2KTsKPiAtICAgICAgIHN0cnVjdCBub3V2ZWF1X21l
bSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKPgo+IC0gICAgICAgaWYgKGRybS0+Y2xpZW50Lm1l
bS0+b2NsYXNzID49IE5WSUZfQ0xBU1NfTUVNX05WNTApIHsKPiAtICAgICAgICAgICAgICAgc3dp
dGNoIChyZWctPm1lbV90eXBlKSB7Cj4gLSAgICAgICAgICAgICAgIGNhc2UgVFRNX1BMX1RUOgo+
IC0gICAgICAgICAgICAgICAgICAgICAgIGlmIChtZW0tPmtpbmQpCj4gLSAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBudmlmX29iamVjdF91bm1hcF9oYW5kbGUoJm1lbS0+bWVtLm9iamVj
dCk7Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Cj4gLSAgICAgICAgICAgICAgIGNh
c2UgVFRNX1BMX1ZSQU06Cj4gLSAgICAgICAgICAgICAgICAgICAgICAgbnZpZl9vYmplY3RfdW5t
YXBfaGFuZGxlKCZtZW0tPm1lbS5vYmplY3QpOwo+IC0gICAgICAgICAgICAgICAgICAgICAgIGJy
ZWFrOwo+IC0gICAgICAgICAgICAgICBkZWZhdWx0Ogo+IC0gICAgICAgICAgICAgICAgICAgICAg
IGJyZWFrOwo+IC0gICAgICAgICAgICAgICB9Cj4gLSAgICAgICB9Cj4gKyAgICAgICBtdXRleF9s
b2NrKCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiArICAgICAgIG5vdXZlYXVfdHRtX2lv
X21lbV9mcmVlX2xvY2tlZChkcm0sIHJlZyk7Cj4gKyAgICAgICBtdXRleF91bmxvY2soJmRybS0+
dHRtLmlvX3Jlc2VydmVfbXV0ZXgpOwo+ICB9Cj4KPiAgc3RhdGljIGludAo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmggYi9kcml2ZXJzL2dwdS9kcm0v
bm91dmVhdS9ub3V2ZWF1X2JvLmgKPiBpbmRleCAzOGY5ZDgzNTA5NjMuLmM0N2ZjZGY4MGFkZSAx
MDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgKPiArKysg
Yi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmgKPiBAQCAtMTcsNiArMTcsNyBA
QCBzdHJ1Y3Qgbm91dmVhdV9ibyB7Cj4gICAgICAgICBib29sIGZvcmNlX2NvaGVyZW50Owo+ICAg
ICAgICAgc3RydWN0IHR0bV9ib19rbWFwX29iaiBrbWFwOwo+ICAgICAgICAgc3RydWN0IGxpc3Rf
aGVhZCBoZWFkOwo+ICsgICAgICAgc3RydWN0IGxpc3RfaGVhZCBpb19yZXNlcnZlX2xydTsKPgo+
ICAgICAgICAgLyogcHJvdGVjdGVkIGJ5IHR0bV9ib19yZXNlcnZlKCkgKi8KPiAgICAgICAgIHN0
cnVjdCBkcm1fZmlsZSAqcmVzZXJ2ZWRfYnk7Cj4gQEAgLTkyLDYgKzkzLDggQEAgaW50ICBub3V2
ZWF1X2JvX3ZhbGlkYXRlKHN0cnVjdCBub3V2ZWF1X2JvICosIGJvb2wgaW50ZXJydXB0aWJsZSwK
PiAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBub193YWl0X2dwdSk7Cj4gIHZvaWQgbm91
dmVhdV9ib19zeW5jX2Zvcl9kZXZpY2Uoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8pOwo+ICB2b2lk
IG5vdXZlYXVfYm9fc3luY19mb3JfY3B1KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvKTsKPiArdm9p
ZCBub3V2ZWF1X2JvX2FkZF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3Qg
KmJvKTsKPiArdm9pZCBub3V2ZWF1X2JvX2RlbF9pb19yZXNlcnZlX2xydShzdHJ1Y3QgdHRtX2J1
ZmZlcl9vYmplY3QgKmJvKTsKPgo+ICAvKiBUT0RPOiBzdWJtaXQgZXF1aXZhbGVudCB0byBUVE0g
Z2VuZXJpYyBBUEkgdXBzdHJlYW0/ICovCj4gIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2lvbWVtICoK
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKPiBpbmRleCBkYThjNDZlMDk5NDMu
LmNkMTljOGNlNTkzOSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2
ZWF1X2Rydi5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaAo+
IEBAIC0xNTgsNiArMTU4LDggQEAgc3RydWN0IG5vdXZlYXVfZHJtIHsKPiAgICAgICAgICAgICAg
ICAgaW50IHR5cGVfdnJhbTsKPiAgICAgICAgICAgICAgICAgaW50IHR5cGVfaG9zdFsyXTsKPiAg
ICAgICAgICAgICAgICAgaW50IHR5cGVfbmNvaFsyXTsKPiArICAgICAgICAgICAgICAgc3RydWN0
IG11dGV4IGlvX3Jlc2VydmVfbXV0ZXg7Cj4gKyAgICAgICAgICAgICAgIHN0cnVjdCBsaXN0X2hl
YWQgaW9fcmVzZXJ2ZV9scnU7Cj4gICAgICAgICB9IHR0bTsKPgo+ICAgICAgICAgLyogR0VNIGlu
dGVyZmFjZSBzdXBwb3J0ICovCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3R0bS5jCj4g
aW5kZXggNzdhMGM2YWQzY2VmLi41MDUxOGI0OGU5YjQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL25vdXZlYXUvbm91dmVhdV90dG0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfdHRtLmMKPiBAQCAtMTYyLDEzICsxNjIsNTEgQEAgY29uc3Qgc3RydWN0IHR0
bV9tZW1fdHlwZV9tYW5hZ2VyX2Z1bmMgbnYwNF9nYXJ0X21hbmFnZXIgPSB7Cj4gICAgICAgICAu
ZGVidWcgPSBub3V2ZWF1X21hbmFnZXJfZGVidWcKPiAgfTsKPgo+ICtzdGF0aWMgdm1fZmF1bHRf
dCBub3V2ZWF1X3R0bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKPiArewo+ICsgICAgICAg
c3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKPiArICAgICAgIHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKPiArICAgICAgIHBn
cHJvdF90IHByb3Q7Cj4gKyAgICAgICB2bV9mYXVsdF90IHJldDsKPiArCj4gKyAgICAgICByZXQg
PSB0dG1fYm9fdm1fcmVzZXJ2ZShibywgdm1mKTsKPiArICAgICAgIGlmIChyZXQpCj4gKyAgICAg
ICAgICAgICAgIHJldHVybiByZXQ7Cj4gKwo+ICsgICAgICAgbm91dmVhdV9ib19kZWxfaW9fcmVz
ZXJ2ZV9scnUoYm8pOwo+ICsKPiArICAgICAgIHByb3QgPSB2bV9nZXRfcGFnZV9wcm90KHZtYS0+
dm1fZmxhZ3MpOwo+ICsgICAgICAgcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwg
cHJvdCwgVFRNX0JPX1ZNX05VTV9QUkVGQVVMVCk7Cj4gKyAgICAgICBpZiAocmV0ID09IFZNX0ZB
VUxUX1JFVFJZICYmICEodm1mLT5mbGFncyAmIEZBVUxUX0ZMQUdfUkVUUllfTk9XQUlUKSkKPiAr
ICAgICAgICAgICAgICAgcmV0dXJuIHJldDsKPiArCj4gKyAgICAgICBub3V2ZWF1X2JvX2FkZF9p
b19yZXNlcnZlX2xydShibyk7Cj4gKwo+ICsgICAgICAgZG1hX3Jlc3ZfdW5sb2NrKGJvLT5iYXNl
LnJlc3YpOwo+ICsKPiArICAgICAgIHJldHVybiByZXQ7Cj4gK30KPiArCj4gK3N0YXRpYyBzdHJ1
Y3Qgdm1fb3BlcmF0aW9uc19zdHJ1Y3Qgbm91dmVhdV90dG1fdm1fb3BzID0gewo+ICsgICAgICAg
LmZhdWx0ID0gbm91dmVhdV90dG1fZmF1bHQsCj4gKyAgICAgICAub3BlbiA9IHR0bV9ib192bV9v
cGVuLAo+ICsgICAgICAgLmNsb3NlID0gdHRtX2JvX3ZtX2Nsb3NlLAo+ICsgICAgICAgLmFjY2Vz
cyA9IHR0bV9ib192bV9hY2Nlc3MKPiArfTsKPiArCj4gIGludAo+ICBub3V2ZWF1X3R0bV9tbWFw
KHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKPiAgewo+ICAg
ICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7Cj4g
ICAgICAgICBzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IG5vdXZlYXVfZHJtKGZpbGVfcHJpdi0+
bWlub3ItPmRldik7Cj4gKyAgICAgICBpbnQgcmV0Owo+Cj4gLSAgICAgICByZXR1cm4gdHRtX2Jv
X21tYXAoZmlscCwgdm1hLCAmZHJtLT50dG0uYmRldik7Cj4gKyAgICAgICByZXQgPSB0dG1fYm9f
bW1hcChmaWxwLCB2bWEsICZkcm0tPnR0bS5iZGV2KTsKPiArICAgICAgIGlmIChyZXQpCj4gKyAg
ICAgICAgICAgICAgIHJldHVybiByZXQ7Cj4gKwo+ICsgICAgICAgdm1hLT52bV9vcHMgPSAmbm91
dmVhdV90dG1fdm1fb3BzOwo+ICsgICAgICAgcmV0dXJuIDA7Cj4gIH0KPgo+ICBzdGF0aWMgaW50
Cj4gQEAgLTI3Myw2ICszMTEsOSBAQCBub3V2ZWF1X3R0bV9pbml0KHN0cnVjdCBub3V2ZWF1X2Ry
bSAqZHJtKQo+ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICAgICAgICAgfQo+Cj4gKyAg
ICAgICBtdXRleF9pbml0KCZkcm0tPnR0bS5pb19yZXNlcnZlX211dGV4KTsKPiArICAgICAgIElO
SVRfTElTVF9IRUFEKCZkcm0tPnR0bS5pb19yZXNlcnZlX2xydSk7Cj4gKwo+ICAgICAgICAgTlZf
SU5GTyhkcm0sICJWUkFNOiAlZCBNaUJcbiIsICh1MzIpKGRybS0+Z2VtLnZyYW1fYXZhaWxhYmxl
ID4+IDIwKSk7Cj4gICAgICAgICBOVl9JTkZPKGRybSwgIkdBUlQ6ICVkIE1pQlxuIiwgKHUzMiko
ZHJtLT5nZW0uZ2FydF9hdmFpbGFibGUgPj4gMjApKTsKPiAgICAgICAgIHJldHVybiAwOwo+IC0t
Cj4gMi4xNy4xCj4KPiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwo+IE5vdXZlYXUgbWFpbGluZyBsaXN0Cj4gTm91dmVhdUBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKPiBodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL25vdXZl
YXUKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
