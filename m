Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 856C4D42DD
	for <lists+dri-devel@lfdr.de>; Fri, 11 Oct 2019 16:30:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CF86A6E21A;
	Fri, 11 Oct 2019 14:30:18 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DEF256E21A
 for <dri-devel@lists.freedesktop.org>; Fri, 11 Oct 2019 14:30:17 +0000 (UTC)
Received: from [127.0.0.1] (localhost [127.0.0.1])
 (Authenticated sender: shadeslayer) with ESMTPSA id A421129114C
From: Rohan Garg <rohan.garg@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4] drm/ioctl: Add a ioctl to label GEM objects
Date: Fri, 11 Oct 2019 16:30:09 +0200
Message-Id: <20191011143009.17503-1-rohan.garg@collabora.com>
X-Mailer: git-send-email 2.17.1
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: kernel@collabora.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFJNX0lPQ1RMX0RVTUJfU0VUX0xBQkVMIGxldHMgeW91IGxhYmVsIEdFTSBvYmplY3RzLCBtYWtp
bmcgaXQKZWFzaWVyIHRvIGRlYnVnIGlzc3VlcyBpbiB1c2Vyc3BhY2UgYXBwbGljYXRpb25zLgoK
Q2hhbmdlcyBpbiB2MjoKICAtIEhvaXN0IHRoZSBJT0NUTCB1cCBpbnRvIHRoZSBkcm1fZHJpdmVy
IGZyYW1ld29yawoKQ2hhbmdlcyBpbiB2MzoKICAtIEludHJvZHVjZSBhIGRybV9nZW1fc2V0X2xh
YmVsIGZvciBkcml2ZXJzIHRvIHVzZSBpbnRlcm5hbGx5CiAgICBpbiBvcmRlciB0byBsYWJlbCBh
IEdFTSBvYmplY3QKICAtIEhvaXN0IHN0cmluZyBjb3B5aW5nIHVwIGludG8gdGhlIElPQ1RMCiAg
LSBGaXggZG9jdW1lbnRhdGlvbgogIC0gTW92ZSBhY3R1YWwgZ2VtIGxhYmVsaW5nIGludG8gZHJt
X2dlbV9hZG9wdF9sYWJlbAoKQ2hhbmdlcyBpbiB2NDoKICAtIFJlZmFjdG9yIElPQ1RMIGNhbGwg
dG8gb25seSBwZXJmb3JtIHN0cmluZyBkdXBsaWNhdGlvbiBhbmQgbW92ZQogICAgYWxsIGdlbSBs
b29rdXAgbG9naWMgaW50byBHRU0gc3BlY2lmaWMgY2FsbAoKU2lnbmVkLW9mZi1ieTogUm9oYW4g
R2FyZyA8cm9oYW4uZ2FyZ0Bjb2xsYWJvcmEuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1f
Z2VtLmMgICAgICB8IDcwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9kcm1faW50ZXJuYWwuaCB8ICA4ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9kcm1f
aW9jdGwuYyAgICB8ICAxICsKIGluY2x1ZGUvZHJtL2RybV9kcnYuaCAgICAgICAgICB8IDE2ICsr
KysrKysrCiBpbmNsdWRlL2RybS9kcm1fZ2VtLmggICAgICAgICAgfCAgNyArKysrCiBpbmNsdWRl
L3VhcGkvZHJtL2RybS5oICAgICAgICAgfCAyMCArKysrKysrKysrCiA2IGZpbGVzIGNoYW5nZWQs
IDEyMiBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMKaW5kZXggNjg1NGY1ODY3ZDUxLi4wZmE0NjA5
YjI4MTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2RybV9nZW0uYwpAQCAtOTQxLDYgKzk0MSw3MSBAQCBkcm1fZ2VtX3JlbGVhc2Uo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXZhdGUpCiAJ
aWRyX2Rlc3Ryb3koJmZpbGVfcHJpdmF0ZS0+b2JqZWN0X2lkcik7CiB9CiAKK2ludCBkcm1fZHVt
Yl9zZXRfbGFiZWxfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJCQl2b2lkICpkYXRh
LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKK3sKKwljaGFyICpsYWJlbDsKKwlzdHJ1Y3Qg
ZHJtX2R1bWJfc2V0X2xhYmVsX29iamVjdCAqYXJncyA9IGRhdGE7CisJaW50IHJldCA9IDA7CisK
KwlpZiAoIWFyZ3MtPmxlbiB8fCAhYXJncy0+bmFtZSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlp
ZiAoIWRldi0+ZHJpdmVyLT5sYWJlbCkKKwkJcmV0dXJuIC1FT1BOT1RTVVBQOworCisJbGFiZWwg
PSBzdHJuZHVwX3VzZXIodTY0X3RvX3VzZXJfcHRyKGFyZ3MtPm5hbWUpLCBhcmdzLT5sZW4pOwor
CisJaWYgKElTX0VSUihsYWJlbCkpIHsKKwkJcmV0ID0gUFRSX0VSUihsYWJlbCk7CisJCWdvdG8g
ZXJyOworCX0KKworCXJldCA9IGRldi0+ZHJpdmVyLT5sYWJlbChkZXYsIGZpbGVfcHJpdiwgYXJn
cy0+aGFuZGxlLCBsYWJlbCk7CisKK2VycjoKKwlrZnJlZShsYWJlbCk7CisJcmV0dXJuIHJldDsK
K30KKworaW50IGRybV9nZW1fc2V0X2xhYmVsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCSAg
ICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwKKwkJCSAgIHVpbnQzMl90IGhhbmRsZSwK
KwkJCSAgIGNvbnN0IGNoYXIgKmxhYmVsKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2Vt
X29iajsKKwlpbnQgcmV0ID0gMDsKKworCWdlbV9vYmogPSBkcm1fZ2VtX29iamVjdF9sb29rdXAo
ZmlsZV9wcml2LCBoYW5kbGUpOworCWlmICghZ2VtX29iaikgeworCQlEUk1fREVCVUcoIkZhaWxl
ZCB0byBsb29rIHVwIEdFTSBCTyAlZFxuIiwgaGFuZGxlKTsKKwkJcmV0ID0gLUVOT0VOVDsKKwkJ
Z290byBlcnI7CisJfQorCWRybV9nZW1fYWRvcHRfbGFiZWwoZ2VtX29iaiwgbGFiZWwpOworCitl
cnI6CisJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKGdlbV9vYmopOworCXJldHVybiByZXQ7
Cit9CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fc2V0X2xhYmVsKTsKKwordm9pZCBkcm1fZ2VtX2Fk
b3B0X2xhYmVsKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaiwgY29uc3QgY2hhciAqbGFi
ZWwpCit7CisJY2hhciAqYWRvcHRlZF9sYWJlbCA9IE5VTEw7CisKKwlpZiAobGFiZWwpCisJCWFk
b3B0ZWRfbGFiZWwgPSBrc3RyZHVwKGxhYmVsLCBHRlBfS0VSTkVMKTsKKworCWlmIChnZW1fb2Jq
LT5sYWJlbCkgeworCQlrZnJlZShnZW1fb2JqLT5sYWJlbCk7CisJCWdlbV9vYmotPmxhYmVsID0g
TlVMTDsKKwl9CisKKwlnZW1fb2JqLT5sYWJlbCA9IGFkb3B0ZWRfbGFiZWw7Cit9CitFWFBPUlRf
U1lNQk9MKGRybV9nZW1fYWRvcHRfbGFiZWwpOworCiAvKioKICAqIGRybV9nZW1fb2JqZWN0X3Jl
bGVhc2UgLSByZWxlYXNlIEdFTSBidWZmZXIgb2JqZWN0IHJlc291cmNlcwogICogQG9iajogR0VN
IGJ1ZmZlciBvYmplY3QKQEAgLTk1OCw2ICsxMDIzLDExIEBAIGRybV9nZW1fb2JqZWN0X3JlbGVh
c2Uoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiAKIAlkbWFfcmVzdl9maW5pKCZvYmotPl9y
ZXN2KTsKIAlkcm1fZ2VtX2ZyZWVfbW1hcF9vZmZzZXQob2JqKTsKKworCWlmIChvYmotPmxhYmVs
KSB7CisJCWtmcmVlKG9iai0+bGFiZWwpOworCQlvYmotPmxhYmVsID0gTlVMTDsKKwl9CiB9CiBF
WFBPUlRfU1lNQk9MKGRybV9nZW1fb2JqZWN0X3JlbGVhc2UpOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFsLmggYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFs
LmgKaW5kZXggNTFhMjA1NWM4ZjE4Li5jYmMzZjdiN2ZiOWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1faW50ZXJuYWwuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2ludGVybmFs
LmgKQEAgLTEzNyw2ICsxMzcsMTQgQEAgaW50IGRybV9nZW1fcGluKHN0cnVjdCBkcm1fZ2VtX29i
amVjdCAqb2JqKTsKIHZvaWQgZHJtX2dlbV91bnBpbihzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9i
aik7CiB2b2lkICpkcm1fZ2VtX3ZtYXAoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopOwogdm9p
ZCBkcm1fZ2VtX3Z1bm1hcChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwgdm9pZCAqdmFkZHIp
OworaW50IGRybV9kdW1iX3NldF9sYWJlbF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAor
CQkJdm9pZCAqZGF0YSwKKwkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KTsKK2ludCBkcm1f
Z2VtX3NldF9sYWJlbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkJc3RydWN0IGRybV9maWxl
ICpmaWxlX3ByaXYsCisJCQl1aW50MzJfdCBoYW5kbGUsCisJCQljb25zdCBjaGFyICpsYWJlbCk7
Cit2b2lkIGRybV9nZW1fYWRvcHRfbGFiZWwoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW1fb2Jq
LCBjb25zdCBjaGFyICpsYWJlbCk7CiAKIC8qIGRybV9kZWJ1Z2ZzLmMgZHJtX2RlYnVnZnNfY3Jj
LmMgKi8KICNpZiBkZWZpbmVkKENPTkZJR19ERUJVR19GUykKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9kcm1faW9jdGwuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1faW9jdGwuYwppbmRleCBm
Y2Q3MjhkN2NmNzIuLmYzNGUxNTcxZDcwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2Ry
bV9pb2N0bC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1faW9jdGwuYwpAQCAtNzE0LDYgKzcx
NCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2lvY3RsX2Rlc2MgZHJtX2lvY3Rsc1tdID0g
ewogCURSTV9JT0NUTF9ERUYoRFJNX0lPQ1RMX01PREVfTElTVF9MRVNTRUVTLCBkcm1fbW9kZV9s
aXN0X2xlc3NlZXNfaW9jdGwsIERSTV9NQVNURVIpLAogCURSTV9JT0NUTF9ERUYoRFJNX0lPQ1RM
X01PREVfR0VUX0xFQVNFLCBkcm1fbW9kZV9nZXRfbGVhc2VfaW9jdGwsIERSTV9NQVNURVIpLAog
CURSTV9JT0NUTF9ERUYoRFJNX0lPQ1RMX01PREVfUkVWT0tFX0xFQVNFLCBkcm1fbW9kZV9yZXZv
a2VfbGVhc2VfaW9jdGwsIERSTV9NQVNURVIpLAorCURSTV9JT0NUTF9ERUYoRFJNX0lPQ1RMX0RV
TUJfU0VUX0xBQkVMLCBkcm1fZHVtYl9zZXRfbGFiZWxfaW9jdGwsIERSTV9SRU5ERVJfQUxMT1cp
LAogfTsKIAogI2RlZmluZSBEUk1fQ09SRV9JT0NUTF9DT1VOVAlBUlJBWV9TSVpFKCBkcm1faW9j
dGxzICkKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9kcnYuaCBiL2luY2x1ZGUvZHJtL2Ry
bV9kcnYuaAppbmRleCBjZjEzNDcwODEwYTUuLjUwMWEzOTI0MzU0YSAxMDA2NDQKLS0tIGEvaW5j
bHVkZS9kcm0vZHJtX2Rydi5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9kcnYuaApAQCAtNzE1LDYg
KzcxNSwyMiBAQCBzdHJ1Y3QgZHJtX2RyaXZlciB7CiAJCQkgICAgc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAkJCSAgICB1aW50MzJfdCBoYW5kbGUpOwogCisJLyoqCisJICogQGxhYmVsOgorCSAq
CisJICogVGhpcyBsYWJlbCdzIGEgYnVmZmVyIG9iamVjdC4KKwkgKgorCSAqIENhbGxlZCBieSB0
aGUgdXNlciB2aWEgaW9jdGwuCisJICoKKwkgKiBSZXR1cm5zOgorCSAqCisJICogWmVybyBvbiBz
dWNjZXNzLCBuZWdhdGl2ZSBlcnJubyBvbiBmYWlsdXJlLgorCSAqLworCWludCAoKmxhYmVsKShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LAor
CQkJCXVpbnQzMl90IGhhbmRsZSwKKwkJCQljaGFyICpsYWJlbCk7CisKIAkvKioKIAkgKiBAZ2Vt
X3ZtX29wczogRHJpdmVyIHByaXZhdGUgb3BzIGZvciB0aGlzIG9iamVjdAogCSAqCmRpZmYgLS1n
aXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtLmggYi9pbmNsdWRlL2RybS9kcm1fZ2VtLmgKaW5kZXgg
NmFhYmExNGY1OTcyLi5mODAxYzA1NGU5NzIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9n
ZW0uaAorKysgYi9pbmNsdWRlL2RybS9kcm1fZ2VtLmgKQEAgLTIzNyw2ICsyMzcsMTMgQEAgc3Ry
dWN0IGRybV9nZW1fb2JqZWN0IHsKIAkgKi8KIAlpbnQgbmFtZTsKIAorCS8qKgorCSAqIEBsYWJl
bDoKKwkgKgorCSAqIExhYmVsIGZvciB0aGlzIG9iamVjdCwgc2hvdWxkIGJlIGEgaHVtYW4gcmVh
ZGFibGUgc3RyaW5nLgorCSAqLworCWNoYXIgKmxhYmVsOworCiAJLyoqCiAJICogQGRtYV9idWY6
CiAJICoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vZHJtLmggYi9pbmNsdWRlL3VhcGkv
ZHJtL2RybS5oCmluZGV4IDhhNWIyZjhmOGViOS4uMzA5YzNjMDkxMzg1IDEwMDY0NAotLS0gYS9p
bmNsdWRlL3VhcGkvZHJtL2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vZHJtLmgKQEAgLTYy
Niw2ICs2MjYsMjUgQEAgc3RydWN0IGRybV9nZW1fb3BlbiB7CiAJX191NjQgc2l6ZTsKIH07CiAK
Ky8qKiBzdHJ1Y3QgZHJtX2R1bWJfc2V0X2xhYmVsX29iamVjdCAtIGlvY3RsIGFyZ3VtZW50IGZv
ciBsYWJlbGxpbmcgQk9zLgorICoKKyAqIFRoaXMgbGFiZWwncyBhIEJPIHdpdGggYSB1c2Vyc3Bh
Y2UgbGFiZWwKKyAqCisgKi8KK3N0cnVjdCBkcm1fZHVtYl9zZXRfbGFiZWxfb2JqZWN0IHsKKwkv
KiogSGFuZGxlIGZvciB0aGUgb2JqZWN0IGJlaW5nIGxhYmVsbGVkLiAqLworCV9fdTMyIGhhbmRs
ZTsKKworCS8qKiBMYWJlbCBhbmQgbGFiZWwgbGVuZ3RoLgorCSAqICBsZW4gaW5jbHVkZXMgdGhl
IHRyYWlsaW5nIE5VTC4KKwkgKi8KKwlfX3UzMiBsZW47CisJX191NjQgbmFtZTsKKworCS8qKiBG
bGFncyAqLworCWludCBmbGFnczsKK307CisKICNkZWZpbmUgRFJNX0NBUF9EVU1CX0JVRkZFUgkJ
MHgxCiAjZGVmaW5lIERSTV9DQVBfVkJMQU5LX0hJR0hfQ1JUQwkweDIKICNkZWZpbmUgRFJNX0NB
UF9EVU1CX1BSRUZFUlJFRF9ERVBUSAkweDMKQEAgLTk0Niw2ICs5NjUsNyBAQCBleHRlcm4gIkMi
IHsKICNkZWZpbmUgRFJNX0lPQ1RMX1NZTkNPQkpfUVVFUlkJCURSTV9JT1dSKDB4Q0IsIHN0cnVj
dCBkcm1fc3luY29ial90aW1lbGluZV9hcnJheSkKICNkZWZpbmUgRFJNX0lPQ1RMX1NZTkNPQkpf
VFJBTlNGRVIJRFJNX0lPV1IoMHhDQywgc3RydWN0IGRybV9zeW5jb2JqX3RyYW5zZmVyKQogI2Rl
ZmluZSBEUk1fSU9DVExfU1lOQ09CSl9USU1FTElORV9TSUdOQUwJRFJNX0lPV1IoMHhDRCwgc3Ry
dWN0IGRybV9zeW5jb2JqX3RpbWVsaW5lX2FycmF5KQorI2RlZmluZSBEUk1fSU9DVExfRFVNQl9T
RVRfTEFCRUwgICAgICBEUk1fSU9XUigweENFLCBzdHJ1Y3QgZHJtX2R1bWJfc2V0X2xhYmVsX29i
amVjdCkKIAogLyoqCiAgKiBEZXZpY2Ugc3BlY2lmaWMgaW9jdGxzIHNob3VsZCBvbmx5IGJlIGlu
IHRoZWlyIHJlc3BlY3RpdmUgaGVhZGVycwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
