Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DE25ABE1DB
	for <lists+dri-devel@lfdr.de>; Wed, 25 Sep 2019 18:00:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E27F6EBE9;
	Wed, 25 Sep 2019 16:00:49 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id E11F96EBE9
 for <dri-devel@lists.freedesktop.org>; Wed, 25 Sep 2019 16:00:47 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 84A591570;
 Wed, 25 Sep 2019 09:00:47 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 652063F59C;
 Wed, 25 Sep 2019 09:00:46 -0700 (PDT)
Subject: Re: [PATCH] drm: Don't free jobs in wait_event_interruptible()
To: "Grodzovsky, Andrey" <Andrey.Grodzovsky@amd.com>,
 Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>,
 "Koenig, Christian" <Christian.Koenig@amd.com>
References: <20190925151404.23222-1-steven.price@arm.com>
 <cc0b260c-059d-7f55-288e-c48f30eb84e3@amd.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <078332cf-ef58-5f76-5c49-8034435f7bea@arm.com>
Date: Wed, 25 Sep 2019 17:00:45 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <cc0b260c-059d-7f55-288e-c48f30eb84e3@amd.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: "Deucher, Alexander" <Alexander.Deucher@amd.com>,
 Nayan Deshmukh <nayan26deshmukh@gmail.com>,
 Sharat Masetty <smasetty@codeaurora.org>,
 "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
 "dri-devel@lists.freedesktop.org" <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjUvMDkvMjAxOSAxNjo1NiwgR3JvZHpvdnNreSwgQW5kcmV5IHdyb3RlOgo+IE9uIDkvMjUv
MTkgMTE6MTQgQU0sIFN0ZXZlbiBQcmljZSB3cm90ZToKPiAKPj4gZHJtX3NjaGVkX2NsZWFudXBf
am9icygpIGF0dGVtcHRzIHRvIGZyZWUgZmluaXNoZWQgam9icywgaG93ZXZlciBiZWNhdXNlCj4+
IGl0IGlzIGNhbGxlZCBhcyB0aGUgY29uZGl0aW9uIG9mIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJs
ZSgpIGl0IG11c3Qgbm90Cj4+IHNsZWVwLiBVbmZvcnR1bmF0ZWx5IHNvbWUgZnJlZSBjYWxsYmFj
a3MgKG5vdGFibHkgZm9yIFBhbmZyb3N0KSBkbyBzbGVlcC4KPj4KPj4gSW5zdGVhZCBsZXQncyBy
ZW5hbWUgZHJtX3NjaGVkX2NsZWFudXBfam9icygpIHRvCj4+IGRybV9zY2hlZF9nZXRfY2xlYW51
cF9qb2IoKSBhbmQgc2ltcGx5IHJldHVybiBhIGpvYiBmb3IgcHJvY2Vzc2luZyBpZgo+PiB0aGVy
ZSBpcyBvbmUuIFRoZSBjYWxsZXIgY2FuIHRoZW4gY2FsbCB0aGUgZnJlZV9qb2IoKSBjYWxsYmFj
ayBvdXRzaWRlCj4+IHRoZSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoKSB3aGVyZSBzbGVlcGlu
ZyBpcyBwb3NzaWJsZSBiZWZvcmUKPj4gcmUtY2hlY2tpbmcgYW5kIHJldHVybmluZyB0byBzbGVl
cCBpZiBuZWNlc3NhcnkuCj4+Cj4+IFNpZ25lZC1vZmYtYnk6IFN0ZXZlbiBQcmljZSA8c3RldmVu
LnByaWNlQGFybS5jb20+Cj4+IC0tLQo+PiAgIGRyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2No
ZWRfbWFpbi5jIHwgNDQgKysrKysrKysrKysrKystLS0tLS0tLS0tLS0KPj4gICAxIGZpbGUgY2hh
bmdlZCwgMjQgaW5zZXJ0aW9ucygrKSwgMjAgZGVsZXRpb25zKC0pCj4+Cj4+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jCj4+IGluZGV4IDlhMGVlNzRkODJkYy4uMGVkNGFhYTRl
NmQxIDEwMDY0NAo+PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4u
Ywo+PiArKysgYi9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiBAQCAt
NjIyLDQzICs2MjIsNDEgQEAgc3RhdGljIHZvaWQgZHJtX3NjaGVkX3Byb2Nlc3Nfam9iKHN0cnVj
dCBkbWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQo+PiAgIH0KPj4gICAKPj4g
ICAvKioKPj4gLSAqIGRybV9zY2hlZF9jbGVhbnVwX2pvYnMgLSBkZXN0cm95IGZpbmlzaGVkIGpv
YnMKPj4gKyAqIGRybV9zY2hlZF9nZXRfY2xlYW51cF9qb2IgLSBmZXRjaCB0aGUgbmV4dCBmaW5p
c2hlZCBqb2IgdG8gYmUgZGVzdHJveWVkCj4+ICAgICoKPj4gICAgKiBAc2NoZWQ6IHNjaGVkdWxl
ciBpbnN0YW5jZQo+PiAgICAqCj4+IC0gKiBSZW1vdmUgYWxsIGZpbmlzaGVkIGpvYnMgZnJvbSB0
aGUgbWlycm9yIGxpc3QgYW5kIGRlc3Ryb3kgdGhlbS4KPj4gKyAqIFJldHVybnMgdGhlIG5leHQg
ZmluaXNoZWQgam9iIGZyb20gdGhlIG1pcnJvciBsaXN0IChpZiB0aGVyZSBpcyBvbmUpCj4+ICsg
KiByZWFkeSBmb3IgaXQgdG8gYmUgZGVzdHJveWVkLgo+PiAgICAqLwo+PiAtc3RhdGljIHZvaWQg
ZHJtX3NjaGVkX2NsZWFudXBfam9icyhzdHJ1Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+
PiArc3RhdGljIHN0cnVjdCBkcm1fc2NoZWRfam9iICoKPj4gK2RybV9zY2hlZF9nZXRfY2xlYW51
cF9qb2Ioc3RydWN0IGRybV9ncHVfc2NoZWR1bGVyICpzY2hlZCkKPj4gICB7Cj4+ICsJc3RydWN0
IGRybV9zY2hlZF9qb2IgKmpvYiA9IE5VTEw7Cj4+ICAgCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4+
ICAgCj4+ICAgCS8qIERvbid0IGRlc3Ryb3kgam9icyB3aGlsZSB0aGUgdGltZW91dCB3b3JrZXIg
aXMgcnVubmluZyAqLwo+PiAgIAlpZiAoc2NoZWQtPnRpbWVvdXQgIT0gTUFYX1NDSEVEVUxFX1RJ
TUVPVVQgJiYKPj4gICAJICAgICFjYW5jZWxfZGVsYXllZF93b3JrKCZzY2hlZC0+d29ya190ZHIp
KQo+PiAtCQlyZXR1cm47Cj4+IC0KPj4gLQo+PiAtCXdoaWxlICghbGlzdF9lbXB0eSgmc2NoZWQt
PnJpbmdfbWlycm9yX2xpc3QpKSB7Cj4+IC0JCXN0cnVjdCBkcm1fc2NoZWRfam9iICpqb2I7Cj4+
ICsJCXJldHVybiBOVUxMOwo+PiAgIAo+PiAtCQlqb2IgPSBsaXN0X2ZpcnN0X2VudHJ5KCZzY2hl
ZC0+cmluZ19taXJyb3JfbGlzdCwKPj4gKwlqb2IgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwo
JnNjaGVkLT5yaW5nX21pcnJvcl9saXN0LAo+PiAgIAkJCQkgICAgICAgc3RydWN0IGRybV9zY2hl
ZF9qb2IsIG5vZGUpOwo+PiAtCQlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZCgmam9iLT5zX2Zl
bmNlLT5maW5pc2hlZCkpCj4+IC0JCQlicmVhazsKPj4gICAKPj4gLQkJc3Bpbl9sb2NrX2lycXNh
dmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+ICsJc3Bpbl9sb2NrX2lycXNhdmUo
JnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+ICsKPj4gKwlpZiAoam9iICYmIGRtYV9m
ZW5jZV9pc19zaWduYWxlZCgmam9iLT5zX2ZlbmNlLT5maW5pc2hlZCkpIHsKPj4gICAJCS8qIHJl
bW92ZSBqb2IgZnJvbSByaW5nX21pcnJvcl9saXN0ICovCj4+ICAgCQlsaXN0X2RlbF9pbml0KCZq
b2ItPm5vZGUpOwo+PiAtCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+am9iX2xpc3Rf
bG9jaywgZmxhZ3MpOwo+PiAtCj4+IC0JCXNjaGVkLT5vcHMtPmZyZWVfam9iKGpvYik7Cj4+ICsJ
fSBlbHNlIHsKPj4gKwkJam9iID0gTlVMTDsKPj4gKwkJLyogcXVldWUgdGltZW91dCBmb3IgbmV4
dCBqb2IgKi8KPj4gKwkJZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQoc2NoZWQpOwo+PiAgIAl9Cj4+
ICAgCj4+IC0JLyogcXVldWUgdGltZW91dCBmb3IgbmV4dCBqb2IgKi8KPj4gLQlzcGluX2xvY2tf
aXJxc2F2ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPj4gLQlkcm1fc2NoZWRfc3Rh
cnRfdGltZW91dChzY2hlZCk7Cj4+ICAgCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnNjaGVkLT5q
b2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+ICAgCj4+ICsJcmV0dXJuIGpvYjsKPj4gICB9Cj4+ICAg
Cj4+ICAgLyoqCj4+IEBAIC02OTgsMTIgKzY5NiwxOCBAQCBzdGF0aWMgaW50IGRybV9zY2hlZF9t
YWluKHZvaWQgKnBhcmFtKQo+PiAgIAkJc3RydWN0IGRybV9zY2hlZF9mZW5jZSAqc19mZW5jZTsK
Pj4gICAJCXN0cnVjdCBkcm1fc2NoZWRfam9iICpzY2hlZF9qb2I7Cj4+ICAgCQlzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZTsKPj4gKwkJc3RydWN0IGRybV9zY2hlZF9qb2IgKmNsZWFudXBfam9iID0g
TlVMTDsKPj4gICAKPj4gICAJCXdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZShzY2hlZC0+d2FrZV91
cF93b3JrZXIsCj4+IC0JCQkJCSAoZHJtX3NjaGVkX2NsZWFudXBfam9icyhzY2hlZCksCj4+ICsJ
CQkJCSAoY2xlYW51cF9qb2IgPSBkcm1fc2NoZWRfZ2V0X2NsZWFudXBfam9iKHNjaGVkKSkgfHwK
Pj4gICAJCQkJCSAoIWRybV9zY2hlZF9ibG9ja2VkKHNjaGVkKSAmJgo+PiAgIAkJCQkJICAoZW50
aXR5ID0gZHJtX3NjaGVkX3NlbGVjdF9lbnRpdHkoc2NoZWQpKSkgfHwKPj4gLQkJCQkJIGt0aHJl
YWRfc2hvdWxkX3N0b3AoKSkpOwo+PiArCQkJCQkga3RocmVhZF9zaG91bGRfc3RvcCgpKTsKPiAK
PiAKPiBDYW4ndCB3ZSBqdXN0IGNhbGwgZHJtX3NjaGVkX2NsZWFudXBfam9icyByaWdodCBoZXJl
LCByZW1vdmUgYWxsIHRoZSAKPiBjb25kaXRpb25zIGluIHdhaXRfZXZlbnRfaW50ZXJydXB0aWJs
ZSAobWFrZSBpdCBhbHdheXMgdHJ1ZSkgYW5kIGFmdGVyIAo+IGRybV9zY2hlZF9jbGVhbnVwX2pv
YnMgaXMgY2FsbGVkIHRlc3QgZm9yIGFsbCB0aG9zZSBjb25kaXRpb25zIGFuZCAKPiByZXR1cm4g
dG8gc2xlZXAgaWYgdGhleSBldmFsdWF0ZSB0byBmYWxzZSA/IGRybV9zY2hlZF9jbGVhbnVwX2pv
YnMgaXMgCj4gY2FsbGVkIHVuY29uZGl0aW9uYWxseSBpbnNpZGUgd2FpdF9ldmVudF9pbnRlcnJ1
cHRpYmxlIGFueXdheS4uLiBUaGlzIGlzIAo+IG1vcmUgb2YgYSBxdWVzdGlvbiB0byBDaHJpc3Rp
YW4uCgpDaHJpc3RpYW4gbWF5IGtub3cgYmV0dGVyIHRoYW4gbWUsIGJ1dCBJIHRoaW5rIHRob3Nl
IGNvbmRpdGlvbnMgbmVlZCB0bwpiZSBpbiB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoKSB0byBh
dm9pZCByYWNlIGNvbmRpdGlvbnMuIElmIHdlIHNpbXBseQpyZXBsYWNlIGFsbCB0aGUgY29uZGl0
aW9ucyB3aXRoIGEgbGl0ZXJhbCAidHJ1ZSIgdGhlbgp3YWl0X2V2ZW50X2ludGVycnVwdGlibGUo
KSB3aWxsIG5ldmVyIGFjdHVhbGx5IHNsZWVwLgoKU3RldmUKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
