Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 58C0E5B151
	for <lists+dri-devel@lfdr.de>; Sun, 30 Jun 2019 20:30:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 062BF89D58;
	Sun, 30 Jun 2019 18:29:59 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-io1-xd44.google.com (mail-io1-xd44.google.com
 [IPv6:2607:f8b0:4864:20::d44])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EEE3989D58
 for <dri-devel@lists.freedesktop.org>; Sun, 30 Jun 2019 18:29:57 +0000 (UTC)
Received: by mail-io1-xd44.google.com with SMTP id j6so23625631ioa.5
 for <dri-devel@lists.freedesktop.org>; Sun, 30 Jun 2019 11:29:57 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:mime-version:references:in-reply-to:from:date
 :message-id:subject:to:cc;
 bh=/43Bg0jXYenu/Pg+l3Ul35tTlNWTMcV5XmLjDQ3kCRE=;
 b=tMfOtEX6SKcLLeRKMhF2bwxGqsUwJBb08OEEnXwLabnG15aU+Yjf11gpAFWwaej3gp
 cMTmrGHgxaxu1CnQNGLQIzY2UEwLg2+HwnFEC5ttERYulvnFtDr5MUk3dbUJyO5lf0tj
 2NTGMB8lCeqnbppp+JdAXSBEY2qW05P30PKwlbTQS3shWouLt11GYcwNVsmcaGSL5ftN
 cPbgTsnqPfDk5Nolr7+lhpBPFOsF5WvS6m4gF6Z9FIQiGp6jO8gk2bJAzFayXcM/wRxk
 CYJqXWY4pRQVlUnjgrnP95sEw0DIiqMO03IrVNB8idcZlYch48phCie80UqFENKO1f3/
 5VVg==
X-Gm-Message-State: APjAAAXttU4b+AsDd6laddoejiaOixiK4cEY4o9/VfhJrLsSjYfDvW71
 RBB5WenxHhZEoJvCslOZAln9TjD1L5YPo4ZZZGKZOw==
X-Google-Smtp-Source: APXvYqwSL9GCuvuncW8ED0ohZrODEnOED10uEHR5MBaDgS0mGcSxUZ4msko1qf724z4X5ST665QvMvEAX32PmOcXkSE=
X-Received: by 2002:a6b:6012:: with SMTP id r18mr4184797iog.241.1561919397145; 
 Sun, 30 Jun 2019 11:29:57 -0700 (PDT)
MIME-Version: 1.0
References: <20190628121338.24398-1-kraxel@redhat.com>
 <20190628121338.24398-9-kraxel@redhat.com>
 <CAPaKu7RRf3T3RCYXJ466xt7U1dAxRx++Ln+ey50a=yjdXpZw6g@mail.gmail.com>
In-Reply-To: <CAPaKu7RRf3T3RCYXJ466xt7U1dAxRx++Ln+ey50a=yjdXpZw6g@mail.gmail.com>
From: Chia-I Wu <olvaffe@gmail.com>
Date: Sun, 30 Jun 2019 11:29:45 -0700
Message-ID: <CAPaKu7Qab2XyWs830YHK8iAcVUXX3KPt_5CT_U9MmivGc3iJ4Q@mail.gmail.com>
Subject: Re: [PATCH v5 08/12] drm/virtio: rework virtio_gpu_execbuffer_ioctl
 fencing
To: Gerd Hoffmann <kraxel@redhat.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=mime-version:references:in-reply-to:from:date:message-id:subject:to
 :cc;
 bh=/43Bg0jXYenu/Pg+l3Ul35tTlNWTMcV5XmLjDQ3kCRE=;
 b=i7JpeaKiALBrXoo8k1h+tGbeaNd++nOnV8YieLcRUMfJko6XLf0S1k/8vaoC+VgGod
 NDadIX8yVfD3qkXwCfkS2GNSx3G25FOkK2zWoCZCsdvb1XUXdBtwhhaemEqxCGLOCnti
 LEvEzzMTmkmLNGhNqGmRtlv2c8+1Mj4WeSdvfTfv8YdOTP5CM/Pwxjv/dy/3JiufIt36
 44MfUQh1D7m1dZEcRWSB1DYgiB2lVcp231QZLxUwurOA8iDnnt3ICfUlXiT5T4vTsOYf
 5CmEGE/kehn1f5/ieODc8kyQLym77N/v88q23ygHeqbtIcrxOCWT7LKb9RIvFKVa2BnB
 jaqw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, open list <linux-kernel@vger.kernel.org>,
 ML dri-devel <dri-devel@lists.freedesktop.org>,
 "open list:VIRTIO GPU DRIVER" <virtualization@lists.linux-foundation.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

KHByZXNzZWQgU2VuZCB0b28gZWFybHkpCgpPbiBTdW4sIEp1biAzMCwgMjAxOSBhdCAxMToyMCBB
TSBDaGlhLUkgV3UgPG9sdmFmZmVAZ21haWwuY29tPiB3cm90ZToKPgo+IE9uIEZyaSwgSnVuIDI4
LCAyMDE5IGF0IDU6MTMgQU0gR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+IHdyb3Rl
Ogo+ID4KPiA+IFVzZSBnZW0gcmVzZXJ2YXRpb24gaGVscGVycyBhbmQgZGlyZWN0IHJlc2VydmF0
aW9uX29iamVjdF8qIGNhbGxzCj4gPiBpbnN0ZWFkIG9mIHR0bS4KPiA+Cj4gPiB2NTogZml4IGZl
bmNpbmcgKENoaWEtSSBXdSkuCj4gPiB2MzogQWxzbyBhdHRhY2ggdGhlIGFycmF5IG9mIGdlbSBv
YmplY3RzIHRvIHRoZSB2aXJ0aW8gY29tbWFuZCBidWZmZXIsCj4gPiBzbyB3ZSBjYW4gZHJvcCB0
aGUgb2JqZWN0IHJlZmVyZW5jZXMgaW4gdGhlIGNvbXBsZXRpb24gY2FsbGJhY2suICBOZWVkZWQK
PiA+IGJlY2F1c2UgdHRtIGZlbmNlIGhlbHBlcnMgZ3JhYiBhIHJlZmVyZW5jZSBmb3IgdXMsIGJ1
dCBnZW0gaGVscGVycwo+ID4gZG9uJ3QuCj4gVGhlcmUgYXJlIG90aGVyIHBsYWNlcwpUaGVyZSBh
cmUgb3RoZXIgcGxhY2VzIHdoZXJlIGEgdmJ1ZmZlciB1c2VzIG9iamVjdHMsIHN1Y2ggYXMgaW4K
dHJhbnNmZXJzLiAgRG8gd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhlIG9iamVjdHMgYXJlIGFsaXZl
IGluIHRob3NlCnBsYWNlcz8KCj4gPgo+ID4gU2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8
a3JheGVsQHJlZGhhdC5jb20+Cj4gPiBBY2tlZC1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZl
dHRlckBmZndsbC5jaD4KPiA+IC0tLQo+ID4gIGRyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdw
dV9kcnYuaCAgIHwgIDYgKystCj4gPiAgZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lv
Y3RsLmMgfCA2MiArKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLQo+ID4gIGRyaXZlcnMvZ3B1L2Ry
bS92aXJ0aW8vdmlydGdwdV92cS5jICAgIHwgMTcgKysrKy0tLQo+ID4gIDMgZmlsZXMgY2hhbmdl
ZCwgNDMgaW5zZXJ0aW9ucygrKSwgNDIgZGVsZXRpb25zKC0pCj4gPgo+ID4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92
aXJ0aW8vdmlydGdwdV9kcnYuaAo+ID4gaW5kZXggOThkNjQ2Nzg5ZDIzLi4zNTZkMjcxMzIzODgg
MTAwNjQ0Cj4gPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfZHJ2LmgKPiA+
ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV9kcnYuaAo+ID4gQEAgLTEyMCw5
ICsxMjAsOSBAQCBzdHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVyIHsKPiA+Cj4gPiAgICAgICAgIGNo
YXIgKnJlc3BfYnVmOwo+ID4gICAgICAgICBpbnQgcmVzcF9zaXplOwo+ID4gLQo+ID4gICAgICAg
ICB2aXJ0aW9fZ3B1X3Jlc3BfY2IgcmVzcF9jYjsKPiA+Cj4gPiArICAgICAgIHN0cnVjdCB2aXJ0
aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqczsKPiA+ICAgICAgICAgc3RydWN0IGxpc3RfaGVhZCBs
aXN0Owo+ID4gIH07Cj4gPgo+ID4gQEAgLTMxMSw3ICszMTEsOSBAQCB2b2lkIHZpcnRpb19ncHVf
Y21kX2NvbnRleHRfZGV0YWNoX3Jlc291cmNlKHN0cnVjdCB2aXJ0aW9fZ3B1X2RldmljZSAqdmdk
ZXYsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQz
Ml90IHJlc291cmNlX2lkKTsKPiA+ICB2b2lkIHZpcnRpb19ncHVfY21kX3N1Ym1pdChzdHJ1Y3Qg
dmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
dm9pZCAqZGF0YSwgdWludDMyX3QgZGF0YV9zaXplLAo+ID4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgdWludDMyX3QgY3R4X2lkLCBzdHJ1Y3QgdmlydGlvX2dwdV9mZW5jZSAqZmVuY2UpOwo+
ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgY3R4X2lkLAo+ID4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVfb2JqZWN0X2FycmF5ICpvYmpz
LAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IHZpcnRpb19ncHVfZmVuY2Ug
KmZlbmNlKTsKPiA+ICB2b2lkIHZpcnRpb19ncHVfY21kX3RyYW5zZmVyX2Zyb21faG9zdF8zZChz
dHJ1Y3QgdmlydGlvX2dwdV9kZXZpY2UgKnZnZGV2LAo+ID4gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgdWludDMyX3QgcmVzb3VyY2VfaWQsIHVpbnQzMl90IGN0eF9p
ZCwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQ2NF90
IG9mZnNldCwgdWludDMyX3QgbGV2ZWwsCj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVf
aW9jdGwuYwo+ID4gaW5kZXggMGNhZmYzZmE2MjNlLi5hZTY4MzBhYTM4YzkgMTAwNjQ0Cj4gPiAt
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdmlydGlvL3ZpcnRncHVfaW9jdGwuYwo+ID4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X2lvY3RsLmMKPiA+IEBAIC0xMDUsMTQgKzEwNSwx
MSBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVfZXhlY2J1ZmZlcl9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAo+ID4gICAgICAgICBzdHJ1Y3QgZHJtX3ZpcnRncHVfZXhl
Y2J1ZmZlciAqZXhidWYgPSBkYXRhOwo+ID4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9kZXZp
Y2UgKnZnZGV2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKPiA+ICAgICAgICAgc3RydWN0IHZpcnRpb19n
cHVfZnByaXYgKnZmcHJpdiA9IGRybV9maWxlLT5kcml2ZXJfcHJpdjsKPiA+IC0gICAgICAgc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpnb2JqOwo+ID4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9m
ZW5jZSAqb3V0X2ZlbmNlOwo+ID4gLSAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV9vYmplY3QgKnFv
Ymo7Cj4gPiAgICAgICAgIGludCByZXQ7Cj4gPiAgICAgICAgIHVpbnQzMl90ICpib19oYW5kbGVz
ID0gTlVMTDsKPiA+ICAgICAgICAgdm9pZCBfX3VzZXIgKnVzZXJfYm9faGFuZGxlcyA9IE5VTEw7
Cj4gPiAtICAgICAgIHN0cnVjdCBsaXN0X2hlYWQgdmFsaWRhdGVfbGlzdDsKPiA+IC0gICAgICAg
c3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgKmJ1Zmxpc3QgPSBOVUxMOwo+ID4gKyAgICAgICBz
dHJ1Y3QgdmlydGlvX2dwdV9vYmplY3RfYXJyYXkgKmJ1Zmxpc3QgPSBOVUxMOwo+ID4gICAgICAg
ICBpbnQgaTsKPiA+ICAgICAgICAgc3RydWN0IHd3X2FjcXVpcmVfY3R4IHRpY2tldDsKPiA+ICAg
ICAgICAgc3RydWN0IHN5bmNfZmlsZSAqc3luY19maWxlOwo+ID4gQEAgLTE1NSwxNSArMTUyLDEw
IEBAIHN0YXRpYyBpbnQgdmlydGlvX2dwdV9leGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g
b3V0X2ZlbmNlX2ZkOwo+ID4gICAgICAgICB9Cj4gPgo+ID4gLSAgICAgICBJTklUX0xJU1RfSEVB
RCgmdmFsaWRhdGVfbGlzdCk7Cj4gPiAgICAgICAgIGlmIChleGJ1Zi0+bnVtX2JvX2hhbmRsZXMp
IHsKPiA+IC0KPiA+ICAgICAgICAgICAgICAgICBib19oYW5kbGVzID0ga3ZtYWxsb2NfYXJyYXko
ZXhidWYtPm51bV9ib19oYW5kbGVzLAo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHNpemVvZih1aW50MzJfdCksIEdGUF9LRVJORUwpOwo+ID4gLSAgICAgICAg
ICAgICAgIGJ1Zmxpc3QgPSBrdm1hbGxvY19hcnJheShleGJ1Zi0+bnVtX2JvX2hhbmRsZXMsCj4g
PiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZW9mKHN0cnVj
dCB0dG1fdmFsaWRhdGVfYnVmZmVyKSwKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBHRlBfS0VSTkVMIHwgX19HRlBfWkVSTyk7Cj4gPiAtICAgICAgICAgICAg
ICAgaWYgKCFib19oYW5kbGVzIHx8ICFidWZsaXN0KSB7Cj4gPiArICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVvZih1aW50MzJfdCksIEdGUF9LRVJORUwpOwo+
ID4gKyAgICAgICAgICAgICAgIGlmICghYm9faGFuZGxlcykgewo+ID4gICAgICAgICAgICAgICAg
ICAgICAgICAgcmV0ID0gLUVOT01FTTsKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8g
b3V0X3VudXNlZF9mZDsKPiA+ICAgICAgICAgICAgICAgICB9Cj4gPiBAQCAtMTc1LDI1ICsxNjcs
MjIgQEAgc3RhdGljIGludCB2aXJ0aW9fZ3B1X2V4ZWNidWZmZXJfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKPiA+ICAgICAgICAgICAgICAgICAgICAgICAgIGdvdG8g
b3V0X3VudXNlZF9mZDsKPiA+ICAgICAgICAgICAgICAgICB9Cj4gPgo+ID4gLSAgICAgICAgICAg
ICAgIGZvciAoaSA9IDA7IGkgPCBleGJ1Zi0+bnVtX2JvX2hhbmRsZXM7IGkrKykgewo+ID4gLSAg
ICAgICAgICAgICAgICAgICAgICAgZ29iaiA9IGRybV9nZW1fb2JqZWN0X2xvb2t1cChkcm1fZmls
ZSwgYm9faGFuZGxlc1tpXSk7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWdvYmop
IHsKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ID0gLUVOT0VOVDsKPiA+
IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ290byBvdXRfdW51c2VkX2ZkOwo+ID4g
LSAgICAgICAgICAgICAgICAgICAgICAgfQo+ID4gLQo+ID4gLSAgICAgICAgICAgICAgICAgICAg
ICAgcW9iaiA9IGdlbV90b192aXJ0aW9fZ3B1X29iaihnb2JqKTsKPiA+IC0gICAgICAgICAgICAg
ICAgICAgICAgIGJ1Zmxpc3RbaV0uYm8gPSAmcW9iai0+dGJvOwo+ID4gLQo+ID4gLSAgICAgICAg
ICAgICAgICAgICAgICAgbGlzdF9hZGQoJmJ1Zmxpc3RbaV0uaGVhZCwgJnZhbGlkYXRlX2xpc3Qp
Owo+ID4gKyAgICAgICAgICAgICAgIGJ1Zmxpc3QgPSB2aXJ0aW9fZ3B1X2FycmF5X2Zyb21faGFu
ZGxlcyhkcm1fZmlsZSwgYm9faGFuZGxlcywKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhidWYtPm51bV9ib19oYW5kbGVzKTsKPiA+
ICsgICAgICAgICAgICAgICBpZiAoIWJ1Zmxpc3QpIHsKPiA+ICsgICAgICAgICAgICAgICAgICAg
ICAgIHJldCA9IC1FTk9FTlQ7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICBnb3RvIG91dF91
bnVzZWRfZmQ7Cj4gPiAgICAgICAgICAgICAgICAgfQo+ID4gICAgICAgICAgICAgICAgIGt2ZnJl
ZShib19oYW5kbGVzKTsKPiA+ICAgICAgICAgICAgICAgICBib19oYW5kbGVzID0gTlVMTDsKPiA+
ICAgICAgICAgfQo+ID4KPiA+IC0gICAgICAgcmV0ID0gdmlydGlvX2dwdV9vYmplY3RfbGlzdF92
YWxpZGF0ZSgmdGlja2V0LCAmdmFsaWRhdGVfbGlzdCk7Cj4gPiAtICAgICAgIGlmIChyZXQpCj4g
PiAtICAgICAgICAgICAgICAgZ290byBvdXRfZnJlZTsKPiA+ICsgICAgICAgaWYgKGJ1Zmxpc3Qp
IHsKPiA+ICsgICAgICAgICAgICAgICByZXQgPSBkcm1fZ2VtX2xvY2tfcmVzZXJ2YXRpb25zKGJ1
Zmxpc3QtPm9ianMsIGJ1Zmxpc3QtPm5lbnRzLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgJnRpY2tldCk7Cj4gPiArICAgICAgICAgICAgICAgaWYg
KHJldCkKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgIGdvdG8gb3V0X3VudXNlZF9mZDsKPiA+
ICsgICAgICAgfQo+ID4KPiA+ICAgICAgICAgYnVmID0gbWVtZHVwX3VzZXIodTY0X3RvX3VzZXJf
cHRyKGV4YnVmLT5jb21tYW5kKSwgZXhidWYtPnNpemUpOwo+ID4gICAgICAgICBpZiAoSVNfRVJS
KGJ1ZikpIHsKPiA+IEBAIC0yMTksMjUgKzIwOCwyOCBAQCBzdGF0aWMgaW50IHZpcnRpb19ncHVf
ZXhlY2J1ZmZlcl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAo+ID4g
ICAgICAgICAgICAgICAgIGZkX2luc3RhbGwob3V0X2ZlbmNlX2ZkLCBzeW5jX2ZpbGUtPmZpbGUp
Owo+ID4gICAgICAgICB9Cj4gPgo+ID4gKyAgICAgICBpZiAoYnVmbGlzdCkKPiA+ICsgICAgICAg
ICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZXhidWYtPm51bV9ib19oYW5kbGVzOyBpKyspCj4gPiAr
ICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVuY2Uo
YnVmbGlzdC0+b2Jqc1tpXS0+cmVzdiwKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmb3V0X2ZlbmNlLT5mKTsKPiA+ICsKPiBBbm90
aGVyIG1vZHVsZSBjYW4gc2VlIHRoZSBzZW1pLWluaXRpYWxpemVkIGZlbmNlIGFmdGVyIHRoaXMu
ICBXZQo+IHNob3VsZCBtb3ZlIHRoaXMgYWZ0ZXIgdmlydGlvX2dwdV9jbWRfc3VibWl0Lgo+Cj4g
PiAgICAgICAgIHZpcnRpb19ncHVfY21kX3N1Ym1pdCh2Z2RldiwgYnVmLCBleGJ1Zi0+c2l6ZSwK
PiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZmcHJpdi0+Y3R4X2lkLCBvdXRfZmVu
Y2UpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmZwcml2LT5jdHhfaWQsIGJ1
Zmxpc3QsIG91dF9mZW5jZSk7Cj4gPgo+ID4gLSAgICAgICB0dG1fZXVfZmVuY2VfYnVmZmVyX29i
amVjdHMoJnRpY2tldCwgJnZhbGlkYXRlX2xpc3QsICZvdXRfZmVuY2UtPmYpOwo+ID4gLQo+ID4g
LSAgICAgICAvKiBmZW5jZSB0aGUgY29tbWFuZCBibyAqLwo+ID4gLSAgICAgICB2aXJ0aW9fZ3B1
X3VucmVmX2xpc3QoJnZhbGlkYXRlX2xpc3QpOwo+ID4gLSAgICAgICBrdmZyZWUoYnVmbGlzdCk7
Cj4gPiArICAgICAgIGlmIChidWZsaXN0KQo+ID4gKyAgICAgICAgICAgICAgIGRybV9nZW1fdW5s
b2NrX3Jlc2VydmF0aW9ucyhidWZsaXN0LT5vYmpzLCBidWZsaXN0LT5uZW50cywKPiA+ICsgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJnRpY2tldCk7Cj4gV2hlbiB2
aXJ0aW9fZ3B1X2NtZF9zdWJtaXQgcHJvZ3Jlc3NlcyByZWFsbHkgZmFzdCwgYnVmbGlzdCBtaWdo
dCBoYXZlCj4gYmVlbiBmcmVlZC4KPgo+ID4gICAgICAgICByZXR1cm4gMDsKPiA+Cj4gPiAgb3V0
X21lbWR1cDoKPiA+ICAgICAgICAga2ZyZWUoYnVmKTsKPiA+ICBvdXRfdW5yZXN2Ogo+ID4gLSAg
ICAgICB0dG1fZXVfYmFja29mZl9yZXNlcnZhdGlvbigmdGlja2V0LCAmdmFsaWRhdGVfbGlzdCk7
Cj4gPiAtb3V0X2ZyZWU6Cj4gPiAtICAgICAgIHZpcnRpb19ncHVfdW5yZWZfbGlzdCgmdmFsaWRh
dGVfbGlzdCk7Cj4gPiArICAgICAgIGlmIChidWZsaXN0KQo+ID4gKyAgICAgICAgICAgICAgIGRy
bV9nZW1fdW5sb2NrX3Jlc2VydmF0aW9ucyhidWZsaXN0LT5vYmpzLCBidWZsaXN0LT5uZW50cywg
JnRpY2tldCk7Cj4gPiAgb3V0X3VudXNlZF9mZDoKPiA+ICAgICAgICAga3ZmcmVlKGJvX2hhbmRs
ZXMpOwo+ID4gLSAgICAgICBrdmZyZWUoYnVmbGlzdCk7Cj4gPiArICAgICAgIGlmIChidWZsaXN0
KQo+ID4gKyAgICAgICAgICAgICAgIHZpcnRpb19ncHVfYXJyYXlfcHV0X2ZyZWUoYnVmbGlzdCk7
Cj4gPgo+ID4gICAgICAgICBpZiAob3V0X2ZlbmNlX2ZkID49IDApCj4gPiAgICAgICAgICAgICAg
ICAgcHV0X3VudXNlZF9mZChvdXRfZmVuY2VfZmQpOwo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jIGIvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0
Z3B1X3ZxLmMKPiA+IGluZGV4IDZjMWE5MDcxNzUzNS4uMGM4N2MzZTA4NmY4IDEwMDY0NAo+ID4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZpcnRpby92aXJ0Z3B1X3ZxLmMKPiA+ICsrKyBiL2RyaXZl
cnMvZ3B1L2RybS92aXJ0aW8vdmlydGdwdV92cS5jCj4gPiBAQCAtMTkxLDcgKzE5MSw3IEBAIHZv
aWQgdmlydGlvX2dwdV9kZXF1ZXVlX2N0cmxfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmsp
Cj4gPiAgICAgICAgIH0gd2hpbGUgKCF2aXJ0cXVldWVfZW5hYmxlX2NiKHZnZGV2LT5jdHJscS52
cSkpOwo+ID4gICAgICAgICBzcGluX3VubG9jaygmdmdkZXYtPmN0cmxxLnFsb2NrKTsKPiA+Cj4g
PiAtICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShlbnRyeSwgdG1wLCAmcmVjbGFpbV9s
aXN0LCBsaXN0KSB7Cj4gPiArICAgICAgIGxpc3RfZm9yX2VhY2hfZW50cnkoZW50cnksICZyZWNs
YWltX2xpc3QsIGxpc3QpIHsKPiA+ICAgICAgICAgICAgICAgICByZXNwID0gKHN0cnVjdCB2aXJ0
aW9fZ3B1X2N0cmxfaGRyICopZW50cnktPnJlc3BfYnVmOwo+ID4KPiA+ICAgICAgICAgICAgICAg
ICB0cmFjZV92aXJ0aW9fZ3B1X2NtZF9yZXNwb25zZSh2Z2Rldi0+Y3RybHEudnEsIHJlc3ApOwo+
ID4gQEAgLTIxOCwxNCArMjE4LDE4IEBAIHZvaWQgdmlydGlvX2dwdV9kZXF1ZXVlX2N0cmxfZnVu
YyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCj4gPiAgICAgICAgICAgICAgICAgfQo+ID4gICAg
ICAgICAgICAgICAgIGlmIChlbnRyeS0+cmVzcF9jYikKPiA+ICAgICAgICAgICAgICAgICAgICAg
ICAgIGVudHJ5LT5yZXNwX2NiKHZnZGV2LCBlbnRyeSk7Cj4gPiAtCj4gPiAtICAgICAgICAgICAg
ICAgbGlzdF9kZWwoJmVudHJ5LT5saXN0KTsKPiA+IC0gICAgICAgICAgICAgICBmcmVlX3ZidWYo
dmdkZXYsIGVudHJ5KTsKPiA+ICAgICAgICAgfQo+ID4gICAgICAgICB3YWtlX3VwKCZ2Z2Rldi0+
Y3RybHEuYWNrX3F1ZXVlKTsKPiA+Cj4gPiAgICAgICAgIGlmIChmZW5jZV9pZCkKPiA+ICAgICAg
ICAgICAgICAgICB2aXJ0aW9fZ3B1X2ZlbmNlX2V2ZW50X3Byb2Nlc3ModmdkZXYsIGZlbmNlX2lk
KTsKPiA+ICsKPiA+ICsgICAgICAgbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGVudHJ5LCB0bXAs
ICZyZWNsYWltX2xpc3QsIGxpc3QpIHsKPiA+ICsgICAgICAgICAgICAgICBpZiAoZW50cnktPm9i
anMpCj4gPiArICAgICAgICAgICAgICAgICAgICAgICB2aXJ0aW9fZ3B1X2FycmF5X3B1dF9mcmVl
KGVudHJ5LT5vYmpzKTsKPiA+ICsgICAgICAgICAgICAgICBsaXN0X2RlbCgmZW50cnktPmxpc3Qp
Owo+ID4gKyAgICAgICAgICAgICAgIGZyZWVfdmJ1Zih2Z2RldiwgZW50cnkpOwo+ID4gKyAgICAg
ICB9Cj4gPiAgfQo+ID4KPiA+ICB2b2lkIHZpcnRpb19ncHVfZGVxdWV1ZV9jdXJzb3JfZnVuYyhz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCj4gPiBAQCAtOTM5LDcgKzk0Myw5IEBAIHZvaWQgdmly
dGlvX2dwdV9jbWRfdHJhbnNmZXJfZnJvbV9ob3N0XzNkKHN0cnVjdCB2aXJ0aW9fZ3B1X2Rldmlj
ZSAqdmdkZXYsCj4gPgo+ID4gIHZvaWQgdmlydGlvX2dwdV9jbWRfc3VibWl0KHN0cnVjdCB2aXJ0
aW9fZ3B1X2RldmljZSAqdmdkZXYsCj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lk
ICpkYXRhLCB1aW50MzJfdCBkYXRhX3NpemUsCj4gPiAtICAgICAgICAgICAgICAgICAgICAgICAg
ICB1aW50MzJfdCBjdHhfaWQsIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5jZSkKPiA+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IGN0eF9pZCwKPiA+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X29iamVjdF9hcnJheSAqb2JqcywKPiA+
ICsgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2ZlbmNlICpmZW5j
ZSkKPiA+ICB7Cj4gPiAgICAgICAgIHN0cnVjdCB2aXJ0aW9fZ3B1X2NtZF9zdWJtaXQgKmNtZF9w
Owo+ID4gICAgICAgICBzdHJ1Y3QgdmlydGlvX2dwdV92YnVmZmVyICp2YnVmOwo+ID4gQEAgLTk0
OSw2ICs5NTUsNyBAQCB2b2lkIHZpcnRpb19ncHVfY21kX3N1Ym1pdChzdHJ1Y3QgdmlydGlvX2dw
dV9kZXZpY2UgKnZnZGV2LAo+ID4KPiA+ICAgICAgICAgdmJ1Zi0+ZGF0YV9idWYgPSBkYXRhOwo+
ID4gICAgICAgICB2YnVmLT5kYXRhX3NpemUgPSBkYXRhX3NpemU7Cj4gPiArICAgICAgIHZidWYt
Pm9ianMgPSBvYmpzOwo+ID4KPiA+ICAgICAgICAgY21kX3AtPmhkci50eXBlID0gY3B1X3RvX2xl
MzIoVklSVElPX0dQVV9DTURfU1VCTUlUXzNEKTsKPiA+ICAgICAgICAgY21kX3AtPmhkci5jdHhf
aWQgPSBjcHVfdG9fbGUzMihjdHhfaWQpOwo+ID4gLS0KPiA+IDIuMTguMQo+ID4KX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcg
bGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
