Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0791A6030F
	for <lists+dri-devel@lfdr.de>; Fri,  5 Jul 2019 11:26:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DB6846E451;
	Fri,  5 Jul 2019 09:26:20 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D7D1B6E029
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 09:26:18 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 37797ADE5;
 Fri,  5 Jul 2019 09:26:17 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, daniel@ffwll.ch, kraxel@redhat.com,
 maarten.lankhorst@linux.intel.com, maxime.ripard@bootlin.com,
 sean@poorly.run, noralf@tronnes.org, sam@ravnborg.org,
 yc_chen@aspeedtech.com
Subject: [PATCH v2 1/6] drm/client: Support unmapping of DRM client buffers
Date: Fri,  5 Jul 2019 11:26:08 +0200
Message-Id: <20190705092613.7621-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190705092613.7621-1-tzimmermann@suse.de>
References: <20190705092613.7621-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 virtualization@lists.linux-foundation.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RFJNIGNsaWVudHMsIHN1Y2ggYXMgdGhlIGZiZGV2IGVtdWxhdGlvbiwgaGF2ZSB0aGVpciBidWZm
ZXIgb2JqZWN0cwptYXBwZWQgYnkgZGVmYXVsdC4gTWFwcGluZyBhIGJ1ZmZlciBpbXBsaWNpdGx5
IHByZXZlbnRzIGl0cyByZWxvY2F0aW9uLgpIZW5jZSwgdGhlIGJ1ZmZlciBtYXkgcGVybWFuZW50
bHkgY29uc3VtZSB2aWRlbyBtZW1vcnkgd2hpbGUgaXQncwphbGxvY2F0ZWQuIFRoaXMgaXMgYSBw
cm9ibGVtIGZvciBkcml2ZXJzIG9mIGxvdy1tZW1vcnkgZGV2aWNlcywgc3VjaCBhcwphc3QsIG1n
YWcyMDAgb3Igb2xkZXIgZnJhbWVidWZmZXIgaGFyZHdhcmUsIHdoaWNoIHdpbGwgdGhlbiBub3Qg
aGF2ZQplbm91Z2ggbWVtb3J5IHRvIGRpc3BsYXkgb3RoZXIgY29udGVudCAoZS5nLiwgWDExKS4K
ClRoaXMgcGF0Y2ggaW50cm9kdWNlcyBkcm1fY2xpZW50X2J1ZmZlcl92bWFwKCkgYW5kIF92dW5t
YXAoKS4gSW50ZXJuYWwKRFJNIGNsaWVudHMgY2FuIHVzZSB0aGVzZSBmdW5jdGlvbnMgdG8gdW5t
YXAgYW5kIHJlbWFwIGJ1ZmZlciBvYmplY3RzCmFzIG5lZWRlZC4KClRoZXJlJ3Mgbm8gcmVmZXJl
bmNlIGNvdW50aW5nIGZvciB2bWFwIG9wZXJhdGlvbnMuIENhbGxlcnMgYXJlIGV4cGVjdGVkCnRv
IGVpdGhlciBrZWVwIGJ1ZmZlcnMgbWFwcGVkIChhcyBpdCBpcyBub3cpLCBvciBjYWxsIHZtYXAg
YW5kIHZ1bm1hcAppbiBwYWlycyBhcm91bmQgY29kZSB0aGF0IGFjY2Vzc2VzIHRoZSBtYXBwZWQg
bWVtb3J5LgoKdjI6CgkqIHJlbW92ZSBzZXZlcmFsIGR1cGxpY2F0ZWQgTlVMTC1wb2ludGVyIGNo
ZWNrcwoKU2lnbmVkLW9mZi1ieTogVGhvbWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1c2Uu
ZGU+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9jbGllbnQuYyB8IDY3ICsrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLQogaW5jbHVkZS9kcm0vZHJtX2NsaWVudC5oICAgICB8ICAz
ICsrCiAyIGZpbGVzIGNoYW5nZWQsIDYwIGluc2VydGlvbnMoKyksIDEwIGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fY2xpZW50LmMgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX2NsaWVudC5jCmluZGV4IDQxMDU3MmYxNDI1Ny4uNjZkOGQ2NDVhYzc5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2NsaWVudC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9k
cm1fY2xpZW50LmMKQEAgLTI4MSw2ICsyODEsNDMgQEAgZHJtX2NsaWVudF9idWZmZXJfY3JlYXRl
KHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50LCB1MzIgd2lkdGgsIHUzMiBoZWlnaHQsIHUK
IAogCWJ1ZmZlci0+Z2VtID0gb2JqOwogCisJdmFkZHIgPSBkcm1fY2xpZW50X2J1ZmZlcl92bWFw
KGJ1ZmZlcik7CisJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJcmV0ID0gUFRSX0VSUih2YWRkcik7
CisJCWdvdG8gZXJyX2RlbGV0ZTsKKwl9CisKKwlyZXR1cm4gYnVmZmVyOworCitlcnJfZGVsZXRl
OgorCWRybV9jbGllbnRfYnVmZmVyX2RlbGV0ZShidWZmZXIpOworCisJcmV0dXJuIEVSUl9QVFIo
cmV0KTsKK30KKworLyoqCisgKiBkcm1fY2xpZW50X2J1ZmZlcl92bWFwIC0gTWFwIERSTSBjbGll
bnQgYnVmZmVyIGludG8gYWRkcmVzcyBzcGFjZQorICogQGJ1ZmZlcjogRFJNIGNsaWVudCBidWZm
ZXIKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIG1hcHMgYSBjbGllbnQgYnVmZmVyIGludG8ga2VybmVs
IGFkZHJlc3Mgc3BhY2UuIElmIHRoZQorICogYnVmZmVyIGlzIGFscmVhZHkgbWFwcGVkLCBpdCBy
ZXR1cm5zIHRoZSBtYXBwaW5nJ3MgYWRkcmVzcy4KKyAqCisgKiBDbGllbnQgYnVmZmVyIG1hcHBp
bmdzIGFyZSBub3QgcmVmJ2NvdW50ZWQuIEVhY2ggY2FsbCB0bworICogZHJtX2NsaWVudF9idWZm
ZXJfdm1hcCgpIHNob3VsZCBiZSBmb2xsb3dlZCBieSBhIGNhbGwgdG8KKyAqIGRybV9jbGllbnRf
YnVmZmVyX3Z1bm1hcCgpOyBvciB0aGUgY2xpZW50IGJ1ZmZlciBzaG91bGQgYmUgbWFwcGVkCisg
KiB0aHJvdWdob3V0IGl0cyBsaWZldGltZS4gVGhlIGxhdHRlciBpcyB0aGUgZGVmYXVsdC4KKyAq
CisgKiBSZXR1cm5zOgorICoJVGhlIG1hcHBlZCBtZW1vcnkncyBhZGRyZXNzCisgKi8KK3ZvaWQg
KgorZHJtX2NsaWVudF9idWZmZXJfdm1hcChzdHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgKmJ1ZmZl
cikKK3sKKwl2b2lkICp2YWRkcjsKKworCWlmIChidWZmZXItPnZhZGRyKQorCQlyZXR1cm4gYnVm
ZmVyLT52YWRkcjsKKwogCS8qCiAJICogRklYTUU6IFRoZSBkZXBlbmRlbmN5IG9uIEdFTSBoZXJl
IGlzbid0IHJlcXVpcmVkLCB3ZSBjb3VsZAogCSAqIGNvbnZlcnQgdGhlIGRyaXZlciBoYW5kbGUg
dG8gYSBkbWEtYnVmIGluc3RlYWQgYW5kIHVzZSB0aGUKQEAgLTI4OSwyMSArMzI2LDMxIEBAIGRy
bV9jbGllbnRfYnVmZmVyX2NyZWF0ZShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCwgdTMy
IHdpZHRoLCB1MzIgaGVpZ2h0LCB1CiAJICogZmRfaW5zdGFsbCBzdGVwIG91dCBvZiB0aGUgZHJp
dmVyIGJhY2tlbmQgaG9va3MsIHRvIG1ha2UgdGhhdAogCSAqIGZpbmFsIHN0ZXAgb3B0aW9uYWwg
Zm9yIGludGVybmFsIHVzZXJzLgogCSAqLwotCXZhZGRyID0gZHJtX2dlbV92bWFwKG9iaik7Ci0J
aWYgKElTX0VSUih2YWRkcikpIHsKLQkJcmV0ID0gUFRSX0VSUih2YWRkcik7Ci0JCWdvdG8gZXJy
X2RlbGV0ZTsKLQl9CisJdmFkZHIgPSBkcm1fZ2VtX3ZtYXAoYnVmZmVyLT5nZW0pOworCWlmIChJ
U19FUlIodmFkZHIpKQorCQlyZXR1cm4gdmFkZHI7CiAKIAlidWZmZXItPnZhZGRyID0gdmFkZHI7
CiAKLQlyZXR1cm4gYnVmZmVyOwotCi1lcnJfZGVsZXRlOgotCWRybV9jbGllbnRfYnVmZmVyX2Rl
bGV0ZShidWZmZXIpOworCXJldHVybiB2YWRkcjsKK30KK0VYUE9SVF9TWU1CT0woZHJtX2NsaWVu
dF9idWZmZXJfdm1hcCk7CiAKLQlyZXR1cm4gRVJSX1BUUihyZXQpOworLyoqCisgKiBkcm1fY2xp
ZW50X2J1ZmZlcl92dW5tYXAgLSBVbm1hcCBEUk0gY2xpZW50IGJ1ZmZlcgorICogQGJ1ZmZlcjog
RFJNIGNsaWVudCBidWZmZXIKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHJlbW92ZXMgYSBjbGllbnQg
YnVmZmVyJ3MgbWVtb3J5IG1tYXBwaW5nLiBUaGlzCisgKiBmdW5jdGlvbiBpcyBvbmx5IHJlcXVp
cmVkIGJ5IGNsaWVudHMgdGhhdCBtYW5hZ2UgdGhlaXIgYnVmZmVycworICogYnkgdGhlbXNlbHZl
cy4gQnkgZGVmYXVsdCwgRFJNIGNsaWVudCBidWZmZXJzIGFyZSBtYXBwZWQgdGhyb3VnaG91dAor
ICogdGhlaXIgZW50aXJlIGxpZmV0aW1lLgorICovCit2b2lkIGRybV9jbGllbnRfYnVmZmVyX3Z1
bm1hcChzdHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgKmJ1ZmZlcikKK3sKKwlkcm1fZ2VtX3Z1bm1h
cChidWZmZXItPmdlbSwgYnVmZmVyLT52YWRkcik7CisJYnVmZmVyLT52YWRkciA9IE5VTEw7CiB9
CitFWFBPUlRfU1lNQk9MKGRybV9jbGllbnRfYnVmZmVyX3Z1bm1hcCk7CiAKIHN0YXRpYyB2b2lk
IGRybV9jbGllbnRfYnVmZmVyX3JtZmIoc3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIp
CiB7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmggYi9pbmNsdWRlL2RybS9k
cm1fY2xpZW50LmgKaW5kZXggNzJkNTFkMWU5ZGQ5Li5lMWRiMWQ5ZGEwYmYgMTAwNjQ0Ci0tLSBh
L2luY2x1ZGUvZHJtL2RybV9jbGllbnQuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fY2xpZW50LmgK
QEAgLTE0OSw2ICsxNDksOSBAQCBzdHJ1Y3QgZHJtX2NsaWVudF9idWZmZXIgewogc3RydWN0IGRy
bV9jbGllbnRfYnVmZmVyICoKIGRybV9jbGllbnRfZnJhbWVidWZmZXJfY3JlYXRlKHN0cnVjdCBk
cm1fY2xpZW50X2RldiAqY2xpZW50LCB1MzIgd2lkdGgsIHUzMiBoZWlnaHQsIHUzMiBmb3JtYXQp
Owogdm9pZCBkcm1fY2xpZW50X2ZyYW1lYnVmZmVyX2RlbGV0ZShzdHJ1Y3QgZHJtX2NsaWVudF9i
dWZmZXIgKmJ1ZmZlcik7Cit2b2lkICoKK2RybV9jbGllbnRfYnVmZmVyX3ZtYXAoc3RydWN0IGRy
bV9jbGllbnRfYnVmZmVyICpidWZmZXIpOwordm9pZCBkcm1fY2xpZW50X2J1ZmZlcl92dW5tYXAo
c3RydWN0IGRybV9jbGllbnRfYnVmZmVyICpidWZmZXIpOwogCiBpbnQgZHJtX2NsaWVudF9tb2Rl
c2V0X2NyZWF0ZShzdHJ1Y3QgZHJtX2NsaWVudF9kZXYgKmNsaWVudCk7CiB2b2lkIGRybV9jbGll
bnRfbW9kZXNldF9mcmVlKHN0cnVjdCBkcm1fY2xpZW50X2RldiAqY2xpZW50KTsKLS0gCjIuMjEu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRl
dmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
