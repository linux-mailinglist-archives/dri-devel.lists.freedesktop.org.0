Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2A535F3088
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 14:52:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 92D0C6F69E;
	Thu,  7 Nov 2019 13:52:31 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from verein.lst.de (verein.lst.de [213.95.11.211])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 796C16F69E
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 13:52:22 +0000 (UTC)
Received: by verein.lst.de (Postfix, from userid 2005)
 id 590D968BFE; Thu,  7 Nov 2019 14:52:20 +0100 (CET)
In-Reply-To: <20191107135018.0A04068BE1@verein.lst.de>
References: <20191107135018.0A04068BE1@verein.lst.de>
From: Torsten Duwe <duwe@lst.de>
Date: Tue, 29 Oct 2019 13:16:57 +0100
Subject: [PATCH v5 5/7] drm/bridge: Add Analogix anx6345 support
To: Maxime Ripard <mripard@kernel.org>, Chen-Yu Tsai <wens@csie.org>,
 Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 David Airlie <airlied@linux.ie>, Daniel Vetter <daniel@ffwll.ch>,
 Andrzej Hajda <a.hajda@samsung.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>,
 Icenowy Zheng <icenowy@aosc.io>, Sean Paul <seanpaul@chromium.org>,
 Vasily Khoruzhick <anarsoul@gmail.com>, Harald Geyer <harald@ccbib.org>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Thomas Gleixner <tglx@linutronix.de>
Message-Id: <20191107135220.590D968BFE@verein.lst.de>
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-arm-kernel@lists.infradead.org,
 dri-devel@lists.freedesktop.org, linux-kernel@vger.kernel.org
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlvPgoKVGhlIEFOWDYzNDUgaXMgYW4g
dWx0cmEtbG93IHBvd2VyIERpc3BsYXlQb3dlci9lRFAgdHJhbnNtaXR0ZXIgZGVzaWduZWQKZm9y
IHBvcnRhYmxlIGRldmljZXMuIFRoaXMgZHJpdmVyIGFkZHMgaW5pdGlhbCBzdXBwb3J0IGZvciBS
R0IgdG8gZURQCm1vZGUsIHdpdGhvdXQgSFBEIGFuZCBpbnRlcnJ1cHRzLgoKVGhpcyBpcyBhIGNv
bmZpZ3VyYXRpb24gdXN1YWxseSBzZWVuIGluIGVEUCBhcHBsaWNhdGlvbnMuCgpTaWduZWQtb2Zm
LWJ5OiBJY2Vub3d5IFpoZW5nIDxpY2Vub3d5QGFvc2MuaW8+ClNpZ25lZC1vZmYtYnk6IFZhc2ls
eSBLaG9ydXpoaWNrIDxhbmFyc291bEBnbWFpbC5jb20+ClNpZ25lZC1vZmYtYnk6IFRvcnN0ZW4g
RHV3ZSA8ZHV3ZUBzdXNlLmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgv
S2NvbmZpZyAgICAgICAgICAgIHwgIDEyICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9n
aXgvTWFrZWZpbGUgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9icmlkZ2UvYW5h
bG9naXgvYW5hbG9naXgtYW54NjM0NS5jIHwgNzkzICsrKysrKysrKysrKysrKysrKysrKwogMyBm
aWxlcyBjaGFuZ2VkLCA4MDYgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54NjM0NS5jCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnIGIvZHJpdmVycy9ncHUv
ZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnCmluZGV4IDI5YmExYjIxMDE5ZS4uMTQyNWE5NmEy
OGMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L0tjb25maWcK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9LY29uZmlnCkBAIC0xLDYgKzEs
MTggQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seQorY29uZmlnIERS
TV9BTkFMT0dJWF9BTlg2MzQ1CisJdHJpc3RhdGUgIkFuYWxvZ2l4IEFOWDYzNDUgYnJpZGdlIgor
CXNlbGVjdCBEUk1fQU5BTE9HSVhfRFAKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwlzZWxlY3Qg
UkVHTUFQX0kyQworCWhlbHAKKwkgIEFOWDYzNDUgaXMgYW4gdWx0cmEtbG93IEZ1bGwtSEQgRGlz
cGxheVBvcnQvZURQCisJICB0cmFuc21pdHRlciBkZXNpZ25lZCBmb3IgcG9ydGFibGUgZGV2aWNl
cy4gVGhlCisJICBBTlg2MzQ1IHRyYW5zZm9ybXMgdGhlIExWVFRMIFJHQiBvdXRwdXQgb2YgYW4K
KwkgIGFwcGxpY2F0aW9uIHByb2Nlc3NvciB0byBlRFAgb3IgRGlzcGxheVBvcnQuCisKIGNvbmZp
ZyBEUk1fQU5BTE9HSVhfQU5YNzhYWAogCXRyaXN0YXRlICJBbmFsb2dpeCBBTlg3OFhYIGJyaWRn
ZSIKKwlzZWxlY3QgRFJNX0FOQUxPR0lYX0RQCiAJc2VsZWN0IERSTV9LTVNfSEVMUEVSCiAJc2Vs
ZWN0IFJFR01BUF9JMkMKIAloZWxwCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYnJpZGdl
L2FuYWxvZ2l4L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtl
ZmlsZQppbmRleCA3NjIzYjliODAxNjcuLjk3NjY5YjM3NDA5OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0v
YnJpZGdlL2FuYWxvZ2l4L01ha2VmaWxlCkBAIC0xLDQgKzEsNSBAQAogIyBTUERYLUxpY2Vuc2Ut
SWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CiBhbmFsb2dpeF9kcC1vYmpzIDo9IGFuYWxvZ2l4X2Rw
X2NvcmUubyBhbmFsb2dpeF9kcF9yZWcubyBhbmFsb2dpeC1pMmMtZHB0eC5vCitvYmotJChDT05G
SUdfRFJNX0FOQUxPR0lYX0FOWDYzNDUpICs9IGFuYWxvZ2l4LWFueDYzNDUubwogb2JqLSQoQ09O
RklHX0RSTV9BTkFMT0dJWF9BTlg3OFhYKSArPSBhbmFsb2dpeC1hbng3OHh4Lm8KIG9iai0kKENP
TkZJR19EUk1fQU5BTE9HSVhfRFApICs9IGFuYWxvZ2l4X2RwLm8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9icmlkZ2UvYW5hbG9naXgvYW5hbG9naXgtYW54NjM0NS5jIGIvZHJpdmVycy9n
cHUvZHJtL2JyaWRnZS9hbmFsb2dpeC9hbmFsb2dpeC1hbng2MzQ1LmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hZjA5YTYxZWI0NzIKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vYnJpZGdlL2FuYWxvZ2l4L2FuYWxvZ2l4LWFueDYzNDUuYwpAQCAt
MCwwICsxLDc5MyBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seSAq
LworLyoKKyAqIENvcHlyaWdodChjKSAyMDE2LCBBbmFsb2dpeCBTZW1pY29uZHVjdG9yLgorICog
Q29weXJpZ2h0KGMpIDIwMTcsIEljZW5vd3kgWmhlbmcgPGljZW5vd3lAYW9zYy5pbz4KKyAqCisg
KiBCYXNlZCBvbiBhbng3ODA4IGRyaXZlciBvYnRhaW5lZCBmcm9tIGNocm9tZW9zIHdpdGggY29w
eXJpZ2h0OgorICogQ29weXJpZ2h0KGMpIDIwMTMsIEdvb2dsZSBJbmMuCisgKi8KKyNpbmNsdWRl
IDxsaW51eC9kZWxheS5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgorI2luY2x1ZGUgPGxpbnV4
L2dwaW8vY29uc3VtZXIuaD4KKyNpbmNsdWRlIDxsaW51eC9pMmMuaD4KKyNpbmNsdWRlIDxsaW51
eC9pbnRlcnJ1cHQuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51
eC9tb2R1bGUuaD4KKyNpbmNsdWRlIDxsaW51eC9vZl9wbGF0Zm9ybS5oPgorI2luY2x1ZGUgPGxp
bnV4L3JlZ21hcC5oPgorI2luY2x1ZGUgPGxpbnV4L3JlZ3VsYXRvci9jb25zdW1lci5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2NydGNfaGVs
cGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcF9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJt
X2VkaWQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX29mLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wYW5l
bC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3Byb2Jl
X2hlbHBlci5oPgorCisjaW5jbHVkZSAiYW5hbG9naXgtaTJjLWRwdHguaCIKKyNpbmNsdWRlICJh
bmFsb2dpeC1pMmMtdHhjb21tb24uaCIKKworI2RlZmluZSBQT0xMX0RFTEFZCQk1MDAwMCAvKiB1
cyAqLworI2RlZmluZSBQT0xMX1RJTUVPVVQJCTUwMDAwMDAgLyogdXMgKi8KKworI2RlZmluZSBJ
MkNfSURYX0RQVFgJCTAKKyNkZWZpbmUgSTJDX0lEWF9UWENPTQkJMQorCitzdGF0aWMgY29uc3Qg
dTggYW54NjM0NV9pMmNfYWRkcmVzc2VzW10gPSB7CisJW0kyQ19JRFhfRFBUWF0JPSAweDcwLAor
CVtJMkNfSURYX1RYQ09NXQk9IDB4NzIsCit9OworI2RlZmluZSBJMkNfTlVNX0FERFJFU1NFUwlB
UlJBWV9TSVpFKGFueDYzNDVfaTJjX2FkZHJlc3NlcykKKworc3RydWN0IGFueDYzNDUgeworCXN0
cnVjdCBkcm1fZHBfYXV4IGF1eDsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSBicmlkZ2U7CisJc3RydWN0
IGkyY19jbGllbnQgKmNsaWVudDsKKwlzdHJ1Y3QgZWRpZCAqZWRpZDsKKwlzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciBjb25uZWN0b3I7CisJc3RydWN0IGRybV9kcF9saW5rIGxpbms7CisJc3RydWN0IGRy
bV9wYW5lbCAqcGFuZWw7CisJc3RydWN0IHJlZ3VsYXRvciAqZHZkZDEyOworCXN0cnVjdCByZWd1
bGF0b3IgKmR2ZGQyNTsKKwlzdHJ1Y3QgZ3Bpb19kZXNjICpncGlvZF9yZXNldDsKKwlzdHJ1Y3Qg
bXV0ZXggbG9jazsJLyogcHJvdGVjdCBFRElEIGFjY2VzcyAqLworCisJLyogSTJDIFNsYXZlIGFk
ZHJlc3NlcyBvZiBBTlg2MzQ1IGFyZSBtYXBwZWQgYXMgRFBUWCBhbmQgU1lTICovCisJc3RydWN0
IGkyY19jbGllbnQgKmkyY19jbGllbnRzW0kyQ19OVU1fQUREUkVTU0VTXTsKKwlzdHJ1Y3QgcmVn
bWFwICptYXBbSTJDX05VTV9BRERSRVNTRVNdOworCisJdTE2IGNoaXBpZDsKKwl1OCBkcGNkW0RQ
X1JFQ0VJVkVSX0NBUF9TSVpFXTsKKworCWJvb2wgcG93ZXJlZDsKK307CisKK3N0YXRpYyBpbmxp
bmUgc3RydWN0IGFueDYzNDUgKmNvbm5lY3Rvcl90b19hbng2MzQ1KHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjKQoreworCXJldHVybiBjb250YWluZXJfb2YoYywgc3RydWN0IGFueDYzNDUsIGNvbm5l
Y3Rvcik7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGFueDYzNDUgKmJyaWRnZV90b19hbng2
MzQ1KHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihi
cmlkZ2UsIHN0cnVjdCBhbng2MzQ1LCBicmlkZ2UpOworfQorCitzdGF0aWMgaW50IGFueDYzNDVf
c2V0X2JpdHMoc3RydWN0IHJlZ21hcCAqbWFwLCB1OCByZWcsIHU4IG1hc2spCit7CisJcmV0dXJu
IHJlZ21hcF91cGRhdGVfYml0cyhtYXAsIHJlZywgbWFzaywgbWFzayk7Cit9CisKK3N0YXRpYyBp
bnQgYW54NjM0NV9jbGVhcl9iaXRzKHN0cnVjdCByZWdtYXAgKm1hcCwgdTggcmVnLCB1OCBtYXNr
KQoreworCXJldHVybiByZWdtYXBfdXBkYXRlX2JpdHMobWFwLCByZWcsIG1hc2ssIDApOworfQor
CitzdGF0aWMgc3NpemVfdCBhbng2MzQ1X2F1eF90cmFuc2ZlcihzdHJ1Y3QgZHJtX2RwX2F1eCAq
YXV4LAorCQkJCSAgICBzdHJ1Y3QgZHJtX2RwX2F1eF9tc2cgKm1zZykKK3sKKwlzdHJ1Y3QgYW54
NjM0NSAqYW54NjM0NSA9IGNvbnRhaW5lcl9vZihhdXgsIHN0cnVjdCBhbng2MzQ1LCBhdXgpOwor
CisJcmV0dXJuIGFueF9kcF9hdXhfdHJhbnNmZXIoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0s
IG1zZyk7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9kcF9saW5rX3RyYWluaW5nKHN0cnVjdCBh
bng2MzQ1ICphbng2MzQ1KQoreworCXVuc2lnbmVkIGludCB2YWx1ZTsKKwl1OCBkcF9idzsKKwlp
bnQgZXJyOworCisJZXJyID0gYW54NjM0NV9jbGVhcl9iaXRzKGFueDYzNDUtPm1hcFtJMkNfSURY
X1RYQ09NXSwKKwkJCQkgU1BfUE9XRVJET1dOX0NUUkxfUkVHLAorCQkJCSBTUF9UT1RBTF9QRCk7
CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGRybV9kcF9kcGNkX3JlYWRiKCZh
bng2MzQ1LT5hdXgsIERQX01BWF9MSU5LX1JBVEUsICZkcF9idyk7CisJaWYgKGVyciA8IDApCisJ
CXJldHVybiBlcnI7CisKKwlzd2l0Y2ggKGRwX2J3KSB7CisJY2FzZSBEUF9MSU5LX0JXXzFfNjI6
CisJY2FzZSBEUF9MSU5LX0JXXzJfNzoKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQlEUk1fREVC
VUdfS01TKCJEUCBiYW5kd2lkdGggKCUjMDJ4KSBub3Qgc3VwcG9ydGVkXG4iLCBkcF9idyk7CisJ
CXJldHVybiAtRUlOVkFMOworCX0KKworCWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+
bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9WSURfQ1RSTDFfUkVHLAorCQkJICAgICAgIFNQX1ZJREVP
X01VVEUpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBhbng2MzQ1X2NsZWFy
X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLAorCQkJCSBTUF9WSURfQ1RSTDFfUkVH
LCBTUF9WSURFT19FTik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qIEdldCBEUENE
IGluZm8gKi8KKwllcnIgPSBkcm1fZHBfZHBjZF9yZWFkKCZhbng2MzQ1LT5hdXgsIERQX0RQQ0Rf
UkVWLAorCQkJICAgICAgICZhbng2MzQ1LT5kcGNkLCBEUF9SRUNFSVZFUl9DQVBfU0laRSk7CisJ
aWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVhZCBEUENEOiAlZFxuIiwg
ZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwkvKiBDbGVhciBjaGFubmVsIHggU0VSREVTIHBv
d2VyIGRvd24gKi8KKwllcnIgPSBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19J
RFhfRFBUWF0sCisJCQkJIFNQX0RQX0FOQUxPR19QT1dFUl9ET1dOX1JFRywgU1BfQ0gwX1BEKTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogQ2hlY2sgbGluayBjYXBhYmlsaXRpZXMg
Ki8KKwllcnIgPSBkcm1fZHBfbGlua19wcm9iZSgmYW54NjM0NS0+YXV4LCAmYW54NjM0NS0+bGlu
ayk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcHJvYmUgbGluayBj
YXBhYmlsaXRpZXM6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFBvd2Vy
IHVwIHRoZSBzaW5rICovCisJZXJyID0gZHJtX2RwX2xpbmtfcG93ZXJfdXAoJmFueDYzNDUtPmF1
eCwgJmFueDYzNDUtPmxpbmspOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9FUlJPUigiRmFpbGVk
IHRvIHBvd2VyIHVwIERpc3BsYXlQb3J0IGxpbms6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJy
OworCX0KKworCS8qIFBvc3NpYmx5IGVuYWJsZSBkb3duc3ByZWFkIG9uIHRoZSBzaW5rICovCisJ
ZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJICAgU1Bf
RFBfRE9XTlNQUkVBRF9DVFJMMV9SRUcsIDApOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisK
KwlpZiAoYW54NjM0NS0+ZHBjZFtEUF9NQVhfRE9XTlNQUkVBRF0gJiBEUF9NQVhfRE9XTlNQUkVB
RF8wXzUpIHsKKwkJRFJNX0RFQlVHKCJFbmFibGUgZG93bnNwcmVhZCBvbiB0aGUgc2lua1xuIik7
CisJCS8qIDQwMDBQUE0gKi8KKwkJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNf
SURYX0RQVFhdLAorCQkJCSAgIFNQX0RQX0RPV05TUFJFQURfQ1RSTDFfUkVHLCA4KTsKKwkJaWYg
KGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJZXJyID0gZHJtX2RwX2RwY2Rfd3JpdGViKCZhbng2
MzQ1LT5hdXgsIERQX0RPV05TUFJFQURfQ1RSTCwKKwkJCQkJIERQX1NQUkVBRF9BTVBfMF81KTsK
KwkJaWYgKGVyciA8IDApCisJCQlyZXR1cm4gZXJyOworCX0gZWxzZSB7CisJCWVyciA9IGRybV9k
cF9kcGNkX3dyaXRlYigmYW54NjM0NS0+YXV4LCBEUF9ET1dOU1BSRUFEX0NUUkwsIDApOworCQlp
ZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7CisJfQorCisJLyogU2V0IHRoZSBsYW5lIGNvdW50
IGFuZCB0aGUgbGluayByYXRlIG9uIHRoZSBzaW5rICovCisJaWYgKGRybV9kcF9lbmhhbmNlZF9m
cmFtZV9jYXAoYW54NjM0NS0+ZHBjZCkpCisJCWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0
NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkJICAgICAgIFNQX0RQX1NZU1RFTV9DVFJMX0JBU0Ug
KyA0LAorCQkJCSAgICAgICBTUF9FTkhBTkNFRF9NT0RFKTsKKwllbHNlCisJCWVyciA9IGFueDYz
NDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJCQkJIFNQX0RQX1NZ
U1RFTV9DVFJMX0JBU0UgKyA0LAorCQkJCQkgU1BfRU5IQU5DRURfTU9ERSk7CisJaWYgKGVycikK
KwkJcmV0dXJuIGVycjsKKworCXZhbHVlID0gZHJtX2RwX2xpbmtfcmF0ZV90b19id19jb2RlKGFu
eDYzNDUtPmxpbmsucmF0ZSk7CisJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1hcFtJMkNf
SURYX0RQVFhdLAorCQkJICAgU1BfRFBfTUFJTl9MSU5LX0JXX1NFVF9SRUcsIHZhbHVlKTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gcmVnbWFwX3dyaXRlKGFueDYzNDUtPm1h
cFtJMkNfSURYX0RQVFhdLAorCQkJICAgU1BfRFBfTEFORV9DT1VOVF9TRVRfUkVHLCBhbng2MzQ1
LT5saW5rLm51bV9sYW5lcyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGRy
bV9kcF9saW5rX2NvbmZpZ3VyZSgmYW54NjM0NS0+YXV4LCAmYW54NjM0NS0+bGluayk7CisJaWYg
KGVyciA8IDApIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gY29uZmlndXJlIERpc3BsYXlQb3J0
IGxpbms6ICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFN0YXJ0IHRyYWlu
aW5nIG9uIHRoZSBzb3VyY2UgKi8KKwllcnIgPSByZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0ky
Q19JRFhfRFBUWF0sIFNQX0RQX0xUX0NUUkxfUkVHLAorCQkJICAgU1BfTFRfRU4pOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gcmVnbWFwX3JlYWRfcG9sbF90aW1lb3V0KGFu
eDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJCSAgICAgICBTUF9EUF9MVF9DVFJMX1JFRywK
KwkJCQkgICAgICAgdmFsdWUsICEodmFsdWUgJiBTUF9EUF9MVF9JTlBST0dSRVNTKSwKKwkJCQkg
ICAgICAgUE9MTF9ERUxBWSwgUE9MTF9USU1FT1VUKTsKK30KKworc3RhdGljIGludCBhbng2MzQ1
X3R4X2luaXRpYWxpemF0aW9uKHN0cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCWludCBlcnIs
IGk7CisKKwkvKiBGSVhNRTogY29sb3JkZXB0aCBpcyBoYXJkY29kZWQgZm9yIG5vdyAqLworCWVy
ciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQX1ZJRF9DVFJM
Ml9SRUcsCisJCQkgICBTUF9JTl9CUENfNkJJVCA8PCBTUF9JTl9CUENfU0hJRlQpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSByZWdtYXBfd3JpdGUoYW54NjM0NS0+bWFwW0ky
Q19JRFhfRFBUWF0sIFNQX0RQX1BMTF9DVFJMX1JFRywgMCk7CisJaWYgKGVycikKKwkJcmV0dXJu
IGVycjsKKworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0s
CisJCQkgICBTUF9BTkFMT0dfREVCVUcxX1JFRywgMCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVy
cjsKKworCWVyciA9IHJlZ21hcF93cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJ
CSAgIFNQX0RQX0xJTktfREVCVUdfQ1RSTF9SRUcsCisJCQkgICBTUF9ORVdfUFJCUzcgfCBTUF9N
X1ZJRF9ERUJVRyk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IHJlZ21hcF93
cml0ZShhbng2MzQ1LT5tYXBbSTJDX0lEWF9EUFRYXSwKKwkJCSAgIFNQX0RQX0FOQUxPR19QT1dF
Ul9ET1dOX1JFRywgMCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qIEZvcmNlIEhQ
RCAqLworCWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0s
CisJCQkgICAgICAgU1BfRFBfU1lTVEVNX0NUUkxfQkFTRSArIDMsCisJCQkgICAgICAgU1BfSFBE
X0ZPUkNFIHwgU1BfSFBEX0NUUkwpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgNDsgaSsrKSB7CisJCS8qIDQgbGFuZXMgKi8KKwkJZXJyID0gcmVnbWFwX3dy
aXRlKGFueDYzNDUtPm1hcFtJMkNfSURYX0RQVFhdLAorCQkJCSAgIFNQX0RQX0xBTkUwX0xUX0NU
UkxfUkVHICsgaSwgMCk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFJl
c2V0IEFVWCAqLworCWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhf
VFhDT01dLAorCQkJICAgICAgIFNQX1JFU0VUX0NUUkwyX1JFRywgU1BfQVVYX1JTVCk7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKKworCXJldHVybiBhbng2MzQ1X2NsZWFyX2JpdHMoYW54NjM0
NS0+bWFwW0kyQ19JRFhfVFhDT01dLAorCQkJCSBTUF9SRVNFVF9DVFJMMl9SRUcsIFNQX0FVWF9S
U1QpOworfQorCitzdGF0aWMgdm9pZCBhbng2MzQ1X3Bvd2Vyb24oc3RydWN0IGFueDYzNDUgKmFu
eDYzNDUpCit7CisJaW50IGVycjsKKworCS8qIEVuc3VyZSByZXNldCBpcyBhc3NlcnRlZCBiZWZv
cmUgc3RhcnRpbmcgcG93ZXIgb24gc2VxdWVuY2UgKi8KKwlncGlvZF9zZXRfdmFsdWVfY2Fuc2xl
ZXAoYW54NjM0NS0+Z3Bpb2RfcmVzZXQsIDEpOworCXVzbGVlcF9yYW5nZSgxMDAwLCAyMDAwKTsK
KworCWVyciA9IHJlZ3VsYXRvcl9lbmFibGUoYW54NjM0NS0+ZHZkZDEyKTsKKwlpZiAoZXJyKSB7
CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGVuYWJsZSBkdmRkMTIgcmVndWxhdG9yOiAlZFxuIiwK
KwkJCSAgZXJyKTsKKwkJcmV0dXJuOworCX0KKworCS8qIFQxIC0gZGVsYXkgYmV0d2VlbiBWREQx
MiBhbmQgVkREMjUgc2hvdWxkIGJlIDAtMm1zICovCisJdXNsZWVwX3JhbmdlKDEwMDAsIDIwMDAp
OworCisJZXJyID0gcmVndWxhdG9yX2VuYWJsZShhbng2MzQ1LT5kdmRkMjUpOworCWlmIChlcnIp
IHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gZW5hYmxlIGR2ZGQyNSByZWd1bGF0b3I6ICVkXG4i
LAorCQkJICBlcnIpOworCQlyZXR1cm47CisJfQorCisJLyogVDIgLSBkZWxheSBiZXR3ZWVuIFJF
U0VUTiBhbmQgYWxsIHBvd2VyIHJhaWwgc3RhYmxlLAorCSAqIHNob3VsZCBiZSAyLTVtcworCSAq
LworCXVzbGVlcF9yYW5nZSgyMDAwLCA1MDAwKTsKKworCWdwaW9kX3NldF92YWx1ZV9jYW5zbGVl
cChhbng2MzQ1LT5ncGlvZF9yZXNldCwgMCk7CisKKwkvKiBQb3dlciBvbiByZWdpc3RlcnMgbW9k
dWxlICovCisJYW54NjM0NV9zZXRfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQ
X1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCSBTUF9IRENQX1BEIHwgU1BfQVVESU9fUEQgfCBTUF9W
SURFT19QRCB8IFNQX0xJTktfUEQpOworCWFueDYzNDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBb
STJDX0lEWF9UWENPTV0sIFNQX1BPV0VSRE9XTl9DVFJMX1JFRywKKwkJCSAgIFNQX1JFR0lTVEVS
X1BEIHwgU1BfVE9UQUxfUEQpOworCisJaWYgKGFueDYzNDUtPnBhbmVsKQorCQlkcm1fcGFuZWxf
cHJlcGFyZShhbng2MzQ1LT5wYW5lbCk7CisKKwlhbng2MzQ1LT5wb3dlcmVkID0gdHJ1ZTsKK30K
Kworc3RhdGljIHZvaWQgYW54NjM0NV9wb3dlcm9mZihzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkK
K3sKKwlpbnQgZXJyOworCisJZ3Bpb2Rfc2V0X3ZhbHVlX2NhbnNsZWVwKGFueDYzNDUtPmdwaW9k
X3Jlc2V0LCAxKTsKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisKKwlpZiAoYW54NjM0NS0+
cGFuZWwpCisJCWRybV9wYW5lbF91bnByZXBhcmUoYW54NjM0NS0+cGFuZWwpOworCisJZXJyID0g
cmVndWxhdG9yX2Rpc2FibGUoYW54NjM0NS0+ZHZkZDI1KTsKKwlpZiAoZXJyKSB7CisJCURSTV9F
UlJPUigiRmFpbGVkIHRvIGRpc2FibGUgZHZkZDI1IHJlZ3VsYXRvcjogJWRcbiIsCisJCQkgIGVy
cik7CisJCXJldHVybjsKKwl9CisKKwl1c2xlZXBfcmFuZ2UoNTAwMCwgMTAwMDApOworCisJZXJy
ID0gcmVndWxhdG9yX2Rpc2FibGUoYW54NjM0NS0+ZHZkZDEyKTsKKwlpZiAoZXJyKSB7CisJCURS
TV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUgZHZkZDEyIHJlZ3VsYXRvcjogJWRcbiIsCisJCQkg
IGVycik7CisJCXJldHVybjsKKwl9CisKKwl1c2xlZXBfcmFuZ2UoMTAwMCwgMjAwMCk7CisKKwlh
bng2MzQ1LT5wb3dlcmVkID0gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9zdGFydChz
dHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkKK3sKKwlpbnQgZXJyOworCisJaWYgKCFhbng2MzQ1LT5w
b3dlcmVkKQorCQlhbng2MzQ1X3Bvd2Vyb24oYW54NjM0NSk7CisKKwkvKiBQb3dlciBvbiBuZWVk
ZWQgbW9kdWxlcyAqLworCWVyciA9IGFueDYzNDVfY2xlYXJfYml0cyhhbng2MzQ1LT5tYXBbSTJD
X0lEWF9UWENPTV0sCisJCQkJU1BfUE9XRVJET1dOX0NUUkxfUkVHLAorCQkJCVNQX1ZJREVPX1BE
IHwgU1BfTElOS19QRCk7CisKKwllcnIgPSBhbng2MzQ1X3R4X2luaXRpYWxpemF0aW9uKGFueDYz
NDUpOworCWlmIChlcnIpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgZURQIHRyYW5zbWl0dGVyIGlu
aXRpYWxpemF0aW9uOiAlZFxuIiwgZXJyKTsKKwkJYW54NjM0NV9wb3dlcm9mZihhbng2MzQ1KTsK
KwkJcmV0dXJuIGVycjsKKwl9CisKKwllcnIgPSBhbng2MzQ1X2RwX2xpbmtfdHJhaW5pbmcoYW54
NjM0NSk7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxlZCBsaW5rIHRyYWluaW5nOiAl
ZFxuIiwgZXJyKTsKKwkJYW54NjM0NV9wb3dlcm9mZihhbng2MzQ1KTsKKwkJcmV0dXJuIGVycjsK
Kwl9CisKKwkvKgorCSAqIFRoaXMgZGVsYXkgc2VlbXMgdG8gaGVscCBrZWVwIHRoZSBoYXJkd2Fy
ZSBpbiBhIGdvb2Qgc3RhdGUuIFdpdGhvdXQKKwkgKiBpdCwgdGhlcmUgYXJlIHRpbWVzIHdoZXJl
IGl0IGZhaWxzIHNpbGVudGx5LgorCSAqLworCXVzbGVlcF9yYW5nZSgxMDAwMCwgMTUwMDApOwor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9jb25maWdfZHBfb3V0cHV0KHN0
cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCWludCBlcnI7CisKKwllcnIgPSBhbng2MzQ1X2Ns
ZWFyX2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9WSURfQ1RSTDFfUkVHLAor
CQkJCSBTUF9WSURFT19NVVRFKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogRW5h
YmxlIERQIG91dHB1dCAqLworCWVyciA9IGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0ky
Q19JRFhfVFhDT01dLCBTUF9WSURfQ1RSTDFfUkVHLAorCQkJICAgICAgIFNQX1ZJREVPX0VOKTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogRm9yY2Ugc3RyZWFtIHZhbGlkICovCisJ
cmV0dXJuIGFueDYzNDVfc2V0X2JpdHMoYW54NjM0NS0+bWFwW0kyQ19JRFhfRFBUWF0sCisJCQkg
ICAgICAgU1BfRFBfU1lTVEVNX0NUUkxfQkFTRSArIDMsCisJCQkgICAgICAgU1BfU1RSTV9GT1JD
RSB8IFNQX1NUUk1fQ1RSTCk7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9nZXRfZG93bnN0cmVh
bV9pbmZvKHN0cnVjdCBhbng2MzQ1ICphbng2MzQ1KQoreworCXU4IHZhbHVlOworCWludCBlcnI7
CisKKwllcnIgPSBkcm1fZHBfZHBjZF9yZWFkYigmYW54NjM0NS0+YXV4LCBEUF9TSU5LX0NPVU5U
LCAmdmFsdWUpOworCWlmIChlcnIgPCAwKSB7CisJCURSTV9FUlJPUigiR2V0IHNpbmsgY291bnQg
ZmFpbGVkICVkXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCWlmICghRFBfR0VUX1NJ
TktfQ09VTlQodmFsdWUpKSB7CisJCURSTV9FUlJPUigiRG93bnN0cmVhbSBkaXNjb25uZWN0ZWRc
biIpOworCQlyZXR1cm4gLUVJTzsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBh
bng2MzQ1X2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworCXN0
cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gY29ubmVjdG9yX3RvX2FueDYzNDUoY29ubmVjdG9yKTsK
KwlpbnQgZXJyLCBudW1fbW9kZXMgPSAwOworCWJvb2wgcG93ZXJfb2ZmID0gZmFsc2U7CisKKwlt
dXRleF9sb2NrKCZhbng2MzQ1LT5sb2NrKTsKKworCWlmICghYW54NjM0NS0+ZWRpZCkgeworCQlp
ZiAoIWFueDYzNDUtPnBvd2VyZWQpIHsKKwkJCWFueDYzNDVfcG93ZXJvbihhbng2MzQ1KTsKKwkJ
CXBvd2VyX29mZiA9IHRydWU7CisJCX0KKworCQllcnIgPSBhbng2MzQ1X2dldF9kb3duc3RyZWFt
X2luZm8oYW54NjM0NSk7CisJCWlmIChlcnIpIHsKKwkJCURSTV9FUlJPUigiRmFpbGVkIHRvIGdl
dCBkb3duc3RyZWFtIGluZm86ICVkXG4iLCBlcnIpOworCQkJZ290byB1bmxvY2s7CisJCX0KKwor
CQlhbng2MzQ1LT5lZGlkID0gZHJtX2dldF9lZGlkKGNvbm5lY3RvciwgJmFueDYzNDUtPmF1eC5k
ZGMpOworCQlpZiAoIWFueDYzNDUtPmVkaWQpCisJCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZWFk
IEVESUQgZnJvbSBwYW5lbFxuIik7CisKKwkJZXJyID0gZHJtX2Nvbm5lY3Rvcl91cGRhdGVfZWRp
ZF9wcm9wZXJ0eShjb25uZWN0b3IsCisJCQkJCQkJIGFueDYzNDUtPmVkaWQpOworCQlpZiAoZXJy
KSB7CisJCQlEUk1fRVJST1IoIkZhaWxlZCB0byB1cGRhdGUgRURJRCBwcm9wZXJ0eTogJWRcbiIs
IGVycik7CisJCQlnb3RvIHVubG9jazsKKwkJfQorCX0KKworCW51bV9tb2RlcyArPSBkcm1fYWRk
X2VkaWRfbW9kZXMoY29ubmVjdG9yLCBhbng2MzQ1LT5lZGlkKTsKKwordW5sb2NrOgorCWlmIChw
b3dlcl9vZmYpCisJCWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7CisKKwltdXRleF91bmxvY2so
JmFueDYzNDUtPmxvY2spOworCisJaWYgKCFudW1fbW9kZXMgJiYgYW54NjM0NS0+cGFuZWwpCisJ
CW51bV9tb2RlcyArPSBkcm1fcGFuZWxfZ2V0X21vZGVzKGFueDYzNDUtPnBhbmVsKTsKKworCXJl
dHVybiBudW1fbW9kZXM7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9o
ZWxwZXJfZnVuY3MgYW54NjM0NV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzID0geworCS5nZXRfbW9k
ZXMgPSBhbng2MzQ1X2dldF9tb2RlcywKK307CisKK3N0YXRpYyB2b2lkCithbng2MzQ1X2Nvbm5l
Y3Rvcl9kZXN0cm95KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0
IGFueDYzNDUgKmFueDYzNDUgPSBjb25uZWN0b3JfdG9fYW54NjM0NShjb25uZWN0b3IpOworCisJ
aWYgKGFueDYzNDUtPnBhbmVsKQorCQlkcm1fcGFuZWxfZGV0YWNoKGFueDYzNDUtPnBhbmVsKTsK
Kwlkcm1fY29ubmVjdG9yX2NsZWFudXAoY29ubmVjdG9yKTsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fY29ubmVjdG9yX2Z1bmNzIGFueDYzNDVfY29ubmVjdG9yX2Z1bmNzID0geworCS5m
aWxsX21vZGVzID0gZHJtX2hlbHBlcl9wcm9iZV9zaW5nbGVfY29ubmVjdG9yX21vZGVzLAorCS5k
ZXN0cm95ID0gYW54NjM0NV9jb25uZWN0b3JfZGVzdHJveSwKKwkucmVzZXQgPSBkcm1fYXRvbWlj
X2hlbHBlcl9jb25uZWN0b3JfcmVzZXQsCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBkcm1f
YXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJv
eV9zdGF0ZSA9IGRybV9hdG9taWNfaGVscGVyX2Nvbm5lY3Rvcl9kZXN0cm95X3N0YXRlLAorfTsK
Kworc3RhdGljIGludCBhbng2MzQ1X2JyaWRnZV9hdHRhY2goc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSkKK3sKKwlzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSA9IGJyaWRnZV90b19hbng2MzQ1KGJy
aWRnZSk7CisJaW50IGVycjsKKworCWlmICghYnJpZGdlLT5lbmNvZGVyKSB7CisJCURSTV9FUlJP
UigiUGFyZW50IGVuY29kZXIgb2JqZWN0IG5vdCBmb3VuZCIpOworCQlyZXR1cm4gLUVOT0RFVjsK
Kwl9CisKKwkvKiBSZWdpc3RlciBhdXggY2hhbm5lbCAqLworCWFueDYzNDUtPmF1eC5uYW1lID0g
IkRQLUFVWCI7CisJYW54NjM0NS0+YXV4LmRldiA9ICZhbng2MzQ1LT5jbGllbnQtPmRldjsKKwlh
bng2MzQ1LT5hdXgudHJhbnNmZXIgPSBhbng2MzQ1X2F1eF90cmFuc2ZlcjsKKworCWVyciA9IGRy
bV9kcF9hdXhfcmVnaXN0ZXIoJmFueDYzNDUtPmF1eCk7CisJaWYgKGVyciA8IDApIHsKKwkJRFJN
X0VSUk9SKCJGYWlsZWQgdG8gcmVnaXN0ZXIgYXV4IGNoYW5uZWw6ICVkXG4iLCBlcnIpOworCQly
ZXR1cm4gZXJyOworCX0KKworCWVyciA9IGRybV9jb25uZWN0b3JfaW5pdChicmlkZ2UtPmRldiwg
JmFueDYzNDUtPmNvbm5lY3RvciwKKwkJCQkgJmFueDYzNDVfY29ubmVjdG9yX2Z1bmNzLAorCQkJ
CSBEUk1fTU9ERV9DT05ORUNUT1JfZURQKTsKKwlpZiAoZXJyKSB7CisJCURSTV9FUlJPUigiRmFp
bGVkIHRvIGluaXRpYWxpemUgY29ubmVjdG9yOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsK
Kwl9CisKKwlkcm1fY29ubmVjdG9yX2hlbHBlcl9hZGQoJmFueDYzNDUtPmNvbm5lY3RvciwKKwkJ
CQkgJmFueDYzNDVfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyk7CisKKwllcnIgPSBkcm1fY29ubmVj
dG9yX3JlZ2lzdGVyKCZhbng2MzQ1LT5jb25uZWN0b3IpOworCWlmIChlcnIpIHsKKwkJRFJNX0VS
Uk9SKCJGYWlsZWQgdG8gcmVnaXN0ZXIgY29ubmVjdG9yOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJu
IGVycjsKKwl9CisKKwlhbng2MzQ1LT5jb25uZWN0b3IucG9sbGVkID0gRFJNX0NPTk5FQ1RPUl9Q
T0xMX0hQRDsKKworCWVyciA9IGRybV9jb25uZWN0b3JfYXR0YWNoX2VuY29kZXIoJmFueDYzNDUt
PmNvbm5lY3RvciwKKwkJCQkJICAgYnJpZGdlLT5lbmNvZGVyKTsKKwlpZiAoZXJyKSB7CisJCURS
TV9FUlJPUigiRmFpbGVkIHRvIGxpbmsgdXAgY29ubmVjdG9yIHRvIGVuY29kZXI6ICVkXG4iLCBl
cnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCWlmIChhbng2MzQ1LT5wYW5lbCkgeworCQllcnIg
PSBkcm1fcGFuZWxfYXR0YWNoKGFueDYzNDUtPnBhbmVsLCAmYW54NjM0NS0+Y29ubmVjdG9yKTsK
KwkJaWYgKGVycikgeworCQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYXR0YWNoIHBhbmVsOiAlZFxu
IiwgZXJyKTsKKwkJCXJldHVybiBlcnI7CisJCX0KKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGVudW0gZHJtX21vZGVfc3RhdHVzCithbng2MzQ1X2JyaWRnZV9tb2RlX3ZhbGlkKHN0cnVj
dCBkcm1fYnJpZGdlICpicmlkZ2UsCisJCQkgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICptb2RlKQoreworCWlmIChtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQor
CQlyZXR1cm4gTU9ERV9OT19JTlRFUkxBQ0U7CisKKwkvKiBNYXggMTIwMHAgYXQgNS40IEdoeiwg
b25lIGxhbmUgKi8KKwlpZiAobW9kZS0+Y2xvY2sgPiAxNTQwMDApCisJCXJldHVybiBNT0RFX0NM
T0NLX0hJR0g7CisKKwlyZXR1cm4gTU9ERV9PSzsKK30KKworc3RhdGljIHZvaWQgYW54NjM0NV9i
cmlkZ2VfZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBhbng2
MzQ1ICphbng2MzQ1ID0gYnJpZGdlX3RvX2FueDYzNDUoYnJpZGdlKTsKKworCS8qIFBvd2VyIG9m
ZiBhbGwgbW9kdWxlcyBleGNlcHQgY29uZmlndXJhdGlvbiByZWdpc3RlcnMgYWNjZXNzICovCisJ
YW54NjM0NV9zZXRfYml0cyhhbng2MzQ1LT5tYXBbSTJDX0lEWF9UWENPTV0sIFNQX1BPV0VSRE9X
Tl9DVFJMX1JFRywKKwkJCSBTUF9IRENQX1BEIHwgU1BfQVVESU9fUEQgfCBTUF9WSURFT19QRCB8
IFNQX0xJTktfUEQpOworCWlmIChhbng2MzQ1LT5wYW5lbCkKKwkJZHJtX3BhbmVsX2Rpc2FibGUo
YW54NjM0NS0+cGFuZWwpOworCisJaWYgKGFueDYzNDUtPnBvd2VyZWQpCisJCWFueDYzNDVfcG93
ZXJvZmYoYW54NjM0NSk7Cit9CisKK3N0YXRpYyB2b2lkIGFueDYzNDVfYnJpZGdlX2VuYWJsZShz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0g
YnJpZGdlX3RvX2FueDYzNDUoYnJpZGdlKTsKKwlpbnQgZXJyOworCisJaWYgKGFueDYzNDUtPnBh
bmVsKQorCQlkcm1fcGFuZWxfZW5hYmxlKGFueDYzNDUtPnBhbmVsKTsKKworCWVyciA9IGFueDYz
NDVfc3RhcnQoYW54NjM0NSk7CisJaWYgKGVycikgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBp
bml0aWFsaXplOiAlZFxuIiwgZXJyKTsKKwkJcmV0dXJuOworCX0KKworCWVyciA9IGFueDYzNDVf
Y29uZmlnX2RwX291dHB1dChhbng2MzQ1KTsKKwlpZiAoZXJyKQorCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byBlbmFibGUgRFAgb3V0cHV0OiAlZFxuIiwgZXJyKTsKK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fYnJpZGdlX2Z1bmNzIGFueDYzNDVfYnJpZGdlX2Z1bmNzID0geworCS5hdHRhY2gg
PSBhbng2MzQ1X2JyaWRnZV9hdHRhY2gsCisJLm1vZGVfdmFsaWQgPSBhbng2MzQ1X2JyaWRnZV9t
b2RlX3ZhbGlkLAorCS5kaXNhYmxlID0gYW54NjM0NV9icmlkZ2VfZGlzYWJsZSwKKwkuZW5hYmxl
ID0gYW54NjM0NV9icmlkZ2VfZW5hYmxlLAorfTsKKworc3RhdGljIHZvaWQgdW5yZWdpc3Rlcl9p
MmNfZHVtbXlfY2xpZW50cyhzdHJ1Y3QgYW54NjM0NSAqYW54NjM0NSkKK3sKKwl1bnNpZ25lZCBp
bnQgaTsKKworCWZvciAoaSA9IDE7IGkgPCBBUlJBWV9TSVpFKGFueDYzNDUtPmkyY19jbGllbnRz
KTsgaSsrKQorCQlpZiAoYW54NjM0NS0+aTJjX2NsaWVudHNbaV0gJiYKKwkJICAgIGFueDYzNDUt
PmkyY19jbGllbnRzW2ldLT5hZGRyICE9IGFueDYzNDUtPmNsaWVudC0+YWRkcikKKwkJCWkyY191
bnJlZ2lzdGVyX2RldmljZShhbng2MzQ1LT5pMmNfY2xpZW50c1tpXSk7Cit9CisKK3N0YXRpYyBj
b25zdCBzdHJ1Y3QgcmVnbWFwX2NvbmZpZyBhbng2MzQ1X3JlZ21hcF9jb25maWcgPSB7CisJLnJl
Z19iaXRzID0gOCwKKwkudmFsX2JpdHMgPSA4LAorCS5tYXhfcmVnaXN0ZXIgPSAweGZmLAorCS5j
YWNoZV90eXBlID0gUkVHQ0FDSEVfTk9ORSwKK307CisKK3N0YXRpYyBjb25zdCB1MTYgYW54NjM0
NV9jaGlwaWRfbGlzdFtdID0geworCTB4NjM0NSwKK307CisKK3N0YXRpYyBib29sIGFueDYzNDVf
Z2V0X2NoaXBfaWQoc3RydWN0IGFueDYzNDUgKmFueDYzNDUpCit7CisJdW5zaWduZWQgaW50IGks
IGlkbCwgaWRoLCB2ZXJzaW9uOworCisJaWYgKHJlZ21hcF9yZWFkKGFueDYzNDUtPm1hcFtJMkNf
SURYX1RYQ09NXSwgU1BfREVWSUNFX0lETF9SRUcsICZpZGwpKQorCQlyZXR1cm4gZmFsc2U7CisK
KwlpZiAocmVnbWFwX3JlYWQoYW54NjM0NS0+bWFwW0kyQ19JRFhfVFhDT01dLCBTUF9ERVZJQ0Vf
SURIX1JFRywgJmlkaCkpCisJCXJldHVybiBmYWxzZTsKKworCWFueDYzNDUtPmNoaXBpZCA9ICh1
OClpZGwgfCAoKHU4KWlkaCA8PCA4KTsKKworCWlmIChyZWdtYXBfcmVhZChhbng2MzQ1LT5tYXBb
STJDX0lEWF9UWENPTV0sIFNQX0RFVklDRV9WRVJTSU9OX1JFRywKKwkJCSZ2ZXJzaW9uKSkKKwkJ
cmV0dXJuIGZhbHNlOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoYW54NjM0NV9jaGlw
aWRfbGlzdCk7IGkrKykgeworCQlpZiAoYW54NjM0NS0+Y2hpcGlkID09IGFueDYzNDVfY2hpcGlk
X2xpc3RbaV0pIHsKKwkJCURSTV9JTkZPKCJGb3VuZCBBTlgleCAodmVyLiAlZCkgZURQIFRyYW5z
bWl0dGVyXG4iLAorCQkJCSBhbng2MzQ1LT5jaGlwaWQsIHZlcnNpb24pOworCQkJcmV0dXJuIHRy
dWU7CisJCX0KKwl9CisKKwlEUk1fRVJST1IoIkFOWCV4ICh2ZXIuICVkKSBub3Qgc3VwcG9ydGVk
IGJ5IHRoaXMgZHJpdmVyXG4iLAorCQkgIGFueDYzNDUtPmNoaXBpZCwgdmVyc2lvbik7CisKKwly
ZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQgYW54NjM0NV9pMmNfcHJvYmUoc3RydWN0IGky
Y19jbGllbnQgKmNsaWVudCwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGkyY19kZXZpY2VfaWQgKmlk
KQoreworCXN0cnVjdCBhbng2MzQ1ICphbng2MzQ1OworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwlp
bnQgaSwgZXJyOworCisJYW54NjM0NSA9IGRldm1fa3phbGxvYygmY2xpZW50LT5kZXYsIHNpemVv
ZigqYW54NjM0NSksIEdGUF9LRVJORUwpOworCWlmICghYW54NjM0NSkKKwkJcmV0dXJuIC1FTk9N
RU07CisKKwltdXRleF9pbml0KCZhbng2MzQ1LT5sb2NrKTsKKworCWFueDYzNDUtPmJyaWRnZS5v
Zl9ub2RlID0gY2xpZW50LT5kZXYub2Zfbm9kZTsKKworCWFueDYzNDUtPmNsaWVudCA9IGNsaWVu
dDsKKwlpMmNfc2V0X2NsaWVudGRhdGEoY2xpZW50LCBhbng2MzQ1KTsKKworCWRldiA9ICZhbng2
MzQ1LT5jbGllbnQtPmRldjsKKworCWVyciA9IGRybV9vZl9maW5kX3BhbmVsX29yX2JyaWRnZShj
bGllbnQtPmRldi5vZl9ub2RlLCAxLCAwLAorCQkJCQkgICZhbng2MzQ1LT5wYW5lbCwgTlVMTCk7
CisJaWYgKGVyciA9PSAtRVBST0JFX0RFRkVSKQorCQlyZXR1cm4gZXJyOworCisJaWYgKGVycikK
KwkJRFJNX0RFQlVHKCJObyBwYW5lbCBmb3VuZFxuIik7CisKKwkvKiAxLjJWIGRpZ2l0YWwgY29y
ZSBwb3dlciByZWd1bGF0b3IgICovCisJYW54NjM0NS0+ZHZkZDEyID0gZGV2bV9yZWd1bGF0b3Jf
Z2V0KGRldiwgImR2ZGQxMi1zdXBwbHkiKTsKKwlpZiAoSVNfRVJSKGFueDYzNDUtPmR2ZGQxMikp
IHsKKwkJRFJNX0VSUk9SKCJkdmRkMTItc3VwcGx5IG5vdCBmb3VuZFxuIik7CisJCXJldHVybiBQ
VFJfRVJSKGFueDYzNDUtPmR2ZGQxMik7CisJfQorCisJLyogMi41ViBkaWdpdGFsIGNvcmUgcG93
ZXIgcmVndWxhdG9yICAqLworCWFueDYzNDUtPmR2ZGQyNSA9IGRldm1fcmVndWxhdG9yX2dldChk
ZXYsICJkdmRkMjUtc3VwcGx5Iik7CisJaWYgKElTX0VSUihhbng2MzQ1LT5kdmRkMjUpKSB7CisJ
CURSTV9FUlJPUigiZHZkZDI1LXN1cHBseSBub3QgZm91bmRcbiIpOworCQlyZXR1cm4gUFRSX0VS
Uihhbng2MzQ1LT5kdmRkMjUpOworCX0KKworCS8qIEdQSU8gZm9yIGNoaXAgcmVzZXQgKi8KKwlh
bng2MzQ1LT5ncGlvZF9yZXNldCA9IGRldm1fZ3Bpb2RfZ2V0KGRldiwgInJlc2V0IiwgR1BJT0Rf
T1VUX0xPVyk7CisJaWYgKElTX0VSUihhbng2MzQ1LT5ncGlvZF9yZXNldCkpIHsKKwkJRFJNX0VS
Uk9SKCJSZXNldCBncGlvIG5vdCBmb3VuZFxuIik7CisJCXJldHVybiBQVFJfRVJSKGFueDYzNDUt
PmdwaW9kX3Jlc2V0KTsKKwl9CisKKwkvKiBNYXAgc2xhdmUgYWRkcmVzc2VzIG9mIEFOWDYzNDUg
Ki8KKwlmb3IgKGkgPSAwOyBpIDwgSTJDX05VTV9BRERSRVNTRVM7IGkrKykgeworCQlpZiAoYW54
NjM0NV9pMmNfYWRkcmVzc2VzW2ldID4+IDEgIT0gY2xpZW50LT5hZGRyKQorCQkJYW54NjM0NS0+
aTJjX2NsaWVudHNbaV0gPSBpMmNfbmV3X2R1bW15KGNsaWVudC0+YWRhcHRlciwKKwkJCQkJCWFu
eDYzNDVfaTJjX2FkZHJlc3Nlc1tpXSA+PiAxKTsKKwkJZWxzZQorCQkJYW54NjM0NS0+aTJjX2Ns
aWVudHNbaV0gPSBjbGllbnQ7CisKKwkJaWYgKCFhbng2MzQ1LT5pMmNfY2xpZW50c1tpXSkgewor
CQkJZXJyID0gLUVOT01FTTsKKwkJCURSTV9FUlJPUigiRmFpbGVkIHRvIHJlc2VydmUgSTJDIGJ1
cyAlMDJ4XG4iLAorCQkJCSAgYW54NjM0NV9pMmNfYWRkcmVzc2VzW2ldKTsKKwkJCWdvdG8gZXJy
X3VucmVnaXN0ZXJfaTJjOworCQl9CisKKwkJYW54NjM0NS0+bWFwW2ldID0gZGV2bV9yZWdtYXBf
aW5pdF9pMmMoYW54NjM0NS0+aTJjX2NsaWVudHNbaV0sCisJCQkJCQkgICAgICAgJmFueDYzNDVf
cmVnbWFwX2NvbmZpZyk7CisJCWlmIChJU19FUlIoYW54NjM0NS0+bWFwW2ldKSkgeworCQkJZXJy
ID0gUFRSX0VSUihhbng2MzQ1LT5tYXBbaV0pOworCQkJRFJNX0VSUk9SKCJGYWlsZWQgcmVnbWFw
IGluaXRpYWxpemF0aW9uICUwMnhcbiIsCisJCQkJICBhbng2MzQ1X2kyY19hZGRyZXNzZXNbaV0p
OworCQkJZ290byBlcnJfdW5yZWdpc3Rlcl9pMmM7CisJCX0KKwl9CisKKwkvKiBMb29rIGZvciBz
dXBwb3J0ZWQgY2hpcCBJRCAqLworCWFueDYzNDVfcG93ZXJvbihhbng2MzQ1KTsKKwlpZiAoYW54
NjM0NV9nZXRfY2hpcF9pZChhbng2MzQ1KSkgeworCQlhbng2MzQ1LT5icmlkZ2UuZnVuY3MgPSAm
YW54NjM0NV9icmlkZ2VfZnVuY3M7CisJCWRybV9icmlkZ2VfYWRkKCZhbng2MzQ1LT5icmlkZ2Up
OworCisJCXJldHVybiAwOworCX0gZWxzZSB7CisJCWFueDYzNDVfcG93ZXJvZmYoYW54NjM0NSk7
CisJCWVyciA9IC1FTk9ERVY7CisJfQorCitlcnJfdW5yZWdpc3Rlcl9pMmM6CisJdW5yZWdpc3Rl
cl9pMmNfZHVtbXlfY2xpZW50cyhhbng2MzQ1KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGFueDYzNDVfaTJjX3JlbW92ZShzdHJ1Y3QgaTJjX2NsaWVudCAqY2xpZW50KQoreworCXN0
cnVjdCBhbng2MzQ1ICphbng2MzQ1ID0gaTJjX2dldF9jbGllbnRkYXRhKGNsaWVudCk7CisKKwlk
cm1fYnJpZGdlX3JlbW92ZSgmYW54NjM0NS0+YnJpZGdlKTsKKworCXVucmVnaXN0ZXJfaTJjX2R1
bW15X2NsaWVudHMoYW54NjM0NSk7CisKKwlrZnJlZShhbng2MzQ1LT5lZGlkKTsKKworCW11dGV4
X2Rlc3Ryb3koJmFueDYzNDUtPmxvY2spOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25z
dCBzdHJ1Y3QgaTJjX2RldmljZV9pZCBhbng2MzQ1X2lkW10gPSB7CisJeyAiYW54NjM0NSIsIDAg
fSwKKwl7IC8qIHNlbnRpbmVsICovIH0KK307CitNT0RVTEVfREVWSUNFX1RBQkxFKGkyYywgYW54
NjM0NV9pZCk7CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qgb2ZfZGV2aWNlX2lkIGFueDYzNDVfbWF0
Y2hfdGFibGVbXSA9IHsKKwl7IC5jb21wYXRpYmxlID0gImFuYWxvZ2l4LGFueDYzNDUiLCB9LAor
CXsgLyogc2VudGluZWwgKi8gfSwKK307CitNT0RVTEVfREVWSUNFX1RBQkxFKG9mLCBhbng2MzQ1
X21hdGNoX3RhYmxlKTsKKworc3RhdGljIHN0cnVjdCBpMmNfZHJpdmVyIGFueDYzNDVfZHJpdmVy
ID0geworCS5kcml2ZXIgPSB7CisJCSAgIC5uYW1lID0gImFueDYzNDUiLAorCQkgICAub2ZfbWF0
Y2hfdGFibGUgPSBvZl9tYXRjaF9wdHIoYW54NjM0NV9tYXRjaF90YWJsZSksCisJCSAgfSwKKwku
cHJvYmUgPSBhbng2MzQ1X2kyY19wcm9iZSwKKwkucmVtb3ZlID0gYW54NjM0NV9pMmNfcmVtb3Zl
LAorCS5pZF90YWJsZSA9IGFueDYzNDVfaWQsCit9OworbW9kdWxlX2kyY19kcml2ZXIoYW54NjM0
NV9kcml2ZXIpOworCitNT0RVTEVfREVTQ1JJUFRJT04oIkFOWDYzNDUgZURQIFRyYW5zbWl0dGVy
IGRyaXZlciIpOworTU9EVUxFX0FVVEhPUigiSWNlbm93eSBaaGVuZyA8aWNlbm93eUBhb3NjLmlv
PiIpOworTU9EVUxFX0xJQ0VOU0UoIkdQTCB2MiIpOwotLSAKMi4xNi40CgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
