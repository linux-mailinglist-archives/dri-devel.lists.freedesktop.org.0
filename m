Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 34FF2FC86C
	for <lists+dri-devel@lfdr.de>; Thu, 14 Nov 2019 15:10:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 583AD6E959;
	Thu, 14 Nov 2019 14:10:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1DF046E313
 for <dri-devel@lists.freedesktop.org>; Thu, 14 Nov 2019 14:10:31 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id 532B6AE3F;
 Thu, 14 Nov 2019 14:10:29 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: airlied@redhat.com, sean@poorly.run, daniel@ffwll.ch, kraxel@redhat.com,
 emil.velikov@collabora.com, sam@ravnborg.org, noralf@tronnes.org
Subject: [PATCH 1/5] drm/udl: Unmap buffer object after damage update
Date: Thu, 14 Nov 2019 15:10:21 +0100
Message-Id: <20191114141025.32198-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191114141025.32198-1-tzimmermann@suse.de>
References: <20191114141025.32198-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VWRsIGtlZXBzIGEgQk8gbWFwcGVkIGZvciBpdHMgZW50aXJlIGxpZmV0aW1lIGlmIGl0IGhhcyBi
ZWVuIHVzZWQgaW4gYQpkYW1hZ2UgdXBkYXRlIGF0IGxlYXN0IG9uY2UuIFRoZSBCTydzIGZyZWUg
Y2FsbGJhY2sgcmVsZWFzZSB0aGUgbWFwcGluZwpiZWZvcmUgaXQgZnJlZXMgdGhlIEJPLgoKQ2hh
bmdlIHRoaXMgYmVoYXZpb3VyIHRvIHVubWFwIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBkYW1hZ2Ug
dXBkYXRlLCBzbwpTSE1FTSdzIGltcGxlbWVudGF0aW9uIG9mIGZyZWUgY2FuIGJlIHVzZWQuCgpT
aWduZWQtb2ZmLWJ5OiBUaG9tYXMgWmltbWVybWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9mYi5jIHwgMzEgKysrKysrKysrKysrKysrKysrLS0t
LS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDEzIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS91ZGwvdWRsX2ZiLmMgYi9kcml2ZXJz
L2dwdS9kcm0vdWRsL3VkbF9mYi5jCmluZGV4IDhmZTRkOGNmMzIxMi4uYTllNmVjMzYwYjE2IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdWRsL3VkbF9mYi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS91ZGwvdWRsX2ZiLmMKQEAgLTczLDYgKzczLDcgQEAgaW50IHVkbF9oYW5kbGVfZGFtYWdl
KHN0cnVjdCB1ZGxfZnJhbWVidWZmZXIgKmZiLCBpbnQgeCwgaW50IHksCiAJc3RydWN0IHVyYiAq
dXJiOwogCWludCBhbGlnbmVkX3g7CiAJaW50IGxvZ19icHA7CisJdm9pZCAqdmFkZHI7CiAKIAlC
VUdfT04oIWlzX3Bvd2VyX29mXzIoZmItPmJhc2UuZm9ybWF0LT5jcHBbMF0pKTsKIAlsb2dfYnBw
ID0gX19mZnMoZmItPmJhc2UuZm9ybWF0LT5jcHBbMF0pOwpAQCAtODAsMTQgKzgxLDEwIEBAIGlu
dCB1ZGxfaGFuZGxlX2RhbWFnZShzdHJ1Y3QgdWRsX2ZyYW1lYnVmZmVyICpmYiwgaW50IHgsIGlu
dCB5LAogCWlmICghZmItPmFjdGl2ZV8xNikKIAkJcmV0dXJuIDA7CiAKLQlpZiAoIWZiLT5zaG1l
bS0+dmFkZHIpIHsKLQkJdm9pZCAqdmFkZHI7Ci0KLQkJdmFkZHIgPSBkcm1fZ2VtX3NobWVtX3Zt
YXAoJmZiLT5zaG1lbS0+YmFzZSk7Ci0JCWlmIChJU19FUlIodmFkZHIpKSB7Ci0JCQlEUk1fRVJS
T1IoImZhaWxlZCB0byB2bWFwIGZiXG4iKTsKLQkJCXJldHVybiAwOwotCQl9CisJdmFkZHIgPSBk
cm1fZ2VtX3NobWVtX3ZtYXAoJmZiLT5zaG1lbS0+YmFzZSk7CisJaWYgKElTX0VSUih2YWRkcikp
IHsKKwkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gdm1hcCBmYlxuIik7CisJCXJldHVybiAwOwogCX0K
IAogCWFsaWduZWRfeCA9IERMX0FMSUdOX0RPV04oeCwgc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsK
QEAgLTk2LDIyICs5MywyMyBAQCBpbnQgdWRsX2hhbmRsZV9kYW1hZ2Uoc3RydWN0IHVkbF9mcmFt
ZWJ1ZmZlciAqZmIsIGludCB4LCBpbnQgeSwKIAogCWlmICgod2lkdGggPD0gMCkgfHwKIAkgICAg
KHggKyB3aWR0aCA+IGZiLT5iYXNlLndpZHRoKSB8fAotCSAgICAoeSArIGhlaWdodCA+IGZiLT5i
YXNlLmhlaWdodCkpCi0JCXJldHVybiAtRUlOVkFMOworCSAgICAoeSArIGhlaWdodCA+IGZiLT5i
YXNlLmhlaWdodCkpIHsKKwkJcmV0ID0gLUVJTlZBTDsKKwkJZ290byBlcnJfZHJtX2dlbV9zaG1l
bV92dW5tYXA7CisJfQogCiAJc3RhcnRfY3ljbGVzID0gZ2V0X2N5Y2xlcygpOwogCiAJdXJiID0g
dWRsX2dldF91cmIoZGV2KTsKIAlpZiAoIXVyYikKLQkJcmV0dXJuIDA7CisJCWdvdG8gb3V0Owog
CWNtZCA9IHVyYi0+dHJhbnNmZXJfYnVmZmVyOwogCiAJZm9yIChpID0geTsgaSA8IHkgKyBoZWln
aHQgOyBpKyspIHsKIAkJY29uc3QgaW50IGxpbmVfb2Zmc2V0ID0gZmItPmJhc2UucGl0Y2hlc1sw
XSAqIGk7CiAJCWNvbnN0IGludCBieXRlX29mZnNldCA9IGxpbmVfb2Zmc2V0ICsgKHggPDwgbG9n
X2JwcCk7CiAJCWNvbnN0IGludCBkZXZfYnl0ZV9vZmZzZXQgPSAoZmItPmJhc2Uud2lkdGggKiBp
ICsgeCkgPDwgbG9nX2JwcDsKLQkJaWYgKHVkbF9yZW5kZXJfaGxpbmUoZGV2LCBsb2dfYnBwLCAm
dXJiLAotCQkJCSAgICAgKGNoYXIgKikgZmItPnNobWVtLT52YWRkciwKKwkJaWYgKHVkbF9yZW5k
ZXJfaGxpbmUoZGV2LCBsb2dfYnBwLCAmdXJiLCAoY2hhciAqKXZhZGRyLAogCQkJCSAgICAgJmNt
ZCwgYnl0ZV9vZmZzZXQsIGRldl9ieXRlX29mZnNldCwKIAkJCQkgICAgIHdpZHRoIDw8IGxvZ19i
cHAsCiAJCQkJICAgICAmYnl0ZXNfaWRlbnRpY2FsLCAmYnl0ZXNfc2VudCkpCkBAIC0xMzgsNyAr
MTM2LDE0IEBAIGludCB1ZGxfaGFuZGxlX2RhbWFnZShzdHJ1Y3QgdWRsX2ZyYW1lYnVmZmVyICpm
YiwgaW50IHgsIGludCB5LAogCQkgICAgPj4gMTApKSwgLyogS2N5Y2xlcyAqLwogCQkgICAmdWRs
LT5jcHVfa2N5Y2xlc191c2VkKTsKIAorb3V0OgorCWRybV9nZW1fc2htZW1fdnVubWFwKCZmYi0+
c2htZW0tPmJhc2UsIHZhZGRyKTsKKwogCXJldHVybiAwOworCitlcnJfZHJtX2dlbV9zaG1lbV92
dW5tYXA6CisJZHJtX2dlbV9zaG1lbV92dW5tYXAoJmZiLT5zaG1lbS0+YmFzZSwgdmFkZHIpOwor
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgdWRsX3VzZXJfZnJhbWVidWZmZXJfZGlydHko
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJp
LWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
