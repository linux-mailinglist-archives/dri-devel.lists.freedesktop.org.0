Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 055F722E70
	for <lists+dri-devel@lfdr.de>; Mon, 20 May 2019 10:23:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E47DC892A4;
	Mon, 20 May 2019 08:22:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x541.google.com (mail-ed1-x541.google.com
 [IPv6:2a00:1450:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 25F1489268
 for <dri-devel@lists.freedesktop.org>; Mon, 20 May 2019 08:22:43 +0000 (UTC)
Received: by mail-ed1-x541.google.com with SMTP id m4so22531016edd.8
 for <dri-devel@lists.freedesktop.org>; Mon, 20 May 2019 01:22:43 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=eM35EBMx+LqeeuwxYimZRbsx1yQ6Wi7o1I3eNH/ML70=;
 b=kzDFHtFTjLuON/jC8Pg0V3y0WjC3FL2KmuwaY3V9KG7pyqNdg4jYXHEAoO1MHQ3XNI
 5kra+B3Hw94ybx0f1XzRKYx4/hiXyAgWqvwKVjEnF+5w9oIcTg03lQVCwnSrALpw/Hda
 v+PT2ze2AHwqbDCQvQMUtiI/DtteKDEztCrNmfubeDqEX4d7TyPF0Tu7wuq5ZI7+7H6C
 rOogNqnWCdRFMqIq4hsrKyiHlJAA4mpjaToXcpI5fuotlAgsQ45ef7vxTF7xmFa/limM
 R041iNHthBgTugiZS/ECaSIggOCGjXSc00cyWMHLTklyrKrn1bPjKB1wSo6W0c1vQpCA
 AVmQ==
X-Gm-Message-State: APjAAAWxvaQiqkXEZV4BwEsb2vNTeXYJULIhy2WxL/MrRVsDz2/sIKA5
 LKRRg16SmaSq6YRgnWerCtULTCwsoK0=
X-Google-Smtp-Source: APXvYqzwxqr5riknzKLKn3+LJQycV1xHBYyDBHu6NKNup3To1CmBLLwIazOhp9s/VmgG+UQqgYb6ww==
X-Received: by 2002:a17:906:2ad5:: with SMTP id
 m21mr19708324eje.55.1558340561296; 
 Mon, 20 May 2019 01:22:41 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:569e:0:3106:d637:d723:e855])
 by smtp.gmail.com with ESMTPSA id t25sm3021263ejx.8.2019.05.20.01.22.40
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Mon, 20 May 2019 01:22:40 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Subject: [PATCH 16/33] fbdev: lock_fb_info cannot fail
Date: Mon, 20 May 2019 10:21:59 +0200
Message-Id: <20190520082216.26273-17-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190520082216.26273-1-daniel.vetter@ffwll.ch>
References: <20190520082216.26273-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=eM35EBMx+LqeeuwxYimZRbsx1yQ6Wi7o1I3eNH/ML70=;
 b=TrKawzUNypCoohtGwlMufk2BVzGw5z44FIudIvWF1khrdzBTe5O/VSS/NUwt0qtdLK
 NuElr8o2M8sRvFprt6j0hB8KF2AT2v9SKW5Za9P9xqlhMRofRF+A5OdeapjH6FnH4O2U
 kPpzA5J6kyB+1e0eW5+uIT5Bv9onoDI2q2eNE=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-fbdev@vger.kernel.org,
 Sergey Senozhatsky <sergey.senozhatsky@gmail.com>,
 Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 "Gustavo A. R. Silva" <gustavo@embeddedor.com>,
 LKML <linux-kernel@vger.kernel.org>,
 =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>,
 Yisheng Xie <ysxie@foxmail.com>, Hans de Goede <hdegoede@redhat.com>,
 Mikulas Patocka <mpatocka@redhat.com>, Daniel Vetter <daniel.vetter@intel.com>,
 Peter Rosin <peda@axentia.se>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RXZlciBzaW5jZQoKY29tbWl0IGM0Nzc0N2ZkZTkzMWMwMjQ1NTY4M2JkMDBlYTQzZWFhNjJmMzVi
MGUKQXV0aG9yOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRhdGlvbi5vcmc+
CkRhdGU6ICAgV2VkIE1heSAxMSAxNDo1ODozNCAyMDExIC0wNzAwCgogICAgZmJtZW06IG1ha2Ug
cmVhZC93cml0ZS9pb2N0bCB1c2UgdGhlIGZyYW1lIGJ1ZmZlciBhdCBvcGVuIHRpbWUKCmZiZGV2
IGhhcyBnYWluZWQgcHJvcGVyIHJlZmNvdW50aW5nIGZvciB0aGUgZmJpbmZvIGF0dGFjaGVkIHRv
IGFueQpvcGVuIGZpbGVzLCB3aGljaCBtZWFucyB0aGF0IHRoZSBiYWNraW5nIGRyaXZlciAoc3Rv
cmVkIGluCmZiX2luZm8tPmZib3BzKSBjYW5ub3QgdW50aW1lbHkgZGlzYXBwZWFyIGFueW1vcmUu
CgpUaGUgb25seSB0aGluZyB0aGF0IGNhbiBoYXBwZW4gaXMgdGhhdCB0aGUgZW50aXJlIGRldmlj
ZSBqdXN0IG91dHJpZ2h0CmRpc2FwcGVhcnMgYW5kIGdldHMgdW5yZWdpc3RlcmVkLCBidXQgZmls
ZV9mYl9pbmZvIGRvZXMgY2hlY2sgZm9yCnRoYXQuIEV4Y2VwdCB0aGF0IGl0J3MgcmFjeSAtIGl0
IG9ubHkgY2hlY2tzIG9uY2UgYXQgdGhlIHN0YXJ0IG9mIGEKZmlsZV9vcHMsIHRoZXJlJ3Mgbm8g
Z3VhcmFudGVlIHRoYXQgdGhlIHVuZGVybHlpbmcgZmJkZXYgd29uJ3QKdW50aW1lbHkgZGlzYXBw
ZWFyLiBBc2lkZTogQSBwcm9wZXIgd2F5IHRvIGZpeCB0aGF0IHJhY2UgaXMgcHJvYmFibHkKdG8g
cmVwbGljYXRlIHRoZSBzcmN1IHRyaWNrZXJ5IHdlJ3ZlIHJvbGxlZCBvdXQgaW4gZHJtLgoKQnV0
IGdpdmVuIHRoYXQgdGhpcyByYWNlIGhhcyBleGlzdGVkIHNpbmNlIGZvcmV2ZXIgaXQncyBwcm9i
YWJseSBub3QKb25lIHdlIG5lZWQgdG8gZml4IHJpZ2h0IGF3YXkuIGRvX3VucmVnaXN0ZXJfZnJh
bWVidWZmZXIgYWxzbyBub3doZXJlCmNsZWFycyBmYl9pbmZvLT5mYm9wcywgaGVuY2UgdGhlIGNo
ZWNrIGluIGxvY2tfZmJfaW5mbyBjYW4ndCBwb3NzaWJsZQpjYXRjaCBhIGRpc2FwcGVhcmluZyBm
YmRldiBsYXRlciBvbi4KCkxvbmcgc3Rvcnkgc2hvcnQ6IEV2ZXIgc2luY2UgdGhlIGFib3ZlIGNv
bW1pdCB0aGUgZmJfaW5mby0+ZmJvcHMKY2hlY2tzIGhhdmUgZXNzZW50aWFsbHkgYmVjb21lIGRl
YWQgY29kZS4gUmVtb3ZlIHRoaXMgYWxsLgoKQXNpZGUgZnJvbSB0aGUgZmlsZV9vcHMgY2FsbGJh
Y2tzLCBhbmQgc3R1ZmYgY2FsbGVkIGZyb20gdGhlcmUKdGhlcmUncyBvbmx5IHJlZ2lzdGVyL3Vu
cmVnaXN0ZXIgY29kZSBsZWZ0LiBJZiB0aGF0IGdvZXMgd3JvbmcgYSBkcml2ZXIKbWFuYWdlZCB0
byByZWdpc3Rlci91bnJlZ2lzdGVyIGEgZGV2aWNlIGluc3RhbmNlIHR3aWNlIG9yIGluIHRoZSB3
cm9uZwpvcmRlci4gIFRoYXQncyBqdXN0IGEgZHJpdmVyIGJ1Zy4KCnYyOgotIGZiX21tYXAgaGFk
IGFuIG9wZW4tY29kZWQgdmVyc2lvbiBvZiB0aGUgZmJpbmZvLT5mb3BzIGNoZWNrLCBiZWNhdXNl
CiAgaXQgZG9lc24ndCBuZWVkIHRoZSBmYmluZm8tPmxvY2suIERlbGV0ZSB0aGF0IHRvby4KLSBV
c2UgdGhlIHdyYXBwZXIgZnVuY3Rpb24gaW4gZmJfb3Blbi9yZWxlYXNlIG5vdywgc2luY2Ugbm8g
ZGlmZmVyZW5jZQogIGFueW1vcmUuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5p
ZWwudmV0dGVyQGludGVsLmNvbT4KQ2M6IEJhcnRsb21pZWogWm9sbmllcmtpZXdpY3ogPGIuem9s
bmllcmtpZUBzYW1zdW5nLmNvbT4KQ2M6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3
bGwuY2g+CkNjOiBIYW5zIGRlIEdvZWRlIDxoZGVnb2VkZUByZWRoYXQuY29tPgpDYzogWWlzaGVu
ZyBYaWUgPHlzeGllQGZveG1haWwuY29tPgpDYzogU2VyZ2V5IFNlbm96aGF0c2t5IDxzZXJnZXku
c2Vub3poYXRza3lAZ21haWwuY29tPgpDYzogIk5vcmFsZiBUcsO4bm5lcyIgPG5vcmFsZkB0cm9u
bmVzLm9yZz4KQ2M6IFBldGVyIFJvc2luIDxwZWRhQGF4ZW50aWEuc2U+CkNjOiAiTWljaGHFgiBN
aXJvc8WCYXciIDxtaXJxLWxpbnV4QHJlcmUucW1xbS5wbD4KQ2M6IE1pa3VsYXMgUGF0b2NrYSA8
bXBhdG9ja2FAcmVkaGF0LmNvbT4KQ2M6ICJHdXN0YXZvIEEuIFIuIFNpbHZhIiA8Z3VzdGF2b0Bl
bWJlZGRlZG9yLmNvbT4KQ2M6IGxpbnV4LWZiZGV2QHZnZXIua2VybmVsLm9yZwotLS0KIGRyaXZl
cnMvdmlkZW8vZmJkZXYvY29yZS9mYmNtYXAuYyB8ICA2ICstLQogZHJpdmVycy92aWRlby9mYmRl
di9jb3JlL2ZiY29uLmMgIHwgIDMgKy0KIGRyaXZlcnMvdmlkZW8vZmJkZXYvY29yZS9mYm1lbS5j
ICB8IDczICsrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGluY2x1ZGUvbGludXgvZmIu
aCAgICAgICAgICAgICAgICB8ICA1ICsrLQogNCBmaWxlcyBjaGFuZ2VkLCAyMyBpbnNlcnRpb25z
KCspLCA2NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2Nv
cmUvZmJjbWFwLmMgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJjbWFwLmMKaW5kZXggNjhh
MTEzNTk0ODA4Li5hYWM3MTBiMmY5NWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvdmlkZW8vZmJkZXYv
Y29yZS9mYmNtYXAuYworKysgYi9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJjbWFwLmMKQEAg
LTI4MywxMSArMjgzLDcgQEAgaW50IGZiX3NldF91c2VyX2NtYXAoc3RydWN0IGZiX2NtYXBfdXNl
ciAqY21hcCwgc3RydWN0IGZiX2luZm8gKmluZm8pCiAJCWdvdG8gb3V0OwogCX0KIAl1bWFwLnN0
YXJ0ID0gY21hcC0+c3RhcnQ7Ci0JaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpIHsKLQkJcmMgPSAt
RU5PREVWOwotCQlnb3RvIG91dDsKLQl9Ci0KKwlsb2NrX2ZiX2luZm8oaW5mbyk7CiAJcmMgPSBm
Yl9zZXRfY21hcCgmdW1hcCwgaW5mbyk7CiAJdW5sb2NrX2ZiX2luZm8oaW5mbyk7CiBvdXQ6CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJjb24uYyBiL2RyaXZlcnMvdmlk
ZW8vZmJkZXYvY29yZS9mYmNvbi5jCmluZGV4IDk1YWY2YmQ3ODNlOC4uMzU0NDNhZGQ3ZjdlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2NvcmUvZmJjb24uYworKysgYi9kcml2ZXJz
L3ZpZGVvL2ZiZGV2L2NvcmUvZmJjb24uYwpAQCAtMjM2MCw4ICsyMzYwLDcgQEAgc3RhdGljIHZv
aWQgZmJjb25fZ2VuZXJpY19ibGFuayhzdHJ1Y3QgdmNfZGF0YSAqdmMsIHN0cnVjdCBmYl9pbmZv
ICppbmZvLAogCX0KIAogCi0JaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpCi0JCXJldHVybjsKKwls
b2NrX2ZiX2luZm8oaW5mbyk7CiAJZXZlbnQuaW5mbyA9IGluZm87CiAJZXZlbnQuZGF0YSA9ICZi
bGFuazsKIAlmYl9ub3RpZmllcl9jYWxsX2NoYWluKEZCX0VWRU5UX0NPTkJMQU5LLCAmZXZlbnQp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMgYi9kcml2ZXJz
L3ZpZGVvL2ZiZGV2L2NvcmUvZmJtZW0uYwppbmRleCBhZTJkYjMxZWViYTcuLjE5ODdhYmE0ZjVh
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKKysrIGIvZHJp
dmVycy92aWRlby9mYmRldi9jb3JlL2ZibWVtLmMKQEAgLTgwLDE3ICs4MCw2IEBAIHN0YXRpYyB2
b2lkIHB1dF9mYl9pbmZvKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogCQlmYl9pbmZvLT5mYm9w
cy0+ZmJfZGVzdHJveShmYl9pbmZvKTsKIH0KIAotaW50IGxvY2tfZmJfaW5mbyhzdHJ1Y3QgZmJf
aW5mbyAqaW5mbykKLXsKLQltdXRleF9sb2NrKCZpbmZvLT5sb2NrKTsKLQlpZiAoIWluZm8tPmZi
b3BzKSB7Ci0JCW11dGV4X3VubG9jaygmaW5mby0+bG9jayk7Ci0JCXJldHVybiAwOwotCX0KLQly
ZXR1cm4gMTsKLX0KLUVYUE9SVF9TWU1CT0wobG9ja19mYl9pbmZvKTsKLQogLyoKICAqIEhlbHBl
cnMKICAqLwpAQCAtMTEyMSw4ICsxMTEwLDcgQEAgc3RhdGljIGxvbmcgZG9fZmJfaW9jdGwoc3Ry
dWN0IGZiX2luZm8gKmluZm8sIHVuc2lnbmVkIGludCBjbWQsCiAKIAlzd2l0Y2ggKGNtZCkgewog
CWNhc2UgRkJJT0dFVF9WU0NSRUVOSU5GTzoKLQkJaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpCi0J
CQlyZXR1cm4gLUVOT0RFVjsKKwkJbG9ja19mYl9pbmZvKGluZm8pOwogCQl2YXIgPSBpbmZvLT52
YXI7CiAJCXVubG9ja19mYl9pbmZvKGluZm8pOwogCkBAIC0xMTMyLDEwICsxMTIwLDcgQEAgc3Rh
dGljIGxvbmcgZG9fZmJfaW9jdGwoc3RydWN0IGZiX2luZm8gKmluZm8sIHVuc2lnbmVkIGludCBj
bWQsCiAJCWlmIChjb3B5X2Zyb21fdXNlcigmdmFyLCBhcmdwLCBzaXplb2YodmFyKSkpCiAJCQly
ZXR1cm4gLUVGQVVMVDsKIAkJY29uc29sZV9sb2NrKCk7Ci0JCWlmICghbG9ja19mYl9pbmZvKGlu
Zm8pKSB7Ci0JCQljb25zb2xlX3VubG9jaygpOwotCQkJcmV0dXJuIC1FTk9ERVY7Ci0JCX0KKwkJ
bG9ja19mYl9pbmZvKGluZm8pOwogCQlpbmZvLT5mbGFncyB8PSBGQklORk9fTUlTQ19VU0VSRVZF
TlQ7CiAJCXJldCA9IGZiX3NldF92YXIoaW5mbywgJnZhcik7CiAJCWluZm8tPmZsYWdzICY9IH5G
QklORk9fTUlTQ19VU0VSRVZFTlQ7CkBAIC0xMTQ1LDggKzExMzAsNyBAQCBzdGF0aWMgbG9uZyBk
b19mYl9pb2N0bChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgdW5zaWduZWQgaW50IGNtZCwKIAkJCXJl
dCA9IC1FRkFVTFQ7CiAJCWJyZWFrOwogCWNhc2UgRkJJT0dFVF9GU0NSRUVOSU5GTzoKLQkJaWYg
KCFsb2NrX2ZiX2luZm8oaW5mbykpCi0JCQlyZXR1cm4gLUVOT0RFVjsKKwkJbG9ja19mYl9pbmZv
KGluZm8pOwogCQlmaXggPSBpbmZvLT5maXg7CiAJCWlmIChpbmZvLT5mbGFncyAmIEZCSU5GT19I
SURFX1NNRU1fU1RBUlQpCiAJCQlmaXguc21lbV9zdGFydCA9IDA7CkBAIC0xMTYyLDggKzExNDYs
NyBAQCBzdGF0aWMgbG9uZyBkb19mYl9pb2N0bChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgdW5zaWdu
ZWQgaW50IGNtZCwKIAljYXNlIEZCSU9HRVRDTUFQOgogCQlpZiAoY29weV9mcm9tX3VzZXIoJmNt
YXAsIGFyZ3AsIHNpemVvZihjbWFwKSkpCiAJCQlyZXR1cm4gLUVGQVVMVDsKLQkJaWYgKCFsb2Nr
X2ZiX2luZm8oaW5mbykpCi0JCQlyZXR1cm4gLUVOT0RFVjsKKwkJbG9ja19mYl9pbmZvKGluZm8p
OwogCQljbWFwX2Zyb20gPSBpbmZvLT5jbWFwOwogCQl1bmxvY2tfZmJfaW5mbyhpbmZvKTsKIAkJ
cmV0ID0gZmJfY21hcF90b191c2VyKCZjbWFwX2Zyb20sICZjbWFwKTsKQEAgLTExNzIsMTAgKzEx
NTUsNyBAQCBzdGF0aWMgbG9uZyBkb19mYl9pb2N0bChzdHJ1Y3QgZmJfaW5mbyAqaW5mbywgdW5z
aWduZWQgaW50IGNtZCwKIAkJaWYgKGNvcHlfZnJvbV91c2VyKCZ2YXIsIGFyZ3AsIHNpemVvZih2
YXIpKSkKIAkJCXJldHVybiAtRUZBVUxUOwogCQljb25zb2xlX2xvY2soKTsKLQkJaWYgKCFsb2Nr
X2ZiX2luZm8oaW5mbykpIHsKLQkJCWNvbnNvbGVfdW5sb2NrKCk7Ci0JCQlyZXR1cm4gLUVOT0RF
VjsKLQkJfQorCQlsb2NrX2ZiX2luZm8oaW5mbyk7CiAJCXJldCA9IGZiX3Bhbl9kaXNwbGF5KGlu
Zm8sICZ2YXIpOwogCQl1bmxvY2tfZmJfaW5mbyhpbmZvKTsKIAkJY29uc29sZV91bmxvY2soKTsK
QEAgLTExOTIsOCArMTE3Miw3IEBAIHN0YXRpYyBsb25nIGRvX2ZiX2lvY3RsKHN0cnVjdCBmYl9p
bmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogCQkJcmV0dXJuIC1FSU5WQUw7CiAJCWNvbjJm
Yi5mcmFtZWJ1ZmZlciA9IC0xOwogCQlldmVudC5kYXRhID0gJmNvbjJmYjsKLQkJaWYgKCFsb2Nr
X2ZiX2luZm8oaW5mbykpCi0JCQlyZXR1cm4gLUVOT0RFVjsKKwkJbG9ja19mYl9pbmZvKGluZm8p
OwogCQlldmVudC5pbmZvID0gaW5mbzsKIAkJZmJfbm90aWZpZXJfY2FsbF9jaGFpbihGQl9FVkVO
VF9HRVRfQ09OU09MRV9NQVAsICZldmVudCk7CiAJCXVubG9ja19mYl9pbmZvKGluZm8pOwpAQCAt
MTIxNCwxMCArMTE5Myw3IEBAIHN0YXRpYyBsb25nIGRvX2ZiX2lvY3RsKHN0cnVjdCBmYl9pbmZv
ICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogCQl9CiAJCWV2ZW50LmRhdGEgPSAmY29uMmZiOwog
CQljb25zb2xlX2xvY2soKTsKLQkJaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpIHsKLQkJCWNvbnNv
bGVfdW5sb2NrKCk7Ci0JCQlyZXR1cm4gLUVOT0RFVjsKLQkJfQorCQlsb2NrX2ZiX2luZm8oaW5m
byk7CiAJCWV2ZW50LmluZm8gPSBpbmZvOwogCQlyZXQgPSBmYl9ub3RpZmllcl9jYWxsX2NoYWlu
KEZCX0VWRU5UX1NFVF9DT05TT0xFX01BUCwgJmV2ZW50KTsKIAkJdW5sb2NrX2ZiX2luZm8oaW5m
byk7CkBAIC0xMjI1LDEwICsxMjAxLDcgQEAgc3RhdGljIGxvbmcgZG9fZmJfaW9jdGwoc3RydWN0
IGZiX2luZm8gKmluZm8sIHVuc2lnbmVkIGludCBjbWQsCiAJCWJyZWFrOwogCWNhc2UgRkJJT0JM
QU5LOgogCQljb25zb2xlX2xvY2soKTsKLQkJaWYgKCFsb2NrX2ZiX2luZm8oaW5mbykpIHsKLQkJ
CWNvbnNvbGVfdW5sb2NrKCk7Ci0JCQlyZXR1cm4gLUVOT0RFVjsKLQkJfQorCQlsb2NrX2ZiX2lu
Zm8oaW5mbyk7CiAJCWluZm8tPmZsYWdzIHw9IEZCSU5GT19NSVNDX1VTRVJFVkVOVDsKIAkJcmV0
ID0gZmJfYmxhbmsoaW5mbywgYXJnKTsKIAkJaW5mby0+ZmxhZ3MgJj0gfkZCSU5GT19NSVNDX1VT
RVJFVkVOVDsKQEAgLTEyMzYsOCArMTIwOSw3IEBAIHN0YXRpYyBsb25nIGRvX2ZiX2lvY3RsKHN0
cnVjdCBmYl9pbmZvICppbmZvLCB1bnNpZ25lZCBpbnQgY21kLAogCQljb25zb2xlX3VubG9jaygp
OwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlpZiAoIWxvY2tfZmJfaW5mbyhpbmZvKSkKLQkJCXJl
dHVybiAtRU5PREVWOworCQlsb2NrX2ZiX2luZm8oaW5mbyk7CiAJCWZiID0gaW5mby0+ZmJvcHM7
CiAJCWlmIChmYi0+ZmJfaW9jdGwpCiAJCQlyZXQgPSBmYi0+ZmJfaW9jdGwoaW5mbywgY21kLCBh
cmcpOwpAQCAtMTM1Nyw4ICsxMzI5LDcgQEAgc3RhdGljIGludCBmYl9nZXRfZnNjcmVlbmluZm8o
c3RydWN0IGZiX2luZm8gKmluZm8sIHVuc2lnbmVkIGludCBjbWQsCiB7CiAJc3RydWN0IGZiX2Zp
eF9zY3JlZW5pbmZvIGZpeDsKIAotCWlmICghbG9ja19mYl9pbmZvKGluZm8pKQotCQlyZXR1cm4g
LUVOT0RFVjsKKwlsb2NrX2ZiX2luZm8oaW5mbyk7CiAJZml4ID0gaW5mby0+Zml4OwogCWlmIChp
bmZvLT5mbGFncyAmIEZCSU5GT19ISURFX1NNRU1fU1RBUlQpCiAJCWZpeC5zbWVtX3N0YXJ0ID0g
MDsKQEAgLTE0MTgsOCArMTM4OSw2IEBAIGZiX21tYXAoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVj
dCB2bV9hcmVhX3N0cnVjdCAqIHZtYSkKIAlpZiAoIWluZm8pCiAJCXJldHVybiAtRU5PREVWOwog
CWZiID0gaW5mby0+ZmJvcHM7Ci0JaWYgKCFmYikKLQkJcmV0dXJuIC1FTk9ERVY7CiAJbXV0ZXhf
bG9jaygmaW5mby0+bW1fbG9jayk7CiAJaWYgKGZiLT5mYl9tbWFwKSB7CiAJCWludCByZXM7CkBA
IC0xNDgzLDcgKzE0NTIsNyBAQCBfX3JlbGVhc2VzKCZpbmZvLT5sb2NrKQogCWlmIChJU19FUlIo
aW5mbykpCiAJCXJldHVybiBQVFJfRVJSKGluZm8pOwogCi0JbXV0ZXhfbG9jaygmaW5mby0+bG9j
ayk7CisJbG9ja19mYl9pbmZvKGluZm8pOwogCWlmICghdHJ5X21vZHVsZV9nZXQoaW5mby0+ZmJv
cHMtPm93bmVyKSkgewogCQlyZXMgPSAtRU5PREVWOwogCQlnb3RvIG91dDsKQEAgLTE0OTksNyAr
MTQ2OCw3IEBAIF9fcmVsZWFzZXMoJmluZm8tPmxvY2spCiAJCWZiX2RlZmVycmVkX2lvX29wZW4o
aW5mbywgaW5vZGUsIGZpbGUpOwogI2VuZGlmCiBvdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpbmZvLT5s
b2NrKTsKKwl1bmxvY2tfZmJfaW5mbyhpbmZvKTsKIAlpZiAocmVzKQogCQlwdXRfZmJfaW5mbyhp
bmZvKTsKIAlyZXR1cm4gcmVzOwpAQCAtMTUxMiwxMSArMTQ4MSwxMSBAQCBfX3JlbGVhc2VzKCZp
bmZvLT5sb2NrKQogewogCXN0cnVjdCBmYl9pbmZvICogY29uc3QgaW5mbyA9IGZpbGUtPnByaXZh
dGVfZGF0YTsKIAotCW11dGV4X2xvY2soJmluZm8tPmxvY2spOworCWxvY2tfZmJfaW5mbyhpbmZv
KTsKIAlpZiAoaW5mby0+ZmJvcHMtPmZiX3JlbGVhc2UpCiAJCWluZm8tPmZib3BzLT5mYl9yZWxl
YXNlKGluZm8sMSk7CiAJbW9kdWxlX3B1dChpbmZvLT5mYm9wcy0+b3duZXIpOwotCW11dGV4X3Vu
bG9jaygmaW5mby0+bG9jayk7CisJdW5sb2NrX2ZiX2luZm8oaW5mbyk7CiAJcHV0X2ZiX2luZm8o
aW5mbyk7CiAJcmV0dXJuIDA7CiB9CkBAIC0xNzI2LDE0ICsxNjk1LDEwIEBAIHN0YXRpYyBpbnQg
ZG9fcmVnaXN0ZXJfZnJhbWVidWZmZXIoc3RydWN0IGZiX2luZm8gKmZiX2luZm8pCiAJCWNvbnNv
bGVfbG9jaygpOwogCWVsc2UKIAkJYXRvbWljX2luYygmaWdub3JlX2NvbnNvbGVfbG9ja193YXJu
aW5nKTsKLQlpZiAoIWxvY2tfZmJfaW5mbyhmYl9pbmZvKSkgewotCQlyZXQgPSAtRU5PREVWOwot
CQlnb3RvIHVubG9ja19jb25zb2xlOwotCX0KLQorCWxvY2tfZmJfaW5mbyhmYl9pbmZvKTsKIAly
ZXQgPSBmYmNvbl9mYl9yZWdpc3RlcmVkKGZiX2luZm8pOwogCXVubG9ja19mYl9pbmZvKGZiX2lu
Zm8pOwotdW5sb2NrX2NvbnNvbGU6CisKIAlpZiAoIWxvY2tsZXNzX3JlZ2lzdGVyX2ZiKQogCQlj
b25zb2xlX3VubG9jaygpOwogCWVsc2UKQEAgLTE3NTEsMTEgKzE3MTYsNyBAQCBzdGF0aWMgaW50
IHVuYmluZF9jb25zb2xlKHN0cnVjdCBmYl9pbmZvICpmYl9pbmZvKQogCQlyZXR1cm4gLUVJTlZB
TDsKIAogCWNvbnNvbGVfbG9jaygpOwotCWlmICghbG9ja19mYl9pbmZvKGZiX2luZm8pKSB7Ci0J
CWNvbnNvbGVfdW5sb2NrKCk7Ci0JCXJldHVybiAtRU5PREVWOwotCX0KLQorCWxvY2tfZmJfaW5m
byhmYl9pbmZvKTsKIAlldmVudC5pbmZvID0gZmJfaW5mbzsKIAlyZXQgPSBmYl9ub3RpZmllcl9j
YWxsX2NoYWluKEZCX0VWRU5UX0ZCX1VOQklORCwgJmV2ZW50KTsKIAl1bmxvY2tfZmJfaW5mbyhm
Yl9pbmZvKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvZmIuaCBiL2luY2x1ZGUvbGludXgv
ZmIuaAppbmRleCA3MDFhYmFmNzljODcuLmZkNjAyMDdjMDY4NSAxMDA2NDQKLS0tIGEvaW5jbHVk
ZS9saW51eC9mYi5oCisrKyBiL2luY2x1ZGUvbGludXgvZmIuaApAQCAtNjU2LDcgKzY1NiwxMCBA
QCBleHRlcm4gc3RydWN0IGNsYXNzICpmYl9jbGFzczsKIAlmb3IgKGkgPSAwOyBpIDwgRkJfTUFY
OyBpKyspCQlcCiAJCWlmICghcmVnaXN0ZXJlZF9mYltpXSkge30gZWxzZQogCi1leHRlcm4gaW50
IGxvY2tfZmJfaW5mbyhzdHJ1Y3QgZmJfaW5mbyAqaW5mbyk7CitzdGF0aWMgaW5saW5lIHZvaWQg
bG9ja19mYl9pbmZvKHN0cnVjdCBmYl9pbmZvICppbmZvKQoreworCW11dGV4X2xvY2soJmluZm8t
PmxvY2spOworfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgdW5sb2NrX2ZiX2luZm8oc3RydWN0IGZi
X2luZm8gKmluZm8pCiB7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
