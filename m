Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 105182B440
	for <lists+dri-devel@lfdr.de>; Mon, 27 May 2019 14:05:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C746589D00;
	Mon, 27 May 2019 12:04:48 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lf1-x144.google.com (mail-lf1-x144.google.com
 [IPv6:2a00:1450:4864:20::144])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 53E056E13D
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 18:17:41 +0000 (UTC)
Received: by mail-lf1-x144.google.com with SMTP id l26so7792357lfh.13
 for <dri-devel@lists.freedesktop.org>; Fri, 24 May 2019 11:17:41 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=O5pIm2m4NxOGlMxX/nLkxhizg0jCSEwFErx5xpnIiYo=;
 b=IlIBrkdx4QSej7ayrVEZWHxVfLZA+WRtSrcmkGkdi53+X0ymxnJPLzLrh2VBzY7JEK
 4KkllyRhgtmxWfIHNEDh98kNMWRKHzKj2bJyTyc1pspA3yzQMcAZu9gU8lE+8ABng0CQ
 BI+otVtmtpJ84qtZXcTsu2lxnuMbbQl6m34EL2C1MCeJytybbAix+mp4uox6e6bMLw74
 sXU7kAMSNTkT2AnwwuRQgECst7JKpWS4oO2ym5mZH4DrC3QKanhcwpdsVMxKswie53KP
 mzhkknTcMEzEYSp0G6ZiMnFJpOa57s3L9qYyix6apRQPJMyEkfP8g6Q3nPPMXZVtOrjR
 FSOA==
X-Gm-Message-State: APjAAAVABNxc1/MVUbjnO8gyM7eWCU23VFebpDnsP0e/q0jaqeO/L2JT
 Jm4gKVny63WZ3+KatUX0JTk=
X-Google-Smtp-Source: APXvYqyfKxsqJfXhGE8s9zV2IKz5n6QvddanYpjfei/wrGKdsHf8ISHVAt4+GjIyE7Z05fE+xbpnVw==
X-Received: by 2002:ac2:533c:: with SMTP id f28mr41278686lfh.81.1558721859631; 
 Fri, 24 May 2019 11:17:39 -0700 (PDT)
Received: from localhost.localdomain ([94.29.35.141])
 by smtp.gmail.com with ESMTPSA id h10sm810376ljm.9.2019.05.24.11.17.38
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Fri, 24 May 2019 11:17:38 -0700 (PDT)
From: Dmitry Osipenko <digetx@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH v2 3/3] drm/tegra: Support PM QoS memory bandwidth management
Date: Fri, 24 May 2019 21:16:27 +0300
Message-Id: <20190524181627.16490-4-digetx@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190524181627.16490-1-digetx@gmail.com>
References: <20190524181627.16490-1-digetx@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 27 May 2019 12:03:54 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=O5pIm2m4NxOGlMxX/nLkxhizg0jCSEwFErx5xpnIiYo=;
 b=cRPr0uOL87KQTGE467IAVUAex9t3PIemIPFOnAnGTs4RWTvb4dpls9Cdnw/bkEdyf2
 czuUOA1G8fiqj95O7+NaIkNkg+gqXFGJsItpTI8mKUVQVPU0puYHH+8ZGKxhMAYlMoOt
 PTow7G91v58x2KPVKTUMPJBljyzg+r4ZtB8q/YkGipR1pRt5Bqawh15g9fqfW7hPg5y+
 u95bPBL/cDvPPjBi0LvyMdbnF4EH4X9kkEcSCrwG9nHkNsBEqKCHGdvXrt0X/NDKk9Wc
 4aS3hP9bF5rVMfkXuUu73NuyXy0JndD61kWYMVZFnLqv9cJ5ME517PRS3/g8YZDOKfCY
 IkKQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RGlzcGxheSBjb250cm9sbGVyIChEQykgcGVyZm9ybXMgaXNvY2hyb25vdXMgbWVtb3J5IHRyYW5z
ZmVycyBhbmQgdGh1cwpoYXMgYSByZXF1aXJlbWVudCBmb3IgYSBtaW5pbXVtIG1lbW9yeSBiYW5k
d2lkdGggdGhhdCBzaGFsbCBiZSBmdWxmaWxsZWQsCm90aGVyd2lzZSBmcmFtZWJ1ZmZlciBkYXRh
IGNhbid0IGJlIGZldGNoZWQgZmFzdCBlbm91Z2ggYW5kIHRoaXMgcmVzdWx0cwppbiBhIERDJ3Mg
ZGF0YS1GSUZPIHVuZGVyZmxvdyB0aGF0IGZvbGxvd3MgYnkgYSB2aXN1YWwgY29ycnVwdGlvbi4K
ClRoZSBFeHRlcm5hbCBNZW1vcnkgQ29udHJvbGxlciBkcml2ZXJzIHdpbGwgcHJvdmlkZSBtZW1v
cnkgYmFuZHdpZHRoCm1hbmFnZW1lbnQgZmFjaWxpdHkgdmlhIHRoZSBnZW5lcmljIFBvd2VyIE1h
bmFnZW1lbnQgUW9TIEFQSSBzb29uaXNoLgpUaGlzIHBhdGNoIHdpcmVzIHVwIHRoZSBQTSBRb1Mg
QVBJIHN1cHBvcnQgZm9yIHRoZSBkaXNwbGF5IGRyaXZlcgpiZWZvcmVoYW5kLgoKRGlzcGxheSB3
b24ndCBoYXZlIHZpc3VhbCBjb3JydXB0aW9uIG9uIGNvbWluZyB1cCBmcm9tIHN1c3BlbmQgc3Rh
dGUgd2hlbgpkZXZmcmVxIGRyaXZlciBpcyBhY3RpdmUgb25jZSBhbGwgcHJlcmVxdWlzaXRlIGJp
dHMgd2lsbCBnZXQgdXBzdHJlYW1lZC4KVGhlIGRldmZyZXEgcmVhY3Rpb24gaGFzIGEgcXVpdGUg
c2lnbmlmaWNhbnQgbGF0ZW5jeSBhbmQgaXQgYWxzbyBkb2Vzbid0CnRha2UgaW50byBhY2NvdW50
IHRoZSBJU08gdHJhbnNmZXJzIHdoaWNoIG1heSByZXN1bHQgaW4gYXNzdW1wdGlvbiBhYm91dAps
b3dlciBtZW1vcnkgYmFuZHdpZHRoIHJlcXVpcmVtZW50IHRoYW4gYWN0dWFsbHkgbmVlZGVkLgoK
U2lnbmVkLW9mZi1ieTogRG1pdHJ5IE9zaXBlbmtvIDxkaWdldHhAZ21haWwuY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jICAgIHwgMjMyICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5oICAgIHwgICA4ICsrCiBkcml2
ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMgICB8ICAxOCArKysKIGRyaXZlcnMvZ3B1L2RybS90ZWdy
YS9wbGFuZS5jIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5oIHwgICA0ICst
CiA1IGZpbGVzIGNoYW5nZWQsIDI2MSBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jIGIvZHJpdmVycy9ncHUvZHJtL3Rl
Z3JhL2RjLmMKaW5kZXggZTUzN2MwZDRiZmRkLi4xZTBkNWNmMDM0M2IgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5j
CkBAIC01MTcsNiArNTE3LDEyMyBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9kY19zZXR1cF93aW5kb3co
c3RydWN0IHRlZ3JhX3BsYW5lICpwbGFuZSwKIAkJdGVncmFfcGxhbmVfc2V0dXBfYmxlbmRpbmco
cGxhbmUsIHdpbmRvdyk7CiB9CiAKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYV9wbGFuZV9t
ZW1vcnlfYmFuZHdpZHRoKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlLAorCQkJICAgICBz
dHJ1Y3QgdGVncmFfZGNfd2luZG93ICp3aW5kb3cpCit7CisJc3RydWN0IHRlZ3JhX3BsYW5lX3N0
YXRlICp0ZWdyYV9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJ
Y29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm10OworCXN0cnVjdCB0ZWdyYV9kY193aW5k
b3cgd2luOworCXVuc2lnbmVkIGludCBicHBfcGxhbmU7CisJdW5zaWduZWQgaW50IGJwcDsKKwl1
bnNpZ25lZCBpbnQgbXVsOworCXVuc2lnbmVkIGludCBpOworCisJaWYgKCFzdGF0ZS0+ZmIgfHwg
IXN0YXRlLT52aXNpYmxlKQorCQlyZXR1cm4gMDsKKworCWNydGNfc3RhdGUgPSBkcm1fYXRvbWlj
X2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZS0+c3RhdGUsIHN0YXRlLT5jcnRjKTsKKwl0ZWdyYV9z
dGF0ZSA9IHRvX3RlZ3JhX3BsYW5lX3N0YXRlKHN0YXRlKTsKKworCWlmICghd2luZG93KQorCQl3
aW5kb3cgPSAmd2luOworCisJd2luZG93LT5zcmMudyA9IGRybV9yZWN0X3dpZHRoKCZzdGF0ZS0+
c3JjKSA+PiAxNjsKKwl3aW5kb3ctPnNyYy5oID0gZHJtX3JlY3RfaGVpZ2h0KCZzdGF0ZS0+c3Jj
KSA+PiAxNjsKKwl3aW5kb3ctPmRzdC53ID0gZHJtX3JlY3Rfd2lkdGgoJnN0YXRlLT5kc3QpOwor
CXdpbmRvdy0+ZHN0LmggPSBkcm1fcmVjdF9oZWlnaHQoJnN0YXRlLT5kc3QpOworCXdpbmRvdy0+
dGlsaW5nID0gdGVncmFfc3RhdGUtPnRpbGluZzsKKworCWZtdCA9IHN0YXRlLT5mYi0+Zm9ybWF0
OworCisJLyoKKwkgKiBOb3RlIHRoYXQgcmVhbCBtZW1vcnkgYmFuZHdpZHRoIHZhcnkgZGVwZW5k
aW5nIG9uIGZvcm1hdCBhbmQKKwkgKiBtZW1vcnkgbGF5b3V0LCB3ZSBhcmUgbm90IHRha2luZyB0
aGF0IGludG8gYWNjb3VudCBiZWNhdXNlIHNtYWxsCisJICogZXN0aW1hdGlvbiBlcnJvciBpc24n
dCBpbXBvcnRhbnQgc2luY2UgYmFuZHdpZHRoIGlzIHJvdW5kZWQgdXAKKwkgKiBhbnl3YXkuCisJ
ICovCisJZm9yIChpID0gMCwgYnBwID0gMDsgaSA8IGZtdC0+bnVtX3BsYW5lczsgaSsrKSB7CisJ
CWJwcF9wbGFuZSA9IGZtdC0+Y3BwW2ldICogODsKKworCQkvKgorCQkgKiBTdWItc2FtcGxpbmcg
aXMgcmVsZXZhbnQgZm9yIGNocm9tYSBwbGFuZXMgb25seSBhbmQgdmVydGljYWwKKwkJICogcmVh
ZG91dHMgYXJlIG5vdCBjYWNoZWQsIGhlbmNlIG9ubHkgaG9yaXpvbnRhbCBzdWItc2FtcGxpbmcK
KwkJICogbWF0dGVycy4KKwkJICovCisJCWlmIChpID4gMCkKKwkJCWJwcF9wbGFuZSAvPSBmbXQt
PmhzdWI7CisKKwkJYnBwICs9IGJwcF9wbGFuZTsKKwl9CisKKwkvKgorCSAqIEhvcml6b250YWwg
ZG93bnNjYWxlIHRha2VzIGV4dHJhIGJhbmR3aWR0aCB3aGljaCByb3VnaGx5IGRlcGVuZHMKKwkg
KiBvbiB0aGUgc2NhbGVkIHdpZHRoLgorCSAqLworCWlmICh3aW5kb3ctPnNyYy53ID4gd2luZG93
LT5kc3QudykKKwkJbXVsID0gKHdpbmRvdy0+c3JjLncgLSB3aW5kb3ctPmRzdC53KSAqIGJwcCAv
IDIwNDggKyAxOworCWVsc2UKKwkJbXVsID0gMTsKKworCS8qCisJICogSWdub3JlIHdpbmRvdyBp
ZiBpdHMgd2lkdGggaXMgc21hbGwgZW5vdWdoIHN1Y2ggdGhhdCBkYXRhLXByZWZldGNoCisJICog
RklGTyB3aWxsIGVhc2lseSBoZWxwIHRvIG92ZXJjb21lIHRlbXBvcmFsIG1lbW9yeSBwcmVzc3Vy
ZS4gVGhpcyBpcworCSAqIGEgdHlwaWNhbCBjYXNlIGZvciB0aGUgY3Vyc29yJ3MgcGxhbmUuCisJ
ICovCisJaWYgKG11bCA9PSAxICYmIHdpbmRvdy0+c3JjLncgKiBicHAgPD0gMjA0OCkKKwkJcmV0
dXJuIDA7CisKKwkvKiBtb2RlLmNsb2NrIGluIGtIeiwgYmFuZHdpZHRoIGluIE1iaXQvcyAqLwor
CXJldHVybiBjcnRjX3N0YXRlLT5tb2RlLmNsb2NrIC8gMTAwMCAqIGJwcCAqIG11bDsKK30KKwor
c3RhdGljIHVuc2lnbmVkIGxvbmcKK3RlZ3JhMjBfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aChzdHJ1
Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sKKwkvKiB4MjogfjUwJSBlZmZpY2llbmN5ICov
CisJcmV0dXJuIHRlZ3JhX3BsYW5lX21lbW9yeV9iYW5kd2lkdGgoc3RhdGUsIE5VTEwpICogMjsK
K30KKworc3RhdGljIHVuc2lnbmVkIGxvbmcKK3RlZ3JhMzBfcGxhbmVfbWVtb3J5X2JhbmR3aWR0
aChzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgdGVncmFfZGNfd2lu
ZG93IHdpbmRvdzsKKwl1bnNpZ25lZCBsb25nIGJhbmR3aWR0aDsKKworCWJhbmR3aWR0aCA9IHRl
Z3JhX3BsYW5lX21lbW9yeV9iYW5kd2lkdGgoc3RhdGUsICZ3aW5kb3cpOworCisJLyogeDIgbWVt
b3J5IG92ZXJmZXRjaCBmb3IgdGlsZWQgZnJhbWVidWZmZXIgYW5kIEREUjMgKi8KKwlpZiAod2lu
ZG93LnRpbGluZy5tb2RlID09IFRFR1JBX0JPX1RJTElOR19NT0RFX1RJTEVEKQorCQliYW5kd2lk
dGggKj0gMjsKKworCS8qIHgyOiB+NTAlIGVmZmljaWVuY3kgKi8KKwlyZXR1cm4gYmFuZHdpZHRo
ICogMjsKK30KKworc3RhdGljIHVuc2lnbmVkIGxvbmcKK3RlZ3JhMTE0X3BsYW5lX21lbW9yeV9i
YW5kd2lkdGgoc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IHRlZ3Jh
X2RjX3dpbmRvdyB3aW5kb3c7CisJdW5zaWduZWQgbG9uZyBiYW5kd2lkdGg7CisKKwliYW5kd2lk
dGggPSB0ZWdyYV9wbGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0YXRlLCAmd2luZG93KTsKKworCS8q
IHgyIG1lbW9yeSBvdmVyZmV0Y2ggZm9yIHRpbGVkIGZyYW1lYnVmZmVyIGFuZCBERFIzICovCisJ
aWYgKHdpbmRvdy50aWxpbmcubW9kZSA9PSBURUdSQV9CT19USUxJTkdfTU9ERV9USUxFRCkKKwkJ
YmFuZHdpZHRoICo9IDI7CisKKwkvKiAyLWNoYW5uZWwgbWVtb3J5ICovCisJcmV0dXJuIGJhbmR3
aWR0aDsKK30KKworc3RhdGljIHVuc2lnbmVkIGxvbmcKK3RlZ3JhMTI0X3BsYW5lX21lbW9yeV9i
YW5kd2lkdGgoc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJLyogNjRiaXQgbWVt
b3J5IGJ1cyAqLworCXJldHVybiB0ZWdyYV9wbGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0YXRlLCBO
VUxMKTsKK30KKwogc3RhdGljIGNvbnN0IHUzMiB0ZWdyYTIwX3ByaW1hcnlfZm9ybWF0c1tdID0g
ewogCURSTV9GT1JNQVRfQVJHQjQ0NDQsCiAJRFJNX0ZPUk1BVF9BUkdCMTU1NSwKQEAgLTYwNiw4
ICs3MjMsMTAgQEAgc3RhdGljIGludCB0ZWdyYV9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGRy
bV9wbGFuZSAqcGxhbmUsCiAJaW50IGVycjsKIAogCS8qIG5vIG5lZWQgZm9yIGZ1cnRoZXIgY2hl
Y2tzIGlmIHRoZSBwbGFuZSBpcyBiZWluZyBkaXNhYmxlZCAqLwotCWlmICghc3RhdGUtPmNydGMp
CisJaWYgKCFzdGF0ZS0+Y3J0YykgeworCQlwbGFuZV9zdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCA9
IDA7CiAJCXJldHVybiAwOworCX0KIAogCWVyciA9IHRlZ3JhX3BsYW5lX2Zvcm1hdChzdGF0ZS0+
ZmItPmZvcm1hdC0+Zm9ybWF0LAogCQkJCSAmcGxhbmVfc3RhdGUtPmZvcm1hdCwKQEAgLTY2MCw2
ICs3NzksOCBAQCBzdGF0aWMgaW50IHRlZ3JhX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJt
X3BsYW5lICpwbGFuZSwKIAlpZiAoZXJyIDwgMCkKIAkJcmV0dXJuIGVycjsKIAorCXBsYW5lX3N0
YXRlLT5tZW1vcnlfYmFuZHdpZHRoID0gZGMtPnNvYy0+cGxhbmVfbWVtb3J5X2JhbmR3aWR0aChz
dGF0ZSk7CisKIAlyZXR1cm4gMDsKIH0KIApAQCAtMTE4Miw2ICsxMzAzLDcgQEAgdGVncmFfY3J0
Y19hdG9taWNfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIAljb3B5LT5w
Y2xrID0gc3RhdGUtPnBjbGs7CiAJY29weS0+ZGl2ID0gc3RhdGUtPmRpdjsKIAljb3B5LT5wbGFu
ZXMgPSBzdGF0ZS0+cGxhbmVzOworCWNvcHktPm1lbW9yeV9iYW5kd2lkdGggPSBzdGF0ZS0+bWVt
b3J5X2JhbmR3aWR0aDsKIAogCXJldHVybiAmY29weS0+YmFzZTsKIH0KQEAgLTE3NzUsNiArMTg5
Nyw5IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX2NydGNfYXRvbWljX2Rpc2FibGUoc3RydWN0IGRybV9j
cnRjICpjcnRjLAogCXNwaW5fdW5sb2NrX2lycSgmY3J0Yy0+ZGV2LT5ldmVudF9sb2NrKTsKIAog
CXBtX3J1bnRpbWVfcHV0X3N5bmMoZGMtPmRldik7CisKKwlwbV9xb3NfdXBkYXRlX3JlcXVlc3Qo
JmRjLT5wbV9xb3NfcmVxLAorCQkJICAgICAgUE1fUU9TX01FTU9SWV9CQU5EV0lEVEhfREVGQVVM
VF9WQUxVRSk7CiB9CiAKIHN0YXRpYyB2b2lkIHRlZ3JhX2NydGNfYXRvbWljX2VuYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsCkBAIC0xNzg1LDYgKzE5MTAsOCBAQCBzdGF0aWMgdm9pZCB0ZWdy
YV9jcnRjX2F0b21pY19lbmFibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCXN0cnVjdCB0ZWdy
YV9kYyAqZGMgPSB0b190ZWdyYV9kYyhjcnRjKTsKIAl1MzIgdmFsdWU7CiAKKwlwbV9xb3NfdXBk
YXRlX3JlcXVlc3QoJmRjLT5wbV9xb3NfcmVxLCBzdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCk7CisK
IAlwbV9ydW50aW1lX2dldF9zeW5jKGRjLT5kZXYpOwogCiAJLyogaW5pdGlhbGl6ZSBkaXNwbGF5
IGNvbnRyb2xsZXIgKi8KQEAgLTE4OTQsNiArMjAyMSw5IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX2Ny
dGNfYXRvbWljX2VuYWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCB0ZWdy
YV9jcnRjX2F0b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkJICAgIHN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7CisJc3RydWN0IHRlZ3JhX2RjX3N0
YXRlICpkY19vbGRfc3RhdGUgPSB0b19kY19zdGF0ZShvbGRfY3J0Y19zdGF0ZSk7CisJc3RydWN0
IHRlZ3JhX2RjX3N0YXRlICpkY19zdGF0ZSA9IHRvX2RjX3N0YXRlKGNydGMtPnN0YXRlKTsKKwlz
dHJ1Y3QgdGVncmFfZGMgKmRjID0gdG9fdGVncmFfZGMoY3J0Yyk7CiAJdW5zaWduZWQgbG9uZyBm
bGFnczsKIAogCWlmIChjcnRjLT5zdGF0ZS0+ZXZlbnQpIHsKQEAgLTE5MDgsNiArMjAzOCwyMyBA
QCBzdGF0aWMgdm9pZCB0ZWdyYV9jcnRjX2F0b21pY19iZWdpbihzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCiAKIAkJY3J0Yy0+c3RhdGUtPmV2ZW50ID0gTlVMTDsKIAl9CisKKwlpZiAob2xkX2NydGNf
c3RhdGUgJiYgb2xkX2NydGNfc3RhdGUtPmFjdGl2ZSkgeworCQkvKgorCQkgKiBSYWlzZSBtZW1v
cnkgYmFuZHdpZHRoIGJlZm9yZSBjaGFuZ2VzIHRha2UgZWZmZWN0IGlmIGl0CisJCSAqIGdvZXMg
ZnJvbSBsb3cgdG8gaGlnaC4KKwkJICovCisJCWlmIChkY19vbGRfc3RhdGUtPm1lbW9yeV9iYW5k
d2lkdGggPCBkY19zdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCkKKwkJCXBtX3Fvc191cGRhdGVfcmVx
dWVzdCgmZGMtPnBtX3Fvc19yZXEsCisJCQkJCSAgICAgIGRjX3N0YXRlLT5tZW1vcnlfYmFuZHdp
ZHRoKTsKKwl9IGVsc2UgeworCQkvKgorCQkgKiBSYWlzZSBtZW1vcnkgYmFuZHdpZHRoIGJlZm9y
ZSBjaGFuZ2VzIHRha2UgZWZmZWN0IGlmCisJCSAqIENSVEMgaXMgdHVybmluZyBvbi4KKwkJICov
CisJCXBtX3Fvc191cGRhdGVfcmVxdWVzdCgmZGMtPnBtX3Fvc19yZXEsCisJCQkJICAgICAgZGNf
c3RhdGUtPm1lbW9yeV9iYW5kd2lkdGgpOworCX0KIH0KIAogc3RhdGljIHZvaWQgdGVncmFfY3J0
Y19hdG9taWNfZmx1c2goc3RydWN0IGRybV9jcnRjICpjcnRjLApAQCAtMTkyNiw3ICsyMDczLDc4
IEBAIHN0YXRpYyB2b2lkIHRlZ3JhX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAq
Y3J0YywKIAl2YWx1ZSA9IHRlZ3JhX2RjX3JlYWRsKGRjLCBEQ19DTURfU1RBVEVfQ09OVFJPTCk7
CiB9CiAKK3N0YXRpYyBib29sCit0ZWdyYV9wbGFuZV9pbnRlcnNlY3RzX3dpdGhfb3RoZXJfcGxh
bmUoc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSwKKwkJCQkJY29uc3Qgc3RydWN0IGRybV9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0
ZSAqb3RoZXJfc3RhdGU7CisJc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7CisJc3RydWN0IGRybV9y
ZWN0IHJlY3Q7CisKKwlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUo
cGxhbmUsIG90aGVyX3N0YXRlLCBzdGF0ZSkgeworCQlyZWN0ID0gcGxhbmVfc3RhdGUtPmRzdDsK
KworCQlpZiAob3RoZXJfc3RhdGUgPT0gcGxhbmVfc3RhdGUpCisJCQljb250aW51ZTsKKworCQlp
ZiAoIW90aGVyX3N0YXRlLT52aXNpYmxlIHx8ICFvdGhlcl9zdGF0ZS0+ZmIpCisJCQljb250aW51
ZTsKKworCQlpZiAoZHJtX3JlY3RfaW50ZXJzZWN0KCZyZWN0LCAmb3RoZXJfc3RhdGUtPmRzdCkp
CisJCQlyZXR1cm4gdHJ1ZTsKKwl9CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQg
dGVncmFfY3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgIHN0
cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IHRlZ3JhX2RjX3N0YXRlICpk
Y19zdGF0ZSA9IHRvX2RjX3N0YXRlKHN0YXRlKTsKKwljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZTsKKwljb25zdCBzdHJ1Y3QgdGVncmFfcGxhbmVfc3RhdGUgKnRlZ3Jh
OworCXVuc2lnbmVkIGxvbmcgYmFuZHdpZHRoID0gMDsKKwlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFu
ZTsKKworCS8qCisJICogRm9yIG92ZXJsYXBwaW5nIHBsYW5lcyBwaXhlbCdzIGRhdGEgaXMgZmV0
Y2hlZCBmb3IgZWFjaCBwbGFuZSBhdAorCSAqIHRoZSBzYW1lIHRpbWUsIGhlbmNlIGJhbmR3aWR0
aCBpcyBhY2N1bXVsYXRlZCBpbiB0aGlzIGNhc2UuCisJICovCisJZHJtX2F0b21pY19jcnRjX3N0
YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBwbGFuZV9zdGF0ZSwgc3RhdGUpIHsKKwkJ
dGVncmEgPSB0b190ZWdyYV9wbGFuZV9zdGF0ZShwbGFuZV9zdGF0ZSk7CisKKwkJaWYgKHRlZ3Jh
X3BsYW5lX2ludGVyc2VjdHNfd2l0aF9vdGhlcl9wbGFuZShzdGF0ZSwgcGxhbmVfc3RhdGUpKQor
CQkJYmFuZHdpZHRoICs9IHRlZ3JhLT5tZW1vcnlfYmFuZHdpZHRoOworCQllbHNlCisJCQliYW5k
d2lkdGggPSBtYXgoYmFuZHdpZHRoLCB0ZWdyYS0+bWVtb3J5X2JhbmR3aWR0aCk7CisJfQorCisJ
ZGNfc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGggPSBiYW5kd2lkdGg7CisKKwlyZXR1cm4gMDsKK30K
Kwordm9pZCB0ZWdyYV9jcnRjX2F0b21pY19wb3N0X2NvbW1pdChzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCisJCQkJICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKK3sKKwlz
dHJ1Y3QgdGVncmFfZGNfc3RhdGUgKmRjX29sZF9zdGF0ZSA9IHRvX2RjX3N0YXRlKG9sZF9jcnRj
X3N0YXRlKTsKKwlzdHJ1Y3QgdGVncmFfZGNfc3RhdGUgKmRjX3N0YXRlID0gdG9fZGNfc3RhdGUo
Y3J0Yy0+c3RhdGUpOworCXN0cnVjdCB0ZWdyYV9kYyAqZGMgPSB0b190ZWdyYV9kYyhjcnRjKTsK
KworCWlmICghZGNfb2xkX3N0YXRlKQorCQlyZXR1cm47CisKKwkvKgorCSAqIERyb3AgbWVtb3J5
IGJhbmR3aWR0aCBhZnRlciBjaGFuZ2VzIHRha2UgZWZmZWN0IGlmIGl0IGdvZXMgZnJvbQorCSAq
IGhpZ2ggdG8gbG93LgorCSAqLworCWlmIChkY19vbGRfc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGgg
PiBkY19zdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCkKKwkJcG1fcW9zX3VwZGF0ZV9yZXF1ZXN0KCZk
Yy0+cG1fcW9zX3JlcSwKKwkJCQkgICAgICBkY19zdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCk7Cit9
CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfaGVscGVyX2Z1bmNzIHRlZ3JhX2NydGNf
aGVscGVyX2Z1bmNzID0geworCS5hdG9taWNfY2hlY2sgPSB0ZWdyYV9jcnRjX2F0b21pY19jaGVj
aywKIAkuYXRvbWljX2JlZ2luID0gdGVncmFfY3J0Y19hdG9taWNfYmVnaW4sCiAJLmF0b21pY19m
bHVzaCA9IHRlZ3JhX2NydGNfYXRvbWljX2ZsdXNoLAogCS5hdG9taWNfZW5hYmxlID0gdGVncmFf
Y3J0Y19hdG9taWNfZW5hYmxlLApAQCAtMjA4Miw2ICsyMzAwLDkgQEAgc3RhdGljIGludCB0ZWdy
YV9kY19pbml0KHN0cnVjdCBob3N0MXhfY2xpZW50ICpjbGllbnQpCiAJCWdvdG8gY2xlYW51cDsK
IAl9CiAKKwlwbV9xb3NfYWRkX3JlcXVlc3QoJmRjLT5wbV9xb3NfcmVxLCBQTV9RT1NfTUVNT1JZ
X0JBTkRXSURUSCwKKwkJCSAgIFBNX1FPU19NRU1PUllfQkFORFdJRFRIX0RFRkFVTFRfVkFMVUUp
OworCiAJcmV0dXJuIDA7CiAKIGNsZWFudXA6CkBAIC0yMTAyLDYgKzIzMjMsOCBAQCBzdGF0aWMg
aW50IHRlZ3JhX2RjX2V4aXQoc3RydWN0IGhvc3QxeF9jbGllbnQgKmNsaWVudCkKIAlzdHJ1Y3Qg
dGVncmFfZGMgKmRjID0gaG9zdDF4X2NsaWVudF90b19kYyhjbGllbnQpOwogCWludCBlcnI7CiAK
KwlwbV9xb3NfcmVtb3ZlX3JlcXVlc3QoJmRjLT5wbV9xb3NfcmVxKTsKKwogCWlmICghdGVncmFf
ZGNfaGFzX3dpbmRvd19ncm91cHMoZGMpKQogCQlyZXR1cm4gMDsKIApAQCAtMjE0MSw2ICsyMzY0
LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdyYV9kY19zb2NfaW5mbyB0ZWdyYTIwX2RjX3Nv
Y19pbmZvID0gewogCS5tb2RpZmllcnMgPSB0ZWdyYTIwX21vZGlmaWVycywKIAkuaGFzX3dpbl9h
X3dpdGhvdXRfZmlsdGVycyA9IHRydWUsCiAJLmhhc193aW5fY193aXRob3V0X3ZlcnRfZmlsdGVy
ID0gdHJ1ZSwKKwkucGxhbmVfbWVtb3J5X2JhbmR3aWR0aCA9IHRlZ3JhMjBfcGxhbmVfbWVtb3J5
X2JhbmR3aWR0aCwKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8g
dGVncmEzMF9kY19zb2NfaW5mbyA9IHsKQEAgLTIxNjAsNiArMjM4NCw3IEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8gdGVncmEzMF9kY19zb2NfaW5mbyA9IHsKIAkubW9k
aWZpZXJzID0gdGVncmEyMF9tb2RpZmllcnMsCiAJLmhhc193aW5fYV93aXRob3V0X2ZpbHRlcnMg
PSBmYWxzZSwKIAkuaGFzX3dpbl9jX3dpdGhvdXRfdmVydF9maWx0ZXIgPSBmYWxzZSwKKwkucGxh
bmVfbWVtb3J5X2JhbmR3aWR0aCA9IHRlZ3JhMzBfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aCwKIH07
CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8gdGVncmExMTRfZGNfc29j
X2luZm8gPSB7CkBAIC0yMTc5LDYgKzI0MDQsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3Jh
X2RjX3NvY19pbmZvIHRlZ3JhMTE0X2RjX3NvY19pbmZvID0gewogCS5tb2RpZmllcnMgPSB0ZWdy
YTIwX21vZGlmaWVycywKIAkuaGFzX3dpbl9hX3dpdGhvdXRfZmlsdGVycyA9IGZhbHNlLAogCS5o
YXNfd2luX2Nfd2l0aG91dF92ZXJ0X2ZpbHRlciA9IGZhbHNlLAorCS5wbGFuZV9tZW1vcnlfYmFu
ZHdpZHRoID0gdGVncmExMTRfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aCwKIH07CiAKIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8gdGVncmExMjRfZGNfc29jX2luZm8gPSB7CkBA
IC0yMTk4LDYgKzI0MjQsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZv
IHRlZ3JhMTI0X2RjX3NvY19pbmZvID0gewogCS5tb2RpZmllcnMgPSB0ZWdyYTEyNF9tb2RpZmll
cnMsCiAJLmhhc193aW5fYV93aXRob3V0X2ZpbHRlcnMgPSBmYWxzZSwKIAkuaGFzX3dpbl9jX3dp
dGhvdXRfdmVydF9maWx0ZXIgPSBmYWxzZSwKKwkucGxhbmVfbWVtb3J5X2JhbmR3aWR0aCA9IHRl
Z3JhMTI0X3BsYW5lX21lbW9yeV9iYW5kd2lkdGgsCiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0
IHRlZ3JhX2RjX3NvY19pbmZvIHRlZ3JhMjEwX2RjX3NvY19pbmZvID0gewpAQCAtMjIxNyw2ICsy
NDQ0LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdyYV9kY19zb2NfaW5mbyB0ZWdyYTIxMF9k
Y19zb2NfaW5mbyA9IHsKIAkubW9kaWZpZXJzID0gdGVncmExMjRfbW9kaWZpZXJzLAogCS5oYXNf
d2luX2Ffd2l0aG91dF9maWx0ZXJzID0gZmFsc2UsCiAJLmhhc193aW5fY193aXRob3V0X3ZlcnRf
ZmlsdGVyID0gZmFsc2UsCisJLnBsYW5lX21lbW9yeV9iYW5kd2lkdGggPSB0ZWdyYTEyNF9wbGFu
ZV9tZW1vcnlfYmFuZHdpZHRoLAogfTsKIAogc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdyYV93aW5k
b3dncm91cF9zb2MgdGVncmExODZfZGNfd2dycHNbXSA9IHsKQEAgLTIyNjUsNiArMjQ5Myw3IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8gdGVncmExODZfZGNfc29jX2lu
Zm8gPSB7CiAJLmhhc19udmRpc3BsYXkgPSB0cnVlLAogCS53Z3JwcyA9IHRlZ3JhMTg2X2RjX3dn
cnBzLAogCS5udW1fd2dycHMgPSBBUlJBWV9TSVpFKHRlZ3JhMTg2X2RjX3dncnBzKSwKKwkucGxh
bmVfbWVtb3J5X2JhbmR3aWR0aCA9IHRlZ3JhMTI0X3BsYW5lX21lbW9yeV9iYW5kd2lkdGgsCiB9
OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX3dpbmRvd2dyb3VwX3NvYyB0ZWdyYTE5NF9k
Y193Z3Jwc1tdID0gewpAQCAtMjMxMyw2ICsyNTQyLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB0
ZWdyYV9kY19zb2NfaW5mbyB0ZWdyYTE5NF9kY19zb2NfaW5mbyA9IHsKIAkuaGFzX252ZGlzcGxh
eSA9IHRydWUsCiAJLndncnBzID0gdGVncmExOTRfZGNfd2dycHMsCiAJLm51bV93Z3JwcyA9IEFS
UkFZX1NJWkUodGVncmExOTRfZGNfd2dycHMpLAorCS5wbGFuZV9tZW1vcnlfYmFuZHdpZHRoID0g
dGVncmExMjRfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aCwKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1
Y3Qgb2ZfZGV2aWNlX2lkIHRlZ3JhX2RjX29mX21hdGNoW10gPSB7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vdGVncmEvZGMuaCBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5oCmluZGV4
IGFiMjUxNTdjOTQ4ZS4uZTIyNGZiOWRkMTg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
dGVncmEvZGMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZGMuaApAQCAtMTEsNiArMTEs
NyBAQAogI2RlZmluZSBURUdSQV9EQ19IIDEKIAogI2luY2x1ZGUgPGxpbnV4L2hvc3QxeC5oPgor
I2luY2x1ZGUgPGxpbnV4L3BtX3Fvcy5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9jcnRjLmg+CiAK
QEAgLTI2LDYgKzI3LDggQEAgc3RydWN0IHRlZ3JhX2RjX3N0YXRlIHsKIAl1bnNpZ25lZCBpbnQg
ZGl2OwogCiAJdTMyIHBsYW5lczsKKworCXVuc2lnbmVkIGxvbmcgbWVtb3J5X2JhbmR3aWR0aDsK
IH07CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IHRlZ3JhX2RjX3N0YXRlICp0b19kY19zdGF0ZShz
dHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQpAQCAtNzQsNiArNzcsNyBAQCBzdHJ1Y3QgdGVn
cmFfZGNfc29jX2luZm8gewogCWNvbnN0IHU2NCAqbW9kaWZpZXJzOwogCWJvb2wgaGFzX3dpbl9h
X3dpdGhvdXRfZmlsdGVyczsKIAlib29sIGhhc193aW5fY193aXRob3V0X3ZlcnRfZmlsdGVyOwor
CXVuc2lnbmVkIGxvbmcgKCpwbGFuZV9tZW1vcnlfYmFuZHdpZHRoKShzdHJ1Y3QgZHJtX3BsYW5l
X3N0YXRlICpzdGF0ZSk7CiB9OwogCiBzdHJ1Y3QgdGVncmFfZGMgewpAQCAtMTAwLDYgKzEwNCw4
IEBAIHN0cnVjdCB0ZWdyYV9kYyB7CiAJY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvICpz
b2M7CiAKIAlzdHJ1Y3QgaW9tbXVfZ3JvdXAgKmdyb3VwOworCisJc3RydWN0IHBtX3Fvc19yZXF1
ZXN0IHBtX3Fvc19yZXE7CiB9OwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCB0ZWdyYV9kYyAqCkBA
IC0xNjAsNiArMTY2LDggQEAgaW50IHRlZ3JhX2RjX3N0YXRlX3NldHVwX2Nsb2NrKHN0cnVjdCB0
ZWdyYV9kYyAqZGMsCiAJCQkgICAgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkJICAgICAgIHN0cnVjdCBjbGsgKmNsaywgdW5zaWduZWQgbG9uZyBwY2xrLAogCQkJICAg
ICAgIHVuc2lnbmVkIGludCBkaXYpOwordm9pZCB0ZWdyYV9jcnRjX2F0b21pY19wb3N0X2NvbW1p
dChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCisJCQkJICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSk7CiAKIC8qIGZyb20gcmdiLmMgKi8KIGludCB0ZWdyYV9kY19yZ2JfcHJv
YmUoc3RydWN0IHRlZ3JhX2RjICpkYyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGVn
cmEvZHJtLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMKaW5kZXggMGM1ZjFlNmEwNDQ2
Li5kMjA4MGJkN2QzOTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kcm0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMKQEAgLTE5LDYgKzE5LDcgQEAKICNpbmNs
dWRlIDxhc20vZG1hLWlvbW11Lmg+CiAjZW5kaWYKIAorI2luY2x1ZGUgImRjLmgiCiAjaW5jbHVk
ZSAiZHJtLmgiCiAjaW5jbHVkZSAiZ2VtLmgiCiAKQEAgLTU4LDYgKzU5LDIxIEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgZHJtX21vZGVfY29uZmlnX2Z1bmNzIHRlZ3JhX2RybV9tb2RlX2NvbmZpZ19m
dW5jcyA9IHsKIAkuYXRvbWljX2NvbW1pdCA9IGRybV9hdG9taWNfaGVscGVyX2NvbW1pdCwKIH07
CiAKK3N0YXRpYyB2b2lkIHRlZ3JhX2F0b21pY19wb3N0X2NvbW1pdChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZHJtLAorCQkJCSAgICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLCAqbmV3X2NydGNfc3RhdGU7
CisJc3RydWN0IGRybV9jcnRjICpjcnRjOworCWludCBpOworCisJZm9yX2VhY2hfb2xkbmV3X2Ny
dGNfaW5fc3RhdGUob2xkX3N0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3Rh
dGUsIGkpIHsKKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YWN0aXZlKQorCQkJY29udGludWU7CisK
KwkJdGVncmFfY3J0Y19hdG9taWNfcG9zdF9jb21taXQoY3J0Yywgb2xkX2NydGNfc3RhdGUpOwor
CX0KK30KKwogc3RhdGljIHZvaWQgdGVncmFfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9IG9s
ZF9zdGF0ZS0+ZGV2OwpAQCAtNzQsNiArOTAsOCBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9hdG9taWNf
Y29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIAl9IGVsc2Ug
ewogCQlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfdGFpbF9ycG0ob2xkX3N0YXRlKTsKIAl9CisK
Kwl0ZWdyYV9hdG9taWNfcG9zdF9jb21taXQoZHJtLCBvbGRfc3RhdGUpOwogfQogCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19oZWxwZXJfZnVuY3MKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3BsYW5l
LmMKaW5kZXggNWE4YTMzODdmNWVlLi5lN2NkMjFhMGQ3ZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS90ZWdyYS9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5j
CkBAIC01OCw2ICs1OCw3IEBAIHRlZ3JhX3BsYW5lX2F0b21pY19kdXBsaWNhdGVfc3RhdGUoc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUpCiAJY29weS0+c3dhcCA9IHN0YXRlLT5zd2FwOwogCWNvcHkt
PmJvdHRvbV91cCA9IHN0YXRlLT5ib3R0b21fdXA7CiAJY29weS0+b3BhcXVlID0gc3RhdGUtPm9w
YXF1ZTsKKwljb3B5LT5tZW1vcnlfYmFuZHdpZHRoID0gc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGg7
CiAKIAlmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKQogCQljb3B5LT5ibGVuZGluZ1tpXSA9IHN0YXRl
LT5ibGVuZGluZ1tpXTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5o
IGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL3BsYW5lLmgKaW5kZXggZTc5ZTZiNGE4ZTBhLi4zNTcx
NzRiZmYyZmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5oCkBAIC01MSwxMCArNTEsMTIgQEAgc3RydWN0
IHRlZ3JhX3BsYW5lX3N0YXRlIHsKIAkvKiB1c2VkIGZvciBsZWdhY3kgYmxlbmRpbmcgc3VwcG9y
dCBvbmx5ICovCiAJc3RydWN0IHRlZ3JhX3BsYW5lX2xlZ2FjeV9ibGVuZGluZ19zdGF0ZSBibGVu
ZGluZ1syXTsKIAlib29sIG9wYXF1ZTsKKworCXVuc2lnbmVkIGxvbmcgbWVtb3J5X2JhbmR3aWR0
aDsKIH07CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IHRlZ3JhX3BsYW5lX3N0YXRlICoKLXRvX3Rl
Z3JhX3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQordG9fdGVncmFf
cGxhbmVfc3RhdGUoY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCiB7CiAJaWYg
KHN0YXRlKQogCQlyZXR1cm4gY29udGFpbmVyX29mKHN0YXRlLCBzdHJ1Y3QgdGVncmFfcGxhbmVf
c3RhdGUsIGJhc2UpOwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9kcmktZGV2ZWw=
