Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8C4708DD65
	for <lists+dri-devel@lfdr.de>; Wed, 14 Aug 2019 20:48:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EC1326E80E;
	Wed, 14 Aug 2019 18:48:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x443.google.com (mail-pf1-x443.google.com
 [IPv6:2607:f8b0:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CA4906E802
 for <dri-devel@lists.freedesktop.org>; Wed, 14 Aug 2019 18:47:43 +0000 (UTC)
Received: by mail-pf1-x443.google.com with SMTP id 129so7187894pfa.4
 for <dri-devel@lists.freedesktop.org>; Wed, 14 Aug 2019 11:47:43 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=OApmoIvKEwANRXPyc/6OWQeR4K/MRqLWVFQnZsIe75s=;
 b=pRSSTWx3hJ/34GBlTt8Amm2pRRrWqi60upniQ+5wxTlaykuTlyHntuupJfDs/9spHQ
 H8h5qKw3uaUbaBhHHhznNS8U6M0A41C4nKInOzz1J4AdhTMd8zApP6vnqc3eqHbkYIJ9
 m0cK8stUm/Z2E6a6MkbjP8JqbHjTFr4mc3DzHgOvJSvD1TMM2DH+d7awVRxhK/8DD7Ip
 Px/R8XlUIDA5G4VPEgW9SdJt3p/DF5SGzyfw62XQN1GxQyom0ASj5AS0ef/vLhtPhuQy
 Zas9AAkn3x+zSNrAq1L3PyPiIzP7zqAVfg0/lcj4QeWyp57ei7djcK1nXTBx2VhbjDY6
 bnpg==
X-Gm-Message-State: APjAAAU2O6GcuS0HM0HRGZkwVw0jCJqTLqOUXzLutI9KjxOFvV4/EYqw
 MJ6WjVb2QnEWUcmvRjJEHIGeJg==
X-Google-Smtp-Source: APXvYqxw5prX4LW+ZcDIKAOXQz6YaysquJkWFMIYp85rfI2NOXgEqGmIgDd6MFSlYm0Djjk4WrsLpA==
X-Received: by 2002:a17:90a:cd03:: with SMTP id
 d3mr1051669pju.117.1565808462290; 
 Wed, 14 Aug 2019 11:47:42 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 y16sm610855pfc.36.2019.08.14.11.47.41
 (version=TLS1_3 cipher=AEAD-AES256-GCM-SHA384 bits=256/256);
 Wed, 14 Aug 2019 11:47:41 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [RESEND][PATCH v3 23/26] drm: kirin: Make driver_data variable
 non-global
Date: Wed, 14 Aug 2019 18:46:59 +0000
Message-Id: <20190814184702.54275-24-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190814184702.54275-1-john.stultz@linaro.org>
References: <20190814184702.54275-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=OApmoIvKEwANRXPyc/6OWQeR4K/MRqLWVFQnZsIe75s=;
 b=lOsITZchiLFnULc5mm91WsaNs9MBzbyapHeMMb56+cdMOduZItbjK07Tu3gtHNJgwj
 1mrPMeWj+3uA9BZum5sPSqe3wz4YHEcHXg0cAFV4S0JuHOb7Y36+EGsRZsl2q4Ebhugn
 RKMYnwMA23IRUelOo1yGFV7o/+Eso8NGPvNoQhNdO8FoZwxjC1cZC0NUYPGIeNmSXjgq
 flXmnQE9BmgM7AW1v2WbDZszd9ZxIoURO9WUoJf/XrHCfnx4BfoN+tSHUELB+rdPJxii
 zCLmsU+8GMqy6mPvkBUciI/vnNU7Kq34UXXWakMulrT4byK/uz3KcotFWFSfc4V3mrRp
 uFmw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Xu YiPing <xuyiping@hisilicon.com>, David Airlie <airlied@linux.ie>,
 dri-devel <dri-devel@lists.freedesktop.org>,
 Xinliang Liu <z.liuxinliang@hisilicon.com>,
 Rongrong Zou <zourongrong@gmail.com>, Sam Ravnborg <sam@ravnborg.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogWHUgWWlQaW5nIDx4dXlpcGluZ0BoaXNpbGljb24uY29tPgoKQXMgcGFydCBvZiByZWZh
Y3RvcmluZyB0aGUga2lyaW4gZHJpdmVyIHRvIGJldHRlciBzdXBwb3J0CmRpZmZlcmVudCBoYXJk
d2FyZSByZXZpc2lvbnMsIHRoaXMgcGF0Y2ggY2hhbmdlcyB0aGUgZHJpdmVyX2RhdGEKdmFsdWUg
dG8gbm90IGJlIGEgZ2xvYmFsIHZhcmlhYmxlLiBJbnN0ZWFkIHRoZSBkcml2ZXJfZGF0YSB2YWx1
ZQppcyBhY2Nlc3NlZCB2aWEgdGhlIG9mX2RldmljZV9nZXRfbWF0Y2hfZGF0YSgpIHdoZW4gbmVl
ZGVkLgoKQ2M6IFJvbmdyb25nIFpvdSA8em91cm9uZ3JvbmdAZ21haWwuY29tPgpDYzogWGlubGlh
bmcgTGl1IDx6LmxpdXhpbmxpYW5nQGhpc2lsaWNvbi5jb20+CkNjOiBEYXZpZCBBaXJsaWUgPGFp
cmxpZWRAbGludXguaWU+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBk
cmktZGV2ZWwgPGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmc+CkNjOiBTYW0gUmF2bmJv
cmcgPHNhbUByYXZuYm9yZy5vcmc+ClJldmlld2VkLWJ5OiBTYW0gUmF2bmJvcmcgPHNhbUByYXZu
Ym9yZy5vcmc+ClNpZ25lZC1vZmYtYnk6IFh1IFlpUGluZyA8eHV5aXBpbmdAaGlzaWxpY29uLmNv
bT4KW2pzdHVsdHo6IFJld29yZGVkIGNvbW1pdCBtZXNzYWdlXQpTaWduZWQtb2ZmLWJ5OiBKb2hu
IFN0dWx0eiA8am9obi5zdHVsdHpAbGluYXJvLm9yZz4KLS0tCiAuLi4vZ3B1L2RybS9oaXNpbGlj
b24va2lyaW4va2lyaW5fZHJtX2Rydi5jICAgfCA0MyArKysrKysrKysrKy0tLS0tLS0tCiAxIGZp
bGUgY2hhbmdlZCwgMjQgaW5zZXJ0aW9ucygrKSwgMTkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9raXJpbi9raXJpbl9kcm1fZHJ2LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2tpcmluL2tpcmluX2RybV9kcnYuYwppbmRleCBmMTg1M2I4
NGFiNTguLmNjNzliZDRlY2VjMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNv
bi9raXJpbi9raXJpbl9kcm1fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9r
aXJpbi9raXJpbl9kcm1fZHJ2LmMKQEAgLTI4LDE4ICsyOCw5IEBACiAKICNpbmNsdWRlICJraXJp
bl9kcm1fZHJ2LmgiCiAKLXN0YXRpYyBzdHJ1Y3Qga2lyaW5fZHJtX2RhdGEgKmRyaXZlcl9kYXRh
OwogCi1zdGF0aWMgaW50IGtpcmluX2RybV9rbXNfY2xlYW51cChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2KQotewotCWRybV9rbXNfaGVscGVyX3BvbGxfZmluaShkZXYpOwotCWRyaXZlcl9kYXRhLT5j
bGVhbnVwKHRvX3BsYXRmb3JtX2RldmljZShkZXYtPmRldikpOwotCWRybV9tb2RlX2NvbmZpZ19j
bGVhbnVwKGRldik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBraXJpbl9kcm1fa21z
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3N0YXRpYyBpbnQga2lyaW5fZHJtX2ttc19p
bml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCisJCQkJY29uc3Qgc3RydWN0IGtpcmluX2RybV9k
YXRhICpkcml2ZXJfZGF0YSkKIHsKIAlpbnQgcmV0OwogCkBAIC05NSw2ICs4NiwyMSBAQCBzdGF0
aWMgaW50IGNvbXBhcmVfb2Yoc3RydWN0IGRldmljZSAqZGV2LCB2b2lkICpkYXRhKQogCXJldHVy
biBkZXYtPm9mX25vZGUgPT0gZGF0YTsKIH0KIAorc3RhdGljIGludCBraXJpbl9kcm1fa21zX2Ns
ZWFudXAoc3RydWN0IGRybV9kZXZpY2UgKmRldikKK3sKKwljb25zdCBzdHJ1Y3Qga2lyaW5fZHJt
X2RhdGEgKmRyaXZlcl9kYXRhOworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9maW5pKGRldik7CisK
Kwlkcml2ZXJfZGF0YSA9IG9mX2RldmljZV9nZXRfbWF0Y2hfZGF0YShkZXYtPmRldik7CisJaWYg
KGRyaXZlcl9kYXRhLT5jbGVhbnVwKQorCQlkcml2ZXJfZGF0YS0+Y2xlYW51cCh0b19wbGF0Zm9y
bV9kZXZpY2UoZGV2LT5kZXYpKTsKKworCWRybV9tb2RlX2NvbmZpZ19jbGVhbnVwKGRldik7CisK
KwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGludCBraXJpbl9kcm1fY29ubmVjdG9yc19yZWdpc3Rl
cihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3I7CkBAIC0xMzEsMTUgKzEzNywyMSBAQCBzdGF0aWMgaW50IGtpcmluX2RybV9jb25uZWN0
b3JzX3JlZ2lzdGVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIHN0YXRpYyBpbnQga2lyaW5f
ZHJtX2JpbmQoc3RydWN0IGRldmljZSAqZGV2KQogeworCXN0cnVjdCBraXJpbl9kcm1fZGF0YSAq
ZHJpdmVyX2RhdGE7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXY7CiAJaW50IHJldDsKIAor
CWRyaXZlcl9kYXRhID0gKHN0cnVjdCBraXJpbl9kcm1fZGF0YSAqKW9mX2RldmljZV9nZXRfbWF0
Y2hfZGF0YShkZXYpOworCWlmIChkcml2ZXJfZGF0YSA9PSBOVUxMKQorCQlyZXR1cm4gLUVJTlZB
TDsKKwogCWRybV9kZXYgPSBkcm1fZGV2X2FsbG9jKGRyaXZlcl9kYXRhLT5kcml2ZXIsIGRldik7
CiAJaWYgKElTX0VSUihkcm1fZGV2KSkKIAkJcmV0dXJuIFBUUl9FUlIoZHJtX2Rldik7CiAJZGV2
X3NldF9kcnZkYXRhKGRldiwgZHJtX2Rldik7CiAKLQlyZXQgPSBraXJpbl9kcm1fa21zX2luaXQo
ZHJtX2Rldik7CisJLyogZGlzcGxheSBjb250cm9sbGVyIGluaXQgKi8KKwlyZXQgPSBraXJpbl9k
cm1fa21zX2luaXQoZHJtX2RldiwgZHJpdmVyX2RhdGEpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJy
X2RybV9kZXZfcHV0OwogCkBAIC0xODksMTIgKzIwMSw2IEBAIHN0YXRpYyBpbnQga2lyaW5fZHJt
X3BsYXRmb3JtX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiAJc3RydWN0IGNv
bXBvbmVudF9tYXRjaCAqbWF0Y2ggPSBOVUxMOwogCXN0cnVjdCBkZXZpY2Vfbm9kZSAqcmVtb3Rl
OwogCi0JZHJpdmVyX2RhdGEgPSAoc3RydWN0IGtpcmluX2RybV9kYXRhICopb2ZfZGV2aWNlX2dl
dF9tYXRjaF9kYXRhKGRldik7Ci0JaWYgKCFkcml2ZXJfZGF0YSkgewotCQlEUk1fRVJST1IoImZh
aWxlZCB0byBnZXQgZHQgaWQgZGF0YVxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQogCXJl
bW90ZSA9IG9mX2dyYXBoX2dldF9yZW1vdGVfbm9kZShucCwgMCwgMCk7CiAJaWYgKCFyZW1vdGUp
CiAJCXJldHVybiAtRU5PREVWOwpAQCAtMjA4LDcgKzIxNCw2IEBAIHN0YXRpYyBpbnQga2lyaW5f
ZHJtX3BsYXRmb3JtX3Byb2JlKHN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKnBkZXYpCiBzdGF0aWMg
aW50IGtpcmluX2RybV9wbGF0Zm9ybV9yZW1vdmUoc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGRl
dikKIHsKIAljb21wb25lbnRfbWFzdGVyX2RlbCgmcGRldi0+ZGV2LCAma2lyaW5fZHJtX29wcyk7
Ci0JZHJpdmVyX2RhdGEgPSBOVUxMOwogCXJldHVybiAwOwogfQogCi0tIAoyLjE3LjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWls
aW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
