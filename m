Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EF1299F5A3
	for <lists+dri-devel@lfdr.de>; Tue, 27 Aug 2019 23:55:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EF2DD890B3;
	Tue, 27 Aug 2019 21:54:58 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x541.google.com (mail-pg1-x541.google.com
 [IPv6:2607:f8b0:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CD8B0890B3;
 Tue, 27 Aug 2019 21:54:57 +0000 (UTC)
Received: by mail-pg1-x541.google.com with SMTP id w10so200313pgj.7;
 Tue, 27 Aug 2019 14:54:57 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=NzRYq2NSCkfwa5bIHqtlIzdWu66lzjTkJCH+uxJQSws=;
 b=nqMmH18Vl45yMK32222ZCmR4kFd9aIRYlkdht7fmyaHE8uaOx6aJcDQqk/dCZI0Z0Q
 8HmWrPWRLkQ7AVsmEOJpm43FfmFksDOHP9n9kjhafybMNsiPo8LBE3gQ0uBdKDXZ/xmu
 rUCZhenJZcZ7FKqfiWpB1D0qDKlLa+T42FEvF9AwCxs7zUxxB+ImUqnN1d5sTzZdX9C/
 1TA6+1RSEvA9OPDYXdL3YfUG0jwKjQN+rLkTIiU2L15gSZTcBT3tVjfL8yH2ErGqKcxq
 Ht0BwIAgDvAsIi5xXrWxvj0sG6IcLd3z1G4QAy0ypgLQPPe+gwmMhh0QjhHCmaUmy71z
 N2hw==
X-Gm-Message-State: APjAAAVNJqNPp9bV0Ym6zvCMtVYsmBQqy2QyBtvdmgk2Fxl0EobvVjOX
 8/B19LGay2xkM3KFkJgPGzSjXXdsLC8=
X-Google-Smtp-Source: APXvYqyideMqvBIIPMSlJrHSfDS8R/fjsux/TnHTny2TQv6p9KQbdqSlmbH6f5+4jk6x2IlQR8VrHQ==
X-Received: by 2002:a62:1a45:: with SMTP id a66mr817838pfa.142.1566942897116; 
 Tue, 27 Aug 2019 14:54:57 -0700 (PDT)
Received: from localhost ([100.118.89.196])
 by smtp.gmail.com with ESMTPSA id f26sm304420pfq.38.2019.08.27.14.54.56
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 27 Aug 2019 14:54:56 -0700 (PDT)
From: Rob Clark <robdclark@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 8/9] drm/msm: async commit support
Date: Tue, 27 Aug 2019 14:33:38 -0700
Message-Id: <20190827213421.21917-9-robdclark@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190827213421.21917-1-robdclark@gmail.com>
References: <20190827213421.21917-1-robdclark@gmail.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=NzRYq2NSCkfwa5bIHqtlIzdWu66lzjTkJCH+uxJQSws=;
 b=QSlfON4Q5QL+uaKCX2bJCzRihylGkZNssAwJC7vJZo61pKoDTl6m8DpK39TFHtXy/P
 6ZqCzU00H4Dsh9Q/iLTzVLHwenhjUCqhDR3lF/3a1TodyDl3sav9eDjdEskPv8yw1OXR
 ehd2SPKrjnKeqCOS746QoVpJ4n1xvqfX6aTY2IS8SutaIZ222eOBqD1d4MUAkcGVl2Uu
 foA2CUOAV1hRxchJmpNygBujnSVWYHy6T1AweYXMPnNV3kBmOHNGgliwpLIXLi2pnFHE
 Gnhmb1x+XzEfmELMqtBvsfvGgRtrvGRvKvNiGQOJCCJ6AYrSTQvYg7KIWFXG5POuQ9iV
 jOmA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Rob Clark <robdclark@chromium.org>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU"
 <freedreno@lists.freedesktop.org>, David Airlie <airlied@linux.ie>,
 "open list:DRM DRIVER FOR MSM ADRENO GPU" <linux-arm-msm@vger.kernel.org>,
 open list <linux-kernel@vger.kernel.org>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hyb21pdW0ub3JnPgoKTm93IHRoYXQgZmx1c2gv
d2FpdC9jb21wbGV0ZSBpcyBkZWNvdXBsZWQgZnJvbSB0aGUgInN5bmNocm9ub3VzIiBwYXJ0IG9m
CmF0b21pYyBjb21taXRfdGFpbCgpLCBhZGQgc3VwcG9ydCB0byBkZWZlciBmbHVzaCB0byBhIHRp
bWVyIHRoYXQgZXhwaXJlcwpzaG9ydGx5IGJlZm9yZSB2YmxhbmsgZm9yIGFzeW5jIGNvbW1pdHMu
ICBJbiB0aGlzIHdheSwgbXVsdGlwbGUgYXRvbWljCmNvbW1pdHMgKGZvciBleGFtcGxlLCBjdXJz
b3IgdXBkYXRlcykgY2FuIGJlIGNvYWxlc2NlZCBpbnRvIGEgc2luZ2xlCmZsdXNoIGF0IHRoZSBl
bmQgb2YgdGhlIGZyYW1lLgoKU2lnbmVkLW9mZi1ieTogUm9iIENsYXJrIDxyb2JkY2xhcmtAY2hy
b21pdW0ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2F0b21pYy5jIHwgMTUzICsr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2Ry
di5jICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2Rydi5oICAgIHwgICA0ICsK
IGRyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2ttcy5oICAgIHwgIDUwICsrKysrKysrKysKIDQgZmls
ZXMgY2hhbmdlZCwgMjA3IGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9tc20v
bXNtX2F0b21pYy5jCmluZGV4IDNkMDQyNDIwNTM0OS4uZGU3NjdhMTllMTkzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9hdG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
bXNtL21zbV9hdG9taWMuYwpAQCAtMjksNiArMjksOTQgQEAgaW50IG1zbV9hdG9taWNfcHJlcGFy
ZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlyZXR1cm4gbXNtX2ZyYW1lYnVmZmVyX3By
ZXBhcmUobmV3X3N0YXRlLT5mYiwga21zLT5hc3BhY2UpOwogfQogCitzdGF0aWMgdm9pZCBtc21f
YXRvbWljX2FzeW5jX2NvbW1pdChzdHJ1Y3QgbXNtX2ttcyAqa21zLCBpbnQgY3J0Y19pZHgpCit7
CisJdW5zaWduZWQgY3J0Y19tYXNrID0gQklUKGNydGNfaWR4KTsKKworCW11dGV4X2xvY2soJmtt
cy0+Y29tbWl0X2xvY2spOworCisJaWYgKCEoa21zLT5wZW5kaW5nX2NydGNfbWFzayAmIGNydGNf
bWFzaykpCisJCWdvdG8gb3V0OworCisJa21zLT5wZW5kaW5nX2NydGNfbWFzayAmPSB+Y3J0Y19t
YXNrOworCisJa21zLT5mdW5jcy0+ZW5hYmxlX2NvbW1pdChrbXMpOworCisJLyoKKwkgKiBGbHVz
aCBoYXJkd2FyZSB1cGRhdGVzOgorCSAqLworCURSTV9ERUJVR19BVE9NSUMoInRyaWdnZXJpbmcg
YXN5bmMgY29tbWl0XG4iKTsKKwlrbXMtPmZ1bmNzLT5mbHVzaF9jb21taXQoa21zLCBjcnRjX21h
c2spOworCisJLyoKKwkgKiBXYWl0IGZvciBmbHVzaCB0byBjb21wbGV0ZToKKwkgKi8KKwlrbXMt
PmZ1bmNzLT53YWl0X2ZsdXNoKGttcywgY3J0Y19tYXNrKTsKKworCWttcy0+ZnVuY3MtPmNvbXBs
ZXRlX2NvbW1pdChrbXMsIGNydGNfbWFzayk7CisJa21zLT5mdW5jcy0+ZGlzYWJsZV9jb21taXQo
a21zKTsKKworb3V0OgorCW11dGV4X3VubG9jaygma21zLT5jb21taXRfbG9jayk7CisKK30KKwor
c3RhdGljIGVudW0gaHJ0aW1lcl9yZXN0YXJ0IG1zbV9hdG9taWNfcGVuZGluZ190aW1lcihzdHJ1
Y3QgaHJ0aW1lciAqdCkKK3sKKwlzdHJ1Y3QgbXNtX3BlbmRpbmdfdGltZXIgKnRpbWVyID0gY29u
dGFpbmVyX29mKHQsCisJCQlzdHJ1Y3QgbXNtX3BlbmRpbmdfdGltZXIsIHRpbWVyKTsKKwlzdHJ1
Y3QgbXNtX2RybV9wcml2YXRlICpwcml2ID0gdGltZXItPmttcy0+ZGV2LT5kZXZfcHJpdmF0ZTsK
KworCXF1ZXVlX3dvcmsocHJpdi0+d3EsICZ0aW1lci0+d29yayk7CisKKwlyZXR1cm4gSFJUSU1F
Ul9OT1JFU1RBUlQ7Cit9CisKK3N0YXRpYyB2b2lkIG1zbV9hdG9taWNfcGVuZGluZ193b3JrKHN0
cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgbXNtX3BlbmRpbmdfdGltZXIgKnRp
bWVyID0gY29udGFpbmVyX29mKHdvcmssCisJCQlzdHJ1Y3QgbXNtX3BlbmRpbmdfdGltZXIsIHdv
cmspOworCisJbXNtX2F0b21pY19hc3luY19jb21taXQodGltZXItPmttcywgdGltZXItPmNydGNf
aWR4KTsKK30KKwordm9pZCBtc21fYXRvbWljX2luaXRfcGVuZGluZ190aW1lcihzdHJ1Y3QgbXNt
X3BlbmRpbmdfdGltZXIgKnRpbWVyLAorCQlzdHJ1Y3QgbXNtX2ttcyAqa21zLCBpbnQgY3J0Y19p
ZHgpCit7CisJdGltZXItPmttcyA9IGttczsKKwl0aW1lci0+Y3J0Y19pZHggPSBjcnRjX2lkeDsK
KwlocnRpbWVyX2luaXQoJnRpbWVyLT50aW1lciwgQ0xPQ0tfTU9OT1RPTklDLCBIUlRJTUVSX01P
REVfQUJTKTsKKwl0aW1lci0+dGltZXIuZnVuY3Rpb24gPSBtc21fYXRvbWljX3BlbmRpbmdfdGlt
ZXI7CisJSU5JVF9XT1JLKCZ0aW1lci0+d29yaywgbXNtX2F0b21pY19wZW5kaW5nX3dvcmspOwor
fQorCitzdGF0aWMgYm9vbCBjYW5fZG9fYXN5bmMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlLAorCQlzdHJ1Y3QgZHJtX2NydGMgKiphc3luY19jcnRjKQoreworCXN0cnVjdCBkcm1fY29u
bmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGU7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJc3RydWN0IGRy
bV9jcnRjICpjcnRjOworCWludCBpLCBudW1fY3J0Y3MgPSAwOworCisJaWYgKCEoc3RhdGUtPmxl
Z2FjeV9jdXJzb3JfdXBkYXRlIHx8IHN0YXRlLT5hc3luY191cGRhdGUpKQorCQlyZXR1cm4gZmFs
c2U7CisKKwkvKiBhbnkgY29ubmVjdG9yIGNoYW5nZSwgbWVhbnMgc2xvdyBwYXRoOiAqLworCWZv
cl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgY29ubmVjdG9y
X3N0YXRlLCBpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0
ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAoZHJtX2F0b21pY19jcnRjX25l
ZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkpCisJCQlyZXR1cm4gZmFsc2U7CisJCWlmICgrK251bV9j
cnRjcyA+IDEpCisJCQlyZXR1cm4gZmFsc2U7CisJCSphc3luY19jcnRjID0gY3J0YzsKKwl9CisK
KwlyZXR1cm4gdHJ1ZTsKK30KKwogLyogR2V0IGJpdG1hc2sgb2YgY3J0Y3MgdGhhdCB3aWxsIG5l
ZWQgdG8gYmUgZmx1c2hlZC4gIFRoZSBiaXRtYXNrCiAgKiBjYW4gYmUgdXNlZCB3aXRoIGZvcl9l
YWNoX2NydGNfbWFzaygpIGl0ZXJhdG9yLCB0byBpdGVyYXRlCiAgKiBlZmZlY3RlZCBjcnRjcyB3
aXRob3V0IG5lZWRpbmcgdG8gcHJlc2VydmUgdGhlIGF0b21pYyBzdGF0ZS4KQEAgLTUwLDkgKzEz
OCwyNSBAQCB2b2lkIG1zbV9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+ZGV2OwogCXN0cnVj
dCBtc21fZHJtX3ByaXZhdGUgKnByaXYgPSBkZXYtPmRldl9wcml2YXRlOwogCXN0cnVjdCBtc21f
a21zICprbXMgPSBwcml2LT5rbXM7CisJc3RydWN0IGRybV9jcnRjICphc3luY19jcnRjID0gTlVM
TDsKIAl1bnNpZ25lZCBjcnRjX21hc2sgPSBnZXRfY3J0Y19tYXNrKHN0YXRlKTsKKwlib29sIGFz
eW5jID0ga21zLT5mdW5jcy0+dnN5bmNfdGltZSAmJgorCQkJY2FuX2RvX2FzeW5jKHN0YXRlLCAm
YXN5bmNfY3J0Yyk7CiAKIAlrbXMtPmZ1bmNzLT5lbmFibGVfY29tbWl0KGttcyk7CisKKwkvKgor
CSAqIEVuc3VyZSBhbnkgcHJldmlvdXMgKHBvdGVudGlhbGx5IGFzeW5jKSBjb21taXQgaGFzCisJ
ICogY29tcGxldGVkOgorCSAqLworCWttcy0+ZnVuY3MtPndhaXRfZmx1c2goa21zLCBjcnRjX21h
c2spOworCisJbXV0ZXhfbG9jaygma21zLT5jb21taXRfbG9jayk7CisKKwkvKgorCSAqIE5vdyB0
aGF0IHRoZXJlIGlzIG5vIGluLXByb2dyZXNzIGZsdXNoIGlzIGNvbXBsZXRlLAorCSAqIHByZXBh
cmUgdGhlIGN1cnJlbnQgdXBkYXRlOgorCSAqLwogCWttcy0+ZnVuY3MtPnByZXBhcmVfY29tbWl0
KGttcywgc3RhdGUpOwogCiAJLyoKQEAgLTYyLDYgKzE2Niw0OSBAQCB2b2lkIG1zbV9hdG9taWNf
Y29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWRybV9hdG9taWNf
aGVscGVyX2NvbW1pdF9wbGFuZXMoZGV2LCBzdGF0ZSwgMCk7CiAJZHJtX2F0b21pY19oZWxwZXJf
Y29tbWl0X21vZGVzZXRfZW5hYmxlcyhkZXYsIHN0YXRlKTsKIAorCWlmIChhc3luYykgeworCQlz
dHJ1Y3QgbXNtX3BlbmRpbmdfdGltZXIgKnRpbWVyID0KKwkJCSZrbXMtPnBlbmRpbmdfdGltZXJz
W2FzeW5jX2NydGMtPmluZGV4XTsKKworCQkvKiBhc3luYyB1cGRhdGVzIGFyZSBsaW1pdGVkIHRv
IHNpbmdsZS1jcnRjIHVwZGF0ZXM6ICovCisJCVdBUk5fT04oY3J0Y19tYXNrICE9IEJJVChhc3lu
Y19jcnRjLT5pbmRleCkpOworCisJCS8qCisJCSAqIFN0YXJ0IHRpbWVyIGlmIHdlIGRvbid0IGFs
cmVhZHkgaGF2ZSBhbiB1cGRhdGUgcGVuZGluZworCQkgKiBvbiB0aGlzIGNydGM6CisJCSAqLwor
CQlpZiAoIShrbXMtPnBlbmRpbmdfY3J0Y19tYXNrICYgY3J0Y19tYXNrKSkgeworCQkJa3RpbWVf
dCB2c3luY190aW1lLCB3YWtldXBfdGltZTsKKworCQkJa21zLT5wZW5kaW5nX2NydGNfbWFzayB8
PSBjcnRjX21hc2s7CisKKwkJCXZzeW5jX3RpbWUgPSBrbXMtPmZ1bmNzLT52c3luY190aW1lKGtt
cywgYXN5bmNfY3J0Yyk7CisJCQl3YWtldXBfdGltZSA9IGt0aW1lX3N1Yih2c3luY190aW1lLCBt
c190b19rdGltZSgxKSk7CisKKwkJCWhydGltZXJfc3RhcnQoJnRpbWVyLT50aW1lciwgd2FrZXVw
X3RpbWUsCisJCQkJCUhSVElNRVJfTU9ERV9BQlMpOworCQl9CisKKwkJa21zLT5mdW5jcy0+ZGlz
YWJsZV9jb21taXQoa21zKTsKKwkJbXV0ZXhfdW5sb2NrKCZrbXMtPmNvbW1pdF9sb2NrKTsKKwor
CQkvKgorCQkgKiBBdCB0aGlzIHBvaW50LCBmcm9tIGRybSBjb3JlJ3MgcGVyc3BlY3RpdmUsIHdl
CisJCSAqIGFyZSBkb25lIHdpdGggdGhlIGF0b21pYyB1cGRhdGUsIHNvIHdlIGNhbiBqdXN0CisJ
CSAqIGdvIGFoZWFkIGFuZCBzaWduYWwgdGhhdCBpdCBpcyBkb25lOgorCQkgKi8KKwkJZHJtX2F0
b21pY19oZWxwZXJfY29tbWl0X2h3X2RvbmUoc3RhdGUpOworCQlkcm1fYXRvbWljX2hlbHBlcl9j
bGVhbnVwX3BsYW5lcyhkZXYsIHN0YXRlKTsKKworCQlyZXR1cm47CisJfQorCisJLyoKKwkgKiBJ
ZiB0aGVyZSBpcyBhbnkgYXN5bmMgZmx1c2ggcGVuZGluZyBvbiB1cGRhdGVkIGNydGNzLCBmb2xk
CisJICogdGhlbSBpbnRvIHRoZSBjdXJyZW50IGZsdXNoLgorCSAqLworCWttcy0+cGVuZGluZ19j
cnRjX21hc2sgJj0gfmNydGNfbWFzazsKKwogCS8qCiAJICogRmx1c2ggaGFyZHdhcmUgdXBkYXRl
czoKIAkgKi8KQEAgLTcxLDExICsyMTgsMTUgQEAgdm9pZCBtc21fYXRvbWljX2NvbW1pdF90YWls
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAl9CiAJa21zLT5mdW5jcy0+Zmx1c2hf
Y29tbWl0KGttcywgY3J0Y19tYXNrKTsKIAorCS8qCisJICogV2FpdCBmb3IgZmx1c2ggdG8gY29t
cGxldGU6CisJICovCiAJa21zLT5mdW5jcy0+d2FpdF9mbHVzaChrbXMsIGNydGNfbWFzayk7CisK
IAlrbXMtPmZ1bmNzLT5jb21wbGV0ZV9jb21taXQoa21zLCBjcnRjX21hc2spOwogCWttcy0+ZnVu
Y3MtPmRpc2FibGVfY29tbWl0KGttcyk7CisJbXV0ZXhfdW5sb2NrKCZrbXMtPmNvbW1pdF9sb2Nr
KTsKIAogCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9od19kb25lKHN0YXRlKTsKLQogCWRybV9h
dG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKGRldiwgc3RhdGUpOwogfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21zbV9k
cnYuYwppbmRleCAzMzZhNmQwYTRjZDMuLjY1MjYyYTk5MzQ0MCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL21zbS9tc21fZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2
LmMKQEAgLTUzMiw2ICs1MzIsNyBAQCBzdGF0aWMgaW50IG1zbV9kcm1faW5pdChzdHJ1Y3QgZGV2
aWNlICpkZXYsIHN0cnVjdCBkcm1fZHJpdmVyICpkcnYpCiAJZGRldi0+bW9kZV9jb25maWcubm9y
bWFsaXplX3pwb3MgPSB0cnVlOwogCiAJaWYgKGttcykgeworCQlrbXMtPmRldiA9IGRkZXY7CiAJ
CXJldCA9IGttcy0+ZnVuY3MtPmh3X2luaXQoa21zKTsKIAkJaWYgKHJldCkgewogCQkJRFJNX0RF
Vl9FUlJPUihkZXYsICJrbXMgaHcgaW5pdCBmYWlsZWQ6ICVkXG4iLCByZXQpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL21zbS9tc21fZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vbXNtL21z
bV9kcnYuaAppbmRleCA3OWQ0ODBhN2Q5N2QuLjdkMTY0ZDVjMThiNCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL21zbS9tc21fZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL21zbS9tc21f
ZHJ2LmgKQEAgLTIyMiw4ICsyMjIsMTIgQEAgc3RydWN0IG1zbV9mb3JtYXQgewogCXVpbnQzMl90
IHBpeGVsX2Zvcm1hdDsKIH07CiAKK3N0cnVjdCBtc21fcGVuZGluZ190aW1lcjsKKwogaW50IG1z
bV9hdG9taWNfcHJlcGFyZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJCSAgc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3N0YXRlKTsKK3ZvaWQgbXNtX2F0b21pY19pbml0X3BlbmRp
bmdfdGltZXIoc3RydWN0IG1zbV9wZW5kaW5nX3RpbWVyICp0aW1lciwKKwkJc3RydWN0IG1zbV9r
bXMgKmttcywgaW50IGNydGNfaWR4KTsKIHZvaWQgbXNtX2F0b21pY19jb21taXRfdGFpbChzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm1z
bV9hdG9taWNfc3RhdGVfYWxsb2Moc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiB2b2lkIG1zbV9h
dG9taWNfc3RhdGVfY2xlYXIoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2ttcy5oIGIvZHJpdmVycy9ncHUvZHJtL21z
bS9tc21fa21zLmgKaW5kZXggZjk4NDdlYjM5MTQzLi45YTAyMzZlYjY0ODcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9tc20vbXNtX2ttcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20v
bXNtX2ttcy5oCkBAIC0zMyw2ICszMywyMCBAQCBzdHJ1Y3QgbXNtX2ttc19mdW5jcyB7CiAKIAkv
KgogCSAqIEF0b21pYyBjb21taXQgaGFuZGxpbmc6CisJICoKKwkgKiBOb3RlIHRoYXQgaW4gdGhl
IGNhc2Ugb2YgYXN5bmMgY29tbWl0cywgdGhlIGZ1bmNzIHdoaWNoIHRha2UKKwkgKiBhIGNydGNf
bWFzayAoaWUuIC0+Zmx1c2hfY29tbWl0KCksIGFuZCAtPmNvbXBsZXRlX2NvbW1pdCgpKQorCSAq
IG1pZ2h0IG5vdCBiZSBldmVubHkgYmFsYW5jZWQgd2l0aCAtPnByZXBhcmVfY29tbWl0KCksIGhv
d2V2ZXIKKwkgKiBlYWNoIGNydGMgdGhhdCBlZmZlY3RlZCBieSBhIC0+cGVycGFyZV9jb21taXQo
KSAocG90ZW50aWFsbHkKKwkgKiBtdWx0aXBsZSB0aW1lcykgd2lsbCBldmVudHVhbGx5IChhdCBl
bmQgb2YgdnN5bmMgcGVyaW9kKSBiZQorCSAqIGZsdXNoZWQgYW5kIGNvbXBsZXRlZC4KKwkgKgor
CSAqIFRoaXMgaGFzIHNvbWUgaW1wbGljYXRpb25zIGFib3V0IHRyYWNraW5nIG9mIGNsZWFudXAg
c3RhdGUsCisJICogZm9yIGV4YW1wbGUgU01QIGJsb2NrcyB0byByZWxlYXNlIGFmdGVyIGNvbW1p
dCBjb21wbGV0ZXMuICBJZS4KKwkgKiBjbGVhbnVwIHN0YXRlIHNob3VsZCBiZSBhbHNvIGR1cGxp
Y2F0ZWQgaW4gdGhlIHZhcmlvdXMKKwkgKiBkdXBsaWNhdGVfc3RhdGUoKSBtZXRob2RzLCBhcyB0
aGUgY3VycmVudCBjbGVhbnVwIHN0YXRlIGF0CisJICogLT5jb21wbGV0ZV9jb21taXQoKSB0aW1l
IG1heSBoYXZlIGFjY3VtdWxhdGVkIGNsZWFudXAgd29yaworCSAqIGZyb20gbXVsdGlwbGUgY29t
bWl0cy4KIAkgKi8KIAogCS8qKgpAQCAtNDUsNiArNTksMTQgQEAgc3RydWN0IG1zbV9rbXNfZnVu
Y3MgewogCXZvaWQgKCplbmFibGVfY29tbWl0KShzdHJ1Y3QgbXNtX2ttcyAqa21zKTsKIAl2b2lk
ICgqZGlzYWJsZV9jb21taXQpKHN0cnVjdCBtc21fa21zICprbXMpOwogCisJLyoqCisJICogSWYg
dGhlIGttcyBiYWNrZW5kIHN1cHBvcnRzIGFzeW5jIGNvbW1pdCwgaXQgc2hvdWxkIGltcGxlbWVu
dAorCSAqIHRoaXMgbWV0aG9kIHRvIHJldHVybiB0aGUgdGltZSBvZiB0aGUgbmV4dCB2c3luYy4g
IFRoaXMgaXMKKwkgKiB1c2VkIHRvIGRldGVybWluZSBhIHRpbWUgc2xpZ2h0bHkgYmVmb3JlIHZz
eW5jLCBmb3IgdGhlIGFzeW5jCisJICogY29tbWl0IHRpbWVyIHRvIHJ1biBhbmQgY29tcGxldGUg
YW4gYXN5bmMgY29tbWl0LgorCSAqLworCWt0aW1lX3QgKCp2c3luY190aW1lKShzdHJ1Y3QgbXNt
X2ttcyAqa21zLCBzdHJ1Y3QgZHJtX2NydGMgKmNydGMpOworCiAJLyoqCiAJICogUHJlcGFyZSBm
b3IgYXRvbWljIGNvbW1pdC4gIFRoaXMgaXMgY2FsbGVkIGFmdGVyIGFueSBwcmV2aW91cwogCSAq
IChhc3luYyBvciBvdGhlcndpc2UpIGNvbW1pdCBoYXMgY29tcGxldGVkLgpAQCAtMTA5LDIwICsx
MzEsNDggQEAgc3RydWN0IG1zbV9rbXNfZnVuY3MgewogI2VuZGlmCiB9OwogCitzdHJ1Y3QgbXNt
X2ttczsKKworLyoKKyAqIEEgcGVyLWNydGMgdGltZXIgZm9yIHBlbmRpbmcgYXN5bmMgYXRvbWlj
IGZsdXNoZXMuICBTY2hlZHVsZWQgdG8gZXhwaXJlCisgKiBzaG9ydGx5IGJlZm9yZSB2Ymxhbmsg
dG8gZmx1c2ggcGVuZGluZyBhc3luYyB1cGRhdGVzLgorICovCitzdHJ1Y3QgbXNtX3BlbmRpbmdf
dGltZXIgeworCXN0cnVjdCBocnRpbWVyIHRpbWVyOworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3Jr
OworCXN0cnVjdCBtc21fa21zICprbXM7CisJdW5zaWduZWQgY3J0Y19pZHg7Cit9OworCiBzdHJ1
Y3QgbXNtX2ttcyB7CiAJY29uc3Qgc3RydWN0IG1zbV9rbXNfZnVuY3MgKmZ1bmNzOworCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXY7CiAKIAkvKiBpcnEgbnVtYmVyIHRvIGJlIHBhc3NlZCBvbiB0byBk
cm1faXJxX2luc3RhbGwgKi8KIAlpbnQgaXJxOwogCiAJLyogbWFwcGVyLWlkIHVzZWQgdG8gcmVx
dWVzdCBHRU0gYnVmZmVyIG1hcHBlZCBmb3Igc2Nhbm91dDogKi8KIAlzdHJ1Y3QgbXNtX2dlbV9h
ZGRyZXNzX3NwYWNlICphc3BhY2U7CisKKwkvKgorCSAqIEZvciBhc3luYyBjb21taXQsIHdoZXJl
IC0+Zmx1c2hfY29tbWl0KCkgYW5kIGxhdGVyIGhhcHBlbnMKKwkgKiBmcm9tIHRoZSBjcnRjJ3Mg
cGVuZGluZ190aW1lciBjbG9zZSB0byBlbmQgb2YgdGhlIGZyYW1lOgorCSAqLworCXN0cnVjdCBt
dXRleCBjb21taXRfbG9jazsKKwl1bnNpZ25lZCBwZW5kaW5nX2NydGNfbWFzazsKKwlzdHJ1Y3Qg
bXNtX3BlbmRpbmdfdGltZXIgcGVuZGluZ190aW1lcnNbTUFYX0NSVENTXTsKIH07CiAKIHN0YXRp
YyBpbmxpbmUgdm9pZCBtc21fa21zX2luaXQoc3RydWN0IG1zbV9rbXMgKmttcywKIAkJY29uc3Qg
c3RydWN0IG1zbV9rbXNfZnVuY3MgKmZ1bmNzKQogeworCXVuc2lnbmVkIGk7CisKKwltdXRleF9p
bml0KCZrbXMtPmNvbW1pdF9sb2NrKTsKIAlrbXMtPmZ1bmNzID0gZnVuY3M7CisKKwlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRShrbXMtPnBlbmRpbmdfdGltZXJzKTsgaSsrKQorCQltc21fYXRv
bWljX2luaXRfcGVuZGluZ190aW1lcigma21zLT5wZW5kaW5nX3RpbWVyc1tpXSwga21zLCBpKTsK
IH0KIAogc3RydWN0IG1zbV9rbXMgKm1kcDRfa21zX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
dik7Ci0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbA==
