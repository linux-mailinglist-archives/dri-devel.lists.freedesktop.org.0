Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 44500BF443
	for <lists+dri-devel@lfdr.de>; Thu, 26 Sep 2019 15:43:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CE9796ED32;
	Thu, 26 Sep 2019 13:43:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from foss.arm.com (foss.arm.com [217.140.110.172])
 by gabe.freedesktop.org (Postfix) with ESMTP id C46116ED32
 for <dri-devel@lists.freedesktop.org>; Thu, 26 Sep 2019 13:43:26 +0000 (UTC)
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
 by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 2587F142F;
 Thu, 26 Sep 2019 06:43:26 -0700 (PDT)
Received: from [10.1.196.133] (e112269-lin.cambridge.arm.com [10.1.196.133])
 by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 214DF3F534;
 Thu, 26 Sep 2019 06:43:25 -0700 (PDT)
Subject: Re: [PATCH v3] drm: Don't free jobs in wait_event_interruptible()
To: "Koenig, Christian" <Christian.Koenig@amd.com>,
 Daniel Vetter <daniel@ffwll.ch>, David Airlie <airlied@linux.ie>
References: <20190926123134.4947-1-steven.price@arm.com>
 <73f058bb-8ba8-611b-e3a0-f6282445179c@amd.com>
From: Steven Price <steven.price@arm.com>
Message-ID: <f045e1d6-5263-58c2-ce28-2cd215067bdb@arm.com>
Date: Thu, 26 Sep 2019 14:43:23 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.9.0
MIME-Version: 1.0
In-Reply-To: <73f058bb-8ba8-611b-e3a0-f6282445179c@amd.com>
Content-Language: en-GB
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Nayan Deshmukh <nayan26deshmukh@gmail.com>, "Deucher,
 Alexander" <Alexander.Deucher@amd.com>,
 Sharat Masetty <smasetty@codeaurora.org>,
 "linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>,
 "dri-devel@lists.freedesktop.org" <dri-devel@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gMjYvMDkvMjAxOSAxNDozNywgS29lbmlnLCBDaHJpc3RpYW4gd3JvdGU6Cj4gQW0gMjYuMDku
MTkgdW0gMTQ6MzEgc2NocmllYiBTdGV2ZW4gUHJpY2U6Cj4+IGRybV9zY2hlZF9jbGVhbnVwX2pv
YnMoKSBhdHRlbXB0cyB0byBmcmVlIGZpbmlzaGVkIGpvYnMsIGhvd2V2ZXIgYmVjYXVzZQo+PiBp
dCBpcyBjYWxsZWQgYXMgdGhlIGNvbmRpdGlvbiBvZiB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUo
KSBpdCBtdXN0IG5vdAo+PiBzbGVlcC4gVW5mb3J0dWFudGx5IHNvbWUgZnJlZSBjYWxsYmFja3Mg
KG5vdGlibHkgZm9yIFBhbmZyb3N0KSBkbyBzbGVlcC4KPj4KPj4gSW5zdGVhZCBsZXQncyByZW5h
bWUgZHJtX3NjaGVkX2NsZWFudXBfam9icygpIHRvCj4+IGRybV9zY2hlZF9nZXRfY2xlYW51cF9q
b2IoKSBhbmQgc2ltcGx5IHJldHVybiBhIGpvYiBmb3IgcHJvY2Vzc2luZyBpZgo+PiB0aGVyZSBp
cyBvbmUuIFRoZSBjYWxsZXIgY2FuIHRoZW4gY2FsbCB0aGUgZnJlZV9qb2IoKSBjYWxsYmFjayBv
dXRzaWRlCj4+IHRoZSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoKSB3aGVyZSBzbGVlcGluZyBp
cyBwb3NzaWJsZSBiZWZvcmUKPj4gcmUtY2hlY2tpbmcgYW5kIHJldHVybmluZyB0byBzbGVlcCBp
ZiBuZWNlc3NhcnkuCj4+Cj4+IFNpZ25lZC1vZmYtYnk6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnBy
aWNlQGFybS5jb20+Cj4+IC0tLQo+Pgo+PiBDaGFuZ2VzIGZyb20gdjI6Cj4+ICAgKiBBY3R1YWxs
eSBtb3ZlIGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgpIHdpdGhpbiB0aGUgbG9jawo+Pgo+PiAg
IGRyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jIHwgNDIgKysrKysrKysrKysr
KystLS0tLS0tLS0tLS0KPj4gICAxIGZpbGUgY2hhbmdlZCwgMjMgaW5zZXJ0aW9ucygrKSwgMTkg
ZGVsZXRpb25zKC0pCj4+Cj4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vc2NoZWR1bGVy
L3NjaGVkX21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9zY2hlZHVsZXIvc2NoZWRfbWFpbi5jCj4+
IGluZGV4IDlhMGVlNzRkODJkYy4uZTRiZDc5MmYyYjI5IDEwMDY0NAo+PiAtLS0gYS9kcml2ZXJz
L2dwdS9kcm0vc2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiArKysgYi9kcml2ZXJzL2dwdS9kcm0v
c2NoZWR1bGVyL3NjaGVkX21haW4uYwo+PiBAQCAtNjIyLDQzICs2MjIsNDEgQEAgc3RhdGljIHZv
aWQgZHJtX3NjaGVkX3Byb2Nlc3Nfam9iKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFf
ZmVuY2VfY2IgKmNiKQo+PiAgIH0KPj4gICAKPj4gICAvKioKPj4gLSAqIGRybV9zY2hlZF9jbGVh
bnVwX2pvYnMgLSBkZXN0cm95IGZpbmlzaGVkIGpvYnMKPj4gKyAqIGRybV9zY2hlZF9nZXRfY2xl
YW51cF9qb2IgLSBmZXRjaCB0aGUgbmV4dCBmaW5pc2hlZCBqb2IgdG8gYmUgZGVzdHJveWVkCj4+
ICAgICoKPj4gICAgKiBAc2NoZWQ6IHNjaGVkdWxlciBpbnN0YW5jZQo+PiAgICAqCj4+IC0gKiBS
ZW1vdmUgYWxsIGZpbmlzaGVkIGpvYnMgZnJvbSB0aGUgbWlycm9yIGxpc3QgYW5kIGRlc3Ryb3kg
dGhlbS4KPj4gKyAqIFJldHVybnMgdGhlIG5leHQgZmluaXNoZWQgam9iIGZyb20gdGhlIG1pcnJv
ciBsaXN0IChpZiB0aGVyZSBpcyBvbmUpCj4+ICsgKiByZWFkeSBmb3IgaXQgdG8gYmUgZGVzdHJv
eWVkLgo+PiAgICAqLwo+PiAtc3RhdGljIHZvaWQgZHJtX3NjaGVkX2NsZWFudXBfam9icyhzdHJ1
Y3QgZHJtX2dwdV9zY2hlZHVsZXIgKnNjaGVkKQo+PiArc3RhdGljIHN0cnVjdCBkcm1fc2NoZWRf
am9iICoKPj4gK2RybV9zY2hlZF9nZXRfY2xlYW51cF9qb2Ioc3RydWN0IGRybV9ncHVfc2NoZWR1
bGVyICpzY2hlZCkKPj4gICB7Cj4+ICsJc3RydWN0IGRybV9zY2hlZF9qb2IgKmpvYiA9IE5VTEw7
Cj4+ICAgCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Cj4+ICAgCj4+ICAgCS8qIERvbid0IGRlc3Ryb3kg
am9icyB3aGlsZSB0aGUgdGltZW91dCB3b3JrZXIgaXMgcnVubmluZyAqLwo+PiAgIAlpZiAoc2No
ZWQtPnRpbWVvdXQgIT0gTUFYX1NDSEVEVUxFX1RJTUVPVVQgJiYKPj4gICAJICAgICFjYW5jZWxf
ZGVsYXllZF93b3JrKCZzY2hlZC0+d29ya190ZHIpKQo+PiAtCQlyZXR1cm47Cj4+IC0KPj4gKwkJ
cmV0dXJuIE5VTEw7Cj4+ICAgCj4+IC0Jd2hpbGUgKCFsaXN0X2VtcHR5KCZzY2hlZC0+cmluZ19t
aXJyb3JfbGlzdCkpIHsKPj4gLQkJc3RydWN0IGRybV9zY2hlZF9qb2IgKmpvYjsKPj4gKwlzcGlu
X2xvY2tfaXJxc2F2ZSgmc2NoZWQtPmpvYl9saXN0X2xvY2ssIGZsYWdzKTsKPj4gICAKPj4gLQkJ
am9iID0gbGlzdF9maXJzdF9lbnRyeSgmc2NoZWQtPnJpbmdfbWlycm9yX2xpc3QsCj4+ICsJam9i
ID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZzY2hlZC0+cmluZ19taXJyb3JfbGlzdCwKPj4g
ICAJCQkJICAgICAgIHN0cnVjdCBkcm1fc2NoZWRfam9iLCBub2RlKTsKPj4gLQkJaWYgKCFkbWFf
ZmVuY2VfaXNfc2lnbmFsZWQoJmpvYi0+c19mZW5jZS0+ZmluaXNoZWQpKQo+PiAtCQkJYnJlYWs7
Cj4+ICAgCj4+IC0JCXNwaW5fbG9ja19pcnFzYXZlKCZzY2hlZC0+am9iX2xpc3RfbG9jaywgZmxh
Z3MpOwo+PiArCWlmIChqb2IgJiYgZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKCZqb2ItPnNfZmVuY2Ut
PmZpbmlzaGVkKSkgewo+PiAgIAkJLyogcmVtb3ZlIGpvYiBmcm9tIHJpbmdfbWlycm9yX2xpc3Qg
Ki8KPj4gICAJCWxpc3RfZGVsX2luaXQoJmpvYi0+bm9kZSk7Cj4+IC0JCXNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJnNjaGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+IC0KPj4gLQkJc2NoZWQt
Pm9wcy0+ZnJlZV9qb2Ioam9iKTsKPj4gKwl9IGVsc2Ugewo+PiArCQlqb2IgPSBOVUxMOwo+PiAr
CQkvKiBxdWV1ZSB0aW1lb3V0IGZvciBuZXh0IGpvYiAqLwo+PiArCQlkcm1fc2NoZWRfc3RhcnRf
dGltZW91dChzY2hlZCk7Cj4gCj4gU29ycnkgSSd2ZSBvbmx5IHNlZW4gdGhpcyByaWdodCBub3c6
IFRoaXMgd29uJ3Qgd29yay4KPiAKPiBTZWUgeW91IGFsd2F5cyBuZWVkIHRvIHN0YXJ0IHRoZSB0
aW1lb3V0LCBvciBjYW5jZWxfZGVsYXllZF93b3JrKCkgd2lsbCAKPiBhYm9ydCB0aGUgd2hvbGUg
dGhpbmcgYWZ0ZXIgcmV0dXJuaW5nIHRoZSBmaXJzdCBqb2IuCgpHb29kIHNwb3QhCgpNeSBsb2dp
YyB3YXMgdGhhdCBkcm1fc2NoZWRfbWFpbigpIHdvdWxkIGNhbGwgYWdhaW4gYW5kIHRoYXQgd291
bGQKcmUtYXJtIHRoZSB0aW1lb3V0IGFmdGVyIHRoZSBqb2IgaGFzIGJlZW4gY29tcGxldGVkLgoK
QnV0IGxvb2tpbmcgYXQgdGhpcyBtb3JlIGNsb3NlbHkgSSBzZWUgdGhhdCBpc24ndCBhY3R1YWxs
eSBnb2luZyB0byB3b3JrCnJlbGlhYmx5IC0gaWYgdGhlIHdvcmsgaGFzIGJlZW4gY2FuY2VsbGVk
IHRoZSBmaXJzdCB0aW1lIHRoZW4KY2FuY2VsX2RlbGF5ZWRfd29yaygpIHdpbGwgcmV0dXJuIGZh
bHNlIGNhdXNpbmcgYW4gZWFybHkgb3V0IGFuZCB0aGUKdGltZW91dCBpc24ndCByZS1hcm1lZC4K
CklzIGl0IGFzIHNpbXBsZSBhcyBtb3ZpbmcgZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQoKSBvdXQg
b2YgdGhlIGVsc2UgY2FzZQphbmQgdW5jb25kaXRpb25hbGx5IHJlLWFybWluZyB0aGUgdGltZW91
dD8gSSdtIHdvcnJpZWQgYWJvdXQgcmFjZXMgd2l0aAp0aGUgam9iIHRoYXQgaXMgYmVpbmcgcmV0
dXJuZWQsIGFsdGhvdWdoIGl0IGhhcyBhbHJlYWR5IGJlZW4gcmVtb3ZlZApmcm9tIHJpbmdfbWly
cm9yX2xpc3Qgc28gcGVyaGFwcyBpdCdzIHNhZmUgdG8gZG8/CgpBbHRlcm5hdGl2ZWx5IHRoZSBj
YWxsZXIgY291bGQgbWFudWFsbHkgcmUtYXJtIHRoZSB0aW1lb3V0IGFmdGVyCmhhbmRsaW5nIHRo
ZSBqb2IgZnJlZS4KClN0ZXZlCgo+IENocmlzdGlhbi4KPiAKPj4gICAJfQo+PiAgIAo+PiAtCS8q
IHF1ZXVlIHRpbWVvdXQgZm9yIG5leHQgam9iICovCj4+IC0Jc3Bpbl9sb2NrX2lycXNhdmUoJnNj
aGVkLT5qb2JfbGlzdF9sb2NrLCBmbGFncyk7Cj4+IC0JZHJtX3NjaGVkX3N0YXJ0X3RpbWVvdXQo
c2NoZWQpOwo+PiAgIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZzY2hlZC0+am9iX2xpc3RfbG9j
aywgZmxhZ3MpOwo+PiAgIAo+PiArCXJldHVybiBqb2I7Cj4+ICAgfQo+PiAgIAo+PiAgIC8qKgo+
PiBAQCAtNjk4LDEyICs2OTYsMTggQEAgc3RhdGljIGludCBkcm1fc2NoZWRfbWFpbih2b2lkICpw
YXJhbSkKPj4gICAJCXN0cnVjdCBkcm1fc2NoZWRfZmVuY2UgKnNfZmVuY2U7Cj4+ICAgCQlzdHJ1
Y3QgZHJtX3NjaGVkX2pvYiAqc2NoZWRfam9iOwo+PiAgIAkJc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2U7Cj4+ICsJCXN0cnVjdCBkcm1fc2NoZWRfam9iICpjbGVhbnVwX2pvYiA9IE5VTEw7Cj4+ICAg
Cj4+ICAgCQl3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoc2NoZWQtPndha2VfdXBfd29ya2VyLAo+
PiAtCQkJCQkgKGRybV9zY2hlZF9jbGVhbnVwX2pvYnMoc2NoZWQpLAo+PiArCQkJCQkgKGNsZWFu
dXBfam9iID0gZHJtX3NjaGVkX2dldF9jbGVhbnVwX2pvYihzY2hlZCkpIHx8Cj4+ICAgCQkJCQkg
KCFkcm1fc2NoZWRfYmxvY2tlZChzY2hlZCkgJiYKPj4gICAJCQkJCSAgKGVudGl0eSA9IGRybV9z
Y2hlZF9zZWxlY3RfZW50aXR5KHNjaGVkKSkpIHx8Cj4+IC0JCQkJCSBrdGhyZWFkX3Nob3VsZF9z
dG9wKCkpKTsKPj4gKwkJCQkJIGt0aHJlYWRfc2hvdWxkX3N0b3AoKSk7Cj4+ICsKPj4gKwkJd2hp
bGUgKGNsZWFudXBfam9iKSB7Cj4+ICsJCQlzY2hlZC0+b3BzLT5mcmVlX2pvYihjbGVhbnVwX2pv
Yik7Cj4+ICsJCQljbGVhbnVwX2pvYiA9IGRybV9zY2hlZF9nZXRfY2xlYW51cF9qb2Ioc2NoZWQp
Owo+PiArCQl9Cj4+ICAgCj4+ICAgCQlpZiAoIWVudGl0eSkKPj4gICAJCQljb250aW51ZTsKPiAK
PiBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwo+IGRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKPiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCj4gaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwKPiAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZl
bCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
