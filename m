Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 030F145C5D
	for <lists+dri-devel@lfdr.de>; Fri, 14 Jun 2019 14:13:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 09D9289715;
	Fri, 14 Jun 2019 12:13:51 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay9-d.mail.gandi.net (relay9-d.mail.gandi.net
 [217.70.183.199])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D1C638970B
 for <dri-devel@lists.freedesktop.org>; Fri, 14 Jun 2019 12:13:46 +0000 (UTC)
X-Originating-IP: 90.88.23.150
Received: from localhost (aaubervilliers-681-1-81-150.w90-88.abo.wanadoo.fr
 [90.88.23.150]) (Authenticated sender: maxime.ripard@bootlin.com)
 by relay9-d.mail.gandi.net (Postfix) with ESMTPSA id 44859FF80C;
 Fri, 14 Jun 2019 12:13:43 +0000 (UTC)
From: Maxime Ripard <maxime.ripard@bootlin.com>
To: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Sean Paul <seanpaul@chromium.org>,
 Maxime Ripard <maxime.ripard@bootlin.com>,
 Daniel Vetter <daniel.vetter@intel.com>, David Airlie <airlied@linux.ie>
Subject: [PATCH v4 05/12] drm/modes: Rewrite the command line parser
Date: Fri, 14 Jun 2019 14:13:12 +0200
Message-Id: <0797f942f8c79a3825974fe9584e810e515ab8e0.1560514379.git-series.maxime.ripard@bootlin.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <cover.5fc7840dc8fb24744516c13acb8c8aa18e44c0d0.1560514379.git-series.maxime.ripard@bootlin.com>
References: <cover.5fc7840dc8fb24744516c13acb8c8aa18e44c0d0.1560514379.git-series.maxime.ripard@bootlin.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: eben@raspberrypi.org, dri-devel@lists.freedesktop.org,
 Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
 Thomas Petazzoni <thomas.petazzoni@bootlin.com>,
 Maxime Ripard <maxime.ripard@free-electrons.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogTWF4aW1lIFJpcGFyZCA8bWF4aW1lLnJpcGFyZEBmcmVlLWVsZWN0cm9ucy5jb20+CgpS
ZXdyaXRlIHRoZSBjb21tYW5kIGxpbmUgcGFyc2VyIGluIG9yZGVyIHRvIGdldCBhd2F5IGZyb20g
dGhlIHN0YXRlIG1hY2hpbmUKcGFyc2luZyB0aGUgdmlkZW8gbW9kZSBsaW5lcy4KCkhvcGVmdWxs
eSwgdGhpcyB3aWxsIGFsbG93IHRvIGV4dGVuZCBpdCBtb3JlIGVhc2lseSB0byBzdXBwb3J0IG5h
bWVkIG1vZGVzCmFuZCAvIG9yIHByb3BlcnRpZXMgc2V0IGRpcmVjdGx5IG9uIHRoZSBjb21tYW5k
IGxpbmUuCgpTaWduZWQtb2ZmLWJ5OiBNYXhpbWUgUmlwYXJkIDxtYXhpbWUucmlwYXJkQGZyZWUt
ZWxlY3Ryb25zLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX21vZGVzLmMgfCAzMjUgKysr
KysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDIxMCBp
bnNlcnRpb25zKCspLCAxMTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2RybV9tb2Rlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9tb2Rlcy5jCmluZGV4IDVhMDdh
MjhmZWM2ZC4uNmRlYmJkNmMxNzYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX21v
ZGVzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9tb2Rlcy5jCkBAIC0zMCw2ICszMCw3IEBA
CiAgKiBhdXRob3JpemF0aW9uIGZyb20gdGhlIGNvcHlyaWdodCBob2xkZXIocykgYW5kIGF1dGhv
cihzKS4KICAqLwogCisjaW5jbHVkZSA8bGludXgvY3R5cGUuaD4KICNpbmNsdWRlIDxsaW51eC9s
aXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbGlzdF9zb3J0Lmg+CiAjaW5jbHVkZSA8bGludXgvZXhw
b3J0Lmg+CkBAIC0xNDA4LDYgKzE0MDksMTUxIEBAIHZvaWQgZHJtX2Nvbm5lY3Rvcl9saXN0X3Vw
ZGF0ZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogfQogRVhQT1JUX1NZTUJPTChk
cm1fY29ubmVjdG9yX2xpc3RfdXBkYXRlKTsKIAorc3RhdGljIGludCBkcm1fbW9kZV9wYXJzZV9j
bWRsaW5lX2JwcChjb25zdCBjaGFyICpzdHIsIGNoYXIgKiplbmRfcHRyLAorCQkJCSAgICAgIHN0
cnVjdCBkcm1fY21kbGluZV9tb2RlICptb2RlKQoreworCXVuc2lnbmVkIGludCBicHA7CisKKwlp
ZiAoc3RyWzBdICE9ICctJykKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlzdHIrKzsKKwlicHAgPSBz
aW1wbGVfc3RydG9sKHN0ciwgZW5kX3B0ciwgMTApOworCWlmICgqZW5kX3B0ciA9PSBzdHIpCisJ
CXJldHVybiAtRUlOVkFMOworCisJbW9kZS0+YnBwID0gYnBwOworCW1vZGUtPmJwcF9zcGVjaWZp
ZWQgPSB0cnVlOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZHJtX21vZGVfcGFyc2Vf
Y21kbGluZV9yZWZyZXNoKGNvbnN0IGNoYXIgKnN0ciwgY2hhciAqKmVuZF9wdHIsCisJCQkJCSAg
c3RydWN0IGRybV9jbWRsaW5lX21vZGUgKm1vZGUpCit7CisJdW5zaWduZWQgaW50IHJlZnJlc2g7
CisKKwlpZiAoc3RyWzBdICE9ICdAJykKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlzdHIrKzsKKwly
ZWZyZXNoID0gc2ltcGxlX3N0cnRvbChzdHIsIGVuZF9wdHIsIDEwKTsKKwlpZiAoKmVuZF9wdHIg
PT0gc3RyKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCW1vZGUtPnJlZnJlc2ggPSByZWZyZXNoOwor
CW1vZGUtPnJlZnJlc2hfc3BlY2lmaWVkID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGRybV9tb2RlX3BhcnNlX2NtZGxpbmVfZXh0cmEoY29uc3QgY2hhciAqc3RyLCBpbnQg
bGVuZ3RoLAorCQkJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCQlzdHJ1
Y3QgZHJtX2NtZGxpbmVfbW9kZSAqbW9kZSkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkg
PCBsZW5ndGg7IGkrKykgeworCQlzd2l0Y2ggKHN0cltpXSkgeworCQljYXNlICdpJzoKKwkJCW1v
ZGUtPmludGVybGFjZSA9IHRydWU7CisJCQlicmVhazsKKwkJY2FzZSAnbSc6CisJCQltb2RlLT5t
YXJnaW5zID0gdHJ1ZTsKKwkJCWJyZWFrOworCQljYXNlICdEJzoKKwkJCWlmIChtb2RlLT5mb3Jj
ZSAhPSBEUk1fRk9SQ0VfVU5TUEVDSUZJRUQpCisJCQkJcmV0dXJuIC1FSU5WQUw7CisKKwkJCWlm
ICgoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSAhPSBEUk1fTU9ERV9DT05ORUNUT1JfRFZJSSkg
JiYKKwkJCSAgICAoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSAhPSBEUk1fTU9ERV9DT05ORUNU
T1JfSERNSUIpKQorCQkJCW1vZGUtPmZvcmNlID0gRFJNX0ZPUkNFX09OOworCQkJZWxzZQorCQkJ
CW1vZGUtPmZvcmNlID0gRFJNX0ZPUkNFX09OX0RJR0lUQUw7CisJCQlicmVhazsKKwkJY2FzZSAn
ZCc6CisJCQlpZiAobW9kZS0+Zm9yY2UgIT0gRFJNX0ZPUkNFX1VOU1BFQ0lGSUVEKQorCQkJCXJl
dHVybiAtRUlOVkFMOworCisJCQltb2RlLT5mb3JjZSA9IERSTV9GT1JDRV9PRkY7CisJCQlicmVh
azsKKwkJY2FzZSAnZSc6CisJCQlpZiAobW9kZS0+Zm9yY2UgIT0gRFJNX0ZPUkNFX1VOU1BFQ0lG
SUVEKQorCQkJCXJldHVybiAtRUlOVkFMOworCisJCQltb2RlLT5mb3JjZSA9IERSTV9GT1JDRV9P
TjsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwl9CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBkcm1fbW9kZV9wYXJzZV9jbWRsaW5lX3Jlc19t
b2RlKGNvbnN0IGNoYXIgKnN0ciwgdW5zaWduZWQgaW50IGxlbmd0aCwKKwkJCQkJICAgYm9vbCBl
eHRyYXMsCisJCQkJCSAgIHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCSAg
IHN0cnVjdCBkcm1fY21kbGluZV9tb2RlICptb2RlKQoreworCWNvbnN0IGNoYXIgKnN0cl9zdGFy
dCA9IHN0cjsKKwlib29sIHJiID0gZmFsc2UsIGN2dCA9IGZhbHNlOworCWludCB4cmVzID0gMCwg
eXJlcyA9IDA7CisJaW50IHJlbWFpbmluZywgaTsKKwljaGFyICplbmRfcHRyOworCisJeHJlcyA9
IHNpbXBsZV9zdHJ0b2woc3RyLCAmZW5kX3B0ciwgMTApOworCWlmIChlbmRfcHRyID09IHN0cikK
KwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZW5kX3B0clswXSAhPSAneCcpCisJCXJldHVybiAt
RUlOVkFMOworCWVuZF9wdHIrKzsKKworCXN0ciA9IGVuZF9wdHI7CisJeXJlcyA9IHNpbXBsZV9z
dHJ0b2woc3RyLCAmZW5kX3B0ciwgMTApOworCWlmIChlbmRfcHRyID09IHN0cikKKwkJcmV0dXJu
IC1FSU5WQUw7CisKKwlyZW1haW5pbmcgPSBsZW5ndGggLSAoZW5kX3B0ciAtIHN0cl9zdGFydCk7
CisJaWYgKHJlbWFpbmluZyA8IDApCisJCXJldHVybiAtRUlOVkFMOworCisJZm9yIChpID0gMDsg
aSA8IHJlbWFpbmluZzsgaSsrKSB7CisJCXN3aXRjaCAoZW5kX3B0cltpXSkgeworCQljYXNlICdN
JzoKKwkJCWN2dCA9IHRydWU7CisJCQlicmVhazsKKwkJY2FzZSAnUic6CisJCQlyYiA9IHRydWU7
CisJCQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCS8qCisJCQkgKiBUcnkgdG8gcGFzcyB0aGF0IHRv
IG91ciBleHRyYXMgcGFyc2luZworCQkJICogZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBjYXNlIHdo
ZXJlIHRoZQorCQkJICogZXh0cmFzIGFyZSBkaXJlY3RseSBhZnRlciB0aGUgcmVzb2x1dGlvbgor
CQkJICovCisJCQlpZiAoZXh0cmFzKSB7CisJCQkJaW50IHJldCA9IGRybV9tb2RlX3BhcnNlX2Nt
ZGxpbmVfZXh0cmEoZW5kX3B0ciArIGksCisJCQkJCQkJCSAgICAgICAxLAorCQkJCQkJCQkgICAg
ICAgY29ubmVjdG9yLAorCQkJCQkJCQkgICAgICAgbW9kZSk7CisJCQkJaWYgKHJldCkKKwkJCQkJ
cmV0dXJuIHJldDsKKwkJCX0gZWxzZSB7CisJCQkJcmV0dXJuIC1FSU5WQUw7CisJCQl9CisJCX0K
Kwl9CisKKwltb2RlLT54cmVzID0geHJlczsKKwltb2RlLT55cmVzID0geXJlczsKKwltb2RlLT5j
dnQgPSBjdnQ7CisJbW9kZS0+cmIgPSByYjsKKworCXJldHVybiAwOworfQorCiAvKioKICAqIGRy
bV9tb2RlX3BhcnNlX2NvbW1hbmRfbGluZV9mb3JfY29ubmVjdG9yIC0gcGFyc2UgY29tbWFuZCBs
aW5lIG1vZGVsaW5lIGZvciBjb25uZWN0b3IKICAqIEBtb2RlX29wdGlvbjogb3B0aW9uYWwgcGVy
IGNvbm5lY3RvciBtb2RlIG9wdGlvbgpAQCAtMTQzNCwxMyArMTU4MCwxMiBAQCBib29sIGRybV9t
b2RlX3BhcnNlX2NvbW1hbmRfbGluZV9mb3JfY29ubmVjdG9yKGNvbnN0IGNoYXIgKm1vZGVfb3B0
aW9uLAogCQkJCQkgICAgICAgc3RydWN0IGRybV9jbWRsaW5lX21vZGUgKm1vZGUpCiB7CiAJY29u
c3QgY2hhciAqbmFtZTsKLQl1bnNpZ25lZCBpbnQgbmFtZWxlbjsKLQlib29sIHJlc19zcGVjaWZp
ZWQgPSBmYWxzZSwgYnBwX3NwZWNpZmllZCA9IGZhbHNlLCByZWZyZXNoX3NwZWNpZmllZCA9IGZh
bHNlOwotCXVuc2lnbmVkIGludCB4cmVzID0gMCwgeXJlcyA9IDAsIGJwcCA9IDMyLCByZWZyZXNo
ID0gMDsKLQlib29sIHlyZXNfc3BlY2lmaWVkID0gZmFsc2UsIGN2dCA9IGZhbHNlLCByYiA9IGZh
bHNlOwotCWJvb2wgaW50ZXJsYWNlID0gZmFsc2UsIG1hcmdpbnMgPSBmYWxzZSwgd2FzX2RpZ2l0
ID0gZmFsc2U7Ci0JaW50IGk7Ci0JZW51bSBkcm1fY29ubmVjdG9yX2ZvcmNlIGZvcmNlID0gRFJN
X0ZPUkNFX1VOU1BFQ0lGSUVEOworCWJvb2wgcGFyc2VfZXh0cmFzID0gZmFsc2U7CisJdW5zaWdu
ZWQgaW50IGJwcF9vZmYgPSAwLCByZWZyZXNoX29mZiA9IDA7CisJdW5zaWduZWQgaW50IG1vZGVf
ZW5kID0gMDsKKwljaGFyICpicHBfcHRyID0gTlVMTCwgKnJlZnJlc2hfcHRyID0gTlVMTCwgKmV4
dHJhX3B0ciA9IE5VTEw7CisJY2hhciAqYnBwX2VuZF9wdHIgPSBOVUxMLCAqcmVmcmVzaF9lbmRf
cHRyID0gTlVMTDsKKwlpbnQgcmV0OwogCiAjaWZkZWYgQ09ORklHX0ZCCiAJaWYgKCFtb2RlX29w
dGlvbikKQEAgLTE0NTMsMTI3ICsxNTk4LDc3IEBAIGJvb2wgZHJtX21vZGVfcGFyc2VfY29tbWFu
ZF9saW5lX2Zvcl9jb25uZWN0b3IoY29uc3QgY2hhciAqbW9kZV9vcHRpb24sCiAJfQogCiAJbmFt
ZSA9IG1vZGVfb3B0aW9uOwotCW5hbWVsZW4gPSBzdHJsZW4obmFtZSk7Ci0JZm9yIChpID0gbmFt
ZWxlbi0xOyBpID49IDA7IGktLSkgewotCQlzd2l0Y2ggKG5hbWVbaV0pIHsKLQkJY2FzZSAnQCc6
Ci0JCQlpZiAoIXJlZnJlc2hfc3BlY2lmaWVkICYmICFicHBfc3BlY2lmaWVkICYmCi0JCQkgICAg
IXlyZXNfc3BlY2lmaWVkICYmICFjdnQgJiYgIXJiICYmIHdhc19kaWdpdCkgewotCQkJCXJlZnJl
c2ggPSBzaW1wbGVfc3RydG9sKCZuYW1lW2krMV0sIE5VTEwsIDEwKTsKLQkJCQlyZWZyZXNoX3Nw
ZWNpZmllZCA9IHRydWU7Ci0JCQkJd2FzX2RpZ2l0ID0gZmFsc2U7Ci0JCQl9IGVsc2UKLQkJCQln
b3RvIGRvbmU7Ci0JCQlicmVhazsKLQkJY2FzZSAnLSc6Ci0JCQlpZiAoIWJwcF9zcGVjaWZpZWQg
JiYgIXlyZXNfc3BlY2lmaWVkICYmICFjdnQgJiYKLQkJCSAgICAhcmIgJiYgd2FzX2RpZ2l0KSB7
Ci0JCQkJYnBwID0gc2ltcGxlX3N0cnRvbCgmbmFtZVtpKzFdLCBOVUxMLCAxMCk7Ci0JCQkJYnBw
X3NwZWNpZmllZCA9IHRydWU7Ci0JCQkJd2FzX2RpZ2l0ID0gZmFsc2U7Ci0JCQl9IGVsc2UKLQkJ
CQlnb3RvIGRvbmU7Ci0JCQlicmVhazsKLQkJY2FzZSAneCc6Ci0JCQlpZiAoIXlyZXNfc3BlY2lm
aWVkICYmIHdhc19kaWdpdCkgewotCQkJCXlyZXMgPSBzaW1wbGVfc3RydG9sKCZuYW1lW2krMV0s
IE5VTEwsIDEwKTsKLQkJCQl5cmVzX3NwZWNpZmllZCA9IHRydWU7Ci0JCQkJd2FzX2RpZ2l0ID0g
ZmFsc2U7Ci0JCQl9IGVsc2UKLQkJCQlnb3RvIGRvbmU7Ci0JCQlicmVhazsKLQkJY2FzZSAnMCcg
Li4uICc5JzoKLQkJCXdhc19kaWdpdCA9IHRydWU7Ci0JCQlicmVhazsKLQkJY2FzZSAnTSc6Ci0J
CQlpZiAoeXJlc19zcGVjaWZpZWQgfHwgY3Z0IHx8IHdhc19kaWdpdCkKLQkJCQlnb3RvIGRvbmU7
Ci0JCQljdnQgPSB0cnVlOwotCQkJYnJlYWs7Ci0JCWNhc2UgJ1InOgotCQkJaWYgKHlyZXNfc3Bl
Y2lmaWVkIHx8IGN2dCB8fCByYiB8fCB3YXNfZGlnaXQpCi0JCQkJZ290byBkb25lOwotCQkJcmIg
PSB0cnVlOwotCQkJYnJlYWs7Ci0JCWNhc2UgJ20nOgotCQkJaWYgKGN2dCB8fCB5cmVzX3NwZWNp
ZmllZCB8fCB3YXNfZGlnaXQpCi0JCQkJZ290byBkb25lOwotCQkJbWFyZ2lucyA9IHRydWU7Ci0J
CQlicmVhazsKLQkJY2FzZSAnaSc6Ci0JCQlpZiAoY3Z0IHx8IHlyZXNfc3BlY2lmaWVkIHx8IHdh
c19kaWdpdCkKLQkJCQlnb3RvIGRvbmU7Ci0JCQlpbnRlcmxhY2UgPSB0cnVlOwotCQkJYnJlYWs7
Ci0JCWNhc2UgJ2UnOgotCQkJaWYgKHlyZXNfc3BlY2lmaWVkIHx8IGJwcF9zcGVjaWZpZWQgfHwg
cmVmcmVzaF9zcGVjaWZpZWQgfHwKLQkJCSAgICB3YXNfZGlnaXQgfHwgKGZvcmNlICE9IERSTV9G
T1JDRV9VTlNQRUNJRklFRCkpCi0JCQkJZ290byBkb25lOwogCi0JCQlmb3JjZSA9IERSTV9GT1JD
RV9PTjsKLQkJCWJyZWFrOwotCQljYXNlICdEJzoKLQkJCWlmICh5cmVzX3NwZWNpZmllZCB8fCBi
cHBfc3BlY2lmaWVkIHx8IHJlZnJlc2hfc3BlY2lmaWVkIHx8Ci0JCQkgICAgd2FzX2RpZ2l0IHx8
IChmb3JjZSAhPSBEUk1fRk9SQ0VfVU5TUEVDSUZJRUQpKQotCQkJCWdvdG8gZG9uZTsKKwlpZiAo
IWlzZGlnaXQobmFtZVswXSkpCisJCXJldHVybiBmYWxzZTsKIAotCQkJaWYgKChjb25uZWN0b3It
PmNvbm5lY3Rvcl90eXBlICE9IERSTV9NT0RFX0NPTk5FQ1RPUl9EVklJKSAmJgotCQkJICAgIChj
b25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlICE9IERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQikpCi0J
CQkJZm9yY2UgPSBEUk1fRk9SQ0VfT047Ci0JCQllbHNlCi0JCQkJZm9yY2UgPSBEUk1fRk9SQ0Vf
T05fRElHSVRBTDsKLQkJCWJyZWFrOwotCQljYXNlICdkJzoKLQkJCWlmICh5cmVzX3NwZWNpZmll
ZCB8fCBicHBfc3BlY2lmaWVkIHx8IHJlZnJlc2hfc3BlY2lmaWVkIHx8Ci0JCQkgICAgd2FzX2Rp
Z2l0IHx8IChmb3JjZSAhPSBEUk1fRk9SQ0VfVU5TUEVDSUZJRUQpKQotCQkJCWdvdG8gZG9uZTsK
KwkvKiBUcnkgdG8gbG9jYXRlIHRoZSBicHAgYW5kIHJlZnJlc2ggc3BlY2lmaWVycywgaWYgYW55
ICovCisJYnBwX3B0ciA9IHN0cmNocihuYW1lLCAnLScpOworCWlmIChicHBfcHRyKSB7CisJCWJw
cF9vZmYgPSBicHBfcHRyIC0gbmFtZTsKKwkJbW9kZS0+YnBwX3NwZWNpZmllZCA9IHRydWU7CisJ
fQogCi0JCQlmb3JjZSA9IERSTV9GT1JDRV9PRkY7Ci0JCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJ
CWdvdG8gZG9uZTsKLQkJfQorCXJlZnJlc2hfcHRyID0gc3RyY2hyKG5hbWUsICdAJyk7CisJaWYg
KHJlZnJlc2hfcHRyKSB7CisJCXJlZnJlc2hfb2ZmID0gcmVmcmVzaF9wdHIgLSBuYW1lOworCQlt
b2RlLT5yZWZyZXNoX3NwZWNpZmllZCA9IHRydWU7CiAJfQogCi0JaWYgKGkgPCAwICYmIHlyZXNf
c3BlY2lmaWVkKSB7Ci0JCWNoYXIgKmNoOwotCQl4cmVzID0gc2ltcGxlX3N0cnRvbChuYW1lLCAm
Y2gsIDEwKTsKLQkJaWYgKChjaCAhPSBOVUxMKSAmJiAoKmNoID09ICd4JykpCi0JCQlyZXNfc3Bl
Y2lmaWVkID0gdHJ1ZTsKLQkJZWxzZQotCQkJaSA9IGNoIC0gbmFtZTsKLQl9IGVsc2UgaWYgKCF5
cmVzX3NwZWNpZmllZCAmJiB3YXNfZGlnaXQpIHsKLQkJLyogY2F0Y2ggbW9kZSB0aGF0IGJlZ2lu
cyB3aXRoIGRpZ2l0cyBidXQgaGFzIG5vICd4JyAqLwotCQlpID0gMDsKKwkvKiBMb2NhdGUgdGhl
IGVuZCBvZiB0aGUgbmFtZSAvIHJlc29sdXRpb24sIGFuZCBwYXJzZSBpdCAqLworCWlmIChicHBf
cHRyICYmIHJlZnJlc2hfcHRyKSB7CisJCW1vZGVfZW5kID0gbWluKGJwcF9vZmYsIHJlZnJlc2hf
b2ZmKTsKKwl9IGVsc2UgaWYgKGJwcF9wdHIpIHsKKwkJbW9kZV9lbmQgPSBicHBfb2ZmOworCX0g
ZWxzZSBpZiAocmVmcmVzaF9wdHIpIHsKKwkJbW9kZV9lbmQgPSByZWZyZXNoX29mZjsKKwl9IGVs
c2UgeworCQltb2RlX2VuZCA9IHN0cmxlbihuYW1lKTsKKwkJcGFyc2VfZXh0cmFzID0gdHJ1ZTsK
IAl9Ci1kb25lOgotCWlmIChpID49IDApIHsKLQkJcHJfd2FybigiW2RybV0gcGFyc2UgZXJyb3Ig
YXQgcG9zaXRpb24gJWkgaW4gdmlkZW8gbW9kZSAnJXMnXG4iLAotCQkJaSwgbmFtZSk7Ci0JCW1v
ZGUtPnNwZWNpZmllZCA9IGZhbHNlOworCisJcmV0ID0gZHJtX21vZGVfcGFyc2VfY21kbGluZV9y
ZXNfbW9kZShuYW1lLCBtb2RlX2VuZCwKKwkJCQkJICAgICAgcGFyc2VfZXh0cmFzLAorCQkJCQkg
ICAgICBjb25uZWN0b3IsCisJCQkJCSAgICAgIG1vZGUpOworCWlmIChyZXQpCiAJCXJldHVybiBm
YWxzZTsKLQl9CisJbW9kZS0+c3BlY2lmaWVkID0gdHJ1ZTsKIAotCWlmIChyZXNfc3BlY2lmaWVk
KSB7Ci0JCW1vZGUtPnNwZWNpZmllZCA9IHRydWU7Ci0JCW1vZGUtPnhyZXMgPSB4cmVzOwotCQlt
b2RlLT55cmVzID0geXJlczsKKwlpZiAoYnBwX3B0cikgeworCQlyZXQgPSBkcm1fbW9kZV9wYXJz
ZV9jbWRsaW5lX2JwcChicHBfcHRyLCAmYnBwX2VuZF9wdHIsIG1vZGUpOworCQlpZiAocmV0KQor
CQkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWlmIChyZWZyZXNoX3NwZWNpZmllZCkgewotCQltb2Rl
LT5yZWZyZXNoX3NwZWNpZmllZCA9IHRydWU7Ci0JCW1vZGUtPnJlZnJlc2ggPSByZWZyZXNoOwor
CWlmIChyZWZyZXNoX3B0cikgeworCQlyZXQgPSBkcm1fbW9kZV9wYXJzZV9jbWRsaW5lX3JlZnJl
c2gocmVmcmVzaF9wdHIsCisJCQkJCQkgICAgICZyZWZyZXNoX2VuZF9wdHIsIG1vZGUpOworCQlp
ZiAocmV0KQorCQkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWlmIChicHBfc3BlY2lmaWVkKSB7Ci0J
CW1vZGUtPmJwcF9zcGVjaWZpZWQgPSB0cnVlOwotCQltb2RlLT5icHAgPSBicHA7CisJLyoKKwkg
KiBMb2NhdGUgdGhlIGVuZCBvZiB0aGUgYnBwIC8gcmVmcmVzaCwgYW5kIHBhcnNlIHRoZSBleHRy
YXMKKwkgKiBpZiByZWxldmFudAorCSAqLworCWlmIChicHBfcHRyICYmIHJlZnJlc2hfcHRyKQor
CQlleHRyYV9wdHIgPSBtYXgoYnBwX2VuZF9wdHIsIHJlZnJlc2hfZW5kX3B0cik7CisJZWxzZSBp
ZiAoYnBwX3B0cikKKwkJZXh0cmFfcHRyID0gYnBwX2VuZF9wdHI7CisJZWxzZSBpZiAocmVmcmVz
aF9wdHIpCisJCWV4dHJhX3B0ciA9IHJlZnJlc2hfZW5kX3B0cjsKKworCWlmIChleHRyYV9wdHIp
IHsKKwkJaW50IHJlbWFpbmluZyA9IHN0cmxlbihuYW1lKSAtIChleHRyYV9wdHIgLSBuYW1lKTsK
KworCQkvKgorCQkgKiBXZSBzdGlsbCBoYXZlIGNoYXJhY3RlcnMgdG8gcHJvY2Vzcywgd2hpbGUK
KwkJICogd2Ugc2hvdWxkbid0IGhhdmUgYW55CisJCSAqLworCQlpZiAocmVtYWluaW5nID4gMCkK
KwkJCXJldHVybiBmYWxzZTsKIAl9Ci0JbW9kZS0+cmIgPSByYjsKLQltb2RlLT5jdnQgPSBjdnQ7
Ci0JbW9kZS0+aW50ZXJsYWNlID0gaW50ZXJsYWNlOwotCW1vZGUtPm1hcmdpbnMgPSBtYXJnaW5z
OwotCW1vZGUtPmZvcmNlID0gZm9yY2U7CiAKIAlyZXR1cm4gdHJ1ZTsKIH0KLS0gCmdpdC1zZXJp
ZXMgMC45LjEKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
