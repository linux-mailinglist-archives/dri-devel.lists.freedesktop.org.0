Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2B8F9147A18
	for <lists+dri-devel@lfdr.de>; Fri, 24 Jan 2020 10:10:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 773FF6FFB1;
	Fri, 24 Jan 2020 09:10:06 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa2.bahnhof.se (ste-pvt-msa2.bahnhof.se
 [213.80.101.71])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AF47A6FFB1
 for <dri-devel@lists.freedesktop.org>; Fri, 24 Jan 2020 09:09:57 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTP id 4C7163F72A;
 Fri, 24 Jan 2020 10:09:56 +0100 (CET)
Authentication-Results: ste-pvt-msa2.bahnhof.se; dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=OfjyUN0p; 
 dkim-atps=neutral
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Authentication-Results: ste-ftg-msa2.bahnhof.se (amavisd-new);
 dkim=pass (1024-bit key) header.d=shipmail.org
Received: from ste-pvt-msa2.bahnhof.se ([127.0.0.1])
 by localhost (ste-ftg-msa2.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id HWelp0yngpkY; Fri, 24 Jan 2020 10:09:50 +0100 (CET)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTPA id 8BF4F3F6AC;
 Fri, 24 Jan 2020 10:09:50 +0100 (CET)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 3779A36065F;
 Fri, 24 Jan 2020 10:09:48 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple; d=shipmail.org; s=mail;
 t=1579856988; bh=463+tP6m2Ktw+6/G5q0gRLiuKfDYtDq4dJFl1MBk+B4=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=OfjyUN0pghPj7GssynL8Wle7HhSjH+eTmepdlRP9NZumU1uM4TGUPDhYUTAXn7pp+
 UIFZCXInZBuX9JmwblqDkBKrHeX1u7hBBVFN3nspMKTfBRk7Cp14v8JiBbj8vA1IcU
 hCfkXW96g+iGuo+gjsNorVaSngFJy/yMBpqwJDRY=
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: linux-mm@kvack.org, dri-devel@lists.freedesktop.org,
 linux-kernel@vger.kernel.org
Subject: [PATCH 5/9] mm, drm/ttm, drm/vmwgfx: Support huge TTM pagefaults
Date: Fri, 24 Jan 2020 10:09:36 +0100
Message-Id: <20200124090940.26571-6-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20200124090940.26571-1-thomas_os@shipmail.org>
References: <20200124090940.26571-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 pv-drivers@vmware.com, Roland Scheidegger <sroland@vmware.com>,
 Dan Williams <dan.j.williams@intel.com>, Ralph Campbell <rcampbell@nvidia.com>,
 "Matthew Wilcox \(Oracle\)" <willy@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com,
 Andrew Morton <akpm@linux-foundation.org>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 "Kirill A. Shutemov" <kirill.shutemov@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKU3VwcG9ydCBo
dWdlIChQTUQtc2l6ZSBhbmQgUFVELXNpemUpIHBhZ2UtdGFibGUgZW50cmllcyBieSBwcm92aWRp
bmcgYQpodWdlX2ZhdWx0KCkgY2FsbGJhY2suCldlIHN0aWxsIHN1cHBvcnQgcHJpdmF0ZSBtYXBw
aW5ncyBhbmQgd3JpdGUtbm90aWZ5IGJ5IHNwbGl0dGluZyB0aGUgaHVnZQpwYWdlLXRhYmxlIGVu
dHJpZXMgb24gd3JpdGUtYWNjZXNzLgoKTm90ZSB0aGF0IGZvciBodWdlIHBhZ2UtZmF1bHRzIHRv
IG9jY3VyLCBlaXRoZXIgdGhlIGtlcm5lbCBuZWVkcyB0byBiZQpjb21waWxlZCB3aXRoIHRyYW5z
LWh1Z2UtcGFnZXMgYWx3YXlzIGVuYWJsZWQsIG9yIHRoZSBrZXJuZWwgbmVlZHMgdG8gYmUKY29t
cGlsZWQgd2l0aCB0cmFucy1odWdlLXBhZ2VzIGVuYWJsZWQgdXNpbmcgbWFkdmlzZSwgYW5kIHRo
ZSB1c2VyLXNwYWNlCmFwcCBuZWVkcyB0byBjYWxsIG1hZHZpc2UoKSB0byBlbmFibGUgdHJhbnMt
aHVnZSBwYWdlcyBvbiBhIHBlci1tYXBwaW5nCmJhc2lzLgoKRnVydGhlcm1vcmUgaHVnZSBwYWdl
LWZhdWx0cyB3aWxsIG5vdCBzdWNjZWVkIHVubGVzcyBidWZmZXIgb2JqZWN0cyBhbmQKdXNlci1z
cGFjZSBhZGRyZXNzZXMgYXJlIGFsaWduZWQgb24gaHVnZSBwYWdlIHNpemUgYm91bmRhcmllcy4K
CkNjOiBBbmRyZXcgTW9ydG9uIDxha3BtQGxpbnV4LWZvdW5kYXRpb24ub3JnPgpDYzogTWljaGFs
IEhvY2tvIDxtaG9ja29Ac3VzZS5jb20+CkNjOiAiTWF0dGhldyBXaWxjb3ggKE9yYWNsZSkiIDx3
aWxseUBpbmZyYWRlYWQub3JnPgpDYzogIktpcmlsbCBBLiBTaHV0ZW1vdiIgPGtpcmlsbC5zaHV0
ZW1vdkBsaW51eC5pbnRlbC5jb20+CkNjOiBSYWxwaCBDYW1wYmVsbCA8cmNhbXBiZWxsQG52aWRp
YS5jb20+CkNjOiAiSsOpcsO0bWUgR2xpc3NlIiA8amdsaXNzZUByZWRoYXQuY29tPgpDYzogIkNo
cmlzdGlhbiBLw7ZuaWciIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBEYW4gV2lsbGlh
bXMgPGRhbi5qLndpbGxpYW1zQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxz
dHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgpSZXZpZXdlZC1ieTogUm9sYW5kIFNjaGVpZGVn
Z2VyIDxzcm9sYW5kQHZtd2FyZS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9f
dm0uYyAgICAgICAgICAgIHwgMTQ1ICsrKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9ncHUv
ZHJtL3Ztd2dmeC92bXdnZnhfcGFnZV9kaXJ0eS5jIHwgICAyICstCiBpbmNsdWRlL2RybS90dG0v
dHRtX2JvX2FwaS5oICAgICAgICAgICAgICAgfCAgIDMgKy0KIDMgZmlsZXMgY2hhbmdlZCwgMTQ1
IGluc2VydGlvbnMoKyksIDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3R0bS90dG1fYm9fdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKaW5k
ZXggMzg5MTI4YjhjNGRkLi40OTcwNDI2MWEwMGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvX3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwpA
QCAtMTU2LDYgKzE1Niw4OSBAQCB2bV9mYXVsdF90IHR0bV9ib192bV9yZXNlcnZlKHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8sCiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib192bV9yZXNlcnZl
KTsKIAorI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQorLyoqCisgKiB0dG1fYm9f
dm1faW5zZXJ0X2h1Z2UgLSBJbnNlcnQgYSBwZm4gZm9yIFBVRCBvciBQTUQgZmF1bHRzCisgKiBA
dm1mOiBGYXVsdCBkYXRhCisgKiBAYm86IFRoZSBidWZmZXIgb2JqZWN0CisgKiBAcGFnZV9vZmZz
ZXQ6IFBhZ2Ugb2Zmc2V0IGZyb20gYm8gc3RhcnQKKyAqIEBmYXVsdF9wYWdlX3NpemU6IFRoZSBz
aXplIG9mIHRoZSBmYXVsdCBpbiBwYWdlcy4KKyAqIEBwZ3Byb3Q6IFRoZSBwYWdlIHByb3RlY3Rp
b25zLgorICogRG9lcyBhZGRpdGlvbmFsIGNoZWNraW5nIHdoZXRoZXIgaXQncyBwb3NzaWJsZSB0
byBpbnNlcnQgYSBQVUQgb3IgUE1ECisgKiBwZm4gYW5kIHBlcmZvcm1zIHRoZSBpbnNlcnRpb24u
CisgKgorICogUmV0dXJuOiBWTV9GQVVMVF9OT1BBR0Ugb24gc3VjY2Vzc2Z1bCBpbnNlcnRpb24s
IFZNX0ZBVUxUX0ZBTExCQUNLIGlmCisgKiBhIGh1Z2UgZmF1bHQgd2FzIG5vdCBwb3NzaWJsZSwg
YW5kIGEgVk1fRkFVTFRfRVJST1IgY29kZSBvdGhlcndpc2UuCisgKi8KK3N0YXRpYyB2bV9mYXVs
dF90IHR0bV9ib192bV9pbnNlcnRfaHVnZShzdHJ1Y3Qgdm1fZmF1bHQgKnZtZiwKKwkJCQkJc3Ry
dWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKKwkJCQkJcGdvZmZfdCBwYWdlX29mZnNldCwKKwkJ
CQkJcGdvZmZfdCBmYXVsdF9wYWdlX3NpemUsCisJCQkJCXBncHJvdF90IHBncHJvdCkKK3sKKwlw
Z29mZl90IGk7CisJdm1fZmF1bHRfdCByZXQ7CisJdW5zaWduZWQgbG9uZyBwZm47CisJcGZuX3Qg
cGZudDsKKwlzdHJ1Y3QgdHRtX3R0ICp0dG0gPSBiby0+dHRtOworCWJvb2wgd3JpdGUgPSB2bWYt
PmZsYWdzICYgRkFVTFRfRkxBR19XUklURTsKKworCS8qIEZhdWx0IHNob3VsZCBub3QgY3Jvc3Mg
Ym8gYm91bmRhcnkuICovCisJcGFnZV9vZmZzZXQgJj0gfihmYXVsdF9wYWdlX3NpemUgLSAxKTsK
KwlpZiAocGFnZV9vZmZzZXQgKyBmYXVsdF9wYWdlX3NpemUgPiBiby0+bnVtX3BhZ2VzKQorCQln
b3RvIG91dF9mYWxsYmFjazsKKworCWlmIChiby0+bWVtLmJ1cy5pc19pb21lbSkKKwkJcGZuID0g
dHRtX2JvX2lvX21lbV9wZm4oYm8sIHBhZ2Vfb2Zmc2V0KTsKKwllbHNlCisJCXBmbiA9IHBhZ2Vf
dG9fcGZuKHR0bS0+cGFnZXNbcGFnZV9vZmZzZXRdKTsKKworCS8qIHBmbiBtdXN0IGJlIGZhdWx0
X3BhZ2Vfc2l6ZSBhbGlnbmVkLiAqLworCWlmICgocGZuICYgKGZhdWx0X3BhZ2Vfc2l6ZSAtIDEp
KSAhPSAwKQorCQlnb3RvIG91dF9mYWxsYmFjazsKKworCS8qIENoZWNrIHRoYXQgbWVtb3J5IGlz
IGNvbnRpZ3VvdXMuICovCisJaWYgKCFiby0+bWVtLmJ1cy5pc19pb21lbSkKKwkJZm9yIChpID0g
MTsgaSA8IGZhdWx0X3BhZ2Vfc2l6ZTsgKytpKSB7CisJCQlpZiAocGFnZV90b19wZm4odHRtLT5w
YWdlc1twYWdlX29mZnNldCArIGldKSAhPSBwZm4gKyBpKQorCQkJCWdvdG8gb3V0X2ZhbGxiYWNr
OworCQl9CisJLyogSU8gbWVtIHdpdGhvdXQgdGhlIGlvX21lbV9wZm4gY2FsbGJhY2sgaXMgYWx3
YXlzIGNvbnRpZ3VvdXMuICovCisJZWxzZSBpZiAoYm8tPmJkZXYtPmRyaXZlci0+aW9fbWVtX3Bm
bikKKwkJZm9yIChpID0gMTsgaSA8IGZhdWx0X3BhZ2Vfc2l6ZTsgKytpKSB7CisJCQlpZiAodHRt
X2JvX2lvX21lbV9wZm4oYm8sIHBhZ2Vfb2Zmc2V0ICsgaSkgIT0gcGZuICsgaSkKKwkJCQlnb3Rv
IG91dF9mYWxsYmFjazsKKwkJfQorCisJcGZudCA9IF9fcGZuX3RvX3Bmbl90KHBmbiwgUEZOX0RF
Vik7CisJaWYgKGZhdWx0X3BhZ2Vfc2l6ZSA9PSAoSFBBR0VfUE1EX1NJWkUgPj4gUEFHRV9TSElG
VCkpCisJCXJldCA9IHZtZl9pbnNlcnRfcGZuX3BtZF9wcm90KHZtZiwgcGZudCwgcGdwcm90LCB3
cml0ZSk7CisjaWZkZWYgQ09ORklHX0hBVkVfQVJDSF9UUkFOU1BBUkVOVF9IVUdFUEFHRV9QVUQK
KwllbHNlIGlmIChmYXVsdF9wYWdlX3NpemUgPT0gKEhQQUdFX1BVRF9TSVpFID4+IFBBR0VfU0hJ
RlQpKQorCQlyZXQgPSB2bWZfaW5zZXJ0X3Bmbl9wdWRfcHJvdCh2bWYsIHBmbnQsIHBncHJvdCwg
d3JpdGUpOworI2VuZGlmCisJZWxzZQorCQlXQVJOX09OX09OQ0UocmV0ID0gVk1fRkFVTFRfRkFM
TEJBQ0spOworCisJaWYgKHJldCAhPSBWTV9GQVVMVF9OT1BBR0UpCisJCWdvdG8gb3V0X2ZhbGxi
YWNrOworCisJcmV0dXJuIFZNX0ZBVUxUX05PUEFHRTsKK291dF9mYWxsYmFjazoKKwljb3VudF92
bV9ldmVudChUSFBfRkFVTFRfRkFMTEJBQ0spOworCXJldHVybiBWTV9GQVVMVF9GQUxMQkFDSzsK
K30KKyNlbHNlCitzdGF0aWMgdm1fZmF1bHRfdCB0dG1fYm9fdm1faW5zZXJ0X2h1Z2Uoc3RydWN0
IHZtX2ZhdWx0ICp2bWYsCisJCQkJCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCisJCQkJ
CXBnb2ZmX3QgcGFnZV9vZmZzZXQsCisJCQkJCXBnb2ZmX3QgZmF1bHRfcGFnZV9zaXplLAorCQkJ
CQlwZ3Byb3RfdCBwZ3Byb3QpCit7CisJcmV0dXJuIFZNX0ZBVUxUX05PUEFHRTsKK30KKyNlbmRp
ZgorCiAvKioKICAqIHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZCAtIFRUTSBmYXVsdCBoZWxwZXIK
ICAqIEB2bWY6IFRoZSBzdHJ1Y3Qgdm1fZmF1bHQgZ2l2ZW4gYXMgYXJndW1lbnQgdG8gdGhlIGZh
dWx0IGNhbGxiYWNrCkBAIC0xNjMsNiArMjQ2LDcgQEAgRVhQT1JUX1NZTUJPTCh0dG1fYm9fdm1f
cmVzZXJ2ZSk7CiAgKiBAbnVtX3ByZWZhdWx0OiBNYXhpbXVtIG51bWJlciBvZiBwcmVmYXVsdCBw
YWdlcy4gVGhlIGNhbGxlciBtYXkgd2FudCB0bwogICogc3BlY2lmeSB0aGlzIGJhc2VkIG9uIG1h
ZHZpY2Ugc2V0dGluZ3MgYW5kIHRoZSBzaXplIG9mIHRoZSBHUFUgb2JqZWN0CiAgKiBiYWNrZWQg
YnkgdGhlIG1lbW9yeS4KKyAqIEBmYXVsdF9wYWdlX3NpemU6IFRoZSBzaXplIG9mIHRoZSBmYXVs
dCBpbiBwYWdlcy4KICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGluc2VydHMgb25lIG9yIG1vcmUgcGFn
ZSB0YWJsZSBlbnRyaWVzIHBvaW50aW5nIHRvIHRoZQogICogbWVtb3J5IGJhY2tpbmcgdGhlIGJ1
ZmZlciBvYmplY3QsIGFuZCB0aGVuIHJldHVybnMgYSByZXR1cm4gY29kZQpAQCAtMTc2LDcgKzI2
MCw4IEBAIEVYUE9SVF9TWU1CT0wodHRtX2JvX3ZtX3Jlc2VydmUpOwogICovCiB2bV9mYXVsdF90
IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZiwKIAkJCQkgICAg
cGdwcm90X3QgcHJvdCwKLQkJCQkgICAgcGdvZmZfdCBudW1fcHJlZmF1bHQpCisJCQkJICAgIHBn
b2ZmX3QgbnVtX3ByZWZhdWx0LAorCQkJCSAgICBwZ29mZl90IGZhdWx0X3BhZ2Vfc2l6ZSkKIHsK
IAlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSA9IHZtZi0+dm1hOwogCXN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKQEAgLTI2OCw2ICszNTMsMTMg
QEAgdm1fZmF1bHRfdCB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQoc3RydWN0IHZtX2ZhdWx0ICp2
bWYsCiAJCXByb3QgPSBwZ3Byb3RfZGVjcnlwdGVkKHByb3QpOwogCX0KIAorCS8qIFdlIGRvbid0
IHByZWZhdWx0IG9uIGh1Z2UgZmF1bHRzLiBZZXQuICovCisJaWYgKElTX0VOQUJMRUQoQ09ORklH
X1RSQU5TUEFSRU5UX0hVR0VQQUdFKSAmJiBmYXVsdF9wYWdlX3NpemUgIT0gMSkgeworCQlyZXQg
PSB0dG1fYm9fdm1faW5zZXJ0X2h1Z2Uodm1mLCBibywgcGFnZV9vZmZzZXQsCisJCQkJCSAgICBm
YXVsdF9wYWdlX3NpemUsIHByb3QpOworCQlnb3RvIG91dF9pb191bmxvY2s7CisJfQorCiAJLyoK
IAkgKiBTcGVjdWxhdGl2ZWx5IHByZWZhdWx0IGEgbnVtYmVyIG9mIHBhZ2VzLiBPbmx5IGVycm9y
IG9uCiAJICogZmlyc3QgcGFnZS4KQEAgLTMzNCw3ICs0MjYsNyBAQCB2bV9mYXVsdF90IHR0bV9i
b192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkJcmV0dXJuIHJldDsKIAogCXByb3Qg
PSB2bWEtPnZtX3BhZ2VfcHJvdDsKLQlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1m
LCBwcm90LCBUVE1fQk9fVk1fTlVNX1BSRUZBVUxUKTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRf
cmVzZXJ2ZWQodm1mLCBwcm90LCBUVE1fQk9fVk1fTlVNX1BSRUZBVUxULCAxKTsKIAlpZiAocmV0
ID09IFZNX0ZBVUxUX1JFVFJZICYmICEodm1mLT5mbGFncyAmIEZBVUxUX0ZMQUdfUkVUUllfTk9X
QUlUKSkKIAkJcmV0dXJuIHJldDsKIApAQCAtMzQ0LDYgKzQzNiw1MCBAQCB2bV9mYXVsdF90IHR0
bV9ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIH0KIEVYUE9SVF9TWU1CT0wodHRt
X2JvX3ZtX2ZhdWx0KTsKIAorI2lmZGVmIENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQorc3Rh
dGljIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2h1Z2VfZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYs
CisJCQkJICAgICAgIGVudW0gcGFnZV9lbnRyeV9zaXplIHBlX3NpemUpCit7CisJc3RydWN0IHZt
X2FyZWFfc3RydWN0ICp2bWEgPSB2bWYtPnZtYTsKKwlwZ3Byb3RfdCBwcm90OworCXN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKKwl2bV9mYXVsdF90
IHJldDsKKwlwZ29mZl90IGZhdWx0X3BhZ2Vfc2l6ZSA9IDA7CisJYm9vbCB3cml0ZSA9IHZtZi0+
ZmxhZ3MgJiBGQVVMVF9GTEFHX1dSSVRFOworCisJc3dpdGNoIChwZV9zaXplKSB7CisJY2FzZSBQ
RV9TSVpFX1BNRDoKKwkJZmF1bHRfcGFnZV9zaXplID0gSFBBR0VfUE1EX1NJWkUgPj4gUEFHRV9T
SElGVDsKKwkJYnJlYWs7CisjaWZkZWYgQ09ORklHX0hBVkVfQVJDSF9UUkFOU1BBUkVOVF9IVUdF
UEFHRV9QVUQKKwljYXNlIFBFX1NJWkVfUFVEOgorCQlmYXVsdF9wYWdlX3NpemUgPSBIUEFHRV9Q
VURfU0laRSA+PiBQQUdFX1NISUZUOworCQlicmVhazsKKyNlbmRpZgorCWRlZmF1bHQ6CisJCVdB
Uk5fT05fT05DRSgxKTsKKwkJcmV0dXJuIFZNX0ZBVUxUX0ZBTExCQUNLOworCX0KKworCS8qIEZh
bGxiYWNrIG9uIHdyaXRlIGRpcnR5LXRyYWNraW5nIG9yIENPVyAqLworCWlmICh3cml0ZSAmJiAh
KHBncHJvdF92YWwodm1mLT52bWEtPnZtX3BhZ2VfcHJvdCkgJiBfUEFHRV9SVykpCisJCXJldHVy
biBWTV9GQVVMVF9GQUxMQkFDSzsKKworCXJldCA9IHR0bV9ib192bV9yZXNlcnZlKGJvLCB2bWYp
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlwcm90ID0gdm1fZ2V0X3BhZ2VfcHJvdCh2
bWEtPnZtX2ZsYWdzKTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1mLCBwcm90
LCAxLCBmYXVsdF9wYWdlX3NpemUpOworCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2
bWYtPmZsYWdzICYgRkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQorCQlyZXR1cm4gcmV0OworCisJ
ZG1hX3Jlc3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOworCisJcmV0dXJuIHJldDsKK30KKyNlbmRp
ZgorCiB2b2lkIHR0bV9ib192bV9vcGVuKHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQogewog
CXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSB2bWEtPnZtX3ByaXZhdGVfZGF0YTsKQEAg
LTQ0NSw3ICs1ODEsMTAgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB2bV9vcGVyYXRpb25zX3N0cnVj
dCB0dG1fYm9fdm1fb3BzID0gewogCS5mYXVsdCA9IHR0bV9ib192bV9mYXVsdCwKIAkub3BlbiA9
IHR0bV9ib192bV9vcGVuLAogCS5jbG9zZSA9IHR0bV9ib192bV9jbG9zZSwKLQkuYWNjZXNzID0g
dHRtX2JvX3ZtX2FjY2VzcworCS5hY2Nlc3MgPSB0dG1fYm9fdm1fYWNjZXNzLAorI2lmZGVmIENP
TkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRQorCS5odWdlX2ZhdWx0ID0gdHRtX2JvX3ZtX2h1Z2Vf
ZmF1bHQsCisjZW5kaWYKIH07CiAKIHN0YXRpYyBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKnR0
bV9ib192bV9sb29rdXAoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMKaW5kZXggZjA3YWE4NTc1ODdjLi4xN2E1ZGNh
N2I5MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3BhZ2VfZGly
dHkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMKQEAg
LTQ3Nyw3ICs0NzcsNyBAQCB2bV9mYXVsdF90IHZtd19ib192bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1
bHQgKnZtZikKIAllbHNlCiAJCXByb3QgPSB2bV9nZXRfcGFnZV9wcm90KHZtYS0+dm1fZmxhZ3Mp
OwogCi0JcmV0ID0gdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHZtZiwgcHJvdCwgbnVtX3ByZWZh
dWx0KTsKKwlyZXQgPSB0dG1fYm9fdm1fZmF1bHRfcmVzZXJ2ZWQodm1mLCBwcm90LCBudW1fcHJl
ZmF1bHQsIDEpOwogCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYtPmZsYWdzICYg
RkFVTFRfRkxBR19SRVRSWV9OT1dBSVQpKQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9p
bmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGku
aAppbmRleCA2NmNhNDlkYjk2MzMuLjRmYzkwZDUzYWExNSAxMDA2NDQKLS0tIGEvaW5jbHVkZS9k
cm0vdHRtL3R0bV9ib19hcGkuaAorKysgYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCkBA
IC03MzIsNyArNzMyLDggQEAgdm1fZmF1bHRfdCB0dG1fYm9fdm1fcmVzZXJ2ZShzdHJ1Y3QgdHRt
X2J1ZmZlcl9vYmplY3QgKmJvLAogCiB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9yZXNlcnZl
ZChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZiwKIAkJCQkgICAgcGdwcm90X3QgcHJvdCwKLQkJCQkgICAg
cGdvZmZfdCBudW1fcHJlZmF1bHQpOworCQkJCSAgICBwZ29mZl90IG51bV9wcmVmYXVsdCwKKwkJ
CQkgICAgcGdvZmZfdCBmYXVsdF9wYWdlX3NpemUpOwogCiB2bV9mYXVsdF90IHR0bV9ib192bV9m
YXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZik7CiAKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApk
cmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
