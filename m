Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E842258010
	for <lists+dri-devel@lfdr.de>; Thu, 27 Jun 2019 12:18:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A4C686E0C0;
	Thu, 27 Jun 2019 10:18:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x441.google.com (mail-wr1-x441.google.com
 [IPv6:2a00:1450:4864:20::441])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 154876E0C0;
 Thu, 27 Jun 2019 10:18:16 +0000 (UTC)
Received: by mail-wr1-x441.google.com with SMTP id p11so1875734wre.7;
 Thu, 27 Jun 2019 03:18:16 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=QOoDpEVn6Dhhkg777KigsEV+1cZ+361rS3DagmUiVPw=;
 b=nn0Dr81cTIv5D8pV5AymhsJXm0HhUw39e+jOD6P+1dmF8Nj0S0vs/nFpAG2twt+GFF
 t/a7S6qDKZfuJK9Icz3MCudNTUYMiPklsiuXs+sA299fTuhx3yn3ePcRI/7JMM4pz6Zp
 /rhFYC/aUhi20DqRdCRB1H2ppRBFIAUfp7+5KgOSYrPyb/11dpU3OWsqBENeJ6MX3ztC
 hDbhH598ZWYcckKzw6yttRmdG4NmvkWP+tNDQmgoLY2yA0Yl7RCJo+NktsAbnEeSeRAk
 0A4JC+UnlzuUWYZs5k+6XFSPcMmbZhb4S3nMxAJP5HSVE7f7uz68IzSy3Y7bo4bRsLDB
 X9zQ==
X-Gm-Message-State: APjAAAX59kaubwR+T6hzLkbvp9ByPaLXVEwtc+epsLY9rwFK+oNRDfq8
 N56c3HOMmraVEKgTH9SE9GteXfy2
X-Google-Smtp-Source: APXvYqytRTT9y8QDz1vPWm9S99k7TLAqA4AQnRvHJSl9Dt3Ol/ypmOYjOFO938Wo/Fr2ToklcH99fg==
X-Received: by 2002:adf:cc92:: with SMTP id p18mr2575323wrj.260.1561630694470; 
 Thu, 27 Jun 2019 03:18:14 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:9540:60ba:d349:2d15])
 by smtp.gmail.com with ESMTPSA id b2sm2301738wrp.72.2019.06.27.03.18.13
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Thu, 27 Jun 2019 03:18:14 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: amd-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 1/2] dma-buf: cleanup reservation_object_init/fini
Date: Thu, 27 Jun 2019 12:18:12 +0200
Message-Id: <20190627101813.61430-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=QOoDpEVn6Dhhkg777KigsEV+1cZ+361rS3DagmUiVPw=;
 b=V1+8LuDw+rOHyWxa8rBPIxhBNGSqVT6s39Ch8FIB2zDDgNseXkft/NMm/pH650tbwp
 iRW3prChNFQgZsL5zr1WDkJTuqizPhN3z9xOci7PNyhUNbRAtfEeV/hhHh0oMILA6yi6
 vLCQ55mjqe4VsrVVeluyrn0P/dT+ZYw36VGxbl5STzWfEPN6HX8zDkMmasdboLAmc6h+
 L7tsKKCYDtHr8ft65MFQR4+pctDjNUJSXmaKfSc9o9D5CMPWUeDAf5dd6TquGu9j5WF4
 O0FW5onzkbUSJyPs09mmb3YdNbmHbISGPoK2HFBi0wQ25fbJBX/xpyxA9kzbD01pJZBE
 x/KQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhleSBhcmUgbm90IHVzZWQgdGhhdCBvZnRlbiBhbmQgY2VydGFpbmx5IG5vdCBpbiBhIGhvdCBw
YXRoLgpNYWtlIHRoZW0gbm9ybWFsIGZ1bmN0aW9ucyBpbnN0ZWFkIG9mIGFuIGlubGluZS4KClNp
Z25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
LS0tCiBkcml2ZXJzL2RtYS1idWYvcmVzZXJ2YXRpb24uYyB8IDQ1ICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysKIGluY2x1ZGUvbGludXgvcmVzZXJ2YXRpb24uaCAgIHwgNDYgKyst
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgNDcgaW5z
ZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVm
L3Jlc2VydmF0aW9uLmMgYi9kcml2ZXJzL2RtYS1idWYvcmVzZXJ2YXRpb24uYwppbmRleCA0ZDMy
ZTJjNjc4NjIuLmVmNzEwZWZmZWRmYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL3Jlc2Vy
dmF0aW9uLmMKKysrIGIvZHJpdmVycy9kbWEtYnVmL3Jlc2VydmF0aW9uLmMKQEAgLTU1LDYgKzU1
LDUxIEBAIEVYUE9SVF9TWU1CT0wocmVzZXJ2YXRpb25fc2VxY291bnRfY2xhc3MpOwogY29uc3Qg
Y2hhciByZXNlcnZhdGlvbl9zZXFjb3VudF9zdHJpbmdbXSA9ICJyZXNlcnZhdGlvbl9zZXFjb3Vu
dCI7CiBFWFBPUlRfU1lNQk9MKHJlc2VydmF0aW9uX3NlcWNvdW50X3N0cmluZyk7CiAKKy8qKgor
ICogcmVzZXJ2YXRpb25fb2JqZWN0X2luaXQgLSBpbml0aWFsaXplIGEgcmVzZXJ2YXRpb24gb2Jq
ZWN0CisgKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CisgKi8KK3ZvaWQgcmVzZXJ2YXRp
b25fb2JqZWN0X2luaXQoc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqb2JqKQoreworCXd3X211
dGV4X2luaXQoJm9iai0+bG9jaywgJnJlc2VydmF0aW9uX3d3X2NsYXNzKTsKKworCV9fc2VxY291
bnRfaW5pdCgmb2JqLT5zZXEsIHJlc2VydmF0aW9uX3NlcWNvdW50X3N0cmluZywKKwkJCSZyZXNl
cnZhdGlvbl9zZXFjb3VudF9jbGFzcyk7CisJUkNVX0lOSVRfUE9JTlRFUihvYmotPmZlbmNlLCBO
VUxMKTsKKwlSQ1VfSU5JVF9QT0lOVEVSKG9iai0+ZmVuY2VfZXhjbCwgTlVMTCk7Cit9CitFWFBP
UlRfU1lNQk9MKHJlc2VydmF0aW9uX29iamVjdF9pbml0KTsKKworLyoqCisgKiByZXNlcnZhdGlv
bl9vYmplY3RfZmluaSAtIGRlc3Ryb3lzIGEgcmVzZXJ2YXRpb24gb2JqZWN0CisgKiBAb2JqOiB0
aGUgcmVzZXJ2YXRpb24gb2JqZWN0CisgKi8KK3ZvaWQgcmVzZXJ2YXRpb25fb2JqZWN0X2Zpbmko
c3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqb2JqKQoreworCWludCBpOworCXN0cnVjdCByZXNl
cnZhdGlvbl9vYmplY3RfbGlzdCAqZm9iajsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpleGNsOworCisJ
LyoKKwkgKiBUaGlzIG9iamVjdCBzaG91bGQgYmUgZGVhZCBhbmQgYWxsIHJlZmVyZW5jZXMgbXVz
dCBoYXZlCisJICogYmVlbiByZWxlYXNlZCB0byBpdCwgc28gbm8gbmVlZCB0byBiZSBwcm90ZWN0
ZWQgd2l0aCByY3UuCisJICovCisJZXhjbCA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQob2Jq
LT5mZW5jZV9leGNsLCAxKTsKKwlpZiAoZXhjbCkKKwkJZG1hX2ZlbmNlX3B1dChleGNsKTsKKwor
CWZvYmogPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKG9iai0+ZmVuY2UsIDEpOworCWlmIChm
b2JqKSB7CisJCWZvciAoaSA9IDA7IGkgPCBmb2JqLT5zaGFyZWRfY291bnQ7ICsraSkKKwkJCWRt
YV9mZW5jZV9wdXQocmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChmb2JqLT5zaGFyZWRbaV0sIDEp
KTsKKworCQlrZnJlZShmb2JqKTsKKwl9CisKKwl3d19tdXRleF9kZXN0cm95KCZvYmotPmxvY2sp
OworfQorRVhQT1JUX1NZTUJPTChyZXNlcnZhdGlvbl9vYmplY3RfZmluaSk7CisKIC8qKgogICog
cmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hhcmVkIC0gUmVzZXJ2ZSBzcGFjZSB0byBhZGQg
c2hhcmVkIGZlbmNlcyB0bwogICogYSByZXNlcnZhdGlvbl9vYmplY3QuCmRpZmYgLS1naXQgYS9p
bmNsdWRlL2xpbnV4L3Jlc2VydmF0aW9uLmggYi9pbmNsdWRlL2xpbnV4L3Jlc2VydmF0aW9uLmgK
aW5kZXggZWU3NTA3NjVjYzk0Li5mNDdlODE5NmQwMzkgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGlu
dXgvcmVzZXJ2YXRpb24uaAorKysgYi9pbmNsdWRlL2xpbnV4L3Jlc2VydmF0aW9uLmgKQEAgLTgx
LDUwICs4MSw2IEBAIHN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgewogI2RlZmluZSByZXNlcnZh
dGlvbl9vYmplY3RfYXNzZXJ0X2hlbGQob2JqKSBcCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmKG9i
aiktPmxvY2suYmFzZSkKIAotLyoqCi0gKiByZXNlcnZhdGlvbl9vYmplY3RfaW5pdCAtIGluaXRp
YWxpemUgYSByZXNlcnZhdGlvbiBvYmplY3QKLSAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBvYmpl
Y3QKLSAqLwotc3RhdGljIGlubGluZSB2b2lkCi1yZXNlcnZhdGlvbl9vYmplY3RfaW5pdChzdHJ1
Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpvYmopCi17Ci0Jd3dfbXV0ZXhfaW5pdCgmb2JqLT5sb2Nr
LCAmcmVzZXJ2YXRpb25fd3dfY2xhc3MpOwotCi0JX19zZXFjb3VudF9pbml0KCZvYmotPnNlcSwg
cmVzZXJ2YXRpb25fc2VxY291bnRfc3RyaW5nLCAmcmVzZXJ2YXRpb25fc2VxY291bnRfY2xhc3Mp
OwotCVJDVV9JTklUX1BPSU5URVIob2JqLT5mZW5jZSwgTlVMTCk7Ci0JUkNVX0lOSVRfUE9JTlRF
UihvYmotPmZlbmNlX2V4Y2wsIE5VTEwpOwotfQotCi0vKioKLSAqIHJlc2VydmF0aW9uX29iamVj
dF9maW5pIC0gZGVzdHJveXMgYSByZXNlcnZhdGlvbiBvYmplY3QKLSAqIEBvYmo6IHRoZSByZXNl
cnZhdGlvbiBvYmplY3QKLSAqLwotc3RhdGljIGlubGluZSB2b2lkCi1yZXNlcnZhdGlvbl9vYmpl
Y3RfZmluaShzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpvYmopCi17Ci0JaW50IGk7Ci0Jc3Ry
dWN0IHJlc2VydmF0aW9uX29iamVjdF9saXN0ICpmb2JqOwotCXN0cnVjdCBkbWFfZmVuY2UgKmV4
Y2w7Ci0KLQkvKgotCSAqIFRoaXMgb2JqZWN0IHNob3VsZCBiZSBkZWFkIGFuZCBhbGwgcmVmZXJl
bmNlcyBtdXN0IGhhdmUKLQkgKiBiZWVuIHJlbGVhc2VkIHRvIGl0LCBzbyBubyBuZWVkIHRvIGJl
IHByb3RlY3RlZCB3aXRoIHJjdS4KLQkgKi8KLQlleGNsID0gcmN1X2RlcmVmZXJlbmNlX3Byb3Rl
Y3RlZChvYmotPmZlbmNlX2V4Y2wsIDEpOwotCWlmIChleGNsKQotCQlkbWFfZmVuY2VfcHV0KGV4
Y2wpOwotCi0JZm9iaiA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQob2JqLT5mZW5jZSwgMSk7
Ci0JaWYgKGZvYmopIHsKLQkJZm9yIChpID0gMDsgaSA8IGZvYmotPnNoYXJlZF9jb3VudDsgKytp
KQotCQkJZG1hX2ZlbmNlX3B1dChyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGZvYmotPnNoYXJl
ZFtpXSwgMSkpOwotCi0JCWtmcmVlKGZvYmopOwotCX0KLQotCXd3X211dGV4X2Rlc3Ryb3koJm9i
ai0+bG9jayk7Ci19Ci0KIC8qKgogICogcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9saXN0IC0gZ2V0
IHRoZSByZXNlcnZhdGlvbiBvYmplY3QncwogICogc2hhcmVkIGZlbmNlIGxpc3QsIHdpdGggdXBk
YXRlLXNpZGUgbG9jayBoZWxkCkBAIC0yNjcsNiArMjIzLDggQEAgcmVzZXJ2YXRpb25fb2JqZWN0
X2dldF9leGNsX3JjdShzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpvYmopCiAJcmV0dXJuIGZl
bmNlOwogfQogCit2b2lkIHJlc2VydmF0aW9uX29iamVjdF9pbml0KHN0cnVjdCByZXNlcnZhdGlv
bl9vYmplY3QgKm9iaik7Cit2b2lkIHJlc2VydmF0aW9uX29iamVjdF9maW5pKHN0cnVjdCByZXNl
cnZhdGlvbl9vYmplY3QgKm9iaik7CiBpbnQgcmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hh
cmVkKHN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKm9iaiwKIAkJCQkgICAgICB1bnNpZ25lZCBp
bnQgbnVtX2ZlbmNlcyk7CiB2b2lkIHJlc2VydmF0aW9uX29iamVjdF9hZGRfc2hhcmVkX2ZlbmNl
KHN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKm9iaiwKLS0gCjIuMTcuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
