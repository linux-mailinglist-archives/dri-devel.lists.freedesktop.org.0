Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 480202949AC
	for <lists+dri-devel@lfdr.de>; Wed, 21 Oct 2020 10:57:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 39E016F477;
	Wed, 21 Oct 2020 08:57:20 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x444.google.com (mail-wr1-x444.google.com
 [IPv6:2a00:1450:4864:20::444])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C59066F474
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Oct 2020 08:57:15 +0000 (UTC)
Received: by mail-wr1-x444.google.com with SMTP id x7so2155940wrl.3
 for <dri-devel@lists.freedesktop.org>; Wed, 21 Oct 2020 01:57:15 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=S+7ufuislqzXK0m1Ak/J4PVW8igwq369gehzbG0B91s=;
 b=TASte01LfK3tJrNEskEJg0JBrkEwFReNqZJcsPAqw0ud/54iE3NFZPYAz4seclzObY
 8qyaNJ7feKdYZc7R1FFJdgR6e4chx6xmBKBCGr9MetZUB65nJ+IYSxcj8fXdkIxAF9Wa
 835vPJ0u8wjGgm4Lqk1+pFbsMYj81cW6UvpFg=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=S+7ufuislqzXK0m1Ak/J4PVW8igwq369gehzbG0B91s=;
 b=ShJoZvABCLvyiAxWuYk5v4QKVFWbFqGUxi8ge36wNI6wEat5PaHos+4NYarm4jyb1R
 ZfKGIK1duKkOTDlnJhA41um96t79ZvwJBngPrmblOdNPSiYN6tu9r/80yjS7roQR0gb4
 cwtJ3pk+eX/XEwMnAFlb/N0CbpZHjJDVEVCob/CngW+qh8jlEPOxhnbELaV0OOIj5eKn
 oGTiYZ/bjptNxu9W36gPr9AikaomkT2eDf6WyRm6wx3SsqZPLe/5dcN3q58iI8NmXaxo
 3jmMM2ABrp9R+osmuoNVCWUgZ+kR3lMHKENO2Gf4BW7ByWFFC68N7WFHh45RlF9/K4Ej
 KZ1Q==
X-Gm-Message-State: AOAM531IT6NzvlygyXV4avSRt+ecog7jRhKs6VG4zUQjGVbwyhDTAd6q
 cduBKRGOtNXTaSih2zHfaqEptj/QyGX47oOR
X-Google-Smtp-Source: ABdhPJzgdpJKzdh0Z7/Ixx6DmwTqWbM+l3YLKx7fvymTBFfXMek7eKSHLlh0kohA3cb0UMcaEODvqA==
X-Received: by 2002:a5d:6a4f:: with SMTP id t15mr3390316wrw.126.1603270634157; 
 Wed, 21 Oct 2020 01:57:14 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id q8sm2675939wro.32.2020.10.21.01.57.12
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 21 Oct 2020 01:57:13 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>,
 LKML <linux-kernel@vger.kernel.org>
Subject: [PATCH v3 08/16] s390/pci: Remove races against pte updates
Date: Wed, 21 Oct 2020 10:56:47 +0200
Message-Id: <20201021085655.1192025-9-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20201021085655.1192025-1-daniel.vetter@ffwll.ch>
References: <20201021085655.1192025-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-s390@vger.kernel.org, linux-samsung-soc@vger.kernel.org,
 Jan Kara <jack@suse.cz>, Kees Cook <keescook@chromium.org>,
 kvm@vger.kernel.org, Jason Gunthorpe <jgg@ziepe.ca>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Niklas Schnelle <schnelle@linux.ibm.com>,
 Daniel Vetter <daniel.vetter@ffwll.com>,
 Andrew Morton <akpm@linux-foundation.org>, linux-mm@kvack.org,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 John Hubbard <jhubbard@nvidia.com>, Daniel Vetter <daniel.vetter@intel.com>,
 Gerald Schaefer <gerald.schaefer@linux.ibm.com>,
 Dan Williams <dan.j.williams@intel.com>, linux-arm-kernel@lists.infradead.org,
 linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2F5IGJhY2sgaXQgd2FzIGEgcmVhc29uYWJsZSBhc3N1bXB0aW9ucyB0aGF0IGlvbWVtIG1hcHBp
bmdzIG5ldmVyCmNoYW5nZSB0aGUgcGZuIHJhbmdlIHRoZXkgcG9pbnQgYXQuIEJ1dCB0aGlzIGhh
cyBjaGFuZ2VkOgoKLSBncHUgZHJpdmVycyBkeW5hbWljYWxseSBtYW5hZ2UgdGhlaXIgbWVtb3J5
IG5vd2FkYXlzLCBpbnZhbGlkYXRpbmcKcHRlcyB3aXRoIHVubWFwX21hcHBpbmdfcmFuZ2Ugd2hl
biBidWZmZXJzIGdldCBtb3ZlZAoKLSBjb250aWd1b3VzIGRtYSBhbGxvY2F0aW9ucyBoYXZlIG1v
dmVkIGZyb20gZGVkaWNhdGVkIGNhcnZldG91dHMgdG8KY21hIHJlZ2lvbnMuIFRoaXMgbWVhbnMg
aWYgd2UgbWlzcyB0aGUgdW5tYXAgdGhlIHBmbiBtaWdodCBjb250YWluCnBhZ2VjYWNoZSBvciBh
bm9uIG1lbW9yeSAod2VsbCBhbnl0aGluZyBhbGxvY2F0ZWQgd2l0aCBHRlBfTU9WRUFCTEUpCgot
IGV2ZW4gL2Rldi9tZW0gbm93IGludmFsaWRhdGVzIG1hcHBpbmdzIHdoZW4gdGhlIGtlcm5lbCBy
ZXF1ZXN0cyB0aGF0CmlvbWVtIHJlZ2lvbiB3aGVuIENPTkZJR19JT19TVFJJQ1RfREVWTUVNIGlz
IHNldCwgc2VlIGNvbW1pdAozMjM0YWM2NjRhODcgKCIvZGV2L21lbTogUmV2b2tlIG1hcHBpbmdz
IHdoZW4gYSBkcml2ZXIgY2xhaW1zIHRoZQpyZWdpb24iKQoKQWNjZXNzaW5nIHBmbnMgb2J0YWlu
ZWQgZnJvbSBwdGVzIHdpdGhvdXQgaG9sZGluZyBhbGwgdGhlIGxvY2tzIGlzCnRoZXJlZm9yZSBu
byBsb25nZXIgYSBnb29kIGlkZWEuIEZpeCB0aGlzLgoKU2luY2UgenBjaV9tZW1jcHlfZnJvbXx0
b2lvIHNlZW1zIHRvIG5vdCBkbyBhbnl0aGluZyBuZWZhcmlvdXMgd2l0aApsb2NrcyB3ZSBqdXN0
IG5lZWQgdG8gb3BlbiBjb2RlIGdldF9wZm4gYW5kIGZvbGxvd19wZm4gYW5kIG1ha2Ugc3VyZQp3
ZSBkcm9wIHRoZSBsb2NrcyBvbmx5IGFmdGVyIHdlJ3JlIGRvbmUuIFRoZSB3cml0ZSBmdW5jdGlv
biBhbHNvIG5lZWRzCnRoZSBjb3B5X2Zyb21fdXNlciBtb3ZlLCBzaW5jZSB3ZSBjYW4ndCB0YWtl
IHVzZXJzcGFjZSBmYXVsdHMgd2hpbGUKaG9sZGluZyB0aGUgbW1hcCBzZW0uCgp2MjogTW92ZSBW
TV9JTyB8IFZNX1BGTk1BUCBjaGVja3MgYXJvdW5kIHNvIHRoZXkga2VlcCByZXR1cm5pbmcgRUlO
VkFMCmxpa2UgYmVmb3JlIChHZXJhcmQpCgp2MzogUG9saXNoIGNvbW1pdCBtZXNzYWdlIChOaWts
YXMpCgpSZXZpZXdlZC1ieTogR2VyYWxkIFNjaGFlZmVyIDxnZXJhbGQuc2NoYWVmZXJAbGludXgu
aWJtLmNvbT4KU2lnbmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRl
bC5jb20+CkNjOiBKYXNvbiBHdW50aG9ycGUgPGpnZ0B6aWVwZS5jYT4KQ2M6IERhbiBXaWxsaWFt
cyA8ZGFuLmoud2lsbGlhbXNAaW50ZWwuY29tPgpDYzogS2VlcyBDb29rIDxrZWVzY29va0BjaHJv
bWl1bS5vcmc+CkNjOiBBbmRyZXcgTW9ydG9uIDxha3BtQGxpbnV4LWZvdW5kYXRpb24ub3JnPgpD
YzogSm9obiBIdWJiYXJkIDxqaHViYmFyZEBudmlkaWEuY29tPgpDYzogSsOpcsO0bWUgR2xpc3Nl
IDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiBKYW4gS2FyYSA8amFja0BzdXNlLmN6PgpDYzogbGlu
dXgtbW1Aa3ZhY2sub3JnCkNjOiBsaW51eC1hcm0ta2VybmVsQGxpc3RzLmluZnJhZGVhZC5vcmcK
Q2M6IGxpbnV4LXNhbXN1bmctc29jQHZnZXIua2VybmVsLm9yZwpDYzogbGludXgtbWVkaWFAdmdl
ci5rZXJuZWwub3JnCkNjOiBOaWtsYXMgU2NobmVsbGUgPHNjaG5lbGxlQGxpbnV4LmlibS5jb20+
CkNjOiBHZXJhbGQgU2NoYWVmZXIgPGdlcmFsZC5zY2hhZWZlckBsaW51eC5pYm0uY29tPgpDYzog
bGludXgtczM5MEB2Z2VyLmtlcm5lbC5vcmcKQ2M6IE5pa2xhcyBTY2huZWxsZSA8c2NobmVsbGVA
bGludXguaWJtLmNvbT4KU2lnbmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRl
ckBmZndsbC5jb20+Ci0tLQogYXJjaC9zMzkwL3BjaS9wY2lfbW1pby5jIHwgOTggKysrKysrKysr
KysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDU3IGluc2Vy
dGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2FyY2gvczM5MC9wY2kvcGNp
X21taW8uYyBiL2FyY2gvczM5MC9wY2kvcGNpX21taW8uYwppbmRleCA0MDFjZjY3MGEyNDMuLjFh
NmFkYmM2OGVlOCAxMDA2NDQKLS0tIGEvYXJjaC9zMzkwL3BjaS9wY2lfbW1pby5jCisrKyBiL2Fy
Y2gvczM5MC9wY2kvcGNpX21taW8uYwpAQCAtMTE5LDMzICsxMTksMTUgQEAgc3RhdGljIGlubGlu
ZSBpbnQgX19tZW1jcHlfdG9pb19pbnVzZXIodm9pZCBfX2lvbWVtICpkc3QsCiAJcmV0dXJuIHJj
OwogfQogCi1zdGF0aWMgbG9uZyBnZXRfcGZuKHVuc2lnbmVkIGxvbmcgdXNlcl9hZGRyLCB1bnNp
Z25lZCBsb25nIGFjY2VzcywKLQkJICAgIHVuc2lnbmVkIGxvbmcgKnBmbikKLXsKLQlzdHJ1Y3Qg
dm1fYXJlYV9zdHJ1Y3QgKnZtYTsKLQlsb25nIHJldDsKLQotCW1tYXBfcmVhZF9sb2NrKGN1cnJl
bnQtPm1tKTsKLQlyZXQgPSAtRUlOVkFMOwotCXZtYSA9IGZpbmRfdm1hKGN1cnJlbnQtPm1tLCB1
c2VyX2FkZHIpOwotCWlmICghdm1hKQotCQlnb3RvIG91dDsKLQlyZXQgPSAtRUFDQ0VTOwotCWlm
ICghKHZtYS0+dm1fZmxhZ3MgJiBhY2Nlc3MpKQotCQlnb3RvIG91dDsKLQlyZXQgPSBmb2xsb3df
cGZuKHZtYSwgdXNlcl9hZGRyLCBwZm4pOwotb3V0OgotCW1tYXBfcmVhZF91bmxvY2soY3VycmVu
dC0+bW0pOwotCXJldHVybiByZXQ7Ci19Ci0KIFNZU0NBTExfREVGSU5FMyhzMzkwX3BjaV9tbWlv
X3dyaXRlLCB1bnNpZ25lZCBsb25nLCBtbWlvX2FkZHIsCiAJCWNvbnN0IHZvaWQgX191c2VyICos
IHVzZXJfYnVmZmVyLCBzaXplX3QsIGxlbmd0aCkKIHsKIAl1OCBsb2NhbF9idWZbNjRdOwogCXZv
aWQgX19pb21lbSAqaW9fYWRkcjsKIAl2b2lkICpidWY7Ci0JdW5zaWduZWQgbG9uZyBwZm47CisJ
c3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWE7CisJcHRlX3QgKnB0ZXA7CisJc3BpbmxvY2tfdCAq
cHRsOwogCWxvbmcgcmV0OwogCiAJaWYgKCF6cGNpX2lzX2VuYWJsZWQoKSkKQEAgLTE1OCw3ICsx
NDAsNyBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9wY2lfbW1pb193cml0ZSwgdW5zaWduZWQgbG9u
ZywgbW1pb19hZGRyLAogCSAqIFdlIG9ubHkgc3VwcG9ydCB3cml0ZSBhY2Nlc3MgdG8gTUlPIGNh
cGFibGUgZGV2aWNlcyBpZiB3ZSBhcmUgb24KIAkgKiBhIE1JTyBlbmFibGVkIHN5c3RlbS4gT3Ro
ZXJ3aXNlIHdlIHdvdWxkIGhhdmUgdG8gY2hlY2sgZm9yIGV2ZXJ5CiAJICogYWRkcmVzcyBpZiBp
dCBpcyBhIHNwZWNpYWwgWlBDSV9BRERSIGFuZCB3b3VsZCBoYXZlIHRvIGRvCi0JICogYSBnZXRf
cGZuKCkgd2hpY2ggd2UgZG9uJ3QgbmVlZCBmb3IgTUlPIGNhcGFibGUgZGV2aWNlcy4gIEN1cnJl
bnRseQorCSAqIGEgcGZuIGxvb2t1cCB3aGljaCB3ZSBkb24ndCBuZWVkIGZvciBNSU8gY2FwYWJs
ZSBkZXZpY2VzLiAgQ3VycmVudGx5CiAJICogSVNNIGRldmljZXMgYXJlIHRoZSBvbmx5IGRldmlj
ZXMgd2l0aG91dCBNSU8gc3VwcG9ydCBhbmQgdGhlcmUgaXMgbm8KIAkgKiBrbm93biBuZWVkIGZv
ciBhY2Nlc3NpbmcgdGhlc2UgZnJvbSB1c2Vyc3BhY2UuCiAJICovCkBAIC0xNzYsMjEgKzE1OCwz
NyBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9wY2lfbW1pb193cml0ZSwgdW5zaWduZWQgbG9uZywg
bW1pb19hZGRyLAogCX0gZWxzZQogCQlidWYgPSBsb2NhbF9idWY7CiAKLQlyZXQgPSBnZXRfcGZu
KG1taW9fYWRkciwgVk1fV1JJVEUsICZwZm4pOworCXJldCA9IC1FRkFVTFQ7CisJaWYgKGNvcHlf
ZnJvbV91c2VyKGJ1ZiwgdXNlcl9idWZmZXIsIGxlbmd0aCkpCisJCWdvdG8gb3V0X2ZyZWU7CisK
KwltbWFwX3JlYWRfbG9jayhjdXJyZW50LT5tbSk7CisJcmV0ID0gLUVJTlZBTDsKKwl2bWEgPSBm
aW5kX3ZtYShjdXJyZW50LT5tbSwgbW1pb19hZGRyKTsKKwlpZiAoIXZtYSkKKwkJZ290byBvdXRf
dW5sb2NrX21tYXA7CisJaWYgKCEodm1hLT52bV9mbGFncyAmIChWTV9JTyB8IFZNX1BGTk1BUCkp
KQorCQlnb3RvIG91dF91bmxvY2tfbW1hcDsKKwlyZXQgPSAtRUFDQ0VTOworCWlmICghKHZtYS0+
dm1fZmxhZ3MgJiBWTV9XUklURSkpCisJCWdvdG8gb3V0X3VubG9ja19tbWFwOworCisJcmV0ID0g
Zm9sbG93X3B0ZV9wbWQodm1hLT52bV9tbSwgbW1pb19hZGRyLCBOVUxMLCAmcHRlcCwgTlVMTCwg
JnB0bCk7CiAJaWYgKHJldCkKLQkJZ290byBvdXQ7Ci0JaW9fYWRkciA9ICh2b2lkIF9faW9tZW0g
KikoKHBmbiA8PCBQQUdFX1NISUZUKSB8CisJCWdvdG8gb3V0X3VubG9ja19tbWFwOworCisJaW9f
YWRkciA9ICh2b2lkIF9faW9tZW0gKikoKHB0ZV9wZm4oKnB0ZXApIDw8IFBBR0VfU0hJRlQpIHwK
IAkJCShtbWlvX2FkZHIgJiB+UEFHRV9NQVNLKSk7CiAKLQlyZXQgPSAtRUZBVUxUOwogCWlmICgo
dW5zaWduZWQgbG9uZykgaW9fYWRkciA8IFpQQ0lfSU9NQVBfQUREUl9CQVNFKQotCQlnb3RvIG91
dDsKLQotCWlmIChjb3B5X2Zyb21fdXNlcihidWYsIHVzZXJfYnVmZmVyLCBsZW5ndGgpKQotCQln
b3RvIG91dDsKKwkJZ290byBvdXRfdW5sb2NrX3B0OwogCiAJcmV0ID0genBjaV9tZW1jcHlfdG9p
byhpb19hZGRyLCBidWYsIGxlbmd0aCk7Ci1vdXQ6CitvdXRfdW5sb2NrX3B0OgorCXB0ZV91bm1h
cF91bmxvY2socHRlcCwgcHRsKTsKK291dF91bmxvY2tfbW1hcDoKKwltbWFwX3JlYWRfdW5sb2Nr
KGN1cnJlbnQtPm1tKTsKK291dF9mcmVlOgogCWlmIChidWYgIT0gbG9jYWxfYnVmKQogCQlrZnJl
ZShidWYpOwogCXJldHVybiByZXQ7CkBAIC0yNzQsNyArMjcyLDkgQEAgU1lTQ0FMTF9ERUZJTkUz
KHMzOTBfcGNpX21taW9fcmVhZCwgdW5zaWduZWQgbG9uZywgbW1pb19hZGRyLAogCXU4IGxvY2Fs
X2J1Zls2NF07CiAJdm9pZCBfX2lvbWVtICppb19hZGRyOwogCXZvaWQgKmJ1ZjsKLQl1bnNpZ25l
ZCBsb25nIHBmbjsKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYTsKKwlwdGVfdCAqcHRlcDsK
KwlzcGlubG9ja190ICpwdGw7CiAJbG9uZyByZXQ7CiAKIAlpZiAoIXpwY2lfaXNfZW5hYmxlZCgp
KQpAQCAtMjg3LDcgKzI4Nyw3IEBAIFNZU0NBTExfREVGSU5FMyhzMzkwX3BjaV9tbWlvX3JlYWQs
IHVuc2lnbmVkIGxvbmcsIG1taW9fYWRkciwKIAkgKiBXZSBvbmx5IHN1cHBvcnQgcmVhZCBhY2Nl
c3MgdG8gTUlPIGNhcGFibGUgZGV2aWNlcyBpZiB3ZSBhcmUgb24KIAkgKiBhIE1JTyBlbmFibGVk
IHN5c3RlbS4gT3RoZXJ3aXNlIHdlIHdvdWxkIGhhdmUgdG8gY2hlY2sgZm9yIGV2ZXJ5CiAJICog
YWRkcmVzcyBpZiBpdCBpcyBhIHNwZWNpYWwgWlBDSV9BRERSIGFuZCB3b3VsZCBoYXZlIHRvIGRv
Ci0JICogYSBnZXRfcGZuKCkgd2hpY2ggd2UgZG9uJ3QgbmVlZCBmb3IgTUlPIGNhcGFibGUgZGV2
aWNlcy4gIEN1cnJlbnRseQorCSAqIGEgcGZuIGxvb2t1cCB3aGljaCB3ZSBkb24ndCBuZWVkIGZv
ciBNSU8gY2FwYWJsZSBkZXZpY2VzLiAgQ3VycmVudGx5CiAJICogSVNNIGRldmljZXMgYXJlIHRo
ZSBvbmx5IGRldmljZXMgd2l0aG91dCBNSU8gc3VwcG9ydCBhbmQgdGhlcmUgaXMgbm8KIAkgKiBr
bm93biBuZWVkIGZvciBhY2Nlc3NpbmcgdGhlc2UgZnJvbSB1c2Vyc3BhY2UuCiAJICovCkBAIC0z
MDYsMjIgKzMwNiwzOCBAQCBTWVNDQUxMX0RFRklORTMoczM5MF9wY2lfbW1pb19yZWFkLCB1bnNp
Z25lZCBsb25nLCBtbWlvX2FkZHIsCiAJCWJ1ZiA9IGxvY2FsX2J1ZjsKIAl9CiAKLQlyZXQgPSBn
ZXRfcGZuKG1taW9fYWRkciwgVk1fUkVBRCwgJnBmbik7CisJbW1hcF9yZWFkX2xvY2soY3VycmVu
dC0+bW0pOworCXJldCA9IC1FSU5WQUw7CisJdm1hID0gZmluZF92bWEoY3VycmVudC0+bW0sIG1t
aW9fYWRkcik7CisJaWYgKCF2bWEpCisJCWdvdG8gb3V0X3VubG9ja19tbWFwOworCWlmICghKHZt
YS0+dm1fZmxhZ3MgJiAoVk1fSU8gfCBWTV9QRk5NQVApKSkKKwkJZ290byBvdXRfdW5sb2NrX21t
YXA7CisJcmV0ID0gLUVBQ0NFUzsKKwlpZiAoISh2bWEtPnZtX2ZsYWdzICYgVk1fV1JJVEUpKQor
CQlnb3RvIG91dF91bmxvY2tfbW1hcDsKKworCXJldCA9IGZvbGxvd19wdGVfcG1kKHZtYS0+dm1f
bW0sIG1taW9fYWRkciwgTlVMTCwgJnB0ZXAsIE5VTEwsICZwdGwpOwogCWlmIChyZXQpCi0JCWdv
dG8gb3V0OwotCWlvX2FkZHIgPSAodm9pZCBfX2lvbWVtICopKChwZm4gPDwgUEFHRV9TSElGVCkg
fCAobW1pb19hZGRyICYgflBBR0VfTUFTSykpOworCQlnb3RvIG91dF91bmxvY2tfbW1hcDsKKwor
CWlvX2FkZHIgPSAodm9pZCBfX2lvbWVtICopKChwdGVfcGZuKCpwdGVwKSA8PCBQQUdFX1NISUZU
KSB8CisJCQkobW1pb19hZGRyICYgflBBR0VfTUFTSykpOwogCiAJaWYgKCh1bnNpZ25lZCBsb25n
KSBpb19hZGRyIDwgWlBDSV9JT01BUF9BRERSX0JBU0UpIHsKIAkJcmV0ID0gLUVGQVVMVDsKLQkJ
Z290byBvdXQ7CisJCWdvdG8gb3V0X3VubG9ja19wdDsKIAl9CiAJcmV0ID0genBjaV9tZW1jcHlf
ZnJvbWlvKGJ1ZiwgaW9fYWRkciwgbGVuZ3RoKTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKLQlp
ZiAoY29weV90b191c2VyKHVzZXJfYnVmZmVyLCBidWYsIGxlbmd0aCkpCisKK291dF91bmxvY2tf
cHQ6CisJcHRlX3VubWFwX3VubG9jayhwdGVwLCBwdGwpOworb3V0X3VubG9ja19tbWFwOgorCW1t
YXBfcmVhZF91bmxvY2soY3VycmVudC0+bW0pOworCisJaWYgKCFyZXQgJiYgY29weV90b191c2Vy
KHVzZXJfYnVmZmVyLCBidWYsIGxlbmd0aCkpCiAJCXJldCA9IC1FRkFVTFQ7CiAKLW91dDoKIAlp
ZiAoYnVmICE9IGxvY2FsX2J1ZikKIAkJa2ZyZWUoYnVmKTsKIAlyZXR1cm4gcmV0OwotLSAKMi4y
OC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
