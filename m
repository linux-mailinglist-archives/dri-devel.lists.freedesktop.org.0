Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BBC5634643A
	for <lists+dri-devel@lfdr.de>; Tue, 23 Mar 2021 16:59:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8733C6EC3E;
	Tue, 23 Mar 2021 15:58:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B5F5E6EC1B
 for <dri-devel@lists.freedesktop.org>; Tue, 23 Mar 2021 15:57:44 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Subject: [PATCH v9 24/70] drm/i915: Move pinning to inside
 engine_wa_list_verify()
Date: Tue, 23 Mar 2021 16:50:13 +0100
Message-Id: <20210323155059.628690-25-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.31.0
In-Reply-To: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
References: <20210323155059.628690-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBzaG91bGQgYmUgZG9uZSBhcyBwYXJ0IG9mIHRoZSB3dyBsb29wLCBpbiBvcmRlciB0byBy
ZW1vdmUgYQppOTE1X3ZtYV9waW4gdGhhdCBuZWVkcyB3dyBoZWxkLgoKTm93IG9ubHkgaTkxNV9n
Z3R0X3BpbigpIGNhbGxlcnMgcmVtYWluaW5nLgoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5r
aG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFRo
b21hcyBIZWxsc3Ryw7ZtIDx0aG9tYXMuaGVsbHN0cm9tQGxpbnV4LmludGVsLmNvbT4KLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndHQuYyAgICAgICAgICAgIHwgMTQgKysrKysr
KysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0dC5oICAgICAgICAgICAg
fCAgMyArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmthcm91bmRzLmMgICAg
fCAxMCArKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlz
dHMuYyAgIHwgIDUgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
ICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5j
ICAgICAgICB8ICAzICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fy
b3VuZHMuYyB8ICA2ICsrKy0tLQogNyBmaWxlcyBjaGFuZ2VkLCAzMyBpbnNlcnRpb25zKCspLCAx
MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0dC5jCmluZGV4IGQzNDc3
MGFlNGM5YS4uMWI1MzJhMjc5MWVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndHQuYwpA
QCAtNDI3LDcgKzQyNyw2IEBAIF9fdm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWludCBlcnI7
CiAKIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHZtLT5pOTE1LCBQQUdF
X0FMSUdOKHNpemUpKTsKIAlpZiAoSVNfRVJSKG9iaikpCkBAIC00NDEsNiArNDQwLDE5IEBAIF9f
dm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
IHVuc2lnbmVkIGxvbmcgc2l6ZSkKIAkJcmV0dXJuIHZtYTsKIAl9CiAKKwlyZXR1cm4gdm1hOwor
fQorCitzdHJ1Y3QgaTkxNV92bWEgKgorX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5u
ZWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSkKK3sK
KwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJdm1hID0gX192bV9jcmVhdGVf
c2NyYXRjaF9mb3JfcmVhZCh2bSwgc2l6ZSk7CisJaWYgKElTX0VSUih2bWEpKQorCQlyZXR1cm4g
dm1hOworCiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwKIAkJCSAgIGk5MTVfdm1hX2lz
X2dndHQodm1hKSA/IFBJTl9HTE9CQUwgOiBQSU5fVVNFUik7CiAJaWYgKGVycikgewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndHQuaAppbmRleCAyNGI1ODA4ZGYxNmQuLjc4NGM0MzcyYjQwNSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmgKQEAgLTU4MSw2ICs1ODEsOSBAQCB2b2lk
IGk5MTVfdm1fZnJlZV9wdF9zdGFzaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIHN0
cnVjdCBpOTE1X3ZtYSAqCiBfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtLCB1bnNpZ25lZCBsb25nIHNpemUpOwogCitzdHJ1Y3QgaTkxNV92
bWEgKgorX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSk7CisKIHN0YXRpYyBpbmxpbmUgc3Ry
dWN0IHNndF9kbWEgewogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CiAJZG1hX2FkZHJfdCBkbWEs
IG1heDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmthcm91
bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF93b3JrYXJvdW5kcy5jCmluZGV4
IDNiNGE3ZGE2MGYwYi4uYmIyMzU3MTE5NzkyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3dvcmthcm91bmRzLmMKQEAgLTIyMTEsMTAgKzIyMTEsMTUgQEAgc3RhdGljIGludCBl
bmdpbmVfd2FfbGlzdF92ZXJpZnkoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCWlmIChlcnIp
CiAJCWdvdG8gZXJyX3BtOwogCisJZXJyID0gaTkxNV92bWFfcGluX3d3KHZtYSwgJnd3LCAwLCAw
LAorCQkJICAgaTkxNV92bWFfaXNfZ2d0dCh2bWEpID8gUElOX0dMT0JBTCA6IFBJTl9VU0VSKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl91bnBpbjsKKwogCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0
ZShjZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VSUihycSk7Ci0JCWdvdG8g
ZXJyX3VucGluOworCQlnb3RvIGVycl92bWE7CiAJfQogCiAJZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X29iamVjdChycSwgdm1hLT5vYmosIHRydWUpOwpAQCAtMjI1NSw2ICsyMjYwLDggQEAgc3Rh
dGljIGludCBlbmdpbmVfd2FfbGlzdF92ZXJpZnkoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAog
CiBlcnJfcnE6CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CitlcnJfdm1hOgorCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CiBlcnJfdW5waW46CiAJaW50ZWxfY29udGV4dF91bnBpbihjZSk7CiBlcnJfcG06
CkBAIC0yMjY1LDcgKzIyNzIsNiBAQCBzdGF0aWMgaW50IGVuZ2luZV93YV9saXN0X3ZlcmlmeShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJfQogCWk5MTVfZ2VtX3d3X2N0eF9maW5pKCZ3dyk7
CiAJaW50ZWxfZW5naW5lX3BtX3B1dChjZS0+ZW5naW5lKTsKLQlpOTE1X3ZtYV91bnBpbih2bWEp
OwogCWk5MTVfdm1hX3B1dCh2bWEpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2V4ZWNsaXN0cy5jCmluZGV4IGY2MjVjMjkwMjNlYS4uYTZlNzdh
MTYxYjcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVj
bGlzdHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMu
YwpAQCAtNDE2NSw4ICs0MTY1LDkgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdp
bmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlpbnQgZXJyID0gMDsKIAl1MzIgKmNzOwogCi0Jc2Ny
YXRjaCA9IF9fdm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoJnNpYmxpbmdzWzBdLT5ndC0+Z2d0
dC0+dm0sCi0JCQkJCSAgICAgICBQQUdFX1NJWkUpOworCXNjcmF0Y2ggPQorCQlfX3ZtX2NyZWF0
ZV9zY3JhdGNoX2Zvcl9yZWFkX3Bpbm5lZCgmc2libGluZ3NbMF0tPmd0LT5nZ3R0LT52bSwKKwkJ
CQkJCSAgICBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIoc2NyYXRjaCkpCiAJCXJldHVybiBQVFJf
RVJSKHNjcmF0Y2gpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4
IDI3OTA5MWU0MWI0MS4uMWY3YTEyMDYwNmU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYwpAQCAtMjcsNyArMjcsNyBAQAogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpj
cmVhdGVfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXJldHVybiBfX3ZtX2NyZWF0
ZV9zY3JhdGNoX2Zvcl9yZWFkKCZndC0+Z2d0dC0+dm0sIFBBR0VfU0laRSk7CisJcmV0dXJuIF9f
dm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWRfcGlubmVkKCZndC0+Z2d0dC0+dm0sIFBBR0VfU0la
RSk7CiB9CiAKIHN0YXRpYyBib29sIGlzX2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwppbmRleCA0NDYwOWQxYzc3ODAu
LjAxZGQwNTBkNDE2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbW9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwpA
QCAtNzQsNyArNzQsOCBAQCBzdGF0aWMgaW50IGxpdmVfbW9jc19pbml0KHN0cnVjdCBsaXZlX21v
Y3MgKmFyZywgc3RydWN0IGludGVsX2d0ICpndCkKIAlpZiAoZmxhZ3MgJiAoSEFTX0dMT0JBTF9N
T0NTIHwgSEFTX0VOR0lORV9NT0NTKSkKIAkJYXJnLT5tb2NzID0gJmFyZy0+dGFibGU7CiAKLQlh
cmctPnNjcmF0Y2ggPSBfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkKCZndC0+Z2d0dC0+dm0s
IFBBR0VfU0laRSk7CisJYXJnLT5zY3JhdGNoID0KKwkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3Jf
cmVhZF9waW5uZWQoJmd0LT5nZ3R0LT52bSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKGFyZy0+
c2NyYXRjaCkpCiAJCXJldHVybiBQVFJfRVJSKGFyZy0+c2NyYXRjaCk7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IGU1ZWU2MTM2Yzgx
Zi4uZGU2MTM2YmQxMGFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3dvcmthcm91bmRzLmMKQEAgLTQ2Myw3ICs0NjMsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5
X3doaXRlbGlzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJdTMyICpjcywgKnJlc3VsdHM7
CiAKIAlzeiA9ICgyICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSkgKiBzaXplb2YodTMyKTsKLQlz
Y3JhdGNoID0gX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZChjZS0+dm0sIHN6KTsKKwlzY3Jh
dGNoID0gX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoY2UtPnZtLCBzeik7CiAJ
aWYgKElTX0VSUihzY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKQEAgLTEw
MDMsMTQgKzEwMDMsMTQgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2b2lk
ICphcmcpCiAKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKyspIHsKIAkJ
Y2xpZW50W2ldLnNjcmF0Y2hbMF0gPQotCQkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZChn
dC0+dm0sIDQwOTYpOworCQkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoZ3Qt
PnZtLCA0MDk2KTsKIAkJaWYgKElTX0VSUihjbGllbnRbaV0uc2NyYXRjaFswXSkpIHsKIAkJCWVy
ciA9IFBUUl9FUlIoY2xpZW50W2ldLnNjcmF0Y2hbMF0pOwogCQkJZ290byBlcnI7CiAJCX0KIAog
CQljbGllbnRbaV0uc2NyYXRjaFsxXSA9Ci0JCQlfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFk
KGd0LT52bSwgNDA5Nik7CisJCQlfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkX3Bpbm5lZChn
dC0+dm0sIDQwOTYpOwogCQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFdKSkgewogCQkJ
ZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2NyYXRjaFsxXSk7CiAJCQlpOTE1X3ZtYV91bnBpbl9h
bmRfcmVsZWFzZSgmY2xpZW50W2ldLnNjcmF0Y2hbMF0sIDApOwotLSAKMi4zMS4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWwK
