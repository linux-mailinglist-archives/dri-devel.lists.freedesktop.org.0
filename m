Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7239610D693
	for <lists+dri-devel@lfdr.de>; Fri, 29 Nov 2019 14:59:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 05DC46E90E;
	Fri, 29 Nov 2019 13:59:43 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7A4AD6E90C
 for <dri-devel@lists.freedesktop.org>; Fri, 29 Nov 2019 13:59:15 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 169A429263D;
 Fri, 29 Nov 2019 13:59:14 +0000 (GMT)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: Rob Herring <robh+dt@kernel.org>, Tomeu Vizoso <tomeu@tomeuvizoso.net>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>,
 Steven Price <steven.price@arm.com>
Subject: [PATCH 7/8] drm/panfrost: Add the panfrost_gem_mapping concept
Date: Fri, 29 Nov 2019 14:59:07 +0100
Message-Id: <20191129135908.2439529-8-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191129135908.2439529-1-boris.brezillon@collabora.com>
References: <20191129135908.2439529-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Boris Brezillon <boris.brezillon@collabora.com>, stable@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2l0aCB0aGUgaW50cm9kdWN0aW9uIG9mIHBlci1GRCBhZGRyZXNzIHNwYWNlLCB0aGUgc2FtZSBC
TyBjYW4gYmUgbWFwcGVkCmluIGRpZmZlcmVudCBhZGRyZXNzIHNwYWNlIGlmIHRoZSBCTyBpcyBn
bG9iYWxseSB2aXNpYmxlIChHRU1fRkxJTkspCmFuZCBvcGVuZWQgaW4gZGlmZmVyZW50IGNvbnRl
eHQuIFRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIGRvZXMgbm90CnRha2UgY2FzZSBpbnRvIGFj
Y291bnQsIGFuZCBhdHRhY2hlcyB0aGUgbWFwcGluZyBkaXJlY3RseSB0byB0aGUKcGFuZnJvc3Rf
Z2VtX29iamVjdC4KCkxldCdzIGNyZWF0ZSBhIHBhbmZyb3N0X2dlbV9tYXBwaW5nIHN0cnVjdCBh
bmQgYWxsb3cgbXVsdGlwbGUgbWFwcGluZ3MKcGVyIEJPLgoKVGhlIG1hcHBpbmdzIGFyZSByZWZj
b3VudGVkLCB3aGljaCBoZWxwcyBzb2x2ZSBhbm90aGVyIHByb2JsZW0gd2hlcmUKbWFwcGluZ3Mg
d2VyZSB0ZWFyZWQgZG93biAoR0VNIGhhbmRsZSBjbG9zZWQgYnkgdXNlcnNwYWNlKSB3aGlsZSBH
UFUKam9icyBhY2Nlc3NpbmcgdGhvc2UgQk9zIHdlcmUgc3RpbGwgaW4tZmxpZ2h0LiBKb2JzIG5v
dyBrZWVwIGEKcmVmZXJlbmNlIG9uIHRoZSBtYXBwaW5ncyB0aGV5IHVzZS4KCkZpeGVzOiBhNWVm
YjRjOWE1NjIgKCJkcm0vcGFuZnJvc3Q6IFJlc3RydWN0dXJlIHRoZSBHRU0gb2JqZWN0IGNyZWF0
aW9uIikKRml4ZXM6IDcyODJmNzY0NWQwNiAoImRybS9wYW5mcm9zdDogSW1wbGVtZW50IHBlciBG
RCBhZGRyZXNzIHNwYWNlcyIpCkNjOiA8c3RhYmxlQHZnZXIua2VybmVsLm9yZz4KU2lnbmVkLW9m
Zi1ieTogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMgICAgICAgfCAgOTIgKysr
KysrKysrKystCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZ2VtLmMgICAgICAg
fCAxNDAgKysrKysrKysrKysrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3RfZ2VtLmggICAgICAgfCAgNDEgKysrKy0KIC4uLi9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X2dlbV9zaHJpbmtlci5jICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZy
b3N0X2pvYi5jICAgICAgIHwgIDEzICstCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJv
c3Rfam9iLmggICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X21tdS5jICAgICAgIHwgIDYxICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFu
ZnJvc3RfbW11LmggICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9wZXJmY250LmMgICB8ICAzNCArKystLQogOSBmaWxlcyBjaGFuZ2VkLCAzMTggaW5zZXJ0
aW9ucygrKSwgNzQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Bh
bmZyb3N0L3BhbmZyb3N0X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X2Rydi5jCmluZGV4IDc1MWRmOTc1NTM0Zi4uYjQwNmI1MjQzYjQwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3BhbmZyb3N0L3BhbmZyb3N0X2Rydi5jCkBAIC03OCw4ICs3OCwxMCBAQCBzdGF0aWMgaW50IHBh
bmZyb3N0X2lvY3RsX2dldF9wYXJhbShzdHJ1Y3QgZHJtX2RldmljZSAqZGRldiwgdm9pZCAqZGF0
YSwgc3RydWN0CiBzdGF0aWMgaW50IHBhbmZyb3N0X2lvY3RsX2NyZWF0ZV9ibyhzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CisJ
c3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiAqcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OwogCXN0
cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibzsKIAlzdHJ1Y3QgZHJtX3BhbmZyb3N0X2NyZWF0
ZV9ibyAqYXJncyA9IGRhdGE7CisJc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5nICptYXBwaW5n
OwogCiAJaWYgKCFhcmdzLT5zaXplIHx8IGFyZ3MtPnBhZCB8fAogCSAgICAoYXJncy0+ZmxhZ3Mg
JiB+KFBBTkZST1NUX0JPX05PRVhFQyB8IFBBTkZST1NUX0JPX0hFQVApKSkKQEAgLTk1LDcgKzk3
LDE0IEBAIHN0YXRpYyBpbnQgcGFuZnJvc3RfaW9jdGxfY3JlYXRlX2JvKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKElTX0VSUihibykpCiAJCXJldHVybiBQVFJfRVJS
KGJvKTsKIAotCWFyZ3MtPm9mZnNldCA9IGJvLT5ub2RlLnN0YXJ0IDw8IFBBR0VfU0hJRlQ7CisJ
bWFwcGluZyA9IHBhbmZyb3N0X2dlbV9tYXBwaW5nX2dldChibywgcHJpdik7CisJaWYgKCFtYXBw
aW5nKSB7CisJCWRybV9nZW1fb2JqZWN0X3B1dF91bmxvY2tlZCgmYm8tPmJhc2UuYmFzZSk7CisJ
CXJldHVybiAtRUlOVkFMOworCX0KKworCWFyZ3MtPm9mZnNldCA9IG1hcHBpbmctPm1tbm9kZS5z
dGFydCA8PCBQQUdFX1NISUZUOworCXBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1dChtYXBwaW5nKTsK
IAogCXJldHVybiAwOwogfQpAQCAtMTE5LDYgKzEyOCwxMSBAQCBwYW5mcm9zdF9sb29rdXBfYm9z
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAgc3RydWN0IGRybV9wYW5mcm9zdF9zdWJtaXQg
KmFyZ3MsCiAJCSAgc3RydWN0IHBhbmZyb3N0X2pvYiAqam9iKQogeworCXN0cnVjdCBwYW5mcm9z
dF9maWxlX3ByaXYgKnByaXYgPSBmaWxlX3ByaXYtPmRyaXZlcl9wcml2OworCXN0cnVjdCBwYW5m
cm9zdF9nZW1fb2JqZWN0ICpibzsKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQgcmV0OworCiAJam9i
LT5ib19jb3VudCA9IGFyZ3MtPmJvX2hhbmRsZV9jb3VudDsKIAogCWlmICgham9iLT5ib19jb3Vu
dCkKQEAgLTEzMCw5ICsxNDQsMzIgQEAgcGFuZnJvc3RfbG9va3VwX2JvcyhzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCWlmICgham9iLT5pbXBsaWNpdF9mZW5jZXMpCiAJCXJldHVybiAtRU5PTUVN
OwogCi0JcmV0dXJuIGRybV9nZW1fb2JqZWN0c19sb29rdXAoZmlsZV9wcml2LAotCQkJCSAgICAg
ICh2b2lkIF9fdXNlciAqKSh1aW50cHRyX3QpYXJncy0+Ym9faGFuZGxlcywKLQkJCQkgICAgICBq
b2ItPmJvX2NvdW50LCAmam9iLT5ib3MpOworCXJldCA9IGRybV9nZW1fb2JqZWN0c19sb29rdXAo
ZmlsZV9wcml2LAorCQkJCSAgICAgKHZvaWQgX191c2VyICopKHVpbnRwdHJfdClhcmdzLT5ib19o
YW5kbGVzLAorCQkJCSAgICAgam9iLT5ib19jb3VudCwgJmpvYi0+Ym9zKTsKKwlpZiAocmV0KQor
CQlyZXR1cm4gcmV0OworCisJam9iLT5tYXBwaW5ncyA9IGt2bWFsbG9jX2FycmF5KGpvYi0+Ym9f
Y291bnQsCisJCQkJICAgICAgIHNpemVvZihzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKiks
CisJCQkJICAgICAgIEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPKTsKKwlpZiAoIWpvYi0+bWFwcGlu
Z3MpCisJCXJldHVybiAtRU5PTUVNOworCisJZm9yIChpID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7
IGkrKykgeworCQlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmc7CisKKwkJYm8g
PSB0b19wYW5mcm9zdF9ibyhqb2ItPmJvc1tpXSk7CisJCW1hcHBpbmcgPSBwYW5mcm9zdF9nZW1f
bWFwcGluZ19nZXQoYm8sIHByaXYpOworCQlpZiAoIW1hcHBpbmcpIHsKKwkJCXJldCA9IC1FSU5W
QUw7CisJCQlicmVhazsKKwkJfQorCisJCWpvYi0+bWFwcGluZ3NbaV0gPSBtYXBwaW5nOworCX0K
KworCXJldHVybiByZXQ7CiB9CiAKIC8qKgpAQCAtMzIwLDcgKzM1Nyw5IEBAIHN0YXRpYyBpbnQg
cGFuZnJvc3RfaW9jdGxfbW1hcF9ibyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogc3RhdGljIGludCBwYW5mcm9zdF9pb2N0bF9nZXRfYm9fb2Zmc2V0KHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkgICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYp
CiB7CisJc3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiAqcHJpdiA9IGZpbGVfcHJpdi0+ZHJpdmVy
X3ByaXY7CiAJc3RydWN0IGRybV9wYW5mcm9zdF9nZXRfYm9fb2Zmc2V0ICphcmdzID0gZGF0YTsK
KwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmc7CiAJc3RydWN0IGRybV9nZW1f
b2JqZWN0ICpnZW1fb2JqOwogCXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibzsKIApAQCAt
MzMxLDE4ICszNzAsMjUgQEAgc3RhdGljIGludCBwYW5mcm9zdF9pb2N0bF9nZXRfYm9fb2Zmc2V0
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJfQogCWJvID0gdG9fcGFuZnJv
c3RfYm8oZ2VtX29iaik7CiAKLQlhcmdzLT5vZmZzZXQgPSBiby0+bm9kZS5zdGFydCA8PCBQQUdF
X1NISUZUOwotCisJbWFwcGluZyA9IHBhbmZyb3N0X2dlbV9tYXBwaW5nX2dldChibywgcHJpdik7
CiAJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKGdlbV9vYmopOworCisJaWYgKCFtYXBwaW5n
KQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWFyZ3MtPm9mZnNldCA9IG1hcHBpbmctPm1tbm9kZS5z
dGFydCA8PCBQQUdFX1NISUZUOworCXBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1dChtYXBwaW5nKTsK
IAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBwYW5mcm9zdF9pb2N0bF9tYWR2aXNlKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGVfcHJpdikKIHsKKwlzdHJ1Y3QgcGFuZnJvc3RfZmlsZV9wcml2ICpwcml2ID0gZmlsZV9wcml2
LT5kcml2ZXJfcHJpdjsKIAlzdHJ1Y3QgZHJtX3BhbmZyb3N0X21hZHZpc2UgKmFyZ3MgPSBkYXRh
OwogCXN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKIAlz
dHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbV9vYmo7CisJc3RydWN0IHBhbmZyb3N0X2dlbV9vYmpl
Y3QgKmJvOwogCWludCByZXQ7CiAKIAlnZW1fb2JqID0gZHJtX2dlbV9vYmplY3RfbG9va3VwKGZp
bGVfcHJpdiwgYXJncy0+aGFuZGxlKTsKQEAgLTM2NCwxOCArNDEwLDQ4IEBAIHN0YXRpYyBpbnQg
cGFuZnJvc3RfaW9jdGxfbWFkdmlzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3VubG9ja19vYmplY3RfbmFtZTsKIAorCWJvID0gdG9f
cGFuZnJvc3RfYm8oZ2VtX29iaik7CisKIAltdXRleF9sb2NrKCZwZmRldi0+c2hyaW5rZXJfbG9j
ayk7CisJbXV0ZXhfbG9jaygmYm8tPm1hcHBpbmdzLmxvY2spOworCWlmIChhcmdzLT5tYWR2ID09
IFBBTkZST1NUX01BRFZfRE9OVE5FRUQpIHsKKwkJc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5n
ICpmaXJzdCwgKmxhc3Q7CisKKwkJZmlyc3QgPSBsaXN0X2ZpcnN0X2VudHJ5KCZiby0+bWFwcGlu
Z3MubGlzdCwKKwkJCQkJIHN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZywKKwkJCQkJIG5vZGUp
OworCQlsYXN0ID0gbGlzdF9sYXN0X2VudHJ5KCZiby0+bWFwcGluZ3MubGlzdCwKKwkJCQkgICAg
ICAgc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5nLAorCQkJCSAgICAgICBub2RlKTsKKworCQkv
KgorCQkgKiBJZiB3ZSB3YW50IHRvIG1hcmsgdGhlIEJPIHB1cmdlYWJsZSwgdGhlcmUgbXVzdCBi
ZSBvbmx5IG9uZQorCQkgKiB1c2VyOiB0aGUgY2FsbGVyIEZELgorCQkgKiBXZSBjb3VsZCBkbyBz
b21ldGhpbmcgc21hcnRlciBhbmQgbWFyayB0aGUgQk8gcHVyZ2VhYmxlIG9ubHkKKwkJICogd2hl
biBhbGwgaXRzIHVzZXJzIGhhdmUgbWFya2VkIGl0IHB1cmdlYWJsZSwgYnV0IGdsb2JhbGx5CisJ
CSAqIHZpc2libGUvc2hhcmVkIEJPcyBhcmUgbGlrZWx5IHRvIG5ldmVyIGJlIG1hcmtlZCBwdXJn
ZWFibGUKKwkJICogYW55d2F5LCBzbyBsZXQncyBub3QgYm90aGVyLgorCQkgKi8KKwkJaWYgKGZp
cnN0ICE9IGxhc3QgfHwgV0FSTl9PTl9PTkNFKGZpcnN0LT5tbXUgIT0gJnByaXYtPm1tdSkpIHsK
KwkJCXJldCA9IC1FSU5WQUw7CisJCQlnb3RvIG91dF91bmxvY2tfbWFwcGluZ3M7CisJCX0KKwl9
CisKIAlhcmdzLT5yZXRhaW5lZCA9IGRybV9nZW1fc2htZW1fbWFkdmlzZShnZW1fb2JqLCBhcmdz
LT5tYWR2KTsKIAogCWlmIChhcmdzLT5yZXRhaW5lZCkgewotCQlzdHJ1Y3QgcGFuZnJvc3RfZ2Vt
X29iamVjdCAqYm8gPSB0b19wYW5mcm9zdF9ibyhnZW1fb2JqKTsKLQogCQlpZiAoYXJncy0+bWFk
diA9PSBQQU5GUk9TVF9NQURWX0RPTlRORUVEKQogCQkJbGlzdF9hZGRfdGFpbCgmYm8tPmJhc2Uu
bWFkdl9saXN0LAogCQkJCSAgICAgICZwZmRldi0+c2hyaW5rZXJfbGlzdCk7CiAJCWVsc2UgaWYg
KGFyZ3MtPm1hZHYgPT0gUEFORlJPU1RfTUFEVl9XSUxMTkVFRCkKIAkJCWxpc3RfZGVsX2luaXQo
JmJvLT5iYXNlLm1hZHZfbGlzdCk7CiAJfQorCisJcmV0ID0gMDsKKworb3V0X3VubG9ja19tYXBw
aW5nczoKKwltdXRleF91bmxvY2soJmJvLT5tYXBwaW5ncy5sb2NrKTsKIAltdXRleF91bmxvY2so
JnBmZGV2LT5zaHJpbmtlcl9sb2NrKTsKIAogb3V0X3VubG9ja19vYmplY3RfbmFtZToKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwppbmRleCAzMWQ2NDE3ZGQyMWMuLjVhMmM0
NjNjNDVkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dl
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uYwpAQCAtMjks
NiArMjksMTIgQEAgc3RhdGljIHZvaWQgcGFuZnJvc3RfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqb2JqKQogCWxpc3RfZGVsX2luaXQoJmJvLT5iYXNlLm1hZHZfbGlzdCk7
CiAJbXV0ZXhfdW5sb2NrKCZwZmRldi0+c2hyaW5rZXJfbG9jayk7CiAKKwkvKgorCSAqIElmIHdl
IHN0aWxsIGhhdmUgbWFwcGluZ3MgYXR0YWNoZWQgdG8gdGhlIEJPLCB0aGVyZSdzIGEgcHJvYmxl
bSBpbgorCSAqIG91ciByZWZjb3VudGluZy4KKwkgKi8KKwlXQVJOX09OX09OQ0UoIWxpc3RfZW1w
dHkoJmJvLT5tYXBwaW5ncy5saXN0KSk7CisKIAlpZiAoYm8tPnNndHMpIHsKIAkJaW50IGk7CiAJ
CWludCBuX3NndCA9IGJvLT5iYXNlLmJhc2Uuc2l6ZSAvIFNaXzJNOwpAQCAtNDYsNiArNTIsNzAg
QEAgc3RhdGljIHZvaWQgcGFuZnJvc3RfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29i
amVjdCAqb2JqKQogCWRybV9nZW1fc2htZW1fZnJlZV9vYmplY3Qob2JqKTsKIH0KIAorc3RydWN0
IHBhbmZyb3N0X2dlbV9tYXBwaW5nICoKK3BhbmZyb3N0X2dlbV9tYXBwaW5nX2dldChzdHJ1Y3Qg
cGFuZnJvc3RfZ2VtX29iamVjdCAqYm8sCisJCQkgc3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiAq
cHJpdikKK3sKKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmcgPSBOVUxMLCAq
aXRlcjsKKworCW11dGV4X2xvY2soJmJvLT5tYXBwaW5ncy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNo
X2VudHJ5KGl0ZXIsICZiby0+bWFwcGluZ3MubGlzdCwgbm9kZSkgeworCQlpZiAoaXRlci0+bW11
ID09ICZwcml2LT5tbXUpIHsKKwkJCWtyZWZfZ2V0KCZpdGVyLT5yZWZjb3VudCk7CisJCQltYXBw
aW5nID0gaXRlcjsKKwkJfQorCX0KKwltdXRleF91bmxvY2soJmJvLT5tYXBwaW5ncy5sb2NrKTsK
KworCXJldHVybiBtYXBwaW5nOworfQorCitzdGF0aWMgdm9pZAorcGFuZnJvc3RfZ2VtX3RlYXJk
b3duX21hcHBpbmcoc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5nICptYXBwaW5nKQoreworCXN0
cnVjdCBwYW5mcm9zdF9maWxlX3ByaXYgKnByaXY7CisKKwlpZiAobWFwcGluZy0+YWN0aXZlKQor
CQlwYW5mcm9zdF9tbXVfdW5tYXAobWFwcGluZyk7CisKKwlwcml2ID0gY29udGFpbmVyX29mKG1h
cHBpbmctPm1tdSwgc3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiwgbW11KTsKKwlzcGluX2xvY2so
JnByaXYtPm1tX2xvY2spOworCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJm1hcHBpbmctPm1t
bm9kZSkpCisJCWRybV9tbV9yZW1vdmVfbm9kZSgmbWFwcGluZy0+bW1ub2RlKTsKKwlzcGluX3Vu
bG9jaygmcHJpdi0+bW1fbG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIHBhbmZyb3N0X2dlbV9tYXBw
aW5nX3JlbGVhc2Uoc3RydWN0IGtyZWYgKmtyZWYpCit7CisJc3RydWN0IHBhbmZyb3N0X2dlbV9t
YXBwaW5nICptYXBwaW5nOworCXN0cnVjdCBwYW5mcm9zdF9maWxlX3ByaXYgKnByaXY7CisKKwlt
YXBwaW5nID0gY29udGFpbmVyX29mKGtyZWYsIHN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZywg
cmVmY291bnQpOworCXByaXYgPSBjb250YWluZXJfb2YobWFwcGluZy0+bW11LCBzdHJ1Y3QgcGFu
ZnJvc3RfZmlsZV9wcml2LCBtbXUpOworCisJcGFuZnJvc3RfZ2VtX3RlYXJkb3duX21hcHBpbmco
bWFwcGluZyk7CisJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZtYXBwaW5nLT5vYmotPmJh
c2UuYmFzZSk7CisJa2ZyZWUobWFwcGluZyk7Cit9CisKK3ZvaWQgcGFuZnJvc3RfZ2VtX21hcHBp
bmdfcHV0KHN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZyAqbWFwcGluZykKK3sKKwlpZiAoIW1h
cHBpbmcpCisJCXJldHVybjsKKworCWtyZWZfcHV0KCZtYXBwaW5nLT5yZWZjb3VudCwgcGFuZnJv
c3RfZ2VtX21hcHBpbmdfcmVsZWFzZSk7Cit9CisKK3ZvaWQgcGFuZnJvc3RfZ2VtX3RlYXJkb3du
X21hcHBpbmdzKHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibykKK3sKKwlzdHJ1Y3QgcGFu
ZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmc7CisKKwltdXRleF9sb2NrKCZiby0+bWFwcGluZ3Mu
bG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShtYXBwaW5nLCAmYm8tPm1hcHBpbmdzLmxpc3Qs
IG5vZGUpCisJCXBhbmZyb3N0X2dlbV90ZWFyZG93bl9tYXBwaW5nKG1hcHBpbmcpOworCW11dGV4
X3VubG9jaygmYm8tPm1hcHBpbmdzLmxvY2spOworfQorCiBpbnQgcGFuZnJvc3RfZ2VtX29wZW4o
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQog
ewogCWludCByZXQ7CkBAIC01NCw2ICsxMjQsMTYgQEAgaW50IHBhbmZyb3N0X2dlbV9vcGVuKHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKIAlz
dHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8gPSB0b19wYW5mcm9zdF9ibyhvYmopOwogCXVu
c2lnbmVkIGxvbmcgY29sb3IgPSBiby0+bm9leGVjID8gUEFORlJPU1RfQk9fTk9FWEVDIDogMDsK
IAlzdHJ1Y3QgcGFuZnJvc3RfZmlsZV9wcml2ICpwcml2ID0gZmlsZV9wcml2LT5kcml2ZXJfcHJp
djsKKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmc7CisKKwltYXBwaW5nID0g
a3phbGxvYyhzaXplb2YoKm1hcHBpbmcpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIW1hcHBpbmcpCisJ
CXJldHVybiAtRU5PTUVNOworCisJSU5JVF9MSVNUX0hFQUQoJm1hcHBpbmctPm5vZGUpOworCWty
ZWZfaW5pdCgmbWFwcGluZy0+cmVmY291bnQpOworCWRybV9nZW1fb2JqZWN0X2dldChvYmopOwor
CW1hcHBpbmctPm9iaiA9IGJvOwogCiAJLyoKIAkgKiBFeGVjdXRhYmxlIGJ1ZmZlcnMgY2Fubm90
IGNyb3NzIGEgMTZNQiBib3VuZGFyeSBhcyB0aGUgcHJvZ3JhbQpAQCAtNjYsMzcgKzE0Niw2MSBA
QCBpbnQgcGFuZnJvc3RfZ2VtX29wZW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmosIHN0cnVj
dCBkcm1fZmlsZSAqZmlsZV9wcml2KQogCWVsc2UKIAkJYWxpZ24gPSBzaXplID49IFNaXzJNID8g
U1pfMk0gPj4gUEFHRV9TSElGVCA6IDA7CiAKLQliby0+bW11ID0gJnByaXYtPm1tdTsKKwltYXBw
aW5nLT5tbXUgPSAmcHJpdi0+bW11OwogCXNwaW5fbG9jaygmcHJpdi0+bW1fbG9jayk7Ci0JcmV0
ID0gZHJtX21tX2luc2VydF9ub2RlX2dlbmVyaWMoJnByaXYtPm1tLCAmYm8tPm5vZGUsCisJcmV0
ID0gZHJtX21tX2luc2VydF9ub2RlX2dlbmVyaWMoJnByaXYtPm1tLCAmbWFwcGluZy0+bW1ub2Rl
LAogCQkJCQkgc2l6ZSA+PiBQQUdFX1NISUZULCBhbGlnbiwgY29sb3IsIDApOwogCXNwaW5fdW5s
b2NrKCZwcml2LT5tbV9sb2NrKTsKIAlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCQlnb3RvIGVy
cjsKIAogCWlmICghYm8tPmlzX2hlYXApIHsKLQkJcmV0ID0gcGFuZnJvc3RfbW11X21hcChibyk7
Ci0JCWlmIChyZXQpIHsKLQkJCXNwaW5fbG9jaygmcHJpdi0+bW1fbG9jayk7Ci0JCQlkcm1fbW1f
cmVtb3ZlX25vZGUoJmJvLT5ub2RlKTsKLQkJCXNwaW5fdW5sb2NrKCZwcml2LT5tbV9sb2NrKTsK
LQkJfQorCQlyZXQgPSBwYW5mcm9zdF9tbXVfbWFwKG1hcHBpbmcpOworCQlpZiAocmV0KQorCQkJ
Z290byBlcnI7CiAJfQorCisJbXV0ZXhfbG9jaygmb2JqLT5kZXYtPm9iamVjdF9uYW1lX2xvY2sp
OworCS8qCisJICogV2UgbXVzdCBtYWtlIHN1cmUgdGhlIEJPIGhhcyBub3QgYmVlbiBtYXJrZWQg
cHVyZ2VhYmxlIGJlZm9yZQorCSAqIGFkZGluZyB0aGUgbWFwcGluZy4KKwkgKi8KKwlpZiAoYm8t
PmJhc2UubWFkdiA9PSBQQU5GUk9TVF9NQURWX1dJTExORUVEKSB7CisJCW11dGV4X2xvY2soJmJv
LT5tYXBwaW5ncy5sb2NrKTsKKwkJbGlzdF9hZGRfdGFpbCgmbWFwcGluZy0+bm9kZSwgJmJvLT5t
YXBwaW5ncy5saXN0KTsKKwkJbXV0ZXhfdW5sb2NrKCZiby0+bWFwcGluZ3MubG9jayk7CisJfSBl
bHNlIHsKKwkJcmV0ID0gLUVJTlZBTDsKKwl9CisJbXV0ZXhfdW5sb2NrKCZvYmotPmRldi0+b2Jq
ZWN0X25hbWVfbG9jayk7CisKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKKworCXJldHVybiAwOwor
CitlcnI6CisJcGFuZnJvc3RfZ2VtX21hcHBpbmdfcHV0KG1hcHBpbmcpOwogCXJldHVybiByZXQ7
CiB9CiAKIHZvaWQgcGFuZnJvc3RfZ2VtX2Nsb3NlKHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKIHsKLQlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29i
amVjdCAqYm8gPSB0b19wYW5mcm9zdF9ibyhvYmopOwogCXN0cnVjdCBwYW5mcm9zdF9maWxlX3By
aXYgKnByaXYgPSBmaWxlX3ByaXYtPmRyaXZlcl9wcml2OworCXN0cnVjdCBwYW5mcm9zdF9nZW1f
b2JqZWN0ICpibyA9IHRvX3BhbmZyb3N0X2JvKG9iaik7CisJc3RydWN0IHBhbmZyb3N0X2dlbV9t
YXBwaW5nICptYXBwaW5nID0gTlVMTCwgKml0ZXI7CisKKwltdXRleF9sb2NrKCZiby0+bWFwcGlu
Z3MubG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShpdGVyLCAmYm8tPm1hcHBpbmdzLmxpc3Qs
IG5vZGUpIHsKKwkJaWYgKGl0ZXItPm1tdSA9PSAmcHJpdi0+bW11KSB7CisJCQltYXBwaW5nID0g
aXRlcjsKKwkJCWxpc3RfZGVsKCZpdGVyLT5ub2RlKTsKKwkJCWJyZWFrOworCQl9CisJfQorCW11
dGV4X3VubG9jaygmYm8tPm1hcHBpbmdzLmxvY2spOwogCi0JaWYgKGJvLT5pc19tYXBwZWQpCi0J
CXBhbmZyb3N0X21tdV91bm1hcChibyk7Ci0KLQlzcGluX2xvY2soJnByaXYtPm1tX2xvY2spOwot
CWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJmJvLT5ub2RlKSkKLQkJZHJtX21tX3JlbW92ZV9u
b2RlKCZiby0+bm9kZSk7Ci0Jc3Bpbl91bmxvY2soJnByaXYtPm1tX2xvY2spOworCXBhbmZyb3N0
X2dlbV9tYXBwaW5nX3B1dChtYXBwaW5nKTsKIH0KIAogc3RhdGljIHN0cnVjdCBkbWFfYnVmICoK
QEAgLTE2Myw2ICsyNjcsOCBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKnBhbmZyb3N0X2dlbV9j
cmVhdGVfb2JqZWN0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHNpemVfdAogCWlmICghb2JqKQog
CQlyZXR1cm4gTlVMTDsKIAorCUlOSVRfTElTVF9IRUFEKCZvYmotPm1hcHBpbmdzLmxpc3QpOwor
CW11dGV4X2luaXQoJm9iai0+bWFwcGluZ3MubG9jayk7CiAJb2JqLT5iYXNlLmJhc2UuZnVuY3Mg
PSAmcGFuZnJvc3RfZ2VtX2Z1bmNzOwogCiAJcmV0dXJuICZvYmotPmJhc2UuYmFzZTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaCBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaAppbmRleCA0YjE3ZTczMDg3NjQuLmNhMWJj
OTAxOTYwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dl
bS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW0uaApAQCAtMTMs
MjMgKzEzLDQ2IEBAIHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0IHsKIAlzdHJ1Y3QgZHJtX2dl
bV9zaG1lbV9vYmplY3QgYmFzZTsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnNndHM7CiAKLQlzdHJ1Y3Qg
cGFuZnJvc3RfbW11ICptbXU7Ci0Jc3RydWN0IGRybV9tbV9ub2RlIG5vZGU7Ci0JYm9vbCBpc19t
YXBwZWQJCToxOworCS8qCisJICogVXNlIGEgbGlzdCBmb3Igbm93LiBJZiBzZWFyY2hpbmcgYSBt
YXBwaW5nIGV2ZXIgYmVjb21lcyB0aGUKKwkgKiBib3R0bGVuZWNrLCB3ZSBzaG91bGQgY29uc2lk
ZXIgdXNpbmcgYW4gUkItdHJlZSwgb3IgZXZlbiBiZXR0ZXIsCisJICogbGV0IHRoZSBjb3JlIHN0
b3JlIGRybV9nZW1fb2JqZWN0X21hcHBpbmcgZW50cmllcyAod2hlcmUgd2UKKwkgKiBjb3VsZCBw
bGFjZSBkcml2ZXIgc3BlY2lmaWMgZGF0YSkgaW5zdGVhZCBvZiBkcm1fZ2VtX29iamVjdCBvbmVz
CisJICogaW4gaXRzIGRybV9maWxlLT5vYmplY3RfaWRyIHRhYmxlLgorCSAqCisJICogc3RydWN0
IGRybV9nZW1fb2JqZWN0X21hcHBpbmcgeworCSAqCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2Jq
OworCSAqCXZvaWQgKmRyaXZlcl9wcml2OworCSAqIH07CisJICovCisJc3RydWN0IHsKKwkJc3Ry
dWN0IGxpc3RfaGVhZCBsaXN0OworCQlzdHJ1Y3QgbXV0ZXggbG9jazsKKwl9IG1hcHBpbmdzOwor
CiAJYm9vbCBub2V4ZWMJCToxOwogCWJvb2wgaXNfaGVhcAkJOjE7CiB9OwogCitzdHJ1Y3QgcGFu
ZnJvc3RfZ2VtX21hcHBpbmcgeworCXN0cnVjdCBsaXN0X2hlYWQgbm9kZTsKKwlzdHJ1Y3Qga3Jl
ZiByZWZjb3VudDsKKwlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBk
cm1fbW1fbm9kZSBtbW5vZGU7CisJc3RydWN0IHBhbmZyb3N0X21tdSAqbW11OworCWJvb2wgYWN0
aXZlCQk6MTsKK307CisKIHN0YXRpYyBpbmxpbmUKIHN0cnVjdCAgcGFuZnJvc3RfZ2VtX29iamVj
dCAqdG9fcGFuZnJvc3RfYm8oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJcmV0dXJu
IGNvbnRhaW5lcl9vZih0b19kcm1fZ2VtX3NobWVtX29iaihvYmopLCBzdHJ1Y3QgcGFuZnJvc3Rf
Z2VtX29iamVjdCwgYmFzZSk7CiB9CiAKLXN0YXRpYyBpbmxpbmUKLXN0cnVjdCAgcGFuZnJvc3Rf
Z2VtX29iamVjdCAqZHJtX21tX25vZGVfdG9fcGFuZnJvc3RfYm8oc3RydWN0IGRybV9tbV9ub2Rl
ICpub2RlKQorc3RhdGljIGlubGluZSBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKgorZHJt
X21tX25vZGVfdG9fcGFuZnJvc3RfbWFwcGluZyhzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCiB7
Ci0JcmV0dXJuIGNvbnRhaW5lcl9vZihub2RlLCBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCwg
bm9kZSk7CisJcmV0dXJuIGNvbnRhaW5lcl9vZihub2RlLCBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21h
cHBpbmcsIG1tbm9kZSk7CiB9CiAKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqcGFuZnJvc3RfZ2Vt
X2NyZWF0ZV9vYmplY3Qoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc2l6ZV90IHNpemUpOwpAQCAt
NDksNiArNzIsMTIgQEAgaW50IHBhbmZyb3N0X2dlbV9vcGVuKHN0cnVjdCBkcm1fZ2VtX29iamVj
dCAqb2JqLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7CiB2b2lkIHBhbmZyb3N0X2dlbV9j
bG9zZShzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKIAkJCXN0cnVjdCBkcm1fZmlsZSAqZmls
ZV9wcml2KTsKIAorc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5nICoKK3BhbmZyb3N0X2dlbV9t
YXBwaW5nX2dldChzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8sCisJCQkgc3RydWN0IHBh
bmZyb3N0X2ZpbGVfcHJpdiAqcHJpdik7Cit2b2lkIHBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1dChz
dHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKm1hcHBpbmcpOwordm9pZCBwYW5mcm9zdF9nZW1f
dGVhcmRvd25fbWFwcGluZ3Moc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJvKTsKKwogdm9p
ZCBwYW5mcm9zdF9nZW1fc2hyaW5rZXJfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKIHZv
aWQgcGFuZnJvc3RfZ2VtX3Nocmlua2VyX2NsZWFudXAoc3RydWN0IGRybV9kZXZpY2UgKmRldik7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW1fc2hy
aW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW1fc2hyaW5rZXIu
YwppbmRleCA0NThmMGZhNjgxMTEuLmIzNmRmMzI2Yzg2MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2dlbV9zaHJpbmtlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9nZW1fc2hyaW5rZXIuYwpAQCAtMzksMTEgKzM5LDEzIEBA
IHBhbmZyb3N0X2dlbV9zaHJpbmtlcl9jb3VudChzdHJ1Y3Qgc2hyaW5rZXIgKnNocmlua2VyLCBz
dHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjCiBzdGF0aWMgYm9vbCBwYW5mcm9zdF9nZW1fcHVyZ2Uo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJc3RydWN0IGRybV9nZW1fc2htZW1fb2Jq
ZWN0ICpzaG1lbSA9IHRvX2RybV9nZW1fc2htZW1fb2JqKG9iaik7CisJc3RydWN0IHBhbmZyb3N0
X2dlbV9vYmplY3QgKmJvID0gdG9fcGFuZnJvc3RfYm8ob2JqKTsKKwogCiAJaWYgKCFtdXRleF90
cnlsb2NrKCZzaG1lbS0+cGFnZXNfbG9jaykpCiAJCXJldHVybiBmYWxzZTsKIAotCXBhbmZyb3N0
X21tdV91bm1hcCh0b19wYW5mcm9zdF9ibyhvYmopKTsKKwlwYW5mcm9zdF9nZW1fdGVhcmRvd25f
bWFwcGluZ3MoYm8pOwogCWRybV9nZW1fc2htZW1fcHVyZ2VfbG9ja2VkKG9iaik7CiAKIAltdXRl
eF91bmxvY2soJnNobWVtLT5wYWdlc19sb2NrKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5m
cm9zdF9qb2IuYwppbmRleCBjZGQ5NDQ4ZmJiZGQuLmM4NWQ0NWJlM2I1ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuYwpAQCAtMjY5LDkgKzI2OSwyMCBAQCBzdGF0aWMg
dm9pZCBwYW5mcm9zdF9qb2JfY2xlYW51cChzdHJ1Y3Qga3JlZiAqcmVmKQogCWRtYV9mZW5jZV9w
dXQoam9iLT5kb25lX2ZlbmNlKTsKIAlkbWFfZmVuY2VfcHV0KGpvYi0+cmVuZGVyX2RvbmVfZmVu
Y2UpOwogCi0JaWYgKGpvYi0+Ym9zKSB7CisJaWYgKGpvYi0+bWFwcGluZ3MpIHsKIAkJZm9yIChp
ID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7IGkrKykKKwkJCXBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1
dChqb2ItPm1hcHBpbmdzW2ldKTsKKwkJa3ZmcmVlKGpvYi0+bWFwcGluZ3MpOworCX0KKworCWlm
IChqb2ItPmJvcykgeworCQlzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm87CisKKwkJZm9y
IChpID0gMDsgaSA8IGpvYi0+Ym9fY291bnQ7IGkrKykgeworCQkJYm8gPSB0b19wYW5mcm9zdF9i
byhqb2ItPmJvc1tpXSk7CiAJCQlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoam9iLT5ib3Nb
aV0pOworCQl9CisKIAkJa3ZmcmVlKGpvYi0+Ym9zKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuaCBiL2RyaXZlcnMvZ3B1L2RybS9wYW5m
cm9zdC9wYW5mcm9zdF9qb2IuaAppbmRleCA2MjQ1NDEyOGE3OTIuLmJiZDNiYTk3ZmY2NyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X2pvYi5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9qb2IuaApAQCAtMzIsNiArMzIsNyBAQCBz
dHJ1Y3QgcGFuZnJvc3Rfam9iIHsKIAogCS8qIEV4Y2x1c2l2ZSBmZW5jZXMgd2UgaGF2ZSB0YWtl
biBmcm9tIHRoZSBCT3MgdG8gd2FpdCBmb3IgKi8KIAlzdHJ1Y3QgZG1hX2ZlbmNlICoqaW1wbGlj
aXRfZmVuY2VzOworCXN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZyAqKm1hcHBpbmdzOwogCXN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqKmJvczsKIAl1MzIgYm9fY291bnQ7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwppbmRleCBhM2VkNjRhMWYxNWUuLjc2M2NmY2E4ODZh
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0X21tdS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuYwpAQCAtMjY5LDE0ICsy
NjksMTUgQEAgc3RhdGljIGludCBtbXVfbWFwX3NnKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBm
ZGV2LCBzdHJ1Y3QgcGFuZnJvc3RfbW11ICptbXUsCiAJcmV0dXJuIDA7CiB9CiAKLWludCBwYW5m
cm9zdF9tbXVfbWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibykKK2ludCBwYW5mcm9z
dF9tbXVfbWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZyAqbWFwcGluZykKIHsKKwlzdHJ1
Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8gPSBtYXBwaW5nLT5vYmo7CiAJc3RydWN0IGRybV9n
ZW1fb2JqZWN0ICpvYmogPSAmYm8tPmJhc2UuYmFzZTsKIAlzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNl
ICpwZmRldiA9IHRvX3BhbmZyb3N0X2RldmljZShvYmotPmRldik7CiAJc3RydWN0IHNnX3RhYmxl
ICpzZ3Q7CiAJaW50IHByb3QgPSBJT01NVV9SRUFEIHwgSU9NTVVfV1JJVEU7CiAKLQlpZiAoV0FS
Tl9PTihiby0+aXNfbWFwcGVkKSkKKwlpZiAoV0FSTl9PTihtYXBwaW5nLT5hY3RpdmUpKQogCQly
ZXR1cm4gMDsKIAogCWlmIChiby0+bm9leGVjKQpAQCAtMjg2LDI1ICsyODcsMjggQEAgaW50IHBh
bmZyb3N0X21tdV9tYXAoc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJvKQogCWlmIChXQVJO
X09OKElTX0VSUihzZ3QpKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2d0KTsKIAotCW1tdV9tYXBfc2co
cGZkZXYsIGJvLT5tbXUsIGJvLT5ub2RlLnN0YXJ0IDw8IFBBR0VfU0hJRlQsIHByb3QsIHNndCk7
Ci0JYm8tPmlzX21hcHBlZCA9IHRydWU7CisJbW11X21hcF9zZyhwZmRldiwgbWFwcGluZy0+bW11
LCBtYXBwaW5nLT5tbW5vZGUuc3RhcnQgPDwgUEFHRV9TSElGVCwKKwkJICAgcHJvdCwgc2d0KTsK
KwltYXBwaW5nLT5hY3RpdmUgPSB0cnVlOwogCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgcGFuZnJv
c3RfbW11X3VubWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibykKK3ZvaWQgcGFuZnJv
c3RfbW11X3VubWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fbWFwcGluZyAqbWFwcGluZykKIHsKKwlz
dHJ1Y3QgcGFuZnJvc3RfZ2VtX29iamVjdCAqYm8gPSBtYXBwaW5nLT5vYmo7CiAJc3RydWN0IGRy
bV9nZW1fb2JqZWN0ICpvYmogPSAmYm8tPmJhc2UuYmFzZTsKIAlzdHJ1Y3QgcGFuZnJvc3RfZGV2
aWNlICpwZmRldiA9IHRvX3BhbmZyb3N0X2RldmljZShvYmotPmRldik7Ci0Jc3RydWN0IGlvX3Bn
dGFibGVfb3BzICpvcHMgPSBiby0+bW11LT5wZ3RibF9vcHM7Ci0JdTY0IGlvdmEgPSBiby0+bm9k
ZS5zdGFydCA8PCBQQUdFX1NISUZUOwotCXNpemVfdCBsZW4gPSBiby0+bm9kZS5zaXplIDw8IFBB
R0VfU0hJRlQ7CisJc3RydWN0IGlvX3BndGFibGVfb3BzICpvcHMgPSBtYXBwaW5nLT5tbXUtPnBn
dGJsX29wczsKKwl1NjQgaW92YSA9IG1hcHBpbmctPm1tbm9kZS5zdGFydCA8PCBQQUdFX1NISUZU
OworCXNpemVfdCBsZW4gPSBtYXBwaW5nLT5tbW5vZGUuc2l6ZSA8PCBQQUdFX1NISUZUOwogCXNp
emVfdCB1bm1hcHBlZF9sZW4gPSAwOwogCi0JaWYgKFdBUk5fT04oIWJvLT5pc19tYXBwZWQpKQor
CWlmIChXQVJOX09OKCFtYXBwaW5nLT5hY3RpdmUpKQogCQlyZXR1cm47CiAKLQlkZXZfZGJnKHBm
ZGV2LT5kZXYsICJ1bm1hcDogYXM9JWQsIGlvdmE9JWxseCwgbGVuPSV6eCIsIGJvLT5tbXUtPmFz
LCBpb3ZhLCBsZW4pOworCWRldl9kYmcocGZkZXYtPmRldiwgInVubWFwOiBhcz0lZCwgaW92YT0l
bGx4LCBsZW49JXp4IiwKKwkJbWFwcGluZy0+bW11LT5hcywgaW92YSwgbGVuKTsKIAogCXdoaWxl
ICh1bm1hcHBlZF9sZW4gPCBsZW4pIHsKIAkJc2l6ZV90IHVubWFwcGVkX3BhZ2U7CkBAIC0zMTgs
OCArMzIyLDkgQEAgdm9pZCBwYW5mcm9zdF9tbXVfdW5tYXAoc3RydWN0IHBhbmZyb3N0X2dlbV9v
YmplY3QgKmJvKQogCQl1bm1hcHBlZF9sZW4gKz0gcGdzaXplOwogCX0KIAotCXBhbmZyb3N0X21t
dV9mbHVzaF9yYW5nZShwZmRldiwgYm8tPm1tdSwgYm8tPm5vZGUuc3RhcnQgPDwgUEFHRV9TSElG
VCwgbGVuKTsKLQliby0+aXNfbWFwcGVkID0gZmFsc2U7CisJcGFuZnJvc3RfbW11X2ZsdXNoX3Jh
bmdlKHBmZGV2LCBtYXBwaW5nLT5tbXUsCisJCQkJIG1hcHBpbmctPm1tbm9kZS5zdGFydCA8PCBQ
QUdFX1NISUZULCBsZW4pOworCW1hcHBpbmctPmFjdGl2ZSA9IGZhbHNlOwogfQogCiBzdGF0aWMg
dm9pZCBtbXVfdGxiX2ludl9jb250ZXh0X3MxKHZvaWQgKmNvb2tpZSkKQEAgLTM5NCwxMCArMzk5
LDEwIEBAIHZvaWQgcGFuZnJvc3RfbW11X3BndGFibGVfZnJlZShzdHJ1Y3QgcGFuZnJvc3RfZmls
ZV9wcml2ICpwcml2KQogCWZyZWVfaW9fcGd0YWJsZV9vcHMobW11LT5wZ3RibF9vcHMpOwogfQog
Ci1zdGF0aWMgc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKgotYWRkcl90b19kcm1fbW1fbm9k
ZShzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpwZmRldiwgaW50IGFzLCB1NjQgYWRkcikKK3N0YXRp
YyBzdHJ1Y3QgcGFuZnJvc3RfZ2VtX21hcHBpbmcgKgorYWRkcl90b19tYXBwaW5nKHN0cnVjdCBw
YW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbnQgYXMsIHU2NCBhZGRyKQogewotCXN0cnVjdCBwYW5m
cm9zdF9nZW1fb2JqZWN0ICpibyA9IE5VTEw7CisJc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBwaW5n
ICptYXBwaW5nID0gTlVMTDsKIAlzdHJ1Y3QgcGFuZnJvc3RfZmlsZV9wcml2ICpwcml2OwogCXN0
cnVjdCBkcm1fbW1fbm9kZSAqbm9kZTsKIAl1NjQgb2Zmc2V0ID0gYWRkciA+PiBQQUdFX1NISUZU
OwpAQCAtNDE4LDggKzQyMyw5IEBAIGFkZHJfdG9fZHJtX21tX25vZGUoc3RydWN0IHBhbmZyb3N0
X2RldmljZSAqcGZkZXYsIGludCBhcywgdTY0IGFkZHIpCiAJZHJtX21tX2Zvcl9lYWNoX25vZGUo
bm9kZSwgJnByaXYtPm1tKSB7CiAJCWlmIChvZmZzZXQgPj0gbm9kZS0+c3RhcnQgJiYKIAkJICAg
IG9mZnNldCA8IChub2RlLT5zdGFydCArIG5vZGUtPnNpemUpKSB7Ci0JCQlibyA9IGRybV9tbV9u
b2RlX3RvX3BhbmZyb3N0X2JvKG5vZGUpOwotCQkJZHJtX2dlbV9vYmplY3RfZ2V0KCZiby0+YmFz
ZS5iYXNlKTsKKwkJCW1hcHBpbmcgPSBkcm1fbW1fbm9kZV90b19wYW5mcm9zdF9tYXBwaW5nKG5v
ZGUpOworCisJCQlrcmVmX2dldCgmbWFwcGluZy0+cmVmY291bnQpOwogCQkJYnJlYWs7CiAJCX0K
IAl9CkBAIC00MjcsNyArNDMzLDcgQEAgYWRkcl90b19kcm1fbW1fbm9kZShzdHJ1Y3QgcGFuZnJv
c3RfZGV2aWNlICpwZmRldiwgaW50IGFzLCB1NjQgYWRkcikKIAlzcGluX3VubG9jaygmcHJpdi0+
bW1fbG9jayk7CiBvdXQ6CiAJc3Bpbl91bmxvY2soJnBmZGV2LT5hc19sb2NrKTsKLQlyZXR1cm4g
Ym87CisJcmV0dXJuIG1hcHBpbmc7CiB9CiAKICNkZWZpbmUgTlVNX0ZBVUxUX1BBR0VTIChTWl8y
TSAvIFBBR0VfU0laRSkKQEAgLTQzNiwyOCArNDQyLDMwIEBAIHN0YXRpYyBpbnQgcGFuZnJvc3Rf
bW11X21hcF9mYXVsdF9hZGRyKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBmZGV2LCBpbnQgYXMs
CiAJCQkJICAgICAgIHU2NCBhZGRyKQogewogCWludCByZXQsIGk7CisJc3RydWN0IHBhbmZyb3N0
X2dlbV9tYXBwaW5nICpib21hcHBpbmc7CiAJc3RydWN0IHBhbmZyb3N0X2dlbV9vYmplY3QgKmJv
OwogCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nOwogCXBnb2ZmX3QgcGFnZV9vZmZzZXQ7
CiAJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CiAJc3RydWN0IHBhZ2UgKipwYWdlczsKIAotCWJvID0g
YWRkcl90b19kcm1fbW1fbm9kZShwZmRldiwgYXMsIGFkZHIpOwotCWlmICghYm8pCisJYm9tYXBw
aW5nID0gYWRkcl90b19tYXBwaW5nKHBmZGV2LCBhcywgYWRkcik7CisJaWYgKCFib21hcHBpbmcp
CiAJCXJldHVybiAtRU5PRU5UOwogCisJYm8gPSBib21hcHBpbmctPm9iajsKIAlpZiAoIWJvLT5p
c19oZWFwKSB7CiAJCWRldl9XQVJOKHBmZGV2LT5kZXYsICJtYXRjaGluZyBCTyBpcyBub3QgaGVh
cCB0eXBlIChHUFUgVkEgPSAlbGx4KSIsCi0JCQkgYm8tPm5vZGUuc3RhcnQgPDwgUEFHRV9TSElG
VCk7CisJCQkgYm9tYXBwaW5nLT5tbW5vZGUuc3RhcnQgPDwgUEFHRV9TSElGVCk7CiAJCXJldCA9
IC1FSU5WQUw7CiAJCWdvdG8gZXJyX2JvOwogCX0KLQlXQVJOX09OKGJvLT5tbXUtPmFzICE9IGFz
KTsKKwlXQVJOX09OKGJvbWFwcGluZy0+bW11LT5hcyAhPSBhcyk7CiAKIAkvKiBBc3N1bWUgMk1C
IGFsaWdubWVudCBhbmQgc2l6ZSBtdWx0aXBsZSAqLwogCWFkZHIgJj0gfigodTY0KVNaXzJNIC0g
MSk7CiAJcGFnZV9vZmZzZXQgPSBhZGRyID4+IFBBR0VfU0hJRlQ7Ci0JcGFnZV9vZmZzZXQgLT0g
Ym8tPm5vZGUuc3RhcnQ7CisJcGFnZV9vZmZzZXQgLT0gYm9tYXBwaW5nLT5tbW5vZGUuc3RhcnQ7
CiAKIAltdXRleF9sb2NrKCZiby0+YmFzZS5wYWdlc19sb2NrKTsKIApAQCAtNTA5LDEzICs1MTcs
MTQgQEAgc3RhdGljIGludCBwYW5mcm9zdF9tbXVfbWFwX2ZhdWx0X2FkZHIoc3RydWN0IHBhbmZy
b3N0X2RldmljZSAqcGZkZXYsIGludCBhcywKIAkJZ290byBlcnJfbWFwOwogCX0KIAotCW1tdV9t
YXBfc2cocGZkZXYsIGJvLT5tbXUsIGFkZHIsIElPTU1VX1dSSVRFIHwgSU9NTVVfUkVBRCB8IElP
TU1VX05PRVhFQywgc2d0KTsKKwltbXVfbWFwX3NnKHBmZGV2LCBib21hcHBpbmctPm1tdSwgYWRk
ciwKKwkJICAgSU9NTVVfV1JJVEUgfCBJT01NVV9SRUFEIHwgSU9NTVVfTk9FWEVDLCBzZ3QpOwog
Ci0JYm8tPmlzX21hcHBlZCA9IHRydWU7CisJYm9tYXBwaW5nLT5hY3RpdmUgPSB0cnVlOwogCiAJ
ZGV2X2RiZyhwZmRldi0+ZGV2LCAibWFwcGVkIHBhZ2UgZmF1bHQgQCBBUyVkICVsbHgiLCBhcywg
YWRkcik7CiAKLQlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoJmJvLT5iYXNlLmJhc2UpOwor
CXBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1dChib21hcHBpbmcpOwogCiAJcmV0dXJuIDA7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuaCBiL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuaAppbmRleCA3YzViNjc3NWFlMjMuLjQ0
ZmMyZWRmNjNjZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3BhbmZyb3N0L3BhbmZyb3N0
X21tdS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9tbXUuaApAQCAt
NCwxMiArNCwxMiBAQAogI2lmbmRlZiBfX1BBTkZST1NUX01NVV9IX18KICNkZWZpbmUgX19QQU5G
Uk9TVF9NTVVfSF9fCiAKLXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0Oworc3RydWN0IHBhbmZy
b3N0X2dlbV9tYXBwaW5nOwogc3RydWN0IHBhbmZyb3N0X2ZpbGVfcHJpdjsKIHN0cnVjdCBwYW5m
cm9zdF9tbXU7CiAKLWludCBwYW5mcm9zdF9tbXVfbWFwKHN0cnVjdCBwYW5mcm9zdF9nZW1fb2Jq
ZWN0ICpibyk7Ci12b2lkIHBhbmZyb3N0X21tdV91bm1hcChzdHJ1Y3QgcGFuZnJvc3RfZ2VtX29i
amVjdCAqYm8pOworaW50IHBhbmZyb3N0X21tdV9tYXAoc3RydWN0IHBhbmZyb3N0X2dlbV9tYXBw
aW5nICptYXBwaW5nKTsKK3ZvaWQgcGFuZnJvc3RfbW11X3VubWFwKHN0cnVjdCBwYW5mcm9zdF9n
ZW1fbWFwcGluZyAqbWFwcGluZyk7CiAKIGludCBwYW5mcm9zdF9tbXVfaW5pdChzdHJ1Y3QgcGFu
ZnJvc3RfZGV2aWNlICpwZmRldik7CiB2b2lkIHBhbmZyb3N0X21tdV9maW5pKHN0cnVjdCBwYW5m
cm9zdF9kZXZpY2UgKnBmZGV2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9wYW5mcm9z
dC9wYW5mcm9zdF9wZXJmY250LmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rf
cGVyZmNudC5jCmluZGV4IDJjMDRlODU4YzUwYS4uNjg0ODIwNDQ4YmUzIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3RfcGVyZmNudC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9wZXJmY250LmMKQEAgLTI1LDcgKzI1LDcgQEAKICNk
ZWZpbmUgVjRfU0hBREVSU19QRVJfQ09SRUdST1VQCTQKIAogc3RydWN0IHBhbmZyb3N0X3BlcmZj
bnQgewotCXN0cnVjdCBwYW5mcm9zdF9nZW1fb2JqZWN0ICpibzsKKwlzdHJ1Y3QgcGFuZnJvc3Rf
Z2VtX21hcHBpbmcgKm1hcHBpbmc7CiAJc2l6ZV90IGJvc2l6ZTsKIAl2b2lkICpidWY7CiAJc3Ry
dWN0IHBhbmZyb3N0X2ZpbGVfcHJpdiAqdXNlcjsKQEAgLTQ5LDcgKzQ5LDcgQEAgc3RhdGljIGlu
dCBwYW5mcm9zdF9wZXJmY250X2R1bXBfbG9ja2VkKHN0cnVjdCBwYW5mcm9zdF9kZXZpY2UgKnBm
ZGV2KQogCWludCByZXQ7CiAKIAlyZWluaXRfY29tcGxldGlvbigmcGZkZXYtPnBlcmZjbnQtPmR1
bXBfY29tcCk7Ci0JZ3B1dmEgPSBwZmRldi0+cGVyZmNudC0+Ym8tPm5vZGUuc3RhcnQgPDwgUEFH
RV9TSElGVDsKKwlncHV2YSA9IHBmZGV2LT5wZXJmY250LT5tYXBwaW5nLT5tbW5vZGUuc3RhcnQg
PDwgUEFHRV9TSElGVDsKIAlncHVfd3JpdGUocGZkZXYsIEdQVV9QRVJGQ05UX0JBU0VfTE8sIGdw
dXZhKTsKIAlncHVfd3JpdGUocGZkZXYsIEdQVV9QRVJGQ05UX0JBU0VfSEksIGdwdXZhID4+IDMy
KTsKIAlncHVfd3JpdGUocGZkZXYsIEdQVV9JTlRfQ0xFQVIsCkBAIC04OSwxNyArODksMjIgQEAg
c3RhdGljIGludCBwYW5mcm9zdF9wZXJmY250X2VuYWJsZV9sb2NrZWQoc3RydWN0IHBhbmZyb3N0
X2RldmljZSAqcGZkZXYsCiAJaWYgKElTX0VSUihibykpCiAJCXJldHVybiBQVFJfRVJSKGJvKTsK
IAotCXBlcmZjbnQtPmJvID0gdG9fcGFuZnJvc3RfYm8oJmJvLT5iYXNlKTsKLQogCS8qIE1hcCB0
aGUgcGVyZmNudCBidWYgaW4gdGhlIGFkZHJlc3Mgc3BhY2UgYXR0YWNoZWQgdG8gZmlsZV9wcml2
LiAqLwotCXJldCA9IHBhbmZyb3N0X2dlbV9vcGVuKCZwZXJmY250LT5iby0+YmFzZS5iYXNlLCBm
aWxlX3ByaXYpOworCXJldCA9IHBhbmZyb3N0X2dlbV9vcGVuKCZiby0+YmFzZSwgZmlsZV9wcml2
KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9wdXRfYm87CiAKKwlwZXJmY250LT5tYXBwaW5nID0g
cGFuZnJvc3RfZ2VtX21hcHBpbmdfZ2V0KHRvX3BhbmZyb3N0X2JvKCZiby0+YmFzZSksCisJCQkJ
CQkgICAgdXNlcik7CisJaWYgKCFwZXJmY250LT5tYXBwaW5nKSB7CisJCXJldCA9IC1FSU5WQUw7
CisJCWdvdG8gZXJyX2Nsb3NlX2JvOworCX0KKwogCXBlcmZjbnQtPmJ1ZiA9IGRybV9nZW1fc2ht
ZW1fdm1hcCgmYm8tPmJhc2UpOwogCWlmIChJU19FUlIocGVyZmNudC0+YnVmKSkgewogCQlyZXQg
PSBQVFJfRVJSKHBlcmZjbnQtPmJ1Zik7Ci0JCWdvdG8gZXJyX2Nsb3NlX2JvOworCQlnb3RvIGVy
cl9wdXRfbWFwcGluZzsKIAl9CiAKIAkvKgpAQCAtMTU0LDEyICsxNTksMTcgQEAgc3RhdGljIGlu
dCBwYW5mcm9zdF9wZXJmY250X2VuYWJsZV9sb2NrZWQoc3RydWN0IHBhbmZyb3N0X2RldmljZSAq
cGZkZXYsCiAJaWYgKHBhbmZyb3N0X2hhc19od19pc3N1ZShwZmRldiwgSFdfSVNTVUVfODE4Nikp
CiAJCWdwdV93cml0ZShwZmRldiwgR1BVX1BSRkNOVF9USUxFUl9FTiwgMHhmZmZmZmZmZik7CiAK
KwkvKiBUaGUgQk8gcmVmIGlzIHJldGFpbmVkIGJ5IHRoZSBtYXBwaW5nLiAqLworCWRybV9nZW1f
b2JqZWN0X3B1dF91bmxvY2tlZCgmYm8tPmJhc2UpOworCiAJcmV0dXJuIDA7CiAKIGVycl92dW5t
YXA6Ci0JZHJtX2dlbV9zaG1lbV92dW5tYXAoJnBlcmZjbnQtPmJvLT5iYXNlLmJhc2UsIHBlcmZj
bnQtPmJ1Zik7CisJZHJtX2dlbV9zaG1lbV92dW5tYXAoJmJvLT5iYXNlLCBwZXJmY250LT5idWYp
OworZXJyX3B1dF9tYXBwaW5nOgorCXBhbmZyb3N0X2dlbV9tYXBwaW5nX3B1dChwZXJmY250LT5t
YXBwaW5nKTsKIGVycl9jbG9zZV9ibzoKLQlwYW5mcm9zdF9nZW1fY2xvc2UoJnBlcmZjbnQtPmJv
LT5iYXNlLmJhc2UsIGZpbGVfcHJpdik7CisJcGFuZnJvc3RfZ2VtX2Nsb3NlKCZiby0+YmFzZSwg
ZmlsZV9wcml2KTsKIGVycl9wdXRfYm86CiAJZHJtX2dlbV9vYmplY3RfcHV0X3VubG9ja2VkKCZi
by0+YmFzZSk7CiAJcmV0dXJuIHJldDsKQEAgLTE4MiwxMSArMTkyLDExIEBAIHN0YXRpYyBpbnQg
cGFuZnJvc3RfcGVyZmNudF9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgcGFuZnJvc3RfZGV2aWNlICpw
ZmRldiwKIAkJICBHUFVfUEVSRkNOVF9DRkdfTU9ERShHUFVfUEVSRkNOVF9DRkdfTU9ERV9PRkYp
KTsKIAogCXBlcmZjbnQtPnVzZXIgPSBOVUxMOwotCWRybV9nZW1fc2htZW1fdnVubWFwKCZwZXJm
Y250LT5iby0+YmFzZS5iYXNlLCBwZXJmY250LT5idWYpOworCWRybV9nZW1fc2htZW1fdnVubWFw
KCZwZXJmY250LT5tYXBwaW5nLT5vYmotPmJhc2UuYmFzZSwgcGVyZmNudC0+YnVmKTsKIAlwZXJm
Y250LT5idWYgPSBOVUxMOwotCXBhbmZyb3N0X2dlbV9jbG9zZSgmcGVyZmNudC0+Ym8tPmJhc2Uu
YmFzZSwgZmlsZV9wcml2KTsKLQlkcm1fZ2VtX29iamVjdF9wdXRfdW5sb2NrZWQoJnBlcmZjbnQt
PmJvLT5iYXNlLmJhc2UpOwotCXBlcmZjbnQtPmJvID0gTlVMTDsKKwlwYW5mcm9zdF9nZW1fY2xv
c2UoJnBlcmZjbnQtPm1hcHBpbmctPm9iai0+YmFzZS5iYXNlLCBmaWxlX3ByaXYpOworCXBhbmZy
b3N0X2dlbV9tYXBwaW5nX3B1dChwZXJmY250LT5tYXBwaW5nKTsKKwlwZXJmY250LT5tYXBwaW5n
ID0gTlVMTDsKIAlwbV9ydW50aW1lX21hcmtfbGFzdF9idXN5KHBmZGV2LT5kZXYpOwogCXBtX3J1
bnRpbWVfcHV0X2F1dG9zdXNwZW5kKHBmZGV2LT5kZXYpOwogCi0tIAoyLjIzLjAKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
