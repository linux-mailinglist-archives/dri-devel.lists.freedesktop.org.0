Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C2C1CD8D69
	for <lists+dri-devel@lfdr.de>; Wed, 16 Oct 2019 12:11:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2B8526E91E;
	Wed, 16 Oct 2019 10:11:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay10.mail.gandi.net (relay10.mail.gandi.net [217.70.178.230])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A06E26E908
 for <dri-devel@lists.freedesktop.org>; Wed, 16 Oct 2019 08:55:07 +0000 (UTC)
Received: from uno.localdomain (2-224-242-101.ip172.fastwebnet.it
 [2.224.242.101]) (Authenticated sender: jacopo@jmondi.org)
 by relay10.mail.gandi.net (Postfix) with ESMTPSA id AD2AC24000C;
 Wed, 16 Oct 2019 08:55:03 +0000 (UTC)
From: Jacopo Mondi <jacopo+renesas@jmondi.org>
To: laurent.pinchart@ideasonboard.com, kieran.bingham+renesas@ideasonboard.com,
 geert@linux-m68k.org, horms@verge.net.au, uli+renesas@fpond.eu
Subject: [PATCH v6 4/8] drm: rcar-du: kms: Initialize CMM instances
Date: Wed, 16 Oct 2019 10:55:44 +0200
Message-Id: <20191016085548.105703-5-jacopo+renesas@jmondi.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191016085548.105703-1-jacopo+renesas@jmondi.org>
References: <20191016085548.105703-1-jacopo+renesas@jmondi.org>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 16 Oct 2019 10:11:37 +0000
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: airlied@linux.ie, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, linux-renesas-soc@vger.kernel.org,
 Jacopo Mondi <jacopo+renesas@jmondi.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW1wbGVtZW50IGRldmljZSB0cmVlIHBhcnNpbmcgdG8gY29sbGVjdCB0aGUgYXZhaWxhYmxlIENN
TSBpbnN0YW5jZXMKZGVzY3JpYmVkIGJ5IHRoZSAncmVuZXNhcyxjbW1zJyBwcm9wZXJ0eS4gQXNz
b2NpYXRlIENNTXMgd2l0aCBDUlRDcyBhbmQKc3RvcmUgYSBtYXNrIG9mIGFjdGl2ZSBDTU1zIGlu
IHRoZSBEVSBncm91cCBmb3IgbGF0ZXIgZW5hYmxlbWVudC4KCkVuZm9yY2UgdGhlIHByb2JlIGFu
ZCBzdXNwZW5kL3Jlc3VtZSBvcmRlcmluZyBvZiBEVSBhbmQgQ01NIGJ5IGNyZWF0aW5nCmEgc3Rh
dGVsZXNzIGRldmljZSBsaW5rIGJldHdlZW4gdGhlIHR3by4KClJldmlld2VkLWJ5OiBLaWVyYW4g
QmluZ2hhbSA8a2llcmFuLmJpbmdoYW0rcmVuZXNhc0BpZGVhc29uYm9hcmQuY29tPgpSZXZpZXdl
ZC1ieTogTGF1cmVudCBQaW5jaGFydCA8bGF1cmVudC5waW5jaGFydEBpZGVhc29uYm9hcmQuY29t
PgpTaWduZWQtb2ZmLWJ5OiBKYWNvcG8gTW9uZGkgPGphY29wbytyZW5lc2FzQGptb25kaS5vcmc+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMgIHwgIDYgKysKIGRy
aXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5oICB8ICAyICsKIGRyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfZHJ2LmggICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9yY2Fy
LWR1L3JjYXJfZHVfZ3JvdXAuaCB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJf
ZHVfa21zLmMgICB8IDc2ICsrKysrKysrKysrKysrKysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdl
ZCwgODggaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMK
aW5kZXggMmRhNDZlM2RjNGFlLi4yM2YxZDZjYzE3MTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfY3J0Yy5jCkBAIC0xMTk0LDYgKzExOTQsMTIgQEAgaW50IHJjYXJfZHVfY3J0Y19j
cmVhdGUoc3RydWN0IHJjYXJfZHVfZ3JvdXAgKnJncnAsIHVuc2lnbmVkIGludCBzd2luZGV4LAog
CWlmIChyZXQgPCAwKQogCQlyZXR1cm4gcmV0OwogCisJLyogQ01NIG1pZ2h0IGJlIGRpc2FibGVk
IGZvciB0aGlzIENSVEMuICovCisJaWYgKHJjZHUtPmNtbXNbc3dpbmRleF0pIHsKKwkJcmNydGMt
PmNtbSA9IHJjZHUtPmNtbXNbc3dpbmRleF07CisJCXJncnAtPmNtbXNfbWFzayB8PSBCSVQoaHdp
bmRleCAlIDIpOworCX0KKwogCWRybV9jcnRjX2hlbHBlcl9hZGQoY3J0YywgJmNydGNfaGVscGVy
X2Z1bmNzKTsKIAogCS8qIFN0YXJ0IHdpdGggdmVydGljYWwgYmxhbmtpbmcgaW50ZXJydXB0IHJl
cG9ydGluZyBkaXNhYmxlZC4gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfY3J0Yy5oIGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmgK
aW5kZXggM2I3ZmM2Njg5OTZmLi41ZjI5NDBjNDIyMjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfY3J0Yy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfY3J0Yy5oCkBAIC0zOSw2ICszOSw3IEBAIHN0cnVjdCByY2FyX2R1X3ZzcDsKICAq
IEB2Ymxhbmtfd2FpdDogd2FpdCBxdWV1ZSB1c2VkIHRvIHNpZ25hbCB2ZXJ0aWNhbCBibGFua2lu
ZwogICogQHZibGFua19jb3VudDogbnVtYmVyIG9mIHZlcnRpY2FsIGJsYW5raW5nIGludGVycnVw
dHMgdG8gd2FpdCBmb3IKICAqIEBncm91cDogQ1JUQyBncm91cCB0aGlzIENSVEMgYmVsb25ncyB0
bworICogQGNtbTogQ01NIGFzc29jaWF0ZWQgd2l0aCB0aGlzIENSVEMKICAqIEB2c3A6IFZTUCBm
ZWVkaW5nIHZpZGVvIHRvIHRoaXMgQ1JUQwogICogQHZzcF9waXBlOiBpbmRleCBvZiB0aGUgVlNQ
IHBpcGVsaW5lIGZlZWRpbmcgdmlkZW8gdG8gdGhpcyBDUlRDCiAgKiBAd3JpdGViYWNrOiB0aGUg
d3JpdGViYWNrIGNvbm5lY3RvcgpAQCAtNjQsNiArNjUsNyBAQCBzdHJ1Y3QgcmNhcl9kdV9jcnRj
IHsKIAl1bnNpZ25lZCBpbnQgdmJsYW5rX2NvdW50OwogCiAJc3RydWN0IHJjYXJfZHVfZ3JvdXAg
Kmdyb3VwOworCXN0cnVjdCBwbGF0Zm9ybV9kZXZpY2UgKmNtbTsKIAlzdHJ1Y3QgcmNhcl9kdV92
c3AgKnZzcDsKIAl1bnNpZ25lZCBpbnQgdnNwX3BpcGU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9y
Y2FyX2R1X2Rydi5oCmluZGV4IDEzMjdjZDBkZjkwYS4uNjE1MDRjNTRlMmVjIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9yY2FyLWR1L3JjYXJfZHVfZHJ2LmgKQEAgLTEzLDYgKzEzLDcgQEAKICNpbmNsdWRlIDxs
aW51eC9rZXJuZWwuaD4KICNpbmNsdWRlIDxsaW51eC93YWl0Lmg+CiAKKyNpbmNsdWRlICJyY2Fy
X2NtbS5oIgogI2luY2x1ZGUgInJjYXJfZHVfY3J0Yy5oIgogI2luY2x1ZGUgInJjYXJfZHVfZ3Jv
dXAuaCIKICNpbmNsdWRlICJyY2FyX2R1X3ZzcC5oIgpAQCAtODUsNiArODYsNyBAQCBzdHJ1Y3Qg
cmNhcl9kdV9kZXZpY2UgewogCXN0cnVjdCByY2FyX2R1X2VuY29kZXIgKmVuY29kZXJzW1JDQVJf
RFVfT1VUUFVUX01BWF07CiAKIAlzdHJ1Y3QgcmNhcl9kdV9ncm91cCBncm91cHNbUkNBUl9EVV9N
QVhfR1JPVVBTXTsKKwlzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpjbW1zW1JDQVJfRFVfTUFYX0NS
VENTXTsKIAlzdHJ1Y3QgcmNhcl9kdV92c3AgdnNwc1tSQ0FSX0RVX01BWF9WU1BTXTsKIAogCXN0
cnVjdCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3Vw
LmggYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dyb3VwLmgKaW5kZXggODc5NTBj
MWY2YTUyLi5lOTkwNjYwOWM2MzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1
L3JjYXJfZHVfZ3JvdXAuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2dy
b3VwLmgKQEAgLTIyLDYgKzIyLDcgQEAgc3RydWN0IHJjYXJfZHVfZGV2aWNlOwogICogQG1taW9f
b2Zmc2V0OiByZWdpc3RlcnMgb2Zmc2V0IGluIHRoZSBkZXZpY2UgbWVtb3J5IG1hcAogICogQGlu
ZGV4OiBncm91cCBpbmRleAogICogQGNoYW5uZWxzX21hc2s6IGJpdG1hc2sgb2YgcG9wdWxhdGVk
IERVIGNoYW5uZWxzIGluIHRoaXMgZ3JvdXAKKyAqIEBjbW1zX21hc2s6IGJpdG1hc2sgb2YgYXZh
aWxhYmxlIENNTXMgaW4gdGhpcyBncm91cAogICogQG51bV9jcnRjczogbnVtYmVyIG9mIENSVENz
IGluIHRoaXMgZ3JvdXAgKDEgb3IgMikKICAqIEB1c2VfY291bnQ6IG51bWJlciBvZiB1c2VycyBv
ZiB0aGUgZ3JvdXAgKHJjYXJfZHVfZ3JvdXBfKGdldHxwdXQpKQogICogQHVzZWRfY3J0Y3M6IG51
bWJlciBvZiBDUlRDcyBjdXJyZW50bHkgaW4gdXNlCkBAIC0zNyw2ICszOCw3IEBAIHN0cnVjdCBy
Y2FyX2R1X2dyb3VwIHsKIAl1bnNpZ25lZCBpbnQgaW5kZXg7CiAKIAl1bnNpZ25lZCBpbnQgY2hh
bm5lbHNfbWFzazsKKwl1bnNpZ25lZCBpbnQgY21tc19tYXNrOwogCXVuc2lnbmVkIGludCBudW1f
Y3J0Y3M7CiAJdW5zaWduZWQgaW50IHVzZV9jb3VudDsKIAl1bnNpZ25lZCBpbnQgdXNlZF9jcnRj
czsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMgYi9k
cml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1X2ttcy5jCmluZGV4IDJkYzljYWVlODc2Ny4u
N2M5ZmI1ODYwZTU0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmNhci1kdS9yY2FyX2R1
X2ttcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yY2FyLWR1L3JjYXJfZHVfa21zLmMKQEAgLTE3
LDcgKzE3LDkgQEAKICNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgogI2luY2x1ZGUg
PGRybS9kcm1fdmJsYW5rLmg+CiAKKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KICNpbmNsdWRl
IDxsaW51eC9vZl9ncmFwaC5oPgorI2luY2x1ZGUgPGxpbnV4L29mX3BsYXRmb3JtLmg+CiAjaW5j
bHVkZSA8bGludXgvd2FpdC5oPgogCiAjaW5jbHVkZSAicmNhcl9kdV9jcnRjLmgiCkBAIC02MTQs
NiArNjE2LDc1IEBAIHN0YXRpYyBpbnQgcmNhcl9kdV92c3BzX2luaXQoc3RydWN0IHJjYXJfZHVf
ZGV2aWNlICpyY2R1KQogCXJldHVybiByZXQ7CiB9CiAKK3N0YXRpYyBpbnQgcmNhcl9kdV9jbW1f
aW5pdChzdHJ1Y3QgcmNhcl9kdV9kZXZpY2UgKnJjZHUpCit7CisJY29uc3Qgc3RydWN0IGRldmlj
ZV9ub2RlICpucCA9IHJjZHUtPmRldi0+b2Zfbm9kZTsKKwl1bnNpZ25lZCBpbnQgaTsKKwlpbnQg
Y2VsbHM7CisKKwljZWxscyA9IG9mX3Byb3BlcnR5X2NvdW50X3UzMl9lbGVtcyhucCwgInJlbmVz
YXMsY21tcyIpOworCWlmIChjZWxscyA9PSAtRUlOVkFMKQorCQlyZXR1cm4gMDsKKworCWlmIChj
ZWxscyA+IHJjZHUtPm51bV9jcnRjcykgeworCQlkZXZfZXJyKHJjZHUtPmRldiwKKwkJCSJJbnZh
bGlkIG51bWJlciBvZiBlbnRyaWVzIGluICdyZW5lc2FzLGNtbXMnXG4iKTsKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCisJZm9yIChpID0gMDsgaSA8IGNlbGxzOyArK2kpIHsKKwkJc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldjsKKwkJc3RydWN0IGRldmljZV9saW5rICpsaW5rOworCQlzdHJ1
Y3QgZGV2aWNlX25vZGUgKmNtbTsKKwkJaW50IHJldDsKKworCQljbW0gPSBvZl9wYXJzZV9waGFu
ZGxlKG5wLCAicmVuZXNhcyxjbW1zIiwgaSk7CisJCWlmIChJU19FUlIoY21tKSkgeworCQkJZGV2
X2VycihyY2R1LT5kZXYsCisJCQkJIkZhaWxlZCB0byBwYXJzZSAncmVuZXNhcyxjbW1zJyBwcm9w
ZXJ0eVxuIik7CisJCQlyZXR1cm4gUFRSX0VSUihjbW0pOworCQl9CisKKwkJaWYgKCFvZl9kZXZp
Y2VfaXNfYXZhaWxhYmxlKGNtbSkpIHsKKwkJCS8qIEl0J3MgZmluZSB0byBoYXZlIGEgcGhhbmRs
ZSB0byBhIG5vbi1lbmFibGVkIENNTS4gKi8KKwkJCW9mX25vZGVfcHV0KGNtbSk7CisJCQljb250
aW51ZTsKKwkJfQorCisJCXBkZXYgPSBvZl9maW5kX2RldmljZV9ieV9ub2RlKGNtbSk7CisJCWlm
IChJU19FUlIocGRldikpIHsKKwkJCWRldl9lcnIocmNkdS0+ZGV2LCAiTm8gZGV2aWNlIGZvdW5k
IGZvciBDTU0ldVxuIiwgaSk7CisJCQlvZl9ub2RlX3B1dChjbW0pOworCQkJcmV0dXJuIFBUUl9F
UlIocGRldik7CisJCX0KKworCQlvZl9ub2RlX3B1dChjbW0pOworCisJCS8qCisJCSAqIC1FTk9E
RVYgaXMgdXNlZCB0byByZXBvcnQgdGhhdCB0aGUgQ01NIGNvbmZpZyBvcHRpb24gaXMKKwkJICog
ZGlzYWJsZWQ6IHJldHVybiAwIGFuZCBsZXQgdGhlIERVIGNvbnRpbnVlIHByb2JpbmcuCisJCSAq
LworCQlyZXQgPSByY2FyX2NtbV9pbml0KHBkZXYpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJl
dCA9PSAtRU5PREVWID8gMCA6IHJldDsKKworCQkvKgorCQkgKiBFbmZvcmNlIHN1c3BlbmQvcmVz
dW1lIG9yZGVyaW5nIGJ5IG1ha2luZyB0aGUgQ01NIGEgcHJvdmlkZXIKKwkJICogb2YgdGhlIERV
OiBDTU0gaXMgc3VzcGVuZGVkIGFmdGVyIGFuZCByZXN1bWVkIGJlZm9yZSB0aGUgRFUuCisJCSAq
LworCQlsaW5rID0gZGV2aWNlX2xpbmtfYWRkKHJjZHUtPmRldiwgJnBkZXYtPmRldiwgRExfRkxB
R19TVEFURUxFU1MpOworCQlpZiAoIWxpbmspIHsKKwkJCWRldl9lcnIocmNkdS0+ZGV2LAorCQkJ
CSJGYWlsZWQgdG8gY3JlYXRlIGRldmljZSBsaW5rIHRvIENNTSV1XG4iLCBpKTsKKwkJCXJldHVy
biAtRUlOVkFMOworCQl9CisKKwkJcmNkdS0+Y21tc1tpXSA9IHBkZXY7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKIGludCByY2FyX2R1X21vZGVzZXRfaW5pdChzdHJ1Y3QgcmNhcl9kdV9kZXZpY2Ug
KnJjZHUpCiB7CiAJc3RhdGljIGNvbnN0IHVuc2lnbmVkIGludCBtbWlvX29mZnNldHNbXSA9IHsK
QEAgLTcwNCw2ICs3NzUsMTEgQEAgaW50IHJjYXJfZHVfbW9kZXNldF9pbml0KHN0cnVjdCByY2Fy
X2R1X2RldmljZSAqcmNkdSkKIAkJCXJldHVybiByZXQ7CiAJfQogCisJLyogSW5pdGlhbGl6ZSB0
aGUgQ29sb3IgTWFuYWdlbWVudCBNb2R1bGVzLiAqLworCXJldCA9IHJjYXJfZHVfY21tX2luaXQo
cmNkdSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCS8qIENyZWF0ZSB0aGUgQ1JUQ3Mu
ICovCiAJZm9yIChzd2luZGV4ID0gMCwgaHdpbmRleCA9IDA7IHN3aW5kZXggPCByY2R1LT5udW1f
Y3J0Y3M7ICsraHdpbmRleCkgewogCQlzdHJ1Y3QgcmNhcl9kdV9ncm91cCAqcmdycDsKLS0gCjIu
MjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
