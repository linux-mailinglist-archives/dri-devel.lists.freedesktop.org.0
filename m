Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 88B2E4334E
	for <lists+dri-devel@lfdr.de>; Thu, 13 Jun 2019 09:27:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A5BF689250;
	Thu, 13 Jun 2019 07:27:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-yw1-xc4a.google.com (mail-yw1-xc4a.google.com
 [IPv6:2607:f8b0:4864:20::c4a])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8321F8930F
 for <dri-devel@lists.freedesktop.org>; Wed, 12 Jun 2019 11:43:50 +0000 (UTC)
Received: by mail-yw1-xc4a.google.com with SMTP id p68so1345259ywp.2
 for <dri-devel@lists.freedesktop.org>; Wed, 12 Jun 2019 04:43:50 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=9yc1Yq7FenUh0AO3dUlc6AUSMFMskh2/7LbKPot9xGI=;
 b=rINlB27Wa/4un3VUcUZLNeDgUF/lyBoRFm9uY4ocymt9QlkjZER4+JOm2cNBsvGtSG
 vM13OqNRpXwpR4kUmqjDEitH8wQLFfnuflNUuQYd8l2M4iYKApGQmXUo89v1B0tamG+Y
 V5qx9qCHDEE6+40lmcKyPEx+eRMlEIlrBmMJexgsR80fjPgUHa/4monb4sZSQousG1+8
 dE9bfj0HVgfkTiuTc/KK+6YpfSCU0X1eyt1xY55+8+1YA87kH8phm7Z2Trz4z86Q3vVH
 w7rKJwQCAvPbVRMfJU1+V1x1mdcqkqdncTUr3IuBoh9BCdP3+hZSUf07xRmGds6Fn27V
 /+tw==
X-Gm-Message-State: APjAAAWt1RUH5RwN+KX2G4uxjKVisPqUqYODlCsKCzEt9tIbvydUudC7
 TgsCeSd7FKN6dudNaFHkIq1mBYqU3qepdhKe
X-Google-Smtp-Source: APXvYqzWkT0P+p3RG6pP2xT18iDm8BLgmUWrizOHYeFPCBqdgbB+Dc65X4gpAkgZlAg9PVOXah90gk97CBM2CYKI
X-Received: by 2002:a81:2545:: with SMTP id l66mr16760176ywl.489.1560339829646; 
 Wed, 12 Jun 2019 04:43:49 -0700 (PDT)
Date: Wed, 12 Jun 2019 13:43:21 +0200
In-Reply-To: <cover.1560339705.git.andreyknvl@google.com>
Message-Id: <f9b50767d639b7116aa986dc67f158131b8d4169.1560339705.git.andreyknvl@google.com>
Mime-Version: 1.0
References: <cover.1560339705.git.andreyknvl@google.com>
X-Mailer: git-send-email 2.22.0.rc2.383.gf4fbbf30c2-goog
Subject: [PATCH v17 04/15] mm,
 arm64: untag user pointers passed to memory syscalls
From: Andrey Konovalov <andreyknvl@google.com>
To: linux-arm-kernel@lists.infradead.org, linux-mm@kvack.org, 
 linux-kernel@vger.kernel.org, amd-gfx@lists.freedesktop.org, 
 dri-devel@lists.freedesktop.org, linux-rdma@vger.kernel.org, 
 linux-media@vger.kernel.org, kvm@vger.kernel.org, 
 linux-kselftest@vger.kernel.org
X-Mailman-Approved-At: Thu, 13 Jun 2019 07:27:23 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=9yc1Yq7FenUh0AO3dUlc6AUSMFMskh2/7LbKPot9xGI=;
 b=jG6r3qKXi5/zKGkjzMFvbQ4XcPl+/QmcSKvFp3utSJtxAUleazRXkJRGwBNNuJ7i7E
 W7vyyFyjCHej12ys6727AQE+zBEoRn7fuGQ0zPXkT7W8rJNSD33sWm4M+L2uLQ9Yr38G
 Tk/yJfeEOxvIPA7bqvovIzoag6j0IkNGtc29ARK/7GdZnbkyHKT1QM3wgM9+VOErwGhl
 DOZEsTVUoN8+b79rOajf7KnGDkH2u/eCR/G6bd5zo2eRqtSAit8bn6BlCrH2lRN5NzMd
 //lJnKytaH0FthsUWMOhqc1e/AQcdKwVvubR2bol5kkiAS3ABJ/10iV11C/N1mocmKiy
 lcUQ==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>, Szabolcs Nagy <Szabolcs.Nagy@arm.com>,
 Catalin Marinas <catalin.marinas@arm.com>, Will Deacon <will.deacon@arm.com>,
 Kostya Serebryany <kcc@google.com>, Khalid Aziz <khalid.aziz@oracle.com>,
 Felix Kuehling <Felix.Kuehling@amd.com>,
 Vincenzo Frascino <vincenzo.frascino@arm.com>,
 Jacob Bramley <Jacob.Bramley@arm.com>, Leon Romanovsky <leon@kernel.org>,
 Christoph Hellwig <hch@infradead.org>, Jason Gunthorpe <jgg@ziepe.ca>,
 Dave Martin <Dave.Martin@arm.com>, Evgeniy Stepanov <eugenis@google.com>,
 Kevin Brodsky <kevin.brodsky@arm.com>, Kees Cook <keescook@chromium.org>,
 Ruben Ayrapetyan <Ruben.Ayrapetyan@arm.com>,
 Andrey Konovalov <andreyknvl@google.com>,
 Ramana Radhakrishnan <Ramana.Radhakrishnan@arm.com>,
 Alex Williamson <alex.williamson@redhat.com>,
 Mauro Carvalho Chehab <mchehab@kernel.org>, Dmitry Vyukov <dvyukov@google.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>,
 Yishai Hadas <yishaih@mellanox.com>,
 Jens Wiklander <jens.wiklander@linaro.org>, Lee Smith <Lee.Smith@arm.com>,
 Alexander Deucher <Alexander.Deucher@amd.com>,
 Andrew Morton <akpm@linux-foundation.org>, enh <enh@google.com>,
 Robin Murphy <robin.murphy@arm.com>,
 Christian Koenig <Christian.Koenig@amd.com>,
 Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBpcyBhIHBhcnQgb2YgYSBzZXJpZXMgdGhhdCBleHRlbmRzIGFybTY0IGtlcm5l
bCBBQkkgdG8gYWxsb3cgdG8KcGFzcyB0YWdnZWQgdXNlciBwb2ludGVycyAod2l0aCB0aGUgdG9w
IGJ5dGUgc2V0IHRvIHNvbWV0aGluZyBlbHNlIG90aGVyCnRoYW4gMHgwMCkgYXMgc3lzY2FsbCBh
cmd1bWVudHMuCgpUaGlzIHBhdGNoIGFsbG93cyB0YWdnZWQgcG9pbnRlcnMgdG8gYmUgcGFzc2Vk
IHRvIHRoZSBmb2xsb3dpbmcgbWVtb3J5CnN5c2NhbGxzOiBnZXRfbWVtcG9saWN5LCBtYWR2aXNl
LCBtYmluZCwgbWluY29yZSwgbWxvY2ssIG1sb2NrMiwgbXByb3RlY3QsCm1yZW1hcCwgbXN5bmMs
IG11bmxvY2ssIG1vdmVfcGFnZXMuCgpUaGUgbW1hcCBhbmQgbXJlbWFwIHN5c2NhbGxzIGRvIG5v
dCBjdXJyZW50bHkgYWNjZXB0IHRhZ2dlZCBhZGRyZXNzZXMuCkFyY2hpdGVjdHVyZXMgbWF5IGlu
dGVycHJldCB0aGUgdGFnIGFzIGEgYmFja2dyb3VuZCBjb2xvdXIgZm9yIHRoZQpjb3JyZXNwb25k
aW5nIHZtYS4KClJldmlld2VkLWJ5OiBDYXRhbGluIE1hcmluYXMgPGNhdGFsaW4ubWFyaW5hc0Bh
cm0uY29tPgpSZXZpZXdlZC1ieTogS2VlcyBDb29rIDxrZWVzY29va0BjaHJvbWl1bS5vcmc+ClNp
Z25lZC1vZmYtYnk6IEFuZHJleSBLb25vdmFsb3YgPGFuZHJleWtudmxAZ29vZ2xlLmNvbT4KLS0t
CiBtbS9tYWR2aXNlLmMgICB8IDIgKysKIG1tL21lbXBvbGljeS5jIHwgMyArKysKIG1tL21pZ3Jh
dGUuYyAgIHwgMiArLQogbW0vbWluY29yZS5jICAgfCAyICsrCiBtbS9tbG9jay5jICAgICB8IDQg
KysrKwogbW0vbXByb3RlY3QuYyAgfCAyICsrCiBtbS9tcmVtYXAuYyAgICB8IDcgKysrKysrKwog
bW0vbXN5bmMuYyAgICAgfCAyICsrCiA4IGZpbGVzIGNoYW5nZWQsIDIzIGluc2VydGlvbnMoKyks
IDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQgYS9tbS9tYWR2aXNlLmMgYi9tbS9tYWR2aXNlLmMK
aW5kZXggNjI4MDIyZTY3NGE3Li4zOWI4MmY4YTY5OGYgMTAwNjQ0Ci0tLSBhL21tL21hZHZpc2Uu
YworKysgYi9tbS9tYWR2aXNlLmMKQEAgLTgxMCw2ICs4MTAsOCBAQCBTWVNDQUxMX0RFRklORTMo
bWFkdmlzZSwgdW5zaWduZWQgbG9uZywgc3RhcnQsIHNpemVfdCwgbGVuX2luLCBpbnQsIGJlaGF2
aW9yKQogCXNpemVfdCBsZW47CiAJc3RydWN0IGJsa19wbHVnIHBsdWc7CiAKKwlzdGFydCA9IHVu
dGFnZ2VkX2FkZHIoc3RhcnQpOworCiAJaWYgKCFtYWR2aXNlX2JlaGF2aW9yX3ZhbGlkKGJlaGF2
aW9yKSkKIAkJcmV0dXJuIGVycm9yOwogCmRpZmYgLS1naXQgYS9tbS9tZW1wb2xpY3kuYyBiL21t
L21lbXBvbGljeS5jCmluZGV4IDAxNjAwZDgwYWUwMS4uNzhlMGE4OGIyNjgwIDEwMDY0NAotLS0g
YS9tbS9tZW1wb2xpY3kuYworKysgYi9tbS9tZW1wb2xpY3kuYwpAQCAtMTM2MCw2ICsxMzYwLDcg
QEAgc3RhdGljIGxvbmcga2VybmVsX21iaW5kKHVuc2lnbmVkIGxvbmcgc3RhcnQsIHVuc2lnbmVk
IGxvbmcgbGVuLAogCWludCBlcnI7CiAJdW5zaWduZWQgc2hvcnQgbW9kZV9mbGFnczsKIAorCXN0
YXJ0ID0gdW50YWdnZWRfYWRkcihzdGFydCk7CiAJbW9kZV9mbGFncyA9IG1vZGUgJiBNUE9MX01P
REVfRkxBR1M7CiAJbW9kZSAmPSB+TVBPTF9NT0RFX0ZMQUdTOwogCWlmIChtb2RlID49IE1QT0xf
TUFYKQpAQCAtMTUxNyw2ICsxNTE4LDggQEAgc3RhdGljIGludCBrZXJuZWxfZ2V0X21lbXBvbGlj
eShpbnQgX191c2VyICpwb2xpY3ksCiAJaW50IHVuaW5pdGlhbGl6ZWRfdmFyKHB2YWwpOwogCW5v
ZGVtYXNrX3Qgbm9kZXM7CiAKKwlhZGRyID0gdW50YWdnZWRfYWRkcihhZGRyKTsKKwogCWlmIChu
bWFzayAhPSBOVUxMICYmIG1heG5vZGUgPCBucl9ub2RlX2lkcykKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKZGlmZiAtLWdpdCBhL21tL21pZ3JhdGUuYyBiL21tL21pZ3JhdGUuYwppbmRleCBmMmVjYzI4
NTVhMTIuLmQyMmM0NWNmMzZiMiAxMDA2NDQKLS0tIGEvbW0vbWlncmF0ZS5jCisrKyBiL21tL21p
Z3JhdGUuYwpAQCAtMTYxNiw3ICsxNjE2LDcgQEAgc3RhdGljIGludCBkb19wYWdlc19tb3ZlKHN0
cnVjdCBtbV9zdHJ1Y3QgKm1tLCBub2RlbWFza190IHRhc2tfbm9kZXMsCiAJCQlnb3RvIG91dF9m
bHVzaDsKIAkJaWYgKGdldF91c2VyKG5vZGUsIG5vZGVzICsgaSkpCiAJCQlnb3RvIG91dF9mbHVz
aDsKLQkJYWRkciA9ICh1bnNpZ25lZCBsb25nKXA7CisJCWFkZHIgPSAodW5zaWduZWQgbG9uZyl1
bnRhZ2dlZF9hZGRyKHApOwogCiAJCWVyciA9IC1FTk9ERVY7CiAJCWlmIChub2RlIDwgMCB8fCBu
b2RlID49IE1BWF9OVU1OT0RFUykKZGlmZiAtLWdpdCBhL21tL21pbmNvcmUuYyBiL21tL21pbmNv
cmUuYwppbmRleCBjM2YwNThiZDBmYWYuLjY0YzMyMmVkODQ1YyAxMDA2NDQKLS0tIGEvbW0vbWlu
Y29yZS5jCisrKyBiL21tL21pbmNvcmUuYwpAQCAtMjQ5LDYgKzI0OSw4IEBAIFNZU0NBTExfREVG
SU5FMyhtaW5jb3JlLCB1bnNpZ25lZCBsb25nLCBzdGFydCwgc2l6ZV90LCBsZW4sCiAJdW5zaWdu
ZWQgbG9uZyBwYWdlczsKIAl1bnNpZ25lZCBjaGFyICp0bXA7CiAKKwlzdGFydCA9IHVudGFnZ2Vk
X2FkZHIoc3RhcnQpOworCiAJLyogQ2hlY2sgdGhlIHN0YXJ0IGFkZHJlc3M6IG5lZWRzIHRvIGJl
IHBhZ2UtYWxpZ25lZC4uICovCiAJaWYgKHN0YXJ0ICYgflBBR0VfTUFTSykKIAkJcmV0dXJuIC1F
SU5WQUw7CmRpZmYgLS1naXQgYS9tbS9tbG9jay5jIGIvbW0vbWxvY2suYwppbmRleCAwODBmM2Iz
NjQxNWIuLmU4MjYwOWVhYTQyOCAxMDA2NDQKLS0tIGEvbW0vbWxvY2suYworKysgYi9tbS9tbG9j
ay5jCkBAIC02NzQsNiArNjc0LDggQEAgc3RhdGljIF9fbXVzdF9jaGVjayBpbnQgZG9fbWxvY2so
dW5zaWduZWQgbG9uZyBzdGFydCwgc2l6ZV90IGxlbiwgdm1fZmxhZ3NfdCBmbGEKIAl1bnNpZ25l
ZCBsb25nIGxvY2tfbGltaXQ7CiAJaW50IGVycm9yID0gLUVOT01FTTsKIAorCXN0YXJ0ID0gdW50
YWdnZWRfYWRkcihzdGFydCk7CisKIAlpZiAoIWNhbl9kb19tbG9jaygpKQogCQlyZXR1cm4gLUVQ
RVJNOwogCkBAIC03MzUsNiArNzM3LDggQEAgU1lTQ0FMTF9ERUZJTkUyKG11bmxvY2ssIHVuc2ln
bmVkIGxvbmcsIHN0YXJ0LCBzaXplX3QsIGxlbikKIHsKIAlpbnQgcmV0OwogCisJc3RhcnQgPSB1
bnRhZ2dlZF9hZGRyKHN0YXJ0KTsKKwogCWxlbiA9IFBBR0VfQUxJR04obGVuICsgKG9mZnNldF9p
bl9wYWdlKHN0YXJ0KSkpOwogCXN0YXJ0ICY9IFBBR0VfTUFTSzsKIApkaWZmIC0tZ2l0IGEvbW0v
bXByb3RlY3QuYyBiL21tL21wcm90ZWN0LmMKaW5kZXggYmYzOGRmYmJiNGI0Li4xOWY5ODFiNzMz
YmMgMTAwNjQ0Ci0tLSBhL21tL21wcm90ZWN0LmMKKysrIGIvbW0vbXByb3RlY3QuYwpAQCAtNDY1
LDYgKzQ2NSw4IEBAIHN0YXRpYyBpbnQgZG9fbXByb3RlY3RfcGtleSh1bnNpZ25lZCBsb25nIHN0
YXJ0LCBzaXplX3QgbGVuLAogCWNvbnN0IGJvb2wgcmllciA9IChjdXJyZW50LT5wZXJzb25hbGl0
eSAmIFJFQURfSU1QTElFU19FWEVDKSAmJgogCQkJCShwcm90ICYgUFJPVF9SRUFEKTsKIAorCXN0
YXJ0ID0gdW50YWdnZWRfYWRkcihzdGFydCk7CisKIAlwcm90ICY9IH4oUFJPVF9HUk9XU0RPV058
UFJPVF9HUk9XU1VQKTsKIAlpZiAoZ3Jvd3MgPT0gKFBST1RfR1JPV1NET1dOfFBST1RfR1JPV1NV
UCkpIC8qIGNhbid0IGJlIGJvdGggKi8KIAkJcmV0dXJuIC1FSU5WQUw7CmRpZmYgLS1naXQgYS9t
bS9tcmVtYXAuYyBiL21tL21yZW1hcC5jCmluZGV4IGZjMjQxZDIzY2Q5Ny4uNjRjOWEzYjhiZTBh
IDEwMDY0NAotLS0gYS9tbS9tcmVtYXAuYworKysgYi9tbS9tcmVtYXAuYwpAQCAtNjA2LDYgKzYw
NiwxMyBAQCBTWVNDQUxMX0RFRklORTUobXJlbWFwLCB1bnNpZ25lZCBsb25nLCBhZGRyLCB1bnNp
Z25lZCBsb25nLCBvbGRfbGVuLAogCUxJU1RfSEVBRCh1Zl91bm1hcF9lYXJseSk7CiAJTElTVF9I
RUFEKHVmX3VubWFwKTsKIAorCS8qCisJICogQXJjaGl0ZWN0dXJlcyBtYXkgaW50ZXJwcmV0IHRo
ZSB0YWcgcGFzc2VkIHRvIG1tYXAgYXMgYSBiYWNrZ3JvdW5kCisJICogY29sb3VyIGZvciB0aGUg
Y29ycmVzcG9uZGluZyB2bWEuIEZvciBtcmVtYXAgd2UgZG9uJ3QgYWxsb3cgdGFnZ2VkCisJICog
bmV3X2FkZHIgdG8gcHJlc2VydmUgc2ltaWxhciBiZWhhdmlvdXIgdG8gbW1hcC4KKwkgKi8KKwlh
ZGRyID0gdW50YWdnZWRfYWRkcihhZGRyKTsKKwogCWlmIChmbGFncyAmIH4oTVJFTUFQX0ZJWEVE
IHwgTVJFTUFQX01BWU1PVkUpKQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9tbS9tc3lu
Yy5jIGIvbW0vbXN5bmMuYwppbmRleCBlZjMwYTQyOTYyM2EuLmMzYmQzZTc1ZjY4NyAxMDA2NDQK
LS0tIGEvbW0vbXN5bmMuYworKysgYi9tbS9tc3luYy5jCkBAIC0zNyw2ICszNyw4IEBAIFNZU0NB
TExfREVGSU5FMyhtc3luYywgdW5zaWduZWQgbG9uZywgc3RhcnQsIHNpemVfdCwgbGVuLCBpbnQs
IGZsYWdzKQogCWludCB1bm1hcHBlZF9lcnJvciA9IDA7CiAJaW50IGVycm9yID0gLUVJTlZBTDsK
IAorCXN0YXJ0ID0gdW50YWdnZWRfYWRkcihzdGFydCk7CisKIAlpZiAoZmxhZ3MgJiB+KE1TX0FT
WU5DIHwgTVNfSU5WQUxJREFURSB8IE1TX1NZTkMpKQogCQlnb3RvIG91dDsKIAlpZiAob2Zmc2V0
X2luX3BhZ2Uoc3RhcnQpKQotLSAKMi4yMi4wLnJjMi4zODMuZ2Y0ZmJiZjMwYzItZ29vZwoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1h
aWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
