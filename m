Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 964BF298250
	for <lists+dri-devel@lfdr.de>; Sun, 25 Oct 2020 16:41:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A9A546E9CE;
	Sun, 25 Oct 2020 15:41:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x641.google.com (mail-ej1-x641.google.com
 [IPv6:2a00:1450:4864:20::641])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7CAEB6E9D0
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Oct 2020 15:41:09 +0000 (UTC)
Received: by mail-ej1-x641.google.com with SMTP id d6so5233629ejb.11
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Oct 2020 08:41:09 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=34EyVrSPuHmrU+ljGPbTrYb6ILBJ8Fa3MfxO5NrhFIM=;
 b=bj68TLVfQVKfFAeGRhaZkRVOtnrWBWSzHptNnRRD7DKsjPXsariAZJAvM6w/Y+pspg
 XYtC4ziPsU4olW3lOsmQYOXhm3hgJatQk11f8hyISN12aatU/wbDfhiVYSjGYd38BjKK
 NSncnHOMgk7xMa9pZO71cZmMnCufQajeE23+FZ+XR4GG1RcLeE/Ni6xNJkMCLgDzpZWj
 OfRCUevebgcwldenDiKjvGN9VqHJ4aVRzOGSfM3vkYjkalWuY2kWC2o4+JG7TA7xO7nh
 K7htyq2bjA6x7zEa/T7gnv1jfVOxuMuX6jT1yPkfhTzVeSCJsKkvq9104Zlqyz45R36z
 bABg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=34EyVrSPuHmrU+ljGPbTrYb6ILBJ8Fa3MfxO5NrhFIM=;
 b=dSnv2a5MVyDz8AWQZp/Twa3aa06VXNedWSUOkODZbxKTh1aRgPKCA6X5Ti+Jodlc7W
 IisMKYwJEt5SIFYxDYMrTppCIEKlmyxa0aDnHqskktjGw3e/lY1Got1Fot9MdQhT1r2k
 71cRciX0UuwvmeuFDq3DrLdp49PbMvtt4Bl9+cBXV72PGWCRjGfyIyG1A2vaQApL5hqd
 Zkd/hxxSbn/Pze/ZTa2je3jkJESp54kfU/9U39Z3TjRHOeNAttcV0I2rwMU6fnHPMw0q
 X8Piu75CUjZHkrhncsl4+Q90txSMK4LiCzdDDUvyY2xSGb0VmEk+QBP7ZbJ2NNpdxPhp
 r2tg==
X-Gm-Message-State: AOAM532k3khzTUz7Zj2ya0O2W6dITVsZQpKLKALj5d/OufpK8hNy+VHH
 bjJcepX7or90G+bHO61lIfcK0g0QyO4=
X-Google-Smtp-Source: ABdhPJwp1N7/RlQgabvUObsRJUrHfUet5Kz0ZBVq0ifzmdi/TQ4Ynem35E8MPnfzWywBNcV9BiZY3w==
X-Received: by 2002:a17:906:c293:: with SMTP id
 r19mr11263889ejz.63.1603640467863; 
 Sun, 25 Oct 2020 08:41:07 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:d13a:1a76:8d61:cf5c])
 by smtp.gmail.com with ESMTPSA id g8sm4141931ejp.73.2020.10.25.08.41.07
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Sun, 25 Oct 2020 08:41:07 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Madhav.Chauhan@amd.com,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 05/13] drm/ttm: new TT backend allocation pool
Date: Sun, 25 Oct 2020 16:40:52 +0100
Message-Id: <20201025154100.16400-6-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201025154100.16400-1-christian.koenig@amd.com>
References: <20201025154100.16400-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ray.Huang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyByZXBsYWNlcyB0aGUgc3BhZ2hldHRpIGNvZGUgaW4gdGhlIHR3byBleGlzdGluZyBwYWdl
IHBvb2xzLgoKRmlyc3Qgb2YgYWxsIGRlcGVuZGluZyBvbiB0aGUgYWxsb2NhdGlvbiBzaXplIGl0
IGlzIGJldHdlZW4gMyAoMUdpQikgYW5kCjUgKDFNaUIpIHRpbWVzIGZhc3RlciB0aGFuIHRoZSBv
bGQgaW1wbGVtZW50YXRpb24uCgpJdCBtYWtlcyBiZXR0ZXIgdXNlIG9mIGJ1ZGR5IHBhZ2VzIHRv
IGFsbG93IGZvciBsYXJnZXIgcGh5c2ljYWwgY29udGlndW91cwphbGxvY2F0aW9ucyB3aGljaCBz
aG91bGQgcmVzdWx0IGluIGJldHRlciBUTEIgdXRpbGl6YXRpb24gYXQgbGVhc3QgZm9yIGFtZGdw
dS4KCkluc3RlYWQgb2YgYSBjb21wbGV0ZWx5IGJyYWluZGVhZCBhcHByb2FjaCBvZiBmaWxsaW5n
IHRoZSBwb29sIHdpdGggb25lIENQVQp3aGlsZSBhbm90aGVyIG9uZSBpcyB0cnlpbmcgdG8gc2hy
aW5rIGl0IHdlIG9ubHkgZ2l2ZSBiYWNrIGZyZWVkIHBhZ2VzLgoKVGhpcyBhbHNvIHJlc3VsdHMg
aW4gbXVjaCBsZXNzIGxvY2tpbmcgY29udGVudGlvbiBhbmQgYSB0cnlsb2NrIGZyZWUgTU0Kc2hy
aW5rZXIgY2FsbGJhY2ssIHNvIHdlIGNhbiBndWFyYW50ZWUgdGhhdCBwYWdlcyBhcmUgZ2l2ZW4g
YmFjayB0byB0aGUgc3lzdGVtCndoZW4gbmVlZGVkLgoKRG93bnNpZGUgb2YgdGhpcyBpcyB0aGF0
IGl0IHRha2VzIGxvbmdlciBmb3IgbWFueSBzbWFsbCBhbGxvY2F0aW9ucyB1bnRpbCB0aGUKcG9v
bCBpcyBmaWxsZWQgdXAuIFdlIGNvdWxkIGFkZHJlc3MgdGhpcywgYnV0IEkgY291bGRuJ3QgZmlu
ZCBhbiB1c2UgY2FzZQp3aGVyZSB0aGlzIGFjdHVhbGx5IG1hdHRlcnMuIEFuZCB3ZSBkb24ndCBi
b3RoZXIgZnJlZWluZyBsYXJnZSBjaHVua3Mgb2YgcGFnZXMKYW55IG1vcmUuCgpUaGUgc3lzZnMg
ZmlsZXMgYXJlIHJlcGxhY2VkIHdpdGggYSBzaW5nbGUgbW9kdWxlIHBhcmFtZXRlciwgYWxsb3dp
bmcgdXNlcnMgdG8Kb3ZlcnJpZGUgaG93IG1hbnkgcGFnZXMgc2hvdWxkIGJlIGdsb2JhbGx5IHBv
b2xlZCBpbiBUVE0uIFRoaXMgdW5mb3J0dW5hdGVseQpicmVha3MgdGhlIFVBUEkgc2xpZ2h0bHks
IGJ1dCBhcyBmYXIgYXMgd2Uga25vdyBub2JvZHkgZXZlciBkZXBlbmRlZCBvbiB0aGlzLgoKWmVy
b2luZyBtZW1vcnkgY29taW5nIGZyb20gdGhlIHBvb2wgd2FzIGhhbmRsZWQgaW5jb25zaXN0ZW50
bHkuIFRoZQphbGxvY19wYWdlcygpIGJhc2VkIHBvb2wgd2FzIHplcm9pbmcgaXQsIHRoZSBkbWFf
YWxsb2NfYXR0cigpIGJhc2VkIG9uZSB3YXNuJ3QuClRoZSBuZXcgaW1wbGVtZW50YXRpb24gaXNu
J3QgemVyb2luZyBwYWdlcyBmcm9tIHRoZSBwb29sIGVpdGhlciBhbmQgb25seSBzZXRzCnRoZSBf
X0dGUF9aRVJPIGZsYWcgd2hlbiBuZWNlc3NhcnkuCgpUaGUgaW1wbGVtZW50YXRpb24gaGFzIG9u
bHkgNzUzIGxpbmVzIG9mIGNvZGUgY29tcGFyZWQgdG8gdGhlIG92ZXIgMjYwMCBvZiB0aGUKb2xk
IG9uZSwgYW5kIGFsc28gYWxsb3dzIGZvciBzYXZpbmcgcXVpdGUgYSBidW5jaCBvZiBjb2RlIGlu
IHRoZSBkcml2ZXJzIHNpbmNlCndlIGRvbid0IG5lZWQgc3BlY2lhbGl6ZWQgaGFuZGxpbmcgdGhl
cmUgYW55IG1vcmUgYmFzZWQgb24ga2VybmVsIGNvbmZpZy4KCkFkZGl0aW9uYWwgdG8gYWxsIG9m
IHRoYXQgdGhlcmUgd2FzIGEgbmVhdCBidWcgd2l0aCBJT01NVSwgY29oZXJlbnQgRE1BCm1hcHBp
bmdzIGFuZCBodWdlIHBhZ2VzIHdoaWNoIGlzIG5vdyBmaXhlZCBpbiB0aGUgbmV3IGNvZGUgYXMg
d2VsbC4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdA
YW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlICAgICB8ICAgMiArLQog
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fbWVtb3J5LmMgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fcG9vbC5jICAgfCA2NjQgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwog
aW5jbHVkZS9kcm0vdHRtL3R0bV9jYWNoaW5nLmggICAgfCAgIDIgKwogaW5jbHVkZS9kcm0vdHRt
L3R0bV9wb29sLmggICAgICAgfCAgODkgKysrKysKIDUgZmlsZXMgY2hhbmdlZCwgNzU5IGluc2Vy
dGlvbnMoKyksIDEgZGVsZXRpb24oLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vdHRtL3R0bV9wb29sLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL2RybS90dG0vdHRt
X3Bvb2wuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vTWFrZWZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlCmluZGV4IDkwYzBkYTg4Y2M5OC4uMDA5NmJhY2JjZjMy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS90dG0vTWFrZWZpbGUKQEAgLTUsNyArNSw3IEBACiB0dG0teSA6PSB0dG1fbWVtb3J5
Lm8gdHRtX3R0Lm8gdHRtX2JvLm8gXAogCXR0bV9ib191dGlsLm8gdHRtX2JvX3ZtLm8gdHRtX21v
ZHVsZS5vIFwKIAl0dG1fZXhlY2J1Zl91dGlsLm8gdHRtX3BhZ2VfYWxsb2MubyB0dG1fcmFuZ2Vf
bWFuYWdlci5vIFwKLQl0dG1fcmVzb3VyY2UubworCXR0bV9yZXNvdXJjZS5vIHR0bV9wb29sLm8K
IHR0bS0kKENPTkZJR19BR1ApICs9IHR0bV9hZ3BfYmFja2VuZC5vCiB0dG0tJChDT05GSUdfRFJN
X1RUTV9ETUFfUEFHRV9QT09MKSArPSB0dG1fcGFnZV9hbGxvY19kbWEubwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9tZW1vcnkuYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX21lbW9yeS5jCmluZGV4IDY5Y2Y2MjJlNzllNS4uMzAxMmQwMzg4YzUxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9tZW1vcnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dHRtL3R0bV9tZW1vcnkuYwpAQCAtMzgsNiArMzgsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVs
ZS5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KICNpbmNsdWRlIDxsaW51eC9zd2FwLmg+Cisj
aW5jbHVkZSA8ZHJtL3R0bS90dG1fcG9vbC5oPgogCiAjZGVmaW5lIFRUTV9NRU1PUllfQUxMT0Nf
UkVUUklFUyA0CiAKQEAgLTQ1Myw2ICs0NTQsNyBAQCBpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChz
dHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IpCiAJfQogCXR0bV9wYWdlX2FsbG9jX2luaXQoZ2xv
YiwgZ2xvYi0+em9uZV9rZXJuZWwtPm1heF9tZW0vKDIqUEFHRV9TSVpFKSk7CiAJdHRtX2RtYV9w
YWdlX2FsbG9jX2luaXQoZ2xvYiwgZ2xvYi0+em9uZV9rZXJuZWwtPm1heF9tZW0vKDIqUEFHRV9T
SVpFKSk7CisJdHRtX3Bvb2xfbWdyX2luaXQoZ2xvYi0+em9uZV9rZXJuZWwtPm1heF9tZW0vKDIq
UEFHRV9TSVpFKSk7CiAJcmV0dXJuIDA7CiBvdXRfbm9fem9uZToKIAl0dG1fbWVtX2dsb2JhbF9y
ZWxlYXNlKGdsb2IpOwpAQCAtNDY3LDYgKzQ2OSw3IEBAIHZvaWQgdHRtX21lbV9nbG9iYWxfcmVs
ZWFzZShzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IpCiAJLyogbGV0IHRoZSBwYWdlIGFsbG9j
YXRvciBmaXJzdCBzdG9wIHRoZSBzaHJpbmsgd29yay4gKi8KIAl0dG1fcGFnZV9hbGxvY19maW5p
KCk7CiAJdHRtX2RtYV9wYWdlX2FsbG9jX2ZpbmkoKTsKKwl0dG1fcG9vbF9tZ3JfZmluaSgpOwog
CiAJZmx1c2hfd29ya3F1ZXVlKGdsb2ItPnN3YXBfcXVldWUpOwogCWRlc3Ryb3lfd29ya3F1ZXVl
KGdsb2ItPnN3YXBfcXVldWUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1f
cG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uODZiZDE3M2Q5M2E1Ci0tLSAvZGV2L251bGwKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCkBAIC0wLDAgKzEsNjY0IEBACisvKgorICog
Q29weXJpZ2h0IDIwMjAgQWR2YW5jZWQgTWljcm8gRGV2aWNlcywgSW5jLgorICoKKyAqIFBlcm1p
c3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9i
dGFpbmluZyBhCisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1l
bnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdh
cmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICog
dGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1
dGUsIHN1YmxpY2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBh
bmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hl
ZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICog
VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hh
bGwgYmUgaW5jbHVkZWQgaW4KKyAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMg
b2YgdGhlIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMi
LCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJ
TkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJ
TElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5H
RU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIENPUFlSSUdIVCBIT0xERVIoUykgT1Ig
QVVUSE9SKFMpIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SCisgKiBPVEhFUiBM
SUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVS
V0lTRSwKKyAqIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUg
U09GVFdBUkUgT1IgVEhFIFVTRSBPUgorICogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJF
LgorICoKKyAqIEF1dGhvcnM6IENocmlzdGlhbiBLw7ZuaWcKKyAqLworCisvKiBQb29saW5nIG9m
IGFsbG9jYXRlZCBwYWdlcyBpcyBuZWNlc3NhcnkgYmVjYXVzZSBjaGFuZ2luZyB0aGUgY2FjaGlu
ZworICogYXR0cmlidXRlcyBvbiB4ODYgb2YgdGhlIGxpbmVhciBtYXBwaW5nIHJlcXVpcmVzIGEg
Y29zdGx5IGNyb3NzIENQVSBUTEIKKyAqIGludmFsaWRhdGUgZm9yIHRob3NlIGFkZHJlc3Nlcy4K
KyAqCisgKiBBZGRpdGlvbmFsIHRvIHRoYXQgYWxsb2NhdGlvbnMgZnJvbSB0aGUgRE1BIGNvaGVy
ZW50IEFQSSBhcmUgcG9vbGVkIGFzIHdlbGwKKyAqIGNhdXNlIHRoZXkgYXJlIHJhdGhlciBzbG93
IGNvbXBhcmVkIHRvIGFsbG9jX3BhZ2VzK21hcC4KKyAqLworCisjaW5jbHVkZSA8bGludXgvbW9k
dWxlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLW1hcHBpbmcuaD4KKworI2lmZGVmIENPTkZJR19Y
ODYKKyNpbmNsdWRlIDxhc20vc2V0X21lbW9yeS5oPgorI2VuZGlmCisKKyNpbmNsdWRlIDxkcm0v
dHRtL3R0bV9wb29sLmg+CisjaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmg+CisjaW5j
bHVkZSA8ZHJtL3R0bS90dG1fdHQuaD4KKworLyoqCisgKiBzdHJ1Y3QgdHRtX3Bvb2xfZG1hIC0g
SGVscGVyIG9iamVjdCBmb3IgY29oZXJlbnQgRE1BIG1hcHBpbmdzCisgKgorICogQGFkZHI6IG9y
aWdpbmFsIERNQSBhZGRyZXNzIHJldHVybmVkIGZvciB0aGUgbWFwcGluZworICogQHZhZGRyOiBv
cmlnaW5hbCB2YWRkciByZXR1cm4gZm9yIHRoZSBtYXBwaW5nIGFuZCBvcmRlciBpbiB0aGUgbG93
ZXIgYml0cworICovCitzdHJ1Y3QgdHRtX3Bvb2xfZG1hIHsKKwlkbWFfYWRkcl90IGFkZHI7CisJ
dW5zaWduZWQgbG9uZyB2YWRkcjsKK307CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nIHBhZ2VfcG9v
bF9zaXplOworCitNT0RVTEVfUEFSTV9ERVNDKHBhZ2VfcG9vbF9zaXplLCAiTnVtYmVyIG9mIHBh
Z2VzIGluIHRoZSBXQy9VQy9ETUEgcG9vbCIpOworbW9kdWxlX3BhcmFtKHBhZ2VfcG9vbF9zaXpl
LCB1bG9uZywgMDY0NCk7CisKK3N0YXRpYyBhdG9taWNfbG9uZ190IGFsbG9jYXRlZF9wYWdlczsK
Kworc3RhdGljIHN0cnVjdCB0dG1fcG9vbF90eXBlIGdsb2JhbF93cml0ZV9jb21iaW5lZFtNQVhf
T1JERVJdOworc3RhdGljIHN0cnVjdCB0dG1fcG9vbF90eXBlIGdsb2JhbF91bmNhY2hlZFtNQVhf
T1JERVJdOworCitzdGF0aWMgc3BpbmxvY2tfdCBzaHJpbmtlcl9sb2NrOworc3RhdGljIHN0cnVj
dCBsaXN0X2hlYWQgc2hyaW5rZXJfbGlzdDsKK3N0YXRpYyBzdHJ1Y3Qgc2hyaW5rZXIgbW1fc2hy
aW5rZXI7CisKKy8qIEFsbG9jYXRlIHBhZ2VzIG9mIHNpemUgMSA8PCBvcmRlciB3aXRoIHRoZSBn
aXZlbiBnZnBfZmxhZ3MgKi8KK3N0YXRpYyBzdHJ1Y3QgcGFnZSAqdHRtX3Bvb2xfYWxsb2NfcGFn
ZShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsIGdmcF90IGdmcF9mbGFncywKKwkJCQkJdW5zaWduZWQg
aW50IG9yZGVyKQoreworCXVuc2lnbmVkIGxvbmcgYXR0ciA9IERNQV9BVFRSX0ZPUkNFX0NPTlRJ
R1VPVVM7CisJc3RydWN0IHR0bV9wb29sX2RtYSAqZG1hOworCXN0cnVjdCBwYWdlICpwOworCXZv
aWQgKnZhZGRyOworCisJaWYgKG9yZGVyKSB7CisJCWdmcF9mbGFncyB8PSBHRlBfVFJBTlNIVUdF
X0xJR0hUIHwgX19HRlBfTk9SRVRSWSB8CisJCQlfX0dGUF9LU1dBUERfUkVDTEFJTTsKKwkJZ2Zw
X2ZsYWdzICY9IH5fX0dGUF9NT1ZBQkxFOworCQlnZnBfZmxhZ3MgJj0gfl9fR0ZQX0NPTVA7CisJ
fQorCisJaWYgKCFwb29sLT51c2VfZG1hX2FsbG9jKSB7CisJCXAgPSBhbGxvY19wYWdlcyhnZnBf
ZmxhZ3MsIG9yZGVyKTsKKwkJaWYgKHApCisJCQlwLT5wcml2YXRlID0gb3JkZXI7CisJCXJldHVy
biBwOworCX0KKworCWRtYSA9IGttYWxsb2Moc2l6ZW9mKCpkbWEpLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWRtYSkKKwkJcmV0dXJuIE5VTEw7CisKKwlpZiAob3JkZXIpCisJCWF0dHIgfD0gRE1BX0FU
VFJfTk9fV0FSTjsKKworICAgICAgICB2YWRkciA9IGRtYV9hbGxvY19hdHRycyhwb29sLT5kZXYs
ICgxVUxMIDw8IG9yZGVyKSAqIFBBR0VfU0laRSwKKwkJCQkmZG1hLT5hZGRyLCBnZnBfZmxhZ3Ms
IGF0dHIpOworCWlmICghdmFkZHIpCisJCWdvdG8gZXJyb3JfZnJlZTsKKworCS8qIFRPRE86IFRo
aXMgaXMgYW4gaWxsZWdhbCBhYnVzZSBvZiB0aGUgRE1BIEFQSSwgYnV0IHdlIG5lZWQgdG8gcmV3
b3JrCisJICogVFRNIHBhZ2UgZmF1bHQgaGFuZGxpbmcgYW5kIGV4dGVuZCB0aGUgRE1BIEFQSSB0
byBjbGVhbiB0aGlzIHVwLgorCSAqLworCWlmIChpc192bWFsbG9jX2FkZHIodmFkZHIpKSB7CisJ
CXAgPSB2bWFsbG9jX3RvX3BhZ2UodmFkZHIpOworCX0gZWxzZSB7CisJCXAgPSB2aXJ0X3RvX3Bh
Z2UodmFkZHIpOworCX0KKworCWRtYS0+dmFkZHIgPSAodW5zaWduZWQgbG9uZyl2YWRkciB8IG9y
ZGVyOworCXAtPnByaXZhdGUgPSAodW5zaWduZWQgbG9uZylkbWE7CisJcmV0dXJuIHA7CisKK2Vy
cm9yX2ZyZWU6CisJa2ZyZWUoZG1hKTsKKwlyZXR1cm4gTlVMTDsKK30KKworLyogUmVzZXQgdGhl
IGNhY2hpbmcgYW5kIHBhZ2VzIG9mIHNpemUgMSA8PCBvcmRlciAqLworc3RhdGljIHZvaWQgdHRt
X3Bvb2xfZnJlZV9wYWdlKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgZW51bSB0dG1fY2FjaGluZyBj
YWNoaW5nLAorCQkJICAgICAgIHVuc2lnbmVkIGludCBvcmRlciwgc3RydWN0IHBhZ2UgKnApCit7
CisJdW5zaWduZWQgbG9uZyBhdHRyID0gRE1BX0FUVFJfRk9SQ0VfQ09OVElHVU9VUzsKKwlzdHJ1
Y3QgdHRtX3Bvb2xfZG1hICpkbWE7CisJdm9pZCAqdmFkZHI7CisKKyNpZmRlZiBDT05GSUdfWDg2
CisJLyogV2UgZG9uJ3QgY2FyZSB0aGF0IHNldF9wYWdlc193YiBpcyBpbmVmZmljaWVudCBoZXJl
LiBUaGlzIGlzIG9ubHkKKwkgKiB1c2VkIHdoZW4gd2UgaGF2ZSB0byBzaHJpbmsgYW5kIENQVSBv
dmVyaGVhZCBpcyBpcnJlbGV2YW50IHRoZW4uCisJICovCisJaWYgKGNhY2hpbmcgIT0gdHRtX2Nh
Y2hlZCAmJiAhUGFnZUhpZ2hNZW0ocCkpCisJCXNldF9wYWdlc193YihwLCAxIDw8IG9yZGVyKTsK
KyNlbmRpZgorCisJaWYgKCFwb29sLT51c2VfZG1hX2FsbG9jKSB7CisJCV9fZnJlZV9wYWdlcyhw
LCBvcmRlcik7CisJCXJldHVybjsKKwl9CisKKwlpZiAob3JkZXIpCisJCWF0dHIgfD0gRE1BX0FU
VFJfTk9fV0FSTjsKKworCWRtYSA9ICh2b2lkICopcC0+cHJpdmF0ZTsKKwl2YWRkciA9ICh2b2lk
ICopKGRtYS0+dmFkZHIgJiBQQUdFX01BU0spOworCWRtYV9mcmVlX2F0dHJzKHBvb2wtPmRldiwg
KDFVTCA8PCBvcmRlcikgKiBQQUdFX1NJWkUsIHZhZGRyLCBkbWEtPmFkZHIsCisJCSAgICAgICBh
dHRyKTsKKwlrZnJlZShkbWEpOworfQorCisvKiBBcHBseSBhIG5ldyBjYWNoaW5nIHRvIGFuIGFy
cmF5IG9mIHBhZ2VzICovCitpbnQgdHRtX3Bvb2xfYXBwbHlfY2FjaGluZyhzdHJ1Y3QgcGFnZSAq
KmZpcnN0LCBzdHJ1Y3QgcGFnZSAqKmxhc3QsCisJCQkgICBlbnVtIHR0bV9jYWNoaW5nIGNhY2hp
bmcpCit7CisjaWZkZWYgQ09ORklHX1g4NgorCXVuc2lnbmVkIGludCBudW1fcGFnZXMgPSBsYXN0
IC0gZmlyc3Q7CisKKwlpZiAoIW51bV9wYWdlcykKKwkJcmV0dXJuIDA7CisKKwlzd2l0Y2ggKGNh
Y2hpbmcpIHsKKwljYXNlIHR0bV9jYWNoZWQ6CisJCWJyZWFrOworCWNhc2UgdHRtX3dyaXRlX2Nv
bWJpbmVkOgorCQlyZXR1cm4gc2V0X3BhZ2VzX2FycmF5X3djKGZpcnN0LCBudW1fcGFnZXMpOwor
CQlicmVhazsKKwljYXNlIHR0bV91bmNhY2hlZDoKKwkJcmV0dXJuIHNldF9wYWdlc19hcnJheV91
YyhmaXJzdCwgbnVtX3BhZ2VzKTsKKwkJYnJlYWs7CisJfQorI2VuZGlmCisJcmV0dXJuIDA7Cit9
CisKKy8qIE1hcCBwYWdlcyBvZiAxIDw8IG9yZGVyIHNpemUgYW5kIGZpbGwgdGhlIERNQSBhZGRy
ZXNzIGFycmF5ICAqLworc3RhdGljIGludCB0dG1fcG9vbF9tYXAoc3RydWN0IHR0bV9wb29sICpw
b29sLCB1bnNpZ25lZCBpbnQgb3JkZXIsCisJCQlzdHJ1Y3QgcGFnZSAqcCwgZG1hX2FkZHJfdCAq
KmRtYV9hZGRyKQoreworCWRtYV9hZGRyX3QgYWRkcjsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWlm
IChwb29sLT51c2VfZG1hX2FsbG9jKSB7CisJCXN0cnVjdCB0dG1fcG9vbF9kbWEgKmRtYSA9ICh2
b2lkKilwLT5wcml2YXRlOworCisJCWFkZHIgPSBkbWEtPmFkZHI7CisJfSBlbHNlIHsKKwkJc2l6
ZV90IHNpemUgPSAoMVVMTCA8PCBvcmRlcikgKiBQQUdFX1NJWkU7CisKKwkJYWRkciA9IGRtYV9t
YXBfcGFnZShwb29sLT5kZXYsIHAsIDAsIHNpemUsIERNQV9CSURJUkVDVElPTkFMKTsKKwkJaWYg
KGRtYV9tYXBwaW5nX2Vycm9yKHBvb2wtPmRldiwgKipkbWFfYWRkcikpCisJCQlyZXR1cm4gLUVG
QVVMVDsKKwl9CisKKwlmb3IgKGkgPSAxIDw8IG9yZGVyOyBpIDsgLS1pKSB7CisJCSooKmRtYV9h
ZGRyKSsrID0gYWRkcjsKKwkJYWRkciArPSBQQUdFX1NJWkU7CisJfQorCisJcmV0dXJuIDA7Cit9
CisKKy8qIFVubWFwIHBhZ2VzIG9mIDEgPDwgb3JkZXIgc2l6ZSAqLworc3RhdGljIHZvaWQgdHRt
X3Bvb2xfdW5tYXAoc3RydWN0IHR0bV9wb29sICpwb29sLCBkbWFfYWRkcl90IGRtYV9hZGRyLAor
CQkJICAgdW5zaWduZWQgaW50IG51bV9wYWdlcykKK3sKKwkvKiBVbm1hcHBlZCB3aGlsZSBmcmVl
aW5nIHRoZSBwYWdlICovCisJaWYgKHBvb2wtPnVzZV9kbWFfYWxsb2MpCisJCXJldHVybjsKKwor
CWRtYV91bm1hcF9wYWdlKHBvb2wtPmRldiwgZG1hX2FkZHIsIChsb25nKW51bV9wYWdlcyA8PCBQ
QUdFX1NISUZULAorCQkgICAgICAgRE1BX0JJRElSRUNUSU9OQUwpOworfQorCisvKiBHaXZlIHBh
Z2VzIGludG8gYSBzcGVjaWZpYyBwb29sX3R5cGUgKi8KK3N0YXRpYyB2b2lkIHR0bV9wb29sX3R5
cGVfZ2l2ZShzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQsIHN0cnVjdCBwYWdlICpwKQoreworCXNw
aW5fbG9jaygmcHQtPmxvY2spOworCWxpc3RfYWRkKCZwLT5scnUsICZwdC0+cGFnZXMpOworCXNw
aW5fdW5sb2NrKCZwdC0+bG9jayk7CisJYXRvbWljX2xvbmdfYWRkKDEgPDwgcHQtPm9yZGVyLCAm
YWxsb2NhdGVkX3BhZ2VzKTsKK30KKworLyogVGFrZSBwYWdlcyBmcm9tIGEgc3BlY2lmaWMgcG9v
bF90eXBlLCByZXR1cm4gTlVMTCB3aGVuIG5vdGhpbmcgYXZhaWxhYmxlICovCitzdGF0aWMgc3Ry
dWN0IHBhZ2UgKnR0bV9wb29sX3R5cGVfdGFrZShzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQpCit7
CisJc3RydWN0IHBhZ2UgKnA7CisKKwlzcGluX2xvY2soJnB0LT5sb2NrKTsKKwlwID0gbGlzdF9m
aXJzdF9lbnRyeV9vcl9udWxsKCZwdC0+cGFnZXMsIHR5cGVvZigqcCksIGxydSk7CisJaWYgKHAp
IHsKKwkJYXRvbWljX2xvbmdfc3ViKDEgPDwgcHQtPm9yZGVyLCAmYWxsb2NhdGVkX3BhZ2VzKTsK
KwkJbGlzdF9kZWwoJnAtPmxydSk7CisJfQorCXNwaW5fdW5sb2NrKCZwdC0+bG9jayk7CisKKwly
ZXR1cm4gcDsKK30KKworLyogQ291bnQgdGhlIG51bWJlciBvZiBwYWdlcyBhdmFpbGFibGUgaW4g
YSBwb29sX3R5cGUgKi8KK3N0YXRpYyB1bnNpZ25lZCBpbnQgdHRtX3Bvb2xfdHlwZV9jb3VudChz
dHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQpCit7CisJdW5zaWduZWQgaW50IGNvdW50ID0gMDsKKwlz
dHJ1Y3QgcGFnZSAqcDsKKworCXNwaW5fbG9jaygmcHQtPmxvY2spOworCS8qIE9ubHkgdXNlZCBm
b3IgZGVidWdmcywgdGhlIG92ZXJoZWFkIGRvZXNuJ3QgbWF0dGVyICovCisJbGlzdF9mb3JfZWFj
aF9lbnRyeShwLCAmcHQtPnBhZ2VzLCBscnUpCisJCSsrY291bnQ7CisJc3Bpbl91bmxvY2soJnB0
LT5sb2NrKTsKKworCXJldHVybiBjb3VudDsKK30KKworLyogSW5pdGlhbGl6ZSBhbmQgYWRkIGEg
cG9vbCB0eXBlIHRvIHRoZSBnbG9iYWwgc2hyaW5rZXIgbGlzdCAqLworc3RhdGljIHZvaWQgdHRt
X3Bvb2xfdHlwZV9pbml0KHN0cnVjdCB0dG1fcG9vbF90eXBlICpwdCwgc3RydWN0IHR0bV9wb29s
ICpwb29sLAorCQkJICAgICAgIGVudW0gdHRtX2NhY2hpbmcgY2FjaGluZywgdW5zaWduZWQgaW50
IG9yZGVyKQoreworCXB0LT5wb29sID0gcG9vbDsKKwlwdC0+Y2FjaGluZyA9IGNhY2hpbmc7CisJ
cHQtPm9yZGVyID0gb3JkZXI7CisJc3Bpbl9sb2NrX2luaXQoJnB0LT5sb2NrKTsKKwlJTklUX0xJ
U1RfSEVBRCgmcHQtPnBhZ2VzKTsKKworCXNwaW5fbG9jaygmc2hyaW5rZXJfbG9jayk7CisJbGlz
dF9hZGRfdGFpbCgmcHQtPnNocmlua2VyX2xpc3QsICZzaHJpbmtlcl9saXN0KTsKKwlzcGluX3Vu
bG9jaygmc2hyaW5rZXJfbG9jayk7Cit9CisKKy8qIFJlbW92ZSBhIHBvb2xfdHlwZSBmcm9tIHRo
ZSBnbG9iYWwgc2hyaW5rZXIgbGlzdCBhbmQgZnJlZSBhbGwgcGFnZXMgKi8KK3N0YXRpYyB2b2lk
IHR0bV9wb29sX3R5cGVfZmluaShzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSAqcHQpCit7CisJc3RydWN0
IHBhZ2UgKnAsICp0bXA7CisKKwlzcGluX2xvY2soJnNocmlua2VyX2xvY2spOworCWxpc3RfZGVs
KCZwdC0+c2hyaW5rZXJfbGlzdCk7CisJc3Bpbl91bmxvY2soJnNocmlua2VyX2xvY2spOworCisJ
bGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHAsIHRtcCwgJnB0LT5wYWdlcywgbHJ1KQorCQl0dG1f
cG9vbF9mcmVlX3BhZ2UocHQtPnBvb2wsIHB0LT5jYWNoaW5nLCBwdC0+b3JkZXIsIHApOworfQor
CisvKiBSZXR1cm4gdGhlIHBvb2xfdHlwZSB0byB1c2UgZm9yIHRoZSBnaXZlbiBjYWNoaW5nIGFu
ZCBvcmRlciAqLworc3RhdGljIHN0cnVjdCB0dG1fcG9vbF90eXBlICp0dG1fcG9vbF9zZWxlY3Rf
dHlwZShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsCisJCQkJCQkgIGVudW0gdHRtX2NhY2hpbmcgY2Fj
aGluZywKKwkJCQkJCSAgdW5zaWduZWQgaW50IG9yZGVyKQoreworCWlmIChwb29sLT51c2VfZG1h
X2FsbG9jKQorCQlyZXR1cm4gJnBvb2wtPmNhY2hpbmdbY2FjaGluZ10ub3JkZXJzW29yZGVyXTsK
KworI2lmZGVmIENPTkZJR19YODYKKwlzd2l0Y2ggKGNhY2hpbmcpIHsKKwljYXNlIHR0bV93cml0
ZV9jb21iaW5lZDoKKwkJcmV0dXJuICZnbG9iYWxfd3JpdGVfY29tYmluZWRbb3JkZXJdOworCWNh
c2UgdHRtX3VuY2FjaGVkOgorCQlyZXR1cm4gJmdsb2JhbF91bmNhY2hlZFtvcmRlcl07CisJZGVm
YXVsdDogYnJlYWs7CisJfQorI2VuZGlmCisKKwlyZXR1cm4gTlVMTDsKK30KKworLyogRnJlZSBw
YWdlcyB1c2luZyB0aGUgZ2xvYmFsIHNocmlua2VyIGxpc3QgKi8KK3N0YXRpYyB1bnNpZ25lZCBp
bnQgdHRtX3Bvb2xfc2hyaW5rKHZvaWQpCit7CisJc3RydWN0IHR0bV9wb29sX3R5cGUgKnB0Owor
CXVuc2lnbmVkIGludCBudW1fZnJlZWQ7CisJc3RydWN0IHBhZ2UgKnA7CisKKwlzcGluX2xvY2so
JnNocmlua2VyX2xvY2spOworCXB0ID0gbGlzdF9maXJzdF9lbnRyeSgmc2hyaW5rZXJfbGlzdCwg
dHlwZW9mKCpwdCksIHNocmlua2VyX2xpc3QpOworCisJcCA9IHR0bV9wb29sX3R5cGVfdGFrZShw
dCk7CisJaWYgKHApIHsKKwkJdHRtX3Bvb2xfZnJlZV9wYWdlKHB0LT5wb29sLCBwdC0+Y2FjaGlu
ZywgcHQtPm9yZGVyLCBwKTsKKwkJbnVtX2ZyZWVkID0gMSA8PCBwdC0+b3JkZXI7CisJfSBlbHNl
IHsKKwkJbnVtX2ZyZWVkID0gMDsKKwl9CisKKwlsaXN0X21vdmVfdGFpbCgmcHQtPnNocmlua2Vy
X2xpc3QsICZzaHJpbmtlcl9saXN0KTsKKwlzcGluX3VubG9jaygmc2hyaW5rZXJfbG9jayk7CisK
KwlyZXR1cm4gbnVtX2ZyZWVkOworfQorCisvKiBSZXR1cm4gdGhlIGFsbG9jYXRpb24gb3JkZXIg
YmFzZWQgZm9yIGEgcGFnZSAqLworc3RhdGljIHVuc2lnbmVkIGludCB0dG1fcG9vbF9wYWdlX29y
ZGVyKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHBhZ2UgKnApCit7CisJaWYgKHBvb2wt
PnVzZV9kbWFfYWxsb2MpIHsKKwkJc3RydWN0IHR0bV9wb29sX2RtYSAqZG1hID0gKHZvaWQgKilw
LT5wcml2YXRlOworCisJCXJldHVybiBkbWEtPnZhZGRyICYgflBBR0VfTUFTSzsKKwl9CisKKwly
ZXR1cm4gcC0+cHJpdmF0ZTsKK30KKworLyoqCisgKiB0dG1fcG9vbF9hbGxvYyAtIEZpbGwgYSB0
dG1fdHQgb2JqZWN0CisgKgorICogQHBvb2w6IHR0bV9wb29sIHRvIHVzZQorICogQHR0OiB0dG1f
dHQgb2JqZWN0IHRvIGZpbGwKKyAqIEBjdHg6IG9wZXJhdGlvbiBjb250ZXh0CisgKgorICogRmls
bCB0aGUgdHRtX3R0IG9iamVjdCB3aXRoIHBhZ2VzIGFuZCBhbHNvIG1ha2Ugc3VyZSB0byBETUEg
bWFwIHRoZW0gd2hlbgorICogbmVjZXNzYXJ5LgorICoKKyAqIFJldHVybnM6IDAgb24gc3VjY2Vz
c2UsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb3RoZXJ3aXNlLgorICovCitpbnQgdHRtX3Bvb2xfYWxs
b2Moc3RydWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3QgdHRtX3R0ICp0dCwKKwkJICAgc3RydWN0
IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpCit7CisJdW5zaWduZWQgbG9uZyBudW1fcGFnZXMgPSB0
dC0+bnVtX3BhZ2VzOworCWRtYV9hZGRyX3QgKmRtYV9hZGRyID0gdHQtPmRtYV9hZGRyZXNzOwor
CXN0cnVjdCBwYWdlICoqY2FjaGluZyA9IHR0LT5wYWdlczsKKwlzdHJ1Y3QgcGFnZSAqKnBhZ2Vz
ID0gdHQtPnBhZ2VzOworCWdmcF90IGdmcF9mbGFncyA9IEdGUF9VU0VSOworCXVuc2lnbmVkIGlu
dCBpLCBvcmRlcjsKKwlzdHJ1Y3QgcGFnZSAqcDsKKwlpbnQgcjsKKworCVdBUk5fT04oIW51bV9w
YWdlcyB8fCB0dG1fdHRfaXNfcG9wdWxhdGVkKHR0KSk7CisKKwlpZiAodHQtPnBhZ2VfZmxhZ3Mg
JiBUVE1fUEFHRV9GTEFHX1pFUk9fQUxMT0MpCisJCWdmcF9mbGFncyB8PSBfX0dGUF9aRVJPOwor
CisJaWYgKHR0LT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19OT19SRVRSWSkKKwkJZ2ZwX2Zs
YWdzIHw9IF9fR0ZQX1JFVFJZX01BWUZBSUw7CisKKwlpZiAocG9vbC0+dXNlX2RtYTMyKQorCQln
ZnBfZmxhZ3MgfD0gR0ZQX0RNQTMyOworCWVsc2UKKwkJZ2ZwX2ZsYWdzIHw9IEdGUF9ISUdIVVNF
UjsKKworCWZvciAob3JkZXIgPSBtaW4oTUFYX09SREVSIC0gMVVMLCBfX2ZscyhudW1fcGFnZXMp
KTsgbnVtX3BhZ2VzOworCSAgICAgb3JkZXIgPSBtaW5fdCh1bnNpZ25lZCBpbnQsIG9yZGVyLCBf
X2ZscyhudW1fcGFnZXMpKSkgeworCQlib29sIGFwcGx5X2NhY2hpbmcgPSBmYWxzZTsKKwkJc3Ry
dWN0IHR0bV9wb29sX3R5cGUgKnB0OworCisJCXB0ID0gdHRtX3Bvb2xfc2VsZWN0X3R5cGUocG9v
bCwgdHQtPmNhY2hpbmcsIG9yZGVyKTsKKwkJcCA9IHB0ID8gdHRtX3Bvb2xfdHlwZV90YWtlKHB0
KSA6IE5VTEw7CisJCWlmIChwKSB7CisJCQlhcHBseV9jYWNoaW5nID0gdHJ1ZTsKKwkJfSBlbHNl
IHsKKwkJCXAgPSB0dG1fcG9vbF9hbGxvY19wYWdlKHBvb2wsIGdmcF9mbGFncywgb3JkZXIpOwor
CQkJaWYgKHAgJiYgUGFnZUhpZ2hNZW0ocCkpCisJCQkJYXBwbHlfY2FjaGluZyA9IHRydWU7CisJ
CX0KKworCQlpZiAoIXApIHsKKwkJCWlmIChvcmRlcikgeworCQkJCS0tb3JkZXI7CisJCQkJY29u
dGludWU7CisJCQl9CisJCQlyID0gLUVOT01FTTsKKwkJCWdvdG8gZXJyb3JfZnJlZV9hbGw7CisJ
CX0KKworCQlpZiAoYXBwbHlfY2FjaGluZykgeworCQkJciA9IHR0bV9wb29sX2FwcGx5X2NhY2hp
bmcoY2FjaGluZywgcGFnZXMsIHR0LT5jYWNoaW5nKTsKKwkJCWlmIChyKQorCQkJCWdvdG8gZXJy
b3JfZnJlZV9wYWdlOworCQkJY2FjaGluZyA9IHBhZ2VzICsgKDEgPDwgb3JkZXIpOworCQl9CisK
KwkJciA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9jX3BhZ2UoJnR0bV9tZW1fZ2xvYiwgcCwKKwkJCQkJ
ICAgICAgKDEgPDwgb3JkZXIpICogUEFHRV9TSVpFLAorCQkJCQkgICAgICBjdHgpOworCQlpZiAo
cikKKwkJCWdvdG8gZXJyb3JfZnJlZV9wYWdlOworCisJCWlmIChkbWFfYWRkcikgeworCQkJciA9
IHR0bV9wb29sX21hcChwb29sLCBvcmRlciwgcCwgJmRtYV9hZGRyKTsKKwkJCWlmIChyKQorCQkJ
CWdvdG8gZXJyb3JfZ2xvYmFsX2ZyZWU7CisJCX0KKworCQludW1fcGFnZXMgLT0gMSA8PCBvcmRl
cjsKKwkJZm9yIChpID0gMSA8PCBvcmRlcjsgaTsgLS1pKQorCQkJKihwYWdlcysrKSA9IHArKzsK
Kwl9CisKKwlyID0gdHRtX3Bvb2xfYXBwbHlfY2FjaGluZyhjYWNoaW5nLCBwYWdlcywgdHQtPmNh
Y2hpbmcpOworCWlmIChyKQorCQlnb3RvIGVycm9yX2ZyZWVfYWxsOworCisJcmV0dXJuIDA7CisK
K2Vycm9yX2dsb2JhbF9mcmVlOgorCXR0bV9tZW1fZ2xvYmFsX2ZyZWVfcGFnZSgmdHRtX21lbV9n
bG9iLCBwLCAoMSA8PCBvcmRlcikgKiBQQUdFX1NJWkUpOworCitlcnJvcl9mcmVlX3BhZ2U6CisJ
dHRtX3Bvb2xfZnJlZV9wYWdlKHBvb2wsIHR0LT5jYWNoaW5nLCBvcmRlciwgcCk7CisKK2Vycm9y
X2ZyZWVfYWxsOgorCW51bV9wYWdlcyA9IHR0LT5udW1fcGFnZXMgLSBudW1fcGFnZXM7CisJZm9y
IChpID0gMDsgaSA8IG51bV9wYWdlczsgKSB7CisJCW9yZGVyID0gdHRtX3Bvb2xfcGFnZV9vcmRl
cihwb29sLCB0dC0+cGFnZXNbaV0pOworCQl0dG1fcG9vbF9mcmVlX3BhZ2UocG9vbCwgdHQtPmNh
Y2hpbmcsIG9yZGVyLCB0dC0+cGFnZXNbaV0pOworCQlpICs9IDEgPDwgb3JkZXI7CisJfQorCisJ
cmV0dXJuIHI7Cit9CitFWFBPUlRfU1lNQk9MKHR0bV9wb29sX2FsbG9jKTsKKworLyoqCisgKiB0
dG1fcG9vbF9mcmVlIC0gRnJlZSB0aGUgYmFja2luZyBwYWdlcyBmcm9tIGEgdHRtX3R0IG9iamVj
dAorICoKKyAqIEBwb29sOiBQb29sIHRvIGdpdmUgcGFnZXMgYmFjayB0by4KKyAqIEB0dDogdHRt
X3R0IG9iamVjdCB0byB1bnBvcHVsYXRlCisgKgorICogR2l2ZSB0aGUgcGFja2luZyBwYWdlcyBi
YWNrIHRvIGEgcG9vbCBvciBmcmVlIHRoZW0KKyAqLwordm9pZCB0dG1fcG9vbF9mcmVlKHN0cnVj
dCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0IHR0bV90dCAqdHQpCit7CisJdW5zaWduZWQgaW50IGk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgdHQtPm51bV9wYWdlczsgKSB7CisJCXN0cnVjdCBwYWdlICpw
ID0gdHQtPnBhZ2VzW2ldOworCQl1bnNpZ25lZCBpbnQgb3JkZXIsIG51bV9wYWdlczsKKwkJc3Ry
dWN0IHR0bV9wb29sX3R5cGUgKnB0OworCisJCW9yZGVyID0gdHRtX3Bvb2xfcGFnZV9vcmRlcihw
b29sLCBwKTsKKwkJbnVtX3BhZ2VzID0gMVVMTCA8PCBvcmRlcjsKKwkJdHRtX21lbV9nbG9iYWxf
ZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2IsIHAsCisJCQkJCSBudW1fcGFnZXMgKiBQQUdFX1NJWkUp
OworCQlpZiAodHQtPmRtYV9hZGRyZXNzKQorCQkJdHRtX3Bvb2xfdW5tYXAocG9vbCwgdHQtPmRt
YV9hZGRyZXNzW2ldLCBudW1fcGFnZXMpOworCisJCXB0ID0gdHRtX3Bvb2xfc2VsZWN0X3R5cGUo
cG9vbCwgdHQtPmNhY2hpbmcsIG9yZGVyKTsKKwkJaWYgKHB0KQorCQkJdHRtX3Bvb2xfdHlwZV9n
aXZlKHB0LCB0dC0+cGFnZXNbaV0pOworCQllbHNlCisJCQl0dG1fcG9vbF9mcmVlX3BhZ2UocG9v
bCwgdHQtPmNhY2hpbmcsIG9yZGVyLAorCQkJCQkgICB0dC0+cGFnZXNbaV0pOworCisJCWkgKz0g
bnVtX3BhZ2VzOworCX0KKworCXdoaWxlIChhdG9taWNfbG9uZ19yZWFkKCZhbGxvY2F0ZWRfcGFn
ZXMpID4gcGFnZV9wb29sX3NpemUpCisJCXR0bV9wb29sX3NocmluaygpOworfQorRVhQT1JUX1NZ
TUJPTCh0dG1fcG9vbF9mcmVlKTsKKworLyoqCisgKiB0dG1fcG9vbF9pbml0IC0gSW5pdGlhbGl6
ZSBhIHBvb2wKKyAqCisgKiBAcG9vbDogdGhlIHBvb2wgdG8gaW5pdGlhbGl6ZQorICogQGRldjog
ZGV2aWNlIGZvciBETUEgYWxsb2NhdGlvbnMgYW5kIG1hcHBpbmdzCisgKiBAdXNlX2RtYV9hbGxv
YzogdHJ1ZSBpZiBjb2hlcmVudCBETUEgYWxsb2Mgc2hvdWxkIGJlIHVzZWQKKyAqIEB1c2VfZG1h
MzI6IHRydWUgaWYgR0ZQX0RNQTMyIHNob3VsZCBiZSB1c2VkCisgKgorICogSW5pdGlhbGl6ZSB0
aGUgcG9vbCBhbmQgaXRzIHBvb2wgdHlwZXMuCisgKi8KK3ZvaWQgdHRtX3Bvb2xfaW5pdChzdHJ1
Y3QgdHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJICAgYm9vbCB1c2VfZG1h
X2FsbG9jLCBib29sIHVzZV9kbWEzMikKK3sKKwl1bnNpZ25lZCBpbnQgaSwgajsKKworCXBvb2wt
PmRldiA9IGRldjsKKwlwb29sLT51c2VfZG1hX2FsbG9jID0gdXNlX2RtYV9hbGxvYzsKKwlwb29s
LT51c2VfZG1hMzIgPSB1c2VfZG1hMzI7CisKKwlmb3IgKGkgPSAwOyBpIDwgVFRNX05VTV9DQUNI
SU5HX1RZUEVTOyArK2kpCisJCWZvciAoaiA9IDA7IGogPCBNQVhfT1JERVI7ICsraikKKwkJCXR0
bV9wb29sX3R5cGVfaW5pdCgmcG9vbC0+Y2FjaGluZ1tpXS5vcmRlcnNbal0sCisJCQkJCSAgIHBv
b2wsIGksIGopOworCit9CitFWFBPUlRfU1lNQk9MKHR0bV9wb29sX2luaXQpOworCisvKioKKyAq
IHR0bV9wb29sX2ZpbmkgLSBDbGVhbnVwIGEgcG9vbAorICoKKyAqIEBwb29sOiB0aGUgcG9vbCB0
byBjbGVhbiB1cAorICoKKyAqIEZyZWUgYWxsIHBhZ2VzIGluIHRoZSBwb29sIGFuZCB1bnJlZ2lz
dGVyIHRoZSB0eXBlcyBmcm9tIHRoZSBnbG9iYWwgc2hyaW5rZXIuCisgKi8KK3ZvaWQgdHRtX3Bv
b2xfZmluaShzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wpCit7CisJdW5zaWduZWQgaW50IGksIGo7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgVFRNX05VTV9DQUNISU5HX1RZUEVTOyArK2kpCisJCWZvciAoaiA9
IDA7IGogPCBNQVhfT1JERVI7ICsraikKKwkJCXR0bV9wb29sX3R5cGVfZmluaSgmcG9vbC0+Y2Fj
aGluZ1tpXS5vcmRlcnNbal0pOworfQorRVhQT1JUX1NZTUJPTCh0dG1fcG9vbF9maW5pKTsKKwor
I2lmZGVmIENPTkZJR19ERUJVR19GUworCisvKiBEdW1wIGluZm9ybWF0aW9uIGFib3V0IHRoZSBk
aWZmZXJlbnQgcG9vbCB0eXBlcyAqLworc3RhdGljIHZvaWQgdHRtX3Bvb2xfZGVidWdmc19vcmRl
cnMoc3RydWN0IHR0bV9wb29sX3R5cGUgKnB0LAorCQkJCSAgICBzdHJ1Y3Qgc2VxX2ZpbGUgKm0p
Cit7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgTUFYX09SREVSOyArK2kp
CisJCXNlcV9wcmludGYobSwgIiAlOHUiLCB0dG1fcG9vbF90eXBlX2NvdW50KCZwdFtpXSkpOwor
CXNlcV9wcmludGYobSwgIlxuIik7Cit9CisKKy8qKgorICogdHRtX3Bvb2xfZGVidWdmcyAtIERl
YnVnZnMgZHVtcCBmdW5jdGlvbiBmb3IgYSBwb29sCisgKgorICogQHBvb2w6IHRoZSBwb29sIHRv
IGR1bXAgdGhlIGluZm9ybWF0aW9uIGZvcgorICogQG06IHNlcV9maWxlIHRvIGR1bXAgdG8KKyAq
CisgKiBNYWtlIGEgZGVidWdmcyBkdW1wIHdpdGggdGhlIHBlciBwb29sIGFuZCBnbG9iYWwgaW5m
b3JtYXRpb24uCisgKi8KK2ludCB0dG1fcG9vbF9kZWJ1Z2ZzKHN0cnVjdCB0dG1fcG9vbCAqcG9v
bCwgc3RydWN0IHNlcV9maWxlICptKQoreworCXVuc2lnbmVkIGludCBpOworCisJc3Bpbl9sb2Nr
KCZzaHJpbmtlcl9sb2NrKTsKKworCXNlcV9wcmludGYobSwgIlx0ICIpOworCWZvciAoaSA9IDA7
IGkgPCBNQVhfT1JERVI7ICsraSkKKwkJc2VxX3ByaW50ZihtLCAiIC0tLSUydS0tLSIsIGkpOwor
CXNlcV9wcmludGYobSwgIlxuIik7CisKKwlzZXFfcHJpbnRmKG0sICJ3Y1x0OiIpOworCXR0bV9w
b29sX2RlYnVnZnNfb3JkZXJzKGdsb2JhbF93cml0ZV9jb21iaW5lZCwgbSk7CisJc2VxX3ByaW50
ZihtLCAidWNcdDoiKTsKKwl0dG1fcG9vbF9kZWJ1Z2ZzX29yZGVycyhnbG9iYWxfdW5jYWNoZWQs
IG0pOworCisJZm9yIChpID0gMDsgaSA8IFRUTV9OVU1fQ0FDSElOR19UWVBFUzsgKytpKSB7CisJ
CXNlcV9wcmludGYobSwgIkRNQSAiKTsKKwkJc3dpdGNoIChpKSB7CisJCWNhc2UgdHRtX2NhY2hl
ZDoKKwkJCXNlcV9wcmludGYobSwgIlx0OiIpOworCQkJYnJlYWs7CisJCWNhc2UgdHRtX3dyaXRl
X2NvbWJpbmVkOgorCQkJc2VxX3ByaW50ZihtLCAid2NcdDoiKTsKKwkJCWJyZWFrOworCQljYXNl
IHR0bV91bmNhY2hlZDoKKwkJCXNlcV9wcmludGYobSwgInVjXHQ6Iik7CisJCQlicmVhazsKKwkJ
fQorCQl0dG1fcG9vbF9kZWJ1Z2ZzX29yZGVycyhwb29sLT5jYWNoaW5nW2ldLm9yZGVycywgbSk7
CisJfQorCisJc2VxX3ByaW50ZihtLCAiXG50b3RhbFx0OiAlOGx1IG9mICU4bHVcbiIsCisJCSAg
IGF0b21pY19sb25nX3JlYWQoJmFsbG9jYXRlZF9wYWdlcyksIHBhZ2VfcG9vbF9zaXplKTsKKwor
CXNwaW5fdW5sb2NrKCZzaHJpbmtlcl9sb2NrKTsKKworCXJldHVybiAwOworfQorRVhQT1JUX1NZ
TUJPTCh0dG1fcG9vbF9kZWJ1Z2ZzKTsKKworI2VuZGlmCisKKy8qIEFzIGxvbmcgYXMgcGFnZXMg
YXJlIGF2YWlsYWJsZSBtYWtlIHN1cmUgdG8gcmVsZWFzZSBhdCBsZWFzdCBvbmUgKi8KK3N0YXRp
YyB1bnNpZ25lZCBsb25nIHR0bV9wb29sX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpz
aHJpbmssCisJCQkJCSAgICBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQoreworCXVuc2lnbmVk
IGxvbmcgbnVtX2ZyZWVkID0gMDsKKworCWRvCisJCW51bV9mcmVlZCArPSB0dG1fcG9vbF9zaHJp
bmsoKTsKKwl3aGlsZSAoIW51bV9mcmVlZCAmJiBhdG9taWNfbG9uZ19yZWFkKCZhbGxvY2F0ZWRf
cGFnZXMpKTsKKworCXJldHVybiBudW1fZnJlZWQ7Cit9CisKKy8qIFJldHVybiB0aGUgbnVtYmVy
IG9mIHBhZ2VzIGF2YWlsYWJsZSBvciBTSFJJTktfRU1QVFkgaWYgd2UgaGF2ZSBub25lICovCitz
dGF0aWMgdW5zaWduZWQgbG9uZyB0dG1fcG9vbF9zaHJpbmtlcl9jb3VudChzdHJ1Y3Qgc2hyaW5r
ZXIgKnNocmluaywKKwkJCQkJICAgICBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQoreworCXVu
c2lnbmVkIGxvbmcgbnVtX3BhZ2VzID0gYXRvbWljX2xvbmdfcmVhZCgmYWxsb2NhdGVkX3BhZ2Vz
KTsKKworCXJldHVybiBudW1fcGFnZXMgPyBudW1fcGFnZXMgOiBTSFJJTktfRU1QVFk7Cit9CisK
Ky8qKgorICogdHRtX3Bvb2xfbWdyX2luaXQgLSBJbml0aWFsaXplIGdsb2JhbHMKKyAqCisgKiBA
bnVtX3BhZ2VzOiBkZWZhdWx0IG51bWJlciBvZiBwYWdlcworICoKKyAqIEluaXRpYWxpemUgdGhl
IGdsb2JhbCBsb2NrcyBhbmQgbGlzdHMgZm9yIHRoZSBNTSBzaHJpbmtlci4KKyAqLworaW50IHR0
bV9wb29sX21ncl9pbml0KHVuc2lnbmVkIGxvbmcgbnVtX3BhZ2VzKQoreworCXVuc2lnbmVkIGlu
dCBpOworCisJaWYgKCFwYWdlX3Bvb2xfc2l6ZSkKKwkJcGFnZV9wb29sX3NpemUgPSBudW1fcGFn
ZXM7CisKKwlzcGluX2xvY2tfaW5pdCgmc2hyaW5rZXJfbG9jayk7CisJSU5JVF9MSVNUX0hFQUQo
JnNocmlua2VyX2xpc3QpOworCisJZm9yIChpID0gMDsgaSA8IE1BWF9PUkRFUjsgKytpKSB7CisJ
CXR0bV9wb29sX3R5cGVfaW5pdCgmZ2xvYmFsX3dyaXRlX2NvbWJpbmVkW2ldLCBOVUxMLAorCQkJ
CSAgIHR0bV93cml0ZV9jb21iaW5lZCwgaSk7CisJCXR0bV9wb29sX3R5cGVfaW5pdCgmZ2xvYmFs
X3VuY2FjaGVkW2ldLCBOVUxMLCB0dG1fdW5jYWNoZWQsIGkpOworCX0KKworCW1tX3Nocmlua2Vy
LmNvdW50X29iamVjdHMgPSB0dG1fcG9vbF9zaHJpbmtlcl9jb3VudDsKKwltbV9zaHJpbmtlci5z
Y2FuX29iamVjdHMgPSB0dG1fcG9vbF9zaHJpbmtlcl9zY2FuOworCW1tX3Nocmlua2VyLnNlZWtz
ID0gMTsKKwlyZXR1cm4gcmVnaXN0ZXJfc2hyaW5rZXIoJm1tX3Nocmlua2VyKTsKK30KKworLyoq
CisgKiB0dG1fcG9vbF9tZ3JfZmluaSAtIEZpbmFsaXplIGdsb2JhbHMKKyAqCisgKiBDbGVhbnVw
IHRoZSBnbG9iYWwgcG9vbHMgYW5kIHVucmVnaXN0ZXIgdGhlIE1NIHNocmlua2VyLgorICovCit2
b2lkIHR0bV9wb29sX21ncl9maW5pKHZvaWQpCit7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgTUFYX09SREVSOyArK2kpIHsKKwkJdHRtX3Bvb2xfdHlwZV9maW5pKCZnbG9i
YWxfd3JpdGVfY29tYmluZWRbaV0pOworCQl0dG1fcG9vbF90eXBlX2ZpbmkoJmdsb2JhbF91bmNh
Y2hlZFtpXSk7CisJfQorCisJdW5yZWdpc3Rlcl9zaHJpbmtlcigmbW1fc2hyaW5rZXIpOworCVdB
Uk5fT04oIWxpc3RfZW1wdHkoJnNocmlua2VyX2xpc3QpKTsKK30KZGlmZiAtLWdpdCBhL2luY2x1
ZGUvZHJtL3R0bS90dG1fY2FjaGluZy5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9jYWNoaW5nLmgK
aW5kZXggMTYxNjI0ZGNmNmJlLi5hMGI0YTQ5ZmE0MzIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJt
L3R0bS90dG1fY2FjaGluZy5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fY2FjaGluZy5oCkBA
IC0yNSw2ICsyNSw4IEBACiAjaWZuZGVmIF9UVE1fQ0FDSElOR19IXwogI2RlZmluZSBfVFRNX0NB
Q0hJTkdfSF8KIAorI2RlZmluZSBUVE1fTlVNX0NBQ0hJTkdfVFlQRVMJMworCiBlbnVtIHR0bV9j
YWNoaW5nIHsKIAl0dG1fdW5jYWNoZWQsCiAJdHRtX3dyaXRlX2NvbWJpbmVkLApkaWZmIC0tZ2l0
IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9wb29sLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX3Bvb2wu
aApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmVhMGVkMzI2MzgwNAot
LS0gL2Rldi9udWxsCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fcG9vbC5oCkBAIC0wLDAgKzEs
ODkgQEAKKy8qCisgKiBDb3B5cmlnaHQgMjAyMCBBZHZhbmNlZCBNaWNybyBEZXZpY2VzLCBJbmMu
CisgKgorICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRv
IGFueSBwZXJzb24gb2J0YWluaW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNz
b2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCisgKiB0byBkZWFs
IGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBs
aW1pdGF0aW9uCisgKiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVi
bGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwKKyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0
aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQorICogU29mdHdh
cmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0
aW9uczoKKyAqCisgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNz
aW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgorICogYWxsIGNvcGllcyBvciBzdWJzdGFu
dGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElTIFBS
T1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IK
KyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMg
T0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0Ug
QU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQ09QWVJJR0hU
IEhPTERFUihTKSBPUiBBVVRIT1IoUykgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMg
T1IKKyAqIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1Qs
IFRPUlQgT1IgT1RIRVJXSVNFLAorICogQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVD
VElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCisgKiBPVEhFUiBERUFMSU5HUyBJ
TiBUSEUgU09GVFdBUkUuCisgKgorICogQXV0aG9yczogQ2hyaXN0aWFuIEvDtm5pZworICovCisK
KyNpZm5kZWYgX1RUTV9QQUdFX1BPT0xfSF8KKyNkZWZpbmUgX1RUTV9QQUdFX1BPT0xfSF8KKwor
I2luY2x1ZGUgPGxpbnV4L21tem9uZS5oPgorI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+CisjaW5j
bHVkZSA8ZHJtL3R0bS90dG1fY2FjaGluZy5oPgorCitzdHJ1Y3QgZGV2aWNlOworc3RydWN0IHR0
bV90dDsKK3N0cnVjdCB0dG1fcG9vbDsKK3N0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eDsKKworLyoq
CisgKiB0dG1fcG9vbF90eXBlIC0gUG9vbCBmb3IgYSBjZXJ0YWluIG1lbW9yeSB0eXBlCisgKgor
ICogQHBvb2w6IHRoZSBwb29sIHdlIGJlbG9uZyB0bywgbWlnaHQgYmUgTlVMTCBmb3IgdGhlIGds
b2JhbCBvbmVzCisgKiBAb3JkZXI6IHRoZSBhbGxvY2F0aW9uIG9yZGVyIG91ciBwYWdlcyBoYXZl
CisgKiBAY2FjaGluZzogdGhlIGNhY2hpbmcgdHlwZSBvdXIgcGFnZXMgaGF2ZQorICogQHNocmlu
a2VyX2xpc3Q6IG91ciBwbGFjZSBvbiB0aGUgZ2xvYmFsIHNocmlua2VyIGxpc3QKKyAqIEBsb2Nr
OiBwcm90ZWN0aW9uIG9mIHRoZSBwYWdlIGxpc3QKKyAqIEBwYWdlczogdGhlIGxpc3Qgb2YgcGFn
ZXMgaW4gdGhlIHBvb2wKKyAqLworc3RydWN0IHR0bV9wb29sX3R5cGUgeworCXN0cnVjdCB0dG1f
cG9vbCAqcG9vbDsKKwl1bnNpZ25lZCBpbnQgb3JkZXI7CisJZW51bSB0dG1fY2FjaGluZyBjYWNo
aW5nOworCisJc3RydWN0IGxpc3RfaGVhZCBzaHJpbmtlcl9saXN0OworCisJc3BpbmxvY2tfdCBs
b2NrOworCXN0cnVjdCBsaXN0X2hlYWQgcGFnZXM7Cit9OworCisvKioKKyAqIHR0bV9wb29sIC0g
UG9vbCBmb3IgYWxsIGNhY2hpbmcgYW5kIG9yZGVycworICoKKyAqIEB1c2VfZG1hX2FsbG9jOiBp
ZiBjb2hlcmVudCBETUEgYWxsb2NhdGlvbnMgc2hvdWxkIGJlIHVzZWQKKyAqIEB1c2VfZG1hMzI6
IGlmIEdGUF9ETUEzMiBzaG91bGQgYmUgdXNlZAorICogQGNhY2hpbmc6IHBvb2xzIGZvciBlYWNo
IGNhY2hpbmcvb3JkZXIKKyAqLworc3RydWN0IHR0bV9wb29sIHsKKwlzdHJ1Y3QgZGV2aWNlICpk
ZXY7CisKKwlib29sIHVzZV9kbWFfYWxsb2M7CisJYm9vbCB1c2VfZG1hMzI7CisKKwlzdHJ1Y3Qg
eworCQlzdHJ1Y3QgdHRtX3Bvb2xfdHlwZSBvcmRlcnNbTUFYX09SREVSXTsKKwl9IGNhY2hpbmdb
VFRNX05VTV9DQUNISU5HX1RZUEVTXTsKK307CisKK2ludCB0dG1fcG9vbF9hbGxvYyhzdHJ1Y3Qg
dHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCB0dG1fdHQgKnR0LAorCQkgICBzdHJ1Y3QgdHRtX29wZXJh
dGlvbl9jdHggKmN0eCk7Cit2b2lkIHR0bV9wb29sX2ZyZWUoc3RydWN0IHR0bV9wb29sICpwb29s
LCBzdHJ1Y3QgdHRtX3R0ICp0dCk7CisKK3ZvaWQgdHRtX3Bvb2xfaW5pdChzdHJ1Y3QgdHRtX3Bv
b2wgKnBvb2wsIHN0cnVjdCBkZXZpY2UgKmRldiwKKwkJICAgYm9vbCB1c2VfZG1hX2FsbG9jLCBi
b29sIHVzZV9kbWEzMik7Cit2b2lkIHR0bV9wb29sX2Zpbmkoc3RydWN0IHR0bV9wb29sICpwb29s
KTsKKworaW50IHR0bV9wb29sX2RlYnVnZnMoc3RydWN0IHR0bV9wb29sICpwb29sLCBzdHJ1Y3Qg
c2VxX2ZpbGUgKm0pOworCitpbnQgdHRtX3Bvb2xfbWdyX2luaXQodW5zaWduZWQgbG9uZyBudW1f
cGFnZXMpOwordm9pZCB0dG1fcG9vbF9tZ3JfZmluaSh2b2lkKTsKKworI2VuZGlmCi0tIAoyLjE3
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
