Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 23CE0298251
	for <lists+dri-devel@lfdr.de>; Sun, 25 Oct 2020 16:41:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E06426E9D0;
	Sun, 25 Oct 2020 15:41:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x543.google.com (mail-ed1-x543.google.com
 [IPv6:2a00:1450:4864:20::543])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C8A8C6E9CE
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Oct 2020 15:41:08 +0000 (UTC)
Received: by mail-ed1-x543.google.com with SMTP id l16so6877384eds.3
 for <dri-devel@lists.freedesktop.org>; Sun, 25 Oct 2020 08:41:08 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=45PQZ28v+etR+JpT32/5zbtrsBRoIp4Ouu/s1xU+ubU=;
 b=BuiC2ZBzv6rG5ZcEaMCILByZg3lLf+C+fa9Xrw+PW4CRloHQ/p55Ehwq0B7VVlcgak
 AtVC/Afp4XNlzgpkMkVFjQ18FbEAp2nD+tjeFsSBqSCrskoZ/gvJIBco/ps+3deF7ePj
 78MaDoXo2r9rAfMEhFKy4jr5+OKGsPZd0iuXXRj9yGhWCuni2yJZiLpppOmTQPtQoTYR
 BBec5+TIWwnaFshm9GN7VokzLpg4BXEIwDW8I+uyDYoPKz87dotA9mwHgJlBNOXIa+HU
 r+5XsO2iHc/twcaoCrwVTsHNWMK5VNm6BzsYihWgLBQm8Aie9YKSFejcejQ30/wWKxys
 8Y3Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=45PQZ28v+etR+JpT32/5zbtrsBRoIp4Ouu/s1xU+ubU=;
 b=EMitksteAvFOSb+4XOahWqAD3SykMhYFDxiLFgeCXr3Wh+7+CeJnvQ6OUDTxiz3KKc
 d4n3lCd67aZAOzlpHNOyCjTlG6YLbJMB8C1ofuvSkPoSIh4SoSD+mUgfpMr9TNPP2GCJ
 oN5lZ9IHlb7omuaKc20PLXfOe4676aqw85e+r1LdzB5Eo0qGg0NtKZ/FZg84AF0CG437
 9n2xtSShXVRSUOOrX+ntBJSMi61Un21e1dbkNJF40NS65cINBsdrE3eAllZ/nCzOSS4G
 lf6Fgjkr460DtAxmsrxIG7DYUfLmIK8gFQ2tTPZUr5tdi/9v3md/QCRdvymyU8aoKGsH
 3syw==
X-Gm-Message-State: AOAM531GZd04li0D/RhOtJN4RIOPmi8X6bce3/LLAL8Ye2OEEXIoDKIU
 ef1OqyK2E9UAPrpAPqEhj1k=
X-Google-Smtp-Source: ABdhPJyQSLbDx+RmMIEpyu//fZLkyUJU+cq0xMoXmeP/LuV8xSamKdvoAuh7gtDuW3ehT8PXA+8QMA==
X-Received: by 2002:a50:af21:: with SMTP id g30mr11556955edd.46.1603640466994; 
 Sun, 25 Oct 2020 08:41:06 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:d13a:1a76:8d61:cf5c])
 by smtp.gmail.com with ESMTPSA id g8sm4141931ejp.73.2020.10.25.08.41.06
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Sun, 25 Oct 2020 08:41:06 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: Madhav.Chauhan@amd.com,
	dri-devel@lists.freedesktop.org
Subject: [PATCH 04/13] drm/ttm: merge ttm_dma_tt back into ttm_tt
Date: Sun, 25 Oct 2020 16:40:51 +0100
Message-Id: <20201025154100.16400-5-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201025154100.16400-1-christian.koenig@amd.com>
References: <20201025154100.16400-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Ray.Huang@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SXQgbWFrZXMgbm8gZGlmZmVyZW5jZSB0byBrbWFsbG9jIGlmIHRoZSBzdHJ1Y3R1cmUKaXMgNDgg
b3IgNjQgYnl0ZXMgaW4gc2l6ZS4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZ21jLmMgICAgfCAxMCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRn
cHVfdHRtLmMgICAgfCAxNCArKystLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV92bS5jICAgICB8ICA3ICstLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5j
ICAgICAgIHwgMTIgKystLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfbWVtLmMg
ICAgICB8ICA4ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfbWVtLmggICAg
ICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3NnZG1hLmMgICAgfCAg
NiArLS0KIGRyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5jICAgICAgICAgICAgICB8ICAyICst
CiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90dG0uYyAgICAgICAgfCAgOCArKy0tCiBk
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jICAgICAgICAgICAgICAgfCAgMiArLQogZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jICAgICAgIHwgMzAgKysrKysrLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9jX2RtYS5jICAgfCA0NCArKysrKysrKy0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fdHQuYyAgICAgICAgICAgICAgIHwgNTUg
KysrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRt
X2J1ZmZlci5jIHwgMjYgKysrKystLS0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9j
LmggICAgICAgICAgIHwgMTIgKystLS0KIGluY2x1ZGUvZHJtL3R0bS90dG1fdHQuaCAgICAgICAg
ICAgICAgICAgICB8IDM1ICsrKystLS0tLS0tLS0tCiAxNiBmaWxlcyBjaGFuZ2VkLCAxMTkgaW5z
ZXJ0aW9ucygrKSwgMTU2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9nbWMuYwppbmRleCAzYzVhZDY5ZWZmMTkuLjBlMzUwMjNiNTcwMyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2dtYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9nbWMuYwpAQCAtNDUsMTIgKzQ1LDEwIEBAIHZvaWQgYW1k
Z3B1X2dtY19nZXRfcGRlX2Zvcl9ibyhzdHJ1Y3QgYW1kZ3B1X2JvICpibywgaW50IGxldmVsLAog
CQkJICAgICAgIHVpbnQ2NF90ICphZGRyLCB1aW50NjRfdCAqZmxhZ3MpCiB7CiAJc3RydWN0IGFt
ZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRncHVfdHRtX2FkZXYoYm8tPnRiby5iZGV2KTsKLQlzdHJ1
Y3QgdHRtX2RtYV90dCAqdHRtOwogCiAJc3dpdGNoIChiby0+dGJvLm1lbS5tZW1fdHlwZSkgewog
CWNhc2UgVFRNX1BMX1RUOgotCQl0dG0gPSBjb250YWluZXJfb2YoYm8tPnRiby50dG0sIHN0cnVj
dCB0dG1fZG1hX3R0LCB0dG0pOwotCQkqYWRkciA9IHR0bS0+ZG1hX2FkZHJlc3NbMF07CisJCSph
ZGRyID0gYm8tPnRiby50dG0tPmRtYV9hZGRyZXNzWzBdOwogCQlicmVhazsKIAljYXNlIFRUTV9Q
TF9WUkFNOgogCQkqYWRkciA9IGFtZGdwdV9ib19ncHVfb2Zmc2V0KGJvKTsKQEAgLTEyMiwxNiAr
MTIwLDE0IEBAIGludCBhbWRncHVfZ21jX3NldF9wdGVfcGRlKHN0cnVjdCBhbWRncHVfZGV2aWNl
ICphZGV2LCB2b2lkICpjcHVfcHRfYWRkciwKIHVpbnQ2NF90IGFtZGdwdV9nbWNfYWdwX2FkZHIo
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIHsKIAlzdHJ1Y3QgYW1kZ3B1X2RldmljZSAq
YWRldiA9IGFtZGdwdV90dG1fYWRldihiby0+YmRldik7Ci0Jc3RydWN0IHR0bV9kbWFfdHQgKnR0
bTsKIAogCWlmIChiby0+bnVtX3BhZ2VzICE9IDEgfHwgYm8tPnR0bS0+Y2FjaGluZyA9PSB0dG1f
Y2FjaGVkKQogCQlyZXR1cm4gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUOwogCi0JdHRtID0gY29u
dGFpbmVyX29mKGJvLT50dG0sIHN0cnVjdCB0dG1fZG1hX3R0LCB0dG0pOwotCWlmICh0dG0tPmRt
YV9hZGRyZXNzWzBdICsgUEFHRV9TSVpFID49IGFkZXYtPmdtYy5hZ3Bfc2l6ZSkKKwlpZiAoYm8t
PnR0bS0+ZG1hX2FkZHJlc3NbMF0gKyBQQUdFX1NJWkUgPj0gYWRldi0+Z21jLmFncF9zaXplKQog
CQlyZXR1cm4gQU1ER1BVX0JPX0lOVkFMSURfT0ZGU0VUOwogCi0JcmV0dXJuIGFkZXYtPmdtYy5h
Z3Bfc3RhcnQgKyB0dG0tPmRtYV9hZGRyZXNzWzBdOworCXJldHVybiBhZGV2LT5nbWMuYWdwX3N0
YXJ0ICsgYm8tPnR0bS0+ZG1hX2FkZHJlc3NbMF07CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jIGIvZHJpdmVycy9ncHUvZHJtL2Ft
ZC9hbWRncHUvYW1kZ3B1X3R0bS5jCmluZGV4IDBhMzI3MGYyNWU0MC4uYmVhY2QwMDIyMWQ4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0bS5jCkBAIC0yOTQsMTEgKzI5NCw5
IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X3R0bV9tYXBfYnVmZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sCiAJY3B1X2FkZHIgPSAmam9iLT5pYnNbMF0ucHRyW251bV9kd107CiAKIAlpZiAo
bWVtLT5tZW1fdHlwZSA9PSBUVE1fUExfVFQpIHsKLQkJc3RydWN0IHR0bV9kbWFfdHQgKmRtYTsK
IAkJZG1hX2FkZHJfdCAqZG1hX2FkZHJlc3M7CiAKLQkJZG1hID0gY29udGFpbmVyX29mKGJvLT50
dG0sIHN0cnVjdCB0dG1fZG1hX3R0LCB0dG0pOwotCQlkbWFfYWRkcmVzcyA9ICZkbWEtPmRtYV9h
ZGRyZXNzW29mZnNldCA+PiBQQUdFX1NISUZUXTsKKwkJZG1hX2FkZHJlc3MgPSAmYm8tPnR0bS0+
ZG1hX2FkZHJlc3Nbb2Zmc2V0ID4+IFBBR0VfU0hJRlRdOwogCQlyID0gYW1kZ3B1X2dhcnRfbWFw
KGFkZXYsIDAsIG51bV9wYWdlcywgZG1hX2FkZHJlc3MsIGZsYWdzLAogCQkJCSAgICBjcHVfYWRk
cik7CiAJCWlmIChyKQpAQCAtODQxLDcgKzgzOSw3IEBAIHVpbnQ2NF90IGFtZGdwdV90dG1fZG9t
YWluX3N0YXJ0KHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LCB1aW50MzJfdCB0eXBlKQogICog
VFRNIGJhY2tlbmQgZnVuY3Rpb25zLgogICovCiBzdHJ1Y3QgYW1kZ3B1X3R0bV90dCB7Ci0Jc3Ry
dWN0IHR0bV9kbWFfdHQJdHRtOworCXN0cnVjdCB0dG1fdHQJdHRtOwogCXN0cnVjdCBkcm1fZ2Vt
X29iamVjdAkqZ29iajsKIAl1NjQJCQlvZmZzZXQ7CiAJdWludDY0X3QJCXVzZXJwdHI7CkBAIC0x
MjkyLDcgKzEyOTAsNyBAQCBzdGF0aWMgdm9pZCBhbWRncHVfdHRtX2JhY2tlbmRfdW5iaW5kKHN0
cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCXIgPSBhbWRncHVfZ2FydF91bmJpbmQoYWRldiwg
Z3R0LT5vZmZzZXQsIHR0bS0+bnVtX3BhZ2VzKTsKIAlpZiAocikKIAkJRFJNX0VSUk9SKCJmYWls
ZWQgdG8gdW5iaW5kICV1IHBhZ2VzIGF0IDB4JTA4bGxYXG4iLAotCQkJICBndHQtPnR0bS50dG0u
bnVtX3BhZ2VzLCBndHQtPm9mZnNldCk7CisJCQkgIGd0dC0+dHRtLm51bV9wYWdlcywgZ3R0LT5v
ZmZzZXQpOwogCWd0dC0+Ym91bmQgPSBmYWxzZTsKIH0KIApAQCAtMTMwNiw3ICsxMzA0LDcgQEAg
c3RhdGljIHZvaWQgYW1kZ3B1X3R0bV9iYWNrZW5kX2Rlc3Ryb3koc3RydWN0IHR0bV9ib19kZXZp
Y2UgKmJkZXYsCiAJaWYgKGd0dC0+dXNlcnRhc2spCiAJCXB1dF90YXNrX3N0cnVjdChndHQtPnVz
ZXJ0YXNrKTsKIAotCXR0bV9kbWFfdHRfZmluaSgmZ3R0LT50dG0pOworCXR0bV90dF9maW5pKCZn
dHQtPnR0bSk7CiAJa2ZyZWUoZ3R0KTsKIH0KIApAQCAtMTM0MCw3ICsxMzM4LDcgQEAgc3RhdGlj
IHN0cnVjdCB0dG1fdHQgKmFtZGdwdV90dG1fdHRfY3JlYXRlKHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sCiAJCWtmcmVlKGd0dCk7CiAJCXJldHVybiBOVUxMOwogCX0KLQlyZXR1cm4gJmd0
dC0+dHRtLnR0bTsKKwlyZXR1cm4gJmd0dC0+dHRtOwogfQogCiAvKioKQEAgLTE1MDcsNyArMTUw
NSw3IEBAIGJvb2wgYW1kZ3B1X3R0bV90dF9hZmZlY3RfdXNlcnB0cihzdHJ1Y3QgdHRtX3R0ICp0
dG0sIHVuc2lnbmVkIGxvbmcgc3RhcnQsCiAJLyogUmV0dXJuIGZhbHNlIGlmIG5vIHBhcnQgb2Yg
dGhlIHR0bV90dCBvYmplY3QgbGllcyB3aXRoaW4KIAkgKiB0aGUgcmFuZ2UKIAkgKi8KLQlzaXpl
ID0gKHVuc2lnbmVkIGxvbmcpZ3R0LT50dG0udHRtLm51bV9wYWdlcyAqIFBBR0VfU0laRTsKKwlz
aXplID0gKHVuc2lnbmVkIGxvbmcpZ3R0LT50dG0ubnVtX3BhZ2VzICogUEFHRV9TSVpFOwogCWlm
IChndHQtPnVzZXJwdHIgPiBlbmQgfHwgZ3R0LT51c2VycHRyICsgc2l6ZSA8PSBzdGFydCkKIAkJ
cmV0dXJuIGZhbHNlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCmluZGV4
IDNlNjI0MzYyMzA4Mi4uZjBlNmZhZmQwOTM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
YW1kL2FtZGdwdS9hbWRncHVfdm0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfdm0uYwpAQCAtMTc4MSw3ICsxNzgxLDYgQEAgaW50IGFtZGdwdV92bV9ib191cGRhdGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBhbWRncHVfYm9fdmEgKmJvX3ZhLAog
CQlyZXN2ID0gdm0tPnJvb3QuYmFzZS5iby0+dGJvLmJhc2UucmVzdjsKIAl9IGVsc2UgewogCQlz
dHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiA9ICZiby0+dGJvLmJhc2U7Ci0JCXN0cnVjdCB0dG1f
ZG1hX3R0ICp0dG07CiAKIAkJcmVzdiA9IGJvLT50Ym8uYmFzZS5yZXN2OwogCQlpZiAob2JqLT5p
bXBvcnRfYXR0YWNoICYmIGJvX3ZhLT5pc194Z21pKSB7CkBAIC0xNzk0LDEwICsxNzkzLDggQEAg
aW50IGFtZGdwdV92bV9ib191cGRhdGUoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVj
dCBhbWRncHVfYm9fdmEgKmJvX3ZhLAogCQl9CiAJCW1lbSA9ICZiby0+dGJvLm1lbTsKIAkJbm9k
ZXMgPSBtZW0tPm1tX25vZGU7Ci0JCWlmIChtZW0tPm1lbV90eXBlID09IFRUTV9QTF9UVCkgewot
CQkJdHRtID0gY29udGFpbmVyX29mKGJvLT50Ym8udHRtLCBzdHJ1Y3QgdHRtX2RtYV90dCwgdHRt
KTsKLQkJCXBhZ2VzX2FkZHIgPSB0dG0tPmRtYV9hZGRyZXNzOwotCQl9CisJCWlmIChtZW0tPm1l
bV90eXBlID09IFRUTV9QTF9UVCkKKwkJCXBhZ2VzX2FkZHIgPSBiby0+dGJvLnR0bS0+ZG1hX2Fk
ZHJlc3M7CiAJfQogCiAJaWYgKGJvKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMK
aW5kZXggMDZhMWY0YzRlOTZlLi43NWZkZGJjZDc4MzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9ub3V2ZWF1L25vdXZlYXVfYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2JvLmMKQEAgLTU0Nyw3ICs1NDcsNyBAQCB2b2lkCiBub3V2ZWF1X2JvX3N5bmNfZm9y
X2RldmljZShzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibykKIHsKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0g
KmRybSA9IG5vdXZlYXVfYmRldihudmJvLT5iby5iZGV2KTsKLQlzdHJ1Y3QgdHRtX2RtYV90dCAq
dHRtX2RtYSA9IChzdHJ1Y3QgdHRtX2RtYV90dCAqKW52Ym8tPmJvLnR0bTsKKwlzdHJ1Y3QgdHRt
X3R0ICp0dG1fZG1hID0gKHN0cnVjdCB0dG1fdHQgKiludmJvLT5iby50dG07CiAJaW50IGk7CiAK
IAlpZiAoIXR0bV9kbWEpCkBAIC01NTcsNyArNTU3LDcgQEAgbm91dmVhdV9ib19zeW5jX2Zvcl9k
ZXZpY2Uoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8pCiAJaWYgKG52Ym8tPmZvcmNlX2NvaGVyZW50
KQogCQlyZXR1cm47CiAKLQlmb3IgKGkgPSAwOyBpIDwgdHRtX2RtYS0+dHRtLm51bV9wYWdlczsg
aSsrKQorCWZvciAoaSA9IDA7IGkgPCB0dG1fZG1hLT5udW1fcGFnZXM7IGkrKykKIAkJZG1hX3N5
bmNfc2luZ2xlX2Zvcl9kZXZpY2UoZHJtLT5kZXYtPmRldiwKIAkJCQkJICAgdHRtX2RtYS0+ZG1h
X2FkZHJlc3NbaV0sCiAJCQkJCSAgIFBBR0VfU0laRSwgRE1BX1RPX0RFVklDRSk7CkBAIC01Njcs
NyArNTY3LDcgQEAgdm9pZAogbm91dmVhdV9ib19zeW5jX2Zvcl9jcHUoc3RydWN0IG5vdXZlYXVf
Ym8gKm52Ym8pCiB7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYobnZi
by0+Ym8uYmRldik7Ci0Jc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEgPSAoc3RydWN0IHR0bV9k
bWFfdHQgKiludmJvLT5iby50dG07CisJc3RydWN0IHR0bV90dCAqdHRtX2RtYSA9IChzdHJ1Y3Qg
dHRtX3R0ICopbnZiby0+Ym8udHRtOwogCWludCBpOwogCiAJaWYgKCF0dG1fZG1hKQpAQCAtNTc3
LDcgKzU3Nyw3IEBAIG5vdXZlYXVfYm9fc3luY19mb3JfY3B1KHN0cnVjdCBub3V2ZWF1X2JvICpu
dmJvKQogCWlmIChudmJvLT5mb3JjZV9jb2hlcmVudCkKIAkJcmV0dXJuOwogCi0JZm9yIChpID0g
MDsgaSA8IHR0bV9kbWEtPnR0bS5udW1fcGFnZXM7IGkrKykKKwlmb3IgKGkgPSAwOyBpIDwgdHRt
X2RtYS0+bnVtX3BhZ2VzOyBpKyspCiAJCWRtYV9zeW5jX3NpbmdsZV9mb3JfY3B1KGRybS0+ZGV2
LT5kZXYsIHR0bV9kbWEtPmRtYV9hZGRyZXNzW2ldLAogCQkJCQlQQUdFX1NJWkUsIERNQV9GUk9N
X0RFVklDRSk7CiB9CkBAIC0xMzA5LDcgKzEzMDksNyBAQCBzdGF0aWMgaW50CiBub3V2ZWF1X3R0
bV90dF9wb3B1bGF0ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJCXN0cnVjdCB0dG1f
dHQgKnR0bSwgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpCiB7Ci0Jc3RydWN0IHR0bV9k
bWFfdHQgKnR0bV9kbWEgPSAodm9pZCAqKXR0bTsKKwlzdHJ1Y3QgdHRtX3R0ICp0dG1fZG1hID0g
KHZvaWQgKil0dG07CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm07CiAJc3RydWN0IGRldmljZSAq
ZGV2OwogCWJvb2wgc2xhdmUgPSAhISh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1NH
KTsKQEAgLTEzNDUsNyArMTM0NSw3IEBAIHN0YXRpYyB2b2lkCiBub3V2ZWF1X3R0bV90dF91bnBv
cHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCQkJICBzdHJ1Y3QgdHRtX3R0ICp0
dG0pCiB7Ci0Jc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEgPSAodm9pZCAqKXR0bTsKKwlzdHJ1
Y3QgdHRtX3R0ICp0dG1fZG1hID0gKHZvaWQgKil0dG07CiAJc3RydWN0IG5vdXZlYXVfZHJtICpk
cm07CiAJc3RydWN0IGRldmljZSAqZGV2OwogCWJvb2wgc2xhdmUgPSAhISh0dG0tPnBhZ2VfZmxh
Z3MgJiBUVE1fUEFHRV9GTEFHX1NHKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfbWVtLmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X21lbS5j
CmluZGV4IDI2OWQ4NzA3YWNjMy4uMGE0YzA0YWFhZDMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vbm91dmVhdS9ub3V2ZWF1X21lbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L25vdXZlYXVfbWVtLmMKQEAgLTkyLDcgKzkyLDcgQEAgbm91dmVhdV9tZW1fZmluaShzdHJ1Y3Qg
bm91dmVhdV9tZW0gKm1lbSkKIH0KIAogaW50Ci1ub3V2ZWF1X21lbV9ob3N0KHN0cnVjdCB0dG1f
cmVzb3VyY2UgKnJlZywgc3RydWN0IHR0bV9kbWFfdHQgKnR0KQorbm91dmVhdV9tZW1faG9zdChz
dHJ1Y3QgdHRtX3Jlc291cmNlICpyZWcsIHN0cnVjdCB0dG1fdHQgKnR0KQogewogCXN0cnVjdCBu
b3V2ZWF1X21lbSAqbWVtID0gbm91dmVhdV9tZW0ocmVnKTsKIAlzdHJ1Y3Qgbm91dmVhdV9jbGkg
KmNsaSA9IG1lbS0+Y2xpOwpAQCAtMTE2LDggKzExNiwxMCBAQCBub3V2ZWF1X21lbV9ob3N0KHN0
cnVjdCB0dG1fcmVzb3VyY2UgKnJlZywgc3RydWN0IHR0bV9kbWFfdHQgKnR0KQogCQltZW0tPmNv
bXAgPSAwOwogCX0KIAotCWlmICh0dC0+dHRtLnNnKSBhcmdzLnNnbCA9IHR0LT50dG0uc2ctPnNn
bDsKLQllbHNlICAgICAgICAgICAgYXJncy5kbWEgPSB0dC0+ZG1hX2FkZHJlc3M7CisJaWYgKHR0
LT5zZykKKwkJYXJncy5zZ2wgPSB0dC0+c2ctPnNnbDsKKwllbHNlCisJCWFyZ3MuZG1hID0gdHQt
PmRtYV9hZGRyZXNzOwogCiAJbXV0ZXhfbG9jaygmZHJtLT5tYXN0ZXIubG9jayk7CiAJY2xpLT5i
YXNlLnN1cGVyID0gdHJ1ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25v
dXZlYXVfbWVtLmggYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X21lbS5oCmluZGV4
IDNmZTFjZmVkNTdhMS4uN2RmMzg0OGU4NWFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
bm91dmVhdS9ub3V2ZWF1X21lbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfbWVtLmgKQEAgLTEsNyArMSw3IEBACiAjaWZuZGVmIF9fTk9VVkVBVV9NRU1fSF9fCiAjZGVm
aW5lIF9fTk9VVkVBVV9NRU1fSF9fCiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fYXBpLmg+Ci1z
dHJ1Y3QgdHRtX2RtYV90dDsKK3N0cnVjdCB0dG1fdHQ7CiAKICNpbmNsdWRlIDxudmlmL21lbS5o
PgogI2luY2x1ZGUgPG52aWYvdm1tLmg+CkBAIC0yNCw3ICsyNCw3IEBAIGludCBub3V2ZWF1X21l
bV9uZXcoc3RydWN0IG5vdXZlYXVfY2xpICosIHU4IGtpbmQsIHU4IGNvbXAsCiAJCSAgICBzdHJ1
Y3QgdHRtX3Jlc291cmNlICopOwogdm9pZCBub3V2ZWF1X21lbV9kZWwoc3RydWN0IHR0bV9yZXNv
dXJjZSAqKTsKIGludCBub3V2ZWF1X21lbV92cmFtKHN0cnVjdCB0dG1fcmVzb3VyY2UgKiwgYm9v
bCBjb250aWcsIHU4IHBhZ2UpOwotaW50IG5vdXZlYXVfbWVtX2hvc3Qoc3RydWN0IHR0bV9yZXNv
dXJjZSAqLCBzdHJ1Y3QgdHRtX2RtYV90dCAqKTsKK2ludCBub3V2ZWF1X21lbV9ob3N0KHN0cnVj
dCB0dG1fcmVzb3VyY2UgKiwgc3RydWN0IHR0bV90dCAqKTsKIHZvaWQgbm91dmVhdV9tZW1fZmlu
aShzdHJ1Y3Qgbm91dmVhdV9tZW0gKik7CiBpbnQgbm91dmVhdV9tZW1fbWFwKHN0cnVjdCBub3V2
ZWF1X21lbSAqLCBzdHJ1Y3QgbnZpZl92bW0gKiwgc3RydWN0IG52aWZfdm1hICopOwogI2VuZGlm
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3NnZG1hLmMgYi9k
cml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3NnZG1hLmMKaW5kZXggY2Q2ZmRlYmFlNzk1
Li5hMmUyM2ZkNDkwNmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfc2dkbWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3NnZG1hLmMK
QEAgLTExLDcgKzExLDcgQEAgc3RydWN0IG5vdXZlYXVfc2dkbWFfYmUgewogCS8qIHRoaXMgaGFz
IHRvIGJlIHRoZSBmaXJzdCBmaWVsZCBzbyBwb3B1bGF0ZS91bnBvcHVsYXRlZCBpbgogCSAqIG5v
dXZlX2JvLmMgd29ya3MgcHJvcGVybHksIG90aGVyd2lzZSBoYXZlIHRvIG1vdmUgdGhlbSBoZXJl
CiAJICovCi0Jc3RydWN0IHR0bV9kbWFfdHQgdHRtOworCXN0cnVjdCB0dG1fdHQgdHRtOwogCXN0
cnVjdCBub3V2ZWF1X21lbSAqbWVtOwogfTsKIApAQCAtMjMsNyArMjMsNyBAQCBub3V2ZWF1X3Nn
ZG1hX2Rlc3Ryb3koc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fdHQgKnR0
bSkKIAlpZiAodHRtKSB7CiAJCW5vdXZlYXVfc2dkbWFfdW5iaW5kKGJkZXYsIHR0bSk7CiAJCXR0
bV90dF9kZXN0cm95X2NvbW1vbihiZGV2LCB0dG0pOwotCQl0dG1fZG1hX3R0X2ZpbmkoJm52YmUt
PnR0bSk7CisJCXR0bV90dF9maW5pKCZudmJlLT50dG0pOwogCQlrZnJlZShudmJlKTsKIAl9CiB9
CkBAIC04OCw1ICs4OCw1IEBAIG5vdXZlYXVfc2dkbWFfY3JlYXRlX3R0bShzdHJ1Y3QgdHRtX2J1
ZmZlcl9vYmplY3QgKmJvLCB1aW50MzJfdCBwYWdlX2ZsYWdzKQogCQlrZnJlZShudmJlKTsKIAkJ
cmV0dXJuIE5VTEw7CiAJfQotCXJldHVybiAmbnZiZS0+dHRtLnR0bTsKKwlyZXR1cm4gJm52YmUt
PnR0bTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5jIGIvZHJp
dmVycy9ncHUvZHJtL3F4bC9xeGxfdHRtLmMKaW5kZXggYjUyYTQ1NjNiNDdiLi45NjA5ZWViNTI4
MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9xeGwvcXhsX3R0bS5jCkBAIC0xMTYsNyArMTE2LDcgQEAgc3RhdGljIHN0cnVj
dCB0dG1fdHQgKnF4bF90dG1fdHRfY3JlYXRlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8s
CiAJdHRtID0ga3phbGxvYyhzaXplb2Yoc3RydWN0IHR0bV90dCksIEdGUF9LRVJORUwpOwogCWlm
ICh0dG0gPT0gTlVMTCkKIAkJcmV0dXJuIE5VTEw7Ci0JaWYgKHR0bV90dF9pbml0KHR0bSwgYm8s
IHBhZ2VfZmxhZ3MsIHR0bV9jYWNoZWQpKSB7CisJaWYgKHR0bV9kbWFfdHRfaW5pdCh0dG0sIGJv
LCBwYWdlX2ZsYWdzLCB0dG1fY2FjaGVkKSkgewogCQlrZnJlZSh0dG0pOwogCQlyZXR1cm4gTlVM
TDsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90dG0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3R0bS5jCmluZGV4IGM1MWRjYmM4MThlZi4u
MGE2ZDdlYTg0N2RiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90
dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90dG0uYwpAQCAtNDM3LDcg
KzQzNyw3IEBAIHN0YXRpYyBpbnQgcmFkZW9uX3R0bV9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRt
X2JvX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV9yZXNvCiAgKiBUVE0gYmFja2VuZCBmdW5jdGlv
bnMuCiAgKi8KIHN0cnVjdCByYWRlb25fdHRtX3R0IHsKLQlzdHJ1Y3QgdHRtX2RtYV90dAkJdHRt
OworCXN0cnVjdCB0dG1fdHQJCXR0bTsKIAl1NjQJCQkJb2Zmc2V0OwogCiAJdWludDY0X3QJCQl1
c2VycHRyOwpAQCAtNjAyLDcgKzYwMiw3IEBAIHN0YXRpYyB2b2lkIHJhZGVvbl90dG1fYmFja2Vu
ZF9kZXN0cm95KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX3R0CiAJcmFk
ZW9uX3R0bV9iYWNrZW5kX3VuYmluZChiZGV2LCB0dG0pOwogCXR0bV90dF9kZXN0cm95X2NvbW1v
bihiZGV2LCB0dG0pOwogCi0JdHRtX2RtYV90dF9maW5pKCZndHQtPnR0bSk7CisJdHRtX3R0X2Zp
bmkoJmd0dC0+dHRtKTsKIAlrZnJlZShndHQpOwogfQogCkBAIC02NDAsNyArNjQwLDcgQEAgc3Rh
dGljIHN0cnVjdCB0dG1fdHQgKnJhZGVvbl90dG1fdHRfY3JlYXRlKHN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8sCiAJCWtmcmVlKGd0dCk7CiAJCXJldHVybiBOVUxMOwogCX0KLQlyZXR1cm4g
Jmd0dC0+dHRtLnR0bTsKKwlyZXR1cm4gJmd0dC0+dHRtOwogfQogCiBzdGF0aWMgc3RydWN0IHJh
ZGVvbl90dG1fdHQgKnJhZGVvbl90dG1fdHRfdG9fZ3R0KHN0cnVjdCByYWRlb25fZGV2aWNlICpy
ZGV2LApAQCAtNjUzLDcgKzY1Myw3IEBAIHN0YXRpYyBzdHJ1Y3QgcmFkZW9uX3R0bV90dCAqcmFk
ZW9uX3R0bV90dF90b19ndHQoc3RydWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYsCiAKIAlpZiAoIXR0
bSkKIAkJcmV0dXJuIE5VTEw7Ci0JcmV0dXJuIGNvbnRhaW5lcl9vZih0dG0sIHN0cnVjdCByYWRl
b25fdHRtX3R0LCB0dG0udHRtKTsKKwlyZXR1cm4gY29udGFpbmVyX29mKHR0bSwgc3RydWN0IHJh
ZGVvbl90dG1fdHQsIHR0bSk7CiB9CiAKIHN0YXRpYyBpbnQgcmFkZW9uX3R0bV90dF9wb3B1bGF0
ZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCmluZGV4IDViNDEx
MjUyYTg1Ny4uNDBjNzJhMGY5MzI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKQEAgLTExOTIsNyArMTE5
Miw3IEBAIHNpemVfdCB0dG1fYm9fZG1hX2FjY19zaXplKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpi
ZGV2LAogCiAJc2l6ZSArPSB0dG1fcm91bmRfcG90KHN0cnVjdF9zaXplKTsKIAlzaXplICs9IHR0
bV9yb3VuZF9wb3QobnBhZ2VzICogKDIqc2l6ZW9mKHZvaWQgKikgKyBzaXplb2YoZG1hX2FkZHJf
dCkpKTsKLQlzaXplICs9IHR0bV9yb3VuZF9wb3Qoc2l6ZW9mKHN0cnVjdCB0dG1fZG1hX3R0KSk7
CisJc2l6ZSArPSB0dG1fcm91bmRfcG90KHNpemVvZihzdHJ1Y3QgdHRtX3R0KSk7CiAJcmV0dXJu
IHNpemU7CiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib19kbWFfYWNjX3NpemUpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jIGIvZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fcGFnZV9hbGxvYy5jCmluZGV4IDY2MWI3NWQxOWNhZC4uMjllNmMyOWFkNjBlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvYy5jCkBAIC0xMDgxLDI4ICsxMDgxLDI4IEBA
IHZvaWQgdHRtX3Bvb2xfdW5wb3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG0pCiB9CiBFWFBPUlRf
U1lNQk9MKHR0bV9wb29sX3VucG9wdWxhdGUpOwogCi1pbnQgdHRtX3BvcHVsYXRlX2FuZF9tYXBf
cGFnZXMoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHRtX2RtYV90dCAqdHQsCitpbnQgdHRt
X3BvcHVsYXRlX2FuZF9tYXBfcGFnZXMoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHRtX3R0
ICp0dCwKIAkJCQkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpCiB7CiAJdW5zaWduZWQg
aSwgajsKIAlpbnQgcjsKIAotCXIgPSB0dG1fcG9vbF9wb3B1bGF0ZSgmdHQtPnR0bSwgY3R4KTsK
KwlyID0gdHRtX3Bvb2xfcG9wdWxhdGUodHQsIGN0eCk7CiAJaWYgKHIpCiAJCXJldHVybiByOwog
Ci0JZm9yIChpID0gMDsgaSA8IHR0LT50dG0ubnVtX3BhZ2VzOyArK2kpIHsKLQkJc3RydWN0IHBh
Z2UgKnAgPSB0dC0+dHRtLnBhZ2VzW2ldOworCWZvciAoaSA9IDA7IGkgPCB0dC0+bnVtX3BhZ2Vz
OyArK2kpIHsKKwkJc3RydWN0IHBhZ2UgKnAgPSB0dC0+cGFnZXNbaV07CiAJCXNpemVfdCBudW1f
cGFnZXMgPSAxOwogCi0JCWZvciAoaiA9IGkgKyAxOyBqIDwgdHQtPnR0bS5udW1fcGFnZXM7ICsr
aikgewotCQkJaWYgKCsrcCAhPSB0dC0+dHRtLnBhZ2VzW2pdKQorCQlmb3IgKGogPSBpICsgMTsg
aiA8IHR0LT5udW1fcGFnZXM7ICsraikgeworCQkJaWYgKCsrcCAhPSB0dC0+cGFnZXNbal0pCiAJ
CQkJYnJlYWs7CiAKIAkJCSsrbnVtX3BhZ2VzOwogCQl9CiAKLQkJdHQtPmRtYV9hZGRyZXNzW2ld
ID0gZG1hX21hcF9wYWdlKGRldiwgdHQtPnR0bS5wYWdlc1tpXSwKKwkJdHQtPmRtYV9hZGRyZXNz
W2ldID0gZG1hX21hcF9wYWdlKGRldiwgdHQtPnBhZ2VzW2ldLAogCQkJCQkJICAwLCBudW1fcGFn
ZXMgKiBQQUdFX1NJWkUsCiAJCQkJCQkgIERNQV9CSURJUkVDVElPTkFMKTsKIAkJaWYgKGRtYV9t
YXBwaW5nX2Vycm9yKGRldiwgdHQtPmRtYV9hZGRyZXNzW2ldKSkgewpAQCAtMTExMSw3ICsxMTEx
LDcgQEAgaW50IHR0bV9wb3B1bGF0ZV9hbmRfbWFwX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwg
c3RydWN0IHR0bV9kbWFfdHQgKnR0LAogCQkJCQkgICAgICAgUEFHRV9TSVpFLCBETUFfQklESVJF
Q1RJT05BTCk7CiAJCQkJdHQtPmRtYV9hZGRyZXNzW2ldID0gMDsKIAkJCX0KLQkJCXR0bV9wb29s
X3VucG9wdWxhdGUoJnR0LT50dG0pOworCQkJdHRtX3Bvb2xfdW5wb3B1bGF0ZSh0dCk7CiAJCQly
ZXR1cm4gLUVGQVVMVDsKIAkJfQogCkBAIC0xMTI0LDIxICsxMTI0LDIxIEBAIGludCB0dG1fcG9w
dWxhdGVfYW5kX21hcF9wYWdlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCB0dG1fZG1hX3R0
ICp0dCwKIH0KIEVYUE9SVF9TWU1CT0wodHRtX3BvcHVsYXRlX2FuZF9tYXBfcGFnZXMpOwogCi12
b2lkIHR0bV91bm1hcF9hbmRfdW5wb3B1bGF0ZV9wYWdlcyhzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0
cnVjdCB0dG1fZG1hX3R0ICp0dCkKK3ZvaWQgdHRtX3VubWFwX2FuZF91bnBvcHVsYXRlX3BhZ2Vz
KHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHR0bV90dCAqdHQpCiB7CiAJdW5zaWduZWQgaSwg
ajsKIAotCWZvciAoaSA9IDA7IGkgPCB0dC0+dHRtLm51bV9wYWdlczspIHsKLQkJc3RydWN0IHBh
Z2UgKnAgPSB0dC0+dHRtLnBhZ2VzW2ldOworCWZvciAoaSA9IDA7IGkgPCB0dC0+bnVtX3BhZ2Vz
OykgeworCQlzdHJ1Y3QgcGFnZSAqcCA9IHR0LT5wYWdlc1tpXTsKIAkJc2l6ZV90IG51bV9wYWdl
cyA9IDE7CiAKLQkJaWYgKCF0dC0+ZG1hX2FkZHJlc3NbaV0gfHwgIXR0LT50dG0ucGFnZXNbaV0p
IHsKKwkJaWYgKCF0dC0+ZG1hX2FkZHJlc3NbaV0gfHwgIXR0LT5wYWdlc1tpXSkgewogCQkJKytp
OwogCQkJY29udGludWU7CiAJCX0KIAotCQlmb3IgKGogPSBpICsgMTsgaiA8IHR0LT50dG0ubnVt
X3BhZ2VzOyArK2opIHsKLQkJCWlmICgrK3AgIT0gdHQtPnR0bS5wYWdlc1tqXSkKKwkJZm9yIChq
ID0gaSArIDE7IGogPCB0dC0+bnVtX3BhZ2VzOyArK2opIHsKKwkJCWlmICgrK3AgIT0gdHQtPnBh
Z2VzW2pdKQogCQkJCWJyZWFrOwogCiAJCQkrK251bV9wYWdlczsKQEAgLTExNDksNyArMTE0OSw3
IEBAIHZvaWQgdHRtX3VubWFwX2FuZF91bnBvcHVsYXRlX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRl
diwgc3RydWN0IHR0bV9kbWFfdHQgKnR0KQogCiAJCWkgKz0gbnVtX3BhZ2VzOwogCX0KLQl0dG1f
cG9vbF91bnBvcHVsYXRlKCZ0dC0+dHRtKTsKKwl0dG1fcG9vbF91bnBvcHVsYXRlKHR0KTsKIH0K
IEVYUE9SVF9TWU1CT0wodHRtX3VubWFwX2FuZF91bnBvcHVsYXRlX3BhZ2VzKTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvY19kbWEuYyBiL2RyaXZlcnMv
Z3B1L2RybS90dG0vdHRtX3BhZ2VfYWxsb2NfZG1hLmMKaW5kZXggYTlhYWVkN2U2MThhLi5jMDM1
M2MyNWVmZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3BhZ2VfYWxsb2Nf
ZG1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcGFnZV9hbGxvY19kbWEuYwpAQCAt
ODMyLDExICs4MzIsMTAgQEAgc3RhdGljIGludCB0dG1fZG1hX3BhZ2VfcG9vbF9maWxsX2xvY2tl
ZChzdHJ1Y3QgZG1hX3Bvb2wgKnBvb2wsCiAgKiByZXR1cm4gZG1hX3BhZ2UgcG9pbnRlciBpZiBz
dWNjZXNzLCBvdGhlcndpc2UgTlVMTC4KICAqLwogc3RhdGljIHN0cnVjdCBkbWFfcGFnZSAqdHRt
X2RtYV9wb29sX2dldF9wYWdlcyhzdHJ1Y3QgZG1hX3Bvb2wgKnBvb2wsCi0JCQkJICBzdHJ1Y3Qg
dHRtX2RtYV90dCAqdHRtX2RtYSwKKwkJCQkgIHN0cnVjdCB0dG1fdHQgKnR0bSwKIAkJCQkgIHVu
c2lnbmVkIGluZGV4KQogewogCXN0cnVjdCBkbWFfcGFnZSAqZF9wYWdlID0gTlVMTDsKLQlzdHJ1
Y3QgdHRtX3R0ICp0dG0gPSAmdHRtX2RtYS0+dHRtOwogCXVuc2lnbmVkIGxvbmcgaXJxX2ZsYWdz
OwogCWludCBjb3VudDsKIApAQCAtODQ1LDggKzg0NCw4IEBAIHN0YXRpYyBzdHJ1Y3QgZG1hX3Bh
Z2UgKnR0bV9kbWFfcG9vbF9nZXRfcGFnZXMoc3RydWN0IGRtYV9wb29sICpwb29sLAogCWlmIChj
b3VudCkgewogCQlkX3BhZ2UgPSBsaXN0X2ZpcnN0X2VudHJ5KCZwb29sLT5mcmVlX2xpc3QsIHN0
cnVjdCBkbWFfcGFnZSwgcGFnZV9saXN0KTsKIAkJdHRtLT5wYWdlc1tpbmRleF0gPSBkX3BhZ2Ut
PnA7Ci0JCXR0bV9kbWEtPmRtYV9hZGRyZXNzW2luZGV4XSA9IGRfcGFnZS0+ZG1hOwotCQlsaXN0
X21vdmVfdGFpbCgmZF9wYWdlLT5wYWdlX2xpc3QsICZ0dG1fZG1hLT5wYWdlc19saXN0KTsKKwkJ
dHRtLT5kbWFfYWRkcmVzc1tpbmRleF0gPSBkX3BhZ2UtPmRtYTsKKwkJbGlzdF9tb3ZlX3RhaWwo
JmRfcGFnZS0+cGFnZV9saXN0LCAmdHRtLT5wYWdlc19saXN0KTsKIAkJcG9vbC0+bnBhZ2VzX2lu
X3VzZSArPSAxOwogCQlwb29sLT5ucGFnZXNfZnJlZSAtPSAxOwogCX0KQEAgLTg1NCw5ICs4NTMs
OCBAQCBzdGF0aWMgc3RydWN0IGRtYV9wYWdlICp0dG1fZG1hX3Bvb2xfZ2V0X3BhZ2VzKHN0cnVj
dCBkbWFfcG9vbCAqcG9vbCwKIAlyZXR1cm4gZF9wYWdlOwogfQogCi1zdGF0aWMgZ2ZwX3QgdHRt
X2RtYV9wb29sX2dmcF9mbGFncyhzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgYm9vbCBodWdl
KQorc3RhdGljIGdmcF90IHR0bV9kbWFfcG9vbF9nZnBfZmxhZ3Moc3RydWN0IHR0bV90dCAqdHRt
LCBib29sIGh1Z2UpCiB7Ci0Jc3RydWN0IHR0bV90dCAqdHRtID0gJnR0bV9kbWEtPnR0bTsKIAln
ZnBfdCBnZnBfZmxhZ3M7CiAKIAlpZiAodHRtLT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19E
TUEzMikKQEAgLTg4MywxMSArODgxLDEwIEBAIHN0YXRpYyBnZnBfdCB0dG1fZG1hX3Bvb2xfZ2Zw
X2ZsYWdzKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBib29sIGh1Z2UpCiAgKiBPbiBzdWNj
ZXNzIHBhZ2VzIGxpc3Qgd2lsbCBob2xkIGNvdW50IG51bWJlciBvZiBjb3JyZWN0bHkKICAqIGNh
Y2hlZCBwYWdlcy4gT24gZmFpbHVyZSB3aWxsIGhvbGQgdGhlIG5lZ2F0aXZlIHJldHVybiB2YWx1
ZSAoLUVOT01FTSwgZXRjKS4KICAqLwotaW50IHR0bV9kbWFfcG9wdWxhdGUoc3RydWN0IHR0bV9k
bWFfdHQgKnR0bV9kbWEsIHN0cnVjdCBkZXZpY2UgKmRldiwKK2ludCB0dG1fZG1hX3BvcHVsYXRl
KHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IGRldmljZSAqZGV2LAogCQkJc3RydWN0IHR0bV9v
cGVyYXRpb25fY3R4ICpjdHgpCiB7CiAJc3RydWN0IHR0bV9tZW1fZ2xvYmFsICptZW1fZ2xvYiA9
ICZ0dG1fbWVtX2dsb2I7Ci0Jc3RydWN0IHR0bV90dCAqdHRtID0gJnR0bV9kbWEtPnR0bTsKIAl1
bnNpZ25lZCBsb25nIG51bV9wYWdlcyA9IHR0bS0+bnVtX3BhZ2VzOwogCXN0cnVjdCBkbWFfcG9v
bCAqcG9vbDsKIAlzdHJ1Y3QgZG1hX3BhZ2UgKmRfcGFnZTsKQEAgLTkwMSw3ICs4OTgsNyBAQCBp
bnQgdHRtX2RtYV9wb3B1bGF0ZShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IGRl
dmljZSAqZGV2LAogCWlmICh0dG1fY2hlY2tfdW5kZXJfbG93ZXJsaW1pdChtZW1fZ2xvYiwgbnVt
X3BhZ2VzLCBjdHgpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCUlOSVRfTElTVF9IRUFEKCZ0dG1f
ZG1hLT5wYWdlc19saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmdHRtLT5wYWdlc19saXN0KTsKIAlp
ID0gMDsKIAogCXR5cGUgPSB0dG1fdG9fdHlwZSh0dG0tPnBhZ2VfZmxhZ3MsIHR0bS0+Y2FjaGlu
Zyk7CkBAIC05MTIsNyArOTA5LDcgQEAgaW50IHR0bV9kbWFfcG9wdWxhdGUoc3RydWN0IHR0bV9k
bWFfdHQgKnR0bV9kbWEsIHN0cnVjdCBkZXZpY2UgKmRldiwKIAogCXBvb2wgPSB0dG1fZG1hX2Zp
bmRfcG9vbChkZXYsIHR5cGUgfCBJU19IVUdFKTsKIAlpZiAoIXBvb2wpIHsKLQkJZ2ZwX3QgZ2Zw
X2ZsYWdzID0gdHRtX2RtYV9wb29sX2dmcF9mbGFncyh0dG1fZG1hLCB0cnVlKTsKKwkJZ2ZwX3Qg
Z2ZwX2ZsYWdzID0gdHRtX2RtYV9wb29sX2dmcF9mbGFncyh0dG0sIHRydWUpOwogCiAJCXBvb2wg
PSB0dG1fZG1hX3Bvb2xfaW5pdChkZXYsIGdmcF9mbGFncywgdHlwZSB8IElTX0hVR0UpOwogCQlp
ZiAoSVNfRVJSX09SX05VTEwocG9vbCkpCkBAIC05MjIsMjEgKzkxOSwyMSBAQCBpbnQgdHRtX2Rt
YV9wb3B1bGF0ZShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IGRldmljZSAqZGV2
LAogCXdoaWxlIChudW1fcGFnZXMgPj0gSFBBR0VfUE1EX05SKSB7CiAJCXVuc2lnbmVkIGo7CiAK
LQkJZF9wYWdlID0gdHRtX2RtYV9wb29sX2dldF9wYWdlcyhwb29sLCB0dG1fZG1hLCBpKTsKKwkJ
ZF9wYWdlID0gdHRtX2RtYV9wb29sX2dldF9wYWdlcyhwb29sLCB0dG0sIGkpOwogCQlpZiAoIWRf
cGFnZSkKIAkJCWJyZWFrOwogCiAJCXJldCA9IHR0bV9tZW1fZ2xvYmFsX2FsbG9jX3BhZ2UobWVt
X2dsb2IsIHR0bS0+cGFnZXNbaV0sCiAJCQkJCQlwb29sLT5zaXplLCBjdHgpOwogCQlpZiAodW5s
aWtlbHkocmV0ICE9IDApKSB7Ci0JCQl0dG1fZG1hX3VucG9wdWxhdGUodHRtX2RtYSwgZGV2KTsK
KwkJCXR0bV9kbWFfdW5wb3B1bGF0ZSh0dG0sIGRldik7CiAJCQlyZXR1cm4gLUVOT01FTTsKIAkJ
fQogCiAJCWRfcGFnZS0+dmFkZHIgfD0gVkFERFJfRkxBR19VUERBVEVEX0NPVU5UOwogCQlmb3Ig
KGogPSBpICsgMTsgaiA8IChpICsgSFBBR0VfUE1EX05SKTsgKytqKSB7CiAJCQl0dG0tPnBhZ2Vz
W2pdID0gdHRtLT5wYWdlc1tqIC0gMV0gKyAxOwotCQkJdHRtX2RtYS0+ZG1hX2FkZHJlc3Nbal0g
PSB0dG1fZG1hLT5kbWFfYWRkcmVzc1tqIC0gMV0gKworCQkJdHRtLT5kbWFfYWRkcmVzc1tqXSA9
IHR0bS0+ZG1hX2FkZHJlc3NbaiAtIDFdICsKIAkJCQlQQUdFX1NJWkU7CiAJCX0KIApAQCAtOTQ5
LDcgKzk0Niw3IEBAIGludCB0dG1fZG1hX3BvcHVsYXRlKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1f
ZG1hLCBzdHJ1Y3QgZGV2aWNlICpkZXYsCiAKIAlwb29sID0gdHRtX2RtYV9maW5kX3Bvb2woZGV2
LCB0eXBlKTsKIAlpZiAoIXBvb2wpIHsKLQkJZ2ZwX3QgZ2ZwX2ZsYWdzID0gdHRtX2RtYV9wb29s
X2dmcF9mbGFncyh0dG1fZG1hLCBmYWxzZSk7CisJCWdmcF90IGdmcF9mbGFncyA9IHR0bV9kbWFf
cG9vbF9nZnBfZmxhZ3ModHRtLCBmYWxzZSk7CiAKIAkJcG9vbCA9IHR0bV9kbWFfcG9vbF9pbml0
KGRldiwgZ2ZwX2ZsYWdzLCB0eXBlKTsKIAkJaWYgKElTX0VSUl9PUl9OVUxMKHBvb2wpKQpAQCAt
OTU3LDE2ICs5NTQsMTYgQEAgaW50IHR0bV9kbWFfcG9wdWxhdGUoc3RydWN0IHR0bV9kbWFfdHQg
KnR0bV9kbWEsIHN0cnVjdCBkZXZpY2UgKmRldiwKIAl9CiAKIAl3aGlsZSAobnVtX3BhZ2VzKSB7
Ci0JCWRfcGFnZSA9IHR0bV9kbWFfcG9vbF9nZXRfcGFnZXMocG9vbCwgdHRtX2RtYSwgaSk7CisJ
CWRfcGFnZSA9IHR0bV9kbWFfcG9vbF9nZXRfcGFnZXMocG9vbCwgdHRtLCBpKTsKIAkJaWYgKCFk
X3BhZ2UpIHsKLQkJCXR0bV9kbWFfdW5wb3B1bGF0ZSh0dG1fZG1hLCBkZXYpOworCQkJdHRtX2Rt
YV91bnBvcHVsYXRlKHR0bSwgZGV2KTsKIAkJCXJldHVybiAtRU5PTUVNOwogCQl9CiAKIAkJcmV0
ID0gdHRtX21lbV9nbG9iYWxfYWxsb2NfcGFnZShtZW1fZ2xvYiwgdHRtLT5wYWdlc1tpXSwKIAkJ
CQkJCXBvb2wtPnNpemUsIGN0eCk7CiAJCWlmICh1bmxpa2VseShyZXQgIT0gMCkpIHsKLQkJCXR0
bV9kbWFfdW5wb3B1bGF0ZSh0dG1fZG1hLCBkZXYpOworCQkJdHRtX2RtYV91bnBvcHVsYXRlKHR0
bSwgZGV2KTsKIAkJCXJldHVybiAtRU5PTUVNOwogCQl9CiAKQEAgLTk4MCwxMCArOTc3LDkgQEAg
aW50IHR0bV9kbWFfcG9wdWxhdGUoc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEsIHN0cnVjdCBk
ZXZpY2UgKmRldiwKIEVYUE9SVF9TWU1CT0xfR1BMKHR0bV9kbWFfcG9wdWxhdGUpOwogCiAvKiBQ
dXQgYWxsIHBhZ2VzIGluIHBhZ2VzIGxpc3QgdG8gY29ycmVjdCBwb29sIHRvIHdhaXQgZm9yIHJl
dXNlICovCi12b2lkIHR0bV9kbWFfdW5wb3B1bGF0ZShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2Rt
YSwgc3RydWN0IGRldmljZSAqZGV2KQordm9pZCB0dG1fZG1hX3VucG9wdWxhdGUoc3RydWN0IHR0
bV90dCAqdHRtLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IHR0bV9tZW1fZ2xvYmFs
ICptZW1fZ2xvYiA9ICZ0dG1fbWVtX2dsb2I7Ci0Jc3RydWN0IHR0bV90dCAqdHRtID0gJnR0bV9k
bWEtPnR0bTsKIAlzdHJ1Y3QgZG1hX3Bvb2wgKnBvb2w7CiAJc3RydWN0IGRtYV9wYWdlICpkX3Bh
Z2UsICpuZXh0OwogCWVudW0gcG9vbF90eXBlIHR5cGU7CkBAIC05OTcsNyArOTkzLDcgQEAgdm9p
ZCB0dG1fZG1hX3VucG9wdWxhdGUoc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEsIHN0cnVjdCBk
ZXZpY2UgKmRldikKIAlwb29sID0gdHRtX2RtYV9maW5kX3Bvb2woZGV2LCB0eXBlIHwgSVNfSFVH
RSk7CiAJaWYgKHBvb2wpIHsKIAkJY291bnQgPSAwOwotCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoZF9wYWdlLCBuZXh0LCAmdHRtX2RtYS0+cGFnZXNfbGlzdCwKKwkJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGRfcGFnZSwgbmV4dCwgJnR0bS0+cGFnZXNfbGlzdCwKIAkJCQkJIHBhZ2VfbGlz
dCkgewogCQkJaWYgKCEoZF9wYWdlLT52YWRkciAmIFZBRERSX0ZMQUdfSFVHRV9QT09MKSkKIAkJ
CQljb250aW51ZTsKQEAgLTEwMjcsNyArMTAyMyw3IEBAIHZvaWQgdHRtX2RtYV91bnBvcHVsYXRl
KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiAKIAkvKiBt
YWtlIHN1cmUgcGFnZXMgYXJyYXkgbWF0Y2ggbGlzdCBhbmQgY291bnQgbnVtYmVyIG9mIHBhZ2Vz
ICovCiAJY291bnQgPSAwOwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkX3BhZ2UsIG5leHQs
ICZ0dG1fZG1hLT5wYWdlc19saXN0LAorCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkX3BhZ2Us
IG5leHQsICZ0dG0tPnBhZ2VzX2xpc3QsCiAJCQkJIHBhZ2VfbGlzdCkgewogCQl0dG0tPnBhZ2Vz
W2NvdW50XSA9IGRfcGFnZS0+cDsKIAkJY291bnQrKzsKQEAgLTEwNDgsNyArMTA0NCw3IEBAIHZv
aWQgdHRtX2RtYV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3Qg
ZGV2aWNlICpkZXYpCiAJCXBvb2wtPm5mcmVlcyArPSBjb3VudDsKIAl9IGVsc2UgewogCQlwb29s
LT5ucGFnZXNfZnJlZSArPSBjb3VudDsKLQkJbGlzdF9zcGxpY2UoJnR0bV9kbWEtPnBhZ2VzX2xp
c3QsICZwb29sLT5mcmVlX2xpc3QpOworCQlsaXN0X3NwbGljZSgmdHRtLT5wYWdlc19saXN0LCAm
cG9vbC0+ZnJlZV9saXN0KTsKIAkJLyoKIAkJICogV2FpdCB0byBoYXZlIGF0IGF0IGxlYXN0IE5V
TV9QQUdFU19UT19BTExPQyBudW1iZXIgb2YgcGFnZXMKIAkJICogdG8gZnJlZSBpbiBvcmRlciB0
byBtaW5pbWl6ZSBjYWxscyB0byBzZXRfbWVtb3J5X3diKCkuCkBAIC0xMDU5LDEwICsxMDU1LDEw
IEBAIHZvaWQgdHRtX2RtYV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBz
dHJ1Y3QgZGV2aWNlICpkZXYpCiAJfQogCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBvb2wtPmxv
Y2ssIGlycV9mbGFncyk7CiAKLQlJTklUX0xJU1RfSEVBRCgmdHRtX2RtYS0+cGFnZXNfbGlzdCk7
CisJSU5JVF9MSVNUX0hFQUQoJnR0bS0+cGFnZXNfbGlzdCk7CiAJZm9yIChpID0gMDsgaSA8IHR0
bS0+bnVtX3BhZ2VzOyBpKyspIHsKIAkJdHRtLT5wYWdlc1tpXSA9IE5VTEw7Ci0JCXR0bV9kbWEt
PmRtYV9hZGRyZXNzW2ldID0gMDsKKwkJdHRtLT5kbWFfYWRkcmVzc1tpXSA9IDA7CiAJfQogCiAJ
Lyogc2hyaW5rIHBvb2wgaWYgbmVjZXNzYXJ5IChvbmx5IG9uICFpc19jYWNoZWQgcG9vbHMpKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3R0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vdHRtL3R0bV90dC5jCmluZGV4IGRjMWRhZDk4MmYyOC4uNjVjNDI1NGVlYTVjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV90dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX3R0LmMKQEAgLTkyLDIxICs5MiwyMiBAQCBzdGF0aWMgaW50IHR0bV90dF9hbGxvY19w
YWdlX2RpcmVjdG9yeShzdHJ1Y3QgdHRtX3R0ICp0dG0pCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRp
YyBpbnQgdHRtX2RtYV90dF9hbGxvY19wYWdlX2RpcmVjdG9yeShzdHJ1Y3QgdHRtX2RtYV90dCAq
dHRtKQorc3RhdGljIGludCB0dG1fZG1hX3R0X2FsbG9jX3BhZ2VfZGlyZWN0b3J5KHN0cnVjdCB0
dG1fdHQgKnR0bSkKIHsKLQl0dG0tPnR0bS5wYWdlcyA9IGt2bWFsbG9jX2FycmF5KHR0bS0+dHRt
Lm51bV9wYWdlcywKLQkJCQkJICBzaXplb2YoKnR0bS0+dHRtLnBhZ2VzKSArCi0JCQkJCSAgc2l6
ZW9mKCp0dG0tPmRtYV9hZGRyZXNzKSwKLQkJCQkJICBHRlBfS0VSTkVMIHwgX19HRlBfWkVSTyk7
Ci0JaWYgKCF0dG0tPnR0bS5wYWdlcykKKwl0dG0tPnBhZ2VzID0ga3ZtYWxsb2NfYXJyYXkodHRt
LT5udW1fcGFnZXMsCisJCQkJICAgIHNpemVvZigqdHRtLT5wYWdlcykgKworCQkJCSAgICBzaXpl
b2YoKnR0bS0+ZG1hX2FkZHJlc3MpLAorCQkJCSAgICBHRlBfS0VSTkVMIHwgX19HRlBfWkVSTyk7
CisJaWYgKCF0dG0tPnBhZ2VzKQogCQlyZXR1cm4gLUVOT01FTTsKLQl0dG0tPmRtYV9hZGRyZXNz
ID0gKHZvaWQgKikgKHR0bS0+dHRtLnBhZ2VzICsgdHRtLT50dG0ubnVtX3BhZ2VzKTsKKworCXR0
bS0+ZG1hX2FkZHJlc3MgPSAodm9pZCAqKSh0dG0tPnBhZ2VzICsgdHRtLT5udW1fcGFnZXMpOwog
CXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHR0bV9zZ190dF9hbGxvY19wYWdlX2RpcmVjdG9y
eShzdHJ1Y3QgdHRtX2RtYV90dCAqdHRtKQorc3RhdGljIGludCB0dG1fc2dfdHRfYWxsb2NfcGFn
ZV9kaXJlY3Rvcnkoc3RydWN0IHR0bV90dCAqdHRtKQogewotCXR0bS0+ZG1hX2FkZHJlc3MgPSBr
dm1hbGxvY19hcnJheSh0dG0tPnR0bS5udW1fcGFnZXMsCisJdHRtLT5kbWFfYWRkcmVzcyA9IGt2
bWFsbG9jX2FycmF5KHR0bS0+bnVtX3BhZ2VzLAogCQkJCQkgIHNpemVvZigqdHRtLT5kbWFfYWRk
cmVzcyksCiAJCQkJCSAgR0ZQX0tFUk5FTCB8IF9fR0ZQX1pFUk8pOwogCWlmICghdHRtLT5kbWFf
YWRkcmVzcykKQEAgLTEzOCw4ICsxMzksMTAgQEAgc3RhdGljIHZvaWQgdHRtX3R0X2luaXRfZmll
bGRzKHN0cnVjdCB0dG1fdHQgKnR0bSwKIAl0dG0tPm51bV9wYWdlcyA9IGJvLT5udW1fcGFnZXM7
CiAJdHRtLT5jYWNoaW5nID0gdHRtX2NhY2hlZDsKIAl0dG0tPnBhZ2VfZmxhZ3MgPSBwYWdlX2Zs
YWdzOworCXR0bS0+ZG1hX2FkZHJlc3MgPSBOVUxMOwogCXR0bS0+c3dhcF9zdG9yYWdlID0gTlVM
TDsKIAl0dG0tPnNnID0gYm8tPnNnOworCUlOSVRfTElTVF9IRUFEKCZ0dG0tPnBhZ2VzX2xpc3Qp
OwogCXR0bS0+Y2FjaGluZyA9IGNhY2hpbmc7CiB9CiAKQEAgLTE1OCwyMCArMTYxLDIxIEBAIEVY
UE9SVF9TWU1CT0wodHRtX3R0X2luaXQpOwogCiB2b2lkIHR0bV90dF9maW5pKHN0cnVjdCB0dG1f
dHQgKnR0bSkKIHsKLQlrdmZyZWUodHRtLT5wYWdlcyk7CisJaWYgKHR0bS0+cGFnZXMpCisJCWt2
ZnJlZSh0dG0tPnBhZ2VzKTsKKwllbHNlCisJCWt2ZnJlZSh0dG0tPmRtYV9hZGRyZXNzKTsKIAl0
dG0tPnBhZ2VzID0gTlVMTDsKKwl0dG0tPmRtYV9hZGRyZXNzID0gTlVMTDsKIH0KIEVYUE9SVF9T
WU1CT0wodHRtX3R0X2ZpbmkpOwogCi1pbnQgdHRtX2RtYV90dF9pbml0KHN0cnVjdCB0dG1fZG1h
X3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAoraW50IHR0bV9kbWFf
dHRfaW5pdChzdHJ1Y3QgdHRtX3R0ICp0dG0sIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8s
CiAJCSAgICB1aW50MzJfdCBwYWdlX2ZsYWdzLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcpCiB7
Ci0Jc3RydWN0IHR0bV90dCAqdHRtID0gJnR0bV9kbWEtPnR0bTsKLQogCXR0bV90dF9pbml0X2Zp
ZWxkcyh0dG0sIGJvLCBwYWdlX2ZsYWdzLCBjYWNoaW5nKTsKIAotCUlOSVRfTElTVF9IRUFEKCZ0
dG1fZG1hLT5wYWdlc19saXN0KTsKLQlpZiAodHRtX2RtYV90dF9hbGxvY19wYWdlX2RpcmVjdG9y
eSh0dG1fZG1hKSkgeworCWlmICh0dG1fZG1hX3R0X2FsbG9jX3BhZ2VfZGlyZWN0b3J5KHR0bSkp
IHsKIAkJcHJfZXJyKCJGYWlsZWQgYWxsb2NhdGluZyBwYWdlIHRhYmxlXG4iKTsKIAkJcmV0dXJu
IC1FTk9NRU07CiAJfQpAQCAtMTc5LDE5ICsxODMsMTcgQEAgaW50IHR0bV9kbWFfdHRfaW5pdChz
dHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
IH0KIEVYUE9SVF9TWU1CT0wodHRtX2RtYV90dF9pbml0KTsKIAotaW50IHR0bV9zZ190dF9pbml0
KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
LAoraW50IHR0bV9zZ190dF9pbml0KHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0ICpibywKIAkJICAgdWludDMyX3QgcGFnZV9mbGFncywgZW51bSB0dG1fY2FjaGlu
ZyBjYWNoaW5nKQogewotCXN0cnVjdCB0dG1fdHQgKnR0bSA9ICZ0dG1fZG1hLT50dG07CiAJaW50
IHJldDsKIAogCXR0bV90dF9pbml0X2ZpZWxkcyh0dG0sIGJvLCBwYWdlX2ZsYWdzLCBjYWNoaW5n
KTsKIAotCUlOSVRfTElTVF9IRUFEKCZ0dG1fZG1hLT5wYWdlc19saXN0KTsKIAlpZiAocGFnZV9m
bGFncyAmIFRUTV9QQUdFX0ZMQUdfU0cpCi0JCXJldCA9IHR0bV9zZ190dF9hbGxvY19wYWdlX2Rp
cmVjdG9yeSh0dG1fZG1hKTsKKwkJcmV0ID0gdHRtX3NnX3R0X2FsbG9jX3BhZ2VfZGlyZWN0b3J5
KHR0bSk7CiAJZWxzZQotCQlyZXQgPSB0dG1fZG1hX3R0X2FsbG9jX3BhZ2VfZGlyZWN0b3J5KHR0
bV9kbWEpOworCQlyZXQgPSB0dG1fZG1hX3R0X2FsbG9jX3BhZ2VfZGlyZWN0b3J5KHR0bSk7CiAJ
aWYgKHJldCkgewogCQlwcl9lcnIoIkZhaWxlZCBhbGxvY2F0aW5nIHBhZ2UgdGFibGVcbiIpOwog
CQlyZXR1cm4gLUVOT01FTTsKQEAgLTIwMCwxOSArMjAyLDYgQEAgaW50IHR0bV9zZ190dF9pbml0
KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
LAogfQogRVhQT1JUX1NZTUJPTCh0dG1fc2dfdHRfaW5pdCk7CiAKLXZvaWQgdHRtX2RtYV90dF9m
aW5pKHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hKQotewotCXN0cnVjdCB0dG1fdHQgKnR0bSA9
ICZ0dG1fZG1hLT50dG07Ci0KLQlpZiAodHRtLT5wYWdlcykKLQkJa3ZmcmVlKHR0bS0+cGFnZXMp
OwotCWVsc2UKLQkJa3ZmcmVlKHR0bV9kbWEtPmRtYV9hZGRyZXNzKTsKLQl0dG0tPnBhZ2VzID0g
TlVMTDsKLQl0dG1fZG1hLT5kbWFfYWRkcmVzcyA9IE5VTEw7Ci19Ci1FWFBPUlRfU1lNQk9MKHR0
bV9kbWFfdHRfZmluaSk7Ci0KIGludCB0dG1fdHRfc3dhcGluKHN0cnVjdCB0dG1fdHQgKnR0bSkK
IHsKIAlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqc3dhcF9zcGFjZTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYwppbmRleCA4OGJlNDhhZDAzNDQuLjkyYTVkMjQ1ZmY0
ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X3R0bV9idWZmZXIuYwpAQCAtMTg2
LDcgKzE4Niw3IEBAIHN0cnVjdCB0dG1fcGxhY2VtZW50IHZtd19ub25maXhlZF9wbGFjZW1lbnQg
PSB7CiB9OwogCiBzdHJ1Y3Qgdm13X3R0bV90dCB7Ci0Jc3RydWN0IHR0bV9kbWFfdHQgZG1hX3R0
bTsKKwlzdHJ1Y3QgdHRtX3R0IGRtYV90dG07CiAJc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJp
djsKIAlpbnQgZ21yX2lkOwogCXN0cnVjdCB2bXdfbW9iICptb2I7CkBAIC0zNzQsOCArMzc0LDgg
QEAgc3RhdGljIGludCB2bXdfdHRtX21hcF9kbWEoc3RydWN0IHZtd190dG1fdHQgKnZtd190dCkK
IAkJcmV0dXJuIDA7CiAKIAl2c2d0LT5tb2RlID0gZGV2X3ByaXYtPm1hcF9tb2RlOwotCXZzZ3Qt
PnBhZ2VzID0gdm13X3R0LT5kbWFfdHRtLnR0bS5wYWdlczsKLQl2c2d0LT5udW1fcGFnZXMgPSB2
bXdfdHQtPmRtYV90dG0udHRtLm51bV9wYWdlczsKKwl2c2d0LT5wYWdlcyA9IHZtd190dC0+ZG1h
X3R0bS5wYWdlczsKKwl2c2d0LT5udW1fcGFnZXMgPSB2bXdfdHQtPmRtYV90dG0ubnVtX3BhZ2Vz
OwogCXZzZ3QtPmFkZHJzID0gdm13X3R0LT5kbWFfdHRtLmRtYV9hZGRyZXNzOwogCXZzZ3QtPnNn
dCA9ICZ2bXdfdHQtPnNndDsKIApAQCAtNDgzLDcgKzQ4Myw3IEBAIHN0YXRpYyB2b2lkIHZtd190
dG1fdW5tYXBfZG1hKHN0cnVjdCB2bXdfdHRtX3R0ICp2bXdfdHQpCiBjb25zdCBzdHJ1Y3Qgdm13
X3NnX3RhYmxlICp2bXdfYm9fc2dfdGFibGUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykK
IHsKIAlzdHJ1Y3Qgdm13X3R0bV90dCAqdm13X3R0ID0KLQkJY29udGFpbmVyX29mKGJvLT50dG0s
IHN0cnVjdCB2bXdfdHRtX3R0LCBkbWFfdHRtLnR0bSk7CisJCWNvbnRhaW5lcl9vZihiby0+dHRt
LCBzdHJ1Y3Qgdm13X3R0bV90dCwgZG1hX3R0bSk7CiAKIAlyZXR1cm4gJnZtd190dC0+dnNndDsK
IH0KQEAgLTQ5Myw3ICs0OTMsNyBAQCBzdGF0aWMgaW50IHZtd190dG1fYmluZChzdHJ1Y3QgdHRt
X2JvX2RldmljZSAqYmRldiwKIAkJCXN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9yZXNv
dXJjZSAqYm9fbWVtKQogewogCXN0cnVjdCB2bXdfdHRtX3R0ICp2bXdfYmUgPQotCQljb250YWlu
ZXJfb2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwgZG1hX3R0bS50dG0pOworCQljb250YWluZXJf
b2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwgZG1hX3R0bSk7CiAJaW50IHJldCA9IDA7CiAKIAlp
ZiAoIWJvX21lbSkKQEAgLTUzNyw3ICs1MzcsNyBAQCBzdGF0aWMgdm9pZCB2bXdfdHRtX3VuYmlu
ZChzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKIAkJCSAgIHN0cnVjdCB0dG1fdHQgKnR0bSkK
IHsKIAlzdHJ1Y3Qgdm13X3R0bV90dCAqdm13X2JlID0KLQkJY29udGFpbmVyX29mKHR0bSwgc3Ry
dWN0IHZtd190dG1fdHQsIGRtYV90dG0udHRtKTsKKwkJY29udGFpbmVyX29mKHR0bSwgc3RydWN0
IHZtd190dG1fdHQsIGRtYV90dG0pOwogCiAJaWYgKCF2bXdfYmUtPmJvdW5kKQogCQlyZXR1cm47
CkBAIC01NjIsMTMgKzU2MiwxMyBAQCBzdGF0aWMgdm9pZCB2bXdfdHRtX3VuYmluZChzdHJ1Y3Qg
dHRtX2JvX2RldmljZSAqYmRldiwKIHN0YXRpYyB2b2lkIHZtd190dG1fZGVzdHJveShzdHJ1Y3Qg
dHRtX2JvX2RldmljZSAqYmRldiwgc3RydWN0IHR0bV90dCAqdHRtKQogewogCXN0cnVjdCB2bXdf
dHRtX3R0ICp2bXdfYmUgPQotCQljb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwg
ZG1hX3R0bS50dG0pOworCQljb250YWluZXJfb2YodHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwgZG1h
X3R0bSk7CiAKIAl2bXdfdHRtX3VuYmluZChiZGV2LCB0dG0pOwogCXR0bV90dF9kZXN0cm95X2Nv
bW1vbihiZGV2LCB0dG0pOwogCXZtd190dG1fdW5tYXBfZG1hKHZtd19iZSk7CiAJaWYgKHZtd19i
ZS0+ZGV2X3ByaXYtPm1hcF9tb2RlID09IHZtd19kbWFfYWxsb2NfY29oZXJlbnQpCi0JCXR0bV9k
bWFfdHRfZmluaSgmdm13X2JlLT5kbWFfdHRtKTsKKwkJdHRtX3R0X2ZpbmkoJnZtd19iZS0+ZG1h
X3R0bSk7CiAJZWxzZQogCQl0dG1fdHRfZmluaSh0dG0pOwogCkBAIC01ODMsNyArNTgzLDcgQEAg
c3RhdGljIGludCB2bXdfdHRtX3BvcHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAog
CQkJICAgIHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgp
CiB7CiAJc3RydWN0IHZtd190dG1fdHQgKnZtd190dCA9Ci0JCWNvbnRhaW5lcl9vZih0dG0sIHN0
cnVjdCB2bXdfdHRtX3R0LCBkbWFfdHRtLnR0bSk7CisJCWNvbnRhaW5lcl9vZih0dG0sIHN0cnVj
dCB2bXdfdHRtX3R0LCBkbWFfdHRtKTsKIAlzdHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2ID0g
dm13X3R0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IgPSB2bXdfbWVt
X2dsb2IoZGV2X3ByaXYpOwogCWludCByZXQ7CkBAIC02MTIsNyArNjEyLDcgQEAgc3RhdGljIHZv
aWQgdm13X3R0bV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAogCQkJICAg
ICAgIHN0cnVjdCB0dG1fdHQgKnR0bSkKIHsKIAlzdHJ1Y3Qgdm13X3R0bV90dCAqdm13X3R0ID0g
Y29udGFpbmVyX29mKHR0bSwgc3RydWN0IHZtd190dG1fdHQsCi0JCQkJCQkgZG1hX3R0bS50dG0p
OworCQkJCQkJIGRtYV90dG0pOwogCXN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bXdf
dHQtPmRldl9wcml2OwogCXN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYiA9IHZtd19tZW1fZ2xv
YihkZXZfcHJpdik7CiAKQEAgLTY1MCwxMiArNjUwLDEyIEBAIHN0YXRpYyBzdHJ1Y3QgdHRtX3R0
ICp2bXdfdHRtX3R0X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCQlyZXQg
PSB0dG1fZG1hX3R0X2luaXQoJnZtd19iZS0+ZG1hX3R0bSwgYm8sIHBhZ2VfZmxhZ3MsCiAJCQkJ
ICAgICAgdHRtX2NhY2hlZCk7CiAJZWxzZQotCQlyZXQgPSB0dG1fdHRfaW5pdCgmdm13X2JlLT5k
bWFfdHRtLnR0bSwgYm8sIHBhZ2VfZmxhZ3MsCisJCXJldCA9IHR0bV90dF9pbml0KCZ2bXdfYmUt
PmRtYV90dG0sIGJvLCBwYWdlX2ZsYWdzLAogCQkJCSAgdHRtX2NhY2hlZCk7CiAJaWYgKHVubGlr
ZWx5KHJldCAhPSAwKSkKIAkJZ290byBvdXRfbm9faW5pdDsKIAotCXJldHVybiAmdm13X2JlLT5k
bWFfdHRtLnR0bTsKKwlyZXR1cm4gJnZtd19iZS0+ZG1hX3R0bTsKIG91dF9ub19pbml0OgogCWtm
cmVlKHZtd19iZSk7CiAJcmV0dXJuIE5VTEw7CkBAIC04MTMsNyArODEzLDcgQEAgaW50IHZtd19i
b19jcmVhdGVfYW5kX3BvcHVsYXRlKHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0
ID0gdm13X3R0bV9wb3B1bGF0ZShiby0+YmRldiwgYm8tPnR0bSwgJmN0eCk7CiAJaWYgKGxpa2Vs
eShyZXQgPT0gMCkpIHsKIAkJc3RydWN0IHZtd190dG1fdHQgKnZtd190dCA9Ci0JCQljb250YWlu
ZXJfb2YoYm8tPnR0bSwgc3RydWN0IHZtd190dG1fdHQsIGRtYV90dG0udHRtKTsKKwkJCWNvbnRh
aW5lcl9vZihiby0+dHRtLCBzdHJ1Y3Qgdm13X3R0bV90dCwgZG1hX3R0bSk7CiAJCXJldCA9IHZt
d190dG1fbWFwX2RtYSh2bXdfdHQpOwogCX0KIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRt
L3R0bV9wYWdlX2FsbG9jLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX3BhZ2VfYWxsb2MuaAppbmRl
eCBhNmI2ZWY1ZjliZjQuLjhmYTFlN2RmNjIxMyAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vdHRt
L3R0bV9wYWdlX2FsbG9jLmgKKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmgK
QEAgLTYxLDEzICs2MSwxMyBAQCB2b2lkIHR0bV9wb29sX3VucG9wdWxhdGUoc3RydWN0IHR0bV90
dCAqdHRtKTsKIC8qKgogICogUG9wdWxhdGVzIGFuZCBETUEgbWFwcyBwYWdlcyB0byBmdWxsZmls
IGEgdHRtX2RtYV9wb3B1bGF0ZSgpIHJlcXVlc3QKICAqLwotaW50IHR0bV9wb3B1bGF0ZV9hbmRf
bWFwX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHR0bV9kbWFfdHQgKnR0LAoraW50
IHR0bV9wb3B1bGF0ZV9hbmRfbWFwX3BhZ2VzKHN0cnVjdCBkZXZpY2UgKmRldiwgc3RydWN0IHR0
bV90dCAqdHQsCiAJCQkJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4ICpjdHgpOwogCiAvKioKICAq
IFVucG9wdWxhdGVzIGFuZCBETUEgdW5tYXBzIHBhZ2VzIGFzIHBhcnQgb2YgYQogICogdHRtX2Rt
YV91bnBvcHVsYXRlKCkgcmVxdWVzdCAqLwotdm9pZCB0dG1fdW5tYXBfYW5kX3VucG9wdWxhdGVf
cGFnZXMoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3QgdHRtX2RtYV90dCAqdHQpOwordm9pZCB0
dG1fdW5tYXBfYW5kX3VucG9wdWxhdGVfcGFnZXMoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1Y3Qg
dHRtX3R0ICp0dCk7CiAKIC8qKgogICogT3V0cHV0IHRoZSBzdGF0ZSBvZiBwb29scyB0byBkZWJ1
Z2ZzIGZpbGUKQEAgLTkwLDkgKzkwLDkgQEAgdm9pZCB0dG1fZG1hX3BhZ2VfYWxsb2NfZmluaSh2
b2lkKTsKICAqLwogaW50IHR0bV9kbWFfcGFnZV9hbGxvY19kZWJ1Z2ZzKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSk7CiAKLWludCB0dG1fZG1hX3BvcHVsYXRlKHN0cnVjdCB0dG1fZG1h
X3R0ICp0dG1fZG1hLCBzdHJ1Y3QgZGV2aWNlICpkZXYsCitpbnQgdHRtX2RtYV9wb3B1bGF0ZShz
dHJ1Y3QgdHRtX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJCQlzdHJ1Y3QgdHRt
X29wZXJhdGlvbl9jdHggKmN0eCk7Ci12b2lkIHR0bV9kbWFfdW5wb3B1bGF0ZShzdHJ1Y3QgdHRt
X2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IGRldmljZSAqZGV2KTsKK3ZvaWQgdHRtX2RtYV91bnBv
cHVsYXRlKHN0cnVjdCB0dG1fdHQgKnR0bV9kbWEsIHN0cnVjdCBkZXZpY2UgKmRldik7CiAKICNl
bHNlCiBzdGF0aWMgaW5saW5lIGludCB0dG1fZG1hX3BhZ2VfYWxsb2NfaW5pdChzdHJ1Y3QgdHRt
X21lbV9nbG9iYWwgKmdsb2IsCkBAIC0xMDcsMTMgKzEwNywxMyBAQCBzdGF0aWMgaW5saW5lIGlu
dCB0dG1fZG1hX3BhZ2VfYWxsb2NfZGVidWdmcyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRh
dGEpCiB7CiAJcmV0dXJuIDA7CiB9Ci1zdGF0aWMgaW5saW5lIGludCB0dG1fZG1hX3BvcHVsYXRl
KHN0cnVjdCB0dG1fZG1hX3R0ICp0dG1fZG1hLAorc3RhdGljIGlubGluZSBpbnQgdHRtX2RtYV9w
b3B1bGF0ZShzdHJ1Y3QgdHRtX3R0ICp0dG1fZG1hLAogCQkJCXN0cnVjdCBkZXZpY2UgKmRldiwK
IAkJCQlzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCkKIHsKIAlyZXR1cm4gLUVOT01FTTsK
IH0KLXN0YXRpYyBpbmxpbmUgdm9pZCB0dG1fZG1hX3VucG9wdWxhdGUoc3RydWN0IHR0bV9kbWFf
dHQgKnR0bV9kbWEsCitzdGF0aWMgaW5saW5lIHZvaWQgdHRtX2RtYV91bnBvcHVsYXRlKHN0cnVj
dCB0dG1fdHQgKnR0bV9kbWEsCiAJCQkJICAgICAgc3RydWN0IGRldmljZSAqZGV2KQogewogfQpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oIGIvaW5jbHVkZS9kcm0vdHRtL3R0
bV90dC5oCmluZGV4IDkzMWEzMTM1NTg3MC4uZGY5YTgwNjUwZmViIDEwMDY0NAotLS0gYS9pbmNs
dWRlL2RybS90dG0vdHRtX3R0LmgKKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV90dC5oCkBAIC00
NywxMiArNDcsMTMgQEAgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4OwogICogc3RydWN0IHR0bV90
dAogICoKICAqIEBwYWdlczogQXJyYXkgb2YgcGFnZXMgYmFja2luZyB0aGUgZGF0YS4KKyAqIEBw
YWdlX2ZsYWdzOiBzZWUgVFRNX1BBR0VfRkxBR18qCiAgKiBAbnVtX3BhZ2VzOiBOdW1iZXIgb2Yg
cGFnZXMgaW4gdGhlIHBhZ2UgYXJyYXkuCi0gKiBAYmRldjogUG9pbnRlciB0byB0aGUgY3VycmVu
dCBzdHJ1Y3QgdHRtX2JvX2RldmljZS4KLSAqIEBiZTogUG9pbnRlciB0byB0aGUgdHRtIGJhY2tl
bmQuCisgKiBAc2c6IGZvciBTRyBvYmplY3RzIHZpYSBkbWEtYnVmCisgKiBAZG1hX2FkZHJlc3M6
IFRoZSBETUEgKGJ1cykgYWRkcmVzc2VzIG9mIHRoZSBwYWdlcwogICogQHN3YXBfc3RvcmFnZTog
UG9pbnRlciB0byBzaG1lbSBzdHJ1Y3QgZmlsZSBmb3Igc3dhcCBzdG9yYWdlLgotICogQGNhY2hp
bmdfc3RhdGU6IFRoZSBjdXJyZW50IGNhY2hpbmcgc3RhdGUgb2YgdGhlIHBhZ2VzLgotICogQHN0
YXRlOiBUaGUgY3VycmVudCBiaW5kaW5nIHN0YXRlIG9mIHRoZSBwYWdlcy4KKyAqIEBwYWdlc19s
aXN0OiB1c2VkIGJ5IHNvbWUgcGFnZSBhbGxvY2F0aW9uIGJhY2tlbmQKKyAqIEBjYWNoaW5nOiBU
aGUgY3VycmVudCBjYWNoaW5nIHN0YXRlIG9mIHRoZSBwYWdlcy4KICAqCiAgKiBUaGlzIGlzIGEg
c3RydWN0dXJlIGhvbGRpbmcgdGhlIHBhZ2VzLCBjYWNoaW5nLSBhbmQgYXBlcnR1cmUgYmluZGlu
ZwogICogc3RhdHVzIGZvciBhIGJ1ZmZlciBvYmplY3QgdGhhdCBpc24ndCBiYWNrZWQgYnkgZml4
ZWQgKFZSQU0gLyBBR1ApCkBAIC02Miw4ICs2MywxMCBAQCBzdHJ1Y3QgdHRtX3R0IHsKIAlzdHJ1
Y3QgcGFnZSAqKnBhZ2VzOwogCXVpbnQzMl90IHBhZ2VfZmxhZ3M7CiAJdWludDMyX3QgbnVtX3Bh
Z2VzOwotCXN0cnVjdCBzZ190YWJsZSAqc2c7IC8qIGZvciBTRyBvYmplY3RzIHZpYSBkbWEtYnVm
ICovCisJc3RydWN0IHNnX3RhYmxlICpzZzsKKwlkbWFfYWRkcl90ICpkbWFfYWRkcmVzczsKIAlz
dHJ1Y3QgZmlsZSAqc3dhcF9zdG9yYWdlOworCXN0cnVjdCBsaXN0X2hlYWQgcGFnZXNfbGlzdDsK
IAllbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmc7CiB9OwogCkBAIC03MiwyMyArNzUsNiBAQCBzdGF0
aWMgaW5saW5lIGJvb2wgdHRtX3R0X2lzX3BvcHVsYXRlZChzdHJ1Y3QgdHRtX3R0ICp0dCkKIAly
ZXR1cm4gdHQtPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX1BSSVZfUE9QVUxBVEVEOwogfQog
Ci0vKioKLSAqIHN0cnVjdCB0dG1fZG1hX3R0Ci0gKgotICogQHR0bTogQmFzZSB0dG1fdHQgc3Ry
dWN0LgotICogQGRtYV9hZGRyZXNzOiBUaGUgRE1BIChidXMpIGFkZHJlc3NlcyBvZiB0aGUgcGFn
ZXMKLSAqIEBwYWdlc19saXN0OiB1c2VkIGJ5IHNvbWUgcGFnZSBhbGxvY2F0aW9uIGJhY2tlbmQK
LSAqCi0gKiBUaGlzIGlzIGEgc3RydWN0dXJlIGhvbGRpbmcgdGhlIHBhZ2VzLCBjYWNoaW5nLSBh
bmQgYXBlcnR1cmUgYmluZGluZwotICogc3RhdHVzIGZvciBhIGJ1ZmZlciBvYmplY3QgdGhhdCBp
c24ndCBiYWNrZWQgYnkgZml4ZWQgKFZSQU0gLyBBR1ApCi0gKiBtZW1vcnkuCi0gKi8KLXN0cnVj
dCB0dG1fZG1hX3R0IHsKLQlzdHJ1Y3QgdHRtX3R0IHR0bTsKLQlkbWFfYWRkcl90ICpkbWFfYWRk
cmVzczsKLQlzdHJ1Y3QgbGlzdF9oZWFkIHBhZ2VzX2xpc3Q7Ci19OwotCiAvKioKICAqIHR0bV90
dF9jcmVhdGUKICAqCkBAIC0xMTUsOSArMTAxLDkgQEAgaW50IHR0bV90dF9jcmVhdGUoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibywgYm9vbCB6ZXJvX2FsbG9jKTsKICAqLwogaW50IHR0bV90
dF9pbml0KHN0cnVjdCB0dG1fdHQgKnR0bSwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
IAkJdWludDMyX3QgcGFnZV9mbGFncywgZW51bSB0dG1fY2FjaGluZyBjYWNoaW5nKTsKLWludCB0
dG1fZG1hX3R0X2luaXQoc3RydWN0IHR0bV9kbWFfdHQgKnR0bV9kbWEsIHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sCitpbnQgdHRtX2RtYV90dF9pbml0KHN0cnVjdCB0dG1fdHQgKnR0bV9k
bWEsIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCSAgICB1aW50MzJfdCBwYWdlX2Zs
YWdzLCBlbnVtIHR0bV9jYWNoaW5nIGNhY2hpbmcpOwotaW50IHR0bV9zZ190dF9pbml0KHN0cnVj
dCB0dG1fZG1hX3R0ICp0dG1fZG1hLCBzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAoraW50
IHR0bV9zZ190dF9pbml0KHN0cnVjdCB0dG1fdHQgKnR0bV9kbWEsIHN0cnVjdCB0dG1fYnVmZmVy
X29iamVjdCAqYm8sCiAJCSAgIHVpbnQzMl90IHBhZ2VfZmxhZ3MsIGVudW0gdHRtX2NhY2hpbmcg
Y2FjaGluZyk7CiAKIC8qKgpAQCAtMTI4LDcgKzExNCw2IEBAIGludCB0dG1fc2dfdHRfaW5pdChz
dHJ1Y3QgdHRtX2RtYV90dCAqdHRtX2RtYSwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywK
ICAqIEZyZWUgbWVtb3J5IG9mIHR0bV90dCBzdHJ1Y3R1cmUKICAqLwogdm9pZCB0dG1fdHRfZmlu
aShzdHJ1Y3QgdHRtX3R0ICp0dG0pOwotdm9pZCB0dG1fZG1hX3R0X2Zpbmkoc3RydWN0IHR0bV9k
bWFfdHQgKnR0bV9kbWEpOwogCiAvKioKICAqIHR0bV90dG1fZGVzdHJveToKLS0gCjIuMTcuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
