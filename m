Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 687FD845E5
	for <lists+dri-devel@lfdr.de>; Wed,  7 Aug 2019 09:28:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5D7736E66A;
	Wed,  7 Aug 2019 07:26:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x842.google.com (mail-qt1-x842.google.com
 [IPv6:2607:f8b0:4864:20::842])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 33B4B6E583
 for <dri-devel@lists.freedesktop.org>; Tue,  6 Aug 2019 23:16:19 +0000 (UTC)
Received: by mail-qt1-x842.google.com with SMTP id w17so5816826qto.10
 for <dri-devel@lists.freedesktop.org>; Tue, 06 Aug 2019 16:16:19 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=Pn+tyQ3Pr4O2LIFi6En+JQU77nMjukrgPYCGXMr75Sc=;
 b=rebMYvglE57iDihyEQfRrIK0HT8KBDsRlbe7ts/ivLszpa307BIkSFekvKQsjlJALm
 lyt4gQTOM80woQIDWqEkKBlcCE50doBw/W8Za5NVAn0ejXkVKQNQ2XM5wqDFUOkKPwU1
 Kj7bbsCt1Qo79L3PbfCzFYMI8MZQ0KW4F2uA9ICg6K8oLXvcLgkPWtAJiyJNbeh2gcxc
 S3kZJ70TsQbiFSZMSd2WoYCyXxpQcAH9IBFnoTts8PjYsAoQFTvLSkt0CCJVo4brJtpL
 d3fgjGJKW978S/MumNeizI1EQcLs4Zp2/wN1A4DDEFEMipYZP3P3O+stxFDzi+VsTfql
 +s0g==
X-Gm-Message-State: APjAAAULJmDdPMtWz+L7L8jVr3E/25nhU0mWRoxzaY/EdxXC80rw77x8
 Sx7tJdIEogCx/KE7oglrn85S2w==
X-Google-Smtp-Source: APXvYqxTw9+mlouFwWoFRA0XatHqfMRrcpDdIv2NXf5/HvRxmFylGt3sJXAS2PMqHoBRobENBadT3A==
X-Received: by 2002:ac8:285c:: with SMTP id 28mr5575869qtr.186.1565133378273; 
 Tue, 06 Aug 2019 16:16:18 -0700 (PDT)
Received: from ziepe.ca
 (hlfxns017vw-156-34-55-100.dhcp-dynamic.fibreop.ns.bellaliant.net.
 [156.34.55.100])
 by smtp.gmail.com with ESMTPSA id r40sm47669868qtr.57.2019.08.06.16.16.14
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 06 Aug 2019 16:16:17 -0700 (PDT)
Received: from jgg by mlx.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1hv8gg-0006ey-Dk; Tue, 06 Aug 2019 20:16:14 -0300
From: Jason Gunthorpe <jgg@ziepe.ca>
To: linux-mm@kvack.org
Subject: [PATCH v3 hmm 08/11] drm/radeon: use mmu_notifier_get/put for struct
 radeon_mn
Date: Tue,  6 Aug 2019 20:15:45 -0300
Message-Id: <20190806231548.25242-9-jgg@ziepe.ca>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190806231548.25242-1-jgg@ziepe.ca>
References: <20190806231548.25242-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 07 Aug 2019 07:26:18 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=Pn+tyQ3Pr4O2LIFi6En+JQU77nMjukrgPYCGXMr75Sc=;
 b=OggTUEspMMn1b2yn+uWIxqTUSf36GrQvvrKxao/PHqyl+DTzlNDH4G1PGH3Rn0oGUS
 9yWjg40oqduC6+lBlaQt5AEvzMMt0+HwZg55qm2B0NolxD6rKy/+kW7fIzbbXJKBopU0
 i0almRR6UKPo/GhOflLmKlphmx9M/H798dmunpZq7PtsAO2b61x95N71srn2s2CDP8O8
 2Nnw5Qr44QCLihcSGiRyMe3Kj2uVDFPch0f783vgeAsiRsnpUJHeAgiwM1GQwWYB1VHE
 DvJqjSXNfKnDYlNgHN92XgTfN016uxa+ZXPo1oS4z0q6EyI5dcvmeyhfMveigWb28Muk
 7f4w==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrea Arcangeli <aarcange@redhat.com>,
 Ralph Campbell <rcampbell@nvidia.com>, Dimitri Sivanich <sivanich@sgi.com>,
 Gavin Shan <shangw@linux.vnet.ibm.com>, Andrea Righi <andrea@betterlinux.com>,
 linux-rdma@vger.kernel.org, John Hubbard <jhubbard@nvidia.com>, "Kuehling,
 Felix" <Felix.Kuehling@amd.com>, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 iommu@lists.linux-foundation.org, amd-gfx@lists.freedesktop.org,
 Jason Gunthorpe <jgg@mellanox.com>, Alex Deucher <alexander.deucher@amd.com>,
 intel-gfx@lists.freedesktop.org, Christoph Hellwig <hch@lst.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKcmFkZW9uIGlzIHVzaW5n
IGEgZGV2aWNlIGdsb2JhbCBoYXNoIHRhYmxlIHRvIHRyYWNrIHdoYXQgbW11X25vdGlmaWVycwpo
YXZlIGJlZW4gcmVnaXN0ZXJlZCBvbiBzdHJ1Y3QgbW0uIFRoaXMgaXMgYmV0dGVyIHNlcnZlZCB3
aXRoIHRoZSBuZXcKZ2V0L3B1dCBzY2hlbWUgaW5zdGVhZC4KCnJhZGVvbiBoYXMgYSBidWcgd2hl
cmUgaXQgd2FzIG5vdCBibG9ja2luZyBub3RpZmllciByZWxlYXNlKCkgdW50aWwgYWxsCnRoZSBC
TydzIGhhZCBiZWVuIGludmFsaWRhdGVkLiBUaGlzIGNvdWxkIHJlc3VsdCBpbiBhIHVzZSBhZnRl
ciBmcmVlIG9mCnBhZ2VzIHRoZSBCT3MuIFRoaXMgaXMgdGllZCBpbnRvIGEgc2Vjb25kIGJ1ZyB3
aGVyZSByYWRlb24gbGVmdCB0aGUKbm90aWZpZXJzIHJ1bm5pbmcgZW5kbGVzc2x5IGV2ZW4gb25j
ZSB0aGUgaW50ZXJ2YWwgdHJlZSBiZWNhbWUKZW1wdHkuIFRoaXMgY291bGQgcmVzdWx0IGluIGEg
dXNlIGFmdGVyIGZyZWUgd2l0aCBtb2R1bGUgdW5sb2FkLgoKQm90aCBhcmUgZml4ZWQgYnkgY2hh
bmdpbmcgdGhlIGxpZmV0aW1lIG1vZGVsLCB0aGUgQk9zIGV4aXN0IGluIHRoZQppbnRlcnZhbCB0
cmVlIHdpdGggdGhlaXIgbmF0dXJhbCBsaWZldGltZXMgaW5kZXBlbmRlbnQgb2YgdGhlIG1tX3N0
cnVjdApsaWZldGltZSB1c2luZyB0aGUgZ2V0L3B1dCBzY2hlbWUuIFRoZSByZWxlYXNlIHJ1bnMg
c3luY2hyb25vdXNseSBhbmQganVzdApkb2VzIGludmFsaWRhdGVfc3RhcnQgYWNyb3NzIHRoZSBl
bnRpcmUgaW50ZXJ2YWwgdHJlZSB0byBjcmVhdGUgdGhlCnJlcXVpcmVkIERNQSBmZW5jZS4KCkFk
ZGl0aW9ucyB0byB0aGUgaW50ZXJ2YWwgdHJlZSBhZnRlciByZWxlYXNlIGFyZSBhbHJlYWR5IGlt
cG9zc2libGUgYXMKb25seSBjdXJyZW50LT5tbSBpcyB1c2VkIGR1cmluZyB0aGUgYWRkLgoKU2ln
bmVkLW9mZi1ieTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uLmggICAgICAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1L2Ry
bS9yYWRlb24vcmFkZW9uX2RldmljZS5jIHwgICAyIC0KIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX2Rydi5jICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX21u
LmMgICAgIHwgMTU3ICsrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwg
MzggaW5zZXJ0aW9ucygrKSwgMTI2IGRlbGV0aW9ucygtKQoKQU1EIHRlYW06IEkgd29uZGVyIGlm
IGtmZCBoYXMgc2ltaWxhciBsaWZldGltZSBpc3N1ZXM/CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL3JhZGVvbi9yYWRlb24uaCBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uLmgK
aW5kZXggMzI4MDhlNTBiZTEyZjguLjkxODE2NGY5MGIxMTRhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcmFkZW9uL3JhZGVvbi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFk
ZW9uLmgKQEAgLTI0NTEsOSArMjQ1MSw2IEBAIHN0cnVjdCByYWRlb25fZGV2aWNlIHsKIAkvKiB0
cmFja2luZyBwaW5uZWQgbWVtb3J5ICovCiAJdTY0IHZyYW1fcGluX3NpemU7CiAJdTY0IGdhcnRf
cGluX3NpemU7Ci0KLQlzdHJ1Y3QgbXV0ZXgJbW5fbG9jazsKLQlERUNMQVJFX0hBU0hUQUJMRSht
bl9oYXNoLCA3KTsKIH07CiAKIGJvb2wgcmFkZW9uX2lzX3B4KHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fZGV2aWNlLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9kZXZpY2UuYwppbmRleCBkY2ViNTU0ZTU2
NzQ0Ni4uNzg4YjFkOGE4MGU2NjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2Rldmlj
ZS5jCkBAIC0xMzI1LDggKzEzMjUsNiBAQCBpbnQgcmFkZW9uX2RldmljZV9pbml0KHN0cnVjdCBy
YWRlb25fZGV2aWNlICpyZGV2LAogCWluaXRfcndzZW0oJnJkZXYtPnBtLm1jbGtfbG9jayk7CiAJ
aW5pdF9yd3NlbSgmcmRldi0+ZXhjbHVzaXZlX2xvY2spOwogCWluaXRfd2FpdHF1ZXVlX2hlYWQo
JnJkZXYtPmlycS52YmxhbmtfcXVldWUpOwotCW11dGV4X2luaXQoJnJkZXYtPm1uX2xvY2spOwot
CWhhc2hfaW5pdChyZGV2LT5tbl9oYXNoKTsKIAlyID0gcmFkZW9uX2dlbV9pbml0KHJkZXYpOwog
CWlmIChyKQogCQlyZXR1cm4gcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fZHJ2LmMKaW5kZXgg
YTZjYmUxMWY3OWM2MTEuLmI2NTM1YWM5MWZkYjc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vcmFkZW9uL3JhZGVvbl9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVv
bl9kcnYuYwpAQCAtMzUsNiArMzUsNyBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgogI2lu
Y2x1ZGUgPGxpbnV4L3BtX3J1bnRpbWUuaD4KICNpbmNsdWRlIDxsaW51eC92Z2Ffc3dpdGNoZXJv
by5oPgorI2luY2x1ZGUgPGxpbnV4L21tdV9ub3RpZmllci5oPgogCiAjaW5jbHVkZSA8ZHJtL2Ry
bV9jcnRjX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CkBAIC02MjQsNiArNjI1
LDcgQEAgc3RhdGljIHZvaWQgX19leGl0IHJhZGVvbl9leGl0KHZvaWQpCiB7CiAJcGNpX3VucmVn
aXN0ZXJfZHJpdmVyKHBkcml2ZXIpOwogCXJhZGVvbl91bnJlZ2lzdGVyX2F0cHhfaGFuZGxlcigp
OworCW1tdV9ub3RpZmllcl9zeW5jaHJvbml6ZSgpOwogfQogCiBtb2R1bGVfaW5pdChyYWRlb25f
aW5pdCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9tbi5jIGIv
ZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fbW4uYwppbmRleCA4YzM4NzFlZDIzYTlmMC4u
ZmM4MjU0MjczYTgwMGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9u
X21uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fbW4uYwpAQCAtMzcsMTcg
KzM3LDggQEAKICNpbmNsdWRlICJyYWRlb24uaCIKIAogc3RydWN0IHJhZGVvbl9tbiB7Ci0JLyog
Y29uc3RhbnQgYWZ0ZXIgaW5pdGlhbGlzYXRpb24gKi8KLQlzdHJ1Y3QgcmFkZW9uX2RldmljZQkq
cmRldjsKLQlzdHJ1Y3QgbW1fc3RydWN0CSptbTsKIAlzdHJ1Y3QgbW11X25vdGlmaWVyCW1uOwog
Ci0JLyogb25seSB1c2VkIG9uIGRlc3RydWN0aW9uICovCi0Jc3RydWN0IHdvcmtfc3RydWN0CXdv
cms7Ci0KLQkvKiBwcm90ZWN0ZWQgYnkgcmRldi0+bW5fbG9jayAqLwotCXN0cnVjdCBobGlzdF9u
b2RlCW5vZGU7Ci0KIAkvKiBvYmplY3RzIHByb3RlY3RlZCBieSBsb2NrICovCiAJc3RydWN0IG11
dGV4CQlsb2NrOwogCXN0cnVjdCByYl9yb290X2NhY2hlZAlvYmplY3RzOwpAQCAtNTgsNTUgKzQ5
LDYgQEAgc3RydWN0IHJhZGVvbl9tbl9ub2RlIHsKIAlzdHJ1Y3QgbGlzdF9oZWFkCQlib3M7CiB9
OwogCi0vKioKLSAqIHJhZGVvbl9tbl9kZXN0cm95IC0gZGVzdHJveSB0aGUgcm1uCi0gKgotICog
QHdvcms6IHByZXZpb3VzbHkgc2hlZHVsZWQgd29yayBpdGVtCi0gKgotICogTGF6eSBkZXN0cm95
cyB0aGUgbm90aWZpZXIgZnJvbSBhIHdvcmsgaXRlbQotICovCi1zdGF0aWMgdm9pZCByYWRlb25f
bW5fZGVzdHJveShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17Ci0Jc3RydWN0IHJhZGVvbl9t
biAqcm1uID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCByYWRlb25fbW4sIHdvcmspOwotCXN0
cnVjdCByYWRlb25fZGV2aWNlICpyZGV2ID0gcm1uLT5yZGV2OwotCXN0cnVjdCByYWRlb25fbW5f
bm9kZSAqbm9kZSwgKm5leHRfbm9kZTsKLQlzdHJ1Y3QgcmFkZW9uX2JvICpibywgKm5leHRfYm87
Ci0KLQltdXRleF9sb2NrKCZyZGV2LT5tbl9sb2NrKTsKLQltdXRleF9sb2NrKCZybW4tPmxvY2sp
OwotCWhhc2hfZGVsKCZybW4tPm5vZGUpOwotCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50
cnlfc2FmZShub2RlLCBuZXh0X25vZGUsCi0JCQkJCSAgICAgJnJtbi0+b2JqZWN0cy5yYl9yb290
LCBpdC5yYikgewotCi0JCWludGVydmFsX3RyZWVfcmVtb3ZlKCZub2RlLT5pdCwgJnJtbi0+b2Jq
ZWN0cyk7Ci0JCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShibywgbmV4dF9ibywgJm5vZGUtPmJv
cywgbW5fbGlzdCkgewotCQkJYm8tPm1uID0gTlVMTDsKLQkJCWxpc3RfZGVsX2luaXQoJmJvLT5t
bl9saXN0KTsKLQkJfQotCQlrZnJlZShub2RlKTsKLQl9Ci0JbXV0ZXhfdW5sb2NrKCZybW4tPmxv
Y2spOwotCW11dGV4X3VubG9jaygmcmRldi0+bW5fbG9jayk7Ci0JbW11X25vdGlmaWVyX3VucmVn
aXN0ZXIoJnJtbi0+bW4sIHJtbi0+bW0pOwotCWtmcmVlKHJtbik7Ci19Ci0KLS8qKgotICogcmFk
ZW9uX21uX3JlbGVhc2UgLSBjYWxsYmFjayB0byBub3RpZnkgYWJvdXQgbW0gZGVzdHJ1Y3Rpb24K
LSAqCi0gKiBAbW46IG91ciBub3RpZmllcgotICogQG1uOiB0aGUgbW0gdGhpcyBjYWxsYmFjayBp
cyBhYm91dAotICoKLSAqIFNoZWR1bGUgYSB3b3JrIGl0ZW0gdG8gbGF6eSBkZXN0cm95IG91ciBu
b3RpZmllci4KLSAqLwotc3RhdGljIHZvaWQgcmFkZW9uX21uX3JlbGVhc2Uoc3RydWN0IG1tdV9u
b3RpZmllciAqbW4sCi0JCQkgICAgICBzdHJ1Y3QgbW1fc3RydWN0ICptbSkKLXsKLQlzdHJ1Y3Qg
cmFkZW9uX21uICpybW4gPSBjb250YWluZXJfb2YobW4sIHN0cnVjdCByYWRlb25fbW4sIG1uKTsK
LQlJTklUX1dPUksoJnJtbi0+d29yaywgcmFkZW9uX21uX2Rlc3Ryb3kpOwotCXNjaGVkdWxlX3dv
cmsoJnJtbi0+d29yayk7Ci19Ci0KIC8qKgogICogcmFkZW9uX21uX2ludmFsaWRhdGVfcmFuZ2Vf
c3RhcnQgLSBjYWxsYmFjayB0byBub3RpZnkgYWJvdXQgbW0gY2hhbmdlCiAgKgpAQCAtMTgzLDY1
ICsxMjUsNDQgQEAgc3RhdGljIGludCByYWRlb25fbW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChz
dHJ1Y3QgbW11X25vdGlmaWVyICptbiwKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgY29uc3Qg
c3RydWN0IG1tdV9ub3RpZmllcl9vcHMgcmFkZW9uX21uX29wcyA9IHsKLQkucmVsZWFzZSA9IHJh
ZGVvbl9tbl9yZWxlYXNlLAotCS5pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0ID0gcmFkZW9uX21uX2lu
dmFsaWRhdGVfcmFuZ2Vfc3RhcnQsCi19Oworc3RhdGljIHZvaWQgcmFkZW9uX21uX3JlbGVhc2Uo
c3RydWN0IG1tdV9ub3RpZmllciAqbW4sIHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKQoreworCXN0cnVj
dCBtbXVfbm90aWZpZXJfcmFuZ2UgcmFuZ2UgPSB7CisJCS5tbSA9IG1tLAorCQkuc3RhcnQgPSAw
LAorCQkuZW5kID0gVUxPTkdfTUFYLAorCQkuZmxhZ3MgPSAwLAorCQkuZXZlbnQgPSBNTVVfTk9U
SUZZX1VOTUFQLAorCX07CisKKwlyYWRlb25fbW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChtbiwg
JnJhbmdlKTsKK30KIAotLyoqCi0gKiByYWRlb25fbW5fZ2V0IC0gY3JlYXRlIG5vdGlmaWVyIGNv
bnRleHQKLSAqCi0gKiBAcmRldjogcmFkZW9uIGRldmljZSBwb2ludGVyCi0gKgotICogQ3JlYXRl
cyBhIG5vdGlmaWVyIGNvbnRleHQgZm9yIGN1cnJlbnQtPm1tLgotICovCi1zdGF0aWMgc3RydWN0
IHJhZGVvbl9tbiAqcmFkZW9uX21uX2dldChzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldikKK3N0
YXRpYyBzdHJ1Y3QgbW11X25vdGlmaWVyICpyYWRlb25fbW5fYWxsb2Nfbm90aWZpZXIoc3RydWN0
IG1tX3N0cnVjdCAqbW0pCiB7Ci0Jc3RydWN0IG1tX3N0cnVjdCAqbW0gPSBjdXJyZW50LT5tbTsK
IAlzdHJ1Y3QgcmFkZW9uX21uICpybW47Ci0JaW50IHI7Ci0KLQlpZiAoZG93bl93cml0ZV9raWxs
YWJsZSgmbW0tPm1tYXBfc2VtKSkKLQkJcmV0dXJuIEVSUl9QVFIoLUVJTlRSKTsKLQotCW11dGV4
X2xvY2soJnJkZXYtPm1uX2xvY2spOwotCi0JaGFzaF9mb3JfZWFjaF9wb3NzaWJsZShyZGV2LT5t
bl9oYXNoLCBybW4sIG5vZGUsICh1bnNpZ25lZCBsb25nKW1tKQotCQlpZiAocm1uLT5tbSA9PSBt
bSkKLQkJCWdvdG8gcmVsZWFzZV9sb2NrczsKIAogCXJtbiA9IGt6YWxsb2Moc2l6ZW9mKCpybW4p
LCBHRlBfS0VSTkVMKTsKLQlpZiAoIXJtbikgewotCQlybW4gPSBFUlJfUFRSKC1FTk9NRU0pOwot
CQlnb3RvIHJlbGVhc2VfbG9ja3M7Ci0JfQorCWlmICghcm1uKQorCQlyZXR1cm4gRVJSX1BUUigt
RU5PTUVNKTsKIAotCXJtbi0+cmRldiA9IHJkZXY7Ci0Jcm1uLT5tbSA9IG1tOwotCXJtbi0+bW4u
b3BzID0gJnJhZGVvbl9tbl9vcHM7CiAJbXV0ZXhfaW5pdCgmcm1uLT5sb2NrKTsKIAlybW4tPm9i
amVjdHMgPSBSQl9ST09UX0NBQ0hFRDsKLQkKLQlyID0gX19tbXVfbm90aWZpZXJfcmVnaXN0ZXIo
JnJtbi0+bW4sIG1tKTsKLQlpZiAocikKLQkJZ290byBmcmVlX3JtbjsKLQotCWhhc2hfYWRkKHJk
ZXYtPm1uX2hhc2gsICZybW4tPm5vZGUsICh1bnNpZ25lZCBsb25nKW1tKTsKLQotcmVsZWFzZV9s
b2NrczoKLQltdXRleF91bmxvY2soJnJkZXYtPm1uX2xvY2spOwotCXVwX3dyaXRlKCZtbS0+bW1h
cF9zZW0pOwotCi0JcmV0dXJuIHJtbjsKLQotZnJlZV9ybW46Ci0JbXV0ZXhfdW5sb2NrKCZyZGV2
LT5tbl9sb2NrKTsKLQl1cF93cml0ZSgmbW0tPm1tYXBfc2VtKTsKLQlrZnJlZShybW4pOworCXJl
dHVybiAmcm1uLT5tbjsKK30KIAotCXJldHVybiBFUlJfUFRSKHIpOworc3RhdGljIHZvaWQgcmFk
ZW9uX21uX2ZyZWVfbm90aWZpZXIoc3RydWN0IG1tdV9ub3RpZmllciAqbW4pCit7CisJa2ZyZWUo
Y29udGFpbmVyX29mKG1uLCBzdHJ1Y3QgcmFkZW9uX21uLCBtbikpOwogfQogCitzdGF0aWMgY29u
c3Qgc3RydWN0IG1tdV9ub3RpZmllcl9vcHMgcmFkZW9uX21uX29wcyA9IHsKKwkucmVsZWFzZSA9
IHJhZGVvbl9tbl9yZWxlYXNlLAorCS5pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0ID0gcmFkZW9uX21u
X2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQsCisJLmFsbG9jX25vdGlmaWVyID0gcmFkZW9uX21uX2Fs
bG9jX25vdGlmaWVyLAorCS5mcmVlX25vdGlmaWVyID0gcmFkZW9uX21uX2ZyZWVfbm90aWZpZXIs
Cit9OworCiAvKioKICAqIHJhZGVvbl9tbl9yZWdpc3RlciAtIHJlZ2lzdGVyIGEgQk8gZm9yIG5v
dGlmaWVyIHVwZGF0ZXMKICAqCkBAIC0yNTQsMTUgKzE3NSwxNiBAQCBzdGF0aWMgc3RydWN0IHJh
ZGVvbl9tbiAqcmFkZW9uX21uX2dldChzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldikKIGludCBy
YWRlb25fbW5fcmVnaXN0ZXIoc3RydWN0IHJhZGVvbl9ibyAqYm8sIHVuc2lnbmVkIGxvbmcgYWRk
cikKIHsKIAl1bnNpZ25lZCBsb25nIGVuZCA9IGFkZHIgKyByYWRlb25fYm9fc2l6ZShibykgLSAx
OwotCXN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2ID0gYm8tPnJkZXY7CisJc3RydWN0IG1tdV9u
b3RpZmllciAqbW47CiAJc3RydWN0IHJhZGVvbl9tbiAqcm1uOwogCXN0cnVjdCByYWRlb25fbW5f
bm9kZSAqbm9kZSA9IE5VTEw7CiAJc3RydWN0IGxpc3RfaGVhZCBib3M7CiAJc3RydWN0IGludGVy
dmFsX3RyZWVfbm9kZSAqaXQ7CiAKLQlybW4gPSByYWRlb25fbW5fZ2V0KHJkZXYpOwotCWlmIChJ
U19FUlIocm1uKSkKLQkJcmV0dXJuIFBUUl9FUlIocm1uKTsKKwltbiA9IG1tdV9ub3RpZmllcl9n
ZXQoJnJhZGVvbl9tbl9vcHMsIGN1cnJlbnQtPm1tKTsKKwlpZiAoSVNfRVJSKG1uKSkKKwkJcmV0
dXJuIFBUUl9FUlIobW4pOworCXJtbiA9IGNvbnRhaW5lcl9vZihtbiwgc3RydWN0IHJhZGVvbl9t
biwgbW4pOwogCiAJSU5JVF9MSVNUX0hFQUQoJmJvcyk7CiAKQEAgLTMwOSwyMiArMjMxLDEzIEBA
IGludCByYWRlb25fbW5fcmVnaXN0ZXIoc3RydWN0IHJhZGVvbl9ibyAqYm8sIHVuc2lnbmVkIGxv
bmcgYWRkcikKICAqLwogdm9pZCByYWRlb25fbW5fdW5yZWdpc3RlcihzdHJ1Y3QgcmFkZW9uX2Jv
ICpibykKIHsKLQlzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiA9IGJvLT5yZGV2OwotCXN0cnVj
dCByYWRlb25fbW4gKnJtbjsKKwlzdHJ1Y3QgcmFkZW9uX21uICpybW4gPSBiby0+bW47CiAJc3Ry
dWN0IGxpc3RfaGVhZCAqaGVhZDsKIAotCW11dGV4X2xvY2soJnJkZXYtPm1uX2xvY2spOwotCXJt
biA9IGJvLT5tbjsKLQlpZiAocm1uID09IE5VTEwpIHsKLQkJbXV0ZXhfdW5sb2NrKCZyZGV2LT5t
bl9sb2NrKTsKLQkJcmV0dXJuOwotCX0KLQogCW11dGV4X2xvY2soJnJtbi0+bG9jayk7CiAJLyog
c2F2ZSB0aGUgbmV4dCBsaXN0IGVudHJ5IGZvciBsYXRlciAqLwogCWhlYWQgPSBiby0+bW5fbGlz
dC5uZXh0OwogCi0JYm8tPm1uID0gTlVMTDsKIAlsaXN0X2RlbCgmYm8tPm1uX2xpc3QpOwogCiAJ
aWYgKGxpc3RfZW1wdHkoaGVhZCkpIHsKQEAgLTMzNSw1ICsyNDgsNyBAQCB2b2lkIHJhZGVvbl9t
bl91bnJlZ2lzdGVyKHN0cnVjdCByYWRlb25fYm8gKmJvKQogCX0KIAogCW11dGV4X3VubG9jaygm
cm1uLT5sb2NrKTsKLQltdXRleF91bmxvY2soJnJkZXYtPm1uX2xvY2spOworCisJbW11X25vdGlm
aWVyX3B1dCgmcm1uLT5tbik7CisJYm8tPm1uID0gTlVMTDsKIH0KLS0gCjIuMjIuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxp
bmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
