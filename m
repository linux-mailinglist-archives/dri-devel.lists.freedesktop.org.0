Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D0E64D8996
	for <lists+dri-devel@lfdr.de>; Wed, 16 Oct 2019 09:34:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 388136E8E4;
	Wed, 16 Oct 2019 07:33:50 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pg1-x542.google.com (mail-pg1-x542.google.com
 [IPv6:2607:f8b0:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A54F36E881
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 18:16:40 +0000 (UTC)
Received: by mail-pg1-x542.google.com with SMTP id p30so12632303pgl.2
 for <dri-devel@lists.freedesktop.org>; Tue, 15 Oct 2019 11:16:40 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=WFWRO10+feWff7r6fgmeh5w6Y3QPVjROWE9lwVqn/i8=;
 b=qmd0cJQSPgochnnaYGX3XKouOTsvTMOh2q0VuPvzjTgXngHjXGBWrRr5xT0WY4xkEh
 fLRVB3LOqsYSHNJHyVt5QAJS681avwdFKStYXmuZayDgSUYzZjL3cWiLO8INcMEgu0D/
 SlCJz5//cJdZpW8RrTh301a45D/LLB9UlvECfakQvzMoOWUkmFhQhavywT8ixpyzNjDG
 m1nC5S0VEXhR5knUJboKAfglHhJ0gUZjSJ8DZS2J3dQFdo7qWdjG7yuhUZdt6bonr+Tx
 x0fW6iJ/Dg+qLu6dqIULSOiceiiANGbyBNvReivX0GQEg6Z7Bhx8h1VrRWpE21XbFByT
 VcNQ==
X-Gm-Message-State: APjAAAVoOayVAuutrthvtMhq304q3i6fdCiVAV1GpgowkPc0ztf2GqhI
 wCFGGh9scleRlSkhWPCz3ocRfw==
X-Google-Smtp-Source: APXvYqwcBUTmMtfzkt7tzvsqtJbdQLE7/86WTaqOjVFBlbeV0uObGeL49nnNgpBmIxrl56Z9I63Gfw==
X-Received: by 2002:aa7:9f9b:: with SMTP id z27mr39853337pfr.65.1571163399727; 
 Tue, 15 Oct 2019 11:16:39 -0700 (PDT)
Received: from ziepe.ca ([24.114.26.129])
 by smtp.gmail.com with ESMTPSA id y6sm25518660pfp.82.2019.10.15.11.16.38
 (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
 Tue, 15 Oct 2019 11:16:39 -0700 (PDT)
Received: from jgg by jggl.ziepe.ca with local (Exim 4.90_1)
 (envelope-from <jgg@ziepe.ca>)
 id 1iKRJT-0002Cu-RH; Tue, 15 Oct 2019 15:12:51 -0300
From: Jason Gunthorpe <jgg@ziepe.ca>
To: Jerome Glisse <jglisse@redhat.com>, Ralph Campbell <rcampbell@nvidia.com>,
 John Hubbard <jhubbard@nvidia.com>, Felix.Kuehling@amd.com
Subject: [PATCH hmm 15/15] mm/hmm: remove hmm_mirror and related
Date: Tue, 15 Oct 2019 15:12:42 -0300
Message-Id: <20191015181242.8343-16-jgg@ziepe.ca>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191015181242.8343-1-jgg@ziepe.ca>
References: <20191015181242.8343-1-jgg@ziepe.ca>
MIME-Version: 1.0
X-Mailman-Approved-At: Wed, 16 Oct 2019 07:33:45 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ziepe.ca; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=WFWRO10+feWff7r6fgmeh5w6Y3QPVjROWE9lwVqn/i8=;
 b=k4hbQSPrqznVf/5ZnM7x5J4seFc1YAeDg8waTuZOs9CkrIPaaSVB71IIQKnkb+I9M8
 YzXu6IJuH9tkROTv3YGUt/CV/lzAQb4zUFOtx9dDDURZ2bIwyQp42dPF1LsgD9TkSD1H
 AZ5IMtwNJEOiu8aqymqw4AbNIvD0H0rRHH02mAQr8zBrSGpkhLZ58JRXwulRwBlPijkO
 YoYURzkUOhAkBJbWVEkGhYtc32DOD+5VuPxKPwJkAnQoxaBzrB+c3XSFE833ZgvBIlqZ
 fqWltqEnK7aPbVd3yTfCyTrSzLOv2IYndGxHZOparqhbPIKvqGdJWDc3TIY7UUgU9MDm
 GiHw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Andrea Arcangeli <aarcange@redhat.com>, linux-rdma@vger.kernel.org,
 amd-gfx@lists.freedesktop.org, linux-mm@kvack.org,
 Jason Gunthorpe <jgg@mellanox.com>, dri-devel@lists.freedesktop.org,
 Ben Skeggs <bskeggs@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogSmFzb24gR3VudGhvcnBlIDxqZ2dAbWVsbGFub3guY29tPgoKVGhlIG9ubHkgdHdvIHVz
ZXJzIG9mIHRoaXMgYXJlIG5vdyBjb252ZXJ0ZWQgdG8gdXNlIG1tdV9yYW5nZV9ub3RpZmllciwK
ZGVsZXRlIGFsbCB0aGUgY29kZSBhbmQgdXBkYXRlIGhtbS5yc3QuCgpTaWduZWQtb2ZmLWJ5OiBK
YXNvbiBHdW50aG9ycGUgPGpnZ0BtZWxsYW5veC5jb20+Ci0tLQogRG9jdW1lbnRhdGlvbi92bS9o
bW0ucnN0IHwgMTA1ICsrKystLS0tLS0tLS0tLQogaW5jbHVkZS9saW51eC9obW0uaCAgICAgIHwg
MTgzICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIG1tL0tjb25maWcgICAgICAgICAgICAgICB8
ICAgMSAtCiBtbS9obW0uYyAgICAgICAgICAgICAgICAgfCAyODQgKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDMzIGluc2VydGlvbnMoKyks
IDU0MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL3ZtL2htbS5yc3Qg
Yi9Eb2N1bWVudGF0aW9uL3ZtL2htbS5yc3QKaW5kZXggMGE1OTYwYmVjY2Y3NmQuLmEyNDc2NDMw
MzVjNGUyIDEwMDY0NAotLS0gYS9Eb2N1bWVudGF0aW9uL3ZtL2htbS5yc3QKKysrIGIvRG9jdW1l
bnRhdGlvbi92bS9obW0ucnN0CkBAIC0xNDcsNDkgKzE0NywxNiBAQCBBZGRyZXNzIHNwYWNlIG1p
cnJvcmluZyBpbXBsZW1lbnRhdGlvbiBhbmQgQVBJCiBBZGRyZXNzIHNwYWNlIG1pcnJvcmluZydz
IG1haW4gb2JqZWN0aXZlIGlzIHRvIGFsbG93IGR1cGxpY2F0aW9uIG9mIGEgcmFuZ2Ugb2YKIENQ
VSBwYWdlIHRhYmxlIGludG8gYSBkZXZpY2UgcGFnZSB0YWJsZTsgSE1NIGhlbHBzIGtlZXAgYm90
aCBzeW5jaHJvbml6ZWQuIEEKIGRldmljZSBkcml2ZXIgdGhhdCB3YW50cyB0byBtaXJyb3IgYSBw
cm9jZXNzIGFkZHJlc3Mgc3BhY2UgbXVzdCBzdGFydCB3aXRoIHRoZQotcmVnaXN0cmF0aW9uIG9m
IGFuIGhtbV9taXJyb3Igc3RydWN0OjoKLQotIGludCBobW1fbWlycm9yX3JlZ2lzdGVyKHN0cnVj
dCBobW1fbWlycm9yICptaXJyb3IsCi0gICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IG1t
X3N0cnVjdCAqbW0pOwotCi1UaGUgbWlycm9yIHN0cnVjdCBoYXMgYSBzZXQgb2YgY2FsbGJhY2tz
IHRoYXQgYXJlIHVzZWQKLXRvIHByb3BhZ2F0ZSBDUFUgcGFnZSB0YWJsZXM6OgotCi0gc3RydWN0
IGhtbV9taXJyb3Jfb3BzIHsKLSAgICAgLyogcmVsZWFzZSgpIC0gcmVsZWFzZSBobW1fbWlycm9y
Ci0gICAgICAqCi0gICAgICAqIEBtaXJyb3I6IHBvaW50ZXIgdG8gc3RydWN0IGhtbV9taXJyb3IK
LSAgICAgICoKLSAgICAgICogVGhpcyBpcyBjYWxsZWQgd2hlbiB0aGUgbW1fc3RydWN0IGlzIGJl
aW5nIHJlbGVhc2VkLiAgVGhlIGNhbGxiYWNrCi0gICAgICAqIG11c3QgZW5zdXJlIHRoYXQgYWxs
IGFjY2VzcyB0byBhbnkgcGFnZXMgb2J0YWluZWQgZnJvbSB0aGlzIG1pcnJvcgotICAgICAgKiBp
cyBoYWx0ZWQgYmVmb3JlIHRoZSBjYWxsYmFjayByZXR1cm5zLiBBbGwgZnV0dXJlIGFjY2VzcyBz
aG91bGQKLSAgICAgICogZmF1bHQuCi0gICAgICAqLwotICAgICB2b2lkICgqcmVsZWFzZSkoc3Ry
dWN0IGhtbV9taXJyb3IgKm1pcnJvcik7Ci0KLSAgICAgLyogc3luY19jcHVfZGV2aWNlX3BhZ2V0
YWJsZXMoKSAtIHN5bmNocm9uaXplIHBhZ2UgdGFibGVzCi0gICAgICAqCi0gICAgICAqIEBtaXJy
b3I6IHBvaW50ZXIgdG8gc3RydWN0IGhtbV9taXJyb3IKLSAgICAgICogQHVwZGF0ZTogdXBkYXRl
IGluZm9ybWF0aW9uIChzZWUgc3RydWN0IG1tdV9ub3RpZmllcl9yYW5nZSkKLSAgICAgICogUmV0
dXJuOiAtRUFHQUlOIGlmIHVwZGF0ZS5ibG9ja2FibGUgZmFsc2UgYW5kIGNhbGxiYWNrIG5lZWQg
dG8KLSAgICAgICogICAgICAgICBibG9jaywgMCBvdGhlcndpc2UuCi0gICAgICAqCi0gICAgICAq
IFRoaXMgY2FsbGJhY2sgdWx0aW1hdGVseSBvcmlnaW5hdGVzIGZyb20gbW11X25vdGlmaWVycyB3
aGVuIHRoZSBDUFUKLSAgICAgICogcGFnZSB0YWJsZSBpcyB1cGRhdGVkLiBUaGUgZGV2aWNlIGRy
aXZlciBtdXN0IHVwZGF0ZSBpdHMgcGFnZSB0YWJsZQotICAgICAgKiBpbiByZXNwb25zZSB0byB0
aGlzIGNhbGxiYWNrLiBUaGUgdXBkYXRlIGFyZ3VtZW50IHRlbGxzIHdoYXQgYWN0aW9uCi0gICAg
ICAqIHRvIHBlcmZvcm0uCi0gICAgICAqCi0gICAgICAqIFRoZSBkZXZpY2UgZHJpdmVyIG11c3Qg
bm90IHJldHVybiBmcm9tIHRoaXMgY2FsbGJhY2sgdW50aWwgdGhlIGRldmljZQotICAgICAgKiBw
YWdlIHRhYmxlcyBhcmUgY29tcGxldGVseSB1cGRhdGVkIChUTEJzIGZsdXNoZWQsIGV0Yyk7IHRo
aXMgaXMgYQotICAgICAgKiBzeW5jaHJvbm91cyBjYWxsLgotICAgICAgKi8KLSAgICAgaW50ICgq
c3luY19jcHVfZGV2aWNlX3BhZ2V0YWJsZXMpKHN0cnVjdCBobW1fbWlycm9yICptaXJyb3IsCi0g
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJ1Y3QgaG1tX3Vw
ZGF0ZSAqdXBkYXRlKTsKLSB9OwotCi1UaGUgZGV2aWNlIGRyaXZlciBtdXN0IHBlcmZvcm0gdGhl
IHVwZGF0ZSBhY3Rpb24gdG8gdGhlIHJhbmdlIChtYXJrIHJhbmdlCi1yZWFkIG9ubHksIG9yIGZ1
bGx5IHVubWFwLCBldGMuKS4gVGhlIGRldmljZSBtdXN0IGNvbXBsZXRlIHRoZSB1cGRhdGUgYmVm
b3JlCi10aGUgZHJpdmVyIGNhbGxiYWNrIHJldHVybnMuCityZWdpc3RyYXRpb24gb2YgYSBtbXVf
cmFuZ2Vfbm90aWZpZXI6OgorCisgbXJuLT5vcHMgPSAmZHJpdmVyX29wczsKKyBpbnQgbW11X3Jh
bmdlX25vdGlmaWVyX2luc2VydChzdHJ1Y3QgbW11X3JhbmdlX25vdGlmaWVyICptcm4sCisJCQkg
ICAgICB1bnNpZ25lZCBsb25nIHN0YXJ0LCB1bnNpZ25lZCBsb25nIGxlbmd0aCwKKwkJCSAgICAg
IHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKTsKKworRHVyaW5nIHRoZSBkcml2ZXJfb3BzLT5pbnZhbGlk
YXRlKCkgY2FsbGJhY2sgdGhlIGRldmljZSBkcml2ZXIgbXVzdCBwZXJmb3JtCit0aGUgdXBkYXRl
IGFjdGlvbiB0byB0aGUgcmFuZ2UgKG1hcmsgcmFuZ2UgcmVhZCBvbmx5LCBvciBmdWxseSB1bm1h
cCwKK2V0Yy4pLiBUaGUgZGV2aWNlIG11c3QgY29tcGxldGUgdGhlIHVwZGF0ZSBiZWZvcmUgdGhl
IGRyaXZlciBjYWxsYmFjayByZXR1cm5zLgogCiBXaGVuIHRoZSBkZXZpY2UgZHJpdmVyIHdhbnRz
IHRvIHBvcHVsYXRlIGEgcmFuZ2Ugb2YgdmlydHVhbCBhZGRyZXNzZXMsIGl0IGNhbgogdXNlOjoK
QEAgLTIxNiw3MCArMTgzLDQ2IEBAIFRoZSB1c2FnZSBwYXR0ZXJuIGlzOjoKICAgICAgIHN0cnVj
dCBobW1fcmFuZ2UgcmFuZ2U7CiAgICAgICAuLi4KIAorICAgICAgcmFuZ2Uubm90aWZpZXIgPSAm
bXJuOwogICAgICAgcmFuZ2Uuc3RhcnQgPSAuLi47CiAgICAgICByYW5nZS5lbmQgPSAuLi47CiAg
ICAgICByYW5nZS5wZm5zID0gLi4uOwogICAgICAgcmFuZ2UuZmxhZ3MgPSAuLi47CiAgICAgICBy
YW5nZS52YWx1ZXMgPSAuLi47CiAgICAgICByYW5nZS5wZm5fc2hpZnQgPSAuLi47Ci0gICAgICBo
bW1fcmFuZ2VfcmVnaXN0ZXIoJnJhbmdlLCBtaXJyb3IpOwogCi0gICAgICAvKgotICAgICAgICog
SnVzdCB3YWl0IGZvciByYW5nZSB0byBiZSB2YWxpZCwgc2FmZSB0byBpZ25vcmUgcmV0dXJuIHZh
bHVlIGFzIHdlCi0gICAgICAgKiB3aWxsIHVzZSB0aGUgcmV0dXJuIHZhbHVlIG9mIGhtbV9yYW5n
ZV9mYXVsdCgpIGJlbG93IHVuZGVyIHRoZQotICAgICAgICogbW1hcF9zZW0gdG8gYXNjZXJ0YWlu
IHRoZSB2YWxpZGl0eSBvZiB0aGUgcmFuZ2UuCi0gICAgICAgKi8KLSAgICAgIGhtbV9yYW5nZV93
YWl0X3VudGlsX3ZhbGlkKCZyYW5nZSwgVElNRU9VVF9JTl9NU0VDKTsKKyAgICAgIGlmICghbW1n
ZXRfbm90X3plcm8obXJuLT5ub3RpZmllci5tbSkpCisgICAgICAgICAgcmV0dXJuIC1FRkFVTFQ7
CiAKICBhZ2FpbjoKKyAgICAgIHJhbmdlLm5vdGlmaWVyX3NlcSA9IG1tdV9yYW5nZV9yZWFkX2Jl
Z2luKCZtcm4pOwogICAgICAgZG93bl9yZWFkKCZtbS0+bW1hcF9zZW0pOwogICAgICAgcmV0ID0g
aG1tX3JhbmdlX2ZhdWx0KCZyYW5nZSwgSE1NX1JBTkdFX1NOQVBTSE9UKTsKICAgICAgIGlmIChy
ZXQpIHsKICAgICAgICAgICB1cF9yZWFkKCZtbS0+bW1hcF9zZW0pOwotICAgICAgICAgIGlmIChy
ZXQgPT0gLUVCVVNZKSB7Ci0gICAgICAgICAgICAvKgotICAgICAgICAgICAgICogTm8gbmVlZCB0
byBjaGVjayBobW1fcmFuZ2Vfd2FpdF91bnRpbF92YWxpZCgpIHJldHVybiB2YWx1ZQotICAgICAg
ICAgICAgICogb24gcmV0cnkgd2Ugd2lsbCBnZXQgcHJvcGVyIGVycm9yIHdpdGggaG1tX3Jhbmdl
X2ZhdWx0KCkKLSAgICAgICAgICAgICAqLwotICAgICAgICAgICAgaG1tX3JhbmdlX3dhaXRfdW50
aWxfdmFsaWQoJnJhbmdlLCBUSU1FT1VUX0lOX01TRUMpOwotICAgICAgICAgICAgZ290byBhZ2Fp
bjsKLSAgICAgICAgICB9Ci0gICAgICAgICAgaG1tX3JhbmdlX3VucmVnaXN0ZXIoJnJhbmdlKTsK
KyAgICAgICAgICBpZiAocmV0ID09IC1FQlVTWSkKKyAgICAgICAgICAgICAgICAgZ290byBhZ2Fp
bjsKICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgfQorICAgICAgdXBfcmVhZCgmbW0tPm1t
YXBfc2VtKTsKKwogICAgICAgdGFrZV9sb2NrKGRyaXZlci0+dXBkYXRlKTsKLSAgICAgIGlmICgh
aG1tX3JhbmdlX3ZhbGlkKCZyYW5nZSkpIHsKKyAgICAgIGlmIChtbXVfcmFuZ2VfcmVhZF9yZXRy
eSgmbXJuLCByYW5nZS5ub3RpZmllcl9zZXEpIHsKICAgICAgICAgICByZWxlYXNlX2xvY2soZHJp
dmVyLT51cGRhdGUpOwotICAgICAgICAgIHVwX3JlYWQoJm1tLT5tbWFwX3NlbSk7CiAgICAgICAg
ICAgZ290byBhZ2FpbjsKICAgICAgIH0KIAotICAgICAgLy8gVXNlIHBmbnMgYXJyYXkgY29udGVu
dCB0byB1cGRhdGUgZGV2aWNlIHBhZ2UgdGFibGUKKyAgICAgIC8qIFVzZSBwZm5zIGFycmF5IGNv
bnRlbnQgdG8gdXBkYXRlIGRldmljZSBwYWdlIHRhYmxlLAorICAgICAgICogdW5kZXIgdGhlIHVw
ZGF0ZSBsb2NrICovCiAKLSAgICAgIGhtbV9yYW5nZV91bnJlZ2lzdGVyKCZyYW5nZSk7CiAgICAg
ICByZWxlYXNlX2xvY2soZHJpdmVyLT51cGRhdGUpOwotICAgICAgdXBfcmVhZCgmbW0tPm1tYXBf
c2VtKTsKICAgICAgIHJldHVybiAwOwogIH0KIAogVGhlIGRyaXZlci0+dXBkYXRlIGxvY2sgaXMg
dGhlIHNhbWUgbG9jayB0aGF0IHRoZSBkcml2ZXIgdGFrZXMgaW5zaWRlIGl0cwotc3luY19jcHVf
ZGV2aWNlX3BhZ2V0YWJsZXMoKSBjYWxsYmFjay4gVGhhdCBsb2NrIG11c3QgYmUgaGVsZCBiZWZv
cmUgY2FsbGluZwotaG1tX3JhbmdlX3ZhbGlkKCkgdG8gYXZvaWQgYW55IHJhY2Ugd2l0aCBhIGNv
bmN1cnJlbnQgQ1BVIHBhZ2UgdGFibGUgdXBkYXRlLgotCi1ITU0gaW1wbGVtZW50cyBhbGwgdGhp
cyBvbiB0b3Agb2YgdGhlIG1tdV9ub3RpZmllciBBUEkgYmVjYXVzZSB3ZSB3YW50ZWQgYQotc2lt
cGxlciBBUEkgYW5kIGFsc28gdG8gYmUgYWJsZSB0byBwZXJmb3JtIG9wdGltaXphdGlvbnMgbGF0
dGVyIG9uIGxpa2UgZG9pbmcKLWNvbmN1cnJlbnQgZGV2aWNlIHVwZGF0ZXMgaW4gbXVsdGktZGV2
aWNlcyBzY2VuYXJpby4KLQotSE1NIGFsc28gc2VydmVzIGFzIGFuIGltcGVkYW5jZSBtaXNtYXRj
aCBiZXR3ZWVuIGhvdyBDUFUgcGFnZSB0YWJsZSB1cGRhdGVzCi1hcmUgZG9uZSAoYnkgQ1BVIHdy
aXRlIHRvIHRoZSBwYWdlIHRhYmxlIGFuZCBUTEIgZmx1c2hlcykgYW5kIGhvdyBkZXZpY2VzCi11
cGRhdGUgdGhlaXIgb3duIHBhZ2UgdGFibGUuIERldmljZSB1cGRhdGVzIGFyZSBhIG11bHRpLXN0
ZXAgcHJvY2Vzcy4gRmlyc3QsCi1hcHByb3ByaWF0ZSBjb21tYW5kcyBhcmUgd3JpdHRlbiB0byBh
IGJ1ZmZlciwgdGhlbiB0aGlzIGJ1ZmZlciBpcyBzY2hlZHVsZWQgZm9yCi1leGVjdXRpb24gb24g
dGhlIGRldmljZS4gSXQgaXMgb25seSBvbmNlIHRoZSBkZXZpY2UgaGFzIGV4ZWN1dGVkIGNvbW1h
bmRzIGluCi10aGUgYnVmZmVyIHRoYXQgdGhlIHVwZGF0ZSBpcyBkb25lLiBDcmVhdGluZyBhbmQg
c2NoZWR1bGluZyB0aGUgdXBkYXRlIGNvbW1hbmQKLWJ1ZmZlciBjYW4gaGFwcGVuIGNvbmN1cnJl
bnRseSBmb3IgbXVsdGlwbGUgZGV2aWNlcy4gV2FpdGluZyBmb3IgZWFjaCBkZXZpY2UgdG8KLXJl
cG9ydCBjb21tYW5kcyBhcyBleGVjdXRlZCBpcyBzZXJpYWxpemVkICh0aGVyZSBpcyBubyBwb2lu
dCBpbiBkb2luZyB0aGlzCi1jb25jdXJyZW50bHkpLgotCitpbnZhbGlkYXRlKCkgY2FsbGJhY2su
IFRoYXQgbG9jayBtdXN0IGJlIGhlbGQgYmVmb3JlIGNhbGxpbmcKK21tdV9yYW5nZV9yZWFkX3Jl
dHJ5KCkgdG8gYXZvaWQgYW55IHJhY2Ugd2l0aCBhIGNvbmN1cnJlbnQgQ1BVIHBhZ2UgdGFibGUK
K3VwZGF0ZS4KIAogTGV2ZXJhZ2UgZGVmYXVsdF9mbGFncyBhbmQgcGZuX2ZsYWdzX21hc2sKID09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmRpZmYgLS1naXQgYS9pbmNs
dWRlL2xpbnV4L2htbS5oIGIvaW5jbHVkZS9saW51eC9obW0uaAppbmRleCAyNjY2ZWIwOGE0MDYx
NS4uYjRhZjUxNzM1MjMyMzIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvaG1tLmgKKysrIGIv
aW5jbHVkZS9saW51eC9obW0uaApAQCAtNjgsMjkgKzY4LDYgQEAKICNpbmNsdWRlIDxsaW51eC9j
b21wbGV0aW9uLmg+CiAjaW5jbHVkZSA8bGludXgvbW11X25vdGlmaWVyLmg+CiAKLQotLyoKLSAq
IHN0cnVjdCBobW0gLSBITU0gcGVyIG1tIHN0cnVjdAotICoKLSAqIEBtbTogbW0gc3RydWN0IHRo
aXMgSE1NIHN0cnVjdCBpcyBib3VuZCB0bwotICogQGxvY2s6IGxvY2sgcHJvdGVjdGluZyByYW5n
ZXMgbGlzdAotICogQHJhbmdlczogbGlzdCBvZiByYW5nZSBiZWluZyBzbmFwc2hvdHRlZAotICog
QG1pcnJvcnM6IGxpc3Qgb2YgbWlycm9ycyBmb3IgdGhpcyBtbQotICogQG1tdV9ub3RpZmllcjog
bW11IG5vdGlmaWVyIHRvIHRyYWNrIHVwZGF0ZXMgdG8gQ1BVIHBhZ2UgdGFibGUKLSAqIEBtaXJy
b3JzX3NlbTogcmVhZC93cml0ZSBzZW1hcGhvcmUgcHJvdGVjdGluZyB0aGUgbWlycm9ycyBsaXN0
Ci0gKiBAd3E6IHdhaXQgcXVldWUgZm9yIHVzZXIgd2FpdGluZyBvbiBhIHJhbmdlIGludmFsaWRh
dGlvbgotICogQG5vdGlmaWVyczogY291bnQgb2YgYWN0aXZlIG1tdSBub3RpZmllcnMKLSAqLwot
c3RydWN0IGhtbSB7Ci0Jc3RydWN0IG1tdV9ub3RpZmllcgltbXVfbm90aWZpZXI7Ci0Jc3Bpbmxv
Y2tfdAkJcmFuZ2VzX2xvY2s7Ci0Jc3RydWN0IGxpc3RfaGVhZAlyYW5nZXM7Ci0Jc3RydWN0IGxp
c3RfaGVhZAltaXJyb3JzOwotCXN0cnVjdCByd19zZW1hcGhvcmUJbWlycm9yc19zZW07Ci0Jd2Fp
dF9xdWV1ZV9oZWFkX3QJd3E7Ci0JbG9uZwkJCW5vdGlmaWVyczsKLX07Ci0KIC8qCiAgKiBobW1f
cGZuX2ZsYWdfZSAtIEhNTSBmbGFnIGVudW1zCiAgKgpAQCAtMTQzLDkgKzEyMCw4IEBAIGVudW0g
aG1tX3Bmbl92YWx1ZV9lIHsKIC8qCiAgKiBzdHJ1Y3QgaG1tX3JhbmdlIC0gdHJhY2sgaW52YWxp
ZGF0aW9uIGxvY2sgb24gdmlydHVhbCBhZGRyZXNzIHJhbmdlCiAgKgotICogQG5vdGlmaWVyOiBh
biBvcHRpb25hbCBtbXVfcmFuZ2Vfbm90aWZpZXIKLSAqIEBub3RpZmllcl9zZXE6IHdoZW4gbm90
aWZpZXIgaXMgdXNlZCB0aGlzIGlzIHRoZSByZXN1bHQgb2YKLSAqICAgICAgICAgICAgICAgIG1t
dV9yYW5nZV9yZWFkX2JlZ2luKCkKKyAqIEBub3RpZmllcjogYSBtbXVfcmFuZ2Vfbm90aWZpZXIg
dGhhdCBpbmNsdWRlcyB0aGUgc3RhcnQvZW5kCisgKiBAbm90aWZpZXJfc2VxOiByZXN1bHQgb2Yg
bW11X3JhbmdlX3JlYWRfYmVnaW4oKQogICogQGhtbTogdGhlIGNvcmUgSE1NIHN0cnVjdHVyZSB0
aGlzIHJhbmdlIGlzIGFjdGl2ZSBhZ2FpbnN0CiAgKiBAdm1hOiB0aGUgdm0gYXJlYSBzdHJ1Y3Qg
Zm9yIHRoZSByYW5nZQogICogQGxpc3Q6IGFsbCByYW5nZSBsb2NrIGFyZSBvbiBhIGxpc3QKQEAg
LTE2Miw4ICsxMzgsNiBAQCBlbnVtIGhtbV9wZm5fdmFsdWVfZSB7CiBzdHJ1Y3QgaG1tX3Jhbmdl
IHsKIAlzdHJ1Y3QgbW11X3JhbmdlX25vdGlmaWVyICpub3RpZmllcjsKIAl1bnNpZ25lZCBsb25n
CQlub3RpZmllcl9zZXE7Ci0Jc3RydWN0IGhtbQkJKmhtbTsKLQlzdHJ1Y3QgbGlzdF9oZWFkCWxp
c3Q7CiAJdW5zaWduZWQgbG9uZwkJc3RhcnQ7CiAJdW5zaWduZWQgbG9uZwkJZW5kOwogCXVpbnQ2
NF90CQkqcGZuczsKQEAgLTE3MiwzMiArMTQ2LDggQEAgc3RydWN0IGhtbV9yYW5nZSB7CiAJdWlu
dDY0X3QJCWRlZmF1bHRfZmxhZ3M7CiAJdWludDY0X3QJCXBmbl9mbGFnc19tYXNrOwogCXVpbnQ4
X3QJCQlwZm5fc2hpZnQ7Ci0JYm9vbAkJCXZhbGlkOwogfTsKIAotLyoKLSAqIGhtbV9yYW5nZV93
YWl0X3VudGlsX3ZhbGlkKCkgLSB3YWl0IGZvciByYW5nZSB0byBiZSB2YWxpZAotICogQHJhbmdl
OiByYW5nZSBhZmZlY3RlZCBieSBpbnZhbGlkYXRpb24gdG8gd2FpdCBvbgotICogQHRpbWVvdXQ6
IHRpbWUgb3V0IGZvciB3YWl0IGluIG1zIChpZSBhYm9ydCB3YWl0IGFmdGVyIHRoYXQgcGVyaW9k
IG9mIHRpbWUpCi0gKiBSZXR1cm46IHRydWUgaWYgdGhlIHJhbmdlIGlzIHZhbGlkLCBmYWxzZSBv
dGhlcndpc2UuCi0gKi8KLXN0YXRpYyBpbmxpbmUgYm9vbCBobW1fcmFuZ2Vfd2FpdF91bnRpbF92
YWxpZChzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSwKLQkJCQkJICAgICAgdW5zaWduZWQgbG9uZyB0
aW1lb3V0KQotewotCXJldHVybiB3YWl0X2V2ZW50X3RpbWVvdXQocmFuZ2UtPmhtbS0+d3EsIHJh
bmdlLT52YWxpZCwKLQkJCQkgIG1zZWNzX3RvX2ppZmZpZXModGltZW91dCkpICE9IDA7Ci19Ci0K
LS8qCi0gKiBobW1fcmFuZ2VfdmFsaWQoKSAtIHRlc3QgaWYgYSByYW5nZSBpcyB2YWxpZCBvciBu
b3QKLSAqIEByYW5nZTogcmFuZ2UKLSAqIFJldHVybjogdHJ1ZSBpZiB0aGUgcmFuZ2UgaXMgdmFs
aWQsIGZhbHNlIG90aGVyd2lzZS4KLSAqLwotc3RhdGljIGlubGluZSBib29sIGhtbV9yYW5nZV92
YWxpZChzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSkKLXsKLQlyZXR1cm4gcmFuZ2UtPnZhbGlkOwot
fQotCiAvKgogICogaG1tX2RldmljZV9lbnRyeV90b19wYWdlKCkgLSByZXR1cm4gc3RydWN0IHBh
Z2UgcG9pbnRlZCB0byBieSBhIGRldmljZSBlbnRyeQogICogQHJhbmdlOiByYW5nZSB1c2UgdG8g
ZGVjb2RlIGRldmljZSBlbnRyeSB2YWx1ZQpAQCAtMjY3LDExMSArMjE3LDYgQEAgc3RhdGljIGlu
bGluZSB1aW50NjRfdCBobW1fZGV2aWNlX2VudHJ5X2Zyb21fcGZuKGNvbnN0IHN0cnVjdCBobW1f
cmFuZ2UgKnJhbmdlLAogCQlyYW5nZS0+ZmxhZ3NbSE1NX1BGTl9WQUxJRF07CiB9CiAKLS8qCi0g
KiBNaXJyb3Jpbmc6IGhvdyB0byBzeW5jaHJvbml6ZSBkZXZpY2UgcGFnZSB0YWJsZSB3aXRoIENQ
VSBwYWdlIHRhYmxlLgotICoKLSAqIEEgZGV2aWNlIGRyaXZlciB0aGF0IGlzIHBhcnRpY2lwYXRp
bmcgaW4gSE1NIG1pcnJvcmluZyBtdXN0IGFsd2F5cwotICogc3luY2hyb25pemUgd2l0aCBDUFUg
cGFnZSB0YWJsZSB1cGRhdGVzLiBGb3IgdGhpcywgZGV2aWNlIGRyaXZlcnMgY2FuIGVpdGhlcgot
ICogZGlyZWN0bHkgdXNlIG1tdV9ub3RpZmllciBBUElzIG9yIHRoZXkgY2FuIHVzZSB0aGUgaG1t
X21pcnJvciBBUEkuIERldmljZQotICogZHJpdmVycyBjYW4gZGVjaWRlIHRvIHJlZ2lzdGVyIG9u
ZSBtaXJyb3IgcGVyIGRldmljZSBwZXIgcHJvY2Vzcywgb3IganVzdAotICogb25lIG1pcnJvciBw
ZXIgcHJvY2VzcyBmb3IgYSBncm91cCBvZiBkZXZpY2VzLiBUaGUgcGF0dGVybiBpczoKLSAqCi0g
KiAgICAgIGludCBkZXZpY2VfYmluZF9hZGRyZXNzX3NwYWNlKC4uLiwgc3RydWN0IG1tX3N0cnVj
dCAqbW0sIC4uLikKLSAqICAgICAgewotICogICAgICAgICAgc3RydWN0IGRldmljZV9hZGRyZXNz
X3NwYWNlICpkYXM7Ci0gKgotICogICAgICAgICAgLy8gRGV2aWNlIGRyaXZlciBzcGVjaWZpYyBp
bml0aWFsaXphdGlvbiwgYW5kIGFsbG9jYXRpb24gb2YgZGFzCi0gKiAgICAgICAgICAvLyB3aGlj
aCBjb250YWlucyBhbiBobW1fbWlycm9yIHN0cnVjdCBhcyBvbmUgb2YgaXRzIGZpZWxkcy4KLSAq
ICAgICAgICAgIC4uLgotICoKLSAqICAgICAgICAgIHJldCA9IGhtbV9taXJyb3JfcmVnaXN0ZXIo
JmRhcy0+bWlycm9yLCBtbSwgJmRldmljZV9taXJyb3Jfb3BzKTsKLSAqICAgICAgICAgIGlmIChy
ZXQpIHsKLSAqICAgICAgICAgICAgICAvLyBDbGVhbnVwIG9uIGVycm9yCi0gKiAgICAgICAgICAg
ICAgcmV0dXJuIHJldDsKLSAqICAgICAgICAgIH0KLSAqCi0gKiAgICAgICAgICAvLyBPdGhlciBk
ZXZpY2UgZHJpdmVyIHNwZWNpZmljIGluaXRpYWxpemF0aW9uCi0gKiAgICAgICAgICAuLi4KLSAq
ICAgICAgfQotICoKLSAqIE9uY2UgYW4gaG1tX21pcnJvciBpcyByZWdpc3RlcmVkIGZvciBhbiBh
ZGRyZXNzIHNwYWNlLCB0aGUgZGV2aWNlIGRyaXZlcgotICogd2lsbCBnZXQgY2FsbGJhY2tzIHRo
cm91Z2ggc3luY19jcHVfZGV2aWNlX3BhZ2V0YWJsZXMoKSBvcGVyYXRpb24gKHNlZQotICogaG1t
X21pcnJvcl9vcHMgc3RydWN0KS4KLSAqCi0gKiBEZXZpY2UgZHJpdmVyIG11c3Qgbm90IGZyZWUg
dGhlIHN0cnVjdCBjb250YWluaW5nIHRoZSBobW1fbWlycm9yIHN0cnVjdAotICogYmVmb3JlIGNh
bGxpbmcgaG1tX21pcnJvcl91bnJlZ2lzdGVyKCkuIFRoZSBleHBlY3RlZCB1c2FnZSBpcyB0byBk
byB0aGF0IHdoZW4KLSAqIHRoZSBkZXZpY2UgZHJpdmVyIGlzIHVuYmluZGluZyBmcm9tIGFuIGFk
ZHJlc3Mgc3BhY2UuCi0gKgotICoKLSAqICAgICAgdm9pZCBkZXZpY2VfdW5iaW5kX2FkZHJlc3Nf
c3BhY2Uoc3RydWN0IGRldmljZV9hZGRyZXNzX3NwYWNlICpkYXMpCi0gKiAgICAgIHsKLSAqICAg
ICAgICAgIC8vIERldmljZSBkcml2ZXIgc3BlY2lmaWMgY2xlYW51cAotICogICAgICAgICAgLi4u
Ci0gKgotICogICAgICAgICAgaG1tX21pcnJvcl91bnJlZ2lzdGVyKCZkYXMtPm1pcnJvcik7Ci0g
KgotICogICAgICAgICAgLy8gT3RoZXIgZGV2aWNlIGRyaXZlciBzcGVjaWZpYyBjbGVhbnVwLCBh
bmQgbm93IGRhcyBjYW4gYmUgZnJlZWQKLSAqICAgICAgICAgIC4uLgotICogICAgICB9Ci0gKi8K
LQotc3RydWN0IGhtbV9taXJyb3I7Ci0KLS8qCi0gKiBzdHJ1Y3QgaG1tX21pcnJvcl9vcHMgLSBI
TU0gbWlycm9yIGRldmljZSBvcGVyYXRpb25zIGNhbGxiYWNrCi0gKgotICogQHVwZGF0ZTogY2Fs
bGJhY2sgdG8gdXBkYXRlIHJhbmdlIG9uIGEgZGV2aWNlCi0gKi8KLXN0cnVjdCBobW1fbWlycm9y
X29wcyB7Ci0JLyogcmVsZWFzZSgpIC0gcmVsZWFzZSBobW1fbWlycm9yCi0JICoKLQkgKiBAbWly
cm9yOiBwb2ludGVyIHRvIHN0cnVjdCBobW1fbWlycm9yCi0JICoKLQkgKiBUaGlzIGlzIGNhbGxl
ZCB3aGVuIHRoZSBtbV9zdHJ1Y3QgaXMgYmVpbmcgcmVsZWFzZWQuICBUaGUgY2FsbGJhY2sKLQkg
KiBtdXN0IGVuc3VyZSB0aGF0IGFsbCBhY2Nlc3MgdG8gYW55IHBhZ2VzIG9idGFpbmVkIGZyb20g
dGhpcyBtaXJyb3IKLQkgKiBpcyBoYWx0ZWQgYmVmb3JlIHRoZSBjYWxsYmFjayByZXR1cm5zLiBB
bGwgZnV0dXJlIGFjY2VzcyBzaG91bGQKLQkgKiBmYXVsdC4KLQkgKi8KLQl2b2lkICgqcmVsZWFz
ZSkoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvcik7Ci0KLQkvKiBzeW5jX2NwdV9kZXZpY2VfcGFn
ZXRhYmxlcygpIC0gc3luY2hyb25pemUgcGFnZSB0YWJsZXMKLQkgKgotCSAqIEBtaXJyb3I6IHBv
aW50ZXIgdG8gc3RydWN0IGhtbV9taXJyb3IKLQkgKiBAdXBkYXRlOiB1cGRhdGUgaW5mb3JtYXRp
b24gKHNlZSBzdHJ1Y3QgbW11X25vdGlmaWVyX3JhbmdlKQotCSAqIFJldHVybjogLUVBR0FJTiBp
ZiBtbXVfbm90aWZpZXJfcmFuZ2VfYmxvY2thYmxlKHVwZGF0ZSkgaXMgZmFsc2UKLQkgKiBhbmQg
Y2FsbGJhY2sgbmVlZHMgdG8gYmxvY2ssIDAgb3RoZXJ3aXNlLgotCSAqCi0JICogVGhpcyBjYWxs
YmFjayB1bHRpbWF0ZWx5IG9yaWdpbmF0ZXMgZnJvbSBtbXVfbm90aWZpZXJzIHdoZW4gdGhlIENQ
VQotCSAqIHBhZ2UgdGFibGUgaXMgdXBkYXRlZC4gVGhlIGRldmljZSBkcml2ZXIgbXVzdCB1cGRh
dGUgaXRzIHBhZ2UgdGFibGUKLQkgKiBpbiByZXNwb25zZSB0byB0aGlzIGNhbGxiYWNrLiBUaGUg
dXBkYXRlIGFyZ3VtZW50IHRlbGxzIHdoYXQgYWN0aW9uCi0JICogdG8gcGVyZm9ybS4KLQkgKgot
CSAqIFRoZSBkZXZpY2UgZHJpdmVyIG11c3Qgbm90IHJldHVybiBmcm9tIHRoaXMgY2FsbGJhY2sg
dW50aWwgdGhlIGRldmljZQotCSAqIHBhZ2UgdGFibGVzIGFyZSBjb21wbGV0ZWx5IHVwZGF0ZWQg
KFRMQnMgZmx1c2hlZCwgZXRjKTsgdGhpcyBpcyBhCi0JICogc3luY2hyb25vdXMgY2FsbC4KLQkg
Ki8KLQlpbnQgKCpzeW5jX2NwdV9kZXZpY2VfcGFnZXRhYmxlcykoCi0JCXN0cnVjdCBobW1fbWly
cm9yICptaXJyb3IsCi0JCWNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfcmFuZ2UgKnVwZGF0ZSk7
Ci19OwotCi0vKgotICogc3RydWN0IGhtbV9taXJyb3IgLSBtaXJyb3Igc3RydWN0IGZvciBhIGRl
dmljZSBkcml2ZXIKLSAqCi0gKiBAaG1tOiBwb2ludGVyIHRvIHN0cnVjdCBobW0gKHdoaWNoIGlz
IHVuaXF1ZSBwZXIgbW1fc3RydWN0KQotICogQG9wczogZGV2aWNlIGRyaXZlciBjYWxsYmFjayBm
b3IgSE1NIG1pcnJvciBvcGVyYXRpb25zCi0gKiBAbGlzdDogZm9yIGxpc3Qgb2YgbWlycm9ycyBv
ZiBhIGdpdmVuIG1tCi0gKgotICogRWFjaCBhZGRyZXNzIHNwYWNlIChtbV9zdHJ1Y3QpIGJlaW5n
IG1pcnJvcmVkIGJ5IGEgZGV2aWNlIG11c3QgcmVnaXN0ZXIgb25lCi0gKiBpbnN0YW5jZSBvZiBh
biBobW1fbWlycm9yIHN0cnVjdCB3aXRoIEhNTS4gSE1NIHdpbGwgdHJhY2sgdGhlIGxpc3Qgb2Yg
YWxsCi0gKiBtaXJyb3JzIGZvciBlYWNoIG1tX3N0cnVjdC4KLSAqLwotc3RydWN0IGhtbV9taXJy
b3IgewotCXN0cnVjdCBobW0JCQkqaG1tOwotCWNvbnN0IHN0cnVjdCBobW1fbWlycm9yX29wcwkq
b3BzOwotCXN0cnVjdCBsaXN0X2hlYWQJCWxpc3Q7Ci19OwotCiAvKgogICogUmV0cnkgZmF1bHQg
aWYgbm9uLWJsb2NraW5nLCBkcm9wIG1tYXBfc2VtIGFuZCByZXR1cm4gLUVBR0FJTiBpbiB0aGF0
IGNhc2UuCiAgKi8KQEAgLTM4MSwxNSArMjI2LDkgQEAgc3RydWN0IGhtbV9taXJyb3IgewogI2Rl
ZmluZSBITU1fRkFVTFRfU05BUFNIT1QJCSgxIDw8IDEpCiAKICNpZmRlZiBDT05GSUdfSE1NX01J
UlJPUgotaW50IGhtbV9taXJyb3JfcmVnaXN0ZXIoc3RydWN0IGhtbV9taXJyb3IgKm1pcnJvciwg
c3RydWN0IG1tX3N0cnVjdCAqbW0pOwotdm9pZCBobW1fbWlycm9yX3VucmVnaXN0ZXIoc3RydWN0
IGhtbV9taXJyb3IgKm1pcnJvcik7Ci0KIC8qCiAgKiBQbGVhc2Ugc2VlIERvY3VtZW50YXRpb24v
dm0vaG1tLnJzdCBmb3IgaG93IHRvIHVzZSB0aGUgcmFuZ2UgQVBJLgogICovCi1pbnQgaG1tX3Jh
bmdlX3JlZ2lzdGVyKHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLCBzdHJ1Y3QgaG1tX21pcnJvciAq
bWlycm9yKTsKLXZvaWQgaG1tX3JhbmdlX3VucmVnaXN0ZXIoc3RydWN0IGhtbV9yYW5nZSAqcmFu
Z2UpOwotCiBsb25nIGhtbV9yYW5nZV9mYXVsdChzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZSwgdW5z
aWduZWQgaW50IGZsYWdzKTsKIAogbG9uZyBobW1fcmFuZ2VfZG1hX21hcChzdHJ1Y3QgaG1tX3Jh
bmdlICpyYW5nZSwKQEAgLTQwMSwyNCArMjQwLDYgQEAgbG9uZyBobW1fcmFuZ2VfZG1hX3VubWFw
KHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLAogCQkJIGRtYV9hZGRyX3QgKmRhZGRycywKIAkJCSBi
b29sIGRpcnR5KTsKICNlbHNlCi1pbnQgaG1tX21pcnJvcl9yZWdpc3RlcihzdHJ1Y3QgaG1tX21p
cnJvciAqbWlycm9yLCBzdHJ1Y3QgbW1fc3RydWN0ICptbSkKLXsKLQlyZXR1cm4gLUVPUE5PVFNV
UFA7Ci19Ci0KLXZvaWQgaG1tX21pcnJvcl91bnJlZ2lzdGVyKHN0cnVjdCBobW1fbWlycm9yICpt
aXJyb3IpCi17Ci19Ci0KLWludCBobW1fcmFuZ2VfcmVnaXN0ZXIoc3RydWN0IGhtbV9yYW5nZSAq
cmFuZ2UsIHN0cnVjdCBobW1fbWlycm9yICptaXJyb3IpCi17Ci0JcmV0dXJuIC1FT1BOT1RTVVBQ
OwotfQotCi12b2lkIGhtbV9yYW5nZV91bnJlZ2lzdGVyKHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdl
KQotewotfQotCiBzdGF0aWMgaW5saW5lIGxvbmcgaG1tX3JhbmdlX2ZhdWx0KHN0cnVjdCBobW1f
cmFuZ2UgKnJhbmdlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJcmV0dXJuIC1FT1BOT1RTVVBQ
OwpkaWZmIC0tZ2l0IGEvbW0vS2NvbmZpZyBiL21tL0tjb25maWcKaW5kZXggZDBiNTA0NmQ5YWVm
ZmQuLmUzOGZmMWQ1OTY4ZGJmIDEwMDY0NAotLS0gYS9tbS9LY29uZmlnCisrKyBiL21tL0tjb25m
aWcKQEAgLTY3NSw3ICs2NzUsNiBAQCBjb25maWcgREVWX1BBR0VNQVBfT1BTCiBjb25maWcgSE1N
X01JUlJPUgogCWJvb2wKIAlkZXBlbmRzIG9uIE1NVQotCWRlcGVuZHMgb24gTU1VX05PVElGSUVS
CiAKIGNvbmZpZyBERVZJQ0VfUFJJVkFURQogCWJvb2wgIlVuYWRkcmVzc2FibGUgZGV2aWNlIG1l
bW9yeSAoR1BVIG1lbW9yeSwgLi4uKSIKZGlmZiAtLWdpdCBhL21tL2htbS5jIGIvbW0vaG1tLmMK
aW5kZXggMjJhYzM1OTU3NzFmZWIuLjc1ZDE1YTgyMGUxODJlIDEwMDY0NAotLS0gYS9tbS9obW0u
YworKysgYi9tbS9obW0uYwpAQCAtMjYsMTkzICsyNiw2IEBACiAjaW5jbHVkZSA8bGludXgvbW11
X25vdGlmaWVyLmg+CiAjaW5jbHVkZSA8bGludXgvbWVtb3J5X2hvdHBsdWcuaD4KIAotc3RhdGlj
IHN0cnVjdCBtbXVfbm90aWZpZXIgKmhtbV9hbGxvY19ub3RpZmllcihzdHJ1Y3QgbW1fc3RydWN0
ICptbSkKLXsKLQlzdHJ1Y3QgaG1tICpobW07Ci0KLQlobW0gPSBremFsbG9jKHNpemVvZigqaG1t
KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFobW0pCi0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwot
Ci0JaW5pdF93YWl0cXVldWVfaGVhZCgmaG1tLT53cSk7Ci0JSU5JVF9MSVNUX0hFQUQoJmhtbS0+
bWlycm9ycyk7Ci0JaW5pdF9yd3NlbSgmaG1tLT5taXJyb3JzX3NlbSk7Ci0JSU5JVF9MSVNUX0hF
QUQoJmhtbS0+cmFuZ2VzKTsKLQlzcGluX2xvY2tfaW5pdCgmaG1tLT5yYW5nZXNfbG9jayk7Ci0J
aG1tLT5ub3RpZmllcnMgPSAwOwotCXJldHVybiAmaG1tLT5tbXVfbm90aWZpZXI7Ci19Ci0KLXN0
YXRpYyB2b2lkIGhtbV9mcmVlX25vdGlmaWVyKHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uKQotewot
CXN0cnVjdCBobW0gKmhtbSA9IGNvbnRhaW5lcl9vZihtbiwgc3RydWN0IGhtbSwgbW11X25vdGlm
aWVyKTsKLQotCVdBUk5fT04oIWxpc3RfZW1wdHkoJmhtbS0+cmFuZ2VzKSk7Ci0JV0FSTl9PTigh
bGlzdF9lbXB0eSgmaG1tLT5taXJyb3JzKSk7Ci0Ja2ZyZWUoaG1tKTsKLX0KLQotc3RhdGljIHZv
aWQgaG1tX3JlbGVhc2Uoc3RydWN0IG1tdV9ub3RpZmllciAqbW4sIHN0cnVjdCBtbV9zdHJ1Y3Qg
Km1tKQotewotCXN0cnVjdCBobW0gKmhtbSA9IGNvbnRhaW5lcl9vZihtbiwgc3RydWN0IGhtbSwg
bW11X25vdGlmaWVyKTsKLQlzdHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yOwotCi0JLyoKLQkgKiBT
aW5jZSBobW1fcmFuZ2VfcmVnaXN0ZXIoKSBob2xkcyB0aGUgbW1nZXQoKSBsb2NrIGhtbV9yZWxl
YXNlKCkgaXMKLQkgKiBwcmV2ZW50ZWQgYXMgbG9uZyBhcyBhIHJhbmdlIGV4aXN0cy4KLQkgKi8K
LQlXQVJOX09OKCFsaXN0X2VtcHR5X2NhcmVmdWwoJmhtbS0+cmFuZ2VzKSk7Ci0KLQlkb3duX3Jl
YWQoJmhtbS0+bWlycm9yc19zZW0pOwotCWxpc3RfZm9yX2VhY2hfZW50cnkobWlycm9yLCAmaG1t
LT5taXJyb3JzLCBsaXN0KSB7Ci0JCS8qCi0JCSAqIE5vdGU6IFRoZSBkcml2ZXIgaXMgbm90IGFs
bG93ZWQgdG8gdHJpZ2dlcgotCQkgKiBobW1fbWlycm9yX3VucmVnaXN0ZXIoKSBmcm9tIHRoaXMg
dGhyZWFkLgotCQkgKi8KLQkJaWYgKG1pcnJvci0+b3BzLT5yZWxlYXNlKQotCQkJbWlycm9yLT5v
cHMtPnJlbGVhc2UobWlycm9yKTsKLQl9Ci0JdXBfcmVhZCgmaG1tLT5taXJyb3JzX3NlbSk7Ci19
Ci0KLXN0YXRpYyB2b2lkIG5vdGlmaWVyc19kZWNyZW1lbnQoc3RydWN0IGhtbSAqaG1tKQotewot
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaG1tLT5yYW5nZXNf
bG9jaywgZmxhZ3MpOwotCWhtbS0+bm90aWZpZXJzLS07Ci0JaWYgKCFobW0tPm5vdGlmaWVycykg
ewotCQlzdHJ1Y3QgaG1tX3JhbmdlICpyYW5nZTsKLQotCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHJh
bmdlLCAmaG1tLT5yYW5nZXMsIGxpc3QpIHsKLQkJCWlmIChyYW5nZS0+dmFsaWQpCi0JCQkJY29u
dGludWU7Ci0JCQlyYW5nZS0+dmFsaWQgPSB0cnVlOwotCQl9Ci0JCXdha2VfdXBfYWxsKCZobW0t
PndxKTsKLQl9Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxh
Z3MpOwotfQotCi1zdGF0aWMgaW50IGhtbV9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBt
bXVfbm90aWZpZXIgKm1uLAotCQkJY29uc3Qgc3RydWN0IG1tdV9ub3RpZmllcl9yYW5nZSAqbnJh
bmdlKQotewotCXN0cnVjdCBobW0gKmhtbSA9IGNvbnRhaW5lcl9vZihtbiwgc3RydWN0IGhtbSwg
bW11X25vdGlmaWVyKTsKLQlzdHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yOwotCXN0cnVjdCBobW1f
cmFuZ2UgKnJhbmdlOwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0JaW50IHJldCA9IDA7Ci0KLQlz
cGluX2xvY2tfaXJxc2F2ZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwotCWhtbS0+bm90aWZp
ZXJzKys7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeShyYW5nZSwgJmhtbS0+cmFuZ2VzLCBsaXN0KSB7
Ci0JCWlmIChucmFuZ2UtPmVuZCA8IHJhbmdlLT5zdGFydCB8fCBucmFuZ2UtPnN0YXJ0ID49IHJh
bmdlLT5lbmQpCi0JCQljb250aW51ZTsKLQotCQlyYW5nZS0+dmFsaWQgPSBmYWxzZTsKLQl9Ci0J
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwotCi0JaWYg
KG1tdV9ub3RpZmllcl9yYW5nZV9ibG9ja2FibGUobnJhbmdlKSkKLQkJZG93bl9yZWFkKCZobW0t
Pm1pcnJvcnNfc2VtKTsKLQllbHNlIGlmICghZG93bl9yZWFkX3RyeWxvY2soJmhtbS0+bWlycm9y
c19zZW0pKSB7Ci0JCXJldCA9IC1FQUdBSU47Ci0JCWdvdG8gb3V0OwotCX0KLQotCWxpc3RfZm9y
X2VhY2hfZW50cnkobWlycm9yLCAmaG1tLT5taXJyb3JzLCBsaXN0KSB7Ci0JCWludCByYzsKLQot
CQlyYyA9IG1pcnJvci0+b3BzLT5zeW5jX2NwdV9kZXZpY2VfcGFnZXRhYmxlcyhtaXJyb3IsIG5y
YW5nZSk7Ci0JCWlmIChyYykgewotCQkJaWYgKFdBUk5fT04obW11X25vdGlmaWVyX3JhbmdlX2Js
b2NrYWJsZShucmFuZ2UpIHx8Ci0JCQkgICAgcmMgIT0gLUVBR0FJTikpCi0JCQkJY29udGludWU7
Ci0JCQlyZXQgPSAtRUFHQUlOOwotCQkJYnJlYWs7Ci0JCX0KLQl9Ci0JdXBfcmVhZCgmaG1tLT5t
aXJyb3JzX3NlbSk7Ci0KLW91dDoKLQlpZiAocmV0KQotCQlub3RpZmllcnNfZGVjcmVtZW50KGht
bSk7Ci0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIHZvaWQgaG1tX2ludmFsaWRhdGVfcmFuZ2Vf
ZW5kKHN0cnVjdCBtbXVfbm90aWZpZXIgKm1uLAotCQkJY29uc3Qgc3RydWN0IG1tdV9ub3RpZmll
cl9yYW5nZSAqbnJhbmdlKQotewotCXN0cnVjdCBobW0gKmhtbSA9IGNvbnRhaW5lcl9vZihtbiwg
c3RydWN0IGhtbSwgbW11X25vdGlmaWVyKTsKLQotCW5vdGlmaWVyc19kZWNyZW1lbnQoaG1tKTsK
LX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBtbXVfbm90aWZpZXJfb3BzIGhtbV9tbXVfbm90aWZp
ZXJfb3BzID0gewotCS5yZWxlYXNlCQk9IGhtbV9yZWxlYXNlLAotCS5pbnZhbGlkYXRlX3Jhbmdl
X3N0YXJ0CT0gaG1tX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQsCi0JLmludmFsaWRhdGVfcmFuZ2Vf
ZW5kCT0gaG1tX2ludmFsaWRhdGVfcmFuZ2VfZW5kLAotCS5hbGxvY19ub3RpZmllcgkJPSBobW1f
YWxsb2Nfbm90aWZpZXIsCi0JLmZyZWVfbm90aWZpZXIJCT0gaG1tX2ZyZWVfbm90aWZpZXIsCi19
OwotCi0vKgotICogaG1tX21pcnJvcl9yZWdpc3RlcigpIC0gcmVnaXN0ZXIgYSBtaXJyb3IgYWdh
aW5zdCBhbiBtbQotICoKLSAqIEBtaXJyb3I6IG5ldyBtaXJyb3Igc3RydWN0IHRvIHJlZ2lzdGVy
Ci0gKiBAbW06IG1tIHRvIHJlZ2lzdGVyIGFnYWluc3QKLSAqIFJldHVybjogMCBvbiBzdWNjZXNz
LCAtRU5PTUVNIGlmIG5vIG1lbW9yeSwgLUVJTlZBTCBpZiBpbnZhbGlkIGFyZ3VtZW50cwotICoK
LSAqIFRvIHN0YXJ0IG1pcnJvcmluZyBhIHByb2Nlc3MgYWRkcmVzcyBzcGFjZSwgdGhlIGRldmlj
ZSBkcml2ZXIgbXVzdCByZWdpc3RlcgotICogYW4gSE1NIG1pcnJvciBzdHJ1Y3QuCi0gKgotICog
VGhlIGNhbGxlciBjYW5ub3QgdW5yZWdpc3RlciB0aGUgaG1tX21pcnJvciB3aGlsZSBhbnkgcmFu
Z2VzIGFyZQotICogcmVnaXN0ZXJlZC4KLSAqCi0gKiBDYWxsZXJzIHVzaW5nIHRoaXMgZnVuY3Rp
b24gbXVzdCBwdXQgYSBjYWxsIHRvIG1tdV9ub3RpZmllcl9zeW5jaHJvbml6ZSgpCi0gKiBpbiB0
aGVpciBtb2R1bGUgZXhpdCBmdW5jdGlvbnMuCi0gKi8KLWludCBobW1fbWlycm9yX3JlZ2lzdGVy
KHN0cnVjdCBobW1fbWlycm9yICptaXJyb3IsIHN0cnVjdCBtbV9zdHJ1Y3QgKm1tKQotewotCXN0
cnVjdCBtbXVfbm90aWZpZXIgKm1uOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZF93cml0ZSgmbW0t
Pm1tYXBfc2VtKTsKLQotCS8qIFNhbml0eSBjaGVjayAqLwotCWlmICghbW0gfHwgIW1pcnJvciB8
fCAhbWlycm9yLT5vcHMpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JbW4gPSBtbXVfbm90aWZpZXJf
Z2V0X2xvY2tlZCgmaG1tX21tdV9ub3RpZmllcl9vcHMsIG1tKTsKLQlpZiAoSVNfRVJSKG1uKSkK
LQkJcmV0dXJuIFBUUl9FUlIobW4pOwotCW1pcnJvci0+aG1tID0gY29udGFpbmVyX29mKG1uLCBz
dHJ1Y3QgaG1tLCBtbXVfbm90aWZpZXIpOwotCi0JZG93bl93cml0ZSgmbWlycm9yLT5obW0tPm1p
cnJvcnNfc2VtKTsKLQlsaXN0X2FkZCgmbWlycm9yLT5saXN0LCAmbWlycm9yLT5obW0tPm1pcnJv
cnMpOwotCXVwX3dyaXRlKCZtaXJyb3ItPmhtbS0+bWlycm9yc19zZW0pOwotCi0JcmV0dXJuIDA7
Ci19Ci1FWFBPUlRfU1lNQk9MKGhtbV9taXJyb3JfcmVnaXN0ZXIpOwotCi0vKgotICogaG1tX21p
cnJvcl91bnJlZ2lzdGVyKCkgLSB1bnJlZ2lzdGVyIGEgbWlycm9yCi0gKgotICogQG1pcnJvcjog
bWlycm9yIHN0cnVjdCB0byB1bnJlZ2lzdGVyCi0gKgotICogU3RvcCBtaXJyb3JpbmcgYSBwcm9j
ZXNzIGFkZHJlc3Mgc3BhY2UsIGFuZCBjbGVhbnVwLgotICovCi12b2lkIGhtbV9taXJyb3JfdW5y
ZWdpc3RlcihzdHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yKQotewotCXN0cnVjdCBobW0gKmhtbSA9
IG1pcnJvci0+aG1tOwotCi0JZG93bl93cml0ZSgmaG1tLT5taXJyb3JzX3NlbSk7Ci0JbGlzdF9k
ZWwoJm1pcnJvci0+bGlzdCk7Ci0JdXBfd3JpdGUoJmhtbS0+bWlycm9yc19zZW0pOwotCW1tdV9u
b3RpZmllcl9wdXQoJmhtbS0+bW11X25vdGlmaWVyKTsKLX0KLUVYUE9SVF9TWU1CT0woaG1tX21p
cnJvcl91bnJlZ2lzdGVyKTsKLQogc3RydWN0IGhtbV92bWFfd2FsayB7CiAJc3RydWN0IGhtbV9y
YW5nZQkqcmFuZ2U7CiAJc3RydWN0IGRldl9wYWdlbWFwCSpwZ21hcDsKQEAgLTc3OSw4NyArNTky
LDYgQEAgc3RhdGljIHZvaWQgaG1tX3BmbnNfY2xlYXIoc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2Us
CiAJCSpwZm5zID0gcmFuZ2UtPnZhbHVlc1tITU1fUEZOX05PTkVdOwogfQogCi0vKgotICogaG1t
X3JhbmdlX3JlZ2lzdGVyKCkgLSBzdGFydCB0cmFja2luZyBjaGFuZ2UgdG8gQ1BVIHBhZ2UgdGFi
bGUgb3ZlciBhIHJhbmdlCi0gKiBAcmFuZ2U6IHJhbmdlCi0gKiBAbW06IHRoZSBtbSBzdHJ1Y3Qg
Zm9yIHRoZSByYW5nZSBvZiB2aXJ0dWFsIGFkZHJlc3MKLSAqCi0gKiBSZXR1cm46IDAgb24gc3Vj
Y2VzcywgLUVGQVVMVCBpZiB0aGUgYWRkcmVzcyBzcGFjZSBpcyBubyBsb25nZXIgdmFsaWQKLSAq
Ci0gKiBUcmFjayB1cGRhdGVzIHRvIHRoZSBDUFUgcGFnZSB0YWJsZSBzZWUgaW5jbHVkZS9saW51
eC9obW0uaAotICovCi1pbnQgaG1tX3JhbmdlX3JlZ2lzdGVyKHN0cnVjdCBobW1fcmFuZ2UgKnJh
bmdlLCBzdHJ1Y3QgaG1tX21pcnJvciAqbWlycm9yKQotewotCXN0cnVjdCBobW0gKmhtbSA9IG1p
cnJvci0+aG1tOwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0KLQlyYW5nZS0+dmFsaWQgPSBmYWxz
ZTsKLQlyYW5nZS0+aG1tID0gTlVMTDsKLQotCWlmICgocmFuZ2UtPnN0YXJ0ICYgKFBBR0VfU0la
RSAtIDEpKSB8fCAocmFuZ2UtPmVuZCAmIChQQUdFX1NJWkUgLSAxKSkpCi0JCXJldHVybiAtRUlO
VkFMOwotCWlmIChyYW5nZS0+c3RhcnQgPj0gcmFuZ2UtPmVuZCkKLQkJcmV0dXJuIC1FSU5WQUw7
Ci0KLQkvKiBQcmV2ZW50IGhtbV9yZWxlYXNlKCkgZnJvbSBydW5uaW5nIHdoaWxlIHRoZSByYW5n
ZSBpcyB2YWxpZCAqLwotCWlmICghbW1nZXRfbm90X3plcm8oaG1tLT5tbXVfbm90aWZpZXIubW0p
KQotCQlyZXR1cm4gLUVGQVVMVDsKLQotCS8qIEluaXRpYWxpemUgcmFuZ2UgdG8gdHJhY2sgQ1BV
IHBhZ2UgdGFibGUgdXBkYXRlcy4gKi8KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaG1tLT5yYW5nZXNf
bG9jaywgZmxhZ3MpOwotCi0JcmFuZ2UtPmhtbSA9IGhtbTsKLQlsaXN0X2FkZCgmcmFuZ2UtPmxp
c3QsICZobW0tPnJhbmdlcyk7Ci0KLQkvKgotCSAqIElmIHRoZXJlIGFyZSBhbnkgY29uY3VycmVu
dCBub3RpZmllcnMgd2UgaGF2ZSB0byB3YWl0IGZvciB0aGVtIGZvcgotCSAqIHRoZSByYW5nZSB0
byBiZSB2YWxpZCAoc2VlIGhtbV9yYW5nZV93YWl0X3VudGlsX3ZhbGlkKCkpLgotCSAqLwotCWlm
ICghaG1tLT5ub3RpZmllcnMpCi0JCXJhbmdlLT52YWxpZCA9IHRydWU7Ci0Jc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmaG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwotCi0JcmV0dXJuIDA7Ci19Ci1F
WFBPUlRfU1lNQk9MKGhtbV9yYW5nZV9yZWdpc3Rlcik7Ci0KLS8qCi0gKiBobW1fcmFuZ2VfdW5y
ZWdpc3RlcigpIC0gc3RvcCB0cmFja2luZyBjaGFuZ2UgdG8gQ1BVIHBhZ2UgdGFibGUgb3ZlciBh
IHJhbmdlCi0gKiBAcmFuZ2U6IHJhbmdlCi0gKgotICogUmFuZ2Ugc3RydWN0IGlzIHVzZWQgdG8g
dHJhY2sgdXBkYXRlcyB0byB0aGUgQ1BVIHBhZ2UgdGFibGUgYWZ0ZXIgYSBjYWxsIHRvCi0gKiBo
bW1fcmFuZ2VfcmVnaXN0ZXIoKS4gU2VlIGluY2x1ZGUvbGludXgvaG1tLmggZm9yIGhvdyB0byB1
c2UgaXQuCi0gKi8KLXZvaWQgaG1tX3JhbmdlX3VucmVnaXN0ZXIoc3RydWN0IGhtbV9yYW5nZSAq
cmFuZ2UpCi17Ci0Jc3RydWN0IGhtbSAqaG1tID0gcmFuZ2UtPmhtbTsKLQl1bnNpZ25lZCBsb25n
IGZsYWdzOwotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmhtbS0+cmFuZ2VzX2xvY2ssIGZsYWdzKTsK
LQlsaXN0X2RlbF9pbml0KCZyYW5nZS0+bGlzdCk7Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
aG1tLT5yYW5nZXNfbG9jaywgZmxhZ3MpOwotCi0JLyogRHJvcCByZWZlcmVuY2UgdGFrZW4gYnkg
aG1tX3JhbmdlX3JlZ2lzdGVyKCkgKi8KLQltbXB1dChobW0tPm1tdV9ub3RpZmllci5tbSk7Ci0K
LQkvKgotCSAqIFRoZSByYW5nZSBpcyBub3cgaW52YWxpZCBhbmQgdGhlIHJlZiBvbiB0aGUgaG1t
IGlzIGRyb3BwZWQsIHNvCi0JICogcG9pc29uIHRoZSBwb2ludGVyLiAgTGVhdmUgb3RoZXIgZmll
bGRzIGluIHBsYWNlLCBmb3IgdGhlIGNhbGxlcidzCi0JICogdXNlLgotCSAqLwotCXJhbmdlLT52
YWxpZCA9IGZhbHNlOwotCW1lbXNldCgmcmFuZ2UtPmhtbSwgUE9JU09OX0lOVVNFLCBzaXplb2Yo
cmFuZ2UtPmhtbSkpOwotfQotRVhQT1JUX1NZTUJPTChobW1fcmFuZ2VfdW5yZWdpc3Rlcik7Ci0K
LXN0YXRpYyBib29sIG5lZWRzX3JldHJ5KHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlKQotewotCWlm
IChyYW5nZS0+bm90aWZpZXIpCi0JCXJldHVybiBtbXVfcmFuZ2VfY2hlY2tfcmV0cnkocmFuZ2Ut
Pm5vdGlmaWVyLAotCQkJCQkgICAgIHJhbmdlLT5ub3RpZmllcl9zZXEpOwotCXJldHVybiAhcmFu
Z2UtPnZhbGlkOwotfQotCiBzdGF0aWMgY29uc3Qgc3RydWN0IG1tX3dhbGtfb3BzIGhtbV93YWxr
X29wcyA9IHsKIAkucHVkX2VudHJ5CT0gaG1tX3ZtYV93YWxrX3B1ZCwKIAkucG1kX2VudHJ5CT0g
aG1tX3ZtYV93YWxrX3BtZCwKQEAgLTkwMCwyMCArNjMyLDE1IEBAIGxvbmcgaG1tX3JhbmdlX2Zh
dWx0KHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJY29uc3Qg
dW5zaWduZWQgbG9uZyBkZXZpY2Vfdm1hID0gVk1fSU8gfCBWTV9QRk5NQVAgfCBWTV9NSVhFRE1B
UDsKIAl1bnNpZ25lZCBsb25nIHN0YXJ0ID0gcmFuZ2UtPnN0YXJ0LCBlbmQ7CiAJc3RydWN0IGht
bV92bWFfd2FsayBobW1fdm1hX3dhbGs7Ci0Jc3RydWN0IG1tX3N0cnVjdCAqbW07CisJc3RydWN0
IG1tX3N0cnVjdCAqbW0gPSByYW5nZS0+bm90aWZpZXItPm1tOwogCXN0cnVjdCB2bV9hcmVhX3N0
cnVjdCAqdm1hOwogCWludCByZXQ7CiAKLQlpZiAocmFuZ2UtPm5vdGlmaWVyKQotCQltbSA9IHJh
bmdlLT5ub3RpZmllci0+bW07Ci0JZWxzZQotCQltbSA9IHJhbmdlLT5obW0tPm1tdV9ub3RpZmll
ci5tbTsKLQogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm1tLT5tbWFwX3NlbSk7CiAKIAlkbyB7CiAJ
CS8qIElmIHJhbmdlIGlzIG5vIGxvbmdlciB2YWxpZCBmb3JjZSByZXRyeS4gKi8KLQkJaWYgKG5l
ZWRzX3JldHJ5KHJhbmdlKSkKKwkJaWYgKG1tdV9yYW5nZV9jaGVja19yZXRyeShyYW5nZS0+bm90
aWZpZXIsIHJhbmdlLT5ub3RpZmllcl9zZXEpKQogCQkJcmV0dXJuIC1FQlVTWTsKIAogCQl2bWEg
PSBmaW5kX3ZtYShtbSwgc3RhcnQpOwpAQCAtOTQ2LDcgKzY3Myw5IEBAIGxvbmcgaG1tX3Jhbmdl
X2ZhdWx0KHN0cnVjdCBobW1fcmFuZ2UgKnJhbmdlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJCQlz
dGFydCA9IGhtbV92bWFfd2Fsay5sYXN0OwogCiAJCQkvKiBLZWVwIHRyeWluZyB3aGlsZSB0aGUg
cmFuZ2UgaXMgdmFsaWQuICovCi0JCX0gd2hpbGUgKHJldCA9PSAtRUJVU1kgJiYgIW5lZWRzX3Jl
dHJ5KHJhbmdlKSk7CisJCX0gd2hpbGUgKHJldCA9PSAtRUJVU1kgJiYKKwkJCSAhbW11X3Jhbmdl
X2NoZWNrX3JldHJ5KHJhbmdlLT5ub3RpZmllciwKKwkJCQkJCXJhbmdlLT5ub3RpZmllcl9zZXEp
KTsKIAogCQlpZiAocmV0KSB7CiAJCQl1bnNpZ25lZCBsb25nIGk7CkBAIC0xMDA0LDcgKzczMyw4
IEBAIGxvbmcgaG1tX3JhbmdlX2RtYV9tYXAoc3RydWN0IGhtbV9yYW5nZSAqcmFuZ2UsIHN0cnVj
dCBkZXZpY2UgKmRldmljZSwKIAkJCWNvbnRpbnVlOwogCiAJCS8qIENoZWNrIGlmIHJhbmdlIGlz
IGJlaW5nIGludmFsaWRhdGVkICovCi0JCWlmIChuZWVkc19yZXRyeShyYW5nZSkpIHsKKwkJaWYg
KG1tdV9yYW5nZV9jaGVja19yZXRyeShyYW5nZS0+bm90aWZpZXIsCisJCQkJCSAgcmFuZ2UtPm5v
dGlmaWVyX3NlcSkpIHsKIAkJCXJldCA9IC1FQlVTWTsKIAkJCWdvdG8gdW5tYXA7CiAJCX0KLS0g
CjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
ZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
