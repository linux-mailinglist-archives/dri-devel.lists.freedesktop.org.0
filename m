Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7148760AED
	for <lists+dri-devel@lfdr.de>; Fri,  5 Jul 2019 19:17:48 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 952396E525;
	Fri,  5 Jul 2019 17:17:39 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from metis.ext.pengutronix.de (metis.ext.pengutronix.de
 [IPv6:2001:67c:670:201:290:27ff:fe1d:cc33])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 054B26E523
 for <dri-devel@lists.freedesktop.org>; Fri,  5 Jul 2019 17:17:32 +0000 (UTC)
Received: from dude02.hi.pengutronix.de ([2001:67c:670:100:1d::28]
 helo=dude02.pengutronix.de.)
 by metis.ext.pengutronix.de with esmtp (Exim 4.92)
 (envelope-from <l.stach@pengutronix.de>)
 id 1hjRpw-0007A3-3V; Fri, 05 Jul 2019 19:17:28 +0200
From: Lucas Stach <l.stach@pengutronix.de>
To: etnaviv@lists.freedesktop.org
Subject: [PATCH v2 3/8] drm/etnaviv: share a single cmdbuf suballoc region
 across all GPUs
Date: Fri,  5 Jul 2019 19:17:22 +0200
Message-Id: <20190705171727.27501-3-l.stach@pengutronix.de>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190705171727.27501-1-l.stach@pengutronix.de>
References: <20190705171727.27501-1-l.stach@pengutronix.de>
MIME-Version: 1.0
X-SA-Exim-Connect-IP: 2001:67c:670:100:1d::28
X-SA-Exim-Mail-From: l.stach@pengutronix.de
X-SA-Exim-Scanned: No (on metis.ext.pengutronix.de);
 SAEximRunCond expanded to false
X-PTX-Original-Recipient: dri-devel@lists.freedesktop.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: patchwork-lst@pengutronix.de, kernel@pengutronix.de,
 dri-devel@lists.freedesktop.org, Russell King <linux+etnaviv@armlinux.org.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlcmUgaXMgbm8gbmVlZCBmb3IgZWFjaCBHUFUgdG8gaGF2ZSBpdCdzIG93biBjbWRidWYgc3Vi
YWxsb2NhdGlvbgpyZWdpb24uIE9ubHkgYWxsb2NhdGUgYSBzaW5nbGUgb25lIGZvciB0aGUgdGhl
IGV0bmF2aXYgdmlydHVhbCBkZXZpY2UKYW5kIHNoYXJlIGl0IGFjcm9zcyBhbGwgR1BVcy4KCkFz
IHRoZSBzdWJhbGxvYyBzcGFjZSBpcyBub3cgcG90ZW50aWFsbHkgc2hhcmVkIGJ5IG1vcmUgaGFy
ZHdhcmUgam9icwpydW5uaW5nIGluIHBhcmFsbGVsLCBkb3VibGUgaXRzIHNpemUgdG8gNTEyS0Ig
dG8gYXZvaWQgY29udGVudGlvbi4KClNpZ25lZC1vZmYtYnk6IEx1Y2FzIFN0YWNoIDxsLnN0YWNo
QHBlbmd1dHJvbml4LmRlPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfY21k
YnVmLmMgICAgIHwgMTQgKysrKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0
bmF2aXZfY21kYnVmLmggICAgIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRu
YXZpdl9kcnYuYyAgICAgICAgfCAxOSArKysrKysrKysrKysrKystLS0tCiBkcml2ZXJzL2dwdS9k
cm0vZXRuYXZpdi9ldG5hdml2X2Rydi5oICAgICAgICB8ICAyICsrCiBkcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X2dlbV9zdWJtaXQuYyB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vZXRu
YXZpdi9ldG5hdml2X2dwdS5jICAgICAgICB8IDE3ICsrKystLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5oICAgICAgICB8ICAxIC0KIDcgZmlsZXMgY2hh
bmdlZCwgMzEgaW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9jbWRidWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9l
dG5hdml2L2V0bmF2aXZfY21kYnVmLmMKaW5kZXggODkxNWQ5ZDA1NmE2Li5hMmY1YWQzOWM0ZTYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfY21kYnVmLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9jbWRidWYuYwpAQCAtMTIsMTMgKzEy
LDEzIEBACiAjaW5jbHVkZSAiZXRuYXZpdl9ncHUuaCIKICNpbmNsdWRlICJldG5hdml2X21tdS5o
IgogCi0jZGVmaW5lIFNVQkFMTE9DX1NJWkUJCVNaXzI1NksKKyNkZWZpbmUgU1VCQUxMT0NfU0la
RQkJU1pfNTEySwogI2RlZmluZSBTVUJBTExPQ19HUkFOVUxFCVNaXzRLCiAjZGVmaW5lIFNVQkFM
TE9DX0dSQU5VTEVTCShTVUJBTExPQ19TSVpFIC8gU1VCQUxMT0NfR1JBTlVMRSkKIAogc3RydWN0
IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jIHsKIAkvKiBzdWJhbGxvY2F0ZWQgZG1hIGJ1ZmZlciBw
cm9wZXJ0aWVzICovCi0Jc3RydWN0IGV0bmF2aXZfZ3B1ICpncHU7CisJc3RydWN0IGRldmljZSAq
ZGV2OwogCXZvaWQgKnZhZGRyOwogCWRtYV9hZGRyX3QgcGFkZHI7CiAKQEAgLTMwLDcgKzMwLDcg
QEAgc3RydWN0IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jIHsKIH07CiAKIHN0cnVjdCBldG5hdml2
X2NtZGJ1Zl9zdWJhbGxvYyAqCi1ldG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19uZXcoc3RydWN0IGV0
bmF2aXZfZ3B1ICogZ3B1KQorZXRuYXZpdl9jbWRidWZfc3ViYWxsb2NfbmV3KHN0cnVjdCBkZXZp
Y2UgKmRldikKIHsKIAlzdHJ1Y3QgZXRuYXZpdl9jbWRidWZfc3ViYWxsb2MgKnN1YmFsbG9jOwog
CWludCByZXQ7CkBAIC0zOSwxMSArMzksMTEgQEAgZXRuYXZpdl9jbWRidWZfc3ViYWxsb2NfbmV3
KHN0cnVjdCBldG5hdml2X2dwdSAqIGdwdSkKIAlpZiAoIXN1YmFsbG9jKQogCQlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKIAotCXN1YmFsbG9jLT5ncHUgPSBncHU7CisJc3ViYWxsb2MtPmRldiA9
IGRldjsKIAltdXRleF9pbml0KCZzdWJhbGxvYy0+bG9jayk7CiAJaW5pdF93YWl0cXVldWVfaGVh
ZCgmc3ViYWxsb2MtPmZyZWVfZXZlbnQpOwogCi0Jc3ViYWxsb2MtPnZhZGRyID0gZG1hX2FsbG9j
X3djKGdwdS0+ZGV2LCBTVUJBTExPQ19TSVpFLAorCXN1YmFsbG9jLT52YWRkciA9IGRtYV9hbGxv
Y193YyhkZXYsIFNVQkFMTE9DX1NJWkUsCiAJCQkJICAgICAgICZzdWJhbGxvYy0+cGFkZHIsIEdG
UF9LRVJORUwpOwogCWlmICghc3ViYWxsb2MtPnZhZGRyKSB7CiAJCXJldCA9IC1FTk9NRU07CkBA
IC03NSw3ICs3NSw3IEBAIHZvaWQgZXRuYXZpdl9jbWRidWZfc3ViYWxsb2NfdW5tYXAoc3RydWN0
IGV0bmF2aXZfaW9tbXUgKm1tdSwKIAogdm9pZCBldG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19kZXN0
cm95KHN0cnVjdCBldG5hdml2X2NtZGJ1Zl9zdWJhbGxvYyAqc3ViYWxsb2MpCiB7Ci0JZG1hX2Zy
ZWVfd2Moc3ViYWxsb2MtPmdwdS0+ZGV2LCBTVUJBTExPQ19TSVpFLCBzdWJhbGxvYy0+dmFkZHIs
CisJZG1hX2ZyZWVfd2Moc3ViYWxsb2MtPmRldiwgU1VCQUxMT0NfU0laRSwgc3ViYWxsb2MtPnZh
ZGRyLAogCQkgICAgc3ViYWxsb2MtPnBhZGRyKTsKIAlrZnJlZShzdWJhbGxvYyk7CiB9CkBAIC0x
MDAsNyArMTAwLDcgQEAgaW50IGV0bmF2aXZfY21kYnVmX2luaXQoc3RydWN0IGV0bmF2aXZfY21k
YnVmX3N1YmFsbG9jICpzdWJhbGxvYywKIAkJCQkJCSAgICAgICBzdWJhbGxvYy0+ZnJlZV9zcGFj
ZSwKIAkJCQkJCSAgICAgICBtc2Vjc190b19qaWZmaWVzKDEwICogMTAwMCkpOwogCQlpZiAoIXJl
dCkgewotCQkJZGV2X2VycihzdWJhbGxvYy0+Z3B1LT5kZXYsCisJCQlkZXZfZXJyKHN1YmFsbG9j
LT5kZXYsCiAJCQkJIlRpbWVvdXQgd2FpdGluZyBmb3IgY21kYnVmIHNwYWNlXG4iKTsKIAkJCXJl
dHVybiAtRVRJTUVET1VUOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZp
di9ldG5hdml2X2NtZGJ1Zi5oIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9jbWRi
dWYuaAppbmRleCAxMWQ5NWYwNWMwMTcuLjdmZGMyZTNmZWE1ZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9jbWRidWYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
ZXRuYXZpdi9ldG5hdml2X2NtZGJ1Zi5oCkBAIC04LDcgKzgsNyBAQAogCiAjaW5jbHVkZSA8bGlu
dXgvdHlwZXMuaD4KIAotc3RydWN0IGV0bmF2aXZfZ3B1Oworc3RydWN0IGRldmljZTsKIHN0cnVj
dCBldG5hdml2X2lvbW11Owogc3RydWN0IGV0bmF2aXZfdnJhbV9tYXBwaW5nOwogc3RydWN0IGV0
bmF2aXZfY21kYnVmX3N1YmFsbG9jOwpAQCAtMjQsNyArMjQsNyBAQCBzdHJ1Y3QgZXRuYXZpdl9j
bWRidWYgewogfTsKIAogc3RydWN0IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jICoKLWV0bmF2aXZf
Y21kYnVmX3N1YmFsbG9jX25ldyhzdHJ1Y3QgZXRuYXZpdl9ncHUgKiBncHUpOworZXRuYXZpdl9j
bWRidWZfc3ViYWxsb2NfbmV3KHN0cnVjdCBkZXZpY2UgKmRldik7CiB2b2lkIGV0bmF2aXZfY21k
YnVmX3N1YmFsbG9jX2Rlc3Ryb3koc3RydWN0IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jICpzdWJh
bGxvYyk7CiBpbnQgZXRuYXZpdl9jbWRidWZfc3ViYWxsb2NfbWFwKHN0cnVjdCBldG5hdml2X2Nt
ZGJ1Zl9zdWJhbGxvYyAqc3ViYWxsb2MsCiAJCQkJc3RydWN0IGV0bmF2aXZfaW9tbXUgKm1tdSwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZHJ2LmMgYi9kcml2
ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2Rydi5jCmluZGV4IDlkNDQwNDcyMzQ4OS4uNWZh
M2FhN2JkYmM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2Ry
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZHJ2LmMKQEAgLTUzMCwy
MyArNTMwLDMyIEBAIHN0YXRpYyBpbnQgZXRuYXZpdl9iaW5kKHN0cnVjdCBkZXZpY2UgKmRldikK
IAlJTklUX0xJU1RfSEVBRCgmcHJpdi0+Z2VtX2xpc3QpOwogCXByaXYtPm51bV9ncHVzID0gMDsK
IAorCXByaXYtPmNtZGJ1Zl9zdWJhbGxvYyA9IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jX25ldyhk
cm0tPmRldik7CisJaWYgKElTX0VSUihwcml2LT5jbWRidWZfc3ViYWxsb2MpKSB7CisJCWRldl9l
cnIoZHJtLT5kZXYsICJGYWlsZWQgdG8gY3JlYXRlIGNtZGJ1ZiBzdWJhbGxvY2F0b3JcbiIpOwor
CQlyZXQgPSBQVFJfRVJSKHByaXYtPmNtZGJ1Zl9zdWJhbGxvYyk7CisJCWdvdG8gb3V0X2ZyZWVf
cHJpdjsKKwl9CisKIAlkZXZfc2V0X2RydmRhdGEoZGV2LCBkcm0pOwogCiAJcmV0ID0gY29tcG9u
ZW50X2JpbmRfYWxsKGRldiwgZHJtKTsKIAlpZiAocmV0IDwgMCkKLQkJZ290byBvdXRfYmluZDsK
KwkJZ290byBvdXRfZGVzdHJveV9zdWJhbGxvYzsKIAogCWxvYWRfZ3B1KGRybSk7CiAKIAlyZXQg
PSBkcm1fZGV2X3JlZ2lzdGVyKGRybSwgMCk7CiAJaWYgKHJldCkKLQkJZ290byBvdXRfcmVnaXN0
ZXI7CisJCWdvdG8gb3V0X3VuYmluZDsKIAogCXJldHVybiAwOwogCi1vdXRfcmVnaXN0ZXI6Citv
dXRfdW5iaW5kOgogCWNvbXBvbmVudF91bmJpbmRfYWxsKGRldiwgZHJtKTsKLW91dF9iaW5kOgor
b3V0X2Rlc3Ryb3lfc3ViYWxsb2M6CisJZXRuYXZpdl9jbWRidWZfc3ViYWxsb2NfZGVzdHJveShw
cml2LT5jbWRidWZfc3ViYWxsb2MpOworb3V0X2ZyZWVfcHJpdjoKIAlrZnJlZShwcml2KTsKIG91
dF9wdXQ6CiAJZHJtX2Rldl9wdXQoZHJtKTsKQEAgLTU2NSw2ICs1NzQsOCBAQCBzdGF0aWMgdm9p
ZCBldG5hdml2X3VuYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYpCiAKIAlkZXYtPmRtYV9wYXJtcyA9
IE5VTEw7CiAKKwlldG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19kZXN0cm95KHByaXYtPmNtZGJ1Zl9z
dWJhbGxvYyk7CisKIAlkcm0tPmRldl9wcml2YXRlID0gTlVMTDsKIAlrZnJlZShwcml2KTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9kcnYuaCBiL2RyaXZl
cnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZHJ2LmgKaW5kZXggZWFiZTM5NGM0ZTI1Li5lMDUy
ZDdkYjY2YWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZHJ2
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9kcnYuaApAQCAtMzYsNiAr
MzYsOCBAQCBzdHJ1Y3QgZXRuYXZpdl9kcm1fcHJpdmF0ZSB7CiAJc3RydWN0IGRldmljZV9kbWFf
cGFyYW1ldGVycyBkbWFfcGFybXM7CiAJc3RydWN0IGV0bmF2aXZfZ3B1ICpncHVbRVROQV9NQVhf
UElQRVNdOwogCisJc3RydWN0IGV0bmF2aXZfY21kYnVmX3N1YmFsbG9jICpjbWRidWZfc3ViYWxs
b2M7CisKIAkvKiBsaXN0IG9mIEdFTSBvYmplY3RzOiAqLwogCXN0cnVjdCBtdXRleCBnZW1fbG9j
azsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGdlbV9saXN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMgYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZp
di9ldG5hdml2X2dlbV9zdWJtaXQuYwppbmRleCBmNTM1YTYyN2YyOTcuLjNmNGY2YWIzODhkZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9nZW1fc3VibWl0LmMKQEAgLTQ5
Niw3ICs0OTYsNyBAQCBpbnQgZXRuYXZpdl9pb2N0bF9nZW1fc3VibWl0KHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCWdvdG8gZXJyX3N1Ym1pdF93d19hY3F1aXJlOwogCX0K
IAotCXJldCA9IGV0bmF2aXZfY21kYnVmX2luaXQoZ3B1LT5jbWRidWZfc3ViYWxsb2MsICZzdWJt
aXQtPmNtZGJ1ZiwKKwlyZXQgPSBldG5hdml2X2NtZGJ1Zl9pbml0KHByaXYtPmNtZGJ1Zl9zdWJh
bGxvYywgJnN1Ym1pdC0+Y21kYnVmLAogCQkJCSAgQUxJR04oYXJncy0+c3RyZWFtX3NpemUsIDgp
ICsgOCk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJfc3VibWl0X29iamVjdHM7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5jIGIvZHJpdmVycy9ncHUvZHJt
L2V0bmF2aXYvZXRuYXZpdl9ncHUuYwppbmRleCA2MmEzOGE2M2U0ZWIuLjdiMzk2YWM1ZGJhNSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2V0bmF2aXYvZXRuYXZpdl9ncHUuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5jCkBAIC02OTMsNiArNjkzLDcgQEAg
c3RhdGljIHZvaWQgZXRuYXZpdl9ncHVfaHdfaW5pdChzdHJ1Y3QgZXRuYXZpdl9ncHUgKmdwdSkK
IAogaW50IGV0bmF2aXZfZ3B1X2luaXQoc3RydWN0IGV0bmF2aXZfZ3B1ICpncHUpCiB7CisJc3Ry
dWN0IGV0bmF2aXZfZHJtX3ByaXZhdGUgKnByaXYgPSBncHUtPmRybS0+ZGV2X3ByaXZhdGU7CiAJ
aW50IHJldCwgaTsKIAogCXJldCA9IHBtX3J1bnRpbWVfZ2V0X3N5bmMoZ3B1LT5kZXYpOwpAQCAt
NzYwLDIzICs3NjEsMTYgQEAgaW50IGV0bmF2aXZfZ3B1X2luaXQoc3RydWN0IGV0bmF2aXZfZ3B1
ICpncHUpCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQlncHUtPmNtZGJ1Zl9zdWJhbGxvYyA9IGV0bmF2
aXZfY21kYnVmX3N1YmFsbG9jX25ldyhncHUpOwotCWlmIChJU19FUlIoZ3B1LT5jbWRidWZfc3Vi
YWxsb2MpKSB7Ci0JCWRldl9lcnIoZ3B1LT5kZXYsICJGYWlsZWQgdG8gY3JlYXRlIGNtZGJ1ZiBz
dWJhbGxvY2F0b3JcbiIpOwotCQlyZXQgPSBQVFJfRVJSKGdwdS0+Y21kYnVmX3N1YmFsbG9jKTsK
LQkJZ290byBkZXN0cm95X2lvbW11OwotCX0KLQotCXJldCA9IGV0bmF2aXZfY21kYnVmX3N1YmFs
bG9jX21hcChncHUtPmNtZGJ1Zl9zdWJhbGxvYywgZ3B1LT5tbXUsCisJcmV0ID0gZXRuYXZpdl9j
bWRidWZfc3ViYWxsb2NfbWFwKHByaXYtPmNtZGJ1Zl9zdWJhbGxvYywgZ3B1LT5tbXUsCiAJCQkJ
CSAgJmdwdS0+Y21kYnVmX21hcHBpbmcsCiAJCQkJCSAgZ3B1LT5tZW1vcnlfYmFzZSk7CiAJaWYg
KHJldCkgewogCQlkZXZfZXJyKGdwdS0+ZGV2LCAiZmFpbGVkIHRvIG1hcCBjbWRidWYgc3ViYWxs
b2NcbiIpOwotCQlnb3RvIGRlc3Ryb3lfc3ViYWxsb2M7CisJCWdvdG8gZGVzdHJveV9pb21tdTsK
IAl9CiAKIAkvKiBDcmVhdGUgYnVmZmVyOiAqLwotCXJldCA9IGV0bmF2aXZfY21kYnVmX2luaXQo
Z3B1LT5jbWRidWZfc3ViYWxsb2MsICZncHUtPmJ1ZmZlciwKKwlyZXQgPSBldG5hdml2X2NtZGJ1
Zl9pbml0KHByaXYtPmNtZGJ1Zl9zdWJhbGxvYywgJmdwdS0+YnVmZmVyLAogCQkJCSAgUEFHRV9T
SVpFKTsKIAlpZiAocmV0KSB7CiAJCWRldl9lcnIoZ3B1LT5kZXYsICJjb3VsZCBub3QgY3JlYXRl
IGNvbW1hbmQgYnVmZmVyXG4iKTsKQEAgLTgxNSw4ICs4MDksNiBAQCBpbnQgZXRuYXZpdl9ncHVf
aW5pdChzdHJ1Y3QgZXRuYXZpdl9ncHUgKmdwdSkKIAlldG5hdml2X2NtZGJ1Zl9mcmVlKCZncHUt
PmJ1ZmZlcik7CiB1bm1hcF9zdWJhbGxvYzoKIAlldG5hdml2X2NtZGJ1Zl9zdWJhbGxvY191bm1h
cChncHUtPm1tdSwgJmdwdS0+Y21kYnVmX21hcHBpbmcpOwotZGVzdHJveV9zdWJhbGxvYzoKLQll
dG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19kZXN0cm95KGdwdS0+Y21kYnVmX3N1YmFsbG9jKTsKIGRl
c3Ryb3lfaW9tbXU6CiAJZXRuYXZpdl9pb21tdV9kZXN0cm95KGdwdS0+bW11KTsKIGZhaWw6CkBA
IC0xNjkyLDcgKzE2ODQsNiBAQCBzdGF0aWMgdm9pZCBldG5hdml2X2dwdV91bmJpbmQoc3RydWN0
IGRldmljZSAqZGV2LCBzdHJ1Y3QgZGV2aWNlICptYXN0ZXIsCiAJaWYgKGdwdS0+aW5pdGlhbGl6
ZWQpIHsKIAkJZXRuYXZpdl9jbWRidWZfZnJlZSgmZ3B1LT5idWZmZXIpOwogCQlldG5hdml2X2Nt
ZGJ1Zl9zdWJhbGxvY191bm1hcChncHUtPm1tdSwgJmdwdS0+Y21kYnVmX21hcHBpbmcpOwotCQll
dG5hdml2X2NtZGJ1Zl9zdWJhbGxvY19kZXN0cm95KGdwdS0+Y21kYnVmX3N1YmFsbG9jKTsKIAkJ
ZXRuYXZpdl9pb21tdV9kZXN0cm95KGdwdS0+bW11KTsKIAkJZ3B1LT5pbml0aWFsaXplZCA9IGZh
bHNlOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1
LmggYi9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9ldG5hdml2X2dwdS5oCmluZGV4IDZhNmFkZDM1
MGQyZC4uOTMzYzhkMDE2ZjExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXRuYXZpdi9l
dG5hdml2X2dwdS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ldG5hdml2L2V0bmF2aXZfZ3B1LmgK
QEAgLTEzNyw3ICsxMzcsNiBAQCBzdHJ1Y3QgZXRuYXZpdl9ncHUgewogCWludCBpcnE7CiAKIAlz
dHJ1Y3QgZXRuYXZpdl9pb21tdSAqbW11OwotCXN0cnVjdCBldG5hdml2X2NtZGJ1Zl9zdWJhbGxv
YyAqY21kYnVmX3N1YmFsbG9jOwogCiAJLyogUG93ZXIgQ29udHJvbDogKi8KIAlzdHJ1Y3QgY2xr
ICpjbGtfYnVzOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9kcmktZGV2ZWw=
