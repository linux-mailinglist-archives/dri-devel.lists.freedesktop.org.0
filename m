Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DCBD3907FE
	for <lists+dri-devel@lfdr.de>; Fri, 16 Aug 2019 20:58:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D0F246E984;
	Fri, 16 Aug 2019 18:58:26 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8D7606E984
 for <dri-devel@lists.freedesktop.org>; Fri, 16 Aug 2019 18:58:25 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 11:58:24 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,394,1559545200"; d="scan'208";a="182252291"
Received: from nperf12.hd.intel.com ([10.127.88.161])
 by orsmga006.jf.intel.com with ESMTP; 16 Aug 2019 11:58:24 -0700
From: Brian Welty <brian.welty@intel.com>
To: =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Daniel Vetter <daniel@ffwll.ch>, dri-devel@lists.freedesktop.org
Subject: [PATCH] drm/ttm: Refactor ttm_bo_pipeline_move
Date: Fri, 16 Aug 2019 14:59:16 -0400
Message-Id: <20190816185916.30184-1-brian.welty@intel.com>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

dHRtX2JvX3BpcGVsaW5lX21vdmUgbmVlZGxlc3NseSBkdXBsaWNhdGVzIGNvZGUuIFJlZmFjdG9y
IHRoaXMgdG8KaW5zdGVhZCBjYWxsIHR0bV9ib19tb3ZlX2FjY2VsX2NsZWFudXAuCgpTaWduZWQt
b2ZmLWJ5OiBCcmlhbiBXZWx0eSA8YnJpYW4ud2VsdHlAaW50ZWwuY29tPgoKLS0tCkJ1aWxkcyBi
dXQgb3RoZXJ3aXNlIGN1cnJlbnRseSB1bnRlc3RlZC4KQ2FtZSBhY3Jvc3MgdGhpcyBkdXBsaWNh
dGlvbiBhbmQgdGhvdWdodCB3b3VsZCBzZWUgaWYgb3RoZXJzIGNhcmVkCnRvIHNlZSBpdCBjbGVh
bmVkIHVwIHRoaXMgd2F5IG9yIG5vdC4KCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGls
LmMgfCA2NCArKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
NSBpbnNlcnRpb25zKCspLCA1OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdHRtL3R0bV9ib191dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGls
LmMKaW5kZXggZmU4MWM1NjVlN2VmLi4wODZiYTJjMmY2MGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9i
b191dGlsLmMKQEAgLTc0Niw0OSArNzQ2LDEwIEBAIGludCB0dG1fYm9fcGlwZWxpbmVfbW92ZShz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogewogCXN0cnVjdCB0dG1fYm9fZGV2aWNlICpi
ZGV2ID0gYm8tPmJkZXY7CiAJc3RydWN0IHR0bV9tZW1fcmVnICpvbGRfbWVtID0gJmJvLT5tZW07
Ci0KIAlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKmZyb20gPSAmYmRldi0+bWFuW29sZF9t
ZW0tPm1lbV90eXBlXTsKLQlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKnRvID0gJmJkZXYt
Pm1hbltuZXdfbWVtLT5tZW1fdHlwZV07Ci0KLQlpbnQgcmV0OwotCi0JZG1hX3Jlc3ZfYWRkX2V4
Y2xfZmVuY2UoYm8tPmJhc2UucmVzdiwgZmVuY2UpOwotCi0JaWYgKCFldmljdCkgewotCQlzdHJ1
Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmdob3N0X29iajsKLQotCQkvKioKLQkJICogVGhpcyBzaG91
bGQgaGVscCBwaXBlbGluZSBvcmRpbmFyeSBidWZmZXIgbW92ZXMuCi0JCSAqCi0JCSAqIEhhbmcg
b2xkIGJ1ZmZlciBtZW1vcnkgb24gYSBuZXcgYnVmZmVyIG9iamVjdCwKLQkJICogYW5kIGxlYXZl
IGl0IHRvIGJlIHJlbGVhc2VkIHdoZW4gdGhlIEdQVQotCQkgKiBvcGVyYXRpb24gaGFzIGNvbXBs
ZXRlZC4KLQkJICovCi0KLQkJZG1hX2ZlbmNlX3B1dChiby0+bW92aW5nKTsKLQkJYm8tPm1vdmlu
ZyA9IGRtYV9mZW5jZV9nZXQoZmVuY2UpOwogCi0JCXJldCA9IHR0bV9idWZmZXJfb2JqZWN0X3Ry
YW5zZmVyKGJvLCAmZ2hvc3Rfb2JqKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0KLQkJ
ZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UoZ2hvc3Rfb2JqLT5iYXNlLnJlc3YsIGZlbmNlKTsKLQot
CQkvKioKLQkJICogSWYgd2UncmUgbm90IG1vdmluZyB0byBmaXhlZCBtZW1vcnksIHRoZSBUVE0g
b2JqZWN0Ci0JCSAqIG5lZWRzIHRvIHN0YXkgYWxpdmUuIE90aGVyd2hpc2UgaGFuZyBpdCBvbiB0
aGUgZ2hvc3QKLQkJICogYm8gdG8gYmUgdW5ib3VuZCBhbmQgZGVzdHJveWVkLgotCQkgKi8KLQot
CQlpZiAoISh0by0+ZmxhZ3MgJiBUVE1fTUVNVFlQRV9GTEFHX0ZJWEVEKSkKLQkJCWdob3N0X29i
ai0+dHRtID0gTlVMTDsKLQkJZWxzZQotCQkJYm8tPnR0bSA9IE5VTEw7Ci0KLQkJdHRtX2JvX3Vu
cmVzZXJ2ZShnaG9zdF9vYmopOwotCQl0dG1fYm9fcHV0KGdob3N0X29iaik7Ci0KLQl9IGVsc2Ug
aWYgKGZyb20tPmZsYWdzICYgVFRNX01FTVRZUEVfRkxBR19GSVhFRCkgeworCWlmIChldmljdCAm
JiBmcm9tLT5mbGFncyAmIFRUTV9NRU1UWVBFX0ZMQUdfRklYRUQpIHsKKwkJZG1hX3Jlc3ZfYWRk
X2V4Y2xfZmVuY2UoYm8tPmJhc2UucmVzdiwgZmVuY2UpOwogCiAJCS8qKgogCQkgKiBCTyBkb2Vz
bid0IGhhdmUgYSBUVE0gd2UgbmVlZCB0byBiaW5kL3VuYmluZC4gSnVzdCByZW1lbWJlcgpAQCAt
ODA3LDI3ICs3NjgsMTIgQEAgaW50IHR0bV9ib19waXBlbGluZV9tb3ZlKHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sCiAJCWRtYV9mZW5jZV9wdXQoYm8tPm1vdmluZyk7CiAJCWJvLT5tb3Zp
bmcgPSBkbWFfZmVuY2VfZ2V0KGZlbmNlKTsKIAorCQkqb2xkX21lbSA9ICpuZXdfbWVtOworCQlu
ZXdfbWVtLT5tbV9ub2RlID0gTlVMTDsKIAl9IGVsc2UgewotCQkvKioKLQkJICogTGFzdCByZXNv
cnQsIHdhaXQgZm9yIHRoZSBtb3ZlIHRvIGJlIGNvbXBsZXRlZC4KLQkJICoKLQkJICogU2hvdWxk
IG5ldmVyIGhhcHBlbiBpbiBwcmF0aWNlLgotCQkgKi8KLQotCQlyZXQgPSB0dG1fYm9fd2FpdChi
bywgZmFsc2UsIGZhbHNlKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0KLQkJaWYgKHRv
LT5mbGFncyAmIFRUTV9NRU1UWVBFX0ZMQUdfRklYRUQpIHsKLQkJCXR0bV90dF9kZXN0cm95KGJv
LT50dG0pOwotCQkJYm8tPnR0bSA9IE5VTEw7Ci0JCX0KLQkJdHRtX2JvX2ZyZWVfb2xkX25vZGUo
Ym8pOworCQlyZXR1cm4gdHRtX2JvX21vdmVfYWNjZWxfY2xlYW51cChibywgZmVuY2UsIGV2aWN0
LCBuZXdfbWVtKTsKIAl9CiAKLQkqb2xkX21lbSA9ICpuZXdfbWVtOwotCW5ld19tZW0tPm1tX25v
ZGUgPSBOVUxMOwotCiAJcmV0dXJuIDA7CiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib19waXBlbGlu
ZV9tb3ZlKTsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
ZHJpLWRldmVs
