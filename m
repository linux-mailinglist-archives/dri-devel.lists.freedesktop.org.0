Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 67C821053DA
	for <lists+dri-devel@lfdr.de>; Thu, 21 Nov 2019 15:02:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 64E236E11A;
	Thu, 21 Nov 2019 14:02:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail.kernel.org (mail.kernel.org [198.145.29.99])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 876EB6F376;
 Thu, 21 Nov 2019 14:02:39 +0000 (UTC)
Received: from localhost (173-25-83-245.client.mchsi.com [173.25.83.245])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by mail.kernel.org (Postfix) with ESMTPSA id 2B97E20714;
 Thu, 21 Nov 2019 14:02:39 +0000 (UTC)
From: Bjorn Helgaas <helgaas@kernel.org>
To: linux-pci@vger.kernel.org
Subject: [PATCH 7/7] drm/radeon: Prefer pcie_capability_read_word()
Date: Thu, 21 Nov 2019 08:02:20 -0600
Message-Id: <20191121140220.38030-8-helgaas@kernel.org>
X-Mailer: git-send-email 2.24.0.432.g9d3f5f5b63-goog
In-Reply-To: <20191121140220.38030-1-helgaas@kernel.org>
References: <20191121140220.38030-1-helgaas@kernel.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=kernel.org; s=default; t=1574344959;
 bh=j2R7umbnwYPTfuakVY4ri9+557mRJqnFYDG1a3ta4Zw=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=SaiqbowzaWUe0h6reKvDs2RNJleEn+AB1xJ5oF+r9Cb1b6PJrrZ8VdavVjGFK4y1H
 qhUPpjRDDekq5F3fE5aiMgEkN4rteW3ijxBTEAlOnZSj+D7Ol4ScsmWsfcbzrfDqF0
 tL425VLhoVLgTlnbCuEv1yGxIqREjDQNdf8KZUck=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Frederick Lawler <fred@fredlawl.com>, Dave Airlie <airlied@linux.ie>,
 linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 Bjorn Helgaas <bhelgaas@google.com>, amd-gfx@lists.freedesktop.org,
 Christian Koenig <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogRnJlZGVyaWNrIExhd2xlciA8ZnJlZEBmcmVkbGF3bC5jb20+CgpDb21taXQgOGMwZDNh
MDJjMTMwICgiUENJOiBBZGQgYWNjZXNzb3JzIGZvciBQQ0kgRXhwcmVzcyBDYXBhYmlsaXR5IikK
YWRkZWQgYWNjZXNzb3JzIGZvciB0aGUgUENJIEV4cHJlc3MgQ2FwYWJpbGl0eSBzbyB0aGF0IGRy
aXZlcnMgZGlkbid0Cm5lZWQgdG8gYmUgYXdhcmUgb2YgZGlmZmVyZW5jZXMgYmV0d2VlbiB2MSBh
bmQgdjIgb2YgdGhlIFBDSQpFeHByZXNzIENhcGFiaWxpdHkuCgpSZXBsYWNlIHBjaV9yZWFkX2Nv
bmZpZ193b3JkKCkgYW5kIHBjaV93cml0ZV9jb25maWdfd29yZCgpIGNhbGxzIHdpdGgKcGNpZV9j
YXBhYmlsaXR5X3JlYWRfd29yZCgpIGFuZCBwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZCgpLgoK
TGluazogaHR0cHM6Ly9sb3JlLmtlcm5lbC5vcmcvci8yMDE5MTExODAwMzUxMy4xMDg1Mi0xLWZy
ZWRAZnJlZGxhd2wuY29tClNpZ25lZC1vZmYtYnk6IEZyZWRlcmljayBMYXdsZXIgPGZyZWRAZnJl
ZGxhd2wuY29tPgpTaWduZWQtb2ZmLWJ5OiBCam9ybiBIZWxnYWFzIDxiaGVsZ2Fhc0Bnb29nbGUu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vY2lrLmMgfCA3MCArKysrKysrKysrKysr
KysrKysrKystLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3NpLmMgIHwgNzMg
KysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDkw
IGluc2VydGlvbnMoKyksIDUzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9yYWRlb24vY2lrLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL2Npay5jCmluZGV4IGEy
ODA0NDJjODFhYS4uMDlhNDcwOWU2N2YwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFk
ZW9uL2Npay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vY2lrLmMKQEAgLTk1MDQsNyAr
OTUwNCw2IEBAIHN0YXRpYyB2b2lkIGNpa19wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25f
ZGV2aWNlICpyZGV2KQogewogCXN0cnVjdCBwY2lfZGV2ICpyb290ID0gcmRldi0+cGRldi0+YnVz
LT5zZWxmOwogCWVudW0gcGNpX2J1c19zcGVlZCBzcGVlZF9jYXA7Ci0JaW50IGJyaWRnZV9wb3Ms
IGdwdV9wb3M7CiAJdTMyIHNwZWVkX2NudGwsIGN1cnJlbnRfZGF0YV9yYXRlOwogCWludCBpOwog
CXUxNiB0bXAxNjsKQEAgLTk1NDYsMTIgKzk1NDUsNyBAQCBzdGF0aWMgdm9pZCBjaWtfcGNpZV9n
ZW4zX2VuYWJsZShzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldikKIAkJRFJNX0lORk8oImVuYWJs
aW5nIFBDSUUgZ2VuIDIgbGluayBzcGVlZHMsIGRpc2FibGUgd2l0aCByYWRlb24ucGNpZV9nZW4y
PTBcbiIpOwogCX0KIAotCWJyaWRnZV9wb3MgPSBwY2lfcGNpZV9jYXAocm9vdCk7Ci0JaWYgKCFi
cmlkZ2VfcG9zKQotCQlyZXR1cm47Ci0KLQlncHVfcG9zID0gcGNpX3BjaWVfY2FwKHJkZXYtPnBk
ZXYpOwotCWlmICghZ3B1X3BvcykKKwlpZiAoIXBjaV9pc19wY2llKHJvb3QpIHx8ICFwY2lfaXNf
cGNpZShyZGV2LT5wZGV2KSkKIAkJcmV0dXJuOwogCiAJaWYgKHNwZWVkX2NhcCA9PSBQQ0lFX1NQ
RUVEXzhfMEdUKSB7CkBAIC05NTYxLDE0ICs5NTU1LDE3IEBAIHN0YXRpYyB2b2lkIGNpa19wY2ll
X2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2KQogCQkJdTE2IGJyaWRnZV9j
ZmcyLCBncHVfY2ZnMjsKIAkJCXUzMiBtYXhfbHcsIGN1cnJlbnRfbHcsIHRtcDsKIAotCQkJcGNp
X3JlYWRfY29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAmYnJp
ZGdlX2NmZyk7Ci0JCQlwY2lfcmVhZF9jb25maWdfd29yZChyZGV2LT5wZGV2LCBncHVfcG9zICsg
UENJX0VYUF9MTktDVEwsICZncHVfY2ZnKTsKKwkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQo
cm9vdCwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkgICZicmlkZ2VfY2ZnKTsKKwkJCXBjaWVfY2Fw
YWJpbGl0eV9yZWFkX3dvcmQocmRldi0+cGRldiwgUENJX0VYUF9MTktDVEwsCisJCQkJCQkgICZn
cHVfY2ZnKTsKIAogCQkJdG1wMTYgPSBicmlkZ2VfY2ZnIHwgUENJX0VYUF9MTktDVExfSEFXRDsK
LQkJCXBjaV93cml0ZV9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktD
VEwsIHRtcDE2KTsKKwkJCXBjaWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJvb3QsIFBDSV9FWFBf
TE5LQ1RMLCB0bXAxNik7CiAKIAkJCXRtcDE2ID0gZ3B1X2NmZyB8IFBDSV9FWFBfTE5LQ1RMX0hB
V0Q7Ci0JCQlwY2lfd3JpdGVfY29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9F
WFBfTE5LQ1RMLCB0bXAxNik7CisJCQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChyZGV2LT5w
ZGV2LCBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCSAgIHRtcDE2KTsKIAogCQkJdG1wID0gUlJFRzMy
X1BDSUVfUE9SVChQQ0lFX0xDX1NUQVRVUzEpOwogCQkJbWF4X2x3ID0gKHRtcCAmIExDX0RFVEVD
VEVEX0xJTktfV0lEVEhfTUFTSykgPj4gTENfREVURUNURURfTElOS19XSURUSF9TSElGVDsKQEAg
LTk1ODYsMTUgKzk1ODMsMjMgQEAgc3RhdGljIHZvaWQgY2lrX3BjaWVfZ2VuM19lbmFibGUoc3Ry
dWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYpCiAKIAkJCWZvciAoaSA9IDA7IGkgPCAxMDsgaSsrKSB7
CiAJCQkJLyogY2hlY2sgc3RhdHVzICovCi0JCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQocmRldi0+
cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfREVWU1RBLCAmdG1wMTYpOworCQkJCXBjaWVfY2FwYWJp
bGl0eV9yZWFkX3dvcmQocmRldi0+cGRldiwKKwkJCQkJCQkgIFBDSV9FWFBfREVWU1RBLAorCQkJ
CQkJCSAgJnRtcDE2KTsKIAkJCQlpZiAodG1wMTYgJiBQQ0lfRVhQX0RFVlNUQV9UUlBORCkKIAkJ
CQkJYnJlYWs7CiAKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsg
UENJX0VYUF9MTktDVEwsICZicmlkZ2VfY2ZnKTsKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChy
ZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwsICZncHVfY2ZnKTsKKwkJCQlwY2ll
X2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgJmJy
aWRnZV9jZmcpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocmRldi0+cGRldiwKKwkJ
CQkJCQkgIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgJmdwdV9jZmcpOwogCi0JCQkJcGNpX3Jl
YWRfY29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgJmJyaWRn
ZV9jZmcyKTsKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChyZGV2LT5wZGV2LCBncHVfcG9zICsg
UENJX0VYUF9MTktDVEwyLCAmZ3B1X2NmZzIpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dv
cmQocm9vdCwgUENJX0VYUF9MTktDVEwyLAorCQkJCQkJCSAgJmJyaWRnZV9jZmcyKTsKKwkJCQlw
Y2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJkZXYtPnBkZXYsCisJCQkJCQkJICBQQ0lfRVhQX0xO
S0NUTDIsCisJCQkJCQkJICAmZ3B1X2NmZzIpOwogCiAJCQkJdG1wID0gUlJFRzMyX1BDSUVfUE9S
VChQQ0lFX0xDX0NOVEw0KTsKIAkJCQl0bXAgfD0gTENfU0VUX1FVSUVTQ0U7CkBAIC05NjA3LDMy
ICs5NjEyLDQ1IEBAIHN0YXRpYyB2b2lkIGNpa19wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRl
b25fZGV2aWNlICpyZGV2KQogCQkJCW1zbGVlcCgxMDApOwogCiAJCQkJLyogbGlua2N0bCAqLwot
CQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NU
TCwgJnRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBf
TE5LQ1RMLAorCQkJCQkJCSAgJnRtcDE2KTsKIAkJCQl0bXAxNiAmPSB+UENJX0VYUF9MTktDVExf
SEFXRDsKIAkJCQl0bXAxNiB8PSAoYnJpZGdlX2NmZyAmIFBDSV9FWFBfTE5LQ1RMX0hBV0QpOwot
CQkJCXBjaV93cml0ZV9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktD
VEwsIHRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChyb290LCBQQ0lfRVhQ
X0xOS0NUTCwKKwkJCQkJCQkgICB0bXAxNik7CiAKLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChy
ZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwsICZ0bXAxNik7CisJCQkJcGNpZV9j
YXBhYmlsaXR5X3JlYWRfd29yZChyZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEws
CisJCQkJCQkJICAmdG1wMTYpOwogCQkJCXRtcDE2ICY9IH5QQ0lfRVhQX0xOS0NUTF9IQVdEOwog
CQkJCXRtcDE2IHw9IChncHVfY2ZnICYgUENJX0VYUF9MTktDVExfSEFXRCk7Ci0JCQkJcGNpX3dy
aXRlX2NvbmZpZ193b3JkKHJkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgdG1w
MTYpOworCQkJCXBjaWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJkZXYtPnBkZXYsCisJCQkJCQkJ
ICAgUENJX0VYUF9MTktDVEwsCisJCQkJCQkJICAgdG1wMTYpOwogCiAJCQkJLyogbGlua2N0bDIg
Ki8KLQkJCQlwY2lfcmVhZF9jb25maWdfd29yZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9M
TktDVEwyLCAmdG1wMTYpOworCQkJCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocm9vdCwgUENJ
X0VYUF9MTktDVEwyLAorCQkJCQkJCSAgJnRtcDE2KTsKIAkJCQl0bXAxNiAmPSB+KFBDSV9FWFBf
TE5LQ1RMMl9FTlRFUl9DT01QIHwKIAkJCQkJICAgUENJX0VYUF9MTktDVEwyX1RYX01BUkdJTik7
CiAJCQkJdG1wMTYgfD0gKGJyaWRnZV9jZmcyICYKIAkJCQkJICAoUENJX0VYUF9MTktDVEwyX0VO
VEVSX0NPTVAgfAogCQkJCQkgICBQQ0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKSk7Ci0JCQkJcGNp
X3dyaXRlX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsIHRt
cDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChyb290LAorCQkJCQkJCSAgIFBD
SV9FWFBfTE5LQ1RMMiwKKwkJCQkJCQkgICB0bXAxNik7CiAKLQkJCQlwY2lfcmVhZF9jb25maWdf
d29yZChyZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwyLCAmdG1wMTYpOworCQkJ
CXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocmRldi0+cGRldiwKKwkJCQkJCQkgIFBDSV9FWFBf
TE5LQ1RMMiwKKwkJCQkJCQkgICZ0bXAxNik7CiAJCQkJdG1wMTYgJj0gfihQQ0lfRVhQX0xOS0NU
TDJfRU5URVJfQ09NUCB8CiAJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMMl9UWF9NQVJHSU4pOwogCQkJ
CXRtcDE2IHw9IChncHVfY2ZnMiAmCiAJCQkJCSAgKFBDSV9FWFBfTE5LQ1RMMl9FTlRFUl9DT01Q
IHwKIAkJCQkJICAgUENJX0VYUF9MTktDVEwyX1RYX01BUkdJTikpOwotCQkJCXBjaV93cml0ZV9j
b25maWdfd29yZChyZGV2LT5wZGV2LCBncHVfcG9zICsgUENJX0VYUF9MTktDVEwyLCB0bXAxNik7
CisJCQkJcGNpZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQocmRldi0+cGRldiwKKwkJCQkJCQkgICBQ
Q0lfRVhQX0xOS0NUTDIsCisJCQkJCQkJICAgdG1wMTYpOwogCiAJCQkJdG1wID0gUlJFRzMyX1BD
SUVfUE9SVChQQ0lFX0xDX0NOVEw0KTsKIAkJCQl0bXAgJj0gfkxDX1NFVF9RVUlFU0NFOwpAQCAt
OTY0Niw3ICs5NjY0LDcgQEAgc3RhdGljIHZvaWQgY2lrX3BjaWVfZ2VuM19lbmFibGUoc3RydWN0
IHJhZGVvbl9kZXZpY2UgKnJkZXYpCiAJc3BlZWRfY250bCAmPSB+TENfRk9SQ0VfRElTX1NXX1NQ
RUVEX0NIQU5HRTsKIAlXUkVHMzJfUENJRV9QT1JUKFBDSUVfTENfU1BFRURfQ05UTCwgc3BlZWRf
Y250bCk7CiAKLQlwY2lfcmVhZF9jb25maWdfd29yZChyZGV2LT5wZGV2LCBncHVfcG9zICsgUENJ
X0VYUF9MTktDVEwyLCAmdG1wMTYpOworCXBjaWVfY2FwYWJpbGl0eV9yZWFkX3dvcmQocmRldi0+
cGRldiwgUENJX0VYUF9MTktDVEwyLCAmdG1wMTYpOwogCXRtcDE2ICY9IH5QQ0lfRVhQX0xOS0NU
TDJfVExTOwogCWlmIChzcGVlZF9jYXAgPT0gUENJRV9TUEVFRF84XzBHVCkKIAkJdG1wMTYgfD0g
UENJX0VYUF9MTktDVEwyX1RMU184XzBHVDsgLyogZ2VuMyAqLwpAQCAtOTY1NCw3ICs5NjcyLDcg
QEAgc3RhdGljIHZvaWQgY2lrX3BjaWVfZ2VuM19lbmFibGUoc3RydWN0IHJhZGVvbl9kZXZpY2Ug
KnJkZXYpCiAJCXRtcDE2IHw9IFBDSV9FWFBfTE5LQ1RMMl9UTFNfNV8wR1Q7IC8qIGdlbjIgKi8K
IAllbHNlCiAJCXRtcDE2IHw9IFBDSV9FWFBfTE5LQ1RMMl9UTFNfMl81R1Q7IC8qIGdlbjEgKi8K
LQlwY2lfd3JpdGVfY29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5L
Q1RMMiwgdG1wMTYpOworCXBjaWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJkZXYtPnBkZXYsIFBD
SV9FWFBfTE5LQ1RMMiwgdG1wMTYpOwogCiAJc3BlZWRfY250bCA9IFJSRUczMl9QQ0lFX1BPUlQo
UENJRV9MQ19TUEVFRF9DTlRMKTsKIAlzcGVlZF9jbnRsIHw9IExDX0lOSVRJQVRFX0xJTktfU1BF
RURfQ0hBTkdFOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9zaS5jIGIvZHJp
dmVycy9ncHUvZHJtL3JhZGVvbi9zaS5jCmluZGV4IDUyOWU3MGE0MjAxOS4uNjdhOThiMzM3MGQx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3NpLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3JhZGVvbi9zaS5jCkBAIC0zMjU3LDcgKzMyNTcsNyBAQCBzdGF0aWMgdm9pZCBzaV9n
cHVfaW5pdChzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldikKIAkJLyogWFhYIHdoYXQgYWJvdXQg
MTI/ICovCiAJCXJkZXYtPmNvbmZpZy5zaS50aWxlX2NvbmZpZyB8PSAoMyA8PCAwKTsKIAkJYnJl
YWs7Ci0JfQkKKwl9CiAJc3dpdGNoICgobWNfYXJiX3JhbWNmZyAmIE5PT0ZCQU5LX01BU0spID4+
IE5PT0ZCQU5LX1NISUZUKSB7CiAJY2FzZSAwOiAvKiBmb3VyIGJhbmtzICovCiAJCXJkZXYtPmNv
bmZpZy5zaS50aWxlX2NvbmZpZyB8PSAwIDw8IDQ7CkBAIC03MDg3LDcgKzcwODcsNiBAQCBzdGF0
aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2KQog
ewogCXN0cnVjdCBwY2lfZGV2ICpyb290ID0gcmRldi0+cGRldi0+YnVzLT5zZWxmOwogCWVudW0g
cGNpX2J1c19zcGVlZCBzcGVlZF9jYXA7Ci0JaW50IGJyaWRnZV9wb3MsIGdwdV9wb3M7CiAJdTMy
IHNwZWVkX2NudGwsIGN1cnJlbnRfZGF0YV9yYXRlOwogCWludCBpOwogCXUxNiB0bXAxNjsKQEAg
LTcxMjksMTIgKzcxMjgsNyBAQCBzdGF0aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVj
dCByYWRlb25fZGV2aWNlICpyZGV2KQogCQlEUk1fSU5GTygiZW5hYmxpbmcgUENJRSBnZW4gMiBs
aW5rIHNwZWVkcywgZGlzYWJsZSB3aXRoIHJhZGVvbi5wY2llX2dlbjI9MFxuIik7CiAJfQogCi0J
YnJpZGdlX3BvcyA9IHBjaV9wY2llX2NhcChyb290KTsKLQlpZiAoIWJyaWRnZV9wb3MpCi0JCXJl
dHVybjsKLQotCWdwdV9wb3MgPSBwY2lfcGNpZV9jYXAocmRldi0+cGRldik7Ci0JaWYgKCFncHVf
cG9zKQorCWlmICghcGNpX2lzX3BjaWUocm9vdCkgfHwgIXBjaV9pc19wY2llKHJkZXYtPnBkZXYp
KQogCQlyZXR1cm47CiAKIAlpZiAoc3BlZWRfY2FwID09IFBDSUVfU1BFRURfOF8wR1QpIHsKQEAg
LTcxNDQsMTQgKzcxMzgsMTcgQEAgc3RhdGljIHZvaWQgc2lfcGNpZV9nZW4zX2VuYWJsZShzdHJ1
Y3QgcmFkZW9uX2RldmljZSAqcmRldikKIAkJCXUxNiBicmlkZ2VfY2ZnMiwgZ3B1X2NmZzI7CiAJ
CQl1MzIgbWF4X2x3LCBjdXJyZW50X2x3LCB0bXA7CiAKLQkJCXBjaV9yZWFkX2NvbmZpZ193b3Jk
KHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgJmJyaWRnZV9jZmcpOwotCQkJcGNp
X3JlYWRfY29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAm
Z3B1X2NmZyk7CisJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5L
Q1RMLAorCQkJCQkJICAmYnJpZGdlX2NmZyk7CisJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3Jk
KHJkZXYtPnBkZXYsIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJICAmZ3B1X2NmZyk7CiAKIAkJCXRt
cDE2ID0gYnJpZGdlX2NmZyB8IFBDSV9FWFBfTE5LQ1RMX0hBV0Q7Ci0JCQlwY2lfd3JpdGVfY29u
ZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CisJCQlw
Y2llX2NhcGFiaWxpdHlfd3JpdGVfd29yZChyb290LCBQQ0lfRVhQX0xOS0NUTCwgdG1wMTYpOwog
CiAJCQl0bXAxNiA9IGdwdV9jZmcgfCBQQ0lfRVhQX0xOS0NUTF9IQVdEOwotCQkJcGNpX3dyaXRl
X2NvbmZpZ193b3JkKHJkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgdG1wMTYp
OworCQkJcGNpZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQocmRldi0+cGRldiwgUENJX0VYUF9MTktD
VEwsCisJCQkJCQkgICB0bXAxNik7CiAKIAkJCXRtcCA9IFJSRUczMl9QQ0lFKFBDSUVfTENfU1RB
VFVTMSk7CiAJCQltYXhfbHcgPSAodG1wICYgTENfREVURUNURURfTElOS19XSURUSF9NQVNLKSA+
PiBMQ19ERVRFQ1RFRF9MSU5LX1dJRFRIX1NISUZUOwpAQCAtNzE2OSwxNSArNzE2NiwyMyBAQCBz
dGF0aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2
KQogCiAJCQlmb3IgKGkgPSAwOyBpIDwgMTA7IGkrKykgewogCQkJCS8qIGNoZWNrIHN0YXR1cyAq
LwotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJkZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQ
X0RFVlNUQSwgJnRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJkZXYtPnBk
ZXYsCisJCQkJCQkJICBQQ0lfRVhQX0RFVlNUQSwKKwkJCQkJCQkgICZ0bXAxNik7CiAJCQkJaWYg
KHRtcDE2ICYgUENJX0VYUF9ERVZTVEFfVFJQTkQpCiAJCQkJCWJyZWFrOwogCi0JCQkJcGNpX3Jl
YWRfY29uZmlnX3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMLCAmYnJpZGdl
X2NmZyk7Ci0JCQkJcGNpX3JlYWRfY29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBD
SV9FWFBfTE5LQ1RMLCAmZ3B1X2NmZyk7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChy
b290LCBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCQkgICZicmlkZ2VfY2ZnKTsKKwkJCQlwY2llX2Nh
cGFiaWxpdHlfcmVhZF93b3JkKHJkZXYtPnBkZXYsCisJCQkJCQkJICBQQ0lfRVhQX0xOS0NUTCwK
KwkJCQkJCQkgICZncHVfY2ZnKTsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJy
aWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZicmlkZ2VfY2ZnMik7Ci0JCQkJcGNpX3JlYWRf
Y29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgJmdwdV9j
ZmcyKTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RM
MiwKKwkJCQkJCQkgICZicmlkZ2VfY2ZnMik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29y
ZChyZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEwyLAorCQkJCQkJCSAgJmdwdV9j
ZmcyKTsKIAogCQkJCXRtcCA9IFJSRUczMl9QQ0lFX1BPUlQoUENJRV9MQ19DTlRMNCk7CiAJCQkJ
dG1wIHw9IExDX1NFVF9RVUlFU0NFOwpAQCAtNzE5MCwzMiArNzE5NSw0NiBAQCBzdGF0aWMgdm9p
ZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2KQogCQkJCW1z
bGVlcCgxMDApOwogCiAJCQkJLyogbGlua2N0bCAqLwotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3Jk
KHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgJnRtcDE2KTsKKwkJCQlwY2llX2Nh
cGFiaWxpdHlfcmVhZF93b3JkKHJvb3QsIFBDSV9FWFBfTE5LQ1RMLAorCQkJCQkJCSAgJnRtcDE2
KTsKIAkJCQl0bXAxNiAmPSB+UENJX0VYUF9MTktDVExfSEFXRDsKIAkJCQl0bXAxNiB8PSAoYnJp
ZGdlX2NmZyAmIFBDSV9FWFBfTE5LQ1RMX0hBV0QpOwotCQkJCXBjaV93cml0ZV9jb25maWdfd29y
ZChyb290LCBicmlkZ2VfcG9zICsgUENJX0VYUF9MTktDVEwsIHRtcDE2KTsKKwkJCQlwY2llX2Nh
cGFiaWxpdHlfd3JpdGVfd29yZChyb290LAorCQkJCQkJCSAgIFBDSV9FWFBfTE5LQ1RMLAorCQkJ
CQkJCSAgIHRtcDE2KTsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJkZXYtPnBkZXYsIGdw
dV9wb3MgKyBQQ0lfRVhQX0xOS0NUTCwgJnRtcDE2KTsKKwkJCQlwY2llX2NhcGFiaWxpdHlfcmVh
ZF93b3JkKHJkZXYtPnBkZXYsCisJCQkJCQkJICBQQ0lfRVhQX0xOS0NUTCwKKwkJCQkJCQkgICZ0
bXAxNik7CiAJCQkJdG1wMTYgJj0gflBDSV9FWFBfTE5LQ1RMX0hBV0Q7CiAJCQkJdG1wMTYgfD0g
KGdwdV9jZmcgJiBQQ0lfRVhQX0xOS0NUTF9IQVdEKTsKLQkJCQlwY2lfd3JpdGVfY29uZmlnX3dv
cmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMLCB0bXAxNik7CisJCQkJcGNp
ZV9jYXBhYmlsaXR5X3dyaXRlX3dvcmQocmRldi0+cGRldiwKKwkJCQkJCQkgICBQQ0lfRVhQX0xO
S0NUTCwKKwkJCQkJCQkgICB0bXAxNik7CiAKIAkJCQkvKiBsaW5rY3RsMiAqLwotCQkJCXBjaV9y
ZWFkX2NvbmZpZ193b3JkKHJvb3QsIGJyaWRnZV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZ0bXAx
Nik7CisJCQkJcGNpZV9jYXBhYmlsaXR5X3JlYWRfd29yZChyb290LCBQQ0lfRVhQX0xOS0NUTDIs
CisJCQkJCQkJICAmdG1wMTYpOwogCQkJCXRtcDE2ICY9IH4oUENJX0VYUF9MTktDVEwyX0VOVEVS
X0NPTVAgfAogCQkJCQkgICBQQ0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKTsKIAkJCQl0bXAxNiB8
PSAoYnJpZGdlX2NmZzIgJgogCQkJCQkgIChQQ0lfRVhQX0xOS0NUTDJfRU5URVJfQ09NUCB8CiAJ
CQkJCSAgIFBDSV9FWFBfTE5LQ1RMMl9UWF9NQVJHSU4pKTsKLQkJCQlwY2lfd3JpdGVfY29uZmln
X3dvcmQocm9vdCwgYnJpZGdlX3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgdG1wMTYpOworCQkJCXBj
aWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJvb3QsCisJCQkJCQkJICAgUENJX0VYUF9MTktDVEwy
LAorCQkJCQkJCSAgIHRtcDE2KTsKIAotCQkJCXBjaV9yZWFkX2NvbmZpZ193b3JkKHJkZXYtPnBk
ZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsICZ0bXAxNik7CisJCQkJcGNpZV9jYXBhYmls
aXR5X3JlYWRfd29yZChyZGV2LT5wZGV2LAorCQkJCQkJCSAgUENJX0VYUF9MTktDVEwyLAorCQkJ
CQkJCSAgJnRtcDE2KTsKIAkJCQl0bXAxNiAmPSB+KFBDSV9FWFBfTE5LQ1RMMl9FTlRFUl9DT01Q
IHwKIAkJCQkJICAgUENJX0VYUF9MTktDVEwyX1RYX01BUkdJTik7CiAJCQkJdG1wMTYgfD0gKGdw
dV9jZmcyICYKIAkJCQkJICAoUENJX0VYUF9MTktDVEwyX0VOVEVSX0NPTVAgfAogCQkJCQkgICBQ
Q0lfRVhQX0xOS0NUTDJfVFhfTUFSR0lOKSk7Ci0JCQkJcGNpX3dyaXRlX2NvbmZpZ193b3JkKHJk
ZXYtPnBkZXYsIGdwdV9wb3MgKyBQQ0lfRVhQX0xOS0NUTDIsIHRtcDE2KTsKKwkJCQlwY2llX2Nh
cGFiaWxpdHlfd3JpdGVfd29yZChyZGV2LT5wZGV2LAorCQkJCQkJCSAgIFBDSV9FWFBfTE5LQ1RM
MiwKKwkJCQkJCQkgICB0bXAxNik7CiAKIAkJCQl0bXAgPSBSUkVHMzJfUENJRV9QT1JUKFBDSUVf
TENfQ05UTDQpOwogCQkJCXRtcCAmPSB+TENfU0VUX1FVSUVTQ0U7CkBAIC03MjI5LDcgKzcyNDgs
NyBAQCBzdGF0aWMgdm9pZCBzaV9wY2llX2dlbjNfZW5hYmxlKHN0cnVjdCByYWRlb25fZGV2aWNl
ICpyZGV2KQogCXNwZWVkX2NudGwgJj0gfkxDX0ZPUkNFX0RJU19TV19TUEVFRF9DSEFOR0U7CiAJ
V1JFRzMyX1BDSUVfUE9SVChQQ0lFX0xDX1NQRUVEX0NOVEwsIHNwZWVkX2NudGwpOwogCi0JcGNp
X3JlYWRfY29uZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwg
JnRtcDE2KTsKKwlwY2llX2NhcGFiaWxpdHlfcmVhZF93b3JkKHJkZXYtPnBkZXYsIFBDSV9FWFBf
TE5LQ1RMMiwgJnRtcDE2KTsKIAl0bXAxNiAmPSB+UENJX0VYUF9MTktDVEwyX1RMUzsKIAlpZiAo
c3BlZWRfY2FwID09IFBDSUVfU1BFRURfOF8wR1QpCiAJCXRtcDE2IHw9IFBDSV9FWFBfTE5LQ1RM
Ml9UTFNfOF8wR1Q7IC8qIGdlbjMgKi8KQEAgLTcyMzcsNyArNzI1Niw3IEBAIHN0YXRpYyB2b2lk
IHNpX3BjaWVfZ2VuM19lbmFibGUoc3RydWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYpCiAJCXRtcDE2
IHw9IFBDSV9FWFBfTE5LQ1RMMl9UTFNfNV8wR1Q7IC8qIGdlbjIgKi8KIAllbHNlCiAJCXRtcDE2
IHw9IFBDSV9FWFBfTE5LQ1RMMl9UTFNfMl81R1Q7IC8qIGdlbjEgKi8KLQlwY2lfd3JpdGVfY29u
ZmlnX3dvcmQocmRldi0+cGRldiwgZ3B1X3BvcyArIFBDSV9FWFBfTE5LQ1RMMiwgdG1wMTYpOwor
CXBjaWVfY2FwYWJpbGl0eV93cml0ZV93b3JkKHJkZXYtPnBkZXYsIFBDSV9FWFBfTE5LQ1RMMiwg
dG1wMTYpOwogCiAJc3BlZWRfY250bCA9IFJSRUczMl9QQ0lFX1BPUlQoUENJRV9MQ19TUEVFRF9D
TlRMKTsKIAlzcGVlZF9jbnRsIHw9IExDX0lOSVRJQVRFX0xJTktfU1BFRURfQ0hBTkdFOwotLSAK
Mi4yNC4wLjQzMi5nOWQzZjVmNWI2My1nb29nCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9kcmktZGV2ZWw=
