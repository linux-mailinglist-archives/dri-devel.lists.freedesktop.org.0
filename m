Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CF155112811
	for <lists+dri-devel@lfdr.de>; Wed,  4 Dec 2019 10:45:03 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D8EA372B6D;
	Wed,  4 Dec 2019 09:44:51 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mailgw02.mediatek.com (unknown [210.61.82.184])
 by gabe.freedesktop.org (Postfix) with ESMTP id AF08D72B34
 for <dri-devel@lists.freedesktop.org>; Wed,  4 Dec 2019 09:44:48 +0000 (UTC)
X-UUID: a283ba03eaec493fa781eb2cf53b19c9-20191204
X-UUID: a283ba03eaec493fa781eb2cf53b19c9-20191204
Received: from mtkcas08.mediatek.inc [(172.21.101.126)] by
 mailgw02.mediatek.com (envelope-from <bibby.hsieh@mediatek.com>)
 (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
 with ESMTP id 1482137463; Wed, 04 Dec 2019 17:44:44 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs07n2.mediatek.inc (172.21.101.141) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Wed, 4 Dec 2019 17:44:31 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via
 Frontend Transport; Wed, 4 Dec 2019 17:43:48 +0800
From: Bibby Hsieh <bibby.hsieh@mediatek.com>
To: David Airlie <airlied@linux.ie>, Matthias Brugger
 <matthias.bgg@gmail.com>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 <dri-devel@lists.freedesktop.org>, <linux-mediatek@lists.infradead.org>
Subject: [PATCH v3 3/6] drm/mediatek: update cursors by using async atomic
 update
Date: Wed, 4 Dec 2019 17:44:38 +0800
Message-ID: <20191204094441.5116-4-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191204094441.5116-1-bibby.hsieh@mediatek.com>
References: <20191204094441.5116-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
X-MTK: N
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=mediatek.com; s=dk; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From;
 bh=CPZxYcQ+mZc+WqsoECwgbO5dG/2bo/PmsJk1rPtK+cs=; 
 b=WDdv5ltHTle22vWK1uDNSz3cuJtzdPE6WcPfjjkC/Hvb82euSJooJ6dDGoEeVarGSpRKve+SCXRLKRCYLkh8u603FM5WqcUvtQQWSAHSfm7Up94BRF6b8KDswb4PjtuEQR2VxsPr5X8eNicky4IjdFXyhlM077xuAMjX3LjYexw=;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: drinkcat@chromium.org, srv_heupstream@mediatek.com,
 linux-kernel@vger.kernel.org, tfiga@chromium.org,
 Thierry Reding <thierry.reding@gmail.com>,
 linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U3VwcG9ydCB0byBhc3luYyB1cGRhdGVzIG9mIGN1cnNvcnMgYnkgdXNpbmcgdGhlIG5ldyBhdG9t
aWMNCmludGVyZmFjZSBmb3IgdGhhdC4NCg0KU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWggPGJp
YmJ5LmhzaWVoQG1lZGlhdGVrLmNvbT4NCi0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9t
dGtfZHJtX2NydGMuYyAgfCA3NSArKysrKysrKysrKysrKysrKy0tLS0tLS0NCiBkcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmggIHwgIDIgKw0KIGRyaXZlcnMvZ3B1L2RybS9t
ZWRpYXRlay9tdGtfZHJtX3BsYW5lLmMgfCA1MCArKysrKysrKysrKysrKysrDQogZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuaCB8ICAyICsNCiA0IGZpbGVzIGNoYW5nZWQs
IDEwOCBpbnNlcnRpb25zKCspLCAyMSBkZWxldGlvbnMoLSkNCg0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRp
YXRlay9tdGtfZHJtX2NydGMuYw0KaW5kZXggNGJjNTIzNDYwOTNkLi45MmIzYjM5N2M2YzQgMTAw
NjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMNCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuYw0KQEAgLTQ3LDYgKzQ3LDkg
QEAgc3RydWN0IG10a19kcm1fY3J0YyB7DQogCXN0cnVjdCBtdGtfZGlzcF9tdXRleAkJKm11dGV4
Ow0KIAl1bnNpZ25lZCBpbnQJCQlkZHBfY29tcF9ucjsNCiAJc3RydWN0IG10a19kZHBfY29tcAkJ
KipkZHBfY29tcDsNCisNCisJLyogbG9jayBmb3IgZGlzcGxheSBoYXJkd2FyZSBhY2Nlc3MgKi8N
CisJc3RydWN0IG11dGV4CQkJaHdfbG9jazsNCiB9Ow0KIA0KIHN0cnVjdCBtdGtfY3J0Y19zdGF0
ZSB7DQpAQCAtNDE3LDYgKzQyMCw0MSBAQCBzdGF0aWMgdm9pZCBtdGtfY3J0Y19kZHBfY29uZmln
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YykNCiAJfQ0KIH0NCiANCitzdGF0aWMgdm9pZCBtdGtfZHJt
X2NydGNfaHdfY29uZmlnKHN0cnVjdCBtdGtfZHJtX2NydGMgKm10a19jcnRjKQ0KK3sNCisJc3Ry
dWN0IGRybV9jcnRjICpjcnRjID0gJm10a19jcnRjLT5iYXNlOw0KKwlzdHJ1Y3QgbXRrX2RybV9w
cml2YXRlICpwcml2ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsNCisJdW5zaWduZWQgaW50IHBl
bmRpbmdfcGxhbmVzID0gMDsNCisJaW50IGk7DQorDQorCW11dGV4X2xvY2soJm10a19jcnRjLT5o
d19sb2NrKTsNCisJZm9yIChpID0gMDsgaSA8IG10a19jcnRjLT5sYXllcl9ucjsgaSsrKSB7DQor
CQlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSA9ICZtdGtfY3J0Yy0+cGxhbmVzW2ldOw0KKwkJc3Ry
dWN0IG10a19wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7DQorDQorCQlwbGFuZV9zdGF0ZSA9IHRv
X210a19wbGFuZV9zdGF0ZShwbGFuZS0+c3RhdGUpOw0KKwkJaWYgKHBsYW5lX3N0YXRlLT5wZW5k
aW5nLmRpcnR5KSB7DQorCQkJcGxhbmVfc3RhdGUtPnBlbmRpbmcuY29uZmlnID0gdHJ1ZTsNCisJ
CQlwbGFuZV9zdGF0ZS0+cGVuZGluZy5kaXJ0eSA9IGZhbHNlOw0KKwkJCXBlbmRpbmdfcGxhbmVz
IHw9IEJJVChpKTsNCisJCX0gZWxzZSBpZiAocGxhbmVfc3RhdGUtPnBlbmRpbmcuYXN5bmNfZGly
dHkpIHsNCisJCQlwbGFuZV9zdGF0ZS0+cGVuZGluZy5jb25maWcgPSB0cnVlOw0KKwkJCXBsYW5l
X3N0YXRlLT5wZW5kaW5nLmFzeW5jX3VwZGF0ZSA9IGZhbHNlOw0KKwkJCXBsYW5lX3N0YXRlLT5w
ZW5kaW5nLmFzeW5jX2RpcnR5ID0gZmFsc2U7DQorCQkJcGVuZGluZ19wbGFuZXMgfD0gQklUKGkp
Ow0KKwkJfQ0KKwl9DQorCWlmIChwZW5kaW5nX3BsYW5lcykNCisJCW10a19jcnRjLT5wZW5kaW5n
X3BsYW5lcyA9IHRydWU7DQorDQorCWlmIChwcml2LT5kYXRhLT5zaGFkb3dfcmVnaXN0ZXIpIHsN
CisJCW10a19kaXNwX211dGV4X2FjcXVpcmUobXRrX2NydGMtPm11dGV4KTsNCisJCW10a19jcnRj
X2RkcF9jb25maWcoY3J0Yyk7DQorCQltdGtfZGlzcF9tdXRleF9yZWxlYXNlKG10a19jcnRjLT5t
dXRleCk7DQorCX0NCisJbXV0ZXhfdW5sb2NrKCZtdGtfY3J0Yy0+aHdfbG9jayk7DQorfQ0KKw0K
IGludCBtdGtfZHJtX2NydGNfcGxhbmVfY2hlY2soc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwNCiAJCQkgICAgIHN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnN0
YXRlKQ0KIHsNCkBAIC00MjksNiArNDY3LDIwIEBAIGludCBtdGtfZHJtX2NydGNfcGxhbmVfY2hl
Y2soc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwNCiAJcmV0
dXJuIDA7DQogfQ0KIA0KK3ZvaWQgbXRrX2RybV9jcnRjX2FzeW5jX3VwZGF0ZShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsIHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0KKwkJCSAgICAgICBzdHJ1Y3Qg
ZHJtX3BsYW5lX3N0YXRlICpuZXdfc3RhdGUpDQorew0KKwlzdHJ1Y3QgbXRrX2RybV9jcnRjICpt
dGtfY3J0YyA9IHRvX210a19jcnRjKGNydGMpOw0KKwljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2hl
bHBlcl9mdW5jcyAqcGxhbmVfaGVscGVyX2Z1bmNzID0NCisJCQlwbGFuZS0+aGVscGVyX3ByaXZh
dGU7DQorDQorCWlmICghbXRrX2NydGMtPmVuYWJsZWQpDQorCQlyZXR1cm47DQorDQorCXBsYW5l
X2hlbHBlcl9mdW5jcy0+YXRvbWljX3VwZGF0ZShwbGFuZSwgbmV3X3N0YXRlKTsNCisJbXRrX2Ry
bV9jcnRjX2h3X2NvbmZpZyhtdGtfY3J0Yyk7DQorfQ0KKw0KIHN0YXRpYyB2b2lkIG10a19kcm1f
Y3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywNCiAJCQkJICAgICAgIHN0
cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX3N0YXRlKQ0KIHsNCkBAIC01MTAsMzQgKzU2MiwxNCBA
QCBzdGF0aWMgdm9pZCBtdGtfZHJtX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAq
Y3J0YywNCiAJCQkJICAgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkN
CiB7DQogCXN0cnVjdCBtdGtfZHJtX2NydGMgKm10a19jcnRjID0gdG9fbXRrX2NydGMoY3J0Yyk7
DQotCXN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgKnByaXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRl
Ow0KLQl1bnNpZ25lZCBpbnQgcGVuZGluZ19wbGFuZXMgPSAwOw0KIAlpbnQgaTsNCiANCiAJaWYg
KG10a19jcnRjLT5ldmVudCkNCiAJCW10a19jcnRjLT5wZW5kaW5nX25lZWRzX3ZibGFuayA9IHRy
dWU7DQotCWZvciAoaSA9IDA7IGkgPCBtdGtfY3J0Yy0+bGF5ZXJfbnI7IGkrKykgew0KLQkJc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUgPSAmbXRrX2NydGMtPnBsYW5lc1tpXTsNCi0JCXN0cnVjdCBt
dGtfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOw0KLQ0KLQkJcGxhbmVfc3RhdGUgPSB0b19tdGtf
cGxhbmVfc3RhdGUocGxhbmUtPnN0YXRlKTsNCi0JCWlmIChwbGFuZV9zdGF0ZS0+cGVuZGluZy5k
aXJ0eSkgew0KLQkJCXBsYW5lX3N0YXRlLT5wZW5kaW5nLmNvbmZpZyA9IHRydWU7DQotCQkJcGxh
bmVfc3RhdGUtPnBlbmRpbmcuZGlydHkgPSBmYWxzZTsNCi0JCQlwZW5kaW5nX3BsYW5lcyB8PSBC
SVQoaSk7DQotCQl9DQotCX0NCi0JaWYgKHBlbmRpbmdfcGxhbmVzKQ0KLQkJbXRrX2NydGMtPnBl
bmRpbmdfcGxhbmVzID0gdHJ1ZTsNCiAJaWYgKGNydGMtPnN0YXRlLT5jb2xvcl9tZ210X2NoYW5n
ZWQpDQogCQlmb3IgKGkgPSAwOyBpIDwgbXRrX2NydGMtPmRkcF9jb21wX25yOyBpKyspDQogCQkJ
bXRrX2RkcF9nYW1tYV9zZXQobXRrX2NydGMtPmRkcF9jb21wW2ldLCBjcnRjLT5zdGF0ZSk7DQot
DQotCWlmIChwcml2LT5kYXRhLT5zaGFkb3dfcmVnaXN0ZXIpIHsNCi0JCW10a19kaXNwX211dGV4
X2FjcXVpcmUobXRrX2NydGMtPm11dGV4KTsNCi0JCW10a19jcnRjX2RkcF9jb25maWcoY3J0Yyk7
DQotCQltdGtfZGlzcF9tdXRleF9yZWxlYXNlKG10a19jcnRjLT5tdXRleCk7DQotCX0NCisJbXRr
X2RybV9jcnRjX2h3X2NvbmZpZyhtdGtfY3J0Yyk7DQogfQ0KIA0KIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX2NydGNfZnVuY3MgbXRrX2NydGNfZnVuY3MgPSB7DQpAQCAtNzI5LDYgKzc2MSw3IEBA
IGludCBtdGtfZHJtX2NydGNfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2LA0KIAlk
cm1fbW9kZV9jcnRjX3NldF9nYW1tYV9zaXplKCZtdGtfY3J0Yy0+YmFzZSwgTVRLX0xVVF9TSVpF
KTsNCiAJZHJtX2NydGNfZW5hYmxlX2NvbG9yX21nbXQoJm10a19jcnRjLT5iYXNlLCAwLCBmYWxz
ZSwgTVRLX0xVVF9TSVpFKTsNCiAJcHJpdi0+bnVtX3BpcGVzKys7DQorCW11dGV4X2luaXQoJm10
a19jcnRjLT5od19sb2NrKTsNCiANCiAJcmV0dXJuIDA7DQogfQ0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuaCBiL2RyaXZlcnMvZ3B1L2RybS9tZWRp
YXRlay9tdGtfZHJtX2NydGMuaA0KaW5kZXggNmFmZTFjMTk1NTdhLi5hMmI0Njc3YTQ1MWMgMTAw
NjQ0DQotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgNCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX2NydGMuaA0KQEAgLTIxLDUgKzIxLDcg
QEAgaW50IG10a19kcm1fY3J0Y19jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRybV9kZXYsDQog
CQkJdW5zaWduZWQgaW50IHBhdGhfbGVuKTsNCiBpbnQgbXRrX2RybV9jcnRjX3BsYW5lX2NoZWNr
KHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQogCQkJICAg
ICBzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpzdGF0ZSk7DQordm9pZCBtdGtfZHJtX2NydGNfYXN5
bmNfdXBkYXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
DQorCQkJICAgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsNCiANCiAj
ZW5kaWYgLyogTVRLX0RSTV9DUlRDX0ggKi8NCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
bWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19k
cm1fcGxhbmUuYw0KaW5kZXggY2Q3Yzk3ZWI3ZWU2Li42YmRiNDJmMDY4ZmIgMTAwNjQ0DQotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5jDQorKysgYi9kcml2ZXJz
L2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5jDQpAQCAtNyw2ICs3LDcgQEANCiAjaW5j
bHVkZSA8ZHJtL2RybV9hdG9taWMuaD4NCiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVy
Lmg+DQogI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+DQorI2luY2x1ZGUgPGRybS9kcm1fYXRv
bWljX3VhcGkuaD4NCiAjaW5jbHVkZSA8ZHJtL2RybV9wbGFuZV9oZWxwZXIuaD4NCiAjaW5jbHVk
ZSA8ZHJtL2RybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLmg+DQogDQpAQCAtNzAsNiArNzEsNTAg
QEAgc3RhdGljIHZvaWQgbXRrX2RybV9wbGFuZV9kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLA0KIAlrZnJlZSh0b19tdGtfcGxhbmVfc3RhdGUoc3RhdGUpKTsNCiB9DQogDQor
c3RhdGljIGludCBtdGtfcGxhbmVfYXRvbWljX2FzeW5jX2NoZWNrKHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLA0KKwkJCQkJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpDQorew0KKwlzdHJ1
Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7DQorDQorCWlmIChwbGFuZSAhPSBzdGF0ZS0+
Y3J0Yy0+Y3Vyc29yKQ0KKwkJcmV0dXJuIC1FSU5WQUw7DQorDQorCWlmICghcGxhbmUtPnN0YXRl
KQ0KKwkJcmV0dXJuIC1FSU5WQUw7DQorDQorCWlmICghcGxhbmUtPnN0YXRlLT5mYikNCisJCXJl
dHVybiAtRUlOVkFMOw0KKw0KKwlpZiAoc3RhdGUtPnN0YXRlKQ0KKwkJY3J0Y19zdGF0ZSA9IGRy
bV9hdG9taWNfZ2V0X2V4aXN0aW5nX2NydGNfc3RhdGUoc3RhdGUtPnN0YXRlLA0KKwkJCQkJCQkJ
c3RhdGUtPmNydGMpOw0KKwllbHNlIC8qIFNwZWNpYWwgY2FzZSBmb3IgYXN5bmNocm9ub3VzIGN1
cnNvciB1cGRhdGVzLiAqLw0KKwkJY3J0Y19zdGF0ZSA9IHN0YXRlLT5jcnRjLT5zdGF0ZTsNCisN
CisJcmV0dXJuIGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0
ZSwgY3J0Y19zdGF0ZSwNCisJCQkJCQkgICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsDQor
CQkJCQkJICAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLA0KKwkJCQkJCSAgIHRydWUsIHRy
dWUpOw0KK30NCisNCitzdGF0aWMgdm9pZCBtdGtfcGxhbmVfYXRvbWljX2FzeW5jX3VwZGF0ZShz
dHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwNCisJCQkJCSAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAq
bmV3X3N0YXRlKQ0KK3sNCisJc3RydWN0IG10a19wbGFuZV9zdGF0ZSAqc3RhdGUgPSB0b19tdGtf
cGxhbmVfc3RhdGUocGxhbmUtPnN0YXRlKTsNCisNCisJcGxhbmUtPnN0YXRlLT5jcnRjX3ggPSBu
ZXdfc3RhdGUtPmNydGNfeDsNCisJcGxhbmUtPnN0YXRlLT5jcnRjX3kgPSBuZXdfc3RhdGUtPmNy
dGNfeTsNCisJcGxhbmUtPnN0YXRlLT5jcnRjX2ggPSBuZXdfc3RhdGUtPmNydGNfaDsNCisJcGxh
bmUtPnN0YXRlLT5jcnRjX3cgPSBuZXdfc3RhdGUtPmNydGNfdzsNCisJcGxhbmUtPnN0YXRlLT5z
cmNfeCA9IG5ld19zdGF0ZS0+c3JjX3g7DQorCXBsYW5lLT5zdGF0ZS0+c3JjX3kgPSBuZXdfc3Rh
dGUtPnNyY195Ow0KKwlwbGFuZS0+c3RhdGUtPnNyY19oID0gbmV3X3N0YXRlLT5zcmNfaDsNCisJ
cGxhbmUtPnN0YXRlLT5zcmNfdyA9IG5ld19zdGF0ZS0+c3JjX3c7DQorCXN0YXRlLT5wZW5kaW5n
LmFzeW5jX3VwZGF0ZSA9IHRydWU7DQorDQorCW10a19kcm1fY3J0Y19hc3luY191cGRhdGUobmV3
X3N0YXRlLT5jcnRjLCBwbGFuZSwgbmV3X3N0YXRlKTsNCit9DQorDQogc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fcGxhbmVfZnVuY3MgbXRrX3BsYW5lX2Z1bmNzID0gew0KIAkudXBkYXRlX3BsYW5l
ID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLA0KIAkuZGlzYWJsZV9wbGFuZSA9IGRy
bV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsDQpAQCAtMTQxLDYgKzE4Niw5IEBAIHN0YXRp
YyB2b2lkIG10a19wbGFuZV9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0K
IAlzdGF0ZS0+cGVuZGluZy5yb3RhdGlvbiA9IHBsYW5lLT5zdGF0ZS0+cm90YXRpb247DQogCXdt
YigpOyAvKiBNYWtlIHN1cmUgdGhlIGFib3ZlIHBhcmFtZXRlcnMgYXJlIHNldCBiZWZvcmUgdXBk
YXRlICovDQogCXN0YXRlLT5wZW5kaW5nLmRpcnR5ID0gdHJ1ZTsNCisNCisJaWYgKHN0YXRlLT5w
ZW5kaW5nLmFzeW5jX3VwZGF0ZSkNCisJCXN0YXRlLT5wZW5kaW5nLmFzeW5jX2RpcnR5ID0gdHJ1
ZTsNCiB9DQogDQogc3RhdGljIHZvaWQgbXRrX3BsYW5lX2F0b21pY19kaXNhYmxlKHN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lLA0KQEAgLTE1OCw2ICsyMDYsOCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MgbXRrX3BsYW5lX2hlbHBlcl9mdW5jcyA9IHsNCiAJLmF0
b21pY19jaGVjayA9IG10a19wbGFuZV9hdG9taWNfY2hlY2ssDQogCS5hdG9taWNfdXBkYXRlID0g
bXRrX3BsYW5lX2F0b21pY191cGRhdGUsDQogCS5hdG9taWNfZGlzYWJsZSA9IG10a19wbGFuZV9h
dG9taWNfZGlzYWJsZSwNCisJLmF0b21pY19hc3luY191cGRhdGUgPSBtdGtfcGxhbmVfYXRvbWlj
X2FzeW5jX3VwZGF0ZSwNCisJLmF0b21pY19hc3luY19jaGVjayA9IG10a19wbGFuZV9hdG9taWNf
YXN5bmNfY2hlY2ssDQogfTsNCiANCiBpbnQgbXRrX3BsYW5lX2luaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRl
ay9tdGtfZHJtX3BsYW5lLmgNCmluZGV4IDc2MDg4NWUzNWIyNy4uNDE4ODI0NjVkZDY3IDEwMDY0
NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuaA0KKysrIGIv
ZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUuaA0KQEAgLTIyLDYgKzIyLDgg
QEAgc3RydWN0IG10a19wbGFuZV9wZW5kaW5nX3N0YXRlIHsNCiAJdW5zaWduZWQgaW50CQkJaGVp
Z2h0Ow0KIAl1bnNpZ25lZCBpbnQJCQlyb3RhdGlvbjsNCiAJYm9vbAkJCQlkaXJ0eTsNCisJYm9v
bAkJCQlhc3luY19kaXJ0eTsNCisJYm9vbAkJCQlhc3luY191cGRhdGU7DQogfTsNCiANCiBzdHJ1
Y3QgbXRrX3BsYW5lX3N0YXRlIHsNCi0tIA0KMi4xOC4wDQpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZl
bEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
