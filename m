Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1D656AD99C
	for <lists+dri-devel@lfdr.de>; Mon,  9 Sep 2019 15:05:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5560489AEE;
	Mon,  9 Sep 2019 13:05:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.suse.de (mx2.suse.de [195.135.220.15])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 83DA489533
 for <dri-devel@lists.freedesktop.org>; Mon,  9 Sep 2019 13:04:58 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
 by mx1.suse.de (Postfix) with ESMTP id C4641AC2C;
 Mon,  9 Sep 2019 13:04:56 +0000 (UTC)
From: Thomas Zimmermann <tzimmermann@suse.de>
To: daniel@ffwll.ch, kraxel@redhat.com, airlied@linux.ie, corbet@lwn.net,
 z.liuxinliang@hisilicon.com, zourongrong@gmail.com,
 kong.kongxinwei@hisilicon.com, puck.chen@hisilicon.com,
 hdegoede@redhat.com, sam@ravnborg.org, yc_chen@aspeedtech.com
Subject: [PATCH 1/4] drm/vram: Move VRAM memory manager to GEM VRAM
 implementation
Date: Mon,  9 Sep 2019 15:04:50 +0200
Message-Id: <20190909130453.6718-2-tzimmermann@suse.de>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190909130453.6718-1-tzimmermann@suse.de>
References: <20190909130453.6718-1-tzimmermann@suse.de>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: virtualization@lists.linux-foundation.org,
 Thomas Zimmermann <tzimmermann@suse.de>, dri-devel@lists.freedesktop.org,
 linux-doc@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHNlcGFyYXRpb24gYmV0d2VlbiBHRU0gVlJBTSBvYmplY3RzIGFuZCBhbmQgdGhlIG1lbW9y
eSBtYW5hZ2VyCmlzIGFydGlmaWNpYWwsIGFzIHRoZXkgYXJlIG9ubHkgdXNlZCB3aXRoIGVhY2gg
b3RoZXIuIENvcHlpbmcgYm90aAppbXBsZW1lbnRhdGlvbnMgaW50byB0aGUgc2FtZSBmaWxlIGlz
IGEgZmlyc3Qgc3RlcCB0byBzaW1wbGlmeWluZwp0aGUgY29kZS4KClRoaXMgcGF0Y2ggb25seSBt
b3ZlcyBjb2RlIHdpdGhvdXQgZnVuY3Rpb25hbCBjaGFuZ2VzLgoKU2lnbmVkLW9mZi1ieTogVGhv
bWFzIFppbW1lcm1hbm4gPHR6aW1tZXJtYW5uQHN1c2UuZGU+Ci0tLQogRG9jdW1lbnRhdGlvbi9n
cHUvZHJtLW1tLnJzdCAgICAgICAgICAgICAgICAgIHwgIDEyIC0KIGRyaXZlcnMvZ3B1L2RybS9N
YWtlZmlsZSAgICAgICAgICAgICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2Fz
dC9hc3RfZHJ2LmMgICAgICAgICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9hc3Qv
YXN0X21haW4uYyAgICAgICAgICAgICAgICB8ICAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vYXN0L2Fz
dF90dG0uYyAgICAgICAgICAgICAgICAgfCAgIDEgLQogZHJpdmVycy9ncHUvZHJtL2JvY2hzL2Jv
Y2hzLmggICAgICAgICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtX3Zy
YW1faGVscGVyLmMgICAgICAgICB8IDMwMyArKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUv
ZHJtL2RybV92cmFtX21tX2hlbHBlci5jICAgICAgICAgIHwgMzA5IC0tLS0tLS0tLS0tLS0tLS0t
LQogLi4uL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX2RybV9kcnYuYyAgIHwgICAxIC0K
IGRyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfdHRtLmMgICB8ICAgMSAtCiBk
cml2ZXJzL2dwdS9kcm0vbWdhZzIwMC9tZ2FnMjAwX2Rydi5oICAgICAgICAgfCAgIDEgLQogZHJp
dmVycy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X2Rydi5oICAgICAgICAgIHwgICAyIC0KIGluY2x1
ZGUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaCAgICAgICAgICAgICB8ICA4NSArKysrKwogaW5j
bHVkZS9kcm0vZHJtX3ZyYW1fbW1faGVscGVyLmggICAgICAgICAgICAgIHwgIDc2IC0tLS0tCiAx
NCBmaWxlcyBjaGFuZ2VkLCAzODkgaW5zZXJ0aW9ucygrKSwgNDA4IGRlbGV0aW9ucygtKQogZGVs
ZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9kcm1fdnJhbV9tbV9oZWxwZXIuYwoKZGlm
ZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vZ3B1L2RybS1tbS5yc3QgYi9Eb2N1bWVudGF0aW9uL2dw
dS9kcm0tbW0ucnN0CmluZGV4IGI2NjRmMDU0YzI1OS4uOWU2MWZlZjNjZjViIDEwMDY0NAotLS0g
YS9Eb2N1bWVudGF0aW9uL2dwdS9kcm0tbW0ucnN0CisrKyBiL0RvY3VtZW50YXRpb24vZ3B1L2Ry
bS1tbS5yc3QKQEAgLTQwMCwxOCArNDAwLDYgQEAgR0VNIFZSQU0gSGVscGVyIEZ1bmN0aW9ucyBS
ZWZlcmVuY2UKIC4uIGtlcm5lbC1kb2M6OiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hl
bHBlci5jCiAgICA6ZXhwb3J0OgogCi1WUkFNIE1NIEhlbHBlciBGdW5jdGlvbnMgUmVmZXJlbmNl
Ci0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0KLS4uIGtlcm5lbC1kb2M6OiBk
cml2ZXJzL2dwdS9kcm0vZHJtX3ZyYW1fbW1faGVscGVyLmMKLSAgIDpkb2M6IG92ZXJ2aWV3Ci0K
LS4uIGtlcm5lbC1kb2M6OiBpbmNsdWRlL2RybS9kcm1fdnJhbV9tbV9oZWxwZXIuaAotICAgOmlu
dGVybmFsOgotCi0uLiBrZXJuZWwtZG9jOjogZHJpdmVycy9ncHUvZHJtL2RybV92cmFtX21tX2hl
bHBlci5jCi0gICA6ZXhwb3J0OgotCiBWTUEgT2Zmc2V0IE1hbmFnZXIKID09PT09PT09PT09PT09
PT09PQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUgYi9kcml2ZXJzL2dw
dS9kcm0vTWFrZWZpbGUKaW5kZXggODJmZjgyNmIzM2NjLi5iYjhjZjAyYTYwNGIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vTWFrZWZp
bGUKQEAgLTMzLDggKzMzLDcgQEAgZHJtLSQoQ09ORklHX0RFQlVHX0ZTKSArPSBkcm1fZGVidWdm
cy5vIGRybV9kZWJ1Z2ZzX2NyYy5vCiBkcm0tJChDT05GSUdfRFJNX0xPQURfRURJRF9GSVJNV0FS
RSkgKz0gZHJtX2VkaWRfbG9hZC5vCiAKIGRybV92cmFtX2hlbHBlci15IDo9IGRybV9nZW1fdnJh
bV9oZWxwZXIubyBcCi0JCSAgICAgZHJtX3ZyYW1faGVscGVyX2NvbW1vbi5vIFwKLQkJICAgICBk
cm1fdnJhbV9tbV9oZWxwZXIubworCQkgICAgIGRybV92cmFtX2hlbHBlcl9jb21tb24ubwogb2Jq
LSQoQ09ORklHX0RSTV9WUkFNX0hFTFBFUikgKz0gZHJtX3ZyYW1faGVscGVyLm8KIAogZHJtX2tt
c19oZWxwZXIteSA6PSBkcm1fY3J0Y19oZWxwZXIubyBkcm1fZHBfaGVscGVyLm8gZHJtX2RzYy5v
IGRybV9wcm9iZV9oZWxwZXIubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2Fz
dF9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9hc3QvYXN0X2Rydi5jCmluZGV4IDZlZDZmZjQ5ZWZj
MC4uZTBlODc3MDQ2MmJjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9kcnYuYwpAQCAtMzUsNyArMzUsNiBAQAog
I2luY2x1ZGUgPGRybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9w
Y2kuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9k
cm1fdnJhbV9tbV9oZWxwZXIuaD4KIAogI2luY2x1ZGUgImFzdF9kcnYuaCIKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9h
c3RfbWFpbi5jCmluZGV4IDUwZGU4ZTQ3NjU5Yy4uMjE3MTVkNmE5YjU2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vYXN0L2FzdF9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9h
c3RfbWFpbi5jCkBAIC0zMyw3ICszMyw2IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KICNp
bmNsdWRlIDxkcm0vZHJtX2dlbV9mcmFtZWJ1ZmZlcl9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2dlbV92cmFtX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fdnJhbV9tbV9oZWxwZXIu
aD4KIAogI2luY2x1ZGUgImFzdF9kcnYuaCIKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2FzdC9hc3RfdHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vYXN0L2FzdF90dG0uYwppbmRleCBjNTJk
OTIyOTQxNzEuLjA4YmEwYTkxNzU5MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FzdC9h
c3RfdHRtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FzdC9hc3RfdHRtLmMKQEAgLTMwLDcgKzMw
LDYgQEAKIAogI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2dl
bV92cmFtX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4KIAog
I2luY2x1ZGUgImFzdF9kcnYuaCIKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2JvY2hz
L2JvY2hzLmggYi9kcml2ZXJzL2dwdS9kcm0vYm9jaHMvYm9jaHMuaAppbmRleCA2ODQ4M2EyZmMx
MmMuLjkxNzc2NzE3M2VlNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2JvY2hzL2JvY2hz
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2JvY2hzL2JvY2hzLmgKQEAgLTEwLDcgKzEwLDYgQEAK
ICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgogI2luY2x1ZGUgPGRybS9kcm1fZ2VtX3ZyYW1faGVs
cGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9zaW1wbGVfa21zX2hlbHBlci5oPgotI2luY2x1ZGUg
PGRybS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4KIAogLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jIGIvZHJpdmVycy9n
cHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwppbmRleCAwOTkwZjBlMDMyMTMuLjIwMmY3NDQ1
MzU4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5jCkBAIC0yLDYgKzIsNyBA
QAogCiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2RldmljZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgogI2luY2x1ZGUgPGRybS9k
cm1fbW9kZS5oPgogI2luY2x1ZGUgPGRybS9kcm1fcHJpbWUuaD4KICNpbmNsdWRlIDxkcm0vZHJt
X3ZyYW1fbW1faGVscGVyLmg+CkBAIC0xNCw2ICsxNSwxMSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9nZW1fb2JqZWN0X2Z1bmNzIGRybV9nZW1fdnJhbV9vYmplY3RfZnVuY3M7CiAgKgogICog
VGhpcyBsaWJyYXJ5IHByb3ZpZGVzIGEgR0VNIGJ1ZmZlciBvYmplY3QgdGhhdCBpcyBiYWNrZWQg
YnkgdmlkZW8gUkFNCiAgKiAoVlJBTSkuIEl0IGNhbiBiZSB1c2VkIGZvciBmcmFtZWJ1ZmZlciBk
ZXZpY2VzIHdpdGggZGVkaWNhdGVkIG1lbW9yeS4KKyAqCisgKiBUaGUgZGF0YSBzdHJ1Y3R1cmUg
JnN0cnVjdCBkcm1fdnJhbV9tbSBhbmQgaXRzIGhlbHBlcnMgaW1wbGVtZW50IGEgbWVtb3J5Cisg
KiBtYW5hZ2VyIGZvciBzaW1wbGUgZnJhbWVidWZmZXIgZGV2aWNlcyB3aXRoIGRlZGljYXRlZCB2
aWRlbyBtZW1vcnkuIEJ1ZmZlcgorICogb2JqZWN0cyBhcmUgZWl0aGVyIHBsYWNlZCBpbiB2aWRl
byBSQU0gb3IgZXZpY3RlZCB0byBzeXN0ZW0gbWVtb3J5LiBUaGUgcnNwLgorICogYnVmZmVyIG9i
amVjdCBpcyBwcm92aWRlZCBieSAmc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QuCiAgKi8KIAog
LyoKQEAgLTczNCwzICs3NDAsMzAwIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3RfZnVuY3MgZHJtX2dlbV92cmFtX29iamVjdF9mdW5jcyA9IHsKIAkudm1hcAk9IGRybV9nZW1f
dnJhbV9vYmplY3Rfdm1hcCwKIAkudnVubWFwCT0gZHJtX2dlbV92cmFtX29iamVjdF92dW5tYXAK
IH07CisKKy8qCisgKiBWUkFNIG1lbW9yeSBtYW5hZ2VyCisgKi8KKworLyoKKyAqIFRUTSBUVAor
ICovCisKK3N0YXRpYyB2b2lkIGJhY2tlbmRfZnVuY19kZXN0cm95KHN0cnVjdCB0dG1fdHQgKnR0
KQoreworCXR0bV90dF9maW5pKHR0KTsKKwlrZnJlZSh0dCk7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qg
dHRtX2JhY2tlbmRfZnVuYyBiYWNrZW5kX2Z1bmMgPSB7CisJLmRlc3Ryb3kgPSBiYWNrZW5kX2Z1
bmNfZGVzdHJveQorfTsKKworLyoKKyAqIFRUTSBCTyBkZXZpY2UKKyAqLworCitzdGF0aWMgc3Ry
dWN0IHR0bV90dCAqYm9fZHJpdmVyX3R0bV90dF9jcmVhdGUoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywKKwkJCQkJICAgICAgdWludDMyX3QgcGFnZV9mbGFncykKK3sKKwlzdHJ1Y3QgdHRt
X3R0ICp0dDsKKwlpbnQgcmV0OworCisJdHQgPSBremFsbG9jKHNpemVvZigqdHQpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIXR0KQorCQlyZXR1cm4gTlVMTDsKKworCXR0LT5mdW5jID0gJmJhY2tlbmRf
ZnVuYzsKKworCXJldCA9IHR0bV90dF9pbml0KHR0LCBibywgcGFnZV9mbGFncyk7CisJaWYgKHJl
dCA8IDApCisJCWdvdG8gZXJyX3R0bV90dF9pbml0OworCisJcmV0dXJuIHR0OworCitlcnJfdHRt
X3R0X2luaXQ6CisJa2ZyZWUodHQpOworCXJldHVybiBOVUxMOworfQorCitzdGF0aWMgaW50IGJv
X2RyaXZlcl9pbml0X21lbV90eXBlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCB1aW50MzJf
dCB0eXBlLAorCQkJCSAgIHN0cnVjdCB0dG1fbWVtX3R5cGVfbWFuYWdlciAqbWFuKQoreworCXN3
aXRjaCAodHlwZSkgeworCWNhc2UgVFRNX1BMX1NZU1RFTToKKwkJbWFuLT5mbGFncyA9IFRUTV9N
RU1UWVBFX0ZMQUdfTUFQUEFCTEU7CisJCW1hbi0+YXZhaWxhYmxlX2NhY2hpbmcgPSBUVE1fUExf
TUFTS19DQUNISU5HOworCQltYW4tPmRlZmF1bHRfY2FjaGluZyA9IFRUTV9QTF9GTEFHX0NBQ0hF
RDsKKwkJYnJlYWs7CisJY2FzZSBUVE1fUExfVlJBTToKKwkJbWFuLT5mdW5jID0gJnR0bV9ib19t
YW5hZ2VyX2Z1bmM7CisJCW1hbi0+ZmxhZ3MgPSBUVE1fTUVNVFlQRV9GTEFHX0ZJWEVEIHwKKwkJ
CSAgICAgVFRNX01FTVRZUEVfRkxBR19NQVBQQUJMRTsKKwkJbWFuLT5hdmFpbGFibGVfY2FjaGlu
ZyA9IFRUTV9QTF9GTEFHX1VOQ0FDSEVEIHwKKwkJCQkJIFRUTV9QTF9GTEFHX1dDOworCQltYW4t
PmRlZmF1bHRfY2FjaGluZyA9IFRUTV9QTF9GTEFHX1dDOworCQlicmVhazsKKwlkZWZhdWx0Ogor
CQlyZXR1cm4gLUVJTlZBTDsKKwl9CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGJvX2Ry
aXZlcl9ldmljdF9mbGFncyhzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAorCQkJCSAgc3Ry
dWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCkKK3sKKwlzdHJ1Y3QgZHJtX3ZyYW1fbW0gKnZt
bSA9IGRybV92cmFtX21tX29mX2JkZXYoYm8tPmJkZXYpOworCisJaWYgKHZtbS0+ZnVuY3MgJiYg
dm1tLT5mdW5jcy0+ZXZpY3RfZmxhZ3MpCisJCXZtbS0+ZnVuY3MtPmV2aWN0X2ZsYWdzKGJvLCBw
bGFjZW1lbnQpOworfQorCitzdGF0aWMgaW50IGJvX2RyaXZlcl92ZXJpZnlfYWNjZXNzKHN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCisJCQkJICAgc3RydWN0IGZpbGUgKmZpbHApCit7CisJ
c3RydWN0IGRybV92cmFtX21tICp2bW0gPSBkcm1fdnJhbV9tbV9vZl9iZGV2KGJvLT5iZGV2KTsK
KworCWlmICghdm1tLT5mdW5jcyB8fCAhdm1tLT5mdW5jcy0+dmVyaWZ5X2FjY2VzcykKKwkJcmV0
dXJuIDA7CisJcmV0dXJuIHZtbS0+ZnVuY3MtPnZlcmlmeV9hY2Nlc3MoYm8sIGZpbHApOworfQor
CitzdGF0aWMgdm9pZCBib19kcml2ZXJfbW92ZV9ub3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywKKwkJCQkgIGJvb2wgZXZpY3QsCisJCQkJICBzdHJ1Y3QgdHRtX21lbV9yZWcgKm5l
d19tZW0pCit7CisJc3RydWN0IGRybV92cmFtX21tICp2bW0gPSBkcm1fdnJhbV9tbV9vZl9iZGV2
KGJvLT5iZGV2KTsKKworCWlmICghdm1tLT5mdW5jcyB8fCAhdm1tLT5mdW5jcy0+bW92ZV9ub3Rp
ZnkpCisJCXJldHVybjsKKwl2bW0tPmZ1bmNzLT5tb3ZlX25vdGlmeShibywgZXZpY3QsIG5ld19t
ZW0pOworfQorCitzdGF0aWMgaW50IGJvX2RyaXZlcl9pb19tZW1fcmVzZXJ2ZShzdHJ1Y3QgdHRt
X2JvX2RldmljZSAqYmRldiwKKwkJCQkgICAgc3RydWN0IHR0bV9tZW1fcmVnICptZW0pCit7CisJ
c3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4gPSBiZGV2LT5tYW4gKyBtZW0tPm1lbV90
eXBlOworCXN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tID0gZHJtX3ZyYW1fbW1fb2ZfYmRldihiZGV2
KTsKKworCWlmICghKG1hbi0+ZmxhZ3MgJiBUVE1fTUVNVFlQRV9GTEFHX01BUFBBQkxFKSkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwltZW0tPmJ1cy5hZGRyID0gTlVMTDsKKwltZW0tPmJ1cy5zaXpl
ID0gbWVtLT5udW1fcGFnZXMgPDwgUEFHRV9TSElGVDsKKworCXN3aXRjaCAobWVtLT5tZW1fdHlw
ZSkgeworCWNhc2UgVFRNX1BMX1NZU1RFTToJLyogbm90aGluZyB0byBkbyAqLworCQltZW0tPmJ1
cy5vZmZzZXQgPSAwOworCQltZW0tPmJ1cy5iYXNlID0gMDsKKwkJbWVtLT5idXMuaXNfaW9tZW0g
PSBmYWxzZTsKKwkJYnJlYWs7CisJY2FzZSBUVE1fUExfVlJBTToKKwkJbWVtLT5idXMub2Zmc2V0
ID0gbWVtLT5zdGFydCA8PCBQQUdFX1NISUZUOworCQltZW0tPmJ1cy5iYXNlID0gdm1tLT52cmFt
X2Jhc2U7CisJCW1lbS0+YnVzLmlzX2lvbWVtID0gdHJ1ZTsKKwkJYnJlYWs7CisJZGVmYXVsdDoK
KwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGJv
X2RyaXZlcl9pb19tZW1fZnJlZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKKwkJCQkgIHN0
cnVjdCB0dG1fbWVtX3JlZyAqbWVtKQoreyB9CisKK3N0YXRpYyBzdHJ1Y3QgdHRtX2JvX2RyaXZl
ciBib19kcml2ZXIgPSB7CisJLnR0bV90dF9jcmVhdGUgPSBib19kcml2ZXJfdHRtX3R0X2NyZWF0
ZSwKKwkudHRtX3R0X3BvcHVsYXRlID0gdHRtX3Bvb2xfcG9wdWxhdGUsCisJLnR0bV90dF91bnBv
cHVsYXRlID0gdHRtX3Bvb2xfdW5wb3B1bGF0ZSwKKwkuaW5pdF9tZW1fdHlwZSA9IGJvX2RyaXZl
cl9pbml0X21lbV90eXBlLAorCS5ldmljdGlvbl92YWx1YWJsZSA9IHR0bV9ib19ldmljdGlvbl92
YWx1YWJsZSwKKwkuZXZpY3RfZmxhZ3MgPSBib19kcml2ZXJfZXZpY3RfZmxhZ3MsCisJLnZlcmlm
eV9hY2Nlc3MgPSBib19kcml2ZXJfdmVyaWZ5X2FjY2VzcywKKwkubW92ZV9ub3RpZnkgPSBib19k
cml2ZXJfbW92ZV9ub3RpZnksCisJLmlvX21lbV9yZXNlcnZlID0gYm9fZHJpdmVyX2lvX21lbV9y
ZXNlcnZlLAorCS5pb19tZW1fZnJlZSA9IGJvX2RyaXZlcl9pb19tZW1fZnJlZSwKK307CisKKy8q
CisgKiBzdHJ1Y3QgZHJtX3ZyYW1fbW0KKyAqLworCisvKioKKyAqIGRybV92cmFtX21tX2luaXQo
KSAtIEluaXRpYWxpemUgYW4gaW5zdGFuY2Ugb2YgVlJBTSBNTS4KKyAqIEB2bW06CXRoZSBWUkFN
IE1NIGluc3RhbmNlIHRvIGluaXRpYWxpemUKKyAqIEBkZXY6CXRoZSBEUk0gZGV2aWNlCisgKiBA
dnJhbV9iYXNlOgl0aGUgYmFzZSBhZGRyZXNzIG9mIHRoZSB2aWRlbyBtZW1vcnkKKyAqIEB2cmFt
X3NpemU6CXRoZSBzaXplIG9mIHRoZSB2aWRlbyBtZW1vcnkgaW4gYnl0ZXMKKyAqIEBmdW5jczoJ
Y2FsbGJhY2sgZnVuY3Rpb25zIGZvciBidWZmZXIgb2JqZWN0cworICoKKyAqIFJldHVybnM6Cisg
KiAwIG9uIHN1Y2Nlc3MsIG9yCisgKiBhIG5lZ2F0aXZlIGVycm9yIGNvZGUgb3RoZXJ3aXNlLgor
ICovCitpbnQgZHJtX3ZyYW1fbW1faW5pdChzdHJ1Y3QgZHJtX3ZyYW1fbW0gKnZtbSwgc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKKwkJICAgICB1aW50NjRfdCB2cmFtX2Jhc2UsIHNpemVfdCB2cmFt
X3NpemUsCisJCSAgICAgY29uc3Qgc3RydWN0IGRybV92cmFtX21tX2Z1bmNzICpmdW5jcykKK3sK
KwlpbnQgcmV0OworCisJdm1tLT52cmFtX2Jhc2UgPSB2cmFtX2Jhc2U7CisJdm1tLT52cmFtX3Np
emUgPSB2cmFtX3NpemU7CisJdm1tLT5mdW5jcyA9IGZ1bmNzOworCisJcmV0ID0gdHRtX2JvX2Rl
dmljZV9pbml0KCZ2bW0tPmJkZXYsICZib19kcml2ZXIsCisJCQkJIGRldi0+YW5vbl9pbm9kZS0+
aV9tYXBwaW5nLAorCQkJCSB0cnVlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0
ID0gdHRtX2JvX2luaXRfbW0oJnZtbS0+YmRldiwgVFRNX1BMX1ZSQU0sIHZyYW1fc2l6ZSA+PiBQ
QUdFX1NISUZUKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0dXJuIDA7Cit9CitF
WFBPUlRfU1lNQk9MKGRybV92cmFtX21tX2luaXQpOworCisvKioKKyAqIGRybV92cmFtX21tX2Ns
ZWFudXAoKSAtIENsZWFucyB1cCBhbiBpbml0aWFsaXplZCBpbnN0YW5jZSBvZiBWUkFNIE1NLgor
ICogQHZtbToJdGhlIFZSQU0gTU0gaW5zdGFuY2UgdG8gY2xlYW4gdXAKKyAqLwordm9pZCBkcm1f
dnJhbV9tbV9jbGVhbnVwKHN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tKQoreworCXR0bV9ib19kZXZp
Y2VfcmVsZWFzZSgmdm1tLT5iZGV2KTsKK30KK0VYUE9SVF9TWU1CT0woZHJtX3ZyYW1fbW1fY2xl
YW51cCk7CisKKy8qKgorICogZHJtX3ZyYW1fbW1fbW1hcCgpIC0gSGVscGVyIGZvciBpbXBsZW1l
bnRpbmcgJnN0cnVjdCBmaWxlX29wZXJhdGlvbnMubW1hcCgpCisgKiBAZmlscDoJdGhlIG1hcHBp
bmcncyBmaWxlIHN0cnVjdHVyZQorICogQHZtYToJdGhlIG1hcHBpbmcncyBtZW1vcnkgYXJlYQor
ICogQHZtbToJdGhlIFZSQU0gTU0gaW5zdGFuY2UKKyAqCisgKiBSZXR1cm5zOgorICogMCBvbiBz
dWNjZXNzLCBvcgorICogYSBuZWdhdGl2ZSBlcnJvciBjb2RlIG90aGVyd2lzZS4KKyAqLworaW50
IGRybV92cmFtX21tX21tYXAoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCB2bV9hcmVhX3N0cnVj
dCAqdm1hLAorCQkgICAgIHN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tKQoreworCXJldHVybiB0dG1f
Ym9fbW1hcChmaWxwLCB2bWEsICZ2bW0tPmJkZXYpOworfQorRVhQT1JUX1NZTUJPTChkcm1fdnJh
bV9tbV9tbWFwKTsKKworLyoKKyAqIEhlbHBlcnMgZm9yIGludGVncmF0aW9uIHdpdGggc3RydWN0
IGRybV9kZXZpY2UKKyAqLworCisvKioKKyAqIGRybV92cmFtX2hlbHBlcl9hbGxvY19tbSAtIEFs
bG9jYXRlcyBhIGRldmljZSdzIGluc3RhbmNlIG9mIFwKKwkmc3RydWN0IGRybV92cmFtX21tCisg
KiBAZGV2Ogl0aGUgRFJNIGRldmljZQorICogQHZyYW1fYmFzZToJdGhlIGJhc2UgYWRkcmVzcyBv
ZiB0aGUgdmlkZW8gbWVtb3J5CisgKiBAdnJhbV9zaXplOgl0aGUgc2l6ZSBvZiB0aGUgdmlkZW8g
bWVtb3J5IGluIGJ5dGVzCisgKiBAZnVuY3M6CWNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgYnVmZmVy
IG9iamVjdHMKKyAqCisgKiBSZXR1cm5zOgorICogVGhlIG5ldyBpbnN0YW5jZSBvZiAmc3RydWN0
IGRybV92cmFtX21tIG9uIHN1Y2Nlc3MsIG9yCisgKiBhbiBFUlJfUFRSKCktZW5jb2RlZCBlcnJu
byBjb2RlIG90aGVyd2lzZS4KKyAqLworc3RydWN0IGRybV92cmFtX21tICpkcm1fdnJhbV9oZWxw
ZXJfYWxsb2NfbW0oCisJc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdWludDY0X3QgdnJhbV9iYXNl
LCBzaXplX3QgdnJhbV9zaXplLAorCWNvbnN0IHN0cnVjdCBkcm1fdnJhbV9tbV9mdW5jcyAqZnVu
Y3MpCit7CisJaW50IHJldDsKKworCWlmIChXQVJOX09OKGRldi0+dnJhbV9tbSkpCisJCXJldHVy
biBkZXYtPnZyYW1fbW07CisKKwlkZXYtPnZyYW1fbW0gPSBremFsbG9jKHNpemVvZigqZGV2LT52
cmFtX21tKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkZXYtPnZyYW1fbW0pCisJCXJldHVybiBFUlJf
UFRSKC1FTk9NRU0pOworCisJcmV0ID0gZHJtX3ZyYW1fbW1faW5pdChkZXYtPnZyYW1fbW0sIGRl
diwgdnJhbV9iYXNlLCB2cmFtX3NpemUsIGZ1bmNzKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9r
ZnJlZTsKKworCXJldHVybiBkZXYtPnZyYW1fbW07CisKK2Vycl9rZnJlZToKKwlrZnJlZShkZXYt
PnZyYW1fbW0pOworCWRldi0+dnJhbV9tbSA9IE5VTEw7CisJcmV0dXJuIEVSUl9QVFIocmV0KTsK
K30KK0VYUE9SVF9TWU1CT0woZHJtX3ZyYW1faGVscGVyX2FsbG9jX21tKTsKKworLyoqCisgKiBk
cm1fdnJhbV9oZWxwZXJfcmVsZWFzZV9tbSAtIFJlbGVhc2VzIGEgZGV2aWNlJ3MgaW5zdGFuY2Ug
b2YgXAorCSZzdHJ1Y3QgZHJtX3ZyYW1fbW0KKyAqIEBkZXY6CXRoZSBEUk0gZGV2aWNlCisgKi8K
K3ZvaWQgZHJtX3ZyYW1faGVscGVyX3JlbGVhc2VfbW0oc3RydWN0IGRybV9kZXZpY2UgKmRldikK
K3sKKwlpZiAoIWRldi0+dnJhbV9tbSkKKwkJcmV0dXJuOworCisJZHJtX3ZyYW1fbW1fY2xlYW51
cChkZXYtPnZyYW1fbW0pOworCWtmcmVlKGRldi0+dnJhbV9tbSk7CisJZGV2LT52cmFtX21tID0g
TlVMTDsKK30KK0VYUE9SVF9TWU1CT0woZHJtX3ZyYW1faGVscGVyX3JlbGVhc2VfbW0pOworCisv
KgorICogSGVscGVycyBmb3IgJnN0cnVjdCBmaWxlX29wZXJhdGlvbnMKKyAqLworCisvKioKKyAq
IGRybV92cmFtX21tX2ZpbGVfb3BlcmF0aW9uc19tbWFwKCkgLSBcCisJSW1wbGVtZW50cyAmc3Ry
dWN0IGZpbGVfb3BlcmF0aW9ucy5tbWFwKCkKKyAqIEBmaWxwOgl0aGUgbWFwcGluZydzIGZpbGUg
c3RydWN0dXJlCisgKiBAdm1hOgl0aGUgbWFwcGluZydzIG1lbW9yeSBhcmVhCisgKgorICogUmV0
dXJuczoKKyAqIDAgb24gc3VjY2Vzcywgb3IKKyAqIGEgbmVnYXRpdmUgZXJyb3IgY29kZSBvdGhl
cndpc2UuCisgKi8KK2ludCBkcm1fdnJhbV9tbV9maWxlX29wZXJhdGlvbnNfbW1hcCgKKwlzdHJ1
Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCit7CisJc3RydWN0IGRy
bV9maWxlICpmaWxlX3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7CisJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IGZpbGVfcHJpdi0+bWlub3ItPmRldjsKKworCWlmIChXQVJOX09OQ0UoIWRldi0+
dnJhbV9tbSwgIlZSQU0gTU0gbm90IGluaXRpYWxpemVkIikpCisJCXJldHVybiAtRUlOVkFMOwor
CisJcmV0dXJuIGRybV92cmFtX21tX21tYXAoZmlscCwgdm1hLCBkZXYtPnZyYW1fbW0pOworfQor
RVhQT1JUX1NZTUJPTChkcm1fdnJhbV9tbV9maWxlX29wZXJhdGlvbnNfbW1hcCk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX3ZyYW1fbW1faGVscGVyLmMgYi9kcml2ZXJzL2dwdS9k
cm0vZHJtX3ZyYW1fbW1faGVscGVyLmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDMx
OTg0NjkwZDVmMy4uMDAwMDAwMDAwMDAwCi0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fdnJhbV9t
bV9oZWxwZXIuYworKysgL2Rldi9udWxsCkBAIC0xLDMwOSArMCwwIEBACi0vLyBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogR1BMLTIuMC1vci1sYXRlcgotCi0jaW5jbHVkZSA8ZHJtL2RybV9kZXZp
Y2UuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX2ZpbGUuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3ZyYW1f
bW1faGVscGVyLmg+Ci0KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wYWdlX2FsbG9jLmg+Ci0KLS8q
KgotICogRE9DOiBvdmVydmlldwotICoKLSAqIFRoZSBkYXRhIHN0cnVjdHVyZSAmc3RydWN0IGRy
bV92cmFtX21tIGFuZCBpdHMgaGVscGVycyBpbXBsZW1lbnQgYSBtZW1vcnkKLSAqIG1hbmFnZXIg
Zm9yIHNpbXBsZSBmcmFtZWJ1ZmZlciBkZXZpY2VzIHdpdGggZGVkaWNhdGVkIHZpZGVvIG1lbW9y
eS4gQnVmZmVyCi0gKiBvYmplY3RzIGFyZSBlaXRoZXIgcGxhY2VkIGluIHZpZGVvIFJBTSBvciBl
dmljdGVkIHRvIHN5c3RlbSBtZW1vcnkuIFRoZXNlCi0gKiBoZWxwZXIgZnVuY3Rpb25zIHdvcmsg
d2VsbCB3aXRoICZzdHJ1Y3QgZHJtX2dlbV92cmFtX29iamVjdC4KLSAqLwotCi0vKgotICogVFRN
IFRUCi0gKi8KLQotc3RhdGljIHZvaWQgYmFja2VuZF9mdW5jX2Rlc3Ryb3koc3RydWN0IHR0bV90
dCAqdHQpCi17Ci0JdHRtX3R0X2ZpbmkodHQpOwotCWtmcmVlKHR0KTsKLX0KLQotc3RhdGljIHN0
cnVjdCB0dG1fYmFja2VuZF9mdW5jIGJhY2tlbmRfZnVuYyA9IHsKLQkuZGVzdHJveSA9IGJhY2tl
bmRfZnVuY19kZXN0cm95Ci19OwotCi0vKgotICogVFRNIEJPIGRldmljZQotICovCi0KLXN0YXRp
YyBzdHJ1Y3QgdHRtX3R0ICpib19kcml2ZXJfdHRtX3R0X2NyZWF0ZShzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QgKmJvLAotCQkJCQkgICAgICB1aW50MzJfdCBwYWdlX2ZsYWdzKQotewotCXN0cnVj
dCB0dG1fdHQgKnR0OwotCWludCByZXQ7Ci0KLQl0dCA9IGt6YWxsb2Moc2l6ZW9mKCp0dCksIEdG
UF9LRVJORUwpOwotCWlmICghdHQpCi0JCXJldHVybiBOVUxMOwotCi0JdHQtPmZ1bmMgPSAmYmFj
a2VuZF9mdW5jOwotCi0JcmV0ID0gdHRtX3R0X2luaXQodHQsIGJvLCBwYWdlX2ZsYWdzKTsKLQlp
ZiAocmV0IDwgMCkKLQkJZ290byBlcnJfdHRtX3R0X2luaXQ7Ci0KLQlyZXR1cm4gdHQ7Ci0KLWVy
cl90dG1fdHRfaW5pdDoKLQlrZnJlZSh0dCk7Ci0JcmV0dXJuIE5VTEw7Ci19Ci0KLXN0YXRpYyBp
bnQgYm9fZHJpdmVyX2luaXRfbWVtX3R5cGUoc3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYsIHVp
bnQzMl90IHR5cGUsCi0JCQkJICAgc3RydWN0IHR0bV9tZW1fdHlwZV9tYW5hZ2VyICptYW4pCi17
Ci0Jc3dpdGNoICh0eXBlKSB7Ci0JY2FzZSBUVE1fUExfU1lTVEVNOgotCQltYW4tPmZsYWdzID0g
VFRNX01FTVRZUEVfRkxBR19NQVBQQUJMRTsKLQkJbWFuLT5hdmFpbGFibGVfY2FjaGluZyA9IFRU
TV9QTF9NQVNLX0NBQ0hJTkc7Ci0JCW1hbi0+ZGVmYXVsdF9jYWNoaW5nID0gVFRNX1BMX0ZMQUdf
Q0FDSEVEOwotCQlicmVhazsKLQljYXNlIFRUTV9QTF9WUkFNOgotCQltYW4tPmZ1bmMgPSAmdHRt
X2JvX21hbmFnZXJfZnVuYzsKLQkJbWFuLT5mbGFncyA9IFRUTV9NRU1UWVBFX0ZMQUdfRklYRUQg
fAotCQkJICAgICBUVE1fTUVNVFlQRV9GTEFHX01BUFBBQkxFOwotCQltYW4tPmF2YWlsYWJsZV9j
YWNoaW5nID0gVFRNX1BMX0ZMQUdfVU5DQUNIRUQgfAotCQkJCQkgVFRNX1BMX0ZMQUdfV0M7Ci0J
CW1hbi0+ZGVmYXVsdF9jYWNoaW5nID0gVFRNX1BMX0ZMQUdfV0M7Ci0JCWJyZWFrOwotCWRlZmF1
bHQ6Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQg
Ym9fZHJpdmVyX2V2aWN0X2ZsYWdzKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCi0JCQkJ
ICBzdHJ1Y3QgdHRtX3BsYWNlbWVudCAqcGxhY2VtZW50KQotewotCXN0cnVjdCBkcm1fdnJhbV9t
bSAqdm1tID0gZHJtX3ZyYW1fbW1fb2ZfYmRldihiby0+YmRldik7Ci0KLQlpZiAodm1tLT5mdW5j
cyAmJiB2bW0tPmZ1bmNzLT5ldmljdF9mbGFncykKLQkJdm1tLT5mdW5jcy0+ZXZpY3RfZmxhZ3Mo
Ym8sIHBsYWNlbWVudCk7Ci19Ci0KLXN0YXRpYyBpbnQgYm9fZHJpdmVyX3ZlcmlmeV9hY2Nlc3Mo
c3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKLQkJCQkgICBzdHJ1Y3QgZmlsZSAqZmlscCkK
LXsKLQlzdHJ1Y3QgZHJtX3ZyYW1fbW0gKnZtbSA9IGRybV92cmFtX21tX29mX2JkZXYoYm8tPmJk
ZXYpOwotCi0JaWYgKCF2bW0tPmZ1bmNzIHx8ICF2bW0tPmZ1bmNzLT52ZXJpZnlfYWNjZXNzKQot
CQlyZXR1cm4gMDsKLQlyZXR1cm4gdm1tLT5mdW5jcy0+dmVyaWZ5X2FjY2VzcyhibywgZmlscCk7
Ci19Ci0KLXN0YXRpYyB2b2lkIGJvX2RyaXZlcl9tb3ZlX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZl
cl9vYmplY3QgKmJvLAotCQkJCSAgYm9vbCBldmljdCwKLQkJCQkgIHN0cnVjdCB0dG1fbWVtX3Jl
ZyAqbmV3X21lbSkKLXsKLQlzdHJ1Y3QgZHJtX3ZyYW1fbW0gKnZtbSA9IGRybV92cmFtX21tX29m
X2JkZXYoYm8tPmJkZXYpOwotCi0JaWYgKCF2bW0tPmZ1bmNzIHx8ICF2bW0tPmZ1bmNzLT5tb3Zl
X25vdGlmeSkKLQkJcmV0dXJuOwotCXZtbS0+ZnVuY3MtPm1vdmVfbm90aWZ5KGJvLCBldmljdCwg
bmV3X21lbSk7Ci19Ci0KLXN0YXRpYyBpbnQgYm9fZHJpdmVyX2lvX21lbV9yZXNlcnZlKHN0cnVj
dCB0dG1fYm9fZGV2aWNlICpiZGV2LAotCQkJCSAgICBzdHJ1Y3QgdHRtX21lbV9yZWcgKm1lbSkK
LXsKLQlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9IGJkZXYtPm1hbiArIG1lbS0+
bWVtX3R5cGU7Ci0Jc3RydWN0IGRybV92cmFtX21tICp2bW0gPSBkcm1fdnJhbV9tbV9vZl9iZGV2
KGJkZXYpOwotCi0JaWYgKCEobWFuLT5mbGFncyAmIFRUTV9NRU1UWVBFX0ZMQUdfTUFQUEFCTEUp
KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCW1lbS0+YnVzLmFkZHIgPSBOVUxMOwotCW1lbS0+YnVz
LnNpemUgPSBtZW0tPm51bV9wYWdlcyA8PCBQQUdFX1NISUZUOwotCi0Jc3dpdGNoIChtZW0tPm1l
bV90eXBlKSB7Ci0JY2FzZSBUVE1fUExfU1lTVEVNOgkvKiBub3RoaW5nIHRvIGRvICovCi0JCW1l
bS0+YnVzLm9mZnNldCA9IDA7Ci0JCW1lbS0+YnVzLmJhc2UgPSAwOwotCQltZW0tPmJ1cy5pc19p
b21lbSA9IGZhbHNlOwotCQlicmVhazsKLQljYXNlIFRUTV9QTF9WUkFNOgotCQltZW0tPmJ1cy5v
ZmZzZXQgPSBtZW0tPnN0YXJ0IDw8IFBBR0VfU0hJRlQ7Ci0JCW1lbS0+YnVzLmJhc2UgPSB2bW0t
PnZyYW1fYmFzZTsKLQkJbWVtLT5idXMuaXNfaW9tZW0gPSB0cnVlOwotCQlicmVhazsKLQlkZWZh
dWx0OgotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZv
aWQgYm9fZHJpdmVyX2lvX21lbV9mcmVlKHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LAotCQkJ
CSAgc3RydWN0IHR0bV9tZW1fcmVnICptZW0pCi17IH0KLQotc3RhdGljIHN0cnVjdCB0dG1fYm9f
ZHJpdmVyIGJvX2RyaXZlciA9IHsKLQkudHRtX3R0X2NyZWF0ZSA9IGJvX2RyaXZlcl90dG1fdHRf
Y3JlYXRlLAotCS50dG1fdHRfcG9wdWxhdGUgPSB0dG1fcG9vbF9wb3B1bGF0ZSwKLQkudHRtX3R0
X3VucG9wdWxhdGUgPSB0dG1fcG9vbF91bnBvcHVsYXRlLAotCS5pbml0X21lbV90eXBlID0gYm9f
ZHJpdmVyX2luaXRfbWVtX3R5cGUsCi0JLmV2aWN0aW9uX3ZhbHVhYmxlID0gdHRtX2JvX2V2aWN0
aW9uX3ZhbHVhYmxlLAotCS5ldmljdF9mbGFncyA9IGJvX2RyaXZlcl9ldmljdF9mbGFncywKLQku
dmVyaWZ5X2FjY2VzcyA9IGJvX2RyaXZlcl92ZXJpZnlfYWNjZXNzLAotCS5tb3ZlX25vdGlmeSA9
IGJvX2RyaXZlcl9tb3ZlX25vdGlmeSwKLQkuaW9fbWVtX3Jlc2VydmUgPSBib19kcml2ZXJfaW9f
bWVtX3Jlc2VydmUsCi0JLmlvX21lbV9mcmVlID0gYm9fZHJpdmVyX2lvX21lbV9mcmVlLAotfTsK
LQotLyoKLSAqIHN0cnVjdCBkcm1fdnJhbV9tbQotICovCi0KLS8qKgotICogZHJtX3ZyYW1fbW1f
aW5pdCgpIC0gSW5pdGlhbGl6ZSBhbiBpbnN0YW5jZSBvZiBWUkFNIE1NLgotICogQHZtbToJdGhl
IFZSQU0gTU0gaW5zdGFuY2UgdG8gaW5pdGlhbGl6ZQotICogQGRldjoJdGhlIERSTSBkZXZpY2UK
LSAqIEB2cmFtX2Jhc2U6CXRoZSBiYXNlIGFkZHJlc3Mgb2YgdGhlIHZpZGVvIG1lbW9yeQotICog
QHZyYW1fc2l6ZToJdGhlIHNpemUgb2YgdGhlIHZpZGVvIG1lbW9yeSBpbiBieXRlcwotICogQGZ1
bmNzOgljYWxsYmFjayBmdW5jdGlvbnMgZm9yIGJ1ZmZlciBvYmplY3RzCi0gKgotICogUmV0dXJu
czoKLSAqIDAgb24gc3VjY2Vzcywgb3IKLSAqIGEgbmVnYXRpdmUgZXJyb3IgY29kZSBvdGhlcndp
c2UuCi0gKi8KLWludCBkcm1fdnJhbV9tbV9pbml0KHN0cnVjdCBkcm1fdnJhbV9tbSAqdm1tLCBz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAotCQkgICAgIHVpbnQ2NF90IHZyYW1fYmFzZSwgc2l6ZV90
IHZyYW1fc2l6ZSwKLQkJICAgICBjb25zdCBzdHJ1Y3QgZHJtX3ZyYW1fbW1fZnVuY3MgKmZ1bmNz
KQotewotCWludCByZXQ7Ci0KLQl2bW0tPnZyYW1fYmFzZSA9IHZyYW1fYmFzZTsKLQl2bW0tPnZy
YW1fc2l6ZSA9IHZyYW1fc2l6ZTsKLQl2bW0tPmZ1bmNzID0gZnVuY3M7Ci0KLQlyZXQgPSB0dG1f
Ym9fZGV2aWNlX2luaXQoJnZtbS0+YmRldiwgJmJvX2RyaXZlciwKLQkJCQkgZGV2LT5hbm9uX2lu
b2RlLT5pX21hcHBpbmcsCi0JCQkJIHRydWUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0K
LQlyZXQgPSB0dG1fYm9faW5pdF9tbSgmdm1tLT5iZGV2LCBUVE1fUExfVlJBTSwgdnJhbV9zaXpl
ID4+IFBBR0VfU0hJRlQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXR1cm4gMDsK
LX0KLUVYUE9SVF9TWU1CT0woZHJtX3ZyYW1fbW1faW5pdCk7Ci0KLS8qKgotICogZHJtX3ZyYW1f
bW1fY2xlYW51cCgpIC0gQ2xlYW5zIHVwIGFuIGluaXRpYWxpemVkIGluc3RhbmNlIG9mIFZSQU0g
TU0uCi0gKiBAdm1tOgl0aGUgVlJBTSBNTSBpbnN0YW5jZSB0byBjbGVhbiB1cAotICovCi12b2lk
IGRybV92cmFtX21tX2NsZWFudXAoc3RydWN0IGRybV92cmFtX21tICp2bW0pCi17Ci0JdHRtX2Jv
X2RldmljZV9yZWxlYXNlKCZ2bW0tPmJkZXYpOwotfQotRVhQT1JUX1NZTUJPTChkcm1fdnJhbV9t
bV9jbGVhbnVwKTsKLQotLyoqCi0gKiBkcm1fdnJhbV9tbV9tbWFwKCkgLSBIZWxwZXIgZm9yIGlt
cGxlbWVudGluZyAmc3RydWN0IGZpbGVfb3BlcmF0aW9ucy5tbWFwKCkKLSAqIEBmaWxwOgl0aGUg
bWFwcGluZydzIGZpbGUgc3RydWN0dXJlCi0gKiBAdm1hOgl0aGUgbWFwcGluZydzIG1lbW9yeSBh
cmVhCi0gKiBAdm1tOgl0aGUgVlJBTSBNTSBpbnN0YW5jZQotICoKLSAqIFJldHVybnM6Ci0gKiAw
IG9uIHN1Y2Nlc3MsIG9yCi0gKiBhIG5lZ2F0aXZlIGVycm9yIGNvZGUgb3RoZXJ3aXNlLgotICov
Ci1pbnQgZHJtX3ZyYW1fbW1fbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2FyZWFf
c3RydWN0ICp2bWEsCi0JCSAgICAgc3RydWN0IGRybV92cmFtX21tICp2bW0pCi17Ci0JcmV0dXJu
IHR0bV9ib19tbWFwKGZpbHAsIHZtYSwgJnZtbS0+YmRldik7Ci19Ci1FWFBPUlRfU1lNQk9MKGRy
bV92cmFtX21tX21tYXApOwotCi0vKgotICogSGVscGVycyBmb3IgaW50ZWdyYXRpb24gd2l0aCBz
dHJ1Y3QgZHJtX2RldmljZQotICovCi0KLS8qKgotICogZHJtX3ZyYW1faGVscGVyX2FsbG9jX21t
IC0gQWxsb2NhdGVzIGEgZGV2aWNlJ3MgaW5zdGFuY2Ugb2YgXAotCSZzdHJ1Y3QgZHJtX3ZyYW1f
bW0KLSAqIEBkZXY6CXRoZSBEUk0gZGV2aWNlCi0gKiBAdnJhbV9iYXNlOgl0aGUgYmFzZSBhZGRy
ZXNzIG9mIHRoZSB2aWRlbyBtZW1vcnkKLSAqIEB2cmFtX3NpemU6CXRoZSBzaXplIG9mIHRoZSB2
aWRlbyBtZW1vcnkgaW4gYnl0ZXMKLSAqIEBmdW5jczoJY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBi
dWZmZXIgb2JqZWN0cwotICoKLSAqIFJldHVybnM6Ci0gKiBUaGUgbmV3IGluc3RhbmNlIG9mICZz
dHJ1Y3QgZHJtX3ZyYW1fbW0gb24gc3VjY2Vzcywgb3IKLSAqIGFuIEVSUl9QVFIoKS1lbmNvZGVk
IGVycm5vIGNvZGUgb3RoZXJ3aXNlLgotICovCi1zdHJ1Y3QgZHJtX3ZyYW1fbW0gKmRybV92cmFt
X2hlbHBlcl9hbGxvY19tbSgKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1aW50NjRfdCB2cmFt
X2Jhc2UsIHNpemVfdCB2cmFtX3NpemUsCi0JY29uc3Qgc3RydWN0IGRybV92cmFtX21tX2Z1bmNz
ICpmdW5jcykKLXsKLQlpbnQgcmV0OwotCi0JaWYgKFdBUk5fT04oZGV2LT52cmFtX21tKSkKLQkJ
cmV0dXJuIGRldi0+dnJhbV9tbTsKLQotCWRldi0+dnJhbV9tbSA9IGt6YWxsb2Moc2l6ZW9mKCpk
ZXYtPnZyYW1fbW0pLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWRldi0+dnJhbV9tbSkKLQkJcmV0dXJu
IEVSUl9QVFIoLUVOT01FTSk7Ci0KLQlyZXQgPSBkcm1fdnJhbV9tbV9pbml0KGRldi0+dnJhbV9t
bSwgZGV2LCB2cmFtX2Jhc2UsIHZyYW1fc2l6ZSwgZnVuY3MpOwotCWlmIChyZXQpCi0JCWdvdG8g
ZXJyX2tmcmVlOwotCi0JcmV0dXJuIGRldi0+dnJhbV9tbTsKLQotZXJyX2tmcmVlOgotCWtmcmVl
KGRldi0+dnJhbV9tbSk7Ci0JZGV2LT52cmFtX21tID0gTlVMTDsKLQlyZXR1cm4gRVJSX1BUUihy
ZXQpOwotfQotRVhQT1JUX1NZTUJPTChkcm1fdnJhbV9oZWxwZXJfYWxsb2NfbW0pOwotCi0vKioK
LSAqIGRybV92cmFtX2hlbHBlcl9yZWxlYXNlX21tIC0gUmVsZWFzZXMgYSBkZXZpY2UncyBpbnN0
YW5jZSBvZiBcCi0JJnN0cnVjdCBkcm1fdnJhbV9tbQotICogQGRldjoJdGhlIERSTSBkZXZpY2UK
LSAqLwotdm9pZCBkcm1fdnJhbV9oZWxwZXJfcmVsZWFzZV9tbShzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2KQotewotCWlmICghZGV2LT52cmFtX21tKQotCQlyZXR1cm47Ci0KLQlkcm1fdnJhbV9tbV9j
bGVhbnVwKGRldi0+dnJhbV9tbSk7Ci0Ja2ZyZWUoZGV2LT52cmFtX21tKTsKLQlkZXYtPnZyYW1f
bW0gPSBOVUxMOwotfQotRVhQT1JUX1NZTUJPTChkcm1fdnJhbV9oZWxwZXJfcmVsZWFzZV9tbSk7
Ci0KLS8qCi0gKiBIZWxwZXJzIGZvciAmc3RydWN0IGZpbGVfb3BlcmF0aW9ucwotICovCi0KLS8q
KgotICogZHJtX3ZyYW1fbW1fZmlsZV9vcGVyYXRpb25zX21tYXAoKSAtIFwKLQlJbXBsZW1lbnRz
ICZzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zLm1tYXAoKQotICogQGZpbHA6CXRoZSBtYXBwaW5nJ3Mg
ZmlsZSBzdHJ1Y3R1cmUKLSAqIEB2bWE6CXRoZSBtYXBwaW5nJ3MgbWVtb3J5IGFyZWEKLSAqCi0g
KiBSZXR1cm5zOgotICogMCBvbiBzdWNjZXNzLCBvcgotICogYSBuZWdhdGl2ZSBlcnJvciBjb2Rl
IG90aGVyd2lzZS4KLSAqLwotaW50IGRybV92cmFtX21tX2ZpbGVfb3BlcmF0aW9uc19tbWFwKAot
CXN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkKLXsKLQlzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZmlsZV9wcml2LT5taW5vci0+ZGV2OwotCi0JaWYgKFdBUk5fT05DRSgh
ZGV2LT52cmFtX21tLCAiVlJBTSBNTSBub3QgaW5pdGlhbGl6ZWQiKSkKLQkJcmV0dXJuIC1FSU5W
QUw7Ci0KLQlyZXR1cm4gZHJtX3ZyYW1fbW1fbW1hcChmaWxwLCB2bWEsIGRldi0+dnJhbV9tbSk7
Ci19Ci1FWFBPUlRfU1lNQk9MKGRybV92cmFtX21tX2ZpbGVfb3BlcmF0aW9uc19tbWFwKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5j
IGIvZHJpdmVycy9ncHUvZHJtL2hpc2lsaWNvbi9oaWJtYy9oaWJtY19kcm1fZHJ2LmMKaW5kZXgg
YzEwMzAwNWIwYTMzLi40ZjUyYzgzYjliNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9o
aXNpbGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNp
bGljb24vaGlibWMvaGlibWNfZHJtX2Rydi5jCkBAIC0yMiw3ICsyMiw2IEBACiAjaW5jbHVkZSA8
ZHJtL2RybV9wcmludC5oPgogI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+CiAjaW5j
bHVkZSA8ZHJtL2RybV92YmxhbmsuaD4KLSNpbmNsdWRlIDxkcm0vZHJtX3ZyYW1fbW1faGVscGVy
Lmg+CiAKICNpbmNsdWRlICJoaWJtY19kcm1fZHJ2LmgiCiAjaW5jbHVkZSAiaGlibWNfZHJtX3Jl
Z3MuaCIKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGljb24vaGlibWMvaGlibWNf
dHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jCmluZGV4
IDlmNmU0NzNlNjI5NS4uNWQ1MmNkNzQ4NjAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aGlzaWxpY29uL2hpYm1jL2hpYm1jX3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9oaXNpbGlj
b24vaGlibWMvaGlibWNfdHRtLmMKQEAgLTE3LDcgKzE3LDYgQEAKICNpbmNsdWRlIDxkcm0vZHJt
X2dlbS5oPgogI2luY2x1ZGUgPGRybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmg+CiAjaW5jbHVkZSA8
ZHJtL2RybV9wcmludC5oPgotI2luY2x1ZGUgPGRybS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4KIAog
I2luY2x1ZGUgImhpYm1jX2RybV9kcnYuaCIKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L21nYWcyMDAvbWdhZzIwMF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBf
ZHJ2LmgKaW5kZXggMWM5M2Y4ZGMwOGM3Li4zN2MwMDNlZDU3YzAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9tZ2FnMjAwL21nYWcyMDBfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL21n
YWcyMDAvbWdhZzIwMF9kcnYuaApAQCAtMTksNyArMTksNiBAQAogI2luY2x1ZGUgPGRybS9kcm1f
ZmJfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KICNpbmNsdWRlIDxkcm0vZHJt
X2dlbV92cmFtX2hlbHBlci5oPgotI2luY2x1ZGUgPGRybS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4K
IAogI2luY2x1ZGUgIm1nYWcyMDBfcmVnLmgiCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS92Ym94dmlkZW8vdmJveF9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS92Ym94dmlkZW8vdmJveF9k
cnYuaAppbmRleCBlOGNiOWVmYzYwODguLmZiNDM2ZWM3NjBlYSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL3Zib3h2aWRlby92Ym94X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92Ym94
dmlkZW8vdmJveF9kcnYuaApAQCAtMjAsOCArMjAsNiBAQAogI2luY2x1ZGUgPGRybS9kcm1fZ2Vt
Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuaD4KIAotI2luY2x1ZGUgPGRy
bS9kcm1fdnJhbV9tbV9oZWxwZXIuaD4KLQogI2luY2x1ZGUgInZib3h2aWRlb19ndWVzdC5oIgog
I2luY2x1ZGUgInZib3h2aWRlb192YmUuaCIKICNpbmNsdWRlICJoZ3NtaV9jaF9zZXR1cC5oIgpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oIGIvaW5jbHVkZS9k
cm0vZHJtX2dlbV92cmFtX2hlbHBlci5oCmluZGV4IGI0N2M0NjUxNjQ2Ni4uYWY3NDUwODUxYzA5
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fZ2VtX3ZyYW1faGVscGVyLmgKKysrIGIvaW5j
bHVkZS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5oCkBAIC0zLDkgKzMsMTMgQEAKICNpZm5kZWYg
RFJNX0dFTV9WUkFNX0hFTFBFUl9ICiAjZGVmaW5lIERSTV9HRU1fVlJBTV9IRUxQRVJfSAogCisj
aW5jbHVkZSA8ZHJtL2RybV9maWxlLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX2lvY3RsLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fYXBpLmg+Cisj
aW5jbHVkZSA8ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1f
cGxhY2VtZW50Lmg+CisKICNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4gLyogZm9yIGNvbnRhaW5l
cl9vZigpICovCiAKIHN0cnVjdCBkcm1fbW9kZV9jcmVhdGVfZHVtYjsKQEAgLTE0NCw0ICsxNDgs
ODUgQEAgaW50IGRybV9nZW1fdnJhbV9kcml2ZXJfZHVtYl9tbWFwX29mZnNldChzdHJ1Y3QgZHJt
X2ZpbGUgKmZpbGUsCiAJLmR1bWJfbWFwX29mZnNldAkgID0gZHJtX2dlbV92cmFtX2RyaXZlcl9k
dW1iX21tYXBfb2Zmc2V0LCBcCiAJLmdlbV9wcmltZV9tbWFwCQkgID0gZHJtX2dlbV9wcmltZV9t
bWFwCiAKKy8qCisgKiAgVlJBTSBtZW1vcnkgbWFuYWdlcgorICovCisKKy8qKgorICogc3RydWN0
IGRybV92cmFtX21tIC0gQW4gaW5zdGFuY2Ugb2YgVlJBTSBNTQorICogQHZyYW1fYmFzZToJQmFz
ZSBhZGRyZXNzIG9mIHRoZSBtYW5hZ2VkIHZpZGVvIG1lbW9yeQorICogQHZyYW1fc2l6ZToJU2l6
ZSBvZiB0aGUgbWFuYWdlZCB2aWRlbyBtZW1vcnkgaW4gYnl0ZXMKKyAqIEBiZGV2OglUaGUgVFRN
IEJPIGRldmljZS4KKyAqIEBmdW5jczoJVFRNIEJPIGZ1bmN0aW9ucworICoKKyAqIFRoZSBmaWVs
ZHMgJnN0cnVjdCBkcm1fdnJhbV9tbS52cmFtX2Jhc2UgYW5kCisgKiAmc3RydWN0IGRybV92cmFt
X21tLnZybV9zaXplIGFyZSBtYW5hZ2VkIGJ5IFZSQU0gTU0sIGJ1dCBhcmUKKyAqIGF2YWlsYWJs
ZSBmb3IgcHVibGljIHJlYWQgYWNjZXNzLiBVc2UgdGhlIGZpZWxkCisgKiAmc3RydWN0IGRybV92
cmFtX21tLmJkZXYgdG8gYWNjZXNzIHRoZSBUVE0gQk8gZGV2aWNlLgorICovCitzdHJ1Y3QgZHJt
X3ZyYW1fbW0geworCXVpbnQ2NF90IHZyYW1fYmFzZTsKKwlzaXplX3QgdnJhbV9zaXplOworCisJ
c3RydWN0IHR0bV9ib19kZXZpY2UgYmRldjsKKworCWNvbnN0IHN0cnVjdCBkcm1fdnJhbV9tbV9m
dW5jcyAqZnVuY3M7Cit9OworCisvKioKKyAqIGRybV92cmFtX21tX29mX2JkZXYoKSAtIFwKKwlS
ZXR1cm5zIHRoZSBjb250YWluZXIgb2YgdHlwZSAmc3RydWN0IHR0bV9ib19kZXZpY2UgZm9yIGZp
ZWxkIGJkZXYuCisgKiBAYmRldjoJdGhlIFRUTSBCTyBkZXZpY2UKKyAqCisgKiBSZXR1cm5zOgor
ICogVGhlIGNvbnRhaW5pbmcgaW5zdGFuY2Ugb2YgJnN0cnVjdCBkcm1fdnJhbV9tbQorICovCitz
dGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fdnJhbV9tbSAqZHJtX3ZyYW1fbW1fb2ZfYmRldigKKwlz
dHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldikKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGJkZXYs
IHN0cnVjdCBkcm1fdnJhbV9tbSwgYmRldik7Cit9CisKK2ludCBkcm1fdnJhbV9tbV9pbml0KHN0
cnVjdCBkcm1fdnJhbV9tbSAqdm1tLCBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAorCQkgICAgIHVp
bnQ2NF90IHZyYW1fYmFzZSwgc2l6ZV90IHZyYW1fc2l6ZSwKKwkJICAgICBjb25zdCBzdHJ1Y3Qg
ZHJtX3ZyYW1fbW1fZnVuY3MgKmZ1bmNzKTsKK3ZvaWQgZHJtX3ZyYW1fbW1fY2xlYW51cChzdHJ1
Y3QgZHJtX3ZyYW1fbW0gKnZtbSk7CisKK2ludCBkcm1fdnJhbV9tbV9tbWFwKHN0cnVjdCBmaWxl
ICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwKKwkJICAgICBzdHJ1Y3QgZHJtX3Zy
YW1fbW0gKnZtbSk7CisKKy8qCisgKiBIZWxwZXJzIGZvciBpbnRlZ3JhdGlvbiB3aXRoIHN0cnVj
dCBkcm1fZGV2aWNlCisgKi8KKworc3RydWN0IGRybV92cmFtX21tICpkcm1fdnJhbV9oZWxwZXJf
YWxsb2NfbW0oCisJc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdWludDY0X3QgdnJhbV9iYXNlLCBz
aXplX3QgdnJhbV9zaXplLAorCWNvbnN0IHN0cnVjdCBkcm1fdnJhbV9tbV9mdW5jcyAqZnVuY3Mp
Owordm9pZCBkcm1fdnJhbV9oZWxwZXJfcmVsZWFzZV9tbShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KTsKKworLyoKKyAqIEhlbHBlcnMgZm9yICZzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zCisgKi8KKwor
aW50IGRybV92cmFtX21tX2ZpbGVfb3BlcmF0aW9uc19tbWFwKAorCXN0cnVjdCBmaWxlICpmaWxw
LCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSk7CisKKy8qKgorICogZGVmaW5lIERSTV9WUkFN
X01NX0ZJTEVfT1BFUkFUSU9OUyAtIGRlZmF1bHQgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciBcCisJ
JnN0cnVjdCBmaWxlX29wZXJhdGlvbnMKKyAqCisgKiBEcml2ZXJzIHRoYXQgdXNlIFZSQU0gTU0g
Y2FuIHVzZSB0aGlzIG1hY3JvIHRvIGluaXRpYWxpemUKKyAqICZzdHJ1Y3QgZmlsZV9vcGVyYXRp
b25zIHdpdGggZGVmYXVsdCBmdW5jdGlvbnMuCisgKi8KKyNkZWZpbmUgRFJNX1ZSQU1fTU1fRklM
RV9PUEVSQVRJT05TIFwKKwkubGxzZWVrCQk9IG5vX2xsc2VlaywgXAorCS5yZWFkCQk9IGRybV9y
ZWFkLCBcCisJLnBvbGwJCT0gZHJtX3BvbGwsIFwKKwkudW5sb2NrZWRfaW9jdGwgPSBkcm1faW9j
dGwsIFwKKwkuY29tcGF0X2lvY3RsCT0gZHJtX2NvbXBhdF9pb2N0bCwgXAorCS5tbWFwCQk9IGRy
bV92cmFtX21tX2ZpbGVfb3BlcmF0aW9uc19tbWFwLCBcCisJLm9wZW4JCT0gZHJtX29wZW4sIFwK
KwkucmVsZWFzZQk9IGRybV9yZWxlYXNlIFwKKworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2luY2x1
ZGUvZHJtL2RybV92cmFtX21tX2hlbHBlci5oIGIvaW5jbHVkZS9kcm0vZHJtX3ZyYW1fbW1faGVs
cGVyLmgKaW5kZXggN2ZiODcwMGY0NWZlLi5lM2I3OWUxM2UxMDYgMTAwNjQ0Ci0tLSBhL2luY2x1
ZGUvZHJtL2RybV92cmFtX21tX2hlbHBlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV92cmFtX21t
X2hlbHBlci5oCkBAIC0yOSw4MCArMjksNCBAQCBzdHJ1Y3QgZHJtX3ZyYW1fbW1fZnVuY3Mgewog
CQkJICAgIHN0cnVjdCB0dG1fbWVtX3JlZyAqbmV3X21lbSk7CiB9OwogCi0vKioKLSAqIHN0cnVj
dCBkcm1fdnJhbV9tbSAtIEFuIGluc3RhbmNlIG9mIFZSQU0gTU0KLSAqIEB2cmFtX2Jhc2U6CUJh
c2UgYWRkcmVzcyBvZiB0aGUgbWFuYWdlZCB2aWRlbyBtZW1vcnkKLSAqIEB2cmFtX3NpemU6CVNp
emUgb2YgdGhlIG1hbmFnZWQgdmlkZW8gbWVtb3J5IGluIGJ5dGVzCi0gKiBAYmRldjoJVGhlIFRU
TSBCTyBkZXZpY2UuCi0gKiBAZnVuY3M6CVRUTSBCTyBmdW5jdGlvbnMKLSAqCi0gKiBUaGUgZmll
bGRzICZzdHJ1Y3QgZHJtX3ZyYW1fbW0udnJhbV9iYXNlIGFuZAotICogJnN0cnVjdCBkcm1fdnJh
bV9tbS52cm1fc2l6ZSBhcmUgbWFuYWdlZCBieSBWUkFNIE1NLCBidXQgYXJlCi0gKiBhdmFpbGFi
bGUgZm9yIHB1YmxpYyByZWFkIGFjY2Vzcy4gVXNlIHRoZSBmaWVsZAotICogJnN0cnVjdCBkcm1f
dnJhbV9tbS5iZGV2IHRvIGFjY2VzcyB0aGUgVFRNIEJPIGRldmljZS4KLSAqLwotc3RydWN0IGRy
bV92cmFtX21tIHsKLQl1aW50NjRfdCB2cmFtX2Jhc2U7Ci0Jc2l6ZV90IHZyYW1fc2l6ZTsKLQot
CXN0cnVjdCB0dG1fYm9fZGV2aWNlIGJkZXY7Ci0KLQljb25zdCBzdHJ1Y3QgZHJtX3ZyYW1fbW1f
ZnVuY3MgKmZ1bmNzOwotfTsKLQotLyoqCi0gKiBkcm1fdnJhbV9tbV9vZl9iZGV2KCkgLSBcCi0J
UmV0dXJucyB0aGUgY29udGFpbmVyIG9mIHR5cGUgJnN0cnVjdCB0dG1fYm9fZGV2aWNlIGZvciBm
aWVsZCBiZGV2LgotICogQGJkZXY6CXRoZSBUVE0gQk8gZGV2aWNlCi0gKgotICogUmV0dXJuczoK
LSAqIFRoZSBjb250YWluaW5nIGluc3RhbmNlIG9mICZzdHJ1Y3QgZHJtX3ZyYW1fbW0KLSAqLwot
c3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX3ZyYW1fbW0gKmRybV92cmFtX21tX29mX2JkZXYoCi0J
c3RydWN0IHR0bV9ib19kZXZpY2UgKmJkZXYpCi17Ci0JcmV0dXJuIGNvbnRhaW5lcl9vZihiZGV2
LCBzdHJ1Y3QgZHJtX3ZyYW1fbW0sIGJkZXYpOwotfQotCi1pbnQgZHJtX3ZyYW1fbW1faW5pdChz
dHJ1Y3QgZHJtX3ZyYW1fbW0gKnZtbSwgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICAgICB1
aW50NjRfdCB2cmFtX2Jhc2UsIHNpemVfdCB2cmFtX3NpemUsCi0JCSAgICAgY29uc3Qgc3RydWN0
IGRybV92cmFtX21tX2Z1bmNzICpmdW5jcyk7Ci12b2lkIGRybV92cmFtX21tX2NsZWFudXAoc3Ry
dWN0IGRybV92cmFtX21tICp2bW0pOwotCi1pbnQgZHJtX3ZyYW1fbW1fbW1hcChzdHJ1Y3QgZmls
ZSAqZmlscCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEsCi0JCSAgICAgc3RydWN0IGRybV92
cmFtX21tICp2bW0pOwotCi0vKgotICogSGVscGVycyBmb3IgaW50ZWdyYXRpb24gd2l0aCBzdHJ1
Y3QgZHJtX2RldmljZQotICovCi0KLXN0cnVjdCBkcm1fdnJhbV9tbSAqZHJtX3ZyYW1faGVscGVy
X2FsbG9jX21tKAotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVpbnQ2NF90IHZyYW1fYmFzZSwg
c2l6ZV90IHZyYW1fc2l6ZSwKLQljb25zdCBzdHJ1Y3QgZHJtX3ZyYW1fbW1fZnVuY3MgKmZ1bmNz
KTsKLXZvaWQgZHJtX3ZyYW1faGVscGVyX3JlbGVhc2VfbW0oc3RydWN0IGRybV9kZXZpY2UgKmRl
dik7Ci0KLS8qCi0gKiBIZWxwZXJzIGZvciAmc3RydWN0IGZpbGVfb3BlcmF0aW9ucwotICovCi0K
LWludCBkcm1fdnJhbV9tbV9maWxlX29wZXJhdGlvbnNfbW1hcCgKLQlzdHJ1Y3QgZmlsZSAqZmls
cCwgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpOwotCi0vKioKLSAqIGRlZmluZSBEUk1fVlJB
TV9NTV9GSUxFX09QRVJBVElPTlMgLSBkZWZhdWx0IGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgXAot
CSZzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zCi0gKgotICogRHJpdmVycyB0aGF0IHVzZSBWUkFNIE1N
IGNhbiB1c2UgdGhpcyBtYWNybyB0byBpbml0aWFsaXplCi0gKiAmc3RydWN0IGZpbGVfb3BlcmF0
aW9ucyB3aXRoIGRlZmF1bHQgZnVuY3Rpb25zLgotICovCi0jZGVmaW5lIERSTV9WUkFNX01NX0ZJ
TEVfT1BFUkFUSU9OUyBcCi0JLmxsc2VlawkJPSBub19sbHNlZWssIFwKLQkucmVhZAkJPSBkcm1f
cmVhZCwgXAotCS5wb2xsCQk9IGRybV9wb2xsLCBcCi0JLnVubG9ja2VkX2lvY3RsID0gZHJtX2lv
Y3RsLCBcCi0JLmNvbXBhdF9pb2N0bAk9IGRybV9jb21wYXRfaW9jdGwsIFwKLQkubW1hcAkJPSBk
cm1fdnJhbV9tbV9maWxlX29wZXJhdGlvbnNfbW1hcCwgXAotCS5vcGVuCQk9IGRybV9vcGVuLCBc
Ci0JLnJlbGVhc2UJPSBkcm1fcmVsZWFzZSBcCi0KICNlbmRpZgotLSAKMi4yMy4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
