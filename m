Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E8907C069A
	for <lists+dri-devel@lfdr.de>; Fri, 27 Sep 2019 15:47:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 396166E155;
	Fri, 27 Sep 2019 13:47:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x442.google.com (mail-pf1-x442.google.com
 [IPv6:2607:f8b0:4864:20::442])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 87EC26E155;
 Fri, 27 Sep 2019 13:47:06 +0000 (UTC)
Received: by mail-pf1-x442.google.com with SMTP id b128so1646410pfa.1;
 Fri, 27 Sep 2019 06:47:06 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=x5RJMtRFIUCEvOtz+LaV+1tuclWJatKNIS20t2HAKQk=;
 b=KJ8aKaz2od5zPYCAZ3Gw/sZwFwDSRTKPM/q+Pu7YDihk/fHEHP9x4MUEfSgp24SsMB
 LlgcwNT+W26wX9o23ceWAKX92yzUUjMjsyjHAIToN8aBmZ1lD9jwmgWVc4PummuTiyoo
 DG5EKv+yvhC3hDsEBXcDBeI2mYnrSX/eVrr7wkqT5EINm+9dtq/87v7AH1fA+h+CNmjt
 +9NSiUo61XCJaY+lVryBJU1nFnE71m7iOTSIU3C0ivdG93vwiuy32CoVNtX33VSgDhE+
 BX+/ewJwU+/nsrBwGIrq5YGuJQhhYiJIr9GT0mZQyM6vhyGrJP0le//Ga0TOkW3DKFN8
 YboA==
X-Gm-Message-State: APjAAAWWM7jHJ61qSQJmlfecvUWDdeTJ/xPZH6u3AgolWDtXMEgUvqHi
 HXwmCgnhMwfup7iWOCmQoyhPMF+EwIY=
X-Google-Smtp-Source: APXvYqy5wIJpd0Gg72LXlOJ5tPTyMlpC2R4k8GTroBI+a+p/AS9SKRitgMCGh8X7N8rXb2qMFLDtUw==
X-Received: by 2002:a63:7b58:: with SMTP id k24mr9399070pgn.138.1569592025861; 
 Fri, 27 Sep 2019 06:47:05 -0700 (PDT)
Received: from localhost.localdomain (ah.ptr230.ptrcloud.net. [153.122.161.8])
 by smtp.gmail.com with ESMTPSA id
 q71sm5608860pjb.26.2019.09.27.06.47.01
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 27 Sep 2019 06:47:05 -0700 (PDT)
From: Qiang Yu <yuq825@gmail.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 1/6] drm/gem: refine drm_gem_objects_lookup
Date: Fri, 27 Sep 2019 21:46:11 +0800
Message-Id: <20190927134616.21899-2-yuq825@gmail.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190927134616.21899-1-yuq825@gmail.com>
References: <20190927134616.21899-1-yuq825@gmail.com>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=x5RJMtRFIUCEvOtz+LaV+1tuclWJatKNIS20t2HAKQk=;
 b=P90tyCHucly03dEwBTI7gkAae/nqkG0hLqhn0m0yLtiDACqLUi0olbZv7fSUidA/VZ
 8M1keeJqgl6bsKZJmD2dkhiH86l4MBQRpyYohpdfgRG9bSzCmSQS2nIYgXKoxOA4HWTt
 qn0Q8m8LjTHI/pM4hayMWxpIpP/majH8qM87h13rENDmmc4XCDvuk4yQ/xd+PxKVbPED
 m1LPgkEYcJPOtmUggkgK8uRpONDklW5q7TzVdzUIuYcma0u2/cp3OM1tCYPCZ/n5FxbF
 BkomTx74QucEjLFFtdhl8Qojyg4KjvUzL6WPdzCXwZjI3jTsMwdU+E6lt7+p4tJJPQVg
 Nc4A==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomeu Vizoso <tomeu.vizoso@collabora.com>, lima@lists.freedesktop.org,
 Maxime Ripard <maxime.ripard@bootlin.com>, Steven Price <steven.price@arm.com>,
 David Airlie <airlied@linux.ie>, Qiang Yu <yuq825@gmail.com>,
 Sean Paul <sean@poorly.run>,
 Alyssa Rosenzweig <alyssa.rosenzweig@collabora.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

ZHJtX2dlbV9vYmplY3RzX2xvb2t1cCBkb2VzIG5vdCB1c2UgdXNlciBzcGFjZSBibyBoYW5kbGVz
CmRpcmVjdGx5IGFuZCBsZWZ0IHRoZSB1c2VyIHRvIGtlcm5lbCBjb3B5IHdvcmsgdG8gYSBuZXcK
aW50ZXJmYWNlIGRybV9nZW1fb2JqZWN0c19sb29rdXBfdXNlci4KClRoaXMgaXMgZm9yIGRyaXZl
ciBsaWtlIGxpbWEgd2hpY2ggZG9lcyBub3QgcGFzcyBnZW0gYm8KaGFuZGxlcyBjb250aW5vdXNs
eSBpbiBhbiBhcnJheSBpbiBpb2N0bCBhcmd1bWVudC4KCnYyOgoxLiBhZGQgZHJtX2dlbV9vYmpl
Y3RzX2xvb2t1cF91c2VyCjIuIHJlbW92ZSBub25lLXplcm8gY2hlY2sgYXMgYWxsIGNhbGxlciB3
aWxsIGNoZWNrIGJlZm9yZQogICBjYWxsaW5nIHRoaXMgZnVuY3Rpb24KCkNjOiBSb2IgSGVycmlu
ZyA8cm9iaEBrZXJuZWwub3JnPgpDYzogVG9tZXUgVml6b3NvIDx0b21ldS52aXpvc29AY29sbGFi
b3JhLmNvbT4KQ2M6IFN0ZXZlbiBQcmljZSA8c3RldmVuLnByaWNlQGFybS5jb20+CkNjOiBBbHlz
c2EgUm9zZW56d2VpZyA8YWx5c3NhLnJvc2VuendlaWdAY29sbGFib3JhLmNvbT4KU3VnZ2VzdGVk
LWJ5OiBSb2IgSGVycmluZyA8cm9iaEBrZXJuZWwub3JnPgpTaWduZWQtb2ZmLWJ5OiBRaWFuZyBZ
dSA8eXVxODI1QGdtYWlsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jICAgICAg
ICAgICAgICAgfCA1NyArKysrKysrKysrKysrKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
cGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMgfCAgNiArLS0KIGluY2x1ZGUvZHJtL2RybV9nZW0uaCAg
ICAgICAgICAgICAgICAgICB8ICA0ICstCiAzIGZpbGVzIGNoYW5nZWQsIDQ5IGluc2VydGlvbnMo
KyksIDE4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2Vt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCmluZGV4IDY4NTRmNTg2N2Q1MS4uYTVlODhj
M2U2ZDI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9kcm1fZ2VtLmMKQEAgLTY3OSwxMSArNjc5LDExIEBAIHN0YXRpYyBpbnQgb2Jq
ZWN0c19sb29rdXAoc3RydWN0IGRybV9maWxlICpmaWxwLCB1MzIgKmhhbmRsZSwgaW50IGNvdW50
LAogLyoqCiAgKiBkcm1fZ2VtX29iamVjdHNfbG9va3VwIC0gbG9vayB1cCBHRU0gb2JqZWN0cyBm
cm9tIGFuIGFycmF5IG9mIGhhbmRsZXMKICAqIEBmaWxwOiBEUk0gZmlsZSBwcml2YXRlIGRhdGUK
LSAqIEBib19oYW5kbGVzOiB1c2VyIHBvaW50ZXIgdG8gYXJyYXkgb2YgdXNlcnNwYWNlIGhhbmRs
ZQorICogQGJvX2hhbmRsZXM6IGFycmF5IG9mIEdFTSBvYmplY3QgaGFuZGxlcwogICogQGNvdW50
OiBzaXplIG9mIGhhbmRsZSBhcnJheQogICogQG9ianNfb3V0OiByZXR1cm5lZCBwb2ludGVyIHRv
IGFycmF5IG9mIGRybV9nZW1fb2JqZWN0IHBvaW50ZXJzCiAgKgotICogVGFrZXMgYW4gYXJyYXkg
b2YgdXNlcnNwYWNlIGhhbmRsZXMgYW5kIHJldHVybnMgYSBuZXdseSBhbGxvY2F0ZWQgYXJyYXkg
b2YKKyAqIFRha2VzIGFuIGFycmF5IG9mIEdFTSBvYmplY3QgaGFuZGxlcyBhbmQgcmV0dXJucyBh
IG5ld2x5IGFsbG9jYXRlZCBhcnJheSBvZgogICogR0VNIG9iamVjdHMuCiAgKgogICogRm9yIGEg
c2luZ2xlIGhhbmRsZSBsb29rdXAsIHVzZSBkcm1fZ2VtX29iamVjdF9sb29rdXAoKS4KQEAgLTY5
NSwyNiArNjk1LDU2IEBAIHN0YXRpYyBpbnQgb2JqZWN0c19sb29rdXAoc3RydWN0IGRybV9maWxl
ICpmaWxwLCB1MzIgKmhhbmRsZSwgaW50IGNvdW50LAogICogZmFpbHVyZS4gMCBpcyByZXR1cm5l
ZCBvbiBzdWNjZXNzLgogICoKICAqLwotaW50IGRybV9nZW1fb2JqZWN0c19sb29rdXAoc3RydWN0
IGRybV9maWxlICpmaWxwLCB2b2lkIF9fdXNlciAqYm9faGFuZGxlcywKK2ludCBkcm1fZ2VtX29i
amVjdHNfbG9va3VwKHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdTMyICpib19oYW5kbGVzLAogCQkJ
ICAgaW50IGNvdW50LCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKioqb2Jqc19vdXQpCiB7CiAJaW50
IHJldDsKLQl1MzIgKmhhbmRsZXM7CiAJc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqczsKIAot
CWlmICghY291bnQpCi0JCXJldHVybiAwOwotCiAJb2JqcyA9IGt2bWFsbG9jX2FycmF5KGNvdW50
LCBzaXplb2Yoc3RydWN0IGRybV9nZW1fb2JqZWN0ICopLAogCQkJICAgICBHRlBfS0VSTkVMIHwg
X19HRlBfWkVSTyk7CiAJaWYgKCFvYmpzKQogCQlyZXR1cm4gLUVOT01FTTsKIAorCXJldCA9IG9i
amVjdHNfbG9va3VwKGZpbHAsIGJvX2hhbmRsZXMsIGNvdW50LCBvYmpzKTsKKwlpZiAocmV0KQor
CQlrdmZyZWUob2Jqcyk7CisJZWxzZQorCQkqb2Jqc19vdXQgPSBvYmpzOworCisJcmV0dXJuIHJl
dDsKKworfQorRVhQT1JUX1NZTUJPTChkcm1fZ2VtX29iamVjdHNfbG9va3VwKTsKKworLyoqCisg
KiBkcm1fZ2VtX29iamVjdHNfbG9va3VwX3VzZXIgLSBsb29rIHVwIEdFTSBvYmplY3RzIGZyb20g
YW4gYXJyYXkgb2YgaGFuZGxlcworICogQGZpbHA6IERSTSBmaWxlIHByaXZhdGUgZGF0ZQorICog
QGJvX2hhbmRsZXM6IHVzZXIgcG9pbnRlciB0byBhcnJheSBvZiB1c2Vyc3BhY2UgaGFuZGxlCisg
KiBAY291bnQ6IHNpemUgb2YgaGFuZGxlIGFycmF5CisgKiBAb2Jqc19vdXQ6IHJldHVybmVkIHBv
aW50ZXIgdG8gYXJyYXkgb2YgZHJtX2dlbV9vYmplY3QgcG9pbnRlcnMKKyAqCisgKiBUYWtlcyBh
biBhcnJheSBvZiB1c2Vyc3BhY2UgaGFuZGxlcyBhbmQgcmV0dXJucyBhIG5ld2x5IGFsbG9jYXRl
ZCBhcnJheSBvZgorICogR0VNIG9iamVjdHMuCisgKgorICogRm9yIGEgc2luZ2xlIGhhbmRsZSBs
b29rdXAsIHVzZSBkcm1fZ2VtX29iamVjdF9sb29rdXAoKS4KKyAqCisgKiBSZXR1cm5zOgorICoK
KyAqIEBvYmpzIGZpbGxlZCBpbiB3aXRoIEdFTSBvYmplY3QgcG9pbnRlcnMuIFJldHVybmVkIEdF
TSBvYmplY3RzIG5lZWQgdG8gYmUKKyAqIHJlbGVhc2VkIHdpdGggZHJtX2dlbV9vYmplY3RfcHV0
KCkuIC1FTk9FTlQgaXMgcmV0dXJuZWQgb24gYSBsb29rdXAKKyAqIGZhaWx1cmUuIDAgaXMgcmV0
dXJuZWQgb24gc3VjY2Vzcy4KKyAqCisgKi8KK2ludCBkcm1fZ2VtX29iamVjdHNfbG9va3VwX3Vz
ZXIoc3RydWN0IGRybV9maWxlICpmaWxwLCB2b2lkIF9fdXNlciAqYm9faGFuZGxlcywKKwkJCQlp
bnQgY291bnQsIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqKipvYmpzX291dCkKK3sKKwlpbnQgcmV0
OworCXUzMiAqaGFuZGxlczsKKwogCWhhbmRsZXMgPSBrdm1hbGxvY19hcnJheShjb3VudCwgc2l6
ZW9mKHUzMiksIEdGUF9LRVJORUwpOwotCWlmICghaGFuZGxlcykgewotCQlyZXQgPSAtRU5PTUVN
OwotCQlnb3RvIG91dDsKLQl9CisJaWYgKCFoYW5kbGVzKQorCQlyZXR1cm4gLUVOT01FTTsKIAog
CWlmIChjb3B5X2Zyb21fdXNlcihoYW5kbGVzLCBib19oYW5kbGVzLCBjb3VudCAqIHNpemVvZih1
MzIpKSkgewogCQlyZXQgPSAtRUZBVUxUOwpAQCAtNzIyLDE1ICs3NTIsMTQgQEAgaW50IGRybV9n
ZW1fb2JqZWN0c19sb29rdXAoc3RydWN0IGRybV9maWxlICpmaWxwLCB2b2lkIF9fdXNlciAqYm9f
aGFuZGxlcywKIAkJZ290byBvdXQ7CiAJfQogCi0JcmV0ID0gb2JqZWN0c19sb29rdXAoZmlscCwg
aGFuZGxlcywgY291bnQsIG9ianMpOwotCSpvYmpzX291dCA9IG9ianM7CisJcmV0ID0gZHJtX2dl
bV9vYmplY3RzX2xvb2t1cChmaWxwLCBoYW5kbGVzLCBjb3VudCwgb2Jqc19vdXQpOwogCiBvdXQ6
CiAJa3ZmcmVlKGhhbmRsZXMpOwogCXJldHVybiByZXQ7CiAKIH0KLUVYUE9SVF9TWU1CT0woZHJt
X2dlbV9vYmplY3RzX2xvb2t1cCk7CitFWFBPUlRfU1lNQk9MKGRybV9nZW1fb2JqZWN0c19sb29r
dXBfdXNlcik7CiAKIC8qKgogICogZHJtX2dlbV9vYmplY3RfbG9va3VwIC0gbG9vayB1cCBhIEdF
TSBvYmplY3QgZnJvbSBpdHMgaGFuZGxlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcGFu
ZnJvc3QvcGFuZnJvc3RfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vcGFuZnJvc3QvcGFuZnJvc3Rf
ZHJ2LmMKaW5kZXggZDc0NDQyZDcxMDQ4Li40ODZjYTUxZDU2NjIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9wYW5mcm9zdC9wYW5mcm9zdF9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
cGFuZnJvc3QvcGFuZnJvc3RfZHJ2LmMKQEAgLTEzMCw5ICsxMzAsOSBAQCBwYW5mcm9zdF9sb29r
dXBfYm9zKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYgKCFqb2ItPmltcGxpY2l0X2ZlbmNl
cykKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlyZXR1cm4gZHJtX2dlbV9vYmplY3RzX2xvb2t1cChm
aWxlX3ByaXYsCi0JCQkJICAgICAgKHZvaWQgX191c2VyICopKHVpbnRwdHJfdClhcmdzLT5ib19o
YW5kbGVzLAotCQkJCSAgICAgIGpvYi0+Ym9fY291bnQsICZqb2ItPmJvcyk7CisJcmV0dXJuIGRy
bV9nZW1fb2JqZWN0c19sb29rdXBfdXNlcihmaWxlX3ByaXYsCisJCQkJCSAgICh2b2lkIF9fdXNl
ciAqKSh1aW50cHRyX3QpYXJncy0+Ym9faGFuZGxlcywKKwkJCQkJICAgam9iLT5ib19jb3VudCwg
JmpvYi0+Ym9zKTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fZ2VtLmgg
Yi9pbmNsdWRlL2RybS9kcm1fZ2VtLmgKaW5kZXggNmFhYmExNGY1OTcyLi4zNTRmYzhkMjQwZTQg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2RybV9nZW0uaAorKysgYi9pbmNsdWRlL2RybS9kcm1f
Z2VtLmgKQEAgLTM4Nyw4ICszODcsMTAgQEAgc3RydWN0IHBhZ2UgKipkcm1fZ2VtX2dldF9wYWdl
cyhzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaik7CiB2b2lkIGRybV9nZW1fcHV0X3BhZ2VzKHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLCBzdHJ1Y3QgcGFnZSAqKnBhZ2VzLAogCQlib29sIGRp
cnR5LCBib29sIGFjY2Vzc2VkKTsKIAotaW50IGRybV9nZW1fb2JqZWN0c19sb29rdXAoc3RydWN0
IGRybV9maWxlICpmaWxwLCB2b2lkIF9fdXNlciAqYm9faGFuZGxlcywKK2ludCBkcm1fZ2VtX29i
amVjdHNfbG9va3VwKHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdTMyICpib19oYW5kbGVzLAogCQkJ
ICAgaW50IGNvdW50LCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKioqb2Jqc19vdXQpOworaW50IGRy
bV9nZW1fb2JqZWN0c19sb29rdXBfdXNlcihzdHJ1Y3QgZHJtX2ZpbGUgKmZpbHAsIHZvaWQgX191
c2VyICpib19oYW5kbGVzLAorCQkJCWludCBjb3VudCwgc3RydWN0IGRybV9nZW1fb2JqZWN0ICoq
Km9ianNfb3V0KTsKIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZHJtX2dlbV9vYmplY3RfbG9va3Vw
KHN0cnVjdCBkcm1fZmlsZSAqZmlscCwgdTMyIGhhbmRsZSk7CiBsb25nIGRybV9nZW1fZG1hX3Jl
c3Zfd2FpdChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVwLCB1MzIgaGFuZGxlLAogCQkJCSAgICBib29s
IHdhaXRfYWxsLCB1bnNpZ25lZCBsb25nIHRpbWVvdXQpOwotLSAKMi4xNy4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBs
aXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
