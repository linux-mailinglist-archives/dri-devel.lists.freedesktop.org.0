Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7587A1100D2
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 16:06:23 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8B8A66E9B7;
	Tue,  3 Dec 2019 15:06:17 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from relay8-d.mail.gandi.net (relay8-d.mail.gandi.net
 [217.70.183.201])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A14FC6E9B7
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 15:06:15 +0000 (UTC)
X-Originating-IP: 90.76.211.102
Received: from localhost.localdomain (lfbn-1-2154-102.w90-76.abo.wanadoo.fr
 [90.76.211.102])
 (Authenticated sender: paul.kocialkowski@bootlin.com)
 by relay8-d.mail.gandi.net (Postfix) with ESMTPSA id 4611E1BF20F;
 Tue,  3 Dec 2019 15:06:13 +0000 (UTC)
From: Paul Kocialkowski <paul.kocialkowski@bootlin.com>
To: dri-devel@lists.freedesktop.org, devicetree@vger.kernel.org,
 linux-kernel@vger.kernel.org
Subject: [PATCH v4 3/3] WIP: drm/logicvc: Add plane colorkey support
Date: Tue,  3 Dec 2019 16:06:06 +0100
Message-Id: <20191203150606.317062-4-paul.kocialkowski@bootlin.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191203150606.317062-1-paul.kocialkowski@bootlin.com>
References: <20191203150606.317062-1-paul.kocialkowski@bootlin.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Thomas Petazzoni <thomas.petazzoni@bootlin.com>,
 David Airlie <airlied@linux.ie>,
 Paul Kocialkowski <paul.kocialkowski@bootlin.com>,
 Rob Herring <robh+dt@kernel.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogUGF1bCBLb2NpYWxrb3dza2kgPHBhdWwua29jaWFsa293c2tpQGJvb3Rs
aW4uY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2ljdmNfZHJtLmggICB8ICAg
MyArCiBkcml2ZXJzL2dwdS9kcm0vbG9naWN2Yy9sb2dpY3ZjX2xheWVyLmMgfCAxNDcgKysrKysr
KysrKysrKysrKysrKysrKystCiBkcml2ZXJzL2dwdS9kcm0vbG9naWN2Yy9sb2dpY3ZjX2xheWVy
LmggfCAgIDcgKysKIDMgZmlsZXMgY2hhbmdlZCwgMTUzIGluc2VydGlvbnMoKyksIDQgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2xvZ2ljdmMvbG9naWN2Y19kcm0u
aCBiL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2ljdmNfZHJtLmgKaW5kZXggY2M3MjhkNWE0
YWVlLi41MmYzYzA5Yjk2NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xv
Z2ljdmNfZHJtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2xvZ2ljdmMvbG9naWN2Y19kcm0uaApA
QCAtNTUsNiArNTUsOSBAQCBzdHJ1Y3QgbG9naWN2Y19kcm0gewogCXN0cnVjdCBsaXN0X2hlYWQg
bGF5ZXJzX2xpc3Q7CiAJc3RydWN0IGxvZ2ljdmNfY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgbG9naWN2
Y19pbnRlcmZhY2UgKmludGVyZmFjZTsKKworCXN0cnVjdCBkcm1fcHJvcGVydHkgKmNvbG9ya2V5
X2VuYWJsZWRfcHJvcGVydHk7CisJc3RydWN0IGRybV9wcm9wZXJ0eSAqY29sb3JrZXlfdmFsdWVf
cHJvcGVydHk7CiB9OwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9sb2dp
Y3ZjL2xvZ2ljdmNfbGF5ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2ljdmNfbGF5
ZXIuYwppbmRleCBjN2IwOTJkNTkyYWQuLmNlODIxNzgxZTE0OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2xvZ2ljdmMvbG9naWN2Y19sYXllci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9s
b2dpY3ZjL2xvZ2ljdmNfbGF5ZXIuYwpAQCAtMjIsNiArMjIsOCBAQAogCiAjZGVmaW5lIGxvZ2lj
dmNfbGF5ZXIocCkgXAogCWNvbnRhaW5lcl9vZihwLCBzdHJ1Y3QgbG9naWN2Y19sYXllciwgZHJt
X3BsYW5lKQorI2RlZmluZSBsb2dpY3ZjX2xheWVyX3N0YXRlKHApIFwKKwljb250YWluZXJfb2Yo
cCwgc3RydWN0IGxvZ2ljdmNfbGF5ZXJfc3RhdGUsIGRybV9wbGFuZV9zdGF0ZSkKIAogc3RhdGlj
IHVpbnQzMl90IGxvZ2ljdmNfbGF5ZXJfZm9ybWF0c19yZ2IxNltdID0gewogCURSTV9GT1JNQVRf
UkdCNTY1LApAQCAtMTMxLDYgKzEzMyw3IEBAIHN0YXRpYyB2b2lkIGxvZ2ljdmNfcGxhbmVfYXRv
bWljX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpkcm1fcGxhbmUsCiAJc3RydWN0IGxvZ2ljdmNf
bGF5ZXIgKmxheWVyID0gbG9naWN2Y19sYXllcihkcm1fcGxhbmUpOwogCXN0cnVjdCBsb2dpY3Zj
X2RybSAqbG9naWN2YyA9IGxheWVyLT5sb2dpY3ZjOwogCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUg
KnN0YXRlID0gZHJtX3BsYW5lLT5zdGF0ZTsKKwlzdHJ1Y3QgbG9naWN2Y19sYXllcl9zdGF0ZSAq
bGF5ZXJfc3RhdGUgPSBsb2dpY3ZjX2xheWVyX3N0YXRlKHN0YXRlKTsKIAlzdHJ1Y3QgZHJtX2Ny
dGMgKmRybV9jcnRjID0gJmxvZ2ljdmMtPmNydGMtPmRybV9jcnRjOwogCXN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICptb2RlID0gJmRybV9jcnRjLT5zdGF0ZS0+YWRqdXN0ZWRfbW9kZTsKIAlzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5mYjsKQEAgLTIwNiw2ICsyMDksMTUgQEAg
c3RhdGljIHZvaWQgbG9naWN2Y19wbGFuZV9hdG9taWNfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUg
KmRybV9wbGFuZSwKIAkJCSAgICAgYWxwaGEpOwogCX0KIAorCS8qIExheWVyIGNvbG9ya2V5ICov
CisKKwlpZiAobGF5ZXJfc3RhdGUtPmNvbG9ya2V5X2VuYWJsZWQpIHsKKwkJcmVnID0gbGF5ZXJf
c3RhdGUtPmNvbG9ya2V5X3ZhbHVlOworCisJCXJlZ21hcF93cml0ZShsb2dpY3ZjLT5yZWdtYXAs
CisJCQkgICAgIExPR0lDVkNfTEFZRVJfQ09MT1JfS0VZX1JFRyhpbmRleCksIHJlZyk7CisJfQor
CiAJLyogTGF5ZXIgY29udHJvbCAqLwogCiAJcmVnID0gTE9HSUNWQ19MQVlFUl9DVFJMX0VOQUJM
RTsKQEAgLTIxMyw3ICsyMjUsOCBAQCBzdGF0aWMgdm9pZCBsb2dpY3ZjX3BsYW5lX2F0b21pY191
cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqZHJtX3BsYW5lLAogCWlmIChsb2dpY3ZjX2xheWVyX2Zv
cm1hdF9pbnZlcnRlZChmYi0+Zm9ybWF0LT5mb3JtYXQpKQogCQlyZWcgfD0gTE9HSUNWQ19MQVlF
Ul9DVFJMX1BJWEVMX0ZPUk1BVF9JTlZFUlQ7CiAKLQlyZWcgfD0gTE9HSUNWQ19MQVlFUl9DVFJM
X0NPTE9SX0tFWV9ESVNBQkxFOworCWlmICghbGF5ZXJfc3RhdGUtPmNvbG9ya2V5X2VuYWJsZWQp
CisJCXJlZyB8PSBMT0dJQ1ZDX0xBWUVSX0NUUkxfQ09MT1JfS0VZX0RJU0FCTEU7CiAKIAlyZWdt
YXBfd3JpdGUobG9naWN2Yy0+cmVnbWFwLCBMT0dJQ1ZDX0xBWUVSX0NUUkxfUkVHKGluZGV4KSwg
cmVnKTsKIH0KQEAgLTIzNCwxMyArMjQ3LDExMiBAQCBzdGF0aWMgc3RydWN0IGRybV9wbGFuZV9o
ZWxwZXJfZnVuY3MgbG9naWN2Y19wbGFuZV9oZWxwZXJfZnVuY3MgPSB7CiAJLmF0b21pY19kaXNh
YmxlCQk9IGxvZ2ljdmNfcGxhbmVfYXRvbWljX2Rpc2FibGUsCiB9OwogCitzdGF0aWMgdm9pZCBs
b2dpY3ZjX3BsYW5lX3Jlc2V0KHN0cnVjdCBkcm1fcGxhbmUgKmRybV9wbGFuZSkKK3sKKwlzdHJ1
Y3QgbG9naWN2Y19sYXllciAqbGF5ZXIgPSBsb2dpY3ZjX2xheWVyKGRybV9wbGFuZSk7CisJc3Ry
dWN0IGxvZ2ljdmNfZHJtICpsb2dpY3ZjID0gbGF5ZXItPmxvZ2ljdmM7CisJc3RydWN0IGxvZ2lj
dmNfbGF5ZXJfc3RhdGUgKmxheWVyX3N0YXRlOworCisJaWYgKGRybV9wbGFuZS0+c3RhdGUpIHsK
KwkJbGF5ZXJfc3RhdGUgPSBsb2dpY3ZjX2xheWVyX3N0YXRlKGRybV9wbGFuZS0+c3RhdGUpOwor
CQlfX2RybV9hdG9taWNfaGVscGVyX3BsYW5lX2Rlc3Ryb3lfc3RhdGUoZHJtX3BsYW5lLT5zdGF0
ZSk7CisJCWRldm1fa2ZyZWUobG9naWN2Yy0+ZHJtLT5kZXYsIGxheWVyX3N0YXRlKTsKKwkJZHJt
X3BsYW5lLT5zdGF0ZSA9IE5VTEw7CisJfQorCisJbGF5ZXJfc3RhdGUgPSBkZXZtX2t6YWxsb2Mo
bG9naWN2Yy0+ZHJtLT5kZXYsIHNpemVvZigqbGF5ZXJfc3RhdGUpLAorCQkJCSAgIEdGUF9LRVJO
RUwpOworCWlmICghbGF5ZXJfc3RhdGUpCisJCXJldHVybjsKKworCV9fZHJtX2F0b21pY19oZWxw
ZXJfcGxhbmVfcmVzZXQoZHJtX3BsYW5lLAorCQkJCQkmbGF5ZXJfc3RhdGUtPmRybV9wbGFuZV9z
dGF0ZSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpsb2dpY3ZjX3BsYW5l
X2F0b21pY19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9wbGFuZSAqZHJtX3BsYW5lKQorewor
CXN0cnVjdCBsb2dpY3ZjX2xheWVyICpsYXllciA9IGxvZ2ljdmNfbGF5ZXIoZHJtX3BsYW5lKTsK
KwlzdHJ1Y3QgbG9naWN2Y19kcm0gKmxvZ2ljdmMgPSBsYXllci0+bG9naWN2YzsKKwlzdHJ1Y3Qg
bG9naWN2Y19sYXllcl9zdGF0ZSAqbGF5ZXJfc3RhdGVfY3VycmVudDsKKwlzdHJ1Y3QgbG9naWN2
Y19sYXllcl9zdGF0ZSAqbGF5ZXJfc3RhdGU7CisKKwlpZiAoV0FSTl9PTighZHJtX3BsYW5lLT5z
dGF0ZSkpCisJCXJldHVybiBOVUxMOworCisJbGF5ZXJfc3RhdGVfY3VycmVudCA9IGxvZ2ljdmNf
bGF5ZXJfc3RhdGUoZHJtX3BsYW5lLT5zdGF0ZSk7CisJbGF5ZXJfc3RhdGUgPSBkZXZtX2t6YWxs
b2MobG9naWN2Yy0+ZHJtLT5kZXYsIHNpemVvZigqbGF5ZXJfc3RhdGUpLAorCQkJCSAgIEdGUF9L
RVJORUwpOworCWlmICghbGF5ZXJfc3RhdGUpCisJCXJldHVybiBOVUxMOworCisJbGF5ZXJfc3Rh
dGUtPmNvbG9ya2V5X2VuYWJsZWQgPSBsYXllcl9zdGF0ZV9jdXJyZW50LT5jb2xvcmtleV9lbmFi
bGVkOworCWxheWVyX3N0YXRlLT5jb2xvcmtleV92YWx1ZSA9IGxheWVyX3N0YXRlX2N1cnJlbnQt
PmNvbG9ya2V5X3ZhbHVlOworCisJX19kcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kdXBsaWNhdGVf
c3RhdGUoZHJtX3BsYW5lLAorCQkJCQkJICAmbGF5ZXJfc3RhdGUtPmRybV9wbGFuZV9zdGF0ZSk7
CisKKwlyZXR1cm4gJmxheWVyX3N0YXRlLT5kcm1fcGxhbmVfc3RhdGU7Cit9CisKK3N0YXRpYyB2
b2lkIGxvZ2ljdmNfcGxhbmVfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpkcm1fcGxh
bmUsCisJCQkJCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBsb2dp
Y3ZjX2xheWVyICpsYXllciA9IGxvZ2ljdmNfbGF5ZXIoZHJtX3BsYW5lKTsKKwlzdHJ1Y3QgbG9n
aWN2Y19kcm0gKmxvZ2ljdmMgPSBsYXllci0+bG9naWN2YzsKKwlzdHJ1Y3QgbG9naWN2Y19sYXll
cl9zdGF0ZSAqbGF5ZXJfc3RhdGUgPSBsb2dpY3ZjX2xheWVyX3N0YXRlKHN0YXRlKTsKKworCV9f
ZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVzdHJveV9zdGF0ZSgmbGF5ZXJfc3RhdGUtPmRybV9w
bGFuZV9zdGF0ZSk7CisKKwlkZXZtX2tmcmVlKGxvZ2ljdmMtPmRybS0+ZGV2LCBsYXllcl9zdGF0
ZSk7Cit9CisKK3N0YXRpYyBpbnQgbG9naWN2Y19wbGFuZV9hdG9taWNfc2V0X3Byb3BlcnR5KHN0
cnVjdCBkcm1fcGxhbmUgKmRybV9wbGFuZSwKKwkJCQkJICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0
YXRlICpzdGF0ZSwKKwkJCQkJICAgICBzdHJ1Y3QgZHJtX3Byb3BlcnR5ICpwcm9wZXJ0eSwKKwkJ
CQkJICAgICB1aW50NjRfdCB2YWx1ZSkKK3sKKwlzdHJ1Y3QgbG9naWN2Y19sYXllciAqbGF5ZXIg
PSBsb2dpY3ZjX2xheWVyKGRybV9wbGFuZSk7CisJc3RydWN0IGxvZ2ljdmNfZHJtICpsb2dpY3Zj
ID0gbGF5ZXItPmxvZ2ljdmM7CisJc3RydWN0IGxvZ2ljdmNfbGF5ZXJfc3RhdGUgKmxheWVyX3N0
YXRlID0gbG9naWN2Y19sYXllcl9zdGF0ZShzdGF0ZSk7CisKKwlpZiAocHJvcGVydHkgPT0gbG9n
aWN2Yy0+Y29sb3JrZXlfZW5hYmxlZF9wcm9wZXJ0eSkKKwkJbGF5ZXJfc3RhdGUtPmNvbG9ya2V5
X2VuYWJsZWQgPSAhIXZhbHVlOworCWVsc2UgaWYgKHByb3BlcnR5ID09IGxvZ2ljdmMtPmNvbG9y
a2V5X3ZhbHVlX3Byb3BlcnR5KQorCQlsYXllcl9zdGF0ZS0+Y29sb3JrZXlfdmFsdWUgPSAodWlu
dDMyX3QpdmFsdWU7CisJZWxzZQorCQlyZXR1cm4gLUVOT0VOVDsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IGxvZ2ljdmNfcGxhbmVfYXRvbWljX2dldF9wcm9wZXJ0eShzdHJ1Y3QgZHJt
X3BsYW5lICpkcm1fcGxhbmUsCisJCQkJCSAgICAgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0
ZSAqc3RhdGUsCisJCQkJCSAgICAgc3RydWN0IGRybV9wcm9wZXJ0eSAqcHJvcGVydHksCisJCQkJ
CSAgICAgdWludDY0X3QgKnZhbHVlKQoreworCXN0cnVjdCBsb2dpY3ZjX2xheWVyICpsYXllciA9
IGxvZ2ljdmNfbGF5ZXIoZHJtX3BsYW5lKTsKKwlzdHJ1Y3QgbG9naWN2Y19kcm0gKmxvZ2ljdmMg
PSBsYXllci0+bG9naWN2YzsKKwlzdHJ1Y3QgbG9naWN2Y19sYXllcl9zdGF0ZSAqbGF5ZXJfc3Rh
dGUgPSBsb2dpY3ZjX2xheWVyX3N0YXRlKHN0YXRlKTsKKworCWlmIChwcm9wZXJ0eSA9PSBsb2dp
Y3ZjLT5jb2xvcmtleV9lbmFibGVkX3Byb3BlcnR5KQorCQkqdmFsdWUgPSBsYXllcl9zdGF0ZS0+
Y29sb3JrZXlfZW5hYmxlZDsKKwllbHNlIGlmIChwcm9wZXJ0eSA9PSBsb2dpY3ZjLT5jb2xvcmtl
eV92YWx1ZV9wcm9wZXJ0eSkKKwkJKnZhbHVlID0gbGF5ZXJfc3RhdGUtPmNvbG9ya2V5X3ZhbHVl
OworCWVsc2UKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgbG9naWN2Y19wbGFuZV9mdW5jcyA9IHsKIAkudXBk
YXRlX3BsYW5lCQk9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKIAkuZGlzYWJsZV9w
bGFuZQkJPSBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLAogCS5kZXN0cm95CQk9IGRy
bV9wbGFuZV9jbGVhbnVwLAotCS5yZXNldAkJCT0gZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfcmVz
ZXQsCi0JLmF0b21pY19kdXBsaWNhdGVfc3RhdGUJPSBkcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9k
dXBsaWNhdGVfc3RhdGUsCi0JLmF0b21pY19kZXN0cm95X3N0YXRlCT0gZHJtX2F0b21pY19oZWxw
ZXJfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkucmVzZXQJCQk9IGxvZ2ljdmNfcGxhbmVfcmVzZXQs
CisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUJPSBsb2dpY3ZjX3BsYW5lX2F0b21pY19kdXBsaWNh
dGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlCT0gbG9naWN2Y19wbGFuZV9kZXN0cm95
X3N0YXRlLAorCS5hdG9taWNfc2V0X3Byb3BlcnR5CT0gbG9naWN2Y19wbGFuZV9hdG9taWNfc2V0
X3Byb3BlcnR5LAorCS5hdG9taWNfZ2V0X3Byb3BlcnR5CT0gbG9naWN2Y19wbGFuZV9hdG9taWNf
Z2V0X3Byb3BlcnR5LAogfTsKIAogaW50IGxvZ2ljdmNfbGF5ZXJfYnVmZmVyX2ZpbmRfc2V0dXAo
c3RydWN0IGxvZ2ljdmNfbGF5ZXIgKmxheWVyLApAQCAtNTA4LDYgKzYyMCwxMSBAQCBzdGF0aWMg
aW50IGxvZ2ljdmNfbGF5ZXJfaW5pdChzdHJ1Y3QgbG9naWN2Y19kcm0gKmxvZ2ljdmMsCiAKIAlk
cm1fcGxhbmVfY3JlYXRlX3pwb3NfaW1tdXRhYmxlX3Byb3BlcnR5KCZsYXllci0+ZHJtX3BsYW5l
LCB6cG9zKTsKIAorCWRybV9vYmplY3RfYXR0YWNoX3Byb3BlcnR5KCZsYXllci0+ZHJtX3BsYW5l
LmJhc2UsCisJCQkJICAgbG9naWN2Yy0+Y29sb3JrZXlfZW5hYmxlZF9wcm9wZXJ0eSwgMCk7CisJ
ZHJtX29iamVjdF9hdHRhY2hfcHJvcGVydHkoJmxheWVyLT5kcm1fcGxhbmUuYmFzZSwKKwkJCQkg
ICBsb2dpY3ZjLT5jb2xvcmtleV92YWx1ZV9wcm9wZXJ0eSwgMCk7CisKIAlEUk1fREVCVUdfRFJJ
VkVSKCJSZWdpc3RlcmluZyBsYXllciAjJWRcbiIsIGluZGV4KTsKIAogCWxheWVyLT5mb3JtYXRz
ID0gZm9ybWF0czsKQEAgLTU0NSw2ICs2NjIsNyBAQCB2b2lkIGxvZ2ljdmNfbGF5ZXJzX2F0dGFj
aF9jcnRjKHN0cnVjdCBsb2dpY3ZjX2RybSAqbG9naWN2YykKIAogaW50IGxvZ2ljdmNfbGF5ZXJz
X2luaXQoc3RydWN0IGxvZ2ljdmNfZHJtICpsb2dpY3ZjKQogeworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkcm0gPSBsb2dpY3ZjLT5kcm07CiAJc3RydWN0IGRldmljZV9ub2RlICpvZl9ub2RlID0gbG9n
aWN2Yy0+ZHJtLT5kZXYtPm9mX25vZGU7CiAJc3RydWN0IGRldmljZV9ub2RlICpsYXllcl9ub2Rl
ID0gTlVMTDsKIAlzdHJ1Y3QgZGV2aWNlX25vZGUgKmxheWVyc19ub2RlOwpAQCAtNTUyLDYgKzY3
MCwxNyBAQCBpbnQgbG9naWN2Y19sYXllcnNfaW5pdChzdHJ1Y3QgbG9naWN2Y19kcm0gKmxvZ2lj
dmMpCiAJc3RydWN0IGxvZ2ljdmNfbGF5ZXIgKm5leHQ7CiAJaW50IHJldCA9IDA7CiAKKwlsb2dp
Y3ZjLT5jb2xvcmtleV9lbmFibGVkX3Byb3BlcnR5ID0KKwkJZHJtX3Byb3BlcnR5X2NyZWF0ZV9i
b29sKGRybSwgMCwgImNvbG9ya2V5X2VuYWJsZWQiKTsKKwlpZiAoIWxvZ2ljdmMtPmNvbG9ya2V5
X2VuYWJsZWRfcHJvcGVydHkpCisJCWdvdG8gZXJyb3I7CisKKwlsb2dpY3ZjLT5jb2xvcmtleV92
YWx1ZV9wcm9wZXJ0eSA9CisJCWRybV9wcm9wZXJ0eV9jcmVhdGVfcmFuZ2UoZHJtLCAwLCAiY29s
b3JrZXlfdmFsdWUiLAorCQkJCQkgIDAsIDB4ZmZmZmZmZmYpOworCWlmICghbG9naWN2Yy0+Y29s
b3JrZXlfdmFsdWVfcHJvcGVydHkpCisJCWdvdG8gZXJyb3I7CisKIAlsYXllcnNfbm9kZSA9IG9m
X2dldF9jaGlsZF9ieV9uYW1lKG9mX25vZGUsICJsYXllcnMiKTsKIAlpZiAoIWxheWVyc19ub2Rl
KSB7CiAJCURSTV9FUlJPUigiTm8gbGF5ZXJzIG5vZGUgZm91bmQgaW4gdGhlIGRlc2NyaXB0aW9u
XG4iKTsKQEAgLTU5MCw1ICs3MTksMTUgQEAgaW50IGxvZ2ljdmNfbGF5ZXJzX2luaXQoc3RydWN0
IGxvZ2ljdmNfZHJtICpsb2dpY3ZjKQogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShsYXllciwg
bmV4dCwgJmxvZ2ljdmMtPmxheWVyc19saXN0LCBsaXN0KQogCQlsb2dpY3ZjX2xheWVyX2Zpbmko
bG9naWN2YywgbGF5ZXIpOwogCisJaWYgKGxvZ2ljdmMtPmNvbG9ya2V5X3ZhbHVlX3Byb3BlcnR5
KSB7CisJCWRybV9wcm9wZXJ0eV9kZXN0cm95KGRybSwgbG9naWN2Yy0+Y29sb3JrZXlfdmFsdWVf
cHJvcGVydHkpOworCQlsb2dpY3ZjLT5jb2xvcmtleV92YWx1ZV9wcm9wZXJ0eSA9IE5VTEw7CisJ
fQorCisJaWYgKGxvZ2ljdmMtPmNvbG9ya2V5X2VuYWJsZWRfcHJvcGVydHkpIHsKKwkJZHJtX3By
b3BlcnR5X2Rlc3Ryb3koZHJtLCBsb2dpY3ZjLT5jb2xvcmtleV9lbmFibGVkX3Byb3BlcnR5KTsK
KwkJbG9naWN2Yy0+Y29sb3JrZXlfZW5hYmxlZF9wcm9wZXJ0eSA9IE5VTEw7CisJfQorCiAJcmV0
dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2ljdmNf
bGF5ZXIuaCBiL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2ljdmNfbGF5ZXIuaAppbmRleCA3
MWIzZjE3N2IwOTMuLjJmYjE2MTIxNzA4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2xv
Z2ljdmMvbG9naWN2Y19sYXllci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9sb2dpY3ZjL2xvZ2lj
dmNfbGF5ZXIuaApAQCAtMzksNiArMzksMTMgQEAgc3RydWN0IGxvZ2ljdmNfbGF5ZXJfZm9ybWF0
cyB7CiAJdWludDMyX3QgKmZvcm1hdHM7CiB9OwogCitzdHJ1Y3QgbG9naWN2Y19sYXllcl9zdGF0
ZSB7CisJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSBkcm1fcGxhbmVfc3RhdGU7CisKKwlib29sIGNv
bG9ya2V5X2VuYWJsZWQ7CisJdWludDMyX3QgY29sb3JrZXlfdmFsdWU7Cit9OworCiBzdHJ1Y3Qg
bG9naWN2Y19sYXllciB7CiAJc3RydWN0IGxvZ2ljdmNfZHJtICpsb2dpY3ZjOwogCi0tIAoyLjI0
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1k
ZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
