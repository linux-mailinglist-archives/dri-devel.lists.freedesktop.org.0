Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0A7A410FFDA
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 15:15:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B400A6E5DD;
	Tue,  3 Dec 2019 14:15:28 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk [46.235.227.227])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F9476E5E7
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 14:15:27 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 912CF2726E2;
 Tue,  3 Dec 2019 14:15:25 +0000 (GMT)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 04/11] drm/bridge: Make the bridge chain a double-linked
 list
Date: Tue,  3 Dec 2019 15:15:08 +0100
Message-Id: <20191203141515.3597631-5-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203141515.3597631-1-boris.brezillon@collabora.com>
References: <20191203141515.3597631-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U28gdGhhdCBlYWNoIGVsZW1lbnQgaW4gdGhlIGNoYWluIGNhbiBlYXNpbHkgYWNjZXNzIGl0cyBw
cmVkZWNlc3Nvci4KVGhpcyB3aWxsIGJlIG5lZWRlZCB0byBzdXBwb3J0IGJ1cyBmb3JtYXQgbmVn
b3RpYXRpb24gYmV0d2VlbiBlbGVtZW50cwpvZiB0aGUgYnJpZGdlIGNoYWluLgoKU2lnbmVkLW9m
Zi1ieTogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25AY29sbGFib3JhLmNvbT4KUmV2
aWV3ZWQtYnk6IE5laWwgQXJtc3Ryb25nIDxuYXJtc3Ryb25nQGJheWxpYnJlLmNvbT4KUmV2aWV3
ZWQtYnk6IExhdXJlbnQgUGluY2hhcnQgPGxhdXJlbnQucGluY2hhcnRAaWRlYXNvbmJvYXJkLmNv
bT4KLS0tCkNoYW5nZXMgaW4gdjQ6CiogU2ltcGxpZnkgdGhlIGRybV9icmlkZ2VfYXR0YWNoKCkg
bG9naWMKKiBGaXggbGlzdCBpdGVyYXRpb24gYnVncwoqIFBhdGNoIFZDNCBhbmQgRXh5bm9zIERT
SSBkcml2ZXJzIHRvIG1hdGNoIGNvcmUgY2hhbmdlcwoqIEFkZCBSLWJzCgpDaGFuZ2VzIGluIHYz
OgoqIE5vbmUKCkNoYW5nZXMgaW4gdjI6CiogQWRqdXN0IHRoaW5ncyB0byB0aGUgImR1bW15IGVu
Y29kZXIgYnJpZGdlIiBjaGFuZ2UgKHBhdGNoIDIgaW4gdGhpcwogIHNlcmllcykKLS0tCiBkcml2
ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAgICAgICAgICAgfCAxNzEgKysrKysrKysrKysrKysr
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2VuY29kZXIuYyAgICAgICAgICAgfCAgMTYg
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vZXh5bm9zL2V4eW5vc19kcm1fZHNpLmMgfCAgIDUgKy0KIGRy
aXZlcnMvZ3B1L2RybS92YzQvdmM0X2RzaS5jICAgICAgICAgICB8ICAxMCArLQogaW5jbHVkZS9k
cm0vZHJtX2JyaWRnZS5oICAgICAgICAgICAgICAgIHwgIDEyICstCiBpbmNsdWRlL2RybS9kcm1f
ZW5jb2Rlci5oICAgICAgICAgICAgICAgfCAgIDcgKy0KIDYgZmlsZXMgY2hhbmdlZCwgMTQzIGlu
c2VydGlvbnMoKyksIDc4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fYnJpZGdlLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCmluZGV4IDU0Yzg3
NDQ5M2M1Ny4uYjY1MTdiNGZhM2QxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Jy
aWRnZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYnJpZGdlLmMKQEAgLTU1LDcgKzU1LDcg
QEAKICAqIGp1c3QgcHJvdmlkZSBhZGRpdGlvbmFsIGhvb2tzIHRvIGdldCB0aGUgZGVzaXJlZCBv
dXRwdXQgYXQgdGhlIGVuZCBvZiB0aGUKICAqIGVuY29kZXIgY2hhaW4uCiAgKgotICogQnJpZGdl
cyBjYW4gYWxzbyBiZSBjaGFpbmVkIHVwIHVzaW5nIHRoZSAmZHJtX2JyaWRnZS5uZXh0IHBvaW50
ZXIuCisgKiBCcmlkZ2VzIGNhbiBhbHNvIGJlIGNoYWluZWQgdXAgdXNpbmcgdGhlICZkcm1fYnJp
ZGdlLmNoYWluX25vZGUgZmllbGQuCiAgKgogICogQm90aCBsZWdhY3kgQ1JUQyBoZWxwZXJzIGFu
ZCB0aGUgbmV3IGF0b21pYyBtb2Rlc2V0IGhlbHBlcnMgc3VwcG9ydCBicmlkZ2VzLgogICovCkBA
IC0xMjgsMjAgKzEyOCwyMSBAQCBpbnQgZHJtX2JyaWRnZV9hdHRhY2goc3RydWN0IGRybV9lbmNv
ZGVyICplbmNvZGVyLCBzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogCWJyaWRnZS0+ZGV2ID0g
ZW5jb2Rlci0+ZGV2OwogCWJyaWRnZS0+ZW5jb2RlciA9IGVuY29kZXI7CiAKKwlpZiAocHJldmlv
dXMpCisJCWxpc3RfYWRkKCZicmlkZ2UtPmNoYWluX25vZGUsICZwcmV2aW91cy0+Y2hhaW5fbm9k
ZSk7CisJZWxzZQorCQlsaXN0X2FkZCgmYnJpZGdlLT5jaGFpbl9ub2RlLCAmZW5jb2Rlci0+YnJp
ZGdlX2NoYWluKTsKKwogCWlmIChicmlkZ2UtPmZ1bmNzLT5hdHRhY2gpIHsKIAkJcmV0ID0gYnJp
ZGdlLT5mdW5jcy0+YXR0YWNoKGJyaWRnZSk7CiAJCWlmIChyZXQgPCAwKSB7CisJCQlsaXN0X2Rl
bCgmYnJpZGdlLT5jaGFpbl9ub2RlKTsKIAkJCWJyaWRnZS0+ZGV2ID0gTlVMTDsKIAkJCWJyaWRn
ZS0+ZW5jb2RlciA9IE5VTEw7CiAJCQlyZXR1cm4gcmV0OwogCQl9CiAJfQogCi0JaWYgKHByZXZp
b3VzKQotCQlwcmV2aW91cy0+bmV4dCA9IGJyaWRnZTsKLQllbHNlCi0JCWVuY29kZXItPmJyaWRn
ZSA9IGJyaWRnZTsKLQogCXJldHVybiAwOwogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2F0
dGFjaCk7CkBAIC0xNTcsNiArMTU4LDcgQEAgdm9pZCBkcm1fYnJpZGdlX2RldGFjaChzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlKQogCWlmIChicmlkZ2UtPmZ1bmNzLT5kZXRhY2gpCiAJCWJyaWRn
ZS0+ZnVuY3MtPmRldGFjaChicmlkZ2UpOwogCisJbGlzdF9kZWwoJmJyaWRnZS0+Y2hhaW5fbm9k
ZSk7CiAJYnJpZGdlLT5kZXYgPSBOVUxMOwogfQogCkBAIC0xOTAsMTggKzE5MiwyMSBAQCBib29s
IGRybV9icmlkZ2VfY2hhaW5fbW9kZV9maXh1cChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAog
CQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwKIAkJCQkgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUpCiB7Ci0JYm9vbCByZXQgPSB0cnVlOworCXN0
cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKIAogCWlmICghYnJpZGdlKQogCQlyZXR1cm4gdHJ1
ZTsKIAotCWlmIChicmlkZ2UtPmZ1bmNzLT5tb2RlX2ZpeHVwKQotCQlyZXQgPSBicmlkZ2UtPmZ1
bmNzLT5tb2RlX2ZpeHVwKGJyaWRnZSwgbW9kZSwgYWRqdXN0ZWRfbW9kZSk7CisJZW5jb2RlciA9
IGJyaWRnZS0+ZW5jb2RlcjsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zyb20oYnJpZGdlLCAmZW5j
b2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7CisJCWlmICghYnJpZGdlLT5mdW5jcy0+
bW9kZV9maXh1cCkKKwkJCWNvbnRpbnVlOwogCi0JcmV0ID0gcmV0ICYmIGRybV9icmlkZ2VfY2hh
aW5fbW9kZV9maXh1cChicmlkZ2UtPm5leHQsIG1vZGUsCi0JCQkJCQkgYWRqdXN0ZWRfbW9kZSk7
CisJCWlmICghYnJpZGdlLT5mdW5jcy0+bW9kZV9maXh1cChicmlkZ2UsIG1vZGUsIGFkanVzdGVk
X21vZGUpKQorCQkJcmV0dXJuIGZhbHNlOworCX0KIAotCXJldHVybiByZXQ7CisJcmV0dXJuIHRy
dWU7CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9icmlkZ2VfY2hhaW5fbW9kZV9maXh1cCk7CiAKQEAg
LTIyNCwxOCArMjI5LDI0IEBAIGVudW0gZHJtX21vZGVfc3RhdHVzCiBkcm1fYnJpZGdlX2NoYWlu
X21vZGVfdmFsaWQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCSAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKIHsKLQllbnVtIGRybV9tb2RlX3N0YXR1cyByZXQg
PSBNT0RFX09LOworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKIAogCWlmICghYnJpZGdl
KQotCQlyZXR1cm4gcmV0OworCQlyZXR1cm4gTU9ERV9PSzsKIAotCWlmIChicmlkZ2UtPmZ1bmNz
LT5tb2RlX3ZhbGlkKQotCQlyZXQgPSBicmlkZ2UtPmZ1bmNzLT5tb2RlX3ZhbGlkKGJyaWRnZSwg
bW9kZSk7CisJZW5jb2RlciA9IGJyaWRnZS0+ZW5jb2RlcjsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5
X2Zyb20oYnJpZGdlLCAmZW5jb2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7CisJCWVu
dW0gZHJtX21vZGVfc3RhdHVzIHJldDsKKworCQlpZiAoIWJyaWRnZS0+ZnVuY3MtPm1vZGVfdmFs
aWQpCisJCQljb250aW51ZTsKIAotCWlmIChyZXQgIT0gTU9ERV9PSykKLQkJcmV0dXJuIHJldDsK
KwkJcmV0ID0gYnJpZGdlLT5mdW5jcy0+bW9kZV92YWxpZChicmlkZ2UsIG1vZGUpOworCQlpZiAo
cmV0ICE9IE1PREVfT0spCisJCQlyZXR1cm4gcmV0OworCX0KIAotCXJldHVybiBkcm1fYnJpZGdl
X2NoYWluX21vZGVfdmFsaWQoYnJpZGdlLT5uZXh0LCBtb2RlKTsKKwlyZXR1cm4gTU9ERV9PSzsK
IH0KIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9jaGFpbl9tb2RlX3ZhbGlkKTsKIApAQCAtMjUx
LDEzICsyNjIsMjAgQEAgRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX21vZGVfdmFsaWQp
OwogICovCiB2b2lkIGRybV9icmlkZ2VfY2hhaW5fZGlzYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlKQogeworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwlzdHJ1Y3QgZHJtX2Jy
aWRnZSAqaXRlcjsKKwogCWlmICghYnJpZGdlKQogCQlyZXR1cm47CiAKLQlkcm1fYnJpZGdlX2No
YWluX2Rpc2FibGUoYnJpZGdlLT5uZXh0KTsKKwllbmNvZGVyID0gYnJpZGdlLT5lbmNvZGVyOwor
CWxpc3RfZm9yX2VhY2hfZW50cnlfcmV2ZXJzZShpdGVyLCAmZW5jb2Rlci0+YnJpZGdlX2NoYWlu
LCBjaGFpbl9ub2RlKSB7CisJCWlmIChpdGVyLT5mdW5jcy0+ZGlzYWJsZSkKKwkJCWl0ZXItPmZ1
bmNzLT5kaXNhYmxlKGl0ZXIpOwogCi0JaWYgKGJyaWRnZS0+ZnVuY3MtPmRpc2FibGUpCi0JCWJy
aWRnZS0+ZnVuY3MtPmRpc2FibGUoYnJpZGdlKTsKKwkJaWYgKGl0ZXIgPT0gYnJpZGdlKQorCQkJ
YnJlYWs7CisJfQogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX2Rpc2FibGUpOwog
CkBAIC0yNzQsMTMgKzI5MiwxNiBAQCBFWFBPUlRfU1lNQk9MKGRybV9icmlkZ2VfY2hhaW5fZGlz
YWJsZSk7CiAgKi8KIHZvaWQgZHJtX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSkKIHsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisKIAlp
ZiAoIWJyaWRnZSkKIAkJcmV0dXJuOwogCi0JaWYgKGJyaWRnZS0+ZnVuY3MtPnBvc3RfZGlzYWJs
ZSkKLQkJYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7Ci0KLQlkcm1fYnJpZGdl
X2NoYWluX3Bvc3RfZGlzYWJsZShicmlkZ2UtPm5leHQpOworCWVuY29kZXIgPSBicmlkZ2UtPmVu
Y29kZXI7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9mcm9tKGJyaWRnZSwgJmVuY29kZXItPmJyaWRn
ZV9jaGFpbiwgY2hhaW5fbm9kZSkgeworCQlpZiAoYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxl
KQorCQkJYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7CisJfQogfQogRVhQT1JU
X1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX3Bvc3RfZGlzYWJsZSk7CiAKQEAgLTMwMCwxMyArMzIx
LDE2IEBAIHZvaWQgZHJtX2JyaWRnZV9jaGFpbl9tb2RlX3NldChzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlLAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAog
CQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKQog
eworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwogCWlmICghYnJpZGdlKQogCQlyZXR1
cm47CiAKLQlpZiAoYnJpZGdlLT5mdW5jcy0+bW9kZV9zZXQpCi0JCWJyaWRnZS0+ZnVuY3MtPm1v
ZGVfc2V0KGJyaWRnZSwgbW9kZSwgYWRqdXN0ZWRfbW9kZSk7Ci0KLQlkcm1fYnJpZGdlX2NoYWlu
X21vZGVfc2V0KGJyaWRnZS0+bmV4dCwgbW9kZSwgYWRqdXN0ZWRfbW9kZSk7CisJZW5jb2RlciA9
IGJyaWRnZS0+ZW5jb2RlcjsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zyb20oYnJpZGdlLCAmZW5j
b2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7CisJCWlmIChicmlkZ2UtPmZ1bmNzLT5t
b2RlX3NldCkKKwkJCWJyaWRnZS0+ZnVuY3MtPm1vZGVfc2V0KGJyaWRnZSwgbW9kZSwgYWRqdXN0
ZWRfbW9kZSk7CisJfQogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX21vZGVfc2V0
KTsKIApAQCAtMzIzLDEzICszNDcsMTcgQEAgRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWlu
X21vZGVfc2V0KTsKICAqLwogdm9pZCBkcm1fYnJpZGdlX2NoYWluX3ByZV9lbmFibGUoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSkKIHsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisJ
c3RydWN0IGRybV9icmlkZ2UgKml0ZXI7CisKIAlpZiAoIWJyaWRnZSkKIAkJcmV0dXJuOwogCi0J
ZHJtX2JyaWRnZV9jaGFpbl9wcmVfZW5hYmxlKGJyaWRnZS0+bmV4dCk7Ci0KLQlpZiAoYnJpZGdl
LT5mdW5jcy0+cHJlX2VuYWJsZSkKLQkJYnJpZGdlLT5mdW5jcy0+cHJlX2VuYWJsZShicmlkZ2Up
OworCWVuY29kZXIgPSBicmlkZ2UtPmVuY29kZXI7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9yZXZl
cnNlKGl0ZXIsICZlbmNvZGVyLT5icmlkZ2VfY2hhaW4sIGNoYWluX25vZGUpIHsKKwkJaWYgKGl0
ZXItPmZ1bmNzLT5wcmVfZW5hYmxlKQorCQkJaXRlci0+ZnVuY3MtPnByZV9lbmFibGUoaXRlcik7
CisJfQogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX3ByZV9lbmFibGUpOwogCkBA
IC0zNDUsMTMgKzM3MywxNiBAQCBFWFBPUlRfU1lNQk9MKGRybV9icmlkZ2VfY2hhaW5fcHJlX2Vu
YWJsZSk7CiAgKi8KIHZvaWQgZHJtX2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSkKIHsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisKIAlpZiAoIWJy
aWRnZSkKIAkJcmV0dXJuOwogCi0JaWYgKGJyaWRnZS0+ZnVuY3MtPmVuYWJsZSkKLQkJYnJpZGdl
LT5mdW5jcy0+ZW5hYmxlKGJyaWRnZSk7Ci0KLQlkcm1fYnJpZGdlX2NoYWluX2VuYWJsZShicmlk
Z2UtPm5leHQpOworCWVuY29kZXIgPSBicmlkZ2UtPmVuY29kZXI7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9mcm9tKGJyaWRnZSwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwgY2hhaW5fbm9kZSkgewor
CQlpZiAoYnJpZGdlLT5mdW5jcy0+ZW5hYmxlKQorCQkJYnJpZGdlLT5mdW5jcy0+ZW5hYmxlKGJy
aWRnZSk7CisJfQogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2NoYWluX2VuYWJsZSk7CiAK
QEAgLTM3MCwxNSArNDAxLDIyIEBAIEVYUE9SVF9TWU1CT0woZHJtX2JyaWRnZV9jaGFpbl9lbmFi
bGUpOwogdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9kaXNhYmxlKHN0cnVjdCBkcm1fYnJp
ZGdlICpicmlkZ2UsCiAJCQkJICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7
CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCXN0cnVjdCBkcm1fYnJpZGdlICppdGVy
OworCiAJaWYgKCFicmlkZ2UpCiAJCXJldHVybjsKIAotCWRybV9hdG9taWNfYnJpZGdlX2NoYWlu
X2Rpc2FibGUoYnJpZGdlLT5uZXh0LCBzdGF0ZSk7CisJZW5jb2RlciA9IGJyaWRnZS0+ZW5jb2Rl
cjsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3JldmVyc2UoaXRlciwgJmVuY29kZXItPmJyaWRnZV9j
aGFpbiwgY2hhaW5fbm9kZSkgeworCQlpZiAoaXRlci0+ZnVuY3MtPmF0b21pY19kaXNhYmxlKQor
CQkJaXRlci0+ZnVuY3MtPmF0b21pY19kaXNhYmxlKGl0ZXIsIHN0YXRlKTsKKwkJZWxzZSBpZiAo
aXRlci0+ZnVuY3MtPmRpc2FibGUpCisJCQlpdGVyLT5mdW5jcy0+ZGlzYWJsZShpdGVyKTsKIAot
CWlmIChicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZGlzYWJsZSkKLQkJYnJpZGdlLT5mdW5jcy0+YXRv
bWljX2Rpc2FibGUoYnJpZGdlLCBzdGF0ZSk7Ci0JZWxzZSBpZiAoYnJpZGdlLT5mdW5jcy0+ZGlz
YWJsZSkKLQkJYnJpZGdlLT5mdW5jcy0+ZGlzYWJsZShicmlkZ2UpOworCQlpZiAoaXRlciA9PSBi
cmlkZ2UpCisJCQlicmVhazsKKwl9CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdl
X2NoYWluX2Rpc2FibGUpOwogCkBAIC0zOTgsMTUgKzQzNiwxOCBAQCBFWFBPUlRfU1lNQk9MKGRy
bV9hdG9taWNfYnJpZGdlX2NoYWluX2Rpc2FibGUpOwogdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9j
aGFpbl9wb3N0X2Rpc2FibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkJICBzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNv
ZGVyOworCiAJaWYgKCFicmlkZ2UpCiAJCXJldHVybjsKIAotCWlmIChicmlkZ2UtPmZ1bmNzLT5h
dG9taWNfcG9zdF9kaXNhYmxlKQotCQlicmlkZ2UtPmZ1bmNzLT5hdG9taWNfcG9zdF9kaXNhYmxl
KGJyaWRnZSwgc3RhdGUpOwotCWVsc2UgaWYgKGJyaWRnZS0+ZnVuY3MtPnBvc3RfZGlzYWJsZSkK
LQkJYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7Ci0KLQlkcm1fYXRvbWljX2Jy
aWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoYnJpZGdlLT5uZXh0LCBzdGF0ZSk7CisJZW5jb2RlciA9
IGJyaWRnZS0+ZW5jb2RlcjsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zyb20oYnJpZGdlLCAmZW5j
b2Rlci0+YnJpZGdlX2NoYWluLCBjaGFpbl9ub2RlKSB7CisJCWlmIChicmlkZ2UtPmZ1bmNzLT5h
dG9taWNfcG9zdF9kaXNhYmxlKQorCQkJYnJpZGdlLT5mdW5jcy0+YXRvbWljX3Bvc3RfZGlzYWJs
ZShicmlkZ2UsIHN0YXRlKTsKKwkJZWxzZSBpZiAoYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxl
KQorCQkJYnJpZGdlLT5mdW5jcy0+cG9zdF9kaXNhYmxlKGJyaWRnZSk7CisJfQogfQogRVhQT1JU
X1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUpOwogCkBAIC00MjYs
MTUgKzQ2NywyMiBAQCBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJpZGdlX2NoYWluX3Bvc3Rf
ZGlzYWJsZSk7CiB2b2lkIGRybV9hdG9taWNfYnJpZGdlX2NoYWluX3ByZV9lbmFibGUoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
KQogeworCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAq
aXRlcjsKKwogCWlmICghYnJpZGdlKQogCQlyZXR1cm47CiAKLQlkcm1fYXRvbWljX2JyaWRnZV9j
aGFpbl9wcmVfZW5hYmxlKGJyaWRnZS0+bmV4dCwgc3RhdGUpOworCWVuY29kZXIgPSBicmlkZ2Ut
PmVuY29kZXI7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9yZXZlcnNlKGl0ZXIsICZlbmNvZGVyLT5i
cmlkZ2VfY2hhaW4sIGNoYWluX25vZGUpIHsKKwkJaWYgKGl0ZXItPmZ1bmNzLT5hdG9taWNfcHJl
X2VuYWJsZSkKKwkJCWl0ZXItPmZ1bmNzLT5hdG9taWNfcHJlX2VuYWJsZShpdGVyLCBzdGF0ZSk7
CisJCWVsc2UgaWYgKGl0ZXItPmZ1bmNzLT5wcmVfZW5hYmxlKQorCQkJaXRlci0+ZnVuY3MtPnBy
ZV9lbmFibGUoaXRlcik7CiAKLQlpZiAoYnJpZGdlLT5mdW5jcy0+YXRvbWljX3ByZV9lbmFibGUp
Ci0JCWJyaWRnZS0+ZnVuY3MtPmF0b21pY19wcmVfZW5hYmxlKGJyaWRnZSwgc3RhdGUpOwotCWVs
c2UgaWYgKGJyaWRnZS0+ZnVuY3MtPnByZV9lbmFibGUpCi0JCWJyaWRnZS0+ZnVuY3MtPnByZV9l
bmFibGUoYnJpZGdlKTsKKwkJaWYgKGl0ZXIgPT0gYnJpZGdlKQorCQkJYnJlYWs7CisJfQogfQog
RVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wcmVfZW5hYmxlKTsKIApAQCAt
NDUzLDE1ICs1MDEsMTggQEAgRVhQT1JUX1NZTUJPTChkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9w
cmVfZW5hYmxlKTsKIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKHN0cnVjdCBk
cm1fYnJpZGdlICpicmlkZ2UsCiAJCQkJICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZSkKIHsKKwlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisKIAlpZiAoIWJyaWRnZSkKIAkJ
cmV0dXJuOwogCi0JaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19lbmFibGUpCi0JCWJyaWRnZS0+
ZnVuY3MtPmF0b21pY19lbmFibGUoYnJpZGdlLCBzdGF0ZSk7Ci0JZWxzZSBpZiAoYnJpZGdlLT5m
dW5jcy0+ZW5hYmxlKQotCQlicmlkZ2UtPmZ1bmNzLT5lbmFibGUoYnJpZGdlKTsKLQotCWRybV9h
dG9taWNfYnJpZGdlX2NoYWluX2VuYWJsZShicmlkZ2UtPm5leHQsIHN0YXRlKTsKKwllbmNvZGVy
ID0gYnJpZGdlLT5lbmNvZGVyOworCWxpc3RfZm9yX2VhY2hfZW50cnlfZnJvbShicmlkZ2UsICZl
bmNvZGVyLT5icmlkZ2VfY2hhaW4sIGNoYWluX25vZGUpIHsKKwkJaWYgKGJyaWRnZS0+ZnVuY3Mt
PmF0b21pY19lbmFibGUpCisJCQlicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZW5hYmxlKGJyaWRnZSwg
c3RhdGUpOworCQllbHNlIGlmIChicmlkZ2UtPmZ1bmNzLT5lbmFibGUpCisJCQlicmlkZ2UtPmZ1
bmNzLT5lbmFibGUoYnJpZGdlKTsKKwl9CiB9CiBFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYnJp
ZGdlX2NoYWluX2VuYWJsZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZW5j
b2Rlci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9lbmNvZGVyLmMKaW5kZXggYTJjYzdlNzI0MWE5
Li5lNTU1MjgxZjQzZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZW5jb2Rlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZW5jb2Rlci5jCkBAIC0xNDAsNiArMTQwLDcgQEAg
aW50IGRybV9lbmNvZGVyX2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJZ290byBvdXRf
cHV0OwogCX0KIAorCUlOSVRfTElTVF9IRUFEKCZlbmNvZGVyLT5icmlkZ2VfY2hhaW4pOwogCWxp
c3RfYWRkX3RhaWwoJmVuY29kZXItPmhlYWQsICZkZXYtPm1vZGVfY29uZmlnLmVuY29kZXJfbGlz
dCk7CiAJZW5jb2Rlci0+aW5kZXggPSBkZXYtPm1vZGVfY29uZmlnLm51bV9lbmNvZGVyKys7CiAK
QEAgLTE2MCwyMyArMTYxLDE2IEBAIEVYUE9SVF9TWU1CT0woZHJtX2VuY29kZXJfaW5pdCk7CiB2
b2lkIGRybV9lbmNvZGVyX2NsZWFudXAoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQogewog
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5kZXY7CisJc3RydWN0IGRybV9icmlk
Z2UgKmJyaWRnZSwgKm5leHQ7CiAKIAkvKiBOb3RlIHRoYXQgdGhlIGVuY29kZXJfbGlzdCBpcyBj
b25zaWRlcmVkIHRvIGJlIHN0YXRpYzsgc2hvdWxkIHdlCiAJICogcmVtb3ZlIHRoZSBkcm1fZW5j
b2RlciBhdCBydW50aW1lIHdlIHdvdWxkIGhhdmUgdG8gZGVjcmVtZW50IGFsbAogCSAqIHRoZSBp
bmRpY2VzIG9uIHRoZSBkcm1fZW5jb2RlciBhZnRlciB1cyBpbiB0aGUgZW5jb2Rlcl9saXN0Lgog
CSAqLwogCi0JaWYgKGVuY29kZXItPmJyaWRnZSkgewotCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJp
ZGdlOwotCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqbmV4dDsKLQotCQlicmlkZ2UgPSBkcm1fYnJpZGdl
X2NoYWluX2dldF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7Ci0JCXdoaWxlIChicmlkZ2UpIHsKLQkJ
CW5leHQgPSBkcm1fYnJpZGdlX2dldF9uZXh0X2JyaWRnZShicmlkZ2UpOwotCQkJZHJtX2JyaWRn
ZV9kZXRhY2goYnJpZGdlKTsKLQkJCWJyaWRnZSA9IG5leHQ7Ci0JCX0KLQl9CisJbGlzdF9mb3Jf
ZWFjaF9lbnRyeV9zYWZlKGJyaWRnZSwgbmV4dCwgJmVuY29kZXItPmJyaWRnZV9jaGFpbiwKKwkJ
CQkgY2hhaW5fbm9kZSkKKwkJZHJtX2JyaWRnZV9kZXRhY2goYnJpZGdlKTsKIAogCWRybV9tb2Rl
X29iamVjdF91bnJlZ2lzdGVyKGRldiwgJmVuY29kZXItPmJhc2UpOwogCWtmcmVlKGVuY29kZXIt
Pm5hbWUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2V4eW5vcy9leHlub3NfZHJtX2Rz
aS5jIGIvZHJpdmVycy9ncHUvZHJtL2V4eW5vcy9leHlub3NfZHJtX2RzaS5jCmluZGV4IGQ5ODQw
OTc3MDRiOC4uN2RlODJlMjIyNTJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZXh5bm9z
L2V4eW5vc19kcm1fZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2V4eW5vcy9leHlub3NfZHJt
X2RzaS5jCkBAIC0yNTUsNiArMjU1LDcgQEAgc3RydWN0IGV4eW5vc19kc2kgewogCXN0cnVjdCBt
aXBpX2RzaV9ob3N0IGRzaV9ob3N0OwogCXN0cnVjdCBkcm1fY29ubmVjdG9yIGNvbm5lY3RvcjsK
IAlzdHJ1Y3QgZHJtX3BhbmVsICpwYW5lbDsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGJyaWRnZV9jaGFp
bjsKIAlzdHJ1Y3QgZHJtX2JyaWRnZSAqb3V0X2JyaWRnZTsKIAlzdHJ1Y3QgZGV2aWNlICpkZXY7
CiAKQEAgLTE1MjIsNyArMTUyMyw3IEBAIHN0YXRpYyBpbnQgZXh5bm9zX2RzaV9ob3N0X2F0dGFj
aChzdHJ1Y3QgbWlwaV9kc2lfaG9zdCAqaG9zdCwKIAlpZiAob3V0X2JyaWRnZSkgewogCQlkcm1f
YnJpZGdlX2F0dGFjaChlbmNvZGVyLCBvdXRfYnJpZGdlLCBOVUxMKTsKIAkJZHNpLT5vdXRfYnJp
ZGdlID0gb3V0X2JyaWRnZTsKLQkJZW5jb2Rlci0+YnJpZGdlID0gTlVMTDsKKwkJbGlzdF9zcGxp
Y2UoJmVuY29kZXItPmJyaWRnZV9jaGFpbiwgJmRzaS0+YnJpZGdlX2NoYWluKTsKIAl9IGVsc2Ug
ewogCQlpbnQgcmV0ID0gZXh5bm9zX2RzaV9jcmVhdGVfY29ubmVjdG9yKGVuY29kZXIpOwogCkBA
IC0xNTg4LDYgKzE1ODksNyBAQCBzdGF0aWMgaW50IGV4eW5vc19kc2lfaG9zdF9kZXRhY2goc3Ry
dWN0IG1pcGlfZHNpX2hvc3QgKmhvc3QsCiAJCWlmIChkc2ktPm91dF9icmlkZ2UtPmZ1bmNzLT5k
ZXRhY2gpCiAJCQlkc2ktPm91dF9icmlkZ2UtPmZ1bmNzLT5kZXRhY2goZHNpLT5vdXRfYnJpZGdl
KTsKIAkJZHNpLT5vdXRfYnJpZGdlID0gTlVMTDsKKwkJSU5JVF9MSVNUX0hFQUQoJmRzaS0+YnJp
ZGdlX2NoYWluKTsKIAl9CiAKIAlpZiAoZHJtLT5tb2RlX2NvbmZpZy5wb2xsX2VuYWJsZWQpCkBA
IC0xNzM1LDYgKzE3MzcsNyBAQCBzdGF0aWMgaW50IGV4eW5vc19kc2lfcHJvYmUoc3RydWN0IHBs
YXRmb3JtX2RldmljZSAqcGRldikKIAlpbml0X2NvbXBsZXRpb24oJmRzaS0+Y29tcGxldGVkKTsK
IAlzcGluX2xvY2tfaW5pdCgmZHNpLT50cmFuc2Zlcl9sb2NrKTsKIAlJTklUX0xJU1RfSEVBRCgm
ZHNpLT50cmFuc2Zlcl9saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmZHNpLT5icmlkZ2VfY2hhaW4p
OwogCiAJZHNpLT5kc2lfaG9zdC5vcHMgPSAmZXh5bm9zX2RzaV9vcHM7CiAJZHNpLT5kc2lfaG9z
dC5kZXYgPSBkZXY7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYyBi
L2RyaXZlcnMvZ3B1L2RybS92YzQvdmM0X2RzaS5jCmluZGV4IGZmODFiNTRlYTI4MS4uNmM1Yjgw
YWQ2MTU0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdmM0L3ZjNF9kc2kuYwpAQCAtNDk5LDYgKzQ5OSw3IEBAIHN0cnVjdCB2
YzRfZHNpIHsKIAlzdHJ1Y3QgbWlwaV9kc2lfaG9zdCBkc2lfaG9zdDsKIAlzdHJ1Y3QgZHJtX2Vu
Y29kZXIgKmVuY29kZXI7CiAJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKKwlzdHJ1Y3QgbGlz
dF9oZWFkIGJyaWRnZV9jaGFpbjsKIAogCXZvaWQgX19pb21lbSAqcmVnczsKIApAQCAtMTQ2MCw2
ICsxNDYxLDggQEAgc3RhdGljIGludCB2YzRfZHNpX2JpbmQoc3RydWN0IGRldmljZSAqZGV2LCBz
dHJ1Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiAJCQkJICAgICAgIEdGUF9LRVJORUwp
OwogCWlmICghdmM0X2RzaV9lbmNvZGVyKQogCQlyZXR1cm4gLUVOT01FTTsKKworCUlOSVRfTElT
VF9IRUFEKCZkc2ktPmJyaWRnZV9jaGFpbik7CiAJdmM0X2RzaV9lbmNvZGVyLT5iYXNlLnR5cGUg
PSBWQzRfRU5DT0RFUl9UWVBFX0RTSTE7CiAJdmM0X2RzaV9lbmNvZGVyLT5kc2kgPSBkc2k7CiAJ
ZHNpLT5lbmNvZGVyID0gJnZjNF9kc2lfZW5jb2Rlci0+YmFzZS5iYXNlOwpAQCAtMTYxMCw3ICsx
NjEzLDcgQEAgc3RhdGljIGludCB2YzRfZHNpX2JpbmQoc3RydWN0IGRldmljZSAqZGV2LCBzdHJ1
Y3QgZGV2aWNlICptYXN0ZXIsIHZvaWQgKmRhdGEpCiAJICogZnJvbSBvdXIgZHJpdmVyLCBzaW5j
ZSB3ZSBuZWVkIHRvIHNlcXVlbmNlIHRoZW0gd2l0aGluIHRoZQogCSAqIGVuY29kZXIncyBlbmFi
bGUvZGlzYWJsZSBwYXRocy4KIAkgKi8KLQlkc2ktPmVuY29kZXItPmJyaWRnZSA9IE5VTEw7CisJ
bGlzdF9zcGxpY2UoJmRzaS0+ZW5jb2Rlci0+YnJpZGdlX2NoYWluLCAmZHNpLT5icmlkZ2VfY2hh
aW4pOwogCiAJaWYgKGRzaS0+cG9ydCA9PSAwKQogCQl2YzRfZGVidWdmc19hZGRfcmVnc2V0MzIo
ZHJtLCAiZHNpMF9yZWdzIiwgJmRzaS0+cmVnc2V0KTsKQEAgLTE2MzIsNiArMTYzNSwxMSBAQCBz
dGF0aWMgdm9pZCB2YzRfZHNpX3VuYmluZChzdHJ1Y3QgZGV2aWNlICpkZXYsIHN0cnVjdCBkZXZp
Y2UgKm1hc3RlciwKIAlpZiAoZHNpLT5icmlkZ2UpCiAJCXBtX3J1bnRpbWVfZGlzYWJsZShkZXYp
OwogCisJLyoKKwkgKiBSZXN0b3JlIHRoZSBicmlkZ2VfY2hhaW4gc28gdGhlIGJyaWRnZSBkZXRh
Y2ggcHJvY2VkdXJlIGNhbiBoYXBwZW4KKwkgKiBub3JtYWxseS4KKwkgKi8KKwlsaXN0X3NwbGlj
ZSgmZHNpLT5icmlkZ2VfY2hhaW4sICZkc2ktPmVuY29kZXItPmJyaWRnZV9jaGFpbik7CiAJdmM0
X2RzaV9lbmNvZGVyX2Rlc3Ryb3koZHNpLT5lbmNvZGVyKTsKIAogCWlmIChkc2ktPnBvcnQgPT0g
MSkKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaCBiL2luY2x1ZGUvZHJtL2Ry
bV9icmlkZ2UuaAppbmRleCBiZDc4YzI1NmIxZWQuLmMxMTg3MjY0NjllZSAxMDA2NDQKLS0tIGEv
aW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9icmlkZ2UuaApA
QCAtMzg0LDggKzM4NCw4IEBAIHN0cnVjdCBkcm1fYnJpZGdlIHsKIAlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2OwogCS8qKiBAZW5jb2RlcjogZW5jb2RlciB0byB3aGljaCB0aGlzIGJyaWRnZSBpcyBj
b25uZWN0ZWQgKi8KIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0JLyoqIEBuZXh0OiB0
aGUgbmV4dCBicmlkZ2UgaW4gdGhlIGVuY29kZXIgY2hhaW4gKi8KLQlzdHJ1Y3QgZHJtX2JyaWRn
ZSAqbmV4dDsKKwkvKiogQGNoYWluX25vZGU6IHVzZWQgdG8gZm9ybSBhIGJyaWRnZSBjaGFpbiAq
LworCXN0cnVjdCBsaXN0X2hlYWQgY2hhaW5fbm9kZTsKICNpZmRlZiBDT05GSUdfT0YKIAkvKiog
QG9mX25vZGU6IGRldmljZSBub2RlIHBvaW50ZXIgdG8gdGhlIGJyaWRnZSAqLwogCXN0cnVjdCBk
ZXZpY2Vfbm9kZSAqb2Zfbm9kZTsKQEAgLTQyMCw3ICs0MjAsMTAgQEAgaW50IGRybV9icmlkZ2Vf
YXR0YWNoKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSwKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9icmlkZ2UgKgogZHJtX2JyaWRnZV9nZXRf
bmV4dF9icmlkZ2Uoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKIHsKLQlyZXR1cm4gYnJpZGdl
LT5uZXh0OworCWlmIChsaXN0X2lzX2xhc3QoJmJyaWRnZS0+Y2hhaW5fbm9kZSwgJmJyaWRnZS0+
ZW5jb2Rlci0+YnJpZGdlX2NoYWluKSkKKwkJcmV0dXJuIE5VTEw7CisKKwlyZXR1cm4gbGlzdF9u
ZXh0X2VudHJ5KGJyaWRnZSwgY2hhaW5fbm9kZSk7CiB9CiAKIC8qKgpAQCAtNDM0LDcgKzQzNyw4
IEBAIGRybV9icmlkZ2VfZ2V0X25leHRfYnJpZGdlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2Up
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlICoKIGRybV9icmlkZ2VfY2hhaW5fZ2V0
X2ZpcnN0X2JyaWRnZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0JcmV0dXJuIGVu
Y29kZXItPmJyaWRnZTsKKwlyZXR1cm4gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZlbmNvZGVy
LT5icmlkZ2VfY2hhaW4sCisJCQkJCXN0cnVjdCBkcm1fYnJpZGdlLCBjaGFpbl9ub2RlKTsKIH0K
IAogYm9vbCBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoc3RydWN0IGRybV9icmlkZ2UgKmJy
aWRnZSwKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9lbmNvZGVyLmggYi9pbmNsdWRlL2Ry
bS9kcm1fZW5jb2Rlci5oCmluZGV4IGYwNjE2NGY0NGVmZS4uNTYyMzk5NGI2ZTllIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2RybS9kcm1fZW5jb2Rlci5oCisrKyBiL2luY2x1ZGUvZHJtL2RybV9lbmNv
ZGVyLmgKQEAgLTE3Miw3ICsxNzIsMTIgQEAgc3RydWN0IGRybV9lbmNvZGVyIHsKIAkgKiAmZHJt
X2Nvbm5lY3Rvcl9zdGF0ZS5jcnRjLgogCSAqLwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKLQlz
dHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOworCisJLyoqCisJICogQGJyaWRnZV9jaGFpbjogQnJp
ZGdlcyBhdHRhY2hlZCB0byB0aGlzIGVuY29kZXIuCisJICovCisJc3RydWN0IGxpc3RfaGVhZCBi
cmlkZ2VfY2hhaW47CisKIAljb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfZnVuY3MgKmZ1bmNzOwog
CWNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MgKmhlbHBlcl9wcml2YXRlOwog
fTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRl
dmVs
