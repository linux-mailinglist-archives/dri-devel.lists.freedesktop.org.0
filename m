Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5EBAB1169F6
	for <lists+dri-devel@lfdr.de>; Mon,  9 Dec 2019 10:47:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A6A726E366;
	Mon,  9 Dec 2019 09:46:41 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from NAM11-DM6-obe.outbound.protection.outlook.com
 (mail-dm6nam11on2115.outbound.protection.outlook.com [40.107.223.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 64F916E32F
 for <dri-devel@lists.freedesktop.org>; Mon,  9 Dec 2019 07:58:25 +0000 (UTC)
ARC-Seal: i=1; a=rsa-sha256; s=arcselector9901; d=microsoft.com; cv=none;
 b=VRjxIcvyJRBy+GBf7lRBh+9UfEaY0djRYX9dpzb1UtzbIBCgWAjdd9s72bYVX8jVect4Esyefn8/RAXKAS33jMenzEGeKE8nzmb+rujk3MLMzfZ0O7xULGl9OG0TzsQ8znvStvnaGChhemS7aFaMfy603dQL86hchm1mLC0wKIbEEVEPYpFY8QH11fPUnKNQ/wqrBGq33WLNXe8tdVQkG9E8SiQDAwniJLK2hrZVGZruhfdez3fPv1nlSBhzsjCuYcVrq4I8GUJ85gpRSf6yplPg2vitW9lqdeSGVAqJA2EQxjwT+Bmb8wg3C1tT5dClynem4xTq0GdSYt9Ub6+VBg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=microsoft.com; 
 s=arcselector9901;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4BkJSX1bBr/crL0DNKoOlEz0PTUDpNlHg4lLKcu/MoE=;
 b=Evnjo8PJvTN6xY6OysyPX5wxLA4stlFoBnuJk1sIxLApPLlwz7f2qfZZd+kZE7I+LlkBL3LglIZtRS/Et7eFHmIH1n2E5JYZ0QO9UbGGQCQiWsc2Q7vV+NkFRRKk9NVNnDQpvCvatqgbgHQ7OxnqNYBEVcm9FJFskKAX6pg7jo1dwZ0GGebGfQdWmENK3L8XnRaD21zwRD9czwXmemGMfGS8JBQl1U0vbTGCaUKwPrIr+mgpU6JsiYdpmMRzV0lZB9Fe/zdz6AnKvypXvsKjJZcxIlKU/NsOsd4AFbWW7G9VVwW/LIdX0+j6w/Qzw7K0FuHwZe3p3cNL73/0WSCyJw==
ARC-Authentication-Results: i=1; mx.microsoft.com 1; spf=pass
 smtp.mailfrom=microsoft.com; dmarc=pass action=none
 header.from=microsoft.com; dkim=pass header.d=microsoft.com; arc=none
Received: from BYAPR21MB1285.namprd21.prod.outlook.com (20.179.58.22) by
 BYAPR21MB1208.namprd21.prod.outlook.com (20.179.57.18) with Microsoft SMTP
 Server (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id
 15.20.2559.6; Mon, 9 Dec 2019 07:58:23 +0000
Received: from BYAPR21MB1285.namprd21.prod.outlook.com
 ([fe80::2937:4548:f0b3:fe32]) by BYAPR21MB1285.namprd21.prod.outlook.com
 ([fe80::2937:4548:f0b3:fe32%10]) with mapi id 15.20.2538.000; Mon, 9 Dec 2019
 07:58:22 +0000
From: Wei Hu <weh@microsoft.com>
To: b.zolnierkie@samsung.com, kys@microsoft.com, haiyangz@microsoft.com,
 sthemmin@microsoft.com, sashal@kernel.org, hch@lst.de,
 m.szyprowski@samsung.com, mchehab+samsung@kernel.org, sam@ravnborg.org,
 gregkh@linuxfoundation.org, alexandre.belloni@bootlin.com, info@metux.net,
 arnd@arndb.de, dri-devel@lists.freedesktop.org,
 linux-fbdev@vger.kernel.org, linux-kernel@vger.kernel.org,
 linux-hyperv@vger.kernel.org, decui@microsoft.com, mikelley@microsoft.com
Subject: [PATCH v4] video: hyperv: hyperv_fb: Use physical memory for fb on
 HyperV Gen 1 VMs.
Date: Mon,  9 Dec 2019 15:57:49 +0800
Message-Id: <20191209075749.3804-1-weh@microsoft.com>
X-Mailer: git-send-email 2.20.1
X-ClientProxiedBy: SG2PR01CA0164.apcprd01.prod.exchangelabs.com
 (2603:1096:4:28::20) To BYAPR21MB1285.namprd21.prod.outlook.com
 (2603:10b6:a03:10a::22)
MIME-Version: 1.0
Received: from weh-g1-u1904d-testwin10.corp.microsoft.com (167.220.255.49) by
 SG2PR01CA0164.apcprd01.prod.exchangelabs.com (2603:1096:4:28::20) with
 Microsoft SMTP Server (version=TLS1_2, cipher=) via Frontend Transport;
 Mon, 9 Dec 2019 07:58:16 +0000
X-Mailer: git-send-email 2.20.1
X-Originating-IP: [167.220.255.49]
X-MS-PublicTrafficType: Email
X-MS-Office365-Filtering-HT: Tenant
X-MS-Office365-Filtering-Correlation-Id: e86cf3e3-68db-467c-e3ea-08d77c7d8f84
X-MS-TrafficTypeDiagnostic: BYAPR21MB1208:|BYAPR21MB1208:
X-MS-Exchange-Transport-Forked: True
X-Microsoft-Antispam-PRVS: <BYAPR21MB12082932B1BEF70DEB6C272CBB580@BYAPR21MB1208.namprd21.prod.outlook.com>
X-MS-Oob-TLC-OOBClassifiers: OLM:3826;
X-Forefront-PRVS: 02462830BE
X-Forefront-Antispam-Report: SFV:NSPM;
 SFS:(10019020)(376002)(346002)(396003)(39860400002)(366004)(136003)(199004)(189003)(50226002)(8936002)(52116002)(7416002)(51416003)(7696005)(10090500001)(10290500003)(2870700001)(50466002)(48376002)(66556008)(66476007)(54906003)(66946007)(6486002)(5660300002)(305945005)(956004)(8676002)(36756003)(2616005)(81166006)(81156014)(26005)(316002)(478600001)(3450700001)(2906002)(4326008)(1250700005)(43066004)(16526019)(6636002)(186003)(6666004)(86362001)(1076003)(30864003)(921003)(1121003);
 DIR:OUT; SFP:1102; SCL:1; SRVR:BYAPR21MB1208;
 H:BYAPR21MB1285.namprd21.prod.outlook.com; FPR:; SPF:None; LANG:en;
 PTR:InfoNoRecords; A:1; MX:1; 
Received-SPF: None (protection.outlook.com: microsoft.com does not designate
 permitted sender hosts)
X-MS-Exchange-SenderADCheck: 1
X-Microsoft-Antispam: BCL:0;
X-Microsoft-Antispam-Message-Info: 1bulZ602dnbSz2fhSdCOKVFtGgzCiVthwmNhNmHfk3VvGZpJD3fFRZumslGARrB5LFL1IS9y9fzOpvHwZ3KPYnW+YFHL8BY4kY5tj48TNIaKQQzAyKaYB6tMWmpdl5qSqs9LQUn0+4zGcoPsTLrUg5/U0PrpHFR+64m7XGck/o3nMtsiyPQ0LzgxjFQk0Pwolup/dYpvPBrWo54sZThMplAyCa8JTd745q9QXjq/x1nNa6wdu+Xmv4qXeKZ1L8v+BnYQItfdBbf6MOChbfwixR3V0O1t2UKwMDL5OPnPVOxK5j7/Imt2YpY2E7jD2YadV5W4KUDDT5yDYrXeZpqdILICgYS7hJnnTANwMn1IxMgdrKr1hWlfbjgAS3ZRMfIX3ISLEOQMc6xOry+dnAPY/eLp7gO00BbHcMuXXr6pFIn1JKn7Ky3tXMBrmkJMhAHoqzXR12TTdlBGyftXFgHOuOuG/ooqjEOD/bU48/wwkA9rA+m3S4qzTLp3nx2Vv3c1
X-OriginatorOrg: microsoft.com
X-MS-Exchange-CrossTenant-Network-Message-Id: e86cf3e3-68db-467c-e3ea-08d77c7d8f84
X-MS-Exchange-CrossTenant-OriginalArrivalTime: 09 Dec 2019 07:58:22.1289 (UTC)
X-MS-Exchange-CrossTenant-FromEntityHeader: Hosted
X-MS-Exchange-CrossTenant-Id: 72f988bf-86f1-41af-91ab-2d7cd011db47
X-MS-Exchange-CrossTenant-MailboxType: HOSTED
X-MS-Exchange-CrossTenant-UserPrincipalName: /m2Q/LaU/FigEv0g2My+rOjLr/KELgHAPkgVGpyC51ItfBMA9i1V44hkOGiv8ySJUM4S/mYb/hjj+ZJIbS1X1Q==
X-MS-Exchange-Transport-CrossTenantHeadersStamped: BYAPR21MB1208
X-Mailman-Approved-At: Mon, 09 Dec 2019 09:46:36 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=microsoft.com; s=selector2;
 h=From:Date:Subject:Message-ID:Content-Type:MIME-Version:X-MS-Exchange-SenderADCheck;
 bh=4BkJSX1bBr/crL0DNKoOlEz0PTUDpNlHg4lLKcu/MoE=;
 b=JT6q1BrLi74Zd9HE2uGb+9E+ZbuF8KyuOsJk5MOtUPaLja2z4hqXzXi4ks5fzNg8JqDRHPUdMzgeGH0tiaHZrJgPjaGI4yJ0Ctpp5Ou3f1Cx7snZbWQdEJfCyfb0T4a5offVxpeEF2E7d9ZYhcNVTKejA/2hScMNSK09RjONYfs=
X-Mailman-Original-Authentication-Results: spf=none (sender IP is )
 smtp.mailfrom=weh@microsoft.com; 
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Reply-To: weh@microsoft.com
Cc: Wei Hu <weh@microsoft.com>, kbuild test robot <lkp@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T24gSHlwZXItViwgR2VuZXJhdGlvbiAxIFZNcyBjYW4gZGlyZWN0bHkgdXNlIFZNJ3MgcGh5c2lj
YWwgbWVtb3J5IGZvcgp0aGVpciBmcmFtZWJ1ZmZlcnMuIFRoaXMgY2FuIGltcHJvdmUgdGhlIGVm
ZmljaWVuY3kgb2YgZnJhbWVidWZmZXIgYW5kCm92ZXJhbGwgcGVyZm9ybWVuY2UgZm9yIFZNLiBU
aGUgcGh5c2ljYWwgbWVtb3J5IGFzc2lnbmVkIHRvIGZyYW1lYnVmZmVyCm11c3QgYmUgY29udGln
dW91cy4gV2UgdXNlIENNQSBhbGxvY2F0b3IgdG8gZ2V0IGNvbnRpZ3VvdXNlIHBoeXNpY2lhbApt
ZW1vcnkgd2hlbiB0aGUgZnJhbWVidWZmZXIgc2l6ZSBpcyBncmVhdGVyIHRoYW4gNE1CLiBGb3Ig
c2l6ZSB1bmRlcgo0TUIsIHdlIHVzZSBhbGxvY19wYWdlcyB0byBhY2hpZXZlIHRoaXMuCgpUbyBl
bmFibGUgZnJhbWVidWZmZXIgbWVtb3J5IGFsbG9jYXRpb24gZnJvbSBDTUEsIHN1cHBseSBhIGtl
cm5lbApwYXJhbWV0ZXIgdG8gZ2l2ZSBlbm91Z2ggc3BhY2UgdG8gQ01BIGFsbG9jYXRvciBhdCBi
b290IHRpbWUuIEZvcgpleGFtcGxlOgogICAgY21hPTEzMG0KVGhpcyBnaXZlcyAxMzBNQiBtZW1v
cnkgdG8gQ0FNIGFsbG9jYXRvciB0aGF0IGNhbiBiZSBhbGxvY2F0ZWQgdG8KZnJhbWVidWZmZXIu
IElmIHRoaXMgZmFpbHMsIHdlIGZhbGwgYmFjayB0byB0aGUgb2xkIHdheSBvZiB1c2luZwptbWlv
IGZvciBmcmFtZWJ1ZmZlci4KClJlcG9ydGVkLWJ5OiBrYnVpbGQgdGVzdCByb2JvdCA8bGtwQGlu
dGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogV2VpIEh1IDx3ZWhAbWljcm9zb2Z0LmNvbT4KLS0tCiAg
ICB2MjogSW5jb3Jwb3JhdGVkIHJldmlldyBjb21tZW50cyBmb3JtIGhjaEBsc3QuZGUsIE1pY2hh
ZWwgS2VsbGV5IGFuZAogICAgRGV4dWFuIEN1aQogICAgLSBVc2UgZG1hX2FsbG9jX2NvaGVyZW50
IHRvIGFsbG9jYXRlIGxhcmdlIGNvbnRpZ3VvdXMgbWVtb3J5CiAgICAtIFVzZSBwaHlzX2FkZHJf
dCBmb3IgcGh5c2ljYWwgYWRkcmVzc2VzCiAgICAtIENvcnJlY3RlZCBhIGZldyBzcGVsbGluZyBl
cnJvcnMgYW5kIG1pbm9yIGNsZWFudXBzCiAgICAtIEFsc28gdGVzdGVkIG9uIDMyIGJpdCBVYnVu
dHUgZ3Vlc3QKICAgIHYzOiBGaXhlZCBhIGJ1aWxkIGlzc3VlIHJlcG9ydGVkIGJ5IGtidWlsZCB0
ZXN0IHJvYm90IGFuZCBpbmNvcnBvcnRlZAogICAgc29tZSByZXZpZXcgY29tbWVudHMgZnJvbSBN
aWNoYWVsIEtlbGxleQogICAgLSBBZGQgQ01BIGNoZWNrIHRvIGF2b2lkIGxpbmsgZmFpbHVyZQog
ICAgLSBGaXhlZCBzbWFsbCBtZW1vcnkgbGVhayBpbnRyb2R1Y2VkIGJ5IGFsbG9jX2FwZXJ0dXJl
cwogICAgLSBDbGVhbmVkIHVwIHNvIGNvZGUKICAgIHY0OiBSZW1vdmVkIHJlcXVlc3RfcGFnZXMg
dmFyaWFibGUgYXMgaXQgaXMgbm8gbG9uZ2VyIG5lZWRlZAoKIGRyaXZlcnMvdmlkZW8vZmJkZXYv
S2NvbmZpZyAgICAgfCAgIDEgKwogZHJpdmVycy92aWRlby9mYmRldi9oeXBlcnZfZmIuYyB8IDE4
MiArKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxNDQg
aW5zZXJ0aW9ucygrKSwgMzkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy92aWRl
by9mYmRldi9LY29uZmlnIGIvZHJpdmVycy92aWRlby9mYmRldi9LY29uZmlnCmluZGV4IGFhOTU0
MWJmOTY0Yi4uZjY1OTkxYTY3YWYyIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L0tj
b25maWcKKysrIGIvZHJpdmVycy92aWRlby9mYmRldi9LY29uZmlnCkBAIC0yMjE1LDYgKzIyMTUs
NyBAQCBjb25maWcgRkJfSFlQRVJWCiAJc2VsZWN0IEZCX0NGQl9DT1BZQVJFQQogCXNlbGVjdCBG
Ql9DRkJfSU1BR0VCTElUCiAJc2VsZWN0IEZCX0RFRkVSUkVEX0lPCisJc2VsZWN0IERNQV9DTUEg
aWYgSEFWRV9ETUFfQ09OVElHVU9VUyAmJiBDTUEKIAloZWxwCiAJICBUaGlzIGZyYW1lYnVmZmVy
IGRyaXZlciBzdXBwb3J0cyBNaWNyb3NvZnQgSHlwZXItViBTeW50aGV0aWMgVmlkZW8uCiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvdmlkZW8vZmJkZXYvaHlwZXJ2X2ZiLmMgYi9kcml2ZXJzL3ZpZGVv
L2ZiZGV2L2h5cGVydl9mYi5jCmluZGV4IDNmNjBiN2JjODU4OS4uYzE1Y2UyYTAwODg2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL3ZpZGVvL2ZiZGV2L2h5cGVydl9mYi5jCisrKyBiL2RyaXZlcnMvdmlk
ZW8vZmJkZXYvaHlwZXJ2X2ZiLmMKQEAgLTMxLDYgKzMxLDE2IEBACiAgKiAic2V0LXZtdmlkZW8i
IGNvbW1hbmQuIEZvciBleGFtcGxlCiAgKiAgICAgc2V0LXZtdmlkZW8gLXZtbmFtZSBuYW1lIC1o
b3Jpem9udGFscmVzb2x1dGlvbjoxOTIwIFwKICAqIC12ZXJ0aWNhbHJlc29sdXRpb246MTIwMCAt
cmVzb2x1dGlvbnR5cGUgc2luZ2xlCisgKgorICogR2VuIDEgVk1zIGFsc28gc3VwcG9ydCBkaXJl
Y3QgdXNpbmcgVk0ncyBwaHlzaWNhbCBtZW1vcnkgZm9yIGZyYW1lYnVmZmVyLgorICogSXQgY291
bGQgaW1wcm92ZSB0aGUgZWZmaWNpZW5jeSBhbmQgcGVyZm9ybWFuY2UgZm9yIGZyYW1lYnVmZmVy
IGFuZCBWTS4KKyAqIFRoaXMgcmVxdWlyZXMgdG8gYWxsb2NhdGUgY29udGlndW91cyBwaHlzaWNh
bCBtZW1vcnkgZnJvbSBMaW51eCBrZXJuZWwncworICogQ01BIG1lbW9yeSBhbGxvY2F0b3IuIFRv
IGVuYWJsZSB0aGlzLCBzdXBwbHkgYSBrZXJuZWwgcGFyYW1ldGVyIHRvIGdpdmUKKyAqIGVub3Vn
aCBtZW1vcnkgc3BhY2UgdG8gQ01BIGFsbG9jYXRvciBmb3IgZnJhbWVidWZmZXIuIEZvciBleGFt
cGxlOgorICogICAgY21hPTEzMG0KKyAqIFRoaXMgZ2l2ZXMgMTMwTUIgbWVtb3J5IHRvIENNQSBh
bGxvY2F0b3IgdGhhdCBjYW4gYmUgYWxsb2NhdGVkIHRvCisgKiBmcmFtZWJ1ZmZlci4gRm9yIHJl
ZmVyZW5jZSwgOEsgcmVzb2x1dGlvbiAoNzY4MHg0MzIwKSB0YWtlcyBhYm91dAorICogMTI3TUIg
bWVtb3J5LgogICovCiAKICNkZWZpbmUgcHJfZm10KGZtdCkgS0JVSUxEX01PRE5BTUUgIjogIiBm
bXQKQEAgLTIyNyw3ICsyMzcsNiBAQCBzdHJ1Y3Qgc3ludGh2aWRfbXNnIHsKIH0gX19wYWNrZWQ7
CiAKIAotCiAvKiBGQiBkcml2ZXIgZGVmaW5pdGlvbnMgYW5kIHN0cnVjdHVyZXMgKi8KICNkZWZp
bmUgSFZGQl9XSURUSCAxMTUyIC8qIGRlZmF1bHQgc2NyZWVuIHdpZHRoICovCiAjZGVmaW5lIEhW
RkJfSEVJR0hUIDg2NCAvKiBkZWZhdWx0IHNjcmVlbiBoZWlnaHQgKi8KQEAgLTI1NiwxMiArMjY1
LDE1IEBAIHN0cnVjdCBodmZiX3BhciB7CiAJLyogSWYgdHJ1ZSwgdGhlIFZTQyBub3RpZmllcyB0
aGUgVlNQIG9uIGV2ZXJ5IGZyYW1lYnVmZmVyIGNoYW5nZSAqLwogCWJvb2wgc3luY2hyb25vdXNf
ZmI7CiAKKwkvKiBJZiB0cnVlLCBuZWVkIHRvIGNvcHkgZnJvbSBkZWZlcnJlZCBJTyBtZW0gdG8g
ZnJhbWVidWZmZXIgbWVtICovCisJYm9vbCBuZWVkX2RvY29weTsKKwogCXN0cnVjdCBub3RpZmll
cl9ibG9jayBodmZiX3BhbmljX25iOwogCiAJLyogTWVtb3J5IGZvciBkZWZlcnJlZCBJTyBhbmQg
ZnJhbWUgYnVmZmVyIGl0c2VsZiAqLwogCXVuc2lnbmVkIGNoYXIgKmRpb192cDsKIAl1bnNpZ25l
ZCBjaGFyICptbWlvX3ZwOwotCXVuc2lnbmVkIGxvbmcgbW1pb19wcDsKKwlwaHlzX2FkZHJfdCBt
bWlvX3BwOwogCiAJLyogRGlydHkgcmVjdGFuZ2xlLCBwcm90ZWN0ZWQgYnkgZGVsYXllZF9yZWZy
ZXNoX2xvY2sgKi8KIAlpbnQgeDEsIHkxLCB4MiwgeTI7CkBAIC00MzIsNyArNDQ0LDcgQEAgc3Rh
dGljIHZvaWQgc3ludGh2aWRfZGVmZXJyZWRfaW8oc3RydWN0IGZiX2luZm8gKnAsCiAJCW1heHkg
PSBtYXhfdChpbnQsIG1heHksIHkyKTsKIAogCQkvKiBDb3B5IGZyb20gZGlvIHNwYWNlIHRvIG1t
aW8gYWRkcmVzcyAqLwotCQlpZiAocGFyLT5mYl9yZWFkeSkKKwkJaWYgKHBhci0+ZmJfcmVhZHkg
JiYgcGFyLT5uZWVkX2RvY29weSkKIAkJCWh2ZmJfZG9jb3B5KHBhciwgc3RhcnQsIFBBR0VfU0la
RSk7CiAJfQogCkBAIC03NDksMTIgKzc2MSwxMiBAQCBzdGF0aWMgdm9pZCBodmZiX3VwZGF0ZV93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqdykKIAkJcmV0dXJuOwogCiAJLyogQ29weSB0aGUgZGly
dHkgcmVjdGFuZ2xlIHRvIGZyYW1lIGJ1ZmZlciBtZW1vcnkgKi8KLQlmb3IgKGogPSB5MTsgaiA8
IHkyOyBqKyspIHsKLQkJaHZmYl9kb2NvcHkocGFyLAotCQkJICAgIGogKiBpbmZvLT5maXgubGlu
ZV9sZW5ndGggKwotCQkJICAgICh4MSAqIHNjcmVlbl9kZXB0aCAvIDgpLAotCQkJICAgICh4MiAt
IHgxKSAqIHNjcmVlbl9kZXB0aCAvIDgpOwotCX0KKwlpZiAocGFyLT5uZWVkX2RvY29weSkKKwkJ
Zm9yIChqID0geTE7IGogPCB5MjsgaisrKQorCQkJaHZmYl9kb2NvcHkocGFyLAorCQkJCSAgICBq
ICogaW5mby0+Zml4LmxpbmVfbGVuZ3RoICsKKwkJCQkgICAgKHgxICogc2NyZWVuX2RlcHRoIC8g
OCksCisJCQkJICAgICh4MiAtIHgxKSAqIHNjcmVlbl9kZXB0aCAvIDgpOwogCiAJLyogUmVmcmVz
aCAqLwogCWlmIChwYXItPmZiX3JlYWR5ICYmIHBhci0+dXBkYXRlKQpAQCAtNzk5LDcgKzgxMSw4
IEBAIHN0YXRpYyBpbnQgaHZmYl9vbl9wYW5pYyhzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAog
CXBhciA9IGNvbnRhaW5lcl9vZihuYiwgc3RydWN0IGh2ZmJfcGFyLCBodmZiX3BhbmljX25iKTsK
IAlwYXItPnN5bmNocm9ub3VzX2ZiID0gdHJ1ZTsKIAlpbmZvID0gcGFyLT5pbmZvOwotCWh2ZmJf
ZG9jb3B5KHBhciwgMCwgZGlvX2ZiX3NpemUpOworCWlmIChwYXItPm5lZWRfZG9jb3B5KQorCQlo
dmZiX2RvY29weShwYXIsIDAsIGRpb19mYl9zaXplKTsKIAlzeW50aHZpZF91cGRhdGUoaW5mbywg
MCwgMCwgSU5UX01BWCwgSU5UX01BWCk7CiAKIAlyZXR1cm4gTk9USUZZX0RPTkU7CkBAIC05Mzgs
NiArOTUxLDYyIEBAIHN0YXRpYyB2b2lkIGh2ZmJfZ2V0X29wdGlvbihzdHJ1Y3QgZmJfaW5mbyAq
aW5mbykKIAlyZXR1cm47CiB9CiAKKy8qCisgKiBBbGxvY2F0ZSBlbm91Z2ggY29udGlndW91cyBw
aHlzaWNhbCBtZW1vcnkuCisgKiBSZXR1cm4gcGh5c2ljYWwgYWRkcmVzcyBpZiBzdWNjZWVkZWQg
b3IgLTEgaWYgZmFpbGVkLgorICovCitzdGF0aWMgcGh5c19hZGRyX3QgaHZmYl9nZXRfcGh5bWVt
KHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsCisJCQkJICAgdW5zaWduZWQgaW50IHJlcXVlc3Rfc2l6
ZSkKK3sKKwlzdHJ1Y3QgcGFnZSAqcGFnZSA9IE5VTEw7CisJZG1hX2FkZHJfdCBkbWFfaGFuZGxl
OworCXZvaWQgKnZtZW07CisJcGh5c19hZGRyX3QgcGFkZHIgPSAwOworCXVuc2lnbmVkIGludCBv
cmRlciA9IGdldF9vcmRlcihyZXF1ZXN0X3NpemUpOworCisJaWYgKHJlcXVlc3Rfc2l6ZSA9PSAw
KQorCQlyZXR1cm4gLTE7CisKKwlpZiAob3JkZXIgPCBNQVhfT1JERVIpIHsKKwkJLyogQ2FsbCBh
bGxvY19wYWdlcyBpZiB0aGUgc2l6ZSBpcyBsZXNzIHRoYW4gMl5NQVhfT1JERVIgKi8KKwkJcGFn
ZSA9IGFsbG9jX3BhZ2VzKEdGUF9LRVJORUwgfCBfX0dGUF9aRVJPLCBvcmRlcik7CisJCWlmICgh
cGFnZSkKKwkJCXJldHVybiAtMTsKKworCQlwYWRkciA9IChwYWdlX3RvX3BmbihwYWdlKSA8PCBQ
QUdFX1NISUZUKTsKKwl9IGVsc2UgeworCQkvKiBBbGxvY2F0ZSBmcm9tIENNQSAqLworCQloZGV2
LT5kZXZpY2UuY29oZXJlbnRfZG1hX21hc2sgPSBETUFfQklUX01BU0soNjQpOworCisJCXZtZW0g
PSBkbWFfYWxsb2NfY29oZXJlbnQoJmhkZXYtPmRldmljZSwKKwkJCQkJICByb3VuZF91cChyZXF1
ZXN0X3NpemUsIFBBR0VfU0laRSksCisJCQkJCSAgJmRtYV9oYW5kbGUsCisJCQkJCSAgR0ZQX0tF
Uk5FTCB8IF9fR0ZQX05PV0FSTik7CisKKwkJaWYgKCF2bWVtKQorCQkJcmV0dXJuIC0xOworCisJ
CXBhZGRyID0gdmlydF90b19waHlzKHZtZW0pOworCX0KKworCXJldHVybiBwYWRkcjsKK30KKwor
LyogUmVsZWFzZSBjb250aWd1b3VzIHBoeXNpY2FsIG1lbW9yeSAqLworc3RhdGljIHZvaWQgaHZm
Yl9yZWxlYXNlX3BoeW1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LAorCQkJCXBoeXNfYWRkcl90
IHBhZGRyLCB1bnNpZ25lZCBpbnQgc2l6ZSkKK3sKKwl1bnNpZ25lZCBpbnQgb3JkZXIgPSBnZXRf
b3JkZXIoc2l6ZSk7CisKKwlpZiAob3JkZXIgPCBNQVhfT1JERVIpCisJCV9fZnJlZV9wYWdlcyhw
Zm5fdG9fcGFnZShwYWRkciA+PiBQQUdFX1NISUZUKSwgb3JkZXIpOworCWVsc2UKKwkJZG1hX2Zy
ZWVfY29oZXJlbnQoJmhkZXYtPmRldmljZSwKKwkJCQkgIHJvdW5kX3VwKHNpemUsIFBBR0VfU0la
RSksCisJCQkJICBwaHlzX3RvX3ZpcnQocGFkZHIpLAorCQkJCSAgcGFkZHIpOworfQorCiAKIC8q
IEdldCBmcmFtZWJ1ZmZlciBtZW1vcnkgZnJvbSBIeXBlci1WIHZpZGVvIHBjaSBzcGFjZSAqLwog
c3RhdGljIGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3QgZmJf
aW5mbyAqaW5mbykKQEAgLTk0NywyMiArMTAxNiw2MSBAQCBzdGF0aWMgaW50IGh2ZmJfZ2V0bWVt
KHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsIHN0cnVjdCBmYl9pbmZvICppbmZvKQogCXZvaWQgX19p
b21lbSAqZmJfdmlydDsKIAlpbnQgZ2VuMnZtID0gZWZpX2VuYWJsZWQoRUZJX0JPT1QpOwogCXJl
c291cmNlX3NpemVfdCBwb3Rfc3RhcnQsIHBvdF9lbmQ7CisJcGh5c19hZGRyX3QgcGFkZHI7CiAJ
aW50IHJldDsKIAotCWRpb19mYl9zaXplID0KLQkJc2NyZWVuX3dpZHRoICogc2NyZWVuX2hlaWdo
dCAqIHNjcmVlbl9kZXB0aCAvIDg7CisJaW5mby0+YXBlcnR1cmVzID0gYWxsb2NfYXBlcnR1cmVz
KDEpOworCWlmICghaW5mby0+YXBlcnR1cmVzKQorCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmIChn
ZW4ydm0pIHsKLQkJcG90X3N0YXJ0ID0gMDsKLQkJcG90X2VuZCA9IC0xOwotCX0gZWxzZSB7CisJ
aWYgKCFnZW4ydm0pIHsKIAkJcGRldiA9IHBjaV9nZXRfZGV2aWNlKFBDSV9WRU5ET1JfSURfTUlD
Uk9TT0ZULAotCQkJICAgICAgUENJX0RFVklDRV9JRF9IWVBFUlZfVklERU8sIE5VTEwpOworCQkJ
UENJX0RFVklDRV9JRF9IWVBFUlZfVklERU8sIE5VTEwpOwogCQlpZiAoIXBkZXYpIHsKIAkJCXBy
X2VycigiVW5hYmxlIHRvIGZpbmQgUENJIEh5cGVyLVYgdmlkZW9cbiIpOworCQkJa2ZyZWUoaW5m
by0+YXBlcnR1cmVzKTsKIAkJCXJldHVybiAtRU5PREVWOwogCQl9CiAKKwkJaW5mby0+YXBlcnR1
cmVzLT5yYW5nZXNbMF0uYmFzZSA9IHBjaV9yZXNvdXJjZV9zdGFydChwZGV2LCAwKTsKKwkJaW5m
by0+YXBlcnR1cmVzLT5yYW5nZXNbMF0uc2l6ZSA9IHBjaV9yZXNvdXJjZV9sZW4ocGRldiwgMCk7
CisKKwkJLyoKKwkJICogRm9yIEdlbiAxIFZNLCB3ZSBjYW4gZGlyZWN0bHkgdXNlIHRoZSBjb250
aWd1b3VzIG1lbW9yeQorCQkgKiBmcm9tIFZNLiBJZiB3ZSBzdWNjZWVkLCBkZWZlcnJlZCBJTyBo
YXBwZW5zIGRpcmVjdGx5CisJCSAqIG9uIHRoaXMgYWxsb2NhdGVkIGZyYW1lYnVmZmVyIG1lbW9y
eSwgYXZvaWRpbmcgZXh0cmEKKwkJICogbWVtb3J5IGNvcHkuCisJCSAqLworCQlwYWRkciA9IGh2
ZmJfZ2V0X3BoeW1lbShoZGV2LCBzY3JlZW5fZmJfc2l6ZSk7CisJCWlmIChwYWRkciAhPSAocGh5
c19hZGRyX3QpIC0xKSB7CisJCQlwYXItPm1taW9fcHAgPSBwYWRkcjsKKwkJCXBhci0+bW1pb192
cCA9IHBhci0+ZGlvX3ZwID0gX192YShwYWRkcik7CisKKwkJCWluZm8tPmZpeC5zbWVtX3N0YXJ0
ID0gcGFkZHI7CisJCQlpbmZvLT5maXguc21lbV9sZW4gPSBzY3JlZW5fZmJfc2l6ZTsKKwkJCWlu
Zm8tPnNjcmVlbl9iYXNlID0gcGFyLT5tbWlvX3ZwOworCQkJaW5mby0+c2NyZWVuX3NpemUgPSBz
Y3JlZW5fZmJfc2l6ZTsKKworCQkJcGFyLT5uZWVkX2RvY29weSA9IGZhbHNlOworCQkJZ290byBn
ZXRtZW1fZG9uZTsKKwkJfQorCQlwcl9pbmZvKCJVbmFibGUgdG8gYWxsb2NhdGUgZW5vdWdoIGNv
bnRpZ3VvdXMgcGh5c2ljYWwgbWVtb3J5IG9uIEdlbiAxIFZNLiBVc2luZyBNTUlPIGluc3RlYWQu
XG4iKTsKKwl9IGVsc2UgeworCQlpbmZvLT5hcGVydHVyZXMtPnJhbmdlc1swXS5iYXNlID0gc2Ny
ZWVuX2luZm8ubGZiX2Jhc2U7CisJCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLnNpemUgPSBz
Y3JlZW5faW5mby5sZmJfc2l6ZTsKKwl9CisKKwkvKgorCSAqIENhbm5vdCB1c2UgdGhlIGNvbnRp
Z3VvdXMgcGh5c2ljYWwgbWVtb3J5LgorCSAqIEFsbG9jYXRlIG1taW8gc3BhY2UgZm9yIGZyYW1l
YnVmZmVyLgorCSAqLworCWRpb19mYl9zaXplID0KKwkJc2NyZWVuX3dpZHRoICogc2NyZWVuX2hl
aWdodCAqIHNjcmVlbl9kZXB0aCAvIDg7CisKKwlpZiAoZ2VuMnZtKSB7CisJCXBvdF9zdGFydCA9
IDA7CisJCXBvdF9lbmQgPSAtMTsKKwl9IGVsc2UgewogCQlpZiAoIShwY2lfcmVzb3VyY2VfZmxh
Z3MocGRldiwgMCkgJiBJT1JFU09VUkNFX01FTSkgfHwKIAkJICAgIHBjaV9yZXNvdXJjZV9sZW4o
cGRldiwgMCkgPCBzY3JlZW5fZmJfc2l6ZSkgewogCQkJcHJfZXJyKCJSZXNvdXJjZSBub3QgYXZh
aWxhYmxlIG9yICgweCVseCA8IDB4JWx4KVxuIiwKQEAgLTk5MSwyMCArMTA5OSw2IEBAIHN0YXRp
YyBpbnQgaHZmYl9nZXRtZW0oc3RydWN0IGh2X2RldmljZSAqaGRldiwgc3RydWN0IGZiX2luZm8g
KmluZm8pCiAJaWYgKHBhci0+ZGlvX3ZwID09IE5VTEwpCiAJCWdvdG8gZXJyMzsKIAotCWluZm8t
PmFwZXJ0dXJlcyA9IGFsbG9jX2FwZXJ0dXJlcygxKTsKLQlpZiAoIWluZm8tPmFwZXJ0dXJlcykK
LQkJZ290byBlcnI0OwotCi0JaWYgKGdlbjJ2bSkgewotCQlpbmZvLT5hcGVydHVyZXMtPnJhbmdl
c1swXS5iYXNlID0gc2NyZWVuX2luZm8ubGZiX2Jhc2U7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFu
Z2VzWzBdLnNpemUgPSBzY3JlZW5faW5mby5sZmJfc2l6ZTsKLQkJcmVtb3ZlX2NvbmZsaWN0aW5n
X2ZyYW1lYnVmZmVycyhpbmZvLT5hcGVydHVyZXMsCi0JCQkJCQlLQlVJTERfTU9ETkFNRSwgZmFs
c2UpOwotCX0gZWxzZSB7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLmJhc2UgPSBwY2lf
cmVzb3VyY2Vfc3RhcnQocGRldiwgMCk7Ci0JCWluZm8tPmFwZXJ0dXJlcy0+cmFuZ2VzWzBdLnNp
emUgPSBwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDApOwotCX0KLQogCS8qIFBoeXNpY2FsIGFkZHJl
c3Mgb2YgRkIgZGV2aWNlICovCiAJcGFyLT5tbWlvX3BwID0gcGFyLT5tZW0tPnN0YXJ0OwogCS8q
IFZpcnR1YWwgYWRkcmVzcyBvZiBGQiBkZXZpY2UgKi8KQEAgLTEwMTUsMTMgKzExMDksMTUgQEAg
c3RhdGljIGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3QgZmJf
aW5mbyAqaW5mbykKIAlpbmZvLT5zY3JlZW5fYmFzZSA9IHBhci0+ZGlvX3ZwOwogCWluZm8tPnNj
cmVlbl9zaXplID0gZGlvX2ZiX3NpemU7CiAKK2dldG1lbV9kb25lOgorCXJlbW92ZV9jb25mbGlj
dGluZ19mcmFtZWJ1ZmZlcnMoaW5mby0+YXBlcnR1cmVzLAorCQkJCQlLQlVJTERfTU9ETkFNRSwg
ZmFsc2UpOwogCWlmICghZ2VuMnZtKQogCQlwY2lfZGV2X3B1dChwZGV2KTsKKwlrZnJlZShpbmZv
LT5hcGVydHVyZXMpOwogCiAJcmV0dXJuIDA7CiAKLWVycjQ6Ci0JdmZyZWUocGFyLT5kaW9fdnAp
OwogZXJyMzoKIAlpb3VubWFwKGZiX3ZpcnQpOwogZXJyMjoKQEAgLTEwMzAsMTggKzExMjYsMjUg
QEAgc3RhdGljIGludCBodmZiX2dldG1lbShzdHJ1Y3QgaHZfZGV2aWNlICpoZGV2LCBzdHJ1Y3Qg
ZmJfaW5mbyAqaW5mbykKIGVycjE6CiAJaWYgKCFnZW4ydm0pCiAJCXBjaV9kZXZfcHV0KHBkZXYp
OworCWtmcmVlKGluZm8tPmFwZXJ0dXJlcyk7CiAKIAlyZXR1cm4gLUVOT01FTTsKIH0KIAogLyog
UmVsZWFzZSB0aGUgZnJhbWVidWZmZXIgKi8KLXN0YXRpYyB2b2lkIGh2ZmJfcHV0bWVtKHN0cnVj
dCBmYl9pbmZvICppbmZvKQorc3RhdGljIHZvaWQgaHZmYl9wdXRtZW0oc3RydWN0IGh2X2Rldmlj
ZSAqaGRldiwgc3RydWN0IGZiX2luZm8gKmluZm8pCiB7CiAJc3RydWN0IGh2ZmJfcGFyICpwYXIg
PSBpbmZvLT5wYXI7CiAKLQl2ZnJlZShwYXItPmRpb192cCk7Ci0JaW91bm1hcChpbmZvLT5zY3Jl
ZW5fYmFzZSk7Ci0Jdm1idXNfZnJlZV9tbWlvKHBhci0+bWVtLT5zdGFydCwgc2NyZWVuX2ZiX3Np
emUpOworCWlmIChwYXItPm5lZWRfZG9jb3B5KSB7CisJCXZmcmVlKHBhci0+ZGlvX3ZwKTsKKwkJ
aW91bm1hcChpbmZvLT5zY3JlZW5fYmFzZSk7CisJCXZtYnVzX2ZyZWVfbW1pbyhwYXItPm1lbS0+
c3RhcnQsIHNjcmVlbl9mYl9zaXplKTsKKwl9IGVsc2UgeworCQlodmZiX3JlbGVhc2VfcGh5bWVt
KGhkZXYsIGluZm8tPmZpeC5zbWVtX3N0YXJ0LAorCQkJCSAgICBzY3JlZW5fZmJfc2l6ZSk7CisJ
fQorCiAJcGFyLT5tZW0gPSBOVUxMOwogfQogCkBAIC0xMDYwLDYgKzExNjMsNyBAQCBzdGF0aWMg
aW50IGh2ZmJfcHJvYmUoc3RydWN0IGh2X2RldmljZSAqaGRldiwKIAlwYXIgPSBpbmZvLT5wYXI7
CiAJcGFyLT5pbmZvID0gaW5mbzsKIAlwYXItPmZiX3JlYWR5ID0gZmFsc2U7CisJcGFyLT5uZWVk
X2RvY29weSA9IHRydWU7CiAJaW5pdF9jb21wbGV0aW9uKCZwYXItPndhaXQpOwogCUlOSVRfREVM
QVlFRF9XT1JLKCZwYXItPmR3b3JrLCBodmZiX3VwZGF0ZV93b3JrKTsKIApAQCAtMTE0NSw3ICsx
MjQ5LDcgQEAgc3RhdGljIGludCBodmZiX3Byb2JlKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYsCiAK
IGVycm9yOgogCWZiX2RlZmVycmVkX2lvX2NsZWFudXAoaW5mbyk7Ci0JaHZmYl9wdXRtZW0oaW5m
byk7CisJaHZmYl9wdXRtZW0oaGRldiwgaW5mbyk7CiBlcnJvcjI6CiAJdm1idXNfY2xvc2UoaGRl
di0+Y2hhbm5lbCk7CiBlcnJvcjE6CkBAIC0xMTc1LDcgKzEyNzksNyBAQCBzdGF0aWMgaW50IGh2
ZmJfcmVtb3ZlKHN0cnVjdCBodl9kZXZpY2UgKmhkZXYpCiAJdm1idXNfY2xvc2UoaGRldi0+Y2hh
bm5lbCk7CiAJaHZfc2V0X2RydmRhdGEoaGRldiwgTlVMTCk7CiAKLQlodmZiX3B1dG1lbShpbmZv
KTsKKwlodmZiX3B1dG1lbShoZGV2LCBpbmZvKTsKIAlmcmFtZWJ1ZmZlcl9yZWxlYXNlKGluZm8p
OwogCiAJcmV0dXJuIDA7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2RyaS1kZXZlbA==
