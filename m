Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 07C8117DC1
	for <lists+dri-devel@lfdr.de>; Wed,  8 May 2019 18:09:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 34AEA8981B;
	Wed,  8 May 2019 16:09:37 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-qt1-x841.google.com (mail-qt1-x841.google.com
 [IPv6:2607:f8b0:4864:20::841])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5973D89819
 for <dri-devel@lists.freedesktop.org>; Wed,  8 May 2019 16:09:35 +0000 (UTC)
Received: by mail-qt1-x841.google.com with SMTP id j53so4732139qta.9
 for <dri-devel@lists.freedesktop.org>; Wed, 08 May 2019 09:09:35 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=uPvcfg2K1twLe3ZdbBPoZgc4R2/Gwc6wx4pRAL22agM=;
 b=GxTBrhiQtKlpr7bP4YCWTEPZ1ZBRXzk8gwKc+hOX0qKKqR5ZCHZSee+LvBHfsRwNFn
 8+wNF4h46whdG032boJ2wCJAfYdybIAYNeLA9Ge7uvHHdt2zInG9Aqn4Vda7V+9fG1yd
 dZwuUeaxXkGzjo13lp7E0K1gdPV3v/I8m1aBLnk995J08eh1iEafrdSd7wsBA6zblx/4
 zOVJFP4dQ3bLUD065GtquZ5tw6XV8tP0ZP2b/GB91v6z8lyHLluWLMucFY8SnuNwOr+R
 UV4/xdHybVzZIopwJHdOx0IoUZ3mzZpyfXH4o2yaf2lv/n5iqWCuspkzQmMzIvXQGEkZ
 Imqw==
X-Gm-Message-State: APjAAAWvsn8abRXhtAXszp/z7Ks6sW0qrBoJVxyx5oj7UqDTjHagcgoo
 rkIrL35sAWZ+ZB1QkO9/FnpTyjf1jIs=
X-Google-Smtp-Source: APXvYqyB+ReQnvFl0IRaCljTTOpgFk+L4+gDrxnOFzDc//MUoIzyRU+ROOTA/mYAJ8/ywJKggpbl8Q==
X-Received: by 2002:ac8:4651:: with SMTP id f17mr22588951qto.362.1557331773860; 
 Wed, 08 May 2019 09:09:33 -0700 (PDT)
Received: from rosewood.cam.corp.google.com
 ([2620:0:1013:11:89c6:2139:5435:371d])
 by smtp.gmail.com with ESMTPSA id s50sm10936877qts.39.2019.05.08.09.09.32
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 08 May 2019 09:09:33 -0700 (PDT)
From: Sean Paul <sean@poorly.run>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 05/11] drm: Add helpers to kick off self refresh mode in
 drivers
Date: Wed,  8 May 2019 12:09:10 -0400
Message-Id: <20190508160920.144739-6-sean@poorly.run>
X-Mailer: git-send-email 2.21.0.1020.gf2820cf01a-goog
In-Reply-To: <20190508160920.144739-1-sean@poorly.run>
References: <20190508160920.144739-1-sean@poorly.run>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=poorly.run; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=uPvcfg2K1twLe3ZdbBPoZgc4R2/Gwc6wx4pRAL22agM=;
 b=Rikrx5QgMy4ondkVvSaxNWx+zsz2czyWu0yWvWoQ3eHy855+SP3jQyGzl+fEtt/S6q
 WbdE+ypsho2JhpjXxUoP+YwG8yqh1PBrbG6V9biXzeEhFUw5MvWw5h4Icv0ehalvW4oP
 PBG+458N3HwsymhKPJPCPEgIudvVYLg14oIlMEaEOJuYA0zXa2dGkTNTk/UgiGBmy3Ca
 pCnHxqmZCSoChNJmCxct6NX2qumQ6mUlSx24Q45yTnyTr+R/hGJZat3TyJopjx1vEFMC
 /LzroHOO2gvFQpOQsWkobVj+cKs03QtiRmQBZOS3Yx30+rQkwjn2YpDXi/XLc4KFN5TR
 Z8KA==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Zain Wang <wzz@rock-chips.com>, Jonathan Corbet <corbet@lwn.net>,
 Maxime Ripard <maxime.ripard@bootlin.com>, linux-doc@vger.kernel.org,
 linux-kernel@vger.kernel.org, Jose Souza <jose.souza@intel.com>,
 Tomasz Figa <tfiga@chromium.org>, David Airlie <airlied@linux.ie>,
 Sean Paul <seanpaul@chromium.org>, Sean Paul <sean@poorly.run>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5vcmc+CgpUaGlzIHBhdGNoIGFkZHMg
YSBuZXcgZHJtIGhlbHBlciBsaWJyYXJ5IHRvIGhlbHAgZHJpdmVycyBpbXBsZW1lbnQKc2VsZiBy
ZWZyZXNoLiBEcml2ZXJzIGNob29zaW5nIHRvIHVzZSBpdCB3aWxsIHJlZ2lzdGVyIGNydGNzIGFu
ZAp3aWxsIHJlY2VpdmUgY2FsbGJhY2tzIHdoZW4gaXQncyB0aW1lIHRvIGVudGVyIG9yIGV4aXQg
c2VsZiByZWZyZXNoCm1vZGUuCgpJbiBpdHMgY3VycmVudCBmb3JtLCBpdCBoYXMgYSB0aW1lciB3
aGljaCB3aWxsIHRyaWdnZXIgYWZ0ZXIgYQpkcml2ZXItc3BlY2lmaWVkIGFtb3VudCBvZiBpbmFj
dGl2aXR5LiBXaGVuIHRoZSB0aW1lciB0cmlnZ2VycywgdGhlCmhlbHBlcnMgd2lsbCBzdWJtaXQg
YSBuZXcgYXRvbWljIGNvbW1pdCB0byBzaHV0IHRoZSByZWZyZXNoaW5nIHBpcGUKb2ZmLiBPbiB0
aGUgbmV4dCBhdG9taWMgY29tbWl0LCB0aGUgZHJtIGNvcmUgd2lsbCByZXZlcnQgdGhlIHNlbGYK
cmVmcmVzaCBzdGF0ZSBhbmQgYnJpbmcgZXZlcnl0aGluZyBiYWNrIHVwIHRvIGJlIGFjdGl2ZWx5
IGRyaXZlbi4KCkZyb20gdGhlIGRyaXZlcidzIHBlcnNwZWN0aXZlLCB0aGlzIHdvcmtzIGxpa2Ug
YSByZWd1bGFyIGRpc2FibGUvZW5hYmxlCmN5Y2xlLiBUaGUgZHJpdmVyIG5lZWQgb25seSBjaGVj
ayB0aGUgJ3NlbGZfcmVmcmVzaF9hY3RpdmUnIHN0YXRlIGluCmNydGNfc3RhdGUuIEl0IHNob3Vs
ZCBpbml0aWF0ZSBzZWxmIHJlZnJlc2ggbW9kZSBvbiB0aGUgcGFuZWwgYW5kIGVudGVyCmFuIG9m
ZiBvciBsb3ctcG93ZXIgc3RhdGUuCgpDaGFuZ2VzIGluIHYyOgotIHMvcHNyL3NlbGZfcmVmcmVz
aC8gKERhbmllbCkKLSBpbnRlZ3JhdGVkIHRoZSBwc3IgZXhpdCBpbnRvIHRoZSBjb21taXQgdGhh
dCB3YWtlcyBpdCB1cCAoSm9zZS9EYW5pZWwpCi0gbWFkZSB0aGUgcHNyIHN0YXRlIHBlci1jcnRj
IChKb3NlL0RhbmllbCkKQ2hhbmdlcyBpbiB2MzoKLSBSZW1vdmUgdGhlIHNlbGZfcmVmcmVzaF8o
YWN0aXZlfGNoYW5nZWQpIGZyb20gY29ubmVjdG9yIHN0YXRlIChEYW5pZWwpCi0gU2ltcGxpZnkg
bG9vcCBpbiBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZSAoRGFuaWVsKQotIElt
cHJvdmUgc2VsZl9yZWZyZXNoX2F3YXJlIGNvbW1lbnQgKERhbmllbCkKLSBzL3NlbGZfcmVmcmVz
aF9zdGF0ZS9zZWxmX3JlZnJlc2hfZGF0YS8gKERhbmllbCkKQ2hhbmdlcyBpbiB2NDoKLSBNb3Zl
IGRvY2Jvb2sgbG9jYXRpb24gYmVsb3cgcGFuZWwgKERhbmllbCkKLSBJbXByb3ZlIGRvY2Jvb2sg
d2l0aCByZWZlcmVuY2VzIGFuZCBtb3JlIGRldGFpbGVkIGV4cGxhbmF0aW9uIChEYW5pZWwpCi0g
SW5zdGVhZCBvZiByZWdpc3Rlci91bnJlZ2lzdGVyLCB1c2UgaW5pdC9jbGVhbnVwIChEYW5pZWwp
CgpMaW5rIHRvIHYxOiBodHRwczovL3BhdGNod29yay5mcmVlZGVza3RvcC5vcmcvcGF0Y2gvbXNn
aWQvMjAxOTAyMjgyMTA5MzkuODMzODYtMi1zZWFuQHBvb3JseS5ydW4KTGluayB0byB2MjogaHR0
cHM6Ly9wYXRjaHdvcmsuZnJlZWRlc2t0b3Aub3JnL3BhdGNoL21zZ2lkLzIwMTkwMzI2MjA0NTA5
Ljk2NTE1LTEtc2VhbkBwb29ybHkucnVuCkxpbmsgdG8gdjM6IGh0dHBzOi8vcGF0Y2h3b3JrLmZy
ZWVkZXNrdG9wLm9yZy9wYXRjaC9tc2dpZC8yMDE5MDUwMjE5NDk1Ni4yMTg0NDEtNi1zZWFuQHBv
b3JseS5ydW4KCkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+CkNjOiBKb3NlIFNv
dXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IFphaW4gV2FuZyA8d3p6QHJvY2stY2hpcHMu
Y29tPgpDYzogVG9tYXN6IEZpZ2EgPHRmaWdhQGNocm9taXVtLm9yZz4KQ2M6IFZpbGxlIFN5cmrD
pGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFNlYW4g
UGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgotLS0KIERvY3VtZW50YXRpb24vZ3B1L2RybS1r
bXMtaGVscGVycy5yc3QgICAgIHwgICA5ICsKIGRyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZSAgICAg
ICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jICAgICAg
ICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYyAgICAg
ICB8ICAzNSArKystCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19zdGF0ZV9oZWxwZXIuYyB8
ICAgNCArCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY191YXBpLmMgICAgICAgICB8ICAgNyAr
LQogZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMgfCAyMTMgKysrKysr
KysrKysrKysrKysrKysrKwogaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oICAgICAgICAgICAgICAg
ICAgfCAgMTUgKysKIGluY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaCAgICAgICAgICAgICAgIHwg
IDE0ICsrCiBpbmNsdWRlL2RybS9kcm1fY3J0Yy5oICAgICAgICAgICAgICAgICAgICB8ICAxOSAr
KwogaW5jbHVkZS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaCAgICAgfCAgMjIgKysrCiAx
MSBmaWxlcyBjaGFuZ2VkLCAzMzcgaW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKIGNyZWF0
ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuYwog
Y3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgK
CmRpZmYgLS1naXQgYS9Eb2N1bWVudGF0aW9uL2dwdS9kcm0ta21zLWhlbHBlcnMucnN0IGIvRG9j
dW1lbnRhdGlvbi9ncHUvZHJtLWttcy1oZWxwZXJzLnJzdAppbmRleCAxNDEwMmFlMDM1ZGMuLjg2
ZGJiNTZhZWY1MSAxMDA2NDQKLS0tIGEvRG9jdW1lbnRhdGlvbi9ncHUvZHJtLWttcy1oZWxwZXJz
LnJzdAorKysgYi9Eb2N1bWVudGF0aW9uL2dwdS9kcm0ta21zLWhlbHBlcnMucnN0CkBAIC0xODEs
NiArMTgxLDE1IEBAIFBhbmVsIEhlbHBlciBSZWZlcmVuY2UKIC4uIGtlcm5lbC1kb2M6OiBkcml2
ZXJzL2dwdS9kcm0vZHJtX3BhbmVsX29yaWVudGF0aW9uX3F1aXJrcy5jCiAgICA6ZXhwb3J0Ogog
CitQYW5lbCBTZWxmIFJlZnJlc2ggSGVscGVyIFJlZmVyZW5jZQorPT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT0KKworLi4ga2VybmVsLWRvYzo6IGRyaXZlcnMvZ3B1L2RybS9kcm1f
c2VsZl9yZWZyZXNoX2hlbHBlci5jCisgICA6ZG9jOiBvdmVydmlldworCisuLiBrZXJuZWwtZG9j
OjogZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmMKKyAgIDpleHBvcnQ6
CisKIERpc3BsYXkgUG9ydCBIZWxwZXIgRnVuY3Rpb25zIFJlZmVyZW5jZQogPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQppbmRleCAzZDBjNzVjZDY4N2Mu
LmM0ODUyNjA0ZmMxZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZQpAQCAtMzksNyArMzksNyBAQCBkcm1fa21zX2hlbHBl
ci15IDo9IGRybV9jcnRjX2hlbHBlci5vIGRybV9kcF9oZWxwZXIubyBkcm1fZHNjLm8gZHJtX3By
b2JlX2hlbHBlcgogCQlkcm1fc2ltcGxlX2ttc19oZWxwZXIubyBkcm1fbW9kZXNldF9oZWxwZXIu
byBcCiAJCWRybV9zY2RjX2hlbHBlci5vIGRybV9nZW1fZnJhbWVidWZmZXJfaGVscGVyLm8gXAog
CQlkcm1fYXRvbWljX3N0YXRlX2hlbHBlci5vIGRybV9kYW1hZ2VfaGVscGVyLm8gXAotCQlkcm1f
Zm9ybWF0X2hlbHBlci5vCisJCWRybV9mb3JtYXRfaGVscGVyLm8gZHJtX3NlbGZfcmVmcmVzaF9o
ZWxwZXIubwogCiBkcm1fa21zX2hlbHBlci0kKENPTkZJR19EUk1fUEFORUxfQlJJREdFKSArPSBi
cmlkZ2UvcGFuZWwubwogZHJtX2ttc19oZWxwZXItJChDT05GSUdfRFJNX0ZCREVWX0VNVUxBVElP
TikgKz0gZHJtX2ZiX2hlbHBlci5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0
b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwppbmRleCA5MzYwMDI0OTU1MjMu
LjJiOTI2NDhjZTE5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jCkBAIC0zNzksNiArMzc5LDcgQEAgc3Rh
dGljIHZvaWQgZHJtX2F0b21pY19jcnRjX3ByaW50X3N0YXRlKHN0cnVjdCBkcm1fcHJpbnRlciAq
cCwKIAlkcm1fcHJpbnRmKHAsICJjcnRjWyV1XTogJXNcbiIsIGNydGMtPmJhc2UuaWQsIGNydGMt
Pm5hbWUpOwogCWRybV9wcmludGYocCwgIlx0ZW5hYmxlPSVkXG4iLCBzdGF0ZS0+ZW5hYmxlKTsK
IAlkcm1fcHJpbnRmKHAsICJcdGFjdGl2ZT0lZFxuIiwgc3RhdGUtPmFjdGl2ZSk7CisJZHJtX3By
aW50ZihwLCAiXHRzZWxmX3JlZnJlc2hfYWN0aXZlPSVkXG4iLCBzdGF0ZS0+c2VsZl9yZWZyZXNo
X2FjdGl2ZSk7CiAJZHJtX3ByaW50ZihwLCAiXHRwbGFuZXNfY2hhbmdlZD0lZFxuIiwgc3RhdGUt
PnBsYW5lc19jaGFuZ2VkKTsKIAlkcm1fcHJpbnRmKHAsICJcdG1vZGVfY2hhbmdlZD0lZFxuIiwg
c3RhdGUtPm1vZGVfY2hhbmdlZCk7CiAJZHJtX3ByaW50ZihwLCAiXHRhY3RpdmVfY2hhbmdlZD0l
ZFxuIiwgc3RhdGUtPmFjdGl2ZV9jaGFuZ2VkKTsKQEAgLTk1MSw2ICs5NTIsNyBAQCBzdGF0aWMg
dm9pZCBkcm1fYXRvbWljX2Nvbm5lY3Rvcl9wcmludF9zdGF0ZShzdHJ1Y3QgZHJtX3ByaW50ZXIg
KnAsCiAKIAlkcm1fcHJpbnRmKHAsICJjb25uZWN0b3JbJXVdOiAlc1xuIiwgY29ubmVjdG9yLT5i
YXNlLmlkLCBjb25uZWN0b3ItPm5hbWUpOwogCWRybV9wcmludGYocCwgIlx0Y3J0Yz0lc1xuIiwg
c3RhdGUtPmNydGMgPyBzdGF0ZS0+Y3J0Yy0+bmFtZSA6ICIobnVsbCkiKTsKKwlkcm1fcHJpbnRm
KHAsICJcdHNlbGZfcmVmcmVzaF9hd2FyZT0lZFxuIiwgc3RhdGUtPnNlbGZfcmVmcmVzaF9hd2Fy
ZSk7CiAKIAlpZiAoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNU
T1JfV1JJVEVCQUNLKQogCQlpZiAoc3RhdGUtPndyaXRlYmFja19qb2IgJiYgc3RhdGUtPndyaXRl
YmFja19qb2ItPmZiKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVs
cGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwppbmRleCBlZTk0NWQ2
ZjFjYmEuLjllZTdhMjg4ZjUyYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9t
aWNfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAg
LTMwLDYgKzMwLDcgQEAKICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY191YXBpLmg+CiAjaW5jbHVk
ZSA8ZHJtL2RybV9wbGFuZV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxw
ZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaD4KICNpbmNsdWRl
IDxkcm0vZHJtX3dyaXRlYmFjay5oPgogI2luY2x1ZGUgPGRybS9kcm1fZGFtYWdlX2hlbHBlci5o
PgogI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS5oPgpAQCAtOTUwLDEwICs5NTEsMzMgQEAgaW50
IGRybV9hdG9taWNfaGVscGVyX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYgKHN0
YXRlLT5sZWdhY3lfY3Vyc29yX3VwZGF0ZSkKIAkJc3RhdGUtPmFzeW5jX3VwZGF0ZSA9ICFkcm1f
YXRvbWljX2hlbHBlcl9hc3luY19jaGVjayhkZXYsIHN0YXRlKTsKIAorCWRybV9zZWxmX3JlZnJl
c2hfaGVscGVyX2FsdGVyX3N0YXRlKHN0YXRlKTsKKwogCXJldHVybiByZXQ7CiB9CiBFWFBPUlRf
U1lNQk9MKGRybV9hdG9taWNfaGVscGVyX2NoZWNrKTsKIAorc3RhdGljIGJvb2wKK2NydGNfbmVl
ZHNfZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9zdGF0ZSwKKwkJICAgc3RydWN0
IGRybV9jcnRjX3N0YXRlICpuZXdfc3RhdGUpCit7CisJLyoKKwkgKiBObyBuZXdfc3RhdGUgbWVh
bnMgdGhlIGNydGMgaXMgb2ZmLCBzbyB0aGUgb25seSBjcml0ZXJpYSBpcyB3aGV0aGVyCisJICog
aXQncyBjdXJyZW50bHkgYWN0aXZlIG9yIGluIHNlbGYgcmVmcmVzaCBtb2RlLgorCSAqLworCWlm
ICghbmV3X3N0YXRlKQorCQlyZXR1cm4gZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5X2FjdGl2
ZShvbGRfc3RhdGUpOworCisJLyoKKwkgKiBXZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRoZSBjcnRj
X2Z1bmNzLT5kaXNhYmxlKCkgZnVuY3Rpb24gaWYgdGhlIGNydGMKKwkgKiBpcyBjdXJyZW50bHkg
b24sIGlmIGl0J3MgdHJhbnNpdGlvbmluZyB0byBzZWxmIHJlZnJlc2ggbW9kZSwgb3IgaWYKKwkg
KiBpdCdzIGluIHNlbGYgcmVmcmVzaCBtb2RlIGFuZCBuZWVkcyB0byBiZSBmdWxseSBkaXNhYmxl
ZC4KKwkgKi8KKwlyZXR1cm4gb2xkX3N0YXRlLT5hY3RpdmUgfHwKKwkgICAgICAgKG9sZF9zdGF0
ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSAmJiAhbmV3X3N0YXRlLT5lbmFibGUpIHx8CisJICAgICAg
IG5ld19zdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZTsKK30KKwogc3RhdGljIHZvaWQKIGRpc2Fi
bGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqb2xkX3N0YXRlKQogewpAQCAtOTc0LDcgKzk5OCwxNCBAQCBkaXNhYmxlX291dHB1dHMoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkK
IAogCQlvbGRfY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKG9sZF9z
dGF0ZSwgb2xkX2Nvbm5fc3RhdGUtPmNydGMpOwogCi0JCWlmICghb2xkX2NydGNfc3RhdGUtPmFj
dGl2ZSB8fAorCQlpZiAobmV3X2Nvbm5fc3RhdGUtPmNydGMpCisJCQluZXdfY3J0Y19zdGF0ZSA9
IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKAorCQkJCQkJb2xkX3N0YXRlLAorCQkJCQkJ
bmV3X2Nvbm5fc3RhdGUtPmNydGMpOworCQllbHNlCisJCQluZXdfY3J0Y19zdGF0ZSA9IE5VTEw7
CisKKwkJaWYgKCFjcnRjX25lZWRzX2Rpc2FibGUob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0
YXRlKSB8fAogCQkgICAgIWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KG9sZF9jb25uX3N0
YXRlLT5jcnRjLT5zdGF0ZSkpCiAJCQljb250aW51ZTsKIApAQCAtMTAyMCw3ICsxMDUxLDcgQEAg
ZGlzYWJsZV9vdXRwdXRzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpvbGRfc3RhdGUpCiAJCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQo
bmV3X2NydGNfc3RhdGUpKQogCQkJY29udGludWU7CiAKLQkJaWYgKCFvbGRfY3J0Y19zdGF0ZS0+
YWN0aXZlKQorCQlpZiAoIWNydGNfbmVlZHNfZGlzYWJsZShvbGRfY3J0Y19zdGF0ZSwgbmV3X2Ny
dGNfc3RhdGUpKQogCQkJY29udGludWU7CiAKIAkJZnVuY3MgPSBjcnRjLT5oZWxwZXJfcHJpdmF0
ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5j
IGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfc3RhdGVfaGVscGVyLmMKaW5kZXggYWM5Mjlm
NjhmZjMxLi5jYTE4MDA4MDQzZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRv
bWljX3N0YXRlX2hlbHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3N0YXRl
X2hlbHBlci5jCkBAIC0xMjgsNiArMTI4LDEwIEBAIHZvaWQgX19kcm1fYXRvbWljX2hlbHBlcl9j
cnRjX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJc3RhdGUtPmNvbW1p
dCA9IE5VTEw7CiAJc3RhdGUtPmV2ZW50ID0gTlVMTDsKIAlzdGF0ZS0+cGFnZWZsaXBfZmxhZ3Mg
PSAwOworCisJLyogU2VsZiByZWZyZXNoIHNob3VsZCBiZSBjYW5jZWxlZCB3aGVuIGEgbmV3IHVw
ZGF0ZSBpcyBhdmFpbGFibGUgKi8KKwlzdGF0ZS0+YWN0aXZlID0gZHJtX2F0b21pY19jcnRjX2Vm
ZmVjdGl2ZWx5X2FjdGl2ZShzdGF0ZSk7CisJc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUgPSBm
YWxzZTsKIH0KIEVYUE9SVF9TWU1CT0woX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2R1cGxpY2F0
ZV9zdGF0ZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGku
YyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGkuYwppbmRleCBlYTc5N2Q0YzgyZWUu
LmE3NWM2MzNmZjBjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfdWFw
aS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX3VhcGkuYwpAQCAtNDkwLDcgKzQ5
MCw3IEBAIGRybV9hdG9taWNfY3J0Y19nZXRfcHJvcGVydHkoc3RydWN0IGRybV9jcnRjICpjcnRj
LAogCXN0cnVjdCBkcm1fbW9kZV9jb25maWcgKmNvbmZpZyA9ICZkZXYtPm1vZGVfY29uZmlnOwog
CiAJaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+cHJvcF9hY3RpdmUpCi0JCSp2YWwgPSBzdGF0ZS0+
YWN0aXZlOworCQkqdmFsID0gZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5X2FjdGl2ZShzdGF0
ZSk7CiAJZWxzZSBpZiAocHJvcGVydHkgPT0gY29uZmlnLT5wcm9wX21vZGVfaWQpCiAJCSp2YWwg
PSAoc3RhdGUtPm1vZGVfYmxvYikgPyBzdGF0ZS0+bW9kZV9ibG9iLT5iYXNlLmlkIDogMDsKIAll
bHNlIGlmIChwcm9wZXJ0eSA9PSBjb25maWctPnByb3BfdnJyX2VuYWJsZWQpCkBAIC03NzIsNyAr
NzcyLDEwIEBAIGRybV9hdG9taWNfY29ubmVjdG9yX2dldF9wcm9wZXJ0eShzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yLAogCWlmIChwcm9wZXJ0eSA9PSBjb25maWctPnByb3BfY3J0Y19p
ZCkgewogCQkqdmFsID0gKHN0YXRlLT5jcnRjKSA/IHN0YXRlLT5jcnRjLT5iYXNlLmlkIDogMDsK
IAl9IGVsc2UgaWYgKHByb3BlcnR5ID09IGNvbmZpZy0+ZHBtc19wcm9wZXJ0eSkgewotCQkqdmFs
ID0gY29ubmVjdG9yLT5kcG1zOworCQlpZiAoc3RhdGUtPmNydGMgJiYgc3RhdGUtPmNydGMtPnN0
YXRlLT5zZWxmX3JlZnJlc2hfYWN0aXZlKQorCQkJKnZhbCA9IERSTV9NT0RFX0RQTVNfT047CisJ
CWVsc2UKKwkJCSp2YWwgPSBjb25uZWN0b3ItPmRwbXM7CiAJfSBlbHNlIGlmIChwcm9wZXJ0eSA9
PSBjb25maWctPnR2X3NlbGVjdF9zdWJjb25uZWN0b3JfcHJvcGVydHkpIHsKIAkJKnZhbCA9IHN0
YXRlLT50di5zdWJjb25uZWN0b3I7CiAJfSBlbHNlIGlmIChwcm9wZXJ0eSA9PSBjb25maWctPnR2
X2xlZnRfbWFyZ2luX3Byb3BlcnR5KSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJt
X3NlbGZfcmVmcmVzaF9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fc2VsZl9yZWZyZXNo
X2hlbHBlci5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYzcwODNj
NTY5NGZlCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9zZWxmX3JlZnJl
c2hfaGVscGVyLmMKQEAgLTAsMCArMSwyMTMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVy
OiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgKEMpIDIwMTkgR29vZ2xlLCBJbmMuCisgKgorICog
QXV0aG9yczoKKyAqIFNlYW4gUGF1bCA8c2VhbnBhdWxAY2hyb21pdW0ub3JnPgorICovCisjaW5j
bHVkZSA8ZHJtL2RybV9hdG9taWMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Nvbm5lY3Rvci5oPgorI2luY2x1ZGUgPGRybS9kcm1fY3J0
Yy5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tb2Rl
X2NvbmZpZy5oPgorI2luY2x1ZGUgPGRybS9kcm1fbW9kZXNldF9sb2NrLmg+CisjaW5jbHVkZSA8
ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5o
PgorI2luY2x1ZGUgPGxpbnV4L2JpdG9wcy5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNp
bmNsdWRlIDxsaW51eC93b3JrcXVldWUuaD4KKworLyoqCisgKiBET0M6IG92ZXJ2aWV3CisgKgor
ICogVGhpcyBoZWxwZXIgbGlicmFyeSBwcm92aWRlcyBhbiBlYXN5IHdheSBmb3IgZHJpdmVycyB0
byBsZXZlcmFnZSB0aGUgYXRvbWljCisgKiBmcmFtZXdvcmsgdG8gaW1wbGVtZW50IHBhbmVsIHNl
bGYgcmVmcmVzaCAoU1IpIHN1cHBvcnQuIERyaXZlcnMgYXJlCisgKiByZXNwb25zaWJsZSBmb3Ig
aW5pdGlhbGl6aW5nIGFuZCBjbGVhbmluZyB1cCB0aGUgU1IgaGVscGVycyBvbiBsb2FkL3VubG9h
ZAorICogKHNlZSAmZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfaW5pdC8mZHJtX3NlbGZfcmVmcmVz
aF9oZWxwZXJfY2xlYW51cCkuCisgKiBUaGUgY29ubmVjdG9yIGlzIHJlc3BvbnNpYmxlIGZvciBz
ZXR0aW5nCisgKiAmZHJtX2Nvbm5lY3Rvcl9zdGF0ZS5zZWxmX3JlZnJlc2hfYXdhcmUgdG8gdHJ1
ZSBhdCBydW50aW1lIGlmIGl0IGlzIFNSLWF3YXJlCisgKiAobWVhbmluZyBpdCBrbm93cyBob3cg
dG8gaW5pdGlhdGUgc2VsZiByZWZyZXNoIG9uIHRoZSBwYW5lbCkuCisgKgorICogT25jZSBhIGNy
dGMgaGFzIGVuYWJsZWQgU1IgdXNpbmcgJmRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQsIHRo
ZQorICogaGVscGVycyB3aWxsIG1vbml0b3IgYWN0aXZpdHkgYW5kIGNhbGwgYmFjayBpbnRvIHRo
ZSBkcml2ZXIgdG8gZW5hYmxlL2Rpc2FibGUKKyAqIFNSIGFzIGFwcHJvcHJpYXRlLiBUaGUgYmVz
dCB3YXkgdG8gdGhpbmsgYWJvdXQgdGhpcyBpcyB0aGF0IGl0J3MgYSBEUE1TCisgKiBvbi9vZmYg
cmVxdWVzdCB3aXRoICZkcm1fY3J0Y19zdGF0ZS5zZWxmX3JlZnJlc2hfYWN0aXZlIHNldCBpbiBj
cnRjIHN0YXRlCisgKiB0aGF0IHRlbGxzIHlvdSB0byBkaXNhYmxlL2VuYWJsZSBTUiBvbiB0aGUg
cGFuZWwgaW5zdGVhZCBvZiBwb3dlci1jeWNsaW5nIGl0LgorICoKKyAqIER1cmluZyBTUiwgZHJp
dmVycyBtYXkgY2hvb3NlIHRvIGZ1bGx5IGRpc2FibGUgdGhlaXIgY3J0Yy9lbmNvZGVyL2JyaWRn
ZQorICogaGFyZHdhcmUgKGluIHdoaWNoIGNhc2Ugbm8gZHJpdmVyIGNoYW5nZXMgYXJlIG5lY2Vz
c2FyeSksIG9yIHRoZXkgY2FuIGluc3BlY3QKKyAqICZkcm1fY3J0Y19zdGF0ZS5zZWxmX3JlZnJl
c2hfYWN0aXZlIGlmIHRoZXkgd2FudCB0byBlbnRlciBsb3cgcG93ZXIgbW9kZQorICogd2l0aG91
dCBmdWxsIGRpc2FibGUgKGluIGNhc2UgZnVsbCBkaXNhYmxlL2VuYWJsZSBpcyB0b28gc2xvdyku
CisgKgorICogU1Igd2lsbCBiZSBkZWFjdGl2YXRlZCBpZiB0aGVyZSBhcmUgYW55IGF0b21pYyB1
cGRhdGVzIGFmZmVjdGluZyB0aGUKKyAqIHBpcGUgdGhhdCBpcyBpbiBTUiBtb2RlLiBJZiBhIGNy
dGMgaXMgZHJpdmluZyBtdWx0aXBsZSBjb25uZWN0b3JzLCBhbGwKKyAqIGNvbm5lY3RvcnMgbXVz
dCBiZSBTUiBhd2FyZSBhbmQgYWxsIHdpbGwgZW50ZXIvZXhpdCBTUiBtb2RlIGF0IHRoZSBzYW1l
IHRpbWUuCisgKgorICogSWYgdGhlIGNydGMgYW5kIGNvbm5lY3RvciBhcmUgU1IgYXdhcmUsIGJ1
dCB0aGUgcGFuZWwgY29ubmVjdGVkIGRvZXMgbm90CisgKiBzdXBwb3J0IGl0IChvciBpcyBvdGhl
cndpc2UgdW5hYmxlIHRvIGVudGVyIFNSKSwgdGhlIGRyaXZlciBzaG91bGQgZmFpbAorICogYXRv
bWljX2NoZWNrIHdoZW4gJmRybV9jcnRjX3N0YXRlLnNlbGZfcmVmcmVzaF9hY3RpdmUgaXMgdHJ1
ZS4KKyAqLworCitzdHJ1Y3QgZHJtX3NlbGZfcmVmcmVzaF9kYXRhIHsKKwlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGM7CisJc3RydWN0IGRlbGF5ZWRfd29yayBlbnRyeV93b3JrOworCXN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzYXZlX3N0YXRlOworCXVuc2lnbmVkIGludCBlbnRyeV9kZWxheV9tczsK
K307CisKK3N0YXRpYyB2b2lkIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2VudHJ5X3dvcmsoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEg
KnNyX2RhdGEgPSBjb250YWluZXJfb2YoCisJCQkJdG9fZGVsYXllZF93b3JrKHdvcmspLAorCQkJ
CXN0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGEsIGVudHJ5X3dvcmspOworCXN0cnVjdCBkcm1f
Y3J0YyAqY3J0YyA9IHNyX2RhdGEtPmNydGM7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNy
dGMtPmRldjsKKwlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggY3R4OworCXN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKKwlz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGNf
c3RhdGUgKmNydGNfc3RhdGU7CisJaW50IGksIHJldDsKKworCWRybV9tb2Rlc2V0X2FjcXVpcmVf
aW5pdCgmY3R4LCAwKTsKKworCXN0YXRlID0gZHJtX2F0b21pY19zdGF0ZV9hbGxvYyhkZXYpOwor
CWlmICghc3RhdGUpIHsKKwkJcmV0ID0gLUVOT01FTTsKKwkJZ290byBvdXQ7CisJfQorCityZXRy
eToKKwlzdGF0ZS0+YWNxdWlyZV9jdHggPSAmY3R4OworCisJY3J0Y19zdGF0ZSA9IGRybV9hdG9t
aWNfZ2V0X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOworCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkp
IHsKKwkJcmV0ID0gUFRSX0VSUihjcnRjX3N0YXRlKTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYg
KCFjcnRjX3N0YXRlLT5lbmFibGUpCisJCWdvdG8gb3V0OworCisJcmV0ID0gZHJtX2F0b21pY19h
ZGRfYWZmZWN0ZWRfY29ubmVjdG9ycyhzdGF0ZSwgY3J0Yyk7CisJaWYgKHJldCkKKwkJZ290byBv
dXQ7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBjb25uLCBjb25u
X3N0YXRlLCBpKSB7CisJCWlmICghY29ubl9zdGF0ZS0+c2VsZl9yZWZyZXNoX2F3YXJlKQorCQkJ
Z290byBvdXQ7CisJfQorCisJY3J0Y19zdGF0ZS0+YWN0aXZlID0gZmFsc2U7CisJY3J0Y19zdGF0
ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZSA9IHRydWU7CisKKwlyZXQgPSBkcm1fYXRvbWljX2NvbW1p
dChzdGF0ZSk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKK291dDoKKwlpZiAocmV0ID09IC1F
REVBRExLKSB7CisJCWRybV9hdG9taWNfc3RhdGVfY2xlYXIoc3RhdGUpOworCQlyZXQgPSBkcm1f
bW9kZXNldF9iYWNrb2ZmKCZjdHgpOworCQlpZiAoIXJldCkKKwkJCWdvdG8gcmV0cnk7CisJfQor
CisJZHJtX2F0b21pY19zdGF0ZV9wdXQoc3RhdGUpOworCWRybV9tb2Rlc2V0X2Ryb3BfbG9ja3Mo
JmN0eCk7CisJZHJtX21vZGVzZXRfYWNxdWlyZV9maW5pKCZjdHgpOworfQorCisvKioKKyAqIGRy
bV9zZWxmX3JlZnJlc2hfaGVscGVyX2FsdGVyX3N0YXRlIC0gQWx0ZXJzIHRoZSBhdG9taWMgc3Rh
dGUgZm9yIFNSIGV4aXQKKyAqIEBzdGF0ZTogdGhlIHN0YXRlIGN1cnJlbnRseSBiZWluZyBjaGVj
a2VkCisgKgorICogQ2FsbGVkIGF0IHRoZSBlbmQgb2YgYXRvbWljIGNoZWNrLiBUaGlzIGZ1bmN0
aW9uIGNoZWNrcyB0aGUgc3RhdGUgZm9yIGZsYWdzCisgKiBpbmNvbXBhdGlibGUgd2l0aCBzZWxm
IHJlZnJlc2ggZXhpdCBhbmQgY2hhbmdlcyB0aGVtLiBUaGlzIGlzIGEgYml0CisgKiBkaXNpbmdl
bnVvdXMgc2luY2UgdXNlcnNwYWNlIGlzIGV4cGVjdGluZyBvbmUgdGhpbmcgYW5kIHdlJ3JlIGdp
dmluZyBpdAorICogYW5vdGhlci4gSG93ZXZlciBpbiBvcmRlciB0byBrZWVwIHNlbGYgcmVmcmVz
aCBlbnRpcmVseSBoaWRkZW4gZnJvbQorICogdXNlcnNwYWNlLCB0aGlzIGlzIHJlcXVpcmVkLgor
ICoKKyAqIEF0IHRoZSBlbmQsIHdlIHF1ZXVlIHVwIHRoZSBzZWxmIHJlZnJlc2ggZW50cnkgd29y
ayBzbyB3ZSBjYW4gZW50ZXIgUFNSIGFmdGVyCisgKiB0aGUgZGVzaXJlZCBkZWxheS4KKyAqLwor
dm9pZCBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9hbHRlcl9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9jcnRjICpjcnRjOworCXN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlpbnQgaTsKKworCWlmIChzdGF0ZS0+YXN5bmNfdXBk
YXRlIHx8ICFzdGF0ZS0+YWxsb3dfbW9kZXNldCkgeworCQlmb3JfZWFjaF9vbGRfY3J0Y19pbl9z
dGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgeworCQkJaWYgKGNydGNfc3RhdGUtPnNl
bGZfcmVmcmVzaF9hY3RpdmUpIHsKKwkJCQlzdGF0ZS0+YXN5bmNfdXBkYXRlID0gZmFsc2U7CisJ
CQkJc3RhdGUtPmFsbG93X21vZGVzZXQgPSB0cnVlOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJ
fQorCisJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUs
IGkpIHsKKwkJc3RydWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3JfZGF0YTsKKworCQkvKiBE
b24ndCB0cmlnZ2VyIHRoZSBlbnRyeSB0aW1lciB3aGVuIHdlJ3JlIGFscmVhZHkgaW4gU1IgKi8K
KwkJaWYgKGNydGNfc3RhdGUtPnNlbGZfcmVmcmVzaF9hY3RpdmUpCisJCQljb250aW51ZTsKKwor
CQlzcl9kYXRhID0gY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGE7CisJCWlmICghc3JfZGF0YSkKKwkJ
CWNvbnRpbnVlOworCisJCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmc3JfZGF0YS0+ZW50
cnlfd29yaywKKwkJCQkgbXNlY3NfdG9famlmZmllcyhzcl9kYXRhLT5lbnRyeV9kZWxheV9tcykp
OworCX0KK30KK0VYUE9SVF9TWU1CT0woZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfYWx0ZXJfc3Rh
dGUpOworCisvKioKKyAqIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQgLSBJbml0aWFsaXpl
cyBzZWxmIHJlZnJlc2ggaGVscGVycyBmb3IgYSBjcnRjCisgKiBAY3J0YzogdGhlIGNydGMgd2hp
Y2ggc3VwcG9ydHMgc2VsZiByZWZyZXNoIHN1cHBvcnRlZCBkaXNwbGF5cworICogQGVudHJ5X2Rl
bGF5X21zOiBhbW91bnQgb2YgaW5hY3Rpdml0eSB0byB3YWl0IGJlZm9yZSBlbnRlcmluZyBzZWxm
IHJlZnJlc2gKKyAqLworaW50IGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQoc3RydWN0IGRy
bV9jcnRjICpjcnRjLAorCQkJCSB1bnNpZ25lZCBpbnQgZW50cnlfZGVsYXlfbXMpCit7CisJc3Ry
dWN0IGRybV9zZWxmX3JlZnJlc2hfZGF0YSAqc3JfZGF0YSA9IGNydGMtPnNlbGZfcmVmcmVzaF9k
YXRhOworCisJLyogSGVscGVyIGlzIGFscmVhZHkgaW5pdGlhbGl6ZWQgKi8KKwlpZiAoV0FSTl9P
Tihzcl9kYXRhKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlzcl9kYXRhID0ga3phbGxvYyhzaXpl
b2YoKnNyX2RhdGEpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXNyX2RhdGEpCisJCXJldHVybiAtRU5P
TUVNOworCisJSU5JVF9ERUxBWUVEX1dPUksoJnNyX2RhdGEtPmVudHJ5X3dvcmssCisJCQkgIGRy
bV9zZWxmX3JlZnJlc2hfaGVscGVyX2VudHJ5X3dvcmspOworCXNyX2RhdGEtPmVudHJ5X2RlbGF5
X21zID0gZW50cnlfZGVsYXlfbXM7CisJc3JfZGF0YS0+Y3J0YyA9IGNydGM7CisKKwljcnRjLT5z
ZWxmX3JlZnJlc2hfZGF0YSA9IHNyX2RhdGE7CisJcmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9M
KGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2luaXQpOworCisvKioKKyAqIGRybV9zZWxmX3JlZnJl
c2hfaGVscGVyX2NsZWFudXAgLSBDbGVhbnMgdXAgc2VsZiByZWZyZXNoIGhlbHBlcnMgZm9yIGEg
Y3J0YworICogQGNydGM6IHRoZSBjcnRjIHRvIGNsZWFudXAKKyAqLwordm9pZCBkcm1fc2VsZl9y
ZWZyZXNoX2hlbHBlcl9jbGVhbnVwKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3Qg
ZHJtX3NlbGZfcmVmcmVzaF9kYXRhICpzcl9kYXRhID0gY3J0Yy0+c2VsZl9yZWZyZXNoX2RhdGE7
CisKKwkvKiBIZWxwZXIgaXMgYWxyZWFkeSB1bmluaXRpYWxpemVkICovCisJaWYgKHNyX2RhdGEp
CisJCXJldHVybjsKKworCWNydGMtPnNlbGZfcmVmcmVzaF9kYXRhID0gTlVMTDsKKworCWNhbmNl
bF9kZWxheWVkX3dvcmtfc3luYygmc3JfZGF0YS0+ZW50cnlfd29yayk7CisJa2ZyZWUoc3JfZGF0
YSk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2NsZWFudXApOwpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oIGIvaW5jbHVkZS9kcm0vZHJtX2F0
b21pYy5oCmluZGV4IGQ2YjNhY2QzNGUxYy4uZjc2Nzc3YzcyMjY0IDEwMDY0NAotLS0gYS9pbmNs
dWRlL2RybS9kcm1fYXRvbWljLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oCkBAIC05
NTEsNCArOTUxLDE5IEBAIGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KGNvbnN0IHN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUpCiAJICAgICAgIHN0YXRlLT5jb25uZWN0b3JzX2NoYW5n
ZWQ7CiB9CiAKKy8qKgorICogZHJtX2F0b21pY19jcnRjX2VmZmVjdGl2ZWx5X2FjdGl2ZSAtIGNv
bXB1dGUgd2hldGhlciBjcnRjIGlzIGFjdHVhbGx5IGFjdGl2ZQorICogQHN0YXRlOiAmZHJtX2Ny
dGNfc3RhdGUgZm9yIHRoZSBDUlRDCisgKgorICogV2hlbiBpbiBzZWxmIHJlZnJlc2ggbW9kZSwg
dGhlIGNydGNfc3RhdGUtPmFjdGl2ZSB2YWx1ZSB3aWxsIGJlIGZhbHNlLCBzaW5jZQorICogdGhl
IGNydGMgaXMgb2ZmLiBIb3dldmVyIGluIHNvbWUgY2FzZXMgd2UncmUgaW50ZXJlc3RlZCBpbiB3
aGV0aGVyIHRoZSBjcnRjCisgKiBpcyBhY3RpdmUsIG9yIGVmZmVjdGl2ZWx5IGFjdGl2ZSAoaWU6
IGl0J3MgY29ubmVjdGVkIHRvIGFuIGFjdGl2ZSBkaXNwbGF5KS4KKyAqIEluIHRoZXNlIGNhc2Vz
LCB1c2UgdGhpcyBmdW5jdGlvbiBpbnN0ZWFkIG9mIGp1c3QgY2hlY2tpbmcgYWN0aXZlLgorICov
CitzdGF0aWMgaW5saW5lIGJvb2wKK2RybV9hdG9taWNfY3J0Y19lZmZlY3RpdmVseV9hY3RpdmUo
Y29uc3Qgc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKK3sKKwlyZXR1cm4gc3RhdGUtPmFj
dGl2ZSB8fCBzdGF0ZS0+c2VsZl9yZWZyZXNoX2FjdGl2ZTsKK30KKwogI2VuZGlmIC8qIERSTV9B
VE9NSUNfSF8gKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaCBiL2lu
Y2x1ZGUvZHJtL2RybV9jb25uZWN0b3IuaAppbmRleCBmNDNmNDBkNTg4OGEuLjAyZDBjNzNlMjY3
ZCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2Nvbm5lY3Rvci5oCisrKyBiL2luY2x1ZGUv
ZHJtL2RybV9jb25uZWN0b3IuaApAQCAtNTQzLDYgKzU0MywyMCBAQCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSB7CiAJLyoqIEB0djogVFYgY29ubmVjdG9yIHN0YXRlICovCiAJc3RydWN0IGRy
bV90dl9jb25uZWN0b3Jfc3RhdGUgdHY7CiAKKwkvKioKKwkgKiBAc2VsZl9yZWZyZXNoX2F3YXJl
OgorCSAqCisJICogVGhpcyB0cmFja3Mgd2hldGhlciBhIGNvbm5lY3RvciBpcyBhd2FyZSBvZiB0
aGUgc2VsZiByZWZyZXNoIHN0YXRlLgorCSAqIEl0IHNob3VsZCBiZSBzZXQgdG8gdHJ1ZSBmb3Ig
dGhvc2UgY29ubmVjdG9yIGltcGxlbWVudGF0aW9ucyB3aGljaAorCSAqIHVuZGVyc3RhbmQgdGhl
IHNlbGYgcmVmcmVzaCBzdGF0ZS4gVGhpcyBpcyBuZWVkZWQgc2luY2UgdGhlIGNydGMKKwkgKiBy
ZWdpc3RlcnMgdGhlIHNlbGYgcmVmcmVzaCBoZWxwZXJzIGFuZCBpdCBkb2Vzbid0IGtub3cgaWYg
dGhlCisJICogY29ubmVjdG9ycyBkb3duc3RyZWFtIGhhdmUgaW1wbGVtZW50ZWQgc2VsZiByZWZy
ZXNoIGVudHJ5L2V4aXQuCisJICoKKwkgKiBEcml2ZXJzIHNob3VsZCBzZXQgdGhpcyB0byB0cnVl
IGluIGF0b21pY19jaGVjayBpZiB0aGV5IGtub3cgaG93IHRvCisJICogaGFuZGxlIHNlbGZfcmVm
cmVzaCByZXF1ZXN0cy4KKwkgKi8KKwlib29sIHNlbGZfcmVmcmVzaF9hd2FyZTsKKwogCS8qKgog
CSAqIEBwaWN0dXJlX2FzcGVjdF9yYXRpbzogQ29ubmVjdG9yIHByb3BlcnR5IHRvIGNvbnRyb2wg
dGhlCiAJICogSERNSSBpbmZvZnJhbWUgYXNwZWN0IHJhdGlvIHNldHRpbmcuCmRpZmYgLS1naXQg
YS9pbmNsdWRlL2RybS9kcm1fY3J0Yy5oIGIvaW5jbHVkZS9kcm0vZHJtX2NydGMuaAppbmRleCA1
OGFkOTgzZDdjZDYuLjY3ZTMwNzVhODc4NCAxMDA2NDQKLS0tIGEvaW5jbHVkZS9kcm0vZHJtX2Ny
dGMuaAorKysgYi9pbmNsdWRlL2RybS9kcm1fY3J0Yy5oCkBAIC01Myw2ICs1Myw3IEBAIHN0cnVj
dCBkcm1fbW9kZV9zZXQ7CiBzdHJ1Y3QgZHJtX2ZpbGU7CiBzdHJ1Y3QgZHJtX2NsaXBfcmVjdDsK
IHN0cnVjdCBkcm1fcHJpbnRlcjsKK3N0cnVjdCBkcm1fc2VsZl9yZWZyZXNoX2RhdGE7CiBzdHJ1
Y3QgZGV2aWNlX25vZGU7CiBzdHJ1Y3QgZG1hX2ZlbmNlOwogc3RydWN0IGVkaWQ7CkBAIC0yOTks
NiArMzAwLDE3IEBAIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSB7CiAJICovCiAJYm9vbCB2cnJfZW5h
YmxlZDsKIAorCS8qKgorCSAqIEBzZWxmX3JlZnJlc2hfYWN0aXZlOgorCSAqCisJICogVXNlZCBi
eSB0aGUgc2VsZiByZWZyZXNoIGhlbHBlcnMgdG8gZGVub3RlIHdoZW4gYSBzZWxmIHJlZnJlc2gK
KwkgKiB0cmFuc2l0aW9uIGlzIG9jY3VyaW5nLiBUaGlzIHdpbGwgYmUgc2V0IG9uIGVuYWJsZS9k
aXNhYmxlIGNhbGxiYWNrcworCSAqIHdoZW4gc2VsZiByZWZyZXNoIGlzIGJlaW5nIGVuYWJsZWQg
b3IgZGlzYWJsZWQuIEluIHNvbWUgY2FzZXMsIGl0IG1heQorCSAqIG5vdCBiZSBkZXNpcmFibGUg
dG8gZnVsbHkgc2h1dCBvZmYgdGhlIGNydGMgZHVyaW5nIHNlbGYgcmVmcmVzaC4KKwkgKiBDUlRD
J3MgY2FuIGluc3BlY3QgdGhpcyBmbGFnIGFuZCBkZXRlcm1pbmUgdGhlIGJlc3QgY291cnNlIG9m
IGFjdGlvbi4KKwkgKi8KKwlib29sIHNlbGZfcmVmcmVzaF9hY3RpdmU7CisKIAkvKioKIAkgKiBA
ZXZlbnQ6CiAJICoKQEAgLTEwODcsNiArMTA5OSwxMyBAQCBzdHJ1Y3QgZHJtX2NydGMgewogCSAq
IFRoZSBuYW1lIG9mIHRoZSBDUlRDJ3MgZmVuY2UgdGltZWxpbmUuCiAJICovCiAJY2hhciB0aW1l
bGluZV9uYW1lWzMyXTsKKworCS8qKgorCSAqIEBzZWxmX3JlZnJlc2hfZGF0YTogSG9sZHMgdGhl
IHN0YXRlIGZvciB0aGUgc2VsZiByZWZyZXNoIGhlbHBlcnMKKwkgKgorCSAqIEluaXRpYWxpemVk
IHZpYSBkcm1fc2VsZl9yZWZyZXNoX2hlbHBlcl9yZWdpc3RlcigpLgorCSAqLworCXN0cnVjdCBk
cm1fc2VsZl9yZWZyZXNoX2RhdGEgKnNlbGZfcmVmcmVzaF9kYXRhOwogfTsKIAogLyoqCmRpZmYg
LS1naXQgYS9pbmNsdWRlL2RybS9kcm1fc2VsZl9yZWZyZXNoX2hlbHBlci5oIGIvaW5jbHVkZS9k
cm0vZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXIuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjQwNWU4NmZiODQ2MQotLS0gL2Rldi9udWxsCisrKyBiL2luY2x1ZGUvZHJt
L2RybV9zZWxmX3JlZnJlc2hfaGVscGVyLmgKQEAgLTAsMCArMSwyMiBAQAorLyogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdodCAoQykgMjAxOSBHb29nbGUs
IEluYy4KKyAqCisgKiBBdXRob3JzOgorICogU2VhbiBQYXVsIDxzZWFucGF1bEBjaHJvbWl1bS5v
cmc+CisgKi8KKyNpZm5kZWYgRFJNX1NFTEZfUkVGUkVTSF9IRUxQRVJfSF8KKyNkZWZpbmUgRFJN
X1NFTEZfUkVGUkVTSF9IRUxQRVJfSF8KKworc3RydWN0IGRybV9hdG9taWNfc3RhdGU7CitzdHJ1
Y3QgZHJtX2Nvbm5lY3RvcjsKK3N0cnVjdCBkcm1fZGV2aWNlOworc3RydWN0IGRybV9tb2Rlc2V0
X2FjcXVpcmVfY3R4OworCit2b2lkIGRybV9zZWxmX3JlZnJlc2hfaGVscGVyX2FsdGVyX3N0YXRl
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSk7CisKK2ludCBkcm1fc2VsZl9yZWZyZXNo
X2hlbHBlcl9pbml0KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKKwkJCQkgICAgIHVuc2lnbmVkIGlu
dCBlbnRyeV9kZWxheV9tcyk7CisKK3ZvaWQgZHJtX3NlbGZfcmVmcmVzaF9oZWxwZXJfY2xlYW51
cChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpOworI2VuZGlmCi0tIApTZWFuIFBhdWwsIFNvZnR3YXJl
IEVuZ2luZWVyLCBHb29nbGUgLyBDaHJvbWl1bSBPUwoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVs
