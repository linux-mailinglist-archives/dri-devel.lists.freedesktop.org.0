Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 786D87C02D
	for <lists+dri-devel@lfdr.de>; Wed, 31 Jul 2019 13:39:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B83F089D49;
	Wed, 31 Jul 2019 11:38:57 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-wr1-x443.google.com (mail-wr1-x443.google.com
 [IPv6:2a00:1450:4864:20::443])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D36DC89D49
 for <dri-devel@lists.freedesktop.org>; Wed, 31 Jul 2019 11:38:56 +0000 (UTC)
Received: by mail-wr1-x443.google.com with SMTP id g17so69304548wrr.5
 for <dri-devel@lists.freedesktop.org>; Wed, 31 Jul 2019 04:38:56 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vHdzYpB0uv0xuE5Pz8nXUVwJiZDrFatDJaQ/ICnTeQk=;
 b=r/HeaD8j6wXQIlIIFJL5+SAp/9pjXbqw0Q4mx1suUKJWAEvH1jNWdMBwesrp7dAg6F
 TOPl7tuQAIb7S7fHu2AjyesCLhzsZikKxmHkzN9CCCACvjPI+unJnerW22lCcx0kqVc6
 mmo3CGtnjnRY2+oWR2lVP2J0uVCAzZ2zrAw/MLYn5lWKMdgoaUEGtkKzce/+xLacdWrP
 iZfMH8Nmdmjvw/dsR0Ioig51bZEmyzcXfa/scWSufMSCjF2ADOZUeOAq2ywZomDgva/Y
 Biea8LwjrBUcp8a8Ck2JmGWC524ulWaQn8MNBZImh1S8Sv7PCpjWBM43pgfaQRpjDcQK
 S0eg==
X-Gm-Message-State: APjAAAWQTBbP+ctR0WEi5gR7zpXJOJ8yM9wYv/9ymNXPHKn/xRYaqCoQ
 7KkbGJIALBrfjNf2yr2R7N4=
X-Google-Smtp-Source: APXvYqz5f5HBPVD9+q45yele9w8fRLMgjQ11isBCooRTOf8R98Jcr7JlMCci2tBOsrrr6rrG5rVvRQ==
X-Received: by 2002:a5d:4fc8:: with SMTP id h8mr18846475wrw.177.1564573135263; 
 Wed, 31 Jul 2019 04:38:55 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:a8c5:b5fa:d4be:a3b2])
 by smtp.gmail.com with ESMTPSA id e3sm57237050wrt.93.2019.07.31.04.38.54
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Wed, 31 Jul 2019 04:38:54 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: sumit.semwal@linaro.org, linux-media@vger.kernel.org,
 dri-devel@lists.freedesktop.org, linaro-mm-sig@lists.linaro.org,
 chris@chris-wilson.co.uk
Subject: [PATCH] dma-buf: add more reservation object locking wrappers
Date: Wed, 31 Jul 2019 13:38:53 +0200
Message-Id: <20190731113853.51779-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vHdzYpB0uv0xuE5Pz8nXUVwJiZDrFatDJaQ/ICnTeQk=;
 b=dOHR3eq/h37lIYKLQq74Wsi2jzTPHAei8TjSPCKk15SlkxIkY94RCLILiDCyEe2Tlz
 5QOqep2eH1okU9pyeV0YW/wMHalTUu2Sp2bMplXKBMDynYTLPNSAKStF4qqR8qqqEGLJ
 GPDczXxYJNkl4am1LjyH6ordA08OaRoaDx6lRy17k06aUx1CzB/p1tNcQsGNvO4Dvpht
 AaBAVe+GvUNjZGYLXoRXhn0WVv3KH1tfpwr83QJz3CYTAAPsLtP1EBS0Jm0oFB2WHlJd
 YA9lxqWM5DXN8Xlpmvo6vkPHXntQ9FwKEWrio3It7OoFT4dE6af3H41an4u3x3gOhnK5
 CHRg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Q29tcGxldGUgdGhlIGFic3RyYWN0aW9uIG9mIHRoZSB3d19tdXRleCBpbnNpZGUgdGhlIHJlc2Vy
dmF0aW9uIG9iamVjdC4KClRoaXMgYWxsb3dzIHVzIHRvIGFkZCBtb3JlIGhhbmRsaW5nIGFuZCBk
ZWJ1Z2dpbmcgdG8gdGhlIHJlc2VydmF0aW9uCm9iamVjdCBpbiB0aGUgZnV0dXJlLgoKU2lnbmVk
LW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jICAgICAgfCAgMiArLQogZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2RtYV9idWYuYyB8ICA2ICstLQogZHJpdmVy
cy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jICB8ICA2ICstLQogZHJpdmVycy9n
cHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9k
cm0vZHJtX2dlbS5jICAgICAgICAgICAgICAgICAgIHwgMTQgKystLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfcHJpbWUuYyAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL3Jh
ZGVvbi9yYWRlb25fb2JqZWN0LmMgICAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL3JhZGVv
bi9yYWRlb25fcHJpbWUuYyAgICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9i
by5jICAgICAgICAgICAgICAgIHwgMTAgKystLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhl
Y2J1Zl91dGlsLmMgICAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
YmxpdC5jICAgICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5j
ICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2NvdGFibGUu
YyAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcmVzb3VyY2UuYyAg
ICB8ICA2ICstLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCAgICAgICAgICAgICB8
ICA2ICstLQogaW5jbHVkZS9saW51eC9yZXNlcnZhdGlvbi5oICAgICAgICAgICAgICAgICB8IDU3
ICsrKysrKysrKysrKysrKysrKysrKwogMTYgZmlsZXMgY2hhbmdlZCwgMTAwIGluc2VydGlvbnMo
KyksIDQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2NzLmMK
aW5kZXggNGIxZTRiMzIxOTk5Li5mNDg2YzIzZmEyNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9jcy5jCkBAIC0xNzI1LDcgKzE3MjUsNyBAQCBpbnQgYW1kZ3B1X2NzX2ZpbmRf
bWFwcGluZyhzdHJ1Y3QgYW1kZ3B1X2NzX3BhcnNlciAqcGFyc2VyLAogCSptYXAgPSBtYXBwaW5n
OwogCiAJLyogRG91YmxlIGNoZWNrIHRoYXQgdGhlIEJPIGlzIHJlc2VydmVkIGJ5IHRoaXMgQ1Mg
Ki8KLQlpZiAoUkVBRF9PTkNFKCgqYm8pLT50Ym8ucmVzdi0+bG9jay5jdHgpICE9ICZwYXJzZXIt
PnRpY2tldCkKKwlpZiAocmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tpbmdfY3R4KCgqYm8pLT50Ym8u
cmVzdikgIT0gJnBhcnNlci0+dGlja2V0KQogCQlyZXR1cm4gLUVJTlZBTDsKIAogCWlmICghKCgq
Ym8pLT5mbGFncyAmIEFNREdQVV9HRU1fQ1JFQVRFX1ZSQU1fQ09OVElHVU9VUykpIHsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9kbWFfYnVmLmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZG1hX2J1Zi5jCmluZGV4IDY3NzBlYjM5Njdh
Ni4uZTFkMmM0MTBiYzMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9h
bWRncHVfZG1hX2J1Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9k
bWFfYnVmLmMKQEAgLTM5OCw3ICszOTgsNyBAQCBhbWRncHVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190
YWJsZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCWJwLmZsYWdzID0gMDsKIAlicC50eXBlID0g
dHRtX2JvX3R5cGVfc2c7CiAJYnAucmVzdiA9IHJlc3Y7Ci0Jd3dfbXV0ZXhfbG9jaygmcmVzdi0+
bG9jaywgTlVMTCk7CisJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2socmVzdiwgTlVMTCk7CiAJcmV0
ID0gYW1kZ3B1X2JvX2NyZWF0ZShhZGV2LCAmYnAsICZibyk7CiAJaWYgKHJldCkKIAkJZ290byBl
cnJvcjsKQEAgLTQxMCwxMSArNDEwLDExIEBAIGFtZGdwdV9nZW1fcHJpbWVfaW1wb3J0X3NnX3Rh
YmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYgKGF0dGFjaC0+ZG1hYnVmLT5vcHMgIT0g
JmFtZGdwdV9kbWFidWZfb3BzKQogCQliby0+cHJpbWVfc2hhcmVkX2NvdW50ID0gMTsKIAotCXd3
X211dGV4X3VubG9jaygmcmVzdi0+bG9jayk7CisJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jayhy
ZXN2KTsKIAlyZXR1cm4gJmJvLT5nZW1fYmFzZTsKIAogZXJyb3I6Ci0Jd3dfbXV0ZXhfdW5sb2Nr
KCZyZXN2LT5sb2NrKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOwogCXJldHVy
biBFUlJfUFRSKHJldCk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1k
Z3B1L2FtZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9v
YmplY3QuYwppbmRleCA4NzAyMDYyOGE2NmUuLmMzMWU5NjkyNTg5MiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtNTUzLDcgKzU1Myw3IEBAIHN0YXRp
YyBpbnQgYW1kZ3B1X2JvX2RvX2NyZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAog
ZmFpbF91bnJlc2VydmU6CiAJaWYgKCFicC0+cmVzdikKLQkJd3dfbXV0ZXhfdW5sb2NrKCZiby0+
dGJvLnJlc3YtPmxvY2spOworCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKGJvLT50Ym8ucmVz
dik7CiAJYW1kZ3B1X2JvX3VucmVmKCZibyk7CiAJcmV0dXJuIHI7CiB9CkBAIC0xMDk2LDcgKzEw
OTYsNyBAQCBpbnQgYW1kZ3B1X2JvX3NldF90aWxpbmdfZmxhZ3Moc3RydWN0IGFtZGdwdV9ibyAq
Ym8sIHU2NCB0aWxpbmdfZmxhZ3MpCiAgKi8KIHZvaWQgYW1kZ3B1X2JvX2dldF90aWxpbmdfZmxh
Z3Moc3RydWN0IGFtZGdwdV9ibyAqYm8sIHU2NCAqdGlsaW5nX2ZsYWdzKQogewotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJmJvLT50Ym8ucmVzdi0+bG9jay5iYXNlKTsKKwlyZXNlcnZhdGlvbl9vYmpl
Y3RfYXNzZXJ0X2hlbGQoYm8tPnRiby5yZXN2KTsKIAogCWlmICh0aWxpbmdfZmxhZ3MpCiAJCSp0
aWxpbmdfZmxhZ3MgPSBiby0+dGlsaW5nX2ZsYWdzOwpAQCAtMTMzNyw3ICsxMzM3LDcgQEAgaW50
IGFtZGdwdV9ib19zeW5jX3dhaXQoc3RydWN0IGFtZGdwdV9ibyAqYm8sIHZvaWQgKm93bmVyLCBi
b29sIGludHIpCiB1NjQgYW1kZ3B1X2JvX2dwdV9vZmZzZXQoc3RydWN0IGFtZGdwdV9ibyAqYm8p
CiB7CiAJV0FSTl9PTl9PTkNFKGJvLT50Ym8ubWVtLm1lbV90eXBlID09IFRUTV9QTF9TWVNURU0p
OwotCVdBUk5fT05fT05DRSghd3dfbXV0ZXhfaXNfbG9ja2VkKCZiby0+dGJvLnJlc3YtPmxvY2sp
ICYmCisJV0FSTl9PTl9PTkNFKCFyZXNlcnZhdGlvbl9vYmplY3RfaXNfbG9ja2VkKGJvLT50Ym8u
cmVzdikgJiYKIAkJICAgICAhYm8tPnBpbl9jb3VudCAmJiBiby0+dGJvLnR5cGUgIT0gdHRtX2Jv
X3R5cGVfa2VybmVsKTsKIAlXQVJOX09OX09OQ0UoYm8tPnRiby5tZW0uc3RhcnQgPT0gQU1ER1BV
X0JPX0lOVkFMSURfT0ZGU0VUKTsKIAlXQVJOX09OX09OQ0UoYm8tPnRiby5tZW0ubWVtX3R5cGUg
PT0gVFRNX1BMX1ZSQU0gJiYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV92bS5jIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3ZtLmMKaW5k
ZXggYzFiYWYzZDg3OWI3Li5lOWRmMGIxMGEzN2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV92bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV92bS5jCkBAIC0yNDE2LDcgKzI0MTYsOCBAQCB2b2lkIGFtZGdwdV92bV9ib190cmFj
ZV9jcyhzdHJ1Y3QgYW1kZ3B1X3ZtICp2bSwgc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQp
CiAJCQlzdHJ1Y3QgYW1kZ3B1X2JvICpibzsKIAogCQkJYm8gPSBtYXBwaW5nLT5ib192YS0+YmFz
ZS5ibzsKLQkJCWlmIChSRUFEX09OQ0UoYm8tPnRiby5yZXN2LT5sb2NrLmN0eCkgIT0gdGlja2V0
KQorCQkJaWYgKHJlc2VydmF0aW9uX29iamVjdF9sb2NraW5nX2N0eChiby0+dGJvLnJlc3YpICE9
CisJCQkgICAgdGlja2V0KQogCQkJCWNvbnRpbnVlOwogCQl9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9kcm1fZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbS5jCmluZGV4IDUw
ZGUxMzhjODllMC4uMDRjMDMwN2NhNTRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJt
X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZ2VtLmMKQEAgLTEzMTYsOCArMTMxNiw4
IEBAIGRybV9nZW1fbG9ja19yZXNlcnZhdGlvbnMoc3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2Jq
cywgaW50IGNvdW50LAogCWlmIChjb250ZW5kZWQgIT0gLTEpIHsKIAkJc3RydWN0IGRybV9nZW1f
b2JqZWN0ICpvYmogPSBvYmpzW2NvbnRlbmRlZF07CiAKLQkJcmV0ID0gd3dfbXV0ZXhfbG9ja19z
bG93X2ludGVycnVwdGlibGUoJm9iai0+cmVzdi0+bG9jaywKLQkJCQkJCSAgICAgICBhY3F1aXJl
X2N0eCk7CisJCXJldCA9IHJlc2VydmF0aW9uX29iamVjdF9sb2NrX3Nsb3dfaW50ZXJydXB0aWJs
ZShvYmotPnJlc3YsCisJCQkJCQkJCSBhY3F1aXJlX2N0eCk7CiAJCWlmIChyZXQpIHsKIAkJCXd3
X2FjcXVpcmVfZG9uZShhY3F1aXJlX2N0eCk7CiAJCQlyZXR1cm4gcmV0OwpAQCAtMTMyOCwxNiAr
MTMyOCwxNiBAQCBkcm1fZ2VtX2xvY2tfcmVzZXJ2YXRpb25zKHN0cnVjdCBkcm1fZ2VtX29iamVj
dCAqKm9ianMsIGludCBjb3VudCwKIAkJaWYgKGkgPT0gY29udGVuZGVkKQogCQkJY29udGludWU7
CiAKLQkJcmV0ID0gd3dfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZvYmpzW2ldLT5yZXN2LT5s
b2NrLAotCQkJCQkJICBhY3F1aXJlX2N0eCk7CisJCXJldCA9IHJlc2VydmF0aW9uX29iamVjdF9s
b2NrX2ludGVycnVwdGlibGUob2Jqc1tpXS0+cmVzdiwKKwkJCQkJCQkgICAgYWNxdWlyZV9jdHgp
OwogCQlpZiAocmV0KSB7CiAJCQlpbnQgajsKIAogCQkJZm9yIChqID0gMDsgaiA8IGk7IGorKykK
LQkJCQl3d19tdXRleF91bmxvY2soJm9ianNbal0tPnJlc3YtPmxvY2spOworCQkJCXJlc2VydmF0
aW9uX29iamVjdF91bmxvY2sob2Jqc1tqXS0+cmVzdik7CiAKIAkJCWlmIChjb250ZW5kZWQgIT0g
LTEgJiYgY29udGVuZGVkID49IGkpCi0JCQkJd3dfbXV0ZXhfdW5sb2NrKCZvYmpzW2NvbnRlbmRl
ZF0tPnJlc3YtPmxvY2spOworCQkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2sob2Jqc1tjb250
ZW5kZWRdLT5yZXN2KTsKIAogCQkJaWYgKHJldCA9PSAtRURFQURMSykgewogCQkJCWNvbnRlbmRl
ZCA9IGk7CkBAIC0xMzYyLDcgKzEzNjIsNyBAQCBkcm1fZ2VtX3VubG9ja19yZXNlcnZhdGlvbnMo
c3RydWN0IGRybV9nZW1fb2JqZWN0ICoqb2JqcywgaW50IGNvdW50LAogCWludCBpOwogCiAJZm9y
IChpID0gMDsgaSA8IGNvdW50OyBpKyspCi0JCXd3X211dGV4X3VubG9jaygmb2Jqc1tpXS0+cmVz
di0+bG9jayk7CisJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2sob2Jqc1tpXS0+cmVzdik7CiAK
IAl3d19hY3F1aXJlX2ZpbmkoYWNxdWlyZV9jdHgpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL25vdXZlYXUvbm91dmVhdV9wcmltZS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUv
bm91dmVhdV9wcmltZS5jCmluZGV4IDFmZWZjOTNhZjFkNy4uMzhhYmRmYTk2YWY3IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3ByaW1lLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9wcmltZS5jCkBAIC02OCwxMCArNjgsMTAgQEAgc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpub3V2ZWF1X2dlbV9wcmltZV9pbXBvcnRfc2dfdGFibGUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwKIAogCWZsYWdzID0gVFRNX1BMX0ZMQUdfVFQ7CiAKLQl3d19t
dXRleF9sb2NrKCZyb2JqLT5sb2NrLCBOVUxMKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhy
b2JqLCBOVUxMKTsKIAlyZXQgPSBub3V2ZWF1X2JvX25ldygmZHJtLT5jbGllbnQsIGF0dGFjaC0+
ZG1hYnVmLT5zaXplLCAwLCBmbGFncywgMCwgMCwKIAkJCSAgICAgc2csIHJvYmosICZudmJvKTsK
LQl3d19tdXRleF91bmxvY2soJnJvYmotPmxvY2spOworCXJlc2VydmF0aW9uX29iamVjdF91bmxv
Y2socm9iaik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIEVSUl9QVFIocmV0KTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYwppbmRleCAzNjY4M2RlMDMwMGIuLjMyMTBiMWUwOTBm
OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fb2JqZWN0LmMKQEAgLTYwNyw3ICs2MDcs
NyBAQCBpbnQgcmFkZW9uX2JvX2dldF9zdXJmYWNlX3JlZyhzdHJ1Y3QgcmFkZW9uX2JvICpibykK
IAlpbnQgc3RlYWw7CiAJaW50IGk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLnJl
c3YtPmxvY2suYmFzZSk7CisJcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGJvLT50Ym8u
cmVzdik7CiAKIAlpZiAoIWJvLT50aWxpbmdfZmxhZ3MpCiAJCXJldHVybiAwOwpAQCAtNzMzLDcg
KzczMyw3IEBAIHZvaWQgcmFkZW9uX2JvX2dldF90aWxpbmdfZmxhZ3Moc3RydWN0IHJhZGVvbl9i
byAqYm8sCiAJCQkJdWludDMyX3QgKnRpbGluZ19mbGFncywKIAkJCQl1aW50MzJfdCAqcGl0Y2gp
CiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5yZXN2LT5sb2NrLmJhc2UpOworCXJl
c2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZChiby0+dGJvLnJlc3YpOwogCiAJaWYgKHRpbGlu
Z19mbGFncykKIAkJKnRpbGluZ19mbGFncyA9IGJvLT50aWxpbmdfZmxhZ3M7CkBAIC03NDUsNyAr
NzQ1LDcgQEAgaW50IHJhZGVvbl9ib19jaGVja190aWxpbmcoc3RydWN0IHJhZGVvbl9ibyAqYm8s
IGJvb2wgaGFzX21vdmVkLAogCQkJCWJvb2wgZm9yY2VfZHJvcCkKIHsKIAlpZiAoIWZvcmNlX2Ry
b3ApCi0JCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmJvLT50Ym8ucmVzdi0+bG9jay5iYXNlKTsKKwkJ
cmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGJvLT50Ym8ucmVzdik7CiAKIAlpZiAoIShi
by0+dGlsaW5nX2ZsYWdzICYgUkFERU9OX1RJTElOR19TVVJGQUNFKSkKIAkJcmV0dXJuIDA7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9wcmltZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fcHJpbWUuYwppbmRleCA3MTEwZDQwMzMyMmMuLmY0OGJj
ODdkMGU0YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fcHJpbWUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9wcmltZS5jCkBAIC02NiwxMCAr
NjYsMTAgQEAgc3RydWN0IGRybV9nZW1fb2JqZWN0ICpyYWRlb25fZ2VtX3ByaW1lX2ltcG9ydF9z
Z190YWJsZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXN0cnVjdCByYWRlb25fYm8gKmJvOwog
CWludCByZXQ7CiAKLQl3d19tdXRleF9sb2NrKCZyZXN2LT5sb2NrLCBOVUxMKTsKKwlyZXNlcnZh
dGlvbl9vYmplY3RfbG9jayhyZXN2LCBOVUxMKTsKIAlyZXQgPSByYWRlb25fYm9fY3JlYXRlKHJk
ZXYsIGF0dGFjaC0+ZG1hYnVmLT5zaXplLCBQQUdFX1NJWkUsIGZhbHNlLAogCQkJICAgICAgIFJB
REVPTl9HRU1fRE9NQUlOX0dUVCwgMCwgc2csIHJlc3YsICZibyk7Ci0Jd3dfbXV0ZXhfdW5sb2Nr
KCZyZXN2LT5sb2NrKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOwogCWlmIChy
ZXQpCiAJCXJldHVybiBFUlJfUFRSKHJldCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9iby5jCmluZGV4IDU4YzQw
M2VkYTA0ZS4uNDBkM2U1NDdjNzhlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9iby5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKQEAgLTg1MCw4ICs4NTAs
OCBAQCBzdGF0aWMgaW50IHR0bV9tZW1fZXZpY3RfZmlyc3Qoc3RydWN0IHR0bV9ib19kZXZpY2Ug
KmJkZXYsCiAKIAkJCWlmICghdHRtX2JvX2V2aWN0X3N3YXBvdXRfYWxsb3dhYmxlKGJvLCBjdHgs
ICZsb2NrZWQsCiAJCQkJCQkJICAgICZidXN5KSkgewotCQkJCWlmIChidXN5ICYmICFidXN5X2Jv
ICYmCi0JCQkJICAgIGJvLT5yZXN2LT5sb2NrLmN0eCAhPSB0aWNrZXQpCisJCQkJaWYgKGJ1c3kg
JiYgIWJ1c3lfYm8gJiYgdGlja2V0ICE9CisJCQkJICAgIHJlc2VydmF0aW9uX29iamVjdF9sb2Nr
aW5nX2N0eChiby0+cmVzdikpCiAJCQkJCWJ1c3lfYm8gPSBibzsKIAkJCQljb250aW51ZTsKIAkJ
CX0KQEAgLTk1Nyw4ICs5NTcsMTAgQEAgc3RhdGljIGludCB0dG1fYm9fbWVtX2ZvcmNlX3NwYWNl
KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiB7CiAJc3RydWN0IHR0bV9ib19kZXZpY2Ug
KmJkZXYgPSBiby0+YmRldjsKIAlzdHJ1Y3QgdHRtX21lbV90eXBlX21hbmFnZXIgKm1hbiA9ICZi
ZGV2LT5tYW5bbWVtLT5tZW1fdHlwZV07CisJc3RydWN0IHd3X2FjcXVpcmVfY3R4ICp0aWNrZXQ7
CiAJaW50IHJldDsKIAorCXRpY2tldCA9IHJlc2VydmF0aW9uX29iamVjdF9sb2NraW5nX2N0eChi
by0+cmVzdik7CiAJZG8gewogCQlyZXQgPSAoKm1hbi0+ZnVuYy0+Z2V0X25vZGUpKG1hbiwgYm8s
IHBsYWNlLCBtZW0pOwogCQlpZiAodW5saWtlbHkocmV0ICE9IDApKQpAQCAtOTY2LDcgKzk2OCw3
IEBAIHN0YXRpYyBpbnQgdHRtX2JvX21lbV9mb3JjZV9zcGFjZShzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvLAogCQlpZiAobWVtLT5tbV9ub2RlKQogCQkJYnJlYWs7CiAJCXJldCA9IHR0bV9t
ZW1fZXZpY3RfZmlyc3QoYmRldiwgbWVtLT5tZW1fdHlwZSwgcGxhY2UsIGN0eCwKLQkJCQkJICBi
by0+cmVzdi0+bG9jay5jdHgpOworCQkJCQkgIHRpY2tldCk7CiAJCWlmICh1bmxpa2VseShyZXQg
IT0gMCkpCiAJCQlyZXR1cm4gcmV0OwogCX0gd2hpbGUgKDEpOwpAQCAtMTk2Myw3ICsxOTY1LDcg
QEAgaW50IHR0bV9ib193YWl0X3VucmVzZXJ2ZWQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpi
bykKIAlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmJvLT53dV9tdXRleCk7CiAJaWYg
KHVubGlrZWx5KHJldCAhPSAwKSkKIAkJcmV0dXJuIC1FUkVTVEFSVFNZUzsKLQlpZiAoIXd3X211
dGV4X2lzX2xvY2tlZCgmYm8tPnJlc3YtPmxvY2spKQorCWlmICghcmVzZXJ2YXRpb25fb2JqZWN0
X2lzX2xvY2tlZChiby0+cmVzdikpCiAJCWdvdG8gb3V0X3VubG9jazsKIAlyZXQgPSByZXNlcnZh
dGlvbl9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKGJvLT5yZXN2LCBOVUxMKTsKIAlpZiAocmV0
ID09IC1FSU5UUikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2V4ZWNidWZf
dXRpbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZXhlY2J1Zl91dGlsLmMKaW5kZXggOTU3
ZWMzNzVhNGJhLi43MjNmYjU4M2ZkZGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX2V4ZWNidWZfdXRpbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2V4ZWNidWZf
dXRpbC5jCkBAIC0xNDQsMTAgKzE0NCwxMCBAQCBpbnQgdHRtX2V1X3Jlc2VydmVfYnVmZmVycyhz
dHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKnRpY2tldCwKIAogCQlpZiAocmV0ID09IC1FREVBRExLKSB7
CiAJCQlpZiAoaW50cikgewotCQkJCXJldCA9IHd3X211dGV4X2xvY2tfc2xvd19pbnRlcnJ1cHRp
YmxlKCZiby0+cmVzdi0+bG9jaywKLQkJCQkJCQkJICAgICAgIHRpY2tldCk7CisJCQkJcmV0ID0g
cmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tfc2xvd19pbnRlcnJ1cHRpYmxlKGJvLT5yZXN2LAorCQkJ
CQkJCQkJCSB0aWNrZXQpOwogCQkJfSBlbHNlIHsKLQkJCQl3d19tdXRleF9sb2NrX3Nsb3coJmJv
LT5yZXN2LT5sb2NrLCB0aWNrZXQpOworCQkJCXJlc2VydmF0aW9uX29iamVjdF9sb2NrX3Nsb3co
Ym8tPnJlc3YsIHRpY2tldCk7CiAJCQkJcmV0ID0gMDsKIAkJCX0KIAkJfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYmxpdC5jIGIvZHJpdmVycy9ncHUvZHJtL3Zt
d2dmeC92bXdnZnhfYmxpdC5jCmluZGV4IGZjNjY3M2NkZTI4OS4uNzAzNzg2ZTNkNTc5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9ibGl0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYmxpdC5jCkBAIC00NTksOSArNDU5LDkgQEAgaW50IHZt
d19ib19jcHVfYmxpdChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmRzdCwKIAogCS8qIEJ1ZmZl
ciBvYmplY3RzIG5lZWQgdG8gYmUgZWl0aGVyIHBpbm5lZCBvciByZXNlcnZlZDogKi8KIAlpZiAo
IShkc3QtPm1lbS5wbGFjZW1lbnQgJiBUVE1fUExfRkxBR19OT19FVklDVCkpCi0JCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJmRzdC0+cmVzdi0+bG9jay5iYXNlKTsKKwkJcmVzZXJ2YXRpb25fb2JqZWN0
X2Fzc2VydF9oZWxkKGRzdC0+cmVzdik7CiAJaWYgKCEoc3JjLT5tZW0ucGxhY2VtZW50ICYgVFRN
X1BMX0ZMQUdfTk9fRVZJQ1QpKQotCQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZzcmMtPnJlc3YtPmxv
Y2suYmFzZSk7CisJCXJlc2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZChzcmMtPnJlc3YpOwog
CiAJaWYgKGRzdC0+dHRtLT5zdGF0ZSA9PSB0dF91bnBvcHVsYXRlZCkgewogCQlyZXQgPSBkc3Qt
PnR0bS0+YmRldi0+ZHJpdmVyLT50dG1fdHRfcG9wdWxhdGUoZHN0LT50dG0sICZjdHgpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYyBiL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKaW5kZXggNWQ1YzJiY2UwMWYzLi4zMTVkYTQxYTE4YjQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYwpAQCAtMzQyLDcgKzM0Miw3IEBAIHZvaWQg
dm13X2JvX3Bpbl9yZXNlcnZlZChzdHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibywgYm9vbCBw
aW4pCiAJdWludDMyX3Qgb2xkX21lbV90eXBlID0gYm8tPm1lbS5tZW1fdHlwZTsKIAlpbnQgcmV0
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnJlc3YtPmxvY2suYmFzZSk7CisJcmVzZXJ2
YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKGJvLT5yZXN2KTsKIAogCWlmIChwaW4pIHsKIAkJaWYg
KHZiby0+cGluX2NvdW50KysgPiAwKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfY290YWJsZS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfY290YWJs
ZS5jCmluZGV4IGI0ZjZlMTIxN2M5ZC4uNzFlOTAxYmJlZDY4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9jb3RhYmxlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Zt
d2dmeC92bXdnZnhfY290YWJsZS5jCkBAIC0xNjksNyArMTY5LDcgQEAgc3RhdGljIGludCB2bXdf
Y290YWJsZV91bnNjcnViKHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcykKIAl9ICpjbWQ7CiAKIAlX
QVJOX09OX09OQ0UoYm8tPm1lbS5tZW1fdHlwZSAhPSBWTVdfUExfTU9CKTsKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZiby0+cmVzdi0+bG9jay5iYXNlKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfYXNz
ZXJ0X2hlbGQoYm8tPnJlc3YpOwogCiAJY21kID0gVk1XX0ZJRk9fUkVTRVJWRShkZXZfcHJpdiwg
c2l6ZW9mKCpjbWQpKTsKIAlpZiAoIWNtZCkKQEAgLTMxMSw3ICszMTEsNyBAQCBzdGF0aWMgaW50
IHZtd19jb3RhYmxlX3VuYmluZChzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMsCiAJCXJldHVybiAw
OwogCiAJV0FSTl9PTl9PTkNFKGJvLT5tZW0ubWVtX3R5cGUgIT0gVk1XX1BMX01PQik7Ci0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmYm8tPnJlc3YtPmxvY2suYmFzZSk7CisJcmVzZXJ2YXRpb25fb2Jq
ZWN0X2Fzc2VydF9oZWxkKGJvLT5yZXN2KTsKIAogCW11dGV4X2xvY2soJmRldl9wcml2LT5iaW5k
aW5nX211dGV4KTsKIAlpZiAoIXZjb3RibC0+c2NydWJiZWQpCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfcmVzb3VyY2UuYwppbmRleCAxZDM4YThiMmYyZWMuLjMwM2QyYzdkOWFiMyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcmVzb3VyY2UuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jCkBAIC00MDIsMTQgKzQwMiwx
NCBAQCB2b2lkIHZtd19yZXNvdXJjZV91bnJlc2VydmUoc3RydWN0IHZtd19yZXNvdXJjZSAqcmVz
LAogCiAJaWYgKHN3aXRjaF9iYWNrdXAgJiYgbmV3X2JhY2t1cCAhPSByZXMtPmJhY2t1cCkgewog
CQlpZiAocmVzLT5iYWNrdXApIHsKLQkJCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJlcy0+YmFja3Vw
LT5iYXNlLnJlc3YtPmxvY2suYmFzZSk7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfYXNzZXJ0X2hl
bGQocmVzLT5iYWNrdXAtPmJhc2UucmVzdik7CiAJCQlsaXN0X2RlbF9pbml0KCZyZXMtPm1vYl9o
ZWFkKTsKIAkJCXZtd19ib191bnJlZmVyZW5jZSgmcmVzLT5iYWNrdXApOwogCQl9CiAKIAkJaWYg
KG5ld19iYWNrdXApIHsKIAkJCXJlcy0+YmFja3VwID0gdm13X2JvX3JlZmVyZW5jZShuZXdfYmFj
a3VwKTsKLQkJCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm5ld19iYWNrdXAtPmJhc2UucmVzdi0+bG9j
ay5iYXNlKTsKKwkJCXJlc2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZChuZXdfYmFja3VwLT5i
YXNlLnJlc3YpOwogCQkJbGlzdF9hZGRfdGFpbCgmcmVzLT5tb2JfaGVhZCwgJm5ld19iYWNrdXAt
PnJlc19saXN0KTsKIAkJfSBlbHNlIHsKIAkJCXJlcy0+YmFja3VwID0gTlVMTDsKQEAgLTY5MSw3
ICs2OTEsNyBAQCB2b2lkIHZtd19yZXNvdXJjZV91bmJpbmRfbGlzdChzdHJ1Y3Qgdm13X2J1ZmZl
cl9vYmplY3QgKnZibykKIAkJLm51bV9zaGFyZWQgPSAwCiAJfTsKIAotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnZiby0+YmFzZS5yZXN2LT5sb2NrLmJhc2UpOworCXJlc2VydmF0aW9uX29iamVjdF9h
c3NlcnRfaGVsZCh2Ym8tPmJhc2UucmVzdik7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHJl
cywgbmV4dCwgJnZiby0+cmVzX2xpc3QsIG1vYl9oZWFkKSB7CiAJCWlmICghcmVzLT5mdW5jLT51
bmJpbmQpCiAJCQljb250aW51ZTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9f
ZHJpdmVyLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCmluZGV4IGM5YjhiYTQ5
MmYyNC4uMGU2YTExMWJlZDBiIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2Ry
aXZlci5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKQEAgLTc0NSwxMCAr
NzQ1LDEwIEBAIHN0YXRpYyBpbmxpbmUgaW50IHR0bV9ib19yZXNlcnZlX3Nsb3dwYXRoKHN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJV0FSTl9PTigha3JlZl9yZWFkKCZiby0+a3JlZikp
OwogCiAJaWYgKGludGVycnVwdGlibGUpCi0JCXJldCA9IHd3X211dGV4X2xvY2tfc2xvd19pbnRl
cnJ1cHRpYmxlKCZiby0+cmVzdi0+bG9jaywKLQkJCQkJCSAgICAgICB0aWNrZXQpOworCQlyZXQg
PSByZXNlcnZhdGlvbl9vYmplY3RfbG9ja19zbG93X2ludGVycnVwdGlibGUoYm8tPnJlc3YsCisJ
CQkJCQkJCSB0aWNrZXQpOwogCWVsc2UKLQkJd3dfbXV0ZXhfbG9ja19zbG93KCZiby0+cmVzdi0+
bG9jaywgdGlja2V0KTsKKwkJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tfc2xvdyhiby0+cmVzdiwg
dGlja2V0KTsKIAogCWlmIChsaWtlbHkocmV0ID09IDApKQogCQl0dG1fYm9fZGVsX3N1Yl9mcm9t
X2xydShibyk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L3Jlc2VydmF0aW9uLmggYi9pbmNs
dWRlL2xpbnV4L3Jlc2VydmF0aW9uLmgKaW5kZXggZjQ3ZTgxOTZkMDM5Li5kMTlkZTdhNmFmNzEg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvbGludXgvcmVzZXJ2YXRpb24uaAorKysgYi9pbmNsdWRlL2xp
bnV4L3Jlc2VydmF0aW9uLmgKQEAgLTE0MCw2ICsxNDAsMzggQEAgcmVzZXJ2YXRpb25fb2JqZWN0
X2xvY2tfaW50ZXJydXB0aWJsZShzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpvYmosCiAJcmV0
dXJuIHd3X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmb2JqLT5sb2NrLCBjdHgpOwogfQogCisv
KioKKyAqIHJlc2VydmF0aW9uX29iamVjdF9sb2NrX3Nsb3cgLSBzbG93cGF0aCBsb2NrIHRoZSBy
ZXNlcnZhdGlvbiBvYmplY3QKKyAqIEBvYmo6IHRoZSByZXNlcnZhdGlvbiBvYmplY3QKKyAqIEBj
dHg6IHRoZSBsb2NraW5nIGNvbnRleHQKKyAqCisgKiBBY3F1aXJlcyB0aGUgcmVzZXJ2YXRpb24g
b2JqZWN0IGFmdGVyIGEgZGllIGNhc2UuIFRoaXMgZnVuY3Rpb24KKyAqIHdpbGwgc2xlZXAgdW50
aWwgdGhlIGxvY2sgYmVjb21lcyBhdmFpbGFibGUuIFNlZSByZXNlcnZhdGlvbl9vYmplY3RfbG9j
aygpIGFzCisgKiB3ZWxsLgorICovCitzdGF0aWMgaW5saW5lIHZvaWQKK3Jlc2VydmF0aW9uX29i
amVjdF9sb2NrX3Nsb3coc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqb2JqLAorCQkJICAgICBz
dHJ1Y3Qgd3dfYWNxdWlyZV9jdHggKmN0eCkKK3sKKwl3d19tdXRleF9sb2NrX3Nsb3coJm9iai0+
bG9jaywgY3R4KTsKK30KKworLyoqCisgKiByZXNlcnZhdGlvbl9vYmplY3RfbG9ja19zbG93X2lu
dGVycnVwdGlibGUgLSBzbG93cGF0aCBsb2NrIHRoZSByZXNlcnZhdGlvbgorICogb2JqZWN0LCBp
bnRlcnJ1cHRpYmxlCisgKiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CisgKiBAY3R4OiB0
aGUgbG9ja2luZyBjb250ZXh0CisgKgorICogQWNxdWlyZXMgdGhlIHJlc2VydmF0aW9uIG9iamVj
dCBpbnRlcnJ1cHRpYmxlIGFmdGVyIGEgZGllIGNhc2UuIFRoaXMgZnVuY3Rpb24KKyAqIHdpbGwg
c2xlZXAgdW50aWwgdGhlIGxvY2sgYmVjb21lcyBhdmFpbGFibGUuIFNlZQorICogcmVzZXJ2YXRp
b25fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZSgpIGFzIHdlbGwuCisgKi8KK3N0YXRpYyBpbmxp
bmUgaW50CityZXNlcnZhdGlvbl9vYmplY3RfbG9ja19zbG93X2ludGVycnVwdGlibGUoc3RydWN0
IHJlc2VydmF0aW9uX29iamVjdCAqb2JqLAorCQkJCQkgICBzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHgg
KmN0eCkKK3sKKwlyZXR1cm4gd3dfbXV0ZXhfbG9ja19zbG93X2ludGVycnVwdGlibGUoJm9iai0+
bG9jaywgY3R4KTsKK30KIAogLyoqCiAgKiByZXNlcnZhdGlvbl9vYmplY3RfdHJ5bG9jayAtIHRy
eWxvY2sgdGhlIHJlc2VydmF0aW9uIG9iamVjdApAQCAtMTYxLDYgKzE5MywzMSBAQCByZXNlcnZh
dGlvbl9vYmplY3RfdHJ5bG9jayhzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpvYmopCiAJcmV0
dXJuIHd3X211dGV4X3RyeWxvY2soJm9iai0+bG9jayk7CiB9CiAKKy8qKgorICogcmVzZXJ2YXRp
b25fb2JqZWN0X2lzX2xvY2tlZCAtIGlzIHRoZSByZXNlcnZhdGlvbiBvYmplY3QgbG9ja2VkCisg
KiBAb2JqOiB0aGUgcmVzZXJ2YXRpb24gb2JqZWN0CisgKgorICogUmV0dXJucyB0cnVlIGlmIHRo
ZSBtdXRleCBpcyBsb2NrZWQsIGZhbHNlIGlmIHVubG9ja2VkLgorICovCitzdGF0aWMgaW5saW5l
IGJvb2wKK3Jlc2VydmF0aW9uX29iamVjdF9pc19sb2NrZWQoc3RydWN0IHJlc2VydmF0aW9uX29i
amVjdCAqb2JqKQoreworCXJldHVybiB3d19tdXRleF9pc19sb2NrZWQoJm9iai0+bG9jayk7Cit9
CisKKy8qKgorICogcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tpbmdfY3R4IC0gcmV0dXJucyB0aGUg
Y29udGV4dCB1c2VkIHRvIGxvY2sgdGhlIG9iamVjdAorICogQG9iajogdGhlIHJlc2VydmF0aW9u
IG9iamVjdAorICoKKyAqIFJldHVybnMgdGhlIGNvbnRleHQgdXNlZCB0byBsb2NrIGEgcmVzZXJ2
YXRpb24gb2JqZWN0IG9yIE5VTEwgaWYgbm8gY29udGV4dAorICogd2FzIHVzZWQgb3IgdGhlIG9i
amVjdCBpcyBub3QgbG9ja2VkIGF0IGFsbC4KKyAqLworc3RhdGljIGlubGluZSBzdHJ1Y3Qgd3df
YWNxdWlyZV9jdHggKgorcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tpbmdfY3R4KHN0cnVjdCByZXNl
cnZhdGlvbl9vYmplY3QgKm9iaikKK3sKKwlyZXR1cm4gUkVBRF9PTkNFKG9iai0+bG9jay5jdHgp
OworfQorCiAvKioKICAqIHJlc2VydmF0aW9uX29iamVjdF91bmxvY2sgLSB1bmxvY2sgdGhlIHJl
c2VydmF0aW9uIG9iamVjdAogICogQG9iajogdGhlIHJlc2VydmF0aW9uIG9iamVjdAotLSAKMi4x
Ny4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmkt
ZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
