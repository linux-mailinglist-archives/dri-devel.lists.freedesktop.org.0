Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 029B5B1AD9
	for <lists+dri-devel@lfdr.de>; Fri, 13 Sep 2019 11:32:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3EF7D6EEF5;
	Fri, 13 Sep 2019 09:32:51 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from pio-pvt-msa3.bahnhof.se (pio-pvt-msa3.bahnhof.se [79.136.2.42])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 84F4F6EEF5
 for <dri-devel@lists.freedesktop.org>; Fri, 13 Sep 2019 09:32:47 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by pio-pvt-msa3.bahnhof.se (Postfix) with ESMTP id A11A03F503;
 Fri, 13 Sep 2019 11:32:30 +0200 (CEST)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Received: from pio-pvt-msa3.bahnhof.se ([127.0.0.1])
 by localhost (pio-pvt-msa3.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id bGTtFi6o9eYD; Fri, 13 Sep 2019 11:32:29 +0200 (CEST)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by pio-pvt-msa3.bahnhof.se (Postfix) with ESMTPA id 58C8B3F4EE;
 Fri, 13 Sep 2019 11:32:29 +0200 (CEST)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id 29A90360311;
 Fri, 13 Sep 2019 11:32:28 +0200 (CEST)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: linux-kernel@vger.kernel.org, dri-devel@lists.freedesktop.org,
 linux-mm@kvack.org
Subject: [RFC PATCH 5/7] drm/vmwgfx: Use an RBtree instead of linked list for
 MOB resources
Date: Fri, 13 Sep 2019 11:32:11 +0200
Message-Id: <20190913093213.27254-6-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190913093213.27254-1-thomas_os@shipmail.org>
References: <20190913093213.27254-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1568367148; bh=hZW2n+AdOtbaVvfL20mazvk3WmrfNWXDYeDIDYMBCkQ=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=DtSV3VOi16jvljyIXdN1Zk2F3MASHXGH9R1TP1otzuQhwYc5mUkjevgOEt2TfH0rU
 7/8Kaa0ScxiRC0NUSHVBAycNpQ4QcPNtuxka/PPUh8Tc8HFLfMlDSc1EZtxAmQlIeZ
 CKV1dIB8/lrbmaDdv4S+kDAkkh7Wwm2u/Oq/Taq0=
X-Mailman-Original-Authentication-Results: pio-pvt-msa3.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=DtSV3VOi; 
 dkim-atps=neutral
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>, Michal Hocko <mhocko@suse.com>,
 Rik van Riel <riel@surriel.com>, pv-drivers@vmware.com,
 Minchan Kim <minchan@kernel.org>, Will Deacon <will.deacon@arm.com>,
 Matthew Wilcox <willy@infradead.org>, Christoph Hellwig <hch@infradead.org>,
 Peter Zijlstra <peterz@infradead.org>,
 =?UTF-8?q?J=C3=A9r=C3=B4me=20Glisse?= <jglisse@redhat.com>,
 linux-graphics-maintainer@vmware.com, Souptick Joarder <jrdr.linux@gmail.com>,
 Huang Ying <ying.huang@intel.com>, Andrew Morton <akpm@linux-foundation.org>,
 Deepak Rawat <drawat@vmware.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKV2l0aCBlbXVs
YXRlZCBjb2hlcmVudCBtZW1vcnkgd2UgbmVlZCB0byBiZSBhYmxlIHRvIHF1aWNrbHkgbG9vayB1
cAphIHJlc291cmNlIGZyb20gdGhlIE1PQiBvZmZzZXQuIEluc3RlYWQgb2YgdHJhdmVyc2luZyBh
IGxpbmtlZCBsaXN0IHdpdGgKTyhuKSB3b3JzdCBjYXNlLCB1c2UgYW4gUkJ0cmVlIHdpdGggTyhs
b2cgbikgd29yc3QgY2FzZSBjb21wbGV4aXR5LgoKQ2M6IEFuZHJldyBNb3J0b24gPGFrcG1AbGlu
dXgtZm91bmRhdGlvbi5vcmc+CkNjOiBNYXR0aGV3IFdpbGNveCA8d2lsbHlAaW5mcmFkZWFkLm9y
Zz4KQ2M6IFdpbGwgRGVhY29uIDx3aWxsLmRlYWNvbkBhcm0uY29tPgpDYzogUGV0ZXIgWmlqbHN0
cmEgPHBldGVyekBpbmZyYWRlYWQub3JnPgpDYzogUmlrIHZhbiBSaWVsIDxyaWVsQHN1cnJpZWwu
Y29tPgpDYzogTWluY2hhbiBLaW0gPG1pbmNoYW5Aa2VybmVsLm9yZz4KQ2M6IE1pY2hhbCBIb2Nr
byA8bWhvY2tvQHN1c2UuY29tPgpDYzogSHVhbmcgWWluZyA8eWluZy5odWFuZ0BpbnRlbC5jb20+
CkNjOiBTb3VwdGljayBKb2FyZGVyIDxqcmRyLmxpbnV4QGdtYWlsLmNvbT4KQ2M6ICJKw6lyw7Rt
ZSBHbGlzc2UiIDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiAiQ2hyaXN0aWFuIEvDtm5pZyIgPGNo
cmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KQ2M6IENocmlzdG9waCBIZWxsd2lnIDxoY2hAaW5mcmFk
ZWFkLm9yZz4KU2lnbmVkLW9mZi1ieTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdh
cmUuY29tPgpSZXZpZXdlZC1ieTogRGVlcGFrIFJhd2F0IDxkcmF3YXRAdm13YXJlLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jICAgICAgICAgfCAgNSArKy0tCiBk
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9kcnYuaCAgICAgICAgfCAxMCArKystLS0tCiBk
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMgfCAxMiArKysrLS0tLQog
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcmVzb3VyY2UuYyAgIHwgMzMgKysrKysrKysr
KysrKysrKy0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAzOCBpbnNlcnRpb25zKCspLCAyMiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5j
IGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYwppbmRleCA4NjlhZWFlYzJmODYu
LjE4ZTRiMzI5ZTU2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
Ym8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCkBAIC00NjMsNiAr
NDYzLDcgQEAgdm9pZCB2bXdfYm9fYm9fZnJlZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJv
KQogCXN0cnVjdCB2bXdfYnVmZmVyX29iamVjdCAqdm13X2JvID0gdm13X2J1ZmZlcl9vYmplY3Qo
Ym8pOwogCiAJV0FSTl9PTih2bXdfYm8tPmRpcnR5KTsKKwlXQVJOX09OKCFSQl9FTVBUWV9ST09U
KCZ2bXdfYm8tPnJlc190cmVlKSk7CiAJdm13X2JvX3VubWFwKHZtd19ibyk7CiAJa2ZyZWUodm13
X2JvKTsKIH0KQEAgLTQ3OSw2ICs0ODAsNyBAQCBzdGF0aWMgdm9pZCB2bXdfdXNlcl9ib19kZXN0
cm95KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCiAJc3RydWN0IHZtd19idWZmZXJfb2Jq
ZWN0ICp2Ym8gPSAmdm13X3VzZXJfYm8tPnZibzsKIAogCVdBUk5fT04odmJvLT5kaXJ0eSk7CisJ
V0FSTl9PTighUkJfRU1QVFlfUk9PVCgmdmJvLT5yZXNfdHJlZSkpOwogCXZtd19ib191bm1hcCh2
Ym8pOwogCXR0bV9wcmltZV9vYmplY3Rfa2ZyZWUodm13X3VzZXJfYm8sIHByaW1lKTsKIH0KQEAg
LTUxNCw4ICs1MTYsNyBAQCBpbnQgdm13X2JvX2luaXQoc3RydWN0IHZtd19wcml2YXRlICpkZXZf
cHJpdiwKIAltZW1zZXQodm13X2JvLCAwLCBzaXplb2YoKnZtd19ibykpOwogCUJVSUxEX0JVR19P
TihUVE1fTUFYX0JPX1BSSU9SSVRZIDw9IDMpOwogCXZtd19iby0+YmFzZS5wcmlvcml0eSA9IDM7
Ci0KLQlJTklUX0xJU1RfSEVBRCgmdm13X2JvLT5yZXNfbGlzdCk7CisJdm13X2JvLT5yZXNfdHJl
ZSA9IFJCX1JPT1Q7CiAKIAlyZXQgPSB0dG1fYm9faW5pdChiZGV2LCAmdm13X2JvLT5iYXNlLCBz
aXplLAogCQkJICB0dG1fYm9fdHlwZV9kZXZpY2UsIHBsYWNlbWVudCwKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfZHJ2LmgKaW5kZXggNGQxZjgwODExYWMwLi5mOGNiOWVkOTA4NjIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvdm13Z2Z4X2Rydi5oCkBAIC0xMDAsNyArMTAwLDcgQEAgc3RydWN0IHZtd19m
cHJpdiB7CiAvKioKICAqIHN0cnVjdCB2bXdfYnVmZmVyX29iamVjdCAtIFRUTSBidWZmZXIgb2Jq
ZWN0IHdpdGggdm13Z2Z4IGFkZGl0aW9ucwogICogQGJhc2U6IFRoZSBUVE0gYnVmZmVyIG9iamVj
dAotICogQHJlc19saXN0OiBMaXN0IG9mIHJlc291cmNlcyB1c2luZyB0aGlzIGJ1ZmZlciBvYmpl
Y3QgYXMgYSBiYWNraW5nIE1PQgorICogQHJlc190cmVlOiBSQiB0cmVlIG9mIHJlc291cmNlcyB1
c2luZyB0aGlzIGJ1ZmZlciBvYmplY3QgYXMgYSBiYWNraW5nIE1PQgogICogQHBpbl9jb3VudDog
cGluIGRlcHRoCiAgKiBAZHhfcXVlcnlfY3R4OiBEWCBjb250ZXh0IGlmIHRoaXMgYnVmZmVyIG9i
amVjdCBpcyB1c2VkIGFzIGEgRFggcXVlcnkgTU9CCiAgKiBAbWFwOiBLbWFwIG9iamVjdCBmb3Ig
c2VtaS1wZXJzaXN0ZW50IG1hcHBpbmdzCkBAIC0xMDksNyArMTA5LDcgQEAgc3RydWN0IHZtd19m
cHJpdiB7CiAgKi8KIHN0cnVjdCB2bXdfYnVmZmVyX29iamVjdCB7CiAJc3RydWN0IHR0bV9idWZm
ZXJfb2JqZWN0IGJhc2U7Ci0Jc3RydWN0IGxpc3RfaGVhZCByZXNfbGlzdDsKKwlzdHJ1Y3QgcmJf
cm9vdCByZXNfdHJlZTsKIAlzMzIgcGluX2NvdW50OwogCS8qIE5vdCByZWYtY291bnRlZC4gIFBy
b3RlY3RlZCBieSBiaW5kaW5nX211dGV4ICovCiAJc3RydWN0IHZtd19yZXNvdXJjZSAqZHhfcXVl
cnlfY3R4OwpAQCAtMTU3LDggKzE1Nyw4IEBAIHN0cnVjdCB2bXdfcmVzX2Z1bmM7CiAgKiBwaW4t
Y291bnQgZ3JlYXRlciB0aGFuIHplcm8uIEl0IGlzIG5vdCBvbiB0aGUgcmVzb3VyY2UgTFJVIGxp
c3RzIGFuZCBpdHMKICAqIGJhY2t1cCBidWZmZXIgaXMgcGlubmVkLiBIZW5jZSBpdCBjYW4ndCBi
ZSBldmljdGVkLgogICogQGZ1bmM6IE1ldGhvZCB2dGFibGUgZm9yIHRoaXMgcmVzb3VyY2UuIElt
bXV0YWJsZS4KKyAqIEBtb2Jfbm9kZTsgTm9kZSBmb3IgdGhlIE1PQiBiYWNrdXAgcmJ0cmVlLiBQ
cm90ZWN0ZWQgYnkgQGJhY2t1cCByZXNlcnZlZC4KICAqIEBscnVfaGVhZDogTGlzdCBoZWFkIGZv
ciB0aGUgTFJVIGxpc3QuIFByb3RlY3RlZCBieSBAZGV2X3ByaXY6OnJlc291cmNlX2xvY2suCi0g
KiBAbW9iX2hlYWQ6IExpc3QgaGVhZCBmb3IgdGhlIE1PQiBiYWNrdXAgbGlzdC4gUHJvdGVjdGVk
IGJ5IEBiYWNrdXAgcmVzZXJ2ZWQuCiAgKiBAYmluZGluZ19oZWFkOiBMaXN0IGhlYWQgZm9yIHRo
ZSBjb250ZXh0IGJpbmRpbmcgbGlzdC4gUHJvdGVjdGVkIGJ5CiAgKiB0aGUgQGRldl9wcml2Ojpi
aW5kaW5nX211dGV4CiAgKiBAcmVzX2ZyZWU6IFRoZSByZXNvdXJjZSBkZXN0cnVjdG9yLgpAQCAt
MTc5LDggKzE3OSw4IEBAIHN0cnVjdCB2bXdfcmVzb3VyY2UgewogCXVuc2lnbmVkIGxvbmcgYmFj
a3VwX29mZnNldDsKIAl1bnNpZ25lZCBsb25nIHBpbl9jb3VudDsKIAljb25zdCBzdHJ1Y3Qgdm13
X3Jlc19mdW5jICpmdW5jOworCXN0cnVjdCByYl9ub2RlIG1vYl9ub2RlOwogCXN0cnVjdCBsaXN0
X2hlYWQgbHJ1X2hlYWQ7Ci0Jc3RydWN0IGxpc3RfaGVhZCBtb2JfaGVhZDsKIAlzdHJ1Y3QgbGlz
dF9oZWFkIGJpbmRpbmdfaGVhZDsKIAlzdHJ1Y3Qgdm13X3Jlc291cmNlX2RpcnR5ICpkaXJ0eTsK
IAl2b2lkICgqcmVzX2ZyZWUpIChzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMpOwpAQCAtNzM2LDcg
KzczNiw3IEBAIHZvaWQgdm13X3Jlc291cmNlX2RpcnR5X3VwZGF0ZShzdHJ1Y3Qgdm13X3Jlc291
cmNlICpyZXMsIHBnb2ZmX3Qgc3RhcnQsCiAgKi8KIHN0YXRpYyBpbmxpbmUgYm9vbCB2bXdfcmVz
b3VyY2VfbW9iX2F0dGFjaGVkKGNvbnN0IHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcykKIHsKLQly
ZXR1cm4gIWxpc3RfZW1wdHkoJnJlcy0+bW9iX2hlYWQpOworCXJldHVybiAhUkJfRU1QVFlfTk9E
RSgmcmVzLT5tb2Jfbm9kZSk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC92bXdnZnhfcGFnZV9kaXJ0eS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdn
ZnhfcGFnZV9kaXJ0eS5jCmluZGV4IDExNDA0ODYyZWZmNy4uYmUzMzAyYThlMzA5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9wYWdlX2RpcnR5LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfcGFnZV9kaXJ0eS5jCkBAIC04Myw3ICs4Myw3IEBA
IHN0cnVjdCB2bXdfYm9fZGlydHkgewogc3RhdGljIHZvaWQgdm13X2JvX2RpcnR5X3NjYW5fcGFn
ZXRhYmxlKHN0cnVjdCB2bXdfYnVmZmVyX29iamVjdCAqdmJvKQogewogCXN0cnVjdCB2bXdfYm9f
ZGlydHkgKmRpcnR5ID0gdmJvLT5kaXJ0eTsKLQlwZ29mZl90IG9mZnNldCA9IGRybV92bWFfbm9k
ZV9zdGFydCgmdmJvLT5iYXNlLnZtYV9ub2RlKTsKKwlwZ29mZl90IG9mZnNldCA9IGRybV92bWFf
bm9kZV9zdGFydCgmdmJvLT5iYXNlLmJhc2Uudm1hX25vZGUpOwogCXN0cnVjdCBhZGRyZXNzX3Nw
YWNlICptYXBwaW5nID0gdmJvLT5iYXNlLmJkZXYtPmRldl9tYXBwaW5nOwogCXBnb2ZmX3QgbnVt
X21hcmtlZDsKIApAQCAtMTIwLDcgKzEyMCw3IEBAIHN0YXRpYyB2b2lkIHZtd19ib19kaXJ0eV9z
Y2FuX3BhZ2V0YWJsZShzdHJ1Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibykKIHN0YXRpYyB2b2lk
IHZtd19ib19kaXJ0eV9zY2FuX21rd3JpdGUoc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICp2Ym8p
CiB7CiAJc3RydWN0IHZtd19ib19kaXJ0eSAqZGlydHkgPSB2Ym8tPmRpcnR5OwotCXVuc2lnbmVk
IGxvbmcgb2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX3N0YXJ0KCZ2Ym8tPmJhc2Uudm1hX25vZGUpOwor
CXVuc2lnbmVkIGxvbmcgb2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX3N0YXJ0KCZ2Ym8tPmJhc2UuYmFz
ZS52bWFfbm9kZSk7CiAJc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcgPSB2Ym8tPmJhc2Uu
YmRldi0+ZGV2X21hcHBpbmc7CiAJcGdvZmZfdCBudW1fbWFya2VkOwogCkBAIC0yMjAsNyArMjIw
LDcgQEAgaW50IHZtd19ib19kaXJ0eV9hZGQoc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICp2Ym8p
CiAJCWRpcnR5LT5tZXRob2QgPSBWTVdfQk9fRElSVFlfUEFHRVRBQkxFOwogCX0gZWxzZSB7CiAJ
CXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0gdmJvLT5iYXNlLmJkZXYtPmRldl9tYXBw
aW5nOwotCQlwZ29mZl90IG9mZnNldCA9IGRybV92bWFfbm9kZV9zdGFydCgmdmJvLT5iYXNlLnZt
YV9ub2RlKTsKKwkJcGdvZmZfdCBvZmZzZXQgPSBkcm1fdm1hX25vZGVfc3RhcnQoJnZiby0+YmFz
ZS5iYXNlLnZtYV9ub2RlKTsKIAogCQlkaXJ0eS0+bWV0aG9kID0gVk1XX0JPX0RJUlRZX01LV1JJ
VEU7CiAKQEAgLTM2Miw3ICszNjIsNyBAQCB2bV9mYXVsdF90IHZtd19ib192bV9ta3dyaXRlKHN0
cnVjdCB2bV9mYXVsdCAqdm1mKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlwYWdlX29m
ZnNldCA9IHZtZi0+cGdvZmYgLSBkcm1fdm1hX25vZGVfc3RhcnQoJmJvLT52bWFfbm9kZSk7CisJ
cGFnZV9vZmZzZXQgPSB2bWYtPnBnb2ZmIC0gZHJtX3ZtYV9ub2RlX3N0YXJ0KCZiby0+YmFzZS52
bWFfbm9kZSk7CiAJaWYgKHVubGlrZWx5KHBhZ2Vfb2Zmc2V0ID49IGJvLT5udW1fcGFnZXMpKSB7
CiAJCXJldCA9IFZNX0ZBVUxUX1NJR0JVUzsKIAkJZ290byBvdXRfdW5sb2NrOwpAQCAtMzc4LDcg
KzM3OCw3IEBAIHZtX2ZhdWx0X3Qgdm13X2JvX3ZtX21rd3JpdGUoc3RydWN0IHZtX2ZhdWx0ICp2
bWYpCiAJfQogCiBvdXRfdW5sb2NrOgotCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2soYm8tPnJl
c3YpOworCWRtYV9yZXN2X3VubG9jayhiby0+YmFzZS5yZXN2KTsKIAlyZXR1cm4gcmV0OwogfQog
CkBAIC00MTIsNiArNDEyLDYgQEAgdm1fZmF1bHRfdCB2bXdfYm9fdm1fZmF1bHQoc3RydWN0IHZt
X2ZhdWx0ICp2bWYpCiAJaWYgKHJldCA9PSBWTV9GQVVMVF9SRVRSWSAmJiAhKHZtZi0+ZmxhZ3Mg
JiBGQVVMVF9GTEFHX1JFVFJZX05PV0FJVCkpCiAJCXJldHVybiByZXQ7CiAKLQlyZXNlcnZhdGlv
bl9vYmplY3RfdW5sb2NrKGJvLT5yZXN2KTsKKwlkbWFfcmVzdl91bmxvY2soYm8tPmJhc2UucmVz
dik7CiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngv
dm13Z2Z4X3Jlc291cmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJj
ZS5jCmluZGV4IGU0Yzk3YTRjZjJmZi4uMzI4YWQ0NjA3NmZmIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9yZXNvdXJjZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdm13Z2Z4X3Jlc291cmNlLmMKQEAgLTQwLDExICs0MCwyNCBAQAogdm9pZCB2bXdfcmVz
b3VyY2VfbW9iX2F0dGFjaChzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMpCiB7CiAJc3RydWN0IHZt
d19idWZmZXJfb2JqZWN0ICpiYWNrdXAgPSByZXMtPmJhY2t1cDsKKwlzdHJ1Y3QgcmJfbm9kZSAq
Km5ldyA9ICZiYWNrdXAtPnJlc190cmVlLnJiX25vZGUsICpwYXJlbnQgPSBOVUxMOwogCiAJZG1h
X3Jlc3ZfYXNzZXJ0X2hlbGQocmVzLT5iYWNrdXAtPmJhc2UuYmFzZS5yZXN2KTsKIAlyZXMtPnVz
ZWRfcHJpbyA9IChyZXMtPnJlc19kaXJ0eSkgPyByZXMtPmZ1bmMtPmRpcnR5X3ByaW8gOgogCQly
ZXMtPmZ1bmMtPnByaW87Ci0JbGlzdF9hZGRfdGFpbCgmcmVzLT5tb2JfaGVhZCwgJmJhY2t1cC0+
cmVzX2xpc3QpOworCisJd2hpbGUgKCpuZXcpIHsKKwkJc3RydWN0IHZtd19yZXNvdXJjZSAqdGhp
cyA9CisJCQljb250YWluZXJfb2YoKm5ldywgc3RydWN0IHZtd19yZXNvdXJjZSwgbW9iX25vZGUp
OworCisJCXBhcmVudCA9ICpuZXc7CisJCW5ldyA9IChyZXMtPmJhY2t1cF9vZmZzZXQgPCB0aGlz
LT5iYWNrdXBfb2Zmc2V0KSA/CisJCQkmKCgqbmV3KS0+cmJfbGVmdCkgOiAmKCgqbmV3KS0+cmJf
cmlnaHQpOworCX0KKworCXJiX2xpbmtfbm9kZSgmcmVzLT5tb2Jfbm9kZSwgcGFyZW50LCBuZXcp
OworCXJiX2luc2VydF9jb2xvcigmcmVzLT5tb2Jfbm9kZSwgJmJhY2t1cC0+cmVzX3RyZWUpOwor
CiAJdm13X2JvX3ByaW9fYWRkKGJhY2t1cCwgcmVzLT51c2VkX3ByaW8pOwogfQogCkBAIC01OCw3
ICs3MSw4IEBAIHZvaWQgdm13X3Jlc291cmNlX21vYl9kZXRhY2goc3RydWN0IHZtd19yZXNvdXJj
ZSAqcmVzKQogCiAJZG1hX3Jlc3ZfYXNzZXJ0X2hlbGQoYmFja3VwLT5iYXNlLmJhc2UucmVzdik7
CiAJaWYgKHZtd19yZXNvdXJjZV9tb2JfYXR0YWNoZWQocmVzKSkgewotCQlsaXN0X2RlbF9pbml0
KCZyZXMtPm1vYl9oZWFkKTsKKwkJcmJfZXJhc2UoJnJlcy0+bW9iX25vZGUsICZiYWNrdXAtPnJl
c190cmVlKTsKKwkJUkJfQ0xFQVJfTk9ERSgmcmVzLT5tb2Jfbm9kZSk7CiAJCXZtd19ib19wcmlv
X2RlbChiYWNrdXAsIHJlcy0+dXNlZF9wcmlvKTsKIAl9CiB9CkBAIC0yMDQsOCArMjE4LDggQEAg
aW50IHZtd19yZXNvdXJjZV9pbml0KHN0cnVjdCB2bXdfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVj
dCB2bXdfcmVzb3VyY2UgKnJlcywKIAlyZXMtPnJlc19mcmVlID0gcmVzX2ZyZWU7CiAJcmVzLT5k
ZXZfcHJpdiA9IGRldl9wcml2OwogCXJlcy0+ZnVuYyA9IGZ1bmM7CisJUkJfQ0xFQVJfTk9ERSgm
cmVzLT5tb2Jfbm9kZSk7CiAJSU5JVF9MSVNUX0hFQUQoJnJlcy0+bHJ1X2hlYWQpOwotCUlOSVRf
TElTVF9IRUFEKCZyZXMtPm1vYl9oZWFkKTsKIAlJTklUX0xJU1RfSEVBRCgmcmVzLT5iaW5kaW5n
X2hlYWQpOwogCXJlcy0+aWQgPSAtMTsKIAlyZXMtPmJhY2t1cCA9IE5VTEw7CkBAIC03NTQsMTkg
Kzc2OCwyMCBAQCBpbnQgdm13X3Jlc291cmNlX3ZhbGlkYXRlKHN0cnVjdCB2bXdfcmVzb3VyY2Ug
KnJlcywgYm9vbCBpbnRyKQogICovCiB2b2lkIHZtd19yZXNvdXJjZV91bmJpbmRfbGlzdChzdHJ1
Y3Qgdm13X2J1ZmZlcl9vYmplY3QgKnZibykKIHsKLQotCXN0cnVjdCB2bXdfcmVzb3VyY2UgKnJl
cywgKm5leHQ7CiAJc3RydWN0IHR0bV92YWxpZGF0ZV9idWZmZXIgdmFsX2J1ZiA9IHsKIAkJLmJv
ID0gJnZiby0+YmFzZSwKIAkJLm51bV9zaGFyZWQgPSAwCiAJfTsKIAogCWRtYV9yZXN2X2Fzc2Vy
dF9oZWxkKHZiby0+YmFzZS5iYXNlLnJlc3YpOwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShy
ZXMsIG5leHQsICZ2Ym8tPnJlc19saXN0LCBtb2JfaGVhZCkgewotCQlpZiAoIXJlcy0+ZnVuYy0+
dW5iaW5kKQotCQkJY29udGludWU7CisJd2hpbGUgKCFSQl9FTVBUWV9ST09UKCZ2Ym8tPnJlc190
cmVlKSkgeworCQlzdHJ1Y3QgcmJfbm9kZSAqbm9kZSA9IHZiby0+cmVzX3RyZWUucmJfbm9kZTsK
KwkJc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzID0KKwkJCWNvbnRhaW5lcl9vZihub2RlLCBzdHJ1
Y3Qgdm13X3Jlc291cmNlLCBtb2Jfbm9kZSk7CisKKwkJaWYgKCFXQVJOX09OX09OQ0UoIXJlcy0+
ZnVuYy0+dW5iaW5kKSkKKwkJCSh2b2lkKSByZXMtPmZ1bmMtPnVuYmluZChyZXMsIHJlcy0+cmVz
X2RpcnR5LCAmdmFsX2J1Zik7CiAKLQkJKHZvaWQpIHJlcy0+ZnVuYy0+dW5iaW5kKHJlcywgcmVz
LT5yZXNfZGlydHksICZ2YWxfYnVmKTsKIAkJcmVzLT5iYWNrdXBfZGlydHkgPSB0cnVlOwogCQly
ZXMtPnJlc19kaXJ0eSA9IGZhbHNlOwogCQl2bXdfcmVzb3VyY2VfbW9iX2RldGFjaChyZXMpOwot
LSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
