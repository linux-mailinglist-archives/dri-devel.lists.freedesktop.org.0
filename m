Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A56027FE5B
	for <lists+dri-devel@lfdr.de>; Thu,  1 Oct 2020 13:28:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 605496E898;
	Thu,  1 Oct 2020 11:28:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ed1-x542.google.com (mail-ed1-x542.google.com
 [IPv6:2a00:1450:4864:20::542])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 200B56E89A
 for <dri-devel@lists.freedesktop.org>; Thu,  1 Oct 2020 11:28:26 +0000 (UTC)
Received: by mail-ed1-x542.google.com with SMTP id l24so5219021edj.8
 for <dri-devel@lists.freedesktop.org>; Thu, 01 Oct 2020 04:28:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=OI4GBxB6/ZBlm+R6Uu235/vZvWO8kctdNuwbMr3T5Y0=;
 b=RO86U0gNaGz/aodDvdnzY+l2Jmec3ip55sPwzhrdiR19/zBGsEDBFyngVQOynnwC+X
 KLY6BFIueb7f6EtM++vUzn1n1LPBbAJb8TQdQrUkcXoI0U8uhugnzbiC0naiqfAzwDCh
 20wnEw3dCsRcsjQoLzd97CGrDqHQNkKGFJmFhKocKkzDouH/K2MlSEiNK9cZ8Oz7P8MK
 dXtv7/X2j07RL2ooXuA/39PEa83JKoMh883Tvg/Y8+MLYSzhiVURHpMBqky2Hj0XoC7S
 9jw+kLiKqo1WIS9Lfn4lIaBaIscm7XzP1QF2cpkSYcyADAXPjk0vcNgOycGYYnVHgs8K
 q4Sg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=OI4GBxB6/ZBlm+R6Uu235/vZvWO8kctdNuwbMr3T5Y0=;
 b=LGl8XMu//nMXLjHeG0Z3OfA9HFhaYOuLqgO4a6a/K4ENlc+p1155MUavqJjGAjMCDU
 LLW+Zy83oyrXeABDs6dG73dCil41uSqXctaVO3xg/LIVW5Lq/Vokg+/ptZPpT/RPS3HW
 yBcsrzdVznQVLkO5FISEEkB/7iAww/IcBFeY7Ss5oLQHmqGB3+jXlB4BLNx+K6k5fv8S
 ugm4J0+07x1tnrLlpUb/Srz9IZB78ovMglTE8m1vmfX4LHos5G9zug9osQIpTvba+KhK
 WZHmA3RYl/E0hoWEoWoSszM3msW27sCWu0i1C1KXFPrmidg19e72uuoN6eFD6PTHLb2i
 D1jg==
X-Gm-Message-State: AOAM53236N2nuay171IJy5ZvbAncoC1A/ayLCzAgo+eNUwaXhVG/PHZz
 UavYqJo+WNXtD4peiwqjIipFIUtpED8=
X-Google-Smtp-Source: ABdhPJwUohl6L22GOr6RAvp+j7GpZKbk5Wze0L1xobfgIjJmrUfYQE9v0lauRwk0E4hD5k6dFIdh6A==
X-Received: by 2002:aa7:da10:: with SMTP id r16mr7899832eds.333.1601551704471; 
 Thu, 01 Oct 2020 04:28:24 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:36be:5a08:8c1d:6b2b])
 by smtp.gmail.com with ESMTPSA id p3sm3834892edp.28.2020.10.01.04.28.23
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 01 Oct 2020 04:28:23 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, ray.huang@amd.com, airlied@gmail.com,
 daniel@ffwll.ch
Subject: [PATCH 7/8] drm/ttm: use caching instead of placement for ttm_io_prot
Date: Thu,  1 Oct 2020 13:28:16 +0200
Message-Id: <20201001112817.20967-7-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201001112817.20967-1-christian.koenig@amd.com>
References: <20201001112817.20967-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiB0aGUgcGxhY2VtZW50IGZsYWdzIHVzZSB0aGUgY2FjaGluZyBvZiB0aGUgYnVz
Cm1hcHBpbmcgb3IgdHQgb2JqZWN0IGZvciB0aGUgcGFnZSBwcm90ZWN0aW9uIGZsYWdzLgoKU2ln
bmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYyAgICB8IDIzICsrKysrKysrKysr
KysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib192bS5jICAgICAgfCAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYmxpdC5jIHwgIDQgKystLQogaW5jbHVk
ZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCAgICAgIHwgIDYgKysrKy0tCiA0IGZpbGVzIGNoYW5n
ZWQsIDIxIGluc2VydGlvbnMoKyksIDE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS90dG0vdHRtX2JvX3V0aWwuYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2Jv
X3V0aWwuYwppbmRleCBiZGVlNGRmMWYzZjIuLjA1NDIwOTdkYzQxOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0v
dHRtX2JvX3V0aWwuYwpAQCAtMjc5LDEzICsyNzksMTEgQEAgaW50IHR0bV9ib19tb3ZlX21lbWNw
eShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCWZvciAoaSA9IDA7IGkgPCBuZXdfbWVt
LT5udW1fcGFnZXM7ICsraSkgewogCQlwYWdlID0gaSAqIGRpciArIGFkZDsKIAkJaWYgKG9sZF9p
b21hcCA9PSBOVUxMKSB7Ci0JCQlwZ3Byb3RfdCBwcm90ID0gdHRtX2lvX3Byb3Qob2xkX21lbS0+
cGxhY2VtZW50LAotCQkJCQkJICAgIFBBR0VfS0VSTkVMKTsKKwkJCXBncHJvdF90IHByb3QgPSB0
dG1faW9fcHJvdChibywgb2xkX21lbSwgUEFHRV9LRVJORUwpOwogCQkJcmV0ID0gdHRtX2NvcHlf
dHRtX2lvX3BhZ2UodHRtLCBuZXdfaW9tYXAsIHBhZ2UsCiAJCQkJCQkgICBwcm90KTsKIAkJfSBl
bHNlIGlmIChuZXdfaW9tYXAgPT0gTlVMTCkgewotCQkJcGdwcm90X3QgcHJvdCA9IHR0bV9pb19w
cm90KG5ld19tZW0tPnBsYWNlbWVudCwKLQkJCQkJCSAgICBQQUdFX0tFUk5FTCk7CisJCQlwZ3By
b3RfdCBwcm90ID0gdHRtX2lvX3Byb3QoYm8sIG5ld19tZW0sIFBBR0VfS0VSTkVMKTsKIAkJCXJl
dCA9IHR0bV9jb3B5X2lvX3R0bV9wYWdlKHR0bSwgb2xkX2lvbWFwLCBwYWdlLAogCQkJCQkJICAg
cHJvdCk7CiAJCX0gZWxzZSB7CkBAIC0zODQsMjEgKzM4MiwyOCBAQCBzdGF0aWMgaW50IHR0bV9i
dWZmZXJfb2JqZWN0X3RyYW5zZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJcmV0
dXJuIDA7CiB9CiAKLXBncHJvdF90IHR0bV9pb19wcm90KHVpbnQzMl90IGNhY2hpbmdfZmxhZ3Ms
IHBncHJvdF90IHRtcCkKK3BncHJvdF90IHR0bV9pb19wcm90KHN0cnVjdCB0dG1fYnVmZmVyX29i
amVjdCAqYm8sIHN0cnVjdCB0dG1fcmVzb3VyY2UgKnJlcywKKwkJICAgICBwZ3Byb3RfdCB0bXAp
CiB7CisJc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICptYW47CisJZW51bSB0dG1fY2FjaGlu
ZyBjYWNoaW5nOworCisJbWFuID0gdHRtX21hbmFnZXJfdHlwZShiby0+YmRldiwgcmVzLT5tZW1f
dHlwZSk7CisJY2FjaGluZyA9IG1hbi0+dXNlX3R0ID8gYm8tPnR0bS0+Y2FjaGluZyA6IHJlcy0+
YnVzLmNhY2hpbmc7CisKIAkvKiBDYWNoZWQgbWFwcGluZ3MgbmVlZCBubyBhZGp1c3RtZW50ICov
Ci0JaWYgKGNhY2hpbmdfZmxhZ3MgJiBUVE1fUExfRkxBR19DQUNIRUQpCisJaWYgKGNhY2hpbmcg
PT0gdHRtX2NhY2hlZCkKIAkJcmV0dXJuIHRtcDsKIAogI2lmIGRlZmluZWQoX19pMzg2X18pIHx8
IGRlZmluZWQoX194ODZfNjRfXykKLQlpZiAoY2FjaGluZ19mbGFncyAmIFRUTV9QTF9GTEFHX1dD
KQorCWlmIChjYWNoaW5nID09IHR0bV93cml0ZV9jb21iaW5lZCkKIAkJdG1wID0gcGdwcm90X3dy
aXRlY29tYmluZSh0bXApOwogCWVsc2UgaWYgKGJvb3RfY3B1X2RhdGEueDg2ID4gMykKIAkJdG1w
ID0gcGdwcm90X25vbmNhY2hlZCh0bXApOwogI2VuZGlmCiAjaWYgZGVmaW5lZChfX2lhNjRfXykg
fHwgZGVmaW5lZChfX2FybV9fKSB8fCBkZWZpbmVkKF9fYWFyY2g2NF9fKSB8fCBcCiAgICAgZGVm
aW5lZChfX3Bvd2VycGNfXykgfHwgZGVmaW5lZChfX21pcHNfXykKLQlpZiAoY2FjaGluZ19mbGFn
cyAmIFRUTV9QTF9GTEFHX1dDKQorCWlmIChjYWNoaW5nID09IHR0bV93cml0ZV9jb21iaW5lZCkK
IAkJdG1wID0gcGdwcm90X3dyaXRlY29tYmluZSh0bXApOwogCWVsc2UKIAkJdG1wID0gcGdwcm90
X25vbmNhY2hlZCh0bXApOwpAQCAtNDY2LDcgKzQ3MSw3IEBAIHN0YXRpYyBpbnQgdHRtX2JvX2tt
YXBfdHRtKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJCSAqIFdlIG5lZWQgdG8gdXNl
IHZtYXAgdG8gZ2V0IHRoZSBkZXNpcmVkIHBhZ2UgcHJvdGVjdGlvbgogCQkgKiBvciB0byBtYWtl
IHRoZSBidWZmZXIgb2JqZWN0IGxvb2sgY29udGlndW91cy4KIAkJICovCi0JCXByb3QgPSB0dG1f
aW9fcHJvdChtZW0tPnBsYWNlbWVudCwgUEFHRV9LRVJORUwpOworCQlwcm90ID0gdHRtX2lvX3By
b3QoYm8sIG1lbSwgUEFHRV9LRVJORUwpOwogCQltYXAtPmJvX2ttYXBfdHlwZSA9IHR0bV9ib19t
YXBfdm1hcDsKIAkJbWFwLT52aXJ0dWFsID0gdm1hcCh0dG0tPnBhZ2VzICsgc3RhcnRfcGFnZSwg
bnVtX3BhZ2VzLAogCQkJCSAgICAwLCBwcm90KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX2JvX3ZtLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib192bS5jCmluZGV4
IDg3ZWU4ZjBjYTA4ZS4uZWVhY2E1ZDFlZmUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
dHRtL3R0bV9ib192bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKQEAg
LTMxMCw3ICszMTAsNyBAQCB2bV9mYXVsdF90IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZChzdHJ1
Y3Qgdm1fZmF1bHQgKnZtZiwKIAlpZiAodW5saWtlbHkocGFnZV9vZmZzZXQgPj0gYm8tPm51bV9w
YWdlcykpCiAJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CiAKLQlwcm90ID0gdHRtX2lvX3Byb3Qo
Ym8tPm1lbS5wbGFjZW1lbnQsIHByb3QpOworCXByb3QgPSB0dG1faW9fcHJvdChibywgJmJvLT5t
ZW0sIHByb3QpOwogCWlmICghYm8tPm1lbS5idXMuaXNfaW9tZW0pIHsKIAkJc3RydWN0IHR0bV9v
cGVyYXRpb25fY3R4IGN0eCA9IHsKIAkJCS5pbnRlcnJ1cHRpYmxlID0gZmFsc2UsCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9ibGl0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vdm13Z2Z4L3Ztd2dmeF9ibGl0LmMKaW5kZXggZWEyZjJmOTM3ZWIzLi5mMjE4ODFlMDg3ZGIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JsaXQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9ibGl0LmMKQEAgLTQ4NCw4ICs0ODQsOCBAQCBp
bnQgdm13X2JvX2NwdV9ibGl0KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqZHN0LAogCWQuc3Jj
X3BhZ2VzID0gc3JjLT50dG0tPnBhZ2VzOwogCWQuZHN0X251bV9wYWdlcyA9IGRzdC0+bnVtX3Bh
Z2VzOwogCWQuc3JjX251bV9wYWdlcyA9IHNyYy0+bnVtX3BhZ2VzOwotCWQuZHN0X3Byb3QgPSB0
dG1faW9fcHJvdChkc3QtPm1lbS5wbGFjZW1lbnQsIFBBR0VfS0VSTkVMKTsKLQlkLnNyY19wcm90
ID0gdHRtX2lvX3Byb3Qoc3JjLT5tZW0ucGxhY2VtZW50LCBQQUdFX0tFUk5FTCk7CisJZC5kc3Rf
cHJvdCA9IHR0bV9pb19wcm90KGRzdCwgJmRzdC0+bWVtLCBQQUdFX0tFUk5FTCk7CisJZC5zcmNf
cHJvdCA9IHR0bV9pb19wcm90KHNyYywgJnNyYy0+bWVtLCBQQUdFX0tFUk5FTCk7CiAJZC5kaWZm
ID0gZGlmZjsKIAogCWZvciAoaiA9IDA7IGogPCBoOyArK2opIHsKZGlmZiAtLWdpdCBhL2luY2x1
ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggYi9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZl
ci5oCmluZGV4IDk4OTdhMTZjMGE5ZC4uYTAyOGI0MThjNmI0IDEwMDY0NAotLS0gYS9pbmNsdWRl
L2RybS90dG0vdHRtX2JvX2RyaXZlci5oCisrKyBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJp
dmVyLmgKQEAgLTY2NiwxMyArNjY2LDE1IEBAIGludCB0dG1fYm9fcGlwZWxpbmVfZ3V0dGluZyhz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKTsKIC8qKgogICogdHRtX2lvX3Byb3QKICAqCi0g
KiBAY19zdGF0ZTogQ2FjaGluZyBzdGF0ZS4KKyAqIGJvOiB0dG0gYnVmZmVyIG9iamVjdAorICog
cmVzOiB0dG0gcmVzb3VyY2Ugb2JqZWN0CiAgKiBAdG1wOiBQYWdlIHByb3RlY3Rpb24gZmxhZyBm
b3IgYSBub3JtYWwsIGNhY2hlZCBtYXBwaW5nLgogICoKICAqIFV0aWxpdHkgZnVuY3Rpb24gdGhh
dCByZXR1cm5zIHRoZSBwZ3Byb3RfdCB0aGF0IHNob3VsZCBiZSB1c2VkIGZvcgogICogc2V0dGlu
ZyB1cCBhIFBURSB3aXRoIHRoZSBjYWNoaW5nIG1vZGVsIGluZGljYXRlZCBieSBAY19zdGF0ZS4K
ICAqLwotcGdwcm90X3QgdHRtX2lvX3Byb3QodWludDMyX3QgY2FjaGluZ19mbGFncywgcGdwcm90
X3QgdG1wKTsKK3BncHJvdF90IHR0bV9pb19wcm90KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8sIHN0cnVjdCB0dG1fcmVzb3VyY2UgKnJlcywKKwkJICAgICBwZ3Byb3RfdCB0bXApOwogCiAv
KioKICAqIHR0bV9ib190dF9iaW5kCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVs
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
