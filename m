Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4227731A3F6
	for <lists+dri-devel@lfdr.de>; Fri, 12 Feb 2021 18:46:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 645FC89FED;
	Fri, 12 Feb 2021 17:46:29 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from asav21.altibox.net (asav21.altibox.net [109.247.116.8])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1DFDE89FED
 for <dri-devel@lists.freedesktop.org>; Fri, 12 Feb 2021 17:46:28 +0000 (UTC)
Received: from localhost.localdomain (unknown [81.166.168.211])
 (using TLSv1.2 with cipher ECDHE-RSA-AES128-SHA256 (128/128 bits))
 (No client certificate requested)
 (Authenticated sender: noralf.tronnes@ebnett.no)
 by asav21.altibox.net (Postfix) with ESMTPSA id 43B50803AE;
 Fri, 12 Feb 2021 18:46:25 +0100 (CET)
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v5 3/3] drm: Add Generic USB Display driver
Date: Fri, 12 Feb 2021 18:46:09 +0100
Message-Id: <20210212174609.58977-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20210212174609.58977-1-noralf@tronnes.org>
References: <20210212174609.58977-1-noralf@tronnes.org>
MIME-Version: 1.0
X-CMAE-Score: 0
X-CMAE-Analysis: v=2.3 cv=Kb38TzQD c=1 sm=1 tr=0
 a=OYZzhG0JTxDrWp/F2OJbnw==:117 a=OYZzhG0JTxDrWp/F2OJbnw==:17
 a=IkcTkHD0fZMA:10 a=M51BFTxLslgA:10 a=SJz97ENfAAAA:8 a=gAmX6pxEAAAA:20
 a=e5mUnYsNAAAA:8 a=20KFwNOVAAAA:8 a=YYwQ-93p67mQ_e40OZkA:9
 a=hXm7G3FwO4q2JmIT:21 a=fkRn6FTLqqSYKRFg:21 a=QEXdDO2ut3YA:10
 a=vFet0B0WnEQeilDPIY6i:22 a=Vxmtnl_E_bksehYqCbjh:22
 a=pHzHmUro8NiASowvMSCR:22 a=nt3jZW36AmriUCFCBwmW:22
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: hudson@trmm.net, markus@raatikainen.cc, sam@ravnborg.org,
 linux-usb@vger.kernel.org, th020394@gmail.com, lkundrak@v3.sk,
 pontus.fuchs@gmail.com, Daniel Vetter <daniel.vetter@ffwll.ch>, peter@stuge.se
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgZ2VuZXJpYyBVU0IgZGlzcGxheSBkcml2ZXIgd2l0aCB0aGUgaW50ZW50aW9u
IHRoYXQgaXQgY2FuIGJlCnVzZWQgd2l0aCBmdXR1cmUgVVNCIGludGVyZmFjZWQgbG93IGVuZCBk
aXNwbGF5cy9hZGFwdGVycy4gVGhlIExpbnV4CmdhZGdldCBkZXZpY2UgZHJpdmVyIHdpbGwgc2Vy
dmUgYXMgdGhlIGNhbm9uaWNhbCBkZXZpY2UgaW1wbGVtZW50YXRpb24uCgpUaGUgZm9sbG93aW5n
IERSTSBwcm9wZXJ0aWVzIGFyZSBzdXBwb3J0ZWQ6Ci0gUGxhbmUgcm90YXRpb24KLSBDb25uZWN0
b3IgVFYgcHJvcGVydGllcwoKVGhlcmUgaXMgYWxzbyBzdXBwb3J0IGZvciBiYWNrbGlnaHQgYnJp
Z2h0bmVzcyBleHBvc2VkIGFzIGEgYmFja2xpZ2h0CmRldmljZS4KCkRpc3BsYXkgbW9kZXMgY2Fu
IGJlIG1hZGUgYXZhaWxhYmxlIHRvIHRoZSBob3N0IGRyaXZlciBlaXRoZXIgYXMgRFJNCmRpc3Bs
YXkgbW9kZXMgb3IgdGhyb3VnaCBFRElELiBJZiBib3RoIGFyZSBwcmVzZW50LCBFRElEIGlzIGp1
c3QgcGFzc2VkCm9uIHRvIHVzZXJzcGFjZS4KClBlcmZvcm1hbmNlIGlzIHByZWZlcnJlZCBvdmVy
IGNvbG9yIGRlcHRoLCBzbyBpZiB0aGUgZGV2aWNlIHN1cHBvcnRzClJHQjU2NSwgRFJNX0NBUF9E
VU1CX1BSRUZFUlJFRF9ERVBUSCB3aWxsIHJldHVybiAxNi4KCklmIHRoZSBkZXZpY2UgdHJhbnNm
ZXIgYnVmZmVyIGNhbid0IGZpdCBhbiB1bmNvbXByZXNzZWQgZnJhbWVidWZmZXIKdXBkYXRlLCB0
aGUgdXBkYXRlIGlzIHNwbGl0IHVwIGludG8gcGFydHMgdGhhdCBkbyBmaXQuCgpPcHRpbWFsIHVz
ZXIgZXhwZXJpZW5jZSBpcyBhY2hpZXZlZCBieSBwcm92aWRpbmcgZGFtYWdlIHJlcG9ydHMgZWl0
aGVyIGJ5CnNldHRpbmcgRkJfREFNQUdFX0NMSVBTIG9uIHBhZ2VmbGlwcyBvciBjYWxsaW5nIERS
TV9JT0NUTF9NT0RFX0RJUlRZRkIuCgpMWjQgY29tcHJlc3Npb24gaXMgdXNlZCBpZiB0aGUgZGV2
aWNlIHN1cHBvcnRzIGl0LgoKVGhlIGRyaXZlciBzdXBwb3J0cyBhIG9uZSBiaXQgbW9ub2Nocm9t
ZSB0cmFuc2ZlciBmb3JtYXQ6IFIxLiBUaGlzIGlzIG5vdAppbXBsZW1lbnRlZCBpbiB0aGUgZ2Fk
Z2V0IGRyaXZlci4gSXQgaXMgYWRkZWQgaW4gcHJlcGFyYXRpb24gZm9yIGZ1dHVyZQptb25vY2hy
b21lIGUtaW5rIGRpc3BsYXlzLgoKVGhlIGRyaXZlciBpcyBNSVQgbGljZW5zZWQgdG8gc21vb3Ro
IHRoZSBwYXRoIGZvciBhbnkgQlNEIHBvcnQgb2YgdGhlCmRyaXZlci4KCnYyOgotIFVzZSBkZXZt
X2RybV9kZXZfYWxsb2MoKSBhbmQgZHJtbV9tb2RlX2NvbmZpZ19pbml0KCkKLSBkcm1fZmJkZXZf
Z2VuZXJpY19zZXR1cDogVXNlIHByZWZlcnJlZF9icHA9MCwgMTYgd2FzIGEgY29weSBwYXN0ZSBl
cnJvcgotIFRoZSBkcm1fYmFja2xpZ2h0X2hlbHBlciBpcyBkcm9wcGVkLCBjb3B5IGluIHRoZSBj
b2RlCi0gU3VwcG9ydCBwcm90b2NvbCB2ZXJzaW9uIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZv
ciBkZXZpY2UKCnYzOgotIFVzZSBkb25hdGVkIE9wZW5tb2tvIFVTQiBwaWQKLSBVc2UgZGlyZWN0
IGNvbXByZXNzaW9uIGZyb20gZnJhbWVidWZmZXIgd2hlbiBwaXRjaCBtYXRjaGVzLCBub3Qgb25s
eSBvbgogIGZ1bGwgZnJhbWVzLCBzbyBzcGxpdCB1cGRhdGVzIGNhbiBiZW5lZml0Ci0gVXNlIF9f
bGUxNiBpbiBzdHJ1Y3QgZ3VkX2RybV9yZXFfZ2V0X2Nvbm5lY3Rvcl9zdGF0dXMKLSBTZXQgZWRp
ZCBwcm9wZXJ0eSB3aGVuIHRoZSBkZXZpY2Ugb25seSBwcm92aWRlcyBlZGlkCi0gQ2xlYXIgY29t
cHJlc3Npb24gZmllbGRzIGluIHN0cnVjdCBndWRfZHJtX3JlcV9zZXRfYnVmZmVyCi0gRml4IHBy
b3RvY29sIHZlcnNpb24gbmVnb3RpYXRpb24KLSBSZW1vdmUgbW9kZS0+dnJlZnJlc2gsIGl0J3Mg
Y2FsY3VsYXRlZAoKdjQ6Ci0gRHJvcCB0aGUgc3RhdHVzIHJlcSBwb2xsaW5nIHdoaWNoIHdhcyBh
IHdvcmthcm91bmQgZm9yIHNvbWV0aGluZyB0aGF0CiAgdHVybmVkIG91dCB0byBiZSBhIGR3YzIg
dWRjIGRyaXZlciBwcm9ibGVtCi0gQWRkIGEgZmxhZyBmb3IgdGhlIExpbnV4IGdhZGdldCB0byBy
ZXF1aXJlIGEgc3RhdHVzIHJlcXVlc3Qgb24KICBTRVQgb3BlcmF0aW9ucy4gT3RoZXIgZGV2aWNl
cyB3aWxsIG9ubHkgZ2V0IHN0YXR1cyByZXEgb24gU1RBTEwgZXJyb3JzCi0gVXNlIHByb3RvY29s
IHNwZWNpZmljIGVycm9yIGNvZGVzIChQZXRlcikKLSBBZGQgYSBmbGFnIGZvciBkZXZpY2VzIHRo
YXQgd2FudCB0byByZWNlaXZlIHRoZSBlbnRpcmUgZnJhbWVidWZmZXIgb24KICBlYWNoIGZsdXNo
IChMdWJvbWlyKQotIFJldHJ5IGEgZmFpbGVkIGZyYW1lYnVmZmVyIGZsdXNoCi0gSWYgbW9kZSBo
YXMgY2hhbmdlZCB3YWl0IGZvciB3b3JrZXIgYW5kIGNsZWFyIHBlbmRpbmcgZGFtYWdlIGJlZm9y
ZQogIHF1ZXVpbmcgdXAgbmV3IGRhbWFnZSwgZmIgd2lkdGgvaGVpZ2h0IG1pZ2h0IGhhdmUgY2hh
bmdlZAotIEluY3JlYXNlIGVycm9yIGNvdW50ZXIgb24gYnVsayB0cmFuc2ZlciBmYWlsdXJlcwot
IFVzZSBEUk1fTU9ERV9DT05ORUNUT1JfVVNCCi0gSGFuZGxlIFIxIGttYWxsb2MgZXJyb3IgKFBl
dGVyKQotIERvbid0IHRyeSBhbmQgcmVwbGljYXRlIHRoZSBVU0IgZ2V0IGRlc2NyaXB0b3IgcmVx
dWVzdCBzdGFuZGFyZCBmb3IgdGhlCiAgZGlzcGxheSBkZXNjcmlwdG9yIChQZXRlcikKLSBNYWtl
IG1heF9idWZmZXJfc2l6ZSBvcHRpb25hbCAoUGV0ZXIpLCBkcm9wIHRoZSBwb3cyIHJlcXVpcmVt
ZW50IHNpbmNlCiAgaXQncyBub3QgbmVjZXNzYXJ5IGFueW1vcmUuCi0gRG9uJ3QgcHJlLWFsbG9j
IGEgY29udHJvbCByZXF1ZXN0IGJ1ZmZlciwgaXQgd2FzIG9ubHkgNGsKLSBMZXQgZ3VkLmggZGVz
Y3JpYmUgdGhlIHdob2xlIHByb3RvY29sIGV4cGxpY2l0bHkgYW5kIGRvbid0IGxldCBEUk0KICBs
ZWFrIGludG8gaXQgKFBldGVyKQotIERyb3AgZGlzcGxheSBtb2RlIC5oc2tldyBhbmQgLnZzY2Fu
IGZyb20gdGhlIHByb3RvY29sCi0gU2hvcnRlbiBuYW1lczogcy9HVURfRFJNXy9HVURfLyBzL2d1
ZF9kcm1fL2d1ZF8vIChQZXRlcikKLSBGaXggZ3VkX3BpcGVfY2hlY2soKSBjb25uZWN0b3IgcGlj
a2luZyB3aGVuIHN3aXRjaGluZyBjb25uZWN0b3IKLSBEcm9wIGd1ZF9kcm1fZHJpdmVyX2dlbV9j
cmVhdGVfb2JqZWN0KCkgY2FjaGVkIGlzIGRlZmF1bHQgbm93Ci0gUmV0cmlldmUgVVNCIGRldmlj
ZSBmcm9tIHN0cnVjdCBkcm1fZGV2aWNlLmRldiBpbnN0ZWFkIG9mIGtlZXBpbmcgYQogIHBvaW50
ZXIKLSBIb25vdXIgZmItPm9mZnNldHNbMF0KLSBGaXggbW9kZSBmZXRjaGluZyB3aGVuIGNvbm5l
Y3RvciBzdGF0dXMgaXMgZm9yY2VkCi0gQ2hlY2sgRURJRCBsZW5ndGggcmVwb3J0ZWQgYnkgdGhl
IGRldmljZQotIFVzZSBkcm1fZG9fZ2V0X2VkaWQoKSBzbyB1c2Vyc3BhY2UgY2FuIG92ZXJycmlk
ZSBFRElECi0gU2V0IGVwb2NoIGNvdW50ZXIgdG8gc2lnbmFsIGNvbm5lY3RvciBzdGF0dXMgY2hh
bmdlCi0gZ3VkX2RybV9kcml2ZXIgY2FuIGJlIGNvbnN0IG5vdwoKdjU6Ci0gR1VEX0RSTV9GT1JN
QVRfUjE6IFVzZSBub24taHVtYW4gYXNjaWkgdmFsdWVzIChEYW5pZWwpCi0gQ2hhbmdlIG5hbWUg
dG86IEdVRCBVU0IgRGlzcGxheSAoVGhvbWFzLCBTaW1vbikKLSBDaGFuZ2Ugb25lIF9fdTMyIC0+
IF9fbGUzMiBpbiBwcm90b2NvbCBoZWFkZXIKLSBBbHdheXMgbG9nIGZiIGZsdXNoIGVycm9ycywg
dW5sZXNzIHRoZSBwcmV2aW91cyBvbmUgZmFpbGVkCi0gUnVuIGJhY2tsaWdodCB1cGRhdGUgaW4g
YSB3b3JrZXIgdG8gYXZvaWQgdXBzZXR0aW5nIGxvY2tkZXAgKERhbmllbCkKLSBEcm9wIGJhY2ts
aWdodF9vcHMuZ2V0X2JyaWdodG5lc3MsIHRoZXJlJ3Mgbm8gcmVhZGJhY2sgZnJvbSB0aGUgZGV2
aWNlCiAgc28gaXQgZG9lc24ndCByZWFsbHkgYWRkIGFueXRoaW5nLgotIFNldCBkbWEgbWFzaywg
bmVlZGVkIGJ5IGRtYS1idWYgaW1wb3J0ZXJzCgpDYzogUGV0ZXIgU3R1Z2UgPHBldGVyQHN0dWdl
LnNlPgpUZXN0ZWQtYnk6IEx1Ym9taXIgUmludGVsIDxsa3VuZHJha0B2My5zaz4KQWNrZWQtYnk6
IERhbmllbCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+ClNpZ25lZC1vZmYtYnk6IE5v
cmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3JnPgotLS0KIE1BSU5UQUlORVJTICAgICAg
ICAgICAgICAgICAgICAgICAgIHwgICA4ICsKIGRyaXZlcnMvZ3B1L2RybS9LY29uZmlnICAgICAg
ICAgICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9NYWtlZmlsZSAgICAgICAgICAgIHwgICAx
ICsKIGRyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZyAgICAgICAgIHwgIDE0ICsKIGRyaXZlcnMv
Z3B1L2RybS9ndWQvTWFrZWZpbGUgICAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9ndWQv
Z3VkX2Nvbm5lY3Rvci5jIHwgNzM3ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9ndWQvZ3VkX2Rydi5jICAgICAgIHwgNjI1ICsrKysrKysrKysrKysrKysrKysr
KysrCiBkcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9pbnRlcm5hbC5oICB8IDE0OSArKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9ndWQvZ3VkX3BpcGUuYyAgICAgIHwgNDc1ICsrKysrKysrKysrKysrKysr
KwogaW5jbHVkZS9kcm0vZ3VkLmggICAgICAgICAgICAgICAgICAgfCAzNTYgKysrKysrKysrKysr
KysKIDEwIGZpbGVzIGNoYW5nZWQsIDIzNzEgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvZ3B1L2RybS9ndWQvS2NvbmZpZwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZl
cnMvZ3B1L2RybS9ndWQvTWFrZWZpbGUKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vZ3VkL2d1ZF9jb25uZWN0b3IuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9ndWQvZ3VkX2Rydi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2d1ZC9n
dWRfaW50ZXJuYWwuaAogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9ndWQvZ3Vk
X3BpcGUuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGluY2x1ZGUvZHJtL2d1ZC5oCgpkaWZmIC0tZ2l0
IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCAwMDExMmMwNDQ2MDguLmU3ZjcxYWM1
NWYwOCAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRBSU5FUlMKQEAgLTU1MjUs
NiArNTUyNSwxNCBAQCBTOglNYWludGFpbmVkCiBGOglEb2N1bWVudGF0aW9uL2RldmljZXRyZWUv
YmluZGluZ3MvZGlzcGxheS9wYW5lbC9mZWl5YW5nLGZ5MDcwMjRkaTI2YTMwZC55YW1sCiBGOglk
cml2ZXJzL2dwdS9kcm0vcGFuZWwvcGFuZWwtZmVpeWFuZy1meTA3MDI0ZGkyNmEzMGQuYwogCitE
Uk0gRFJJVkVSIEZPUiBHRU5FUklDIFVTQiBESVNQTEFZCitNOglOb3JhbGYgVHLDuG5uZXMgPG5v
cmFsZkB0cm9ubmVzLm9yZz4KK1M6CU1haW50YWluZWQKK1c6CWh0dHBzOi8vZ2l0aHViLmNvbS9u
b3Ryby9ndWQvd2lraQorVDoJZ2l0IGdpdDovL2Fub25naXQuZnJlZWRlc2t0b3Aub3JnL2RybS9k
cm0tbWlzYworRjoJZHJpdmVycy9ncHUvZHJtL2d1ZC8KK0Y6CWluY2x1ZGUvZHJtL2d1ZC5oCisK
IERSTSBEUklWRVIgRk9SIEdSQUlOIE1FRElBIEdNMTJVMzIwIFBST0pFQ1RPUlMKIE06CUhhbnMg
ZGUgR29lZGUgPGhkZWdvZWRlQHJlZGhhdC5jb20+CiBTOglNYWludGFpbmVkCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZyBiL2RyaXZlcnMvZ3B1L2RybS9LY29uZmlnCmluZGV4
IDE0N2Q2MWI5Njc0ZS4uNmQzZjQ3OTMzZTUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
S2NvbmZpZworKysgYi9kcml2ZXJzL2dwdS9kcm0vS2NvbmZpZwpAQCAtMzg4LDYgKzM4OCw4IEBA
IHNvdXJjZSAiZHJpdmVycy9ncHUvZHJtL3RpZHNzL0tjb25maWciCiAKIHNvdXJjZSAiZHJpdmVy
cy9ncHUvZHJtL3hsbngvS2NvbmZpZyIKIAorc291cmNlICJkcml2ZXJzL2dwdS9kcm0vZ3VkL0tj
b25maWciCisKICMgS2VlcCBsZWdhY3kgZHJpdmVycyBsYXN0CiAKIG1lbnVjb25maWcgRFJNX0xF
R0FDWQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxlIGIvZHJpdmVycy9ncHUv
ZHJtL01ha2VmaWxlCmluZGV4IDgxNTY5MDA5Zjg4NC4uNzhkZDhlMTI1MjVkIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL01ha2VmaWxl
CkBAIC0xMjQsMyArMTI0LDQgQEAgb2JqLSQoQ09ORklHX0RSTV9BU1BFRURfR0ZYKSArPSBhc3Bl
ZWQvCiBvYmotJChDT05GSUdfRFJNX01DREUpICs9IG1jZGUvCiBvYmotJChDT05GSUdfRFJNX1RJ
RFNTKSArPSB0aWRzcy8KIG9iai15CQkJKz0geGxueC8KK29iai15CQkJKz0gZ3VkLwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9L
Y29uZmlnCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMWM4NjAxYmY0
ZDkxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9LY29uZmlnCkBAIC0w
LDAgKzEsMTQgQEAKKyMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAKKworY29uZmln
IERSTV9HVUQKKwl0cmlzdGF0ZSAiR1VEIFVTQiBEaXNwbGF5IgorCWRlcGVuZHMgb24gRFJNICYm
IFVTQgorCXNlbGVjdCBMWjRfQ09NUFJFU1MKKwlzZWxlY3QgRFJNX0tNU19IRUxQRVIKKwlzZWxl
Y3QgRFJNX0dFTV9TSE1FTV9IRUxQRVIKKwlzZWxlY3QgQkFDS0xJR0hUX0NMQVNTX0RFVklDRQor
CWhlbHAKKwkgIFRoaXMgaXMgYSBEUk0gZGlzcGxheSBkcml2ZXIgZm9yIEdVRCBVU0IgRGlzcGxh
eXMgb3IgZGlzcGxheQorCSAgYWRhcHRlcnMuCisKKwkgIElmIE0gaXMgc2VsZWN0ZWQgdGhlIG1v
ZHVsZSB3aWxsIGJlIGNhbGxlZCBndWQuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3Vk
L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2d1ZC9NYWtlZmlsZQpuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmQyYmI1M2E2NWRlNgotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9ndWQvTWFrZWZpbGUKQEAgLTAsMCArMSw0IEBACisjIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wCisKK2d1ZC1vYmpzCQkJOj0gZ3VkX2Rydi5vIGd1ZF9w
aXBlLm8gZ3VkX2Nvbm5lY3Rvci5vCitvYmotJChDT05GSUdfRFJNX0dVRCkJCSs9IGd1ZC5vCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9jb25uZWN0b3IuYyBiL2RyaXZlcnMv
Z3B1L2RybS9ndWQvZ3VkX2Nvbm5lY3Rvci5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAwMDAwMC4uYWUwN2U1ZDk2MTc0Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2d1ZC9ndWRfY29ubmVjdG9yLmMKQEAgLTAsMCArMSw3MzcgQEAKKy8vIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgMjAyMCBOb3JhbGYgVHLDuG5uZXMK
KyAqLworCisjaW5jbHVkZSA8bGludXgvYmFja2xpZ2h0Lmg+CisjaW5jbHVkZSA8bGludXgvd29y
a3F1ZXVlLmg+CisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pYy5oPgorI2luY2x1ZGUgPGRybS9k
cm1fYXRvbWljX3N0YXRlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fY29ubmVjdG9yLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9kcnYuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4K
KyNpbmNsdWRlIDxkcm0vZHJtX2ZpbGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21vZGVzZXRfaGVs
cGVyX3Z0YWJsZXMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3ByaW50Lmg+CisjaW5jbHVkZSA8ZHJt
L2RybV9wcm9iZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3NpbXBsZV9rbXNfaGVscGVy
Lmg+CisjaW5jbHVkZSA8ZHJtL2d1ZC5oPgorCisjaW5jbHVkZSAiZ3VkX2ludGVybmFsLmgiCisK
K3N0cnVjdCBndWRfY29ubmVjdG9yIHsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciBjb25uZWN0b3I7
CisJc3RydWN0IGRybV9lbmNvZGVyIGVuY29kZXI7CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2Ug
KmJhY2tsaWdodDsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3QgYmFja2xpZ2h0X3dvcms7CisKKwkvKiBT
dXBwb3J0ZWQgcHJvcGVydGllcyAqLworCXUxNiAqcHJvcGVydGllczsKKwl1bnNpZ25lZCBpbnQg
bnVtX3Byb3BlcnRpZXM7CisKKwkvKiBJbml0aWFsIGdhZGdldCB0diBzdGF0ZSBpZiBhcHBsaWNh
YmxlLCBhcHBsaWVkIG9uIHN0YXRlIHJlc2V0ICovCisJc3RydWN0IGRybV90dl9jb25uZWN0b3Jf
c3RhdGUgaW5pdGlhbF90dl9zdGF0ZTsKKworCS8qCisJICogSW5pdGlhbCBnYWRnZXQgYmFja2xp
Z2h0IGJyaWdodG5lc3MgaWYgYXBwbGljYWJsZSwgYXBwbGllZCBvbiBzdGF0ZSByZXNldC4KKwkg
KiBUaGUgdmFsdWUgLUVOT0RFViBpcyB1c2VkIHRvIHNpZ25hbCBubyBiYWNrbGlnaHQuCisJICov
CisJaW50IGluaXRpYWxfYnJpZ2h0bmVzczsKKworCXVuc2lnbmVkIGludCBudW1fbW9kZXM7CisJ
c2l6ZV90IGVkaWRfbGVuOworfTsKKworc3RhdGljIGlubGluZSBzdHJ1Y3QgZ3VkX2Nvbm5lY3Rv
ciAqdG9fZ3VkX2Nvbm5lY3RvcihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQorewor
CXJldHVybiBjb250YWluZXJfb2YoY29ubmVjdG9yLCBzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciwgY29u
bmVjdG9yKTsKK30KKworLyoKKyAqIFVzZSBhIHdvcmtlciB0byBhdm9pZCB0YWtpbmcga21zIGxv
Y2tzIGluc2lkZSB0aGUgYmFja2xpZ2h0IGxvY2suCisgKiBPdGhlciBkaXNwbGF5IGRyaXZlcnMg
dXNlIGJhY2tsaWdodCB3aXRoaW4gdGhlaXIga21zIGxvY2tzLgorICogVGhpcyBhdm9pZHMgaW5j
b25zaXN0ZW50IGxvY2tpbmcgcnVsZXMsIHdoaWNoIHdvdWxkIHVwc2V0IGxvY2tkZXAuCisgKi8K
K3N0YXRpYyB2b2lkIGd1ZF9jb25uZWN0b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXNfd29yayhz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25u
ID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBndWRfY29ubmVjdG9yLCBiYWNrbGlnaHRfd29y
ayk7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9ICZnY29ubi0+Y29ubmVjdG9y
OworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGU7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRybSA9IGNvbm5lY3Rvci0+ZGV2OworCXN0cnVjdCBkcm1fbW9kZXNldF9h
Y3F1aXJlX2N0eCBjdHg7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOworCWludCBp
ZHgsIHJldDsKKworCWlmICghZHJtX2Rldl9lbnRlcihkcm0sICZpZHgpKQorCQlyZXR1cm47CisK
KwlzdGF0ZSA9IGRybV9hdG9taWNfc3RhdGVfYWxsb2MoZHJtKTsKKwlpZiAoIXN0YXRlKSB7CisJ
CXJldCA9IC1FTk9NRU07CisJCWdvdG8gZXhpdDsKKwl9CisKKwlkcm1fbW9kZXNldF9hY3F1aXJl
X2luaXQoJmN0eCwgMCk7CisJc3RhdGUtPmFjcXVpcmVfY3R4ID0gJmN0eDsKK3JldHJ5OgorCWNv
bm5lY3Rvcl9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSwgY29u
bmVjdG9yKTsKKwlpZiAoSVNfRVJSKGNvbm5lY3Rvcl9zdGF0ZSkpIHsKKwkJcmV0ID0gUFRSX0VS
Uihjb25uZWN0b3Jfc3RhdGUpOworCQlnb3RvIG91dDsKKwl9CisKKwkvKiBSZXVzZSB0di5icmln
aHRuZXNzIHRvIGF2b2lkIGhhdmluZyB0byBzdWJjbGFzcyAqLworCWNvbm5lY3Rvcl9zdGF0ZS0+
dHYuYnJpZ2h0bmVzcyA9IGdjb25uLT5iYWNrbGlnaHQtPnByb3BzLmJyaWdodG5lc3M7CisKKwly
ZXQgPSBkcm1fYXRvbWljX2NvbW1pdChzdGF0ZSk7CitvdXQ6CisJaWYgKHJldCA9PSAtRURFQURM
SykgeworCQlkcm1fYXRvbWljX3N0YXRlX2NsZWFyKHN0YXRlKTsKKwkJZHJtX21vZGVzZXRfYmFj
a29mZigmY3R4KTsKKwkJZ290byByZXRyeTsKKwl9CisKKwlkcm1fYXRvbWljX3N0YXRlX3B1dChz
dGF0ZSk7CisKKwlkcm1fbW9kZXNldF9kcm9wX2xvY2tzKCZjdHgpOworCWRybV9tb2Rlc2V0X2Fj
cXVpcmVfZmluaSgmY3R4KTsKK2V4aXQ6CisJZHJtX2Rldl9leGl0KGlkeCk7CisKKwlpZiAocmV0
KQorCQlkZXZfZXJyKGRybS0+ZGV2LCAiRmFpbGVkIHRvIHVwZGF0ZSBiYWNrbGlnaHQsIGVycj0l
ZFxuIiwgcmV0KTsKK30KKworc3RhdGljIGludCBndWRfY29ubmVjdG9yX2JhY2tsaWdodF91cGRh
dGVfc3RhdHVzKHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiZCkKK3sKKwlzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yID0gYmxfZ2V0X2RhdGEoYmQpOworCXN0cnVjdCBndWRfY29ubmVj
dG9yICpnY29ubiA9IHRvX2d1ZF9jb25uZWN0b3IoY29ubmVjdG9yKTsKKworCS8qIFRoZSBVU0Ig
dGltZW91dCBpcyA1IHNlY29uZHMgc28gdXNlIHN5c3RlbV9sb25nX3dxIGZvciB3b3JzdCBjYXNl
IHNjZW5hcmlvICovCisJcXVldWVfd29yayhzeXN0ZW1fbG9uZ193cSwgJmdjb25uLT5iYWNrbGln
aHRfd29yayk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBiYWNrbGln
aHRfb3BzIGd1ZF9jb25uZWN0b3JfYmFja2xpZ2h0X29wcyA9IHsKKwkudXBkYXRlX3N0YXR1cwk9
IGd1ZF9jb25uZWN0b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0dXMsCit9OworCitzdGF0aWMgaW50
IGd1ZF9jb25uZWN0b3JfYmFja2xpZ2h0X3JlZ2lzdGVyKHN0cnVjdCBndWRfY29ubmVjdG9yICpn
Y29ubikKK3sKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gJmdjb25uLT5jb25u
ZWN0b3I7CisJc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkOworCWNvbnN0IGNoYXIgKm5hbWU7
CisJY29uc3Qgc3RydWN0IGJhY2tsaWdodF9wcm9wZXJ0aWVzIHByb3BzID0geworCQkudHlwZSA9
IEJBQ0tMSUdIVF9SQVcsCisJCS5zY2FsZSA9IEJBQ0tMSUdIVF9TQ0FMRV9OT05fTElORUFSLAor
CQkubWF4X2JyaWdodG5lc3MgPSAxMDAsCisJfTsKKworCW5hbWUgPSBrYXNwcmludGYoR0ZQX0tF
Uk5FTCwgImNhcmQlZC0lcy1iYWNrbGlnaHQiLAorCQkJIGNvbm5lY3Rvci0+ZGV2LT5wcmltYXJ5
LT5pbmRleCwgY29ubmVjdG9yLT5uYW1lKTsKKwlpZiAoIW5hbWUpCisJCXJldHVybiAtRU5PTUVN
OworCisJYmQgPSBiYWNrbGlnaHRfZGV2aWNlX3JlZ2lzdGVyKG5hbWUsIGNvbm5lY3Rvci0+a2Rl
diwgY29ubmVjdG9yLAorCQkJCSAgICAgICAmZ3VkX2Nvbm5lY3Rvcl9iYWNrbGlnaHRfb3BzLCAm
cHJvcHMpOworCWtmcmVlKG5hbWUpOworCWlmIChJU19FUlIoYmQpKQorCQlyZXR1cm4gUFRSX0VS
UihiZCk7CisKKwlnY29ubi0+YmFja2xpZ2h0ID0gYmQ7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBndWRfY29ubmVjdG9yX3N0YXR1c19yZXF1ZXN0KHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IpCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nv
bm5lY3Rvcihjb25uZWN0b3IpOworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0gdG9fZ3VkX2Rl
dmljZShjb25uZWN0b3ItPmRldik7CisJc3RydWN0IGd1ZF9jb25uZWN0b3Jfc3RhdHVzX3JlcSBy
ZXE7CisJdTE2IG51bV9tb2RlcywgZWRpZF9sZW47CisJaW50IHJldDsKKworCXJldCA9IGd1ZF91
c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX0NPTk5FQ1RPUl9TVEFUVVMsCisJCQkgIGNvbm5lY3Rv
ci0+aW5kZXgsICZyZXEsIHNpemVvZihyZXEpKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJc3dpdGNoIChyZXEuc3RhdHVzICYgR1VEX0NPTk5FQ1RPUl9TVEFUVVNfQ09OTkVDVEVEX01B
U0spIHsKKwljYXNlIEdVRF9DT05ORUNUT1JfU1RBVFVTX0RJU0NPTk5FQ1RFRDoKKwkJcmV0ID0g
Y29ubmVjdG9yX3N0YXR1c19kaXNjb25uZWN0ZWQ7CisJCWJyZWFrOworCWNhc2UgR1VEX0NPTk5F
Q1RPUl9TVEFUVVNfQ09OTkVDVEVEOgorCQlyZXQgPSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3Rl
ZDsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0ID0gY29ubmVjdG9yX3N0YXR1c191bmtub3du
OworCQlicmVhazsKKwl9OworCisJbnVtX21vZGVzID0gbGUxNl90b19jcHUocmVxLm51bV9tb2Rl
cyk7CisJZWRpZF9sZW4gPSBsZTE2X3RvX2NwdShyZXEuZWRpZF9sZW4pOworCisJaWYgKGVkaWRf
bGVuICUgRURJRF9MRU5HVEgpIHsKKwkJZHJtX2Vycihjb25uZWN0b3ItPmRldiwgIiVzOiBJbnZh
bGlkIEVESUQgc2l6ZTogJXVcbiIsIGNvbm5lY3Rvci0+bmFtZSwgZWRpZF9sZW4pOworCQllZGlk
X2xlbiA9IDA7CisJfQorCisJaWYgKHJlcS5zdGF0dXMgJiBHVURfQ09OTkVDVE9SX1NUQVRVU19D
SEFOR0VEIHx8CisJICAgIGdjb25uLT5udW1fbW9kZXMgIT0gbnVtX21vZGVzIHx8IGdjb25uLT5l
ZGlkX2xlbiAhPSBlZGlkX2xlbikKKwkJY29ubmVjdG9yLT5lcG9jaF9jb3VudGVyICs9IDE7CisK
KwlnY29ubi0+bnVtX21vZGVzID0gbnVtX21vZGVzOworCWdjb25uLT5lZGlkX2xlbiA9IGVkaWRf
bGVuOworCisJaWYgKCFudW1fbW9kZXMgJiYgIWVkaWRfbGVuICYmIHJldCAhPSBjb25uZWN0b3Jf
c3RhdHVzX2Rpc2Nvbm5lY3RlZCkKKwkJZHJtX2RiZ19rbXMoY29ubmVjdG9yLT5kZXYsICIlczog
Tm8gbW9kZXMgb3IgRURJRC5cbiIsIGNvbm5lY3Rvci0+bmFtZSk7CisKKwlyZXR1cm4gcmV0Owor
fQorCitzdGF0aWMgaW50IGd1ZF9jb25uZWN0b3JfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCisJCQkJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4ICpjdHgsIGJv
b2wgZm9yY2UpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGNv
bm5lY3Rvci0+ZGV2KTsKKwlpbnQgaWR4LCByZXQ7CisKKwlpZiAoIWRybV9kZXZfZW50ZXIoY29u
bmVjdG9yLT5kZXYsICZpZHgpKQorCQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19kaXNjb25uZWN0
ZWQ7CisKKwlpZiAoZm9yY2UpIHsKKwkJcmV0ID0gZ3VkX3VzYl9zZXQoZ2RybSwgR1VEX1JFUV9T
RVRfQ09OTkVDVE9SX0ZPUkNFX0RFVEVDVCwKKwkJCQkgIGNvbm5lY3Rvci0+aW5kZXgsIE5VTEws
IDApOworCQlpZiAocmV0KSB7CisJCQlyZXQgPSBjb25uZWN0b3Jfc3RhdHVzX3Vua25vd247CisJ
CQlnb3RvIGV4aXQ7CisJCX0KKwl9CisKKwlyZXQgPSBndWRfY29ubmVjdG9yX3N0YXR1c19yZXF1
ZXN0KGNvbm5lY3Rvcik7CisJaWYgKHJldCA8IDApCisJCXJldCA9IGNvbm5lY3Rvcl9zdGF0dXNf
dW5rbm93bjsKK2V4aXQ6CisJZHJtX2Rldl9leGl0KGlkeCk7CisKKwlyZXR1cm4gcmV0OworfQor
CitzdHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9nZXRfZWRpZF9jdHggeworCXN0cnVjdCBndWRfY29ubmVj
dG9yICpnY29ubjsKKwl2b2lkICpidWY7Cit9OworCitzdGF0aWMgaW50IGd1ZF9jb25uZWN0b3Jf
Z2V0X2VkaWRfYmxvY2sodm9pZCAqZGF0YSwgdTggKmJ1ZiwgdW5zaWduZWQgaW50IGJsb2NrLCBz
aXplX3QgbGVuKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yX2dldF9lZGlkX2N0eCAqY3R4ID0g
ZGF0YTsKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSBjdHgtPmdjb25uOworCXNpemVf
dCBzdGFydCA9IGJsb2NrICogRURJRF9MRU5HVEg7CisKKwlpZiAoc3RhcnQgKyBsZW4gPiBnY29u
bi0+ZWRpZF9sZW4pCisJCXJldHVybiAtMTsKKworCWlmICghYmxvY2spIHsKKwkJc3RydWN0IGd1
ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGdjb25uLT5jb25uZWN0b3IuZGV2KTsKKwkJ
aW50IHJldDsKKworCQkvKiBDaGVjayBiZWNhdXNlIGRybV9kb19nZXRfZWRpZCgpIHdpbGwgcmV0
cnkgb24gZmFpbHVyZSAqLworCQlpZiAoIWN0eC0+YnVmKQorCQkJY3R4LT5idWYgPSBrbWFsbG9j
KGdjb25uLT5lZGlkX2xlbiwgR0ZQX0tFUk5FTCk7CisJCWlmICghY3R4LT5idWYpCisJCQlyZXR1
cm4gLTE7CisKKwkJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9S
X0VESUQsIGdjb25uLT5jb25uZWN0b3IuaW5kZXgsCisJCQkJICBjdHgtPmJ1ZiwgZ2Nvbm4tPmVk
aWRfbGVuKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiAtMTsKKwl9CisKKwltZW1jcHkoYnVmLCBj
dHgtPmJ1ZiArIHN0YXJ0LCBsZW4pOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZ3Vk
X2Nvbm5lY3Rvcl9nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sK
KwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSB0b19ndWRfY29ubmVjdG9yKGNvbm5lY3Rv
cik7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGNvbm5lY3Rvci0+
ZGV2KTsKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3Rvcl9nZXRfZWRpZF9jdHggZWRpZF9jdHggPSB7CisJ
CS5nY29ubiA9IGdjb25uLAorCX07CisJc3RydWN0IGd1ZF9kaXNwbGF5X21vZGVfcmVxICpyZXFt
b2RlcyA9IE5VTEw7CisJdW5zaWduZWQgaW50IGksIG51bV9tb2RlcyA9IDA7CisJc3RydWN0IGVk
aWQgKmVkaWQgPSBOVUxMOworCWJvb2wgZWRpZF9vdmVycmlkZTsKKwlpbnQgaWR4LCByZXQ7CisK
KwlpZiAoIWRybV9kZXZfZW50ZXIoY29ubmVjdG9yLT5kZXYsICZpZHgpKQorCQlyZXR1cm4gMDsK
KworCWlmIChjb25uZWN0b3ItPmZvcmNlKSB7CisJCXJldCA9IGd1ZF9jb25uZWN0b3Jfc3RhdHVz
X3JlcXVlc3QoY29ubmVjdG9yKTsKKwkJaWYgKHJldCA8IDApCisJCQlnb3RvIG91dDsKKwl9CisK
KwllZGlkID0gZHJtX2RvX2dldF9lZGlkKGNvbm5lY3RvciwgZ3VkX2Nvbm5lY3Rvcl9nZXRfZWRp
ZF9ibG9jaywgJmVkaWRfY3R4KTsKKwllZGlkX292ZXJyaWRlID0gZWRpZCAmJiAhZWRpZF9jdHgu
YnVmOworCWtmcmVlKGVkaWRfY3R4LmJ1Zik7CisJZHJtX2Nvbm5lY3Rvcl91cGRhdGVfZWRpZF9w
cm9wZXJ0eShjb25uZWN0b3IsIGVkaWQpOworCisJaWYgKCFnY29ubi0+bnVtX21vZGVzIHx8IGVk
aWRfb3ZlcnJpZGUpIHsKKwkJbnVtX21vZGVzID0gZHJtX2FkZF9lZGlkX21vZGVzKGNvbm5lY3Rv
ciwgZWRpZCk7CisJCWdvdG8gb3V0OworCX0KKworCXJlcW1vZGVzID0ga21hbGxvY19hcnJheShn
Y29ubi0+bnVtX21vZGVzLCBzaXplb2YoKnJlcW1vZGVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFy
ZXFtb2RlcykKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBndWRfdXNiX2dldChnZHJtLCBHVURfUkVR
X0dFVF9DT05ORUNUT1JfTU9ERVMsIGNvbm5lY3Rvci0+aW5kZXgsCisJCQkgIHJlcW1vZGVzLCBn
Y29ubi0+bnVtX21vZGVzICogc2l6ZW9mKCpyZXFtb2RlcykpOworCWlmIChyZXQpCisJCWdvdG8g
b3V0OworCisJZm9yIChpID0gMDsgaSA8IGdjb25uLT5udW1fbW9kZXM7IGkrKykgeworCQlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZTsKKworCQltb2RlID0gZHJtX21vZGVfY3JlYXRlKGNv
bm5lY3Rvci0+ZGV2KTsKKwkJaWYgKCFtb2RlKQorCQkJZ290byBvdXQ7CisKKwkJZ3VkX3RvX2Rp
c3BsYXlfbW9kZShtb2RlLCAmcmVxbW9kZXNbaV0pOworCQlkcm1fbW9kZV9wcm9iZWRfYWRkKGNv
bm5lY3RvciwgbW9kZSk7CisJCW51bV9tb2RlcysrOworCX0KK291dDoKKwlrZnJlZShyZXFtb2Rl
cyk7CisJa2ZyZWUoZWRpZCk7CisJZHJtX2Rldl9leGl0KGlkeCk7CisKKwlyZXR1cm4gbnVtX21v
ZGVzOworfQorCitzdGF0aWMgaW50IGd1ZF9jb25uZWN0b3JfYXRvbWljX2NoZWNrKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpuZXdfc3RhdGU7CisJ
c3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqb2xkX3N0YXRlOworCisJbmV3X3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3
X2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yKTsKKwlpZiAoIW5ld19zdGF0ZS0+Y3J0
YykKKwkJcmV0dXJuIDA7CisKKwlvbGRfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY29ubmVj
dG9yX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCW5ld19jcnRjX3N0YXRlID0gZHJtX2F0b21p
Y19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIG5ld19zdGF0ZS0+Y3J0Yyk7CisKKwlpZiAob2xk
X3N0YXRlLT50di5tYXJnaW5zLmxlZnQgIT0gbmV3X3N0YXRlLT50di5tYXJnaW5zLmxlZnQgfHwK
KwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLnJpZ2h0ICE9IG5ld19zdGF0ZS0+dHYubWFyZ2lu
cy5yaWdodCB8fAorCSAgICBvbGRfc3RhdGUtPnR2Lm1hcmdpbnMudG9wICE9IG5ld19zdGF0ZS0+
dHYubWFyZ2lucy50b3AgfHwKKwkgICAgb2xkX3N0YXRlLT50di5tYXJnaW5zLmJvdHRvbSAhPSBu
ZXdfc3RhdGUtPnR2Lm1hcmdpbnMuYm90dG9tIHx8CisJICAgIG9sZF9zdGF0ZS0+dHYubW9kZSAh
PSBuZXdfc3RhdGUtPnR2Lm1vZGUgfHwKKwkgICAgb2xkX3N0YXRlLT50di5icmlnaHRuZXNzICE9
IG5ld19zdGF0ZS0+dHYuYnJpZ2h0bmVzcyB8fAorCSAgICBvbGRfc3RhdGUtPnR2LmNvbnRyYXN0
ICE9IG5ld19zdGF0ZS0+dHYuY29udHJhc3QgfHwKKwkgICAgb2xkX3N0YXRlLT50di5mbGlja2Vy
X3JlZHVjdGlvbiAhPSBuZXdfc3RhdGUtPnR2LmZsaWNrZXJfcmVkdWN0aW9uIHx8CisJICAgIG9s
ZF9zdGF0ZS0+dHYub3ZlcnNjYW4gIT0gbmV3X3N0YXRlLT50di5vdmVyc2NhbiB8fAorCSAgICBv
bGRfc3RhdGUtPnR2LnNhdHVyYXRpb24gIT0gbmV3X3N0YXRlLT50di5zYXR1cmF0aW9uIHx8CisJ
ICAgIG9sZF9zdGF0ZS0+dHYuaHVlICE9IG5ld19zdGF0ZS0+dHYuaHVlKQorCQluZXdfY3J0Y19z
dGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2VkID0gdHJ1ZTsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfaGVscGVyX2Z1bmNzIGd1ZF9jb25uZWN0b3Jf
aGVscGVyX2Z1bmNzID0geworCS5kZXRlY3RfY3R4ID0gZ3VkX2Nvbm5lY3Rvcl9kZXRlY3QsCisJ
LmdldF9tb2RlcyA9IGd1ZF9jb25uZWN0b3JfZ2V0X21vZGVzLAorCS5hdG9taWNfY2hlY2sgPSBn
dWRfY29ubmVjdG9yX2F0b21pY19jaGVjaywKK307CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rv
cl9sYXRlX3JlZ2lzdGVyKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3Ry
dWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rvcihjb25uZWN0b3IpOwor
CisJaWYgKGdjb25uLT5pbml0aWFsX2JyaWdodG5lc3MgPCAwKQorCQlyZXR1cm4gMDsKKworCXJl
dHVybiBndWRfY29ubmVjdG9yX2JhY2tsaWdodF9yZWdpc3RlcihnY29ubik7Cit9CisKK3N0YXRp
YyB2b2lkIGd1ZF9jb25uZWN0b3JfZWFybHlfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29ubiA9IHRvX2d1ZF9j
b25uZWN0b3IoY29ubmVjdG9yKTsKKworCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdpc3RlcihnY29u
bi0+YmFja2xpZ2h0KTsKKwljYW5jZWxfd29ya19zeW5jKCZnY29ubi0+YmFja2xpZ2h0X3dvcmsp
OworfQorCitzdGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX2Rlc3Ryb3koc3RydWN0IGRybV9jb25u
ZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZ3VkX2Nvbm5lY3RvciAqZ2Nvbm4gPSB0b19n
dWRfY29ubmVjdG9yKGNvbm5lY3Rvcik7CisKKwlkcm1fY29ubmVjdG9yX2NsZWFudXAoY29ubmVj
dG9yKTsKKwlrZnJlZShnY29ubi0+cHJvcGVydGllcyk7CisJa2ZyZWUoZ2Nvbm4pOworfQorCitz
dGF0aWMgdm9pZCBndWRfY29ubmVjdG9yX3Jlc2V0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IpCit7CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rv
cihjb25uZWN0b3IpOworCisJZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX3Jlc2V0KGNvbm5l
Y3Rvcik7CisJY29ubmVjdG9yLT5zdGF0ZS0+dHYgPSBnY29ubi0+aW5pdGlhbF90dl9zdGF0ZTsK
KwkvKiBTZXQgbWFyZ2lucyBmcm9tIGNvbW1hbmQgbGluZSAqLworCWRybV9hdG9taWNfaGVscGVy
X2Nvbm5lY3Rvcl90dl9yZXNldChjb25uZWN0b3IpOworCWlmIChnY29ubi0+aW5pdGlhbF9icmln
aHRuZXNzID49IDApCisJCWNvbm5lY3Rvci0+c3RhdGUtPnR2LmJyaWdodG5lc3MgPSBnY29ubi0+
aW5pdGlhbF9icmlnaHRuZXNzOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3JfZnVuY3MgZ3VkX2Nvbm5lY3Rvcl9mdW5jcyA9IHsKKwkuZmlsbF9tb2RlcyA9IGRybV9oZWxw
ZXJfcHJvYmVfc2luZ2xlX2Nvbm5lY3Rvcl9tb2RlcywKKwkubGF0ZV9yZWdpc3RlciA9IGd1ZF9j
b25uZWN0b3JfbGF0ZV9yZWdpc3RlciwKKwkuZWFybHlfdW5yZWdpc3RlciA9IGd1ZF9jb25uZWN0
b3JfZWFybHlfdW5yZWdpc3RlciwKKwkuZGVzdHJveSA9IGd1ZF9jb25uZWN0b3JfZGVzdHJveSwK
KwkucmVzZXQgPSBndWRfY29ubmVjdG9yX3Jlc2V0LAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRl
ID0gZHJtX2F0b21pY19oZWxwZXJfY29ubmVjdG9yX2R1cGxpY2F0ZV9zdGF0ZSwKKwkuYXRvbWlj
X2Rlc3Ryb3lfc3RhdGUgPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0b3JfZGVzdHJveV9zdGF0
ZSwKK307CisKKy8qCisgKiBUaGUgdHYubW9kZSBwcm9wZXJ0eSBpcyBzaGFyZWQgYW1vbmcgdGhl
IGNvbm5lY3RvcnMgYW5kIGl0cyBlbnVtIG5hbWVzIGFyZQorICogZHJpdmVyIHNwZWNpZmljLiBU
aGlzIG1lYW5zIHRoYXQgaWYgbW9yZSB0aGFuIG9uZSBjb25uZWN0b3IgdXNlcyB0di5tb2RlLAor
ICogdGhlIGVudW0gbmFtZXMgaGFzIHRvIGJlIHRoZSBzYW1lLgorICovCitzdGF0aWMgaW50IGd1
ZF9jb25uZWN0b3JfYWRkX3R2X21vZGUoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sCisJCQkJICAg
ICBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1NjQgdmFsKQoreworCXVuc2lnbmVk
IGludCBpLCBudW1fbW9kZXM7CisJY29uc3QgY2hhciAqKm1vZGVzOworCXNpemVfdCBidWZfbGVu
OworCWNoYXIgKmJ1ZjsKKwlpbnQgcmV0OworCisJbnVtX21vZGVzID0gdmFsID4+IEdVRF9DT05O
RUNUT1JfVFZfTU9ERV9OVU1fU0hJRlQ7CisKKwlpZiAoIW51bV9tb2RlcykKKwkJcmV0dXJuIC1F
SU5WQUw7CisKKwlidWZfbGVuID0gbnVtX21vZGVzICogR1VEX0NPTk5FQ1RPUl9UVl9NT0RFX05B
TUVfTEVOOworCW1vZGVzID0ga21hbGxvY19hcnJheShudW1fbW9kZXMsIHNpemVvZigqbW9kZXMp
LCBHRlBfS0VSTkVMKTsKKwlidWYgPSBrbWFsbG9jKGJ1Zl9sZW4sIEdGUF9LRVJORUwpOworCWlm
ICghbW9kZXMgfHwgIWJ1ZikgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIGZyZWU7CisJfQor
CisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX1RWX01PREVf
VkFMVUVTLAorCQkJICBjb25uZWN0b3ItPmluZGV4LCBidWYsIGJ1Zl9sZW4pOworCWlmIChyZXQp
CisJCWdvdG8gZnJlZTsKKworCWZvciAoaSA9IDA7IGkgPCBudW1fbW9kZXM7IGkrKykKKwkJbW9k
ZXNbaV0gPSAmYnVmW2kgKiBHVURfQ09OTkVDVE9SX1RWX01PREVfTkFNRV9MRU5dOworCisJcmV0
ID0gZHJtX21vZGVfY3JlYXRlX3R2X3Byb3BlcnRpZXMoY29ubmVjdG9yLT5kZXYsIG51bV9tb2Rl
cywgbW9kZXMpOworZnJlZToKKwlrZnJlZShtb2Rlcyk7CisJa2ZyZWUoYnVmKTsKKworCXJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX3Byb3BlcnR5ICoKK2d1ZF9jb25uZWN0b3Jf
cHJvcGVydHlfbG9va3VwKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIHUxNiBwcm9w
KQoreworCXN0cnVjdCBkcm1fbW9kZV9jb25maWcgKmNvbmZpZyA9ICZjb25uZWN0b3ItPmRldi0+
bW9kZV9jb25maWc7CisKKwlzd2l0Y2ggKHByb3ApIHsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9M
RUZUX01BUkdJTjoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfbGVmdF9tYXJnaW5fcHJvcGVydHk7CisJ
Y2FzZSBHVURfUFJPUEVSVFlfVFZfUklHSFRfTUFSR0lOOgorCQlyZXR1cm4gY29uZmlnLT50dl9y
aWdodF9tYXJnaW5fcHJvcGVydHk7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfVE9QX01BUkdJTjoK
KwkJcmV0dXJuIGNvbmZpZy0+dHZfdG9wX21hcmdpbl9wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9Q
RVJUWV9UVl9CT1RUT01fTUFSR0lOOgorCQlyZXR1cm4gY29uZmlnLT50dl9ib3R0b21fbWFyZ2lu
X3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX01PREU6CisJCXJldHVybiBjb25maWct
PnR2X21vZGVfcHJvcGVydHk7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJ
cmV0dXJuIGNvbmZpZy0+dHZfYnJpZ2h0bmVzc19wcm9wZXJ0eTsKKwljYXNlIEdVRF9QUk9QRVJU
WV9UVl9DT05UUkFTVDoKKwkJcmV0dXJuIGNvbmZpZy0+dHZfY29udHJhc3RfcHJvcGVydHk7CisJ
Y2FzZSBHVURfUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJT046CisJCXJldHVybiBjb25maWct
PnR2X2ZsaWNrZXJfcmVkdWN0aW9uX3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX09W
RVJTQ0FOOgorCQlyZXR1cm4gY29uZmlnLT50dl9vdmVyc2Nhbl9wcm9wZXJ0eTsKKwljYXNlIEdV
RF9QUk9QRVJUWV9UVl9TQVRVUkFUSU9OOgorCQlyZXR1cm4gY29uZmlnLT50dl9zYXR1cmF0aW9u
X3Byb3BlcnR5OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX0hVRToKKwkJcmV0dXJuIGNvbmZpZy0+
dHZfaHVlX3Byb3BlcnR5OworCWRlZmF1bHQ6CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwor
CX0KK30KKworc3RhdGljIHVuc2lnbmVkIGludCAqZ3VkX2Nvbm5lY3Rvcl90dl9zdGF0ZV92YWwo
dTE2IHByb3AsIHN0cnVjdCBkcm1fdHZfY29ubmVjdG9yX3N0YXRlICpzdGF0ZSkKK3sKKwlzd2l0
Y2ggKHByb3ApIHsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTjoKKwkJcmV0dXJu
ICZzdGF0ZS0+bWFyZ2lucy5sZWZ0OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX1JJR0hUX01BUkdJ
TjoKKwkJcmV0dXJuICZzdGF0ZS0+bWFyZ2lucy5yaWdodDsKKwljYXNlIEdVRF9QUk9QRVJUWV9U
Vl9UT1BfTUFSR0lOOgorCQlyZXR1cm4gJnN0YXRlLT5tYXJnaW5zLnRvcDsKKwljYXNlIEdVRF9Q
Uk9QRVJUWV9UVl9CT1RUT01fTUFSR0lOOgorCQlyZXR1cm4gJnN0YXRlLT5tYXJnaW5zLmJvdHRv
bTsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9NT0RFOgorCQlyZXR1cm4gJnN0YXRlLT5tb2RlOwor
CWNhc2UgR1VEX1BST1BFUlRZX1RWX0JSSUdIVE5FU1M6CisJCXJldHVybiAmc3RhdGUtPmJyaWdo
dG5lc3M7CisJY2FzZSBHVURfUFJPUEVSVFlfVFZfQ09OVFJBU1Q6CisJCXJldHVybiAmc3RhdGUt
PmNvbnRyYXN0OworCWNhc2UgR1VEX1BST1BFUlRZX1RWX0ZMSUNLRVJfUkVEVUNUSU9OOgorCQly
ZXR1cm4gJnN0YXRlLT5mbGlja2VyX3JlZHVjdGlvbjsKKwljYXNlIEdVRF9QUk9QRVJUWV9UVl9P
VkVSU0NBTjoKKwkJcmV0dXJuICZzdGF0ZS0+b3ZlcnNjYW47CisJY2FzZSBHVURfUFJPUEVSVFlf
VFZfU0FUVVJBVElPTjoKKwkJcmV0dXJuICZzdGF0ZS0+c2F0dXJhdGlvbjsKKwljYXNlIEdVRF9Q
Uk9QRVJUWV9UVl9IVUU6CisJCXJldHVybiAmc3RhdGUtPmh1ZTsKKwlkZWZhdWx0OgorCQlyZXR1
cm4gRVJSX1BUUigtRUlOVkFMKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgZ3VkX2Nvbm5lY3Rvcl9h
ZGRfcHJvcGVydGllcyhzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgc3RydWN0IGd1ZF9jb25uZWN0
b3IgKmdjb25uLAorCQkJCQl1bnNpZ25lZCBpbnQgbnVtX3Byb3BlcnRpZXMpCit7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRybSA9ICZnZHJtLT5kcm07CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvciA9ICZnY29ubi0+Y29ubmVjdG9yOworCXN0cnVjdCBndWRfcHJvcGVydHlfcmVxICpw
cm9wZXJ0aWVzOworCXVuc2lnbmVkIGludCBpOworCWludCByZXQ7CisKKwlnY29ubi0+cHJvcGVy
dGllcyA9IGtjYWxsb2MobnVtX3Byb3BlcnRpZXMsIHNpemVvZigqZ2Nvbm4tPnByb3BlcnRpZXMp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWdjb25uLT5wcm9wZXJ0aWVzKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCXByb3BlcnRpZXMgPSBrY2FsbG9jKG51bV9wcm9wZXJ0aWVzLCBzaXplb2YoKnByb3Bl
cnRpZXMpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXByb3BlcnRpZXMpCisJCXJldHVybiAtRU5PTUVN
OworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX1BST1BF
UlRJRVMsIGNvbm5lY3Rvci0+aW5kZXgsCisJCQkgIHByb3BlcnRpZXMsIG51bV9wcm9wZXJ0aWVz
ICogc2l6ZW9mKCpwcm9wZXJ0aWVzKSk7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgbnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJvcCA9IGxlMTZfdG9f
Y3B1KHByb3BlcnRpZXNbaV0ucHJvcCk7CisJCXU2NCB2YWwgPSBsZTY0X3RvX2NwdShwcm9wZXJ0
aWVzW2ldLnZhbCk7CisJCXN0cnVjdCBkcm1fcHJvcGVydHkgKnByb3BlcnR5OworCQl1bnNpZ25l
ZCBpbnQgKnN0YXRlX3ZhbDsKKworCQlkcm1fZGJnKGRybSwgInByb3BlcnR5OiAldSA9ICVsbHUo
MHglbGx4KVxuIiwgcHJvcCwgdmFsLCB2YWwpOworCisJCXN3aXRjaCAocHJvcCkgeworCQljYXNl
IEdVRF9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTjoKKwkJCWZhbGx0aHJvdWdoOworCQljYXNlIEdV
RF9QUk9QRVJUWV9UVl9SSUdIVF9NQVJHSU46CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBHVURf
UFJPUEVSVFlfVFZfVE9QX01BUkdJTjoKKwkJCWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9QUk9Q
RVJUWV9UVl9CT1RUT01fTUFSR0lOOgorCQkJcmV0ID0gZHJtX21vZGVfY3JlYXRlX3R2X21hcmdp
bl9wcm9wZXJ0aWVzKGRybSk7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gb3V0OworCQkJYnJlYWs7
CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX01PREU6CisJCQlyZXQgPSBndWRfY29ubmVjdG9yX2Fk
ZF90dl9tb2RlKGdkcm0sIGNvbm5lY3RvciwgdmFsKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBv
dXQ7CisJCQl2YWwgPSB2YWwgJiAoQklUKEdVRF9DT05ORUNUT1JfVFZfTU9ERV9OVU1fU0hJRlQp
IC0gMSk7CisJCQlicmVhazsKKwkJY2FzZSBHVURfUFJPUEVSVFlfVFZfQlJJR0hUTkVTUzoKKwkJ
CWZhbGx0aHJvdWdoOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9DT05UUkFTVDoKKwkJCWZhbGx0
aHJvdWdoOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9GTElDS0VSX1JFRFVDVElPTjoKKwkJCWZh
bGx0aHJvdWdoOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9PVkVSU0NBTjoKKwkJCWZhbGx0aHJv
dWdoOworCQljYXNlIEdVRF9QUk9QRVJUWV9UVl9TQVRVUkFUSU9OOgorCQkJZmFsbHRocm91Z2g7
CisJCWNhc2UgR1VEX1BST1BFUlRZX1RWX0hVRToKKwkJCS8qIFRoaXMgaXMgYSBuby1vcCBpZiBh
bHJlYWR5IGFkZGVkLiAqLworCQkJcmV0ID0gZHJtX21vZGVfY3JlYXRlX3R2X3Byb3BlcnRpZXMo
ZHJtLCAwLCBOVUxMKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisJCQlicmVhazsKKwkJ
Y2FzZSBHVURfUFJPUEVSVFlfQkFDS0xJR0hUX0JSSUdIVE5FU1M6CisJCQlpZiAodmFsID4gMTAw
KSB7CisJCQkJcmV0ID0gLUVJTlZBTDsKKwkJCQlnb3RvIG91dDsKKwkJCX0KKwkJCWdjb25uLT5p
bml0aWFsX2JyaWdodG5lc3MgPSB2YWw7CisJCQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCS8qIE5l
dyBvbmVzIG1pZ2h0IHNob3cgdXAgaW4gZnV0dXJlIGRldmljZXMsIHNraXAgdGhvc2Ugd2UgZG9u
J3Qga25vdy4gKi8KKwkJCWRybV9kYmcoZHJtLCAiVW5rbm93biBwcm9wZXJ0eTogJXVcbiIsIHBy
b3ApOworCQkJY29udGludWU7CisJCX0KKworCQlnY29ubi0+cHJvcGVydGllc1tnY29ubi0+bnVt
X3Byb3BlcnRpZXMrK10gPSBwcm9wOworCisJCWlmIChwcm9wID09IEdVRF9QUk9QRVJUWV9CQUNL
TElHSFRfQlJJR0hUTkVTUykKKwkJCWNvbnRpbnVlOyAvKiBub3QgYSBEUk0gcHJvcGVydHkgKi8K
KworCQlwcm9wZXJ0eSA9IGd1ZF9jb25uZWN0b3JfcHJvcGVydHlfbG9va3VwKGNvbm5lY3Rvciwg
cHJvcCk7CisJCWlmIChXQVJOX09OKElTX0VSUihwcm9wZXJ0eSkpKQorCQkJY29udGludWU7CisK
KwkJc3RhdGVfdmFsID0gZ3VkX2Nvbm5lY3Rvcl90dl9zdGF0ZV92YWwocHJvcCwgJmdjb25uLT5p
bml0aWFsX3R2X3N0YXRlKTsKKwkJaWYgKFdBUk5fT04oSVNfRVJSKHN0YXRlX3ZhbCkpKQorCQkJ
Y29udGludWU7CisKKwkJKnN0YXRlX3ZhbCA9IHZhbDsKKwkJZHJtX29iamVjdF9hdHRhY2hfcHJv
cGVydHkoJmNvbm5lY3Rvci0+YmFzZSwgcHJvcGVydHksIDApOworCX0KK291dDoKKwlrZnJlZShw
cm9wZXJ0aWVzKTsKKworCXJldHVybiByZXQ7Cit9CisKK2ludCBndWRfY29ubmVjdG9yX2ZpbGxf
cHJvcGVydGllcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJCSAgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZSwKKwkJCQkgIHN0cnVjdCBndWRf
cHJvcGVydHlfcmVxICpwcm9wZXJ0aWVzKQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yICpnY29u
bjsKKwl1bnNpZ25lZCBpbnQgaTsKKworCWdjb25uID0gdG9fZ3VkX2Nvbm5lY3Rvcihjb25uZWN0
b3IpOworCisJLyogT25seSBpbnRlcmVzdGVkIGluIHRoZSBjb3VudD8gKi8KKwlpZiAoIWNvbm5l
Y3Rvcl9zdGF0ZSkKKwkJcmV0dXJuIGdjb25uLT5udW1fcHJvcGVydGllczsKKworCWZvciAoaSA9
IDA7IGkgPCBnY29ubi0+bnVtX3Byb3BlcnRpZXM7IGkrKykgeworCQl1MTYgcHJvcCA9IGdjb25u
LT5wcm9wZXJ0aWVzW2ldOworCQl1NjQgdmFsOworCisJCWlmIChwcm9wID09IEdVRF9QUk9QRVJU
WV9CQUNLTElHSFRfQlJJR0hUTkVTUykgeworCQkJdmFsID0gY29ubmVjdG9yX3N0YXRlLT50di5i
cmlnaHRuZXNzOworCQl9IGVsc2UgeworCQkJdW5zaWduZWQgaW50ICpzdGF0ZV92YWw7CisKKwkJ
CXN0YXRlX3ZhbCA9IGd1ZF9jb25uZWN0b3JfdHZfc3RhdGVfdmFsKHByb3AsICZjb25uZWN0b3Jf
c3RhdGUtPnR2KTsKKwkJCWlmIChXQVJOX09OX09OQ0UoSVNfRVJSKHN0YXRlX3ZhbCkpKQorCQkJ
CXJldHVybiBQVFJfRVJSKHN0YXRlX3ZhbCk7CisKKwkJCXZhbCA9ICpzdGF0ZV92YWw7CisJCX0K
KworCQlwcm9wZXJ0aWVzW2ldLnByb3AgPSBjcHVfdG9fbGUxNihwcm9wKTsKKwkJcHJvcGVydGll
c1tpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOworCX0KKworCXJldHVybiBnY29ubi0+bnVtX3By
b3BlcnRpZXM7Cit9CisKK2ludCBndWRfY29ubmVjdG9yX2NyZWF0ZShzdHJ1Y3QgZ3VkX2Rldmlj
ZSAqZ2RybSwgdW5zaWduZWQgaW50IGluZGV4KQoreworCXN0cnVjdCBndWRfY29ubmVjdG9yX2Rl
c2NyaXB0b3JfcmVxIGRlc2M7CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9ICZnZHJtLT5kcm07
CisJc3RydWN0IGd1ZF9jb25uZWN0b3IgKmdjb25uOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3I7CisJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCWludCByZXQsIGNvbm5l
Y3Rvcl90eXBlOworCXUzMiBmbGFnczsKKworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9S
RVFfR0VUX0NPTk5FQ1RPUiwgaW5kZXgsICZkZXNjLCBzaXplb2YoZGVzYykpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwlnY29ubiA9IGt6YWxsb2Moc2l6ZW9mKCpnY29ubiksIEdGUF9L
RVJORUwpOworCWlmICghZ2Nvbm4pCisJCXJldHVybiAtRU5PTUVNOworCisJSU5JVF9XT1JLKCZn
Y29ubi0+YmFja2xpZ2h0X3dvcmssIGd1ZF9jb25uZWN0b3JfYmFja2xpZ2h0X3VwZGF0ZV9zdGF0
dXNfd29yayk7CisJZ2Nvbm4tPmluaXRpYWxfYnJpZ2h0bmVzcyA9IC1FTk9ERVY7CisJZmxhZ3Mg
PSBsZTMyX3RvX2NwdShkZXNjLmZsYWdzKTsKKwljb25uZWN0b3IgPSAmZ2Nvbm4tPmNvbm5lY3Rv
cjsKKworCWRybV9kYmcoZHJtLCAiQ29ubmVjdG9yOiBpbmRleD0ldSB0eXBlPSV1IGZsYWdzPTB4
JXggbnVtX3Byb3BlcnRpZXM9JXVcbiIsCisJCWluZGV4LCBkZXNjLmNvbm5lY3Rvcl90eXBlLCBm
bGFncywgZGVzYy5udW1fcHJvcGVydGllcyk7CisKKwlzd2l0Y2ggKGRlc2MuY29ubmVjdG9yX3R5
cGUpIHsKKwljYXNlIEdVRF9DT05ORUNUT1JfVFlQRV9QQU5FTDoKKwkJY29ubmVjdG9yX3R5cGUg
PSBEUk1fTU9ERV9DT05ORUNUT1JfVVNCOworCQlicmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1Jf
VFlQRV9WR0E6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX1ZHQTsKKwkJ
YnJlYWs7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVfRFZJOgorCQljb25uZWN0b3JfdHlwZSA9
IERSTV9NT0RFX0NPTk5FQ1RPUl9EVklEOworCQlicmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1Jf
VFlQRV9DT01QT1NJVEU6CisJCWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0Nv
bXBvc2l0ZTsKKwkJYnJlYWs7CisJY2FzZSBHVURfQ09OTkVDVE9SX1RZUEVfU1ZJREVPOgorCQlj
b25uZWN0b3JfdHlwZSA9IERSTV9NT0RFX0NPTk5FQ1RPUl9TVklERU87CisJCWJyZWFrOworCWNh
c2UgR1VEX0NPTk5FQ1RPUl9UWVBFX0NPTVBPTkVOVDoKKwkJY29ubmVjdG9yX3R5cGUgPSBEUk1f
TU9ERV9DT05ORUNUT1JfQ29tcG9uZW50OworCQlicmVhazsKKwljYXNlIEdVRF9DT05ORUNUT1Jf
VFlQRV9ESVNQTEFZUE9SVDoKKwkJY29ubmVjdG9yX3R5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1Jf
RGlzcGxheVBvcnQ7CisJCWJyZWFrOworCWNhc2UgR1VEX0NPTk5FQ1RPUl9UWVBFX0hETUk6CisJ
CWNvbm5lY3Rvcl90eXBlID0gRFJNX01PREVfQ09OTkVDVE9SX0hETUlBOworCQlicmVhazsKKwlk
ZWZhdWx0OiAvKiBmdXR1cmUgdHlwZXMgKi8KKwkJY29ubmVjdG9yX3R5cGUgPSBEUk1fTU9ERV9D
T05ORUNUT1JfVVNCOworCQlicmVhazsKKwl9OworCisJZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRk
KGNvbm5lY3RvciwgJmd1ZF9jb25uZWN0b3JfaGVscGVyX2Z1bmNzKTsKKwlyZXQgPSBkcm1fY29u
bmVjdG9yX2luaXQoZHJtLCBjb25uZWN0b3IsICZndWRfY29ubmVjdG9yX2Z1bmNzLCBjb25uZWN0
b3JfdHlwZSk7CisJaWYgKHJldCkgeworCQlrZnJlZShjb25uZWN0b3IpOworCQlyZXR1cm4gcmV0
OworCX0KKworCWlmIChXQVJOX09OKGNvbm5lY3Rvci0+aW5kZXggIT0gaW5kZXgpKQorCQlyZXR1
cm4gLUVJTlZBTDsKKworCWlmIChmbGFncyAmIEdVRF9DT05ORUNUT1JfRkxBR1NfUE9MTF9TVEFU
VVMpCisJCWNvbm5lY3Rvci0+cG9sbGVkID0gKERSTV9DT05ORUNUT1JfUE9MTF9DT05ORUNUIHwg
RFJNX0NPTk5FQ1RPUl9QT0xMX0RJU0NPTk5FQ1QpOworCWlmIChmbGFncyAmIEdVRF9DT05ORUNU
T1JfRkxBR1NfSU5URVJMQUNFKQorCQljb25uZWN0b3ItPmludGVybGFjZV9hbGxvd2VkID0gdHJ1
ZTsKKwlpZiAoZmxhZ3MgJiBHVURfQ09OTkVDVE9SX0ZMQUdTX0RPVUJMRVNDQU4pCisJCWNvbm5l
Y3Rvci0+ZG91Ymxlc2Nhbl9hbGxvd2VkID0gdHJ1ZTsKKworCWlmIChkZXNjLm51bV9wcm9wZXJ0
aWVzKSB7CisJCXJldCA9IGd1ZF9jb25uZWN0b3JfYWRkX3Byb3BlcnRpZXMoZ2RybSwgZ2Nvbm4s
IGRlc2MubnVtX3Byb3BlcnRpZXMpOworCQlpZiAocmV0KSB7CisJCQlkZXZfZXJyKGRybS0+ZGV2
LCAiRmFpbGVkIHRvIGFkZCBjb25uZWN0b3IvJXUgcHJvcGVydGllc1xuIiwgaW5kZXgpOworCQkJ
cmV0dXJuIHJldDsKKwkJfQorCX0KKworCS8qIFRoZSBmaXJzdCBjb25uZWN0b3IgaXMgYXR0YWNo
ZWQgdG8gdGhlIGV4aXN0aW5nIHNpbXBsZSBwaXBlIGVuY29kZXIgKi8KKwlpZiAoIWNvbm5lY3Rv
ci0+aW5kZXgpIHsKKwkJZW5jb2RlciA9ICZnZHJtLT5waXBlLmVuY29kZXI7CisJfSBlbHNlIHsK
KwkJZW5jb2RlciA9ICZnY29ubi0+ZW5jb2RlcjsKKworCQlyZXQgPSBkcm1fc2ltcGxlX2VuY29k
ZXJfaW5pdChkcm0sIGVuY29kZXIsIERSTV9NT0RFX0VOQ09ERVJfTk9ORSk7CisJCWlmIChyZXQp
CisJCQlyZXR1cm4gcmV0OworCisJCWVuY29kZXItPnBvc3NpYmxlX2NydGNzID0gMTsKKwl9CisK
KwlyZXR1cm4gZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIp
OworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2d1ZC9ndWRfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vZ3VkL2d1ZF9kcnYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwMDAuLjQ0NzdlMzFlMzdiNwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9n
dWQvZ3VkX2Rydi5jCkBAIC0wLDAgKzEsNjI1IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmll
cjogTUlUCisvKgorICogQ29weXJpZ2h0IDIwMjAgTm9yYWxmIFRyw7hubmVzCisgKi8KKworI2lu
Y2x1ZGUgPGxpbnV4L2RtYS1idWYuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtbWFwcGluZy5oPgor
I2luY2x1ZGUgPGxpbnV4L2x6NC5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1
ZGUgPGxpbnV4L3BsYXRmb3JtX2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3N0cmluZ19oZWxw
ZXJzLmg+CisjaW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGludXgvdm1hbGxvYy5o
PgorI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9t
aWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVyLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9kZWJ1Z2ZzLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kcnYuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2ZiX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9nZW1fc2htZW1faGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1f
ZnJhbWVidWZmZXJfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9tYW5hZ2VkLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcHJvYmVfaGVscGVyLmg+
CisjaW5jbHVkZSA8ZHJtL2RybV9zaW1wbGVfa21zX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9n
dWQuaD4KKworI2luY2x1ZGUgImd1ZF9pbnRlcm5hbC5oIgorCisvKiBPbmx5IHVzZWQgaW50ZXJu
YWxseSAqLworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gZ3VkX2RybV9mb3Jt
YXRfcjEgPSB7CisJLmZvcm1hdCA9IEdVRF9EUk1fRk9STUFUX1IxLAorCS5udW1fcGxhbmVzID0g
MSwKKwkuY2hhcl9wZXJfYmxvY2sgPSB7IDEsIDAsIDAgfSwKKwkuYmxvY2tfdyA9IHsgOCwgMCwg
MCB9LAorCS5ibG9ja19oID0geyAxLCAwLCAwIH0sCisJLmhzdWIgPSAxLAorCS52c3ViID0gMSwK
K307CisKK3N0YXRpYyBpbnQgZ3VkX3VzYl9jb250cm9sX21zZyhzdHJ1Y3QgdXNiX2RldmljZSAq
dXNiLCB1OCBpZm51bSwgYm9vbCBpbiwKKwkJCSAgICAgICB1OCByZXF1ZXN0LCB1MTYgdmFsdWUs
IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwl1OCByZXF1ZXN0dHlwZSA9IFVTQl9UWVBFX1ZF
TkRPUiB8IFVTQl9SRUNJUF9JTlRFUkZBQ0U7CisJdW5zaWduZWQgaW50IHBpcGU7CisJaW50IHJl
dDsKKworCWlmIChpbikgeworCQlwaXBlID0gdXNiX3JjdmN0cmxwaXBlKHVzYiwgMCk7CisJCXJl
cXVlc3R0eXBlIHw9IFVTQl9ESVJfSU47CisJfSBlbHNlIHsKKwkJcGlwZSA9IHVzYl9zbmRjdHJs
cGlwZSh1c2IsIDApOworCQlyZXF1ZXN0dHlwZSB8PSBVU0JfRElSX09VVDsKKwl9CisKKwlyZXQg
PSB1c2JfY29udHJvbF9tc2codXNiLCBwaXBlLCByZXF1ZXN0LCByZXF1ZXN0dHlwZSwgdmFsdWUs
CisJCQkgICAgICBpZm51bSwgYnVmLCBsZW4sIFVTQl9DVFJMX0dFVF9USU1FT1VUKTsKKwlpZiAo
cmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKwlpZiAocmV0ICE9IGxlbikKKwkJcmV0dXJuIC1FSU87
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBndWRfZ2V0X2Rpc3BsYXlfZGVzY3JpcHRv
cihzdHJ1Y3QgdXNiX2ludGVyZmFjZSAqaW50ZXJmYWNlLAorCQkJCSAgICAgIHN0cnVjdCBndWRf
ZGlzcGxheV9kZXNjcmlwdG9yX3JlcSAqZGVzYykKK3sKKwl1OCBpZm51bSA9IGludGVyZmFjZS0+
Y3VyX2FsdHNldHRpbmctPmRlc2MuYkludGVyZmFjZU51bWJlcjsKKwlzdHJ1Y3QgdXNiX2Rldmlj
ZSAqdXNiID0gaW50ZXJmYWNlX3RvX3VzYmRldihpbnRlcmZhY2UpOworCXZvaWQgKmJ1ZjsKKwlp
bnQgcmV0OworCisJYnVmID0ga21hbGxvYyhzaXplb2YoKmRlc2MpLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIWJ1ZikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2NvbnRyb2xfbXNn
KHVzYiwgaWZudW0sIHRydWUsIEdVRF9SRVFfR0VUX0RFU0NSSVBUT1IsIDAsIGJ1Ziwgc2l6ZW9m
KCpkZXNjKSk7CisJbWVtY3B5KGRlc2MsIGJ1Ziwgc2l6ZW9mKCpkZXNjKSk7CisJa2ZyZWUoYnVm
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYgKGRlc2MtPm1hZ2ljICE9IEdVRF9E
SVNQTEFZX01BR0lDKQorCQlyZXR1cm4gLUVOT0RBVEE7CisKKwlEUk1fREVWX0RFQlVHX0RSSVZF
UigmaW50ZXJmYWNlLT5kZXYsCisJCQkgICAgICJ2ZXJzaW9uPSV1IGZsYWdzPTB4JXggY29tcHJl
c3Npb249MHgleCBudW1fZm9ybWF0cz0ldSBudW1fY29ubmVjdG9ycz0ldSBtYXhfYnVmZmVyX3Np
emU9JXVcbiIsCisJCQkgICAgIGRlc2MtPnZlcnNpb24sIGxlMzJfdG9fY3B1KGRlc2MtPmZsYWdz
KSwgZGVzYy0+Y29tcHJlc3Npb24sCisJCQkgICAgIGRlc2MtPm51bV9mb3JtYXRzLCBkZXNjLT5u
dW1fY29ubmVjdG9ycywKKwkJCSAgICAgbGUzMl90b19jcHUoZGVzYy0+bWF4X2J1ZmZlcl9zaXpl
KSk7CisKKwlpZiAoIWRlc2MtPnZlcnNpb24gfHwgIWRlc2MtPm51bV9mb3JtYXRzIHx8ICFkZXNj
LT5udW1fY29ubmVjdG9ycyB8fAorCSAgICAhZGVzYy0+bWF4X3dpZHRoIHx8ICFkZXNjLT5tYXhf
aGVpZ2h0IHx8CisJICAgIGxlMzJfdG9fY3B1KGRlc2MtPm1pbl93aWR0aCkgPiBsZTMyX3RvX2Nw
dShkZXNjLT5tYXhfd2lkdGgpIHx8CisJICAgIGxlMzJfdG9fY3B1KGRlc2MtPm1pbl9oZWlnaHQp
ID4gbGUzMl90b19jcHUoZGVzYy0+bWF4X2hlaWdodCkpCisJCXJldHVybiAtRUlOVkFMOworCisJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3VzYl9nZXRfc3RhdHVzKHN0cnVjdCB1c2Jf
ZGV2aWNlICp1c2IsIHU4IGlmbnVtLCB1OCAqc3RhdHVzKQoreworCXU4ICpidWY7CisJaW50IHJl
dDsKKworCWJ1ZiA9IGttYWxsb2Moc2l6ZW9mKCpidWYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJ1
ZikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQgPSBndWRfdXNiX2NvbnRyb2xfbXNnKHVzYiwg
aWZudW0sIHRydWUsIEdVRF9SRVFfR0VUX1NUQVRVUywgMCwgYnVmLCBzaXplb2YoKmJ1ZikpOwor
CSpzdGF0dXMgPSAqYnVmOworCWtmcmVlKGJ1Zik7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0
aWMgaW50IGd1ZF9zdGF0dXNfdG9fZXJybm8odTggc3RhdHVzKQoreworCXN3aXRjaCAoc3RhdHVz
KSB7CisJY2FzZSBHVURfU1RBVFVTX09LOgorCQlyZXR1cm4gMDsKKwljYXNlIEdVRF9TVEFUVVNf
QlVTWToKKwkJcmV0dXJuIC1FQlVTWTsKKwljYXNlIEdVRF9TVEFUVVNfUkVRVUVTVF9OT1RfU1VQ
UE9SVEVEOgorCQlyZXR1cm4gLUVPUE5PVFNVUFA7CisJY2FzZSBHVURfU1RBVFVTX1BST1RPQ09M
X0VSUk9SOgorCQlyZXR1cm4gLUVQUk9UTzsKKwljYXNlIEdVRF9TVEFUVVNfSU5WQUxJRF9QQVJB
TUVURVI6CisJCXJldHVybiAtRUlOVkFMOworCWNhc2UgR1VEX1NUQVRVU19FUlJPUjoKKwkJcmV0
dXJuIC1FUkVNT1RFSU87CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FUkVNT1RFSU87CisJfQorfQor
CitzdGF0aWMgaW50IGd1ZF91c2JfdHJhbnNmZXIoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIGJv
b2wgaW4sIHU4IHJlcXVlc3QsIHUxNiBpbmRleCwKKwkJCSAgICB2b2lkICpidWYsIHNpemVfdCBs
ZW4pCit7CisJc3RydWN0IHVzYl9kZXZpY2UgKnVzYiA9IGd1ZF90b191c2JfZGV2aWNlKGdkcm0p
OworCXZvaWQgKnRyYnVmID0gTlVMTDsKKwlpbnQgaWR4LCByZXQ7CisKKwlkcm1fZGJnKCZnZHJt
LT5kcm0sICIlczogcmVxdWVzdD0weCV4IGluZGV4PSV1IGxlbj0lenVcbiIsCisJCWluID8gImdl
dCIgOiAic2V0IiwgcmVxdWVzdCwgaW5kZXgsIGxlbik7CisKKwlpZiAoIWRybV9kZXZfZW50ZXIo
Jmdkcm0tPmRybSwgJmlkeCkpCisJCXJldHVybiAtRU5PREVWOworCisJbXV0ZXhfbG9jaygmZ2Ry
bS0+Y3RybF9sb2NrKTsKKworCWlmIChidWYpIHsKKwkJaWYgKGluKQorCQkJdHJidWYgPSBrbWFs
bG9jKGxlbiwgR0ZQX0tFUk5FTCk7CisJCWVsc2UKKwkJCXRyYnVmID0ga21lbWR1cChidWYsIGxl
biwgR0ZQX0tFUk5FTCk7CisJCWlmICghdHJidWYpIHsKKwkJCXJldCA9IC1FTk9NRU07CisJCQln
b3RvIHVubG9jazsKKwkJfQorCX0KKworCXJldCA9IGd1ZF91c2JfY29udHJvbF9tc2codXNiLCBn
ZHJtLT5pZm51bSwgaW4sIHJlcXVlc3QsIGluZGV4LCB0cmJ1ZiwgbGVuKTsKKwlpZiAocmV0ID09
IC1FUElQRSB8fCAoIXJldCAmJiAhaW4gJiYgKGdkcm0tPmZsYWdzICYgR1VEX0RJU1BMQVlfRkxB
R19TVEFUVVNfT05fU0VUKSkpIHsKKwkJYm9vbCBlcnJvciA9IHJldDsKKwkJdTggc3RhdHVzOwor
CisJCXJldCA9IGd1ZF91c2JfZ2V0X3N0YXR1cyh1c2IsIGdkcm0tPmlmbnVtLCAmc3RhdHVzKTsK
KwkJaWYgKCFyZXQpIHsKKwkJCWlmIChlcnJvciAmJiBzdGF0dXMgPT0gR1VEX1NUQVRVU19PSykg
eworCQkJCWRldl9lcnJfb25jZShnZHJtLT5kcm0uZGV2LAorCQkJCQkgICAgICJVbmV4cGVjdGVk
IHN0YXR1cyBPSyBmb3IgZmFpbGVkIHRyYW5zZmVyXG4iKTsKKwkJCQlyZXQgPSAtRVBJUEU7CisJ
CQl9IGVsc2UgeworCQkJCXJldCA9IGd1ZF9zdGF0dXNfdG9fZXJybm8oc3RhdHVzKTsKKwkJCX0K
KwkJfQorCX0KKworCWlmICghcmV0ICYmIGluICYmIGJ1ZikKKwkJbWVtY3B5KGJ1ZiwgdHJidWYs
IGxlbik7CisKKwlpZiAocmV0KSB7CisJCWRybV9kYmcoJmdkcm0tPmRybSwgInJldD0lZFxuIiwg
cmV0KTsKKwkJZ2RybS0+c3RhdHNfbnVtX2Vycm9ycysrOworCX0KKworCWtmcmVlKHRyYnVmKTsK
K3VubG9jazoKKwltdXRleF91bmxvY2soJmdkcm0tPmN0cmxfbG9jayk7CisJZHJtX2Rldl9leGl0
KGlkeCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgZ3VkX3VzYl9nZXQoc3RydWN0IGd1ZF9k
ZXZpY2UgKmdkcm0sIHU4IHJlcXVlc3QsIHUxNiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVu
KQoreworCXJldHVybiBndWRfdXNiX3RyYW5zZmVyKGdkcm0sIHRydWUsIHJlcXVlc3QsIGluZGV4
LCBidWYsIGxlbik7Cit9CisKK2ludCBndWRfdXNiX3NldChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2Ry
bSwgdTggcmVxdWVzdCwgdTE2IGluZGV4LCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJcmV0
dXJuIGd1ZF91c2JfdHJhbnNmZXIoZ2RybSwgZmFsc2UsIHJlcXVlc3QsIGluZGV4LCBidWYsIGxl
bik7Cit9CisKK2ludCBndWRfdXNiX3dyaXRlOChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTgg
cmVxdWVzdCwgdTggdmFsKQoreworCXJldHVybiBndWRfdXNiX3NldChnZHJtLCByZXF1ZXN0LCAw
LCAmdmFsLCBzaXplb2YodmFsKSk7Cit9CisKK3N0YXRpYyBpbnQgZ3VkX3NldF92ZXJzaW9uKHN0
cnVjdCB1c2JfZGV2aWNlICp1c2IsIHU4IGlmbnVtLCB1MzIgZmxhZ3MsIHU4IHZlcnNpb24pCit7
CisJdTggKmJ1ZjsKKwlpbnQgcmV0OworCisJYnVmID0ga21hbGxvYyhzaXplb2YoKmJ1ZiksIEdG
UF9LRVJORUwpOworCWlmICghYnVmKQorCQlyZXR1cm4gLUVOT01FTTsKKworCSpidWYgPSB2ZXJz
aW9uOworCXJldCA9IGd1ZF91c2JfY29udHJvbF9tc2codXNiLCBpZm51bSwgZmFsc2UsIEdVRF9S
RVFfU0VUX1ZFUlNJT04sIDAsIGJ1Ziwgc2l6ZW9mKCpidWYpKTsKKwlrZnJlZShidWYpOworCWlm
IChyZXQgPT0gLUVQSVBFKQorCQlyZXR1cm4gLUVQUk9UT05PU1VQUE9SVDsKKwlpZiAocmV0KQor
CQlyZXR1cm4gcmV0OworCisJaWYgKGZsYWdzICYgR1VEX0RJU1BMQVlfRkxBR19TVEFUVVNfT05f
U0VUKSB7CisJCXU4IHN0YXR1czsKKworCQlyZXQgPSBndWRfdXNiX2dldF9zdGF0dXModXNiLCBp
Zm51bSwgJnN0YXR1cyk7CisJCWlmICghcmV0ICYmIHN0YXR1cyAhPSBHVURfU1RBVFVTX09LKQor
CQkJcmV0ID0gLUVQUk9UT05PU1VQUE9SVDsKKwl9CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0
aWMgaW50IGd1ZF9nZXRfcHJvcGVydGllcyhzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdW5zaWdu
ZWQgaW50IG51bV9wcm9wZXJ0aWVzKQoreworCXN0cnVjdCBndWRfcHJvcGVydHlfcmVxICpwcm9w
ZXJ0aWVzOworCXVuc2lnbmVkIGludCBpOworCWludCByZXQ7CisKKwlpZiAoIW51bV9wcm9wZXJ0
aWVzKQorCQlyZXR1cm4gMDsKKworCWdkcm0tPnByb3BlcnRpZXMgPSBkcm1tX2tjYWxsb2MoJmdk
cm0tPmRybSwgbnVtX3Byb3BlcnRpZXMsIHNpemVvZigqZ2RybS0+cHJvcGVydGllcyksCisJCQkJ
CUdGUF9LRVJORUwpOworCWlmICghZ2RybS0+cHJvcGVydGllcykKKwkJcmV0dXJuIC1FTk9NRU07
CisKKwlwcm9wZXJ0aWVzID0ga2NhbGxvYyhudW1fcHJvcGVydGllcywgc2l6ZW9mKCpwcm9wZXJ0
aWVzKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcm9wZXJ0aWVzKQorCQlyZXR1cm4gLUVOT01FTTsK
KworCXJldCA9IGd1ZF91c2JfZ2V0KGdkcm0sIEdVRF9SRVFfR0VUX1BST1BFUlRJRVMsIDAsCisJ
CQkgIHByb3BlcnRpZXMsIG51bV9wcm9wZXJ0aWVzICogc2l6ZW9mKCpwcm9wZXJ0aWVzKSk7CisJ
aWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlmb3IgKGkgPSAwOyBpIDwgbnVtX3Byb3BlcnRpZXM7
IGkrKykgeworCQl1MTYgcHJvcCA9IGxlMTZfdG9fY3B1KHByb3BlcnRpZXNbaV0ucHJvcCk7CisJ
CXU2NCB2YWwgPSBsZTY0X3RvX2NwdShwcm9wZXJ0aWVzW2ldLnZhbCk7CisKKwkJc3dpdGNoIChw
cm9wKSB7CisJCWNhc2UgR1VEX1BST1BFUlRZX1JPVEFUSU9OOgorCQkJLyoKKwkJCSAqIERSTSBV
QVBJIG1hdGNoZXMgdGhlIHByb3RvY29sIHNvIHVzZSB0aGUgdmFsdWUgZGlyZWN0bHksCisJCQkg
KiBidXQgbWFzayBvdXQgYW55IGFkZGl0aW9ucyBvbiBmdXR1cmUgZGV2aWNlcy4KKwkJCSAqLwor
CQkJdmFsICY9IEdVRF9ST1RBVElPTl9NQVNLOworCQkJcmV0ID0gZHJtX3BsYW5lX2NyZWF0ZV9y
b3RhdGlvbl9wcm9wZXJ0eSgmZ2RybS0+cGlwZS5wbGFuZSwKKwkJCQkJCQkJIERSTV9NT0RFX1JP
VEFURV8wLCB2YWwpOworCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQkvKiBOZXcgb25lcyBtaWdo
dCBzaG93IHVwIGluIGZ1dHVyZSBkZXZpY2VzLCBza2lwIHRob3NlIHdlIGRvbid0IGtub3cuICov
CisJCQlkcm1fZGJnKCZnZHJtLT5kcm0sICJVbmtub3duIHByb3BlcnR5OiAldVxuIiwgcHJvcCk7
CisJCQljb250aW51ZTsKKwkJfQorCisJCWlmIChyZXQpCisJCQlnb3RvIG91dDsKKworCQlnZHJt
LT5wcm9wZXJ0aWVzW2dkcm0tPm51bV9wcm9wZXJ0aWVzKytdID0gcHJvcDsKKwl9CitvdXQ6CisJ
a2ZyZWUocHJvcGVydGllcyk7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IGd1ZF9z
dGF0c19kZWJ1Z2ZzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3Qg
ZHJtX2luZm9fbm9kZSAqbm9kZSA9IG0tPnByaXZhdGU7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdk
cm0gPSB0b19ndWRfZGV2aWNlKG5vZGUtPm1pbm9yLT5kZXYpOworCWNoYXIgYnVmWzEwXTsKKwor
CXN0cmluZ19nZXRfc2l6ZShnZHJtLT5idWxrX2xlbiwgMSwgU1RSSU5HX1VOSVRTXzIsIGJ1Ziwg
c2l6ZW9mKGJ1ZikpOworCXNlcV9wcmludGYobSwgIk1heCBidWZmZXIgc2l6ZTogJXNcbiIsIGJ1
Zik7CisJc2VxX3ByaW50ZihtLCAiTnVtYmVyIG9mIGVycm9yczogICV1XG4iLCBnZHJtLT5zdGF0
c19udW1fZXJyb3JzKTsKKworCXNlcV9wdXRzKG0sICJDb21wcmVzc2lvbjogICAgICAiKTsKKwlp
ZiAoZ2RybS0+Y29tcHJlc3Npb24gJiBHVURfQ09NUFJFU1NJT05fTFo0KQorCQlzZXFfcHV0cyht
LCAiIGx6NCIpOworCXNlcV9wdXRzKG0sICJcbiIpOworCisJaWYgKGdkcm0tPmNvbXByZXNzaW9u
KSB7CisJCXU2NCByZW1haW5kZXI7CisJCXU2NCByYXRpbyA9IGRpdjY0X3U2NF9yZW0oZ2RybS0+
c3RhdHNfbGVuZ3RoLCBnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoLAorCQkJCQkgICZyZW1haW5k
ZXIpOworCQl1NjQgcmF0aW9fZnJhYyA9IGRpdjY0X3U2NChyZW1haW5kZXIgKiAxMCwgZ2RybS0+
c3RhdHNfYWN0dWFsX2xlbmd0aCk7CisKKwkJc2VxX3ByaW50ZihtLCAiQ29tcHJlc3Npb24gcmF0
aW86ICVsbHUuJWxsdVxuIiwgcmF0aW8sIHJhdGlvX2ZyYWMpOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pbmZvX2xpc3QgZ3VkX2RlYnVnZnNfbGlzdFtd
ID0geworCXsgInN0YXRzIiwgZ3VkX3N0YXRzX2RlYnVnZnMsIDAsIE5VTEwgfSwKK307CisKK3N0
YXRpYyB2b2lkIGd1ZF9kZWJ1Z2ZzX2luaXQoc3RydWN0IGRybV9taW5vciAqbWlub3IpCit7CisJ
ZHJtX2RlYnVnZnNfY3JlYXRlX2ZpbGVzKGd1ZF9kZWJ1Z2ZzX2xpc3QsIEFSUkFZX1NJWkUoZ3Vk
X2RlYnVnZnNfbGlzdCksCisJCQkJIG1pbm9yLT5kZWJ1Z2ZzX3Jvb3QsIG1pbm9yKTsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5jcyBndWRfcGlw
ZV9mdW5jcyA9IHsKKwkuY2hlY2sgICAgICA9IGd1ZF9waXBlX2NoZWNrLAorCS51cGRhdGUJICAg
ID0gZ3VkX3BpcGVfdXBkYXRlLAorCS5wcmVwYXJlX2ZiID0gZHJtX2dlbV9mYl9zaW1wbGVfZGlz
cGxheV9waXBlX3ByZXBhcmVfZmIsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2Rl
X2NvbmZpZ19mdW5jcyBndWRfbW9kZV9jb25maWdfZnVuY3MgPSB7CisJLmZiX2NyZWF0ZSA9IGRy
bV9nZW1fZmJfY3JlYXRlX3dpdGhfZGlydHksCisJLmF0b21pY19jaGVjayA9IGRybV9hdG9taWNf
aGVscGVyX2NoZWNrLAorCS5hdG9taWNfY29tbWl0ID0gZHJtX2F0b21pY19oZWxwZXJfY29tbWl0
LAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBndWRfcGlwZV9tb2RpZmllcnNbXSA9IHsKKwlEUk1f
Rk9STUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworREVGSU5F
X0RSTV9HRU1fRk9QUyhndWRfZm9wcyk7CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2RyaXZl
ciBndWRfZHJtX2RyaXZlciA9IHsKKwkuZHJpdmVyX2ZlYXR1cmVzCT0gRFJJVkVSX01PREVTRVQg
fCBEUklWRVJfR0VNIHwgRFJJVkVSX0FUT01JQywKKwkuZm9wcwkJCT0gJmd1ZF9mb3BzLAorCURS
TV9HRU1fU0hNRU1fRFJJVkVSX09QUywKKwkuZGVidWdmc19pbml0CQk9IGd1ZF9kZWJ1Z2ZzX2lu
aXQsCisKKwkubmFtZQkJCT0gImd1ZCIsCisJLmRlc2MJCQk9ICJHZW5lcmljIFVTQiBEaXNwbGF5
IiwKKwkuZGF0ZQkJCT0gIjIwMjAwNDIyIiwKKwkubWFqb3IJCQk9IDEsCisJLm1pbm9yCQkJPSAw
LAorfTsKKworc3RhdGljIHZvaWQgZ3VkX2ZyZWVfYnVmZmVyc19hbmRfbXV0ZXgoc3RydWN0IGRy
bV9kZXZpY2UgKmRybSwgdm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJt
ID0gdG9fZ3VkX2RldmljZShkcm0pOworCisJdmZyZWUoZ2RybS0+Y29tcHJlc3NfYnVmKTsKKwlr
ZnJlZShnZHJtLT5idWxrX2J1Zik7CisJbXV0ZXhfZGVzdHJveSgmZ2RybS0+Y3RybF9sb2NrKTsK
KwltdXRleF9kZXN0cm95KCZnZHJtLT5kYW1hZ2VfbG9jayk7Cit9CisKK3N0YXRpYyBpbnQgZ3Vk
X3Byb2JlKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UsIGNvbnN0IHN0cnVjdCB1c2Jf
ZGV2aWNlX2lkICppZCkKK3sKKwl1OCBpZm51bSA9IGludGVyZmFjZS0+Y3VyX2FsdHNldHRpbmct
PmRlc2MuYkludGVyZmFjZU51bWJlcjsKKwlzdHJ1Y3QgdXNiX2RldmljZSAqdXNiID0gaW50ZXJm
YWNlX3RvX3VzYmRldihpbnRlcmZhY2UpOworCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZpbnRlcmZh
Y2UtPmRldjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICp4cmdiODg4OF9lbXVsYXRp
b25fZm9ybWF0ID0gTlVMTDsKKwlib29sIHJnYjU2NV9zdXBwb3J0ZWQgPSBmYWxzZSwgeHJnYjg4
ODhfc3VwcG9ydGVkID0gZmFsc2U7CisJc3RydWN0IHVzYl9lbmRwb2ludF9kZXNjcmlwdG9yICpi
dWxrX291dDsKKwlzdHJ1Y3QgZ3VkX2Rpc3BsYXlfZGVzY3JpcHRvcl9yZXEgZGVzYzsKKwl1bnNp
Z25lZCBpbnQgbnVtX2Zvcm1hdHMgPSAwOworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtOworCXNp
emVfdCBtYXhfYnVmZmVyX3NpemUgPSAwOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm07CisJdTgg
KmZvcm1hdHNfZGV2OworCXUzMiAqZm9ybWF0czsKKwlpbnQgcmV0LCBpOworCisJcmV0ID0gdXNi
X2ZpbmRfYnVsa19vdXRfZW5kcG9pbnQoaW50ZXJmYWNlLT5jdXJfYWx0c2V0dGluZywgJmJ1bGtf
b3V0KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gZ3VkX2dldF9kaXNwbGF5
X2Rlc2NyaXB0b3IoaW50ZXJmYWNlLCAmZGVzYyk7CisJaWYgKHJldCkgeworCQlEUk1fREVWX0RF
QlVHX0RSSVZFUihkZXYsICJOb3QgYSBkaXNwbGF5IGludGVyZmFjZTogcmV0PSVkXG4iLCByZXQp
OworCQlyZXR1cm4gLUVOT0RFVjsKKwl9CisKKwlpZiAoZGVzYy52ZXJzaW9uID4gMSkgeworCQly
ZXQgPSBndWRfc2V0X3ZlcnNpb24odXNiLCBpZm51bSwgbGUzMl90b19jcHUoZGVzYy5mbGFncyks
IDEpOworCQlpZiAocmV0KSB7CisJCQlpZiAocmV0ID09IC1FUFJPVE9OT1NVUFBPUlQpCisJCQkJ
ZGV2X2VycihkZXYsICJQcm90b2NvbCB2ZXJzaW9uICV1IGlzIG5vdCBzdXBwb3J0ZWRcbiIsCisJ
CQkJCWRlc2MudmVyc2lvbik7CisJCQlyZXR1cm4gcmV0OworCQl9CisJfQorCisJcmV0ID0gZG1h
X2NvZXJjZV9tYXNrX2FuZF9jb2hlcmVudChkZXYsIERNQV9CSVRfTUFTSyg2NCkpOworCWlmIChy
ZXQpCisJCWRldl93YXJuKGRldiwgIkZhaWxlZCB0byBzZXQgRE1BIG1hc2tcbiIpOworCisJZ2Ry
bSA9IGRldm1fZHJtX2Rldl9hbGxvYyhkZXYsICZndWRfZHJtX2RyaXZlciwgc3RydWN0IGd1ZF9k
ZXZpY2UsIGRybSk7CisJaWYgKElTX0VSUihnZHJtKSkKKwkJcmV0dXJuIFBUUl9FUlIoZ2RybSk7
CisKKwlkcm0gPSAmZ2RybS0+ZHJtOworCWRybS0+bW9kZV9jb25maWcuZnVuY3MgPSAmZ3VkX21v
ZGVfY29uZmlnX2Z1bmNzOworCXJldCA9IGRybW1fbW9kZV9jb25maWdfaW5pdChkcm0pOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKKwlnZHJtLT5pZm51bSA9IGlmbnVtOworCWdkcm0tPmZs
YWdzID0gbGUzMl90b19jcHUoZGVzYy5mbGFncyk7CisJZ2RybS0+Y29tcHJlc3Npb24gPSBkZXNj
LmNvbXByZXNzaW9uICYgR1VEX0NPTVBSRVNTSU9OX0xaNDsKKworCWlmIChnZHJtLT5mbGFncyAm
IEdVRF9ESVNQTEFZX0ZMQUdfRlVMTF9VUERBVEUgJiYgZ2RybS0+Y29tcHJlc3Npb24pCisJCXJl
dHVybiAtRUlOVkFMOworCisJbXV0ZXhfaW5pdCgmZ2RybS0+Y3RybF9sb2NrKTsKKwltdXRleF9p
bml0KCZnZHJtLT5kYW1hZ2VfbG9jayk7CisJSU5JVF9XT1JLKCZnZHJtLT53b3JrLCBndWRfZmx1
c2hfd29yayk7CisJZ3VkX2NsZWFyX2RhbWFnZShnZHJtKTsKKworCXJldCA9IGRybW1fYWRkX2Fj
dGlvbl9vcl9yZXNldChkcm0sIGd1ZF9mcmVlX2J1ZmZlcnNfYW5kX211dGV4LCBOVUxMKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJZHJtLT5tb2RlX2NvbmZpZy5taW5fd2lkdGggPSBs
ZTMyX3RvX2NwdShkZXNjLm1pbl93aWR0aCk7CisJZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lkdGgg
PSBsZTMyX3RvX2NwdShkZXNjLm1heF93aWR0aCk7CisJZHJtLT5tb2RlX2NvbmZpZy5taW5faGVp
Z2h0ID0gbGUzMl90b19jcHUoZGVzYy5taW5faGVpZ2h0KTsKKwlkcm0tPm1vZGVfY29uZmlnLm1h
eF9oZWlnaHQgPSBsZTMyX3RvX2NwdShkZXNjLm1heF9oZWlnaHQpOworCisJZm9ybWF0c19kZXYg
PSBkZXZtX2ttYWxsb2MoZGV2LCBkZXNjLm51bV9mb3JtYXRzLCBHRlBfS0VSTkVMKTsKKwkvKiBB
ZGQgcm9vbSBmb3IgZW11bGF0ZWQgWFJHQjg4ODggKi8KKwlmb3JtYXRzID0gZGV2bV9rbWFsbG9j
X2FycmF5KGRldiwgZGVzYy5udW1fZm9ybWF0cyArIDEsIHNpemVvZigqZm9ybWF0cyksIEdGUF9L
RVJORUwpOworCWlmICghZm9ybWF0c19kZXYgfHwgIWZvcm1hdHMpCisJCXJldHVybiAtRU5PTUVN
OworCisJcmV0ID0gZ3VkX3VzYl9nZXQoZ2RybSwgR1VEX1JFUV9HRVRfRk9STUFUUywgMCwgZm9y
bWF0c19kZXYsIGRlc2MubnVtX2Zvcm1hdHMpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisK
Kwlmb3IgKGkgPSAwOyBpIDwgZGVzYy5udW1fZm9ybWF0czsgaSsrKSB7CisJCWNvbnN0IHN0cnVj
dCBkcm1fZm9ybWF0X2luZm8gKmluZm87CisJCXNpemVfdCBmbXRfYnVmX3NpemU7CisJCXUzMiBm
b3JtYXQ7CisKKwkJZm9ybWF0ID0gZ3VkX3RvX2ZvdXJjYyhmb3JtYXRzX2RldltpXSk7CisJCWlm
ICghZm9ybWF0KSB7CisJCQlkcm1fZGJnKGRybSwgIlVuc3VwcG9ydGVkIGZvcm1hdDogMHglMDJ4
XG4iLCBmb3JtYXRzX2RldltpXSk7CisJCQljb250aW51ZTsKKwkJfQorCisJCWlmIChmb3JtYXQg
PT0gR1VEX0RSTV9GT1JNQVRfUjEpCisJCQlpbmZvID0gJmd1ZF9kcm1fZm9ybWF0X3IxOworCQll
bHNlCisJCQlpbmZvID0gZHJtX2Zvcm1hdF9pbmZvKGZvcm1hdCk7CisKKwkJc3dpdGNoIChmb3Jt
YXQpIHsKKwkJY2FzZSBHVURfRFJNX0ZPUk1BVF9SMToKKwkJCXhyZ2I4ODg4X2VtdWxhdGlvbl9m
b3JtYXQgPSBpbmZvOworCQkJYnJlYWs7CisJCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CisJCQly
Z2I1NjVfc3VwcG9ydGVkID0gdHJ1ZTsKKwkJCWlmICgheHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1h
dCkKKwkJCQl4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0ID0gaW5mbzsKKwkJCWJyZWFrOworCQlj
YXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJCQl4cmdiODg4OF9zdXBwb3J0ZWQgPSB0cnVlOwor
CQkJYnJlYWs7CisJCX07CisKKwkJZm10X2J1Zl9zaXplID0gZHJtX2Zvcm1hdF9pbmZvX21pbl9w
aXRjaChpbmZvLCAwLCBkcm0tPm1vZGVfY29uZmlnLm1heF93aWR0aCkgKgorCQkJICAgICAgIGRy
bS0+bW9kZV9jb25maWcubWF4X2hlaWdodDsKKwkJbWF4X2J1ZmZlcl9zaXplID0gbWF4KG1heF9i
dWZmZXJfc2l6ZSwgZm10X2J1Zl9zaXplKTsKKworCQlpZiAoZm9ybWF0ID09IEdVRF9EUk1fRk9S
TUFUX1IxKQorCQkJY29udGludWU7IC8qIEludGVybmFsIG5vdCBmb3IgdXNlcnNwYWNlICovCisK
KwkJZm9ybWF0c1tudW1fZm9ybWF0cysrXSA9IGZvcm1hdDsKKwl9CisKKwlpZiAoIW51bV9mb3Jt
YXRzICYmICF4cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KSB7CisJCWRldl9lcnIoZGV2LCAiTm8g
c3VwcG9ydGVkIHBpeGVsIGZvcm1hdHMgZm91bmRcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9
CisKKwkvKiBQcmVmZXIgc3BlZWQgb3ZlciBjb2xvciBkZXB0aCAqLworCWlmIChyZ2I1NjVfc3Vw
cG9ydGVkKQorCQlkcm0tPm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDE2OworCisJaWYg
KCF4cmdiODg4OF9zdXBwb3J0ZWQgJiYgeHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdCkgeworCQln
ZHJtLT54cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0ID0geHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1h
dDsKKwkJZm9ybWF0c1tudW1fZm9ybWF0cysrXSA9IERSTV9GT1JNQVRfWFJHQjg4ODg7CisJfQor
CisJaWYgKGRlc2MubWF4X2J1ZmZlcl9zaXplKQorCQltYXhfYnVmZmVyX3NpemUgPSBsZTMyX3Rv
X2NwdShkZXNjLm1heF9idWZmZXJfc2l6ZSk7CityZXRyeToKKwkvKgorCSAqIFVzZSBwbGFpbiBr
bWFsbG9jIGhlcmUgc2luY2UgZGV2bV9rbWFsbG9jKCkgcGxhY2VzIHN0cnVjdCBkZXZyZXMgYXQg
dGhlIGJlZ2lubmluZworCSAqIG9mIHRoZSBidWZmZXIgaXQgYWxsb2NhdGVzLiBUaGlzIHdhc3Rl
cyBhIGxvdCBvZiBtZW1vcnkgd2hlbiBhbGxvY2F0aW5nIGJpZyBidWZmZXJzLgorCSAqIEFza2lu
ZyBmb3IgMk0gd291bGQgYWN0dWFsbHkgYWxsb2NhdGUgNE0uIFRoaXMgd291bGQgYWxzbyBwcmV2
ZW50IGdldHRpbmcgdGhlIGJpZ2dlc3QKKwkgKiBwb3NzaWJsZSBidWZmZXIgcG90ZW50aWFsbHkg
bGVhZGluZyB0byBzcGxpdCB0cmFuc2ZlcnMuCisJICovCisJZ2RybS0+YnVsa19idWYgPSBrbWFs
bG9jKG1heF9idWZmZXJfc2l6ZSwgR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FSTik7CisJaWYgKCFn
ZHJtLT5idWxrX2J1ZikgeworCQltYXhfYnVmZmVyX3NpemUgPSByb3VuZHVwX3Bvd19vZl90d28o
bWF4X2J1ZmZlcl9zaXplKSAvIDI7CisJCWlmIChtYXhfYnVmZmVyX3NpemUgPCBTWl81MTJLKQor
CQkJcmV0dXJuIC1FTk9NRU07CisJCWdvdG8gcmV0cnk7CisJfQorCisJZ2RybS0+YnVsa19waXBl
ID0gdXNiX3NuZGJ1bGtwaXBlKHVzYiwgdXNiX2VuZHBvaW50X251bShidWxrX291dCkpOworCWdk
cm0tPmJ1bGtfbGVuID0gbWF4X2J1ZmZlcl9zaXplOworCisJaWYgKGdkcm0tPmNvbXByZXNzaW9u
ICYgR1VEX0NPTVBSRVNTSU9OX0xaNCkgeworCQlnZHJtLT5sejRfY29tcF9tZW0gPSBkZXZtX2tt
YWxsb2MoZGV2LCBMWjRfTUVNX0NPTVBSRVNTLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFnZHJtLT5s
ejRfY29tcF9tZW0pCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlnZHJtLT5jb21wcmVzc19idWYg
PSB2bWFsbG9jKGdkcm0tPmJ1bGtfbGVuKTsKKwkJaWYgKCFnZHJtLT5jb21wcmVzc19idWYpCisJ
CQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlyZXQgPSBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9p
bml0KGRybSwgJmdkcm0tPnBpcGUsICZndWRfcGlwZV9mdW5jcywKKwkJCQkJICAgZm9ybWF0cywg
bnVtX2Zvcm1hdHMsCisJCQkJCSAgIGd1ZF9waXBlX21vZGlmaWVycywgTlVMTCk7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKworCWRldm1fa2ZyZWUoZGV2LCBmb3JtYXRzKTsKKwlkZXZtX2tm
cmVlKGRldiwgZm9ybWF0c19kZXYpOworCisJcmV0ID0gZ3VkX2dldF9wcm9wZXJ0aWVzKGdkcm0s
IGRlc2MubnVtX3Byb3BlcnRpZXMpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlkcm1f
cGxhbmVfZW5hYmxlX2ZiX2RhbWFnZV9jbGlwcygmZ2RybS0+cGlwZS5wbGFuZSk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgZGVzYy5udW1fY29ubmVjdG9yczsgaSsrKSB7CisJCXJldCA9IGd1ZF9jb25u
ZWN0b3JfY3JlYXRlKGdkcm0sIGkpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisK
Kwlkcm1fbW9kZV9jb25maWdfcmVzZXQoZHJtKTsKKworCXVzYl9zZXRfaW50ZmRhdGEoaW50ZXJm
YWNlLCBnZHJtKTsKKworCXJldCA9IGRybV9kZXZfcmVnaXN0ZXIoZHJtLCAwKTsKKwlpZiAocmV0
KQorCQlyZXR1cm4gcmV0OworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9pbml0KGRybSk7CisKKwlk
cm1fZmJkZXZfZ2VuZXJpY19zZXR1cChkcm0sIDApOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyB2b2lkIGd1ZF9kaXNjb25uZWN0KHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UpCit7
CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVyZmFjZSk7
CisJc3RydWN0IGRybV9kZXZpY2UgKmRybSA9ICZnZHJtLT5kcm07CisKKwlkcm1fZGJnKGRybSwg
IiVzOlxuIiwgX19mdW5jX18pOworCisJZHJtX2ttc19oZWxwZXJfcG9sbF9maW5pKGRybSk7CisJ
ZHJtX2Rldl91bnBsdWcoZHJtKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9zaHV0ZG93bihkcm0pOwor
fQorCitzdGF0aWMgaW50IGd1ZF9zdXNwZW5kKHN0cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZh
Y2UsIHBtX21lc3NhZ2VfdCBtZXNzYWdlKQoreworCXN0cnVjdCBndWRfZGV2aWNlICpnZHJtID0g
dXNiX2dldF9pbnRmZGF0YShpbnRlcmZhY2UpOworCisJcmV0dXJuIGRybV9tb2RlX2NvbmZpZ19o
ZWxwZXJfc3VzcGVuZCgmZ2RybS0+ZHJtKTsKK30KKworc3RhdGljIGludCBndWRfcmVzdW1lKHN0
cnVjdCB1c2JfaW50ZXJmYWNlICppbnRlcmZhY2UpCit7CisJc3RydWN0IGd1ZF9kZXZpY2UgKmdk
cm0gPSB1c2JfZ2V0X2ludGZkYXRhKGludGVyZmFjZSk7CisKKwlkcm1fbW9kZV9jb25maWdfaGVs
cGVyX3Jlc3VtZSgmZ2RybS0+ZHJtKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgY29uc3Qg
c3RydWN0IHVzYl9kZXZpY2VfaWQgZ3VkX2lkX3RhYmxlW10gPSB7CisJeyBVU0JfREVWSUNFX0lO
VEVSRkFDRV9DTEFTUygweDFkNTAsIDB4NjE0ZCwgVVNCX0NMQVNTX1ZFTkRPUl9TUEVDKSB9LAor
CXsgfQorfTsKKworTU9EVUxFX0RFVklDRV9UQUJMRSh1c2IsIGd1ZF9pZF90YWJsZSk7CisKK3N0
YXRpYyBzdHJ1Y3QgdXNiX2RyaXZlciBndWRfdXNiX2RyaXZlciA9IHsKKwkubmFtZQkJPSAiZ3Vk
IiwKKwkucHJvYmUJCT0gZ3VkX3Byb2JlLAorCS5kaXNjb25uZWN0CT0gZ3VkX2Rpc2Nvbm5lY3Qs
CisJLmlkX3RhYmxlCT0gZ3VkX2lkX3RhYmxlLAorCS5zdXNwZW5kCT0gZ3VkX3N1c3BlbmQsCisJ
LnJlc3VtZQkJPSBndWRfcmVzdW1lLAorCS5yZXNldF9yZXN1bWUJPSBndWRfcmVzdW1lLAorfTsK
KworbW9kdWxlX3VzYl9kcml2ZXIoZ3VkX3VzYl9kcml2ZXIpOworCitNT0RVTEVfQVVUSE9SKCJO
b3JhbGYgVHLDuG5uZXMiKTsKK01PRFVMRV9MSUNFTlNFKCJEdWFsIE1JVC9HUEwiKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ndWQvZ3VkX2ludGVybmFsLmggYi9kcml2ZXJzL2dwdS9k
cm0vZ3VkL2d1ZF9pbnRlcm5hbC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uNDVjYjJiNmQ1YmQzCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2d1
ZC9ndWRfaW50ZXJuYWwuaApAQCAtMCwwICsxLDE0OSBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVCAqLworCisjaWZuZGVmIF9fTElOVVhfR1VEX0lOVEVSTkFMX0gKKyNkZWZpbmUg
X19MSU5VWF9HVURfSU5URVJOQUxfSAorCisjaW5jbHVkZSA8bGludXgvbGlzdC5oPgorI2luY2x1
ZGUgPGxpbnV4L211dGV4Lmg+CisjaW5jbHVkZSA8bGludXgvdXNiLmg+CisjaW5jbHVkZSA8bGlu
dXgvd29ya3F1ZXVlLmg+CisjaW5jbHVkZSA8dWFwaS9kcm0vZHJtX2ZvdXJjYy5oPgorCisjaW5j
bHVkZSA8ZHJtL2RybV9tb2Rlcy5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxw
ZXIuaD4KKworc3RydWN0IGd1ZF9kZXZpY2UgeworCXN0cnVjdCBkcm1fZGV2aWNlIGRybTsKKwlz
dHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgcGlwZTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
d29yazsKKwl1OCBpZm51bTsKKwl1MzIgZmxhZ3M7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqeHJnYjg4ODhfZW11bGF0aW9uX2Zvcm1hdDsKKworCXUxNiAqcHJvcGVydGllczsKKwl1
bnNpZ25lZCBpbnQgbnVtX3Byb3BlcnRpZXM7CisKKwl1bnNpZ25lZCBpbnQgYnVsa19waXBlOwor
CXZvaWQgKmJ1bGtfYnVmOworCXNpemVfdCBidWxrX2xlbjsKKworCXU4IGNvbXByZXNzaW9uOwor
CXZvaWQgKmx6NF9jb21wX21lbTsKKwl2b2lkICpjb21wcmVzc19idWY7CisKKwl1NjQgc3RhdHNf
bGVuZ3RoOworCXU2NCBzdGF0c19hY3R1YWxfbGVuZ3RoOworCXVuc2lnbmVkIGludCBzdGF0c19u
dW1fZXJyb3JzOworCisJc3RydWN0IG11dGV4IGN0cmxfbG9jazsgLyogU2VyaWFsaXplIGdldC9z
ZXQgYW5kIHN0YXR1cyB0cmFuc2ZlcnMgKi8KKworCXN0cnVjdCBtdXRleCBkYW1hZ2VfbG9jazsg
LyogUHJvdGVjdHMgdGhlIGZvbGxvd2luZyBtZW1iZXJzOiAqLworCXN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiOworCXN0cnVjdCBkcm1fcmVjdCBkYW1hZ2U7CisJYm9vbCBwcmV2X2ZsdXNoX2Zh
aWxlZDsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGd1ZF9kZXZpY2UgKnRvX2d1ZF9kZXZp
Y2Uoc3RydWN0IGRybV9kZXZpY2UgKmRybSkKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKGRybSwg
c3RydWN0IGd1ZF9kZXZpY2UsIGRybSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IHVzYl9k
ZXZpY2UgKmd1ZF90b191c2JfZGV2aWNlKHN0cnVjdCBndWRfZGV2aWNlICpnZHJtKQoreworCXJl
dHVybiBpbnRlcmZhY2VfdG9fdXNiZGV2KHRvX3VzYl9pbnRlcmZhY2UoZ2RybS0+ZHJtLmRldikp
OworfQorCitpbnQgZ3VkX3VzYl9nZXQoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHU4IHJlcXVl
c3QsIHUxNiBpbmRleCwgdm9pZCAqYnVmLCBzaXplX3QgbGVuKTsKK2ludCBndWRfdXNiX3NldChz
dHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgdTggcmVxdWVzdCwgdTE2IGluZGV4LCB2b2lkICpidWYs
IHNpemVfdCBsZW4pOworaW50IGd1ZF91c2Jfd3JpdGU4KHN0cnVjdCBndWRfZGV2aWNlICpnZHJt
LCB1OCByZXF1ZXN0LCB1OCB2YWwpOworCit2b2lkIGd1ZF9jbGVhcl9kYW1hZ2Uoc3RydWN0IGd1
ZF9kZXZpY2UgKmdkcm0pOwordm9pZCBndWRfZmx1c2hfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
KndvcmspOworaW50IGd1ZF9waXBlX2NoZWNrKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlw
ZSAqcGlwZSwKKwkJICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlLAor
CQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKTsKK3ZvaWQgZ3VkX3Bp
cGVfdXBkYXRlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKKwkJICAgICBz
dHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpOworaW50IGd1ZF9jb25uZWN0b3JfZmls
bF9wcm9wZXJ0aWVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlLAorCQkJCSAgc3RydWN0IGd1
ZF9wcm9wZXJ0eV9yZXEgKnByb3BlcnRpZXMpOworaW50IGd1ZF9jb25uZWN0b3JfY3JlYXRlKHN0
cnVjdCBndWRfZGV2aWNlICpnZHJtLCB1bnNpZ25lZCBpbnQgaW5kZXgpOworCisvKiBEcml2ZXIg
aW50ZXJuYWwgZm91cmNjIGZvciAxLWJpdCBtb25vY2hyb21lICovCisjZGVmaW5lIEdVRF9EUk1f
Rk9STUFUX1IxCTB4MDAwMDAxMjIKKworc3RhdGljIGlubGluZSB1OCBndWRfZnJvbV9mb3VyY2Mo
dTMyIGZvdXJjYykKK3sKKwlzd2l0Y2ggKGZvdXJjYykgeworCWNhc2UgR1VEX0RSTV9GT1JNQVRf
UjE6CisJCXJldHVybiBHVURfUElYRUxfRk9STUFUX1IxOworCWNhc2UgRFJNX0ZPUk1BVF9SR0I1
NjU6CisJCXJldHVybiBHVURfUElYRUxfRk9STUFUX1JHQjU2NTsKKwljYXNlIERSTV9GT1JNQVRf
WFJHQjg4ODg6CisJCXJldHVybiBHVURfUElYRUxfRk9STUFUX1hSR0I4ODg4OworCWNhc2UgRFJN
X0ZPUk1BVF9BUkdCODg4ODoKKwkJcmV0dXJuIEdVRF9QSVhFTF9GT1JNQVRfQVJHQjg4ODg7CisJ
fTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW5saW5lIHUzMiBndWRfdG9fZm91cmNjKHU4
IGZvcm1hdCkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgR1VEX1BJWEVMX0ZPUk1BVF9S
MToKKwkJcmV0dXJuIEdVRF9EUk1fRk9STUFUX1IxOworCWNhc2UgR1VEX1BJWEVMX0ZPUk1BVF9S
R0I1NjU6CisJCXJldHVybiBEUk1fRk9STUFUX1JHQjU2NTsKKwljYXNlIEdVRF9QSVhFTF9GT1JN
QVRfWFJHQjg4ODg6CisJCXJldHVybiBEUk1fRk9STUFUX1hSR0I4ODg4OworCWNhc2UgR1VEX1BJ
WEVMX0ZPUk1BVF9BUkdCODg4ODoKKwkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjg4ODg7CisJfTsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZ3VkX2Zyb21fZGlzcGxheV9t
b2RlKHN0cnVjdCBndWRfZGlzcGxheV9tb2RlX3JlcSAqZHN0LAorCQkJCQkgY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKnNyYykKK3sKKwl1MzIgZmxhZ3MgPSBzcmMtPmZsYWdzICYgR1VE
X0RJU1BMQVlfTU9ERV9GTEFHX1VTRVJfTUFTSzsKKworCWlmIChzcmMtPnR5cGUgJiBEUk1fTU9E
RV9UWVBFX1BSRUZFUlJFRCkKKwkJZmxhZ3MgfD0gR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BSRUZF
UlJFRDsKKworCWRzdC0+Y2xvY2sgPSBjcHVfdG9fbGUzMihzcmMtPmNsb2NrKTsKKwlkc3QtPmhk
aXNwbGF5ID0gY3B1X3RvX2xlMTYoc3JjLT5oZGlzcGxheSk7CisJZHN0LT5oc3luY19zdGFydCA9
IGNwdV90b19sZTE2KHNyYy0+aHN5bmNfc3RhcnQpOworCWRzdC0+aHN5bmNfZW5kID0gY3B1X3Rv
X2xlMTYoc3JjLT5oc3luY19lbmQpOworCWRzdC0+aHRvdGFsID0gY3B1X3RvX2xlMTYoc3JjLT5o
dG90YWwpOworCWRzdC0+dmRpc3BsYXkgPSBjcHVfdG9fbGUxNihzcmMtPnZkaXNwbGF5KTsKKwlk
c3QtPnZzeW5jX3N0YXJ0ID0gY3B1X3RvX2xlMTYoc3JjLT52c3luY19zdGFydCk7CisJZHN0LT52
c3luY19lbmQgPSBjcHVfdG9fbGUxNihzcmMtPnZzeW5jX2VuZCk7CisJZHN0LT52dG90YWwgPSBj
cHVfdG9fbGUxNihzcmMtPnZ0b3RhbCk7CisJZHN0LT5mbGFncyA9IGNwdV90b19sZTMyKGZsYWdz
KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGd1ZF90b19kaXNwbGF5X21vZGUoc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmRzdCwKKwkJCQkgICAgICAgY29uc3Qgc3RydWN0IGd1ZF9kaXNwbGF5
X21vZGVfcmVxICpzcmMpCit7CisJdTMyIGZsYWdzID0gbGUzMl90b19jcHUoc3JjLT5mbGFncyk7
CisKKwltZW1zZXQoZHN0LCAwLCBzaXplb2YoKmRzdCkpOworCWRzdC0+Y2xvY2sgPSBsZTMyX3Rv
X2NwdShzcmMtPmNsb2NrKTsKKwlkc3QtPmhkaXNwbGF5ID0gbGUxNl90b19jcHUoc3JjLT5oZGlz
cGxheSk7CisJZHN0LT5oc3luY19zdGFydCA9IGxlMTZfdG9fY3B1KHNyYy0+aHN5bmNfc3RhcnQp
OworCWRzdC0+aHN5bmNfZW5kID0gbGUxNl90b19jcHUoc3JjLT5oc3luY19lbmQpOworCWRzdC0+
aHRvdGFsID0gbGUxNl90b19jcHUoc3JjLT5odG90YWwpOworCWRzdC0+dmRpc3BsYXkgPSBsZTE2
X3RvX2NwdShzcmMtPnZkaXNwbGF5KTsKKwlkc3QtPnZzeW5jX3N0YXJ0ID0gbGUxNl90b19jcHUo
c3JjLT52c3luY19zdGFydCk7CisJZHN0LT52c3luY19lbmQgPSBsZTE2X3RvX2NwdShzcmMtPnZz
eW5jX2VuZCk7CisJZHN0LT52dG90YWwgPSBsZTE2X3RvX2NwdShzcmMtPnZ0b3RhbCk7CisJZHN0
LT5mbGFncyA9IGZsYWdzICYgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1VTRVJfTUFTSzsKKwlkc3Qt
PnR5cGUgPSBEUk1fTU9ERV9UWVBFX0RSSVZFUjsKKwlpZiAoZmxhZ3MgJiBHVURfRElTUExBWV9N
T0RFX0ZMQUdfUFJFRkVSUkVEKQorCQlkc3QtPnR5cGUgfD0gRFJNX01PREVfVFlQRV9QUkVGRVJS
RUQ7CisJZHJtX21vZGVfc2V0X25hbWUoZHN0KTsKK30KKworI2VuZGlmCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBlLmMgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9w
aXBlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi40NzhiODhlNjlh
ZDMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vZ3VkL2d1ZF9waXBlLmMKQEAg
LTAsMCArMSw0NzUgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBD
b3B5cmlnaHQgMjAyMCBOb3JhbGYgVHLDuG5uZXMKKyAqLworCisjaW5jbHVkZSA8bGludXgvZG1h
LWJ1Zi5oPgorI2luY2x1ZGUgPGxpbnV4L2x6NC5oPgorI2luY2x1ZGUgPGxpbnV4L3VzYi5oPgor
I2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9taWMu
aD4KKyNpbmNsdWRlIDxkcm0vZHJtX2Nvbm5lY3Rvci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGFt
YWdlX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CisjaW5jbHVkZSA8ZHJtL2Ry
bV9mb3JtYXRfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2ZyYW1lYnVmZmVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9nZW1fc2htZW1faGVs
cGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgorI2luY2x1ZGUgPGRybS9kcm1fcmVj
dC5oPgorI2luY2x1ZGUgPGRybS9kcm1fc2ltcGxlX2ttc19oZWxwZXIuaD4KKyNpbmNsdWRlIDxk
cm0vZ3VkLmg+CisKKyNpbmNsdWRlICJndWRfaW50ZXJuYWwuaCIKKworc3RhdGljIGJvb2wgZ3Vk
X2lzX2JpZ19lbmRpYW4odm9pZCkKK3sKKyNpZiBkZWZpbmVkKF9fQklHX0VORElBTikKKwlyZXR1
cm4gdHJ1ZTsKKyNlbHNlCisJcmV0dXJuIGZhbHNlOworI2VuZGlmCit9CisKK3N0YXRpYyBzaXpl
X3QgZ3VkX3hyZ2I4ODg4X3RvX3IxMjQodTggKmRzdCwgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqZm9ybWF0LAorCQkJCSAgIHZvaWQgKnNyYywgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsCisJCQkJICAgc3RydWN0IGRybV9yZWN0ICpyZWN0KQoreworCXVuc2lnbmVkIGludCBibG9j
a193aWR0aCA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193aWR0aChmb3JtYXQsIDApOworCXVuc2ln
bmVkIGludCBiaXRzX3Blcl9waXhlbCA9IDggLyBibG9ja193aWR0aDsKKwl1bnNpZ25lZCBpbnQg
eCwgeSwgd2lkdGgsIGhlaWdodDsKKwl1OCAqcCwgKmJsb2NrID0gZHN0OyAvKiBBc3NpZ24gdG8g
c2lsZW5jZSBjb21waWxlciB3YXJuaW5nICovCisJc2l6ZV90IGxlbjsKKwl2b2lkICpidWY7CisK
KwlXQVJOX09OX09OQ0UoZm9ybWF0LT5jaGFyX3Blcl9ibG9ja1swXSAhPSAxKTsKKworCS8qIFN0
YXJ0IG9uIGEgYnl0ZSBib3VuZGFyeSAqLworCXJlY3QtPngxID0gQUxJR05fRE9XTihyZWN0LT54
MSwgYmxvY2tfd2lkdGgpOworCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgocmVjdCk7CisJaGVpZ2h0
ID0gZHJtX3JlY3RfaGVpZ2h0KHJlY3QpOworCWxlbiA9IGRybV9mb3JtYXRfaW5mb19taW5fcGl0
Y2goZm9ybWF0LCAwLCB3aWR0aCkgKiBoZWlnaHQ7CisKKwlidWYgPSBrbWFsbG9jKHdpZHRoICog
aGVpZ2h0LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWJ1ZikKKwkJcmV0dXJuIDA7CisKKwlkcm1fZmJf
eHJnYjg4ODhfdG9fZ3JheTgoYnVmLCBzcmMsIGZiLCByZWN0KTsKKworCXAgPSBidWY7CisJZm9y
ICh5ID0gMDsgeSA8IGRybV9yZWN0X2hlaWdodChyZWN0KTsgeSsrKSB7CisJCWZvciAoeCA9IDA7
IHggPCBkcm1fcmVjdF93aWR0aChyZWN0KTsgeCsrKSB7CisJCQlpZiAoISh4ICUgYmxvY2tfd2lk
dGgpKSB7CisJCQkJYmxvY2sgPSBkc3QrKzsKKwkJCQkqYmxvY2sgPSAwOworCQkJfQorCisJCQkq
YmxvY2sgPDw9IGJpdHNfcGVyX3BpeGVsOworCQkJKmJsb2NrIHw9ICgqcCsrKSA+PiAoOCAtIGJp
dHNfcGVyX3BpeGVsKTsKKwkJfQorCX0KKworCWtmcmVlKGJ1Zik7CisKKwlyZXR1cm4gbGVuOwor
fQorCitzdGF0aWMgaW50IGd1ZF9wcmVwX2ZsdXNoKHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyAqZm9ybWF0LCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QsCisJCQkgIHN0cnVjdCBndWRfc2V0
X2J1ZmZlcl9yZXEgKnJlcSkKK3sKKwlzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICppbXBvcnRf
YXR0YWNoID0gZmItPm9ialswXS0+aW1wb3J0X2F0dGFjaDsKKwl1OCBjb21wcmVzc2lvbiA9IGdk
cm0tPmNvbXByZXNzaW9uOworCXN0cnVjdCBkbWFfYnVmX21hcCBtYXA7CisJdm9pZCAqdmFkZHIs
ICpidWY7CisJc2l6ZV90IHBpdGNoLCBsZW47CisJaW50IHJldCA9IDA7CisKKwlwaXRjaCA9IGRy
bV9mb3JtYXRfaW5mb19taW5fcGl0Y2goZm9ybWF0LCAwLCBkcm1fcmVjdF93aWR0aChyZWN0KSk7
CisJbGVuID0gcGl0Y2ggKiBkcm1fcmVjdF9oZWlnaHQocmVjdCk7CisJaWYgKGxlbiA+IGdkcm0t
PmJ1bGtfbGVuKQorCQlyZXR1cm4gLUUyQklHOworCisJcmV0ID0gZHJtX2dlbV9zaG1lbV92bWFw
KGZiLT5vYmpbMF0sICZtYXApOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwl2YWRkciA9
IG1hcC52YWRkciArIGZiLT5vZmZzZXRzWzBdOworCisJaWYgKGltcG9ydF9hdHRhY2gpIHsKKwkJ
cmV0ID0gZG1hX2J1Zl9iZWdpbl9jcHVfYWNjZXNzKGltcG9ydF9hdHRhY2gtPmRtYWJ1ZiwgRE1B
X0ZST01fREVWSUNFKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gdnVubWFwOworCX0KK3JldHJ5Ogor
CWlmIChjb21wcmVzc2lvbikKKwkJYnVmID0gZ2RybS0+Y29tcHJlc3NfYnVmOworCWVsc2UKKwkJ
YnVmID0gZ2RybS0+YnVsa19idWY7CisKKwkvKgorCSAqIEltcG9ydGVkIGJ1ZmZlcnMgYXJlIGFz
c3VtZWQgdG8gYmUgd3JpdGUtY29tYmluZWQgYW5kIHRodXMgdW5jYWNoZWQKKwkgKiB3aXRoIHNs
b3cgcmVhZHMgKGF0IGxlYXN0IG9uIEFSTSkuCisJICovCisJaWYgKGZvcm1hdCAhPSBmYi0+Zm9y
bWF0KSB7CisJCWlmIChmb3JtYXQtPmZvcm1hdCA9PSBHVURfRFJNX0ZPUk1BVF9SMSkgeworCQkJ
bGVuID0gZ3VkX3hyZ2I4ODg4X3RvX3IxMjQoYnVmLCBmb3JtYXQsIHZhZGRyLCBmYiwgcmVjdCk7
CisJCQlpZiAoIWxlbikgeworCQkJCXJldCA9IC1FTk9NRU07CisJCQkJZ290byBlbmRfY3B1X2Fj
Y2VzczsKKwkJCX0KKwkJfSBlbHNlIGlmIChmb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9STUFUX1JH
QjU2NSkgeworCQkJZHJtX2ZiX3hyZ2I4ODg4X3RvX3JnYjU2NShidWYsIHZhZGRyLCBmYiwgcmVj
dCwgZ3VkX2lzX2JpZ19lbmRpYW4oKSk7CisJCX0KKwl9IGVsc2UgaWYgKGd1ZF9pc19iaWdfZW5k
aWFuKCkgJiYgZm9ybWF0LT5jcHBbMF0gPiAxKSB7CisJCWRybV9mYl9zd2FiKGJ1ZiwgdmFkZHIs
IGZiLCByZWN0LCAhaW1wb3J0X2F0dGFjaCk7CisJfSBlbHNlIGlmIChjb21wcmVzc2lvbiAmJiAh
aW1wb3J0X2F0dGFjaCAmJiBwaXRjaCA9PSBmYi0+cGl0Y2hlc1swXSkgeworCQkvKiBjYW4gY29t
cHJlc3MgZGlyZWN0bHkgZnJvbSB0aGUgZnJhbWVidWZmZXIgKi8KKwkJYnVmID0gdmFkZHIgKyBy
ZWN0LT55MSAqIHBpdGNoOworCX0gZWxzZSB7CisJCWRybV9mYl9tZW1jcHkoYnVmLCB2YWRkciwg
ZmIsIHJlY3QpOworCX0KKworCW1lbXNldChyZXEsIDAsIHNpemVvZigqcmVxKSk7CisJcmVxLT54
ID0gY3B1X3RvX2xlMzIocmVjdC0+eDEpOworCXJlcS0+eSA9IGNwdV90b19sZTMyKHJlY3QtPnkx
KTsKKwlyZXEtPndpZHRoID0gY3B1X3RvX2xlMzIoZHJtX3JlY3Rfd2lkdGgocmVjdCkpOworCXJl
cS0+aGVpZ2h0ID0gY3B1X3RvX2xlMzIoZHJtX3JlY3RfaGVpZ2h0KHJlY3QpKTsKKwlyZXEtPmxl
bmd0aCA9IGNwdV90b19sZTMyKGxlbik7CisKKwlpZiAoY29tcHJlc3Npb24gJiBHVURfQ09NUFJF
U1NJT05fTFo0KSB7CisJCWludCBjb21wbGVuOworCisJCWNvbXBsZW4gPSBMWjRfY29tcHJlc3Nf
ZGVmYXVsdChidWYsIGdkcm0tPmJ1bGtfYnVmLCBsZW4sIGxlbiwgZ2RybS0+bHo0X2NvbXBfbWVt
KTsKKwkJaWYgKGNvbXBsZW4gPCAwKSB7CisJCQljb21wcmVzc2lvbiA9IDA7CisJCQlnb3RvIHJl
dHJ5OworCQl9CisKKwkJcmVxLT5jb21wcmVzc2lvbiA9IEdVRF9DT01QUkVTU0lPTl9MWjQ7CisJ
CXJlcS0+Y29tcHJlc3NlZF9sZW5ndGggPSBjcHVfdG9fbGUzMihjb21wbGVuKTsKKwl9CisKK2Vu
ZF9jcHVfYWNjZXNzOgorCWlmIChpbXBvcnRfYXR0YWNoKQorCQlkbWFfYnVmX2VuZF9jcHVfYWNj
ZXNzKGltcG9ydF9hdHRhY2gtPmRtYWJ1ZiwgRE1BX0ZST01fREVWSUNFKTsKK3Z1bm1hcDoKKwlk
cm1fZ2VtX3NobWVtX3Z1bm1hcChmYi0+b2JqWzBdLCAmbWFwKTsKKworCXJldHVybiByZXQ7Cit9
CisKK3N0YXRpYyBpbnQgZ3VkX2ZsdXNoX3JlY3Qoc3RydWN0IGd1ZF9kZXZpY2UgKmdkcm0sIHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvICpmb3JtYXQsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKK3sKKwlzdHJ1Y3QgdXNiX2Rldmlj
ZSAqdXNiID0gZ3VkX3RvX3VzYl9kZXZpY2UoZ2RybSk7CisJc3RydWN0IGd1ZF9zZXRfYnVmZmVy
X3JlcSByZXE7CisJaW50IHJldCwgYWN0dWFsX2xlbmd0aDsKKwlzaXplX3QgbGVuLCB0cmxlbjsK
KworCWRybV9kYmcoJmdkcm0tPmRybSwgIkZsdXNoaW5nIFtGQjolZF0gIiBEUk1fUkVDVF9GTVQg
IlxuIiwgZmItPmJhc2UuaWQsIERSTV9SRUNUX0FSRyhyZWN0KSk7CisKKwlyZXQgPSBndWRfcHJl
cF9mbHVzaChnZHJtLCBmYiwgZm9ybWF0LCByZWN0LCAmcmVxKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJbGVuID0gbGUzMl90b19jcHUocmVxLmxlbmd0aCk7CisKKwlpZiAocmVxLmNv
bXByZXNzaW9uKQorCQl0cmxlbiA9IGxlMzJfdG9fY3B1KHJlcS5jb21wcmVzc2VkX2xlbmd0aCk7
CisJZWxzZQorCQl0cmxlbiA9IGxlbjsKKworCWdkcm0tPnN0YXRzX2xlbmd0aCArPSBsZW47CisJ
LyogRGlkIGl0IHdyYXAgYXJvdW5kPyAqLworCWlmIChnZHJtLT5zdGF0c19sZW5ndGggPD0gbGVu
ICYmIGdkcm0tPnN0YXRzX2FjdHVhbF9sZW5ndGgpIHsKKwkJZ2RybS0+c3RhdHNfbGVuZ3RoID0g
bGVuOworCQlnZHJtLT5zdGF0c19hY3R1YWxfbGVuZ3RoID0gMDsKKwl9CisJZ2RybS0+c3RhdHNf
YWN0dWFsX2xlbmd0aCArPSB0cmxlbjsKKworCWlmICghKGdkcm0tPmZsYWdzICYgR1VEX0RJU1BM
QVlfRkxBR19GVUxMX1VQREFURSkgfHwgZ2RybS0+cHJldl9mbHVzaF9mYWlsZWQpIHsKKwkJcmV0
ID0gZ3VkX3VzYl9zZXQoZ2RybSwgR1VEX1JFUV9TRVRfQlVGRkVSLCAwLCAmcmVxLCBzaXplb2Yo
cmVxKSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKworCXJldCA9IHVzYl9idWxr
X21zZyh1c2IsIGdkcm0tPmJ1bGtfcGlwZSwgZ2RybS0+YnVsa19idWYsIHRybGVuLAorCQkJICAg
JmFjdHVhbF9sZW5ndGgsIG1zZWNzX3RvX2ppZmZpZXMoMzAwMCkpOworCWlmICghcmV0ICYmIHRy
bGVuICE9IGFjdHVhbF9sZW5ndGgpCisJCXJldCA9IC1FSU87CisJaWYgKHJldCkKKwkJZ2RybS0+
c3RhdHNfbnVtX2Vycm9ycysrOworCisJcmV0dXJuIHJldDsKK30KKwordm9pZCBndWRfY2xlYXJf
ZGFtYWdlKHN0cnVjdCBndWRfZGV2aWNlICpnZHJtKQoreworCWdkcm0tPmRhbWFnZS54MSA9IElO
VF9NQVg7CisJZ2RybS0+ZGFtYWdlLnkxID0gSU5UX01BWDsKKwlnZHJtLT5kYW1hZ2UueDIgPSAw
OworCWdkcm0tPmRhbWFnZS55MiA9IDA7Cit9CisKK3N0YXRpYyB2b2lkIGd1ZF9hZGRfZGFtYWdl
KHN0cnVjdCBndWRfZGV2aWNlICpnZHJtLCBzdHJ1Y3QgZHJtX3JlY3QgKmRhbWFnZSkKK3sKKwln
ZHJtLT5kYW1hZ2UueDEgPSBtaW4oZ2RybS0+ZGFtYWdlLngxLCBkYW1hZ2UtPngxKTsKKwlnZHJt
LT5kYW1hZ2UueTEgPSBtaW4oZ2RybS0+ZGFtYWdlLnkxLCBkYW1hZ2UtPnkxKTsKKwlnZHJtLT5k
YW1hZ2UueDIgPSBtYXgoZ2RybS0+ZGFtYWdlLngyLCBkYW1hZ2UtPngyKTsKKwlnZHJtLT5kYW1h
Z2UueTIgPSBtYXgoZ2RybS0+ZGFtYWdlLnkyLCBkYW1hZ2UtPnkyKTsKK30KKworc3RhdGljIHZv
aWQgZ3VkX3JldHJ5X2ZhaWxlZF9mbHVzaChzdHJ1Y3QgZ3VkX2RldmljZSAqZ2RybSwgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJICAgc3RydWN0IGRybV9yZWN0ICpkYW1hZ2UpCit7
CisJLyoKKwkgKiBwaXBlX3VwZGF0ZSB3YWl0cyBmb3IgdGhlIHdvcmtlciB3aGVuIHRoZSBkaXNw
bGF5IG1vZGUgaXMgZ29pbmcgdG8gY2hhbmdlLgorCSAqIFRoaXMgZW5zdXJlcyB0aGF0IHRoZSB3
aWR0aCBhbmQgaGVpZ2h0IGlzIHN0aWxsIHRoZSBzYW1lIG1ha2luZyBpdCBzYWZlIHRvCisJICog
YWRkIGJhY2sgdGhlIGRhbWFnZS4KKwkgKi8KKworCW11dGV4X2xvY2soJmdkcm0tPmRhbWFnZV9s
b2NrKTsKKwlpZiAoIWdkcm0tPmZiKSB7CisJCWRybV9mcmFtZWJ1ZmZlcl9nZXQoZmIpOworCQln
ZHJtLT5mYiA9IGZiOworCX0KKwlndWRfYWRkX2RhbWFnZShnZHJtLCBkYW1hZ2UpOworCW11dGV4
X3VubG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCisJLyogUmV0cnkgb25seSBvbmNlIHRvIGF2
b2lkIGEgcG9zc2libGUgc3Rvcm0gaW4gY2FzZSBvZiBjb250aW51ZXMgZXJyb3JzLiAqLworCWlm
ICghZ2RybS0+cHJldl9mbHVzaF9mYWlsZWQpCisJCXF1ZXVlX3dvcmsoc3lzdGVtX2xvbmdfd3Es
ICZnZHJtLT53b3JrKTsKKwlnZHJtLT5wcmV2X2ZsdXNoX2ZhaWxlZCA9IHRydWU7Cit9CisKK3Zv
aWQgZ3VkX2ZsdXNoX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBn
dWRfZGV2aWNlICpnZHJtID0gY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBndWRfZGV2aWNlLCB3
b3JrKTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQ7CisJc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0IGRybV9yZWN0IGRhbWFnZTsKKwl1bnNpZ25lZCBp
bnQgaSwgbGluZXM7CisJaW50IGlkeCwgcmV0ID0gMDsKKwlzaXplX3QgcGl0Y2g7CisKKwlpZiAo
IWRybV9kZXZfZW50ZXIoJmdkcm0tPmRybSwgJmlkeCkpCisJCXJldHVybjsKKworCW11dGV4X2xv
Y2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKwlmYiA9IGdkcm0tPmZiOworCWdkcm0tPmZiID0gTlVM
TDsKKwlkYW1hZ2UgPSBnZHJtLT5kYW1hZ2U7CisJZ3VkX2NsZWFyX2RhbWFnZShnZHJtKTsKKwlt
dXRleF91bmxvY2soJmdkcm0tPmRhbWFnZV9sb2NrKTsKKworCWlmICghZmIpCisJCWdvdG8gb3V0
OworCisJZm9ybWF0ID0gZmItPmZvcm1hdDsKKwlpZiAoZm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZP
Uk1BVF9YUkdCODg4OCAmJiBnZHJtLT54cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0KQorCQlmb3Jt
YXQgPSBnZHJtLT54cmdiODg4OF9lbXVsYXRpb25fZm9ybWF0OworCisJLyogU3BsaXQgdXBkYXRl
IGlmIGl0J3MgdG9vIGJpZyAqLworCXBpdGNoID0gZHJtX2Zvcm1hdF9pbmZvX21pbl9waXRjaChm
b3JtYXQsIDAsIGRybV9yZWN0X3dpZHRoKCZkYW1hZ2UpKTsKKwlsaW5lcyA9IGRybV9yZWN0X2hl
aWdodCgmZGFtYWdlKTsKKworCWlmIChnZHJtLT5idWxrX2xlbiA8IGxpbmVzICogcGl0Y2gpCisJ
CWxpbmVzID0gZ2RybS0+YnVsa19sZW4gLyBwaXRjaDsKKworCWZvciAoaSA9IDA7IGkgPCBESVZf
Uk9VTkRfVVAoZHJtX3JlY3RfaGVpZ2h0KCZkYW1hZ2UpLCBsaW5lcyk7IGkrKykgeworCQlzdHJ1
Y3QgZHJtX3JlY3QgcmVjdCA9IGRhbWFnZTsKKworCQlyZWN0LnkxICs9IGkgKiBsaW5lczsKKwkJ
cmVjdC55MiA9IG1pbl90KHUzMiwgcmVjdC55MSArIGxpbmVzLCBkYW1hZ2UueTIpOworCisJCXJl
dCA9IGd1ZF9mbHVzaF9yZWN0KGdkcm0sIGZiLCBmb3JtYXQsICZyZWN0KTsKKwkJaWYgKHJldCkg
eworCQkJaWYgKHJldCAhPSAtRU5PREVWICYmIHJldCAhPSAtRUNPTk5SRVNFVCAmJgorCQkJICAg
IHJldCAhPSAtRVNIVVRET1dOICYmIHJldCAhPSAtRVBST1RPKSB7CisJCQkJYm9vbCBwcmV2X2Zs
dXNoX2ZhaWxlZCA9IGdkcm0tPnByZXZfZmx1c2hfZmFpbGVkOworCisJCQkJZ3VkX3JldHJ5X2Zh
aWxlZF9mbHVzaChnZHJtLCBmYiwgJmRhbWFnZSk7CisJCQkJaWYgKCFwcmV2X2ZsdXNoX2ZhaWxl
ZCkKKwkJCQkJZGV2X2Vycl9yYXRlbGltaXRlZChmYi0+ZGV2LT5kZXYsCisJCQkJCQkJICAgICJG
YWlsZWQgdG8gZmx1c2ggZnJhbWVidWZmZXI6IGVycm9yPSVkXG4iLCByZXQpOworCQkJfQorCQkJ
YnJlYWs7CisJCX0KKworCQlnZHJtLT5wcmV2X2ZsdXNoX2ZhaWxlZCA9IGZhbHNlOworCX0KKwor
CWRybV9mcmFtZWJ1ZmZlcl9wdXQoZmIpOworb3V0OgorCWRybV9kZXZfZXhpdChpZHgpOworfQor
CitzdGF0aWMgdm9pZCBndWRfZmJfcXVldWVfZGFtYWdlKHN0cnVjdCBndWRfZGV2aWNlICpnZHJt
LCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQlzdHJ1Y3QgZHJtX3JlY3QgKmRhbWFn
ZSkKK3sKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRfZmIgPSBOVUxMOworCisJbXV0ZXhf
bG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCisJaWYgKGZiICE9IGdkcm0tPmZiKSB7CisJCW9s
ZF9mYiA9IGdkcm0tPmZiOworCQlkcm1fZnJhbWVidWZmZXJfZ2V0KGZiKTsKKwkJZ2RybS0+ZmIg
PSBmYjsKKwl9CisKKwlndWRfYWRkX2RhbWFnZShnZHJtLCBkYW1hZ2UpOworCisJbXV0ZXhfdW5s
b2NrKCZnZHJtLT5kYW1hZ2VfbG9jayk7CisKKwlxdWV1ZV93b3JrKHN5c3RlbV9sb25nX3dxLCAm
Z2RybS0+d29yayk7CisKKwlpZiAob2xkX2ZiKQorCQlkcm1fZnJhbWVidWZmZXJfcHV0KG9sZF9m
Yik7Cit9CisKK2ludCBndWRfcGlwZV9jaGVjayhzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3Bp
cGUgKnBpcGUsCisJCSAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSwK
KwkJICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3Qg
Z3VkX2RldmljZSAqZ2RybSA9IHRvX2d1ZF9kZXZpY2UocGlwZS0+Y3J0Yy5kZXYpOworCXN0cnVj
dCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSA9IHBpcGUtPnBsYW5lLnN0YXRlOwor
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJm5ld19jcnRjX3N0YXRlLT5t
b2RlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG5ld19wbGFuZV9zdGF0ZS0+
c3RhdGU7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqb2xkX2ZiID0gb2xkX3BsYW5lX3N0YXRl
LT5mYjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlID0gTlVM
TDsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+ZmI7CisJ
Y29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0ID0gZmItPmZvcm1hdDsKKwlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOworCWludCBpZHgsIHJldCwgbnVtX3Byb3BlcnRp
ZXM7CisJc3RydWN0IGd1ZF9zdGF0ZV9yZXEgKnJlcTsKKwl1bnNpZ25lZCBpbnQgaTsKKwlzaXpl
X3QgbGVuOworCisJaWYgKFdBUk5fT05fT05DRSghZmIpKQorCQlyZXR1cm4gLUVJTlZBTDsKKwor
CWlmIChvbGRfcGxhbmVfc3RhdGUtPnJvdGF0aW9uICE9IG5ld19wbGFuZV9zdGF0ZS0+cm90YXRp
b24pCisJCW5ld19jcnRjX3N0YXRlLT5tb2RlX2NoYW5nZWQgPSB0cnVlOworCisJaWYgKG9sZF9m
YiAmJiBvbGRfZmItPmZvcm1hdCAhPSBmb3JtYXQpCisJCW5ld19jcnRjX3N0YXRlLT5tb2RlX2No
YW5nZWQgPSB0cnVlOworCisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+bW9kZV9jaGFuZ2VkICYmICFu
ZXdfY3J0Y19zdGF0ZS0+Y29ubmVjdG9yc19jaGFuZ2VkKQorCQlyZXR1cm4gMDsKKworCS8qIE9u
bHkgb25lIGNvbm5lY3RvciBpcyBzdXBwb3J0ZWQgKi8KKwlpZiAoaHdlaWdodDMyKG5ld19jcnRj
X3N0YXRlLT5jb25uZWN0b3JfbWFzaykgIT0gMSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAo
Zm9ybWF0LT5mb3JtYXQgPT0gRFJNX0ZPUk1BVF9YUkdCODg4OCAmJiBnZHJtLT54cmdiODg4OF9l
bXVsYXRpb25fZm9ybWF0KQorCQlmb3JtYXQgPSBnZHJtLT54cmdiODg4OF9lbXVsYXRpb25fZm9y
bWF0OworCisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9y
LCBjb25uZWN0b3Jfc3RhdGUsIGkpIHsKKwkJaWYgKGNvbm5lY3Rvcl9zdGF0ZS0+Y3J0YykKKwkJ
CWJyZWFrOworCX0KKworCWlmIChXQVJOX09OX09OQ0UoIWNvbm5lY3Rvcl9zdGF0ZSkpCisJCXJl
dHVybiAtRU5PRU5UOworCisJbnVtX3Byb3BlcnRpZXMgPSBndWRfY29ubmVjdG9yX2ZpbGxfcHJv
cGVydGllcyhjb25uZWN0b3IsIE5VTEwsIE5VTEwpOworCWlmIChudW1fcHJvcGVydGllcyA8IDAp
CisJCXJldHVybiBudW1fcHJvcGVydGllczsKKworCW51bV9wcm9wZXJ0aWVzICs9IGdkcm0tPm51
bV9wcm9wZXJ0aWVzOworCisJbGVuID0gc3RydWN0X3NpemUocmVxLCBwcm9wZXJ0aWVzLCBudW1f
cHJvcGVydGllcyk7CisJcmVxID0ga3phbGxvYyhsZW4sIEdGUF9LRVJORUwpOworCWlmICghcmVx
KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWd1ZF9mcm9tX2Rpc3BsYXlfbW9kZSgmcmVxLT5tb2Rl
LCBtb2RlKTsKKworCXJlcS0+Zm9ybWF0ID0gZ3VkX2Zyb21fZm91cmNjKGZvcm1hdC0+Zm9ybWF0
KTsKKwlpZiAoV0FSTl9PTl9PTkNFKCFyZXEtPmZvcm1hdCkpCisJCXJldHVybiAtRUlOVkFMOwor
CisJcmVxLT5jb25uZWN0b3IgPSBkcm1fY29ubmVjdG9yX2luZGV4KGNvbm5lY3Rvcik7CisJcmVx
LT5udW1fcHJvcGVydGllcyA9IG51bV9wcm9wZXJ0aWVzOworCisJbnVtX3Byb3BlcnRpZXMgPSBn
dWRfY29ubmVjdG9yX2ZpbGxfcHJvcGVydGllcyhjb25uZWN0b3IsIGNvbm5lY3Rvcl9zdGF0ZSwK
KwkJCQkJCSAgICAgICByZXEtPnByb3BlcnRpZXMpOworCisJZm9yIChpID0gMDsgaSA8IGdkcm0t
Pm51bV9wcm9wZXJ0aWVzOyBpKyspIHsKKwkJdTE2IHByb3AgPSBnZHJtLT5wcm9wZXJ0aWVzW2ld
OworCQl1NjQgdmFsOworCisJCXN3aXRjaCAocHJvcCkgeworCQljYXNlIEdVRF9QUk9QRVJUWV9S
T1RBVElPTjoKKwkJCS8qIERSTSBVQVBJIG1hdGNoZXMgdGhlIHByb3RvY29sIHNvIHVzZSB2YWx1
ZSBkaXJlY3RseSAqLworCQkJdmFsID0gbmV3X3BsYW5lX3N0YXRlLT5yb3RhdGlvbjsKKwkJCWJy
ZWFrOworCQlkZWZhdWx0OgorCQkJV0FSTl9PTl9PTkNFKDEpOworCQkJcmV0ID0gLUVJTlZBTDsK
KwkJCWdvdG8gb3V0OworCQl9CisKKwkJcmVxLT5wcm9wZXJ0aWVzW251bV9wcm9wZXJ0aWVzICsg
aV0ucHJvcCA9IGNwdV90b19sZTE2KHByb3ApOworCQlyZXEtPnByb3BlcnRpZXNbbnVtX3Byb3Bl
cnRpZXMgKyBpXS52YWwgPSBjcHVfdG9fbGU2NCh2YWwpOworCX0KKworCWlmIChkcm1fZGV2X2Vu
dGVyKGZiLT5kZXYsICZpZHgpKSB7CisJCXJldCA9IGd1ZF91c2Jfc2V0KGdkcm0sIEdVRF9SRVFf
U0VUX1NUQVRFX0NIRUNLLCAwLCByZXEsIGxlbik7CisJCWRybV9kZXZfZXhpdChpZHgpOworCX0g
IGVsc2UgeworCQlyZXQgPSAtRU5PREVWOworCX0KK291dDoKKwlrZnJlZShyZXEpOworCisJcmV0
dXJuIHJldDsKK30KKwordm9pZCBndWRfcGlwZV91cGRhdGUoc3RydWN0IGRybV9zaW1wbGVfZGlz
cGxheV9waXBlICpwaXBlLAorCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9zdGF0
ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gcGlwZS0+Y3J0Yy5kZXY7CisJc3RydWN0
IGd1ZF9kZXZpY2UgKmdkcm0gPSB0b19ndWRfZGV2aWNlKGRybSk7CisJc3RydWN0IGRybV9wbGFu
ZV9zdGF0ZSAqc3RhdGUgPSBwaXBlLT5wbGFuZS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHN0YXRlLT5mYjsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAmcGlwZS0+Y3J0
YzsKKwlzdHJ1Y3QgZHJtX3JlY3QgZGFtYWdlOworCWludCBpZHg7CisKKwlpZiAoY3J0Yy0+c3Rh
dGUtPm1vZGVfY2hhbmdlZCB8fCAhY3J0Yy0+c3RhdGUtPmVuYWJsZSkgeworCQljYW5jZWxfd29y
a19zeW5jKCZnZHJtLT53b3JrKTsKKwkJbXV0ZXhfbG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOwor
CQlpZiAoZ2RybS0+ZmIpIHsKKwkJCWRybV9mcmFtZWJ1ZmZlcl9wdXQoZ2RybS0+ZmIpOworCQkJ
Z2RybS0+ZmIgPSBOVUxMOworCQl9CisJCWd1ZF9jbGVhcl9kYW1hZ2UoZ2RybSk7CisJCW11dGV4
X3VubG9jaygmZ2RybS0+ZGFtYWdlX2xvY2spOworCX0KKworCWlmICghZHJtX2Rldl9lbnRlcihk
cm0sICZpZHgpKQorCQlyZXR1cm47CisKKwlpZiAoIW9sZF9zdGF0ZS0+ZmIpCisJCWd1ZF91c2Jf
d3JpdGU4KGdkcm0sIEdVRF9SRVFfU0VUX0NPTlRST0xMRVJfRU5BQkxFLCAxKTsKKworCWlmIChm
YiAmJiAoY3J0Yy0+c3RhdGUtPm1vZGVfY2hhbmdlZCB8fCBjcnRjLT5zdGF0ZS0+Y29ubmVjdG9y
c19jaGFuZ2VkKSkKKwkJZ3VkX3VzYl9zZXQoZ2RybSwgR1VEX1JFUV9TRVRfU1RBVEVfQ09NTUlU
LCAwLCBOVUxMLCAwKTsKKworCWlmIChjcnRjLT5zdGF0ZS0+YWN0aXZlX2NoYW5nZWQpCisJCWd1
ZF91c2Jfd3JpdGU4KGdkcm0sIEdVRF9SRVFfU0VUX0RJU1BMQVlfRU5BQkxFLCBjcnRjLT5zdGF0
ZS0+YWN0aXZlKTsKKworCWlmIChkcm1fYXRvbWljX2hlbHBlcl9kYW1hZ2VfbWVyZ2VkKG9sZF9z
dGF0ZSwgc3RhdGUsICZkYW1hZ2UpKSB7CisJCWlmIChnZHJtLT5mbGFncyAmIEdVRF9ESVNQTEFZ
X0ZMQUdfRlVMTF9VUERBVEUpCisJCQlkcm1fcmVjdF9pbml0KCZkYW1hZ2UsIDAsIDAsIGZiLT53
aWR0aCwgZmItPmhlaWdodCk7CisJCWd1ZF9mYl9xdWV1ZV9kYW1hZ2UoZ2RybSwgZmIsICZkYW1h
Z2UpOworCX0KKworCWlmICghY3J0Yy0+c3RhdGUtPmVuYWJsZSkKKwkJZ3VkX3VzYl93cml0ZTgo
Z2RybSwgR1VEX1JFUV9TRVRfQ09OVFJPTExFUl9FTkFCTEUsIDApOworCisJZHJtX2Rldl9leGl0
KGlkeCk7Cit9CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9ndWQuaCBiL2luY2x1ZGUvZHJtL2d1
ZC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNzIwMDI5NmY0NmIz
Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS9kcm0vZ3VkLmgKQEAgLTAsMCArMSwzNTYgQEAK
Ky8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgMjAy
MCBOb3JhbGYgVHLDuG5uZXMKKyAqLworCisjaWZuZGVmIF9fTElOVVhfR1VEX0gKKyNkZWZpbmUg
X19MSU5VWF9HVURfSAorCisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKworLyoKKyAqIHN0cnVj
dCBndWRfZGlzcGxheV9kZXNjcmlwdG9yX3JlcSAtIERpc3BsYXkgZGVzY3JpcHRvcgorICogQG1h
Z2ljOiBNYWdpYyB2YWx1ZSBHVURfRElTUExBWV9NQUdJQworICogQHZlcnNpb246IFByb3RvY29s
IHZlcnNpb24KKyAqIEBmbGFnczogRmxhZ3MKKyAqICAgICAgICAgLSBTVEFUVVNfT05fU0VUOiBB
bHdheXMgZG8gYSBzdGF0dXMgcmVxdWVzdCBhZnRlciBhIFNFVCByZXF1ZXN0LgorICogICAgICAg
ICAgICAgICAgICAgICAgICAgIFRoaXMgaXMgdXNlZCBieSB0aGUgTGludXggZ2FkZ2V0IGRyaXZl
ciBzaW5jZSBpdCBoYXMKKyAqICAgICAgICAgICAgICAgICAgICAgICAgICBubyB3YXkgdG8gY29u
dHJvbCB0aGUgc3RhdHVzIHN0YWdlIG9mIGEgY29udHJvbCBPVVQKKyAqICAgICAgICAgICAgICAg
ICAgICAgICAgICByZXF1ZXN0IHRoYXQgaGFzIGEgcGF5bG9hZC4KKyAqICAgICAgICAgLSBGVUxM
X1VQREFURTogICBBbHdheXMgc2VuZCB0aGUgZW50aXJlIGZyYW1lYnVmZmVyIHdoZW4gZmx1c2hp
bmcgY2hhbmdlcy4KKyAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgR1VEX1JFUV9TRVRf
QlVGRkVSIHJlcXVlc3Qgd2lsbCBub3QgYmUgc2VudAorICogICAgICAgICAgICAgICAgICAgICAg
ICAgIGJlZm9yZSBlYWNoIGJ1bGsgdHJhbnNmZXIsIGl0IHdpbGwgb25seSBiZSBzZW50IGlmIHRo
ZQorICogICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzIGJ1bGsgdHJhbnNmZXIgaGFk
IGZhaWxlZC4gVGhpcyBnaXZlcyB0aGUgZGV2aWNlCisgKiAgICAgICAgICAgICAgICAgICAgICAg
ICAgYSBjaGFuY2UgdG8gcmVzZXQgaXRzIHN0YXRlIG1hY2hpbmUgaWYgbmVlZGVkLgorICogICAg
ICAgICAgICAgICAgICAgICAgICAgIFRoaXMgZmxhZyBjYW4gbm90IGJlIHVzZWQgaW4gY29tYmlu
YXRpb24gd2l0aCBjb21wcmVzc2lvbi4KKyAqIEBjb21wcmVzc2lvbjogU3VwcG9ydGVkIGNvbXBy
ZXNzaW9uIHR5cGVzCisgKiAgICAgICAgICAgICAgIC0gR1VEX0NPTVBSRVNTSU9OX0xaNDogTFo0
IGxvc3NsZXNzIGNvbXByZXNzaW9uLgorICogQG1heF9idWZmZXJfc2l6ZTogTWF4aW11bSBidWZm
ZXIgc2l6ZSB0aGUgZGV2aWNlIGNhbiBoYW5kbGUgKG9wdGlvbmFsKS4KKyAqICAgICAgICAgICAg
ICAgICAgIFRoaXMgaXMgdXNlZnVsIGZvciBkZXZpY2VzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJpZyBl
bm91Z2gKKyAqICAgICAgICAgICAgICAgICAgIGJ1ZmZlciB0byBkZWNvbXByZXNzIHRoZSBlbnRp
cmUgZnJhbWVidWZmZXIgaW4gb25lIGdvLgorICogQG1pbl93aWR0aDogTWluaW11bSBwaXhlbCB3
aWR0aCB0aGUgY29udHJvbGxlciBjYW4gaGFuZGxlCisgKiBAbWF4X3dpZHRoOiBNYXhpbXVtIHdp
ZHRoCisgKiBAbWluX2hlaWdodDogTWluaW11bSBoZWlnaHQKKyAqIEBtYXhfaGVpZ2h0OiBNYXhp
bXVtIGhlaWdodAorICogQG51bV9mb3JtYXRzOiBOdW1iZXIgb2Ygc3VwcG9ydGVkIHBpeGVsIGZv
cm1hdHMKKyAqIEBudW1fcHJvcGVydGllczogTnVtYmVyIG9mIHByb3BlcnRpZXMgdGhhdCBhcmUg
bm90IGNvbm5lY3RvciBwcm9wZXJ0aWVzCisgKiBAbnVtX2Nvbm5lY3RvcnM6IE51bWJlciBvZiBj
b25uZWN0b3JzCisgKgorICogRGV2aWNlcyB0aGF0IGhhdmUgb25seSBvbmUgZGlzcGxheSBtb2Rl
IHdpbGwgaGF2ZSBtaW5fd2lkdGggPT0gbWF4X3dpZHRoCisgKiBhbmQgbWluX2hlaWdodCA9PSBt
YXhfaGVpZ2h0LgorICovCitzdHJ1Y3QgZ3VkX2Rpc3BsYXlfZGVzY3JpcHRvcl9yZXEgeworCV9f
bGUzMiBtYWdpYzsKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTUFHSUMJCQkweDFkNTA2MTRkCisJX191
OCB2ZXJzaW9uOworCV9fbGUzMiBmbGFnczsKKyNkZWZpbmUgR1VEX0RJU1BMQVlfRkxBR19TVEFU
VVNfT05fU0VUCQlCSVQoMCkKKyNkZWZpbmUgR1VEX0RJU1BMQVlfRkxBR19GVUxMX1VQREFURQkJ
QklUKDEpCisJX191OCBjb21wcmVzc2lvbjsKKyNkZWZpbmUgR1VEX0NPTVBSRVNTSU9OX0xaNAkJ
CUJJVCgwKQorCV9fbGUzMiBtYXhfYnVmZmVyX3NpemU7CisJX19sZTMyIG1pbl93aWR0aDsKKwlf
X2xlMzIgbWF4X3dpZHRoOworCV9fbGUzMiBtaW5faGVpZ2h0OworCV9fbGUzMiBtYXhfaGVpZ2h0
OworCV9fdTggbnVtX2Zvcm1hdHM7CisJX191OCBudW1fcHJvcGVydGllczsKKwlfX3U4IG51bV9j
b25uZWN0b3JzOworfSBfX3BhY2tlZDsKKworLyoKKyAqIHN0cnVjdCBndWRfcHJvcGVydHlfcmVx
IC0gUHJvcGVydHkKKyAqIEBwcm9wOiBQcm9wZXJ0eQorICogQHZhbDogVmFsdWUKKyAqLworc3Ry
dWN0IGd1ZF9wcm9wZXJ0eV9yZXEgeworCV9fbGUxNiBwcm9wOworCV9fbGU2NCB2YWw7Cit9IF9f
cGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9kaXNwbGF5X21vZGVfcmVxIC0gRGlzcGxheSBt
b2RlCisgKiBAY2xvY2s6IFBpeGVsIGNsb2NrIGluIGtIegorICogQGhkaXNwbGF5OiBIb3Jpem9u
dGFsIGRpc3BsYXkgc2l6ZQorICogQGhzeW5jX3N0YXJ0OiBIb3Jpem9udGFsIHN5bmMgc3RhcnQK
KyAqIEBoc3luY19lbmQ6IEhvcml6b250YWwgc3luYyBlbmQKKyAqIEBodG90YWw6IEhvcml6b250
YWwgdG90YWwgc2l6ZQorICogQHZkaXNwbGF5OiBWZXJ0aWNhbCBkaXNwbGF5IHNpemUKKyAqIEB2
c3luY19zdGFydDogVmVydGljYWwgc3luYyBzdGFydAorICogQHZzeW5jX2VuZDogVmVydGljYWwg
c3luYyBlbmQKKyAqIEB2dG90YWw6IFZlcnRpY2FsIHRvdGFsIHNpemUKKyAqIEBmbGFnczogQml0
cyAwLTEzIGFyZSB0aGUgc2FtZSBhcyBpbiB0aGUgUmFuZFIgcHJvdG9jb2wgYW5kIGFsc28gd2hh
dCBEUk0gdXNlcy4KKyAqICAgICAgICAgVGhlIGRlcHJlY2F0ZWQgYml0cyBhcmUgcmV1c2VkIGZv
ciBpbnRlcm5hbCBwcm90b2NvbCBmbGFncyBsZWF2aW5nIHVzCisgKiAgICAgICAgIGZyZWUgdG8g
Zm9sbG93IERSTSBmb3IgdGhlIG90aGVyIGJpdHMgaW4gdGhlIGZ1dHVyZS4KKyAqICAgICAgICAg
LSBGTEFHX1BSRUZFUlJFRDogU2V0IG9uIHRoZSBwcmVmZXJyZWQgZGlzcGxheSBtb2RlLgorICov
CitzdHJ1Y3QgZ3VkX2Rpc3BsYXlfbW9kZV9yZXEgeworCV9fbGUzMiBjbG9jazsKKwlfX2xlMTYg
aGRpc3BsYXk7CisJX19sZTE2IGhzeW5jX3N0YXJ0OworCV9fbGUxNiBoc3luY19lbmQ7CisJX19s
ZTE2IGh0b3RhbDsKKwlfX2xlMTYgdmRpc3BsYXk7CisJX19sZTE2IHZzeW5jX3N0YXJ0OworCV9f
bGUxNiB2c3luY19lbmQ7CisJX19sZTE2IHZ0b3RhbDsKKwlfX2xlMzIgZmxhZ3M7CisjZGVmaW5l
IEdVRF9ESVNQTEFZX01PREVfRkxBR19QSFNZTkMJCUJJVCgwKQorI2RlZmluZSBHVURfRElTUExB
WV9NT0RFX0ZMQUdfTkhTWU5DCQlCSVQoMSkKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTU9ERV9GTEFH
X1BWU1lOQwkJQklUKDIpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19OVlNZTkMJCUJJ
VCgzKQorI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdfSU5URVJMQUNFCQlCSVQoNCkKKyNk
ZWZpbmUgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0RCTFNDQU4JCUJJVCg1KQorI2RlZmluZSBHVURf
RElTUExBWV9NT0RFX0ZMQUdfQ1NZTkMJCUJJVCg2KQorI2RlZmluZSBHVURfRElTUExBWV9NT0RF
X0ZMQUdfUENTWU5DCQlCSVQoNykKKyNkZWZpbmUgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX05DU1lO
QwkJQklUKDgpCisjZGVmaW5lIEdVRF9ESVNQTEFZX01PREVfRkxBR19IU0tFVwkJQklUKDkpCisv
KiBCQ2FzdCBhbmQgUGl4ZWxNdWx0aXBsZXggYXJlIGRlcHJlY2F0ZWQgKi8KKyNkZWZpbmUgR1VE
X0RJU1BMQVlfTU9ERV9GTEFHX0RCTENMSwkJQklUKDEyKQorI2RlZmluZSBHVURfRElTUExBWV9N
T0RFX0ZMQUdfQ0xLRElWMgkJQklUKDEzKQorI2RlZmluZSBHVURfRElTUExBWV9NT0RFX0ZMQUdf
VVNFUl9NQVNLCQlcCisJCShHVURfRElTUExBWV9NT0RFX0ZMQUdfUEhTWU5DIHwgR1VEX0RJU1BM
QVlfTU9ERV9GTEFHX05IU1lOQyB8IFwKKwkJR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BWU1lOQyB8
IEdVRF9ESVNQTEFZX01PREVfRkxBR19OVlNZTkMgfCBcCisJCUdVRF9ESVNQTEFZX01PREVfRkxB
R19JTlRFUkxBQ0UgfCBHVURfRElTUExBWV9NT0RFX0ZMQUdfREJMU0NBTiB8IFwKKwkJR1VEX0RJ
U1BMQVlfTU9ERV9GTEFHX0NTWU5DIHwgR1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BDU1lOQyB8IFwK
KwkJR1VEX0RJU1BMQVlfTU9ERV9GTEFHX05DU1lOQyB8IEdVRF9ESVNQTEFZX01PREVfRkxBR19I
U0tFVyB8IFwKKwkJR1VEX0RJU1BMQVlfTU9ERV9GTEFHX0RCTENMSyB8IEdVRF9ESVNQTEFZX01P
REVfRkxBR19DTEtESVYyKQorLyogSW50ZXJuYWwgcHJvdG9jb2wgZmxhZ3MgKi8KKyNkZWZpbmUg
R1VEX0RJU1BMQVlfTU9ERV9GTEFHX1BSRUZFUlJFRAkJQklUKDEwKQorfSBfX3BhY2tlZDsKKwor
LyoKKyAqIHN0cnVjdCBndWRfY29ubmVjdG9yX2Rlc2NyaXB0b3JfcmVxIC0gQ29ubmVjdG9yIGRl
c2NyaXB0b3IKKyAqIEBjb25uZWN0b3JfdHlwZTogQ29ubmVjdG9yIHR5cGUgKEdVRF9DT05ORUNU
T1JfVFlQRV8qKS4KKyAqICAgICAgICAgICAgICAgICAgSWYgdGhlIGhvc3QgZG9lc24ndCBzdXBw
b3J0IHRoZSB0eXBlIGl0IHNob3VsZCBmYWxsIGJhY2sgdG8gUEFORUwuCisgKiBAZmxhZ3M6IEZs
YWdzCisgKiAgICAgICAgIC0gUE9MTF9TVEFUVVM6IENvbm5lY3RvciBzdGF0dXMgY2FuIGNoYW5n
ZSAocG9sbGVkIGV2ZXJ5IDEwIHNlY29uZHMpCisgKiAgICAgICAgIC0gSU5URVJMQUNFOiBJbnRl
cmxhY2VkIG1vZGVzIGFyZSBzdXBwb3J0ZWQKKyAqICAgICAgICAgLSBET1VCTEVTQ0FOOiBEb3Vi
bGVzY2FuIG1vZGVzIGFyZSBzdXBwb3J0ZWQKKyAqIEBudW1fcHJvcGVydGllczogTnVtYmVyIG9m
IHN1cHBvcnRlZCBwcm9wZXJ0aWVzCisgKi8KK3N0cnVjdCBndWRfY29ubmVjdG9yX2Rlc2NyaXB0
b3JfcmVxIHsKKwlfX3U4IGNvbm5lY3Rvcl90eXBlOworI2RlZmluZSBHVURfQ09OTkVDVE9SX1RZ
UEVfUEFORUwJCTAKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9UWVBFX1ZHQQkJCTEKKyNkZWZpbmUg
R1VEX0NPTk5FQ1RPUl9UWVBFX0NPTVBPU0lURQkJMgorI2RlZmluZSBHVURfQ09OTkVDVE9SX1RZ
UEVfU1ZJREVPCQkzCisjZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9DT01QT05FTlQJCTQKKyNk
ZWZpbmUgR1VEX0NPTk5FQ1RPUl9UWVBFX0RWSQkJCTUKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9U
WVBFX0RJU1BMQVlQT1JUCQk2CisjZGVmaW5lIEdVRF9DT05ORUNUT1JfVFlQRV9IRE1JCQkJNwor
CV9fbGUzMiBmbGFnczsKKyNkZWZpbmUgR1VEX0NPTk5FQ1RPUl9GTEFHU19QT0xMX1NUQVRVUwkJ
QklUKDApCisjZGVmaW5lIEdVRF9DT05ORUNUT1JfRkxBR1NfSU5URVJMQUNFCQlCSVQoMSkKKyNk
ZWZpbmUgR1VEX0NPTk5FQ1RPUl9GTEFHU19ET1VCTEVTQ0FOCQlCSVQoMikKKwlfX3U4IG51bV9w
cm9wZXJ0aWVzOworfSBfX3BhY2tlZDsKKworLyoKKyAqIHN0cnVjdCBndWRfY29ubmVjdG9yX3N0
YXR1c19yZXEgLSBDb25uZWN0b3Igc3RhdHVzCisgKiBAc3RhdHVzOiBTdGF0dXMKKyAqICAgICAg
ICAgIC0gRElTQ09OTkVDVEVEOiBDb25uZWN0b3IgaXMgZGlzY29ubmVjdGVkCisgKiAgICAgICAg
ICAtIENPTk5FQ1RFRDogQ29ubmVjdG9yIGlzIGNvbm5lY3RlZAorICogICAgICAgICAgLSBVTktO
T1dOOiBDb25uZWN0aW9uIHN0YXR1cyBpcyB1bmtub3duCisgKiAgICAgICAgICBGbGFnczoKKyAq
ICAgICAgICAgIC0gQ0hBTkdFRDogQSBjaGFuZ2UgaGFzIGhhcHBlbmVkIHNpbmNlIHRoZSBsYXN0
IHJlcXVlc3QKKyAqIEBudW1fbW9kZXM6IE51bWJlciBvZiBhdmFpbGFibGUgZGlzcGxheSBtb2Rl
cworICogQGVkaWRfbGVuOiBMZW5ndGggb2YgRURJRCBkYXRhCisgKgorICogSWYgQG51bV9tb2Rl
cyBpcyB6ZXJvLCBFRElEIGlzIHVzZWQgdG8gY3JlYXRlIGRpc3BsYXkgbW9kZXMuCisgKiBJZiBi
b3RoIEBudW1fbW9kZXMgYW5kIEBlZGlkX2xlbiBhcmUgc2V0LCBFRElEIGlzIGp1c3QgcGFzc2Vk
IG9uIHRvIHVzZXJzcGFjZQorICogaW4gdGhlIEVESUQgY29ubmVjdG9yIHByb3BlcnR5LgorICoK
KyAqIFVzZXJzcGFjZSB3aWxsIGdldCBhIEhPVFBMVUcgdWV2ZW50IGlmIG9uZSBvZiB0aGUgZm9s
bG93aW5nIGlzIHRydWU6CisgKiAtIENvbm5lY3Rpb24gc3RhdHVzIGhhcyBjaGFuZ2VkCisgKiAt
IEBudW1fbW9kZXMgb3IgQGVkaWRfbGVuIGhhcyBjaGFuZ2VkCisgKiAtIENIQU5HRUQgaXMgc2V0
CisgKi8KK3N0cnVjdCBndWRfY29ubmVjdG9yX3N0YXR1c19yZXEgeworCV9fdTggc3RhdHVzOwor
I2RlZmluZSBHVURfQ09OTkVDVE9SX1NUQVRVU19ESVNDT05ORUNURUQJMHgwMAorI2RlZmluZSBH
VURfQ09OTkVDVE9SX1NUQVRVU19DT05ORUNURUQJCTB4MDEKKyNkZWZpbmUgR1VEX0NPTk5FQ1RP
Ul9TVEFUVVNfVU5LTk9XTgkJMHgwMgorI2RlZmluZSBHVURfQ09OTkVDVE9SX1NUQVRVU19DT05O
RUNURURfTUFTSwkweDAzCisjZGVmaW5lIEdVRF9DT05ORUNUT1JfU1RBVFVTX0NIQU5HRUQJCUJJ
VCg3KQorCV9fbGUxNiBudW1fbW9kZXM7CisJX19sZTE2IGVkaWRfbGVuOworfSBfX3BhY2tlZDsK
KworLyoKKyAqIHN0cnVjdCBndWRfc2V0X2J1ZmZlcl9yZXEgLSBTZXQgYnVmZmVyIHRyYW5zZmVy
IGluZm8KKyAqIEB4OiBYIHBvc2l0aW9uIG9mIHJlY3RhbmdsZQorICogQHk6IFkgcG9zaXRpb24K
KyAqIEB3aWR0aDogUGl4ZWwgd2lkdGggb2YgcmVjdGFuZ2xlCisgKiBAaGVpZ2h0OiBQaXhlbCBo
ZWlnaHQKKyAqIEBsZW5ndGg6IEJ1ZmZlciBsZW5ndGggaW4gYnl0ZXMKKyAqIEBjb21wcmVzc2lv
bjogVHJhbnNmZXIgY29tcHJlc3Npb24KKyAqIEBjb21wcmVzc2VkX2xlbmd0aDogQ29tcHJlc3Nl
ZCBidWZmZXIgbGVuZ3RoCisgKgorICogVGhpcyByZXF1ZXN0IGlzIGlzc3VlZCByaWdodCBiZWZv
cmUgdGhlIGJ1bGsgdHJhbnNmZXIuCisgKiBAeCwgQHksIEB3aWR0aCBhbmQgQGhlaWdodCBzcGVj
aWZpZXMgdGhlIHJlY3RhbmdsZSB3aGVyZSB0aGUgYnVmZmVyIHNob3VsZCBiZQorICogcGxhY2Vk
IGluc2lkZSB0aGUgZnJhbWVidWZmZXIuCisgKi8KK3N0cnVjdCBndWRfc2V0X2J1ZmZlcl9yZXEg
eworCV9fbGUzMiB4OworCV9fbGUzMiB5OworCV9fbGUzMiB3aWR0aDsKKwlfX2xlMzIgaGVpZ2h0
OworCV9fbGUzMiBsZW5ndGg7CisJX191OCBjb21wcmVzc2lvbjsKKwlfX2xlMzIgY29tcHJlc3Nl
ZF9sZW5ndGg7Cit9IF9fcGFja2VkOworCisvKgorICogc3RydWN0IGd1ZF9zdGF0ZV9yZXEgLSBE
aXNwbGF5IHN0YXRlCisgKiBAbW9kZTogRGlzcGxheSBtb2RlCisgKiBAZm9ybWF0OiBQaXhlbCBm
b3JtYXQgR1VEX1BJWEVMX0ZPUk1BVF8qCisgKiBAY29ubmVjdG9yOiBDb25uZWN0b3IgaW5kZXgK
KyAqIEBudW1fcHJvcGVydGllczogTnVtYmVyIG9mIHByb3BlcnRpZXMgaW4gdGhlIHN0YXRlCisg
KiBAcHJvcGVydGllczogQXJyYXkgb2YgcHJvcGVydGllcworICoKKyAqIFRoZSBlbnRpcmUgc3Rh
dGUgaXMgdHJhbnNmZXJyZWQgZWFjaCB0aW1lIHRoZXJlJ3MgYSBjaGFuZ2UuCisgKi8KK3N0cnVj
dCBndWRfc3RhdGVfcmVxIHsKKwlzdHJ1Y3QgZ3VkX2Rpc3BsYXlfbW9kZV9yZXEgbW9kZTsKKwlf
X3U4IGZvcm1hdDsKKwlfX3U4IGNvbm5lY3RvcjsKKwlfX3U4IG51bV9wcm9wZXJ0aWVzOworCXN0
cnVjdCBndWRfcHJvcGVydHlfcmVxIHByb3BlcnRpZXNbXTsKK30gX19wYWNrZWQ7CisKKy8qIExp
c3Qgb2Ygc3VwcG9ydGVkIGNvbm5lY3RvciBwcm9wZXJ0aWVzOiAqLworCisvKiBNYXJnaW5zIGlu
IHBpeGVscyB0byBkZWFsIHdpdGggb3ZlcnNjYW4sIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdV
RF9QUk9QRVJUWV9UVl9MRUZUX01BUkdJTgkJCTEKKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX1JJ
R0hUX01BUkdJTgkJCTIKKyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX1RPUF9NQVJHSU4JCQkzCisj
ZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9CT1RUT01fTUFSR0lOCQkJNAorLyogTnVtYmVyIG9mIG1v
ZGVzIGFyZSBwbGFjZWQgYXQgX1NISUZUIGluIHZhbCBvbiByZXRyaWV2YWwgKi8KKyNkZWZpbmUg
R1VEX1BST1BFUlRZX1RWX01PREUJCQkJNQorICAjZGVmaW5lIEdVRF9DT05ORUNUT1JfVFZfTU9E
RV9OVU1fU0hJRlQJMTYKKy8qIEJyaWdodG5lc3MgaW4gcGVyY2VudCwgcmFuZ2UgMC0xMDAgKi8K
KyNkZWZpbmUgR1VEX1BST1BFUlRZX1RWX0JSSUdIVE5FU1MJCQk2CisvKiBDb250cmFzdCBpbiBw
ZXJjZW50LCByYW5nZSAwLTEwMCAqLworI2RlZmluZSBHVURfUFJPUEVSVFlfVFZfQ09OVFJBU1QJ
CQk3CisvKiBGbGlja2VyIHJlZHVjdGlvbiBpbiBwZXJjZW50LCByYW5nZSAwLTEwMCAqLworI2Rl
ZmluZSBHVURfUFJPUEVSVFlfVFZfRkxJQ0tFUl9SRURVQ1RJT04JCTgKKy8qIE92ZXJzY2FuIGlu
IHBlcmNlbnQsIHJhbmdlIDAtMTAwICovCisjZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9PVkVSU0NB
TgkJCTkKKy8qIFNhdHVyYXRpb24gaW4gcGVyY2VudCwgcmFuZ2UgMC0xMDAgKi8KKyNkZWZpbmUg
R1VEX1BST1BFUlRZX1RWX1NBVFVSQVRJT04JCQkxMAorLyogSHVlIGluIHBlcmNlbnQsIHJhbmdl
IDAtMTAwICovCisjZGVmaW5lIEdVRF9QUk9QRVJUWV9UVl9IVUUJCQkJMTEKKworLyoKKyAqIEJh
Y2tsaWdodCBicmlnaHRuZXNzIGlzIGluIHRoZSByYW5nZSAwLTEwMCBpbmNsdXNpdmUuIFRoZSB2
YWx1ZSByZXByZXNlbnRzIHRoZSBodW1hbiBwZXJjZXB0dWFsCisgKiBicmlnaHRuZXNzIGFuZCBu
b3QgYSBsaW5lYXIgUFdNIHZhbHVlLiAwIGlzIG1pbmltdW0gYnJpZ2h0bmVzcyB3aGljaCBzaG91
bGQgbm90IHR1cm4gdGhlCisgKiBiYWNrbGlnaHQgY29tcGxldGVseSBvZmYuIFRoZSBEUE1TIGNv
bm5lY3RvciBwcm9wZXJ0eSBzaG91bGQgYmUgdXNlZCB0byBjb250cm9sIHBvd2VyIHdoaWNoIHdp
bGwKKyAqIHRyaWdnZXIgYSBHVURfUkVRX1NFVF9ESVNQTEFZX0VOQUJMRSByZXF1ZXN0LgorICoK
KyAqIFRoaXMgZG9lcyBub3QgbWFwIHRvIGEgRFJNIHByb3BlcnR5LCBpdCBpcyB1c2VkIHdpdGgg
dGhlIGJhY2tsaWdodCBkZXZpY2UuCisgKi8KKyNkZWZpbmUgR1VEX1BST1BFUlRZX0JBQ0tMSUdI
VF9CUklHSFRORVNTCQkxMgorCisvKiBMaXN0IG9mIHN1cHBvcnRlZCBwcm9wZXJ0aWVzIHRoYXQg
YXJlIG5vdCBjb25uZWN0b3IgcHJvcGV0aWVzOiAqLworCisvKgorICogUGxhbmUgcm90YXRpb24u
IFNob3VsZCByZXR1cm4gdGhlIHN1cHBvcnRlZCBiaXRtYXNrIG9uCisgKiBHVURfUkVRX0dFVF9Q
Uk9QRVJUSUVTLiBHVURfUk9UQVRJT05fMCBpcyBtYW5kYXRvcnkuCisgKgorICogTm90ZTogVGhp
cyBpcyBub3QgZGlzcGxheSByb3RhdGlvbiBzbyA5MC8yNzAgd2lsbCBuZWVkIHNjYWxpbmcgdG8g
bWFrZSBpdCBmaXQgKHVubGVzcyBzcXVhcmVkKS4KKyAqLworI2RlZmluZSBHVURfUFJPUEVSVFlf
Uk9UQVRJT04JCQkJNTAKKyAgI2RlZmluZSBHVURfUk9UQVRJT05fMAkJCUJJVCgwKQorICAjZGVm
aW5lIEdVRF9ST1RBVElPTl85MAkJCUJJVCgxKQorICAjZGVmaW5lIEdVRF9ST1RBVElPTl8xODAJ
CQlCSVQoMikKKyAgI2RlZmluZSBHVURfUk9UQVRJT05fMjcwCQkJQklUKDMpCisgICNkZWZpbmUg
R1VEX1JPVEFUSU9OX1JFRkxFQ1RfWAkJQklUKDQpCisgICNkZWZpbmUgR1VEX1JPVEFUSU9OX1JF
RkxFQ1RfWQkJQklUKDUpCisgICNkZWZpbmUgR1VEX1JPVEFUSU9OX01BU0sJCQkoR1VEX1JPVEFU
SU9OXzAgfCBHVURfUk9UQVRJT05fOTAgfCBcCisJCQkJCQlHVURfUk9UQVRJT05fMTgwIHwgR1VE
X1JPVEFUSU9OXzI3MCB8IFwKKwkJCQkJCUdVRF9ST1RBVElPTl9SRUZMRUNUX1ggfCBHVURfUk9U
QVRJT05fUkVGTEVDVF9ZKQorCisvKiBVU0IgQ29udHJvbCByZXF1ZXN0czogKi8KKworLyogR2V0
IHN0YXR1cyBmcm9tIHRoZSBsYXN0IEdFVC9TRVQgY29udHJvbCByZXF1ZXN0LiBWYWx1ZSBpcyB1
OC4gKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfU1RBVFVTCQkJCTB4MDAKKyAgLyogU3RhdHVzIHZh
bHVlczogKi8KKyAgI2RlZmluZSBHVURfU1RBVFVTX09LCQkJCTB4MDAKKyAgI2RlZmluZSBHVURf
U1RBVFVTX0JVU1kJCQkweDAxCisgICNkZWZpbmUgR1VEX1NUQVRVU19SRVFVRVNUX05PVF9TVVBQ
T1JURUQJMHgwMgorICAjZGVmaW5lIEdVRF9TVEFUVVNfUFJPVE9DT0xfRVJST1IJCTB4MDMKKyAg
I2RlZmluZSBHVURfU1RBVFVTX0lOVkFMSURfUEFSQU1FVEVSCQkweDA0CisgICNkZWZpbmUgR1VE
X1NUQVRVU19FUlJPUgkJCTB4MDUKKworLyogR2V0IGRpc3BsYXkgZGVzY3JpcHRvciBhcyBhICZn
dWRfZGlzcGxheV9kZXNjcmlwdG9yX3JlcSAqLworI2RlZmluZSBHVURfUkVRX0dFVF9ERVNDUklQ
VE9SCQkJCTB4MDEKKworLyoKKyAqIElmIHRoZSBob3N0IGRyaXZlciBkb2Vzbid0IHN1cHBvcnQg
dGhlIGRldmljZSBwcm90b2NvbCB2ZXJzaW9uIGl0IHdpbGwgc2VuZCB0aGUgdmVyc2lvbnMgaXQK
KyAqIHN1cHBvcnRzIHN0YXJ0aW5nIHdpdGggdGhlIGxhdGVzdC4gSWYgdGhlIGRldmljZSBpc24n
dCBiYWNrd2FyZHMgY29tcGF0aWJsZSBvciBkb2Vzbid0IHN1cHBvcnQKKyAqIHRoZSB2ZXJzaW9u
IHRoZSBob3N0IHN1Z2dlc3RzLCBpdCBzaGFsbCBzdGFsbCB0aGUgcmVxdWVzdC4gVGhlIHZlcnNp
b24gaXMgc2VudCBhcyB1OC4KKyAqLworI2RlZmluZSBHVURfUkVRX1NFVF9WRVJTSU9OCQkJCTB4
MzAKKworLyogR2V0IHN1cHBvcnRlZCBwaXhlbCBmb3JtYXRzIGFzIGEgYnl0ZSBhcnJheSBvZiBH
VURfUElYRUxfRk9STUFUXyogKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfRk9STUFUUwkJCQkweDQw
CisgIC8qIFIxIGlzIGEgMS1iaXQgbW9ub2Nocm9tZSB0cmFuc2ZlciBmb3JtYXQgcHJlc2VudGVk
IHRvIHVzZXJzcGFjZSBhcyBYUkdCODg4OCAqLworICAjZGVmaW5lIEdVRF9QSVhFTF9GT1JNQVRf
UjEJCQkweDAxCisgICNkZWZpbmUgR1VEX1BJWEVMX0ZPUk1BVF9SR0I1NjUJCTB4NDAKKyAgI2Rl
ZmluZSBHVURfUElYRUxfRk9STUFUX1hSR0I4ODg4CQkweDgwCisgICNkZWZpbmUgR1VEX1BJWEVM
X0ZPUk1BVF9BUkdCODg4OAkJMHg4MQorCisvKgorICogR2V0IHN1cHBvcnRlZCBwcm9wZXJ0aWVz
IHRoYXQgYXJlIG5vdCBjb25uZWN0b3IgcHJvcGV0aWVzIGFzIGEgJmd1ZF9wcm9wZXJ0eV9yZXEg
YXJyYXkuCisgKiBndWRfcHJvcGVydHlfcmVxLnZhbCBvZnRlbiBjb250YWlucyB0aGUgaW5pdGlh
bCB2YWx1ZSBmb3IgdGhlIHByb3BlcnR5LgorICovCisjZGVmaW5lIEdVRF9SRVFfR0VUX1BST1BF
UlRJRVMJCQkJMHg0MQorCisvKiBDb25uZWN0b3IgcmVxdWVzdHMgaGF2ZSB0aGUgY29ubmVjdG9y
IGluZGV4IHBhc3NlZCBpbiB0aGUgd1ZhbHVlIGZpZWxkICovCisKKy8qIEdldCBjb25uZWN0b3Ig
ZGVzY3JpcHRvciBhcyBhICZndWRfY29ubmVjdG9yX2Rlc2NyaXB0b3JfcmVxICovCisjZGVmaW5l
IEdVRF9SRVFfR0VUX0NPTk5FQ1RPUgkJCQkweDUwCisKKy8qCisgKiBHZXQgcHJvcGVydGllcyBz
dXBwb3J0ZWQgYnkgdGhlIGNvbm5lY3RvciBhcyBhICZndWRfcHJvcGVydHlfcmVxIGFycmF5Lgor
ICogZ3VkX3Byb3BlcnR5X3JlcS52YWwgb2Z0ZW4gY29udGFpbnMgdGhlIGluaXRpYWwgdmFsdWUg
Zm9yIHRoZSBwcm9wZXJ0eS4KKyAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNUT1JfUFJP
UEVSVElFUwkJMHg1MQorCisvKgorICogSXNzdWVkIHdoZW4gdGhlcmUncyBhIFRWX01PREUgcHJv
cGVydHkgcHJlc2VudC4KKyAqIEdldHMgYW4gYXJyYXkgb2YgdGhlIHN1cHBvcnRlZCBUVl9NT0RF
IG5hbWVzIGVhY2ggZW50cnkgb2YgbGVuZ3RoCisgKiBHVURfQ09OTkVDVE9SX1RWX01PREVfTkFN
RV9MRU4uIE5hbWVzIG11c3QgYmUgTlVMLXRlcm1pbmF0ZWQuCisgKi8KKyNkZWZpbmUgR1VEX1JF
UV9HRVRfQ09OTkVDVE9SX1RWX01PREVfVkFMVUVTCQkweDUyCisgICNkZWZpbmUgR1VEX0NPTk5F
Q1RPUl9UVl9NT0RFX05BTUVfTEVOCTE2CisKKy8qIFdoZW4gdXNlcnNwYWNlIGNoZWNrcyBjb25u
ZWN0b3Igc3RhdHVzLCB0aGlzIGlzIGlzc3VlZCBmaXJzdCwgbm90IHVzZWQgZm9yIHBvbGwgcmVx
dWVzdHMuICovCisjZGVmaW5lIEdVRF9SRVFfU0VUX0NPTk5FQ1RPUl9GT1JDRV9ERVRFQ1QJCTB4
NTMKKworLyogR2V0IGNvbm5lY3RvciBzdGF0dXMgYXMgJmd1ZF9jb25uZWN0b3Jfc3RhdHVzX3Jl
cS4gKi8KKyNkZWZpbmUgR1VEX1JFUV9HRVRfQ09OTkVDVE9SX1NUQVRVUwkJCTB4NTQKKworLyog
R2V0ICZndWRfZGlzcGxheV9tb2RlX3JlcSBhcnJheSBvZiBzdXBwb3J0ZWQgZGlzcGxheSBtb2Rl
cyAqLworI2RlZmluZSBHVURfUkVRX0dFVF9DT05ORUNUT1JfTU9ERVMJCQkweDU1CisKKy8qIEdl
dCBFeHRlbmRlZCBEaXNwbGF5IElkZW50aWZpY2F0aW9uIERhdGEgKi8KKyNkZWZpbmUgR1VEX1JF
UV9HRVRfQ09OTkVDVE9SX0VESUQJCQkweDU2CisKKy8qIFNldCBidWZmZXIgcHJvcGVydGllcyBi
ZWZvcmUgYnVsayB0cmFuc2ZlciBhcyAmZ3VkX3NldF9idWZmZXJfcmVxICovCisjZGVmaW5lIEdV
RF9SRVFfU0VUX0JVRkZFUgkJCQkweDYwCisKKy8qIENoZWNrIGRpc3BsYXkgY29uZmlndXJhdGlv
biBhcyAmZ3VkX3N0YXRlX3JlcSAqLworI2RlZmluZSBHVURfUkVRX1NFVF9TVEFURV9DSEVDSwkJ
CQkweDYxCisKKy8qIEFwcGx5IHRoZSBwcmV2aW91cyBTVEFURV9DSEVDSyBjb25maWd1cmF0aW9u
ICovCisjZGVmaW5lIEdVRF9SRVFfU0VUX1NUQVRFX0NPTU1JVAkJCTB4NjIKKworLyogRW5hYmxl
L2Rpc2FibGUgdGhlIGRpc3BsYXkgY29udHJvbGxlciwgdmFsdWUgaXMgdTg6IDAvMSAqLworI2Rl
ZmluZSBHVURfUkVRX1NFVF9DT05UUk9MTEVSX0VOQUJMRQkJCTB4NjMKKworLyogRW5hYmxlL2Rp
c2FibGUgZGlzcGxheS9vdXRwdXQgKERQTVMpLCB2YWx1ZSBpcyB1ODogMC8xICovCisjZGVmaW5l
IEdVRF9SRVFfU0VUX0RJU1BMQVlfRU5BQkxFCQkJMHg2NAorCisjZW5kaWYKLS0gCjIuMjMuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
