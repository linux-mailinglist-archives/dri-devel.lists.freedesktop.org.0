Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32EAFA4F99
	for <lists+dri-devel@lfdr.de>; Mon,  2 Sep 2019 09:17:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 88A6289994;
	Mon,  2 Sep 2019 07:17:21 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lf1-x142.google.com (mail-lf1-x142.google.com
 [IPv6:2a00:1450:4864:20::142])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E1D8689994
 for <dri-devel@lists.freedesktop.org>; Mon,  2 Sep 2019 07:17:19 +0000 (UTC)
Received: by mail-lf1-x142.google.com with SMTP id u13so9630458lfm.9
 for <dri-devel@lists.freedesktop.org>; Mon, 02 Sep 2019 00:17:19 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vUm8vPsTViT+VUzs06SUeqS1gu9Z4pzKy9x/LSlXJ80=;
 b=qtwhAUiq0d15CNp80LdlnFA3iBZtqYJVWSy1BDIMCUavjcYUTTkjIpYOaEUSsEv4Z8
 NcLcmK4IJAN0comnGBwOLuslTiDaMJ3pihOchw9gyg7HiwXjLmKS1iEom01/gwDSTWHu
 wQ4DBDpt/jZhWzdhzHt57bDunkEbU1URvngYZeUjBWIbrCJn79IvO0HGiHtPFs+FTOxO
 xOlP7KEnQHFnrHcAaSlUeAiYlJsowzJjWzIw+ZeoEUoTKxqKR8OK55F/9MZzBIIk1Crs
 ea1j3sgx2sE+GSChk0ziOoqAN47hyS4y7YN8taaz4i3Oz7f//0Hq0RHzIUFcdT9um8j4
 vdVw==
X-Gm-Message-State: APjAAAVx8OwgJB9HNoki4pxGVYtmkgyGtHpPTTqVdjvp1tqeFlXZWY3V
 uChT/5Qvn5vluuzoGEMgdD7UAC78FFw=
X-Google-Smtp-Source: APXvYqypurroTWjGn7pL5qVPoS87iSptbvkPz5kFA+yG1c43z6QwAcVF/pHpnwAO09uTWd5jXTK8iQ==
X-Received: by 2002:ac2:4c9c:: with SMTP id d28mr11387135lfl.119.1567408637922; 
 Mon, 02 Sep 2019 00:17:17 -0700 (PDT)
Received: from genomnajs.ideon.se ([85.235.10.227])
 by smtp.gmail.com with ESMTPSA id q19sm2608928lfj.9.2019.09.02.00.17.16
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 02 Sep 2019 00:17:16 -0700 (PDT)
From: Linus Walleij <linus.walleij@linaro.org>
To: dri-devel@lists.freedesktop.org,
 Maarten Lankhorst <maarten.lankhorst@linux.intel.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>
Subject: [PATCH] drm/mcde: Some fixes to handling video mode
Date: Mon,  2 Sep 2019 09:17:14 +0200
Message-Id: <20190902071714.13538-1-linus.walleij@linaro.org>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=vUm8vPsTViT+VUzs06SUeqS1gu9Z4pzKy9x/LSlXJ80=;
 b=roT+6XRhCzD9dcwoil5RxmoT9J1dqUhruoIRliB1MqOAhfKmlPGz224uauV+9UBW8s
 6jGAbXm8YHpOwkpxIlfcVtdnMw85wFlLflmJkyA6oBOlJSzFuFTll7Rz9Y+T5p5EM67q
 BPqg7861y4yjGQkbGUlVSaKpq0uRAbD/5RVy80lRsyMDz2ri5YeAtlcJnd5PmcUBP1ww
 elrXN8aJbUhcItIiXYst9z9FfuQ+AbThiVauYu4iEDjJtNbsPO83SiOf6qFWYdIFwOgV
 l0fGRjv/B5aTcJioBKM5k4W66bPbJYjrv3CAVOjd6+Fld9Lsefqgbm1yXLBQRQPBIzeJ
 s9cw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Stephan Gerhold <stephan@gerhold.net>, linux-arm-kernel@lists.infradead.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHZpZGVvIERTSSBtb2RlIGhhZCBub3QgcmVhbGx5IGJlZW4gdGVzdGVkLiBUaGVzZSBmaXhl
cyBtYWtlcwppdCBtb3JlIGxpa2VseSB0byB3b3JrIG9uIHJlYWwgaGFyZHdhcmU6Ci0gU2V0IHRo
ZSBIUyBjbG9jayB0byBzb21ldGhpbmcgdGhlIHZpZGVvIG1vZGUgcmVwb3J0ZWQgYnkgdGhlCiAg
cGFuZWwgY2FuIGhhbmRsZSByYXRoZXIgdGhhbiB0aGUgbWF4IEhTIHJhdGUuCi0gUHV0IHRoZSBh
Y3RpdmUgd2lkdGggKHggd2lkdGgpIGluIHRoZSByaWdodCBiaXRzIGFuZCB0aGUgVlNBCiAgKHZl
cnRpY2FsIHN5bmMgYWN0aXZlKSBpbiB0aGUgcmlnaHQgYml0cyAodGhvc2Ugd2VyZSBzd2FwcGVk
KS4KLSBDYWxjdWxhdGUgdGhlIHBhY2tldCBzaXplcyBpbiBieXRlcyBhcyBpbiB0aGUgdmVuZG9y
IGRyaXZlciwKICByYXRoZXIgdGhhbiBpbiBiaXRzLgotIEhhbmRsZSBuZWdhdGl2ZSByZXN1bHQg
aW4gZnJvbnQvYmFjay9zeW5jIHBhY2thZ2VzIGFuZCBmYWxsCiAgYmFjayB0byB6ZXJvIGxpa2Ug
aW4gdGhlIHZlbmRvciBkcml2ZXIuCgpDYzogU3RlcGhhbiBHZXJob2xkIDxzdGVwaGFuQGdlcmhv
bGQubmV0PgpGaXhlczogNWZjNTM3YmZkMDAwICgiZHJtL21jZGU6IEFkZCBuZXcgZHJpdmVyIGZv
ciBTVC1Fcmljc3NvbiBNQ0RFIikKU2lnbmVkLW9mZi1ieTogTGludXMgV2FsbGVpaiA8bGludXMu
d2FsbGVpakBsaW5hcm8ub3JnPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9tY2RlL21jZGVfZHNpLmMg
fCA2MCArKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA0
MSBpbnNlcnRpb25zKCspLCAxOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vbWNkZS9tY2RlX2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL21jZGUvbWNkZV9kc2kuYwpp
bmRleCA5MDY1OWQxOTBkNzguLmY1MDc5ZjBlMjRjYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21jZGUvbWNkZV9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbWNkZS9tY2RlX2RzaS5j
CkBAIC0zNjUsMTEgKzM2NSwxMiBAQCB2b2lkIG1jZGVfZHNpX3RlX3JlcXVlc3Qoc3RydWN0IG1p
cGlfZHNpX2RldmljZSAqbWRzaSkKIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVwX3ZpZGVvX21v
ZGUoc3RydWN0IG1jZGVfZHNpICpkLAogCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICptb2RlKQogewotCXU4IGJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zvcm1hdF90b19icHAo
ZC0+bWRzaS0+Zm9ybWF0KTsKKwkvKiBjcHAsIGNoYXJhY3RlcnMgcGVyIHBpeGVsLCBudW1iZXIg
b2YgYnl0ZXMgcGVyIHBpeGVsICovCisJdTggY3BwID0gbWlwaV9kc2lfcGl4ZWxfZm9ybWF0X3Rv
X2JwcChkLT5tZHNpLT5mb3JtYXQpIC8gODsKIAl1NjQgYnBsOwotCXUzMiBoZnA7Ci0JdTMyIGhi
cDsKLQl1MzIgaHNhOworCWludCBoZnA7CisJaW50IGhicDsKKwlpbnQgaHNhOwogCXUzMiBibGts
aW5lX3BjaywgbGluZV9kdXJhdGlvbjsKIAl1MzIgYmxrZW9sX3BjaywgYmxrZW9sX2R1cmF0aW9u
OwogCXUzMiB2YWw7CkBAIC00MjAsMTMgKzQyMSwxMyBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9z
ZXR1cF92aWRlb19tb2RlKHN0cnVjdCBtY2RlX2RzaSAqZCwKIAl3cml0ZWwodmFsLCBkLT5yZWdz
ICsgRFNJX1ZJRF9NQUlOX0NUTCk7CiAKIAkvKiBWZXJ0aWNhbCBmcmFtZSBwYXJhbWV0ZXJzIGFy
ZSBwcmV0dHkgc3RyYWlnaHQtZm9yd2FyZCAqLwotCXZhbCA9IG1vZGUtPnZkaXNwbGF5IDw8IERT
SV9WSURfVlNJWkVfVlNBX0xFTkdUSF9TSElGVDsKKwl2YWwgPSBtb2RlLT52ZGlzcGxheSA8PCBE
U0lfVklEX1ZTSVpFX1ZBQ1RfTEVOR1RIX1NISUZUOwogCS8qIHZlcnRpY2FsIGZyb250IHBvcmNo
ICovCiAJdmFsIHw9IChtb2RlLT52c3luY19zdGFydCAtIG1vZGUtPnZkaXNwbGF5KQogCQk8PCBE
U0lfVklEX1ZTSVpFX1ZGUF9MRU5HVEhfU0hJRlQ7CiAJLyogdmVydGljYWwgc3luYyBhY3RpdmUg
Ki8KIAl2YWwgfD0gKG1vZGUtPnZzeW5jX2VuZCAtIG1vZGUtPnZzeW5jX3N0YXJ0KQotCQk8PCBE
U0lfVklEX1ZTSVpFX1ZBQ1RfTEVOR1RIX1NISUZUOworCQk8PCBEU0lfVklEX1ZTSVpFX1ZTQV9M
RU5HVEhfU0hJRlQ7CiAJLyogdmVydGljYWwgYmFjayBwb3JjaCAqLwogCXZhbCB8PSAobW9kZS0+
dnRvdGFsIC0gbW9kZS0+dnN5bmNfZW5kKQogCQk8PCBEU0lfVklEX1ZTSVpFX1ZCUF9MRU5HVEhf
U0hJRlQ7CkBAIC00MzcsMjEgKzQzOCwyNSBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9zZXR1cF92
aWRlb19tb2RlKHN0cnVjdCBtY2RlX2RzaSAqZCwKIAkgKiBob3Jpem9udGFsIHJlc29sdXRpb24g
aXMgZ2l2ZW4gaW4gcGl4ZWxzIGFuZCBtdXN0IGJlIHJlLWNhbGN1bGF0ZWQKIAkgKiBpbnRvIGJ5
dGVzIHNpbmNlIHRoaXMgaXMgd2hhdCB0aGUgaGFyZHdhcmUgZXhwZWN0cy4KIAkgKgorCSAqIGhm
cCA9IGhvcml6b250YWwgZnJvbnQgcG9yY2ggaW4gYnl0ZXMKKwkgKiBoYnAgPSBob3Jpem9udGFs
IGJhY2sgcG9yY2ggaW4gYnl0ZXMKKwkgKiBoc2EgPSBob3Jpem9udGFsIHN5bmMgYWN0aXZlIGlu
IGJ5dGVzCisJICoKIAkgKiA2ICsgMiBpcyBIRlAgaGVhZGVyICsgY2hlY2tzdW0KIAkgKi8KLQlo
ZnAgPSAobW9kZS0+aHN5bmNfc3RhcnQgLSBtb2RlLT5oZGlzcGxheSkgKiBicHAgLSA2IC0gMjsK
KwloZnAgPSAobW9kZS0+aHN5bmNfc3RhcnQgLSBtb2RlLT5oZGlzcGxheSkgKiBjcHAgLSA2IC0g
MjsKIAlpZiAoZC0+bWRzaS0+bW9kZV9mbGFncyAmIE1JUElfRFNJX01PREVfVklERU9fU1lOQ19Q
VUxTRSkgewogCQkvKgogCQkgKiA2IGlzIEhCUCBoZWFkZXIgKyBjaGVja3N1bQogCQkgKiA0IGlz
IFJHQiBoZWFkZXIgKyBjaGVja3N1bQogCQkgKi8KLQkJaGJwID0gKG1vZGUtPmh0b3RhbCAtIG1v
ZGUtPmhzeW5jX2VuZCkgKiBicHAgLSA0IC0gNjsKKwkJaGJwID0gKG1vZGUtPmh0b3RhbCAtIG1v
ZGUtPmhzeW5jX2VuZCkgKiBjcHAgLSA0IC0gNjsKIAkJLyoKIAkJICogNiBpcyBIQlAgaGVhZGVy
ICsgY2hlY2tzdW0KIAkJICogNCBpcyBIU1cgcGFja2V0IGJ5dGVzCiAJCSAqIDQgaXMgUkdCIGhl
YWRlciArIGNoZWNrc3VtCiAJCSAqLwotCQloc2EgPSAobW9kZS0+aHN5bmNfZW5kIC0gbW9kZS0+
aHN5bmNfc3RhcnQpICogYnBwIC0gNCAtIDQgLSA2OworCQloc2EgPSAobW9kZS0+aHN5bmNfZW5k
IC0gbW9kZS0+aHN5bmNfc3RhcnQpICogY3BwIC0gNCAtIDQgLSA2OwogCX0gZWxzZSB7CiAJCS8q
CiAJCSAqIEhCUCBpbmNsdWRlcyBib3RoIGJhY2sgcG9yY2ggYW5kIHN5bmMKQEAgLTQ1OSwxMSAr
NDY0LDIzIEBAIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVwX3ZpZGVvX21vZGUoc3RydWN0IG1j
ZGVfZHNpICpkLAogCQkgKiA0IGlzIEhTVyBwYWNrZXQgYnl0ZXMKIAkJICogNCBpcyBSR0IgaGVh
ZGVyICsgY2hlY2tzdW0KIAkJICovCi0JCWhicCA9IChtb2RlLT5odG90YWwgLSBtb2RlLT5oc3lu
Y19zdGFydCkgKiBicHAgLSA0IC0gNCAtIDY7Ci0JCS8qIEhTQSBpcyBub3QgY29uc2lkZXJlZCBp
biB0aGlzIG1vZGUgYW5kIHNldCB0byAwICovCisJCWhicCA9IChtb2RlLT5odG90YWwgLSBtb2Rl
LT5oc3luY19zdGFydCkgKiBjcHAgLSA0IC0gNCAtIDY7CisJCS8qIEhTQSBpcyBub3QgcHJlc2Vu
dCBpbiB0aGlzIG1vZGUgYW5kIHNldCB0byAwICovCisJCWhzYSA9IDA7CisJfQorCWlmIChoZnAg
PCAwKSB7CisJCWRldl9pbmZvKGQtPmRldiwgImhmcCBuZWdhdGl2ZSwgc2V0IHRvIDBcbiIpOwor
CQloZnAgPSAwOworCX0KKwlpZiAoaGJwIDwgMCkgeworCQlkZXZfaW5mbyhkLT5kZXYsICJoYnAg
bmVnYXRpdmUsIHNldCB0byAwXG4iKTsKKwkJaGJwID0gMDsKKwl9CisJaWYgKGhzYSA8IDApIHsK
KwkJZGV2X2luZm8oZC0+ZGV2LCAiaHNhIG5lZ2F0aXZlLCBzZXQgdG8gMFxuIik7CiAJCWhzYSA9
IDA7CiAJfQotCWRldl9kYmcoZC0+ZGV2LCAiaGZwOiAldSwgaGJwOiAldSwgaHNhOiAldVxuIiwK
KwlkZXZfZGJnKGQtPmRldiwgImhmcDogJXUsIGhicDogJXUsIGhzYTogJXUgYnl0ZXNcbiIsCiAJ
CWhmcCwgaGJwLCBoc2EpOwogCiAJLyogRnJhbWUgcGFyYW1ldGVyczogaG9yaXpvbnRhbCBzeW5j
IGFjdGl2ZSAqLwpAQCAtNDc1LDcgKzQ5Miw3IEBAIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVw
X3ZpZGVvX21vZGUoc3RydWN0IG1jZGVfZHNpICpkLAogCXdyaXRlbCh2YWwsIGQtPnJlZ3MgKyBE
U0lfVklEX0hTSVpFMSk7CiAKIAkvKiBSR0IgZGF0YSBsZW5ndGggKGJ5dGVzIG9uIG9uZSBzY2Fu
bGluZSkgKi8KLQl2YWwgPSBtb2RlLT5oZGlzcGxheSAqIChicHAgLyA4KTsKKwl2YWwgPSBtb2Rl
LT5oZGlzcGxheSAqIGNwcDsKIAl3cml0ZWwodmFsLCBkLT5yZWdzICsgRFNJX1ZJRF9IU0laRTIp
OwogCiAJLyogVE9ETzogZnVydGhlciBhZGp1c3RtZW50cyBmb3IgVFZHIG1vZGUgaGVyZSAqLwpA
QCAtNTA3LDcgKzUyNCw3IEBAIHN0YXRpYyB2b2lkIG1jZGVfZHNpX3NldHVwX3ZpZGVvX21vZGUo
c3RydWN0IG1jZGVfZHNpICpkLAogCX0KIAogCWxpbmVfZHVyYXRpb24gPSAoYmxrbGluZV9wY2sg
KyA2KSAvIGQtPm1kc2ktPmxhbmVzOwotCWRldl9kYmcoZC0+ZGV2LCAibGluZSBkdXJhdGlvbiAl
dVxuIiwgbGluZV9kdXJhdGlvbik7CisJZGV2X2RiZyhkLT5kZXYsICJsaW5lIGR1cmF0aW9uICV1
IGJ5dGVzXG4iLCBsaW5lX2R1cmF0aW9uKTsKIAl2YWwgPSBsaW5lX2R1cmF0aW9uIDw8IERTSV9W
SURfRFBIWV9USU1FX1JFR19MSU5FX0RVUkFUSU9OX1NISUZUOwogCS8qCiAJICogVGhpcyBpcyB0
aGUgdGltZSB0byBwZXJmb3JtIExQLT5IUyBvbiBELVBIWQpAQCAtNTE3LDE3ICs1MzQsMTggQEAg
c3RhdGljIHZvaWQgbWNkZV9kc2lfc2V0dXBfdmlkZW9fbW9kZShzdHJ1Y3QgbWNkZV9kc2kgKmQs
CiAJd3JpdGVsKHZhbCwgZC0+cmVncyArIERTSV9WSURfRFBIWV9USU1FKTsKIAogCS8qIENhbGN1
bGF0ZSBibG9jayBlbmQgb2YgbGluZSAqLwotCWJsa2VvbF9wY2sgPSBicGwgLSBtb2RlLT5oZGlz
cGxheSAqIGJwcCAtIDY7CisJYmxrZW9sX3BjayA9IGJwbCAtIG1vZGUtPmhkaXNwbGF5ICogY3Bw
IC0gNjsKIAlibGtlb2xfZHVyYXRpb24gPSAoYmxrZW9sX3BjayArIDYpIC8gZC0+bWRzaS0+bGFu
ZXM7Ci0JZGV2X2RiZyhkLT5kZXYsICJibGtlb2wgcGNrOiAldSwgZHVyYXRpb246ICV1XG4iLAot
CQkgYmxrZW9sX3BjaywgYmxrZW9sX2R1cmF0aW9uKTsKKwlkZXZfZGJnKGQtPmRldiwgImJsa2Vv
bCBwY2s6ICV1IGJ5dGVzLCBkdXJhdGlvbjogJXUgYnl0ZXNcbiIsCisJCWJsa2VvbF9wY2ssIGJs
a2VvbF9kdXJhdGlvbik7CiAKIAlpZiAoZC0+bWRzaS0+bW9kZV9mbGFncyAmIE1JUElfRFNJX01P
REVfVklERU9fQlVSU1QpIHsKIAkJLyogU2V0IHVwIEVPTCBjbG9jayBmb3IgYnVyc3QgbW9kZSAq
LwogCQl2YWwgPSByZWFkbChkLT5yZWdzICsgRFNJX1ZJRF9CTEtTSVpFMSk7CiAJCXZhbCB8PSBi
bGtlb2xfcGNrIDw8IERTSV9WSURfQkxLU0laRTFfQkxLRU9MX1BDS19TSElGVDsKIAkJd3JpdGVs
KHZhbCwgZC0+cmVncyArIERTSV9WSURfQkxLU0laRTEpOwotCQl3cml0ZWwoYmxrZW9sX3Bjaywg
ZC0+cmVncyArIERTSV9WSURfVkNBX1NFVFRJTkcyKTsKKwkJd3JpdGVsKGJsa2VvbF9wY2sgJiBE
U0lfVklEX1ZDQV9TRVRUSU5HMl9FWEFDVF9CVVJTVF9MSU1JVF9NQVNLLAorCQkgICAgICAgZC0+
cmVncyArIERTSV9WSURfVkNBX1NFVFRJTkcyKTsKIAogCQl3cml0ZWwoYmxrZW9sX2R1cmF0aW9u
LCBkLT5yZWdzICsgRFNJX1ZJRF9QQ0tfVElNRSk7CiAJCXdyaXRlbChibGtlb2xfZHVyYXRpb24g
LSA2LCBkLT5yZWdzICsgRFNJX1ZJRF9WQ0FfU0VUVElORzEpOwpAQCAtNTM1LDkgKzU1MywxMSBA
QCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9zZXR1cF92aWRlb19tb2RlKHN0cnVjdCBtY2RlX2RzaSAq
ZCwKIAogCS8qIE1heGltdW0gbGluZSBsaW1pdCAqLwogCXZhbCA9IHJlYWRsKGQtPnJlZ3MgKyBE
U0lfVklEX1ZDQV9TRVRUSU5HMik7CisJdmFsICY9IH5EU0lfVklEX1ZDQV9TRVRUSU5HMl9NQVhf
TElORV9MSU1JVF9NQVNLOwogCXZhbCB8PSBibGtsaW5lX3BjayA8PAogCQlEU0lfVklEX1ZDQV9T
RVRUSU5HMl9FWEFDVF9CVVJTVF9MSU1JVF9TSElGVDsKIAl3cml0ZWwodmFsLCBkLT5yZWdzICsg
RFNJX1ZJRF9WQ0FfU0VUVElORzIpOworCWRldl9kYmcoZC0+ZGV2LCAiYmxrbGluZSBwY2s6ICV1
IGJ5dGVzXG4iLCBibGtsaW5lX3Bjayk7CiAKIAkvKiBQdXQgSUYxIGludG8gdmlkZW8gbW9kZSAq
LwogCXZhbCA9IHJlYWRsKGQtPnJlZ3MgKyBEU0lfTUNUTF9NQUlOX0RBVEFfQ1RMKTsKQEAgLTY5
OSw3ICs3MTksOSBAQCBzdGF0aWMgdm9pZCBtY2RlX2RzaV9icmlkZ2VfbW9kZV9zZXQoc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJbHBfZnJlcSA9IGQtPm1kc2ktPmxwX3JhdGU7CiAJZWxz
ZQogCQlscF9mcmVxID0gRFNJX0RFRkFVTFRfTFBfRlJFUV9IWjsKLQlpZiAoZC0+bWRzaS0+aHNf
cmF0ZSkKKwlpZiAocGl4ZWxfY2xvY2tfaHopCisJCWhzX2ZyZXEgPSBwaXhlbF9jbG9ja19oejsK
KwllbHNlIGlmIChkLT5tZHNpLT5oc19yYXRlKQogCQloc19mcmVxID0gZC0+bWRzaS0+aHNfcmF0
ZTsKIAllbHNlCiAJCWhzX2ZyZXEgPSBEU0lfREVGQVVMVF9IU19GUkVRX0haOwotLSAKMi4yMS4w
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2
ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
