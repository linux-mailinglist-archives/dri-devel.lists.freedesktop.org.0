Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 87208395D0
	for <lists+dri-devel@lfdr.de>; Fri,  7 Jun 2019 21:35:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 62C8D89BBD;
	Fri,  7 Jun 2019 19:35:44 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from lelv0143.ext.ti.com (lelv0143.ext.ti.com [198.47.23.248])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B8DC089BB0
 for <dri-devel@lists.freedesktop.org>; Fri,  7 Jun 2019 19:35:42 +0000 (UTC)
Received: from fllv0034.itg.ti.com ([10.64.40.246])
 by lelv0143.ext.ti.com (8.15.2/8.15.2) with ESMTP id x57JZT6K085446;
 Fri, 7 Jun 2019 14:35:29 -0500
Received: from DLEE100.ent.ti.com (dlee100.ent.ti.com [157.170.170.30])
 by fllv0034.itg.ti.com (8.15.2/8.15.2) with ESMTPS id x57JZTc5029112
 (version=TLSv1.2 cipher=AES256-GCM-SHA384 bits=256 verify=FAIL);
 Fri, 7 Jun 2019 14:35:29 -0500
Received: from DLEE106.ent.ti.com (157.170.170.36) by DLEE100.ent.ti.com
 (157.170.170.30) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5; Fri, 7 Jun
 2019 14:35:29 -0500
Received: from lelv0326.itg.ti.com (10.180.67.84) by DLEE106.ent.ti.com
 (157.170.170.36) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id 15.1.1713.5 via
 Frontend Transport; Fri, 7 Jun 2019 14:35:29 -0500
Received: from legion.dal.design.ti.com (legion.dal.design.ti.com
 [128.247.22.53])
 by lelv0326.itg.ti.com (8.15.2/8.15.2) with ESMTP id x57JZTgU130558;
 Fri, 7 Jun 2019 14:35:29 -0500
Received: from localhost ([10.250.68.219])
 by legion.dal.design.ti.com (8.11.7p1+Sun/8.11.7) with ESMTP id x57JZRm20302; 
 Fri, 7 Jun 2019 14:35:27 -0500 (CDT)
From: "Andrew F. Davis" <afd@ti.com>
To: Rob Herring <robh+dt@kernel.org>, Mark Rutland <mark.rutland@arm.com>,
 Santosh Shilimkar <ssantosh@kernel.org>,
 Will Deacon <will.deacon@arm.com>, Robin Murphy <robin.murphy@arm.com>,
 Joerg Roedel <joro@8bytes.org>, David Airlie <airlied@linux.ie>,
 Daniel Vetter <daniel@ffwll.ch>, Tero Kristo <t-kristo@ti.com>,
 William Mills <wmills@ti.com>, Tomi Valkeinen <tomi.valkeinen@ti.com>,
 Sumit Semwal <sumit.semwal@linaro.org>, John Stultz
 <john.stultz@linaro.org>
Subject: [RFC PATCH 2/2] soc: ti: Add Support for the TI Page-based Address
 Translator (PAT)
Date: Fri, 7 Jun 2019 15:35:23 -0400
Message-ID: <20190607193523.25700-3-afd@ti.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190607193523.25700-1-afd@ti.com>
References: <20190607193523.25700-1-afd@ti.com>
MIME-Version: 1.0
X-EXCLAIMER-MD-CONFIG: e1e8a2fd-e40a-4ac6-ac9b-f7e9cc9ee180
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ti.com; s=ti-com-17Q1; t=1559936129;
 bh=cAAtY/BJUn7iO79jToVtIHll/5ZQdyNmALRTaYjK+7U=;
 h=From:To:CC:Subject:Date:In-Reply-To:References;
 b=fOCL+ce0w2H8xNelRB5QL8rqp5d7b5keq5sMXBCnQK0sz46tcG8LJ8UxUqwvIfKpI
 Jfvrkt9C/IIT6q9TXXDIYUu9kYVVggthejZ2sNosS/mguHF67Gs9QbYWPgCrQ2u9SA
 NK8JnV45EjO7o5AQNHf+B/3I+gR5Hs6sUX0OKD0g=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: devicetree@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org, "Andrew F . Davis" <afd@ti.com>,
 linaro-mm-sig@lists.linaro.org, iommu@lists.linux-foundation.org,
 linux-arm-kernel@lists.infradead.org, linux-media@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBhZGRzIGEgZHJpdmVyIGZvciB0aGUgUGFnZS1iYXNlZCBBZGRyZXNzIFRyYW5z
bGF0b3IgKFBBVCkKcHJlc2VudCBvbiB2YXJpb3VzIFRJIFNvQ3MuIEEgUEFUIGRldmljZSBwZXJm
b3JtcyBhZGRyZXNzIHRyYW5zbGF0aW9uCnVzaW5nIHRhYmxlcyBzdG9yZWQgaW4gYW4gaW50ZXJu
YWwgU1JBTS4gRWFjaCBQQVQgc3VwcG9ydHMgYSBzZXQgbnVtYmVyCm9mIHBhZ2VzLCBlYWNoIG9j
Y3VweWluZyBhIHByb2dyYW1tYWJsZSA0S0IsIDE2S0IsIDY0S0IsIG9yIDFNQiBvZgphZGRyZXNz
ZXMgaW4gYSB3aW5kb3cgZm9yIHdoaWNoIGFuIGluY29taW5nIHRyYW5zYWN0aW9uIHdpbGwgYmUK
dHJhbnNsYXRlZC4KClNpZ25lZC1vZmYtYnk6IEFuZHJldyBGLiBEYXZpcyA8YWZkQHRpLmNvbT4K
LS0tCiBkcml2ZXJzL3NvYy90aS9LY29uZmlnICAgICAgfCAgIDkgKwogZHJpdmVycy9zb2MvdGkv
TWFrZWZpbGUgICAgIHwgICAxICsKIGRyaXZlcnMvc29jL3RpL3RpLXBhdC5jICAgICB8IDU2OSAr
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC90
aS1wYXQuaCB8ICA0NCArKysKIDQgZmlsZXMgY2hhbmdlZCwgNjIzIGluc2VydGlvbnMoKykKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL3NvYy90aS90aS1wYXQuYwogY3JlYXRlIG1vZGUgMTAw
NjQ0IGluY2x1ZGUvdWFwaS9saW51eC90aS1wYXQuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc29j
L3RpL0tjb25maWcgYi9kcml2ZXJzL3NvYy90aS9LY29uZmlnCmluZGV4IGYwYmUzNWQzZGNiYS4u
YjgzOGFlNzRkMDFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL3NvYy90aS9LY29uZmlnCisrKyBiL2Ry
aXZlcnMvc29jL3RpL0tjb25maWcKQEAgLTg2LDQgKzg2LDEzIEBAIGNvbmZpZyBUSV9TQ0lfSU5U
QV9NU0lfRE9NQUlOCiAJaGVscAogCSAgRHJpdmVyIHRvIGVuYWJsZSBJbnRlcnJ1cHQgQWdncmVn
YXRvciBzcGVjaWZpYyBNU0kgRG9tYWluLgogCitjb25maWcgVElfUEFUCisJdHJpc3RhdGUgIlRJ
IFBBVCBETUEtQlVGIGV4cG9ydGVyIgorCXNlbGVjdCBSRUdNQVAKKwloZWxwCisJICBEcml2ZXIg
Zm9yIFRJIFBhZ2UtYmFzZWQgQWRkcmVzcyBUcmFuc2xhdG9yIChQQVQpLiBUaGlzIGRyaXZlcgor
CSAgcHJvdmlkZXMgdGhlIGFuIEFQSSBhbGxvd2luZyB0aGUgcmVtYXBwaW5nIG9mIGEgbm9uLWNv
bnRpZ3VvdXMKKwkgIERNQS1CVUYgaW50byBhIGNvbnRpZ3VvdXMgb25lIHRoYXQgaXMgc3V0YWJs
ZSBmb3IgZGV2aWNlcyBuZWVkaW5nCisJICBjb25pZ3VvdXMgbWVtb3J5LgorCiBlbmRpZiAjIFNP
Q19USQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zb2MvdGkvTWFrZWZpbGUgYi9kcml2ZXJzL3NvYy90
aS9NYWtlZmlsZQppbmRleCBiMzg2OGQzOTJkNGYuLjEzNjk2NDJiNDBjMyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9zb2MvdGkvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9zb2MvdGkvTWFrZWZpbGUKQEAg
LTksMyArOSw0IEBAIG9iai0kKENPTkZJR19BTVgzX1BNKQkJCSs9IHBtMzN4eC5vCiBvYmotJChD
T05GSUdfV0tVUF9NM19JUEMpCQkrPSB3a3VwX20zX2lwYy5vCiBvYmotJChDT05GSUdfVElfU0NJ
X1BNX0RPTUFJTlMpCQkrPSB0aV9zY2lfcG1fZG9tYWlucy5vCiBvYmotJChDT05GSUdfVElfU0NJ
X0lOVEFfTVNJX0RPTUFJTikJKz0gdGlfc2NpX2ludGFfbXNpLm8KK29iai0kKENPTkZJR19USV9Q
QVQpCQkJKz0gdGktcGF0Lm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvc29jL3RpL3RpLXBhdC5jIGIv
ZHJpdmVycy9zb2MvdGkvdGktcGF0LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi43MzU5ZWEwZjdjY2YKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL3NvYy90aS90
aS1wYXQuYwpAQCAtMCwwICsxLDU2OSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQ
TC0yLjAKKy8qCisgKiBUSSBQQVQgbWFwcGVkIERNQS1CVUYgbWVtb3J5IHJlLWV4cG9ydGVyCisg
KgorICogQ29weXJpZ2h0IChDKSAyMDE4LTIwMTkgVGV4YXMgSW5zdHJ1bWVudHMgSW5jb3Jwb3Jh
dGVkIC0gaHR0cDovL3d3dy50aS5jb20vCisgKglBbmRyZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+
CisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2ZzLmg+CisjaW5jbHVkZSA8bGludXgvbW9kdWxlLmg+
CisjaW5jbHVkZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvbW9k
X2RldmljZXRhYmxlLmg+CisjaW5jbHVkZSA8bGludXgvdWFjY2Vzcy5oPgorI2luY2x1ZGUgPGxp
bnV4L21pc2NkZXZpY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9yZWdtYXAuaD4KKyNpbmNsdWRlIDxs
aW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvZ2VuYWxsb2MuaD4KKyNpbmNsdWRlIDxs
aW51eC92bWFsbG9jLmg+CisjaW5jbHVkZSA8bGludXgvc2xhYi5oPgorCisjaW5jbHVkZSA8bGlu
dXgvdGktcGF0Lmg+CisKKyNkZWZpbmUgVElfUEFUX0RSSVZFUl9OQU1FCSJ0aS1wYXQiCisKKy8q
IFRJIFBBVCBNTVJTIHJlZ2lzdGVycyAqLworI2RlZmluZSBUSV9QQVRfTU1SU19QSUQJCTB4MCAv
KiBSZXZpc2lvbiBSZWdpc3RlciAqLworI2RlZmluZSBUSV9QQVRfTU1SU19DT05GSUcJMHg0IC8q
IENvbmZpZyBSZWdpc3RlciAqLworI2RlZmluZSBUSV9QQVRfTU1SU19DT05UUk9MCTB4MTAgLyog
Q29udHJvbCBSZWdpc3RlciAqLworCisvKiBUSSBQQVQgQ09OVFJPTCByZWdpc3RlciBmaWVsZCB2
YWx1ZXMgKi8KKyNkZWZpbmUgVElfUEFUX0NPTlRST0xfQVJCX01PREVfVUYJMHgwIC8qIFVwZGF0
ZXMgZmlyc3QgKi8KKyNkZWZpbmUgVElfUEFUX0NPTlRST0xfQVJCX01PREVfUlIJMHgyIC8qIFJv
dW5kLXJvYmluICovCisKKyNkZWZpbmUgVElfUEFUX0NPTlRST0xfUEFHRV9TSVpFXzRLQgkweDAK
KyNkZWZpbmUgVElfUEFUX0NPTlRST0xfUEFHRV9TSVpFXzE2S0IJMHgxCisjZGVmaW5lIFRJX1BB
VF9DT05UUk9MX1BBR0VfU0laRV82NEtCCTB4MgorI2RlZmluZSBUSV9QQVRfQ09OVFJPTF9QQUdF
X1NJWkVfMU1CCTB4MworCitzdGF0aWMgdW5zaWduZWQgaW50IHRpX3BhdF9wYWdlX3NpemVzW10g
PSB7CisJW1RJX1BBVF9DT05UUk9MX1BBR0VfU0laRV80S0JdICA9IDQgKiAxMDI0LAorCVtUSV9Q
QVRfQ09OVFJPTF9QQUdFX1NJWkVfMTZLQl0gPSAxNiAqIDEwMjQsCisJW1RJX1BBVF9DT05UUk9M
X1BBR0VfU0laRV82NEtCXSA9IDY0ICogMTAyNCwKKwlbVElfUEFUX0NPTlRST0xfUEFHRV9TSVpF
XzFNQl0gID0gMTAyNCAqIDEwMjQsCit9OworCitlbnVtIHRpX3BhdF9tbXJzX2ZpZWxkcyB7CisJ
LyogUmV2aXNpb24gKi8KKwlGX1BJRF9NQUpPUiwKKwlGX1BJRF9NSU5PUiwKKworCS8qIENvbnRy
b2xzICovCisJRl9DT05UUk9MX0FSQl9NT0RFLAorCUZfQ09OVFJPTF9QQUdFX1NJWkUsCisJRl9D
T05UUk9MX1JFUExBQ0VfT0lEX0VOLAorCUZfQ09OVFJPTF9FTiwKKworCS8qIHNlbnRpbmVsICov
CisJRl9NQVhfRklFTERTCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IHJlZ19maWVsZCB0aV9w
YXRfbW1yc19yZWdfZmllbGRzW10gPSB7CisJLyogUmV2aXNpb24gKi8KKwlbRl9QSURfTUFKT1Jd
CQkJPSBSRUdfRklFTEQoVElfUEFUX01NUlNfUElELCA4LCAxMCksCisJW0ZfUElEX01JTk9SXQkJ
CT0gUkVHX0ZJRUxEKFRJX1BBVF9NTVJTX1BJRCwgMCwgNSksCisJLyogQ29udHJvbHMgKi8KKwlb
Rl9DT05UUk9MX0FSQl9NT0RFXQkJPSBSRUdfRklFTEQoVElfUEFUX01NUlNfQ09OVFJPTCwgNiwg
NyksCisJW0ZfQ09OVFJPTF9QQUdFX1NJWkVdCQk9IFJFR19GSUVMRChUSV9QQVRfTU1SU19DT05U
Uk9MLCA0LCA1KSwKKwlbRl9DT05UUk9MX1JFUExBQ0VfT0lEX0VOXQk9IFJFR19GSUVMRChUSV9Q
QVRfTU1SU19DT05UUk9MLCAxLCAxKSwKKwlbRl9DT05UUk9MX0VOXQkJCT0gUkVHX0ZJRUxEKFRJ
X1BBVF9NTVJTX0NPTlRST0wsIDAsIDApLAorfTsKKworLyoqCisgKiBzdHJ1Y3QgdGlfcGF0X2Rh
dGEgLSBQQVQgZGV2aWNlIGluc3RhbmNlIGRhdGEKKyAqIEBkZXY6IFBBVCBkZXZpY2Ugc3RydWN0
dXJlCisgKiBAbWRldjogbWlzYyBkZXZpY2UKKyAqIEBtbXJzX21hcDogUmVnaXN0ZXIgbWFwIG9m
IE1NUlMgcmVnaW9uCisgKiBAdGFibGVfYmFzZTogQmFzZSBhZGRyZXNzIG9mIFRBQkxFIHJlZ2lv
bgorICovCitzdHJ1Y3QgdGlfcGF0X2RhdGEgeworCXN0cnVjdCBkZXZpY2UgKmRldjsKKwlzdHJ1
Y3QgbWlzY2RldmljZSBtZGV2OworCXN0cnVjdCByZWdtYXAgKm1tcnNfbWFwOworCXN0cnVjdCBy
ZWdtYXBfZmllbGQgKm1tcnNfZmllbGRzW0ZfTUFYX0ZJRUxEU107CisJdm9pZCBfX2lvbWVtICp0
YWJsZV9iYXNlOworCXVuc2lnbmVkIGludCBwYWdlX2NvdW50OworCXVuc2lnbmVkIGludCBwYWdl
X3NpemU7CisJcGh5c19hZGRyX3Qgd2luZG93X2Jhc2U7CisJc3RydWN0IGdlbl9wb29sICpwb29s
OworfTsKKworc3RydWN0IHRpX3BhdF9kbWFfYnVmX2F0dGFjaG1lbnQgeworCXN0cnVjdCBkZXZp
Y2UgKmRldjsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnRhYmxlOworCXN0cnVjdCB0aV9wYXRfYnVmZmVy
ICpidWZmZXI7CisJc3RydWN0IGxpc3RfaGVhZCBsaXN0OworfTsKKworc3RydWN0IHRpX3BhdF9i
dWZmZXIgeworCXN0cnVjdCB0aV9wYXRfZGF0YSAqcGF0OworCXN0cnVjdCBkbWFfYnVmICppX2Rt
YV9idWY7CisJc2l6ZV90IHNpemU7CisJdW5zaWduZWQgbG9uZyBvZmZzZXQ7CisJc3RydWN0IGRt
YV9idWYgKmVfZG1hX2J1ZjsKKworCXN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1l
bnQ7CisJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisKKwlzdHJ1Y3QgbGlzdF9oZWFkIGF0dGFjaG1l
bnRzOworCWludCBtYXBfY291bnQ7CisKKwlzdHJ1Y3QgbXV0ZXggbG9jazsKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgcmVnbWFwX2NvbmZpZyB0aV9wYXRfcmVnbWFwX2NvbmZpZyA9IHsKKwku
cmVnX2JpdHMgPSAzMiwKKwkudmFsX2JpdHMgPSAzMiwKKwkucmVnX3N0cmlkZSA9IDQsCit9Owor
CitzdGF0aWMgaW50IHRpX3BhdF9kbWFfYnVmX2F0dGFjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVm
LAorCQkJCSBzdHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50KQoreworCXN0cnVj
dCB0aV9wYXRfZG1hX2J1Zl9hdHRhY2htZW50ICphOworCXN0cnVjdCB0aV9wYXRfYnVmZmVyICpi
dWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwlhID0ga3phbGxvYyhzaXplb2YoKmEpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIWEpCisJCXJldHVybiAtRU5PTUVNOworCisJYS0+ZGV2ID0gYXR0YWNobWVu
dC0+ZGV2OworCWEtPmJ1ZmZlciA9IGJ1ZmZlcjsKKwlJTklUX0xJU1RfSEVBRCgmYS0+bGlzdCk7
CisKKwlhLT50YWJsZSA9IGt6YWxsb2Moc2l6ZW9mKCphLT50YWJsZSksIEdGUF9LRVJORUwpOwor
CWlmICghYS0+dGFibGUpIHsKKwkJa2ZyZWUoYSk7CisJCXJldHVybiAtRU5PTUVNOworCX0KKwor
CWlmIChzZ19hbGxvY190YWJsZShhLT50YWJsZSwgMSwgR0ZQX0tFUk5FTCkpIHsKKwkJa2ZyZWUo
YS0+dGFibGUpOworCQlrZnJlZShhKTsKKwkJcmV0dXJuIC1FTk9NRU07CisJfQorCisJc2dfc2V0
X3BhZ2UoYS0+dGFibGUtPnNnbCwgcGZuX3RvX3BhZ2UoUEZOX0RPV04oYnVmZmVyLT5vZmZzZXQp
KSwgYnVmZmVyLT5zaXplLCAwKTsKKworCWF0dGFjaG1lbnQtPnByaXYgPSBhOworCisJbXV0ZXhf
bG9jaygmYnVmZmVyLT5sb2NrKTsKKwkvKiBGaXJzdCB0aW1lIGF0dGFjaG1lbnQgd2UgYXR0YWNo
IHRvIHBhcmVudCAqLworCWlmIChsaXN0X2VtcHR5KCZidWZmZXItPmF0dGFjaG1lbnRzKSkgewor
CQlidWZmZXItPmF0dGFjaG1lbnQgPSBkbWFfYnVmX2F0dGFjaChidWZmZXItPmlfZG1hX2J1Ziwg
YnVmZmVyLT5wYXQtPmRldik7CisJCWlmIChJU19FUlIoYnVmZmVyLT5hdHRhY2htZW50KSkgewor
CQkJZGV2X2VycihidWZmZXItPnBhdC0+ZGV2LCAiVW5hYmxlIHRvIGF0dGFjaCB0byBwYXJlbnQg
RE1BLUJVRlxuIik7CisJCQltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7CisJCQlrZnJlZShh
LT50YWJsZSk7CisJCQlrZnJlZShhKTsKKwkJCXJldHVybiBQVFJfRVJSKGJ1ZmZlci0+YXR0YWNo
bWVudCk7CisJCX0KKwl9CisJbGlzdF9hZGQoJmEtPmxpc3QsICZidWZmZXItPmF0dGFjaG1lbnRz
KTsKKwltdXRleF91bmxvY2soJmJ1ZmZlci0+bG9jayk7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIHZvaWQgdGlfcGF0X2RtYV9idWZfZGV0YXRjaChzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAor
CQkJCSAgIHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1lbnQgKmF0dGFjaG1lbnQpCit7CisJc3RydWN0
IHRpX3BhdF9kbWFfYnVmX2F0dGFjaG1lbnQgKmEgPSBhdHRhY2htZW50LT5wcml2OworCXN0cnVj
dCB0aV9wYXRfYnVmZmVyICpidWZmZXIgPSBkbWFidWYtPnByaXY7CisKKwltdXRleF9sb2NrKCZi
dWZmZXItPmxvY2spOworCWxpc3RfZGVsKCZhLT5saXN0KTsKKwkvKiBMYXN0IGF0dGFjaG1lbnQg
d2UgZGV0YWNoIGZyb20gcGFyZW50ICovCisJaWYgKGxpc3RfZW1wdHkoJmJ1ZmZlci0+YXR0YWNo
bWVudHMpKSB7CisJCWRtYV9idWZfZGV0YWNoKGJ1ZmZlci0+aV9kbWFfYnVmLCBidWZmZXItPmF0
dGFjaG1lbnQpOworCQlidWZmZXItPmF0dGFjaG1lbnQgPSBOVUxMOworCX0KKwltdXRleF91bmxv
Y2soJmJ1ZmZlci0+bG9jayk7CisKKwlrZnJlZShhKTsKK30KKworc3RhdGljIHZvaWQgdGlfcGF0
X3NldF9wYWdlKHN0cnVjdCB0aV9wYXRfZGF0YSAqcGF0LCBzaXplX3QgcGFnZV9pZCwgZG1hX2Fk
ZHJfdCBkbWFfYWRkcmVzcykKK3sKKwl1bnNpZ25lZCBpbnQgaiA9IHBhZ2VfaWQgPj4gODsKKwl1
bnNpZ25lZCBpbnQgayA9IHBhZ2VfaWQgJiAweGZmOworCWRtYV9hZGRyX3Qgb2Zmc2V0ID0gKGog
KiAweDEwMDApICsgKGsgKiAweDgpOworCXZvaWQgX19pb21lbSAqdGFibGVfYmFzZV9sID0gcGF0
LT50YWJsZV9iYXNlICsgb2Zmc2V0OworCXZvaWQgX19pb21lbSAqdGFibGVfYmFzZV9oID0gdGFi
bGVfYmFzZV9sICsgMHg0OworCisJdTMyIGJhc2VfbCA9IGRtYV9hZGRyZXNzID4+IDEyOworCXUz
MiBiYXNlX2ggPSAoZG1hX2FkZHJlc3MgPj4gNDQpICYgR0VOTUFTSygzLCAwKTsKKworCWRldl9k
YmcocGF0LT5kZXYsICJFbmFibGluZyBQQVQgaW5kZXg6ICV6dSBwb2ludGluZyB0byAlcGFkXG4i
LCBwYWdlX2lkLCAmZG1hX2FkZHJlc3MpOworCisJd3JpdGVsKGJhc2VfbCwgdGFibGVfYmFzZV9s
KTsKKwl3cml0ZWwoQklUKDMxKSB8IGJhc2VfaCwgdGFibGVfYmFzZV9oKTsKK30KKworc3RhdGlj
IHZvaWQgdGlfcGF0X3Vuc2V0X3BhZ2Uoc3RydWN0IHRpX3BhdF9kYXRhICpwYXQsIHNpemVfdCBw
YWdlX2lkKQoreworCXVuc2lnbmVkIGludCBqID0gcGFnZV9pZCA+PiA4OworCXVuc2lnbmVkIGlu
dCBrID0gcGFnZV9pZCAmIDB4ZmY7CisJZG1hX2FkZHJfdCBvZmZzZXQgPSAoaiAqIDB4MTAwMCkg
KyAoayAqIDB4OCk7CisJdm9pZCBfX2lvbWVtICp0YWJsZV9iYXNlX2wgPSBwYXQtPnRhYmxlX2Jh
c2UgKyBvZmZzZXQ7CisJdm9pZCBfX2lvbWVtICp0YWJsZV9iYXNlX2ggPSB0YWJsZV9iYXNlX2wg
KyAweDQ7CisKKwlkZXZfZGJnKHBhdC0+ZGV2LCAiRGlzYWJsaW5nIFBBVCBpbmRleDogJXp1XG4i
LCBwYWdlX2lkKTsKKworCXdyaXRlbCgwLCB0YWJsZV9iYXNlX2gpOworfQorCitzdGF0aWMgc3Ry
dWN0IHNnX3RhYmxlICp0aV9wYXRfbWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0YWNobWVu
dCAqYXR0YWNobWVudCwKKwkJCQkJICAgZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9u
KQoreworCXN0cnVjdCB0aV9wYXRfZG1hX2J1Zl9hdHRhY2htZW50ICphID0gYXR0YWNobWVudC0+
cHJpdjsKKwlzdHJ1Y3QgdGlfcGF0X2J1ZmZlciAqYnVmZmVyID0gYS0+YnVmZmVyOworCXN0cnVj
dCB0aV9wYXRfZGF0YSAqcGF0ID0gYnVmZmVyLT5wYXQ7CisJc3RydWN0IHNnX3RhYmxlICp0YWJs
ZSA9IGEtPnRhYmxlOworCXN0cnVjdCBzY2F0dGVybGlzdCAqczsKKwl1bnNpZ25lZCBpbnQgaSwg
c19sZW47CisJc2l6ZV90IHBhZ2VfaWQ7CisJaW50IHJldDsKKworCW11dGV4X2xvY2soJmJ1ZmZl
ci0+bG9jayk7CisJLyogRmlyc3QgdGltZSBtYXBwaW5nIHdlIG1hcCB0byBwYXJlbnQgKi8KKwlp
ZiAoIWJ1ZmZlci0+bWFwX2NvdW50KSB7CisJCWJ1ZmZlci0+c2d0ID0gZG1hX2J1Zl9tYXBfYXR0
YWNobWVudChidWZmZXItPmF0dGFjaG1lbnQsIERNQV9CSURJUkVDVElPTkFMKTsKKwkJaWYgKElT
X0VSUihidWZmZXItPnNndCkpIHsKKwkJCWRldl9lcnIocGF0LT5kZXYsICJVbmFibGUgdG8gbWFw
IHBhcmVudCBETUEtQlVGXG4iKTsKKwkJCXJldHVybiBidWZmZXItPnNndDsKKwkJfQorCisJCS8q
IEFuZCBwcm9ncmFtIFBBVCBhcmVhIGZvciB0aGlzIHNldCBvZiBwYWdlcyAqLworCQlwYWdlX2lk
ID0gKGJ1ZmZlci0+b2Zmc2V0IC0gcGF0LT53aW5kb3dfYmFzZSkgLyBwYXQtPnBhZ2Vfc2l6ZTsK
KwkJZm9yX2VhY2hfc2coYnVmZmVyLT5zZ3QtPnNnbCwgcywgYnVmZmVyLT5zZ3QtPm5lbnRzLCBp
KSB7CisJCQlpZiAocy0+b2Zmc2V0KSB7CisJCQkJZGV2X2VycihwYXQtPmRldiwgIkNhbm5vdCB1
c2Ugb2Zmc2V0IGJ1ZmZlcnNcbiIpOworCQkJCXJldCA9IC1FSU5WQUw7CisJCQkJZ290byB1bm1h
cDsKKwkJCX0KKworCQkJaWYgKHMtPmxlbmd0aCAlIHBhdC0+cGFnZV9zaXplKSB7CisJCQkJZGV2
X2VycihwYXQtPmRldiwgIkNhbm5vdCB1c2UgYnVmZmVycyBub3QgYSBtdWx0aXBsZSBvZiBwYWdl
IHNpemVcbiIpOworCQkJCXJldCA9IC1FSU5WQUw7CisJCQkJZ290byB1bm1hcDsKKwkJCX0KKwor
CQkJZm9yIChzX2xlbiA9IDA7IHNfbGVuIDwgcy0+bGVuZ3RoOyBzX2xlbiArPSBwYXQtPnBhZ2Vf
c2l6ZSkKKwkJCQl0aV9wYXRfc2V0X3BhZ2UocGF0LCBwYWdlX2lkKyssIHMtPmRtYV9hZGRyZXNz
ICsgc19sZW4pOworCQl9CisJfQorCWJ1ZmZlci0+bWFwX2NvdW50Kys7CisJbXV0ZXhfdW5sb2Nr
KCZidWZmZXItPmxvY2spOworCisJLyogTWFwIHRoZSBhdHRhY2hlZCBkZXZpY2UncyB0YWJsZSB0
byBnZXQgRE1BIGFkZHJlc3NlcyAqLworCWlmICghZG1hX21hcF9zZ19hdHRycyhhdHRhY2htZW50
LT5kZXYsIHRhYmxlLT5zZ2wsIHRhYmxlLT5uZW50cywgZGlyZWN0aW9uLCBETUFfQVRUUl9TS0lQ
X0NQVV9TWU5DKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlyZXR1cm4gdGFibGU7
CisKK3VubWFwOgorCWRtYV9idWZfdW5tYXBfYXR0YWNobWVudChidWZmZXItPmF0dGFjaG1lbnQs
IGJ1ZmZlci0+c2d0LCBETUFfQklESVJFQ1RJT05BTCk7CisJcmV0dXJuIEVSUl9QVFIocmV0KTsK
K30KKworc3RhdGljIHZvaWQgdGlfcGF0X3VubWFwX2RtYV9idWYoc3RydWN0IGRtYV9idWZfYXR0
YWNobWVudCAqYXR0YWNobWVudCwKKwkJCQkgc3RydWN0IHNnX3RhYmxlICp0YWJsZSwKKwkJCQkg
ZW51bSBkbWFfZGF0YV9kaXJlY3Rpb24gZGlyZWN0aW9uKQoreworCXN0cnVjdCB0aV9wYXRfZG1h
X2J1Zl9hdHRhY2htZW50ICphID0gYXR0YWNobWVudC0+cHJpdjsKKwlzdHJ1Y3QgdGlfcGF0X2J1
ZmZlciAqYnVmZmVyID0gYS0+YnVmZmVyOworCXN0cnVjdCB0aV9wYXRfZGF0YSAqcGF0ID0gYnVm
ZmVyLT5wYXQ7CisKKwkvKiBVbm1hcCB0aGUgYXR0YWNoZWQgZGV2aWNlJ3MgdGFibGUgKi8KKwlk
bWFfdW5tYXBfc2dfYXR0cnMoYXR0YWNobWVudC0+ZGV2LCB0YWJsZS0+c2dsLCB0YWJsZS0+bmVu
dHMsIGRpcmVjdGlvbiwgRE1BX0FUVFJfU0tJUF9DUFVfU1lOQyk7CisKKwltdXRleF9sb2NrKCZi
dWZmZXItPmxvY2spOworCWJ1ZmZlci0+bWFwX2NvdW50LS07CisJLyogTGFzdCBtYXBwaW5nIHdl
IHVubWFwIGZyb20gcGFyZW50ICovCisJaWYgKCFidWZmZXItPm1hcF9jb3VudCkgeworCQkvKiBE
aXNhYmxlIFBBVCBwYWdlcyBmb3IgdGhpcyBhcmVhICovCisJCXNpemVfdCBwYWdlX3N0YXJ0ID0g
KGJ1ZmZlci0+b2Zmc2V0IC0gcGF0LT53aW5kb3dfYmFzZSkgLyBwYXQtPnBhZ2Vfc2l6ZTsKKwkJ
c2l6ZV90IHBhZ2VfZW5kID0gcGFnZV9zdGFydCArIChidWZmZXItPnNpemUgLyBwYXQtPnBhZ2Vf
c2l6ZSk7CisJCWZvciAoOyBwYWdlX3N0YXJ0IDwgcGFnZV9lbmQ7IHBhZ2Vfc3RhcnQrKykKKwkJ
CXRpX3BhdF91bnNldF9wYWdlKHBhdCwgcGFnZV9zdGFydCk7CisKKwkJZG1hX2J1Zl91bm1hcF9h
dHRhY2htZW50KGJ1ZmZlci0+YXR0YWNobWVudCwgYnVmZmVyLT5zZ3QsIERNQV9CSURJUkVDVElP
TkFMKTsKKwkJYnVmZmVyLT5zZ3QgPSBOVUxMOworCX0KKwltdXRleF91bmxvY2soJmJ1ZmZlci0+
bG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIHRpX3BhdF9kbWFfYnVmX3JlbGVhc2Uoc3RydWN0IGRt
YV9idWYgKmRtYWJ1ZikKK3sKKwlzdHJ1Y3QgdGlfcGF0X2J1ZmZlciAqYnVmZmVyID0gZG1hYnVm
LT5wcml2OworCisJaWYgKGJ1ZmZlci0+YXR0YWNobWVudCAmJiBidWZmZXItPnNndCkKKwkJZG1h
X2J1Zl91bm1hcF9hdHRhY2htZW50KGJ1ZmZlci0+YXR0YWNobWVudCwgYnVmZmVyLT5zZ3QsIERN
QV9CSURJUkVDVElPTkFMKTsKKwlpZiAoYnVmZmVyLT5pX2RtYV9idWYgJiYgIUlTX0VSUl9PUl9O
VUxMKGJ1ZmZlci0+YXR0YWNobWVudCkpCisJCWRtYV9idWZfZGV0YWNoKGJ1ZmZlci0+aV9kbWFf
YnVmLCBidWZmZXItPmF0dGFjaG1lbnQpOworCWlmIChidWZmZXItPmlfZG1hX2J1ZikKKwkJZG1h
X2J1Zl9wdXQoYnVmZmVyLT5pX2RtYV9idWYpOworCisJaWYgKGJ1ZmZlci0+b2Zmc2V0KQorCQln
ZW5fcG9vbF9mcmVlKGJ1ZmZlci0+cGF0LT5wb29sLCBidWZmZXItPm9mZnNldCwgYnVmZmVyLT5z
aXplKTsKKworCWtmcmVlKGJ1ZmZlcik7Cit9CisKK3ZvaWQgKnRpX3BhdF9kbWFfYnVmX21hcChz
dHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiwgdW5zaWduZWQgbG9uZyBwYWdlX251bSkKK3sKKwlyZXR1
cm4gTlVMTDsKK30KKworaW50IHRpX3BhdF9kbWFfYnVmX21tYXAoc3RydWN0IGRtYV9idWYgKmRt
YV9idWYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQoreworCXJldHVybiAtRUlOVkFMOwor
fQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9idWZfb3BzIGRtYV9idWZfb3BzID0geworCS5h
dHRhY2ggPSB0aV9wYXRfZG1hX2J1Zl9hdHRhY2gsCisJLmRldGFjaCA9IHRpX3BhdF9kbWFfYnVm
X2RldGF0Y2gsCisKKwkubWFwX2RtYV9idWYgPSB0aV9wYXRfbWFwX2RtYV9idWYsCisJLnVubWFw
X2RtYV9idWYgPSB0aV9wYXRfdW5tYXBfZG1hX2J1ZiwKKworCS5yZWxlYXNlID0gdGlfcGF0X2Rt
YV9idWZfcmVsZWFzZSwKKworCS5tYXAgPSB0aV9wYXRfZG1hX2J1Zl9tYXAsCisJLm1tYXAgPSB0
aV9wYXRfZG1hX2J1Zl9tbWFwLAorfTsKKworaW50IHRpX3BhdF9leHBvcnQoc3RydWN0IHRpX3Bh
dF9kYXRhICpwYXQsCisJCSAgc3RydWN0IGRtYV9idWYgKmlfZG1hX2J1ZiwKKwkJICBzdHJ1Y3Qg
ZG1hX2J1ZiAqKmVfZG1hX2J1ZikKK3sKKwlzdHJ1Y3QgdGlfcGF0X2J1ZmZlciAqYnVmZmVyOwor
CURFRklORV9ETUFfQlVGX0VYUE9SVF9JTkZPKGV4cF9pbmZvKTsKKwlpbnQgcmV0OworCisJYnVm
ZmVyID0ga3phbGxvYyhzaXplb2YoKmJ1ZmZlciksIEdGUF9LRVJORUwpOworCWlmICghYnVmZmVy
KQorCQlyZXR1cm4gLUVOT01FTTsKKworCWJ1ZmZlci0+cGF0ID0gcGF0OworCWJ1ZmZlci0+aV9k
bWFfYnVmID0gaV9kbWFfYnVmOworCWJ1ZmZlci0+c2l6ZSA9IGJ1ZmZlci0+aV9kbWFfYnVmLT5z
aXplOworCW11dGV4X2luaXQoJmJ1ZmZlci0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJmJ1ZmZl
ci0+YXR0YWNobWVudHMpOworCWJ1ZmZlci0+bWFwX2NvdW50ID0gMDsKKworCS8qIFJlc2VydmUg
UEFUIHNwYWNlICovCisJYnVmZmVyLT5vZmZzZXQgPSBnZW5fcG9vbF9hbGxvYyhidWZmZXItPnBh
dC0+cG9vbCwgYnVmZmVyLT5zaXplKTsKKwlpZiAoIWJ1ZmZlci0+b2Zmc2V0KSB7CisJCXJldCA9
IC1FTk9NRU07CisJCWdvdG8gZnJlZV9idWZmZXI7CisJfQorCisJZXhwX2luZm8ub3BzID0gJmRt
YV9idWZfb3BzOworCWV4cF9pbmZvLnNpemUgPSBidWZmZXItPnNpemU7CisJZXhwX2luZm8uZmxh
Z3MgPSBPX1JEV1I7CisJZXhwX2luZm8ucHJpdiA9IGJ1ZmZlcjsKKworCSplX2RtYV9idWYgPSBk
bWFfYnVmX2V4cG9ydCgmZXhwX2luZm8pOworCWlmIChJU19FUlIoKmVfZG1hX2J1ZikpIHsKKwkJ
cmV0ID0gUFRSX0VSUigqZV9kbWFfYnVmKTsKKwkJZ290byBmcmVlX3Bvb2w7CisJfQorCisJcmV0
dXJuIDA7CisKK2ZyZWVfcG9vbDoKKwlnZW5fcG9vbF9mcmVlKGJ1ZmZlci0+cGF0LT5wb29sLCBi
dWZmZXItPm9mZnNldCwgYnVmZmVyLT5zaXplKTsKK2ZyZWVfYnVmZmVyOgorCWtmcmVlKGJ1ZmZl
cik7CisJcmV0dXJuIHJldDsKK30KK0VYUE9SVF9TWU1CT0xfR1BMKHRpX3BhdF9leHBvcnQpOwor
CitzdGF0aWMgbG9uZyB0aV9wYXRfaW9jdGwoc3RydWN0IGZpbGUgKmZpbGUsIHVuc2lnbmVkIGlu
dCBjbWQsIHVuc2lnbmVkIGxvbmcgYXJnKQoreworCXN0cnVjdCB0aV9wYXRfZGF0YSAqcGF0ID0g
Y29udGFpbmVyX29mKGZpbGUtPnByaXZhdGVfZGF0YSwgc3RydWN0IHRpX3BhdF9kYXRhLCBtZGV2
KTsKKworCXN3aXRjaCAoY21kKSB7CisJY2FzZSBUSV9QQVRfSU9DX0VYUE9SVDoKKwl7CisJCXN0
cnVjdCB0aV9wYXRfZXhwb3J0X2RhdGEgZXhwb3J0OworCQlzdHJ1Y3QgZG1hX2J1ZiAqaV9kbWFf
YnVmOworCQlzdHJ1Y3QgZG1hX2J1ZiAqZV9kbWFfYnVmOworCQlpbnQgcmV0OworCisJCWlmIChf
SU9DX1NJWkUoY21kKSA+IHNpemVvZihleHBvcnQpKQorCQkJcmV0dXJuIC1FSU5WQUw7CisKKwkJ
aWYgKGNvcHlfZnJvbV91c2VyKCZleHBvcnQsICh2b2lkIF9fdXNlciAqKWFyZywgX0lPQ19TSVpF
KGNtZCkpKQorCQkJcmV0dXJuIC1FRkFVTFQ7CisKKwkJaV9kbWFfYnVmID0gZG1hX2J1Zl9nZXQo
ZXhwb3J0LmZkKTsKKwkJaWYgKElTX0VSUihpX2RtYV9idWYpKQorCQkJcmV0dXJuIFBUUl9FUlIo
aV9kbWFfYnVmKTsKKworCQlyZXQgPSB0aV9wYXRfZXhwb3J0KHBhdCwgaV9kbWFfYnVmLCAmZV9k
bWFfYnVmKTsKKwkJaWYgKHJldCkgeworCQkJZG1hX2J1Zl9wdXQoaV9kbWFfYnVmKTsKKwkJCXJl
dHVybiByZXQ7CisJCX0KKworCQlleHBvcnQuZmQgPSBkbWFfYnVmX2ZkKGVfZG1hX2J1ZiwgT19D
TE9FWEVDKTsKKwkJaWYgKGV4cG9ydC5mZCA8IDApIHsKKwkJCWRtYV9idWZfcHV0KGVfZG1hX2J1
Zik7CisJCQlkbWFfYnVmX3B1dChpX2RtYV9idWYpOworCQkJcmV0dXJuIGV4cG9ydC5mZDsKKwkJ
fQorCisJCWlmIChjb3B5X3RvX3VzZXIoKHZvaWQgX191c2VyICopYXJnLCAmZXhwb3J0LCBfSU9D
X1NJWkUoY21kKSkpCisJCQlyZXR1cm4gLUVGQVVMVDsKKworCQlicmVhazsKKwl9CisJZGVmYXVs
dDoKKwkJcmV0dXJuIC1FTk9UVFk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBjb25z
dCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHRpX3BhdF9mb3BzID0geworCS5vd25lciAgICAgICAg
ICA9IFRISVNfTU9EVUxFLAorCS51bmxvY2tlZF9pb2N0bCA9IHRpX3BhdF9pb2N0bCwKKyNpZmRl
ZiBDT05GSUdfQ09NUEFUCisJLmNvbXBhdF9pb2N0bAk9IHRpX3BhdF9pb2N0bCwKKyNlbmRpZgor
fTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBvZl9kZXZpY2VfaWQgdGlfcGF0X29mX21hdGNoW10g
PSB7CisJeyAuY29tcGF0aWJsZSA9ICJ0aSxqNzIxZS1wYXQiLCB9LAorCXsgLyogc2VudGluZWwg
Ki8gfSwKK307CitNT0RVTEVfREVWSUNFX1RBQkxFKG9mLCB0aV9wYXRfb2ZfbWF0Y2gpOworCitz
dGF0aWMgaW50IHRpX3BhdF9wcm9iZShzdHJ1Y3QgcGxhdGZvcm1fZGV2aWNlICpwZGV2KQorewor
CXN0cnVjdCB0aV9wYXRfZGF0YSAqcGF0OworCXN0cnVjdCByZXNvdXJjZSAqcmVzOworCXZvaWQg
X19pb21lbSAqYmFzZTsKKwl1bnNpZ25lZCBpbnQgcmV2aXNpb25fbWFqb3I7CisJdW5zaWduZWQg
aW50IHJldmlzaW9uX21pbm9yOworCXJlc291cmNlX3NpemVfdCBzaXplOworCXNpemVfdCBwYWdl
X3NpemU7CisJaW50IGksIHJldDsKKworCXBhdCA9IGRldm1fa3phbGxvYygmcGRldi0+ZGV2LCBz
aXplb2YoKnBhdCksIEdGUF9LRVJORUwpOworCWlmICghcGF0KQorCQlyZXR1cm4gLUVOT01FTTsK
KwlwbGF0Zm9ybV9zZXRfZHJ2ZGF0YShwZGV2LCBwYXQpOworCXBhdC0+ZGV2ID0gJnBkZXYtPmRl
djsKKworCS8qIE1NUlMgKi8KKwlyZXMgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2UocGRldiwgSU9S
RVNPVVJDRV9NRU0sIDApOworCWJhc2UgPSBkZXZtX2lvcmVtYXBfcmVzb3VyY2UocGF0LT5kZXYs
IHJlcyk7CisJaWYgKElTX0VSUihiYXNlKSkKKwkJcmV0dXJuIFBUUl9FUlIoYmFzZSk7CisKKwlw
YXQtPm1tcnNfbWFwID0gZGV2bV9yZWdtYXBfaW5pdF9tbWlvKHBhdC0+ZGV2LCBiYXNlLCAmdGlf
cGF0X3JlZ21hcF9jb25maWcpOworCWlmIChJU19FUlIocGF0LT5tbXJzX21hcCkpIHsKKwkJZGV2
X2VycihwYXQtPmRldiwgIlVuYWJsZSB0byBhbGxvY2F0ZSBNTVJTIHJlZ2lzdGVyIG1hcFxuIik7
CisJCXJldHVybiBQVFJfRVJSKHBhdC0+bW1yc19tYXApOworCX0KKworCWZvciAoaSA9IDA7IGkg
PCBGX01BWF9GSUVMRFM7IGkrKykgeworCQlwYXQtPm1tcnNfZmllbGRzW2ldID0gZGV2bV9yZWdt
YXBfZmllbGRfYWxsb2MocGF0LT5kZXYsIHBhdC0+bW1yc19tYXAsIHRpX3BhdF9tbXJzX3JlZ19m
aWVsZHNbaV0pOworCQlpZiAoSVNfRVJSKHBhdC0+bW1yc19maWVsZHNbaV0pKSB7CisJCQlkZXZf
ZXJyKHBhdC0+ZGV2LCAiVW5hYmxlIHRvIGFsbG9jYXRlIFJlZ21hcCBmaWVsZHNcbiIpOworCQkJ
cmV0dXJuIFBUUl9FUlIocGF0LT5tbXJzX2ZpZWxkc1tpXSk7CisJCX0KKwl9CisKKwlyZXQgPSBy
ZWdtYXBfcmVhZChwYXQtPm1tcnNfbWFwLCBUSV9QQVRfTU1SU19DT05GSUcsICZwYXQtPnBhZ2Vf
Y291bnQpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihwYXQtPmRldiwgIlVuYWJsZSB0byByZWFk
IGRldmljZSBwYWdlIGNvdW50XG4iKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXQgPSByZWdt
YXBfZmllbGRfcmVhZChwYXQtPm1tcnNfZmllbGRzW0ZfUElEX01BSk9SXSwgJnJldmlzaW9uX21h
am9yKTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIocGF0LT5kZXYsICJVbmFibGUgdG8gcmVhZCBk
ZXZpY2UgbWFqb3IgcmV2aXNpb25cbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldCA9IHJl
Z21hcF9maWVsZF9yZWFkKHBhdC0+bW1yc19maWVsZHNbRl9QSURfTUlOT1JdLCAmcmV2aXNpb25f
bWlub3IpOworCWlmIChyZXQpIHsKKwkJZGV2X2VycihwYXQtPmRldiwgIlVuYWJsZSB0byByZWFk
IGRldmljZSBtaW5vciByZXZpc2lvblxuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJZGV2X2lu
Zm8ocGF0LT5kZXYsICJGb3VuZCBQQVQgUmV2ICVkLiVkIHdpdGggJWQgcGFnZXNcbiIsIHJldmlz
aW9uX21ham9yLCByZXZpc2lvbl9taW5vciwgcGF0LT5wYWdlX2NvdW50KTsKKworCS8qIFRBQkxF
ICovCisJcmVzID0gcGxhdGZvcm1fZ2V0X3Jlc291cmNlKHBkZXYsIElPUkVTT1VSQ0VfTUVNLCAx
KTsKKwlpZiAoIXJlcykgeworCQlkZXZfZXJyKHBhdC0+ZGV2LCAiVW5hYmxlIHRvIGZpbmQgVEFC
TEUgSU8gcmVzb3VyY2VcbiIpOworCQlyZXR1cm4gLUVOT0VOVDsKKwl9CisJc2l6ZSA9IHJlc291
cmNlX3NpemUocmVzKTsKKworCS8qIDI1NiBwYWdlcyBwZXIgNEtCIG9mIHRhYmxlIHNwYWNlICov
CisJaWYgKHNpemUgIT0gKHBhdC0+cGFnZV9jb3VudCA8PCA0KSkKKwkJZGV2X3dhcm4ocGF0LT5k
ZXYsICJUQUJMRSByZWdpb24gc2l6ZSAoJWxsdSkgZG9lcyBub3QgbWF0Y2ggcmVwb3J0ZWQgcGFn
ZSBjb3VudFxuIiwgc2l6ZSk7CisKKwlwYXQtPnRhYmxlX2Jhc2UgPSBkZXZtX2lvcmVtYXBfcmVz
b3VyY2UocGF0LT5kZXYsIHJlcyk7CisJaWYgKElTX0VSUihiYXNlKSkKKwkJcmV0dXJuIFBUUl9F
UlIoYmFzZSk7CisKKwkvKiBXSU5ET1cgKi8KKwlyZXMgPSBwbGF0Zm9ybV9nZXRfcmVzb3VyY2Uo
cGRldiwgSU9SRVNPVVJDRV9NRU0sIDIpOworCWlmICghcmVzKSB7CisJCWRldl9lcnIocGF0LT5k
ZXYsICJVbmFibGUgdG8gZmluZCBXSU5ET1cgSU8gcmVzb3VyY2VcbiIpOworCQlyZXR1cm4gLUVO
T0VOVDsKKwl9CisJcGF0LT53aW5kb3dfYmFzZSA9IHJlcy0+c3RhcnQ7CisJc2l6ZSA9IHJlc291
cmNlX3NpemUocmVzKTsKKworCXBhdC0+cGFnZV9zaXplID0gUEFHRV9TSVpFOworCWZvciAocGFn
ZV9zaXplID0gMDsgcGFnZV9zaXplIDwgQVJSQVlfU0laRSh0aV9wYXRfcGFnZV9zaXplcyk7IHBh
Z2Vfc2l6ZSsrKQorCQlpZiAodGlfcGF0X3BhZ2Vfc2l6ZXNbcGFnZV9zaXplXSA9PSBwYXQtPnBh
Z2Vfc2l6ZSkKKwkJCWJyZWFrOworCWlmIChwYWdlX3NpemUgPT0gQVJSQVlfU0laRSh0aV9wYXRf
cGFnZV9zaXplcykpIHsKKwkJZGV2X2VycihwYXQtPmRldiwgIlVuc3VwcG9ydGVkIFBBR0VfU0la
RSAoJWQpXG4iLCBwYXQtPnBhZ2Vfc2l6ZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwlyZWdt
YXBfZmllbGRfd3JpdGUocGF0LT5tbXJzX2ZpZWxkc1tGX0NPTlRST0xfUEFHRV9TSVpFXSwgcGFn
ZV9zaXplKTsKKworCS8qIEVuYWJsZSB0aGlzIFBBVCBtb2R1bGUgKi8KKwlyZWdtYXBfZmllbGRf
d3JpdGUocGF0LT5tbXJzX2ZpZWxkc1tGX0NPTlRST0xfRU5dLCAxKTsKKworCXBhdC0+cG9vbCA9
IGdlbl9wb29sX2NyZWF0ZShQQUdFX1NISUZULCAtMSk7CisJaWYgKCFwYXQtPnBvb2wpCisJCXJl
dHVybiAtRU5PTUVNOworCWdlbl9wb29sX2FkZChwYXQtPnBvb2wsIHBhdC0+d2luZG93X2Jhc2Us
IHNpemUsIC0xKTsKKworCXBhdC0+bWRldi5taW5vciA9IE1JU0NfRFlOQU1JQ19NSU5PUjsKKwlw
YXQtPm1kZXYubmFtZSA9IHBkZXYtPm5hbWU7CisJcGF0LT5tZGV2LmZvcHMgPSAmdGlfcGF0X2Zv
cHM7CisJcGF0LT5tZGV2LnBhcmVudCA9IE5VTEw7CisJcmV0ID0gbWlzY19yZWdpc3RlcigmcGF0
LT5tZGV2KTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIocGF0LT5kZXYsICJVbmFibGUgdG8gcmVn
aXN0ZXIgbWlzYyBkZXZpY2VcbiIpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgc3RydWN0IHBsYXRmb3JtX2RyaXZlciB0aV9wYXRfZHJpdmVyID0geworCS5w
cm9iZSA9IHRpX3BhdF9wcm9iZSwKKwkuZHJpdmVyID0geworCQkubmFtZSA9IFRJX1BBVF9EUklW
RVJfTkFNRSwKKwkJLm9mX21hdGNoX3RhYmxlID0gdGlfcGF0X29mX21hdGNoLAorCX0sCit9Owor
bW9kdWxlX3BsYXRmb3JtX2RyaXZlcih0aV9wYXRfZHJpdmVyKTsKKworTU9EVUxFX0FVVEhPUigi
QW5kcmV3IEYuIERhdmlzIDxhZmRAdGkuY29tPiIpOworTU9EVUxFX0RFU0NSSVBUSU9OKCJUSSBQ
QVQgbWFwcGVkIERNQS1CVUYgbWVtb3J5IGV4cG9ydGVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BM
IHYyIik7CmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgvdGktcGF0LmggYi9pbmNsdWRl
L3VhcGkvbGludXgvdGktcGF0LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi5iMDZkNzk0NTQ4MTUKLS0tIC9kZXYvbnVsbAorKysgYi9pbmNsdWRlL3VhcGkvbGludXgv
dGktcGF0LmgKQEAgLTAsMCArMSw0NCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQ
TC0yLjAgV0lUSCBMaW51eC1zeXNjYWxsLW5vdGUgKi8KKy8qCisgKiBUSSBQQVQgbWFwcGVkIERN
QS1CVUYgbWVtb3J5IGV4cG9ydGVyIFVBUEkKKyAqCisgKiBDb3B5cmlnaHQgKEMpIDIwMTggVGV4
YXMgSW5zdHJ1bWVudHMgSW5jb3Jwb3JhdGVkIC0gaHR0cDovL3d3dy50aS5jb20vCisgKglBbmRy
ZXcgRi4gRGF2aXMgPGFmZEB0aS5jb20+CisgKi8KKworI2lmbmRlZiBfVUFQSV9MSU5VWF9USV9Q
QVRfSAorI2RlZmluZSBfVUFQSV9MSU5VWF9USV9QQVRfSAorCisjaW5jbHVkZSA8bGludXgvaW9j
dGwuaD4KKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCisvKioKKyAqIERPQzogVEkgUEFUIFVz
ZXJzcGFjZSBBUEkKKyAqCisgKiBjcmVhdGUgYSBjbGllbnQgYnkgb3BlbmluZyAvZGV2L3RpLXBh
dAorICogbW9zdCBvcGVyYXRpb25zIGhhbmRsZWQgdmlhIGZvbGxvd2luZyBpb2N0bHMKKyAqLwor
CisvKioKKyAqIHN0cnVjdCB0aV9wYXRfYWxsb2NhdGlvbl9kYXRhIC0gbWV0YWRhdGEgcGFzc2Vk
IGZyb20gdXNlcnNwYWNlIGZvciBhbGxvY2F0aW9ucworICogQGZkOgkJCXBvcHVsYXRlZCB3aXRo
IERNQS1CVUYgRkQgZm9yIHRoaXMgYWxsb2NhdGlvbgorICogQGZsYWdzOgkJZmxhZ3MgZm9yIHRo
ZSBhbGxvY2F0aW9uCisgKgorICogUHJvdmlkZWQgYnkgdXNlcnNwYWNlIGFzIGFuIGFyZ3VtZW50
IHRvIHRoZSBpb2N0bAorICovCitzdHJ1Y3QgdGlfcGF0X2V4cG9ydF9kYXRhIHsKKwlfX3UzMiBm
ZDsKKwlfX3UzMiBmbGFnczsKK307CisKKyNkZWZpbmUgVElfUEFUX0lPQ19NQUdJQyAnUCcKKwor
LyoqCisgKiBET0M6IFRJX1BBVF9JT0NfRVhQT1JUIC0gUmUtZXhwb3J0IERNQS1CVUYgdGhyb3Vn
aCBUSSBQQVQKKyAqCisgKiBUYWtlcyBhbiB0aV9wYXRfZXhwb3J0X2RhdGEgc3RydWN0IGFuZCBy
ZXR1cm5zIGl0IHdpdGggdGhlIGZkIGZpZWxkCisgKiBwb3B1bGF0ZWQgd2l0aCB0aGUgRE1BLUJV
RiBoYW5kbGUgZm9yIHRoZSBuZXcgZXhwb3J0LgorICovCisjZGVmaW5lIFRJX1BBVF9JT0NfRVhQ
T1JUIF9JT1dSKFRJX1BBVF9JT0NfTUFHSUMsIDAsIHN0cnVjdCB0aV9wYXRfZXhwb3J0X2RhdGEp
CisKKyNlbmRpZiAvKiBfVUFQSV9MSU5VWF9USV9QQVRfSCAqLwotLSAKMi4xNy4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGlu
ZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
