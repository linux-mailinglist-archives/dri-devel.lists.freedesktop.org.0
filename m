Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 06A731452B
	for <lists+dri-devel@lfdr.de>; Mon,  6 May 2019 09:28:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5F85F892A0;
	Mon,  6 May 2019 07:28:02 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-lf1-x144.google.com (mail-lf1-x144.google.com
 [IPv6:2a00:1450:4864:20::144])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D65E3892D6
 for <dri-devel@lists.freedesktop.org>; Sun,  5 May 2019 17:39:51 +0000 (UTC)
Received: by mail-lf1-x144.google.com with SMTP id y10so868685lfl.3
 for <dri-devel@lists.freedesktop.org>; Sun, 05 May 2019 10:39:51 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=CWUTPMHiOcRTWhYgTe83q9DaoJF+NVqYi7Gez6hex8k=;
 b=DPExBAwAV6xFsptfcr0dKuhcZlNn1rEY6FzNADNM85rSB8bJ6s4fbBx6rRRHizkc1N
 dAJ6CvnvS7ACDbRqc8k5OFT1zTyY8Na0AVMPXKEJhU9MpMNVpRMNat9qtWvzJU4VrK5E
 A2+T1GbYAPgXGAkdP4FydkDTawMdMLJ1e15Rj7R2WjVK/h7ezHnsIQwPdV2mrZLqnqHq
 P3vZR4efc+PTbKiF+Pc0lSeUKxd4hffRYs/owGBTHM7AA1ElMTqez9mbnu7wYr+Li5ju
 ivNueuyTuq/7hxncTXA8y23dzzevSWmC1WYuPI8AqxzHEHa8LKZz/JfLguphH2Ms/EuQ
 2BeA==
X-Gm-Message-State: APjAAAXz8WVYsEBr1CgnMp4Zewf0BITOZTdrn9V845HDdQ1tQAThWmNq
 MRujEo9Uqe5RLncqlECthTk=
X-Google-Smtp-Source: APXvYqzvQUDAfwQV+p7f+7tedRSN0dxpfYw4wclWHrIIQMfBIfLRbya4q4ThvWuZgEgSrpAN/as0tA==
X-Received: by 2002:a19:189:: with SMTP id 131mr8939344lfb.74.1557077990138;
 Sun, 05 May 2019 10:39:50 -0700 (PDT)
Received: from localhost.localdomain (ppp94-29-35-107.pppoe.spdop.ru.
 [94.29.35.107])
 by smtp.gmail.com with ESMTPSA id z17sm1626938lja.26.2019.05.05.10.39.49
 (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
 Sun, 05 May 2019 10:39:49 -0700 (PDT)
From: Dmitry Osipenko <digetx@gmail.com>
To: Thierry Reding <thierry.reding@gmail.com>
Subject: [PATCH v1 3/3] drm/tegra: Support PM QoS memory bandwidth management
Date: Sun,  5 May 2019 20:37:07 +0300
Message-Id: <20190505173707.29282-4-digetx@gmail.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190505173707.29282-1-digetx@gmail.com>
References: <20190505173707.29282-1-digetx@gmail.com>
MIME-Version: 1.0
X-Mailman-Approved-At: Mon, 06 May 2019 07:27:59 +0000
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=CWUTPMHiOcRTWhYgTe83q9DaoJF+NVqYi7Gez6hex8k=;
 b=XNmrl4RfFZmfqO9Q4qSI9nNINGxU5k7Ar9p6YeP01+s7Twia5QTAsqkkXD8yJxK0KI
 ksWftW5RoBnzSwyqs0YvWUQOEXI5kK1RhgiEKzz/a6FsSkuqMwe4zIUuLB9+Jtxf3AS6
 PTzn4rGW8ytu9Ad2T8pyRsOazQDG+I1SRynnKzAVoNMEdv6E+IjtWVo/4pi6p/4LqFD5
 6hU0xo567XESQ9iZWLeXzAaq0SJXTUaeN35x9IH/mOz4DDtwqQFPbrWTG74N3nHIt6N5
 dORZD0vAoc8tyGJzHPm6do6Guv9hyG2NefaH0WLDQtdlMqKj7ka13+CWg9V28NypYtP+
 it/w==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-tegra@vger.kernel.org, linux-kernel@vger.kernel.org,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RGlzcGxheSBjb250cm9sbGVyIChEQykgcGVyZm9ybXMgaXNvY2hyb25vdXMgbWVtb3J5IHRyYW5z
ZmVycyBhbmQgdGh1cwpoYXMgYSByZXF1aXJlbWVudCBmb3IgYSBtaW5pbXVtIG1lbW9yeSBiYW5k
d2lkdGggdGhhdCBzaGFsbCBiZSBmdWxmaWxsZWQsCm90aGVyd2lzZSBmcmFtZWJ1ZmZlciBkYXRh
IGNhbid0IGJlIGZldGNoZWQgZmFzdCBlbm91Z2ggYW5kIHRoaXMgcmVzdWx0cwppbiBhIERDJ3Mg
ZGF0YS1GSUZPIHVuZGVyZmxvdyB0aGF0IGZvbGxvd3MgYnkgYSB2aXN1YWwgY29ycnVwdGlvbi4K
ClRoZSBFeHRlcm5hbCBNZW1vcnkgQ29udHJvbGxlciBkcml2ZXJzIHdpbGwgcHJvdmlkZSBtZW1v
cnkgYmFuZHdpZHRoCm1hbmFnZW1lbnQgZmFjaWxpdHkgdmlhIHRoZSBnZW5lcmljIFBvd2VyIE1h
bmFnZW1lbnQgUW9TIEFQSSBzb29uaXNoLgpUaGlzIHBhdGNoIHdpcmVzIHVwIHRoZSBQTSBRb1Mg
QVBJIHN1cHBvcnQgZm9yIHRoZSBkaXNwbGF5IGRyaXZlcgpiZWZvcmVoYW5kLgoKRGlzcGxheSB3
b24ndCBoYXZlIHZpc3VhbCBjb3JydXB0aW9uIG9uIGNvbWluZyB1cCBmcm9tIHN1c3BlbmQgc3Rh
dGUgd2hlbgpkZXZmcmVxIGRyaXZlciBpcyBhY3RpdmUgb25jZSBhbGwgcHJlcmVxdWlzaXRlIGJp
dHMgd2lsbCBnZXQgdXBzdHJlYW1lZC4KVGhlIGRldmZyZXEgcmVhY3Rpb24gaGFzIGEgcXVpdGUg
c2lnbmlmaWNhbnQgbGF0ZW5jeSBhbmQgaXQgYWxzbyBkb2Vzbid0CnRha2UgaW50byBhY2NvdW50
IHRoZSBJU08gdHJhbnNmZXJzIHdoaWNoIG1heSByZXN1bHQgaW4gYXNzdW1wdGlvbiBhYm91dAps
b3dlciBtZW1vcnkgYmFuZHdpZHRoIHJlcXVpcmVtZW50IHRoYW4gYWN0dWFsbHkgbmVlZGVkLgoK
U2lnbmVkLW9mZi1ieTogRG1pdHJ5IE9zaXBlbmtvIDxkaWdldHhAZ21haWwuY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jICAgIHwgMjE2ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5oICAgIHwgICA4ICsrCiBkcml2
ZXJzL2dwdS9kcm0vdGVncmEvZHJtLmMgICB8ICAxOCArKysKIGRyaXZlcnMvZ3B1L2RybS90ZWdy
YS9wbGFuZS5jIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5oIHwgICA0ICst
CiA1IGZpbGVzIGNoYW5nZWQsIDI0NSBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jIGIvZHJpdmVycy9ncHUvZHJtL3Rl
Z3JhL2RjLmMKaW5kZXggNDFjYjY3ZGI2ZGJjLi44YzViOWU3MWNhNmYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9kYy5j
CkBAIC01MTQsNiArNTE0LDEwNyBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9kY19zZXR1cF93aW5kb3co
c3RydWN0IHRlZ3JhX3BsYW5lICpwbGFuZSwKIAkJdGVncmFfcGxhbmVfc2V0dXBfYmxlbmRpbmco
cGxhbmUsIHdpbmRvdyk7CiB9CiAKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYV9wbGFuZV9t
ZW1vcnlfYmFuZHdpZHRoKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlLAorCQkJICAgICBz
dHJ1Y3QgdGVncmFfZGNfd2luZG93ICp3aW5kb3cpCit7CisJc3RydWN0IHRlZ3JhX3BsYW5lX3N0
YXRlICp0ZWdyYV9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CisJ
c3RydWN0IHRlZ3JhX2RjX3dpbmRvdyB3aW47CisJdW5zaWduZWQgaW50IG11bDsKKwl1bnNpZ25l
ZCBpbnQgYnBwOworCWJvb2wgcGxhbmFyOworCWJvb2wgeXV2OworCisJaWYgKCFzdGF0ZS0+ZmIg
fHwgIXN0YXRlLT52aXNpYmxlKQorCQlyZXR1cm4gMDsKKworCWNydGNfc3RhdGUgPSBkcm1fYXRv
bWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZS0+c3RhdGUsIHN0YXRlLT5jcnRjKTsKKwl0ZWdy
YV9zdGF0ZSA9IHRvX3RlZ3JhX3BsYW5lX3N0YXRlKHN0YXRlKTsKKworCWlmICghd2luZG93KQor
CQl3aW5kb3cgPSAmd2luOworCisJd2luZG93LT5zcmMudyA9IGRybV9yZWN0X3dpZHRoKCZzdGF0
ZS0+c3JjKSA+PiAxNjsKKwl3aW5kb3ctPnNyYy5oID0gZHJtX3JlY3RfaGVpZ2h0KCZzdGF0ZS0+
c3JjKSA+PiAxNjsKKwl3aW5kb3ctPmRzdC53ID0gZHJtX3JlY3Rfd2lkdGgoJnN0YXRlLT5kc3Qp
OworCXdpbmRvdy0+ZHN0LmggPSBkcm1fcmVjdF9oZWlnaHQoJnN0YXRlLT5kc3QpOworCXdpbmRv
dy0+Zm9ybWF0ID0gdGVncmFfc3RhdGUtPmZvcm1hdDsKKwl3aW5kb3ctPnRpbGluZyA9IHRlZ3Jh
X3N0YXRlLT50aWxpbmc7CisKKwl5dXYgPSB0ZWdyYV9wbGFuZV9mb3JtYXRfaXNfeXV2KHdpbmRv
dy0+Zm9ybWF0LCAmcGxhbmFyKTsKKwlpZiAoIXl1diB8fCAhcGxhbmFyKQorCQlicHAgPSBzdGF0
ZS0+ZmItPmZvcm1hdC0+Y3BwWzBdICogODsKKwllbHNlCisJCWJwcCA9IDE2OworCisJLyoKKwkg
KiBIb3Jpem9udGFsIGRvd25zY2FsZSB0YWtlcyBleHRyYSBiYW5kd2lkdGggd2hpY2ggcm91Z2hs
eSBkZXBlbmRzCisJICogb24gdGhlIHNjYWxlZCB3aWR0aC4KKwkgKi8KKwlpZiAod2luZG93LT5z
cmMudyA+IHdpbmRvdy0+ZHN0LncpCisJCW11bCA9ICh3aW5kb3ctPnNyYy53IC0gd2luZG93LT5k
c3QudykgKiBicHAgLyAyMDQ4ICsgMTsKKwllbHNlCisJCW11bCA9IDE7CisKKwkvKgorCSAqIEln
bm9yZSB3aW5kb3cgaWYgaXRzIHdpZHRoIGlzIHNtYWxsIGVub3VnaCBzdWNoIHRoYXQgZGF0YS1w
cmVmZXRjaAorCSAqIEZJRk8gd2lsbCBlYXNpbHkgaGVscCB0byBvdmVyY29tZSB0ZW1wb3JhbCBt
ZW1vcnkgcHJlc3N1cmUuIFRoaXMgaXMKKwkgKiBhIHR5cGljYWwgY2FzZSBmb3IgdGhlIGN1cnNv
cidzIHBsYW5lLgorCSAqLworCWlmIChtdWwgPT0gMSAmJiB3aW5kb3ctPnNyYy53ICogYnBwIDw9
IDIwNDgpCisJCXJldHVybiAwOworCisJLyogbW9kZS5jbG9jayBpbiBrSHosIGJhbmR3aWR0aCBp
biBNYml0L3MgKi8KKwlyZXR1cm4gY3J0Y19zdGF0ZS0+bW9kZS5jbG9jayAvIDEwMDAgKiBicHAg
KiBtdWw7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYTIwX3BsYW5lX21lbW9yeV9i
YW5kd2lkdGgoc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJLyogeDI6IH41MCUg
ZWZmaWNpZW5jeSAqLworCXJldHVybiB0ZWdyYV9wbGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0YXRl
LCBOVUxMKSAqIDI7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYTMwX3BsYW5lX21l
bW9yeV9iYW5kd2lkdGgoc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0
IHRlZ3JhX2RjX3dpbmRvdyB3aW5kb3c7CisJdW5zaWduZWQgbG9uZyBiYW5kd2lkdGg7CisKKwli
YW5kd2lkdGggPSB0ZWdyYV9wbGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0YXRlLCAmd2luZG93KTsK
KworCS8qIHgyIG1lbW9yeSBvdmVyZmV0Y2ggZm9yIHRpbGVkIGZyYW1lYnVmZmVyIGFuZCBERFIz
ICovCisJaWYgKHdpbmRvdy50aWxpbmcubW9kZSA9PSBURUdSQV9CT19USUxJTkdfTU9ERV9USUxF
RCkKKwkJYmFuZHdpZHRoICo9IDI7CisKKwkvKiB4MjogfjUwJSBlZmZpY2llbmN5ICovCisJcmV0
dXJuIGJhbmR3aWR0aCAqIDI7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYTExNF9w
bGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQorewor
CXN0cnVjdCB0ZWdyYV9kY193aW5kb3cgd2luZG93OworCXVuc2lnbmVkIGxvbmcgYmFuZHdpZHRo
OworCisJYmFuZHdpZHRoID0gdGVncmFfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aChzdGF0ZSwgJndp
bmRvdyk7CisKKwkvKiB4MiBtZW1vcnkgb3ZlcmZldGNoIGZvciB0aWxlZCBmcmFtZWJ1ZmZlciBh
bmQgRERSMyAqLworCWlmICh3aW5kb3cudGlsaW5nLm1vZGUgPT0gVEVHUkFfQk9fVElMSU5HX01P
REVfVElMRUQpCisJCWJhbmR3aWR0aCAqPSAyOworCisJLyogMi1jaGFubmVsIG1lbW9yeSAqLwor
CXJldHVybiBiYW5kd2lkdGg7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBsb25nCit0ZWdyYTEyNF9w
bGFuZV9tZW1vcnlfYmFuZHdpZHRoKHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQorewor
CS8qIDY0Yml0IG1lbW9yeSBidXMgKi8KKwlyZXR1cm4gdGVncmFfcGxhbmVfbWVtb3J5X2JhbmR3
aWR0aChzdGF0ZSwgTlVMTCk7Cit9CisKIHN0YXRpYyBjb25zdCB1MzIgdGVncmEyMF9wcmltYXJ5
X2Zvcm1hdHNbXSA9IHsKIAlEUk1fRk9STUFUX0FSR0I0NDQ0LAogCURSTV9GT1JNQVRfQVJHQjE1
NTUsCkBAIC02MDMsOCArNzA0LDEwIEBAIHN0YXRpYyBpbnQgdGVncmFfcGxhbmVfYXRvbWljX2No
ZWNrKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWludCBlcnI7CiAKIAkvKiBubyBuZWVkIGZv
ciBmdXJ0aGVyIGNoZWNrcyBpZiB0aGUgcGxhbmUgaXMgYmVpbmcgZGlzYWJsZWQgKi8KLQlpZiAo
IXN0YXRlLT5jcnRjKQorCWlmICghc3RhdGUtPmNydGMpIHsKKwkJcGxhbmVfc3RhdGUtPm1lbW9y
eV9iYW5kd2lkdGggPSAwOwogCQlyZXR1cm4gMDsKKwl9CiAKIAllcnIgPSB0ZWdyYV9wbGFuZV9m
b3JtYXQoc3RhdGUtPmZiLT5mb3JtYXQtPmZvcm1hdCwKIAkJCQkgJnBsYW5lX3N0YXRlLT5mb3Jt
YXQsCkBAIC02NTcsNiArNzYwLDggQEAgc3RhdGljIGludCB0ZWdyYV9wbGFuZV9hdG9taWNfY2hl
Y2soc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKGVyciA8IDApCiAJCXJldHVybiBlcnI7
CiAKKwlwbGFuZV9zdGF0ZS0+bWVtb3J5X2JhbmR3aWR0aCA9IGRjLT5zb2MtPnBsYW5lX21lbW9y
eV9iYW5kd2lkdGgoc3RhdGUpOworCiAJcmV0dXJuIDA7CiB9CiAKQEAgLTExODcsNiArMTI5Miw3
IEBAIHRlZ3JhX2NydGNfYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMpCiAJY29weS0+cGNsayA9IHN0YXRlLT5wY2xrOwogCWNvcHktPmRpdiA9IHN0YXRlLT5kaXY7
CiAJY29weS0+cGxhbmVzID0gc3RhdGUtPnBsYW5lczsKKwljb3B5LT5tZW1vcnlfYmFuZHdpZHRo
ID0gc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGg7CiAKIAlyZXR1cm4gJmNvcHktPmJhc2U7CiB9CkBA
IC0xNzgwLDYgKzE4ODYsOSBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9jcnRjX2F0b21pY19kaXNhYmxl
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAlzcGluX3VubG9ja19pcnEoJmNydGMtPmRldi0+ZXZl
bnRfbG9jayk7CiAKIAlwbV9ydW50aW1lX3B1dF9zeW5jKGRjLT5kZXYpOworCisJcG1fcW9zX3Vw
ZGF0ZV9yZXF1ZXN0KCZkYy0+cG1fcW9zX3JlcSwKKwkJCSAgICAgIFBNX1FPU19NRU1PUllfQkFO
RFdJRFRIX0RFRkFVTFRfVkFMVUUpOwogfQogCiBzdGF0aWMgdm9pZCB0ZWdyYV9jcnRjX2F0b21p
Y19lbmFibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLApAQCAtMTc5MCw2ICsxODk5LDggQEAgc3Rh
dGljIHZvaWQgdGVncmFfY3J0Y19hdG9taWNfZW5hYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IAlzdHJ1Y3QgdGVncmFfZGMgKmRjID0gdG9fdGVncmFfZGMoY3J0Yyk7CiAJdTMyIHZhbHVlOwog
CisJcG1fcW9zX3VwZGF0ZV9yZXF1ZXN0KCZkYy0+cG1fcW9zX3JlcSwgc3RhdGUtPm1lbW9yeV9i
YW5kd2lkdGgpOworCiAJcG1fcnVudGltZV9nZXRfc3luYyhkYy0+ZGV2KTsKIAogCS8qIGluaXRp
YWxpemUgZGlzcGxheSBjb250cm9sbGVyICovCkBAIC0xODk5LDYgKzIwMTAsOSBAQCBzdGF0aWMg
dm9pZCB0ZWdyYV9jcnRjX2F0b21pY19lbmFibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogc3Rh
dGljIHZvaWQgdGVncmFfY3J0Y19hdG9taWNfYmVnaW4oc3RydWN0IGRybV9jcnRjICpjcnRjLAog
CQkJCSAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogeworCXN0cnVj
dCB0ZWdyYV9kY19zdGF0ZSAqZGNfb2xkX3N0YXRlID0gdG9fZGNfc3RhdGUob2xkX2NydGNfc3Rh
dGUpOworCXN0cnVjdCB0ZWdyYV9kY19zdGF0ZSAqZGNfc3RhdGUgPSB0b19kY19zdGF0ZShjcnRj
LT5zdGF0ZSk7CisJc3RydWN0IHRlZ3JhX2RjICpkYyA9IHRvX3RlZ3JhX2RjKGNydGMpOwogCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlpZiAoY3J0Yy0+c3RhdGUtPmV2ZW50KSB7CkBAIC0xOTEz
LDYgKzIwMjcsMjMgQEAgc3RhdGljIHZvaWQgdGVncmFfY3J0Y19hdG9taWNfYmVnaW4oc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCiAJCWNydGMtPnN0YXRlLT5ldmVudCA9IE5VTEw7CiAJfQorCisJ
aWYgKG9sZF9jcnRjX3N0YXRlICYmIG9sZF9jcnRjX3N0YXRlLT5hY3RpdmUpIHsKKwkJLyoKKwkJ
ICogUmFpc2UgbWVtb3J5IGJhbmR3aWR0aCBiZWZvcmUgY2hhbmdlcyB0YWtlIGVmZmVjdCBpZiBp
dAorCQkgKiBnb2VzIGZyb20gbG93IHRvIGhpZ2guCisJCSAqLworCQlpZiAoZGNfb2xkX3N0YXRl
LT5tZW1vcnlfYmFuZHdpZHRoIDwgZGNfc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGgpCisJCQlwbV9x
b3NfdXBkYXRlX3JlcXVlc3QoJmRjLT5wbV9xb3NfcmVxLAorCQkJCQkgICAgICBkY19zdGF0ZS0+
bWVtb3J5X2JhbmR3aWR0aCk7CisJfSBlbHNlIHsKKwkJLyoKKwkJICogUmFpc2UgbWVtb3J5IGJh
bmR3aWR0aCBiZWZvcmUgY2hhbmdlcyB0YWtlIGVmZmVjdCBpZgorCQkgKiBDUlRDIGlzIHR1cm5p
bmcgb24uCisJCSAqLworCQlwbV9xb3NfdXBkYXRlX3JlcXVlc3QoJmRjLT5wbV9xb3NfcmVxLAor
CQkJCSAgICAgIGRjX3N0YXRlLT5tZW1vcnlfYmFuZHdpZHRoKTsKKwl9CiB9CiAKIHN0YXRpYyB2
b2lkIHRlZ3JhX2NydGNfYXRvbWljX2ZsdXNoKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKQEAgLTE5
MzEsNyArMjA2Miw3OCBAQCBzdGF0aWMgdm9pZCB0ZWdyYV9jcnRjX2F0b21pY19mbHVzaChzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsCiAJdmFsdWUgPSB0ZWdyYV9kY19yZWFkbChkYywgRENfQ01EX1NU
QVRFX0NPTlRST0wpOwogfQogCitzdGF0aWMgYm9vbAordGVncmFfcGxhbmVfaW50ZXJzZWN0c193
aXRoX290aGVyX3BsYW5lKHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqc3RhdGUsCisJCQkJCWNvbnN0
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0IHN0cnVjdCBk
cm1fcGxhbmVfc3RhdGUgKm90aGVyX3N0YXRlOworCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOwor
CXN0cnVjdCBkcm1fcmVjdCByZWN0OworCisJZHJtX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNo
X3BsYW5lX3N0YXRlKHBsYW5lLCBvdGhlcl9zdGF0ZSwgc3RhdGUpIHsKKwkJcmVjdCA9IHBsYW5l
X3N0YXRlLT5kc3Q7CisKKwkJaWYgKG90aGVyX3N0YXRlID09IHBsYW5lX3N0YXRlKQorCQkJY29u
dGludWU7CisKKwkJaWYgKCFvdGhlcl9zdGF0ZS0+dmlzaWJsZSB8fCAhb3RoZXJfc3RhdGUtPmZi
KQorCQkJY29udGludWU7CisKKwkJaWYgKGRybV9yZWN0X2ludGVyc2VjdCgmcmVjdCwgJm90aGVy
X3N0YXRlLT5kc3QpKQorCQkJcmV0dXJuIHRydWU7CisJfQorCisJcmV0dXJuIGZhbHNlOworfQor
CitzdGF0aWMgaW50IHRlZ3JhX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0
YywKKwkJCQkgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCB0ZWdy
YV9kY19zdGF0ZSAqZGNfc3RhdGUgPSB0b19kY19zdGF0ZShzdGF0ZSk7CisJY29uc3Qgc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CisJY29uc3Qgc3RydWN0IHRlZ3JhX3BsYW5l
X3N0YXRlICp0ZWdyYTsKKwl1bnNpZ25lZCBsb25nIGJhbmR3aWR0aCA9IDA7CisJc3RydWN0IGRy
bV9wbGFuZSAqcGxhbmU7CisKKwkvKgorCSAqIEZvciBvdmVybGFwcGluZyBwbGFuZXMgcGl4ZWwn
cyBkYXRhIGlzIGZldGNoZWQgZm9yIGVhY2ggcGxhbmUgYXQKKwkgKiB0aGUgc2FtZSB0aW1lLCBo
ZW5jZSBiYW5kd2lkdGggaXMgYWNjdW11bGF0ZWQgaW4gdGhpcyBjYXNlLgorCSAqLworCWRybV9h
dG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwgcGxhbmVfc3RhdGUs
IHN0YXRlKSB7CisJCXRlZ3JhID0gdG9fdGVncmFfcGxhbmVfc3RhdGUocGxhbmVfc3RhdGUpOwor
CisJCWlmICh0ZWdyYV9wbGFuZV9pbnRlcnNlY3RzX3dpdGhfb3RoZXJfcGxhbmUoc3RhdGUsIHBs
YW5lX3N0YXRlKSkKKwkJCWJhbmR3aWR0aCArPSB0ZWdyYS0+bWVtb3J5X2JhbmR3aWR0aDsKKwkJ
ZWxzZQorCQkJYmFuZHdpZHRoID0gbWF4KGJhbmR3aWR0aCwgdGVncmEtPm1lbW9yeV9iYW5kd2lk
dGgpOworCX0KKworCWRjX3N0YXRlLT5tZW1vcnlfYmFuZHdpZHRoID0gYmFuZHdpZHRoOworCisJ
cmV0dXJuIDA7Cit9CisKK3ZvaWQgdGVncmFfY3J0Y19hdG9taWNfcG9zdF9jb21taXQoc3RydWN0
IGRybV9jcnRjICpjcnRjLAorCQkJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpCit7CisJc3RydWN0IHRlZ3JhX2RjX3N0YXRlICpkY19vbGRfc3RhdGUgPSB0b19kY19z
dGF0ZShvbGRfY3J0Y19zdGF0ZSk7CisJc3RydWN0IHRlZ3JhX2RjX3N0YXRlICpkY19zdGF0ZSA9
IHRvX2RjX3N0YXRlKGNydGMtPnN0YXRlKTsKKwlzdHJ1Y3QgdGVncmFfZGMgKmRjID0gdG9fdGVn
cmFfZGMoY3J0Yyk7CisKKwlpZiAoIWRjX29sZF9zdGF0ZSkKKwkJcmV0dXJuOworCisJLyoKKwkg
KiBEcm9wIG1lbW9yeSBiYW5kd2lkdGggYWZ0ZXIgY2hhbmdlcyB0YWtlIGVmZmVjdCBpZiBpdCBn
b2VzIGZyb20KKwkgKiBoaWdoIHRvIGxvdy4KKwkgKi8KKwlpZiAoZGNfb2xkX3N0YXRlLT5tZW1v
cnlfYmFuZHdpZHRoID4gZGNfc3RhdGUtPm1lbW9yeV9iYW5kd2lkdGgpCisJCXBtX3Fvc191cGRh
dGVfcmVxdWVzdCgmZGMtPnBtX3Fvc19yZXEsCisJCQkJICAgICAgZGNfc3RhdGUtPm1lbW9yeV9i
YW5kd2lkdGgpOworfQorCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2hlbHBlcl9mdW5j
cyB0ZWdyYV9jcnRjX2hlbHBlcl9mdW5jcyA9IHsKKwkuYXRvbWljX2NoZWNrID0gdGVncmFfY3J0
Y19hdG9taWNfY2hlY2ssCiAJLmF0b21pY19iZWdpbiA9IHRlZ3JhX2NydGNfYXRvbWljX2JlZ2lu
LAogCS5hdG9taWNfZmx1c2ggPSB0ZWdyYV9jcnRjX2F0b21pY19mbHVzaCwKIAkuYXRvbWljX2Vu
YWJsZSA9IHRlZ3JhX2NydGNfYXRvbWljX2VuYWJsZSwKQEAgLTIwODcsNiArMjI4OSw5IEBAIHN0
YXRpYyBpbnQgdGVncmFfZGNfaW5pdChzdHJ1Y3QgaG9zdDF4X2NsaWVudCAqY2xpZW50KQogCQln
b3RvIGNsZWFudXA7CiAJfQogCisJcG1fcW9zX2FkZF9yZXF1ZXN0KCZkYy0+cG1fcW9zX3JlcSwg
UE1fUU9TX01FTU9SWV9CQU5EV0lEVEgsCisJCQkgICBQTV9RT1NfTUVNT1JZX0JBTkRXSURUSF9E
RUZBVUxUX1ZBTFVFKTsKKwogCXJldHVybiAwOwogCiBjbGVhbnVwOgpAQCAtMjEwNyw2ICsyMzEy
LDggQEAgc3RhdGljIGludCB0ZWdyYV9kY19leGl0KHN0cnVjdCBob3N0MXhfY2xpZW50ICpjbGll
bnQpCiAJc3RydWN0IHRlZ3JhX2RjICpkYyA9IGhvc3QxeF9jbGllbnRfdG9fZGMoY2xpZW50KTsK
IAlpbnQgZXJyOwogCisJcG1fcW9zX3JlbW92ZV9yZXF1ZXN0KCZkYy0+cG1fcW9zX3JlcSk7CisK
IAlpZiAoIXRlZ3JhX2RjX2hhc193aW5kb3dfZ3JvdXBzKGRjKSkKIAkJcmV0dXJuIDA7CiAKQEAg
LTIxNDYsNiArMjM1Myw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8g
dGVncmEyMF9kY19zb2NfaW5mbyA9IHsKIAkubW9kaWZpZXJzID0gdGVncmEyMF9tb2RpZmllcnMs
CiAJLmhhc193aW5fYV93aXRob3V0X2ZpbHRlcnMgPSB0cnVlLAogCS5oYXNfd2luX2Nfd2l0aG91
dF92ZXJ0X2ZpbHRlciA9IHRydWUsCisJLnBsYW5lX21lbW9yeV9iYW5kd2lkdGggPSB0ZWdyYTIw
X3BsYW5lX21lbW9yeV9iYW5kd2lkdGgsCiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3Jh
X2RjX3NvY19pbmZvIHRlZ3JhMzBfZGNfc29jX2luZm8gPSB7CkBAIC0yMTY1LDYgKzIzNzMsNyBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvIHRlZ3JhMzBfZGNfc29jX2lu
Zm8gPSB7CiAJLm1vZGlmaWVycyA9IHRlZ3JhMjBfbW9kaWZpZXJzLAogCS5oYXNfd2luX2Ffd2l0
aG91dF9maWx0ZXJzID0gZmFsc2UsCiAJLmhhc193aW5fY193aXRob3V0X3ZlcnRfZmlsdGVyID0g
ZmFsc2UsCisJLnBsYW5lX21lbW9yeV9iYW5kd2lkdGggPSB0ZWdyYTMwX3BsYW5lX21lbW9yeV9i
YW5kd2lkdGgsCiB9OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvIHRl
Z3JhMTE0X2RjX3NvY19pbmZvID0gewpAQCAtMjE4NCw2ICsyMzkzLDcgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCB0ZWdyYV9kY19zb2NfaW5mbyB0ZWdyYTExNF9kY19zb2NfaW5mbyA9IHsKIAkubW9k
aWZpZXJzID0gdGVncmEyMF9tb2RpZmllcnMsCiAJLmhhc193aW5fYV93aXRob3V0X2ZpbHRlcnMg
PSBmYWxzZSwKIAkuaGFzX3dpbl9jX3dpdGhvdXRfdmVydF9maWx0ZXIgPSBmYWxzZSwKKwkucGxh
bmVfbWVtb3J5X2JhbmR3aWR0aCA9IHRlZ3JhMTE0X3BsYW5lX21lbW9yeV9iYW5kd2lkdGgsCiB9
OwogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvIHRlZ3JhMTI0X2RjX3Nv
Y19pbmZvID0gewpAQCAtMjIwMyw2ICsyNDEzLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdy
YV9kY19zb2NfaW5mbyB0ZWdyYTEyNF9kY19zb2NfaW5mbyA9IHsKIAkubW9kaWZpZXJzID0gdGVn
cmExMjRfbW9kaWZpZXJzLAogCS5oYXNfd2luX2Ffd2l0aG91dF9maWx0ZXJzID0gZmFsc2UsCiAJ
Lmhhc193aW5fY193aXRob3V0X3ZlcnRfZmlsdGVyID0gZmFsc2UsCisJLnBsYW5lX21lbW9yeV9i
YW5kd2lkdGggPSB0ZWdyYTEyNF9wbGFuZV9tZW1vcnlfYmFuZHdpZHRoLAogfTsKIAogc3RhdGlj
IGNvbnN0IHN0cnVjdCB0ZWdyYV9kY19zb2NfaW5mbyB0ZWdyYTIxMF9kY19zb2NfaW5mbyA9IHsK
QEAgLTIyMjIsNiArMjQzMyw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2lu
Zm8gdGVncmEyMTBfZGNfc29jX2luZm8gPSB7CiAJLm1vZGlmaWVycyA9IHRlZ3JhMTI0X21vZGlm
aWVycywKIAkuaGFzX3dpbl9hX3dpdGhvdXRfZmlsdGVycyA9IGZhbHNlLAogCS5oYXNfd2luX2Nf
d2l0aG91dF92ZXJ0X2ZpbHRlciA9IGZhbHNlLAorCS5wbGFuZV9tZW1vcnlfYmFuZHdpZHRoID0g
dGVncmExMjRfcGxhbmVfbWVtb3J5X2JhbmR3aWR0aCwKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgdGVncmFfd2luZG93Z3JvdXBfc29jIHRlZ3JhMTg2X2RjX3dncnBzW10gPSB7CkBAIC0yMjcw
LDYgKzI0ODIsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvIHRlZ3Jh
MTg2X2RjX3NvY19pbmZvID0gewogCS5oYXNfbnZkaXNwbGF5ID0gdHJ1ZSwKIAkud2dycHMgPSB0
ZWdyYTE4Nl9kY193Z3JwcywKIAkubnVtX3dncnBzID0gQVJSQVlfU0laRSh0ZWdyYTE4Nl9kY193
Z3JwcyksCisJLnBsYW5lX21lbW9yeV9iYW5kd2lkdGggPSB0ZWdyYTEyNF9wbGFuZV9tZW1vcnlf
YmFuZHdpZHRoLAogfTsKIAogc3RhdGljIGNvbnN0IHN0cnVjdCB0ZWdyYV93aW5kb3dncm91cF9z
b2MgdGVncmExOTRfZGNfd2dycHNbXSA9IHsKQEAgLTIzMTgsNiArMjUzMSw3IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgdGVncmFfZGNfc29jX2luZm8gdGVncmExOTRfZGNfc29jX2luZm8gPSB7CiAJ
Lmhhc19udmRpc3BsYXkgPSB0cnVlLAogCS53Z3JwcyA9IHRlZ3JhMTk0X2RjX3dncnBzLAogCS5u
dW1fd2dycHMgPSBBUlJBWV9TSVpFKHRlZ3JhMTk0X2RjX3dncnBzKSwKKwkucGxhbmVfbWVtb3J5
X2JhbmR3aWR0aCA9IHRlZ3JhMTI0X3BsYW5lX21lbW9yeV9iYW5kd2lkdGgsCiB9OwogCiBzdGF0
aWMgY29uc3Qgc3RydWN0IG9mX2RldmljZV9pZCB0ZWdyYV9kY19vZl9tYXRjaFtdID0gewpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RjLmggYi9kcml2ZXJzL2dwdS9kcm0vdGVn
cmEvZGMuaAppbmRleCBhYjI1MTU3Yzk0OGUuLmUyMjRmYjlkZDE4NyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL3RlZ3JhL2RjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RjLmgK
QEAgLTExLDYgKzExLDcgQEAKICNkZWZpbmUgVEVHUkFfRENfSCAxCiAKICNpbmNsdWRlIDxsaW51
eC9ob3N0MXguaD4KKyNpbmNsdWRlIDxsaW51eC9wbV9xb3MuaD4KIAogI2luY2x1ZGUgPGRybS9k
cm1fY3J0Yy5oPgogCkBAIC0yNiw2ICsyNyw4IEBAIHN0cnVjdCB0ZWdyYV9kY19zdGF0ZSB7CiAJ
dW5zaWduZWQgaW50IGRpdjsKIAogCXUzMiBwbGFuZXM7CisKKwl1bnNpZ25lZCBsb25nIG1lbW9y
eV9iYW5kd2lkdGg7CiB9OwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCB0ZWdyYV9kY19zdGF0ZSAq
dG9fZGNfc3RhdGUoc3RydWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKQEAgLTc0LDYgKzc3LDcg
QEAgc3RydWN0IHRlZ3JhX2RjX3NvY19pbmZvIHsKIAljb25zdCB1NjQgKm1vZGlmaWVyczsKIAli
b29sIGhhc193aW5fYV93aXRob3V0X2ZpbHRlcnM7CiAJYm9vbCBoYXNfd2luX2Nfd2l0aG91dF92
ZXJ0X2ZpbHRlcjsKKwl1bnNpZ25lZCBsb25nICgqcGxhbmVfbWVtb3J5X2JhbmR3aWR0aCkoc3Ry
dWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpOwogfTsKIAogc3RydWN0IHRlZ3JhX2RjIHsKQEAg
LTEwMCw2ICsxMDQsOCBAQCBzdHJ1Y3QgdGVncmFfZGMgewogCWNvbnN0IHN0cnVjdCB0ZWdyYV9k
Y19zb2NfaW5mbyAqc29jOwogCiAJc3RydWN0IGlvbW11X2dyb3VwICpncm91cDsKKworCXN0cnVj
dCBwbV9xb3NfcmVxdWVzdCBwbV9xb3NfcmVxOwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3Qg
dGVncmFfZGMgKgpAQCAtMTYwLDYgKzE2Niw4IEBAIGludCB0ZWdyYV9kY19zdGF0ZV9zZXR1cF9j
bG9jayhzdHJ1Y3QgdGVncmFfZGMgKmRjLAogCQkJICAgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgICBzdHJ1Y3QgY2xrICpjbGssIHVuc2lnbmVkIGxvbmcg
cGNsaywKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgZGl2KTsKK3ZvaWQgdGVncmFfY3J0Y19hdG9t
aWNfcG9zdF9jb21taXQoc3RydWN0IGRybV9jcnRjICpjcnRjLAorCQkJCSAgIHN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpOwogCiAvKiBmcm9tIHJnYi5jICovCiBpbnQgdGVn
cmFfZGNfcmdiX3Byb2JlKHN0cnVjdCB0ZWdyYV9kYyAqZGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3RlZ3JhL2RybS5jIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5jCmluZGV4
IDBjNWYxZTZhMDQ0Ni4uZDIwODBiZDdkMzkyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
dGVncmEvZHJtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3RlZ3JhL2RybS5jCkBAIC0xOSw2ICsx
OSw3IEBACiAjaW5jbHVkZSA8YXNtL2RtYS1pb21tdS5oPgogI2VuZGlmCiAKKyNpbmNsdWRlICJk
Yy5oIgogI2luY2x1ZGUgImRybS5oIgogI2luY2x1ZGUgImdlbS5oIgogCkBAIC01OCw2ICs1OSwy
MSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyB0ZWdyYV9kcm1f
bW9kZV9jb25maWdfZnVuY3MgPSB7CiAJLmF0b21pY19jb21taXQgPSBkcm1fYXRvbWljX2hlbHBl
cl9jb21taXQsCiB9OwogCitzdGF0aWMgdm9pZCB0ZWdyYV9hdG9taWNfcG9zdF9jb21taXQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRybSwKKwkJCQkgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpv
bGRfc3RhdGUpCit7CisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5l
d19jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKKwlpbnQgaTsKKworCWZvcl9l
YWNoX29sZG5ld19jcnRjX2luX3N0YXRlKG9sZF9zdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUs
IG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCWlmICghbmV3X2NydGNfc3RhdGUtPmFjdGl2ZSkKKwkJ
CWNvbnRpbnVlOworCisJCXRlZ3JhX2NydGNfYXRvbWljX3Bvc3RfY29tbWl0KGNydGMsIG9sZF9j
cnRjX3N0YXRlKTsKKwl9Cit9CisKIHN0YXRpYyB2b2lkIHRlZ3JhX2F0b21pY19jb21taXRfdGFp
bChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkcm0gPSBvbGRfc3RhdGUtPmRldjsKQEAgLTc0LDYgKzkwLDggQEAgc3RhdGljIHZvaWQg
dGVncmFfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3Rh
dGUpCiAJfSBlbHNlIHsKIAkJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X3RhaWxfcnBtKG9sZF9z
dGF0ZSk7CiAJfQorCisJdGVncmFfYXRvbWljX3Bvc3RfY29tbWl0KGRybSwgb2xkX3N0YXRlKTsK
IH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9jb25maWdfaGVscGVyX2Z1bmNzCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvcGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS90ZWdyYS9wbGFuZS5jCmluZGV4IDVhOGEzMzg3ZjVlZS4uZTdjZDIxYTBkN2Q5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEvcGxhbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
dGVncmEvcGxhbmUuYwpAQCAtNTgsNiArNTgsNyBAQCB0ZWdyYV9wbGFuZV9hdG9taWNfZHVwbGlj
YXRlX3N0YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lKQogCWNvcHktPnN3YXAgPSBzdGF0ZS0+
c3dhcDsKIAljb3B5LT5ib3R0b21fdXAgPSBzdGF0ZS0+Ym90dG9tX3VwOwogCWNvcHktPm9wYXF1
ZSA9IHN0YXRlLT5vcGFxdWU7CisJY29weS0+bWVtb3J5X2JhbmR3aWR0aCA9IHN0YXRlLT5tZW1v
cnlfYmFuZHdpZHRoOwogCiAJZm9yIChpID0gMDsgaSA8IDI7IGkrKykKIAkJY29weS0+YmxlbmRp
bmdbaV0gPSBzdGF0ZS0+YmxlbmRpbmdbaV07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
dGVncmEvcGxhbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS90ZWdyYS9wbGFuZS5oCmluZGV4IGU3OWU2
YjRhOGUwYS4uMzU3MTc0YmZmMmZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGVncmEv
cGxhbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vdGVncmEvcGxhbmUuaApAQCAtNTEsMTAgKzUx
LDEyIEBAIHN0cnVjdCB0ZWdyYV9wbGFuZV9zdGF0ZSB7CiAJLyogdXNlZCBmb3IgbGVnYWN5IGJs
ZW5kaW5nIHN1cHBvcnQgb25seSAqLwogCXN0cnVjdCB0ZWdyYV9wbGFuZV9sZWdhY3lfYmxlbmRp
bmdfc3RhdGUgYmxlbmRpbmdbMl07CiAJYm9vbCBvcGFxdWU7CisKKwl1bnNpZ25lZCBsb25nIG1l
bW9yeV9iYW5kd2lkdGg7CiB9OwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCB0ZWdyYV9wbGFuZV9z
dGF0ZSAqCi10b190ZWdyYV9wbGFuZV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpzdGF0
ZSkKK3RvX3RlZ3JhX3BsYW5lX3N0YXRlKGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0
YXRlKQogewogCWlmIChzdGF0ZSkKIAkJcmV0dXJuIGNvbnRhaW5lcl9vZihzdGF0ZSwgc3RydWN0
IHRlZ3JhX3BsYW5lX3N0YXRlLCBiYXNlKTsKLS0gCjIuMjEuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmkt
ZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
