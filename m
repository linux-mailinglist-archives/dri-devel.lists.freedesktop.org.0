Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B921D95335
	for <lists+dri-devel@lfdr.de>; Tue, 20 Aug 2019 03:18:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7C71A6E599;
	Tue, 20 Aug 2019 01:18:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from perceval.ideasonboard.com (perceval.ideasonboard.com
 [213.167.242.64])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8FE9C6E512
 for <dri-devel@lists.freedesktop.org>; Tue, 20 Aug 2019 01:17:46 +0000 (UTC)
Received: from pendragon.bb.dnainternet.fi
 (dfj612yhrgyx302h3jwwy-3.rev.dnainternet.fi
 [IPv6:2001:14ba:21f5:5b00:ce28:277f:58d7:3ca4])
 by perceval.ideasonboard.com (Postfix) with ESMTPSA id CF2E0D50;
 Tue, 20 Aug 2019 03:17:41 +0200 (CEST)
From: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 15/50] drm/bridge: tfp410: Replace manual connector
 handling with bridge
Date: Tue, 20 Aug 2019 04:16:46 +0300
Message-Id: <20190820011721.30136-16-laurent.pinchart@ideasonboard.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
References: <20190820011721.30136-1-laurent.pinchart@ideasonboard.com>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple;
 d=ideasonboard.com; s=mail; t=1566263862;
 bh=Yu8jBFVdv/bi/BOZ4RDCa1IgZvtZB18Wt9I8iOYKJGI=;
 h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
 b=hbdqHVtZjXjIgBc820bnxoxDLx/mW15o9/XfIB+oln3dXyRmPQ67zGt8j6QcFUXib
 l7Kn7YkJ2zpc1sz3smDv6Jr3u4Kz+21B1Hll5wZXS9+/W5m6sEvdwsPG2ir7G4UPmG
 1L9BeM2I9DzmFie2EnBG7hM6ApCUYJcaYJOCcTOM=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>,
 Tomi Valkeinen <tomi.valkeinen@ti.com>, Sean Paul <sean@poorly.run>,
 Sebastian Reichel <sebastian.reichel@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Tm93IHRoYXQgYSBkcml2ZXIgaXMgYXZhaWxhYmxlIGZvciBkaXNwbGF5IGNvbm5lY3RvcnMsIHJl
cGxhY2UgdGhlCm1hbnVhbCBjb25uZWN0b3IgaGFuZGxpbmcgY29kZSB3aXRoIHVzYWdlIG9mIHRo
ZSBEUk0gYnJpZGdlIEFQSS4gVGhlCnRmcDQxMCBkcml2ZXIgZG9lc24ndCBkZWFsIHdpdGggdGhl
IGRpc3BsYXkgY29ubmVjdG9yIGRpcmVjdGx5IGFueW1vcmUsCmJ1dCBzdGlsbCBkZWxlZ2F0ZXMg
ZHJtX2Nvbm5lY3RvciBvcGVyYXRpb25zIHRvIHRoZSBuZXh0IGJyaWRnZS4gVGhpcwpicmluZ3Mg
dXMgb25lIHN0ZXAgY2xvc2VyIHRvIGhhdmluZyB0aGUgdGZwNDEwIGRyaXZlciBoYW5kbGluZyB0
aGUKVEZQNDEwIG9ubHkuCgpTaWduZWQtb2ZmLWJ5OiBMYXVyZW50IFBpbmNoYXJ0IDxsYXVyZW50
LnBpbmNoYXJ0QGlkZWFzb25ib2FyZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90
aS10ZnA0MTAuYyB8IDE5NSArKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNo
YW5nZWQsIDY4IGluc2VydGlvbnMoKyksIDEyNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vYnJpZGdlL3RpLXRmcDQxMC5jIGIvZHJpdmVycy9ncHUvZHJtL2JyaWRn
ZS90aS10ZnA0MTAuYwppbmRleCA0YTQ2OGY0NGVmNjkuLjY1NjUxYWU2YzU1MyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2JyaWRnZS90aS10ZnA0MTAuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vYnJpZGdlL3RpLXRmcDQxMC5jCkBAIC00LDE0ICs0LDEyIEBACiAgKiBBdXRob3I6IEp5cmkg
U2FyaGEgPGpzYXJoYUB0aS5jb20+CiAgKi8KIAotI2luY2x1ZGUgPGxpbnV4L2RlbGF5Lmg+Ci0j
aW5jbHVkZSA8bGludXgvZndub2RlLmg+CiAjaW5jbHVkZSA8bGludXgvZ3Bpby9jb25zdW1lci5o
PgogI2luY2x1ZGUgPGxpbnV4L2kyYy5oPgotI2luY2x1ZGUgPGxpbnV4L2lycS5oPgogI2luY2x1
ZGUgPGxpbnV4L21vZHVsZS5oPgogI2luY2x1ZGUgPGxpbnV4L29mX2dyYXBoLmg+CiAjaW5jbHVk
ZSA8bGludXgvcGxhdGZvcm1fZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+
CiAKICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJt
X2JyaWRnZS5oPgpAQCAtMjQsMTYgKzIyLDEzIEBACiBzdHJ1Y3QgdGZwNDEwIHsKIAlzdHJ1Y3Qg
ZHJtX2JyaWRnZQlicmlkZ2U7CiAJc3RydWN0IGRybV9jb25uZWN0b3IJY29ubmVjdG9yOwotCXVu
c2lnbmVkIGludAkJY29ubmVjdG9yX3R5cGU7CiAKIAl1MzIJCQlidXNfZm9ybWF0OwotCXN0cnVj
dCBpMmNfYWRhcHRlcgkqZGRjOwotCXN0cnVjdCBncGlvX2Rlc2MJKmhwZDsKLQlpbnQJCQlocGRf
aXJxOwogCXN0cnVjdCBkZWxheWVkX3dvcmsJaHBkX3dvcms7CiAJc3RydWN0IGdwaW9fZGVzYwkq
cG93ZXJkb3duOwogCiAJc3RydWN0IGRybV9icmlkZ2VfdGltaW5ncyB0aW1pbmdzOworCXN0cnVj
dCBkcm1fYnJpZGdlCSpuZXh0X2JyaWRnZTsKIAogCXN0cnVjdCBkZXZpY2UgKmRldjsKIH07CkBA
IC01NiwxMCArNTEsMTAgQEAgc3RhdGljIGludCB0ZnA0MTBfZ2V0X21vZGVzKHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IpCiAJc3RydWN0IGVkaWQgKmVkaWQ7CiAJaW50IHJldDsKIAot
CWlmICghZHZpLT5kZGMpCisJaWYgKCEoZHZpLT5uZXh0X2JyaWRnZS0+b3BzICYgRFJNX0JSSURH
RV9PUF9FRElEKSkKIAkJZ290byBmYWxsYmFjazsKIAotCWVkaWQgPSBkcm1fZ2V0X2VkaWQoY29u
bmVjdG9yLCBkdmktPmRkYyk7CisJZWRpZCA9IGR2aS0+bmV4dF9icmlkZ2UtPmZ1bmNzLT5nZXRf
ZWRpZChkdmktPm5leHRfYnJpZGdlLCBjb25uZWN0b3IpOwogCWlmICghZWRpZCkgewogCQlkZXZf
aW5mbyhkdmktPmRldiwKIAkJCSAiRURJRCByZWFkIGZhaWxlZC4gRmFsbGJhY2sgdG8gc3RhbmRh
cmQgbW9kZXNcbiIpOwpAQCAtOTMsMjEgKzg4LDEwIEBAIHRmcDQxMF9jb25uZWN0b3JfZGV0ZWN0
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCiB7CiAJc3RydWN0
IHRmcDQxMCAqZHZpID0gZHJtX2Nvbm5lY3Rvcl90b190ZnA0MTAoY29ubmVjdG9yKTsKIAotCWlm
IChkdmktPmhwZCkgewotCQlpZiAoZ3Bpb2RfZ2V0X3ZhbHVlX2NhbnNsZWVwKGR2aS0+aHBkKSkK
LQkJCXJldHVybiBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZDsKLQkJZWxzZQotCQkJcmV0dXJu
IGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVjdGVkOwotCX0KKwlpZiAoIShkdmktPm5leHRfYnJp
ZGdlLT5vcHMgJiBEUk1fQlJJREdFX09QX0RFVEVDVCkpCisJCXJldHVybiBjb25uZWN0b3Jfc3Rh
dHVzX3Vua25vd247CiAKLQlpZiAoZHZpLT5kZGMpIHsKLQkJaWYgKGRybV9wcm9iZV9kZGMoZHZp
LT5kZGMpKQotCQkJcmV0dXJuIGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkOwotCQllbHNlCi0J
CQlyZXR1cm4gY29ubmVjdG9yX3N0YXR1c19kaXNjb25uZWN0ZWQ7Ci0JfQotCi0JcmV0dXJuIGNv
bm5lY3Rvcl9zdGF0dXNfdW5rbm93bjsKKwlyZXR1cm4gZHZpLT5uZXh0X2JyaWRnZS0+ZnVuY3Mt
PmRldGVjdChkdmktPm5leHRfYnJpZGdlKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX2Z1bmNzIHRmcDQxMF9jb25fZnVuY3MgPSB7CkBAIC0xMTksMTIgKzEwMywzNSBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfZnVuY3MgdGZwNDEwX2Nvbl9mdW5j
cyA9IHsKIAkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUJPSBkcm1fYXRvbWljX2hlbHBlcl9jb25uZWN0
b3JfZGVzdHJveV9zdGF0ZSwKIH07CiAKK3N0YXRpYyB2b2lkIHRmcDQxMF9ocGRfd29ya19mdW5j
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgdGZwNDEwICpkdmk7CisKKwlk
dmkgPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IHRmcDQxMCwgaHBkX3dvcmsud29yayk7CisK
KwlpZiAoZHZpLT5icmlkZ2UuZGV2KQorCQlkcm1faGVscGVyX2hwZF9pcnFfZXZlbnQoZHZpLT5i
cmlkZ2UuZGV2KTsKK30KKworc3RhdGljIHZvaWQgdGZwNDEwX2hwZF9jYWxsYmFjayh2b2lkICph
cmcsIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMgc3RhdHVzKQoreworCXN0cnVjdCB0ZnA0MTAg
KmR2aSA9IGFyZzsKKworCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmZHZpLT5ocGRfd29y
aywKKwkJCSBtc2Vjc190b19qaWZmaWVzKEhPVFBMVUdfREVCT1VOQ0VfTVMpKTsKK30KKwogc3Rh
dGljIGludCB0ZnA0MTBfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCQkgZW51
bSBkcm1fYnJpZGdlX2F0dGFjaF9mbGFncyBmbGFncykKIHsKIAlzdHJ1Y3QgdGZwNDEwICpkdmkg
PSBkcm1fYnJpZGdlX3RvX3RmcDQxMChicmlkZ2UpOwogCWludCByZXQ7CiAKKwlyZXQgPSBkcm1f
YnJpZGdlX2F0dGFjaChicmlkZ2UtPmVuY29kZXIsIGR2aS0+bmV4dF9icmlkZ2UsIGJyaWRnZSwK
KwkJCQlEUk1fQlJJREdFX0FUVEFDSF9OT19DT05ORUNUT1IpOworCWlmIChyZXQgPCAwKQorCQly
ZXR1cm4gcmV0OworCiAJaWYgKGZsYWdzICYgRFJNX0JSSURHRV9BVFRBQ0hfTk9fQ09OTkVDVE9S
KQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtMTMzLDE3ICsxNDAsMjMgQEAgc3RhdGljIGludCB0
ZnA0MTBfYXR0YWNoKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCXJldHVybiAtRU5PREVW
OwogCX0KIAotCWlmIChkdmktPmhwZF9pcnEgPj0gMCkKKwlpZiAoZHZpLT5uZXh0X2JyaWRnZS0+
b3BzICYgRFJNX0JSSURHRV9PUF9ERVRFQ1QpCiAJCWR2aS0+Y29ubmVjdG9yLnBvbGxlZCA9IERS
TV9DT05ORUNUT1JfUE9MTF9IUEQ7CiAJZWxzZQogCQlkdmktPmNvbm5lY3Rvci5wb2xsZWQgPSBE
Uk1fQ09OTkVDVE9SX1BPTExfQ09OTkVDVCB8IERSTV9DT05ORUNUT1JfUE9MTF9ESVNDT05ORUNU
OwogCisJaWYgKGR2aS0+bmV4dF9icmlkZ2UtPm9wcyAmIERSTV9CUklER0VfT1BfSFBEKSB7CisJ
CUlOSVRfREVMQVlFRF9XT1JLKCZkdmktPmhwZF93b3JrLCB0ZnA0MTBfaHBkX3dvcmtfZnVuYyk7
CisJCWRybV9icmlkZ2VfaHBkX2VuYWJsZShkdmktPm5leHRfYnJpZGdlLCB0ZnA0MTBfaHBkX2Nh
bGxiYWNrLAorCQkJCSAgICAgIGR2aSk7CisJfQorCiAJZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRk
KCZkdmktPmNvbm5lY3RvciwKIAkJCQkgJnRmcDQxMF9jb25faGVscGVyX2Z1bmNzKTsKIAlyZXQg
PSBkcm1fY29ubmVjdG9yX2luaXRfd2l0aF9kZGMoYnJpZGdlLT5kZXYsICZkdmktPmNvbm5lY3Rv
ciwKIAkJCQkJICAmdGZwNDEwX2Nvbl9mdW5jcywKLQkJCQkJICBkdmktPmNvbm5lY3Rvcl90eXBl
LAotCQkJCQkgIGR2aS0+ZGRjKTsKKwkJCQkJICBkdmktPm5leHRfYnJpZGdlLT50eXBlLAorCQkJ
CQkgIGR2aS0+bmV4dF9icmlkZ2UtPmRkYyk7CiAJaWYgKHJldCkgewogCQlkZXZfZXJyKGR2aS0+
ZGV2LCAiZHJtX2Nvbm5lY3Rvcl9pbml0KCkgZmFpbGVkOiAlZFxuIiwgcmV0KTsKIAkJcmV0dXJu
IHJldDsKQEAgLTE1MiwxMiArMTY1LDIxIEBAIHN0YXRpYyBpbnQgdGZwNDEwX2F0dGFjaChzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogCWRybV9kaXNwbGF5X2luZm9fc2V0X2J1c19mb3JtYXRz
KCZkdmktPmNvbm5lY3Rvci5kaXNwbGF5X2luZm8sCiAJCQkJCSAmZHZpLT5idXNfZm9ybWF0LCAx
KTsKIAotCWRybV9jb25uZWN0b3JfYXR0YWNoX2VuY29kZXIoJmR2aS0+Y29ubmVjdG9yLAotCQkJ
CQkgIGJyaWRnZS0+ZW5jb2Rlcik7CisJZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfZW5jb2RlcigmZHZp
LT5jb25uZWN0b3IsIGJyaWRnZS0+ZW5jb2Rlcik7CiAKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGlj
IHZvaWQgdGZwNDEwX2RldGFjaChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVj
dCB0ZnA0MTAgKmR2aSA9IGRybV9icmlkZ2VfdG9fdGZwNDEwKGJyaWRnZSk7CisKKwlpZiAoZHZp
LT5jb25uZWN0b3IuZGV2ICYmIGR2aS0+bmV4dF9icmlkZ2UtPm9wcyAmIERSTV9CUklER0VfT1Bf
SFBEKSB7CisJCWRybV9icmlkZ2VfaHBkX2Rpc2FibGUoZHZpLT5uZXh0X2JyaWRnZSk7CisJCWNh
bmNlbF9kZWxheWVkX3dvcmtfc3luYygmZHZpLT5ocGRfd29yayk7CisJfQorfQorCiBzdGF0aWMg
dm9pZCB0ZnA0MTBfZW5hYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiB7CiAJc3RydWN0
IHRmcDQxMCAqZHZpID0gZHJtX2JyaWRnZV90b190ZnA0MTAoYnJpZGdlKTsKQEAgLTE3NCwzMCAr
MTk2LDExIEBAIHN0YXRpYyB2b2lkIHRmcDQxMF9kaXNhYmxlKHN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2UpCiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB0ZnA0MTBfYnJp
ZGdlX2Z1bmNzID0gewogCS5hdHRhY2gJCT0gdGZwNDEwX2F0dGFjaCwKKwkuZGV0YWNoCQk9IHRm
cDQxMF9kZXRhY2gsCiAJLmVuYWJsZQkJPSB0ZnA0MTBfZW5hYmxlLAogCS5kaXNhYmxlCT0gdGZw
NDEwX2Rpc2FibGUsCiB9OwogCi1zdGF0aWMgdm9pZCB0ZnA0MTBfaHBkX3dvcmtfZnVuYyhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17Ci0Jc3RydWN0IHRmcDQxMCAqZHZpOwotCi0JZHZpID0g
Y29udGFpbmVyX29mKHdvcmssIHN0cnVjdCB0ZnA0MTAsIGhwZF93b3JrLndvcmspOwotCi0JaWYg
KGR2aS0+YnJpZGdlLmRldikKLQkJZHJtX2hlbHBlcl9ocGRfaXJxX2V2ZW50KGR2aS0+YnJpZGdl
LmRldik7Ci19Ci0KLXN0YXRpYyBpcnFyZXR1cm5fdCB0ZnA0MTBfaHBkX2lycV90aHJlYWQoaW50
IGlycSwgdm9pZCAqYXJnKQotewotCXN0cnVjdCB0ZnA0MTAgKmR2aSA9IGFyZzsKLQotCW1vZF9k
ZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmZHZpLT5ocGRfd29yaywKLQkJCW1zZWNzX3RvX2ppZmZp
ZXMoSE9UUExVR19ERUJPVU5DRV9NUykpOwotCi0JcmV0dXJuIElSUV9IQU5ETEVEOwotfQotCiBz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9icmlkZ2VfdGltaW5ncyB0ZnA0MTBfZGVmYXVsdF90aW1p
bmdzID0gewogCS5pbnB1dF9idXNfZmxhZ3MgPSBEUk1fQlVTX0ZMQUdfUElYREFUQV9TQU1QTEVf
UE9TRURHRQogCQkJIHwgRFJNX0JVU19GTEFHX0RFX0hJR0gsCkBAIC0yNzUsNTEgKzI3OCw5IEBA
IHN0YXRpYyBpbnQgdGZwNDEwX3BhcnNlX3RpbWluZ3Moc3RydWN0IHRmcDQxMCAqZHZpLCBib29s
IGkyYykKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCB0ZnA0MTBfZ2V0X2Nvbm5lY3Rvcl9w
cm9wZXJ0aWVzKHN0cnVjdCB0ZnA0MTAgKmR2aSkKLXsKLQlzdHJ1Y3QgZGV2aWNlX25vZGUgKmNv
bm5lY3Rvcl9ub2RlLCAqZGRjX3BoYW5kbGU7Ci0JaW50IHJldCA9IDA7Ci0KLQkvKiBwb3J0QDEg
aXMgdGhlIGNvbm5lY3RvciBub2RlICovCi0JY29ubmVjdG9yX25vZGUgPSBvZl9ncmFwaF9nZXRf
cmVtb3RlX25vZGUoZHZpLT5kZXYtPm9mX25vZGUsIDEsIC0xKTsKLQlpZiAoIWNvbm5lY3Rvcl9u
b2RlKQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCWlmIChvZl9kZXZpY2VfaXNfY29tcGF0aWJsZShj
b25uZWN0b3Jfbm9kZSwgImhkbWktY29ubmVjdG9yIikpCi0JCWR2aS0+Y29ubmVjdG9yX3R5cGUg
PSBEUk1fTU9ERV9DT05ORUNUT1JfSERNSUE7Ci0JZWxzZQotCQlkdmktPmNvbm5lY3Rvcl90eXBl
ID0gRFJNX01PREVfQ09OTkVDVE9SX0RWSUQ7Ci0KLQlkdmktPmhwZCA9IGZ3bm9kZV9nZXRfbmFt
ZWRfZ3Bpb2QoJmNvbm5lY3Rvcl9ub2RlLT5md25vZGUsCi0JCQkJCSJocGQtZ3Bpb3MiLCAwLCBH
UElPRF9JTiwgImhwZCIpOwotCWlmIChJU19FUlIoZHZpLT5ocGQpKSB7Ci0JCXJldCA9IFBUUl9F
UlIoZHZpLT5ocGQpOwotCQlkdmktPmhwZCA9IE5VTEw7Ci0JCWlmIChyZXQgPT0gLUVOT0VOVCkK
LQkJCXJldCA9IDA7Ci0JCWVsc2UKLQkJCWdvdG8gZmFpbDsKLQl9Ci0KLQlkZGNfcGhhbmRsZSA9
IG9mX3BhcnNlX3BoYW5kbGUoY29ubmVjdG9yX25vZGUsICJkZGMtaTJjLWJ1cyIsIDApOwotCWlm
ICghZGRjX3BoYW5kbGUpCi0JCWdvdG8gZmFpbDsKLQotCWR2aS0+ZGRjID0gb2ZfZ2V0X2kyY19h
ZGFwdGVyX2J5X25vZGUoZGRjX3BoYW5kbGUpOwotCWlmIChkdmktPmRkYykKLQkJZGV2X2luZm8o
ZHZpLT5kZXYsICJDb25uZWN0b3IncyBkZGMgaTJjIGJ1cyBmb3VuZFxuIik7Ci0JZWxzZQotCQly
ZXQgPSAtRVBST0JFX0RFRkVSOwotCi0Jb2Zfbm9kZV9wdXQoZGRjX3BoYW5kbGUpOwotCi1mYWls
OgotCW9mX25vZGVfcHV0KGNvbm5lY3Rvcl9ub2RlKTsKLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0
aWMgaW50IHRmcDQxMF9pbml0KHN0cnVjdCBkZXZpY2UgKmRldiwgYm9vbCBpMmMpCiB7CisJc3Ry
dWN0IGRldmljZV9ub2RlICpub2RlOwogCXN0cnVjdCB0ZnA0MTAgKmR2aTsKIAlpbnQgcmV0Owog
CkBAIC0zMzEsMjEgKzI5MiwzMSBAQCBzdGF0aWMgaW50IHRmcDQxMF9pbml0KHN0cnVjdCBkZXZp
Y2UgKmRldiwgYm9vbCBpMmMpCiAJZHZpID0gZGV2bV9remFsbG9jKGRldiwgc2l6ZW9mKCpkdmkp
LCBHRlBfS0VSTkVMKTsKIAlpZiAoIWR2aSkKIAkJcmV0dXJuIC1FTk9NRU07CisKKwlkdmktPmRl
diA9IGRldjsKIAlkZXZfc2V0X2RydmRhdGEoZGV2LCBkdmkpOwogCiAJZHZpLT5icmlkZ2UuZnVu
Y3MgPSAmdGZwNDEwX2JyaWRnZV9mdW5jczsKIAlkdmktPmJyaWRnZS5vZl9ub2RlID0gZGV2LT5v
Zl9ub2RlOwogCWR2aS0+YnJpZGdlLnRpbWluZ3MgPSAmZHZpLT50aW1pbmdzOwotCWR2aS0+ZGV2
ID0gZGV2OworCWR2aS0+YnJpZGdlLnR5cGUgPSBEUk1fTU9ERV9DT05ORUNUT1JfRFZJRDsKIAog
CXJldCA9IHRmcDQxMF9wYXJzZV90aW1pbmdzKGR2aSwgaTJjKTsKIAlpZiAocmV0KQotCQlnb3Rv
IGZhaWw7CisJCXJldHVybiByZXQ7CiAKLQlyZXQgPSB0ZnA0MTBfZ2V0X2Nvbm5lY3Rvcl9wcm9w
ZXJ0aWVzKGR2aSk7Ci0JaWYgKHJldCkKLQkJZ290byBmYWlsOworCS8qIEdldCB0aGUgbmV4dCBi
cmlkZ2UsIGNvbm5lY3RlZCB0byBwb3J0QDEuICovCisJbm9kZSA9IG9mX2dyYXBoX2dldF9yZW1v
dGVfbm9kZShkZXYtPm9mX25vZGUsIDEsIC0xKTsKKwlpZiAoIW5vZGUpCisJCXJldHVybiAtRU5P
REVWOwogCisJZHZpLT5uZXh0X2JyaWRnZSA9IG9mX2RybV9maW5kX2JyaWRnZShub2RlKTsKKwlv
Zl9ub2RlX3B1dChub2RlKTsKKworCWlmICghZHZpLT5uZXh0X2JyaWRnZSkKKwkJcmV0dXJuIC1F
UFJPQkVfREVGRVI7CisKKwkvKiBHZXQgdGhlIHBvd2VyZG93biBHUElPLiAqLwogCWR2aS0+cG93
ZXJkb3duID0gZGV2bV9ncGlvZF9nZXRfb3B0aW9uYWwoZGV2LCAicG93ZXJkb3duIiwKIAkJCQkJ
CSBHUElPRF9PVVRfSElHSCk7CiAJaWYgKElTX0VSUihkdmktPnBvd2VyZG93bikpIHsKQEAgLTM1
Myw0OCArMzI0LDE4IEBAIHN0YXRpYyBpbnQgdGZwNDEwX2luaXQoc3RydWN0IGRldmljZSAqZGV2
LCBib29sIGkyYykKIAkJcmV0dXJuIFBUUl9FUlIoZHZpLT5wb3dlcmRvd24pOwogCX0KIAotCWlm
IChkdmktPmhwZCkKLQkJZHZpLT5ocGRfaXJxID0gZ3Bpb2RfdG9faXJxKGR2aS0+aHBkKTsKLQll
bHNlCi0JCWR2aS0+aHBkX2lycSA9IC1FTlhJTzsKLQotCWlmIChkdmktPmhwZF9pcnEgPj0gMCkg
ewotCQlJTklUX0RFTEFZRURfV09SSygmZHZpLT5ocGRfd29yaywgdGZwNDEwX2hwZF93b3JrX2Z1
bmMpOwotCi0JCXJldCA9IGRldm1fcmVxdWVzdF90aHJlYWRlZF9pcnEoZGV2LCBkdmktPmhwZF9p
cnEsCi0JCQlOVUxMLCB0ZnA0MTBfaHBkX2lycV90aHJlYWQsIElSUUZfVFJJR0dFUl9SSVNJTkcg
fAotCQkJSVJRRl9UUklHR0VSX0ZBTExJTkcgfCBJUlFGX09ORVNIT1QsCi0JCQkiaGRtaS1ocGQi
LCBkdmkpOwotCQlpZiAocmV0KSB7Ci0JCQlkZXZfZXJyKGRldiwgImZhaWxlZCB0byByZWdpc3Rl
ciBocGQgaW50ZXJydXB0XG4iKTsKLQkJCWdvdG8gZmFpbDsKLQkJfQotCX0KLQorCS8qICBSZWdp
c3RlciB0aGUgRFJNIGJyaWRnZS4gKi8KIAlkcm1fYnJpZGdlX2FkZCgmZHZpLT5icmlkZ2UpOwog
CiAJcmV0dXJuIDA7Ci1mYWlsOgotCWkyY19wdXRfYWRhcHRlcihkdmktPmRkYyk7Ci0JaWYgKGR2
aS0+aHBkKQotCQlncGlvZF9wdXQoZHZpLT5ocGQpOwotCXJldHVybiByZXQ7CiB9CiAKIHN0YXRp
YyBpbnQgdGZwNDEwX2Zpbmkoc3RydWN0IGRldmljZSAqZGV2KQogewogCXN0cnVjdCB0ZnA0MTAg
KmR2aSA9IGRldl9nZXRfZHJ2ZGF0YShkZXYpOwogCi0JaWYgKGR2aS0+aHBkX2lycSA+PSAwKQot
CQljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmR2aS0+aHBkX3dvcmspOwotCiAJZHJtX2JyaWRn
ZV9yZW1vdmUoJmR2aS0+YnJpZGdlKTsKIAotCWlmIChkdmktPmRkYykKLQkJaTJjX3B1dF9hZGFw
dGVyKGR2aS0+ZGRjKTsKLQlpZiAoZHZpLT5ocGQpCi0JCWdwaW9kX3B1dChkdmktPmhwZCk7Ci0K
IAlyZXR1cm4gMDsKIH0KIAotLSAKUmVnYXJkcywKCkxhdXJlbnQgUGluY2hhcnQKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5n
IGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
