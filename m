Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EE3AA31F701
	for <lists+dri-devel@lfdr.de>; Fri, 19 Feb 2021 11:06:09 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 272B26EAC8;
	Fri, 19 Feb 2021 10:06:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 28AB16E8BD
 for <dri-devel@lists.freedesktop.org>; Fri, 19 Feb 2021 10:05:59 +0000 (UTC)
IronPort-SDR: axoH27/+YCoNACGV3WZhky9gUv73Ca4xEgDDyfJJRVwolShMXIXfPeeldzSL0lU6H3KkU18rwq
 ugqI9kbDUBaA==
X-IronPort-AV: E=McAfee;i="6000,8403,9899"; a="170932823"
X-IronPort-AV: E=Sophos;i="5.81,189,1610438400"; d="scan'208";a="170932823"
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by orsmga101.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 19 Feb 2021 02:05:58 -0800
IronPort-SDR: 8Ko+CDVL7Z8g1OpDYuETRceoxoW+XEW3pz6K9EhSgyIrGwUtqvyCGcQpVoTJxISymjlZ9hR5jQ
 JQN99+Xk6Y2A==
X-IronPort-AV: E=Sophos;i="5.81,189,1610438400"; d="scan'208";a="513624309"
Received: from vkasired-desk2.fm.intel.com ([10.105.128.127])
 by orsmga004-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 19 Feb 2021 02:05:58 -0800
From: Vivek Kasireddy <vivek.kasireddy@intel.com>
To: virtualization@lists.linux-foundation.org, dri-devel@lists.freedesktop.org
Subject: [RFC v4 2/3] virtio: Introduce Vdmabuf driver
Date: Fri, 19 Feb 2021 01:55:22 -0800
Message-Id: <20210219095523.2621884-3-vivek.kasireddy@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210219095523.2621884-1-vivek.kasireddy@intel.com>
References: <20210219095523.2621884-1-vivek.kasireddy@intel.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: dongwon.kim@intel.com, daniel.vetter@ffwll.ch,
 Vivek Kasireddy <vivek.kasireddy@intel.com>, kraxel@redhat.com,
 daniel.vetter@intel.com, linux-media@vger.kernel.org, christian.koenig@amd.com,
 stevensd@chromium.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBkcml2ZXIgInRyYW5zZmVycyIgYSBkbWFidWYgY3JlYXRlZCBvbiB0aGUgR3Vlc3QgdG8g
dGhlIEhvc3QuCkEgY29tbW9uIHVzZS1jYXNlIGZvciBzdWNoIGEgdHJhbnNmZXIgaW5jbHVkZXMg
c2hhcmluZyB0aGUgc2Nhbm91dApidWZmZXIgY3JlYXRlZCBieSBhIGRpc3BsYXkgc2VydmVyIG9y
IGEgY29tcG9zaXRvciBydW5uaW5nIGluIHRoZQpHdWVzdCB3aXRoIFFlbXUgVUkgLS0gcnVubmlu
ZyBvbiB0aGUgSG9zdC4KClRoZSAidHJhbnNmZXIiIGlzIGFjY29tcGxpc2hlZCBieSBzaGFyaW5n
IHRoZSBQRk5zIG9mIGFsbCB0aGUgcGFnZXMKYXNzb2NpYXRlZCB3aXRoIHRoZSBkbWFidWYgYW5k
IGhhdmluZyBhIG5ldyBkbWFidWYgY3JlYXRlZCBvbiB0aGUKSG9zdCB0aGF0IGlzIGJhY2tlZCB1
cCBieSB0aGUgcGFnZXMgbWFwcGVkIGZyb20gdGhlIEd1ZXN0LgoKU2lnbmVkLW9mZi1ieTogRG9u
Z3dvbiBLaW0gPGRvbmd3b24ua2ltQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVml2ZWsgS2Fz
aXJlZGR5IDx2aXZlay5rYXNpcmVkZHlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvdmlydGlvL0tj
b25maWcgICAgICAgICAgICAgIHwgICAgOCArCiBkcml2ZXJzL3ZpcnRpby9NYWtlZmlsZSAgICAg
ICAgICAgICB8ICAgIDEgKwogZHJpdmVycy92aXJ0aW8vdmlydGlvX3ZkbWFidWYuYyAgICAgfCAx
MTA1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKwogaW5jbHVkZS9saW51eC92aXJ0aW9fdmRt
YWJ1Zi5oICAgICAgfCAgMjg3ICsrKysrKysKIGluY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9faWRz
LmggICAgIHwgICAgMSArCiBpbmNsdWRlL3VhcGkvbGludXgvdmlydGlvX3ZkbWFidWYuaCB8ICAg
ODcgKysrCiA2IGZpbGVzIGNoYW5nZWQsIDE0ODkgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvdmlydGlvL3ZpcnRpb192ZG1hYnVmLmMKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBpbmNsdWRlL2xpbnV4L3ZpcnRpb192ZG1hYnVmLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNs
dWRlL3VhcGkvbGludXgvdmlydGlvX3ZkbWFidWYuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvdmly
dGlvL0tjb25maWcgYi9kcml2ZXJzL3ZpcnRpby9LY29uZmlnCmluZGV4IDdiNDExMzBkM2YzNS4u
ZTU2M2MxMmY3MTFlIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpcnRpby9LY29uZmlnCisrKyBiL2Ry
aXZlcnMvdmlydGlvL0tjb25maWcKQEAgLTEzOSw0ICsxMzksMTIgQEAgY29uZmlnIFZJUlRJT19E
TUFfU0hBUkVEX0JVRkZFUgogCSBUaGlzIG9wdGlvbiBhZGRzIGEgZmxhdm9yIG9mIGRtYSBidWZm
ZXJzIHRoYXQgYXJlIGJhY2tlZCBieQogCSB2aXJ0aW8gcmVzb3VyY2VzLgogCitjb25maWcgVklS
VElPX1ZETUFCVUYKKwlib29sICJFbmFibGVzIFZkbWFidWYgZHJpdmVyIGluIGd1ZXN0IG9zIgor
CWRlZmF1bHQgbgorCWRlcGVuZHMgb24gVklSVElPCisJaGVscAorCSBUaGlzIGRyaXZlciBwcm92
aWRlcyBhIHdheSB0byBzaGFyZSB0aGUgZG1hYnVmcyBjcmVhdGVkIGluCisJIHRoZSBHdWVzdCB3
aXRoIHRoZSBIb3N0LgorCiBlbmRpZiAjIFZJUlRJT19NRU5VCmRpZmYgLS1naXQgYS9kcml2ZXJz
L3ZpcnRpby9NYWtlZmlsZSBiL2RyaXZlcnMvdmlydGlvL01ha2VmaWxlCmluZGV4IDU5MWU2Zjcy
YWE1NC4uYjRiYjA3MzgwMDljIDEwMDY0NAotLS0gYS9kcml2ZXJzL3ZpcnRpby9NYWtlZmlsZQor
KysgYi9kcml2ZXJzL3ZpcnRpby9NYWtlZmlsZQpAQCAtOSwzICs5LDQgQEAgb2JqLSQoQ09ORklH
X1ZJUlRJT19JTlBVVCkgKz0gdmlydGlvX2lucHV0Lm8KIG9iai0kKENPTkZJR19WSVJUSU9fVkRQ
QSkgKz0gdmlydGlvX3ZkcGEubwogb2JqLSQoQ09ORklHX1ZJUlRJT19NRU0pICs9IHZpcnRpb19t
ZW0ubwogb2JqLSQoQ09ORklHX1ZJUlRJT19ETUFfU0hBUkVEX0JVRkZFUikgKz0gdmlydGlvX2Rt
YV9idWYubworb2JqLSQoQ09ORklHX1ZJUlRJT19WRE1BQlVGKSArPSB2aXJ0aW9fdmRtYWJ1Zi5v
CmRpZmYgLS1naXQgYS9kcml2ZXJzL3ZpcnRpby92aXJ0aW9fdmRtYWJ1Zi5jIGIvZHJpdmVycy92
aXJ0aW8vdmlydGlvX3ZkbWFidWYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwMDAuLjgwM2I3Mzk4ZDNlZAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvdmlydGlvL3Zp
cnRpb192ZG1hYnVmLmMKQEAgLTAsMCArMSwxMTA1IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogKE1JVCBPUiBHUEwtMi4wKQorCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjEgSW50ZWwg
Q29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9m
IGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBvZiB0aGlzIHNvZnR3
YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwK
KyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGlu
ZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnks
IG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLAorICogYW5kL29yIHNlbGwg
Y29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhl
CisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxv
d2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0
aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5leHQKKyAqIHBhcmFncmFwaCkg
c2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBv
ZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMg
SVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVE
LCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5U
QUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZS
SU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hU
IEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKKyAqIExJ
QUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJX
SVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBT
T0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCisgKiBJTiBUSEUgU09GVFdBUkUu
CisgKgorICogQXV0aG9yczoKKyAqICAgIERvbmd3b24gS2ltIDxkb25nd29uLmtpbUBpbnRlbC5j
b20+CisgKiAgICBNYXRldXN6IFBvbHJvbGEgPG1hdGV1c3oucG9scm9sYUBnbWFpbC5jb20+Cisg
KiAgICBWaXZlayBLYXNpcmVkZHkgPHZpdmVrLmthc2lyZWRkeUBpbnRlbC5jb20+CisgKi8KKwor
I2luY2x1ZGUgPGxpbnV4L2luaXQuaD4KKyNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNs
dWRlIDxsaW51eC9lcnJuby5oPgorI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUg
PGxpbnV4L2RldmljZS5oPgorI2luY2x1ZGUgPGxpbnV4L3VhY2Nlc3MuaD4KKyNpbmNsdWRlIDxs
aW51eC9taXNjZGV2aWNlLmg+CisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxs
aW51eC9yYW5kb20uaD4KKyNpbmNsdWRlIDxsaW51eC9wb2xsLmg+CisjaW5jbHVkZSA8bGludXgv
c3BpbmxvY2suaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgv
dmlydGlvLmg+CisjaW5jbHVkZSA8bGludXgvdmlydGlvX2lkcy5oPgorI2luY2x1ZGUgPGxpbnV4
L3ZpcnRpb19jb25maWcuaD4KKyNpbmNsdWRlIDxsaW51eC92aXJ0aW9fdmRtYWJ1Zi5oPgorCisj
ZGVmaW5lIFZJUlRJT19WRE1BQlVGX01BWF9JRCBJTlRfTUFYCisjZGVmaW5lIFJFRlNfUEVSX1BB
R0UgKFBBR0VfU0laRS9zaXplb2YobG9uZykpCisjZGVmaW5lIE5FV19CVUZfSURfR0VOKHZtaWQs
IGNudCkgKCgodm1pZCAmIDB4RkZGRkZGRkYpIDw8IDMyKSB8IFwKKwkJCQkgICAgKChjbnQpICYg
MHhGRkZGRkZGRikpCisKKy8qIG9uZSBnbG9iYWwgZHJ2IG9iamVjdCAqLworc3RhdGljIHN0cnVj
dCB2aXJ0aW9fdmRtYWJ1Zl9pbmZvICpkcnZfaW5mbzsKKworc3RydWN0IHZpcnRpb192ZG1hYnVm
IHsKKwkvKiB2aXJ0aW8gZGV2aWNlIHN0cnVjdHVyZSAqLworCXN0cnVjdCB2aXJ0aW9fZGV2aWNl
ICp2ZGV2OworCisJLyogdmlydHVhbCBxdWV1ZSBhcnJheSAqLworCXN0cnVjdCB2aXJ0cXVldWUg
KnZxc1tWRE1BQlVGX1ZRX01BWF07CisKKwkvKiBJRCBvZiBndWVzdCBPUyAqLworCXU2NCB2bWlk
OworCisJLyogc3BpbiBsb2NrIHRoYXQgbmVlZHMgdG8gYmUgYWNxdWlyZWQgYmVmb3JlIGFjY2Vz
c2luZworCSAqIHZpcnR1YWwgcXVldWUKKwkgKi8KKwlzcGlubG9ja190IHZxX2xvY2s7CisJc3Ry
dWN0IG11dGV4IHJlY3ZfbG9jazsKKwlzdHJ1Y3QgbXV0ZXggc2VuZF9sb2NrOworCisJc3RydWN0
IGxpc3RfaGVhZCBtc2dfbGlzdDsKKworCS8qIHdvcmtxdWV1ZSAqLworCXN0cnVjdCB3b3JrcXVl
dWVfc3RydWN0ICp3cTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3QgcmVjdl93b3JrOworCXN0cnVjdCB3
b3JrX3N0cnVjdCBzZW5kX3dvcms7CisJc3RydWN0IHdvcmtfc3RydWN0IHNlbmRfbXNnX3dvcms7
CisKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZXZlbnRfcXVldWUgKmV2cTsKK307CisKK3N0YXRp
YyB2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBnZXRfYnVmX2lkKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1
ZiAqdmRtYWJ1ZikKK3sKKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQgPSB7MCwgezAs
IDB9IH07CisJc3RhdGljIGludCBjb3VudCA9IDA7CisKKwljb3VudCA9IGNvdW50IDwgVklSVElP
X1ZETUFCVUZfTUFYX0lEID8gY291bnQgKyAxIDogMDsKKwlidWZfaWQuaWQgPSBORVdfQlVGX0lE
X0dFTih2ZG1hYnVmLT52bWlkLCBjb3VudCk7CisKKwkvKiByYW5kb20gZGF0YSBlbWJlZGRlZCBp
biB0aGUgaWQgZm9yIHNlY3VyaXR5ICovCisJZ2V0X3JhbmRvbV9ieXRlcygmYnVmX2lkLnJuZ19r
ZXlbMF0sIDgpOworCisJcmV0dXJuIGJ1Zl9pZDsKK30KKworLyogc2hhcmluZyBwYWdlcyBmb3Ig
b3JpZ2luYWwgRE1BQlVGIHdpdGggSG9zdCAqLworc3RhdGljIGludCB2aXJ0aW9fdmRtYWJ1Zl9z
aGFyZV9idWYoc3RydWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZXhwKQoreworCXN0cnVjdCB2aXJ0
aW9fdmRtYWJ1Zl9zaGFyZWRfcGFnZXMgKnBhZ2VzX2luZm8gPSBleHAtPnBhZ2VzX2luZm87CisJ
c3RydWN0IHBhZ2UgKipwYWdlcyA9IHBhZ2VzX2luZm8tPnBhZ2VzOworCWludCBuZW50cyA9IHBh
Z2VzX2luZm8tPm5lbnRzOworCWludCBpOworCWludCBuX2wycmVmcyA9IG5lbnRzL1JFRlNfUEVS
X1BBR0UgKworCQkgICAgICAgKChuZW50cyAlIFJFRlNfUEVSX1BBR0UpID8gMSA6IDApOworCisJ
cGFnZXNfaW5mby0+bDNyZWZzID0gKGdwYV90ICopX19nZXRfZnJlZV9wYWdlKEdGUF9LRVJORUwp
OworCisJaWYgKCFwYWdlc19pbmZvLT5sM3JlZnMpIHsKKwkJa3ZmcmVlKHBhZ2VzX2luZm8pOwor
CQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlwYWdlc19pbmZvLT5sMnJlZnMgPSAoZ3BhX3QgKiop
X19nZXRfZnJlZV9wYWdlcyhHRlBfS0VSTkVMLAorCQkJCQlnZXRfb3JkZXIobl9sMnJlZnMgKiBQ
QUdFX1NJWkUpKTsKKworCWlmICghcGFnZXNfaW5mby0+bDJyZWZzKSB7CisJCWZyZWVfcGFnZSgo
Z3BhX3QpcGFnZXNfaW5mby0+bDNyZWZzKTsKKwkJa3ZmcmVlKHBhZ2VzX2luZm8pOworCQlyZXR1
cm4gLUVOT01FTTsKKwl9CisKKwkvKiBTaGFyZSBwaHlzaWNhbCBhZGRyZXNzIG9mIHBhZ2VzICov
CisJZm9yIChpID0gMDsgaSA8IG5lbnRzOyBpKyspCisJCXBhZ2VzX2luZm8tPmwycmVmc1tpXSA9
IChncGFfdCAqKXBhZ2VfdG9fcGh5cyhwYWdlc1tpXSk7CisKKwlmb3IgKGkgPSAwOyBpIDwgbl9s
MnJlZnM7IGkrKykKKwkJcGFnZXNfaW5mby0+bDNyZWZzW2ldID0KKwkJCXZpcnRfdG9fcGh5cygo
dm9pZCAqKXBhZ2VzX2luZm8tPmwycmVmcyArCisJCQkJICAgICBpICogUEFHRV9TSVpFKTsKKwor
CXBhZ2VzX2luZm8tPnJlZiA9IChncGFfdCl2aXJ0X3RvX3BoeXMocGFnZXNfaW5mby0+bDNyZWZz
KTsKKworCXJldHVybiAwOworfQorCisvKiBzdG9wIHNoYXJpbmcgcGFnZXMgKi8KK3N0YXRpYyB2
b2lkCit2aXJ0aW9fdmRtYWJ1Zl9mcmVlX2J1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfc2hhcmVk
X3BhZ2VzICpwYWdlc19pbmZvKQoreworCWludCBuX2wycmVmcyA9IChwYWdlc19pbmZvLT5uZW50
cy9SRUZTX1BFUl9QQUdFICsKKwkJICAgICAgICgocGFnZXNfaW5mby0+bmVudHMgJSBSRUZTX1BF
Ul9QQUdFKSA/IDEgOiAwKSk7CisKKwlmcmVlX3BhZ2VzKChncGFfdClwYWdlc19pbmZvLT5sMnJl
ZnMsIGdldF9vcmRlcihuX2wycmVmcyAqIFBBR0VfU0laRSkpOworCWZyZWVfcGFnZSgoZ3BhX3Qp
cGFnZXNfaW5mby0+bDNyZWZzKTsKKworCWt2ZnJlZShwYWdlc19pbmZvKTsKK30KKworc3RhdGlj
IGludCBzZW5kX21zZ190b19ob3N0KGVudW0gdmlydGlvX3ZkbWFidWZfY21kIGNtZCwgaW50ICpv
cCkKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYgPSBkcnZfaW5mby0+cHJpdjsK
KwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnICptc2c7CisJaW50IGk7CisKKwlzd2l0Y2ggKGNt
ZCkgeworCWNhc2UgVklSVElPX1ZETUFCVUZfQ01EX05FRURfVk1JRDoKKwkJbXNnID0ga3ZjYWxs
b2MoMSwgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cpLAorCQkJICAgICAgIEdGUF9L
RVJORUwpOworCQlpZiAoIW1zZykKKwkJCXJldHVybiAtRU5PTUVNOworCisJCWlmIChvcCkKKwkJ
CWZvciAoaSA9IDA7IGkgPCA0OyBpKyspCisJCQkJbXNnLT5vcFtpXSA9IG9wW2ldOworCQlicmVh
azsKKworCWNhc2UgVklSVElPX1ZETUFCVUZfQ01EX0VYUE9SVDoKKwkJbXNnID0ga3ZjYWxsb2Mo
MSwgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cpLAorCQkJICAgICAgIEdGUF9LRVJO
RUwpOworCQlpZiAoIW1zZykKKwkJCXJldHVybiAtRU5PTUVNOworCisJCW1lbWNweSgmbXNnLT5v
cFswXSwgJm9wWzBdLCAxMCAqIHNpemVvZihpbnQpICsgb3BbOV0pOworCQlicmVhazsKKworCWRl
ZmF1bHQ6CisJCS8qIG5vIGNvbW1hbmQgZm91bmQgKi8KKwkJcmV0dXJuIC1FSU5WQUw7CisJfQor
CisJbXNnLT5jbWQgPSBjbWQ7CisJbGlzdF9hZGRfdGFpbCgmbXNnLT5saXN0LCAmdmRtYWJ1Zi0+
bXNnX2xpc3QpOworCXF1ZXVlX3dvcmsodmRtYWJ1Zi0+d3EsICZ2ZG1hYnVmLT5zZW5kX21zZ193
b3JrKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFkZF9ldmVudF9idWZfcmVsKHN0
cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmJ1Zl9pbmZvKQoreworCXN0cnVjdCB2aXJ0aW9fdmRt
YWJ1ZiAqdmRtYWJ1ZiA9IGRydl9pbmZvLT5wcml2OworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9l
dmVudCAqZV9vbGRlc3QsICplX25ldzsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZXZlbnRfcXVl
dWUgKmVxID0gdmRtYWJ1Zi0+ZXZxOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisKKwllX25l
dyA9IGt2emFsbG9jKHNpemVvZigqZV9uZXcpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWVfbmV3KQor
CQlyZXR1cm4gLUVOT01FTTsKKworCWVfbmV3LT5lX2RhdGEuaGRyLmJ1Zl9pZCA9IGJ1Zl9pbmZv
LT5idWZfaWQ7CisJZV9uZXctPmVfZGF0YS5kYXRhID0gKHZvaWQgKilidWZfaW5mby0+cHJpdjsK
KwllX25ldy0+ZV9kYXRhLmhkci5zaXplID0gYnVmX2luZm8tPnN6X3ByaXY7CisKKwlzcGluX2xv
Y2tfaXJxc2F2ZSgmZXEtPmVfbG9jaywgaXJxZmxhZ3MpOworCisJLyogY2hlY2sgY3VycmVudCBu
dW1iZXIgb2YgZXZlbnRzIGFuZCBpZiBpdCBoaXRzIHRoZSBtYXggbnVtICgzMikKKwkgKiB0aGVu
IHJlbW92ZSB0aGUgb2xkZXN0IGV2ZW50IGluIHRoZSBsaXN0CisJICovCisJaWYgKGVxLT5wZW5k
aW5nID4gMzEpIHsKKwkJZV9vbGRlc3QgPSBsaXN0X2ZpcnN0X2VudHJ5KCZlcS0+ZV9saXN0LAor
CQkJCQkgICAgc3RydWN0IHZpcnRpb192ZG1hYnVmX2V2ZW50LCBsaW5rKTsKKwkJbGlzdF9kZWwo
JmVfb2xkZXN0LT5saW5rKTsKKwkJZXEtPnBlbmRpbmctLTsKKwkJa3ZmcmVlKGVfb2xkZXN0KTsK
Kwl9CisKKwlsaXN0X2FkZF90YWlsKCZlX25ldy0+bGluaywgJmVxLT5lX2xpc3QpOworCisJZXEt
PnBlbmRpbmcrKzsKKworCXdha2VfdXBfaW50ZXJydXB0aWJsZSgmZXEtPmVfd2FpdCk7CisJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmZXEtPmVfbG9jaywgaXJxZmxhZ3MpOworCisJcmV0dXJuIDA7
Cit9CisKK3N0YXRpYyB2b2lkIHZpcnRpb192ZG1hYnVmX2NsZWFyX2J1ZihzdHJ1Y3QgdmlydGlv
X3ZkbWFidWZfYnVmICpleHApCit7CisJLyogU3RhcnQgY2xlYW51cCBvZiBidWZmZXIgaW4gcmV2
ZXJzZSBvcmRlciB0byBleHBvcnRpbmcgKi8KKwl2aXJ0aW9fdmRtYWJ1Zl9mcmVlX2J1ZihleHAt
PnBhZ2VzX2luZm8pOworCisJZG1hX2J1Zl91bm1hcF9hdHRhY2htZW50KGV4cC0+YXR0YWNoLCBl
eHAtPnNndCwKKwkJCQkgRE1BX0JJRElSRUNUSU9OQUwpOworCisJaWYgKGV4cC0+ZG1hX2J1Zikg
eworCQlkbWFfYnVmX2RldGFjaChleHAtPmRtYV9idWYsIGV4cC0+YXR0YWNoKTsKKwkJLyogY2xv
c2UgY29ubmVjdGlvbiB0byBkbWEtYnVmIGNvbXBsZXRlbHkgKi8KKwkJZG1hX2J1Zl9wdXQoZXhw
LT5kbWFfYnVmKTsKKwkJZXhwLT5kbWFfYnVmID0gTlVMTDsKKwl9Cit9CisKK3N0YXRpYyBpbnQg
cmVtb3ZlX2J1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYsCisJCSAgICAgIHN0cnVj
dCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmV4cCkKK3sKKwlpbnQgcmV0OworCisJdmlydGlvX3ZkbWFi
dWZfY2xlYXJfYnVmKGV4cCk7CisKKwlyZXQgPSB2aXJ0aW9fdmRtYWJ1Zl9kZWxfYnVmKGRydl9p
bmZvLCAmZXhwLT5idWZfaWQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAoZXhw
LT5zel9wcml2ID4gMCAmJiAhZXhwLT5wcml2KQorCQlrdmZyZWUoZXhwLT5wcml2KTsKKworCWt2
ZnJlZShleHApOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHBhcnNlX21zZ19mcm9tX2hv
c3Qoc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1hYnVmLAorCQkgICAgIAkgICAgICAgc3RydWN0
IHZpcnRpb192ZG1hYnVmX21zZyAqbXNnKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYg
KmV4cDsKKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQ7CisJaW50IHJldDsKKworCXN3
aXRjaCAobXNnLT5jbWQpIHsKKwljYXNlIFZJUlRJT19WRE1BQlVGX0NNRF9ORUVEX1ZNSUQ6CisJ
CXZkbWFidWYtPnZtaWQgPSBtc2ctPm9wWzBdOworCisJCWJyZWFrOworCWNhc2UgVklSVElPX1ZE
TUFCVUZfQ01EX0RNQUJVRl9SRUw6CisJCW1lbWNweSgmYnVmX2lkLCBtc2ctPm9wLCBzaXplb2Yo
YnVmX2lkKSk7CisKKwkJZXhwID0gdmlydGlvX3ZkbWFidWZfZmluZF9idWYoZHJ2X2luZm8sICZi
dWZfaWQpOworCQlpZiAoIWV4cCkgeworCQkJZGV2X2VycihkcnZfaW5mby0+ZGV2LCAiY2FuJ3Qg
ZmluZCBidWZmZXJcbiIpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKworCQlyZXQgPSBhZGRf
ZXZlbnRfYnVmX3JlbChleHApOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlicmVh
azsKKwljYXNlIFZJUlRJT19WRE1BQlVGX0NNRF9FWFBPUlQ6CisJCWJyZWFrOworCWRlZmF1bHQ6
CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwgImVtcHR5IGNtZFxuIik7CisJCXJldHVybiAtRUlO
VkFMOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCB2aXJ0aW9fdmRtYWJ1Zl9y
ZWN2X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCB2aXJ0aW9fdmRt
YWJ1ZiAqdmRtYWJ1ZiA9CisJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgdmlydGlvX3ZkbWFi
dWYsIHJlY3Zfd29yayk7CisJc3RydWN0IHZpcnRxdWV1ZSAqdnEgPSB2ZG1hYnVmLT52cXNbVkRN
QUJVRl9WUV9SRUNWXTsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnICptc2c7CisJaW50IHN6
OworCisJbXV0ZXhfbG9jaygmdmRtYWJ1Zi0+cmVjdl9sb2NrKTsKKworCWRvIHsKKwkJdmlydHF1
ZXVlX2Rpc2FibGVfY2IodnEpOworCQlmb3IgKDs7KSB7CisJCQltc2cgPSB2aXJ0cXVldWVfZ2V0
X2J1Zih2cSwgJnN6KTsKKwkJCWlmICghbXNnKQorCQkJCWJyZWFrOworCisJCQkvKiB2YWxpZCBz
aXplICovCisJCQlpZiAoc3ogPT0gc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cpKSB7
CisJCQkJaWYgKHBhcnNlX21zZ19mcm9tX2hvc3QodmRtYWJ1ZiwgbXNnKSkKKwkJCQkJZGV2X2Vy
cihkcnZfaW5mby0+ZGV2LAorCQkJCQkJIm1zZyBwYXJzZSBlcnJvclxuIik7CisKKwkJCQlrdmZy
ZWUobXNnKTsKKwkJCX0gZWxzZSB7CisJCQkJZGV2X2VycihkcnZfaW5mby0+ZGV2LAorCQkJCQki
cmVjZWl2ZWQgbWFsZm9ybWVkIG1lc3NhZ2VcbiIpOworCQkJfQorCQl9CisJfSB3aGlsZSAoIXZp
cnRxdWV1ZV9lbmFibGVfY2IodnEpKTsKKworCW11dGV4X3VubG9jaygmdmRtYWJ1Zi0+cmVjdl9s
b2NrKTsKK30KKworc3RhdGljIHZvaWQgdmlydGlvX3ZkbWFidWZfZmlsbF9yZWN2X21zZyhzdHJ1
Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYpCit7CisJc3RydWN0IHZpcnRxdWV1ZSAqdnEgPSB2
ZG1hYnVmLT52cXNbVkRNQUJVRl9WUV9SRUNWXTsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3Qgc2c7CisJ
c3RydWN0IHZpcnRpb192ZG1hYnVmX21zZyAqbXNnOworCWludCByZXQ7CisKKwltc2cgPSBrdnph
bGxvYyhzaXplb2YoKm1zZyksIEdGUF9LRVJORUwpOworCWlmICghbXNnKQorCQlyZXR1cm47CisK
KwlzZ19pbml0X29uZSgmc2csIG1zZywgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9tc2cp
KTsKKwlyZXQgPSB2aXJ0cXVldWVfYWRkX2luYnVmKHZxLCAmc2csIDEsIG1zZywgR0ZQX0tFUk5F
TCk7CisJaWYgKHJldCkKKwkJcmV0dXJuOworCisJdmlydHF1ZXVlX2tpY2sodnEpOworfQorCitz
dGF0aWMgdm9pZCB2aXJ0aW9fdmRtYWJ1Zl9zZW5kX21zZ193b3JrKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYgPQorCQljb250YWlu
ZXJfb2Yod29yaywgc3RydWN0IHZpcnRpb192ZG1hYnVmLCBzZW5kX21zZ193b3JrKTsKKwlzdHJ1
Y3QgdmlydHF1ZXVlICp2cSA9IHZkbWFidWYtPnZxc1tWRE1BQlVGX1ZRX1NFTkRdOworCXN0cnVj
dCBzY2F0dGVybGlzdCBzZzsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfbXNnICptc2c7CisJYm9v
bCBhZGRlZCA9IGZhbHNlOworCWludCByZXQ7CisKKwltdXRleF9sb2NrKCZ2ZG1hYnVmLT5zZW5k
X2xvY2spOworCisJZm9yICg7OykgeworCQlpZiAobGlzdF9lbXB0eSgmdmRtYWJ1Zi0+bXNnX2xp
c3QpKQorCQkJYnJlYWs7CisKKwkJdmlydGlvX3ZkbWFidWZfZmlsbF9yZWN2X21zZyh2ZG1hYnVm
KTsKKworCQltc2cgPSBsaXN0X2ZpcnN0X2VudHJ5KCZ2ZG1hYnVmLT5tc2dfbGlzdCwKKwkJCQkg
ICAgICAgc3RydWN0IHZpcnRpb192ZG1hYnVmX21zZywgbGlzdCk7CisJCWxpc3RfZGVsX2luaXQo
Jm1zZy0+bGlzdCk7CisKKwkJc2dfaW5pdF9vbmUoJnNnLCBtc2csIHNpemVvZihzdHJ1Y3Qgdmly
dGlvX3ZkbWFidWZfbXNnKSk7CisJCXJldCA9IHZpcnRxdWV1ZV9hZGRfb3V0YnVmKHZxLCAmc2cs
IDEsIG1zZywgR0ZQX0tFUk5FTCk7CisJCWlmIChyZXQgPCAwKSB7CisJCQlkZXZfZXJyKGRydl9p
bmZvLT5kZXYsCisJCQkJImZhaWxlZCB0byBhZGQgbXNnIHRvIHZxXG4iKTsKKwkJCWJyZWFrOwor
CQl9CisKKwkJYWRkZWQgPSB0cnVlOwkKKwl9CisKKwlpZiAoYWRkZWQpCisJCXZpcnRxdWV1ZV9r
aWNrKHZxKTsKKworCW11dGV4X3VubG9jaygmdmRtYWJ1Zi0+c2VuZF9sb2NrKTsKK30KKworc3Rh
dGljIHZvaWQgdmlydGlvX3ZkbWFidWZfc2VuZF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29y
aykKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYgPQorCQljb250YWluZXJfb2Yo
d29yaywgc3RydWN0IHZpcnRpb192ZG1hYnVmLCBzZW5kX3dvcmspOworCXN0cnVjdCB2aXJ0cXVl
dWUgKnZxID0gdmRtYWJ1Zi0+dnFzW1ZETUFCVUZfVlFfU0VORF07CisJc3RydWN0IHZpcnRpb192
ZG1hYnVmX21zZyAqbXNnOworCXVuc2lnbmVkIGludCBzejsKKwlib29sIGFkZGVkID0gZmFsc2U7
CisKKwltdXRleF9sb2NrKCZ2ZG1hYnVmLT5zZW5kX2xvY2spOworCisJZG8geworCQl2aXJ0cXVl
dWVfZGlzYWJsZV9jYih2cSk7CisKKwkJZm9yICg7OykgeworCQkJbXNnID0gdmlydHF1ZXVlX2dl
dF9idWYodnEsICZzeik7CisJCQlpZiAoIW1zZykKKwkJCQlicmVhazsKKworCQkJaWYgKHBhcnNl
X21zZ19mcm9tX2hvc3QodmRtYWJ1ZiwgbXNnKSkKKwkJCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYs
CisJCQkJCSJtc2cgcGFyc2UgZXJyb3JcbiIpOworCisJCQlrdmZyZWUobXNnKTsKKwkJCWFkZGVk
ID0gdHJ1ZTsKKwkJfQorCX0gd2hpbGUgKCF2aXJ0cXVldWVfZW5hYmxlX2NiKHZxKSk7CisKKwlt
dXRleF91bmxvY2soJnZkbWFidWYtPnNlbmRfbG9jayk7CisKKwlpZiAoYWRkZWQpCisJCXF1ZXVl
X3dvcmsodmRtYWJ1Zi0+d3EsICZ2ZG1hYnVmLT5zZW5kX21zZ193b3JrKTsKK30KKworc3RhdGlj
IHZvaWQgdmlydGlvX3ZkbWFidWZfcmVjdl9jYihzdHJ1Y3QgdmlydHF1ZXVlICp2cSkKK3sKKwlz
dHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYgPSB2cS0+dmRldi0+cHJpdjsKKworCWlmICgh
dmRtYWJ1ZikKKwkJcmV0dXJuOworCisJcXVldWVfd29yayh2ZG1hYnVmLT53cSwgJnZkbWFidWYt
PnJlY3Zfd29yayk7Cit9CisKK3N0YXRpYyB2b2lkIHZpcnRpb192ZG1hYnVmX3NlbmRfY2Ioc3Ry
dWN0IHZpcnRxdWV1ZSAqdnEpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1hYnVmID0g
dnEtPnZkZXYtPnByaXY7CisKKwlpZiAoIXZkbWFidWYpCisJCXJldHVybjsKKworCXF1ZXVlX3dv
cmsodmRtYWJ1Zi0+d3EsICZ2ZG1hYnVmLT5zZW5kX3dvcmspOworfQorCitzdGF0aWMgaW50IHJl
bW92ZV9hbGxfYnVmcyhzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYpCit7CisJc3RydWN0
IHZpcnRpb192ZG1hYnVmX2J1ZiAqZm91bmQ7CisJc3RydWN0IGhsaXN0X25vZGUgKnRtcDsKKwlp
bnQgYmt0OworCWludCByZXQ7CisKKwloYXNoX2Zvcl9lYWNoX3NhZmUoZHJ2X2luZm8tPmJ1Zl9s
aXN0LCBia3QsIHRtcCwgZm91bmQsIG5vZGUpIHsKKwkJcmV0ID0gcmVtb3ZlX2J1Zih2ZG1hYnVm
LCBmb3VuZCk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgc3RydWN0IHNnX3RhYmxlCisqdmlydGlvX3ZkbWFidWZfbWFwX2RtYWJ1Zihz
dHJ1Y3QgZG1hX2J1Zl9hdHRhY2htZW50ICphdHRhY2htZW50LAorCQkJICAgZW51bSBkbWFfZGF0
YV9kaXJlY3Rpb24gZGlyKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmV4cF9idWY7
CisJc3RydWN0IHNnX3RhYmxlICpzZ3Q7CisJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZ2w7CisJaW50
IGksIHJldDsKKworCWlmICghYXR0YWNobWVudC0+ZG1hYnVmIHx8ICFhdHRhY2htZW50LT5kbWFi
dWYtPnByaXYpCisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCisJZXhwX2J1ZiA9IGF0dGFj
aG1lbnQtPmRtYWJ1Zi0+cHJpdjsKKworCXNndCA9IGt2emFsbG9jKHNpemVvZigqc2d0KSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFzZ3QpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJcmV0
ID0gc2dfYWxsb2NfdGFibGUoc2d0LCBleHBfYnVmLT5wYWdlc19pbmZvLT5uZW50cywgR0ZQX0tF
Uk5FTCk7CisJaWYgKHJldCkgeworCQlrdmZyZWUoc2d0KTsKKwkJcmV0dXJuIEVSUl9QVFIocmV0
KTsKKwl9CisKKwlzZ2wgPSBzZ3QtPnNnbDsKKwlmb3IgKGkgPSAwOyBpIDwgZXhwX2J1Zi0+cGFn
ZXNfaW5mby0+bmVudHM7IGkrKykgeworCQlzZ19zZXRfcGFnZShzZ2wsIGV4cF9idWYtPnBhZ2Vz
X2luZm8tPnBhZ2VzW2ldLCBQQUdFX1NJWkUsIDApOworCQlzZ2wgPSBzZ19uZXh0KHNnbCk7CisJ
fQorCisJaWYgKCFkbWFfbWFwX3NnKGF0dGFjaG1lbnQtPmRldiwgc2d0LT5zZ2wsIHNndC0+bmVu
dHMsIGRpcikpIHsKKwkJc2dfZnJlZV90YWJsZShzZ3QpOworCQlrdmZyZWUoc2d0KTsKKwkJcmV0
dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisJfQorCisJcmV0dXJuIHNndDsKK30KKworc3RhdGljIGlu
dCB2aXJ0aW9fdmRtYWJ1Zl9tbWFwX2RtYWJ1ZihzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmLAorCQkJ
CSAgICAgIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hKQoreworCXN0cnVjdCB2aXJ0aW9fdmRt
YWJ1Zl9idWYgKmV4cF9idWY7CisJdTY0IHVhZGRyOworCWludCBpLCByZXQ7CisKKwlpZiAoIWRt
YWJ1Zi0+cHJpdikKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlleHBfYnVmID0gZG1hYnVmLT5wcml2
OworCisJaWYgKCFleHBfYnVmLT5wYWdlc19pbmZvKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXZt
YS0+dm1fZmxhZ3MgfD0gVk1fRE9OVEVYUEFORCB8IFZNX0RPTlREVU1QOworCisJdWFkZHIgPSB2
bWEtPnZtX3N0YXJ0OworCWZvciAoaSA9IDA7IGkgPCBleHBfYnVmLT5wYWdlc19pbmZvLT5uZW50
czsgaSsrKSB7CisJCXJldCA9IHZtX2luc2VydF9wYWdlKHZtYSwgdWFkZHIsCisJCQkJICAgICBl
eHBfYnVmLT5wYWdlc19pbmZvLT5wYWdlc1tpXSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0
OworCisJCXVhZGRyICs9IFBBR0VfU0laRTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IHZvaWQgdmlydGlvX3ZkbWFidWZfdW5tYXBfZG1hYnVmKHN0cnVjdCBkbWFfYnVmX2F0dGFjaG1l
bnQgKmF0dGFjaG1lbnQsCisJCQkJICAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnNndCwKKwkJCQkg
ICAgICAgIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcikKK3sKKwlkbWFfdW5tYXBfc2coYXR0
YWNobWVudC0+ZGV2LCBzZ3QtPnNnbCwgc2d0LT5uZW50cywgZGlyKTsKKworCXNnX2ZyZWVfdGFi
bGUoc2d0KTsKKwlrdmZyZWUoc2d0KTsKK30KKworc3RhdGljIHZvaWQgdmlydGlvX3ZkbWFidWZf
cmVsZWFzZV9kbWFidWYoc3RydWN0IGRtYV9idWYgKmRtYWJ1ZikKK3sKKwlzdHJ1Y3QgdmlydGlv
X3ZkbWFidWZfYnVmICpleHBfYnVmID0gZG1hYnVmLT5wcml2OworCWludCBpOworCisJZm9yIChp
ID0gMDsgaSA8IGV4cF9idWYtPnBhZ2VzX2luZm8tPm5lbnRzOyBpKyspCisJCXB1dF9wYWdlKGV4
cF9idWYtPnBhZ2VzX2luZm8tPnBhZ2VzW2ldKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBk
bWFfYnVmX29wcyB2aXJ0aW9fdmRtYWJ1Zl9kbWFidWZfb3BzID0gIHsKKwkubWFwX2RtYV9idWYg
PSB2aXJ0aW9fdmRtYWJ1Zl9tYXBfZG1hYnVmLAorCS51bm1hcF9kbWFfYnVmID0gdmlydGlvX3Zk
bWFidWZfdW5tYXBfZG1hYnVmLAorCS5yZWxlYXNlID0gdmlydGlvX3ZkbWFidWZfcmVsZWFzZV9k
bWFidWYsCisJLm1tYXAgPSB2aXJ0aW9fdmRtYWJ1Zl9tbWFwX2RtYWJ1ZiwKK307CisKK3N0YXRp
YyBpbnQgdmlydGlvX3ZkbWFidWZfY3JlYXRlX2RtYWJ1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWYg
KnZkbWFidWYsCisJCQkJICAgICAgICB1aW50NjRfdCBib19zaXplKQoreworCURFRklORV9ETUFf
QlVGX0VYUE9SVF9JTkZPKGV4cF9pbmZvKTsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfYnVmICpl
eHBfYnVmOworCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7CisJdWludDMyX3QgbnVtX3BhZ2VzID0g
RElWX1JPVU5EX1VQKGJvX3NpemUsIFBBR0VfU0laRSk7CisJaW50IGksIGosIHJldDsKKworCWV4
cF9idWYgPSBrdnphbGxvYyhzaXplb2YoKmV4cF9idWYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWV4
cF9idWYpCisJCWdvdG8gZXJyX2V4cDsKKworCWV4cF9idWYtPnBhZ2VzX2luZm8gPSBrdnphbGxv
YyhzaXplb2YgKCooZXhwX2J1Zi0+cGFnZXNfaW5mbykpLAorCQkJCSAgICAgICBHRlBfS0VSTkVM
KTsKKwlpZiAoIWV4cF9idWYtPnBhZ2VzX2luZm8pCisJCWdvdG8gZXJyX3BhZ2VzX2luZm87CisK
KwlleHBfYnVmLT5wYWdlc19pbmZvLT5wYWdlcyA9IGt2emFsbG9jKG51bV9wYWdlcyAqIHNpemVv
ZihzdHJ1Y3QgcGFnZSAqKSwKKwkJCQkJICAgICAgR0ZQX0tFUk5FTCk7CisJaWYgKCFleHBfYnVm
LT5wYWdlc19pbmZvLT5wYWdlcykKKwkJZ290byBlcnJfcGFnZXM7CisKKwlleHBfaW5mby5vcHMg
PSAmdmlydGlvX3ZkbWFidWZfZG1hYnVmX29wczsKKwlleHBfaW5mby5zaXplID0gYm9fc2l6ZTsK
KwlleHBfaW5mby5mbGFncyA9IE9fQ0xPRVhFQzsKKwlleHBfaW5mby5wcml2ID0gZXhwX2J1ZjsK
KworCWZvciAoaSA9IDA7IGkgPCBudW1fcGFnZXM7IGkrKykgeworCQlleHBfYnVmLT5wYWdlc19p
bmZvLT5wYWdlc1tpXSA9IGFsbG9jX3BhZ2UoR0ZQX0tFUk5FTCB8CisJCQkJCQkJICAgIF9fR0ZQ
X1pFUk8pOworCQlpZiAoIWV4cF9idWYtPnBhZ2VzX2luZm8tPnBhZ2VzW2ldKQorCQkJZ290byBl
cnJfYWxsb2M7CisJfQorCisJZG1hYnVmID0gZG1hX2J1Zl9leHBvcnQoJmV4cF9pbmZvKTsKKwlp
ZiAoSVNfRVJSX09SX05VTEwoZG1hYnVmKSkKKwkJZ290byBlcnJfYWxsb2M7CisKKwlyZXQgPSBk
bWFfYnVmX2ZkKGRtYWJ1ZiwgMCk7CisJaWYgKHJldCA8IDApCisJCWdvdG8gZXJyX2FsbG9jOwor
CisJZXhwX2J1Zi0+ZmQgPSByZXQ7CisJZXhwX2J1Zi0+YnVmX2lkID0gZ2V0X2J1Zl9pZCh2ZG1h
YnVmKTsKKwlleHBfYnVmLT5wYWdlc19pbmZvLT5uZW50cyA9IG51bV9wYWdlczsKKworCXZpcnRp
b192ZG1hYnVmX2FkZF9idWYoZHJ2X2luZm8sIGV4cF9idWYpOworCisJcmV0dXJuIHJldDsKKwor
ZXJyX2FsbG9jOgorCWZvciAoaiA9IDA7IGogPCBpOyBqKyspCisJCXB1dF9wYWdlKGV4cF9idWYt
PnBhZ2VzX2luZm8tPnBhZ2VzW2ldKTsKK2Vycl9wYWdlczoKKwlrdmZyZWUoZXhwX2J1Zi0+cGFn
ZXNfaW5mby0+cGFnZXMpOworZXJyX3BhZ2VzX2luZm86CisJa3ZmcmVlKGV4cF9idWYtPnBhZ2Vz
X2luZm8pOworZXJyX2V4cDoKKwlrdmZyZWUoZXhwX2J1Zik7CisKKwlyZXR1cm4gLUVOT01FTTsK
K30KKworc3RhdGljIGludCB2aXJ0aW9fdmRtYWJ1Zl9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUs
IHN0cnVjdCBmaWxlICpmaWxwKQoreworCWludCByZXQ7CisKKwlpZiAoIWRydl9pbmZvKSB7CisJ
CXByX2VycigidmlydGlvIHZkbWFidWYgZHJpdmVyIGlzIG5vdCByZWFkeVxuIik7CisJCXJldHVy
biAtRUlOVkFMOworCX0KKworCXJldCA9IHNlbmRfbXNnX3RvX2hvc3QoVklSVElPX1ZETUFCVUZf
Q01EX05FRURfVk1JRCwgMCk7CisJaWYgKHJldCA8IDApCisJCWRldl9lcnIoZHJ2X2luZm8tPmRl
diwgImZhaWwgdG8gcmVjZWl2ZSB2bWlkXG4iKTsKKworCWZpbHAtPnByaXZhdGVfZGF0YSA9IGRy
dl9pbmZvLT5wcml2OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgdmlydGlvX3ZkbWFi
dWZfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlscCkKK3sKKwly
ZXR1cm4gMDsKK30KKworLyogTm90aWZ5IEhvc3QgYWJvdXQgdGhlIG5ldyB2ZG1hYnVmICovCitz
dGF0aWMgaW50IGV4cG9ydF9ub3RpZnkoc3RydWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZXhwKQor
eworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9zaGFyZWRfcGFnZXMgKnBhZ2VzX2luZm8gPSBleHAt
PnBhZ2VzX2luZm87CisJaW50ICpvcDsKKwlpbnQgcmV0OworCisJb3AgPSBrdmNhbGxvYygxLCBz
aXplb2YoaW50KSAqIDY1LCBHRlBfS0VSTkVMKTsKKwlpZiAoIW9wKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCW1lbWNweShvcCwgJmV4cC0+YnVmX2lkLCBzaXplb2YoZXhwLT5idWZfaWQpKTsKKwor
CW9wWzRdID0gcGFnZXNfaW5mby0+bmVudHM7CisJb3BbNV0gPSBwYWdlc19pbmZvLT5maXJzdF9v
ZnN0OworCS8vb3BbNl0gPSBwYWdlc19pbmZvLT5sYXN0X2xlbjsKKwlvcFs2XSA9IFBBR0VfU0la
RTsKKworCW1lbWNweSgmb3BbN10sICZwYWdlc19pbmZvLT5yZWYsIHNpemVvZihncGFfdCkpOwor
CW9wWzldID0gZXhwLT5zel9wcml2OworCisJLyogZHJpdmVyL2FwcGxpY2F0aW9uIHNwZWNpZmlj
IHByaXZhdGUgaW5mbyAqLworCW1lbWNweSgmb3BbMTBdLCBleHAtPnByaXYsIG9wWzldKTsKKwor
CXJldCA9IHNlbmRfbXNnX3RvX2hvc3QoVklSVElPX1ZETUFCVUZfQ01EX0VYUE9SVCwgb3ApOwor
CisJa3ZmcmVlKG9wKTsKKwlyZXR1cm4gcmV0OworfQorCisvKiBpb2N0bCAtIGV4cG9ydGluZyBu
ZXcgdmRtYWJ1ZgorICoKKyAqCSBpbnQgZG1hYnVmX2ZkIC0gRmlsZSBoYW5kbGUgb2Ygb3JpZ2lu
YWwgRE1BQlVGCisgKgkgdmlydGlvX3ZkbWFidWZfYnVmX2lkX3QgYnVmX2lkIC0gcmV0dXJuZWQg
dmRtYWJ1ZiBJRAorICoJIGludCBzel9wcml2IC0gc2l6ZSBvZiBwcml2YXRlIGRhdGEgZnJvbSB1
c2Vyc3BhY2UKKyAqCSBjaGFyICpwcml2IC0gYnVmZmVyIG9mIHVzZXIgcHJpdmF0ZSBkYXRhCisg
KgorICovCitzdGF0aWMgaW50IGV4cG9ydF9pb2N0bChzdHJ1Y3QgZmlsZSAqZmlscCwgdm9pZCAq
ZGF0YSkKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWYgPSBmaWxwLT5wcml2YXRl
X2RhdGE7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2V4cG9ydCAqYXR0ciA9IGRhdGE7CisJc3Ry
dWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZXhwOworCWludCByZXQgPSAwOworCisJaWYgKHZkbWFi
dWYtPnZtaWQgPD0gMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlleHAgPSB2aXJ0aW9fdmRtYWJ1
Zl9maW5kX2J1Zl9mZChkcnZfaW5mbywgYXR0ci0+ZmQpOworCWlmICghZXhwKQorCQlyZXR1cm4g
LUVJTlZBTDsKKworCW11dGV4X2xvY2soJmRydl9pbmZvLT5nX211dGV4KTsKKworCS8qIHBvc3Np
YmxlIHRydW5jYXRpb24gKi8KKwlpZiAoYXR0ci0+c3pfcHJpdiA+IE1BWF9TSVpFX1BSSVZfREFU
QSkKKwkJZXhwLT5zel9wcml2ID0gTUFYX1NJWkVfUFJJVl9EQVRBOworCWVsc2UKKwkJZXhwLT5z
el9wcml2ID0gYXR0ci0+c3pfcHJpdjsKKworCS8qIGNyZWF0aW5nIGJ1ZmZlciBmb3IgcHJpdmF0
ZSBkYXRhICovCisJaWYgKGV4cC0+c3pfcHJpdiAhPSAwKSB7CisJCWV4cC0+cHJpdiA9IGt2Y2Fs
bG9jKDEsIGV4cC0+c3pfcHJpdiwgR0ZQX0tFUk5FTCk7CisJCWlmICghZXhwLT5wcml2KQorCQkJ
cmV0dXJuIC1FTk9NRU07CisKKwkJcmV0ID0gY29weV9mcm9tX3VzZXIoZXhwLT5wcml2LCBhdHRy
LT5wcml2LCBleHAtPnN6X3ByaXYpOworCQlpZiAocmV0KSB7CisJCQlyZXQgPSAtRUlOVkFMOwor
CQkJZ290byBmYWlsX3ByaXY7CisJCX0KKwl9CisKKwlyZXQgPSB2aXJ0aW9fdmRtYWJ1Zl9zaGFy
ZV9idWYoZXhwKTsKKwlpZiAocmV0IDwgMCkKKwkJZ290byBmYWlsX3ByaXY7CisKKwlyZXQgPSBl
eHBvcnRfbm90aWZ5KGV4cCk7CisJaWYgKHJldCA8IDApCisJCWdvdG8gZmFpbF9wcml2OworCisJ
ZXhwLT52YWxpZCA9IDE7CisJZXhwLT5maWxwID0gZmlscDsKKwlhdHRyLT5idWZfaWQgPSBleHAt
PmJ1Zl9pZDsKKworCW11dGV4X3VubG9jaygmZHJ2X2luZm8tPmdfbXV0ZXgpOworCisJcmV0dXJu
IHJldDsKKworZmFpbF9wcml2OgorCWt2ZnJlZShleHAtPnByaXYpOworCW11dGV4X3VubG9jaygm
ZHJ2X2luZm8tPmdfbXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBhbGxv
Y19pb2N0bChzdHJ1Y3QgZmlsZSAqZmlscCwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgdmlydGlv
X3ZkbWFidWYgKnZkbWFidWYgPSBmaWxwLT5wcml2YXRlX2RhdGE7CisJc3RydWN0IHZpcnRpb192
ZG1hYnVmX2FsbG9jICphdHRyID0gZGF0YTsKKwlpbnQgcmV0OworCisJcmV0ID0gdmlydGlvX3Zk
bWFidWZfY3JlYXRlX2RtYWJ1Zih2ZG1hYnVmLCBhdHRyLT5zaXplKTsKKwlpZiAocmV0IDwgMCkK
KwkJcmV0dXJuIHJldDsKKworCWF0dHItPmZkID0gcmV0OworCisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIGNvbnN0IHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9pb2N0bF9kZXNjIHZpcnRpb192ZG1h
YnVmX2lvY3Rsc1tdID0geworCVZJUlRJT19WRE1BQlVGX0lPQ1RMX0RFRihWSVJUSU9fVkRNQUJV
Rl9JT0NUTF9BTExPQ19GRCwgYWxsb2NfaW9jdGwsIDApLAorCVZJUlRJT19WRE1BQlVGX0lPQ1RM
X0RFRihWSVJUSU9fVkRNQUJVRl9JT0NUTF9FWFBPUlQsIGV4cG9ydF9pb2N0bCwgMCksCit9Owor
CitzdGF0aWMgbG9uZyB2aXJ0aW9fdmRtYWJ1Zl9pb2N0bChzdHJ1Y3QgZmlsZSAqZmlscCwgdW5z
aWduZWQgaW50IGNtZCwKKwkJICAgICAgIAkJIHVuc2lnbmVkIGxvbmcgcGFyYW0pCit7CisJY29u
c3Qgc3RydWN0IHZpcnRpb192ZG1hYnVmX2lvY3RsX2Rlc2MgKmlvY3RsID0gTlVMTDsKKwl1bnNp
Z25lZCBpbnQgbnIgPSBfSU9DX05SKGNtZCk7CisJaW50IHJldDsKKwl2aXJ0aW9fdmRtYWJ1Zl9p
b2N0bF90IGZ1bmM7CisJY2hhciAqa2RhdGE7CisKKwlpZiAobnIgPj0gQVJSQVlfU0laRSh2aXJ0
aW9fdmRtYWJ1Zl9pb2N0bHMpKSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwgImludmFsaWQg
aW9jdGxcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpb2N0bCA9ICZ2aXJ0aW9fdmRt
YWJ1Zl9pb2N0bHNbbnJdOworCisJZnVuYyA9IGlvY3RsLT5mdW5jOworCisJaWYgKHVubGlrZWx5
KCFmdW5jKSkgeworCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsICJubyBmdW5jdGlvblxuIik7CisJ
CXJldHVybiAtRUlOVkFMOworCX0KKworCWtkYXRhID0ga3ZtYWxsb2MoX0lPQ19TSVpFKGNtZCks
IEdGUF9LRVJORUwpOworCWlmICgha2RhdGEpCisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGNv
cHlfZnJvbV91c2VyKGtkYXRhLCAodm9pZCBfX3VzZXIgKilwYXJhbSwKKwkJCSAgIF9JT0NfU0la
RShjbWQpKSAhPSAwKSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwKKwkJCSJmYWlsZWQgdG8g
Y29weSBmcm9tIHVzZXIgYXJndW1lbnRzXG4iKTsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBp
b2N0bF9lcnJvcjsKKwl9CisKKwlyZXQgPSBmdW5jKGZpbHAsIGtkYXRhKTsKKworCWlmIChjb3B5
X3RvX3VzZXIoKHZvaWQgX191c2VyICopcGFyYW0sIGtkYXRhLAorCQkJIF9JT0NfU0laRShjbWQp
KSAhPSAwKSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwKKwkJCSJmYWlsZWQgdG8gY29weSB0
byB1c2VyIGFyZ3VtZW50c1xuIik7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gaW9jdGxfZXJy
b3I7CisJfQorCitpb2N0bF9lcnJvcjoKKwlrdmZyZWUoa2RhdGEpOworCXJldHVybiByZXQ7Cit9
CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgdmlydGlvX3ZkbWFidWZfZXZlbnRfcG9sbChzdHJ1Y3Qg
ZmlsZSAqZmlscCwKKwkJCSAgICAJICAgIAkgICAgICBzdHJ1Y3QgcG9sbF90YWJsZV9zdHJ1Y3Qg
KndhaXQpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmICp2ZG1hYnVmID0gZmlscC0+cHJpdmF0
ZV9kYXRhOworCisJcG9sbF93YWl0KGZpbHAsICZ2ZG1hYnVmLT5ldnEtPmVfd2FpdCwgd2FpdCk7
CisKKwlpZiAoIWxpc3RfZW1wdHkoJnZkbWFidWYtPmV2cS0+ZV9saXN0KSkKKwkJcmV0dXJuIFBP
TExJTiB8IFBPTExSRE5PUk07CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHNzaXplX3Qgdmly
dGlvX3ZkbWFidWZfZXZlbnRfcmVhZChzdHJ1Y3QgZmlsZSAqZmlscCwgY2hhciBfX3VzZXIgKmJ1
ZiwKKwkJCSAgICAgICAJCSBzaXplX3QgY250LCBsb2ZmX3QgKm9mc3QpCit7CisJc3RydWN0IHZp
cnRpb192ZG1hYnVmICp2ZG1hYnVmID0gZmlscC0+cHJpdmF0ZV9kYXRhOworCWludCByZXQ7CisK
KwkvKiBtYWtlIHN1cmUgdXNlciBidWZmZXIgY2FuIGJlIHdyaXR0ZW4gKi8KKwlpZiAoIWFjY2Vz
c19vayhidWYsIHNpemVvZiAoKmJ1ZikpKSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwgInVz
ZXIgYnVmZmVyIGNhbid0IGJlIHdyaXR0ZW4uXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQor
CisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2ZG1hYnVmLT5ldnEtPmVfcmVhZGxv
Y2spOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlmb3IgKDs7KSB7CisJCXN0cnVjdCB2
aXJ0aW9fdmRtYWJ1Zl9ldmVudCAqZSA9IE5VTEw7CisKKwkJc3Bpbl9sb2NrX2lycSgmdmRtYWJ1
Zi0+ZXZxLT5lX2xvY2spOworCQlpZiAoIWxpc3RfZW1wdHkoJnZkbWFidWYtPmV2cS0+ZV9saXN0
KSkgeworCQkJZSA9IGxpc3RfZmlyc3RfZW50cnkoJnZkbWFidWYtPmV2cS0+ZV9saXN0LAorCQkJ
CQkgICAgIHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9ldmVudCwgbGluayk7CisJCQlsaXN0X2RlbCgm
ZS0+bGluayk7CisJCX0KKwkJc3Bpbl91bmxvY2tfaXJxKCZ2ZG1hYnVmLT5ldnEtPmVfbG9jayk7
CisKKwkJaWYgKCFlKSB7CisJCQlpZiAocmV0KQorCQkJCWJyZWFrOworCisJCQlpZiAoZmlscC0+
Zl9mbGFncyAmIE9fTk9OQkxPQ0spIHsKKwkJCQlyZXQgPSAtRUFHQUlOOworCQkJCWJyZWFrOwor
CQkJfQorCisJCQltdXRleF91bmxvY2soJnZkbWFidWYtPmV2cS0+ZV9yZWFkbG9jayk7CisJCQly
ZXQgPSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUodmRtYWJ1Zi0+ZXZxLT5lX3dhaXQsCisJCQkJ
CSFsaXN0X2VtcHR5KCZ2ZG1hYnVmLT5ldnEtPmVfbGlzdCkpOworCisJCQlpZiAocmV0ID09IDAp
CisJCQkJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKAorCQkJCQkJJnZkbWFidWYtPmV2
cS0+ZV9yZWFkbG9jayk7CisKKwkJCWlmIChyZXQpCisJCQkJcmV0dXJuIHJldDsKKwkJfSBlbHNl
IHsKKwkJCXVuc2lnbmVkIGludCBsZW4gPSAoc2l6ZW9mKGUtPmVfZGF0YS5oZHIpICsKKwkJCQkJ
ICAgIGUtPmVfZGF0YS5oZHIuc2l6ZSk7CisKKwkJCWlmIChsZW4gPiBjbnQgLSByZXQpIHsKK3B1
dF9iYWNrX2V2ZW50OgorCQkJCXNwaW5fbG9ja19pcnEoJnZkbWFidWYtPmV2cS0+ZV9sb2NrKTsK
KwkJCQlsaXN0X2FkZCgmZS0+bGluaywgJnZkbWFidWYtPmV2cS0+ZV9saXN0KTsKKwkJCQlzcGlu
X3VubG9ja19pcnEoJnZkbWFidWYtPmV2cS0+ZV9sb2NrKTsKKwkJCQlicmVhazsKKwkJCX0KKwor
CQkJaWYgKGNvcHlfdG9fdXNlcihidWYgKyByZXQsICZlLT5lX2RhdGEuaGRyLAorCQkJCQkgc2l6
ZW9mKGUtPmVfZGF0YS5oZHIpKSkgeworCQkJCWlmIChyZXQgPT0gMCkKKwkJCQkJcmV0ID0gLUVG
QVVMVDsKKworCQkJCWdvdG8gcHV0X2JhY2tfZXZlbnQ7CisJCQl9CisKKwkJCXJldCArPSBzaXpl
b2YoZS0+ZV9kYXRhLmhkcik7CisKKwkJCWlmIChjb3B5X3RvX3VzZXIoYnVmICsgcmV0LCBlLT5l
X2RhdGEuZGF0YSwKKwkJCQkJIGUtPmVfZGF0YS5oZHIuc2l6ZSkpIHsKKwkJCQkvKiBlcnJvciB3
aGlsZSBjb3B5aW5nIHZvaWQgKmRhdGEgKi8KKworCQkJCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9l
X2hkciBkdW1teV9oZHIgPSB7MH07CisKKwkJCQlyZXQgLT0gc2l6ZW9mKGUtPmVfZGF0YS5oZHIp
OworCisJCQkJLyogbnVsbGlmeWluZyBoZHIgb2YgdGhlIGV2ZW50IGluIHVzZXIgYnVmZmVyICov
CisJCQkJaWYgKGNvcHlfdG9fdXNlcihidWYgKyByZXQsICZkdW1teV9oZHIsCisJCQkJCQkgc2l6
ZW9mKGR1bW15X2hkcikpKQorCQkJCQlkZXZfZXJyKGRydl9pbmZvLT5kZXYsCisJCQkJCSAgICJm
YWlsIHRvIG51bGxpZnkgaW52YWxpZCBoZHJcbiIpOworCisJCQkJcmV0ID0gLUVGQVVMVDsKKwor
CQkJCWdvdG8gcHV0X2JhY2tfZXZlbnQ7CisJCQl9CisKKwkJCXJldCArPSBlLT5lX2RhdGEuaGRy
LnNpemU7CisJCQl2ZG1hYnVmLT5ldnEtPnBlbmRpbmctLTsKKwkJCWt2ZnJlZShlKTsKKwkJfQor
CX0KKworCW11dGV4X3VubG9jaygmdmRtYWJ1Zi0+ZXZxLT5lX3JlYWRsb2NrKTsKKworCXJldHVy
biByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIHZpcnRpb192
ZG1hYnVmX2ZvcHMgPSB7CisJLm93bmVyID0gVEhJU19NT0RVTEUsCisJLm9wZW4gPSB2aXJ0aW9f
dmRtYWJ1Zl9vcGVuLAorCS5yZWxlYXNlID0gdmlydGlvX3ZkbWFidWZfcmVsZWFzZSwKKwkucmVh
ZCA9IHZpcnRpb192ZG1hYnVmX2V2ZW50X3JlYWQsCisJLnBvbGwgPSB2aXJ0aW9fdmRtYWJ1Zl9l
dmVudF9wb2xsLAorCS51bmxvY2tlZF9pb2N0bCA9IHZpcnRpb192ZG1hYnVmX2lvY3RsLAorfTsK
Kworc3RhdGljIHN0cnVjdCBtaXNjZGV2aWNlIHZpcnRpb192ZG1hYnVmX21pc2NkZXYgPSB7CisJ
Lm1pbm9yID0gTUlTQ19EWU5BTUlDX01JTk9SLAorCS5uYW1lID0gInZpcnRpby12ZG1hYnVmIiwK
KwkuZm9wcyA9ICZ2aXJ0aW9fdmRtYWJ1Zl9mb3BzLAorfTsKKworc3RhdGljIGludCB2aXJ0aW9f
dmRtYWJ1Zl9wcm9iZShzdHJ1Y3QgdmlydGlvX2RldmljZSAqdmRldikKK3sKKwl2cV9jYWxsYmFj
a190ICpjYnNbXSA9IHsKKwkJdmlydGlvX3ZkbWFidWZfcmVjdl9jYiwKKwkJdmlydGlvX3ZkbWFi
dWZfc2VuZF9jYiwKKwl9OworCXN0YXRpYyBjb25zdCBjaGFyICpjb25zdCBuYW1lc1tdID0gewor
CQkicmVjdiIsCisJCSJzZW5kIiwKKwl9OworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1ZiAqdmRtYWJ1
ZjsKKwlpbnQgcmV0ID0gMDsKKworCWlmICghZHJ2X2luZm8pCisJCXJldHVybiAtRUlOVkFMOwor
CisJdmRtYWJ1ZiA9IGRydl9pbmZvLT5wcml2OworCisJaWYgKCF2ZG1hYnVmKQorCQlyZXR1cm4g
LUVJTlZBTDsKKworCXZkbWFidWYtPnZkZXYgPSB2ZGV2OworCXZkZXYtPnByaXYgPSB2ZG1hYnVm
OworCisJLyogaW5pdGlhbGl6ZSBzcGlubG9jayBmb3Igc3luY2hyb25pemluZyB2aXJ0cXVldWUg
YWNjZXNzZXMgKi8KKwlzcGluX2xvY2tfaW5pdCgmdmRtYWJ1Zi0+dnFfbG9jayk7CisKKwlyZXQg
PSB2aXJ0aW9fZmluZF92cXModmRtYWJ1Zi0+dmRldiwgVkRNQUJVRl9WUV9NQVgsIHZkbWFidWYt
PnZxcywKKwkJCSAgICAgIGNicywgbmFtZXMsIE5VTEwpOworCWlmIChyZXQpIHsKKwkJZGV2X2Vy
cihkcnZfaW5mby0+ZGV2LCAiQ2Fubm90IGZpbmQgYW55IHZxc1xuIik7CisJCXJldHVybiByZXQ7
CisJfQorCisJSU5JVF9MSVNUX0hFQUQoJnZkbWFidWYtPm1zZ19saXN0KTsKKwlJTklUX1dPUkso
JnZkbWFidWYtPnJlY3Zfd29yaywgdmlydGlvX3ZkbWFidWZfcmVjdl93b3JrKTsKKwlJTklUX1dP
UksoJnZkbWFidWYtPnNlbmRfd29yaywgdmlydGlvX3ZkbWFidWZfc2VuZF93b3JrKTsKKwlJTklU
X1dPUksoJnZkbWFidWYtPnNlbmRfbXNnX3dvcmssIHZpcnRpb192ZG1hYnVmX3NlbmRfbXNnX3dv
cmspOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgdmlydGlvX3ZkbWFidWZfcmVt
b3ZlKHN0cnVjdCB2aXJ0aW9fZGV2aWNlICp2ZGV2KQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1
ZiAqdmRtYWJ1ZjsKKworCWlmICghZHJ2X2luZm8pCisJCXJldHVybjsKKworCXZkbWFidWYgPSBk
cnZfaW5mby0+cHJpdjsKKwlmbHVzaF93b3JrKCZ2ZG1hYnVmLT5yZWN2X3dvcmspOworCWZsdXNo
X3dvcmsoJnZkbWFidWYtPnNlbmRfd29yayk7CisJZmx1c2hfd29yaygmdmRtYWJ1Zi0+c2VuZF9t
c2dfd29yayk7CisKKwl2ZGV2LT5jb25maWctPnJlc2V0KHZkZXYpOworCXZkZXYtPmNvbmZpZy0+
ZGVsX3Zxcyh2ZGV2KTsKK30KKworc3RhdGljIHN0cnVjdCB2aXJ0aW9fZGV2aWNlX2lkIGlkX3Rh
YmxlW10gPSB7CisJeyBWSVJUSU9fSURfVkRNQUJVRiwgVklSVElPX0RFVl9BTllfSUQgfSwKKwl7
IDAgfSwKK307CisKK3N0YXRpYyBzdHJ1Y3QgdmlydGlvX2RyaXZlciB2aXJ0aW9fdmRtYWJ1Zl92
ZGV2X2RydiA9IHsKKwkuZHJpdmVyLm5hbWUgPSAgS0JVSUxEX01PRE5BTUUsCisJLmRyaXZlci5v
d25lciA9IFRISVNfTU9EVUxFLAorCS5pZF90YWJsZSA9ICAgICBpZF90YWJsZSwKKwkucHJvYmUg
PSAgICAgICAgdmlydGlvX3ZkbWFidWZfcHJvYmUsCisJLnJlbW92ZSA9ICAgICAgIHZpcnRpb192
ZG1hYnVmX3JlbW92ZSwKK307CisKK3N0YXRpYyBpbnQgX19pbml0IHZpcnRpb192ZG1hYnVmX2lu
aXQodm9pZCkKK3sKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWYgKnZkbWFidWY7CisJaW50IHJldCA9
IDA7CisKKwlkcnZfaW5mbyA9IE5VTEw7CisKKwlyZXQgPSBtaXNjX3JlZ2lzdGVyKCZ2aXJ0aW9f
dmRtYWJ1Zl9taXNjZGV2KTsKKwlpZiAocmV0KSB7CisJCXByX2VycigidmlydGlvLXZkbWFidWYg
bWlzYyBkcml2ZXIgY2FuJ3QgYmUgcmVnaXN0ZXJlZFxuIik7CisJCXJldHVybiByZXQ7CisJfQor
CisJZG1hX2NvZXJjZV9tYXNrX2FuZF9jb2hlcmVudCh2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2LnRo
aXNfZGV2aWNlLAorCQkJCSAgICAgRE1BX0JJVF9NQVNLKDY0KSk7CisKKwlkcnZfaW5mbyA9IGt2
Y2FsbG9jKDEsIHNpemVvZigqZHJ2X2luZm8pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRydl9pbmZv
KSB7CisJCW1pc2NfZGVyZWdpc3RlcigmdmlydGlvX3ZkbWFidWZfbWlzY2Rldik7CisJCXJldHVy
biAtRU5PTUVNOworCX0KKworCXZkbWFidWYgPSBrdmNhbGxvYygxLCBzaXplb2YoKnZkbWFidWYp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIXZkbWFidWYpIHsKKwkJa3ZmcmVlKGRydl9pbmZvKTsKKwkJ
bWlzY19kZXJlZ2lzdGVyKCZ2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2KTsKKwkJcmV0dXJuIC1FTk9N
RU07CisJfQorCisJdmRtYWJ1Zi0+ZXZxID0ga3ZjYWxsb2MoMSwgc2l6ZW9mKCp2ZG1hYnVmLT5l
dnEpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXZkbWFidWYtPmV2cSkgeworCQlrdmZyZWUoZHJ2X2lu
Zm8pOworCQlrdmZyZWUodmRtYWJ1Zik7CisJCW1pc2NfZGVyZWdpc3RlcigmdmlydGlvX3ZkbWFi
dWZfbWlzY2Rldik7CisJCXJldHVybiAtRU5PTUVNOworCX0KKworCWRydl9pbmZvLT5wcml2ID0g
KHZvaWQgKil2ZG1hYnVmOworCWRydl9pbmZvLT5kZXYgPSB2aXJ0aW9fdmRtYWJ1Zl9taXNjZGV2
LnRoaXNfZGV2aWNlOworCisJbXV0ZXhfaW5pdCgmZHJ2X2luZm8tPmdfbXV0ZXgpOworCisJbXV0
ZXhfaW5pdCgmdmRtYWJ1Zi0+ZXZxLT5lX3JlYWRsb2NrKTsKKwlzcGluX2xvY2tfaW5pdCgmdmRt
YWJ1Zi0+ZXZxLT5lX2xvY2spOworCisJSU5JVF9MSVNUX0hFQUQoJnZkbWFidWYtPmV2cS0+ZV9s
aXN0KTsKKwlpbml0X3dhaXRxdWV1ZV9oZWFkKCZ2ZG1hYnVmLT5ldnEtPmVfd2FpdCk7CisJaGFz
aF9pbml0KGRydl9pbmZvLT5idWZfbGlzdCk7CisKKwl2ZG1hYnVmLT5ldnEtPnBlbmRpbmcgPSAw
OworCXZkbWFidWYtPndxID0gY3JlYXRlX3dvcmtxdWV1ZSgidmlydGlvX3ZkbWFidWZfd3EiKTsK
KworCXJldCA9IHJlZ2lzdGVyX3ZpcnRpb19kcml2ZXIoJnZpcnRpb192ZG1hYnVmX3ZkZXZfZHJ2
KTsKKwlpZiAocmV0KSB7CisJCWRldl9lcnIoZHJ2X2luZm8tPmRldiwgInZkbWFidWYgZHJpdmVy
IGNhbid0IGJlIHJlZ2lzdGVyZWRcbiIpOworCQltaXNjX2RlcmVnaXN0ZXIoJnZpcnRpb192ZG1h
YnVmX21pc2NkZXYpOworCQlrdmZyZWUodmRtYWJ1Zik7CisJCWt2ZnJlZShkcnZfaW5mbyk7CisJ
CXJldHVybiAtRUZBVUxUOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBfX2V4
aXQgdmlydGlvX3ZkbWFidWZfZGVpbml0KHZvaWQpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVm
ICp2ZG1hYnVmID0gZHJ2X2luZm8tPnByaXY7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2V2ZW50
ICplLCAqZXQ7CisJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKKworCW1pc2NfZGVyZWdpc3Rlcigm
dmlydGlvX3ZkbWFidWZfbWlzY2Rldik7CisJdW5yZWdpc3Rlcl92aXJ0aW9fZHJpdmVyKCZ2aXJ0
aW9fdmRtYWJ1Zl92ZGV2X2Rydik7CisKKwlpZiAodmRtYWJ1Zi0+d3EpCisJCWRlc3Ryb3lfd29y
a3F1ZXVlKHZkbWFidWYtPndxKTsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZ2ZG1hYnVmLT5ldnEt
PmVfbG9jaywgaXJxZmxhZ3MpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGUsIGV0LCAm
dmRtYWJ1Zi0+ZXZxLT5lX2xpc3QsCisJCQkJIGxpbmspIHsKKwkJbGlzdF9kZWwoJmUtPmxpbmsp
OworCQlrdmZyZWUoZSk7CisJCXZkbWFidWYtPmV2cS0+cGVuZGluZy0tOworCX0KKworCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnZkbWFidWYtPmV2cS0+ZV9sb2NrLCBpcnFmbGFncyk7CisKKwkv
KiBmcmVlaW5nIGFsbCBleHBvcnRlZCBidWZmZXJzICovCisJcmVtb3ZlX2FsbF9idWZzKHZkbWFi
dWYpOworCisJa3ZmcmVlKHZkbWFidWYtPmV2cSk7CisJa3ZmcmVlKHZkbWFidWYpOworCWt2ZnJl
ZShkcnZfaW5mbyk7Cit9CisKK21vZHVsZV9pbml0KHZpcnRpb192ZG1hYnVmX2luaXQpOworbW9k
dWxlX2V4aXQodmlydGlvX3ZkbWFidWZfZGVpbml0KTsKKworTU9EVUxFX0RFVklDRV9UQUJMRSh2
aXJ0aW8sIHZpcnRpb192ZG1hYnVmX2lkX3RhYmxlKTsKK01PRFVMRV9ERVNDUklQVElPTigiVmly
dGlvIFZkbWFidWYgZnJvbnRlbmQgZHJpdmVyIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIGFuZCBh
ZGRpdGlvbmFsIHJpZ2h0cyIpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC92aXJ0aW9fdmRt
YWJ1Zi5oIGIvaW5jbHVkZS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZGRkMGQzYzhhOTFjCi0tLSAvZGV2L251bGwKKysrIGIv
aW5jbHVkZS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oCkBAIC0wLDAgKzEsMjg3IEBACisvKiBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogKE1JVCBPUiBHUEwtMi4wKSAqLworCisvKgorICogQ29weXJp
Z2h0IMKpIDIwMjEgSW50ZWwgQ29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVi
eSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICog
Y29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMg
KHRoZSAiU29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVz
dHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8g
dXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNl
LAorICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBw
ZXJzb25zIHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1
YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5
cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5l
eHQKKyAqIHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJz
dGFudGlhbCBwb3J0aW9ucyBvZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FS
RSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBS
RVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJS
QU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFV
VEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFH
RVMgT1IgT1RIRVIKKyAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJB
Q1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09O
TkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCisg
KiBJTiBUSEUgU09GVFdBUkUuCisgKgorICovCisKKyNpZm5kZWYgX0xJTlVYX1ZJUlRJT19WRE1B
QlVGX0ggCisjZGVmaW5lIF9MSU5VWF9WSVJUSU9fVkRNQUJVRl9IIAorCisjaW5jbHVkZSA8dWFw
aS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oPgorI2luY2x1ZGUgPGxpbnV4L2hhc2h0YWJsZS5oPgor
I2luY2x1ZGUgPGxpbnV4L2t2bV90eXBlcy5oPgorCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfc2hh
cmVkX3BhZ2VzIHsKKwkvKiBjcm9zcy1WTSByZWYgYWRkciBmb3IgdGhlIGJ1ZmZlciAqLworCWdw
YV90IHJlZjsKKworCS8qIHBhZ2UgYXJyYXkgKi8KKwlzdHJ1Y3QgcGFnZSAqKnBhZ2VzOworCWdw
YV90ICoqbDJyZWZzOworCWdwYV90ICpsM3JlZnM7CisKKwkvKiBkYXRhIG9mZnNldCBpbiB0aGUg
Zmlyc3QgcGFnZQorCSAqIGFuZCBkYXRhIGxlbmd0aCBpbiB0aGUgbGFzdCBwYWdlCisJICovCisJ
aW50IGZpcnN0X29mc3Q7CisJaW50IGxhc3RfbGVuOworCisJLyogbnVtYmVyIG9mIHNoYXJlZCBw
YWdlcyAqLworCWludCBuZW50czsKK307CisKK3N0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgewor
CXZpcnRpb192ZG1hYnVmX2J1Zl9pZF90IGJ1Zl9pZDsKKworCXN0cnVjdCBkbWFfYnVmX2F0dGFj
aG1lbnQgKmF0dGFjaDsKKwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZjsKKwlzdHJ1Y3Qgc2dfdGFi
bGUgKnNndDsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfc2hhcmVkX3BhZ2VzICpwYWdlc19pbmZv
OworCWludCB2bWlkOworCWludCBmZDsKKwl1aW50NjRfdCBzaXplOworCisJLyogdmFsaWRpdHkg
b2YgdGhlIGJ1ZmZlciAqLworCWJvb2wgdmFsaWQ7CisKKwkvKiBzZXQgaWYgdGhlIGJ1ZmZlciBp
cyBpbXBvcnRlZCB2aWEgaW1wb3J0X2lvY3RsICovCisJYm9vbCBpbXBvcnRlZDsKKworCS8qIHNp
emUgb2YgcHJpdmF0ZSAqLworCXNpemVfdCBzel9wcml2OworCS8qIHByaXZhdGUgZGF0YSBhc3Nv
Y2lhdGVkIHdpdGggdGhlIGV4cG9ydGVkIGJ1ZmZlciAqLworCXZvaWQgKnByaXY7CisKKwlzdHJ1
Y3QgZmlsZSAqZmlscDsKKwlzdHJ1Y3QgaGxpc3Rfbm9kZSBub2RlOworfTsKKworc3RydWN0IHZp
cnRpb192ZG1hYnVmX2V2ZW50IHsKKwlzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfZV9kYXRhIGVfZGF0
YTsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7Cit9OworCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWZf
ZXZlbnRfcXVldWUgeworCXdhaXRfcXVldWVfaGVhZF90IGVfd2FpdDsKKwlzdHJ1Y3QgbGlzdF9o
ZWFkIGVfbGlzdDsKKworCXNwaW5sb2NrX3QgZV9sb2NrOworCXN0cnVjdCBtdXRleCBlX3JlYWRs
b2NrOworCisJLyogIyBvZiBwZW5kaW5nIGV2ZW50cyAqLworCWludCBwZW5kaW5nOworfTsKKwor
LyogZHJpdmVyIGluZm9ybWF0aW9uICovCitzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfaW5mbyB7CisJ
c3RydWN0IGRldmljZSAqZGV2OworCisJc3RydWN0IGxpc3RfaGVhZCBoZWFkX3ZkbWFidWZfbGlz
dDsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGt2bV9pbnN0YW5jZXM7CisKKwlERUNMQVJFX0hBU0hUQUJM
RShidWZfbGlzdCwgNyk7CisKKwl2b2lkICpwcml2OworCXN0cnVjdCBtdXRleCBnX211dGV4Owor
CXN0cnVjdCBub3RpZmllcl9ibG9jayBrdm1fbm90aWZpZXI7Cit9OworCisvKiBJT0NUTCBkZWZp
bml0aW9ucworICovCit0eXBlZGVmIGludCAoKnZpcnRpb192ZG1hYnVmX2lvY3RsX3QpKHN0cnVj
dCBmaWxlICpmaWxwLCB2b2lkICpkYXRhKTsKKworc3RydWN0IHZpcnRpb192ZG1hYnVmX2lvY3Rs
X2Rlc2MgeworCXVuc2lnbmVkIGludCBjbWQ7CisJaW50IGZsYWdzOworCXZpcnRpb192ZG1hYnVm
X2lvY3RsX3QgZnVuYzsKKwljb25zdCBjaGFyICpuYW1lOworfTsKKworI2RlZmluZSBWSVJUSU9f
VkRNQUJVRl9JT0NUTF9ERUYoaW9jdGwsIF9mdW5jLCBfZmxhZ3MpCVwKKwlbX0lPQ19OUihpb2N0
bCldID0gewkJCVwKKwkJCS5jbWQgPSBpb2N0bCwJCVwKKwkJCS5mdW5jID0gX2Z1bmMsCQlcCisJ
CQkuZmxhZ3MgPSBfZmxhZ3MsCVwKKwkJCS5uYW1lID0gI2lvY3RsCQlcCit9CisKKyNkZWZpbmUg
VklSVElPX1ZETUFCVUZfVk1JRChidWZfaWQpICgoKChidWZfaWQpLmlkKSA+PiAzMikgJiAweEZG
RkZGRkZGKQorCisvKiBNZXNzYWdlcyBiZXR3ZWVuIEhvc3QgYW5kIEd1ZXN0ICovCisKKy8qIExp
c3Qgb2YgY29tbWFuZHMgZnJvbSBHdWVzdCB0byBIb3N0OgorICoKKyAqIC0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQorICog
QS4gTkVFRF9WTUlECisgKgorICogIGd1ZXN0IGFza3MgdGhlIGhvc3QgdG8gcHJvdmlkZSBpdHMg
dm1pZAorICoKKyAqIHJlcToKKyAqCisgKiBjbWQ6IFZJUlRJT19WRE1BQlVGX05FRURfVk1JRAor
ICoKKyAqIGFjazoKKyAqCisgKiBjbWQ6IHNhbWUgYXMgcmVxCisgKiBvcFswXSA6IHZtaWQgb2Yg
Z3Vlc3QKKyAqCisgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIEIuIEVYUE9SVAorICoKKyAqICBleHBvcnQgZG1h
YnVmIHRvIGhvc3QKKyAqCisgKiByZXE6CisgKgorICogY21kOiBWSVJUSU9fVkRNQUJVRl9DTURf
RVhQT1JUCisgKiBvcDB+b3AzIDogSERNQUJVRiBJRAorICogb3A0IDogbnVtYmVyIG9mIHBhZ2Vz
IHRvIGJlIHNoYXJlZAorICogb3A1IDogb2Zmc2V0IG9mIGRhdGEgaW4gdGhlIGZpcnN0IHBhZ2UK
KyAqIG9wNiA6IGxlbmd0aCBvZiBkYXRhIGluIHRoZSBsYXN0IHBhZ2UKKyAqIG9wNyA6IHVwcGVy
IDMyIGJpdCBvZiB0b3AtbGV2ZWwgcmVmIG9mIHNoYXJlZCBidWYKKyAqIG9wOCA6IGxvd2VyIDMy
IGJpdCBvZiB0b3AtbGV2ZWwgcmVmIG9mIHNoYXJlZCBidWYKKyAqIG9wOSA6IHNpemUgb2YgcHJp
dmF0ZSBkYXRhCisgKiBvcDEwIH4gb3A2NDogVXNlciBwcml2YXRlIGRhdGUgYXNzb2NpYXRlZCB3
aXRoIHRoZSBidWZmZXIKKyAqCSAgICAgICAgKGUuZy4gZ3JhcGhpYyBidWZmZXIncyBtZXRhIGlu
Zm8pCisgKgorICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tCisgKgorICogTGlzdCBvZiBjb21tYW5kcyBmcm9tIEhvc3Qg
dG8gR3Vlc3QKKyAqCisgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqIEEuIFJFTEVBU0UKKyAqCisgKiAgbm90aWZ5
aW5nIGd1ZXN0IHRoYXQgdGhlIHNoYXJlZCBidWZmZXIgaXMgcmVsZWFzZWQgYnkgYW4gaW1wb3J0
ZXIKKyAqCisgKiByZXE6CisgKgorICogY21kOiBWSVJUSU9fVkRNQUJVRl9DTURfRE1BQlVGX1JF
TAorICogb3Awfm9wMyA6IFZETUFCVUYgSUQKKyAqCisgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KKyAqLworCisvKiBt
c2cgc3RydWN0dXJlcyAqLworc3RydWN0IHZpcnRpb192ZG1hYnVmX21zZyB7CisJc3RydWN0IGxp
c3RfaGVhZCBsaXN0OworCXVuc2lnbmVkIGludCBjbWQ7CisJdW5zaWduZWQgaW50IG9wWzY0XTsK
K307CisKK2VudW0geworCVZETUFCVUZfVlFfUkVDViA9IDAsCisJVkRNQUJVRl9WUV9TRU5EID0g
MSwKKwlWRE1BQlVGX1ZRX01BWCAgPSAyLAorfTsKKworZW51bSB2aXJ0aW9fdmRtYWJ1Zl9jbWQg
eworCVZJUlRJT19WRE1BQlVGX0NNRF9ORUVEX1ZNSUQsCisJVklSVElPX1ZETUFCVUZfQ01EX0VY
UE9SVCA9IDB4MTAsCisJVklSVElPX1ZETUFCVUZfQ01EX0RNQUJVRl9SRUwKK307CisKK2VudW0g
dmlydGlvX3ZkbWFidWZfb3BzIHsKKwlWSVJUSU9fVkRNQUJVRl9IRE1BQlVGX0lEX0lEID0gMCwK
KwlWSVJUSU9fVkRNQUJVRl9IRE1BQlVGX0lEX1JOR19LRVkwLAorCVZJUlRJT19WRE1BQlVGX0hE
TUFCVUZfSURfUk5HX0tFWTEsCisJVklSVElPX1ZETUFCVUZfTlVNX1BBR0VTX1NIQVJFRCA9IDQs
CisJVklSVElPX1ZETUFCVUZfRklSU1RfUEFHRV9EQVRBX09GRlNFVCwKKwlWSVJUSU9fVkRNQUJV
Rl9MQVNUX1BBR0VfREFUQV9MRU5HVEgsCisJVklSVElPX1ZETUFCVUZfUkVGX0FERFJfVVBQRVJf
MzJCSVQsCisJVklSVElPX1ZETUFCVUZfUkVGX0FERFJfTE9XRVJfMzJCSVQsCisJVklSVElPX1ZE
TUFCVUZfUFJJVkFURV9EQVRBX1NJWkUsCisJVklSVElPX1ZETUFCVUZfUFJJVkFURV9EQVRBX1NU
QVJUCit9OworCisvKiBhZGRpbmcgZXhwb3J0ZWQvaW1wb3J0ZWQgdmRtYWJ1ZiBpbmZvIHRvIGhh
c2ggKi8KK3N0YXRpYyBpbmxpbmUgaW50Cit2aXJ0aW9fdmRtYWJ1Zl9hZGRfYnVmKHN0cnVjdCB2
aXJ0aW9fdmRtYWJ1Zl9pbmZvICppbmZvLAorICAgICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
dmlydGlvX3ZkbWFidWZfYnVmICpuZXcpCit7CisJaGFzaF9hZGQoaW5mby0+YnVmX2xpc3QsICZu
ZXctPm5vZGUsIG5ldy0+YnVmX2lkLmlkKTsKKwlyZXR1cm4gMDsKK30KKworLyogY29tcGFyaW5n
IHR3byB2ZG1hYnVmIElEcyAqLworc3RhdGljIGlubGluZSBib29sCitpc19zYW1lX2J1Zih2aXJ0
aW9fdmRtYWJ1Zl9idWZfaWRfdCBhLAorICAgICAgICAgICAgdmlydGlvX3ZkbWFidWZfYnVmX2lk
X3QgYikKK3sKKwlpbnQgaTsKKworCWlmIChhLmlkICE9IGIuaWQpCisJCXJldHVybiBmYWxzZTsK
KworCS8qIGNvbXBhcmUga2V5cyAqLworCWZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKKwkJaWYg
KGEucm5nX2tleVtpXSAhPSBiLnJuZ19rZXlbaV0pCisJCQlyZXR1cm4gZmFsc2U7CisJfQorCisJ
cmV0dXJuIHRydWU7Cit9CisKKy8qIGZpbmQgYnVmIGZvciBnaXZlbiB2ZG1hYnVmIElEICovCitz
dGF0aWMgaW5saW5lIHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYKKyp2aXJ0aW9fdmRtYWJ1Zl9m
aW5kX2J1ZihzdHJ1Y3QgdmlydGlvX3ZkbWFidWZfaW5mbyAqaW5mbywKKwkJCSB2aXJ0aW9fdmRt
YWJ1Zl9idWZfaWRfdCAqYnVmX2lkKQoreworCXN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9idWYgKmZv
dW5kOworCisJaGFzaF9mb3JfZWFjaF9wb3NzaWJsZShpbmZvLT5idWZfbGlzdCwgZm91bmQsIG5v
ZGUsIGJ1Zl9pZC0+aWQpCisJCWlmIChpc19zYW1lX2J1Zihmb3VuZC0+YnVmX2lkLCAqYnVmX2lk
KSkKKwkJCXJldHVybiBmb3VuZDsKKworCXJldHVybiBOVUxMOworfQorCisvKiBmaW5kIGJ1ZiBm
b3IgZ2l2ZW4gZmQgKi8KK3N0YXRpYyBpbmxpbmUgc3RydWN0IHZpcnRpb192ZG1hYnVmX2J1Zgor
KnZpcnRpb192ZG1hYnVmX2ZpbmRfYnVmX2ZkKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9pbmZvICpp
bmZvLCBpbnQgZmQpCit7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZm91bmQ7CisJaW50
IGk7CisKKwloYXNoX2Zvcl9lYWNoKGluZm8tPmJ1Zl9saXN0LCBpLCBmb3VuZCwgbm9kZSkKKwkJ
aWYgKGZvdW5kLT5mZCA9PSBmZCkKKwkJCXJldHVybiBmb3VuZDsKKworCXJldHVybiBOVUxMOwor
fQorCisvKiBkZWxldGUgYnVmIGZyb20gaGFzaCAqLworc3RhdGljIGlubGluZSBpbnQKK3ZpcnRp
b192ZG1hYnVmX2RlbF9idWYoc3RydWN0IHZpcnRpb192ZG1hYnVmX2luZm8gKmluZm8sCisgICAg
ICAgICAgICAgICAgICAgICAgIHZpcnRpb192ZG1hYnVmX2J1Zl9pZF90ICpidWZfaWQpCit7CisJ
c3RydWN0IHZpcnRpb192ZG1hYnVmX2J1ZiAqZm91bmQ7CisKKwlmb3VuZCA9IHZpcnRpb192ZG1h
YnVmX2ZpbmRfYnVmKGluZm8sIGJ1Zl9pZCk7CisJaWYgKCFmb3VuZCkKKwkJcmV0dXJuIC1FTk9F
TlQ7CisKKwloYXNoX2RlbCgmZm91bmQtPm5vZGUpOworCisJcmV0dXJuIDA7Cit9CisKKyNlbmRp
ZgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS91YXBpL2xpbnV4L3ZpcnRpb19pZHMuaCBiL2luY2x1ZGUv
dWFwaS9saW51eC92aXJ0aW9faWRzLmgKaW5kZXggYmMxYzA2MjFmNWVkLi4wYmUzZWYyOGRkMGMg
MTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9faWRzLmgKKysrIGIvaW5jbHVk
ZS91YXBpL2xpbnV4L3ZpcnRpb19pZHMuaApAQCAtNTQsNSArNTQsNiBAQAogI2RlZmluZSBWSVJU
SU9fSURfRlMJCQkyNiAvKiB2aXJ0aW8gZmlsZXN5c3RlbSAqLwogI2RlZmluZSBWSVJUSU9fSURf
UE1FTQkJCTI3IC8qIHZpcnRpbyBwbWVtICovCiAjZGVmaW5lIFZJUlRJT19JRF9NQUM4MDIxMV9I
V1NJTQkyOSAvKiB2aXJ0aW8gbWFjODAyMTEtaHdzaW0gKi8KKyNkZWZpbmUgVklSVElPX0lEX1ZE
TUFCVUYgICAgICAgICAgCTM3IC8qIHZpcnRpbyB2ZG1hYnVmICovCiAKICNlbmRpZiAvKiBfTElO
VVhfVklSVElPX0lEU19IICovCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvbGludXgvdmlydGlv
X3ZkbWFidWYuaCBiL2luY2x1ZGUvdWFwaS9saW51eC92aXJ0aW9fdmRtYWJ1Zi5oCm5ldyBmaWxl
IG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZjcxZmMwNTRiYmZmCi0tLSAvZGV2L251
bGwKKysrIGIvaW5jbHVkZS91YXBpL2xpbnV4L3ZpcnRpb192ZG1hYnVmLmgKQEAgLTAsMCArMSw4
NyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IChNSVQgT1IgR1BMLTIuMCkKKworLyoK
KyAqIENvcHlyaWdodCDCqSAyMDIxIEludGVsIENvcnBvcmF0aW9uCisgKgorICogUGVybWlzc2lv
biBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWlu
aW5nIGEKKyAqIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0
aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksCisgKiB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3
aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uCisgKiB0aGUg
cmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwg
c3VibGljZW5zZSwKKyAqIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0
byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQorICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRv
IGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKKyAqCisgKiBUaGUg
YWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSAoaW5jbHVk
aW5nIHRoZSBuZXh0CisgKiBwYXJhZ3JhcGgpIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3Bp
ZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlCisgKiBTb2Z0d2FyZS4KKyAqCisgKiBU
SEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkg
S0lORCwgRVhQUkVTUyBPUgorICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBU
TyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCisgKiBGSVRORVNTIEZPUiBBIFBB
UlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiAgSU4gTk8gRVZFTlQgU0hBTEwK
KyAqIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENM
QUlNLCBEQU1BR0VTIE9SIE9USEVSCisgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9O
IE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORworICogRlJPTSwgT1VUIE9G
IE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBE
RUFMSU5HUworICogSU4gVEhFIFNPRlRXQVJFLgorICoKKyAqLworCisjaWZuZGVmIF9VQVBJX0xJ
TlVYX1ZJUlRJT19WRE1BQlVGX0gKKyNkZWZpbmUgX1VBUElfTElOVVhfVklSVElPX1ZETUFCVUZf
SAorCisjZGVmaW5lIE1BWF9TSVpFX1BSSVZfREFUQSAxOTIKKwordHlwZWRlZiBzdHJ1Y3Qgewor
CV9fdTY0IGlkOworCS8qIDhCIGxvbmcgUmFuZG9tIG51bWJlciAqLworCWludCBybmdfa2V5WzJd
OworfSB2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdDsKKworc3RydWN0IHZpcnRpb192ZG1hYnVmX2Vf
aGRyIHsKKwkvKiBidWZfaWQgb2YgbmV3IGJ1ZiAqLworCXZpcnRpb192ZG1hYnVmX2J1Zl9pZF90
IGJ1Zl9pZDsKKwkvKiBzaXplIG9mIHByaXZhdGUgZGF0YSAqLworCWludCBzaXplOworfTsKKwor
c3RydWN0IHZpcnRpb192ZG1hYnVmX2VfZGF0YSB7CisJc3RydWN0IHZpcnRpb192ZG1hYnVmX2Vf
aGRyIGhkcjsKKwkvKiBwdHIgdG8gcHJpdmF0ZSBkYXRhICovCisJdm9pZCBfX3VzZXIgKmRhdGE7
Cit9OworCisjZGVmaW5lIFZJUlRJT19WRE1BQlVGX0lPQ1RMX0lNUE9SVCBcCitfSU9DKF9JT0Nf
Tk9ORSwgJ0cnLCAyLCBzaXplb2Yoc3RydWN0IHZpcnRpb192ZG1hYnVmX2ltcG9ydCkpCisjZGVm
aW5lIFZJUlRJT19WRE1BQlVGX0lPQ1RMX1JFTEVBU0UgXAorX0lPQyhfSU9DX05PTkUsICdHJywg
Mywgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9pbXBvcnQpKQorc3RydWN0IHZpcnRpb192
ZG1hYnVmX2ltcG9ydCB7CisJLyogSU4gcGFyYW1ldGVycyAqLworCS8qIHZkbWFidWYgaWQgdG8g
YmUgaW1wb3J0ZWQgKi8KKwl2aXJ0aW9fdmRtYWJ1Zl9idWZfaWRfdCBidWZfaWQ7CisJLyogZmxh
Z3MgKi8KKwlpbnQgZmxhZ3M7CisJLyogT1VUIHBhcmFtZXRlcnMgKi8KKwkvKiBleHBvcnRlZCBk
bWEgYnVmIGZkICovCisJaW50IGZkOworfTsKKworI2RlZmluZSBWSVJUSU9fVkRNQUJVRl9JT0NU
TF9FWFBPUlQgXAorX0lPQyhfSU9DX05PTkUsICdHJywgNCwgc2l6ZW9mKHN0cnVjdCB2aXJ0aW9f
dmRtYWJ1Zl9leHBvcnQpKQorc3RydWN0IHZpcnRpb192ZG1hYnVmX2V4cG9ydCB7CisJLyogSU4g
cGFyYW1ldGVycyAqLworCS8qIERNQSBidWYgZmQgdG8gYmUgZXhwb3J0ZWQgKi8KKwlpbnQgZmQ7
CisJLyogZXhwb3J0ZWQgZG1hIGJ1ZiBpZCAqLworCXZpcnRpb192ZG1hYnVmX2J1Zl9pZF90IGJ1
Zl9pZDsKKwlpbnQgc3pfcHJpdjsKKwljaGFyICpwcml2OworfTsKKworI2RlZmluZSBWSVJUSU9f
VkRNQUJVRl9JT0NUTF9BTExPQ19GRCBcCitfSU9DKF9JT0NfTk9ORSwgJ0cnLCA1LCBzaXplb2Yo
c3RydWN0IHZpcnRpb192ZG1hYnVmX2FsbG9jKSkKK3N0cnVjdCB2aXJ0aW9fdmRtYWJ1Zl9hbGxv
YyB7CisJLyogSU4gcGFyYW1ldGVycyAqLworCXVpbnQzMl90IHNpemU7CisJLyogT1VUIHBhcmFt
ZXRlcnMgKi8KKwlpbnQgZmQ7Cit9OworCisjZW5kaWYKLS0gCjIuMjYuMgoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
