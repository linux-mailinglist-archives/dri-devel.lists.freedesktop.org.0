Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A61ABF29B6
	for <lists+dri-devel@lfdr.de>; Thu,  7 Nov 2019 09:50:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5C2ED6EF1B;
	Thu,  7 Nov 2019 08:50:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from ste-pvt-msa2.bahnhof.se (ste-pvt-msa2.bahnhof.se
 [213.80.101.71])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 120E56EF1C
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 08:50:26 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTP id AE81B3F48F
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:31 +0100 (CET)
X-Virus-Scanned: Debian amavisd-new at bahnhof.se
X-Spam-Flag: NO
X-Spam-Score: -2.099
X-Spam-Level: 
X-Spam-Status: No, score=-2.099 tagged_above=-999 required=6.31
 tests=[BAYES_00=-1.9, DKIM_SIGNED=0.1, DKIM_VALID=-0.1,
 DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1, URIBL_BLOCKED=0.001]
 autolearn=ham autolearn_force=no
Received: from ste-pvt-msa2.bahnhof.se ([127.0.0.1])
 by localhost (ste-ftg-msa2.bahnhof.se [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id o-Xzm6FbButX for <dri-devel@lists.freedesktop.org>;
 Thu,  7 Nov 2019 09:41:26 +0100 (CET)
Received: from mail1.shipmail.org (h-205-35.A357.priv.bahnhof.se
 [155.4.205.35]) (Authenticated sender: mb878879)
 by ste-pvt-msa2.bahnhof.se (Postfix) with ESMTPA id CCA853F470
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:25 +0100 (CET)
Received: from localhost.localdomain.localdomain
 (h-205-35.A357.priv.bahnhof.se [155.4.205.35])
 by mail1.shipmail.org (Postfix) with ESMTPSA id E4378360353
 for <dri-devel@lists.freedesktop.org>; Thu,  7 Nov 2019 09:41:24 +0100 (CET)
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m=20=28VMware=29?=
 <thomas_os@shipmail.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v7 8/8] drm/vmwgfx: Add surface dirty-tracking callbacks
Date: Thu,  7 Nov 2019 09:41:16 +0100
Message-Id: <20191107084116.33032-9-thomas_os@shipmail.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191107084116.33032-1-thomas_os@shipmail.org>
References: <20191107084116.33032-1-thomas_os@shipmail.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=shipmail.org; s=mail; 
 t=1573116084; bh=pPvbYxpiCu02tgYQCzThOSeqTai1n/fxGNoWSZxBseo=;
 h=From:To:Subject:Date:In-Reply-To:References:From;
 b=ZUg/7l/maOmx9TKMYXu/6S5AIGiZ0IvboarlcIQz3zyoNLwnGW7LJhBqDa/SDqXyk
 SUpy90lCj0NirJQLXye0JjKwt9h72tFeXzZN7nic5ZxiaeO9CCmDuNoN//pl14Qdmt
 fiKiLF+A+AWiBGWI/940EhXtlBHemiLgUHWaIOqY=
X-Mailman-Original-Authentication-Results: ste-pvt-msa2.bahnhof.se;
 dkim=pass (1024-bit key;
 unprotected) header.d=shipmail.org header.i=@shipmail.org header.b=ZUg/7l/m; 
 dkim-atps=neutral
X-Mailman-Original-Authentication-Results: ste-ftg-msa2.bahnhof.se
 (amavisd-new); 
 dkim=pass (1024-bit key) header.d=shipmail.org
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogVGhvbWFzIEhlbGxzdHJvbSA8dGhlbGxzdHJvbUB2bXdhcmUuY29tPgoKQWRkIHRoZSBj
YWxsYmFja3MgbmVjZXNzYXJ5IHRvIGltcGxlbWVudCBlbXVsYXRlZCBjb2hlcmVudCBtZW1vcnkg
Zm9yCnN1cmZhY2VzLiBBZGQgYSBmbGFnIHRvIHRoZSBnYl9zdXJmYWNlX2NyZWF0ZSBpb2N0bCB0
byBpbmRpY2F0ZSB0aGF0CnN1cmZhY2UgbWVtb3J5IHNob3VsZCBiZSBjb2hlcmVudC4KQWxzbyBi
dW1wIHRoZSBkcm0gbWlub3IgdmVyc2lvbiB0byBzaWduYWwgdGhlIGF2YWlsYWJpbGl0eSBvZiBj
b2hlcmVudApzdXJmYWNlcy4KCkNjOiBBbmRyZXcgTW9ydG9uIDxha3BtQGxpbnV4LWZvdW5kYXRp
b24ub3JnPgpDYzogTWF0dGhldyBXaWxjb3ggPHdpbGx5QGluZnJhZGVhZC5vcmc+CkNjOiBXaWxs
IERlYWNvbiA8d2lsbC5kZWFjb25AYXJtLmNvbT4KQ2M6IFBldGVyIFppamxzdHJhIDxwZXRlcnpA
aW5mcmFkZWFkLm9yZz4KQ2M6IFJpayB2YW4gUmllbCA8cmllbEBzdXJyaWVsLmNvbT4KQ2M6IE1p
bmNoYW4gS2ltIDxtaW5jaGFuQGtlcm5lbC5vcmc+CkNjOiBNaWNoYWwgSG9ja28gPG1ob2Nrb0Bz
dXNlLmNvbT4KQ2M6IEh1YW5nIFlpbmcgPHlpbmcuaHVhbmdAaW50ZWwuY29tPgpDYzogSsOpcsO0
bWUgR2xpc3NlIDxqZ2xpc3NlQHJlZGhhdC5jb20+CkNjOiBLaXJpbGwgQS4gU2h1dGVtb3YgPGtp
cmlsbEBzaHV0ZW1vdi5uYW1lPgpTaWduZWQtb2ZmLWJ5OiBUaG9tYXMgSGVsbHN0cm9tIDx0aGVs
bHN0cm9tQHZtd2FyZS5jb20+ClJldmlld2VkLWJ5OiBEZWVwYWsgUmF3YXQgPGRyYXdhdEB2bXdh
cmUuY29tPgotLS0KIC4uLi9kZXZpY2VfaW5jbHVkZS9zdmdhM2Rfc3VyZmFjZWRlZnMuaCAgICAg
ICB8IDIzMyArKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2Lmgg
ICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9zdXJmYWNl
LmMgICAgICAgfCAzOTUgKysrKysrKysrKysrKysrKystCiBpbmNsdWRlL3VhcGkvZHJtL3Ztd2dm
eF9kcm0uaCAgICAgICAgICAgICAgICAgfCAgIDQgKy0KIDQgZmlsZXMgY2hhbmdlZCwgNjI5IGlu
c2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC9kZXZpY2VfaW5jbHVkZS9zdmdhM2Rfc3VyZmFjZWRlZnMuaCBiL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvZGV2aWNlX2luY2x1ZGUvc3ZnYTNkX3N1cmZhY2VkZWZzLmgKaW5kZXggZjJi
ZmQzZDgwNTk4Li42MTQxNGYxMDVjNjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS92bXdn
ZngvZGV2aWNlX2luY2x1ZGUvc3ZnYTNkX3N1cmZhY2VkZWZzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL3Ztd2dmeC9kZXZpY2VfaW5jbHVkZS9zdmdhM2Rfc3VyZmFjZWRlZnMuaApAQCAtMTI4MCw3
ICsxMjgwLDYgQEAgc3ZnYTNkc3VyZmFjZV9nZXRfcGl4ZWxfb2Zmc2V0KFNWR0EzZFN1cmZhY2VG
b3JtYXQgZm9ybWF0LAogCXJldHVybiBvZmZzZXQ7CiB9CiAKLQogc3RhdGljIGlubGluZSB1MzIK
IHN2Z2EzZHN1cmZhY2VfZ2V0X2ltYWdlX29mZnNldChTVkdBM2RTdXJmYWNlRm9ybWF0IGZvcm1h
dCwKIAkJCSAgICAgICBzdXJmX3NpemVfc3RydWN0IGJhc2VMZXZlbFNpemUsCkBAIC0xMzc1LDQg
KzEzNzQsMjM2IEBAIHN2Z2EzZHN1cmZhY2VfaXNfc2NyZWVuX3RhcmdldF9mb3JtYXQoU1ZHQTNk
U3VyZmFjZUZvcm1hdCBmb3JtYXQpCiAJcmV0dXJuIHN2Z2EzZHN1cmZhY2VfaXNfZHhfc2NyZWVu
X3RhcmdldF9mb3JtYXQoZm9ybWF0KTsKIH0KIAorLyoqCisgKiBzdHJ1Y3Qgc3ZnYTNkc3VyZmFj
ZV9taXAgLSBNaW1wbWFwIGxldmVsIGluZm9ybWF0aW9uCisgKiBAYnl0ZXM6IEJ5dGVzIHJlcXVp
cmVkIGluIHRoZSBiYWNraW5nIHN0b3JlIG9mIHRoaXMgbWlwbWFwIGxldmVsLgorICogQGltZ19z
dHJpZGU6IEJ5dGUgc3RyaWRlIHBlciBpbWFnZS4KKyAqIEByb3dfc3RyaWRlOiBCeXRlIHN0cmlk
ZSBwZXIgYmxvY2sgcm93LgorICogQHNpemU6IFRoZSBzaXplIG9mIHRoZSBtaXBtYXAuCisgKi8K
K3N0cnVjdCBzdmdhM2RzdXJmYWNlX21pcCB7CisJc2l6ZV90IGJ5dGVzOworCXNpemVfdCBpbWdf
c3RyaWRlOworCXNpemVfdCByb3dfc3RyaWRlOworCXN0cnVjdCBkcm1fdm13X3NpemUgc2l6ZTsK
KworfTsKKworLyoqCisgKiBzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9jYWNoZSAtIENhY2hlZCBzdXJm
YWNlIGluZm9ybWF0aW9uCisgKiBAZGVzYzogUG9pbnRlciB0byB0aGUgc3VyZmFjZSBkZXNjcmlw
dG9yCisgKiBAbWlwOiBBcnJheSBvZiBtaXBtYXAgbGV2ZWwgaW5mb3JtYXRpb24uIFZhbGlkIHNp
emUgaXMgQG51bV9taXBfbGV2ZWxzLgorICogQG1pcF9jaGFpbl9ieXRlczogQnl0ZXMgcmVxdWly
ZWQgaW4gdGhlIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSB3aG9sZSBjaGFpbgorICogb2YgbWlwIGxl
dmVscy4KKyAqIEBzaGVldF9ieXRlczogQnl0ZXMgcmVxdWlyZWQgaW4gdGhlIGJhY2tpbmcgc3Rv
cmUgZm9yIGEgc2hlZXQKKyAqIHJlcHJlc2VudGluZyBhIHNpbmdsZSBzYW1wbGUuCisgKiBAbnVt
X21pcF9sZXZlbHM6IFZhbGlkIHNpemUgb2YgdGhlIEBtaXAgYXJyYXkuIE51bWJlciBvZiBtaXBt
YXAgbGV2ZWxzIGluCisgKiBhIGNoYWluLgorICogQG51bV9sYXllcnM6IE51bWJlciBvZiBzbGlj
ZXMgaW4gYW4gYXJyYXkgdGV4dHVyZSBvciBudW1iZXIgb2YgZmFjZXMgaW4KKyAqIGEgY3ViZW1h
cCB0ZXh0dXJlLgorICovCitzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9jYWNoZSB7CisJY29uc3Qgc3Ry
dWN0IHN2Z2EzZF9zdXJmYWNlX2Rlc2MgKmRlc2M7CisJc3RydWN0IHN2Z2EzZHN1cmZhY2VfbWlw
IG1pcFtEUk1fVk1XX01BWF9NSVBfTEVWRUxTXTsKKwlzaXplX3QgbWlwX2NoYWluX2J5dGVzOwor
CXNpemVfdCBzaGVldF9ieXRlczsKKwl1MzIgbnVtX21pcF9sZXZlbHM7CisJdTMyIG51bV9sYXll
cnM7Cit9OworCisvKioKKyAqIHN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyAtIFN1cmZhY2UgbG9j
YXRpb24KKyAqIEBzdWJfcmVzb3VyY2U6IFN1cmZhY2Ugc3VicmVzb3VyY2UuIERlZmluZWQgYXMg
bGF5ZXIgKiBudW1fbWlwX2xldmVscyArCisgKiBtaXBfbGV2ZWwuCisgKiBAeDogWCBjb29yZGlu
YXRlLgorICogQHk6IFkgY29vcmRpbmF0ZS4KKyAqIEB6OiBaIGNvb3JkaW5hdGUuCisgKi8KK3N0
cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyB7CisJdTMyIHN1Yl9yZXNvdXJjZTsKKwl1MzIgeCwgeSwg
ejsKK307CisKKy8qKgorICogc3ZnYTNkc3VyZmFjZV9zdWJyZXMgLSBDb21wdXRlIHRoZSBzdWJy
ZXNvdXJjZSBmcm9tIGxheWVyIGFuZCBtaXBtYXAuCisgKiBAY2FjaGU6IFN1cmZhY2UgbGF5b3V0
IGRhdGEuCisgKiBAbWlwX2xldmVsOiBUaGUgbWlwbWFwIGxldmVsLgorICogQGxheWVyOiBUaGUg
c3VyZmFjZSBsYXllciAoZmFjZSBvciBhcnJheSBzbGljZSkuCisgKgorICogUmV0dXJuOiBUaGUg
c3VicmVzb3VyY2UuCisgKi8KK3N0YXRpYyBpbmxpbmUgdTMyIHN2Z2EzZHN1cmZhY2Vfc3VicmVz
KGNvbnN0IHN0cnVjdCBzdmdhM2RzdXJmYWNlX2NhY2hlICpjYWNoZSwKKwkJCQkgICAgICAgdTMy
IG1pcF9sZXZlbCwgdTMyIGxheWVyKQoreworCXJldHVybiBjYWNoZS0+bnVtX21pcF9sZXZlbHMg
KiBsYXllciArIG1pcF9sZXZlbDsKK30KKworLyoqCisgKiBzdmdhM2RzdXJmYWNlX3NldHVwX2Nh
Y2hlIC0gQnVpbGQgYSBzdXJmYWNlIGNhY2hlIGVudHJ5CisgKiBAc2l6ZTogVGhlIHN1cmZhY2Ug
YmFzZSBsZXZlbCBkaW1lbnNpb25zLgorICogQGZvcm1hdDogVGhlIHN1cmZhY2UgZm9ybWF0Lgor
ICogQG51bV9taXBfbGV2ZWxzOiBOdW1iZXIgb2YgbWlwbWFwIGxldmVscy4KKyAqIEBudW1fbGF5
ZXJzOiBOdW1iZXIgb2YgbGF5ZXJzLgorICogQGNhY2hlOiBQb2ludGVyIHRvIGEgc3RydWN0IHN2
Z2EzZHN1cmZhY2VfY2FjaCBvYmplY3QgdG8gYmUgZmlsbGVkIGluLgorICoKKyAqIFJldHVybjog
WmVybyBvbiBzdWNjZXNzLCAtRUlOVkFMIG9uIGludmFsaWQgc3VyZmFjZSBsYXlvdXQuCisgKi8K
K3N0YXRpYyBpbmxpbmUgaW50IHN2Z2EzZHN1cmZhY2Vfc2V0dXBfY2FjaGUoY29uc3Qgc3RydWN0
IGRybV92bXdfc2l6ZSAqc2l6ZSwKKwkJCQkJICAgIFNWR0EzZFN1cmZhY2VGb3JtYXQgZm9ybWF0
LAorCQkJCQkgICAgdTMyIG51bV9taXBfbGV2ZWxzLAorCQkJCQkgICAgdTMyIG51bV9sYXllcnMs
CisJCQkJCSAgICB1MzIgbnVtX3NhbXBsZXMsCisJCQkJCSAgICBzdHJ1Y3Qgc3ZnYTNkc3VyZmFj
ZV9jYWNoZSAqY2FjaGUpCit7CisJY29uc3Qgc3RydWN0IHN2Z2EzZF9zdXJmYWNlX2Rlc2MgKmRl
c2M7CisJdTMyIGk7CisKKwltZW1zZXQoY2FjaGUsIDAsIHNpemVvZigqY2FjaGUpKTsKKwljYWNo
ZS0+ZGVzYyA9IGRlc2MgPSBzdmdhM2RzdXJmYWNlX2dldF9kZXNjKGZvcm1hdCk7CisJY2FjaGUt
Pm51bV9taXBfbGV2ZWxzID0gbnVtX21pcF9sZXZlbHM7CisJY2FjaGUtPm51bV9sYXllcnMgPSBu
dW1fbGF5ZXJzOworCWZvciAoaSA9IDA7IGkgPCBjYWNoZS0+bnVtX21pcF9sZXZlbHM7IGkrKykg
eworCQlzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9taXAgKm1pcCA9ICZjYWNoZS0+bWlwW2ldOworCisJ
CW1pcC0+c2l6ZSA9IHN2Z2EzZHN1cmZhY2VfZ2V0X21pcF9zaXplKCpzaXplLCBpKTsKKwkJbWlw
LT5ieXRlcyA9IHN2Z2EzZHN1cmZhY2VfZ2V0X2ltYWdlX2J1ZmZlcl9zaXplCisJCQkoZGVzYywg
Jm1pcC0+c2l6ZSwgMCk7CisJCW1pcC0+cm93X3N0cmlkZSA9CisJCQlfX0tFUk5FTF9ESVZfUk9V
TkRfVVAobWlwLT5zaXplLndpZHRoLAorCQkJCQkgICAgICBkZXNjLT5ibG9ja19zaXplLndpZHRo
KSAqCisJCQlkZXNjLT5ieXRlc19wZXJfYmxvY2sgKiBudW1fc2FtcGxlczsKKwkJaWYgKCFtaXAt
PnJvd19zdHJpZGUpCisJCQlnb3RvIGludmFsaWRfZGltOworCisJCW1pcC0+aW1nX3N0cmlkZSA9
CisJCQlfX0tFUk5FTF9ESVZfUk9VTkRfVVAobWlwLT5zaXplLmhlaWdodCwKKwkJCQkJICAgICAg
ZGVzYy0+YmxvY2tfc2l6ZS5oZWlnaHQpICoKKwkJCW1pcC0+cm93X3N0cmlkZTsKKwkJaWYgKCFt
aXAtPmltZ19zdHJpZGUpCisJCQlnb3RvIGludmFsaWRfZGltOworCisJCWNhY2hlLT5taXBfY2hh
aW5fYnl0ZXMgKz0gbWlwLT5ieXRlczsKKwl9CisJY2FjaGUtPnNoZWV0X2J5dGVzID0gY2FjaGUt
Pm1pcF9jaGFpbl9ieXRlcyAqIG51bV9sYXllcnM7CisJaWYgKCFjYWNoZS0+c2hlZXRfYnl0ZXMp
CisJCWdvdG8gaW52YWxpZF9kaW07CisKKwlyZXR1cm4gMDsKKworaW52YWxpZF9kaW06CisJVk1X
X0RFQlVHX1VTRVIoIkludmFsaWQgc3VyZmFjZSBsYXlvdXQgZm9yIGRpcnR5IHRyYWNraW5nLlxu
Iik7CisJcmV0dXJuIC1FSU5WQUw7Cit9CisKKy8qKgorICogc3ZnYTNkc3VyZmFjZV9nZXRfbG9j
IC0gR2V0IGEgc3VyZmFjZSBsb2NhdGlvbiBmcm9tIGFuIG9mZnNldCBpbnRvIHRoZQorICogYmFj
a2luZyBzdG9yZQorICogQGNhY2hlOiBTdXJmYWNlIGxheW91dCBkYXRhLgorICogQGxvYzogUG9p
bnRlciB0byBhIHN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyB0byBiZSBmaWxsZWQgaW4uCisgKiBA
b2Zmc2V0OiBPZmZzZXQgaW50byB0aGUgc3VyZmFjZSBiYWNraW5nIHN0b3JlLgorICovCitzdGF0
aWMgaW5saW5lIHZvaWQKK3N2Z2EzZHN1cmZhY2VfZ2V0X2xvYyhjb25zdCBzdHJ1Y3Qgc3ZnYTNk
c3VyZmFjZV9jYWNoZSAqY2FjaGUsCisJCSAgICAgIHN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyAq
bG9jLAorCQkgICAgICBzaXplX3Qgb2Zmc2V0KQoreworCWNvbnN0IHN0cnVjdCBzdmdhM2RzdXJm
YWNlX21pcCAqbWlwID0gJmNhY2hlLT5taXBbMF07CisJY29uc3Qgc3RydWN0IHN2Z2EzZF9zdXJm
YWNlX2Rlc2MgKmRlc2MgPSBjYWNoZS0+ZGVzYzsKKwl1MzIgbGF5ZXI7CisJaW50IGk7CisKKwlp
ZiAob2Zmc2V0ID49IGNhY2hlLT5zaGVldF9ieXRlcykKKwkJb2Zmc2V0ICU9IGNhY2hlLT5zaGVl
dF9ieXRlczsKKworCWxheWVyID0gb2Zmc2V0IC8gY2FjaGUtPm1pcF9jaGFpbl9ieXRlczsKKwlv
ZmZzZXQgLT0gbGF5ZXIgKiBjYWNoZS0+bWlwX2NoYWluX2J5dGVzOworCWZvciAoaSA9IDA7IGkg
PCBjYWNoZS0+bnVtX21pcF9sZXZlbHM7ICsraSwgKyttaXApIHsKKwkJaWYgKG1pcC0+Ynl0ZXMg
PiBvZmZzZXQpCisJCQlicmVhazsKKwkJb2Zmc2V0IC09IG1pcC0+Ynl0ZXM7CisJfQorCisJbG9j
LT5zdWJfcmVzb3VyY2UgPSBzdmdhM2RzdXJmYWNlX3N1YnJlcyhjYWNoZSwgaSwgbGF5ZXIpOwor
CWxvYy0+eiA9IG9mZnNldCAvIG1pcC0+aW1nX3N0cmlkZTsKKwlvZmZzZXQgLT0gbG9jLT56ICog
bWlwLT5pbWdfc3RyaWRlOworCWxvYy0+eiAqPSBkZXNjLT5ibG9ja19zaXplLmRlcHRoOworCWxv
Yy0+eSA9IG9mZnNldCAvIG1pcC0+cm93X3N0cmlkZTsKKwlvZmZzZXQgLT0gbG9jLT55ICogbWlw
LT5yb3dfc3RyaWRlOworCWxvYy0+eSAqPSBkZXNjLT5ibG9ja19zaXplLmhlaWdodDsKKwlsb2Mt
PnggPSBvZmZzZXQgLyBkZXNjLT5ieXRlc19wZXJfYmxvY2s7CisJbG9jLT54ICo9IGRlc2MtPmJs
b2NrX3NpemUud2lkdGg7Cit9CisKKy8qKgorICogc3ZnYTNkc3VyZmFjZV9pbmNfbG9jIC0gQ2xh
bXAgaW5jcmVtZW50IGEgc3VyZmFjZSBsb2NhdGlvbiB3aXRoIG9uZSBibG9jaworICogc2l6ZQor
ICogaW4gZWFjaCBkaW1lbnNpb24uCisgKiBAbG9jOiBQb2ludGVyIHRvIGEgc3RydWN0IHN2Z2Ez
ZHN1cmZhY2VfbG9jIHRvIGJlIGluY3JlbWVudGVkLgorICoKKyAqIFdoZW4gY29tcHV0aW5nIHRo
ZSBzaXplIG9mIGEgcmFuZ2UgYXMgc2l6ZSA9IGVuZCAtIHN0YXJ0LCB0aGUgcmFuZ2UgZG9lcyBu
b3QKKyAqIGluY2x1ZGUgdGhlIGVuZCBlbGVtZW50LiBIb3dldmVyIGEgbG9jYXRpb24gcmVwcmVz
ZW50aW5nIHRoZSBsYXN0IGJ5dGUKKyAqIG9mIGEgdG91Y2hlZCByZWdpb24gaW4gdGhlIGJhY2tp
bmcgc3RvcmUgKmlzKiBpbmNsdWRlZCBpbiB0aGUgcmFuZ2UuCisgKiBUaGlzIGZ1bmN0aW9uIG1v
ZGlmaWVzIHN1Y2ggYSBsb2NhdGlvbiB0byBtYXRjaCB0aGUgZW5kIGRlZmluaXRpb24KKyAqIGdp
dmVuIGFzIHN0YXJ0ICsgc2l6ZSB3aGljaCBpcyB0aGUgb25lIHVzZWQgaW4gYSBTVkdBM2RCb3gu
CisgKi8KK3N0YXRpYyBpbmxpbmUgdm9pZAorc3ZnYTNkc3VyZmFjZV9pbmNfbG9jKGNvbnN0IHN0
cnVjdCBzdmdhM2RzdXJmYWNlX2NhY2hlICpjYWNoZSwKKwkJICAgICAgc3RydWN0IHN2Z2EzZHN1
cmZhY2VfbG9jICpsb2MpCit7CisJY29uc3Qgc3RydWN0IHN2Z2EzZF9zdXJmYWNlX2Rlc2MgKmRl
c2MgPSBjYWNoZS0+ZGVzYzsKKwl1MzIgbWlwID0gbG9jLT5zdWJfcmVzb3VyY2UgJSBjYWNoZS0+
bnVtX21pcF9sZXZlbHM7CisJY29uc3Qgc3RydWN0IGRybV92bXdfc2l6ZSAqc2l6ZSA9ICZjYWNo
ZS0+bWlwW21pcF0uc2l6ZTsKKworCWxvYy0+c3ViX3Jlc291cmNlKys7CisJbG9jLT54ICs9IGRl
c2MtPmJsb2NrX3NpemUud2lkdGg7CisJaWYgKGxvYy0+eCA+IHNpemUtPndpZHRoKQorCQlsb2Mt
PnggPSBzaXplLT53aWR0aDsKKwlsb2MtPnkgKz0gZGVzYy0+YmxvY2tfc2l6ZS5oZWlnaHQ7CisJ
aWYgKGxvYy0+eSA+IHNpemUtPmhlaWdodCkKKwkJbG9jLT55ID0gc2l6ZS0+aGVpZ2h0OworCWxv
Yy0+eiArPSBkZXNjLT5ibG9ja19zaXplLmRlcHRoOworCWlmIChsb2MtPnogPiBzaXplLT5kZXB0
aCkKKwkJbG9jLT56ID0gc2l6ZS0+ZGVwdGg7Cit9CisKKy8qKgorICogc3ZnYTNkc3VyZmFjZV9t
aW5fbG9jIC0gVGhlIHN0YXJ0IGxvY2F0aW9uIGluIGEgc3VicmVzb3VyY2UKKyAqIEBjYWNoZTog
U3VyZmFjZSBsYXlvdXQgZGF0YS4KKyAqIEBzdWJfcmVzb3VyY2U6IFRoZSBzdWJyZXNvdXJjZS4K
KyAqIEBsb2M6IFBvaW50ZXIgdG8gYSBzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9sb2MgdG8gYmUgZmls
bGVkIGluLgorICovCitzdGF0aWMgaW5saW5lIHZvaWQKK3N2Z2EzZHN1cmZhY2VfbWluX2xvYyhj
b25zdCBzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9jYWNoZSAqY2FjaGUsCisJCSAgICAgIHUzMiBzdWJf
cmVzb3VyY2UsCisJCSAgICAgIHN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyAqbG9jKQoreworCWxv
Yy0+c3ViX3Jlc291cmNlID0gc3ViX3Jlc291cmNlOworCWxvYy0+eCA9IGxvYy0+eSA9IGxvYy0+
eiA9IDA7Cit9CisKKy8qKgorICogc3ZnYTNkc3VyZmFjZV9taW5fbG9jIC0gVGhlIGVuZCBsb2Nh
dGlvbiBpbiBhIHN1YnJlc291cmNlCisgKiBAY2FjaGU6IFN1cmZhY2UgbGF5b3V0IGRhdGEuCisg
KiBAc3ViX3Jlc291cmNlOiBUaGUgc3VicmVzb3VyY2UuCisgKiBAbG9jOiBQb2ludGVyIHRvIGEg
c3RydWN0IHN2Z2EzZHN1cmZhY2VfbG9jIHRvIGJlIGZpbGxlZCBpbi4KKyAqCisgKiBGb2xsb3dp
bmcgdGhlIGVuZCBkZWZpbml0aW9uIGdpdmVuIGluIHN2Z2EzZHN1cmZhY2VfaW5jX2xvYygpLAor
ICogQ29tcHV0ZSB0aGUgZW5kIGxvY2F0aW9uIG9mIGEgc3VyZmFjZSBzdWJyZXNvdXJjZS4KKyAq
Lworc3RhdGljIGlubGluZSB2b2lkCitzdmdhM2RzdXJmYWNlX21heF9sb2MoY29uc3Qgc3RydWN0
IHN2Z2EzZHN1cmZhY2VfY2FjaGUgKmNhY2hlLAorCQkgICAgICB1MzIgc3ViX3Jlc291cmNlLAor
CQkgICAgICBzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9sb2MgKmxvYykKK3sKKwljb25zdCBzdHJ1Y3Qg
ZHJtX3Ztd19zaXplICpzaXplOworCXUzMiBtaXA7CisKKwlsb2MtPnN1Yl9yZXNvdXJjZSA9IHN1
Yl9yZXNvdXJjZSArIDE7CisJbWlwID0gc3ViX3Jlc291cmNlICUgY2FjaGUtPm51bV9taXBfbGV2
ZWxzOworCXNpemUgPSAmY2FjaGUtPm1pcFttaXBdLnNpemU7CisJbG9jLT54ID0gc2l6ZS0+d2lk
dGg7CisJbG9jLT55ID0gc2l6ZS0+aGVpZ2h0OworCWxvYy0+eiA9IHNpemUtPmRlcHRoOworfQor
CiAjZW5kaWYgLyogX1NWR0EzRF9TVVJGQUNFREVGU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Zt
d2dmeF9kcnYuaAppbmRleCA3NzczOTUyZjgxZjguLmEzMWU3MjZkNmQ3MSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC92bXdnZnhfZHJ2LmgKQEAgLTU2LDkgKzU2LDkgQEAKIAogCiAjZGVmaW5lIFZNV0dG
WF9EUklWRVJfTkFNRSAidm13Z2Z4IgotI2RlZmluZSBWTVdHRlhfRFJJVkVSX0RBVEUgIjIwMTgw
NzA0IgorI2RlZmluZSBWTVdHRlhfRFJJVkVSX0RBVEUgIjIwMTkwMzI4IgogI2RlZmluZSBWTVdH
RlhfRFJJVkVSX01BSk9SIDIKLSNkZWZpbmUgVk1XR0ZYX0RSSVZFUl9NSU5PUiAxNQorI2RlZmlu
ZSBWTVdHRlhfRFJJVkVSX01JTk9SIDE2CiAjZGVmaW5lIFZNV0dGWF9EUklWRVJfUEFUQ0hMRVZF
TCAwCiAjZGVmaW5lIFZNV0dGWF9GSUZPX1NUQVRJQ19TSVpFICgxMDI0KjEwMjQpCiAjZGVmaW5l
IFZNV0dGWF9NQVhfUkVMT0NBVElPTlMgMjA0OApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3Ztd2dmeC92bXdnZnhfc3VyZmFjZS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhf
c3VyZmFjZS5jCmluZGV4IDI5ZDg3OTRmMDQyMS4uOGU5NWU4YTMxZGY4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9zdXJmYWNlLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL3Ztd2dmeC92bXdnZnhfc3VyZmFjZS5jCkBAIC02OCw2ICs2OCwyMCBAQCBzdHJ1Y3Qgdm13
X3N1cmZhY2Vfb2Zmc2V0IHsKIAl1aW50MzJfdCBib19vZmZzZXQ7CiB9OwogCisvKioKKyAqIHZt
d19zdXJmYWNlX2RpcnR5IC0gU3VyZmFjZSBkaXJ0eS10cmFja2VyCisgKiBAY2FjaGU6IENhY2hl
ZCBsYXlvdXQgaW5mb3JtYXRpb24gb2YgdGhlIHN1cmZhY2UuCisgKiBAc2l6ZTogQWNjb3VudGlu
ZyBzaXplIGZvciB0aGUgc3RydWN0IHZtd19zdXJmYWNlX2RpcnR5LgorICogQG51bV9zdWJyZXM6
IE51bWJlciBvZiBzdWJyZXNvdXJjZXMuCisgKiBAYm94ZXM6IEFycmF5IG9mIFNWR0EzZEJveGVz
IGluZGljYXRpbmcgZGlydHkgcmVnaW9ucy4gT25lIHBlciBzdWJyZXNvdXJjZS4KKyAqLworc3Ry
dWN0IHZtd19zdXJmYWNlX2RpcnR5IHsKKwlzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9jYWNoZSBjYWNo
ZTsKKwlzaXplX3Qgc2l6ZTsKKwl1MzIgbnVtX3N1YnJlczsKKwlTVkdBM2RCb3ggYm94ZXNbMF07
Cit9OworCiBzdGF0aWMgdm9pZCB2bXdfdXNlcl9zdXJmYWNlX2ZyZWUoc3RydWN0IHZtd19yZXNv
dXJjZSAqcmVzKTsKIHN0YXRpYyBzdHJ1Y3Qgdm13X3Jlc291cmNlICoKIHZtd191c2VyX3N1cmZh
Y2VfYmFzZV90b19yZXMoc3RydWN0IHR0bV9iYXNlX29iamVjdCAqYmFzZSk7CkBAIC05Niw2ICsx
MTAsMTMgQEAgdm13X2diX3N1cmZhY2VfcmVmZXJlbmNlX2ludGVybmFsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsCiAJCQkJICBzdHJ1Y3QgZHJtX3Ztd19nYl9zdXJmYWNlX3JlZl9leHRfcmVwICpy
ZXAsCiAJCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7CiAKK3N0YXRpYyB2b2lkIHZt
d19zdXJmYWNlX2RpcnR5X2ZyZWUoc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKTsKK3N0YXRpYyBp
bnQgdm13X3N1cmZhY2VfZGlydHlfYWxsb2Moc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKTsKK3N0
YXRpYyBpbnQgdm13X3N1cmZhY2VfZGlydHlfc3luYyhzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMp
Oworc3RhdGljIHZvaWQgdm13X3N1cmZhY2VfZGlydHlfcmFuZ2VfYWRkKHN0cnVjdCB2bXdfcmVz
b3VyY2UgKnJlcywgc2l6ZV90IHN0YXJ0LAorCQkJCQlzaXplX3QgZW5kKTsKK3N0YXRpYyBpbnQg
dm13X3N1cmZhY2VfY2xlYW4oc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKTsKKwogc3RhdGljIGNv
bnN0IHN0cnVjdCB2bXdfdXNlcl9yZXNvdXJjZV9jb252IHVzZXJfc3VyZmFjZV9jb252ID0gewog
CS5vYmplY3RfdHlwZSA9IFZNV19SRVNfU1VSRkFDRSwKIAkuYmFzZV9vYmpfdG9fcmVzID0gdm13
X3VzZXJfc3VyZmFjZV9iYXNlX3RvX3JlcywKQEAgLTEzMyw3ICsxNTQsMTIgQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCB2bXdfcmVzX2Z1bmMgdm13X2diX3N1cmZhY2VfZnVuYyA9IHsKIAkuY3JlYXRl
ID0gdm13X2diX3N1cmZhY2VfY3JlYXRlLAogCS5kZXN0cm95ID0gdm13X2diX3N1cmZhY2VfZGVz
dHJveSwKIAkuYmluZCA9IHZtd19nYl9zdXJmYWNlX2JpbmQsCi0JLnVuYmluZCA9IHZtd19nYl9z
dXJmYWNlX3VuYmluZAorCS51bmJpbmQgPSB2bXdfZ2Jfc3VyZmFjZV91bmJpbmQsCisJLmRpcnR5
X2FsbG9jID0gdm13X3N1cmZhY2VfZGlydHlfYWxsb2MsCisJLmRpcnR5X2ZyZWUgPSB2bXdfc3Vy
ZmFjZV9kaXJ0eV9mcmVlLAorCS5kaXJ0eV9zeW5jID0gdm13X3N1cmZhY2VfZGlydHlfc3luYywK
KwkuZGlydHlfcmFuZ2VfYWRkID0gdm13X3N1cmZhY2VfZGlydHlfcmFuZ2VfYWRkLAorCS5jbGVh
biA9IHZtd19zdXJmYWNlX2NsZWFuLAogfTsKIAogLyoqCkBAIC02NDEsNiArNjY3LDcgQEAgc3Rh
dGljIHZvaWQgdm13X3VzZXJfc3VyZmFjZV9mcmVlKHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcykK
IAlzdHJ1Y3Qgdm13X3ByaXZhdGUgKmRldl9wcml2ID0gc3JmLT5yZXMuZGV2X3ByaXY7CiAJdWlu
dDMyX3Qgc2l6ZSA9IHVzZXJfc3JmLT5zaXplOwogCisJV0FSTl9PTl9PTkNFKHJlcy0+ZGlydHkp
OwogCWlmICh1c2VyX3NyZi0+bWFzdGVyKQogCQlkcm1fbWFzdGVyX3B1dCgmdXNlcl9zcmYtPm1h
c3Rlcik7CiAJa2ZyZWUoc3JmLT5vZmZzZXRzKTsKQEAgLTExNjgsMTAgKzExOTUsMTYgQEAgc3Rh
dGljIGludCB2bXdfZ2Jfc3VyZmFjZV9iaW5kKHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcywKIAkJ
Y21kMi0+aGVhZGVyLmlkID0gU1ZHQV8zRF9DTURfVVBEQVRFX0dCX1NVUkZBQ0U7CiAJCWNtZDIt
PmhlYWRlci5zaXplID0gc2l6ZW9mKGNtZDItPmJvZHkpOwogCQljbWQyLT5ib2R5LnNpZCA9IHJl
cy0+aWQ7Ci0JCXJlcy0+YmFja3VwX2RpcnR5ID0gZmFsc2U7CiAJfQogCXZtd19maWZvX2NvbW1p
dChkZXZfcHJpdiwgc3VibWl0X3NpemUpOwogCisJaWYgKHJlcy0+YmFja3VwLT5kaXJ0eSAmJiBy
ZXMtPmJhY2t1cF9kaXJ0eSkgeworCQkvKiBXZSd2ZSBqdXN0IG1hZGUgYSBmdWxsIHVwbG9hZC4g
Q2VhciBkaXJ0eSByZWdpb25zLiAqLworCQl2bXdfYm9fZGlydHlfY2xlYXJfcmVzKHJlcyk7CisJ
fQorCisJcmVzLT5iYWNrdXBfZGlydHkgPSBmYWxzZTsKKwogCXJldHVybiAwOwogfQogCkBAIC0x
NjM2LDcgKzE2NjksOCBAQCB2bXdfZ2Jfc3VyZmFjZV9kZWZpbmVfaW50ZXJuYWwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAkJCX0KIAkJfQogCX0gZWxzZSBpZiAocmVxLT5iYXNlLmRybV9zdXJm
YWNlX2ZsYWdzICYKLQkJICAgZHJtX3Ztd19zdXJmYWNlX2ZsYWdfY3JlYXRlX2J1ZmZlcikKKwkJ
ICAgKGRybV92bXdfc3VyZmFjZV9mbGFnX2NyZWF0ZV9idWZmZXIgfAorCQkgICAgZHJtX3Ztd19z
dXJmYWNlX2ZsYWdfY29oZXJlbnQpKQogCQlyZXQgPSB2bXdfdXNlcl9ib19hbGxvYyhkZXZfcHJp
diwgdGZpbGUsCiAJCQkJCXJlcy0+YmFja3VwX3NpemUsCiAJCQkJCXJlcS0+YmFzZS5kcm1fc3Vy
ZmFjZV9mbGFncyAmCkBAIC0xNjUwLDYgKzE2ODQsMjYgQEAgdm13X2diX3N1cmZhY2VfZGVmaW5l
X2ludGVybmFsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9
CiAKKwlpZiAocmVxLT5iYXNlLmRybV9zdXJmYWNlX2ZsYWdzICYgZHJtX3Ztd19zdXJmYWNlX2Zs
YWdfY29oZXJlbnQpIHsKKwkJc3RydWN0IHZtd19idWZmZXJfb2JqZWN0ICpiYWNrdXAgPSByZXMt
PmJhY2t1cDsKKworCQl0dG1fYm9fcmVzZXJ2ZSgmYmFja3VwLT5iYXNlLCBmYWxzZSwgZmFsc2Us
IE5VTEwpOworCQlpZiAoIXJlcy0+ZnVuYy0+ZGlydHlfYWxsb2MpCisJCQlyZXQgPSAtRUlOVkFM
OworCQlpZiAoIXJldCkKKwkJCXJldCA9IHZtd19ib19kaXJ0eV9hZGQoYmFja3VwKTsKKwkJaWYg
KCFyZXQpIHsKKwkJCXJlcy0+Y29oZXJlbnQgPSB0cnVlOworCQkJcmV0ID0gcmVzLT5mdW5jLT5k
aXJ0eV9hbGxvYyhyZXMpOworCQl9CisJCXR0bV9ib191bnJlc2VydmUoJmJhY2t1cC0+YmFzZSk7
CisJCWlmIChyZXQpIHsKKwkJCXZtd19yZXNvdXJjZV91bnJlZmVyZW5jZSgmcmVzKTsKKwkJCWdv
dG8gb3V0X3VubG9jazsKKwkJfQorCisJfQorCiAJdG1wID0gdm13X3Jlc291cmNlX3JlZmVyZW5j
ZShyZXMpOwogCXJldCA9IHR0bV9wcmltZV9vYmplY3RfaW5pdCh0ZmlsZSwgcmVzLT5iYWNrdXBf
c2l6ZSwgJnVzZXJfc3JmLT5wcmltZSwKIAkJCQkgICAgcmVxLT5iYXNlLmRybV9zdXJmYWNlX2Zs
YWdzICYKQEAgLTE3NTgsMyArMTgxMiwzMzggQEAgdm13X2diX3N1cmZhY2VfcmVmZXJlbmNlX2lu
dGVybmFsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAKIAlyZXR1cm4gcmV0OwogfQorCisvKioK
KyAqIHZtd19zdWJyZXNfZGlydHlfYWRkIC0gQWRkIGEgZGlydHkgcmVnaW9uIHRvIGEgc3VicmVz
b3VyY2UKKyAqIEBkaXJ0eTogVGhlIHN1cmZhY2VzJ3MgZGlydHkgdHJhY2tlci4KKyAqIEBsb2Nf
c3RhcnQ6IFRoZSBsb2NhdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBzdGFydCBvZiB0aGUgcmVn
aW9uLgorICogQGxvY19lbmQ6IFRoZSBsb2NhdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSBlbmQg
b2YgdGhlIHJlZ2lvbi4KKyAqCisgKiBBcyB3ZSBhcmUgYXNzdW1pbmcgdGhhdCBAbG9jX3N0YXJ0
IGFuZCBAbG9jX2VuZCByZXByZXNlbnQgYSBzZXF1ZW50aWFsCisgKiByYW5nZSBvZiBiYWNraW5n
IHN0b3JlIG1lbW9yeSwgaWYgdGhlIHJlZ2lvbiBzcGFucyBtdWx0aXBsZSBsaW5lcyB0aGVuCisg
KiByZWdhcmRsZXNzIG9mIHRoZSB4IGNvb3JkaW5hdGUsIHRoZSBmdWxsIGxpbmVzIGFyZSBkaXJ0
aWVkLgorICogQ29ycmVzcG9uZGluZ2x5IGlmIHRoZSByZWdpb24gc3BhbnMgbXVsdGlwbGUgeiBz
bGljZXMsIHRoZW4gZnVsbCByYXRoZXIKKyAqIHRoYW4gcGFydGlhbCB6IHNsaWNlcyBhcmUgZGly
dGllZC4KKyAqLworc3RhdGljIHZvaWQgdm13X3N1YnJlc19kaXJ0eV9hZGQoc3RydWN0IHZtd19z
dXJmYWNlX2RpcnR5ICpkaXJ0eSwKKwkJCQkgY29uc3Qgc3RydWN0IHN2Z2EzZHN1cmZhY2VfbG9j
ICpsb2Nfc3RhcnQsCisJCQkJIGNvbnN0IHN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyAqbG9jX2Vu
ZCkKK3sKKwljb25zdCBzdHJ1Y3Qgc3ZnYTNkc3VyZmFjZV9jYWNoZSAqY2FjaGUgPSAmZGlydHkt
PmNhY2hlOworCVNWR0EzZEJveCAqYm94ID0gJmRpcnR5LT5ib3hlc1tsb2Nfc3RhcnQtPnN1Yl9y
ZXNvdXJjZV07CisJdTMyIG1pcCA9IGxvY19zdGFydC0+c3ViX3Jlc291cmNlICUgY2FjaGUtPm51
bV9taXBfbGV2ZWxzOworCWNvbnN0IHN0cnVjdCBkcm1fdm13X3NpemUgKnNpemUgPSAmY2FjaGUt
Pm1pcFttaXBdLnNpemU7CisJdTMyIGJveF9jMiA9IGJveC0+eiArIGJveC0+ZDsKKworCWlmIChX
QVJOX09OKGxvY19zdGFydC0+c3ViX3Jlc291cmNlID49IGRpcnR5LT5udW1fc3VicmVzKSkKKwkJ
cmV0dXJuOworCisJaWYgKGJveC0+ZCA9PSAwIHx8IGJveC0+eiA+IGxvY19zdGFydC0+eikKKwkJ
Ym94LT56ID0gbG9jX3N0YXJ0LT56OworCWlmIChib3hfYzIgPCBsb2NfZW5kLT56KQorCQlib3gt
PmQgPSBsb2NfZW5kLT56IC0gYm94LT56OworCisJaWYgKGxvY19zdGFydC0+eiArIDEgPT0gbG9j
X2VuZC0+eikgeworCQlib3hfYzIgPSBib3gtPnkgKyBib3gtPmg7CisJCWlmIChib3gtPmggPT0g
MCB8fCBib3gtPnkgPiBsb2Nfc3RhcnQtPnkpCisJCQlib3gtPnkgPSBsb2Nfc3RhcnQtPnk7CisJ
CWlmIChib3hfYzIgPCBsb2NfZW5kLT55KQorCQkJYm94LT5oID0gbG9jX2VuZC0+eSAtIGJveC0+
eTsKKworCQlpZiAobG9jX3N0YXJ0LT55ICsgMSA9PSBsb2NfZW5kLT55KSB7CisJCQlib3hfYzIg
PSBib3gtPnggKyBib3gtPnc7CisJCQlpZiAoYm94LT53ID09IDAgfHwgYm94LT54ID4gbG9jX3N0
YXJ0LT54KQorCQkJCWJveC0+eCA9IGxvY19zdGFydC0+eDsKKwkJCWlmIChib3hfYzIgPCBsb2Nf
ZW5kLT54KQorCQkJCWJveC0+dyA9IGxvY19lbmQtPnggLSBib3gtPng7CisJCX0gZWxzZSB7CisJ
CQlib3gtPnggPSAwOworCQkJYm94LT53ID0gc2l6ZS0+d2lkdGg7CisJCX0KKwl9IGVsc2Ugewor
CQlib3gtPnkgPSAwOworCQlib3gtPmggPSBzaXplLT5oZWlnaHQ7CisJCWJveC0+eCA9IDA7CisJ
CWJveC0+dyA9IHNpemUtPndpZHRoOworCX0KK30KKworLyoqCisgKiB2bXdfc3VicmVzX2RpcnR5
X2Z1bGwgLSBNYXJrIGEgZnVsbCBzdWJyZXNvdXJjZSBhcyBkaXJ0eQorICogQGRpcnR5OiBUaGUg
c3VyZmFjZSdzIGRpcnR5IHRyYWNrZXIuCisgKiBAc3VicmVzOiBUaGUgc3VicmVzb3VyY2UKKyAq
Lworc3RhdGljIHZvaWQgdm13X3N1YnJlc19kaXJ0eV9mdWxsKHN0cnVjdCB2bXdfc3VyZmFjZV9k
aXJ0eSAqZGlydHksIHUzMiBzdWJyZXMpCit7CisJY29uc3Qgc3RydWN0IHN2Z2EzZHN1cmZhY2Vf
Y2FjaGUgKmNhY2hlID0gJmRpcnR5LT5jYWNoZTsKKwl1MzIgbWlwID0gc3VicmVzICUgY2FjaGUt
Pm51bV9taXBfbGV2ZWxzOworCWNvbnN0IHN0cnVjdCBkcm1fdm13X3NpemUgKnNpemUgPSAmY2Fj
aGUtPm1pcFttaXBdLnNpemU7CisJU1ZHQTNkQm94ICpib3ggPSAmZGlydHktPmJveGVzW3N1YnJl
c107CisKKwlib3gtPnggPSAwOworCWJveC0+eSA9IDA7CisJYm94LT56ID0gMDsKKwlib3gtPncg
PSBzaXplLT53aWR0aDsKKwlib3gtPmggPSBzaXplLT5oZWlnaHQ7CisJYm94LT5kID0gc2l6ZS0+
ZGVwdGg7Cit9CisKKy8qCisgKiB2bXdfc3VyZmFjZV90ZXhfZGlydHlfYWRkX3JhbmdlIC0gVGhl
IGRpcnR5X2FkZF9yYW5nZSBjYWxsYmFjayBmb3IgdGV4dHVyZQorICogc3VyZmFjZXMuCisgKi8K
K3N0YXRpYyB2b2lkIHZtd19zdXJmYWNlX3RleF9kaXJ0eV9yYW5nZV9hZGQoc3RydWN0IHZtd19y
ZXNvdXJjZSAqcmVzLAorCQkJCQkgICAgc2l6ZV90IHN0YXJ0LCBzaXplX3QgZW5kKQoreworCXN0
cnVjdCB2bXdfc3VyZmFjZV9kaXJ0eSAqZGlydHkgPQorCQkoc3RydWN0IHZtd19zdXJmYWNlX2Rp
cnR5ICopIHJlcy0+ZGlydHk7CisJc2l6ZV90IGJhY2t1cF9lbmQgPSByZXMtPmJhY2t1cF9vZmZz
ZXQgKyByZXMtPmJhY2t1cF9zaXplOworCXN0cnVjdCBzdmdhM2RzdXJmYWNlX2xvYyBsb2MxLCBs
b2MyOworCWNvbnN0IHN0cnVjdCBzdmdhM2RzdXJmYWNlX2NhY2hlICpjYWNoZTsKKworCXN0YXJ0
ID0gbWF4X3Qoc2l6ZV90LCBzdGFydCwgcmVzLT5iYWNrdXBfb2Zmc2V0KSAtIHJlcy0+YmFja3Vw
X29mZnNldDsKKwllbmQgPSBtaW4oZW5kLCBiYWNrdXBfZW5kKSAtIHJlcy0+YmFja3VwX29mZnNl
dDsKKwljYWNoZSA9ICZkaXJ0eS0+Y2FjaGU7CisJc3ZnYTNkc3VyZmFjZV9nZXRfbG9jKGNhY2hl
LCAmbG9jMSwgc3RhcnQpOworCXN2Z2EzZHN1cmZhY2VfZ2V0X2xvYyhjYWNoZSwgJmxvYzIsIGVu
ZCAtIDEpOworCXN2Z2EzZHN1cmZhY2VfaW5jX2xvYyhjYWNoZSwgJmxvYzIpOworCisJaWYgKGxv
YzEuc3ViX3Jlc291cmNlICsgMSA9PSBsb2MyLnN1Yl9yZXNvdXJjZSkgeworCQkvKiBEaXJ0eSBy
YW5nZSBjb3ZlcnMgYSBzaW5nbGUgc3ViLXJlc291cmNlICovCisJCXZtd19zdWJyZXNfZGlydHlf
YWRkKGRpcnR5LCAmbG9jMSwgJmxvYzIpOworCX0gZWxzZSB7CisJCS8qIERpcnR5IHJhbmdlIGNv
dmVycyBtdWx0aXBsZSBzdWItcmVzb3VyY2VzICovCisJCXN0cnVjdCBzdmdhM2RzdXJmYWNlX2xv
YyBsb2NfbWluLCBsb2NfbWF4OworCQl1MzIgc3ViX3JlczsKKworCQlzdmdhM2RzdXJmYWNlX21h
eF9sb2MoY2FjaGUsIGxvYzEuc3ViX3Jlc291cmNlLCAmbG9jX21heCk7CisJCXZtd19zdWJyZXNf
ZGlydHlfYWRkKGRpcnR5LCAmbG9jMSwgJmxvY19tYXgpOworCQlzdmdhM2RzdXJmYWNlX21pbl9s
b2MoY2FjaGUsIGxvYzIuc3ViX3Jlc291cmNlIC0gMSwgJmxvY19taW4pOworCQl2bXdfc3VicmVz
X2RpcnR5X2FkZChkaXJ0eSwgJmxvY19taW4sICZsb2MyKTsKKwkJZm9yIChzdWJfcmVzID0gbG9j
MS5zdWJfcmVzb3VyY2UgKyAxOworCQkgICAgIHN1Yl9yZXMgPCBsb2MyLnN1Yl9yZXNvdXJjZSAt
IDE7ICsrc3ViX3JlcykKKwkJCXZtd19zdWJyZXNfZGlydHlfZnVsbChkaXJ0eSwgc3ViX3Jlcyk7
CisJfQorfQorCisvKgorICogdm13X3N1cmZhY2VfdGV4X2RpcnR5X2FkZF9yYW5nZSAtIFRoZSBk
aXJ0eV9hZGRfcmFuZ2UgY2FsbGJhY2sgZm9yIGJ1ZmZlcgorICogc3VyZmFjZXMuCisgKi8KK3N0
YXRpYyB2b2lkIHZtd19zdXJmYWNlX2J1Zl9kaXJ0eV9yYW5nZV9hZGQoc3RydWN0IHZtd19yZXNv
dXJjZSAqcmVzLAorCQkJCQkgICAgc2l6ZV90IHN0YXJ0LCBzaXplX3QgZW5kKQoreworCXN0cnVj
dCB2bXdfc3VyZmFjZV9kaXJ0eSAqZGlydHkgPQorCQkoc3RydWN0IHZtd19zdXJmYWNlX2RpcnR5
ICopIHJlcy0+ZGlydHk7CisJY29uc3Qgc3RydWN0IHN2Z2EzZHN1cmZhY2VfY2FjaGUgKmNhY2hl
ID0gJmRpcnR5LT5jYWNoZTsKKwlzaXplX3QgYmFja3VwX2VuZCA9IHJlcy0+YmFja3VwX29mZnNl
dCArIGNhY2hlLT5taXBfY2hhaW5fYnl0ZXM7CisJU1ZHQTNkQm94ICpib3ggPSAmZGlydHktPmJv
eGVzWzBdOworCXUzMiBib3hfYzI7CisKKwlib3gtPmggPSBib3gtPmQgPSAxOworCXN0YXJ0ID0g
bWF4X3Qoc2l6ZV90LCBzdGFydCwgcmVzLT5iYWNrdXBfb2Zmc2V0KSAtIHJlcy0+YmFja3VwX29m
ZnNldDsKKwllbmQgPSBtaW4oZW5kLCBiYWNrdXBfZW5kKSAtIHJlcy0+YmFja3VwX29mZnNldDsK
Kwlib3hfYzIgPSBib3gtPnggKyBib3gtPnc7CisJaWYgKGJveC0+dyA9PSAwIHx8IGJveC0+eCA+
IHN0YXJ0KQorCQlib3gtPnggPSBzdGFydDsKKwlpZiAoYm94X2MyIDwgZW5kKQorCQlib3gtPncg
PSBlbmQgLSBib3gtPng7Cit9CisKKy8qCisgKiB2bXdfc3VyZmFjZV90ZXhfZGlydHlfYWRkX3Jh
bmdlIC0gVGhlIGRpcnR5X2FkZF9yYW5nZSBjYWxsYmFjayBmb3Igc3VyZmFjZXMKKyAqLworc3Rh
dGljIHZvaWQgdm13X3N1cmZhY2VfZGlydHlfcmFuZ2VfYWRkKHN0cnVjdCB2bXdfcmVzb3VyY2Ug
KnJlcywgc2l6ZV90IHN0YXJ0LAorCQkJCQlzaXplX3QgZW5kKQoreworCXN0cnVjdCB2bXdfc3Vy
ZmFjZSAqc3JmID0gdm13X3Jlc190b19zcmYocmVzKTsKKworCWlmIChXQVJOX09OKGVuZCA8PSBy
ZXMtPmJhY2t1cF9vZmZzZXQgfHwKKwkJICAgIHN0YXJ0ID49IHJlcy0+YmFja3VwX29mZnNldCAr
IHJlcy0+YmFja3VwX3NpemUpKQorCQlyZXR1cm47CisKKwlpZiAoc3JmLT5mb3JtYXQgPT0gU1ZH
QTNEX0JVRkZFUikKKwkJdm13X3N1cmZhY2VfYnVmX2RpcnR5X3JhbmdlX2FkZChyZXMsIHN0YXJ0
LCBlbmQpOworCWVsc2UKKwkJdm13X3N1cmZhY2VfdGV4X2RpcnR5X3JhbmdlX2FkZChyZXMsIHN0
YXJ0LCBlbmQpOworfQorCisvKgorICogdm13X3N1cmZhY2VfZGlydHlfc3luYyAtIFRoZSBzdXJm
YWNlJ3MgZGlydHlfc3luYyBjYWxsYmFjay4KKyAqLworc3RhdGljIGludCB2bXdfc3VyZmFjZV9k
aXJ0eV9zeW5jKHN0cnVjdCB2bXdfcmVzb3VyY2UgKnJlcykKK3sKKwlzdHJ1Y3Qgdm13X3ByaXZh
dGUgKmRldl9wcml2ID0gcmVzLT5kZXZfcHJpdjsKKwlib29sIGhhc19keCA9IDA7CisJdTMyIGks
IG51bV9kaXJ0eTsKKwlzdHJ1Y3Qgdm13X3N1cmZhY2VfZGlydHkgKmRpcnR5ID0KKwkJKHN0cnVj
dCB2bXdfc3VyZmFjZV9kaXJ0eSAqKSByZXMtPmRpcnR5OworCXNpemVfdCBhbGxvY19zaXplOwor
CWNvbnN0IHN0cnVjdCBzdmdhM2RzdXJmYWNlX2NhY2hlICpjYWNoZSA9ICZkaXJ0eS0+Y2FjaGU7
CisJc3RydWN0IHsKKwkJU1ZHQTNkQ21kSGVhZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21kRFhVcGRh
dGVTdWJSZXNvdXJjZSBib2R5OworCX0gKmNtZDE7CisJc3RydWN0IHsKKwkJU1ZHQTNkQ21kSGVh
ZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21kVXBkYXRlR0JJbWFnZSBib2R5OworCX0gKmNtZDI7CisJ
dm9pZCAqY21kOworCisJbnVtX2RpcnR5ID0gMDsKKwlmb3IgKGkgPSAwOyBpIDwgZGlydHktPm51
bV9zdWJyZXM7ICsraSkgeworCQljb25zdCBTVkdBM2RCb3ggKmJveCA9ICZkaXJ0eS0+Ym94ZXNb
aV07CisKKwkJaWYgKGJveC0+ZCkKKwkJCW51bV9kaXJ0eSsrOworCX0KKworCWlmICghbnVtX2Rp
cnR5KQorCQlnb3RvIG91dDsKKworCWFsbG9jX3NpemUgPSBudW1fZGlydHkgKiAoKGhhc19keCkg
PyBzaXplb2YoKmNtZDEpIDogc2l6ZW9mKCpjbWQyKSk7CisJY21kID0gVk1XX0ZJRk9fUkVTRVJW
RShkZXZfcHJpdiwgYWxsb2Nfc2l6ZSk7CisJaWYgKCFjbWQpCisJCXJldHVybiAtRU5PTUVNOwor
CisJY21kMSA9IGNtZDsKKwljbWQyID0gY21kOworCisJZm9yIChpID0gMDsgaSA8IGRpcnR5LT5u
dW1fc3VicmVzOyArK2kpIHsKKwkJY29uc3QgU1ZHQTNkQm94ICpib3ggPSAmZGlydHktPmJveGVz
W2ldOworCisJCWlmICghYm94LT5kKQorCQkJY29udGludWU7CisKKwkJLyoKKwkJICogRFhfVVBE
QVRFX1NVQlJFU09VUkNFIGlzIGF3YXJlIG9mIGFycmF5IHN1cmZhY2VzLgorCQkgKiBVUERBVEVf
R0JfSU1BR0UgaXMgbm90LgorCQkgKi8KKwkJaWYgKGhhc19keCkgeworCQkJY21kMS0+aGVhZGVy
LmlkID0gU1ZHQV8zRF9DTURfRFhfVVBEQVRFX1NVQlJFU09VUkNFOworCQkJY21kMS0+aGVhZGVy
LnNpemUgPSBzaXplb2YoY21kMS0+Ym9keSk7CisJCQljbWQxLT5ib2R5LnNpZCA9IHJlcy0+aWQ7
CisJCQljbWQxLT5ib2R5LnN1YlJlc291cmNlID0gaTsKKwkJCWNtZDEtPmJvZHkuYm94ID0gKmJv
eDsKKwkJCWNtZDErKzsKKwkJfSBlbHNlIHsKKwkJCWNtZDItPmhlYWRlci5pZCA9IFNWR0FfM0Rf
Q01EX1VQREFURV9HQl9JTUFHRTsKKwkJCWNtZDItPmhlYWRlci5zaXplID0gc2l6ZW9mKGNtZDIt
PmJvZHkpOworCQkJY21kMi0+Ym9keS5pbWFnZS5zaWQgPSByZXMtPmlkOworCQkJY21kMi0+Ym9k
eS5pbWFnZS5mYWNlID0gaSAvIGNhY2hlLT5udW1fbWlwX2xldmVsczsKKwkJCWNtZDItPmJvZHku
aW1hZ2UubWlwbWFwID0gaSAtCisJCQkJKGNhY2hlLT5udW1fbWlwX2xldmVscyAqIGNtZDItPmJv
ZHkuaW1hZ2UuZmFjZSk7CisJCQljbWQyLT5ib2R5LmJveCA9ICpib3g7CisJCQljbWQyKys7CisJ
CX0KKworCX0KKwl2bXdfZmlmb19jb21taXQoZGV2X3ByaXYsIGFsbG9jX3NpemUpOworIG91dDoK
KwltZW1zZXQoJmRpcnR5LT5ib3hlc1swXSwgMCwgc2l6ZW9mKGRpcnR5LT5ib3hlc1swXSkgKgor
CSAgICAgICBkaXJ0eS0+bnVtX3N1YnJlcyk7CisKKwlyZXR1cm4gMDsKK30KKworLyoKKyAqIHZt
d19zdXJmYWNlX2RpcnR5X2FsbG9jIC0gVGhlIHN1cmZhY2UncyBkaXJ0eV9hbGxvYyBjYWxsYmFj
ay4KKyAqLworc3RhdGljIGludCB2bXdfc3VyZmFjZV9kaXJ0eV9hbGxvYyhzdHJ1Y3Qgdm13X3Jl
c291cmNlICpyZXMpCit7CisJc3RydWN0IHZtd19zdXJmYWNlICpzcmYgPSB2bXdfcmVzX3RvX3Ny
ZihyZXMpOworCXN0cnVjdCB2bXdfc3VyZmFjZV9kaXJ0eSAqZGlydHk7CisJdTMyIG51bV9sYXll
cnMgPSAxOworCXUzMiBudW1fbWlwOworCXUzMiBudW1fc3VicmVzOworCXUzMiBudW1fc2FtcGxl
czsKKwlzaXplX3QgZGlydHlfc2l6ZSwgYWNjX3NpemU7CisJc3RhdGljIHN0cnVjdCB0dG1fb3Bl
cmF0aW9uX2N0eCBjdHggPSB7CisJCS5pbnRlcnJ1cHRpYmxlID0gZmFsc2UsCisJCS5ub193YWl0
X2dwdSA9IGZhbHNlCisJfTsKKwlpbnQgcmV0OworCisJaWYgKHNyZi0+YXJyYXlfc2l6ZSkKKwkJ
bnVtX2xheWVycyA9IHNyZi0+YXJyYXlfc2l6ZTsKKwllbHNlIGlmIChzcmYtPmZsYWdzICYgU1ZH
QTNEX1NVUkZBQ0VfQ1VCRU1BUCkKKwkJbnVtX2xheWVycyAqPSBTVkdBM0RfTUFYX1NVUkZBQ0Vf
RkFDRVM7CisKKwludW1fbWlwID0gc3JmLT5taXBfbGV2ZWxzWzBdOworCWlmICghbnVtX21pcCkK
KwkJbnVtX21pcCA9IDE7CisKKwludW1fc3VicmVzID0gbnVtX2xheWVycyAqIG51bV9taXA7CisJ
ZGlydHlfc2l6ZSA9IHNpemVvZigqZGlydHkpICsgbnVtX3N1YnJlcyAqIHNpemVvZihkaXJ0eS0+
Ym94ZXNbMF0pOworCWFjY19zaXplID0gdHRtX3JvdW5kX3BvdChkaXJ0eV9zaXplKTsKKwlyZXQg
PSB0dG1fbWVtX2dsb2JhbF9hbGxvYyh2bXdfbWVtX2dsb2IocmVzLT5kZXZfcHJpdiksCisJCQkJ
ICAgYWNjX3NpemUsICZjdHgpOworCWlmIChyZXQpIHsKKwkJVk1XX0RFQlVHX1VTRVIoIk91dCBv
ZiBncmFwaGljcyBtZW1vcnkgZm9yIHN1cmZhY2UgIgorCQkJICAgICAgICJkaXJ0eSB0cmFja2Vy
LlxuIik7CisJCXJldHVybiByZXQ7CisJfQorCisJZGlydHkgPSBrdnphbGxvYyhkaXJ0eV9zaXpl
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRpcnR5KSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8g
b3V0X25vX2RpcnR5OworCX0KKworCW51bV9zYW1wbGVzID0gbWF4X3QodTMyLCAxLCBzcmYtPm11
bHRpc2FtcGxlX2NvdW50KTsKKwlyZXQgPSBzdmdhM2RzdXJmYWNlX3NldHVwX2NhY2hlKCZzcmYt
PmJhc2Vfc2l6ZSwgc3JmLT5mb3JtYXQsIG51bV9taXAsCisJCQkJCW51bV9sYXllcnMsIG51bV9z
YW1wbGVzLCAmZGlydHktPmNhY2hlKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dF9ub19jYWNoZTsK
KworCWRpcnR5LT5udW1fc3VicmVzID0gbnVtX3N1YnJlczsKKwlkaXJ0eS0+c2l6ZSA9IGFjY19z
aXplOworCXJlcy0+ZGlydHkgPSAoc3RydWN0IHZtd19yZXNvdXJjZV9kaXJ0eSAqKSBkaXJ0eTsK
KworCXJldHVybiAwOworCitvdXRfbm9fY2FjaGU6CisJa3ZmcmVlKGRpcnR5KTsKK291dF9ub19k
aXJ0eToKKwl0dG1fbWVtX2dsb2JhbF9mcmVlKHZtd19tZW1fZ2xvYihyZXMtPmRldl9wcml2KSwg
YWNjX3NpemUpOworCXJldHVybiByZXQ7Cit9CisKKy8qCisgKiB2bXdfc3VyZmFjZV9kaXJ0eV9m
cmVlIC0gVGhlIHN1cmZhY2UncyBkaXJ0eV9mcmVlIGNhbGxiYWNrCisgKi8KK3N0YXRpYyB2b2lk
IHZtd19zdXJmYWNlX2RpcnR5X2ZyZWUoc3RydWN0IHZtd19yZXNvdXJjZSAqcmVzKQoreworCXN0
cnVjdCB2bXdfc3VyZmFjZV9kaXJ0eSAqZGlydHkgPQorCQkoc3RydWN0IHZtd19zdXJmYWNlX2Rp
cnR5ICopIHJlcy0+ZGlydHk7CisJc2l6ZV90IGFjY19zaXplID0gZGlydHktPnNpemU7CisKKwlr
dmZyZWUoZGlydHkpOworCXR0bV9tZW1fZ2xvYmFsX2ZyZWUodm13X21lbV9nbG9iKHJlcy0+ZGV2
X3ByaXYpLCBhY2Nfc2l6ZSk7CisJcmVzLT5kaXJ0eSA9IE5VTEw7Cit9CisKKy8qCisgKiB2bXdf
c3VyZmFjZV9jbGVhbiAtIFRoZSBzdXJmYWNlJ3MgY2xlYW4gY2FsbGJhY2sKKyAqLworc3RhdGlj
IGludCB2bXdfc3VyZmFjZV9jbGVhbihzdHJ1Y3Qgdm13X3Jlc291cmNlICpyZXMpCit7CisJc3Ry
dWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiA9IHJlcy0+ZGV2X3ByaXY7CisJc2l6ZV90IGFsbG9j
X3NpemU7CisJc3RydWN0IHsKKwkJU1ZHQTNkQ21kSGVhZGVyIGhlYWRlcjsKKwkJU1ZHQTNkQ21k
UmVhZGJhY2tHQlN1cmZhY2UgYm9keTsKKwl9ICpjbWQ7CisKKwlhbGxvY19zaXplID0gc2l6ZW9m
KCpjbWQpOworCWNtZCA9IFZNV19GSUZPX1JFU0VSVkUoZGV2X3ByaXYsIGFsbG9jX3NpemUpOwor
CWlmICghY21kKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWNtZC0+aGVhZGVyLmlkID0gU1ZHQV8z
RF9DTURfUkVBREJBQ0tfR0JfU1VSRkFDRTsKKwljbWQtPmhlYWRlci5zaXplID0gc2l6ZW9mKGNt
ZC0+Ym9keSk7CisJY21kLT5ib2R5LnNpZCA9IHJlcy0+aWQ7CisJdm13X2ZpZm9fY29tbWl0KGRl
dl9wcml2LCBhbGxvY19zaXplKTsKKworCXJldHVybiAwOworfQpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS91YXBpL2RybS92bXdnZnhfZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL3Ztd2dmeF9kcm0uaApp
bmRleCAzOTlmNTgzMTdjZmYuLjAyY2FiMzNmMmYyNSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBp
L2RybS92bXdnZnhfZHJtLmgKKysrIGIvaW5jbHVkZS91YXBpL2RybS92bXdnZnhfZHJtLmgKQEAg
LTg5MSwxMSArODkxLDEzIEBAIHN0cnVjdCBkcm1fdm13X3NoYWRlcl9hcmcgewogICogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1cmZhY2UuCiAgKiBAZHJtX3Ztd19zdXJm
YWNlX2ZsYWdfY3JlYXRlX2J1ZmZlcjogQ3JlYXRlIGEgYmFja3VwIGJ1ZmZlciBpZiBub25lIGlz
CiAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2l2ZW4uCisgKiBAZHJt
X3Ztd19zdXJmYWNlX2ZsYWdfY29oZXJlbnQ6ICAgICAgQmFjayBzdXJmYWNlIHdpdGggY29oZXJl
bnQgbWVtb3J5LgogICovCiBlbnVtIGRybV92bXdfc3VyZmFjZV9mbGFncyB7CiAJZHJtX3Ztd19z
dXJmYWNlX2ZsYWdfc2hhcmVhYmxlID0gKDEgPDwgMCksCiAJZHJtX3Ztd19zdXJmYWNlX2ZsYWdf
c2Nhbm91dCA9ICgxIDw8IDEpLAotCWRybV92bXdfc3VyZmFjZV9mbGFnX2NyZWF0ZV9idWZmZXIg
PSAoMSA8PCAyKQorCWRybV92bXdfc3VyZmFjZV9mbGFnX2NyZWF0ZV9idWZmZXIgPSAoMSA8PCAy
KSwKKwlkcm1fdm13X3N1cmZhY2VfZmxhZ19jb2hlcmVudCA9ICgxIDw8IDMpLAogfTsKIAogLyoq
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZl
bA==
