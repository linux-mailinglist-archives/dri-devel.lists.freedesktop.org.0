Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 695C5287193
	for <lists+dri-devel@lfdr.de>; Thu,  8 Oct 2020 11:32:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9B5146EA53;
	Thu,  8 Oct 2020 09:32:00 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x644.google.com (mail-ej1-x644.google.com
 [IPv6:2a00:1450:4864:20::644])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 10D406EA52
 for <dri-devel@lists.freedesktop.org>; Thu,  8 Oct 2020 09:31:59 +0000 (UTC)
Received: by mail-ej1-x644.google.com with SMTP id e22so7134658ejr.4
 for <dri-devel@lists.freedesktop.org>; Thu, 08 Oct 2020 02:31:58 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=iDVa7pzeMu302YzwBbugSDXZFnWl/pHzbhEUCf1PXAU=;
 b=kTce8NIEKFY5stQVCOnu0WUEX5HbJ26lzP18cjQ8KXTQgYGldRvMXgYMaldZegQTrm
 gGeL+LU4XhmcB8Wi4BZ2KfvkGoMK7ZBhRSShwKACUeihjGghMsimZkAnyVxuSkIhmZh5
 bwiJgR11TwpBFo0S/DG/UwnvcH5zsgbC4Klt998d6zrIaXYUM/0W+c081WY0rXCcmHoE
 UoPKaxGBgB390IX+/6LzjG+oaGdRmByZ6TTvh7NH3SG4oh3a6UuD35vI9Q97s+UtN9Kx
 RZ1LTbVHihVQPpaquiMeW/RuQhtvQzG1erRtuwd2+inHnmuGo+2kvSsuLxwrlkv+ZoAT
 70Aw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=iDVa7pzeMu302YzwBbugSDXZFnWl/pHzbhEUCf1PXAU=;
 b=Yh885tYF9HXWHzQmWtIWB/Wep7iu+RKh6p4o3mqo+ZKCDavnjKPoOEyATOrc6S/PuC
 +aR6ZVgMu45QpbMTNyv0BIiU6aYMGEacAKbUzTJa+BT2Mu3EcgPKRNlqgsH+lX6vMnzX
 L7dM75pkCMVAJPPu3RLV7OkIwDO7bovHPJamiwFyNmb9UTWw8o/GzGAVBxUWbx/W2hvM
 z9N5Ls//ffr7zHqaMrfkTg1h5XjbEel6C+Ock7gmOnTSQB6wSxNjDO6sS7Q+NzExBI+u
 ZvRfWHc4L7okCwardtJF9c7NFTMCCKA34IWBJI4HL9dkbGwQrmB9ofNWgi2RyBt927RW
 QbBg==
X-Gm-Message-State: AOAM530/DK/yTreRbhQ43nV+tOq73q3amS+YFC+8fwEnBK9CbD1sQB4Y
 dnN55txjFZuGW8R5qkwkmfwrKImdZ0I=
X-Google-Smtp-Source: ABdhPJy1VYYzu761Fvy5+DWJ9KtDs7oe9fgkTWZWkJj/LUXcut4ALpzJ102msjwwGgVP1maWT6Tv0g==
X-Received: by 2002:a17:906:f118:: with SMTP id
 gv24mr7752835ejb.174.1602149517320; 
 Thu, 08 Oct 2020 02:31:57 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:4c64:a9a0:5e0:905a])
 by smtp.gmail.com with ESMTPSA id e2sm3649911ejd.81.2020.10.08.02.31.56
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 08 Oct 2020 02:31:56 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org,
	daniel@ffwll.ch
Subject: [PATCH 3/4] drm/ttm: use caching instead of placement for ttm_io_prot
Date: Thu,  8 Oct 2020 11:31:53 +0200
Message-Id: <20201008093154.2991-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20201008093154.2991-1-christian.koenig@amd.com>
References: <20201008093154.2991-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiB0aGUgcGxhY2VtZW50IGZsYWdzIHVzZSB0aGUgY2FjaGluZyBvZiB0aGUgYnVz
Cm1hcHBpbmcgb3IgdHQgb2JqZWN0IGZvciB0aGUgcGFnZSBwcm90ZWN0aW9uIGZsYWdzLgoKU2ln
bmVkLW9mZi1ieTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgpS
ZXZpZXdlZC1ieTogTWljaGFlbCBKLiBSdWhsIDxtaWNoYWVsLmoucnVobEBpbnRlbC5jb20+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jICAgIHwgMjMgKysrKysrKysrKysr
KystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMgICAgICB8ICAyICst
CiBkcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9ibGl0LmMgfCAgNCArKy0tCiBpbmNsdWRl
L2RybS90dG0vdHRtX2JvX2RyaXZlci5oICAgICAgfCAgNiArKysrLS0KIDQgZmlsZXMgY2hhbmdl
ZCwgMjEgaW5zZXJ0aW9ucygrKSwgMTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9f
dXRpbC5jCmluZGV4IGJkZWU0ZGYxZjNmMi4uMDU0MjA5N2RjNDE5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fYm9fdXRpbC5jCkBAIC0yNzksMTMgKzI3OSwxMSBAQCBpbnQgdHRtX2JvX21vdmVfbWVtY3B5
KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAJZm9yIChpID0gMDsgaSA8IG5ld19tZW0t
Pm51bV9wYWdlczsgKytpKSB7CiAJCXBhZ2UgPSBpICogZGlyICsgYWRkOwogCQlpZiAob2xkX2lv
bWFwID09IE5VTEwpIHsKLQkJCXBncHJvdF90IHByb3QgPSB0dG1faW9fcHJvdChvbGRfbWVtLT5w
bGFjZW1lbnQsCi0JCQkJCQkgICAgUEFHRV9LRVJORUwpOworCQkJcGdwcm90X3QgcHJvdCA9IHR0
bV9pb19wcm90KGJvLCBvbGRfbWVtLCBQQUdFX0tFUk5FTCk7CiAJCQlyZXQgPSB0dG1fY29weV90
dG1faW9fcGFnZSh0dG0sIG5ld19pb21hcCwgcGFnZSwKIAkJCQkJCSAgIHByb3QpOwogCQl9IGVs
c2UgaWYgKG5ld19pb21hcCA9PSBOVUxMKSB7Ci0JCQlwZ3Byb3RfdCBwcm90ID0gdHRtX2lvX3By
b3QobmV3X21lbS0+cGxhY2VtZW50LAotCQkJCQkJICAgIFBBR0VfS0VSTkVMKTsKKwkJCXBncHJv
dF90IHByb3QgPSB0dG1faW9fcHJvdChibywgbmV3X21lbSwgUEFHRV9LRVJORUwpOwogCQkJcmV0
ID0gdHRtX2NvcHlfaW9fdHRtX3BhZ2UodHRtLCBvbGRfaW9tYXAsIHBhZ2UsCiAJCQkJCQkgICBw
cm90KTsKIAkJfSBlbHNlIHsKQEAgLTM4NCwyMSArMzgyLDI4IEBAIHN0YXRpYyBpbnQgdHRtX2J1
ZmZlcl9vYmplY3RfdHJhbnNmZXIoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAlyZXR1
cm4gMDsKIH0KIAotcGdwcm90X3QgdHRtX2lvX3Byb3QodWludDMyX3QgY2FjaGluZ19mbGFncywg
cGdwcm90X3QgdG1wKQorcGdwcm90X3QgdHRtX2lvX3Byb3Qoc3RydWN0IHR0bV9idWZmZXJfb2Jq
ZWN0ICpibywgc3RydWN0IHR0bV9yZXNvdXJjZSAqcmVzLAorCQkgICAgIHBncHJvdF90IHRtcCkK
IHsKKwlzdHJ1Y3QgdHRtX3Jlc291cmNlX21hbmFnZXIgKm1hbjsKKwllbnVtIHR0bV9jYWNoaW5n
IGNhY2hpbmc7CisKKwltYW4gPSB0dG1fbWFuYWdlcl90eXBlKGJvLT5iZGV2LCByZXMtPm1lbV90
eXBlKTsKKwljYWNoaW5nID0gbWFuLT51c2VfdHQgPyBiby0+dHRtLT5jYWNoaW5nIDogcmVzLT5i
dXMuY2FjaGluZzsKKwogCS8qIENhY2hlZCBtYXBwaW5ncyBuZWVkIG5vIGFkanVzdG1lbnQgKi8K
LQlpZiAoY2FjaGluZ19mbGFncyAmIFRUTV9QTF9GTEFHX0NBQ0hFRCkKKwlpZiAoY2FjaGluZyA9
PSB0dG1fY2FjaGVkKQogCQlyZXR1cm4gdG1wOwogCiAjaWYgZGVmaW5lZChfX2kzODZfXykgfHwg
ZGVmaW5lZChfX3g4Nl82NF9fKQotCWlmIChjYWNoaW5nX2ZsYWdzICYgVFRNX1BMX0ZMQUdfV0Mp
CisJaWYgKGNhY2hpbmcgPT0gdHRtX3dyaXRlX2NvbWJpbmVkKQogCQl0bXAgPSBwZ3Byb3Rfd3Jp
dGVjb21iaW5lKHRtcCk7CiAJZWxzZSBpZiAoYm9vdF9jcHVfZGF0YS54ODYgPiAzKQogCQl0bXAg
PSBwZ3Byb3Rfbm9uY2FjaGVkKHRtcCk7CiAjZW5kaWYKICNpZiBkZWZpbmVkKF9faWE2NF9fKSB8
fCBkZWZpbmVkKF9fYXJtX18pIHx8IGRlZmluZWQoX19hYXJjaDY0X18pIHx8IFwKICAgICBkZWZp
bmVkKF9fcG93ZXJwY19fKSB8fCBkZWZpbmVkKF9fbWlwc19fKQotCWlmIChjYWNoaW5nX2ZsYWdz
ICYgVFRNX1BMX0ZMQUdfV0MpCisJaWYgKGNhY2hpbmcgPT0gdHRtX3dyaXRlX2NvbWJpbmVkKQog
CQl0bXAgPSBwZ3Byb3Rfd3JpdGVjb21iaW5lKHRtcCk7CiAJZWxzZQogCQl0bXAgPSBwZ3Byb3Rf
bm9uY2FjaGVkKHRtcCk7CkBAIC00NjYsNyArNDcxLDcgQEAgc3RhdGljIGludCB0dG1fYm9fa21h
cF90dG0oc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibywKIAkJICogV2UgbmVlZCB0byB1c2Ug
dm1hcCB0byBnZXQgdGhlIGRlc2lyZWQgcGFnZSBwcm90ZWN0aW9uCiAJCSAqIG9yIHRvIG1ha2Ug
dGhlIGJ1ZmZlciBvYmplY3QgbG9vayBjb250aWd1b3VzLgogCQkgKi8KLQkJcHJvdCA9IHR0bV9p
b19wcm90KG1lbS0+cGxhY2VtZW50LCBQQUdFX0tFUk5FTCk7CisJCXByb3QgPSB0dG1faW9fcHJv
dChibywgbWVtLCBQQUdFX0tFUk5FTCk7CiAJCW1hcC0+Ym9fa21hcF90eXBlID0gdHRtX2JvX21h
cF92bWFwOwogCQltYXAtPnZpcnR1YWwgPSB2bWFwKHR0bS0+cGFnZXMgKyBzdGFydF9wYWdlLCBu
dW1fcGFnZXMsCiAJCQkJICAgIDAsIHByb3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fYm9fdm0uYyBiL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvX3ZtLmMKaW5kZXgg
ODdlZThmMGNhMDhlLi5lZWFjYTVkMWVmZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90
dG0vdHRtX2JvX3ZtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdm0uYwpAQCAt
MzEwLDcgKzMxMCw3IEBAIHZtX2ZhdWx0X3QgdHRtX2JvX3ZtX2ZhdWx0X3Jlc2VydmVkKHN0cnVj
dCB2bV9mYXVsdCAqdm1mLAogCWlmICh1bmxpa2VseShwYWdlX29mZnNldCA+PSBiby0+bnVtX3Bh
Z2VzKSkKIAkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKIAotCXByb3QgPSB0dG1faW9fcHJvdChi
by0+bWVtLnBsYWNlbWVudCwgcHJvdCk7CisJcHJvdCA9IHR0bV9pb19wcm90KGJvLCAmYm8tPm1l
bSwgcHJvdCk7CiAJaWYgKCFiby0+bWVtLmJ1cy5pc19pb21lbSkgewogCQlzdHJ1Y3QgdHRtX29w
ZXJhdGlvbl9jdHggY3R4ID0gewogCQkJLmludGVycnVwdGlibGUgPSBmYWxzZSwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JsaXQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS92bXdnZngvdm13Z2Z4X2JsaXQuYwppbmRleCBlYTJmMmY5MzdlYjMuLmYyMTg4MWUwODdkYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYmxpdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JsaXQuYwpAQCAtNDg0LDggKzQ4NCw4IEBAIGlu
dCB2bXdfYm9fY3B1X2JsaXQoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpkc3QsCiAJZC5zcmNf
cGFnZXMgPSBzcmMtPnR0bS0+cGFnZXM7CiAJZC5kc3RfbnVtX3BhZ2VzID0gZHN0LT5udW1fcGFn
ZXM7CiAJZC5zcmNfbnVtX3BhZ2VzID0gc3JjLT5udW1fcGFnZXM7Ci0JZC5kc3RfcHJvdCA9IHR0
bV9pb19wcm90KGRzdC0+bWVtLnBsYWNlbWVudCwgUEFHRV9LRVJORUwpOwotCWQuc3JjX3Byb3Qg
PSB0dG1faW9fcHJvdChzcmMtPm1lbS5wbGFjZW1lbnQsIFBBR0VfS0VSTkVMKTsKKwlkLmRzdF9w
cm90ID0gdHRtX2lvX3Byb3QoZHN0LCAmZHN0LT5tZW0sIFBBR0VfS0VSTkVMKTsKKwlkLnNyY19w
cm90ID0gdHRtX2lvX3Byb3Qoc3JjLCAmc3JjLT5tZW0sIFBBR0VfS0VSTkVMKTsKIAlkLmRpZmYg
PSBkaWZmOwogCiAJZm9yIChqID0gMDsgaiA8IGg7ICsraikgewpkaWZmIC0tZ2l0IGEvaW5jbHVk
ZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVy
LmgKaW5kZXggYjU4ZGVkY2U3MDc5Li5mMjk0MTljYjc5ODAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKKysrIGIvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2
ZXIuaApAQCAtNjU3LDEzICs2NTcsMTUgQEAgaW50IHR0bV9ib19waXBlbGluZV9ndXR0aW5nKHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pOwogLyoqCiAgKiB0dG1faW9fcHJvdAogICoKLSAq
IEBjX3N0YXRlOiBDYWNoaW5nIHN0YXRlLgorICogYm86IHR0bSBidWZmZXIgb2JqZWN0CisgKiBy
ZXM6IHR0bSByZXNvdXJjZSBvYmplY3QKICAqIEB0bXA6IFBhZ2UgcHJvdGVjdGlvbiBmbGFnIGZv
ciBhIG5vcm1hbCwgY2FjaGVkIG1hcHBpbmcuCiAgKgogICogVXRpbGl0eSBmdW5jdGlvbiB0aGF0
IHJldHVybnMgdGhlIHBncHJvdF90IHRoYXQgc2hvdWxkIGJlIHVzZWQgZm9yCiAgKiBzZXR0aW5n
IHVwIGEgUFRFIHdpdGggdGhlIGNhY2hpbmcgbW9kZWwgaW5kaWNhdGVkIGJ5IEBjX3N0YXRlLgog
ICovCi1wZ3Byb3RfdCB0dG1faW9fcHJvdCh1aW50MzJfdCBjYWNoaW5nX2ZsYWdzLCBwZ3Byb3Rf
dCB0bXApOworcGdwcm90X3QgdHRtX2lvX3Byb3Qoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpi
bywgc3RydWN0IHR0bV9yZXNvdXJjZSAqcmVzLAorCQkgICAgIHBncHJvdF90IHRtcCk7CiAKIC8q
KgogICogdHRtX2JvX3R0X2JpbmQKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vZHJpLWRldmVsCg==
