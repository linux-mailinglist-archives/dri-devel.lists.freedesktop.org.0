Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C2CE0264576
	for <lists+dri-devel@lfdr.de>; Thu, 10 Sep 2020 13:49:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 96D6C6E908;
	Thu, 10 Sep 2020 11:49:15 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x643.google.com (mail-ej1-x643.google.com
 [IPv6:2a00:1450:4864:20::643])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 476AF6E908
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Sep 2020 11:49:11 +0000 (UTC)
Received: by mail-ej1-x643.google.com with SMTP id j11so8306503ejk.0
 for <dri-devel@lists.freedesktop.org>; Thu, 10 Sep 2020 04:49:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=f+rGH0THkIVS1+pqwKe8Mvi7mlhPjegtpj4BNmavrBI=;
 b=KVBrqGIlZCqZ655MXYdbixoloj6SsB7YvJdxtJRXIWqhI5gn5PIIUYkzVIN73Kdmw8
 Mdp9b7GF+wUARStSdqplR1ErMO547VZ3qSYjcugnt/Ti7gxN/hD8EhlXmY+rmByfwto5
 alg6nPf1EiWAgwtzKsCA4z5nRW03je9tKzQZDIdnLUzAv/LA/3c9ezzSLs7hHvJthN8+
 WM0hDuSKlRBUzn6NCOSrxgnw8v3luAqsEZiWWji9BkRbA6X7Xk6o3RT5cDxRS1Q4kz92
 lPJfRz4z0t+H0DRmenq1kB+4WnOY5f3HaWDlRSy9hFAOB8p5BSs6T0LljbqqSc1aMG5T
 rkBQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=f+rGH0THkIVS1+pqwKe8Mvi7mlhPjegtpj4BNmavrBI=;
 b=L9pQ7yetL1l8JOxK7rubb7UsCZ8CstCHBiKX3nzHYfiX912tK+fQk+SI4vvP69ce59
 RIfgzU6XBZgtGl557yJPQVVeeYK4wSHfmEThDmmFduzp2Jr3inkfMcIsXPX5/gzoS/7O
 L7ektXO2qavEAHPtx3LZTk2ZpYNiBxkSt/r/uYBKQSIJU896UaOdsx3JXbhqBz/AjDQi
 QdzZfyHBMtcoWuPXguQUiYK7a70SL5InaOA8GMslS1QvHZ/z0mlDlrwDkivVDcOe7QBL
 5grAWZwXFHJF6tcgORusBOnz2bmEbgSstH1ABhJZbV1jgPx2876sbuY4LfI0JQ3p6s2k
 nMuw==
X-Gm-Message-State: AOAM532wEww1q4oqrCmWM57bLmLTXTT4e3KoDGGydIzaxg23uWpJqB93
 0M7DZaxsWOwIIz7JyOZvbQGAGXf//Vs=
X-Google-Smtp-Source: ABdhPJxHUoSiSlL7Oo8DaEVMX7teZxFMIOIHXjhTh18kbFS24KQTk+j+6Z4C/TSMQveAWRYRJfa7wQ==
X-Received: by 2002:a17:906:a845:: with SMTP id
 dx5mr8129163ejb.543.1599738549078; 
 Thu, 10 Sep 2020 04:49:09 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:70f6:b740:8639:ef8a])
 by smtp.gmail.com with ESMTPSA id q27sm6438007ejd.74.2020.09.10.04.49.08
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 10 Sep 2020 04:49:08 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org, airlied@gmail.com, bskeggs@redhat.com,
 kraxel@redhat.com
Subject: [PATCH 2/4] drm/nouveau: stop using TTM placement flags
Date: Thu, 10 Sep 2020 13:49:04 +0200
Message-Id: <20200910114906.2873-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200910114906.2873-1-christian.koenig@amd.com>
References: <20200910114906.2873-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhvc2UgYXJlIGdvaW5nIHRvIGJlIHJlbW92ZWQsIHN0b3AgdXNpbmcgdGhlbSBoZXJlLgoKSW5z
dGVhZCB1c2UgdGhlIEdFTSBmbGFncyBmcm9tIHRoZSBVQVBJLgoKU2lnbmVkLW9mZi1ieTogQ2hy
aXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9ub3V2ZWF1L2Rpc3BudjA0L2NydGMuYyAgICB8ICA5ICsrLQogZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvZGlzcG52MDQvZGlzcC5jICAgIHwgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L2Rpc3BudjA0L292ZXJsYXkuYyB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9k
aXNwbnY1MC9kaXNwLmMgICAgfCAgNSArLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52
NTAvd25kdy5jICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfYWJp
MTYuYyAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMgICAg
ICAgfCA5MSArKysrKysrKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2JvLmggICAgICAgfCAxMiArLS0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZl
YXVfY2hhbi5jICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rt
ZW0uYyAgICAgfCAgNiArLQogZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9mYmNvbi5j
ICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZ2VtLmMgICAgICB8
IDM0ICsrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3ByaW1lLmMgICAg
fCAxMSArKy0KIGRyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L252MTdfZmVuY2UuYyAgICAgICB8ICA1
ICstCiBkcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udjUwX2ZlbmNlLmMgICAgICAgfCAgNSArLQog
ZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnY4NF9mZW5jZS5jICAgICAgIHwgMTMgKystLQogMTYg
ZmlsZXMgY2hhbmdlZCwgMTE0IGluc2VydGlvbnMoKyksIDk3IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjA0L2NydGMuYyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L2Rpc3BudjA0L2NydGMuYwppbmRleCA2NDE2YjY5MDdhZWIuLmY5ZTk2
MmZkOTRkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52MDQvY3J0
Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjA0L2NydGMuYwpAQCAtNjE1
LDcgKzYxNSw3IEBAIG52X2NydGNfc3dhcF9mYnMoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRfZmIpCiAJc3RydWN0IG5vdXZlYXVfY3J0YyAqbnZfY3J0
YyA9IG5vdXZlYXVfY3J0YyhjcnRjKTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbm91dmVhdV9ib19w
aW4obnZibywgVFRNX1BMX0ZMQUdfVlJBTSwgZmFsc2UpOworCXJldCA9IG5vdXZlYXVfYm9fcGlu
KG52Ym8sIE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNLCBmYWxzZSk7CiAJaWYgKHJldCA9PSAwKSB7
CiAJCWlmIChkaXNwLT5pbWFnZVtudl9jcnRjLT5pbmRleF0pCiAJCQlub3V2ZWF1X2JvX3VucGlu
KGRpc3AtPmltYWdlW252X2NydGMtPmluZGV4XSk7CkBAIC0xMTcyLDcgKzExNzIsNyBAQCBudjA0
X2NydGNfcGFnZV9mbGlwKHN0cnVjdCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCiAJCXJldHVybiAtRU5PTUVNOwogCiAJaWYgKG5ld19ibyAhPSBvbGRfYm8pIHsK
LQkJcmV0ID0gbm91dmVhdV9ib19waW4obmV3X2JvLCBUVE1fUExfRkxBR19WUkFNLCB0cnVlKTsK
KwkJcmV0ID0gbm91dmVhdV9ib19waW4obmV3X2JvLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwg
dHJ1ZSk7CiAJCWlmIChyZXQpCiAJCQlnb3RvIGZhaWxfZnJlZTsKIAl9CkBAIC0xMzM2LDEwICsx
MzM2LDExIEBAIG52MDRfY3J0Y19jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IGNy
dGNfbnVtKQogCWRybV9tb2RlX2NydGNfc2V0X2dhbW1hX3NpemUoJm52X2NydGMtPmJhc2UsIDI1
Nik7CiAKIAlyZXQgPSBub3V2ZWF1X2JvX25ldygmbm91dmVhdV9kcm0oZGV2KS0+Y2xpZW50LCA2
NCo2NCo0LCAweDEwMCwKLQkJCSAgICAgVFRNX1BMX0ZMQUdfVlJBTSwgMCwgMHgwMDAwLCBOVUxM
LCBOVUxMLAorCQkJICAgICBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwgMCwgMHgwMDAwLCBOVUxM
LCBOVUxMLAogCQkJICAgICAmbnZfY3J0Yy0+Y3Vyc29yLm52Ym8pOwogCWlmICghcmV0KSB7Ci0J
CXJldCA9IG5vdXZlYXVfYm9fcGluKG52X2NydGMtPmN1cnNvci5udmJvLCBUVE1fUExfRkxBR19W
UkFNLCBmYWxzZSk7CisJCXJldCA9IG5vdXZlYXVfYm9fcGluKG52X2NydGMtPmN1cnNvci5udmJv
LAorCQkJCSAgICAgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0sIGZhbHNlKTsKIAkJaWYgKCFyZXQp
IHsKIAkJCXJldCA9IG5vdXZlYXVfYm9fbWFwKG52X2NydGMtPmN1cnNvci5udmJvKTsKIAkJCWlm
IChyZXQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9kaXNw
LmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9kaXNwLmMKaW5kZXggOTAwYWI2
OWRmN2U4Li40MWQ5OTBjY2E2ODUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L2Rpc3BudjA0L2Rpc3AuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9k
aXNwLmMKQEAgLTExMiw3ICsxMTIsNyBAQCBudjA0X2Rpc3BsYXlfaW5pdChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCBib29sIHJlc3VtZSwgYm9vbCBydW50aW1lKQogCQlpZiAoIWZiIHx8ICFmYi0+
b2JqWzBdKQogCQkJY29udGludWU7CiAJCW52Ym8gPSBub3V2ZWF1X2dlbV9vYmplY3QoZmItPm9i
alswXSk7Ci0JCXJldCA9IG5vdXZlYXVfYm9fcGluKG52Ym8sIFRUTV9QTF9GTEFHX1ZSQU0sIHRy
dWUpOworCQlyZXQgPSBub3V2ZWF1X2JvX3BpbihudmJvLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJB
TSwgdHJ1ZSk7CiAJCWlmIChyZXQpCiAJCQlOVl9FUlJPUihkcm0sICJDb3VsZCBub3QgcGluIGZy
YW1lYnVmZmVyXG4iKTsKIAl9CkBAIC0xMjIsNyArMTIyLDggQEAgbnYwNF9kaXNwbGF5X2luaXQo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCByZXN1bWUsIGJvb2wgcnVudGltZSkKIAkJaWYg
KCFudl9jcnRjLT5jdXJzb3IubnZibykKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IG5vdXZlYXVf
Ym9fcGluKG52X2NydGMtPmN1cnNvci5udmJvLCBUVE1fUExfRkxBR19WUkFNLCB0cnVlKTsKKwkJ
cmV0ID0gbm91dmVhdV9ib19waW4obnZfY3J0Yy0+Y3Vyc29yLm52Ym8sCisJCQkJICAgICBOT1VW
RUFVX0dFTV9ET01BSU5fVlJBTSwgdHJ1ZSk7CiAJCWlmICghcmV0ICYmIG52X2NydGMtPmN1cnNv
ci5zZXRfb2Zmc2V0KQogCQkJcmV0ID0gbm91dmVhdV9ib19tYXAobnZfY3J0Yy0+Y3Vyc29yLm52
Ym8pOwogCQlpZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlz
cG52MDQvb3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52MDQvb3Zlcmxh
eS5jCmluZGV4IDE5M2JhOTQ5OGYzZC4uMzdlNjNlOThjZDA4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9kaXNwbnYwNC9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvZGlzcG52MDQvb3ZlcmxheS5jCkBAIC0xNDIsNyArMTQyLDcgQEAgbnYxMF91cGRh
dGVfcGxhbmUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsIHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IAkJcmV0dXJuIHJldDsKIAogCW52Ym8gPSBub3V2ZWF1X2dlbV9vYmplY3QoZmItPm9ialswXSk7
Ci0JcmV0ID0gbm91dmVhdV9ib19waW4obnZibywgVFRNX1BMX0ZMQUdfVlJBTSwgZmFsc2UpOwor
CXJldCA9IG5vdXZlYXVfYm9fcGluKG52Ym8sIE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNLCBmYWxz
ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMzg3LDcgKzM4Nyw3IEBAIG52MDRf
dXBkYXRlX3BsYW5lKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLCBzdHJ1Y3QgZHJtX2NydGMgKmNy
dGMsCiAJCXJldHVybiByZXQ7CiAKIAludmJvID0gbm91dmVhdV9nZW1fb2JqZWN0KGZiLT5vYmpb
MF0pOwotCXJldCA9IG5vdXZlYXVfYm9fcGluKG52Ym8sIFRUTV9QTF9GTEFHX1ZSQU0sIGZhbHNl
KTsKKwlyZXQgPSBub3V2ZWF1X2JvX3BpbihudmJvLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwg
ZmFsc2UpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L2Rpc3BudjUwL2Rpc3AuYyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1
L2Rpc3BudjUwL2Rpc3AuYwppbmRleCBlNzg3NDg3N2RhODUuLjlkZmI1NzdmMTQ4YSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvZGlzcG52NTAvZGlzcC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjUwL2Rpc3AuYwpAQCAtMjU4MSwxMCArMjU4MSwxMSBA
QCBudjUwX2Rpc3BsYXlfY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJZGV2LT5tb2Rl
X2NvbmZpZy5ub3JtYWxpemVfenBvcyA9IHRydWU7CiAKIAkvKiBzbWFsbCBzaGFyZWQgbWVtb3J5
IGFyZWEgd2UgdXNlIGZvciBub3RpZmllcnMgYW5kIHNlbWFwaG9yZXMgKi8KLQlyZXQgPSBub3V2
ZWF1X2JvX25ldygmZHJtLT5jbGllbnQsIDQwOTYsIDB4MTAwMCwgVFRNX1BMX0ZMQUdfVlJBTSwK
KwlyZXQgPSBub3V2ZWF1X2JvX25ldygmZHJtLT5jbGllbnQsIDQwOTYsIDB4MTAwMCwKKwkJCSAg
ICAgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0sCiAJCQkgICAgIDAsIDB4MDAwMCwgTlVMTCwgTlVM
TCwgJmRpc3AtPnN5bmMpOwogCWlmICghcmV0KSB7Ci0JCXJldCA9IG5vdXZlYXVfYm9fcGluKGRp
c3AtPnN5bmMsIFRUTV9QTF9GTEFHX1ZSQU0sIHRydWUpOworCQlyZXQgPSBub3V2ZWF1X2JvX3Bp
bihkaXNwLT5zeW5jLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwgdHJ1ZSk7CiAJCWlmICghcmV0
KSB7CiAJCQlyZXQgPSBub3V2ZWF1X2JvX21hcChkaXNwLT5zeW5jKTsKIAkJCWlmIChyZXQpCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC93bmR3LmMgYi9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC93bmR3LmMKaW5kZXggNDQ3ZWNjOWZlYzQyLi4w
MzU2NDc0YWQ2ZjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L2Rpc3BudjUw
L3duZHcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9kaXNwbnY1MC93bmR3LmMKQEAg
LTU0Miw3ICs1NDIsNyBAQCBudjUwX3duZHdfcHJlcGFyZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZSwgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpCiAJCXJldHVybiAwOwogCiAJbnZi
byA9IG5vdXZlYXVfZ2VtX29iamVjdChmYi0+b2JqWzBdKTsKLQlyZXQgPSBub3V2ZWF1X2JvX3Bp
bihudmJvLCBUVE1fUExfRkxBR19WUkFNLCB0cnVlKTsKKwlyZXQgPSBub3V2ZWF1X2JvX3Bpbihu
dmJvLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwgdHJ1ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9hYmkx
Ni5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9hYmkxNi5jCmluZGV4IDIxNTM3
Y2ExZGQzOS4uOWE1YmU2ZjMyNDI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVh
dS9ub3V2ZWF1X2FiaTE2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9h
YmkxNi5jCkBAIC0zMjgsNyArMzI4LDggQEAgbm91dmVhdV9hYmkxNl9pb2N0bF9jaGFubmVsX2Fs
bG9jKEFCSTE2X0lPQ1RMX0FSR1MpCiAJcmV0ID0gbm91dmVhdV9nZW1fbmV3KGNsaSwgUEFHRV9T
SVpFLCAwLCBOT1VWRUFVX0dFTV9ET01BSU5fR0FSVCwKIAkJCSAgICAgIDAsIDAsICZjaGFuLT5u
dGZ5KTsKIAlpZiAocmV0ID09IDApCi0JCXJldCA9IG5vdXZlYXVfYm9fcGluKGNoYW4tPm50Znks
IFRUTV9QTF9GTEFHX1RULCBmYWxzZSk7CisJCXJldCA9IG5vdXZlYXVfYm9fcGluKGNoYW4tPm50
ZnksIE5PVVZFQVVfR0VNX0RPTUFJTl9HQVJULAorCQkJCSAgICAgZmFsc2UpOwogCWlmIChyZXQp
CiAJCWdvdG8gZG9uZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91
dmVhdV9iby5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IDgz
ZmRkMTY5YTI3YS4uYjY0NWIxMTMxYjRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91
dmVhdS9ub3V2ZWF1X2JvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9i
by5jCkBAIC0xNTksOCArMTU5LDcgQEAgcm91bmR1cF82NCh1NjQgeCwgdTMyIHkpCiB9CiAKIHN0
YXRpYyB2b2lkCi1ub3V2ZWF1X2JvX2ZpeHVwX2FsaWduKHN0cnVjdCBub3V2ZWF1X2JvICpudmJv
LCB1MzIgZmxhZ3MsCi0JCSAgICAgICBpbnQgKmFsaWduLCB1NjQgKnNpemUpCitub3V2ZWF1X2Jv
X2ZpeHVwX2FsaWduKHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCBpbnQgKmFsaWduLCB1NjQgKnNp
emUpCiB7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0gPSBub3V2ZWF1X2JkZXYobnZiby0+Ym8u
YmRldik7CiAJc3RydWN0IG52aWZfZGV2aWNlICpkZXZpY2UgPSAmZHJtLT5jbGllbnQuZGV2aWNl
OwpAQCAtMTkzLDcgKzE5Miw3IEBAIG5vdXZlYXVfYm9fZml4dXBfYWxpZ24oc3RydWN0IG5vdXZl
YXVfYm8gKm52Ym8sIHUzMiBmbGFncywKIH0KIAogc3RydWN0IG5vdXZlYXVfYm8gKgotbm91dmVh
dV9ib19hbGxvYyhzdHJ1Y3Qgbm91dmVhdV9jbGkgKmNsaSwgdTY0ICpzaXplLCBpbnQgKmFsaWdu
LCB1MzIgZmxhZ3MsCitub3V2ZWF1X2JvX2FsbG9jKHN0cnVjdCBub3V2ZWF1X2NsaSAqY2xpLCB1
NjQgKnNpemUsIGludCAqYWxpZ24sIHUzMiBkb21haW4sCiAJCSB1MzIgdGlsZV9tb2RlLCB1MzIg
dGlsZV9mbGFncykKIHsKIAlzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSA9IGNsaS0+ZHJtOwpAQCAt
MjE5LDcgKzIxOCw3IEBAIG5vdXZlYXVfYm9fYWxsb2Moc3RydWN0IG5vdXZlYXVfY2xpICpjbGks
IHU2NCAqc2l6ZSwgaW50ICphbGlnbiwgdTMyIGZsYWdzLAogCSAqIG1hcHBpbmcsIGJ1dCBpcyB3
aGF0IE5PVVZFQVVfR0VNX0RPTUFJTl9DT0hFUkVOVCBnZXRzIHRyYW5zbGF0ZWQKIAkgKiBpbnRv
IGluIG5vdXZlYXVfZ2VtX25ldygpLgogCSAqLwotCWlmIChmbGFncyAmIFRUTV9QTF9GTEFHX1VO
Q0FDSEVEKSB7CisJaWYgKGRvbWFpbiAmIE5PVVZFQVVfR0VNX0RPTUFJTl9DT0hFUkVOVCkgewog
CQkvKiBEZXRlcm1pbmUgaWYgd2UgY2FuIGdldCBhIGNhY2hlLWNvaGVyZW50IG1hcCwgZm9yY2lu
ZwogCQkgKiB1bmNhY2hlZCBtYXBwaW5nIGlmIHdlIGNhbid0LgogCQkgKi8KQEAgLTI1OSw5ICsy
NTgsOSBAQCBub3V2ZWF1X2JvX2FsbG9jKHN0cnVjdCBub3V2ZWF1X2NsaSAqY2xpLCB1NjQgKnNp
emUsIGludCAqYWxpZ24sIHUzMiBmbGFncywKIAkJICogU2tpcCBwYWdlIHNpemVzIHRoYXQgY2Fu
J3Qgc3VwcG9ydCBuZWVkZWQgZG9tYWlucy4KIAkJICovCiAJCWlmIChjbGktPmRldmljZS5pbmZv
LmZhbWlseSA+IE5WX0RFVklDRV9JTkZPX1YwX0NVUklFICYmCi0JCSAgICAoZmxhZ3MgJiBUVE1f
UExfRkxBR19WUkFNKSAmJiAhdm1tLT5wYWdlW2ldLnZyYW0pCisJCSAgICAoZG9tYWluICYgTk9V
VkVBVV9HRU1fRE9NQUlOX1ZSQU0pICYmICF2bW0tPnBhZ2VbaV0udnJhbSkKIAkJCWNvbnRpbnVl
OwotCQlpZiAoKGZsYWdzICYgVFRNX1BMX0ZMQUdfVFQpICYmCisJCWlmICgoZG9tYWluICYgTk9V
VkVBVV9HRU1fRE9NQUlOX0dBUlQpICYmCiAJCSAgICAoIXZtbS0+cGFnZVtpXS5ob3N0IHx8IHZt
bS0+cGFnZVtpXS5zaGlmdCA+IFBBR0VfU0hJRlQpKQogCQkJY29udGludWU7CiAKQEAgLTI4OCwx
MyArMjg3LDEzIEBAIG5vdXZlYXVfYm9fYWxsb2Moc3RydWN0IG5vdXZlYXVfY2xpICpjbGksIHU2
NCAqc2l6ZSwgaW50ICphbGlnbiwgdTMyIGZsYWdzLAogCX0KIAludmJvLT5wYWdlID0gdm1tLT5w
YWdlW3BpXS5zaGlmdDsKIAotCW5vdXZlYXVfYm9fZml4dXBfYWxpZ24obnZibywgZmxhZ3MsIGFs
aWduLCBzaXplKTsKKwlub3V2ZWF1X2JvX2ZpeHVwX2FsaWduKG52Ym8sIGFsaWduLCBzaXplKTsK
IAogCXJldHVybiBudmJvOwogfQogCiBpbnQKLW5vdXZlYXVfYm9faW5pdChzdHJ1Y3Qgbm91dmVh
dV9ibyAqbnZibywgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGZsYWdzLAorbm91dmVhdV9ib19p
bml0KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1NjQgc2l6ZSwgaW50IGFsaWduLCB1MzIgZG9t
YWluLAogCQlzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1hX3Jlc3YgKnJvYmopCiB7CiAJ
aW50IHR5cGUgPSBzZyA/IHR0bV9ib190eXBlX3NnIDogdHRtX2JvX3R5cGVfZGV2aWNlOwpAQCAt
MzA0LDcgKzMwMyw3IEBAIG5vdXZlYXVfYm9faW5pdChzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibywg
dTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGZsYWdzLAogCWFjY19zaXplID0gdHRtX2JvX2RtYV9h
Y2Nfc2l6ZShudmJvLT5iby5iZGV2LCBzaXplLCBzaXplb2YoKm52Ym8pKTsKIAogCW52Ym8tPmJv
Lm1lbS5udW1fcGFnZXMgPSBzaXplID4+IFBBR0VfU0hJRlQ7Ci0Jbm91dmVhdV9ib19wbGFjZW1l
bnRfc2V0KG52Ym8sIGZsYWdzLCAwKTsKKwlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywg
ZG9tYWluLCAwKTsKIAlJTklUX0xJU1RfSEVBRCgmbnZiby0+aW9fcmVzZXJ2ZV9scnUpOwogCiAJ
cmV0ID0gdHRtX2JvX2luaXQobnZiby0+Ym8uYmRldiwgJm52Ym8tPmJvLCBzaXplLCB0eXBlLApA
QCAtMzIwLDE5ICszMTksMTkgQEAgbm91dmVhdV9ib19pbml0KHN0cnVjdCBub3V2ZWF1X2JvICpu
dmJvLCB1NjQgc2l6ZSwgaW50IGFsaWduLCB1MzIgZmxhZ3MsCiAKIGludAogbm91dmVhdV9ib19u
ZXcoc3RydWN0IG5vdXZlYXVfY2xpICpjbGksIHU2NCBzaXplLCBpbnQgYWxpZ24sCi0JICAgICAg
IHVpbnQzMl90IGZsYWdzLCB1aW50MzJfdCB0aWxlX21vZGUsIHVpbnQzMl90IHRpbGVfZmxhZ3Ms
CisJICAgICAgIHVpbnQzMl90IGRvbWFpbiwgdWludDMyX3QgdGlsZV9tb2RlLCB1aW50MzJfdCB0
aWxlX2ZsYWdzLAogCSAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1hX3Jlc3Yg
KnJvYmosCiAJICAgICAgIHN0cnVjdCBub3V2ZWF1X2JvICoqcG52Ym8pCiB7CiAJc3RydWN0IG5v
dXZlYXVfYm8gKm52Ym87CiAJaW50IHJldDsKIAotCW52Ym8gPSBub3V2ZWF1X2JvX2FsbG9jKGNs
aSwgJnNpemUsICZhbGlnbiwgZmxhZ3MsIHRpbGVfbW9kZSwKKwludmJvID0gbm91dmVhdV9ib19h
bGxvYyhjbGksICZzaXplLCAmYWxpZ24sIGRvbWFpbiwgdGlsZV9tb2RlLAogCQkJCXRpbGVfZmxh
Z3MpOwogCWlmIChJU19FUlIobnZibykpCiAJCXJldHVybiBQVFJfRVJSKG52Ym8pOwogCi0JcmV0
ID0gbm91dmVhdV9ib19pbml0KG52Ym8sIHNpemUsIGFsaWduLCBmbGFncywgc2csIHJvYmopOwor
CXJldCA9IG5vdXZlYXVfYm9faW5pdChudmJvLCBzaXplLCBhbGlnbiwgZG9tYWluLCBzZywgcm9i
aik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMzQxLDI3ICszNDAsMjggQEAgbm91
dmVhdV9ib19uZXcoc3RydWN0IG5vdXZlYXVfY2xpICpjbGksIHU2NCBzaXplLCBpbnQgYWxpZ24s
CiB9CiAKIHN0YXRpYyB2b2lkCi1zZXRfcGxhY2VtZW50X2xpc3Qoc3RydWN0IHR0bV9wbGFjZSAq
cGwsIHVuc2lnbmVkICpuLCB1aW50MzJfdCB0eXBlLCB1aW50MzJfdCBmbGFncykKK3NldF9wbGFj
ZW1lbnRfbGlzdChzdHJ1Y3QgdHRtX3BsYWNlICpwbCwgdW5zaWduZWQgKm4sIHVpbnQzMl90IGRv
bWFpbiwKKwkJICAgdWludDMyX3QgZmxhZ3MpCiB7CiAJKm4gPSAwOwogCi0JaWYgKHR5cGUgJiBU
VE1fUExfRkxBR19WUkFNKQorCWlmIChkb21haW4gJiBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSkK
IAkJcGxbKCpuKSsrXS5mbGFncyA9IFRUTV9QTF9GTEFHX1ZSQU0gfCBmbGFnczsKLQlpZiAodHlw
ZSAmIFRUTV9QTF9GTEFHX1RUKQorCWlmIChkb21haW4gJiBOT1VWRUFVX0dFTV9ET01BSU5fR0FS
VCkKIAkJcGxbKCpuKSsrXS5mbGFncyA9IFRUTV9QTF9GTEFHX1RUIHwgZmxhZ3M7Ci0JaWYgKHR5
cGUgJiBUVE1fUExfRkxBR19TWVNURU0pCisJaWYgKGRvbWFpbiAmIE5PVVZFQVVfR0VNX0RPTUFJ
Tl9DUFUpCiAJCXBsWygqbikrK10uZmxhZ3MgPSBUVE1fUExfRkxBR19TWVNURU0gfCBmbGFnczsK
IH0KIAogc3RhdGljIHZvaWQKLXNldF9wbGFjZW1lbnRfcmFuZ2Uoc3RydWN0IG5vdXZlYXVfYm8g
Km52Ym8sIHVpbnQzMl90IHR5cGUpCitzZXRfcGxhY2VtZW50X3JhbmdlKHN0cnVjdCBub3V2ZWF1
X2JvICpudmJvLCB1aW50MzJfdCBkb21haW4pCiB7CiAJc3RydWN0IG5vdXZlYXVfZHJtICpkcm0g
PSBub3V2ZWF1X2JkZXYobnZiby0+Ym8uYmRldik7CiAJdTMyIHZyYW1fcGFnZXMgPSBkcm0tPmNs
aWVudC5kZXZpY2UuaW5mby5yYW1fc2l6ZSA+PiBQQUdFX1NISUZUOwogCXVuc2lnbmVkIGksIGZw
Zm4sIGxwZm47CiAKIAlpZiAoZHJtLT5jbGllbnQuZGV2aWNlLmluZm8uZmFtaWx5ID09IE5WX0RF
VklDRV9JTkZPX1YwX0NFTFNJVVMgJiYKLQkgICAgbnZiby0+bW9kZSAmJiAodHlwZSAmIFRUTV9Q
TF9GTEFHX1ZSQU0pICYmCisJICAgIG52Ym8tPm1vZGUgJiYgKGRvbWFpbiAmIE5PVVZFQVVfR0VN
X0RPTUFJTl9WUkFNKSAmJgogCSAgICBudmJvLT5iby5tZW0ubnVtX3BhZ2VzIDwgdnJhbV9wYWdl
cyAvIDQpIHsKIAkJLyoKIAkJICogTWFrZSBzdXJlIHRoYXQgdGhlIGNvbG9yIGFuZCBkZXB0aCBi
dWZmZXJzIGFyZSBoYW5kbGVkCkBAIC0zODgsNyArMzg4LDggQEAgc2V0X3BsYWNlbWVudF9yYW5n
ZShzdHJ1Y3Qgbm91dmVhdV9ibyAqbnZibywgdWludDMyX3QgdHlwZSkKIH0KIAogdm9pZAotbm91
dmVhdV9ib19wbGFjZW1lbnRfc2V0KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1aW50MzJfdCB0
eXBlLCB1aW50MzJfdCBidXN5KQorbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KHN0cnVjdCBub3V2
ZWF1X2JvICpudmJvLCB1aW50MzJfdCBkb21haW4sCisJCQkgdWludDMyX3QgYnVzeSkKIHsKIAlz
dHJ1Y3QgdHRtX3BsYWNlbWVudCAqcGwgPSAmbnZiby0+cGxhY2VtZW50OwogCXVpbnQzMl90IGZs
YWdzID0gKG52Ym8tPmZvcmNlX2NvaGVyZW50ID8gVFRNX1BMX0ZMQUdfVU5DQUNIRUQgOgpAQCAt
Mzk3LDE3ICszOTgsMTcgQEAgbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KHN0cnVjdCBub3V2ZWF1
X2JvICpudmJvLCB1aW50MzJfdCB0eXBlLCB1aW50MzJfdCBidXN5KQogCiAJcGwtPnBsYWNlbWVu
dCA9IG52Ym8tPnBsYWNlbWVudHM7CiAJc2V0X3BsYWNlbWVudF9saXN0KG52Ym8tPnBsYWNlbWVu
dHMsICZwbC0+bnVtX3BsYWNlbWVudCwKLQkJCSAgIHR5cGUsIGZsYWdzKTsKKwkJCSAgIGRvbWFp
biwgZmxhZ3MpOwogCiAJcGwtPmJ1c3lfcGxhY2VtZW50ID0gbnZiby0+YnVzeV9wbGFjZW1lbnRz
OwogCXNldF9wbGFjZW1lbnRfbGlzdChudmJvLT5idXN5X3BsYWNlbWVudHMsICZwbC0+bnVtX2J1
c3lfcGxhY2VtZW50LAotCQkJICAgdHlwZSB8IGJ1c3ksIGZsYWdzKTsKKwkJCSAgIGRvbWFpbiB8
IGJ1c3ksIGZsYWdzKTsKIAotCXNldF9wbGFjZW1lbnRfcmFuZ2UobnZibywgdHlwZSk7CisJc2V0
X3BsYWNlbWVudF9yYW5nZShudmJvLCBkb21haW4pOwogfQogCiBpbnQKLW5vdXZlYXVfYm9fcGlu
KHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1aW50MzJfdCBtZW10eXBlLCBib29sIGNvbnRpZykK
K25vdXZlYXVfYm9fcGluKHN0cnVjdCBub3V2ZWF1X2JvICpudmJvLCB1aW50MzJfdCBkb21haW4s
IGJvb2wgY29udGlnKQogewogCXN0cnVjdCBub3V2ZWF1X2RybSAqZHJtID0gbm91dmVhdV9iZGV2
KG52Ym8tPmJvLmJkZXYpOwogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSAmbnZiby0+
Ym87CkBAIC00MTksNyArNDIwLDcgQEAgbm91dmVhdV9ib19waW4oc3RydWN0IG5vdXZlYXVfYm8g
Km52Ym8sIHVpbnQzMl90IG1lbXR5cGUsIGJvb2wgY29udGlnKQogCQlyZXR1cm4gcmV0OwogCiAJ
aWYgKGRybS0+Y2xpZW50LmRldmljZS5pbmZvLmZhbWlseSA+PSBOVl9ERVZJQ0VfSU5GT19WMF9U
RVNMQSAmJgotCSAgICBtZW10eXBlID09IFRUTV9QTF9GTEFHX1ZSQU0gJiYgY29udGlnKSB7CisJ
ICAgIGRvbWFpbiA9PSBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSAmJiBjb250aWcpIHsKIAkJaWYg
KCFudmJvLT5jb250aWcpIHsKIAkJCW52Ym8tPmNvbnRpZyA9IHRydWU7CiAJCQlmb3JjZSA9IHRy
dWU7CkBAIC00MjgsMTAgKzQyOSwyMiBAQCBub3V2ZWF1X2JvX3BpbihzdHJ1Y3Qgbm91dmVhdV9i
byAqbnZibywgdWludDMyX3QgbWVtdHlwZSwgYm9vbCBjb250aWcpCiAJfQogCiAJaWYgKG52Ym8t
PnBpbl9yZWZjbnQpIHsKLQkJaWYgKCEobWVtdHlwZSAmICgxIDw8IGJvLT5tZW0ubWVtX3R5cGUp
KSB8fCBldmljdCkgeworCQlib29sIGVycm9yID0gZXZpY3Q7CisKKwkJc3dpdGNoIChiby0+bWVt
Lm1lbV90eXBlKSB7CisJCWNhc2UgVFRNX1BMX1ZSQU06CisJCQllcnJvciB8PSAhKGRvbWFpbiAm
IE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNKTsKKwkJCWJyZWFrOworCQljYXNlIFRUTV9QTF9UVDoK
KwkJCWVycm9yIHw9ICEoZG9tYWluICYgTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQpOworCQlkZWZh
dWx0OgorCQkJYnJlYWs7CisJCX0KKworCQlpZiAoZXJyb3IpIHsKIAkJCU5WX0VSUk9SKGRybSwg
ImJvICVwIHBpbm5lZCBlbHNld2hlcmU6ICIKIAkJCQkgICAgICAiMHglMDh4IHZzIDB4JTA4eFxu
IiwgYm8sCi0JCQkJIDEgPDwgYm8tPm1lbS5tZW1fdHlwZSwgbWVtdHlwZSk7CisJCQkJIGJvLT5t
ZW0ubWVtX3R5cGUsIGRvbWFpbik7CiAJCQlyZXQgPSAtRUJVU1k7CiAJCX0KIAkJbnZiby0+cGlu
X3JlZmNudCsrOwpAQCAtNDM5LDE0ICs0NTIsMTQgQEAgbm91dmVhdV9ib19waW4oc3RydWN0IG5v
dXZlYXVfYm8gKm52Ym8sIHVpbnQzMl90IG1lbXR5cGUsIGJvb2wgY29udGlnKQogCX0KIAogCWlm
IChldmljdCkgewotCQlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywgVFRNX1BMX0ZMQUdf
VFQsIDApOworCQlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywgTk9VVkVBVV9HRU1fRE9N
QUlOX0dBUlQsIDApOwogCQlyZXQgPSBub3V2ZWF1X2JvX3ZhbGlkYXRlKG52Ym8sIGZhbHNlLCBm
YWxzZSk7CiAJCWlmIChyZXQpCiAJCQlnb3RvIG91dDsKIAl9CiAKIAludmJvLT5waW5fcmVmY250
Kys7Ci0Jbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIG1lbXR5cGUsIDApOworCW5vdXZl
YXVfYm9fcGxhY2VtZW50X3NldChudmJvLCBkb21haW4sIDApOwogCiAJLyogZHJvcCBwaW5fcmVm
Y250IHRlbXBvcmFyaWx5LCBzbyB3ZSBkb24ndCB0cmlwIHRoZSBhc3NlcnRpb24KIAkgKiBpbiBu
b3V2ZWF1X2JvX21vdmUoKSB0aGF0IG1ha2VzIHN1cmUgd2UncmUgbm90IHRyeWluZyB0bwpAQCAt
NDkyLDcgKzUwNSwxNiBAQCBub3V2ZWF1X2JvX3VucGluKHN0cnVjdCBub3V2ZWF1X2JvICpudmJv
KQogCWlmIChyZWYpCiAJCWdvdG8gb3V0OwogCi0Jbm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52
Ym8sIGJvLT5tZW0ucGxhY2VtZW50LCAwKTsKKwlzd2l0Y2ggKGJvLT5tZW0ubWVtX3R5cGUpIHsK
KwljYXNlIFRUTV9QTF9WUkFNOgorCQlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywgTk9V
VkVBVV9HRU1fRE9NQUlOX1ZSQU0sIDApOworCQlicmVhazsKKwljYXNlIFRUTV9QTF9UVDoKKwkJ
bm91dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIE5PVVZFQVVfR0VNX0RPTUFJTl9HQVJULCAw
KTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJYnJlYWs7CisJfQogCiAJcmV0ID0gbm91dmVhdV9i
b192YWxpZGF0ZShudmJvLCBmYWxzZSwgZmFsc2UpOwogCWlmIChyZXQgPT0gMCkgewpAQCAtNjc1
LDExICs2OTcsMTEgQEAgbm91dmVhdV9ib19ldmljdF9mbGFncyhzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvLCBzdHJ1Y3QgdHRtX3BsYWNlbWVudCAqcGwpCiAKIAlzd2l0Y2ggKGJvLT5tZW0u
bWVtX3R5cGUpIHsKIAljYXNlIFRUTV9QTF9WUkFNOgotCQlub3V2ZWF1X2JvX3BsYWNlbWVudF9z
ZXQobnZibywgVFRNX1BMX0ZMQUdfVFQsCi0JCQkJCSBUVE1fUExfRkxBR19TWVNURU0pOworCQlu
b3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZibywgTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQsCisJ
CQkJCSBOT1VWRUFVX0dFTV9ET01BSU5fQ1BVKTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJbm91
dmVhdV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIFRUTV9QTF9GTEFHX1NZU1RFTSwgMCk7CisJCW5v
dXZlYXVfYm9fcGxhY2VtZW50X3NldChudmJvLCBOT1VWRUFVX0dFTV9ET01BSU5fQ1BVLCAwKTsK
IAkJYnJlYWs7CiAJfQogCkBAIC0xMTg5LDcgKzEyMTEsOCBAQCBub3V2ZWF1X3R0bV9mYXVsdF9y
ZXNlcnZlX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQogCQkJcmV0dXJuIDA7
CiAKIAkJaWYgKGJvLT5tZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1NZU1RFTSkgewotCQkJbm91dmVh
dV9ib19wbGFjZW1lbnRfc2V0KG52Ym8sIFRUTV9QTF9UVCwgMCk7CisJCQlub3V2ZWF1X2JvX3Bs
YWNlbWVudF9zZXQobnZibywgTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQsCisJCQkJCQkgMCk7CiAK
IAkJCXJldCA9IG5vdXZlYXVfYm9fdmFsaWRhdGUobnZibywgZmFsc2UsIGZhbHNlKTsKIAkJCWlm
IChyZXQpCkBAIC0xMjEzLDcgKzEyMzYsNyBAQCBub3V2ZWF1X3R0bV9mYXVsdF9yZXNlcnZlX25v
dGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQogCQludmJvLT5idXN5X3BsYWNlbWVu
dHNbaV0ubHBmbiA9IG1hcHBhYmxlOwogCX0KIAotCW5vdXZlYXVfYm9fcGxhY2VtZW50X3NldChu
dmJvLCBUVE1fUExfRkxBR19WUkFNLCAwKTsKKwlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQobnZi
bywgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0sIDApOwogCXJldHVybiBub3V2ZWF1X2JvX3ZhbGlk
YXRlKG52Ym8sIGZhbHNlLCBmYWxzZSk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9ub3V2ZWF1L25vdXZlYXVfYm8uaCBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
Ym8uaAppbmRleCBhZTkwYWNhMzNmZWYuLjJhMjNjODIwNzQzNiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfYm8uaApAQCAtNzcsMTAgKzc3LDEwIEBAIGV4dGVybiBzdHJ1Y3QgdHRtX2Jv
X2RyaXZlciBub3V2ZWF1X2JvX2RyaXZlcjsKIAogdm9pZCBub3V2ZWF1X2JvX21vdmVfaW5pdChz
dHJ1Y3Qgbm91dmVhdV9kcm0gKik7CiBzdHJ1Y3Qgbm91dmVhdV9ibyAqbm91dmVhdV9ib19hbGxv
YyhzdHJ1Y3Qgbm91dmVhdV9jbGkgKiwgdTY0ICpzaXplLCBpbnQgKmFsaWduLAotCQkJCSAgICB1
MzIgZmxhZ3MsIHUzMiB0aWxlX21vZGUsIHUzMiB0aWxlX2ZsYWdzKTsKLWludCAgbm91dmVhdV9i
b19pbml0KHN0cnVjdCBub3V2ZWF1X2JvICosIHU2NCBzaXplLCBpbnQgYWxpZ24sIHUzMiBmbGFn
cywKKwkJCQkgICAgdTMyIGRvbWFpbiwgdTMyIHRpbGVfbW9kZSwgdTMyIHRpbGVfZmxhZ3MpOwor
aW50ICBub3V2ZWF1X2JvX2luaXQoc3RydWN0IG5vdXZlYXVfYm8gKiwgdTY0IHNpemUsIGludCBh
bGlnbiwgdTMyIGRvbWFpbiwKIAkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1h
X3Jlc3YgKnJvYmopOwotaW50ICBub3V2ZWF1X2JvX25ldyhzdHJ1Y3Qgbm91dmVhdV9jbGkgKiwg
dTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGZsYWdzLAoraW50ICBub3V2ZWF1X2JvX25ldyhzdHJ1
Y3Qgbm91dmVhdV9jbGkgKiwgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGRvbWFpbiwKIAkJICAg
IHUzMiB0aWxlX21vZGUsIHUzMiB0aWxlX2ZsYWdzLCBzdHJ1Y3Qgc2dfdGFibGUgKnNnLAogCQkg
ICAgc3RydWN0IGRtYV9yZXN2ICpyb2JqLAogCQkgICAgc3RydWN0IG5vdXZlYXVfYm8gKiopOwpA
QCAtMTIyLDEzICsxMjIsMTMgQEAgbm91dmVhdV9ib191bm1hcF91bnBpbl91bnJlZihzdHJ1Y3Qg
bm91dmVhdV9ibyAqKnBudmJvKQogfQogCiBzdGF0aWMgaW5saW5lIGludAotbm91dmVhdV9ib19u
ZXdfcGluX21hcChzdHJ1Y3Qgbm91dmVhdV9jbGkgKmNsaSwgdTY0IHNpemUsIGludCBhbGlnbiwg
dTMyIGZsYWdzLAorbm91dmVhdV9ib19uZXdfcGluX21hcChzdHJ1Y3Qgbm91dmVhdV9jbGkgKmNs
aSwgdTY0IHNpemUsIGludCBhbGlnbiwgdTMyIGRvbWFpbiwKIAkJICAgICAgIHN0cnVjdCBub3V2
ZWF1X2JvICoqcG52Ym8pCiB7Ci0JaW50IHJldCA9IG5vdXZlYXVfYm9fbmV3KGNsaSwgc2l6ZSwg
YWxpZ24sIGZsYWdzLAorCWludCByZXQgPSBub3V2ZWF1X2JvX25ldyhjbGksIHNpemUsIGFsaWdu
LCBkb21haW4sCiAJCQkJIDAsIDAsIE5VTEwsIE5VTEwsIHBudmJvKTsKIAlpZiAocmV0ID09IDAp
IHsKLQkJcmV0ID0gbm91dmVhdV9ib19waW4oKnBudmJvLCBmbGFncywgdHJ1ZSk7CisJCXJldCA9
IG5vdXZlYXVfYm9fcGluKCpwbnZibywgZG9tYWluLCB0cnVlKTsKIAkJaWYgKHJldCA9PSAwKSB7
CiAJCQlyZXQgPSBub3V2ZWF1X2JvX21hcCgqcG52Ym8pOwogCQkJaWYgKHJldCA9PSAwKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jaGFuLmMgYi9kcml2ZXJz
L2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2NoYW4uYwppbmRleCBiODBlNGViZjE0YTYuLjhmMDk5
NjAxZDJmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jaGFu
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9jaGFuLmMKQEAgLTE2Myw5
ICsxNjMsOSBAQCBub3V2ZWF1X2NoYW5uZWxfcHJlcChzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSwg
c3RydWN0IG52aWZfZGV2aWNlICpkZXZpY2UsCiAJYXRvbWljX3NldCgmY2hhbi0+a2lsbGVkLCAw
KTsKIAogCS8qIGFsbG9jYXRlIG1lbW9yeSBmb3IgZG1hIHB1c2ggYnVmZmVyICovCi0JdGFyZ2V0
ID0gVFRNX1BMX0ZMQUdfVFQgfCBUVE1fUExfRkxBR19VTkNBQ0hFRDsKKwl0YXJnZXQgPSBOT1VW
RUFVX0dFTV9ET01BSU5fR0FSVCB8IE5PVVZFQVVfR0VNX0RPTUFJTl9DT0hFUkVOVDsKIAlpZiAo
bm91dmVhdV92cmFtX3B1c2hidWYpCi0JCXRhcmdldCA9IFRUTV9QTF9GTEFHX1ZSQU07CisJCXRh
cmdldCA9IE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNOwogCiAJcmV0ID0gbm91dmVhdV9ib19uZXco
Y2xpLCBzaXplLCAwLCB0YXJnZXQsIDAsIDAsIE5VTEwsIE5VTEwsCiAJCQkgICAgJmNoYW4tPnB1
c2guYnVmZmVyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
ZG1lbS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9kbWVtLmMKaW5kZXggNGU4
MTEyZmRlM2U2Li5hZjcwZWY4ZTU0NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2
ZWF1L25vdXZlYXVfZG1lbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
ZG1lbS5jCkBAIC0yNTQsMTIgKzI1NCwxMiBAQCBub3V2ZWF1X2RtZW1fY2h1bmtfYWxsb2Moc3Ry
dWN0IG5vdXZlYXVfZHJtICpkcm0sIHN0cnVjdCBwYWdlICoqcHBhZ2UpCiAJY2h1bmstPnBhZ2Vt
YXAub3duZXIgPSBkcm0tPmRldjsKIAogCXJldCA9IG5vdXZlYXVfYm9fbmV3KCZkcm0tPmNsaWVu
dCwgRE1FTV9DSFVOS19TSVpFLCAwLAotCQkJICAgICBUVE1fUExfRkxBR19WUkFNLCAwLCAwLCBO
VUxMLCBOVUxMLAorCQkJICAgICBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwgMCwgMCwgTlVMTCwg
TlVMTCwKIAkJCSAgICAgJmNodW5rLT5ibyk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfcmVsZWFz
ZTsKIAotCXJldCA9IG5vdXZlYXVfYm9fcGluKGNodW5rLT5ibywgVFRNX1BMX0ZMQUdfVlJBTSwg
ZmFsc2UpOworCXJldCA9IG5vdXZlYXVfYm9fcGluKGNodW5rLT5ibywgTk9VVkVBVV9HRU1fRE9N
QUlOX1ZSQU0sIGZhbHNlKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF9ib19mcmVlOwogCkBAIC0z
NDYsNyArMzQ2LDcgQEAgbm91dmVhdV9kbWVtX3Jlc3VtZShzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRy
bSkKIAogCW11dGV4X2xvY2soJmRybS0+ZG1lbS0+bXV0ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50
cnkoY2h1bmssICZkcm0tPmRtZW0tPmNodW5rcywgbGlzdCkgewotCQlyZXQgPSBub3V2ZWF1X2Jv
X3BpbihjaHVuay0+Ym8sIFRUTV9QTF9GTEFHX1ZSQU0sIGZhbHNlKTsKKwkJcmV0ID0gbm91dmVh
dV9ib19waW4oY2h1bmstPmJvLCBOT1VWRUFVX0dFTV9ET01BSU5fVlJBTSwgZmFsc2UpOwogCQkv
KiBGSVhNRSBoYW5kbGUgcGluIGZhaWx1cmUgKi8KIAkJV0FSTl9PTihyZXQpOwogCX0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmJjb24uYyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmJjb24uYwppbmRleCAzMTU5YTIxNzJkYjUuLjI0ZWM1
MzM5ZWZiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9mYmNv
bi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZmJjb24uYwpAQCAtMzQx
LDcgKzM0MSw3IEBAIG5vdXZlYXVfZmJjb25fY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpo
ZWxwZXIsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5yZWY7CiAKLQlyZXQgPSBub3V2ZWF1X2Jv
X3BpbihudmJvLCBUVE1fUExfRkxBR19WUkFNLCBmYWxzZSk7CisJcmV0ID0gbm91dmVhdV9ib19w
aW4obnZibywgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0sIGZhbHNlKTsKIAlpZiAocmV0KSB7CiAJ
CU5WX0VSUk9SKGRybSwgImZhaWxlZCB0byBwaW4gZmI6ICVkXG4iLCByZXQpOwogCQlnb3RvIG91
dF91bnJlZjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZ2Vt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2dlbS5jCmluZGV4IDgxZjExMWFk
M2Y0Zi4uODlhZGFkZjQ3MDZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9u
b3V2ZWF1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZ2VtLmMK
QEAgLTE3NiwyMCArMTc2LDEyIEBAIG5vdXZlYXVfZ2VtX25ldyhzdHJ1Y3Qgbm91dmVhdV9jbGkg
KmNsaSwgdTY0IHNpemUsIGludCBhbGlnbiwgdWludDMyX3QgZG9tYWluLAogewogCXN0cnVjdCBu
b3V2ZWF1X2RybSAqZHJtID0gY2xpLT5kcm07CiAJc3RydWN0IG5vdXZlYXVfYm8gKm52Ym87Ci0J
dTMyIGZsYWdzID0gMDsKIAlpbnQgcmV0OwogCi0JaWYgKGRvbWFpbiAmIE5PVVZFQVVfR0VNX0RP
TUFJTl9WUkFNKQotCQlmbGFncyB8PSBUVE1fUExfRkxBR19WUkFNOwotCWlmIChkb21haW4gJiBO
T1VWRUFVX0dFTV9ET01BSU5fR0FSVCkKLQkJZmxhZ3MgfD0gVFRNX1BMX0ZMQUdfVFQ7Ci0JaWYg
KCFmbGFncyB8fCBkb21haW4gJiBOT1VWRUFVX0dFTV9ET01BSU5fQ1BVKQotCQlmbGFncyB8PSBU
VE1fUExfRkxBR19TWVNURU07CisJaWYgKCEoZG9tYWluICYgKE5PVVZFQVVfR0VNX0RPTUFJTl9W
UkFNIHwgTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQpKSkKKwkJZG9tYWluIHw9IE5PVVZFQVVfR0VN
X0RPTUFJTl9DUFU7CiAKLQlpZiAoZG9tYWluICYgTk9VVkVBVV9HRU1fRE9NQUlOX0NPSEVSRU5U
KQotCQlmbGFncyB8PSBUVE1fUExfRkxBR19VTkNBQ0hFRDsKLQotCW52Ym8gPSBub3V2ZWF1X2Jv
X2FsbG9jKGNsaSwgJnNpemUsICZhbGlnbiwgZmxhZ3MsIHRpbGVfbW9kZSwKKwludmJvID0gbm91
dmVhdV9ib19hbGxvYyhjbGksICZzaXplLCAmYWxpZ24sIGRvbWFpbiwgdGlsZV9tb2RlLAogCQkJ
CXRpbGVfZmxhZ3MpOwogCWlmIChJU19FUlIobnZibykpCiAJCXJldHVybiBQVFJfRVJSKG52Ym8p
OwpAQCAtMjAyLDcgKzE5NCw3IEBAIG5vdXZlYXVfZ2VtX25ldyhzdHJ1Y3Qgbm91dmVhdV9jbGkg
KmNsaSwgdTY0IHNpemUsIGludCBhbGlnbiwgdWludDMyX3QgZG9tYWluLAogCQlyZXR1cm4gcmV0
OwogCX0KIAotCXJldCA9IG5vdXZlYXVfYm9faW5pdChudmJvLCBzaXplLCBhbGlnbiwgZmxhZ3Ms
IE5VTEwsIE5VTEwpOworCXJldCA9IG5vdXZlYXVfYm9faW5pdChudmJvLCBzaXplLCBhbGlnbiwg
ZG9tYWluLCBOVUxMLCBOVUxMKTsKIAlpZiAocmV0KSB7CiAJCW5vdXZlYXVfYm9fcmVmKE5VTEws
ICZudmJvKTsKIAkJcmV0dXJuIHJldDsKQEAgLTI5NiwzMiArMjg4LDI4IEBAIG5vdXZlYXVfZ2Vt
X3NldF9kb21haW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW0sIHVpbnQzMl90IHJlYWRfZG9t
YWlucywKIAlzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvID0gJm52Ym8tPmJvOwogCXVpbnQz
Ml90IGRvbWFpbnMgPSB2YWxpZF9kb21haW5zICYgbnZiby0+dmFsaWRfZG9tYWlucyAmCiAJCSh3
cml0ZV9kb21haW5zID8gd3JpdGVfZG9tYWlucyA6IHJlYWRfZG9tYWlucyk7Ci0JdWludDMyX3Qg
cHJlZl9mbGFncyA9IDAsIHZhbGlkX2ZsYWdzID0gMDsKKwl1aW50MzJfdCBwcmVmX2RvbWFpbnMg
PSAwOzsKIAogCWlmICghZG9tYWlucykKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlpZiAodmFsaWRf
ZG9tYWlucyAmIE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNKQotCQl2YWxpZF9mbGFncyB8PSBUVE1f
UExfRkxBR19WUkFNOwotCi0JaWYgKHZhbGlkX2RvbWFpbnMgJiBOT1VWRUFVX0dFTV9ET01BSU5f
R0FSVCkKLQkJdmFsaWRfZmxhZ3MgfD0gVFRNX1BMX0ZMQUdfVFQ7CisJdmFsaWRfZG9tYWlucyAm
PSB+KE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNIHwgTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQpOwog
CiAJaWYgKChkb21haW5zICYgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0pICYmCiAJICAgIGJvLT5t
ZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1ZSQU0pCi0JCXByZWZfZmxhZ3MgfD0gVFRNX1BMX0ZMQUdf
VlJBTTsKKwkJcHJlZl9kb21haW5zIHw9IE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNOwogCiAJZWxz
ZSBpZiAoKGRvbWFpbnMgJiBOT1VWRUFVX0dFTV9ET01BSU5fR0FSVCkgJiYKIAkJIGJvLT5tZW0u
bWVtX3R5cGUgPT0gVFRNX1BMX1RUKQotCQlwcmVmX2ZsYWdzIHw9IFRUTV9QTF9GTEFHX1RUOwor
CQlwcmVmX2RvbWFpbnMgfD0gTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQ7CiAKIAllbHNlIGlmIChk
b21haW5zICYgTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0pCi0JCXByZWZfZmxhZ3MgfD0gVFRNX1BM
X0ZMQUdfVlJBTTsKKwkJcHJlZl9kb21haW5zIHw9IE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNOwog
CiAJZWxzZQotCQlwcmVmX2ZsYWdzIHw9IFRUTV9QTF9GTEFHX1RUOworCQlwcmVmX2RvbWFpbnMg
fD0gTk9VVkVBVV9HRU1fRE9NQUlOX0dBUlQ7CiAKLQlub3V2ZWF1X2JvX3BsYWNlbWVudF9zZXQo
bnZibywgcHJlZl9mbGFncywgdmFsaWRfZmxhZ3MpOworCW5vdXZlYXVfYm9fcGxhY2VtZW50X3Nl
dChudmJvLCBwcmVmX2RvbWFpbnMsIHZhbGlkX2RvbWFpbnMpOwogCiAJcmV0dXJuIDA7CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3ByaW1lLmMgYi9kcml2
ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3ByaW1lLmMKaW5kZXggYmFlNmEzZWNjZWUwLi5m
NDFjMmU4YWRiYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVf
cHJpbWUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X3ByaW1lLmMKQEAg
LTY0LDE0ICs2NCwxMiBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm5vdXZlYXVfZ2VtX3ByaW1l
X2ltcG9ydF9zZ190YWJsZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCXN0cnVjdCBub3V2ZWF1
X2JvICpudmJvOwogCXN0cnVjdCBkbWFfcmVzdiAqcm9iaiA9IGF0dGFjaC0+ZG1hYnVmLT5yZXN2
OwogCXU2NCBzaXplID0gYXR0YWNoLT5kbWFidWYtPnNpemU7Ci0JdTMyIGZsYWdzID0gMDsKIAlp
bnQgYWxpZ24gPSAwOwogCWludCByZXQ7CiAKLQlmbGFncyA9IFRUTV9QTF9GTEFHX1RUOwotCiAJ
ZG1hX3Jlc3ZfbG9jayhyb2JqLCBOVUxMKTsKLQludmJvID0gbm91dmVhdV9ib19hbGxvYygmZHJt
LT5jbGllbnQsICZzaXplLCAmYWxpZ24sIGZsYWdzLCAwLCAwKTsKKwludmJvID0gbm91dmVhdV9i
b19hbGxvYygmZHJtLT5jbGllbnQsICZzaXplLCAmYWxpZ24sCisJCQkJTk9VVkVBVV9HRU1fRE9N
QUlOX0dBUlQsIDAsIDApOwogCWlmIChJU19FUlIobnZibykpIHsKIAkJb2JqID0gRVJSX0NBU1Qo
bnZibyk7CiAJCWdvdG8gdW5sb2NrOwpAQCAtODgsNyArODYsOCBAQCBzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKm5vdXZlYXVfZ2VtX3ByaW1lX2ltcG9ydF9zZ190YWJsZShzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LAogCQlnb3RvIHVubG9jazsKIAl9CiAKLQlyZXQgPSBub3V2ZWF1X2JvX2luaXQobnZi
bywgc2l6ZSwgYWxpZ24sIGZsYWdzLCBzZywgcm9iaik7CisJcmV0ID0gbm91dmVhdV9ib19pbml0
KG52Ym8sIHNpemUsIGFsaWduLCBOT1VWRUFVX0dFTV9ET01BSU5fR0FSVCwKKwkJCSAgICAgIHNn
LCByb2JqKTsKIAlpZiAocmV0KSB7CiAJCW5vdXZlYXVfYm9fcmVmKE5VTEwsICZudmJvKTsKIAkJ
b2JqID0gRVJSX1BUUihyZXQpOwpAQCAtMTA4LDcgKzEwNyw3IEBAIGludCBub3V2ZWF1X2dlbV9w
cmltZV9waW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpvYmopCiAJaW50IHJldDsKIAogCS8qIHBp
biBidWZmZXIgaW50byBHVFQgKi8KLQlyZXQgPSBub3V2ZWF1X2JvX3BpbihudmJvLCBUVE1fUExf
RkxBR19UVCwgZmFsc2UpOworCXJldCA9IG5vdXZlYXVfYm9fcGluKG52Ym8sIE5PVVZFQVVfR0VN
X0RPTUFJTl9HQVJULCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L252MTdfZmVuY2UuYyBiL2RyaXZlcnMv
Z3B1L2RybS9ub3V2ZWF1L252MTdfZmVuY2UuYwppbmRleCA2YjY5N2VlNmJjMGUuLjEyNTNmZGVj
NzEyZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnYxN19mZW5jZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L252MTdfZmVuY2UuYwpAQCAtMTMwLDEwICsxMzAs
MTEgQEAgbnYxN19mZW5jZV9jcmVhdGUoc3RydWN0IG5vdXZlYXVfZHJtICpkcm0pCiAJcHJpdi0+
YmFzZS5jb250ZXh0X2RlbCA9IG52MTBfZmVuY2VfY29udGV4dF9kZWw7CiAJc3Bpbl9sb2NrX2lu
aXQoJnByaXYtPmxvY2spOwogCi0JcmV0ID0gbm91dmVhdV9ib19uZXcoJmRybS0+Y2xpZW50LCA0
MDk2LCAweDEwMDAsIFRUTV9QTF9GTEFHX1ZSQU0sCisJcmV0ID0gbm91dmVhdV9ib19uZXcoJmRy
bS0+Y2xpZW50LCA0MDk2LCAweDEwMDAsCisJCQkgICAgIE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFN
LAogCQkJICAgICAwLCAweDAwMDAsIE5VTEwsIE5VTEwsICZwcml2LT5ibyk7CiAJaWYgKCFyZXQp
IHsKLQkJcmV0ID0gbm91dmVhdV9ib19waW4ocHJpdi0+Ym8sIFRUTV9QTF9GTEFHX1ZSQU0sIGZh
bHNlKTsKKwkJcmV0ID0gbm91dmVhdV9ib19waW4ocHJpdi0+Ym8sIE5PVVZFQVVfR0VNX0RPTUFJ
Tl9WUkFNLCBmYWxzZSk7CiAJCWlmICghcmV0KSB7CiAJCQlyZXQgPSBub3V2ZWF1X2JvX21hcChw
cml2LT5ibyk7CiAJCQlpZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL25vdXZl
YXUvbnY1MF9mZW5jZS5jIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnY1MF9mZW5jZS5jCmlu
ZGV4IDQ5YjQ2ZjUxMDczYy4uNDQ3MjM4ZTNjYmU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vbm91dmVhdS9udjUwX2ZlbmNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnY1
MF9mZW5jZS5jCkBAIC04MSwxMCArODEsMTEgQEAgbnY1MF9mZW5jZV9jcmVhdGUoc3RydWN0IG5v
dXZlYXVfZHJtICpkcm0pCiAJcHJpdi0+YmFzZS5jb250ZXh0X2RlbCA9IG52MTBfZmVuY2VfY29u
dGV4dF9kZWw7CiAJc3Bpbl9sb2NrX2luaXQoJnByaXYtPmxvY2spOwogCi0JcmV0ID0gbm91dmVh
dV9ib19uZXcoJmRybS0+Y2xpZW50LCA0MDk2LCAweDEwMDAsIFRUTV9QTF9GTEFHX1ZSQU0sCisJ
cmV0ID0gbm91dmVhdV9ib19uZXcoJmRybS0+Y2xpZW50LCA0MDk2LCAweDEwMDAsCisJCQkgICAg
IE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNLAogCQkJICAgICAwLCAweDAwMDAsIE5VTEwsIE5VTEws
ICZwcml2LT5ibyk7CiAJaWYgKCFyZXQpIHsKLQkJcmV0ID0gbm91dmVhdV9ib19waW4ocHJpdi0+
Ym8sIFRUTV9QTF9GTEFHX1ZSQU0sIGZhbHNlKTsKKwkJcmV0ID0gbm91dmVhdV9ib19waW4ocHJp
di0+Ym8sIE5PVVZFQVVfR0VNX0RPTUFJTl9WUkFNLCBmYWxzZSk7CiAJCWlmICghcmV0KSB7CiAJ
CQlyZXQgPSBub3V2ZWF1X2JvX21hcChwcml2LT5ibyk7CiAJCQlpZiAocmV0KQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbnY4NF9mZW5jZS5jIGIvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvbnY4NF9mZW5jZS5jCmluZGV4IDdlZDM2YjNhNmI3ZC4uN2M5YzkyOGMzMTk2IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9udjg0X2ZlbmNlLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL25vdXZlYXUvbnY4NF9mZW5jZS5jCkBAIC0yMDksMTIgKzIwOSwxMyBAQCBu
djg0X2ZlbmNlX2NyZWF0ZShzdHJ1Y3Qgbm91dmVhdV9kcm0gKmRybSkKIAltdXRleF9pbml0KCZw
cml2LT5tdXRleCk7CiAKIAkvKiBVc2UgVlJBTSBpZiB0aGVyZSBpcyBhbnkgOyBvdGhlcndpc2Ug
ZmFsbGJhY2sgdG8gc3lzdGVtIG1lbW9yeSAqLwotCWRvbWFpbiA9IGRybS0+Y2xpZW50LmRldmlj
ZS5pbmZvLnJhbV9zaXplICE9IDAgPyBUVE1fUExfRkxBR19WUkFNIDoKLQkJCSAvKgotCQkJICAq
IGZlbmNlcyBjcmVhdGVkIGluIHN5c21lbSBtdXN0IGJlIG5vbi1jYWNoZWQgb3Igd2UKLQkJCSAg
KiB3aWxsIGxvc2UgQ1BVL0dQVSBjb2hlcmVuY3khCi0JCQkgICovCi0JCQkgVFRNX1BMX0ZMQUdf
VFQgfCBUVE1fUExfRkxBR19VTkNBQ0hFRDsKKwlkb21haW4gPSBkcm0tPmNsaWVudC5kZXZpY2Uu
aW5mby5yYW1fc2l6ZSAhPSAwID8KKwkJTk9VVkVBVV9HRU1fRE9NQUlOX1ZSQU0gOgorCQkgLyoK
KwkJICAqIGZlbmNlcyBjcmVhdGVkIGluIHN5c21lbSBtdXN0IGJlIG5vbi1jYWNoZWQgb3Igd2UK
KwkJICAqIHdpbGwgbG9zZSBDUFUvR1BVIGNvaGVyZW5jeSEKKwkJICAqLworCQlOT1VWRUFVX0dF
TV9ET01BSU5fR0FSVCB8IE5PVVZFQVVfR0VNX0RPTUFJTl9DT0hFUkVOVDsKIAlyZXQgPSBub3V2
ZWF1X2JvX25ldygmZHJtLT5jbGllbnQsIDE2ICogZHJtLT5jaGFuLm5yLCAwLAogCQkJICAgICBk
b21haW4sIDAsIDAsIE5VTEwsIE5VTEwsICZwcml2LT5ibyk7CiAJaWYgKHJldCA9PSAwKSB7Ci0t
IAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
