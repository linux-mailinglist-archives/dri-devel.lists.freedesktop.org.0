Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E22B5105D98
	for <lists+dri-devel@lfdr.de>; Fri, 22 Nov 2019 01:22:11 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 900916E233;
	Fri, 22 Nov 2019 00:22:08 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from us-smtp-1.mimecast.com (us-smtp-delivery-1.mimecast.com
 [205.139.110.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D040A6E233
 for <dri-devel@lists.freedesktop.org>; Fri, 22 Nov 2019 00:22:06 +0000 (UTC)
Received: from mail-wr1-f69.google.com (mail-wr1-f69.google.com
 [209.85.221.69]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-340-i42BMEMSMNqRGGbvdzQdmQ-1; Thu, 21 Nov 2019 19:22:04 -0500
Received: by mail-wr1-f69.google.com with SMTP id m17so2923197wrb.20
 for <dri-devel@lists.freedesktop.org>; Thu, 21 Nov 2019 16:22:04 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=W1fJRPx8jNVd2/thMPiixkjKvF9zObui3jPum3g5eVQ=;
 b=CtuRxkRIODv36X2UCoYfG6YGzVVbC1qrh1R4bmTj8bpWo+tdDS9nNwLLsXC54AXSQQ
 hLw/6/MwsO/2P5PaZCPeaYuUJN2li3f0fZjK+ovS5xmpmHilWa3CsjODr2+VxaxMsIUE
 JfTclJni4XcEzvakQrvnIY1ld8fY/dikjeh50dZ+0qnltr21ElSa/ByqgxoP9l+Ufra5
 X6uHrngYLIcWCkU1VTYukauJ9q7hKsn1ptOJ7T1g2np7YnmghGCg8Az75iRMKT1wdYiW
 G4XGJY9pzCaXET+2cD/ZP1rKKCiJKVQEe9ziOtwaiNTIJszeeVn73rRqgnThPG+4cOIf
 5UPw==
X-Gm-Message-State: APjAAAUKk20CQZc2FrFljaukZll+67JIOFZqrnwDh4AYM9gf0Sp8Pm1b
 fm1Bfkih+FxuOsX+alAolJHzzeVQ/cdE3tXtjg5Wtx1KS9ypLzrQ58W/XI8XfZD+FCopWyOcu5s
 LcyoFR3SZi3cGC+zElwCI2RG1MFVc
X-Received: by 2002:adf:b1cb:: with SMTP id r11mr14748007wra.246.1574382123124; 
 Thu, 21 Nov 2019 16:22:03 -0800 (PST)
X-Google-Smtp-Source: APXvYqwoJAmffZuZMuES1MgzeSD7DVWMT78Ozvsm2ZLIe1GjyavVRSTTjvnluR6Q46fXQRM4NmNd1A==
X-Received: by 2002:adf:b1cb:: with SMTP id r11mr14747987wra.246.1574382122838; 
 Thu, 21 Nov 2019 16:22:02 -0800 (PST)
Received: from kherbst.pingu.com ([2a02:8308:b0be:6900:f836:f331:d633:a9f0])
 by smtp.gmail.com with ESMTPSA id d16sm3510565wrg.27.2019.11.21.16.22.01
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 21 Nov 2019 16:22:01 -0800 (PST)
From: Karol Herbst <kherbst@redhat.com>
To: linux-kernel@vger.kernel.org
Subject: [PATCH v5] pci: prevent putting nvidia GPUs into lower device states
 on certain intel bridges
Date: Fri, 22 Nov 2019 01:21:59 +0100
Message-Id: <20191122002159.4159-1-kherbst@redhat.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
X-MC-Unique: i42BMEMSMNqRGGbvdzQdmQ-1
X-Mimecast-Spam-Score: 0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=redhat.com; 
 s=mimecast20190719; t=1574382125;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding;
 bh=rUekpHztE4Y/AJCnx5fkeLUBunhkT4upfB7DGt7EVwQ=;
 b=fCmcaWEOdY9WjtjbdbD5tNTvwKPuFT///7QPItfehuaGA4DxihS58J4FsrmcmOdjDR4Bea
 tjRcn1b8A6m7g++/LdmGjrEvvsTHVKw9Sl3pehINWZA3CBlc+UWZAxmTUDRuEa2dFvVrLG
 HWaVxuNwkVe7bM1QKHdvtgLycnS+upY=
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Karol Herbst <kherbst@redhat.com>, linux-pm@vger.kernel.org,
 linux-pci@vger.kernel.org, Mika Westerberg <mika.westerberg@intel.com>,
 "Rafael J . Wysocki" <rjw@rjwysocki.net>, dri-devel@lists.freedesktop.org,
 nouveau@lists.freedesktop.org, Bjorn Helgaas <bhelgaas@google.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

Rml4ZXMgc3RhdGUgdHJhbnNpdGlvbnMgb2YgTnZpZGlhIFBhc2NhbCBHUFVzIGZyb20gRDNjb2xk
IGludG8gaGlnaGVyIGRldmljZQpzdGF0ZXMuCgp2MjogY29udmVydCB0byBwY2lfZGV2IHF1aXJr
CiAgICBwdXQgYSBwcm9wZXIgdGVjaG5pY2FsIGV4cGxhbmF0aW9uIG9mIHRoZSBpc3N1ZSBhcyBh
IGluLWNvZGUgY29tbWVudAp2MzogZGlzYWJsZSBpdCBvbmx5IGZvciBjZXJ0YWluIGNvbWJpbmF0
aW9ucyBvZiBpbnRlbCBhbmQgbnZpZGlhIGhhcmR3YXJlCnY0OiBzaW1wbGlmeSBxdWlyayBieSBz
ZXR0aW5nIGZsYWcgb24gdGhlIEdQVSBpdHNlbGYKdjU6IHJlc3RydWN0dXJlIHF1aXJrIHRvIG1h
a2UgaXQgZWFzaWVyIHRvIGFkZCBuZXcgSURzCiAgICBmaXggd2hpdGVzcGFjZSBpc3N1ZXMKICAg
IGZpeCBwb3RlbnRpYWwgTlVMTCBwb2ludGVyIGFjY2VzcwogICAgdXBkYXRlIHRoZSBxdWlyayBk
b2N1bWVudGF0aW9uCgpTaWduZWQtb2ZmLWJ5OiBLYXJvbCBIZXJic3QgPGtoZXJic3RAcmVkaGF0
LmNvbT4KQ2M6IEJqb3JuIEhlbGdhYXMgPGJoZWxnYWFzQGdvb2dsZS5jb20+CkNjOiBMeXVkZSBQ
YXVsIDxseXVkZUByZWRoYXQuY29tPgpDYzogUmFmYWVsIEouIFd5c29ja2kgPHJqd0Byand5c29j
a2kubmV0PgpDYzogTWlrYSBXZXN0ZXJiZXJnIDxtaWthLndlc3RlcmJlcmdAaW50ZWwuY29tPgpD
YzogbGludXgtcGNpQHZnZXIua2VybmVsLm9yZwpDYzogbGludXgtcG1Admdlci5rZXJuZWwub3Jn
CkNjOiBkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCkNjOiBub3V2ZWF1QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpCdWd6aWxsYTogaHR0cHM6Ly9idWd6aWxsYS5rZXJuZWwub3JnL3Nob3df
YnVnLmNnaT9pZD0yMDU2MjMKLS0tCiBkcml2ZXJzL3BjaS9wY2kuYyAgICB8ICA3ICsrKysrKwog
ZHJpdmVycy9wY2kvcXVpcmtzLmMgfCA1MSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKwogaW5jbHVkZS9saW51eC9wY2kuaCAgfCAgMSArCiAzIGZpbGVzIGNoYW5n
ZWQsIDU5IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL3BjaS9wY2kuYyBiL2Ry
aXZlcnMvcGNpL3BjaS5jCmluZGV4IDU3ZjE1YTdlNmYwYi4uZTA4ZGIyZGFhOTI0IDEwMDY0NAot
LS0gYS9kcml2ZXJzL3BjaS9wY2kuYworKysgYi9kcml2ZXJzL3BjaS9wY2kuYwpAQCAtODUwLDYg
Kzg1MCwxMyBAQCBzdGF0aWMgaW50IHBjaV9yYXdfc2V0X3Bvd2VyX3N0YXRlKHN0cnVjdCBwY2lf
ZGV2ICpkZXYsIHBjaV9wb3dlcl90IHN0YXRlKQogCSAgIHx8IChzdGF0ZSA9PSBQQ0lfRDIgJiYg
IWRldi0+ZDJfc3VwcG9ydCkpCiAJCXJldHVybiAtRUlPOwogCisJLyoKKwkgKiBDaGVjayBpZiB3
ZSBoYXZlIGEgYmFkIGNvbWJpbmF0aW9uIG9mIGJyaWRnZSBjb250cm9sbGVyIGFuZCBudmlkaWEK
KwkgKiBHUFUsIHNlZSBxdWlya19icm9rZW5fbnZfcnVucG0gZm9yIG1vcmUgaW5mbworCSAqLwor
CWlmIChzdGF0ZSAhPSBQQ0lfRDAgJiYgZGV2LT5icm9rZW5fbnZfcnVucG0pCisJCXJldHVybiAw
OworCiAJcGNpX3JlYWRfY29uZmlnX3dvcmQoZGV2LCBkZXYtPnBtX2NhcCArIFBDSV9QTV9DVFJM
LCAmcG1jc3IpOwogCiAJLyoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvcGNpL3F1aXJrcy5jIGIvZHJp
dmVycy9wY2kvcXVpcmtzLmMKaW5kZXggNDRjNGFlMWFiZDAwLi4yNGUzZjI0N2QyOTEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvcGNpL3F1aXJrcy5jCisrKyBiL2RyaXZlcnMvcGNpL3F1aXJrcy5jCkBA
IC01MjY4LDMgKzUyNjgsNTQgQEAgc3RhdGljIHZvaWQgcXVpcmtfcmVzZXRfbGVub3ZvX3RoaW5r
cGFkX3A1MF9udmdwdShzdHJ1Y3QgcGNpX2RldiAqcGRldikKIERFQ0xBUkVfUENJX0ZJWFVQX0NM
QVNTX0ZJTkFMKFBDSV9WRU5ET1JfSURfTlZJRElBLCAweDEzYjEsCiAJCQkgICAgICBQQ0lfQ0xB
U1NfRElTUExBWV9WR0EsIDgsCiAJCQkgICAgICBxdWlya19yZXNldF9sZW5vdm9fdGhpbmtwYWRf
cDUwX252Z3B1KTsKKworLyoKKyAqIFNvbWUgSW50ZWwgUENJZSBicmlkZ2UgY29udHJvbGxlcnMg
Y2F1c2UgZGV2aWNlcyB0byBub3QgcmVhcHBlYXIgZG9pbmcgYQorICogRDAgLT4gRDNob3QgLT4g
RDNjb2xkIC0+IEQwIHNlcXVlbmNlLiBTa2lwcGluZyB0aGUgaW50ZXJtZWRpYXRlIEQzaG90IHN0
ZXAKKyAqIHNlZW1zIHRvIG1ha2UgaXQgd29yayBhZ2Fpbi4KKyAqCisgKiBUaGlzIGxlYWRzIHRv
IHZhcmlvdXMgbWFuaWZlc3RhdGlvbnMgb2YgdGhpcyBpc3N1ZToKKyAqICAtIEFJTUwgY29kZSBl
eGVjdXRpb24gaGl0cyBhbiBpbmZpbml0ZSBsb29wIChhcyB0aGUgY29lIHdhaXRzIG9uIGRldmlj
ZQorICogICAgbWVtb3J5IHRvIGNoYW5nZSkuCisgKiAgLSBrZXJuZWwgY3Jhc2hlcywgYXMgYWxs
IFBDSSByZWFkcyByZXR1cm4gLTEsIHdoaWNoIG1vc3QgY29kZSBpc24ndCBhYmxlCisgKiAgICB0
byBoYW5kbGUgd2VsbCBlbm91Z2guCisgKiAgLSBzdWRkZW4gc2h1dGRvd25zLCBhcyB0aGUga2Vy
bmVsIGlkZW50aWZpZWQgYW4gdW5yZWNvdmVyYWJsZSBlcnJvciBhZnRlcgorICogICAgdXNlcnNw
YWNlIHRyaWVzIHRvIGFjY2VzcyB0aGUgR1BVLgorICoKKyAqIEluIGFsbCBjYXNlcyBkbWVzZyB3
aWxsIGNvbnRhaW4gYXQgbGVhc3Qgb25lIGxpbmUgbGlrZSB0aGlzOgorICogJ25vdXZlYXUgMDAw
MDowMTowMC4wOiBSZWZ1c2VkIHRvIGNoYW5nZSBwb3dlciBzdGF0ZSwgY3VycmVudGx5IGluIEQz
JworICogZm9sbG93ZWQgYnkgYSBsb3Qgb2Ygbm91dmVhdSB0aW1lb3V0cy4KKyAqCisgKiBBQ1BJ
IGNvZGUgd3JpdGVzIGJpdCAweDgwIHRvIHRoZSBub3QgZG9jdW1lbnRlZCBQQ0kgcmVnaXN0ZXIg
MHgyNDggb2YgdGhlCisgKiBJbnRlbCBQQ0llIGJyaWRnZSBjb250cm9sbGVyICgweDE5MDEpIGlu
IG9yZGVyIHRvIHBvd2VyIGRvd24gdGhlIEdQVS4KKyAqIE5vbmV0aGVsZXNzLCB0aGVyZSBhcmUg
b3RoZXIgY29kZSBwYXRocyBpbnNpZGUgdGhlIEFDUEkgZmlybXdhcmUgd2hpY2ggdXNlCisgKiBv
dGhlciByZWdpc3RlcnMsIHdoaWNoIHNlZW0gdG8gd29yayBmaW5lOgorICogIC0gMHhiYyBiaXQg
MHgyMCAocHVibGljbHkgYXZhaWxhYmxlIGRvY3VtZW50YXRpb24gY2xhaW1zICdyZXNlcnZlZCcp
CisgKiAgLSAweGIwIGJpdCAweDEwIChsaW5rIGRpc2FibGUpCisgKiBDaGFuZ2luZyB0aGUgY29u
ZGl0aW9ucyBpbnNpZGUgdGhlIGZpcm13YXJlIGJ5IHBva2luZyBpbnRvIHRoZSByZWxldmFudAor
ICogYWRkcmVzc2VzIGRvZXMgcmVzb2x2ZSB0aGUgaXNzdWUsIGJ1dCBpdCBzZWVtZWQgdG8gYmUg
QUNQSSBwcml2YXRlIG1lbW9yeQorICogYW5kIG5vdCBhbnkgZGV2aWNlIGFjY2Vzc2libGUgbWVt
b3J5IGF0IGFsbCwgc28gdGhlcmUgaXMgbm8gcG9ydGFibGUgd2F5IG9mCisgKiBjaGFuZ2luZyB0
aGUgY29uZGl0aW9ucy4KKyAqCisgKiBUaGUgb25seSBzeXN0ZW1zIHdoZXJlIHRoaXMgYmVoYXZp
b3IgY2FuIGJlIHNlZW4gYXJlIGh5YnJpZCBncmFwaGljcyBsYXB0b3BzCisgKiB3aXRoIGEgc2Vj
b25kYXJ5IE52aWRpYSBNYXh3ZWxsLCBQYXNjYWwgb3IgVHVyaW5nIEdQVS4gSXQgY2Fubm90IGJl
IHJ1bGVkCisgKiBvdXQgdGhhdCB0aGlzIGlzc3VlIG9ubHkgb2NjdXJzIGluIGNvbWJpbmF0aW9u
IHdpdGggbGlzdGVkIEludGVsIFBDSWUKKyAqIGJyaWRnZSBjb250cm9sbGVycyBhbmQgdGhlIG1l
bnRpb25lZCBHUFVzIG9yIGlmIGl0J3Mgb25seSBhIGh3IGJ1ZyBpbiB0aGUKKyAqIGJyaWRnZSBj
b250cm9sbGVyLgorICovCisKK3N0YXRpYyB2b2lkIHF1aXJrX2Jyb2tlbl9udl9ydW5wbShzdHJ1
Y3QgcGNpX2RldiAqZGV2KQoreworCXN0cnVjdCBwY2lfZGV2ICpicmlkZ2UgPSBwY2lfdXBzdHJl
YW1fYnJpZGdlKGRldik7CisKKwlpZiAoIWJyaWRnZSB8fCBicmlkZ2UtPnZlbmRvciAhPSBQQ0lf
VkVORE9SX0lEX0lOVEVMKQorCQlyZXR1cm47CisKKwlzd2l0Y2ggKGJyaWRnZS0+ZGV2aWNlKSB7
CisJY2FzZSAweDE5MDE6CisJCWRldi0+YnJva2VuX252X3J1bnBtID0gMTsKKwl9Cit9CitERUNM
QVJFX1BDSV9GSVhVUF9DTEFTU19GSU5BTChQQ0lfVkVORE9SX0lEX05WSURJQSwgUENJX0FOWV9J
RCwKKwkJCSAgICAgIFBDSV9CQVNFX0NMQVNTX0RJU1BMQVksIDE2LAorCQkJICAgICAgcXVpcmtf
YnJva2VuX252X3J1bnBtKTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvcGNpLmggYi9pbmNs
dWRlL2xpbnV4L3BjaS5oCmluZGV4IGFjOGE2YzRlMTc5Mi4uOTAzYTBiM2EzOWVjIDEwMDY0NAot
LS0gYS9pbmNsdWRlL2xpbnV4L3BjaS5oCisrKyBiL2luY2x1ZGUvbGludXgvcGNpLmgKQEAgLTQx
Niw2ICs0MTYsNyBAQCBzdHJ1Y3QgcGNpX2RldiB7CiAJdW5zaWduZWQgaW50CV9fYWVyX2Zpcm13
YXJlX2ZpcnN0X3ZhbGlkOjE7CiAJdW5zaWduZWQgaW50CV9fYWVyX2Zpcm13YXJlX2ZpcnN0OjE7
CiAJdW5zaWduZWQgaW50CWJyb2tlbl9pbnR4X21hc2tpbmc6MTsJLyogSU5UeCBtYXNraW5nIGNh
bid0IGJlIHVzZWQgKi8KKwl1bnNpZ25lZCBpbnQJYnJva2VuX252X3J1bnBtOjE7CS8qIHNvbWUg
Y29tYmluYXRpb25zIG9mIGludGVsIGJyaWRnZSBjb250cm9sbGVyIGFuZCBudmlkaWEgR1BVcyBi
cmVhayBydGQzICovCiAJdW5zaWduZWQgaW50CWlvX3dpbmRvd18xazoxOwkJLyogSW50ZWwgYnJp
ZGdlIDFLIEkvTyB3aW5kb3dzICovCiAJdW5zaWduZWQgaW50CWlycV9tYW5hZ2VkOjE7CiAJdW5z
aWduZWQgaW50CWhhc19zZWNvbmRhcnlfbGluazoxOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0
CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
