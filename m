Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2B575DBCDE
	for <lists+dri-devel@lfdr.de>; Fri, 18 Oct 2019 07:23:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E219C6EAB0;
	Fri, 18 Oct 2019 05:23:40 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pl1-x642.google.com (mail-pl1-x642.google.com
 [IPv6:2607:f8b0:4864:20::642])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 80F236EAB0
 for <dri-devel@lists.freedesktop.org>; Fri, 18 Oct 2019 05:23:34 +0000 (UTC)
Received: by mail-pl1-x642.google.com with SMTP id u12so2260585pls.12
 for <dri-devel@lists.freedesktop.org>; Thu, 17 Oct 2019 22:23:34 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references;
 bh=M2dfDAnX3mNo486r8iPg8Xzv2WQBrUh28/r2sNyR+y0=;
 b=Z+dfFbUSXEP9jJZkITm/Lv7Bj1JmiqpwBH0mkAvUm8soUX+/eAhzkPDX/i/seESzqx
 Q9vNCAHaj27T5KE8xCV7nHZW5TRZt2pS+If8GAZUL2zYClP/xZqxdE6CbxXUl9tQT1O3
 w4uAbBICAwrPnWgsLP3xatwxHwN4teye5UAeqpCpXjjXYIkKmUDK9uUQ4owMdFGrSOcb
 MLHtJxLfjNKVObXN9YnZSQ2UGJ1UNGRlfKpVbmrJR6Vg6GHHUlua9vpBflFpuGrr+4jk
 WH8G6RE61soyPMI/LRyVIiou/A0o82Tqudz1jrTnITyDNMIvpRYXKI5GONgHMmdWGFyv
 UG7A==
X-Gm-Message-State: APjAAAVVgHBzVSgLfVFEklIih0bFbUxIwKNs9WvHFyFVyHmLTYk7sFcp
 FOIb3RmHgIa017I65JUSk9JH9w==
X-Google-Smtp-Source: APXvYqyoidUtTGSjrnKStnv1yFYi4G/TzGHMcLkvymQ5WY/5dVsuyq0B1rgQxLz7Bkj9Rv00ZUeHHg==
X-Received: by 2002:a17:902:848e:: with SMTP id
 c14mr7894660plo.217.1571376213875; 
 Thu, 17 Oct 2019 22:23:33 -0700 (PDT)
Received: from localhost.localdomain ([2601:1c2:680:1319:692:26ff:feda:3a81])
 by smtp.gmail.com with ESMTPSA id
 g202sm4729336pfb.155.2019.10.17.22.23.32
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Thu, 17 Oct 2019 22:23:33 -0700 (PDT)
From: John Stultz <john.stultz@linaro.org>
To: lkml <linux-kernel@vger.kernel.org>
Subject: [PATCH v12 4/5] dma-buf: heaps: Add CMA heap to dmabuf heaps
Date: Fri, 18 Oct 2019 05:23:22 +0000
Message-Id: <20191018052323.21659-5-john.stultz@linaro.org>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191018052323.21659-1-john.stultz@linaro.org>
References: <20191018052323.21659-1-john.stultz@linaro.org>
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=linaro.org; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references;
 bh=M2dfDAnX3mNo486r8iPg8Xzv2WQBrUh28/r2sNyR+y0=;
 b=Bu8jDacdesErrN+wGUCX/Vl7UNRDCc0jK1GmuywXhDkc6ytRXsZxyRjUWnBrcqkKpI
 q3qCnGJOlFUA43hvebmF9HoPfbtcDzIyQc5zwgwGBdSXp9bN4clwJll1w8Oqfc9REYCD
 hAz7cde4dhshspG/P/eyJPfedYOebyC/6mx8YctL0/fqu9XYI9UHw+rvaOSNAy3iiMeY
 ri2R/4CLu9t0gI6AcBO/GsHwZpiO7aLNBVP1da8gEeHgUBYAa6FXtZjw6byvY0kZLS00
 qAEZuglNJQ8XAlhD657mev89K7X3EyZKmwk0NSY+Cx0uX1suL7qtW4xD1icVrHmrD/F3
 CJEg==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Hillf Danton <hdanton@sina.com>, Sudipto Paul <Sudipto.Paul@arm.com>,
 Vincent Donnefort <Vincent.Donnefort@arm.com>, Chenbo Feng <fengc@google.com>,
 Alistair Strachan <astrachan@google.com>, Liam Mark <lmark@codeaurora.org>,
 Christoph Hellwig <hch@infradead.org>, dri-devel@lists.freedesktop.org,
 "Andrew F . Davis" <afd@ti.com>, Hridya Valsaraju <hridya@google.com>,
 Pratik Patel <pratikp@codeaurora.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBhZGRzIGEgQ01BIGhlYXAsIHdoaWNoIGFsbG93cyB1c2Vyc3BhY2UgdG8gYWxsb2NhdGUK
YSBkbWEtYnVmIG9mIGNvbnRpZ3VvdXMgbWVtb3J5IG91dCBvZiBhIENNQSByZWdpb24uCgpUaGlz
IGNvZGUgaXMgYW4gZXZvbHV0aW9uIG9mIHRoZSBBbmRyb2lkIElPTiBpbXBsZW1lbnRhdGlvbiwg
c28KdGhhbmtzIHRvIGl0cyBvcmlnaW5hbCBhdXRob3IgYW5kIG1haW50YWludGVyczoKICBCZW5q
YW1pbiBHYWlnbmFyZCwgTGF1cmEgQWJib3R0LCBhbmQgb3RoZXJzIQoKTk9URTogVGhpcyBwYXRj
aCBvbmx5IGFkZHMgdGhlIGRlZmF1bHQgQ01BIGhlYXAuIFdlIHdpbGwgZW5hYmxlCnNlbGVjdGl2
ZWx5IGFkZGluZyBvdGhlciBDTUEgbWVtb3J5IHJlZ2lvbnMgdG8gdGhlIGRtYWJ1ZiBoZWFwcwpp
bnRlcmZhY2Ugd2l0aCBhIGxhdGVyIHBhdGNoICh3aGljaCByZXF1aXJlcyBhIGR0IGJpbmRpbmcp
CgpDYzogTGF1cmEgQWJib3R0IDxsYWJib3R0QHJlZGhhdC5jb20+CkNjOiBCZW5qYW1pbiBHYWln
bmFyZCA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4KQ2M6IFN1bWl0IFNlbXdhbCA8c3Vt
aXQuc2Vtd2FsQGxpbmFyby5vcmc+CkNjOiBMaWFtIE1hcmsgPGxtYXJrQGNvZGVhdXJvcmEub3Jn
PgpDYzogUHJhdGlrIFBhdGVsIDxwcmF0aWtwQGNvZGVhdXJvcmEub3JnPgpDYzogQnJpYW4gU3Rh
cmtleSA8QnJpYW4uU3RhcmtleUBhcm0uY29tPgpDYzogVmluY2VudCBEb25uZWZvcnQgPFZpbmNl
bnQuRG9ubmVmb3J0QGFybS5jb20+CkNjOiBTdWRpcHRvIFBhdWwgPFN1ZGlwdG8uUGF1bEBhcm0u
Y29tPgpDYzogQW5kcmV3IEYuIERhdmlzIDxhZmRAdGkuY29tPgpDYzogQ2hyaXN0b3BoIEhlbGx3
aWcgPGhjaEBpbmZyYWRlYWQub3JnPgpDYzogQ2hlbmJvIEZlbmcgPGZlbmdjQGdvb2dsZS5jb20+
CkNjOiBBbGlzdGFpciBTdHJhY2hhbiA8YXN0cmFjaGFuQGdvb2dsZS5jb20+CkNjOiBIcmlkeWEg
VmFsc2FyYWp1IDxocmlkeWFAZ29vZ2xlLmNvbT4KQ2M6IEhpbGxmIERhbnRvbiA8aGRhbnRvbkBz
aW5hLmNvbT4KQ2M6IGRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKUmV2aWV3ZWQtYnk6
IEJlbmphbWluIEdhaWduYXJkIDxiZW5qYW1pbi5nYWlnbmFyZEBsaW5hcm8ub3JnPgpSZXZpZXdl
ZC1ieTogQnJpYW4gU3RhcmtleSA8YnJpYW4uc3RhcmtleUBhcm0uY29tPgpBY2tlZC1ieTogTGF1
cmEgQWJib3R0IDxsYWJib3R0QHJlZGhhdC5jb20+ClRlc3RlZC1ieTogQXlhbiBLdW1hciBIYWxk
ZXIgPGF5YW4uaGFsZGVyQGFybS5jb20+ClNpZ25lZC1vZmYtYnk6IEpvaG4gU3R1bHR6IDxqb2hu
LnN0dWx0ekBsaW5hcm8ub3JnPgotLS0KdjI6CiogU3dpdGNoIGFsbG9jYXRlIHRvIHJldHVybiBk
bWFidWYgZmQKKiBTaW1wbGlmeSBpbml0IGNvZGUKKiBDaGVja3BhdGNoIGZpeHVwcwp2MzoKKiBT
d2l0Y2ggdG8gaW5saW5lIGZ1bmN0aW9uIGZvciB0b19jbWFfaGVhcCgpCiogTWlub3IgY2xlYW51
cHMgc3VnZ2VzdGVkIGJ5IEJyaWFuCiogRm9sZCBpbiBuZXcgcmVnaXN0cmF0aW9uIHN0eWxlIGZy
b20gQW5kcmV3CiogRm9sZGVkIGluIGNoYW5nZXMgZnJvbSBBbmRyZXcgdG8gdXNlIHNpbXBsaWZp
ZWQgcGFnZSBsaXN0CiAgZnJvbSB0aGUgaGVhcCBoZWxwZXJzCnY0OgoqIFVzZSB0aGUgZmRfZmxh
Z3Mgd2hlbiBjcmVhdGluZyBkbWFidWYgZmQgKFN1Z2dlc3RlZCBieQogIEJlbmphbWluKQoqIFVz
ZSBwcmVjYWxjdWxhdGVkIHBhZ2Vjb3VudCAoU3VnZ2VzdGVkIGJ5IEFuZHJldykKdjY6CiogQ2hh
bmdlZCB2YXJpYWJsZSBuYW1lcyB0byBpbXByb3ZlIGNsYXJpdHksIGFzIHN1Z2dlc3RlZAogIGJ5
IEJyaWFuCnY3OgoqIFVzZSBuZXdseSBsb3dlci1jYXNlZCBpbml0X2hlYXBfaGVscGVyX2J1ZmZl
ciBoZWxwZXIKKiBVc2UgbmV3IGRtYWJ1ZiBleHBvcnQgaGVscGVyCnY4OgoqIE1ha2Ugc3RydWN0
IGRtYV9oZWFwX29wcyBjb25zdCAoU3VnZ2VzdGVkIGJ5IENocmlzdG9waCkKKiBDb25kZW5zZSBk
bWFfaGVhcF9idWZmZXIgYW5kIGhlYXBfaGVscGVyX2J1ZmZlciAoc3VnZ2VzdGVkIGJ5CiAgQ2hy
aXN0b3BoKQoqIENoZWNrcGF0Y2ggd2hpdGVzcGFjZSBmaXh1cHMKdjk6CiogUmVtb3ZpbmcgbmVl
ZGxlc3MgY2hlY2sgbm90ZWQgYnkgQnJpYW4gU3RhcmtleQoqIFJlbmFtZSBkbWFfaGVhcF9nZXRf
ZGF0YS0+ZG1hX2hlYXBfZ2V0X2RydmRhdGEgc3VnZ2VzdGVkCiAgYnkgSGlsZiBEYW50b24KKiBD
aGVjayBzaWduYWxzIGFmdGVyIGNsZWFyaW5nIG1lbW9yeSBwYWdlcyB0byBhdm9pZCBkb2luZwog
IG5lZWRsZXNzIHdvcmsgaWYgdGhlIHRhc2sgaXMga2lsbGVkIGFzIHN1Z2dlc3RlZCBieSBIaWxm
CnYxMjoKKiBSZXdvcmsgdG8gb25seSBhZGQgdGhlIGRlZmF1bHQgQ01BIGhlYXAKLS0tCiBkcml2
ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZyAgICB8ICAgOCArKwogZHJpdmVycy9kbWEtYnVmL2hl
YXBzL01ha2VmaWxlICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFwLmMg
fCAxNzggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMyBmaWxlcyBjaGFuZ2VkLCAx
ODcgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZG1hLWJ1Zi9oZWFw
cy9jbWFfaGVhcC5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcg
Yi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvS2NvbmZpZwppbmRleCAyMDUwNTI3NDQxNjkuLmE1ZWVm
MDZjNDIyNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKKysrIGIv
ZHJpdmVycy9kbWEtYnVmL2hlYXBzL0tjb25maWcKQEAgLTQsMyArNCwxMSBAQCBjb25maWcgRE1B
QlVGX0hFQVBTX1NZU1RFTQogCWhlbHAKIAkgIENob29zZSB0aGlzIG9wdGlvbiB0byBlbmFibGUg
dGhlIHN5c3RlbSBkbWFidWYgaGVhcC4gVGhlIHN5c3RlbSBoZWFwCiAJICBpcyBiYWNrZWQgYnkg
cGFnZXMgZnJvbSB0aGUgYnVkZHkgYWxsb2NhdG9yLiBJZiBpbiBkb3VidCwgc2F5IFkuCisKK2Nv
bmZpZyBETUFCVUZfSEVBUFNfQ01BCisJYm9vbCAiRE1BLUJVRiBDTUEgSGVhcCIKKwlkZXBlbmRz
IG9uIERNQUJVRl9IRUFQUyAmJiBETUFfQ01BCisJaGVscAorCSAgQ2hvb3NlIHRoaXMgb3B0aW9u
IHRvIGVuYWJsZSBkbWEtYnVmIENNQSBoZWFwLiBUaGlzIGhlYXAgaXMgYmFja2VkCisJICBieSB0
aGUgQ29udGlndW91cyBNZW1vcnkgQWxsb2NhdG9yIChDTUEpLiBJZiB5b3VyIHN5c3RlbSBoYXMg
dGhlc2UKKwkgIHJlZ2lvbnMsIHlvdSBzaG91bGQgc2F5IFkgaGVyZS4KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtl
ZmlsZQppbmRleCBkMTgwOGVjYTI1ODEuLjZlNTRjZGVjM2RhMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9kbWEtYnVmL2hlYXBzL01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZG1hLWJ1Zi9oZWFwcy9NYWtl
ZmlsZQpAQCAtMSwzICsxLDQgQEAKICMgU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAK
IG9iai15CQkJCQkrPSBoZWFwLWhlbHBlcnMubwogb2JqLSQoQ09ORklHX0RNQUJVRl9IRUFQU19T
WVNURU0pCSs9IHN5c3RlbV9oZWFwLm8KK29iai0kKENPTkZJR19ETUFCVUZfSEVBUFNfQ01BKQkJ
Kz0gY21hX2hlYXAubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL2hlYXBzL2NtYV9oZWFw
LmMgYi9kcml2ZXJzL2RtYS1idWYvaGVhcHMvY21hX2hlYXAuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjA2NDkyNmI1ZDczNQotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZG1hLWJ1Zi9oZWFwcy9jbWFfaGVhcC5jCkBAIC0wLDAgKzEsMTc4IEBACisvLyBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMAorLyoKKyAqIERNQUJVRiBDTUEgaGVhcCBleHBv
cnRlcgorICoKKyAqIENvcHlyaWdodCAoQykgMjAxMiwgMjAxOSBMaW5hcm8gTHRkLgorICogQXV0
aG9yOiA8YmVuamFtaW4uZ2FpZ25hcmRAbGluYXJvLm9yZz4gZm9yIFNULUVyaWNzc29uLgorICov
CisKKyNpbmNsdWRlIDxsaW51eC9jbWEuaD4KKyNpbmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KKyNp
bmNsdWRlIDxsaW51eC9kbWEtYnVmLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWhlYXAuaD4KKyNp
bmNsdWRlIDxsaW51eC9kbWEtY29udGlndW91cy5oPgorI2luY2x1ZGUgPGxpbnV4L2Vyci5oPgor
I2luY2x1ZGUgPGxpbnV4L2Vycm5vLmg+CisjaW5jbHVkZSA8bGludXgvaGlnaG1lbS5oPgorI2lu
Y2x1ZGUgPGxpbnV4L21vZHVsZS5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKyNpbmNsdWRl
IDxsaW51eC9zY2F0dGVybGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3NjaGVkL3NpZ25hbC5oPgor
CisjaW5jbHVkZSAiaGVhcC1oZWxwZXJzLmgiCisKK3N0cnVjdCBjbWFfaGVhcCB7CisJc3RydWN0
IGRtYV9oZWFwICpoZWFwOworCXN0cnVjdCBjbWEgKmNtYTsKK307CisKK3N0YXRpYyB2b2lkIGNt
YV9oZWFwX2ZyZWUoc3RydWN0IGhlYXBfaGVscGVyX2J1ZmZlciAqYnVmZmVyKQoreworCXN0cnVj
dCBjbWFfaGVhcCAqY21hX2hlYXAgPSBkbWFfaGVhcF9nZXRfZHJ2ZGF0YShidWZmZXItPmhlYXAp
OworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBidWZmZXItPnBhZ2Vjb3VudDsKKwlzdHJ1Y3Qg
cGFnZSAqY21hX3BhZ2VzID0gYnVmZmVyLT5wcml2X3ZpcnQ7CisKKwkvKiBmcmVlIHBhZ2UgbGlz
dCAqLworCWtmcmVlKGJ1ZmZlci0+cGFnZXMpOworCS8qIHJlbGVhc2UgbWVtb3J5ICovCisJY21h
X3JlbGVhc2UoY21hX2hlYXAtPmNtYSwgY21hX3BhZ2VzLCBucl9wYWdlcyk7CisJa2ZyZWUoYnVm
ZmVyKTsKK30KKworLyogZG1hYnVmIGhlYXAgQ01BIG9wZXJhdGlvbnMgZnVuY3Rpb25zICovCitz
dGF0aWMgaW50IGNtYV9oZWFwX2FsbG9jYXRlKHN0cnVjdCBkbWFfaGVhcCAqaGVhcCwKKwkJCSAg
ICAgdW5zaWduZWQgbG9uZyBsZW4sCisJCQkgICAgIHVuc2lnbmVkIGxvbmcgZmRfZmxhZ3MsCisJ
CQkgICAgIHVuc2lnbmVkIGxvbmcgaGVhcF9mbGFncykKK3sKKwlzdHJ1Y3QgY21hX2hlYXAgKmNt
YV9oZWFwID0gZG1hX2hlYXBfZ2V0X2RydmRhdGEoaGVhcCk7CisJc3RydWN0IGhlYXBfaGVscGVy
X2J1ZmZlciAqaGVscGVyX2J1ZmZlcjsKKwlzdHJ1Y3QgcGFnZSAqY21hX3BhZ2VzOworCXNpemVf
dCBzaXplID0gUEFHRV9BTElHTihsZW4pOworCXVuc2lnbmVkIGxvbmcgbnJfcGFnZXMgPSBzaXpl
ID4+IFBBR0VfU0hJRlQ7CisJdW5zaWduZWQgbG9uZyBhbGlnbiA9IGdldF9vcmRlcihzaXplKTsK
KwlzdHJ1Y3QgZG1hX2J1ZiAqZG1hYnVmOworCWludCByZXQgPSAtRU5PTUVNOworCXBnb2ZmX3Qg
cGc7CisKKwlpZiAoYWxpZ24gPiBDT05GSUdfQ01BX0FMSUdOTUVOVCkKKwkJYWxpZ24gPSBDT05G
SUdfQ01BX0FMSUdOTUVOVDsKKworCWhlbHBlcl9idWZmZXIgPSBremFsbG9jKHNpemVvZigqaGVs
cGVyX2J1ZmZlciksIEdGUF9LRVJORUwpOworCWlmICghaGVscGVyX2J1ZmZlcikKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwlpbml0X2hlYXBfaGVscGVyX2J1ZmZlcihoZWxwZXJfYnVmZmVyLCBjbWFf
aGVhcF9mcmVlKTsKKwloZWxwZXJfYnVmZmVyLT5mbGFncyA9IGhlYXBfZmxhZ3M7CisJaGVscGVy
X2J1ZmZlci0+aGVhcCA9IGhlYXA7CisJaGVscGVyX2J1ZmZlci0+c2l6ZSA9IGxlbjsKKworCWNt
YV9wYWdlcyA9IGNtYV9hbGxvYyhjbWFfaGVhcC0+Y21hLCBucl9wYWdlcywgYWxpZ24sIGZhbHNl
KTsKKwlpZiAoIWNtYV9wYWdlcykKKwkJZ290byBmcmVlX2J1ZjsKKworCWlmIChQYWdlSGlnaE1l
bShjbWFfcGFnZXMpKSB7CisJCXVuc2lnbmVkIGxvbmcgbnJfY2xlYXJfcGFnZXMgPSBucl9wYWdl
czsKKwkJc3RydWN0IHBhZ2UgKnBhZ2UgPSBjbWFfcGFnZXM7CisKKwkJd2hpbGUgKG5yX2NsZWFy
X3BhZ2VzID4gMCkgeworCQkJdm9pZCAqdmFkZHIgPSBrbWFwX2F0b21pYyhwYWdlKTsKKworCQkJ
bWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJWkUpOworCQkJa3VubWFwX2F0b21pYyh2YWRkcik7CisJ
CQkvKgorCQkJICogQXZvaWQgd2FzdGluZyB0aW1lIHplcm9pbmcgbWVtb3J5IGlmIHRoZSBwcm9j
ZXNzCisJCQkgKiBoYXMgYmVlbiBraWxsZWQgYnkgYnkgU0lHS0lMTAorCQkJICovCisJCQlpZiAo
ZmF0YWxfc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQkJZ290byBmcmVlX2NtYTsKKworCQkJ
cGFnZSsrOworCQkJbnJfY2xlYXJfcGFnZXMtLTsKKwkJfQorCX0gZWxzZSB7CisJCW1lbXNldChw
YWdlX2FkZHJlc3MoY21hX3BhZ2VzKSwgMCwgc2l6ZSk7CisJfQorCisJaGVscGVyX2J1ZmZlci0+
cGFnZWNvdW50ID0gbnJfcGFnZXM7CisJaGVscGVyX2J1ZmZlci0+cGFnZXMgPSBrbWFsbG9jX2Fy
cmF5KGhlbHBlcl9idWZmZXItPnBhZ2Vjb3VudCwKKwkJCQkJICAgICBzaXplb2YoKmhlbHBlcl9i
dWZmZXItPnBhZ2VzKSwKKwkJCQkJICAgICBHRlBfS0VSTkVMKTsKKwlpZiAoIWhlbHBlcl9idWZm
ZXItPnBhZ2VzKSB7CisJCXJldCA9IC1FTk9NRU07CisJCWdvdG8gZnJlZV9jbWE7CisJfQorCisJ
Zm9yIChwZyA9IDA7IHBnIDwgaGVscGVyX2J1ZmZlci0+cGFnZWNvdW50OyBwZysrKQorCQloZWxw
ZXJfYnVmZmVyLT5wYWdlc1twZ10gPSAmY21hX3BhZ2VzW3BnXTsKKworCS8qIGNyZWF0ZSB0aGUg
ZG1hYnVmICovCisJZG1hYnVmID0gaGVhcF9oZWxwZXJfZXhwb3J0X2RtYWJ1ZihoZWxwZXJfYnVm
ZmVyLCBmZF9mbGFncyk7CisJaWYgKElTX0VSUihkbWFidWYpKSB7CisJCXJldCA9IFBUUl9FUlIo
ZG1hYnVmKTsKKwkJZ290byBmcmVlX3BhZ2VzOworCX0KKworCWhlbHBlcl9idWZmZXItPmRtYWJ1
ZiA9IGRtYWJ1ZjsKKwloZWxwZXJfYnVmZmVyLT5wcml2X3ZpcnQgPSBjbWFfcGFnZXM7CisKKwly
ZXQgPSBkbWFfYnVmX2ZkKGRtYWJ1ZiwgZmRfZmxhZ3MpOworCWlmIChyZXQgPCAwKSB7CisJCWRt
YV9idWZfcHV0KGRtYWJ1Zik7CisJCS8qIGp1c3QgcmV0dXJuLCBhcyBwdXQgd2lsbCBjYWxsIHJl
bGVhc2UgYW5kIHRoYXQgd2lsbCBmcmVlICovCisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJu
IHJldDsKKworZnJlZV9wYWdlczoKKwlrZnJlZShoZWxwZXJfYnVmZmVyLT5wYWdlcyk7CitmcmVl
X2NtYToKKwljbWFfcmVsZWFzZShjbWFfaGVhcC0+Y21hLCBjbWFfcGFnZXMsIG5yX3BhZ2VzKTsK
K2ZyZWVfYnVmOgorCWtmcmVlKGhlbHBlcl9idWZmZXIpOworCXJldHVybiByZXQ7Cit9CisKK3N0
YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2hlYXBfb3BzIGNtYV9oZWFwX29wcyA9IHsKKwkuYWxsb2Nh
dGUgPSBjbWFfaGVhcF9hbGxvY2F0ZSwKK307CisKK3N0YXRpYyBpbnQgX19hZGRfY21hX2hlYXAo
c3RydWN0IGNtYSAqY21hLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBjbWFfaGVhcCAqY21hX2hl
YXA7CisJc3RydWN0IGRtYV9oZWFwX2V4cG9ydF9pbmZvIGV4cF9pbmZvOworCisJY21hX2hlYXAg
PSBremFsbG9jKHNpemVvZigqY21hX2hlYXApLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWNtYV9oZWFw
KQorCQlyZXR1cm4gLUVOT01FTTsKKwljbWFfaGVhcC0+Y21hID0gY21hOworCisJZXhwX2luZm8u
bmFtZSA9IGNtYV9nZXRfbmFtZShjbWEpOworCWV4cF9pbmZvLm9wcyA9ICZjbWFfaGVhcF9vcHM7
CisJZXhwX2luZm8ucHJpdiA9IGNtYV9oZWFwOworCisJY21hX2hlYXAtPmhlYXAgPSBkbWFfaGVh
cF9hZGQoJmV4cF9pbmZvKTsKKwlpZiAoSVNfRVJSKGNtYV9oZWFwLT5oZWFwKSkgeworCQlpbnQg
cmV0ID0gUFRSX0VSUihjbWFfaGVhcC0+aGVhcCk7CisKKwkJa2ZyZWUoY21hX2hlYXApOworCQly
ZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGFkZF9kZWZhdWx0
X2NtYV9oZWFwKHZvaWQpCit7CisJc3RydWN0IGNtYSAqZGVmYXVsdF9jbWEgPSBkZXZfZ2V0X2Nt
YV9hcmVhKE5VTEwpOworCWludCByZXQgPSAwOworCisJaWYgKGRlZmF1bHRfY21hKQorCQlyZXQg
PSBfX2FkZF9jbWFfaGVhcChkZWZhdWx0X2NtYSwgTlVMTCk7CisKKwlyZXR1cm4gcmV0OworfQor
bW9kdWxlX2luaXQoYWRkX2RlZmF1bHRfY21hX2hlYXApOworTU9EVUxFX0RFU0NSSVBUSU9OKCJE
TUEtQlVGIENNQSBIZWFwIik7CitNT0RVTEVfTElDRU5TRSgiR1BMIHYyIik7Ci0tIAoyLjE3LjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZl
bCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbA==
