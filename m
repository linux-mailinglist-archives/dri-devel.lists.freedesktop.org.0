Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7B58A2A485A
	for <lists+dri-devel@lfdr.de>; Tue,  3 Nov 2020 15:37:27 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 82A796E8B3;
	Tue,  3 Nov 2020 14:37:23 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x642.google.com (mail-ej1-x642.google.com
 [IPv6:2a00:1450:4864:20::642])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4E8836E8B3
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Nov 2020 14:37:22 +0000 (UTC)
Received: by mail-ej1-x642.google.com with SMTP id o9so22337124ejg.1
 for <dri-devel@lists.freedesktop.org>; Tue, 03 Nov 2020 06:37:22 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=VbfaDzp+FBPY9PmtolMStfmK+sD2qNP4OjobBh/OrXg=;
 b=uuEuq51MTwp58ULeycve6W48nSJhIGVIfQYh1zOXOXL0l+TzIsEp0Dt0ZKpMB1K8nx
 PArUHd0em3Vr5BqrsXYdpukyvLEbriAQ7Z0foXHt3AOhCq+DM5ZbIdlxIIWtJ37FcxiE
 iZp4pnVc09tFsDwnj4JmLwXcki0ZCOI/PbS9HB9etCxRBdep+KavN9Ibybt2lVa3CQvH
 6HzFrJUMyMDCP5qKn2t/BPec4N5JeYzN3v/rNqqvS+J8JYL/Fv5bZFb8hPyFwA6i7wVk
 jPP3h5gFEi/udJITF0Of9Rvtt7yOFjphehsLAGQypHjWOWmIrJIjntUnNnexoBBEMhV2
 l/7w==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=VbfaDzp+FBPY9PmtolMStfmK+sD2qNP4OjobBh/OrXg=;
 b=XNc0M0TDk97fYn1Tf3ylRK64Aj5ajiUczg+OUXyYQHvHwxOZSCwxZZ5dppSzmFKmCw
 jZRtbkMHHHzfgolQRlBNXboGswJgoSefNIG3M53016gAOF6xdY5K2tKqEBiTABlGcnI2
 4BOiIbxjfM3NpZH9vs16Sy0IuUU49PU3IhHlrsRa6ejcn+jHCa543NM1m089+gon9GoH
 JdseoDG03fvjF5h/vnrPbh6m9OG0ZK3sxXrXwegbWhaEswA4XAkjVh7QU3bO8ODO8yk7
 qyan4z6Jf2WquITk3G4J9fFJZQ4J+zwnJJUbDetPZDDuSs4MU2ZVU8jlGs3mzrzmFzvw
 5OTw==
X-Gm-Message-State: AOAM5313dtL6qTajgLx87WQc/uhkPL8hXY0dBQOdanu8ktYvJnYCOdtf
 blZIKtMD+gFKT+xvSNRrj++/TGEB/mw=
X-Google-Smtp-Source: ABdhPJwUWbY8195GVnTl+ZUvI7AEAI5EDEGuQPQt6BKZCGV2BXFWAlU0ZVuckkLaZ/c863XmUrh2zQ==
X-Received: by 2002:a17:906:c08f:: with SMTP id
 f15mr19746581ejz.97.1604414240642; 
 Tue, 03 Nov 2020 06:37:20 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:f3a2:b920:33f3:da11])
 by smtp.gmail.com with ESMTPSA id cx6sm5518447edb.61.2020.11.03.06.37.19
 for <dri-devel@lists.freedesktop.org>
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 03 Nov 2020 06:37:20 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 1/2] drm/ttm: rework no_retry handling v2
Date: Tue,  3 Nov 2020 15:37:18 +0100
Message-Id: <20201103143719.122868-1-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RHVyaW5nIGV2aWN0aW9uIHdlIGRvIHdhbnQgdG8gdHJpZ2dlciB0aGUgT09NIGtpbGxlci4KCk9u
bHkgd2hpbGUgZG9pbmcgbmV3IGFsbG9jYXRpb25zIHdlIHNob3VsZCB0cnkgdG8gYXZvaWQgdGhh
dCBhbmQKcmV0dXJuIC1FTk9NRU0gdG8gdGhlIGFwcGxpY2F0aW9uLgoKdjI6IHJlbmFtZSB0aGUg
ZmxhZyB0byBnZnBfcmV0cnlfbWF5ZmFpbC4KClNpZ25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7Zu
aWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KUmV2aWV3ZWQtYnk6IERhbmllbCBWZXR0ZXIg
PGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUv
YW1kZ3B1X29iamVjdC5jIHwgMiArKwogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1
X3R0bS5jICAgIHwgMyAtLS0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bvb2wuYyAgICAgICAg
ICAgICB8IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3R0LmMgICAgICAgICAgICAgICB8
IDcgLS0tLS0tLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaCAgICAgICAgICAgICAgIHwg
MiArKwogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19kcml2ZXIuaCAgICAgICAgICAgIHwgMyAtLS0K
IDYgZmlsZXMgY2hhbmdlZCwgNSBpbnNlcnRpb25zKCspLCAxNCBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggMWFhNTE2NDI5Yzgw
Li40ZTlkZmJlYTMxYzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2Ft
ZGdwdV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2Jq
ZWN0LmMKQEAgLTUxNiw2ICs1MTYsOCBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19jcmVhdGUo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IGN0
eCA9IHsKIAkJLmludGVycnVwdGlibGUgPSAoYnAtPnR5cGUgIT0gdHRtX2JvX3R5cGVfa2VybmVs
KSwKIAkJLm5vX3dhaXRfZ3B1ID0gYnAtPm5vX3dhaXRfZ3B1LAorCQkvKiBXZSBvcHQgdG8gYXZv
aWQgT09NIG9uIHN5c3RlbSBwYWdlcyBhbGxvY2F0aW9ucyAqLworCQkuZ2ZwX3JldHJ5X21heWZh
aWwgPSB0cnVlLAogCQkucmVzdiA9IGJwLT5yZXN2LAogCQkuZmxhZ3MgPSBicC0+dHlwZSAhPSB0
dG1fYm9fdHlwZV9rZXJuZWwgPwogCQkJVFRNX09QVF9GTEFHX0FMTE9XX1JFU19FVklDVCA6IDAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwppbmRleCBiZDZlNjY0MWMzZmMu
LmMwMWMwNjBlNGFjNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1k
Z3B1X3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpA
QCAtMTkxNCw5ICsxOTE0LDYgQEAgaW50IGFtZGdwdV90dG1faW5pdChzdHJ1Y3QgYW1kZ3B1X2Rl
dmljZSAqYWRldikKIAl9CiAJYWRldi0+bW1hbi5pbml0aWFsaXplZCA9IHRydWU7CiAKLQkvKiBX
ZSBvcHQgdG8gYXZvaWQgT09NIG9uIHN5c3RlbSBwYWdlcyBhbGxvY2F0aW9ucyAqLwotCWFkZXYt
Pm1tYW4uYmRldi5ub19yZXRyeSA9IHRydWU7Ci0KIAkvKiBJbml0aWFsaXplIFZSQU0gcG9vbCB3
aXRoIGFsbCBvZiBWUkFNIGRpdmlkZWQgaW50byBwYWdlcyAqLwogCXIgPSBhbWRncHVfdnJhbV9t
Z3JfaW5pdChhZGV2KTsKIAlpZiAocikgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCmluZGV4IDFlNTBk
ZWVmYjVkNS4uNDRlYzQxYWE3OGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0
bV9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jCkBAIC0zNjcsNyAr
MzY3LDcgQEAgaW50IHR0bV9wb29sX2FsbG9jKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0
IHR0bV90dCAqdHQsCiAJaWYgKHR0LT5wYWdlX2ZsYWdzICYgVFRNX1BBR0VfRkxBR19aRVJPX0FM
TE9DKQogCQlnZnBfZmxhZ3MgfD0gX19HRlBfWkVSTzsKIAotCWlmICh0dC0+cGFnZV9mbGFncyAm
IFRUTV9QQUdFX0ZMQUdfTk9fUkVUUlkpCisJaWYgKGN0eC0+Z2ZwX3JldHJ5X21heWZhaWwpCiAJ
CWdmcF9mbGFncyB8PSBfX0dGUF9SRVRSWV9NQVlGQUlMOwogCiAJaWYgKHBvb2wtPnVzZV9kbWEz
MikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3R0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vdHRtL3R0bV90dC5jCmluZGV4IDg4NjFhNzRhYzMzNS4uY2ZkNjMzYzdlNzY0IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV90dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS90dG0vdHRtX3R0LmMKQEAgLTUxLDkgKzUxLDYgQEAgaW50IHR0bV90dF9jcmVhdGUoc3RydWN0
IHR0bV9idWZmZXJfb2JqZWN0ICpibywgYm9vbCB6ZXJvX2FsbG9jKQogCWlmIChiby0+dHRtKQog
CQlyZXR1cm4gMDsKIAotCWlmIChiZGV2LT5ub19yZXRyeSkKLQkJcGFnZV9mbGFncyB8PSBUVE1f
UEFHRV9GTEFHX05PX1JFVFJZOwotCiAJc3dpdGNoIChiby0+dHlwZSkgewogCWNhc2UgdHRtX2Jv
X3R5cGVfZGV2aWNlOgogCQlpZiAoemVyb19hbGxvYykKQEAgLTIxMSw4ICsyMDgsNiBAQCBpbnQg
dHRtX3R0X3N3YXBpbihzdHJ1Y3QgdHRtX3R0ICp0dG0pCiAKIAlzd2FwX3NwYWNlID0gc3dhcF9z
dG9yYWdlLT5mX21hcHBpbmc7CiAJZ2ZwX21hc2sgPSBtYXBwaW5nX2dmcF9tYXNrKHN3YXBfc3Bh
Y2UpOwotCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFHX05PX1JFVFJZKQotCQln
ZnBfbWFzayB8PSBfX0dGUF9SRVRSWV9NQVlGQUlMOwogCiAJZm9yIChpID0gMDsgaSA8IHR0bS0+
bnVtX3BhZ2VzOyArK2kpIHsKIAkJZnJvbV9wYWdlID0gc2htZW1fcmVhZF9tYXBwaW5nX3BhZ2Vf
Z2ZwKHN3YXBfc3BhY2UsIGksCkBAIC0yNjAsOCArMjU1LDYgQEAgaW50IHR0bV90dF9zd2Fwb3V0
KHN0cnVjdCB0dG1fYm9fZGV2aWNlICpiZGV2LCBzdHJ1Y3QgdHRtX3R0ICp0dG0pCiAKIAlzd2Fw
X3NwYWNlID0gc3dhcF9zdG9yYWdlLT5mX21hcHBpbmc7CiAJZ2ZwX21hc2sgPSBtYXBwaW5nX2dm
cF9tYXNrKHN3YXBfc3BhY2UpOwotCWlmICh0dG0tPnBhZ2VfZmxhZ3MgJiBUVE1fUEFHRV9GTEFH
X05PX1JFVFJZKQotCQlnZnBfbWFzayB8PSBfX0dGUF9SRVRSWV9NQVlGQUlMOwogCiAJZm9yIChp
ID0gMDsgaSA8IHR0bS0+bnVtX3BhZ2VzOyArK2kpIHsKIAkJZnJvbV9wYWdlID0gdHRtLT5wYWdl
c1tpXTsKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmggYi9pbmNsdWRl
L2RybS90dG0vdHRtX2JvX2FwaS5oCmluZGV4IDM3MTAyZTQ1ZTQ5Ni4uNDYzNzM1N2JhODU2IDEw
MDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2FwaS5oCisrKyBiL2luY2x1ZGUvZHJt
L3R0bS90dG1fYm9fYXBpLmgKQEAgLTE5NSw2ICsxOTUsNyBAQCBzdHJ1Y3QgdHRtX2JvX2ttYXBf
b2JqIHsKICAqCiAgKiBAaW50ZXJydXB0aWJsZTogU2xlZXAgaW50ZXJydXB0aWJsZSBpZiBzbGVl
cGluZy4KICAqIEBub193YWl0X2dwdTogUmV0dXJuIGltbWVkaWF0ZWx5IGlmIHRoZSBHUFUgaXMg
YnVzeS4KKyAqIEBnZnBfcmV0cnlfbWF5ZmFpbDogU2V0IHRoZSBfX0dGUF9SRVRSWV9NQVlGQUlM
IHdoZW4gYWxsb2NhdGlvbiBwYWdlcy4KICAqIEByZXN2OiBSZXNlcnZhdGlvbiBvYmplY3QgdG8g
YWxsb3cgcmVzZXJ2ZWQgZXZpY3Rpb25zIHdpdGguCiAgKiBAZmxhZ3M6IEluY2x1ZGluZyB0aGUg
Zm9sbG93aW5nIGZsYWdzCiAgKgpAQCAtMjA0LDYgKzIwNSw3IEBAIHN0cnVjdCB0dG1fYm9fa21h
cF9vYmogewogc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4IHsKIAlib29sIGludGVycnVwdGlibGU7
CiAJYm9vbCBub193YWl0X2dwdTsKKwlib29sIGdmcF9yZXRyeV9tYXlmYWlsOwogCXN0cnVjdCBk
bWFfcmVzdiAqcmVzdjsKIAl1aW50NjRfdCBieXRlc19tb3ZlZDsKIAl1aW50MzJfdCBmbGFnczsK
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggYi9pbmNsdWRlL2Ry
bS90dG0vdHRtX2JvX2RyaXZlci5oCmluZGV4IGU5ZjY4M2ZhNzJkYy4uZGE4MjA4ZjQzMzc4IDEw
MDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCisrKyBiL2luY2x1ZGUv
ZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKQEAgLTI3Niw3ICsyNzYsNiBAQCBleHRlcm4gc3RydWN0
IHR0bV9ib19nbG9iYWwgewogICogQGRldl9tYXBwaW5nOiBBIHBvaW50ZXIgdG8gdGhlIHN0cnVj
dCBhZGRyZXNzX3NwYWNlIHJlcHJlc2VudGluZyB0aGUKICAqIGRldmljZSBhZGRyZXNzIHNwYWNl
LgogICogQHdxOiBXb3JrIHF1ZXVlIHN0cnVjdHVyZSBmb3IgdGhlIGRlbGF5ZWQgZGVsZXRlIHdv
cmtxdWV1ZS4KLSAqIEBub19yZXRyeTogRG9uJ3QgcmV0cnkgYWxsb2NhdGlvbiBpZiBpdCBmYWls
cwogICoKICAqLwogCkBAIC0zMTQsOCArMzEzLDYgQEAgc3RydWN0IHR0bV9ib19kZXZpY2Ugewog
CSAqLwogCiAJc3RydWN0IGRlbGF5ZWRfd29yayB3cTsKLQotCWJvb2wgbm9fcmV0cnk7CiB9Owog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCB0dG1fcmVzb3VyY2VfbWFuYWdlciAqdHRtX21hbmFnZXJf
dHlwZShzdHJ1Y3QgdHRtX2JvX2RldmljZSAqYmRldiwKLS0gCjIuMjUuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlz
dApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
