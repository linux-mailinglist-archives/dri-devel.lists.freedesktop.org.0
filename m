Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F37E5910E2
	for <lists+dri-devel@lfdr.de>; Sat, 17 Aug 2019 16:48:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1A1F06E4F1;
	Sat, 17 Aug 2019 14:47:52 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DEE356E4F1;
 Sat, 17 Aug 2019 14:47:49 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18173482-1500050 
 for multiple; Sat, 17 Aug 2019 15:47:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 6/6] dma-fence: Store the timestamp in the same union as the
 cb_list
Date: Sat, 17 Aug 2019 15:47:36 +0100
Message-Id: <20190817144736.7826-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190817144736.7826-1-chris@chris-wilson.co.uk>
References: <20190817144736.7826-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org, christian.koenig@amd.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhlIHRpbWVzdGFtcCBhbmQgdGhlIGNiX2xpc3QgYXJlIG11dHVhbGx5IGV4Y2x1c2l2ZSwgdGhl
IGNiX2xpc3QgY2FuCm9ubHkgYmUgYWRkZWQgdG8gcHJpb3IgdG8gYmVpbmcgc2lnbmFsZWQgKGFu
ZCBvbmNlIHNpZ25hbGVkIHdlIGRyYWluKSwKd2hpbGUgdGhlIHRpbWVzdGFtcCBpcyBvbmx5IHZh
bGlkIHVwb24gYmVpbmcgc2lnbmFsZWQuIEJvdGggdGhlCnRpbWVzdGFtcCBhbmQgdGhlIGNiX2xp
c3QgYXJlIG9ubHkgdmFsaWQgd2hpbGUgdGhlIGZlbmNlIGlzIGFsaXZlLCBhbmQKYXMgc29vbiBh
cyBubyByZWZlcmVuY2VzIGFyZSBoZWxkIGNhbiBiZSByZXBsYWNlZCBieSB0aGUgcmN1X2hlYWQu
CgpCeSByZXVzaW5nIHRoZSB1bmlvbiBmb3IgdGhlIHRpbWVzdGFtcCwgd2Ugc3F1ZWV6ZSB0aGUg
YmFzZSBkbWFfZmVuY2UKc3RydWN0IHRvIDY0IGJ5dGVzIG9uIHg4Ni02NC4KClN1Z2dlc3RlZC1i
eTogQ2hyaXN0aWFuIEvDtm5pZyA8Y2hyaXN0aWFuLmtvZW5pZ0BhbWQuY29tPgpTaWduZWQtb2Zm
LWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IENocmlzdGlh
biBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4KLS0tCiBkcml2ZXJzL2RtYS1idWYv
ZG1hLWZlbmNlLmMgICAgICAgICAgICAgICAgIHwgMTYgKysrKysrKysrLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYyB8IDEzICsrKysrKystLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2ZlbmNlLmMgICAgICAgfCAgMyArKysKIGlu
Y2x1ZGUvbGludXgvZG1hLWZlbmNlLmggICAgICAgICAgICAgICAgICAgfCAxNyArKysrKysrKysr
KysrLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAzMiBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMgYi9kcml2ZXJzL2Rt
YS1idWYvZG1hLWZlbmNlLmMKaW5kZXggODlkOTZlM2U2ZGY2Li4yYzIxMTE1YjFhMzcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYworKysgYi9kcml2ZXJzL2RtYS1idWYv
ZG1hLWZlbmNlLmMKQEAgLTEyOSw2ICsxMjksNyBAQCBFWFBPUlRfU1lNQk9MKGRtYV9mZW5jZV9j
b250ZXh0X2FsbG9jKTsKIGludCBkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZChzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZSkKIHsKIAlzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjdXIsICp0bXA7CisJc3RydWN0
IGxpc3RfaGVhZCBjYl9saXN0OwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZChmZW5jZS0+bG9jayk7
CiAKQEAgLTEzNiwxNiArMTM3LDE2IEBAIGludCBkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZChzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIAkJCQkgICAgICAmZmVuY2UtPmZsYWdzKSkpCiAJCXJldHVy
biAtRUlOVkFMOwogCisJLyogU3Rhc2ggdGhlIGNiX2xpc3QgYmVmb3JlIHJlcGxhY2luZyBpdCB3
aXRoIHRoZSB0aW1lc3RhbXAgKi8KKwlsaXN0X3JlcGxhY2UoJmZlbmNlLT5jYl9saXN0LCAmY2Jf
bGlzdCk7CisKIAlmZW5jZS0+dGltZXN0YW1wID0ga3RpbWVfZ2V0KCk7CiAJc2V0X2JpdChETUFf
RkVOQ0VfRkxBR19USU1FU1RBTVBfQklULCAmZmVuY2UtPmZsYWdzKTsKIAl0cmFjZV9kbWFfZmVu
Y2Vfc2lnbmFsZWQoZmVuY2UpOwogCi0JaWYgKCFsaXN0X2VtcHR5KCZmZW5jZS0+Y2JfbGlzdCkp
IHsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2UtPmNiX2xpc3Qs
IG5vZGUpIHsKLQkJCUlOSVRfTElTVF9IRUFEKCZjdXItPm5vZGUpOwotCQkJY3VyLT5mdW5jKGZl
bmNlLCBjdXIpOwotCQl9Ci0JCUlOSVRfTElTVF9IRUFEKCZmZW5jZS0+Y2JfbGlzdCk7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN1ciwgdG1wLCAmY2JfbGlzdCwgbm9kZSkgeworCQlJTklU
X0xJU1RfSEVBRCgmY3VyLT5ub2RlKTsKKwkJY3VyLT5mdW5jKGZlbmNlLCBjdXIpOwogCX0KIAog
CXJldHVybiAwOwpAQCAtMjM0LDcgKzIzNSw4IEBAIHZvaWQgZG1hX2ZlbmNlX3JlbGVhc2Uoc3Ry
dWN0IGtyZWYgKmtyZWYpCiAKIAl0cmFjZV9kbWFfZmVuY2VfZGVzdHJveShmZW5jZSk7CiAKLQlp
ZiAoV0FSTighbGlzdF9lbXB0eSgmZmVuY2UtPmNiX2xpc3QpLAorCWlmIChXQVJOKCFsaXN0X2Vt
cHR5KCZmZW5jZS0+Y2JfbGlzdCkgJiYKKwkJICF0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdO
QUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpLAogCQkgIkZlbmNlICVzOiVzOiVsbHg6JWxseCByZWxl
YXNlZCB3aXRoIHBlbmRpbmcgc2lnbmFscyFcbiIsCiAJCSBmZW5jZS0+b3BzLT5nZXRfZHJpdmVy
X25hbWUoZmVuY2UpLAogCQkgZmVuY2UtPm9wcy0+Z2V0X3RpbWVsaW5lX25hbWUoZmVuY2UpLApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMKaW5kZXggMmJjOWM0
NjBlNzhkLi4wOWM2OGRkYTIwOTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2JyZWFkY3J1bWJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
YnJlYWRjcnVtYnMuYwpAQCAtMTE0LDE4ICsxMTQsMTggQEAgX19kbWFfZmVuY2Vfc2lnbmFsX190
aW1lc3RhbXAoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIGt0aW1lX3QgdGltZXN0YW1wKQogfQog
CiBzdGF0aWMgdm9pZAotX19kbWFfZmVuY2Vfc2lnbmFsX19ub3RpZnkoc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpCitfX2RtYV9mZW5jZV9zaWduYWxfX25vdGlmeShzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZSwKKwkJCSAgIGNvbnN0IHN0cnVjdCBsaXN0X2hlYWQgKmxpc3QpCiB7CiAJc3RydWN0IGRt
YV9mZW5jZV9jYiAqY3VyLCAqdG1wOwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZChmZW5jZS0+bG9j
ayk7CiAJbG9ja2RlcF9hc3NlcnRfaXJxc19kaXNhYmxlZCgpOwogCi0JbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGN1ciwgdG1wLCAmZmVuY2UtPmNiX2xpc3QsIG5vZGUpIHsKKwlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUoY3VyLCB0bXAsIGxpc3QsIG5vZGUpIHsKIAkJSU5JVF9MSVNUX0hFQUQo
JmN1ci0+bm9kZSk7CiAJCWN1ci0+ZnVuYyhmZW5jZSwgY3VyKTsKIAl9Ci0JSU5JVF9MSVNUX0hF
QUQoJmZlbmNlLT5jYl9saXN0KTsKIH0KIAogdm9pZCBpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNf
aXJxKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTE4NywxMSArMTg3LDEyIEBA
IHZvaWQgaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiAJbGlzdF9mb3JfZWFjaF9zYWZlKHBvcywgbmV4dCwgJnNpZ25hbCkgewogCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9CiAJCQlsaXN0X2VudHJ5KHBvcywgdHlwZW9mKCpycSks
IHNpZ25hbF9saW5rKTsKLQotCQlfX2RtYV9mZW5jZV9zaWduYWxfX3RpbWVzdGFtcCgmcnEtPmZl
bmNlLCB0aW1lc3RhbXApOworCQlzdHJ1Y3QgbGlzdF9oZWFkIGNiX2xpc3Q7CiAKIAkJc3Bpbl9s
b2NrKCZycS0+bG9jayk7Ci0JCV9fZG1hX2ZlbmNlX3NpZ25hbF9fbm90aWZ5KCZycS0+ZmVuY2Up
OworCQlsaXN0X3JlcGxhY2UoJnJxLT5mZW5jZS5jYl9saXN0LCAmY2JfbGlzdCk7CisJCV9fZG1h
X2ZlbmNlX3NpZ25hbF9fdGltZXN0YW1wKCZycS0+ZmVuY2UsIHRpbWVzdGFtcCk7CisJCV9fZG1h
X2ZlbmNlX3NpZ25hbF9fbm90aWZ5KCZycS0+ZmVuY2UsICZjYl9saXN0KTsKIAkJc3Bpbl91bmxv
Y2soJnJxLT5sb2NrKTsKIAogCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdm13
Z2Z4L3Ztd2dmeF9mZW5jZS5jCmluZGV4IDQzNGRmYWRiMGU1Mi4uMTc4YTZjZDFhMDZmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9mZW5jZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2ZlbmNlLmMKQEAgLTE4NSw2ICsxODUsOSBAQCBzdGF0
aWMgbG9uZyB2bXdfZmVuY2Vfd2FpdChzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBib29sIGludHIsIHNp
Z25lZCBsb25nIHRpbWVvdXQpCiAKIAlzcGluX2xvY2soZi0+bG9jayk7CiAKKwlpZiAodGVzdF9i
aXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZi0+ZmxhZ3MpKQorCQlnb3RvIG91dDsK
KwogCWlmIChpbnRyICYmIHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKSB7CiAJCXJldCA9IC1FUkVT
VEFSVFNZUzsKIAkJZ290byBvdXQ7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1mZW5j
ZS5oIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaAppbmRleCAyY2U0ZDg3N2QzM2UuLjZjMzY1
MDJhMDU2MiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaAorKysgYi9pbmNs
dWRlL2xpbnV4L2RtYS1mZW5jZS5oCkBAIC02NSwxNyArNjUsMjYgQEAgc3RydWN0IGRtYV9mZW5j
ZV9jYjsKIHN0cnVjdCBkbWFfZmVuY2UgewogCXNwaW5sb2NrX3QgKmxvY2s7CiAJY29uc3Qgc3Ry
dWN0IGRtYV9mZW5jZV9vcHMgKm9wczsKLQkvKiBXZSBjbGVhciB0aGUgY2FsbGJhY2sgbGlzdCBv
biBrcmVmX3B1dCBzbyB0aGF0IGJ5IHRoZSB0aW1lIHdlCi0JICogcmVsZWFzZSB0aGUgZmVuY2Ug
aXQgaXMgdW51c2VkLiBObyBvbmUgc2hvdWxkIGJlIGFkZGluZyB0byB0aGUgY2JfbGlzdAotCSAq
IHRoYXQgdGhleSBkb24ndCB0aGVtc2VsdmVzIGhvbGQgYSByZWZlcmVuY2UgZm9yLgorCS8qCisJ
ICogV2UgY2xlYXIgdGhlIGNhbGxiYWNrIGxpc3Qgb24ga3JlZl9wdXQgc28gdGhhdCBieSB0aGUg
dGltZSB3ZQorCSAqIHJlbGVhc2UgdGhlIGZlbmNlIGl0IGlzIHVudXNlZC4gTm8gb25lIHNob3Vs
ZCBiZSBhZGRpbmcgdG8gdGhlCisJICogY2JfbGlzdCB0aGF0IHRoZXkgZG9uJ3QgdGhlbXNlbHZl
cyBob2xkIGEgcmVmZXJlbmNlIGZvci4KKwkgKgorCSAqIFRoZSBsaWZldGltZSBvZiB0aGUgdGlt
ZXN0YW1wIGlzIHNpbWlsYXJseSB0aWVkIHRvIGJvdGggdGhlCisJICogcmN1IGZyZWVsaXN0IGFu
ZCB0aGUgY2JfbGlzdC4gVGhlIHRpbWVzdGFtcCBpcyBvbmx5IHNldCB1cG9uCisJICogc2lnbmFs
aW5nIHdoaWxlIHNpbXVsdGFuZW91c2x5IG5vdGlmeWluZyB0aGUgY2JfbGlzdC4gRXJnbywgd2UK
KwkgKiBvbmx5IHVzZSBlaXRoZXIgdGhlIGNiX2xpc3Qgb2YgdGltZXN0YW1wLiBVcG9uIGRlc3Ry
dWN0aW9uLAorCSAqIG5laXRoZXIgYXJlIGFjY2Vzc2libGUsIGFuZCBzbyB3ZSBjYW4gdXNlIHRo
ZSByY3UuIFRoaXMgbWVhbnMKKwkgKiB0aGF0IHRoZSBjYl9saXN0IGlzICpvbmx5KiB2YWxpZCB1
bnRpbCB0aGUgc2lnbmFsIGJpdCBpcyBzZXQsCisJICogYW5kIHRvIHJlYWQgZWl0aGVyIHlvdSAq
bXVzdCogaG9sZCBhIHJlZmVyZW5jZSB0byB0aGUgZmVuY2UuCiAJICovCiAJdW5pb24gewogCQlz
dHJ1Y3QgcmN1X2hlYWQgcmN1OwogCQlzdHJ1Y3QgbGlzdF9oZWFkIGNiX2xpc3Q7CisJCWt0aW1l
X3QgdGltZXN0YW1wOwogCX07CiAJdTY0IGNvbnRleHQ7CiAJdTY0IHNlcW5vOwotCWt0aW1lX3Qg
dGltZXN0YW1wOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAJc3RydWN0IGtyZWYgcmVmY291bnQ7
CiAJaW50IGVycm9yOwotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vZHJpLWRldmVs
