Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id EC773278B63
	for <lists+dri-devel@lfdr.de>; Fri, 25 Sep 2020 16:55:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 10A356ED17;
	Fri, 25 Sep 2020 14:55:54 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x644.google.com (mail-ej1-x644.google.com
 [IPv6:2a00:1450:4864:20::644])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 747566ED1A
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Sep 2020 14:55:45 +0000 (UTC)
Received: by mail-ej1-x644.google.com with SMTP id u21so4069022eja.2
 for <dri-devel@lists.freedesktop.org>; Fri, 25 Sep 2020 07:55:45 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:subject:date:message-id:in-reply-to:references:mime-version
 :content-transfer-encoding;
 bh=hCXON3LhnqU/BuprPE0EiHaHyXPorZdCNcmL4yZGhtQ=;
 b=cm1t9ADu/rzzMZBAkEqUN9xTHWhwKIEA0OZ1t2wqlrYrBcsi8e3jm05HcB2CYpYkWC
 z1eZltlzNUYAnoJbhIJGXbfWSDa7LDtWDfh1MFABmJebIP/IGlMANlj4aEv8l6I0Pr8h
 zm2zMm2Y+i//xumkkpeYQ0z2PDkG2QiPv6W7o/Q7YXeSVuG17Nzkil2C26I8pvKPQYIg
 mXhYMvs7ixnsTtdltoxV9ee3RT1CiN0O5V+5/l+ZXmvD+rYhu5ruVTzWtAzn/2qKYKYs
 2FUSRX1ejbaBTGs0MdnH0QCaHnCVb7zhLO1wlPBVc0TUQwctCPyjf/4+WRGwZ5VCxuUb
 uMTA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=hCXON3LhnqU/BuprPE0EiHaHyXPorZdCNcmL4yZGhtQ=;
 b=Z9qvoOsMXJzDPASqRXEmQJw80xSPGOhf6KHgnNCe3/Hc1EV+JXzBDsRZkSKlu3OkzH
 XQxhgD5vupov4nwEmJPhrhI3FXO8aM9ZevPV2MdrcrLHCYI57WuOtXhYvmKmp7sa2/Sq
 oHzB7U9w/VMIyB9ZVvRSRxIT/5fnE6tndA+0soqF2nb2xuIc3Bmupm6jDE8/2CnBnoQz
 bAroRSOg50yBJrYlCISj/T9Pq17bhFqNSsnYl9CRHMHoq4w6IZauDFZLJ6ekH/2W1e6L
 GDjiu0OKYdP2LUC9eBlTxSzTfaA/NGWP+1EbEJs1ci1OxjL6UPkmb3IX4afCZ+NsPJem
 XwnA==
X-Gm-Message-State: AOAM531H7mX95fykQCT1YSBWYOzQWDvD3iX/r2w5fQLKXvzSmeAgBmrc
 8jH91sU57jUD4+F2Ln1grYDqKNJvhlc=
X-Google-Smtp-Source: ABdhPJyq4gxpAG7/vHQ68yvitm0KGiQ3mxbfDAgOPzAEPW8KdYu3yS47WmWJb6QfuvpKIvsWrnSNmQ==
X-Received: by 2002:a17:906:fa8a:: with SMTP id
 lt10mr3073964ejb.307.1601045743777; 
 Fri, 25 Sep 2020 07:55:43 -0700 (PDT)
Received: from abel.fritz.box ([2a02:908:1252:fb60:c75e:403f:87d4:6d00])
 by smtp.gmail.com with ESMTPSA id lo25sm2029990ejb.53.2020.09.25.07.55.42
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Fri, 25 Sep 2020 07:55:43 -0700 (PDT)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org,
	ray.huang@amd.com,
	airlied@redhat.com
Subject: [PATCH 3/5] drm/amdgpu: stop using TTMs fault callback
Date: Fri, 25 Sep 2020 16:55:38 +0200
Message-Id: <20200925145540.1214-3-christian.koenig@amd.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20200925145540.1214-1-christian.koenig@amd.com>
References: <20200925145540.1214-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

SW1wbGVtZW50IHRoZSBmYXVsdCBoYW5kbGVyIG91cnNlbGYgdXNpbmcgdGhlIHByb3ZpZGVkIFRU
TSBmdW5jdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gS8O2bmlnIDxjaHJpc3RpYW4u
a29lbmlnQGFtZC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29i
amVjdC5jIHwgMjAgKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdw
dV9vYmplY3QuaCB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfdHRt
LmMgICAgfCA0MCArKysrKysrKysrKysrKysrKysrLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDQ2IGlu
c2VydGlvbnMoKyksIDE2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9vYmplY3QuYwppbmRleCA2M2U5YzU3OTNjMzAuLjgwYmM3MTc3Y2Q0NSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwpAQCAtMTM0MSwxOSArMTM0
MSwxNCBAQCB2b2lkIGFtZGdwdV9ib19yZWxlYXNlX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvKQogICogUmV0dXJuczoKICAqIDAgZm9yIHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBl
cnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KLWludCBhbWRncHVfYm9fZmF1bHRfcmVzZXJ2ZV9u
b3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKK3ZtX2ZhdWx0X3QgYW1kZ3B1X2Jv
X2ZhdWx0X3Jlc2VydmVfbm90aWZ5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pCiB7CiAJ
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYgPSBhbWRncHVfdHRtX2FkZXYoYm8tPmJkZXYpOwog
CXN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCBjdHggPSB7IGZhbHNlLCBmYWxzZSB9OwotCXN0cnVj
dCBhbWRncHVfYm8gKmFibzsKKwlzdHJ1Y3QgYW1kZ3B1X2JvICphYm8gPSB0dG1fdG9fYW1kZ3B1
X2JvKGJvKTsKIAl1bnNpZ25lZCBsb25nIG9mZnNldCwgc2l6ZTsKIAlpbnQgcjsKIAotCWlmICgh
YW1kZ3B1X2JvX2lzX2FtZGdwdV9ibyhibykpCi0JCXJldHVybiAwOwotCi0JYWJvID0gdHRtX3Rv
X2FtZGdwdV9ibyhibyk7Ci0KIAkvKiBSZW1lbWJlciB0aGF0IHRoaXMgQk8gd2FzIGFjY2Vzc2Vk
IGJ5IHRoZSBDUFUgKi8KIAlhYm8tPmZsYWdzIHw9IEFNREdQVV9HRU1fQ1JFQVRFX0NQVV9BQ0NF
U1NfUkVRVUlSRUQ7CiAKQEAgLTEzNjcsNyArMTM2Miw3IEBAIGludCBhbWRncHVfYm9fZmF1bHRf
cmVzZXJ2ZV9ub3RpZnkoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpibykKIAogCS8qIENhbid0
IG1vdmUgYSBwaW5uZWQgQk8gdG8gdmlzaWJsZSBWUkFNICovCiAJaWYgKGFiby0+dGJvLnBpbl9j
b3VudCA+IDApCi0JCXJldHVybiAtRUlOVkFMOworCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOwog
CiAJLyogaHVycmFoIHRoZSBtZW1vcnkgaXMgbm90IHZpc2libGUgISAqLwogCWF0b21pYzY0X2lu
YygmYWRldi0+bnVtX3ZyYW1fY3B1X3BhZ2VfZmF1bHRzKTsKQEAgLTEzNzksMTUgKzEzNzQsMTgg
QEAgaW50IGFtZGdwdV9ib19mYXVsdF9yZXNlcnZlX25vdGlmeShzdHJ1Y3QgdHRtX2J1ZmZlcl9v
YmplY3QgKmJvKQogCWFiby0+cGxhY2VtZW50LmJ1c3lfcGxhY2VtZW50ID0gJmFiby0+cGxhY2Vt
ZW50c1sxXTsKIAogCXIgPSB0dG1fYm9fdmFsaWRhdGUoYm8sICZhYm8tPnBsYWNlbWVudCwgJmN0
eCk7Ci0JaWYgKHVubGlrZWx5KHIgIT0gMCkpCi0JCXJldHVybiByOworCWlmICh1bmxpa2VseShy
ID09IC1FQlVTWSB8fCByID09IC1FUkVTVEFSVFNZUykpCisJCXJldHVybiBWTV9GQVVMVF9OT1BB
R0U7CisJZWxzZSBpZiAodW5saWtlbHkocikpCisJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CiAK
IAlvZmZzZXQgPSBiby0+bWVtLnN0YXJ0IDw8IFBBR0VfU0hJRlQ7CiAJLyogdGhpcyBzaG91bGQg
bmV2ZXIgaGFwcGVuICovCiAJaWYgKGJvLT5tZW0ubWVtX3R5cGUgPT0gVFRNX1BMX1ZSQU0gJiYK
IAkgICAgKG9mZnNldCArIHNpemUpID4gYWRldi0+Z21jLnZpc2libGVfdnJhbV9zaXplKQotCQly
ZXR1cm4gLUVJTlZBTDsKKwkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKIAorCXR0bV9ib19tb3Zl
X3RvX2xydV90YWlsX3VubG9ja2VkKGJvKTsKIAlyZXR1cm4gMDsKIH0KIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oIGIvZHJpdmVycy9ncHUv
ZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCmluZGV4IGU5MTc1MGU0MzQ0OC4uMTMyZTVm
OTU1MTgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2Jq
ZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X29iamVjdC5oCkBA
IC0yODQsNyArMjg0LDcgQEAgdm9pZCBhbWRncHVfYm9fbW92ZV9ub3RpZnkoc3RydWN0IHR0bV9i
dWZmZXJfb2JqZWN0ICpibywKIAkJCSAgIGJvb2wgZXZpY3QsCiAJCQkgICBzdHJ1Y3QgdHRtX3Jl
c291cmNlICpuZXdfbWVtKTsKIHZvaWQgYW1kZ3B1X2JvX3JlbGVhc2Vfbm90aWZ5KHN0cnVjdCB0
dG1fYnVmZmVyX29iamVjdCAqYm8pOwotaW50IGFtZGdwdV9ib19mYXVsdF9yZXNlcnZlX25vdGlm
eShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKTsKK3ZtX2ZhdWx0X3QgYW1kZ3B1X2JvX2Zh
dWx0X3Jlc2VydmVfbm90aWZ5KHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8pOwogdm9pZCBh
bWRncHVfYm9fZmVuY2Uoc3RydWN0IGFtZGdwdV9ibyAqYm8sIHN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlLAogCQkgICAgIGJvb2wgc2hhcmVkKTsKIGludCBhbWRncHVfYm9fc3luY193YWl0X3Jlc3Yo
c3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsIHN0cnVjdCBkbWFfcmVzdiAqcmVzdiwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwppbmRleCBkM2JkMmZkNDQ4YmUuLjM5OTk2
MTAzNWFlNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X3R0
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV90dG0uYwpAQCAtMTcw
OCw3ICsxNzA4LDYgQEAgc3RhdGljIHN0cnVjdCB0dG1fYm9fZHJpdmVyIGFtZGdwdV9ib19kcml2
ZXIgPSB7CiAJLnZlcmlmeV9hY2Nlc3MgPSAmYW1kZ3B1X3ZlcmlmeV9hY2Nlc3MsCiAJLm1vdmVf
bm90aWZ5ID0gJmFtZGdwdV9ib19tb3ZlX25vdGlmeSwKIAkucmVsZWFzZV9ub3RpZnkgPSAmYW1k
Z3B1X2JvX3JlbGVhc2Vfbm90aWZ5LAotCS5mYXVsdF9yZXNlcnZlX25vdGlmeSA9ICZhbWRncHVf
Ym9fZmF1bHRfcmVzZXJ2ZV9ub3RpZnksCiAJLmlvX21lbV9yZXNlcnZlID0gJmFtZGdwdV90dG1f
aW9fbWVtX3Jlc2VydmUsCiAJLmlvX21lbV9wZm4gPSBhbWRncHVfdHRtX2lvX21lbV9wZm4sCiAJ
LmFjY2Vzc19tZW1vcnkgPSAmYW1kZ3B1X3R0bV9hY2Nlc3NfbWVtb3J5LApAQCAtMjA4OCwxNSAr
MjA4Nyw0OCBAQCB2b2lkIGFtZGdwdV90dG1fc2V0X2J1ZmZlcl9mdW5jc19zdGF0dXMoc3RydWN0
IGFtZGdwdV9kZXZpY2UgKmFkZXYsIGJvb2wgZW5hYmxlKQogCWFkZXYtPm1tYW4uYnVmZmVyX2Z1
bmNzX2VuYWJsZWQgPSBlbmFibGU7CiB9CiAKK3N0YXRpYyB2bV9mYXVsdF90IGFtZGdwdV90dG1f
ZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCit7CisJc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0
ICpibyA9IHZtZi0+dm1hLT52bV9wcml2YXRlX2RhdGE7CisJdm1fZmF1bHRfdCByZXQ7CisKKwly
ZXQgPSB0dG1fYm9fdm1fcmVzZXJ2ZShibywgdm1mKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCisJcmV0ID0gYW1kZ3B1X2JvX2ZhdWx0X3Jlc2VydmVfbm90aWZ5KGJvKTsKKwlpZiAocmV0
KQorCQlnb3RvIHVubG9jazsKKworCXJldCA9IHR0bV9ib192bV9mYXVsdF9yZXNlcnZlZCh2bWYs
IHZtZi0+dm1hLT52bV9wYWdlX3Byb3QsCisJCQkJICAgICAgIFRUTV9CT19WTV9OVU1fUFJFRkFV
TFQsIDEpOworCWlmIChyZXQgPT0gVk1fRkFVTFRfUkVUUlkgJiYgISh2bWYtPmZsYWdzICYgRkFV
TFRfRkxBR19SRVRSWV9OT1dBSVQpKQorCQlyZXR1cm4gcmV0OworCit1bmxvY2s6CisJZG1hX3Jl
c3ZfdW5sb2NrKGJvLT5iYXNlLnJlc3YpOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBzdHJ1
Y3Qgdm1fb3BlcmF0aW9uc19zdHJ1Y3QgYW1kZ3B1X3R0bV92bV9vcHMgPSB7CisJLmZhdWx0ID0g
YW1kZ3B1X3R0bV9mYXVsdCwKKwkub3BlbiA9IHR0bV9ib192bV9vcGVuLAorCS5jbG9zZSA9IHR0
bV9ib192bV9jbG9zZSwKKwkuYWNjZXNzID0gdHRtX2JvX3ZtX2FjY2VzcworfTsKKwogaW50IGFt
ZGdwdV9tbWFwKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSkK
IHsKIAlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKIAlz
dHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiA9IGRybV90b19hZGV2KGZpbGVfcHJpdi0+bWlub3It
PmRldik7CisJaW50IHI7CiAKLQlpZiAoYWRldiA9PSBOVUxMKQotCQlyZXR1cm4gLUVJTlZBTDsK
KwlyID0gdHRtX2JvX21tYXAoZmlscCwgdm1hLCAmYWRldi0+bW1hbi5iZGV2KTsKKwlpZiAodW5s
aWtlbHkociAhPSAwKSkKKwkJcmV0dXJuIHI7CiAKLQlyZXR1cm4gdHRtX2JvX21tYXAoZmlscCwg
dm1hLCAmYWRldi0+bW1hbi5iZGV2KTsKKwl2bWEtPnZtX29wcyA9ICZhbWRncHVfdHRtX3ZtX29w
czsKKwlyZXR1cm4gMDsKIH0KIAogaW50IGFtZGdwdV9jb3B5X2J1ZmZlcihzdHJ1Y3QgYW1kZ3B1
X3JpbmcgKnJpbmcsIHVpbnQ2NF90IHNyY19vZmZzZXQsCi0tIAoyLjE3LjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxp
c3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1kZXZlbAo=
