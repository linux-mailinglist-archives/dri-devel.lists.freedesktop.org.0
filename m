Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 68E89313355
	for <lists+dri-devel@lfdr.de>; Mon,  8 Feb 2021 14:32:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E16416E8CE;
	Mon,  8 Feb 2021 13:32:32 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-ej1-x62b.google.com (mail-ej1-x62b.google.com
 [IPv6:2a00:1450:4864:20::62b])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BA29D6E8CE
 for <dri-devel@lists.freedesktop.org>; Mon,  8 Feb 2021 13:32:31 +0000 (UTC)
Received: by mail-ej1-x62b.google.com with SMTP id l25so7376160eja.9
 for <dri-devel@lists.freedesktop.org>; Mon, 08 Feb 2021 05:32:31 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=gmail.com; s=20161025;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=UaAwArSjEqd7OAf53fharTdi55beIAmLY27edTgEnkA=;
 b=N69Rx6RU3bh258n4zbY22/+hjA4U55cpDYWqWlGg12MzbqqJ2aGUJAN3oTLg6Q0lyA
 xZ3fEPL0PbPemy2KHCDOwCZe5weRwQGhcLp5Y4qyaBr2Sv9DQ2Z9Y+uO+ZZRaoWSoa0i
 YFZTp2LBNXSmjBPq4jU2s8iYGcq0tQ1Z0qovZJKfuRfrCdGPNeTQBhRsz5oq4cdxS16z
 kMPtFouIJbDq3lZBjL+OxOeqeun7n8l4C1KGWu5KObv4E4WnKJNpNKkVZT+S1Xtuvzez
 7knCBIX79UbsJRwzw8s77nPQyZJKCE+vzPwXX2ciLsItNPYOGY+AYjxSiGCPXqWFv1yE
 v31g==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=UaAwArSjEqd7OAf53fharTdi55beIAmLY27edTgEnkA=;
 b=Yk1d9cCtquy8VGNRktWFhOSF+bmRsAf0W37jOeaO0K1hFwC0mI5JK/8kUfliNUuy35
 JAg4f+EUhpiktl/fdV31Tm+/8LLiuHu6nkPUH3mou/eHn/rRXNTE+JTGEPm6O7SV3TtJ
 OISq/09Ts6YDZ7XggZ3/Perfui9GF9agc1/FbV+KgwA3MaA9zSDbaNa6L2K9FqZmSfVO
 EkoD6nL6wi8arf0ROX1kWj0BP9TKv+gTOCSI8kQr7yxiITX8BPeRsZHLrddDA9SRhIQQ
 HqZXBf9md7RYT1lzxcU3ucCVaraGzHgNnGFxFFVdD0OHxicJKmus5J8TT8/qxPUgvni2
 BrZA==
X-Gm-Message-State: AOAM530a4lnLkIrX+fSmxS4b2giwgumRheXVgLBwp5hFa1xzuViaRGfs
 3120tNMPN7a7KEdSjJNHytBeB4urSBk=
X-Google-Smtp-Source: ABdhPJzEAcjie0ShGgNbrOhTJ0sNZktOUqPNcMa2PLW7o8xx/BDnP6rMXku7Fpl1uM4sNjfWrdNeoA==
X-Received: by 2002:a17:906:3a13:: with SMTP id
 z19mr17346088eje.317.1612791150225; 
 Mon, 08 Feb 2021 05:32:30 -0800 (PST)
Received: from abel.fritz.box ([2a02:908:1252:fb60:bf9b:351a:7897:6249])
 by smtp.gmail.com with ESMTPSA id bm9sm8677807ejb.14.2021.02.08.05.32.29
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Mon, 08 Feb 2021 05:32:29 -0800 (PST)
From: "=?UTF-8?q?Christian=20K=C3=B6nig?=" <ckoenig.leichtzumerken@gmail.com>
X-Google-Original-From: =?UTF-8?q?Christian=20K=C3=B6nig?=
 <christian.koenig@amd.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 2/3] drm/ttm: move memory accounting into vmwgfx v4
Date: Mon,  8 Feb 2021 14:32:25 +0100
Message-Id: <20210208133226.36955-2-christian.koenig@amd.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210208133226.36955-1-christian.koenig@amd.com>
References: <20210208133226.36955-1-christian.koenig@amd.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: linux-graphics-maintainer@vmware.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VGhpcyBpcyBqdXN0IGFub3RoZXIgZmVhdHVyZSB3aGljaCBpcyBvbmx5IHVzZWQgYnkgVk1XR0ZY
LCBzbyBtb3ZlCml0IGludG8gdGhlIGRyaXZlciBpbnN0ZWFkLgoKSSd2ZSB0cmllZCB0byBhZGQg
dGhlIGFjY291bnRpbmcgc3lzZnMgZmlsZSB0byB0aGUga29iamVjdCBvZiB0aGUgZHJtCm1pbm9y
LCBidXQgSSdtIG5vdCAxMDAlIHN1cmUgaWYgdGhpcyB3b3JrcyBhcyBleHBlY3RlZC4KCnYyOiBm
aXggdHlwbyBpbiBLRkQgYW5kIGF2b2lkIDY0Yml0IGRpdmlkZQp2MzogZml4IGluaXQgb3JkZXIg
aW4gVk1XR0ZYCnY0OiB1c2UgcGRldiBzeXNmcyByZWZlcmVuY2UgaW5zdGVhZCBvZiBkcm0KClNp
Z25lZC1vZmYtYnk6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlzdGlhbi5rb2VuaWdAYW1kLmNvbT4K
UmV2aWV3ZWQtYnk6IFphY2sgUnVzaW4gPHphY2tyQHZtd2FyZS5jb20+ICh2MykKVGVzdGVkLWJ5
OiBOaXJtb3kgRGFzIDxuaXJtb3kuZGFzQGFtZC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vYW1kL2Ft
ZGdwdS9hbWRncHVfYW1ka2ZkX2dwdXZtLmMgIHwgMTYgKysrKysrLS0tCiBkcml2ZXJzL2dwdS9k
cm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgICAgfCAgOCArKy0tLQogZHJpdmVycy9ncHUv
ZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYyAgICAgICAgIHwgIDYgKystLQogZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9iby5jICAgICAgICAgIHwgIDcgKystLQogZHJpdmVycy9ncHUv
ZHJtL25vdXZlYXUvbm91dmVhdV9kcnYuaCAgICAgICAgIHwgIDEgLQogZHJpdmVycy9ncHUvZHJt
L3F4bC9xeGxfb2JqZWN0LmMgICAgICAgICAgICAgIHwgIDQgKy0tCiBkcml2ZXJzL2dwdS9kcm0v
cmFkZW9uL3JhZGVvbl9vYmplY3QuYyAgICAgICAgfCAgOCArKy0tLQogZHJpdmVycy9ncHUvZHJt
L3R0bS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgIHwgIDcgKystLQogZHJpdmVycy9ncHUvZHJt
L3R0bS90dG1fYm8uYyAgICAgICAgICAgICAgICAgIHwgMzMgKy0tLS0tLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm9fdXRpbC5jICAgICAgICAgICAgIHwgIDEgLQogZHJp
dmVycy9ncHUvZHJtL3R0bS90dG1fZGV2aWNlLmMgICAgICAgICAgICAgIHwgMjIgKysrKysrKysr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fcG9vbC5jICAgICAgICAgICAgICAgIHwgMTMg
Ky0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvTWFrZWZpbGUgICAgICAgICAgICAgICB8
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0ve3R0bSA9PiB2bXdnZnh9L3R0bV9tZW1vcnkuYyAgfCAy
MSArKysrKy0tLS0tLS0KIC4uLi9ncHUvZHJtL3Ztd2dmeH0vdHRtX21lbW9yeS5oICAgICAgICAg
ICAgICB8ICA1ICstLQogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fb2JqZWN0LmggICAgICAg
ICAgIHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2JvLmMgICAgICAgICAg
ICB8IDIyICsrKysrKysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5j
ICAgICAgICAgICB8ICA1ICsrKwogZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1
ZmZlci5jICAgIHwgMjggKysrKysrKysrKysrKysrLQogaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19h
cGkuaCAgICAgICAgICAgICAgICAgIHwgMTMgKystLS0tLS0KIGluY2x1ZGUvZHJtL3R0bS90dG1f
Ym9fZHJpdmVyLmggICAgICAgICAgICAgICB8ICAxIC0KIGluY2x1ZGUvZHJtL3R0bS90dG1fdHQu
aCAgICAgICAgICAgICAgICAgICAgICB8ICAxICsKIDIyIGZpbGVzIGNoYW5nZWQsIDExMSBpbnNl
cnRpb25zKCspLCAxMTYgZGVsZXRpb25zKC0pCiByZW5hbWUgZHJpdmVycy9ncHUvZHJtL3t0dG0g
PT4gdm13Z2Z4fS90dG1fbWVtb3J5LmMgKDk3JSkKIHJlbmFtZSB7aW5jbHVkZS9kcm0vdHRtID0+
IGRyaXZlcnMvZ3B1L2RybS92bXdnZnh9L3R0bV9tZW1vcnkuaCAoOTclKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYyBiL2RyaXZl
cnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwppbmRleCAwODQ5YjY4
ZTc4NGYuLmU0NDBhZjM3ZGRlOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRn
cHUvYW1kZ3B1X2FtZGtmZF9ncHV2bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1
L2FtZGdwdV9hbWRrZmRfZ3B1dm0uYwpAQCAtMTE4LDYgKzExOCwxNiBAQCB2b2lkIGFtZGdwdV9h
bWRrZmRfZ3B1dm1faW5pdF9tZW1fbGltaXRzKHZvaWQpCiAgKi8KICNkZWZpbmUgRVNUSU1BVEVf
UFRfU0laRShtZW1fc2l6ZSkgKChtZW1fc2l6ZSkgPj4gMTQpCiAKK3N0YXRpYyBzaXplX3QgYW1k
Z3B1X2FtZGtmZF9hY2Nfc2l6ZSh1aW50NjRfdCBzaXplKQoreworCXNpemUgPj49IFBBR0VfU0hJ
RlQ7CisJc2l6ZSAqPSBzaXplb2YoZG1hX2FkZHJfdCkgKyBzaXplb2Yodm9pZCAqKTsKKworCXJl
dHVybiBfX3JvdW5kdXBfcG93X29mX3R3byhzaXplb2Yoc3RydWN0IGFtZGdwdV9ibykpICsKKwkJ
X19yb3VuZHVwX3Bvd19vZl90d28oc2l6ZW9mKHN0cnVjdCB0dG1fdHQpKSArCisJCVBBR0VfQUxJ
R04oc2l6ZSk7Cit9CisKIHN0YXRpYyBpbnQgYW1kZ3B1X2FtZGtmZF9yZXNlcnZlX21lbV9saW1p
dChzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAkJdWludDY0X3Qgc2l6ZSwgdTMyIGRvbWFp
biwgYm9vbCBzZykKIHsKQEAgLTEyNiw4ICsxMzYsNyBAQCBzdGF0aWMgaW50IGFtZGdwdV9hbWRr
ZmRfcmVzZXJ2ZV9tZW1fbGltaXQoc3RydWN0IGFtZGdwdV9kZXZpY2UgKmFkZXYsCiAJc2l6ZV90
IGFjY19zaXplLCBzeXN0ZW1fbWVtX25lZWRlZCwgdHRtX21lbV9uZWVkZWQsIHZyYW1fbmVlZGVk
OwogCWludCByZXQgPSAwOwogCi0JYWNjX3NpemUgPSB0dG1fYm9fZG1hX2FjY19zaXplKCZhZGV2
LT5tbWFuLmJkZXYsIHNpemUsCi0JCQkJICAgICAgIHNpemVvZihzdHJ1Y3QgYW1kZ3B1X2JvKSk7
CisJYWNjX3NpemUgPSBhbWRncHVfYW1ka2ZkX2FjY19zaXplKHNpemUpOwogCiAJdnJhbV9uZWVk
ZWQgPSAwOwogCWlmIChkb21haW4gPT0gQU1ER1BVX0dFTV9ET01BSU5fR1RUKSB7CkBAIC0xNzQs
OCArMTgzLDcgQEAgc3RhdGljIHZvaWQgdW5yZXNlcnZlX21lbV9saW1pdChzdHJ1Y3QgYW1kZ3B1
X2RldmljZSAqYWRldiwKIHsKIAlzaXplX3QgYWNjX3NpemU7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9i
b19kbWFfYWNjX3NpemUoJmFkZXYtPm1tYW4uYmRldiwgc2l6ZSwKLQkJCQkgICAgICAgc2l6ZW9m
KHN0cnVjdCBhbWRncHVfYm8pKTsKKwlhY2Nfc2l6ZSA9IGFtZGdwdV9hbWRrZmRfYWNjX3NpemUo
c2l6ZSk7CiAKIAlzcGluX2xvY2soJmtmZF9tZW1fbGltaXQubWVtX2xpbWl0X2xvY2spOwogCWlm
IChkb21haW4gPT0gQU1ER1BVX0dFTV9ET01BSU5fR1RUKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vYW1k
L2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKaW5kZXggNmNjOTkxOWIxMmNjLi41OTljOWExMzJlYjYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9hbWQvYW1kZ3B1L2FtZGdwdV9vYmplY3QuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfb2JqZWN0LmMKQEAgLTUyMyw3
ICs1MjMsNiBAQCBzdGF0aWMgaW50IGFtZGdwdV9ib19kb19jcmVhdGUoc3RydWN0IGFtZGdwdV9k
ZXZpY2UgKmFkZXYsCiAJfTsKIAlzdHJ1Y3QgYW1kZ3B1X2JvICpibzsKIAl1bnNpZ25lZCBsb25n
IHBhZ2VfYWxpZ24sIHNpemUgPSBicC0+c2l6ZTsKLQlzaXplX3QgYWNjX3NpemU7CiAJaW50IHI7
CiAKIAkvKiBOb3RlIHRoYXQgR0RTL0dXUy9PQSBhbGxvY2F0ZXMgMSBwYWdlIHBlciBieXRlL3Jl
c291cmNlLiAqLwpAQCAtNTQ2LDkgKzU0NSw2IEBAIHN0YXRpYyBpbnQgYW1kZ3B1X2JvX2RvX2Ny
ZWF0ZShzdHJ1Y3QgYW1kZ3B1X2RldmljZSAqYWRldiwKIAogCSpib19wdHIgPSBOVUxMOwogCi0J
YWNjX3NpemUgPSB0dG1fYm9fZG1hX2FjY19zaXplKCZhZGV2LT5tbWFuLmJkZXYsIHNpemUsCi0J
CQkJICAgICAgIHNpemVvZihzdHJ1Y3QgYW1kZ3B1X2JvKSk7Ci0KIAlibyA9IGt6YWxsb2Moc2l6
ZW9mKHN0cnVjdCBhbWRncHVfYm8pLCBHRlBfS0VSTkVMKTsKIAlpZiAoYm8gPT0gTlVMTCkKIAkJ
cmV0dXJuIC1FTk9NRU07CkBAIC01NzcsOCArNTczLDggQEAgc3RhdGljIGludCBhbWRncHVfYm9f
ZG9fY3JlYXRlKHN0cnVjdCBhbWRncHVfZGV2aWNlICphZGV2LAogCQliby0+dGJvLnByaW9yaXR5
ID0gMTsKIAogCXIgPSB0dG1fYm9faW5pdF9yZXNlcnZlZCgmYWRldi0+bW1hbi5iZGV2LCAmYm8t
PnRibywgc2l6ZSwgYnAtPnR5cGUsCi0JCQkJICZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAm
Y3R4LCBhY2Nfc2l6ZSwKLQkJCQkgTlVMTCwgYnAtPnJlc3YsICZhbWRncHVfYm9fZGVzdHJveSk7
CisJCQkJICZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAmY3R4LCAgTlVMTCwKKwkJCQkgYnAt
PnJlc3YsICZhbWRncHVfYm9fZGVzdHJveSk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkpCiAJCXJl
dHVybiByOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBl
ci5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1fdnJhbV9oZWxwZXIuYwppbmRleCAwYjEzYzg1
MDc2ODguLmEwOTkyZjBiOGFmZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9nZW1f
dnJhbV9oZWxwZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2dlbV92cmFtX2hlbHBlci5j
CkBAIC0xODksNyArMTg5LDYgQEAgc3RydWN0IGRybV9nZW1fdnJhbV9vYmplY3QgKmRybV9nZW1f
dnJhbV9jcmVhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlzdHJ1Y3QgZHJtX3ZyYW1fbW0g
KnZtbSA9IGRldi0+dnJhbV9tbTsKIAlzdHJ1Y3QgdHRtX2RldmljZSAqYmRldjsKIAlpbnQgcmV0
OwotCXNpemVfdCBhY2Nfc2l6ZTsKIAogCWlmIChXQVJOX09OQ0UoIXZtbSwgIlZSQU0gTU0gbm90
IGluaXRpYWxpemVkIikpCiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwpAQCAtMjE2LDcgKzIx
NSw2IEBAIHN0cnVjdCBkcm1fZ2VtX3ZyYW1fb2JqZWN0ICpkcm1fZ2VtX3ZyYW1fY3JlYXRlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJfQogCiAJYmRldiA9ICZ2bW0tPmJkZXY7Ci0JYWNjX3Np
emUgPSB0dG1fYm9fZG1hX2FjY19zaXplKGJkZXYsIHNpemUsIHNpemVvZigqZ2JvKSk7CiAKIAln
Ym8tPmJvLmJkZXYgPSBiZGV2OwogCWRybV9nZW1fdnJhbV9wbGFjZW1lbnQoZ2JvLCBEUk1fR0VN
X1ZSQU1fUExfRkxBR19TWVNURU0pOwpAQCAtMjI2LDggKzIyNCw4IEBAIHN0cnVjdCBkcm1fZ2Vt
X3ZyYW1fb2JqZWN0ICpkcm1fZ2VtX3ZyYW1fY3JlYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJICogdG8gcmVsZWFzZSBnYm8tPmJvLmJhc2UgYW5kIGtmcmVlIGdiby4KIAkgKi8KIAlyZXQg
PSB0dG1fYm9faW5pdChiZGV2LCAmZ2JvLT5ibywgc2l6ZSwgdHRtX2JvX3R5cGVfZGV2aWNlLAot
CQkJICAmZ2JvLT5wbGFjZW1lbnQsIHBnX2FsaWduLCBmYWxzZSwgYWNjX3NpemUsCi0JCQkgIE5V
TEwsIE5VTEwsIHR0bV9idWZmZXJfb2JqZWN0X2Rlc3Ryb3kpOworCQkJICAmZ2JvLT5wbGFjZW1l
bnQsIHBnX2FsaWduLCBmYWxzZSwgTlVMTCwgTlVMTCwKKwkJCSAgdHRtX2J1ZmZlcl9vYmplY3Rf
ZGVzdHJveSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIEVSUl9QVFIocmV0KTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jIGIvZHJpdmVycy9ncHUvZHJt
L25vdXZlYXUvbm91dmVhdV9iby5jCmluZGV4IGMxNzc5NDBkNmUyYy4uY2EyYThhZTE5MzhlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2JvLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL25vdXZlYXUvbm91dmVhdV9iby5jCkBAIC0zMDAsMTggKzMwMCwxNSBAQCBu
b3V2ZWF1X2JvX2luaXQoc3RydWN0IG5vdXZlYXVfYm8gKm52Ym8sIHU2NCBzaXplLCBpbnQgYWxp
Z24sIHUzMiBkb21haW4sCiAJCXN0cnVjdCBzZ190YWJsZSAqc2csIHN0cnVjdCBkbWFfcmVzdiAq
cm9iaikKIHsKIAlpbnQgdHlwZSA9IHNnID8gdHRtX2JvX3R5cGVfc2cgOiB0dG1fYm9fdHlwZV9k
ZXZpY2U7Ci0Jc2l6ZV90IGFjY19zaXplOwogCWludCByZXQ7CiAKLQlhY2Nfc2l6ZSA9IHR0bV9i
b19kbWFfYWNjX3NpemUobnZiby0+Ym8uYmRldiwgc2l6ZSwgc2l6ZW9mKCpudmJvKSk7Ci0KIAlu
dmJvLT5iby5tZW0ubnVtX3BhZ2VzID0gc2l6ZSA+PiBQQUdFX1NISUZUOwogCW5vdXZlYXVfYm9f
cGxhY2VtZW50X3NldChudmJvLCBkb21haW4sIDApOwogCUlOSVRfTElTVF9IRUFEKCZudmJvLT5p
b19yZXNlcnZlX2xydSk7CiAKIAlyZXQgPSB0dG1fYm9faW5pdChudmJvLT5iby5iZGV2LCAmbnZi
by0+Ym8sIHNpemUsIHR5cGUsCi0JCQkgICZudmJvLT5wbGFjZW1lbnQsIGFsaWduID4+IFBBR0Vf
U0hJRlQsIGZhbHNlLAotCQkJICBhY2Nfc2l6ZSwgc2csIHJvYmosIG5vdXZlYXVfYm9fZGVsX3R0
bSk7CisJCQkgICZudmJvLT5wbGFjZW1lbnQsIGFsaWduID4+IFBBR0VfU0hJRlQsIGZhbHNlLCBz
ZywKKwkJCSAgcm9iaiwgbm91dmVhdV9ib19kZWxfdHRtKTsKIAlpZiAocmV0KSB7CiAJCS8qIHR0
bSB3aWxsIGNhbGwgbm91dmVhdV9ib19kZWxfdHRtIGlmIGl0IGZhaWxzLi4gKi8KIAkJcmV0dXJu
IHJldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2ZWF1X2Rydi5oCmluZGV4IGVkZjlkMWVlOWQ1
OC4uYTQ5MWMyYzFjNTZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vbm91dmVhdS9ub3V2
ZWF1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9ub3V2ZWF1L25vdXZlYXVfZHJ2LmgKQEAg
LTU0LDcgKzU0LDYgQEAKICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9ib19hcGkuaD4KICNpbmNsdWRl
IDxkcm0vdHRtL3R0bV9ib19kcml2ZXIuaD4KICNpbmNsdWRlIDxkcm0vdHRtL3R0bV9wbGFjZW1l
bnQuaD4KLSNpbmNsdWRlIDxkcm0vdHRtL3R0bV9tZW1vcnkuaD4KIAogI2luY2x1ZGUgPGRybS9k
cm1fYXVkaW9fY29tcG9uZW50Lmg+CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9xeGwv
cXhsX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL3F4bC9xeGxfb2JqZWN0LmMKaW5kZXggY2Vl
YmM1ODgxZjY4Li43MDViNTE1MzU0OTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9xeGwv
cXhsX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9xeGwvcXhsX29iamVjdC5jCkBAIC0x
MzgsOCArMTM4LDggQEAgaW50IHF4bF9ib19jcmVhdGUoc3RydWN0IHF4bF9kZXZpY2UgKnFkZXYs
CiAJcXhsX3R0bV9wbGFjZW1lbnRfZnJvbV9kb21haW4oYm8sIGRvbWFpbik7CiAKIAlyID0gdHRt
X2JvX2luaXRfcmVzZXJ2ZWQoJnFkZXYtPm1tYW4uYmRldiwgJmJvLT50Ym8sIHNpemUsIHR5cGUs
Ci0JCQkJICZiby0+cGxhY2VtZW50LCAwLCAmY3R4LCBzaXplLAotCQkJCSBOVUxMLCBOVUxMLCAm
cXhsX3R0bV9ib19kZXN0cm95KTsKKwkJCQkgJmJvLT5wbGFjZW1lbnQsIDAsICZjdHgsIE5VTEws
IE5VTEwsCisJCQkJICZxeGxfdHRtX2JvX2Rlc3Ryb3kpOwogCWlmICh1bmxpa2VseShyICE9IDAp
KSB7CiAJCWlmIChyICE9IC1FUkVTVEFSVFNZUykKIAkJCWRldl9lcnIocWRldi0+ZGRldi5kZXYs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jCmluZGV4IDZhMzM2Mjg0NDY2Zi4u
ODA0ZjdhNDI3YmU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9v
YmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYwpAQCAt
MTU5LDcgKzE1OSw2IEBAIGludCByYWRlb25fYm9fY3JlYXRlKHN0cnVjdCByYWRlb25fZGV2aWNl
ICpyZGV2LAogCXN0cnVjdCByYWRlb25fYm8gKmJvOwogCWVudW0gdHRtX2JvX3R5cGUgdHlwZTsK
IAl1bnNpZ25lZCBsb25nIHBhZ2VfYWxpZ24gPSByb3VuZHVwKGJ5dGVfYWxpZ24sIFBBR0VfU0la
RSkgPj4gUEFHRV9TSElGVDsKLQlzaXplX3QgYWNjX3NpemU7CiAJaW50IHI7CiAKIAlzaXplID0g
QUxJR04oc2l6ZSwgUEFHRV9TSVpFKTsKQEAgLTE3Myw5ICsxNzIsNiBAQCBpbnQgcmFkZW9uX2Jv
X2NyZWF0ZShzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwKIAl9CiAJKmJvX3B0ciA9IE5VTEw7
CiAKLQlhY2Nfc2l6ZSA9IHR0bV9ib19kbWFfYWNjX3NpemUoJnJkZXYtPm1tYW4uYmRldiwgc2l6
ZSwKLQkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCByYWRlb25fYm8pKTsKLQogCWJvID0ga3phbGxv
YyhzaXplb2Yoc3RydWN0IHJhZGVvbl9ibyksIEdGUF9LRVJORUwpOwogCWlmIChibyA9PSBOVUxM
KQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTIzMCw4ICsyMjYsOCBAQCBpbnQgcmFkZW9uX2JvX2Ny
ZWF0ZShzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwKIAkvKiBLZXJuZWwgYWxsb2NhdGlvbiBh
cmUgdW5pbnRlcnJ1cHRpYmxlICovCiAJZG93bl9yZWFkKCZyZGV2LT5wbS5tY2xrX2xvY2spOwog
CXIgPSB0dG1fYm9faW5pdCgmcmRldi0+bW1hbi5iZGV2LCAmYm8tPnRibywgc2l6ZSwgdHlwZSwK
LQkJCSZiby0+cGxhY2VtZW50LCBwYWdlX2FsaWduLCAha2VybmVsLCBhY2Nfc2l6ZSwKLQkJCXNn
LCByZXN2LCAmcmFkZW9uX3R0bV9ib19kZXN0cm95KTsKKwkJCSZiby0+cGxhY2VtZW50LCBwYWdl
X2FsaWduLCAha2VybmVsLCBzZywgcmVzdiwKKwkJCSZyYWRlb25fdHRtX2JvX2Rlc3Ryb3kpOwog
CXVwX3JlYWQoJnJkZXYtPnBtLm1jbGtfbG9jayk7CiAJaWYgKHVubGlrZWx5KHIgIT0gMCkpIHsK
IAkJcmV0dXJuIHI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlIGIv
ZHJpdmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZQppbmRleCA4ZTY0MzdlYWRhYmUuLjQwZTVlOWRh
Nzk1MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS9NYWtlZmlsZQorKysgYi9kcml2
ZXJzL2dwdS9kcm0vdHRtL01ha2VmaWxlCkBAIC0yLDEwICsyLDkgQEAKICMKICMgTWFrZWZpbGUg
Zm9yIHRoZSBkcm0gZGV2aWNlIGRyaXZlci4gIFRoaXMgZHJpdmVyIHByb3ZpZGVzIHN1cHBvcnQg
Zm9yIHRoZQogCi10dG0teSA6PSB0dG1fbWVtb3J5Lm8gdHRtX3R0Lm8gdHRtX2JvLm8gXAotCXR0
bV9ib191dGlsLm8gdHRtX2JvX3ZtLm8gdHRtX21vZHVsZS5vIFwKLQl0dG1fZXhlY2J1Zl91dGls
Lm8gdHRtX3JhbmdlX21hbmFnZXIubyBcCi0JdHRtX3Jlc291cmNlLm8gdHRtX3Bvb2wubyB0dG1f
ZGV2aWNlLm8KK3R0bS15IDo9IHR0bV90dC5vIHR0bV9iby5vIHR0bV9ib191dGlsLm8gdHRtX2Jv
X3ZtLm8gdHRtX21vZHVsZS5vIFwKKwl0dG1fZXhlY2J1Zl91dGlsLm8gdHRtX3JhbmdlX21hbmFn
ZXIubyB0dG1fcmVzb3VyY2UubyB0dG1fcG9vbC5vIFwKKwl0dG1fZGV2aWNlLm8KIHR0bS0kKENP
TkZJR19BR1ApICs9IHR0bV9hZ3BfYmFja2VuZC5vCiAKIG9iai0kKENPTkZJR19EUk1fVFRNKSAr
PSB0dG0ubwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fYm8uYyBiL2RyaXZl
cnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKaW5kZXggNjQzYmVmYzFhNmYyLi5lMzgxMDIyODJmZDUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX2JvLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3R0bS90dG1fYm8uYwpAQCAtNDI1LDcgKzQyNSw2IEBAIHN0YXRpYyB2b2lkIHR0bV9i
b19yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQogCXN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAq
Ym8gPQogCSAgICBjb250YWluZXJfb2Yoa3JlZiwgc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0LCBr
cmVmKTsKIAlzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiA9IGJvLT5iZGV2OwotCXNpemVfdCBhY2Nf
c2l6ZSA9IGJvLT5hY2Nfc2l6ZTsKIAlpbnQgcmV0OwogCiAJaWYgKCFiby0+ZGVsZXRlZCkgewpA
QCAtNDg1LDcgKzQ4NCw2IEBAIHN0YXRpYyB2b2lkIHR0bV9ib19yZWxlYXNlKHN0cnVjdCBrcmVm
ICprcmVmKQogCWlmICghdHRtX2JvX3VzZXNfZW1iZWRkZWRfZ2VtX29iamVjdChibykpCiAJCWRt
YV9yZXN2X2ZpbmkoJmJvLT5iYXNlLl9yZXN2KTsKIAliby0+ZGVzdHJveShibyk7Ci0JdHRtX21l
bV9nbG9iYWxfZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSk7CiB9CiAKIHZvaWQgdHRtX2Jv
X3B1dChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvKQpAQCAtMTA0NiwyNSArMTA0NCwxMyBA
QCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCiAJCQkg
c3RydWN0IHR0bV9wbGFjZW1lbnQgKnBsYWNlbWVudCwKIAkJCSB1aW50MzJfdCBwYWdlX2FsaWdu
bWVudCwKIAkJCSBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwKLQkJCSBzaXplX3QgYWNj
X3NpemUsCiAJCQkgc3RydWN0IHNnX3RhYmxlICpzZywKIAkJCSBzdHJ1Y3QgZG1hX3Jlc3YgKnJl
c3YsCiAJCQkgdm9pZCAoKmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKikpCiB7
Ci0Jc3RydWN0IHR0bV9tZW1fZ2xvYmFsICptZW1fZ2xvYiA9ICZ0dG1fbWVtX2dsb2I7CiAJYm9v
bCBsb2NrZWQ7CiAJaW50IHJldCA9IDA7CiAKLQlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvYyht
ZW1fZ2xvYiwgYWNjX3NpemUsIGN0eCk7Ci0JaWYgKHJldCkgewotCQlwcl9lcnIoIk91dCBvZiBr
ZXJuZWwgbWVtb3J5XG4iKTsKLQkJaWYgKGRlc3Ryb3kpCi0JCQkoKmRlc3Ryb3kpKGJvKTsKLQkJ
ZWxzZQotCQkJa2ZyZWUoYm8pOwotCQlyZXR1cm4gLUVOT01FTTsKLQl9Ci0KIAliby0+ZGVzdHJv
eSA9IGRlc3Ryb3kgPyBkZXN0cm95IDogdHRtX2JvX2RlZmF1bHRfZGVzdHJveTsKIAogCWtyZWZf
aW5pdCgmYm8tPmtyZWYpOwpAQCAtMTA4MSw3ICsxMDY3LDYgQEAgaW50IHR0bV9ib19pbml0X3Jl
c2VydmVkKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAogCWJvLT5tZW0uYnVzLmFkZHIgPSBOVUxM
OwogCWJvLT5tb3ZpbmcgPSBOVUxMOwogCWJvLT5tZW0ucGxhY2VtZW50ID0gMDsKLQliby0+YWNj
X3NpemUgPSBhY2Nfc2l6ZTsKIAliby0+cGluX2NvdW50ID0gMDsKIAliby0+c2cgPSBzZzsKIAlp
ZiAocmVzdikgewpAQCAtMTE0Miw3ICsxMTI3LDYgQEAgaW50IHR0bV9ib19pbml0KHN0cnVjdCB0
dG1fZGV2aWNlICpiZGV2LAogCQlzdHJ1Y3QgdHRtX3BsYWNlbWVudCAqcGxhY2VtZW50LAogCQl1
aW50MzJfdCBwYWdlX2FsaWdubWVudCwKIAkJYm9vbCBpbnRlcnJ1cHRpYmxlLAotCQlzaXplX3Qg
YWNjX3NpemUsCiAJCXN0cnVjdCBzZ190YWJsZSAqc2csCiAJCXN0cnVjdCBkbWFfcmVzdiAqcmVz
diwKIAkJdm9pZCAoKmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKikpCkBAIC0x
MTUxLDggKzExMzUsNyBAQCBpbnQgdHRtX2JvX2luaXQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYs
CiAJaW50IHJldDsKIAogCXJldCA9IHR0bV9ib19pbml0X3Jlc2VydmVkKGJkZXYsIGJvLCBzaXpl
LCB0eXBlLCBwbGFjZW1lbnQsCi0JCQkJICAgcGFnZV9hbGlnbm1lbnQsICZjdHgsIGFjY19zaXpl
LAotCQkJCSAgIHNnLCByZXN2LCBkZXN0cm95KTsKKwkJCQkgICBwYWdlX2FsaWdubWVudCwgJmN0
eCwgc2csIHJlc3YsIGRlc3Ryb3kpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTEx
NjMsMjAgKzExNDYsNiBAQCBpbnQgdHRtX2JvX2luaXQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYs
CiB9CiBFWFBPUlRfU1lNQk9MKHR0bV9ib19pbml0KTsKIAotc2l6ZV90IHR0bV9ib19kbWFfYWNj
X3NpemUoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCi0JCQkgICB1bnNpZ25lZCBsb25nIGJvX3Np
emUsCi0JCQkgICB1bnNpZ25lZCBzdHJ1Y3Rfc2l6ZSkKLXsKLQl1bnNpZ25lZCBucGFnZXMgPSAo
UEFHRV9BTElHTihib19zaXplKSkgPj4gUEFHRV9TSElGVDsKLQlzaXplX3Qgc2l6ZSA9IDA7Ci0K
LQlzaXplICs9IHR0bV9yb3VuZF9wb3Qoc3RydWN0X3NpemUpOwotCXNpemUgKz0gdHRtX3JvdW5k
X3BvdChucGFnZXMgKiAoMipzaXplb2Yodm9pZCAqKSArIHNpemVvZihkbWFfYWRkcl90KSkpOwot
CXNpemUgKz0gdHRtX3JvdW5kX3BvdChzaXplb2Yoc3RydWN0IHR0bV90dCkpOwotCXJldHVybiBz
aXplOwotfQotRVhQT1JUX1NZTUJPTCh0dG1fYm9fZG1hX2FjY19zaXplKTsKLQogLyoKICAqIGJ1
ZmZlciBvYmplY3Qgdm0gZnVuY3Rpb25zLgogICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vdHRtL3R0bV9ib191dGlsLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191dGlsLmMK
aW5kZXggZGIwZjI2NjFkNTA0Li4wMzFlNTgxOWZlYzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS90dG0vdHRtX2JvX3V0aWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9ib191
dGlsLmMKQEAgLTMwOSw3ICszMDksNiBAQCBzdGF0aWMgaW50IHR0bV9idWZmZXJfb2JqZWN0X3Ry
YW5zZmVyKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sCiAKIAlrcmVmX2luaXQoJmZiby0+
YmFzZS5rcmVmKTsKIAlmYm8tPmJhc2UuZGVzdHJveSA9ICZ0dG1fdHJhbnNmZXJlZF9kZXN0cm95
OwotCWZiby0+YmFzZS5hY2Nfc2l6ZSA9IDA7CiAJZmJvLT5iYXNlLnBpbl9jb3VudCA9IDA7CiAJ
aWYgKGJvLT50eXBlICE9IHR0bV9ib190eXBlX3NnKQogCQlmYm8tPmJhc2UuYmFzZS5yZXN2ID0g
JmZiby0+YmFzZS5iYXNlLl9yZXN2OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9kZXZpY2UuYwppbmRleCBhYzA5
MDNjOWU2MGEuLjZiZGUzNDRlNWRhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3R0bS90
dG1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3R0bS90dG1fZGV2aWNlLmMKQEAgLTI3
LDkgKzI3LDEyIEBACiAKICNkZWZpbmUgcHJfZm10KGZtdCkgIltUVE0gREVWSUNFXSAiIGZtdAog
CisjaW5jbHVkZSA8bGludXgvbW0uaD4KKwogI2luY2x1ZGUgPGRybS90dG0vdHRtX2RldmljZS5o
PgotI2luY2x1ZGUgPGRybS90dG0vdHRtX21lbW9yeS5oPgorI2luY2x1ZGUgPGRybS90dG0vdHRt
X3R0Lmg+CiAjaW5jbHVkZSA8ZHJtL3R0bS90dG1fcGxhY2VtZW50Lmg+CisjaW5jbHVkZSA8ZHJt
L3R0bS90dG1fYm9fYXBpLmg+CiAKICNpbmNsdWRlICJ0dG1fbW9kdWxlLmgiCiAKQEAgLTQ5LDkg
KzUyLDExIEBAIHN0YXRpYyB2b2lkIHR0bV9nbG9iYWxfcmVsZWFzZSh2b2lkKQogCWlmICgtLXR0
bV9nbG9iX3VzZV9jb3VudCA+IDApCiAJCWdvdG8gb3V0OwogCisJdHRtX3Bvb2xfbWdyX2Zpbmko
KTsKKwl0dG1fdHRfbWdyX2ZpbmkoKTsKKwogCWtvYmplY3RfZGVsKCZnbG9iLT5rb2JqKTsKIAlr
b2JqZWN0X3B1dCgmZ2xvYi0+a29iaik7Ci0JdHRtX21lbV9nbG9iYWxfcmVsZWFzZSgmdHRtX21l
bV9nbG9iKTsKIAlfX2ZyZWVfcGFnZShnbG9iLT5kdW1teV9yZWFkX3BhZ2UpOwogCW1lbXNldChn
bG9iLCAwLCBzaXplb2YoKmdsb2IpKTsKIG91dDoKQEAgLTYxLDYgKzY2LDggQEAgc3RhdGljIHZv
aWQgdHRtX2dsb2JhbF9yZWxlYXNlKHZvaWQpCiBzdGF0aWMgaW50IHR0bV9nbG9iYWxfaW5pdCh2
b2lkKQogewogCXN0cnVjdCB0dG1fZ2xvYmFsICpnbG9iID0gJnR0bV9nbG9iOworCXVuc2lnbmVk
IGxvbmcgbnVtX3BhZ2VzOworCXN0cnVjdCBzeXNpbmZvIHNpOwogCWludCByZXQgPSAwOwogCXVu
c2lnbmVkIGk7CiAKQEAgLTY4LDkgKzc1LDE0IEBAIHN0YXRpYyBpbnQgdHRtX2dsb2JhbF9pbml0
KHZvaWQpCiAJaWYgKCsrdHRtX2dsb2JfdXNlX2NvdW50ID4gMSkKIAkJZ290byBvdXQ7CiAKLQly
ZXQgPSB0dG1fbWVtX2dsb2JhbF9pbml0KCZ0dG1fbWVtX2dsb2IpOwotCWlmIChyZXQpCi0JCWdv
dG8gb3V0OworCXNpX21lbWluZm8oJnNpKTsKKworCS8qIExpbWl0IHRoZSBudW1iZXIgb2YgcGFn
ZXMgaW4gdGhlIHBvb2wgdG8gYWJvdXQgNTAlIG9mIHRoZSB0b3RhbAorCSAqIHN5c3RlbSBtZW1v
cnkuCisJICovCisJbnVtX3BhZ2VzID0gKCh1NjQpc2kudG90YWxyYW0gKiBzaS5tZW1fdW5pdCkg
Pj4gUEFHRV9TSElGVDsKKwl0dG1fcG9vbF9tZ3JfaW5pdChudW1fcGFnZXMgKiA1MCAvIDEwMCk7
CisJdHRtX3R0X21ncl9pbml0KCk7CiAKIAlzcGluX2xvY2tfaW5pdCgmZ2xvYi0+bHJ1X2xvY2sp
OwogCWdsb2ItPmR1bW15X3JlYWRfcGFnZSA9IGFsbG9jX3BhZ2UoX19HRlBfWkVSTyB8IEdGUF9E
TUEzMik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMgYi9kcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKaW5kZXggZTA2MTc3MTcxMTNmLi42YjBmOTU3ZDYz
ZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90dG0vdHRtX3Bvb2wuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vdHRtL3R0bV9wb29sLmMKQEAgLTQwNCwxNiArNDA0LDEwIEBAIGludCB0dG1f
cG9vbF9hbGxvYyhzdHJ1Y3QgdHRtX3Bvb2wgKnBvb2wsIHN0cnVjdCB0dG1fdHQgKnR0LAogCQkJ
Y2FjaGluZyA9IHBhZ2VzICsgKDEgPDwgb3JkZXIpOwogCQl9CiAKLQkJciA9IHR0bV9tZW1fZ2xv
YmFsX2FsbG9jX3BhZ2UoJnR0bV9tZW1fZ2xvYiwgcCwKLQkJCQkJICAgICAgKDEgPDwgb3JkZXIp
ICogUEFHRV9TSVpFLAotCQkJCQkgICAgICBjdHgpOwotCQlpZiAocikKLQkJCWdvdG8gZXJyb3Jf
ZnJlZV9wYWdlOwotCiAJCWlmIChkbWFfYWRkcikgewogCQkJciA9IHR0bV9wb29sX21hcChwb29s
LCBvcmRlciwgcCwgJmRtYV9hZGRyKTsKIAkJCWlmIChyKQotCQkJCWdvdG8gZXJyb3JfZ2xvYmFs
X2ZyZWU7CisJCQkJZ290byBlcnJvcl9mcmVlX3BhZ2U7CiAJCX0KIAogCQludW1fcGFnZXMgLT0g
MSA8PCBvcmRlcjsKQEAgLTQyNyw5ICs0MjEsNiBAQCBpbnQgdHRtX3Bvb2xfYWxsb2Moc3RydWN0
IHR0bV9wb29sICpwb29sLCBzdHJ1Y3QgdHRtX3R0ICp0dCwKIAogCXJldHVybiAwOwogCi1lcnJv
cl9nbG9iYWxfZnJlZToKLQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2UoJnR0bV9tZW1fZ2xvYiwg
cCwgKDEgPDwgb3JkZXIpICogUEFHRV9TSVpFKTsKLQogZXJyb3JfZnJlZV9wYWdlOgogCXR0bV9w
b29sX2ZyZWVfcGFnZShwb29sLCB0dC0+Y2FjaGluZywgb3JkZXIsIHApOwogCkBAIC00NjQsOCAr
NDU1LDYgQEAgdm9pZCB0dG1fcG9vbF9mcmVlKHN0cnVjdCB0dG1fcG9vbCAqcG9vbCwgc3RydWN0
IHR0bV90dCAqdHQpCiAKIAkJb3JkZXIgPSB0dG1fcG9vbF9wYWdlX29yZGVyKHBvb2wsIHApOwog
CQludW1fcGFnZXMgPSAxVUxMIDw8IG9yZGVyOwotCQl0dG1fbWVtX2dsb2JhbF9mcmVlX3BhZ2Uo
JnR0bV9tZW1fZ2xvYiwgcCwKLQkJCQkJIG51bV9wYWdlcyAqIFBBR0VfU0laRSk7CiAJCWlmICh0
dC0+ZG1hX2FkZHJlc3MpCiAJCQl0dG1fcG9vbF91bm1hcChwb29sLCB0dC0+ZG1hX2FkZHJlc3Nb
aV0sIG51bV9wYWdlcyk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvTWFr
ZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2VmaWxlCmluZGV4IGNjNGNkY2E3MTc2
ZS4uOGMwMmZhNTg1MmU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L01ha2Vm
aWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvTWFrZWZpbGUKQEAgLTksNyArOSw3IEBA
IHZtd2dmeC15IDo9IHZtd2dmeF9leGVjYnVmLm8gdm13Z2Z4X2dtci5vIHZtd2dmeF9rbXMubyB2
bXdnZnhfZHJ2Lm8gXAogCSAgICB2bXdnZnhfY290YWJsZS5vIHZtd2dmeF9zby5vIHZtd2dmeF9i
aW5kaW5nLm8gdm13Z2Z4X21zZy5vIFwKIAkgICAgdm13Z2Z4X3NpbXBsZV9yZXNvdXJjZS5vIHZt
d2dmeF92YS5vIHZtd2dmeF9ibGl0Lm8gXAogCSAgICB2bXdnZnhfdmFsaWRhdGlvbi5vIHZtd2dm
eF9wYWdlX2RpcnR5Lm8gdm13Z2Z4X3N0cmVhbW91dHB1dC5vIFwKLQkgICAgdHRtX29iamVjdC5v
IHR0bV9sb2NrLm8KKwkgICAgdHRtX29iamVjdC5vIHR0bV9sb2NrLm8gdHRtX21lbW9yeS5vCiAK
IHZtd2dmeC0kKENPTkZJR19UUkFOU1BBUkVOVF9IVUdFUEFHRSkgKz0gdm13Z2Z4X3RocC5vCiBv
YmotJChDT05GSUdfRFJNX1ZNV0dGWCkgOj0gdm13Z2Z4Lm8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS90dG0vdHRtX21lbW9yeS5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fbWVt
b3J5LmMKc2ltaWxhcml0eSBpbmRleCA5NyUKcmVuYW1lIGZyb20gZHJpdmVycy9ncHUvZHJtL3R0
bS90dG1fbWVtb3J5LmMKcmVuYW1lIHRvIGRyaXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX21lbW9y
eS5jCmluZGV4IDYzNGE4NWMyZGM0Yy4uZTk3MmFmMDdkMDI5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vdHRtL3R0bV9tZW1vcnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3R0
bV9tZW1vcnkuYwpAQCAtMjgsNyArMjgsNiBAQAogCiAjZGVmaW5lIHByX2ZtdChmbXQpICJbVFRN
XSAiIGZtdAogCi0jaW5jbHVkZSA8ZHJtL3R0bS90dG1fbWVtb3J5Lmg+CiAjaW5jbHVkZSA8bGlu
dXgvc3BpbmxvY2suaD4KICNpbmNsdWRlIDxsaW51eC9zY2hlZC5oPgogI2luY2x1ZGUgPGxpbnV4
L3dhaXQuaD4KQEAgLTM2LDEwICszNSwxMSBAQAogI2luY2x1ZGUgPGxpbnV4L21vZHVsZS5oPgog
I2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KICNpbmNsdWRlIDxsaW51eC9zd2FwLmg+Ci0jaW5jbHVk
ZSA8ZHJtL3R0bS90dG1fcG9vbC5oPgotI2luY2x1ZGUgPGRybS90dG0vdHRtX3R0Lmg+CiAKLSNp
bmNsdWRlICJ0dG1fbW9kdWxlLmgiCisjaW5jbHVkZSA8ZHJtL2RybV9kZXZpY2UuaD4KKyNpbmNs
dWRlIDxkcm0vZHJtX2ZpbGUuaD4KKworI2luY2x1ZGUgInR0bV9tZW1vcnkuaCIKIAogI2RlZmlu
ZSBUVE1fTUVNT1JZX0FMTE9DX1JFVFJJRVMgNAogCkBAIC00MTQsNyArNDE0LDcgQEAgc3RhdGlj
IGludCB0dG1fbWVtX2luaXRfZG1hMzJfem9uZShzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2Is
CiB9CiAjZW5kaWYKIAotaW50IHR0bV9tZW1fZ2xvYmFsX2luaXQoc3RydWN0IHR0bV9tZW1fZ2xv
YmFsICpnbG9iKQoraW50IHR0bV9tZW1fZ2xvYmFsX2luaXQoc3RydWN0IHR0bV9tZW1fZ2xvYmFs
ICpnbG9iLCBzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IHN5c2luZm8gc2k7CiAJaW50
IHJldDsKQEAgLTQyNCw4ICs0MjQsOSBAQCBpbnQgdHRtX21lbV9nbG9iYWxfaW5pdChzdHJ1Y3Qg
dHRtX21lbV9nbG9iYWwgKmdsb2IpCiAJc3Bpbl9sb2NrX2luaXQoJmdsb2ItPmxvY2spOwogCWds
b2ItPnN3YXBfcXVldWUgPSBjcmVhdGVfc2luZ2xldGhyZWFkX3dvcmtxdWV1ZSgidHRtX3N3YXAi
KTsKIAlJTklUX1dPUksoJmdsb2ItPndvcmssIHR0bV9zaHJpbmtfd29yayk7Ci0JcmV0ID0ga29i
amVjdF9pbml0X2FuZF9hZGQoCi0JCSZnbG9iLT5rb2JqLCAmdHRtX21lbV9nbG9iX2tvYmpfdHlw
ZSwgdHRtX2dldF9rb2JqKCksICJtZW1vcnlfYWNjb3VudGluZyIpOworCisJcmV0ID0ga29iamVj
dF9pbml0X2FuZF9hZGQoJmdsb2ItPmtvYmosICZ0dG1fbWVtX2dsb2Jfa29ial90eXBlLAorCQkJ
CSAgICZkZXYtPmtvYmosICJtZW1vcnlfYWNjb3VudGluZyIpOwogCWlmICh1bmxpa2VseShyZXQg
IT0gMCkpIHsKIAkJa29iamVjdF9wdXQoJmdsb2ItPmtvYmopOwogCQlyZXR1cm4gcmV0OwpAQCAt
NDUzLDggKzQ1NCw2IEBAIGludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVjdCB0dG1fbWVtX2ds
b2JhbCAqZ2xvYikKIAkJcHJfaW5mbygiWm9uZSAlN3M6IEF2YWlsYWJsZSBncmFwaGljcyBtZW1v
cnk6ICVsbHUgS2lCXG4iLAogCQkJem9uZS0+bmFtZSwgKHVuc2lnbmVkIGxvbmcgbG9uZyl6b25l
LT5tYXhfbWVtID4+IDEwKTsKIAl9Ci0JdHRtX3Bvb2xfbWdyX2luaXQoZ2xvYi0+em9uZV9rZXJu
ZWwtPm1heF9tZW0vKDIqUEFHRV9TSVpFKSk7Ci0JdHRtX3R0X21ncl9pbml0KCk7CiAJcmV0dXJu
IDA7CiBvdXRfbm9fem9uZToKIAl0dG1fbWVtX2dsb2JhbF9yZWxlYXNlKGdsb2IpOwpAQCAtNDY2
LDEwICs0NjUsNiBAQCB2b2lkIHR0bV9tZW1fZ2xvYmFsX3JlbGVhc2Uoc3RydWN0IHR0bV9tZW1f
Z2xvYmFsICpnbG9iKQogCXN0cnVjdCB0dG1fbWVtX3pvbmUgKnpvbmU7CiAJdW5zaWduZWQgaW50
IGk7CiAKLQkvKiBsZXQgdGhlIHBhZ2UgYWxsb2NhdG9yIGZpcnN0IHN0b3AgdGhlIHNocmluayB3
b3JrLiAqLwotCXR0bV9wb29sX21ncl9maW5pKCk7Ci0JdHRtX3R0X21ncl9maW5pKCk7Ci0KIAlm
bHVzaF93b3JrcXVldWUoZ2xvYi0+c3dhcF9xdWV1ZSk7CiAJZGVzdHJveV93b3JrcXVldWUoZ2xv
Yi0+c3dhcF9xdWV1ZSk7CiAJZ2xvYi0+c3dhcF9xdWV1ZSA9IE5VTEw7CmRpZmYgLS1naXQgYS9p
bmNsdWRlL2RybS90dG0vdHRtX21lbW9yeS5oIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1f
bWVtb3J5LmgKc2ltaWxhcml0eSBpbmRleCA5NyUKcmVuYW1lIGZyb20gaW5jbHVkZS9kcm0vdHRt
L3R0bV9tZW1vcnkuaApyZW5hbWUgdG8gZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fbWVtb3J5
LmgKaW5kZXggYzFmMTY3ODgxZTMzLi5jNTBkYmE3NzQ0ODUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
ZHJtL3R0bS90dG1fbWVtb3J5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1fbWVt
b3J5LmgKQEAgLTM1LDcgKzM1LDggQEAKICNpbmNsdWRlIDxsaW51eC9lcnJuby5oPgogI2luY2x1
ZGUgPGxpbnV4L2tvYmplY3QuaD4KICNpbmNsdWRlIDxsaW51eC9tbS5oPgotI2luY2x1ZGUgInR0
bV9ib19hcGkuaCIKKworI2luY2x1ZGUgPGRybS90dG0vdHRtX2JvX2FwaS5oPgogCiAvKioKICAq
IHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAtIEdsb2JhbCBtZW1vcnkgYWNjb3VudGluZyBzdHJ1Y3R1
cmUuCkBAIC03OSw3ICs4MCw3IEBAIGV4dGVybiBzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgewogI2Vu
ZGlmCiB9IHR0bV9tZW1fZ2xvYjsKIAotaW50IHR0bV9tZW1fZ2xvYmFsX2luaXQoc3RydWN0IHR0
bV9tZW1fZ2xvYmFsICpnbG9iKTsKK2ludCB0dG1fbWVtX2dsb2JhbF9pbml0KHN0cnVjdCB0dG1f
bWVtX2dsb2JhbCAqZ2xvYiwgc3RydWN0IGRldmljZSAqZGV2KTsKIHZvaWQgdHRtX21lbV9nbG9i
YWxfcmVsZWFzZShzdHJ1Y3QgdHRtX21lbV9nbG9iYWwgKmdsb2IpOwogaW50IHR0bV9tZW1fZ2xv
YmFsX2FsbG9jKHN0cnVjdCB0dG1fbWVtX2dsb2JhbCAqZ2xvYiwgdWludDY0X3QgbWVtb3J5LAog
CQkJIHN0cnVjdCB0dG1fb3BlcmF0aW9uX2N0eCAqY3R4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS92bXdnZngvdHRtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC90dG1f
b2JqZWN0LmgKaW5kZXggZWRlMjZkZjg3YzkzLi40OWIwNjRmMGNiMTkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdHRtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS92
bXdnZngvdHRtX29iamVjdC5oCkBAIC00Myw3ICs0Myw4IEBACiAjaW5jbHVkZSA8bGludXgvcmN1
cGRhdGUuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1faGFzaHRhYi5oPgotI2luY2x1ZGUgPGRybS90
dG0vdHRtX21lbW9yeS5oPgorCisjaW5jbHVkZSAidHRtX21lbW9yeS5oIgogCiAvKioKICAqIGVu
dW0gdHRtX3JlZl90eXBlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dm
eF9iby5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfYm8uYwppbmRleCA2YjNiZmQ4
YzY3OGEuLjUwZTUyOWEwMTY3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92
bXdnZnhfYm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF9iby5jCkBAIC01
MDcsMTEgKzUwNywxNiBAQCBpbnQgdm13X2JvX2NyZWF0ZV9rZXJuZWwoc3RydWN0IHZtd19wcml2
YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgbG9uZyBzaXplLAogCWFjY19zaXplID0gdHRtX3JvdW5k
X3BvdChzaXplb2YoKmJvKSk7CiAJYWNjX3NpemUgKz0gdHRtX3JvdW5kX3BvdChucGFnZXMgKiBz
aXplb2Yodm9pZCAqKSk7CiAJYWNjX3NpemUgKz0gdHRtX3JvdW5kX3BvdChzaXplb2Yoc3RydWN0
IHR0bV90dCkpOworCisJcmV0ID0gdHRtX21lbV9nbG9iYWxfYWxsb2MoJnR0bV9tZW1fZ2xvYiwg
YWNjX3NpemUsICZjdHgpOworCWlmICh1bmxpa2VseShyZXQpKQorCQlnb3RvIGVycm9yX2ZyZWU7
CisKIAlyZXQgPSB0dG1fYm9faW5pdF9yZXNlcnZlZCgmZGV2X3ByaXYtPmJkZXYsIGJvLCBzaXpl
LAogCQkJCSAgIHR0bV9ib190eXBlX2RldmljZSwgcGxhY2VtZW50LCAwLAotCQkJCSAgICZjdHgs
IGFjY19zaXplLCBOVUxMLCBOVUxMLCBOVUxMKTsKKwkJCQkgICAmY3R4LCBOVUxMLCBOVUxMLCBO
VUxMKTsKIAlpZiAodW5saWtlbHkocmV0KSkKLQkJZ290byBlcnJvcl9mcmVlOworCQlnb3RvIGVy
cm9yX2FjY291bnQ7CiAKIAl0dG1fYm9fcGluKGJvKTsKIAl0dG1fYm9fdW5yZXNlcnZlKGJvKTsK
QEAgLTUxOSw2ICs1MjQsOSBAQCBpbnQgdm13X2JvX2NyZWF0ZV9rZXJuZWwoc3RydWN0IHZtd19w
cml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgbG9uZyBzaXplLAogCiAJcmV0dXJuIDA7CiAKK2Vy
cm9yX2FjY291bnQ6CisJdHRtX21lbV9nbG9iYWxfZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6
ZSk7CisKIGVycm9yX2ZyZWU6CiAJa2ZyZWUoYm8pOwogCXJldHVybiByZXQ7CkBAIC01NTgsMTEg
KzU2NiwxNyBAQCBpbnQgdm13X2JvX2luaXQoc3RydWN0IHZtd19wcml2YXRlICpkZXZfcHJpdiwK
IAl2bXdfYm8tPmJhc2UucHJpb3JpdHkgPSAzOwogCXZtd19iby0+cmVzX3RyZWUgPSBSQl9ST09U
OwogCisJcmV0ID0gdHRtX21lbV9nbG9iYWxfYWxsb2MoJnR0bV9tZW1fZ2xvYiwgYWNjX3NpemUs
ICZjdHgpOworCWlmICh1bmxpa2VseShyZXQpKQorCQlyZXR1cm4gcmV0OworCiAJcmV0ID0gdHRt
X2JvX2luaXRfcmVzZXJ2ZWQoYmRldiwgJnZtd19iby0+YmFzZSwgc2l6ZSwKIAkJCQkgICB0dG1f
Ym9fdHlwZV9kZXZpY2UsIHBsYWNlbWVudCwKLQkJCQkgICAwLCAmY3R4LCBhY2Nfc2l6ZSwgTlVM
TCwgTlVMTCwgYm9fZnJlZSk7Ci0JaWYgKHVubGlrZWx5KHJldCkpCisJCQkJICAgMCwgJmN0eCwg
TlVMTCwgTlVMTCwgYm9fZnJlZSk7CisJaWYgKHVubGlrZWx5KHJldCkpIHsKKwkJdHRtX21lbV9n
bG9iYWxfZnJlZSgmdHRtX21lbV9nbG9iLCBhY2Nfc2l6ZSk7CiAJCXJldHVybiByZXQ7CisJfQog
CiAJaWYgKHBpbikKIAkJdHRtX2JvX3Bpbigmdm13X2JvLT5iYXNlKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfZHJ2LmMKaW5kZXggOWE5YWZhMDg3ODAyLi40ZWZlZDNiZjBlZjkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS92bXdnZngvdm13Z2Z4X2Rydi5jCkBAIC0xMjY4LDYgKzEyNjgsNyBAQCBzdGF0aWMgdm9p
ZCB2bXdfcmVtb3ZlKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQogewogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7CiAKKwl0dG1fbWVtX2dsb2JhbF9yZWxlYXNl
KCZ0dG1fbWVtX2dsb2IpOwogCWRybV9kZXZfdW5yZWdpc3RlcihkZXYpOwogCXZtd19kcml2ZXJf
dW5sb2FkKGRldik7CiB9CkBAIC0xNTE4LDYgKzE1MTksMTAgQEAgc3RhdGljIGludCB2bXdfcHJv
YmUoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICplbnQp
CiAKIAlwY2lfc2V0X2RydmRhdGEocGRldiwgJnZtdy0+ZHJtKTsKIAorCXJldCA9IHR0bV9tZW1f
Z2xvYmFsX2luaXQoJnR0bV9tZW1fZ2xvYiwgJnBkZXYtPmRldik7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKwogCXJldCA9IHZtd19kcml2ZXJfbG9hZCh2bXcsIGVudC0+ZGV2aWNlKTsKIAlp
ZiAocmV0KQogCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Ztd2dm
eC92bXdnZnhfdHRtX2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRt
X2J1ZmZlci5jCmluZGV4IGQxYmZhNTk1NzlmMS4uNjNmMTBjODY1MDYxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vdm13Z2Z4L3Ztd2dmeF90dG1fYnVmZmVyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL3Ztd2dmeC92bXdnZnhfdHRtX2J1ZmZlci5jCkBAIC01NzYsMTEgKzU3NiwzMSBAQCBz
dGF0aWMgdm9pZCB2bXdfdHRtX2Rlc3Ryb3koc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsIHN0cnVj
dCB0dG1fdHQgKnR0bSkKIHN0YXRpYyBpbnQgdm13X3R0bV9wb3B1bGF0ZShzdHJ1Y3QgdHRtX2Rl
dmljZSAqYmRldiwKIAkJCSAgICBzdHJ1Y3QgdHRtX3R0ICp0dG0sIHN0cnVjdCB0dG1fb3BlcmF0
aW9uX2N0eCAqY3R4KQogeworCXVuc2lnbmVkIGludCBpOworCWludCByZXQ7CisKIAkvKiBUT0RP
OiBtYXliZSBjb21wbGV0ZWx5IGRyb3AgdGhpcyA/ICovCiAJaWYgKHR0bV90dF9pc19wb3B1bGF0
ZWQodHRtKSkKIAkJcmV0dXJuIDA7CiAKLQlyZXR1cm4gdHRtX3Bvb2xfYWxsb2MoJmJkZXYtPnBv
b2wsIHR0bSwgY3R4KTsKKwlyZXQgPSB0dG1fcG9vbF9hbGxvYygmYmRldi0+cG9vbCwgdHRtLCBj
dHgpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlmb3IgKGkgPSAwOyBpIDwgdHRtLT5u
dW1fcGFnZXM7ICsraSkgeworCQlyZXQgPSB0dG1fbWVtX2dsb2JhbF9hbGxvY19wYWdlKCZ0dG1f
bWVtX2dsb2IsIHR0bS0+cGFnZXNbaV0sCisJCQkJCQlQQUdFX1NJWkUsIGN0eCk7CisJCWlmIChy
ZXQpCisJCQlnb3RvIGVycm9yOworCX0KKwlyZXR1cm4gMDsKKworZXJyb3I6CisJd2hpbGUgKGkt
LSkKKwkJdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2IsIHR0bS0+cGFnZXNb
aV0sCisJCQkJCSBQQUdFX1NJWkUpOworCXR0bV9wb29sX2ZyZWUoJmJkZXYtPnBvb2wsIHR0bSk7
CisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHZvaWQgdm13X3R0bV91bnBvcHVsYXRlKHN0cnVj
dCB0dG1fZGV2aWNlICpiZGV2LApAQCAtNTg4LDYgKzYwOCw3IEBAIHN0YXRpYyB2b2lkIHZtd190
dG1fdW5wb3B1bGF0ZShzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKIHsKIAlzdHJ1Y3Qgdm13X3R0
bV90dCAqdm13X3R0ID0gY29udGFpbmVyX29mKHR0bSwgc3RydWN0IHZtd190dG1fdHQsCiAJCQkJ
CQkgZG1hX3R0bSk7CisJdW5zaWduZWQgaW50IGk7CiAKIAlpZiAodm13X3R0LT5tb2IpIHsKIAkJ
dm13X21vYl9kZXN0cm95KHZtd190dC0+bW9iKTsKQEAgLTU5NSw2ICs2MTYsMTEgQEAgc3RhdGlj
IHZvaWQgdm13X3R0bV91bnBvcHVsYXRlKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LAogCX0KIAog
CXZtd190dG1fdW5tYXBfZG1hKHZtd190dCk7CisKKwlmb3IgKGkgPSAwOyBpIDwgdHRtLT5udW1f
cGFnZXM7ICsraSkKKwkJdHRtX21lbV9nbG9iYWxfZnJlZV9wYWdlKCZ0dG1fbWVtX2dsb2IsIHR0
bS0+cGFnZXNbaV0sCisJCQkJCSBQQUdFX1NJWkUpOworCiAJdHRtX3Bvb2xfZnJlZSgmYmRldi0+
cG9vbCwgdHRtKTsKIH0KIApkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGku
aCBiL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmgKaW5kZXggMTI5N2E4ZmI3Y2NiLi40ZmI1
MjNkZmFiMzIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fYXBpLmgKKysrIGIv
aW5jbHVkZS9kcm0vdHRtL3R0bV9ib19hcGkuaApAQCAtODgsNyArODgsNiBAQCBzdHJ1Y3QgdHRt
X3R0OwogICogQHR5cGU6IFRoZSBibyB0eXBlLgogICogQGRlc3Ryb3k6IERlc3RydWN0aW9uIGZ1
bmN0aW9uLiBJZiBOVUxMLCBrZnJlZSBpcyB1c2VkLgogICogQG51bV9wYWdlczogQWN0dWFsIG51
bWJlciBvZiBwYWdlcy4KLSAqIEBhY2Nfc2l6ZTogQWNjb3VudGVkIHNpemUgZm9yIHRoaXMgb2Jq
ZWN0LgogICogQGtyZWY6IFJlZmVyZW5jZSBjb3VudCBvZiB0aGlzIGJ1ZmZlciBvYmplY3QuIFdo
ZW4gdGhpcyByZWZjb3VudCByZWFjaGVzCiAgKiB6ZXJvLCB0aGUgb2JqZWN0IGlzIGRlc3Ryb3ll
ZCBvciBwdXQgb24gdGhlIGRlbGF5ZWQgZGVsZXRlIGxpc3QuCiAgKiBAbWVtOiBzdHJ1Y3R1cmUg
ZGVzY3JpYmluZyBjdXJyZW50IHBsYWNlbWVudC4KQEAgLTEyNSw3ICsxMjQsNiBAQCBzdHJ1Y3Qg
dHRtX2J1ZmZlcl9vYmplY3QgewogCXN0cnVjdCB0dG1fZGV2aWNlICpiZGV2OwogCWVudW0gdHRt
X2JvX3R5cGUgdHlwZTsKIAl2b2lkICgqZGVzdHJveSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVj
dCAqKTsKLQlzaXplX3QgYWNjX3NpemU7CiAKIAkvKioKIAkqIE1lbWJlcnMgbm90IG5lZWRpbmcg
cHJvdGVjdGlvbi4KQEAgLTM1NywxMCArMzU1LDYgQEAgdm9pZCB0dG1fYm9fdW5sb2NrX2RlbGF5
ZWRfd29ya3F1ZXVlKHN0cnVjdCB0dG1fZGV2aWNlICpiZGV2LCBpbnQgcmVzY2hlZCk7CiBib29s
IHR0bV9ib19ldmljdGlvbl92YWx1YWJsZShzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAog
CQkJICAgICAgY29uc3Qgc3RydWN0IHR0bV9wbGFjZSAqcGxhY2UpOwogCi1zaXplX3QgdHRtX2Jv
X2RtYV9hY2Nfc2l6ZShzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKLQkJCSAgIHVuc2lnbmVkIGxv
bmcgYm9fc2l6ZSwKLQkJCSAgIHVuc2lnbmVkIHN0cnVjdF9zaXplKTsKLQogLyoqCiAgKiB0dG1f
Ym9faW5pdF9yZXNlcnZlZAogICoKQEAgLTM3MSw3ICszNjUsNiBAQCBzaXplX3QgdHRtX2JvX2Rt
YV9hY2Nfc2l6ZShzdHJ1Y3QgdHRtX2RldmljZSAqYmRldiwKICAqIEBmbGFnczogSW5pdGlhbCBw
bGFjZW1lbnQgZmxhZ3MuCiAgKiBAcGFnZV9hbGlnbm1lbnQ6IERhdGEgYWxpZ25tZW50IGluIHBh
Z2VzLgogICogQGN0eDogVFRNIG9wZXJhdGlvbiBjb250ZXh0IGZvciBtZW1vcnkgYWxsb2NhdGlv
bi4KLSAqIEBhY2Nfc2l6ZTogQWNjb3VudGVkIHNpemUgZm9yIHRoaXMgb2JqZWN0LgogICogQHJl
c3Y6IFBvaW50ZXIgdG8gYSBkbWFfcmVzdiwgb3IgTlVMTCB0byBsZXQgdHRtIGFsbG9jYXRlIG9u
ZS4KICAqIEBkZXN0cm95OiBEZXN0cm95IGZ1bmN0aW9uLiBVc2UgTlVMTCBmb3Iga2ZyZWUoKS4K
ICAqCkBAIC00MDIsOCArMzk1LDcgQEAgaW50IHR0bV9ib19pbml0X3Jlc2VydmVkKHN0cnVjdCB0
dG1fZGV2aWNlICpiZGV2LAogCQkJIHN0cnVjdCB0dG1fcGxhY2VtZW50ICpwbGFjZW1lbnQsCiAJ
CQkgdWludDMyX3QgcGFnZV9hbGlnbm1lbnQsCiAJCQkgc3RydWN0IHR0bV9vcGVyYXRpb25fY3R4
ICpjdHgsCi0JCQkgc2l6ZV90IGFjY19zaXplLCBzdHJ1Y3Qgc2dfdGFibGUgKnNnLAotCQkJIHN0
cnVjdCBkbWFfcmVzdiAqcmVzdiwKKwkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnNnLCBzdHJ1Y3QgZG1h
X3Jlc3YgKnJlc3YsCiAJCQkgdm9pZCAoKmRlc3Ryb3kpIChzdHJ1Y3QgdHRtX2J1ZmZlcl9vYmpl
Y3QgKikpOwogCiAvKioKQEAgLTQyMSw3ICs0MTMsNiBAQCBpbnQgdHRtX2JvX2luaXRfcmVzZXJ2
ZWQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCiAgKiBob2xkcyBhIHBvaW50ZXIgdG8gYSBwZXJz
aXN0ZW50IHNobWVtIG9iamVjdC4gVHlwaWNhbGx5LCB0aGlzIHdvdWxkCiAgKiBwb2ludCB0byB0
aGUgc2htZW0gb2JqZWN0IGJhY2tpbmcgYSBHRU0gb2JqZWN0IGlmIFRUTSBpcyB1c2VkIHRvIGJh
Y2sgYQogICogR0VNIHVzZXIgaW50ZXJmYWNlLgotICogQGFjY19zaXplOiBBY2NvdW50ZWQgc2l6
ZSBmb3IgdGhpcyBvYmplY3QuCiAgKiBAcmVzdjogUG9pbnRlciB0byBhIGRtYV9yZXN2LCBvciBO
VUxMIHRvIGxldCB0dG0gYWxsb2NhdGUgb25lLgogICogQGRlc3Ryb3k6IERlc3Ryb3kgZnVuY3Rp
b24uIFVzZSBOVUxMIGZvciBrZnJlZSgpLgogICoKQEAgLTQ0Niw3ICs0MzcsNyBAQCBpbnQgdHRt
X2JvX2luaXRfcmVzZXJ2ZWQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsCiBpbnQgdHRtX2JvX2lu
aXQoc3RydWN0IHR0bV9kZXZpY2UgKmJkZXYsIHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8s
CiAJCXNpemVfdCBzaXplLCBlbnVtIHR0bV9ib190eXBlIHR5cGUsCiAJCXN0cnVjdCB0dG1fcGxh
Y2VtZW50ICpwbGFjZW1lbnQsCi0JCXVpbnQzMl90IHBhZ2VfYWxpZ25tZW50LCBib29sIGludGVy
cnVidGlibGUsIHNpemVfdCBhY2Nfc2l6ZSwKKwkJdWludDMyX3QgcGFnZV9hbGlnbm1lbnQsIGJv
b2wgaW50ZXJydWJ0aWJsZSwKIAkJc3RydWN0IHNnX3RhYmxlICpzZywgc3RydWN0IGRtYV9yZXN2
ICpyZXN2LAogCQl2b2lkICgqZGVzdHJveSkgKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqKSk7
CiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmggYi9pbmNsdWRl
L2RybS90dG0vdHRtX2JvX2RyaXZlci5oCmluZGV4IDFjOWJmOTkzZTI1Mi4uODk1OWMwMDc1Y2Zk
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS90dG0vdHRtX2JvX2RyaXZlci5oCisrKyBiL2luY2x1
ZGUvZHJtL3R0bS90dG1fYm9fZHJpdmVyLmgKQEAgLTQwLDcgKzQwLDYgQEAKICNpbmNsdWRlIDxk
cm0vdHRtL3R0bV9kZXZpY2UuaD4KIAogI2luY2x1ZGUgInR0bV9ib19hcGkuaCIKLSNpbmNsdWRl
ICJ0dG1fbWVtb3J5LmgiCiAjaW5jbHVkZSAidHRtX3BsYWNlbWVudC5oIgogI2luY2x1ZGUgInR0
bV90dC5oIgogI2luY2x1ZGUgInR0bV9wb29sLmgiCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS90
dG0vdHRtX3R0LmggYi9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKaW5kZXggY2NlNTdmYjQ5ZTJj
Li4wNjlmODEzMDI0MWEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL3R0bS90dG1fdHQuaAorKysg
Yi9pbmNsdWRlL2RybS90dG0vdHRtX3R0LmgKQEAgLTMwLDYgKzMwLDcgQEAKICNpbmNsdWRlIDxs
aW51eC90eXBlcy5oPgogI2luY2x1ZGUgPGRybS90dG0vdHRtX2NhY2hpbmcuaD4KIAorc3RydWN0
IHR0bV9ib19kZXZpY2U7CiBzdHJ1Y3QgdHRtX3R0Owogc3RydWN0IHR0bV9yZXNvdXJjZTsKIHN0
cnVjdCB0dG1fYnVmZmVyX29iamVjdDsKLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2
ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vZHJpLWRldmVsCg==
