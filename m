Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 59E6D10FFEA
	for <lists+dri-devel@lfdr.de>; Tue,  3 Dec 2019 15:15:51 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5074C6E5EF;
	Tue,  3 Dec 2019 14:15:34 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2B5856E5F2
 for <dri-devel@lists.freedesktop.org>; Tue,  3 Dec 2019 14:15:30 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id 61A4A290573;
 Tue,  3 Dec 2019 14:15:28 +0000 (GMT)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v4 08/11] drm/bridge: Add a drm_bridge_state object
Date: Tue,  3 Dec 2019 15:15:12 +0100
Message-Id: <20191203141515.3597631-9-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191203141515.3597631-1-boris.brezillon@collabora.com>
References: <20191203141515.3597631-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

T25lIG9mIHRoZSBsYXN0IHJlbWFpbmluZyBvYmplY3RzIHRvIG5vdCBoYXZlIGl0cyBhdG9taWMg
c3RhdGUuCgpUaGlzIGlzIGJlaW5nIG1vdGl2YXRlZCBieSBvdXIgYXR0ZW1wdCB0byBzdXBwb3J0
IHJ1bnRpbWUgYnVzLWZvcm1hdApuZWdvdGlhdGlvbiBiZXR3ZWVuIGVsZW1lbnRzIG9mIHRoZSBi
cmlkZ2UgY2hhaW4uClRoaXMgcGF0Y2gganVzdCBwYXZlcyB0aGUgcm9hZCBmb3Igc3VjaCBhIGZl
YXR1cmUgYnkgYWRkaW5nIGEgbmV3CmRybV9icmlkZ2Vfc3RhdGUgb2JqZWN0IGluaGVyaXRpbmcg
ZnJvbSBkcm1fcHJpdmF0ZV9vYmogc28gd2UgY2FuCnJlLXVzZSBzb21lIG9mIHRoZSBleGlzdGlu
ZyBzdGF0ZSBpbml0aWFsaXphdGlvbi90cmFja2luZyBsb2dpYy4KClNpZ25lZC1vZmYtYnk6IEJv
cmlzIEJyZXppbGxvbiA8Ym9yaXMuYnJlemlsbG9uQGNvbGxhYm9yYS5jb20+ClJldmlld2VkLWJ5
OiBOZWlsIEFybXN0cm9uZyA8bmFybXN0cm9uZ0BiYXlsaWJyZS5jb20+Ci0tLQpDaGFuZ2VzIGlu
IHY0OgoqIEZpeCB0aGUgZG9jCiogS2lsbCBkZWZhdWx0IGhlbHBlcnMgKGlubGluZWQpCiogRml4
IGRybV9hdG9taWNfZ2V0X2JyaWRnZV9zdGF0ZSgpIHRvIGNoZWNrIGZvciBhbiBFUlJfUFRSKCkK
KiBBZGQgTmVpbCdzIFItYgoKQ2hhbmdlcyBpbiB2MzoKKiBOb25lCgpDaGFuZ2VzIGluIHYyOgoq
IFVzZSBkcm1fZm9yX2VhY2hfYnJpZGdlX2luX2NoYWluKCkKKiBSZW5hbWUgaGVscGVycyB0byBi
ZSBtb3JlIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgRFJNIEFQSQoqIEltcHJvdmUv
Zml4IHRoZSBkb2MKLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pYy5jICAgICAgICB8ICAz
OSArKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljX2hlbHBlci5jIHwgIDIwICsr
KysrCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jICAgICAgICB8IDExOCArKysrKysrKysr
KysrKysrKysrKysrKysrKy0tCiBpbmNsdWRlL2RybS9kcm1fYXRvbWljLmggICAgICAgICAgICB8
ICAgMyArCiBpbmNsdWRlL2RybS9kcm1fYnJpZGdlLmggICAgICAgICAgICB8IDExNiArKysrKysr
KysrKysrKysrKysrKysrKysrKysKIDUgZmlsZXMgY2hhbmdlZCwgMjkwIGluc2VydGlvbnMoKyks
IDYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKaW5kZXggMTRhZWFmNzM2MzIxLi4wMmY4
MDM0ZjUyNDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fYXRvbWljLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWMuYwpAQCAtMzAsNiArMzAsNyBAQAogCiAjaW5jbHVk
ZSA8ZHJtL2RybV9hdG9taWMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY191YXBpLmg+Cisj
aW5jbHVkZSA8ZHJtL2RybV9icmlkZ2UuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2RlYnVnZnMuaD4K
ICNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgogI2luY2x1ZGUgPGRybS9kcm1fZHJ2Lmg+CkBA
IC0xMDE1LDYgKzEwMTYsNDQgQEAgc3RhdGljIHZvaWQgZHJtX2F0b21pY19jb25uZWN0b3JfcHJp
bnRfc3RhdGUoc3RydWN0IGRybV9wcmludGVyICpwLAogCQljb25uZWN0b3ItPmZ1bmNzLT5hdG9t
aWNfcHJpbnRfc3RhdGUocCwgc3RhdGUpOwogfQogCisvKioKKyAqIGRybV9hdG9taWNfYWRkX2Vu
Y29kZXJfYnJpZGdlcyAtIGFkZCBicmlkZ2VzIGF0dGFjaGVkIHRvIGFuIGVuY29kZXIKKyAqIEBz
dGF0ZTogYXRvbWljIHN0YXRlCisgKiBAZW5jb2RlcjogRFJNIGVuY29kZXIKKyAqCisgKiBUaGlz
IGZ1bmN0aW9uIGFkZHMgYWxsIGJyaWRnZXMgYXR0YWNoZWQgdG8gQGVuY29kZXIuIFRoaXMgaXMg
bmVlZGVkIHRvIGFkZAorICogYnJpZGdlIHN0YXRlcyB0byBAc3RhdGUgYW5kIG1ha2UgdGhlbSBh
dmFpbGFibGUgd2hlbgorICogJmJyaWRnZV9mdW5jcy5hdG9taWNfe2NoZWNrLHByZV9lbmFibGUs
ZW5hYmxlLGRpc2FibGVfcG9zdF9kaXNhYmxlfSgpIGFyZQorICogY2FsbGVkCisgKgorICogUmV0
dXJuczoKKyAqIDAgb24gc3VjY2VzcyBvciBjYW4gZmFpbCB3aXRoIC1FREVBRExLIG9yIC1FTk9N
RU0uIFdoZW4gdGhlIGVycm9yIGlzIEVERUFETEsKKyAqIHRoZW4gdGhlIHcvdyBtdXRleCBjb2Rl
IGhhcyBkZXRlY3RlZCBhIGRlYWRsb2NrIGFuZCB0aGUgZW50aXJlIGF0b21pYworICogc2VxdWVu
Y2UgbXVzdCBiZSByZXN0YXJ0ZWQuIEFsbCBvdGhlciBlcnJvcnMgYXJlIGZhdGFsLgorICovCitp
bnQKK2RybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUsCisJCQkgICAgICAgc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQoreworCXN0
cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpicmlkZ2Vfc3RhdGU7CisJc3RydWN0IGRybV9icmlkZ2Ug
KmJyaWRnZTsKKworCWlmICghZW5jb2RlcikKKwkJcmV0dXJuIDA7CisKKwlEUk1fREVCVUdfQVRP
TUlDKCJBZGRpbmcgYWxsIGJyaWRnZXMgZm9yIFtlbmNvZGVyOiVkOiVzXSB0byAlcFxuIiwKKwkJ
CSBlbmNvZGVyLT5iYXNlLmlkLCBlbmNvZGVyLT5uYW1lLCBzdGF0ZSk7CisKKwlkcm1fZm9yX2Vh
Y2hfYnJpZGdlX2luX2NoYWluKGVuY29kZXIsIGJyaWRnZSkgeworCQlicmlkZ2Vfc3RhdGUgPSBk
cm1fYXRvbWljX2dldF9icmlkZ2Vfc3RhdGUoc3RhdGUsIGJyaWRnZSk7CisJCWlmIChJU19FUlIo
YnJpZGdlX3N0YXRlKSkKKwkJCXJldHVybiBQVFJfRVJSKGJyaWRnZV9zdGF0ZSk7CisJfQorCisJ
cmV0dXJuIDA7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdl
cyk7CisKIC8qKgogICogZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfY29ubmVjdG9ycyAtIGFkZCBj
b25uZWN0b3JzIGZvciBjcnRjCiAgKiBAc3RhdGU6IGF0b21pYyBzdGF0ZQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJt
X2F0b21pY19oZWxwZXIuYwppbmRleCAyOWMzMTE1YmY5ZTIuLmUyZjdmMzM2YTJkMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTczMCw2ICs3MzAsMjYgQEAgZHJtX2F0b21p
Y19oZWxwZXJfY2hlY2tfbW9kZXNldChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJcmV0dXJu
IHJldDsKIAl9CiAKKwkvKgorCSAqIEl0ZXJhdGUgb3ZlciBhbGwgY29ubmVjdG9ycyBhZ2Fpbiwg
YW5kIGFkZCBhbGwgYWZmZWN0ZWQgYnJpZGdlcyB0bworCSAqIHRoZSBzdGF0ZS4KKwkgKi8KKwlm
b3JfZWFjaF9vbGRuZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IsCisJCQkJ
CSAgIG9sZF9jb25uZWN0b3Jfc3RhdGUsCisJCQkJCSAgIG5ld19jb25uZWN0b3Jfc3RhdGUsIGkp
IHsKKwkJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCisJCWVuY29kZXIgPSBvbGRfY29u
bmVjdG9yX3N0YXRlLT5iZXN0X2VuY29kZXI7CisJCXJldCA9IGRybV9hdG9taWNfYWRkX2VuY29k
ZXJfYnJpZGdlcyhzdGF0ZSwgZW5jb2Rlcik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0Owor
CisJCWVuY29kZXIgPSBuZXdfY29ubmVjdG9yX3N0YXRlLT5iZXN0X2VuY29kZXI7CisJCXJldCA9
IGRybV9hdG9taWNfYWRkX2VuY29kZXJfYnJpZGdlcyhzdGF0ZSwgZW5jb2Rlcik7CisJCWlmIChy
ZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKwogCXJldCA9IG1vZGVfdmFsaWQoc3RhdGUpOwogCWlm
IChyZXQpCiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Jy
aWRnZS5jIGIvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwppbmRleCBiNjUxN2I0ZmEzZDEu
LmJmNWEyMjQzYTExNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9icmlkZ2UuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2JyaWRnZS5jCkBAIC0yNSw2ICsyNSw3IEBACiAjaW5j
bHVkZSA8bGludXgvbW9kdWxlLmg+CiAjaW5jbHVkZSA8bGludXgvbXV0ZXguaD4KIAorI2luY2x1
ZGUgPGRybS9kcm1fYXRvbWljX3N0YXRlX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1fYnJp
ZGdlLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+CiAKQEAgLTg5LDYgKzkwLDQ4IEBA
IHZvaWQgZHJtX2JyaWRnZV9yZW1vdmUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKIH0KIEVY
UE9SVF9TWU1CT0woZHJtX2JyaWRnZV9yZW1vdmUpOwogCitzdGF0aWMgc3RydWN0IGRybV9wcml2
YXRlX3N0YXRlICoKK2RybV9icmlkZ2VfYXRvbWljX2R1cGxpY2F0ZV9wcml2X3N0YXRlKHN0cnVj
dCBkcm1fcHJpdmF0ZV9vYmogKm9iaikKK3sKKwlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlID0g
ZHJtX3ByaXZfdG9fYnJpZGdlKG9iaik7CisJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRl
OworCisJaWYgKGJyaWRnZS0+ZnVuY3MtPmF0b21pY19kdXBsaWNhdGVfc3RhdGUpIHsKKwkJc3Rh
dGUgPSBicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZHVwbGljYXRlX3N0YXRlKGJyaWRnZSk7CisKKwkJ
cmV0dXJuIHN0YXRlID8gJnN0YXRlLT5iYXNlIDogTlVMTDsKKwl9CisKKwlpZiAoV0FSTl9PTigh
YnJpZGdlLT5iYXNlLnN0YXRlKSkKKwkJcmV0dXJuIE5VTEw7CisKKwlzdGF0ZSA9IGt6YWxsb2Mo
c2l6ZW9mKCpzdGF0ZSksIEdGUF9LRVJORUwpOworCWlmICghc3RhdGUpCisJCXJldHVybiBOVUxM
OworCisJX19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfZHVwbGljYXRlX3N0YXRlKGJyaWRnZSwg
c3RhdGUpOworCisJcmV0dXJuICZzdGF0ZS0+YmFzZTsKK30KKworc3RhdGljIHZvaWQKK2RybV9i
cmlkZ2VfYXRvbWljX2Rlc3Ryb3lfcHJpdl9zdGF0ZShzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqICpv
YmosCisJCQkJICAgICBzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKnMpCit7CisJc3RydWN0IGRy
bV9icmlkZ2Vfc3RhdGUgKnN0YXRlID0gZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKHMpOworCXN0
cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UgPSBkcm1fcHJpdl90b19icmlkZ2Uob2JqKTsKKworCWlm
IChicmlkZ2UtPmZ1bmNzLT5hdG9taWNfZGVzdHJveV9zdGF0ZSkKKwkJYnJpZGdlLT5mdW5jcy0+
YXRvbWljX2Rlc3Ryb3lfc3RhdGUoYnJpZGdlLCBzdGF0ZSk7CisJZWxzZQorCQlrZnJlZShzdGF0
ZSk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3ByaXZhdGVfc3RhdGVfZnVuY3MgZHJt
X2JyaWRnZV9wcml2X3N0YXRlX2Z1bmNzID0geworCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0g
ZHJtX2JyaWRnZV9hdG9taWNfZHVwbGljYXRlX3ByaXZfc3RhdGUsCisJLmF0b21pY19kZXN0cm95
X3N0YXRlID0gZHJtX2JyaWRnZV9hdG9taWNfZGVzdHJveV9wcml2X3N0YXRlLAorfTsKKwogLyoq
CiAgKiBkcm1fYnJpZGdlX2F0dGFjaCAtIGF0dGFjaCB0aGUgYnJpZGdlIHRvIGFuIGVuY29kZXIn
cyBjaGFpbgogICoKQEAgLTExNCw2ICsxNTcsNyBAQCBFWFBPUlRfU1lNQk9MKGRybV9icmlkZ2Vf
cmVtb3ZlKTsKIGludCBkcm1fYnJpZGdlX2F0dGFjaChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29k
ZXIsIHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCSAgICAgIHN0cnVjdCBkcm1fYnJpZGdl
ICpwcmV2aW91cykKIHsKKwlzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGU7CiAJaW50IHJl
dDsKIAogCWlmICghZW5jb2RlciB8fCAhYnJpZGdlKQpAQCAtMTM1LDE1ICsxNzksNDAgQEAgaW50
IGRybV9icmlkZ2VfYXR0YWNoKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2Rlciwgc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSwKIAogCWlmIChicmlkZ2UtPmZ1bmNzLT5hdHRhY2gpIHsKIAkJcmV0
ID0gYnJpZGdlLT5mdW5jcy0+YXR0YWNoKGJyaWRnZSk7Ci0JCWlmIChyZXQgPCAwKSB7Ci0JCQls
aXN0X2RlbCgmYnJpZGdlLT5jaGFpbl9ub2RlKTsKLQkJCWJyaWRnZS0+ZGV2ID0gTlVMTDsKLQkJ
CWJyaWRnZS0+ZW5jb2RlciA9IE5VTEw7Ci0JCQlyZXR1cm4gcmV0OwotCQl9CisJCWlmIChyZXQg
PCAwKQorCQkJZ290byBlcnJfcmVzZXRfYnJpZGdlOwogCX0KIAorCWlmIChicmlkZ2UtPmZ1bmNz
LT5hdG9taWNfcmVzZXQpIHsKKwkJc3RhdGUgPSBicmlkZ2UtPmZ1bmNzLT5hdG9taWNfcmVzZXQo
YnJpZGdlKTsKKwl9IGVsc2UgeworCQlzdGF0ZSA9IGt6YWxsb2Moc2l6ZW9mKCpzdGF0ZSksIEdG
UF9LRVJORUwpOworCQlpZiAoc3RhdGUpCisJCQlfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9y
ZXNldChicmlkZ2UsIHN0YXRlKTsKKwkJZWxzZQorCQkJc3RhdGUgPSBFUlJfUFRSKC1FTk9NRU0p
OworCX0KKworCWlmIChJU19FUlIoc3RhdGUpKSB7CisJCXJldCA9IFBUUl9FUlIoc3RhdGUpOwor
CQlnb3RvIGVycl9kZXRhY2hfYnJpZGdlOworCX0KKworCWRybV9hdG9taWNfcHJpdmF0ZV9vYmpf
aW5pdChicmlkZ2UtPmRldiwgJmJyaWRnZS0+YmFzZSwKKwkJCQkgICAgJnN0YXRlLT5iYXNlLAor
CQkJCSAgICAmZHJtX2JyaWRnZV9wcml2X3N0YXRlX2Z1bmNzKTsKKwogCXJldHVybiAwOworCitl
cnJfZGV0YWNoX2JyaWRnZToKKwlpZiAoYnJpZGdlLT5mdW5jcy0+ZGV0YWNoKQorCQlicmlkZ2Ut
PmZ1bmNzLT5kZXRhY2goYnJpZGdlKTsKKworZXJyX3Jlc2V0X2JyaWRnZToKKwlicmlkZ2UtPmRl
diA9IE5VTEw7CisJYnJpZGdlLT5lbmNvZGVyID0gTlVMTDsKKwlsaXN0X2RlbCgmYnJpZGdlLT5j
aGFpbl9ub2RlKTsKKwlyZXR1cm4gcmV0OwogfQogRVhQT1JUX1NZTUJPTChkcm1fYnJpZGdlX2F0
dGFjaCk7CiAKQEAgLTE1NSw2ICsyMjQsOCBAQCB2b2lkIGRybV9icmlkZ2VfZGV0YWNoKHN0cnVj
dCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJaWYgKFdBUk5fT04oIWJyaWRnZS0+ZGV2KSkKIAkJcmV0
dXJuOwogCisJZHJtX2F0b21pY19wcml2YXRlX29ial9maW5pKCZicmlkZ2UtPmJhc2UpOworCiAJ
aWYgKGJyaWRnZS0+ZnVuY3MtPmRldGFjaCkKIAkJYnJpZGdlLT5mdW5jcy0+ZGV0YWNoKGJyaWRn
ZSk7CiAKQEAgLTUxNiw2ICs1ODcsNDEgQEAgdm9pZCBkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9l
bmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIH0KIEVYUE9SVF9TWU1CT0woZHJtX2F0
b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKTsKIAorLyoqCisgKiBfX2RybV9hdG9taWNfaGVscGVy
X2JyaWRnZV9yZXNldCgpIC0gSW5pdGlhbGl6ZSBhIGJyaWRnZSBzdGF0ZSB0byBpdHMKKyAqCQkJ
CQlkZWZhdWx0CisgKiBAYnJpZGdlOiB0aGUgYnJpZGdlIHRoaXMgc3RhdGUgaXMgcmVmZXJzIHRv
CisgKiBAc3RhdGU6IGJyaWRnZSBzdGF0ZSB0byBpbml0aWFsaXplCisgKgorICogSW5pdGlhbGl6
ZSB0aGUgYnJpZGdlIHN0YXRlIHRvIGRlZmF1bHQgdmFsdWVzLiBUaGlzIGlzIG1lYW50IHRvIGJl
KiBjYWxsZWQKKyAqIGJ5IHRoZSBicmlkZ2UgJmRybV9wbGFuZV9mdW5jcy5yZXNldCBob29rIGZv
ciBicmlkZ2VzIHRoYXQgc3ViY2xhc3MgdGhlCisgKiBicmlkZ2Ugc3RhdGUuCisgKi8KK3ZvaWQg
X19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSwKKwkJCQkgICAgICBzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqc3RhdGUpCit7CisJbWVtc2V0
KHN0YXRlLCAwLCBzaXplb2YoKnN0YXRlKSk7CisJc3RhdGUtPmJyaWRnZSA9IGJyaWRnZTsKK30K
K0VYUE9SVF9TWU1CT0woX19kcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQpOworCisvKioK
KyAqIF9fZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZSgpIC0gQ29weSBh
dG9taWMgYnJpZGdlIHN0YXRlCisgKiBAYnJpZGdlOiBicmlkZ2Ugb2JqZWN0CisgKiBAc3RhdGU6
IGF0b21pYyBicmlkZ2Ugc3RhdGUKKyAqCisgKiBDb3BpZXMgYXRvbWljIHN0YXRlIGZyb20gYSBi
cmlkZ2UncyBjdXJyZW50IHN0YXRlIGFuZCByZXNldHMgaW5mZXJyZWQgdmFsdWVzLgorICogVGhp
cyBpcyB1c2VmdWwgZm9yIGRyaXZlcnMgdGhhdCBzdWJjbGFzcyB0aGUgYnJpZGdlIHN0YXRlLgor
ICovCit2b2lkIF9fZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0
YXRlKQoreworCV9fZHJtX2F0b21pY19oZWxwZXJfcHJpdmF0ZV9vYmpfZHVwbGljYXRlX3N0YXRl
KCZicmlkZ2UtPmJhc2UsCisJCQkJCQkJJnN0YXRlLT5iYXNlKTsKKwlzdGF0ZS0+YnJpZGdlID0g
YnJpZGdlOworfQorRVhQT1JUX1NZTUJPTChfX2RybV9hdG9taWNfaGVscGVyX2JyaWRnZV9kdXBs
aWNhdGVfc3RhdGUpOworCiAjaWZkZWYgQ09ORklHX09GCiAvKioKICAqIG9mX2RybV9maW5kX2Jy
aWRnZSAtIGZpbmQgdGhlIGJyaWRnZSBjb3JyZXNwb25kaW5nIHRvIHRoZSBkZXZpY2Ugbm9kZSBp
bgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oIGIvaW5jbHVkZS9kcm0vZHJt
X2F0b21pYy5oCmluZGV4IGI2YzczZmQ5ZjU1YS4uZTA4NTgyNzczZDZjIDEwMDY0NAotLS0gYS9p
bmNsdWRlL2RybS9kcm1fYXRvbWljLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2F0b21pYy5oCkBA
IC02NjAsNiArNjYwLDkgQEAgX19kcm1fYXRvbWljX2dldF9jdXJyZW50X3BsYW5lX3N0YXRlKHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlyZXR1cm4gcGxhbmUtPnN0YXRlOwogfQog
CitpbnQgX19tdXN0X2NoZWNrCitkcm1fYXRvbWljX2FkZF9lbmNvZGVyX2JyaWRnZXMoc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICAgICAgIHN0cnVjdCBkcm1fZW5jb2RlciAq
ZW5jb2Rlcik7CiBpbnQgX19tdXN0X2NoZWNrCiBkcm1fYXRvbWljX2FkZF9hZmZlY3RlZF9jb25u
ZWN0b3JzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgZHJt
X2NydGMgKmNydGMpOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oIGIvaW5j
bHVkZS9kcm0vZHJtX2JyaWRnZS5oCmluZGV4IGQ3ZDcxNDAyMzA1MC4uZGI1ZmMxOGQ0OWJkIDEw
MDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJt
X2JyaWRnZS5oCkBAIC0yNSw2ICsyNSw4IEBACiAKICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CiAj
aW5jbHVkZSA8bGludXgvY3R5cGUuaD4KKworI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9tb2RlX29iamVj
dC5oPgogI2luY2x1ZGUgPGRybS9kcm1fbW9kZXMuaD4KQEAgLTMzLDYgKzM1LDIzIEBAIHN0cnVj
dCBkcm1fYnJpZGdlOwogc3RydWN0IGRybV9icmlkZ2VfdGltaW5nczsKIHN0cnVjdCBkcm1fcGFu
ZWw7CiAKKy8qKgorICogc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgLSBBdG9taWMgYnJpZGdlIHN0
YXRlIG9iamVjdAorICogQGJhc2U6IGluaGVyaXQgZnJvbSAmZHJtX3ByaXZhdGVfc3RhdGUKKyAq
IEBicmlkZ2U6IHRoZSBicmlkZ2UgdGhpcyBzdGF0ZSByZWZlcnMgdG8KKyAqLworc3RydWN0IGRy
bV9icmlkZ2Vfc3RhdGUgeworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0ZSBiYXNlOworCisJc3Ry
dWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKK307CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9i
cmlkZ2Vfc3RhdGUgKgorZHJtX3ByaXZfdG9fYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fcHJpdmF0
ZV9zdGF0ZSAqcHJpdikKK3sKKwlyZXR1cm4gY29udGFpbmVyX29mKHByaXYsIHN0cnVjdCBkcm1f
YnJpZGdlX3N0YXRlLCBiYXNlKTsKK30KKwogLyoqCiAgKiBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5j
cyAtIGRybV9icmlkZ2UgY29udHJvbCBmdW5jdGlvbnMKICAqLwpAQCAtMzM4LDYgKzM1Nyw0OSBA
QCBzdHJ1Y3QgZHJtX2JyaWRnZV9mdW5jcyB7CiAJICovCiAJdm9pZCAoKmF0b21pY19wb3N0X2Rp
c2FibGUpKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UsCiAJCQkJICAgIHN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpvbGRfc3RhdGUpOworCisJLyoqCisJICogQGF0b21pY19kdXBsaWNhdGVfc3Rh
dGU6CisJICoKKwkgKiBEdXBsaWNhdGUgdGhlIGN1cnJlbnQgYnJpZGdlIHN0YXRlIG9iamVjdCAo
d2hpY2ggaXMgZ3VhcmFudGVlZCB0byBiZQorCSAqIG5vbi1OVUxMKS4KKwkgKgorCSAqIFRoZSBh
dG9taWNfZHVwbGljYXRlX3N0YXRlKCkgaXMgb3B0aW9uYWwuIFdoZW4gbm90IGltcGxlbWVudGVk
IHRoZQorCSAqIGNvcmUgYWxsb2NhdGVzIGEgZHJtX2JyaWRnZV9zdGF0ZSBvYmplY3QgYW5kIGNh
bGxzCisJICogJl9fZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZSgpIHRv
IGluaXRpYWxpemUgaXQuCisJICoKKwkgKiBSRVRVUk5TOgorCSAqIEEgdmFsaWQgZHJtX2JyaWRn
ZV9zdGF0ZSBvYmplY3Qgb3IgTlVMTCBpZiB0aGUgYWxsb2NhdGlvbiBmYWlscy4KKwkgKi8KKwlz
dHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAqKCphdG9taWNfZHVwbGljYXRlX3N0YXRlKShzdHJ1Y3Qg
ZHJtX2JyaWRnZSAqYnJpZGdlKTsKKworCS8qKgorCSAqIEBhdG9taWNfZGVzdHJveV9zdGF0ZToK
KwkgKgorCSAqIERlc3Ryb3kgYSBicmlkZ2Ugc3RhdGUgb2JqZWN0IHByZXZpb3VzbHkgYWxsb2Nh
dGVkIGJ5CisJICogJmRybV9icmlkZ2VfZnVuY3MuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSgpLgor
CSAqCisJICogVGhlIGF0b21pY19kZXN0cm95X3N0YXRlIGhvb2sgaXMgb3B0aW9uYWwuIFdoZW4g
bm90IGltcGxlbWVudGVkIHRoZQorCSAqIGNvcmUgY2FsbHMga2ZyZWUoKSBvbiB0aGUgc3RhdGUu
CisJICovCisJdm9pZCAoKmF0b21pY19kZXN0cm95X3N0YXRlKShzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlLAorCQkJCSAgICAgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKnN0YXRlKTsKKworCS8q
KgorCSAqIEBhdG9taWNfcmVzZXQ6CisJICoKKwkgKiBSZXNldCB0aGUgYnJpZGdlIHRvIGEgcHJl
ZGVmaW5lZCBzdGF0ZSAob3IgcmV0cmlldmUgaXRzIGN1cnJlbnQKKwkgKiBzdGF0ZSkgYW5kIHJl
dHVybiBhICZkcm1fYnJpZGdlX3N0YXRlIG9iamVjdCBtYXRjaGluZyB0aGlzIHN0YXRlLgorCSAq
IFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IGF0dGFjaCB0aW1lLgorCSAqCisJICogVGhlIGF0
b21pY19yZXNldCBob29rIGlzIG9wdGlvbmFsLiBXaGVuIG5vdCBpbXBsZW1lbnRlZCB0aGUgY29y
ZQorCSAqIGFsbG9jYXRlcyBhIG5ldyBzdGF0ZSBhbmQgY2FsbHMgJl9fZHJtX2F0b21pY19oZWxw
ZXJfYnJpZGdlX3Jlc2V0KCkuCisJICoKKwkgKiBSRVRVUk5TOgorCSAqIEEgdmFsaWQgZHJtX2Jy
aWRnZV9zdGF0ZSBvYmplY3QgaW4gY2FzZSBvZiBzdWNjZXNzLCBhbiBFUlJfUFRSKCkKKwkgKiBn
aXZpbmcgdGhlIHJlYXNvbiBvZiB0aGUgZmFpbHVyZSBvdGhlcndpc2UuCisJICovCisJc3RydWN0
IGRybV9icmlkZ2Vfc3RhdGUgKigqYXRvbWljX3Jlc2V0KShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJp
ZGdlKTsKIH07CiAKIC8qKgpAQCAtMzgwLDYgKzQ0Miw4IEBAIHN0cnVjdCBkcm1fYnJpZGdlX3Rp
bWluZ3MgewogICogc3RydWN0IGRybV9icmlkZ2UgLSBjZW50cmFsIERSTSBicmlkZ2UgY29udHJv
bCBzdHJ1Y3R1cmUKICAqLwogc3RydWN0IGRybV9icmlkZ2UgeworCS8qKiBAYmFzZTogaW5oZXJp
dCBmcm9tICZkcm1fcHJpdmF0ZV9vYmplY3QgKi8KKwlzdHJ1Y3QgZHJtX3ByaXZhdGVfb2JqIGJh
c2U7CiAJLyoqIEBkZXY6IERSTSBkZXZpY2UgdGhpcyBicmlkZ2UgYmVsb25ncyB0byAqLwogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXY7CiAJLyoqIEBlbmNvZGVyOiBlbmNvZGVyIHRvIHdoaWNoIHRo
aXMgYnJpZGdlIGlzIGNvbm5lY3RlZCAqLwpAQCAtNDA0LDYgKzQ2OCwxMiBAQCBzdHJ1Y3QgZHJt
X2JyaWRnZSB7CiAJdm9pZCAqZHJpdmVyX3ByaXZhdGU7CiB9OwogCitzdGF0aWMgaW5saW5lIHN0
cnVjdCBkcm1fYnJpZGdlICoKK2RybV9wcml2X3RvX2JyaWRnZShzdHJ1Y3QgZHJtX3ByaXZhdGVf
b2JqICpwcml2KQoreworCXJldHVybiBjb250YWluZXJfb2YocHJpdiwgc3RydWN0IGRybV9icmlk
Z2UsIGJhc2UpOworfQorCiB2b2lkIGRybV9icmlkZ2VfYWRkKHN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2UpOwogdm9pZCBkcm1fYnJpZGdlX3JlbW92ZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdl
KTsKIHN0cnVjdCBkcm1fYnJpZGdlICpvZl9kcm1fZmluZF9icmlkZ2Uoc3RydWN0IGRldmljZV9u
b2RlICpucCk7CkBAIC00OTEsNiArNTYxLDUyIEBAIHZvaWQgZHJtX2F0b21pY19icmlkZ2VfY2hh
aW5fcHJlX2VuYWJsZShzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAogdm9pZCBkcm1fYXRvbWlj
X2JyaWRnZV9jaGFpbl9lbmFibGUoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgICAg
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAordm9pZCBfX2RybV9hdG9taWNfaGVs
cGVyX2JyaWRnZV9yZXNldChzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCSAgICAgIHN0
cnVjdCBkcm1fYnJpZGdlX3N0YXRlICpzdGF0ZSk7CitzdHJ1Y3QgZHJtX2JyaWRnZV9zdGF0ZSAq
Citkcm1fYXRvbWljX2hlbHBlcl9icmlkZ2VfcmVzZXQoc3RydWN0IGRybV9icmlkZ2UgKmJyaWRn
ZSk7Cit2b2lkIF9fZHJtX2F0b21pY19oZWxwZXJfYnJpZGdlX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1
Y3QgZHJtX2JyaWRnZSAqYnJpZGdlLAorCQkJCQkJc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKm5l
dyk7CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9icmlkZ2Vfc3RhdGUgKgorZHJtX2F0b21p
Y19nZXRfYnJpZGdlX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAg
ICBzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlKQoreworCXN0cnVjdCBkcm1fcHJpdmF0ZV9zdGF0
ZSAqb2JqX3N0YXRlOworCisJb2JqX3N0YXRlID0gZHJtX2F0b21pY19nZXRfcHJpdmF0ZV9vYmpf
c3RhdGUoc3RhdGUsICZicmlkZ2UtPmJhc2UpOworCWlmIChJU19FUlIob2JqX3N0YXRlKSkKKwkJ
cmV0dXJuIEVSUl9DQVNUKG9ial9zdGF0ZSk7CisKKwlyZXR1cm4gZHJtX3ByaXZfdG9fYnJpZGdl
X3N0YXRlKG9ial9zdGF0ZSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9icmlkZ2Vf
c3RhdGUgKgorZHJtX2F0b21pY19nZXRfb2xkX2JyaWRnZV9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCisJCQkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZSkKK3sKKwlzdHJ1
Y3QgZHJtX3ByaXZhdGVfc3RhdGUgKm9ial9zdGF0ZTsKKworCW9ial9zdGF0ZSA9IGRybV9hdG9t
aWNfZ2V0X29sZF9wcml2YXRlX29ial9zdGF0ZShzdGF0ZSwgJmJyaWRnZS0+YmFzZSk7CisJaWYg
KCFvYmpfc3RhdGUpCisJCXJldHVybiBOVUxMOworCisJcmV0dXJuIGRybV9wcml2X3RvX2JyaWRn
ZV9zdGF0ZShvYmpfc3RhdGUpOworfQorCitzdGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdl
X3N0YXRlICoKK2RybV9hdG9taWNfZ2V0X25ld19icmlkZ2Vfc3RhdGUoc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKnN0YXRlLAorCQkJCXN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCit7CisJc3Ry
dWN0IGRybV9wcml2YXRlX3N0YXRlICpvYmpfc3RhdGU7CisKKwlvYmpfc3RhdGUgPSBkcm1fYXRv
bWljX2dldF9uZXdfcHJpdmF0ZV9vYmpfc3RhdGUoc3RhdGUsICZicmlkZ2UtPmJhc2UpOworCWlm
ICghb2JqX3N0YXRlKQorCQlyZXR1cm4gTlVMTDsKKworCXJldHVybiBkcm1fcHJpdl90b19icmlk
Z2Vfc3RhdGUob2JqX3N0YXRlKTsKK30KKwogI2lmZGVmIENPTkZJR19EUk1fUEFORUxfQlJJREdF
CiBzdHJ1Y3QgZHJtX2JyaWRnZSAqZHJtX3BhbmVsX2JyaWRnZV9hZGQoc3RydWN0IGRybV9wYW5l
bCAqcGFuZWwpOwogc3RydWN0IGRybV9icmlkZ2UgKmRybV9wYW5lbF9icmlkZ2VfYWRkX3R5cGVk
KHN0cnVjdCBkcm1fcGFuZWwgKnBhbmVsLAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1k
ZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
