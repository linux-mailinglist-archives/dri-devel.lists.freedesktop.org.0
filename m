Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4CE7D6C46E
	for <lists+dri-devel@lfdr.de>; Thu, 18 Jul 2019 03:44:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D5EEC6E2CC;
	Thu, 18 Jul 2019 01:44:25 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B418A6E2CC
 for <dri-devel@lists.freedesktop.org>; Thu, 18 Jul 2019 01:44:24 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 3DC37C025014;
 Thu, 18 Jul 2019 01:44:24 +0000 (UTC)
Received: from whitewolf.redhat.com (ovpn-120-112.rdu2.redhat.com
 [10.10.120.112])
 by smtp.corp.redhat.com (Postfix) with ESMTP id AC0A619C67;
 Thu, 18 Jul 2019 01:44:22 +0000 (UTC)
From: Lyude Paul <lyude@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 05/26] drm/dp_mst: Add sideband down request tracing +
 selftests
Date: Wed, 17 Jul 2019 21:42:28 -0400
Message-Id: <20190718014329.8107-6-lyude@redhat.com>
In-Reply-To: <20190718014329.8107-1-lyude@redhat.com>
References: <20190718014329.8107-1-lyude@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Thu, 18 Jul 2019 01:44:24 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Thomas Hellstrom <thellstrom@vmware.com>,
 Maxime Ripard <maxime.ripard@bootlin.com>, Sean Paul <sean@poorly.run>,
 Alexandru Gheorghe <alexandru-cosmin.gheorghe@arm.com>,
 linux-kernel@vger.kernel.org, David Airlie <airlied@linux.ie>,
 Juston Li <juston.li@intel.com>, Deepak Rawat <drawat@vmware.com>,
 Harry Wentland <hwentlan@amd.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

VW5mb3J0dW5hdGVseSB0aGUgRFAgTVNUIGhlbHBlcnMgZG8gbm90IGhhdmUgbXVjaCBpbiB0aGUg
d2F5IG9mCmRlYnVnZ2luZyB1dGlsaXRpZXMuIFNvLCBsZXQncyBhZGQgc29tZSEKClRoaXMgYWRk
cyBiYXNpYyBkZWJ1Z2dpbmcgb3V0cHV0IGZvciBkb3duIHNpZGViYW5kIHJlcXVlc3RzIHRoYXQg
d2Ugc2VuZApmcm9tIHRoZSBkcml2ZXIsIHNvIHRoYXQgd2UgY2FuIGFjdHVhbGx5IGRpc2Nlcm4g
d2hhdCdzIGhhcHBlbmluZyB3aGVuCnNpZGViYW5kIHJlcXVlc3RzIHRpbWVvdXQuIE5vdGUgdGhh
dCB3aXRoIHRoaXMgY29tbWl0LCB3ZSdsbCBiZSBkdW1waW5nCm91dCBzaWRlYmFuZCByZXF1ZXN0
cyB1bmRlciBib3RoIG9mIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCi0gV2hlbiB0aGUgdXNl
ciBoYXMgZW5hYmxlZCBEUk1fVVRfRFAgb3V0cHV0LCBvZiBjb3Vyc2UuCi0gV2hlbiB0aGUgdXNl
ciBoYXMgZW5hYmxlZCBEUk1fVVRfS01TIG9yIERSTV9VVF9EUCwgYW5kIGEgc2lkZWJhbmQKICBy
ZXF1ZXN0IGhhcyBmYWlsZWQgaW4gc29tZSB3YXkuIFRoaXMgd2lsbCBhbGxvdyBmb3IgZGV2ZWxv
cGVycyB0byBnZXQKICBhIGJhc2ljIGlkZWEgb2Ygd2hhdCdzIGFjdHVhbGx5IGhhcHBlbmluZyB3
aXRoIGZhaWxlZCBtb2Rlc2V0cyBvbiBNU1QsCiAgd2l0aG91dCBuZWVkaW5nIHRvIGhhdmUgRFJN
X1VUX0RQIGV4cGxpY2l0bHkgZW5hYmxlZC4KClNpbmNlIHRoZXJlIHdhc24ndCByZWFsbHkgYSBn
b29kIHdheSBvZiB0ZXN0aW5nIHRoYXQgYW55IG9mIHRoaXMgd29ya2VkLApJIGVuZGVkIHVwIHdy
aXRpbmcgc2ltcGxlIHNlbGZ0ZXN0cyB0aGF0IGxpZ2h0bHkgdGVzdCBzaWRlYmFuZCBtZXNzYWdl
CmVuY29kaW5nIGFuZCBkZWNvZGluZyBhcyB3ZWxsLiBFbmpveSEKCkNjOiBKdXN0b24gTGkgPGp1
c3Rvbi5saUBpbnRlbC5jb20+CkNjOiBJbXJlIERlYWsgPGltcmUuZGVha0BpbnRlbC5jb20+CkNj
OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogSGFy
cnkgV2VudGxhbmQgPGh3ZW50bGFuQGFtZC5jb20+ClNpZ25lZC1vZmYtYnk6IEx5dWRlIFBhdWwg
PGx5dWRlQHJlZGhhdC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2RybV9kcF9tc3RfdG9wb2xv
Z3kuYyAgICAgICAgIHwgMzA4ICsrKysrKysrKysrKysrKysrLQogLi4uL2dwdS9kcm0vZHJtX2Rw
X21zdF90b3BvbG9neV9pbnRlcm5hbC5oICAgIHwgIDI0ICsrCiAuLi4vZ3B1L2RybS9zZWxmdGVz
dHMvZHJtX21vZGVzZXRfc2VsZnRlc3RzLmggfCAgIDEgKwogLi4uL2RybS9zZWxmdGVzdHMvdGVz
dC1kcm1fZHBfbXN0X2hlbHBlci5jICAgIHwgMjEyICsrKysrKysrKysrKwogLi4uL2RybS9zZWxm
dGVzdHMvdGVzdC1kcm1fbW9kZXNldF9jb21tb24uaCAgIHwgICAxICsKIGluY2x1ZGUvZHJtL2Ry
bV9kcF9tc3RfaGVscGVyLmggICAgICAgICAgICAgICB8ICAgMiArLQogNiBmaWxlcyBjaGFuZ2Vk
LCA1NDMgaW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neV9pbnRlcm5hbC5oCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2RybV9kcF9tc3RfdG9wb2xvZ3kuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9kcm1fZHBfbXN0X3RvcG9sb2d5LmMKaW5kZXggOWUzODIxMTc4OTZkLi5kZWZjNWUwOWZiOWEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2RybV9kcF9tc3RfdG9wb2xvZ3kuYwpAQCAtMzYsNiArMzYsOCBAQAog
I2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3Byb2JlX2hlbHBl
ci5oPgogCisjaW5jbHVkZSAiZHJtX2RwX21zdF90b3BvbG9neV9pbnRlcm5hbC5oIgorCiAvKioK
ICAqIERPQzogZHAgbXN0IGhlbHBlcgogICoKQEAgLTY4LDYgKzcwLDggQEAgc3RhdGljIGludCBk
cm1fZHBfbXN0X3JlZ2lzdGVyX2kyY19idXMoc3RydWN0IGRybV9kcF9hdXggKmF1eCk7CiBzdGF0
aWMgdm9pZCBkcm1fZHBfbXN0X3VucmVnaXN0ZXJfaTJjX2J1cyhzdHJ1Y3QgZHJtX2RwX2F1eCAq
YXV4KTsKIHN0YXRpYyB2b2lkIGRybV9kcF9tc3Rfa2lja190eChzdHJ1Y3QgZHJtX2RwX21zdF90
b3BvbG9neV9tZ3IgKm1ncik7CiAKKyNkZWZpbmUgREJHX1BSRUZJWCAiW2RwX21zdF0iCisKICNk
ZWZpbmUgRFBfU1RSKHgpIFtEUF8gIyMgeF0gPSAjeAogCiBzdGF0aWMgY29uc3QgY2hhciAqZHJt
X2RwX21zdF9yZXFfdHlwZV9zdHIodTggcmVxX3R5cGUpCkBAIC0xMjQsNiArMTI4LDQzIEBAIHN0
YXRpYyBjb25zdCBjaGFyICpkcm1fZHBfbXN0X25ha19yZWFzb25fc3RyKHU4IG5ha19yZWFzb24p
CiB9CiAKICN1bmRlZiBEUF9TVFIKKyNkZWZpbmUgRFBfU1RSKHgpIFtEUk1fRFBfU0lERUJBTkRf
VFhfICMjIHhdID0gI3gKKworc3RhdGljIGNvbnN0IGNoYXIgKmRybV9kcF9tc3Rfc2lkZWJhbmRf
dHhfc3RhdGVfc3RyKGludCBzdGF0ZSkKK3sKKwlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IHNp
ZGViYW5kX3JlYXNvbl9zdHJbXSA9IHsKKwkJRFBfU1RSKFFVRVVFRCksCisJCURQX1NUUihTVEFS
VF9TRU5EKSwKKwkJRFBfU1RSKFNFTlQpLAorCQlEUF9TVFIoUlgpLAorCQlEUF9TVFIoVElNRU9V
VCksCisJfTsKKworCWlmIChzdGF0ZSA+PSBBUlJBWV9TSVpFKHNpZGViYW5kX3JlYXNvbl9zdHIp
IHx8CisJICAgICFzaWRlYmFuZF9yZWFzb25fc3RyW3N0YXRlXSkKKwkJcmV0dXJuICJ1bmtub3du
IjsKKworCXJldHVybiBzaWRlYmFuZF9yZWFzb25fc3RyW3N0YXRlXTsKK30KKworc3RhdGljIGlu
dAorZHJtX2RwX21zdF9yYWRfdG9fc3RyKGNvbnN0IHU4IHJhZFs4XSwgdTggbGN0LCBjaGFyICpv
dXQsIHNpemVfdCBsZW4pCit7CisJaW50IGk7CisJdTggdW5wYWNrZWRfcmFkWzE2XTsKKworCWZv
ciAoaSA9IDA7IGkgPCBsY3Q7IGkrKykgeworCQlpZiAoaSAlIDIpCisJCQl1bnBhY2tlZF9yYWRb
aV0gPSByYWRbaSAvIDJdID4+IDQ7CisJCWVsc2UKKwkJCXVucGFja2VkX3JhZFtpXSA9IHJhZFtp
IC8gMl0gJiBCSVRfTUFTSyg0KTsKKwl9CisKKwkvKiBUT0RPOiBFdmVudHVhbGx5IGFkZCBzb21l
dGhpbmcgdG8gcHJpbnRrIHNvIHdlIGNhbiBmb3JtYXQgdGhlIHJhZAorCSAqIGxpa2UgdGhpczog
MS4yLjMKKwkgKi8KKwlyZXR1cm4gc25wcmludGYob3V0LCBsZW4sICIlKnBoQyIsIGxjdCwgdW5w
YWNrZWRfcmFkKTsKK30KIAogLyogc2lkZWJhbmQgbXNnIGhhbmRsaW5nICovCiBzdGF0aWMgdTgg
ZHJtX2RwX21zZ19oZWFkZXJfY3JjNChjb25zdCB1aW50OF90ICpkYXRhLCBzaXplX3QgbnVtX25p
YmJsZXMpCkBAIC0yNTYsOCArMjk3LDkgQEAgc3RhdGljIGJvb2wgZHJtX2RwX2RlY29kZV9zaWRl
YmFuZF9tc2dfaGRyKHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX2hkciAqaGRyLAogCXJldHVy
biB0cnVlOwogfQogCi1zdGF0aWMgdm9pZCBkcm1fZHBfZW5jb2RlX3NpZGViYW5kX3JlcShzdHJ1
Y3QgZHJtX2RwX3NpZGViYW5kX21zZ19yZXFfYm9keSAqcmVxLAotCQkJCSAgICAgICBzdHJ1Y3Qg
ZHJtX2RwX3NpZGViYW5kX21zZ190eCAqcmF3KQordm9pZAorZHJtX2RwX2VuY29kZV9zaWRlYmFu
ZF9yZXEoY29uc3Qgc3RydWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfcmVxX2JvZHkgKnJlcSwKKwkJ
CSAgIHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3R4ICpyYXcpCiB7CiAJaW50IGlkeCA9IDA7
CiAJaW50IGk7CkBAIC0zNjIsNiArNDA0LDI0OSBAQCBzdGF0aWMgdm9pZCBkcm1fZHBfZW5jb2Rl
X3NpZGViYW5kX3JlcShzdHJ1Y3QgZHJtX2RwX3NpZGViYW5kX21zZ19yZXFfYm9keSAqcmVxLAog
CX0KIAlyYXctPmN1cl9sZW4gPSBpZHg7CiB9CitFWFBPUlRfU1lNQk9MX0ZPUl9URVNUU19PTkxZ
KGRybV9kcF9lbmNvZGVfc2lkZWJhbmRfcmVxKTsKKworLyogRGVjb2RlIGEgc2lkZWJhbmQgcmVx
dWVzdCB3ZSd2ZSBlbmNvZGVkLCBtYWlubHkgdXNlZCBmb3IgZGVidWdnaW5nICovCitpbnQKK2Ry
bV9kcF9kZWNvZGVfc2lkZWJhbmRfcmVxKGNvbnN0IHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNn
X3R4ICpyYXcsCisJCQkgICBzdHJ1Y3QgZHJtX2RwX3NpZGViYW5kX21zZ19yZXFfYm9keSAqcmVx
KQoreworCWNvbnN0IHU4ICpidWYgPSByYXctPm1zZzsKKwlpbnQgaSwgaWR4ID0gMDsKKworCXJl
cS0+cmVxX3R5cGUgPSBidWZbaWR4KytdICYgMHg3ZjsKKwlzd2l0Y2ggKHJlcS0+cmVxX3R5cGUp
IHsKKwljYXNlIERQX0VOVU1fUEFUSF9SRVNPVVJDRVM6CisJY2FzZSBEUF9QT1dFUl9ET1dOX1BI
WToKKwljYXNlIERQX1BPV0VSX1VQX1BIWToKKwkJcmVxLT51LnBvcnRfbnVtLnBvcnRfbnVtYmVy
ID0gKGJ1ZltpZHhdID4+IDQpICYgMHhmOworCQlicmVhazsKKwljYXNlIERQX0FMTE9DQVRFX1BB
WUxPQUQ6CisJCXsKKwkJCXN0cnVjdCBkcm1fZHBfYWxsb2NhdGVfcGF5bG9hZCAqYSA9CisJCQkJ
JnJlcS0+dS5hbGxvY2F0ZV9wYXlsb2FkOworCisJCQlhLT5udW1iZXJfc2RwX3N0cmVhbXMgPSBi
dWZbaWR4XSAmIDB4ZjsKKwkJCWEtPnBvcnRfbnVtYmVyID0gKGJ1ZltpZHhdID4+IDQpICYgMHhm
OworCisJCQlhLT52Y3BpID0gYnVmWysraWR4XSAmIDB4N2Y7CisKKwkJCWEtPnBibiA9IGJ1Zlsr
K2lkeF0gPDwgODsKKwkJCWEtPnBibiB8PSBidWZbKytpZHhdOworCisJCQlpZHgrKzsKKwkJCWZv
ciAoaSA9IDA7IGkgPCBhLT5udW1iZXJfc2RwX3N0cmVhbXM7IGkrKykgeworCQkJCWEtPnNkcF9z
dHJlYW1fc2lua1tpXSA9CisJCQkJCShidWZbaWR4ICsgKGkgLyAyKV0gPj4gKChpICUgMikgPyAw
IDogNCkpICYgMHhmOworCQkJfQorCQl9CisJCWJyZWFrOworCWNhc2UgRFBfUVVFUllfUEFZTE9B
RDoKKwkJcmVxLT51LnF1ZXJ5X3BheWxvYWQucG9ydF9udW1iZXIgPSAoYnVmW2lkeF0gPj4gNCkg
JiAweGY7CisJCXJlcS0+dS5xdWVyeV9wYXlsb2FkLnZjcGkgPSBidWZbKytpZHhdICYgMHg3ZjsK
KwkJYnJlYWs7CisJY2FzZSBEUF9SRU1PVEVfRFBDRF9SRUFEOgorCQl7CisJCQlzdHJ1Y3QgZHJt
X2RwX3JlbW90ZV9kcGNkX3JlYWQgKnIgPSAmcmVxLT51LmRwY2RfcmVhZDsKKworCQkJci0+cG9y
dF9udW1iZXIgPSAoYnVmW2lkeF0gPj4gNCkgJiAweGY7CisKKwkJCXItPmRwY2RfYWRkcmVzcyA9
IChidWZbaWR4XSA8PCAxNikgJiAweGYwMDAwOworCQkJci0+ZHBjZF9hZGRyZXNzIHw9IChidWZb
KytpZHhdIDw8IDgpICYgMHhmZjAwOworCQkJci0+ZHBjZF9hZGRyZXNzIHw9IGJ1ZlsrK2lkeF0g
JiAweGZmOworCisJCQlyLT5udW1fYnl0ZXMgPSBidWZbKytpZHhdOworCQl9CisJCWJyZWFrOwor
CWNhc2UgRFBfUkVNT1RFX0RQQ0RfV1JJVEU6CisJCXsKKwkJCXN0cnVjdCBkcm1fZHBfcmVtb3Rl
X2RwY2Rfd3JpdGUgKncgPQorCQkJCSZyZXEtPnUuZHBjZF93cml0ZTsKKworCQkJdy0+cG9ydF9u
dW1iZXIgPSAoYnVmW2lkeF0gPj4gNCkgJiAweGY7CisKKwkJCXctPmRwY2RfYWRkcmVzcyA9IChi
dWZbaWR4XSA8PCAxNikgJiAweGYwMDAwOworCQkJdy0+ZHBjZF9hZGRyZXNzIHw9IChidWZbKytp
ZHhdIDw8IDgpICYgMHhmZjAwOworCQkJdy0+ZHBjZF9hZGRyZXNzIHw9IGJ1ZlsrK2lkeF0gJiAw
eGZmOworCisJCQl3LT5udW1fYnl0ZXMgPSBidWZbKytpZHhdOworCisJCQl3LT5ieXRlcyA9IGtt
ZW1kdXAoJmJ1ZlsrK2lkeF0sIHctPm51bV9ieXRlcywKKwkJCQkJICAgR0ZQX0tFUk5FTCk7CisJ
CQlpZiAoIXctPmJ5dGVzKQorCQkJCXJldHVybiAtRU5PTUVNOworCQl9CisJCWJyZWFrOworCWNh
c2UgRFBfUkVNT1RFX0kyQ19SRUFEOgorCQl7CisJCQlzdHJ1Y3QgZHJtX2RwX3JlbW90ZV9pMmNf
cmVhZCAqciA9ICZyZXEtPnUuaTJjX3JlYWQ7CisJCQlzdHJ1Y3QgZHJtX2RwX3JlbW90ZV9pMmNf
cmVhZF90eCAqdHg7CisJCQlib29sIGZhaWxlZCA9IGZhbHNlOworCisJCQlyLT5udW1fdHJhbnNh
Y3Rpb25zID0gYnVmW2lkeF0gJiAweDM7CisJCQlyLT5wb3J0X251bWJlciA9IChidWZbaWR4XSA+
PiA0KSAmIDB4ZjsKKwkJCWZvciAoaSA9IDA7IGkgPCByLT5udW1fdHJhbnNhY3Rpb25zOyBpKysp
IHsKKwkJCQl0eCA9ICZyLT50cmFuc2FjdGlvbnNbaV07CisKKwkJCQl0eC0+aTJjX2Rldl9pZCA9
IGJ1ZlsrK2lkeF0gJiAweDdmOworCQkJCXR4LT5udW1fYnl0ZXMgPSBidWZbKytpZHhdOworCQkJ
CXR4LT5ieXRlcyA9IGttZW1kdXAoJmJ1ZlsrK2lkeF0sCisJCQkJCQkgICAgdHgtPm51bV9ieXRl
cywKKwkJCQkJCSAgICBHRlBfS0VSTkVMKTsKKwkJCQlpZiAoIXR4LT5ieXRlcykgeworCQkJCQlm
YWlsZWQgPSB0cnVlOworCQkJCQlicmVhazsKKwkJCQl9CisJCQkJaWR4ICs9IHR4LT5udW1fYnl0
ZXM7CisJCQkJdHgtPm5vX3N0b3BfYml0ID0gKGJ1ZltpZHhdID4+IDUpICYgMHgxOworCQkJCXR4
LT5pMmNfdHJhbnNhY3Rpb25fZGVsYXkgPSBidWZbaWR4XSAmIDB4ZjsKKwkJCX0KKworCQkJaWYg
KGZhaWxlZCkgeworCQkJCWZvciAoaSA9IDA7IGkgPCByLT5udW1fdHJhbnNhY3Rpb25zOyBpKysp
CisJCQkJCWtmcmVlKHR4LT5ieXRlcyk7CisJCQkJcmV0dXJuIC1FTk9NRU07CisJCQl9CisKKwkJ
CXItPnJlYWRfaTJjX2RldmljZV9pZCA9IGJ1ZlsrK2lkeF0gJiAweDdmOworCQkJci0+bnVtX2J5
dGVzX3JlYWQgPSBidWZbKytpZHhdOworCQl9CisJCWJyZWFrOworCWNhc2UgRFBfUkVNT1RFX0ky
Q19XUklURToKKwkJeworCQkJc3RydWN0IGRybV9kcF9yZW1vdGVfaTJjX3dyaXRlICp3ID0gJnJl
cS0+dS5pMmNfd3JpdGU7CisKKwkJCXctPnBvcnRfbnVtYmVyID0gKGJ1ZltpZHhdID4+IDQpICYg
MHhmOworCQkJdy0+d3JpdGVfaTJjX2RldmljZV9pZCA9IGJ1ZlsrK2lkeF0gJiAweDdmOworCQkJ
dy0+bnVtX2J5dGVzID0gYnVmWysraWR4XTsKKwkJCXctPmJ5dGVzID0ga21lbWR1cCgmYnVmWysr
aWR4XSwgdy0+bnVtX2J5dGVzLAorCQkJCQkgICBHRlBfS0VSTkVMKTsKKwkJCWlmICghdy0+Ynl0
ZXMpCisJCQkJcmV0dXJuIC1FTk9NRU07CisJCX0KKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIDA7
Cit9CitFWFBPUlRfU1lNQk9MX0ZPUl9URVNUU19PTkxZKGRybV9kcF9kZWNvZGVfc2lkZWJhbmRf
cmVxKTsKKwordm9pZAorZHJtX2RwX2R1bXBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5KGNvbnN0IHN0
cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5ICpyZXEsCisJCQkJICBpbnQgaW5kZW50
LCBzdHJ1Y3QgZHJtX3ByaW50ZXIgKnByaW50ZXIpCit7CisJaW50IGk7CisKKyNkZWZpbmUgUChm
LCAuLi4pIGRybV9wcmludGZfaW5kZW50KHByaW50ZXIsIGluZGVudCwgZiwgIyNfX1ZBX0FSR1Nf
XykKKwlpZiAocmVxLT5yZXFfdHlwZSA9PSBEUF9MSU5LX0FERFJFU1MpIHsKKwkJLyogTm8gY29u
dGVudHMgdG8gcHJpbnQgKi8KKwkJUCgidHlwZT0lc1xuIiwgZHJtX2RwX21zdF9yZXFfdHlwZV9z
dHIocmVxLT5yZXFfdHlwZSkpOworCQlyZXR1cm47CisJfQorCisJUCgidHlwZT0lcyBjb250ZW50
czpcbiIsIGRybV9kcF9tc3RfcmVxX3R5cGVfc3RyKHJlcS0+cmVxX3R5cGUpKTsKKwlpbmRlbnQr
KzsKKworCXN3aXRjaCAocmVxLT5yZXFfdHlwZSkgeworCWNhc2UgRFBfRU5VTV9QQVRIX1JFU09V
UkNFUzoKKwljYXNlIERQX1BPV0VSX0RPV05fUEhZOgorCWNhc2UgRFBfUE9XRVJfVVBfUEhZOgor
CQlQKCJwb3J0PSVkXG4iLCByZXEtPnUucG9ydF9udW0ucG9ydF9udW1iZXIpOworCQlicmVhazsK
KwljYXNlIERQX0FMTE9DQVRFX1BBWUxPQUQ6CisJCVAoInBvcnQ9JWQgdmNwaT0lZCBwYm49JWQg
c2RwX3N0cmVhbXM9JWQgJSpwaFxuIiwKKwkJICByZXEtPnUuYWxsb2NhdGVfcGF5bG9hZC5wb3J0
X251bWJlciwKKwkJICByZXEtPnUuYWxsb2NhdGVfcGF5bG9hZC52Y3BpLCByZXEtPnUuYWxsb2Nh
dGVfcGF5bG9hZC5wYm4sCisJCSAgcmVxLT51LmFsbG9jYXRlX3BheWxvYWQubnVtYmVyX3NkcF9z
dHJlYW1zLAorCQkgIHJlcS0+dS5hbGxvY2F0ZV9wYXlsb2FkLm51bWJlcl9zZHBfc3RyZWFtcywK
KwkJICByZXEtPnUuYWxsb2NhdGVfcGF5bG9hZC5zZHBfc3RyZWFtX3NpbmspOworCQlicmVhazsK
KwljYXNlIERQX1FVRVJZX1BBWUxPQUQ6CisJCVAoInBvcnQ9JWQgdmNwaT0lZFxuIiwKKwkJICBy
ZXEtPnUucXVlcnlfcGF5bG9hZC5wb3J0X251bWJlciwKKwkJICByZXEtPnUucXVlcnlfcGF5bG9h
ZC52Y3BpKTsKKwkJYnJlYWs7CisJY2FzZSBEUF9SRU1PVEVfRFBDRF9SRUFEOgorCQlQKCJwb3J0
PSVkIGRwY2RfYWRkcj0lMDV4IGxlbj0lZFxuIiwKKwkJICByZXEtPnUuZHBjZF9yZWFkLnBvcnRf
bnVtYmVyLCByZXEtPnUuZHBjZF9yZWFkLmRwY2RfYWRkcmVzcywKKwkJICByZXEtPnUuZHBjZF9y
ZWFkLm51bV9ieXRlcyk7CisJCWJyZWFrOworCWNhc2UgRFBfUkVNT1RFX0RQQ0RfV1JJVEU6CisJ
CVAoInBvcnQ9JWQgYWRkcj0lMDV4IGxlbj0lZDogJSpwaFxuIiwKKwkJICByZXEtPnUuZHBjZF93
cml0ZS5wb3J0X251bWJlciwKKwkJICByZXEtPnUuZHBjZF93cml0ZS5kcGNkX2FkZHJlc3MsCisJ
CSAgcmVxLT51LmRwY2Rfd3JpdGUubnVtX2J5dGVzLCByZXEtPnUuZHBjZF93cml0ZS5udW1fYnl0
ZXMsCisJCSAgcmVxLT51LmRwY2Rfd3JpdGUuYnl0ZXMpOworCQlicmVhazsKKwljYXNlIERQX1JF
TU9URV9JMkNfUkVBRDoKKwkJUCgicG9ydD0lZCBudW1fdHg9JWQgaWQ9JWQgc2l6ZT0lZDpcbiIs
CisJCSAgcmVxLT51LmkyY19yZWFkLnBvcnRfbnVtYmVyLAorCQkgIHJlcS0+dS5pMmNfcmVhZC5u
dW1fdHJhbnNhY3Rpb25zLAorCQkgIHJlcS0+dS5pMmNfcmVhZC5yZWFkX2kyY19kZXZpY2VfaWQs
CisJCSAgcmVxLT51LmkyY19yZWFkLm51bV9ieXRlc19yZWFkKTsKKworCQlpbmRlbnQrKzsKKwkJ
Zm9yIChpID0gMDsgaSA8IHJlcS0+dS5pMmNfcmVhZC5udW1fdHJhbnNhY3Rpb25zOyBpKyspIHsK
KwkJCWNvbnN0IHN0cnVjdCBkcm1fZHBfcmVtb3RlX2kyY19yZWFkX3R4ICpydHggPQorCQkJCSZy
ZXEtPnUuaTJjX3JlYWQudHJhbnNhY3Rpb25zW2ldOworCisJCQlQKCIlZDogaWQ9JTAzZCBzaXpl
PSUwM2Qgbm9fc3RvcF9iaXQ9JWQgdHhfZGVsYXk9JTAzZDogJSpwaFxuIiwKKwkJCSAgaSwgcnR4
LT5pMmNfZGV2X2lkLCBydHgtPm51bV9ieXRlcywKKwkJCSAgcnR4LT5ub19zdG9wX2JpdCwgcnR4
LT5pMmNfdHJhbnNhY3Rpb25fZGVsYXksCisJCQkgIHJ0eC0+bnVtX2J5dGVzLCBydHgtPmJ5dGVz
KTsKKwkJfQorCQlicmVhazsKKwljYXNlIERQX1JFTU9URV9JMkNfV1JJVEU6CisJCVAoInBvcnQ9
JWQgaWQ9JWQgc2l6ZT0lZDogJSpwaFxuIiwKKwkJICByZXEtPnUuaTJjX3dyaXRlLnBvcnRfbnVt
YmVyLAorCQkgIHJlcS0+dS5pMmNfd3JpdGUud3JpdGVfaTJjX2RldmljZV9pZCwKKwkJICByZXEt
PnUuaTJjX3dyaXRlLm51bV9ieXRlcywgcmVxLT51LmkyY193cml0ZS5udW1fYnl0ZXMsCisJCSAg
cmVxLT51LmkyY193cml0ZS5ieXRlcyk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCVAoIj8/P1xu
Iik7CisJCWJyZWFrOworCX0KKyN1bmRlZiBQCit9CitFWFBPUlRfU1lNQk9MX0ZPUl9URVNUU19P
TkxZKGRybV9kcF9kdW1wX3NpZGViYW5kX21zZ19yZXFfYm9keSk7CisKK3N0YXRpYyBpbmxpbmUg
dm9pZAorZHJtX2RwX21zdF9kdW1wX3NpZGViYW5kX21zZ190eChzdHJ1Y3QgZHJtX3ByaW50ZXIg
KnAsCisJCQkJY29uc3Qgc3RydWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfdHggKnR4bXNnKQorewor
CXN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5IHJlcTsKKwljaGFyIGJ1Zls2NF07
CisJaW50IHJldDsKKwlpbnQgaTsKKworCWRybV9kcF9tc3RfcmFkX3RvX3N0cih0eG1zZy0+ZHN0
LT5yYWQsIHR4bXNnLT5kc3QtPmxjdCwgYnVmLAorCQkJICAgICAgc2l6ZW9mKGJ1ZikpOworCWRy
bV9wcmludGYocCwgInR4bXNnIGN1cl9vZmZzZXQ9JXggY3VyX2xlbj0leCBzZXFubz0leCBzdGF0
ZT0lcyBwYXRoX21zZz0lZCBkc3Q9JXNcbiIsCisJCSAgIHR4bXNnLT5jdXJfb2Zmc2V0LCB0eG1z
Zy0+Y3VyX2xlbiwgdHhtc2ctPnNlcW5vLAorCQkgICBkcm1fZHBfbXN0X3NpZGViYW5kX3R4X3N0
YXRlX3N0cih0eG1zZy0+c3RhdGUpLAorCQkgICB0eG1zZy0+cGF0aF9tc2csIGJ1Zik7CisKKwly
ZXQgPSBkcm1fZHBfZGVjb2RlX3NpZGViYW5kX3JlcSh0eG1zZywgJnJlcSk7CisJaWYgKHJldCkg
eworCQlkcm1fcHJpbnRmKHAsICI8ZmFpbGVkIHRvIGRlY29kZSBzaWRlYmFuZCByZXE6ICVkPlxu
IiwgcmV0KTsKKwkJcmV0dXJuOworCX0KKwlkcm1fZHBfZHVtcF9zaWRlYmFuZF9tc2dfcmVxX2Jv
ZHkoJnJlcSwgMSwgcCk7CisKKwlzd2l0Y2ggKHJlcS5yZXFfdHlwZSkgeworCWNhc2UgRFBfUkVN
T1RFX0RQQ0RfV1JJVEU6CisJCWtmcmVlKHJlcS51LmRwY2Rfd3JpdGUuYnl0ZXMpOworCQlicmVh
azsKKwljYXNlIERQX1JFTU9URV9JMkNfUkVBRDoKKwkJZm9yIChpID0gMDsgaSA8IHJlcS51Lmky
Y19yZWFkLm51bV90cmFuc2FjdGlvbnM7IGkrKykKKwkJCWtmcmVlKHJlcS51LmkyY19yZWFkLnRy
YW5zYWN0aW9uc1tpXS5ieXRlcyk7CisJCWJyZWFrOworCWNhc2UgRFBfUkVNT1RFX0kyQ19XUklU
RToKKwkJa2ZyZWUocmVxLnUuaTJjX3dyaXRlLmJ5dGVzKTsKKwkJYnJlYWs7CisJfQorfQogCiBz
dGF0aWMgdm9pZCBkcm1fZHBfY3JjX3NpZGViYW5kX2NodW5rX3JlcSh1OCAqbXNnLCB1OCBsZW4p
CiB7CkBAIC04OTMsNiArMTE3OCwxMSBAQCBzdGF0aWMgaW50IGRybV9kcF9tc3Rfd2FpdF90eF9y
ZXBseShzdHJ1Y3QgZHJtX2RwX21zdF9icmFuY2ggKm1zdGIsCiAJCX0KIAl9CiBvdXQ6CisJaWYg
KHVubGlrZWx5KHJldCA9PSAtRUlPICYmIGRybV9kZWJ1ZyAmIChEUk1fVVRfRFAgfCBEUk1fVVRf
S01TKSkpIHsKKwkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1fZGVidWdfcHJpbnRlcihEQkdf
UFJFRklYKTsKKworCQlkcm1fZHBfbXN0X2R1bXBfc2lkZWJhbmRfbXNnX3R4KCZwLCB0eG1zZyk7
CisJfQogCW11dGV4X3VubG9jaygmbWdyLT5xbG9jayk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtMTky
Nyw4ICsyMjE3LDExIEBAIHN0YXRpYyBpbnQgcHJvY2Vzc19zaW5nbGVfdHhfcWxvY2soc3RydWN0
IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCiAJaWR4ICs9IHRvc2VuZCArIDE7CiAKIAly
ZXQgPSBkcm1fZHBfc2VuZF9zaWRlYmFuZF9tc2cobWdyLCB1cCwgY2h1bmssIGlkeCk7Ci0JaWYg
KHJldCkgewotCQlEUk1fREVCVUdfS01TKCJzaWRlYmFuZCBtc2cgZmFpbGVkIHRvIHNlbmRcbiIp
OworCWlmIChyZXQgJiYgdW5saWtlbHkoZHJtX2RlYnVnICYgKERSTV9VVF9EUCB8IERSTV9VVF9L
TVMpKSkgeworCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9kZWJ1Z19wcmludGVyKERCR19Q
UkVGSVgpOworCisJCWRybV9wcmludGYoJnAsICJzaWRlYmFuZCBtc2cgZmFpbGVkIHRvIHNlbmRc
biIpOworCQlkcm1fZHBfbXN0X2R1bXBfc2lkZWJhbmRfbXNnX3R4KCZwLCB0eG1zZyk7CiAJCXJl
dHVybiByZXQ7CiAJfQogCkBAIC0xOTkwLDYgKzIyODMsMTMgQEAgc3RhdGljIHZvaWQgZHJtX2Rw
X3F1ZXVlX2Rvd25fdHgoc3RydWN0IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCiB7CiAJ
bXV0ZXhfbG9jaygmbWdyLT5xbG9jayk7CiAJbGlzdF9hZGRfdGFpbCgmdHhtc2ctPm5leHQsICZt
Z3ItPnR4X21zZ19kb3ducSk7CisKKwlpZiAodW5saWtlbHkoZHJtX2RlYnVnICYgRFJNX1VUX0RQ
KSkgeworCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9kZWJ1Z19wcmludGVyKERCR19QUkVG
SVgpOworCisJCWRybV9kcF9tc3RfZHVtcF9zaWRlYmFuZF9tc2dfdHgoJnAsIHR4bXNnKTsKKwl9
CisKIAlpZiAobGlzdF9pc19zaW5ndWxhcigmbWdyLT50eF9tc2dfZG93bnEpKQogCQlwcm9jZXNz
X3NpbmdsZV9kb3duX3R4X3Fsb2NrKG1ncik7CiAJbXV0ZXhfdW5sb2NrKCZtZ3ItPnFsb2NrKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3RvcG9sb2d5X2ludGVybmFs
LmggYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neV9pbnRlcm5hbC5oCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZWVkYTlhNjFjNjU3Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9kcF9tc3RfdG9wb2xvZ3lfaW50ZXJuYWwu
aApAQCAtMCwwICsxLDI0IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1v
bmx5CisgKgorICogRGVjbGFyYXRpb25zIGZvciBEUCBNU1QgcmVsYXRlZCBmdW5jdGlvbnMgd2hp
Y2ggYXJlIG9ubHkgdXNlZCBpbiBzZWxmdGVzdHMKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOCBS
ZWQgSGF0CisgKiBBdXRob3JzOgorICogICAgIEx5dWRlIFBhdWwgPGx5dWRlQHJlZGhhdC5jb20+
CisgKi8KKworI2lmbmRlZiBfRFJNX0RQX01TVF9IRUxQRVJfSU5URVJOQUxfSF8KKyNkZWZpbmUg
X0RSTV9EUF9NU1RfSEVMUEVSX0lOVEVSTkFMX0hfCisKKyNpbmNsdWRlIDxkcm0vZHJtX2RwX21z
dF9oZWxwZXIuaD4KKwordm9pZAorZHJtX2RwX2VuY29kZV9zaWRlYmFuZF9yZXEoY29uc3Qgc3Ry
dWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfcmVxX2JvZHkgKnJlcSwKKwkJCSAgIHN0cnVjdCBkcm1f
ZHBfc2lkZWJhbmRfbXNnX3R4ICpyYXcpOworaW50IGRybV9kcF9kZWNvZGVfc2lkZWJhbmRfcmVx
KGNvbnN0IHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3R4ICpyYXcsCisJCQkgICAgICAgc3Ry
dWN0IGRybV9kcF9zaWRlYmFuZF9tc2dfcmVxX2JvZHkgKnJlcSk7Cit2b2lkCitkcm1fZHBfZHVt
cF9zaWRlYmFuZF9tc2dfcmVxX2JvZHkoY29uc3Qgc3RydWN0IGRybV9kcF9zaWRlYmFuZF9tc2df
cmVxX2JvZHkgKnJlcSwKKwkJCQkgIGludCBpbmRlbnQsIHN0cnVjdCBkcm1fcHJpbnRlciAqcHJp
bnRlcik7CisKKyNlbmRpZiAvKiAhX0RSTV9EUF9NU1RfSEVMUEVSX0lOVEVSTkFMX0hfICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vc2VsZnRlc3RzL2RybV9tb2Rlc2V0X3NlbGZ0ZXN0
cy5oIGIvZHJpdmVycy9ncHUvZHJtL3NlbGZ0ZXN0cy9kcm1fbW9kZXNldF9zZWxmdGVzdHMuaApp
bmRleCBkZWMzZWUzZWM5NmYuLjE4OThkZTBiNGE0ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL3NlbGZ0ZXN0cy9kcm1fbW9kZXNldF9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vc2VsZnRlc3RzL2RybV9tb2Rlc2V0X3NlbGZ0ZXN0cy5oCkBAIC0zMywzICszMyw0IEBAIHNl
bGZ0ZXN0KGRhbWFnZV9pdGVyX2RhbWFnZV9vbmVfb3V0c2lkZSwgaWd0X2RhbWFnZV9pdGVyX2Rh
bWFnZV9vbmVfb3V0c2lkZSkKIHNlbGZ0ZXN0KGRhbWFnZV9pdGVyX2RhbWFnZV9zcmNfbW92ZWQs
IGlndF9kYW1hZ2VfaXRlcl9kYW1hZ2Vfc3JjX21vdmVkKQogc2VsZnRlc3QoZGFtYWdlX2l0ZXJf
ZGFtYWdlX25vdF92aXNpYmxlLCBpZ3RfZGFtYWdlX2l0ZXJfZGFtYWdlX25vdF92aXNpYmxlKQog
c2VsZnRlc3QoZHBfbXN0X2NhbGNfcGJuX21vZGUsIGlndF9kcF9tc3RfY2FsY19wYm5fbW9kZSkK
K3NlbGZ0ZXN0KGRwX21zdF9zaWRlYmFuZF9tc2dfcmVxX2RlY29kZSwgaWd0X2RwX21zdF9zaWRl
YmFuZF9tc2dfcmVxX2RlY29kZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9zZWxmdGVz
dHMvdGVzdC1kcm1fZHBfbXN0X2hlbHBlci5jIGIvZHJpdmVycy9ncHUvZHJtL3NlbGZ0ZXN0cy90
ZXN0LWRybV9kcF9tc3RfaGVscGVyLmMKaW5kZXggNTFiMjQ4NmVjOTE3Li5jZWNhODliYWJkNjUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9zZWxmdGVzdHMvdGVzdC1kcm1fZHBfbXN0X2hl
bHBlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9zZWxmdGVzdHMvdGVzdC1kcm1fZHBfbXN0X2hl
bHBlci5jCkBAIC04LDYgKzgsNyBAQAogI2luY2x1ZGUgPGRybS9kcm1fZHBfbXN0X2hlbHBlci5o
PgogI2luY2x1ZGUgPGRybS9kcm1fcHJpbnQuaD4KIAorI2luY2x1ZGUgIi4uL2RybV9kcF9tc3Rf
dG9wb2xvZ3lfaW50ZXJuYWwuaCIKICNpbmNsdWRlICJ0ZXN0LWRybV9tb2Rlc2V0X2NvbW1vbi5o
IgogCiBpbnQgaWd0X2RwX21zdF9jYWxjX3Bibl9tb2RlKHZvaWQgKmlnbm9yZWQpCkBAIC0zNCwz
ICszNSwyMTQgQEAgaW50IGlndF9kcF9tc3RfY2FsY19wYm5fbW9kZSh2b2lkICppZ25vcmVkKQog
CiAJcmV0dXJuIDA7CiB9CisKK3N0YXRpYyBib29sCitzaWRlYmFuZF9tc2dfcmVxX2VxdWFsKGNv
bnN0IHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5ICppbiwKKwkJICAgICAgIGNv
bnN0IHN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5ICpvdXQpCit7CisJY29uc3Qg
c3RydWN0IGRybV9kcF9yZW1vdGVfaTJjX3JlYWRfdHggKnR4aW4sICp0eG91dDsKKwlpbnQgaTsK
KworCWlmIChpbi0+cmVxX3R5cGUgIT0gb3V0LT5yZXFfdHlwZSkKKwkJcmV0dXJuIGZhbHNlOwor
CisJc3dpdGNoIChpbi0+cmVxX3R5cGUpIHsKKwljYXNlIERQX0VOVU1fUEFUSF9SRVNPVVJDRVM6
CisJY2FzZSBEUF9QT1dFUl9VUF9QSFk6CisJY2FzZSBEUF9QT1dFUl9ET1dOX1BIWToKKwljYXNl
IERQX0FMTE9DQVRFX1BBWUxPQUQ6CisJY2FzZSBEUF9RVUVSWV9QQVlMT0FEOgorCWNhc2UgRFBf
UkVNT1RFX0RQQ0RfUkVBRDoKKwkJcmV0dXJuIG1lbWNtcChpbiwgb3V0LCBzaXplb2YoKmluKSkg
PT0gMDsKKworCWNhc2UgRFBfUkVNT1RFX0kyQ19SRUFEOgorI2RlZmluZSBJTiBpbi0+dS5pMmNf
cmVhZAorI2RlZmluZSBPVVQgb3V0LT51LmkyY19yZWFkCisJCWlmIChJTi5udW1fYnl0ZXNfcmVh
ZCAhPSBPVVQubnVtX2J5dGVzX3JlYWQgfHwKKwkJICAgIElOLm51bV90cmFuc2FjdGlvbnMgIT0g
T1VULm51bV90cmFuc2FjdGlvbnMgfHwKKwkJICAgIElOLnBvcnRfbnVtYmVyICE9IE9VVC5wb3J0
X251bWJlciB8fAorCQkgICAgSU4ucmVhZF9pMmNfZGV2aWNlX2lkICE9IE9VVC5yZWFkX2kyY19k
ZXZpY2VfaWQpCisJCQlyZXR1cm4gZmFsc2U7CisKKwkJZm9yIChpID0gMDsgaSA8IElOLm51bV90
cmFuc2FjdGlvbnM7IGkrKykgeworCQkJdHhpbiA9ICZJTi50cmFuc2FjdGlvbnNbaV07CisJCQl0
eG91dCA9ICZPVVQudHJhbnNhY3Rpb25zW2ldOworCisJCQlpZiAodHhpbi0+aTJjX2Rldl9pZCAh
PSB0eG91dC0+aTJjX2Rldl9pZCB8fAorCQkJICAgIHR4aW4tPm5vX3N0b3BfYml0ICE9IHR4b3V0
LT5ub19zdG9wX2JpdCB8fAorCQkJICAgIHR4aW4tPm51bV9ieXRlcyAhPSB0eG91dC0+bnVtX2J5
dGVzIHx8CisJCQkgICAgdHhpbi0+aTJjX3RyYW5zYWN0aW9uX2RlbGF5ICE9CisJCQkgICAgdHhv
dXQtPmkyY190cmFuc2FjdGlvbl9kZWxheSkKKwkJCQlyZXR1cm4gZmFsc2U7CisKKwkJCWlmICht
ZW1jbXAodHhpbi0+Ynl0ZXMsIHR4b3V0LT5ieXRlcywKKwkJCQkgICB0eGluLT5udW1fYnl0ZXMp
ICE9IDApCisJCQkJcmV0dXJuIGZhbHNlOworCQl9CisJCWJyZWFrOworI3VuZGVmIElOCisjdW5k
ZWYgT1VUCisKKwljYXNlIERQX1JFTU9URV9EUENEX1dSSVRFOgorI2RlZmluZSBJTiBpbi0+dS5k
cGNkX3dyaXRlCisjZGVmaW5lIE9VVCBvdXQtPnUuZHBjZF93cml0ZQorCQlpZiAoSU4uZHBjZF9h
ZGRyZXNzICE9IE9VVC5kcGNkX2FkZHJlc3MgfHwKKwkJICAgIElOLm51bV9ieXRlcyAhPSBPVVQu
bnVtX2J5dGVzIHx8CisJCSAgICBJTi5wb3J0X251bWJlciAhPSBPVVQucG9ydF9udW1iZXIpCisJ
CQlyZXR1cm4gZmFsc2U7CisKKwkJcmV0dXJuIG1lbWNtcChJTi5ieXRlcywgT1VULmJ5dGVzLCBJ
Ti5udW1fYnl0ZXMpID09IDA7CisjdW5kZWYgSU4KKyN1bmRlZiBPVVQKKworCWNhc2UgRFBfUkVN
T1RFX0kyQ19XUklURToKKyNkZWZpbmUgSU4gaW4tPnUuaTJjX3dyaXRlCisjZGVmaW5lIE9VVCBv
dXQtPnUuaTJjX3dyaXRlCisJCWlmIChJTi5wb3J0X251bWJlciAhPSBPVVQucG9ydF9udW1iZXIg
fHwKKwkJICAgIElOLndyaXRlX2kyY19kZXZpY2VfaWQgIT0gT1VULndyaXRlX2kyY19kZXZpY2Vf
aWQgfHwKKwkJICAgIElOLm51bV9ieXRlcyAhPSBPVVQubnVtX2J5dGVzKQorCQkJcmV0dXJuIGZh
bHNlOworCisJCXJldHVybiBtZW1jbXAoSU4uYnl0ZXMsIE9VVC5ieXRlcywgSU4ubnVtX2J5dGVz
KSA9PSAwOworI3VuZGVmIElOCisjdW5kZWYgT1VUCisJfQorCisJcmV0dXJuIHRydWU7Cit9CisK
K3N0YXRpYyBpbnQKK19fc2lkZWJhbmRfbXNnX3JlcV9lbmNvZGVfZGVjb2RlKGludCBsaW5lLAor
CQkJCSBzdHJ1Y3QgZHJtX2RwX3NpZGViYW5kX21zZ19yZXFfYm9keSAqaW4sCisJCQkJIHN0cnVj
dCBkcm1fZHBfc2lkZWJhbmRfbXNnX3JlcV9ib2R5ICpvdXQpCit7CisJc3RydWN0IGRybV9wcmlu
dGVyIHAgPSBkcm1fZXJyX3ByaW50ZXIocHJfZm10KCkpOworCXN0cnVjdCBkcm1fZHBfc2lkZWJh
bmRfbXNnX3R4IHR4bXNnOworCWludCBpLCByZXQ7CisJYm9vbCBlcTsKKworCWRybV9kcF9lbmNv
ZGVfc2lkZWJhbmRfcmVxKGluLCAmdHhtc2cpOworCXJldCA9IGRybV9kcF9kZWNvZGVfc2lkZWJh
bmRfcmVxKCZ0eG1zZywgb3V0KTsKKwlpZiAocmV0IDwgMCkgeworCQlwcl9lcnIocHJfZm10KCJG
YWlsZWQgdG8gZGVjb2RlIHNpZGViYW5kIHJlcXVlc3QgQCBsaW5lICVkOiAlZFxuIiksCisJCSAg
ICAgICBsaW5lLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCWVxID0gc2lkZWJhbmRfbXNn
X3JlcV9lcXVhbChpbiwgb3V0KTsKKwlpZiAoIWVxKSB7CisJCXByX2Vycihwcl9mbXQoIkVuY29k
ZS9kZWNvZGUgQCBsaW5lICVkIGZhaWxlZCwgZXhwZWN0ZWQ6XG4iKSwKKwkJICAgICAgIGxpbmUp
OworCQlkcm1fZHBfZHVtcF9zaWRlYmFuZF9tc2dfcmVxX2JvZHkoaW4sIDEsICZwKTsKKwkJcHJf
ZXJyKHByX2ZtdCgiR290OlxuIikpOworCQlkcm1fZHBfZHVtcF9zaWRlYmFuZF9tc2dfcmVxX2Jv
ZHkob3V0LCAxLCAmcCk7CisJfQorCisJc3dpdGNoIChpbi0+cmVxX3R5cGUpIHsKKwljYXNlIERQ
X1JFTU9URV9EUENEX1dSSVRFOgorCQlrZnJlZShvdXQtPnUuZHBjZF93cml0ZS5ieXRlcyk7CisJ
CWJyZWFrOworCWNhc2UgRFBfUkVNT1RFX0kyQ19SRUFEOgorCQlmb3IgKGkgPSAwOyBpIDwgb3V0
LT51LmkyY19yZWFkLm51bV90cmFuc2FjdGlvbnM7IGkrKykKKwkJCWtmcmVlKG91dC0+dS5pMmNf
cmVhZC50cmFuc2FjdGlvbnNbaV0uYnl0ZXMpOworCQlicmVhazsKKwljYXNlIERQX1JFTU9URV9J
MkNfV1JJVEU6CisJCWtmcmVlKG91dC0+dS5pMmNfd3JpdGUuYnl0ZXMpOworCQlicmVhazsKKwl9
CisKKwkvKiBDbGVhciBldmVyeXRoaW5nIGJ1dCB0aGUgcmVxX3R5cGUgZm9yIHRoZSBpbnB1dCAq
LworCW1lbXNldCgmaW4tPnUsIDAsIHNpemVvZihpbi0+dSkpOworCisJLyogQ2xlYXIgdGhlIG91
dHB1dCBlbnRpcmVseSAqLworCW1lbXNldChvdXQsIDAsIHNpemVvZigqb3V0KSk7CisKKwlyZXR1
cm4gZXEgPyAwIDogLUVJTlZBTDsKK30KKworaW50IGlndF9kcF9tc3Rfc2lkZWJhbmRfbXNnX3Jl
cV9kZWNvZGUodm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBkcm1fZHBfc2lkZWJhbmRfbXNnX3Jl
cV9ib2R5IGluID0geyAwIH0sIG91dCA9IHsgMCB9OworCXU4IGRhdGFbXSA9IHsgMHhmZiwgMHgw
LCAweGRkIH07CisJaW50IGk7CisKKyNkZWZpbmUgRE9fVEVTVCgpICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwKKwlkbyB7ICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXAor
CQlpZiAoX19zaWRlYmFuZF9tc2dfcmVxX2VuY29kZV9kZWNvZGUoX19MSU5FX18sICZpbiwgJm91
dCkpIFwKKwkJCXJldHVybiAtRUlOVkFMOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIFwKKwl9IHdoaWxlICgwKQorCisJaW4ucmVxX3R5cGUgPSBEUF9FTlVNX1BBVEhfUkVTT1VS
Q0VTOworCWluLnUucG9ydF9udW0ucG9ydF9udW1iZXIgPSA1OworCURPX1RFU1QoKTsKKworCWlu
LnJlcV90eXBlID0gRFBfUE9XRVJfVVBfUEhZOworCWluLnUucG9ydF9udW0ucG9ydF9udW1iZXIg
PSA1OworCURPX1RFU1QoKTsKKworCWluLnJlcV90eXBlID0gRFBfUE9XRVJfRE9XTl9QSFk7CisJ
aW4udS5wb3J0X251bS5wb3J0X251bWJlciA9IDU7CisJRE9fVEVTVCgpOworCisJaW4ucmVxX3R5
cGUgPSBEUF9BTExPQ0FURV9QQVlMT0FEOworCWluLnUuYWxsb2NhdGVfcGF5bG9hZC5udW1iZXJf
c2RwX3N0cmVhbXMgPSAzOworCWZvciAoaSA9IDA7IGkgPCBpbi51LmFsbG9jYXRlX3BheWxvYWQu
bnVtYmVyX3NkcF9zdHJlYW1zOyBpKyspCisJCWluLnUuYWxsb2NhdGVfcGF5bG9hZC5zZHBfc3Ry
ZWFtX3NpbmtbaV0gPSBpICsgMTsKKwlET19URVNUKCk7CisJaW4udS5hbGxvY2F0ZV9wYXlsb2Fk
LnBvcnRfbnVtYmVyID0gMHhmOworCURPX1RFU1QoKTsKKwlpbi51LmFsbG9jYXRlX3BheWxvYWQu
dmNwaSA9IDB4N2Y7CisJRE9fVEVTVCgpOworCWluLnUuYWxsb2NhdGVfcGF5bG9hZC5wYm4gPSBV
MTZfTUFYOworCURPX1RFU1QoKTsKKworCWluLnJlcV90eXBlID0gRFBfUVVFUllfUEFZTE9BRDsK
Kwlpbi51LnF1ZXJ5X3BheWxvYWQucG9ydF9udW1iZXIgPSAweGY7CisJRE9fVEVTVCgpOworCWlu
LnUucXVlcnlfcGF5bG9hZC52Y3BpID0gMHg3ZjsKKwlET19URVNUKCk7CisKKwlpbi5yZXFfdHlw
ZSA9IERQX1JFTU9URV9EUENEX1JFQUQ7CisJaW4udS5kcGNkX3JlYWQucG9ydF9udW1iZXIgPSAw
eGY7CisJRE9fVEVTVCgpOworCWluLnUuZHBjZF9yZWFkLmRwY2RfYWRkcmVzcyA9IDB4ZmVkY2I7
CisJRE9fVEVTVCgpOworCWluLnUuZHBjZF9yZWFkLm51bV9ieXRlcyA9IFU4X01BWDsKKwlET19U
RVNUKCk7CisKKwlpbi5yZXFfdHlwZSA9IERQX1JFTU9URV9EUENEX1dSSVRFOworCWluLnUuZHBj
ZF93cml0ZS5wb3J0X251bWJlciA9IDB4ZjsKKwlET19URVNUKCk7CisJaW4udS5kcGNkX3dyaXRl
LmRwY2RfYWRkcmVzcyA9IDB4ZmVkY2I7CisJRE9fVEVTVCgpOworCWluLnUuZHBjZF93cml0ZS5u
dW1fYnl0ZXMgPSBBUlJBWV9TSVpFKGRhdGEpOworCWluLnUuZHBjZF93cml0ZS5ieXRlcyA9IGRh
dGE7CisJRE9fVEVTVCgpOworCisJaW4ucmVxX3R5cGUgPSBEUF9SRU1PVEVfSTJDX1JFQUQ7CisJ
aW4udS5pMmNfcmVhZC5wb3J0X251bWJlciA9IDB4ZjsKKwlET19URVNUKCk7CisJaW4udS5pMmNf
cmVhZC5yZWFkX2kyY19kZXZpY2VfaWQgPSAweDdmOworCURPX1RFU1QoKTsKKwlpbi51LmkyY19y
ZWFkLm51bV90cmFuc2FjdGlvbnMgPSAzOworCWluLnUuaTJjX3JlYWQubnVtX2J5dGVzX3JlYWQg
PSBBUlJBWV9TSVpFKGRhdGEpICogMzsKKwlmb3IgKGkgPSAwOyBpIDwgaW4udS5pMmNfcmVhZC5u
dW1fdHJhbnNhY3Rpb25zOyBpKyspIHsKKwkJaW4udS5pMmNfcmVhZC50cmFuc2FjdGlvbnNbaV0u
Ynl0ZXMgPSBkYXRhOworCQlpbi51LmkyY19yZWFkLnRyYW5zYWN0aW9uc1tpXS5udW1fYnl0ZXMg
PSBBUlJBWV9TSVpFKGRhdGEpOworCQlpbi51LmkyY19yZWFkLnRyYW5zYWN0aW9uc1tpXS5pMmNf
ZGV2X2lkID0gMHg3ZiAmIH5pOworCQlpbi51LmkyY19yZWFkLnRyYW5zYWN0aW9uc1tpXS5pMmNf
dHJhbnNhY3Rpb25fZGVsYXkgPSAweGYgJiB+aTsKKwl9CisJRE9fVEVTVCgpOworCisJaW4ucmVx
X3R5cGUgPSBEUF9SRU1PVEVfSTJDX1dSSVRFOworCWluLnUuaTJjX3dyaXRlLnBvcnRfbnVtYmVy
ID0gMHhmOworCURPX1RFU1QoKTsKKwlpbi51LmkyY193cml0ZS53cml0ZV9pMmNfZGV2aWNlX2lk
ID0gMHg3ZjsKKwlET19URVNUKCk7CisJaW4udS5pMmNfd3JpdGUubnVtX2J5dGVzID0gQVJSQVlf
U0laRShkYXRhKTsKKwlpbi51LmkyY193cml0ZS5ieXRlcyA9IGRhdGE7CisJRE9fVEVTVCgpOwor
CisjdW5kZWYgRE9fVEVTVAorCXJldHVybiAwOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3NlbGZ0ZXN0cy90ZXN0LWRybV9tb2Rlc2V0X2NvbW1vbi5oIGIvZHJpdmVycy9ncHUvZHJt
L3NlbGZ0ZXN0cy90ZXN0LWRybV9tb2Rlc2V0X2NvbW1vbi5oCmluZGV4IDU5MGJkYTM1YTY4My4u
MGZjYjhiYmM2YTFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vc2VsZnRlc3RzL3Rlc3Qt
ZHJtX21vZGVzZXRfY29tbW9uLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL3NlbGZ0ZXN0cy90ZXN0
LWRybV9tb2Rlc2V0X2NvbW1vbi5oCkBAIC00MCw1ICs0MCw2IEBAIGludCBpZ3RfZGFtYWdlX2l0
ZXJfZGFtYWdlX29uZV9vdXRzaWRlKHZvaWQgKmlnbm9yZWQpOwogaW50IGlndF9kYW1hZ2VfaXRl
cl9kYW1hZ2Vfc3JjX21vdmVkKHZvaWQgKmlnbm9yZWQpOwogaW50IGlndF9kYW1hZ2VfaXRlcl9k
YW1hZ2Vfbm90X3Zpc2libGUodm9pZCAqaWdub3JlZCk7CiBpbnQgaWd0X2RwX21zdF9jYWxjX3Bi
bl9tb2RlKHZvaWQgKmlnbm9yZWQpOworaW50IGlndF9kcF9tc3Rfc2lkZWJhbmRfbXNnX3JlcV9k
ZWNvZGUodm9pZCAqaWdub3JlZCk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0v
ZHJtX2RwX21zdF9oZWxwZXIuaCBiL2luY2x1ZGUvZHJtL2RybV9kcF9tc3RfaGVscGVyLmgKaW5k
ZXggYzAxZjNlYTcyNzU2Li40YzhkMTc3ZTgzZTUgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvZHJtL2Ry
bV9kcF9tc3RfaGVscGVyLmgKKysrIGIvaW5jbHVkZS9kcm0vZHJtX2RwX21zdF9oZWxwZXIuaApA
QCAtMjkzLDcgKzI5Myw3IEBAIHN0cnVjdCBkcm1fZHBfcmVtb3RlX2RwY2Rfd3JpdGUgewogc3Ry
dWN0IGRybV9kcF9yZW1vdGVfaTJjX3JlYWQgewogCXU4IG51bV90cmFuc2FjdGlvbnM7CiAJdTgg
cG9ydF9udW1iZXI7Ci0Jc3RydWN0IHsKKwlzdHJ1Y3QgZHJtX2RwX3JlbW90ZV9pMmNfcmVhZF90
eCB7CiAJCXU4IGkyY19kZXZfaWQ7CiAJCXU4IG51bV9ieXRlczsKIAkJdTggKmJ5dGVzOwotLSAK
Mi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpk
cmktZGV2ZWwgbWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
