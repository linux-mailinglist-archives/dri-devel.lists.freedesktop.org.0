Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9E2916EF88
	for <lists+dri-devel@lfdr.de>; Sat, 20 Jul 2019 15:47:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D4AD96E8B8;
	Sat, 20 Jul 2019 13:47:27 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from smtp.domeneshop.no (smtp.domeneshop.no
 [IPv6:2a01:5b40:0:3005::1])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8EBC96E8B6
 for <dri-devel@lists.freedesktop.org>; Sat, 20 Jul 2019 13:47:19 +0000 (UTC)
Received: from 211.81-166-168.customer.lyse.net ([81.166.168.211]:56672
 helo=localhost.localdomain)
 by smtp.domeneshop.no with esmtpsa (TLS1.2:ECDHE_RSA_AES_128_CBC_SHA1:128)
 (Exim 4.84_2) (envelope-from <noralf@tronnes.org>)
 id 1hophl-0003FR-JT; Sat, 20 Jul 2019 15:47:17 +0200
From: =?UTF-8?q?Noralf=20Tr=C3=B8nnes?= <noralf@tronnes.org>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH 3/6] drm/tinydrm: Rename remaining variable mipi -> dbidev
Date: Sat, 20 Jul 2019 15:47:06 +0200
Message-Id: <20190720134709.15186-4-noralf@tronnes.org>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190720134709.15186-1-noralf@tronnes.org>
References: <20190720134709.15186-1-noralf@tronnes.org>
MIME-Version: 1.0
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt;
 c=relaxed/relaxed; d=tronnes.org; s=ds201810; 
 h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-Id:Date:Subject:Cc:To:From;
 bh=wbWF04cnkg/oKkDlooERSw/emxx3CpMq0KLVmDmikE4=; 
 b=RJsk8yv9jiFiKDItqEPkswjsAixaE76GzI6smlws3lMW5V30SH0XNcb8Xk4P8fnFyzFbGnkqkxB7sVZPSITQdQ7xGvRRTMQXIhTqTxGdd+oDm8tGXq7DhuC+NsGqz0FGITNU0/1ijXQg4gS5hl+war5vhMKE7xB5HCLEaLeb8cSYDbOKY39MjiOu8/CjulautZvsLBPbIGkIHifYweAocrz0LWJQUxbfJXPkrugXMsNIM9R6xceCDLHgh1xDDc9kNpknCUKHVtLqxLb4+Mg61PYBSEtvSR2tfHMIeeK+gDHnnRguSmtQWrLKyepY+c8PHILHucfwwzK1MShQcBuxMw==;
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: david@lechnology.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

c3RydWN0IG1pcGlfZGJpIGlzIGdvaW5nIHRvIGJlIHNwbGl0IGludG8gYW4gaW50ZXJmYWNlIHBh
cnQgYW5kIGEgZGlzcGxheQpwaXBlbGluZSBwYXJ0LiBUaGUgaW50ZXJmYWNlIHBhcnQgY2FuIGJl
IHVzZWQgYnkgZHJpdmVycyB0aGF0IG5lZWQgdG8KaW5pdGlhbGl6ZSB0aGUgY29udHJvbGxlciwg
YnV0IHRoYXQgd29uJ3QgdXBsb2FkIHRoZSBmcmFtZWJ1ZmZlciBvdmVyCnRoaXMgaW50ZXJmYWNl
LgoKdGlueWRybSB1c2VzIHRoZSB2YXJpYWJsZSBuYW1lICdtaXBpJyBidXQgdGhpcyBpcyBub3Qg
YSBnb29kIG5hbWUgc2luY2UKTUlQSSByZWZlcnMgdG8gYSBsb3Qgb2Ygc3RhbmRhcmRzLiBUaGlz
IHBhdGNoIGNoYW5nZXMgdGhlIHZhcmlhYmxlIG5hbWUKdG8gJ2RiaWRldicgd2hlcmUgaXQgcmVm
ZXJzIHRvIHRoZSBwaXBlbGluZSBwYXJ0IG9mIHN0cnVjdCBtaXBpX2RiaS4KCkNjOiBFcmljIEFu
aG9sdCA8ZXJpY0BhbmhvbHQubmV0PgpDYzogRGF2aWQgTGVjaG5lciA8ZGF2aWRAbGVjaG5vbG9n
eS5jb20+ClNpZ25lZC1vZmYtYnk6IE5vcmFsZiBUcsO4bm5lcyA8bm9yYWxmQHRyb25uZXMub3Jn
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2h4ODM1N2QuYyAgfCAgMzAgKysrKy0tLS0K
IGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL2lsaTkyMjUuYyAgfCAgNDIgKysrKystLS0tLQogZHJp
dmVycy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTM0MS5jICB8ICAzMCArKysrLS0tLQogZHJpdmVycy9n
cHUvZHJtL3Rpbnlkcm0vbWkwMjgzcXQuYyB8ICAzNiArKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS90aW55ZHJtL21pcGktZGJpLmMgfCAxMjAgKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS90aW55ZHJtL3N0NzU4Ni5jICAgfCAgMzQgKysrKy0tLS0KIGRyaXZl
cnMvZ3B1L2RybS90aW55ZHJtL3N0NzczNXIuYyAgfCAgMzAgKysrKy0tLS0KIGluY2x1ZGUvZHJt
L3Rpbnlkcm0vbWlwaS1kYmkuaCAgICAgfCAgMTAgKy0tCiA4IGZpbGVzIGNoYW5nZWQsIDE2NiBp
bnNlcnRpb25zKCspLCAxNjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL3Rpbnlkcm0vaHg4MzU3ZC5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaHg4MzU3ZC5j
CmluZGV4IGY1MDNkMTRhYTM2Yi4uZTExM2M0MzRmZjU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vdGlueWRybS9oeDgzNTdkLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaHg4
MzU3ZC5jCkBAIC00Nyw4ICs0Nyw4IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3Ry
dWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJICAgICBzdHJ1Y3QgZHJtX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2RiaShw
aXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkgPSBtaXBpOworCXN0cnVjdCBt
aXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1
Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAl1OCBhZGRyX21vZGU7CiAJaW50IHJldCwgaWR4
OwogCkBAIC01Nyw3ICs1Nyw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3RydWN0
IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsK
IAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQobWlwaSk7CisJcmV0
ID0gbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9yZXNldChkYmlkZXYpOwogCWlmIChyZXQg
PCAwKQogCQlnb3RvIG91dF9leGl0OwogCWlmIChyZXQgPT0gMSkKQEAgLTE1OSw3ICsxNTksNyBA
QCBzdGF0aWMgdm9pZCB5eDI0MHF2MjlfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlf
cGlwZSAqcGlwZSwKIAl1c2xlZXBfcmFuZ2UoNTAwMCwgNzAwMCk7CiAKIG91dF9lbmFibGU6Ci0J
c3dpdGNoIChtaXBpLT5yb3RhdGlvbikgeworCXN3aXRjaCAoZGJpZGV2LT5yb3RhdGlvbikgewog
CWRlZmF1bHQ6CiAJCWFkZHJfbW9kZSA9IEhYODM1N0RfTUFEQ1RMX01YIHwgSFg4MzU3RF9NQURD
VExfTVk7CiAJCWJyZWFrOwpAQCAtMTc0LDcgKzE3NCw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYy
OV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCQlicmVhazsK
IAl9CiAJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NFVF9BRERSRVNTX01PREUsIGFk
ZHJfbW9kZSk7Ci0JbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKG1pcGksIGNydGNfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKKwltaXBpX2RiaV9lbmFibGVfZmx1c2goZGJpZGV2LCBjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7CiBvdXRfZXhpdDoKIAlkcm1fZGV2X2V4aXQoaWR4KTsKIH0KQEAgLTIyMCwyMCAr
MjIwLDIwIEBAIE1PRFVMRV9ERVZJQ0VfVEFCTEUoc3BpLCBoeDgzNTdkX2lkKTsKIHN0YXRpYyBp
bnQgaHg4MzU3ZF9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogewogCXN0cnVjdCBkZXZp
Y2UgKmRldiA9ICZzcGktPmRldjsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldjsKIAlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZHJtOwotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaTsKIAlzdHJ1Y3QgZ3Bpb19k
ZXNjICpkYzsKIAl1MzIgcm90YXRpb24gPSAwOwogCWludCByZXQ7CiAKLQltaXBpID0ga3phbGxv
YyhzaXplb2YoKm1pcGkpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIW1pcGkpCisJZGJpZGV2ID0ga3ph
bGxvYyhzaXplb2YoKmRiaWRldiksIEdGUF9LRVJORUwpOworCWlmICghZGJpZGV2KQogCQlyZXR1
cm4gLUVOT01FTTsKIAotCWRybSA9ICZtaXBpLT5kcm07CisJZHJtID0gJmRiaWRldi0+ZHJtOwog
CXJldCA9IGRldm1fZHJtX2Rldl9pbml0KGRldiwgZHJtLCAmaHg4MzU3ZF9kcml2ZXIpOwogCWlm
IChyZXQpIHsKLQkJa2ZyZWUobWlwaSk7CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7
CiAJfQogCkBAIC0yNDUsMTcgKzI0NSwxNyBAQCBzdGF0aWMgaW50IGh4ODM1N2RfcHJvYmUoc3Ry
dWN0IHNwaV9kZXZpY2UgKnNwaSkKIAkJcmV0dXJuIFBUUl9FUlIoZGMpOwogCX0KIAotCW1pcGkt
PmJhY2tsaWdodCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKLQlpZiAoSVNfRVJSKG1p
cGktPmJhY2tsaWdodCkpCi0JCXJldHVybiBQVFJfRVJSKG1pcGktPmJhY2tsaWdodCk7CisJZGJp
ZGV2LT5iYWNrbGlnaHQgPSBkZXZtX29mX2ZpbmRfYmFja2xpZ2h0KGRldik7CisJaWYgKElTX0VS
UihkYmlkZXYtPmJhY2tsaWdodCkpCisJCXJldHVybiBQVFJfRVJSKGRiaWRldi0+YmFja2xpZ2h0
KTsKIAogCWRldmljZV9wcm9wZXJ0eV9yZWFkX3UzMihkZXYsICJyb3RhdGlvbiIsICZyb3RhdGlv
bik7CiAKLQlyZXQgPSBtaXBpX2RiaV9zcGlfaW5pdChzcGksIG1pcGksIGRjKTsKKwlyZXQgPSBt
aXBpX2RiaV9zcGlfaW5pdChzcGksIGRiaWRldiwgZGMpOwogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKLQlyZXQgPSBtaXBpX2RiaV9pbml0KG1pcGksICZoeDgzNTdkX3BpcGVfZnVuY3MsICZ5
eDM1MGh2MTVfbW9kZSwgcm90YXRpb24pOworCXJldCA9IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAm
aHg4MzU3ZF9waXBlX2Z1bmNzLCAmeXgzNTBodjE1X21vZGUsIHJvdGF0aW9uKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9p
bGk5MjI1LmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKaW5kZXggYzgzN2Qx
NDIzMzYyLi4yMDlhNzVkYWI3Y2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJt
L2lsaTkyMjUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MjI1LmMKQEAgLTc4
LDEwICs3OCwxMCBAQCBzdGF0aWMgaW5saW5lIGludCBpbGk5MjI1X2NvbW1hbmQoc3RydWN0IG1p
cGlfZGJpICpkYmksIHU4IGNtZCwgdTE2IGRhdGEpCiBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2Rp
cnR5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiB7
CiAJc3RydWN0IGRybV9nZW1fY21hX29iamVjdCAqY21hX29iaiA9IGRybV9mYl9jbWFfZ2V0X2dl
bV9vYmooZmIsIDApOwotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2RiaShm
Yi0+ZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9IGRybV90b19taXBpX2RiaShmYi0+
ZGV2KTsKIAl1bnNpZ25lZCBpbnQgaGVpZ2h0ID0gcmVjdC0+eTIgLSByZWN0LT55MTsKIAl1bnNp
Z25lZCBpbnQgd2lkdGggPSByZWN0LT54MiAtIHJlY3QtPngxOwotCXN0cnVjdCBtaXBpX2RiaSAq
ZGJpID0gbWlwaTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAlib29sIHN3YXAg
PSBkYmktPnN3YXBfYnl0ZXM7CiAJdTE2IHhfc3RhcnQsIHlfc3RhcnQ7CiAJdTE2IHgxLCB4Miwg
eTEsIHkyOwpAQCAtODksNyArODksNyBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2RpcnR5KHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiAJYm9vbCBm
dWxsOwogCXZvaWQgKnRyOwogCi0JaWYgKCFtaXBpLT5lbmFibGVkKQorCWlmICghZGJpZGV2LT5l
bmFibGVkKQogCQlyZXR1cm47CiAKIAlpZiAoIWRybV9kZXZfZW50ZXIoZmItPmRldiwgJmlkeCkp
CkBAIC0xMDEsMTUgKzEwMSwxNSBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X2ZiX2RpcnR5KHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiAKIAlpZiAoIWRi
aS0+ZGMgfHwgIWZ1bGwgfHwgc3dhcCB8fAogCSAgICBmYi0+Zm9ybWF0LT5mb3JtYXQgPT0gRFJN
X0ZPUk1BVF9YUkdCODg4OCkgewotCQl0ciA9IG1pcGktPnR4X2J1ZjsKLQkJcmV0ID0gbWlwaV9k
YmlfYnVmX2NvcHkobWlwaS0+dHhfYnVmLCBmYiwgcmVjdCwgc3dhcCk7CisJCXRyID0gZGJpZGV2
LT50eF9idWY7CisJCXJldCA9IG1pcGlfZGJpX2J1Zl9jb3B5KGRiaWRldi0+dHhfYnVmLCBmYiwg
cmVjdCwgc3dhcCk7CiAJCWlmIChyZXQpCiAJCQlnb3RvIGVycl9tc2c7CiAJfSBlbHNlIHsKIAkJ
dHIgPSBjbWFfb2JqLT52YWRkcjsKIAl9CiAKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJ
c3dpdGNoIChkYmlkZXYtPnJvdGF0aW9uKSB7CiAJZGVmYXVsdDoKIAkJeDEgPSByZWN0LT54MTsK
IAkJeDIgPSByZWN0LT54MiAtIDE7CkBAIC0xODMsMTAgKzE4MywxMCBAQCBzdGF0aWMgdm9pZCBp
bGk5MjI1X3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwK
IAkJCQlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJc3RydWN0IGRybV9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0gZHJt
X3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9
IGRybV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRldik7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+ZmI7CiAJc3RydWN0IGRldmljZSAqZGV2ID0gcGlwZS0+Y3J0
Yy5kZXYtPmRldjsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IG1pcGlf
ZGJpICpkYmkgPSBkYmlkZXY7CiAJc3RydWN0IGRybV9yZWN0IHJlY3QgPSB7CiAJCS54MSA9IDAs
CiAJCS54MiA9IGZiLT53aWR0aCwKQEAgLTIzMyw3ICsyMzMsNyBAQCBzdGF0aWMgdm9pZCBpbGk5
MjI1X3BpcGVfZW5hYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAog
CW1zbGVlcCg1MCk7CiAKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJc3dpdGNoIChkYmlk
ZXYtPnJvdGF0aW9uKSB7CiAJZGVmYXVsdDoKIAkJYW1faWQgPSAweDMwOwogCQlicmVhazsKQEAg
LTI4Myw3ICsyODMsNyBAQCBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVfZW5hYmxlKHN0cnVjdCBk
cm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAogCWlsaTkyMjVfY29tbWFuZChkYmksIElM
STkyMjVfRElTUExBWV9DT05UUk9MXzEsIDB4MTAxNyk7CiAKLQltaXBpLT5lbmFibGVkID0gdHJ1
ZTsKKwlkYmlkZXYtPmVuYWJsZWQgPSB0cnVlOwogCWlsaTkyMjVfZmJfZGlydHkoZmIsICZyZWN0
KTsKIG91dF9leGl0OgogCWRybV9kZXZfZXhpdChpZHgpOwpAQCAtMjkxLDggKzI5MSw4IEBAIHN0
YXRpYyB2b2lkIGlsaTkyMjVfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9w
aXBlICpwaXBlLAogCiBzdGF0aWMgdm9pZCBpbGk5MjI1X3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJt
X3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0g
ZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9
IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmlkZXYgPSBkcm1fdG9fbWlwaV9kYmkocGlwZS0+
Y3J0Yy5kZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2OwogCiAJRFJNX0RFQlVH
X0tNUygiXG4iKTsKIApAQCAtMzAzLDcgKzMwMyw3IEBAIHN0YXRpYyB2b2lkIGlsaTkyMjVfcGlw
ZV9kaXNhYmxlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSkKIAkgKiB1bnBs
dWcuCiAJICovCiAKLQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFkYmlkZXYtPmVuYWJsZWQp
CiAJCXJldHVybjsKIAogCWlsaTkyMjVfY29tbWFuZChkYmksIElMSTkyMjVfRElTUExBWV9DT05U
Uk9MXzEsIDB4MDAwMCk7CkBAIC0zMTIsNyArMzEyLDcgQEAgc3RhdGljIHZvaWQgaWxpOTIyNV9w
aXBlX2Rpc2FibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlKQogCW1zbGVl
cCg1MCk7CiAJaWxpOTIyNV9jb21tYW5kKGRiaSwgSUxJOTIyNV9QT1dFUl9DT05UUk9MXzEsIDB4
MGEwMik7CiAKLQltaXBpLT5lbmFibGVkID0gZmFsc2U7CisJZGJpZGV2LT5lbmFibGVkID0gZmFs
c2U7CiB9CiAKIHN0YXRpYyBpbnQgaWxpOTIyNV9kYmlfY29tbWFuZChzdHJ1Y3QgbWlwaV9kYmkg
KmRiaSwgdTggKmNtZCwgdTggKnBhciwKQEAgLTM3OCwyMiArMzc4LDIyIEBAIE1PRFVMRV9ERVZJ
Q0VfVEFCTEUoc3BpLCBpbGk5MjI1X2lkKTsKIHN0YXRpYyBpbnQgaWxpOTIyNV9wcm9iZShzdHJ1
Y3Qgc3BpX2RldmljZSAqc3BpKQogewogCXN0cnVjdCBkZXZpY2UgKmRldiA9ICZzcGktPmRldjsK
KwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldjsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtOwotCXN0
cnVjdCBtaXBpX2RiaSAqbWlwaTsKIAlzdHJ1Y3QgbWlwaV9kYmkgKmRiaTsKIAlzdHJ1Y3QgZ3Bp
b19kZXNjICpyczsKIAl1MzIgcm90YXRpb24gPSAwOwogCWludCByZXQ7CiAKLQltaXBpID0ga3ph
bGxvYyhzaXplb2YoKm1pcGkpLCBHRlBfS0VSTkVMKTsKLQlpZiAoIW1pcGkpCisJZGJpZGV2ID0g
a3phbGxvYyhzaXplb2YoKmRiaWRldiksIEdGUF9LRVJORUwpOworCWlmICghZGJpZGV2KQogCQly
ZXR1cm4gLUVOT01FTTsKIAotCWRiaSA9IG1pcGk7Ci0JZHJtID0gJm1pcGktPmRybTsKKwlkYmkg
PSBkYmlkZXY7CisJZHJtID0gJmRiaWRldi0+ZHJtOwogCXJldCA9IGRldm1fZHJtX2Rldl9pbml0
KGRldiwgZHJtLCAmaWxpOTIyNV9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJa2ZyZWUobWlwaSk7
CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC00MjAsNyArNDIwLDcg
QEAgc3RhdGljIGludCBpbGk5MjI1X3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCiAJLyog
b3ZlcnJpZGUgdGhlIGNvbW1hbmQgZnVuY3Rpb24gc2V0IGluICBtaXBpX2RiaV9zcGlfaW5pdCgp
ICovCiAJZGJpLT5jb21tYW5kID0gaWxpOTIyNV9kYmlfY29tbWFuZDsKIAotCXJldCA9IG1pcGlf
ZGJpX2luaXQobWlwaSwgJmlsaTkyMjVfcGlwZV9mdW5jcywgJmlsaTkyMjVfbW9kZSwgcm90YXRp
b24pOworCXJldCA9IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAmaWxpOTIyNV9waXBlX2Z1bmNzLCAm
aWxpOTIyNV9tb2RlLCByb3RhdGlvbik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTM0MS5jIGIvZHJpdmVycy9ncHUv
ZHJtL3Rpbnlkcm0vaWxpOTM0MS5jCmluZGV4IDA1YmE1YWIxN2VjNi4uZGZhOGM2ZTk1MmM4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9pbGk5MzQxLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL3Rpbnlkcm0vaWxpOTM0MS5jCkBAIC01Myw4ICs1Myw4IEBAIHN0YXRpYyB2b2lk
IHl4MjQwcXYyOV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAog
CQkJICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIHN0cnVj
dCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAqbWlw
aSA9IGRybV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpk
YmkgPSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBp
cGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAl1OCBhZGRy
X21vZGU7CiAJaW50IHJldCwgaWR4OwogCkBAIC02Myw3ICs2Myw3IEBAIHN0YXRpYyB2b2lkIHl4
MjQwcXYyOV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJ
RFJNX0RFQlVHX0tNUygiXG4iKTsKIAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9u
YWxfcmVzZXQobWlwaSk7CisJcmV0ID0gbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9yZXNl
dChkYmlkZXYpOwogCWlmIChyZXQgPCAwKQogCQlnb3RvIG91dF9leGl0OwogCWlmIChyZXQgPT0g
MSkKQEAgLTExMyw3ICsxMTMsNyBAQCBzdGF0aWMgdm9pZCB5eDI0MHF2MjlfZW5hYmxlKHN0cnVj
dCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZSAqcGlwZSwKIAltc2xlZXAoMTAwKTsKIAogb3V0X2Vu
YWJsZToKLQlzd2l0Y2ggKG1pcGktPnJvdGF0aW9uKSB7CisJc3dpdGNoIChkYmlkZXYtPnJvdGF0
aW9uKSB7CiAJZGVmYXVsdDoKIAkJYWRkcl9tb2RlID0gSUxJOTM0MV9NQURDVExfTVg7CiAJCWJy
ZWFrOwpAQCAtMTMwLDcgKzEzMCw3IEBAIHN0YXRpYyB2b2lkIHl4MjQwcXYyOV9lbmFibGUoc3Ry
dWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCX0KIAlhZGRyX21vZGUgfD0gSUxJ
OTM0MV9NQURDVExfQkdSOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfQURE
UkVTU19NT0RFLCBhZGRyX21vZGUpOwotCW1pcGlfZGJpX2VuYWJsZV9mbHVzaChtaXBpLCBjcnRj
X3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKGRiaWRldiwgY3J0
Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwogb3V0X2V4aXQ6CiAJZHJtX2Rldl9leGl0KGlkeCk7CiB9
CkBAIC0xNzYsMjIgKzE3NiwyMiBAQCBNT0RVTEVfREVWSUNFX1RBQkxFKHNwaSwgaWxpOTM0MV9p
ZCk7CiBzdGF0aWMgaW50IGlsaTkzNDFfcHJvYmUoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSkKIHsK
IAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmc3BpLT5kZXY7CisJc3RydWN0IG1pcGlfZGJpICpkYmlk
ZXY7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGk7CiAJ
c3RydWN0IG1pcGlfZGJpICpkYmk7CiAJc3RydWN0IGdwaW9fZGVzYyAqZGM7CiAJdTMyIHJvdGF0
aW9uID0gMDsKIAlpbnQgcmV0OwogCi0JbWlwaSA9IGt6YWxsb2Moc2l6ZW9mKCptaXBpKSwgR0ZQ
X0tFUk5FTCk7Ci0JaWYgKCFtaXBpKQorCWRiaWRldiA9IGt6YWxsb2Moc2l6ZW9mKCpkYmlkZXYp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRldikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlkYmkg
PSBtaXBpOwotCWRybSA9ICZtaXBpLT5kcm07CisJZGJpID0gZGJpZGV2OworCWRybSA9ICZkYmlk
ZXYtPmRybTsKIAlyZXQgPSBkZXZtX2RybV9kZXZfaW5pdChkZXYsIGRybSwgJmlsaTkzNDFfZHJp
dmVyKTsKIAlpZiAocmV0KSB7Ci0JCWtmcmVlKG1pcGkpOworCQlrZnJlZShkYmlkZXYpOwogCQly
ZXR1cm4gcmV0OwogCX0KIApAQCAtMjA5LDkgKzIwOSw5IEBAIHN0YXRpYyBpbnQgaWxpOTM0MV9w
cm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCQlyZXR1cm4gUFRSX0VSUihkYyk7CiAJfQog
Ci0JbWlwaS0+YmFja2xpZ2h0ID0gZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYpOwotCWlmIChJ
U19FUlIobWlwaS0+YmFja2xpZ2h0KSkKLQkJcmV0dXJuIFBUUl9FUlIobWlwaS0+YmFja2xpZ2h0
KTsKKwlkYmlkZXYtPmJhY2tsaWdodCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKKwlp
ZiAoSVNfRVJSKGRiaWRldi0+YmFja2xpZ2h0KSkKKwkJcmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5i
YWNrbGlnaHQpOwogCiAJZGV2aWNlX3Byb3BlcnR5X3JlYWRfdTMyKGRldiwgInJvdGF0aW9uIiwg
JnJvdGF0aW9uKTsKIApAQCAtMjE5LDcgKzIxOSw3IEBAIHN0YXRpYyBpbnQgaWxpOTM0MV9wcm9i
ZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQly
ZXQgPSBtaXBpX2RiaV9pbml0KG1pcGksICZpbGk5MzQxX3BpcGVfZnVuY3MsICZ5eDI0MHF2Mjlf
bW9kZSwgcm90YXRpb24pOworCXJldCA9IG1pcGlfZGJpX2luaXQoZGJpZGV2LCAmaWxpOTM0MV9w
aXBlX2Z1bmNzLCAmeXgyNDBxdjI5X21vZGUsIHJvdGF0aW9uKTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9taTAyODNxdC5j
IGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWkwMjgzcXQuYwppbmRleCBhZGM4YzQ4NzJkM2Yu
LjlkMjg0ZmIyNGMzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWkwMjgz
cXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9taTAyODNxdC5jCkBAIC01MSw4ICs1
MSw4IEBAIHN0YXRpYyB2b2lkIG1pMDI4M3F0X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNw
bGF5X3BpcGUgKnBpcGUsCiAJCQkgICAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkJICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVj
dCBtaXBpX2RiaSAqbWlwaSA9IGRybV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRldik7Ci0Jc3Ry
dWN0IG1pcGlfZGJpICpkYmkgPSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJt
X3RvX21pcGlfZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRi
aWRldjsKIAl1OCBhZGRyX21vZGU7CiAJaW50IHJldCwgaWR4OwogCkBAIC02MSw3ICs2MSw3IEBA
IHN0YXRpYyB2b2lkIG1pMDI4M3F0X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3Bp
cGUgKnBpcGUsCiAKIAlEUk1fREVCVUdfS01TKCJcbiIpOwogCi0JcmV0ID0gbWlwaV9kYmlfcG93
ZXJvbl9jb25kaXRpb25hbF9yZXNldChtaXBpKTsKKwlyZXQgPSBtaXBpX2RiaV9wb3dlcm9uX2Nv
bmRpdGlvbmFsX3Jlc2V0KGRiaWRldik7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8gb3V0X2V4aXQ7
CiAJaWYgKHJldCA9PSAxKQpAQCAtMTE3LDcgKzExNyw3IEBAIHN0YXRpYyB2b2lkIG1pMDI4M3F0
X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJICogQXMgYSBy
ZXN1bHQsIHdlIG5lZWQgdG8gYWx3YXlzIGFwcGx5IHRoZSByb3RhdGlvbiB2YWx1ZQogCSAqIHJl
Z2FyZGxlc3Mgb2YgdGhlIGRpc3BsYXkgIm9uL29mZiIgc3RhdGUuCiAJICovCi0Jc3dpdGNoICht
aXBpLT5yb3RhdGlvbikgeworCXN3aXRjaCAoZGJpZGV2LT5yb3RhdGlvbikgewogCWRlZmF1bHQ6
CiAJCWFkZHJfbW9kZSA9IElMSTkzNDFfTUFEQ1RMX01WIHwgSUxJOTM0MV9NQURDVExfTVkgfAog
CQkJICAgIElMSTkzNDFfTUFEQ1RMX01YOwpAQCAtMTM0LDcgKzEzNCw3IEBAIHN0YXRpYyB2b2lk
IG1pMDI4M3F0X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJ
fQogCWFkZHJfbW9kZSB8PSBJTEk5MzQxX01BRENUTF9CR1I7CiAJbWlwaV9kYmlfY29tbWFuZChk
YmksIE1JUElfRENTX1NFVF9BRERSRVNTX01PREUsIGFkZHJfbW9kZSk7Ci0JbWlwaV9kYmlfZW5h
YmxlX2ZsdXNoKG1pcGksIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwltaXBpX2RiaV9lbmFi
bGVfZmx1c2goZGJpZGV2LCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiBvdXRfZXhpdDoKIAlk
cm1fZGV2X2V4aXQoaWR4KTsKIH0KQEAgLTE4MCwyMiArMTgwLDIyIEBAIE1PRFVMRV9ERVZJQ0Vf
VEFCTEUoc3BpLCBtaTAyODNxdF9pZCk7CiBzdGF0aWMgaW50IG1pMDI4M3F0X3Byb2JlKHN0cnVj
dCBzcGlfZGV2aWNlICpzcGkpCiB7CiAJc3RydWN0IGRldmljZSAqZGV2ID0gJnNwaS0+ZGV2Owor
CXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2OwogCXN0cnVjdCBkcm1fZGV2aWNlICpkcm07Ci0Jc3Ry
dWN0IG1pcGlfZGJpICptaXBpOwogCXN0cnVjdCBtaXBpX2RiaSAqZGJpOwogCXN0cnVjdCBncGlv
X2Rlc2MgKmRjOwogCXUzMiByb3RhdGlvbiA9IDA7CiAJaW50IHJldDsKIAotCW1pcGkgPSBremFs
bG9jKHNpemVvZigqbWlwaSksIEdGUF9LRVJORUwpOwotCWlmICghbWlwaSkKKwlkYmlkZXYgPSBr
emFsbG9jKHNpemVvZigqZGJpZGV2KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFkYmlkZXYpCiAJCXJl
dHVybiAtRU5PTUVNOwogCi0JZGJpID0gbWlwaTsKLQlkcm0gPSAmbWlwaS0+ZHJtOworCWRiaSA9
IGRiaWRldjsKKwlkcm0gPSAmZGJpZGV2LT5kcm07CiAJcmV0ID0gZGV2bV9kcm1fZGV2X2luaXQo
ZGV2LCBkcm0sICZtaTAyODNxdF9kcml2ZXIpOwogCWlmIChyZXQpIHsKLQkJa2ZyZWUobWlwaSk7
CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC0yMTMsMTMgKzIxMywx
MyBAQCBzdGF0aWMgaW50IG1pMDI4M3F0X3Byb2JlKHN0cnVjdCBzcGlfZGV2aWNlICpzcGkpCiAJ
CXJldHVybiBQVFJfRVJSKGRjKTsKIAl9CiAKLQltaXBpLT5yZWd1bGF0b3IgPSBkZXZtX3JlZ3Vs
YXRvcl9nZXQoZGV2LCAicG93ZXIiKTsKLQlpZiAoSVNfRVJSKG1pcGktPnJlZ3VsYXRvcikpCi0J
CXJldHVybiBQVFJfRVJSKG1pcGktPnJlZ3VsYXRvcik7CisJZGJpZGV2LT5yZWd1bGF0b3IgPSBk
ZXZtX3JlZ3VsYXRvcl9nZXQoZGV2LCAicG93ZXIiKTsKKwlpZiAoSVNfRVJSKGRiaWRldi0+cmVn
dWxhdG9yKSkKKwkJcmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5yZWd1bGF0b3IpOwogCi0JbWlwaS0+
YmFja2xpZ2h0ID0gZGV2bV9vZl9maW5kX2JhY2tsaWdodChkZXYpOwotCWlmIChJU19FUlIobWlw
aS0+YmFja2xpZ2h0KSkKLQkJcmV0dXJuIFBUUl9FUlIobWlwaS0+YmFja2xpZ2h0KTsKKwlkYmlk
ZXYtPmJhY2tsaWdodCA9IGRldm1fb2ZfZmluZF9iYWNrbGlnaHQoZGV2KTsKKwlpZiAoSVNfRVJS
KGRiaWRldi0+YmFja2xpZ2h0KSkKKwkJcmV0dXJuIFBUUl9FUlIoZGJpZGV2LT5iYWNrbGlnaHQp
OwogCiAJZGV2aWNlX3Byb3BlcnR5X3JlYWRfdTMyKGRldiwgInJvdGF0aW9uIiwgJnJvdGF0aW9u
KTsKIApAQCAtMjI3LDcgKzIyNyw3IEBAIHN0YXRpYyBpbnQgbWkwMjgzcXRfcHJvYmUoc3RydWN0
IHNwaV9kZXZpY2UgKnNwaSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gbWlw
aV9kYmlfaW5pdChtaXBpLCAmbWkwMjgzcXRfcGlwZV9mdW5jcywgJm1pMDI4M3F0X21vZGUsIHJv
dGF0aW9uKTsKKwlyZXQgPSBtaXBpX2RiaV9pbml0KGRiaWRldiwgJm1pMDI4M3F0X3BpcGVfZnVu
Y3MsICZtaTAyODNxdF9tb2RlLCByb3RhdGlvbik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuYyBiL2RyaXZl
cnMvZ3B1L2RybS90aW55ZHJtL21pcGktZGJpLmMKaW5kZXggOTNiOWIzYWM1NTY4Li45NWIwMzJh
NGIzNGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL21pcGktZGJpLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuYwpAQCAtMjQxLDE2ICsyNDEsMTYg
QEAgRVhQT1JUX1NZTUJPTChtaXBpX2RiaV9idWZfY29weSk7CiBzdGF0aWMgdm9pZCBtaXBpX2Ri
aV9mYl9kaXJ0eShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgc3RydWN0IGRybV9yZWN0ICpy
ZWN0KQogewogCXN0cnVjdCBkcm1fZ2VtX2NtYV9vYmplY3QgKmNtYV9vYmogPSBkcm1fZmJfY21h
X2dldF9nZW1fb2JqKGZiLCAwKTsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlw
aV9kYmkoZmItPmRldik7CisJc3RydWN0IG1pcGlfZGJpICpkYmlkZXYgPSBkcm1fdG9fbWlwaV9k
YmkoZmItPmRldik7CiAJdW5zaWduZWQgaW50IGhlaWdodCA9IHJlY3QtPnkyIC0gcmVjdC0+eTE7
CiAJdW5zaWduZWQgaW50IHdpZHRoID0gcmVjdC0+eDIgLSByZWN0LT54MTsKLQlzdHJ1Y3QgbWlw
aV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmkgPSBkYmlkZXY7CiAJYm9v
bCBzd2FwID0gZGJpLT5zd2FwX2J5dGVzOwogCWludCBpZHgsIHJldCA9IDA7CiAJYm9vbCBmdWxs
OwogCXZvaWQgKnRyOwogCi0JaWYgKCFtaXBpLT5lbmFibGVkKQorCWlmICghZGJpZGV2LT5lbmFi
bGVkKQogCQlyZXR1cm47CiAKIAlpZiAoIWRybV9kZXZfZW50ZXIoZmItPmRldiwgJmlkeCkpCkBA
IC0yNjIsOCArMjYyLDggQEAgc3RhdGljIHZvaWQgbWlwaV9kYmlfZmJfZGlydHkoc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIAogCWlmICghZGJpLT5k
YyB8fCAhZnVsbCB8fCBzd2FwIHx8CiAJICAgIGZiLT5mb3JtYXQtPmZvcm1hdCA9PSBEUk1fRk9S
TUFUX1hSR0I4ODg4KSB7Ci0JCXRyID0gbWlwaS0+dHhfYnVmOwotCQlyZXQgPSBtaXBpX2RiaV9i
dWZfY29weShtaXBpLT50eF9idWYsIGZiLCByZWN0LCBzd2FwKTsKKwkJdHIgPSBkYmlkZXYtPnR4
X2J1ZjsKKwkJcmV0ID0gbWlwaV9kYmlfYnVmX2NvcHkoZGJpZGV2LT50eF9idWYsIGZiLCByZWN0
LCBzd2FwKTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gZXJyX21zZzsKIAl9IGVsc2UgewpAQCAtMzE1
LDcgKzMxNSw3IEBAIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcGlwZV91cGRhdGUpOwogCiAvKioK
ICAqIG1pcGlfZGJpX2VuYWJsZV9mbHVzaCAtIE1JUEkgREJJIGVuYWJsZSBoZWxwZXIKLSAqIEBt
aXBpOiBNSVBJIERCSSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJIGRldmljZSBzdHJ1
Y3R1cmUKICAqIEBjcnRjX3N0YXRlOiBDUlRDIHN0YXRlCiAgKiBAcGxhbmVfc3RhdGU6IFBsYW5l
IHN0YXRlCiAgKgpAQCAtMzI3LDcgKzMyNyw3IEBAIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcGlw
ZV91cGRhdGUpOwogICogZnJhbWVidWZmZXIgZmx1c2hpbmcsIGNhbid0IHVzZSB0aGlzIGZ1bmN0
aW9uIHNpbmNlIHRoZXkgYm90aCB1c2UgdGhlIHNhbWUKICAqIGZsdXNoaW5nIGNvZGUuCiAgKi8K
LXZvaWQgbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK3ZvaWQg
bWlwaV9kYmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2LAogCQkJICAgc3Ry
dWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7CkBAIC0zNDAsMzcgKzM0MCwzNyBAQCB2b2lkIG1pcGlfZGJp
X2VuYWJsZV9mbHVzaChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksCiAJfTsKIAlpbnQgaWR4OwogCi0J
aWYgKCFkcm1fZGV2X2VudGVyKCZtaXBpLT5kcm0sICZpZHgpKQorCWlmICghZHJtX2Rldl9lbnRl
cigmZGJpZGV2LT5kcm0sICZpZHgpKQogCQlyZXR1cm47CiAKLQltaXBpLT5lbmFibGVkID0gdHJ1
ZTsKKwlkYmlkZXYtPmVuYWJsZWQgPSB0cnVlOwogCW1pcGlfZGJpX2ZiX2RpcnR5KGZiLCAmcmVj
dCk7Ci0JYmFja2xpZ2h0X2VuYWJsZShtaXBpLT5iYWNrbGlnaHQpOworCWJhY2tsaWdodF9lbmFi
bGUoZGJpZGV2LT5iYWNrbGlnaHQpOwogCiAJZHJtX2Rldl9leGl0KGlkeCk7CiB9CiBFWFBPUlRf
U1lNQk9MKG1pcGlfZGJpX2VuYWJsZV9mbHVzaCk7CiAKLXN0YXRpYyB2b2lkIG1pcGlfZGJpX2Js
YW5rKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSkKK3N0YXRpYyB2b2lkIG1pcGlfZGJpX2JsYW5rKHN0
cnVjdCBtaXBpX2RiaSAqZGJpZGV2KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmbWlw
aS0+ZHJtOworCXN0cnVjdCBkcm1fZGV2aWNlICpkcm0gPSAmZGJpZGV2LT5kcm07CiAJdTE2IGhl
aWdodCA9IGRybS0+bW9kZV9jb25maWcubWluX2hlaWdodDsKIAl1MTYgd2lkdGggPSBkcm0tPm1v
ZGVfY29uZmlnLm1pbl93aWR0aDsKIAlzaXplX3QgbGVuID0gd2lkdGggKiBoZWlnaHQgKiAyOwot
CXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gbWlwaTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRi
aWRldjsKIAlpbnQgaWR4OwogCiAJaWYgKCFkcm1fZGV2X2VudGVyKGRybSwgJmlkeCkpCiAJCXJl
dHVybjsKIAotCW1lbXNldChtaXBpLT50eF9idWYsIDAsIGxlbik7CisJbWVtc2V0KGRiaWRldi0+
dHhfYnVmLCAwLCBsZW4pOwogCiAJbWlwaV9kYmlfY29tbWFuZChkYmksIE1JUElfRENTX1NFVF9D
T0xVTU5fQUREUkVTUywgMCwgMCwKIAkJCSAod2lkdGggPj4gOCkgJiAweEZGLCAod2lkdGggLSAx
KSAmIDB4RkYpOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TRVRfUEFHRV9BRERS
RVNTLCAwLCAwLAogCQkJIChoZWlnaHQgPj4gOCkgJiAweEZGLCAoaGVpZ2h0IC0gMSkgJiAweEZG
KTsKIAltaXBpX2RiaV9jb21tYW5kX2J1ZihkYmksIE1JUElfRENTX1dSSVRFX01FTU9SWV9TVEFS
VCwKLQkJCSAgICAgKHU4ICopbWlwaS0+dHhfYnVmLCBsZW4pOworCQkJICAgICAodTggKilkYmlk
ZXYtPnR4X2J1ZiwgbGVuKTsKIAogCWRybV9kZXZfZXhpdChpZHgpOwogfQpAQCAtMzg1LDMxICsz
ODUsMzEgQEAgc3RhdGljIHZvaWQgbWlwaV9kYmlfYmxhbmsoc3RydWN0IG1pcGlfZGJpICptaXBp
KQogICovCiB2b2lkIG1pcGlfZGJpX3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNw
bGF5X3BpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IG1pcGlfZGJpICptaXBpID0gZHJtX3RvX21pcGlf
ZGJpKHBpcGUtPmNydGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiA9IGRybV90b19t
aXBpX2RiaShwaXBlLT5jcnRjLmRldik7CiAKLQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFk
YmlkZXYtPmVuYWJsZWQpCiAJCXJldHVybjsKIAogCURSTV9ERUJVR19LTVMoIlxuIik7CiAKLQlt
aXBpLT5lbmFibGVkID0gZmFsc2U7CisJZGJpZGV2LT5lbmFibGVkID0gZmFsc2U7CiAKLQlpZiAo
bWlwaS0+YmFja2xpZ2h0KQotCQliYWNrbGlnaHRfZGlzYWJsZShtaXBpLT5iYWNrbGlnaHQpOwor
CWlmIChkYmlkZXYtPmJhY2tsaWdodCkKKwkJYmFja2xpZ2h0X2Rpc2FibGUoZGJpZGV2LT5iYWNr
bGlnaHQpOwogCWVsc2UKLQkJbWlwaV9kYmlfYmxhbmsobWlwaSk7CisJCW1pcGlfZGJpX2JsYW5r
KGRiaWRldik7CiAKLQlpZiAobWlwaS0+cmVndWxhdG9yKQotCQlyZWd1bGF0b3JfZGlzYWJsZSht
aXBpLT5yZWd1bGF0b3IpOworCWlmIChkYmlkZXYtPnJlZ3VsYXRvcikKKwkJcmVndWxhdG9yX2Rp
c2FibGUoZGJpZGV2LT5yZWd1bGF0b3IpOwogfQogRVhQT1JUX1NZTUJPTChtaXBpX2RiaV9waXBl
X2Rpc2FibGUpOwogCiBzdGF0aWMgaW50IG1pcGlfZGJpX2Nvbm5lY3Rvcl9nZXRfbW9kZXMoc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGkg
PSBkcm1fdG9fbWlwaV9kYmkoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJp
ZGV2ID0gZHJtX3RvX21pcGlfZGJpKGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZTsKIAotCW1vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUoY29ubmVjdG9yLT5k
ZXYsICZtaXBpLT5tb2RlKTsKKwltb2RlID0gZHJtX21vZGVfZHVwbGljYXRlKGNvbm5lY3Rvci0+
ZGV2LCAmZGJpZGV2LT5tb2RlKTsKIAlpZiAoIW1vZGUpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQg
dG8gZHVwbGljYXRlIG1vZGVcbiIpOwogCQlyZXR1cm4gMDsKQEAgLTQ3MSw3ICs0NzEsNyBAQCBz
dGF0aWMgY29uc3QgdWludDMyX3QgbWlwaV9kYmlfZm9ybWF0c1tdID0gewogCiAvKioKICAqIG1p
cGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzIC0gTUlQSSBEQkkgaW5pdGlhbGl6YXRpb24gd2l0aCBj
dXN0b20gZm9ybWF0cwotICogQG1pcGk6ICZtaXBpX2RiaSBzdHJ1Y3R1cmUgdG8gaW5pdGlhbGl6
ZQorICogQGRiaWRldjogTUlQSSBEQkkgZGV2aWNlIHN0cnVjdHVyZSB0byBpbml0aWFsaXplCiAg
KiBAZnVuY3M6IERpc3BsYXkgcGlwZSBmdW5jdGlvbnMKICAqIEBmb3JtYXRzOiBBcnJheSBvZiBz
dXBwb3J0ZWQgZm9ybWF0cyAoRFJNX0ZPUk1BVFxfXCopLgogICogQGZvcm1hdF9jb3VudDogTnVt
YmVyIG9mIGVsZW1lbnRzIGluIEBmb3JtYXRzCkBAIC00OTIsNyArNDkyLDcgQEAgc3RhdGljIGNv
bnN0IHVpbnQzMl90IG1pcGlfZGJpX2Zvcm1hdHNbXSA9IHsKICAqIFJldHVybnM6CiAgKiBaZXJv
IG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwotaW50IG1p
cGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK2ludCBtaXBp
X2RiaV9pbml0X3dpdGhfZm9ybWF0cyhzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiwKIAkJCSAgICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgKmZ1bmNzLAogCQkJ
ICAgICAgIGNvbnN0IHVpbnQzMl90ICpmb3JtYXRzLCB1bnNpZ25lZCBpbnQgZm9ybWF0X2NvdW50
LAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLApAQCAtNTAy
LDQyICs1MDIsNDIgQEAgaW50IG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzKHN0cnVjdCBtaXBp
X2RiaSAqbWlwaSwKIAkJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAogCQlEUk1fRk9STUFUX01PRF9J
TlZBTElECiAJfTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZHJtID0gJm1pcGktPmRybTsKKwlzdHJ1
Y3QgZHJtX2RldmljZSAqZHJtID0gJmRiaWRldi0+ZHJtOwogCWludCByZXQ7CiAKLQlpZiAoIW1p
cGktPmNvbW1hbmQpCisJaWYgKCFkYmlkZXYtPmNvbW1hbmQpCiAJCXJldHVybiAtRUlOVkFMOwog
Ci0JbWlwaS0+dHhfYnVmID0gZGV2bV9rbWFsbG9jKGRybS0+ZGV2LCB0eF9idWZfc2l6ZSwgR0ZQ
X0tFUk5FTCk7Ci0JaWYgKCFtaXBpLT50eF9idWYpCisJZGJpZGV2LT50eF9idWYgPSBkZXZtX2tt
YWxsb2MoZHJtLT5kZXYsIHR4X2J1Zl9zaXplLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRldi0+
dHhfYnVmKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWRybV9tb2RlX2NvcHkoJm1pcGktPm1vZGUs
IG1vZGUpOwotCXJldCA9IG1pcGlfZGJpX3JvdGF0ZV9tb2RlKCZtaXBpLT5tb2RlLCByb3RhdGlv
bik7CisJZHJtX21vZGVfY29weSgmZGJpZGV2LT5tb2RlLCBtb2RlKTsKKwlyZXQgPSBtaXBpX2Ri
aV9yb3RhdGVfbW9kZSgmZGJpZGV2LT5tb2RlLCByb3RhdGlvbik7CiAJaWYgKHJldCkgewogCQlE
Uk1fRVJST1IoIklsbGVnYWwgcm90YXRpb24gdmFsdWUgJXVcbiIsIHJvdGF0aW9uKTsKIAkJcmV0
dXJuIC1FSU5WQUw7CiAJfQogCi0JZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRkKCZtaXBpLT5jb25u
ZWN0b3IsICZtaXBpX2RiaV9jb25uZWN0b3JfaGZ1bmNzKTsKLQlyZXQgPSBkcm1fY29ubmVjdG9y
X2luaXQoZHJtLCAmbWlwaS0+Y29ubmVjdG9yLCAmbWlwaV9kYmlfY29ubmVjdG9yX2Z1bmNzLAor
CWRybV9jb25uZWN0b3JfaGVscGVyX2FkZCgmZGJpZGV2LT5jb25uZWN0b3IsICZtaXBpX2RiaV9j
b25uZWN0b3JfaGZ1bmNzKTsKKwlyZXQgPSBkcm1fY29ubmVjdG9yX2luaXQoZHJtLCAmZGJpZGV2
LT5jb25uZWN0b3IsICZtaXBpX2RiaV9jb25uZWN0b3JfZnVuY3MsCiAJCQkJIERSTV9NT0RFX0NP
Tk5FQ1RPUl9TUEkpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBkcm1fc2lt
cGxlX2Rpc3BsYXlfcGlwZV9pbml0KGRybSwgJm1pcGktPnBpcGUsIGZ1bmNzLCBmb3JtYXRzLCBm
b3JtYXRfY291bnQsCi0JCQkJCSAgIG1vZGlmaWVycywgJm1pcGktPmNvbm5lY3Rvcik7CisJcmV0
ID0gZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfaW5pdChkcm0sICZkYmlkZXYtPnBpcGUsIGZ1bmNz
LCBmb3JtYXRzLCBmb3JtYXRfY291bnQsCisJCQkJCSAgIG1vZGlmaWVycywgJmRiaWRldi0+Y29u
bmVjdG9yKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JZHJtX3BsYW5lX2VuYWJsZV9m
Yl9kYW1hZ2VfY2xpcHMoJm1pcGktPnBpcGUucGxhbmUpOworCWRybV9wbGFuZV9lbmFibGVfZmJf
ZGFtYWdlX2NsaXBzKCZkYmlkZXYtPnBpcGUucGxhbmUpOwogCiAJZHJtLT5tb2RlX2NvbmZpZy5m
dW5jcyA9ICZtaXBpX2RiaV9tb2RlX2NvbmZpZ19mdW5jczsKLQlkcm0tPm1vZGVfY29uZmlnLm1p
bl93aWR0aCA9IG1pcGktPm1vZGUuaGRpc3BsYXk7Ci0JZHJtLT5tb2RlX2NvbmZpZy5tYXhfd2lk
dGggPSBtaXBpLT5tb2RlLmhkaXNwbGF5OwotCWRybS0+bW9kZV9jb25maWcubWluX2hlaWdodCA9
IG1pcGktPm1vZGUudmRpc3BsYXk7Ci0JZHJtLT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0ID0gbWlw
aS0+bW9kZS52ZGlzcGxheTsKLQltaXBpLT5yb3RhdGlvbiA9IHJvdGF0aW9uOworCWRybS0+bW9k
ZV9jb25maWcubWluX3dpZHRoID0gZGJpZGV2LT5tb2RlLmhkaXNwbGF5OworCWRybS0+bW9kZV9j
b25maWcubWF4X3dpZHRoID0gZGJpZGV2LT5tb2RlLmhkaXNwbGF5OworCWRybS0+bW9kZV9jb25m
aWcubWluX2hlaWdodCA9IGRiaWRldi0+bW9kZS52ZGlzcGxheTsKKwlkcm0tPm1vZGVfY29uZmln
Lm1heF9oZWlnaHQgPSBkYmlkZXYtPm1vZGUudmRpc3BsYXk7CisJZGJpZGV2LT5yb3RhdGlvbiA9
IHJvdGF0aW9uOwogCiAJRFJNX0RFQlVHX0tNUygicm90YXRpb24gPSAldVxuIiwgcm90YXRpb24p
OwogCkBAIC01NDcsNyArNTQ3LDcgQEAgRVhQT1JUX1NZTUJPTChtaXBpX2RiaV9pbml0X3dpdGhf
Zm9ybWF0cyk7CiAKIC8qKgogICogbWlwaV9kYmlfaW5pdCAtIE1JUEkgREJJIGluaXRpYWxpemF0
aW9uCi0gKiBAbWlwaTogJm1pcGlfZGJpIHN0cnVjdHVyZSB0byBpbml0aWFsaXplCisgKiBAZGJp
ZGV2OiBNSVBJIERCSSBkZXZpY2Ugc3RydWN0dXJlIHRvIGluaXRpYWxpemUKICAqIEBmdW5jczog
RGlzcGxheSBwaXBlIGZ1bmN0aW9ucwogICogQG1vZGU6IERpc3BsYXkgbW9kZQogICogQHJvdGF0
aW9uOiBJbml0aWFsIHJvdGF0aW9uIGluIGRlZ3JlZXMgQ291bnRlciBDbG9jayBXaXNlCkBAIC01
NjIsMTUgKzU2MiwxNSBAQCBFWFBPUlRfU1lNQk9MKG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRz
KTsKICAqIFJldHVybnM6CiAgKiBaZXJvIG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUg
b24gZmFpbHVyZS4KICAqLwotaW50IG1pcGlfZGJpX2luaXQoc3RydWN0IG1pcGlfZGJpICptaXBp
LAoraW50IG1pcGlfZGJpX2luaXQoc3RydWN0IG1pcGlfZGJpICpkYmlkZXYsCiAJCSAgY29uc3Qg
c3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlX2Z1bmNzICpmdW5jcywKIAkJICBjb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwgdW5zaWduZWQgaW50IHJvdGF0aW9uKQogewog
CXNpemVfdCBidWZzaXplID0gbW9kZS0+dmRpc3BsYXkgKiBtb2RlLT5oZGlzcGxheSAqIHNpemVv
Zih1MTYpOwogCi0JbWlwaS0+ZHJtLm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDE2Owor
CWRiaWRldi0+ZHJtLm1vZGVfY29uZmlnLnByZWZlcnJlZF9kZXB0aCA9IDE2OwogCi0JcmV0dXJu
IG1pcGlfZGJpX2luaXRfd2l0aF9mb3JtYXRzKG1pcGksIGZ1bmNzLCBtaXBpX2RiaV9mb3JtYXRz
LAorCXJldHVybiBtaXBpX2RiaV9pbml0X3dpdGhfZm9ybWF0cyhkYmlkZXYsIGZ1bmNzLCBtaXBp
X2RiaV9mb3JtYXRzLAogCQkJCQkgIEFSUkFZX1NJWkUobWlwaV9kYmlfZm9ybWF0cyksIG1vZGUs
CiAJCQkJCSAgcm90YXRpb24sIGJ1ZnNpemUpOwogfQpAQCAtNjQ2LDE0ICs2NDYsMTQgQEAgYm9v
bCBtaXBpX2RiaV9kaXNwbGF5X2lzX29uKHN0cnVjdCBtaXBpX2RiaSAqZGJpKQogfQogRVhQT1JU
X1NZTUJPTChtaXBpX2RiaV9kaXNwbGF5X2lzX29uKTsKIAotc3RhdGljIGludCBtaXBpX2RiaV9w
b3dlcm9uX3Jlc2V0X2NvbmRpdGlvbmFsKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwgYm9vbCBjb25k
KQorc3RhdGljIGludCBtaXBpX2RiaV9wb3dlcm9uX3Jlc2V0X2NvbmRpdGlvbmFsKHN0cnVjdCBt
aXBpX2RiaSAqZGJpZGV2LCBib29sIGNvbmQpCiB7Ci0Jc3RydWN0IGRldmljZSAqZGV2ID0gbWlw
aS0+ZHJtLmRldjsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IGRldmlj
ZSAqZGV2ID0gZGJpZGV2LT5kcm0uZGV2OworCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2
OwogCWludCByZXQ7CiAKLQlpZiAobWlwaS0+cmVndWxhdG9yKSB7Ci0JCXJldCA9IHJlZ3VsYXRv
cl9lbmFibGUobWlwaS0+cmVndWxhdG9yKTsKKwlpZiAoZGJpZGV2LT5yZWd1bGF0b3IpIHsKKwkJ
cmV0ID0gcmVndWxhdG9yX2VuYWJsZShkYmlkZXYtPnJlZ3VsYXRvcik7CiAJCWlmIChyZXQpIHsK
IAkJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIGVuYWJsZSByZWd1bGF0b3IgKCVkKVxu
IiwgcmV0KTsKIAkJCXJldHVybiByZXQ7CkBAIC02NjcsOCArNjY3LDggQEAgc3RhdGljIGludCBt
aXBpX2RiaV9wb3dlcm9uX3Jlc2V0X2NvbmRpdGlvbmFsKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwg
Ym9vbCBjb25kKQogCXJldCA9IG1pcGlfZGJpX2NvbW1hbmQoZGJpLCBNSVBJX0RDU19TT0ZUX1JF
U0VUKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERVZfRVJST1IoZGV2LCAiRmFpbGVkIHRvIHNlbmQg
cmVzZXQgY29tbWFuZCAoJWQpXG4iLCByZXQpOwotCQlpZiAobWlwaS0+cmVndWxhdG9yKQotCQkJ
cmVndWxhdG9yX2Rpc2FibGUobWlwaS0+cmVndWxhdG9yKTsKKwkJaWYgKGRiaWRldi0+cmVndWxh
dG9yKQorCQkJcmVndWxhdG9yX2Rpc2FibGUoZGJpZGV2LT5yZWd1bGF0b3IpOwogCQlyZXR1cm4g
cmV0OwogCX0KIApAQCAtNjg3LDcgKzY4Nyw3IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfcG93ZXJv
bl9yZXNldF9jb25kaXRpb25hbChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIGJvb2wgY29uZCkKIAog
LyoqCiAgKiBtaXBpX2RiaV9wb3dlcm9uX3Jlc2V0IC0gTUlQSSBEQkkgcG93ZXJvbiBhbmQgcmVz
ZXQKLSAqIEBtaXBpOiBNSVBJIERCSSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJIGRl
dmljZSBzdHJ1Y3R1cmUKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGVuYWJsZXMgdGhlIHJlZ3VsYXRv
ciBpZiB1c2VkIGFuZCBkb2VzIGEgaGFyZHdhcmUgYW5kIHNvZnR3YXJlCiAgKiByZXNldC4KQEAg
LTY5NSwxNSArNjk1LDE1IEBAIHN0YXRpYyBpbnQgbWlwaV9kYmlfcG93ZXJvbl9yZXNldF9jb25k
aXRpb25hbChzdHJ1Y3QgbWlwaV9kYmkgKm1pcGksIGJvb2wgY29uZCkKICAqIFJldHVybnM6CiAg
KiBaZXJvIG9uIHN1Y2Nlc3MsIG9yIGEgbmVnYXRpdmUgZXJyb3IgY29kZS4KICAqLwotaW50IG1p
cGlfZGJpX3Bvd2Vyb25fcmVzZXQoc3RydWN0IG1pcGlfZGJpICptaXBpKQoraW50IG1pcGlfZGJp
X3Bvd2Vyb25fcmVzZXQoc3RydWN0IG1pcGlfZGJpICpkYmlkZXYpCiB7Ci0JcmV0dXJuIG1pcGlf
ZGJpX3Bvd2Vyb25fcmVzZXRfY29uZGl0aW9uYWwobWlwaSwgZmFsc2UpOworCXJldHVybiBtaXBp
X2RiaV9wb3dlcm9uX3Jlc2V0X2NvbmRpdGlvbmFsKGRiaWRldiwgZmFsc2UpOwogfQogRVhQT1JU
X1NZTUJPTChtaXBpX2RiaV9wb3dlcm9uX3Jlc2V0KTsKIAogLyoqCiAgKiBtaXBpX2RiaV9wb3dl
cm9uX2NvbmRpdGlvbmFsX3Jlc2V0IC0gTUlQSSBEQkkgcG93ZXJvbiBhbmQgY29uZGl0aW9uYWwg
cmVzZXQKLSAqIEBtaXBpOiBNSVBJIERCSSBzdHJ1Y3R1cmUKKyAqIEBkYmlkZXY6IE1JUEkgREJJ
IGRldmljZSBzdHJ1Y3R1cmUKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGVuYWJsZXMgdGhlIHJlZ3Vs
YXRvciBpZiB1c2VkIGFuZCBpZiB0aGUgZGlzcGxheSBpcyBvZmYsIGl0CiAgKiBkb2VzIGEgaGFy
ZHdhcmUgYW5kIHNvZnR3YXJlIHJlc2V0LiBJZiBtaXBpX2RiaV9kaXNwbGF5X2lzX29uKCkgZGV0
ZXJtaW5lcwpAQCAtNzEzLDkgKzcxMyw5IEBAIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcG93ZXJv
bl9yZXNldCk7CiAgKiBaZXJvIGlmIHRoZSBjb250cm9sbGVyIHdhcyByZXNldCwgMSBpZiB0aGUg
ZGlzcGxheSB3YXMgYWxyZWFkeSBvbiwgb3IgYQogICogbmVnYXRpdmUgZXJyb3IgY29kZS4KICAq
LwotaW50IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQoc3RydWN0IG1pcGlfZGJp
ICptaXBpKQoraW50IG1pcGlfZGJpX3Bvd2Vyb25fY29uZGl0aW9uYWxfcmVzZXQoc3RydWN0IG1p
cGlfZGJpICpkYmlkZXYpCiB7Ci0JcmV0dXJuIG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXRfY29uZGl0
aW9uYWwobWlwaSwgdHJ1ZSk7CisJcmV0dXJuIG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXRfY29uZGl0
aW9uYWwoZGJpZGV2LCB0cnVlKTsKIH0KIEVYUE9SVF9TWU1CT0wobWlwaV9kYmlfcG93ZXJvbl9j
b25kaXRpb25hbF9yZXNldCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJt
L3N0NzU4Ni5jIGIvZHJpdmVycy9ncHUvZHJtL3Rpbnlkcm0vc3Q3NTg2LmMKaW5kZXggODMzOWU3
ZGM1ZDkyLi5jZjBkN2EyNjAwOWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJt
L3N0NzU4Ni5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS90aW55ZHJtL3N0NzU4Ni5jCkBAIC0xMTQs
MTEgKzExNCwxMSBAQCBzdGF0aWMgaW50IHN0NzU4Nl9idWZfY29weSh2b2lkICpkc3QsIHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCiBzdGF0aWMgdm9pZCBzdDc1ODZfZmJfZGlydHkoc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIHsKLQlzdHJ1
Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlwaV9kYmkoZmItPmRldik7Ci0Jc3RydWN0IG1p
cGlfZGJpICpkYmkgPSBtaXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21p
cGlfZGJpKGZiLT5kZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpID0gZGJpZGV2OwogCWludCBz
dGFydCwgZW5kLCBpZHgsIHJldCA9IDA7CiAKLQlpZiAoIW1pcGktPmVuYWJsZWQpCisJaWYgKCFk
YmlkZXYtPmVuYWJsZWQpCiAJCXJldHVybjsKIAogCWlmICghZHJtX2Rldl9lbnRlcihmYi0+ZGV2
LCAmaWR4KSkKQEAgLTEzMCw3ICsxMzAsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfZmJfZGlydHko
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIHN0cnVjdCBkcm1fcmVjdCAqcmVjdCkKIAogCURS
TV9ERUJVR19LTVMoIkZsdXNoaW5nIFtGQjolZF0gIiBEUk1fUkVDVF9GTVQgIlxuIiwgZmItPmJh
c2UuaWQsIERSTV9SRUNUX0FSRyhyZWN0KSk7CiAKLQlyZXQgPSBzdDc1ODZfYnVmX2NvcHkobWlw
aS0+dHhfYnVmLCBmYiwgcmVjdCk7CisJcmV0ID0gc3Q3NTg2X2J1Zl9jb3B5KGRiaWRldi0+dHhf
YnVmLCBmYiwgcmVjdCk7CiAJaWYgKHJldCkKIAkJZ290byBlcnJfbXNnOwogCkBAIC0xNDYsNyAr
MTQ2LDcgQEAgc3RhdGljIHZvaWQgc3Q3NTg2X2ZiX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBzdHJ1Y3QgZHJtX3JlY3QgKnJlY3QpCiAJCQkgKHJlY3QtPnkyID4+IDgpICYgMHhG
RiwgKHJlY3QtPnkyIC0gMSkgJiAweEZGKTsKIAogCXJldCA9IG1pcGlfZGJpX2NvbW1hbmRfYnVm
KGRiaSwgTUlQSV9EQ1NfV1JJVEVfTUVNT1JZX1NUQVJULAotCQkJCSAgICh1OCAqKW1pcGktPnR4
X2J1ZiwKKwkJCQkgICAodTggKilkYmlkZXYtPnR4X2J1ZiwKIAkJCQkgICAoZW5kIC0gc3RhcnQp
ICogKHJlY3QtPnkyIC0gcmVjdC0+eTEpKTsKIGVycl9tc2c6CiAJaWYgKHJldCkKQEAgLTE3Nyw5
ICsxNzcsOSBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1w
bGVfZGlzcGxheV9waXBlICpwaXBlLAogCQkJICAgICAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIHsKLQlzdHJ1Y3QgbWlwaV9kYmkgKm1pcGkgPSBkcm1fdG9fbWlwaV9kYmkocGlwZS0+Y3J0
Yy5kZXYpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUt
PmNydGMuZGV2KTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5m
YjsKLQlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IG1pcGk7CisJc3RydWN0IG1pcGlfZGJpICpkYmkg
PSBkYmlkZXY7CiAJc3RydWN0IGRybV9yZWN0IHJlY3QgPSB7CiAJCS54MSA9IDAsCiAJCS54MiA9
IGZiLT53aWR0aCwKQEAgLTE5NCw3ICsxOTQsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9l
bmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJRFJNX0RFQlVH
X0tNUygiXG4iKTsKIAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQobWlwaSk7CisJcmV0
ID0gbWlwaV9kYmlfcG93ZXJvbl9yZXNldChkYmlkZXYpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0
X2V4aXQ7CiAKQEAgLTIyMiw3ICsyMjIsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlwZV9lbmFi
bGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCW1pcGlfZGJpX2NvbW1h
bmQoZGJpLCBTVDc1ODZfRElTUF9NT0RFX0dSQVkpOwogCW1pcGlfZGJpX2NvbW1hbmQoZGJpLCBT
VDc1ODZfRU5BQkxFX0REUkFNLCAweDAyKTsKIAotCXN3aXRjaCAobWlwaS0+cm90YXRpb24pIHsK
Kwlzd2l0Y2ggKGRiaWRldi0+cm90YXRpb24pIHsKIAlkZWZhdWx0OgogCQlhZGRyX21vZGUgPSAw
eDAwOwogCQlicmVhazsKQEAgLTI0NSw3ICsyNDUsNyBAQCBzdGF0aWMgdm9pZCBzdDc1ODZfcGlw
ZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJbXNsZWVw
KDEwMCk7CiAKLQltaXBpLT5lbmFibGVkID0gdHJ1ZTsKKwlkYmlkZXYtPmVuYWJsZWQgPSB0cnVl
OwogCXN0NzU4Nl9mYl9kaXJ0eShmYiwgJnJlY3QpOwogCiAJbWlwaV9kYmlfY29tbWFuZChkYmks
IE1JUElfRENTX1NFVF9ESVNQTEFZX09OKTsKQEAgLTMxOCwyMyArMzE4LDIzIEBAIE1PRFVMRV9E
RVZJQ0VfVEFCTEUoc3BpLCBzdDc1ODZfaWQpOwogc3RhdGljIGludCBzdDc1ODZfcHJvYmUoc3Ry
dWN0IHNwaV9kZXZpY2UgKnNwaSkKIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmc3BpLT5kZXY7
CisJc3RydWN0IG1pcGlfZGJpICpkYmlkZXY7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKLQlz
dHJ1Y3QgbWlwaV9kYmkgKm1pcGk7CiAJc3RydWN0IG1pcGlfZGJpICpkYmk7CiAJc3RydWN0IGdw
aW9fZGVzYyAqYTA7CiAJdTMyIHJvdGF0aW9uID0gMDsKIAlzaXplX3QgYnVmc2l6ZTsKIAlpbnQg
cmV0OwogCi0JbWlwaSA9IGt6YWxsb2Moc2l6ZW9mKCptaXBpKSwgR0ZQX0tFUk5FTCk7Ci0JaWYg
KCFtaXBpKQorCWRiaWRldiA9IGt6YWxsb2Moc2l6ZW9mKCpkYmlkZXYpLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWRiaWRldikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlkYmkgPSBtaXBpOwotCWRybSA9
ICZtaXBpLT5kcm07CisJZGJpID0gZGJpZGV2OworCWRybSA9ICZkYmlkZXYtPmRybTsKIAlyZXQg
PSBkZXZtX2RybV9kZXZfaW5pdChkZXYsIGRybSwgJnN0NzU4Nl9kcml2ZXIpOwogCWlmIChyZXQp
IHsKLQkJa2ZyZWUobWlwaSk7CisJCWtmcmVlKGRiaWRldik7CiAJCXJldHVybiByZXQ7CiAJfQog
CkBAIC0zNjMsNyArMzYzLDcgQEAgc3RhdGljIGludCBzdDc1ODZfcHJvYmUoc3RydWN0IHNwaV9k
ZXZpY2UgKnNwaSkKIAkvKiBDYW5ub3QgcmVhZCBmcm9tIHRoaXMgY29udHJvbGxlciB2aWEgU1BJ
ICovCiAJZGJpLT5yZWFkX2NvbW1hbmRzID0gTlVMTDsKIAotCXJldCA9IG1pcGlfZGJpX2luaXRf
d2l0aF9mb3JtYXRzKG1pcGksICZzdDc1ODZfcGlwZV9mdW5jcywKKwlyZXQgPSBtaXBpX2RiaV9p
bml0X3dpdGhfZm9ybWF0cyhkYmlkZXYsICZzdDc1ODZfcGlwZV9mdW5jcywKIAkJCQkJIHN0NzU4
Nl9mb3JtYXRzLCBBUlJBWV9TSVpFKHN0NzU4Nl9mb3JtYXRzKSwKIAkJCQkJICZzdDc1ODZfbW9k
ZSwgcm90YXRpb24sIGJ1ZnNpemUpOwogCWlmIChyZXQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vdGlueWRybS9zdDc3MzVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9zdDc3MzVy
LmMKaW5kZXggNDMwOWFlMjk5NzY2Li41YjIzNjU3NjU5YzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS90aW55ZHJtL3N0NzczNXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vdGlueWRybS9z
dDc3MzVyLmMKQEAgLTQyLDggKzQyLDggQEAgc3RhdGljIHZvaWQgamRfdDE4MDAzX3QwMV9waXBl
X2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUsCiAJCQkJICAgICAg
c3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICAgIHN0cnVjdCBkcm1f
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBtaXBpX2RiaSAqbWlwaSA9IGRy
bV90b19taXBpX2RiaShwaXBlLT5jcnRjLmRldik7Ci0Jc3RydWN0IG1pcGlfZGJpICpkYmkgPSBt
aXBpOworCXN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2ID0gZHJtX3RvX21pcGlfZGJpKHBpcGUtPmNy
dGMuZGV2KTsKKwlzdHJ1Y3QgbWlwaV9kYmkgKmRiaSA9IGRiaWRldjsKIAlpbnQgcmV0LCBpZHg7
CiAJdTggYWRkcl9tb2RlOwogCkBAIC01Miw3ICs1Miw3IEBAIHN0YXRpYyB2b2lkIGpkX3QxODAw
M190MDFfcGlwZV9lbmFibGUoc3RydWN0IGRybV9zaW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAog
CiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAotCXJldCA9IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQo
bWlwaSk7CisJcmV0ID0gbWlwaV9kYmlfcG93ZXJvbl9yZXNldChkYmlkZXYpOwogCWlmIChyZXQp
CiAJCWdvdG8gb3V0X2V4aXQ7CiAKQEAgLTczLDcgKzczLDcgQEAgc3RhdGljIHZvaWQgamRfdDE4
MDAzX3QwMV9waXBlX2VuYWJsZShzdHJ1Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUs
CiAJbWlwaV9kYmlfY29tbWFuZChkYmksIFNUNzczNVJfUFdDVFI1LCAweDhhLCAweGVlKTsKIAlt
aXBpX2RiaV9jb21tYW5kKGRiaSwgU1Q3NzM1Ul9WTUNUUjEsIDB4MGUpOwogCW1pcGlfZGJpX2Nv
bW1hbmQoZGJpLCBNSVBJX0RDU19FWElUX0lOVkVSVF9NT0RFKTsKLQlzd2l0Y2ggKG1pcGktPnJv
dGF0aW9uKSB7CisJc3dpdGNoIChkYmlkZXYtPnJvdGF0aW9uKSB7CiAJZGVmYXVsdDoKIAkJYWRk
cl9tb2RlID0gU1Q3NzM1Ul9NWCB8IFNUNzczNVJfTVk7CiAJCWJyZWFrOwpAQCAtMTA0LDcgKzEw
NCw3IEBAIHN0YXRpYyB2b2lkIGpkX3QxODAwM190MDFfcGlwZV9lbmFibGUoc3RydWN0IGRybV9z
aW1wbGVfZGlzcGxheV9waXBlICpwaXBlLAogCiAJbXNsZWVwKDIwKTsKIAotCW1pcGlfZGJpX2Vu
YWJsZV9mbHVzaChtaXBpLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJbWlwaV9kYmlfZW5h
YmxlX2ZsdXNoKGRiaWRldiwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwogb3V0X2V4aXQ6CiAJ
ZHJtX2Rldl9leGl0KGlkeCk7CiB9CkBAIC0xNTAsMjIgKzE1MCwyMiBAQCBNT0RVTEVfREVWSUNF
X1RBQkxFKHNwaSwgc3Q3NzM1cl9pZCk7CiBzdGF0aWMgaW50IHN0NzczNXJfcHJvYmUoc3RydWN0
IHNwaV9kZXZpY2UgKnNwaSkKIHsKIAlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmc3BpLT5kZXY7CisJ
c3RydWN0IG1pcGlfZGJpICpkYmlkZXY7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRybTsKLQlzdHJ1
Y3QgbWlwaV9kYmkgKm1pcGk7CiAJc3RydWN0IG1pcGlfZGJpICpkYmk7CiAJc3RydWN0IGdwaW9f
ZGVzYyAqZGM7CiAJdTMyIHJvdGF0aW9uID0gMDsKIAlpbnQgcmV0OwogCi0JbWlwaSA9IGt6YWxs
b2Moc2l6ZW9mKCptaXBpKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFtaXBpKQorCWRiaWRldiA9IGt6
YWxsb2Moc2l6ZW9mKCpkYmlkZXYpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWRiaWRldikKIAkJcmV0
dXJuIC1FTk9NRU07CiAKLQlkYmkgPSBtaXBpOwotCWRybSA9ICZtaXBpLT5kcm07CisJZGJpID0g
ZGJpZGV2OworCWRybSA9ICZkYmlkZXYtPmRybTsKIAlyZXQgPSBkZXZtX2RybV9kZXZfaW5pdChk
ZXYsIGRybSwgJnN0NzczNXJfZHJpdmVyKTsKIAlpZiAocmV0KSB7Ci0JCWtmcmVlKG1pcGkpOwor
CQlrZnJlZShkYmlkZXYpOwogCQlyZXR1cm4gcmV0OwogCX0KIApAQCAtMTgzLDkgKzE4Myw5IEBA
IHN0YXRpYyBpbnQgc3Q3NzM1cl9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCQlyZXR1
cm4gUFRSX0VSUihkYyk7CiAJfQogCi0JbWlwaS0+YmFja2xpZ2h0ID0gZGV2bV9vZl9maW5kX2Jh
Y2tsaWdodChkZXYpOwotCWlmIChJU19FUlIobWlwaS0+YmFja2xpZ2h0KSkKLQkJcmV0dXJuIFBU
Ul9FUlIobWlwaS0+YmFja2xpZ2h0KTsKKwlkYmlkZXYtPmJhY2tsaWdodCA9IGRldm1fb2ZfZmlu
ZF9iYWNrbGlnaHQoZGV2KTsKKwlpZiAoSVNfRVJSKGRiaWRldi0+YmFja2xpZ2h0KSkKKwkJcmV0
dXJuIFBUUl9FUlIoZGJpZGV2LT5iYWNrbGlnaHQpOwogCiAJZGV2aWNlX3Byb3BlcnR5X3JlYWRf
dTMyKGRldiwgInJvdGF0aW9uIiwgJnJvdGF0aW9uKTsKIApAQCAtMTk2LDcgKzE5Niw3IEBAIHN0
YXRpYyBpbnQgc3Q3NzM1cl9wcm9iZShzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpKQogCS8qIENhbm5v
dCByZWFkIGZyb20gQWRhZnJ1aXQgMS44IiBkaXNwbGF5IHZpYSBTUEkgKi8KIAlkYmktPnJlYWRf
Y29tbWFuZHMgPSBOVUxMOwogCi0JcmV0ID0gbWlwaV9kYmlfaW5pdChtaXBpLCAmamRfdDE4MDAz
X3QwMV9waXBlX2Z1bmNzLCAmamRfdDE4MDAzX3QwMV9tb2RlLCByb3RhdGlvbik7CisJcmV0ID0g
bWlwaV9kYmlfaW5pdChkYmlkZXYsICZqZF90MTgwMDNfdDAxX3BpcGVfZnVuY3MsICZqZF90MTgw
MDNfdDAxX21vZGUsIHJvdGF0aW9uKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCmRpZmYg
LS1naXQgYS9pbmNsdWRlL2RybS90aW55ZHJtL21pcGktZGJpLmggYi9pbmNsdWRlL2RybS90aW55
ZHJtL21pcGktZGJpLmgKaW5kZXggMDRiNTRlYzYxYmMyLi5iN2IzMDExMzBhZjcgMTAwNjQ0Ci0t
LSBhL2luY2x1ZGUvZHJtL3Rpbnlkcm0vbWlwaS1kYmkuaAorKysgYi9pbmNsdWRlL2RybS90aW55
ZHJtL21pcGktZGJpLmgKQEAgLTc5LDI1ICs3OSwyNSBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBt
aXBpX2RiaSAqZHJtX3RvX21pcGlfZGJpKHN0cnVjdCBkcm1fZGV2aWNlICpkcm0pCiAKIGludCBt
aXBpX2RiaV9zcGlfaW5pdChzdHJ1Y3Qgc3BpX2RldmljZSAqc3BpLCBzdHJ1Y3QgbWlwaV9kYmkg
KmRiaSwKIAkJICAgICAgc3RydWN0IGdwaW9fZGVzYyAqZGMpOwotaW50IG1pcGlfZGJpX2luaXRf
d2l0aF9mb3JtYXRzKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK2ludCBtaXBpX2RiaV9pbml0X3dp
dGhfZm9ybWF0cyhzdHJ1Y3QgbWlwaV9kYmkgKmRiaWRldiwKIAkJCSAgICAgICBjb25zdCBzdHJ1
Y3QgZHJtX3NpbXBsZV9kaXNwbGF5X3BpcGVfZnVuY3MgKmZ1bmNzLAogCQkJICAgICAgIGNvbnN0
IHVpbnQzMl90ICpmb3JtYXRzLCB1bnNpZ25lZCBpbnQgZm9ybWF0X2NvdW50LAogCQkJICAgICAg
IGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAogCQkJICAgICAgIHVuc2lnbmVk
IGludCByb3RhdGlvbiwgc2l6ZV90IHR4X2J1Zl9zaXplKTsKLWludCBtaXBpX2RiaV9pbml0KHN0
cnVjdCBtaXBpX2RiaSAqbWlwaSwKK2ludCBtaXBpX2RiaV9pbml0KHN0cnVjdCBtaXBpX2RiaSAq
ZGJpZGV2LAogCQkgIGNvbnN0IHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3BsYXlfcGlwZV9mdW5jcyAq
ZnVuY3MsCiAJCSAgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsIHVuc2lnbmVk
IGludCByb3RhdGlvbik7CiB2b2lkIG1pcGlfZGJpX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2Ug
KmRybSk7CiB2b2lkIG1pcGlfZGJpX3BpcGVfdXBkYXRlKHN0cnVjdCBkcm1fc2ltcGxlX2Rpc3Bs
YXlfcGlwZSAqcGlwZSwKIAkJCSAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3N0YXRlKTsK
LXZvaWQgbWlwaV9kYmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqbWlwaSwKK3ZvaWQg
bWlwaV9kYmlfZW5hYmxlX2ZsdXNoKHN0cnVjdCBtaXBpX2RiaSAqZGJpZGV2LAogCQkJICAgc3Ry
dWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgc3RydWN0IGRybV9wbGFuZV9z
dGF0ZSAqcGxhbl9zdGF0ZSk7CiB2b2lkIG1pcGlfZGJpX3BpcGVfZGlzYWJsZShzdHJ1Y3QgZHJt
X3NpbXBsZV9kaXNwbGF5X3BpcGUgKnBpcGUpOwogdm9pZCBtaXBpX2RiaV9od19yZXNldChzdHJ1
Y3QgbWlwaV9kYmkgKmRiaSk7CiBib29sIG1pcGlfZGJpX2Rpc3BsYXlfaXNfb24oc3RydWN0IG1p
cGlfZGJpICpkYmkpOwotaW50IG1pcGlfZGJpX3Bvd2Vyb25fcmVzZXQoc3RydWN0IG1pcGlfZGJp
ICptaXBpKTsKLWludCBtaXBpX2RiaV9wb3dlcm9uX2NvbmRpdGlvbmFsX3Jlc2V0KHN0cnVjdCBt
aXBpX2RiaSAqbWlwaSk7CitpbnQgbWlwaV9kYmlfcG93ZXJvbl9yZXNldChzdHJ1Y3QgbWlwaV9k
YmkgKmRiaWRldik7CitpbnQgbWlwaV9kYmlfcG93ZXJvbl9jb25kaXRpb25hbF9yZXNldChzdHJ1
Y3QgbWlwaV9kYmkgKmRiaWRldik7CiAKIHUzMiBtaXBpX2RiaV9zcGlfY21kX21heF9zcGVlZChz
dHJ1Y3Qgc3BpX2RldmljZSAqc3BpLCBzaXplX3QgbGVuKTsKIGludCBtaXBpX2RiaV9zcGlfdHJh
bnNmZXIoc3RydWN0IHNwaV9kZXZpY2UgKnNwaSwgdTMyIHNwZWVkX2h6LAotLSAKMi4yMC4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpkcmktZGV2ZWwg
bWFpbGluZyBsaXN0CmRyaS1kZXZlbEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9kcmktZGV2ZWw=
