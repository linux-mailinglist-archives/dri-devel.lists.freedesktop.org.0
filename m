Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3091EE1FCB
	for <lists+dri-devel@lfdr.de>; Wed, 23 Oct 2019 17:45:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 124706E10B;
	Wed, 23 Oct 2019 15:45:36 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from bhuna.collabora.co.uk (bhuna.collabora.co.uk
 [IPv6:2a00:1098:0:82:1000:25:2eeb:e3e3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7F7B86EB1B
 for <dri-devel@lists.freedesktop.org>; Wed, 23 Oct 2019 15:45:24 +0000 (UTC)
Received: from localhost.localdomain (unknown
 [IPv6:2a01:e0a:2c:6930:5cf4:84a1:2763:fe0d])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested) (Authenticated sender: bbrezillon)
 by bhuna.collabora.co.uk (Postfix) with ESMTPSA id B7A1728F91F;
 Wed, 23 Oct 2019 16:45:22 +0100 (BST)
From: Boris Brezillon <boris.brezillon@collabora.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v3 06/21] drm: Stop accessing encoder->bridge directly
Date: Wed, 23 Oct 2019 17:44:57 +0200
Message-Id: <20191023154512.9762-7-boris.brezillon@collabora.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191023154512.9762-1-boris.brezillon@collabora.com>
References: <20191023154512.9762-1-boris.brezillon@collabora.com>
MIME-Version: 1.0
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: Mark Rutland <mark.rutland@arm.com>,
 Neil Armstrong <narmstrong@baylibre.com>,
 Thierry Reding <thierry.reding@gmail.com>,
 Laurent Pinchart <Laurent.pinchart@ideasonboard.com>, kernel@collabora.com,
 Sam Ravnborg <sam@ravnborg.org>,
 Nikita Yushchenko <nikita.yoush@cogentembedded.com>,
 Andrey Smirnov <andrew.smirnov@gmail.com>,
 Kyungmin Park <kyungmin.park@samsung.com>, Chris Healy <cphealy@gmail.com>,
 devicetree@vger.kernel.org, Jonas Karlman <jonas@kwiboo.se>,
 Rob Herring <robh+dt@kernel.org>, Jernej Skrabec <jernej.skrabec@siol.net>,
 Seung-Woo Kim <sw0312.kim@samsung.com>,
 Boris Brezillon <boris.brezillon@collabora.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

V2UgYXJlIGFib3V0IHRvIHJlcGxhY2UgdGhlIHNpbmdsZS1saW5rZWQgYnJpZGdlIGxpc3QgYnkg
YSBkb3VibGUtbGlua2VkCm9uZSBiYXNlZCBvbiBsaXN0LmgsIGxlYWRpbmcgdG8gdGhlIHN1cHBy
ZXNzaW9uIG9mIHRoZSBlbmNvZGVyLT5icmlkZ2UKZmllbGQuIEJ1dCBiZWZvcmUgd2UgY2FuIGRv
IHRoYXQgd2UgbXVzdCBwcm92aWRlIGEKZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdl
KCkgYnJpZGdlIGhlbHBlciBhbmQgcGF0Y2ggYWxsIGRyaXZlcnMKYW5kIGNvcmUgaGVscGVycyB0
byB1c2UgaXQgaW5zdGVhZCBvZiBkaXJlY3RseSBhY2Nlc3NpbmcgZW5jb2Rlci0+YnJpZGdlLgoK
U2lnbmVkLW9mZi1ieTogQm9yaXMgQnJlemlsbG9uIDxib3Jpcy5icmV6aWxsb25AY29sbGFib3Jh
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYyAgICB8IDI1ICsr
KysrKysrKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZW5jb2Rlci5jICAg
ICAgICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vZHJtX3Byb2JlX2hlbHBlci5jICAgICB8
ICA0ICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYyAgIHwgMTAgKysr
KysrKystLQogZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMgfCAxMSArKysr
KysrKy0tLQogaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oICAgICAgICAgICAgICAgfCAxNSArKysr
KysrKysrKysrKysKIDYgZmlsZXMgY2hhbmdlZCwgNTMgaW5zZXJ0aW9ucygrKSwgMTUgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vZHJtX2F0b21pY19oZWxwZXIuYwppbmRleCBjZjY3OGJlNThmYTQu
LmYwMmRkZmZkNDk2MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVs
cGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2RybV9hdG9taWNfaGVscGVyLmMKQEAgLTQxOSw2
ICs0MTksNyBAQCBtb2RlX2ZpeHVwKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlm
b3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IsIG5ld19jb25u
X3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZW5jb2Rlcl9oZWxwZXJfZnVuY3MgKmZ1
bmNzOwogCQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7CisJCXN0cnVjdCBkcm1fYnJpZGdl
ICpicmlkZ2U7CiAKIAkJV0FSTl9PTighIW5ld19jb25uX3N0YXRlLT5iZXN0X2VuY29kZXIgIT0g
ISFuZXdfY29ubl9zdGF0ZS0+Y3J0Yyk7CiAKQEAgLTQzNSw3ICs0MzYsOCBAQCBtb2RlX2ZpeHVw
KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJZW5jb2RlciA9IG5ld19jb25uX3N0
YXRlLT5iZXN0X2VuY29kZXI7CiAJCWZ1bmNzID0gZW5jb2Rlci0+aGVscGVyX3ByaXZhdGU7CiAK
LQkJcmV0ID0gZHJtX2JyaWRnZV9jaGFpbl9tb2RlX2ZpeHVwKGVuY29kZXItPmJyaWRnZSwKKwkJ
YnJpZGdlID0gZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdlKGVuY29kZXIpOworCQly
ZXQgPSBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoYnJpZGdlLAogCQkJCQkmbmV3X2NydGNf
c3RhdGUtPm1vZGUsCiAJCQkJCSZuZXdfY3J0Y19zdGF0ZS0+YWRqdXN0ZWRfbW9kZSk7CiAJCWlm
ICghcmV0KSB7CkBAIC00OTMsNiArNDk1LDcgQEAgc3RhdGljIGVudW0gZHJtX21vZGVfc3RhdHVz
IG1vZGVfdmFsaWRfcGF0aChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCQkg
ICAgc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKm1vZGUpCiB7CisJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKIAllbnVtIGRy
bV9tb2RlX3N0YXR1cyByZXQ7CiAKIAlyZXQgPSBkcm1fZW5jb2Rlcl9tb2RlX3ZhbGlkKGVuY29k
ZXIsIG1vZGUpOwpAQCAtNTAyLDcgKzUwNSw4IEBAIHN0YXRpYyBlbnVtIGRybV9tb2RlX3N0YXR1
cyBtb2RlX3ZhbGlkX3BhdGgoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJcmV0
dXJuIHJldDsKIAl9CiAKLQlyZXQgPSBkcm1fYnJpZGdlX2NoYWluX21vZGVfdmFsaWQoZW5jb2Rl
ci0+YnJpZGdlLCBtb2RlKTsKKwlicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9i
cmlkZ2UoZW5jb2Rlcik7CisJcmV0ID0gZHJtX2JyaWRnZV9jaGFpbl9tb2RlX3ZhbGlkKGJyaWRn
ZSwgbW9kZSk7CiAJaWYgKHJldCAhPSBNT0RFX09LKSB7CiAJCURSTV9ERUJVR19BVE9NSUMoIltC
UklER0VdIG1vZGVfdmFsaWQoKSBmYWlsZWRcbiIpOwogCQlyZXR1cm4gcmV0OwpAQCAtOTg1LDYg
Kzk4OSw3IEBAIGRpc2FibGVfb3V0cHV0cyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogCWZvcl9lYWNoX29sZG5ld19jb25uZWN0b3Jf
aW5fc3RhdGUob2xkX3N0YXRlLCBjb25uZWN0b3IsIG9sZF9jb25uX3N0YXRlLCBuZXdfY29ubl9z
dGF0ZSwgaSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzICpmdW5j
czsKIAkJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCQlzdHJ1Y3QgZHJtX2JyaWRnZSAq
YnJpZGdlOwogCiAJCS8qIFNodXQgZG93biBldmVyeXRoaW5nIHRoYXQncyBpbiB0aGUgY2hhbmdl
c2V0IGFuZCBjdXJyZW50bHkKIAkJICogc3RpbGwgb24uIFNvIG5lZWQgdG8gY2hlY2sgdGhlIG9s
ZCwgc2F2ZWQgc3RhdGUuICovCkBAIC0xMDIxLDcgKzEwMjYsOCBAQCBkaXNhYmxlX291dHB1dHMo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0
ZSkKIAkJICogRWFjaCBlbmNvZGVyIGhhcyBhdCBtb3N0IG9uZSBjb25uZWN0b3IgKHNpbmNlIHdl
IGFsd2F5cyBzdGVhbAogCQkgKiBpdCBhd2F5KSwgc28gd2Ugd29uJ3QgY2FsbCBkaXNhYmxlIGhv
b2tzIHR3aWNlLgogCQkgKi8KLQkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZGlzYWJsZShlbmNv
ZGVyLT5icmlkZ2UsIG9sZF9zdGF0ZSk7CisJCWJyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0
X2ZpcnN0X2JyaWRnZShlbmNvZGVyKTsKKwkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZGlzYWJs
ZShicmlkZ2UsIG9sZF9zdGF0ZSk7CiAKIAkJLyogUmlnaHQgZnVuY3Rpb24gZGVwZW5kcyB1cG9u
IHRhcmdldCBzdGF0ZS4gKi8KIAkJaWYgKGZ1bmNzKSB7CkBAIC0xMDM1LDcgKzEwNDEsNyBAQCBk
aXNhYmxlX291dHB1dHMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKm9sZF9zdGF0ZSkKIAkJCQlmdW5jcy0+ZHBtcyhlbmNvZGVyLCBEUk1fTU9ERV9EUE1T
X09GRik7CiAJCX0KIAotCQlkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoZW5j
b2Rlci0+YnJpZGdlLAorCQlkcm1fYXRvbWljX2JyaWRnZV9jaGFpbl9wb3N0X2Rpc2FibGUoYnJp
ZGdlLAogCQkJCQkJICAgICBvbGRfc3RhdGUpOwogCX0KIApAQCAtMTE5MCw2ICsxMTk2LDcgQEAg
Y3J0Y19zZXRfbW9kZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqb2xkX3N0YXRlKQogCQljb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNz
ICpmdW5jczsKIAkJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOwogCQlzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqbW9kZSwgKmFkanVzdGVkX21vZGU7CisJCXN0cnVjdCBkcm1fYnJpZGdlICpi
cmlkZ2U7CiAKIAkJaWYgKCFuZXdfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyKQogCQkJY29udGlu
dWU7CkBAIC0xMjE3LDggKzEyMjQsOCBAQCBjcnRjX3NldF9tb2RlKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiAJCQlmdW5jcy0+bW9k
ZV9zZXQoZW5jb2RlciwgbW9kZSwgYWRqdXN0ZWRfbW9kZSk7CiAJCX0KIAotCQlkcm1fYnJpZGdl
X2NoYWluX21vZGVfc2V0KGVuY29kZXItPmJyaWRnZSwgbW9kZSwKLQkJCQkJICBhZGp1c3RlZF9t
b2RlKTsKKwkJYnJpZGdlID0gZHJtX2JyaWRnZV9jaGFpbl9nZXRfZmlyc3RfYnJpZGdlKGVuY29k
ZXIpOworCQlkcm1fYnJpZGdlX2NoYWluX21vZGVfc2V0KGJyaWRnZSwgbW9kZSwgYWRqdXN0ZWRf
bW9kZSk7CiAJfQogfQogCkBAIC0xMzE3LDYgKzEzMjQsNyBAQCB2b2lkIGRybV9hdG9taWNfaGVs
cGVyX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlmb3Jf
ZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKG9sZF9zdGF0ZSwgY29ubmVjdG9yLCBuZXdfY29u
bl9zdGF0ZSwgaSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfaGVscGVyX2Z1bmNzICpm
dW5jczsKIAkJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyOworCQlzdHJ1Y3QgZHJtX2JyaWRn
ZSAqYnJpZGdlOwogCiAJCWlmICghbmV3X2Nvbm5fc3RhdGUtPmJlc3RfZW5jb2RlcikKIAkJCWNv
bnRpbnVlOwpAQCAtMTMzNSw3ICsxMzQzLDggQEAgdm9pZCBkcm1fYXRvbWljX2hlbHBlcl9jb21t
aXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAqIEVhY2ggZW5j
b2RlciBoYXMgYXQgbW9zdCBvbmUgY29ubmVjdG9yIChzaW5jZSB3ZSBhbHdheXMgc3RlYWwKIAkJ
ICogaXQgYXdheSksIHNvIHdlIHdvbid0IGNhbGwgZW5hYmxlIGhvb2tzIHR3aWNlLgogCQkgKi8K
LQkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fcHJlX2VuYWJsZShlbmNvZGVyLT5icmlkZ2UsIG9s
ZF9zdGF0ZSk7CisJCWJyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZShl
bmNvZGVyKTsKKwkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fcHJlX2VuYWJsZShicmlkZ2UsIG9s
ZF9zdGF0ZSk7CiAKIAkJaWYgKGZ1bmNzKSB7CiAJCQlpZiAoZnVuY3MtPmF0b21pY19lbmFibGUp
CkBAIC0xMzQ2LDcgKzEzNTUsNyBAQCB2b2lkIGRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9tb2Rl
c2V0X2VuYWJsZXMoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQlmdW5jcy0+Y29tbWl0KGVu
Y29kZXIpOwogCQl9CiAKLQkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKGVuY29kZXIt
PmJyaWRnZSwgb2xkX3N0YXRlKTsKKwkJZHJtX2F0b21pY19icmlkZ2VfY2hhaW5fZW5hYmxlKGJy
aWRnZSwgb2xkX3N0YXRlKTsKIAl9CiAKIAlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfd3JpdGVi
YWNrcyhkZXYsIG9sZF9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2Vu
Y29kZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZW5jb2Rlci5jCmluZGV4IDgwZDg4YTU1MzAy
ZS4uNGZlOWU3MjNlMjI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vZHJtX2VuY29kZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2VuY29kZXIuYwpAQCAtMTY3LDkgKzE2NywxMCBA
QCB2b2lkIGRybV9lbmNvZGVyX2NsZWFudXAoc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKQog
CSAqLwogCiAJaWYgKGVuY29kZXItPmJyaWRnZSkgewotCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJp
ZGdlID0gZW5jb2Rlci0+YnJpZGdlOworCQlzdHJ1Y3QgZHJtX2JyaWRnZSAqYnJpZGdlOwogCQlz
dHJ1Y3QgZHJtX2JyaWRnZSAqbmV4dDsKIAorCQlicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWluX2dl
dF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7CiAJCXdoaWxlIChicmlkZ2UpIHsKIAkJCW5leHQgPSBi
cmlkZ2UtPm5leHQ7CiAJCQlkcm1fYnJpZGdlX2RldGFjaChicmlkZ2UpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2RybV9wcm9iZV9oZWxwZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1f
cHJvYmVfaGVscGVyLmMKaW5kZXggYzNlYTcyMjA2NWM0Li41NzZiNGI3ZGNkODkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcHJvYmVfaGVscGVyLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2RybV9wcm9iZV9oZWxwZXIuYwpAQCAtMTAxLDYgKzEwMSw3IEBAIGRybV9tb2RlX3ZhbGlk
YXRlX3BpcGVsaW5lKHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAogCiAJLyogU3RlcCAy
OiBWYWxpZGF0ZSBhZ2FpbnN0IGVuY29kZXJzIGFuZCBjcnRjcyAqLwogCWRybV9jb25uZWN0b3Jf
Zm9yX2VhY2hfcG9zc2libGVfZW5jb2Rlcihjb25uZWN0b3IsIGVuY29kZXIpIHsKKwkJc3RydWN0
IGRybV9icmlkZ2UgKmJyaWRnZTsKIAkJc3RydWN0IGRybV9jcnRjICpjcnRjOwogCiAJCXJldCA9
IGRybV9lbmNvZGVyX21vZGVfdmFsaWQoZW5jb2RlciwgbW9kZSk7CkBAIC0xMTIsNyArMTEzLDgg
QEAgZHJtX21vZGVfdmFsaWRhdGVfcGlwZWxpbmUoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1v
ZGUsCiAJCQljb250aW51ZTsKIAkJfQogCi0JCXJldCA9IGRybV9icmlkZ2VfY2hhaW5fbW9kZV92
YWxpZChlbmNvZGVyLT5icmlkZ2UsIG1vZGUpOworCQlicmlkZ2UgPSBkcm1fYnJpZGdlX2NoYWlu
X2dldF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7CisJCXJldCA9IGRybV9icmlkZ2VfY2hhaW5fbW9k
ZV92YWxpZChicmlkZ2UsIG1vZGUpOwogCQlpZiAocmV0ICE9IE1PREVfT0spIHsKIAkJCS8qIFRo
ZXJlIGlzIGFsc28gbm8gcG9pbnQgaW4gY29udGludWluZyBmb3IgY3J0YyBjaGVjawogCQkJICog
aGVyZS4gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2Uu
YyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYwppbmRleCAyOTUwYmJhNGFj
YTkuLmI2NWI1Y2MyZGJhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL21zbS9lZHAvZWRw
X2JyaWRnZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9tc20vZWRwL2VkcF9icmlkZ2UuYwpAQCAt
NTUsOCArNTUsMTQgQEAgc3RhdGljIHZvaWQgZWRwX2JyaWRnZV9tb2RlX3NldChzdHJ1Y3QgZHJt
X2JyaWRnZSAqYnJpZGdlLAogCURCRygic2V0IG1vZGU6ICIgRFJNX01PREVfRk1ULCBEUk1fTU9E
RV9BUkcobW9kZSkpOwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShjb25uZWN0b3IsICZkZXYtPm1v
ZGVfY29uZmlnLmNvbm5lY3Rvcl9saXN0LCBoZWFkKSB7Ci0JCWlmICgoY29ubmVjdG9yLT5lbmNv
ZGVyICE9IE5VTEwpICYmCi0JCQkoY29ubmVjdG9yLT5lbmNvZGVyLT5icmlkZ2UgPT0gYnJpZGdl
KSkgeworCQlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIgPSBjb25uZWN0b3ItPmVuY29kZXI7
CisJCXN0cnVjdCBkcm1fYnJpZGdlICpmaXJzdF9icmlkZ2U7CisKKwkJaWYgKCFjb25uZWN0b3It
PmVuY29kZXIpCisJCQljb250aW51ZTsKKworCQlmaXJzdF9icmlkZ2UgPSBkcm1fYnJpZGdlX2No
YWluX2dldF9maXJzdF9icmlkZ2UoZW5jb2Rlcik7CisJCWlmIChicmlkZ2UgPT0gZmlyc3RfYnJp
ZGdlKSB7CiAJCQltc21fZWRwX2N0cmxfdGltaW5nX2NmZyhlZHAtPmN0cmwsCiAJCQkJYWRqdXN0
ZWRfbW9kZSwgJmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvKTsKIAkJCWJyZWFrOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vcmNhci1kdS9yY2FyX2R1X2NydGMuYwppbmRleCAyZGE0NmUzZGM0YWUuLjdhMWYxZTVmMDMy
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL3JjYXItZHUvcmNhcl9kdV9jcnRjLmMKQEAgLTE0LDYgKzE0LDcg
QEAKIAogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9hdG9t
aWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9icmlkZ2UuaD4KICNpbmNsdWRlIDxkcm0v
ZHJtX2NydGMuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2RldmljZS5oPgogI2luY2x1ZGUgPGRybS9k
cm1fZmJfY21hX2hlbHBlci5oPgpAQCAtNjgwLDkgKzY4MSwxMCBAQCBzdGF0aWMgdm9pZCByY2Fy
X2R1X2NydGNfYXRvbWljX2VuYWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQlyY2R1LT5l
bmNvZGVyc1tSQ0FSX0RVX09VVFBVVF9MVkRTMCArIHJjcnRjLT5pbmRleF07CiAJCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0KIAkJCSZjcnRjLT5zdGF0ZS0+YWRqdXN0ZWRf
bW9kZTsKKwkJc3RydWN0IGRybV9icmlkZ2UgKmJyaWRnZTsKIAotCQlyY2FyX2x2ZHNfY2xrX2Vu
YWJsZShlbmNvZGVyLT5iYXNlLmJyaWRnZSwKLQkJCQkgICAgIG1vZGUtPmNsb2NrICogMTAwMCk7
CisJCWJyaWRnZSA9IGRybV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0X2JyaWRnZSgmZW5jb2Rlci0+
YmFzZSk7CisJCXJjYXJfbHZkc19jbGtfZW5hYmxlKGJyaWRnZSwgbW9kZS0+Y2xvY2sgKiAxMDAw
KTsKIAl9CiAKIAlyY2FyX2R1X2NydGNfc3RhcnQocmNydGMpOwpAQCAtNzAyLDEyICs3MDQsMTUg
QEAgc3RhdGljIHZvaWQgcmNhcl9kdV9jcnRjX2F0b21pY19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIAkgICAgcnN0YXRlLT5vdXRwdXRzID09IEJJVChSQ0FSX0RVX09VVFBVVF9EUEFE
MCkpIHsKIAkJc3RydWN0IHJjYXJfZHVfZW5jb2RlciAqZW5jb2RlciA9CiAJCQlyY2R1LT5lbmNv
ZGVyc1tSQ0FSX0RVX09VVFBVVF9MVkRTMCArIHJjcnRjLT5pbmRleF07CisJCXN0cnVjdCBkcm1f
YnJpZGdlICpicmlkZ2U7CisKIAogCQkvKgogCQkgKiBEaXNhYmxlIHRoZSBMVkRTIGNsb2NrIG91
dHB1dCwgc2VlCiAJCSAqIHJjYXJfZHVfY3J0Y19hdG9taWNfZW5hYmxlKCkuCiAJCSAqLwotCQly
Y2FyX2x2ZHNfY2xrX2Rpc2FibGUoZW5jb2Rlci0+YmFzZS5icmlkZ2UpOworCQlicmlkZ2UgPSBk
cm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoJmVuY29kZXItPmJhc2UpOworCQlyY2Fy
X2x2ZHNfY2xrX2Rpc2FibGUoYnJpZGdlKTsKIAl9CiAKIAlzcGluX2xvY2tfaXJxKCZjcnRjLT5k
ZXYtPmV2ZW50X2xvY2spOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oIGIv
aW5jbHVkZS9kcm0vZHJtX2JyaWRnZS5oCmluZGV4IDhhZWJhODNmY2YzMS4uMjdlZWY2M2NlMGZm
IDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fYnJpZGdlLmgKKysrIGIvaW5jbHVkZS9kcm0v
ZHJtX2JyaWRnZS5oCkBAIC0yNSw2ICsyNSw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9saXN0Lmg+
CiAjaW5jbHVkZSA8bGludXgvY3R5cGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4K
ICNpbmNsdWRlIDxkcm0vZHJtX21vZGVfb2JqZWN0Lmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9tb2Rl
cy5oPgogCkBAIC00MjIsNiArNDIzLDIwIEBAIGRybV9icmlkZ2VfY2hhaW5fZ2V0X25leHRfYnJp
ZGdlKHN0cnVjdCBkcm1fYnJpZGdlICpicmlkZ2UpCiAJcmV0dXJuIGJyaWRnZS0+bmV4dDsKIH0K
IAorLyoqCisgKiBkcm1fYnJpZGdlX2NoYWluX2dldF9maXJzdF9icmlkZ2UoKSAtIEdldCB0aGUg
Zmlyc3QgYnJpZGdlIGluIHRoZSBjaGFpbgorICogQGVuY29kZXI6IGVuY29kZXIgb2JqZWN0Cisg
KgorICogUkVUVVJOUzoKKyAqIHRoZSBmaXJzdCBicmlkZ2UgaW4gdGhlIGNoYWluLCBvciBOVUxM
IGlmIEBlbmNvZGVyIGhhcyBubyBicmlkZ2UgYXR0YWNoZWQKKyAqIHRvIGl0LgorICovCitzdGF0
aWMgaW5saW5lIHN0cnVjdCBkcm1fYnJpZGdlICoKK2RybV9icmlkZ2VfY2hhaW5fZ2V0X2ZpcnN0
X2JyaWRnZShzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCit7CisJcmV0dXJuIGVuY29kZXIt
PmJyaWRnZTsKK30KKwogYm9vbCBkcm1fYnJpZGdlX2NoYWluX21vZGVfZml4dXAoc3RydWN0IGRy
bV9icmlkZ2UgKmJyaWRnZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1v
ZGUsCiAJCQkJIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKTsKLS0gCjIu
MjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJp
LWRldmVsIG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
