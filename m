Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3EB871C24F
	for <lists+dri-devel@lfdr.de>; Tue, 14 May 2019 07:46:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F01618926D;
	Tue, 14 May 2019 05:46:24 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mail-pf1-x449.google.com (mail-pf1-x449.google.com
 [IPv6:2607:f8b0:4864:20::449])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2DE4D8926B
 for <dri-devel@lists.freedesktop.org>; Tue, 14 May 2019 05:46:23 +0000 (UTC)
Received: by mail-pf1-x449.google.com with SMTP id u7so5117975pfh.17
 for <dri-devel@lists.freedesktop.org>; Mon, 13 May 2019 22:46:23 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:date:in-reply-to:message-id:mime-version
 :references:subject:from:to:cc;
 bh=tNDeMg/5pXNKXoffed92pmn5mKLyE8fJ51qEs51jHbo=;
 b=JDXCjLDgNYXi9vMiOnRx8IUD1yCyWEknIviZrSi0nOLKJJ2QT1Hw+OvtXJs2cPliwp
 7n7+m/NOT+dQnCSFX908vTIAgPxWB8lMe1lrngiXwlJaNv1LNff9OUkpnSiy93llUDrg
 d2meFOinrzydhWHYIhLAhdkdwtwG0p/cQu9ANy+hpnfbuhmgeRKTZ0jQNqo7KWzZ3c9l
 gk9WJtJDIVFnSoeLyR21jdgCafSiE4q5UNmNyIIQGGbSFyjmm/6EKZgw8HJ4enhqyH1o
 9vn7zTh+P13evVEai5gPx5etrQ3DfBQmLaMDDB1uR5h4KXalcIpMsjb6XIY8AgOdocmf
 mCcw==
X-Gm-Message-State: APjAAAWYrRyH5VUrbJWdVFxZGs6Dd171+B4j5dGWhDhtLVw9ckMjK3wh
 oVJLcv9Hf/tWKprXbVXGGSkPi7la8KFyuBpQ+27z6g==
X-Google-Smtp-Source: APXvYqyrOv4qazCxPTd56gxM/i8w2fE956x/NWO2xJ602032eHv+/2M1Zv2X7CH3OxIYsrqnxjIClL4SIX+qLSgOSaKb8A==
X-Received: by 2002:a63:1d14:: with SMTP id d20mr21863890pgd.281.1557812782521; 
 Mon, 13 May 2019 22:46:22 -0700 (PDT)
Date: Mon, 13 May 2019 22:42:46 -0700
In-Reply-To: <20190514054251.186196-1-brendanhiggins@google.com>
Message-Id: <20190514054251.186196-13-brendanhiggins@google.com>
Mime-Version: 1.0
References: <20190514054251.186196-1-brendanhiggins@google.com>
X-Mailer: git-send-email 2.21.0.1020.gf2820cf01a-goog
Subject: [PATCH v3 12/18] kunit: test: add tests for KUnit managed resources
From: Brendan Higgins <brendanhiggins@google.com>
To: frowand.list@gmail.com, gregkh@linuxfoundation.org, keescook@google.com, 
 kieran.bingham@ideasonboard.com, mcgrof@kernel.org, robh@kernel.org, 
 sboyd@kernel.org, shuah@kernel.org, tytso@mit.edu, 
 yamada.masahiro@socionext.com
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=google.com; s=20161025;
 h=date:in-reply-to:message-id:mime-version:references:subject:from:to
 :cc;
 bh=tNDeMg/5pXNKXoffed92pmn5mKLyE8fJ51qEs51jHbo=;
 b=UlwF03hfMD573CXSZKTM89cl+dGNsQlrAAcNlGkkrX75BIzdQg4aArRMoF9Bmy2Qlw
 PXrgTSUkgnVN+bnxnLajVm05ycPVxONHbvvbTvDUTENsiu0aJklvsyiVP9j+iBMawv1g
 FRe5k2u2rDc9MYmWej/lEeO0JpJ/fvi2ZCnyZ1nymlGEMFagxsc78jUduo/GgXdowJnf
 66WgavGICXmbJjT7ztAy1SZxxz5kK12lWrJp9UqiqXt4ZT/xIZ+fi1NJB6D9ojukOtuR
 tkyYIx2134H/mLbxf1sCJ8MTSPGyosGhq0HrbxI/4wkmO4LkcQgWlCRtmPYogqh4QOhf
 B1kw==
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: pmladek@suse.com, linux-doc@vger.kernel.org, amir73il@gmail.com,
 Brendan Higgins <brendanhiggins@google.com>, dri-devel@lists.freedesktop.org,
 Alexander.Levin@microsoft.com, linux-kselftest@vger.kernel.org,
 linux-nvdimm@lists.01.org, khilman@baylibre.com, knut.omang@oracle.com,
 wfg@linux.intel.com, joel@jms.id.au, rientjes@google.com, jdike@addtoit.com,
 dan.carpenter@oracle.com, devicetree@vger.kernel.org,
 linux-kbuild@vger.kernel.org, Tim.Bird@sony.com,
 Avinash Kondareddy <akndr41@gmail.com>, linux-um@lists.infradead.org,
 rostedt@goodmis.org, julia.lawall@lip6.fr, dan.j.williams@intel.com,
 kunit-dev@googlegroups.com, richard@nod.at, rdunlap@infradead.org,
 linux-kernel@vger.kernel.org, mpe@ellerman.id.au,
 linux-fsdevel@vger.kernel.org, logang@deltatee.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

RnJvbTogQXZpbmFzaCBLb25kYXJlZGR5IDxha25kcjQxQGdtYWlsLmNvbT4KCkFkZCB1bml0IHRl
c3RzIGZvciBLVW5pdCBtYW5hZ2VkIHJlc291cmNlcy4gS1VuaXQgbWFuYWdlZCByZXNvdXJjZXMK
KHN0cnVjdCBrdW5pdF9yZXNvdXJjZSkgYXJlIHJlc291cmNlcyB0aGF0IGFyZSBhdXRvbWF0aWNh
bGx5IGNsZWFuZWQgdXAKYXQgdGhlIGVuZCBvZiBhIEtVbml0IHRlc3QsIHNpbWlsYXIgdG8gdGhl
IGNvbmNlcHQgb2YgZGV2bV8qIG1hbmFnZWQKcmVzb3VyY2VzLgoKU2lnbmVkLW9mZi1ieTogQXZp
bmFzaCBLb25kYXJlZGR5IDxha25kcjQxQGdtYWlsLmNvbT4KU2lnbmVkLW9mZi1ieTogQnJlbmRh
biBIaWdnaW5zIDxicmVuZGFuaGlnZ2luc0Bnb29nbGUuY29tPgpSZXZpZXdlZC1ieTogR3JlZyBL
cm9haC1IYXJ0bWFuIDxncmVna2hAbGludXhmb3VuZGF0aW9uLm9yZz4KUmV2aWV3ZWQtYnk6IExv
Z2FuIEd1bnRob3JwZSA8bG9nYW5nQGRlbHRhdGVlLmNvbT4KLS0tCkNoYW5nZXMgU2luY2UgTGFz
dCBSZXZpc2lvbjoKIC0gQWRkZWQgbW9yZSBkZXRhaWxzIHRvIGNoYW5nZSBsb2cgYXMgcGVyIFNo
dWFoJ3MgY29tbWVudHMuCiAtIE1hZGUgdXNlIG9mIG5ldyBFWFBFQ1QgbWFjcm8gZm9yIHBvaW50
ZXIgY29tcGFyaXNvbiB0byB3YXJuaW5nCiAgIHJlcG9ydGVkIGJ5IGtidWlsZCBib3QuCi0tLQog
a3VuaXQvdGVzdC10ZXN0LmMgfCAxMjMgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDEyMyBpbnNlcnRpb25zKCspCgpkaWZmIC0t
Z2l0IGEva3VuaXQvdGVzdC10ZXN0LmMgYi9rdW5pdC90ZXN0LXRlc3QuYwppbmRleCA3YWZjOWJi
NTJmN2JlLi5lZTkyNmY3OThiMjY2IDEwMDY0NAotLS0gYS9rdW5pdC90ZXN0LXRlc3QuYworKysg
Yi9rdW5pdC90ZXN0LXRlc3QuYwpAQCAtMTAxLDMgKzEwMSwxMjYgQEAgc3RhdGljIHN0cnVjdCBr
dW5pdF9tb2R1bGUga3VuaXRfdHJ5X2NhdGNoX3Rlc3RfbW9kdWxlID0gewogCS50ZXN0X2Nhc2Vz
ID0ga3VuaXRfdHJ5X2NhdGNoX3Rlc3RfY2FzZXMsCiB9OwogbW9kdWxlX3Rlc3Qoa3VuaXRfdHJ5
X2NhdGNoX3Rlc3RfbW9kdWxlKTsKKworLyoKKyAqIENvbnRleHQgZm9yIHRlc3RpbmcgdGVzdCBt
YW5hZ2VkIHJlc291cmNlcworICogaXNfcmVzb3VyY2VfaW5pdGlhbGl6ZWQgaXMgdXNlZCB0byB0
ZXN0IGFyYml0cmFyeSByZXNvdXJjZXMKKyAqLworc3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2Vf
Y29udGV4dCB7CisJc3RydWN0IGt1bml0IHRlc3Q7CisJYm9vbCBpc19yZXNvdXJjZV9pbml0aWFs
aXplZDsKK307CisKK3N0YXRpYyBpbnQgZmFrZV9yZXNvdXJjZV9pbml0KHN0cnVjdCBrdW5pdF9y
ZXNvdXJjZSAqcmVzLCB2b2lkICpjb250ZXh0KQoreworCXN0cnVjdCBrdW5pdF90ZXN0X3Jlc291
cmNlX2NvbnRleHQgKmN0eCA9IGNvbnRleHQ7CisKKwlyZXMtPmFsbG9jYXRpb24gPSAmY3R4LT5p
c19yZXNvdXJjZV9pbml0aWFsaXplZDsKKwljdHgtPmlzX3Jlc291cmNlX2luaXRpYWxpemVkID0g
dHJ1ZTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgZmFrZV9yZXNvdXJjZV9mcmVlKHN0
cnVjdCBrdW5pdF9yZXNvdXJjZSAqcmVzKQoreworCWJvb2wgKmlzX3Jlc291cmNlX2luaXRpYWxp
emVkID0gcmVzLT5hbGxvY2F0aW9uOworCisJKmlzX3Jlc291cmNlX2luaXRpYWxpemVkID0gZmFs
c2U7Cit9CisKK3N0YXRpYyB2b2lkIGt1bml0X3Jlc291cmNlX3Rlc3RfaW5pdF9yZXNvdXJjZXMo
c3RydWN0IGt1bml0ICp0ZXN0KQoreworCXN0cnVjdCBrdW5pdF90ZXN0X3Jlc291cmNlX2NvbnRl
eHQgKmN0eCA9IHRlc3QtPnByaXY7CisKKwlrdW5pdF9pbml0X3Rlc3QoJmN0eC0+dGVzdCwgInRl
c3RpbmdfdGVzdF9pbml0X3Rlc3QiKTsKKworCUtVTklUX0VYUEVDVF9UUlVFKHRlc3QsIGxpc3Rf
ZW1wdHkoJmN0eC0+dGVzdC5yZXNvdXJjZXMpKTsKK30KKworc3RhdGljIHZvaWQga3VuaXRfcmVz
b3VyY2VfdGVzdF9hbGxvY19yZXNvdXJjZShzdHJ1Y3Qga3VuaXQgKnRlc3QpCit7CisJc3RydWN0
IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAqY3R4ID0gdGVzdC0+cHJpdjsKKwlzdHJ1Y3Qg
a3VuaXRfcmVzb3VyY2UgKnJlczsKKwlrdW5pdF9yZXNvdXJjZV9mcmVlX3QgZnJlZSA9IGZha2Vf
cmVzb3VyY2VfZnJlZTsKKworCXJlcyA9IGt1bml0X2FsbG9jX3Jlc291cmNlKCZjdHgtPnRlc3Qs
CisJCQkJICAgZmFrZV9yZXNvdXJjZV9pbml0LAorCQkJCSAgIGZha2VfcmVzb3VyY2VfZnJlZSwK
KwkJCQkgICBjdHgpOworCisJS1VOSVRfQVNTRVJUX05PVF9FUlJfT1JfTlVMTCh0ZXN0LCByZXMp
OworCUtVTklUX0VYUEVDVF9QVFJfRVEodGVzdCwKKwkJCSAgICAmY3R4LT5pc19yZXNvdXJjZV9p
bml0aWFsaXplZCwgcmVzLT5hbGxvY2F0aW9uKTsKKwlLVU5JVF9FWFBFQ1RfVFJVRSh0ZXN0LCBs
aXN0X2lzX2xhc3QoJnJlcy0+bm9kZSwgJmN0eC0+dGVzdC5yZXNvdXJjZXMpKTsKKwlLVU5JVF9F
WFBFQ1RfUFRSX0VRKHRlc3QsIGZyZWUsIHJlcy0+ZnJlZSk7Cit9CisKK3N0YXRpYyB2b2lkIGt1
bml0X3Jlc291cmNlX3Rlc3RfZnJlZV9yZXNvdXJjZShzdHJ1Y3Qga3VuaXQgKnRlc3QpCit7CisJ
c3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAqY3R4ID0gdGVzdC0+cHJpdjsKKwlz
dHJ1Y3Qga3VuaXRfcmVzb3VyY2UgKnJlcyA9IGt1bml0X2FsbG9jX3Jlc291cmNlKCZjdHgtPnRl
c3QsCisJCQkJCQkJICBmYWtlX3Jlc291cmNlX2luaXQsCisJCQkJCQkJICBmYWtlX3Jlc291cmNl
X2ZyZWUsCisJCQkJCQkJICBjdHgpOworCisJa3VuaXRfZnJlZV9yZXNvdXJjZSgmY3R4LT50ZXN0
LCByZXMpOworCisJS1VOSVRfRVhQRUNUX0VRKHRlc3QsIGZhbHNlLCBjdHgtPmlzX3Jlc291cmNl
X2luaXRpYWxpemVkKTsKKwlLVU5JVF9FWFBFQ1RfVFJVRSh0ZXN0LCBsaXN0X2VtcHR5KCZjdHgt
PnRlc3QucmVzb3VyY2VzKSk7Cit9CisKK3N0YXRpYyB2b2lkIGt1bml0X3Jlc291cmNlX3Rlc3Rf
Y2xlYW51cF9yZXNvdXJjZXMoc3RydWN0IGt1bml0ICp0ZXN0KQoreworCWludCBpOworCXN0cnVj
dCBrdW5pdF90ZXN0X3Jlc291cmNlX2NvbnRleHQgKmN0eCA9IHRlc3QtPnByaXY7CisJc3RydWN0
IGt1bml0X3Jlc291cmNlICpyZXNvdXJjZXNbNV07CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShyZXNvdXJjZXMpOyBpKyspIHsKKwkJcmVzb3VyY2VzW2ldID0ga3VuaXRfYWxsb2NfcmVz
b3VyY2UoJmN0eC0+dGVzdCwKKwkJCQkJCSAgICBmYWtlX3Jlc291cmNlX2luaXQsCisJCQkJCQkg
ICAgZmFrZV9yZXNvdXJjZV9mcmVlLAorCQkJCQkJICAgIGN0eCk7CisJfQorCisJa3VuaXRfY2xl
YW51cCgmY3R4LT50ZXN0KTsKKworCUtVTklUX0VYUEVDVF9UUlVFKHRlc3QsIGxpc3RfZW1wdHko
JmN0eC0+dGVzdC5yZXNvdXJjZXMpKTsKK30KKworc3RhdGljIGludCBrdW5pdF9yZXNvdXJjZV90
ZXN0X2luaXQoc3RydWN0IGt1bml0ICp0ZXN0KQoreworCXN0cnVjdCBrdW5pdF90ZXN0X3Jlc291
cmNlX2NvbnRleHQgKmN0eCA9CisJCQlremFsbG9jKHNpemVvZigqY3R4KSwgR0ZQX0tFUk5FTCk7
CisKKwlpZiAoIWN0eCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwl0ZXN0LT5wcml2ID0gY3R4Owor
CisJa3VuaXRfaW5pdF90ZXN0KCZjdHgtPnRlc3QsICJ0ZXN0X3Rlc3RfY29udGV4dCIpOworCisJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGt1bml0X3Jlc291cmNlX3Rlc3RfZXhpdChzdHJ1
Y3Qga3VuaXQgKnRlc3QpCit7CisJc3RydWN0IGt1bml0X3Rlc3RfcmVzb3VyY2VfY29udGV4dCAq
Y3R4ID0gdGVzdC0+cHJpdjsKKworCWt1bml0X2NsZWFudXAoJmN0eC0+dGVzdCk7CisJa2ZyZWUo
Y3R4KTsKK30KKworc3RhdGljIHN0cnVjdCBrdW5pdF9jYXNlIGt1bml0X3Jlc291cmNlX3Rlc3Rf
Y2FzZXNbXSA9IHsKKwlLVU5JVF9DQVNFKGt1bml0X3Jlc291cmNlX3Rlc3RfaW5pdF9yZXNvdXJj
ZXMpLAorCUtVTklUX0NBU0Uoa3VuaXRfcmVzb3VyY2VfdGVzdF9hbGxvY19yZXNvdXJjZSksCisJ
S1VOSVRfQ0FTRShrdW5pdF9yZXNvdXJjZV90ZXN0X2ZyZWVfcmVzb3VyY2UpLAorCUtVTklUX0NB
U0Uoa3VuaXRfcmVzb3VyY2VfdGVzdF9jbGVhbnVwX3Jlc291cmNlcyksCisJe30sCit9OworCitz
dGF0aWMgc3RydWN0IGt1bml0X21vZHVsZSBrdW5pdF9yZXNvdXJjZV90ZXN0X21vZHVsZSA9IHsK
KwkubmFtZSA9ICJrdW5pdC1yZXNvdXJjZS10ZXN0IiwKKwkuaW5pdCA9IGt1bml0X3Jlc291cmNl
X3Rlc3RfaW5pdCwKKwkuZXhpdCA9IGt1bml0X3Jlc291cmNlX3Rlc3RfZXhpdCwKKwkudGVzdF9j
YXNlcyA9IGt1bml0X3Jlc291cmNlX3Rlc3RfY2FzZXMsCit9OworbW9kdWxlX3Rlc3Qoa3VuaXRf
cmVzb3VyY2VfdGVzdF9tb2R1bGUpOwotLSAKMi4yMS4wLjEwMjAuZ2YyODIwY2YwMWEtZ29vZwoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZHJpLWRldmVs
IG1haWxpbmcgbGlzdApkcmktZGV2ZWxAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vZHJpLWRldmVs
