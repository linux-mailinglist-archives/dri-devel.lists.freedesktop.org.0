Return-Path: <dri-devel-bounces@lists.freedesktop.org>
X-Original-To: lists+dri-devel@lfdr.de
Delivered-To: lists+dri-devel@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7D8824E79C
	for <lists+dri-devel@lfdr.de>; Fri, 21 Jun 2019 13:58:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 65FC06E8A8;
	Fri, 21 Jun 2019 11:58:14 +0000 (UTC)
X-Original-To: dri-devel@lists.freedesktop.org
Delivered-To: dri-devel@lists.freedesktop.org
Received: from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CF0066E88B;
 Fri, 21 Jun 2019 11:58:04 +0000 (UTC)
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx1.redhat.com (Postfix) with ESMTPS id 69959C1EB1F1;
 Fri, 21 Jun 2019 11:58:04 +0000 (UTC)
Received: from sirius.home.kraxel.org (ovpn-116-212.ams2.redhat.com
 [10.36.116.212])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 26EED19C4F;
 Fri, 21 Jun 2019 11:58:01 +0000 (UTC)
Received: by sirius.home.kraxel.org (Postfix, from userid 1000)
 id 095AA9D96; Fri, 21 Jun 2019 13:57:59 +0200 (CEST)
From: Gerd Hoffmann <kraxel@redhat.com>
To: dri-devel@lists.freedesktop.org
Subject: [PATCH v2 12/18] drm/radeon: switch driver from bo->resv to
 bo->base.resv
Date: Fri, 21 Jun 2019 13:57:49 +0200
Message-Id: <20190621115755.8481-13-kraxel@redhat.com>
In-Reply-To: <20190621115755.8481-1-kraxel@redhat.com>
References: <20190621115755.8481-1-kraxel@redhat.com>
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
X-Greylist: Sender IP whitelisted, not delayed by milter-greylist-4.5.16
 (mx1.redhat.com [10.5.110.32]); Fri, 21 Jun 2019 11:58:04 +0000 (UTC)
X-BeenThere: dri-devel@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Direct Rendering Infrastructure - Development
 <dri-devel.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/dri-devel>
List-Post: <mailto:dri-devel@lists.freedesktop.org>
List-Help: <mailto:dri-devel-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/dri-devel>,
 <mailto:dri-devel-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, ckoenig.leichtzumerken@gmail.com,
 open list <linux-kernel@vger.kernel.org>,
 "open list:RADEON and AMDGPU DRM DRIVERS" <amd-gfx@lists.freedesktop.org>,
 Gerd Hoffmann <kraxel@redhat.com>, Alex Deucher <alexander.deucher@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: dri-devel-bounces@lists.freedesktop.org
Sender: "dri-devel" <dri-devel-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogR2VyZCBIb2ZmbWFubiA8a3JheGVsQHJlZGhhdC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fYmVuY2htYXJrLmMgfCA0ICsrLS0KIGRyaXZlcnMv
Z3B1L2RybS9yYWRlb24vcmFkZW9uX2NzLmMgICAgICAgIHwgMiArLQogZHJpdmVycy9ncHUvZHJt
L3JhZGVvbi9yYWRlb25fZGlzcGxheS5jICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9u
L3JhZGVvbl9nZW0uYyAgICAgICB8IDYgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3Jh
ZGVvbl9tbi5jICAgICAgICB8IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29i
amVjdC5jICAgIHwgOCArKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fcHJp
bWUuYyAgICAgfCAyICstCiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90ZXN0LmMgICAg
ICB8IDggKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3R0bS5jICAgICAg
IHwgMiArLQogZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdXZkLmMgICAgICAgfCAyICst
CiBkcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl92bS5jICAgICAgICB8IDYgKysrLS0tCiAx
MSBmaWxlcyBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCspLCAyMiBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9iZW5jaG1hcmsuYyBiL2RyaXZl
cnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2JlbmNobWFyay5jCmluZGV4IDdjZTUwNjRhNTlmNi4u
MWVhNTBjZTE2MzEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9i
ZW5jaG1hcmsuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9iZW5jaG1hcmsu
YwpAQCAtMTIyLDcgKzEyMiw3IEBAIHN0YXRpYyB2b2lkIHJhZGVvbl9iZW5jaG1hcmtfbW92ZShz
dHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwgdW5zaWduZWQgc2l6ZSwKIAlpZiAocmRldi0+YXNp
Yy0+Y29weS5kbWEpIHsKIAkJdGltZSA9IHJhZGVvbl9iZW5jaG1hcmtfZG9fbW92ZShyZGV2LCBz
aXplLCBzYWRkciwgZGFkZHIsCiAJCQkJCQlSQURFT05fQkVOQ0hNQVJLX0NPUFlfRE1BLCBuLAot
CQkJCQkJZG9iai0+dGJvLnJlc3YpOworCQkJCQkJZG9iai0+dGJvLmJhc2UucmVzdik7CiAJCWlm
ICh0aW1lIDwgMCkKIAkJCWdvdG8gb3V0X2NsZWFudXA7CiAJCWlmICh0aW1lID4gMCkKQEAgLTEz
Myw3ICsxMzMsNyBAQCBzdGF0aWMgdm9pZCByYWRlb25fYmVuY2htYXJrX21vdmUoc3RydWN0IHJh
ZGVvbl9kZXZpY2UgKnJkZXYsIHVuc2lnbmVkIHNpemUsCiAJaWYgKHJkZXYtPmFzaWMtPmNvcHku
YmxpdCkgewogCQl0aW1lID0gcmFkZW9uX2JlbmNobWFya19kb19tb3ZlKHJkZXYsIHNpemUsIHNh
ZGRyLCBkYWRkciwKIAkJCQkJCVJBREVPTl9CRU5DSE1BUktfQ09QWV9CTElULCBuLAotCQkJCQkJ
ZG9iai0+dGJvLnJlc3YpOworCQkJCQkJZG9iai0+dGJvLmJhc2UucmVzdik7CiAJCWlmICh0aW1l
IDwgMCkKIAkJCWdvdG8gb3V0X2NsZWFudXA7CiAJCWlmICh0aW1lID4gMCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vcmFk
ZW9uL3JhZGVvbl9jcy5jCmluZGV4IGQyMDY2NTRiMzFhZC4uN2U1MjU0YTM0ZTg0IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9yYWRlb24vcmFkZW9uX2NzLmMKQEAgLTI1Nyw3ICsyNTcsNyBAQCBzdGF0aWMgaW50IHJh
ZGVvbl9jc19zeW5jX3JpbmdzKHN0cnVjdCByYWRlb25fY3NfcGFyc2VyICpwKQogCWxpc3RfZm9y
X2VhY2hfZW50cnkocmVsb2MsICZwLT52YWxpZGF0ZWQsIHR2LmhlYWQpIHsKIAkJc3RydWN0IHJl
c2VydmF0aW9uX29iamVjdCAqcmVzdjsKIAotCQlyZXN2ID0gcmVsb2MtPnJvYmotPnRiby5yZXN2
OworCQlyZXN2ID0gcmVsb2MtPnJvYmotPnRiby5iYXNlLnJlc3Y7CiAJCXIgPSByYWRlb25fc3lu
Y19yZXN2KHAtPnJkZXYsICZwLT5pYi5zeW5jLCByZXN2LAogCQkJCSAgICAgcmVsb2MtPnR2Lm51
bV9zaGFyZWQpOwogCQlpZiAocikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2Rpc3BsYXku
YwppbmRleCBlYTZiNzUyZGQzYTQuLjdiZjczMjMwYWMwYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL3JhZGVvbi9yYWRlb25fZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRl
b24vcmFkZW9uX2Rpc3BsYXkuYwpAQCAtNTMzLDcgKzUzMyw3IEBAIHN0YXRpYyBpbnQgcmFkZW9u
X2NydGNfcGFnZV9mbGlwX3RhcmdldChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCURSTV9FUlJP
UigiZmFpbGVkIHRvIHBpbiBuZXcgcmJvIGJ1ZmZlciBiZWZvcmUgZmxpcFxuIik7CiAJCWdvdG8g
Y2xlYW51cDsKIAl9Ci0Jd29yay0+ZmVuY2UgPSBkbWFfZmVuY2VfZ2V0KHJlc2VydmF0aW9uX29i
amVjdF9nZXRfZXhjbChuZXdfcmJvLT50Ym8ucmVzdikpOworCXdvcmstPmZlbmNlID0gZG1hX2Zl
bmNlX2dldChyZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2wobmV3X3Jiby0+dGJvLmJhc2UucmVz
dikpOwogCXJhZGVvbl9ib19nZXRfdGlsaW5nX2ZsYWdzKG5ld19yYm8sICZ0aWxpbmdfZmxhZ3Ms
IE5VTEwpOwogCXJhZGVvbl9ib191bnJlc2VydmUobmV3X3Jibyk7CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVv
bi9yYWRlb25fZ2VtLmMKaW5kZXggNzIzODAwN2Y1YWE0Li4wMzg3M2YyMWE3MzQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9yYWRlb24vcmFkZW9uX2dlbS5jCkBAIC0xMTQsNyArMTE0LDcgQEAgc3RhdGljIGludCBy
YWRlb25fZ2VtX3NldF9kb21haW4oc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnb2JqLAogCX0KIAlp
ZiAoZG9tYWluID09IFJBREVPTl9HRU1fRE9NQUlOX0NQVSkgewogCQkvKiBBc2tpbmcgZm9yIGNw
dSBhY2Nlc3Mgd2FpdCBmb3Igb2JqZWN0IGlkbGUgKi8KLQkJciA9IHJlc2VydmF0aW9uX29iamVj
dF93YWl0X3RpbWVvdXRfcmN1KHJvYmotPnRiby5yZXN2LCB0cnVlLCB0cnVlLCAzMCAqIEhaKTsK
KwkJciA9IHJlc2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KHJvYmotPnRiby5iYXNl
LnJlc3YsIHRydWUsIHRydWUsIDMwICogSFopOwogCQlpZiAoIXIpCiAJCQlyID0gLUVCVVNZOwog
CkBAIC00NDksNyArNDQ5LDcgQEAgaW50IHJhZGVvbl9nZW1fYnVzeV9pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCX0KIAlyb2JqID0gZ2VtX3RvX3JhZGVvbl9ibyhn
b2JqKTsKIAotCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uocm9iai0+
dGJvLnJlc3YsIHRydWUpOworCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9y
Y3Uocm9iai0+dGJvLmJhc2UucmVzdiwgdHJ1ZSk7CiAJaWYgKHIgPT0gMCkKIAkJciA9IC1FQlVT
WTsKIAllbHNlCkBAIC00NzgsNyArNDc4LDcgQEAgaW50IHJhZGVvbl9nZW1fd2FpdF9pZGxlX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJfQogCXJvYmogPSBnZW1f
dG9fcmFkZW9uX2JvKGdvYmopOwogCi0JcmV0ID0gcmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGlt
ZW91dF9yY3Uocm9iai0+dGJvLnJlc3YsIHRydWUsIHRydWUsIDMwICogSFopOworCXJldCA9IHJl
c2VydmF0aW9uX29iamVjdF93YWl0X3RpbWVvdXRfcmN1KHJvYmotPnRiby5iYXNlLnJlc3YsIHRy
dWUsIHRydWUsIDMwICogSFopOwogCWlmIChyZXQgPT0gMCkKIAkJciA9IC1FQlVTWTsKIAllbHNl
IGlmIChyZXQgPCAwKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25f
bW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX21uLmMKaW5kZXggOGMzODcxZWQy
M2E5Li4wZDY0YWNlMGU2YzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFk
ZW9uX21uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fbW4uYwpAQCAtMTYz
LDcgKzE2Myw3IEBAIHN0YXRpYyBpbnQgcmFkZW9uX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQo
c3RydWN0IG1tdV9ub3RpZmllciAqbW4sCiAJCQkJY29udGludWU7CiAJCQl9CiAKLQkJCXIgPSBy
ZXNlcnZhdGlvbl9vYmplY3Rfd2FpdF90aW1lb3V0X3JjdShiby0+dGJvLnJlc3YsCisJCQlyID0g
cmVzZXJ2YXRpb25fb2JqZWN0X3dhaXRfdGltZW91dF9yY3UoYm8tPnRiby5iYXNlLnJlc3YsCiAJ
CQkJdHJ1ZSwgZmFsc2UsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJCWlmIChyIDw9IDApCiAJ
CQkJRFJNX0VSUk9SKCIoJWxkKSBmYWlsZWQgdG8gd2FpdCBmb3IgdXNlciBib1xuIiwgcik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX29iamVjdC5jCmluZGV4IGQ5NmMyY2I3ZDU4NC4uNGU4
ZDFkODJkYzBlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmpl
Y3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9vYmplY3QuYwpAQCAtNjEw
LDcgKzYxMCw3IEBAIGludCByYWRlb25fYm9fZ2V0X3N1cmZhY2VfcmVnKHN0cnVjdCByYWRlb25f
Ym8gKmJvKQogCWludCBzdGVhbDsKIAlpbnQgaTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmJv
LT50Ym8ucmVzdi0+bG9jay5iYXNlKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLmJh
c2UucmVzdi0+bG9jay5iYXNlKTsKIAogCWlmICghYm8tPnRpbGluZ19mbGFncykKIAkJcmV0dXJu
IDA7CkBAIC03MzYsNyArNzM2LDcgQEAgdm9pZCByYWRlb25fYm9fZ2V0X3RpbGluZ19mbGFncyhz
dHJ1Y3QgcmFkZW9uX2JvICpibywKIAkJCQl1aW50MzJfdCAqdGlsaW5nX2ZsYWdzLAogCQkJCXVp
bnQzMl90ICpwaXRjaCkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLnJlc3YtPmxv
Y2suYmFzZSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5iYXNlLnJlc3YtPmxvY2su
YmFzZSk7CiAKIAlpZiAodGlsaW5nX2ZsYWdzKQogCQkqdGlsaW5nX2ZsYWdzID0gYm8tPnRpbGlu
Z19mbGFnczsKQEAgLTc0OCw3ICs3NDgsNyBAQCBpbnQgcmFkZW9uX2JvX2NoZWNrX3RpbGluZyhz
dHJ1Y3QgcmFkZW9uX2JvICpibywgYm9vbCBoYXNfbW92ZWQsCiAJCQkJYm9vbCBmb3JjZV9kcm9w
KQogewogCWlmICghZm9yY2VfZHJvcCkKLQkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmYm8tPnRiby5y
ZXN2LT5sb2NrLmJhc2UpOworCQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZiby0+dGJvLmJhc2UucmVz
di0+bG9jay5iYXNlKTsKIAogCWlmICghKGJvLT50aWxpbmdfZmxhZ3MgJiBSQURFT05fVElMSU5H
X1NVUkZBQ0UpKQogCQlyZXR1cm4gMDsKQEAgLTg3MCw3ICs4NzAsNyBAQCBpbnQgcmFkZW9uX2Jv
X3dhaXQoc3RydWN0IHJhZGVvbl9ibyAqYm8sIHUzMiAqbWVtX3R5cGUsIGJvb2wgbm9fd2FpdCkK
IHZvaWQgcmFkZW9uX2JvX2ZlbmNlKHN0cnVjdCByYWRlb25fYm8gKmJvLCBzdHJ1Y3QgcmFkZW9u
X2ZlbmNlICpmZW5jZSwKIAkJICAgICBib29sIHNoYXJlZCkKIHsKLQlzdHJ1Y3QgcmVzZXJ2YXRp
b25fb2JqZWN0ICpyZXN2ID0gYm8tPnRiby5yZXN2OworCXN0cnVjdCByZXNlcnZhdGlvbl9vYmpl
Y3QgKnJlc3YgPSBiby0+dGJvLmJhc2UucmVzdjsKIAogCWlmIChzaGFyZWQpCiAJCXJlc2VydmF0
aW9uX29iamVjdF9hZGRfc2hhcmVkX2ZlbmNlKHJlc3YsICZmZW5jZS0+YmFzZSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9wcmltZS5jIGIvZHJpdmVycy9ncHUv
ZHJtL3JhZGVvbi9yYWRlb25fcHJpbWUuYwppbmRleCBiY2IwNGY0ODVlODYuLjkwZWI4OTk1ZGQ5
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fcHJpbWUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl9wcmltZS5jCkBAIC0xMjEsNyArMTIxLDcg
QEAgc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmFkZW9uX2dlbV9wcmltZV9yZXNfb2JqKHN0
cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCByYWRlb25fYm8gKmJvID0gZ2Vt
X3RvX3JhZGVvbl9ibyhvYmopOwogCi0JcmV0dXJuIGJvLT50Ym8ucmVzdjsKKwlyZXR1cm4gYm8t
PnRiby5iYXNlLnJlc3Y7CiB9CiAKIHN0cnVjdCBkbWFfYnVmICpyYWRlb25fZ2VtX3ByaW1lX2V4
cG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L3JhZGVvbi9yYWRlb25fdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdGVz
dC5jCmluZGV4IDBmNmJhODFhMTY2OS4uYTVlMWQyMTM5ZTgwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vcmFkZW9uL3JhZGVvbl90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVv
bi9yYWRlb25fdGVzdC5jCkBAIC0xMjAsMTEgKzEyMCwxMSBAQCBzdGF0aWMgdm9pZCByYWRlb25f
ZG9fdGVzdF9tb3ZlcyhzdHJ1Y3QgcmFkZW9uX2RldmljZSAqcmRldiwgaW50IGZsYWcpCiAJCWlm
IChyaW5nID09IFI2MDBfUklOR19UWVBFX0RNQV9JTkRFWCkKIAkJCWZlbmNlID0gcmFkZW9uX2Nv
cHlfZG1hKHJkZXYsIGd0dF9hZGRyLCB2cmFtX2FkZHIsCiAJCQkJCQlzaXplIC8gUkFERU9OX0dQ
VV9QQUdFX1NJWkUsCi0JCQkJCQl2cmFtX29iai0+dGJvLnJlc3YpOworCQkJCQkJdnJhbV9vYmot
PnRiby5iYXNlLnJlc3YpOwogCQllbHNlCiAJCQlmZW5jZSA9IHJhZGVvbl9jb3B5X2JsaXQocmRl
diwgZ3R0X2FkZHIsIHZyYW1fYWRkciwKIAkJCQkJCSBzaXplIC8gUkFERU9OX0dQVV9QQUdFX1NJ
WkUsCi0JCQkJCQkgdnJhbV9vYmotPnRiby5yZXN2KTsKKwkJCQkJCSB2cmFtX29iai0+dGJvLmJh
c2UucmVzdik7CiAJCWlmIChJU19FUlIoZmVuY2UpKSB7CiAJCQlEUk1fRVJST1IoIkZhaWxlZCBH
VFQtPlZSQU0gY29weSAlZFxuIiwgaSk7CiAJCQlyID0gUFRSX0VSUihmZW5jZSk7CkBAIC0xNzEs
MTEgKzE3MSwxMSBAQCBzdGF0aWMgdm9pZCByYWRlb25fZG9fdGVzdF9tb3ZlcyhzdHJ1Y3QgcmFk
ZW9uX2RldmljZSAqcmRldiwgaW50IGZsYWcpCiAJCWlmIChyaW5nID09IFI2MDBfUklOR19UWVBF
X0RNQV9JTkRFWCkKIAkJCWZlbmNlID0gcmFkZW9uX2NvcHlfZG1hKHJkZXYsIHZyYW1fYWRkciwg
Z3R0X2FkZHIsCiAJCQkJCQlzaXplIC8gUkFERU9OX0dQVV9QQUdFX1NJWkUsCi0JCQkJCQl2cmFt
X29iai0+dGJvLnJlc3YpOworCQkJCQkJdnJhbV9vYmotPnRiby5iYXNlLnJlc3YpOwogCQllbHNl
CiAJCQlmZW5jZSA9IHJhZGVvbl9jb3B5X2JsaXQocmRldiwgdnJhbV9hZGRyLCBndHRfYWRkciwK
IAkJCQkJCSBzaXplIC8gUkFERU9OX0dQVV9QQUdFX1NJWkUsCi0JCQkJCQkgdnJhbV9vYmotPnRi
by5yZXN2KTsKKwkJCQkJCSB2cmFtX29iai0+dGJvLmJhc2UucmVzdik7CiAJCWlmIChJU19FUlIo
ZmVuY2UpKSB7CiAJCQlEUk1fRVJST1IoIkZhaWxlZCBWUkFNLT5HVFQgY29weSAlZFxuIiwgaSk7
CiAJCQlyID0gUFRSX0VSUihmZW5jZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFk
ZW9uL3JhZGVvbl90dG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3R0bS5jCmlu
ZGV4IGY0NzRiZWVkYTVlYi4uYjVlMDJiYjNjMDE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vcmFkZW9uL3JhZGVvbl90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVv
bl90dG0uYwpAQCAtMjQ0LDcgKzI0NCw3IEBAIHN0YXRpYyBpbnQgcmFkZW9uX21vdmVfYmxpdChz
dHJ1Y3QgdHRtX2J1ZmZlcl9vYmplY3QgKmJvLAogCUJVSUxEX0JVR19PTigoUEFHRV9TSVpFICUg
UkFERU9OX0dQVV9QQUdFX1NJWkUpICE9IDApOwogCiAJbnVtX3BhZ2VzID0gbmV3X21lbS0+bnVt
X3BhZ2VzICogKFBBR0VfU0laRSAvIFJBREVPTl9HUFVfUEFHRV9TSVpFKTsKLQlmZW5jZSA9IHJh
ZGVvbl9jb3B5KHJkZXYsIG9sZF9zdGFydCwgbmV3X3N0YXJ0LCBudW1fcGFnZXMsIGJvLT5yZXN2
KTsKKwlmZW5jZSA9IHJhZGVvbl9jb3B5KHJkZXYsIG9sZF9zdGFydCwgbmV3X3N0YXJ0LCBudW1f
cGFnZXMsIGJvLT5iYXNlLnJlc3YpOwogCWlmIChJU19FUlIoZmVuY2UpKQogCQlyZXR1cm4gUFRS
X0VSUihmZW5jZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9u
X3V2ZC5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdXZkLmMKaW5kZXggZmY0Zjc5
NGQxYzg2Li4zMTFlNjljMmVkN2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24v
cmFkZW9uX3V2ZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9yYWRlb24vcmFkZW9uX3V2ZC5jCkBA
IC00NzcsNyArNDc3LDcgQEAgc3RhdGljIGludCByYWRlb25fdXZkX2NzX21zZyhzdHJ1Y3QgcmFk
ZW9uX2NzX3BhcnNlciAqcCwgc3RydWN0IHJhZGVvbl9ibyAqYm8sCiAJCXJldHVybiAtRUlOVkFM
OwogCX0KIAotCWYgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2woYm8tPnRiby5yZXN2KTsK
KwlmID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsKGJvLT50Ym8uYmFzZS5yZXN2KTsKIAlp
ZiAoZikgewogCQlyID0gcmFkZW9uX2ZlbmNlX3dhaXQoKHN0cnVjdCByYWRlb25fZmVuY2UgKilm
LCBmYWxzZSk7CiAJCWlmIChyKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vcmFkZW9u
L3JhZGVvbl92bS5jIGIvZHJpdmVycy9ncHUvZHJtL3JhZGVvbi9yYWRlb25fdm0uYwppbmRleCA4
NTEyYjAyZTk1ODMuLmU0OGEwNTUzMzEyNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL3Jh
ZGVvbi9yYWRlb25fdm0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vcmFkZW9uL3JhZGVvbl92bS5j
CkBAIC03MDIsNyArNzAyLDcgQEAgaW50IHJhZGVvbl92bV91cGRhdGVfcGFnZV9kaXJlY3Rvcnko
c3RydWN0IHJhZGVvbl9kZXZpY2UgKnJkZXYsCiAJaWYgKGliLmxlbmd0aF9kdyAhPSAwKSB7CiAJ
CXJhZGVvbl9hc2ljX3ZtX3BhZF9pYihyZGV2LCAmaWIpOwogCi0JCXJhZGVvbl9zeW5jX3Jlc3Yo
cmRldiwgJmliLnN5bmMsIHBkLT50Ym8ucmVzdiwgdHJ1ZSk7CisJCXJhZGVvbl9zeW5jX3Jlc3Yo
cmRldiwgJmliLnN5bmMsIHBkLT50Ym8uYmFzZS5yZXN2LCB0cnVlKTsKIAkJV0FSTl9PTihpYi5s
ZW5ndGhfZHcgPiBuZHcpOwogCQlyID0gcmFkZW9uX2liX3NjaGVkdWxlKHJkZXYsICZpYiwgTlVM
TCwgZmFsc2UpOwogCQlpZiAocikgewpAQCAtODMwLDggKzgzMCw4IEBAIHN0YXRpYyBpbnQgcmFk
ZW9uX3ZtX3VwZGF0ZV9wdGVzKHN0cnVjdCByYWRlb25fZGV2aWNlICpyZGV2LAogCQl1aW50NjRf
dCBwdGU7CiAJCWludCByOwogCi0JCXJhZGVvbl9zeW5jX3Jlc3YocmRldiwgJmliLT5zeW5jLCBw
dC0+dGJvLnJlc3YsIHRydWUpOwotCQlyID0gcmVzZXJ2YXRpb25fb2JqZWN0X3Jlc2VydmVfc2hh
cmVkKHB0LT50Ym8ucmVzdiwgMSk7CisJCXJhZGVvbl9zeW5jX3Jlc3YocmRldiwgJmliLT5zeW5j
LCBwdC0+dGJvLmJhc2UucmVzdiwgdHJ1ZSk7CisJCXIgPSByZXNlcnZhdGlvbl9vYmplY3RfcmVz
ZXJ2ZV9zaGFyZWQocHQtPnRiby5iYXNlLnJlc3YsIDEpOwogCQlpZiAocikKIAkJCXJldHVybiBy
OwogCi0tIAoyLjE4LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCmRyaS1kZXZlbCBtYWlsaW5nIGxpc3QKZHJpLWRldmVsQGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2RyaS1k
ZXZlbA==
